# StackOverflow 问答 000297000-000297999

# rest - 网站 API 的黄金标准是什么？Twitter、Flickr、Facebook 等

> ID：297005
> 
> 赞同：61
> 
> 时间：2008-11-17T21:28:22.827
> 
> 标签：rest, api-design, asp.net-web-api

今天的网站似乎有两类 API。

1.  允许扩展站点功能的 API，如 Facebook、Myspace 等。这些 API 似乎非常多样化。

2.  允许与现有站点功能（如 Twitter、Flickr 等）交互的 API。这些都声称是基于 REST 的，但实际上只是“HTTP 上的数据”。

如果您正在创建一个允许功能扩展和外部交互的网站，您会使用哪些现有 API 作为参考模型？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2010-02-05T06:31:58.863

我们自己也在这方面做一些研究。网站 API 参考的“黄金标准”并不多。

引用的最常见的网站 API 是：

*   谷歌 API [http://developers.google.com/api-client-library/java/apis](http://developers.google.com/api-client-library/java/apis)
*   亚马逊 S3 [http://docs.amazonwebservices.com/AmazonS3/latest/API/](http://docs.amazonwebservices.com/AmazonS3/latest/API/)
*   推特[https://dev.twitter.com/](https://dev.twitter.com/)
*   脸[书 http://developers.facebook.com/](http://developers.facebook.com/)
*   领英[http://developer.linkedin.com/index.jspa](http://developer.linkedin.com/index.jspa)
*   美味[http://delicious.com/help/api](http://delicious.com/help/api)
*   YouTube [http://www.youtube.com/dev](http://www.youtube.com/dev)
*   Netflix [http://developer.netflix.com/](http://developer.netflix.com/)
*   Sun Cloud API [http://kenai.com/projects/suncloudapis/pages/Home](http://kenai.com/projects/suncloudapis/pages/Home)

这里的另一个列表：

[http://www.pingable.org/the-top-15-web-apis-for-your-site/](http://www.pingable.org/the-top-15-web-apis-for-your-site/)

有人推荐这本书[Restful Web Services](https://rads.stackoverflow.com/amzn/click/com/0596529260)作为这方面的一个很好的参考。

（请随时编辑以上列表以添加其他具有 API 的知名网站）

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2010-02-05T07:00:29.330

[Joshua Bloch](http://en.wikipedia.org/wiki/Joshua_Bloch)的 60 分钟 Google 技术演讲[How To Design A Good API and Why it Matters 与此](http://www.youtube.com/watch?v=aAb7hSCtvGw)相关。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-02-05T15:48:59.337

和几个人一起工作过，我会开始做的

*   Facebook

    *   好：干净且相对一致。表现良好，大多数事情在逻辑上都是有意义的。FQL 非常简洁。XML 和 JSON 选项。除了您真正需要的之外，没有对响应格式的预先概念
    *   坏：经常改变，没有警告。“官方” api 库非常糟糕。许多电话的文档很差或丢失。非标准身份验证（有些人可能称之为好？）
*   我的空间

    *   好：开放标准（oAuth 身份验证、Opensocial 端点）
    *   BAD：经常坏。oauth 的使用非常不标准，并且会破坏大多数客户端库。官方客户端库很糟糕。
*   Photobucket（免责声明：我编写了 photobucket api 的服务器端）

    *   GOOD：开放标准认证（oauth）。xml、json、甚至php序列化数组格式作为响应参数。忠实的 REST（在“名词”网址上获取/放置/删除/发布）。
    *   不好：客户端库不多。标准 oauth 库的架构挑战（用户生活在子域中，必须对子域进行调用，因此 url 必须更改）。
*   推特

    *   好：非常一致（尽管 api 与搜索 api 有差异）。良好的 REST 实践。OAuth 身份验证以及支持 oldschool Basic。
    *   坏：错误率（不过与推特的其他部分几乎一致）。一些返回值的奇怪格式（如它们的日期格式）。

**理想特性**

*   我不是在“严格”的 REST 上出售的。PUT 和 DELETE 会导致某些客户端语言出现问题。使用适当的“动词”，GET 和 POST 似乎就足够了。此外，类似 RPC 的函数名称对我来说是可以的，只要它们是合乎逻辑的，甚至可能是 URI 的一部分。在这种情况下，对象 IDS 仍然需要非常一致。
*   标准认证/授权。Basic/Digest 可以，但我是 OpenID/oAuth 的粉丝（或者如果你想获得最前沿的 WRAP）。滚动你自己意味着你必须解释 100%，并可能为每个人编写客户端库。
*   标准数据类型。确保您的数据类型保持一致（“真”或 1，而不是混合），并支持最通用的标准。日期时间应为 ISO8601。地理位置应该“看起来像”GeoRSS 等。您*应该*能够为您的返回类型创建一个 XSD/relaxNG/任何严格的验证器。期望您的输入具有相同的标准。
*   简单的回报结构。XML-RPC/JSON-RPC 有一些好处，因为你有点知道你得到了什么，但无论如何，如果我不能用 JSON 或 PHP 的 SimpleXML 之类的东西轻松解析你的返回类型，并且基本上将它序列化为一致哈希，我要生气了。
*   支持无破损扩展/扩展。不要将自己编码到一个角落，并使其难以添加到您的 API。试着预先做出好的决定，你不会经常改变。
*   文档！确保它是好的，并解释一切。即使那样它也不够好，所以请确保您有专门的时间来处理它，并有一个支持论坛或其他任何东西来保持它的最新状态。

话虽这么说...... Facebook和Twitter之间的东西。当然，我偏爱我们在 Photobucket 上的一些东西，但我也讨厌其中的一些。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-02-05T08:42:13.447

在我看来， API**的文档**与 API 的实际设计一样（或更多）重要。

写得好，简单的文档将弥补任何设计缺陷。这就是我在查看已经发布的各种链接后所学到的。具体来说，Last.fm 的文档看起来非常好：易于浏览且易于理解。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-02-05T07:51:15.337

关于 Jeff 的大 API 列表：我很确定common 并不意味着*“*黄金**标准***”*。

无需保留广泛 API 的手动列表。要获取列表，请查看[http://www.programmableweb.com/apis/directory/1?sort=mashups](http://www.programmableweb.com/apis/directory/1?sort=mashups)。

由于我喜欢将 REST 作为松散的标准，我会说 API 在*有意义*且*直观*时是“黄金” 。

*   推特（[http://apiwiki.twitter.com/](http://apiwiki.twitter.com/)），
*   Github ( [http://develop.github.com/](http://develop.github.com/) ) 和
*   Last.FM ( [http://www.last.fm/api](http://www.last.fm/api) )

……所有这些对我来说都是最有意义的，并且经过深思熟虑（正如布赖恩已经指出的那样）。

在我目前的日常工作中，我也经常使用 OpenSocial，其中 URI 感觉非常自然，但也以自己的方式扩展了 REST 标准。

如果您喜欢它严格和安全，请使用 SOAP。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-02-05T06:41:32.943

Last.fm 的 api 仍然是网络上维护得最好的 api 之一。它的存在时间也比大多数都长，因为它基本上就是这样开始的。

[http://www.last.fm/api](http://www.last.fm/api)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-17T21:32:44.393

我会查看 OpenSocial，这是一项为社交网络创建 API 标准的运动。他们为此使用 REST，并采用以“用户”为中心的方法。但这是一个非常有据可查的方法，即使是不完全基于社交的网站也可能有所帮助。如果您正在寻找一些内部代码实现，请查看 Drupals 挂钩系统和 Wordpress。

[http://code.google.com/apis/opensocial/](http://code.google.com/apis/opensocial/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-02-05T10:30:00.290

我认为最好的回答方式是列出好的 Web API 的**特征**，而不是引用示例。如果您喜欢 Twitter/Facebook/etc API，您觉得这些 API 的哪些方面有吸引力？

我将采取第一刺：

1.  有据可查的 API，包括约束和使用策略。这样可以放心地进行快速开发，而不是再次猜测参数可能意味着什么，以及返回值是什么。
2.  与技术/语言无关的 API。好的 API 应该易于使用，提供相同的功能，跨多种语言和平台。
3.  支持良好的 API。总是有错误。响应式维护者带来更多可用的 API
4.  分层 API 集。当 API 被整齐地分层时，广泛的开发人员可以使用他们需要的部分，而无需引入无关的层。另外，它迫使创建者认真思考干净和组件化的 API。

请在评论中添加更多内容。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-12-28T18:25:17.457

我对其他人没有任何经验，但即使经过多年的发展，Facebook API 仍然很糟糕。它远非“黄金标准”。相反，这是人们努力克服并咬紧牙关的事情，因为一旦他们最终做对了，它可以增加很多价值。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-02-05T06:43:59.510

一些特别好的 API：

*   Last.FM [http://www.last.fm/api](http://www.last.fm/api)（精彩的文档）
*   Github [http://develop.github.com/](http://develop.github.com/)（很高兴合作，深思熟虑）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-17T21:57:40.007

这将取决于您的目标受众是什么。如果是.net 商店，那么soap 可能还可以，否则明智地专注于REST，因为它的进入门槛要低得多。从那里查看针对您想要的相同人群的网站 API。这样你的 api 会感觉很熟悉。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-02-06T01:57:42.043

有一个与此类似的问题，但没有采取太多行动，但认为链接到它会很好。

[您最想复制或最受欢迎的 Web API 是什么？](https://stackoverflow.com/questions/775988/what-web-apis-would-you-most-want-to-replicate-or-are-the-most-popular)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-02-08T04:06:01.647

如果我今天为现有网站设计 Web api，假设网站在正确使用 HTTP 方面设计得很好，我会**使用现有网站作为设计指南**。

以 Stack Overflow 为例，它已经将**整个 URI 空间映射出来**。它在不同的表示之间定义了一套完整的互连。**该站点的用户已经熟悉站点结构**，因此 API 结构已经很熟悉。

**唯一需要更改的部分是表示的内容**，以消除所有不必要的标记。有必要添加一些额外的模板链接，以允许当前只能通过 javascript 访问的搜索。例如，搜索用户不容易通过导航发现，因为当前链接是通过 javascript 构建的。

真正**棘手的决定是使用什么媒体类型**。您可以使用带有 RDFa 样式元数据标记的简单 html，或者在 Html5 中使用新的 Microdata 格式。或者，您可以返回基于 xml 或 Json 的自定义媒体类型。像 application/vnd.stackoverflow.question+xml 等。自定义媒体类型使版本控制变得非常容易，但对于不是设计为直接访问 StackOverflow 的客户端来说，它不太容易访问。自定义类型可以与 StackOverflow 中大部分已经存在的 Atom 提要结合使用，

**设计一个 web api 与设计一个网站实际上没有什么不同**，除了你提供的内容将被一个不是 web 浏览器的程序使用。

**您不想做的是创建一个基于 Http 的数据访问层**。这就像向世界展示你的内衣一样。现有网站针对所有常见使用场景进行了优化，许多 api 访问模式将是相似的，因此重用已经创建的“视图”。可能有必要在这里和那里添加一些额外的链接，以使程序更快地获取所需的数据，但是可以根据需要逐步添加这些链接。

编写良好的网站已经是 Web 浏览器客户端非常有效的 API，实际上没有必要回到绘图板来支持任何其他类型的客户端。API 结构不需要改变，只需要改变交付的内容。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-02-05T17:08:24.400

AtomPub 是黄金标准，因为它是由互联网上一些最聪明的人设计的。使用 iit 作为基础，你不会走得太远。这就是 google 和 msft 所做的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-02-05T09:39:30.070

Force（以前称为 SalesForce）API： http: [//www.salesforce.com/us/developer/docs/api/index.htm](http://www.salesforce.com/us/developer/docs/api/index.htm)

# sql - 部分关键字搜索 (MS SQL 2005)

> ID：297010
> 
> 赞同：1
> 
> 时间：2008-11-17T21:29:59.127
> 
> 标签：sql, sql-server, full-text-search

目前，我有一个存储过程，其主要目标是通过电影和电视节目的数据库表进行全文搜索。为了让它进行部分关键字搜索，我在 SQL 中添加了一些代码，以空格分隔搜索查询，并输出如下语句：

`"batman*" ~ "be*"`

例如，原始字符串“batman be”可以在用户键入时从页面上的文本框生成，并且在每个 javascript keyup 事件中，我将该文本框中的任何内容发送到存储的 proc 以获取结果以获得结果为我输入（如自动完成）。在这种情况下，用户可能一直在寻找“Batman Begins”或“The Batman: Batgirl Begins”（电视剧集），结果它们都应该出现。

以下是我的查询示例。@partialKeywordString 在上面的示例中是`"batman*" ~ "be*"`.

```
SELECT f.title
FROM Films f INNER JOIN
    CONTAINSTABLE(Films, Title, @partialKeywordString) f_key ON f.filmid = f_key.[key]
ORDER BY f_key.Rank DESC 
```

我对查询的问题是排名似乎并不完全符合我的预期。如果我只搜索“蝙蝠侠”，人们会认为所有以“蝙蝠侠”开头或仅包含“蝙蝠侠”一词的电影标题都会首先出现。但他们没有。
以下是仅搜索“batman”时发生的情况的示例结果：

“蝙蝠侠：动画系列 - 第 114 集”
“蝙蝠侠和罗宾的冒险 - 第 218 集”
“蝙蝠侠和罗宾 - 第 101 集”
“蝙蝠侠 - 第 101 集”
“蝙蝠侠和罗宾 - 第 204 集”

更靠后的是我正在寻找的电影——“蝙蝠侠开始”，甚至只是“蝙蝠侠”。

我正在寻找有关如何调整此查询的建议——我绝对不是 SQL 专家，我觉得我只是手动处理了上面的代码以使其工作。我觉得有一个更优雅或更强大的解决方案，但我还没有找到它。

先感谢您

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T15:00:26.370

经过更多的研究，我将尝试使用 Lucene.Net 作为我的电影标题搜索引擎，而不是依赖 SQL Server 2005 中的全文搜索。早期测试表明结果更好，更相关卢森。搜索“batman”会返回以下部分结果集：

*   蝙蝠侠
*   蝙蝠侠侠影之谜
*   蝙蝠侠归来
*   蝙蝠侠与罗宾：蝙蝠侠接管
*   超越蝙蝠侠：Curaré
*   超越蝙蝠侠：通天塔
*   蝙蝠侠：第 2 季
*   蝙蝠侠：颠倒黑白
*   蝙蝠侠与罗宾：恐怖隧道
*   超越蝙蝠侠 [动画电视剧]
*   蝙蝠侠的新冒险：诅咒！又上油了！
*   蝙蝠侠的新冒险：这看起来像是蝙蝠螨的工作！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-02T20:52:45.470

我认为您会发现 SQL Server Full Text 的效果一样好，但您必须了解如何构建关键字。它与 Lucene 不一样，尤其是在索引方面。我想你会发现 SQL Server 在可扩展性和功能方面会更好——尤其是 SQL 2008 现在它是引擎的一部分。

# asp.net - 从数据库中读取文件

> ID：297018
> 
> 赞同：0
> 
> 时间：2008-11-17T21:32:56.483
> 
> 标签：asp.net, database, file-io

我已将 txt 文件作为字符串存储在数据库列中。现在，在我的一个 aspx 页面上，我有一个链接...当用户单击此链接时，我想打开一个 txt 文件。我如何从数据库中读取文件。我知道如何使用 streamreader 对存储在磁盘上的文件执行此操作。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T21:55:13.740

如果您确实必须将文件存储在数据库中（我完全同意 Will 的观点，您不应该这样做），您可能需要考虑实现一个单独的下载页面（例如 getfile.aspx），该页面负责获取基于 id 的数据库中的字符串，可能是 (getfile.aspx?fileId=12345)，设置适当的 HTTP 标头并将内容直接输出到浏览器。通过设置内容类型标头，您应该能够强制浏览器将 aspx 页面视为 txt 文件或任何其他可识别的文件格式。

不过，我强烈建议尝试更改项目范围，不要将文件存储在数据库中，因为这种方法很快就会变得非常混乱。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-23T17:51:17.710

它涵盖了数据库和类型 blob... 应该很有用。

[http://www.php-mysql-tutorial.com/wikis/mysql-tutorials/uploading-files-to-mysql-database.aspx](http://www.php-mysql-tutorial.com/wikis/mysql-tutorials/uploading-files-to-mysql-database.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T21:41:12.113

这需要一些澄清。

如果文件作为字符串存储在数据库中，您所要做的就是将其读入字符串并显示在页面中。

```
public void Page_Load(object sender, EventArgs e)
  var text = (from x in dataContext.MyTextTable where x.Id == someId select x.FileText).FirstOrDefault();

  this.textBox.Text = text;
} 
```

* * *

好的，这就是你需要做的。伪代码如下：

从数据库中加载字符串 对字符串
使用 ToCharArray() 方法获取字符数组 使用 HttpResponse 对象将字符数组 Write() 到响应流

这是一些几乎可以编译的代码：

```
public void Page_Load(object sender, EventArgs e)
{
  var text = Repository.GetTextFile(this.FileTextBox.Text).ToCharArray();

  Response.Clear();
  Response.AddHeader("Content-Disposition", "attachment; filename=" & this.FileTextBox.Text);
  Response.AddHeader("Content-Length", text.Length.ToString());
  Response.ContentType = "application/octet-stream";
  Response.Write(text, 0, text.length);
  Response.End();
} 
```

我相信 mime 类型应该是 text/plain 而不是 text/plain 因为浏览器可能会尝试打开文件而不是将其保存为附件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T21:44:08.363

为什么要将文件存储在数据库列中？数据库更适合您真正需要查询的内容...对于诸如“给我过去 30 天的所有给定链接”或“获取所有带有织物室内装饰的蓝色汽车”之类的查询很有用。

文件由操作系统文件系统更好地处理。但是，如果您必须有关于该文件的记录，则可以放置一条记录，然后将文件的路径放入字符串列中。

# c++ - MFC，c ++在屏幕上显示和隐藏ctrls时，我可以暂时禁用绘画吗

> ID：297027
> 
> 赞同：0
> 
> 时间：2008-11-17T21:35:57.273
> 
> 标签：c++, mfc, onpaint, suspend

我有一个屏幕，上面有 20 个控件。我想展示全部二十个，然后只隐藏那些与我正在做的事情无关的。

```
psudoCode.
for each element 
    show element 

for each element in hide list
    hide element. 
```

我的问题是屏幕绘制的循环之间。它看起来非常难看。
我知道我已经看到了这一点，但是对于我的生活，我找不到那个代码，甚至不记得我在哪个应用程序中看到了那个代码..

有人知道如何暂停油漆吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T21:46:51.963

正如不久前有人向我建议的那样，使用 CWnd::SetRedraw

```
wnd.SetRedraw(FALSE)
... // do your stuff with elements
wnd.SetRedraw(TRUE) 
```

# command-line - 如何获取文件名和修订号作为列表？

> ID：297029
> 
> 赞同：2
> 
> 时间：2008-11-17T21:36:10.440
> 
> 标签：command-line, cvs

如何从指定文件夹开始获取文件名和修订号作为列表？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T20:08:42.627

您可以`cvs status`在项目的基础文件夹中使用，并使用 grep 获取相应的行：

```
> cvs status | grep Repository\ revision\:
Repository revision: 1.16    /cvsroot/module/.cvsignore,v
Repository revision: 1.1.1.1 /cvsroot/module/build.sh,v
Repository revision: 1.251   /cvsroot/module/build.xml,v
Repository revision: 1.36    /cvsroot/module/manifest.xml,v
... and on, and on... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T09:00:06.410

`cvs status`每个文件将以下列形式为您提供该信息：

```
===================================================================
File: test.pas      Status: Up-to-date

   Working revision:    1.4
   Repository revision: 1.4     /cvsroot/MyModule/test.pas,v
   Expansion option:    kv
   Commit Identifier:   86c473d9b385950
   Sticky Tag:          (none)
   Sticky Date:         (none)
   Sticky Options:      (none)
   Merge From:          (none) 
```

*（输出来自 CVSNT；普通 CVS 不会显示提交 ID 和合并点）*

您可以编写一个脚本来提取和重新格式化该信息。

# java - CXF 和 Spring-WS 哪个框架更好？

> ID：297033
> 
> 赞同：81
> 
> 时间：2008-11-17T21:37:40.357
> 
> 标签：java, web-services, cxf, spring-ws

我正在研究/比较 Web 服务的 CXF 和 Spring-WS？我需要同时作为 WS 的提供者和消费者。简而言之，有人告诉我 Spring-WS 更具可配置性，但 CXF 更容易启动和运行。这个问题是主观的，但会帮助指导我的研究。

*   您对这些框架中的任何一个都有什么经验？
*   你有没有遇到过任何一个框架的陷阱？
*   您是否发现任何一方提供而另一方未提供的有用功能？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2010-07-03T17:04:14.213

关于 Apache CXF：

*   CXF 支持多种标准，包括 SOAP、WSI Basic Profile、WSDL、WS-Addressing、WS-Policy、WS-ReliableMessaging、WS-Security、WS-SecurityPolicy 和 WS-SecureConversation。
*   Apache CXF 提供最后契约（从 Java 开始）和契约优先（从 WSDL 开始）两种方法。
*   Apache CXF 实现了 JAX-WS 和 JAX-RS。

关于 Spring WS：

*   Spring WS 从 XSD Schema 开始提供“仅”合同优先。
*   Spring WS 支持 SOAP、WS-Security、WS-Addressing。

因此，最后，我将 Spring WS 视为一个**最小的**Web 服务框架，但认为它（在我看来）与 Apache CXF（与 Spring 集成得非常好）没有任何优势。在两者之间，我会选择 Apache CXF。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-12-04T16:48:30.203

CXF 不会以任何方式阻止您从合同 (WSDL) 开始。我使用这两种产品来构建 Web 服务。

在 CXF 中，我使用 Maven 和 Maven 插件，调用**wsimport**目标来生成我随后实现的 SEI（接口）。在实现了包含实际服务逻辑的接口并配置了我的 bean 实现**beans.xml**之后，我让 Maven 将其打包成一个 war 文件进行部署。整个练习再简单不过了。

我不认为 Spring-WS 提供的任何优势都超过了 JAX-WS 的不足。CXF 已经允许您使用 Spring 连接您的 bean，并且还具有 JAX-WS 的完整实现。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-11-17T21:45:29.717

我认为最大的区别是 Spring-WS***只是***“合同优先”，而我相信 CXF 通常是“合同最后”。

[http://static.springsource.org/spring-ws/sites/1.5/reference/html/why-contract-first.html](http://static.springsource.org/spring-ws/sites/1.5/reference/html/why-contract-first.html)

Contract-last 从 Java 代码开始，因此通常更容易上手。

但是，它创建的 WSDL 往往更脆弱。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-11-18T06:10:30.650

我们有使用[CXF的经验，它是](http://cxf.apache.org/)[XFire](http://xfire.codehaus.org/)的前身，我可以推荐它作为可靠、快速（WS 创建和执行）和可靠的框架。

关于您可以使用 CXF 遇到的问题，请参阅我的帖子[https://stackoverflow.com/questions/289977/recommended-framework-for-java-web-services#290205](https://stackoverflow.com/questions/289977/recommended-framework-for-java-web-services#290205) 我同意[工具包](https://stackoverflow.com/users/3295/toolkit)，框架之间的最大区别是意识形态上：什么是第一个代码（即接口）或合约（即wsdl）。在此处查看一些详细信息：

*   [Spring Web Services 和 Java 的最佳实践](http://www.ddj.com/architect/201802027)
*   [Spring WS 教程](http://static.springsource.org/spring-ws/site/reference/html/tutorial.html)
*   [Spring Web 服务 1.5 中的新增功能](http://blog.springsource.com/2008/03/28/whats-new-in-spring-web-services-15/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-05T13:10:22.180

Another option to consider in this comparison is [Enunciate](http://enunciate.webcohesion.com/).

Especially if you like to start with Java first.

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-09-30T04:17:11.707

请查看相关帖子：[使用 Spring-WS 构建 Web 服务](http://justcompiled.blogspot.com/2010/09/building-web-service-with-spring-ws.html)

# perl - 为什么 Perl 5 的函数原型不好？

> ID：297034
> 
> 赞同：118
> 
> 时间：2008-11-17T21:37:57.877
> 
> 标签：perl, function, prototype

在[另一个 Stack Overflow 问题中，](https://stackoverflow.com/questions/204467/is-there-a-perl-function-to-turn-a-string-into-a-regexp-to-use-that-string-as-p) [Leon Timmermans](https://stackoverflow.com/users/4727/leon-timmermans)断言：

> 我建议你不要使用原型。它们有它们的用途，但在大多数情况下不是，而且绝对不是在这种情况下。

为什么这可能是真的（或其他）？我几乎总是为我的 Perl 函数提供原型，而且我以前从未见过其他人说使用它们不好。

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-11-17T22:54:09.940

如果使用得当，原型还不错。困难在于 Perl 的原型并不像人们通常期望的那样工作。具有其他编程语言背景的人倾向于期望原型提供一种机制来检查函数调用是否正确：也就是说，它们具有正确数量和类型的参数。Perl 的原型并不适合这项任务。*滥用*是不好的。Perl 的原型有一个独特且非常不同的目的：

**原型允许您定义行为类似于内置函数的函数。**

*   括号是可选的。
*   上下文被强加于论点。

例如，您可以定义这样的函数：

```
sub mypush(\@@) { ... } 
```

并将其称为

```
mypush @array, 1, 2, 3; 
```

无需编写`\`即可引用数组。

简而言之，原型让您可以创建自己的语法糖。例如 Moose 框架使用它们来模拟更典型的 OO 语法。

这非常有用，但原型非常有限：

*   它们必须在编译时可见。
*   它们可以被绕过。
*   将上下文传播到参数可能会导致意外行为。
*   它们会使使用严格规定形式以外的任何形式调用函数变得困难。

有关所有血腥细节，请参阅perlsub 中的[原型](http://perldoc.perl.org/perlsub.html#Prototypes)。

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2008-11-17T21:55:27.937

问题是 Perl 的函数原型并不像人们认为的那样做。它们的目的是允许您编写将像 Perl 的内置函数一样被解析的函数。

首先，方法调用完全忽略原型。如果你在做 OO 编程，你的方法有什么原型并不重要。（所以他们不应该有任何原型。）

其次，原型没有严格执行。如果用 调用子例程`&function(...)`，原型将被忽略。所以它们并没有真正提供任何类型安全。

第三，它们是令人毛骨悚然的远距离动作。（特别是`$`原型，它导致在标量上下文中评估相应的参数，而不是默认的列表上下文。）

特别是，它们使从数组传递参数变得困难。例如：

```
my @array = qw(a b c);

foo(@array);
foo(@array[0..1]);
foo($array[0], $array[1], $array[2]);

sub foo ($;$$) { print "@_\n" }

foo(@array);
foo(@array[0..1]);
foo($array[0], $array[1], $array[2]); 
```

印刷：

```
a b c
a b
a b c
3
b
a b c 
```

以及 3 个关于`main::foo() called too early to check prototype`（如果启用了警告）的警告。问题是在标量上下文中评估的数组（或数组切片）返回数组的长度。

如果您需要编写一个像内置函数一样的函数，请使用原型。否则，不要使用原型。

注意：Perl 6 将有完全改进和非常有用的原型。此答案仅适用于 Perl 5。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-11-18T17:26:45.980

我同意以上两张海报。一般来说，`$`应该避免使用。原型仅在使用块参数 ( `&`)、glob ( `*`) 或引用原型 ( `\@`, `\$`, `\%`, `\*`)时有用

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-04-24T15:29:46.090

有些人在查看 Perl 子例程原型时，认为它的含义并非如此：

```
sub some_sub ($$) { ... } 
```

对于 Perl，这意味着解析器需要两个参数。这是 Perl 让您创建行为类似于内置程序的子程序的方式，所有这些程序都知道从后续代码中可以期待什么。[你可以在perlsub](http://perldoc.perl.org/perlsub.html#Prototypes)中阅读原型

如果不阅读文档，人们会猜测原型指的是运行时参数检查或他们在其他语言中看到的类似内容。就像人们猜测 Perl 的大多数事情一样，事实证明他们是错误的。

然而，从 Perl v5.20 开始，Perl 有一个特性，在我写这篇文章时是实验性的，它提供的东西更像用户的期望和什么。Perl 的[子程序签名](http://www.effectiveperlprogramming.com/2015/04/use-v5-20-subroutine-signatures/)确实运行时参数计数、变量分配和默认设置：

```
use v5.20;
use feature qw(signatures);
no warnings qw(experimental::signatures);

animals( 'Buster', 'Nikki', 'Godzilla' );

sub animals ($cat, $dog, $lizard = 'Default reptile') { 
    say "The cat is $cat";
    say "The dog is $dog";
    say "The lizard is $lizard";
    } 
```

如果您正在考虑原型，这可能是您想要的功能。

# c# - 非基于比较的排序问题的排序算法？

> ID：297035
> 
> 赞同：17
> 
> 时间：2008-11-17T21:38:08.190
> 
> 标签：c#, algorithm, sorting, comparison, mathematical-optimization

我目前面临一个困难的排序问题。我有一组事件需要相互排序（[比较排序](http://en.wikipedia.org/wiki/Comparison_sort)）以及它们在列表中的相对位置。

用最简单的术语来说，我有一个事件列表，每个事件都有一个优先级（整数）、一个持续时间（秒）和事件可以出现在列表中的最早发生时间。我需要根据优先级对事件进行排序，但在其最早发生时间之前，列表中不能出现任何事件。这是一个（希望）使其更清晰的示例：

```
// Psuedo C# code
class Event { int priority; double duration; double earliestTime ; }

void Example()
{
    Event a = new Event { priority = 1, duration = 4.0, earliestTime = 0.0 };
    Event b = new Event { priority = 2, duration = 5.0, earliestTime = 6.0 };
    Event c = new Event { priority = 3, duration = 3.0, earliestTime = 0.0 };
    Event d = new Event { priority = 4, duration = 2.0, earliestTime = 0.0 };

    // assume list starts at 0.0 seconds
    List<Event> results = Sort( new List<Event> { a, b, c, d } );

    assert( results[ 0 ] == a ); // 4.0 seconds elapsed
    assert( results[ 1 ] == c ); // 7.0 seconds elapsed
    assert( results[ 2 ] == b ); // 12.0 seconds elapsed
    assert( results[ 3 ] == d ); // 14.0 seconds elapsed
} 
```

项目“b”必须排在最后，因为它不允许在进入列表的 6.0 秒后开始，所以它被推迟并且“c”在“b”之前出现，即使它的优先级较低。（希望上面能解释我的问题，如果没有让我知道，我会编辑它。）

我目前的想法是使用[插入排序](http://en.wikipedia.org/wiki/Insertion_sort)来管理排序过程。与许多其他常见的排序算法不同，插入排序一次一个地决定列表的顺序。因此，对于每个索引，我应该能够找到满足其最早发生时间的下一个最低优先级事件。

我希望找到有关排序算法和数据结构的资源，以帮助我为这种“排序”问题设计一个好的解决方案。我真正的问题实际上比这更复杂：分层排序、事件之间的可变缓冲区、多个非常量时间限制，所以信息或想法越多越好。速度和空间并不是真正的问题。排序的准确性和代码的可维护性是一个问题。

**编辑：**澄清（基于评论）

*   事件消耗它们的整个持续时间（即不允许事件重叠）
*   事件**必须**在其最早时间或之后发生，它们不能在其最早时间之前发生。
*   如果存在较低优先级的事件，事件可能会晚于它们的 earlyTime
*   事件不能被打断
*   最长持续时间是可以放入列表中的所有事件的总和。这在上面没有显示。（实际上所有事件的持续时间将远远大于时间列表的最大持续时间。）
*   不能有任何空隙。（没有孔可以尝试回填。）

**编辑：**回答

虽然 David Nehme 给出了我选择的答案，但我想指出他的答案本质上是插入排序，其他几个人提供了插入排序类型的答案。这向我证实了专门的插入排序可能是要走的路。感谢大家的回答。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-17T21:49:16.433

这实际上不仅仅是一个排序问题。这是一个发布日期的单机调度问题。根据您要执行的操作，问题可能是 NP-Hard。例如，如果您试图最小化完成时间的加权和（权重与优先级成反比），则问题被[归类](http://www.lix.polytechnique.fr/~durr/query/search.php?a1=1&a2=%3B&a4=%3B&a3=&b1=r_i&b3=&b7=&b4=&b5=&b6=&b8=&c=sum+w_iC_i&problem=1|r_i|sum+w_iC_i)为

```
1|ri;pmtn|Σ wiCi 
```

并且是 NP 难的。关于这个主题有很多[论文](http://www-math.mit.edu/~goemans/GoemansQSSW-2002-SingleMachineSchedulingWithReleaseDates.pdf)，但它可能比你需要的要多。

在您的情况下，您永远不需要有间隙的解决方案，因此您可能只需要做一个简单的离散事件模拟（ O(n log(n)) ）时间。您需要将released_jobs 存储为优先级队列。

```
unreleased_jobs = jobs  // sorted list of jobs, by release date
released_jobs = {}      // priority queue of jobs, by priority
scheduled_jobs = {}     // simple list
while (!unreleased_jobs.empty() || !released_jobs.empty()) {

    while (unreleased_jobs.top().earliestTime  <= t) {
        released_jobs.push(unreleased_jobs.pop())
    }
    if (!released_jobs.empty()) {
       next_job = released_jobs.pop();
       scheduled_jobs.push_back(next_job)
       t = t + next_job.duration
    } else {
       // we have a gap
       t = unreleased_jobs.top().earliestTime
    }
} 
```

一个问题是，您可能有一个低优先级的作业，其发布时间刚好在一个短的、高优先级的作业之前，但它会生成一个具有没有间隙的属性的日程表（如果没有间隔的日程表是可能的） .

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T22:04:03.457

我认为：

1.  按优先级排序任务
2.  将任务放入时间线中，在其最早时间之后占用第一个可用时间段，该时间段有一个足够大的孔来完成任务。

将时间线转换为任务列表，然后等待（对于间隙）。

问题：

1.  允许间隙吗？
2.  任务可以拆分吗？
3.  鉴于问题中的任务：延迟 b 完成 c 更好，还是执行 d 以便 b 可以按时开始？

编辑：

我的问题的答案是：

1.  不（ish - 如果没有什么可运行的，我想我们可能会有差距）
2.  不
3.  仍然不清楚，但我猜这个例子建议运行 c 和延迟 b。

在这种情况下，算法可能是：

1.  按优先级排序
2.  为当前的“时间”保留一个计数器，从 t=0 开始
3.  在排序列表中搜索可以在 t 开始的最高优先级项目。
4.  将项目添加到运行订单，并将其持续时间添加到 t。
5.  重复 3&4 直到列表用完。如果在 t 时刻没有可运行的任务，并且还有待处理的任务，则在运行顺序中粘贴一个 1 秒的睡眠任务。

这个算法也是O(n^2)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T21:48:00.477

换句话说，您想在制定两个约束（强：最早执行点，弱：优先级）的同时优化整体运行时间？这称为[约束满足问题](http://en.wikipedia.org/wiki/Constraint_satisfaction_problem)。这类问题有专门的求解器。

顺便说一句，jakber 的解决方案不起作用。即使没有持续时间，以下示例显然也会失败：

```
event a (priority = 1, start = 5)
event b (priority = 2, start = 0) 
```

排序后的序列是`a`，`b`而想要的结果肯定是`b`，`a`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T21:43:39.457

我认为您应该对列表进行两次排序：首先按优先级，然后按最早时间，使用任何**稳定**的排序算法，例如插入排序。这样时间就会增加，并且每次事情都会按优先级排序。

除非您看到我看不到的东西，否则您可以完全忽略每个事件的持续时间以进行排序。

[http://en.wikipedia.org/wiki/Category:Stable_sorts](http://en.wikipedia.org/wiki/Category:Stable_sorts)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T21:56:27.013

听起来您确实确实想要基于比较的排序。您的排序键是 {earliestTime, priority}，按此顺序。由于您的示例是伪 C#，我将给您一个伪 C# 解决方案：

```
class Event : IComparable<Event>, IComparable{
    int    priority;
    double duration;
    double earliestTime;

    public int CompareTo(Event other){
        if(other == null)
            return 1; /* define: non-null > null */

        int cmp = earliestTime.CompareTo(other.earliestTime);
        if(cmp != 0)
            return cmp;

        /* earliestTimes were equal, so move on to next comparison */
        return priority.CompareTo(other.priority);
    }

   int IComparable.CompareTo(object other){ /* for compatibility with non-generic collections */
       if(other == null)
            return 1; /* define: non-null > null */

       Event e_other = other as Event;
       if(e_other == null) /* must have been some other type */
           throw new ArgumentException("Must be an Event", "other");

       return CompareTo(e_other); /* forward to strongly-typed implementation */
   }
} 
```

现在您的列表将按照您的断言所期望的那样排序。

**编辑**：

我最初的假设是事件将从列表中挑选出来并移交给一个单独的线程，以便队列管理器可以按时触发下一个事件，但是从我收到的评论中，我知道也许一种方法是单线程，但仍然允许更高优先级的事件尽可能接近其开始时间触发，这是更可取的。在这种情况下，`CompareTo`函数应更改如下：

```
public int CompareTo(Event other){
    if(other == null)
        return 1; /* define: non-null > null */

    int cmp = priority.CompareTo(other.priority);

    if(cmp == 0)
        /*
         * calculate and compare the time each event will be late
         * if the other one were to start first.  This time may be
         * negative if starting one will not make the other one late
         */
        return (earliestTime + duration - other.earliestTime).CompareTo(
            other.earliestTime + other.duration - earliestTime);

    /*
     * they're different priorities. if the lower-priority event
     * (presume that greater priority index means lower priority,
     * e.g. priority 4 is "lower" priority than priority 1), would
     * would make the higher-priority event late, then order the
     * higher-priority one first.  Otherwise, just order them by
     * earliestTime.
     */
    if(cmp < 0){/* this one is higher priority */
        if(earliestTime <= other.earliestTime)
            /* this one must start first */
            return -1;

        if(other.earliestTime + other.duration <= earliestTime)
            /* the lower-priority event would not make this one late */
            return 1;

        return -1;
    }

    /* this one is lower priority */
    if(other.earliestTime <= earliestTime)
        /* the other one must start first */
        return 1;

    if(earliestTime + duration <= other.earliestTime)
        /* this event will not make the higher-priority one late */
        return -1;

    return 1;
} 
```

针对任何假设进行测试，但我认为这是我们正在寻找的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T22:02:54.317

如果您有一组有限的优先级，您可以保留一组按时间排序的列表，每个级别 1 个。每当您需要下一个事件时，请按优先级顺序检查每个列表的头部，直到找到一个开始时间已过的事件。（在您检查时跟踪最短开始时间 - 如果还没有活动准备好，您知道要等待哪个活动）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-17T22:12:13.533

顺便说一句，在最一般的情况下，可能没有解决方案（除非允许有间隙，正如 Douglas 指出的那样）。例如：

```
Event a = new Event { priority = 1, duration = 1.0, earliestTime = 4.0 };
Event b = new Event { priority = 2, duration = 1.0, earliestTime = 4.0 };
Event c = new Event { priority = 3, duration = 1.0, earliestTime = 4.0 };
Event d = new Event { priority = 4, duration = 1.0, earliestTime = 4.0 }; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-17T22:40:20.387

我不完全确定我理解你的问题的复杂性，但我的直觉告诉我你需要定义优先级和开始时间之间的关系。这个例子是：

```
Event a = new Event { priority = 1, duration = 4.0, earliestTime = 1.0 };
Event b = new Event { priority = 2, duration = 5.0, earliestTime = 0.0 }; 
```

那么，我们是继续从`b`时间 = 0 开始，还是等待一个滴答声然后开始`a`，因为它的优先级更高？假设有更多的事件具有更多的优先级和更长的时间权衡。我认为你需要一个规则，“如果下一个事件的优先级更高，并且间隔（现在和最早的时间之间）小于 Y 秒，等待然后启动更高优先级的事件。否则启动低优先级事件（从而推回高优先级的事件）”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-17T23:39:28.240

这是 Douglas 的回答中的一些 Python 代码。首先我们按优先级排序，然后我们以选择排序方式拟合时间线：

```
#!/usr/bin/env python
MIN_PRIORITY = 100

class Event(object):
    def __init__(self, name, priority, duration, earliestTime):
        self.name = name
        self.priority = priority
        self.duration = duration
        self.earliestTime = earliestTime
    def __str__(self):
        return "%-10s:  P %3d  D %3.1f  T %3.1f" % (self.name, self.priority, self.duration, self.earliestTime)

def sortEvents(_events):
    def comparePriority(event1, event2):
        if event1.priority < event2.priority: return -1
        if event1.priority > event2.priority: return 1
        return 0

    # Get a copy of the events and sort by priority
    events = [e for e in _events]
    events.sort(cmp=comparePriority)

    # Select one event at a time, checking for compatibility with elapsed time
    elapsedTime = 0.0
    sortedEvents = []
    while events:
        minGap = events[0].earliestTime - elapsedTime
        for e in events:
            currentGap = e.earliestTime - elapsedTime
            if currentGap < minGap:
                minGap = currentGap
            if currentGap <= 0.0:
                sortedEvents.append(e)
                elapsedTime += e.duration
                events.remove(e)
                break

        # If none of the events fits, add a suitable gap
        if minGap > 0:
            sortedEvents.append( Event("gap", MIN_PRIORITY, minGap, elapsedTime) )
            elapsedTime += minGap
    return sortedEvents

if __name__ == "__main__":
    #e1 = Event("event1", 1, 1.0, 4.0)
    #e2 = Event("event2", 2, 1.0, 6.0)
    #e3 = Event("event3", 3, 1.0, 8.0)
    #e4 = Event("event4", 4, 1.0, 10.0)

    e1 = Event("event1", 1, 4.0, 0.0)
    e2 = Event("event2", 2, 5.0, 6.0)
    e3 = Event("event3", 3, 3.0, 0.0)
    e4 = Event("event4", 4, 2.0, 0.0)

    events = [e1, e2, e3, e4]

    print "Before:"
    for event in events: print event
    sortedEvents = sortEvents(events)
    print "\nAfter:"
    for event in sortedEvents: print event 
```

# php - 使用 PHP 和 cronjob 备份一个巨大的 MySQL 表

> ID：297038
> 
> 赞同：4
> 
> 时间：2008-11-17T21:39:27.000
> 
> 标签：php, mysql, backup, cron

我正在开发我们数据库的常规转储。我正在使用[这个脚本](http://davidwalsh.name/backup-mysql-database-php)来创建备份，然后通过常规的 cron 作业提供它。最后，我们得到一个文本文件以及所有内容的电子邮件存档。

我们遇到的问题是我们的两张桌子的大小。他们每个人都有 60k 个字段并且每天都在增长。我认为增量备份是备份的最佳解决方案，但如果要恢复它......这将是一个巨大的项目。

我的问题是两个部分：

a) 有没有更直接的方法来每天备份大表，如果没有，

b) 有没有一种简单的方法可以从每日/每周增量备份中恢复备份？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-18T04:37:20.247

您可能希望查看[Maatkit](http://www.maatkit.org/)。这是一堆 perl 脚本。其中之一是 mk-parallel-dump，它生成 mysqldump 的多个副本（默认情况下，机器中的每个 CPU 1 个）允许转储更快地*进行*。就像 Daniel 建议的那样，您也可以在 cron 作业中进行设置。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-17T21:44:40.033

您可以使用 crob 作业执行 mysqldump 以将要备份的表转储下来。然后只需对该文件使用差异备份进行每日备份，并每周进行一次完整备份。备份的繁重工作应由您选择的备份引擎完成。

恢复数据库从来都不是一件有趣的事，所以无论如何这将是一个大项目。

[http://dev.mysql.com/doc/refman/5.0/en/mysqldump.html](http://dev.mysql.com/doc/refman/5.0/en/mysqldump.html)

让我知道这是否适合您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T17:03:35.043

考虑使用 LVM 快照对数据源进行定期快照，然后在快照副本上使用 maatkit 以存储 SQL 转储。在从属 MySQL 数据库上执行此操作，以便您的备份不会导致您的实时平台出现性能问题。

# database-design - 确定用户是否查看过数据的最佳方法

> ID：297048
> 
> 赞同：2
> 
> 时间：2008-11-17T21:42:34.577
> 
> 标签：database-design

确定用户是否查看过数据的最佳方法是什么，例如评论的更新。我想到的两个解决方案是这些......

1.  使用一个单独的表，其中每个用户都有一行，以及上次查看项目时正在查看和插入的数据 id。

2.  使用同一个表并在项目更改时为每个用户添加一行，并在用户实际查看数据时删除该行。

两种方法都解决了问题，但在解决方案 2 中，表的最大行数最多等于解决方案 1，没有人查看任何内容，最多有 0 行，所有内容都已查看。我知道在解决方案 2 中，您无法确定何时查看它。

想法？

编辑：我以评论的更新为例。在实际应用中，不会期望新用户查看或读取旧数据。这对他们来说毫无意义，因为他们刚刚加入。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T21:49:04.157

它必须是选项1：

**表 1（注释）**

*   comment_id
*   评论

**表 2 (comment_view)**

*   comment_id
*   用户身份

选项 2 将不起作用，因为每个**新**用户都会将所有现有评论“标记为已读”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T21:50:31.440

您是否需要知道他们何时或查看了多少次数据？

如果不是，我会为更新的数据保留一个带有 FK 的表，并为用户保留一个 FK。然后简单检查他们是否查看过：

```
select count(*) from DataAlerts where dataid = 1 and userid = 1 
```

更新数据时插入数据和用户的记录。

当用户查看时删除该用户。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T21:54:14.007

选项 1 是这里更好的方法 - 通常，删除某些内容以表明发生了某些事情是在数据库中做事的一种奇怪方式，并且正如 ng.mangine 上面指出的那样，它甚至不起作用（除非您向其中添加行每次有新用户时使用表，但这几乎肯定会成为瓶颈和性能问题 - 考虑一下当您有一百万条评论和新用户加入时会发生什么）。

选项 1 更清晰；仅在遇到性能问题时才考虑更改它（或者如果您事先知道您的流量将需要更优化的策略，例如每个主题上的位向量代表每个系统用户的已读/未读）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T22:03:50.213

选项 2 是一种*不寻常*的做事方式，在数据库世界中这是一种说法，但它*可能*最好采用更传统的方法，例如选项 1。

# java - 将 Class[] 转换为泛型？

> ID：297063
> 
> 赞同：2
> 
> 时间：2008-11-17T21:45:47.970
> 
> 标签：java, generics

我仍在尝试使用 Java 的泛型。使用类型化集合我完全没有问题，但其余的大部分似乎都让我无法理解。

现在我正在尝试使用 JUnit“PrivateAccessor”，它需要一个 Class[] 参数，其中包含被调用的私有方法的所有参数类型的列表。在 Java 1.4 中，我将其定义为

```
Class[] args = new Class[] { Collection.class, ArrayList.class }; 
```

但实际代码被定义为现在采用参数

```
myMethod(Collection<MyClass1> first, ArrayList<MyClass2> second) 
```

我试图将 args 的定义更改为

```
Class<? extends Object>[] args = new Class<? extends Object>[] 
{ Collection<MyClass1>.class, ArrayList<MyClass2>.class }; 
```

但是 Eclipse 在结束的 >s 上放置了一个红色标记，并表示此时它正在等待“void”。我可以使用泛型来做到这一点，还是不应该打扰？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-17T22:17:41.743

您遇到的第一个问题是您应该使用

```
Class<?>[] args = new Class[] 
```

代替

```
Class<? extends Object>[] args = new Class<? extends Object>[] 
```

[这就](http://www.angelikalanger.com/GenericsFAQ/FAQSections/ParameterizedTypes.html#FAQ104)解释了为什么。

你的第二个问题是你应该使用

```
{ Collection.class, ArrayList.class }; 
```

代替

```
{ Collection<MyClass1>.class, ArrayList<MyClass2>.class }; 
```

这是因为 XXX.class 在运行时评估，在执行[类型擦除](http://www.angelikalanger.com/GenericsFAQ/FAQSections/ParameterizedTypes.html#FAQ005)之后，所以指定类型参数是无用的，因此被禁止。

我强烈推荐[常见问题解答](http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html)，我从中链接了上面的两个解释，以便对 Java 泛型进行“世俗”的理解，这将澄清大多数问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T22:10:27.670

这是正确的语法：

```
Class<?>[] paramTypes = new Class[]{ Collection.class, ArrayList.class }; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T00:06:40.947

您可能想阅读[Angelika 的常见问题解答](http://www.angelikalanger.com/GenericsFAQ/FAQSections/ParameterizedTypes.html#Can%20I%20create%20an%20array%20whose%20component%20type%20is%20a%20concrete%20instantiation%20of%20a%20parameterized%20type?)，以获得更多关于为什么不允许创建具体参数化类型的数组的解释。

yc

# wpf - 使用 WPF 工具包 DatePicker 作为 ObjectDataProvider 的参数，用作 itemssource

> ID：297064
> 
> 赞同：3
> 
> 时间：2008-11-17T21:45:56.207
> 
> 标签：wpf, data-binding

这个我打败了；

我有一个带有两个（对于这种情况很重要）控件的 WPF 窗口，它们都来自 CodePlex 提供的 WPF 工具包；一个 DatePicker 和一个 DataGrid。

此窗口的 DataContext 设置为一个 CLR 对象，该对象具有所需的所有信息。这个 CLR 对象有一个大的数据列表，以及一个名为 GetDataForDate( DateTime date ) 的方法，它决定我们将看到哪个日期的数据。

如何创建数据网格可以绑定到的 ObjectDataProvider（我认为这将是正确的解决方案），它提供对使用 DatePicker 的选定日期作为参数调用的 GetDataForDate() 返回的数据的访问？

换句话说，我希望用户使用日期选择器来选择一个日期，并且每当日期更改以反映正确的数据时，网格应该会自动更新。

我必须做什么样的黑魔法才能实现这样的事情 - 我猜这应该是一个相对常见的数据绑定场景？

提前致谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-24T23:45:53.343

这是我的完整代码。我希望这将有所帮助。

xml代码：

```
<Window x:Class="DataGridSort.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dg="clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit"
    xmlns:System="clr-namespace:System;assembly=mscorlib"
    Title="Window1" Height="413" Width="727"
        x:Name="_this">
    <Window.Resources>
        <ObjectDataProvider ObjectInstance="_this.DataContext"
                            MethodName="GetFromDate"
                            x:Key="odp">
            <ObjectDataProvider.MethodParameters>
                <System:DateTime>2008-01-01</System:DateTime>  
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <dg:DatePicker Grid.Row="0" x:Name="dtpSource" >
            <dg:DatePicker.SelectedDate>
                <Binding Source="{StaticResource odp}"
                         Path="MethodParameters[0]"   
                             BindsDirectlyToSource="True" 
                             Mode="OneWayToSource"/>
            </dg:DatePicker.SelectedDate>
        </dg:DatePicker>

        <dg:DataGrid x:Name="dtgGrid"
                          ItemsSource="{Binding Source={StaticResource odp}}"
                          AutoGenerateColumns="True"
                          Grid.Row="1"/>
    </Grid>
</Window> 
```

后面的代码：

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();

        LoadData();
    }

    protected void LoadData()
    {
        DataContext = new Data();
        ObjectDataProvider odp = this.Resources["odp"] as ObjectDataProvider;

        odp.ObjectInstance = DataContext;
    }
} 
```

和业务对象：

```
public class DataItem
{
    public string Name { get; set; }
    public int BirthYear { get; set; }
}

public class Data
{
    private readonly List<DataItem> data;

    public Data()
    {
        data = new List<DataItem>();
        data.Add(new DataItem { Name = "John", BirthYear = 2007 });
        data.Add(new DataItem { Name = "Mike", BirthYear = 2007 });
        data.Add(new DataItem { Name = "Aaron", BirthYear = 2006 });
        data.Add(new DataItem { Name = "Bill", BirthYear = 2006 });
        data.Add(new DataItem { Name = "Steven", BirthYear = 2005 });
        data.Add(new DataItem { Name = "George", BirthYear = 2004 });
        data.Add(new DataItem { Name = "Britany", BirthYear = 2004 });
    }

    public List<DataItem> GetFromDate(DateTime dt)
    {
        return this.data.Where(d => d.BirthYear == dt.Year).ToList();
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T22:24:05.380

您可以在 DatePicker.SelectedDate 属性上设置 OneWayToSource 绑定，将文本值推送到 ObjectDataProvider MethodParameter。

首先创建 ObjectDataProvider：

```
 <ObjectDataProvider ObjectType="{x:Type theObjectType}" 
                        MethodName="GetDataForDate"
                        x:Key="odp">
        <ObjectDataProvider.MethodParameters>
            <System:DateTime>2008-01-01</System:DateTime>  
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider> 
```

然后将 DatePicker 的 SelectedDate 属性绑定到 ObjectDataProvider：

```
<dg:DatePicker x:Name="datePicker" >
    <dg:DatePicker.SelectedDate>
        <Binding Source="{StaticResource odp}"
                 Path="MethodParameters[0]"   
                     BindsDirectlyToSource="True" 
                     Mode="OneWayToSource"/>
    </dg:DatePicker.SelectedDate>
</dg:DatePicker> 
```

最后将 ObjectDataProvider 绑定到您的 ObjectDataProvider：

```
<dg:DataGrid x:Name="dtgGrid"
             ItemsSource="{Binding Source={StaticResource odp}}"
             AutoGenerateColumns="False"/> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T15:37:40.367

我们应该注意的一件事是 DatePicker 的 SelectedDate 属性返回一个可为空的 DateTime（这意味着：DateTime? 而不仅仅是 DateTime）。我提出这个问题的原因是，如果您的方法签名包含简单的 DateTime，WPF 将返回如 Rune Jacobsen 所示的错误，因为它找不到正确的方法签名。

！好文章顺便说一句

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-13T00:02:56.833

如果您像这样使用 INotifyPropertyChanged 构建您的课程：

```
public class MyDataObject : INotifyPropertyChanged
{
    private DateTime _SelectedDate;
    public DateTime SelectedDate
    {
        get
        {
            return _SelectedDate;
        }
        set
        {
            _SelectedDate = value;
            NotifyPropertyChanged("SelectedDate");
            GetDataForDate();
        }
    }

    private ObservableCollection<YourDataType> _Data;
    public ObservableCollection<YourDataType> Data
    {
        get
        {
            return _Data;
        }
        set
        {
            _Data = value;
            NotifyPropertyChanged("Data");
        }
    }

    public void GetDataForDate()
    {
        // Your code here to fill the Data object with your data
    }

    #region INotifyPropertyChanged Members

    public event PropertyChangedEventHandler PropertyChanged;

    private void NotifyPropertyChanged(string propertyName)
    {
        if (this.PropertyChanged != null)
            this.PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
    }

    #endregion
} 
```

然后您可以在 XAML 中创建您的 ObjectDataProvider 并直接绑定到它。在您的资源中：

```
<ObjectDataProvider x:Key="MyDataSource" ObjectType="{x:Type local:MyDataObject}" /> 
```

然后绑定：

```
<DockPanel>
    <toolkit:DatePicker SelectedDate="{Binding Path=SelectedDate, Mode=Default, Source={StaticResource MyDataSource}}"/>
    <toolkit:DataGrid ItemsSource="{Binding Path=Data, Mode=Default, Source={StaticResource MyDataSource}}"/>
</DockPanel> 
```

# c# - 是否可以将工作流参数与 WorkflowServiceHost 托管的工作流一起使用？

> ID：297068
> 
> 赞同：0
> 
> 时间：2008-11-17T21:46:40.700
> 
> 标签：c#, .net, workflow-foundation

通常，将工作流参数传递给工作流的方法发生在对 RunWorkflow 的调用中。但是，对于 WorkflowServiceHost，不涉及此类方法调用。您只需在实例上调用 Open() 方法。有任何想法吗？

当然，言下之意是我在服务契约中增加了更多的参数，但这些参数与服务的消费者无关。它们更像是配置值。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-17T22:51:33.703

我相信 WorkflowServiceHost 是为您包装的 WorkflowRuntime 的重新托管，而不是与它相关联的参数的真正活动。通常，您定义要与 ReceiveActivity 一起使用的数据协定，并且该协定的数据成员代表您将在工作流中使用的参数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T15:23:37.470

到目前为止，我已经确定在某些情况下这是可能的。如果工作流由主机启动，则可以传递参数。但是，如果 ReceiveActivity 导致创建工作流（CanCreateInstance 设置为 True），那么您似乎不能。

# java - 如何在 Java 中生成音效？

> ID：297070
> 
> 赞同：16
> 
> 时间：2008-11-17T21:47:08.093
> 
> 标签：java, audio

我正在寻找可用于在运行时生成声音的 Java 代码——而不是播放现有的声音文件。

例如，在 440 Hz 下生成持续 2 毫秒的锯齿波形的最佳代码是什么？**源代码赞赏！**

我记得我的 Commodore 128 有一个简单的声音命令，它将声音、频率、波形和持续时间作为参数来定义声音。这在很多简单的情况下（快速而肮脏的游戏，声音实验等）都非常有效。

我正在寻找类似声音的音效，而不是音乐或 MIDI（[JFugue](http://www.jfugue.org)库很好地涵盖了这些）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2012-08-15T17:58:00.403

这是一个可能有帮助的示例。这会产生正弦波：

```
package notegenerator;

import java.io.IOException;

/**
 * Tone generator and player.
 * 
 * @author Cesar Vezga vcesar@yahoo.com
 */
public class Main {

public static void main(String[] args) throws IOException {

    Player player = new Player();

    player.play(BeachRock.getTack1(),BeachRock.getTack2());

}

 } 
```

* * *

```
 package notegenerator;

 public class BeachRock {

// GUITAR
static String gs1 = "T332 A4-E4 F#5-C6 E5-A5 T166 G5 A5 F#5 A5 F5 A5 E5-A5 E3 G3 G#3 ";
static String gs2 = "A3 A3 A3 G3 E3 E3 G3 G#3 ";
static String gs3 = "A3 A3 A3 G3 E3 A3 C4 C#4 ";
static String gs4 = gs2 + gs2 + gs2 + gs3;
static String gs5 = "D4 D4 D4 C4 A3 A3 C4 D#4 ";
static String gs6 = "D4 D4 D4 C4 A3 E3 G3 G#3 ";
static String gs7 = gs4 + gs5 + gs6 + gs2 + "A3 A3 A3 G3 E3 B3 D3 D#3 ";
static String gs8 = "E4 E4 E4 D4 B3 B3 E4 B3 " + gs6 + gs2;
static String gs9 = "x E3-B3 E3-B3 E3-B3 E3-B3 E3 G3 G#3 ";
static String gs10 = gs7 + gs8 + gs9;
static String gs11 = "A3-D4 X*7 X*16 X*5 E3 G3 G#3 ";
static String guitar = gs1 + gs10 + gs11 + gs10 + gs11 + "A3 A3 A3";

// DRUMS
static String ds1 = "D2 X D3 D3 X*2 D3 X ";
static String ds2 = "D2 X D3 D3 X D3 D3 D3 ";
static String ds3 = "D2 D3 D3 D3 D3 T83 D3 D3 T166 D3 ";
static String ds4 = ds1 + ds1 + ds1 + ds2;
static String ds5 = ds1 + ds1 + ds1 + ds3;
static String ds6 = "D2*2 D3 D3 X*2 D3*2 ";
static String ds7 = "D2*2 D3 D3 X D3 D3 D3 ";
static String ds8 = ds6 + ds6 + ds6 + ds7;

static String drums = "V25 T166 X*16 " + ds4 + ds4 + ds5 + ds8 + ds4 + ds4
        + ds5 + ds8;

public static String getTack1(){
    return guitar;
}

public static String getTack2(){
    return drums;
}

} 
```

* * *

```
package notegenerator;

import java.util.HashMap;

/**
 * 
 * Physics of Music - Notes
 * 
 * Frequencies for equal-tempered scale
 * This table created using A4 = 440 Hz
 * Speed of sound = 345 m/s = 1130 ft/s = 770 miles/hr
 *  
 *  ("Middle C" is C4 )
 * 
 * http://www.phy.mtu.edu/~suits/notefreqs.html
 * 
 * @author Cesar Vezga <vcesar@yahoo.com>
 *
 */
 public class Notes {

private static final Object[] notes = {
"C0",16.35,
"C#0/Db0",17.32,
"D0",18.35,
"D#0/Eb0",19.45,
"E0",20.6,
"F0",21.83,
"F#0/Gb0",23.12,
"G0",24.5,
"G#0/Ab0",25.96,
"A0",27.5,
"A#0/Bb0",29.14,
"B0",30.87,
"C1",32.7,
"C#1/Db1",34.65,
"D1",36.71,
"D#1/Eb1",38.89,
"E1",41.2,
"F1",43.65,
"F#1/Gb1",46.25,
"G1",49.00,
"G#1/Ab1",51.91,
"A1",55.00,
"A#1/Bb1",58.27,
"B1",61.74,
"C2",65.41,
"C#2/Db2",69.3,
"D2",73.42,
"D#2/Eb2",77.78,
"E2",82.41,
"F2",87.31,
"F#2/Gb2",92.5,
"G2",98.00,
"G#2/Ab2",103.83,
"A2",110.00,
"A#2/Bb2",116.54,
"B2",123.47,
"C3",130.81,
"C#3/Db3",138.59,
"D3",146.83,
"D#3/Eb3",155.56,
"E3",164.81,
"F3",174.61,
"F#3/Gb3",185.00,
"G3",196.00,
"G#3/Ab3",207.65,
"A3",220.00,
"A#3/Bb3",233.08,
"B3",246.94,
"C4",261.63, // Middle C
"C#4/Db4",277.18,
"D4",293.66,
"D#4/Eb4",311.13,
"E4",329.63,
"F4",349.23,
"F#4/Gb4",369.99,
"G4",392.00,
"G#4/Ab4",415.3,
"A4",440.00,
"A#4/Bb4",466.16,
"B4",493.88,
"C5",523.25,
"C#5/Db5",554.37,
"D5",587.33,
"D#5/Eb5",622.25,
"E5",659.26,
"F5",698.46,
"F#5/Gb5",739.99,
"G5",783.99,
"G#5/Ab5",830.61,
"A5",880.00,
"A#5/Bb5",932.33,
"B5",987.77,
"C6",1046.5,
"C#6/Db6",1108.73,
"D6",1174.66,
"D#6/Eb6",1244.51,
"E6",1318.51,
"F6",1396.91,
"F#6/Gb6",1479.98,
"G6",1567.98,
"G#6/Ab6",1661.22,
"A6",1760.00,
"A#6/Bb6",1864.66,
"B6",1975.53,
"C7",2093.00,
"C#7/Db7",2217.46,
"D7",2349.32,
"D#7/Eb7",2489.02,
"E7",2637.02,
"F7",2793.83,
"F#7/Gb7",2959.96,
"G7",3135.96,
"G#7/Ab7",3322.44,
"A7",3520.00,
"A#7/Bb7",3729.31,
"B7",3951.07,
"C8",4186.01,
"C#8/Db8",4434.92,
"D8",4698.64,
"D#8/Eb8",4978.03

};

private HashMap<String,Double> noteMap;

public Notes(){
    noteMap = new HashMap<String,Double>();
    for(int i=0; i<notes.length; i=i+2){
        String name = (String)notes[i];
        double freq = (Double)notes[i+1];
        String[] keys = name.split("/");
        for(String key : keys){
            noteMap.put(key,  freq);
            System.out.println(key);
        }
    }
}

public byte[] getCordData(String keys, double duration){
    int N = (int) (8000 * duration/1000);
    byte[] a = new byte[N+1];
    String[] key = keys.split(" ");
    int count=0;
    for(String k : key){
        double freq = getFrequency(k);
        byte[] tone = tone(freq,duration);
            if(count==0){
               a = tone;
            }else{
               a = addWaves(a,tone);
            }
        count++;
    }

    return a;
}

public byte[] addWaves(byte[] a, byte[] b){
    int len = Math.max(a.length, b.length);
    byte[] c = new byte[len];
    for(int i=0; i<c.length; i++){
        byte aa = ( i < a.length ? a[i] : 0);
        byte bb = ( i < b.length ? b[i] : 0);

           c[i] = (byte) (( aa + bb ) / 2);
    }
    return c;
}

public double getFrequency(String key){
    Double f = noteMap.get(key);
    if(f==null){
        System.out.println("Key not found. "+key);
        f = 0D;
    }
    return f;
}

public byte[] tone(String key, double duration) {
    double freq = getFrequency(key);

    return tone(freq,duration); 
 } 

 public byte[] tone(double hz, double duration) {
        int N = (int) (8000 * duration/1000);
        byte[] a = new byte[N+1];
        for (int i = 0; i <= N; i++) {
            a[i] = (byte) ( Math.sin(2 * Math.PI * i * hz / 8000) * 127 );
        }
        return a; 
 } 

} 
```

* * *

```
package notegenerator;

import java.io.ByteArrayOutputStream;
import java.io.FileOutputStream;
import java.io.IOException;

import javax.sound.sampled.AudioFormat;
import javax.sound.sampled.AudioSystem;
import javax.sound.sampled.DataLine;
import javax.sound.sampled.LineUnavailableException;
import javax.sound.sampled.SourceDataLine;

public class Player {

private SourceDataLine line = null;

private Notes notes = new Notes();

private long time = 250;

private double volumen = 1;

public void play(String keys) {

    byte[] data = parse(keys);

    start();

    line.write(data, 0, data.length);

    stop();

}

public void play(String... track) {

    byte[] data2 = parseAll(track);

    if (data2 != null) {
        start();

        line.write(data2, 0, data2.length);

        stop();
    }

}

private byte[] parseAll(String... track) {

    byte[] data2 = null;

    for (String t : track) {
        byte[] data1 = parse(t);
        if (data2 == null) {
            data2 = data1;
        } else {
            data2 = notes.addWaves(data1, data2);
        }
    }

    return data2;

}

private byte[] parse(String song) {
    time = 250;

    volumen = 1;

    ByteArrayOutputStream baos = new ByteArrayOutputStream();

    String[] key = song.split(" ");

    byte[] data = null;

    for (String k : key) {
        int mult = 1;

        if (k.indexOf("*") > -1) {
            String keyAux = k.split("\\*")[0];
            mult = Integer.parseInt(k.split("\\*")[1]);
            k = keyAux;
        } else if (k.startsWith("T")) {
            time = Long.parseLong(k.substring(1));
            continue;
        } else if (k.startsWith("V")) {
            volumen =  Double.parseDouble(k.substring(1)) / 100;

            if(volumen>1) volumen = 1;
            if(volumen<0) volumen = 0;

            continue;
        }

        if (k.indexOf("-") > -1) {
            k = k.replaceAll("-", " ").trim();
            data = notes.getCordData(k, time * mult);
        } else {
            data = notes.tone(k, time * mult);
        }

        volumen(data);

        try {
            baos.write(data);
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }

    }

    return baos.toByteArray();

}

private void volumen(byte[] data) {
    for(int i=0; i<data.length; i++){
        data[i] = (byte) (data[i] * volumen);
    }

}

private void stop() {
    line.drain();
    line.stop();

}

private void start() {

    AudioFormat format = new AudioFormat(8000.0F, 8, 1, true, false);

    SourceDataLine.Info info = new DataLine.Info(SourceDataLine.class,
            format); // format
    // is
    // an
    // AudioFormat
    // object
    if (!AudioSystem.isLineSupported(info)) {
        System.out.println("Format not supported");
        System.exit(1);
    }

    // Obtain and open the line.
    try {
        line = (SourceDataLine) AudioSystem.getLine(info);
        line.open(format);
    } catch (LineUnavailableException ex) {
        ex.printStackTrace();
    }

    // Assume that the TargetDataLine, line, has already
    // been obtained and opened.
    int numBytesRead;

    line.start();

}

public void save(String track, String fname) throws IOException {
    byte[] data = parse(track);

    FileOutputStream fos = new FileOutputStream(fname);

    fos.write(data);
    fos.flush();
    fos.close();

}

} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T22:07:01.787

您可以轻松地在 Java 中生成采样声音数据并在不使用本机代码的情况下播放它。如果你在谈论 MIDI，事情可能会变得棘手，但我还没有涉足那个领域。

要生成采样的声音数据，您必须将过程倒退。我们将像 A-to-D 一样工作，并随着时间的推移对连续的声音函数进行采样。您的声卡通过麦克风或线路输入对音频执行相同的操作。

首先，选择一个采样率（不是我们生成的音调的频率）。让我们使用 44100 赫兹，因为这可能是声卡播放速率（因此没有采样率转换，除非硬件这样做，否则这并不容易）。

```
// in hz, number of samples in one second
sampleRate = 44100

// this is the time BETWEEN Samples
samplePeriod = 1.0 / sampleRate

// 2ms
duration = 0.002;
durationInSamples = Math.ceil(duration * sampleRate);

time = 0;
for(int i = 0; i < durationInSamples; i++)
{
  // sample a sine wave at 440 hertz at each time tick
  // substitute a function that generates a sawtooth as a function of time / freq
  // rawOutput[i] = function_of_time(other_relevant_info, time);
  rawOutput[i] = Math.sin(2 * Math.PI * 440 * time);
  time += samplePeriod;
}

// now you can playback the rawOutput
// streaming this may be trickier 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-17T22:50:10.913

[Java 媒体框架](http://java.sun.com/javase/technologies/desktop/media/jmf/index.jsp)两者兼而有之。您可以播放录制的声音或使用 MIDI 接口合成您自己的声音和音乐。它还提供了一个混音器 API。

当然，如果您知道要播放的波形的详细信息，则可以定期对该函数“采样”，并将生成的样本传递给播放 API，就好像它是预先录制的声音文件一样。

JMF 不是由 Sun 积极维护的，但有适用于各种平台的有效发行版。

我的第一台电脑是 Commodore 64，我记得在抽出其 SID 芯片时为恐惧而哭泣的“每个人都想统治世界”。我不知道[这个纯 Java SID 模拟器](http://dreamfabric.com/c64/jsidplay/impl.php)是否是开源的，但它可能会为您提供一些关于实现更高级别的 Attack-Decay-Sustain-Release 和波形功能的指导。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T22:15:53.447

您想要的可能不是声音 API，而是某种合成器代码，我很确定您需要比 Java 允许的更多低级声音驱动程序控制（它是一种通常在“沙箱”中运行的解释语言）。

但好消息是，在 google 上快速搜索“ [java sound synthesizing](http://www.google.com/search?q=java+sound+synthesizing) ”会发现一个名为[JSyn](http://www.softsynth.com/jsyn/)的插件，它使用本地 C 方法（我猜这是一种方法）来生成声音。它似乎可以免费用于非商业用途，也可以在商业许可证中使用。:)

# asp.net - AJAX 方法调用中的 RegisterClientScriptBlock

> ID：297081
> 
> 赞同：9
> 
> 时间：2008-11-17T21:49:34.173
> 
> 标签：asp.net, asp.net-ajax

我正在尝试在仅通过 AJAX 调用调用的方法中注册客户端脚本块。它似乎并没有真正在页面上注册脚本，我猜这是因为它实际上并没有重新加载整个页面。有没有办法从 ajax 方法调用中在页面上注册 javascript？

```
 protected void MyMethod(object sender, EventArgs e)
    {
        // This method only called via AJAX call

        Page.ClientScript.RegisterClientScriptBlock(Page.GetType(), "resize", "alert('here');", true);
    } 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-17T23:03:51.370

对于启用 AJAX 的页面，您应该使用 ScriptManager 来注册脚本：

```
ScriptManager.RegisterClientScriptBlock(Page, typeof(MyPage), 
    "MyScript", "GoStuff()", true) 
```

您可以使用它来注册所有脚本（原始加载、回发、AJAX 回发）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-08T19:38:43.070

如果您`UpdatePanel`在 AJAX 回调中指定要更新，它会起作用。例如：

```
ScriptManager.RegisterClientScriptBlock(UpdatePanelMain, typeof(UpdatePanel),
   UpdatePanelMain.ClientID,
   "document.getElementById('imgLoading').style.display = 'none';" +
   "document.getElementById('divMultiView').style.display = 'inline';",
   true); 
```

第一个参数中的控件必须在触发更新的更新面板或更新面板本身内。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T22:32:27.533

据我所知，您将被迫通过 PostBack 而不是 ajax 调用来调用此方法。可能有其他方法可以做到这一点，但 Page.ClientScript 不可能......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T20:22:12.897

通常，在将元素 innerHTML 附加到包含此类脚本的块后加载外部 javascript 时，需要评估（评估）脚本以使其正常工作并将其自身呈现到当前加载的文档中。

我建议执行以下操作：

使用外部工具，例如[YUI get 实用程序，它应该可以启用这种行为，或者](http://developer.yahoo.com/yui/get/)[像这样](http://www.experts-exchange.com/Programming/Languages/Scripting/JavaScript/Q_23214126.html)自己对脚本进行一些评估

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-05T18:50:14.297

如果还有其他人像我一样，并且接受的答案仍然对您不起作用，那么请不要再犹豫了。

[***查看此链接***](http://www.c-sharpcorner.com/uploadfile/mahesh/webmsgbox09082006110929am/webmsgbox.aspx)- 一个简单的类，无论您是否在页面加载、卸载、AJAX 请求等，都会弹出 Javascript 警报：

```
WebMsgBox.Show("Your message here"); 
```

# visual-studio - 团队建设现在非常缓慢

> ID：297084
> 
> 赞同：7
> 
> 时间：2008-11-17T21:51:47.757
> 
> 标签：visual-studio, tfs, msbuild, tfsbuild

我们在实施 Team Foundation Build Server 时遇到了性能问题，我对如何加快速度没有任何想法。我们已经添加了一些 PropertyGroup 元素来提高几个步骤的性能（SkipClean、SkipLabel、SkipInitializeWorkspace），但我认为我们需要进行重大重组来解决问题。这是我们的设置：

*   我们有大约 40 个 Web 应用程序，每个应用程序都非常不同，但运行的是一堆共享程序集
*   这些 Web 应用程序中的每一个都有自己的解决方案；
*   这些 Web 应用程序中的每一个都引用了大约 10 到 25 个共享程序集；
*   存在一个构建定义，其中包含在每次签入主干时触发的所有解决方案；

这是我们遇到的基本问题

*   在构建期间，它将构建每个共享程序集的引用次数，而不是构建一次并为每个应用程序使用
*   放置目录的文件复制时间非常慢。它必须通过网络共享并且不会采用本地路径。
*   每隔这么多构建，一个或多个输出文件就会“锁定”并导致构建中断，即使编译正常。
*   还有一件事——我也尝试过单独的构建定义，但这样做也会强制在获取最新版本上获取另一个工作区。我更希望构建服务器包含一个版本的主干来构建。

在过去的几个月里，我们已经屈服于嗜睡并忽略了这个问题，但现在构建时间是一个多小时到一个半小时。

我正在玩弄学习和切换到巡航控制的想法，以获得更好的控制。有人不同意吗？

非常感谢任何帮助。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T13:05:17.047

所以这就是我所做的，我已经把构建时间缩短到了 9 分钟。对于我正在编译的项目数量，我很好。

*   创建了一个包含所有共享库和所有网站的解决方案。这一步有很多额外的工作，因为我必须修复一堆遗留代码或存储在多个地方的引用。
*   最终节省最多时间的是执行文件系统*移动*，而不是所有输出文件的网络副本。由于我们的放置位置实际上位于构建服务器上，因此这是有道理的。

要执行移动，我只需覆盖 TFSBuild.proj 文件中的 CoreDropBuild 目标：

```
<Target Name="CoreDropBuild"
        Condition=" '$(SkipDropBuild)'!='true' and '$(IsDesktopBuild)'!='true' "
        DependsOnTargets="$(CoreDropBuildDependsOn)" >
             <Exec Command="move $(BinariesRoot)\Release d:\BuildOutput\$(BuildNumber)\Release"/>    
</Target> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T20:23:15.047

首先，听起来好像您的所有 Web 应用程序都包含在同一个团队项目中。如果这是真的，请将它们分成逻辑分组。通常，单个团队项目应包含单个部署模型。

其次，将共享程序集拆分为他们自己的团队项目。移动后，您有几个选择，您可以将源或编译的 DLL 分支到需要它们的团队项目。他们可以有自己的单元测试，如果您愿意，您可以扩展团队构建以自动合并成功的测试。

总而言之，您需要简化构建策略。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T22:04:52.360

您真的需要在每个 Web 应用程序中构建所有内容吗？如果共享程序集没有改变，为什么要一遍又一遍地构建它们？

这里有一个想法：

1.  让每个 Web 应用程序都有自己的 \lib 文件夹。
2.  将每个共享程序集放在 lib 文件夹中。
3.  让 Web 应用仅引用其本地 lib 文件夹中的共享程序集。
4.  检查一切。

现在，除非发生更改，否则不应开始构建，并且构建将不包括共享程序集。

*   应该有一个包含所有共享程序集的中央文件夹。
*   此处的任何更改都应传播到所有本地 \lib 文件夹。
*   最后，任何共享程序集在发生更改时都应复制到中央文件夹。

这里的想法是让一个共享的程序集项目只知道中央文件夹。这将简化复制构建所需的任何构建后操作。

必须以这样一种方式管理中央文件夹，以便将任何更改复制到所有引用的 Web 应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T22:23:02.030

Speaking from personal experience on the CruiseControl suggestion - remember it's a continuous integration "framework". It won't solve all your problems out of the box (componentized builds, firing on each component change, and serialized builds though will make things a lot better). It'll take quite some configuration (and maybe even customization) to get things how you want, so be prepared to invest some time. Of course, you'll reap a massive payoff in the long run if your build time gets right down - if you can't ignore the problem any more, it's worth investing some time on a better CI solution.

Be aware though that any CI effort is only as good as the policies you have in place. We had huge policy voids when it came to version labeling, releasing, dependencies, beta releases of binaries, archiving builds... and many other issues that we didn't even consider at the time.

Also, be prepared to dedicate at least some resources to maintaining the thing. It's not a full-time job (and I for one love doing it, since it produces continual process improvement). Our customizations have taken us from a 2 hour monolithic build of our first product to over 400 components in 20 products that build in parallel on multiple machines within about 20 minutes, so it's well worth it.

# c++ - 是否有适用于 Windows 的“Google 测试”( gtest ) 的图形测试运行程序？

> ID：297085
> 
> 赞同：26
> 
> 时间：2008-11-17T21:52:03.963
> 
> 标签：c++, googletest

似乎是一个很棒的 C++ 单元测试框架。我只是想要一些比控制台输出更复杂的东西来运行测试，也让运行特定测试变得非常容易（因为 gtest 支持各种测试过滤）

如果什么都没有，我可能会自己动手

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-05-24T22:25:46.513

我打开了一个谷歌代码项目，将 UI 添加到谷歌测试。在 Windows 和 Unix 上运行。它不是任何 IDE 设计的插件——我不想束缚自己。相反，您可以在后台打开它，并在您想运行时按“开始”按钮。

在撰写本文时，V1.2.1 已经发布，邀请您试一试。

[https://github.com/opspector/gtest-gbar](https://github.com/ospector/gtest-gbar)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-18T02:17:50.247

根据项目所有者的说法，[没有](http://groups.google.com/group/googletestframework/browse_thread/thread/af01d964d65c2144). 如果您确实在做一个工作，请发布到项目[组](http://groups.google.com/group/googletestframework)。我敢肯定那里有一些人愿意提供帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-09-30T19:46:14.067

Industrial Logic 有一个 Eclipse 插件，用于运行和显示 gtest 的结果。更新站点是[http://plugins.industriallogic.com/gtest/](http://plugins.industriallogic.com/gtest)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-03-27T21:29:31.340

[GTest Runner](https://github.com/nholthaus/gtest-runner)是我为 Windows 和 linux 制作的独立 UI，它监视磁盘上 gtest 可执行文件的更改，并在测试发生更改时自动重新运行测试，即当您构建它们时。

它有一些很酷的过滤和排序功能，即使它没有绑定到任何 IDE，双击故障将打开 IDE，文件类型关联并将故障行号复制到剪贴板。对于大多数 IDE，这将允许快速 CTRL-G + CTRL-V 将您带到测试失败的行。

它还在每个测试运行时提供进度条（多个可以在各自的线程中完成），并将控制台输出重定向到停靠栏，这样您就可以看到原始 gtest 输出和 GUI-fied xml。

*完全披露：我是 GTest Runner 的作者。*

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-19T14:40:31.140

这仅解决了查看问题，但 gtest 可以生成符合 JUnit 的 XML 报告。从那里应该可以将它输入到测试运行器中：

[https://github.com/google/googletest/blob/master/googletest/docs/advanced.md#generating-an-xml-report](https://github.com/google/googletest/blob/master/googletest/docs/advanced.md#generating-an-xml-report)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-10-30T14:16:03.343

对于 Visual Studio 2012，有一个用于 Google 测试的测试适配器。这意味着它与 Visual Studio 测试资源管理器集成：[Google 测试适配器](http://visualstudiogallery.msdn.microsoft.com/f00c0f72-ac71-4c80-bf8b-6fe381548031?SRC=VSIDE)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-08-23T10:39:54.213

似乎不再可用的工业逻辑插件基于可爱的 eclipse 插件：[http](http://r2.ifs.hsr.ch/cute/) ://r2.ifs.hsr.ch/cute/ 。

我认为适应它应该是最小的努力。用于解析命令行的原始插件。使用上面建议的 XML 报告将使您更快地到达那里...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-04-06T21:35:17.600

很久以前就在项目跟踪器上为此打开了一个功能请求。 [http://code.google.com/p/googletest/issues/detail?id=40](http://code.google.com/p/googletest/issues/detail?id=40)

随意贡献;）或至少投票支持它。

# asp.net-mvc - 在 ASP.NET MVC“gridview”中实现删除的最佳方法？

> ID：297097
> 
> 赞同：1
> 
> 时间：2008-11-17T21:56:37.450
> 
> 标签：asp.net-mvc

给定一个使用“for”循环生成条目表的 ASP.NET MVC 视图，为每个表行添加“删除”链接的最佳方法是什么？我的第一个直觉是使用 jQuery 进行 AJAX 调用以删除行，然后刷新表。似乎应该有一个更简单的方法。也许让链接执行到删除 url（例如 /Item/Delete/1）的帖子，这将重定向回显示项目的页面？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T21:59:59.377

两者都是可接受的方式，实际上完全相同。

首先，您使用 AJAX 发布到 URL 并使用 AJAX 刷新表。第二，您没有使用 AJAX。

无论哪种方式，将要删除的 id 发布到 delete ActionMethod （我会使用 Destroy，但这是个人喜好）是要走的路。

为了让它更好地做这样的事情......

```
[AcceptVerbs(HttpVerbs.Delete)]
    public ActionResult Detail (int id)
    {
        // Add action logic here

    } 
```

# cocoa - Core Data 中的错误处理

> ID：297101
> 
> 赞同：4
> 
> 时间：2008-11-17T21:57:24.797
> 
> 标签：cocoa, core-data, error-handling

几周前，我第一次在一个重要的应用程序中使用 Core Data。让我感到惊讶和困惑的一件事是错误处理的工作原理。举个例子，我尝试的第一件事就是在 Finder 中将我的数据文件设置为“锁定”，以确保在设置文件 URL 时正确处理引用返回的 NSError 对象。令我惊讶的是，持久存储协调器没有返回 nil 并设置 NSError，而是从底层 NSData 引发了一个未捕获的异常！

同时，有时在 Core Data 中错误处理似乎有点不必要。例如，我看不出任何明显的原因，为什么 fetch 请求需要除程序员错误之外的错误处理（顺便说一下，根据我的经验，这也会引发异常）。在这些情况下，我一直在为 NSError 引用指针传递 NULL。

在 try/catch 块和 NSError 之间，我可能会花很多时间编写代码来安抚 Core Data，但我希望对此更加实用，所以我不会花时间在永远不会运行的错误代码上。考虑到这一点，您如何处理应用程序中的错误处理？你在现实世界中看到了哪些你应该确保解释的错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T23:34:18.203

自 1.4 以来，Apple 一直采用的错误处理方向是 NSError 用于应用程序应该知道的错误（如您上面所说的错误）和编程错误的异常（永远不会通过 QA）。

通常，您应该牢记这些准则进行编程。当你发现这样的问题时，你现在可以根据你发现的实际结果编写一个处理程序，但你也应该立即向 Apple 发布错误报告，因为这种模式与他们采用的模式相反。

您可以将错误报告发布到[http://bugreport.apple.com/](http://bugreport.apple.com/)。您将需要一个 ADC 帐户，但您可以使用免费帐户发布错误报告。我发现他们对开发工具包中的错误和此类问题非常敏感，其中框架的行为与他们声明的设计模式相矛盾。

# jsp - 使用 ServletUnit 测试 JSP 的示例

> ID：297111
> 
> 赞同：3
> 
> 时间：2008-11-17T22:03:13.177
> 
> 标签：jsp, servletunit

谁能给我举个例子来说明如何使用 ServletUnit 来测试 JSP 的？我需要调用 registerServlet() 吗？如果是这样，我应该通过什么类名？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-25T17:06:45.113

如果要使用默认的 Jasper 编译器，则不需要 registerServlet。但是，我需要 Jasper 罐子及其对 CLASSPATH 的依赖项。我需要获得一个基本的 JSP 来编译和渲染的 Maven 依赖项是：

```
<dependency>
  <groupId>tomcat</groupId>
  <artifactId>jasper</artifactId>
  <version>3.3.2</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>tomcat</groupId>
  <artifactId>jasper-compiler</artifactId>
  <version>5.5.23</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>tomcat</groupId>
  <artifactId>tomcat-util</artifactId>
  <version>5.5.23</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>tomcat</groupId>
  <artifactId>core_util</artifactId>
  <version>3.3.2</version>
  <scope>test</scope>
</dependency> 
```

我被困在一个JDK1.4项目中，所以你也许可以使用更新的版本。我还没有让标准的taglib工作......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-05-09T13:13:10.687

这就是我现在用来测试 JSP 渲染和验证表单和转发的东西。

第一个 Maven 依赖项

```
 <!--  Testing JSP -->
<dependency>
  <groupId>net.sourceforge.openutils</groupId>
  <artifactId>openutils-testing4web</artifactId>
  <version>1.2.1</version>
  <scope>test</scope>
  <exclusions>
    <exclusion>
      <artifactId>slf4j-log4j12</artifactId>
      <groupId>org.slf4j</groupId>
    </exclusion>
    <exclusion>
      <artifactId>spring-core</artifactId>
      <groupId>org.springframework</groupId>
    </exclusion>
    <exclusion>
      <artifactId>spring-context</artifactId>
      <groupId>org.springframework</groupId>
    </exclusion>
    <exclusion>
      <artifactId>slf4j-api</artifactId>
      <groupId>org.slf4j</groupId>
    </exclusion>
    <exclusion>
      <artifactId>jcl-over-slf4j</artifactId>
      <groupId>org.slf4j</groupId>
    </exclusion>
    <exclusion>
      <artifactId>jsp-api</artifactId>
      <groupId>javax.servlet</groupId>
    </exclusion>
    <exclusion>
      <artifactId>jasper-runtime</artifactId>
      <groupId>tomcat</groupId>
    </exclusion>
    <exclusion>
      <artifactId>jasper-compiler</artifactId>
      <groupId>tomcat</groupId>
    </exclusion>
    <exclusion>
      <artifactId>jasper-compiler-jdt</artifactId>
      <groupId>tomcat</groupId>
    </exclusion>
  </exclusions>
</dependency>
<dependency>
  <groupId>org.apache.tomcat</groupId>
  <artifactId>catalina</artifactId>
  <version>${tomcat.version}</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>org.apache.tomcat</groupId>
  <artifactId>servlet-api</artifactId>
  <version>${tomcat.version}</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>org.apache.tomcat</groupId>
  <artifactId>jasper</artifactId>
  <version>${tomcat.version}</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>org.apache.tomcat</groupId>
  <artifactId>jasper-el</artifactId>
  <version>${tomcat.version}</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>org.apache.tomcat</groupId>
  <artifactId>jsp-api</artifactId>
  <version>${tomcat.version}</version>
  <scope>provided</scope>
</dependency>
<dependency>
  <groupId>javax.servlet</groupId>
  <artifactId>javax.servlet-api</artifactId>
  <version>${javax.servlet.version}</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>org.apache.tomcat</groupId>
  <artifactId>jasper-jdt</artifactId>
  <version>6.0.29</version>
  <scope>test</scope>
</dependency>
<!-- log configuration --> 
```

tomcat.version 是 6.0.39，你可以随意尝试现代的 tomcat 版本，7 或 8 但要关心依赖关系有时会变得有点模糊。

javax.servlet.version 是 3.0.1

接下来我定义了一个通用测试类，我的所有测试都对它进行了扩展。我每个控制器都有一个测试类。

```
 import it.openutils.testing.junit.AbstractDbUnitJunitSpringContextTests;
import org.junit.After;
import org.junit.Before;
import org.junit.runner.RunWith;
import org.springframework.core.io.Resource;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.TestExecutionListeners;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.context.support.DependencyInjectionTestExecutionListener;
import org.springframework.test.context.support.DirtiesContextTestExecutionListener;
import org.springframework.test.context.transaction.TransactionalTestExecutionListener;
import org.springframework.transaction.annotation.Transactional;

import com.meterware.servletunit.ServletRunner;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = { "/integration/application-database-test.xml", "/integration/mvc-dispatcher-servlet-test.xml" })
@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class, DirtiesContextTestExecutionListener.class, TransactionalTestExecutionListener.class })
public abstract class ControllerIntegrationCommonTest extends AbstractDbUnitJunitSpringContextTests
{

  /**
   * The Web CLient for JSP rendeting Test
   */

  protected ServletRunner servletRunner;

  /**
   * @throws java.lang.Exception
   */
  @Before
  public void setUp() throws Exception
  {
    Resource web = this.applicationContext.getResource("/WEB-INF/web.xml");
    if (servletRunner == null)
    {
      servletRunner = new ServletRunner(web.getFile(),null);
    }
  }

  @After
  public void setDown() throws Exception
  {
    servletRunner.shutDown();
  }

} 
```

@ContextConfiguration, @TestExecutionListeners 如果你想从 Spring Junit 上下文中运行它是必需的，如果你删除那么你会得到一个很好的 java.lang.IllegalStateException : Failed to load ApplicationConext。

请注意，我使用 Web.xml 实例化了 ServletRunner。这当然是强制性的，与我的制作非常相似。第二个参数 contextPath 设置为 Null。对于我的测试，我不需要。我向您[推荐 API](http://httpunit.sourceforge.net/doc/api/com/meterware/servletunit/ServletRunner.html)以获取更完整的信息。

配置完成后，让测试变得简单。我添加示例：

```
PostMethodWebRequest webRequest = new PostMethodWebRequest("http://myserver/setup/checkXML",true);
  webRequest.setParameter("param1", "11112");
  File file = new File("src/test/resources/datasets/myxml.xml");
  webRequest.selectFile("fileData",file,"multipart/form-data");

  WebResponse webResponse = servletRunner.getResponse(webRequest);

  assertNotNull(webResponse);
  assertTrue(webResponse.getURL().getPath().contains("checkXML"));
  assertNotNull(webResponse.getElementsByTagName("resultCheck"));
  log.debug(" ----------------- ");
  log.debug(webResponse.getText());
  log.debug(" ----------------- ");
  webResponse.getFormWithID("resultsForm").getSubmitButtons()[0].click(); 
```

在此示例中，我将创建一个上传文件的帖子。您需要创建 PostMethodWebRequest，并将参数 mimeencoded 设置为 true。如果不是，您将收到一些有趣的错误消息。添加文件只使用了方法。您可以在 API 中看到您可以上传一个文件或一组文件。

最后一个示例仅用于 make Get 请求

```
 GetMethodWebRequest webRequest = new GetMethodWebRequest("http://myserver/setup/addarea");
  webRequest.setParameter("param", "11");

  WebResponse webResponse = servletRunner.getResponse(webRequest);

  assertNotNull(webResponse);
  assertTrue(webResponse.getURL().getPath().contains("addsomething"));
  assertNotNull(webResponse.getElementsByTagName("listofsomething"));
  assertNotNull(webResponse.getElementsByTagName("someelement"));
  log.debug(" ----------------- ");
  log.debug(webResponse.getText());
  log.debug(" ----------------- "); 
```

在这个例子中，我向我的控制器发出了一个 Get 请求。和前面一样，我发送一些参数，然后获取响应。在那里我检查 URL 是否是我所期望的，并验证 JSP 已经呈现了一些元素。

请注意，为了构建 WebRequest，我必须使用格式良好的 URL，但服务器名称没有问题，Servlet Unit 根本不使用它，您无需在任何地方定义。

我希望它对你有帮助。玩得开心！！

# c++ - 如何在 C++ 中使用 python 库？

> ID：297112
> 
> 赞同：10
> 
> 时间：2008-11-17T22:03:24.877
> 
> 标签：c++, python, nltk

我想在 c++中使用[nltk库。](http://nltk.sourceforge.net/index.php/Main_Page)

我可以使用胶水语言/机制来做到这一点吗？

原因：我有一段时间没有用 C++ 做任何认真的编程，并且想同时修改 NLP 概念。

谢谢

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-17T22:13:29.147

虽然从 python 调用 c++ 库更正常 - 您可以通过基本调用 python 解释器并让它执行 python 源代码从 c++ 调用 python 模块。这称为[嵌入](https://docs.python.org/extending/embedding.html)

或者[boost.python](http://www.boost.org/doc/libs/1_37_0/libs/python/doc/index.html)库使它变得非常容易。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-17T22:18:46.327

你也可以试试[Boost.Python](http://www.boost.org/doc/libs/1_37_0/libs/python/doc/index.html)库；哪有[这个能力](http://www.boost.org/doc/libs/1_37_0/libs/python/doc/v2/callbacks.html)。这个库主要用于将 C++ 暴露给 Python，但也可以反过来使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T00:58:43.370

[Pyrex](http://www.cosc.canterbury.ac.nz/greg.ewing/python/Pyrex/)可以干净地用于此目的。源代码版本中有一个[示例](http://www.pysoy.org/changeset/11/branches/pyrex-soy/Demos/embed/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T22:10:08.390

我没有尝试直接从 C++ 调用 Python 函数，但这里有一些替代的想法......

通常，从 Python 等高级语言调用 C++ 代码比反过来更容易。如果您对这种方法感兴趣，那么您可以创建一个 C++ 代码库并从 Python 访问它。您可以直接使用 python 提供的外部 API [它应该在 Python 文档中的某处进行描述]，或者使用 SWIG 之类的工具来自动化 C++ 到 Python 的包装过程。

根据您希望如何使用该库，您也可以使用[exec*](http://www.opengroup.org/onlinepubs/000095399/functions/exec.html)函数创建从 C++ 调用的 Python 脚本。

# c# - 使一种类型适应另一种类型的最佳 OO 实践？

> ID：297116
> 
> 赞同：2
> 
> 时间：2008-11-17T22:04:06.967
> 
> 标签：c#, .net, oop

我有一组域对象，我需要将其转换为另一种类型以供 .NET 框架使用。进行这种转换的最佳做法是什么？

具体来说，我有一个名为 ContentEntry 的类型，我需要将其转换为 SyndicationItem 以用于放入 SyndicationFeed。转换本身很简单，但我正在寻找一个好的模式。我是在 ContentEntry 上创建一个名为 CreateSyndicationItem() 的方法，还是一个单独的转换器对象？也许是一种扩展方法？

这有点主观，但我会欣赏一些想法。

> 编辑说明：我想指出我不控制 SyndicationItem。它内置在 .NET Framework 中。另外，我真的很想一次将几个 ContentEntry 对象转换为 SyndicationItems。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T22:07:41.110

我建议看看[适配器模式](http://en.wikipedia.org/wiki/Adapter_pattern)

> 在计算机编程中，适配器设计模式（通常称为包装器模式或简称为包装器）将类的一个接口转换为兼容接口。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T23:26:48.173

由于无法修改 SyndicationItem 的构造函数，我建议您使用[工厂模式](http://en.wikipedia.org/wiki/Factory_method_pattern)。创建一个具有 CreateSyndicationItem() 方法的 SyndicationItemFactory 类。此方法返回一个 SyndicationItem 对象。在这种情况下，您只需要该方法的一个版本，它将采用 ContentEntry 对象。

当你说你想一次创建多个 ContentEntry 对象时，我假设你说的是一个 ContentEntry 对象数组。另一种方法（比如 CreateSyndicationItems()）可能会返回一个 SyndicationItems 数组，并将一个 ContentEntry 对象数组作为其参数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T22:07:36.477

恕我直言，一个转换一种方式的转换器类，可能是另一种方式是你应该做的。一个类应该有一个目的，例如表示 ContentEntry。添加转换为其提供了第二个目的，因此打破了该面向对象的“规则”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T22:11:02.147

如果你可以通过这两种类型的公共合约进行转换，我强烈推荐一种扩展方法。

另请参见 System.Linq.Enumerable.ToList()、Enumerable.ToDictionary()

推理：

*   您不希望任何一个对象与另一个对象耦合。
*   转换过程本身完成后没有状态可管理（适用于静态方法）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T22:08:27.723

这取决于...您只是想要一种方便的方式来托管转换方法吗？如果您控制一个或两个类，您可以简单地添加一个强制转换运算符重载，这样您就可以将一个类强制转换为另一个类。如果你想让它很明显，你可以做一个显式的操作符

`SyndicationItem item = (SyndicationItem)entry`

# coding-style - 向用户报告进度时如何制作最干净的代码？

> ID：297119
> 
> 赞同：11
> 
> 时间：2008-11-17T22:05:31.847
> 
> 标签：coding-style, progress-bar

在过去的几个月里，我一直在努力想出一些干净的代码来向用户报告进度。一切似乎总是归结为：

```
ReportProgress("Starting Task 1");
doTask1();
ReportProgress("Task 1 is done");

ReportProgress("Starting Task 2");
doTask2();
ReportProgress("Task 2 is done");

//etc... where report progress does some form of output to the user. 
```

我内心的优秀程序员尖叫着“必须有一种更清洁的方式！” 但我很难过。有什么想法吗？

编辑 :: 我正在寻找更多关于架构信息的信息，而不是特定于实现的信息。给出的代码**非常**简单。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-17T22:23:50.157

将您的任务设置为事件流，并让事件处理“引擎”报告进度。如果您想走那么远，每个事件实例都可以有自己的名称、进度报告简介/模板等

如果这是一种经常发生的模式，那么值得为基础设施付出努力。完成后，可用代码可能类似于：

```
EventQueue tasks = new EventQueue();
tasks.Add(new TaskEvent(this.doTask1,"Foo-ing the bar"));
tasks.Add(new TaskEvent(this.doTask2,"Bar-ing the foo"));
tasks.Add(new TaskEvent(this.doTask3,"Glitching and whinging"));
...
tasks.Execute(this.ProgressEventHandler); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T22:11:26.687

您能否使用[Aspect Oriented Programming](http://en.wikipedia.org/wiki/Aspect-oriented_programming)并设计一个 Progress Aspect？

有许多 AOP 实现。在 Java 世界中，最常见的两个是 AspectJ 和 Spring（使用 AspectJ 或基于代理的方面）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-17T22:15:04.340

您可以创建一个具有 name 属性和委托的 Task 类。将每个任务放在一个集合中，然后遍历它，打印消息并为每个任务调用委托。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-17T23:19:09.607

这取决于即时需要多少配置，我希望代码非常通用，并通过 spring 或任何 ioc 容器设置任务。

这一切都在 spring 配置中：xml 配置将为任务对象提供其名称和参数。然后将这些任务添加到一个集合中，并将该集合交给任务运行程序。

然后，任务运行器是指示每个任务的停止和开始的代码，但是每个任务可以自由地给出它如何进行的特定状态。此外，如果出现错误，taskrunner 将捕获任何异常并继续运行。可以配置为某些任务依赖于其他任务的完成，而某些任务在失败时应该停止一切。

我不同意这里应该使用 AOP。矫枉过正。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T22:11:43.660

在 doTask() 调用中进行报告是很自然的。
通常，报告者将是所有对象都向其发送消息的单例，报告者类负责决定是否以及在何处显示它 - 状态栏、日志文件、stderr 等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T22:12:10.147

假设你正在做的模式是：

*   记录任务开始
*   做任务
*   记录任务结束

您可以有一个“任务”类（所有任务的父级），其 do() 方法是子类并自动记录任务的开始和结束。

只是一个想法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-17T22:15:23.917

我不会像那样手动编码显示消息的数字部分（任何时候您需要添加或删除操作或更改顺序，您都需要进行大量的剪切和粘贴操作）。您希望任何处理 ReportProgress 方法的对象在它进行时自动递增。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-17T22:31:53.167

一个相当简单和干净的方法是创建一个具有`do()`方法和抽象 doTask() 和 getName() 方法的抽象类：

```
do() {
    ReportProgress("Starting " + this.getName());
    doTask();
    ReportProgress("Finished " + this.getName());
} 
```

然后在你的任务中：

```
class Task1 extends Task {
    getName(){return "Task 1";}
    doTask() {
        //do stuff here
    }
} 
```

然后你可以有一个任务，它有一个`do()`在一大堆其他任务上运行的 doTask() 方法。这很容易是递归的，因为任何任务都可能运行许多子任务。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-17T22:41:47.420

+1 关于 AOP 建议。这是一个经典的横切关注点，AOP 可以优雅地解决。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-17T22:14:24.497

您可以从 doTask 方法内部调用 ReportProgress，这可能会使它看起来更干净一些，而您只需：

```
doTask1();
doTask2(); 
```

报告将在这些方法中处理。

您可以使用 AOP，但在这种情况下，我的大脑会尖叫 KISS！（保持简单愚蠢）。如果这只是您正在处理的更复杂事物的简单表示，那么 AOP 可能是一种选择。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-17T23:02:25.290

不幸的是，我认为最好的方法确实取决于细节——至少你使用的是什么语言。例如，在 python 中，您可以使用[上下文管理器](http://www.python.org/dev/peps/pep-0343/)来允许编写如下代码：

```
with progress_report("Task 1"):
    do_task_1() 
```

例如，即使 do_task_1() 引发异常，这也可以确保报告“任务 1 已完成”。如果您愿意，您可以单独处理异常并打印不同的内容，例如“Task 1 failed”或“Task 1 aborted”。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-17T23:15:28.663

在我们的工具包中，我们有一个管理任务的任务控制器。任务作为线程运行。除了典型的线程支持外，任务还支持进度方法。一种可能的进度视图是带有标题的可视进度条，该标题指的是任务名称和任务中的步骤。为了支持可见的统计信息和状态，代码必须偶尔调用任务的进度方法。通常，这是在 for 循环中完成的，因为百分比进度可以通过当前索引除以限制来估计。

任务控制器是添加全局线程控制、状态探测、其他统计信息和性能测量挂钩的有用位置。可以通过检查控制器的状态和所有任务的状态来分析一些多线程错误和时序问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-17T23:20:53.597

如果您使用的是 .NET，我建议您使用[Enterprise Library](http://www.codeplex.com/entlib)中的 Policy Injection Application Block （最低版本：3.1）。我使用类似的东西为一个重度模拟的网站做一个“恢复到应用程序池标识”。

你可以对你的任务做同样的事情。您可以简单地定义一个带有工厂的任务类，该工厂使用企业库对象工厂构建对象，并自动向任务添加“之前”和“之后”消息。这将提供您想要的所需的优雅。

玩得开心！

# enterprise-library - MS 企业库的单独配置文件

> ID：297121
> 
> 赞同：2
> 
> 时间：2008-11-17T22:05:58.633
> 
> 标签：enterprise-library

我的 ASP.net web.config 中有一个部分用于企业库日志记录块。是否可以将日志记录配置分离到另一个配置文件中？我怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T22:26:22.913

Yes, it is possible -- in fact, separate config files for each app block was the only way that Enterprise Library 1.0 worked.

Check out [this blog post](http://www.pnpguidance.net/Post/EnterpriseLibraryConfigurationSeparateConfigurationFilesApplicationBlocks.aspx) from David Hayden -- he shows how to set up the configs for each application block in separate files.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T17:56:27.487

Web.config 中的任何部分都可以存在于 Web.config 之外。只需添加一个[configSource 属性](http://msdn.microsoft.com/en-us/library/system.configuration.sectioninformation.configsource.aspx)并指定文件名。这是我们为一个项目所做的示例。

```
<configuration>
  <configSection>
    <section name="microMvc" type="MicroMvc.MvcSection" allowDefinition="MachineToApplication" restartOnExternalChanges="true" />
  </configSection>
  <microMvc configSource="micromvc.config" />
</configuration> 
```

# c++ - 从 C 移植到 C++ 时我应该记住什么

> ID：297122
> 
> 赞同：6
> 
> 时间：2008-11-17T22:06:13.453
> 
> 标签：c++, c, porting

将我的项目从 C 转换为 C++ 时，我应该记住什么？有任何理由使用 C 吗？我现在唯一想到的是确保它对 DLL 友好，以便我可以在需要时创建一个 C 接口。

注意：我知道 C++ 就好了。模板、部分特化、为什么多重继承不好（我只看到过一种正确的用法）等等。我最想知道为什么我会使用 C 而不是 C++。DLL 和脚本语言绑定是原因之一。所以我只需要记住我应该有一个C接口来处理某些事情。还有别的事吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-17T23:14:49.273

冒着明显的风险，我想说要记住的主要事情是不要修复任何没有损坏的东西。

如果你有一个可用的 C 库，并希望它有一个更“C++ ish”的接口，那么将它包装在类中可能比转换它更聪明。当然，这满足了提供对 DLL 友好的 C 接口的要求：保留您已有的接口。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-17T23:16:42.763

作为一名 C 程序员，当 C++ 程序员试图将 C“移植”到 C++ 时，我觉得很烦人。虽然使用 C++ 语言结构有许多优点，但它们并不总是比 C 的简单面向函数的方法有所改进。由于您始终可以通过 获得 C 功能`extern "C"`，因此几乎没有理由更改工作代码。在我从事的项目中，围绕 C 代码创建对象包装器效果很好。这样，核心代码可以在使用任何一种语言的团队之间共享，每个人都可以使用与其环境相匹配的界面。我们甚至将一些 C++ 代码“反向移植”到 C 以鼓励代码重用。

我与几个不同的项目团队一起工作，这些团队使用围绕 C 核心的 C++ 包装器来访问数据库。一些团队使用 C++，而其他团队仅使用 C，但核心功能在团队之间共享。我们正处于维护期，所以即使 C 团队想要移植到 C++ 也是不可行的。我所看到的将 C 转换为 C++ 的尝试导致代码更长、更复杂，但没有更具表现力的代码。YMMV，当然。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-08-09T18:43:06.013

由于我已经将一些**C**项目移植到**C++**中，然后才能传达我的经验：

我猜你真正的意思是“用已经可以正常工作的代码制作类和对象”，当你说你`C`从`C++`. 这可能就是你正在做的事情。我想您想要进行移植的原因是使代码更可重用和可维护。请记住，我假设这是一个中型到大型项目（至少 10000 LOC）。

如果是这样，那么我可以想象你会遇到一些问题，但也是 C++ 中普遍遇到的问题：

## 制作时新引入的错误

```
'OO'** 
```

由于 C 是过程性的，因此它将是对 C++ 中对象意义上的“可重用”的判断调用。有时你可能会发现你最初的观察是不正确的。不是因为您的代码无法编译，而是因为逻辑的执行方式与以前不同。在这种情况下：当您知道您的基本 C++ 对象没有破坏 C 程序的原始预期逻辑时，测试、测试、测试（增量）并在最后使用设计模式进行所有花哨的重构。

## 内存管理问题

C`malloc`和`free`C++ 做非常不同的`new`事情`delete`。你的 C++ 对象分配将在很大程度上取决于你如何重新解释你对 C 代码正在做什么的理解，因此你需要在这两个方面都非常熟练。但最初我会保留 malloc 和 free 调用，并使用 C++ 抽象它们，除非有很好的理由不这样做。因此，一旦创建了类并分配和释放内存，您的应用程序就会发生内存泄漏。这是保证，也是您必须进行增量测试的原因。

## 重构和设计模式

我认为有时这种诱惑会因为继承和设计模式而疯狂，以使代码更加“leet”。尝试在移植开始时抵制这种诱惑，因为设计模式本质上是一种优化代码的方法，使其更高效和可维护，但考虑将 C 代码移植到 C++ 并考虑设计模式和重构和“废话现在它不起作用”和“在我必须改变它之前我使用了错误的设计模式”......正如你所看到的，它很快就会失控，所以一次只专注于做一件事让移植过程中的错误保持畅通无阻，这样您就不会不知所措。

## 全局变量

您将需要划分全局变量并找出限制其范围的位置。尝试通过一次创建一个简单的 C++ 对象来保留 C 代码的含义和功能，而在命名空间、继承、设计模式等方面没有任何花哨的东西。同样，我建议在您的代码转换为类之后做一些事情.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-17T22:40:57.203

You can always include raw C code into a C++ project. So even if you have a C library which somewhat messes with C++, just use `extern "C" {}` for referencing, then call it inside your C++ code.

[https://isocpp.org/wiki/faq/mixing-c-and-cpp](https://isocpp.org/wiki/faq/mixing-c-and-cpp)

It is also perfectly possible to link C object files with C++ object files.

This (link to c++ Super-FAQ) is basically all you know to convert your project to C++ and stay legacy-compatible.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-15T04:56:39.820

> 为什么多重继承不好

嘿，现在。多重继承可能非常好。这很容易被滥用。多继承的一个例子，它很好地继承了几个抽象基类。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T01:12:16.510

> 有任何理由使用 C 吗？

尽管它变得越来越少，但仍然可以找到没有可行的 c++ 编译器的平台。ADI 的 Blackfin 芯片几年前就属于这一类，我不确定现在是否存在像样的芯片。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-17T22:09:08.173

主要问题将是关键字。您是否使用过“new”、“private”、“public”等作为变量名？
除非您针对特定的嵌入式平台或内核模式驱动程序，否则没有必要再将自己限制为“c”。
当然，您不会通过简单地在 c++ 编译器中编写 c 代码来获得 C++ 的所有好处——它需要更多的重新思考！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-17T22:32:42.027

Yes. C code seems to be simpler for smaller projects; LOC-wise and binary-wise.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-17T22:56:07.797

> Is there any reason to use C at all?

C++ code compiles much too slowly for small projects.
A long compilation disturbs the loop: write some code -> test it -> write more code -> test it ...

# sql - 告诉 SQL Server 只缓存某些类型的即席查询的方法

> ID：297124
> 
> 赞同：1
> 
> 时间：2008-11-17T22:06:25.730
> 
> 标签：sql, sql-server

有没有办法告诉 SQL Server 不缓存某些类型的计划？例如，如果您有大量来自 SQL Server Management Studio 的用户查询，有没有办法告诉这些查询不要缓存在计划缓存中，从而占用内存和其他资源？您是否可以进行其他行为调整来防止临时查询占用生产服务器上的资源？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T22:16:23.087

I don't know of any ... but, in general, I think that in most high-performance situations where you'd be worried about this level of detail, you'd probably want a production database that is protected from user-submitted queries in the first place. In production, it's not the little bit of memory for these query plans that will hurt you, it's users submitting queries that issue massive locks and grind your performance to a halt. As a basic architectural issue, you might consider either:

1.  getting a replicated offline server that users can hit with their ad-hoc queries; or
2.  restricting user interactions with the DB to a set of given stored procedures

If you really can't do either of those, and user-submitted query plans are really getting you down, you must be in a pretty unique situation. If you want to edit the question with more details, you might get better suggestions.

(Sorry I didn't answer the question you actually asked; hopefully someone more knowledgeable than me will do so.)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-30T20:31:13.577

您可以通过按照[http://msdn.microsoft.com/en-us/library/cc645587.aspx设置“优化即席工作负载”设置来影响 SQL 服务器如何处理即席查询和计划缓存](http://msdn.microsoft.com/en-us/library/cc645587.aspx)

本质上，它的作用是说“第一次调用即席查询时，不要缓存计划，而是存储已调用此查询的信息。第二次调用相同的即席查询时，该计划将被缓存。

我们在我们的一台生产服务器上设置了它并立即释放了 2 GB 的 RAM，这更多地说明了该服务器的当前工作负载（而不是好东西）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T22:24:29.593

I think it's probably unnecessary to worry about restricting this, but [you can start here](http://www.sqlteam.com/article/what-query-plans-are-in-sql-server-memory) and the discussion [linked there](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=86803)

# batch-file - 使用 .BAT 文件在目录中删除未知文件夹

> ID：297134
> 
> 赞同：5
> 
> 时间：2008-11-17T22:08:46.630
> 
> 标签：batch-file

我有一个文件夹“FolderA”，其中包含三个子文件夹：foldera1、foldera2 和 foldera3

我需要编写一个位于“FolderA”中的批处理文件。它应该删除“FolderA”下的所有文件夹作为清理活动。我不知道文件夹名称。`rmdir`不支持通配符。

有人可以为这个小问题提供解决方案吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T22:12:52.020

就像是 ：

```
for /f %%a in ('dir /ad /b') do (rmdir /S /Q "%%a")
for /d %%a in (*) do (rmdir /S /Q "%%a") 
```

应该做的伎俩。第二种形式允许为目录选择一些通配符。

要在脚本之外测试它，在纯 DOS 会话中：

```
for /f %a in ('dir /ad /b') do (rmdir /S /Q "%a")
for /d %a in (*) do (rmdir /S /Q "%a") 
```

注意**双引号**，以便能够删除带有空格的目录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T22:15:24.120

从命令行：

```
for /D %a in (*) do rd /S /Q %a 
```

在批处理/cmd文件中：

```
for /D %%a in (*) do rd /S /Q %%a 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T22:23:01.530

当您在 FolderA 中时，运行“rmdir /s /q”。

这在“正在使用的文件...”的命令行上显示错误
但是，它会删除其中的目录。

# .net - 在 NAnt 构建脚本中处理密码

> ID：297136
> 
> 赞同：8
> 
> 时间：2008-11-17T22:09:51.760
> 
> 标签：.net, nant, passwords

有没有办法在 NAnt 构建期间提示用户输入？我想执行一个需要密码的命令，但我不想将密码放入构建脚本中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-17T23:00:36.010

我现在正在使用脚本，但我很想知道是否有可用的预构建方法。非常感谢 sundar 的 ForegroundColor 技巧。

我不确定您是使用 Project.Log 还是直接访问 Console.WriteLine() 是否重要，是否有任何 NAnt 忍者想教育我？

这是脚本和使用它的示例目标：

```
<target name="input">
    <script language="C#" prefix="password" >
        <code><![CDATA[
            [Function("ask")]
            public string AskPassword(string prompt) {
                Project.Log(Level.Info, prompt);
                ConsoleColor oldColor = Console.ForegroundColor;
                Console.ForegroundColor = Console.BackgroundColor;
                try
                {
                    return Console.ReadLine();
                }
                finally
                {
                    Console.ForegroundColor = oldColor;
                }
            }
        ]]></code>
    </script>

    <echo message="Password is ${password::ask('What is the password?')}"/>
</target> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-17T22:20:30.723

我多次使用的解决方案是拥有一个*本地*配置文件，其中包含每个开发人员特定的密码、连接字符串等内容。NAnt 构建脚本将在构建时包含这些设置。

版本控制系统中不存在本地配置文件，因此不会暴露密码。开发人员第一次检查代码库并尝试构建时，他必须创建此配置文件。为了方便他，可以有一个可用的模板文件，例如 my.config.template，其中包含所有可以自定义的属性。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-17T22:29:36.773

试试这个 ：

```
<script language="C#" prefix="test" >
          <code>
            <![CDATA[
              [Function("get-password")]
              public static string GetPassword(  ) {
                  Console.WriteLine("Please enter the password");
                  ConsoleColor oldForegroundColor = Console.ForegroundColor;           
             Console.ForegroundColor = Console.BackgroundColor;
                  string password = Console.ReadLine();
             Console.ForegroundColor = oldForegroundColor;
        return password;
              }
            ]]>
          </code>
</script>

<target name="test.password">
 <echo message='${test::get-password()}'/>
</target>

--> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-03-30T10:58:11.683

这会在您键入密码时显示星号：

```
 <code><![CDATA[
        [Function("ask")]
        public string AskPassword(string prompt) {
            Project.Log(Level.Info, prompt);
            string password = "";

            // get the first character of the password
            ConsoleKeyInfo nextKey = Console.ReadKey(true);

            while (nextKey.Key != ConsoleKey.Enter)
            {
                if (nextKey.Key == ConsoleKey.Backspace)
                {
                    if (password.Length > 0)
                    {
                        password = password.Substring(0, password.Length - 1);

                        // erase the last * as well
                        Console.Write(nextKey.KeyChar);
                        Console.Write(" ");
                        Console.Write(nextKey.KeyChar);
                    }
                }
                else
                {
                    password += nextKey.KeyChar;
                    Console.Write("*");
                }

                nextKey = Console.ReadKey(true);
            }

            Console.WriteLine();

            return password;
        }
    ]]></code> 
```

# c# - 如何使用 ASP.Net MVC 制作向导

> ID：297148
> 
> 赞同：47
> 
> 时间：2008-11-17T22:11:51.257
> 
> 标签：c#, .net, asp.net-mvc, wizard

我们的网站有多个“向导”，其中各种数据在多个页面上收集，直到最后一步才能提交到数据库。

用 ASP.Net MVC 制作这样的向导的最佳/正确方法是什么

编辑：我的老板现在说“没有 javascript”——关于如何绕过这个限制的任何想法？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-17T22:29:24.043

我不相信有最好/正确的方法，但我这样做的方式是......

每个向导都有自己的页面。每个步骤都有自己的 div。所有步骤都采用相同的形式。

上一个/下一个按钮本质上会在过程的每个步骤中隐藏/显示 div。最后一步的提交按钮提交整个表单。使用 jQuery 实现这一点非常简单，并且由于所有向导步骤都在单个 ViewPage 中，因此维护起来很容易。

在控制器端，您将有两个控制器方法，HttpVerbs.Get 版本将准备表单以供查看，HttpVerbs.Post 版本将采用 FormsResult 并对其进行解析以获取提交用户答案所需的信息存储/其他过程。

* * *

哇，你的老板很臭。

这个答案几乎适用于禁用 javascript 的 ****** （是的，两者都是）。您可以调整它以通过 CSS 隐藏下一个上一个按钮，并在您的 javascript 代码中取消隐藏它们。这样，使用 javascript 的人会看到向导，而没有 javascript 的人会看到整个表单（没有下一个/上一个按钮）。

另一个选项是为向导中的每个步骤创建一个视图。您可以将表单的中间结果存储在 Session 中。这种方式会花费大量的时间和精力来实现，这意味着你可能会在你演示时从你的老板那里挤出一些加班时间，在午餐时花费大约 20 分钟的时间，javascript 路由是多么容易实现。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-18T17:05:22.683

如果您不能使用 JavaScript，则将每个步骤都设置为视图，并在控制器中使用方法，并将数据保持在会话中，直到准备好提交到数据库。

您可以使用 ActionLink HtmlHelper 方法制作 Next 和 Prev 按钮。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-03T19:49:41.597

另一种方法是将使用向导构建的不完整对象保存到数据库中，然后将主键传递给向导的下一步。我知道这意味着您需要将一些数据库字段设为可空，但它确实具有额外的优势，您可以将主键保存在 cookie 中并允许用户稍后返回向导。此选项不需要 javascript 或会话状态。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-17T22:28:37.243

使不同的面板都成为客户端......都以相同的形式......当按下最终提交按钮时，您可以同时发布所有值。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-24T22:13:40.127

如果您不能使用 Javascript 并且不想将服务器资源用于 Session 变量，您还可以对在不同步骤中输入的值进行序列化和反序列化，并使用隐藏的输入字段来回传递。有点像 ASP.NET Webforms 中的 ViewState。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-09-22T20:03:44.190

我整理了一个登录向导，并在我的博客上记录了它背后的想法，如果有帮助的话：[链接文本](http://shouldersofgiants.co.uk/Blog/post/2009/09/16/A-RESTful-Wizard-Using-ASPNet-MVCe280a6-Perhaps.aspx "一个使用 ASP.Net MVC 的 RESTful 向导……也许吧？")

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-12T15:59:57.947

您可以使用 NuGet 上提供的简单组件 MVCWizard.Wizard。WizardController 允许您使用局部视图创建向导。还有一个 AutoWizardController 可以在单个视图中呈现整个向导。所有这些组件都与会话一起操作以存储模型状态。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-12-19T16:36:08.100

在这个问题中有一个非常简单、灵活和可扩展的方法：[How to simple my statefull interlaced modal dialogs in ASP.NET MVC](https://stackoverflow.com/questions/8541821/how-to-simplify-my-statefull-interlaced-modal-dialogs-in-asp-net-mvc)

# c - 关于重复符号的奇怪 ld 错误

> ID：297162
> 
> 赞同：1
> 
> 时间：2008-11-17T22:15:24.807
> 
> 标签：c, gcc, ld, compiler-errors, duplicate-symbol

我有一个项目，包含两个文件，main.c 和 logoff.c。当我尝试编译它们时，出现此错误：

```
gcc -c -g -Wall main.c
gcc -c -g -Wall logoff.c
gcc -o main -g -Wall main.o logoff.o
ld: duplicate symbol _logoff in logoff.o and main.o
```

我在 logoff.c 中有一个名为 logoff 的函数，但我在 main.c 中搜索了文本“logoff”，但什么也没找到（甚至还没有调用该函数！）。

如果我将函数的名称更改为 log_off 它可以工作。文件中有第二个函数会导致相同的错误，除非它的名称也被更改。

有什么原因会发生这种情况吗？我在两个不同的系统上有这个问题。可能相关的一件事是我在另一个项目中使用了相同的 logoff.c 文件，但它没有连接到这个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T22:19:36.093

你在 main.c 中是#include 还是 #import logoff.c？

你做到了——那是你的问题。logoff.c 包含在 main.c 中，因此 main 定义了 _logoff 和 _main。现在您还要编译 logoff.c，它定义了 _logoff。然后你尝试链接这两者，这意味着生成的二进制文件包括符号 _main、_logoff 和 _logoff，这正是链接器告诉你的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T22:23:38.457

创建一个 logoff.h 文件，其中只有 logoff 的函数声明，例如

`void logoff(void);`

然后，在 main.c 中包含它`#include "logoff.h"`。不要包含 logoff.c，因为编译器将编译该函数两次，然后链接器将看到两个同名的函数。

如果您将其更改为 log_off，它似乎可以工作，然后只重新编译其中一个。另一个目标文件仍将编译旧的注销功能。因此链接器看到一个 log_off 和一个 logoff。这就是它似乎为您使用该名称的原因。

# odbc - AS/400 ODBC Drivers

> ID：297200
> 
> 赞同：0
> 
> 时间：2008-11-17T22:28:59.023
> 
> 标签：odbc, ibm-midrange

We have been using the Client Access ODBC drivers when accessing AS/400 data from our .net applications and SQL DTS/SSIS packages. Are there third party drivers that provide better performance or functionality?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T00:04:41.373

我们公司正在使用相同的客户端访问驱动程序。据我们所知，没有其他可用的。去年我们遇到的一个问题是没有可用的 64 位驱动程序，因此我们的具有连接到 AS/400 的应用程序的服务器必须是 32 位的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T22:42:22.803

I know this is on the other side of the hill, but I've been using [JTOpen](http://jt400.sourceforge.net/) as a JDBC (well, Java ...) driver in a previous project. This is an OpenSource version of the [IBM Toolbox for Java](http://www-03.ibm.com/systems/i/software/toolbox/). As such it is usually some versions ahead of the IBM release and had fewer bugs. My experience with this driver was very positive.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T15:08:38.600

您可以使用 Windows 内置驱动程序进行连接，但我猜 IBM 驱动程序会更快。

您是看到性能下降还是只是想挤出更多性能？如果是第一个，请查看您的系统以查看其大小是否正确。在一份旧工作中，系统的大小对于我们使用它的地方来说太小了。一些简单的查询需要几分钟才能运行。如果是后者，可以尝试向 System i 添加更多 RAM。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T15:59:29.807

我不确定它是否有更好的性能，但快速谷歌会出现[Hit ODBC/400](http://www.hitsw.com/products_services/sql400/odbc400/odbc400.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T15:37:57.857

IBM 一直在整合他们的 DB2 驱动程序，因此通用 DB2 驱动程序应该能够连接到 DB2/400。

我还没有尝试过。我想听听经验。

# sql-server - 用于将 SQL Server 中的表字段从 NULL 更新为非 NULL 的更新脚本

> ID：297205
> 
> 赞同：5
> 
> 时间：2008-11-17T22:30:33.857
> 
> 标签：sql-server, tsql

我在 SQL Server 数据库的表中有一个字段（例如 foo），该字段最初定义为可为空，但新要求表明该字段必须为非空。

通过更新脚本将此字段更新为非空而不删除表内容的最佳方法是什么？我尝试从设计视图生成脚本，但在执行过程中失败，因为表的当前内容具有 foo 的 NULL 值。更糟糕的是，如果我忽略了这个错误，它会继续删除表的所有内容！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-17T22:47:18.610

`NULL`在将其`NULL`更改为`NOT NULL`.

```
-- Clean up the data which won't comply with the schema changes
UPDATE t SET foo = 0 WHERE foo IS NULL

-- Apply the NOT NULL
ALTER TABLE t ALTER COLUMN foo int NOT NULL

-- Add a default for the future if that's what you want
ALTER TABLE t ADD CONSTRAINT t_foo_def DEFAULT 0 FOR foo 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T22:38:17.320

您可以为不可为空的字段设置默认值。如果要将其从可空更改为不可空，则必须提供一些可以分配给该字段中具有空值的行的值。

# jquery - Refresh table info using jQuery and ASP.NET MVC

> ID：297206
> 
> 赞同：4
> 
> 时间：2008-11-17T22:31:06.973
> 
> 标签：jquery, asp.net-mvc

I have a simple page that displays a user's email addresses in a table. I also have a textbox underneath the table and an "add" button. Currently, I am using a simple form post that is handled by a controller that will add the e-mail address to the database and reload the page. This works fine, but I'm looking to streamline the process by using jQuery and AJAX so that the page doesn't need to be refreshed.

What's the best way to go about doing this? I imagine I'll have to set up an event listener for the button's click event, perform an AJAX call to a url like "Email/Add". Where I get lost is figuring out what type of information to return from that controller action and how that information can get parsed on the client side to update the table of e-mail addresses. Are there any good samples of this out there?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T22:51:36.417

You should use XML or JSON. I prefer JSON because it's easy to parse back on the javascript side.

In the click handler for the add button, make an AJAX call to some MVC path specifies what email has been added. Make the code for that path insert the email specified. Then, just return a result:

```
{
    result: 'SUCCESS',
    description: 'Email Added.'
} 
```

Then, in your AJAX callback, parse the result like so:

```
//This function abstracts away the strangeness in dealing with the eval method and returning JSON objects
//If there is a better way, let me know
function ParseJSON(jsonText) {
    var ret = null;
    eval('ret = '+jsonText);
    return ret;
}

var ret = ParseJSON(response.value);;

if(ret.result == 'SUCCESS') {
    //Add a new TR to your table here
} else {
    //Display the error message here
    // alert(ret.description);
} 
```

The result of 'SUCCESS' means that the server already added the email to the database. So, we just add the row into our table dynamically with JavaScript and you don't have to refresh the page.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T11:27:14.100

如果您想使用 jquery，您可以返回部分视图并将返回的 html 插入到当前文档中。ajaxloading div 包含一个旋转加载 gif。返回的值作为最后一个值插入到表中。该视图在 tr-tags 之间返回一段 html。

```
 $("#ajaxLoading").show();

     $.ajax({
         type: "POST",
         url: "/Hoofdgroepen/Add",
         data: "nummer=" + nummer + "&omschr=" + omschr,
         dataType: "html",
         success: function(result) {
             //alert(result);                                
             $("tr:last").after(result);
             $("#ajaxLoading").hide();
             $("#hfdgrpForm").resetForm();
         }
     }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-26T00:20:56.953

[当您应用 EnganderedMassa 的 anwser 时，您还可以使用micro-template](http://ejohn.org/blog/javascript-micro-templating/)的客户端功能。这是 John Resig / jQuery god 用来解析和格式化从帖子返回的数据集的技术。您的餐桌是实现这一目标的理想场所。

这里有两篇使用这种技术的博客文章（它们基于 .Net，但在 .Net 方面很轻）。

[Encosia - JTemplate](http://encosia.com/2008/06/26/use-jquery-and-aspnet-ajax-to-build-a-client-side-repeater/)

[.Net 和 John Resig 的微模板](http://www.west-wind.com/presentations/jQuery/jQueryPart2.aspx#Templates)

# error-correction - Need Block-Oriented Error Correcting Scheme

> ID：297212
> 
> 赞同：3
> 
> 时间：2008-11-17T22:35:25.483
> 
> 标签：error-correction, convolution, forwarderrorcorrection

I'm storing many files of various lengths into a block-oriented medium (fixed-size e.g. 1024 bytes). When reading back the file, each block will either be missing or correct (no bit errors or the like). The missing blocks are random, and there's not necessarily any sequence to the missing blocks. I'd like to be able to reassemble the entire file, as long as the number of missing blocks is below some threshold, which probably varies with the encoding scheme.

Most of the literature I've seen deals with sequences of bit errors in a stream of data, so that wouldn't seem to apply.

A simple approach is to take N blocks at a time, then store a block containing the XOR of the N blocks. If one of the N blocks is missing but the check block is not, then the missing block can be reconstructed.

Are there error-correcting schemes which are well suited to this problem? Links to literature or code are appreciated.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T22:47:59.607

Look into Reed-Solomon codes:

[http://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction](http://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T02:48:50.510

开始搜索的最佳位置是[parchive Parity Volume Set spec](http://sourceforge.net/docman/display_doc.php?docid=7273&group_id=30568)。您将遇到的最大问题是每个块中所需的开销元数据。此外，该规范面向压缩存档文件。

另一个很好的链接是[2.0 格式的 parchive 文档](http://parchive.sourceforge.net/#docs)（基于但比 parchive 1.0 更面向块）。有关 PAR 1.0 如何改进 2.0 的详细信息，请参阅[QuickPar](http://www.quickpar.org.uk/AboutPAR2.htm)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-06-24T22:54:05.160

查看 Raptor 代码 ( [https://en.wikipedia.org/wiki/Raptor_code](https://en.wikipedia.org/wiki/Raptor_code) ) 它们是目前最先进的喷泉代码

# .net - 将列索引转换为 Excel 列名

> ID：297213
> 
> 赞同：13
> 
> 时间：2008-11-17T22:35:31.147
> 
> 标签：.net, excel

给定列的索引，如何获得 Excel 列名？

这个问题比听起来更棘手，因为它**不仅仅是**base-26。这些列不会像普通数字那样环绕。甚至[Microsoft 支持示例](http://support.microsoft.com/kb/833402)也无法扩展到 ZZZ。

[*免责声明：这是我不久前编写的一些代码，今天它再次出现在我的桌面上。我认为值得在这里发布作为预先回答的问题。*]

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-17T22:35:46.090

我想出的答案是有点递归。此代码在 VB.Net 中：

```
Function ColumnName(ByVal index As Integer) As String
        Static chars() As Char = {"A"c, "B"c, "C"c, "D"c, "E"c, "F"c, "G"c, "H"c, "I"c, "J"c, "K"c, "L"c, "M"c, "N"c, "O"c, "P"c, "Q"c, "R"c, "S"c, "T"c, "U"c, "V"c, "W"c, "X"c, "Y"c, "Z"c}

        index -= 1 ''//adjust so it matches 0-indexed array rather than 1-indexed column

        Dim quotient As Integer = index \ 26 ''//normal / operator rounds. \ does integer division, which truncates
        If quotient > 0 Then
               ColumnName = ColumnName(quotient) & chars(index Mod 26)
        Else
               ColumnName = chars(index Mod 26)
        End If
End Function 
```

在 C# 中：

```
string ColumnName(int index)
{
    index -= 1; //adjust so it matches 0-indexed array rather than 1-indexed column

    int quotient = index / 26;
    if (quotient > 0)
        return ColumnName(quotient) + chars[index % 26].ToString();
    else
        return chars[index % 26].ToString();
}
private char[] chars = new char[] {'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'}; 
```

唯一的缺点是它使用 1-indexed 列而不是 0-indexed。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-06-26T00:01:08.370

这是 Joel 的很棒的代码，它被修改为使用从零开始的列索引并且没有 char 数组。

```
 Public Shared Function GetExcelColumn(ByVal index As Integer) As String

        Dim quotient As Integer = index \ 26 ''//Truncate 
        If quotient > 0 Then
            Return GetExcelColumn(quotient - 1) & Chr((index Mod 26) + 64).ToString

        Else
            Return Chr(index + 64).ToString

        End If

    End Function 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-18T00:10:16.337

正是出于这个原因，我避免在 Excel 编程界面中使用列名。在 Cell(r,c) 引用和 R1C1 寻址中使用列**号**非常有效。

编辑： Range 函数也采用单元格引用，如 Range(Cell(r1,c1),Cell(r2,c2))。此外，您可以使用 Address 函数来获取单元格或区域的 A1 样式地址。

EDIT2：这是一个 VBA 函数，它使用 Address() 函数来检索列名：

```
Function colname(colindex)
    x = Cells(1, colindex).Address(False, False) ' get the range name (e.g. AB1)
    colname = Mid(x, 1, Len(x) - 1)              ' return all but last character
End Function 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-06-24T13:36:06.333

```
public static String translateColumnIndexToName(int index) {
        //assert (index >= 0);

        int quotient = (index)/ 26;

        if (quotient > 0) {
            return translateColumnIndexToName(quotient-1) + (char) ((index % 26) + 65);
        } else {
            return "" + (char) ((index % 26) + 65);
        }

    } 
```

和测试：

```
for (int i = 0; i < 100; i++) {
            System.out.println(i + ": " + translateColumnIndexToName(i));
} 
```

这是输出：

```
0: A
1: B
2: C
3: D
4: E
5: F
6: G
7: H
8: I
9: J
10: K
11: L
12: M
13: N
14: O
15: P
16: Q
17: R
18: S
19: T
20: U
21: V
22: W
23: X
24: Y
25: Z
26: AA
27: AB
28: AC 
```

我需要基于 0 的 POI

以及从索引到名称的翻译：

```
public static int translateComunNameToIndex0(String columnName) {
        if (columnName == null) {
            return -1;
        }
        columnName = columnName.toUpperCase().trim();

        int colNo = -1;

        switch (columnName.length()) {
            case 1:
                colNo = (int) columnName.charAt(0) - 64;
                break;
            case 2:
                colNo = ((int) columnName.charAt(0) - 64) * 26 + ((int) columnName.charAt(1) - 64);
                break;
            default:
                //illegal argument exception
                throw new IllegalArgumentException(columnName);
        }

        return colNo;
    } 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-26T05:55:42.533

```
# Python 2.x, no recursive function calls

def colname_from_colx(colx):
    assert colx >= 0
    colname = ''
    r = colx
    while 1:
        r, d = divmod(r, 26)
        colname = chr(d + ord('A')) + colname
        if not r:
            return colname
        r -= 1 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-10-22T23:36:39.387

这是一篇旧文章，但在看到一些解决方案后，我想出了自己的 C# 变体。从 0 开始，没有递归：

```
public static String GetExcelColumnName(int columnIndex)
{
    if (columnIndex < 0)
    {
        throw new ArgumentOutOfRangeException("columnIndex: " + columnIndex);
    }
    Stack<char> stack = new Stack<char>();
    while (columnIndex >= 0)
    {
        stack.Push((char)('A' + (columnIndex % 26)));
        columnIndex = (columnIndex / 26) - 1;
    }
    return new String(stack.ToArray());
} 
```

以下是一些关键过渡点的测试结果：

```
0: A
1: B
2: C
...
24: Y
25: Z
26: AA
27: AB
...
50: AY
51: AZ
52: BA
53: BB
...
700: ZY
701: ZZ
702: AAA
703: AAB 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-10-24T20:54:05.073

在python中，带有递归。翻译自[乔伊](https://stackoverflow.com/users/25962/joey)的[回答](https://stackoverflow.com/a/1046772/1732222)。到目前为止，它已经过测试可以达到 GetExcelByColumn(35) = 'AI'

```
def GetExcelColumn(index):

    quotient = int(index / 26)

    if quotient > 0:
        return GetExcelColumn(quotient) + str(chr((index % 26) + 64))

    else:
        return str(chr(index + 64)) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-11-02T08:34:59.687

php版本，感谢这篇文章帮我弄清楚！^^

```
/**
 * Get excel column name
 * @param index : a column index we want to get the value in excel column format
 * @return (string) : excel column format
 */
function getexcelcolumnname($index) {
    //Get the quotient : if the index superior to base 26 max ?
    $quotient = $index / 26;
    if ($quotient >= 1) {
        //If yes, get top level column + the current column code
        return getexcelcolumnname($quotient-1). chr(($index % 26)+65);
    } else {
        //If no just return the current column code
        return chr(65 + $index);
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-10-03T09:42:01.820

**JavaScript 解决方案**

```
/**
 * Calculate the column letter abbreviation from a 0 based index
 * @param {Number} value
 * @returns {string}
 */
getColumnFromIndex = function (value) {
    var base = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
    value++;
    var remainder, result = "";
    do {
        remainder = value % 26;
        result = base[(remainder || 26) - 1] + result;
         value = Math.floor(value / 26);
    } while (value > 0);
    return result;
}; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-21T08:46:56.617

我喜欢编写递归函数，但我认为这里没有必要。这是我在 VB 中的解决方案。它适用于 ZZ 列。如果有人能告诉我它是否适用于 AAA 到 ZZZ，那就太好了。

```
Public Function TranslateColumnIndexToName(index As Integer) As String
'
Dim remainder As Integer
Dim remainder2 As Integer
Dim quotient As Integer
Dim quotient2 As Integer
'
quotient2 = ((index) / (26 * 26)) - 2
remainder2 = (index Mod (26 * 26)) - 1
quotient = ((remainder2) / 26) - 2
remainder = (index Mod 26) - 1
'
If quotient2 > 0 Then
    TranslateColumnIndexToName = ChrW(quotient2 + 65) & ChrW(quotient + 65) & ChrW(remainder + 65)
ElseIf quotient > 0 Then
    TranslateColumnIndexToName = ChrW(quotient + 65) & ChrW(remainder + 65)
Else
    TranslateColumnIndexToName = ChrW(remainder + 65)
End If 
```

结束功能

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-11-08T13:25:21.120

这是我在 C# 中的解决方案

```
// test
void Main()
{

    for( var i = 0; i< 1000; i++ )
    {   var byte_array = code( i );
        Console.WriteLine("{0} | {1} | {2}", i, byte_array, offset(byte_array));
    }
}

// Converts an offset to AAA code
public string code( int offset )
{
    List<byte> byte_array = new List<byte>();
    while( offset >= 0 )
    {
        byte_array.Add( Convert.ToByte(65 + offset % 26) );
        offset = offset / 26 - 1;
    }
    return ASCIIEncoding.ASCII.GetString( byte_array.ToArray().Reverse().ToArray());
}

// Converts AAA code to an offset
public int offset( string code)
{
    var offset = 0;
    var byte_array = Encoding.ASCII.GetBytes( code ).Reverse().ToArray();
    for( var i = 0; i < byte_array.Length; i++ )
    {
        offset += (byte_array[i] - 65 + 1) * Convert.ToInt32(Math.Pow(26.0, Convert.ToDouble(i)));
    }
    return offset - 1;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-01-04T03:00:16.823

这是我在 C# 中的答案，用于在列索引和列名之间进行双向转换。

```
/// <summary>
/// Gets the name of a column given the index, as it would appear in Excel.
/// </summary>
/// <param name="columnIndex">The zero-based column index number.</param>
/// <returns>The name of the column.</returns>
/// <example>Column 0 = A, 26 = AA.</example>
public static string GetColumnName(int columnIndex)
{
    if (columnIndex < 0) throw new ArgumentOutOfRangeException("columnIndex", "Column index cannot be negative.");

    var dividend = columnIndex + 1;
    var columnName = string.Empty;

    while (dividend > 0)
    {
        var modulo = (dividend - 1) % 26;
        columnName = Convert.ToChar(65 + modulo) + columnName;
        dividend = (dividend - modulo) / 26;
    }

    return columnName;
}

/// <summary>
/// Gets the zero-based column index given a column name.
/// </summary>
/// <param name="columnName">The column name.</param>
/// <returns>The index of the column.</returns>
public static int GetColumnIndex(string columnName)
{
    var index = 0;
    var total = 0;
    for (var i = columnName.Length - 1; i >= 0; i--)
        total += (columnName.ToUpperInvariant()[i] - 64) * (int)Math.Pow(26, index++);

    return total - 1;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-02-04T12:49:37.320

在红宝石中：

```
class Fixnum
  def col_name
    quot = self/26
    (quot>0 ? (quot-1).col_name : "") + (self%26+65).chr
  end
end

puts 0.col_name # => "A"
puts 51.col_name # => "AZ" 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-06-16T08:33:52.537

这个 JavaScript 版本表明它的核心是转换为 base 26：

```
function colName(x)
{
    x = (parseInt("ooooooop0", 26) + x).toString(26);
    return x.slice(x.indexOf('p') + 1).replace(/./g, function(c)
    {
        c = c.charCodeAt(0);
        return String.fromCharCode(c < 64 ? c + 17 : c - 22);
    });
} 
```

该`.toString(26)`位表明 Joel Coehoorn 是错误的：它是一个简单的基础转换。

（注意：根据 Dana 在生产中的回答，我有一个更直接的实现。它不那么重，适用于更大的数字，尽管这不会影响我，但也没有清楚地显示数学原理。）

PS这是在重要点评估的功能：

```
0 A
1 B
9 J
10 K
24 Y
25 Z
26 AA
27 AB
700 ZY
701 ZZ
702 AAA
703 AAB
18276 ZZY
18277 ZZZ
18278 AAAA
18279 AAAB
475252 ZZZY
475253 ZZZZ
475254 AAAAA
475255 AAAAB
12356628 ZZZZY
12356629 ZZZZZ
12356630 AAAAAA
12356631 AAAAAB
321272404 ZZZZZY
321272405 ZZZZZZ
321272406 AAAAAAA
321272407 AAAAAAB
8353082580 ZZZZZZY
8353082581 ZZZZZZZ
8353082582 AAAAAAAA
8353082583 AAAAAAAB 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-03-21T17:24:52.723

这是 Swift 4 ：

```
@IBAction func printlaction(_ sender: Any) {
    let textN : Int = Int (number_textfield.text!)!
    reslut.text = String (printEXCL_Letter(index: textN))
}

func printEXCL_Letter(index : Int) -> String {

    let letters = ["a", "b", "c","d", "e", "f","g", "h", "i","j", "k", "l","m", "n", "o","p", "q", "r","s", "t", "u","v","w" ,"x", "y","z"]

    var index = index;
    index -= 1
    let index_div = index / 26

    if (index_div > 0){
        return printEXCL_Letter(index: index_div) + letters[index % 26];
    }
    else {
        return letters[index % 26]
    }
} 
```

# c# - .NET 2.0 c# 项目的 LoC（代码行）指标

> ID：297215
> 
> 赞同：5
> 
> 时间：2008-11-17T22:35:51.753
> 
> 标签：c#, metrics, lines-of-code

请推荐一些免费工具，它们将帮助我使用命令行获取 C# 项目的代码行指标。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-08-16T06:27:37.193

我正在寻找类似的工具。发现[Microsoft Line of Code (LOC) Counter](http://code.msdn.microsoft.com/LOCCounter) 它非常好。来自 code.msdn 页面的功能列表

特征：

*   通过连接到源存储库（例如 VSTF、VSS 和文件系统）获取最新的 LOC 计数和代码流失
*   16 种类型的计数（最新、带有日期、标签、变更集等的代码搅动）
*   自定义计数标准以适应您自己的环境 - 添加、删除编程语言、设置包含/排除规则
*   按文件、文件夹、语言、排除的 LOC 等报告结果
*   通过对代码流失数据应用 Microsoft Research 来预测系统缺陷密度
*   支持个人软件过程 (SM) / 团队软件过程 (SM) 对象级代码搅动
*   作为 Windows（XP/Vista，32 位/64 位）应用程序或作为 Visual Studio 2005 IDE 的插件安装
*   保存任务的源代码选择并重复运行它们
*   将结果导出到 Excel 或 PDF

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T23:02:40.180

我使用[Ndepend获得了 LoC](http://www.ndepend.com/)

# c# - ASP.NET C#，需要按两次按钮才能使某些事情发生

> ID：297217
> 
> 赞同：9
> 
> 时间：2008-11-17T22:36:34.373
> 
> 标签：c#, asp.net

我有一个Web应用程序，问题是标签中的文本在第一次单击时不会更新，我需要单击两次按钮，我调试代码，我发现标签直到之后才接收数据第二次点击，

这是我的代码：

```
System.Data.SqlClient.SqlCommand command = new System.Data.SqlClient.SqlCommand();
System.Data.SqlClient.SqlConnection connection;
string CommandText;
string game;
string modtype;
bool filter;
protected void Page_Load(object sender, EventArgs e)
{

    labDownloadList.Text = null;

    //Session variables:
    if (Session["Game"] != null)
    {
        game = Convert.ToString(Session["Game"]);
    }
    if (Session["ModType"] != null)
    {
        modtype = Convert.ToString(Session["ModType"]);
    }
    if (Session["FilterBool"] != null)
    {
        filter = Convert.ToBoolean(Session["FilterBool"]);
    }
    string ConnectionString = "Data Source=.\\SQLEXPRESS;AttachDbFilename=C:\\inetpub\\wwwroot\\stian\\App_Data\\Database.mdf;Integrated Security=True;User Instance=True";
    connection = new System.Data.SqlClient.SqlConnection(ConnectionString);
    System.Data.SqlClient.SqlDataReader reader;
    command = connection.CreateCommand();
    connection.Open();
    CommandText = "SELECT * FROM Command";
    if (filter)
    {
        CommandText = "SELECT * FROM Command WHERE Game='" + game + "' AND Type='" + modtype + "'";
    }
    command.CommandText = CommandText;
    reader = command.ExecuteReader();
    labDownloadList.Text = "";
    while (reader.Read())
    {
        string game = reader.GetString(1);
        string author = reader.GetString(2);
        string downloadlink = reader.GetString(3);
        string size = reader.GetString(4);
        string description = reader.GetString(5);
        string version = reader.GetString(6);
        string screenshotlink = reader.GetString(7);
        Int64 AmountDownloaded = reader.GetInt64(8);

        labDownloadList.Text += "Game: " + game + "<br>";
        labDownloadList.Text += "Author: " + author + "<br>";
        labDownloadList.Text += "Size: " + size + "<br>";
        labDownloadList.Text += "Description: " + description + "<br>";
        labDownloadList.Text += "Version: " + version + "<br>";
        labDownloadList.Text += "<img src='" + screenshotlink + " /><br>";
        labDownloadList.Text += "Downloaded: " + AmountDownloaded + " times<br><hr>";
        labDownloadList.Text += "<a href='" + downloadlink + "'>Download</a><br>";
    }
}

protected void Page_UnLoad(object sender, EventArgs e)
{
    Session["Game"] = game;
    Session["ModType"] = modtype;
    Session["FilterBool"] = filter;
    connection.Close();
}

protected void btnFilter_Click(object sender, EventArgs e)
{
    game = lstGames.SelectedValue;
    modtype = lstTypeMod.SelectedValue;
    filter = true;
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-17T23:36:59.197

要非常清楚。按钮单击事件发生在 Page_Load 事件之后，这意味着过滤不会在第一次回发时应用。它已在第二次回发时更新，您会看到过滤。使您的代码工作的最简单更改是将 Page_Load 事件中的所有代码移动到 OnPreRender 中，以便在按钮单击事件之后发生重新加载。

然而，一个更干净的解决方案可能是将其移动到 LoadData 函数中，并在 PageLoad 不是回发时调用它，并在更新过滤器后在按钮单击事件中调用它。这将阻止在不需要重新加载数据的任何回发页面周期上调用数据库：

```

protected void Page_Load(object sender, EventArgs e)
{    
    if (!Page.IsPostBack)
        {   
             LoadData()
        }
}

private void LoadData()
{
    labDownloadList.Text = null;
    //Session variables:    
    if (Session["Game"] != null)
    ...
}

protected void btnFilter_Click(object sender, EventArgs e)
{    
    game = lstGames.SelectedValue;
    modtype = lstTypeMod.SelectedValue;
    filter = true;
    LoadData();
}

```

对于刚起步的 ASP.Net 开发人员的最后一条快速建议是彻底了解页面生命周期。了解页面上的事件顺序至关重要。祝你好运。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-17T22:46:06.383

Microsoft 对[页面生命周期](http://msdn.microsoft.com/en-us/library/ms178472.aspx)的概述可能有助于理解流程（并解决您的问题）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-17T22:42:06.717

按钮单击事件处理程序发生在 Page_Load 之后。尝试改用 Page_LoadComplete。

因此，在您的代码中，一旦单击按钮，就会触发 page_load 事件并设置数据，然后触发 btnClick 事件并更改数据。但是，数据已经以旧形式绑定。这就是为什么它需要点击 2 次才能工作的原因。

如果您将相同的 page_load 代码放入 page_loadcomplete 事件中，它将在 btnClick 事件之后发生。那应该会产生预期的结果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-17T22:41:03.757

我没有看到典型的

```
if (!Page.IsPostBack)
{
   ...
} 
```

在您的 Page_Load 方法中，这意味着每次加载页面时都会发生 datbinding，这很可能会导致您的问题。我建议将其添加到代码中，看看它是否能解决问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T14:25:37.140

JackCom，解决方案奏效了！谢谢你。我将研究页面生命周期。我必须补充一点，我只有软件开发方面的经验，今年秋天我才刚刚开始进行 Web 开发。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-09-23T12:51:36.360

我在我的页面上遇到了同样的问题。每次我必须点击两次才能让它工作。这是由某些文本框和下拉列表将自动回发设置为 true 引起的。一旦我删除了自动回发，甚至会顺利进行，并且单击会正确触发。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-06-24T21:02:48.500

我被困在这个问题上大约一个星期。最后，我将事件的代码放在`Button_Click`事件中，`TextChanged`并且它起作用了。按下按钮使焦点离开，`TextBox`以便在`Button_click`事件不触发时触发事件。非常笨拙。我不喜欢它。

我遇到了一篇有趣的文章，它实际上对我没有用，但我很高兴我还是读了它：[Enter and the Button Click Event](http://www.4guysfromrolla.com/articles/060805-1.aspx)

这可能适用于其他情况。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-08-27T19:42:02.613

ASP.Net 有时会做一些非常奇怪的事情。我今天遇到了同样的问题。我发现我在 TextBox 上放了一个 AutoPostBack = "true ，即使它没有达到我想要的效果，我忘记将 AutoPostBack 从标记中取出。当我单击同一表格行中的按钮时，第一次单击导致两次回发，但没有触发按钮事件。第二次单击按钮时，按钮单击事件触发。当我从标记中找到无关的 AutoPostBack 时，按钮事件在第一次单击时开始触发。有人会认为除了按钮单击事件引用了文本框的内容外，文本框与按钮没有任何关系。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-12-12T15:49:51.903

我对此不太了解，但这个技巧对我有用：

```
function pageLoad(sender, args) {
    $(document).ready(function () {
        //your stuff
    });
    $(":button").each(function() {
        $(this).click();
        //this is a trick;  click one when page load,
    });
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-12-17T19:36:30.983

我遇到了这个问题，因为我使用“Server.Transfer”在页面之间移动。当我更改为“Response.Redirect”时，问题就解决了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-02-04T20:07:55.790

将 VB 项目转换为 C# 后，我遇到了双击事件问题。发现转换器转换了后面的代码而不是ascx和aspx页面代码，仍然说language="vb"。将这一点一点一点地转换为 C#，然后声明 language="cs" 解决了这个问题。

# 3d - gpu, old hardware, 3d acceleration and a lib

> ID：297218
> 
> 赞同：1
> 
> 时间：2008-11-17T22:36:45.777
> 
> 标签：3d, 2d, hardware, gpu, hardware-acceleration

i am writing a 2d lib which will have 3d acceleration but i'd like to do it in a way that it will efficiently run on older HW. Possibly typedefs to hide options/functions that your targeted mode does not support. (also there may be emulation func turned on)

What are some of the things older HW do? here is a list of questions and things i know of.

*   Tiles, this will be unsupported. Its to old, my lib will support pixel access
*   Single pixel buffer with scrolling. Example GBA
*   multiple surface with surface to surface quick blt (no stretch)
*   multiple surface with surface to surface quick blt with stretch (maybe this was emulated? does any HW stretch images for you?)
*   HW pixel fill (i thought i saw the option in DX)
*   HW transparent colour? (colour which is transparent, thought i seen in DX specs)
*   Textures, older use to be a power of 2\. The width does not have to be the same power of 2 as height? (example 64x256), does any require them to be the same
*   Textures, newer HW can have them any width and height (or is this a lie?)
*   Textures can be in crazy formats (ARGB 8888, ABGR 8888, ABGR 2 10 10 10)

Also, i cannot do a texture to texture blit? as in copy 60x40 from texture A to B in HW ? Also can textures be in palette? (i wont support this) and finally i should keep in mind about shaders 8)

What else am i missing?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T22:53:25.307

What 3D accelleration are you referring to? If it is OpenGL compatible hardware:

*   Textures need to be power of 2, width and height can have arbitrary power of two.
*   Textures without power of 2 constraint are enabled with an openGL extension which you can test for (and is present on almost all new hardware).
*   Several different texture formats are standardized in OpenGL, I don't know extensions to have arbitrary texture formats.

About 2D:

*   Normal hardware 2D acceleration supports blitting, but not stretching. Stretching is available as "video acceleration". For example, in X11 you can use the xv extension to get accelerated stretching, but only in YUV color space.
*   For really fast image drawing operations, check out Imlib2\. It does everything in software, but blazingly fast. Perhaps the right way to go if 3D hardware acceleration is not available. 2D hw acceleration differs in performance, and for example the X11 RENDER acceleration is often beaten by Imlib2\. [http://docs.enlightenment.org/api/imlib2/html/](http://docs.enlightenment.org/api/imlib2/html/)

An interesting project for you to look at could also be DirectFB, which tries to heavily use HW 2D acceleration: [http://www.directfb.org/](http://www.directfb.org/)

# vba - 如何将文本放在剪贴板中，以便在 Word 中粘贴为表格？

> ID：297220
> 
> 赞同：11
> 
> 时间：2008-11-17T22:37:09.380
> 
> 标签：vba, ms-word, ms-office, clipboard

在 MS Office 中使用 VBA，如何将文本添加到 Windows 剪贴板，以便将其作为表格粘贴到 Word 中？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T00:01:20.363

Windows 剪贴板支持多种格式。当您想在剪贴板中放置东西时，您可以调用 RegisterClipboardFormat() 一次或多次，告诉它您将放置在剪贴板上的对象的格式，然后调用 SetClipboardData() 将数据实际放入剪贴板.

如果您希望能够将表格粘贴到 Word 中，那么 HTML 是最容易使用的格式。只需将 HTML 表格复制到剪贴板上，它就会正确粘贴到 Word 中，前提是您首先将剪贴板数据注册为 HTML 对象。

我会给你一些代码，但最简单的方法是参考 MSDN 上的示例：

[如何使用 Visual Basic 将 HTML 代码添加到剪贴板](http://support.microsoft.com/kb/274326)

此页面甚至显示了将 HTML 表格复制到剪贴板的示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T22:43:44.047

您是否尝试过将其格式化为 HTML 表格？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T23:02:59.250

我已经有一段时间没有进行任何 Windows 编程了，但我似乎记得您注册了对象的格式。事实上，您可以注册多个不同格式的对象，粘贴应用程序可以在它们之间进行选择（例如使用 Word 的`Paste Special`选项）。

我会尝试创建一个 Word 表格对象，用您的数据填充它的单元格，然后将其复制到剪贴板上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T20:52:01.570

剪贴板很棒......但是使用它来保存程序的输出以粘贴到 Word 中似乎有点粗略。您正在尝试做的事情是什么，您可能应该以其他方式做？

# automation - 自然语言自动化？

> ID：297226
> 
> 赞同：0
> 
> 时间：2008-11-17T22:39:49.017
> 
> 标签：automation, nlp

我记得读过一个用于 Windows 的自动化程序，它可以接受如下命令列表：

```
press the ok button
put "hello world" into the text control
press the add button 
```

等等等等。任何人都可以命名这个程序吗？一千个谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-14T05:57:09.747

看看华丁。[http://watin.sourceforge.net/](http://watin.sourceforge.net/) 与 Microsoft Oslo DSL 相结合。您可以轻松实现这一目标

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T23:06:12.457

也许寻找 AppleScript 到 Windows 的端口？假设不存在这样的野兽，也许[AutoHotKey](http://www.autohotkey.com/)或[AutoIt](http://www.autoitscript.com/autoit3/index.shtml)之类的东西可能足够接近？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T21:41:49.023

[ADL](http://adl.opengroup.org/)将生成测试用例的自然语言表示（用于文档/利益相关者审查）。我不知道有什么工具会反其道而行之。

还有[Fitnesse](http://www.fitnesse.org/)，它与我所见过的用作测试的自然语言文档一样接近。

# javascript - "Stop running this script?" error

> ID：297236
> 
> 赞同：8
> 
> 时间：2008-11-17T22:42:33.987
> 
> 标签：javascript, jquery, ajax, internet-explorer

I am developing a site that makes extensive use of JavaScript (jQuery). I regularly get the IE 'Stop running this script?' error dialog when I try to close the browser.

I'm guessing the problem occurs because the site is a single page that uses AJAX, so there are no postbacks to reset IE's count of commands executed.

Client-side registry hacking is not an option.

Does anyone know a way to get around this error?

UPDATE: The page has a number (~10) interval timers that poll continually on 30 or 60 second intervals.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-02-12T11:27:04.337

我也遇到过这个问题，并通过划分连续的 DOM 执行克服了这个问题。对于这种方法，我使用了`setTimeout`函数。解决此问题完全取决于您如何划分连续执行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T22:54:19.610

Do you by chance use a window.onunload handler? If you do, you might check that you don't have an infinite loop in there.

To check, at the bottom of your javascript do:

```
window.onunload = null; 
```

and test again.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-23T05:20:34.130

问题：“停止运行这个脚本？” 错误

解决方案：您可以说这是兼容性问题或错误，因为相同的东西在 Mozilla 中运行没有任何错误，但它在 IE 6,7 或 8 中运行，并显示错误消息“停止运行此脚本”。Microsoft 提供了一个补丁来修复 IE 中的这个问题。因此，请转到以下链接并下载“Microsoft Fix It”并安装它并重新启动浏览器，您将永远不会看到“停止运行此脚本”错误：http: [//support.microsoft.com/kb/ 175500#FixItForMeAlways](http://support.microsoft.com/kb/175500#FixItForMeAlways)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-04T01:54:54.253

我刚刚写了[一篇关于这个的博客，](http://www.picnet.com.au/blogs/Guido/post/2010/03/04/How-to-prevent-Stop-running-this-script-message-in-browsers.aspx)并提出了我认为非常时尚的解决方案。所以看看吧。如上所述，我的解决方案只是将长时间运行的操作分解为块，但我提供了一个很好的实用程序类来执行此操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T02:09:22.837

您的代码中只有一些长时间运行的脚本/无限循环。更多细节可能会得到更准确的答案。

如果您的页面使用了很多间隔，那么您需要在离开页面之前取消它们。使用 window.onunload 清除所有间隔。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-28T00:17:14.817

就像提到 $("*") 的人一样，尽量不要使用 $(this) 作为自定义事件的绑定选择器，这导致我最近的一个脚本破坏了系统的加载时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-21T08:58:46.337

也可以考虑将长操作拆分为 $(document).ready() 和 $(window).load()

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-09-15T07:49:46.170

我刚刚遇到了一个过于笼统的 jquery 选择器问题：例如`$("*")`

# asp.net-mvc - How do you repopulate a form in ASP.NET MVC that contains a DropDownList?

> ID：297238
> 
> 赞同：4
> 
> 时间：2008-11-17T22:42:55.360
> 
> 标签：asp.net-mvc

How do you repopulate a form in ASP.NET MVC that contains a DropDownList?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T02:54:15.647

我相信您在问如何在提交并重新显示表单后维护下拉列表的值。如果是这样，请参阅下面的一个**非常简单**的示例：

创建一个新的 MVC 应用程序（使用 MVC 测试版）并将以下内容放在 HomeController 中：

```
private Dictionary<string, string> getListItems()
{
    Dictionary<string, string> d = new Dictionary<string, string>();
    d.Add("Apple", "APPL");
    d.Add("Orange", "ORNG");
    d.Add("Banana", "BNA");
    return d;
}

public ActionResult Index()
{
    Dictionary<string, string> listItems = getListItems();
    SelectList selectList = new SelectList(listItems, "Value", "Key");
    ViewData["FruitDropDown"] = selectList;

    return View();
}

[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Index(FormCollection form)
{

    string selectedItem = form["FruitDropDown"];

    Dictionary<string, string> listItems = getListItems();
    SelectList selectList = new SelectList(listItems, "Value", "Key", selectedItem);
    ViewData["FruitDropDown"] = selectList;

    ViewData["Message"] = "You selected ID:" + selectedItem;

    return View();

} 
```

并将其放在 MainContent 标记之间的 Home\Index.aspx 中：

```
<div><strong><%= ViewData["Message"] %></strong></div>

<% using (Html.BeginForm()) { %>
<%= Html.DropDownList("FruitDropDown","(select a fruit)") %>
<input type="submit" value="Submit" />
<% } %> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-17T17:49:46.853

我只是想添加 BigJoe714 是正确的，除了 ...new SelectList(listItems, "Value", "Key", selectedItem) 切换了键/值

构造函数将这些参数用于此重载

```
public SelectList( IEnumerable items, string dataValueField, string dataTextField, object selectedValue ); 
```

数据值应该是键，而数据文本应该是值。

但除此之外，非常感谢！asp.net mvc 的另一个 kicka$$ 功能

# python - 为什么在使用 lxml（在 python 中）处理 XHTML 文档时 xpath 不起作用？

> ID：297239
> 
> 赞同：21
> 
> 时间：2008-11-17T22:42:58.650
> 
> 标签：python, xml, xhtml, xpath, lxml

我正在针对以下测试文档进行测试：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
        <title>hi there</title>
    </head>
    <body>
        <img class="foo" src="bar.png"/>
    </body>
</html> 
```

如果我使用 lxml.html 解析文档，我可以使用 xpath 获得 IMG：

```
>>> root = lxml.html.fromstring(doc)
>>> root.xpath("//img")
[<Element img at 1879e30>] 
```

但是，如果我将文档解析为 XML 并尝试获取 IMG 标记，则会得到一个空结果：

```
>>> tree = etree.parse(StringIO(doc))
>>> tree.getroot().xpath("//img")
[] 
```

我可以直接导航到元素：

```
>>> tree.getroot().getchildren()[1].getchildren()[0]
<Element {http://www.w3.org/1999/xhtml}img at f56810> 
```

但这当然不能帮助我处理任意文件。我还希望能够查询 etree 以获得一个 xpath 表达式，该表达式将直接识别此元素，从技术上讲，我可以这样做：

```
>>> tree.getpath(tree.getroot().getchildren()[1].getchildren()[0])
'/*/*[2]/*'
>>> tree.getroot().xpath('/*/*[2]/*')
[<Element {http://www.w3.org/1999/xhtml}img at fa1750>] 
```

但是，xpath 显然对于解析任意文档没有用处。

显然我在这里遗漏了一些关键问题，但我不知道它是什么。我最好的猜测是它与命名空间有关，但唯一定义的命名空间是默认命名空间，我不知道关于命名空间我还需要考虑什么。

那么，我错过了什么？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-17T22:45:15.247

问题是命名空间。当解析为 XML 时，img 标记位于[http://www.w3.org/1999/xhtml](http://www.w3.org/1999/xhtml)命名空间中，因为这是元素的默认命名空间。您在没有命名空间中要求 img 标签。

试试这个：

```
>>> tree.getroot().xpath(
...     "//xhtml:img", 
...     namespaces={'xhtml':'http://www.w3.org/1999/xhtml'}
...     )
[<Element {http://www.w3.org/1999/xhtml}img at 11a29e0>] 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-17T23:13:07.153

[XPath 认为所有无前缀的名称都在 "no namespace"](http://www.w3.org/TR/xpath#node-tests)中。

特别是规范说：

“节点测试中的 QName 使用表达式上下文中的命名空间声明扩展为扩展名称。这与对开始和结束标记中的元素类型名称进行扩展的方式相同，但使用 xmlns 声明的默认命名空间是未使用：如果 QName 没有前缀，则命名空间 URI 为空（这与扩展属性名称的方式相同）。"

请参阅问题及其解决方案的这两个详细说明：[**此处**](http://www.topxml.com/people/bosley/defaultns.asp)和[**此处**](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1455253&SiteID=1)。解决方案是将前缀（与正在使用的 API）相关联，并使用它为 XPath 表达式中的任何未加前缀的名称添加前缀。

希望这有帮助。

干杯，

迪米特·诺瓦切夫

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-12T13:06:52.507

如果你打算只使用来自单个命名空间的标签，正如我在上面看到的那样，你最好使用 lxml.objectify。

在你的情况下，它就像

```
from lxml import objectify
root = objectify.parse(url) #also available: fromstring 
```

您可以访问节点

```
root.html
body = root.html.body
for img in body.img: #Assuming all images are within the body tag 
```

虽然它在 html 中可能没有太大帮助，但它在结构良好的 xml 中非常有用。

有关更多信息，请查看[http://lxml.de/objectify.html](http://lxml.de/objectify.html)

# jquery - jQuery滑块教程？

> ID：297245
> 
> 赞同：5
> 
> 时间：2008-11-17T22:46:17.817
> 
> 标签：jquery, jquery-ui, slider

有谁知道一些解释如何使用 JQuery Slider 的好教程。

我找到了一些，但没有一个能真正清楚地表达我的需要。我真正需要弄清楚如何做的是使滑块从 1.0 到 5.0（包括所有十分之一），当它发生变化时，根据该值设置一个隐藏控件。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T23:24:44.760

[jQuery 网站上](http://docs.jquery.com/UI/Slider/slider#options)的文档非常好。

```
$('#mySlider').slider({
    min : 1,
    max : 5,
    stepping: .1,   // or, steps: 40
    change : function (e, ui) {
        $('#myHiddenInput').val(ui.value);
    }
}) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T06:24:08.173

我在我的网站上写了一篇关于使用 jQuery UI Slider 的文章，查看链接：

[http://www.ryancoughlin.com/2008/11/04/using-the-jquery-ui-slider/](http://www.ryancoughlin.com/2008/11/04/using-the-jquery-ui-slider/)

谢谢，如果您有任何问题，请告诉我，瑞安

# login - 使用 OpenID 如何处理具有相同昵称的 2 个帐户

> ID：297249
> 
> 赞同：7
> 
> 时间：2008-11-17T22:47:21.560
> 
> 标签：login, openid, registration

如果我想提供 OpenID 作为唯一可用的注册方法，并且想对昵称做一些有意义的事情，我该如何处理 2 个具有相同 Jon Smith 昵称的用户？

实际上，当我查看 StackOverflow 的 URL 架构时，我很惊讶在 URL 中使用了内部用户 ID。例如：

[https://stackoverflow.com/users/5908/z225rate](https://stackoverflow.com/users/5908/z225rate)

现在我意识到这可能是为了避免这个问题。

但这也开启了一个棘手的场景。如果用户想冒充别人怎么办？他们只需要创建一个假的 OpenID 帐户，复制昵称就可以了。当然，您可以分辨出谁在查看 OpenID 网址，但这很可能会在没有经验的用户中引起混淆。

我正在考虑在注册期间检查昵称，并强制用户拿起另一个昵称，以防它已经在使用中。但是您必须保留新昵称并使用它而不是 OpenID 中设置的昵称。不太好。

有任何想法吗？“不要使用 OpenID”不是一个（有效的）想法 :) 我的意思是，很可能我最终没有使用它，但想知道我必须走多远才能让它“正常”工作。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T22:57:15.050

您可以使用 Open ID 中的昵称并将系统中的昵称选择默认为该昵称，但不允许在您的系统中重复，因此他们将被迫为您的系统选择不同的昵称。

您仍然可以存储他们的 Open ID 昵称并使用它，因此如果您希望他们能够不惜一切代价从 OpenID 显示他们首选的昵称，对于任何欺骗用户，您可以强制显示为“OpenID Nick（您的唯一昵称）” .

因此，对于喜欢很多用户想要的昵称的任何用户，您可能会拥有 Mike (mike1)、Mike (mike2) 等。我认为这会阻止任何用户选择非唯一的昵称，因为他们不希望它以这种方式显示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T22:53:33.433

没有假 OpenID 这样的东西，基本上 OpenID 是将 URL 空间映射到用户，并有一些关于如何传递数据的交接规则。

由于没有关于如何为 OpenID 形成 URL 的标准，因此将其完整的 OpenID URL 贴在他们的名字旁边会有点难看。你已经注意到了。

您自己的内部数据应始终被认为比用户传递的 OpenID 字段更有效。如果名称已被另一个 OpenID 声明，则让用户选择另一个名称。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-07T14:41:37.407

根据我的说法，最好的方法是为每个服务提供商创建一个单独的文件夹，例如 example.com/google/username，同时这样做你不会在不同的提供商之间产生任何冲突，用户名的头疼应该由服务来完成仅提供者，如果您尝试这样做，它将是 g8 混乱和[http://stakeoverflow.com](http://stakeoverflow.com)正在做的其他方式......

# html - HTML CSS LI 包装

> ID：297251
> 
> 赞同：26
> 
> 时间：2008-11-17T22:48:22.243
> 
> 标签：html, css, html-lists

我的系统中有一个垂直菜单，它基本上由 HTML `ul`/ `li`CSS 样式组成（见下图）。但是我不希望`li`比菜单更宽的项目换行，我希望它们溢出菜单底部的水平滚动条。如何在 CSS 中做到这一点？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-17T22:56:15.987

```
ul {
  overflow: auto;  // allow li's to overflow w/ scroll bar
                   // at the bottom of the menu
}

li {
  white-space: nowrap; // stop the wrapping in the first place
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-17T22:50:26.547

使用`white-space:nowrap`. 像这样：

```
li {
  white-space:nowrap;
} 
```

这是一些[文档](https://developer.mozilla.org/en-US/docs/Web/CSS/white-space)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-17T22:57:25.423

您还需要为样式指定 ul：

```
ul{
 width:250px;
 overflow:auto;
} 
```

# asp.net-mvc - HtmlHelpers 中是否有 GetModelAttemptedValue 的简单替代方法？

> ID：297252
> 
> 赞同：1
> 
> 时间：2008-11-17T22:49:51.930
> 
> 标签：asp.net-mvc

我正在尝试创建一些 HtmlHelper 扩展并遇到了一些障碍，试图让我的扩展方法使用由 ViewData.ModelState 定义的尝试值。该[`HtmlHelper.GetModelAttemptedValue()`](http://www.codeplex.com/aspnet/SourceControl/FileView.aspx?itemId=266468&changeSetId=17272)方法标记为内部方法，不适用于我的扩展方法。MVC 中有一个简单的替代方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T23:01:33.620

我不确定你来这里是为了什么。您不能只使用 HtmlHelper 可用的 ViewData.ModelState 并自己调用 TryGetValue 吗？我知道它不是 DRY，但它似乎比尝试通过反射调用助手中的三行方法更容易。

```
public static string MyHelper( this HtmlHelper helper, string modelKey)
{
     ModelState modelState;
     if (helper.ViewData.ModelState.TryGetValue( modelKey, out modelState))
     {
        string attemptedValue = modelState.AttemptedValue;
     }
} 
```

# sql - 找出为什么 SQL 选择不返回任何数据的工具

> ID：297269
> 
> 赞同：2
> 
> 时间：2008-11-17T22:55:43.163
> 
> 标签：sql, postgresql

是否有一种工具可以告诉您（或给您提示）为什么在给定数据库中的当前数据的情况下，特定的 select 语句不会返回任何行。

例如，如果您有以下 4 个表连接

```
select * 
from a, b, c, d
where a.b_id = b.id
and b.c_id = c.id
and c.d_id = d.id 
```

如果有满足条件 a.b_id = b.id 的行也满足 b.c_id = c.id 但没有满足条件 c.d_id = d.id 的行，它将突出显示 c.d_id = d.id作为问题。

即，它将分解 where 子句并找出哪些子条件返回 true 并突出显示那些不返回 true 的子条件。

它不适用于复杂的查询，但许多选择语句是对大量表的简单连接。

这在创建测试数据以运行应用程序代码或调试实时系统问题时很有用。

图形解释工具（显示实际执行路径的计划）很接近，但它们显示的信息太多，并且不会突出显示 select 语句中缺少的链接。

我正在使用 postgres、sqllight 和 mysql，但会对其他数据库/平台的工具如何工作感兴趣。

我也对任何 manula 技术感兴趣。

还有人有这个问题吗？

如果我写了这样一个工具，会有人感兴趣吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-17T23:03:05.100

我从来没有遇到过这个问题，但我也使用显式连接，所以它通常就像运行查询的一部分一样简单，直到我发现哪个错误地限制了我的结果。

在你的情况下

```
SELECT *
FROM a -- First run just to here, are there records?
INNER JOIN b
    ON a.b_id = b.id -- Then run just to here, is it OK?
INNER JOIN c
    ON b.c_id = c.id -- Then run just to here, is it OK?
INNER JOIN d
    ON c.d_id = d.id -- Then run just to here, is it OK? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T02:03:31.290

本身没有工具可以做到这一点，因为正如其他海报所指出的那样，它很简单，只需突出显示查询的连续较大部分（如果你的格式很好，每行一个 ANDed 子句）并看看如何许多记录被返回。使连接显式在这里至关重要，因为很可能那是您丢失行的地方，而不是您的 WHERE 子句。

不过，我可以看到它是一个有趣的迷你工具，它可以将带有 n 个谓词的 SQL 查询作为输入，并在将每个单独的 AND 子句附加到语句的主干后返回计数结果图......类似于：

```
part           count
-------------- -------------
TRUNK          100
AND clause 1   90
AND clause 2   85
...            ...
AND clause n   20 
```

SQL Management Studio 可能会提供将这样的小工具作为宏插入的方法，这可能值得探索。如果您这样做，请在此处发布！:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T23:09:37.600

这将让你开始......

从 a, b 中选择 count(1) 其中 a.b_id = b.id

从 b、c 中选择 count(1) 其中 b.c_id = c.id

从 c、d 中选择 count(1)，其中 c.d_id = d.id

请注意，您使用的是 AND，因此上述查询的重叠可能不是您所期望的。

或者

使用 MS-SQL Server Management Studio... 显示“执行计划”并将鼠标悬停在“实际行数”的节点上。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T07:50:18.407

您应该能够研究执行计划（如果您使用的是 SQL Server，否则数据库中的类似功能）以查看连接在何处产生空集。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T11:00:12.673

我通常会使用[Cade Roux 描述的方法](https://stackoverflow.com/questions/297269/tool-to-find-out-why-an-sql-select-does-not-return-any-data#297289)

但理论上您可以使用以下查询：

```
SELECT a.id, b.id, c.id, d.id
FROM a 
LEFT JOIN b
    ON a.b_id = b.id
LEFT JOIN c
    ON b.c_id = c.id
LEFT JOIN d
    ON c.d_id = d.id 
```

返回所有 NULL 值的行会将您指向没有匹配数据的表。例如，如果所有 c.id 都为 null，则表示 c 表中没有匹配的记录。

当然，依赖于表 c 中记录的所有其他表也没有匹配的记录。

因此，所有空值的第一列将是开始的列。

# excel - 长数据类型溢出

> ID：297277
> 
> 赞同：2
> 
> 时间：2008-11-17T22:58:14.267
> 
> 标签：excel, vba, stack-overflow, long-integer

我正在尝试用我的 VBA excel 做一些素因数分解，我正在达到`long`数据类型的限制 -

> 运行时错误 6 溢出

有没有办法解决这个问题并仍然留在 VBA 中？我知道显而易见的是使用另一种更合适的编程语言。

* * *

[到目前为止， Lance 的解决方案](https://stackoverflow.com/a/297480/1146308)有效，我现在可以将大数字放入变量中。但是，当我尝试应用`MOD`函数时 - 例如 bignumber `MOD 2`- 它仍然失败并显示错误消息

> 运行时错误 6 溢出

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T23:10:08.143

您可以使用 Decimal 数据类型。来自谷歌的快速提示：[http ://www.ozgrid.com/VBA/convert-to-decimal.htm](http://www.ozgrid.com/VBA/convert-to-decimal.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T01:37:22.497

这是我的 Decimals.cls (VB6)：

```
VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
  Persistable = 0  'NotPersistable
  DataBindingBehavior = 0  'vbNone
  DataSourceBehavior  = 0  'vbNone
  MTSTransactionMode  = 0  'NotAnMTSObject
END
Attribute VB_Name = "Decimals"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = True
Attribute VB_Ext_KEY = "SavedWithClassBuilder6" ,"Yes"
Attribute VB_Ext_KEY = "Top_Level" ,"Yes"
Option Explicit

'local variable(s) to hold property value(s)
Private mvarDec As Variant 'local copy

Public Property Let Dec(ByVal vData As Variant)
'used when assigning a value to the property, on the left side of an assignment.
'Syntax: X.Dec = 5
    mvarDec = CDec(vData)
End Property

Public Property Get Dec() As Variant
Attribute Dec.VB_UserMemId = 0
'used when retrieving value of a property, on the right side of an assignment.
'Syntax: Debug.Print X.Dec
    Dec = CDec(mvarDec)
End Property 
```

这是一个测试程序。该类已设置好，因此您不必在 get 和 let 上使用 .Dec() 进行限定。

```
Dim dec1 As New Std.Decimals
Dim dec2 As New Std.Decimals
Dim dec3 As New Std.Decimals
Dim modulus As New Std.Decimals

Sub main()
    dec1 = "1000.000000001"
    dec2 = "1000.00000000000001"
    dec3 = dec1 + dec2
    Debug.Print dec1
    Debug.Print dec2
    Debug.Print dec3
    Debug.Print dec3 * dec3
    Debug.Print dec3 / 10
    Debug.Print dec3 / 100
    Debug.Print Sqr(dec3)
    modulus = dec1 - Int(dec1 / dec2) * dec2
    Debug.Print modulus
End Sub 
```

和样品运行

```
 1000.000000001 
 1000.00000000000001 
 2000.00000000100001 
 4000000.000004000040000001 
 200.000000000100001 
 20.0000000000100001 
 44.721359550007 
 0.00000000099999 
 1000.000000001 
 1000.00000000000001 
 2000.00000000100001 
 4000000.000004000040000001 
 200.000000000100001 
 20.0000000000100001 
 44.721359550007 
 0.00000000099999 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T07:39:30.300

这是我的“大乘法”例程，用于乘以任意大的数字（例如 100 个字符长）。它通过将输入数字（字符串）拆分为 7 位数字块来工作（因为它可以交叉乘以它们并将结果存储在 Doubles 中）。

例如 bigmultiply("1934567803945969696433","4483838382211678") = 8674289372323895422678848864807544574

```
Function BigMultiply(ByVal s1 As String, ByVal s2 As String) As String

Dim x As Long
x = 7

Dim n1 As Long, n2 As Long, n As Long
n1 = Int(Len(s1) / x + 0.999999)
n2 = Int(Len(s2) / x + 0.999999)
n = n1 + n2

Dim i As Long, j As Long
ReDim za1(n1) As Double
i = Len(s1) Mod x
If i = 0 Then i = x
za1(1) = Left(s1, i)
i = i + 1
For j = 2 To n1
 za1(j) = Mid(s1, i, x)
 i = i + x
Next j

ReDim za2(n2) As Double
i = Len(s2) Mod x
If i = 0 Then i = x
za2(1) = Left(s2, i)
i = i + 1
For j = 2 To n2
 za2(j) = Mid(s2, i, x)
 i = i + x
Next j

ReDim z(n) As Double
Dim u1 As Long, u2 As Long
Dim e As String
e = String(x, "0")

For u1 = 1 To n1
 i = u1
 For u2 = 1 To n2
   i = i + 1
   z(i) = z(i) + za1(u1) * za2(u2)
 Next u2
Next u1

Dim s As String, y As Double, w As Double, m As Long
m = n * x
s = String(m, "0")
y = 10 ^ x
For i = n To 1 Step -1
 w = Int(z(i) / y)
 Mid(s, i * x - x + 1, x) = Format(z(i) - w * y, e)
 z(i - 1) = z(i - 1) + w
Next i
'truncate leading zeros
For i = 1 To m
 If Mid$(s, i, 1) <> "0" Then Exit For
Next i
If i > m Then
 BigMultiply = ""
Else
 BigMultiply = Mid$(s, i)
End If

End Function 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T00:38:15.593

MOD 在操作之前尝试将您的 DECIMAL 类型转换为 LONG。您可能需要为 DECIMAL 类型编写自己的 MOD 函数。你可以试试这个：

```
r = A - Int(A / B) * B 
```

其中 A & B 是 VARIANT 变量的 DECIMAL 子类型，并且 r 可能也必须那么大（取决于您的需要），尽管我只测试了很长。

# sql - 将数据库表用作作业队列（又名批处理队列或消息队列）的最佳方式

> ID：297280
> 
> 赞同：25
> 
> 时间：2008-11-17T23:00:30.753
> 
> 标签：sql, database, concurrency, locking, job-queue

我有一个包含约 50K 行的数据库表，每行代表一项需要完成的工作。我有一个程序从数据库中提取工作，完成工作并将结果放回数据库。（这个系统现在正在运行）

现在我想允许一个以上的处理任务来完成工作，但要确保没有任务被完成两次（作为性能问题而不是这会导致其他问题）。因为访问是通过存储过程进行的，所以我目前的做法是用看起来像这样的东西替换所述存储过程

```
update tbl 
set owner = connection_id() 
where available and owner is null limit 1;

select stuff 
from tbl 
where owner = connection_id(); 
```

顺便提一句; 工人的任务可能会在获得工作和提交结果之间失去联系。此外，除非我把那部分搞砸（每分钟约 5 个工作），否则我不认为数据库会接近瓶颈

这有什么问题吗？有一个更好的方法吗？

注意：[“数据库作为 IPC 反模式”](http://tripatlas.com/Database_as_an_IPC)在这里只是稍微恰当，因为

1.  我没有做 IPC（没有生成行的进程，它们现在都已经存在）和
2.  针对该反模式描述的主要抱怨是，当进程等待消息时，它会导致数据库上出现不必要的负载（在我的情况下，如果没有消息，一切都可以在完成后关闭）

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2019-04-16T07:04:24.867

在关系数据库系统中实现作业队列的最佳方式是使用[`SKIP LOCKED`](https://vladmihalcea.com/database-job-queue-skip-locked/).

`SKIP LOCKED`是一种锁获取选项，适用于读/共享 ( `FOR SHARE`) 或写/独占 ( `FOR UPDATE`) 锁，现在得到广泛支持：

*   Oracle 10g 及更高版本
*   PostgreSQL 9.5 及更高版本
*   SQL Server 2005 及更高版本
*   MySQL 8.0 及更高版本

现在，考虑我们有下`post`表：

[![发布表](https://i.stack.imgur.com/hcuSJ.png)](https://vladmihalcea.com/database-job-queue-skip-locked/)

该`status`列用作`Enum`，具有以下值：

*   `PENDING`(0),
*   `APPROVED`(1),
*   `SPAM`(2)。

如果我们有多个并发用户尝试审核`post`记录，我们需要一种方法来协调他们的努力，以避免让两个审核者审核同一`post`行。

所以，`SKIP LOCKED`这正是我们所需要的。如果两个并发用户 Alice 和 Bob 执行以下 SELECT 查询，这些查询将独占锁定帖子记录，同时还添加了`SKIP LOCKED`选项：

```
[Alice]:
SELECT
    p.id AS id1_0_,1
    p.body AS body2_0_,
    p.status AS status3_0_,
    p.title AS title4_0_
FROM
    post p
WHERE
    p.status = 0
ORDER BY
    p.id
LIMIT 2
FOR UPDATE OF p SKIP LOCKED

[Bob]:                                                                                                                                                                                                              
SELECT
    p.id AS id1_0_,
    p.body AS body2_0_,
    p.status AS status3_0_,
    p.title AS title4_0_
FROM
    post p
WHERE
    p.status = 0
ORDER BY
    p.id
LIMIT 2
FOR UPDATE OF p SKIP LOCKED 
```

我们可以看到 Alice 可以选择前两个条目，而 Bob 选择接下来的 2 条记录。如果没有`SKIP LOCKED`，Bob 的锁获取请求将被阻塞，直到 Alice 释放前 2 条记录的锁。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-17T23:31:54.090

这是我过去成功使用的：

MsgQueue 表架构

```
MsgId identity -- NOT NULL
MsgTypeCode varchar(20) -- NOT NULL  
SourceCode varchar(20)  -- process inserting the message -- NULLable  
State char(1) -- 'N'ew if queued, 'A'(ctive) if processing, 'C'ompleted, default 'N' -- NOT NULL 
CreateTime datetime -- default GETDATE() -- NOT NULL  
Msg varchar(255) -- NULLable 
```

您的消息类型是您所期望的 - 符合插入过程和读取过程之间的约定的消息，使用 XML 或您选择的其他表示形式进行结构化（在某些情况下 JSON 会很方便，例如实例）。

然后可以插入 0 到 n 进程，并且可以读取和处理消息的 0 到 n 进程，每个读取进程通常处理单个消息类型。一个进程类型的多个实例可以运行以实现负载平衡。

阅读器拉出一条消息并将状态更改为“A”ctive，同时它正在处理它。完成后，它将状态更改为“C”完成。它可以删除或不删除消息，具体取决于您是否要保留审计跟踪。State = 'N' 的消息按 MsgType/Timestamp 顺序拉取，因此在 MsgType + State + CreateTime 上有一个索引。

变化：
“E”错误的状态。
Reader 进程代码列。
状态转换的时间戳。

这为执行您所描述的许多事情提供了一个很好的、可扩展的、可见的、简单的机制。如果您对数据库有基本的了解，那么它非常简单且可扩展。

* * *

评论中的代码：

```
CREATE PROCEDURE GetMessage @MsgType VARCHAR(8) ) 
AS 
DECLARE @MsgId INT 

BEGIN TRAN 

SELECT TOP 1 @MsgId = MsgId 
FROM MsgQueue 
WHERE MessageType = @pMessageType AND State = 'N' 
ORDER BY CreateTime

IF @MsgId IS NOT NULL 
BEGIN 

UPDATE MsgQueue 
SET State = 'A' 
WHERE MsgId = @MsgId 

SELECT MsgId, Msg 
FROM MsgQueue 
WHERE MsgId = @MsgId  
END 
ELSE 
BEGIN 
SELECT MsgId = NULL, Msg = NULL 
END 

COMMIT TRAN 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T23:13:34.830

与其不拥有 owner = null ，不如将其设置为假的 nobody 记录。搜索 null 不会限制索引，您最终可能会进行表扫描。（这是针对 oracle 的，SQL server 可能不同）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T23:55:19.503

就像可能的技术变化一样，您可能会考虑使用 MSMQ 或类似的东西。

您的每个作业/线程都可以查询消息队列以查看是否有新作业可用。因为读取消息的行为会将其从堆栈中删除，所以您可以确保只有一个作业/线程会收到消息。

当然，这是假设您使用的是 Microsoft 平台。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-10-26T09:23:12.570

有关上下文，请参阅 Vlad 的答案，我只是在 Oracle 中添加等价物，因为有一些“陷阱”需要注意。

这

```
SELECT * FROM t order by x limit 2 FOR UPDATE OF t SKIP LOCKED 
```

不会以您可能期望的方式直接转换为 Oracle。如果我们看一些翻译选项，我们可能会尝试以下任何一种：

```
SQL> create table t as
  2   select rownum x
  3   from dual
  4   connect by level <= 100;

Table created.

SQL> declare
  2    rc sys_refcursor;
  3  begin
  4    open rc for select * from t order by x for update skip locked fetch first 2 rows only;
  5  end;
  6  /
  open rc for select * from t order by x for update skip locked fetch first 2 rows only;
                                                                *
ERROR at line 4:
ORA-06550: line 4, column 65:
PL/SQL: ORA-00933: SQL command not properly ended
ORA-06550: line 4, column 15:
PL/SQL: SQL Statement ignored

SQL> declare
  2    rc sys_refcursor;
  3  begin
  4    open rc for select * from t order by x fetch first 2 rows only for update skip locked ;
  5  end;
  6  /
declare
*
ERROR at line 1:
ORA-02014: cannot select FOR UPDATE from view with DISTINCT, GROUP BY, etc.
ORA-06512: at line 4 
```

或者尝试回退到 ROWNUM 选项

```
SQL> declare
  2    rc sys_refcursor;
  3  begin
  4    open rc for select * from ( select * from t order by x ) where rownum <= 10 for update skip locked;
  5  end;
  6  /
declare
*
ERROR at line 1:
ORA-02014: cannot select FOR UPDATE from view with DISTINCT, GROUP BY, etc.
ORA-06512: at line 4 
```

你不会得到任何快乐。因此，您需要自己控制“n”行的获取。因此，您可以编写如下代码：

```
SQL> declare
  2    rc sys_refcursor;
  3    res1 sys.odcinumberlist := sys.odcinumberlist();
  4  begin
  5    open rc for select * from t order by x for update skip locked;
  6    fetch rc bulk collect into res1 limit 10;
  7  end;
  8  /

PL/SQL procedure successfully completed. 
```

* * *

## 回答 #6

> 赞同：-6
> 
> 时间：2008-11-17T23:06:28.183

您正在尝试实施 de“数据库作为 IPC”反模式。查看它以了解为什么您应该考虑正确地重新设计您的软件。

# python - 将命令行生成的 python .coverage 文件与 PyDev 集成

> ID：297294
> 
> 赞同：2
> 
> 时间：2008-11-17T23:04:50.073
> 
> 标签：python, eclipse, code-coverage, pydev, python-coverage

我的构建环境配置为在命令行编译、运行和创建覆盖文件（使用 Ned Batchelder coverage.py 工具）。

我使用 Eclipse 和 PyDev 作为我的编辑器，但出于实际原因，我不可能/不方便将整个构建环境转换为 Eclipse（因此直接从 IDE 生成覆盖数据，因为它的设计目的是这样做）

PyDev 似乎使用相同的覆盖工具（或与之非常相似的工具）来生成它的覆盖信息，所以我猜应该有某种方法可以将我的外部覆盖文件集成到 Eclipse/PyDev 中。

关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T03:15:32.220

我对 PyDev 对 coverage.py 的集成一无所知（或者它是否甚至使用 coverage.py），但 .coverage 文件非常简单。它们是编组的字典。

我没有测试过这段代码，但你可以尝试将两个 .coverage 文件合并为一个：

```
import marshal
c1_dict = marshal.load(open(file_name_1, 'rb'))
c2_dict = marshal.load(open(file_name_2, 'rb'))
c1_dict.update(c2_dict)
marshal.dump(c1_dict, open(file_name_out, 'wb')) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T22:35:08.560

前段时间我确实需要这样的东西，当时 PyDev 仍然使用`coverage.py`比从脚本创建者页面访问的版本更旧的版本。

我所做的是检测 PyDev 保存`.coverage`文件的位置。对我来说是：

```
 C:\Users\Admin\workspace\.metadata\.plugins\org.python.pydev.debug\.coverage 
```

然后我从一个单独的脚本手动运行一个新版本，`coverage.py`并告诉它把它的 .coverage 文件保存在 PyDev 保存它的地方。我不记得是否有命令行参数，`coverage.py`或者我只是`.coverage`用脚本复制了文件，但在那之后，如果你只是打开**代码覆盖结果视图**并单击**刷新覆盖信息！**, PyDev 将很好地处理数据，就像它自己生成文件一样。

# iphone - UITableView 标头中的 UIButton 忽略大多数触摸

> ID：297297
> 
> 赞同：15
> 
> 时间：2008-11-17T23:07:14.280
> 
> 标签：iphone, cocoa-touch, uitableview

我有一个按钮，我将其添加为表格视图的 tableHeaderView 的子视图。该按钮看起来很好，并且点击并按住它会间歇性地工作 - 但在大多数情况下，它没有响应。我尝试将其添加为表格本身的子视图；效果差不多。我认为问题可能出在滚动视图的触摸拦截上，但是在表格上禁用滚动也没有效果。

难道我做错了什么？有人遇到过这种情况么？

编辑-澄清一下，我说的是分组样式表中的主表标题，而不是部分标题；认为基本上是仿照“联系人”屏幕。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-01-01T18:25:24.253

我有同样的问题。在我的例子中，我有一个在 IB 中实例化的容器视图（在代码中用作表视图标题），UIImageView 占据了该容器的整个框架。行为不端的按钮位于图像视图中。

事实证明，我需要在 IB 中设置尺寸支柱，如下所示...

容器视图：外部锚点全部打开，内部调整大小 - 全部关闭

子图像视图：所有支柱（内部和外部）

我有几个不同的表格视图，都使用标题视图。有些会正确响应触摸事件，有些则不稳定。这解决了我的问题

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-10-25T23:44:16.733

我有一个类似的问题 - 视图内的文本字段和按钮设置为表头视图，不会响应触摸事件。setAutoResizing 以编程方式为我工作。

我的控制器扩展了 UITableViewController，viewDidLoad 看起来像这样：

```
- (void)viewDidLoad
{
    [super viewDidLoad];

    MYCustomWidget *headerView = [[[NSBundle mainBundle] 
               loadNibNamed:@"MYCustomWidgetView" owner:self options:nil] 
               objectAtIndex:0];

    [headerView setAutoresizingMask:UIViewAutoresizingNone];

    self.tableView.tableHeaderView = headerView;
} 
```

（'MYCustomWidget' 扩展了 UIView，'MYCustomWidgetView' 是一个 XIB 文件）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-19T05:14:28.687

我完全不同意 Wisequark ——在 tableHeaderView 中放置一个按钮绝对*没有错，并且包含一个按钮**不会*冒您的应用被应用商店拒绝的风险。tableHeaderView 被设计为包含您选择的任何元素的任意视图。

就您的问题而言，可能是您有一个视图遮挡了您的按钮，或者，它可能只是一个应该报告给 Apple 的错误。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-09-30T12:15:17.133

奇怪的是，但表头视图的大小显然不正确。我使用自动布局，所以自动调整蒙版对我来说不是一个选项。检查我的视图层次结构后： [![在此处输入图像描述](https://i.stack.imgur.com/37Yqw.png)](https://i.stack.imgur.com/37Yqw.png)

并注意到我的自定义标题视图的高度不正确，因此只有不到一半是可点击的（请参阅突出显示的视图）：

[![在此处输入图像描述](https://i.stack.imgur.com/iBvFR.png)](https://i.stack.imgur.com/iBvFR.png)

手动更新其高度解决了这个问题：

```
- (void)viewDidLayoutSubviews {
    CGRect frame = self.tableView.tableHeaderView.frame;
    frame.size.height = 116.0;
    self.tableView.tableHeaderView.frame = frame;
} 
```

[![在此处输入图像描述](https://i.stack.imgur.com/U9ArU.png)](https://i.stack.imgur.com/U9ArU.png)

此外，更改方向后，表格视图标题高度可能会变得无效。这个问题也可以通过提供的解决方案来解决。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-10T23:42:29.750

我的情况与 Danny Hall 的情况相似（表头视图是 UIImageView，并且有一个 UIButton，它是 UIImageView 的子视图）。就我而言，问题似乎是由按钮是图像视图的子视图引起的。对我有用的是创建一个 UIView “包含”视图，这样图像视图和按钮都是“包含”视图的子视图。奇怪的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-10-25T12:53:48.307

**tableHeaderView在****UITableView**中处理绘制时的**高度**为0

 **使用此**UIView**子类设置强常量高度，忽略**UITableView**处理

```
#import <UIKit/UIKit.h>                                                
@interface CustomHeaderCell : UIView

@end  

//-----

@import "CustomHeaderCell.h"

@implementation CustomHeaderCell

-(void)setFrame:(CGRect)frame {
    frame.size.height = 43; // !!! constant height
    [super setFrame:frame];
}

@end 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-04-17T08:01:25.320

我有相同的问题操作在标题视图`UIButtons`中不起作用。`UITableView's`首先，我尝试`setAutoresizingMask`了`.None`哪个不起作用，然后在阅读了@Davyd 和@Alexey 的答案后，我意识到我没有设置标题视图的高度，然后我将其设置为：-

```
self.tablevwMain.tableHeaderView?.frame = CGRect(x: 0, y: 0, width: width_view, height: your_height) 
```

并且所有`UIButton's`内部`UITableView's`标题视图都可以正常工作。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2015-10-16T19:07:21.777

不要忘记将页脚高度设置为：

```
-(CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section{ 
```

* * *

## 回答 #9

> 赞同：-9
> 
> 时间：2008-11-17T23:43:58.123

您应该考虑到这不是 headerView 的预期起诉，并且诸如此类的实现可能会由于 HIG 违规而导致 AppStore 拒绝。鉴于标题的尺寸旨在很小，最好考虑重组您的视图。话虽如此，除了手动检测触摸事件并自己确定几何形状，然后根据几何形状执行选择器 - 简而言之，滚动您自己的按钮类，没有简单的方法可以做到这一点。

# visual-studio - 如何更改默认浏览器以在 Visual Studio 2008 中进行调试？

> ID：297298
> 
> 赞同：68
> 
> 时间：2008-11-17T23:08:33.577
> 
> 标签：visual-studio, visual-studio-2008, debugging, browser

当你按下 F5 时，会弹出浏览器窗口，在 Visual Studio 2008 中如何设置调试器用户使用哪个浏览器？

**更新 1**
我一直在寻找“浏览方式”选项，但没有找到。
[Visual Studio 打开默认浏览器而不是 Internet Explorer](https://stackoverflow.com/questions/79954/visual-studio-opens-default-browser-instead-of-ie)

**更新 2**
如果您已经在调试，则没有“浏览方式”选项。

*   *停止调试，然后它就在那里！*

**更新 3**
下面接受的答案也与更改默认浏览器以在 Visual Studio 2010 中进行调试有关。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-11-17T23:11:04.647

*   （在“项目解决方案”窗口中）右键单击页面（.aspx 或文件夹）
*   选择浏览方式...
*   选择您的浏览器
*   单击设置为默认值
*   点击浏览

![上下文菜单屏幕截图](https://i.stack.imgur.com/b1Wxe.png)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-02-01T11:16:42.683

**ASP.NET**项目：

*   右键单击网页（.aspx 或文件夹）
*   选择浏览方式...
*   选择您的浏览器
*   单击设置为默认值
*   点击浏览

**ASP.NET MVC 1**项目：

右键单击 Default.aspx，然后按照上述步骤操作。

**ASP.NET MVC 2**项目：

由于没有 Default.aspx，您需要创建一个 Web 窗体（右键单击项目 > 添加 > 新建项目）并按照上述步骤操作。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-09-01T16:55:39.617

如果你使用 ASP-NET MVC，你需要右键单击 Default.ASPX，它会有一个 Browse With 菜单。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-06T07:55:44.710

要永久让 Visual Studio 在 IE 中打开项目而不更改默认浏览器，您可以执行以下操作：

`Project Properties -> Web -> Start Action`

启动外部程序：C:\Program Files\Internet Explorer\iexplore.exe 命令行参数：输入起始页路径的 url，即 http:\localhost\myproject\default.aspx

但是，这将不允许您在 Visual Studio 中调试客户端脚本。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-07-05T16:22:53.973

如果您使用的是 MVC 2，则不需要创建另一个项目，只需将组件 -> webform 添加到项目中即可：

> ```
> * Right click the webform  
> * Select Browse With...  
> * Choose your browser  
> * Click Set as Default  
> * Delete the webform 
> ```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-22T22:35:12.610

如果您使用 MVC，则没有此菜单（没有“浏览方式...”菜单）

首先创建一个普通的 ASP.NET 网站。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-05-19T01:16:26.883

我在VS2012中通过了这个问题。当我在项目的右键单击中找不到“Browse with..”时，我在 File Menu -> Browse with 上找到了它。如果它没有出现，首先你必须点击菜单栏，然后​​再次尝试打开文件菜单。如果它仍然没有出现，您可以转到菜单栏右上角的快速启动，然后键入“浏览方式”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-04T09:28:49.427

`In VS 2010 just make the browser as your default broswer in which you want to run your application and there is no need to set anything in visual studio.` 我为谷歌浏览器做了它，它为我工作。我刚刚将谷歌浏览器设置为我的默认浏览器并且它工作正常。我几乎可以肯定这也应该在 VS 2008 中工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-12-10T09:27:11.243

首先单击显示所有文件。然后在 bin 文件夹中选择任何 xml 文件，然后右键单击并通过选择“浏览方式”选择所需的浏览器。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-02-20T16:31:11.090

我发现`Browse With..`菜单项只出现在 Visual Studio 2010 中，当我`Run as administrator`. 在这种情况下，即使**在**调试模式下也可以使用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-05-24T15:25:06.200

更简单的方法是选择 Start Debugging 旁边的箭头：

[![开始调试](https://i.stack.imgur.com/jI3S8.png)](https://i.stack.imgur.com/jI3S8.png)

然后在下拉菜单中`Web Browser`选择您想要调试站点的浏览器，您还可以选择`Browse with...`设置默认值，如其他答案中所述。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2010-08-20T03:37:25.627

即 ---> 工具 ----> Internet 选项 -----> 程序 ------> 设为默认值

# c# - Get the Enum value Description

> ID：297299
> 
> 赞同：5
> 
> 时间：2008-11-17T23:08:37.490
> 
> 标签：c#, enums, generics, bindinglist

I have my enumHelper class that contains these:

```
public static IList<T> GetValues()
{
  IList<T> list = new List<T>();
  foreach (object value in Enum.GetValues(typeof(T)))
  {
    list.Add((T)value);
  }
  return list;
} 
```

and

```
public static string Description(Enum value)
{
  Attribute DescAttribute = LMIGHelper.GetAttribute(value, typeof(DescriptionAttribute));
  if (DescAttribute == null)
    return value.ToString();
  else
    return ((DescriptionAttribute)DescAttribute).Description;
} 
```

my enum is something like:

```
public enum OutputType
{
    File,
    [Description("Data Table")]
    DataTable
} 
```

So far so good. All the previous work fine. Now I want to add a new helper to return BindingList>, so I can link any enum to any combo using

```
BindingList<KeyValuePair<OutputType, string>> list = Enum<OutputType>.GetBindableList();
cbo.datasource=list;
cbo.DisplayMember="Value";
cbo.ValueMember="Key"; 
```

For that I added:

```
public static BindingList<KeyValuePair<T, string>> GetBindingList()
{
    BindingList<KeyValuePair<T, string>> list = new BindingList<KeyValuePair<T, string>>();
    foreach (T value in Enum<T>.GetValues())
    {
        string Desc = Enum<T>.Description(value);
        list.Add(new KeyValuePair<T, string>(value, Desc));
    }
    return list;
} 
```

But "Enum.Description(value)" is not even compiling: Argument '1': cannot convert from 'T' to 'System.Enum'

How can I do that? Is that even possible?

Thank you.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T06:38:58.327

看看这篇[文章](http://www.codeproject.com/KB/cs/enumdatabinding.aspx)。您可以使用 System.ComponentModel.DescriptionAttribute 或创建自己的属性来执行此操作：

```
/// <summary>
/// Provides a description for an enumerated type.
/// </summary>
[AttributeUsage(AttributeTargets.Enum | AttributeTargets.Field, 
 AllowMultiple = false)]
public sealed class EnumDescriptionAttribute :  Attribute
{
   private string description;

   /// <summary>
   /// Gets the description stored in this attribute.
   /// </summary>
   /// <value>The description stored in the attribute.</value>
   public string Description
   {
      get
      {
         return this.description;
      }
   }

   /// <summary>
   /// Initializes a new instance of the
   /// <see cref="EnumDescriptionAttribute"/> class.
   /// </summary>
   /// <param name="description">The description to store in this attribute.
   /// </param>
   public EnumDescriptionAttribute(string description)
       : base()
   {
       this.description = description;
   }
} 
```

然后，您需要使用这个新属性来装饰枚举值：

```
public enum SimpleEnum
{
   [EnumDescription("Today")]
   Today,

   [EnumDescription("Last 7 days")]
   Last7,

   [EnumDescription("Last 14 days")]
   Last14,

   [EnumDescription("Last 30 days")]
   Last30,

   [EnumDescription("All")]
   All
} 
```

所有的“魔法”都发生在以下扩展方法中：

```
/// <summary>
/// Provides a static utility object of methods and properties to interact
/// with enumerated types.
/// </summary>
public static class EnumHelper
{
   /// <summary>
   /// Gets the <see cref="DescriptionAttribute" /> of an <see cref="Enum" /> 
   /// type value.
   /// </summary>
   /// <param name="value">The <see cref="Enum" /> type value.</param>
   /// <returns>A string containing the text of the
   /// <see cref="DescriptionAttribute"/>.</returns>
   public static string GetDescription(this Enum value)
   {
      if (value == null)
      {
         throw new ArgumentNullException("value");
      }

      string description = value.ToString();
      FieldInfo fieldInfo = value.GetType().GetField(description);
      EnumDescriptionAttribute[] attributes =
         (EnumDescriptionAttribute[])
       fieldInfo.GetCustomAttributes(typeof(EnumDescriptionAttribute), false);

      if (attributes != null && attributes.Length > 0)
      {
         description = attributes[0].Description;
      }
      return description;
   }

   /// <summary>
   /// Converts the <see cref="Enum" /> type to an <see cref="IList" /> 
   /// compatible object.
   /// </summary>
   /// <param name="type">The <see cref="Enum"/> type.</param>
   /// <returns>An <see cref="IList"/> containing the enumerated
   /// type value and description.</returns>
   public static IList ToList(this Type type)
   {
      if (type == null)
      {
         throw new ArgumentNullException("type");
      }

      ArrayList list = new ArrayList();
      Array enumValues = Enum.GetValues(type);

      foreach (Enum value in enumValues)
      {
         list.Add(new KeyValuePair<Enum, string>(value, GetDescription(value)));
      }

      return list;
   }
} 
```

最后，您可以简单地绑定组合框：

```
combo.DataSource = typeof(SimpleEnum).ToList(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T23:57:39.140

你应该改变：

```
public static string Description(Enum value)
{
  ...
} 
```

至

```
public static string Description(T value)
{
   ...
} 
```

所以它接受枚举的值。现在这里是棘手的地方：你有一个值，但属性装饰**了保存该值的字段**。

您实际上需要反映枚举的字段并检查每个字段的值与您给出的值（应缓存结果以提高性能）：

```
foreach(var field in typeof(T).GetFields())
{
    T fieldValue;

    try
    {
        fieldValue = (T) field.GetRawConstantValue();
    }
    catch(InvalidOperationException)
    {
        // For some reason, one of the fields returned is {Int32 value__},
        // which throws an InvalidOperationException if you try and retrieve
        // its constant value.
        //
        // I am unsure how to check for this state before
        // attempting GetRawConstantValue().

        continue;
    }

    if(fieldValue == value)
    {
        var attribute = LMIGHelper.GetAttribute(field, typeof(DescriptionAttribute)) as DescriptionAttribute;

        return attribute == null ? value.ToString() : attribute.Description;
    }
} 
```

**编辑解决后续问题**

该`FillComboFromEnum`方法缺少枚举的类型参数。尝试这个：

```
public static void FillComboFromEnum<T>(ComboBox Cbo, BindingList<KeyValuePair<T, string>> List) where T : struct 
```

请注意，我将类型限制为结构。这不是一个完整的枚举约束，但它比没有更接近。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-17T23:23:25.527

Enum 没有 Description() 方法。您能做的最好的事情就是让您的枚举实现一个具有 Description() 方法的接口。如果你这样做，那么你可以拥有

```
public static BindingList<KeyValuePair<T extends _interface_, String>> getBindingList() 
```

然后在里面你可以参考

```
T foo = ...?
foo.Description(...); 
```

# java - PrintWriter 和 PrintStream 从不抛出 IOExceptions

> ID：297303
> 
> 赞同：23
> 
> 时间：2008-11-17T23:09:44.103
> 
> 标签：java, api, exception

几天前，我意识到[PrintWriter](http://java.sun.com/javase/6/docs/api/java/io/PrintWriter.html)（以及[PrintStream](http://java.sun.com/javase/6/docs/api/java/io/PrintStream.html)）在写入、刷新或关闭时**从不抛出 IOException 。**

`trouble=true`相反，它会在发生错误时设置一个内部标志 ( )。
不可能得到确切的异常，但前提**是**存在一些异常（[checkError()](http://java.sun.com/javase/6/docs/api/java/io/PrintWriter.html#checkError())）。

我的问题是：为什么会有这样的行为？这不是糟糕的 API 设计吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-18T02:10:27.280

我认为由于`System.out`和`System.err`是 的实例`PrintStream`，因此提供了一些更宽松的错误处理。正如其他海报所提到的，这可能是为了让那些在 1995 年左右从 C/C++ 过渡的人铺平道路。添加 Reader/Writer API 时，`PrintWriter`它被创建为与现有的`PrintStream`.

非常需要这种行为的一个应用程序是日志记录。日志记录是大型应用程序的辅助功能。通常，如果日志记录失败，人们不希望整个应用程序失败。`System.err`因此，至少忽略异常是有意义的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-18T02:13:03.127

我想知道是否因为检查了 IOExceptions，这将需要您在每个 System.out 周围放置一个 try catch 块。称呼。

更新：或者抛出你的方法签名。

那会很快变得烦人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T23:47:46.710

我真的不知道这个故事，但我认为这是为了让新程序员更容易使用 Java，设计人员希望能够使用简单的 stdio 打印方法而无需知道异常是什么。所以在这方面它是一个很好的设计（虽然我同意你的观点）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-10-13T09:47:23.420

Sun / Oracle 应该添加两个类写函数，一个抛出 IOException，另一个不抛出任何东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T00:44:36.953

设计可能是由具有 C 背景的人完成的，其中 stdio 错误以类似的方式处理。由于我习惯了那种范式，我不会说它不好，但我同意它是不一致的。

我也同意关于试图使 PrintWriter 更易于使用的评论。Java 中的 IO 类令人困惑（至少对于我认识的每个人来说），也许有人只是想让生活变得更轻松一些。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-06-20T07:22:24.103

这不是设计错误。这是一种适当的设计，适用于编写输出并且希望忽略错误的情况。

作为一个典型的用例，`System.out`和`System.err`已经被提及，但原因不是为了*方便*或*平滑的 C/C++ 转换而**放松处理*。这是对这种情况的理想处理：

 ***   您在控制台中启动应用程序
*   它产生输出到标准输出/错误
*   您关闭控制台，但您希望应用程序在后台继续运行

在这种情况下，根据系统实现，在控制台关闭后可能会发生这种情况`System.out`或`System.err`失败，但您不希望这会导致您的应用程序崩溃。该应用程序希望继续在后台运行，并且输出旨在被抓取。就是`PrintWriter`这样。

如果您关心输出期间的错误，请使用`FileWriter`或`OutputStreamWriter`。如果您需要某些在 中可用和在 中`PrintWriter`不可用的方法`FileWriter`，请创建自己的 TextWriter 扩展`FileWriter`或`OutputStreamWriter`.

# flash - 在 Actionscript 中操作 URL 的哈希/锚点部分

> ID：297315
> 
> 赞同：2
> 
> 时间：2008-11-17T23:15:29.427
> 
> 标签：flash, actionscript-3, url, actionscript-2

如何在纯 Actionscript 中获取和设置 URL 的哈希或锚部分？在谷歌搜索解决方案时，我发现了使用 JavaScript 进行此操作的解释，但是否可以不使用 JavaScript 来获得它？（我正在使用 Actionscript 2，我可能会考虑将代码更新到 AS 3，但这似乎不是一个非常直接的过程。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T07:54:19.070

您想要的是[SWFAdress](http://www.asual.com/swfaddress/)，它是一个小型库，可让您从 flash 中修改 url 的那部分（通过 javascript）

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-05T17:56:51.527

如果您曾经使用过 actionscript3，您可以使用[com.adobe.net.URI 类](http://weblogs.macromedia.com/as_libraries/docs/corelib/com/adobe/net/URI.html)。它公开了一个 URI::fragment getter/setter，看起来正是您所需要的。

# c# - 与标准 C++ 或 C# 相比，使用 C++/CLI 有什么优势吗？

> ID：297323
> 
> 赞同：5
> 
> 时间：2008-11-17T23:19:30.387
> 
> 标签：c#, .net, c++, windows, c++-cli

我没有看到任何真正的优势，除了您拥有 C++ 语法，以及诸如指针和析构函数之类的东西。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-17T23:38:03.313

如果您在谈论为什么要使用 C++/CLI 而不是 C#，我认为主要原因是：

1.  对于 C++ 开发人员来说，这可能更自然（尽管我认为这可能不是真的）
2.  C++/CLI 具有非常好的桥接本机和托管环境的功能（使用“IJW”-它只是工作-技术）

我认为 Herb Sutter 可能给出了最好的概述：

[C++/CLI 的设计原理](http://www.gotw.ca/publications/C++CLIRationale.pdf)

如果您想知道为什么要在 C#/.NET 上使用本机 C++，这归结为为什么您需要托管环境（安全、更容易开发）而不是本机代码（绝对控制，可能具有速度优势）。每个都有争论，答案实际上取决于您想要开发什么以及您的市场可能是什么。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-17T23:36:50.790

我认为您指的是 C++/CLI 并将其与 C# 进行比较。C++/CLI 不是 C++ 的“风味”。它是一种全新的语言，具有完全不同的标准库和完全不同的约定。

在工作中，我们发现 C++/CLI 作为 C++ 和 .NET 之间的胶水语言很有价值，但除了接口胶水之外，我们不将它用于任何其他用途 - 在所有其他应用程序中，C# 比 C++ 具有巨大优势。

如果您指的是 Adam 所描述的 MS C++ 扩展，那么如果它们使您的工作更轻松，就没有理由不使用它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-26T16:45:18.040

使用 C++\CLI 的真正好理由是将 DotNet 语言与 Native C++ 进行交流，例如，许多公司首先将其 GUI 迁移到 .Net 并在 C++ 中使用一些逻辑，而 C++\CLI 是在两种技术之间进行交流的良好桥梁，您也可以为此使用 COM 组件，但由于许多原因，这不是一个好的选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T23:21:41.443

我不认为将不同风格的 C++ 相互比较与将 C++ 与 C# 比较是同一个问题。与不同风格的 C++ 之间的差异相比，C# 是一个非常不同的野兽。

# c# - 如何利用反射打造“反射机器”

> ID：297328
> 
> 赞同：12
> 
> 时间：2008-11-17T23:21:54.343
> 
> 标签：c#, reflection

好的，所以这个标题有点糟糕，但我想不出更好的东西（也许其他人可以？）。

所以我对这里的一个主题有几个问题。我想做的是创建一个程序，它可以获取一个对象并使用反射来列出它的所有属性、方法、构造函数等。然后我可以在运行时操作这些对象来测试、调试和弄清楚我的一些类/程序在运行时正在执行，（其中一些将是 Windows 服务，可能安装在机器上，而不是在 VS 的调试中运行）。

所以我会为程序提供一个挂钩，从本地机器（仅）这个程序可以获得主对象的一个​​实例，因此可以看到所有在其中运行的子对象。（为了安全起见，程序可能需要以 arg 启动以公开该钩子）。

“反射机器”将允许运行时操作和询问。

这听起来可能吗？

程序是否必须提供一个钩子，或者“反射机器”是否可以获取一个 EXE 并且（如果它知道它正在使用的所有类），创建一个要使用的对象？

我知道您可以在运行时导入 DLL，以便它了解各种类，但是您可以导入单个类吗？IE 假设我有项目'Y'，它没有编译成 DLL，但我想在它上面使用“反射机”，我可以指向那个目录并抓取文件以便能够引用这些类吗？

编辑：我很想尝试自己开发它，但我已经有一长串我想做并且已经开始的项目。当已经有很多选择可供选择时，为什么要重新发明轮子。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-17T23:32:44.323

尝试查看[Crack.NET](http://www.codeplex.com/cracknetproject/Release/ProjectReleases.aspx?ReleaseId=19002)。它用于在 WPF/WinForms 上进行运行时操作和询问，但源代码可用，如果它已经不能满足您的需求，它可能是一个好的开始。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T23:41:27.223

听起来 Corneliu Tusnea 的[Hawkeye](http://www.acorns.com.au/Projects/Hawkeye/)可能与您正在寻找的对象/属性/等的运行时询问很接近。他称其为 .NET 运行时对象编辑器。我不确定我上面链接到的主页或[CodePlex 项目](http://www.codeplex.com/hawkeye)是否是最好的起点。

我认为它现在有点过时了，但[在 CodeProject 上有它的早期版本，](http://www.codeproject.com/KB/cs/RuntimeObjectEditor.aspx)您可以在其中查看源代码，了解他是如何以及做了什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T23:35:17.780

如果我正确理解您在说什么，Powershell 实际上几乎可以完成所有这些工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-30T17:48:23.767

有关如何构建[“反射引擎”的信息，请参阅此答案。](https://stackoverflow.com/questions/1353022/reflection-support-in-c/1353133#1353133)

我认为，您需要做的就是将该组机器放入您的一组可用运行时库中，它会做您想做的事情。（这可能不像我在实践中所说的那么容易）。

我的猜测是你还需要一个运行时编译器，这样你就可以制造被检查程序的检测/转换变体来收集你想要的运行时数据。您可能会发现此类机器提供的静态分析结果让您在许多情况下避免进行运行时分析。

# code-generation - CodeDOM 和 .Net 模块

> ID：297330
> 
> 赞同：0
> 
> 时间：2008-11-17T23:22:35.293
> 
> 标签：code-generation, codedom, runtime-compilation

如何以编程方式将 .Net 模块嵌入到 CodeDOM 生成的程序集中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-02-03T13:49:38.203

在 VB 上

```
dim param as CompilerParameteres

param.EmbeddedResources.Add("dynamiclinklibrary") 
```

# c# - 一般枚举 .Net 控件的项目（MenuStrip、ToolStrip、StatusStrip）

> ID：297335
> 
> 赞同：2
> 
> 时间：2008-11-17T23:23:52.250
> 
> 标签：c#, .net-2.0

我有一些代码通常会在一个表单中获取所有控件并将它们放在一个列表中。这是一些代码：

```
 private List<Control> GetControlList(Form parentForm)
        {
            List<Control> controlList = new List<Control>();
            AddControlsToList(parentForm.Controls, controlList);

            return controlList;
        }

        private void AddControlsToList(Control.ControlCollection rootControls, List<Control> controlList)
        {
            foreach (Control c in rootControls)
            {
                controlList.Add(c);
                if (c.HasChildren)
                    AddControlsToList(c.Controls, controlList);
                //
            }
        } 
```

所以我只能使用 c.HasChildren 来检查这个根控件是否还有更多的子控件。

**menuStrip、toolStrip 和 statusStrip 呢？我如何获得这些控件中的所有控件？例如：MenuStripItem**

我知道我可以尝试测试 c.GetType() == typeof(MenuStrip) 但我希望不必进行特定的类型测试。

如果我需要提供更多信息，请询问。

谢谢一堆

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-17T23:41:49.467

我相信 VS 设计器通过获取控件设计器的实例来做到这一点（请参阅[`Designer`属性](http://msdn.microsoft.com/en-us/library/system.componentmodel.designerattribute.aspx)），并且，如果设计器是 a [`ComponentDesigner`](http://msdn.microsoft.com/en-us/library/system.componentmodel.design.componentdesigner.aspx)，则获取[`AssociatedComponents`](http://msdn.microsoft.com/en-us/library/system.componentmodel.design.componentdesigner.associatedcomponents.aspx)属性。

**编辑**：

好吧，我想这有点模糊。但是，一个警告：接下来的内容有点复杂，可能不值得付出努力。

关于命名法的说明：
下面，我将指代 Visual Studio 中的设计器（该名称用于指代 Visual Studio 中的功能，通过该名称可以直观地编辑表单和控件的布局和内容）以及设计器类——这将在下面解释。为了防止在任何给定时间混淆我所指的内容，我将始终将 Visual Studio 中的设计器功能称为“设计器”，并且始终将设计器类称为“IDesigner”，即每个接口都必须实现。

当 Visual Studio 设计器加载一个组件（通常是一个控件，但也有类似的东西`Timer`）时，它会在 type 的类上查找一个自定义属性`DesignerAttribute`。（那些不熟悉属性的人可能需要在继续之前[阅读它们](http://msdn.microsoft.com/en-us/library/aa288059(VS.71).aspx)。）

此属性（如果存在）提供类的名称（IDesigner），设计人员可以使用它与组件进行交互。实际上，此类控制设计器的某些方面以及组件的设计时行为。使用 IDesigner 确实可以做很多事情，但现在我们只对一件事感兴趣。

大多数使用自定义 IDesigner 的控件都使用派生自 的控件，而该控件`ControlDesigner`本身派生自`ComponentDesigner`。该类`ComponentDesigner`有一个名为 的公共虚拟属性`AssociatedComponents`，它意味着在派生类中被覆盖，以返回对该类的所有“子”组件的引用集合。

更具体地说，`ToolStrip`控件（以及通过继承，`MenuStrip`控件）具有`DesignerAttribute`引用名为 的类`ToolStripDesigner`。它看起来有点像：

```
/*
 * note that in C#, I can refer to the "DesignerAttribute" class within the [ brackets ]
 * by simply "Designer".  The compiler adds the "Attribute" to the end for us (assuming
 * there's no attribute class named simply "Designer").
 */
[Designer("System.Windows.Forms.Design.ToolStripDesigner, System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"), ...(other attributes)]
public class ToolStrip : ScrollableControl, IArrangedElement, ...(other interfaces){
    ...
} 
```

该`ToolStripDesigner`课程不公开。它在 System.Design.dll 内部。但是由于它是由它的完全限定名称在此处指定的，因此 VS 设计器`Activator.CreateInstance`无论如何都可以使用它来创建它的实例。

这个`ToolStripDesigner`类，因为它[间接]继承自有`ComponentDesigner`一个`AssociatedComponents`属性。当您调用它时，您会得到一个新的`ArrayList`，其中包含对已添加到`ToolStrip`.

那么*你的*代码必须是什么样子才能做同样的事情呢？相当令人费解，但我认为我有一个工作示例：

```
/*
 * Some controls will require that we set their "Site" property before
 * we associate a IDesigner with them.  This "site" is used by the
 * IDesigner to get services from the designer.  Because we're not
 * implementing a real designer, we'll create a dummy site that
 * provides bare minimum services and which relies on the framework
 * for as much of its functionality as possible.
 */
class DummySite : ISite, IDisposable{
    DesignSurface designSurface;
    IComponent    component;
    string        name;

    public IComponent Component {get{return component;}}
    public IContainer Container {get{return designSurface.ComponentContainer;}}
    public bool       DesignMode{get{return false;}}
    public string     Name      {get{return name;}set{name = value;}}

    public DummySite(IComponent component){
        this.component = component;
        designSurface = new DesignSurface();
    }
    ~DummySite(){Dispose(false);}

    protected virtual void Dispose(bool isDisposing){
        if(isDisposing)
            designSurface.Dispose();
    }

    public void Dispose(){
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    public object GetService(Type serviceType){return designSurface.GetService(serviceType);}
}

static void GetComponents(IComponent component, int level, Action<IComponent, int> action){
    action(component, level);

    bool visible, enabled;
    Control control = component as Control;
    if(control != null){
        /*
         * Attaching the IDesigner sets the Visible and Enabled properties to true.
         * This is useful when you're designing your form in Visual Studio, but at
         * runtime, we'd rather the controls maintain their state, so we'll save the
         * values of these properties and restore them after we detach the IDesigner.
         */
        visible = control.Visible;
        enabled = control.Enabled;

        foreach(Control child in control.Controls)
            GetComponents(child, level + 1, action);
    }else visible = enabled = false;

    /*
     * The TypeDescriptor class has a handy static method that gets
     * the DesignerAttribute of the type of the component we pass it
     * and creates an instance of the IDesigner class for us.  This
     * saves us a lot of trouble.
     */
    ComponentDesigner des = TypeDescriptor.CreateDesigner(component, typeof(IDesigner)) as ComponentDesigner;
    if(des != null)
        try{
            DummySite site;
            if(component.Site == null)
                component.Site = site = new DummySite(component);
            else site = null;

            try{
                des.Initialize(component);
                foreach(IComponent child in des.AssociatedComponents)
                    GetComponents(child, level + 1, action);
            }finally{
                if(site != null){
                    component.Site = null;
                    site.Dispose();
                }
            }
        }finally{des.Dispose();}

    if(control != null){
        control.Visible = visible;
        control.Enabled = enabled;
    }
}

/* We'll use this in the ListComponents call */
[DllImport("user32.dll", CharSet=CharSet.Auto)]
static extern int SendMessage(IntPtr hWnd, int msg, int wParam, int lParam);

const int WM_SETREDRAW = 11;

void ListComponents(){
    /*
     * Invisible controls and disabled controls will be temporarily shown and enabled
     * during the GetComponents call (see the comment within that call), so to keep
     * them from showing up and then disappearing again (or appearing to temporarily
     * change enabled state), we'll disable redrawing of our window and re-enable it
     * afterwards.
     */
    SendMessage(Handle, WM_SETREDRAW, 0, 0);
    GetComponents(this, 0,
        /* You'll want to do something more useful here */
        (component, level)=>System.Diagnostics.Debug.WriteLine(new string('\t', level) + component));
    SendMessage(Handle, WM_SETREDRAW, 1, 0);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T23:37:39.303

ToolStripItem 等项目实际上并不是控件，它们只是构成 ToolStrip 或 MenuStrip 的组件。

这意味着，如果您想将这些组件包含在扁平化的控件列表中，那么您将需要进行特定的检查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T23:57:55.643

ToolStripControlHost 可能包含一个控件：

```
if (c is ToolStrip)
    foreach (ToolStripItem item in EnumerateTree(c, "Items"))
        if (item is ToolStripControlHost)
            AddControlsToList(
                new Control[] { ((ToolStripControlHost)item).Control },
                controlList); 
```

...那就是如果您将参数 1 更改为键入`IEnumerable<Control>`并编写自己的 EnumerateTree 函数（我认为拥有一个好的通用 EnumerateTree 方法很棒）*。*

# python - 从 Python 中的生成器创建一个 zip 文件？

> ID：297345
> 
> 赞同：22
> 
> 时间：2008-11-17T23:27:03.227
> 
> 标签：python, zip

我有大量数据（几场演出）我需要用 Python 写入一个 zip 文件。我不能一次将其全部加载到内存中以传递给 ZipFile 的 .writestr 方法，而且我真的不想使用临时文件将其全部输入磁盘然后再读回。

有没有办法将生成器或类似文件的对象提供给 ZipFile 库？或者是否有某种原因似乎不支持此功能？

通过 zip 文件，我的意思是 zip 文件。在 Python zipfile 包中受支持。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-18T19:23:41.657

唯一的解决方案是重写它用于压缩文件以从缓冲区读取的方法。将它添加到标准库中将是微不足道的；我有点惊讶它还没有完成。我收集到很多人都同意整个界面需要大修，这似乎阻碍了任何增量改进。

```
import zipfile, zlib, binascii, struct
class BufferedZipFile(zipfile.ZipFile):
    def writebuffered(self, zipinfo, buffer):
        zinfo = zipinfo

        zinfo.file_size = file_size = 0
        zinfo.flag_bits = 0x00
        zinfo.header_offset = self.fp.tell()

        self._writecheck(zinfo)
        self._didModify = True

        zinfo.CRC = CRC = 0
        zinfo.compress_size = compress_size = 0
        self.fp.write(zinfo.FileHeader())
        if zinfo.compress_type == zipfile.ZIP_DEFLATED:
            cmpr = zlib.compressobj(zlib.Z_DEFAULT_COMPRESSION, zlib.DEFLATED, -15)
        else:
            cmpr = None

        while True:
            buf = buffer.read(1024 * 8)
            if not buf:
                break

            file_size = file_size + len(buf)
            CRC = binascii.crc32(buf, CRC) & 0xffffffff
            if cmpr:
                buf = cmpr.compress(buf)
                compress_size = compress_size + len(buf)

            self.fp.write(buf)

        if cmpr:
            buf = cmpr.flush()
            compress_size = compress_size + len(buf)
            self.fp.write(buf)
            zinfo.compress_size = compress_size
        else:
            zinfo.compress_size = file_size

        zinfo.CRC = CRC
        zinfo.file_size = file_size

        position = self.fp.tell()
        self.fp.seek(zinfo.header_offset + 14, 0)
        self.fp.write(struct.pack("<LLL", zinfo.CRC, zinfo.compress_size, zinfo.file_size))
        self.fp.seek(position, 0)
        self.filelist.append(zinfo)
        self.NameToInfo[zinfo.filename] = zinfo 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-04-29T01:06:09.613

我接受了[Chris B. 的回答](https://stackoverflow.com/questions/297345/create-a-zip-file-from-a-generator-in-python/299830#299830)并创建了一个完整的解决方案。这是以防其他人感兴趣：

```
import os
import threading
from zipfile import *
import zlib, binascii, struct

class ZipEntryWriter(threading.Thread):
    def __init__(self, zf, zinfo, fileobj):
        self.zf = zf
        self.zinfo = zinfo
        self.fileobj = fileobj

        zinfo.file_size = 0
        zinfo.flag_bits = 0x00
        zinfo.header_offset = zf.fp.tell()

        zf._writecheck(zinfo)
        zf._didModify = True

        zinfo.CRC = 0
        zinfo.compress_size = compress_size = 0
        zf.fp.write(zinfo.FileHeader())

        super(ZipEntryWriter, self).__init__()

    def run(self):
        zinfo = self.zinfo
        zf = self.zf
        file_size = 0
        CRC = 0

        if zinfo.compress_type == ZIP_DEFLATED:
            cmpr = zlib.compressobj(zlib.Z_DEFAULT_COMPRESSION, zlib.DEFLATED, -15)
        else:
            cmpr = None
        while True:
            buf = self.fileobj.read(1024 * 8)
            if not buf:
                self.fileobj.close()
                break

            file_size = file_size + len(buf)
            CRC = binascii.crc32(buf, CRC)
            if cmpr:
                buf = cmpr.compress(buf)
                compress_size = compress_size + len(buf)

            zf.fp.write(buf)

        if cmpr:
            buf = cmpr.flush()
            compress_size = compress_size + len(buf)
            zf.fp.write(buf)
            zinfo.compress_size = compress_size
        else:
            zinfo.compress_size = file_size

        zinfo.CRC = CRC
        zinfo.file_size = file_size

        position = zf.fp.tell()
        zf.fp.seek(zinfo.header_offset + 14, 0)
        zf.fp.write(struct.pack("<lLL", zinfo.CRC, zinfo.compress_size, zinfo.file_size))
        zf.fp.seek(position, 0)
        zf.filelist.append(zinfo)
        zf.NameToInfo[zinfo.filename] = zinfo

class EnhZipFile(ZipFile, object):

    def _current_writer(self):
        return hasattr(self, 'cur_writer') and self.cur_writer or None

    def assert_no_current_writer(self):
        cur_writer = self._current_writer()
        if cur_writer and cur_writer.isAlive():
            raise ValueError('An entry is already started for name: %s' % cur_write.zinfo.filename)

    def write(self, filename, arcname=None, compress_type=None):
        self.assert_no_current_writer()
        super(EnhZipFile, self).write(filename, arcname, compress_type)

    def writestr(self, zinfo_or_arcname, bytes):
        self.assert_no_current_writer()
        super(EnhZipFile, self).writestr(zinfo_or_arcname, bytes)

    def close(self):
        self.finish_entry()
        super(EnhZipFile, self).close()

    def start_entry(self, zipinfo):
        """
        Start writing a new entry with the specified ZipInfo and return a
        file like object. Any data written to the file like object is
        read by a background thread and written directly to the zip file.
        Make sure to close the returned file object, before closing the
        zipfile, or the close() would end up hanging indefinitely.

        Only one entry can be open at any time. If multiple entries need to
        be written, make sure to call finish_entry() before calling any of
        these methods:
        - start_entry
        - write
        - writestr
        It is not necessary to explicitly call finish_entry() before closing
        zipfile.

        Example:
            zf = EnhZipFile('tmp.zip', 'w')
            w = zf.start_entry(ZipInfo('t.txt'))
            w.write("some text")
            w.close()
            zf.close()
        """
        self.assert_no_current_writer()
        r, w = os.pipe()
        self.cur_writer = ZipEntryWriter(self, zipinfo, os.fdopen(r, 'r'))
        self.cur_writer.start()
        return os.fdopen(w, 'w')

    def finish_entry(self, timeout=None):
        """
        Ensure that the ZipEntry that is currently being written is finished.
        Joins on any background thread to exit. It is safe to call this method
        multiple times.
        """
        cur_writer = self._current_writer()
        if not cur_writer or not cur_writer.isAlive():
            return
        cur_writer.join(timeout)

if __name__ == "__main__":
    zf = EnhZipFile('c:/tmp/t.zip', 'w')
    import time
    w = zf.start_entry(ZipInfo('t.txt', time.localtime()[:6]))
    w.write("Line1\n")
    w.write("Line2\n")
    w.close()
    zf.finish_entry()
    w = zf.start_entry(ZipInfo('p.txt', time.localtime()[:6]))
    w.write("Some text\n")
    w.close()
    zf.close() 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2019-03-14T18:32:47.030

**在Python 3.5**中更改（来自官方文档）：添加[了](https://docs.python.org/3/library/zipfile.html#zipfile-objects)对写入**不可搜索**流的支持。

这意味着现在`zipfile.ZipFile`我们可以使用不将整个文件存储在内存中的流。此类流[不支持](https://docs.python.org/3/library/io.html?highlight=io#io.IOBase.seekable)在整个数据量上移动。

所以这是一个简单的生成器：

```
from zipfile import ZipFile, ZipInfo

def zipfile_generator(path, stream):
    with ZipFile(stream, mode='w') as zf:
        z_info = ZipInfo.from_file(path)
        with open(path, 'rb') as entry, zf.open(z_info, mode='w') as dest:
            for chunk in iter(lambda: entry.read(16384), b''):
                dest.write(chunk)
                # Yield chunk of the zip file stream in bytes.
                yield stream.get()
    # ZipFile was closed.
    yield stream.get() 
```

`path`是大文件或目录或`pathlike`对象的字符串路径。

`stream`是这样的类的**不可搜索**的流实例（根据[官方文档](https://docs.python.org/3/library/io.html?highlight=io)设计）：

```
from io import RawIOBase

class UnseekableStream(RawIOBase):
    def __init__(self):
        self._buffer = b''

    def writable(self):
        return True

    def write(self, b):
        if self.closed:
            raise ValueError('Stream was closed!')
        self._buffer += b
        return len(b)

    def get(self):
        chunk = self._buffer
        self._buffer = b''
        return chunk 
```

您可以在线尝试此代码：[https ://repl.it/@IvanErgunov/zipfilegenerator](https://repl.it/@IvanErgunov/zipfilegenerator)

* * *

还有另一种创建生成器的方法，无需`ZipInfo`手动读取和分割大文件。您可以将`queue.Queue()`对象传递给您的`UnseekableStream()`对象并在另一个线程中写入此队列。然后在当前线程中，您可以简单地以可迭代的方式从此队列中读取块。查看[文档](https://docs.python.org/3/library/queue.html#queue-objects)

**allanlei 的PS** [Python Zipstream](https://github.com/allanlei/python-zipstream)是过时且不可靠的方式。这是在正式完成之前尝试添加对不可搜索流的支持。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-17T23:41:27.253

gzip.GzipFile 将数据写入 gzipped chunks ，您可以根据从文件中读取的行数来设置块的大小。

一个例子：

```
file = gzip.GzipFile('blah.gz', 'wb')
sourcefile = open('source', 'rb')
chunks = []
for line in sourcefile:
  chunks.append(line)
  if len(chunks) >= X: 
      file.write("".join(chunks))
      file.flush()
      chunks = [] 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-18T02:45:19.630

基本压缩由 zlib.compressobj 完成。ZipFile（在 MacOSX 上的 Python 2.5 下似乎已编译）。Python 2.3 版本如下。

您可以看到它以 8k 块构建压缩文件。提取源文件信息很复杂，因为很多源文件属性（如未压缩大小）都记录在 zip 文件头中。

```
def write(self, filename, arcname=None, compress_type=None):
    """Put the bytes from filename into the archive under the name
    arcname."""

    st = os.stat(filename)
    mtime = time.localtime(st.st_mtime)
    date_time = mtime[0:6]
    # Create ZipInfo instance to store file information
    if arcname is None:
        zinfo = ZipInfo(filename, date_time)
    else:
        zinfo = ZipInfo(arcname, date_time)
    zinfo.external_attr = st[0] << 16L      # Unix attributes
    if compress_type is None:
        zinfo.compress_type = self.compression
    else:
        zinfo.compress_type = compress_type
    self._writecheck(zinfo)
    fp = open(filename, "rb")

    zinfo.flag_bits = 0x00
    zinfo.header_offset = self.fp.tell()    # Start of header bytes
    # Must overwrite CRC and sizes with correct data later
    zinfo.CRC = CRC = 0
    zinfo.compress_size = compress_size = 0
    zinfo.file_size = file_size = 0
    self.fp.write(zinfo.FileHeader())
    zinfo.file_offset = self.fp.tell()      # Start of file bytes
    if zinfo.compress_type == ZIP_DEFLATED:
        cmpr = zlib.compressobj(zlib.Z_DEFAULT_COMPRESSION,
             zlib.DEFLATED, -15)
    else:
        cmpr = None
    while 1:
        buf = fp.read(1024 * 8)
        if not buf:
            break
        file_size = file_size + len(buf)
        CRC = binascii.crc32(buf, CRC)
        if cmpr:
            buf = cmpr.compress(buf)
            compress_size = compress_size + len(buf)
        self.fp.write(buf)
    fp.close()
    if cmpr:
        buf = cmpr.flush()
        compress_size = compress_size + len(buf)
        self.fp.write(buf)
        zinfo.compress_size = compress_size
    else:
        zinfo.compress_size = file_size
    zinfo.CRC = CRC
    zinfo.file_size = file_size
    # Seek backwards and write CRC and file sizes
    position = self.fp.tell()       # Preserve current position in file
    self.fp.seek(zinfo.header_offset + 14, 0)
    self.fp.write(struct.pack("<lLL", zinfo.CRC, zinfo.compress_size,
          zinfo.file_size))
    self.fp.seek(position, 0)
    self.filelist.append(zinfo)
    self.NameToInfo[zinfo.filename] = zinfo 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T00:11:34.527

一些（很多？大多数？）压缩算法是基于查看*整个* 文件的冗余。

一些压缩库会根据对文件最有效的几种压缩算法进行选择。

我相信 ZipFile 模块会执行此操作，因此它希望查看整个文件，而不仅仅是一次查看文件。

因此，它不适用于生成器或大文件以加载到内存中。这可以解释 Zipfile 库的局限性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-05-15T20:00:05.807

如果有人偶然发现这个问题，这个问题在 2017 年仍然与 Python 2.7 相关，这里是一个真正的流 zip 文件的工作解决方案，不需要像其他情况那样输出可搜索。秘诀是设置通用位标志的第 3 位（参见[https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT](https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT)第 4.3.9.1 节）。

请注意，此实现将始终创建一个 ZIP64 样式的文件，允许流处理任意大的文件。它包括一个丑陋的黑客来强制中央目录记录的 zip64 结尾，所以请注意它会导致您的进程编写的所有 zipfile 变成 ZIP64 样式。

```
import io
import zipfile
import zlib
import binascii
import struct

class ByteStreamer(io.BytesIO):
    '''
    Variant on BytesIO which lets you write and consume data while
    keeping track of the total filesize written. When data is consumed
    it is removed from memory, keeping the memory requirements low.
    '''
    def __init__(self):
        super(ByteStreamer, self).__init__()
        self._tellall = 0

    def tell(self):
        return self._tellall

    def write(self, b):
        orig_size = super(ByteStreamer, self).tell()
        super(ByteStreamer, self).write(b)
        new_size = super(ByteStreamer, self).tell()
        self._tellall += (new_size - orig_size)

    def consume(self):
        bytes = self.getvalue()
        self.seek(0)
        self.truncate(0)
        return bytes

class BufferedZipFileWriter(zipfile.ZipFile):
    '''
    ZipFile writer with true streaming (input and output).
    Created zip files are always ZIP64-style because it is the only safe way to stream
    potentially large zip files without knowing the full size ahead of time.

    Example usage:
    >>> def stream():
    >>>     bzfw = BufferedZip64FileWriter()
    >>>     for arc_path, buffer in inputs:  # buffer is a file-like object which supports read(size)
    >>>         for chunk in bzfw.streambuffer(arc_path, buffer):
    >>>             yield chunk
    >>>     yield bzfw.close()
    '''
    def __init__(self, compression=zipfile.ZIP_DEFLATED):
        self._buffer = ByteStreamer()
        super(BufferedZipFileWriter, self).__init__(self._buffer, mode='w', compression=compression, allowZip64=True)

    def streambuffer(self, zinfo_or_arcname, buffer, chunksize=2**16):
        if not isinstance(zinfo_or_arcname, zipfile.ZipInfo):
            zinfo = zipfile.ZipInfo(filename=zinfo_or_arcname,
                                    date_time=time.localtime(time.time())[:6])
            zinfo.compress_type = self.compression
            zinfo.external_attr = 0o600 << 16     # ?rw-------
        else:
            zinfo = zinfo_or_arcname

        zinfo.file_size = file_size = 0
        zinfo.flag_bits = 0x08  # Streaming mode: crc and size come after the data
        zinfo.header_offset = self.fp.tell()

        self._writecheck(zinfo)
        self._didModify = True

        zinfo.CRC = CRC = 0
        zinfo.compress_size = compress_size = 0
        self.fp.write(zinfo.FileHeader())
        if zinfo.compress_type == zipfile.ZIP_DEFLATED:
            cmpr = zlib.compressobj(zlib.Z_DEFAULT_COMPRESSION, zlib.DEFLATED, -15)
        else:
            cmpr = None

        while True:
            buf = buffer.read(chunksize)
            if not buf:
                break

            file_size += len(buf)
            CRC = binascii.crc32(buf, CRC) & 0xffffffff
            if cmpr:
                buf = cmpr.compress(buf)
                compress_size += len(buf)

            self.fp.write(buf)
            compressed_bytes = self._buffer.consume()
            if compressed_bytes:
                yield compressed_bytes

        if cmpr:
            buf = cmpr.flush()
            compress_size += len(buf)
            self.fp.write(buf)
            zinfo.compress_size = compress_size
            compressed_bytes = self._buffer.consume()
            if compressed_bytes:
                yield compressed_bytes
        else:
            zinfo.compress_size = file_size

        zinfo.CRC = CRC
        zinfo.file_size = file_size

        # Write CRC and file sizes after the file data
        # Always write as zip64 -- only safe way to stream what might become a large zipfile
        fmt = '<LQQ'
        self.fp.write(struct.pack(fmt, zinfo.CRC, zinfo.compress_size, zinfo.file_size))

        self.fp.flush()
        self.filelist.append(zinfo)
        self.NameToInfo[zinfo.filename] = zinfo
        yield self._buffer.consume()

    # The close method needs to be patched to force writing a ZIP64 file
    # We'll hack ZIP_FILECOUNT_LIMIT to do the forcing
    def close(self):
        tmp = zipfile.ZIP_FILECOUNT_LIMIT
        zipfile.ZIP_FILECOUNT_LIMIT = 0
        super(BufferedZipFileWriter, self).close()
        zipfile.ZIP_FILECOUNT_LIMIT = tmp
        return self._buffer.consume() 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T00:02:46.367

gzip 库将采用类似文件的对象进行压缩。

```
class GzipFile([filename [,mode [,compresslevel [,fileobj]]]]) 
```

您仍然需要提供一个名义文件名以包含在 zip 文件中，但您可以将数据源传递给 fileobj。

*（这个答案与 Damnsweet 的答案不同，重点应该放在增量读取的数据源上，而不是增量写入的压缩文件上。）*

*我现在看到原来的提问者不会接受 Gzip :-(*

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-09-06T18:16:40.740

现在使用 python 2.7，您可以将数据添加到文件的 zipfile 中：

[http://docs.python.org/2/library/zipfile#zipfile.ZipFile.writestr](http://docs.python.org/2/library/zipfile#zipfile.ZipFile.writestr)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-01-28T16:34:10.483

这是 2017 年。如果您仍然希望优雅地做到这一点，请使用[allanlei 的 Python Zipstream](https://github.com/allanlei/python-zipstream)。到目前为止，它可能是唯一一个编写良好的库来实现这一点。

# google-search - 如何在我的 Google 搜索 iframe 上设置自定义宽度？

> ID：297349
> 
> 赞同：6
> 
> 时间：2008-11-17T23:29:06.357
> 
> 标签：google-search, google-custom-search

我正在尝试使用谷歌搜索来搜索我的网站：

[http://www.houseofhawkins.com/search.php](http://www.houseofhawkins.com/search.php)

在某些屏幕分辨率下播放效果不佳。以下是谷歌给出的代码：

```
<div id="cse-search-results"></div>
<script type="text/javascript">
  var googleSearchIframeName = "cse-search-results";
  var googleSearchFormName = "cse-search-box";
  var googleSearchFrameWidth = 250;
  var googleSearchDomain = "www.google.com";
  var googleSearchPath = "/cse";
</script>
<script type="text/javascript" src="http://www.google.com/afsonline/show_afs_search.js"></script> 
```

我将“googleSearchFrameWidth”更改为 250，认为应该以 px 为单位设置宽度（开始时为 600）。但是对于较小的屏幕 (1024 * 768)，它会突出在我的 div 的一侧。

我在做傻事吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-06T02:53:49.457

我有三个可以调整的设置，我希望它们的组合能让你到达你需要去的地方：

1.  **googleSearchFrameWidth** - 在 JavaScript 中将其设置为所需的宽度。这是最明显的一个，也是您可能已经调整过的一个。
2.  **cse-search-results div 的宽度**- 使用内联样式语句（例如`style ="width:500"`）设置 div 的宽度。
3.  **设置 IFrame 样式**- 如果您检查，您可能会注意到所有这些内容都是通过 IFrame 从 Google 呈现的。这有点难以调整但可行。为此，请在样式表的末尾添加一条语句，例如`#cse-search-results iframe { }`，包括括号内的实际 iframe 样式。

我希望这些中的一个或这些的组合被证明是您的答案。如有疑问，请使用 DOM 检查器（例如 Firebug 中可用的检查器）来分析您的更改对 DOM 的影响。希望这可以帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-06-22T10:09:48.433

**更新 22/06/10** - 在下面找到了一个更简单的解决方案。将 in 代码中的**FORID**值更改为**FORID:11**。因此，您的代码中的一行应该与此类似：

```
<input type="hidden" name="cof" value="FORID:11;NB:1" /> 
```

* * *

尝试添加

```
#cse-search-results iframe {width: 100%;} 
```

在你的 CSS 中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-20T03:45:31.830

遇到了与您想要调整 iFrame 大小相同的麻烦。您会认为更改`googleSearchFrameWidth`值会起作用，但不是。

所以我求助于 DOM 操作。由于 iFrame 的名称是“ `googleSearchFrame`”，紧跟在

```
<script type="text/javascript" src="http://www.google.com/afsonline/show_afs_search.js"></script> 
```

参考，我添加了另一个`<script>`标签，内容如下：

```
<script type="text/javascript">
  document.getElementsByName('googleSearchFrame').item(0).width = 600;
</script> 
```

上面将 iFrame 的宽度设置为`600px`。在您的情况下，显然，您希望将其设置为`250`. 如果您怀疑 Google 有一天可能会更改 iFrame 名称，只需使用该`getElementsByTagName('iFrame')`方法并将其缩小到您的 iFrame 在文档中的位置（如果您有多个 iFrame）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-15T01:22:03.563

在您的网站中修改**googleSearchFrameWidth的简单步骤：**

1.  [从http://www.google.com/afsonline/show_afs_search.js](http://www.google.com/afsonline/show_afs_search.js)下载您自己的“show_afs_search.js”文件，并将其保存在您的 results.htm 网页所在的同一目录中。
2.  打开您的 results.htm 网页并将行代码修改为脚本 ... src="http://www.google.com/afsonline/show_afs_search.js" TO: src="show_afs_search.js"

3.  打开您自己的“show_afs_search.js”文件并将设置宽度：a 修改为宽度：“600”（或以像素为单位设置宽度的任何内容）并保存您自己的“show_afs_search.js”文件。

4.  将这两个文件上传到您的托管站点的同一目录：results.htm 和 show_afs_search.js'

完毕！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-04-03T22:04:44.707

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		$("iframe[name='googleSearchFrame']").css("width","100%");
	});
</script>
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-13T18:02:52.240

Google 不允许您使用小于 500 像素的宽度。最好的办法是为 iframe 创建样式：

```
<style>
#cse-search-results iframe {width: 200px; }
</style> 
```

# wcf - 如何从 Windows 客户端使用 JSON Web 服务

> ID：297360
> 
> 赞同：-1
> 
> 时间：2008-11-17T23:35:43.757
> 
> 标签：wcf, json, transport, payload

是否可以从标准代理客户端（即不是 JavaScript）使用启用 JSON 的 WCF Web 服务？

基本上我想最小化 2 个 Web 服务之间的有效负载大小。

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2008-11-18T02:32:52.930

是的，如果客户端的服务接口定义设置正确（即操作合同上的 WebGet/WebInvoke 属性的 RequestFormat/ResponseFormat 属性设置为 Json。另外请记住，您需要使用 WebHttp 或客户端上的 WebScriptEnabled 行为。

请注意，鉴于 WCF 中的当前实现，JSON 不一定是最有效的；您将做出明确的权衡。[在这篇文章](http://oakleafblog.blogspot.com/2007/12/json-vs-xml-datacontract-serialization.html)中有一个很好的概述。

# sql-server - SQL Server 2000 页面大小和 NTFS 页面大小

> ID：297368
> 
> 赞同：2
> 
> 时间：2008-11-17T23:39:07.867
> 
> 标签：sql-server, configuration, ntfs

在 Oracle 世界中，将数据库块大小构建为文件系统块大小的倍数是福音。我认为这仍然是正确的，但我并不反对被告知为什么技术使这无关紧要。

但有人告诉我，一些 SQL Server DBA 将把 SS2000 安装的操作系统升级到 64 位，以便在 FS 中获得 64k 页。

1.  SQL Server 2000 是否支持更改页面大小？

2.  从我读过的内容来看，它固定在8k。是对的吗？

3.  如果固定为 8k，将 FS 设为 64k 会有什么优势吗？

我从可靠的来源获得这些信息，但仍然是二手的。

编辑：感谢 SAMBO，我已经阅读了链接并找到了规范

> “NTFS 分配单元大小”设置为 64Kb

我假设该术语=块大小...

所以我在 8k DB 块和 64k FS 块之间的冲突实际上是 MS 推荐的设置。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T03:36:21.680

确保您阅读了 Microsoft 的[部署前 I/O 最佳实践](http://www.microsoft.com/technet/prodtechnol/sql/bestpractice/pdpliobp.mspx)

它建议为 NTFS 卷使用 64K 分配单元。

此外，请阅读[SQL Server 2000 IO 基础知识](http://www.microsoft.com/technet/prodtechnol/sql/2000/maintain/sqlIObasics.mspx)

最后看看[这个帖子](http://sql-server-performance.com/Community/forums/p/15056/87329.aspx)。

SQL Server 页面大小实际上是**8K**，这是**不可配置的**。在 OS 上拥有更大的分配单元的好处是，当 SQL Server 将页面提取到其缓存中时，您可能会获得更好的性能。

根据我的经验，我怀疑使用这些值会给你带来任何明显的性能改进，最好的情况是你会得到微不足道的改进。

最好把精力花在隔离 tempdb、确保使用 raid1/0 阵列、让您的事务日志与数据文件位于不同的阵列上以及优化查询等工作上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T23:41:24.243

文件系统的整体性能会产生显着差异。

例如，当 Windows Server 2003 推出时，我听说 SQL Server 2000 在该平台上的性能得到了显着提高。

所以这并不让我感到惊讶。我不认为多重因素有什么大不了的。

# web-services - 使用 Powershell 对 Web 服务方法进行压力测试

> ID：297371
> 
> 赞同：2
> 
> 时间：2008-11-17T23:39:31.890
> 
> 标签：web-services, testing, powershell

我想通过快速连续调用数千次来对 Web 服务方法进行压力测试。该方法有一个字符串参数，我将在每次调用时有所不同。

我打算编写一个 Powershell 脚本来循环并多次调用此方法。

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T23:46:02.860

如果您一个接一个地运行呼叫 - 它不会对您有太大帮助，因为它不会向您展示服务在许多同时连接的重负载下的行为方式。

使用一些多线程解决方案（我不知道powershell是否有这个）。

[这里](http://www.opensourcetesting.org/performance.php)列出了一些开源测试工具。只需将您的 Web 服务设置为也接受 GET 请求，而不仅仅是 SOAP（默认），这样您就可以形成 url。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T07:13:16.063

对于这些情况，我会使用[JMeter](http://jakarta.apache.org/jmeter/)。您需要先试用它，但它非常灵活，它会在不同的线程中运行请求，它会以图形方式显示结果，它还允许您编写作业脚本。

我还建议不要在与服务器相同的机器上启动它，如果可能的话，在不同的机器上启动两个或多个实例来模拟负载。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T23:49:34.867

就个人而言，我会使用类似[openSTA](http://www.opensta.org/)的东西。

这允许记录与网站的会话，然后通过相对简单的脚本语言进行回放。

您还可以轻松地测试 Web 服务并编写自己的脚本。

它允许您以任何您想要的方式将脚本放在测试中，并配置迭代次数、每次迭代中的用户数、引入每个新用户的加速时间以及每次迭代之间的延迟。将来也可以安排测试。

它是开源和免费的。

它会生成许多报告，这些报告可以保存到电子表格中。然后，我们使用数据透视表轻松分析和绘制结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T23:59:22.647

这真的取决于是否有其他要求。例如日志记录、历史记录等。

如果您只需要快速和肮脏，那么您很好。

如果您需要更健壮的东西，那么您可以考虑使用您选择的语言自定义构建测试工具，或者使用 Mercury、MS Team Tester、nUnit 等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-12-21T03:21:45.990

对于那些偶然发现并且不想使用已经提到的第 3 方选项的人。正如公认的答案所提到的，多线程解决方案是最好的，这可以在 PowerShell 中实现：

```
ForEach -Parallel ($item in $collection) {  } 
```

[https://docs.microsoft.com/en-us/powershell/module/psworkflow/about/about_foreach-parallel](https://docs.microsoft.com/en-us/powershell/module/psworkflow/about/about_foreach-parallel)

虽然线程数可​​以限制为 5：[powershell 的并行 foreach 是否最多使用 5 个线程？](https://stackoverflow.com/questions/43647045/does-powershells-parallel-foreach-use-at-most-5-thread)

# asp.net - 安装 ASP.NET 应用程序

> ID：297380
> 
> 赞同：2
> 
> 时间：2008-11-17T23:43:40.027
> 
> 标签：asp.net, iis

好的，这一定是一个超级简单的问题。我似乎无法在任何地方找到答案。首先 - 我不是任何类型的网络开发人员，我是一个老派 c 程序员 - 所以不要因为可能是非常微不足道的事情而抨击我 :)

我需要使用 ASP.NET 编写一个小型的概念验证 Web 应用程序。我在这里的第一次尝试是创建一个“Hello World！” 应用程序。所以我打开了 Visual Studio，并制作了一个新的 Web 应用程序。我有一个调用 C# 函数的 Default.aspx 文件，该函数位于由 Visual Studio 自动创建的 helloworld.dll 中。

我在本地机器上安装了 IIS，并在 wwwroot 子目录中创建了一个虚拟目录。我将 Default.aspx 和 helloworld.dll 放在该目录中。现在，当我浏览到该页面时，我看到以下内容。

```
Server Error in '/test' Application.
Parser Error
Description: An error occurred during the parsing of a resource required to service this request. Please review the following specific parse error details and modify your source file appropriately.

Parser Error Message: Could not load type 'HelloWorld._Default'.

Source Error:

Line 1:  <%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="HelloWorld._Default" %>
Line 2:  
Line 3:  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

Source File: /test/default.aspx    Line: 1 
```

显然，IIS 不知道在哪里寻找 .dll 或类似的东西。我只是不知道如何向 IIS（或在 .net 中管理这些东西的任何人）注册 .dll，以便它可以找到所需的功能。

有人可以告诉我如何在 IIS 上“安装”一个 ASP.NET 应用程序吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T23:45:57.510

最好的办法是使用 Visual Studio 解决方案资源管理器中的“发布网站”。

[克里斯·莱弗利](https://stackoverflow.com/users/2424/chris-lively)补充道：

> 只是一个小补充：可以通过右键单击项目名称找到发布网站。该命令将命名为“发布...”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T23:54:39.207

您无需手动将文件移动到 wwwroot 目录。IIS 中的虚拟目录指向文件系统中的任何文件夹以查找应用程序。

如果您使用的是 IIS6，请按照以下步骤操作：

1.  打开 IIS
2.  在“网站”下，右键单击“默认网站”
3.  选择“新建”
4.  选择“虚拟目录”
5.  输入新应用的名称。
6.  选择应用程序的路径。默认情况下，这通常类似于 C:\Your Documents\Visual Stuido 2008\Projects\Your Project Name
7.  保持访问权限不变。
8.  点击完成

如果您浏览到“ [http://localhost/TheNameOfTheVirtualDirectory/Default.aspx](http://localhost/TheNameOfTheVirtualDirectory/Default.aspx) ”，您应该能够查看该页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T23:53:14.203

我会推荐[Rich B](https://stackoverflow.com/users/5640/rich-b)的解决方案。还有别的... DLL 位于一个名为“bin”的文件夹中。不在文件夹的根目录。

# jquery - JQuery Slider没有传递十分之一的值

> ID：297382
> 
> 赞同：1
> 
> 时间：2008-11-17T23:44:25.547
> 
> 标签：jquery, slider

我有一个运行良好的 JQuery 滑块，但由于某种原因，它没有通过十分之一的值。

```
$(document).ready(function(){
        $("#scoreSlider").slider({
            'steps': 40,
            'min': 1.0, 
            'max': 5.0,
            'startValue': 3, 
            'slide': function(e, ui){ 
                document.getElementById('div_score').innerHTML = ui.value;
            }
        });        
}); 
```

似乎滑块上有正确的点击次数，但传递的值只有整数。

有任何想法吗。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T04:16:08.883

根据[Slider](http://docs.jquery.com/UI/Slider/slider#options)的文档，

> ui.value: **Integer** - 当前句柄的值

你为什么不把你的代码改成这样：

```
$(document).ready(function(){
    $("#scoreSlider").slider({
            'steps': 40,
            'min': 10, 
            'max': 50,
            'startValue': 30, 
            'slide': function(e, ui){ 
                    document.getElementById('div_score').innerHTML = ui.value/10.0;
            }
    });        
}); 
```

它似乎会产生您想要的十进制值。

# python - 动态更新 ModelForm 的 Meta 类

> ID：297383
> 
> 赞同：23
> 
> 时间：2008-11-17T23:44:27.340
> 
> 标签：python, django, django-forms, metaprogramming, modelform

我希望从我的视图中动态更新 ModelForm 的内联 Meta 类。尽管此代码似乎更新了 Meta 类中的排除列表，但 、 等的输出`as_p()`并未`as_ul()`反映更新后的 Meta 排除。

然后我假设 html 是在创建 ModelForm 时生成的，而不是在`as_*()`调用时生成的。有没有办法强制更新 HTML？

这甚至是最好的方法吗？我只是假设这*应该*有效。

想法？

```
from django.forms import ModelForm

from testprogram.online_bookings.models import Passenger

class PassengerInfoForm(ModelForm):

    def set_form_excludes(self, exclude_list):
        self.Meta.exclude = excludes_list

    class Meta:
        model = Passenger
        exclude = [] 
```

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-11-18T00:38:08.247

Meta 类用于动态构造表单定义 - 因此，当您创建 ModelForm 实例时，不在 exclude 中的字段已添加为新对象的属性。

正常的做法是为每个可能的排除列表设置多个类定义。但是，如果您希望表单本身是动态的，则必须动态创建类定义。就像是：

```
def get_form(exclude_list):
    class MyForm(ModelForm):
        class Meta:
            model = Passenger
            exclude = exclude_list
    return MyForm

form_class = get_form(('field1', 'field2'))
form = form_class() 
```

**更新**：我刚刚重新访问了这篇文章，并认为我会发布一些更惯用的方式来处理动态类：

```
def PassengerForm(exclude_list, *args, **kwargs):
    class MyPassengerForm(ModelForm):
        class Meta:
            model = Passenger
            exclude = exclude_list

        def __init__(self):
            super(MyPassengerForm, self).__init__(*args, **kwargs)

    return MyPassengerForm()

form = PassengerForm(('field1', 'field2')) 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-01T02:54:06.560

其他方式：

```
class PassengerInfoForm(ModelForm):
    def __init__(self, *args, **kwargs):
        exclude_list=kwargs.pop('exclude_list', '')

        super(PassengerInfoForm, self).__init__(*args, **kwargs)

        for field in exclude_list:
            del self.fields[field]

    class Meta:
        model = Passenger

form = PassengerInfoForm(exclude_list=['field1', 'field2']) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-10-01T16:02:02.880

类似的方法，有些不同的目标（用于任意模型的通用 ModelForm）：

```
from django.contrib.admin.widgets import AdminDateWidget
from django.forms import ModelForm
from django.db import models

def ModelFormFactory(some_model, *args, **kwargs):
    """
    Create a ModelForm for some_model
    """
    widdict = {}
    # set some widgets for special fields
    for field in some_model._meta.local_fields:
        if type(field) is models.DateField:
            widdict[field.name] = AdminDateWidget()

    class MyModelForm(ModelForm): # I use my personal BaseModelForm as parent
        class Meta:
            model = some_model
            widgets = widdict

    return MyModelForm(*args, **kwargs) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-11-13T02:31:33.093

使用`modelform_factory`（[文档](https://docs.djangoproject.com/en/stable/ref/forms/models/#django.forms.models.modelform_factory)）：

```
from django.forms.models import modelform_factory

from testprogram.online_bookings.models import Passenger

exclude = ('field1', 'field2')
CustomForm = modelform_factory(model=Passenger, exclude=exclude)  # generates ModelForm dynamically
custom_form = CustomForm(data=request.POST, ...)  # form instance 
```

# c# - 使用 Microsoft.BizTalk.Streaming.ValueMutator 更新重复部分中的 XML 属性

> ID：297387
> 
> 赞同：1
> 
> 时间：2008-11-17T23:45:50.333
> 
> 标签：c#, xml, biztalk

我有一个问题，我试图使用包含在 XML 文档的重复部分中的固定值更新一组属性，使用`Microsoft.BizTalk.Streaming.ValueMutator`.

例如，我尝试更新的 XML 文档包含以下输入：

```
<ns0:TestXML xmlns:ns0="http://Test.Schemas">
   <ns0:NodeA>
      <ns0:NodeB>
         <ns0:alpha Id="1" Value="Apple" Type=""></ns0:alpha>
         <ns0:alpha Id="2" Value="Banana" Type=""></ns0:alpha>
         <ns0:alpha Id="3" Value="Car" Type=""></ns0:alpha>
         <ns0:alpha Id="4" Value="Duck" Type=""></ns0:alpha>
      </ns0:NodeB>
   </ns0:NodeA>
</ns0:TestXML> 
```

我试图用来更新 XML 文档的代码是：

```
XmlDocument xDocInput = new XmlDocument();
XmlDocument xDocOutput = new XmlDocument();
string inputFileName = @"C:\Input.xml";
string outputFileName = @"C:\Output.xml";
string newValue = "fruit";
string xpathToUpdate = "/*[namespace-uri()='http://Test.Schemas']/*[local-name()='NodeA']/*[local-name()='NodeB']/*[@Type]";

xDocInput.Load(inputFileName);

using (MemoryStream memstream = new MemoryStream())
{

    xDocInput.Save(memstream);
    memstream.Position = 0;

    XPathCollection queries = new XPathCollection();
    queries.Add(new XPathExpression(xpathToUpdate));
    //ValueMutator xpathMatcher = new ValueMutator(this.XPathCallBack);

    //Get resulting stream into response xml
    xDocOutput.Load(new XPathMutatorStream(memstream, queries, delegate(int matchIdx, XPathExpression expr, string origValue, ref string finalValue) { finalValue = newValue; }));
    //System.Diagnostics.Trace.WriteLine("Trace: " + memstream.Length.ToString());
}

xDocOutput.Save(outputFileName); 
```

此代码的结果输出是文件“Output.xml”。输出文档“Output.xml”中包含以下输出：

```
<ns0:TestXML xmlns:ns0="http://Test.Schemas" >
   <ns0:NodeA>
      <ns0:NodeB>
         <ns0:alpha Id="1"  Value="Apple"  Type="" >fruit</ns0:alpha>
         <ns0:alpha Id="2"  Value="Banana"  Type="" >fruit</ns0:alpha>
         <ns0:alpha Id="3"  Value="Child"  Type="" >fruit</ns0:alpha>
         <ns0:alpha Id="4"  Value="Duck"  Type="" >fruit</ns0:alpha>
      </ns0:NodeB>
   </ns0:NodeA>
</ns0:TestXML> 
```

您会注意到“alpha”元素的文本值更新不正确。期望的结果是使用值“Fruit”更新所有名为“Type”的属性。出了什么问题，这个问题是如何解决的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T06:13:26.930

您需要在 XPath 表达式中包含 alpha 元素。

我使用以下表达式运行您的代码：

```
string xpathToUpdate = "/*[namespace-uri()='http://Test.Schemas']/*[local-name()='NodeA']/*[local-name()='NodeB']/*[local-name()='alpha']/@Type"; 
```

并得到以下 XML

```
<ns0:TestXML xmlns:ns0="http://Test.Schemas">
  <ns0:NodeA>
    <ns0:NodeB>
      <ns0:alpha Id="1" Value="Apple" Type="fruit">
      </ns0:alpha>
      <ns0:alpha Id="2" Value="Banana" Type="fruit">
      </ns0:alpha>
      <ns0:alpha Id="3" Value="Car" Type="fruit">
      </ns0:alpha>
      <ns0:alpha Id="4" Value="Duck" Type="fruit">
      </ns0:alpha>
    </ns0:NodeB>
  </ns0:NodeA>
</ns0:TestXML> 
```

查看您发布的代码，您可能已经看过这些关于使用 ValueMutator 的文章，但以防万一[这里](http://martijnh.blogspot.com/2006/03/xpathmutatorstream.html)、[这里](http://bloggingabout.net/blogs/wellink/archive/2006/03/03/11207.aspx)和[这里](http://connectedthoughts.wordpress.com/2008/05/31/updating-repeating-nodes-in-an-xml-document-with-the-same-value-using-xpathmutatorstream/)有很好的信息。

嘿 - 刚刚意识到最后一个是我的一位同事。小世界。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T00:15:08.217

使用的 XPath 表达式：

   **`//namespace-uri()='http://Test.Schemas']/*[local-name()='NodeA']/*[local-name()='NodeB']/*[@Type]`**

仅选择具有“类型”属性的元素。

最可能需要的是：

   **`/*[namespace-uri()='http://Test.Schemas']/*[local-name()='NodeA']/*[local-name()='NodeB']/@Type`**

希望这有帮助。

干杯，

迪米特·诺瓦切夫

# silverlight - 在 Silverlight 中获取 .png 像素数据

> ID：297390
> 
> 赞同：2
> 
> 时间：2008-11-17T23:47:39.737
> 
> 标签：silverlight, png, silverlight-2.0

我们有一个 Silverlight 应用程序，它需要加载许多 .png 文件。我们可以正常加载图像，但是 Silverlight 不支持从 Image 类中读取像素数据。

任何人都可以提出一个简单的解决方案来获取这些数据吗？我们目前最好的选择是第三方 .png 加载库，但我们很难找到合适的库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T02:12:21.113

在 Silverlight 中没有用于进行基于像素的图像操作/生成的内置类。您需要实现自己的 PNG 编码器/解码器，该编码器/解码器适用于包含图像信息的字节数组。Joe Stegman 已经实现了一个这样的编码器，你应该看看。[他在http://blogs.msdn.com/jstegman/](http://blogs.msdn.com/jstegman/)上获得了有关 Silverlight 中“可编辑图像”的大量重要信息。他做了一些事情，比如对图像应用过滤器、生成 mandlebrots 等等。

此博客讨论了一个 JPEG Silverilght 编码器 (FJCore)，您可以使用它来调整和重新压缩照片客户端大小： http: [//fluxcapacity.net/2008/07/14/fjcore-to-the-rescue/](http://fluxcapacity.net/2008/07/14/fjcore-to-the-rescue/)

另一个工具是“Fluxify”，它允许您使用 Silverilght 2 调整和上传照片的大小。可以在[http://fluxtools.net/找到](http://fluxtools.net/)

所以是的，客户端图像处理绝对可以在 Silverilght 2 中完成。快乐的黑客！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-19T00:48:02.080

PNG解码很难找到。

我为 MSDN 写了一篇文章，其中包含一些我从 Joe Stegman、FluxCapacity 和其他一些人那里拼凑起来的开源代码。它包括 PNG 解码（以及 GIF、JPG 和 BMP），供该线程中正在寻找的人使用。

[http://www.microsoft.com/youshapeit/msdn/ExpertKnowledge/2008-10/InnovateWithSilverlight2.aspx](http://www.microsoft.com/youshapeit/msdn/ExpertKnowledge/2008-10/InnovateWithSilverlight2.aspx)

如果您不关心我对 Silverlight 的实现，那么您可以直接查看我为 PNG 解码所做的修改：http: [//sourceforge.net/projects/pr2/](http://sourceforge.net/projects/pr2/)

干杯!

更新：看起来他们不再在网站上提供源代码，所以我在这里重新发布了内容：http: [//dimebrain.com/2009/01/innovate-with-silverlight-2-article-code-available .html](http://dimebrain.com/2009/01/innovate-with-silverlight-2-article-code-available.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T20:56:10.783

谢谢 - 我看过 Joe Stegman 的博客。很方便，但是他没有的解码器是PNG的。我们正在使用 PNG，因为我们需要透明度。Fluxtools 链接似乎也被破坏了。

我仍在寻找（未成功）可以放入 Silverlight 的 PNG 解码器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T21:11:29.973

一种可能（根据情况）更容易的选项是分别保存颜色数据和透明度数据，然后在加载图像后以编程方式将透明度应用于图像。这样，您可以将图像保存为代表 alpha 通道的 8 位 gif，以及用于颜色数据的 jpg 或 bmp 或其他任何内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T01:43:00.813

Dimebrain - 你提供的那个 msdn 链接没有指向源代码的有效链接——你有没有可能链接到有效的源代码？

# sql - 如何找出存储过程最后一次在 Oracle 中修改或编译的时间？

> ID：297392
> 
> 赞同：25
> 
> 时间：2008-11-17T23:48:21.857
> 
> 标签：sql, oracle, stored-procedures, plsql, oracle10g

我最好寻找一个 SQL 查询来完成此操作，但其他选项也可能有用。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-11-17T23:54:34.670

```
SELECT LAST_DDL_TIME, TIMESTAMP
FROM USER_OBJECTS
WHERE OBJECT_TYPE = 'PROCEDURE'
AND OBJECT_NAME = 'MY_PROC'; 
```

**`LAST_DDL_TIME`**是最后一次编译。 **`TIMESTAMP`**是最后一次更改。

即使在依赖项发生更改时过程没有更改，也可能需要重新编译过程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-03T07:15:33.793

```
SELECT name, create_date, modify_date 
FROM sys.procedures order by modify_date desc 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-15T04:39:37.333

以下查询将在 Oracle 中执行

```
 SELECT * FROM ALL_OBJECTS WHERE OBJECT_NAME = 'OBJ_NAME' ; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-04-17T14:31:15.317

当我在谷歌上搜索查找特定日期后更改的 PLSQL 包时，我来到了这里，有点类似于上面的问题。使用上面的 WW.s 答案，我得到了这个查询以查找任何“最近”更改的对象：

```
选择 LAST_DDL_TIME、TIMESTAMP、OBJECT_NAME、object_type
FROM USER_OBJECTS
WHERE -- OBJECT_TYPE IN ('PROCEDURE', 'PACKAGE', 'PACKAGE BODY', 'VIEW', 'FUNCTION') 和
  时间戳 > '2019-02-20'
按时间戳顺序排序；

```

# perl - 如何在 Perl 中验证日期？

> ID：297398
> 
> 赞同：6
> 
> 时间：2008-11-17T23:53:27.433
> 
> 标签：perl, datetime

如何在 Perl 中验证日期字符串？我想考虑闰年和时区。有人可以按以下格式输入日期：

```
2008 年 11 月 17 日
2008 年 11 月 17 日下午 3 点
2008 年 11 月 17 日上午 12:01
美国东部时间 2008 年 11 月 17 日上午 12:01
2008 年 11 月 17 日上午 12:01 CST

```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-18T10:14:22.857

我使用[DateTime::Format::DateManip](http://search.cpan.org/dist/DateTime-Format-DateManip/lib/DateTime/Format/DateManip.pm)来处理这样的事情。使用你的日期......

```
use DateTime::Format::DateManip; 

my @dates = (
    '11/17/2008',
    '11/17/2008 3pm',
    '11/17/2008 12:01am',
    '11/17/2008 12:01am EST',
    '11/17/2008 12:01am CST',
);

for my $date ( @dates ) {
    my $dt = DateTime::Format::DateManip->parse_datetime( $date );
    die "Cannot parse date $date"  unless defined $dt;
    say $dt;
}

# no dies.. produced the following....
# => 2008-11-17T00:00:00
# => 2008-11-17T15:00:00
# => 2008-11-17T00:01:00
# => 2008-11-17T05:01:00
# => 2008-11-17T06:01:00 
```

注意。我这里是格林威治标准时间！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-17T23:54:40.317

[CPAN](http://search.cpan.org)有许多处理日期的包，例如[DateTime](http://search.cpan.org/dist/DateTime)和[Date::Manip](http://search.cpan.org/dist/Date-Manip)。要解析您的日期，[TimeDate](http://search.cpan.org/dist/TimeDate)中的 Date::Parse 模块可能会起作用（是的，有 DateTime 和 TimeDate）。

通常，每当您需要在 Perl 中做某事时，请检查 CPAN。可能有一个模块。看看有什么可用的，看看有什么适合你的情况。

祝你好运， ：）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T02:17:11.463

当我遇到它们时，我会在这里发布我的答案。

使用时间::本地
 [http://www.perlmonks.org/?node_id=642627](http://www.perlmonks.org/?node_id=642627)

# iphone - 在简单的 iPhone 游戏中重新显示 EAGLView

> ID：297408
> 
> 赞同：2
> 
> 时间：2008-11-17T23:56:58.160
> 
> 标签：iphone, opengl-es

我正在开发一个基于开发人员中心的 CrashLanding 示例的非常简单的 iPhone 游戏。我对它进行了一些扩展，以便我没有一直使用 OpenGL 进行显示，而是将一个普通的 UIView 作为标题屏幕，一个 UITableView 用于高分屏幕，一个未修改的 EAGLView 用于游戏屏幕。

因此，除了当我尝试重新显示 EAGLView 时屏幕停止更新之外，所有设置都可以正常工作。我有一个游戏循环，当屏幕显示和隐藏时开始和停止，我最初认为这不是重新启动，而是通过调试看起来一切都很好的应用程序。然后我想也许我需要在重新显示 OpenGL 表面时重新创建它，所以我这样做了，屏幕从全黑变成全粉红色。

我正在使用 UINavigationController 来处理视图之间的移动。从根视图控制器（标题屏幕）转到 EAGLView（游戏屏幕）然后返回根视图控制器并再次进入游戏屏幕后会发生错误。

任何信息/帮助将不胜感激！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-26T18:33:01.560

许多个月后...

这原来是在 UIViewController 中使用 EAGLView 的问题。为了修复它，我将 EAGLView 拉出并坐在控制器后面。所以为了展示它，我只需要隐藏控制器。不太好，但它允许我在它和其他视图之间切换而没有任何问题。

# sql - MS SQL 触发器更新调用死锁？

> ID：297412
> 
> 赞同：1
> 
> 时间：2008-11-17T23:57:58.373
> 
> 标签：sql, sql-server, triggers

我有两张桌子。俱乐部和教练。它们之间是 0,1 - 0,1 关系（教练可以有零个或一个俱乐部。俱乐部可以有零个或一个教练）。当我想更换给定俱乐部的教练时，我必须更新俱乐部表。所以我必须改变那个俱乐部的idCoach。让我们考虑一个新教练（给定俱乐部的新指定教练）已经是其他俱乐部的教练。我必须将那个俱乐部的 idCoach 字段设置为 Null，因为他的教练将被分配到另一个俱乐部。此外，如果我想更换教练的俱乐部已经有教练，那么我必须将该教练的 idClub （在教练表中）设置为 Null。

以上所有内容，也适用于我想更换某个教练的俱乐部时。（必须将给定教练的前一家具乐部的 idCoach 字段设置为空，并且必须将新俱乐部的 idCoach 设置为空）。

当我在 Club 或 Coach 表中插入新记录或删除现有记录时，可能会出现同样的问题（在插入、更新和删除中，我必须注意相应的引用并取消它们的链接）。

我想用触发器解决这个问题。我想我必须在 Club 表中有 3 个触发器（用于插入、更新和删除），在 Coach 表中还有 3 个触发器。

在更新触发器中（例如在俱乐部中）我必须更新教练表，这将再次触发俱乐部中的更新（因为在它的主体中它必须更新俱乐部表）并且该触发器将更新教练和触发器等等。所以我会有一个死锁。

如何解决这个问题？

这是我第一次使用触发器，非常抱歉，对于一个简单的事情的这个大解释。

干杯!

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T00:09:30.847

我建议这可能不适合用于触发器，因为触发器很难调试，并且经常以他们不支持单记录操作的方式让人们感到惊讶，正如您所期望的那样。将其分解为简单的 SQL 语句，然后围绕它包装一个事务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T00:44:27.657

有第三张桌子可以容纳关系吗？我认为这将是一种简单的工作方法。

如果教练从俱乐部辞职，只需从新表中删除记录。为加入新俱乐部的教练插入一条记录。

希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T00:22:55.610

如果可以的话，我建议避免使用触发器。如果您必须尝试使用​​代替触发器而不是普通触发器。不同之处在于在实际修改任何数据之前触发触发器。话虽如此，我认为你最好使用存储过程，并看看你是否

另一个建议是，如果您可以将其建模为关联实体。我假设俱乐部的教练也必须是俱乐部的教练。所以你可以做的是创建一个CoachAssignment 表，现在你只需要维护这一条记录。如果您需要一名教练来隶属于多个俱乐部，那么该模型就适合您。

话虽如此，您可以使用 If Update(FieldName) 语法仅更新您实际需要的表。如果您需要停止递归触发器，您可以通过检查 TRIGGER_NESTLEVEL() 来防止这种情况

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T01:16:28.153

我同意 shahkalpesh - 你的设计应该包括一个 Coach 表、一个 Club 表、第三个表（ClubCoach？）来存储关系。那么你所要做的就是执行一个教练不能在外部分配到多个俱乐部（反之亦然）的规则。

或者，您可以只拥有 Coach 和 Club 表，在 Coach 表中使用 idClub（强制执行一个俱乐部每个教练的规则），并在外部强制执行一个教练每个俱乐部的规则。

# regex - 正则表达式在 #OnlinePopup 和 _ 之间选择一些东西

> ID：297417
> 
> 赞同：0
> 
> 时间：2008-11-18T00:00:15.063
> 
> 标签：regex

有人可以给我看一个正则表达式来选择**#OnlinePopup_AFE53E2CACBF4D8196E6360D4DDB6B70**可以假设`#OnlinePopup`

```
~DCTM~dctm://aicpcudev/37004e1f8000219e?DMS_OBJECT_SPEC=RELATION_ID#OnlinePopup_AFE53E2CACBF4D8196E6360D4DDB6B70_11472026_1214836152225_6455280574472127786 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T00:04:43.120

注意：以下是 .NET Regex 语法，请根据您的喜好进行修改。

以下：

```
#[^_]+_[^_]+ 
```

将匹配：

*   哈希
*   一个或多个字符直到下划线
*   下划线
*   一个或多个字符直到下划线

如果第一位是恒定的，并且您想要更具体，您可以使用：

```
#OnlinePopup_[A-F0-9]+ 
```

这将匹配

*   # OnlinePopup_（准确）

*   一个或多个十六进制字符，直到一个非十六进制字符

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T00:05:43.913

简单地匹配第一个 '#' 和第一个或最后一个 '_' 之间的任何内容都不适用于您的示例，因为您要返回的字符串中包含下划线。如果您要匹配的所有文本中只有**一个**下划线，您可以使用这个正则表达式：

```
/(#[^_]+_[^_]+)/ 
```

这匹配一个八字形 (#)，后跟两个不包含下划线的字符串，由一个下划线分隔。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T00:11:00.500

稍微简单一点的：

```
(\#OnlinePopup_.*?)_ 
```

假设您的文本以 # 开头并以 _ 结尾

# java - 使用 JAX-WS 使用 Web 服务

> ID：297419
> 
> 赞同：0
> 
> 时间：2008-11-18T00:01:32.050
> 
> 标签：java, web-services, jax-ws

在每次调用 ws 之前，我需要能够从 web.xml 文件中读取主机名和端口。那么我怎样才能在 JAX-WS 中做到这一点，或者不可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T02:52:24.670

您可以像出于任何其他目的一样访问参数：

[`ServletContext.getInitParameter(String key)`](http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletContext.html#getInitParameter(java.lang.String))

# javascript - 可用于测试 javascript 验证脚本的电子邮件地址列表

> ID：297420
> 
> 赞同：20
> 
> 时间：2008-11-18T00:01:50.223
> 
> 标签：javascript, validation, email, email-address

有没有人有我可以用来测试我的 JS 地址验证脚本的电子邮件地址列表？我正在寻找尽可能完整的列表来测试最常见的边缘情况，如果不是所有情况的话。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-18T00:46:16.250

根据 RFC2822 有效的示例

*   我@example.com
*   a.nonymous@example.com
*   姓名+标签@example.com
*   name\@tag@example.com – 这是一个包含两个 @ 符号的有效电子邮件地址。
*   空格\ are\ allowed@example.com
*   “可以引用空格”@example.com
*   !#$%&'*+-/=.?^_`{|}~@[1.0.0.127]
*   !#$%&'*+-/=.?^_`{|}~@[IPv6:0123:4567:89AB:CDEF:0123:4567:89AB:CDEF]
*   我（这是评论）@example.com – 不鼓励评论，但 RFC2822 不禁止评论。

根据 RFC2822s 示例无效

*   我@
*   @example.com
*   我.@example.com
*   .me@example.com
*   我@example..com
*   我.example@com
*   我\@example.com

来自： [http ://en.wikibooks.org/wiki/JavaScript/Best_Practices](http://en.wikibooks.org/wiki/JavaScript/Best_Practices)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-22T16:26:45.533

我现在整理了来自 Cal Henderson、Dave Child、Phil Haack、Doug Lovell 和 RFC 3696的测试用例。总共[164 个测试地址](http://isemail.info/_system/is_email/test/?all)。

我针对我能找到的所有验证器运行了所有这些测试。~~比较在这里： http: [//www.dominicsayers.com/isemail](http://www.dominicsayers.com/isemail)~~

随着人们增强他们的验证器，我将尝试使此页面保持最新。感谢 Cal、Dave 和 Phil 在编译这些测试时提供的帮助和合作，以及对[我自己的验证器](https://github.com/dominicsayers/isemail)的建设性批评。

人们应该特别注意[针对 RFC 3696 的勘误表](http://www.rfc-editor.org/errata_search.php?rfc=3696)。其中三个规范示例实际上是无效地址。地址的最大长度是 254 或 256 个字符，**而不是**320。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T02:42:34.080

域部分（在最后一个 @ 之后）是一系列以点分隔的字符串标签。

每个标签都是由 AZ、az 0-9 或连字符 (-) 组成的 1 到 63 个八位字节的字符串

域的最大大小为 255 个八位字节。

为了与 arpanet 兼容，每个标签必须以字母开头并以字母或数字结尾，但某些 TLD:s 现在允许使用全数字域，例如 0.nu

请注意，TLD 允许为 63 个八位字节。很多脚本错误地将其限制为 2-3 个八位字节，从而使 domain.name 无效。

例子？

abcdefghijklmnopqrstuvwxyz.ABCDEFGHIJKLMNOPQRSTUVWXYZ.!#$%&'+-/=.?^`{|}~@ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-0123456789.abcdefghijklmnopqrstu.vwxyzABCDEFGHIJKLMNOP.QRSTUVWXYZ0.1.2.3.4.5.6.7.8.9.az.AZ.0-9 .a0.b1.c2.d3.e4.f5.g6.h7.i8.j9.K0.L1.M2.N3.O.domain.name

（不，它没有注册）

更新：使用 IDNA 几乎**一切**皆有可能：

*   punnycode@XN--0ZWM56D.XN--HGBK6AJ7F53BBA
*   idna_in_clear(?)_text@例子.测试.مثال.آزمایشی

也可以看看：

[https://stackoverflow.com/questions/3232/how-far-should-one-take-e-mail-address-validation](https://stackoverflow.com/questions/3232/how-far-should-one-take-e-mail-address-validation)

[http://www.leshazlewood.com/?p=5](http://www.leshazlewood.com/?p=5)

**更新：** Bobince 建议测试域名中的点。

**摘要**：仅测试@和域部分中的点，然后发送确认电子邮件。

这是一个测试@和点的例子：

*   必须至少有一个@
*   本地部分必须至少有一个字符（ pos > 0）
*   域部分必须至少有一个点
*   域部分必须至少为 4 个字符

这是一个简单的：

```
function isEmail(address) {
    var pos = address.lastIndexOf("@");
    return pos > 0 && (address.lastIndexOf(".") > pos) && (address.length - pos > 4);
} 
```

或返回对象中的本地和域部分的函数（如果您想进一步处理它，例如将其转换为 punycode）

```
function isEmail(address) {
    var pos = address.lastIndexOf("@");
    return pos > 0 && (address.lastIndexOf(".") > pos) && (address.length - pos > 4) ? 
    {
        local:address.substr(0,pos < 0 ? 0 : pos),
        domain:address.substr(pos+1)
    }: false;
} 
```

# visual-studio - Visual Web Developer 2008 Express 中的源代码编码

> ID：297421
> 
> 赞同：1
> 
> 时间：2008-11-18T00:02:19.740
> 
> 标签：visual-studio, visual-studio-express, visual-web-developer

我可以在哪里设置？默认情况下，我需要将文件以 UTF-8 编码...据我所知，Tools -> Options 或任何其他菜单中没有任何内容:(

PS 我不需要为 Project 设置默认编码，我需要将它设置为我创建的任何文件的默认编码。谢谢你的帮助 ：）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T21:50:45.350

而不是单击保存单击另存为。然后通过保存单击小向下箭头以保存编码。完成此操作后，它将带您进入完整的 VS Studio 中显示的高级保存选项。然后，您可以选择 UTF-8 作为编码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-26T05:37:27.550

当您选择另存为时，可以从附加到保存按钮的下拉列表中获得编码选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T05:56:19.900

我相信您不能将源编码设置为项目设置。相反，它尝试使用相当有限的算法从文件中确定源编码。该算法的一部分是

*   如果它具有 UTF-8 签名 (BOM)，则它是 UTF-8 编码的
*   否则，它在 ANSI 系统代码页 (CP_ACP) 中

中间可能有一些额外的检查（例如也检查带有 BOM 的 UTF-16）。

根据我的经验，“另存为”编码不是很有用，除非另存为 UTF-8-with-BOM。您可以将其保存为不同的编码，但在重新打开时，它仍会假定它是 CP_ACP。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T15:43:10.443

文件 -> 高级保存选项

选择编码和行尾

问候，哈里斯

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T00:08:33.813

IIRC，Visual Studio 中的源文件已经编码为 UTF-8。

但是，如果我错了，或者您只想强制执行任何特定编码，您可以通过选择`Save As...`文件选项并从那里检查保存按钮下的下拉选项来完成。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T20:06:12.117

谢谢你的回答，但这不是我所需要的。

好的，我会尝试更具体。事情就是这样：我去打开网站，我直接通过 FTP 打开网站。在右侧我可以看到文件列表。我右键单击它，选择新项目，html 文件，我有新的 html 文件。我在其中添加了一些文本，单击保存（CTRL+S），文件被保存。现在我通过浏览器打开它，我看到它没有保存在 UTF-8 中。那么，我可以以任何方式解决这个问题吗？:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-09T21:38:26.650

您是说即使源文件以 utf-8 编码，您的互联网浏览器仍将其显示为 ansi？您是否定义了元编码标签？

[http://tlt.its.psu.edu/suggestions/international/web/tips/declare.html](http://tlt.its.psu.edu/suggestions/international/web/tips/declare.html)

试试这个，你的浏览器应该说它是 utf-8。仅以 utf-8 格式保存文件是行不通的。

# sql-server - 如何从 SQL Server 2005 备份中恢复单个表？

> ID：297422
> 
> 赞同：15
> 
> 时间：2008-11-18T00:02:42.373
> 
> 标签：sql-server, backup, restore

我已经使用常规 SQL Server 2005 备份命令进行了备份。有没有办法只恢复一个表，而不是整个数据库？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-18T00:05:36.487

将整个数据库还原到另一台机器（或临时数据库），然后复制表对我来说似乎是最简单的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-06-10T09:46:02.217

SSMS 本身不支持此功能，但可以使用第三方工具。

除了 Red Gate（顺便说一句很棒的工具），您还可以从 ApexSQL尝试[SQL Diff](http://www.apexsql.com/sql_tools_diff.aspx)（恢复对象）和[SQL Data Diff （恢复数据）。](http://www.apexsql.com/sql_tools_datadiff.aspx)

免责声明：我不隶属于 ApexSQL，但我们是他们的客户并使用他们的工具

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-18T01:11:12.893

[SQL Server](http://msdn.microsoft.com/en-us/library/ms191253.aspx)中备份和恢复的单位是数据库（它是参照完整性的外边界）。

Red Gate 有一些[很好](http://www.red-gate.com/products/SQL_Backup/row_level_restore/why_row_level_restore.htm)的行级恢复工具（SQL 数据比较和 SQL 备份），但它们是有代价的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-17T17:37:24.940

分离当前数据库，然后将具有 tbl 日期的数据库还原到一个新位置（创建一个子文件夹），使其与生产数据库分开，然后将数据库还原到该子文件夹，完成后查找您需要的 tbl 并将其编写为创建脚本文件保存到文件中，完成数据库删除它然后重新附加原始文件，现在向下滚动到要恢复的 tbl 并将其编写为创建文件（这是仅备份）现在删除 tbl，确保选择了您的数据库，然后活动的数据库加载您刚刚使用查询分析器中的另一个数据库创建的脚本文件并运行它，它现在应该报告成功检查以查看您的tbl 已被替换。你完成了

# forms - 默认 JSF 表单行为

> ID：297425
> 
> 赞同：0
> 
> 时间：2008-11-18T00:03:52.433
> 
> 标签：forms, jsf

我正在构建一个普通的 JSF 应用程序，但我在理解表单在这个框架中的工作方式时遇到了一些困难。

如果我提交 JavaScript 表单...

```
document.myForm.submit(); 
```

...在这个 JSF 表格上...

```
<h:form id="myForm">
  ...
  <h:commandButton value="Continue" action="#{foo.continueButton}"></h:commandButton>
</h:form> 
```

...如何定义要在 foo bean 中调用的方法？是否有定义默认表单提交方法的 JSF 标准方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T09:10:11.100

> 是否有定义默认表单提交方法的 JSF 标准方法？

不幸的是，不是，不是在 JavaScript 中。

您可以模拟单击按钮以执行操作。

# java - 在 Java 中读取精灵表的最佳方法是什么？

> ID：297426
> 
> 赞同：0
> 
> 时间：2008-11-18T00:04:27.363
> 
> 标签：java, io, 2d, sprite-sheet

我正在编写一个基本的 sprite 引擎，以供自己娱乐并更好地熟悉 Java 的 2d API。目前，我正在使用大量具有透明背景的单独 .png 文件来表示我需要的各种精灵和不同的动画帧。大多数“现实世界”游戏开发项目似乎都在使用“精灵表”，其中在单个文件中包含多个精灵或动画帧。此外，人们通常不使用原生图像透明度支持，而是将精灵调色板中没有出现的任意颜色指定为透明颜色。如何以编程方式管理这样的文件？

*   你怎么知道一个精灵从哪里开始，下一个从哪里开始
*   你如何处理透明度

可能还有其他我没有想到的因素，所以我可能会在我想到事情或人们提出建议时添加到上面的列表中（请在评论中这样做）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T07:44:12.240

我目前使用由一个简单的精灵编辑器生成的 XML 文件，该文件将精灵存储为（可选动画）姿势的集合，这些姿势又是帧或单元格的集合。框架存储每帧信息，例如框架在工作表中的 x 和 y 偏移量、单元格宽度和高度以及任何转换（调整大小/旋转/色调/等）。姿势存储单个帧和动画信息（例如速度），以及一个姿势名称，以便在程序中轻松识别它们（hero.pose = sprite.pose["standing_right"]）。Sprites 用作文档根来保存多个姿势，例如每个朝向的姿势。

我之前使用的一个不太灵活的替代方法是为单元格和工作表指定固定大小，并根据这些值计算帧偏移和大小（例如，宽度始终为 32 像素，因此第三个精灵为 32 * 2）。后来我开始在文件名（例如 sprite_name_32x64.png）中为不适合固定单元尺寸的精灵指定这些尺寸。我更喜欢这种新方法，尤其是使用一个简单的编辑器，它为我填充了大多数值并允许我将精灵用作其他精灵的模板。

我直接使用存储在 PNG 图像中的 alpha 和透明度信息，因此我不必担心将其存储在其他地方，尽管其他方法是为每个精灵选择一个固定值并存储在某处，如果你使用姿势中最左边的像素知道它总是空的，如果你正在使用那些，精灵面具，或者你有什么，请使用特定的调色板条目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-03T19:50:09.863

让您的精灵表知道每个序列的大小和数量。

获取工作表的缓冲图像并使用以下内容：

```
currentframe=spritesheet.getSubimage(x, y, w, h); 
```

您的 x 和 y 将根据您所在的框架而变化。保持宽度和高度相同，以方便您自己。

忘记尝试将整个游戏保持在一张纸上。这很疯狂，很难管理。为每个动画序列使用一个新的 png。如果您对节省空间感兴趣，请仅创建向右移动的动画，然后实时翻转缓冲图像以向左移动。

Java 将读取带有 alpha 的 png 文件，因此不必担心透明度颜色。用png画出所有东西。使用 Photoshop 或 Gimp。

在 google 上搜索 java 图像 TYPE_INT_ARGB

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-08T20:24:51.493

与java无关，但通常您可以使所有精灵都具有相同的大小。因此，您将能够使用简单的 for 循环在游戏（或应用程序）中生成精灵。

但是对于不同大小的精灵，精灵表的大小可能会出现问题（它可能比预期的大）。因此，您必须为您的 spritesheet 定义一个 xml 或 json 文件，以便在您的代码中找到您的 sprite 图像。您可以使用精灵表编辑器（有很多，我正在使用[Sprite Master](http://www.mobinodo.com/spritemaster)）来快速简便地生成精灵表和坐标数据。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-18T00:55:55.870

好吧，由于它们中的大多数都是自定义的，因此这些细节取决于实现者。您通常会让文件以包含高度/宽度和编码、透明度等详细信息的标题信息开头。

很多时候事情都在一个文件中，因为与打开/读取一个文件相比，打开/读取多个文件非常昂贵。许多游戏引擎使用压缩为 0 的 zip 或“类似 zip”的文件来将单个文件视为文件系统。

# .net - ChannelFactory 在端点上没有地址，为什么？

> ID：297431
> 
> 赞同：3
> 
> 时间：2008-11-18T00:05:50.310
> 
> 标签：.net, wcf, configuration, c#-3.0

当我创建 ChannelFactory 的新实例时：

```
var factory = new ChannelFactory<IMyService>(); 
```

并且我创建了一个新通道，我有一个异常说端点的地址为空。

我的 web.config 中的配置如前所述，一切都如预期的那样（尤其是端点的地址）。

如果我创建一个新的 MyServiceClientBase，它会从我的通道工厂加载所有配置：

```
var factoryWithClientBase = new MyServiceClientBase().ChannelFactory;
Console.WriteLine(factoryWithClientBase.Endpoint.Address); //output the configuration inside the web.config

var factoryWithChannelFactory = new ChannelFactory<IMyService>();
Console.WriteLine(factoryWithChannelFactory.Endpoint.Address); //output nothing (null) 
```

为什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-18T08:03:25.477

如果您在 Web.Config 中为端点提供这样的名称，它会起作用吗：

```
<endpoint address="http://localhost:2000/MyService/" binding="wsHttpBinding"
    behaviorConfiguration="wsHttpBehaviour" contract="IService"
    name="MyWsHttpEndpoint" /> 
```

并使用 ChannelFactory 创建通道，如下所示：

```
var factory = new ChannelFactory<IMyService>("MyWsHttpEndpoint"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-11T23:03:56.180

我终于找到了答案。ChannelFactory 不会从您的 Web.Config/app.config 中读取信息。ClientBase（然后与 ChannelFactory 一起工作）可以。

这一切花费了我几个小时的工作，但我终于找到了一个正当的理由。

:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-03-21T05:09:55.270

由新操作符实例化的 ChannelFactory 确实从 web.config 中读取。上面的 AnAngel 答案是正确的。您只需要确保为您的端点提供一个名称。并确保端点合约设置正确（非常重要）

在我的 web.config 由 VS 生成并且端点合同设置为 ServiceReference 中的合同（作为添加服务参考的结果）之前，我有一种经验，这不是我想要的。尽管它与我的原始合同具有相似的名称（但位于不同的命名空间中）

```
<endpoint address="http://localhost:2000/MyService/" binding="wsHttpBinding"
behaviorConfiguration="wsHttpBehaviour" contract="TheCorrectNamespace.IService"
name="MyWsHttpEndpoint" /> 
```

提问者没有发布他的 web.config，所以我假设您很可能犯了我所做的错误（为端点指定了错误的合同）

# ruby-on-rails - Rails：在视图中检查 has_many

> ID：297435
> 
> 赞同：3
> 
> 时间：2008-11-18T00:08:03.067
> 
> 标签：ruby-on-rails, ruby, model

如果我有...

```
class Bunny < ActiveRecord::Base
  has_many :carrots
end 
```

`@bunny`...如果有胡萝卜，我如何查看视图？我想做这样的事情：

```
<% if @bunny.carrots? %>
  <strong>Yay! Carrots!</strong>
  <% for carrot in @bunny.carrots %>
    You got a <%=h carrot.color %> carrot!<br />
  <% end %>
<% end %> 
```

我知道`@bunny.carrots?`这行不通——怎么办？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T00:16:30.647

```
<% if @bunny.carrots.any? %>
  <strong>Yay! Carrots!</strong>
  <% for carrot in @bunny.carrots %>
    You got a <%=h carrot.color %> carrot!<br />
  <% end %>
<% end %> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T00:26:58.753

```
unless @bunny.carrots.empty? 
```

也可以

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T00:14:32.133

任何一个：

```
 if @bunny.carrots.length>0 
```

或者

```
unless @bunny.carrots.nil? || @bunny.carrots.length>0 
```

或者

```
 if @bunny.carrots.any? 
```

顺便说一句，如果你使用 irb 或 script/console with require 'irb/completion' 你会发现更多关于集合的操作

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T23:44:44.017

`@bunny.carrots`是一个数组，因此您可以通过在其上调用[数组方法](http://www.ruby-doc.org/core/classes/Array.html)来处理它，例如`unless @bunny.carrots.empty?`

# java - 从 JPA 注释的实体类自动生成数据模式

> ID：297438
> 
> 赞同：47
> 
> 时间：2008-11-18T00:09:12.657
> 
> 标签：java, database, hibernate, jpa, jakarta-ee

我正在使用 JPA（Hibernate 的实现）来注释实体类以持久保存到关系数据库（MySQL 或 SQL Server）。有没有一种简单的方法可以从带注释的类中自动生成数据库模式（表创建脚本）？

我仍处于原型设计阶段，预计会频繁更改架构。我希望能够从带注释的代码中指定和更改数据模型。Grails 的相似之处在于它从域类生成数据库。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-18T00:20:23.277

您可以使用Hibernate 中的[hbm2ddl](https://blog.eyallupu.com/2007/05/hibernates-hbm2ddl-tool.html)。文档在[这里](https://web.archive.org/web/20120606064202/http://docs.jboss.org/tools/2.1.0.Beta1/hibernatetools/html/ant.html#d0e2726)。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-07-01T08:39:09.493

**为给定的 JPA 实体生成创建和删除脚本**

我们使用这段代码来生成 drop 和 create 语句：只需使用所有实体类构造这个类并调用 create/dropTableScript。

如果需要，您可以改用 persitence.xml 和持久性单元名称。说点什么，我也发布代码。

```
import java.util.Collection;
import java.util.Properties;

import org.hibernate.cfg.AnnotationConfiguration;
import org.hibernate.dialect.Dialect;
import org.hibernate.ejb.Ejb3Configuration;

/**
 * SQL Creator for Tables according to JPA/Hibernate annotations.
 *
 * Use:
 *
 * {@link #createTablesScript()} To create the table creationg script
 *
 * {@link #dropTablesScript()} to create the table destruction script
 * 
 */
public class SqlTableCreator {

    private final AnnotationConfiguration hibernateConfiguration;
    private final Properties dialectProps;

    public SqlTableCreator(final Collection<Class<?>> entities) {

        final Ejb3Configuration ejb3Configuration = new Ejb3Configuration();
        for (final Class<?> entity : entities) {
            ejb3Configuration.addAnnotatedClass(entity);
        }

        dialectProps = new Properties();
        dialectProps.put("hibernate.dialect", "org.hibernate.dialect.SQLServerDialect");

        hibernateConfiguration = ejb3Configuration.getHibernateConfiguration();
    }

    /**
     * Create the SQL script to create all tables.
     * 
     * @return A {@link String} representing the SQL script.
     */
    public String createTablesScript() {
        final StringBuilder script = new StringBuilder();

        final String[] creationScript = hibernateConfiguration.generateSchemaCreationScript(Dialect
                .getDialect(dialectProps));
        for (final String string : creationScript) {
            script.append(string).append(";\n");
        }
        script.append("\ngo\n\n");

        return script.toString();
    }

    /**
     * Create the SQL script to drop all tables.
     * 
     * @return A {@link String} representing the SQL script.
     */
    public String dropTablesScript() {
        final StringBuilder script = new StringBuilder();

        final String[] creationScript = hibernateConfiguration.generateDropSchemaScript(Dialect
                .getDialect(dialectProps));
        for (final String string : creationScript) {
            script.append(string).append(";\n");
        }
        script.append("\ngo\n\n");

        return script.toString();
    }
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-12-05T10:22:41.877

由于 Hibernate 4.3+ 现在实现了 JPA 2.1，生成 DDL 脚本的适当方法是使用以下 JPA 2.1 属性集：

```
<property name="javax.persistence.schema-generation.scripts.action" value="create"/>
<property name="javax.persistence.schema-generation.create-source" value="metadata"/>
<property name="javax.persistence.schema-generation.scripts.create-target" value="target/jpa/sql/create-schema.sql"/> 
```

由于它将在运行时运行，您可能希望在构建时执行此 DDL 生成。 **Hibernate4 不再支持官方的 maven 插件，这可能是因为 Hibernate 团队正在转向 Gradle。**

无论如何，这是以编程方式生成此脚本的 JPA 2.1 方法：

```
import java.io.IOException;
import java.util.Properties;

import javax.persistence.Persistence;

import org.hibernate.jpa.AvailableSettings;

public class JpaSchemaExport {

    public static void main(String[] args) throws IOException {
        execute(args[0], args[1]);
        System.exit(0);
    }

    public static void execute(String persistenceUnitName, String destination) {
        System.out.println("Generating DDL create script to : " + destination);

        final Properties persistenceProperties = new Properties();

        // XXX force persistence properties : remove database target
        persistenceProperties.setProperty(org.hibernate.cfg.AvailableSettings.HBM2DDL_AUTO, "");
        persistenceProperties.setProperty(AvailableSettings.SCHEMA_GEN_DATABASE_ACTION, "none");

        // XXX force persistence properties : define create script target from metadata to destination
        // persistenceProperties.setProperty(AvailableSettings.SCHEMA_GEN_CREATE_SCHEMAS, "true");
        persistenceProperties.setProperty(AvailableSettings.SCHEMA_GEN_SCRIPTS_ACTION, "create");
        persistenceProperties.setProperty(AvailableSettings.SCHEMA_GEN_CREATE_SOURCE, "metadata");
        persistenceProperties.setProperty(AvailableSettings.SCHEMA_GEN_SCRIPTS_CREATE_TARGET, destination);

        Persistence.generateSchema(persistenceUnitName, persistenceProperties);
    }

} 
```

如您所见，它非常简单！

您现在可以在 AntTask 或 MAVEN 构建中使用它（对于 MAVEN）：

```
 <plugin>
                <artifactId>maven-antrun-plugin</artifactId>
                <version>1.7</version>
                <executions>
                    <execution>
                        <id>generate-ddl-create</id>
                        <phase>process-classes</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <target>
                                <!-- ANT Task definition -->
                                <java classname="com.orange.tools.jpa.JpaSchemaExport"
                                    fork="true" failonerror="true">
                                    <arg value="${persistenceUnitName}" />
                                    <arg value="target/jpa/sql/schema-create.sql" />
                                    <!-- reference to the passed-in classpath reference -->
                                    <classpath refid="maven.compile.classpath" />
                                </java>
                            </target>
                        </configuration>

                    </execution>
                </executions>
            </plugin> 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-04T19:33:02.460

作为相关说明：可以在[此处](http://www.eclipse.org/eclipselink/documentation/)找到使用 EclipseLink JPA 生成数据库模式的文档。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-10-28T15:08:45.937

这里解释了如何使用 hibernate SchemaExport 类来做你想做的事。

[http://jandrewthompson.blogspot.com/2009/10/how-to-generate-ddl-scripts-from.html](http://jandrewthompson.blogspot.com/2009/10/how-to-generate-ddl-scripts-from.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-10-19T08:36:27.120

如果您更喜欢在 Spring 中进行配置，那么这应该会有所帮助：

```
 <!-- CONTAINER-MANAGED JPA Entity manager factory (No need for persistence.xml)-->
    <bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
    <property name="dataSource" ref="dataSource"/>
    <property name="jpaVendorAdapter" ref="jpaVendorAdapter"/>
    <!-- Fine Grained JPA properties Create-Drop Records -->
    <property name="jpaProperties">
    <props>
    <prop key="hibernate.hbm2ddl.auto">create</prop>
    </props>
    </property> 
    </bean> 
     <!-- The JPA vendor -->
    <bean id="jpaVendorAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
    <!-- <property name="database" value="MySQL"/> -->
    <property name="showSql" value="true"/>
    <!--  <property name="generateDdl" value="true"/>  -->
    <property name="databasePlatform" value="org.hibernate.dialect.MySQLDialect"/>      
    </bean> 
     <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
        <property name="entityManagerFactory" ref="emf" />
     </bean> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-08-27T12:25:50.357

您可以使用 maven 插件来实现这一点。

```
 <plugin>
            <!-- run command "mvn hibernate3:hbm2ddl" to generate DLL -->
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>hibernate3-maven-plugin</artifactId>
            <version>3.0</version>
            <configuration>
                <hibernatetool>
                    <classpath>
                        <path location="${project.build.directory}/classes" />
                        <path location="${project.basedir}/src/main/resources/META-INF/" />                                               
                    </classpath>   

                    <jpaconfiguration persistenceunit="galleryPersistenceUnit" />                     
                    <hbm2ddl create="true" export="false" destdir="${project.basedir}/target" drop="true" outputfilename="mysql.sql" format="true" console="true"/>
                </hibernatetool>
            </configuration>
        </plugin> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-08-30T04:28:15.240

```
<property name="hibernate.hbm2ddl.auto" value="update"/> 
```

在 properties 标签下的 persistence.xml 添加上述代码。“更新”将在您第一次运行代码时创建表，之后仅在域对象发生任何更改时更新表结构。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-11-03T13:32:36.320

使用 EclipseLink，您应该添加属性：

```
<property name="eclipselink.ddl-generation" value="create-tables"/> 
```

正如这里所说：http: [//www.eclipse.org/eclipselink/documentation/2.4/jpa/extensions/p_ddl_generation.htm](http://www.eclipse.org/eclipselink/documentation/2.4/jpa/extensions/p_ddl_generation.htm)

我的persistence.xml：

```
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd">
    <persistence-unit name="appDB" transaction-type="JTA">
        <provider>org.eclipse.persistence.jpa.PersistenceProvider</provider>
        <jta-data-source>LocalMySQL</jta-data-source>
        <class>entity.Us</class>
        <class>entity.Btl</class>
        <class>entity.Co</class>
        <properties>
            <property name="eclipselink.ddl-generation" value="create-tables"/>
        </properties>
    </persistence-unit>
</persistence> 
```

# .net - ASP.NET 长时间运行的 SQL Server 过程 - 如何处理？消息传递？

> ID：297443
> 
> 赞同：1
> 
> 时间：2008-11-18T00:11:25.803
> 
> 标签：.net, sql-server

我有一个 Web 应用程序，当满足某些条件时，它需要启动一个长时间运行的 SQL Server 过程（以重建表）。执行此操作的推荐程序是什么？

我在想，当满足条件时，一条记录将被插入到数据库中，并且计划的 SQL 服务器作业将以指定的时间间隔检查该表并启动该过程。不过，这似乎有点骇人听闻。

处理此问题的首选方法是什么？作为一个相关问题，处理未来事件的首选方式是什么（即在用户注册后 10 天发送电子邮件？）

这种类型的场景是消息传递的全部内容吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T00:30:06.283

您的方法绝对可行，并且是我看到的一种方法。例如，在具有千兆字节库存数据的复杂网络中，该公司基本上实施了您所描述的内容，以允许全天部分更新库存数据。

我见过的其他一些方法涉及位于应用程序服务器上的调度服务，该服务将调用一段处理事件的代码。（例如您问题的第二部分）。在应用程序层中使用它允许您扩展事件的处理，并且您可以将数据库用作后备存储以确保您不会丢失任何事件。

您的用户是否需要查看操作的结果？您还可以启动异步调用来处理结果，然后挂断用户并提供状态信息。如果您不想挂在用户身上，那么您将需要一个状态表来存储结果。

我最不想看到的是服务代理。我还没有使用它，不确定它是否合适，但我会考虑它作为一种选择。我们已经开始研究它作为启动长期运行断开的工作流程的一种方式，但在我们到达任何地方之前我就离开了公司。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T00:25:00.193

如果您不必担心调用执行存储过程后的结果，那么异步运行它可能会更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T02:12:03.860

我想通知进行了需要重建的更改的用户 (a) 重建将要发生和 (b) 重建已完成。我想通过 UI 中的消息和电子邮件来做到这一点。我宁愿应用程序（不是数据库处理电子邮件）。

我希望能够在事务完成后很长时间在 UI 中通知他们（如果他们注销然后在当天晚些时候重新登录）。

当您说应用服务器上的调度服务时，您是指像 Windows 服务这样的东西，它完全负责处理这类事情吗？

# .net - 在没有 app.config 的情况下在 .NET exe 中禁用验证码签名验证

> ID：297449
> 
> 赞同：6
> 
> 时间：2008-11-18T00:13:46.487
> 
> 标签：.net, configuration, app-config, authenticode

有谁知道如何在不使用应用程序配置文件的情况下禁用 .NET 可执行文件中的验证码签名验证（以避免启动缓慢）？换句话说，这样做：

```
<configuration>
    <runtime>
        <generatePublisherEvidence enabled="false"/>
    </runtime>
</configuration> 
```

没有 app.config。可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T19:01:30.213

如果允许您修改 Main() 方法，那么您可以在 Main 中执行以下操作：

1.  使用 generatePublisherEvidence 在内存中创建应用程序配置文件
2.  使用新创建的应用程序配置文件创建一个新的应用程序域
3.  在另一个应用程序域中运行原来的 Main

这将允许您没有应用程序配置文件，但能够拥有您希望在应用程序配置文件中拥有的所有自定义项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T12:33:07.803

好吧，根据 MSDN，元素 generatePublishersEvidence 只能在配置文件中使用：

> **配置文件**
> 
> 此元素只能在应用程序配置文件中使用。

请参阅[http://msdn.microsoft.com/en-us/library/bb629393.aspx](http://msdn.microsoft.com/en-us/library/bb629393.aspx)。

# html - 选项卡、Text-Mate、编辑 HTML (Rails)

> ID：297460
> 
> 赞同：3
> 
> 时间：2008-11-18T00:24:37.883
> 
> 标签：html, ruby-on-rails, textmate, tabs

在编辑 HTML (Rails) 文档时，有什么方法可以强制 Text-Mate 使用两个空格的选项卡而不是完整的选项卡？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-18T00:29:30.557

是的。窗口底部中间附近有一个弹出菜单，可能`Tabs: 4`是这样的。单击它并将其挂到`2`和`Soft Tabs`。

执行此操作时，您应该打开一个`rhtml`或`erb`文档（或您想要更改的任何文件类型）进行编辑。更改将适用于该类型的所有文档。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T15:55:11.610

关于选项卡的主题，这些 TextMate 菜单命令也很有帮助：

*   文本 -> 转换 -> 空格到制表符
*   文本 -> 转换 -> 制表符到空格

[在处理Haml](http://haml.hamptoncatlin.com/)文档时，Tabs to Spaces 非常有助于修复与选项卡相关的错误。

# sql - 您如何以编程方式识别存储过程的依赖关系？

> ID：297465
> 
> 赞同：4
> 
> 时间：2008-11-18T00:29:01.917
> 
> 标签：sql, oracle, stored-procedures, plsql, oracle10g

是否可以编写一个 PL/SQL 查询来识别存储过程依赖项的完整列表？我只对识别其他存储过程感兴趣，而且我也不想限制嵌套的深度。例如，如果 A 调用 B，B 调用 C，C 调用 D，我希望 B、C 和 D 报告为 A 的依赖项。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T00:45:51.587

在[此页面上](http://www.oracle.com/technology/oramag/code/tips2004/091304.html)，您将找到以下使用[PUBLIC_DEPENDENCY](http://download.oracle.com/docs/cd/B28359_01/server.111/b28320/statviews_5132.htm#REFRN29106)字典表的查询：

```
 SELECT lvl
     , u.object_id
     , u.object_type
     , LPAD (' ', lvl) || object_name obj
   FROM ( SELECT LEVEL lvl, object_id
            FROM SYS.public_dependency s
         START WITH s.object_id =
                      ( SELECT object_id
                          FROM user_objects
                         WHERE object_name = UPPER ('&OBJECT_NAME')
                           AND object_type = UPPER ('&OBJECT_TYPE'))
         CONNECT BY s.object_id = PRIOR referenced_object_id
         GROUP BY LEVEL, object_id) tree
      , user_objects u
  WHERE tree.object_id = u.object_id
ORDER BY lvl
/ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T04:37:46.657

我同意埃迪阿瓦德的观点。

值得指出的是，Oracle 仅将依赖关系跟踪到对象级别。如果您将存储过程放在包中，则只能跟踪包中的依赖关系，而不是包中的各个函数/过程。

如果您正在寻找跟踪包内依赖项，那么您将需要一个 PLSQL 解析器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T04:16:25.570

这里还有一点值得指出的是，在某些情况下，依赖关系可能只存在于运行时，遗憾的是不会出现在元数据中。

例如，如果您在运行时构造 SQL 语句，您可能有类似以下的代码：

```
...
mysql := 'select count(*) from '||table_name_in;
execute immediate mysql;
... 
```

我已经为此烦恼了几次，但遗憾的是无法提前找到这些类型的依赖项，因为它可能取决于用户输入。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-13T12:13:59.723

要获取所有详细信息：

```
select * from all_dependencies where owner = '&OWNER' and NAME='&OBJECT_NAME' 
```

# .net - 当日志文件溢出时，如何让 PowerShell 抓取日志文件？

> ID：297468
> 
> 赞同：2
> 
> 时间：2008-11-18T00:31:16.607
> 
> 标签：.net, events, powershell, event-log

我正在使用 Powershell PSeventing 插件，但到目前为止还没有找到在事件日志已满时触发的事件。我到处寻找 MSDN .net 事件，我知道它与最大事件日志大小有关，但我找不到那个触发器，我不知道如何让 PSeventing 让事情发生。谁能帮我。预先感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T14:33:54.893

我的第一个想法是使用 FileSystemWatcher 并监视文件大小。除了监视系统事件日志之外，我没有找到任何其他选项（我认为当日志已满并且尝试写入失败时会在此处写入事件），但如果您关心的日志将不起作用是系统事件日志。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T18:58:55.967

当应用程序或系统事件日志被视为“已满”（根据配置的 OverflowAction）时，会在应用程序或系统事件日志中发生特定事件：

[http://www.eventid.net/display.asp?eventid=6000&eventno=291&source=EventLog&phase=1](http://www.eventid.net/display.asp?eventid=6000&eventno=291&source=EventLog&phase=1)

您应该特别使用 WmiEventWatcher 来监视此事件（eventid 6000，错误）的事件，就像您监视任何其他事件一样。

-Oisin（pseventing 的作者）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T20:11:36.270

感谢 Oisin 事件，但我现在正在研究在日志已满时在 Powershell 中捕获异常，然后再覆盖。我认为异常被称为“日志已满”，但我不确定，我对 Trap and Throw 了解不多，据说它的文档记录很差，但我正在追踪。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T15:16:38.833

我想知道是否有可以注册接收器的关联 WMI 事件。如果我有时间我会找一个。

好的，这就是我到目前为止所发现的。有一个可用的 __EventQueueOverflowEvent 事件接​​收器。我怀疑这*可能*对你有用。还有*可能*有用的 __SystemEvent。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-02T20:23:54.480

One way is to use Microsoft System Center or MOM to monitor for event ID 523\. I believe a patch needs to be applied to the servers that will register a full log event. Check the Microsoft Web Site. Ours triggers at 90%, I believe you can set the percentage where you want it to trigger.

You can also probably do this with WMI or Powershell, but it would have to be run frequently to catch changes. A simple DIR for the event log will give you the size, if you know the upper limit you can calculate the % full. This could be automated in VB or C#.

# forms - 使用 GET 或 POST 搜索表单

> ID：297470
> 
> 赞同：30
> 
> 时间：2008-11-18T00:32:51.253
> 
> 标签：forms, post, get

我有几个搜索表单，一个有 ~50 个字段，另一个有 ~100 个。通常，正如 HTML 规范所说，我使用 GET 方法进行搜索，因为没有更改任何数据。我还没有遇到这个问题，但我想知道我是否会很快用完 URL 空间？

[Internet Explorer](http://support.microsoft.com/kb/208427)的限制是 2083 个字符。其他浏览器，有[更高的限制](http://www.boutell.com/newfaq/misc/urllength.html)。我正在运行 Apache，所以限制大约是 4000 个字符，而 IIS 是 16384 个字符。

在 100 个字段中，假设字段名称的平均长度为 10 个字符，这已经是 5000 个字符了……在 100 个字段的表单上令人惊讶，我还没有任何错误。（25% 的字段是多选，所以字段长度要长得多。）

所以，我想知道我的选择是什么。（缩短表格不是一种选择。）这是我的想法：

*   使用 POST。我不太喜欢这个，因为目前用户可以为他们的搜索添加书签并稍后再次执行——这是一个非常棒的功能。
*   让 JavaScript 循环遍历表单以确定哪些字段与默认字段不同，填充另一个表单并提交该表单。用户当然会为缩短的版本添加书签。

还有其他想法吗？

另外，有谁知道长度是编码长度还是纯文本？

我正在用 PHP 开发，但它可能没有什么不同。

**编辑：**我无法删除任何字段；我无法缩短表格。这是客户所要求的，他们经常使用不同类别的一系列字段。我知道很难想出一个在这么多字段上看起来不错的表单，但是用户理解它是如何工作的没有问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T00:40:43.220

您的用户是否真的会使用所有 50-100 个字段进行搜索？如果他们只使用了几个，为什么不将搜索发布到一个“中间”页面，header() 将他们重定向到结果页面，只有 URL 中的用户更改字段？然后，结果页面将使用 URL 中不存在的字段的默认值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T00:41:22.843

为了间接解决您的问题，如果我面对要在一个页面上填写的 100 个字段的表单，我很可能会关闭我的浏览器，这听起来像是一场完整的可用性*噩梦*。

我的回答是，如果我有可能接近表格**正常**使用的限制，我可能做错了。

按优先顺序，我会

1.  拆分表单并使用一些服务器端状态保留
2.  切换到 POST，然后生成并重定向到 POST 上解析为相同结果的较短 URL
3.  放弃 ;）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T01:16:52.350

您在评论中提到许多字段“是隐藏的，可以根据需要打开”。

如果您愿意放弃优雅降级，您总是可以实际添加和删除表单中的字段，而不仅仅是隐藏和显示它们：浏览器不会提交表单中未包含的字段。

这是在线保险等页面使用的“制造商和型号”表格的变体——选择制造商，提交回服务器并获取该制造商的型号列表。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-18T07:27:25.393

如果您不介意使用 javascript，那么您可以让它计算出查询字符串的长度，如果它太长，则切换到帖子。然后有某种 url 映射器允许他们为这些发布的搜索添加书签。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T07:51:18.933

`GET`使用 post 并且如果用户为搜索添加书签，将其保存在数据库中并给它一个唯一的令牌，然后使用并将令牌作为参数传递给搜索页面。

TinyURL 是一个很好的例子：你给它一个很长的 URL，它把它保存到一个数据库中，给你这个 URL 的唯一标识符，然后你可以使用那个标识符请求长 URL。

在 PHP 中，它类似于以下内容：

```
<?php
if (isset($_GET['token']))
{
    $token = addslashes($_GET['token']);
    $qry = mysql_query("SELECT fields FROM searches WHERE token = '{$token}'");
    if ($row = mysql_fetch_assoc($qry))
    {
        performSearch(unserialize($row['fields']));
        exit;
    }
    showError('Your saved search has been removed because it hasn\'t been used in a while');
    exit;
}
$fields = addslashes(serialize($_POST));
$token = sha1($_SERVER['REMOTE_ADDR'].rand());
mysql_query("INSERT INTO searches (token, fields, save_time) Values ('{$token}', '{$fields}', NOW())");
header('Location: ?token='.$token);
exit;
?> 
```

并每天运行一个脚本：

```
<?php
mysql_query('DELETE FROM searches WHERE save_time < DATE_ADD(NOW(), INTERVAL -200 DAY)');
?> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T12:22:21.587

> 另外，有谁知道长度是编码长度还是纯文本？

我的猜测是编码长度。我做了一个简单的测试：一个文本区域和一个简单的 PHP 脚本的提交按钮。
在 IE6 中加载页面，在 textarea 中粘贴一些法语文本，2000 个字符。如果我点击提交按钮，什么都没有。我必须减少文本的长度才能提交。

换句话说，2083个字符的限制正是提交GET请求后在地址栏中找到的URL的最大长度。

我会选择 JavaScript 解决方案：提交时，分析表单，创建带有`hidden`属性的辅助表单，然后提交。

一些缩短输出的策略：

*   正如您所指出的，您已经可以跳过所有保留为默认值的值（无字段，无值）。
*   如果您有类似[处理论坛搜索](http://processing.org/discourse/yabb_beta/YaBB.cgi?board=;action=search "Processing 1.0 (BETA) - 设置搜索参数")中的表单，您可以将所有复选框状态仅分组到一个变量中，例如。使用字母编码。
*   使用短`value`属性（`select`例如）。

注意：如果搜索页面实际上是由几个独立的表格组成，用户只填写一个或另一个部分，您可以制作几个单独的表格。
可能不适用于您的情况，可能看起来很明显，但值得一提……^_^

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-02-12T02:24:17.613

人们可以从哲学上将搜索提交 POST 视为创建已保存的搜索（尤其是当搜索与您的用户所做的对象一样复杂时）。在这种情况下，您可以接受帖子以创建搜索，然后使用 GET 重定向以获取适当的搜索结果（发布/重定向/获取）。

这也将允许用户将搜索结果 (GET) 加入书签，以便随时返回以重新运行搜索。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-02-14T10:25:25.117

如果您的搜索结果可以共享，Get 可以有一个优势，如果您将链接发送给某人，则在发布请求的情况下，该人将看不到任何搜索结果

# c# - 为什么在创建和返回新结构时会出现此错误？

> ID：297471
> 
> 赞同：3
> 
> 时间：2008-11-18T00:33:20.627
> 
> 标签：c#, reference, events, struct, compiler-errors

编译此代码时出现错误：

```
using System;

public struct Vector2
{
    public event EventHandler trigger;

    public float X;
    public float Y;

    public Vector2 func()
    {
        Vector2 vector;
        vector.X = 1;
        vector.Y = 2;
        return vector;  // error CS0165: Use of unassigned local variable 'vector'
    }
} 
```

你好！

编译器说：“使用未分配的局部变量'vector'”并指向返回值。在我看来， Vector2 变成了一个引用类型（没有它正常运行的事件成员）。怎么了？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-18T00:38:59.930

**在 C# 中，除非您正在初始化所有**字段，否则您仍然需要“新建”一个结构来调用构造函数。您未分配 EventHandler 成员“触发器”。

尝试分配给“触发器”或使用：

```
Vector2 vector = new Vector2() 
```

新对象**没有**在堆上分配，它仍然在函数堆栈上分配。

引用[MSDN](http://msdn.microsoft.com/en-us/library/ah19swz4(VS.71).aspx)：

> 当您使用 new 运算符创建结构对象时，它会被创建并调用相应的构造函数。与类不同，结构可以在不使用 new 运算符的情况下进行实例化。**如果不使用 new，**则这些字段将保持未分配状态，并且在所有字段都初始化之前**无法使用****该对象。**

 *** * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T06:32:10.827

其他人已经解释了解决这个问题的方法，但我认为值得一提的是你的代码的另一个大问题：你有一个可变结构。这些几乎*总是*一个坏主意。如果你保持这种状态，这肯定只是你会遇到的许多问题中的第一个。

我*强烈*建议你要么让它不可变，要么让它成为一个类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T00:53:13.817

Rob Walker 的反应更好，因为他从文档开始，然后推理到代码（而我则相反）。

如果您编译示例代码并注释掉触发器字段，然后运行 ​​IlAsm 以获取生成的 MSIL，您将看到局部变量向量没有`initobj`操作码。

当结构仅包含值类型时，缺少`initobj`就很好。`Vector2`毕竟它们只是原始记忆。但是，如果`Vector2`结构还包含引用，则必须对其进行初始化，以防止出现未初始化的对象引用。

为了避免返回部分未初始化的对象，您需要`trigger`显式地写入事件处理程序，或者通过新操作初始化整个对象。但是，在任何情况下都不会将结构转换为引用类型。

# apache-flex - 无法让 itemDoubleClick 事件在 Flex 中工作（即使使用 doubleClickEnabled=true）

> ID：297472
> 
> 赞同：1
> 
> 时间：2008-11-18T00:35:22.667
> 
> 标签：apache-flex, double-click

我正在尝试使用双击事件在 Flex 中做一个简单的数据网格，但我无法`itemDoubleClick`触发：

```
<mx:DataGrid id="gridReportConversions" height="100%" width="100%" mouseEnabled="true" doubleClickEnabled="true" itemDoubleClick="refererRowDoubleClicked(event)">
                    <mx:columns>
                        <mx:DataGridColumn width="75" dataField="qty" headerText="Qty" />
                        <mx:DataGridColumn dataField="referer" headerText="URL" />
                    </mx:columns>
                </mx:DataGrid> 
```

如果我使用该`itemClicked`事件，那么该事件就会很好地引发。当我搜索这个问题时，我发现很多人说'你需要设置`doubleClickEnabled=true`，但我已经这样做了，它仍然不起作用。

该控件嵌套在 VBox 和其他容器的多个级别中。当然，我不需要`doubleClickEnabled`在每个容器上进行设置吗？

只是为了澄清我是如何测试这个的 - 我的`refererRowDoubleClicked`事件处理程序中有一个警告框，当我使用它时它永远不会显示`itemDoubleClick`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T18:44:22.860

西蒙，

我能够让你的代码工作，没问题。将其包裹在没有将 doubleClickEnabled 设置为 true 的几层容器中，以查看这是否是一个问题，但似乎不是。

我想知道其中一位父母是否以某种方式引起了问题。您是否可以发布更大的代码部分？

这是我跑来测试的：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">

    <mx:Script>
        <![CDATA[
            import mx.controls.Alert;
            import mx.collections.ArrayCollection;

            [Bindable] private var dp:ArrayCollection = new ArrayCollection([{qty:1,referer:'http://google.com'},{qty:25,referer:'http://cnn.com'},{qty:4,referer:'http:stackoverflow.com'}]);

            private function refererRowDoubleClicked(e:Event):void
            {

                var msg:String = "target: " + e.target + "\n\ncurrentTarget: " + e.currentTarget + "\n\nselected item qty: " + gridReportConversions.selectedItem.qty + "\nselected item referer: " + gridReportConversions.selectedItem.referer;
                Alert.show(msg);
            }

        ]]>
    </mx:Script>

    <mx:VBox width="100%" height="100%">        
        <mx:VBox width="100%" height="100%">      
            <mx:Box width="100%" height="100%">
                  <mx:Canvas width="100%" height="100%">                    
                      <mx:DataGrid id="gridReportConversions" height="100%" width="100%" dataProvider="{this.dp}"
                        mouseEnabled="true" doubleClickEnabled="true" itemDoubleClick="refererRowDoubleClicked(event)">
                            <mx:columns>
                                    <mx:DataGridColumn width="75" dataField="qty" headerText="Qty" />
                                    <mx:DataGridColumn dataField="referer" headerText="URL" />
                            </mx:columns>
                      </mx:DataGrid>
                </mx:Canvas>
            </mx:Box>       
        </mx:VBox>
    </mx:VBox>

</mx:Application> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-16T09:12:40.787

在我使用属性 doubleClickEnabled 之前，我的 itemDoubleClick 不起作用，但是当我设置时`doubleClickEnabled=true`，它工作得很好，没问题。

# jquery - 通过 jQuery 捕获打印事件

> ID：297482
> 
> 赞同：3
> 
> 时间：2008-11-18T00:39:09.167
> 
> 标签：jquery, printing, dynamic-css

我希望能够在我的页面被发送打印之前操作 DOM。Internet Explorer 在窗口对象上有一个名为“onbeforeprint”的事件，但这是专有的，其他浏览器不支持。是否可以通过 javascript（特别是 jQuery，如果可能的话）来做到这一点？

在你问之前，我不能轻易地使用打印媒体样式表来应用更改，因为我需要更改的元素具有不能被全局样式表覆盖的内联样式。为了打印目的，我需要覆盖这些内联样式。如果需要，应该可以修改现有的 jQuery，但这将是一个更耗时且风险更大的更改。

干杯，扎克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-08T18:23:13.900

为什么不直接从另一个函数中调用 print() 函数呢？

像：

```
function myPrint() {
  $("#myDiv").css({"border-color":"red"});
  window.print();
} 
```

然后你可以从你需要的地方调用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T01:10:30.397

在 CSS 中添加`!important`属性后将允许它覆盖内联样式。例如：

```
<div class="test" style="color: blue;">Some Text</div> 
```

CSS：

```
 .test {
     color: red !important;
  } 
```

将显示为红色。

# c - 拆分 C char* 用于电子表格单元格参考

> ID：297487
> 
> 赞同：1
> 
> 时间：2008-11-18T00:43:48.203
> 
> 标签：c

概述：我有一个解析器，它使用以下正则表达式获取单元格引用

"$"?{字母}{1,2}"$"?{digit}{1,3}

我似乎无法找到一种优雅的方式将生成的 char* 拆分为其行和列组件。

前任。将 a1 拆分为 a 和 1 或将 $aa$4 拆分为 fixed_col 固定行 4

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T00:48:26.993

你在使用正则表达式库吗？如果是这样，它是否支持访问正则表达式的分组部分，例如：

```
("$"?)({letter})({1,2})("$"?)({digit}{1,3}) 
```

（[本文](http://www.developer.com/net/net/article.php/3490231)展示了使用 .NET 正则表达式库的技术）

如果这不是一个选项，那么构建一个简单的状态机就可以很好地工作，并且易于维护和测试。

# c# - 在没有 GAC 的情况下使用代码访问安全性

> ID：297498
> 
> 赞同：1
> 
> 时间：2008-11-18T00:47:27.323
> 
> 标签：c#, security, code-access-security

我想知道是否可以使用代码访问安全性和自定义权限类（和属性），而无需在 GAC 中注册该属性所在的程序集。

目前，当调用具有我的属性的方法时，我得到一个 TypeLoadException ，我似乎无法绕过它。我读过的所有内容似乎都暗示您需要使用 GAC 才能实现这一目标。

有没有人有任何见解？

我尝试使用 PostSharp 或 AspectDNG 通过 AOP 实现相同的最终目标，但是这两者都为我的产品添加了额外的依赖项，这并不理想。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T01:14:17.143

我会说是的（但如果没有更多关于你在做什么和如何做的细节，我就无法确定）。我们在这里有 CAS 的自定义权限/角色，GAC 中没有任何关于安全性的内容。Ultimetly CAS 将需要访问您的程序集的 IPrincipal 实现。您是否查看过融合日志以确定您的组件在哪里被探测？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T02:43:16.747

谢谢你。看来您根本不能让您的自定义属性成为子类，并且您必须只有一个构造函数，该构造函数采用 SecurityAction。

# asp.net - 没有数据重新绑定的asp.net gridview排序

> ID：297500
> 
> 赞同：0
> 
> 时间：2008-11-18T00:47:49.617
> 
> 标签：asp.net, gridview

我正在尝试使 gridview 可排序，它使用存储过程作为数据源，我不希望它每次都重新运行查询来实现这一点。我如何让它工作我当前的代码是：

```
protected override void OnPreRender(EventArgs e)
{
    if (!IsPostBack)
    {
    SqlCommand cmd2 = new SqlCommand("SR_Student_Course_List", new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings["RDCV2ConnectionString"].ConnectionString));
    try
    {
        cmd2.CommandType = CommandType.StoredProcedure;
        cmd2.CommandTimeout = 120;
        cmd2.Parameters.Add("student_id", SqlDbType.Char, 11).Value = student;
        cmd2.Connection.Open();
        grdCourses.DataSource = cmd2.ExecuteReader();
        grdCourses.DataSourceID = string.Empty;
        grdCourses.DataBind();
    } finally
    {
        cmd2.Connection.Close();
        cmd2.Connection.Dispose();
        cmd2.Dispose();
    }}} 
```

此代码仅在不是回发时绑定数据，gridview 启用了视图状态。在按下列标题时，会发生回发，但不会发生排序。如果有人对此有一个简单的解决方法，请告诉我，甚至更好的 ajax 排序可以避免回发会更好。数据集相对较小，但是查询需要很长时间，这就是为什么我不想在每个排序上重新查询。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T01:47:56.173

如果您没有对结果进行分页，而只是进行读取，那么像 jquery tablesorter 插件之类的东西将是一个快速而简单的修复。我已经在多达 1400 行的表上使用了它并且效果很好，虽然 ~> 几百可能在慢速 putas 上更好。

如果 gridview 是可编辑的，那么如果您没有正确注册客户端脚本等，aspnet 事件/输入验证可能会吐出一个假人。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T00:50:08.660

您可以尝试将数据存储在视图状态（或缓存）中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T02:26:19.417

在您的情况下，我将使用 SqlDataAdapter 并填充 DataTable。然后，将 DataTable 放入 Session 变量中。当 GridView 排序时，检查 Session 变量是否仍然存在。如果没有，则再次填充 DataTable。最后使用 DataView 对 DataTable 进行排序，并将 GridView 与 DataView 重新绑定。

# sql - 选择特定日期的行的方法？

> ID：297504
> 
> 赞同：2
> 
> 时间：2008-11-18T00:51:02.823
> 
> 标签：sql, mysql

MySQL 中有没有一种方法可以使用日期列选择特定日期的行，例如星期一？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T00:55:31.723

MySQL [DAYOFWEEK](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_dayofweek)函数。

例如选择星期一：

```
SELECT * FROM foo WHERE DAYOFWEEK(bar) = 2 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T00:53:59.493

[在](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_dayofweek)MySQL Online Docs 中查找 DAYOFWEEK() 函数

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T00:57:35.307

我假设您的意思是特定的工作日名称，是的，有：

在 mysql 中，您可以使用**DAYOFWEEK()** -[查看手册](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html)

在 PHP 中，您可以使用 getdate()，例如：

$date = getdate(); $weekday = $date[工作日]; -[检查手册](http://www.php.net/getdate)

# gcc - 如何让 Makefile 自动重建包含修改后的头文件的源文件？（在 C/C++ 中）

> ID：297514
> 
> 赞同：97
> 
> 时间：2008-11-18T00:55:54.623
> 
> 标签：gcc, makefile, dependencies, header

我有以下生成文件，用于构建我正在处理的程序（实际上是内核）。它从头开始，我正在学习这个过程，所以它并不完美，但我认为它在这一点上已经足够强大，足以满足我编写 makefile 的经验水平。

```
AS  =   nasm
CC  =   gcc
LD  =   ld

TARGET      =   core
BUILD       =   build
SOURCES     =   source
INCLUDE     =   include
ASM         =   assembly

VPATH = $(SOURCES)

CFLAGS  =   -Wall -O -fstrength-reduce -fomit-frame-pointer -finline-functions \
            -nostdinc -fno-builtin -I $(INCLUDE)
ASFLAGS =   -f elf

#CFILES     =   core.c consoleio.c system.c
CFILES      =   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
SFILES      =   assembly/start.asm

SOBJS   =   $(SFILES:.asm=.o)
COBJS   =   $(CFILES:.c=.o)
OBJS    =   $(SOBJS) $(COBJS)

build : $(TARGET).img

$(TARGET).img : $(TARGET).elf
    c:/python26/python.exe concat.py stage1 stage2 pad.bin core.elf floppy.img

$(TARGET).elf : $(OBJS)
    $(LD) -T link.ld -o $@ $^

$(SOBJS) : $(SFILES)
    $(AS) $(ASFLAGS) $< -o $@

%.o: %.c
    @echo Compiling $<...
    $(CC) $(CFLAGS) -c -o $@ $<

#Clean Script - Should clear out all .o files everywhere and all that.
clean:
    -del *.img
    -del *.o
    -del assembly\*.o
    -del core.elf 
```

我对这个 makefile 的主要问题是，当我修改一个或多个 C 文件包含的头文件时，不会重新构建 C 文件。我可以通过让我的所有头文件成为我所有 C 文件的依赖项来很容易地解决这个问题，但这会在我更改/添加头文件时有效地导致项目的完全重建，这不会很优雅。

我想要的只是重建*包含*我更改的头文件的 C 文件，并重新链接整个项目。我可以通过使所有头文件成为目标的依赖项来进行链接，但我无法弄清楚当它们包含的头文件较新时如何使 C 文件失效。

我听说 GCC 有一些命令可以使这成为可能（因此 makefile 可以以某种方式找出需要重建哪些文件）但我无法找到一个实际的实现示例来查看。有人可以发布一个可以在生成文件中启用此行为的解决方案吗？

编辑：我应该澄清一下，我熟悉将单个目标放入并让每个 target.o 都需要头文件的概念。这要求我每次在某处包含头文件时都编辑makefile，这有点痛苦。我正在寻找一种可以自行派生头文件依赖项的解决方案，我相当肯定我在其他项目中看到过。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-09T13:47:57.710

正如本网站其他地方已经指出的那样，请参阅此页面： [自动依赖生成](http://make.mad-scientist.net/papers/advanced-auto-dependency-generation/)

简而言之，gcc 可以自动为您创建 .d 依赖文件，这些文件是包含您编译的 .c 文件的依赖项的迷你 makefile 片段。每次更改 .c 文件并对其进行编译时，都会更新 .d 文件。

除了将 -M 标志添加到 gcc 之外，您还需要在 makefile 中包含 .d 文件（就像 Chris 上面写的那样）。页面中有一些更复杂的问题可以使用 sed 解决，但您可以忽略它们并执行“make clean”以清除 .d 文件，只要 make 抱怨无法构建不再存在的头文件.

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-03-23T16:20:28.033

您可以像其他人所说的那样添加一个“makedepend”命令，但为什么不让 gcc 同时创建依赖项和编译：

```
DEPS := $(COBJS:.o=.d)

-include $(DEPS)

%.o: %.c
    $(CC) -c $(CFLAGS) -MM -MF $(patsubst %.o,%.d,$@) -o $@ $< 
```

“-MF”参数指定一个文件来存储依赖关系。

'-include' 开头的破折号告诉Make 在.d 文件不存在时继续（例如在第一次编译时）。

请注意，gcc 中似乎存在关于 -o 选项的错误。如果您将对象文件名设置为 say`obj/_file__c.o`则生成的`_file_.d`仍将包含`_file_.o`，而不是`obj/_file_c.o`.

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2010-03-07T00:42:18.583

这相当于[Chris Dodd 的 answer](https://stackoverflow.com/questions/297514/how-can-i-have-a-makefile-automatically-rebuild-source-files-that-include-a-modif/297543#297543)，但使用了不同的命名约定（巧合的是不需要`sed`魔法。从[后来的副本中复制](https://stackoverflow.com/questions/2394609/makefile-header-dependencies)。

* * *

如果您使用的是 GNU 编译器，编译器可以为您组装一个依赖项列表。生成文件片段：

```
depend: .depend

.depend: $(SOURCES)
        rm -f ./.depend
        $(CC) $(CFLAGS) -MM $^>>./.depend;

include .depend 
```

还有那个工具`makedepend`，但我从来没有像它那样喜欢它`gcc -MM`

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-18T00:59:40.060

您必须为每个 C 文件创建单独的目标，然后将头文件列为依赖项。您仍然可以使用您的通用目标，然后只需放置`.h`依赖项，如下所示：

```
%.o: %.c
        @echo Compiling $<...
        $(CC) $(CFLAGS) -c -o $@ $<

foo.c: bar.h
# And so on... 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-18T01:08:36.343

基本上，您需要动态创建 makefile 规则以在头文件更改时重建目标文件。如果你使用 gcc 和 gnumake，这相当容易；只需输入以下内容：

```
$(OBJDIR)/%.d: %.c
        $(CC) -MM -MG $(CPPFLAGS) $< | sed -e 's,^\([^:]*\)\.o[ ]*:,$(@D)/\1.o $(@D)/\1.d:,' >$@

ifneq ($(MAKECMDGOALS),clean)
include $(SRCS:%.c=$(OBJDIR)/%.d)
endif 
```

在你的makefile中。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-18T01:06:17.240

除了@mipadi 所说的之外，您还可以探索使用 ' `-M`' 选项来生成依赖项记录。您甚至可以将它们生成到一个单独的文件（可能是“depend.mk”）中，然后将其包含在 makefile 中。或者你可以找到一个' `make depend`'规则来编辑具有正确依赖关系的makefile（谷歌术语：“不要删除这一行”并依赖）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-09-02T15:59:40.710

更简单的解决方案：只需使用 Makefile 让 .c 到 .o 编译规则依赖于头文件以及项目中相关的任何其他内容作为依赖项。

例如，在 Makefile 某处：

```
DEPENDENCIES=mydefs.h yourdefs.h Makefile GameOfThrones.S07E01.mkv

::: (your other Makefile statements like rules 
:::  for constructing executables or libraries)

# Compile any .c to the corresponding .o file:
%.o: %.c $(DEPENDENCIES)
        $(CC) $(CFLAGS) -c -o $@ $< 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-07-01T21:29:08.250

没有一个答案对我有用。例如 Martin Fido 的回答表明 gcc 可以创建依赖文件，但是当我尝试它为我生成空（零字节）目标文件时，没有任何警告或错误。这可能是一个 gcc 错误。我在

> $ gcc --version gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-16)

所以这是我完整的 Makefile 适合我；它是解决方案+其他任何人都没有提到的东西的组合（例如“后缀替换规则”指定为.cc.o:)：

```
CC = g++
CFLAGS = -Wall -g -std=c++0x
INCLUDES = -I./includes/

# LFLAGS = -L../lib
# LIBS = -lmylib -lm

# List of all source files
SRCS = main.cc cache.cc

# Object files defined from source files
OBJS = $(SRCS:.cc=.o)

# # define the executable file 
MAIN = cache_test

#List of non-file based targets:
.PHONY: depend clean all

##  .DEFAULT_GOAL := all

# List of dependencies defined from list of object files
DEPS := $(OBJS:.o=.d)

all: $(MAIN)

-include $(DEPS)

$(MAIN): $(OBJS)
    $(CC) $(CFLAGS) $(INCLUDES) -o $(MAIN) $(OBJS) $(LFLAGS) $(LIBS)

#suffix replacement rule for building .o's from .cc's
#build dependency files first, second line actually compiles into .o
.cc.o:
    $(CC) $(CFLAGS) $(INCLUDES) -c -MM -MF $(patsubst %.o,%.d,$@) $<
    $(CC) $(CFLAGS) $(INCLUDES) -c -o $@ $<

clean:
    $(RM) *.o *~ $(MAIN) *.d 
```

注意我使用了 .cc .. 上面的 Makefile 很容易针对 .c 文件进行调整。

还要注意这两行的重要性：

```
$(CC) $(CFLAGS) $(INCLUDES) -c -MM -MF $(patsubst %.o,%.d,$@) $<
$(CC) $(CFLAGS) $(INCLUDES) -c -o $@ $< 
```

所以 gcc 被调用一次，首先构建一个依赖文件，然后实际编译一个 .cc 文件。对于每个源文件，依此类推。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-03-07T00:45:15.427

我相信`mkdep`命令就是你想要的。它实际上扫描 .c 文件中的`#include`行并为它们创建依赖关系树。我相信 Automake/Autoconf 项目默认使用这个。

# c# - 单范式 OOP 会导致抽象倒置吗？

> ID：297516
> 
> 赞同：2
> 
> 时间：2008-11-18T00:56:01.923
> 
> 标签：c#, java, abstraction, anti-patterns

对于那些不熟悉这个概念的人来说，抽象反转是在高级构造之上实现低级构造，并且通常被认为是一件坏事，因为它增加了不必要的复杂性和不必要的开销。当然，这是一个有点不精确、主观的定义。

在您看来，使用单一范式 OOP 语言进行编程，其中所有内容都必须是类的一部分，并且不会暴露诸如指针之类的东西，例如 Java 或 C#，是否不可避免地会导致抽象反转？如果是，在什么情况下？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T01:35:26.477

真正的程序员可以用任何语言编写 FORTRAN

换句话说，它不是语言，而是程序员

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T12:59:08.853

单一范式*任何东西都*违反了抽象的第一诫，似乎很少有人知道，甚至更少关心。

**如有必要，您不得对您进行任何无法覆盖的抽象，以使您的代码没有丑陋的抽象反转。**

不管你的范式是什么，一旦你开始编写重要的代码来解决现实世界的问题，你最终会得到一些不太适合范式的东西。如果你宣称只有一种范式，那就是事情变得丑陋的时候。

打个比方，当你只有一个木槌时，一切都开始看起来像一个木钉，如果你所有的洞都是圆形的，你突然变成了一些方形木钉，而你没有任何锯子，（只有木槌,) 你自己有问题。

There's no free lunch. Everything is a trade-off. The easier code becomes to write, the harder it becomes for someone else to read and maintain, or for you or anyone else to debug when problems occur below the level of abstraction that you're working at. (And they will eventually, because [no abstraction is perfect](http://www.joelonsoftware.com/articles/LeakyAbstractions.html).

This is the fundamental flaw with "helpful" technologies and paradigms such as managed code, garbage collection, JIT compilation and the "everything is an object" fiat. They impose a baseline level of abstraction that you are not allowed to reach beneath, and when something goes wrong below that level, there's nothing you can do about it. You're stuck working around a bad abstraction because you can't fix it.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T01:04:14.013

Java 和 C# 具有等效于函数的静态方法，因此该语言不会强迫您做任何事情。

就是说，一旦我真正获得了 OO，我就没有任何想要转向另一种编程风格的愿望。

如果您的简单 OO 层覆盖了一些复杂的东西，我建议您的代码可能是个问题。如果 OO 做得对，它应该一直很简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T02:33:00.403

我不认为像 Java 或 C# 这样的**语言**会以任何有形的方式受到这种影响，仅仅是因为框架附带的库非常丰富，以至于一般编程并不真正需要打破另一种范式。

也就是说，**丰富的库**本身可能会遭受抽象反转的影响，但是由于内部实现通常是隐藏的，或者关键类是密封的，试图扩展这些库的开发人员经常被迫重新实现/复制功能以成功利用扩展基类库提供的点 - 这与其说是语言问题，不如说是基类库的开发人员做出的有意识的选择，以避免暴露可能会随着 .Net Framework 的新版本而变得脆弱或经常更改的功能/JDK。

此外，由于 .Net Framework / Java Runtime 都允许与位于公共运行时之上的其他语言进行互操作，因此针对其他范式（例如函数式编程、动态语言等）的能力也可以提供另一种摆脱单一范式的途径约束。

# asp.net - 确定用户控件中的哪个按钮发送了事件

> ID：297517
> 
> 赞同：1
> 
> 时间：2008-11-18T00:56:33.640
> 
> 标签：asp.net, user-controls, onload

我有一个有几个按钮的用户控件。

On `page_load`，除非按下特定按钮，否则我想运行一个方法。

当我在用户控件内部检查发件人时`page_load`，我只得到用户控件的名称而不是按钮本身。

有没有办法可以确定按下了哪个按钮`page_load`？否则我将不得不想出一些hacky方法来解决这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T01:10:58.820

我认为您可以检查`Request.Form ("__EVENTTARGET")`-应该包含`ClientID`您的控件。

这是指 ASP.NET 事件处理框架用来跟踪用户单击的内容的隐藏字段的值。当用户触发回发时，页面上的一些 JavaScript 会将此隐藏字段设置为`ClientID`您在提交表单之前单击的控件的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T01:07:15.630

您可以在用户控件中创建一个属性以返回单击的按钮（或设置标志或其他），并将其设置在用户控件内的每个按钮的单击事件中吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T01:16:40.307

您确定您正确处理了页面模型吗？Page Load 事件发生（以构建服务器端对象模型），然后您的控件将处理绑定到控件的按钮单击事件。

除了单击用户控件中的按钮之外，页面加载可能出于任何数量的回发原因。

页面上其他控件中的按钮呢？

有时这样做是有充分理由的，但我也担心您只是在破解 ASP.NET 页面模型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-10T22:55:51.063

这是检查是否按下特定按钮的简单方法：

```
protected bool isButtonClicked(string buttonName)
    {
        bool isClicked = false;
        foreach (string ctl in this.Request.Form)
        {
            if (ctl.EndsWith(buttonName))
            {
                isButtonClicked = true;
                break;
            }
        }
        return isClicked;
    } 
```

# c# - 清除表单 C# 上的所有控件的最佳方法是什么？

> ID：297526
> 
> 赞同：16
> 
> 时间：2008-11-18T01:00:33.770
> 
> 标签：c#, controls

我确实记得不久前有人问过这样的问题，但我进行了搜索，但找不到任何东西。

我试图想出最干净的方法来清除表单上的所有控件，使其恢复默认值（例如，清除文本框、取消选中复选框）。

你会怎么做？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-18T01:02:15.907

到目前为止，我想出的是这样的：

```
public static class extenstions
{
    private static Dictionary<Type, Action<Control>> controldefaults = new Dictionary<Type, Action<Control>>() { 
            {typeof(TextBox), c => ((TextBox)c).Clear()},
            {typeof(CheckBox), c => ((CheckBox)c).Checked = false},
            {typeof(ListBox), c => ((ListBox)c).Items.Clear()},
            {typeof(RadioButton), c => ((RadioButton)c).Checked = false},
            {typeof(GroupBox), c => ((GroupBox)c).Controls.ClearControls()},
            {typeof(Panel), c => ((Panel)c).Controls.ClearControls()}
    };

    private static void FindAndInvoke(Type type, Control control) 
    {
        if (controldefaults.ContainsKey(type)) {
            controldefaults[type].Invoke(control);
        }
    }

    public static void ClearControls(this Control.ControlCollection controls)
    {
        foreach (Control control in controls)
        {
             FindAndInvoke(control.GetType(), control);
        }
    }

    public static void ClearControls<T>(this Control.ControlCollection controls) where T : class 
    {
        if (!controldefaults.ContainsKey(typeof(T))) return;

        foreach (Control control in controls)
        {
           if (control.GetType().Equals(typeof(T)))
           {
               FindAndInvoke(typeof(T), control);
           }
        }    

    }

} 
```

现在您可以像这样调用扩展方法 ClearControls：

```
 private void button1_Click(object sender, EventArgs e)
    {
        this.Controls.ClearControls();
    } 
```

编辑：我刚刚添加了一个通用的 ClearControls 方法，它将清除该类型的所有控件，可以这样调用：

```
this.Controls.ClearControls<TextBox>(); 
```

目前它只会处理顶级控件，不会深入挖掘分组框和面板。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-10-23T07:51:23.500

我知道这是一个老问题，但只有我的 2 美分。这是我用于表格清除的辅助类。

```
using System;
using System.Windows.Forms;

namespace FormClearing
{
    class Helper
    {
        public static void ClearFormControls(Form form)
        {
            foreach (Control control in form.Controls)
            {
                if (control is TextBox)
                {
                    TextBox txtbox = (TextBox)control;
                    txtbox.Text = string.Empty;
                }
                else if(control is CheckBox)
                {
                    CheckBox chkbox = (CheckBox)control;
                    chkbox.Checked = false;
                }
                else if (control is RadioButton)
                {
                    RadioButton rdbtn = (RadioButton)control;
                    rdbtn.Checked = false;
                }
                else if (control is DateTimePicker)
                {
                    DateTimePicker dtp = (DateTimePicker)control;
                    dtp.Value = DateTime.Now;
                }
            }
        }
    }
} 
```

我从像这样传递一个表单对象作为参数的任何表单调用该方法。

```
Helper.ClearFormControls(this); 
```

您可以将其扩展为其他类型的控件。你只需要投射它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T01:03:22.003

您可以循环控制

```
foreach (Control ctrl in this)
{
    if(ctrl is TextBox)
        (ctrl as TextBox).Clear();
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-18T01:14:11.840

我投票支持 Nathan 的解决方案，但想添加的内容超出了评论所能处理的范围。

他实际上非常好，但我认为最好的解决方案是在将它们添加到 GUI 之前对您可能添加的每种控件类型进行子分类。让他们都实现一个接口“Clearable”或类似的东西（我是一个java程序员，但这个概念应该在那里），然后将它作为一个“Clearable”对象的集合进行迭代，调用唯一的方法 .clear()在每一个上

这才是真正应该在 OO 系统中完成 GUI 的方式。这将使您的代码在未来易于扩展——几乎太简单了，您会感到震惊。

**编辑：（**根据 Nathan 关于不更改现有控件的评论）

也许您可以创建引用您的控件的“容器”类（每种类型的控件一个）。在类似于您在答案中设置的循环中，您可以实例化正确的容器，将实际控件放置在容器内并将容器存储在集合中。

这样你就回到了对集合的迭代。

这将是一个很好的简单解决方案，它并不比您建议的复杂得多，但可无限扩展。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-18T03:25:35.413

上述解决方案似乎忽略了嵌套控件。

可能需要递归函数，例如：

```
public void ClearControl(Control control)
{
  TextBox tb = control as TextBox;
  if (tb != null)
  {
    tb.Text = String.Empty;
  }
  // repeat for combobox, listbox, checkbox and any other controls you want to clear
  if (control.HasChildren)
  {
    foreach(Control child in control.Controls)
    {
      ClearControl(child)
    }
  }
} 
```

您不想只清除 Text 属性而不检查控件类型。

在一组派生控件上实现一个接口，例如 IClearable（如 Bill K 所建议的）将缩短此函数的长度，但需要在每个控件上做更多的工作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-18T04:30:59.133

这与我在第一个答案中提出的相同，但在 VB 中，直到我们得到 VB10，这是我们在 VB 中可以做的最好的事情，因为它不支持 lambdas 中的非返回函数：

**VB解决方案：**

```
Public Module Extension
    Private Sub ClearTextBox(ByVal T As TextBox)
        T.Clear()
    End Sub

    Private Sub ClearCheckBox(ByVal T As CheckBox)
        T.Checked = False
    End Sub

    Private Sub ClearListBox(ByVal T As ListBox)
        T.Items.Clear()
    End Sub

    Private Sub ClearGroupbox(ByVal T As GroupBox)
        T.Controls.ClearControls()
    End Sub

    <Runtime.CompilerServices.Extension()> _
    Public Sub ClearControls(ByVal Controls As ControlCollection)
        For Each Control In Controls
            If ControlDefaults.ContainsKey(Control.GetType()) Then
                ControlDefaults(Control.GetType()).Invoke(Control)
            End If
        Next
    End Sub

    Private _ControlDefaults As Dictionary(Of Type, Action(Of Control))
    Private ReadOnly Property ControlDefaults() As Dictionary(Of Type, Action(Of Control))
        Get
            If (_ControlDefaults Is Nothing) Then
                _ControlDefaults = New Dictionary(Of Type, Action(Of Control))
                _ControlDefaults.Add(GetType(TextBox), AddressOf ClearTextBox)
                _ControlDefaults.Add(GetType(CheckBox), AddressOf ClearCheckBox)
                _ControlDefaults.Add(GetType(ListBox), AddressOf ClearListBox)
                _ControlDefaults.Add(GetType(GroupBox), AddressOf ClearGroupbox)
            End If
            Return _ControlDefaults
        End Get
    End Property

End Module 
```

**来电：**

```
Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        Me.Controls.ClearControls()
    End Sub 
```

我只是在这里发布这个，以便人们可以看到如何在 VB 中做同样的事情。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-12T12:09:04.227

私有无效 FormReset() { ViewState.Clear(); Response.Redirect(Request.Url.AbsoluteUri.ToString()); }

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T02:36:26.853

下面是我用来从一种实现 ITextBox 的控件中清除文本的**方法**。

我注意到在示例中设置了默认布尔值。我相信你可以修改它来设置布尔组件的默认值。

向 Clear 方法传递一个控件类型（TextBox、Label... 等）和一个控件集合，它将清除实现 ITextBox 的控件中的所有文本。

像这样的东西：

```
//Clears the textboxes
WebControlUtilities.ClearControls<TextBox>(myPanel.Controls); 
```

Clear 方法适用于页面或母版页。控件集合类型可能会有所不同。IE。表单、ContentPlaceHolder.. 等

```
 /// <summary>
    /// Clears Text from Controls...ie TextBox, Label, anything that implements ITextBox
    /// </summary>
    /// <typeparam name="T">Collection Type, ie. ContentPlaceHolder..</typeparam>
    /// <typeparam name="C">ie TextBox, Label, anything that implements ITextBox</typeparam>
    /// <param name="controls"></param>
    public static void Clear<T, C>(ControlCollection controls)
        where C : ITextControl
        where T : Control
    {
        IEnumerable<T> placeHolders = controls.OfType<T>();
        List<T> holders = placeHolders.ToList();

        foreach (T holder in holders)
        {
            IEnumerable<C> enumBoxes = holder.Controls.OfType<C>();
            List<C> boxes = enumBoxes.ToList();

            foreach (C box in boxes)
            {
                box.Text = string.Empty;
            }
        }
    }

    /// <summary>
    /// Clears the text from control.
    /// </summary>
    /// <typeparam name="C"></typeparam>
    /// <param name="controls">The controls.</param>
    public static void ClearControls<C>(ControlCollection controls) where C : ITextControl
    {
        IEnumerable<C> enumBoxes = controls.OfType<C>();
        List<C> boxes = enumBoxes.ToList();

        foreach (C box in boxes)
        {
            box.Text = string.Empty;
        }
    } 
```

# iphone - 我应该如何与 UIView 的几何图形交互，而不考虑应用的任何变换？

> ID：297530
> 
> 赞同：3
> 
> 时间：2008-11-18T01:02:31.427
> 
> 标签：iphone, cocoa-touch

我有一个观点，我希望用户通过点击并按住某处并绕着它的中心旋转，然后一圈又一圈地移动他们的手指。

我已经解决了所有的几何问题；我所做的是将相对于中心的初始触摸角度存储为 offsetAngle，然后我的 touchesMoved 方法如下所示：

```
- (void) touchesMoved: (NSSet *)touches withEvent:(UIEvent *)event {
    self.transform = CGAffineTransformMakeRotation(0);
    CGPoint location = [[touches anyObject] locationInView: self];    
    CGPoint actualCenter = [self convertPoint: self.center fromView: self.superview];    
    CGPoint relativeTouch = [MathHelper translatePoint:location relativeTo: actualCenter];
    CGPoint zero = CGPointMake(0, 0);
    float angle = [MathHelper getAngleForPoint:zero andPoint:relativeTouch];
    self.transform = CGAffineTransformMakeRotation(offsetAngle-angle);
} 
```

丑陋的位是第一行，我必须恢复旋转才能在视图中获得正确的事件位置。如果我不那样做，那么由于视图在旋转，所以位置会到处乱跳，因为没有连续性……

另一个问题是当您想要操作视图的框架（例如，将其向下移动）时，当视图应用了变换时：

```
- (IBAction)toggleSettingsView {
    BOOL state = [settingsSwitch isOn];
    float height = optionsView.bounds.size.height;
    CGRect polygonFrame = polygonView.frame; 

    [UIView beginAnimations:@"advancedAnimations" context:nil]; 
    [UIView setAnimationDuration:0.3]; 
    if (state) {
        optionsView.alpha = 1.0; 
        polygonFrame.origin.y += height; 
    } else {
        optionsView.alpha = 0.0; 
        polygonFrame.origin.y -= height; 
    }
    polygonView.frame = polygonFrame;
    [UIView commitAnimations]; 

} 
```

这严重扭曲了视图。

必须提一下，CGTransform 和 CALayer 变换都具有相同的效果。

这闻起来像是我做错了什么，但我不知道我应该做什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T19:08:43.310

我会使用超级视图的坐标系，因为它不受旋转的影响：

```
- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event
{
    CGPoint location = [[touches anyObject] locationInView:self.superview];
    CGPoint relativeTouch = [MathHelper translatePoint:location relativeTo:self.center];
    CGPoint zero = CGPointMake(0, 0);
    float angle = [MathHelper getAngleForPoint:zero andPoint:relativeTouch];
    self.transform = CGAffineTransformMakeRotation(offsetAngle-angle);
}
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-23T06:48:00.720

只需将原始转换保存在 ivar 中即可。

# php - 在 PHP 中检测客户端语言环境的最简单方法

> ID：297542
> 
> 赞同：33
> 
> 时间：2008-11-18T01:07:33.600
> 
> 标签：php, locale

我希望能够使用 PHP 在我的网站上检测访问者来自哪个国家/地区。

请注意，我并没有试图将其用作安全措施或任何重要的事情，只是改变一些单词的拼写*（美国人似乎认为“注册”这个词有 2 个 Ls* ....也许在“选择您的国家”列表中提供默认选项。

因此，使用地理定位数据库有点过头了，我真的不想为此而安装新的 PHP 库，那么**找到访问者来自哪个国家/地区的最简单/最简单的方法是什么？**

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2014-03-11T19:12:30.047

`$_SERVER['HTTP_ACCEPT_LANGUAGE']`自 5.3.0 起，PHP 提供了一个函数来将变量解析为语言环境。

```
$locale = Locale::acceptFromHttp($_SERVER['HTTP_ACCEPT_LANGUAGE']);
echo $locale; // returns "en_US" 
```

文档：[https ://www.php.net/manual/en/locale.acceptfromhttp.php](https://www.php.net/manual/en/locale.acceptfromhttp.php)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-18T01:14:23.183

不能保证，但大多数浏览器都会提交一个 Accept-Language HTTP 标头，如果它们来自美国，则指定 en-us。不过，一些较旧的浏览器只说它们是 en。并非所有机器都正确设置以指示他们喜欢哪种语言环境。但这是一个很好的初步猜测。

基于English-UK 的用户通常将他们的系统或用户区域设置为English-UK，在默认浏览器配置中应该将en-gb 作为Accept Language 标头。（这个的早期版本说 en-uk；那是一个错字，抱歉。）其他国家也有 en 语言环境，例如 en-za（南非），而且，主要从理论上讲，像 en-jp 这样的组合也是可能的。

然而，基于 Geo-IP 的猜测在首选语言/区域设置上不太可能是正确的。Google 认为基于 IP 地址地理位置的内容协商是有道理的，当我在日本或韩国时，这真的让我很恼火......

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-18T01:16:38.123

您可以查看大多数浏览器将发送的`HTTP_ACCEPT_LANGUAGE`标头（来自）。`$_SERVER`

以[Zend_Locale](http://framework.zend.com/manual/en/zend.locale.html#zend.locale.selection.automatic)为例，或者您甚至可能想要使用 lib。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-18T01:12:22.920

**您可以在没有**整个库的情况下进行一些 IP比较。

### 解决方案#1

使用 API，这样您就不需要任何东西。这是一个让您了解国家/地区的 Web API：

```
 Example: http://api.hostip.info/get_html.php?ip=12.215.42.19
 Return : Country: UNITED STATES (US) 
```

### 解决方案#2

但是，你有没有想过使用浏览器代理语言？您也许可以从中知道英语的类型。

### 解决方案#3

这个名为[BlockCountry](http://www.blockacountry.com/)的网站可让您按国家/地区列出 IP。当然，您不想阻止，但您可以使用 IP 列表并比较它们（获取所有美国 IP...）这可能不准确...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-18T01:45:53.977

鉴于您声明的目的，Accept-Language 标头是比基于 IP 的地理定位更合适的解决方案。事实上，这正是 Accept-Language 的预期目的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-18T02:49:59.463

解析`$_SERVER["HTTP_ACCEPT_LANGUAGE"]`以获取国家和浏览器的语言环境。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-03-01T00:53:51.983

我使用 HTTP_ACCEPT_LANGUAGE

```
 $localePreferences = explode(",",$_SERVER['HTTP_ACCEPT_LANGUAGE']);
    if(is_array($localePreferences) && count($localePreferences) > 0) {
       $browserLocale = $localePreferences[0];
       $_SESSION['browser_locale'] = $browserLocale;
    } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-18T01:16:08.827

为了识别您的访问者国家/地区，我使用了[GeoIP](http://www.php.net/geoip)扩展，使用起来非常简单。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-18T01:21:26.147

[http://countries.nerd.dk](http://countries.nerd.dk)服务是我用于 IP 到国家/地区映射的服务。它工作得非常好，并且基于 DNS，缓存也很好。

如果您不想依赖外部服务，也可以下载数据库以供本地使用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-12T09:43:08.727

GeoIP 扩展是不错的选择。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-05-15T08:20:22.997

或者您可以执行以下操作：

[从http://www.maxmind.com/app/geoip_country](http://www.maxmind.com/app/geoip_country)下载“geoip.dat”和 geoip.inc

在 geoip.inc 标题中，您将找到如何使用它（例如初始化和其余的......）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-13T16:49:28.333

一件事是观看者想要哪种语言，其次是您可以提供的服务：

```
$SystemLocales = explode("\n", shell_exec('locale -a'));
$BrowserLocales = explode(",",str_replace("-","_",$_SERVER["HTTP_ACCEPT_LANGUAGE"])); // brosers use en-US, Linux uses en_US
for($i=0;$i<count($BrowserLocales);$i++) {         
  list($BrowserLocales[$i])=explode(";",$BrowserLocales[$i]); //trick for "en;q=0.8"
  for($j=0;$j<count($SystemLocales);$j++) {
    if ($BrowserLocales[$i]==substr($SystemLocales[$j],0,strlen($BrowserLocales[$i]))){
      setlocale(LC_ALL, $SystemLocales[$j]);
      break 2; // found and set, so no more check is needed
    }
  }
} 
```

例如，我的系统仅服务于：

*   C
*   POSIX
*   pl_PL.UTF-8

我的浏览器语言是：pl、en-US、en => 所以唯一正确的语言环境是 pl_PL.UTF-8。

当没有找到成功的比较时 - 根本没有 setlocale。

# jquery - 如果选中某些复选框，则 jquery 验证表单输入

> ID：297555
> 
> 赞同：3
> 
> 时间：2008-11-18T01:14:28.393
> 
> 标签：jquery, checkbox, validation

我有一个多部分表单，它在开头使用一些 jquery.validate 错误检查来获取基本用户信息，以查看字段是否已填写并且电子邮件地址是否有效。

下面有一系列用于新帐户、删除帐户、新软件等的复选框 (type_of_request)，它们在选中/取消选中时显示/隐藏这些表单元素。

只有在检查了相应的 type_of_request 项目后，我才想验证表单上的所需部分。

* * *

更新资料

* * *

这是一个很好的解决方案，但似乎需要选定部分的所有子项。

一个典型的场景是 type_request 中的 email 和其他复选框都被选中：

```
 <div id="email" style="display: block;"> // shown because other has been selected in the type request
     <input id="email_new_account" class="sq-form-field" type="checkbox" value="0" name="q4836:q1"/> // not required
     <input id="email_new_account_name" class="sq-form-field" type="text" name="q4836:q2"/> // if email_new_account checked then make required
     <input id="email_new_account_access" class="sq-form-field" type="text" name="q4836:q2"/> // if email_new_account checked then make required
     <input id="email_new_account_manager" class="sq-form-field" type="text" name="q4836:q3"/> // if email_new_account checked then make required

     <input id="email_add_remove_access" class="sq-form-field" type="checkbox" value="0" name="q4837:q1"/> // not required
     <input id="email_add_remove_account_name" class="sq-form-field" type="text" name="q4837:q2"/> // if email_add_remove_access checked then make required
     <input id="email_add_access" class="sq-form-field" type="text" name="q4836:q2"/> // if email_add_remove_access checked then make required
     <input id="email_remove_access" class="sq-form-field" type="text" name="q4837:q3"/> // if email_add_remove_access checked then make required
   </div>
   <div id="other" style="display: block;"> // shown because other has been selected in the type request
     <input id="other_describe_request" class="sq-form-field" type="text" name="q4838:q1"/> // required because #other was checked in type request
     <input id="other_request_justification" class="sq-form-field" type="text" name="q48387:q2"/> // required because #other was checked in type request
   </div> 
```

* * *

延伸阅读

* * *

我对此进行了进一步审查，发现可以将以下内容添加到输入项的类中

```
class="{required:true, messages:{required:'Please enter 
your email address'}}" 
```

或者

```
class="{required:true, email:true, messages:{required:'Please enter 
your email address', email:'Please enter a valid email address'}}" 
```

但是当我添加

```
class="{required:'input[@name=other]:checked'}" 
```

在[http://jquery.bassistance.de](http://jquery.bassistance.de/api-browser/plugins.html#jQueryvalidatormethodsrequiredStringElementBooleanStringFunction)网站上进行了描述，但它不起作用。我是否需要更改语法才能使其正常工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T01:40:07.543

假设您使用的是 jQuery[验证插件](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)，您可以根据单击的复选框设置/清除必需/非必需部分中每个控件的类。

```
$(document).ready( function() { $('form').validate(); } );

function init_validation(divName)
{
    $('div#' + divName).find('input').addClass( 'required' );
    $('div#inputs').children('div:not(#' + divName + ')')
                  .find('input')
                  .removeClass( 'required' );
} 
```

HTML：

```
<form>
<div>
  <input type='radio'
         id='new_account_radio'
         name='interface_selector'
         value='new_account'
         selected=true
         onclick='init_validation("new_account");' /> New Account

  <input type='radio'
         id='delete_account_radio'
         name='interface_selector'
         value='delete_account'
         onclick='init_validation("delete_account");' /> Delete Account

  <input type='radio'
         id='new_software_radio'
         name='interface_selector'
         value='new_software'
         onclick='init_validation("new_software");' /> New Software

</div>

<div id='inputs'>
   <div id='new_account'>
       <input type='text' id='new_account_name' class='required' />
   </div>

   <div id='delete_account'>
       <input type='text' id='delete_account_name' />
   </div>

   <div id='new_software'>
       <input type='text' id='new_software_name' />
   </div>
</div>
</form> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T23:44:45.573

我最终采用的解决方案是从[http://bassistance.de/jquery-plugins/jquery-plugin-validation/链接 jquery.validate.js 和 jquery.metadata.js](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)

然后，我在表单顶部有一个请求类型的检查列表，当您检查项目时显示/隐藏 id 元素（未显示显示/隐藏功能）。

```
<fieldset id="request-type">
<legend>Type of Request</legend>
<ul>
<li><input type="checkbox" name="q4838:q1[]" id="q4838_q1_0" value="0"  class="sq-form-field" /><label for="q4838_q1_0">New account</label></li>
<li><input type="checkbox" name="q4838:q1[]" id="q4838_q1_1" value="1"  class="sq-form-field" /><label for="q4838_q1_1">Delete account</label></li>
<li><input type="checkbox" name="q4838:q1[]" id="q4838_q1_2" value="2"  class="sq-form-field" /><label for="q4838_q1_2">Change access/account transfer</label></li>
<li><input type="checkbox" name="q4838:q1[]" id="q4838_q1_3" value="3"  class="sq-form-field" /><label for="q4838_q1_3">Hardware</label></li>
<li><input type="checkbox" name="q4838:q1[]" id="q4838_q1_4" value="4"  class="sq-form-field" /><label for="q4838_q1_4">Software</label></li>
<li><input type="checkbox" name="q4838:q1[]" id="q4838_q1_5" value="5"  class="sq-form-field" /><label for="q4838_q1_5">Email</label></li>
<li><input type="checkbox" name="q4838:q1[]" id="q4838_q1_6" value="6"  class="sq-form-field" /><label for="q4838_q1_6">Other</label></li>
</ul>
</fieldset> 
```

对于这个例子，我们会说“删除帐户”已被选中，这将“显示”

```
<fieldset id="delete-account" style="display: block;"> 
```

因为选中删除帐户选项时，字段集中的两个输入字段都是必需的，所以我已将以下内容添加到所需输入的类属性中。

```
class="{required:'#checkboxid:checked', messages:{required:'required error message'}}" 
```

“删除帐户”字段集看起来像这样......

```
<fieldset id="delete-account" style="display: block;">
<legend>Delete Account</legend>

<label  for="q4832_q1">Cessation date</label>
<input type="text" name="q4832:q1value[d]" value="" class="{required:'#q4838_q1_1:checked', messages:{required:'Enter Cessation Date'}}" id="q4832:q1value[d]" />

<label  for="q4832_q1">List of assets</label>
<input type="text" name="q4832:q2" value="" class="{required:'#q4838_q1_1:checked', messages:{required:'Enter Cessation Date'}}" id="q4832:q2" />
</fieldset> 
```

类中的“必需”值通常适用于 true 或 false ie `{required:'true', messages:{required:'This field is required'}}`，但在这种情况下，我们在其中放置了一个引用而不是标准的 true 或 false, `#checkboxid:checked`。如果选中，则返回 as`'true'`并且该字段成为必填项，如果返回，则`'false'`该字段不是必填项。

我发现有用的另一件事是通过将以下内容添加到每个复选框的类属性中来确保有人在表单的开头选择了请求类型

```
class="{required:'true', minlength:1, messages:{required:'Please select a checkbox'}}" 
```

如果您需要多于一个复选框，则只需添加到最小长度。

# c# - NHibernate 中为 Null 时可空属性导致错误

> ID：297563
> 
> 赞同：0
> 
> 时间：2008-11-18T01:18:23.580
> 
> 标签：c#, sql-server, nhibernate

我在我的 HBM 文件中定义了一个属性，如下所示：

```
<property name="OwnerId" column="OwnerID" type="System.Int32" not-null="false" /> 
```

它也被定义为数据库中的可空字段。如果数据库中的记录将 OwnerID 列设置为整数，则 NHibernate 会正确加载此对象。但是，如果记录将其设置为 null，NHibernate 会引发看似随机的错误，包括：

1) 列名“ModuleAnchorID”在结果列列表中出现多次：

```
[SqlException (0x80131904): Column name 'ModuleAnchorID' appears more than once in the result column list.]
   System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) +925466
   System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) +800118
   System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) +186
   System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +1932
   System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString) +149
   System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async) +1005
   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result) +132
   System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(DbAsyncResult result, String methodName, Boolean sendToPipe) +149
   System.Data.SqlClient.SqlCommand.ExecuteNonQuery() +135
   NHibernate.Impl.NonBatchingBatcher.AddToBatch(IExpectation expectation) +35
   NHibernate.Persister.Entity.AbstractEntityPersister.Update(Object id, Object[] fields, Object[] oldFields, Boolean[] includeProperty, Int32 j, Object oldVersion, Object obj, SqlCommandInfo sql, ISessionImplementor session) +1055 
```

2) 非空属性引用空值或瞬态值：

```
[PropertyValueException: not-null property references a null or transient value:]
   NHibernate.Impl.SessionImpl.CheckNullability(Object[] values, IEntityPersister persister, Boolean isUpdate) +224
   NHibernate.Impl.SessionImpl.FlushEntity(Object obj, EntityEntry entry) +1019
   NHibernate.Impl.SessionImpl.FlushEntities() +182
   NHibernate.Impl.SessionImpl.FlushEverything() +90
   NHibernate.Impl.SessionImpl.AutoFlushIfRequired(ISet querySpaces) +64
   NHibernate.Impl.SessionImpl.Find(CriteriaImpl criteria, IList results) +217
   NHibernate.Impl.SessionImpl.Find(CriteriaImpl criteria) +42
   NHibernate.Impl.CriteriaImpl.List() +29 
```

OwnerID 是一个保留字段名称，它会以某种方式混淆 NHibernate 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T04:14:50.167

您可以将对象中的类型更改为 Nullable（int？）。OwnerId 不是保留关键字。如果您考虑一下，如何将 DB null 映射到 Int32。值对象不支持空语义，因此您确实需要使用可为空的类型。

至于 ModuleAnchorId 我建议你打开显示 sql，然后将 sql 发布到谷歌上的 nhibernate 用户组。nHibernate 开发人员关注该组。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T04:41:03.530

您需要在类定义中将属性的类型设置`OwnerID`为。`int?`你也可以去掉 中的`type`属性，`.hbm.xml`因为 NHibernate 可以从反射中推断类型。

# web-services - SOA - 您的公司首先实施了哪些内部 Web 服务？

> ID：297565
> 
> 赞同：4
> 
> 时间：2008-11-18T01:20:02.640
> 
> 标签：web-services, soa

贵公司首先实施了哪些内部 Web 服务？你学到了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T20:39:25.083

最早的推动者之一是“客户基础系统”。

公司内所有客户的共同权限。

编辑：
关于评论：
它确实为更多的 SOA 开放。大约是 3 到 5 年前（在我之前），目前众所周知，去年 SOA 帮助公司在一年内从延迟 3 年的系统切换到新系统。

关于其他东西：
不要让我开始我们的 SAP 集成：S 那也是 3 岁，没有人真正能够调试或更新设置。目前我们正在POCing webservice 与SAP 的集成。呸呸呸

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-12T02:09:14.653

我们刚刚实现了一个信用卡处理 Web 服务，它允许我们处理来自 Delphi POS 系统和 Classic ASP 网站的交易。此外，我们希望让它与基于 Java 的 IVR 系统一起工作。

Web 服务是用 ASP.NET (C#) 编写的，并利用 SSL 加密、XML、XSD 验证和负载平衡的 Web 场。

我们最近还实施了各种公用事业服务，可以完成从地址验证到在我们的 ERP 系统中创建订单的所有工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T14:12:21.927

我们的第一个 Web 服务实际上是对外暴露的。它使我们提前考虑安全性...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-19T17:20:29.127

让我看看我能不能把这个对话继续下去。我的公司围绕最常见的 Active Directory 查找需求实施了一个包装器。我想这可能是在 Microsoft/.NET 商店中首先要做的最常见的事情之一。

有人实施公用事业服务库吗？为某个 SAP 模块编写外观？总结一些人力资源服务？我很好奇人们在做什么。

# database - 如何将 Web 服务的结果与数据库同步？

> ID：297572
> 
> 赞同：2
> 
> 时间：2008-11-18T01:21:30.220
> 
> 标签：database, performance, data-structures, comparison

我正在寻找一种方法来快速将数据库表的状态与 Web 服务调用的结果进行比较。

我需要确保 Web 服务调用返回的所有记录都存在于数据库中，并且从表中删除数据库中不再存在于 Web 服务响应中的所有记录。

我必须解决的问题：

1.  如何快速将数据结构与数据库表的结果进行比较？
2.  当我发现不同之处时，如何快速添加新内容并删除已消失的内容？

对于数字 1，我正在考虑对数据结构进行 MD5 并将其存储在数据库中。如果 MD5 不同，那么我将转到第 2 步。**是否有更好的方法将响应数据与数据库状态进行比较？**

我需要更多关于数字 2 的指导。我可以轻松地从表中检索所有记录（SELECT * FROM users WHERE user_id = 1），然后循环遍历一个数组，添加数据库中没有的内容并创建另一个要删除的项目数组随后的电话，但我希望这样做更好（更快）。**将数据结构与数据库表的子集进行比较和同步的最佳方法是什么？**

感谢您对这些问题的任何见解！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T04:09:31.393

不要因为过早的优化而自杀。使用一次插入每一行的简单方法。如果您发现在循环时遇到事务问题（例如锁定表的时间过长），您可以先将行插入到临时表中，然后再插入到真正的目标表中。

如果您使用的是 SQL Server，您可以进行批量插入，或将数据打包成 XML，但我仍然强烈建议您先以简单的方式实现它，然后对其进行测试，如果您可以使用生产数据（或相同数量的数据），然后仅在需要时才进行优化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T18:44:07.367

我最近陷入了类似的问题。我们（非常简单）的解决方案是将 Web 服务数据加载到与 DB 表具有相同结构的表中。DB 表保留其最重要列的哈希，并且相同的哈希函数应用于 Web 服务表中的相应列。

然后“同步”逻辑如下所示：

1.  从 Web 服务表中删除任何具有在 DB 表中存在的哈希值的行。这是不需要同步的重复数据。

    `DELETE FROM ws_table WHERE hash IN (SELECT hash from db_table);`

2.  从 DB 表中删除任何在 Web 服务表中找不到哈希的行。

    `DELETE FROM db_table WHERE hash NOT IN (SELECT hash FROM ws_table);`

3.  Web 服务表中剩余的任何内容都是新数据，现在应该插入到 DB 表中。

    `INSERT INTO db_table SELECT ... FROM ws_table;`

这是一种相当蛮力的方法，如果以事务方式完成（即使只是步骤 2 和 3）在持续时间内锁定数据库表，但它非常简单。

一种改进是使用语句来处理更改的记录`UPDATE`，但这会增加很多复杂性，并且可能不会比 a`DELETE`后跟 an快`INSERT`。

另一种可能的优化是设置一个标志而不是删除行。然后可以稍后删除这些行。但是，使用 DB 表的任何逻辑都必须忽略带有设置标志的行。

# asp.net - 在会话中存储购物车

> ID：297576
> 
> 赞同：7
> 
> 时间：2008-11-18T01:25:08.403
> 
> 标签：asp.net, session

我知道对于购物车项目等信息的普遍共识是将它们存储在会话中。但是，属于某个用户且可以被其他用户更改的对象呢？比如说，一个类似 eBay 的网站。如果您将用户的“项目”存储在会话中，其中包含当前的出价金额，并且另一个用户进来并对该项目出价，您将必须更新数据库中的项目以及会话中的项目，你不会吗？

在这种情况下，唯一的选项是存储在会话中并在其他用户采取的任何操作影响一个人的会话值时刷新，或者将所有内容存储在数据库中并每次检索它（例如，如果您显示出价，可能会变得昂贵在每页的侧板上）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-18T01:46:05.443

我会将它全部存储在数据库中并每次都检索它。根据数据的波动性，缓存几秒钟可能是有序的。最大的问题是保持两者一致。

我认为每次检索数据并不像您想象的那么昂贵。如果您基于键进行查找，则数据库非常有效。我会在简单性方面犯错（存储在数据库中并检索），直到在负载下出现性能问题（即在负载测试中）。

如果只有少数几次，您可以使用应用程序缓存（除非您有多个工作进程/服务器）并确保数据库和缓存保持同步。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-18T01:51:23.153

我会亲自将其存储在数据库中。首先，因为您的数据在那里更安全，并且在您需要网络农场的情况下更容易共享。此外，您不需要在每一页上都有数据。就在用户去购物车的时候。将其存储在数据库中的另一个好处是您可以稍后分析人们添加到购物车但实际上并未购买的东西。

# algorithm - 国际象棋有完美的算法吗？

> ID：297577
> 
> 赞同：110
> 
> 时间：2008-11-18T01:25:43.970
> 
> 标签：algorithm, chess, game-theory

我最近在与一位非编码人员讨论国际象棋计算机的可能性。我对理论并不精通，但我认为我知道的足够多。

我认为，不可能存在一个总是在国际象棋中获胜或陷入僵局的确定性图灵机。我认为，即使您搜索 player1/2 动作的所有组合的整个空间，计算机在每一步中决定的单个动作也是基于启发式的。基于启发式，它不一定能击败对手可以做的所有动作。

相反，我的朋友认为，如果计算机从不犯“错误”举动，那么它总是会赢或打平（但是您如何定义？）。但是，作为一个学过 CS 的程序员，我知道即使是你的好选择——给定一个聪明的对手——最终也会迫使你做出“错误”的举动。即使你什么都知道，你的下一步行动是贪婪地匹配一个启发式。

大多数国际象棋计算机试图将可能的最终游戏与正在进行的游戏相匹配，这本质上是一种动态编程回溯。再一次，有问题的残局是可以避免的。

编辑：嗯......看起来我在这里激怒了一些羽毛。那挺好的。

再想一想，解决像国际象棋这样的有限游戏似乎没有理论上的问题。我认为国际象棋比跳棋要复杂一点，因为获胜不一定是通过棋子的数字耗尽，而是通过队友。我最初的断言可能是错误的，但话又说回来，我想我已经指出了一些尚未得到令人满意的证明（正式）的东西。

我想我的思想实验是，每当树中的一个分支被取走时，算法（或记忆的路径）必须为对手移动的任何可能分支找到一条通向配偶的路径（而不是交配）。讨论后，我会购买，因为内存比我们想象的要多，所有这些路径都可以找到。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2008-11-18T01:40:54.657

“我认为不可能存在一个总是在国际象棋中获胜或陷入僵局的确定性图灵机。”

你不太对。可以有这样的机器。问题是它必须搜索的状态空间巨大。它是有限的，它**真的**很大。

这就是国际象棋依赖启发式的原因——状态空间太大（但有限）。甚至列举——更不用说在每一个可能的游戏的每一个过程中搜索每一个完美的移动——将是一个非常非常大的搜索问题。

开局的脚本是为了让你进入一个给你一个“强大”位置的游戏中期。不是一个已知的结果。即使是最后的比赛——当棋子较少时——也很难列举出最佳的下一步行动。从技术上讲，它们是有限的。但是替代品的数量是巨大的。即使是 2 车 + 国王也有 22 种可能的下一步行动。如果需要 6 步才能配对，那么您将看到 12,855,002,631,049,216 步。

对开局动作进行数学计算。虽然只有大约 20 个开始动作，但有大约 30 个第二个动作，所以到第三个动作时，我们正在查看 360,000 个替代游戏状态。

但是国际象棋游戏（技术上）是有限的。巨大，但有限。有完美的信息。有定义的开始和结束状态，没有掷硬币或掷骰子。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2009-04-15T22:49:02.513

我对国际象棋的实际发现几乎一无所知。但作为一名数学家，这是我的推理：

首先我们必须记住，白方先走，也许这给了他一个优势；也许它给了黑方一个优势。

现在假设黑方*没有完美的策略*让他总是获胜/相持。这意味着无论黑方做什么，白方都可以遵循一种策略来取胜。等一下——这意味着白方有*一个*完美的策略！

这告诉我们，至少两个玩家中的一个*确实*有一个完美的策略，可以让那个玩家总是赢或平。

那么只有三种可能：

*   如果白棋打得完美，白棋总能赢
*   如果黑棋打得完美，黑棋总能赢
*   如果一名球员发挥出色，他就可以获胜或平局（如果两名球员都发挥出色，那么他们总是处于胶着状态）

但其中哪一个实际上是正确的，我们可能永远不会知道。

问题的答案是**肯定**的：国际象棋必须有一个完美的算法，至少对于两个棋手之一。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-11-18T01:40:58.730

[对于跳棋游戏](http://www.sciam.com/podcast/episode.cfm?id=E3E98228-E7F2-99DF-392B5305E37F61F1)已经证明，一个程序总是可以赢得或平局。也就是说，没有一个玩家可以做出迫使另一玩家输的动作的选择。

> **研究人员花了将近 20 年的时间研究了**5000 亿个可能的跳棋位置，顺便说一句，这仍然只是国际象棋位置数量的极小部分。跳棋工作包括顶级玩家，他们帮助研究团队将跳棋经验法则编程到将移动分类为成功或不成功的软件中。然后研究人员让程序运行，平均每天有 50 台计算机运行。有些日子，该程序在 200 台机器上运行。当研究人员监测进展并相应地调整程序时。事实上，奇努克早在 1994 年就击败了人类赢得了跳棋世界冠军。

是的，你可以解决国际象棋，不，你不会很快。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-11-18T01:34:54.653

这不是关于计算机的问题，而只是关于国际象棋的问题。

问题是，是否存在永不输掉比赛的防故障策略？如果存在这样的策略，那么什么都知道的计算机总是可以使用它，它不再是启发式的。

例如，井字游戏通常基于启发式进行。但是，存在故障安全策略。无论对手怎么走，你总能找到避免输掉比赛的方法，如果你从一开始就做到这一点。

因此，您需要证明这种策略是否也适用于国际象棋。基本上是一样的，只是可能动作的空间要大得多。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-01-03T15:07:37.037

我很晚才来到这个线程，你已经意识到了一些问题。但作为一名前大师和前专业国际象棋程序员，我想我可以添加一些有用的事实和数据。有几种方法可以衡量[国际象棋的复杂性](http://en.wikipedia.org/wiki/Shannon_number)：

*   棋局总数约为 10^(10^50)。这个数字大得难以想象。
*   40步以下的棋局数在10^40左右。这仍然是一个非常大的数字。
*   可能的国际象棋位置数约为 10^46。
*   完整的国际象棋搜索树（香农数）约为 10^123，基于 35 的平均分支因子和 80 的平均游戏长度。
*   作为比较，可观测宇宙中的原子数通常估计为 10^80 左右。
*   6张以下的残局全部[整理并解决](http://en.wikipedia.org/wiki/Tablebase)。

我的结论：虽然国际象棋在理论上是可以解决的，但我们永远不会有钱、动力、计算能力或存储来做这件事。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-11-18T01:40:31.227

事实上，有些游戏已经解决了。Tic-Tac-Toe 是一种非常简单的游戏，可以构建一个总是赢或平的 AI。最近，连接 4 也被解决了（这表明对第二名玩家不公平，因为完美的游戏会导致他输掉）。

然而，国际象棋还没有解决，我认为没有任何证据表明这是一场公平的比赛（即完美的下棋是否会导致平局）。不过，从理论上讲，国际象棋的可能棋子配置数量是有限的。因此，搜索空间是有限的（尽管非常大）。因此，确实存在可以完美运行的确定性图灵机。然而，是否可以建造一个是另一回事。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2010-07-21T18:02:07.270

实际上，在没有良序的无限博弈中，双方玩家都有[可能](https://mathoverflow.net/questions/32174/infinite-games-are-they-well-defined)拥有获胜策略；然而，国际象棋是井然有序的。事实上，由于[50 步规则](http://en.wikipedia.org/wiki/Fifty-move_rule)，一盘棋的步数是有上限的，因此国际象棋的可能棋局只有有限多*（可以枚举出精确解……理论上，至少 ：）*

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-05-28T02:39:30.150

到 2040 年（5x10^20 计算），平均 1000 美元的台式机将能够在 5 秒内解决跳棋。

即使以这种速度，100 台这样的计算机仍然需要大约 6.34 x 10^19*年*才能解决国际象棋。仍然不可行。差远了。

大约在 2080 年，我们的桌面平均每秒将进行大约 10^45 次计算。一台计算机将具有在大约 27.7 小时内解决国际象棋的计算能力。只要计算能力像过去 30 年那样继续增长，它肯定会在 2080 年完成。

到 2090 年，价值 1000 美元的台式机上将有足够的计算能力在大约 1 秒内解决国际象棋……所以到那个时候，这将是微不足道的。

考虑到西洋跳棋是在 2007 年解决的，而在 1 秒内解决它的计算能力将滞后大约 33-35 年，我们大概可以*粗略*估计国际象棋将在 2055-2057 年之间的某个时间解决。自从有了更多的计算能力（这将是 45 年后的情况）之后，可能会更快地投入到诸如此类的项目中。但是，我会说最早是 2050 年，最迟是 2060 年。

在 2060 年，平均需要 100 台台式机 3.17 x 10^10 年才能解决国际象棋。意识到我正在使用 1000 美元的计算机作为我的基准，而更大的系统和超级计算机可能会可用，因为它们的性价比也在提高。此外，它们的计算能力数量级以更快的速度增长。考虑一台超级计算机现在每秒可以执行 2.33 x 10^15 的计算，而一台 1000 美元的计算机大约可以执行 2 x 10^9。相比之下，10 年前的差异是 10^5 而不是 10^6。到 2060 年，数量级差异可能会达到 10^12，甚至可能会比预期的增长更快。

这在很大程度上取决于我们人类是否有解决国际象棋的动力，但计算能力将使其在这个时候变得可行（只要我们的步伐继续下去）。

另一方面，井字游戏非常简单，有 2,653,002 种可能的计算（使用开放式棋盘）。1990 年实现了在大约 2.5 秒（每秒 100 万次计算）内解决井字游戏的计算能力。

向后移动，在 1955 年，一台计算机有能力在大约 1 个月内解决井字游戏（每秒 1 次计算）。同样，这是基于如果您可以将其打包成一台计算机（1000 美元的台式机显然在 1955 年不存在），您将获得 1000 美元的收益，*而*这台计算机将致力于解决井字游戏.... 1955 年的情况并非如此。计算很昂贵，不会用于此目的，尽管我不相信有任何日期井字游戏被计算机视为“解决”，但我确保它落后于实际的计算能力。

此外，考虑到 45 年后 1000 美元的价值将比现在低 4 倍左右，因此可以将更多的钱用于此类项目，而计算能力将继续变得更便宜。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-11-18T01:38:23.010

*现代国际象棋程序现在*的工作方式支持你的论点。他们之所以这样工作，是因为编写一个国际象棋程序来确定性地运行太耗费资源了。他们不一定*总是*那样工作。国际象棋有可能有一天会被[解决](http://en.wikipedia.org/wiki/Perfect_play#Perfect_play)，如果发生这种情况，它很可能会被计算机解决。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-01-16T03:21:56.027

作为 1970 年代的国际象棋程序员，我对此肯定有意见。我大约 10 年前写的，今天仍然基本正确：

[《国际象棋程序员的未完成工作和挑战》](http://www.lkessler.com/brutefor.shtml#bf6)

那时，我认为如果处理得当，我们可以用传统的方式解决国际象棋。

跳棋最近被解决了（耶，加拿大阿尔伯塔大学！！！）但这实际上是蛮力完成的。要按照传统方式下棋，你必须更聪明。

当然，除非[量子计算](http://search.barnesandnoble.com/Shortcut-Through-Time/George-Johnson/e/9780375411939)成为现实。如果是这样，国际象棋将像井字游戏一样轻松解决。

在 1970 年代早期的《科学美国人》中，有一个简短的模仿引起了我的注意。这是一个公告，国际象棋游戏由俄罗斯国际象棋计算机解决。它已经确定了白棋有一个完美的棋步，可以确保双方都完美的打法，这一步棋是：1\. a4！

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-11-18T01:39:54.130

作为记录，有些计算机可以在[跳棋](http://news.cnet.com/8301-10784_3-9747285-7.html)中获胜或打平。我不确定国际象棋是否可以这样做。移动的数量要高得多。此外，事情会发生变化，因为棋子可以向任何方向移动，而不仅仅是向前和向后。我认为虽然我不确定，国际象棋是确定性的，但是对于计算机而言，目前有太多可能的移动方式无法在合理的时间内确定所有移动方式。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-11-18T01:40:19.777

我想你死定了。像 Deep Blue 和 Deep Thought 这样的机器编程了许多预定义的游戏，以及将树解析到这些游戏的末端的聪明算法。当然，这是一种戏剧性的过度简化。在游戏过程中总是有机会“击败”计算机。我的意思是做出一个动作，迫使计算机做出一个不太理想的动作（不管是什么）。如果计算机在移动的时间限制之前无法找到最佳路径，它很可能会通过选择不太理想的路径之一而犯错误。

还有另一类国际象棋程序使用真正的机器学习或遗传编程/进化算法。一些程序已经进化并使用神经网络等来做出决策。在这种情况下，我会想象计算机可能会犯“错误”，但最终还是会取得胜利。

有一本关于这种类型 GP 的引人入胜的书叫做[Blondie24](https://rads.stackoverflow.com/amzn/click/com/1558607838)，你可能会读到。它是关于跳棋的，但它也适用于国际象棋。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-11-18T03:25:48.050

从博弈论来看，这就是这个问题的意义所在，答案是肯定的，国际象棋可以完美下棋。游戏空间是已知/可预测的，是的，如果您拥有孙子的量子计算机，您可能会消除所有启发式方法。

你现在可以用任何脚本语言编写一个完美的井字游戏机，并且它可以完美地实时播放。

奥赛罗是目前电脑可以轻松完美玩的另一款游戏，但机器的内存和CPU需要一点帮助

国际象棋在理论上是可能的，但实际上是不可能的（2008 年）

i-Go 很棘手，它的可能性空间超出了宇宙中原子的数量，因此我们可能需要一些时间才能制造出完美的 i-Go 机器。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2008-11-18T03:45:22.783

国际象棋是矩阵博弈的一个例子，根据定义，它具有最佳结果（想想纳什均衡）。如果玩家 1 和 2 各自采取最佳行动，则总是会达到某个结果（是否是输赢还是未知数）。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2012-02-18T05:58:01.943

这里的很多答案都构成了重要的博弈论点：

1.  国际象棋是一种有限的、确定性的游戏，具有关于游戏状态的完整信息
2.  您可以解决有限游戏并确定完美策略
3.  然而，国际象棋足够大，你将无法用蛮力方法完全解决它

然而，这些观察忽略了一个重要的实际点：**没有必要完美地解决完整的游戏才能创造出无与伦比的机器**。

事实上，您很有可能在不搜索可能状态空间的一小部分的情况下创建一个无与伦比的国际象棋机器（即永远不会输，并且总是会强制获胜或平局）。

例如，以下技术都大大减少了所需的搜索空间：

*   Alpha/Beta 或[MTD-f](http://en.wikipedia.org/wiki/MTD-f)等树修剪技术已经大大减少了搜索空间
*   可证明的获胜位置。许多结局都属于这一类：例如，您无需搜索 KR 与 K，这是一个经过验证的胜利。通过一些工作，可以证明更多有保证的胜利。
*   几乎可以肯定的胜利——因为“足够好”的比赛没有任何愚蠢的错误（比如 ELO 2200+？），许多国际象棋位置几乎是肯定的胜利，例如体面的物质优势（例如额外的骑士）没有补偿位置优势。如果你的程序可以强制这样一个位置，并且有足够好的启发式方法来检测位置优势，它可以安全地假设它会以 100% 的概率获胜或至少平局。
*   树搜索启发式 - 通过足够好的模式识别，您可以快速专注于“有趣”动作的相关子集。这就是人类大师的比赛方式，所以这显然不是一个糟糕的策略......而且我们的模式识别算法不断变得更好
*   [风险评估 - 通过将计算能力集中在结果更不确定的情况（这是静默搜索](http://en.wikipedia.org/wiki/Quiescence_search)的自然扩展），更好地理解职位的“风险”将实现更有效的搜索

通过上述技术的正确组合，我很乐意断言可以创建一个“无与伦比的”国际象棋游戏机。我们可能与当前的技术相差不远。

*请注意，证明*这台机器无法被击败几乎肯定更难。它可能类似于 Reimann 假设——我们很确定它会完美运行，并且经验结果表明它从未输过（包括对自身的数十亿顺子平局），但我们实际上并没有能力证明给我看。

**关于“完美”的附加说明：**

我注意不要将机器描述为博弈论意义上的“完美”，因为这意味着异常强大的附加条件，例如：

*   无论获胜组合多么复杂，在任何可能迫使获胜的情况下始终获胜。在赢/平之间的边界上会有一些情况，这很难完美计算。
*   利用所有关于对手打法中潜在缺陷的可用信息，例如推断对手可能过于贪婪并故意打出比平时稍弱的路线，因为它更有可能诱使对手犯错。对抗不完美的对手，如果你估计你的对手可能不会发现强制获胜，那么实际上*输掉比赛可能是最佳选择，这会让你自己获胜的可能性更高。*

完美（特别是考虑到不完美和未知的对手）是一个*比*简单的无与伦比更难的问题。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2015-05-12T02:00:42.943

这是完全可以解决的。

有 10^50 个奇数位置。据我估计，每个位置至少需要存储 64 个圆形字节（每个正方形有：2 个附属位，3 个片段位）。整理它们后，可以识别将死的位置，并且可以比较位置以形成关系，显示哪些位置导致大型结果树中的其他位置。

然后，如果存在这样的事情，程序只需要找到最低的只有一侧将死根。无论如何，国际象棋在第一段的末尾相当简单地解决了。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-07-21T17:33:48.113

我发现[John MacQuarrie 的这篇文章](http://www-groups.dcs.st-and.ac.uk/~history/Projects/MacQuarrie/Chapters/Ch4.html)引用了“博弈论之父” [Ernst Friedrich Ferdinand Zermelo](http://en.wikipedia.org/wiki/Ernst_Zermelo)的著作。它得出以下结论：

> 在国际象棋中，白方可以强制获胜，或者黑色可以强制获胜，或者双方都可以强制至少平局。

逻辑在我看来是合理的。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-11-18T02:23:36.757

> 如果您搜索 player1/2 移动的所有组合的整个空间，则计算机在每一步中决定的单个移动是基于启发式的。

那里有两个相互竞争的想法。一个是你搜索每一个可能的动作，另一个是你根据启发式做出决定。启发式是一种进行良好猜测的系统。如果你正在搜索每一个可能的动作，那么你就不再猜测了。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-06-06T12:14:09.683

你的思想实验有两个错误：

1.  如果您的图灵机不是“有限的”（在内存、速度等方面），您不需要使用启发式算法，但您可以计算评估最终状态（赢、输、平）。要找到完美的游戏，您只需要使用 Minimax 算法（请参阅[http://en.wikipedia.org/wiki/Minimax](http://en.wikipedia.org/wiki/Minimax)）计算每个玩家的最佳移动，这将导致一个或多个最佳游戏。

2.  使用的启发式算法的复杂性也没有限制。如果您可以计算出完美的游戏，那么还有一种方法可以从中计算出完美的启发式。如果需要，它只是一个以“如果我处于这种情况 S 我最好的移动是 M”的方式映射国际象棋位置的功能。

正如其他人已经指出的那样，这将导致 3 种可能的结果：白色可以强制获胜，黑色可以强制获胜，其中一个可以强制平局。

完美跳棋游戏的结果已经被“计算”出来。如果人类以前不会毁灭自己，那么有一天，当计算机已经进化到足够的内存和速度时，国际象棋也会有计算。或者我们有一些量子计算机……或者直到有人（研究人员、国际象棋专家、天才）找到一些可以显着降低游戏复杂性的算法。举个例子：1到1000之间所有数字的总和是多少？您可以计算 1+2+3+4+5...+999+1000，也可以简单地计算：N*(N+1)/2 with N = 1000; 结果 = 500500。现在想象不知道那个公式，你不知道数学归纳法，你甚至不知道如何乘法或加法，......所以，可能有一种目前未知的算法最终会降低该游戏的复杂性，并且只需 5 分钟即可使用当前计算机计算出最佳移动。也许甚至可以用笔和纸来估计它是一个人，或者甚至在你的脑海中，再给一些时间。

所以，快速的答案是：如果人类存活的时间足够长，那只是时间问题！

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2010-05-06T04:39:09.603

> “国际象棋有完美的算法吗？”

就在这里。也许白棋总是赢。也许黑方总是赢。也许至少双方总是打成平手。我们不知道是哪一个，也永远不会知道，但它肯定存在。

### 也可以看看

*   [上帝的算法](http://en.wikipedia.org/wiki/God%27s_algorithm)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-05-13T02:17:14.500

我知道这有点麻烦，但我必须把我的 5 美分放在这里。计算机或个人有可能以胜利或相持的方式结束他/她/它参与的每一场国际象棋比赛。

然而，为了实现这一点，你必须准确地知道每一个可能的动作和反应等等，一直到每一个可能的游戏结果，并且为了可视化这一点，或者为了简单地分析这些信息，想想它是一个不断扩展的思维导图。

中心节点将是游戏的开始。每个节点的每个分支都象征着一个动作，每个分支都与其兄弟动作不同。在这个庄园里展示它需要很多资源，特别是如果你在纸上做这个。在计算机上，这可能需要数百太字节的数据，因为您将有很多重复动作，除非您让分支回来。

然而，记住这些数据是不可信的，如果不是不可能的话。为了让计算机识别出从（最多）8 个即时可能的移动中取出的最佳移动，这是可能的，但并不合理......因为该计算机需要能够处理该移动之后的所有分支，一直到得出结论，计算所有导致胜利或僵局的结论，然后根据获胜结论的数量对失败的结论采取行动，这将需要能够处理泰字节或更多数据的 RAM！以今天的技术，像这样的计算机需要的不仅仅是世界上 5 位最富有的男人和/或女人的银行余额！

所以经过这么多考虑，它是可以做到的，但是，没有人能做到。这样的任务需要 30 位当今世界上最聪明的头脑，不仅在国际象棋方面，而且在科学和计算机技术方面，而这样的任务只能在（让我们完全从基本角度来看）......超级超级计算机……它不可能存在至少一个世纪。将会完成！只是这辈子没有。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-05-06T04:24:14.880

我只有 99.9% 的人相信状态空间的大小使得不可能有解决方案的希望。

当然，10^50 是一个不可思议的大数字。我们称状态空间的大小为 n。

在最长可能的游戏中，移动次数的界限是多少？由于所有游戏都以有限的步数结束，因此存在这样的界限，称之为 m。

从初始状态开始，你不能枚举 O(m) 空间中的所有 n 个动作吗？当然，这需要 O(n) 时间，但是来自宇宙大小的论点并没有直接解决这个问题。O(m) 空间甚至可能不是很多。对于 O(m) 空间，在此遍历期间，您是否还不能跟踪沿您正在遍历的路径的任何状态的延续是否会导致 EitherMayWin、EitherMayForceDraw、WhiteMayWin、WhiteMayWinOrForceDraw、BlackMayWin 或 BlackMayWinOrForceDraw？（有一个格子取决于轮到谁，用格子相遇来注释遍历历史中的每个状态。）

除非我遗漏了什么，否则这是一个 O(n) 时间 / O(m) 空间算法，用于确定国际象棋属于哪个可能类别。维基百科引用了大约 10^60 次普朗克时间的宇宙年龄估计。在不涉及宇宙学论点的情况下，让我们猜测在宇宙的热/冷/无论如何死亡之前还有那么多时间。这让我们需要每 10^10 次普朗克时间或每 10^-34 秒评估一次移动。这是一个难以置信的短时间（比有史以来观察到的最短时间短约 16 个数量级）。让我们乐观地说，在现有或预见的非量子 P 是 NP 技术的正确子集之上运行一个超级好的实现，我们可以希望评估（采取单步向前，以 100 MHz 的速率（每 10^-8 秒一次）将结果状态分类为中间状态或三个最终状态之一。由于该算法非常可并行化，因此我们需要 10^26 台这样的计算机，或者我体内的每个原子大约需要一台，以及收集它们的结果的能力。

我想对于蛮力解决方案总是有一线希望。我们可能会很幸运，并且在仅探索白方可能的开局走法之一时，都选择了扇出远低于平均水平的走法和白方总是获胜或获胜或平局的走法。

我们也可以希望在某种程度上缩小国际象棋的定义，并让每个人相信它在道德上仍然是相同的游戏。我们真的需要在平局之前要求位置重复3次吗？我们真的需要让逃跑的一方展示50步的逃跑能力吗？*有没有人明白过路*规则到底是怎么回事？;) 更严重的是，我们真的需要强迫玩家移动（而不是平局或失败），而他或她的唯一动作是为了逃避检查或僵局是*路过*的俘虏吗？如果所需的非皇后升级不会导致立即检查或将死，我们是否可以限制可以升级棋子的棋子的选择？

我也不确定允许每台计算机基于哈希访问大型数据库的后期游戏状态及其可能的结果（这在现有硬件和现有的残局数据库上可能相对可行）有助于更早地修剪搜索。显然，如果没有 O(n) 存储，您将无法记住整个函数，但是您可以选择一个大整数并记住从每个可能的（或者甚至不容易证明是不可能的，我想）结束状态向后枚举的许多残局。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-10-09T20:36:59.157

在数学上，国际象棋已经由[Minimax 算法](https://chessprogramming.wikispaces.com/Minimax)解决，该算法可以追溯到 1920 年代（由 Borel 或 von Neumann 发现）。因此，图灵机确实可以下完美的国际象棋。

然而，国际象棋的计算复杂性使其实际上是不可行的。当前的引擎使用了一些改进和启发式方法。今天的顶级引擎在游戏强度方面已经超过了最优秀的人类，但由于他们使用的启发式算法，当给定无限时间时，它们可能无法完美运行（例如，哈希冲突可能导致不正确的结果）。

就完美游戏而言，我们目前最接近的是[残局表库](https://en.wikipedia.org/wiki/Endgame_tablebase)。生成它们的典型技术称为[逆行分析](https://en.wikipedia.org/wiki/Retrograde_analysis)。目前，所有最多六件的位置都已解决。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-11-18T10:03:42.990

只是可能可以解决，但有件事困扰着我：即使可以遍历整棵树，仍然无法预测对手的下一步行动。我们必须始终根据对手的状态采取下一步行动，并做出“最好的”行动。然后，根据下一个状态，我们再做一次。因此，如果对手以某种方式移动，我们的最优移动可能是最优的。对于对手的某些动作，我们的最后一步可能是次优的。

我只是看不到如何在每一步中都有“完美”的举动。

为此，[当前游戏中]的每个状态都必须在树中存在一条通往胜利的路径，无论对手的下一步行动如何（如井字游戏），而且我很难时间想通了。

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2018-04-07T11:08:03.680

**是**的，在数学上，国际象棋被归类为一种确定的游戏，这意味着它对每个第一个玩家都有一个完美的算法，即使对于无限的棋盘，这也被证明是正确的，所以有一天量子人工智能可能会找到完美的策略，游戏结束了

此视频中的更多信息：[https ://www.youtube.com/watch?v=PN-I6u-AxMg](https://www.youtube.com/watch?v=PN-I6u-AxMg)

还有量子国际象棋，没有数学证明它是确定的游戏[http://store.steampowered.com/app/453870/Quantum_Chess/](http://store.steampowered.com/app/453870/Quantum_Chess/)

那里有关于量子国际象棋的详细视频[https://chess24.com/en/read/news/quantum-chess](https://chess24.com/en/read/news/quantum-chess)

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2010-01-24T09:40:22.067

当然，棋盘上只有 50 种可能组合的 10 次方。考虑到这一点，要玩每一个组合，你需要进行 10 次以下的 50 次移动（包括重复将这个数字乘以 3）。因此，国际象棋中一百步的次方不到十。只需选择那些导致将死的人，你就可以走了

* * *

## 回答 #27

> 赞同：-3
> 
> 时间：2011-11-06T22:17:38.037

您只需要 64 位数学（=棋盘）和位运算符（=下一个可能的移动）。如此简单。蛮力通常会找到最好的方法。当然，没有适用于所有位置的通用算法。在现实生活中计算也有时间限制，超时会停止。一个好的国际象棋程序意味着繁重的代码（通过，加倍棋子等）。小代码不能很强大。打开和残局数据库只是节省处理时间，某种预处理数据。设备，我的意思是——操作系统、线程能力、环境、硬件定义要求。编程语言很重要。无论如何，开发过程很有趣。

# java - 如何在 Android 上调用 SOAP Web 服务

> ID：297586
> 
> 赞同：564
> 
> 时间：2008-11-18T01:32:18.450
> 
> 标签：java, android, web-services, soap, wsdl

我很难找到有关如何使用 Android 调用标准 SOAP/WSDL Web 服务的好信息。我所能找到的只是非常复杂的文档和对“kSoap2”的引用，然后是一些关于使用[SAX](http://en.wikipedia.org/wiki/Simple_API_for_XML)手动解析它们的一些信息。好的，那很好，但现在是 2008 年，所以我认为应该有一些好的库来调用标准 Web 服务。

Web 服务基本上是在[NetBeans](http://en.wikipedia.org/wiki/NetBeans)中创建的。我希望 IDE 支持生成管道类。我只需要最简单/最优雅的方式来从基于 Android 的手机联系基于[WSDL的 Web 服务。](http://en.wikipedia.org/wiki/Web_Services_Description_Language)

* * *

## 回答 #1

> 赞同：251
> 
> 时间：2008-11-19T21:50:32.780

Android 不提供任何类型的 SOAP 库。您可以自己编写，也可以使用类似[kSOAP 2](http://ksoap2.sourceforge.net/)的东西。正如您所注意到的，其他人已经能够在他们自己的项目中编译和使用 kSOAP2，但我不必这样做。

迄今为止，Google 对向 Android 添加 SOAP 库表示兴趣不大。我对此的怀疑是，他们宁愿支持 Web 服务的当前趋势，转向基于 REST 的服务，并使用 JSON 作为数据封装格式。或者，使用 XMPP 进行消息传递。但这只是猜测。

目前，基于 XML 的 Web 服务在 Android 上是一项非常重要的任务。不了解 NetBeans，我无法谈论那里可用的工具，但我同意应该提供更好的库。XmlPullParser 有可能使您免于使用 SAX，但我对此知之甚少。

* * *

## 回答 #2

> 赞同：99
> 
> 时间：2009-01-08T22:17:35.247

`org.apache.http.impl.client.DefaultHttpClient`默认情况下包含在 Android SDK 中。这将使您连接到 WSDL。

```
HttpClient httpClient = new DefaultHttpClient();
HttpContext localContext = new BasicHttpContext();
HttpGet httpGet = new HttpGet("http://www.example.com/" + URL);
HttpResponse response = httpClient.execute(httpGet, localContext); 
```

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2009-10-10T10:57:57.990

确实，由于它的开销，SOAP 并不是与移动设备进行数据交换的最佳选择。但是，您可能会发现自己无法控制服务器输出的格式。

所以，如果你必须坚持使用 SOAP，这里有一个为 Android 打补丁的 kSOAP2 库：
[http ://code.google.com/p/ksoap2-android/](http://code.google.com/p/ksoap2-android/)

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2010-02-04T10:55:25.403

要从移动设备（尤其是 Android 手机）调用 Web 服务，我使用了一种非常简单的方法。我没有使用任何 Web 服务客户端 API 来尝试调用 Web 服务。我的方法如下拨打电话。

1.  使用 Java 标准 API 创建一个简单的 HTTP 连接 `HttpURLConnection`。
2.  形成一个 SOAP 请求。（您可以借助 SOAPUI 来发出 SOAP 请求。）
3.  将 doOutPut 标志设置为 true。
4.  设置 HTTP 标头值，例如内容长度、内容类型和用户代理。不要忘记设置 Content-length 值，因为它是强制性的。
5.  将整个 SOAP 请求写入输出流。
6.  调用该方法建立连接并接收响应（在我的情况下，我使用了 `getResonseCode`）。
7.  如果您收到的响应代码为
    200.  这意味着您成功调用了Web服务。
8.  现在在同一个 HTTP 连接上获取一个输入流并接收字符串对象。此字符串对象是一个 SOAP 响应。
9.  如果响应代码不是 200，则`ErrorInput`在同一个 HTTPobject 上获取一个流并接收错误（如果有）。
10.  使用 SAXParser（在我的例子中）或 DOMParaser 或任何其他解析机制解析收到的响应。

我已经为安卓手机实现了这个程序，并且运行成功。即使响应超过 700 KB，我也能够解析它。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2009-01-12T17:04:32.017

SOAP 是一种不适合在 Android（或一般的移动设备）上使用的技术，因为它需要处理/解析开销。REST 服务是一种更轻量级的解决方案，这就是我的建议。Android 带有一个 SAX 解析器，使用起来相当简单。如果您绝对需要在移动设备上处理/解析 SOAP，那么我为您感到抱歉，我能提供的最佳建议就是不要使用 SOAP。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2012-01-29T11:56:00.133

大约一年前，我正在阅读这个线程，试图弄清楚如何在 Android 上进行 SOAP 调用 - 使用 HttpClient 构建我自己的建议导致我为 Android 构建了自己的 SOAP 库：

[冰皂](https://github.com/AlexGilleran/IceSoap)

基本上，它允许您构建信封以通过简单的 Java API 发送，然后自动将它们解析为您通过 XPath 定义的对象......例如：

```
<Dictionary>
    <Id></Id>
    <Name></Name>
</Dictionary> 
```

变成：

```
@XMLObject("//Dictionary")
public class Dictionary {
    @XMLField("Id")
    private String id;

    @XMLField("Name")
    private String name;
} 
```

我将它用于我自己的项目，但我认为它可能对其他人有所帮助，因此我花了一些时间将其分离出来并记录下来。如果你的一些可怜的灵魂在谷歌搜索“SOAP Android”时偶然发现了这个线程，我真的很喜欢它，他们可以试一试并获得一些好处。

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2012-06-07T06:50:43.750

> 不要忘记在您的项目中添加 ksoap2.jar 并在 AndroidManifest 文件中添加 INTERNET 权限

```
import org.ksoap2.SoapEnvelope;
import org.ksoap2.serialization.PropertyInfo;
import org.ksoap2.serialization.SoapObject;
import org.ksoap2.serialization.SoapPrimitive;
import org.ksoap2.serialization.SoapSerializationEnvelope;
import org.ksoap2.transport.HttpTransportSE;
import android.app.Activity;
import android.os.Bundle;
import android.widget.TextView;

public class WebserviceActivity extends Activity {

    private static final String NAMESPACE = "https://api.authorize.net/soap/v1/";
    private static final String URL ="https://apitest.authorize.net/soap/v1/Service.asmx?wsdl"; 
    private static final String SOAP_ACTION = "https://api.authorize.net/soap/v1/AuthenticateTest";
    private static final String METHOD_NAME = "AuthenticateTest";
    private TextView lblResult;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);

        lblResult = (TextView) findViewById(R.id.tv);

        SoapObject request = new SoapObject(NAMESPACE, METHOD_NAME); 
        request.addProperty("name","44vmMAYrhjfhj66fhJN");
        request.addProperty("transactionKey","9MDQ7fghjghjh53H48k7e7n");
        SoapSerializationEnvelope envelope = new SoapSerializationEnvelope(SoapEnvelope.VER11); 
        envelope.setOutputSoapObject(request);
        HttpTransportSE androidHttpTransport = new HttpTransportSE(URL);
        try {
            androidHttpTransport.call(SOAP_ACTION, envelope);

            //SoapPrimitive  resultsRequestSOAP = (SoapPrimitive) envelope.getResponse();
            // SoapPrimitive  resultsRequestSOAP = (SoapPrimitive) envelope.getResponse();
            SoapObject resultsRequestSOAP = (SoapObject) envelope.bodyIn;

            lblResult.setText(resultsRequestSOAP.toString());
            System.out.println("Response::"+resultsRequestSOAP.toString());

        } catch (Exception e) {
            System.out.println("Error"+e);
        }

    }
} 
```

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2009-12-21T16:10:07.703

我与 KSOAP 幽会；我选择了一种更简单的方法。

给定一个 WSDL 文件，为每个请求创建 SOAP 请求模板（例如：使用 SOAP UI），然后替换要在代码中传递的值。使用 DefaultHttpClient 实例将此数据发布到服务端点并获取响应流。使用 XML Pull 解析器解析响应流。

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2010-07-15T08:52:51.770

你可以看看[WSClient++](http://wsclient.neurospeech.com/wsclient/java-android-blackberry/)

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2010-10-19T15:42:44.500

我为 Android 平台创建了一个新的 SOAP 客户端。它使用的是 JAX-WS 生成的接口，但到目前为止它只是一个概念验证。

如果您有兴趣，请尝试该示例和/或在[AndroidSOAP](http://wiki.javaforum.hu/display/ANDROIDSOAP/Home)上观看源代码。

* * *

## 回答 #11

> 赞同：15
> 
> 时间：2009-12-23T15:14:28.677

如果可以，请选择 JSON。Android 自带完整的 org.json 包

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2011-05-18T07:19:21.577

调用**ksoap2**方法。它工作得很好。

设置详细信息，例如

```
private static String mNAMESPACE=null;
private static String mURL=null;
public static Context context=null;
SoapSerializationEnvelope envelope = new SoapSerializationEnvelope(SoapEnvelope.VER11);
envelope.dotNet = true;
envelope.setOutputSoapObject(Request);

envelope.addMapping(mNAMESPACE, "UserCredentials",new UserCredendtials().getClass());
AndroidHttpTransport androidHttpTransport = new AndroidHttpTransport(mURL); 
```

然后得到结果

```
androidHttpTransport.call(SOAP_ACTION, envelope);
result = (SoapPrimitive)envelope.getResponse(); 
```

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2010-04-25T01:06:14.620

我希望*[从 Android 调用网络服务有所](http://www.anddev.org/calling_a_web_service_from_android-t348.html)*帮助。

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2012-05-10T15:53:29.197

几个月前，我在 j2ee 应用程序中使用 jax-ws Web 服务，我们使用[CXF wsdl2java](http://cxf.apache.org/docs/wsdl-to-java.html)从 WSDL 文件生成 WS 客户端存根，并使用这些客户端存根使用 Web 服务。几周前，当我试图在 android 平台上以同样的方式使用 web 服务时，我做不到，因为 android jar 中没有所有的“jax-ws”支持类。那个时候我没有找到任何这样的工具（如果我没有有效地用谷歌搜索的话）来满足我的要求——

*   从 WSDL 获取客户端存根。
*   并使用一些参数（java 业务请求对象）调用服务。
*   获取响应业务对象。

因此，我开发了自己的[Android SOAP 客户端生成工具](http://code.google.com/p/android-ws-client/)。您必须按照以下步骤操作：

*   从 WSDL 获取 WS Client Stub，把它放到你的项目中。
*   说一些服务“ComplexOperationService”，实例化服务，获取端点端口并调用服务方法，并从 Web 服务获取响应：

例如：

```
ComplexOperationService service = new ComplexOperationService( );
ComplexOperation port= service.getComplexOperationPort();    
SomeComplexRequest request = --Get some complex request----;    
SomeComplexResp resp = port.operate( request  ); 
```

*   您不需要关心服务类/请求/响应类或任何其他类和方法，因为您知道它们都是从 WSDL 生成的。
*   当然，您不需要知道肥皂动作/信封/命名空间等。只需像我们开发人员一样调用该方法即可。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2008-11-18T17:49:15.560

我相信您可以使用[Axis](http://en.wikipedia.org/wiki/Apache_Axis)制作一个小 SOAP 客户端。[轴安装说明](http://ws.apache.org/axis/java/install.html)。

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2011-01-28T10:35:53.107

我认为*[从 Android 应用程序调用 SOAP Web 服务](http://www.pjava.wordpress.com)* 会对您有很大帮助。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2011-04-24T10:07:38.610

*[如果您可以使用 JSON，则在使用 PHP 服务器和 Android 手机客户端开发应用程序服务](http://www.embarcadero.com/rad-in-action/php-android)*中有一份白皮书、一个视频和示例代码。

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2012-06-01T09:20:04.970

按照 SOAP 方法执行这些步骤

从 WSDL 文件中，

*   为每个请求创建 SOAP 请求模板。

*   然后替换要在代码中传递的值。

*   使用 DefaultHttpClient 实例将此数据发布到服务端点。

*   获取响应流，最后

*   使用 XML Pull 解析器解析响应流。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2013-11-13T06:54:42.860

对我来说，最简单的方法是使用好的工具来生成所有必需的类。我个人使用这个网站：

[http://easywsdl.com/](http://easywsdl.com/)

它支持相当复杂的 Web 服务并使用 ksoap2。

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2012-05-21T08:20:36.847

如果您在调用 android 中的 Web 服务时遇到问题，那么您可以使用下面的代码来调用 Web 服务并获得响应。确保您的 Web 服务以**数据表格式**返回响应。如果您使用**SQL Server**数据库中的数据，此代码将为您提供帮助。如果您使用**MYSQL**，您需要更改一件事，只需用 DocumentElement 替换 句子中**的**单词**NewDataSet**`obj2=(SoapObject) obj1.getProperty("NewDataSet");`

 **```
void callWebService(){ 

private static final String NAMESPACE = "http://tempuri.org/"; // for wsdl it may be package name i.e http://package_name
private static final String URL = "http://localhost/sample/services/MyService?wsdl";
// you can use IP address instead of localhost
private static final String METHOD_NAME = "Function_Name";
private static final String SOAP_ACTION = "urn:" + METHOD_NAME;

    SoapObject request = new SoapObject(NAMESPACE, METHOD_NAME);
    request.addProperty("parm_name", prm_value);// Parameter for Method
    SoapSerializationEnvelope envelope = new SoapSerializationEnvelope(SoapEnvelope.VER11);
    envelope.dotNet = true;// **If your Webservice in .net otherwise remove it**
    envelope.setOutputSoapObject(request);
    HttpTransportSE androidHttpTransport = new HttpTransportSE(URL);

    try {
        androidHttpTransport.call(SOAP_ACTION, envelope);// call the eb service
                                                                                                         // Method
    } catch (Exception e) {
        e.printStackTrace();
    }

    // Next task is to get Response and format that response
    SoapObject obj, obj1, obj2, obj3;
    obj = (SoapObject) envelope.getResponse();
    obj1 = (SoapObject) obj.getProperty("diffgram");
    obj2 = (SoapObject) obj1.getProperty("NewDataSet");

    for (int i = 0; i < obj2.getPropertyCount(); i++) { 
// the method getPropertyCount() and  return the number of rows
            obj3 = (SoapObject) obj2.getProperty(i);
            obj3.getProperty(0).toString();// value of column 1
            obj3.getProperty(1).toString();// value of column 2
            // like that you will get value from each column
        }
    } 
```

如果您对此有任何问题，可以写信给我。

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2013-05-28T06:58:45.033

我建议查看一个对我有很大帮助的非常有用的工具。负责那个项目的人也非常乐于助人。www.wsdl2code.com/

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2013-07-30T05:33:26.227

这是一个在 android 中使用 SOAP Web 服务的工作示例。

**注意 ::***不要忘记在您的项目中添加 ksoap2.jar 并在 AndroidManifest 文件中添加 INTERNET 权限*

```
public final String WSDL_TARGET_NAMESPACE = "http://tempuri.org/";
public final String METHOD_NAME = "FahrenheitToCelsius";
public final String PROPERTY_NAME = "Fahrenheit";
public final String SOAP_ACTION = "http://tempuri.org/FahrenheitToCelsius";
public final String SOAP_ADDRESS = "http://www.w3schools.com/webservices/tempconvert.asmx";

private class TestAsynk extends AsyncTask<String, Void, String> {

    @Override
    protected void onPostExecute(String result) {

        super.onPostExecute(result);
        Toast.makeText(getApplicationContext(),
                String.format("%.2f", Float.parseFloat(result)),
                Toast.LENGTH_SHORT).show();
    }

    @Override
    protected String doInBackground(String... params) {
        SoapObject request = new SoapObject(WSDL_TARGET_NAMESPACE,
                METHOD_NAME);
        request.addProperty(PROPERTY_NAME, params[0]);

        SoapSerializationEnvelope envelope = new SoapSerializationEnvelope(
                SoapEnvelope.VER11);
        envelope.dotNet = true;

        envelope.setOutputSoapObject(request);

        HttpTransportSE androidHttpTransport = new HttpTransportSE(
                SOAP_ADDRESS);
        Object response = null;
        try {

            androidHttpTransport.call(SOAP_ACTION, envelope);
            response = envelope.getResponse();
            Log.e("Object response", response.toString());

        } catch (Exception e) {
            e.printStackTrace();
        }
        return response.toString();
    }
} 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2015-12-08T13:02:13.783

请下载并使用您的项目添加 SOAP 库文件文件名：**ksoap2-android-assembly-3.4.0-jar-with-dependencies**

清理应用程序，然后启动程序

这是 SOAP 服务调用的代码

```
 String SOAP_ACTION = "YOUR_ACTION_NAME";
    String METHOD_NAME = "YOUR_METHOD_NAME";
    String NAMESPACE = "YOUR_NAME_SPACE";
    String URL = "YOUR_URL";
    SoapPrimitive resultString = null;

    try {
        SoapObject Request = new SoapObject(NAMESPACE, METHOD_NAME);
        addPropertyForSOAP(Request);

        SoapSerializationEnvelope soapEnvelope = new SoapSerializationEnvelope(SoapEnvelope.VER11);
        soapEnvelope.dotNet = true;
        soapEnvelope.setOutputSoapObject(Request);

        HttpTransportSE transport = new HttpTransportSE(URL);

        transport.call(SOAP_ACTION, soapEnvelope);
        resultString = (SoapPrimitive) soapEnvelope.getResponse();

        Log.i("SOAP Result", "Result Celsius: " + resultString);
    } catch (Exception ex) {
        Log.e("SOAP Result", "Error: " + ex.getMessage());
    }
    if(resultString != null) {
        return resultString.toString();
    }
    else{
        return "error";
    } 
```

结果可能是 JSONObject 或 JSONArray 或 String

为了您更好的参考， [https://trinitytuts.com/load-data-from-soap-web-service-in-android-application/](https://trinitytuts.com/load-data-from-soap-web-service-in-android-application/)

谢谢。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2016-08-19T05:42:08.570

您可以使用某些标头通过 http 执行肥皂调用作为 post。我在没有像 ksoap2 这样的额外库的情况下解决了这个问题 这是从肥皂服务获取订单的实时代码

```
private static HashMap<String,String> mHeaders = new HashMap<>();

static {
    mHeaders.put("Accept-Encoding","gzip,deflate");
    mHeaders.put("Content-Type", "application/soap+xml");
    mHeaders.put("Host", "35.15.85.55:8080");
    mHeaders.put("Connection", "Keep-Alive");
    mHeaders.put("User-Agent","AndroidApp");
    mHeaders.put("Authorization","Basic Q2xpZW50NTkzMzppMjR3s2U="); // optional
}public final static InputStream receiveCurrentShipments(String stringUrlShipments)
{
    int status=0;
    String xmlstring= "<soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:ser=\"http://35.15.85.55:8080/ServiceTransfer\">\n" +
            "   <soap:Header/>\n" +
            "   <soap:Body>\n" +
            "      <ser:GetAllOrdersOfShipment>\n" +
            "         <ser:CodeOfBranch></ser:CodeOfBranch>\n" +
            "      </ser:GetAllOrdersOfShipment>\n" +
            "   </soap:Body>\n" +
            "</soap:Envelope>";
    StringBuffer chaine = new StringBuffer("");

    HttpURLConnection connection = null;
    try {
        URL url = new URL(stringUrlShipments);
        connection = (HttpURLConnection) url.openConnection();
        connection.setRequestProperty("Content-Length", xmlstring.getBytes().length + "");
        connection.setRequestProperty("SOAPAction", "http://35.15.85.55:8080/ServiceTransfer/GetAllOrdersOfShipment");

        for(Map.Entry<String, String> entry : mHeaders.entrySet()) {
            String key = entry.getKey();
            String value = entry.getValue();
            connection.setRequestProperty(key,value);

        }

        connection.setRequestMethod("POST");
        connection.setDoInput(true);

        OutputStream outputStream = connection.getOutputStream();
        outputStream.write(xmlstring.getBytes("UTF-8"));
        outputStream.close();

        connection.connect();
        status = connection.getResponseCode();
    } catch (ProtocolException e) {
        e.printStackTrace();
    } catch (MalformedURLException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    } finally {

        Log.i("HTTP Client", "HTTP status code : " + status);
    }

    InputStream inputStream = null;
    try {
        inputStream = connection.getInputStream();
    } catch (IOException e) {
        e.printStackTrace();
    }

    return inputStream;
} 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2012-06-07T00:13:21.810

要从 android 调用 SOAP Web 服务，请尝试使用此客户端

不要忘记在您的 java 构建路径中添加 ksoap2-android.jar

```
public class WsClient {
    private static final String SOAP_ACTION = "somme";
    private static final String OPERATION_NAME = "somme";
    private static final String WSDL_TARGET_NAMESPACE = "http://example.ws";
    private static final String SOAP_ADDRESS = "http://192.168.1.2:8080/axis2/services/Calculatrice?wsdl";

    public String caclculerSomme() {

        String res = null;
        SoapObject request = new SoapObject(WSDL_TARGET_NAMESPACE,
                OPERATION_NAME);
        request.addProperty("a", "5");
        request.addProperty("b", "2");

        SoapSerializationEnvelope envelope = new SoapSerializationEnvelope(
                SoapEnvelope.VER11);
        envelope.dotNet = true;
        envelope.setOutputSoapObject(request);
        HttpTransportSE httpTransport = new HttpTransportSE(SOAP_ADDRESS);

        try {
            httpTransport.call(SOAP_ACTION, envelope);
            String result = envelope.getResponse().toString();
            res = result;
            System.out.println("############# resull is :" + result);
        } catch (Exception exception) {
            System.out.println("########### ERRER" + exception.getMessage());
        }

        return res;
    }
} 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2016-05-30T11:27:41.577

添加肥皂 Libaray( `ksoap2-android-assembly-3.2.0-jar-with-dependencies.jar`):

公共静态字符串 Fn_Confirm_CollectMoney_Approval(

```
 HashMap < String, String > str1,
        HashMap < String, String > str2,
        HashMap < String, String > str3) {

    Object response = null;
    String METHOD_NAME = "CollectMoney";
    String NAMESPACE = "http://xxx/yyy/xxx";
    String URL = "http://www.w3schools.com/webservices/tempconvert.asmx";
    String SOAP_ACTION = "";

    try {

        SoapObject RequestParent = new SoapObject(NAMESPACE, METHOD_NAME);

        SoapObject Request1 = new SoapObject(NAMESPACE, "req");

        PropertyInfo pi = new PropertyInfo();

        Set mapSet1 = (Set) str1.entrySet();

        Iterator mapIterator1 = mapSet1.iterator();

        while (mapIterator1.hasNext()) {

            Map.Entry mapEntry = (Map.Entry) mapIterator1.next();

            String keyValue = (String) mapEntry.getKey();

            String value = (String) mapEntry.getValue();

            pi = new PropertyInfo();

            pi.setNamespace("java:com.xxx");

            pi.setName(keyValue);

            pi.setValue(value);

            Request1.addProperty(pi);
        }

        mapSet1 = (Set) str3.entrySet();

        mapIterator1 = mapSet1.iterator();

        while (mapIterator1.hasNext()) {

            Map.Entry mapEntry = (Map.Entry) mapIterator1.next();

            // getKey Method of HashMap access a key of map
            String keyValue = (String) mapEntry.getKey();

            // getValue method returns corresponding key's value
            String value = (String) mapEntry.getValue();

            pi = new PropertyInfo();

            pi.setNamespace("java:com.xxx");

            pi.setName(keyValue);

            pi.setValue(value);

            Request1.addProperty(pi);
        }

        SoapObject HeaderRequest = new SoapObject(NAMESPACE, "XXX");

        Set mapSet = (Set) str2.entrySet();

        Iterator mapIterator = mapSet.iterator();

        while (mapIterator.hasNext()) {

            Map.Entry mapEntry = (Map.Entry) mapIterator.next();

            // getKey Method of HashMap access a key of map
            String keyValue = (String) mapEntry.getKey();

            // getValue method returns corresponding key's value
            String value = (String) mapEntry.getValue();

            pi = new PropertyInfo();

            pi.setNamespace("java:com.xxx");

            pi.setName(keyValue);

            pi.setValue(value);

            HeaderRequest.addProperty(pi);
        }

        Request1.addSoapObject(HeaderRequest);

        RequestParent.addSoapObject(Request1);

        SoapSerializationEnvelope soapEnvelope = new SoapSerializationEnvelope(
                SoapEnvelope.VER10);

        soapEnvelope.dotNet = false;

        soapEnvelope.setOutputSoapObject(RequestParent);

        HttpTransportSE transport = new HttpTransportSE(URL, 120000);

        transport.debug = true;

        transport.call(SOAP_ACTION, soapEnvelope);

        response = (Object) soapEnvelope.getResponse();

        int cols = ((SoapObject) response).getPropertyCount();

        Object objectResponse = (Object) ((SoapObject) response)
                .getProperty("Resp");

        SoapObject subObject_Resp = (SoapObject) objectResponse;

        modelObject = new ResposeXmlModel();

        String MsgId = subObject_Resp.getProperty("MsgId").toString();

        modelObject.setMsgId(MsgId);

        String OrgId = subObject_Resp.getProperty("OrgId").toString();

        modelObject.setOrgId(OrgId);

        String ResCode = subObject_Resp.getProperty("ResCode").toString();

        modelObject.setResCode(ResCode);

        String ResDesc = subObject_Resp.getProperty("ResDesc").toString();

        modelObject.setResDesc(ResDesc);

        String TimeStamp = subObject_Resp.getProperty("TimeStamp")
                .toString();

        modelObject.setTimestamp(ResDesc);

        return response.toString();

    } catch (Exception ex) {

        ex.printStackTrace();

        return null;
    }

} 
```

# oop - 封装原理

> ID：297589
> 
> 赞同：3
> 
> 时间：2008-11-18T01:34:10.880
> 
> 标签：oop, encapsulation, law-of-demeter

有一些面向对象的工程原则表明“一个类应该只知道它作为参数的类的契约，或者它使用的任何内部契约”。

在 C++ 中，反例是：

```
Foo::bar( Baz* baz)
{
  baz()->blargh()->pants()->soil();  // this is bad, Foo knows about blarghs and pants
} 
```

这个原则有名字吗？此外，很高兴看到实际原理而不是我上面的解释。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T01:42:15.217

[多亏了][[吉姆·伯格](https://stackoverflow.com/users/20164/jim-burger)]，得墨[忒耳定律](http://en.wikipedia.org/wiki/Law_of_Demeter) 说：

> 得墨忒耳定律 (LoD) 或最少知识原则是开发软件，尤其是面向对象程序的设计指南。该准则是 1987 年底在东北大学发明的，可以简明扼要地概括为“只与你的直系朋友交谈”。基本概念是给定对象应尽可能少地假设其他任何事物（包括其子组件）的结构或属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T01:43:13.530

这可能会也可能不会编译（由于 baz 指针后面的括号），但是您的示例至少违反了我能想到的一个原则。它违反了得墨忒耳法则（我相信也称为简约法则）。主要原则可以在这里找到： [SOLID 原则](http://www.lostechies.com/blogs/chad_myers/archive/2008/03/07/pablo-s-topic-of-the-month-march-solid-principles.aspx)

除此之外，我不确定您所描述的内容是否有特定名称。你可以在维基百科上查阅得墨忒耳法则。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T01:51:10.970

看看[Robert Martin 的 SOLID 原则](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)。具体来说，看看[单一职责原则](http://www.objectmentor.com/resources/articles/srp.pdf)。您的示例中复杂的依赖链看起来像是破坏了 SRP。

封装——本身——不是原则。这是实现各种原则的一部分。除了继承、多态性和其他更晦涩的 OO 特性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T09:25:15.497

我想说的是，良好的封装有助于减少[耦合](http://en.wikipedia.org/wiki/Coupling_(computer_science))——这对于任何体面的封装来说都是一个很好的目标，除了显而易见的。

# delphi - 安全（st）方式重命名delphi项目

> ID：297592
> 
> 赞同：18
> 
> 时间：2008-11-18T01:36:26.570
> 
> 标签：delphi, delphi-7

我相信这将是一个简单的项目，但有一个项目是作为测试开始的。
创建时它被保存为“Project2.dpr”

现在测试不再是“测试”，我想将项目名称更改为更有意义的名称。

最好的方法是什么？

仅将文件名和程序行更改为新名称有什么问题吗？IE

有意义的.dpr

```
Program meaningful; 
```

注意：如果重要，请使用 Delphi 7

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-11-18T02:46:50.843

只需从 Delphi 的文件菜单中执行“将项目另存为”，为其命名您想要的名称，然后当您需要时，从您的文件夹中删除 Project2.* 文件，因为它们不再需要了。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-18T08:51:16.660

仅供参考：从 Delphi 8 开始，您只需在项目管理器中右键单击项目并选择“重命名”（或直接按 F2）。与“另存为”方法相比，这具有您最终不会得到副本的好处。

（抱歉，没有 Delphi 7 - 感谢 Lars 的更新）

# sharepoint - 在 SharePoint 中获取用户的 NT-ID

> ID：297609
> 
> 赞同：1
> 
> 时间：2008-11-18T01:46:56.643
> 
> 标签：sharepoint

在 C# 应用程序中获取用户 NT-ID 的最简单方法是什么？我可能只需要一个用户名，或者一个电子邮件地址。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T09:02:33.533

大多数时候，您可以从当前的网络中获取它，例如：

```
string login = SPContext.Current.Web.CurrentUser.LoginName
string mail = SPContext.Current.Web.CurrentUser.Email 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T03:49:13.773

在 SharePoint 中，您可以使用 SPUtility.ResolveWindowsPrincipal 获取用户的 Active Directory 信息（包括显示名称和电子邮件）：

[http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.utilities.sputility.resolvewindowsprincipal.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.utilities.sputility.resolvewindowsprincipal.aspx)

例如：

```
SPPrincipalInfo pi = SPUtility.ResolveWindowsPrincipal(SPContext.Current.Site.WebApplication, "MYDOMAIN\\myusername", SPPrincipalType.All, false); 
```

在 SharePoint 之外，您希望查看 System.DirectoryServices 命名空间。

# asp.net - asp.net 删除未使用的 httpmodules

> ID：297614
> 
> 赞同：5
> 
> 时间：2008-11-18T01:48:13.300
> 
> 标签：asp.net, performance

我正在查看许多页面关于 asp.net 的性能建议。特别是删除未使用的 httpmodules 部分：

```
 <httpModules>
  <add name="OutputCache" type="System.Web.Caching.OutputCacheModule"/>
  <add name="Session" type="System.Web.SessionState.SessionStateModule"/>
  <add name="WindowsAuthentication" type="System.Web.Security.WindowsAuthenticationModule"/>
  <add name="FormsAuthentication" type="System.Web.Security.FormsAuthenticationModule"/>
  <add name="PassportAuthentication" type="System.Web.Security.PassportAuthenticationModule"/>
  <add name="RoleManager" type="System.Web.Security.RoleManagerModule"/>
  <add name="UrlAuthorization" type="System.Web.Security.UrlAuthorizationModule"/>
  <add name="FileAuthorization" type="System.Web.Security.FileAuthorizationModule"/>
  <add name="AnonymousIdentification" type="System.Web.Security.AnonymousIdentificationModule"/>
  <add name="Profile" type="System.Web.Profile.ProfileModule"/>
  <add name="ErrorHandlerModule" type="System.Web.Mobile.ErrorHandlerModule, System.Web.Mobile, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"/>
  <add name="ServiceModel" type="System.ServiceModel.Activation.HttpModule, System.ServiceModel, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
</httpModules> 
```

这里列出了一堆 HTTP 模块，我很肯定并非所有这些模块都被您的应用程序使用。删除未使用的 HTTP 模块肯定会带来轻微的性能提升，因为需要执行的工作会更少。假设在应用程序中不需要 Windows 身份验证。要删除继承的设置，请在 web.config 应用程序的 httpModules 部分下添加一个删除元素并指定不需要的模块的名称。例子：

```
<httpModules>
        <remove name="WindowsAuthentication" />
  </httpModules> 
```

有谁知道在哪里有每个功能的描述，有些很明显但不是全部，我在谷歌上搜索了很长时间。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T02:17:35.427

ScottGu 通过 Mads Kristensen 的博客对此发表评论。

[https://www.madskristensen.net/blog/remove-default-http-modules-in-aspnet/](https://www.madskristensen.net/blog/remove-default-http-modules-in-aspnet/)

> 一般来说，使用这种方法可以获得一些非常小的性能提升——尽管我可能不建议这样做。原因是 ASP.NET 的某些功能（表单身份验证、角色、缓存等）当然会在您删除它们所依赖的模块后停止工作。试图弄清楚为什么会发生这种情况往往会令人困惑。

# c# - 使用控制台应用程序卡在 C# 中的 GenerateConsoleCtrlEvent

> ID：297615
> 
> 赞同：4
> 
> 时间：2008-11-18T01:49:10.770
> 
> 标签：c#, process, console, abort, copy-paste

我正在努力让它发挥作用，希望你们中的一个人以前做过。

我有一个 C# 控制台应用程序，它正在运行一个继承其控制台的子进程。我希望将外部应用程序捕获的 ctrl-c 传递给内部应用程序，以便它有机会很好地关闭。

我有一些非常简单的代码。我启动一个进程，然后使用 WaitForExit(10) 轮询它。我还注册了一个 CancelKeyPress 处理程序，它在触发时将 bool 设置为 true。轮询循环也会检查这一点，当它为真时，它会调用 GenerateConsoleCtrlEvent()（我已通过 pinvoke 映射）。

我已经尝试了很多参数组合到 GenerateConsoleCtrlEvent()。第一个参数为 0 或 1，第二个参数为 0 或子进程的 ID。似乎没有任何效果。有时我得到一个错误的回复并且 Marshal.GetLastWin32Error() 返回 0，有时我得到一个真实的回复。但没有一个会导致子应用程序收到 ctrl-c。

可以肯定的是，我编写了一个测试 C# 应用程序作为子应用程序，它打印出它发生了什么，并验证了在它运行时手动键入 ctrl-c 确实会导致它退出。

几个小时以来，我一直在努力解决这个问题。谁能给我一些关于该去哪里的指示？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T02:04:04.283

不太确定这是一个好方法。这仅适用于使用 CREATE_NEW_PROCESS_GROUP 标志创建的子进程`CreateProcess()`。但是 System.Diagnostics.Process 类不支持这一点。

考虑使用 Main() 方法的返回值。Windows SDK 中已经为 Ctrl+C 中止定义了一个唯一值，即 STATUS_CONTROL_C_EXIT 或 0xC000013A。父进程可以从`Process.ExitCode`属性中获取该返回码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-26T10:37:20.833

你有这个运气吗？我的理解是，当您在控制台中按 CTRL+C 时，默认情况下，连接到控制台的所有进程都会收到它，而不仅仅是父进程。这是一个例子：

儿童.cs：

```
using System;

public class MyClass
{
    public static void CtrlCHandler(object sender, ConsoleCancelEventArgs args)
    {
        Console.WriteLine("Child killed by CTRL+C.");
    }
    public static void Main()
    {
        Console.WriteLine("Child start.");
        Console.CancelKeyPress += CtrlCHandler;
        System.Threading.Thread.Sleep(4000);
        Console.WriteLine("Child finish.");
    }
} 
```

父.cs：

```
using System;

public class MyClass
{
    public static void CtrlCHandler(object sender, ConsoleCancelEventArgs args)
    {
        Console.WriteLine("Parent killed by CTRL+C.");
    }
    public static void Main()
    {
        Console.CancelKeyPress += CtrlCHandler;
        Console.WriteLine("Parent start.");
        System.Diagnostics.Process child = new System.Diagnostics.Process();
        child.StartInfo.UseShellExecute = false;
        child.StartInfo.FileName = "child.exe";
        child.Start();
        child.WaitForExit();
        Console.WriteLine("Parent finish.");
    }
} 
```

输出：

```
Y:\>parent
Parent start.
Child start.
Parent killed by CTRL+C.
Child killed by CTRL+C.
^C
Y:\>parent
Parent start.
Child start.
Child finish.
Parent finish. 
```

所以我不会认为你需要做任何特别的事情。但是，如果您真的需要自己生成 CTRL+C 事件，事情可能就没有那么容易了。我不确定您描述的问题，但据我所知，您只能将 CTRL+C 事件发送到附加到控制台窗口的*所有进程。*如果分离进程，则无法向其发送 CTRL+C 事件。如果您想选择在哪些进程中发送 CTRL+C 事件，您似乎需要为每个进程创建新的控制台窗口。我不知道是否有某种方法可以在没有可见窗口的情况下执行此操作，或者当您想使用管道重定向 I/O 时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-05-12T22:55:25.773

这是我将 ctrl-c 发送到进程的解决方案。仅供参考，我从来没有`GenerateConsoleCtrlEvent`工作过。

不是使用 GenerateConsoleCtrlEvent，而是我发现将 CTRL-C 发送到进程的方法。仅供参考，在这种情况下，我不需要找到组进程 ID。

```
using System;
using System.Diagnostics;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

public class ConsoleAppManager
{
    private readonly string appName;
    private readonly Process process = new Process();
    private readonly object theLock = new object();
    private SynchronizationContext context;
    private string pendingWriteData;

    public ConsoleAppManager(string appName)
    {
        this.appName = appName;

        this.process.StartInfo.FileName = this.appName;
        this.process.StartInfo.RedirectStandardError = true;
        this.process.StartInfo.StandardErrorEncoding = Encoding.UTF8;

        this.process.StartInfo.RedirectStandardInput = true;
        this.process.StartInfo.RedirectStandardOutput = true;
        this.process.EnableRaisingEvents = true;
        this.process.StartInfo.CreateNoWindow = true;

        this.process.StartInfo.UseShellExecute = false;

        this.process.StartInfo.StandardOutputEncoding = Encoding.UTF8;

        this.process.Exited += this.ProcessOnExited;
    }

    public event EventHandler<string> ErrorTextReceived;
    public event EventHandler ProcessExited;
    public event EventHandler<string> StandartTextReceived;

    public int ExitCode
    {
        get { return this.process.ExitCode; }
    }

    public bool Running
    {
        get; private set;
    }

    public void ExecuteAsync(params string[] args)
    {
        if (this.Running)
        {
            throw new InvalidOperationException(
                "Process is still Running. Please wait for the process to complete.");
        }

        string arguments = string.Join(" ", args);

        this.process.StartInfo.Arguments = arguments;

        this.context = SynchronizationContext.Current;

        this.process.Start();
        this.Running = true;

        new Task(this.ReadOutputAsync).Start();
        new Task(this.WriteInputTask).Start();
        new Task(this.ReadOutputErrorAsync).Start();
    }

    public void Write(string data)
    {
        if (data == null)
        {
            return;
        }

        lock (this.theLock)
        {
            this.pendingWriteData = data;
        }
    }

    public void WriteLine(string data)
    {
        this.Write(data + Environment.NewLine);
    }

    protected virtual void OnErrorTextReceived(string e)
    {
        EventHandler<string> handler = this.ErrorTextReceived;

        if (handler != null)
        {
            if (this.context != null)
            {
                this.context.Post(delegate { handler(this, e); }, null);
            }
            else
            {
                handler(this, e);
            }
        }
    }

    protected virtual void OnProcessExited()
    {
        EventHandler handler = this.ProcessExited;
        if (handler != null)
        {
            handler(this, EventArgs.Empty);
        }
    }

    protected virtual void OnStandartTextReceived(string e)
    {
        EventHandler<string> handler = this.StandartTextReceived;

        if (handler != null)
        {
            if (this.context != null)
            {
                this.context.Post(delegate { handler(this, e); }, null);
            }
            else
            {
                handler(this, e);
            }
        }
    }

    private void ProcessOnExited(object sender, EventArgs eventArgs)
    {
        this.OnProcessExited();
    }

    private async void ReadOutputAsync()
    {
        var standart = new StringBuilder();
        var buff = new char[1024];
        int length;

        while (this.process.HasExited == false)
        {
            standart.Clear();

            length = await this.process.StandardOutput.ReadAsync(buff, 0, buff.Length);
            standart.Append(buff.SubArray(0, length));
            this.OnStandartTextReceived(standart.ToString());
            Thread.Sleep(1);
        }

        this.Running = false;
    }

    private async void ReadOutputErrorAsync()
    {
        var sb = new StringBuilder();

        do
        {
            sb.Clear();
            var buff = new char[1024];
            int length = await this.process.StandardError.ReadAsync(buff, 0, buff.Length);
            sb.Append(buff.SubArray(0, length));
            this.OnErrorTextReceived(sb.ToString());
            Thread.Sleep(1);
        }
        while (this.process.HasExited == false);
    }

    private async void WriteInputTask()
    {
        while (this.process.HasExited == false)
        {
            Thread.Sleep(1);

            if (this.pendingWriteData != null)
            {
                await this.process.StandardInput.WriteLineAsync(this.pendingWriteData);
                await this.process.StandardInput.FlushAsync();

                lock (this.theLock)
                {
                    this.pendingWriteData = null;
                }
            }
        }
    }
} 
```

然后，在我的主应用程序中实际运行进程并发送 CTRL-C：

```
 DateTime maxStartDateTime = //... some date time;
            DateTime maxEndDateTime = //... some later date time
            var duration = maxEndDateTime.Subtract(maxStartDateTime);
            ConsoleAppManager appManager = new ConsoleAppManager("myapp.exe");
            string[] args = new string[] { "args here" };
            appManager.ExecuteAsync(args);
            await Task.Delay(Convert.ToInt32(duration.TotalSeconds * 1000) + 20000);

            if (appManager.Running)
            {
                // If stilll running, send CTRL-C
                appManager.Write("\x3");
            } 
```

详情请参见[重定向控制台应用程序的标准输入](https://stackoverflow.com/questions/21848271/redirecting-standard-input-of-console-application?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa)和[Windows如何获取已经在运行的进程的进程组？](https://stackoverflow.com/questions/30249101/windows-how-to-get-the-process-group-of-a-process-that-is-already-running/50311226#50311226)

# .net - 通过 DLR 托管 VBx 语言？

> ID：297624
> 
> 赞同：0
> 
> 时间：2008-11-18T01:53:17.020
> 
> 标签：.net, dynamic-language-runtime, vbx

有各种示例可用于在您自己的 AppDomain 中托管在 DLR 上运行的 Python 或 Ruby。

你能用VB做到这一点吗？自从 18 个月前宣布 DLR 以来，已经有人提到了这一点，但我找不到它的代码示例。

也许使用 PDC VS10 CTP？如果是这样，哪个程序集包含适当的 VBx 子类化 ScriptRuntime？

如果这还不可能，任何 MSFT 可以向我们提供有关何时我们可能会看到一些位的更新信息吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T02:17:12.743

没有可通过 DLR 托管 API 托管的 VB（或 C#）版本。一般来说，DLR 托管 API，以及获得更多 MS 创建的语言来支持它们的可能性，暂时被认为是后 Dev10。所以短期内不会出现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-24T02:04:02.393

正式地，在 VS10 发布之前没有支持的动态语言。届时，将发布显然将构建在 DLR 之上的 VBx，可能与 DLR 的 2.0 版一起发布。（版本 1.0 的发布是内在的。）

您可能会在 VS10 CTP 中找到一些有用的东西，但请记住，它既不受支持，也没有太多的文档可供参考。如果你一心想在你的应用程序中托管 VB，在 DLR 上，你只需要等待一年零一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-26T14:45:00.890

看起来 VBx 项目已经死了。多年来，微软一直没有消息。

# browser - mac浏览器不是PC浏览器上的文件上传错误

> ID：297636
> 
> 赞同：2
> 
> 时间：2008-11-18T02:03:42.083
> 
> 标签：browser

```
System.Runtime.InteropServices.ExternalException: A generic error occurred in GDI+. at
System.Drawing.Image.Save(String filename, ImageCodecInfo encoder, EncoderParameters encoderParams) at
System.Drawing.Image.Save(String filename, ImageFormat format) at
System.Drawing.Image.Save(String filename) at
Content.btnAddImage_Click(Object sender, EventArgs e) in
d:\inetpub\vhosts\rhinoreview.com\httpdocs\Content.ascx.cs:line 543 
```

此过程在 PC 上的任何浏览器上都可以完美运行，但在 mac osx 上的任何浏览器上都无法正常运行。这个有点失落......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T06:20:09.553

吹毛求疵：它看起来更像是下载问题（从服务器到客户端）而不是上传问题（客户端将文件发送到服务器）。

更吹毛求疵：对我来说，PC 就是个人电脑。因此，运行 Mac OS 或 Linux 或 BSD 或 BeOS 的计算只是 PC。我猜你的意思是运行 Windows 的 PC。

大胆猜测，为这条消息添加一些价值：您是否将正确的标题与图像一起发送？
很难从您提供的少量信息中进行调试（没有代码，标签中没有语言指示（可能是 C#）等）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T05:40:17.917

疯狂的猜测，但它可能与文件扩展名有关（似乎 GDI+ 在尝试将上传的图像转换为它可以理解的东西时失败了）。我认为 Mac OS X 不需要它们。您要上传没有文件扩展名的图像吗？

# asp.net - 如何在我的 ASP.NET 站点中使用摘要授权？

> ID：297645
> 
> 赞同：-1
> 
> 时间：2008-11-18T02:08:29.233
> 
> 标签：asp.net, digest-authorisation

我希望需要一个弹出窗口供用户键入，以访问我的网站。对于用户名，密码..我希望在某个文件中有一些硬编码的名称/密码。我被告知可以使用摘要授权来执行此操作。

如果我有一个标准的 ASP.NET 网站，我在哪里可以定义用户名/密码？

请注意，此用户名/密码仅“解锁”该站点.. 但不会将它们登录到该站点。他们将需要他们的网站用户名/密码。

我希望这是有道理的。

请帮忙！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T02:18:56.437

根据您对机器的访问，一个非常简单的选项是一个名为 IISPassword 的程序，一些提供商已经安装了这个程序，它允许您使用 apache 样式的 .htaccess .htpassword 文件。

安装完成后，设置大约需要 5 分钟，只需找到一个 unix crypt 函数来处理密码，它就可以工作，根本不需要接触 aspnet。

仅在 IIS 5 和 6 上使用过此功能，但可能适用于 7。

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T02:25:26.610

我认为您的用户不会喜欢输入两个密码才能使用您的网站。我认为您最好坚持使用网站登录作为访问该网站的唯一方式，并将未登录的用户简单地重定向到登录页面。如果您的网站是公开的，您可能还需要一个可供潜在未来用户公开使用的“关于我们”页面。

[您可以在此处](http://msdn.microsoft.com/en-us/library/ms978378.aspx)找到关于 ASP.NET 中的身份验证的非常全面的指南。根据文章，摘要式身份验证要求您将用户 ID/密码存储在 Active Directory 中。

# .net - 使用 C# 应用程序配置 SQL 2008 数据库

> ID：297652
> 
> 赞同：0
> 
> 时间：2008-11-18T02:12:43.453
> 
> 标签：.net, sql-server

我有一个基于 .Net 3.5 / SQL 2008 为我的公司开发的内部企业应用程序。

我有两种类型的数据库。主系统数据库包含我们所有的全球数据，例如用户名和客户等。项目数据库包含与我们客户项目有关的实际数据。

当系统为客户创建新项目时，它需要使用提供表、视图、sps 等的自定义模式来配置新的 SQL 数据库。项目数据库的名称对应于存储在系统数据库。所以一个新项目将创建一个新的项目数据库，名称为：Project_XXX，其中 XXX 是项目 ID。

我的问题是以编程方式配置自定义数据库的最佳方式是什么？现在我能想到的唯一方法是有一个类，它从文件系统读取 SQL 脚本并进行解析以替换数据库名称的项目 ID。这很容易，但似乎相当不雅。

那里的一些退伍军人更喜欢这种方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T02:24:14.273

通常，如果只有一个（或少数）数据库，并且您可以直接控制它们（典型的公司环境），我建议不要自动升级数据库，因为它比它的价值更麻烦。只需将脚本传递给进行安装的人员即可。

对于过去更广泛的版本，我使用了您建议的脚本以及[SQL Server SMO](http://msdn.microsoft.com/en-us/library/ms162169.aspx)库 (Server.CurrentContext.ExecuteNonQuery())。我不觉得它不优雅，因为它很简单而且很有效。

对于第一个版本，我们将包含一个完整的数据库构建脚本，然后为每个后续版本添加一个升级脚本。因此，如果有人在 v1.1 上安装 v1.2，我们将只运行 v1.2 脚本。但是，如果他们进行全新安装，我们将运行 v1.0、v1.1 和 v1.2。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T02:46:58.393

我认为最好的方法是在您的源代码控制服务器上维护此脚本；毕竟，它是您的系统基础架构的很大一部分的源代码，并且会像其他任何东西一样从适当的代码维护、测试等中受益。然后从那里安装。

如果您对这种架构有任何疑虑，我会假设您对每个项目的单独数据库有更多的不确定性。我称其为 Big Denorm；我已经在许多情况下多次看到它，但我还没有看到它的结果很好。我什至会提名它作为反模式考虑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T03:49:38.143

由于您使用的是 .NET 3.5，您可能需要考虑使用 LINQ。LINQ 能够使用您创建的映射文件或强类型 DBML 文件动态创建数据库（[指向 howto 的链接）。](http://msdn.microsoft.com/en-us/library/bb399420.aspx)我相信它可以在多个地方创建适当的表格。这可能适用于简单的数据库。

但是，如果您在非主键上有函数或存储过程和/或索引，我看不出它是如何工作的。映射文件可能能够跟踪这些，但我从未使用过，所以我持怀疑态度。可能@doofledorfer 关于使用 SQL 脚本在新数据库中重新创建数据库结构的想法是可行的方法。无论如何，我通常将这些脚本保存在我的源代码控制中。

如果您还没有这样做，您可能需要研究用于管理更新的工具。大概您需要在您的代码/数据库更改时在现有项目中滚动任何数据库更改。我们使用[Red Gate](http://www.red-gate.com) SQL 工具取得了不错的效果。

# c - 什么是__stdcall？

> ID：297654
> 
> 赞同：165
> 
> 时间：2008-11-18T02:15:39.440
> 
> 标签：c, winapi, calling-convention, stdcall

我正在学习 Win32 编程，`WinMain`原型如下：

```
int WINAPI WinMain ( HINSTANCE instance, HINSTANCE prev_instance, PSTR cmd_line, int cmd_show ) 
```

我对这个`WINAPI`标识符的用途感到困惑并发现：

```
#define WINAPI      __stdcall 
```

这是做什么的？我对在返回类型之后有什么东西感到困惑。是`__stdcall`为了什么？当返回类型和函数名之间存在某些东西时，这意味着什么？

* * *

## 回答 #1

> 赞同：195
> 
> 时间：2008-11-18T02:18:06.080

`__stdcall`是用于函数的调用约定。这告诉编译器适用于设置堆栈、推送参数和获取返回值的规则。

还有许多其他的调用约定，,`__cdecl`和奇妙的命名。 是 Win32 系统调用的标准调用约定。`__thiscall``__fastcall``__declspec(naked)``__stdcall`

维基百科涵盖了[细节](http://en.wikipedia.org/wiki/X86_calling_conventions)。

当您在代码之外调用函数（例如，操作系统 API）或操作系统正在调用您（如 WinMain 的情况）时，这主要是重要的。如果编译器不知道正确的调用约定，那么您可能会遇到非常奇怪的崩溃，因为堆栈将无法正确管理。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-11-18T02:20:26.760

C 或 C++ 本身不定义这些标识符。它们是编译器扩展，代表某些调用约定。这决定了将参数放在哪里，以什么顺序，被调用函数将在哪里找到返回地址，等等。例如，__fastcall 意味着函数的参数通过寄存器传递。

维基[百科文章](http://en.wikipedia.org/wiki/X86_calling_conventions)概述了那里发现的不同调用约定。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-11-18T02:24:57.313

到目前为止的答案已经涵盖了细节，但是如果你不打算下拉到汇编，那么你所需要知道的是调用者和被调用者都必须使用相同的调用约定，否则你会得到错误很难找到。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-11-18T02:31:24.900

我同意到目前为止所有的答案都是正确的，但这就是原因。Microsoft 的 C 和 C++ 编译器为应用程序的 C 和 C++ 函数中的（预期）函数调用速度提供了各种调用约定。在每种情况下，调用者和被调用者必须就使用哪种调用约定达成一致。现在，Windows 本身提供了函数（API），而且这些函数已经编译好了，所以当你调用它们时，你必须遵守它们。对 Windows API 的任何调用以及来自 Windows API 的回调都必须使用 __stdcall 约定。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-06-30T15:02:01.800

看一下：

[http://www.codeproject.com/KB/cpp/calling_conventions_demystified.aspx](http://www.codeproject.com/KB/cpp/calling_conventions_demystified.aspx)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-18T02:19:05.593

它与函数的调用方式有关——基本上是事物放入堆栈的顺序以及谁负责清理。

这是文档，但除非您了解第一部分，否则意义不大：http:
[//msdn.microsoft.com/en-us/library/zxk0tw93.aspx](http://msdn.microsoft.com/en-us/library/zxk0tw93.aspx)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-17T04:03:38.473

__stdcall 用于将函数参数放入堆栈。函数完成后，它会自动释放内存。这用于固定参数。

```
void __stdcall fnname ( int, int* )
{
    ...
}

int main()
{
    CreateThread ( NULL, 0, fnname, int, int*...... )
} 
```

这里**fnname**有 args 它直接推入堆栈。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-05-23T03:13:35.253

直到今天，我以前从未使用过这个。这是因为在我的代码中我使用的是多线程，而我使用的多线程 API 是 windows 之一（_beginthreadex）。

要启动线程：

```
_beginthreadex(NULL, 0, ExecuteCommand, currCommand, 0, 0); 
```

ExecuteCommand 函数**必须**在方法签名中使用 __stdcall 关键字，以便 beginthreadex 调用它：

```
unsigned int __stdcall Scene::ExecuteCommand(void* command)
{
    return system(static_cast<char*>(command));
} 
```

# f# - F# 语法错误

> ID：297656
> 
> 赞同：0
> 
> 时间：2008-11-18T02:16:34.227
> 
> 标签：f#, syntax-error, function-calls

我遇到语法错误。我想讨论一个返回浮点数的函数。

我*认为*这会给我正确的答案

```
let cyclesPerInterrupt bps bpw cpu factor = 
 floor (fudge (float(factor) cyclesPerWord cpu wordsPerSec bps bpw)) 
```

但事实并非如此。我已经尝试了所有我能想到的东西，但对我来说还是没用。我知道这很愚蠢，但我想不出来。

作为参考，fudge 采用浮点数和整数，cyclesPerWord 采用 2 个整数，wordsPerSec 采用 2 个整数。Floor 接受一个泛型并返回一个浮点数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T03:08:35.730

另请注意，您可以使用括号以您最初尝试的方式嵌套函数调用，例如

```
...(cyclesPerWord cpu (wordsPerSec bps bpw)) 
```

（如果没有上面的一组内部括号，这有点像您试图将 4 个参数传递给 CyclesPerWord，这不是您想要的。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T11:49:56.207

或者，为了避免盲目和括号瘫痪，请使用一些流水线 |> ：

```
let fudge (a : float) (b : int) =
    a

let cyclesPerWord (a : int) (b : int) =
    a

let wordsPerSec (a : int) (b : int) =
    a

let cyclesPerInterrupt bps bpw cpu factor =
    wordsPerSec bps bpw
    |> cyclesPerWord cpu
    |> fudge factor
    |> floor 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T14:16:21.533

查看您的函数定义，您似乎正在使用类似 C# 的语法来调用您的函数，函数名存在于 () 之前，并且该函数的相关参数位于 () 内。一个例子是 FunctionName(Parameter1 Parameter2)。F# 不使用那种风格。相反，它使用函数名称和相关参数存在于 () 中的样式。这方面的一个例子是 (FunctionName Parameter1 Parameter2)。

表达代码的正确方法是

```
 let cyclesPerInterrupt bps bpw cpu factor = 
    (floor (fudge (float factor) (cyclesPerWord cpu (wordsPerSec bps bpw) ) ) ) 
```

虽然最外面的 ( ) 并不是真正必要的。

# oracle - SELECT COUNT(*) 与使用显式游标获取两次

> ID：297671
> 
> 赞同：11
> 
> 时间：2008-11-18T02:22:34.107
> 
> 标签：oracle, plsql, database-cursor

我读过 Steven Feuerstein 和 Bill Pribyl 的书，书名是“Oracle PL SQL Programming”（第 2 版）。在第 99 页，有一点建议是

**不要从表中“SELECT COUNT(*)”，除非您确实需要知道“命中”的总数。如果您只需要知道是否有多个匹配项，只需使用显式游标获取两次即可。**

您可以通过提供示例向我进一步解释这一点吗？谢谢你。

### 更新：

正如 Steven Feuerstein 和 Bill Pribyl 建议我们不要使用 SELECT COUNT() 来检查表中的记录是否存在，任何人都可以帮我编辑下面的代码以避免使用显式游标来使用 SELECT COUNT(*) 吗？此代码是在 Oracle 存储过程中编写的。

我有一个表 emp(emp_id, emp_name, ...)，所以要检查提供的员工 ID 是否正确：

```
CREATE OR REPLACE PROCEDURE do_sth ( emp_id_in IN emp.emp_id%TYPE )
IS
v_rows INTEGER;
BEGIN
    ...

    SELECT COUNT(*) INTO v_rows
    FROM emp
    WHERE emp_id = emp_id_in;

    IF v_rows > 0 THEN
        /* do sth */
    END;

    /* more statements */
    ...

END do_sth; 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-18T10:28:41.627

开发人员可能会从 PL/SQL 程序中的表中执行 select COUNT(*) 的原因有很多：

# 1）他们真的需要知道表中有多少行。

在这种情况下，别无选择：选择 COUNT(*) 并等待结果。这在许多桌子上会很快，但在一张大桌子上可能需要一段时间。

# 2）他们只需要知道一行是否存在。

这并不保证计算表中的所有行。许多技术是可能的：

## a) 显式游标方法：

```
DECLARE
   CURSOR c IS SELECT '1' dummy FROM mytable WHERE ...;
   v VARCHAR2(1);
BEGIN
   OPEN c;
   FETCH c INTO v;
   IF c%FOUND THEN
      -- A row exists
      ...
   ELSE
      -- No row exists
      ...
   END IF;
END; 
```

## b) SELECT INTO 方法

```
DECLARE
   v VARCHAR2(1);
BEGIN
   SELECT '1' INTO v FROM mytable 
   WHERE ... 
   AND ROWNUM=1; -- Stop fetching if 1 found
   -- At least one row exists
EXCEPTION
   WHEN NO_DATA_FOUND THEN
      -- No row exists
END; 
```

## c) 使用 ROWNUM 方法选择 COUNT(*)

```
DECLARE
   cnt INTEGER;
BEGIN
   SELECT COUNT(*) INTO cnt FROM mytable 
   WHERE ... 
   AND ROWNUM=1; -- Stop counting if 1 found
   IF cnt = 0 THEN
      -- No row found
   ELSE
      -- Row found
   END IF;
END; 
```

# 3）他们需要知道是否存在超过 1 行。

(2) 工作技术的变化：

## a) 显式游标方法：

```
DECLARE
   CURSOR c IS SELECT '1' dummy FROM mytable WHERE ...;
   v VARCHAR2(1);
BEGIN
   OPEN c;
   FETCH c INTO v;
   FETCH c INTO v;
   IF c%FOUND THEN
      -- 2 or more rows exists
      ...
   ELSE
      -- 1 or 0 rows exist
      ...
   END IF;
END; 
```

## b) SELECT INTO 方法

```
DECLARE
   v VARCHAR2(1);
BEGIN
   SELECT '1' INTO v FROM mytable 
   WHERE ... ;
   -- Exactly 1 row exists
EXCEPTION
   WHEN NO_DATA_FOUND THEN
      -- No row exists
   WHEN TOO_MANY_ROWS THEN
      -- More than 1 row exists
END; 
```

## c) 使用 ROWNUM 方法选择 COUNT(*)

```
DECLARE
   cnt INTEGER;
BEGIN
   SELECT COUNT(*) INTO cnt FROM mytable 
   WHERE ... 
   AND ROWNUM <= 2; -- Stop counting if 2 found
   IF cnt = 0 THEN
      -- No row found
   IF cnt = 1 THEN
      -- 1 row found
   ELSE
      -- More than 1 row found
   END IF;
END; 
```

您使用哪种方法很大程度上取决于偏好（以及一些宗教狂热！） Steven Feuerstein 一直更喜欢显式游标而不是隐式游标（SELECT INTO 和游标 FOR 循环）；Tom Kyte 喜欢隐式游标（我同意他的观点）。

重要的一点是在不限制 ROWCOUNT 的情况下选择 COUNT(*) 是昂贵的，因此只有在真正需要计数时才应该这样做。

至于您关于如何使用显式游标重写此内容的补充问题：

```
CREATE OR REPLACE PROCEDURE do_sth ( emp_id_in IN emp.emp_id%TYPE )
IS
v_rows INTEGER;
BEGIN
    ...

    SELECT COUNT(*) INTO v_rows
    FROM emp
    WHERE emp_id = emp_id_in;

    IF v_rows > 0 THEN
        /* do sth */
    END;

    /* more statements */
    ...

END do_sth; 
```

那将是：

```
CREATE OR REPLACE PROCEDURE do_sth ( emp_id_in IN emp.emp_id%TYPE )
IS
    CURSOR c IS SELECT 1
                FROM emp
                WHERE emp_id = emp_id_in;
    v_dummy INTEGER;
BEGIN
    ...

    OPEN c;    
    FETCH c INTO v_dummy;
    IF c%FOUND > 0 THEN
        /* do sth */
    END;
    CLOSE c;

    /* more statements */
    ...

END do_sth; 
```

但实际上，在您的示例中，这并没有好坏之分，因为您正在选择主键，而 Oracle 足够聪明，知道它只需要获取一次。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T03:52:30.053

如果您只对两个感兴趣，请尝试

```
SELECT 'THERE ARE AT LEAST TWO ROWS IN THE TABLE'
FROM DUAL
WHERE 2 =
(
    SELECT COUNT(*)
    FROM TABLE
    WHERE ROWNUM < 3
) 
```

与手动游标方法相比，它需要的代码更少，而且可能更快。

rownum 技巧意味着一旦有两个行就停止获取行。

如果您不对计数（*）设置某种限制，则可能需要很长时间才能完成，具体取决于您拥有的行数。在这种情况下，使用游标循环手动从表中读取 2 行会更快。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-18T03:13:12.177

这来自编写类似于以下代码的程序员（这是伪代码！）。

您想检查客户是否有多个订单：

```
if ((select count(*) from orders where customerid = :customerid) > 1)
{
    ....
} 
```

这是一种非常低效的做事方式。正如[马克布雷迪](https://stackoverflow.com/users/21397/mark-brady)所说，如果你想知道一个罐子里是否有便士，你会数出罐子里所有的便士，还是只确定有 1 个（在你的例子中是 2 个）？

这可以更好地写成：

```
if ((select 1 from (select 1 from orders where customerid = :customerid) where rownum = 2) == 1)
{
    ....
} 
```

这可以防止“计算所有硬币”的困境，因为 Oracle 将获取 2 行，然后完成。前面的示例将导致 oracle 扫描（索引或表）所有行，然后完成。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T02:36:28.507

他的意思是打开一个游标，不仅获取第一条记录，还获取第二条记录，然后你就会知道有不止一个。

因为我似乎从来不需要知道`SELECT COUNT(*)`is `>= 2`，所以我不知道为什么这在任何 SQL 变体中都是一个有用的习惯用法。要么没有记录，要么至少有一个，当然，但不是两个或更多。无论如何，总会有`EXISTS`。

那，以及 Oracle 的优化器似乎很差的事实...... - 我会质疑该技术的相关性。

要解决 TheSoftwareJedi 的评论：

```
WITH CustomersWith2OrMoreOrders AS (
    SELECT CustomerID
    FROM Orders
    GROUP BY CustomerID
    HAVING COUNT(*) >= 2
)
SELECT Customer.*
FROM Customer
INNER JOIN CustomersWith2OrMoreOrders
    ON Customer.CustomerID = CustomersWith2OrMoreOrders.CustomerID 
```

经过适当的索引，即使在 SQL Server 中使用这样的全域查询，我也从未遇到过性能问题。但是，我一直在这里和其他站点上遇到有关 Oracle 优化器问题的评论。

我自己对 Oracle 的体验[并不好](https://stackoverflow.com/questions/205351/oracle-database-allows-invalid-time-portion-of-datetime-column-values-under-wha)。

来自 OP 的评论似乎是说`COUNT(*)`优化器不能很好地处理表中的完整内容。IE：

```
IF EXISTS (SELECT COUNT(*) FROM table_name HAVING COUNT(*) >= 2)
BEGIN
END 
```

（当存在主键时，可以简化为简单的索引扫描 - 在极端优化的情况下，可以简单地查询 sysindexes.rowcnt 中的索引元数据 - 查找条目数 - 全部没有游标）是**通常**应避免有利于：

```
DECLARE CURSOR c IS SELECT something FROM table_name;
BEGIN
    OPEN c
    FETCH c INTO etc. x 2 and count rows and handle exceptions
END;

IF rc >= 2 THEN BEGIN
END 
```

对我来说，这会导致代码的可读性、可移植性和可维护性降低。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T13:05:16.803

在你把 Steven Feuerstein 的建议看得太严肃之前，先做一个小基准测试。在您的情况下，count(*) 是否明显比显式游标慢？不？然后更好地使用允许简单、可读代码的结构。在大多数情况下，这将是“选择 count(*) 进入 v_cnt ...如果 v_cnt>0 则 ...”

PL/SQL 允许非常可读的程序。不要仅仅为了纳米优化而浪费它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T03:22:13.253

根据数据库的不同，可能有一个 sys 表，其中存储了一个近似计数，并且可以在恒定时间内查询。如果您想知道表有 20 行、20,000 行还是 20,000,000 行，这很有用。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-18T04:00:23.627

SQL 服务器：

```
if 2 = (
    select count(*) from (
        select top 2 * from (
            select T = 1 union
            select T = 2 union
            select T = 3 ) t) t)
    print 'At least two' 
```

另外，永远不要使用游标。如果你认为你真的需要它们，用铁锹打败自己，直到你改变主意。让远古的遗物成为远古的遗物。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-12-05T09:27:04.290

如果要获取表中的行数，请不要使用count(*)，我建议count(0) 0 是主键列的列索引。

# c# - 异步命令模式 - 异常处理

> ID：297678
> 
> 赞同：3
> 
> 时间：2008-11-18T02:25:17.047
> 
> 标签：c#, .net, exception-handling, design-patterns

我正在为客户端/服务器应用程序中的“客户端”类实现异步命令模式。我过去做过一些套接字编码，我喜欢他们在 Socket / SocketAsyncEventArgs 类中使用的新异步模式。

我的异步方法如下所示：`public bool ExecuteAsync(Command cmd);`如果执行未决，则返回 true，如果同步完成，则返回 false。**我的问题是：即使发生异常，我是否应该始终调用回调 (cmd.OnCompleted)？还是我应该直接从 ExecuteAsync 抛出异常？**

如果您需要，这里有更多详细信息。这类似于使用 SocketAsyncEventArgs，但我的类不是 SocketAsyncEventArgs，而是称为 SomeCmd。

```
SomeCmd cmd = new SomeCmd(23, 14, 10, "hike!");
cmd.OnCompleted += this.SomeCmd_OnCompleted;
this.ConnectionToServer.ExecuteAsync(cmd); 
```

与 Socket 类一样，如果需要配合回调方法（本例中为 SomeCmd_OnCompleted），可以使用 ExecuteAsync 的返回值来了解操作是否处于挂起状态（true）或操作是否同步完成。

```
SomeCmd cmd = new SomeCmd(23, 14, 10, "hike!");
cmd.OnCompleted += this.SomeCmd_OnCompleted;
if( this.ConnectionToServer.ExecuteAsync(cmd) )
{
    Monitor.Wait( this.WillBePulsedBy_SomeCmd_OnCompleted );
} 
```

这是我的基类的一个大大简化的版本，但你可以看到它是如何工作的：

```
class Connection
{
    public bool ExecuteAsync(Command cmd)
    {
        /// CONSIDER: If you don't catch every exception here
        /// then every caller of this method must have 2 sets of
                /// exception handling:
        /// One in the handler of Command.OnCompleted and one where ExecuteAsync
        /// is called.
        try
        {
        /// Some possible exceptions here:
        /// 1) remote is disposed. happens when the other side disconnects (WCF).
        /// 2) I do something wrong in TrackCommand (a bug that I want to fix!)
            this.TrackCommand(cmd);
            remote.ServerExecuteAsync( cmd.GetRequest() );
            return true;
        }
        catch(Exception ex)
        {
            /// Command completing synchronously.
            cmd.Completed(ex, true);
            return false;
        }
    }
    /// <summary>This is what gets called by some magic when the server returns a response.</summary>
    internal CommandExecuteReturn(CommandResponse response)
    {
        Command cmd = this.GetTrackedCommand(response.RequestId);
        /// Command completing asynchronously.
        cmd.Completed(response, false);
    }

    private IServer remote;
}

abstract class Command: EventArgs
{
    internal void Completed(Exception ex, bool synchronously)
    {
        this.Exception = ex;

        this.CompletedSynchronously = synchronously;

        if( this.OnCompleted != null )
        {
            this.OnCompleted(this);
        }
    }

    internal void Completed(CommandResponse response, bool synchronously)
    {
        this.Response = response;
        this.Completed(response.ExceptionFromServer, synchronously)
    }

    public bool CompletedSynchronously{ get; private set; }

    public event EventHandler<Command> OnCompleted;

    public Exception Exception{ get; private set; }

    internal protected abstract CommandRequest GetRequest();
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T05:37:42.870

.NET 中异步操作的一种通用模式（至少对于`BackgroundWorker`和`BeginInvoke()/EndInvoke()`方法对来说，是有一个结果对象，将回调与实际返回值或发生的任何异常分开。处理异常是回调的责任。

一些类似 C# 的伪代码：

```
 private delegate int CommandDelegate(string number);

private void ExecuteCommandAsync()
{
    CommandDelegate del = new CommandDelegate(BeginExecuteCommand);
    del.BeginInvoke("four", new AsyncCallback(EndExecuteCommand), null);
}

private int BeginExecuteCommand(string number)
{
   if (number == "five")
   {
      return 5;
   }
   else
   {
      throw new InvalidOperationException("I only understand the number five!");
   }
}

private void EndExecuteCommand(IAsyncResult result)
{
    CommandDelegate del;
    int retVal;

    del = (CommandDelegate)((AsyncResult)result).AsyncDelegate;

    try
    {
        // Here's where we get the return value
        retVal = del.EndInvoke(result);
    }
    catch (InvalidOperationException e)
    {
        // See, we had EndExecuteCommand called, but the exception
        // from the Begin method got tossed here
    }
} 

```

因此，如果您调用`ExecuteCommandAsync()`，它会立即返回。`BeginExecuteCommand()`在单独的线程中启动。如果它抛出一个异常，那么该异常不会被抛出，直到您调用`EndInvoke()`(`IAsyncResult`您可以将其转换为`AsyncResult`，它已记录在案，但如果转换让您感到不舒服，您可以在状态中传递它。这样，异常处理代码是“自然放置”在您将与方法的返回值交互的地方。

有关更多信息，请[查看 MSDN 上有关 IAsyncResult 模式的](http://msdn.microsoft.com/en-us/library/ms228969.aspx)更多信息。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-18T02:51:06.247

我不会**在**ExecuteAsync 中抛出异常，而是为回调设置异常条件。这将创建针对异步逻辑的一致编程方式并减少重复代码。客户端可以调用此类并期望一种处理异常的方法。这将提供更少错误、更少脆弱的代码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-18T03:01:15.837

从调度点抛出异常可能有用也可能没用

调用传递异常参数的回调需要完成回调做 2 件不同的事情

异常报告的第二个回调可能更有意义

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T02:41:14.350

我会抛出一个自定义异常，而不是调用完成的回调。毕竟，如果发生异常，命令并没有完成。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T04:29:01.557

在一个地方处理异常要容易得多。我会使用以下区别：对于应该处理的异常，将它们扔到回调中。它使使用类变得更简单。对于不应被捕获的异常（例如，ArgumentException），在 ExecuteAsync 中抛出。我们希望尽快处理未处理的异常。

# objective-c - 从带有参数的方法名称创建选择器

> ID：297680
> 
> 赞同：60
> 
> 时间：2008-11-18T02:25:27.797
> 
> 标签：objective-c, selector

我有一个`SEL`从当前对象获取 a 的代码示例，

```
SEL callback = @selector(mymethod:parameter2); 
```

我有一个方法

```
 -(void)mymethod:(id)v1 parameter2;(NSString*)v2 {
} 
```

现在我需要移动`mymethod`到另一个对象，比如说`myDelegate`。

我试过了：

```
SEL callback = @selector(myDelegate, mymethod:parameter2); 
```

但它不会编译。

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-11-18T02:48:39.590

SEL 是一种在 Objective-C 中表示选择器的类型。@selector() 关键字返回您描述的 SEL。它不是函数指针，您不能将任何对象或任何类型的引用传递给它。对于选择器（方法）中的每个变量，您必须在对@selector 的调用中表示它。例如：

```
-(void)methodWithNoParameters;
SEL noParameterSelector = @selector(methodWithNoParameters);

-(void)methodWithOneParameter:(id)parameter;
SEL oneParameterSelector = @selector(methodWithOneParameter:); // notice the colon here

-(void)methodWIthTwoParameters:(id)parameterOne and:(id)parameterTwo;
SEL twoParameterSelector = @selector(methodWithTwoParameters:and:); // notice the parameter names are omitted 
```

选择器通常传递给委托方法和回调，以指定在回调期间应在特定对象上调用哪个方法。例如，当您创建一个计时器时，回调方法具体定义为：

```
-(void)someMethod:(NSTimer*)timer; 
```

因此，当您安排计时器时，您将使用 @selector 来指定对象上的哪个方法实际上将负责回调：

```
@implementation MyObject

-(void)myTimerCallback:(NSTimer*)timer
{
    // do some computations
    if( timerShouldEnd ) {
      [timer invalidate];
    }
}

@end

// ...

int main(int argc, const char **argv)
{
    // do setup stuff
    MyObject* obj = [[MyObject alloc] init];
    SEL mySelector = @selector(myTimerCallback:);
    [NSTimer scheduledTimerWithTimeInterval:30.0 target:obj selector:mySelector userInfo:nil repeats:YES];
    // do some tear-down
    return 0;
} 
```

在这种情况下，您指定每 30 秒向对象 obj 发送一次 myTimerCallback 消息。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-18T02:34:44.220

您不能在@selector() 中传递参数。

看起来您正在尝试实现回调。最好的方法是这样的：

```
[object setCallbackObject:self withSelector:@selector(myMethod:)]; 
```

然后在你的对象的 setCallbackObject:withSelector: 方法中：你可以调用你的回调方法。

```
-(void)setCallbackObject:(id)anObject withSelector:(SEL)selector {
    [anObject performSelector:selector];
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-18T04:11:22.653

除了已经说过的关于选择器的内容之外，您可能还想查看 NSInvocation 类。

> *NSInvocation 是一个呈现为静态的 Objective-C 消息，也就是说，它是将一个动作转换为一个对象。NSInvocation 对象用于在对象之间和应用程序之间存储和转发消息，主要由 NSTimer 对象和分布式对象系统来实现。*
> 
> *NSInvocation 对象包含 Objective-C 消息的所有元素：目标、选择器、参数和返回值。这些元素中的每一个都可以直接设置，并且在调度 NSInvocation 对象时自动设置返回值。*

Keep in mind that while it's useful in certain situations, you don't use NSInvocation in a normal day of coding. If you're just trying to get two objects to talk to each other, consider defining an informal or formal delegate protocol, or passing a selector and target object as has already been mentioned.

# overflow - CSS 最大高度属性

> ID：297686
> 
> 赞同：47
> 
> 时间：2008-11-18T02:28:13.313
> 
> 标签：overflow, css

是否有一种很好的**跨浏览器**方法来设置 DIV 的`max-height`属性，当 DIV 超出 时`max-height`，它会变成滚动条溢出？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-18T03:48:09.300

遗憾的是 IE6 没有，因此您必须为 IE6 使用表达式，然后为所有其他浏览器设置最大高度：

```
 div{
       _height: expression( this.scrollHeight > 332 ? "333px" : "auto" ); /* sets max-height for IE6 */
       max-height: 333px; /* sets max-height value for all standards-compliant browsers */
       overflow:scroll;
} 
```

Overflow:auto 在大多数情况下很可能会工作，因为有任何额外的溢出。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-07-28T23:40:25.973

我从 2005 年发表的一篇文章（[Min-Height Fast hack](http://www.dustindiaz.com/min-height-fast-hack/)）中找到了这个解决方案。这是一个 hack，但它是简单而纯粹的 CSS：

```
selector {
  max-height:500px;
  height:auto !important;
  height:500px;
} 
```

该示例适用于最大高度，但适用于最小高度、最小宽度和最大宽度。:)

*注意：您必须使用绝对值，百分比不起作用。

您现在需要的只是“溢出：滚动；” 使用滚动条进行这项工作

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-07-01T02:01:06.337

```
selector
{
    max-height:900px;
    _height:expression(this.scrollHeight>899?"900px":"auto");
    overflow:auto;
    overflow-x:hidden;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T02:31:21.280

你能有一个高度设置为你的高度和溢出的包装器div：滚动。然后内部 div 没有设置高度，随着它的增长它将填充然后使用第一个 div 的滚动条？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-01T22:14:09.813

主要黑客（红狼风格）：

```
.divMax{width:550px;height:200px;overflow-Y:auto;position:absolute;}
.divInner{border:1px solid navy;background-color:white;} 
```

我没有从 max-height 属性中得到任何爱，所以我已经有了这个并且成功地完成了这两个类。但这很丑，所以在寻找更好的问题时。divMax`position:absolute`让下面的内容显示出来，但将 divInner 的最终高度控制为 200px。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-02-28T18:35:07.713

我从[http://www.tutorialspoint.com/css/css_scrollbars.htm](http://www.tutorialspoint.com/css/css_scrollbars.htm)找到了这个并做了一些修改。它似乎适用于 IE9 和 FF19

```
<style type="text/css">
.scroll{
    display:block;
    border: 1px solid red;
    padding:5px;
    margin-top:5px;
    width:300px;

    max-height:100px;
    overflow:scroll;
}
.auto{
    display:block;
    border: 1px solid red;
    padding:5px;
    margin-top:5px;
    width:300px;
    height: 100px !important;
    max-height:110px;
    overflow:hidden;
    overflow-y:auto;
}
</style>
<p>Example of scroll value:</p>

<div class="scroll">
    I am going to keep lot of content here just to show
    you how scrollbars works if there is an overflow in
    an element box. This provides your horizontal as well
     as vertical scrollbars.<br/>
    I am going to keep lot of content here just to show
    you how scrollbars works if there is an overflow in
    an element box. This provides your horizontal as well
     as vertical scrollbars.<br/>
    I am going to keep lot of content here just to show
    you how scrollbars works if there is an overflow in
    an element box. This provides your horizontal as well
     as vertical scrollbars.<br/>
    I am going to keep lot of content here just to show
    you how scrollbars works if there is an overflow in
    an element box. This provides your horizontal as well
     as vertical scrollbars.<br/>        
     </div>

<br />
<p>Example of auto value:</p>

<div class="auto">
    I am going to keep lot of content here just to show
    you how scrollbars works if there is an overflow in
    an element box. This provides your horizontal as well
     as vertical scrollbars.<br/>
   </div> 
```

# unit-testing - Visual C++ TDD 设置

> ID：297687
> 
> 赞同：3
> 
> 时间：2008-11-18T02:30:07.820
> 
> 标签：unit-testing, visual-c++, visual-studio-2005, tdd, cppunit

我以前没有使用过 Visual Studio。我在业余时间开始了一个个人项目，我想使用测试驱动开发，因为它在我的 Java 开发中对我来说是一个巨大的好处。我很久以前就开始了这个项目，我使用了 CppUnit。我知道可能还有其他更好的框架，但这是已经存在的。

我的 Visual Stuido 2005 解决方案中有 2 个项目。当单元测试位于应用程序代码旁边时，它工作得很好。随着项目规模的扩大，这变得非常麻烦和不雅。我在我的解决方案下创建了一个新项目来容纳单元测试（所以它现在有 3 个项目）。一切都很顺利，直到我尝试构建解决方案。一切都已编译，但单元测试项目无法链接。对于我的测试调用的每个函数，输出为我提供了 51 个“未解决的外部符号”错误 (LNK2019)。

据我推断，问题在于 Visual Studio 创建的目录结构。每个项目都有自己的目录，然后在其下方是创建的目标文件和可执行文件。我认为问题在于，虽然头文件正确包含在每个单元测试中，但链接器无法找到 cpp 文件，因为它们位于不同的目录中。当它找不到被调用函数的实现时，它给了我 2019 错误。

我对问题的评估是否正确？我该如何解决？我是否需要完全重新组织我的项目或者是链接器的简单配置？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T20:17:38.877

听起来您的测试项目正在使用的主要项目中的函数/类没有被导出。如果未导出代码，则代码所在的 DLL/exe 之外的任何内容都无法引用它。

我们处理这个问题的一种常见方法是向项目添加一个定义（在项目设置中，转到配置属性 -> C/C++ -> 预处理器，第一行有定义）称为`PROJECTNAME_IMPL`（确保你这样做对于调试和发布配置！）。然后有一个头文件（称为 ProjectNameExport.h），任何导出的内容都包括在内，其中包含如下内容：

```
#ifdef PROJECTNAME_IMPL
    #define PROJECTNAME_API __declspec(dllexport)
#else
    #define PROJECTNAME_API __declspec(dllimport)
#endif 
```

然后，在定义一个类时（例如）：

```
#include "ProjectNameExport.h"

class PROJECTNAME_API Foo
{
}; 
```

当头文件包含在项目内的文件中时导出类，并在头文件包含在另一个项目的文件中时导入类（当然，链接到第一个项目）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T20:29:20.867

我总是将要测试的代码添加到单独的静态 .lib 文件中，并让主应用程序 EXE 和单元测试 EXE 依赖于此。.lib 项目添加了新代码，依赖项支持确保 EXE 链接没有错误。您需要确保 EXE 项目可以找到 .lib 标头，但这取决于您的目录结构。您还必须注意 .lib 和 EXE 使用相同的 CRT/MFC 库（例如，当使用 CRT 时，您可以静态链接它或使用 DLL）。

我发现以这种方式使用库比将文件/头添加到多个项目更容易维护。

我正在使用 Boost 测试框架，但无论 TDD 框架如何，我都会采用相同的结构。

可以在此处找到有关类似设置的好文章：

[http://www.codeproject.com/KB/architecture/Designing_Robust_Objects.aspx](http://www.codeproject.com/KB/architecture/Designing_Robust_Objects.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T02:56:59.323

是的，你的评价听起来不错。试试这个：在解决方案资源管理器中，右键单击包含您的测试的项目的名称，然后选择“项目依赖项”。检查它所依赖的每个项目。这应该设置链接器设置，以便它可以自动找到正确的文件。

# compact-framework - 在 CF.NET 中创建大位图时出现 OutOfMemoryException

> ID：297697
> 
> 赞同：4
> 
> 时间：2008-11-18T02:36:06.090
> 
> 标签：compact-framework, gdi+, bitmap

我的紧凑框架应用程序通过将所有项目渲染到一个大的位图表面来创建一个平滑滚动列表，然后将该位图复制到屏幕上的偏移位置，以便仅显示适当的项目。旧版本只渲染当时应该出现在屏幕上的项目，但是这种方法对于平滑的滚动界面来说太慢了。

最初创建大位图时，它偶尔会生成 OutOfMemoryException。如果用户对设备执行软重置并再次运行应用程序，则可以毫无问题地执行创建。

看起来这个位图不是在程序内存中生成的，因为应用程序使用的程序内存量与新平滑滚动方法之前使用的程序内存量大致相同。

有什么方法可以防止这种异常吗？有什么方法可以在抛出异常之前释放我需要的内存（无论它在哪里）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T03:25:41.967

就在我发布后，我想到了一些你*可以*做的事情来解决新版本的问题。您遇到的问题是 CF 试图找到一块可用于巨大位图的连续内存块，这有时是个问题。

除了创建一个大位图之外，您还可以创建一组较小的位图，每个项目一个，并将每个项目渲染到它自己的小位图上。在显示期间，您只需复制所需的位图。CF 将比创建一个大的位图更容易创建一堆小位图，并且你不应该有任何内存问题，除非这是一大堆项目。

我应该避免像“没有解决办法”这样的表达。

还有一点很重要：确保在完成后对每个位图调用 Dispose()。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T15:16:13.967

我建议回到只渲染部分数据的旧机制，因为完全渲染数据的大小显然是一个问题。为了帮助防止渲染问题，我可能会在当前视图的上方和下方预渲染几行，以便它们可以在有限的影响下“滚动”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T03:20:05.160

您的位图肯定*是*在程序内存中创建的。位图需要多少内存取决于它有多大，而这个所需的大小是否会生成 OutOfMemoryException 取决于 PDA 有多少可用内存（这使得这是一个随机发生的错误）。

抱歉，但这通常是一种不可取的控件渲染技术（尤其是在 Compact Framework 上），除了增加 PDA 上的物理内存外，没有任何解决办法，这通常是不可能的（而且通常也无法解决问题） ，因为无论设备有多少可用，CF 进程都限制为 32MB）。

您最好的选择是回到旧版本并提高其渲染速度。CF 上还有一种简单的技术可用于使控件双缓冲以消除闪烁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T15:12:16.953

由于您似乎遇到了设备限制，限制了您可以创建的位图空间的总大小（这些显然是在视频 RAM 中而不是一般程序内存中创建的），一种替代方法是将此处使用的大位图对象替换为一块普通的 Windows 内存块，通过调用 BitBlt API 函数来访问它以进行读取和写入。

最初创建内存块很棘手，您可能想问另一个关于此的 SO 问题（GCHandle.Alloc 可用于创建“固定”对象，这意味着 .NET 不允许在其中移动它内存，这在这里很重要）。我知道该怎么做，但我不确定我做对了，我宁愿有专家的意见。

一旦您创建了大块，您将遍历您的项目，将每个项目渲染为一个您不断重复使用的小位图（使用您现有的 .NET 代码），然后将其 BitBlt 到您的内存块中的适当位置。

创建整个缓存后，您的渲染代码应该像以前一样工作，不同之处在于您不是从大位图复制到渲染表面，而是从缓存块中进行 BitBlt。BitBlt 的参数与 DrawImage 的参数基本相同（目标、源、坐标和大小等）。

由于您是以这种方式使用常规内存而不是专门的视频 RAM 创建缓存，因此我认为您不会遇到同样的问题。但是，我肯定会让块创建代码首先工作并测试以确保它每次都能创建足够大的块。

更新：实际上，理想的方法是拥有一组较小的内存块而不是一个大的内存块（就像我认为是位图方法的问题），但你已经有足够的事情要做了。我使用过处理 5MB 和 10MB 对象的 CF 应用程序，无论如何这不是一个大问题（尽管当该块被固定时它可能是一个更大的问题 - 我不知道）。顺便说一句，我一直对创建位图的 OOME 感到惊讶，因为我知道位图比可用内存小得多，你也是 - 现在我知道为什么了。抱歉，起初我认为这是一个简单的解决方案。

# .net - Windows 窗体应用程序的默认字体

> ID：297701
> 
> 赞同：42
> 
> 时间：2008-11-18T02:36:53.547
> 
> 标签：.net, winforms, user-interface, fonts, appearance

每次我在我的应用程序中创建一个新表单时，它默认使用“Microsoft Sans Serif，8.25pt”字体。我没有更改它，因为我知道在这种情况下，我的表单*应该*选择系统的默认字体。但是，当我运行我的应用程序时，使用的字体仍然是 Segoe UI（我在 Windows Vista 操作系统中的默认系统字体）。

为什么会这样？如何确保我的应用程序看起来像普通的 Windows 应用程序？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2010-11-02T09:02:52.103

接受的答案并没有真正回答问题。它只是解释了为什么会发生这种行为。

其他一些答案提出了可靠的解决方法，但我发现最好的解决方案确实是创建一个基本表单，应用程序中的所有表单都继承自该基本表单，`SystemFonts.MessageBoxFont`并在构造函数中将此基本表单的 Font 属性设置为。这不仅可以确保您的应用程序在运行时根据用户的环境选择正确的字体（避免 Hans Passant 带来的潜在问题——没有 Office 2007 的 XP 将在没有 Segoe UI 的情况下求助于 Microsoft Sans Serif )，而且还为您提供了对当前 Windows 字体的**设计时支持。**在设计时使用正确的字体可以解决 Josuegomes 指出的问题，因为在表单上创建的任何容器控件都会在设计时获取表单使用的字体。

除了上述优点之外，这使您不必记住为您创建的每个表单修改构造函数，并确保应用程序中所有表单的一致性，并为您提供放置其他常用功能的位置。我以几种不同的方式使用它，例如 p/invoking 等，以修复 WinForms 实现中的错误。

这种方法剩下的唯一问题是，如果您想为特定控件设置字体样式，例如粗体。执行此操作的最佳位置仍然是在该表单的构造函数中，从表单的字体作为基础开始并从中修改样式：

```
myControl.Font = New Font(Me.Font, FontStyle.Bold) 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-01-20T12:39:01.270

您可以在 Form 构造函数中的 InitializeComponent() 之前添加：

```
this.Font = SystemFonts.MessageBoxFont; 
```

这似乎适用于 Windows XP 和 Windows Vista。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-24T06:11:14.547

查看此[博客条目](http://weblogs.asp.net/KDente/archive/2005/03/13/394499.aspx)，讨论 Forms 中的默认字体，这会导致您遇到的问题以及Microsoft 的响应中的此[Connect Bug 。](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=115408)简而言之，Forms 似乎没有获得（正确的）默认 windows 字体（您已更改）。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-18T20:45:57.200

是的，它使用返回的字体`GetStockObject(DEFAULT_GUI_FONT)`。这是 MS 无衬线字体。一种旧字体，大多数机器早已不复存在。毫不奇怪，字体映射器将其转换为 Microsoft Sans Serif。

我知道没有记录的程序可以更改该默认字体，SDK 文档明确提到了 MS Sans Serif。如果您想要 Segoe，则必须提出要求。这样做并不安全，仍然有很多没有 Office 2007 的 XP 机器。字体映射器将在没有 Segoe 可用的机器上翻译它。不知道会弹出什么，我已经没有这样的机器了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-10-21T18:12:24.700

组框内的控件确实不受窗体的 Font 属性的影响。原因是容器控件中的控件被视为容器控件（如 groupbox）的子控件，而不是主窗体的子控件。为了使所有控件（包括 groupbox 中的控件）正确缩放，您可以使用类似于以下的代码：

```
 foreach (Control ctr in this.Controls)
        {
            ctr.Font = SystemFonts.IconTitleFont;

            // controls in groupboxes are not child of main form
            if (ctr.HasChildren)
            {
                foreach (Control childControl in ctr.Controls)
                {
                    childControl.Font = SystemFonts.IconTitleFont;
                }
            }        
        } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-02T19:59:26.680

如果您有带有关联控件的组框，则将窗体的 Font 属性设置为 SystemFonts.DialogFont 不起作用。组框内的控件不受窗体的 Font 属性的影响。我通过将每个组框的 Font 属性设置为 SystemFonts.DialogFont 来“解决”这个问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-07-08T18:33:19.870

试试这个，单击一个表单并更改字体大小，例如我将表单的字体大小更改为 12pt，然后通过将文本框拖动到表单进行测试。您会看到，文本框大小也更改为 12pt。我只是偶然得到了这个解决方案。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-11-18T08:40:23.353

`Control.DefaultFont`是只读的；一个hacky是覆盖它是使用反射。

```
Type settingsType = typeof(Control);
var defaultFontField = settingsType.GetField("defaultFont", BindingFlags.Static | BindingFlags.NonPublic);
defaultFontField.SetValue(null, new Font("Segoe UI", 8.25F)); 
```

确保让 UT 密切关注此代码，如果框架实现发生更改，没有 API 合约可以保护您。

还要注意表单设计器，它大多数时候会在 .designer 类中逐字插入字体。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2022-02-13T06:08:48.207

在 .NET Core 中，我们（.NET 团队）将默认字体更新为 Segoe UI，在 .NET 6 中，我们添加了一个 API 来更改整个应用程序的默认字体。

在项目文件里面`<PropertyGroup>`添加：

```
<ApplicationDefaultFont>Curlz MT, 18pt</ApplicationDefaultFont> 
```

这将更新设计器和正在运行的应用程序中使用默认字体的每个控件（您未明确覆盖的所有内容）。

您也可以像下面的示例一样`Application.SetDefaultFont()`直接调用您`Main()`：

```
static void Main()
{
    ApplicationConfiguration.Initialize();

    Application.SetDefaultFont(new Font(new FontFamily("Curlz MT"), 18f));

    Application.Run(new AirQualityForm());
} 
```

这将更新您正在运行的应用程序中的字体，但不会更新设计器中的字体。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-05-01T17:57:29.693

我已经尝试过同时针对`net472/net48`和的示例应用程序`netcoreapp3.1`。虽然 .net 应用程序`Control.DefaultFont`始终返回 Microsoft Sans Serif 并且未缩放。但是 .net core 3.1 应用程序`Control.DefaultFont`在 win7/10 上完全返回系统字体并且缩放良好。所以，我认为他们最终在核心中解决了这个问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-07-18T16:47:28.023

我对此有一个非常简单的建议。只需选择表单并从属性面板中选择所需的字体。中提琴，您所做的每个控件都会将您选择的字体作为默认字体。

# unicode - 如何在 Unicode 中将字符串设置为大写/小写？

> ID：297703
> 
> 赞同：15
> 
> 时间：2008-11-18T02:37:24.403
> 
> 标签：unicode, string, theory, low-level, uppercase

这主要是一个我很好奇的理论问题。（我不是想通过自己编码或任何东西来做到这一点，我不是在重新发明轮子。）

我的问题是大写/小写等价表如何适用于 Unicode。

例如，如果我必须在 ASCII 中执行此操作，我会取一个字符，如果它落在 [az] 范围内，我会将 A 和 a 之间的差相加。

如果它不在那个范围内，我会为 10 个左右的重音字符加上 ñ 提供一个小的等价表。（或者，我可以有一个包含 256 个条目的完全等价数组，其中大部分与输入相同）

但是，我猜有一种更好的方法来指定 Unicode 中的等价，因为有数十万个字符，理论上，可以添加一种新语言或一组字符（我期待你发生这种情况时不需要修补窗口）。

Windows 是否对每个字符都有一个巨大的硬编码等价表？或者这是如何实现的？

一个相关的问题是 SQL Server 如何实现基于 Unicode 的不区分重音和不区分大小写的查询。它是否有一个内部表告诉它 é ë è E É È 和 Ë 都等价于“e”？

在比较字符串时，这听起来不是很快。

它如何快速访问索引？它是否已经索引值转换为它们的“基本”字符，对应于该字段的排序规则？

有谁知道这些东西的内部原理？

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-18T06:00:36.147

我将解决这个问题的 MS SQL Server 部分，但“正确”的答案实际上取决于支持的语言和应用程序。

在 SQL Server 中创建表时，每个文本字段都具有隐式或显式指定的排序规则。这会影响排序顺序和比较行为。对于大多数英语（美国）语言环境，默认值为 Latin1_General_CI_AS，或拉丁语 1、不区分大小写、区分重音。这意味着，例如，a=A，但 a!=Ä 和 a!=ä。您还可以使用不区分重音 (Latin1_General_CI_AI)，它将“A”的所有变音符号变体视为相同。

一些语言环境支持其他类别的比较；例如，法语对包含变音符号的单词的排序与德语略有不同。土耳其语认为无点 i 和带点 i 在语义上不同，因此如果您使用土耳其语、不区分大小写、区分重音的排序规则，即使不区分大小写的比较也不会匹配。

您可以更改每个数据库、每个表、每个字段的排序规则，甚至可以更改每个查询的排序规则。我的理解是索引根据指定的排序顺序进行规范化，这意味着索引基本上保持原始字符串的扁平化版本。例如，对于不区分大小写的排序规则，Apple 和 apple 存储为 apple。查询在搜索之前使用相同的排序规则进行展平。

在日语中，还有另一类规范化，其中全角和半角字符，如 ア=ｱ，在某些情况下，两个半角字符被展平为一个语义等效的字符（バ=ﾊﾞ）。最后，对于某些语言，还有另外一个带有复合字符的蜡球，其中孤立的变音符号可以与其他字符组成（例如，ä 中的变音符号是一个字符，由简单形式 a 组成）。越南语、泰语和其他一些语言有此类别的变体。如果存在规范形式，Unicode 规范化允许将组合形式和分解形式视为等效形式。Unicode 规范化通常在进行任何比较之前应用。

总而言之，对于不区分大小写的比较，您执行的操作与比较 ASCII 范围字符串时所做的非常相似：将比较的左侧和右侧展平为“小写”（例如），然后将数组作为二进制进行比较大批。不同之处在于您需要 1）将字符串标准化为相同的 unicode 形式（kC 或 kD） 2）根据该语言环境的规则将字符串标准化为相同的大小写 3）根据重音敏感规则将重音标准化4) 根据二进制比较进行比较 4) 如果适用，例如在排序的情况下，使用附加的二级和三元排序规则进行比较，其中包括类似于某些语言中“Mc”在“M”之前排序的内容。

是的，Windows 存储所有这些规则的表。默认情况下，您不会在每次安装中都获得所有这些，除非您通过控制面板中的东亚语言支持和复杂脚本支持添加对它们的支持。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-18T02:54:29.767

有一个映射文件包含所有具有 1:1 映射比率的案例映射。通常操作系统/框架/库支持特定版本的 Unicode，并且由于这种情况下的映射文件是版本化的，因此您将获得特定操作系统/框架/库/发生支持的任何版本的 Unicode 的映射。

有关 Unicode 大小写映射的更多信息，请参阅：[http ://www.unicode.org/faq/casemap_charprop.html](http://www.unicode.org/faq/casemap_charprop.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-18T03:02:36.660

大多数书写系统没有单独的大写和小写字母。根据维基百科，例外情况包括“罗马字母、希腊字母、西里尔字母和亚美尼亚字母”。

所以没有那么多信件需要担心。[这个页面](http://en.wikipedia.org/wiki/Latin_characters_in_Unicode)显示了大范围的字符遵循一个简单的方案，即在大写字符上加 1 以获得等效的小写字母（当然也有一些例外）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T21:11:03.063

正确的答案要复杂一些，具体取决于您要执行的操作。

在比较字符串时，对于排序或搜索应用程序，要使用的正确算法在[UTS #10：“Unicode Collat​​ion Algorithm”中指定。](http://unicode.org/reports/tr10/)不区分大小写是其中的一部分，但是有不同的方式来表示许多字符，并且应用程序通常需要将各种表示视为等效。

The sorting rules are locale-dependent. This is mainly an issue when you are sorting results for display to a user. Ignoring the rules can frustrate users and even result in security vulnerabilities.

If you are just trying to capitalize words for display purposes, the rules there can be tricky too; there are one-to-many conversions and other issues. Depending on the locale, the same letter may capitalize differently. The letter's position in a word can make a difference. There's also a a distinct notion of "title case", where you just want to capitalize the first letter of each word. Sometimes the title-case of a character is not the same as its upper-case.

# php - 如何将数组的内容输出为逗号分隔的字符串？

> ID：297713
> 
> 赞同：1
> 
> 时间：2008-11-18T02:46:17.553
> 
> 标签：php, arrays

我想将数组 if ID 转换为逗号分隔值的字符串，以在 MySQL UPDATE 查询中使用。我该怎么做？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-18T02:48:01.963

```
implode(',', $array); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-18T09:26:59.613

请记住转义值：

```
'"' . implode('","', array_map('mysql_real_escape_string', $data)) . '"' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T04:08:08.790

确保在执行查询之前通过[mysql_real_escape_string()传递结果。](http://ca.php.net/mysql_real_escape_string)如果您按照其他人的建议使用 implode()，这应该可以防止 sql 注入。

正如 nickf 所提到的，请始终先检查以确保数组不为空或 null，然后处理这些情况。由于您只处理 int，因此在分配中进行一些类型检查不会有什么坏处，否则如果字符串以某种方式滑入，您将收到 sql 错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T10:41:46.813

通常这种情况是人们从另一个表构建一个数组以用于第二个查询。如果是这种情况，您可以使用子查询来完成此操作。

例如。UPDATE Table SET Column = Value WHERE ID IN (SELECT ID FROM Table2 WHERE CONDITIONS)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T08:27:00.743

如果所有 id 都应该是数字，这可能会更好。检查它是否由至少一个整数组成

```
$ids = array_filter($ids, 'is_int');
if (!$ids) {
    //no valid ids returned.
    die('or something');
}
$sql .= '(' . implode(',', $ids) . ')'; 
```

# waf - 如何在 Waf 中检查指定的头文件？

> ID：297737
> 
> 赞同：5
> 
> 时间：2008-11-18T03:00:24.450
> 
> 标签：waf

我正在使用 waf 构建一个 C 程序。我想在配置阶段检查是否存在特定的头文件。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-18T05:09:04.970

啊，有点谷歌搜索找到了我的问题的答案：您可以`check`在配置对象上使用该方法，如下所示：

```
def configure(conf):
    conf.check(header_name="stdbool.h") 
```

# asp.net - 有什么方法可以构建像 PDF 文件查看器这样的 Google Docs？

> ID：297743
> 
> 赞同：15
> 
> 时间：2008-11-18T03:02:47.160
> 
> 标签：asp.net, pdf

有没有人认为可以构建一个 Google Docs 样式的 PDF 文档查看器，它将文档转换为不需要客户端机器上的 Adob​​e Reader 的格式？

如果是这样，任何参考指向？要么是做过的地方，要么是对如何做的解释。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-06T04:32:50.760

我对这个问题做了很多研究，希望能帮上忙。

好老的 Macromedia 曾经推销 Flash Paper，它被认为是 PDF Adob​​e Reader 杀手，因为它允许任何网站管理员使用 Flash 在线嵌入和显示 PDF 文档。但那是在它们卖给 Adob​​e 之前，Flash Paper 很快就被搁置并被遗忘，而被 Adob​​e 优先考虑。

然而，今天有很多突破性的选择......

正如用户在上面提到的，您可以使用[Scribd.com](http://www.scribd.com)（想要成为 YouTube 的文档）。但它们并不是唯一的服务（当然也不是最领先的服务）。

这是我最喜欢的两个：

1.  问题 ( [http://www.issuu.com](http://www.issuu.com) )
2.  Mygazines ( [http://www.mygazines.com/](http://www.mygazines.com/) )

我最喜欢 Mygazines 的 flash 用户界面（它也更快），但它的价格为 99 美元。这是相当令人印象深刻的。取决于你想要做什么，这个价格标签可能是值得的。

然而，Issuu 最近通过他们的 Smartlook 平台赢得了我的青睐：http: [//issuu.com/smartlook](http://issuu.com/smartlook)

以下是网站上 Smartlook 设置的示例：

[http://www.ismartlook.com/](http://www.ismartlook.com/)

另外它是完全免费的，这很好。

我自己考虑使用的第三种选择是这个名为 samurajdata 的人制作的免费开源代码。他称之为 psview（PostScript Viewer）。任何人都可以下载源代码并在此处查看它的实际效果：

[http://view.samurajdata.se/](http://view.samurajdata.se/)

转换后的 PDF 在转换为图像文件时会降低质量，但设置起来既快速又容易。

我希望这有帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-01T05:33:35.510

您可以尝试[Doconut.com](http://Doconut.com)看起来与 Google Docs viewer 非常相似。它适用于 asp.net 4.0，除了 PDF，它还可以显示所有办公格式，tiff、dwg、psd 等。但是它是一个付费图书馆。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T03:25:22.200

如果我理解正确，您只想查看这些文件而不是编辑它们。

Google 已经尽最大努力将在其搜索结果中找到的 PDF 文件提供为 HTML。这并不总是有效。您可以通过设置一个 gmail 帐户，将所有 PDF 文件邮寄给它，然后使用消息中的所有“以 HTML 格式查看附件”链接来尝试一下。

您的其他选择是获取源材料并将其转换为 HTML，就像 LaTeX2HTML 对 LaTeX 文档所做的那样，或者将 PDF 转换为以下之一：光栅图像（tiff、DjVu 等）或矢量图像（PostScript、SVG ，SWF）。

如果此过程的输入从 PDF 文件开始，则您的选择非常有限，尤其是当 PDF 的内容只是光栅图像（例如扫描页面）时。

就我个人而言，我主张从源文件创建 PDF，并尝试使用[Flash Paper](http://www.adobe.com/products/flashpaper/examples/)来创建 SWF，因为 Flash Paper 会伪装成打印机。因为大约 98% 的浏览器都有 Flash 9 或更高版本。

你见过[斯克里布德](http://www.scribd.com/upload?from=banner)吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-04T11:41:12.850

您可以只使用也支持 PDF 文档的[Google Docs Viewer 。](https://docs.google.com/viewer)它允许您将其嵌入您的网页并指向 PDF 所在的 URL（不必位于 Google 服务器上）。

例子：

```
http://docs.google.com/viewer?embedded=true&url=http%3A%2F%2Fwww.domain.com%2Fdocument.pdf 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-19T13:55:15.967

有可用的[Internet Archive BookReader](http://openlibrary.org/dev/docs/bookreader)。这是一个用 javascript (jQuery) 实现的不错的图书查看器，因此客户端不需要 PDF 阅读器或 Flash。虽然它需要书页的图像，但您可以轻松地将其连接到您自己的图像服务器，因此您可以尝试通过 ASP.NET（或任何其他工具，如 XPDF）将 PDF 转换为图像。我发现这比实际实现图像查看器更容易实现。

此外，它似乎支持搜索突出显示（[在此处尝试](http://www.archive.org/stream/birdbookillustra00reedrich#page/n3/mode/2up)），但我还没有准确调查需要哪些元数据以及采用什么格式。

最后一个[发布文件](http://github.com/openlibrary/bookreader/tarball/Release27)包含一个关于如何使用它的简单示例。更多细节和示例可以在第一个链接中找到。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T03:16:11.657

尝试将它们从[PDF 转换为 TIFF](http://www.google.com.au/search?q=PDF+to+Tiff)。Tiff 支持多页并得到广泛支持。

如果格式不是那么重要，并且您的 PDF 结构正确（即实际上包含文本，而不是文本图像），则可以将其转换为 HTML。[Aspose](http://www.aspose.com/)的工具非常好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T11:16:05.353

我想知道你为什么要这样做。PDF 是一种通用且受到广泛支持的格式，如果您试图避免使用它，您将受到以下限制：

*   一种更晦涩或不太受支持的格式（dvi、svg，直到它得到更好的支持）
*   像 Google 一样转换为文本/HTML 的结果并不完美
*   转换为像 TIFF 这样的图像格式，它会增加文件大小并删除 PDF 的所有细节，如真实的、可选择的文本和超链接

如果您不希望您的用户必须安装 Adob​​e Reader（可以理解），可以使用许多免费的轻量级 PDF 查看器（例如 Foxit Reader），我相信其中许多都具有浏览器嵌入功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-26T12:24:12.640

我在这里错过了什么吗？Google Docs 确实支持 PDF。只需上传 PDF 文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-17T18:06:03.907

其他一些选择取决于您要做什么：

*   [RAD PDF](http://www.radpdf.com) - 用于显示 PDF 文档、表单等的 ASP.NET 组件。还允许 PDF 搜索、书签、文本选择和基本编辑。
*   [Atalasoft](http://www.atalasoft.com/ajax-image-viewer) - 用于图像查看的 ASP.NET 组件，还允许 PDF 用作图像。不支持除简单查看之外的任何 PDF 功能。

# url-encoding - HTML转义

> ID：297749
> 
> 赞同：1
> 
> 时间：2008-11-18T03:07:13.127
> 
> 标签：url-encoding

鉴于：

```
CR = %0d = \r
LF = %0a = \n 
```

做什么

%3E, %3C

意思是？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-18T03:09:20.953

它们是 URL 编码字符。%3C 是 <，%3E 是 >

[有关URL 编码](http://www.blooberry.com/indexdot/html/topics/urlencoding.htm)的更多信息，以及一些较低 ASCII 值[的图表](http://www.asciitable.com/)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-18T03:09:46.443

粘贴

```
javascript:alert(unescape("%3E")) 
```

进入浏览器的地址栏并点击 Return 以找出答案；）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T03:10:17.050

% 后面的两位数字是用[十六进制表示的](http://wikipedia.org/wiki/Hexadecimal)[ASCII](http://wikipedia.org/wiki/ASCII)码。

# .net - System.IO.FileNotFoundException 尝试在设计器中的 Form 上删除 UserControl 时出现异常

> ID：297759
> 
> 赞同：1
> 
> 时间：2008-11-18T03:12:42.180
> 
> 标签：.net, visual-studio-2008, user-controls, designer

我在 Managed C++ 中创建了一个自定义 UserControl，它包装了一些本机代码控件。我已经确认控件在运行时工作，并且一直在尝试通过允许从设计器工具箱中拖放控件来使控件与 Visual Studio 设计器一起工作。

虽然我已成功将 UserControl 添加到工具箱，但当我将控件拖到 Windows 窗体上时没有任何反应。为了调查这个问题，我打开了第二个 Visual Studio 2008 实例并将其调试器附加到我尝试使用 UserControl 的 devenv.exe 实例。将 UserControl 拖放到 Windows 窗体后，Visual Studio 调试器在尝试加载包含 UserControl 的模块时会在 mscorlib.dll 中输出 FileNotFoundException。

我注意到设计器不会从项目的输出路径加载 dll，而是在 %UserData%\VisualStudio\9.0\ProjectAssemblies\ *RandomFolderName*文件夹中创建程序集的副本。但是，没有复制任何模块的依赖项，我认为这是 FileNotFoundException 的来源。

任何想法如何解决这个问题？理想情况下，在将 dll 复制到 ProjectAssemblies 文件夹时，Vistual Studio 会复制所有程序集的依赖项，但我想不出任何方法来实现这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T03:34:08.250

Visual Studio 不知道任何非托管依赖项。您将必须复制 dll 的自己或将它们复制到您的 windows\system32 目录中。

处理此问题的另外两种策略。

1.  用另一个程序集包装这个程序集，并使用 assembly.loadfrom 手动加载您的混合 dll。此函数将为您的混合模式 dll 设置正确的加载目录。

2.  在您的混合程序集中使用 loadlibrary 加载您的本机依赖项 dll，这样您就可以提供它们的路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-18T16:25:54.693

旧线程，但是由于我刚刚遇到该问题并在此过程中发现了此问题，因此将我的解决方案提交给了类似的问题。由于您正在包装控件，因此仅访问类型可能不像我的那样容易修复。

基本上，我只是将本地 DLL 延迟加载到我的包装 C++/CLI 库中。由于包装器的 C++/CLI 部分包含 Visual Studio 和框架使用的接口规范，因此永远不需要或加载本机 DLL。我也在这个问题中回答了更多细节： [https ://stackoverflow.com/a/15481687/34440](https://stackoverflow.com/a/15481687/34440)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T09:22:40.107

尽量不要在将访问文件的控件的构造函数中放入任何内容。如果必须，有时 DesignTime 属性有助于跳过有问题的行。

# java - 在较大的图像中查找已知的子图像

> ID：297762
> 
> 赞同：25
> 
> 时间：2008-11-18T03:13:16.607
> 
> 标签：java, algorithm, image-processing, image-manipulation

**有谁知道在较大图像中定位已知图像的算法（或搜索词/描述）？**

例如

我有一个包含各种按钮和区域（目标）的单个桌面窗口的图像。我还有代码来捕获当前桌面的屏幕截图。我想要一个算法来帮助我在较大的桌面图像中找到目标图像（窗口所在的确切 x 和 y 坐标）。目标图像可能位于较大图像中的任何位置，并且可能不是 100% 完全相同（非常相似但不完全可能是操作系统显示差异的 b/c）

有谁知道这样的算法或算法类？

我发现了各种图像分割和计算机视觉算法，但它们似乎适用于区域的“模糊”分类，而不是在另一个图像中定位特定图像。

***我的目标是创建一个框架，给定一些种子目标图像，可以在桌面上找到“查看”，找到目标区域并“观察”它的变化。***

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-09-26T06:54:37.707

看看我写的论文：[http](http://werner.yellowcouch.org/Papers/subimg/index.html) ://werner.yellowcouch.org/Papers/subimg/index.html 。它非常详细，似乎是唯一一篇讨论如何将傅里叶变换应用于子图像查找问题的文章。

简而言之，如果要使用傅里叶变换，可以应用以下公式：当图像 A 在 dx,dy 上移动时，图像 A 和图像 B 之间的相关性在以下矩阵中给出： C=ifft(fft(A) x conjugate(fft(B))。因此，图像 C 中具有最高值的位置具有最高的相关性，并且该位置反映了 dx,dy。

此结果适用于相对较大的子图像。对于较小的图像，需要做更多的工作，如文章中所述。尽管如此，这种傅立叶变换还是相当快的。它导致大约 3*sx *sy* log_2(sx*sy)+3*sx*sy 操作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-18T03:20:16.250

您说您的图像可能不完全相同，但又说您不想要“模糊”算法。我不确定这些是否兼容。不过，总的来说，我认为您想查看[图像配准](http://en.wikipedia.org/wiki/Image_registration)算法。[有一个名为ITK](http://itk.org/)的开源 C++ 包可能会提供一些提示。[ImageJ](http://rsbweb.nih.gov/ij/)也是一个流行的开源 Java 包。如果您四处逛逛，这两者都至少具有一些可用的注册功能。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-18T04:03:40.563

这是您要使用的代码框架：

```
// look for all (x,y) positions where target appears in desktop
List<Loc> findMatches(Image desktop, Image target, float threshold) {
  List<Loc> locs;
  for (int y=0; y<desktop.height()-target.height(); y++) {
      for (int x=0; x<desktop.width()-target.width(); x++) {
          if (imageDistance(desktop, x, y, target) < threshold) {
              locs.append(Loc(x,y));
          }
      }
   }
   return locs;
}

// computes the root mean squared error between a rectangular window in 
// bigImg and target.
float imageDistance(Image bigImg, int bx, int by, Image target) {
    float sum_dist2 = 0.0;
    for (int y=0; y<target.height(); y++) {
        for (int x=0; x<target.width(); x++) {
            // assume RGB images...
            for (int colorChannel=0; colorChannel<3; colorChannel++) {
                float dist = target.getPixel(x,y) - bigImg.getPixel(bx+x,by+y);
                sum_dist2 += dist * dist;
            }
         }
    }
    return Math.sqrt(sum_dist2 / target.width() / target.height());
} 
```

您可以考虑其他图像距离（参见[类似问题](https://stackoverflow.com/questions/189943/how-can-i-quantify-difference-between-two-images#190061)）。对于您的应用程序，RMS 误差可能是一个不错的选择。

可能有各种 Java 库可以有效地为您计算这个距离。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-30T18:01:12.797

您可以使用此目标区域的独特视觉元素来确定其位置。这些独特的视觉元素就像一个“签名”。示例：独特的图标、图像和符号。如果角落中有独特的元素，这种方法独立于窗口分辨率。对于固定大小的窗口，只需一个元素就足以找到所有窗口坐标。

下面我通过一个使用[Marvin Framework](http://marvinproject.sourceforge.net)的简单示例来说明这个想法。

**独特的元素：**

[![在此处输入图像描述](https://i.stack.imgur.com/YvUr7.png)](https://i.stack.imgur.com/YvUr7.png)
[![在此处输入图像描述](https://i.stack.imgur.com/Vd4XK.png)](https://i.stack.imgur.com/Vd4XK.png)

**程序输出：**

[![在此处输入图像描述](https://i.stack.imgur.com/FlTQR.png)](https://i.stack.imgur.com/FlTQR.png)

**原始图像：**
[window.png](http://marvinproject.sourceforge.net/other/window.png)

**源代码：**

```
import static marvin.MarvinPluginCollection.*;

public class FindSubimageWindow {
    public FindSubimageWindow(){
        MarvinImage window = MarvinImageIO.loadImage("./res/window.png");
        MarvinImage eclipse = MarvinImageIO.loadImage("./res/eclipse_icon.png");
        MarvinImage progress = MarvinImageIO.loadImage("./res/progress_icon.png");

        MarvinSegment seg1, seg2;
        seg1 = findSubimage(eclipse, window, 0, 0);
        drawRect(window, seg1.x1, seg1.y1, seg1.x2-seg1.x1, seg1.y2-seg1.y1);

        seg2 = findSubimage(progress, window, 0, 0);
        drawRect(window, seg2.x1, seg2.y1, seg2.x2-seg2.x1, seg2.y2-seg2.y1);

        drawRect(window, seg1.x1-10, seg1.y1-10, (seg2.x2-seg1.x1)+25, (seg2.y2-seg1.y1)+20);

        MarvinImageIO.saveImage(window, "./res/window_out.png");
    }
    private void drawRect(MarvinImage image, int x, int y, int width, int height){
        x-=4; y-=4; width+=8; height+=8;
        image.drawRect(x, y, width, height, Color.red);
        image.drawRect(x+1, y+1, width-2, height-2, Color.red);
        image.drawRect(x+2, y+2, width-4, height-4, Color.red);
    }
    public static void main(String[] args) {
        new FindSubimageWindow();
    }   
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-03-12T11:30:25.177

我考虑了 Werner Van Belle 的解决方案（因为所有其他方法都非常慢 - 根本不切实际）：

> 用于子图像正确定位的自适应滤波器：基于 FFT 的子图像定位需要图像归一化才能正常工作

我在需要解决方案的地方用 C# 编写了代码，但得到的结果非常不准确。与范贝尔的说法相反，它真的效果不佳，还是我做错了什么？我使用[https://github.com/tszalay/FFTWSharp](https://github.com/tszalay/FFTWSharp)作为 FFTW 的 C# 包装器。

这是我翻译的代码：（C++ 中的原始代码，位于[http://werner.yellowcouch.org/Papers/subimg/index.html](http://werner.yellowcouch.org/Papers/subimg/index.html)）

```
using System.Diagnostics;
using System;
using System.Runtime.InteropServices;
using System.Drawing;
using System.Drawing.Imaging;
using System.IO;

using FFTWSharp;

using unsigned1 = System.Byte;
using signed2 = System.Int16;
using signed8 = System.Int64;

public class Subimage
{
    /**
     * This program finds a subimage in a larger image. It expects two arguments.
     * The first is the image in which it must look. The secon dimage is the
     * image that is to be found. The program relies on a number of different
     * steps to perform the calculation.
     *
     * It will first normalize the input images in order to improve the
     * crosscorrelation matching. Once the best crosscorrelation is found
     * a sad-matchers is applied in a grid over the larger image.
     *
     * The following two article explains the details:
     *
     *   Werner Van Belle; An Adaptive Filter for the Correct Localization
     *   of Subimages: FFT based Subimage Localization Requires Image
     *   Normalization to work properly; 11 pages; October 2007.
     *   http://werner.yellowcouch.org/Papers/subimg/
     *
     *   Werner Van Belle; Correlation between the inproduct and the sum
     *   of absolute differences is -0.8485 for uniform sampled signals on
     *   [-1:1]; November 2006
     */
    unsafe public static Point FindSubimage_fftw(string[] args)
    {
        if (args == null || args.Length != 2)
        {
            Console.Write("Usage: subimg\n" + "\n" + "  subimg is an image matcher. It requires two arguments. The first\n" + "  image should be the larger of the two. The program will search\n" + "  for the best position to superimpose the needle image over the\n" + "  haystack image. The output of the the program are the X and Y\n" + "  coordinates.\n\n" + "  http://werner.yellowouch.org/Papers/subimg/\n");
            return new Point();
        }

        /**
         * The larger image will be called A. The smaller image will be called B.
         *
         * The code below relies heavily upon fftw. The indices necessary for the
         * fast r2c and c2r transforms are at best confusing. Especially regarding
         * the number of rows and colums (watch our for Asx vs Asx2 !).
         *
         * After obtaining all the crosscorrelations we will scan through the image
         * to find the best sad match. As such we make a backup of the original data
         * in advance
         *
         */
        int Asx = 0, Asy = 0;
        signed2[] A = read_image(args[0], ref Asx, ref Asy);
        int Asx2 = Asx / 2 + 1;

        int Bsx = 0, Bsy = 0;
        signed2[] B = read_image(args[1], ref Bsx, ref Bsy);

        unsigned1[] Asad = new unsigned1[Asx * Asy];
        unsigned1[] Bsad = new unsigned1[Bsx * Bsy];

        for (int i = 0; i < Bsx * Bsy; i++)
        {
            Bsad[i] = (unsigned1)B[i];
            Asad[i] = (unsigned1)A[i];
        }
        for (int i = Bsx * Bsy; i < Asx * Asy; i++)
            Asad[i] = (unsigned1)A[i];

        /**
         * Normalization and windowing of the images.
         *
         * The window size (wx,wy) is half the size of the smaller subimage. This
         * is useful to have as much good information from the subimg.
         */
        int wx = Bsx / 2;
        int wy = Bsy / 2;
        normalize(ref B, Bsx, Bsy, wx, wy);
        normalize(ref A, Asx, Asy, wx, wy);

        /**
         * Preparation of the fourier transforms.
         * Aa is the amplitude of image A. Af is the frequence of image A
         * Similar for B. crosscors will hold the crosscorrelations.
         */
        IntPtr Aa = fftw.malloc(sizeof(double) * Asx * Asy);
        IntPtr Af = fftw.malloc(sizeof(double) * 2 * Asx2 * Asy);
        IntPtr Ba = fftw.malloc(sizeof(double) * Asx * Asy);
        IntPtr Bf = fftw.malloc(sizeof(double) * 2 * Asx2 * Asy);

        /**
         * The forward transform of A goes from Aa to Af
         * The forward tansform of B goes from Ba to Bf
         * In Bf we will also calculate the inproduct of Af and Bf
         * The backward transform then goes from Bf to Aa again. That
         * variable is aliased as crosscors;
         */
        //#original: fftw_plan_dft_r2c_2d
        //IntPtr forwardA = fftwf.dft(2, new int[] { Asy, Asx }, Aa, Af, fftw_direction.Forward, fftw_flags.Estimate);//equal results
        IntPtr forwardA = fftwf.dft_r2c_2d(Asy, Asx, Aa, Af, fftw_flags.Estimate);
        //#original: fftw_plan_dft_r2c_2d
        //IntPtr forwardB = fftwf.dft(2, new int[] { Asy, Asx }, Ba, Bf, fftw_direction.Forward, fftw_flags.Estimate);//equal results
        IntPtr forwardB = fftwf.dft_r2c_2d(Asy, Asx, Ba, Bf, fftw_flags.Estimate);
        double* crosscorrs = (double*)Aa;
        //#original: fftw_plan_dft_c2r_2d
        //IntPtr backward = fftwf.dft(2, new int[] { Asy, Asx }, Bf, Aa, fftw_direction.Backward, fftw_flags.Estimate);//equal results
        IntPtr backward = fftwf.dft_c2r_2d(Asy, Asx, Bf, Aa, fftw_flags.Estimate);

        /**
         * The two forward transforms of A and B. Before we do so we copy the normalized
         * data into the double array. For B we also pad the data with 0
         */
        for (int row = 0; row < Asy; row++)
            for (int col = 0; col < Asx; col++)
                ((double*)Aa)[col + Asx * row] = A[col + Asx * row];
        fftw.execute(forwardA);

        for (int j = 0; j < Asx * Asy; j++)
            ((double*)Ba)[j] = 0;
        for (int row = 0; row < Bsy; row++)
            for (int col = 0; col < Bsx; col++)
                ((double*)Ba)[col + Asx * row] = B[col + Bsx * row];
        fftw.execute(forwardB);

        /**
         * The inproduct of the two frequency domains and calculation
         * of the crosscorrelations
         */
        double norm = Asx * Asy;
        for (int j = 0; j < Asx2 * Asy; j++)
        {
            double a = ((double*)Af)[j * 2];//#Af[j][0];
            double b = ((double*)Af)[j * 2 + 1];//#Af[j][1];
            double c = ((double*)Bf)[j * 2];//#Bf[j][0];
            double d = ((double*)Bf)[j * 2 + 1];//#-Bf[j][1];
            double e = a * c - b * d;
            double f = a * d + b * c;
            ((double*)Bf)[j * 2] = (double)(e / norm);//#Bf[j][0] = (fftw_real)(e / norm);
            ((double*)Bf)[j * 2 + 1] = (double)(f / norm);//Bf[j][1] = (fftw_real)(f / norm);
        }
        fftw.execute(backward);

        /**
         * We now have a correlation map. We can spent one more pass
         * over the entire image to actually find the best matching images
         * as defined by the SAD.
         * We calculate this by gridding the entire image according to the
         * size of the subimage. In each cel we want to know what the best
         * match is.
         */
        int sa = 1 + Asx / Bsx;
        int sb = 1 + Asy / Bsy;
        int sadx = 0;
        int sady = 0;
        signed8 minsad = Bsx * Bsy * 256L;
        for (int a = 0; a < sa; a++)
        {
            int xl = a * Bsx;
            int xr = xl + Bsx;
            if (xr > Asx) continue;
            for (int b = 0; b < sb; b++)
            {
                int yl = b * Bsy;
                int yr = yl + Bsy;
                if (yr > Asy) continue;

                // find the maximum correlation in this cell
                int cormxat = xl + yl * Asx;
                double cormx = crosscorrs[cormxat];
                for (int x = xl; x < xr; x++)
                    for (int y = yl; y < yr; y++)
                    {
                        int j = x + y * Asx;
                        if (crosscorrs[j] > cormx)
                            cormx = crosscorrs[cormxat = j];
                    }
                int corx = cormxat % Asx;
                int cory = cormxat / Asx;

                // We dont want subimages that fall of the larger image
                if (corx + Bsx > Asx) continue;
                if (cory + Bsy > Asy) continue;

                signed8 sad = 0;
                for (int x = 0; sad < minsad && x < Bsx; x++)
                    for (int y = 0; y < Bsy; y++)
                    {
                        int j = (x + corx) + (y + cory) * Asx;
                        int i = x + y * Bsx;
                        sad += Math.Abs((int)Bsad[i] - (int)Asad[j]);
                    }

                if (sad < minsad)
                {
                    minsad = sad;
                    sadx = corx;
                    sady = cory;
                    // printf("* ");
                }
                // printf("Grid (%d,%d) (%d,%d) Sip=%g Sad=%lld\n",a,b,corx,cory,cormx,sad);
            }
        }
        //Console.Write("{0:D}\t{1:D}\n", sadx, sady);
        /**
         * Aa, Ba, Af and Bf were allocated in this function
         * crosscorrs was an alias for Aa and does not require deletion.
         */
        fftw.free(Aa);
        fftw.free(Ba);
        fftw.free(Af);
        fftw.free(Bf);
        return new Point(sadx, sady);
    }

    private static void normalize(ref signed2[] img, int sx, int sy, int wx, int wy)
    {
        /**
         * Calculate the mean background. We will subtract this
         * from img to make sure that it has a mean of zero
         * over a window size of wx x wy. Afterwards we calculate
         * the square of the difference, which will then be used
         * to normalize the local variance of img.
         */
        signed2[] mean = boxaverage(img, sx, sy, wx, wy);
        signed2[] sqr = new signed2[sx * sy];
        for (int j = 0; j < sx * sy; j++)
        {
            img[j] -= mean[j];
            signed2 v = img[j];
            sqr[j] = (signed2)(v * v);
        }
        signed2[] var = boxaverage(sqr, sx, sy, wx, wy);
        /**
         * The normalization process. Currenlty still
         * calculated as doubles. Could probably be fixed
         * to integers too. The only problem is the sqrt
         */
        for (int j = 0; j < sx * sy; j++)
        {
            double v = Math.Sqrt(Math.Abs((double)var[j]));//#double v = sqrt(fabs(var[j])); <- ambigous
            Debug.Assert(!double.IsInfinity(v) && v >= 0);
            if (v < 0.0001) v = 0.0001;
            img[j] = (signed2)(img[j] * (32 / v));
            if (img[j] > 127) img[j] = 127;
            if (img[j] < -127) img[j] = -127;
        }
        /**
         * As a last step in the normalization we
         * window the sub image around the borders
         * to become 0
         */
        window(ref img, sx, sy, wx, wy);
    }

    private static signed2[] boxaverage(signed2[] input, int sx, int sy, int wx, int wy)
    {
        signed2[] horizontalmean = new signed2[sx * sy];

        Debug.Assert(horizontalmean != null);
        int wx2 = wx / 2;
        int wy2 = wy / 2;
        int from = (sy - 1) * sx;
        int to = (sy - 1) * sx;
        int initcount = wx - wx2;
        if (sx < initcount) initcount = sx;
        int xli = -wx2;
        int xri = wx - wx2;
        for (; from >= 0; from -= sx, to -= sx)
        {
            signed8 sum = 0;
            int count = initcount;
            for (int c = 0; c < count; c++)
                sum += (signed8)input[c + from];
            horizontalmean[to] = (signed2)(sum / count);
            int xl = xli, x = 1, xr = xri;
            /**
             * The area where the window is slightly outside the
             * left boundary. Beware: the right bnoundary could be
             * outside on the other side already
             */
            for (; x < sx; x++, xl++, xr++)
            {
                if (xl >= 0) break;
                if (xr < sx)
                {
                    sum += (signed8)input[xr + from];
                    count++;
                }
                horizontalmean[x + to] = (signed2)(sum / count);
            }
            /**
             * both bounds of the sliding window
             * are fully inside the images
             */
            for (; xr < sx; x++, xl++, xr++)
            {
                sum -= (signed8)input[xl + from];
                sum += (signed8)input[xr + from];
                horizontalmean[x + to] = (signed2)(sum / count);
            }
            /**
             * the right bound is falling of the page
             */
            for (; x < sx; x++, xl++)
            {
                sum -= (signed8)input[xl + from];
                count--;
                horizontalmean[x + to] = (signed2)(sum / count);
            }
        }

        /**
         * The same process as aboe but for the vertical dimension now
         */
        int ssy = (sy - 1) * sx + 1;
        from = sx - 1;
        signed2[] verticalmean = new signed2[sx * sy];
        Debug.Assert(verticalmean != null);
        to = sx - 1;
        initcount = wy - wy2;
        if (sy < initcount) initcount = sy;
        int initstopat = initcount * sx;
        int yli = -wy2 * sx;
        int yri = (wy - wy2) * sx;
        for (; from >= 0; from--, to--)
        {
            signed8 sum = 0;
            int count = initcount;
            for (int d = 0; d < initstopat; d += sx)
                sum += (signed8)horizontalmean[d + from];
            verticalmean[to] = (signed2)(sum / count);
            int yl = yli, y = 1, yr = yri;
            for (; y < ssy; y += sx, yl += sx, yr += sx)
            {
                if (yl >= 0) break;
                if (yr < ssy)
                {
                    sum += (signed8)horizontalmean[yr + from];
                    count++;
                }
                verticalmean[y + to] = (signed2)(sum / count);
            }
            for (; yr < ssy; y += sx, yl += sx, yr += sx)
            {
                sum -= (signed8)horizontalmean[yl + from];
                sum += (signed8)horizontalmean[yr + from];
                verticalmean[y + to] = (signed2)(sum / count);
            }
            for (; y < ssy; y += sx, yl += sx)
            {
                sum -= (signed8)horizontalmean[yl + from];
                count--;
                verticalmean[y + to] = (signed2)(sum / count);
            }
        }
        return verticalmean;
    }

    private static void window(ref signed2[] img, int sx, int sy, int wx, int wy)
    {
        int wx2 = wx / 2;
        int sxsy = sx * sy;
        int sx1 = sx - 1;
        for (int x = 0; x < wx2; x++)
            for (int y = 0; y < sxsy; y += sx)
            {
                img[x + y] = (signed2)(img[x + y] * x / wx2);
                img[sx1 - x + y] = (signed2)(img[sx1 - x + y] * x / wx2);
            }

        int wy2 = wy / 2;
        int syb = (sy - 1) * sx;
        int syt = 0;
        for (int y = 0; y < wy2; y++)
        {
            for (int x = 0; x < sx; x++)
            {
                /**
                 * here we need to recalculate the stuff (*y/wy2)
                 * to preserve the discrete nature of integers.
                 */
                img[x + syt] = (signed2)(img[x + syt] * y / wy2);
                img[x + syb] = (signed2)(img[x + syb] * y / wy2);
            }
            /**
             * The next row for the top rows
             * The previous row for the bottom rows
             */
            syt += sx;
            syb -= sx;
        }
    }

    private static signed2[] read_image(string filename, ref int sx, ref int sy)
    {
        Bitmap image = new Bitmap(filename);
        sx = image.Width;
        sy = image.Height;
        signed2[] GreyImage = new signed2[sx * sy];
        BitmapData bitmapData1 = image.LockBits(new Rectangle(0, 0, image.Width, image.Height), ImageLockMode.ReadOnly, PixelFormat.Format32bppArgb);
        unsafe
        {
            byte* imagePointer = (byte*)bitmapData1.Scan0;

            for (int y = 0; y < bitmapData1.Height; y++)
            {
                for (int x = 0; x < bitmapData1.Width; x++)
                {
                    GreyImage[x + y * sx] = (signed2)((imagePointer[0] + imagePointer[1] + imagePointer[2]) / 3.0);
                    //4 bytes per pixel
                    imagePointer += 4;
                }//end for x
                //4 bytes per pixel
                imagePointer += bitmapData1.Stride - (bitmapData1.Width * 4);
            }//end for y
        }//end unsafe
        image.UnlockBits(bitmapData1);
        return GreyImage;
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-13T22:49:52.933

你不需要像“神经网络”那样模糊，因为（据我了解）你没有旋转、倾斜或类似的东西。如果操作系统显示差异是唯一的修改，那么差异应该是最小的。所以 WernerVanBelle 的论文很好，但并不是真正必要的，而且 MrFooz 的代码可以工作 - 但效率非常低（`O(width * height * patter_width * pattern_height)`！）。

我能想到的最好的算法是用于字符串搜索的 Boyer-Moore 算法，经过修改以允许二维搜索。 [http://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_string_search_algorithm](http://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_string_search_algorithm)

您必须存储一对位移`dx`和`dy`每种颜色，而不是一个位移。当检查一个像素时，您仅在 x 方向上移动`x = x + dx`并仅存储 dy 的最小值以`DY = min(DY, dy)`在测试整条线后设置新的 y 值（即`x > width`）。

由于可能的颜色数量众多，可能禁止为所有可能的颜色创建表格，因此要么使用地图来存储规则（如果颜色不在地图内，则默认为图案尺寸）或为每种颜色创建表格单独设置`dx = max(dx(red), dx(green), dx(blue))`- 这只是一个近似值，但消除了地图的开销。

在坏字符规则的预处理中，您可以通过将规则从所有颜色传播到它们的“相邻”颜色（但是您希望定义相邻）来解决颜色的小偏差。

# performance - 网站性能测量

> ID：297777
> 
> 赞同：4
> 
> 时间：2008-11-18T03:29:46.997
> 
> 标签：performance, web-applications

我需要一个免费的工具来衡量网站的性能，并且不需要对代码（jsp asp 页面）进行任何更改。感谢所有帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T03:35:22.460

对于性能测量，我推荐你使用[YSlow ，它是一个与](http://developer.yahoo.com/yslow/)[Firebug](http://getfirebug.com)集成的 Firefox 插件，它会分析你的网页并根据[高性能网站的规则](http://developer.yahoo.com/performance/index.html#rules)告诉你为什么它们很慢。

[截屏](https://i.stack.imgur.com/pIzkd.png)

同样使用 Firebug 网络监控选项卡，您可以查看哪些资源需要更多时间和带宽来下载：

[![](https://i.stack.imgur.com/y2P1T.gif)](https://i.stack.imgur.com/y2P1T.gif)
[（来源：[getfirebug.com](http://getfirebug.com/net.gif)）]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T03:58:20.310

您还可以使用适用于 Firefox 以外的浏览器的[Fiddler 。](http://www.fiddlertool.com/fiddler/)（但不会配置 javascript 代码）

看到[这个帖子](http://msdn.microsoft.com/en-us/library/bb250442(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T17:10:53.937

从浏览器的角度来看，这个问题的其他答案侧重于网站单个用户的性能。如果您想测试服务器的性能，例如，查看您可以支持多少并发用户，您需要查看[JMeter](http://jakarta.apache.org/jmeter/)之类的工具。

# sql - 如何使用联接查询两个表并从一个表中获取所有行，并从另一个表中获取相关行？

> ID：297789
> 
> 赞同：3
> 
> 时间：2008-11-18T03:39:15.777
> 
> 标签：sql, join

简化例如，我有两个表，`groups`并且`items`.

```
items (
    id,
    groupId,
    title
)

groups (
    id,
    groupTitle,
    externalURL
) 
```

我的常规查询是这样的：

```
SELECT
    i.`id`,
    i.`title`,
    g.`id` as 'groupId',
    g.`groupTitle`,
    g.`externalURL`
FROM
    items i INNER JOIN groups g ON (i.`groupId` = g.`id`) 
```

但是我现在需要修改它，因为所有指定 an 的组`externalURL`在表中都没有任何相应的记录`items`（因为它们存储在外部）。是否可以进行某种连接以使输出看起来像这样：

```
items:
id    title    groupId
----------------------
1     Item 1   1
2     Item 2   1

groups
id    groupTitle    externalURL
-------------------------------
1     Group 1       NULL
2     Group 2       something
3     Group 3       NULL

Query output:
id    title    groupId    groupTitle    externalURL
---------------------------------------------------
1     Item 1   1          Group 1       NULL
2     Item 2   1          Group 1       NULL
NULL  NULL     2          Group 2       something

-- note that group 3 didn't show up because it had no items OR externalURL 
```

这可能在一个 SQL 查询中实现吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-18T03:42:44.910

这正是外连接的用途：返回一个表中的所有行，无论另一个表中是否存在匹配行。在这些情况下，为另一个表的所有列返回 NULL。

您可以在 WHERE 子句中处理的另一个条件。

```
SELECT
    i.`id`,
    i.`title`,
    g.`id` as 'groupId',
    g.`groupTitle`,
    g.`externalURL`
FROM
    items i RIGHT OUTER JOIN groups g ON (i.`groupId` = g.`id`)
WHERE i.`id` IS NOT NULL OR g.`externalURL` IS NOT NULL; 
```

仅当*两者* `i.id`都`g.externalURL`为 NULL 时，才应排除连接结果集的整行。

# css - 特定于站点：Firefox 与 IE CSS 特性

> ID：297793
> 
> 赞同：1
> 
> 时间：2008-11-18T03:42:06.580
> 
> 标签：css, internet-explorer, firefox

我正在尝试学习 CSS。我费了很大的力气才把一切都做好。我的页面都经过验证，它们在 Firefox 上看起来是正确的，在 Chrome 上大部分是正确的。然而，IE 无处不在。关于 Firefox，以下在 IE 中是错误的（按重要性排序）：

1.  主体框被推到左侧框结束的位置下方
2.  右上角的下拉内容（鼠标悬停在“设置”上）在杂草中完全关闭（它在 Chrome 中也关闭，但方式不同）
3.  “食谱”选项卡应该没有可见的底部边框
4.  搜索按钮相对于搜索框歪斜
5.  登出版本：右上角的登录元素是歪斜的

[登录](http://www.mcrackan.com/recipes/csstest-loggedin.htm), [注销](http://www.mcrackan.com/recipes/csstest-loggedout.htm), [CSS](http://www.mcrackan.com/recipes/css/default.css) ,

不保证链接、功能等在这些页面上有效。它只是显示布局的静态快照。

任何人都可以为我做错什么指出正确的方向吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T04:34:08.630

你需要重置你的 CSS（Dean，上面推荐 Eric Meyer 的重置 CSS）。我更喜欢[Yui Reset CSS](http://developer.yahoo.com/yui/reset/)（我其实很喜欢他们自己的 Reset / Fonts / Grids CSS）。作为这样做的一部分，您还需要使用标准模式。

最后，您需要注意，无论如何浏览器中的某些内容都会有所不同。因此，如果您遇到这种情况，要么解决它，要么忍受它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T04:03:29.660

你运行的是什么版本的IE？听起来您的大多数问题可能是由[IE Box Model](http://www.google.com/search?q=IE+Box+Model) Bug 引起的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T04:09:25.543

[如果不首先使用Eric Meyer 的 Reset CSS](http://meyerweb.com/eric/tools/css/reset/index.html) ，我从不会在 CSS 中开始新的网站设计。

它重置了所有浏览器中的所有差异，这样您就有了一个公平的竞争环境。从那时起，所有浏览器中的一切都应该相同。

# asp.net - jQuery 的 $.ajax() 函数是否正确处理 ASP.NET 身份验证？

> ID：297794
> 
> 赞同：3
> 
> 时间：2008-11-18T03:42:11.463
> 
> 标签：asp.net, jquery, ajax, web-services

我有一个受 ASP.NET 表单身份验证保护的 Web 应用程序。该站点使用 jQuery 的 $.ajax() 功能在同一个应用程序中调用 Web 服务。

浏览到 Web 服务 .asmx 确实会启动表单身份验证，我一旦通过身份验证并对服务器进行 $.ajax() 调用，我还看到 ASP.NET 会话 cookie 和表单身份验证 cookie 被回发到服务器提琴手。

所以......虽然一切看起来都很好，但我想放心，当使用 $.ajax 从 Web 应用程序中的任何页面调用 Web 服务时，确实会受到 ASP.NET 表单身份验证的保护()。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T04:05:50.807

从服务器的角度来看，ajax 请求与普通的 GET/POST 请求没有太大区别——只是在请求中添加了一些额外的标头。它通过您的正常身份验证例程，与任何其他请求相同 - 如果不是这种情况，您应该更加担心应用程序的整体安全性，因为知道自己在做什么的人可以很容易地伪造请求.

您可以轻松地设置测试以查看需要身份验证的资源是否成功阻止了 Ajax 到达的未经授权的请求。这应该让你放心。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T03:55:54.853

只要您在服务器上检查用户是否经过身份验证，那么是的，您应该受到保护。我正在使用 $ajax 来调用 PageMethods 和调用 ASP.Net WCF 服务，并且看起来不错。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-05T11:17:26.513

它将受到保护，但请注意当您的身份验证过期并且表单身份验证重定向回登录 url 并返回 302 FOUND 响应时会发生什么。

# java - Java 线程优先级如何转换为 OS 线程优先级？

> ID：297804
> 
> 赞同：9
> 
> 时间：2008-11-18T03:48:20.330
> 
> 标签：java, multithreading, operating-system

java API线程优先级（1-10）如何转换为操作系统级别的优先级，因为大多数操作系统没有与此匹配的线程优先级（以数量计）。

所以请记住，是否存在两个或多个具有不同优先级的线程最终在操作系统级别获得相同优先级的情况。

请澄清，如果我的理解有一些更正。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-18T04:14:10.447

实际上，某些优先级可以映射到相同的“本机”优先级。以下是列表（基于 OpenJDK 6 中的 Hotspot 代码）：

## 索拉里斯

*   1 ⇒ 0
*   2 ⇒ 32
*   3 ⇒ 64
*   4 ⇒ 96
*   5 – 10 ⇒ 127

值得注意的是，在 Solaris 上，您不能将线程优先级提高到高于正常值，只能降低它：5 的优先级值与任何更高的值相同。

## Linux

*   1 – 10 ⇒ 4 – -5（`nice`数值）

值得注意的是，在 Linux 上，Java 中不同的线程优先级确实映射到本机级别的不同优先级值。

## 视窗

*   1 – 2 ⇒`THREAD_PRIORITY_LOWEST`
*   3 – 4 ⇒`THREAD_PRIORITY_BELOW_NORMAL`
*   5 – 6 ⇒`THREAD_PRIORITY_NORMAL`
*   7 – 8 ⇒`THREAD_PRIORITY_ABOVE_NORMAL`
*   9 – 10 ⇒`THREAD_PRIORITY_HIGHEST`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T10:30:55.447

您的理解是正确的——Java 线程优先级并没有完全映射到 OS 线程优先级。

结果，如果您的算法以任何方式依赖于线程优先级映射的细节，那么它就会被破坏，因为它会根据如此多的变量而变化。例如，升级您的 JRE 或将补丁/服务包应用到您的操作系统可能会破坏它 - 当然，只是在不同的操作系统上运行也会产生后果。

除非在非常不寻常的情况下，仅使用两个优先级就足够了 - 正常和低。大多数工作将在普通线程中完成。低优先级应该保留给不能让正常优先级的线程饿死的线程，而只是狼吞虎咽并且不使用处理器能力。

虽然您可以选择比这更细粒度，但您需要注意目标平台上可能会丢失任何更详细的信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-30T06:14:23.640

我不太确定 Linux 上的 Sun JVM。编写了一个快速的 Java 程序，以每个优先级生成 10 个线程，并使用 BigDecimals 计算 pi（4*atan(1) 方法），每次 500,000 次，加入每个线程并报告运行方法的经过时间。是的，可能不是最好的例子，但保持基本。

```
$uname -r && grep bogomips /proc/cpuinfo
2.4.33.3
bogomips        : 4312.26
$java -version 2>&1 |head -1
Java version "1.6.0_01"
$javac T.java && java -Xmx32m T
1:3112
2:2636
3:2662
4:3118
5:2870
6:3319
7:3412
8:3304
9:3299
10:3069 
```

看起来不像人们期望的那样有太大的偏差！那是在一个小型虚拟 Linux 机器上。让我们在一个真正的平板上试一试，以防万一，这个盒子也相当活跃，平均负载很少低于 7，让我们看看我们如何在这样的环境中调度：

```
$uname -r && grep bogomips /proc/cpuinfo
2.6.9-67.ELsmp
bogomips        : 3992.93
bogomips        : 3990.00
$java -version 2>&1 |head -1
java version "1.4.2_14"
$javac T.java && java -Xmx32m T
1:63200
2:64388
3:62532
4:58529
5:62292
6:64872
7:64885
8:64584
9:61653
10:61575 
```

嗯，这里变化不大，不知道1.4是否甚至映射线程。让我们尝试一个 windows 盒子。我知道 Windows 有一个相当激进的线程优先级架构。任何高于*正常*轶事的东西都会消耗更多。因此，让我们在每个线程中增加 900,000 次迭代：

```
C:\>java -version
java version "1.6.0_11"
C:\>java -Xmx32m T
1:12578
2:12625
3:11469
4:11453
5:10781
6:8937
7:10516
8:8406
9:9953
10:7391 
```

非常我们正在寻找的东西，不是吗？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-18T04:02:50.987

由于我们谈论的是线程，我认为这永远不会直接到达操作系统。优先级可能是 JRE 关于如何调度每个线程的 CPU 时间的提示。要处理您的示例，需要某种“打破平局”算法。

基本上，这将在操作系统进程优先级之上，除非 JRE 使用 POSIX 之类的第 3 方线程标准，而不是在内部实现所有内容。

# c++ - C++ 中类的全局实例

> ID：297822
> 
> 赞同：11
> 
> 时间：2008-11-18T04:05:25.677
> 
> 标签：c++, singleton

正如标题所说。我将如何创建一个全局可用的类的实例（例如，我有一个用于打印的函子，我想拥有一个全局实例（尽管有可能创建更多））。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-18T04:18:58.927

使用通常的模式制作单例对象的所有努力并没有解决您问题的第二部分 - 如果需要，能够制作更多。单例“模式”的限制性非常强，只不过是另一个名称的全局变量。

```
// myclass.h

class MyClass {
public:
    MyClass();
    void foo();
    // ...
};

extern MyClass g_MyClassInstance;

// myclass.cpp

MyClass g_MyClassInstance;

MyClass::MyClass()
{
    // ...
} 
```

现在，在任何其他模块中只需像往常一样包含`myclass.h`和使用。`g_MyClassInstance`如果你需要做更多，有一个构造函数可供你调用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T06:22:06.367

First off the fact that you want global variables is a 'code smell' (as Per Martin Fowler).

But to achieve the affect you want you can use a variation of the Singleton.
Use static function variables. This means that variable is not created until used (this gives you lazy evaluation) and all the variables will be destroyed in the reverse order of creation (so this guarantees the destructor will be used).

```
class MyVar
{
    public:
        static MyVar& getGlobal1()
        {
            static MyVar  global1;
            return global1;
        }
        static MyVar& getGlobal2()
        {
            static MyVar  global2;
            return global2;
        }
        // .. etc
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T04:18:26.227

作为对单例模式的轻微修改，如果您确实希望允许创建更多具有不同生命周期的实例，只需将 ctors、dtor 和 operator= 设为 public。这样就可以通过 GetInstance 获得单个全局实例，但也可以在堆或堆栈上声明相同类型的其他变量。

然而，基本思想是单例模式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T05:54:33.443

单例模式使用起来很不错，但它也有自己的缺点。在使用单例之前，请阅读 Miško Hevery 的以下博客。

1.  [单身人士是病态的骗子](http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/)

2.  [单身人士的根本原因](http://misko.hevery.com/2008/08/25/root-cause-of-singletons/)

3.  [所有单身人士都去哪儿了？](http://misko.hevery.com/2008/08/21/where-have-all-the-singletons-gone/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T04:08:35.903

[Singleton 模式](http://en.wikipedia.org/wiki/Singleton_pattern)是您正在寻找的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T05:30:29.967

最简单且并发安全的实现是 Scott Meyer 的单例：

```
 #include <iostream>

class MySingleton {
public:
    static MySingleton& Instance() {
        static MySingleton singleton;
        return singleton;
    }
    void HelloWorld() { std::cout << "Hello World!\n"; }
};

int main() {
    MySingleton::Instance().HelloWorld();
} 
```

有关John Vlissides（来自 GoF 名声）的分析，请参见[此处](http://www.research.ibm.com/designpatterns/pubs/ph-jun96.txt)的主题 IV 。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-18T07:29:31.583

I prefer to allow a singleton but not enforce it so in never hide the constructors and destructors. That had already been said just giving my support.

My twist is that I don't use often use a static member function unless I want to create a true singleton and hide the constr. My usual approach is this:

```
template< typename T >
T& singleton( void )
{
   static char buffer[sizeof(T)];
   static T* single = new(buffer)T;
   return *single;
}

Foo& instance = singleton<Foo>(); 
```

为什么不使用 T 的静态实例而不是放置 new？静态实例提供构造顺序保证，但不提供破坏顺序。大多数对象以相反的构造顺序被销毁，但静态和全局变量。如果您使用静态实例版本，您最终会在 main 结束后得到神秘/间歇性的段错误等。

这意味着永远不会调用单例析构函数。但是，无论如何，进程都会下降，资源将被回收。这有点难以习惯，但相信我，目前没有更好的跨平台解决方案。幸运的是，C++0x 进行了更改以保证销毁顺序，这将解决这个问题。一旦您的编译器支持新标准，只需升级单例函数以使用静态实例。

另外，我在实际实现中使用 boost 来获得对齐的内存而不是普通字符数组，但不想使示例复杂化

# tracking - 记录和跟踪编程错误的有效方法是什么？

> ID：297838
> 
> 赞同：10
> 
> 时间：2008-11-18T04:15:00.663
> 
> 标签：tracking

有时我听到人们讨论跟踪编程错误的好处，如果不是为了提高对常见错误的认识的话。我已经开始保留我在代码中发现的错误列表，以及可能导致这些错误的原因。我的主要问题是：

*   我应该跟踪哪些与我的错误相关的信息，以便我可以提高程序员的水平？

还有一些与此相关的其他问题：

*   一旦我开始记录我的错误，我该如何使用这些信息？
*   跟踪错误真的有用吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T04:23:53.127

这仅在您对跟踪和审查保持警惕时才有用。当我在一个团队工作时，无论有多少记录，例如我们在生产环境中的服务器被 nat，无法解析自己的域名或公共 IP 地址，每 6 个月，我都会接到一个电话凌晨 4 点，来自新开发人员负责的部署团队或开发团队，他们要么忘记了，要么不知道。

我记得一位负责部署的工程师，他有纸质清单，我们为他构建了部署工具，迫使他记录清单，但他总是忘记设置连接字符串（导致凌晨 4 点的电话）。关键是只有当你要警惕地使用它时才值得。

我发现使用它的最佳方法是将您的规则实施到像 fxcop 这样的代码分析器中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T04:30:06.767

我认为，比记录单个错误更有用的是确保你一开始就真正理解了为什么这是一个错误。大多数错误源于对一件事或另一件事缺乏理解，纠正这种理解，你就可以消除未来的一整套潜在错误。如果我要记录任何东西，那将是我从以前不知道的经验中学到的东西，而不是所犯错误的细节，当你稍后回顾它时，它的用处可能有限。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T04:20:09.220

*   出了什么问题
*   如何避免

将后者添加到适当的清单中，并酌情经常参考

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-18T04:26:47.023

我认为跟踪错误*可能*是值得的，但根据我的经验，在某种程度上对它们进行分类很有帮助。

每个程序员在他们的职业生涯中都会犯足够多的错误来填满一本百科全书。如果您从所有这些清单中制作出一个巨大的清单，那么您将永远无法完成任何编码，因为您最终将花费所有时间来查看清单。所以：以某种对你有意义的方式对你的错误进行分类，这样你就可以浏览你的列表，查看你当前正在处理的代码中最重要的错误。

此外，就收集的内容而言，要添加到上述内容：

*   错误的症状是什么（以便您稍后找到）
*   你实际上是如何解决的

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-18T05:26:02.160

是的，跟踪您的个人错误是有益的。请参阅[SEI](http://www.sei.cmu.edu/)以获取大量数据点（[这里是](http://www.sei.cmu.edu/cmmi/results/org6.html)随机的一个）。一种这样的方法是[个人软件过程 (PSP)](http://www.sei.cmu.edu/tsp/)。进入这里太长了，但[这里有一本关于它的书](http://www.sei.cmu.edu/publications/books/process/psp-self-improvement.html)。PSP上还有[这个免费的 SEI 出版物](http://www.sei.cmu.edu/pub/documents/05.reports/pdf/05sr003.pdf)。

如果您对 SEI 犹豫不决并认为敏捷是要走的路，那么您可能会从诸如[Clean Code: A Handbook of Agile Software Craftsmanship（出版商网站）](http://www.informit.com/store/product.aspx?isbn=0132350882)之类的书中获得更好的成果。

底线：有纪律的开发人员 = 好，没有纪律的开发人员 = 坏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T04:24:40.473

我还想问一个问题，准确跟踪错误需要多少时间，以及是否可以更好地将这些时间直接用于改进软件。如果您可以在最短的时间内完成此操作，并且能够回顾您的记录以防止将来出现错误，那么它可能很有价值。但从长远来看，我认为最好坚持一个绝对高水平的常见错误列表。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-18T04:28:42.307

我会寻找倾向于重复出现的趋势或类似类型的错误。一旦你意识到你犯的错误*类型*，你就可以对它们保持警惕，或者你可以改变你的编码风格来避免它们。

例如，我在前世与我的办公室同事密切合作。有一次，我解释了一些奇怪的行为的第一句话讲到一半时，他打断了“增加你的计数器”。我今天*仍然*仔细检查我的循环计数器！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T05:18:52.220

与其记录未来的错误，也许您可​​以查看您的 bugtracker 历史记录，并尝试找出不断发生的常见错误类型。

我很受启发，我想我明天会试试这个。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-18T11:42:31.340

“我应该跟踪哪些与我的错误相关的信息，以便我能够提高程序员的水平？”

阅读其他人的博客。写你自己的。您不必发布它。但是你必须把每一个错误变成一个故事。

不要淹没在元数据中。这不适用于数据库甚至错误跟踪器。错误是某人做出错误选择并从中恢复过来的故事。

这是你的大纲。

*   语境。发生了什么事。
*   情况。你试图解决的问题。
*   你做了什么。为什么不好。
*   你应该做的。为什么会更好。
*   发生了什么变化。你学到了什么。

您还应该以几乎相同的形式记录您的成功。

*   语境。发生了什么事。
*   情况。你试图解决的问题。
*   你做了什么。为什么很好。
*   你学到了什么。

有疑问时看电影。严重地。角色面临选择，犯错误并从错误中恢复。那个故事情节是戏剧的精髓。错误是一样的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-31T11:25:00.367

我一直在想同样的事情。目前我保留了一个小电子表格，其中包含我纠正的错误。这样做的目的是让自己意识到更常见的错误。

希望我会开始看到模式并避免一次又一次地犯常见的错误。

我发现这让我的工作更有趣，可能是因为我是一个喜欢以结构化方式收集数据和信息的分析人员。

您应该尝试将错误与使用*不充分的工具、习惯、方法或知识*联系起来。在大多数情况下，您会发现有一些方法可以更早地捕获错误。我想到了类型安全、单元测试、代码审查、编码标准、更好的 API 设计、更好的文档和工作环境之类的东西。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-18T12:19:10.343

小心你记录的内容。并非所有糟糕的情况都是错误的。有些情况是不可避免的，或者远远超出您的控制范围，以至于无能为力。

别人的糟糕计划让你陷入恐慌不是你的错误。你可以一丝不苟地记录其他人的错误，但有什么意义呢？如果您正在跟踪其他人在做什么，您应该寻求治疗。

提供不充分的预算、时间表或有关变更的沟通的不良计划可能是一个复杂的问题。

1.  您没有预先提供足够的计划信息。
2.  在争先恐后的应对中，你犯了另一个错误，导致问题的解决和恢复。

事后看来（总是 20/20），您可以看到一个错误的决定。但是，*当时*，它是基于最佳可用信息。这不是一个错误。任何以“如果我们知道 X...”开头的句子对于错误分析都是无用的。您可以尝试编写一份清单，列出下次做出该决定时需要了解的所有事项。但是下一次，您将不会做出确切的决定，并且会丢失一些其他信息。

*   永远不要说别人的行为是错误的。
*   找出根本原因。当它是你无法控制的事情时，这是一个根本原因。
*   不要追溯调用出现错误的信息。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-01-19T11:35:15.843

我将 JIRA 与自定义工作流程一起使用。对于错误，关闭问题之前的最后一步是允许我选择“根本原因”的屏幕。我已经了解了我最近构建的 3 个系统中出现的每个错误的根本原因。

# c# - 我可以使用 MediaPlayer 播放流中的声音吗？或者，我可以使用 URI 来访问文件流吗？

> ID：297839
> 
> 赞同：2
> 
> 时间：2008-11-18T04:15:08.620
> 
> 标签：c#, uri, filestream, windows-media-player

我`System.Windows.Media.MediaPlayer`用来播放一些声音，我想从 ZIP 文件中加载这些声音。如果能够直接从 zip 文件中将这些文件作为流加载，而不必解压缩到临时目录，那就太好了。但是，`MediaPlayer.open`只接受一个 URI。

那么，有没有办法创建一个引用流内容的 URI？类似于内存中的本地主机？是否有从 Stream 到 URI 的连接器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-19T00:58:52.073

Since you need to support polyphony, one approach is to PInvoke into the waveOutXXXX Windows API in order to play the sounds. Here is a good example of how to do this in C#:

[https://www.codeproject.com/KB/audio-video/cswavplay.aspx](https://www.codeproject.com/KB/audio-video/cswavplay.aspx)

This example also has code for reading info like duration, sample rate, bits per sample etc.

If you search, you may find claims that the waveOutXXXX API can only play one sound at a time. This was true in Windows 95/98, but is not true any longer.

By the way, SoundPlayer is probably the most frustrating .NET class. The .Play() method automatically stops playback of any other sound played by your process (it might be any other sound played by any .NET app) before starting, which is why you can't do polyphony with it. It would have taken Microsoft's worst intern less than a minute to add a .DontStopJustPlay() method or a StopFirst bool parameter to the .Play() method. It might have taken him until lunch time to add a Duration property.

Although waveOutXXXX is trickier than you would want from a well-designed modern API (and using it in .NET introduces additional problems), the one unmatched advantage it has is that it's come pre-installed on every single Windows computer since Windows 95, including Windows Mobile devices. Every other option (including MediaPlayer) means somebody will always have to install something.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T05:31:33.193

System.Media.SoundPlayer 应该做你需要的（你可以完全跳过 MediaPlayer 和 URIs）。它有一个接受流的构造函数。

# oracle - 如何使用 Oracle 清理死连接？

> ID：297840
> 
> 赞同：3
> 
> 时间：2008-11-18T04:15:17.217
> 
> 标签：oracle

现在，我正在针对 Oracle 数据库开发一些新的应用程序，有时它们会崩溃或无法正确结束，等等……无论如何，问题是它们有时似乎使它们的连接保持打开状态，我需要在它们之后进行清理。我的问题是，是否有办法从数据库方面确定死连接并清理它们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T04:53:06.593

这是一个参考您可以在[Oracle 11g](http://download.oracle.com/docs/cd/B28359_01/java.111/e10788/optimize.htm#sthref181)中设置的连接超时参数的页面。我认为“放弃连接超时”是您正在寻找的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T05:21:53.447

你可能也有兴趣杀死他们。在 SQL*Plus 中运行这个脚本会给你一个“kill”语句的列表。您可以根据 sid 选择要杀死的那些并运行它们。Oracle 有一些它自己的内部连接，不要杀死它们。

```
SELECT 'alter system kill session ''' || sid || ',' || serial# || ''';     ' || sql_id death
FROM v$session
/ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T14:14:11.237

我相信您正在寻找 SQLNet.ora 参数[EXPIRE_TIME](http://download.oracle.com/docs/cd/B19306_01/network.102/b14213/sqlnet.htm#sthref479)，它告诉数据库每隔几分钟向客户端发送一次探测，以验证连接是否仍然存在。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-06-19T12:27:09.300

以下是如何识别要终止的会话（您将需要 SID 和 SERIAL# 来终止它）。我应该提到你需要确保你正在杀死正确的会话吗？`sys_context('userenv','sid')`获取您自己的会话的 SID。

```
SELECT s.inst_id,
       s.sid,
       s.serial#,
       p.spid,
       s.username,
       s.osuser,
       s.program
FROM   gv$session s
JOIN gv$process p ON p.addr = s.paddr AND p.inst_id = s.inst_id
WHERE  s.type != 'BACKGROUND'; 
```

然后，您可以`alter system kill session '[sid],[serial#]'`按照 WW 的建议发布。

但是，该`alter system kill session`命令不会强行终止会话，而是要求会话终止。如果会话真的挂了，你会发现请求挂了 60 秒然后返回`ORA-00031 Session marked for kill`。会话仍然存在。

在这种情况下，首先检查会话没有回滚大型事务（交叉引用上面的 SID 和 SERIAL#）：

```
SELECT s.username,
       s.osuser,
       s.sid,
       s.serial#,
       t.used_ublk,
       t.used_urec,
       rs.segment_name,
      r.rssize,
       r.status
FROM   v$transaction t,
       v$session s,
       v$rollstat r,
       dba_rollback_segs rs
WHERE  s.saddr = t.ses_addr
AND    t.xidusn = r.usn
AND    rs.segment_id = t.xidusn
ORDER BY t.used_ublk DESC; 
```

如果事务正在回滚，您将看到 USED_UREC 减少。让它完成回滚。

否则，`ALTER SYSTEM DISCONNECT SESSION '[sid],[serial#]' IMMEDIATE;`将强制断开会话并回滚打开的事务。

以上所有信息均来自[这里](http://www.oracle-base.com/articles/misc/killing-oracle-sessions.php "这里")。

# php - 难道真的不能写一个php cli密码提示在windows中隐藏密码吗？

> ID：297850
> 
> 赞同：5
> 
> 时间：2008-11-18T04:21:47.407
> 
> 标签：php, passwords

我花了几个小时试图找到一种在 php 中编写跨平台密码提示的方法，以隐藏用户输入的密码。虽然这可以通过使用 stty -echo 在 Unix 环境中轻松完成，但我尝试了各种 passthru() 和 system() 调用方法来使 Windows 执行相同的操作，但无济于事。

我试过了：

```
passthru('set /p pass=Password: ');
system('echo %pass% > out.txt');
$pass = file_get_contents('out.txt', 'r'); 
```

这似乎挂在 passthru('set /p pass=Password: '); 不允许我输入任何文本的行，必须用 Ctrl-c 杀死。

我还尝试了各种 fgetc 和 fgets 方法以及打印退格字符来隐藏输入，因为这适用于其他语言。但是，PHP 似乎无法在回车之前与文本交互。

我真的很想找到一种方法来完成这项工作，这是一项不可能完成的任务还是可以完成的事情？

请注意，我知道我可以将 php 脚本包装在批处理文件中并将密码作为命令行参数传递，但在这种情况下这对我不起作用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T05:41:26.480

PHP 似乎没有 IOCTL 或 STTY 扩展。[我在这里](http://www.usenet-forums.com/php-language/35386-hide-password-input-cli-php-script.html)找到了以下技巧：

```
<?php
echo 'Password: ';
$pwd = preg_replace('/\r?\n$/', '', `stty -echo; head -n1 ; stty echo`);
echo "\n";
echo "Your password was: {$pwd}.\n";
?> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T16:46:42.550

这是一个 Windows 解决方案，使用 PHP 的 COM 扩展。我在 Windows XP 上使用 PHP 5.2.6 对此进行了测试。

```
<?php

$pwObj = new Com('ScriptPW.Password');

print "Password: ";
$passwd = $pwObj->getPassword();

echo "Your password is $passwd\n";

?> 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-18T06:34:40.010

我认为你不能用标准库在 PHP 中做到这一点，但你可以做得更好：

抓住第一个字母，然后显示 *。抓住第二个，然后显示两个 *...

从人体工程学上讲，这很方便，因为用户可以看到他输入的内容。安全性没有风险，因为如果有人可以一个字母一个字母地看到密码，那么他无论如何都可以看到那个人在键盘上输入密码。但它仍然可以防止有人在一次意外中看到它。

# xml - 从 NDFD SOAP 响应中收集数据

> ID：297853
> 
> 赞同：1
> 
> 时间：2008-11-18T04:25:26.183
> 
> 标签：xml, soap, wsdl

我编写了一个从 National Digital Forecast Database [NDFD](http://www.weather.gov/xml/)检索数据的小型应用程序，并且目前正在正确接收 XML 响应。我注意到虽然我可以使用 WSDL2Java 工具来创建接口以请求天气数据，但当我实际使用接口获取天气数据时，它会以 XML 字符串的形式返回。除了解析之外，是否有一种更简洁的方法可以以编程方式从生成的 XML 中获取天气数据？例如，是否有可用的 Java 接口，以便我可以调用诸如 weatherData.getTemp() 之类的东西，而不是遍历 XML 本身？

请注意，这是我第一次使用 SOAP，所以如果我明显忽略了某些内容，请告诉我。

更新：
这是我正在使用的[wsdl 。](http://www.weather.gov/forecasts/xml/DWMLgen/wsdl/ndfdXML.wsdl)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-03-22T11:27:53.617

假如说：

*   你用java

*   调用 Web 服务操作返回的 XML 字符串符合 XML 模式

那么你可以使用[XMLBeans](http://xmlbeans.apache.org/)：

*   从 XML Schema 开始，XMLBeans 生成 java 类，让您以编程方式遍历和操作兼容的 XML

*   您将生成的类添加到您的 java 项目中

*   当你得到Web服务的响应时，你可以通过解析它来构造一个对应的XMLBean对象

*   最后，您可以使用 java getter 访问 XML 属性（如“temp”）

假设这`weatherData`是 XMLSchema 中的复杂类型，那么您将能够像

```
String xmlResponse = getWebServiceResponse();
YourXmlDocument doc = YourXmlDocument.Factory.parse(xmlResponse);
doc.getWeatherData().getTemp(); 
```

警告：这在很大程度上取决于 XML 模式的结构，因此代码可能完全不同。但是，XMLBeans 通常非常易于使用。

这个解决方案的一个缺点是，如果 XML Schema 发生变化，那么您必须重新生成您的类，并重新编译您的代码。希望对于稳定的 XML Schema，这种情况不会经常发生。

# database-design - 如何在任何 SQL 数据库中最好地设计地址位置？

> ID：297855
> 
> 赞同：5
> 
> 时间：2008-11-18T04:27:27.003
> 
> 标签：database-design

*概述*

我正在为加利福尼亚开发一些紧急服务报告和地图应用程序（有点奇怪，考虑到那里的火灾，现在......）。我们需要为内部政府单位绘制人口统计和紧急数据。

我们拥有的是加利福尼亚的*所有*街道、城市和社区。每个社区也有它相关的 shapefile（定义它的边界的纬度）。这是美国人口普查局（所有公共领域的东西）网站给我们的。

*问题*

我不确定如何最好地设计数据库表。我们还没有被告知我们需要使用哪种类型的数据库......所以如果有帮助，我们愿意接受建议。我们有使用 MS SQL 2005 和 2008（以及 08 年的空间材料）的经验。

我们可以有以下合法数据。

*   街道、城市、州
*   市，州
*   邻里，州
*   状态

State 之所以是合法地点，是因为我们被告知这可能会出售给其他州，所以我们现在需要为此做好计划。

所以，一开始，我是这么想的……

*   LocationId INTEGER PK 身份
*   街道 NVARCHAR(100)
*   邻域 NVARCHAR(100)
*   城市 NVARCHAR(100)
*   状态 NVARCHAR(100)
*   纬度 VARCHAR(15)
*   经度 VARCHAR(15)
*   形状文件

顺便说一句，这些都不是可以为空的。但是不久之后，我认为在字段中放置这么多“加利福尼亚”文本或“圣地亚哥”文本是一种浪费。因此，我通过使 Neighborhood、City 和 State 字段成为他们自己的新表的外键（例如查找）来更改表以更加规范化......并且这两个字段现在是 NULLABLE。

所以..一切正常。除非我尝试对它们执行一些 Sql 语句。由于 NULLABLE FK，进行所有这些外部连接查询是一场噩梦 :(

让主表、子查找表（例如社区、城市和州）通过 ID 链接然后将所有这些放在视图中怎么样？请记住，NeighborhoodID 和 CitiyID 将是 NULLABLE.. ???

我只是想看看人们对此的想法以及他们提出建议的*原因。*我真的很担心和困惑，但渴望学习。

请帮忙！

* * *

编辑 1：我需要坚持使用 RDBMS 数据库。

编辑 2：我正在考虑使用约束条件的单个表（非规范化）以保持字段的总和 unqiue 或在主表上具有可为空 FK 的多表（例如位置（主表）、社区、城市, 状态...规范化的数据库模式）。

编辑 3：将城市添加到示例中，第二个列表。

编辑 4：添加了视图问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T00:59:13.413

举个例子：

*   街道、城市、州
*   市，州
*   邻里，州
*   状态

首先回到基本原则，以上都是不同的地理空间实体，所以你的地址是由一个名称和一个或多个地理空间说明符组成的。这告诉我们，我们真的应该将它们存储在一个表中。这里的关键是更抽象地考虑数据，

因此，您的地址表需要与另一个名为 address_entities 的表建立一对多关系，如下所示：

*   整数ID
*   varchar() 名称
*   varchar() 类型
*   整数父ID
*   地理位置。
*   整数父ID

这意味着您显然需要一个表来将地址链接到上面的地址实体表。现在，每个地理空间实体本质上都是分层的，虽然它使 SQL 更难，但我个人尽量避免自引用表，有时它是一个很好的解决方案，这就是其中之一。

好处是巨大的，即使它使代码变得更难，但从长远来看还是值得的。

此外，即使不是即时要求，从全局考虑，并非世界上所有地址都有街道或州，例如，在法国，有效地址可能是

```
- la Maison des Fou
- 24500 Eymet 
```

因此，在设计模式时请记住这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T06:33:48.653

正如@Oddthinking 在评论中指出的那样，您的问题始于：

> 因此，我通过使 Neighborhood、City 和 State 字段成为他们自己的新表的外键（例如查找），将表更改为更加规范化......并且这两个字段现在为 NULLABLE。
> 
> 所以..一切正常。除非我尝试对它们执行一些 SQL 语句。由于 NULLABLE FK，进行所有这些外部连接查询是一场噩梦。

这让我想起了“医生，医生，我这样打自己好痛”的笑话。

为什么你让外键字段可以为空？它们以前是强制性的，因此您应该将它们保持为强制性，正是为了避免外连接查询的噩梦。

您的解释（问题）有些令人困惑，因为您列出了三个字段（邻里、城市和州），然后说“这两个字段现在可以为空”。哪两个是？为什么？查找表中有什么？还是有多个查找表？可能存在某种 NeighbourhoodID 编号的参数，它是 Neighborhood 表的外键，它定义了 City 和 State 以及 Neighborhood 名称。然后，您可能会决定有一个封闭的城市列表，并且这些城市也有一个 ID 号，而该号码也决定了所在的州。您可能最好使用两个字母的州代码作为创建（可能是 4 字节）州 ID 号。然而，不要忘记，确保状态代码是 50 个左右有效状态代码之一的检查标准比引用状态表的外键更难编写。由于州和城市都不会经常变化，我可能会使用带有外键的州表 - 但键列将是州代码。

这意味着您可能有一个包含 NeighbourhoodID、Name、CityID 列的 Neighborhoods 表；包含 CityID、Name、State 列的 Cities 表；以及包含 State 和 Name 列的状态表。您可以根据需要添加其他列。您的主表将包含一个 NeighbourhoodID 列，该列是 Neighborhoods 表的外键。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T04:36:52.900

这是一个很好的起点。整个 #$(#$-load 的数据库模式要签出：

[http://www.databaseanswers.org/data_models/](http://www.databaseanswers.org/data_models/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T04:41:48.520

这是我必须处理的一个问题，RDBMS 系统在存储分层数据方面并不是最好的。您可能想考虑使用对象数据库，因为它们必须处理嵌套对象并针对该问题进行了优化。

如果您需要使用 RDBMS，您可能不得不坚持使用非规范化模式。不过，拥有单独的表格来维护您的城市、街道等可能有助于跟踪变化。如果需要重命名城市或街道，您可以更新相应表中的主记录并安排作业来更新“主”表中字符串的文本副本。这将防止您必须在黄金时段对 10 的 100 的数千行运行更新，但仍然可以让您在数据库中存储最新的数据数据。当然，这会让数据重复的情况更加糟糕，但这是为性能付出的代价。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T05:34:06.793

这是一个 OLTP 系统和报告系统还是只是一个报告系统？如果它只是一个报告系统，您可以以数据仓库的方式对数据进行非规范化（具有雪花维度或不针对地理辖区的层次结构），您会发现报告更容易。

我会从结果开始，然后回过头来，因为在我看来，您正在获取数据，并且您正试图将其引入数据库以支持报告和映射。在这种情况下，作为传统规范化系统的数据库模式并不重要，因为数据中的冗余不会导致用户维护问题等。

如果这看起来合适，您想查看 Kimball 的书籍。

# c# - 如何防止 ToolStrip 停靠在另一个 ToolStripContainer 中？

> ID：297889
> 
> 赞同：2
> 
> 时间：2008-11-18T04:56:32.577
> 
> 标签：c#, .net, winforms, mdi, toolstrip

我有一个 MDI 应用程序，它允许我打开不同类型的子窗口。我可以打开相同类型的子窗口的多个（但不同的）实例。（示例：我可以打开 3 个子窗口类型 A 的实例和 2 个子窗口类型 B 的实例。所有 5 个窗口都是不同的实体，除非用户明确将相同的数据拖到多个窗口上，否则它们不会共享数据。）每个子窗口有一个带有一个或多个 ToolStrips 的 ToolStripContainer。我该如何预防：

1.  用户从 A 类型的子窗口中将 ToolStrip 拖到 B 类型的子窗口中的 ToolStripContainer 中？
2.  用户是否将 ToolStrip 从子窗口 A 的一个实例拖到同一类型窗口的另一个实例中的 ToolStripContainer？

我试图阻止用户将 ToolStrip 从 A 类型的实例 1 拖动到 A 类型的实例 2，在实例 2 上选择一些东西，然后单击工具栏上的一个按钮，只是为了让其他一些窗口发生奇怪的事情. 同样，将 ToolStrip 从 A 类型的窗口拖动到 B 类型的窗口是没有意义的——这些操作不适用于该类型，但对用户来说，一切都很好，因为我让他们这样做阻力。

是像为 ControlAdded 事件添加我自己的处理程序一样简单，还是有更好的方法来做到这一点？我在 .NET 3.0 中使用 WinForms。

编辑：重现的步骤

1.  创建一个新的 Windows 应用程序项目。
2.  添加一个新的用户控件。为控件提供一个 ToolStripContainer，其中包含一个带有单个按钮的 ToolStrip。
3.  重复第 2 步，为您提供一个 UserControl2 类。
4.  编译解决方案，以便 UserControl1 和 UserControl2 显示在您的工具箱中。
5.  将 UserControl1 和 UserControl2 拖到窗体上。设置边界，以便您知道边界在哪里。
6.  运行应用程序。
7.  现在可以将 ToolStrip 从 UserControl1 中的容器拖放到 UserControl2 中的容器中（在 UC1 中留下零个 ToolStrip，在 UC2 中留下两个 ToolStrip。）
8.  现在假设您只能访问 UserControl1 中的代码。如何防止用户将 ToolStrip 拖出 ToolStripContainer 的实例？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T09:23:36.983

这感觉像是一个 hack，但它可以工作（有点）（对不起，vb.net 不是 c#）：

```
Public Class UserControl2

    Private Sub tsMainMenu_BeginDrag(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsMainMenu.BeginDrag

        tsMainMenu.Tag = tsMainMenu.Parent

    End Sub

    Private Sub ToolStrip1_EndDrag(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tsMainMenu.EndDrag

        If Not tsMainMenu.Parent.Parent.Equals(CType(tsMainMenu.Tag, ToolStripPanel).Parent) Then

            CType(ToolStrip1.Tag, ToolStripPanel).Controls.Add(tsMainMenu)
        End If

    End Sub

End Class 
```

简单的说; 当控件完成拖动时，如果其父 ToolStripContainer 与开始拖动时不同，则将工具条移回原来的位置。

我确信这可以滚动到一个控件中，这样您就不必为每个工具栏编写它。

**编辑：** 您可以将所有这些代码放入从 ToolStripContainer 继承的控件中，并让它为您完成所有工作，这意味着一个很好的封装解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T10:40:32.623

您是否尝试过使用 ToolStripContainer 的 DragEnter 和 DragLeave 事件来识别拖过容器的 ToolStrip 以接受或拒绝它？

# asp.net - 将 Web 表单混合到 ASP.NET MVC 应用程序中的问题

> ID：297895
> 
> 赞同：4
> 
> 时间：2008-11-18T05:02:59.990
> 
> 标签：asp.net, asp.net-mvc

我一直在尝试采用现有的 ASP.NET Webforms 应用程序并将其转换为混合应用程序，以便今后我们可以进行 ASP.NET MVC。

为了做到这一点，我创建了一个 ASP.NET MVC 应用程序并开始从包含 webforms 的 ASP.NET webforms 项目中复制一些文件夹。我在构建生成的项目时遇到问题，该项目有数百个这种形式的编译错误：

```
Error   1951    'Documents_Admin_DocPushByTag' does not contain a definition for
'CtlCategoryList' and no extension method 'CtlCategoryList' accepting a first argument 
of type 'Documents_Admin_DocPushByTag' could be found (are you missing a using directive
or an assembly reference?) 
```

这些错误消息中的每一个都引用了我的标记中的服务器控件。好像标记没有被解析？当我编辑文件背后的代码之一并输入时**。**要查看智能感知识别的内容，这些控件不会出现。事件处理程序会这样做（但这一定是因为它们是在代码隐藏文件中定义的）。据我所知，**CodeFile**和**Inherits** Page 属性是正确的（并且与它们来自的 ASP.NET 项目相同）。我很困惑是什么导致了这个问题。有任何想法吗？TIA。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T05:42:47.540

看看 scott hanselman 是如何做到的：
[http ://www.hanselman.com/blog/PlugInHybridsASPNETWebFormsAndASPMVCAndASPNETDynamicDataSideBySide.aspx](http://www.hanselman.com/blog/PlugInHybridsASPNETWebFormsAndASPMVCAndASPNETDynamicDataSideBySide.aspx)

基本上，你会使用 ignoreroute 来排除你所有的网络表单被路由到一个 mvc 处理程序

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T05:11:10.100

我认为将 System.Web.Mvc 程序集添加到当前项目并更新 web.config 文件和 global.asax 会更容易转换。

您必须确保您当前的应用程序是一个 Web 应用程序（而不是站点）项目。如果它没有转换它并确保它首先编译。

# php - Can FPDF/FPDI use a PDF in landscape format as a template?

> ID：297899
> 
> 赞同：12
> 
> 时间：2008-11-18T05:09:29.493
> 
> 标签：php, fpdf, fpdi

I am trying to import an existing PDF as a template with FPDI. The template is in landscape format. If I import the template into a new document the template page is inserted in portrait form with the content rotated 90 degrees. If my new document is in portrait the full content appears, but if the new document is also landscape, the content is cropped.

Is it possible to use a landscape template with FPDI?

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-18T23:39:25.057

sure, it is no problem. Just add "L" as parameter when calling "addPage()". Here is a sample which works fine for me (the template is in landscape)

```
<?php
require_once('fpdf.php');
require_once('fpdi.php');

$pdf =& new FPDI();
$pdf->addPage('L');
$pagecount = $pdf->setSourceFile('template.pdf');
$tplIdx = $pdf->importPage(1); 
$pdf->useTemplate($tplIdx); 
$pdf->SetFont('Arial'); 
$pdf->SetTextColor(255,0,0); 
$pdf->SetXY(25, 25); 
$pdf->Write(0, "This is just a test"); 
$pdf->Output('newpdf.pdf', 'F');

?> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-30T02:34:06.237

Finally got to look at this problem again... Although crono's answer is perfectly valid. It seems this only works with more recent versions of the FPDI tools. Upgrading from v1.1 to v1.3 solves the problem.

# https - 通过 HTTPS 投放广告

> ID：297904
> 
> 赞同：8
> 
> 时间：2008-11-18T05:13:48.237
> 
> 标签：https, adsense, serving

我知道没有愚蠢的问题，但这是：您可以在完全落后于 https 的网站上通过 adsense 或其他网站提供基于上下文的广告吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-04T19:40:48.200

**更新：**

> 我们更新了 AdSense 广告代码，现在它支持在超文本传输​​协议安全 (HTTPS) 网页上通过安全套接字层 (SSL) 进行安全广告投放。这意味着拥有安全网站（即通过 HTTPS 协议提供的网站）的发布商现在可以使用 AdSense 广告代码来提供符合 SSL 规定的广告。安全网站的示例包括许多金融服务网站、电子商务网站和社交网站。

[Google 已意识到该问题，但目前并未提供其代码的正确配置的 HTTPS 版本](https://www.google.com/support/adsense/bin/answer.py?answer=10528)。它可以通过将 http 替换为 https 来工作，但如上所述，您会在浏览器中遇到各种错误。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-09-17T08:01:29.020

[AdSense 现在支持 HTTPS](http://googledevelopers.blogspot.com.au/2013/09/https-compatible-ad-code-for-adsense.html)。只需删除广告代码的“http:”部分即可。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T05:24:37.140

您可以，但访问者会收到一条消息，指出您的网站在 Internet Explorer 中包含安全数据和非安全数据。大多数其他浏览器也有办法传达这种状态。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T05:29:28.953

是的，只要网站不受 SSL 证书保护（因为访问网站的客户端需要有证书）Google 完全有能力为您的网站编制索引以查找关键字，从而为您的网站提供合适的广告。

我不确定 Google 是否也通过 SSL 提供 adsense 代码，否则浏览器会警告您的访问者该页面可能包含不安全的元素。我知道他们的分析代码（用于谷歌分析）确实包含 SSL 的可能性。

如果您还有其他问题，Google 的 adsense 支持团队/常见问题解答将能够更好地为您的问题提供答案，因为您可以让他们知道您正在谈论的网站！

# assembly - IA-32 汇编中的变量初始化

> ID：297909
> 
> 赞同：0
> 
> 时间：2008-11-18T05:17:38.697
> 
> 标签：assembly

我对 MASM 程序集中的变量初始化有疑问。

如何将 2^32 初始化为变量以及应该初始化哪种变量？DWORD 还是 REAL4？

我尝试这样做：

```
val DWORD 2.0E+32 
```

当我将 var 分配给一个寄存器（例如 mov eax,val）并尝试写入该值时，我看到的不是 2^32。我也试过用 REAL4 类型。结果还是一样。

那么我在这里做错了什么？

提前致谢...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T05:54:36.673

2^32 = 4294967296 = 0x100000000（即 8 个零）。

**`2.0E+32`**是 2 * 10^32 = 2000000000000000000000000000000000，一个*完全*不同的数字。它也是一个浮点数，而**`0x100000000`**它是一个整数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T06:05:06.417

2^32 比 dword 支持的数字大一点，让我输入一些范围：

```
0 <= dword < 2^32
0 <= qword < 2^64
-2^31 <= sdword < 2^31
-2^63 <= sqword < 2^63 
```

如果 REAL4 是一个 4 字节的浮点数，那么它的结构与整数的结构完全不同。如果您使用 x86，则浮点表示的格式可能是[IEEE 754](http://en.wikipedia.org/wiki/IEEE_754)。这支持 2^32 -number，但您可能会遇到精度问题。

# .net - 是否有简单的方法在特定区域打印数据

> ID：297911
> 
> 赞同：0
> 
> 时间：2008-11-18T05:18:34.670
> 
> 标签：.net, vb.net, printing

我想在 A4 纸上的特定区域打印一些数据。有什么简单的方法可以做到这一点吗？我很难找到`X`和的坐标`Y`。下面是我在 VB.NET 中打印数据的示例代码：

```
Private Sub PrintDocument1_PrintPage(ByVal sender As Object, ByVal e As System.Drawing.Printing.PrintPageEventArgs) Handles PrintDocument1.PrintPage    
        e.Graphics.DrawString("My text", f_en, Brushes.Black, 410, 942)
        ...
End Sub 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-18T05:37:22.167

如果您有想要以毫米为单位绘制的位置，您可以试试这个：

```
e.Graphics.PageUnit =  GraphicsUnit.Millimeter; 
```

# wpf - How to get started with Microsoft PixelSense

> ID：297926
> 
> 赞同：11
> 
> 时间：2008-11-18T05:30:28.267
> 
> 标签：wpf, pixelsense

If I wanted to get a pilot project off the ground using Microsoft PixelSense, where or who do I ask for testing hardware?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T06:54:07.910

Here is a great interview [you should listen to](http://www.dotnetrocks.com/default.aspx?showNum=389).

Basically, you will likely need to purchase a PixelSense machine. The Developer edition is $15,000\. At the moment, it is difficult to get your hands on the bits unless you went to PDC but I'd imagine that will change and there will more opportunities in the future.

There is a simulator, but it was only available to attendees to PDC. One of the input methods was to use TWO mice, if I recall correctly. It looks like an interesting experiment, we'll see if it actually takes off.

As for the hardware, you can ~~[buy it here](http://www.microsoft.com/en-us/pixelsense/purchaseprocess.aspx)~~. edit: [now here](http://www.microsoft.com/en-us/pixelsense/purchaseprocess.aspx)

To just test drive the actual unit, head down to Vegas and [see the unit in Harrah's](http://video.msn.com/video.aspx?mkt=en-us&vid=c6aa3288-f623-44b7-a4e4-7ff176f3d89e) casino.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T05:35:30.707

Also, you could watch the PDC Video about developing for the Surface platform.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T05:32:55.670

I think you want to start with the [official Microsoft page](http://www.microsoft.com/surface/developing.html) for developers.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T07:07:12.487

Here's the link to what I think Bruno is also referring to
[**Developing for Microsoft Surface**](http://channel9.msdn.com/pdc2008/PC17/)

A pretty cool demo. AFAIR there is some talk of a simulator for the surface hardware although I'm not sure if it's free or part of the SDK.
The hardware units are available for sale in the US and everyone at PDC got the SDKs I think.. dunno if it'll be available for the general dev audience soon. Can't find a download link anywhere.. maybe you need to buy the h/w to get your hands on it..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-29T13:36:01.450

There's a book called "Developing for Microsoft Surface" that's been released. It's very basic but worth having a look.

# java - 使用 Java 的“始终在顶部”Windows

> ID：297938
> 
> 赞同：92
> 
> 时间：2008-11-18T05:37:48.860
> 
> 标签：java, user-interface, swing, awt

在 Java 中，有没有办法让一个窗口“始终在顶部”，无论用户是否将焦点切换到另一个应用程序？我在网上搜索过，所有解决方案都倾向于某种带有本机绑定的 JNI 接口。真的这不能是唯一的方法吗？......或者是吗？

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2008-11-18T05:46:46.080

试试这个`Window`类的方法：

[Window.setAlwaysOnTop（布尔值）](http://java.sun.com/javase/6/docs/api/java/awt/Window.html#setAlwaysOnTop%28boolean%29)

它的工作方式与 Windows 任务管理器中的默认方式相同：切换到另一个应用程序，但它始终显示在顶部。

这是在 Java 1.5 中添加的

示例代码：

```
import javax.swing.JFrame;
import javax.swing.JLabel;

public class Annoying {
    public static void main(String[] args) {
        JFrame frame = new JFrame("Hello!!");

        // Set's the window to be "always on top"
        frame.setAlwaysOnTop( true );

        frame.setLocationByPlatform( true );
        frame.add( new JLabel("  Isn't this annoying?") );
        frame.pack();
        frame.setVisible( true );
    }
} 
```

![替代文字](https://i.stack.imgur.com/od2Zo.png)

[即使不活动，窗口也会保持在顶部]

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2014-01-04T16:15:30.053

根据我的观察，我发现 AlwaysOnTop 特权被赋予了要求始终在最前面的最新进程。

因此，如果您有一个应用程序，`setAlwaysOnTop(true)`然后另一个应用程序使用此选项，则该权限将授予第二个应用程序。为了解决这个问题，每当任何窗口出现在当前窗口的顶部时，我都会设置`setAlwaysOnTop(false)`and 。`setAlwaysOnTop(true)`

我已经用`wordweb`in进行了检查`windows`。WordWeb 是使用`AlwaysOnTop`选项的应用程序之一`OS`

我不确定它是否适用于您的游戏场景。

**警告**：我不知道副作用。

这是代码示例：

```
import java.awt.event.*;

import javax.swing.*;

public class MainWindow extends JFrame implements WindowFocusListener
{
    public MainWindow()
    {
        addWindowFocusListener(this);
        setAlwaysOnTop(true);
        this.setFocusable(true);
       // this.setFocusableWindowState(true);
        panel = new JPanel();
        //setSize(WIDTH,HEIGHT);
        setUndecorated(true);
        setLocation(X,Y);
        setExtendedState(MAXIMIZED_BOTH);
        setVisible(true);
    }

    public void windowGainedFocus(WindowEvent e){}
    public void windowLostFocus(WindowEvent e)
    {
        if(e.getNewState()!=e.WINDOW_CLOSED){
            //toFront();
            //requestFocus();
            setAlwaysOnTop(false);
            setAlwaysOnTop(true);
            //requestFocusInWindow();
            System.out.println("focus lost");
        }

    }

    private JPanel panel;
    private static final int WIDTH = 200;
    private static final int HEIGHT = 200;
    private static final int X = 100;
    private static final int Y = 100;

    public static void main(String args[]){
              new MainWindow();}
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-07-22T03:11:48.900

不要使用setFullScreenWindow，只需获取屏幕尺寸然后setSize，一切都会好起来的。

# css - 在 Flex 中为蒙皮按钮添加翻转效果

> ID：297945
> 
> 赞同：0
> 
> 时间：2008-11-18T05:42:28.867
> 
> 标签：css, apache-flex

使用 Flex 3，我有一个 Button，它使用 CSS 样式表中指定的 PNG 进行蒙皮。

```
Button.addextra {  
    downSkin : Embed( source="img/add-extra-icon.png" ); 
    overSkin : Embed( source="img/add-extra-icon.png" ); 
    upSkin : Embed( source="img/add-extra-icon.png" ); 
    disabledSkin : Embed( source="img/add-extra-icon-disabled.png" ); 
} 
```

我的设计师同事想在图像外添加发际线 #999999 线的翻转效果。使用标准 Flex 样式是否可能（无需创建新的 overSkin png）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-26T06:48:28.407

用 Graphics 画线怎么样？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-19T20:44:12.180

我相信你需要改变 overSkin，我认为这是唯一的方法。

# .net - WPF：使用 JPEG 压缩的 TIFF 图像？

> ID：297949
> 
> 赞同：4
> 
> 时间：2008-11-18T05:47:55.267
> 
> 标签：.net, wpf, encoding, jpeg, tiff

我有大量 TIFF 图像需要在 WPF 程序中使用（特别是 .NET 3.5 SP1 并使用 C#）。一半的 TIFF 文件包含使用 JPEG 压缩编码的彩色图像，它们不适用于 WPF。“Microsoft Office Document Imaging”应用程序可以很好地处理文件。由于 Windows 本身也不喜欢它们（例如不能生成缩略图），我假设这是标准 Windows 映像组件 (WIC) 库中的限制。

有人对如何正确读取使用标准 .NET/WPF 库的 JPEG 压缩的 TIFF 图像有任何想法吗？

或者是否有人知道我可以用来解决此问题的 WIC 的任何替代第三方 TIFF 编解码器？

或者最后是否有任何用于 TIFF 文件的替代 .NET 库仍然可以轻松地与 WPF 一起使用？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T05:55:47.140

TIFF 包装的 JPEG 有两种类型 - 6 型和 7 型。您所描述的是 6 型 TIFF。虽然 Adob​​e 多年来一直建议不要使用这种类型（有关详细信息，请参阅[技术说明 2](http://www.remotesensing.org/libtiff/TIFFTechNote2.html)），但仍有几个图形包使用它。

我知道一些 .NET 的商业图形包可以读取它们，例如[Captiva ISIS PixTools](http://www.emc.com/products/detail/software/pixtools.htm)（以前的 Pixtran）库，但不知道任何开源或其他免费的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T05:59:11.250

您使用什么 WPF API 来处理它们？

您是否尝试过使用System.Windows.Media.Imaging 命名空间中的[TiffBitmapDecoder](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.tiffbitmapdecoder.aspx)？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-13T18:23:04.180

您需要升级到 Windows 7、Windows Server 2008（或更高版本）才能以本机方式打开这些文件。

Libtiff (C++) 和 LibTIFF.NET (.Net) 应该能够打开这些文件。请确保在构建这些库之一时，在构建中启用了 TIFF_JPEG（6 和 7）。这些格式在默认构建设置中被禁用。

# c# - 如何从 LINQ 查询表中的多行中获得最佳性能

> ID：297951
> 
> 赞同：1
> 
> 时间：2008-11-18T05:52:02.543
> 
> 标签：c#, linq-to-sql, .net-3.5

我的目标是从翻译表中获取很多行。我使用一个 ID 来获取表的一个子集（比如 50 行），然后我使用另一个 ID 来获取该子集中我想要的行。使用类型化数据集我执行以下操作来获取主数据集：

```
funderTextsDS.tbl_funderTextsDataTable fd = 
(funderTextsDS.tbl_funderTextsDataTable)(new funderTextsDSTableAdapters.tbl_funderTextsTableAdapter()).GetData(); 
```

然后对于我想获得的每个值：

```
fd.Select("eng_code = '" + element + "' and funderID = '" + funderID + "'")[0]["funderText"].ToString(); 
```

使用 ANTS 探查器检查代码我发现此方法在 10 次页面刷新中使用了大约 170 毫秒（220 次调用 fd.select...）

当我将其重写为 LINQ 时，完成相同的工作需要 2000 多毫秒。这是我使用的 LINQ 代码：

```
IrmDatabaseContext irmDB = new IrmDatabaseContext();
irmDB.tbl_funderTexts.Single(f => f.funderID == funderId && f.eng_code == element).funderText; 
```

任何人都有用 LINQ 做这件事的好方法吗？通过查看 sql server profiler，我看到 LINQ 实际上为我检索到的每个文本生成了一个选择。（即 LINQ= 220 从 db 中选择，tableadapter 方法 = 10 选择）

解决方案：在网上阅读后，我发现 David B 走在了正确的轨道上，尽管 for 循环让我很长一段时间都没有反应。无论如何，正如他所说，诀窍是使用列表，因为这实际上迫使 linq 对数据库运行查询并将其缓存在本地。[http://blogs.msdn.com/wriju/archive/2007/07/17/linq-to-sql-caching-the-query-execution.aspx](http://blogs.msdn.com/wriju/archive/2007/07/17/linq-to-sql-caching-the-query-execution.aspx)。

所以我的解决方案最终是这样的：

```
List<tbl_funderText> fd = (from tf in irmDB.tbl_funderTexts
                      where tf.funderID == (int)cpcrow.cpc_fundingPartnerID
                      select tf).ToList(); 
```

然后每次我想要一个元素时，我都会这样做：

```
fd.Single(f => f.eng_code == element).funderText; 
```

用 ANTS 分析，我发现时间减少到 150ms（大约与 tableAdapter 相同。SQL 查询分析器显示 SQL 只运行一次。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T06:08:45.787

啊，所以在 TableAdapter 方法中，您将行拉入内存，然后进一步查询内存中的行。这在 LINQ 中很容易做到。

```
myDataContext dc = new myDataContext();
List<FunderText> myList = myDataContext.tbl_funderTexts.ToList();

List<string> result1 = new List<string>();
foreach(var theValue in myValues)
{
  result1.Add(
    myList.First(f => f.funderID == theValue.funderId && f.eng_code == element).funderText
  );
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T06:08:02.387

我不确定这是否会有所帮助，但请尝试使用 .where 而不是 .single。像这样的东西：

```
var data = mDB.tbl_funderTexts.where(f => f.funderID == funderid && f.eng_code == element)
var fundertext = data.single().funderText 
```

# php - 在 PHP 中模拟启用 cookie 的浏览器

> ID：297952
> 
> 赞同：3
> 
> 时间：2008-11-18T05:52:37.473
> 
> 标签：php, curl, curl-multi, redirectwithcookies

如何使用 PHP 打开网页并接收其 cookie？

**动机**：我正在尝试使用[feed43](http://www.feed43.com)从不支持 RSS 的 HighLearn 网站（远程学习网站）创建 RSS 提要。我找到了包含我需要解析的提要内容的网页，但是，它需要先登录。幸运的是，登录可以通过 GET 请求完成，因此就像 fopen() 输入“ [http://highlearn.website/login_page.asp?userID=foo&password=bar](http://highlearn.website/login_page.asp?userID=foo&password=bar) ”一样简单。但是我仍然需要**获取登录时生成的**cookie，将 cookie 传递给真正的客户端（可能使用 setcookie() 吗？）然后重定向。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T08:43:41.137

对于服务器端 HTTP 客户端，您应该使用[cURL](http://au2.php.net/curl)模块。它将允许您跨多个请求保留 cookie。它还做了一些其他简洁的事情，比如捆绑请求（curl_multi）和透明地处理重定向。

在将会话返回给您的用户时，我认为这是不可能的。您需要能够覆盖其他域的 cookie。这将导致巨大的安全问题，因此没有浏览器会实现它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T09:23:13.023

我以前使用过 Simpletest 的[Scriptable Browser](http://simpletest.sourceforge.net/en/browser_documentation.html)组件来进行这种屏幕抓取。它在模拟浏览器方面做得很好。

您不需要将会话传递给真正的客户端（即使*可能*，这取决于站点的安全级别） - 您可以简单地让您的 PHP 脚本成为目标站点和最终用户之间的代理.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T06:13:13.220

不幸的是，除非网站在同一个域中，否则这是不可能的。Cookie 仅在其来源的域上有效。此外，子域算作不同的域。否则，（请记住，我没有使用太多 php）您可以将标头从响应中提取出来，然后将 cookie 复制到客户端。

# asp.net-mvc - 使用 ASP.Net MVC 上传文件 - 获取名称但没有文件流，我做错了什么？

> ID：297954
> 
> 赞同：41
> 
> 时间：2008-11-18T05:53:43.103
> 
> 标签：asp.net-mvc, upload

在我看来，我有这个表格：

```
<!-- Bug (extra 'i') right here-----------v  -->
<!-- was: <form method="post" enctype="mulitipart/form-data" action="/Task/SaveFile"> -->
<form method="post" enctype="multipart/form-data" action="/Task/SaveFile">
<input type="file" id="FileBlob" name="FileBlob"/>
<input type="submit"  value="Save"/>
<input type="button" value="Cancel" onclick="window.location.href='/'" />
</form> 
```

我的控制器中的这段代码：

```
public ActionResult SaveFile( FormCollection forms )
{
   bool errors = false;
   //this field is never empty, it contains the selected filename
   if ( string.IsNullOrEmpty( forms["FileBlob"] ) )
   {
       errors = true;
       ModelState.AddModelError( "FileBlob", "Please upload a file" );
   }
   else
   {
      string sFileName = forms["FileBlob"];
      var file = Request.Files["FileBlob"];
      //'file' is always null, and Request.Files.Count is always 0 ???
      if ( file != null )
      {
         byte[] buf = new byte[file.ContentLength];
         file.InputStream.Read( buf, 0, file.ContentLength );
         //do stuff with the bytes
      }
      else
      {
         errors = true;
         ModelState.AddModelError( "FileBlob", "Please upload a file" );
      }
   }
   if ( errors )
   {
      return ShowTheFormAgainResult(); 
   }
   else
   {
      return View();
   }
} 
```

根据我能找到的每个代码示例，这似乎是这样做的方法。我尝试过使用小文件和大文件，结果没有区别。表单字段始终包含与我选择的文件名匹配的文件名，并且 Request.Files 集合始终为空。

我认为这无关紧要，但我正在使用 VS Development Web Server。AFAIK 它支持与 IIS 相同的文件上传。

时间不早了，我有可能遗漏了一些明显的东西。我会很感激任何建议。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-11-18T06:38:43.993

我不知道发布亵渎的政策是什么，但问题是：

```
enctype="mulitipart/form-data" 
```

那里的额外内容`i`阻止了文件上传。必须运行 Fiddler 才能看到它从一开始就没有发送文件。

它应该是：

```
enctype="multipart/form-data" 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-12-10T19:58:54.733

对于将来可能会偶然发现这篇文章的人，这里是 Scott Hanselman 关于该主题的一篇精彩文章：[回归基础案例研究：使用 ASP.NET MVC 实现 HTTP 文件上传，包括测试和模拟](http://www.hanselman.com/blog/ABackToBasicsCaseStudyImplementingHTTPFileUploadWithASPNETMVCIncludingTestsAndMocks.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T05:58:15.027

```
var file = Request.Files[sFileName]; 
```

应该...

```
var file = Request.Files["FileBlob"]; 
```

也就是说，`Request.Files.Count`应该是 1 ... 嗯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T16:27:48.937

很好，你发现了你的错误。

作为旁注，您需要尝试/捕获文件处理代码，以便您知道文件权限等何时设置不正确。

# c# - 在 Visual Studio 2008 for .NET CF 中处理不同的分辨率

> ID：297955
> 
> 赞同：5
> 
> 时间：2008-11-18T05:54:27.283
> 
> 标签：c#, visual-studio, compact-framework

我正在开发一个基于 .NET CF 的图形应用程序，我的项目涉及很多绘图图像，我们决定将应用程序移植到不同的手机分辨率上。（240 X 240、480 X 640）等。

我将如何在单个解决方案/项目中实现这一目标？

是否需要根据分辨率创建不同的项目？我将如何处理常见文件？我需要在所有设备上发生一个常见类的更改。

谢谢你，克罗诺斯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T23:35:13.050

不要听那个白痴MusiGenesis。为 Windows Mobile 设备处理不同屏幕分辨率的一种更好的方法是使用**表单继承**，它可以轻松地添加到现有的 CF 应用程序中。

基本上，您为标准 240x320 屏幕设计每个表单。当您需要为新的分辨率（比如 240x240）重新排列表单时，您可以向项目中添加一个新表单，并让它继承您原来的 240x320 表单：

```
public partial class frmDialog240x240: frmDialog 
```

而不仅仅是形式：

```
public partial class frmDialog240x240: Form 
```

像往常一样。在您的原始表单上，您需要将**每个控件的 Modifiers 属性设置为 Protected**（而不是默认的 Private）。在新表单的设计器中，您将看到您继承的表单上的所有控件，您可以移动它们并调整它们的大小以适应新的屏幕尺寸（这不会影响原始表单的布局）。

当你的程序运行时，它很容易检查它正在运行的设备的屏幕分辨率并创建适当的表单（工厂方法对此很有用）。您的新表单继承了旧表单的所有内容，但使用了新的自定义布局。

这种方法可以避免代码重复，因为没有任何重复。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T14:46:39.500

锚定和停靠是处理不同分辨率的最常用机制（还请记住，许多设备可以旋转屏幕，因此即使在单个设备上您也需要处理更改）。之后如果需要，获取屏幕大小就像查询 Screen 对象一样简单：

```
int screenWidth = Screen.PrimaryScreen.Bounds.Width;
int workingHeight = Screen.PrimaryScreen.WorkingArea.Height; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T06:57:58.603

这段代码在动态确定屏幕分辨率方面对我有用：

```
[DllImport("coredll.dll", EntryPoint = ("GetSystemMetrics"))]
public static extern int GetSystemMetrics(int nIndex);

private const int SM_CXSCREEN = 0;
private const int SM_CYSCREEN = 1;

private int width = GetSystemMetrics(SM_CXSCREEN);
private int height = GetSystemMetrics(SM_CYSCREEN); 
```

我不记得它了，但是还有一种方法可以获取屏幕方向。这些将有助于将一些代码合并到一个类中。

我强烈建议为所有分辨率创建一个单一的解决方案。在这些解决方案下，您可以拥有任意数量的项目。这些项目可以是 Windows 窗体应用程序、Dll 库项目或设置项目。

我的目标是创建一个单一的 Windows 窗体应用程序项目。我将使用上述技术并从文件系统中读取静态图像。如果这对您不起作用和/或您更喜欢将图像作为资源读取，则创建一个“引擎”dll 项目，其中包含所有分辨率通用的所有代码。然后添加此项目的输出作为对您需要的任意数量的 Windows 窗体应用程序项目的引用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T04:31:14.687

这个问题没有简单的答案。在 Windows 中设计处理不同屏幕分辨率的表单很容易，即使最小的屏幕尺寸通常为 600 x 800。在 CF 世界中，屏幕可以小至 240 x 240（智能手机更小）或大至640 x 480（或更大）。在这些尺寸范围内，锚定和对接往往效果不佳。

一种选择是使用最小公分母方法并设计所有内容以适应最小的屏幕。这保证适用于每台设备，但显然会浪费大屏幕上的有用空间。

另一种选择是将每个表单设计为具有分辨率感知能力。例如，如果您有一个在网格中显示数据的表单和一个在其上方的过滤器组合框，您可以在表单的 Resize 事件中编写代码来调整网格的尺寸以填充任何可用空间。

分辨率感知代码的另一种选择是为特定 UI 功能的每个分辨率创建单独的表单。当然，这是更多的工作并导致代码重复，但对于某些特定功能，这只是您必须做的事情。只要你抽象出常见的逻辑，你就可以了。

您希望在单个项目中实现这一目标是正确的。不同的屏幕分辨率通常可以通过一些工作和思考来处理，并且绝对不是将您的产品拆分为不同项目的理由。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-10T11:39:15.090

除了最基本的紧凑型应用程序之外，我放弃了设计器。我尝试使用屏幕尺寸以数学方式放置每个控件。这听起来很痛苦，但一旦你开始，它就会成为第二天性。

对于每个表单，我都会创建一个“重新生成”方法，只要表单显示或调整大小就会触发该方法。在该方法中，我通常为表单上的每个控件设置位置、大小以及（如有必要）字体大小。放置控件时，我的思考过程是：

1.  适合普通人像设备吗？
2.  可以用于常规横向设备吗？
3.  适合方形设备吗？
4.  适用于 VGA (640x480)（高 DPI）设备？

对于字体大小和处理高 DPI（每英寸点数）VGA 设备，我使用属性 -：

CurrentAutoScaleDimensions.Height / 96

...产生一个字体缩放因子。（常规设备为 96 DPI）

作为最后的手段，您可以在重新生成代码中使用条件 (if) 语句来测试各种屏幕尺寸/形状。

仍然可以使用设计器进行基本布局，但您需要在各种模拟器/设备上运行表单并尝试切换纵向/横向以全面测试“重新生成”方法。

# database-design - 哈希碰撞 - 有什么机会？

> ID：297960
> 
> 赞同：27
> 
> 时间：2008-11-18T05:55:44.627
> 
> 标签：database-design, hash

我在我的 PHP 驱动的网站上有一些代码，它创建了一个随机散列（使用`sha1()`），我用它来匹配数据库中的记录。

发生碰撞的可能性有多大？我应该生成哈希，然后首先检查它是否在数据库中（我宁愿避免额外的查询）还是自动插入它，基于它*可能*不会与另一个发生冲突的概率。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-18T06:03:26.763

如果您假设 SHA-1 做得很好，您可以得出结论，两条给定消息具有相同哈希的可能性为 2^160 分之一（因为 SHA-1 产生 160 位哈希）。

2^160 是一个大得离谱的数字。大约是 10^48。即使您的数据库中有一百万个条目，新条目共享相同哈希的机会仍然是 10^42 分之一。

SHA-1 已被证明相当不错，所以我认为您根本不需要担心碰撞。

附带说明一下，当您使用 SHA-1 时，请使用 PHP 的*raw_output*功能，因为这会导致字符串更短，从而使您的数据库操作更快一些。

编辑：为了解决生日悖论，具有 10^18（一百万）条目的数据库有大约 0.0000000000003 中的 1 发生碰撞的机会。*真的*不值得担心。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-18T08:35:40.013

当您将 ID（和其他值）发送到客户端并在接收时再次解密时，使用**对称加密方案**和**私有服务器密钥来加密它们。**请注意您的加密函数提供机密性和完整性检查。

这允许您**在与 DB 交谈时使用合理的值而不会发生任何冲突**，在与客户端交谈时非常安全，并将您登陆[thedailyWTF](http://thedailywtf.com/)的概率降低大约 2^160。

另见[敲钉子：旧鞋还是玻璃瓶？](http://weblogs.asp.net/alex_papadimoulis/archive/2005/05/25/408925.aspx)！

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-18T12:31:26.747

为什么不做一些*保证*不会发生冲突的事情，并确保没有人可以更改 GET 参数来查看他们不应该查看的内容：使用盐，结合 id 和它的哈希。

```
$salt = "salty";
$key = sha1($salt . $id) . "-" . $id;
// 0c9ab85f8f9670a5ef2ac76beae296f47427a60a-5 
```

即使您不小心偶然发现了两个具有完全相同的 sha1 哈希（使用您的盐）的数字，那么 $key 仍然会有所不同，您将避免所有冲突。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-18T06:07:23.183

如果您使用数字递增的 ID 作为输入，那么 SHA-1 碰撞的机会几乎为零。

如果 ID 是唯一的输入，那么 SHA-1 似乎有点矫枉过正——从 32 位整数生成 160 位散列。我宁愿使用模幂运算，例如选择一个大的（32 位）素数 p，计算该组的模生成器 g，然后使用 g^​​id。这将保证无冲突，并且仅提供 32 位“哈希”。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-18T06:03:52.490

SHA-1 产生 160 位长的摘要。因此，只要您的条目少于 2^(160/2) 个，您就是安全的。除以 2 是由于[生日悖论](http://en.wikipedia.org/wiki/Birthday_paradox)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-18T06:04:31.427

从第一原则：

SHA-1 产生一个 160 位的摘要。假设它均匀地使用整个位空间（这大概是它的设计目的），那么每次插入只有 2^-160 的机会会发生冲突。

所以对于每个插入，假设没有碰撞应该是安全的，如果有则处理错误。

这并不是说您可以完全忽略碰撞的机会。

生日悖论表明，由于 O(N^2) 可能的冲突，您的数据库中至少存在一次冲突的可能性比您猜测的要高。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-18T08:20:50.183

问一个问题，如果发生碰撞，你会付出什么代价。如果这是一个免费网站很好。如果您正在经营一家赚钱的企业，而一项覆盖将花费您一百万美元的合同，那么我会再想一想。

我认为你正在以错误的方式解决这个问题。
我认为您需要保留唯一 ID，但要确保用户不能手动更改 ID。

执行此操作的一种方法是将 ID 和 ID 的哈希（带有一些额外数据）放入链接中。

例如：（我的 PHP 生锈了，所以一般算法是：）

```
id   = 5;
hash = hash("My Private String " + id)
link = "http://mySite.com/resource?id=" + id + "&hash=" + hash 
```

然后，当您收到请求时，只需验证您是否可以从 ID 重新生成哈希。这确实使您容易受到攻击以计算出“我的私人字符串”，但这在计算上将非常困难，并且您始终可以附加用户无法直接使用的其他独特内容（例如会话 ID）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-10-04T11:48:59.547

有一个非常简单的规则可以确定任何散列算法是否会发生冲突。**如果算法的输出范围是有限数，那么迟早肯定会发生冲突。**

即使 SHA1 具有非常大的 2^160 散列可能性范围，它仍然是一个有限的数字。但是，可以在该函数上传递的输入实际上是无限的。给定足够大的输入数据集，必然会发生冲突。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-18T08:35:34.197

其他评论已经涵盖了您的概率，但是如果您务实地看待这一点，那么您可以自己得到明确的答案。

您自己说过您将散列您的顺序 ID。编写测试用例很容易。遍历约 100,000,000 个 id 并检查冲突。这不会花费很长时间。另一方面，您可能会用完四分之一的内存。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-18T21:57:10.460

我认为 sha1() 在这里不会给您带来任何麻烦，弱随机数生成更有可能发生碰撞。

Stefan Esser 写了一篇关于这个话题的好[文章。](http://www.suspekt.org/2008/08/17/mt_srand-and-not-so-random-numbers/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-11-06T13:11:35.657

## 发生碰撞的可能性有多大？

*n 个散列与**S*不同的可能散列的总数碰撞的*确切*概率是：

 **![](https://latex.codecogs.com/gif.latex?1&space;-&space;%5Cfrac%7BS!%7D%7BS%5En&space;%5Ccdot&space;(S-n)!%7D "1 - \frac{S!}{S^n \cdot (Sn)!}")

（哈希函数的完美行​​为，生日悖论，等等等等……）

您将无法直接计算，因为这些数字很大，所以我们使用限制并做出 2 个假设：

![](https://latex.codecogs.com/gif.latex?S&space;%5Crightarrow&space;%5Cinfty "S \rightarrow \infty")

![](https://latex.codecogs.com/gif.latex?S&space;%5Cgg&space;n%5E2 "S \gg n^2")

有了这两个假设，碰撞的概率可以用以下公式计算：

![](https://latex.codecogs.com/gif.latex?%5Cfrac%7Bn%5E2%7D%7B2S%7D "\frac{n^2}{2S}")

**现在您可以计算一些*n*条记录**的冲突概率。对于 sha1 (S=2^160) 的任何少于 2^70 条记录，这非常准确，近似值越差，*n*越接近 2^80。

## 例子

例如，如果您要保存大量用户，特别是与世界上的人相同的数量（约 80 亿），并且您正在使用 sha1 (S=2^160)，那么发生冲突的概率为*2.5e -29*（注意两个假设成立）。给您一个参考，赢得 Euromillion 大奖的概率约为*7e-9*。

## 好奇心：如何处理更大（更大？！）的数字？

没有第二个假设，直接计算极限。

*例如，第一次碰撞预计在S*的平方根附近（在 sha1 n=2^80 的情况下）。在该值下，第二个条件不成立，但我们可以直接计算限制：

![](https://latex.codecogs.com/gif.latex?%5Clim_%7BS&space;%5Cto&space;%5Cinfty%7D&space;(1&space;-&space;%5Cfrac%7BS!%7D%7BS%5E%7B%5Csqrt%7BS%7D%7D%5Ccdot&space;(S-%5Csqrt%7BS%7D)!%7D)&space;=&space;1&space;-&space;%5Cfrac%7B1%7D%7B%5Csqrt%7Be%7D%7D "\lim_{S \to \infty} (1 - \frac{S!}{S^{\sqrt{S}}\cdot (S-\sqrt{S})!}) = 1 - \frac{1} {\sqrt{e}}")

这是大约 40%。碰撞的概率。

# iphone - 为什么要虚拟化手机？

> ID：297963
> 
> 赞同：0
> 
> 时间：2008-11-18T05:56:45.700
> 
> 标签：iphone, windows-mobile, mobile, virtualization, virtual-machine

虚拟化移动设备与虚拟化服务器或桌面有很大不同，后者的硬件组件几乎是标准化的（如键盘、鼠标、USB、LAN 等），因此可以轻松地将硬件抽象为任何操作系统。

虽然在移动设备上存在大量硬件（如 iphone 触摸屏、手写笔......其他附加组件），但所有类型的手机之间的互操作性非常低，或者所有移动设备的通用功能集非常少硬件。不能在没有触摸表面的诺基亚手机上使用 iphone 手势。

是什么促使人们对移动设备进行虚拟化？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T06:10:28.793

不是每个人都能负担得起为他们的测试人员/开发人员提供成熟的手机。这就是虚拟化进入游戏的时候，因为今天几乎每个人都有一台能够运行某种虚拟机的计算机。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T08:45:30.603

还有双驱动器：

*   它对于 S60 和 Windows 移动等硬件之间没有鸿沟的情况很有用（或者可能虚拟化你的 android 移动，这样你就可以使用 WM 直到 android 不再不稳定并具有巨大的 root 漏洞利用 :)）
*   因为他们可以

不过，我从开发人员方面对此很感兴趣，因为我必须一直为 symbian 开发，它可以减少我必须开发人员测试的手机变体数量:)

# javascript - 用于扩展内置数据类型对象的 Javascript 库

> ID：297970
> 
> 赞同：2
> 
> 时间：2008-11-18T06:02:26.953
> 
> 标签：javascript

那里有许多很棒的 Javascript 库\框架（jQuery、Prototype、MooTools 等），但它们似乎都专注于 DOM 交互和 AJAX 功能。我还没有发现任何专注于扩展内置数据类型（字符串、日期、数字等）的东西。我所说的“扩展”是指解决我们都有的典型日常工作问题的方法。

一个例子是 .NET String.Format() 方法。不仅更方便，而且使字符串连接的阅读和故障排除变得更好。虽然我已经为此创建了一个 String 原型方法，但我想看看是否已经开发了一个好的库来解决类似的生产力问题，然后再启动我自己的库。

Prototype 在这方面有一些有趣的方法，但是由于我已经决定使用 jQuery 来进行 DOM 工作，所以我真的不需要在每个页面上复制功能。

有人知道一个好的、精益的 Javascript 数据类型生产力库吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T06:50:01.647

大型 javascript 库避免使用应该真正存在的函数（String.trim、Array.shuffle !!）扩展通用对象原型是有充分理由的......如果每个库都扩展 String 对象以具有 trim() 函数，然后他们会互相覆盖 - 不好！

相反，jQuery 所做的是将这些函数放入 jQuery 对象中。`$.trim(String), $.inArray(value, Array)`等。不像扩展原型那样“整洁”，但更便携。

请记住在添加自己的功能之前考虑这一点！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T06:07:31.390

对于处理日期，我发现[DateJS](http://www.datejs.com/)非常有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T06:25:52.133

Microsoft AJAX 库对 JavaScript 基本类型有很多方便的扩展，包括 String.Format()：

[http://www.asp.net/AJAX/Documentation/Live/ClientReference/Global/](http://www.asp.net/AJAX/Documentation/Live/ClientReference/Global/)

# wcf - COM死了吗？

> ID：297985
> 
> 赞同：8
> 
> 时间：2008-11-18T06:13:28.617
> 
> 标签：wcf, com, components

在 WCF 上使用 COM 开发组件时，可以获得哪些深刻的优势？有什么可以用 COM 而不是 WCF 来完成的吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T06:23:06.007

不，它还没有死，但它已经死了，这是肯定的。您会看到仍有许多使用/需要 COM 的遗留系统，这向我们保证它将与我们一起使用几年，但从长远来看不会。

至于 WCF，可能有一些 COM 可以做而 WCF 不能做的边缘情况，但更重要的是，与遗留的东西相关的是，几乎每种语言都有 COM 绑定，您可以放在 Windows 堆栈上，但是 WCF 绑定还没有为所有人准备好（语言）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-18T06:27:17.137

取决于您要挖掘的系统深度。COM 永远不会“消亡”，就像非托管语言永远不会一样。

长话短说，如果您为 Vista+ 开发桌面应用程序，您可能不需要再费心使用 COM。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-18T15:39:58.270

我不认为COM已经死了。如果你看一下 Vista，它使用了很多 COM 架构/技术。Vista 中的所有东西都是 COM Dll/Exe。我觉得与 XP 相比，Vista 使用了太多的 COM。

如果我们想在 Vista 中扩展任何东西，我们必须使用 COM 实现接口。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-06-30T09:23:59.420

有几个不同的方面：

1.  将在多台计算机上运行并与多台计算机交互的组件（作为服务）
2.  仅在本地运行的组件，并通过 ABI 与多个供应商实现的组件交互。
3.  由单个供应商创作的组件，无需与第三方组件交互。
4.  来自多个供应商的组件以源代码形式提供，可以编译到单个应用程序中。

（ABI = 应用程序二进制接口。COM 是 ABI 的一个示例。）

对于方面 1，COM 几乎已经死了。

方面 2 仍然需要 COM，并且将继续需要。Windows Imaging Component 是这种可扩展性的一个很好的例子，它允许任何人实现新的图像编解码器。.Net 在这方面是一个强有力的竞争者。

对于方面 3，COM 仍然值得考虑，但这是每个软件供应商做出的决定。内部使用的组件开发商可能有一天会作为产品出售。.Net 似乎也是一个不错的选择。

For aspect 4, one can simply adapt and combine the source codes from many open-source projects. There is no need for COM, or any ABI.

COM as an unmanaged ABI is, unfortunately, difficult to defend against bugs because the code and data are in the same memory space, and the stack is used for both data and execution call stack. Any exploitable hole in one COM component can be used to cause instability in any other COM components loaded into the same address space.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T07:12:57.170

如果我没记错的话，.NET 旨在取代 COM 和 WFC 等技术。是否有理由（除了遗留代码）选择 COM 或 WFC 而不是 .NET？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-06T23:55:05.243

The COM is dead, long live the COM.

Windows 8 follows an interesting curve.

[http://kennykerr.ca/2011/10/18/the-road-to-windows-8/](http://kennykerr.ca/2011/10/18/the-road-to-windows-8/)

[http://msdn.microsoft.com/en-us/library/windows/apps/hh699871.aspx](http://msdn.microsoft.com/en-us/library/windows/apps/hh699871.aspx)

# sql-server-2008 - Win2k8 + SQL Server 2008 x64 - AMD Quad Opteron vs Intel Quad Xeon - 真正的基准

> ID：297994
> 
> 赞同：0
> 
> 时间：2008-11-18T06:24:15.193
> 
> 标签：sql-server-2008, hardware, intel, amd-processor

我们正在获得新的服务器。试图弄清楚 AMD 与英特尔的圣战。有没有什么地方可以找到这两个处理器系列的无偏见性能比较？我是否应该停止担心这个并将其归档到“没关系”类别中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T10:55:50.183

我的#1 基准网站是[anandtech](http://www.anandtech.com)。我发现他们的评论非常完整。

现在，根据您的服务器使用情况，Opteron 或 Xeon 可能给您带来的额外 n% 可能对您来说很重要，也可能不重要。在比较 CPU 和基准时，请始终考虑您将给予服务器的使用情况。

# list - Prolog：过滤列表？

> ID：297996
> 
> 赞同：18
> 
> 时间：2008-11-18T06:24:50.513
> 
> 标签：list, filter, prolog, meta-predicate

我目前正在做一个关于 Prolog 的非常短的项目，只是在尝试将我创建的“过滤器”应用于列表时遇到了困难。我已经准备好你可以称之为过滤器的东西，但我无法应用它。如果我说明一下会更好：

```
filter(A, B) 
```

...如果满足某些条件，则输出“真”。

```
filterList(A, [X, Y, Z]) 
```

...输出一个列表，其中包含第二个参数中使过滤器输出为**false**的所有元素。（因此，如果 filter(A, X) 为真，则输出为 [Y, Z] ）。

我已经准备好“过滤器”函数，但现在我需要将它应用到列表中，如第二个示例所示，不包括使用第一个参数应用时过滤器返回 true 的所有元素。

因此，如果过滤器是简单的 A == B，则该函数应该接收 A [A,B,A,C,D,A] 并输出 [B,C,D]，并删除所有显然，过滤器适用。

我在函数的基本结构上遇到了麻烦，所以如果有人可以为这样的函数提供一个基本的大纲，那将会有很大的帮助。我已经尽可能地简化了我的情况，所以我可以接受你可以提供的任何东西，并根据我的需要进行修改。

提前致谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-03T21:28:06.753

SWI-Prolog 提供`exclude/3`和其他此类元谓词。您的原始问题可以这样编码：

```
are_identical(X, Y) :-
    X == Y.

filterList(A, In, Out) :-
    exclude(are_identical(A), In, Out). 
```

使用示例：

```
?- filterList(A, [A, B, A, C, D, A], Out).
Out = [B, C, D]. 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-18T18:21:58.647

如果您在 Prolog 中搜索高阶函数，您应该明确参考[Naish (1995)](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.35.4505)，这是一个非常好的资源。

他的定义`filter/3`如下（他使用差异列表符号，因此不必定义`filter/4`）：

```
 filter(_,[],[]).
filter(P, A0-As0, As) :-
    (
        call(P, A0) -> As = A0-As1
    ;
        As = As1
    )
    , filter(P, As0, As1). 
```

我对这个谓词有疑问，请在评论中问我。强烈推荐阅读这篇论文，它还定义了`map`,`foldr`和`compose`! 请注意，他提到的许多限制（例如，缺失`call/3`或高阶`apply`不再适用。SWI-Prolog 具有`=..`运算符，它解决了他的所有问题并使任意 n 阶逻辑成为可能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-02-26T21:02:42.620

将谓词的成功或失败作为过滤标准的过滤函数存在一个固有问题：生成的程序不再是纯单调程序。因此，它失去了所有的声明性属性——唯一剩下的含义是程序上的逐步解释。这是一个纯粹的、具体化的过滤版本，使用[`if_/3`](https://stackoverflow.com/a/27358600/772868)：

```
tfilter(_CT_2,    [], []).
tfilter(CT_2, [E|Es], Fs0) :-
   if_(call(CT_2,E), Fs0 = [E|Fs], Fs0 = Fs ),
   tfilter(CT_2, Es, Fs). 
```

因此，第一个参数是一个闭包/延续，它将接收两个进一步的参数：元素和结果真值。

```
=(X,X,true).
=(X,Y,false) :- dif(X,Y). 
```

现在，结果仍然准确：

```
| ?- tfilter(=(X),[A,B],Xs).
B = A,
X = A,
Xs = [A,A] ? ;
X = A,
Xs = [A],
dif(A,B) ? ;
X = B,
Xs = [B],
dif(B,A) ? ;
Xs = [],
dif(X,A),
dif(X,B) ? ;
no 
```

有四种可能性如何通过等于 的标准过滤两个元素的列表`X`。每个元素可能相同也可能不同。

这种方法的缺点是必须提供所有标准的具体版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T06:54:06.350

好吧，你知道我刚刚想通了。所以，这是我提交我自己问题的答案，正如预期的那样，一个非常短的函数完成了这项工作：

```
filterList(_,[],R,R).           % Returns answer when the list is exhausted.
filterList(L,[A|List],Temp,Res) :-
   filterList(L,List,New,Res),  % Recursive call, New is either the same list
   (  filter(L,A),              % in case the filter outputs true, or the list
      New = Temp
   ;  New = [A|Temp]            % plus the current element otherwise.
   ). 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-09-28T18:20:34.943

我得到了一个国家的成年人 // Obtengo los adultos de un pais, Country = Pais, People = Personas, Person = una sola Persona

```
habitants(USA, [juan, pedro, david])

adults(Adults, Country) :-
     findall(Person, (habitants(Country,People), member(People, Person), adult(Person)), Adults) 
```

这是序言中的过滤器 // Asi es un filter en prolog

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-01-31T23:12:29.303

```
filter(_,[],[]).
filter(Predicate,[First|Rest],[First|Tail]) :-
   filter(Predicate,Rest,Tail).
filter(Predicate,[_|Rest],Result) :-
   filter(Predicate,Rest,Result). 
```**********