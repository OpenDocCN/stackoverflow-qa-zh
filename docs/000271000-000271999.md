# StackOverflow 问答 000271000-000271999

# c# - 有人知道 FFMPEG 的一组 C# 绑定吗？

> ID：271003
> 
> 赞同：34
> 
> 时间：2008-11-07T01:47:16.247
> 
> 标签：c#, .net, binding, ffmpeg

有谁知道 C# 的一组绑定来直接驱动 FFMpeg 库？我可以直接外壳到 ffmpeg.exe，但我发现很难同步/控制作为一个单独的进程。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T01:54:00.413

我看过这个库：

[**ffmpeg-sharp**](http://code.google.com/p/ffmpeg-sharp/) FFmpeg 多媒体套件上的一个包装器库，它提供了易于使用的包装器，可在 C# 中使用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-07T02:14:41.243

作为一个单独的过程，它实际上很容易控制。如果您重定向 StandardOut 和 StandardError，那么您可以订阅 Process.OnData* 事件并接收命令行输出。然后使用正则表达式解析状态行并计算出完成百分比等内容就足够简单了。

最难的事情是弄清楚要通过什么命令行才能获得不错的质量！如果您使用 H.264/AAC+ ，我会推荐[此页面](http://rob.opendot.cl/index.php/useful-stuff/ffmpeg-x264-encoding-guide/)和[此页面。](http://ffmpeg.x264.googlepages.com/mapping)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-16T20:58:36.043

Tao.ffmpeg：[http](http://www.taoframework.com/project/ffmpeg) ://www.taoframework.com/project/ffmpeg 它编译并具有二进制 dist，这对于 ffmpeg-sharp 来说已经超出了这一点。然而，它并不是特别容易使用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-02-09T05:02:55.073

[http://jasonjano.wordpress.com/2010/02/09/a-simple-c-wrapper-for-ffmpeg/](http://jasonjano.wordpress.com/2010/02/09/a-simple-c-wrapper-for-ffmpeg/)

# scripting - 最好的 IT/后台系统黑客？

> ID：271007
> 
> 赞同：16
> 
> 时间：2008-11-07T01:48:22.890
> 
> 标签：scripting, automation

很多人都有他们的系统为他们或他们的团队做的事情。源代码控制提交后挂钩是一个标准示例：拥有一个自动构建系统，可以检查最新的源代码、编译、测试和打包它是我们大多数人可能使用的后台黑客。

你还做过哪些很酷的事情？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-11T12:27:08.430

我们团队中有一位不熟悉颠覆冲突概念的开发人员。他推断，如果他只是删除代码中所有奇怪的东西并单击解决一切正常（即取消文件中的所有其他更改......）

不管怎么说，在第 5 次发生这种情况之后，以及第 5 次我不得不解释为什么我刚刚关闭的那个缺陷再次出现之后，我写了一个脚本。

它会对文件的更改进行比较，以查看连续签入是否删除了所有先前的更改以及它们是否由无名开发人员完成。

然后它会向老板发送一封电子邮件，描述发生的事情，以及在签到过程中丢失了多少工作。

没有第 7 次出现。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-21T20:23:58.837

我们有一个红绿灯，可以显示我们的日常构建是否成功、测试失败或根本没有构建。

此外，我们有一个灯条，每当我们收到客户上传的内容时，它会亮几秒钟。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-07T01:58:29.047

我们没有 24x7 的人员，但我们有整晚运行的关键流程。我们创建了一个内部警报系统，以通知我们严重的系统问题、失败的关键任务流程等。它使用文本到语音来创建描述性消息，然后连接到我们的自动拨号器以呼叫适当的人员信息。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-12T22:11:22.053

在一家网页设计公司工作时，我配置了我们的开发服务器，以便我们可以通过子域名实时查看项目的工作副本。因此，如果您的名字是 joe，并且您正在研究 jetfuel 项目，您会去`joe.jetfuel.test-example.com`并且您可以立即看到您的更改而无需提交。

这是一个使用子域名作为部分目录结构的简单 hack。我们的 htdocs 路径看起来像这样`htdocs/tag/project`。我们有一个脚本（您可以通过它访问的一个 php 应用程序`setup.test-example.com`），它会为您创建一个新的标签名称并检查您想要的任何版本并调用该项目的部署脚本。如果成功，它会将您转发到新的子域。然后，您可以通过 samba 共享来处理这个新副本。

这对我们来说非常有效，因为我们总是部署到相同的 linux 版本，而且我们的项目有简单的数据库要求。

我们这样做的最初原因是因为我们的开发人员在各种不同的平台上工作。除了修复这个平台问题之外，这对于查看更改和测试来说也很棒。我们有各种各样的标签，从人名、行李箱版本、测试标签，一直到原型，如`jquery-menu-hack.jetfuel.test-example.com`

现在回想起来，我想知道运行虚拟机会容易得多。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-12T22:21:12.000

我们有一个开发人员在一个不相信源代码控制的经典 ASP 站点上工作。代码从他的机器直接进入生产箱。这会导致丢失更改或无法恢复到稳定版本的问题。由于 CruiseControl.Net 具有监视目录的能力，因此我添加了一个项目，该项目在将文件复制到生产环境时实际签入文件。完全背离了 CC.Net 的初衷，但我们没有丢失任何代码。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-13T04:40:52.540

放入一个 pre-commit 钩子来检查 bug 注释是指一个打开的 bug，分配给执行签入的用户。（SCMBug 可以做到这一点）。

然后让生活真正有趣，拼写检查评论！提交注释，以及代码中的注释。（拼写是我的伙伴）

通过设置为公司标准的代码格式化程序运行代码；并将其与原始文件进行比较：如果不是公司官方格式：拒绝提交。

使用单元测试构建进行覆盖测试。

将所有错误/错误通过电子邮件发送给开发团队。

我漏掉了开发者的名字。他们知道他们做到了。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-13T01:21:02.287

不完全是 hack，而是 IT 开发工作的一些必备品：

如果你使用颠覆，你必须使用 CommitMonitor。( [http://tools.tortoisesvn.net/CommitMonitor](http://tools.tortoisesvn.net/CommitMonitor) ) 它可以让您监控 svn 存储库中的新提交，然后查看新提交。如果您想掌握团队正在做的事情，那就太好了。特别是如果您有几个需要监视的后辈。;)

Rsnapshot ( [http://www.rsnapshot.org/](http://www.rsnapshot.org/) ) 也非常宝贵 - 我们每四个小时对整个文件系统进行一次完整的备份快照，可以追溯到 2 年前，之后的每一天。它就像您的文件系统的数据立方体！这给人的安心是纯粹的幸福。:)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-07T02:01:27.323

几乎没有破解，但早在我们快速的 VAX 11/730 上，如果出现问题，我们的夜间流程会在打印机上打印文件“BLAMMO.TXT”。每天早上进来的第一站就是打印机。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-13T05:01:35.970

回到大约 9 年前的 dotCom 时代，我不得不破解两个不同位置之间的故障转移系统。我们有一个时髦的设置，带有一个 powerbuilder 前端网站和一个 powerbuilder 管理工具。数据存储在 MSSQL 7.0 中。网络服务器使用 IPX 与 SQL Server 通信（不要问）。无论如何，我负责制定故障转移计划。

我最终将一些 linux 机器组合在一起，并让它们运行我们的外部 DNS。每个位置一个。我们有一个带有网络服务器的远程站点和 sql server，我让 SQL 事务复制通过 128k ISDN IPX 连接（所有事物）工作。然后在我们的生产站点构建了一个监控工具，将数据包发送到各个上游网络切换。如果我们经历了超过 20% 的主站点中断，监控工具会在 Debian 机器上运行一个 perl 脚本来更改 DNS 并指向我们的第二个站点。我们的辅助服务器有一个带有我们的主 DNS 和监控站的心跳。它会复制记录，除非它失去两个连接，然后它会翻转以将 DNS 指向备份位置。

主站点将关闭主位置的 SQL 服务器以中断复制。使用 128k ISDN IPX 连接自动进行站点到站点故障转移 :)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-12T19:54:10.293

回到我以前的工作，我们必须审核许多表的数据更改（插入、更新和删除）。我们的支持人员必须能够搜索这些数据以找到用户所做的更改。

已成为半永久性的临时解决方案是存储每个非选择查询。然而，这是一个大型系统，该表每天会增长约 1.5GB。

我想出的解决方案是为外部列表中的所有表创建一个脚本，创建适当的触发器来审计每个表、行、列、之前和之后、何时以及由谁，并将其存储在我们的新审计表中。该表的大小比旧版本增加了约 10%，并且存储了更多可用数据。它使我们能够创建一个 UI 来搜索和查看对我们的数据所做的每一个更改，而无需我们的支持团队或业务用户了解任何 SQL。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-13T05:14:26.373

这是一个较低的水平，但我为我为我的研究编译代码而编写的 make 文件感到相当自豪。它只需要给出你的源文件名和头文件名，它们可以自己处理其余的事情（尽管它确实做了一个假设，即你不会将任何头文件编译成对象，只编译源文件）。另一个缺点是它依赖于 GNU make 程序的第二个扩展特性，所以我不知道它是否适用于其他 make 程序。此外，使用的编译器需要支持类似于 gcc 的 -MM 功能的功能。这里希望没有人嘲笑它。

```
-include prereqs.mk
HEADERS=$(SRC_DIR)/gs_lib.h $(SRC_DIR)/gs_structs.h
SOURCES=$(SRC_DIR)/main.cpp $(SRC_DIR)/gs_lib.cpp
OBJECTS=$(patsubst $(SRC_DIR)/%.cpp,$(OBJ_DIR)/%.o,$(SOURCES))

release: FLAGS=$(GEN_FLAGS)$(OPT_FLAGS)
release: $(OBJECTS) prereqs.mk
    $(CXX) $(FLAGS) $(LINKER_FLAGS) $(OUTPUT_FLAG) $(EXECUTABLE) $(OBJECTS)

prereqs.mk: $(SOURCES) $(HEADERS)
    $(CXX) $(DIR_FLAGS) $(MAKE_FLAG) $(SOURCES) | sed 's,\([abcdefghijklmnopqrstuvwxyz_]*\).o:,\1= \\\n,' > $@

.SECONDEXPANSION:
$(OBJECTS): $$($$(patsubst $(OBJ_DIR)/%.o,%,$$@))
    $(CXX) $(FLAGS) $(NO_LINK_FLAG) $(OUTPUT_FLAG) $@ $(patsubst $(OBJ_DIR)/%.o,$(SRC_DIR)/%.cpp,$@) 
```

显然我放弃了一些变量的定义，但我认为它可以理解这个想法。

由于我的编码工具和风格与此脚本的要求兼容，我喜欢使用它。添加（a）新的源代码所需要做的就是将其名称添加到适当的变量中，其余的都被处理了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-13T14:11:34.837

我们有许多项目的 Twitter 帐户，这些帐户会发布诸如提交消息、构建通知、失败的单元测试、部署、错误跟踪活动等与项目相关的任何类型的事件。运行像 Twitter Gwibber 这样的客户端（它会为每个新状态显示一个弹出窗口）是与您感兴趣的项目活动保持联系的好方法。使用 Twitter 很好，因为您可以利用所有 3rd 方应用程序 - 例如 iPhone 客户端。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-16T15:23:11.040

为具有纹理/图像的绝对路径的 VRML/3d 模型文件添加提交挂钩检查。`f:/maya/my-textures/newproject/xxxx.png`只是不属于服务器。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-02-14T10:29:07.453

早在 1993 年，当源代码控制系统非常昂贵且笨拙时，我工作的公司有一个内部源代码控制构建为 4DOS 脚本。它不像大多数当前的源代码控制系统那样复杂，例如它没有分支或集成，但它完成了支持修订历史记录、签出/签入和基本冲突解决的基本工作。

# sql-server - 我应该在我的 DEV 机器上安装 SQL Server 2008 吗？

> ID：271014
> 
> 赞同：1
> 
> 时间：2008-11-07T01:52:33.397
> 
> 标签：sql-server, sql-server-2005, sql-server-2008, comparison

我想知道当我们的生产服务器是 2005 时，在我的开发机器上安装 SQL Server 2008 是否会遇到问题？例如，是否发生了一些变化，以至于我的 2005 数据库/sps/函数/视图无法正常工作或我应该考虑的其他问题？

想这样做只是为了测试新的 SQL Server，但仍然能够开发旧产品，并且不想同时安装这两个...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T01:58:09.563

我只在我的开发机器上使用 SQL Server 2008 来对抗生产 SQL Server 2005 系统，还没有遇到任何问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T02:30:43.147

我个人不会。我更喜欢让我的开发机器尽可能接近真实环境的副本（至少在软件方面；物理分离有点困难！）。

这两个版本在很多方面都非常相似，并且 SQL Server 2008 确实支持兼容模式，但无论您做什么，它*实际上*都不是SQL Server 2005。如果您的生产服务器没有使用 2008，那么您就无法利用无论如何，它的功能，所以你所做的只是增加一些工作不完全相同而不获得任何好处的机会。

您想这样做的原因大概是玩转 2008 年，看看它的新功能是什么？在这种情况下，我建议您使用 SQL Server 2008 构建一个虚拟机，然后您可以随心所欲地玩耍，而不会危及您正常工作所需的环境。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T02:31:36.827

请注意，某些工具可能尚未正确连接到 SQL2008。

示例是 VS-DBPro2008。如果不安装 GDR-RC，您将无法使用大多数有用的功能，它仍然很脆弱。

此外，如果您在 2008 上构建某些东西，您将无法从 2008 -> 2005 分离/附加或备份/恢复。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T01:58:07.910

我已经做到了，没有太多麻烦。创建数据库时，可以选择兼容模式，例如 2005 或 2000。

您可能还会发现这很有帮助：SQL Server 2008 中数据库引擎功能的重大更改 [http://msdn.microsoft.com/en-us/library/ms143179.aspx](http://msdn.microsoft.com/en-us/library/ms143179.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T02:50:27.350

是的。即使我们的生产系统是 2005 年，我们也确实这样做了，并且遇到的问题很少。虽然您需要了解一些兼容性问题，但也有一些好处：

*   Sql Management Studio 基于 VS 2008，因此如果您使用的是 VS 2008，则不会安装 VS 2005
*   Sql Management Studio 速度更快，并且支持一些不错的新功能，例如智能感知

我们的构建机器有运行我们所有的单元和集成测试的 Sql 2005。我们模拟生产系统的开发和生产测试虚拟机也运行 Sql 2005。这样我们确保我们的 SQL 和 DDL 与生产兼容。

你不可能有一个复制你的生产环境的开发环境。我们只是在机器上安装了太多东西来完成我们的工作或停机。

# sql-server - 设计存储过程以创建 XML 树

> ID：271015
> 
> 赞同：0
> 
> 时间：2008-11-07T01:53:01.570
> 
> 标签：sql-server, stored-procedures

我需要在 SQL Server 中编写一个存储过程，其返回的数据将用于生成 XML 文件。

我的 XML 文件的结构为

```
<root>
<ANode></ANode>
<BNode></BNode>
<CNode>
  <C1Node>
    <C11Node></C11Node>
    <C12Node></C12Node>
  </C1Node>
  <C2Node>
    <C21Node></C21Node>
    <C22Node></C22Node>
  </C2Node>
  <C3Node>
    <C31Node></C31Node>  
    <C32Node></C32Node>  
  </C3Node>  
</CNode>
</root> 
```

我的问题是，在存储过程中，我们可以选择 ANode 和 BNode 的值作为简单的 SELECT 语句，例如

```
Select ANodeVal,BNodeVal from Table 
```

但是如何设计存储过程来获取 CNode 的记录，CNode 是一个子树，除了正常的 ANode 和 BNode 之外，每个记录中都有 3 个或更多（动态）单独的节点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T03:50:12.253

我不建议在存储过程中执行此操作。如果使用 C#/Python 或 Java 等语言创建，将使代码可单元测试且更易于维护。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T23:20:43.173

看

    [嵌套返回 XML 的标量值函数](https://stackoverflow.com/questions/147897/in-sql-server-can-i-insert-multiple-nodes-into-xml-from-a-table#148877)

Once you get the hang of the nesting, and are willing to write the number of scalar-valued functions necessary to construct the node segments from the bottom up (I wouldn't want lots of these laying around), then it's not so hard.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T03:55:06.283

如果您能够修改数据库设计，请考虑将每个节点保留为记录，而不是列（如示例 select 语句所示）。

例如，每一行可能包含以下字段：

*   行 ID
*   父行 ID
*   姓名
*   行数据

我假设您将数据传递给应用程序，因为您指出返回的数据将用于生成 XML。在这种情况下，存储过程将只是一个`SELECT`语句，将格式留给应用程序。

XML 引擎的大多数实现应该允许您将子节点添加到现有的父节点。XML 在内存中构建，然后通过任何必要的方法“导出”以获得所需的最终结果。

# tsql - 如何在 T-SQL 中最小化表的辅助扫描描述符的数量？

> ID：271021
> 
> 赞同：0
> 
> 时间：2008-11-07T01:58:09.173
> 
> 标签：tsql, indexing, types, sybase

我最近看到遗留系统上的存储过程偶尔会出现问题，它会显示如下错误消息：

> 服务器消息：编号 10901，严重性 17：此查询需要*X*个辅助扫描描述符，但目前只有*Y*个辅助扫描描述符可用。要么提高“辅助扫描描述符数量”配置参数的值，要么稍后尝试查询。

其中*X*略低于*Y*。Sybase 手册很有用地告诉我应该重新设计我的表以使用更少的辅助扫描描述符（如何？！），或者增加系统上可用的数量。奇怪的是，它多年来一直运行良好，唯一改变的是我们修改了几列的数据类型并添加了一个索引。任何人都可以对此有所了解吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T09:55:51.500

您没有说您使用的是哪个版本的 Sybase，但以下内容适用于 ASE 12.5 及以后的版本。

我怀疑是新索引的添加导致该存储过程的查询计划被抛出。你试过跑步吗

```
update statistics *table_name* 
```

在上面？如果失败，您可以通过运行找出您有多少扫描描述符

```
sp_monitorconfig "aux scan descriptors" 
```

然后通过运行增加它

```
sp_configure "aux scan descriptors", x 
```

其中 x 是您需要的扫描描述符的数量。

如果您希望减少存储过程正在使用的扫描描述符的数量，那么根据[这里](http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.sag1/html/sag1/sag1249.htm) 您必须

*重写查询，或使用临时表将其分解为多个步骤。对于 DOL 锁定表，如果有很多表扫描，请考虑添加索引。*

但是如果没有看到查询计划，就不可能给出更具体的建议。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T23:43:56.603

这是提交了 CR 的 Sybase 12.5.2 中的缺陷，请参阅[此列表](http://web.archive.org/web/20131003092614/http://www.sybase.com/detail?id=1038862)中的问题 361967 。它已针对 12.5.3 及更高版本进行了修补。

# java - 从java中的cookie读取电子邮件字符串

> ID：271031
> 
> 赞同：3
> 
> 时间：2008-11-07T02:02:42.937
> 
> 标签：java, javascript, email, struts2, cookies

我的应用程序需要将用户电子邮件地址存储在 cookie 中，以便我可以预先填充登录表单`(username == email address)`。我在 JavaScript 中设置了 cookie 值。如果我从 JavaScript 读取它，我会得到`foo@bar.com`. 如果我在 Firefox 的 cookie 查看器中查看它，我会得到`foo@bar.com`.

但是，当我尝试在 Java 的服务器端读取它时，我只得到`foo`.

我需要在这里进行某种编码/解码吗？如果是这样，我该如何以一种可以被 JavaScript 和 Java 解码的方式来做到这一点？

提前致谢！-迈克尔

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T03:12:44.263

来自setValue(String)的[javax.servlet.http.Cookie文档：](http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/http/Cookie.html#setValue(java.lang.String))

> 创建 cookie 后为 cookie 分配一个新值。如果您使用二进制值，您可能需要使用 BASE64 编码。
> 
> 对于版本 0 cookie，值不应包含空格、方括号、圆括号、等号、逗号、双引号、斜杠、问号、***at 符号***、冒号和分号。空值在所有浏览器上的行为方式可能不同。

我猜你需要在输入（通过 JavaScript）和输出（通过 Java）的途中对其进行 BASE64 编码

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T20:40:48.627

我找到了两种解决方案。这是第一个。

添加回填充到 Base64 编码的字符串。灵感来自[http://fi.am/entry/urlsafe-base64-encodingdecoding-in-two-lines/](http://fi.am/entry/urlsafe-base64-encodingdecoding-in-two-lines/)

在这个解决方案中，JavaScript 保持不变（base64 对所有内容进行编码），服务器端如下所示：

```
public class CookieDecoder {

private static final Log log = LogFactory.getLog(CookieDecoder.class);

/**
 * @param cookieValue The value of the cookie to decode
 * @return Returns the decoded string
 */
public String decode(String cookieValue) {
    if (cookieValue == null || "".equals(cookieValue)) {
        return null;
    }
    if (!cookieValue.endsWith("=")) {
        cookieValue = padString(cookieValue);
    }
    if (log.isDebugEnabled()) {
        log.debug("Decoding string: " + cookieValue);
    }
    Base64 base64 = new Base64();
    byte[] encodedBytes = cookieValue.getBytes();
    byte[] decodedBytes = base64.decode(encodedBytes);
    String result = new String(decodedBytes);
    if (log.isDebugEnabled()) {
        log.debug("Decoded string to: " + result);
    }
    return result;
}

private String padString(String value) {
    int mod = value.length() % 4;
    if (mod <= 0) {
        return value;
    }
    int numEqs = 4 - mod;
    if (log.isDebugEnabled()) {
        log.debug("Padding value with " + numEqs + " = signs");
    }
    for (int i = 0; i < numEqs; i++) {
        value += "=";
    }
    return value;
}
} 
```

在 JavaScript 方面，您只需要确保对值进行 base64 编码：

```
var encodedValue = this.base64.encode(value);
document.cookie = name + "=" + encodedValue + 
                  "; expires=" + this.expires.toGMTString() + 
                  "; path=" + this.path; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T20:45:16.030

第二种解决方案只是对 Base64 编码的字符串进行 URLEncode。我在这里使用公共编解码器进行编码。Java 代码：

```
public class CookieDecoder {

    private static final Log log = LogFactory.getLog(CookieDecoder.class);

    /**
     * @param cookieValue The value of the cookie to decode
     * @return Returns the decoded string
     */
    public String decode(String cookieValue) {
        if (cookieValue == null || "".equals(cookieValue)) {
            return null;
        }
        if (log.isDebugEnabled()) {
            log.debug("Decoding string: " + cookieValue);
        }
        URLCodec urlCodec = new URLCodec();
        String b64Str;
        try {
            b64Str = urlCodec.decode(cookieValue);
        }
        catch (DecoderException e) {
            log.error("Error decoding string: " + cookieValue);
            return null;
        }
        Base64 base64 = new Base64();
        byte[] encodedBytes = b64Str.getBytes();
        byte[] decodedBytes = base64.decode(encodedBytes);
        String result = new String(decodedBytes);
        if (log.isDebugEnabled()) {
            log.debug("Decoded string to: " + result);
        }
        return result;
    }
} 
```

但现在我也必须在 JavaScript 端对其进行解码......编码：

```
var encodedValue = this.base64.encode(value);
document.cookie = name + "=" + escape(encodedValue) + 
                  "; expires=" + this.expires.toGMTString() + 
                  "; path=" + this.path; 
```

解码：

```
var nameEQ = name + "=";
var ca = document.cookie.split(';');
for(var i = 0; i < ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0)==' ') {
        c = c.substring(1,c.length);
    }
    if (c.indexOf(nameEQ) == 0) {
        var encodedValue = c.substring(nameEQ.length,c.length);
        return this.base64.decode(unescape(encodedValue));
    }
}
return null; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T02:14:33.273

您需要转义 cookie 的值部分。

```
document.cookie = name + "=" +escape( value ) 
    + ( ( expires ) ? ";expires=" + expires_date.toGMTString() : "" )
    + ( ( path ) ? ";path=" + path : "" ) 
    + ( ( domain ) ? ";domain=" + domain : "" ) 
    + ( ( secure ) ? ";secure" : "" ); 
```

# c++ - 使用 Visual Studio 2005 调试时调用函数？

> ID：271042
> 
> 赞同：10
> 
> 时间：2008-11-07T02:18:27.260
> 
> 标签：c++, visual-studio, debugging, visual-c++-2005, watch

我知道这可能是可能的，但我从来没有设法
在 VS2005(C++) 中，在调试时，能够从我正在调试的代码中调用一个函数。
当调试复杂的数据结构时，这个特性有时是必不可少的，仅使用观察窗口的正常功能就无法轻松地探索这些数据结构。
监视窗口似乎允许编写函数调用，但每次我尝试它都会给我一个或另一个错误。

`Error: symbol "func" not found`
`Error: argument list does not match function`
`Error: member function not present`

有没有人成功地使这项工作正常进行？我在这里想念什么？

**编辑：**显然，调用的函数应该是调试器所在的当前范围内存在的符号。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T02:45:18.843

好的，这就是我发现
CXX0040 的意思是“ `The C expression evaluator does not support implicit conversions involving constructor calls.`”
CXX0047 的意思是“ `Overloaded functions can be called only if there is an exact parameter match or a match that does not require the construction of an object.`”

如此结合意味着如果我想调用一个函数，则任何参数都不应该有隐式转换，并且任何参数都不应该需要构造。
在这种情况下，“隐式转换”似乎包括一些琐碎的事情，比如转换`'String'`为`'const String&'`.
“构造”似乎包括微不足道的复制构造。所以通过值传递任何不是原始类型的东西都会导致错误。

**所以这基本上留下了只接受原始类型或指针的函数。**
我刚刚成功地测试了这个理论。

因此，如果您希望能够从监视窗口调用方法，请添加一个仅采用指针和原语的重载，并在监视窗口中适当地传递参数。传递一个不是原始对象的对象，传递它的地址。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T02:21:42.603

监视窗口受当前代码所在上下文的限制，例如，当您的代码进入一个函数并且您尝试访问隐藏在当前函数范围之外的另一个函数时，它将不起作用。

如果您在监视窗口中调用一个函数，请确保它在当前范围内可见且可访问。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T02:22:29.140

据我所知，在调试非托管 C++ 时，您无法从 Watch 窗口执行代码。这确实适用于 C#（可能还有 VB.NET 和托管 C++，但我对此并不积极）。它很可能允许它，因为它适用于某些语言，但不适用于其他语言。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T02:34:43.607

我们发现这非常成功。一些非常简单的函数（包括成员函数）可以工作，通常是简单的属性获取器。其他更复杂的功能不起作用并给出错误。

我一直无法辨别确切的规则...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T03:23:21.013

我没有对此进行测试，但我一直认为这就是即时窗口的用途（执行代码）

卡梅伦

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T03:55:02.260

这是您想要的“立即”窗口。而且您仅限于从当前断点所在的位置可见的内容。局部变量和该类（或全局变量）上的函数

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T08:55:04.743

根据我的经验，即时窗口存在一些缺点。如果类来自不同的 DLL，则不能调用类的成员函数，但会收到误导性错误消息。如果有任何东西在同一个 DLL 中（例如通过静态链接所有其他东西），调用成员是相当可靠的。但正如其他人所提到的，复杂的东西可能会也可能不会起作用。

# php - jquery $.post 空数组

> ID：271043
> 
> 赞同：4
> 
> 时间：2008-11-07T02:18:36.010
> 
> 标签：php, jquery, ajax, post

我正在使用 jQuery 将表单发布到 php 文件，使用简单的脚本来验证用户详细信息。

```
var emailval = $("#email").val();
var invoiceIdval = $("#invoiceId").val();

$.post("includes/verify.php", 
       {invoiceId:invoiceIdval , email:emailval },
       function(data) { 
          //stuff here.
}); 
```

PHP代码：

```
<?php
print_r($_POST);
?> 
```

我查看了萤火虫中的响应，它是一个空数组。数组应该至少有一些值。

我无法弄清楚为什么`$_POST`在 php 文件中不起作用。Firebug 显示帖子包含发布的内容、电子邮件和发票 ID，但在 php 文件中实际上没有收到任何内容。

表格：

```
<form method="post" action="<?=$_SERVER['PHP_SELF']; ?>" enctype="application/x-www-form-urlencoded"> 
```

有谁知道它在做什么？

谢谢

* * *

找到了这个 - [http://www.bradino.com/php/empty-post-array/](http://www.bradino.com/php/empty-post-array/)

那是一条明智的路线吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-07T02:46:12.540

`$.post()`将数据传递给默认设置的底层`$.ajax()`调用，`application/x-www-form-urlencoded`所以我不认为是这样。

你能试试这个：

```
var post = $('#myForm').serialize();    

$.post("includes/verify.php", post, function(data) { 
    alert(data);
}); 
```

该`serialize()`调用将获取所有当前数据`form.myForm`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T14:15:43.217

我被同样的问题所困扰，我发现欧文给出的解决方案不合适。你自己序列化对象，而 jQuery 应该为你做这件事。在这种情况下，你不妨做一个 $.get() 。

我发现在我的情况下，它实际上是从 /mydir 到 /mydir/ 的服务器重定向（带有斜杠），它使 POST 数组无效。请求被发送到 /mydir 中的 index.php

这是在本地机器上，所以我无法检查 HTTP 流量。如果我会这样做，我会更早发现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T02:32:59.930

```
application/x-www-form-urlencoded 
```

这就是你的答案。它正在发布，您只是在 $_POST 数组中寻找变量。你真正想要的是$_REQUEST。与名称相反，$_POST 包含在请求正文中提交的输入变量，与提交方法无关。$_GET 包含从 URL 的查询字符串解析的变量。如果您只想提交变量，请使用 $_REQUEST 全局变量。

如果您希望接收文件上传，那么您希望创建一个包含 $_FILES 内容的新数组：

$arguments = $_REQUEST + $_FILES;

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-06T18:47:37.063

我尝试了 Owen 给定的功能，但也收到了空白警报。奇怪，但我注意到它会输出一个查询字符串并返回一个空白警报。然后我会再次提交，它会以正确的帖子值提醒。

还使用 id 属性在 html 中设置了字段名称（这是在我遵循的 jquery 教程中完成的）。这不允许我的表单字段序列化。当我将 id 切换为 name 时，它​​解决了我的问题。

毕竟，我最终选择了 $.ajax，因为它满足了我的要求。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-09-14T08:18:54.707

在使用 jQuery 提交表单之前，我曾使用 jQuery 禁用所有输入（甚至是我想要的隐藏输入）。我将 jQuery 更改为仅禁用“按钮”类型的输入，现在在提交表单时会发布隐藏的变量！似乎如果您将隐藏输入设置为禁用，则其值不会随表单一起发布！

改变：

```
$('input').attr('disabled',true); 
```

到：

```
$('input[type=button]').attr('disabled',true); 
```

# asp.net-mvc - 在 MVC ASP.NET 中使用/显示 RSS 提要的简单方法

> ID：271045
> 
> 赞同：10
> 
> 时间：2008-11-07T02:21:20.887
> 
> 标签：asp.net-mvc, model-view-controller

我是 MVC 框架的新手，想知道如何将 RSS 数据从控制器传递到视图。我知道需要转换为某种类型的 IEnumerable 列表。我已经看到了一些创建匿名类型的示例，但无法弄清楚如何将 RSS 提要转换为通用列表并将其传递给视图。

我也不希望它是强类型的，因为会多次调用各种 RSS 提要。

有什么建议么。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T16:11:47.237

我一直在尝试一种在 MVC 中执行 WebPart 的方法，它基本上是包装在 webPart 容器中的 UserControl。我的一个测试 UserControls 是一个 Rss Feed 控件。我使用 Futures dll 中的 RenderAction HtmlHelper 扩展来显示它，以便调用控制器操作。我使用 SyndicationFeed 类来完成大部分工作

```
using (XmlReader reader = XmlReader.Create(feed))
{
    SyndicationFeed rssData = SyndicationFeed.Load(reader);

    return View(rssData);
 } 
```

下面是控制器和 UserControl 代码：

控制器代码是：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.Web.Mvc.Ajax;
using System.Xml;
using System.ServiceModel.Syndication;
using System.Security;
using System.IO;

namespace MvcWidgets.Controllers
{
    public class RssWidgetController : Controller
    {
        public ActionResult Index(string feed)
        {
            string errorString = "";

            try
            {
                if (String.IsNullOrEmpty(feed))
                {
                    throw new ArgumentNullException("feed");
                }
                    **using (XmlReader reader = XmlReader.Create(feed))
                    {
                        SyndicationFeed rssData = SyndicationFeed.Load(reader);

                        return View(rssData);
                    }**
            }
            catch (ArgumentNullException)
            {
                errorString = "No url for Rss feed specified.";
            }
            catch (SecurityException)
            {
                errorString = "You do not have permission to access the specified Rss feed.";
            }
            catch (FileNotFoundException)
            {
                errorString = "The Rss feed was not found.";
            }
            catch (UriFormatException)
            {
                errorString = "The Rss feed specified was not a valid URI.";
            }
            catch (Exception)
            {
                errorString = "An error occured accessing the RSS feed.";
            }

            var errorResult = new ContentResult();
            errorResult.Content = errorString;
            return errorResult;

        }
    }
} 
```

用户控件

```
<%@ Control Language="C#" AutoEventWireup="true" CodeBehind="Index.ascx.cs" Inherits="MvcWidgets.Views.RssWidget.Index" %>
<div class="RssFeedTitle"><%= Html.Encode(ViewData.Model.Title.Text) %> &nbsp; <%= Html.Encode(ViewData.Model.LastUpdatedTime.ToString("MMM dd, yyyy hh:mm:ss") )%></div>

<div class='RssContent'>
<% foreach (var item in ViewData.Model.Items)
   {
       string url = item.Links[0].Uri.OriginalString;
       %>
   <p><a href='<%=  url %>'><b> <%= item.Title.Text%></b></a>
   <%  if (item.Summary != null)
       {%>
        <br/> <%= item.Summary.Text %>
    <% }
   } %> </p>
</div> 
```

将后面的代码修改为具有类型化的模型

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.ServiceModel.Syndication;

namespace MvcWidgets.Views.RssWidget
{
    public partial class Index : System.Web.Mvc.ViewUserControl<SyndicationFeed>
    {
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-06-30T04:42:12.397

@Matthew - 完美的解决方案 - 作为倾向于打破 MVC 概念的代码的替代方案，您可以使用：

```
<%@ Page Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage<SyndicationFeed>" %>  
<%@ Import Namespace="System.ServiceModel.Syndication" %> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-12T16:32:29.443

使用 MVC，您甚至不需要创建视图，您可以使用 SyndicationFeed 类直接将 XML 返回到提要阅读器。

（编辑）[.NET ServiceModel.Syndication - 更改 RSS 提要的编码，](https://stackoverflow.com/questions/5452878/net-servicemodel-syndication-changing-encoding-on-rss-feed)这是一种更好的方法。（而是从这个链接中截取。）

[http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.syndicationfeed.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.syndicationfeed.aspx)

```
public ActionResult RSS(string id)
{            
     return return File(MyModel.CreateFeed(id), "application/rss+xml; charset=utf-8");
} 
```

在我的模型中

```
CreateFeed(string id)
{ 
        SyndicationFeed feed = new SyndicationFeed( ... as in the MS link above)

        .... (as in the MS link)

        //(from the SO Link)
        var settings = new XmlWriterSettings 
        { 
           Encoding = Encoding.UTF8, 
           NewLineHandling = NewLineHandling.Entitize, 
           NewLineOnAttributes = true, 
           Indent = true 
        };
        using (var stream = new MemoryStream())
        using (var writer = XmlWriter.Create(stream, settings))
        {
            feed.SaveAsRss20(writer);
            writer.Flush();
            return stream.ToArray();
         }

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T08:03:26.937

rss 是具有特殊格式的 xml 文件。您可以设计一个具有该通用格式的数据集，并使用 ReadXml 方法读取 rss(xml) 并将 uri 作为文件的路径。然后你就有了一个可以从其他类中使用的数据集。

# dll - 为什么会出现异常 - 无法加载 DLL '?????.dll'：找不到指定的模块

> ID：271062
> 
> 赞同：2
> 
> 时间：2008-11-07T02:31:59.603
> 
> 标签：dll, image-processing, interop, opencv

我正在使用 Emgu.CV，它是 OpenCV 库的 C# 包装器。

我将 Emgu.CV 源更改为从最新的 OpenCV 库 cv110.dll 而不是 cv100.dll 调用，现在我收到此错误（其中 ????? 是 cv110.dll）。我已将 cv110.dll 文件放置在与 cv100.dll 文件相同的位置，但这无济于事。

在更广泛的范围内，查找 dll 时的文件夹搜索顺序是什么，以及此错误是否还有其他原因。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-08T00:14:50.740

您需要 VCRT（Visual C 运行时）8.0 SP1，可从以下链接获得：

[http://www.microsoft.com/downloads/details.aspx?familyid=200B2FD9-AE1A-4A14-984D-389C36F85647&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=200B2FD9-AE1A-4A14-984D-389C36F85647&displaylang=en)

有关更多信息，请参阅 Emgu CV 论坛上的此帖子： [http ://www.emgu.com/forum/viewtopic.php?f=7&t=88](http://www.emgu.com/forum/viewtopic.php?f=7&t=88)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T02:41:06.900

这两个程序集之间似乎存在细微差别。没有代码很难说，但我建议你看看这个博客，特别是这篇文章：http: [//blogs.msdn.com/suzcook/archive/2003/05/29/57120.aspx](http://blogs.msdn.com/suzcook/archive/2003/05/29/57120.aspx)和[http:// /blogs.msdn.com/suzcook/archive/2003/08/11/57236.aspx](http://blogs.msdn.com/suzcook/archive/2003/08/11/57236.aspx) Suzanne Cooks 在 fusion/CLR 加载程序中工作，她的博客针对此类问题提供了大量提示和建议。

祝你好运！

# configuration - 建议的初始 Emacs 配置？

> ID：271063
> 
> 赞同：21
> 
> 时间：2008-11-07T02:32:56.310
> 
> 标签：configuration, emacs

我想尝试 Emacs，并想给它最好的机会。

为此，拥有一个好的`.emacs`文件似乎很重要。

我主要使用 Mac OS X（所以我看过 Aquamacs），而且我主要做 Python 编程，所以任何专门用于这方面的东西都会很棒。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-10T00:51:47.323

我建议从一个空白的 .emacs 文件开始。然后浏览教程和相关的博客文章，并随着你的学习成长。使用从别人那里借来的 .emacs 文件似乎有点错过了重点。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-07T05:23:18.523

这是一个很难的问题。我对 Emacs 的理论是你必须诚实地尝试一下**。**这意味着使用它几个月，而不是几天。这不适合胆小的人！理想情况下，emacs 将成为您唯一的文本编辑器，并且您以 emacs 的方式做事。

真的，为了给自己和 emacs 最好的机会，你应该学习足够的 elisp 来做你自己的基本定制。

事实上，我认为你的 .emacs 可能是关于给 emacs 最好的机会的阅读鲱鱼。相反，尝试一些 groovier 功能，如使用 pylint 的 flymake、劣质的 python 进程、使用 emacs 进行 python 调试都是值得的。尤其是劣质工艺是炸弹。

[EmacsWiki](http://www.emacswiki.org/cgi-bin/wiki/PythonMode)有一些关于 python 和 emacs 的好信息。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-07T02:37:54.973

我发现的最重要的配置更改不是针对您的 .emacs，而是针对您的操作系统。在“键盘和鼠标”系统偏好设置中，在“键盘”选项卡中，单击底部的“修改键...”，然后将“大写锁定”更改为“控制”。然后训练自己使用大写锁定键（在“A”的左侧）而不是角落里的控制键。这将使整个体验更加高效和舒适。

*请参阅：[Mac OS X Leopard 键绑定上的 Emacs](https://stackoverflow.com/questions/162896/emacs-on-mac-os-x-leopard-key-bindings#162907)*

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-07T03:45:30.953

请参阅以下相关问题：

*   [你的 .emacs 里有什么？](https://stackoverflow.com/questions/154097/whats-in-your-emacs)
*   [Emacs 和 Python](https://stackoverflow.com/questions/157018/emacs-and-python)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-08-31T18:07:30.767

您可以尝试以下扩展：

```
(require 'smooth-scrolling)
(require 'multiple-cursors)
(require 'ace-jump-mode)
(require 'expand-region)
(require 'inline-string-rectangle)
(require 'mark-more-like-this)
(require 'key-chord)
(require 'browse-kill-ring)
(require 'idle-highlight-mode)
(require 'htmlize)
(require 'icicles)
(require 'highlight-parentheses)
(require 'golden-ratio)
(require 'projectile)
(require 'helm-projectile)
(require 'rainbow-mode)
(require 'anything-config)
(require 'highlight-symbol)
(require 'markerpen)
(require 'flyspell) 
```

你也可以区分TAB和Ci，然后你会有一个更简单的快捷键。

```
(define-key input-decode-map (kbd "C-i") (kbd "H-i"))
(define-key input-decode-map (kbd "C-M-i") (kbd "H-M-i"))
(global-set-key (kbd "H-i") 'kill-ring-save)
(global-set-key (kbd "M-i") 'kill-ring-save)
(global-set-key (kbd "H-M-i") 'ace-jump-line-mode)
(global-set-key (kbd "C-c H-i") 'ido-switch-buffer) 
```

找到更多： [https ://github.com/whunmr/dotemacs/blob/master/init.el](https://github.com/whunmr/dotemacs/blob/master/init.el)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-11T19:43:01.910

为了补充其他一些评论，我目前正在使用以下修饰键设置运行：

```
Caps-lock = Control
Control = Option
Option = Inactive
Command = Command 
```

在 Emacs 下（顺便说一句，您提到了 Aquamacs，请改用 Emacs.app），然后我通过首选项指定 Option = Command 和 Command = Option。这将两个最常用的键（C 和 M）放在主行和空格键旁边，我发现使用起来非常舒适。

要使用 Emacs.app，只需使用[MacPorts](http://www.macports.org/)安装它

```
sudo port install emacs-app 
```

另外，我将与其他人一起鼓励我；你必须尝试这个很长一段时间，否则你不会坚持下去。多次阅读教程（Ch t），浏览Info手册（Ch r），如果您不知道如何使用Info，请阅读Info手册（Ch ih）（这真是一个令人难以置信的文档系统），对于我听过的以非常简洁的方式编写的大约 30 个最佳技巧，请访问 Yegge 的旧[有效 Emacs 帖子](http://steve.yegge.googlepages.com/effective-emacs)。除此之外，真的关掉其他所有东西，然后去做。当你遇到一些你不知道该怎么做的事情时，抓住机会研究它，重复几次，然后继续前进。一开始你会慢很多，但之后你会慢**很多**更有效地编辑任何类型的文本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T00:38:09.007

我为自己创建了一个模块化的 emacs 配置。随意看看[这里](http://github.com/zpinter/emacs.d)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-11-04T17:35:10.850

请查看[emacs 入门工具包](https://github.com/technomancy/emacs-starter-kit)，了解 emacs的一些最佳默认设置。

您可能还想查看[此截屏视频](http://peepcode.com/products/meet-emacs)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-01-31T15:08:04.133

对于 emacs 24，您可能想看看[emacs-prelude](https://github.com/bbatsov/emacs-prelude)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-07T08:06:25.373

您可以查看我的 emacs 配置，位于[我的站点上](http://xtalk.msk.su/~ott/en/emacs/)。您可以在[单独的文件中找到特定于 Aquamacs 的配置](http://xtalk.msk.su/~ott/common/emacs/rc/emacs-rc-local-flash.lan.el.html)

# html - 当 CSS 中存在填充时，如何使 TextArea 的宽度为 100% 而不会溢出？

> ID：271067
> 
> 赞同：460
> 
> 时间：2008-11-07T02:35:23.387
> 
> 标签：html, css, stylesheet

我正在呈现以下 CSS 和 HTML 片段。

```
textarea
{
  border:1px solid #999999;
  width:100%;
  margin:5px 0;
  padding:3px;
}
```

```
<div style="display: block;" id="rulesformitem" class="formitem">
  <label for="rules" id="ruleslabel">Rules:</label>
  <textarea cols="2" rows="10" id="rules"/>
</div>
```

问题是文本区域最终比父区域宽 8 像素（边框 2 像素 + 填充 6 像素）。有没有办法继续使用边框和填充但将总大小限制`textarea`为父级的宽度？

* * *

## 回答 #1

> 赞同：721
> 
> 时间：2010-11-11T15:58:34.300

为什么不忘记这些技巧，只用 CSS 来做呢？

我经常使用的一个：

```
.boxsizingBorder {
    -webkit-box-sizing: border-box;
       -moz-box-sizing: border-box;
            box-sizing: border-box;
} 
```

[在此处](http://caniuse.com/css3-boxsizing)查看浏览器支持。

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2008-11-07T16:33:42.993

许多 CSS 格式问题的答案似乎是“添加另一个 <div>！”

那么，本着这种精神，您是否尝试过添加一个应用了边框/填充的包装 div，然后将 100% 宽度的文本区域放入其中？类似（未经测试）：

```
textarea
{
  width:100%;
}
.textwrapper
{
  border:1px solid #999999;
  margin:5px 0;
  padding:3px;
}
```

```
<div style="display: block;" id="rulesformitem" class="formitem">
  <label for="rules" id="ruleslabel">Rules:</label>
  <div class="textwrapper"><textarea cols="2" rows="10" id="rules"/></div>
</div>
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2010-03-23T10:48:46.317

让我们考虑一下我们想要实现的*最终输出给用户*：一个带有边框和填充的填充文本区域，其特征是被单击时会将焦点传递给我们的文本区域，以及自动 100% 宽度的优势典型的块元素。

我认为最好的方法是尽可能使用低级解决方案，以达到浏览器的最大支持。在这种情况下，唯一的 HTML 可以正常工作，避免使用 Javascript（无论如何我们都喜欢）。

LABEL 标签之所以出现在我们的帮助中，是因为它具有这样的行为，并且允许包含它必须寻址的输入元素。它的默认样式是内联元素之一，因此，给标签一个块显示样式，我们可以利用自动 100% 宽度，包括填充和边框，而内部 textarea 没有边框，没有填充和 100% 宽度.

看看 W3C 的细节，我们可能会注意到的其他优点是：

*   不需要“for”属性：当 LABEL 标签包含目标输入时，单击时会自动聚焦子输入；
*   如果已经为文本区域设计了外部标签，则不会发生冲突，因为给定的输入可能有一个或多个标签。

有关更多详细信息，请参阅[W3C](http://www.w3.org/TR/html401/interact/forms.html#h-17.9.1)细节。

简单的例子：

```
.container { 
  width: 400px; 
  border: 3px 
  solid #f7c; 
  }
.textareaContainer {
	display: block;
	border: 3px solid #38c;
	padding: 10px;
  }
textarea { 
  width: 100%; 
  margin: 0; 
  padding: 0; 
  border-width: 0; 
  }
```

```
<body>
<div class="container">
	I am the container
	<label class="textareaContainer">
		<textarea name="text">I am the padded textarea with a styled border...</textarea>
	</label>
</div>
</body>
```

.textareaContainer 元素的内边距和边框是我们想要赋予文本区域的。尝试编辑它们以根据需要设置样式。我为 .textareaContainer 元素提供了大而可见的填充和边框，让您在单击时看到它们的行为。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-11-07T17:00:28.993

如果您不太在意填充的宽度，此解决方案实际上也会将填充保持在百分比中。

```
textarea
{
    border:1px solid #999999;
    width:98%;
    margin:5px 0;
    padding:1%;
} 
```

不完美，但你会得到一些填充，宽度加起来是 100%，所以一切都很好

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2011-07-29T16:18:24.960

[我在这里](http://unwrongest.com/100-percent-width-textareas/)遇到了另一个非常简单的解决方案：将 padding-right 添加到 textarea 的容器中。这保留了 textarea 上的边距、边框和填充，这避免了 Beck 指出的有关 chrome 和 safari 围绕 textarea 放置的焦点突出显示的问题。

容器的 padding-right 应该是 textarea 两侧的有效边距、边框和填充的总和，加上您可能想要的容器的任何填充。因此，对于原始问题中的情况：

```
textarea{
    border:1px solid #999999;
    width:100%;
    margin:5px 0;
    padding:3px;
}
.textareacontainer{
    padding-right: 8px; /* 1 + 3 + 3 + 1 */
} 
```

```
<div class="textareacontainer">
    <textarea></textarea>
</div> 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2013-11-13T00:31:03.993

此代码适用于 IE8 和 Firefox

```
<td>
    <textarea style="width:100%" rows=3 name="abc">Modify width:% accordingly</textarea>
</td> 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-03-25T12:35:50.907

您可以使用 box-sizing 属性，所有主要的符合标准的浏览器和 IE8+ 都支持它。不过，您仍然需要 IE7 的解决方法。[在这里](http://www.quirksmode.org/css/box.html)阅读更多。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2018-10-22T08:52:09.637

我一直在寻找内联样式解决方案而不是 CSS 解决方案，这是我可以为响应式文本区域提供的最佳解决方案：

```
<div style="width: 100%; max-width: 500px;">
  <textarea style="width: 100%;"></textarea>
</div> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-07T05:26:12.433

不，你不能用 CSS 做到这一点。这就是微软最初推出另一种可能更实用的[盒子模型](http://en.wikipedia.org/wiki/Internet_Explorer_box_model_bug)的原因。最终获胜的盒子模型使得混合百分比和单位变得不切实际。

我不认为你也可以用父级的百分比来表示填充和边框宽度。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-04-03T21:56:53.463

如果您像这样填充和偏移它：

```
textarea
{
    border:1px solid #999999;
    width:100%;
    padding: 7px 0 7px 7px; 
    position:relative; left:-8px; /* 1px border, too */
} 
```

textarea 的右侧与容器的右侧完全对齐， textarea*内*的文本与容器中的正文文本完全对齐......并且 textarea 的左侧“突出”了一点。它有时更漂亮。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-08-03T08:48:04.260

使用[盒子尺寸属性](http://www.w3schools.com/cssref/css3_pr_box-sizing.asp)：

```
-moz-box-sizing:border-box; 
-webkit-box-sizing:border-box; 
box-sizing:border-box; 
```

这会有所帮助

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-08-07T15:05:11.863

对于使用 Bootstrap 的人来说，textarea.form-control 也会导致 textarea 大小问题。Chrome 和 Firefox 似乎使用以下 Bootstrap CSS 的不同高度：

```
textarea.form-conrtol{
    height:auto;
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-11-15T09:47:18.020

我经常用`calc()`. 您只需为 textarea 提供 100% 的宽度和一定数量的填充，但您必须减去您为 textarea 提供的 100% 宽度的总左右填充：

```
textarea {
    border: 0px;
    width: calc(100% -10px);
    padding: 5px; 
} 
```

或者，如果你想给 textarea 一个边框：

```
textarea {
    border: 1px;
    width: calc(100% -12px); /* plus the total left and right border */
    padding: 5px; 
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-04-25T11:48:14.647

问题出在`box-sizing`财产上。默认情况下，`box-sizing`属性的初始值为`content-box`。所以你在引擎盖下有这样的东西：

```
textarea {
  border:1px solid #999999;
  width:100%;
  margin:5px 0;
  padding:3px;
  box-sizing: content-box;
} 
```

`box-sizing: content-box;`表示实际元素的宽度等于元素内容框的宽度。因此，当您添加填充（在本例中为 padding-right 和 padding-left --> 因为我们正在谈论宽度）和边框（在本例中是border-right 和border-left --> 因为我们正在谈论宽度），这些值被添加到最终宽度。所以你的元素会比你想要的更宽。

将其设置为`box-sizing: border-box;`. 所以宽度将像这样计算：

```
horizontal border + horizontal padding + width of content box = width 
```

在这种情况下，当你添加水平边框和水平填充时，元素的最终宽度不会改变，实际上内容框会缩小以满足方程。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-06-14T21:01:10.287

负利润怎么办？

```
textarea {
    border:1px solid #999999;
    width:100%;
    margin:5px -4px; /* 4px = border+padding on one side */
    padding:3px;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-02-01T05:47:15.833

```
* {
    box-sizing: border-box;
}

.container {
    border-radius: 5px;
    background-color: #f2f2f2;
    padding: 20px;
}

/* Clear floats after the columns */
.row:after {
    content: "";
    display: table;
    clear: both;
}

input[type=text], select, textarea{
    width: 100%;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    resize: vertical;
}
```

```
<div class="container">
  <div class="row">
    <label for="name">Name</label>
    <input type="text" id="name" name="name" placeholder="Your name..">
  </div>
  <div class="row">
    <label for="country">Country</label>
    <select id="country" name="country">
      <option value="australia">UK</option>
      <option value="canada">USA</option>
      <option value="usa">RU</option>
    </select>
  </div>    
  <div class="row">
    <label for="subject">Subject</label>
    <textarea id="subject" name="subject" placeholder="Write something.." style="height:200px"></textarea>
  </div>
</div>
```

# c++ - C++ 中的 int 和 long 有什么区别？

> ID：271076
> 
> 赞同：127
> 
> 时间：2008-11-07T02:39:53.410
> 
> 标签：c++, variables

如果我错了，请纠正我，

int 为 4 个字节，取值范围为 -2,147,483,648 到 2,147,483,647 (2^31)
long 为 4 个字节，取值范围为 -2,147,483,648 到 2,147,483,647 (2^31)

C ++有什么区别？它们可以互换使用吗？

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2008-11-07T02:43:06.867

它取决于实现。

例如，在 Windows 下它们是相同的，但例如在 Alpha 系统上，long 是 64 位，而 int 是 32 位。本文[介绍](http://software.intel.com/en-us/articles/size-of-long-integer-type-on-different-architecture-and-os)了英特尔 C++ 编译器在可变平台上的规则。总结一下：

```
 OS           arch           size
Windows       IA-32        4 bytes
Windows       Intel 64     4 bytes
Windows       IA-64        4 bytes
Linux         IA-32        4 bytes
Linux         Intel 64     8 bytes
Linux         IA-64        8 bytes
Mac OS X      IA-32        4 bytes
Mac OS X      Intel 64     8 bytes 
```

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2008-11-07T03:12:42.407

您拥有的唯一保证是：

```
sizeof(char) == 1
sizeof(char) <= sizeof(short) <= sizeof(int) <= sizeof(long) <= sizeof(long long)

// FROM @KTC. The C++ standard also has:
sizeof(signed char)   == 1
sizeof(unsigned char) == 1

// NOTE: These size are not specified explicitly in the standard.
//       They are implied by the minimum/maximum values that MUST be supported
//       for the type. These limits are defined in limits.h
sizeof(short)     * CHAR_BIT >= 16
sizeof(int)       * CHAR_BIT >= 16
sizeof(long)      * CHAR_BIT >= 32
sizeof(long long) * CHAR_BIT >= 64
CHAR_BIT         >= 8   // Number of bits in a byte 
```

另请参阅：[是否`long`保证至少为 32 位？](https://stackoverflow.com/q/4329777/14065)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-07T02:45:46.410

为 x64 编译时，int 和 long 之间的差异在 0 到 4 个字节之间，具体取决于您使用的编译器。

GCC 使用 LP64 模型，这意味着 int 是 32 位，而 long 在 64 位模式下是 64 位。

例如，MSVC 使用 LLP64 模型，这意味着即使在 64 位模式下，int 和 long 都是 32 位。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-11-07T02:54:18.107

[C++ 规范本身](https://web.archive.org/web/20071230202350/http://www.kuzbass.ru/docs/isocpp/basic.html#basic.fundamental)（旧版本，但足够好）保持开放。

> 有四种有符号整数类型：' `signed char`'、' `short int`'、' `int`' 和 ' `long int`'。在此列表中，每种类型提供的存储空间至少与列表中它前面的类型一样多。普通整数具有执行环境架构建议的自然大小*；
> 
> [脚注：也就是说，足够大以包含 INT_MIN 和 INT_MAX 范围内的任何值，如 header 中所定义`<climits>`。---结束脚注]

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-07T03:15:20.623

正如 Kevin Haines 指出的那样，int 具有执行环境建议的自然大小，它必须适合 INT_MIN 和 INT_MAX。

C89 标准规定`UINT_MAX`至少应为 2^16-1、2 `USHRT_MAX`^16-1 和`ULONG_MAX`2^32-1 。这使得 short 和 int 的位数至少为 16，long 为 32。对于 char 它明确指出它应该至少有 8 位 ( `CHAR_BIT`)。C++ 继承了 limits.h 文件的这些规则，因此在 C++ 中，我们对这些值有相同的基本要求。*但是，您不*应该从该 int 至少为 2 个字节中得出。理论上，char、int 和 long 都可以是 1 个字节，在这种情况下`CHAR_BIT`必须至少为 32。请记住，“字节”始终是 char 的大小，所以如果 char 更大，一个字节不仅仅是 8 位任何更多的。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-07T02:41:46.010

这取决于你的编译器。可以保证 long 至少与 int 一样大，但不能保证它会更长。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-07T03:47:59.777

在大多数情况下，字节数和值的范围是由 CPU 的体系结构决定的，而不是由 C++ 决定的。然而，C++ 设定了最低要求，litb 解释得当，Martin York 只犯了一些错误。

不能互换使用 int 和 long 的原因是它们的长度并不总是相同。C 是在 PDP-11 上发明的，其中一个字节有 8 位，int 是两个字节，可以直接由硬件指令处理。由于 C 程序员经常需要四字节算术，所以发明了 long，它是四个字节，由库函数处理。其他机器有不同的规格。C 标准规定了一些最低要求。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-11-07T03:53:14.447

如果您曾经在其他机器架构、操作系统或其他供应商的编译器上编译您的代码，那么依赖编译器供应商对原始类型大小的实现将再次困扰您。

大多数编译器供应商都提供了一个头文件，该文件定义了具有显式类型大小的原始类型。当代码可能被移植到另一个编译器时，应该使用这些原始类型（在每个实例中都将其读取为 ALWAYS）。例如，大多数 UNIX 编译器都有`int8_t uint8_t int16_t int32_t uint32_t`. 微软有`INT8 UINT8 INT16 UINT16 INT32 UINT32`. 我更喜欢 Borland/CodeGear 的 `int8 uint8 int16 uint16 int32 uint32`. 这些名称还稍微提醒了预期值的大小/范围。

多年来，我一直使用 Borland 的显式原始类型名称和`#include`以下 C/C++ 头文件 (primitive.h)，它旨在为任何 C/C++ 编译器定义具有这些名称的显式原始类型（此头文件实际上可能并不涵盖所有编译器，但它涵盖了我在 Windows、UNIX 和 Linux 上使用过的几种编译器，它还没有（还）定义 64 位类型）。

```
#ifndef primitiveH
#define primitiveH
// Header file primitive.h
// Primitive types
// For C and/or C++
// This header file is intended to define a set of primitive types
// that will always be the same number bytes on any operating operating systems
// and/or for several popular C/C++ compiler vendors.
// Currently the type definitions cover:
// Windows (16 or 32 bit)
// Linux
// UNIX (HP/US, Solaris)
// And the following compiler vendors
// Microsoft, Borland/Imprise/CodeGear, SunStudio,  HP/UX
// (maybe GNU C/C++)
// This does not currently include 64bit primitives.
#define float64 double
#define float32 float
// Some old C++ compilers didn't have bool type
// If your compiler does not have bool then add   emulate_bool
// to your command line -D option or defined macros.
#ifdef emulate_bool
#   ifdef TVISION
#     define bool int
#     define true 1
#     define false 0
#   else
#     ifdef __BCPLUSPLUS__
      //BC++ bool type not available until 5.0
#        define BI_NO_BOOL
#        include <classlib/defs.h>
#     else
#        define bool int
#        define true 1
#        define false 0
#     endif
#  endif
#endif
#ifdef __BCPLUSPLUS__
#  include <systypes.h>
#else
#  ifdef unix
#     ifdef hpux
#        include <sys/_inttypes.h>
#     endif
#     ifdef sun
#        include <sys/int_types.h>
#     endif
#     ifdef linux
#        include <idna.h>
#     endif
#     define int8 int8_t
#     define uint8 uint8_t
#     define int16 int16_t
#     define int32 int32_t
#     define uint16 uint16_t
#     define uint32 uint32_t
#  else
#     ifdef  _MSC_VER
#        include <BaseTSD.h>
#        define int8 INT8
#        define uint8 UINT8
#        define int16 INT16
#        define int32 INT32
#        define uint16 UINT16
#        define uint32 UINT32
#     else
#        ifndef OWL6
//          OWL version 6 already defines these types
#           define int8 char
#           define uint8 unsigned char
#           ifdef __WIN32_
#              define int16 short int
#              define int32 long
#              define uint16 unsigned short int
#              define uint32 unsigned long
#           else
#              define int16 int
#              define int32 long
#              define uint16 unsigned int
#              define uint32 unsigned long
#           endif
#        endif
#      endif
#  endif
#endif
typedef int8   sint8;
typedef int16  sint16;
typedef int32  sint32;
typedef uint8  nat8;
typedef uint16 nat16;
typedef uint32 nat32;
typedef const char * cASCIIz;    // constant null terminated char array
typedef char *       ASCIIz;     // null terminated char array
#endif
//primitive.h 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-09-01T13:40:39.133

[C++ 标准](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1905.pdf)是这样说的：

3.9.1，§2：

> 有五种有符号整数类型：“signed char”、“short int”、“int”、“long int”和“long long int”。在此列表中，每种类型提供的存储空间至少与列表中它前面的类型一样多。普通整数具有执行环境架构所建议的自然大小（44）；提供其他有符号整数类型以满足特殊需要。
> 
> (44) 即**大到足以包含 INT_MIN 和 INT_MAX 范围内的任何值，如 header 中所定义 `<climits>`**。

结论：这取决于您正在处理的架构。任何其他假设都是错误的。

# python - Django - 如何在模板“for”循环中进行元组解包

> ID：271077
> 
> 赞同：65
> 
> 时间：2008-11-07T02:40:20.290
> 
> 标签：python, django, templates, tuples, iterable-unpacking

在我的views.py中，我正在构建一个双元组列表，其中元组中的第二项是另一个列表，如下所示：

```
[ Product_Type_1, [ product_1, product_2 ],
  Product_Type_2, [ product_3, product_4 ]] 
```

在普通的旧 Python 中，我可以像这样迭代列表：

```
for product_type, products in list:
    print product_type
    for product in products:
        print product 
```

我似乎无法在我的 Django 模板中做同样的事情：

```
{% for product_type, products in product_list %}
    print product_type
    {% for product in products %}
        print product
    {% endfor %}
{% endfor %} 
```

我从 Django 得到这个错误：

**渲染时遇到异常：zip 参数 #2 必须支持迭代**

当然，模板中有一些 HTML 标记，而不是打印语句。Django 模板语言不支持元组解包吗？还是我以错误的方式解决这个问题？我要做的就是显示一个简单的对象层次结构——有几种产品类型，每种都有几种产品（在models.py中，Product有一个Product_type的外键，一个简单的一对多关系）。

显然，我对 Django 很陌生，所以任何输入都将不胜感激。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2011-01-21T08:23:38.587

另一种方法如下。

如果有一个元组列表，请说：

```
mylst = [(a, b, c), (x, y, z), (l, m, n)] 
```

然后可以通过以下方式在模板文件中解压缩此列表。在我的例子中，我有一个包含 URL、标题和文档摘要的元组列表。

```
{% for item in mylst %}    
     {{ item.0 }} {{ item.1}} {{ item.2 }}    
{% endfor %} 
```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-11-07T03:11:51.783

最好是构建数据，例如{注意 '(' 和 ')' 可以分别交换为 '[' 和 ']'，一个用于元组，一个用于列表}

```
[ (Product_Type_1, ( product_1, product_2 )),
   (Product_Type_2, ( product_3, product_4 )) ] 
```

并让模板执行此操作：

```
{% for product_type, products in product_type_list %}
    {{ product_type }}
    {% for product in products %}
        {{ product }}
    {% endfor %}
{% endfor %} 
```

元组/列表在 for 循环中解包的方式基于列表迭代器返回的项目。每次迭代只返回一项。第一次围绕循环，Product_Type_1，第二次你的产品列表......

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-07-22T21:41:13.840

你必须这样使用：

```
{% for product_type, products in product_list.items %}
    {{ product_type }}
    {% for product in products %}
       {{ product }}
    {% endfor %}
{% endfor %} 
```

不要忘记字典数据中的变量项

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-02-19T18:53:19.960

如果你的元组中有一个固定的数字，你可以只使用索引。我需要混合字典并且值是元组，所以我这样做了：

在视图中：

```
my_dict = {'parrot': ('dead', 'stone'), 'lumberjack': ('sleep_all_night', 'work_all_day')} 
```

在模板中：

```
<select>
  {% for key, tuple in my_dict.items %}
    <option value="{{ key }}" important-attr="{{ tuple.0 }}">{{ tuple.1 }}</option>
  {% endfor %}
</select> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-07T02:47:41.320

只需向模板发送产品类型列表并执行以下操作：

```
{% for product_type in product_type_list %}
    {{ product_type }}
    {% for product in product_type.products.all %}
        {{ product }}
    {% endfor %}
{% endfor %} 
```

已经有一段时间了，所以我不记得确切的语法是什么，让我知道它是否有效。检查[文档](http://docs.djangoproject.com/en/dev/topics/db/queries/#related-objects)。

# c++ - 如何静态链接现有的 linux 可执行文件？

> ID：271089
> 
> 赞同：14
> 
> 时间：2008-11-07T02:44:52.027
> 
> 标签：c++, linux, executable, static-linking

寻找一种将动态链接的可执行文件转换为静态可执行文件的方法。似乎应该是可能的，但是手册页变短了，谷歌也没有帮助。

# authentication - 在不使用公钥身份验证或期望的情况下自动化 SSH(1)

> ID：271090
> 
> 赞同：4
> 
> 时间：2008-11-07T02:45:07.393
> 
> 标签：authentication, scripting, ssh, passwords, expect

有没有办法自动将密码传递给 ssh。我想通过某种方式让 ssh 从标准输入或文件中读取密码，从而在**不**使用公钥身份验证或期望脚本的情况下自动 ssh 到服务器。

必须采用这种方式的原因是我想将我的文件备份到使用 rsync/ssh 作为 cron 作业运行的服务器上。*该服务器在对我进行身份验证后*挂载我的主目录，因此使用公钥身份验证不起作用，因为 ~/.ssh 在登录成功之前不可用。expect(1) 是不可能的，因为我想将它作为 cron 作业运行，并且由于 cron 作业不在终端下运行，expect/ssh 的组合不起作用。我没有对该服务器的 root 访问权限，并且很难让管理员对那里的工作方式进行任何更改。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-12T17:30:16.080

> expect 是不可能的，因为我想将它作为 cron 作业运行，并且由于 cron 作业不在终端下运行，expect/ssh 的组合不起作用

您可以从 cron 运行期望脚本，至少您可以使用 Python 的“pexpect”之类的期望库。我刚刚对此进行了测试以确认，从 cron 运行 pexpect scp/ssh 脚本，并且我能够成功地从在 cron 中运行的 Python 脚本中 scp 文件。

示例代码：

```
#!/usr/bin/python

import pexpect

FILE="/path/to/file"
REMOTE_FILE=""
USER="user"
HOST="example.com"
PASS="mypass"
COMMAND="scp -oPubKeyAuthentication=no %s %s@%s:%s" % (FILE, USER, HOST, REMOTE_FILE)

child = pexpect.spawn(COMMAND)
child.expect('password:')
child.sendline(PASS)
child.expect(pexpect.EOF)
print child.before 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-12-23T17:41:50.777

使用`sshpass`.

例如，当密码在`password.txt`文件中时：

```
sshpass -fpassword.txt ssh username@hostname 
```

（取自[类似问题](https://stackoverflow.com/q/13298487/441652)的答案）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T02:48:36.310

与其传递您的密码，不如使用公钥/私钥系统。将机器的公钥添加到您要连接的所有机器上的授权密钥列表中。使用这种方法 SSH 可以自动验证密钥，不需要密码。

你可以在这里找到说明：http: [//linuxproblem.org/art_9.html](http://linuxproblem.org/art_9.html)

由于我只是更仔细地阅读了这个问题，您可能想四处寻找一个支持密码身份验证而无需用户交互的不同 SSH 客户端。我快速谷歌搜索暗示它们存在（[http://www.derkeiler.com/Newsgroups/comp.security.ssh/2004-12/0134.html](http://www.derkeiler.com/Newsgroups/comp.security.ssh/2004-12/0134.html)）

*相关的 Stackoverflow 问题：*

*   [如何设置公钥认证？](https://stackoverflow.com/questions/7260/how-do-i-setup-public-key-authentication)
*   [使用 Shell 脚本提供密码](https://stackoverflow.com/questions/224712/provide-password-using-shell-script)
*   [如何通过 SSH 远程自动运行命令？](https://stackoverflow.com/questions/243750/how-can-i-automate-running-commands-remotely-over-ssh)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T06:00:48.450

该讨论讨论了您要执行的操作：

[http://cygwin.com/ml/cygwin/2004-02/msg01449.html](http://cygwin.com/ml/cygwin/2004-02/msg01449.html)

如果您不能让管理员为您创建本地目录，那么这将不起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T00:41:21.173

SSH 需要“信心的飞跃”来确保初始握手免受未来篡改。（您最初信任服务器给您的密钥）

当前可用但不为人所知的一种方法是使用 SSH-SRP。这使用相互密码知识来验证您的身份并提供安全加密您的 ssh 会话所需的会话加密密钥。

它比 SSH 最初的“相信我”要安全得多，并且不需要长期存储密钥。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-07-13T19:10:25.180

不要使用expect、pexpect 等来输入密码。如果你这样做，你的密码必须是明文的，这实际上可能*不如*使用无密码的公钥/私钥对安全。这是更多的工作！

阅读“SSH：权威指南”中的此页面以讨论您的选择： [http ://www.snailbook.com/faq/no-passphrase.auto.html](http://www.snailbook.com/faq/no-passphrase.auto.html)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-11-07T02:56:41.410

您误解了公钥身份验证的工作原理。您不需要访问远程主目录，只需将本地公钥放在远程`authorized_keys`文件中即可。google一下，有很多攻略。

# java - 如何为 IntelliJ IDEA 8 转换 JspxIncludePathReferenceProvider

> ID：271105
> 
> 赞同：0
> 
> 时间：2008-11-07T02:52:55.800
> 
> 标签：java, plugins, intellij-idea

我为 7.0 版编写了一个 IntelliJ IDEA 插件，它使用 JspxIncludePathReferenceProvider 来允许在自定义 JSP 标记中自动完成（例如 dsp:include src="/path/to/file.jsp"）。

IntelliJ 的新版本 8 更改了参考提供程序的 API，我无法弄清楚如何将此插件转换为新 API。

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T18:08:37.037

JspReferenceProvidersUtil.PATH_REFERENCES_PROVIDER

# c - C/C++ 中的简单计算器程序

> ID：271106
> 
> 赞同：1
> 
> 时间：2008-11-07T02:54:17.187
> 
> 标签：c

我试图让这个程序给我一个输出，当我做一个加法、减法、乘法或除法问题时，它会给我答案。但是，它不起作用任何人都可以提供帮助。

```
int main ()
{  
  int choice;  
  float a, b;  
  float sum;  
  float difference;
  float product;
  float quotiont;

  printf("This program adds, subtracts, multiplies, and divides.\n");  
  printf("**************\n");  
  printf("* Calculator *\n");  
  printf("**************\n");  
  printf("Enter an expression: ");  
  scanf("%f %f", &a, &b);  
  scanf("%f %f %f %f", &sum, &difference, &product, &quotiont);  

  sum = a + b;  
  difference = a - b;  
  product = a * b;  
  quotiont = a / b;  

  if(a + b)  
      printf("Answer = %f\n", &sum);  
  else if(a - b)  
      printf("Answer = %f\n", &difference);  
  else if(a * b)  
      printf("Answer = %f\n", &product);  
  else if(a / b)  
      printf("Answer = %f\n", &quotiont);  
  else  
      printf("Error");  
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-07T03:16:51.417

你想用这条线完成什么？

```
scanf("%f %f %f %f", &sum, &difference, &product, &quotiont); 
```

这样做是从用户那里获取四个数字并将它们分别加载到四个变量中。在这一行之后，您为这四个变量分配了新值，因此在这行代码中加载它们的值是没有意义的。

另外，下面这`if`句话的意义何在？（以及所有的`else if`陈述）

```
if(a + b)
    printf("Answer = %f\n", &sum); 
```

这只会在 和 的总和不为零时打印`a`答案`b`。如果 'if' 后括号内的表达式计算结果为零，则它不会执行下面的代码。如果它的计算结果为非零值，它将执行代码。

上一行的另一个问题是您将指向`sum`变量的指针传递给 printf() 函数，而不是`sum`变量的实际值。'&sum' 返回变量的内存地址，但 'sum' 返回变量的实际值。所以它应该是这样的：

```
printf("Answer = %f\n", sum); 
```

* * *

我注意到您`choice`在程序顶部定义了一个变量，但从未使用过它。由于那个和你的`else if`陈述链，我假设你想让用户选择是加、减、乘还是除。

为此，我将定义`choice`为 char（字符）而不是 int，并让用户键入要分配给`choice`变量的以下四个字符之一：' `+`'、' `-`'、' `*`' 或 ' `/`' .

要定义`choice`为 char，请编写以下代码：

```
char choice; 
```

然后让用户输入这样的选择：

```
scanf("%c", &choice); 
```

这会从用户那里获取一个字符并将其分配给`choice`.

最后，将您的`if`语句更改为以下内容：

```
if (choice == '+')
    printf("Answer = %f\n", sum);
else if (choice == '-')
    printf("Answer = %f\n", difference);
else
    printf("Error: invalid choice.\n"); 
```

您可能还想为此使用一个`switch`语句。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T03:02:02.023

你拼错了商。

实际上，不要将 args 的地址传递给 printf。您只需要对 scanf 执行此操作。做，例如， printf("Answer = %f\n", quotient);

呃，整个如果...否则如果...最后的事情只是不稳定。把它拿出来。

为什么要扫描计算结果？把那个也拿出来。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2013-07-16T11:16:31.293

```
#include<stdio.h>
#include<conio.h>

int main ()
{   
    int choice;  
    float a, b;  
    float sum;  
    float difference;
    float product;
    float quotiont;

    printf("This program adds, subtracts, multiplies, and divides.\n");  
    printf("**************\n");  
    printf("* Calculator *\n");  
    printf("**************\n");  
    printf("Enter thee value of a: ");  
    scanf("%f",&a);
    printf("Enter the value of y:");
    scanf("%f",&b);
    sum=a+b;
    if (sum = a + b);  
        printf("sum is %f",sum);

    difference = a - b;  
    if(difference=a-b)
        printf("\n difference is %f",difference);

    product = a * b;  
    if(product=a*b)
        printf("\n product is %f",product);

    quotient = a / b;  
    if(quotient=a/b)
    printf("\n quotient is %f",quotient);

    return(main());
} 
```

# java - 在java中迭代静态int值

> ID：271109
> 
> 赞同：8
> 
> 时间：2008-11-07T02:54:40.197
> 
> 标签：java, reflection, static

我有一个简单的问题。有没有办法（我想使用反射）来迭代一个类的所有静态值？

例如

```
class Any {
    static int one = 1;
    static int two = 2;
    static int three = 3;

    public static void main( String [] args ) {
          for( int i : magicMethod( Any.class ) ){
              System.out.println( i );
          }
    }
 } 
```

输出

```
 1
 2
 3 
```

谢谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-07T03:24:23.537

```
import java.util.*;
import java.lang.reflect.*;

class Any {
    static int one = 1;
    static int two = 2;
    static int three = 3;

    public static void main( String [] args ) {
          for( int i : magicMethod( Any.class ) ){
              System.out.println( i );
          }
    }

    public static Integer[] magicMethod(Class<Any> c) {
        List<Integer> list  = new ArrayList<Integer>();
        Field[] fields = c.getDeclaredFields();
        for (Field field : fields) {
            try {
                if (field.getType().equals(int.class) && Modifier.isStatic(field.getModifiers())) {
                    list.add(field.getInt(null));
                }
            }
            catch (IllegalAccessException e) {
                // Handle exception here
            }
        }
        return list.toArray(new Integer[list.size()]);
    }
 } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T03:09:16.487

嘿..这很容易。:P

```
 Field [] constants = Main.class.getFields();
      Object some = new Main();
      for( Field field : constants ){
          if(Modifier.isStatic(field.getModifiers() ) && 
             field.getType() == int.class  ) {
                    System.out.println( field.getInt( some  ) );
          }
      } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T03:13:14.077

您的解决方案适用于公共字段，但不适用于您的示例中的私有字段。如果您希望能够访问一个类的私有字段，您需要使用 getDeclaredFields() 而不是 getFields()。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T03:13:01.750

你可以这样做：

```
import java.lang.reflect.*;

public class Foo {

public static int one = 1;
public static int two = 2;
public static int three = 3;

public static void magicMethod( Class clz ) throws Exception {
    Field[] fields = clz.getFields();
    System.out.println(""+fields);
    for( Field field : fields ) {
        int modifiers = field.getModifiers();
        if( ! Modifier.isStatic(modifiers) )
            continue;
        System.out.println("" + field.get(null));
    }
}

public static void main(String[] args) throws Exception {
    Foo.magicMethod( Foo.class );
}} 
```

然而，重要的是要注意，这些字段必须是公开的才能起作用。这并不完全符合您的要求，但它应该足够接近，您应该能够使其满足您的需求。显然，这不会做任何类型的错误处理或任何事情，因此您应该确保处理实际应用程序中的任何错误或异常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-03T09:25:59.733

作为替代方案，使用枚举并完全摆脱类变量（准确地说，枚举也是类变量:-)）：

```
class Any {
    enum Number {
        ONE(1),
        TWO(2),
        THREE(3);

        Number(int number) {
            this.number = number;
        }

        int number;
    };

    public static void main(String [] args) {
        for (Number value : Number.values()) {
            System.out.println(value.number);
        }
    }
} 
```

# java - jetty - 在 jar 中重新加载标签文件

> ID：271110
> 
> 赞同：1
> 
> 时间：2008-11-07T02:55:45.827
> 
> 标签：java, jetty, tagfile

我有我的主要 Web 项目和一个包含我的标记文件的公共项目。目前我在分解结构中使用码头，并用我的标记文件将我的公共项目打包并放入`web-inf/lib`.

当我对我的标签文件进行更改时，我可以重新打包并再次放入`web-inf/lib`，尽管码头失败了。

```
javax.servlet.ServletException: org.apache.jasper.JasperException: PWC6033: Unable to compile class for JSP 
```

如何设置码头，这样我就可以在不重新启动服务器的情况下重新压缩我的标记文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-16T04:04:27.403

Jetty 无法编译 JSP 文件的一个可能原因是它在 JRE 而不是 JDK 下运行。它需要访问编译器（它不是 JRE 的一部分，只是 JDK）将 JSP 源代码转换为字节码（中间有一个 Servlet 步骤）。

# memory-management - 操作系统通常如何管理内核内存和页面处理？

> ID：271115
> 
> 赞同：6
> 
> 时间：2008-11-07T02:59:32.060
> 
> 标签：memory-management, operating-system, kernel, paging, osdev

我正在研究内核设计，我有一些关于分页的问题。

到目前为止，我的基本想法是：每个程序都有自己的（或者它认为的）4G 内存，减去我为程序可以调用的内核函数保留的部分。因此，操作系统需要找出某种方法来加载程序在运行期间需要使用的内存页面。

现在，假设我们有无限量的内存和处理器时间，我可以加载/分配程序写入或读取的任何页面，因为它使用不存在（或被换出）的页面的页面错误，因此操作系统可以快速分配或交换它们。但在现实世界中，我需要优化这个过程，这样我们就不会有一个程序不断消耗它曾经接触过的所有内存。

所以我想我的问题是，操作系统通常是如何解决这个问题的？我最初的想法是创建一个程序调用来设置/释放页面的函数，然后它可以自行管理内存，但是程序通常会这样做，还是编译器假设它有自由支配权？此外，编译器如何处理需要分配相当大的内存段的情况？我是否需要提供一个尝试按顺序给它 X 页的功能？

这显然不是一个特定于语言的问题，但我偏爱标准 C 并且擅长 C++，所以我希望任何代码示例都在那个或汇编中。（汇编应该不是必需的，我完全打算让它与尽可能多的 C 代码一起工作，并作为最后一步进行优化。）

另一件事也应该更容易回答：通常如何处理程序需要调用的内核函数？是否可以只拥有一个包含程序可以调用的大多数基本功能/进程特定内存的内存区域（我正在考虑虚拟空间的末尾）？我的想法是让内核函数做一些非常花哨的事情并在程序需要做任何重大事情时交换页面（这样程序就无法在自己的空间中看到敏感的内核函数），但我不是真的在这一点上专注于安全。

所以我想我更担心一般的设计理念而不是细节。我想让内核（以某种方式）与 GCC 完全兼容，并且我需要确保它提供了普通程序所需的一切。

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-07T04:18:17.813

所有这些问题的一个很好的起点是看看 Unix 是如何做到的。正如一句名言所说，“那些不了解 UNIX 的人注定要重新发明它，很糟糕。”

首先，关于调用内核函数。仅仅将函数放在程序可以调用的地方是不够的，因为程序很可能在“用户模式”下运行（IA-32 上的 ring 3），而内核必须在“内核模式”下运行（通常是 ring 0在 IA-32 上）执行其特权操作。您必须以某种方式在两种模式之间进行转换，这是非常特定于架构的。

在 IA-32 上，传统方式是在 IDT 中使用门和软件中断（Linux 使用 int 0x80）。较新的处理器还有其他（更快的）方法可以做到这一点，哪些可用取决于 CPU 是来自 AMD 还是 Intel，以及特定的 CPU 型号。为了适应这种变化，最近的 Linux 内核在每个进程的地址空间顶部使用由内核映射的代码页。因此，在最近的 Linux 上，要进行系统调用，您需要调用此页面上的一个函数，该函数将依次执行切换到内核模式所需的任何操作（内核拥有该页面的多个副本，并选择使用哪个副本启动时取决于您的处理器的功能）。

现在，内存管理。这是一个**巨大**的主题；你可以写一本关于它的大书，而不是对这个主题感到厌烦。

请务必记住，内存至少有*两个*视图：物理视图（页面的真实顺序，对硬件内存子系统和外部外围设备可见）和逻辑视图（页面的顺序） CPU 上运行的程序可以看到）。很容易混淆两者。您将分配*物理*页面并将它们分配给程序或内核地址空间上的*逻辑地址。*一个物理页可以有多个逻辑地址，在不同的进程中可以映射到不同的逻辑地址。

内核内存（为内核保留）通常映射在每个进程的地址空间的顶部。但是，它被设置为只能在内核模式下访问。不需要花哨的技巧来隐藏那部分内存。硬件完成所有阻止访问的工作（在 IA-32 上，它是通过页面标志或段限制完成的）。

程序以几种方式在地址空间的其余部分分配内存：

*   部分内存由内核的程序加载器分配。这包括程序代码（或“文本”）、程序初始化数据（“数据”）、程序未初始化数据（“bss”，零填充）、堆栈和一些零碎的东西。从要加载的可执行文件的头文件中读取分配多少、在哪里、应该是什么初始内容、使用哪些保护标志以及其他一些内容。
*   传统上，在 Unix 上，有一个内存区域可以增长和缩小（其上限可以通过`brk()`系统调用更改）。这传统上由堆使用（C 库上的内存分配器，它`malloc()`的接口之一，负责堆）。
*   您通常可以要求内核将文件映射到地址空间区域。对该区域的读取和写入（通过分页魔法）定向到后备文件。这通常称为`mmap()`. 使用匿名`mmap`，您可以分配不受任何文件支持的地址空间的新区域，但以相同的方式操作。内核的程序加载器通常会用于`mmap`分配部分程序代码（例如，程序代码可以由可执行文件本身支持）。

访问未以任何方式分配（或为内核保留）的地址空间区域被视为错误，并且在 Unix 上将导致向程序发送信号。

编译器要么静态分配内存（通过在可执行文件头中指定它；内核的程序加载器将在加载程序时分配内存）或动态（通过调用语言标准库中的函数，然后通常调用C 语言标准库，然后调用内核分配内存并在必要时对其进行细分）。

学习所有这些基础知识的最好方法是阅读几本关于操作系统的书籍中的一本，尤其是那些使用 Unix 变体作为示例的书籍。它将比我在 StackOverflow 上的答案更详细。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-07T03:22:24.820

这个问题的答案高度依赖于架构。我假设你在谈论 x86。对于 x86，内核通常提供一组**系统调用**，它们是内核的预定入口点。用户代码只能在这些特定点进入内核，因此内核可以仔细控制它与用户代码的交互方式。

在 x86 中，有两种方法可以实现系统调用：使用中断和使用 sysenter/sysexit 指令。对于中断，内核建立了一个*中断描述符表*（IDT），它定义了进入内核的可能入口点。然后，用户代码可以使用该`int`指令生成软中断以调用内核。中断也可以由硬件产生（所谓的硬中断）；这些中断通常应该与软中断不同，但它们不必如此。

sysenter 和 sysexit 指令是执行系统调用的更快方法，因为处理中断很慢；我对使用它们不是很熟悉，所以我无法评论它们是否更适合您的情况。

无论您使用哪个，您都必须定义系统调用接口。您可能希望在寄存器中而不是在堆栈中传递系统调用参数，因为生成中断会导致您将堆栈切换到内核堆栈。这意味着您几乎肯定必须在用户模式端编写一些汇编语言存根来进行系统调用，并再次在内核端编写一些汇编语言存根来收集系统调用参数并保存寄存器。

一旦你准备好了所有这些，你就可以开始考虑处理页面错误了。页面错误实际上只是另一种类型的中断 - 当用户代码尝试访问没有页表条目的虚拟地址时，它将生成中断 14，并且您还将获得错误地址作为错误代码。内核可以获取这些信息，然后决定从磁盘中读取丢失的页面，添加页表映射，然后跳转回用户代码。

我强烈建议您查看[MIT 操作系统](http://pdos.csail.mit.edu/6.828/2008/)课程中的一些材料。查看参考部分，它有很多好东西。

# sql - Ruby on Rails 插件，用于在 SQL 查询的日志中显示行号

> ID：271120
> 
> 赞同：7
> 
> 时间：2008-11-07T03:04:05.997
> 
> 标签：sql, ruby-on-rails, logging

有人知道任何插件，可以在 Rails 日志中显示 SQL 查询的行号吗？像这样的东西：

```
User Load (0.003154)   SELECT * FROM `users` WHERE (`users`.`id` = 1) - (user.rb, line 24) 
```

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-07T16:21:35.953

该插件将堆栈跟踪放在您的日志中。正如丹尼尔所说，确定你想要的线会很棘手，但我怀疑你可以解决一些问题，而且跟踪本身可能就足够了。

[https://github.com/ruckus/active-record-query-trace](https://github.com/ruckus/active-record-query-trace)

小心设置它，以便您可以打开和关闭它。我用了一段时间，虽然它对追踪特定的错误很有用，但如果它一直都在，它会让我发疯。

# indexing - Nexus CMS - Google Search Appliance 索引

> ID：271131
> 
> 赞同：0
> 
> 时间：2008-11-07T03:12:34.950
> 
> 标签：indexing, content-management-system, google-search-appliance

[http://nexuscms.com/](http://nexuscms.com/)

有人用这个CMS吗？我对此了解不多，需要索引一个使用 GSA（谷歌搜索设备）构建的网站，但在他们的网站上几乎没有关于它的文档。

想知道是否会有任何陷阱，它使用什么类型的数据库..

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-21T12:12:03.920

GSA 的工作原理是抓取您在 GSA 中设置的站点上的起始 URL，然后它将跟踪整个站点中起始 URL 的任何链接。

如果您希望在数据库中搜索任何数据，例如事件或食谱，您可以创建一个页面，该页面从数据库中提取所有事件并列出它们。将此页面添加到 GSA，以便它知道要抓取它，并确保在您在 GSA 中设置的前端中排除它。

在 GSA 的企业版中，您还可以使用 SQL 查询。

GSA 可以抓取静态页面和动态页面，因此您的 cms 使用什么 DB 并不重要。

# string - 在 Crystal Reports 中将 UTC 字符串转换为日期的最佳方法是什么？

> ID：271145
> 
> 赞同：3
> 
> 时间：2008-11-07T03:16:49.730
> 
> 标签：string, crystal-reports

给定这样的 UTC 时间字符串：

```
2005-11-01T00:00:00-04:00 
```

使用 Crystal Reports 公式将其转换为 DateTime 的最佳方法是什么？

我最好的解决方案发布在下面。

我希望外面有人可以用单线把我吹走...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T23:30:10.603

我可以建议对 jons911 的回答进行简化：

```
CDateTime(CDate(Left({@UTCString}, 10)), CTime(Mid({@UTCString}, 12, 8))); 
```

这样做的好处是该公式适用于 UTC 0 之前的时区（例如 +01:00）。它当然依赖于 UTC 字符串是格式正确的 ISO 8601 字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T03:29:49.847

干得好：

```
CDateTime(CDate(Split({?UTCDateString}, "T")[1]) , CTime(Split(Split({?UTCDateString}, "T")[2], "-")[1])) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T03:17:14.723

这是我最好的解决方案，并附有评论：

```
//assume a date stored as a string in this format:
//2005-11-01T00:00:00-04:00
//return a DateTime value
StringVar fieldValue;
StringVar datePortion;
StringVar timePortion;
NumberVar yearPortion;
NumberVar monthPortion;
NumberVar dayPortion;
NumberVar hourPortion;
NumberVar minutePortion;
NumberVar secondPortion;

//store the field locally so i can easily copy-paste into another formula
//(where the field name will be different)
//Crystal formulas do not use a powerful language.
fieldValue := {PACT.ReferralDate};

//break up the date & time parts.
//ignore the -04:00 offset part of the time.
datePortion := Split (fieldValue,"T")[1];
timePortion := Split(Split (fieldValue,"T")[2],"-")[1];

yearPortion := ToNumber(Split(datePortion,"-")[1]);
monthPortion := ToNumber(Split(datePortion,"-")[2]);
dayPortion := ToNumber(Split(datePortion,"-")[3]);

hourPortion := ToNumber(Split(timePortion,":")[1]);
minutePortion := ToNumber(Split(timePortion,":")[2]);
secondPortion := ToNumber(Split(timePortion,":")[3]);

//finally, return the result as a date-time
DateTime(yearPortion,monthPortion,dayPortion,hourPortion,minutePortion,secondPortion); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T15:56:05.723

```
StringVar fieldValue;
StringVar datePortion;
StringVar timePortion;
NumberVar yearPortion;
NumberVar monthPortion;
NumberVar dayPortion;
NumberVar hourPortion;
NumberVar minutePortion;
NumberVar secondPortion;
datetimevar dtlimite;

fieldValue := {dtsecretaria.Data_limite};

datePortion := Split (fieldValue,"T")[1];
timePortion := Split(Split (fieldValue,"T")[2],"-")[1];

yearPortion := ToNumber(Split(datePortion,"-")[1]);
monthPortion := ToNumber(Split(datePortion,"-")[2]);
dayPortion := ToNumber(Split(datePortion,"-")[3]);

hourPortion := ToNumber(Split(timePortion,":")[1]);
minutePortion := ToNumber(Split(timePortion,":")[2]);
secondPortion := ToNumber(Split(timePortion,":")[3]);

dtlimite := DateTime(yearPortion,monthPortion,dayPortion,hourPortion,minutePortion,secondPortion);

if dtlimite > CurrentDateTime then

Color(255,0,0)

else

Color(255,255,0)

error of nError in formula  <Back_Color>. \n'\r'\nA string is required here." 
```

# c# - 列表框验证

> ID：271149
> 
> 赞同：0
> 
> 时间：2008-11-07T03:19:10.367
> 
> 标签：c#, asp.net, listbox, validation

如何检查我的列表框中是否选择了某个项目？所以我有一个按钮删除，但我只希望在列表框中选择一个项目时执行该按钮。我在 C# 后面使用 asp.net 代码。如果此验证发生在服务器端，我更愿意。

干杯..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T03:28:04.513

在按钮单击的回调中，只需检查列表框的选定索引是否大于或等于零。

```
protected void removeButton_Click( object sender, EventArgs e )
{
    if (listBox.SelectedIndex >= 0)
    {
        listBox.Items.RemoveAt( listBox.SelectedIndex );
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T03:49:31.943

实际上， SelectedIndex 是从零开始的，因此您的检查必须是：

if (listBox.SelectedIndex >= 0) ...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T08:23:34.073

要删除多个项目，您需要反向解析这些项​​目。

```
protected void removeButton_Click(object sender, EventArgs e)
{
    for (int i = listBox.Items.Count - 1; i >= 0; i--)
        listBox.Items.RemoveAt(i);
} 
```

如果你像往常一样解析，那么结果将是非常出乎意料的。例如：如果您删除第 0 项，则第 1 项将成为新的第 0 项。如果您现在尝试删除您认为是第 1 项的内容，您实际上会删除您所看到的第 2 项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T04:27:34.660

您可能希望根据您的 prob desc 以及**ListBox.SelectedIndex 如果未选择任何内容将返回 -1**的事实采用早期突破方法。

所以借用一些 tvanfosson 的按钮事件处理程序代码。

```
protected void removeButton_Click( object sender, EventArgs e )
{
    if (listBox.SelectedIndex < 0) { return; }
    // do whatever you wish to here to remove the list item 
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T08:22:24.263

要从集合中删除项目，您需要向后循环。

```
for (int i=lbSrc.Items.Count - 1, i>=0, i--)
{
   //code to check the selected state and remove the item
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-07T07:52:36.400

```
for (int i = 0; i < lbSrc.Items.Count; i++)
{
    if (lbSrc.Items[i].Selected == true)
    {
        lbSrc.Items.RemoveAt(lbSrc.SelectedIndex);
    }
} 
```

这就是我想出的。

# apache-flex - 如何使数据网格高度等于 Adob e Flex 中的数据内容

> ID：271150
> 
> 赞同：6
> 
> 时间：2008-11-07T03:20:33.217
> 
> 标签：apache-flex, datagrid, flex3

在 adobe Flex 数据网格中，高度等同于固定高度。我想让数据网格高度依赖于数据。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-27T21:10:22.310

您可以通过将数据网格上的“variableRowHeight”属性设置为 true 并将包含变量的 dataGridColumn 上的“wordWrap”属性设置为 true 来设置数据网格的每一行以适应该行特定列的内容高度内容。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-01T06:20:46.083

我不太明白你的问题，但如果你问如何将 DataGrid 调整为 dataProvider 中的行数，你可以尝试：

```
dataGrid.rowCount = yourCollection.length; 
```

或者

```
<mx:DataGrid rowCount="{yourCollection.length}"/> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-08-06T17:08:18.313

我遇到了同样的问题，使用 Flex SDK 3.3。多年来，我已经看到了几个关于此的 Adob​​e 错误报告，但错误检查员总是说它已经解决。我可以建议的最好的事情是在数据网格上设置一个明确的像素高度，或者你可以试试这个：

```
dg.height = dg.measureHeightOfItems(0, dgDataProvider.length) + dg.headerHeight; 
```

巴特

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-01-31T10:06:27.193

感谢那些说：

```
<mx:DataGrid rowCount="{yourCollection.length}"/> 
```

- 这实际上在 Flex 4 中对我有用。但是我想指出，根据文档“rowCount 包括标题行”，所以我想答案应该是

```
<mx:DataGrid rowCount="{yourCollection.length + 1}"/> 
```

尽管如此，我认为 doco 是错误的，因为以前的解决方案对我有用。

否则，这有帮助吗？[http://www.actionscript.org/forums/showthread.php3?t=220962](http://www.actionscript.org/forums/showthread.php3?t=220962)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-21T06:58:02.573

```
var rwcnt = xmllist.length();// dataprovider.length

ADG.rowHeight = 20;

var rht = ADG.rowHeight;

ADG.height = (rwcnt * rht) + 26; 
```

这就是我控制高级数据网格大小的解决方案

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-21T01:26:00.487

毫无疑问，我在 Flex 中遇到的最奇怪的问题是如何简单地将 Lists 和 DataGrids 的大小设置为它们的内容（不显示滚动条或任何空行）。我原以为即使行高可变，它也会完全直截了当。似乎几乎没有其他人有这个问题？！

```
<mx:DataGrid rowCount="{yourCollection.length}"/> 
```

反复看到上述解决方案 - 这是行不通的。当集合中有多个项目时，我会得到一个滚动条和一个额外的空白行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-01T19:30:35.940

在 Spark DataGrid 中，您可以将**requestedRowCount**设置为**dataProviderLength**，但前提是您不为 Datagrid 设置高度。

此外，对于长度小于 3 的 dataProvider，它将始终显示 3 行。

注意 Spark 还为我们提供了 requestedMaxRowCount 和 requestedMinRowCount。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-27T13:23:45.267

谢谢小子的回答，这对我有用（在某种程度上）。只是稍作修改，当我们用上面的计算计算高度时出现一个垂直滚动，我们还需要设置**`verticalScrollPolicy = "off"`**它永远不显示

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-13T16:45:48.887

当然，避免在您的数据网格 MXML 中使用 height="100%" 或 top="10" bottom="123"

# c# - Resharper 处理大文件或 *非常* 大文件

> ID：271151
> 
> 赞同：9
> 
> 时间：2008-11-07T03:21:10.237
> 
> 标签：c#, exception, linq-to-sql, resharper

我只是想知道您使用 resharper 的经验。我们有一个非常重的 dbml 文件，因为我们的数据库有很多表，每次我需要打开该文件时，我开始从 resharper 收到很多异常。以前有人遇到过这个问题吗？如果是，你做了什么来解决这个非常烦人的问题？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-07T03:33:19.213

我使用[`ctrl`+`8`](http://codeclimber.net.nz/archive/2008/08/06/how-to-disable-resharper-for-a-file-ctrl-8.aspx)来禁用文件的 resharper。

从 ReSharper 5 开始，这已[更改](http://devnet.jetbrains.net/thread/284638)为`ctrl`+ `shift`+ `alt`+ `8`。

# browser - 是否有工具可以查看页面是否从缓存中读取？

> ID：271159
> 
> 赞同：0
> 
> 时间：2008-11-07T03:26:33.330
> 
> 标签：browser, caching

如何确定我页面上的图片是从浏览器的缓存中加载的，还是从它们`<img src=.../>`指向的远程服务器加载的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T05:07:06.543

如果远程服务器与页面所在的服务器不同，那么简短的回答是：你不知道。

如果你真的需要这些信息，你可以在你的服务器上设置一个代理到远程图像。然后，您可以通过代理跟踪对远程服务器映像的命中。使用适当的缓存设置（即必须重新验证），您可以检查每个图像请求是新加载还是来自浏览器缓存的加载。

如果不是因为浏览器的安全策略，你也许可以通过一些非常棘手的 AJAX 来做到这一点。

如果页面和远程服务器在同一个地方，您可以通过为每个请求（包括图像）存储用户会话来获取该信息，并跟踪页面和组件图像的加载时间。

当然，我可能完全误解了您的问题，并且您想查看您的浏览器是否正在缓存图像，在这种情况下，Firefox 有一个名为 LiveHTTPHeaders 的扩展程序会有所帮助。（即 Internet Explorer 的 HTTPHeaders）。相反，Firebug 会在它的“net”选项卡上做同样的事情。YSlow 也会给你大量的缓存信息。

# visual-studio-2008 - VS2008 SP1 silverlight 设计表面不允许我将组件掉落到上面

> ID：271161
> 
> 赞同：2
> 
> 时间：2008-11-07T03:26:34.220
> 
> 标签：visual-studio-2008, silverlight

我有 .NET 3.5 SP1 的 VS2008（当然也有 SP1）。我已经加载了最新的silverlight工具..它通过并卸载了任何测试版的东西..

安装没有错误，SP1 中的其他一切似乎都正常。事实上silverlight 本身（即当您选择silverlight 项目时）。

就在我尝试将 Silverlight 组件放到设计表面上时，我得到了十字准线符号，但它不会让我从本质上“绘制”组件。

奇怪的是，如果我使用 Expression Blend，那么我当然可以在 Blend 中将组件拖放到设计图面上，然后在 VS2008 中编写代码......

只是想知道是否有其他人遇到过这个...当然我意识到我可以卸载整个 VS2008...但是如果这是快速且容易解决的问题，再次安装需要很长时间？

提前谢谢了。

大卫

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T03:39:12.043

visual studio 2008 silverlight 设计表面是只读视图。你需要表情混合来做到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T12:25:05.743

您可以将控件从工具箱拖到 XAML 视图中，但设计器视图仅在 Visual Studio 2008 中显示。

如果你想要一个设计师，你需要尝试 Expression Blend。您可以在此处下载 Blend 的 60 天试用版 - [http://www.microsoft.com/downloads/details.aspx?FamilyId=5FF08106-B9F4-43CD-ABAD-4CC9D9C208D7&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=5FF08106-B9F4-43CD-ABAD-4CC9D9C208D7&displaylang=en)

Visual Studio 2010 应该包含一个 Silverlight 设计器，它应该类似于 2008 年的 WPF 设计器。

# linux - 是否可以从应用程序调用 Compiz-Fusion 插件（ADD Helper）？

> ID：271165
> 
> 赞同：4
> 
> 时间：2008-11-07T03:29:04.387
> 
> 标签：linux, plugins, compiz

我正在计划一个应用程序，该应用程序将利用在 Linux 上运行的 Compiz-Fusion 的“ADD Helper”插件。由于我只是在计划阶段，我基本上想知道在应用程序的调用中使用该插件是否可行。

该应用程序理论上会显示一个对话框，并将屏幕的其余部分变黑（调用 ADD Helper 插件时实现的效果）。

有没有办法从应用程序中执行 ADD Helper 插件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T03:50:12.720

查看“添加助手”插件，它似乎只会使其他窗口变暗，而不是整个屏幕。

XScreenSaver 在屏幕保护程序启动之前使整个屏幕变暗。为什么不看看它的来源，看看它是如何完成的？我认为 Gnome 关闭对话框也使整个屏幕变暗，但在 Ubuntu Intrepid 上似乎不再这样做了。

这有点题外话了，但为什么要让屏幕变暗呢？作为用户，如果您的应用程序使我的屏幕变暗，我会非常恼火。我可能正在监视其他窗口，如果您的应用程序阻止了这种情况，我也不会太高兴。

# vb6 - 将 VB6 依赖文件放在 app 目录中是否有任何缺点？

> ID：271166
> 
> 赞同：1
> 
> 时间：2008-11-07T03:29:41.467
> 
> 标签：vb6

假设 Application 目录是可写的并且 HD 空间不是问题，将 VB6 依赖文件（msvbvm60.dll 等）放在 .EXE 的目录中是否有任何缺点？

我有最新的依赖文件，我猜 MS 并没有推出任何新版本，所以我认为将这些文件保存在我的文件中是最安全的（就 DLL Hell 等而言） app 目录，它们不会被修改，并且（IFAIK）它们将是应用程序首先使用的目录（在使用 System32 目录中的目录之前，等等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T14:13:47.137

[在这个问题](https://stackoverflow.com/questions/345111/how-can-you-force-vb6-to-use-the-dlls-and-ocxs-from-the-app-directory)中进行更深入的讨论：讨论强制 VB6 从另一个位置加载依赖文件的各种方法，如 .local 文件、无注册 COM 和 DirectCOM。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T13:10:07.307

根据我的经验，像 msvbvm60.dll、各种 OCX 之类的文件具有微妙的依赖关系，当您尝试将其安装在自己的应用程序目录中时，它们会造成严重破坏。我们的解决方案是跟踪所有依赖项，并确保它们是安装的一部分并按照 Microsoft 的规则正确处理。

自从 MS 停止开发 VB6 以来的 8 年里，我们几乎没有经历过 DLL Hell 的方式。（在超过 500 次安装中大约发生了六起事件），这些是客户在我们到达那里之前对 Windows XP 乱搞的结果。

简而言之，任何自定义或第三方的东西都放入您的应用程序目录。其余的确保所有内容都包含在内，让它按照 MS 的建议安装到系统文件夹中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T03:43:37.430

这应该没问题，过去我不得不为多年前在 VB6 项目中使用的第三方 DLL 执行此操作（我们依靠组件的古怪实现来做某事，后来是“固定”版本与流行的软件套件一起安装）。虽然如果它的 COM 库的 regsvr32 安装可能会破坏您避免 DLL 地狱的计划。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-28T08:17:05.057

真的没有任何意义。只需使用具有自我修复功能的优质 MSI 安装程序即可。这样，每次您的应用程序运行时，它都会检查并在必要时安装和注册任何所需的 DLL 或其他组件。然后，您将受到保护，不会被任何人弄乱这些文件。

# php - 检查序列化对象

> ID：271168
> 
> 赞同：1
> 
> 时间：2008-11-07T03:30:31.763
> 
> 标签：php, serialization, session-variables

是否有内置方法可以知道给定的会话变量是否是序列化对象？假设我检索了一个像 $_SESSION['foo'] 这样的值，但我不知道它最初是一个字符串还是一个序列化对象。有什么方法可以检查，或者一旦序列化 PHP 是否只是将字符串视为字符串？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T09:19:47.377

这是一个很常见的误解，即您必须在将对象放入会话之前手动序列化它们。事实并非如此。您可以简单地将对象实例分配给 中的插槽`$_SESSION`，PHP 会在请求之间自动为您序列化和反序列化它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T03:35:36.230

字符串是字符串是字符串。我认为你能做的最好的就是尝试反序列化它，如果它有效，它就有效。如果没有，那就没有。

唯一的其他选择是使用正则表达式来查看它是否“看起来”像一个序列化对象。只是运行`unserialize()`它可能会更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T11:16:33.490

您可以使用 is_a ...将其从会话中拉出来看看，您只需要知道要检查的类名。

```
if (is_a($_SESSION['foo'], 'UserInfoObject')) {
  // We have one
} 
```

看起来 PHP5 有一个更简单的方法：

```
if ($_SESSION['foo'] instanceof UserInfoObject) {
      // We have one
} 
```

[http://www.php.net/manual/en/function.is-a.php](http://www.php.net/manual/en/function.is-a.php)

# javascript - 使用 Javascript 发送电子邮件

> ID：271171
> 
> 赞同：116
> 
> 时间：2008-11-07T03:33:20.743
> 
> 标签：javascript, email, client-side

这有点难以解释，所以请耐心等待......

我想建立一个系统，用户可以通过我的网站发送模板电子邮件，除了它实际上不是使用我的服务器发送的 - 它只是打开他们自己的本地邮件客户端并准备好发送电子邮件。该应用程序将使用预定义的变量填写电子邮件的正文，以节省用户必须自己键入的时间。然后，他们可以根据需要编辑消息，如果它不完全适合他们的目的。

我希望它通过用户的本地邮件客户端有很多原因，因此让服务器发送电子邮件不是一种选择：它必须是 100% 客户端。

我已经有一个大部分工作的解决方案正在运行，我会发布它的详细信息作为答案，我想知道是否有更好的方法？

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2008-11-07T03:33:28.700

我现在做的方式基本上是这样的：

的HTML：

```
<textarea id="myText">
    Lorem ipsum...
</textarea>
<button onclick="sendMail(); return false">Send</button> 
```

Javascript：

```
function sendMail() {
    var link = "mailto:me@example.com"
             + "?cc=myCCaddress@example.com"
             + "&subject=" + encodeURIComponent("This is my subject")
             + "&body=" + encodeURIComponent(document.getElementById('myText').value)
    ;

    window.location.href = link;
} 
```

令人惊讶的是，这非常有效。唯一的问题是，如果正文特别长（超过 2000 个字符），那么它只会打开一封新电子邮件，但其中没有任何信息。我怀疑这与超出 URL 的最大长度有关。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-02-20T18:00:37.823

这是使用 jQuery 和“元素”单击的方法：

```
$('#element').click(function(){
    $(location).attr('href', 'mailto:?subject='
                             + encodeURIComponent("This is my subject")
                             + "&body=" 
                             + encodeURIComponent("This is my body")
    );
}); 
```

然后，您可以通过从输入字段提供内容（即使用`$('#input1').val()`或通过带有 . 的服务器端脚本）来获取您的内容`$.get('...')`。玩得开心

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-07T03:42:01.460

你不需要任何 javascript，你只需要你的 href 编码如下：

```
<a href="mailto:me@me.com">email me here!</a> 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-01-21T16:19:42.360

您可以使用此免费服务：[https ://www.smtpjs.com](https://www.smtpjs.com)

1.  包括脚本：

`<script src="https://smtpjs.com/v2/smtp.js"></script>`

2.  使用以下方式发送电子邮件：

```
Email.send(
  "from@you.com",
  "to@them.com",
  "This is a subject",
  "this is the body",
  "smtp.yourisp.com",
  "username",
  "password"
); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-07T03:47:35.737

在文本框上进行实时验证怎么样，一旦超过 2000（或任何最大阈值），然后显示“此电子邮件太长，无法在浏览器中完成，请`<span class="launchEmailClientLink">launch what you have in your email client</span>`”

我会有的

```
.launchEmailClientLink {
cursor: pointer;
color: #00F;
} 
```

和 jQuery 这个到你的 onDomReady

```
$('.launchEmailClientLink').bind('click',sendMail); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-07T03:41:17.263

如果这只是要打开用户的客户端来发送电子邮件，为什么不让他们也在那里编写它。您将无法跟踪他们发送的内容，但如果这不重要，那么只需收集地址和主题并弹出客户端让用户填写正文。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-09-22T17:13:20.937

这个想法的问题是用户必须有一个电子邮件客户端，如果他依赖网络邮件，情况就不是这样了，很多用户都是这样。（至少十几年前我调查这个问题时，没有转机重定向到这个网络邮件）。

这就是为什么正常的解决方案是依靠 php mail() 来发送电子邮件（然后是服务器端）。

但是，如果现在“电子邮件客户端”总是自动设置为网络邮件客户端，我会很高兴知道。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-10-09T14:45:10.283

[向mandrillapp.com](http://mandrillapp.com)发送请求：

```
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
    if (xhttp.readyState == 4 && xhttp.status == 200) {
        console.log(xhttp.responseText);
    }
}
xhttp.open('GET', 'https://mandrillapp.com/api/1.0/messages/send.json?message[from_email]=mail@7995.by&message[to][0][email]=zdanevich.vitaly@yaa.ru&message[subject]=Заявка%20с%207995.by&message[html]=xxxxxx&key=oxddROOvCpKCp6InvVDqiGw', true);
xhttp.send(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-01-13T11:53:32.717

您可以将以下内容添加到`<head>`您的 HTML 文件中：

```
<script src="https://smtpjs.com/v3/smtp.js"></script>

<script type="text/javascript">
    function sendEmail() {
        Email.send({
            SecureToken: "security token of your smtp",
            To: "someone@gmail.com",
            From: "someone@gmail.com",
            Subject: "Subject...",
            Body: document.getElementById('text').value
        }).then( 
            message => alert("mail sent successfully")
        );
    }
</script> 
```

以下是 HMTL 部分：

```
<textarea id="text">write text here...</textarea>
<input type="button" value="Send Email" onclick="sendEmail()"> 
```

所以 sendEmail() 函数使用以下方法获取输入：

> document.getElementById('id_of_the_element').value

例如，您可以添加另一个 HTML 元素，例如主题（id="subject"）：

`<textarea id="subject">write text here...</textarea>`

并在 sendEmail() 函数中获取其值：

> 主题：document.getElementById('subject').value

你完成了！

Note: If you do not have a SMTP server you can create one for free [here](https://elasticemail.com/account#/create-account?r=20b444a2-b3af-4eb8-bae7-911f6097521c). And then encrypt your SMTP credentials [here](https://smtpjs.com/) (the SecureToken attribute in sendEmail() corresponds to the encrypted credentials generated there).

# rdbms - 你如何设置你的连接池？

> ID：271188
> 
> 赞同：10
> 
> 时间：2008-11-07T03:49:19.993
> 
> 标签：rdbms, connection-pooling

在以下方面设置游泳池的最佳方法是什么： -

1.  你什么时候创建连接？
2.  你什么时候关闭连接，你会关闭所有连接吗？
3.  你测试连接还是不错的。何时以及如何？
4.  您如何确定最大连接数的好数字？
5.  你有什么样的监控来确保池的用户表现良好？你能阻止一段糟糕的代码带走所有东西吗？
6.  您是否编写了自己的池，或使用了第三方库？

我相信这是一个不可知论的问题，但欢迎对特定数据库/语言的“功能”发表评论。例如，在某些数据库上连接可能比其他数据库更慢或更昂贵。

澄清一下，我不打算从头开始编写一个池，这个问题更多的是关于如何配置一个现有的池化库。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T05:09:34.777

当它只是一种设计模式而不是通用库时，我用 Java 为数据库编写了一个连接池。现在我使用 Tomcat 中内置的那个。

我用一个线程来监控池的几个方面和几个参数来控制它的行为......

1.  minimumInPool="3"... 前三个是在启动时创建的。游泳池永远不允许低于三。
2.  maximumIdleTimeBeforeRemoval="60"... 如果一个连接空闲一个小时，则删除它并创建一个新连接。空闲时间可能意味着池中只有最少三个。
3.  maximumInUseTimeBeforeRemoval="30"... 如果给定的连接已签出超过 30 分钟，则可能有问题。召回它，并终止连接。
4.  maximumTimeBeforeRemoval="60"... 如果超过 60 分钟，请将其删除。
5.  maximumUsageBeforeRemoval="1000"... 如果已签出超过 1000 次，请将其删除。
6.  monitorInterval="15"... 每 15 分钟检查一次上述参数。

几年来，这对我很有帮助。在一次狂野的窥视中，我见过的池中最高的是 151 个连接。通常游泳池在大量使用期间大约有十几个，并且在清晨空闲到最少三个。

我使用 Oracle 的 JDBC 瘦驱动程序并连接到 Oracle 数据库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T04:34:15.473

这是我用于最近实施的基本原理。

1.  在您的连接池中有两种连接。第一个是准备好的，意思是打开但没有被客户使用。第二个是活动的，意思是客户正在使用。

2.  让您的连接池维护少量就绪连接，最小 N 和最大 M。N 可以根据客户端请求连接的峰值速度进行调整。如果就绪连接的数量下降到零，则需要更大的 N。如果数量一直很高（比如 10 以上），则需要更低的 N。

3.  当客户端想要一个连接时，给他们一个准备好的连接（使其处于活动状态），然后如果现在准备好的少于 N 个，则立即打开一个新连接（但不要让客户端等待完成，否则你将失去池化的优势）。这确保始终有至少 N 个就绪连接。如果当客户想要一个时没有准备好，他们将不得不等待你创建一个新的。

4.  当客户端完成一个活动连接时，如果就绪连接少于 M 个，则将其返回到就绪状态。否则关闭它。这可以防止您拥有超过 M 个准备好的连接。

5.  定期回收准备好的连接以防止陈旧的连接。如果有超过 N 个就绪连接，只需关闭最旧的连接。否则关闭它并重新打开另一个。

这样做的好处是在您的连接池中有足够的就绪*和年轻的连接可用，而不会使服务器过载。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T05:30:58.523

我不确定您使用连接的背景是什么，但我可以分享似乎对我有用的东西。

我使用 SQL Server 作为后端，并结合使用缓存来获得更好的性能。我的做法是仅在我真正需要它时才保持连接打开，而不是连接池，以便它们立即清理，我可以在 SQL Activity 监视器中确切地看到什么是活动的，什么不是。每个连接都会占用内存，因此在不需要它们时将其保持在沉闷的轰鸣声是很好的。

在我回答连接打开和关闭问题之前，让我说缓存非常重要。从缓存中取出一个对象将为您节省大量时间。在我的一些 asp.net 应用程序中，当缓存在 dev 中打开时，我发现我几乎无法测量延迟，而使用数据库调用可能需要 15 毫秒到 45 毫秒才能完成调用，这甚至没有考虑其他延迟因素或负荷。我使用的另一种方法是为我的数据提供良好的对象结构，这样我只在发生变化时才进行数据库更新。我已经在我的对象上实现了一些方法，确保我做的 IO 尽可能少。

话虽如此，我们都知道我们需要在某个时候访问和写入我们的数据库，所以我遵循两个原则：

1.  保持门窗关闭以节省能源。一个地方的开放连接意味着它在另一个地方不可用（或者内存和其他资源更加有限）。我们关闭了池化，因为它为我们带来了更好的性能。

2.  当连接打开时，我会尽可能多地批量或一次。这有点复杂，所以让我解释一下。

    *   我使用的一种方法是将连接对象传递到管道中，以便所有对象都可以使用一个连接对象。这会导致打开和关闭一个连接，而不是 10 个或更多，具体取决于您的应用程序。一个很好的例子是我们的一种采购模型，它利用 SQL 服务器的强大功能来收集统计数据和散列复杂的订购模式。当您进行 200K+ 数据库查找或任何应用程序的用途时，继续打开和关闭连接是没有意义的。另一部分是，当我使用对象时，我会尝试捆绑更新以减少保持连接打开的时间。因此，在 insert 调用上执行 scope_identity 让我在缓存之前处理我的插入和查找要添加到我的对象的唯一 ID。回到我第一次开发 asp 应用程序的那一天，我实际上会在页面开始加载时打开连接，然后再关闭它。我不建议再这样做了。现在有一天，这些抽象和层有很大的好处，我建议任何新手程序员都仔细注意。

我的两分钱：

缓存您的数据！缓存您的数据！缓存您的数据！当您无法缓存然后缓存您的数据时，请尽可能少地访问数据库！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-18T19:36:11.523

Jakarta Commons DBCP 已经完成了您列出的所有内容：

*   它根据需要创建连接并在池中管理它们
*   如果一段时间未使用，它可以关闭连接
*   它可以在分发连接之前对连接执行查询，如果出现错误，则丢弃连接并创建新连接。也可以在空闲时定期测试连接。
*   您可以对将要创建的连接以及准备就绪的最小连接数设置限制。当然，限制在很大程度上取决于您的应用程序。
*   我不知道如何，但 DBCP 知道何时没有关闭连接并为您关闭它，抛出异常以便您知道在看到日志时发生了什么。
*   DBCP 有一个非常有用的超时参数。如果池中的所有连接都在使用，它将等待一段时间以将连接返回到池中，如果达到限制时没有可用的连接，则会出现错误。

您可以通过使用最小连接数、要创建的最大连接数和超时来微调您的池。较长的超时将允许您拥有较低的连接限制，而较短的超时可能需要更大的连接数。这在很大程度上取决于您的应用程序做什么以及它如何使用连接。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-09T11:58:29.893

我同意 matt b 的观点，即我们不应该重新发明轮子。

[然而，根据这个](https://stackoverflow.com/questions/490288/is-dbcp-apache-commons-database-connection-pooling-still-relevant)和[这个](https://stackoverflow.com/questions/520585/connection-pooling-options-with-jdbc-dbcp-vs-c3p0)问题的答案，使用 Commons DBCP 是有争议的。那里提到了更好的选择，例如[c3po](http://sourceforge.net/projects/c3p0)或[proxool](http://proxool.sourceforge.net/)。

或者你可以使用 rdbms 依赖的连接池机制。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T04:04:50.460

为什么要重新发明轮子？

有人可能已经解决了这个问题，而且更好。

如果您在 Java 世界中，您可以使用[Commons DBCP](http://commons.apache.org/dbcp/)。

# java - 对于屏幕外渲染，最有用的 java.awt.image.BufferedImage 类型是什么？

> ID：271190
> 
> 赞同：5
> 
> 时间：2008-11-07T03:49:58.417
> 
> 标签：java, swing, graphics, awt

我正在创建一个缓冲图像，它将成为 JComponent 的快照（通过 paint()）并在[ImageIcon](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/ImageIcon.html)中呈现。构造函数中有大量的类型[`BufferedImage(int width, int height, int imageType)`](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/image/BufferedImage.html#BufferedImage(int,%20int,%20int))，但我应该使用哪一种呢？

我相信它们中的任何一个都会起作用，但哪些比其他更好？我该如何选择？为什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T03:56:37.437

请参阅[GraphicsConfiguration.createCompatibleImage(int, int)](http://java.sun.com/j2se/1.4.2/docs/api/java/awt/GraphicsConfiguration.html#createCompatibleImage(int,%20int))以获得在许多可用类型中创建“好”类型的 BufferedImage 的帮助程序。

如何获得 GraphicsConfiguration 实例来进行此调用？这取决于您的代码在哪里执行。查看通过 getGraphicsConfiguration() 或 getDeviceConfiguration() 等方法获取 GraphicsConfiguration的[许多方法。](http://java.sun.com/j2se/1.4.2/docs/api/java/awt/class-use/GraphicsConfiguration.html)

# c# - 这个 WCF 客户端代码会导致内存泄漏吗？

> ID：271198
> 
> 赞同：2
> 
> 时间：2008-11-07T03:52:18.897
> 
> 标签：c#, .net, wcf, lambda

.Net 中内存泄漏的常见原因之一是永远不会从其源对象中删除的事件处理程序。

这个 WCF 代码会导致内存泄漏，还是 lambda 也会超出范围，从而允许代理类和处理程序都被 GCed？

```
void AMethod()
{
    WCFClient proxy;
    proxy = new WCFClient();
    proxy.RemoteOperationCompleted += (sender, e) => proxy.Close();
    proxy.Open();
    proxy.RemoteOperationAsync();
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T05:05:26.440

这是我的测试 - 请注意lambda 中的显式`proxy`设置- 没有它的生命，因此可能会泄漏：`null``WeakReference`

```
public class Proxy
{
    private bool _isOpen;

    public event EventHandler Complete;

    public void Close() 
    {
        _isOpen = false;
    }

    public void Open() 
    { 
        _isOpen = true; 
    }

    public void RemoteOperationAsync()
    {
        if (!_isOpen)
            throw new ApplicationException();
        Thread.Sleep(1000);
        if (Complete != null)
            Complete(this, EventArgs.Empty);
    }
}

public static class Program
{
    public static void Main()
    {
        WeakReference wr = null;

        {
            var proxy = new Proxy();
            proxy.Complete += (sender, e) =>
                {
                    proxy.Close();
                    wr = new WeakReference(proxy);
                    proxy = null;
                };
            proxy.Open();
            proxy.RemoteOperationAsync();
        }

        GC.Collect(GC.GetGeneration(wr));
        GC.WaitForPendingFinalizers();

        Console.WriteLine("[LAMBDA] Is WeakReference alive? " + wr.IsAlive);
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T04:39:09.660

不要忘记代理没有正确实现 IDisposable。如果发生错误，上面的代码将不会清理连接，并且句柄将一直保留到父进程关闭。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-20T18:20:16.847

定义 lamdba 的上下文将被捕获，因此将在编译器创建的闭包类中“存活”（您可以使用 Reflector 看到它们） - 所以您的代理也是如此。使用弱事件处理程序或编写注销代码。但在这种情况下，您不能使用 lambda 表达式。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-07T04:20:11.727

那个物体会死……它会被清理干净。

不要忘记 lamda 并没有做任何特别的事情......这是一个编译器技巧（所以假设它是一个正常的 += SomeDelegate）。

此外，“关闭”方法（我不知道他们为什么没有将其设为 IDisposable）将清理所有其他打开的内容。

# c++ - 你认为是什么让这个 C++ 代码变慢了？（它遍历 ADODB 记录集，将 COM 类型转换为字符串，并填充 ostringstream）

> ID：271204
> 
> 赞同：0
> 
> 时间：2008-11-07T03:56:29.417
> 
> 标签：c++, com, stl, adodb

这个循环比我预期的要慢，我还不确定在哪里。看到什么了吗？

我正在使用客户端游标读取 Accces DB。当我有 20 列的 127,000 行时，这个循环大约需要 10 秒。20 列是字符串、整数和日期类型。所有类型在放入 ostringstream 缓冲区之前都会转换为 ANSI 字符串。

```
void LoadRecordsetIntoStream(_RecordsetPtr& pRs, ostringstream& ostrm)
{
    ADODB::FieldsPtr pFields = pRs->Fields;
    char buf[80];
    ::SYSTEMTIME sysTime;
    _variant_t var;

    while(!pRs->EndOfFile) // loop through rows
    {
        for (long i = 0L; i < nColumns; i++)  // loop through columns
        {

            var = pFields->GetItem(i)->GetValue();

            if (V_VT(&var) == VT_BSTR)
            {
                ostrm << (const char*) (_bstr_t) var;   
            }
            else if (V_VT(&var) == VT_I4
            || V_VT(&var) == VT_UI1
            || V_VT(&var) == VT_I2
            || V_VT(&var) == VT_BOOL)
            {
                ostrm << itoa(((int)var),buf,10);
            }
            else if (V_VT(&var) == VT_DATE)
            {
                ::VariantTimeToSystemTime(var,&sysTime);
                _stprintf(buf, _T("%4d-%02d-%02d %02d:%02d:%02d"),
                sysTime.wYear, sysTime.wMonth, sysTime.wDay, 
                sysTime.wHour, sysTime.wMinute, sysTime.wSecond);

                ostrm << buf;
            }
        }

        pRs->MoveNext();
    }
} 
```

编辑：经过更多的实验......

我现在知道这行使用了大约一半的时间：
var = pFields->GetItem(i)->GetValue();

如果我绕过 Microsoft 生成的 COM 包装器，我的代码会更快吗？我的猜测是否定的。

另一半时间花在转换数据并将其流式传输到 ostringstream 的语句中。

在我写这篇文章时，我现在不知道是转换还是流媒体需要更多时间。

如果我不使用 ostringstream 而是使用我自己的逻辑来增加缓冲区（重新分配、复制、删除）来管理我自己的缓冲区，它会更快吗？如果我的逻辑做出悲观的猜测并预先为 ostringstream 缓冲区保留大量空间会更快吗？这些可能是值得尝试的实验。

最后，转换本身。在我的时间安排中，这三者中没有一个是糟糕的。一个答案说我的 itoa 可能比另一种慢。值得一试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T04:18:18.967

我无法从您的代码中看出，更熟悉 COM/ATL 的人可能会有更好的答案。

通过试验 n 错误，我会通过注释掉内部循环操作来找到慢代码，直到你看到性能峰值，那么你就有了罪魁祸首，应该专注于这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T04:20:36.997

我假设 V_VT 是一个函数 - 如果是这样，那么对于每个日期值， V_VT(&var) 被调用 6 次。一个简单的优化是在本地存储 V_VT(&var) 的值，以节省每次循环时对该函数的最多 5 次调用。

如果您还没有这样做，请重新排序类型的 if 测试以将最常见的列类型放在首位 - 这减少了所需的测试数量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T04:29:26.853

一个很好的部分是 Access 不是服务器数据库 - 所有文件读/写、锁定、游标处理等都发生在客户端应用程序中（通过网络，对吗？）并且需要这样做，如果其他用户同时打开了数据库。

如果没有，您可能可以删除游标设置，并以只读方式打开数据库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T07:30:59.110

尝试注释掉for循环中的代码并比较时间。阅读完毕后，开始取消注释各个部分，直到遇到瓶颈。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T09:51:52.337

作为一个基本概念，您应该尝试在只有 VT_BSTR 转换时查看代码的速度，然后是 VT_DATE，最后是其他类型，看看哪个花费的时间最多。

[我唯一的观察是 itoa 不是标准的 C。从本文](http://www.jb.man.ac.uk/~slowe/cpp/itoa.html#newest)中可以看出，实现可能非常慢。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T07:16:04.397

尝试分析。如果您没有分析器，一种简单的方法可能是将所有调用包装在您认为可能需要一些时间的循环中，如下所示：

```
#define TIME_CALL(x) \
do { \
  const DWORD t1 = timeGetTime();\
  x;\
  const DWORD t2 = timeGetTime();\
  std::cout << "Call to '" << #x << "' took " << (t2 - t1) << " ms.\n";\
}while(false) 
```

所以现在你可以说：

```
TIME_CALL(var = pFields->GetItem(i)->GetValue());
TIME_CALL(ostrm << (const char*) (_bstr_t) var); 
```

等等...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T10:17:38.447

您不需要 itoa - 您正在写入流。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-07T15:51:36.823

要回答您的新问题，我认为您应该使用这样一个事实，即您可以让流格式化您的数据，而不是将其格式化为字符串，然后将该字符串传递给流，例如：

```
_stprintf(buf, _T("%4d-%02d-%02d %02d:%02d:%02d"),
                  sysTime.wYear, sysTime.wMonth, sysTime.wDay, 
                  sysTime.wHour, sysTime.wMinute, sysTime.wSecond);

ostrm << buf; 
```

变成：

```
ostrm.fill('0');
ostrm.width(4);
ostrm << sysTime.wYear << _T("-");
ostrm.width(2);
ostrm << sysTime.wMonth; 
```

等等...

# cruisecontrol.net - 如何配置 CruiseControl.NET 在远程服务器上构建一个项目

> ID：271210
> 
> 赞同：6
> 
> 时间：2008-11-07T04:00:15.477
> 
> 标签：cruisecontrol.net, build-server

我有一个运行 CruiseControl.NET 的构建服务器。它适用于配置为在该服务器上运行的 7 个项目（我们称之为服务器 A）。

现在我有一个新项目，我希望在不同的服务器（服务器 B）上构建，但我希望它与现有项目出现在同一个 ccnet 仪表板中。

如何为这种情况配置 CCNet？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T11:56:11.010

在`dashboard.config`（默认位置是`c:\Program Files\CruiseControl.NET\webdashboard\dashboard.config`）查看[服务器配置块](http://confluence.public.thoughtworks.org/display/CCNET/Servers+Configuration+Block)：

```
 <servers>
       <server name="local" url="tcp://localhost:21234/CruiseManager.rem"
               allowForceBuild="true" allowStartStopBuild="true" />
   </servers> 
```

它允许您配置要报告的远程服务器 - 只需添加另一个`<server />`节点。要强制更改显示在 CruiseControl.NET 仪表板上，请编辑同一文件夹中的 web.config 文件并保存。刷新仪表板网页。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-09T22:40:35.390

Duckworth 的答案是我通过 Google 找到的。我发现完整的故事（确定所有主角）为：

打开dashboard.config 文件。它的默认位置是 \Program Files\CruiseControl.NET\webdashboard。

在dashboard.config 的顶部，添加额外的服务器。例如

并保存更改。

要强制更改显示在 CruiseControl.NET 仪表板上，请编辑同一文件夹中的 web.config 文件并保存。刷新仪表板网页。

# xml - 使用 XSLT 重命名节点

> ID：271218
> 
> 赞同：6
> 
> 时间：2008-11-07T04:06:51.550
> 
> 标签：xml, vb.net, xslt

我正在尝试一些非常简单的事情，但由于某种原因它不起作用。基本上，我需要重命名 XML 文档中的一些节点。因此，我创建了一个 XSLT 文件来进行转换。

以下是 XML 的示例：

编辑：地址和地址元素出现在许多级别。这就是导致我不得不尝试应用 XSLT 的原因。Visual Studio 类型化数据集功能（从 XSD 文件创建类型化数据集）不允许您对同一个表进行嵌套引用。因此，拥有 Businesses/Business/Addresses 和 Businesses/Business/Contact/Addresses 会导致 Load() 失败。这是一个已知问题，他们告诉您的只是“没有嵌套表引用...编辑您的 XSD 以停止它”。不幸的是，这意味着我们必须应用 XSLT 来使 XML 符合“被黑”的 XSD，因为这些文件来自第三方供应商。

因此，我们非常接近此处提供的帮助。最后几件事是：

1.) 如何使用 xsl:template 的 match 属性中的命名空间引用来指定我想将 Businesses/Business/Addresses 重命名为 BusinessAddresses，但将 Businesses/Business/Contacts/Contact/Addresses 重命名为 ContactAddresses？

2.) 如何阻止 XSLT 使用显式命名空间引用来混淆每个新元素？它导致输出极度膨胀。

我创建了一个名为“steel”的命名空间，并在以下方面取得了很好的成功：

```
<xsl:template match="steel:Addresses>
  <xsl:element name="BusinessAddresses>
</xsl:template> 
```

这里明显的问题是它将**所有**地址元素重命名为 BusinessAddresses，即使我希望其中一些元素命名为 ContactAddresses，等等。对所有重命名的节点进行不必要的显式命名空间引用也很麻烦。

我尝试过这种事情，但是一旦我在 match 属性中添加斜杠，它就是 XSLT 中的一个语法错误，如下所示：

```
<xsl:template match="steel:/Businesses/Business/Addresses"> 
```

我感觉非常接近，但需要一些关于如何混合使用命名空间和使用斜杠选择特定路径下的**任何**节点的方法的指导。

```
<?xml version="1.0"?>
<Businesses>
  <Business>
    <BusinessName>Steel Stretching</BusinessName>
    <Addresses>
      <Address>
        <City>Pittsburgh</City>
      </Address>
      <Address>
        <City>Philadelphia</City>
      </Address>
    </Addresses>
    <Contacts>
      <Contact>
        <FirstName>Paul</FirstName>
        <LastName>Jones</LastName>
        <Addresses>
          <Address>
            <City>Pittsburgh</City>
          </Address>
        </Addresses>
      </Contact>
    </Contacts>
  </Business>
  <Business>
    <BusinessName>Iron Works</BusinessName>
    <Addresses>
      <Address>
        <City>Harrisburg</City>
      </Address>
      <Address>
        <City>Lancaster</City>
      </Address>
    </Addresses>
  </Business>
</Businesses> 
```

对于直接在业务节点下的地址和地址的每个实例，我需要将地址重命名为业务地址，并且我需要将地址重命名为业务地址。我还需要将地址重命名为 ContactAddresses，并且我需要将地址重命名为 ContactAddress，对于直接在联系人节点下的地址和地址的每个实例。

我尝试了几种解决方案，但似乎都没有。它们最终都会生成与原始文件相同的 XML。

这是我尝试过的一个例子：

```
 <xsl:template match="/">
    <xsl:apply-templates select="@*|node()" />
  </xsl:template>

  <xsl:template match="@*|*">
    <xsl:copy>
      <xsl:apply-templates select="@*|node()" />
    </xsl:copy>
  </xsl:template>

  <xsl:template match="Addresses">
    <BusinessAddresses>
      <xsl:apply-templates select="@*|node()" />
    </BusinessAddresses>
  </xsl:template> 
```

这已经在至少 6 种不同的风格中进行了尝试，并在 VB.Net 中逐步完成了 XSLT 调试器。它从不执行地址的模板匹配。

为什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T05:25:59.097

## 为什么 XSLT 会失败？

XSLT 会因为诸如拼写错误之类的明显原因而失败。但是，最可能的情况与命名空间的使用有关。如果您为您的 XML 声明了一个默认名称空间，但没有在您的 XSLT 中包含它，那么 XSLT 将不会像您预期的那样匹配模板。

以下示例添加了`xmlns:business`声明由`business`前缀限定的项目属于命名空间的属性`mynamespace.uri`。然后我使用这个前缀来限定地址和地址模板匹配。当然，您需要将命名空间 URI 更改为与 XML 文件的默认命名空间匹配的任何内容。

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:msxsl="urn:schemas-microsoft-com:xslt"
                xmlns:business="mynamespace.uri"
                exclude-result-prefixes="msxsl">
  <xsl:template match="/">
    <xsl:apply-templates select="@*|node()"/>
  </xsl:template>

  <xsl:template match="@*|node()">
    <xsl:copy>
      <xsl:apply-templates select="@*|node()"/>
    </xsl:copy>
  </xsl:template>

  <xsl:template match="business:Addresses">
    <xsl:element name="BusinessAddresses">
      <xsl:apply-templates select="@*|node()" />
    </xsl:element>
  </xsl:template>

  <xsl:template match="business:Address">
    <xsl:element name="BusinessAddress">
      <xsl:apply-templates select="@*|node()"/>
    </xsl:element>
  </xsl:template>
</xsl:stylesheet> 
```

## 如何根据元素位置和名称匹配模板？

有几种方法可以解决您的问题的最后一部分，BusinessAddress 或 ContactAddress，但最简单的方法是修改模板`match`属性以考虑父节点。如果您将`match`属性视为节点的 XML 路径，则此选项会变得更加清晰（为简洁起见，模板的内容省略了）：

```
<xsl:template match="business:Business/business:Addresses>
</xsl:template>

<xsl:template match="business:Business/business:Addresses/business:Address">
</xsl:template>

<xsl:template match="business:Contact/business:Addresses">
</xsl:template>

<xsl:template match="business:Contact/business:Addresses/business:Address">
</xsl:template> 
```

如果保留仅基于元素名称，则存在其他方法来实现这一点`match`，但它们更难实现、遵循和维护，因为它们涉及对正在处理的元素的父节点层次结构使用条件检查，所有这些都在模板。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-08T05:44:39.903

也许这个，如果你展示的数据真的像你要使用的数据

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:template match="Businesses">
 <Businesses>
  <xsl:apply-templates/>
 </Businesses>
</xsl:template>

<xsl:template match="*">
 <xsl:copy-of select="."/>
</xsl:template>

<xsl:template match="Addresses">
 <BusinessAddresses>
  <xsl:apply-templates/>
 </BusinessAddresses>
</xsl:template>

<xsl:template match="Addresses/Address">
 <BusinessAddress>
  <xsl:value-of select="."/>
 </BusinessAddress>
</xsl:template>

</xsl:stylesheet> 
```

# javascript - 将对象发送到远程 javascript 文件

> ID：271219
> 
> 赞同：1
> 
> 时间：2008-11-07T04:08:01.500
> 
> 标签：javascript, object-literal

所以如果我在我的网站上设置雅虎管道徽章，雅虎会给我这个代码

```
<script src="http://pipes.yahoo.com/js/listbadge.js">{"pipe_id":"USER_ID","_btype":"list"}</script> 
```

请注意它将对象文字传递给远程脚本。我想用我自己的脚本做类似的事情，你如何与那个输入交互？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T04:38:34.230

您实际上不能像*native*那样传递变量。Yahoo 正在做的是在他们的 listbadge.js 文件中搜索`<script>`页面上的所有标签，直到找到包含它的标签，然后将 innerHTML 解析为 JSON。

他们的来源被稍微混淆了，但这是我对它的最好理解。

```
var scripts = document.getElementsByTagName("SCRIPT");

for (var i = 0; i < scripts.length; i++) {
    var includeString = scripts[i].src;
    if (includeString.match("listbadge.js")) {
        if (scripts[i].innerHTML){
            var passedVariables = parseJson(scripts[i].innerHTML);
        }
        break;
    }
} 
```

# .net - .NET 控件编辑 xml 文件

> ID：271224
> 
> 赞同：2
> 
> 时间：2008-11-07T04:10:15.270
> 
> 标签：.net, xml, designer

任何人都可以推荐一个 .net 控件（winforms），它可以用作设计器来编辑 xml 文件/DSL 文件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T05:32:17.383

一种方法是创建一系列[序列](http://support.microsoft.com/kb/316730)化为所需 XML 结构的对象。

然后您可以将您的 XML 反序列化为对象，然后将它们绑定到[PropertyGrid](http://msdn.microsoft.com/en-us/library/system.windows.forms.propertygrid.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-14T15:12:05.923

我不确定你是否得到答案，有几个 3rd 方控件可用[QWhale](http://www.qwhale.net/)和[ActiPro](http://www.actiprosoftware.com/)

希望这可以帮助。

# c# - 如何检测何时使用 C# 插入可移动磁盘？

> ID：271238
> 
> 赞同：16
> 
> 时间：2008-11-07T04:24:05.117
> 
> 标签：c#, wpf, windows

我只是关心 Windows，所以没有必要深入了解 Mono 兼容性或类似的东西。

`System.Windows.Forms`我还应该补充一点，我正在编写的应用程序是 WPF，如果可能的话，我宁愿避免依赖。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-07T04:32:18.877

试一试...

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Management;

namespace WMITestConsolApplication
{

    class Program
    {

        static void Main(string[] args)
        {

            AddInsertUSBHandler();
            AddRemoveUSBHandler();
            while (true) {
            }

        }

        static ManagementEventWatcher w = null;

        static void AddRemoveUSBHandler()
        {

            WqlEventQuery q;
            ManagementScope scope = new ManagementScope("root\\CIMV2");
            scope.Options.EnablePrivileges = true;

            try {

                q = new WqlEventQuery();
                q.EventClassName = "__InstanceDeletionEvent";
                q.WithinInterval = new TimeSpan(0, 0, 3);
                q.Condition = "TargetInstance ISA 'Win32_USBControllerdevice'";
                w = new ManagementEventWatcher(scope, q);
                w.EventArrived += USBRemoved;

                w.Start();
            }
            catch (Exception e) {

                Console.WriteLine(e.Message);
                if (w != null)
                {
                    w.Stop();

                }
            }

        }

        static void AddInsertUSBHandler()
        {

            WqlEventQuery q;
            ManagementScope scope = new ManagementScope("root\\CIMV2");
            scope.Options.EnablePrivileges = true;

            try {

                q = new WqlEventQuery();
                q.EventClassName = "__InstanceCreationEvent";
                q.WithinInterval = new TimeSpan(0, 0, 3);
                q.Condition = "TargetInstance ISA 'Win32_USBControllerdevice'";
                w = new ManagementEventWatcher(scope, q);
                w.EventArrived += USBInserted;

                w.Start();
            }
            catch (Exception e) {

                Console.WriteLine(e.Message);
                if (w != null)
                {
                    w.Stop();

                }
            }

        }

        static void USBInserted(object sender, EventArgs e)
        {

            Console.WriteLine("A USB device inserted");

        }

        static void USBRemoved(object sender, EventArgs e)
        {

            Console.WriteLine("A USB device removed");

        }
    }

} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-07T06:16:13.177

与使用 WMI 轮询相比，执行此操作的方法要简单得多 - 只需捕获 WM_DEVICECHANGE：

[http://msdn.microsoft.com/en-us/library/aa363215.aspx](http://msdn.microsoft.com/en-us/library/aa363215.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T04:31:01.173

最简单的方法是创建一个自动播放处理程序：

[http://www.codeproject.com/KB/system/AutoplayDemo.aspx](http://www.codeproject.com/KB/system/AutoplayDemo.aspx)

> 自动播放第 2 版是 Windows XP 中的一项功能，它将扫描可移动媒体的前四个级别，当它到达时，查找媒体内容类型（音乐、图形或视频）。应用程序的注册是在内容类型的基础上完成的。当可移动媒体到达时，Windows XP 通过评估内容并将其与该内容的已注册处理程序进行比较来确定要执行的操作。

还提供了[详细的 MSDN 文章。](http://msdn.microsoft.com/en-us/magazine/cc301341.aspx)

# python - 如何在 Django 中向表单模板添加默认（隐藏）值？

> ID：271244
> 
> 赞同：7
> 
> 时间：2008-11-07T04:27:14.690
> 
> 标签：python, django, django-templates, django-urls

给定一个 Django.db 模型类：

```
class P(models.Model):
   type = models.ForeignKey(Type) # Type is another models.Model class
   name = models.CharField() 
```

人们希望创建一个具有指定类型的新 P，即如何使“类型”成为默认的隐藏字段（来自用户），其中类型的给出如下：

```
http://x.y/P/new?type=3 
```

这样表单中就不会出现“类型”字段，但是当 P 被保存时，其类型的 id 为 3（即 Type.objects.get(pk=3)）。

其次，当使用通用 Django 视图时，如何（& 是否可能）通过 urls.py 在 url 中指定“默认”类型，即。

```
urlpatterns = ('django.generic.views.create_update',
  url(r'^/new$', 'create_object', { 'model': P }, name='new_P'),
) 
```

我发现这很难描述，这可能是问题的一部分。:) 非常感谢您的输入！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T05:26:25.553

该小部件`django.forms.widgets.HiddenInput`会将您的字段呈现为隐藏状态。

在大多数情况下，我认为您会发现任何隐藏的表单值也可以指定为 url 参数。换句话说：

```
<form action="new/{{your_hidden_value}}" method="post">
....
</form> 
```

在 urls.py 中：

```
^/new/(?P<hidden_value>\w+)/ 
```

我自己更喜欢这种技术，因为当我需要跟踪模型实例的主键时，我才真正发现自己需要隐藏的表单字段——在这种情况下，“edit/pkey” url 既可以用于启动编辑/返回表单，并在保存时接收 POST。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-07T04:32:23.043

在模型中有默认外键：

```
mydefault = Type.objects.get(pk=3)

class P(models.Model):
   type = models.ForeignKey(Type, default=mydefault) # Type is another models.Model class
   name = models.CharField() 
```

请注意，使用`pk=x`非常难看，因为理想情况下您不应该关心主键等于什么。尝试通过其他属性获取您想要的对象。

[以下](http://docs.djangoproject.com/en/dev/topics/http/urls/#notes-on-capturing-text-in-urls)是您在 url 中设置默认值的方式：

```
# URLconf
urlpatterns = patterns('',
    (r'^blog/$', 'blog.views.page'),
    (r'^blog/page(?P<num>\d+)/$', 'blog.views.page'),
)

# View (in blog/views.py)
def page(request, num="1"):
    # Output the appropriate page of blog entries, according to num. 
```

> 在上面的例子中，两个 URL 模式都指向同一个视图——blog.views.page——但是第一个模式没有从 URL 中捕获任何东西。如果第一个模式匹配，page() 函数将使用其默认参数 num，“1”。如果第二个模式匹配，page() 将使用正则表达式捕获的任何 num 值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-20T23:16:18.937

如果您采用 Andrew 在 url 中包含隐藏值的方法，并且仍然想使用 Django 的内置表单模板之一，那么您可以通过一些方法来排除隐藏字段。

[http://docs.djangoproject.com/en/1.1/topics/forms/modelforms/#using-a-subset-of-fields-on-the-form](http://docs.djangoproject.com/en/1.1/topics/forms/modelforms/#using-a-subset-of-fields-on-the-form)

# xml - 以 xml 格式导出 Sharepoint 列表的最简单方法是什么？

> ID：271254
> 
> 赞同：11
> 
> 时间：2008-11-07T04:32:45.287
> 
> 标签：xml, sharepoint, list, moss, export

很不言自明。我只需要将列表轻松导出为 xml 格式。有没有什么工具可以做到这一点？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-09T20:41:57.277

这是我使用的方法：

[http://servername/site/_vti_bin/owssvr.dll?Cmd=Display&List=YOURUNIQUELISTID&XMLDATA=TRUE](http://servername/site/_vti_bin/owssvr.dll?Cmd=Display&List=YOURUNIQUELISTID&XMLDATA=TRUE)

奇迹般有效。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-19T16:24:20.817

您还可以使用 Lists 网络服务。`http://server/_vti_bin/Lists.asmx`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T06:00:00.290

您可以很容易地编写 ac# 应用程序以连接到 sp 列表并自己将其导出。

对 codeplex 搜索的快速搜索会出现一个已经为此目的制作的此类程序！希望这可以帮助你： http: [//www.codeplex.com/SPListReader](http://www.codeplex.com/SPListReader) [http://www.codeplex.com/SPListReader/Release/ProjectReleases.aspx?ReleaseId=15420](http://www.codeplex.com/SPListReader/Release/ProjectReleases.aspx?ReleaseId=15420)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-08T03:30:19.800

RSS 提要对于您来说是否有足够的 XML 格式？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T09:42:05.583

在 SharePoint 列表中，单击操作 > 使用访问打开 > 右键单击​​表并选择导出到 xml。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T04:17:23.930

在列表的操作菜单中，选择导出到电子表格。然后打开导出的 Excel Web Query 文件并从文件菜单中选择“另存为”并将其另存为 XML。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-03T20:11:53.350

您可以创建“内容查询工具部件”以将 SharePoint 环境中的页面列表导出到生成的 XML 列表。我最喜欢这个工具的功能是您可以对想要在 XML 文件中生成的内容进行排序和过滤。您可以[通过 Waldek Mastykarz 的本教程了解更多信息](http://blog.mastykarz.nl/creating-rss-feeds-sharepoint-2010-content-query-web-part/)

# c# - GZipStream 和 DeflateStream 不会解压所有字节

> ID：271260
> 
> 赞同：35
> 
> 时间：2008-11-07T04:39:17.507
> 
> 标签：c#, image, compression, zip, bitmap

我需要一种在 .net 中压缩图像的方法，所以我研究了使用 .net GZipStream 类（或 DeflateStream）。但是我发现解压并不总是成功的，有时图像会很好地解压，有时我会得到一个 GDI+ 错误，表明某些东西已损坏。

在调查了这个问题后，我发现解压缩并没有返回它压缩的所有字节。因此，如果我压缩了 2257974 字节，我有时只会返回 2257870 字节（实数）。

最有趣的是，有时它会起作用。所以我创建了这个只压缩 10 个字节的小测试方法，现在我什么也拿不回来。

我用压缩类 GZipStream 和 DeflateStream 都试过了，我仔细检查了我的代码是否有可能的错误。我什至尝试将流定位到 0 并刷新所有流，但没有运气。

这是我的代码：

```
 public static void TestCompression()
    {
        byte[] test = new byte[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 };

        byte[] result = Decompress(Compress(test));

        // This will fail, result.Length is 0
        Debug.Assert(result.Length == test.Length);
    }

    public static byte[] Compress(byte[] data)
    {
        var compressedStream = new MemoryStream();
        var zipStream = new GZipStream(compressedStream, CompressionMode.Compress);
        zipStream.Write(data, 0, data.Length);
        return compressedStream.ToArray();
    }

    public static byte[] Decompress(byte[] data)
    {
        var compressedStream = new MemoryStream(data);
        var zipStream = new GZipStream(compressedStream, CompressionMode.Decompress);
        var resultStream = new MemoryStream();

        var buffer = new byte[4096];
        int read;

        while ((read = zipStream.Read(buffer, 0, buffer.Length)) > 0) {
            resultStream.Write(buffer, 0, read);
        }

        return resultStream.ToArray();
    } 
```

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-07T04:46:41.780

您需要`Close()`在`ZipStream`添加所有要压缩的数据之后；它在内部（即使你`Flush()`）保留了一个需要写入的未写入字节的缓冲区。

更一般地说，`Stream`是`IDisposable`，所以你也应该是`using`每个......（是的，我知道这`MemoryStream`不会丢失任何数据，但如果你不养成这个习惯，它会和其他人一起咬你`Stream`）。

```
public static byte[] Compress(byte[] data)
{
    using (var compressedStream = new MemoryStream())
    using (var zipStream = new GZipStream(compressedStream, CompressionMode.Compress))
    {
        zipStream.Write(data, 0, data.Length);
        zipStream.Close();
        return compressedStream.ToArray();
    }
}

public static byte[] Decompress(byte[] data)
{
    using(var compressedStream = new MemoryStream(data))
    using(var zipStream = new GZipStream(compressedStream, CompressionMode.Decompress))
    using (var resultStream = new MemoryStream())
    { ... }
} 
```

[编辑：更新的重新评论]不是这样的`using`事情`MemoryStream`- 这总是一个有趣的事情，在栅栏的两边都有很多选票：但最终......

(rhetorical - we all know the answer...) How is `MemoryStream` implemented? is it a byte[] (owned by .NET)? is it a memory-mapped file (owned by the OS)?

The reason you aren't `using` it is because you are letting knowledge of internal implementation details change how you code against a public API - i.e. you just broke the laws of encapsulation. The public API says: I am `IDisposable`; you "own" me; therefore, it is your job to `Dispose()` me when you are through.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-04T03:56:31.557

Also - keep in mind the DeflateStream in System.IO.Compression does not implement the most efficient deflate algorithm. If you like, there is an alternative to the BCL GZipStream and DeflateStream; it is implemented in a fully-managed library based on zlib code, that performs better than the built-in {Deflate,GZip}Stream in this respect. [ But you still need to Close() the stream to get the full bytestream. ]

These stream classes are shipped in the DotNetZlib assembly, available in the DotNetZip distribution at [http://DotNetZip.codeplex.com/](http://DotNetZip.codeplex.com/).

# c++ - 在 WM6+ 上覆盖系统绘图

> ID：271261
> 
> 赞同：1
> 
> 时间：2008-11-07T04:41:46.753
> 
> 标签：c++, user-interface, windows-mobile, overriding, draw

我正在为 WM6+ 开发一个“桌面”，我想知道是否可以覆盖 WM 在启动操作系统时所做的绘制（如开始菜单、软键栏和背景），基本上让我的程序绘制今天的屏幕而不是窗口。我的程序当然会集成原始“屏幕”集成的所有内容。

C++

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T07:12:47.353

您想实现今日屏幕“主题”还是让设备在信息亭模式下运行？第一个很容易——你需要丰富的经验来做第二个。

有可用的商业解决方案可以让您在“Kiosk”模式下操作您的设备。不过这些都不便宜。如果您打算自己动手，那么需要对 Windows CE 操作系统有很好的了解——我建议您下载 Platform Builder（我不知道他们现在如何称呼它）并查看源代码。这是了解系统内部结构的最佳方式。

一个不是那么完美但易于实施的解决方案是创建一个全屏应用程序并在启动时启动它。您还需要拦截硬件密钥。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T17:02:55.120

除了我的问题（因为我无法编辑它），我不会使用主题或今日屏幕 api。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T14:11:45.667

你有几个选择。您可以个性化不需要代码[的主屏幕，使用像](http://www.microsoft.com/windowsmobile/en-us/totalaccess/columns/tips-personalize.mspx)[Ruttensoft](http://www.ruttensoft.com/Products/HomescreenDesigner/HomescreenDesigner2007/tabid/106/Default.aspx)的主题生成器（还有其他的，所以做一些搜索）。最后一个选项是使用[Home Screen API](http://msdn.microsoft.com/en-us/library/aa457653.aspx)或[Today Screen API](http://msdn.microsoft.com/en-us/library/aa458908.aspx)编写您自己的主题，具体取决于您的目标设备外形。

# java - CompositeData 没有 keys() 方法？

> ID：271265
> 
> 赞同：7
> 
> 时间：2008-11-07T04:47:05.697
> 
> 标签：java, jmx, diagnostics, jconsole

我正在使用 JMX 从远程进程中保存一些诊断信息。查看 jconsole 中的接口显示返回类型是[CompositeData](http://java.sun.com/j2se/1.5.0/docs/api/javax/management/openmbean/CompositeData.html)（数据实际上以[CompositeDataSupport](http://java.sun.com/j2se/1.5.0/docs/api/javax/management/openmbean/CompositeDataSupport.html)的形式返回）。我想输出与该对象关联的所有键/值对。

问题是接口似乎有一个“values()”方法，无法获取密钥。我在这里错过了什么吗？有没有其他方法可以完成这项任务？

谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T06:48:34.873

如果我没记错的话你可以做

```
Set< String > keys = cData.getCompositeType().keySet(); 
```

（假设 cData 是 CompositeData 对象）

[http://java.sun.com/j2se/1.5.0/docs/api/javax/management/openmbean/CompositeType.html#keySet()](http://java.sun.com/j2se/1.5.0/docs/api/javax/management/openmbean/CompositeType.html#keySet())

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T06:58:31.203

[您可以使用这个打印所有 JVM MBean 属性的小程序](http://blogs.oracle.com/jmxetc/entry/a_small_program_that_prints)找到更完整的示例

尤其：

```
StringBuffer writeCompositeData(StringBuffer buffer, 
            String prefix, String name, CompositeData data) {
        if (data == null)
            return writeSimple(buffer,prefix,name,null,true);
        writeSimple(buffer,prefix,name,"CompositeData("+
                data.getCompositeType().getTypeName()+")",true);
        buffer.append(prefix).append("{").append("\n");
        final String fieldprefix = prefix + " ";
        for (String key : data.getCompositeType().keySet()) {
            write(buffer,fieldprefix,name+"."+key,data.get(key));
        }
        buffer.append(prefix).append("}").append("\n");
        return buffer;
    } 
```

那个部分：

```
for (String key : data.getCompositeType().keySet()) {
    [...] data.get(key) [...];
} 
```

成为你所追求的。

# asp.net - 使用 ASP.NET AJAX 和更新面板时如何处理视图状态的想法

> ID：271269
> 
> 赞同：2
> 
> 时间：2008-11-07T04:53:02.610
> 
> 标签：asp.net, vb.net, asp.net-ajax, viewstate

这是我写的一个类，用于解决我在视图状态中遇到的一些问题。它将信息存储在用户会话中并增加一个值以跟踪要显示的状态。困难在于不支持返回按钮。我最初有这个的原因是在 AJAX 出现之前，视图状态被发送到客户端而不是存储在服务器上。我认为通过将其存储在服务器上，我可以使客户体验更加丰富。现在，通过诸如速度之类的项目进行分布式缓存，可以将其存储在缓存中。

我很想听听人们可能有的一些评论和任何提示。

```
Public Class ViewState
    ''' <summary>
    ''' Saves the state to the users session
    ''' </summary>
    ''' <param name="viewState">The viewstate object to serialize</param>
    ''' <param name="NoSerialize"></param>
    ''' <returns>Returns the KEY of the string that was saved.</returns>
    ''' <remarks></remarks>
    Function SaveState(ByVal viewState As Object, Optional ByVal NoSerialize As Boolean = False)
        HttpContext.Current.Session("VSID") = HttpContext.Current.Session("VSID") + 1
        If NoSerialize Then
            HttpContext.Current.Session(CacheString) = viewState
        Else
            Dim Format As New LosFormatter
            Dim Writer As New System.IO.StringWriter
            Format.Serialize(Writer, viewState)
            HttpContext.Current.Session(CacheString) = Writer.ToString
        End If
        Return HttpContext.Current.Session("VSID")
    End Function
    ''' <summary>
    ''' Returns a deserialized copy of the viewstate object
    ''' </summary>
    ''' <param name="SQLSTATE"></param>
    ''' <param name="NoSerialize"></param>
    ''' <returns></returns>
    ''' <remarks></remarks>
    Function LoadState(ByVal SQLSTATE, Optional ByVal NoSerialize = False) As Object
        If NoSerialize Then
            If Not HttpContext.Current.Session(CacheString(SQLSTATE)) Is Nothing Then
                Return HttpContext.Current.Session(CacheString(SQLSTATE))
            Else
                HttpContext.Current.Trace.Warn("No ViewState Object Found")
            End If
        Else
            Dim Format As New LosFormatter
            If Not HttpContext.Current.Session(CacheString(SQLSTATE)) Is Nothing Then
                Return Format.Deserialize(HttpContext.Current.Session(CacheString(SQLSTATE)))
            Else
                HttpContext.Current.Trace.Warn("No ViewState Object Found")
            End If
        End If
    End Function
    ''' <summary>
    ''' AJAX Viewstate
    ''' Saves the state to the users session
    ''' </summary>
    ''' <param name="viewState">The viewstate object to serialize</param>
    ''' <param name="VSID">The ID that the page uses to find the viewstate item</param>
    ''' <param name="NoSerialize"></param>
    ''' <returns>Returns the KEY of the string that was saved.</returns>
    ''' <remarks></remarks>
    Function SaveState(ByVal viewState As Object, ByVal VSID As String, Optional ByVal NoSerialize As Boolean = False)
        HttpContext.Current.Session("VSID") = HttpContext.Current.Session("VSID") + 1
        If NoSerialize Then
            If VSID = "" Then
                HttpContext.Current.Session(CacheString) = viewState
                Return HttpContext.Current.Session("VSID")
            Else
                HttpContext.Current.Session("VSID") = HttpContext.Current.Session("VSID") + 1
                HttpContext.Current.Session(CacheString) = viewState
                HttpContext.Current.Session(CacheString(VSID)) = viewState
                Return HttpContext.Current.Session("VSID")
            End If
        Else
            Dim Format As New LosFormatter
            Dim Writer As New System.IO.StringWriter
            Format.Serialize(Writer, viewState)
            If VSID = "" Then
                HttpContext.Current.Session("VSID") = HttpContext.Current.Session("VSID") + 1
                HttpContext.Current.Session(CacheString) = Writer.ToString
                Return HttpContext.Current.Session("VSID")
            Else
                HttpContext.Current.Session("VSID") = HttpContext.Current.Session("VSID") + 1
                HttpContext.Current.Session(CacheString) = Writer.ToString
                HttpContext.Current.Session(CacheString(VSID)) = Writer.ToString
                Return HttpContext.Current.Session("VSID")
            End If
        End If
    End Function
    ''' <summary>
    ''' Gets the string representing the cached viewstate object.
    ''' </summary>
    ''' <param name="VSID">Use this to override the session VSID property and use your own.</param>
    ''' <value></value>
    ''' <returns></returns>
    ''' <remarks></remarks>
    Public ReadOnly Property CacheString(Optional ByVal VSID As Integer = 0) As String
        Get
            If VSID = 0 Then
                Return "ViewState" & HttpContext.Current.Session("VSID")
            Else
                Return "ViewState" & VSID
            End If
        End Get
    End Property
End Class 
```

以下代码位于您的 asp.net 页面背后的代码中：

```
Protected Overrides Sub SavePageStateToPersistenceMedium(ByVal viewState As Object)
        Dim VState As New ViewState
        If String.IsNullOrEmpty(Request.Form("__SQLVIEWSTATE")) = False Then
            RegisterHiddenField("__SQLVIEWSTATE", VState.SaveState(viewState, Request.Form("__SQLVIEWSTATE")))
        Else
            RegisterHiddenField("__SQLVIEWSTATE", VState.SaveState(viewState))
        End If
    End Sub
    Protected Overrides Function LoadPageStateFromPersistenceMedium() As Object
        Dim VState As New ViewState
        Return VState.LoadState(Request.Form("__SQLVIEWSTATE"))
    End Function 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T00:58:29.993

在您滚动自己的代码以将视图状态保留到会话之前，您是否尝试过内置功能？

```
protected override PageStatePersister PageStatePersister
{
    get
    {
        return new SessionPageStatePersister(this);
    }
} 
```

（显示的 C# 版本）。也许这会解决您的后退按钮问题？

**编辑回答评论：**我认为这是 VB 等价物：

```
Public Overrides Function GetStatePersister() As PageStatePersister
  Return New SessionPageStatePersister(Page)
End Function 'GetStatePersister 
```

我不知道这如何处理后退按钮，但我相信它每页最多可存储 10 个状态。

# memory - CUDA中常量内存的动态分配

> ID：271273
> 
> 赞同：9
> 
> 时间：2008-11-07T04:57:35.143
> 
> 标签：memory, dynamic-data, cuda, constants, nvidia

我正在尝试利用常量内存，但我很难弄清楚如何嵌套数组。我所拥有的是一组数据，其中包含内部数据的数量，但每个条目的数量都不同。因此，基于以下简化代码，我有两个问题。首先我不知道如何分配我的数据结构成员指向的数据。其次，由于我不能将 cudaGetSymbolAddress 用于常量内存，我不确定我是否可以只传递全局指针（你不能使用普通的 __device__ 内存）。

```
 struct __align(16)__ data{
int nFiles;
int nNames;
int* files;
int* names;
};

__device__ __constant__ data *mydata;

__host__ void initMemory(...)
{
    cudaMalloc( (void **) &(mydata), sizeof(data)*dynamicsize );
    for(int i=; i lessthan dynamicsize; i++)
    {
        cudaMemcpyToSymbol(mydata, &(nFiles[i]), sizeof(int), sizeof(data)*i, cudaMemcpyHostToDevice);
        //...
        //Problem 1: Allocate & Set mydata[i].files
    }
}

__global__ void myKernel(data *constDataPtr)
{
    //Problem 2: Access constDataPtr[n].files, etc
}

int main()
{
    //...
    myKernel grid, threads (mydata);
} 
```

感谢您提供的任何帮助。:-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-11T15:56:47.770

我认为常量内存是 64K，您不能使用`cudaMalloc`. 它必须被声明为常量，比如说，

```
__constant__ data mydata[100]; 
```

同样，您也不需要释放它。此外，您不应该通过指针传递对它的引用，只需将其作为全局变量访问即可。我尝试做类似的事情，它给了我段错误（在 devicemu 中）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-25T09:38:03.993

不，你不能那样做。

常量内存（最大 64KB）只能在编译前进行硬编码。

但是，您可以动态分配纹理内存，该内存也缓存在设备上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T10:57:25.800

为什么不直接使用所谓的“打包”数据表示？这种方法允许您将所需的所有数据放入一维字节数组中。例如，如果您需要存储

```
struct data
{
    int nFiles;
    int nNames;
    int* files;
    int* names;
} 
```

您可以通过这种方式将此数据存储在数组中：

```
[struct data (7*4=28 bytes)
    [int nFiles=3 (4 bytes)]
    [int nNames=2 (4 bytes)]
    [file0 (4 bytes)]
    [file1 (4 bytes)]
    [file2 (4 bytes)]
    [name0 (4 bytes)]
    [name1 (4 bytes)]
] 
```

# java - 为什么我的 add 方法会覆盖 Vector？

> ID：271274
> 
> 赞同：1
> 
> 时间：2008-11-07T04:57:46.830
> 
> 标签：java, vector

我正在使用其 add(Object) 方法将对象添加到 java Vector 中。在我的示例中，前 5 个对象是相同的，然后是与前 5 个不同的 2 个实例。由于某些原因，只要我插入第一个不同的向量，它就会将整个向量更改为该值！

'values' 是一个迭代器，包含类似 '1','1','1','1','1','2','2'

```
 Vector temp = new Vector();    
while (values.hasNext()) {
     temp.add(values.next());
     System.out.println(temp.toString());
} 
```

它会输出类似

> [1]
> [1,1]
> [1,1,1]
> [1,1,1,1]
> [1,1,1,1,1]
> [2,2,2,2,2,2]
> [2 ,2,2,2,2,2,2]

我尝试使用 LinkedList，以及使用 add(object, index)。同样的事情发生了。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T05:16:36.290

我怀疑，不知何故，您从迭代器获得的“对象”实际上是对可变对象的单个实例的多次引用，该对象正在将其状态从“1”更改为“2”。我无法猜测的是它在这个明显的单线程操作中是如何改变状态的。

你能发布更完整的代码吗？显示从哪里来`values`以及它是如何初始化的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T06:09:18.463

以下程序在 Mac OS X 下编译运行

```
import java.util.Arrays;
import java.util.Iterator;
import java.util.List;
import java.util.Vector;

 public class Test{ 

     public static void main( String ... args ){ 
         List list = Arrays.asList(new String[] {"1","1","1","1","1","2","2"});
         Iterator values = list.iterator();
         Vector temp = new Vector();    
         while (values.hasNext()) {
              temp.add(values.next());
              System.out.println(temp.toString());
         }
     } 
 } 
```

产生了以下结果：

```
[1]
[1, 1]
[1, 1, 1]
[1, 1, 1, 1]
[1, 1, 1, 1, 1]
[1, 1, 1, 1, 1, 2]
[1, 1, 1, 1, 1, 2, 2] 
```

因此，您可能希望提供完整的实现，尤其是您的迭代器。我不得不说，但你真的不应该使用 Vector！

# javascript - 在 HTML 中显示可编辑列表（如电子表格）的最简单方法是什么？

> ID：271276
> 
> 赞同：5
> 
> 时间：2008-11-07T04:58:15.720
> 
> 标签：javascript, html, listview, spreadsheet, farpoint-spread

我们需要在网页中显示可编辑的列表。

最简单的方法是什么？[Farpoint Spread](http://www.fpoint.com/products/spread/spread.aspx)是我之前用来实现这一点的东西，但是当涉及大量记录并且需要用 VBScript 编码时，它会很慢。此外它不是免费的。

我会寻找一种 JavaScript 解决方案，但我买不起。除了点差之外，你还能想到什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T05:12:08.907

我喜欢[JQuery.Spreadsheet UI](http://os.arandomurl.com/jqueryspreadsheet/)，试试[这个演示](http://os.arandomurl.com/jqueryspreadsheet/fullscreen.html)，非常好...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T05:08:10.427

还可以在以下位置找到：[http ://code.google.com/p/completeui](http://code.google.com/p/completeui)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-04T23:11:38.313

FarPoint 有一个 ASP.Net 解决方案：[http ://www.fpoint.com/netproducts/spreadweb/spread.aspx](http://www.fpoint.com/netproducts/spreadweb/spread.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-30T22:20:07.280

试试这个人： http: [//www.visop-dev.com/jquerysheet.html](http://www.visop-dev.com/jquerysheet.html)，这是我要尝试的事情清单，但我还没有开始！它是免费的，但我认为捐赠会很好。

# c# - XslCompiledTransform.Load() 引发 System.IO.FileNotFoundException

> ID：271285
> 
> 赞同：7
> 
> 时间：2008-11-07T05:08:00.537
> 
> 标签：c#, xslcompiledtransform

我的 webapp (ASP.NET 2.0) 在同一台机器上使用 webservice (asmx on 1.1 framework)。在获得 XML 作为回报后，我将它传递 `XslCompiledTransform`给将 XML 转换为 HTML，它工作正常。

昨天我`System.IO.FileNotFoundException`经常遇到这种问题，不知道是什么原因造成的。

首先看看我认为这是关于 c:\windows\temp 的读/写权限，然后我确保给它完全的网络服务权限（最后也是每个人-_-！）但它没有帮助。

任何想法或解决方案将不胜感激。

```
-------------------- stack trace --------------------------
Exception: **System.IO.FileNotFoundException**
**Could not find file 'C:\WINDOWS\TEMP\sivvt5f6.dll'.**

   at System.IO.__Error**.WinIOError**(Int32 errorCode, String maybeFullPath)
   at System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, Int32 
rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean bFromProxy)
   at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access, FileShare share)
   at Microsoft.CSharp.CSharpCodeGenerator.FromFileBatch(CompilerParameters options, String[] fileNames)
   at Microsoft.CSharp.CSharpCodeGenerator.FromDomBatch(CompilerParameters options, CodeCompileUnit[] ea)
   at Microsoft.CSharp.CSharpCodeGenerator.System.CodeDom.Compiler.ICodeCompiler.CompileAssemblyFromDomBatch(CompilerParameters options, CodeCompileUnit[] ea)
   at System.CodeDom.Compiler.CodeDomProvider.CompileAssemblyFromDom(CompilerParameters options, CodeCompileUnit[] compilationUnits)
   at System.Xml.Xsl.Xslt.Scripts.CompileAssembly(List`1 scriptsForLang)
   at System.Xml.Xsl.Xslt.Scripts.CompileScripts()
   at System.Xml.Xsl.Xslt.QilGenerator.Compile(Compiler compiler)
   at System.Xml.Xsl.Xslt.**Compiler.
Compile**(Object stylesheet, XmlResolver xmlResolver, QilExpression& qil)
   at System.Xml.Xsl.XslCompiledTransform.LoadInternal(Object stylesheet, XsltSettings settings, XmlResolver stylesheetResolver)
   at System.Xml.Xsl.**XslCompiledTransform.Load**(String stylesheetUri, XsltSettings settings, XmlResolver stylesheetResolver) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-08T01:17:03.033

在检查详细信息并搜索相关主题后，

1.  .Transform() 发现了这个问题，并且正如 Marc 所说，XmlSerialization 也出现了这个问题。Christoph Schittko 有一篇很好的[故障排除](http://msdn.microsoft.com/en-us/library/aa302290.aspx)文章。
2.  有人说这个问题可能是因为windows的一些更新补丁可以改变序列化器的行为。

    我打电话给我的管理员以澄清我们的服务器是否有任何变化，他说没有任何变化，他建议我重新启动。

    是的......我的问题已经通过......重新启动服务器（windows 2003 ;）解决了

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T05:27:12.743

好的，这是一个有趣的。我在序列化程序中看到了类似的问题，但没有`XslCompiledTransform`特别提到。

从标题来看，我预计这是加载包含/导入的转换的问题，这可能可以通过提供`XmlResolver`. 找不到自己生成的 dll 很奇怪！

作为权宜之计（当您调查问题时），您可能想看看它是否仍然发生在`XslTransform`. 我意识到这并不理想（考虑到 中的优化等`XslCompiledTransform`），但它至少可以让您的应用程序在您调查时工作......

我要做的第一件事是查看事件日志。有什么有趣的吗？还值得检查您的防病毒软件是否没有因误报而发疯（不太可能）。

我要做的下一件事是隔离应用程序 - 即剪掉 1.1 的东西 - 因为你是通过 asmx 页面（到单独的应用程序）调用它，所以它不应该是一个因素，所以你*应该*（理论上）能够仅从平面 xml 文件中复制它。理想情况下，最好在您的项目中有一个页面（为了简单起见可能是一个 ashx），它*只是*尝试从本地文件进行转换。

它可以用简单的 xslt/xml 重现吗？您可以使有问题的代码越简单，您就越接近找到/修复它，或者拥有可以通过“连接”在 MS 上触发的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T23:37:16.370

我在 Windows Server 2003 上遇到了同样的问题。我们的 ASP.NET 应用程序正在使用 Web 服务（在 Web 上的外部机器上），一段时间后我们收到此错误消息。

在应用程序池上运行回收可以解决问题，但我正在寻找问题原因的答案。

任何人？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T07:08:27.907

非常感谢马克的回复。

我的 xsl 文件没有要引用的外部资源（无包含、导入），因此不应调查 XmlResolver。

转换在其他服务器（我有 2 个服务器）和这台服务器中运行良好，在我执行 iisreset 之后，它又开始运行了。但不到一个小时，它又来了。我确实检查了事件查看器，它记录了与我得到的相同的错误！！

---------------- 来自事件查看器 ------------- 事件类型：警告

事件源：ASP.NET 2.0.50727.0 事件类别：Web 事件事件 ID：1309 日期：11/7/2008 时间：下午 2:07:37 用户：N/A 计算机：XXXX 描述：事件代码：3005 事件消息：发生了未处理的异常。事件时间：2008 年 11 月 7 日下午 2:07:37 事件时间 (UTC)：2008 年 11 月 7 日上午 7:07:37 事件 ID：f17058f2126c4a4abb1742a3099010b0 事件序列：25407 事件发生：276 事件详细代码：0

进程信息：进程ID：1128 进程名：w3wp.exe 账户名：NT AUTHORITY\NETWORK SERVICE

异常信息：异常类型：FileNotFoundException 异常消息：找不到文件“C:\WINDOWS\TEMP\irdt-y8o.dll”。......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-24T18:41:56.637

只是一些故障排除的想法：

*   dll文件是否创建？例如，您可以使用 Sysinternals 的 Filemon 来检查 XSLT 是否已实际编译。
*   是否有足够的可用磁盘空间？
*   您的临时文件夹中有多少个文件？%TMP% 中的文件过多可能存在问题
*   机器上还在运行什么？像杀毒软件这样可以清理临时文件夹的东西吗？

# visual-studio-2008 - Visual Studio 2008 Standard 能否创建一个不需要 .NET 框架的单个 EXE？

> ID：271290
> 
> 赞同：2
> 
> 时间：2008-11-07T05:12:32.883
> 
> 标签：visual-studio-2008, deployment

这确实是一个初学者的问题，所以我提前道歉。

我安装了 Visual Studio 2008 Standard，并想创建一个在计算机上运行时不需要任何 .NET 框架的小型 Windows 应用程序。VS 2008 Standard 是否支持这样的功能？关于如何实现这一点的任何指示都会很棒。

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T05:20:08.437

当然，你绝对可以做到这一点。不过，您必须用 C++ 编写应用程序。

要开始，请转到文件 | 新建，在项目类型下选择 Visual C++ 下的选项之一。对于最小的依赖关系，我建议使用 Win32 选项之一。“Win32 控制台应用程序”和“Win32 项目”选项似乎都将您带到同一个向导，如果您单击左侧的应用程序设置，您可以选择是创建控制台应用程序还是 Windows 应用程序。控制台应用程序将在 cmd.exe 之类的控制台窗口中运行，而 Windows 应用程序最初没有 UI（您必须自己做 UI）。

请注意，即使您不依赖 .NET 运行时，您仍然需要在将运行您的程序的机器上提供 CRT dll。这些可再发行组件位于 Visual Studio 安装目录下，如果您安装在默认位置，则该目录为 C:\Program Files\Microsoft Visual Studio 9.0\VC\redist。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T05:56:07.240

[有像Salamander](http://www.remotesoft.com/)这样的第三方编译器（该死的贵）。

另请参阅：[如何将 .NET 应用程序编译为本机代码？](https://stackoverflow.com/questions/45702/is-there-some-way-to-compile-a-net-application-to-native-code)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-23T22:42:13.223

我有同样的问题。这就是我解决的方法：转到“构建”选项卡。单击“配置管理器”。在弹出的画面中，点击“调试”下拉菜单，选择“发布”。点击底部的“关闭”。重新单击构建选项卡，然后单击“重建解决方案”。完成后，全部保存并退出。返回程序的主文件夹，单击“[文件夹名称]，然后单击创建的“发布”文件夹。里面将有两个文件：一个 .exe 和一个带有原始名称的“程序调试数据库”文件程序。这两个文件一起可以在任何没有安装 .NET 库等的计算机上工作。它尽可能接近独立的 .exe。希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T10:23:49.730

如果我想轻松创建一个真正独立的 Windows EXE 应用程序，**我会使用 Delphi**。还好我不想那样做。.NET 太有用了，而且（至少 2.0 版）几乎无处不在 - 我很少遇到没有安装 .NET 的客户端机器，即使它不存在，安装程序也只有 23 MB。

回到我的 Visual Basic 时代，我曾经担心必须将 VB 运行时连同我的应用程序一起部署所带来的额外负担。它从未最终成为一个重大问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-01T08:16:10.147

Also,

There supposed to be several inexpensive (i.e., rather cheap) tools that would link non-net app's DLL(s) together, such as:

1.  Molebox Pro (eu 100)
2.  BitArt's Fusion ($160)
3.  VB Wrap ($100)
4.  PE Bundle ($30)

Additionally,

There's a protection-oriented tool called "Themida" from www.oreans.com that, if purchased along with another one of their tool called "XBundler For Win32/.NET", it promises to have (quote) "DLLs and data files to be embedded inside an application".

Themida sells for eu 200 plus XBundler, selling for eu 120, one can have both for eu 320, which ain't too cheap but not too expensive either.

EXE admirer :-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T08:29:19.117

The only way I have seen anyone get a standalone (not requiring .net to be installed) exe from C# or VB.net is using a program that wraps the framework (at least, the used libraries) in with your exe. And those cost money. you won't find any other way to do it. It's like trying to run a Java app without the Java VM

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T05:45:45.953

VB 6 不基于 .NET 框架。VB**.NET** 是。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-07T05:52:10.277

那么 Visual Studio 2008 Standard 中的 VB 呢？是否为 .NET 平台重写了 VB 引擎？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-07T11:15:29.437

VB.Net 与 VB6 几乎没有共同之处。如果您想了解差异程度，请参阅[http://vb.mvps.org/vfred/breaks.asp](http://vb.mvps.org/vfred/breaks.asp)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-19T08:26:28.980

如果静态链接 c/c++，则不需要部署 redist dll。如果我没记错的话，您可以在项目设置中强制执行，在编译命令中添加“/MT”（不带引号）。然后他可以只发送他的exe，他也不需要发送crt dll。

当然，这意味着他不会在这些 dll 的 Windows 更新中选择新发布的功能，但我想总要权衡取舍。

--edit：好的，我找到了添加该参数的开关；在属性页上，配置属性 -> C/C++ -> 代码生成，然后“运行时库”应设置为“非 dll”选项。这两个是 /MT 和 /MTd（调试）。

# visual-studio - 有人找到适用于 Visual Studio 的 PowerShell 语法突出显示或 IntelliSense 插件吗？

> ID：271292
> 
> 赞同：41
> 
> 时间：2008-11-07T05:15:44.920
> 
> 标签：visual-studio, powershell, plugins, intellisense, syntax-highlighting

有没有人找到 Visual Studio 的插件以允许 PowerShell 语法突出显示或 IntelliSense？如果没有，有人知道为什么不吗？我一直希望其他有大量空闲时间的人现在能解决这个问题。我有希望，因为其他人已经设法获取有限的文档并为其他语言（例如[NHaml](http://sentia.com.au/2008/05/i-love-haml-but-i.html) ）构建自定义 IntelliSense 提供程序。

编辑：澄清一下，我不是在寻找可用于开发 PowerShell 的 IDE 列表。我每天 90% 的时间都在 Visual Studio 中度过。它已经在切片和切块代码方面做得非常好。那是我更喜欢用来编辑所有文本和代码的 IDE。现在我使用 PowerShell 脚本时缺少 PowerShell 语法突出显示，这非常痛苦。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2010-07-27T15:20:47.837

## 2013-08-20 更新

Adam Driscoll 最近宣布了Visual Studio 的[PowerShell 工具作为他以前的](https://github.com/adamdriscoll/poshtools/tree/dev)[PowerGUI Visual Studio 扩展](http://powerguivsx.codeplex.com/)的继任者- 有关详细信息，请参阅他关于[PowerGUI VSX 的未来的](http://csharpening.net/?p=1673)博客文章，其中他承认 Simon Gillbee 概述的前身的缺点（请参阅之前的更新下面）并描述了如何通过删除对 PowerGUI 的依赖来解决它们：

> [...] 通过**将 PowerGUI 编辑器直接嵌入到 Visual Studio 中**，它引起了许多问题，因为它**确实不是真正的语言集成，而更像是一种 hack**。
> 
> [...] PowerGUI VSX v2 将为 PowerShell 提供真正的 Visual Studio 语言支持。**它使用 Visual Studio 编辑器和原始 PowerShell 调试器、标记器和完成引擎。**目前，要求是 PowerShell v3 和 Visual Studio 2012。此要求可能会根据社区支持和采用情况而改变。*[强调我的]*

* * *

## 2013-07-31 更新

Simon Gillbee 刚刚[引用/推广](https://stackoverflow.com/questions/271292/anyone-found-a-powershell-syntax-highlighting-or-intellisense-plugin-for-visual/3345147?noredirect=1#comment26247025_3345147)了一个 PowerShell 语法高亮替代方案，它没有暴露他[之前总结的](https://stackoverflow.com/questions/271292/anyone-found-a-powershell-syntax-highlighting-or-intellisense-plugin-for-visual/3345147?noredirect=1#comment25209604_3345147)[PowerGUI Visual Studio Extension](http://powerguivsx.codeplex.com/)的缺点：

*   [TextHighlighterExtension2012](http://visualstudiogallery.msdn.microsoft.com/fd129629-a1a1-417c-ac80-c9ac7a67b968) (Visual Studio 2012)
*   [TextHighlighterExtension](http://visualstudiogallery.msdn.microsoft.com/6706b602-6f10-4fd1-8e14-75840f855569) (Visual Studio 2010)

* * *

## 初步答案

最近发布的[PowerGUI Visual Studio Extension](http://powerguivsx.codeplex.com/)为 Visual Studio 添加了 PowerShell IntelliSense 支持。虽然它依赖于（免费的）[PowerGUI](http://powergui.org/)图形用户界面和脚本编辑器，但重用这个编辑器组件应该是成熟的标志，而不是我希望的障碍。[（有关介绍，请参阅Visual Studio 中的](http://poshoholic.com/2010/06/16/powershell-support-in-visual-studio/)Kirk Munros PowerShell 支持！博客文章。）

作为 1.0，扩展仍然存在一些[小问题](http://powerguivsx.codeplex.com/workitem/list/basic)，但 Adam Driscoll 似乎非常积极地解决这些问题 - PowerShell 语法突出显示和 IntelliSense 支持对我来说已经非常出色了！

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-07-24T16:41:50.227

这是一个有用的：[PowerGUI VS Extension](http://visualstudiogallery.msdn.microsoft.com/en-us/01516103-d487-4a7e-bb40-c15ec709afa3)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-07T05:34:33.290

我还没有看到任何有关用于 PowerShell 脚本的 Visual Studio Intellisense 的信息。

我建议您尝试其他一些工具，例如：

*   [电源选项卡](http://thepowershellguy.com/blogs/posh/pages/powertab.aspx)
*   [PowerGUI](http://www.powergui.org/index.jspa)

看这个屏幕截图：

[![](https://i.stack.imgur.com/qXaOm.gif)](https://i.stack.imgur.com/qXaOm.gif)
[（来源：[aaronlerch.com](http://www.aaronlerch.com/files/blog/Powershell_Intellisense.gif)）]

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-27T16:21:11.960

VS2010的[PowerConsole](http://visualstudiogallery.msdn.microsoft.com/en-us/67620d8c-93dd-4e57-aa86-c9404acbd7b3?SRC=VSIDE)扩展非常好，看起来很有前途。我不确定它是否适合（或能够）编辑脚本。无论如何都值得一试。

# documentation - 批处理脚本文档

> ID：271311
> 
> 赞同：7
> 
> 时间：2008-11-07T05:31:32.470
> 
> 标签：documentation, scripting, batch-file

是否有一些不错的 Windows 批处理脚本文档可供我在离线时下载和参考？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-01-09T23:16:21.480

我可以推荐：

> [Windows XP 命令行的 AZ 索引](http://ss64.com/nt/)。

它比它更彻底`help`，最重要的是它为每个命令提供了几个示例。示例：[查找](http://ss64.com/nt/find.html)。还有对其他命令的交叉引用。

对于离线阅读，您可以使用例如[Wget](http://en.wikipedia.org/wiki/Wget)（或其他一些可以跟踪链接和内容的工具）来捕获页面。我为 Windows 使用 Bart Puype 的[Wget 二进制文件](http://users.ugent.be/~bpuype/wget/)。

[（ PowerShell](http://en.wikipedia.org/wiki/Windows_PowerShell)也有类似的：“ [Windows PowerShell 命令的 AZ 索引](http://ss64.com/ps/)”。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T05:47:00.520

您始终可以通过键入以下之一来查看命令帮助：

```
<command> /?
help <command> 
```

要查看默认批处理命令的完整列表，您只需键入：

```
help 
```

此外，您可以在 Windows 帮助中查找命令。只需点击“开始”->“帮助和支持”，然后搜索“cmd 参考”即可在全文搜索匹配中看到“命令行参考AZ”页面。它是所有 cmd 命令（其中一些仅在批处理脚本中可用）和其他命令行应用程序的完整列表。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T06:04:40.237

这是您可以打印出来的 8 页 PDF：[Win32 Shell 脚本教程](http://www.exguides.org/batchFiles.pdf/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T06:40:15.857

如果可以，请考虑改用 PowerShell。更多的权力，更少的头痛。这是未来的方式，脚本方面。

你听起来好像还有很多东西要学。如果您在 PowerShell 而不是批处理中进行学习，那么您最终会处于更好的位置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-10T03:30:29.627

虽然学习批处理很有用，但有时使用批处理可能会很麻烦，尤其是在处理数字运算、文本文件解析、HTML 解析等方面。最好也让自己具备使用语言编写脚本的知识例如[Perl](http://en.wikipedia.org/wiki/Perl)和[Python](http://en.wikipedia.org/wiki/Python_%28programming_language%29)。在本机，您还可以学习如何使用[VBScript/JScript](http://www.microsoft.com/downloads/details.aspx?FamilyId=01592C48-207D-4BE1-8A76-1C4099D7BBB9&displaylang=en)。这是您可以下载和离线阅读的指南。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-11-20T10:34:29.133

其他

> [命令行参考AZ](https://technet.microsoft.com/en-us/library/bb490869.aspx)

似乎各种命令行都在左侧边栏中。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-07T05:44:08.107

谷歌点击，“windows批处理脚本文档” - 第一页：

*   [http://labmice.techtarget.com/scripting/batchfiles.htm](http://labmice.techtarget.com/scripting/batchfiles.htm)
*   [http://www.allenware.com/icsw/icswidx.htm](http://www.allenware.com/icsw/icswidx.htm)

# c# - 您是否应该通过属性访问同一类中的变量？

> ID：271318
> 
> 赞同：28
> 
> 时间：2008-11-07T05:36:40.993
> 
> 标签：c#, variables, properties

如果您有一个获取并设置为实例变量的属性，那么通常您总是使用该类外部的属性来访问它。

我的问题是你是否也应该在课堂上也这样做？如果有一个属性，我总是使用该属性，即使在课堂上也是如此，但我想听听一些关于哪个是最正确的以及为什么最正确的论点。

还是只是项目中使用的编码标准问题？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-07T05:47:15.763

通过属性访问本地（类范围）变量的一个更强有力的论据是您在类中添加了一个抽象级别。如果您更改有关该字段如何存储的**任何**逻辑，则其余代码将不受影响。

例如，您可以将其从局部变量更改为子对象的属性、数据库调用、Web 服务调用、类的静态属性等等。进行更改时，它会为您提供单点更改，即属性，并且您不必更新类的其余部分，因为它们都使用该属性。

此外，使用该属性还可以让您对属性的值应用业务规则，而不必在您直接访问该字段的每个位置强制执行相同的规则。再次，封装

随着自动属性的引入，除非您需要在 get/set 上应用业务规则，否则显式拥有局部变量的理由就更少了

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-07T05:42:10.313

这取决于您是否要应用在属性设置器中实现的任何逻辑，因此您必须根据具体情况做出决定。

当您直接进入私有字段时，您知道该字段被设置为您所说的内容。

当您浏览该属性时，该值会根据设置器逻辑进行设置，因此您可以获得任何您想要的业务规则或验证，而不是分配给该字段的值。

很难想出一个关于何时做任何一个都是“正确”的规则，关于我要说我遵循的唯一一个规则是在构造函数初始化中我几乎永远不会使用该属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T05:49:30.080

是的，我认为您应该尽可能在类内部使用属性。属性更灵活，允许您添加逻辑以在中心位置验证其值。

您还可以将字段的初始化延迟到任何时候使用该属性，而不是在构造函数中强制执行（或使用该字段的任何地方）。例子：

```
class Test {
   private int _checksum = -1;
   private int Checksum {
      get {
         if (_checksum == -1)
            _checksum = calculateChecksum();
         return checksum;
      }
   }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T05:43:53.023

我认为这纯粹是偏好。

不过，我发现自己在 C# 3.0 中更多地使用这些属性，并支持自动属性：

```
class Foo {
    public string Value { get; set; }

    public void Write() {
        Console.Write(Value);
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T05:46:01.443

通常取决于项目编码标准，我在私有类属性的名称前使用“_”或“m”。（如下所示）

```
private int mVariable;
private int _Variable; 
```

对于变量前面的那些，我立即意识到我正在处理类的内部变量。然后当涉及到以后自己或其他人调试时，可以立即识别代码正在处理内部私有变量并进行调整。所以它归结为我的可读性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T05:51:23.210

总是使用属性，这里有一些原因

1.  便于使用。在 Visual Studio 中，您可以使用“Prop Tab Tab”。您将获得属性片段
2.  属性是可以像数据成员一样访问的语言元素
3.  .NET 框架类使用它，.NET 框架中的数据绑定代码类支持属性，
4.  属性具有方法的所有语言特性。属性可以是虚拟的

# sql - 无需安装的轻量级 SQL 数据库

> ID：271319
> 
> 赞同：35
> 
> 时间：2008-11-07T05:39:22.110
> 
> 标签：sql, .net, database, ms-access

您能否推荐一个轻量级的 SQL 数据库，它不需要安装在客户端计算机上即可工作，并且可以从 .NET 应用程序轻松访问？只需要基本的 SQL 功能。

现在我在简单的项目中使用 Access 数据库并将 .MDB 和 .EXE 文件一起分发。寻找任何替代品。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-07T05:41:57.490

检查[SQLite](http://www.sqlite.org/)，它是一个实现自包含、无服务器、零配置、事务性 SQL 数据库引擎的软件库。

它有许多.NET 的[包装器](http://www.sqlite.org/cvstrac/wiki?p=SqliteWrappers)

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2013-02-23T19:32:19.577

取决于你所说的轻量级。拉姆容易吗？还是更轻的 db 文件？或者更轻的连接器连接到数据库？还是更少的文件？我将比较我所知道的：

```
 no of files    cumulative size of files    db size

Firebird 2.5             5                6.82 MB               250 KB

SqlServerCe 4            7                2.08 MB               64 KB

Sqlite 3.7.11.0          1                0.83 MB               15 KB

VistaDb 4.3.3.34         1                1.04 MB               48 KB

no of files - includes the .net connector and excludes the db file 
```

数据库是 1 个表，有 2 列和 2 行。使用少量盐来获取 db 大小，因为 dbs 可能会随着进一步使用而不同地增长。例如`SqlServerCe`，虽然最初是 64 KB，但在添加了几百条记录后，它根本没有增长，而是`VistaDb`从 48 到 72 到 140 KB 轻松增长。SQLite 在这方面是最好的，它从最低点开始并线性增长。

轶事：我在出厂设置下使用 SqlServerCe 性能更好，这意味着它最容易在没有任何配置的情况下启动，而由于缺乏在线资料，我发现 Firebird 有点难以启动。据我所知，Firebird 具有最广泛的标准 sql 合规性。虽然 VistaDb 是用完全托管的 C# 编写的，这意味着它可以与应用程序的程序集合并为一个文件，但对我来说似乎是最慢的。总之，考虑到性能、易用性和大小，我选择了 SQLite。SqlServerCe 将是我的第二选择。

简而言之，每个都有其优点和缺点。再说一次，对我的咆哮加一点盐，这只是我的个人经历。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-07T05:45:10.757

SQL Server 3.5/2008 Compact Edition 怎么样？简洁的 SQL Server 嵌入式版本。

[http://www.microsoft.com/Sqlserver/2008/en/us/compact.aspx](http://www.microsoft.com/Sqlserver/2008/en/us/compact.aspx)

与 .NET 配合得非常好，当然所有常规 SQL Server 工具和脚本都可以正常工作。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-21T03:30:08.673

如果您使用 .NET 编写，您可以查看 VistaDB。它是 100% 托管代码，包含真正的参照完整性、tsql 存储过程、clr 过程等等，您可以在单个程序集中进行 xcopy 部署。

VistaDB 在中等信任的共享主机 asp.net 站点中运行，并且在活动目录域中作为访客（无本地权限）运行。

在您部署引擎的机器上不需要注册表或其他配置设置，并且运行时是免版税的。

32/64 位支持包含在单个程序集中。具有非托管代码的混合模式引擎通常要求您提供超过 1 个版本的非托管代码以支持 32 位和 64 位，或针对特定 CPU 目标重新编译。

有关详细信息，请参阅[VistaDB](https://stackoverflow.com/questions/55273/what-are-the-advantages-of-vistadb) SO 线程的优势。

[http://www.vistadb.net](http://www.vistadb.net)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-07T05:48:32.203

[SQLite](http://www.sqlite.org/)很棒。

另请查看[Firebird](http://www.firebirdsql.org/)嵌入式。如果将来有多个用户需要访问数据库，这可能是一个更好的选择。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-02-24T07:15:47.840

您可以将数据存储为 JSON 文件。如果需要单机，有[IODB](http://www.iodb.ca)、[LiteDB等dll解决方案](http://www.litedb.org)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-07T05:42:39.373

[SQLite](http://www.sqlite.org/)将是你所追求的

# c# - 无法在自定义绑定方案中将 DataItem 强制转换为 DataRowView

> ID：271321
> 
> 赞同：0
> 
> 时间：2008-11-07T05:41:50.233
> 
> 标签：c#, data-binding, gridview

我有一个返回 IList 的对象，我从 ObjectDataSource 获取并绑定到 Gridview。如果我只使用标准绑定，一切正常，但我正在尝试自定义绑定以在链接按钮上设置属性，如下所示：

```
protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
        {
            if (e.Row.RowType == DataControlRowType.DataRow)
            {
                //  extract the link button
                LinkButton lnkViewMap = (LinkButton)e.Row.FindControl("lnkViewMap");

                //  grab the datarowview
               System.Data.DataRowView row = (System.Data.DataRowView)e.Row.DataItem;

                //  set the onclientclick to fire our showMap javascript function,
                //  passing through the lat/longs
                lnkViewMap.OnClientClick = string.Format("showMap({0}, {1}); return false;", row["Lat"], row["Long"]);
            }
        } 
```

我将 e.Row.DataItem 转换为 DataRowView 时发生错误。上面的代码来自 Matt Berseth 在 Virtual Earth 上的精彩博客……这就是我在这里尝试实现的。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T05:59:33.960

在调试器中设置断点并查看`e.Row.DataItem`实际是什么类型。

`DataRowView`仅当`DataSource`您在网格上设置的是 a`DataView`或时，它才会是 a `DataTable`。否则它将是集合的元素类型。

# c# - 使用 WCF 有什么好处？

> ID：271326
> 
> 赞同：24
> 
> 时间：2008-11-07T05:43:44.753
> 
> 标签：c#, .net, wcf, .net-3.5

1.  我们目前只是使用肥皂网络服务进行所有的交流，但一直在考虑改用 WCF。与 asmx 服务相比，使用它有什么好处？

2.  如果我们确实使用 WCF 服务，其他语言还能与之通信吗？SOAP 是标准化的，所有语言都可以与之交互。

3.  是否有任何真正好的例子来说明如何开始使用 WCF 来展示它对肥皂的好处？

**编辑**

*   我刚刚发现[这个](https://stackoverflow.com/questions/216931/what-is-the-difference-between-an-aspnet-web-method-and-a-wcf-service)问题很有帮助。
*   [入门教程](http://msdn.microsoft.com/en-us/library/ms734712.aspx)很棒。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-07T06:14:05.567

1.  WCF 有一点学习曲线，但是一旦你学会了它，实现起来并不比 asmx Web 服务难。一个优点是您可以轻松地将协议和序列化从二进制远程切换到[Web 协议](http://msdn.microsoft.com/en-us/library/ms730294.aspx)。在 IIS 中或外部托管也很容易。

2.  其他语言可以与网络协议进行通信。二进制，没那么多...

3.  我刚刚研究了[入门教程](http://msdn.microsoft.com/en-us/library/ms734712.aspx)。它很好地展示了相对易用性。从那里，看看[Hosting](http://msdn.microsoft.com/en-us/library/ms730158.aspx)和更详细的[Features](http://msdn.microsoft.com/en-us/library/ms733103.aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T06:18:33.373

WCF 不是 SOAP 的替代品，实际上，SOAP 可以用作端点之间的序列化格式以进行通信。SOAP 标准也没有真正定义消息正文中的内容，因此在 WCF 到 WCF 通信的情况下，使用 SOAP 信封，但内容是二进制的，所以这是您的主要优势，至少在条款方面的表现。另一个优点是，WCF 的编程模型或者至少打算变得更加简单。特别是因为听起来您实际上只是在使用 Web 服务进行内部通信。在这种情况下，大部分工作将是预先配置端点（尽管在 .NET 中使用 asmx WSDL 显然非常容易）。

我不是 WCF 方面的专家，但我所知道的来自 Juval Lowy（他编写了 O'Reilly WCF 书籍）的 .NET 用户组演示文稿，[他的网站](http://www.idesign.net/idesign/DesktopDefault.aspx)以截屏视频和示例的方式提供了大量信息在资源部分，除了 Microsoft 网站（您检查[过 Channel9](http://channel9.msdn.com)吗？）。

* * *

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-14T14:08:08.013

根据问题中链接的[这篇 MSDN 文章](https://stackoverflow.com/questions/216931/what-is-the-difference-between-an-aspnet-web-method-and-a-wcf-service)，WCF 不仅支持 SOAP。它支持：

*   **BasicHttpBinding**
    与支持 WS-BasicProfile 1.1 和 Basic Security Profile 1.0 的 Web 服务和客户端的互操作性。

*   **WSHttpBinding**
    与通过 HTTP 支持 WS-* 协议的 Web 服务和客户端的互操作性。

*   **WSDualHttpBinding**
    双工 HTTP 通信，初始消息的接收方不直接回复初始发送方，但可以使用符合 WS-* 协议的 HTTP 在一段时间内发送任意数量的响应。

*   **WSFederationBinding**
    HTTP 通信，其中可以根据显式标识的凭据提供程序颁发​​的凭据控制对服务资源的访问。

*   **NetTcpBinding**
    跨网络的 WCF 软件实体之间的安全、可靠、高性能通信。

*   **NetNamedPipeBinding**
    在同一台机器上的 WCF 软件实体之间进行安全、可靠、高性能的通信。

*   **NetMsmqBinding**
    使用 MSMQ 在 WCF 软件实体之间进行通信。

*   **MsmqIntegrationBinding**
    使用 MSMQ 在 WCF 软件实体和另一个软件实体之间进行通信。

*   **NetPeerTcpBinding**
    使用 Windows 对等网络在 WCF 软件实体之间进行通信。

# actionscript-3 - Flash AS3 中的类设计和继承问题

> ID：271329
> 
> 赞同：0
> 
> 时间：2008-11-07T05:44:14.007
> 
> 标签：actionscript-3, inheritance

我对如何设计一些类有疑问。我有三个班。一个超类和两个子类。

Flash 制作了一个子类（AnimatedCharacter），用于在屏幕上显示对象。另一个（CharacterPhysics）是我自己做的，用来扩展超类。

问题是我使用的对象是 AnimatedCharacter 类型，所以我不能把它放在 CharacterPhysics 类型的变量中。

我尝试的是某种装饰器模式，通过为 CharacterPhysics 类型的对象提供对另一个对象的引用。但是现在我必须重写超类的所有方法并将方法调用传递给引用。不是理想的情况。

有人知道如何解决这类问题吗？

[替代文字 http://www.freeimagehosting.net/uploads/7a95f8352c.png](http://www.freeimagehosting.net/uploads/7a95f8352c.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T18:41:16.167

我不太明白你描述的这个类结构的目的（类名让我很困惑），但总的来说，有几件事可能会对你有所帮助：

几乎总是最好的解决方案是通过评估是否应该例如以替代方式分解类的*职责*来尝试重新考虑您的类模型，以便您可以以更好的方式利用继承和多态性。

> *“问题是我使用的对象是 AnimatedCharacter 类型的，所以我不能把它放在 CharacterPhysics 类型的变量中。”*

如果要将 a 放入`AnimatedCharacter`type 的变量中`CharacterPhysics`，则前者应该扩展后者，或者您应该为两者都有一个公共接口（或超类），然后按原样键入变量。如果这是不可能的，我的意见是你可能应该尝试重新考虑和重构你的整个类结构，假设你有一个坚实的“面向对象”的理由想要这样做;)。

如果上述方法不可行，您可以在上下文中评估其他一些技巧：

*   [mixin](http://en.wikipedia.org/wiki/Mixin)的使用可以作为“穷人的多重继承”。[Derek Wischusen 在flexonrails.net](http://flexonrails.net/?p=79)上有一些关于如何在 AS3 中实现它们的示例。
*   “有点”用[flash.utils.Proxy](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/utils/Proxy.html)实现装饰器模式。这种方法的问题是您将大量错误检查从编译时推迟到运行时，但好处是您不必手动编写“装饰”对象的所有方法的“代理”实现, 但只写一个 ( [`callProperty()`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/utils/Proxy.html#callProperty())) 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T20:36:27.793

在我的脑海中，这两个似乎应该是你的主类实现的接口

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T19:06:12.903

您可以将子类解释为超类的实例，但反之则不行。你是不是说反了？

如果是这样，您可以使用：

vas cp:CharacterPhysics;

...

var ac:AnimatedCharacter = cp 作为 AnimatedCharacter

# javascript - 如何触发 JQuery 树视图的渲染

> ID：271330
> 
> 赞同：0
> 
> 时间：2008-11-07T05:45:04.487
> 
> 标签：javascript, jquery, treeview

我使用[jquery 树插件](http://docs.jquery.com/Plugins/Treeview)来呈现分层数据。

我编写了额外的函数，允许用户与这些数据进行交互（如添加/删除节点、交换节点等......）

目前这个插件支持当你想添加任何节点时，你可以调用以下方法，

```
$("#browser").treeview({
     add: branches
}); 
```

这里`branches`是`jQuery object`用 HTML 块创建的，它代表一个特定的节点。

但是，对于节点的删除和交换，我使用常见的 JQuery 函数，例如，

**对于删除，**

```
$("#topnd2").remove(); 
```

**用于交换，**

```
var next = $("#topnd2").next();
$("#topnd2").insertAfter(next); 
```

`topnd2`是`id`任何特定树节点的一个。

节点被正确删除/交换，但问题是树没有被渲染，因此树图像（主要是表示分支的垂直线）没有正确设置。

例如，如果我删除最后一个节点，则该节点将从渲染的树视图中删除，但剩余的兄弟节点应该将 L 作为支线图像而不是 | .

我试着打电话

`$("#browser").treeview();`

请让我知道你的想法。

谢谢， 贾坦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T06:31:17.077

我找到了一些解决方法，如下所示，

一旦节点被交换，虚拟地将它的前一个节点添加到它的子节点，

$("#browser").treeview({add:$("#topnd2").insertBefore(previous).next()});

如果节点被交换下来，则将当前节点虚拟添加到其下一个节点。

$("#browser").treeview({add:$("#topnd2").insertAfter(next)});

目前它工作正常，如果我发现这种方法有任何问题，将更新这篇文章。如果您知道，也请验证此方法。

问候， 贾坦

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-11T01:43:38.503

如果您在删除节点后再次尝试刷新树视图，链接将起作用，但 [+] 或 [-] 图标不起作用。在几个浏览器上试过这个..

# solr - solr 查询中的布尔值 NOT

> ID：271337
> 
> 赞同：30
> 
> 时间：2008-11-07T05:49:14.197
> 
> 标签：solr

如何使用布尔 NOT 概念从 Solr 中选择/删除所有文档？

即如何从Solr 中删除ID 不以A59 开头的所有文档？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-12-19T01:41:38.827

用来`-`表示`NOT`。

例如，要查询 id 不是以 A59 开头的文档，则查询为：`-id:A59*`，即：`/solr/select/?q=-id:A59*`

要通过查询删除，请将删除消息中的查询发布到更新处理程序，如此处[指定](http://wiki.apache.org/solr/UpdateXmlMessages#head-f5553a8214869b11708ad5476e05e7b05a024c23)。

编辑：（`NOT`全部大写）也可以用作布尔运算符

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-09-10T12:41:48.383

感叹号也适用于 NOT，所以：

```
/solr/select/?q=!id:A59* 
```

应该在上述情况下工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-04T17:23:22.870

我不相信查询的否定删除有效。请参阅此 Jira 票证： [https ://issues.apache.org/jira/browse/SOLR-381](https://issues.apache.org/jira/browse/SOLR-381)

他们确实说有一种解决方法可以在 : 中添加前缀，但我对此没有任何运气。

这不起作用（与使用 NOT 相同） java -Ddata=args -jar /opt/solr/example/exampledocs/post.jar "-userid:*" java -jar /opt/solr/example/exampledocs/post.jar *.xml

添加 : 会产生语法错误（与使用 NOT 相同） java -Ddata=args -jar /opt/solr/example/exampledocs/post.jar ": -userid:*" java -jar /opt/solr/example/示例文档/post.jar *.xml

SimplePostTool：1.4 版 SimplePostTool：将参数发布到[http://localhost:8983/solr/update](http://localhost:8983/solr/update) .. SimplePostTool：致命：Solr 返回错误 #400 解析 Lucene 查询时出错 SimplePostTool：1.4 版

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-03-13T05:35:28.037

在文件前面使用 - 符号表示排除该特定值。它会给出**不等于的结果**

以下是示例 url 查询字符串 where。我保留了“ **&fq=-HQ_City_Code:MEL** ”，

它将跳过所有具有**HQ_City_Code**值**MEL**的结果。

```
http://localhost:8983/solr/HQ_SOLR_Hotels/select?q=*:*&fq=HQ_National_Code:TH&fq=HQ_TYPE:hotel_EN&fq=HQ_Country_Code:AU&**fq=-HQ_City_Code:MEL**&wt=json&indent=true 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-23T16:30:25.550

在删除之前，请确保您所指的 id 是字符串，绝不会由两个术语组合而成。我会这样做的方法是从脚本中读取来自 solr 的数据并执行单个删除或批量删除，因为它提供了对每个 id 的更好控制和验证，从而降低了错误删除的风险因此 1 从 solr 中读取数据使用 /solr/select/?q=id:A59* 的脚本

2 验证和验证 id

3 一个一个删除或一次删除一组10个id

问候

拉贾特

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-30T19:50:49.403

正如[毛里西奥](https://stackoverflow.com/a/379890/643761)所说：

使用 - 符号指示您要在查询中排除的内容。以下两个查询将删除除以 A59 开头的文档之外的所有文档。

```
GET http://<url>/solr/<core>/update?stream.body=<delete><query>-id:A59*</query></delete>
GET http://<url>/solr/<core>/update?stream.body=<commit/> 
```

第一行执行删除操作。第二行进行提交。

# javascript - dojo 组合框源的动态 url

> ID：271340
> 
> 赞同：0
> 
> 时间：2008-11-07T05:49:48.907
> 
> 标签：javascript, dojo

我正在尝试使用带有 Ajax 数据源的 dojo 组合框。我所拥有的是

```
<div dojoType="dojo.data.ItemFileReadStore" 
     jsId="tags" 
     url="<%=ResolveClientUrl("~/Tag/TagMatches")%>" >
</div>
<select dojoType="dijit.form.ComboBox" 
        store="tags" 
        value="" 
        name="tagName">
</select> 
```

除了我不能限制服务器端的搜索集之外，这确实有效，因为我不知道如何更改从中提取数据的 url 以指定参数。有什么提示吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T07:29:58.863

如果我理解正确，您希望客户端根据其他地方定义的一般条件从服务器加载不同的数据集。

基本上不需要`<div>`预先定义。您也可以`ItemFileReadStore`直接在 JavaScript 中创建：

早些时候...：

```
var tagMatchUrlBase = '<%=ResolveClientUrl("~/Tag/TagMatches")%>'; 
```

之后...：

```
var tagMatchUrl = tagMatchUrlBase + "?f=" + escape(somefilterString);
var store = new dojo.data.ItemFileReadStore({url: tagMatchUrl});
tagName.store = store;
// maybe use store.fetch() to pre-select item #1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T09:59:56.467

通常这不是通过 ItemFileReadStore 完成的，它旨在预先下载所有数据，而不是在服务器上进行过滤。

相反，您应该使用[QueryReadStore](http://docs.dojocampus.org/dojox/data/QueryReadStore)、[JsonReadStore](http://docs.dojocampus.org/dojox/data/JsonRestStore)等。

# c# - 制作通用属性

> ID：271347
> 
> 赞同：76
> 
> 时间：2008-11-07T05:57:36.553
> 
> 标签：c#, .net, generics, properties

我有一个存储序列化值和类型的类。我想要一个属性/方法返回已经转换的值：

```
public String Value { get; set; }

public Type TheType { get; set; }

public typeof(TheType) CastedValue { get { return Convert.ChangeType(Value, typeof(_Type)); } 
```

这在 C# 中可能吗？

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2008-11-07T06:04:26.040

如果包含该属性的类是泛型的，并且您使用泛型参数声明该属性，则这是可能的：

```
class Foo<TValue> {
    public string Value { get; set; }
    public TValue TypedValue {
        get {
            return (TValue)Convert.ChangeType(Value, typeof(TValue));
        }
    }
} 
```

另一种方法是使用通用方法：

```
class Foo {
    public string Value { get; set; }
    public Type TheType { get; set; }

    public T CastValue<T>() {
         return (T)Convert.ChangeType(Value, typeof(T));
    }
} 
```

您还可以使用`System.ComponentModel.TypeConverter`类进行转换，因为它们允许类定义它自己的转换器。

**编辑**：请注意，调用泛型方法时，必须指定泛型类型参数，因为编译器无法推断它：

```
Foo foo = new Foo();
foo.Value = "100";
foo.Type = typeof(int);

int c = foo.CastValue<int>(); 
```

您必须在编译时知道类型。如果您在编译时不知道类型，则必须将其存储在 中`object`，在这种情况下，您可以将以下属性添加到`Foo`类中：

```
public object ConvertedValue {
    get {
        return Convert.ChangeType(Value, Type);
    }
} 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-11-07T06:25:33.580

属性、事件、构造函数等不能是通用的——只有方法和类型可以是通用的。大多数时候这不是问题，但我同意有时这很痛苦。布兰农的回答提供了两种合理的解决方法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-07T06:05:05.397

我不相信你在这里给出的例子是可能的。CastedValue 的类型必须在编译时定义，这意味着它不能依赖于运行时值（TheType 属性的值）。

编辑：布兰农的解决方案对于如何使用通用函数而不是属性来处理这个问题有一些好主意。

# .net - 哪些安装密钥软件非常适合 Visual Basic 或 C# 应用程序？

> ID：271355
> 
> 赞同：1
> 
> 时间：2008-11-07T06:03:56.883
> 
> 标签：.net, key, registration

所以我准备用 VB 和 C#（用 Visual Studio 2008 编写）结束另一个项目。现在，如果用户输入有效的注册密钥值（如 xxxx-xxxx-xxxx-xxxx），我希望软件仅在完整版模式下运行。大师名单上有哪些软件，一旦出售给最终用户，我可以使用它来管理注册密钥的生成和与应用程序的集成？

非常感谢您的反馈。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-07T07:28:49.597

在[NSIS](http://nsis.sourceforge.net/)工具上掠夺。它提供了许多功能，而且很可能还为您的安装提供了一个密钥检查插件（或至少可以自己制作一个）。虽然到目前为止我只将它用于简单的设置。

# apache-flex - flash / flex的图像加载图标？

> ID：271360
> 
> 赞同：5
> 
> 时间：2008-11-07T06:08:00.713
> 
> 标签：apache-flex, flash, loading

在 Flash/Flex 应用程序中加载图像或 .swf 文件时，您经常会看到那些小的“花瓣”动画。

我是否必须从某人那里偷这个，或者是否有一个标准的可以从某个地方获得。我认为有一些标准，因为每个人看起来都一样！

理想情况下，我想要一个在加载超过 1/4 秒时显示这样一个图标的 flex Image 控件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T06:10:14.453

[您可以在AjaxLoad](http://www.ajaxload.info)下载该图标和其他图标（作为 gif 动画）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T14:54:54.737

使用前面提到的[AjaxLoad.info](http://www.ajaxload.info/)并将动画 GIF 加载到 Flash CS3 中。另存为 SWF。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-12T09:20:20.030

以下是一些您可以使用[的“加载”SWF 文件。](http://www.designswan.com/archives/18-flash-loading-animations.html)

# vim - 在 Vim 中保存“所有打开缓冲区列表”的变量？

> ID：271364
> 
> 赞同：11
> 
> 时间：2008-11-07T06:13:47.580
> 
> 标签：vim

`:vimgrep`看起来像一个非常有用的东西。

以下是如何使用它：

```
:vim[grep][!] /{pattern}/[g][j] {file} ... 
```

`:help`说您基本上可以为当前目录`{file}`命名，例如。`*.c`我可能用一个足够复杂的文件列表启动 Vim，我不想手动输入 for `{file}`，而且 Vim 已经知道这些文件是什么。

我想做的是 vimgrep 任何一个：

*   `:args`
*   `:files`
*   `:buffers`

我将使用哪些变量`{file}`来分别命名命令中的任何这些列表`vimgrep`？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T10:26:43.077

您不能将这些命令中的结果捕获到寄存器（`:h :redir`）中，然后将其重新插入`:vimgrep`调用中（使用 a `:exe`）。

就像是：

```
:exe "vimgrep/pattern/ " . lh#askvim#Exe(':args') 
```

笔记：

*   [lh#askvim#Exe](https://github.com/LucHermitte/lh-vim-lib#miscellaneous-functions)只是一个包装器`:redir`；没什么复杂的
*   其中一些结果可能需要一些处理（请参阅`:args`添加方括号）
*   有时有一个函数可以准确返回您要查找的内容，以防`join(argv(), ' ')`万一`:args`
*   关于 :buffers，可能类似于：

.

```
function BuffersList()
  let all = range(0, bufnr('$'))
  let res = []
  for b in all
    if buflisted(b)
      call add(res, bufname(b))
    endif
  endfor
  return res
endfunction
:exe 'vimgrep/pattern/ '.join(BuffersList(),' ') 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-07T06:31:12.240

你可以这样做：

```
:bufdo vimgrep /pattern/ % 
```

% 替换缓冲区名称。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-10-14T17:01:42.593

要 [vim]grep 参数列表中的文件列表，您可以使用`##`（参见 参考资料`:help cmdline-special`）。

```
:vimgrep /re/ ## 
```

我不知道缓冲区列表有类似的速记，但您可以执行以下操作：

```
:argdelete ##
:bufdo argadd % 
```

...然后使用`##`. 或用于`:n`打开新文件（将添加到 arg 列表中）而不是`:e`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-07T10:58:39.320

这是其中一个答案的稍微改进的版本。以下命令在所有打开的选项卡中搜索模式并记住快速修复列表中的结果：

```
:cex [] | tabdo vimgrepa /pattern/ % 
```

`cex []`将 quickfix 列表的内容设置为空列表。您需要先调用它，因为它`vimgrepa`会累积所有选项卡的搜索结果。此外，您可以替换`tabdo`为`argdo`,`bufdo`和`windo`。

要查看搜索结果，请执行：

```
:cope 
```

但是，此方法有局限性：它只能在已经分配了文件名的选项卡中搜索（`%`不会在新选项卡中展开）。

**编辑：** 您还可以`~/.vimrc`像这样将命令快捷地转换为函数：

```
function TS(text)
    exe "cex [] | tabdo vimgrepa /" . a:text . "/ %"
endfunction
command -nargs=1 TS call TS(<q-args>)
cnoreabbrev ts TS 
```

在最后一行，您可以像这样调用您的函数：

```
:ts from game import 
```

其中后面的单词`ts`是搜索模式。如果没有最后一行，您必须以大写形式输入函数名称。

# mobile - 如何在移动设备上测试网站设计？

> ID：271378
> 
> 赞同：5
> 
> 时间：2008-11-07T06:29:36.830
> 
> 标签：mobile, responsive-design, windows-mobile, handhelddevice

我用 900 x 600 的固定背景图像设计了我的网站。在电脑上看起来不错。它在 PDA 设备上看起来如何？我需要为 PDA 单独设计吗？

应该如何检查我的网站是否可以通过手机有效浏览？

我应该怎么办？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-07T07:15:21.467

*   尝试使用[Opera](http://www.opera.com/)的“小屏幕”视图（视图 > 小屏幕）。这在模拟移动屏幕方面做得相当不错。在 Opera 自己的网站上试用。请注意，当您在手持设备上查看或切换到小屏幕模式时，它们使用“手持”类型的样式表。

*   您可以免费下载[Google 的 Android SDK](http://code.google.com/android/)进行测试。

*   要在 iPhone 上进行测试，请参阅[iPhone 测试器](http://iphonetester.com/)。右下角有一个按钮可以将 iPhone 旋转到宽屏状态。

*   OpenWave[电话模拟器](http://developer.openwave.com/dvl/tools_and_sdk/phone_simulator/)应该不错。

*   你可以试试[mobi在线模拟器](http://mtld.mobi/emulator.php)。

*   适用于 Smartphone的[Windows Mobile 5.0 SDK](http://www.microsoft.com/downloads/details.aspx?familyid=dc6c00cb-738a-4b97-8910-5cd29ab5f8d9&displaylang=en)包含“基于 Windows Mobile 5.0 的 Smartphone Device Emulator 图像和皮肤文件”

*   最后，一些一般性指导：**[Web 内容可访问性和移动 Web：使网站对残疾人和移动设备都可访问](http://www.w3.org/WAI/mobile/)**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T07:33:38.560

您可以为手持设备提供替代样式表，而不是浏览器检测。和

```
<link rel="stylesheet" href="small.css" type="text/css" media="handheld"> 
```

优点是您只需要一个版本的站点，区别在于样式表。您需要一个额外的 CSS，而通过浏览器检测，您需要站点中每个页面的不同版本。缺点是并非所有浏览器都支持`media`样式表的属性。但是最现代的浏览器会这样做，并且对它的支持正在增长。

如果您有兴趣，我建议您查看[A List Apart 文章](http://www.alistapart.com/articles/pocket/)。

顺便说一句，如果您还没有使用 css，请立即切换到它，无论您选择哪种解决方案来解决您的问题。CSS 摇滚！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-16T10:32:20.450

您还可以获得[黑莓](https://www.blackberry.com/Downloads/entry.do?code=060AD92489947D410D897474079C1477)系列机器的设备模拟器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T06:32:37.450

好吧，您总是可以在其中抛出一些检测 javascript 来检查浏览器的类型，然后重定向到为移动设备格式化的不同站点。这似乎是大多数网站的常态。

例子：

*   Digg.com
*   推特网
*   谷歌网站

# svn - SVN - 如何使旧版本成为头部版本？

> ID：271380
> 
> 赞同：36
> 
> 时间：2008-11-07T06:30:46.407
> 
> 标签：svn

我当前的头部修订中的一个文件已损坏。我想将该文件的旧版本作为头版本，因为人们通常会在我的项目中同步到头版本。怎么做？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-11-07T06:39:33.847

您应该恢复自旧恢复以来的所有更改。原则，

```
svn merge -rHEAD:oldrev filename
svn commit -m "rolled back to oldrev" 
```

应该做。后来的修订版仍然存在，但已恢复。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-07T06:40:27.450

你应该做一个[反向合并](http://svnbook.red-bean.com/en/1.2/svn.branchmerge.commonuses.html#svn.branchmerge.commonuses.undo)。

# .net - LINQ（语言集成查询）的优缺点

> ID：271384
> 
> 赞同：28
> 
> 时间：2008-11-07T06:33:02.377
> 
> 标签：.net, linq

*   LINQ（语言集成查询）的优缺点是什么？
*   使用 LINQ 的最佳和最坏情况是什么？
*   您如何从使用 LINQ 中受益或没有受益？
*   哪些数据源从 LINQ 中受益最少和最多？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-07T07:07:21.200

我是 LINQ 的忠实拥护者——尽管它需要保持透视，而不是被视为灵丹妙药。

优点：

*   声明式方法使查询更容易理解和更紧凑
*   可扩展性和表达式树允许对多个源进行基本一致的查询
*   甚至进程内查询也可以用 LINQ to Objects 以外的方式实现——例如并行 LINQ 和我自己的 Push LINQ 框架。非常灵活。
*   *对于最容易理解的进程内查询非常*有用**
**   很高兴能够避免在字符串等中使用 SQL*   默认提供广泛的运算符，并且可以为 LINQ to Objects 轻松添加其他运算符*   主要为 LINQ 引入的语言特性在其他地方广泛适用（对 lambdas 来说是的）*

 *缺点：

*   查询表达式的理解不够好，并且被过度使用。通常简单的方法调用更短更简单。
*   提供商之间不可避免的不一致 - 阻抗不匹配仍然存在，这是合理的但需要了解
*   总有一些事情你可以在 SQL 中做，但在 LINQ 中不行
*   在不了解发生了什么的情况下，很容易编写非常低效的代码
*   很难编写 LINQ 提供程序。这很可能是不可避免的，但我们将不胜感激微软提供的更多指导。
*   对于大多数开发人员来说，这是一种思考数据访问的新方式，需要时间来理解渗透
*   不是特别是 LINQ，而是与它相关 - 在 C# 中发现扩展方法的方式不够精细
*   一些运算符“缺失”，特别是`OrderBy`对于除订购以外的事物的等价物 - 例如，查找具有属性最大值的项目
*   延迟执行和流式处理知之甚少（但正在改进）
*   由于延迟执行和流式传输，调试可能非常棘手
*   在某些特定情况下，LINQ 可能比手动代码慢得多。你越了解内部运作，你就能更好地预测这一点。（当然，如果性能对您很重要，您应该围绕它进行适当的测试。）

我发现处理进程内查询时最好。它们很容易预测、理解和扩展。LINQ to XML 和 Parallel LINQ 等互补技术非常棒。LINQ to Objects 几乎可以在任何地方使用。

LINQ to SQL 等在适当的地方非常好，但它们更难理解并且需要更多的专业知识。它们也仅适用于代码的某些区域。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T07:17:41.743

我最喜欢的部分：使用它们来简化编写单元测试。IEnumerable 链也敦促我在我的代码中编写更流畅的接口。

缺点：Lambda 和扩展方法是我的锤子，所有问题都是钉子。

总体而言：为我的 C# 编程注入了新的活力。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T07:41:23.300

它们存在一个问题，即通过延迟执行从 try catch 块中偷偷出现异常。

例如：

```
var l = new List<int>() {1, 2, 3};
try
{
    l.Select(x => x / 0);
}
catch
{
    // error
}

l.elementAt(0); // exception occurs here outside of the try catch 
```

当您第一次遇到它时，这可能会很棘手，尤其是当调试器会将您指向 try-catch 中的代码时。

否则，我发现它们非常有用并且非常节省时间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-28T06:01:12.600

临：

*   LINQ to SQL 非常好地允许 RAD 与数据库
*   轻松查询多个数据源
*   [LINQ to SharePoint](http://www.codeplex.com/LINQtoSharePoint)，[LINQ to Active Directory](http://www.codeplex.com/LINQtoAD)，[LINQ to TFS](http://www.codeplex.com/LinqTfs)，[LINQ to Umbraco](http://www.aaron-powell.com/blog.aspx?id=1287)，（不胜枚举）

缺点：

*   像任何新技术一样，有太多人不理解但仍在使用它

@Jon Skeet - 另一个很好的回应，你抢了大家的风头：P。我完全同意编写提供程序的难度，我目前正在处理中！你熟悉 Bart De Smet 吗？他有很多这样做的好例子。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T09:24:17.463

我主要使用 LINQ 来处理对象的集合。LINQ 与对象集合完美配合，在大多数情况下不需要谓词函数。

不久前我尝试使用 LINQ to SQL，但发现它功能不足且笨拙。特别是我无法让自己使用 SQL 数据库类设计器。也许它确实在数据库上提供了智能感知，但是当你有 SQL 时谁需要它呢？

不过让我告诉你，学习更多关于 LINQ 的知识当然是个好主意，因为未来的应用程序只会增加。

# random - 如何在 Smalltalk 中生成一个范围内的随机整数？

> ID：271394
> 
> 赞同：3
> 
> 时间：2008-11-07T06:44:33.290
> 
> 标签：random, smalltalk, logical-operators

我目前正在上的一门课要求我们在 smalltalk 中完成所有编码（这是一门设计课）。在我们的一个项目中，我想做一些事情，但很难找到如何去做。似乎大多数人所做的只是修改他们自己的 smalltalk 版本来做他们需要它做的事情。我不能这样做，因为当我的教授没有与我相同的内置方法时，这会导致我的教授的计算机出现错误。

这是我想要做的：

随机数。我需要创建一个介于 1 到 1000 之间的随机数。现在我正在通过这样做来伪造它

```
rand := Random new.
rand := (rand nextValue) * 1000.
rand := rand asInteger. 
```

这给了我一个 0 到 1000 之间的数字。有没有办法在一个命令中做到这一点？如同

```
Random between: 0 and: 1000 
```

和/或语句。这让我大吃一惊。我尝试了几种不同的配置

```
(statement) and: (statement) ifTrue...
(statement) and (statement) ifTrue... 
```

所以我用嵌套的 ifTrue 语句来伪造它：

```
(statement) ifTrue:[
    (statement) ifTrue:[... 
```

在smalltalk中做和/或随机的正确方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T06:51:45.880

问题是

```
 (expr) and: (expr) ifTrue: aBlock 
```

被解析为方法`and:ifTrue:` 如果您查看 Boolean 类（特别是 True 或 False），您会注意到 ifTrue: 只是一个常规方法，并且没有方法 and:ifTrue: 存在 - 但是，plain and: 存在。因此，为了清楚地表明这是两条消息，请写

```
((expr) and: (expr)) ifTrue: aBlock 
```

对于更长的布尔组合，请注意还有方法 and:and: and and:and:and: 实现。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-22T09:09:54.813

```
(1 to: 1000) atRandom 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-12T22:38:18.403

如果您使用的是 VisualWorks，并且： 将块作为参数，那么您将编写：

```
(aBoolean and: [anotherBoolean]) ifTrue: [doSomething]. 
```

还有`&`, 它不将块作为参数，

```
aBoolean & anotherBoolean ifTrue:[doSomething]. 
```

区别是 and: 仅在第一个 bool 为真时才评估块中的内容（类似于 java），而`&`始终评估两者。

如果第二个条件在计算上很昂贵，或者如果它包括仅在第一个条件为真时才应该发生的状态更改，则因此`and:`会派上用场。（虽然这通常是一个糟糕的设计）。

至于 Random，只要您提供自定义方法`Random >> between: and:`以及其余代码，它就可以在您的教授计算机上正常运行。具体如何做到这一点，取决于您应该以何种格式交付作业。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-07T08:15:41.390

至于随机问题：这取决于您使用的 ST 版本。在 Squeak 3.9 中，有`Random>>#nextInt:`，它被记录为“Answer a random integer in the interval [1, anInteger].”。它的实现如下

```
(self next * anInteger) truncated + 1 
```

所以我在这里有两条评论：

1.  你真的应该学会使用类浏览器。这可以回答（常见的）问题“我可以向 X 类的对象发送什么消息”
2.  在 ST 中，向现有类添加新方法是很常见的。因此，如果您希望 Random 具有 between:and:，只需添加它，例如

    ```
    between: low and: high      
       ^(self next * (high-low+1)) truncated + low 
    ```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-11-22T13:30:35.027

**创建几个 1 到 1000 之间的随机整数**
首先创建一个随机数系列。只做一次。

然后通过从系列中获取下一个数字来创建一个新的随机数。根据需要重复。

```
aRandomSeries := Random new .
    "Seed a new series of random numbers"  

aRandomInt := aRandomSeries newInt: 1000 . 
    "generate a random integer between 0 and 1000"

anotherRandomInt := aRandomSeries newInt: 1000 .
    "generate another random integer between 0 and 1000" 
```

**逻辑运算**

`aBoolean`将响应`and:`和`or:`。他们都接受*块论点*。

以下是它们的工作方式。

`and: alternativeBlock`
如果接收者为真，则回答alternativeBlock的值；否则在不评估替代块的情况下回答错误。

`or: alternativeBlock`
如果接收者为假，则回答alternativeBlock的值；否则在不评估替代块的情况下回答 true。

例如
`( 3 > 2 ) or: [ 3 < 4 ] ifTrue: [ ]`
`aBoolean and: [ anotherBoolean ] ifFalse: [ ]`

然而，Squeak 和 Pharo Smalltalks 都将接受括号中的参数`( )`
Dolphin Smalltalk 不会，并且严格要求块参数的标准 Smalltalk 语法。

**其他相关方法：**不需要方括号（即块）参数
`&`的*AND*不需要方括号（即块）参数并在 Amber、Cuis、Gnu、Pharo、Squeak、VisualAge 和 VisualWorks Smalltalks 中工作
`|`的*OR 。*
`&``|`

Squeak Smalltalk 还提供：
`and:and: }`
`and:and:and: }` 这些采用多个块参数
`and:and:and:and }`

`or:or: }`
`or:or:or: }` 这些采用多个块参数
`or:or:or:or: }`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-11-23T07:54:54.490

简单来说，在不懂Smalltalk方言的情况下，只能给出一个笼统的答案。您提出随机问题的方式，是的，如果您的教授需要通用答案，那是唯一的方法。

至于和/或陈述问题，

> 和/或语句。这让我大吃一惊。我尝试了几种不同的配置

```
(statement) and: (statement) ifTrue...
(statement) and (statement) ifTrue... 
```

你想尝试的是：

```
(statement) and: [statement] ifTrue: [ ... ] 
```

注意括号，and: 方法将块作为参数。

# c# - 你最喜欢的 C# 扩展方法是什么？(codeplex.com/extensionoverflow)

> ID：271398
> 
> 赞同：478
> 
> 时间：2008-11-07T06:47:21.787
> 
> 标签：c#, .net, open-source, extension-methods

让我们列出您在其中发布您出色和最喜欢的[扩展方法](http://en.wikipedia.org/wiki/Extension_method)的答案。

要求是必须发布完整的代码以及如何使用它的示例和说明。

[**基于对这个主题的高度兴趣，我在Codeplex**](http://www.codeplex.com/extensionoverflow)上设置了一个名为 extensionoverflow 的开源项目。

**请将您的答案标记为接受，以便将代码放入 Codeplex 项目中。**

**请发布完整的源代码，而不是链接。**

**Codeplex 新闻：**

24.08.2010 Codeplex 页面现在在这里： [http ://extensionoverflow.codeplex.com/](http://extensionoverflow.codeplex.com/)

11.11.2008 **XmlSerialize/XmlDeserialize**现在已[实现](http://www.codeplex.com/extensionoverflow/SourceControl/FileView.aspx?itemId=284374&changeSetId=17001)并经过[单元测试](http://www.codeplex.com/extensionoverflow/SourceControl/FileView.aspx?itemId=288847&changeSetId=17001)。

11.11.2008 仍有更多开发者的空间。;-)**现在加入！**

11.11.2008 第三个贡献者加入[ExtensionOverflow](http://www.codeplex.com/extensionoverflow)，欢迎来到[BKristensen](http://www.codeplex.com/site/users/view/BKristensen)

11.11.2008 **FormatWith**现在已[实现](http://www.codeplex.com/extensionoverflow/SourceControl/FileView.aspx?itemId=284374&changeSetId=16839)并经过[单元测试](http://www.codeplex.com/extensionoverflow/SourceControl/FileView.aspx?itemId=288847&changeSetId=16839)。

09.11.2008 第二个贡献者加入[ExtensionOverflow](http://www.codeplex.com/extensionoverflow)。欢迎来到[chakrit](https://stackoverflow.com/users/3055/chakrit)。

09.11.2008 我们需要更多的开发人员。;-)

09.11.2008 **ThrowIfArgumentIsNull**现已在 Codeplex 上[实施](http://www.codeplex.com/extensionoverflow/SourceControl/FileView.aspx?itemId=278942&changeSetId=16468)和[单元测试。](http://www.codeplex.com/extensionoverflow/SourceControl/FileView.aspx?itemId=284112&changeSetId=16468)

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2009-05-07T08:29:19.183

```
public static bool In<T>(this T source, params T[] list)
{
  if(null==source) throw new ArgumentNullException("source");
  return list.Contains(source);
} 
```

允许我替换：

```
if(reallyLongIntegerVariableName == 1 || 
    reallyLongIntegerVariableName == 6 || 
    reallyLongIntegerVariableName == 9 || 
    reallyLongIntegerVariableName == 11)
{
  // do something....
}

and

if(reallyLongStringVariableName == "string1" || 
    reallyLongStringVariableName == "string2" || 
    reallyLongStringVariableName == "string3")
{
  // do something....
}

and

if(reallyLongMethodParameterName == SomeEnum.Value1 || 
    reallyLongMethodParameterName == SomeEnum.Value2 || 
    reallyLongMethodParameterName == SomeEnum.Value3 || 
    reallyLongMethodParameterName == SomeEnum.Value4)
{
  // do something....
} 
```

和：

```
if(reallyLongIntegerVariableName.In(1,6,9,11))
{
      // do something....
}

and

if(reallyLongStringVariableName.In("string1","string2","string3"))
{
      // do something....
}

and

if(reallyLongMethodParameterName.In(SomeEnum.Value1, SomeEnum.Value2, SomeEnum.Value3, SomeEnum.Value4)
{
  // do something....
} 
```

* * *

## 回答 #2

> 赞同：160
> 
> 时间：2008-11-07T07:21:31.577

我的[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)项目中有各种扩展方法（那里有完整的源代码 - 我不会在这里重复）。我的最爱，其中一些涉及其他类（例如范围）：

日期和时间的东西——主要用于单元测试。不确定我会在生产中使用它们:)

```
var birthday = 19.June(1976);
var workingDay = 7.Hours() + 30.Minutes(); 
```

范围和步进 - 非常感谢 Marc Gravell 为他的[操作员提供的东西](http://www.pobox.com/~skeet/csharp/miscutil/usage/genericoperators.html)使这成为可能：

```
var evenNaturals = 2.To(int.MaxValue).Step(2);
var daysSinceBirth = birthday.To(DateTime.Today).Step(1.Days()); 
```

比较：

```
var myComparer = ProjectionComparer.Create(Person p => p.Name);
var next = myComparer.ThenBy(p => p.Age);
var reversed = myComparer.Reverse(); 
```

参数检查：

```
x.ThrowIfNull("x"); 
```

LINQ to XML 应用于匿名类型（或具有适当属性的其他类型）：

```
// <Name>Jon</Name><Age>32</Age>
new { Name="Jon", Age=32}.ToXElements();
// Name="Jon" Age="32" (as XAttributes, obviously)
new { Name="Jon", Age=32}.ToXAttributes() 
```

Push LINQ - 在这里解释需要很长时间，但请搜索它。

* * *

## 回答 #3

> 赞同：147
> 
> 时间：2008-11-07T07:03:41.257

string.Format 快捷方式：

```
public static class StringExtensions
{
    // Enable quick and more natural string.Format calls
    public static string F(this string s, params object[] args)
    {
        return string.Format(s, args);
    }
} 
```

例子：

```
var s = "The co-ordinate is ({0}, {1})".F(point.X, point.Y); 
```

如需快速复制和粘贴，请转到[此处](http://pastebin.com/f3e2a94d6)。

你不觉得打字更自然`"some string".F("param")`吗`string.Format("some string", "param")`？

要获得更*易读*的名称，请尝试以下建议之一：

```
s = "Hello {0} world {1}!".Fmt("Stack", "Overflow");
s = "Hello {0} world {1}!".FormatBy("Stack", "Overflow");
s = "Hello {0} world {1}!".FormatWith("Stack", "Overflow");
s = "Hello {0} world {1}!".Display("Stack", "Overflow");
s = "Hello {0} world {1}!".With("Stack", "Overflow"); 
```

..

* * *

## 回答 #4

> 赞同：89
> 
> 时间：2008-11-07T12:11:41.977

这些有用吗？

```
public static bool CoinToss(this Random rng)
{
    return rng.Next(2) == 0;
}

public static T OneOf<T>(this Random rng, params T[] things)
{
    return things[rng.Next(things.Length)];
}

Random rand;
bool luckyDay = rand.CoinToss();
string babyName = rand.OneOf("John", "George", "Radio XBR74 ROCKS!"); 
```

* * *

## 回答 #5

> 赞同：76
> 
> 时间：2008-11-07T07:30:19.923

```
public static class ComparableExtensions
{
  public static bool Between<T>(this T actual, T lower, T upper) where T : IComparable<T>
  {
    return actual.CompareTo(lower) >= 0 && actual.CompareTo(upper) < 0;
  }
} 
```

例子：

```
if (myNumber.Between(3,7))
{
  // ....
} 
```

* * *

## 回答 #6

> 赞同：58
> 
> 时间：2008-11-07T09:25:16.743

扩展方法：

```
public static void AddRange<T, S>(this ICollection<T> list, params S[] values)
    where S : T
{
    foreach (S value in values)
        list.Add(value);
} 
```

该方法适用于所有类型，并允许您将一系列项目作为参数添加到列表中。

例子：

```
var list = new List<Int32>();
list.AddRange(5, 4, 8, 4, 2); 
```

* * *

## 回答 #7

> 赞同：55
> 
> 时间：2008-11-07T07:11:59.257

一定要把它放在 codeplex 项目中。

将对象序列化/反序列化为 XML：

```
/// <summary>Serializes an object of type T in to an xml string</summary>
/// <typeparam name="T">Any class type</typeparam>
/// <param name="obj">Object to serialize</param>
/// <returns>A string that represents Xml, empty otherwise</returns>
public static string XmlSerialize<T>(this T obj) where T : class, new()
{
    if (obj == null) throw new ArgumentNullException("obj");

    var serializer = new XmlSerializer(typeof(T));
    using (var writer = new StringWriter())
    {
        serializer.Serialize(writer, obj);
        return writer.ToString();
    }
}

/// <summary>Deserializes an xml string in to an object of Type T</summary>
/// <typeparam name="T">Any class type</typeparam>
/// <param name="xml">Xml as string to deserialize from</param>
/// <returns>A new object of type T is successful, null if failed</returns>
public static T XmlDeserialize<T>(this string xml) where T : class, new()
{
    if (xml == null) throw new ArgumentNullException("xml");

    var serializer = new XmlSerializer(typeof(T));
    using (var reader = new StringReader(xml))
    {
        try { return (T)serializer.Deserialize(reader); }
        catch { return null; } // Could not be deserialized to this type.
    }
} 
```

* * *

## 回答 #8

> 赞同：46
> 
> 时间：2008-11-08T11:49:14.050

ForEach 用于 IEnumerables

```
public static class FrameworkExtensions
{
    // a map function
    public static void ForEach<T>(this IEnumerable<T> @enum, Action<T> mapFunction)
    {
        foreach (var item in @enum) mapFunction(item);
    }
} 
```

天真的例子：

```
var buttons = GetListOfButtons() as IEnumerable<Button>;

// click all buttons
buttons.ForEach(b => b.Click()); 
```

很酷的例子：

```
// no need to type the same assignment 3 times, just
// new[] up an array and use foreach + lambda
// everything is properly inferred by csc :-)
new { itemA, itemB, itemC }
    .ForEach(item => {
        item.Number = 1;
        item.Str = "Hello World!";
    }); 
```

笔记：

这不像是`Select`因为`Select` *期望*你的函数返回一些东西来转换成另一个列表。

ForEach 仅允许您为每个项目执行某些操作，而无需任何转换/数据操作。

我这样做是为了可以以更实用的风格进行编程，令我惊讶的是 List 有 ForEach 而 IEnumerable 没有。

*把它放在codeplex项目中*

* * *

## 回答 #9

> 赞同：43
> 
> 时间：2008-11-08T08:32:33.027

我的转换扩展程序允许您执行以下操作：

```
int i = myString.To<int>(); 
```

在这里，[正如 TheSoftwareJedi.com 上所发布的那样](http://thesoftwarejedi.blogspot.com/2008/05/extension-methods.html)

```
public static T To<T>(this IConvertible obj)
{
  return (T)Convert.ChangeType(obj, typeof(T));
}

public static T ToOrDefault<T>
             (this IConvertible obj)
{
    try
    {
        return To<T>(obj);
    }
    catch
    {
        return default(T);
    }
}

public static bool ToOrDefault<T>
                    (this IConvertible obj,
                     out T newObj)
{
    try
    {
        newObj = To<T>(obj); 
        return true;
    }
    catch
    {
        newObj = default(T); 
        return false;
    }
}

public static T ToOrOther<T>
                       (this IConvertible obj,
                       T other)
{
  try
  {
      return To<T>obj);
  }
  catch
  {
      return other;
  }
}

public static bool ToOrOther<T>
                         (this IConvertible obj,
                         out T newObj,
                         T other)
{
    try
    {
        newObj = To<T>(obj);
        return true;
    }
    catch
    {
        newObj = other;
        return false;
    }
}

public static T ToOrNull<T>
                      (this IConvertible obj)
                      where T : class
{
    try
    {
        return To<T>(obj);
    }
    catch
    {
        return null;
    }
}

public static bool ToOrNull<T>
                  (this IConvertible obj,
                  out T newObj)
                  where T : class
{
    try
    {
        newObj = To<T>(obj);
        return true;
    }
    catch
    {
        newObj = null;
        return false;
    }
} 
```

您可以在失败时请求默认值（调用空白构造函数或数字的“0”），指定“默认”值（我称之为“其他”），或请求 null（其中 T : 类）。我还提供了静默异常模型和典型的 TryParse 模型，该模型返回指示所采取操作的布尔值，并且输出参数保存新值。所以我们的代码可以做这样的事情

```
int i = myString.To<int>();
string a = myInt.ToOrDefault<string>();
//note type inference
DateTime d = myString.ToOrOther(DateTime.MAX_VALUE);
double d;
//note type inference
bool didItGiveDefault = myString.ToOrDefault(out d);
string s = myDateTime.ToOrNull<string>(); 
```

我无法让 Nullable 类型非常干净地融入整个事物。我试了大约 20 分钟才认输。

* * *

## 回答 #10

> 赞同：43
> 
> 时间：2008-11-09T19:17:20.650

我有一个记录异常的扩展方法：

```
public static void Log(this Exception obj)
{
  //your logging logic here
} 
```

它是这样使用的：

```
try
{
    //Your stuff here
}
catch(Exception ex)
{
    ex.Log();
} 
```

[抱歉发了两次；第二个设计得更好:-)]

* * *

## 回答 #11

> 赞同：38
> 
> 时间：2008-11-07T07:11:02.363

```
public static class StringExtensions {

    /// <summary>
    /// Parses a string into an Enum
    /// </summary>
    /// <typeparam name="T">The type of the Enum</typeparam>
    /// <param name="value">String value to parse</param>
    /// <returns>The Enum corresponding to the stringExtensions</returns>
    public static T EnumParse<T>(this string value) {
        return StringExtensions.EnumParse<T>(value, false);
    }

    public static T EnumParse<T>(this string value, bool ignorecase) {

        if (value == null) {
            throw new ArgumentNullException("value");
        }

        value = value.Trim();

        if (value.Length == 0) {
            throw new ArgumentException("Must specify valid information for parsing in the string.", "value");
        }

        Type t = typeof(T);

        if (!t.IsEnum) {
            throw new ArgumentException("Type provided must be an Enum.", "T");
        }

        return (T)Enum.Parse(t, value, ignorecase);
    }
} 
```

用于将字符串解析为枚举。

```
public enum TestEnum
{
    Bar,
    Test
}

public class Test
{
    public void Test()
    {
        TestEnum foo = "Test".EnumParse<TestEnum>();
    }
 } 
```

归功于[斯科特·多尔曼](http://geekswithblogs.net/sdorman/)

--- 编辑 Codeplex 项目 ---

我问过 Scott Dorman 是否介意我们在 Codeplex 项目中发布他的代码。这是我从他那里得到的回复：

> 感谢您对 SO 帖子和 CodePlex 项目的提醒。我赞成你对这个问题的回答。是的，该代码目前在 CodeProject 开放许可证 ( [http://www.codeproject.com/info/cpol10.aspx](http://www.codeproject.com/info/cpol10.aspx) ) 下有效地位于公共领域。
> 
> 我对将它包含在 CodePlex 项目中没有任何问题，如果您想将我添加到项目中（用户名是 sdorman），我将添加该方法以及一些额外的枚举辅助方法。

* * *

## 回答 #12

> 赞同：32
> 
> 时间：2009-11-19T21:21:22.773

我发现这个非常有用：

```
public static class PaulaBean
{
    private static String paula = "Brillant";
    public static String GetPaula<T>(this T obj) {
        return paula;
    }
} 
```

您可以在 CodePlex 上使用它。

* * *

## 回答 #13

> 赞同：31
> 
> 时间：2008-11-07T07:13:53.980

[日期时间扩展](http://www.codeplex.com/DateTimeExtensions)

例子：

```
DateTime firstDayOfMonth = DateTime.Now.First();
DateTime lastdayOfMonth = DateTime.Now.Last();
DateTime lastFridayInMonth = DateTime.Now.Last(DayOfWeek.Friday);
DateTime nextFriday = DateTime.Now.Next(DayOfWeek.Friday);
DateTime lunchTime = DateTime.Now.SetTime(11, 30);
DateTime noonOnFriday = DateTime.Now.Next(DayOfWeek.Friday).Noon();
DateTime secondMondayOfMonth = DateTime.Now.First(DayOfWeek.Monday).Next(DayOfWeek.Monday).Midnight(); 
```

* * *

## 回答 #14

> 赞同：29
> 
> 时间：2008-11-07T07:07:00.813

[gitorious.org/cadenza](http://www.gitorious.org/cadenza)是我见过的一些最有用的扩展方法的完整库。

* * *

## 回答 #15

> 赞同：28
> 
> 时间：2008-11-14T21:02:46.453

Here's a to-and-from for Roman numerals. Not often used, but could be handy. Usage:

```
if ("IV".IsValidRomanNumeral())
{
   // Do useful stuff with the number 4.
}

Console.WriteLine("MMMDCCCLXXXVIII".ParseRomanNumeral());
Console.WriteLine(3888.ToRomanNumeralString()); 
```

The source:

```
 public static class RomanNumeralExtensions
    {
        private const int NumberOfRomanNumeralMaps = 13;

        private static readonly Dictionary<string, int> romanNumerals =
            new Dictionary<string, int>(NumberOfRomanNumeralMaps)
            {
                { "M", 1000 }, 
                { "CM", 900 }, 
                { "D", 500 }, 
                { "CD", 400 }, 
                { "C", 100 }, 
                { "XC", 90 }, 
                { "L", 50 }, 
                { "XL", 40 }, 
                { "X", 10 }, 
                { "IX", 9 }, 
                { "V", 5 }, 
                { "IV", 4 }, 
                { "I", 1 }
            };

        private static readonly Regex validRomanNumeral = new Regex(
            "^(?i:(?=[MDCLXVI])((M{0,3})((C[DM])|(D?C{0,3}))"
            + "?((X[LC])|(L?XX{0,2})|L)?((I[VX])|(V?(II{0,2}))|V)?))$", 
            RegexOptions.Compiled);

        public static bool IsValidRomanNumeral(this string value)
        {
            return validRomanNumeral.IsMatch(value);
        }

        public static int ParseRomanNumeral(this string value)
        {
            if (value == null)
            {
                throw new ArgumentNullException("value");
            }

            value = value.ToUpperInvariant().Trim();

            var length = value.Length;

            if ((length == 0) || !value.IsValidRomanNumeral())
            {
                throw new ArgumentException("Empty or invalid Roman numeral string.", "value");
            }

            var total = 0;
            var i = length;

            while (i > 0)
            {
                var digit = romanNumerals[value[--i].ToString()];

                if (i > 0)
                {
                    var previousDigit = romanNumerals[value[i - 1].ToString()];

                    if (previousDigit < digit)
                    {
                        digit -= previousDigit;
                        i--;
                    }
                }

                total += digit;
            }

            return total;
        }

        public static string ToRomanNumeralString(this int value)
        {
            const int MinValue = 1;
            const int MaxValue = 3999;

            if ((value < MinValue) || (value > MaxValue))
            {
                throw new ArgumentOutOfRangeException("value", value, "Argument out of Roman numeral range.");
            }

            const int MaxRomanNumeralLength = 15;
            var sb = new StringBuilder(MaxRomanNumeralLength);

            foreach (var pair in romanNumerals)
            {
                while (value / pair.Value > 0)
                {
                    sb.Append(pair.Key);
                    value -= pair.Value;
                }
            }

            return sb.ToString();
        }
    } 
```

* * *

## 回答 #16

> 赞同：28
> 
> 时间：2008-11-07T12:41:24.260

这是我经常用于演示格式的一种。

```
public static string ToTitleCase(this string mText)
{
    if (mText == null) return mText;

    System.Globalization.CultureInfo cultureInfo = System.Threading.Thread.CurrentThread.CurrentCulture;
    System.Globalization.TextInfo textInfo = cultureInfo.TextInfo;

    // TextInfo.ToTitleCase only operates on the string if is all lower case, otherwise it returns the string unchanged.
    return textInfo.ToTitleCase(mText.ToLower());
} 
```

* * *

## 回答 #17

> 赞同：25
> 
> 时间：2009-10-09T12:51:49.460

处理尺寸的便捷方法：

```
public static class Extensions {
    public static int K(this int value) {
        return value * 1024;
    }
    public static int M(this int value) {
        return value * 1024 * 1024;
    }
}

public class Program {
    public void Main() {
        WSHttpContextBinding serviceMultipleTokenBinding = new WSHttpContextBinding() {
            MaxBufferPoolSize = 2.M(), // instead of 2097152
            MaxReceivedMessageSize = 64.K(), // instead of 65536
        };
    }
} 
```

* * *

## 回答 #18

> 赞同：24
> 
> 时间：2010-07-12T21:57:19.267

对于 Winform 控件：

```
/// <summary>
/// Returns whether the function is being executed during design time in Visual Studio.
/// </summary>
public static bool IsDesignTime(this Control control)
{
    if (LicenseManager.UsageMode == LicenseUsageMode.Designtime)
    {
        return true;
    }

    if (control.Site != null && control.Site.DesignMode)
    {
        return true;
    }

    var parent = control.Parent;
    while (parent != null)
    {
        if (parent.Site != null && parent.Site.DesignMode)
        {
            return true;
        }
        parent = parent.Parent;
    }
    return false;
}

/// <summary>
/// Sets the DropDownWidth to ensure that no item's text is cut off.
/// </summary>
public static void SetDropDownWidth(this ComboBox comboBox)
{
    var g = comboBox.CreateGraphics();
    var font = comboBox.Font;
    float maxWidth = 0;

    foreach (var item in comboBox.Items)
    {
        maxWidth = Math.Max(maxWidth, g.MeasureString(item.ToString(), font).Width);
    }

    if (comboBox.Items.Count > comboBox.MaxDropDownItems)
    {
        maxWidth += SystemInformation.VerticalScrollBarWidth;
    }

    comboBox.DropDownWidth = Math.Max(comboBox.Width, Convert.ToInt32(maxWidth));
} 
```

IsDesignTime 用法：

```
public class SomeForm : Form
{
    public SomeForm()
    {
        InitializeComponent();

        if (this.IsDesignTime())
        {
            return;
        }

        // Do something that makes the visual studio crash or hang if we're in design time,
        // but any other time executes just fine
    }
} 
```

SetDropdownWidth 用法：

```
ComboBox cbo = new ComboBox { Width = 50 };
cbo.Items.Add("Short");
cbo.Items.Add("A little longer");
cbo.Items.Add("Holy cow, this is a really, really long item. How in the world will it fit?");
cbo.SetDropDownWidth(); 
```

我忘了提，请随意在 Codeplex 上使用这些...

* * *

## 回答 #19

> 赞同：23
> 
> 时间：2008-11-07T06:59:24.370

ThrowIfArgumentIsNull 是我们都应该做的空值检查的好方法。

```
public static class Extensions
{
    public static void ThrowIfArgumentIsNull<T>(this T obj, string parameterName) where T : class
    {
        if (obj == null) throw new ArgumentNullException(parameterName + " not allowed to be null");
    }
} 
```

以下是使用它的方法，它适用于您命名空间中的所有类或您在其中使用命名空间的任何地方。

```
internal class Test
{
    public Test(string input1)
    {
        input1.ThrowIfArgumentIsNull("input1");
    }
} 
```

**可以在[CodePlex](http://www.codeplex.com/extensionmethod)项目上使用此代码。**

* * *

## 回答 #20

> 赞同：22
> 
> 时间：2009-01-16T12:00:34.260

迁移到 C# 时，我想念[Visual Basic 的 With 语句，所以这里是：](http://msdn.microsoft.com/en-us/library/wc500chb(VS.80).aspx)

```
public static void With<T>(this T obj, Action<T> act) { act(obj); } 
```

以下是如何在 C# 中使用它：

```
someVeryVeryLonggggVariableName.With(x => {
    x.Int = 123;
    x.Str = "Hello";
    x.Str2 = " World!";
}); 
```

节省大量打字！

将此与以下内容进行比较：

```
someVeryVeryLonggggVariableName.Int = 123;
someVeryVeryLonggggVariableName.Str = "Hello";
someVeryVeryLonggggVariableName.Str2 = " World!"; 
```

*放入codeplex项目*

* * *

## 回答 #21

> 赞同：18
> 
> 时间：2008-11-09T04:43:44.860

采用 camelCaseWord 或 PascalCaseWord 并将其“文字化”，即 camelCaseWord => camel Case Word

```
public static string Wordify( this string camelCaseWord )
{
    // if the word is all upper, just return it
    if( !Regex.IsMatch( camelCaseWord, "[a-z]" ) )
        return camelCaseWord;

    return string.Join( " ", Regex.Split( camelCaseWord, @"(?<!^)(?=[A-Z])" ) );
} 
```

我经常将它与 Capitalize 结合使用

```
public static string Capitalize( this string word )
{
    return word[0].ToString( ).ToUpper( ) + word.Substring( 1 );
} 
```

示例用法

```
SomeEntityObject entity = DataAccessObject.GetSomeEntityObject( id );
List<PropertyInfo> properties = entity.GetType().GetPublicNonCollectionProperties( );

// wordify the property names to act as column headers for an html table or something
List<string> columns = properties.Select( p => p.Name.Capitalize( ).Wordify( ) ).ToList( ); 
```

**在 codeplex 项目中免费使用**

* * *

## 回答 #22

> 赞同：17
> 
> 时间：2009-06-05T20:39:33.060

我发现这个很有帮助

```
public static IEnumerable<T> EmptyIfNull<T>(this IEnumerable<T> pSeq)
{
    return pSeq ?? Enumerable.Empty<T>();
} 
```

它删除了调用代码中的空检查。你现在可以做

```
MyList.EmptyIfNull().Where(....) 
```

* * *

## 回答 #23

> 赞同：16
> 
> 时间：2008-11-07T07:09:11.057

将 double 转换为使用指定区域性格式化的字符串：

```
public static class ExtensionMethods 
{
  public static string ToCurrency(this double value, string cultureName)
  {
    CultureInfo currentCulture = new CultureInfo(cultureName);
    return (string.Format(currentCulture, "{0:C}", value));
  }
} 
```

例子：

```
double test = 154.20;
string testString = test.ToCurrency("en-US"); // $154.20 
```

* * *

## 回答 #24

> 赞同：15
> 
> 时间：2010-10-01T19:48:23.057

这是我今天刚刚创建的一个。

```
// requires .NET 4

public static TReturn NullOr<TIn, TReturn>(this TIn obj, Func<TIn, TReturn> func,
        TReturn elseValue = default(TReturn)) where TIn : class
    { return obj != null ? func(obj) : elseValue; }

// versions for CLR 2, which doesn't support optional params

public static TReturn NullOr<TIn, TReturn>(this TIn obj, Func<TIn, TReturn> func,
        TReturn elseValue) where TIn : class
    { return obj != null ? func(obj) : elseValue; }
public static TReturn NullOr<TIn, TReturn>(this TIn obj, Func<TIn, TReturn> func)
        where TIn : class
    { return obj != null ? func(obj) : default(TReturn); } 
```

它可以让你这样做：

```
var lname = thingy.NullOr(t => t.Name).NullOr(n => n.ToLower()); 
```

这比这更流利且（IMO）更容易阅读：

```
var lname = (thingy != null ? thingy.Name : null) != null
    ? thingy.Name.ToLower() : null; 
```

* * *

## 回答 #25

> 赞同：15
> 
> 时间：2009-08-09T13:02:34.683

下面是一个[扩展方法](http://www.shrinkrays.net/code-snippets/csharp/an-extension-method-for-converting-a-byte-array-to-a-string.aspx)，它调整了[Rick Strahl 的代码](http://www.west-wind.com/WebLog/posts/197245.aspx)（以及注释），以防止您每次将字节数组或文本文件转换为字符串时都必须猜测或读取字节顺序标记。

该片段允许您简单地执行以下操作：

```
byte[] buffer = File.ReadAllBytes(@"C:\file.txt");
string content = buffer.GetString(); 
```

如果您发现任何错误，请添加到评论中。随意将其包含在 Codeplex 项目中。

```
public static class Extensions
{
    /// <summary>
    /// Converts a byte array to a string, using its byte order mark to convert it to the right encoding.
    /// Original article: http://www.west-wind.com/WebLog/posts/197245.aspx
    /// </summary>
    /// <param name="buffer">An array of bytes to convert</param>
    /// <returns>The byte as a string.</returns>
    public static string GetString(this byte[] buffer)
    {
        if (buffer == null || buffer.Length == 0)
            return "";

        // Ansi as default
        Encoding encoding = Encoding.Default;       

        /*
            EF BB BF    UTF-8 
            FF FE UTF-16    little endian 
            FE FF UTF-16    big endian 
            FF FE 00 00 UTF-32, little endian 
            00 00 FE FF UTF-32, big-endian 
         */

        if (buffer[0] == 0xef && buffer[1] == 0xbb && buffer[2] == 0xbf)
            encoding = Encoding.UTF8;
        else if (buffer[0] == 0xfe && buffer[1] == 0xff)
            encoding = Encoding.Unicode;
        else if (buffer[0] == 0xfe && buffer[1] == 0xff)
            encoding = Encoding.BigEndianUnicode; // utf-16be
        else if (buffer[0] == 0 && buffer[1] == 0 && buffer[2] == 0xfe && buffer[3] == 0xff)
            encoding = Encoding.UTF32;
        else if (buffer[0] == 0x2b && buffer[1] == 0x2f && buffer[2] == 0x76)
            encoding = Encoding.UTF7;

        using (MemoryStream stream = new MemoryStream())
        {
            stream.Write(buffer, 0, buffer.Length);
            stream.Seek(0, SeekOrigin.Begin);
            using (StreamReader reader = new StreamReader(stream, encoding))
            {
                return reader.ReadToEnd();
            }
        }
    }
} 
```

* * *

## 回答 #26

> 赞同：14
> 
> 时间：2008-11-07T21:10:34.793

从 MySqlDataReader 中提取值时，我厌倦了繁琐的空检查，所以：

```
public static DateTime? GetNullableDateTime(this MySqlDataReader dr, string fieldName)
{
    DateTime? nullDate = null;
    return dr.IsDBNull(dr.GetOrdinal(fieldName)) ? nullDate : dr.GetDateTime(fieldName);
}

public static string GetNullableString(this MySqlDataReader dr, string fieldName)
{
    return dr.IsDBNull(dr.GetOrdinal(fieldName)) ? String.Empty : dr.GetString(fieldName);
}

public static char? GetNullableChar(this MySqlDataReader dr, string fieldName)
{
    char? nullChar = null;
    return dr.IsDBNull(dr.GetOrdinal(fieldName)) ? nullChar : dr.GetChar(fieldName);
} 
```

当然，这可以与任何 SqlDataReader 一起使用。

* * *

hangy 和 Joe 都对如何做到这一点提出了一些很好的意见，从那以后我有机会在不同的环境中实现类似的东西，所以这里是另一个版本：

```
public static int? GetNullableInt32(this IDataRecord dr, int ordinal)
{
    int? nullInt = null;
    return dr.IsDBNull(ordinal) ? nullInt : dr.GetInt32(ordinal);
}

public static int? GetNullableInt32(this IDataRecord dr, string fieldname)
{
    int ordinal = dr.GetOrdinal(fieldname);
    return dr.GetNullableInt32(ordinal);
}

public static bool? GetNullableBoolean(this IDataRecord dr, int ordinal)
{
    bool? nullBool = null;
    return dr.IsDBNull(ordinal) ? nullBool : dr.GetBoolean(ordinal);
}

public static bool? GetNullableBoolean(this IDataRecord dr, string fieldname)
{
    int ordinal = dr.GetOrdinal(fieldname);
    return dr.GetNullableBoolean(ordinal);
} 
```

* * *

## 回答 #27

> 赞同：14
> 
> 时间：2009-05-13T15:36:29.353

令我恼火的是 LINQ 给了我一个 OrderBy，它接受一个实现 IComparer 的类作为参数，但不支持传入一个简单的匿名比较器函数。我纠正了这一点。

此类从您的比较器函数创建一个 IComparer ...

```
/// <summary>
///     Creates an <see cref="IComparer{T}"/> instance for the given
///     delegate function.
/// </summary>
internal class ComparerFactory<T> : IComparer<T>
{
    public static IComparer<T> Create(Func<T, T, int> comparison)
    {
        return new ComparerFactory<T>(comparison);
    }

    private readonly Func<T, T, int> _comparison;

    private ComparerFactory(Func<T, T, int> comparison)
    {
        _comparison = comparison;
    }

    #region IComparer<T> Members

    public int Compare(T x, T y)
    {
        return _comparison(x, y);
    }

    #endregion
} 
```

...并且这些扩展方法公开了我对枚举的新 OrderBy 重载。我怀疑这是否适用于 LINQ to SQL，但它对 LINQ to Objects 非常有用。

```
public static class EnumerableExtensions
{
    /// <summary>
    /// Sorts the elements of a sequence in ascending order by using a specified comparison delegate.
    /// </summary>
    public static IOrderedEnumerable<TSource> OrderBy<TSource, TKey>(this IEnumerable<TSource> source, Func<TSource, TKey> keySelector,
                                                                     Func<TKey, TKey, int> comparison)
    {
        var comparer = ComparerFactory<TKey>.Create(comparison);
        return source.OrderBy(keySelector, comparer);
    }

    /// <summary>
    /// Sorts the elements of a sequence in descending order by using a specified comparison delegate.
    /// </summary>
    public static IOrderedEnumerable<TSource> OrderByDescending<TSource, TKey>(this IEnumerable<TSource> source, Func<TSource, TKey> keySelector,
                                                                               Func<TKey, TKey, int> comparison)
    {
        var comparer = ComparerFactory<TKey>.Create(comparison);
        return source.OrderByDescending(keySelector, comparer);
    }
} 
```

如果你愿意，欢迎你把它放在 codeplex 上。

* * *

## 回答 #28

> 赞同：14
> 
> 时间：2008-11-09T18:51:34.650

“请将您的答案标记为接受将代码放入 Codeplex 项目。”

为什么？本站所有东西都在[CC-by-sa-2.5](http://creativecommons.org/licenses/by-sa/2.5/)下，所以只要把你的扩展溢出项目放在同一个许可证下，你就可以自由使用了。

无论如何，这是一个基于[这个问题](https://stackoverflow.com/questions/228038/best-way-to-reverse-a-string-in-c-20)的 String.Reverse 函数。

```
/// <summary>
/// Reverse a String
/// </summary>
/// <param name="input">The string to Reverse</param>
/// <returns>The reversed String</returns>
public static string Reverse(this string input)
{
    char[] array = input.ToCharArray();
    Array.Reverse(array);
    return new string(array);
} 
```

* * *

## 回答 #29

> 赞同：13
> 
> 时间：2008-11-11T08:22:26.290

`<label />`这个是针对MVC的，它增加了为`Html`每个`ViewPage`. 希望它对尝试开发类似扩展的其他人有用。

**利用：**

```
<%= Html.Label("LabelId", "ForId", "Text")%> 
```

**输出：**

```
<label id="LabelId" for="ForId">Text</label> 
```

**代码：**

```
public static class HtmlHelperExtensions
{
    public static string Label(this HtmlHelper Html, string @for, string text)
    {
        return Html.Label(null, @for, text);
    }

    public static string Label(this HtmlHelper Html, string @for, string text, object htmlAttributes)
    {
        return Html.Label(null, @for, text, htmlAttributes);
    }

    public static string Label(this HtmlHelper Html, string @for, string text, IDictionary<string, object> htmlAttributes)
    {
        return Html.Label(null, @for, text, htmlAttributes);
    }

    public static string Label(this HtmlHelper Html, string id, string @for, string text)
    {
        return Html.Label(id, @for, text, null);
    }

    public static string Label(this HtmlHelper Html, string id, string @for, string text, object htmlAttributes)
    {
        return Html.Label(id, @for, text, new RouteValueDictionary(htmlAttributes));
    }

    public static string Label(this HtmlHelper Html, string id, string @for, string text, IDictionary<string, object> htmlAttributes)
    {
        TagBuilder tag = new TagBuilder("label");

        tag.MergeAttributes(htmlAttributes);

        if (!string.IsNullOrEmpty(id))
            tag.MergeAttribute("id", Html.AttributeEncode(id));

        tag.MergeAttribute("for", Html.AttributeEncode(@for));

        tag.SetInnerText(Html.Encode(text));

        return tag.ToString(TagRenderMode.Normal);
    }
} 
```

* * *

## 回答 #30

> 赞同：12
> 
> 时间：2010-03-31T05:36:00.607

转这个：

```
DbCommand command = connection.CreateCommand();
command.CommandText = "SELECT @param";

DbParameter param = command.CreateParameter();
param.ParameterName = "@param";
param.Value = "Hello World";

command.Parameters.Add(param); 
```

...进入这个：

```
DbCommand command = connection.CreateCommand("SELECT {0}", "Hello World"); 
```

...使用此扩展方法：

```
using System;
using System.Data.Common;
using System.Globalization;
using System.Reflection;

namespace DbExtensions {

   public static class Db {

      static readonly Func<DbConnection, DbProviderFactory> getDbProviderFactory;
      static readonly Func<DbCommandBuilder, int, string> getParameterName;
      static readonly Func<DbCommandBuilder, int, string> getParameterPlaceholder;

      static Db() {

         getDbProviderFactory = (Func<DbConnection, DbProviderFactory>)Delegate.CreateDelegate(typeof(Func<DbConnection, DbProviderFactory>), typeof(DbConnection).GetProperty("DbProviderFactory", BindingFlags.Instance | BindingFlags.NonPublic).GetGetMethod(true));
         getParameterName = (Func<DbCommandBuilder, int, string>)Delegate.CreateDelegate(typeof(Func<DbCommandBuilder, int, string>), typeof(DbCommandBuilder).GetMethod("GetParameterName", BindingFlags.Instance | BindingFlags.NonPublic, Type.DefaultBinder, new Type[] { typeof(Int32) }, null));
         getParameterPlaceholder = (Func<DbCommandBuilder, int, string>)Delegate.CreateDelegate(typeof(Func<DbCommandBuilder, int, string>), typeof(DbCommandBuilder).GetMethod("GetParameterPlaceholder", BindingFlags.Instance | BindingFlags.NonPublic, Type.DefaultBinder, new Type[] { typeof(Int32) }, null));
      }

      public static DbProviderFactory GetProviderFactory(this DbConnection connection) {
         return getDbProviderFactory(connection);
      }

      public static DbCommand CreateCommand(this DbConnection connection, string commandText, params object[] parameters) {

         if (connection == null) throw new ArgumentNullException("connection");

         return CreateCommandImpl(GetProviderFactory(connection).CreateCommandBuilder(), connection.CreateCommand(), commandText, parameters);
      }

      private static DbCommand CreateCommandImpl(DbCommandBuilder commandBuilder, DbCommand command, string commandText, params object[] parameters) {

         if (commandBuilder == null) throw new ArgumentNullException("commandBuilder");
         if (command == null) throw new ArgumentNullException("command");
         if (commandText == null) throw new ArgumentNullException("commandText");

         if (parameters == null || parameters.Length == 0) {
            command.CommandText = commandText;
            return command;
         }

         object[] paramPlaceholders = new object[parameters.Length];

         for (int i = 0; i < paramPlaceholders.Length; i++) {

            DbParameter dbParam = command.CreateParameter();
            dbParam.ParameterName = getParameterName(commandBuilder, i);
            dbParam.Value = parameters[i] ?? DBNull.Value;
            command.Parameters.Add(dbParam);

            paramPlaceholders[i] = getParameterPlaceholder(commandBuilder, i);
         }

         command.CommandText = String.Format(CultureInfo.InvariantCulture, commandText, paramPlaceholders);

         return command;
      }
   }
} 
```

更多 ADO.NET 扩展方法：[**DbExtensions**](http://dbextensions.sourceforge.net/)

* * *

## 回答 #31

> 赞同：11
> 
> 时间：2010-09-30T20:52:39.903

我的最爱之一是 String 上的 IsLike() 扩展。IsLike() 匹配[VB 的 Like 运算符](http://msdn.microsoft.com/en-us/library/swf8kaxw(v=VS.100).aspx)，当您不想编写完整的正则表达式来解决您的问题时，它很方便。用法将是这样的：

```
"abc".IsLike("a*"); // true
"Abc".IsLike("[A-Z][a-z][a-z]"); // true
"abc123".IsLike("*###"); // true
"hat".IsLike("?at"); // true
"joe".IsLike("[!aeiou]*"); // true

"joe".IsLike("?at"); // false
"joe".IsLike("[A-Z][a-z][a-z]"); // false 
```

这是代码

```
public static class StringEntentions {
    /// <summary>
    /// Indicates whether the current string matches the supplied wildcard pattern.  Behaves the same
    /// as VB's "Like" Operator.
    /// </summary>
    /// <param name="s">The string instance where the extension method is called</param>
    /// <param name="wildcardPattern">The wildcard pattern to match.  Syntax matches VB's Like operator.</param>
    /// <returns>true if the string matches the supplied pattern, false otherwise.</returns>
    /// <remarks>See http://msdn.microsoft.com/en-us/library/swf8kaxw(v=VS.100).aspx</remarks>
    public static bool IsLike(this string s, string wildcardPattern) {
        if (s == null || String.IsNullOrEmpty(wildcardPattern)) return false;
        // turn into regex pattern, and match the whole string with ^$
        var regexPattern = "^" + Regex.Escape(wildcardPattern) + "$";

        // add support for ?, #, *, [], and [!]
        regexPattern = regexPattern.Replace(@"\[!", "[^")
                                   .Replace(@"\[", "[")
                                   .Replace(@"\]", "]")
                                   .Replace(@"\?", ".")
                                   .Replace(@"\*", ".*")
                                   .Replace(@"\#", @"\d");

        var result = false;
        try {
            result = Regex.IsMatch(s, regexPattern);
        }
        catch (ArgumentException ex) {
            throw new ArgumentException(String.Format("Invalid pattern: {0}", wildcardPattern), ex);
        }
        return result;
    }
} 
```

* * *

## 回答 #32

> 赞同：10
> 
> 时间：2010-06-23T03:06:18.610

类似于上面的字符串 As 和 Is，但对所有对象都是全局的。

这很简单，但我经常使用这些来缓解拳击时的parens爆炸。

```
public static class ExtensionMethods_Object
{
    [DebuggerStepThrough()]
    public static bool Is<T>(this object item) where T : class
    {
        return item is T;
    }

    [DebuggerStepThrough()]
    public static bool IsNot<T>(this object item) where T : class
    {
        return !(item.Is<T>());
    }

    [DebuggerStepThrough()]
    public static T As<T>(this object item) where T : class
    {
        return item as T;
    }
} 
```

我很高兴这段代码可以在 codeplex 中使用，事实上已经是这样了。

* * *

## 回答 #33

> 赞同：10
> 
> 时间：2008-11-07T12:42:59.217

在此处查找更多示例：[www.extensionmethod.net](http://www.extensionmethod.net/)

* * *

## 回答 #34

> 赞同：9
> 
> 时间：2010-03-13T18:45:15.043

您可以从`Random`课程中获得很多功能。

以下是我不时使用的一些扩展方法。有了这些，除了`Next`and之外`NextDouble`，这个`Random`类还给你`NextBool`, `NextChar`, `NextDateTime`, `NextTimeSpan`, `NextDouble`（接受`minValue`和`maxValue`参数），还有我*个人*最喜欢的：`NextString`. 还有更多（`NextByte`, `NextShort`, `NextLong`, 等）；但这些主要是为了完整性，并没有被太多使用。所以我没有在这里包含它们（这段代码已经足够长了！）。

```
// todo: implement additional CharType values (e.g., AsciiAny)
public enum CharType {
    AlphabeticLower,
    AlphabeticUpper,
    AlphabeticAny,
    AlphanumericLower,
    AlphanumericUpper,
    AlphanumericAny,
    Numeric
}

public static class RandomExtensions {
    // 10 digits vs. 52 alphabetic characters (upper & lower);
    // probability of being numeric: 10 / 62 = 0.1612903225806452
    private const double AlphanumericProbabilityNumericAny = 10.0 / 62.0;

    // 10 digits vs. 26 alphabetic characters (upper OR lower);
    // probability of being numeric: 10 / 36 = 0.2777777777777778
    private const double AlphanumericProbabilityNumericCased = 10.0 / 36.0;

    public static bool NextBool(this Random random, double probability) {
        return random.NextDouble() <= probability;
    }

    public static bool NextBool(this Random random) {
        return random.NextDouble() <= 0.5;
    }

    public static char NextChar(this Random random, CharType mode) {
        switch (mode) {
            case CharType.AlphabeticAny:
                return random.NextAlphabeticChar();
            case CharType.AlphabeticLower:
                return random.NextAlphabeticChar(false);
            case CharType.AlphabeticUpper:
                return random.NextAlphabeticChar(true);
            case CharType.AlphanumericAny:
                return random.NextAlphanumericChar();
            case CharType.AlphanumericLower:
                return random.NextAlphanumericChar(false);
            case CharType.AlphanumericUpper:
                return random.NextAlphanumericChar(true);
            case CharType.Numeric:
                return random.NextNumericChar();
            default:
                return random.NextAlphanumericChar();
        }
    }

    public static char NextChar(this Random random) {
        return random.NextChar(CharType.AlphanumericAny);
    }

    private static char NextAlphanumericChar(this Random random, bool uppercase) {
        bool numeric = random.NextBool(AlphanumericProbabilityNumericCased);

        if (numeric)
            return random.NextNumericChar();
        else
            return random.NextAlphabeticChar(uppercase);
    }

    private static char NextAlphanumericChar(this Random random) {
        bool numeric = random.NextBool(AlphanumericProbabilityNumericAny);

        if (numeric)
            return random.NextNumericChar();
        else
            return random.NextAlphabeticChar(random.NextBool());
    }

    private static char NextAlphabeticChar(this Random random, bool uppercase) {
        if (uppercase)
            return (char)random.Next(65, 91);
        else
            return (char)random.Next(97, 123);
    }

    private static char NextAlphabeticChar(this Random random) {
        return random.NextAlphabeticChar(random.NextBool());
    }

    private static char NextNumericChar(this Random random) {
        return (char)random.Next(48, 58);
    }

    public static DateTime NextDateTime(this Random random, DateTime minValue, DateTime maxValue) {
        return DateTime.FromOADate(
            random.NextDouble(minValue.ToOADate(), maxValue.ToOADate())
        );
    }

    public static DateTime NextDateTime(this Random random) {
        return random.NextDateTime(DateTime.MinValue, DateTime.MaxValue);
    }

    public static double NextDouble(this Random random, double minValue, double maxValue) {
        if (maxValue < minValue)
            throw new ArgumentException("Minimum value must be less than maximum value.");

        double difference = maxValue - minValue;
        if (!double.IsInfinity(difference))
            return minValue + (random.NextDouble() * difference);

        else {
            // to avoid evaluating to Double.Infinity, we split the range into two halves:
            double halfDifference = (maxValue * 0.5) - (minValue * 0.5);

            // 50/50 chance of returning a value from the first or second half of the range
            if (random.NextBool())
                return minValue + (random.NextDouble() * halfDifference);
            else
                return (minValue + halfDifference) + (random.NextDouble() * halfDifference);
        }
    }

    public static string NextString(this Random random, int numChars, CharType mode) {
        char[] chars = new char[numChars];

        for (int i = 0; i < numChars; ++i)
            chars[i] = random.NextChar(mode);

        return new string(chars);
    }

    public static string NextString(this Random random, int numChars) {
        return random.NextString(numChars, CharType.AlphanumericAny);
    }

    public static TimeSpan NextTimeSpan(this Random random, TimeSpan minValue, TimeSpan maxValue) {
        return TimeSpan.FromMilliseconds(
            random.NextDouble(minValue.TotalMilliseconds, maxValue.TotalMilliseconds)
        );
    }

    public static TimeSpan NextTimeSpan(this Random random) {
        return random.NextTimeSpan(TimeSpan.MinValue, TimeSpan.MaxValue);
    }
} 
```

* * *

## 回答 #35

> 赞同：9
> 
> 时间：2010-01-06T21:15:17.150

## `IEnumerable<>`随机播放

我使用了[Fisher-Yates](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)算法来实现洗牌功能。

通过`yield return`在两个函数中使用和分解代码，它实现了正确的*参数验证*和*延迟执行*。（感谢[Dan](https://stackoverflow.com/users/105570/dan)在我的第一个版本中指出了这个缺陷）

```
static public IEnumerable<T> Shuffle<T>(this IEnumerable<T> source)
{
    if (source == null) throw new ArgumentNullException("source");

    return ShuffleIterator(source);
}

static private IEnumerable<T> ShuffleIterator<T>(this IEnumerable<T> source)
{
    T[] array = source.ToArray();
    Random rnd = new Random();          
    for (int n = array.Length; n > 1;)
    {
        int k = rnd.Next(n--); // 0 <= k < n

        //Swap items
        if (n != k)
        {
            T tmp = array[k];
            array[k] = array[n];
            array[n] = tmp;
        }
    }

    foreach (var item in array) yield return item;
} 
```

* * *

## 回答 #36

> 赞同：9
> 
> 时间：2008-11-07T07:20:43.297

另一个对我有用的：

```
/// <summary>
/// Converts any type in to an Int32
/// </summary>
/// <typeparam name="T">Any Object</typeparam>
/// <param name="value">Value to convert</param>
/// <returns>The integer, 0 if unsuccessful</returns>
public static int ToInt32<T>(this T value)
{
  int result;
  if (int.TryParse(value.ToString(), out result))
  {
    return result;
  }
  return 0;
}

/// <summary>
/// Converts any type in to an Int32 but if null then returns the default
/// </summary>
/// <param name="value">Value to convert</param>
/// <typeparam name="T">Any Object</typeparam>
/// <param name="defaultValue">Default to use</param>
/// <returns>The defaultValue if unsuccessful</returns>
public static int ToInt32<T>(this T value, int defaultValue)
{
  int result;
  if (int.TryParse(value.ToString(), out result))
  {
    return result;
  }
  return defaultValue;
} 
```

例子：

```
int number = "123".ToInt32(); 
```

或者：

```
int badNumber = "a".ToInt32(100); // Returns 100 since a is nan 
```

* * *

## 回答 #37

> 赞同：8
> 
> 时间：2008-11-13T10:29:15.380

我的一些最好的方法扩展（我有很多！）：

```
public static T ToEnum<T>(this string str) where T : struct
{
    return (T)Enum.Parse(typeof(T), str);
}

//DayOfWeek sunday =  "Sunday".ToEnum<DayOfWeek>();

public static string ToString<T>(this IEnumerable<T> collection, string separator)
{
    return ToString(collection, t => t.ToString(), separator);
}

public static string ToString<T>(this IEnumerable<T> collection, Func<T, string> stringElement, string separator)
{
    StringBuilder sb = new StringBuilder();
    foreach (var item in collection)
    {
        sb.Append(stringElement(item));
        sb.Append(separator);
    }
    return sb.ToString(0, Math.Max(0, sb.Length - separator.Length));  // quita el ultimo separador
}

//new []{1,2,3}.ToString(i=>i*2, ", ")  --> "2, 4, 6" 
```

此外，下一个意味着能够在几乎任何情况下继续在同一行中，而不是声明新变量然后删除状态：

```
public static R Map<T, R>(this T t, Func<T, R> func)
{
    return func(t);
}

ExpensiveFindWally().Map(wally=>wally.FirstName + " " + wally.LastName)

public static R TryCC<T, R>(this T t, Func<T, R> func)
    where T : class
    where R : class
{
    if (t == null) return null;
    return func(t);
}

public static R? TryCS<T, R>(this T t, Func<T, R> func)
    where T : class
    where R : struct
{
    if (t == null) return null;
    return func(t);
}

public static R? TryCS<T, R>(this T t, Func<T, R?> func)
    where T : class
    where R : struct
{
    if (t == null) return null;
    return func(t);
}

public static R TrySC<T, R>(this T? t, Func<T, R> func)
    where T : struct
    where R : class
{
    if (t == null) return null;
    return func(t.Value);
}

public static R? TrySS<T, R>(this T? t, Func<T, R> func)
    where T : struct
    where R : struct
{
    if (t == null) return null;
    return func(t.Value);
}

public static R? TrySS<T, R>(this T? t, Func<T, R?> func)
    where T : struct
    where R : struct
{
    if (t == null) return null;
    return func(t.Value);
}

//int? bossNameLength =  Departament.Boss.TryCC(b=>b.Name).TryCS(s=>s.Length);

public static T ThrowIfNullS<T>(this T? t, string mensaje)
    where T : struct
{
    if (t == null)
        throw new NullReferenceException(mensaje);
    return t.Value;
}

public static T ThrowIfNullC<T>(this T t, string mensaje)
    where T : class
{
    if (t == null)
        throw new NullReferenceException(mensaje);
    return t;
}

public static T Do<T>(this T t, Action<T> action)
{
    action(t);
    return t;
}

//Button b = new Button{Content = "Click"}.Do(b=>Canvas.SetColumn(b,2));

public static T TryDo<T>(this T t, Action<T> action) where T : class
{
    if (t != null)
        action(t);
    return t;
}

public static T? TryDoS<T>(this T? t, Action<T> action) where T : struct
{
    if (t != null)
        action(t.Value);
    return t;
} 
```

希望它看起来不像来自火星:)

* * *

## 回答 #38

> 赞同：8
> 
> 时间：2008-12-06T10:41:00.270

与时间跨度相关的扩展，例如：

```
public static TimeSpan Seconds(this int seconds)
{
  return TimeSpan.FromSeconds(seconds);
}

public static TimeSpan Minutes(this int minutes)
{
  return TimeSpan.FromMinutes(minutes);
} 
```

允许使用：

```
1.Seconds()
20.Minutes() 
```

锁定扩展，例如：

```
public static IDisposable GetReadLock(this ReaderWriterLockSlim slimLock)
{
  slimLock.EnterReadLock();
  return new DisposableAction(slimLock.ExitReadLock);
}

public static IDisposable GetWriteLock(this ReaderWriterLockSlim slimLock)
{
  slimLock.EnterWriteLock();
  return new DisposableAction(slimLock.ExitWriteLock);
}

public static IDisposable GetUpgradeableReadLock(this ReaderWriterLockSlim slimLock)
{
  slimLock.EnterUpgradeableReadLock();
  return new DisposableAction(slimLock.ExitUpgradeableReadLock);
} 
```

允许使用锁，例如：

```
using (lock.GetUpgradeableReadLock())
{
  // try read
  using (lock.GetWriteLock())
  {
    //do write
  }
} 
```

[以及Lokad 共享库](http://rabdullin.com/shared-libraries/)中的许多其他内容

* * *

## 回答 #39

> 赞同：8
> 
> 时间：2008-11-11T07:36:56.383

令我失望的是 .NET Framework 更喜欢将文件和目录表示为字符串而不是对象，并且 FileInfo 和 DirectoryInfo 类型没有我希望的那么强大。因此，我开始根据需要编写流畅的扩展方法，例如：

```
public static FileInfo SetExtension(this FileInfo fileInfo, string extension)
{
    return new FileInfo(Path.ChangeExtension(fileInfo.FullName, extension));
}

public static FileInfo SetDirectory(this FileInfo fileInfo, string directory)
{
    return new FileInfo(Path.Combine(directory, fileInfo.Name));
} 
```

是的，你可以把它放在 codeplex

* * *

## 回答 #40

> 赞同：8
> 
> 时间：2009-09-22T15:08:31.670

我在我的 Silverlight 项目中使用这些：

```
public static void Show(this UIElement element)
{
    element.Visibility = Visibility.Visible;
}

public static void Hide(this UIElement element)
{
    element.Visibility = Visibility.Collapsed;
} 
```

* * *

## 回答 #41

> 赞同：7
> 
> 时间：2008-11-09T04:56:32.840

```
public static class EnumerableExtensions
{
    [Pure]
    public static U MapReduce<T, U>(this IEnumerable<T> enumerable, Func<T, U> map, Func<U, U, U> reduce)
    {
        CodeContract.RequiresAlways(enumerable != null);
        CodeContract.RequiresAlways(enumerable.Skip(1).Any());
        CodeContract.RequiresAlways(map != null);
        CodeContract.RequiresAlways(reduce != null);
        return enumerable.AsParallel().Select(map).Aggregate(reduce);
    }
    [Pure]
    public static U MapReduce<T, U>(this IList<T> list, Func<T, U> map, Func<U, U, U> reduce)
    {
        CodeContract.RequiresAlways(list != null);
        CodeContract.RequiresAlways(list.Count >= 2);
        CodeContract.RequiresAlways(map != null);
        CodeContract.RequiresAlways(reduce != null);
        U result = map(list[0]);
        for (int i = 1; i < list.Count; i++)
        {
            result = reduce(result,map(list[i]));
        }
        return result;
    }

    //Parallel version; creates garbage
    [Pure]
    public static U MapReduce<T, U>(this IList<T> list, Func<T, U> map, Func<U, U, U> reduce)
    {
        CodeContract.RequiresAlways(list != null);
        CodeContract.RequiresAlways(list.Skip(1).Any());
        CodeContract.RequiresAlways(map != null);
        CodeContract.RequiresAlways(reduce != null);

        U[] mapped = new U[list.Count];
        Parallel.For(0, mapped.Length, i =>
            {
                mapped[i] = map(list[i]);
            });
        U result = mapped[0];
        for (int i = 1; i < list.Count; i++)
        {
            result = reduce(result, mapped[i]);
        }
        return result;
    }

} 
```

* * *

## 回答 #42

> 赞同：7
> 
> 时间：2008-11-07T09:54:28.743

HTH。这些是我的一些主要内容。

```
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;

namespace Insert.Your.Namespace.Here.Helpers
{
    public static class Extensions
    {
        public static bool IsNullOrEmpty<T>(this IEnumerable<T> iEnumerable)
        {
            // Cheers to Joel Mueller for the bugfix. Was .Count(), now it's .Any()
            return iEnumerable == null ||
                   !iEnumerable.Any();
        }

        public static IList<T> ToListIfNotNullOrEmpty<T>(this IList<T> iList)
        {
            return iList.IsNullOrEmpty() ? null : iList;
        }

        public static PagedList<T> ToPagedListIfNotNullOrEmpty<T>(this PagedList<T> pagedList)
        {
            return pagedList.IsNullOrEmpty() ? null : pagedList;
        }

        public static string ToPluralString(this int value)
        {
            return value == 1 ? string.Empty : "s";
        }

        public static string ToReadableTime(this DateTime value)
        {
            TimeSpan span = DateTime.Now.Subtract(value);
            const string plural = "s";

            if (span.Days > 7)
            {
                return value.ToShortDateString();
            }

            switch (span.Days)
            {
                case 0:
                    switch (span.Hours)
                    {
                        case 0:
                            if (span.Minutes == 0)
                            {
                                return span.Seconds <= 0
                                           ? "now"
                                           : string.Format("{0} second{1} ago",
                                                           span.Seconds,
                                                           span.Seconds != 1 ? plural : string.Empty);
                            }
                            return string.Format("{0} minute{1} ago",
                                                 span.Minutes,
                                                 span.Minutes != 1 ? plural : string.Empty);
                        default:
                            return string.Format("{0} hour{1} ago",
                                                 span.Hours,
                                                 span.Hours != 1 ? plural : string.Empty);
                    }
                default:
                    return string.Format("{0} day{1} ago",
                                         span.Days,
                                         span.Days != 1 ? plural : string.Empty);
            }
        }

        public static string ToShortGuidString(this Guid value)
        {
            return Convert.ToBase64String(value.ToByteArray())
                .Replace("/", "_")
                .Replace("+", "-")
                .Substring(0, 22);
        }

        public static Guid FromShortGuidString(this string value)
        {
            return new Guid(Convert.FromBase64String(value.Replace("_", "/")
                                                         .Replace("-", "+") + "=="));
        }

        public static string ToStringMaximumLength(this string value, int maximumLength)
        {
            return ToStringMaximumLength(value, maximumLength, "...");
        }

        public static string ToStringMaximumLength(this string value, int maximumLength, string postFixText)
        {
            if (string.IsNullOrEmpty(postFixText))
            {
                throw new ArgumentNullException("postFixText");
            }

            return value.Length > maximumLength
                       ? string.Format(CultureInfo.InvariantCulture,
                                       "{0}{1}",
                                       value.Substring(0, maximumLength - postFixText.Length),
                                       postFixText)
                       :
                           value;
        }

        public static string SlugDecode(this string value)
        {
            return value.Replace("_", " ");
        }

        public static string SlugEncode(this string value)
        {
            return value.Replace(" ", "_");
        }
    }
} 
```

* * *

## 回答 #43

> 赞同：7
> 
> 时间：2009-07-15T08:36:59.043

有时，使用自定义分隔符在列表中的选定元素上写出字符串很方便。

例如，如果您有 a`List<Person>`并且想要循环输出用逗号分隔的姓氏，您可以这样做。

```
string result = string.Empty;
foreach (var person in personList) {
   result += person.LastName + ", ";
}
result = result.Substring(0, result.Length - 2);
return result; 
```

或者你可以使用这个方便的扩展方法

```
public static string Join<T>(this IEnumerable<T> collection, Func<T, string> func, string separator)
{
  return String.Join(separator, collection.Select(func).ToArray());
} 
```

并像这样使用它

```
personList.Join(x => x.LastName, ", "); 
```

这会产生相同的结果，在这种情况下是用逗号分隔的姓氏列表。

* * *

## 回答 #44

> 赞同：7
> 
> 时间：2009-11-19T21:47:02.853

二分查找：

```
public static T BinarySearch<T, TKey>(this IList<T> list, Func<T, TKey> keySelector, TKey key)
        where TKey : IComparable<TKey>
{
    int min = 0;
    int max = list.Count;
    int index = 0;
    while (min < max)
    {
        int mid = (max + min) / 2;
        T midItem = list[mid];
        TKey midKey = keySelector(midItem);
        int comp = midKey.CompareTo(key);
        if (comp < 0)
        {
            min = mid + 1;
        }
        else if (comp > 0)
        {
            max = mid - 1;
        }
        else
        {
            return midItem;
        }
    }
    if (min == max &&
        keySelector(list[min]).CompareTo(key) == 0)
    {
        return list[min];
    }
    throw new InvalidOperationException("Item not found");
} 
```

用法（假设列表按 Id 排序）：

```
var item = list.BinarySearch(i => i.Id, 42); 
```

它抛出 InvalidOperationException 的事实可能看起来很奇怪，但这就是 Enumerable.First 在没有匹配项时所做的事情。

* * *

## 回答 #45

> 赞同：7
> 
> 时间：2010-04-22T01:56:27.603

到目前为止，我刚刚浏览了所有 4 页，我很惊讶我没有看到这种缩短检查的方法`InvokeRequired`：

```
using System;
using System.Windows.Forms;

/// <summary>
/// Extension methods acting on Control objects.
/// </summary>
internal static class ControlExtensionMethods
{
    /// <summary>
    /// Invokes the given action on the given control's UI thread, if invocation is needed.
    /// </summary>
    /// <param name="control">Control on whose UI thread to possibly invoke.</param>
    /// <param name="action">Action to be invoked on the given control.</param>
    public static void MaybeInvoke(this Control control, Action action)
    {
        if (control != null && control.InvokeRequired)
        {
            control.Invoke(action);
        }
        else
        {
            action();
        }
    }

    /// <summary>
    /// Maybe Invoke a Func that returns a value.
    /// </summary>
    /// <typeparam name="T">Return type of func.</typeparam>
    /// <param name="control">Control on which to maybe invoke.</param>
    /// <param name="func">Function returning a value, to invoke.</param>
    /// <returns>The result of the call to func.</returns>
    public static T MaybeInvoke<T>(this Control control, Func<T> func)
    {
        if (control != null && control.InvokeRequired)
        {
            return (T)(control.Invoke(func));
        }
        else
        {
            return func();
        }
    }
} 
```

用法：

```
myForm.MaybeInvoke(() => this.Text = "Hello world");

// Sometimes the control might be null, but that's okay.
var dialogResult = this.Parent.MaybeInvoke(() => MessageBox.Show(this, "Yes or no?", "Choice", MessageBoxButtons.YesNo)); 
```

* * *

## 回答 #46

> 赞同：7
> 
> 时间：2010-09-21T03:47:04.490

一些日期功能：

```
public static bool IsFuture(this DateTime date, DateTime from)
{
    return date.Date > from.Date;
}

public static bool IsFuture(this DateTime date)
{
    return date.IsFuture(DateTime.Now);
}

public static bool IsPast(this DateTime date, DateTime from)
{
    return date.Date < from.Date;
}

public static bool IsPast(this DateTime date)
{
    return date.IsPast(DateTime.Now);
} 
```

* * *

## 回答 #47

> 赞同：6
> 
> 时间：2008-11-09T05:17:59.737

字典的 Pythonic 方法：

```
/// <summary>
/// If a key exists in a dictionary, return its value, 
/// otherwise return the default value for that type.
/// </summary>
public static U GetWithDefault<T, U>(this Dictionary<T, U> dict, T key)
{
    return dict.GetWithDefault(key, default(U));
}

/// <summary>
/// If a key exists in a dictionary, return its value,
/// otherwise return the provided default value.
/// </summary>
public static U GetWithDefault<T, U>(this Dictionary<T, U> dict, T key, U defaultValue)
{
    return dict.ContainsKey(key)
        ? dict[key]
        : defaultValue;
} 
```

当您想要将时间戳附加到文件名以确保唯一性时很有用。

```
/// <summary>
/// Format a DateTime as a string that contains no characters
//// that are banned from filenames, such as ':'.
/// </summary>
/// <returns>YYYY-MM-DD_HH.MM.SS</returns>
public static string ToFilenameString(this DateTime dt)
{
    return dt.ToString("s").Replace(":", ".").Replace('T', '_');
} 
```

* * *

## 回答 #48

> 赞同：6
> 
> 时间：2008-11-08T11:53:04.823

**通过OS File System Info**比较文件/目录的功能。这对于将共享与本地文件进行比较很有用。

**用法：**

```
DirectoryInfo dir = new DirectoryInfo(@"C:\test\myShareDir");
Console.WriteLine(dir.IsSameFileAs(@"\\myMachineName\myShareDir"));

FileInfo file = new FileInfo(@"C:\test\myShareDir\file.txt");
Console.WriteLine(file.IsSameFileAs(@"\\myMachineName\myShareDir\file.txt")); 
```

**代码：**

```
public static class FileExtensions
{
    struct BY_HANDLE_FILE_INFORMATION
    {
        public uint FileAttributes;
        public System.Runtime.InteropServices.ComTypes.FILETIME CreationTime;
        public System.Runtime.InteropServices.ComTypes.FILETIME LastAccessTime;
        public System.Runtime.InteropServices.ComTypes.FILETIME LastWriteTime;
        public uint VolumeSerialNumber;
        public uint FileSizeHigh;
        public uint FileSizeLow;
        public uint NumberOfLinks;
        public uint FileIndexHigh;
        public uint FileIndexLow;
    }

    //
    // CreateFile constants
    //
    const uint FILE_SHARE_READ = 0x00000001;
    const uint OPEN_EXISTING = 3;
    const uint GENERIC_READ = (0x80000000);
    const uint FILE_FLAG_BACKUP_SEMANTICS = 0x02000000;

    [DllImport("kernel32.dll", SetLastError = true)]
    static extern IntPtr CreateFile(
        string lpFileName,
        uint dwDesiredAccess,
        uint dwShareMode,
        IntPtr lpSecurityAttributes,
        uint dwCreationDisposition,
        uint dwFlagsAndAttributes,
        IntPtr hTemplateFile);

    [DllImport("kernel32.dll", SetLastError = true)]
    static extern bool GetFileInformationByHandle(IntPtr hFile, out BY_HANDLE_FILE_INFORMATION lpFileInformation);

    public static bool IsSameFileAs(this FileSystemInfo file, string path)
    {
        BY_HANDLE_FILE_INFORMATION fileInfo1, fileInfo2;
        IntPtr ptr1 = CreateFile(file.FullName, GENERIC_READ, FILE_SHARE_READ, IntPtr.Zero, OPEN_EXISTING, FILE_FLAG_BACKUP_SEMANTICS, IntPtr.Zero);
        if ((int)ptr1 == -1)
        {
            System.ComponentModel.Win32Exception e = new System.ComponentModel.Win32Exception(Marshal.GetLastWin32Error());
            throw e;
        }
        IntPtr ptr2 = CreateFile(path, GENERIC_READ, FILE_SHARE_READ, IntPtr.Zero, OPEN_EXISTING, FILE_FLAG_BACKUP_SEMANTICS, IntPtr.Zero);
        if ((int)ptr2 == -1)
        {
            System.ComponentModel.Win32Exception e = new System.ComponentModel.Win32Exception(Marshal.GetLastWin32Error());
            throw e;
        }
        GetFileInformationByHandle(ptr1, out fileInfo1);
        GetFileInformationByHandle(ptr2, out fileInfo2);

        return ((fileInfo1.FileIndexHigh == fileInfo2.FileIndexHigh) &&
            (fileInfo1.FileIndexLow == fileInfo2.FileIndexLow));
    }
} 
```

* * *

## 回答 #49

> 赞同：6
> 
> 时间：2009-01-05T21:15:47.807

我通常将此扩展方法与匿名类型一起使用来获取字典 ala ruby

```
public static Dictionary<string, object> ToDictionary(this object o)
{
    var dictionary = new Dictionary<string, object>();

    foreach (var propertyInfo in o.GetType().GetProperties())
    {
        if (propertyInfo.GetIndexParameters().Length == 0)
        {
            dictionary.Add(propertyInfo.Name, propertyInfo.GetValue(o, null));
        }
    }

    return dictionary;
} 
```

你可以使用它

```
var dummy = new { color = "#000000", width = "100%", id = "myid" };
Dictionary<string, object> dict = dummy.ToDictionary(); 
```

并使用扩展方法作为

```
public static void ForEach<T>(this IEnumerable<T> source, Action<T> action)
{
    foreach (T item in source)
    {
        action(item);
    }
} 
```

你能行的

```
dummy.ToDictionary().ForEach((p) => Console.Write("{0}='{1}' ", p.Key, p.Value)); 
```

输出

颜色='#000000' 宽度='100%' id='myid'

* * *

## 回答 #50

> 赞同：6
> 
> 时间：2010-03-30T22:22:40.300

我发现自己一遍又一遍地这样做……

```
public static bool EqualsIgnoreCase(this string a, string b)
{
    return string.Equals(a, b, StringComparison.OrdinalIgnoreCase);
} 
```

...后跟`StartsWithIgnoreCase`,`EndsWithIgnoreCase`和`ContainsIgnoreCase`.

* * *

## 回答 #51

> 赞同：6
> 
> 时间：2010-06-03T14:28:39.043

当使用键是字符串的字典时，使用不区分大小写的搜索返回现有键。我们的用例是文件路径。

```
/// <summary>
/// Gets the key using <paramref name="caseInsensitiveKey"/> from <paramref name="dictionary"/>.
/// </summary>
/// <typeparam name="T">The dictionary value.</typeparam>
/// <param name="dictionary">The dictionary.</param>
/// <param name="caseInsensitiveKey">The case insensitive key.</param>
/// <returns>
/// An existing key; or <see cref="string.Empty"/> if not found.
/// </returns>
public static string GetKeyIgnoringCase<T>(this IDictionary<string, T> dictionary, string caseInsensitiveKey)
{
    if (string.IsNullOrEmpty(caseInsensitiveKey)) return string.Empty;
    foreach (string key in dictionary.Keys)
    {
        if (key.Equals(caseInsensitiveKey, StringComparison.InvariantCultureIgnoreCase))
        {
            return key;
        }
    }
    return string.Empty;
} 
```

* * *

## 回答 #52

> 赞同：5
> 
> 时间：2011-01-14T08:20:29.103

这是一个位图扩展，可以将位图转换为灰度；

```
public static Bitmap GrayScale(this Bitmap bitmap)
{
    Bitmap newBitmap = new Bitmap(bitmap.Width, bitmap.Height);
    Graphics g = Graphics.FromImage(newBitmap);

    //the grayscale ColorMatrix
    ColorMatrix colorMatrix = new ColorMatrix(new float[][] {
            new float[] {.3f, .3f, .3f, 0, 0},
            new float[] {.59f, .59f, .59f, 0, 0},
            new float[] {.11f, .11f, .11f, 0, 0},
            new float[] {0, 0, 0, 1, 0},
            new float[] {0, 0, 0, 0, 1}
    });

    ImageAttributes attributes = new ImageAttributes();
    attributes.SetColorMatrix(colorMatrix);
    g.DrawImage(bitmap, new Rectangle(0, 0, bitmap.Width, bitmap.Height), 0, 0, bitmap.Width, bitmap.Height, GraphicsUnit.Pixel, attributes);
    g.Dispose();
    return newBitmap;
} 
```

示例用法：

```
Bitmap grayscaled = bitmap.GrayScale() 
```

* * *

## 回答 #53

> 赞同：5
> 
> 时间：2008-12-29T18:43:37.690

简单但比“Enumerable.Range”更好，恕我直言：

```
/// <summary>
/// Replace "Enumerable.Range(n)" with "n.Range()":
/// </summary>
/// <param name="n">iterations</param>
/// <returns>0..n-1</returns>
public static IEnumerable<int> Range(this int n)
{
    for (int i = 0; i < n; i++)
        yield return i;
} 
```

* * *

## 回答 #54

> 赞同：5
> 
> 时间：2010-10-14T16:52:10.300

这是我们工作中的代码库中的一个有趣的。在工作线程上执行一个昂贵的惰性评估枚举，并将结果推回一个可观察的对象。

```
public static IObservable<T> ToAsyncObservable<T>(this IEnumerable<T> @this)
{
    return Observable.Create<T>(observer =>
    {
        var task = new Task(() =>
        {
            try
            {
                @this.Run(observer.OnNext);
                observer.OnCompleted();
            }
            catch (Exception e)
            {
                observer.OnError(e);
            }
        });

        task.Start();

        return () => { };
    });
} 
```

愚蠢的样本：

```
new DirectoryInfo(@"c:\program files")
    .EnumerateFiles("*", SearchOption.AllDirectories)
    .ToAsyncObservable()
    .BufferWithTime(TimeSpan.FromSeconds(0.5))
    .ObserveOnDispatcher()
    .Subscribe(
        l => Console.WriteLine("{0} received", l.Count),
        () => Console.WriteLine("Done!"));

for (;;)
{
    Thread.Sleep(10);
    Dispatcher.PushFrame(new DispatcherFrame());
} 
```

显然，如果您不使用出色的反应式扩展，这个扩展对您来说毫无用处！

**更新**感谢评论中的 Richard，这种扩展方法是不必要的。RX 已经有一个扩展方法“ToObservable”，它采用 IScheduler。改用那个！

* * *

## 回答 #55

> 赞同：5
> 
> 时间：2008-12-11T02:07:57.713

```
static string Format( this string str,
                    , params Expression<Func<string,object>>[] args)
{
    var parameters = args.ToDictionary
                        ( e=>string.Format("{{{0}}}",e.Parameters[0].Name)
                        , e=>e.Compile()(e.Parameters[0].Name));

    var sb = new StringBuilder(str);
    foreach(var kv in parameters)
    {
        sb.Replace( kv.Key
                  , kv.Value != null ? kv.Value.ToString() : "");
    }

    return sb.ToString();
} 
```

使用上面的扩展，你可以这样写：

```
var str = "{foo} {bar} {baz}".Format(foo=>foo, bar=>2, baz=>new object()); 
```

你会得到`"foo 2 System.Object`“。

* * *

## 回答 #56

> 赞同：5
> 
> 时间：2010-10-22T22:11:21.033

这是另一对我发现无穷无尽的用途：

```
public static T ObjectWithMin<T, TResult>(this IEnumerable<T> sequence, Func<T, TResult> predicate)
    where T : class
    where TResult : IComparable
{
    if (!sequence.Any()) return null;

    //get the first object with its predicate value
    var seed = sequence.Select(x => new {Object = x, Value = predicate(x)}).FirstOrDefault();
    //compare against all others, replacing the accumulator with the lesser value
    //tie goes to first object found
    return
        sequence.Select(x => new {Object = x, Value = predicate(x)})
            .Aggregate(seed,(acc, x) => acc.Value.CompareTo(x.Value) <= 0 ? acc : x).Object;
}

public static T ObjectWithMax<T, TResult>(this IEnumerable<T> sequence, Func<T, TResult> predicate)
    where T : class
    where TResult : IComparable
{
    if (!sequence.Any()) return null;

    //get the first object with its predicate value
    var seed = sequence.Select(x => new {Object = x, Value = predicate(x)}).FirstOrDefault();
    //compare against all others, replacing the accumulator with the greater value
    //tie goes to last object found
    return
        sequence.Select(x => new {Object = x, Value = predicate(x)})
            .Aggregate(seed, (acc, x) => acc.Value.CompareTo(x.Value) > 0 ? acc : x).Object;
} 
```

用法：

```
var myObject = myList.ObjectWithMin(x=>x.PropA); 
```

这些方法基本上取代了像

```
var myObject = myList.OrderBy(x=>x.PropA).FirstOrDefault(); //O(nlog(n)) and unstable 
```

和

```
var myObject = myList.Where(x=>x.PropA == myList.Min(x=>x.PropA)).FirstOrDefault(); //O(N^2) but stable 
```

和

```
var minValue = myList.Min(x=>x.PropA);
var myObject = myList.Where(x=>x.PropA == minValue).FirstOrDefault(); //not a one-liner, and though linear and stable it's slower (evaluates the enumerable twice) 
```

* * *

## 回答 #57

> 赞同：5
> 
> 时间：2010-02-06T04:36:31.383

大家可能已经知道扩展方法的一个有趣用途是作为[一种 mixin](http://codecrafter.blogspot.com/2010/02/c-quasi-mixins-pattern.html)。一些扩展方法，比如`XmlSerializable`，几乎污染了每个类；并且对他们中的大多数人来说没有意义，比如`Thread`and `SqlConnection`。

一些功能应该*明确地*混合到想要拥有它的类中。我为这种类型提出了一个**新的符号**`M`，带有前缀。

`XmlSerializable`那么，是这样的：

```
public interface MXmlSerializable { }
public static class XmlSerializable {
  public static string ToXml(this MXmlSerializable self) {
    if (self == null) throw new ArgumentNullException();
    var serializer = new XmlSerializer(self.GetType());
    using (var writer = new StringWriter()) {
      serializer.Serialize(writer, self);
      return writer.GetStringBuilder().ToString();
    }
  }
  public static T FromXml<T>(string xml) where T : MXmlSerializable {
    var serializer = new XmlSerializer(typeof(T));
    return (T)serializer.Deserialize(new StringReader(xml));
  }
} 
```

然后一个类将其混合：

```
public class Customer : MXmlSerializable {
  public string Name { get; set; }
  public bool Preferred { get; set; }
} 
```

用法很简单：

```
var customer = new Customer { 
  Name = "Guybrush Threepwood", 
  Preferred = true };
var xml = customer.ToXml(); 
```

如果你喜欢这个想法，你可以为项目中有用的 mixin 创建一个新的命名空间。你怎么看？

哦，顺便说一句，我认为大多数扩展方法都应该[明确地测试 null](http://codecrafter.blogspot.com/2008/07/c-extension-methods-and-null-references.html)。

* * *

## 回答 #58

> 赞同：4
> 
> 时间：2010-05-14T08:09:12.813

我经常将它与可为空的数字一起使用。我帮助捕捉那些除以 0、NaN、Infinity...

```
public static bool IsNullOrDefault<T>(this T? o) 
    where T : struct
{
        return o == null || o.Value.Equals(default(T));
} 
```

* * *

## 回答 #59

> 赞同：4
> 
> 时间：2010-10-14T18:42:46.543

实际上，我今天刚写了这篇[博客。](http://blog.richardszalay.com/2010/10/14/201010creating-strongly-typed-reactive-html/)它是一个围绕`INotifyPropertyChanged`属性的强类型反应式包装器。

`GetPropertyValues` 在值发生变化时返回其中一个`IObservable<T>`值，从当前值开始。如果忽略当前值，您可以直接调用`Skip(1)`结果。

用法是这样的：

```
IObservable<int> values = viewModel.GetPropertyValues(x => x.IntProperty); 
```

执行：

```
public static class NotifyPropertyChangeReactiveExtensions
{
    // Returns the values of property (an Expression) as they change, 
    // starting with the current value
    public static IObservable<TValue> GetPropertyValues<TSource, TValue>(
        this TSource source, Expression<Func<TSource, TValue>> property)
        where TSource : INotifyPropertyChanged
    {
        MemberExpression memberExpression = property.Body as MemberExpression;

        if (memberExpression == null)
        {
            throw new ArgumentException(
                "property must directly access a property of the source");
        }

        string propertyName = memberExpression.Member.Name;

        Func<TSource, TValue> accessor = property.Compile();

        return source.GetPropertyChangedEvents()
            .Where(x => x.EventArgs.PropertyName == propertyName)
            .Select(x => accessor(source))
            .StartWith(accessor(source));
    }

    // This is a wrapper around FromEvent(PropertyChanged)
    public static IObservable<IEvent<PropertyChangedEventArgs>>
        GetPropertyChangedEvents(this INotifyPropertyChanged source)
    {
        return Observable.FromEvent<PropertyChangedEventHandler, 
            PropertyChangedEventArgs>(
            h => new PropertyChangedEventHandler(h),
            h => source.PropertyChanged += h,
            h => source.PropertyChanged -= h);
    }
} 
```

* * *

## 回答 #60

> 赞同：4
> 
> 时间：2010-05-16T16:41:23.480

我发现以下扩展方法非常有用：

```
public static T GetService<T>(this IServiceProvider provider)
{
    return (T)provider.GetService(typeof(T));
} 
```

它使使用`IServiceProvider`界面变得更加容易。相比：

```
IProvideValueTarget target = (IProvideValueTarget)serviceProvider(typeof(IProvideValueTarget)); 
```

和

```
var target = serviceProvider.GetService<IProvideValueTarget>(); 
```

* * *

## 回答 #61

> 赞同：4
> 
> 时间：2008-11-08T22:23:49.200

我不想添加任何已经说过的东西，所以这里有一些我没有提到的东西。（对不起，如果这太长了）：

```
public static class MyExtensions
{
    public static bool IsInteger(this string input)
    {
        int temp;

        return int.TryParse(input, out temp);
    }

    public static bool IsDecimal(this string input)
    {
        decimal temp;

        return decimal.TryParse(input, out temp);
    }

    public static int ToInteger(this string input, int defaultValue)
    {
        int temp;

        return (int.TryParse(input, out temp)) ? temp : defaultValue;
    }

    public static decimal ToDecimal(this string input, decimal defaultValue)
    {
        decimal temp;

        return (decimal.TryParse(input, out temp)) ? temp : defaultValue;
    }

    public static DateTime ToFirstOfTheMonth(this DateTime input)
    {
        return input.Date.AddDays(-1 * input.Day + 1);
    }

    // Intentionally returns 0 if the target date is before the input date.
    public static int MonthsUntil(this DateTime input, DateTime targetDate)
    {
        input = input.ToFirstOfTheMonth();

        targetDate = targetDate.ToFirstOfTheMonth();

        int result = 0;

        while (input < targetDate)
        {
        input = input.AddMonths(1);
            result++;
        }

        return result;
    }

    // Used for backwards compatibility in a system built before my time.
    public static DataTable ToDataTable(this IEnumerable input)
    {
        // too much code to show here right now...
    }
} 
```

* * *

## 回答 #62

> 赞同：4
> 
> 时间：2010-02-16T23:09:22.053

`String.As<T>`，可用于将字符串值转换*为*某种类型（主要用于支持 IConvertable 的基元和类型。适用于`Nullable`类型甚至枚举！

```
public static partial class StringExtensions
{
    /// <summary>
    /// Converts the string to the specified type, using the default value configured for the type.
    /// </summary>
    /// <typeparam name="T">Type the string will be converted to. The type must implement IConvertable.</typeparam>
    /// <param name="original">The original string.</param>
    /// <returns>The converted value.</returns>
    public static T As<T>(this String original)
    {
        return As(original, CultureInfo.CurrentCulture,
                  default(T));
    }

    /// <summary>
    /// Converts the string to the specified type, using the default value configured for the type.
    /// </summary>
    /// <typeparam name="T">Type the string will be converted to.</typeparam>
    /// <param name="original">The original string.</param>
    /// <param name="defaultValue">The default value to use in case the original string is null or empty, or can't be converted.</param>
    /// <returns>The converted value.</returns>
    public static T As<T>(this String original, T defaultValue)
    {
        return As(original, CultureInfo.CurrentCulture, defaultValue);
    }

    /// <summary>
    /// Converts the string to the specified type, using the default value configured for the type.
    /// </summary>
    /// <typeparam name="T">Type the string will be converted to.</typeparam>
    /// <param name="original">The original string.</param>
    /// <param name="provider">Format provider used during the type conversion.</param>
    /// <returns>The converted value.</returns>
    public static T As<T>(this String original, IFormatProvider provider)
    {
        return As(original, provider, default(T));
    }

    /// <summary>
    /// Converts the string to the specified type.
    /// </summary>
    /// <typeparam name="T">Type the string will be converted to.</typeparam>
    /// <param name="original">The original string.</param>
    /// <param name="provider">Format provider used during the type conversion.</param>
    /// <param name="defaultValue">The default value to use in case the original string is null or empty, or can't be converted.</param>
    /// <returns>The converted value.</returns>
    /// <remarks>
    /// If an error occurs while converting the specified value to the requested type, the exception is caught and the default is returned. It is strongly recommended you
    /// do NOT use this method if it is important that conversion failures are not swallowed up.
    ///
    /// This method is intended to be used to convert string values to primatives, not for parsing, converting, or deserializing complex types.
    /// </remarks>
    public static T As<T>(this String original, IFormatProvider provider,
                          T defaultValue)
    {
        T result;
        Type type = typeof (T);

        if (String.IsNullOrEmpty(original)) result = defaultValue;
        else
        {
            // need to get the underlying type if T is Nullable<>.

            if (type.IsNullableType())
            {
                type = Nullable.GetUnderlyingType(type);
            }

            try
            {
                // ChangeType doesn't work properly on Enums
                result = type.IsEnum
                             ? (T) Enum.Parse(type, original, true)
                             : (T) Convert.ChangeType(original, type, provider);
            }
            catch // HACK: what can we do to minimize or avoid raising exceptions as part of normal operation? custom string parsing (regex?) for well-known types? it would be best to know if you can convert to the desired type before you attempt to do so.
            {
                result = defaultValue;
            }
        }

        return result;
    }
} 
```

这依赖于另一个简单的扩展`Type`：

```
/// <summary>
/// Extension methods for <see cref="Type"/>.
/// </summary>
public static class TypeExtensions
{
    /// <summary>
    /// Returns whether or not the specified type is <see cref="Nullable{T}"/>.
    /// </summary>
    /// <param name="type">A <see cref="Type"/>.</param>
    /// <returns>True if the specified type is <see cref="Nullable{T}"/>; otherwise, false.</returns>
    /// <remarks>Use <see cref="Nullable.GetUnderlyingType"/> to access the underlying type.</remarks>
    public static bool IsNullableType(this Type type)
    {
        if (type == null) throw new ArgumentNullException("type");

        return type.IsGenericType && type.GetGenericTypeDefinition().Equals(typeof (Nullable<>));
    }
} 
```

用法：

```
var someInt = "1".As<int>();
var someIntDefault = "bad value".As(1); // "bad value" won't convert, so the default value 1 is returned.
var someEnum = "Sunday".As<DayOfWeek>();
someEnum = "0".As<DayOfWeek>(); // returns Sunday
var someNullableEnum = "".As<DayOfWeek?>(null); // returns a null value since "" can't be converted 
```

* * *

## 回答 #63

> 赞同：4
> 
> 时间：2010-07-19T16:10:39.927

我的建议：

```
public static bool IsNullOrEmpty(this ICollection obj)
{
  return (obj == null || obj.Count == 0);
} 
```

适用于集合和数组：

```
bool isNullOrEmpty = array.IsNullOrEmpty() 
```

代替

```
bool isNullOrEmpty = array == null || array.Length == 0; 
```

* * *

## 回答 #64

> 赞同：4
> 
> 时间：2010-07-23T11:05:38.660

将列表转换为数据表

```
public static class DataTableConverter
{
    /// <summary>
    /// Convert a List{T} to a DataTable.
    /// </summary>
    public static DataTable ToDataTable<T>(this IList<T> items)
    {
        var tb = new DataTable(typeof(T).Name);

        PropertyInfo[] props = typeof(T).GetProperties(BindingFlags.Public | BindingFlags.Instance);

        foreach (PropertyInfo prop in props)
        {
            Type t = GetCoreType(prop.PropertyType);
            tb.Columns.Add(prop.Name, t);
        }

        foreach (T item in items)
        {
            var values = new object[props.Length];

            for (int i = 0; i < props.Length; i++)
            {
                values[i] = props[i].GetValue(item, null);
            }

            tb.Rows.Add(values);
        }

        return tb;
    }

    /// <summary>
    /// Determine of specified type is nullable
    /// </summary>
    public static bool IsNullable(Type t)
    {
        return !t.IsValueType || (t.IsGenericType && t.GetGenericTypeDefinition() == typeof(Nullable<>));
    }

    /// <summary>
    /// Return underlying type if type is Nullable otherwise return the type
    /// </summary>
    public static Type GetCoreType(Type t)
    {
        if (t != null && IsNullable(t))
        {
            if (!t.IsValueType)
            {
                return t;
            }
            else
            {
                return Nullable.GetUnderlyingType(t);
            }
        }
        else
        {
            return t;
        }
    }
} 
```

用法：

```
 IList<MyClass> myClassList = new List<MyClass>();
    DataTable myClassDataTable = myClassList.ToDataTable(); 
```

* * *

## 回答 #65

> 赞同：4
> 
> 时间：2011-01-29T18:58:36.140

我创建了一个不错的 Each 扩展，它与 jQuery 的 each 函数具有相同的行为。

它允许类似下面的内容，您可以在其中获取当前值的索引并通过返回 false 来跳出循环：

```
new[] { "first", "second", "third" }.Each((value, index) =>
{
    if (value.Contains("d"))
        return false;
    Console.Write(value);
    return true;
}); 
```

这是代码

```
/// <summary>
/// Generic iterator function that is useful to replace a foreach loop with at your discretion.  A provided action is performed on each element.
/// </summary>
/// <typeparam name="T"></typeparam>
/// <param name="source"></param>
/// <param name="action">Function that takes in the current value in the sequence. 
/// <returns></returns>
public static IEnumerable<T> Each<T>(this IEnumerable<T> source, Action<T> action)
{
    return source.Each((value, index) =>
    {
        action(value);
        return true;
    });
}

/// <summary>
/// Generic iterator function that is useful to replace a foreach loop with at your discretion.  A provided action is performed on each element.
/// </summary>
/// <typeparam name="T"></typeparam>
/// <param name="source"></param>
/// <param name="action">Function that takes in the current value and its index in the sequence.  
/// <returns></returns>
public static IEnumerable<T> Each<T>(this IEnumerable<T> source, Action<T, int> action)
{
    return source.Each((value, index) =>
    {
        action(value, index);
        return true;
    });
}

/// <summary>
/// Generic iterator function that is useful to replace a foreach loop with at your discretion.  A provided action is performed on each element.
/// </summary>
/// <typeparam name="T"></typeparam>
/// <param name="source"></param>
/// <param name="action">Function that takes in the current value in the sequence.  Returns a value indicating whether the iteration should continue.  So return false if you don't want to iterate anymore.</param>
/// <returns></returns>
public static IEnumerable<T> Each<T>(this IEnumerable<T> source, Func<T, bool> action)
{
    return source.Each((value, index) =>
    {
        return action(value);
    });
}

/// <summary>
/// Generic iterator function that is useful to replace a foreach loop with at your discretion.  A provided action is performed on each element.
/// </summary>
/// <typeparam name="T"></typeparam>
/// <param name="source"></param>
/// <param name="action">Function that takes in the current value and its index in the sequence.  Returns a value indicating whether the iteration should continue.  So return false if you don't want to iterate anymore.</param>
/// <returns></returns>
public static IEnumerable<T> Each<T>(this IEnumerable<T> source, Func<T, int, bool> action)
{
    if (source == null)
        return source;

    int index = 0;
    foreach (var sourceItem in source)
    {
        if (!action(sourceItem, index))
            break;
        index++;
    }
    return source;
} 
```

* * *

## 回答 #66

> 赞同：4
> 
> 时间：2010-08-26T15:25:13.890

这些扩展方法异步调用事件。他们受到[这个 StackOverflow 答案](https://stackoverflow.com/questions/1916095/how-do-i-make-an-eventhandler-run-asynchronously/1916241#1916241)的启发。

```
/// <summary>
/// Invoke an event asynchronously. Each subscriber to the event will be invoked on a separate thread.
/// </summary>
/// <param name="someEvent">The event to be invoked asynchronously.</param>
/// <param name="sender">The sender of the event.</param>
/// <param name="args">The args of the event.</param>
/// <typeparam name="TEventArgs">The type of <see cref="EventArgs"/> to be used with the event.</typeparam>
public static void InvokeAsync<TEventArgs>(this EventHandler<TEventArgs> someEvent, object sender, TEventArgs args)
    where TEventArgs : EventArgs
{
    if (someEvent == null)
    {
        return;
    }

    var eventListeners = someEvent.GetInvocationList();

    AsyncCallback endAsyncCallback = delegate(IAsyncResult iar)
    {
        var ar = iar as AsyncResult;
        if (ar == null)
        {
            return;
        }

        var invokedMethod = ar.AsyncDelegate as EventHandler<TEventArgs>;
        if (invokedMethod != null)
        {
            invokedMethod.EndInvoke(iar);
        }
    };

    foreach (EventHandler<TEventArgs> methodToInvoke in eventListeners)
    {
        methodToInvoke.BeginInvoke(sender, args, endAsyncCallback, null);
    }
}

/// <summary>
/// Invoke an event asynchronously. Each subscriber to the event will be invoked on a separate thread.
/// </summary>
/// <param name="someEvent">The event to be invoked asynchronously.</param>
/// <param name="sender">The sender of the event.</param>
/// <param name="args">The args of the event.</param>
public static void InvokeAsync(this EventHandler someEvent, object sender, EventArgs args)
{
    if (someEvent == null)
    {
        return;
    }

    var eventListeners = someEvent.GetInvocationList();

    AsyncCallback endAsyncCallback = delegate(IAsyncResult iar)
    {
        var ar = iar as AsyncResult;
        if (ar == null)
        {
            return;
        }

        var invokedMethod = ar.AsyncDelegate as EventHandler;
        if (invokedMethod != null)
        {
            invokedMethod.EndInvoke(iar);
        }
    };

    foreach (EventHandler methodToInvoke in eventListeners)
    {
        methodToInvoke.BeginInvoke(sender, args, endAsyncCallback, null);
    }
} 
```

要使用：

```
public class Foo
{
    public event EventHandler<EventArgs> Bar;

    public void OnBar()
    {
        Bar.InvokeAsync(this, EventArgs.Empty);
    }
} 
```

请注意额外的好处，即您不必在调用事件之前检查事件是否为 null。例如：

```
EventHandler<EventArgs> handler = Bar;
if (handler != null)
{
    // Invoke the event
} 
```

去测试：

```
void Main()
{
    EventHandler<EventArgs> handler1 =
    delegate(object sender, EventArgs args)
    {
        // Simulate performing work in handler1
        Thread.Sleep(100);
        Console.WriteLine("Handled 1");
    };

    EventHandler<EventArgs> handler2 =
    delegate(object sender, EventArgs args)
    {
        // Simulate performing work in handler2
        Thread.Sleep(50);
        Console.WriteLine("Handled 2");
    };

    EventHandler<EventArgs> handler3 =
    delegate(object sender, EventArgs args)
    {
        // Simulate performing work in handler3
        Thread.Sleep(25);
        Console.WriteLine("Handled 3");
    };

    var foo = new Foo();
    foo.Bar += handler1;
    foo.Bar += handler2;
    foo.Bar += handler3;
    foo.OnBar();

    Console.WriteLine("Start executing important stuff");

    // Simulate performing some important stuff here, where we don't want to
    // wait around for the event handlers to finish executing
    Thread.Sleep(1000);

    Console.WriteLine("Finished executing important stuff");
} 
```

调用事件（通常）会产生以下输出：

> 开始执行重要的东西
> 处理 3
> 处理 2
> 处理 1
> 完成执行重要的东西

如果事件被同步调用，它*总是*会产生这个输出 - 并延迟执行“重要”的东西：

> 处理 1
> 处理 2
> 处理 3
> 开始执行重要的东西
> 完成执行重要的东西

* * *

## 回答 #67

> 赞同：3
> 
> 时间：2010-09-11T06:40:50.610

拥有 Unix TimeStamp 和 ISO 8601 格式的日期和时间会很棒。大量用于网站和休息服务。

我在我的 Facebook 库中使用它。您可以找到源[http://github.com/prabirshrestha/FacebookSharp/blob/master/src/FacebookSharp.Core/FacebookUtils/DateUtils.cs](http://github.com/prabirshrestha/FacebookSharp/blob/master/src/FacebookSharp.Core/FacebookUtils/DateUtils.cs)

```
private static readonly DateTime EPOCH = DateTime.SpecifyKind(new DateTime(1970, 1, 1, 0, 0, 0, 0),DateTimeKind.Utc);

public static DateTime FromUnixTimestamp(long timestamp)
{
    return EPOCH.AddSeconds(timestamp);
}

public static long ToUnixTimestamp(DateTime date)
{
    TimeSpan diff = date.ToUniversalTime() - EPOCH;
    return (long)diff.TotalSeconds;
}

public static DateTime FromIso8601FormattedDateTime(string iso8601DateTime){
    return DateTime.ParseExact(iso8601DateTime, "o", System.Globalization.CultureInfo.InvariantCulture);
}

public static string ToIso8601FormattedDateTime(DateTime dateTime)
{
    return dateTime.ToString("o");
} 
```

随意在 codeplex 项目中使用。

* * *

## 回答 #68

> 赞同：3
> 
> 时间：2008-11-07T21:18:21.750

我在我的 Web 项目中使用这些，主要用于 MVC。我有一些为**ViewData**和**TempData 编写的**

```
/// <summary>
/// Checks the Request.QueryString for the specified value and returns it, if none 
/// is found then the default value is returned instead
/// </summary>
public static T QueryValue<T>(this HtmlHelper helper, string param, T defaultValue) {
    object value = HttpContext.Current.Request.QueryString[param] as object;
    if (value == null) { return defaultValue; }
    try {
        return (T)Convert.ChangeType(value, typeof(T));
    } catch (Exception) {
        return defaultValue;
    }
} 
```

这样我就可以写出类似...

```
<% if (Html.QueryValue("login", false)) { %>
    <div>Welcome Back!</div>

<% } else { %>
    <%-- Render the control or something --%>

<% } %> 
```

* * *

## 回答 #69

> 赞同：3
> 
> 时间：2010-07-23T18:50:56.283

这是我写的唯一一个我经常使用的扩展。它使使用 System.Net.Mail 发送电子邮件更容易一些。

```
public static class MailExtension
{
    // GetEmailCreditial(out strServer) gets credentials from an XML file
    public static void Send(this MailMessage email)
    {
        string strServer = String.Empty;
        NetworkCredential credentials = GetEmailCreditial(out strServer);
        SmtpClient client = new SmtpClient(strServer) { Credentials = credentials };
        client.Send(email);
    }

    public static void Send(this IEnumerable<MailMessage> emails)
    {
        string strServer = String.Empty;
        NetworkCredential credentials = GetEmailCreditial(out strServer);
        SmtpClient client = new SmtpClient(strServer) { Credentials = credentials };
        foreach (MailMessage email in emails)
            client.Send(email);
    }
}

// Example of use: 
new MailMessage("info@myDomain.com","you@gmail.com","This is an important Subject", "Body goes here").Send();
//Assume email1,email2,email3 are MailMessage objects
new List<MailMessage>(){email1, email2, email}.Send(); 
```

* * *

## 回答 #70

> 赞同：3
> 
> 时间：2008-11-07T10:07:39.463

[http://www.codeplex.com/linqext/](http://www.codeplex.com/linqext/)

* * *

## 回答 #71

> 赞同：3
> 
> 时间：2008-11-13T05:30:04.173

字符串类的 Substring 方法对我来说一直觉得不够用。通常，当您执行子字符串时，您会知道要从哪里开始的字符，以及要在哪里结束的字符。因此，我一直觉得必须指定长度作为第二个参数是愚蠢的。因此，我编写了自己的扩展方法。一个需要一个 startIndex 和一个 endIndex。还有一个，它需要一个 startText （字符串）和 endText （字符串），所以你可以指定从哪里开始子字符串的文本，以及在哪里结束它的文本。

注意：我无法将方法 Substring 命名为 .NET 中的名称，因为我的第一个重载采用与 .NET 重载之一相同的参数类型。因此我将它们命名为 Subsetstring。随意添加到 CodePlex...

```
public static class StringExtensions
{
    /// <summary>
    /// Returns a Subset string starting at the specified start index and ending and the specified end
    /// index.
    /// </summary>
    /// <param name="s">The string to retrieve the subset from.</param>
    /// <param name="startIndex">The specified start index for the subset.</param>
    /// <param name="endIndex">The specified end index for the subset.</param>
    /// <returns>A Subset string starting at the specified start index and ending and the specified end
    /// index.</returns>
    public static string Subsetstring(this string s, int startIndex, int endIndex)
    {
        if (startIndex > endIndex)
        {
            throw new InvalidOperationException("End Index must be after Start Index.");
        }

        if (startIndex < 0)
        {
            throw new InvalidOperationException("Start Index must be a positive number.");
        }

        if(endIndex <0)
        {
            throw new InvalidOperationException("End Index must be a positive number.");
        }

        return s.Substring(startIndex, (endIndex - startIndex));
    }

    /// <summary>
    /// Finds the specified Start Text and the End Text in this string instance, and returns a string
    /// containing all the text starting from startText, to the begining of endText. (endText is not
    /// included.)
    /// </summary>
    /// <param name="s">The string to retrieve the subset from.</param>
    /// <param name="startText">The Start Text to begin the Subset from.</param>
    /// <param name="endText">The End Text to where the Subset goes to.</param>
    /// <param name="ignoreCase">Whether or not to ignore case when comparing startText/endText to the string.</param>
    /// <returns>A string containing all the text starting from startText, to the begining of endText.</returns>
    public static string Subsetstring(this string s, string startText, string endText, bool ignoreCase)
    {
        if (string.IsNullOrEmpty(startText) || string.IsNullOrEmpty(endText))
        {
            throw new ArgumentException("Start Text and End Text cannot be empty.");
        }
        string temp = s;
        if (ignoreCase)
        {
            temp = s.ToUpperInvariant();
            startText = startText.ToUpperInvariant();
            endText = endText.ToUpperInvariant();
        }
        int start = temp.IndexOf(startText);
        int end = temp.IndexOf(endText, start);
        return Subsetstring(s, start, end);
    }
} 
```

用法：

```
string s = "This is a tester for my cool extension method!!";
       s = s.Subsetstring("tester", "cool",true); 
```

输出：“我的测试员”

* * *

## 回答 #72

> 赞同：3
> 
> 时间：2010-08-20T00:42:15.210

通配符字符串比较：

```
public static bool MatchesWildcard(this string text, string pattern)
{
    int it = 0;
    while (text.CharAt(it) != 0 &&
           pattern.CharAt(it) != '*')
    {
        if (pattern.CharAt(it) != text.CharAt(it) && pattern.CharAt(it) != '?')
            return false;
        it++;
    }

    int cp = 0;
    int mp = 0;
    int ip = it;

    while (text.CharAt(it) != 0)
    {
        if (pattern.CharAt(ip) == '*')
        {
            if (pattern.CharAt(++ip) == 0)
                return true;
            mp = ip;
            cp = it + 1;
        }
        else if (pattern.CharAt(ip) == text.CharAt(it) || pattern.CharAt(ip) == '?')
        {
            ip++;
            it++;
        }
        else
        {
            ip = mp;
            it = cp++;
        }
    }

    while (pattern.CharAt(ip) == '*')
    {
        ip++;
    }
    return pattern.CharAt(ip) == 0;
}

public static char CharAt(this string s, int index)
{
    if (index < s.Length)
        return s[index];
    return '\0';
} 
```

[它是本文](http://www.codeproject.com/KB/string/wildcmp.aspx)C 代码的直接翻译，因此该`CharAt`方法返回 0 作为字符串结尾

```
if (fileName.MatchesWildcard("*.cs"))
{
    Console.WriteLine("{0} is a C# source file", fileName);
} 
```

* * *

## 回答 #73

> 赞同：3
> 
> 时间：2011-05-17T13:44:22.130

我使用的两种颜色扩展，主要用于控件开发：

```
public static class ColorExtensions
{
  // Gets a color that will be readable on top of a given background color
  public static Color GetForegroundColor(this Color input)
  {
    // Math taken from one of the replies to
    // http://stackoverflow.com/questions/2241447/make-foregroundcolor-black-or-white-depending-on-background
    if (Math.Sqrt(input.R * input.R * .241 + input.G * input.G * .691 + input.B * input.B * .068) > 128)
      return Color.Black;
    else
      return Color.White;
  }

  // Converts a given Color to gray
  public static Color ToGray(this Color input)
  {
    int g = (int)(input.R * .299) + (int)(input.G * .587) + (int)(input.B * .114);
    return Color.FromArgb(input.A, g, g, g);
  }
} 
```

用法：

```
Color foreColor = someBackColor.GetForegroundColor();
Color grayColor = someBackColor.ToGray(); 
```

* * *

## 回答 #74

> 赞同：3
> 
> 时间：2010-01-28T08:49:04.333

在使用 MVC 并有很多`if`语句时，我只关心`true`or`false`和打印`null`，或者`string.Empty`在其他情况下，我想出了：

```
public static TResult WhenTrue<TResult>(this Boolean value, Func<TResult> expression)
{
    return value ? expression() : default(TResult);
}

public static TResult WhenTrue<TResult>(this Boolean value, TResult content)
{
    return value ? content : default(TResult);
}

public static TResult WhenFalse<TResult>(this Boolean value, Func<TResult> expression)
{
    return !value ? expression() : default(TResult);
}

public static TResult WhenFalse<TResult>(this Boolean value, TResult content)
{
    return !value ? content : default(TResult);
} 
```

它允许我`<%= (someBool) ? "print y" : string.Empty %>`变成`<%= someBool.WhenTrue("print y") %>`.

我只在混合代码和 HTML 的视图中使用它，在代码文件中编写“更长”版本更清楚恕我直言。

* * *

## 回答 #75

> 赞同：3
> 
> 时间：2010-10-19T23:18:38.927

没有检查整个线程，所以它可能已经在这里，但是：

```
public static class FluentOrderingExtensions
    public class FluentOrderer<T> : IEnumerable<T>
    {
        internal List<Comparison<T>> Comparers = new List<Comparison<T>>();

        internal IEnumerable<T> Source;

        public FluentOrderer(IEnumerable<T> source)
        {
            Source = source;
        }

        #region Implementation of IEnumerable

        public IEnumerator<T> GetEnumerator()
        {
            var workingArray = Source.ToArray();
            Array.Sort(workingArray, IterativeComparison);

            foreach(var element in workingArray) yield return element;
        }

        private int IterativeComparison(T a, T b)
        {
            foreach (var comparer in Comparers)
            {
                var result = comparer(a,b);
                if(result != 0) return result;
            }
            return 0;
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }

        #endregion
    }

    public static FluentOrderer<T> OrderFluentlyBy<T,TResult>(this IEnumerable<T> source, Func<T,TResult> predicate) 
        where TResult : IComparable<TResult>
    {
        var result = new FluentOrderer<T>(source);
        result.Comparers.Add((a,b)=>predicate(a).CompareTo(predicate(b)));
        return result;
    }

    public static FluentOrderer<T> OrderFluentlyByDescending<T,TResult>(this IEnumerable<T> source, Func<T,TResult> predicate) 
        where TResult : IComparable<TResult>
    {
        var result = new FluentOrderer<T>(source);
        result.Comparers.Add((a,b)=>predicate(a).CompareTo(predicate(b)) * -1);
        return result;
    }

    public static FluentOrderer<T> ThenBy<T, TResult>(this FluentOrderer<T> source, Func<T, TResult> predicate)
        where TResult : IComparable<TResult>
    {
        source.Comparers.Add((a, b) => predicate(a).CompareTo(predicate(b)));
        return source;
    }

    public static FluentOrderer<T> ThenByDescending<T, TResult>(this FluentOrderer<T> source, Func<T, TResult> predicate)
        where TResult : IComparable<TResult>
    {
        source.Comparers.Add((a, b) => predicate(a).CompareTo(predicate(b)) * -1);
        return source;
    }
} 
```

用法：

```
var myFluentlyOrderedList = GetABunchOfComplexObjects()
    .OrderFluentlyBy(x=>x.PropertyA)
    .ThenByDescending(x=>x.PropertyB)
    .ThenBy(x=>x.SomeMethod())
    .ThenBy(x=>SomeOtherMethodAppliedTo(x))
    .ToList(); 
```

...当然假设所有谓词返回的类型都是 IComparable 到它们自己。使用 MergeSort 之类的稳定排序而不是 .NET 的内置 QuickSort 会更好，但它为您提供类似于 SQL 的可读多字段排序能力（无论如何，方法链尽可能接近）。您可以通过定义采用比较 lambda 而不是基于谓词创建它的重载来扩展它以适应不是 IComparable 的成员。

编辑：一点解释，因为评论者得到了一些提升：这组方法通过允许您按重要性降序基于多个字段进行排序，改进了基本的 OrderBy() 功能。一个真实的例子是按客户排序发票列表，然后按发票编号（或发票日期）。按此顺序获取数据的其他方法要么不起作用（OrderBy() 使用不稳定的排序，因此不能链接），要么效率低下，看起来不像你想做的那样。

* * *

## 回答 #76

> 赞同：2
> 
> 时间：2011-10-28T08:40:11.783

在 .NET 中，有一个[`IndexOf`](http://msdn.microsoft.com/en-us/library/k8b1470s.aspx)和一个[`LastIndexOf`](http://msdn.microsoft.com/en-us/library/1wdsy8fy.aspx)方法可以返回对象中第一次和最后一次匹配的索引`String`。我有一个扩展方法来获取第 n 次出现的索引：

```
public static partial class StringExtensions {

    public static int NthIndexOf(this String str, String match, int occurrence) {
        int i = 1;
        int index = 0;

        while (i <= occurrence && 
            ( index = str.IndexOf(match, index + 1) ) != -1) {

            if (i == occurrence) {
                // Occurrence match found!
                return index;
            }
            i++;
        }

        // Match not found
        return -1;
    }
} 
```

* * *

## 回答 #77

> 赞同：2
> 
> 时间：2011-01-18T12:14:53.350

这是我一直在使用的另一个控制扩展，虽然我不知道它是否以前在这里发布过。

```
public static class ControlExtensions
{
    public static void DoubleBuffer(this Control control) 
    {
        // http://stackoverflow.com/questions/76993/how-to-double-buffer-net-controls-on-a-form/77233#77233
        // Taxes: Remote Desktop Connection and painting: http://blogs.msdn.com/oldnewthing/archive/2006/01/03/508694.aspx

        if (System.Windows.Forms.SystemInformation.TerminalServerSession) return;
        System.Reflection.PropertyInfo dbProp = typeof(System.Windows.Forms.Control).GetProperty("DoubleBuffered", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance);
        dbProp.SetValue(control, true, null);
    }
} 
```

用法：

```
this.someControl.DoubleBuffer(); 
```

* * *

## 回答 #78

> 赞同：2
> 
> 时间：2010-08-06T10:57:52.280

我最常用的扩展是可以格式化字节数组的扩展：

```
/// <summary>
/// Returns a string representation of a byte array.
/// </summary>
/// <param name="bytearray">The byte array to represent.</param>
/// <param name="subdivision">The number of elements per group,
/// or 0 to not restrict it. The default is 0.</param>
/// <param name="subsubdivision">The number of elements per line,
/// or 0 to not restrict it. The default is 0.</param>
/// <param name="divider">The string dividing the individual bytes. The default is " ".</param>
/// <param name="subdivider">The string dividing the groups. The default is "  ".</param>
/// <param name="subsubdivider">The string dividing the lines. The default is "\r\n".</param>
/// <param name="uppercase">Whether the representation is in uppercase hexadecimal.
/// The default is <see langword="true"/>.</param>
/// <param name="prebyte">The string to put before each byte. The default is an empty string.</param>
/// <param name="postbyte">The string to put after each byte. The default is an empty string.</param>
/// <returns>The string representation.</returns>
/// <exception cref="ArgumentNullException">
/// <paramref name="bytearray"/> is <see langword="null"/>.
/// </exception>
public static string ToArrayString(this byte[] bytearray,
    int subdivision = 0,
    int subsubdivision = 0,
    string divider = " ",
    string subdivider = "  ",
    string subsubdivider = "\r\n",
    bool uppercase = true,
    string prebyte = "",
    string postbyte = "")
{
    #region Contract
    if (bytearray == null)
        throw new ArgumentNullException("bytearray");
    #endregion

    StringBuilder sb = new StringBuilder(
        bytearray.Length * (2 + divider.Length + prebyte.Length + postbyte.Length) +
        (subdivision > 0 ? (bytearray.Length / subdivision) * subdivider.Length : 0) +
        (subsubdivision > 0 ? (bytearray.Length / subsubdivision) * subsubdivider.Length : 0));
    int groupElements = (subdivision > 0 ? subdivision - 1 : -1);
    int lineElements = (subsubdivision > 0 ? subsubdivision - 1 : -1);
    for (long i = 0; i < bytearray.LongLength - 1; i++)
    {
        sb.Append(prebyte);
        sb.Append(String.Format(CultureInfo.InvariantCulture, (uppercase ? "{0:X2}" : "{0:x2}"), bytearray[i]));
        sb.Append(postbyte);

        if (lineElements == 0)
        {
            sb.Append(subsubdivider);
            groupElements = subdivision;
            lineElements = subsubdivision;
        }
        else if (groupElements == 0)
        {
            sb.Append(subdivider);
            groupElements = subdivision;
        }
        else
            sb.Append(divider);

        lineElements--;
        groupElements--;
    }
    sb.Append(prebyte);
    sb.Append(String.Format(CultureInfo.InvariantCulture, (uppercase ? "{0:X2}" : "{0:x2}"), bytearray[bytearray.LongLength - 1]));
    sb.Append(postbyte);

    return sb.ToString();
} 
```

默认情况下`ToArrayString()`，仅将字节数组打印为单个字节的长字符串。但是，`ToArrayString(4, 16)`将字节分组为四个一组，一行 16 个字节，就像在您最喜欢的十六进制编辑器中一样。以下很好地格式化了字节数组以在 C# 代码中使用：

```
byte[] bytearray = new byte[]{ ... };
Console.Write(bytearray.ToArrayString(4, 16, ", ", ",   ", ",\r\n", true, "0x")); 
```

它是我写的，所以你可以把它放在 Codeplex 上。

* * *

## 回答 #79

> 赞同：2
> 
> 时间：2009-05-07T07:49:28.873

GetMemberName 允许获取具有编译时安全的成员名称的字符串。

```
public static string GetMemberName<T, TResult>(
    this T anyObject, 
    Expression<Func<T, TResult>> expression)
{
    return ((MemberExpression)expression.Body).Member.Name;
} 
```

用法：

```
"blah".GetMemberName(x => x.Length); // returns "Length" 
```

* * *

如果您没有实例，它会与一个非扩展静态方法一起出现：

```
public static string GetMemberName<T, TReturn>(
    Expression<Func<T, TReturn>> expression)
    where T : class
{
    return ((MemberExpression)expression.Body).Member.Name;
} 
```

但是这个电话当然看起来不那么漂亮：

```
ReflectionUtility.GetMemberName((string) s => s.Length); // returns "Length" 
```

* * *

如果你愿意，你可以把它放在 Codeplex 上。

* * *

## 回答 #80

> 赞同：2
> 
> 时间：2010-11-11T09:07:12.410

以下是我用来减轻提取单个属性的痛苦的几种方法：

```
public static T GetAttribute<T>(this ICustomAttributeProvider provider, bool inherit = false, int index = 0) where T : Attribute
{
    return provider.GetAttribute(typeof(T), inherit, index) as T;
}

public static Attribute GetAttribute(this ICustomAttributeProvider provider, Type type, bool inherit = false, int index = 0)
{
    bool exists = provider.IsDefined(type, inherit);
    if (!exists)
    {
        return null;
    }

    object[] attributes = provider.GetCustomAttributes(type, inherit);
    if (attributes != null && attributes.Length != 0)
    {
        return attributes[index] as Attribute;
    }
    else
    {
        return null;
    }
} 
```

用法（[此](http://blog.spontaneouspublicity.com/post/2008/01/17/Associating-Strings-with-enums-in-C.aspx)枚举描述黑客的实现）：

```
public static string GetDescription(this Enum value)
{
    var fieldInfo = value.GetType().GetField(value.ToString());
    var attribute = fieldInfo.GetAttribute<DescriptionAttribute>();
    return attribute != null ? attribute.Description : null;
} 
```

随意将其包含在 CodePlex 项目中！

* * *

## 回答 #81

> 赞同：2
> 
> 时间：2009-12-28T13:01:47.190

我已经实现了一个扩展方法包（可在[http://foop.codeplex.com/](http://foop.codeplex.com/)获得），我日常使用的一些是：

```
// the most beloved extension method for me is Pipe:
<%= variable.Pipe(x => this.SomeFunction(x)).Pipe(y =>
{
    ...;
    return this.SomeOtherFunction(y);
}) %>

var d = 28.December(2009); // some extension methods for creating DateTime
DateTime justDatePart = d.JustDate();
TimeSpan justTimePart = d.JustTime();
var nextTime = d.Add(5.Hours());

using(StreamReader reader = new StreamReader("lines-of-data-file-for-example")) {
    ...
    // for reading streams line by line and usable in LINQ
    var query = from line in reader.Lines(); 
                where line.Contains(_today)
                select new { Parts = PartsOf(line), Time = _now };
}

500.Sleep();

XmlSerialize and XmlDeserialize

IsNull and IsNotNull

IfTrue, IfFalse and Iff:
true.IfTrue(() => Console.WriteLine("it is true then!");

IfNull and IfNotNull 
```

* * *

## 回答 #82

> 赞同：2
> 
> 时间：2008-11-11T07:22:07.647

我经常用这个...

原始代码：

```
if (guid != Guid.Empty) return guid;
else return Guid.NewGuid(); 
```

新代码：

```
return guid.NewGuidIfEmpty(); 
```

扩展方法：

```
public static Guid NewGuidIfEmpty(this Guid uuid)
{
    return (uuid != Guid.Empty ? uuid : Guid.NewGuid());
} 
```

* * *

## 回答 #83

> 赞同：2
> 
> 时间：2009-11-20T02:00:15.397

这个可能非常有用：

```
 public static IEnumerable<TResult> Zip<TFirst, TSecond, TResult>(this IEnumerable<TFirst> first, IEnumerable<TSecond> second, Func<TFirst, TSecond, TResult> selector)
    {
        if (first == null)
            throw new ArgumentNullException("first");
        if (second == null)
            throw new ArgumentNullException("second");
        if (selector == null)
            throw new ArgumentNullException("selector");

        using (var enum1 = first.GetEnumerator())
        using (var enum2 = second.GetEnumerator())
        {
            while (enum1.MoveNext() && enum2.MoveNext())
            {
                yield return selector(enum1.Current, enum2.Current);
            }
        }
    } 
```

它已被添加到`Enumerable`.NET 4.0 中的类中，但在 3.5 中使用它很方便。

例子 ：

```
var names = new[] { "Joe", "Jane", "Jack", "John" };
var ages = new[] { 42, 22, 18, 33 };

var persons = names.Zip(ages, (n, a) => new { Name = n, Age = a });

foreach (var p in persons)
{
    Console.WriteLine("{0} is {1} years old", p.Name, p.Age);
} 
```

* * *

## 回答 #84

> 赞同：2
> 
> 时间：2010-07-23T18:19:06.910

我确信这已经完成了，但我发现自己经常使用这种方法（和更简单的衍生物）：

```
public static bool CompareEx(this string strA, string strB, CultureInfo culture, bool ignoreCase)
{
    return string.Compare(strA, strB, ignoreCase, culture) == 0;
} 
```

你可以用多种方式编写它，但我喜欢它，因为它很快统一了我比较字符串的方法，同时节省了我的代码行数（或代码字符）。

* * *

## 回答 #85

> 赞同：2
> 
> 时间：2008-11-30T23:02:41.340

在放入数据库之前解析表单输入时，这些扩展方法对我非常有用

```
public static int? ToInt(this string input) 
{
    int val;
    if (int.TryParse(input, out val))
        return val;
    return null;
}

public static DateTime? ToDate(this string input)
{
    DateTime val;
    if (DateTime.TryParse(input, out val))
        return val;
    return null;
}

public static decimal? ToDecimal(this string input)
{
    decimal val;
    if (decimal.TryParse(input, out val))
        return val;
    return null;
} 
```

* * *

## 回答 #86

> 赞同：2
> 
> 时间：2008-11-07T07:33:37.607

一种从集合加载默认设置的更简单方法（在现实生活中，我使用它来填充任何来源的设置，包括命令行、ClickOnce URL 参数等）：

```
public static void LoadFrom(this ApplicationSettingsBase settings, NameValueCollection configuration)
{
    if (configuration != null)
        foreach (string key in configuration.AllKeys)
            if (!String.IsNullOrEmpty(key))
                try
                {
                    settings[key] = configuration.Get(key);
                }
                catch (SettingsPropertyNotFoundException)
                {
                  // handle bad arguments as you wish
                }
} 
```

例子：

```
Settings.Default.LoadFrom(new NameValueCollection() { { "Setting1", "Value1" }, { "Setting2", "Value2" } }); 
```

* * *

## 回答 #87

> 赞同：2
> 
> 时间：2008-11-07T07:55:46.937

对单元测试很有用：

```
public static IList<T> Clone<T>(this IList<T> list) where T : ICloneable
{
    var ret = new List<T>(list.Count);
    foreach (var item in list)
        ret.Add((T)item.Clone());

    // done
    return ret;
} 
```

一系列类似 TWith2Sugars 的替代缩短语法：

```
public static long? ToNullableInt64(this string val)
{
    long ret;
    return Int64.TryParse(val, out ret) ? ret : new long?();
} 
```

最后是 - BCL 中是否已经存在执行以下操作的内容？

```
public static void Split<T>(this T[] array, 
    Func<T,bool> determinator, 
    IList<T> onTrue, 
    IList<T> onFalse)
{
    if (onTrue == null)
        onTrue = new List<T>();
    else
        onTrue.Clear();

    if (onFalse == null)
        onFalse = new List<T>();
    else
        onFalse.Clear();

    if (determinator == null)
        return;

    foreach (var item in array)
    {
        if (determinator(item))
            onTrue.Add(item);
        else
            onFalse.Add(item);
    }
} 
```

* * *

## 回答 #88

> 赞同：2
> 
> 时间：2008-12-01T04:24:27.257

我喜欢这些处理设置了 Flags 属性的枚举的方法：

```
public static bool AnyOf(this object mask, object flags)
{
    return ((int)mask & (int)flags) != 0;
}
public static bool AllOf(this object mask, object flags)
{
    return ((int)mask & (int)flags) == (int)flags;
}
public static object SetOn(this object mask, object flags)
{
    return (int)mask | (int)flags;
}
etc. 
```

示例用法：

```
var options = SomeOptions.OptionA;
options = options.SetOn(OptionB);
options = options.SetOn(OptionC);

if (options.AnyOf(SomeOptions.OptionA | SomeOptions.OptionB))
{
etc. 
```

原始方法来自这篇文章：[http](http://www.codeproject.com/KB/cs/masksandflags.aspx?display=Print) ://www.codeproject.com/KB/cs/masksandflags.aspx?display=Print 我只是将它们转换为扩展方法。

但是它们的一个问题是对象类型的参数，这意味着*所有*对象最终都使用这些方法进行扩展，而理想情况下它们应该只适用于枚举。

**更新** 根据评论，您可以以牺牲性能为代价绕过“签名污染”，如下所示：

```
public static bool AnyOf(this Enum mask, object flags)
{
    return (Convert.ToInt642(mask) & (int)flags) != 0;
} 
```

* * *

## 回答 #89

> 赞同：2
> 
> 时间：2009-11-02T18:20:57.010

FindControl 内置转换：

```
public static T FindControl<T>(this Control control, string id) where T : Control
{
    return (T)control.FindControl(id);
} 
```

这没什么了不起的，但我觉得它使代码更简洁。

```
// With extension method
container.FindControl<TextBox>("myTextBox").SelectedValue = "Hello world!";

// Without extension method
((TextBox)container.FindControl("myTextBox")).SelectedValue = "Hello world!"; 
```

*如果需要，可以将其放在 codeplex 项目中*

* * *

## 回答 #90

> 赞同：2
> 
> 时间：2010-06-02T15:18:27.767

用于 ASP MVC 的 NullPartial HTML 帮助程序。

当传递一个空模型时，HTML.Partial 和 HTML.RenderPartial 将提供视图的模型，如果这个部分是强类型的并且视图具有不同的类型，它将抛出一个异常而不是传递一个空引用。这些帮助程序允许您指定两个不同的部分，以便您可以将空测试排除在视图之外。

**您有权在 Codeplex 页面上包含此内容**

```
public static class nullpartials
    {
        public static MvcHtmlString NullPartial(this HtmlHelper helper, string Partial, string NullPartial, object Model)
        {
            if (Model == null)
                return helper.Partial(NullPartial);
            else
                return helper.Partial(Partial, Model);
        }

        public static MvcHtmlString NullPartial(this HtmlHelper helper, string Partial, string NullPartial, object Model, ViewDataDictionary viewdata)
        {
            if (Model == null)
                return helper.Partial(NullPartial, viewdata);
            else
                return helper.Partial(Partial, Model, viewdata);
        }

        public static void RenderNullPartial(this HtmlHelper helper, string Partial, string NullPartial, object Model)
        {
            if (Model == null)
            {
                helper.RenderPartial(NullPartial);
                return;
            }
            else
            {
                helper.RenderPartial(Partial, Model);
                return;
            }
        }

        public static void RenderNullPartial(this HtmlHelper helper, string Partial, string NullPartial, object Model, ViewDataDictionary viewdata)
        {
            if (Model == null)
            {
                helper.RenderPartial(NullPartial, viewdata);
                return;
            }
            else
            {
                helper.RenderPartial(Partial, Model, viewdata);
                return;
            }
        }
    } 
```

* * *

## 回答 #91

> 赞同：2
> 
> 时间：2010-10-15T17:13:07.743

我已经写了无数种扩展方法，所以这里有一些我觉得特别有用的方法。随意实施。

```
public static class ControlExtenders
{
    /// <summary>
    /// Advanced version of find control.
    /// </summary>
    /// <typeparam name="T">Type of control to find.</typeparam>
    /// <param name="id">Control id to find.</param>
    /// <returns>Control of given type.</returns>
    /// <remarks>
    /// If the control with the given id is not found
    /// a new control instance of the given type is returned.
    /// </remarks>
    public static T FindControl<T>(this Control control, string id) where T : Control
    {
        // User normal FindControl method to get the control
        Control _control = control.FindControl(id);

        // If control was found and is of the correct type we return it
        if (_control != null && _control is T)
        {
            // Return new control
            return (T)_control;
        }

        // Create new control instance
        _control = (T)Activator.CreateInstance(typeof(T));

        // Add control to source control so the
        // next it is found and the value can be
        // passed on itd, remember to hide it and
        // set an ID so it can be found next time
        if (!(_control is ExtenderControlBase))
        {
            _control.Visible = false;
        }
        _control.ID = id;
        control.Controls.Add(_control);

        // Use reflection to create a new instance of the control
        return (T)_control;
    }
}

public static class GenericListExtenders
{
    /// <summary>
    /// Sorts a generic list by items properties.
    /// </summary>
    /// <typeparam name="T">Type of collection.</typeparam>
    /// <param name="list">Generic list.</param>
    /// <param name="fieldName">Field to sort data on.</param>
    /// <param name="sortDirection">Sort direction.</param>
    /// <remarks>
    /// Use this method when a dinamyc sort field is requiered. If the 
    /// sorting field is known manual sorting might improve performance.
    /// </remarks>
    public static void SortObjects<T>(this List<T> list, string fieldName, SortDirection sortDirection)
    {
        PropertyInfo propInfo = typeof(T).GetProperty(fieldName);
        if (propInfo != null)
        {
            Comparison<T> compare = delegate(T a, T b)
            {
                bool asc = sortDirection == SortDirection.Ascending;
                object valueA = asc ? propInfo.GetValue(a, null) : propInfo.GetValue(b, null);
                object valueB = asc ? propInfo.GetValue(b, null) : propInfo.GetValue(a, null);
                return valueA is IComparable ? ((IComparable)valueA).CompareTo(valueB) : 0;
            };
            list.Sort(compare);
        }
    }

    /// <summary>
    /// Creates a pagged collection from generic list.
    /// </summary>
    /// <typeparam name="T">Type of collection.</typeparam>
    /// <param name="list">Generic list.</param>
    /// <param name="sortField">Field to sort data on.</param>
    /// <param name="sortDirection">Sort direction.</param>
    /// <param name="from">Page from item index.</param>
    /// <param name="to">Page to item index.</param>
    /// <param name="copy">Creates a copy and returns a new list instead of changing the current one.</param>
    /// <returns>Pagged list collection.</returns>
    public static List<T> Page<T>(this List<T> list, string sortField, bool sortDirection, int from, int to, bool copy)
    {
        List<T> _pageList = new List<T>();

        // Copy list
        if (copy)
        {
            T[] _arrList = new T[list.Count];
            list.CopyTo(_arrList);
            _pageList = new List<T>(_arrList);
        }
        else
        {
            _pageList = list;
        }

        // Make sure there are enough items in the list
        if (from > _pageList.Count)
        {
            int diff = Math.Abs(from - to);
            from = _pageList.Count - diff;
        }
        if (to > _pageList.Count)
        {
            to = _pageList.Count;
        }

        // Sort items
        if (!string.IsNullOrEmpty(sortField))
        {
            SortDirection sortDir = SortDirection.Descending;
            if (!sortDirection) sortDir = SortDirection.Ascending;
            _pageList.SortObjects(sortField, sortDir);
        }

        // Calculate max number of items per page
        int count = to - from;
        if (from + count > _pageList.Count) count -= (from + count) - _pageList.Count;

        // Get max number of items per page
        T[] pagged = new T[count];
        _pageList.CopyTo(from, pagged, 0, count);

        // Return pagged items
        return new List<T>(pagged);
    }

    /// <summary>
    /// Shuffle's list items.
    /// </summary>
    /// <typeparam name="T">List type.</typeparam>
    /// <param name="list">Generic list.</param>
    public static void Shuffle<T>(this List<T> list)
    {
        Random rng = new Random();
        for (int i = list.Count - 1; i > 0; i--)
        {
            int swapIndex = rng.Next(i + 1);
            if (swapIndex != i)
            {
                T tmp = list[swapIndex];
                list[swapIndex] = list[i];
                list[i] = tmp;
            }
        }
    }

    /// <summary>
    /// Converts generic List to DataTable.
    /// </summary>
    /// <typeparam name="T">Type.</typeparam>
    /// <param name="list">Generic list.</param>
    /// <param name="columns">Name of the columns to copy to the DataTable.</param>
    /// <returns>DataTable.</returns>
    public static DataTable ToDataTable<T>(this List<T> list, string[] columns)
    {
        List<string> _columns = new List<string>(columns);
        DataTable dt = new DataTable();

        foreach (PropertyInfo info in typeof(T).GetProperties())
        {
            if (_columns.Contains(info.Name) || columns == null)
            {
                dt.Columns.Add(new DataColumn(info.Name, info.PropertyType));
            }
        }
        foreach (T t in list)
        {
            DataRow row = dt.NewRow();
            foreach (PropertyInfo info in typeof(T).GetProperties())
            {
                if (_columns.Contains(info.Name) || columns == null)
                {
                    row[info.Name] = info.GetValue(t, null);
                }
            }
            dt.Rows.Add(row);
        }
        return dt;
    }
}

public static class DateTimeExtenders
{
    /// <summary>
    /// Returns number of month from a string representation.
    /// </summary>
    /// <returns>Number of month.</returns>
    public static int MonthToNumber(this DateTime datetime, string month)
    {
        month = month.ToLower();
        for (int i = 1; i <= 12; i++)
        {
            DateTime _dt = DateTime.Parse("1." + i + ".2000");
            string _month = CultureInfo.InvariantCulture.DateTimeFormat.GetMonthName(i).ToLower();
            if (_month == month)
            {
                return i;
            }
        }
        return 0;
    }

    /// <summary>
    /// Returns month name from month number.
    /// </summary>
    /// <returns>Name of month.</returns>
    public static string MonthToName(this DateTime datetime, int month)
    {
        for (int i = 1; i <= 12; i++)
        {
            if (i == month)
            {
                return CultureInfo.InvariantCulture.DateTimeFormat.GetMonthName(i);
            }
        }
        return "";
    }
}

public static class ObjectExtender
{
    public static object CloneBinary<T>(this T originalObject)
    {
        using (var stream = new System.IO.MemoryStream())
        {
            BinaryFormatter binaryFormatter = new BinaryFormatter();
            binaryFormatter.Serialize(stream, originalObject);
            stream.Position = 0;
            return (T)binaryFormatter.Deserialize(stream);
        }
    }

    public static object CloneObject(this object obj)
    {
        using (MemoryStream memStream = new MemoryStream())
        {
            BinaryFormatter binaryFormatter = new BinaryFormatter(null, new StreamingContext(StreamingContextStates.Clone));
            binaryFormatter.Serialize(memStream, obj);
            memStream.Position = 0;
            return binaryFormatter.Deserialize(memStream);
        }
    }
}

public static class StringExtenders
{
    /// <summary>
    /// Returns string as unit.
    /// </summary>
    /// <param name="value">Value.</param>
    /// <returns>Unit</returns>
    public static Unit ToUnit(this string value)
    {
        // Return empty unit
        if (string.IsNullOrEmpty(value))
            return Unit.Empty;

        // Trim value
        value = value.Trim();

        // Return pixel unit
        if (value.EndsWith("px"))
        {
            // Set unit type
            string _int = value.Replace("px", "");

            // Try parsing to int
            double _val = 0;
            if (!double.TryParse(_int, out _val))
            {
                // Invalid value
                return Unit.Empty;
            }

            // Return unit
            return new Unit(_val, UnitType.Pixel);
        }

        // Return percent unit
        if (value.EndsWith("%"))
        {
            // Set unit type
            string _int = value.Replace("%", "");

            // Try parsing to int
            double _val = 0;
            if (!double.TryParse(_int, out _val))
            {
                // Invalid value
                return Unit.Empty;
            }

            // Return unit
            return new Unit(_val, UnitType.Percentage);
        }

        // No match found
        return new Unit();
    }

    /// <summary>
    /// Returns alternative string if current string is null or empty.
    /// </summary>
    /// <param name="str"></param>
    /// <param name="alternative"></param>
    /// <returns></returns>
    public static string Alternative(this string str, string alternative)
    {
        if (string.IsNullOrEmpty(str)) return alternative;
        return str;
    }

    /// <summary>
    /// Removes all HTML tags from string.
    /// </summary>
    /// <param name="html">String containing HTML tags.</param>
    /// <returns>String with no HTML tags.</returns>
    public static string StripHTML(this string html)
    {
        string nohtml = Regex.Replace(html, "<(.|\n)*?>", "");
        nohtml = nohtml.Replace("\r\n", "").Replace("\n", "").Replace("&nbsp;", "").Trim();
        return nohtml;
    }
} 
```

第一个是我最喜欢的，因为它使我能够替换：

```
Control c = this.FindControl("tbName");
if (c != null)
{
    // Do something with c
    customer.Name = ((TextBox)c).Text;
} 
```

有了这个：

```
TextBox c = this.FindControl<TextBox>("tbName");
customer.Name = c.Text; 
```

设置默认字符串值：

```
string str = "";
if (string.IsNullOrEmpty(str))
{
    str = "I'm empty!";
} 
```

变成：

```
str = str.Alternative("I'm empty!"); 
```

* * *

## 回答 #92

> 赞同：2
> 
> 时间：2009-11-26T17:24:25.630

每 n 个字符包装一个字符串。

```
public static string WrapAt(this string str, int WrapPos)
{
    if (string.IsNullOrEmpty(str))
        throw new ArgumentNullException("str", "Cannot wrap a null string");
    str = str.Replace("\r", "").Replace("\n", "");

    if (str.Length <= WrapPos)
        return str;

    for (int i = str.Length; i >= 0; i--)
        if (i % WrapPos == 0 && i > 0 && i != str.Length)
            str = str.Insert(i, "\r\n");
    return str;
} 
```

* * *

## 回答 #93

> 赞同：2
> 
> 时间：2010-10-14T10:46:41.730

灵感来自 String.IsNullOrEmpty

验证给定的 List 是否为空或为空

```
public static bool IsNullOrEmpty<TSource>(this List<TSource> src)
{            
    return (src == null || src.Count == 0);
} 
```

这个是为了验证给定的 2 个文件和属性

```
public static bool Compare(this FileInfo f1, FileInfo f2, string propertyName)
{
    try
    {
        PropertyInfo p1 = f1.GetType().GetProperty(propertyName);
        PropertyInfo p2 = f2.GetType().GetProperty(propertyName);

        if (p1.GetValue(f1, null) == p2.GetValue(f1, null))
            return true;
    }
    catch (Exception ex)
    {
        return false;
    }
    return false;
} 
```

并像这样使用它

```
FileInfo fo = new FileInfo("c:\\netlog.txt");
FileInfo f1 = new FileInfo("c:\\regkey.txt");

fo.compare(f1, "CreationTime"); 
```

* * *

## 回答 #94

> 赞同：2
> 
> 时间：2009-09-16T16:56:26.277

我在所有项目中投入的两个小孩（有些人觉得他们很傻）是：

```
public static bool IsNull(this object o){
  return o == null;
} 
```

和

```
public static bool IsNullOrEmpty(this string s){
  return string.IsNullOrEmpty(s);
} 
```

它使我的代码更加流畅..

```
if (myClassInstance.IsNull()) //... do something

if (myString.IsNullOrEmpty()) //... do something 
```

我认为这些会产生非常好的扩展属性；如果我们得到这些。

* * *

## 回答 #95

> 赞同：2
> 
> 时间：2009-10-03T00:54:28.997

减少字符串的长度`toLength`并在缩短的字符串的末尾添加一个附加字符串，以表示字符串已缩短（默认`...`）

```
public static string Shorten(this string str, int toLength, string cutOffReplacement = " ...")
{
    if (string.IsNullOrEmpty(str) || str.Length <= toLength)
        return str;
    else
        return str.Remove(toLength) + cutOffReplacement;
} 
```

* * *

## 回答 #96

> 赞同：2
> 
> 时间：2011-04-22T00:10:10.797

我一直在寻找一种方法，将我开发的一些东西回馈给社区。

这里有一些我觉得非常有用的 FileInfo 扩展。

```
/// <summary>
/// Open with default 'open' program
/// </summary>
/// <param name="value"></param>
public static Process Open(this FileInfo value)
{
    if (!value.Exists)
        throw new FileNotFoundException("File doesn't exist");
    Process p = new Process();
    p.StartInfo.FileName = value.FullName;
    p.StartInfo.Verb = "Open";
    p.Start();
    return p;
}

/// <summary>
/// Print the file
/// </summary>
/// <param name="value"></param>
public static void Print(this FileInfo value)
{
    if (!value.Exists)
        throw new FileNotFoundException("File doesn't exist");
    Process p = new Process();
    p.StartInfo.FileName = value.FullName;
    p.StartInfo.Verb = "Print";
    p.Start();
}

/// <summary>
/// Send this file to the Recycle Bin
/// </summary>
/// <exception cref="File doesn't exist" />
/// <param name="value"></param>
public static void Recycle(this FileInfo value)
{        
    value.Recycle(false);
}

/// <summary>
/// Send this file to the Recycle Bin
/// On show, if person refuses to send file to the recycle bin, 
/// exception is thrown or otherwise delete fails
/// </summary>
/// <exception cref="File doesn't exist" />
/// <exception cref="On show, if user refuses, throws exception 'The operation was canceled.'" />
/// <param name="value">File being recycled</param>
/// <param name="showDialog">true to show pop-up</param>
public static void Recycle(this FileInfo value, bool showDialog)
{
    if (!value.Exists)
            throw new FileNotFoundException("File doesn't exist");
    if( showDialog )
        FileSystem.DeleteFile
            (value.FullName, UIOption.AllDialogs, 
            RecycleOption.SendToRecycleBin);
    else
        FileSystem.DeleteFile
            (value.FullName, UIOption.OnlyErrorDialogs, 
            RecycleOption.SendToRecycleBin);
} 
```

**在用户最喜欢的编辑器中打开任何文件：**

```
new FileInfo("C:\image.jpg").Open(); 
```

**打印操作系统知道如何打印的任何文件：**

```
new FileInfo("C:\image.jpg").Print(); 
```

**将任何文件发送到回收站：**

1.  您必须包括`Microsoft.VisualBasic`参考
2.  使用`using Microsoft.VisualBasic.FileIO;`

例子：

```
new FileInfo("C:\image.jpg").Recycle(); 
```

或者

```
// let user have a chance to cancel send to recycle bin.
new FileInfo("C:\image.jpg").Recycle(true); 
```

* * *

## 回答 #97

> 赞同：2
> 
> 时间：2011-12-12T09:24:01.797

在*winforms*中用于填充组合框：

```
List<MyObject> myObjects = new List<MyObject>() { 
    new MyObject() {Name = "a", Id = 0}, 
    new MyObject() {Name = "b", Id = 1}, 
    new MyObject() {Name = "c", Id = 2} }
comboBox.FillDataSource<MyObject>(myObjects, x => x.Name); 
```

扩展方法：

```
/** <summary>Fills the System.Windows.Forms.ComboBox object DataSource with a 
 * list of T objects.</summary>
 * <param name="values">The list of T objects.</param>
 * <param name="displayedValue">A function to apply to each element to get the 
 * display value.</param>
 */
public static void FillDataSource<T>(this ComboBox comboBox, List<T> values,
    Func<T, String> displayedValue) {

    // Create dataTable
    DataTable data = new DataTable();
    data.Columns.Add("ValueMember", typeof(T));
    data.Columns.Add("DisplayMember");

    for (int i = 0; i < values.Count; i++) {
        // For each value/displayed value

        // Create new row with value & displayed value
        DataRow dr = data.NewRow();
        dr["ValueMember"] = values[i];
        dr["DisplayMember"] = displayedValue(values[i]) ?? "";
        // Add row to the dataTable
        data.Rows.Add(dr);
    }

    // Bind datasource to the comboBox
    comboBox.DataSource = data;
    comboBox.ValueMember = "ValueMember";
    comboBox.DisplayMember = "DisplayMember";
} 
```

* * *

## 回答 #98

> 赞同：2
> 
> 时间：2011-01-17T15:11:00.940

我以为我以前在某个地方看到过这个，但在这里的任何地方都找不到它的建议。MS 在 IDictionary 接口上有一个 TryGetValue 函数，但它返回一个布尔值并在`out`参数中给出值，所以这里有一个更简单、更清晰的实现：

```
public static TVal GetValueOrDefault<TKey, TVal>(this IDictionary<TKey, TVal> d, TKey key) {
  if (d.ContainsKey(key))
    return d[key];
  return default(TVal);
} 
```

* * *

## 回答 #99

> 赞同：2
> 
> 时间：2010-10-15T08:36:13.700

简明扼要地提出事件：

```
public static void Raise(this EventHandler handler, object sender, EventArgs e)
{
    if (handler != null)
    {
        handler(sender, e);
    }
}

public static void Raise<T>(this EventHandler<T> handler, object sender, T e) where T : EventArgs
{
    if (handler != null)
    {
        handler(sender, e);
    }
} 
```

用法：

```
public event EventHandler Bar;

public void Foo()
{
    Bar.Raise(this, EventArgs.Empty);
} 
```

这里有一些关于潜在线程安全问题的[讨论](https://stackoverflow.com/questions/2123608/is-this-a-valid-pattern-for-raising-events-in-c)。从 .NET 4 开始，上述表单是线程安全的，但如果使用旧版本，则需要重新排列和一些锁。

* * *

## 回答 #100

> 赞同：1
> 
> 时间：2008-11-07T09:15:04.437

我喜欢这些 NUnit 断言扩展：[http ://svn.caffeine-it.com/openrasta/trunk/src/Rasta.Testing/AssertExtensions.cs](http://svn.caffeine-it.com/openrasta/trunk/src/Rasta.Testing/AssertExtensions.cs)

* * *

## 回答 #101

> 赞同：1
> 
> 时间：2010-10-22T22:59:58.567

还有一个：

```
public enum ParseFailBehavior
{
   ReturnNull,
   ReturnDefault,
   ThrowException
}

public static T? ParseNullableEnum<T>(this string theValue, ParseFailBehavior desiredBehavior = ParseFailBehavior.ReturnNull) where T:struct
{
   T output;
   T? result = Enum.TryParse<T>(theValue, out output) 
      ? (T?)output
      : desiredBehavior == ParseFailBehavior.ReturnDefault
         ? (T?)default(T)
         : null;

   if(result == null && desiredBehavior == ParseFailBehavior.ThrowException)
      throw new ArgumentException("Parse Failed for value {0} of enum type {1}".
         FormatWith(theValue, typeof(T).Name));       
} 
```

此版本需要 .NET 4.0；在 3.5 中，您没有 TryParse 也没有可选参数；你被 Enum.Parse() 困住了，你必须尝试捕捉。它在 3.5 中仍然完全可行（并且更有用，因为 Enum.Parse() 是 oogly 并且您唯一的其他选择）：

```
public static T? ParseNummableEnum<T>(this string theValue)
{
    return theValue.ParseNullableEnum<T>(ParseFailBehavior.ReturnNull);
}

public static T? ParseNullableEnum<T>(this string theValue, 
    ParseFailBehavior desiredBehavior) where T:struct
{
    try
    {
        return (T?) Enum.Parse(typeof (T), theValue);
    }
    catch (Exception)
    {
        if(desiredBehavior == ParseFailBehavior.ThrowException) throw;
    }

    return desiredBehavior == ParseFailBehavior.ReturnDefault ? (T?)default(T) : null;
} 
```

用法：

```
//returns null if OptionOne isn't an enum constant
var myEnum = "OptionOne".ParseNullableEnum<OptionEnum>(); 

//guarantees a return value IF the enum has a "zero" constant value (generally a good practice)
var myEnum = "OptionTwo".ParseNullableEnum<OptionEnum>(ParseFailBehavior.ReturnDefault).Value 
```

* * *

## 回答 #102

> 赞同：1
> 
> 时间：2008-12-29T19:30:19.063

等价于 Python 的 Join 方法：

```
/// <summary>
/// same as python 'join'
/// </summary>
/// <typeparam name="T">list type</typeparam>
/// <param name="separator">string separator </param>
/// <param name="list">list of objects to be ToString'd</param>
/// <returns>a concatenated list interleaved with separators</returns>
static public string Join<T>(this string separator, IEnumerable<T> list)
{
    var sb = new StringBuilder();
    bool first = true;

    foreach (T v in list)
    {
        if (!first)
            sb.Append(separator);
        first = false;

        if (v != null)
            sb.Append(v.ToString());
    }

    return sb.ToString();
} 
```

* * *

## 回答 #103

> 赞同：1
> 
> 时间：2008-12-10T19:46:28.840

这是 ASP.Net MVC 操作链接帮助器方法的扩展方法，允许它使用控制器的授权属性来决定是否应该在当前用户的视图中启用、禁用或隐藏链接。我使您不必将受限操作包含在“if”子句中，以检查所有视图中的用户成员资格。感谢[Maarten Balliauw](http://blog.maartenballiauw.be/post/2008/08/29/Building-an-ASPNET-MVC-sitemap-provider-with-security-trimming.aspx)的想法和向我展示的代码位:)

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Security.Principal;
using System.Web.Routing;
using System.Web.Mvc;
using System.Collections;
using System.Reflection;
namespace System.Web.Mvc.Html
{
    public static class HtmlHelperExtensions
    {

        /// <summary>
        /// Shows or hides an action link based on the user's membership status
        /// and the controller's authorize attributes
        /// </summary>
        /// <param name="linkText">The link text.</param>
        /// <param name="action">The controller action name.</param>
        /// <param name="controller">The controller name.</param>
        /// <returns></returns>
        public static string SecurityTrimmedActionLink(
            this HtmlHelper htmlHelper,
            string linkText,
            string action,
            string controller)
        {
            return SecurityTrimmedActionLink(htmlHelper, linkText, action, controller, false, null);
        }

        /// <summary>
        /// Enables, disables or hides an action link based on the user's membership status
        /// and the controller's authorize attributes
        /// </summary>
        /// <param name="linkText">The link text.</param>
        /// <param name="action">The action name.</param>
        /// <param name="controller">The controller name.</param>
        /// <param name="showDisabled">if set to <c>true</c> [show link as disabled - 
        /// using a span tag instead of an anchor tag ].</param>
        /// <param name="disabledAttributeText">Use this to add attributes to the disabled
        /// span tag.</param>
        /// <returns></returns>
        public static string SecurityTrimmedActionLink(
            this HtmlHelper htmlHelper, 
            string linkText, 
            string action, 
            string controller, 
            bool showDisabled, 
            string disabledAttributeText)
        {
            if (IsAccessibleToUser(action, controller, HttpContext.Current ))
            {
                return htmlHelper.ActionLink(linkText, action, controller);
            }
            else
            {
                return showDisabled ? 
                    String.Format(
                        "<span{1}>{0}</span>", 
                        linkText, 
                        disabledAttributeText==null?"":" "+disabledAttributeText
                        ) : "";
            }
        }

        private static IController GetControllerInstance(string controllerName)
        {
            Assembly assembly = Assembly.GetExecutingAssembly();
            Type controllerType = GetControllerType(controllerName);
            return (IController)Activator.CreateInstance(controllerType);
        }

        private static ArrayList GetControllerAttributes(string controllerName, HttpContext context)
        {
            if (context.Cache[controllerName + "_ControllerAttributes"] == null)
            {
                var controller = GetControllerInstance(controllerName);

                context.Cache.Add(
                    controllerName + "_ControllerAttributes",
                    new ArrayList(controller.GetType().GetCustomAttributes(typeof(AuthorizeAttribute), true)),
                    null,
                    Caching.Cache.NoAbsoluteExpiration,
                    Caching.Cache.NoSlidingExpiration,
                    Caching.CacheItemPriority.Default,
                    null);

            }
            return (ArrayList)context.Cache[controllerName + "_ControllerAttributes"];

        }

        private static ArrayList GetMethodAttributes(string controllerName, string actionName, HttpContext context)
        {
            if (context.Cache[controllerName + "_" + actionName + "_ActionAttributes"] == null)
            {
                ArrayList actionAttrs = new ArrayList();
                var controller = GetControllerInstance(controllerName);
                MethodInfo[] methods = controller.GetType().GetMethods();

                foreach (MethodInfo method in methods)
                {
                    object[] attributes = method.GetCustomAttributes(typeof(ActionNameAttribute), true);

                    if ((attributes.Length == 0 && method.Name == actionName)
                        ||
                        (attributes.Length > 0 && ((ActionNameAttribute)attributes[0]).Name == actionName))
                    {
                        actionAttrs.AddRange(method.GetCustomAttributes(typeof(AuthorizeAttribute), true));
                    }
                }

                context.Cache.Add(
                    controllerName + "_" + actionName + "_ActionAttributes",
                    actionAttrs,
                    null,
                    Caching.Cache.NoAbsoluteExpiration,
                    Caching.Cache.NoSlidingExpiration,
                    Caching.CacheItemPriority.Default,
                    null);

            }

            return (ArrayList)context.Cache[controllerName + "_" + actionName+ "_ActionAttributes"]; 
        }

        public static bool IsAccessibleToUser(string actionToAuthorize, string controllerToAuthorize, HttpContext context)
        {
            IPrincipal principal = context.User;

            //cache the attribute list for both controller class and it's methods

            ArrayList controllerAttributes = GetControllerAttributes(controllerToAuthorize, context);

            ArrayList actionAttributes = GetMethodAttributes(controllerToAuthorize, actionToAuthorize, context);                        

            if (controllerAttributes.Count == 0 && actionAttributes.Count == 0)
                return true;

            string roles = "";
            string users = "";
            if (controllerAttributes.Count > 0)
            {
                AuthorizeAttribute attribute = controllerAttributes[0] as AuthorizeAttribute;
                roles += attribute.Roles;
                users += attribute.Users;
            }
            if (actionAttributes.Count > 0)
            {
                AuthorizeAttribute attribute = actionAttributes[0] as AuthorizeAttribute;
                roles += attribute.Roles;
                users += attribute.Users;
            }

            if (string.IsNullOrEmpty(roles) && string.IsNullOrEmpty(users) && principal.Identity.IsAuthenticated)
                return true;

            string[] roleArray = roles.Split(',');
            string[] usersArray = users.Split(',');
            foreach (string role in roleArray)
            {
                if (role == "*" || principal.IsInRole(role))
                    return true;
            }
            foreach (string user in usersArray)
            {
                if (user == "*" && (principal.Identity.Name == user))
                    return true;
            }
            return false;
        }

        private static Type GetControllerType(string controllerName)
        {
            Assembly assembly = Assembly.GetExecutingAssembly();
            foreach (Type type in assembly.GetTypes())
            {
                if (
                    type.BaseType!=null 
                    && type.BaseType.Name == "Controller" 
                    && (type.Name.ToUpper() == (controllerName.ToUpper() + "Controller".ToUpper())))
                {
                    return type;
                }
            }
            return null;
        }

    }
} 
```

* * *

## 回答 #104

> 赞同：1
> 
> 时间：2011-01-14T12:21:29.753

IEnumerable 的一些工具：ToString(Format)、ToString(Function) 和 Join(Separator)。

例如：

```
var names = new[] { "Wagner", "Francine", "Arthur", "Bernardo" };

names.ToString("Name: {0}\n");
// Name: Wagner
// Name: Francine
// Name: Arthur
// Name: Bernardo

names.ToString(name => name.Length > 6 ? String.Format("{0} ", name) : String.Empty);
// Francine Bernardo

names.Join(" - ");
// Wagner - Francine - Arthur - Bernardo 
```

扩展：

```
public static string ToString<T>(this IEnumerable<T> self, string format)
{
    return self.ToString(i => String.Format(format, i));
}

public static string ToString<T>(this IEnumerable<T> self, Func<T, object> function)
{
    var result = new StringBuilder();

    foreach (var item in self) result.Append(function(item));

    return result.ToString();
}

public static string Join<T>(this IEnumerable<T> self, string separator)
{
    return String.Join(separator, values: self.ToArray());
} 
```

* * *

## 回答 #105

> 赞同：1
> 
> 时间：2009-02-21T13:07:23.620

WhereIf **()**方法

```
var query = dc.Reviewer 
    .Where(r => r.FacilityID == facilityID) 
    .WhereIf(CheckBoxActive.Checked, r => r.IsActive); 

public static IEnumerable<TSource> WhereIf<TSource>(
    this IEnumerable<TSource> source,
    bool condition, Func<TSource, bool> predicate) 
{ 
    if (condition) 
        return source.Where(predicate); 
    else 
        return source; 
}

public static IQueryable<TSource> WhereIf<TSource>(
    this IQueryable<TSource> source,
    bool condition, Expression<Func<TSource, bool>> predicate) 
{ 
    if (condition) 
        return source.Where(predicate); 
    else 
        return source; 
} 
```

我还在 Where() 扩展方法中为索引谓词添加了重载。要获得更多乐趣，请添加包含附加“else”谓词的风味。

* * *

## 回答 #106

> 赞同：1
> 
> 时间：2009-02-21T13:22:05.253

内联转换：我喜欢这个小模式。为 Boolean、Double 和 DateTime 完成了它。旨在遵循 C#*的 is*和*as*运算符。

```
public static Int32? AsInt32(this string s)
{
    Int32 value;
    if (Int32.TryParse(s, out value))
        return value;

    return null;
}

public static bool IsInt32(this string s)
{
    return s.AsInt32().HasValue;
}

public static Int32 ToInt32(this string s)
{
    return Int32.Parse(s);
{ 
```

* * *

## 回答 #107

> 赞同：1
> 
> 时间：2010-06-23T02:55:22.830

*我一直*使用这个：

```
public static void DelimitedAppend(this StringBuilder sb, string value, string delimiter)
{
    if (sb.Length > 0)
        sb.Append(delimiter);
    sb.Append(value);
} 
```

这只是确保当字符串为空时不插入分隔符。例如，要创建一个以逗号分隔的单词列表：

```
var farmAnimals = new[] { new { Species = "Dog", IsTasty = false }, new { Species = "Cat", IsTasty = false }, new { Species = "Chicken", IsTasty = true }, };
var soupIngredients = new StringBuilder();
foreach (var edible in farmAnimals.Where(farmAnimal => farmAnimal.IsTasty))
    soupIngredients.DelimitedAppend(edible.Species, ", "); 
```

* * *

## 回答 #108

> 赞同：1
> 
> 时间：2009-07-10T15:59:40.783

有几次，我发现自己想要像 Groovy 的“安全导航”这样的东西。

来自[http://groovy.codehaus.org/Statements](http://groovy.codehaus.org/Statements)：

> 如果您正在遍历一个复杂的对象图并且不想抛出 NullPointerExceptions，您可以使用 ?。运算符而不是 . 执行您的导航。
> 
> def foo = null def bar = foo?.something?.myMethod() assert bar == null

那么，您认为为其添加扩展方法是个好主意吗？就像是：

```
obj.SafelyNavigate(x => x.SomeProperty.MaybeAMethod().AnotherProperty); 
```

我认为即使它也会带来一些麻烦也很好。

如果您认为这是个好主意：

*   您认为值类型应该发生什么？返回默认值？throw?，通过通用约束禁用它？
*   吞下 NullReferenceException 来实现它太冒险了？，你有什么建议？，遍历表达式树执行每个调用或成员访问似乎很困难，而且有点矫枉过正（如果可能的话）不是吗？

也许这只是一个坏主意：D，但我认为如果做得好，它会很有用。如果没有类似的东西并且您认为它具有一定的价值，我可能会试一试，然后再编辑答案。

* * *

## 回答 #109

> 赞同：1
> 
> 时间：2009-01-08T06:35:26.227

Convert any string to type Int32

```
// Calls the underlying int.TryParse method to convert a string
// representation of a number to its 32-bit signed integer equivalent.
// Returns Zero if conversion fails. 
public static int ToInt32(this string s)
{
    int retInt;
    int.TryParse(s, out retInt);
    return retInt;
} 
```

SAMPLE USE:
`string s = "999";`
`int i = s.ToInt32();`

* * *

## 回答 #110

> 赞同：1
> 
> 时间：2008-11-11T01:45:38.277

这是另一个 ThrowIfNull 实现：

```
[ThreadStatic]
private static string lastMethodName = null;

[ThreadStatic]
private static int lastParamIndex = 0;

[MethodImpl(MethodImplOptions.NoInlining)]
public static void ThrowIfNull<T>(this T parameter)
{
    var currentStackFrame = new StackFrame(1);
    var props = currentStackFrame.GetMethod().GetParameters();

    if (!String.IsNullOrEmpty(lastMethodName)) {
        if (currentStackFrame.GetMethod().Name != lastMethodName) {
            lastParamIndex = 0;
        } else if (lastParamIndex >= props.Length - 1) {
            lastParamIndex = 0;
        } else {
            lastParamIndex++;
        }
    } else {
        lastParamIndex = 0;
    }

    if (!typeof(T).IsValueType) {
        for (int i = lastParamIndex; i &lt; props.Length; i++) {
            if (props[i].ParameterType.IsValueType) {
                lastParamIndex++;
            } else {
                break;
            }
        }
    }

    if (parameter == null) {
        string paramName = props[lastParamIndex].Name;
        throw new ArgumentNullException(paramName);
    }

    lastMethodName = currentStackFrame.GetMethod().Name;
} 
```

它不如其他实现效率高，但使用更干净：

```
public void Foo()
{
    Bar(1, 2, "Hello", "World"); //no exception
    Bar(1, 2, "Hello", null); //exception
    Bar(1, 2, null, "World"); //exception
}

public void Bar(int x, int y, string someString1, string someString2)
{
    //will also work with comments removed
    //x.ThrowIfNull();
    //y.ThrowIfNull();
    someString1.ThrowIfNull();
    someString2.ThrowIfNull();

    //Do something incredibly useful here!
} 
```

将参数更改为int？也将工作。

-账单

* * *

## 回答 #111

> 赞同：1
> 
> 时间：2009-01-08T07:57:16.077

通用尝试：

```
class Program
{
    static void Main(string[] args)
    {
        var z = 0;
        var a = 0.AsDefaultFor(() => 1 / z);
        Console.WriteLine(a);
        Console.ReadLine();
    }
}

public static class TryExtensions
{
    public static T AsDefaultFor<T>(this T @this, Func<T> operation)
    {
        try
        {
            return operation();
        }
        catch
        {
            return @this;
        }
    }
} 
```

如果需要，可以将其放在 CodePlex 项目中。

* * *

## 回答 #112

> 赞同：1
> 
> 时间：2010-12-02T20:43:40.913

空白规范化相当有用，尤其是在处理用户输入时：

```
namespace Extensions.String
{
    using System.Text.RegularExpressions;

    public static class Extensions
    {
        /// <summary>
        /// Normalizes whitespace in a string.
        /// Leading/Trailing whitespace is eliminated and
        /// all sequences of internal whitespace are reduced to
        /// a single SP (ASCII 0x20) character.
        /// </summary>
        /// <param name="s">The string whose whitespace is to be normalized</param>
        /// <returns>a normalized string</returns>
        public static string NormalizeWS( this string @this )
        {
            string src        = @this ?? "" ;
            string normalized = rxWS.Replace( src , m =>{
                  bool isLeadingTrailingWS = ( m.Index == 0 || m.Index+m.Length == src.Length ? true : false ) ;
                  string p                 = ( isLeadingTrailingWS ? "" : " " ) ;
                  return p ;
                }) ;

            return normalized ;

        }
        private static Regex rxWS = new Regex( @"\s+" ) ;
    }
} 
```

* * *

## 回答 #113

> 赞同：1
> 
> 时间：2008-11-28T21:15:09.967

一些使用列表的扩展：

```
/// <summary>
/// Wrap an object in a list
/// </summary>
public static IList<T> WrapInList<T>(this T item)
{
    List<T> result = new List<T>();
    result.Add(item);
    return result;
} 
```

使用例如：

```
myList = someObject.InList(); 
```

使 IEnumerable 包含来自一个或多个来源的项目，以使 IEnumerable 更像列表。这对于高性能代码可能不是一个好主意，但对于进行测试很有用：

```
public static IEnumerable<T> Append<T>(this IEnumerable<T> enumerable, T newItem)
{
    foreach (T item in enumerable)
    {
        yield return item;
    }

    yield return newItem;
}

public static IEnumerable<T> Append<T>(this IEnumerable<T> enumerable, params T[] newItems)
{
    foreach (T item in enumerable)
    {
        yield return item;
    }

    foreach (T newItem in newItems)
    {
        yield return newItem;
    }
} 
```

使用例如

```
someEnumeration = someEnumeration.Append(newItem); 
```

其他变化是可能的 - 例如

```
someEnumeration = someEnumeration.Append(otherEnumeration); 
```

如果您正在克隆项目，您可能还需要克隆它们的列表：

```
public static IList<T> Clone<T>(this IEnumerable<T> source) where T: ICloneable
{
    List<T> result = new List<T>();

    foreach (T item in source)
    {
        result.Add((T)item.Clone());
    }

    return result;
} 
```

当我使用 时`ObservableCollection<T>`，我通常使用 AddRange 方法对其进行扩展。这里的其他答案给出了这个的实现。

**如果需要，您可以将此代码放在 Codeplex 项目中**。

* * *

## 回答 #114

> 赞同：1
> 
> 时间：2009-11-28T08:42:36.967

一些方便的字符串助手：

**用法：**

我讨厌不需要的空格尾随或前导字符串，并且由于字符串可以`null`取值，这可能很棘手，所以我使用这个：

```
public bool IsGroup { get { return !this.GroupName.IsNullOrTrimEmpty(); } } 
```

这是我用于我正在试用的新[验证框架的另一种扩展方法。](https://stackoverflow.com/questions/1721327/validate-object-based-on-external-factors-ie-data-store-uniqueness/1741831#1741831)您可以看到其中的正则表达式扩展有助于清理其他混乱的正则表达式：

```
public static bool IsRequiredWithLengthLessThanOrEqualNoSpecial(this String str, int length)
{
    return !str.IsNullOrTrimEmpty() &&
        str.RegexMatch(
            @"^[- \r\n\\\.!:*,@$%&""?\(\)\w']{1,{0}}$".RegexReplace(@"\{0\}", length.ToString()),
            RegexOptions.Multiline) == str;
} 
```

**资源：**

```
public static class StringHelpers
{
    /// <summary>
    /// Same as String.IsNullOrEmpty except that
    /// it captures the Empty state for whitespace
    /// strings by Trimming first.
    /// </summary>
    public static bool IsNullOrTrimEmpty(this String helper)
    {
        if (helper == null)
            return true;
        else
            return String.Empty == helper.Trim();
    }

    public static int TrimLength(this String helper)
    {
        return helper.Trim().Length;
    }

    /// <summary>
    /// Returns the matched string from the regex pattern. The
    /// groupName is for named group match values in the form (?<name>group).
    /// </summary>
    public static string RegexMatch(this String helper, string pattern, RegexOptions options, string groupName)
    {
        if (groupName.IsNullOrTrimEmpty())
            return Regex.Match(helper, pattern, options).Value;
        else
            return Regex.Match(helper, pattern, options).Groups[groupName].Value;
    }

    public static string RegexMatch(this String helper, string pattern)
    {
        return RegexMatch(helper, pattern, RegexOptions.None, null);
    }

    public static string RegexMatch(this String helper, string pattern, RegexOptions options)
    {
        return RegexMatch(helper, pattern, options, null);
    }

    public static string RegexMatch(this String helper, string pattern, string groupName)
    {
        return RegexMatch(helper, pattern, RegexOptions.None, groupName);
    }

    /// <summary>
    /// Returns true if there is a match from the regex pattern
    /// </summary>
    public static bool IsRegexMatch(this String helper, string pattern, RegexOptions options)
    {
        return helper.RegexMatch(pattern, options).Length > 0;
    }

    public static bool IsRegexMatch(this String helper, string pattern)
    {
        return helper.IsRegexMatch(pattern, RegexOptions.None);
    }

    /// <summary>
    /// Returns a string where matching patterns are replaced by the replacement string.
    /// </summary>
    /// <param name="pattern">The regex pattern for matching the items to be replaced</param>
    /// <param name="replacement">The string to replace matching items</param>
    /// <returns></returns>
    public static string RegexReplace(this String helper, string pattern, string replacement, RegexOptions options)
    {
        return Regex.Replace(helper, pattern, replacement, options);
    }

    public static string RegexReplace(this String helper, string pattern, string replacement)
    {
        return Regex.Replace(helper, pattern, replacement, RegexOptions.None);
    }
} 
```

我喜欢做很多正则表达式，所以我认为这些比添加 using 语句和额外代码来处理命名组更容易。

* * *

## 回答 #115

> 赞同：1
> 
> 时间：2009-12-28T14:17:49.470

对于 ASP.NET，我使用 HttpSessionState 的这些扩展来加载会话中的对象。它允许您以干净的方式加载会话对象，如果它们不存在，将创建并初始化它们。我使用两种扩展方法，如下所示：

```
private bool CreateMode;
private MyClass SomeClass;

protected override void OnInit (EventArgs e)
{
    CreateMode = Session.GetSessionValue<bool> ("someKey1", () => true);
    SomeClass = Session.GetSessionClass<MyClass> ("someKey2", () => new MyClass () 
    { 
       MyProperty = 123 
    });
} 
```

以下是扩展类：

 `````
public static class SessionExtensions    
{
    public delegate object UponCreate ();
    public static T GetSessionClass<T> (this HttpSessionState session, 
       string key, UponCreate uponCreate) where T : class
    {
        if (null == session[key])
        {
            var item = uponCreate () as T;
            session[key] = item;
            return item;
        }
        return session[key] as T;
    }
    public static T GetSessionValue<T> (this HttpSessionState session, 
       string key, UponCreate uponCreate) where T : struct
    {
        if (null == session[key])
        {
            var item = uponCreate();
            session[key] = item;
            return (T)item;
        }
        return (T)session[key];
    }
} 
````  `* * *

## 回答 #116

> 赞同：1
> 
> 时间：2009-11-02T18:36:56.400

一种避免`out`参数的解析模式：

```
public static bool TryParseInt32(this string input, Action<int> action)
{
    int result;
    if (Int32.TryParse(input, out result))
    {
        action(result);
        return true;
    }
    return false;
} 
```

用法：

```
if (!textBox.Text.TryParseInt32(number => label.Text = SomeMathFunction(number)))
    label.Text = "Please enter a valid integer"; 
```

*如果需要，可以将其放在 codeplex 项目中*

* * *

## 回答 #117

> 赞同：1
> 
> 时间：2009-09-08T15:10:25.137

我总是使用需要换行的格式，`StringBuilder`因此下面非常简单的扩展可以节省几行代码：

```
public static class Extensions
{
    public static void AppendLine(this StringBuilder builder,string format, params object[] args)
    {
        builder.AppendLine(string.Format(format, args));
    }
} 
```

另一种方法是`AppendFormat`使用`StringBuilder`或`\n`Environment.NewLine。

* * *

## 回答 #118

> 赞同：1
> 
> 时间：2011-05-17T23:13:53.880

使用反射找到 TryParse 方法并在字符串目标上调用它。可选参数指定如果转换失败应该返回什么。大多数时候，我发现这种方法非常有用。很清楚这个`Convert.ChangeType`选项，但我发现这更有用，因为默认结果很方便，诸如此类。请注意，找到的方法保存在字典中，尽管我确实怀疑拳击最终会减慢一点速度。

这种方法是我最喜欢的，因为它合法地使用了很多语言特性。

```
private static readonly Dictionary<Type, MethodInfo> Parsers = new Dictionary<Type, MethodInfo>();

public static T Parse<T>(this string value, T defaultValue = default(T))
{
    if (string.IsNullOrEmpty(value)) return defaultValue;

    if (!Parsers.ContainsKey(typeof(T)))
        Parsers[typeof (T)] = typeof (T).GetMethods(BindingFlags.Public | BindingFlags.Static)
            .Where(mi => mi.Name == "TryParse")
            .Single(mi =>
                        {
                            var parameters = mi.GetParameters();
                            if (parameters.Length != 2) return false;
                            return parameters[0].ParameterType == typeof (string) &&
                                   parameters[1].ParameterType == typeof (T).MakeByRefType();
                        });

    var @params = new object[] {value, default(T)};
    return (bool) Parsers[typeof (T)].Invoke(null, @params) ?
        (T) @params[1] : defaultValue;
} 
```

用法：

```
var hundredTwentyThree = "123".Parse(0);
var badnumber = "test".Parse(-1);
var date = "01/01/01".Parse<DateTime>(); 
```

* * *

## 回答 #119

> 赞同：1
> 
> 时间：2010-03-13T06:26:11.967

讨厌这种代码？

```
CloneableClass cc1 = new CloneableClass ();
CloneableClass cc2 = null;
CloneableClass cc3 = null;

cc3 = (CloneableClass) cc1.Clone (); // this is ok
cc3 = cc2.Clone (); // this throws null ref exception
// code to handle both cases
cc3 = cc1 != null ? (CloneableClass) cc1.Clone () : null; 
```

它有点笨拙，所以我用这个扩展替换它，我称之为 CloneOrNull -

```
public static T CloneOrNull<T> (this T self) where T : class, ICloneable
{
    if (self == null) return null;
    return (T) self.Clone ();
} 
```

用法如下：

```
CloneableClass cc1 = new CloneableClass ();
CloneableClass cc2 = null;
CloneableClass cc3 = null;

cc3 = cc1.CloneOrNull (); // clone of cc1
cc3 = cc2.CloneOrNull (); // null
// look mom, no casts! 
```

请随时在任何地方使用它！

* * *

## 回答 #120

> 赞同：1
> 
> 时间：2011-11-09T16:36:35.410

我还没有看到任何关于这个的答案......

```
public static string[] Split(this string value, string regexPattern)
{
    return value.Split(regexPattern, RegexOptions.None);
}

public static string[] Split(this string value, string regexPattern, 
    RegexOptions options)
{
    return Regex.Split(value, regexPattern, options);
} 
```

用法：

```
var obj = "test1,test2,test3";
string[] arrays = obj.Split(","); 
```

* * *

## 回答 #121

> 赞同：1
> 
> 时间：2009-11-16T15:37:57.893

在 ASP.NET 中，我总是厌倦了使用 FindControl，然后不得不在引用之前强制转换并检查值是否为空。[因此，我向Control](http://msdn.microsoft.com/en-us/library/system.web.ui.control.aspx)添加了一个 TryParse() 方法，该方法反映了 Int32 等框架中的类似方法。

```
public static bool TryParse<T>(this Control control, string id, out T result) 
    where T : Control
{
    result = control.FindControl(id) as T;
    return result != null;
} 
```

所以现在您可以在 ASP.NET 网页表单页面中执行此操作：

```
Label lbl;
if (Page.TryParse("Label1", out lbl))
{
    lbl.Text = "Safely set text";
} 
```

* * *

## 回答 #122

> 赞同：1
> 
> 时间：2011-08-26T08:04:55.460

无论是否有效但不为空，都需要有类的实例

```
public static T Safe<T>(this T obj) where T : new()
{
    if (obj == null)
    {
        obj = new T();
    }

    return obj;
} 
```

用法如下：

```
MyClass myClass = Provider.GetSomeResult();
string temp = myClass.Safe().SomeValue; 
```

代替：

```
MyClass myClass = Provider.GetSomeResult();
string temp = "some default value";
if (myClass != null)
{
        temp = myClass.SomeValue;
} 
```

对不起，如果它是重复的，但我没有找到它。

* * *

## 回答 #123

> 赞同：1
> 
> 时间：2010-06-28T13:13:34.833

如果您使用 Fiscal Years，则可以使用一些有用的扩展

```
/// <summary>
/// Returns the fiscal year for the passed in date
/// </summary>
/// <param name="value">the date</param>
/// <returns>the fiscal year</returns>
public static int FiscalYear(this DateTime value)
{
  int ret = value.Year;
  if (value.Month >= 7) ret++;
  return ret;
}

/// <summary>
/// Returns the fiscal year for the passed in date
/// </summary>
/// <param name="value">the date</param>
/// <returns>the fiscal year</returns>
public static string FiscalYearString(this DateTime value)
{
  int fy = FiscalYear(value);
  return "{0}/{1}".Format(fy - 1, fy);
} 
```

* * *

## 回答 #124

> 赞同：1
> 
> 时间：2010-09-21T03:45:01.093

覆盖指定索引处的字符串的一部分。

我必须使用一个期望某些输入值是固定宽度、固定位置字符串的系统。

```
public static string Overwrite(this string s, int startIndex, string newStringValue)
{
  return s.Remove(startIndex, newStringValue.Length).Insert(startIndex, newStringValue);
} 
```

所以我可以这样做：

```
string s = new String(' ',60);
s = s.Overwrite(7,"NewValue"); 
```

* * *

## 回答 #125

> 赞同：1
> 
> 时间：2010-08-19T16:52:28.087

ASP.NET **HTML 编码**- 简短而甜蜜：

```
public static string ToHtmlEncodedString(this string s)
{
    if (String.IsNullOrEmpty(s))
        return s;
    return HttpUtility.HtmlEncode(s);
} 
```

* * *

## 回答 #126

> 赞同：0
> 
> 时间：2009-11-20T02:18:53.983

哇，为什么不呢！这是插入排序的 IList 的扩展（不能是 IEnumerable，因为我使用列表特定功能）。

```
internal static class SortingHelpers
{
    /// <summary>
    /// Performs an insertion sort on this list.
    /// </summary>
    /// <typeparam name="T">The type of the list supplied.</typeparam>
    /// <param name="list">the list to sort.</param>
    /// <param name="comparison">the method for comparison of two elements.</param>
    /// <returns></returns>
    public static void InsertionSort<T>(this IList<T> list, Comparison<T> comparison)
    {
        for (int i = 2; i < list.Count; i++)
        {
            for (int j = i; j > 1 && comparison(list[j], list[j - 1]) < 0; j--)
            {
                T tempItem = list[j];
                list.RemoveAt(j);
                list.Insert(j - 1, tempItem);
            }
        }
    }
} 
```

一个例子：

```
List<int> list1 = { 3, 5, 1, 2, 9, 4, 6 };
list1.InsertionSort((a,b) => a - b);
//list is now in order of 1,2,3,4,5,6,9 
```

* * *

## 回答 #127

> 赞同：0
> 
> 时间：2011-08-26T08:15:16.247

在序列化和配置上，最好使用长日期时间，所以：

```
 public static readonly DateTime Epoch = new DateTime(1970, 1, 1, 0, 0, 0);

    public static long ToUnixTimestamp(this DateTime dateTime)
    {
        return (long) (dateTime - Epoch).TotalSeconds;
    }

    public static long ToUnixUltraTimestamp(this DateTime dateTime)
    {
        return (long) (dateTime - Epoch).TotalMilliseconds;
    } 
```

和向后

```
 public static DateTime ToDateTime(this long unixDateTime)
    {
        return Epoch.AddSeconds(unixDateTime);
    }

    public static DateTime ToDateTimeUltra(this long unixUltraDateTime)
    {
        return Epoch.AddMilliseconds(unixUltraDateTime);
    } 
```

* * *

## 回答 #128

> 赞同：0
> 
> 时间：2010-10-22T14:23:55.090

这个还没有完全出炉，因为我们今天早上刚想出来的。它将为一个类型生成一个完整的类定义。对于您有一个大型类并想要创建子集或完整定义但无权访问它的情况很有用。例如，将对象存储在数据库中等。

```
public static class TypeExtensions
{
    public static string GenerateClassDefinition(this Type type)
    {
        var properties = type.GetFields();
        var sb = new StringBuilder();
        var classtext = @"private class $name
        {
         $props}";

        foreach (var p in GetTypeInfo(type))
        {
            sb.AppendFormat("  public {0} {1} ", p.Item2, p.Item1).AppendLine(" { get; set; }");
        }

        return classtext.Replace("$name", type.Name).Replace("$props", sb.ToString());
    }

    #region Private Methods
    private static List<Tuple<string, string>> GetTypeInfo(Type type)
    {
        var ret = new List<Tuple<string, string>>();
        var fields = type.GetFields();
        var props = type.GetProperties();

        foreach(var p in props) ret.Add(new Tuple<string, string>(p.Name, TranslateType(p.PropertyType)));    
        foreach(var f in fields) ret.Add(new Tuple<string, string>(f.Name, TranslateType(f.FieldType)));

        return ret;
    }

    private static string TranslateType(Type input)
    {
        string ret;

        if (Nullable.GetUnderlyingType(input) != null)
        {
            ret = string.Format("{0}?", TranslateType(Nullable.GetUnderlyingType(input)));
        }
        else
        {
            switch (input.Name)
            {
                case "Int32": ret = "int"; break;
                case "Int64": ret = "long"; break;
                case "IntPtr": ret = "long"; break;
                case "Boolean": ret = "bool"; break;
                case "String":
                case "Char":
                case "Decimal":
                    ret = input.Name.ToLower(); break;
                default: ret = input.Name; break;
            }
        }

        return ret;
    }
    #endregion
} 
```

示例用法：

```
Process.GetProcesses().First().GetType().GenerateClassDefinition(); 
```

如果使用 linqpad 会更方便：

```
Process.GetProcesses().First().GetType().GenerateClassDefinition().Dump(); 
```

* * *

## 回答 #129

> 赞同：0
> 
> 时间：2011-01-14T08:24:56.153

这是我经常使用的控制调用扩展；

```
public static class InvokeExtensions
{
    public static void InvokeHandler(this Control control, MethodInvoker del) // Sync. control-invoke extension.
    {
        if (control.InvokeRequired)
        {
            control.Invoke(del);
            return; 
        }
        del(); // run the actual code.
    }

    public static void AsyncInvokeHandler(this Control control, MethodInvoker del) // Async. control-invoke extension.
    {
        if (control.InvokeRequired)
        {
            control.BeginInvoke(del);
            return; 
        }
        del(); // run the actual code.
    }
} 
```

样本;

```
this.TreeView.AsyncInvokeHandler(() =>
        {
            this.Text = 'xyz'
        }); 
```

它允许跨线程 gui 更新。

* * *

## 回答 #130

> 赞同：0
> 
> 时间：2009-06-04T23:53:56.193

```
// Checks for an empty collection, and sends the value set in the default constructor for the desired field
public static TResult MinGuarded<T, TResult>(this IEnumerable<T> items, Func<T, TResult> expression) where T : new() {
    if(items.IsEmpty()) {
        return (new List<T> { new T() }).Min(expression);
    }
    return items.Min(expression);
}

// Checks for an empty collection, and sends the value set in the default constructor for the desired field
public static TResult MaxGuarded<T, TResult>(this IEnumerable<T> items, Func<T, TResult> expression) where T : new() {
    if(items.IsEmpty()) {
        return (new List<T> { new T() }).Max(expression);
    }
    return items.Max(expression);
} 
```

我不确定是否有更好的方法来做到这一点，但是当我想控制对象中字段的默认值时，这个扩展非常有用。
例如，如果我想控制 DateTime 的值并想根据我的业务逻辑进行设置，那么我可以在默认构造函数中这样做。否则，它就会出现`DateTime.MinDate`。

* * *

## 回答 #131

> 赞同：0
> 
> 时间：2011-04-18T21:15:15.680

Sql server 的参数限制为 ~2000 个，如果您有 10k 个 Id 并希望将记录与它们连接起来，这会很痛苦。我编写了这些方法，它们接受成批的 id 列表，并像这样调用：

```
List<Order> orders = dataContext.Orders.FetchByIds(
  orderIdChunks,
  list => row => list.Contains(row.OrderId)
);

List<Customer> customers = dataContext.Orders.FetchByIds(
  orderIdChunks,
  list => row => list.Contains(row.OrderId),
  row => row.Customer
);

public static List<ResultType> FetchByIds<RecordType, ResultType>(
    this IQueryable<RecordType> querySource,
    List<List<int>> IdChunks,
    Func<List<int>, Expression<Func<RecordType, bool>>> filterExpressionGenerator,
    Expression<Func<RecordType, ResultType>> projectionExpression
    ) where RecordType : class
{
    List<ResultType> result = new List<ResultType>();
    foreach (List<int> chunk in IdChunks)
    {
        Expression<Func<RecordType, bool>> filterExpression =
            filterExpressionGenerator(chunk);

        IQueryable<ResultType> query = querySource
            .Where(filterExpression)
            .Select(projectionExpression);

        List<ResultType> rows = query.ToList();
        result.AddRange(rows);
    }

    return result;
}

public static List<RecordType> FetchByIds<RecordType>(
    this IQueryable<RecordType> querySource,
    List<List<int>> IdChunks,
    Func<List<int>, Expression<Func<RecordType, bool>>> filterExpressionGenerator
    ) where RecordType : class
{
    Expression<Func<RecordType, RecordType>> identity = r => r;

    return FetchByIds(
        querySource,
        IdChunks,
        filterExpressionGenerator,
        identity
        );
} 
```

* * *

## 回答 #132

> 赞同：0
> 
> 时间：2008-12-17T16:10:04.783

*   用于将多个元素添加到没有 AddRange 的集合中，例如，`collection.Add(item1, item2, itemN);`

    ```
    static void Add<T>(this ICollection<T> coll, params T[] items)
     { foreach (var item in items) coll.Add(item);
     } 
    ```

*   以下类似于`string.Format()`但具有参数的自定义字符串表示，例如，`"{0} {1} {2}".Format<Custom>(c=>c.Name,"string",new object(),new Custom())`导致`"string {System.Object} Custom1Name"`

    ```
    static string Format<T>(  this string format
                            , Func<T,object> select
                            , params object[] args)
     { for(int i=0; i < args.Length; ++i)
        { var x = args[i] as T;
          if (x != null) args[i] = select(x);
        }
       return string.Format(format, args);
     } 
    ```

* * *

## 回答 #133

> 赞同：0
> 
> 时间：2010-11-14T15:22:37.303

[C# 中的 Smalltalk 风格 if/else。](https://github.com/rtaycher/Smalltalk-like-control-structures/blob/master/SmalltalkBooleanExtensionMethods/BooleanExtension.cs)

随意在你使用的任何许可证下将它放在 codeplex 上

```
using System;
namespace SmalltalkBooleanExtensionMethods
{

    public static class BooleanExtension
    {
        public static T ifTrue<T> (this bool aBoolean, Func<T> method)
        {
        if (aBoolean)
            return (T)method();
        else
            return default(T);
    }

        public static void ifTrue (this bool aBoolean, Action method)
        {
            if (aBoolean)
                method();
        }

        public static T ifFalse<T> (this bool aBoolean, Func<T> method)
        {
            if (!aBoolean)
                return (T)method();
            else
                return default(T);
        }

        public static void ifFalse (this bool aBoolean, Action method)
        {
            if (!aBoolean)
                method();
        }

        public static T ifTrueifFalse<T> (this Boolean aBoolean, Func<T> methodA, Func<T> methodB)
        {
            if (aBoolean)
                return (T)methodA();
            else
                return (T)methodB();
        }

        public static void ifTrueifFalse (this Boolean aBoolean, Action methodA, Action methodB)
        {
            if (aBoolean)
                methodA();
            else
                methodB();
        }

    }

} 
```

您可能已经有一个 timesRepeat 方法，但它在那里。

```
using System;

namespace SmalltalkBooleanExtensionMethods
{
    public static class IntExtension
    {
        public static int timesRepeat<T>(this int x, Func<T> method)
        {
            for (int i = x; i > 0; i--)
            {
                method();
            }

            return x;
        }

        public static int timesRepeat(this int x, Action method)
        {
            for (int i = x; i > 0; i--)
            {
                method();
            }

            return x;
        }
    }
} 
```

Nunit 测试

```
using System;
using SmalltalkBooleanExtensionMethods;
using NUnit.Framework;

namespace SmalltalkBooleanExtensionMethodsTest
{
    [TestFixture]
    public class SBEMTest
    {
        int i;
        bool itWorks;

        [SetUp]
        public void Init()
        {

            i = 0;
            itWorks = false;
        }

        [Test()]
        public void TestifTrue()
        {

            itWorks = (true.ifTrue(() => true));
            Assert.IsTrue(itWorks);
        }
        [Test()]
        public void TestifFalse()
        {
            itWorks = (false.ifFalse(() => true));
            Assert.IsTrue(itWorks);
        }

        [Test()]
        public void TestifTrueifFalse()
        {
            itWorks = false.ifTrueifFalse(() => false, () => true);
            Assert.IsTrue(itWorks);
            itWorks = false;
            itWorks = true.ifTrueifFalse(() => true, () => false);
            Assert.IsTrue(itWorks);
        }

        [Test()]
        public void TestTimesRepeat()
        {
            (5).timesRepeat(() => i = i + 1);
            Assert.AreEqual(i, 5);
        }

        [Test()]
        public void TestVoidMethodIfTrue()
        {

            true.ifTrue(() => SetItWorksBooleanToTrue());
            Assert.IsTrue(itWorks);
        }

        [Test()]
        public void TestVoidMethodIfFalse()
        {

            false.ifFalse(() => SetItWorksBooleanToTrue());
            Assert.IsTrue(itWorks);
        }

        public void TestVoidMethodIfTrueIfFalse()
        {
            true.ifTrueifFalse(() => SetItWorksBooleanToTrue(), () => SetItWorksBooleanToFalse());
            false.ifTrueifFalse(() => SetItWorksBooleanToFalse(), () => SetItWorksBooleanToTrue());
            Assert.IsTrue(itWorks);

        }

        public void TestVoidMethodTimesRepeat()
        {
            (5).timesRepeat(() => AddOneToi());
            Assert.AreEqual(i, 5);
        }

        public void SetItWorksBooleanToTrue()
        {
            itWorks = true;
        }

        public void SetItWorksBooleanToFalse()
        {
            itWorks = false;
        }

        public void AddOneToi()
        {
            i = i + 1;
        }
    }
} 
```

* * *

## 回答 #134

> 赞同：0
> 
> 时间：2009-01-08T07:54:50.027

```
// Values ordered true/false
// True/false values separated by a capital letter
// Only two values allowed
// ---------------------------
// Limited, but could be useful
public enum BooleanFormat
{
    OneZero,
    YN,
    YesNo,
    TF,
    TrueFalse,
    PassFail,
    YepNope
}

public static class BooleanExtension
{
    /// <summary>
    /// Converts the boolean value of this instance to the specified string value. 
    /// </summary>
    private static string ToString(this bool value, string passValue, string failValue)
    {
        return value ? passValue : failValue;
    }

    /// <summary>
    /// Converts the boolean value of this instance to a string. 
    /// </summary>
    /// <param name="booleanFormat">A BooleanFormat value. 
    /// Example: BooleanFormat.PassFail would return "Pass" if true and "Fail" if false.</param>
    /// <returns>Boolean formatted string</returns>
    public static string ToString(this bool value, BooleanFormat booleanFormat)
    {
        string booleanFormatString = Enum.GetName(booleanFormat.GetType(), booleanFormat);
        return ParseBooleanString(value, booleanFormatString);      
    }

    // Parses boolean format strings, not optimized
    private static string ParseBooleanString(bool value, string booleanFormatString)
    {
        StringBuilder trueString = new StringBuilder();
        StringBuilder falseString = new StringBuilder();

        int charCount = booleanFormatString.Length;

        bool isTrueString = true;

        for (int i = 0; i != charCount; i++)
        {
            if (char.IsUpper(booleanFormatString[i]) && i != 0)
                isTrueString = false;

            if (isTrueString)
                trueString.Append(booleanFormatString[i]);
            else
                falseString.Append(booleanFormatString[i]);
        }

        return (value == true ? trueString.ToString() : falseString.ToString());
    } 
```

* * *

## 回答 #135

> 赞同：0
> 
> 时间：2011-04-06T16:04:11.210

比较两个对象的相等性，而不需要（必须）重写 Equals 或实现 IEquatable<>。

你为什么想做这个？当你真的想知道两个对象是否相等，但又懒得重写`Equals(object)`或实现时`IEquatable<T>`。或者，更现实地说，如果您有一个非常复杂的类并且手动实现 Equals 将非常乏味、容易出错并且维护起来也不有趣。如果您不太关心性能，它也会有所帮助。

我目前正在使用`IsEqualTo`第二个原因 - 我有一个具有许多属性的类，这些属性的类型是其他用户定义的类，每个属性都有许多其他属性，其类型是其他用户定义的类，无穷无尽。在许多这些类中加入一堆集合，实现`Equals(object)`真正成为一场噩梦。

用法：

```
if (myTerriblyComplexObject.IsEqualTo(myOtherTerriblyComplexObject))
{
    // Do something terribly interesting.
} 
```

为了确定平等，我做了很多比较。我尽一切努力按照“正确”的顺序做“正确”的事情。比较，按顺序是：

1.  使用静态`Equals(object, object)`方法。如果返回 true，则返回 true。如果引用相同，它将返回 true。如果`thisObject`overrides也将返回 true `Equals(object)`。
2.  如果`thisObject`为 null，则返回 false。如果为空，则无法进行进一步比较。
3.  如果`thisObject`已覆盖`Equals(object)`，则返回 false。由于它覆盖了 Equals，它一定意味着 Equals 在步骤 #1 执行并返回 false。如果有人费心重写 Equals，我们应该尊重这一点并返回 Equals 返回的内容。
4.  如果`thisObject`继承自`IEquatable<T>`，`otherObject`可以分配到，使用反射`T`获取方法。`Equals(T)`调用该方法并返回其返回值。
5.  如果两个对象都是`IEnumerable`，则返回是否包含相同的项目，以相同的顺序，使用 IsEqualTo 比较项目。
6.  如果对象具有不同的类型，则返回 false。由于我们现在知道`thisObject`没有 Equals 方法，因此没有任何方法可以真实地评估两个不同类型的对象是否为真。
7.  如果对象是值类型（原始或结构）或字符串，则返回 false。我们已经没有通过`Equals(object)`测试 - 说得够多了。
8.  对于 的每个属性`thisObject`，使用 IsEqualTo 测试其值。如果有任何返回 false，则返回 false。如果全部返回 true，则返回 true。

字符串比较可能会更好，但易于实现。另外，我不是 100% 确定我处理的是正确的结构。

废话不多说，扩展方法如下：

```
/// <summary>
/// Provides extension methods to determine if objects are equal.
/// </summary>
public static class EqualsEx
{
    /// <summary>
    /// The <see cref="Type"/> of <see cref="string"/>.
    /// </summary>
    private static readonly Type StringType = typeof(string);

    /// <summary>
    /// The <see cref="Type"/> of <see cref="object"/>.
    /// </summary>
    private static readonly Type ObjectType = typeof(object);

    /// <summary>
    /// The <see cref="Type"/> of <see cref="IEquatable{T}"/>.
    /// </summary>
    private static readonly Type EquatableType = typeof(IEquatable<>);

    /// <summary>
    /// Determines whether <paramref name="thisObject"/> is equal to <paramref name="otherObject"/>.
    /// </summary>
    /// <param name="thisObject">
    /// This object.
    /// </param>
    /// <param name="otherObject">
    /// The other object.
    /// </param>
    /// <returns>
    /// True, if they are equal, otherwise false.
    /// </returns>
    public static bool IsEqualTo(this object thisObject, object otherObject)
    {
        if (Equals(thisObject, otherObject))
        {
            // Always check Equals first. If the object has overridden Equals, use it. This will also capture the case where both are the same reference.
            return true;
        }

        if (thisObject == null)
        {
            // Because Equals(object, object) returns true if both are null, if either is null, return false.
            return false;
        }

        var thisObjectType = thisObject.GetType();
        var equalsMethod = thisObjectType.GetMethod("Equals", BindingFlags.Public | BindingFlags.Instance, null, new[] { ObjectType }, null);
        if (equalsMethod.DeclaringType == thisObjectType)
        {
            // thisObject overrides Equals, and we have already failed the Equals test, so return false.
            return false;
        }

        var otherObjectType = otherObject == null ? null : otherObject.GetType();

        // If thisObject inherits from IEquatable<>, and otherObject can be passed into its Equals method, use it.
        var equatableTypes = thisObjectType.GetInterfaces().Where(                                          // Get interfaces of thisObjectType that...
            i => i.IsGenericType                                                                            // ...are generic...
            && i.GetGenericTypeDefinition() == EquatableType                                                // ...and are IEquatable of some type...
            && (otherObjectType ==  null || i.GetGenericArguments()[0].IsAssignableFrom(otherObjectType))); // ...and otherObjectType can be assigned to the IEquatable's type.

        if (equatableTypes.Any())
        {
            // If we found any interfaces that meed our criteria, invoke the Equals method for each interface.
            // If any return true, return true. If all return false, return false.
            return equatableTypes
                .Select(equatableType => equatableType.GetMethod("Equals", BindingFlags.Public | BindingFlags.Instance))
                .Any(equatableEqualsMethod => (bool)equatableEqualsMethod.Invoke(thisObject, new[] { otherObject }));
        }

        if (thisObjectType != StringType && thisObject is IEnumerable && otherObject is IEnumerable)
        {
            // If both are IEnumerable, check their items.
            var thisEnumerable = ((IEnumerable)thisObject).Cast<object>();
            var otherEnumerable = ((IEnumerable)otherObject).Cast<object>();

            return thisEnumerable.SequenceEqual(otherEnumerable, IsEqualToComparer.Instance);
        }

        if (thisObjectType != otherObjectType)
        {
            // If they have different types, they cannot be equal.
            return false;
        }

        if (thisObjectType.IsValueType || thisObjectType == StringType)
        {
            // If it is a value type, we have already determined that they are not equal, so return false.
            return false;
        }

        // Recurse into each public property: if any are not equal, return false. If all are true, return true.
        return !(from propertyInfo in thisObjectType.GetProperties()
                 let thisPropertyValue = propertyInfo.GetValue(thisObject, null)
                 let otherPropertyValue = propertyInfo.GetValue(otherObject, null)
                 where !thisPropertyValue.IsEqualTo(otherPropertyValue)
                 select thisPropertyValue).Any();
    }

    /// <summary>
    /// A <see cref="IEqualityComparer{T}"/> to be used when comparing sequences of collections.
    /// </summary>
    private class IsEqualToComparer : IEqualityComparer<object>
    {
        /// <summary>
        /// The singleton instance of <see cref="IsEqualToComparer"/>.
        /// </summary>
        public static readonly IsEqualToComparer Instance;

        /// <summary>
        /// Initializes static members of the <see cref="EqualsEx.IsEqualToComparer"/> class.
        /// </summary>
        static IsEqualToComparer()
        {
            Instance = new IsEqualToComparer();
        }

        /// <summary>
        /// Prevents a default instance of the <see cref="EqualsEx.IsEqualToComparer"/> class from being created.
        /// </summary>
        private IsEqualToComparer()
        {
        }

        /// <summary>
        /// Determines whether the specified objects are equal.
        /// </summary>
        /// <param name="x">
        /// The first object to compare.
        /// </param>
        /// <param name="y">
        /// The second object to compare.
        /// </param>
        /// <returns>
        /// true if the specified objects are equal; otherwise, false.
        /// </returns>
        bool IEqualityComparer<object>.Equals(object x, object y)
        {
            return x.IsEqualTo(y);
        }

        /// <summary>
        /// Not implemented - throws an <see cref="NotImplementedException"/>.
        /// </summary>
        /// <param name="obj">
        /// The <see cref="object"/> for which a hash code is to be returned.
        /// </param>
        /// <returns>
        /// A hash code for the specified object.
        /// </returns>
        int IEqualityComparer<object>.GetHashCode(object obj)
        {
            throw new NotImplementedException();
        }
    }
} 
```

* * *

## 回答 #136

> 赞同：0
> 
> 时间：2009-01-28T08:28:03.387

也许我编写和使用过的最有用的扩展方法在这里：

[http://www.codeproject.com/KB/cs/fun-with-cs-extensions.aspx?msg=2838918#xx2838918xx](http://www.codeproject.com/KB/cs/fun-with-cs-extensions.aspx?msg=2838918#xx2838918xx)

* * *

## 回答 #137

> 赞同：0
> 
> 时间：2010-02-16T23:03:26.150

```
public static class StringHelper
{
    public static String F(this String str, params object[] args)
    {
        return String.Format(str, args);
    }
} 
```

使用类似：

```
"Say {0}".F("Hello"); 
```

* * *

## 回答 #138

> 赞同：0
> 
> 时间：2009-11-26T17:22:18.677

在我的博客统计页面的最近搜索部分中，我删除了所有重复项，但需要一种方法来删除几乎重复的行。我会得到大量类似但不完全相同的 Google 查询。

我最终使用了匿名类型而不是字典，但想要一种方法来创建该匿名类型的列表。你不能这样做，但你可以`List<dynamic>`在 .NET 4.0 中创建一个 :)

大多数情况下，我喜欢它，因为我有效地获得了`List<AnonymousType#1>()`.

```
/// <summary>Remove extraneous entries for common word permutations</summary>
/// <param name="input">Incoming series of words to be filtered</param>
/// <param name="MaxIgnoreLength">Words this long or shorter will not count as duplicates</param>
/// <param name="words2">Instance list from BuildInstanceList()</param>
/// <returns>Filtered list of lines from input, based on filter info in words2</returns>
private static List<string> FilterNearDuplicates(List<string> input, int MaxIgnoreLength, List<dynamic> words2)
{
    List<string> output = new List<string>();
    foreach (string line in input)
    {
        int Dupes = 0;
        foreach (string word in line.Split(new char[] { ' ', ',', ';', '\\', '/', ':', '\"', '\r', '\n', '.' })
            .Where(p => p.Length > MaxIgnoreLength)
            .Distinct())
        {
            int Instances = 0;
            foreach (dynamic dyn in words2)
            if (word == dyn.Word)
            {
                Instances = dyn.Instances;
                if (Instances > 1)
                    Dupes++;
                break;
            }
        }
        if (Dupes == 0)
            output.Add(line);
    }
    return output;
}
/// <summary>Builds a list of words and how many times they occur in the overall list</summary>
/// <param name="input">Incoming series of words to be counted</param>
/// <returns></returns>
private static List<dynamic> BuildInstanceList(List<string> input)
{
    List<dynamic> words2 = new List<object>();
    foreach (string line in input)
    foreach (string word in line.Split(new char[] { ' ', ',', ';', '\\', '/', ':', '\"', '\r', '\n', '.' }))
    {
        if (string.IsNullOrEmpty(word))
            continue;
        else if (ExistsInList(word, words2))
            for (int i = words2.Count - 1; i >= 0; i--)
            {
                if (words2[i].Word == word)
                    words2[i] = new { Word = words2[i].Word, Instances = words2[i].Instances + 1 };
            }
        else
            words2.Add(new { Word = word, Instances = 1 });
    }

    return words2;
}
/// <summary>Determines whether a dynamic Word object exists in a List of this dynamic type.</summary>
/// <param name="word">Word to look for</param>
/// <param name="words">Word dynamics to search through</param>
/// <returns>Indicator of whether the word exists in the list of words</returns>
private static bool ExistsInList(string word, List<dynamic> words)
{
    foreach (dynamic dyn in words)
        if (dyn.Word == word)
            return true;
    return false;
} 
```

* * *

## 回答 #139

> 赞同：0
> 
> 时间：2009-11-26T17:44:27.337

一些 DataSet/DataRow 扩展使处理 db 结果更简单一些

只需在 DataRow 上使用 .Field("fieldname") ，如果可以，它将强制转换它，可以包含可选的默认值。

DataSet 上还有 .HasRows() ，因此您无需检查表和行是否存在。

例子：

```
using (DataSet ds = yourcall()) 
{
  if (ds.HasRows())
  {
     foreach (DataRow dr in ds.Tables[0].Rows)
     {
        int id = dr.Field<int>("ID");
        string name = dr.Field<string>("Name");
        string Action = dr.Field<string>("Action", "N/A");
     }
  }
} 
```

代码：

```
using System;
using System.Data;

public static class DataSetExtensions
{
    public static T Field<T>(this DataRow row, string columnName, T defaultValue)
    {
        try
        {
            return row.Field<T>(columnName);
        }
        catch
        {
            return defaultValue;
        }
    }

    public static T Field<T>(this DataRow row, string columnName)
    {
        if (row[columnName] == null)
            throw new NullReferenceException(columnName + " does not exist in DataRow");

        string value = row[columnName].ToString();

        if (typeof(T) == "".GetType())
        {
            return (T)Convert.ChangeType(value, typeof(T));
        }
        else if (typeof(T) == 0.GetType())
        {
            return (T)Convert.ChangeType(int.Parse(value), typeof(T));
        }
        else if (typeof(T) == false.GetType())
        {
            return (T)Convert.ChangeType(bool.Parse(value), typeof(T));
        }
        else if (typeof(T) == DateTime.Now.GetType())
        {
            return (T)Convert.ChangeType(DateTime.Parse(value), typeof(T));
        }
        else if (typeof(T) == new byte().GetType())
        {
            return (T)Convert.ChangeType(byte.Parse(value), typeof(T));
        }
        else if (typeof(T) == new float().GetType())
        {
            return (T)Convert.ChangeType(float.Parse(value), typeof(T));
        }
        else
        {
            throw new ArgumentException(string.Format("Cannot cast '{0}' to '{1}'.", value, typeof(T).ToString()));
        }
    }

    public static bool HasRows(this DataSet dataSet) 
    {
        return (dataSet.Tables.Count > 0 && dataSet.Tables[0].Rows.Count > 0);
    }
} 
```

* * *

## 回答 #140

> 赞同：0
> 
> 时间：2010-03-13T20:55:03.667

```
public static class DictionaryExtensions
{
    public static Nullable<TValue> GetValueOrNull<TKey, TValue>(this Dictionary<TKey, TValue> dictionary, TKey key)
        where TValue : struct
    {
        TValue result;
        if (dictionary.TryGetValue(key, out result))
            return result;
        else
            return null;
    }
} 
```

免费使用，只需在代码中提及我的名字 (Janko Röbisch)。

* * *

## 回答 #141

> 赞同：0
> 
> 时间：2011-08-17T08:01:18.853

如果您使用波斯语并且必须以波斯语向用户显示数字：

```
static public string ToFaString         (this string value)
        {
            // 1728 , 1584
            string result = "";
            if (value != null)
            {
                char[] resChar = value.ToCharArray();
                for (int i = 0; i < resChar.Length; i++)
                {
                    if (resChar[i] >= '0' && resChar[i] <= '9')
                        result += (char)(resChar[i] + 1728);
                    else
                        result += resChar[i];
                }
            }
            return result;
        } 
```

* * *

## 回答 #142

> 赞同：0
> 
> 时间：2011-08-17T08:04:24.857

如果您需要检查您的字符串 Is All char is 0 ：

```
 static public bool   IsAllZero            (this string input)
        {
            if(string.IsNullOrEmpty(input))
                return true;
            foreach (char ch in input)
            {
                if(ch != '0')
                    return false;
            }
            return true;
        } 
```

* * *

## 回答 #143

> 赞同：0
> 
> 时间：2012-03-23T13:11:04.783

怎么样 ...

```
public static bool IsWinXPOrHigher(this OperatingSystem OS)
{
  return (OS.Platform == PlatformID.Win32NT)
    && ((OS.Version.Major > 5) || ((OS.Version.Major == 5) && (OS.Version.Minor >= 1)));
}

public static bool IsWinVistaOrHigher(this OperatingSystem OS)
{
  return (OS.Platform == PlatformID.Win32NT)
    && (OS.Version.Major >= 6);
}

public static bool IsWin7OrHigher(this OperatingSystem OS)
{
  return (OS.Platform == PlatformID.Win32NT)
    && ((OS.Version.Major > 6) || ((OS.Version.Major == 6) && (OS.Version.Minor >= 1)));
}

public static bool IsWin8OrHigher(this OperatingSystem OS)
{
  return (OS.Platform == PlatformID.Win32NT)
    && ((OS.Version.Major > 6) || ((OS.Version.Major == 6) && (OS.Version.Minor >= 2)));
} 
```

用法：

```
if (Environment.OSVersion.IsWinXPOrHigher())
{
  // do stuff
}

if (Environment.OSVersion.IsWinVistaOrHigher())
{
  // do stuff
}

if (Environment.OSVersion.IsWin7OrHigher())
{
  // do stuff
}

if (Environment.OSVersion.IsWin8OrHigher())
{
  // do stuff
} 
```

* * *

## 回答 #144

> 赞同：0
> 
> 时间：2010-12-24T10:55:54.617

我创建了一个扩展方法来在 ASP.NET 的下拉列表中选择一个项目。

下面是代码

```
 public static class Utilities
{
    public enum DropDownListSelectionType
    {
        ByValue,
        ByText
    }

    public static void SelectItem(this  System.Web.UI.WebControls.DropDownList drp, string selectedValue, DropDownListSelectionType type)
    {
        drp.ClearSelection();
        System.Web.UI.WebControls.ListItem li;
        if (type == DropDownListSelectionType.ByValue)
            li = drp.Items.FindByValue(selectedValue.Trim());
        else
            li = drp.Items.FindByText(selectedValue.Trim());
        if (li != null)
            li.Selected = true;
    }} 
```

可以通过以下代码行调用此方法以按文本选择

```
DropDownList1.SelectItem("ABCD", Utilities.DropDownListSelectionType.ByText); 
```

或按值选择

```
DropDownList1.SelectItem("11", Utilities.DropDownListSelectionType.ByValue); 
```

如果找不到传入的文本/值，上面的代码不会选择任何内容。

* * *

## 回答 #145

> 赞同：0
> 
> 时间：2012-03-06T23:24:54.570

我使用以下扩展来扩展所有集合（也许有人觉得这些有用）：

```
/// <summary>
/// Collection Helper
/// </summary>
/// <remarks>
/// Use IEnumerable by default, but when altering or getting item at index use IList.
/// </remarks>
public static class CollectionHelper
{

    #region Alter;

    /// <summary>
    /// Swap item to another place
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <param name="IndexA">Index a</param>
    /// <param name="IndexB">Index b</param>
    /// <returns>New collection</returns>
    public static IList<T> Swap<T>(this IList<T> @this, Int32 IndexA, Int32 IndexB)
    {
        T Temp = @this[IndexA];
        @this[IndexA] = @this[IndexB];
        @this[IndexB] = Temp;
        return @this;
    }

    /// <summary>
    /// Swap item to the left
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <param name="Index">Index</param>
    /// <returns>New collection</returns>
    public static IList<T> SwapLeft<T>(this IList<T> @this, Int32 Index)
    {
        return @this.Swap(Index, Index - 1);
    }

    /// <summary>
    /// Swap item to the right
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <param name="Index">Index</param>
    /// <returns>New collection</returns>
    public static IList<T> SwapRight<T>(this IList<T> @this, Int32 Index)
    {
        return @this.Swap(Index, Index + 1);
    }

    #endregion Alter;

    #region Action;

    /// <summary>
    /// Execute action at specified index
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <param name="Index">Index</param>
    /// <param name="ActionAt">Action to execute</param>
    /// <returns>New collection</returns>
    public static IList<T> ActionAt<T>(this IList<T> @this, Int32 Index, Action<T> ActionAt)
    {
        ActionAt(@this[Index]);
        return @this;
    }

    #endregion Action;

    #region Randomize;

    /// <summary>
    /// Take random items
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <param name="Count">Number of items to take</param>
    /// <returns>New collection</returns>
    public static IEnumerable<T> TakeRandom<T>(this IEnumerable<T> @this, Int32 Count)
    {
        return @this.Shuffle().Take(Count);
    }

    /// <summary>
    /// Take random item
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <returns>Item</returns>
    public static T TakeRandom<T>(this IEnumerable<T> @this)
    {
        return @this.TakeRandom(1).Single();
    }

    /// <summary>
    /// Shuffle list
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <returns>New collection</returns>
    public static IEnumerable<T> Shuffle<T>(this IEnumerable<T> @this)
    {
        return @this.OrderBy(Item => Guid.NewGuid());
    }

    #endregion Randomize;

    #region Navigate;

    /// <summary>
    /// Get next item in collection and give first item, when last item is selected;
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <param name="Index">Index in collection</param>
    /// <returns>Next item</returns>
    public static T Next<T>(this IList<T> @this, ref Int32 Index)
    {
        Index = ++Index >= 0 && Index < @this.Count ? Index : 0;
        return @this[Index];
    }

    /// <summary>
    /// Get previous item in collection and give last item, when first item is selected;
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <param name="Index">Index in collection</param>
    /// <returns>Previous item</returns>
    public static T Previous<T>(this IList<T> @this, ref Int32 Index)
    {
        Index = --Index >= 0 && Index < @this.Count ? Index : @this.Count - 1;
        return @this[Index];
    }

    #endregion Navigate;

    #region Clone;

    /// <summary>
    /// 
    /// </summary>
    /// <typeparam name="T">Collection type</typeparam>
    /// <param name="this">Collection</param>
    /// <returns>Cloned collection</returns>
    public static IEnumerable<T> Clone<T>(this IEnumerable<T> @this) where T : ICloneable
    {
        return @this.Select(Item => (T)Item.Clone());
    }

    #endregion Clone;

    #region String;

    /// <summary>
    /// Joins multiple string with Separator
    /// </summary>
    /// <param name="this">Collection</param>
    /// <param name="Separator">Separator</param>
    /// <returns>Joined string</returns>
    public static String Join(this IEnumerable<String> @this, String Separator = "")
    {
        return String.Join(Separator, @this);
    }

    #endregion String;

} 
```

* * *

## 回答 #146

> 赞同：0
> 
> 时间：2010-07-13T14:08:49.977

```
// This file contains extension methods for generic List<> class to operate on sorted lists.
// Duplicate values are OK.
// O(ln(n)) is still much faster then the O(n) of LINQ's searches/filters.
static partial class SortedList
{
    // Return the index of the first element with the key greater then provided.
    // If there's no such element within the provided range, it returns iAfterLast.
    public static int sortedFirstGreaterIndex<tElt, tKey>( this IList<tElt> list, Func<tElt, tKey, int> comparer, tKey key, int iFirst, int iAfterLast )
    {
        if( iFirst < 0 || iAfterLast < 0 || iFirst > list.Count || iAfterLast > list.Count )
            throw new IndexOutOfRangeException();
        if( iFirst > iAfterLast )
            throw new ArgumentException();
        if( iFirst == iAfterLast )
            return iAfterLast;

        int low = iFirst, high = iAfterLast;
        // The code below is inspired by the following article:
        // http://en.wikipedia.org/wiki/Binary_search#Single_comparison_per_iteration
        while( low < high )
        {
            int mid = ( high + low ) / 2;
            // 'mid' might be 'iFirst' in case 'iFirst+1 == iAfterLast'.
            // 'mid' will never be 'iAfterLast'.
            if( comparer( list[ mid ], key ) <= 0 ) // "<=" since we gonna find the first "greater" element
                low = mid + 1;
            else
                high = mid;
        }
        return low;
    }

    // Return the index of the first element with the key greater then the provided key.
    // If there's no such element, returns list.Count.
    public static int sortedFirstGreaterIndex<tElt, tKey>( this IList<tElt> list, Func<tElt, tKey, int> comparer, tKey key )
    {
        return list.sortedFirstGreaterIndex( comparer, key, 0, list.Count );
    }

    // Add an element to the sorted array.
    // This could be an expensive operation if frequently adding elements that sort firstly.
    // This is cheap operation when adding elements that sort near the tail of the list.
    public static int sortedAdd<tElt>( this List<tElt> list, Func<tElt, tElt, int> comparer, tElt elt )
    {
        if( list.Count == 0 || comparer( list[ list.Count - 1 ], elt ) <= 0 )
        {
            // either the list is empty, or the item is greater then all elements already in the collection.
            list.Add( elt );
            return list.Count - 1;
        }
        int ind = list.sortedFirstGreaterIndex( comparer, elt );
        list.Insert( ind, elt );
        return ind;
    }

    // Find first exactly equal element, return -1 if not found.
    public static int sortedFindFirstIndex<tElt, tKey>( this List<tElt> list, Func<tElt, tKey, int> comparer, tKey elt )
    {
        int low = 0, high = list.Count - 1;

        while( low < high )
        {
            int mid = ( high + low ) / 2;
            if( comparer( list[ mid ], elt ) < 0 )
                low = mid + 1;
            else
                high = mid; // this includes the case when we've found an element exactly matching the key
        }
        if( high >= 0 && 0 == comparer( list[ high ], elt ) )
            return high;
        return -1;
    }

    // Return the IEnumerable that returns array elements in the reverse order.
    public static IEnumerable<tElt> sortedReverse<tElt>( this List<tElt> list )
    {
        for( int i=list.Count - 1; i >= 0; i-- )
            yield return list[ i ];
    }
} 
```

* * *

## 回答 #147

> 赞同：0
> 
> 时间：2012-04-06T10:22:13.917

另一个，这次是为了让 UriBuilder 在处理查询参数时更加友好。

```
 /// <summary>
    /// Adds the specified query parameter to the URI builder.
    /// </summary>
    /// <param name="builder">The builder.</param>
    /// <param name="parameterName">Name of the parameter.</param>
    /// <param name="value">The URI escaped value.</param>
    /// <returns>The final full query string.</returns>
    public static string AddQueryParam(this UriBuilder builder, string parameterName, string value)
    {
        if (parameterName == null)
            throw new ArgumentNullException("parameterName");

        if (parameterName.Length == 0)
            throw new ArgumentException("The parameter name is empty.");

        if (value == null)
            throw new ArgumentNullException("value");

        if (value.Length == 0)
            throw new ArgumentException("The value is empty.");

        if (builder.Query.Length == 0)
        {
            builder.Query = String.Concat(parameterName, "=", value);
        }
        else if
            (builder.Query.Contains(String.Concat("&", parameterName, "="))
            || builder.Query.Contains(String.Concat("?", parameterName, "=")))
        {
            throw new InvalidOperationException(String.Format("The parameter {0} already exists.", parameterName));
        }
        else
        {
            builder.Query = String.Concat(builder.Query.Substring(1), "&", parameterName, "=", value);
        }

        return builder.Query;
    } 
```

* * *

## 回答 #148

> 赞同：0
> 
> 时间：2011-05-06T15:54:04.827

我们有一个部署工具可以在环境之间进行部署。由于文件可以被标记为已修改但实际上并没有什么不同，我想出了这个：

```
/// <summary>
/// Compares the files to see if they are different. 
/// First checks file size
/// Then modified if the file is larger than the specified size
/// Then compares the bytes
/// </summary>
/// <param name="file1">The source file</param>
/// <param name="file2">The destination file</param>
/// <param name="mb">Skip the smart check if the file is larger than this many megabytes. Default is 10.</param>
/// <returns></returns>
public static bool IsDifferentThan(this FileInfo file1, FileInfo file2, int mb = 10)
{
  var ret = false;

  // different size is a different file
  if(file1.Length != file2.Length) return true;

  // if the file times are different and the file is bigger than 10mb flag it for updating
  if(file1.LastWriteTimeUtc > file2.LastWriteTimeUtc && file1.Length > ((mb*1024)*1024)) return true;

  var f1 = File.ReadAllBytes(file1.FullName);
  var f2 = File.ReadAllBytes(file2.FullName);

  // loop through backwards because if they are different
  // it is more likely that the last few bytes will be different
  // than the first few
  for(var i = file1.Length - 1; i > 0; i--)
  {
    if(f1[i] != f2[i])
    {
      ret = true;
      break;
    }
  }

  return ret;
} 
```

* * *

## 回答 #149

> 赞同：-3
> 
> 时间：2009-11-26T17:25:29.730

获取 URI 的根域。

```
/// <summary>Gets the root domain of any URI</summary>
/// <param name="uri">URI to get root domain of</param>
/// <returns>Root domain with TLD</returns>
public static string GetRootDomain(this System.Uri uri)
{
    if (uri == null)
        return null;

    string Domain = uri.Host;
    while (System.Text.RegularExpressions.Regex.Matches(Domain, @"[\.]").Count > 1)
        Domain = Domain.Substring(Domain.IndexOf('.') + 1);
    Domain = Domain.Substring(0, Domain.IndexOf('.'));
    return Domain;
} 
```

* * *

## 回答 #150

> 赞同：-13
> 
> 时间：2008-11-07T07:17:47.497

轻松将对象序列化为 XML：

```
public static string ToXml<T>(this T obj) where T : class
{
    XmlSerializer s = new XmlSerializer(obj.GetType());
    using (StringWriter writer = new StringWriter())
    {
        s.Serialize(writer, obj);
        return writer.ToString();
    }
}

"<root><child>foo</child</root>".ToXml<MyCustomType>(); 
```

# c++ - 如何为手机构建滑块拼图软件

> ID：271404
> 
> 赞同：0
> 
> 时间：2008-11-07T06:53:45.893
> 
> 标签：c++, c, mobile

我想为手机制作好旧的滑块拼图软件，请您指导我如何生成滑块拼图和解决技巧

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T07:11:25.093

看看[Simon Tatham 的便携式拼图系列](http://www.chiark.greenend.org.uk/~sgtatham/puzzles/)，有完整的源代码。您也许可以直接使用它的框架，即使不能，您也会找到求解器的优秀示例。

# lua - 如何将表名分配给变量？

> ID：271406
> 
> 赞同：2
> 
> 时间：2008-11-07T06:55:35.703
> 
> 标签：lua

我在 lua 中有一个包含一些数据的表。

```
sometable = { 
    {name = "bob", something = "foo"},
    {name = "greg", something = "bar"}
} 
```

然后我想遍历表并为每个名称分配一个数字作为变量。lua的新手并像这样尝试过。

```
for i,t in ipairs(sometable) do
    t.name = i
end 
```

然后我假设 print("name1", bob) 会给我 name1 = 1。现在我得到了 nil。所以我回到我丑陋的静态变量列表，直到某个善良的灵魂告诉我我是个白痴。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-08T00:46:06.667

```
> sometable = {{name = "bob", something = "foo"},{name = "greg", something = "bar"}}
> for i,t in ipairs(sometable) do t[t.name] = i end
> for i,t in ipairs(sometable) do for j,u in pairs (t) do print (j,u) end end      
name  bob
something foo
bob   1
greg  2
something bar
name  greg
> return sometable[1].bob
1> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-07T07:06:48.050

ipairs函数将仅按[升序](http://www.lua.org/manual/5.1/manual.html#5.1)遍历数字索引表。

您要使用的是对功能。它将遍历表中的每个键，无论它是什么类型。

# gdi+ - GDI+ 惊人的解码速度和可怕的绘制速度！

> ID：271428
> 
> 赞同：1
> 
> 时间：2008-11-07T07:15:33.383
> 
> 标签：gdi+, drawing, decoder

* * *

谢谢大家的解答，其实我并不疑惑draw 1024*768像素比100*100像素慢...就是这么简单的一个逻辑..让我不解的是DrawImage的插值算法可能很慢，虽然存在很多更好的算法，它的解码器似乎可以从具有一定分辨率的 jpg 解码，这真的很酷，我搜索了一段时间但没有找到任何免费的库来做到这一点......

真的很奇怪！我在 Paint 方法中添加了以下代码。c:\1.jpg 为5M jpg文件，约4000*3000

//------------------------------------------------ --------------

```
HDC hdc = pDC->GetSafeHdc();
bitmap = Bitmap::FromFile(L"c:\\1.jpg",true);
Graphics graphics(hdc);
graphics.SetInterpolationMode( InterpolationModeNearestNeighbor );
graphics.DrawImage(bitmap,0,0,200,200); 
```

上面的速度真的很快！甚至是实时的！我认为解码 5m JPG 不会那么快！

//------------------------------------------------ --------------

```
HDC hdc = pDC->GetSafeHdc();
bitmap = Bitmap::FromFile(L"c:\\1.jpg",true);
Graphics graphics(hdc);
graphics.SetInterpolationMode( InterpolationModeNearestNeighbor );
graphics.DrawImage(bitmap,0,0,2000,2000); 
```

上面的代码变得非常慢

//------------------------------------------------ --------------

如果我添加 Bitmap = Bitmap::FromFile(L"c:\1.jpg", true); //进入构造

离开

```
 Graphics graphics(hdc);
    graphics.SetInterpolationMode( InterpolationModeNearestNeighbor );
    graphics.DrawImage(bitmap,0,0,2000,2000); 
```

在 OnPaint 方法中，代码还是有点慢~~~

//------------------------------------------------ ------------------

与解码相比，drawImage 的过程真的很慢……

他们为什么以及如何做到这一点？微软给负责解码的人支付的工资是负责编写绘图图像的人的两倍吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T07:41:27.857

所以，你真正想知道的是为什么

```
graphics.DrawImage(bitmap,0,0,200,200); 
```

比

```
graphics.DrawImage(bitmap,0,0,2000,2000); 
```

正确的？

好吧，在第二种情况下您绘制的像素多 100 倍这一事实可能与此有关。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T07:45:22.043

解码可能会延迟到需要时。这就是为什么它如此之快。

也许在 200x200 的情况下，GDI+ 只解码足够的块来绘制 200x200，而在 2000x2000 上它们解码更多。

图形例程总是包含一些模糊的优化，你永远不会知道。

也许[Reflector](http://www.red-gate.com/products/reflector/)会告诉你？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T10:23:36.610

如果您要缩小 8 倍，则无需解码 JPG。JPG 图像由 8 x 8 像素的块组成，经过 DCT 转换。该块的平均值是 DCT 的 0,0 系数。因此，缩小 8 倍只是丢弃所有其他组件的问题。进一步缩小（例如 4000->200）只是从 4000 缩小到 500，然后正常从 500 缩小到 200 像素的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T09:58:43.320

只是一个猜测，但您可以尝试使用 4000x3000 或 2000x1500 进行绘图吗？也许 4000 和 3000 可以被 200 整除这一事实正在加快整体速度，而 3000 不能被 200 整除会减慢速度（尽管这真的很奇怪）。

通常，做一些分析或时间测量。如果 2000x2000 比 200x200 慢大约 100 倍，那么一切正常。如果 2000x2000 太慢，请不要打扰。如果你的屏幕是 1024x768，你看不到整个图像，所以你最好选择屏幕上可见的图像部分进行绘制，1024x768 比 2000x2000 快 5 倍。

# c# - 如何执行C#文件

> ID：271438
> 
> 赞同：5
> 
> 时间：2008-11-07T07:22:00.423
> 
> 标签：c#

我有一个 .cs 文件，我需要执行该文件.. 我没有 C# 经验.. 请帮助.. 我们是否必须安装任何软件才能运行它..

目前我正在使用Windows XP ..

请帮我...

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T07:24:26.907

获取[.NET SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=fe6f2099-b7b4-4f47-a244-c96d69c35dec&displaylang=en)（可能不需要，请参阅注释）并查看是否可以使用[CSC.exe](http://msdn.microsoft.com/en-us/library/78f4aasd.aspx)编译 .cs 文件 或者尝试 Visual [Studio Express Edition](http://www.microsoft.com/express/)

但是，如果您没有任何软件工程经验，这可能不是最好的开始方式......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T07:56:57.233

.cs 文件只是一个保存代码的文件，不能直接执行。您应该首先使用合适的工具编译/构建它（以可执行格式）。

你可以从这样的地方开始：[http ://www.csharp-station.com/Tutorials/Lesson01.aspx](http://www.csharp-station.com/Tutorials/Lesson01.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T10:17:35.700

.cs 文件不能自行执行。它需要先编译。

我建议您下载免费的[Visual C# 2008 Express](http://www.microsoft.com/express/vcsharp/) ..

并开始[阅读](http://msdn.microsoft.com/en-us/beginner/default.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T07:50:25.873

有这个**[C#-Script](http://www.csscript.net/)项目**使您能够将 .cs 文件作为脚本运行（vbs 样式）

在我看来，您只想执行该单个文件，因此 C#-Script 应该无需学习任何编译即可完成。

但无论如何，您仍然需要 .NET Framework。先抓住那个。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T07:46:19.657

[片段编译器](http://www.sliver.com/dotnet/SnippetCompiler/)也很有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-11-07T15:57:46.287

如果你安装了 dotnet（VS 自带），你可以试试这个批处理脚本，它将执行任何具有静态 Main() 函数的 .net 核心 cs 文件。

用法是“cs [file.cs]”

:-)

```
@echo off
IF "%1"=="" GOTO HELP

REM => copy .net core project file into temp folder
mkdir _temp 2>NUL
echo ^<Project Sdk="Microsoft.NET.Sdk.Web"^>^<PropertyGroup^>^<TargetFramework^>netcoreapp2.0^</TargetFramework^>^</PropertyGroup^>^</Project^> > _temp\p.csproj
copy %1 _temp 1>NUL
cd _temp

REM => run program
dotnet run

REM => clean-up
cd ..
rmdir /Q /S _temp 1>NUL
GOTO EXIT

:HELP
echo Runs any C# file with a static Main() directly
echo Usage: %0 [file.cs]

:EXIT 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T14:30:08.080

如果您想使用类似于 C# 的 .NET 语言编写 Windows 脚本，您还可以查看 Windows PowerShell。

正如这里的每个人都已经提到的那样 - 无论如何，您都需要首先安装 Microsoft .NET 框架的一个版本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-07T14:04:16.167

从 Microsoft 下载并安装 .NET 框架，撰写本文时的当前版本是从[这里](http://www.microsoft.com/downloads/details.aspx?FamilyID=ab99342f-5d1a-413d-8319-81da479ab0d7&displaylang=en)获得的 v3.5 SP1 。

如果您打算进行任何认真的开发，还可以从[此处](http://www.microsoft.com/downloads/details.aspx?FamilyId=F26B1AA4-741A-433A-9BE5-FA919850BDBF&displaylang=en)下载并安装 .NET SDK v3.5 。这将为您提供额外的工具和开发文档。

安装后，它应该会创建一个“SDK 命令提示符”供您使用。打开它，然后导航到包含 .cs 文件的目录。假设这个 .cs 文件是一个完整的应用程序，不依赖于任何其他程序集（如 DLL），您现在可以编译它。在命令提示符中输入以下内容（将文件名替换为相关信息）：

```
csc /out:your_app_name.exe your_cs_filename.cs 
```

如果您的 .cs 文件一切正常，您现在应该有一个可以运行的工作 .exe。如果没有，您可能会回到 StackOverflow 上寻求调试建议……

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-19T19:00:40.887

使用任何 c# 编译器，但最好的方法是这里的 ms visual studio（或 studio express） [ms visual studio](http://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=0CFYQFjAA&url=http://www.microsoft.com/visualstudio/en-us&ei=N1kIUOLpJKyP4gT1idWVBA&usg=AFQjCNGXc0ImXEXVN-BHvMTOiAZoZaPrVw&sig2=HxCEH-x2_YIAWJXduKLxPA)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-11-23T18:54:44.627

Visual Studio 2019 具有“交互式执行”功能。突出显示代码，然后右键单击，选择“在交互中执行”。然后就可以编写脚本代码了。

# c# - 在 C# 的循环中捕获的变量

> ID：271440
> 
> 赞同：261
> 
> 时间：2008-11-07T07:26:42.143
> 
> 标签：c#, closures, captured-variable

我遇到了一个关于 C# 的有趣问题。我有如下代码。

```
List<Func<int>> actions = new List<Func<int>>();

int variable = 0;
while (variable < 5)
{
    actions.Add(() => variable * 2);
    ++ variable;
}

foreach (var act in actions)
{
    Console.WriteLine(act.Invoke());
} 
```

我希望它输出 0、2、4、6、8。但是，它实际上输出了 5 个 10。

似乎这是由于所有操作都引用了一个捕获的变量。结果，当它们被调用时，它们都具有相同的输出。

有没有办法绕过这个限制，让每个动作实例都有自己的捕获变量？

* * *

## 回答 #1

> 赞同：239
> 
> 时间：2008-11-07T07:32:04.583

是的 - 在循环内获取变量的副本：

```
while (variable < 5)
{
    int copy = variable;
    actions.Add(() => copy * 2);
    ++ variable;
} 
```

您可以将其想象为 C# 编译器每次遇到变量声明时都会创建一个“新”局部变量。事实上，它会创建适当的新闭包对象，如果您在多个范围内引用变量，它会变得复杂（在实现方面），但它可以工作:)

请注意，此问题更常见的情况是使用`for`or `foreach`：

```
for (int i=0; i < 10; i++) // Just one variable
foreach (string x in foo) // And again, despite how it reads out loud 
```

有关这方面的更多详细信息，请参阅 C# 3.0 规范的第 7.14.4.2 节，我[关于闭包的文章](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)也有更多示例。

请注意，从 C# 5 编译器及更高版本开始（即使指定 C# 的早期版本）， 的行为发生了`foreach`变化，因此您不再需要制作本地副本。有关更多详细信息，请参阅[此答案](https://stackoverflow.com/questions/8898925/is-there-a-reason-for-cs-reuse-of-the-variable-in-a-foreach/8899347#8899347)。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-07T07:34:36.887

我相信您正在经历的是被称为 Closure [http://en.wikipedia.org/wiki/Closure_(computer_science)](http://en.wikipedia.org/wiki/Closure_(computer_science))的东西。您的 Lamba 引用了一个变量，该变量的范围在函数本身之外。在调用它之前，不会解释您的 lamba，一旦调用它，它将获得变量在执行时的值。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-03-29T16:49:55.013

在幕后，编译器正在为您的方法调用生成一个代表闭包的类。它为循环的每次迭代使用闭包类的单个实例。代码看起来像这样，这样更容易看出错误发生的原因：

```
void Main()
{
    List<Func<int>> actions = new List<Func<int>>();

    int variable = 0;

    var closure = new CompilerGeneratedClosure();

    Func<int> anonymousMethodAction = null;

    while (closure.variable < 5)
    {
        if(anonymousMethodAction == null)
            anonymousMethodAction = new Func<int>(closure.YourAnonymousMethod);

        //we're re-adding the same function 
        actions.Add(anonymousMethodAction);

        ++closure.variable;
    }

    foreach (var act in actions)
    {
        Console.WriteLine(act.Invoke());
    }
}

class CompilerGeneratedClosure
{
    public int variable;

    public int YourAnonymousMethod()
    {
        return this.variable * 2;
    }
} 
```

这实际上不是您示例中的编译代码，但我检查了我自己的代码，这看起来与编译器实际生成的非常相似。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-07T07:33:18.607

解决此问题的方法是将您需要的值存储在代理变量中，并捕获该变量。

IE

```
while( variable < 5 )
{
    int copy = variable;
    actions.Add( () => copy * 2 );
    ++variable;
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2018-06-13T12:21:00.457

# 这与循环无关。

触发此行为是因为您使用了 lambda 表达式`() => variable * 2`，其中外部范围`variable`实际上并未在 lambda 的内部范围中定义。

Lambda 表达式（在 C#3+ 中，以及在 C#2 中的匿名方法）仍然创建实际方法。将变量传递给这些方法会遇到一些难题（按值传递？按引用传递？C# 通过引用进行 - 但这会引发另一个问题，即引用可能比实际变量更有效）。C# 解决所有这些困境的方法是创建一个新的辅助类（“闭包”），其中的字段对应于 lambda 表达式中使用的局部变量，方法对应于实际的 lambda 方法。代码中的任何更改`variable`实际上都会转换为更改`ClosureClass.variable`

因此，您的 while 循环会不断更新 ，`ClosureClass.variable`直到达到 10，然后您的 for 循环将执行所有操作都在相同的`ClosureClass.variable`.

要获得预期的结果，您需要在循环变量和正在关闭的变量之间创建一个分隔符。您可以通过引入另一个变量来做到这一点，即：

```
List<Func<int>> actions = new List<Func<int>>();
int variable = 0;
while (variable < 5)
{
    var t = variable; // now t will be closured (i.e. replaced by a field in the new class)
    actions.Add(() => t * 2);
    ++variable; // changing variable won't affect the closured variable t
}
foreach (var act in actions)
{
    Console.WriteLine(act.Invoke());
} 
```

您还可以将闭包移动到另一种方法来创建这种分离：

```
List<Func<int>> actions = new List<Func<int>>();

int variable = 0;
while (variable < 5)
{
    actions.Add(Mult(variable));
    ++variable;
}

foreach (var act in actions)
{
    Console.WriteLine(act.Invoke());
} 
```

您可以将 Mult 实现为 lambda 表达式（隐式闭包）

```
static Func<int> Mult(int i)
{
    return () => i * 2;
} 
```

或使用实际的助手类：

```
public class Helper
{
    public int _i;
    public Helper(int i)
    {
        _i = i;
    }
    public int Method()
    {
        return _i * 2;
    }
}

static Func<int> Mult(int i)
{
    Helper help = new Helper(i);
    return help.Method;
} 
```

在任何情况下，**“闭包”都不是与循环相关的概念**，而是与使用局部范围变量的匿名方法/ lambda 表达式有关——尽管循环的一些不小心使用证明了闭包陷阱。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-07T07:32:55.470

是的，您需要`variable`在循环内限定范围并以这种方式将其传递给 lambda：

```
List<Func<int>> actions = new List<Func<int>>();

int variable = 0;
while (variable < 5)
{
    int variable1 = variable;
    actions.Add(() => variable1 * 2);
    ++variable;
}

foreach (var act in actions)
{
    Console.WriteLine(act.Invoke());
}

Console.ReadLine(); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-01-28T14:00:53.497

同样的情况也发生在多线程（C# [、.NET](http://en.wikipedia.org/wiki/.NET_Framework) 4.0）中。

请参阅以下代码：

目的是按顺序打印1,2,3,4,5。

```
for (int counter = 1; counter <= 5; counter++)
{
    new Thread (() => Console.Write (counter)).Start();
} 
```

输出很有趣！（可能像 21334...）

唯一的解决方案是使用局部变量。

```
for (int counter = 1; counter <= 5; counter++)
{
    int localVar= counter;
    new Thread (() => Console.Write (localVar)).Start();
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-12-24T14:21:10.133

```
for (int n=0; n < 10; n++) //forloop syntax
foreach (string item in foo) foreach syntax 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2018-12-12T13:52:08.753

它被称为闭包问题，只需使用一个复制变量，就可以了。

```
List<Func<int>> actions = new List<Func<int>>();

int variable = 0;
while (variable < 5)
{
    int i = variable;
    actions.Add(() => i * 2);
    ++ variable;
}

foreach (var act in actions)
{
    Console.WriteLine(act.Invoke());
} 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2020-03-01T10:44:32.900

由于这里没有人直接引用[ECMA-334](https://ecma-international.org/publications/files/ECMA-ST/ECMA-334.pdf)：

> 10.4.4.10 对于语句
> 
> 对形式的 for 语句进行明确的赋值检查：

```
for (for-initializer; for-condition; for-iterator) embedded-statement 
```

> 就像写了语句一样完成：

```
{
    for-initializer;
    while (for-condition) {
        embedded-statement;
    LLoop: for-iterator;
    }
} 
```

进一步在规范中，

> 12.16.6.3 局部变量的实例化
> 
> 当执行进入变量的范围时，局部变量被认为是实例化的。
> 
> [示例：例如，当调用以下方法时，局部变量`x`被实例化和初始化 3 次——循环的每次迭代一次。

```
static void F() {
  for (int i = 0; i < 3; i++) {
    int x = i * 2 + 1;
    ...
  }
} 
```

> 但是，将 的声明移到`x`循环外会导致 的单个实例化`x`：

```
static void F() {
  int x;
  for (int i = 0; i < 3; i++) {
    x = i * 2 + 1;
    ...
  }
} 
```

> 结束示例]
> 
> 如果未捕获，则无法准确观察局部变量被实例化的频率——因为实例化的生命周期是不相交的，每个实例化可以简单地使用相同的存储位置。然而，当一个匿名函数捕获一个局部变量时，实例化的效果就变得很明显了。
> 
> [示例：示例

```
using System;

delegate void D();

class Test{
  static D[] F() {
    D[] result = new D[3];
    for (int i = 0; i < 3; i++) {
      int x = i * 2 + 1;
      result[i] = () => { Console.WriteLine(x); };
    }
  return result;
  }
  static void Main() {
    foreach (D d in F()) d();
  }
} 
```

> 产生输出：

```
1
3
5 
```

> 但是，当 的声明`x`移出循环时：

```
static D[] F() {
  D[] result = new D[3];
  int x;
  for (int i = 0; i < 3; i++) {
    x = i * 2 + 1;
    result[i] = () => { Console.WriteLine(x); };
  }
  return result;
} 
```

> 输出是：

```
5
5
5 
```

> 请注意，允许（但不是必需）编译器将三个实例优化为单个委托实例（第 11.7.2 节）。
> 
> 如果 for 循环声明了一个迭代变量，则该变量本身被认为是在循环之外声明的。[示例：因此，如果更改示例以捕获迭代变量本身：

```
static D[] F() {
  D[] result = new D[3];
  for (int i = 0; i < 3; i++) {
    result[i] = () => { Console.WriteLine(i); };
  }
  return result;
} 
```

> 仅捕获迭代变量的一个实例，这会产生输出：

```
3
3
3 
```

> 结束示例]

哦，是的，我想应该提到的是，在 C++ 中不会发生此问题，因为您可以选择是通过值还是通过引用来捕获变量（请参阅：[Lambda 捕获](https://en.cppreference.com/w/cpp/language/lambda#Lambda_capture)）。

# asp.net-mvc - VS2008上的Asp.net mvc beta安装

> ID：271457
> 
> 赞同：0
> 
> 时间：2008-11-07T07:35:38.397
> 
> 标签：asp.net-mvc, visual-studio-2008, installation

我曾经使用 VWD，现在我尝试在 VS2008 上安装新的 MVC-Beta。

安装成功完成，但是当我尝试创建 MVC 网站时，项目列表中没有它。我该如何解决？

我已经卸载了 VWD 和 MVC preview 5，尝试安装了几次 beta 框架。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-07T09:14:26.453

是否确保您确实从“文件”菜单中选择了“新项目”而不是“新网站”？您必须选择新建项目，否则模板将不会出现。

# c# - C#/.NET 中 OwnerDraw 工具提示上的文本对齐

> ID：271464
> 
> 赞同：0
> 
> 时间：2008-11-07T07:42:31.597
> 
> 标签：c#, tooltip, ownerdrawn, drawstring

我有一个多行文本字符串（例如“Stuff\nMore Stuff\nYet More Stuff”），我想将它与位图一起绘制到工具提示中。由于我正在绘制位图，因此我需要将 OwnerDraw 设置为 true，我正在这样做。我也在处理 Popup 事件，因此我可以将工具提示的大小调整到足以容纳文本和位图的大小。

我正在调用 e.DrawBackground 和 e.DrawBorder()，然后在工具提示区域的左侧绘制我的位图。

是否有一组标志我可以传递给 e.DrawText() 以便左对齐文本，但要偏移它以便它不会被绘制在我的位图上？或者我是否还需要自定义绘制所有文本（这可能涉及在换行符上拆分字符串等）？

更新：最终代码如下所示：

```
private void _ItemTip_Draw(object sender, DrawToolTipEventArgs e)
{
  e.DrawBackground();
  e.DrawBorder();

  // Reserve a square of size e.Bounds.Height x e.Bounds.Height
  // for the image. Keep a margin around it so that it looks good.
  int margin = 2;
  Image i = _ItemTip.Tag as Image;  
  if (i != null)
  {
    int side = e.Bounds.Height - 2 * margin;  
    e.Graphics.DrawImage(i, new Rectangle(margin, margin, side, side));
  }

  // Construct bounding rectangle for text (don't want to paint it over the image).
  int textOffset = e.Bounds.Height + 2 * margin; 
  RectangleF rText = e.Bounds;
  rText.Offset(textOffset, 0);
  rText.Width -= textOffset;

  e.Graphics.DrawString(e.ToolTipText, e.Font, Brushes.Black, rText);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T09:35:15.740

我假设如果您定义要绘制的边界矩形（自己计算图像偏移量），您可以：

```
 RectangleF rect = new RectangleF(100,100,100,100);
     e.Graphics.DrawString(myString, myFont, myBrush, rect); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T09:55:01.613

要计算给定宽度 w 的所有者绘制的字符串 s 的高度，我们使用以下代码：

```
double MeasureStringHeight (Graphics g, string s, Font f, int w) {
    double result = 0;
    int n = s.Length;
    int i = 0;
    while (i < n) {
        StringBuilder line = new StringBuilder();
        int iLineStart = i;
        int iSpace = -1;
        SizeF sLine = new SizeF(0, 0);
        while ((i < n) && (sLine.Width <= w)) {
            char ch = s[i];
            if ((ch == ' ') || (ch == '-')) {
                iSpace = i;
            }
            line.Append(ch);
            sLine = g.MeasureString(line.ToString(), f);
            i++;
        }
        if (sLine.Width > w) {
            if (iSpace >= 0) {
                i = iSpace + 1;
            } else {
                i--;
            }
            // Assert(w > largest ch in line)
        }
        result += sLine.Height;
    }
    return result;
} 
```

问候，坦伯格

# recursion - JSP 标记递归

> ID：271466
> 
> 赞同：10
> 
> 时间：2008-11-07T07:43:46.527
> 
> 标签：recursion, jsp-tags

我正在为我的一个练习项目实现一个树标记，我将在其中以树的形式（递归）显示目录的内容。在 JSP2.0 之前的日子里，我已经实现了与 Java 中的自定义标记类似的要求。处理目录需要递归（处理子目录）！是否可以将其编码为标记文件并且可以以递归方式使用它们？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-07-01T22:07:38.710

这是一个递归标记文件的示例，它从一个节点递归地显示它的所有子节点（用于生成[YUI 树视图](http://developer.yahoo.com/yui/treeview/ "YUI 树视图")）：

*/WEB-INF/tags/nodeTree.tag*：

```
<%@tag description="display the whole nodeTree" pageEncoding="UTF-8"%>
<%@attribute name="node" type="com.myapp.Node" required="true" %>
<%@taglib prefix="template" tagdir="/WEB-INF/tags" %>
<li>${node.name}
<c:if test="${fn:length(node.childs) > 0}">
    <ul>
    <c:forEach var="child" items="${node.childs}">
        <template:nodeTree node="${child}"/>
    </c:forEach>
    </ul>
</c:if>
</li> 
```

这可以在常规 JSP 文件中使用，如下所示：

```
<div id="treeDiv1">
    <ul>
        <c:forEach var="child" items="${actionBean.rootNode.childs}">
            <template:nodeTree node="${child}"/>
        </c:forEach>
    </ul>
</div> 
```

# seo - 搜索引擎机器人如何爬取论坛？

> ID：271467
> 
> 赞同：6
> 
> 时间：2008-11-07T07:45:18.940
> 
> 标签：seo, search-engine

如果我有一个包含大量线程的论坛站点，搜索引擎机器人是否会每次都抓取整个站点？假设我的站点中有超过 1,000,000 个线程，每次机器人抓取我的站点时它们都会被抓取吗？或者它是如何工作的？我希望我的网站被索引，但我不希望机器人杀死我的网站！换句话说，我不希望机器人每次抓取我的网站时都一遍又一遍地抓取旧线程。

另外，之前爬过的页面呢？机器人每次爬取我的网站时都会请求它们以确保它们仍在网站上吗？我问这个是因为我只链接到最新线程，即有一个页面包含所有最新线程的列表，但我没有链接到旧线程，它们必须通过 URL 明确请求，例如 http ://**example.com/showthread.aspx?threadid=7，这是否可以阻止机器人使我的网站停机并消耗我所有的带宽？**

 **PS 该网站仍在开发中，但我想知道以设计该网站，以免搜索引擎机器人将其关闭。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T08:21:05.577

复杂的东西。

根据我的经验，这更多地取决于您使用什么 URL 方案将页面链接在一起，这将决定爬虫是否会爬取哪些页面。

*   大多数引擎爬取整个网站，如果它都与*爬取友好的 URL**正确超链接*，例如使用 URL 重写而不是 topicID=123 查询字符串，并且所有页面都可以轻松链接到主页上的几次点击。

**   另一种情况是分页，如果您有分页，有时机器人只抓取第一页并在找到下一页链接时停止，不断点击同一文档，例如整个网站的一个 index.php。

    *   您不希望机器人意外点击某些执行某些操作的网页，例如链接到“delete.php?topicID=123”的“删除主题”链接，因此大多数爬虫也会检查这些情况。

    *   [SEOmoz](http://www.seomoz.org/tools)的“工具”页面还提供了很多关于一些爬虫工作方式的信息和见解，以及它将提取和咀嚼的信息等。您可以使用这些来确定您的论坛深处的页面，例如一年前的帖子可能会得到爬行与否。

    *   还有一些爬虫可以让你自定义他们的爬取行为……比如[谷歌站点地图](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=40318)。你可以告诉他们抓取和不抓取哪些页面和订单等。我记得 MSN 和雅虎也提供此类服务，但我自己从未尝试过。

    *   您可以通过在网站根目录中提供[robots.txt](http://www.robotstxt.org/)文件来限制抓取机器人，使其不会淹没您的网站。* 

 *基本上，如果您设计您的论坛，使 URL 看起来不会对爬虫有敌意，它会愉快地爬取整个网站。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T08:40:11.143

抓取机器人不会一次抓取您的整个网站，而是每次访问时抓取一些页面。每个站点的爬取频率和每次爬取的页面数量差异很大。

谷歌索引的每个页面都会不时地再次抓取，以确保没有任何变化。

使用站点地图绝对有助于确保搜索引擎索引尽可能多的页面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T19:29:28.973

为了建立在 chakrit 所说的基础上，一些搜索引擎（尤其是谷歌）只会索引只有一个或两个参数的页面。之后，该页面通常会被忽略，可能是因为它被视为过于动态，因此是不可靠的 URL。

最好创建没有参数的 SEO 友好 URL，而是将实现隐藏在 Apache中的[mod_rewrite](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)或Rails中的[路由之类的东西后面。](http://wiki.rubyonrails.org/rails/pages/Routes)（例如[http://domain.com/forum/post/123](http://domain.com/forum/post/123)映射到[http://domain.com/forum/post.php?id=123](http://domain.com/forum/post.php?id=123)）。

Chakrit 还提到了[Google 站点地图](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=40318)。这些对于确保 Google 扫描每个帖子并将其永久保存在索引中很有用。Jeff Atwood 在[Stackoverflow 播客](https://blog.stackoverflow.com/) [24](https://blog.stackoverflow.com/2008/10/podcast-24/)上对此进行了讨论，他在其中解释说，在将每个 Stackoverflow 帖子放入站点地图之前，Google 不会保留所有的 Stackoverflow 帖子。

# ninject - Ninject 示例应用程序？

> ID：271481
> 
> 赞同：52
> 
> 时间：2008-11-07T08:00:01.453
> 
> 标签：ninject

我想开始使用依赖注入和 IOC，我想更多地使用 Ninject。

有没有使用 Ninject 编写的带有源代码的好的应用程序，我可以将其作为参考？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2011-02-22T11:13:01.380

无耻插件：我整理了一个非常基础的教程来开始使用 Ninject。看看[Ninject Mini-Tutorial Part1](http://stefanoricciardi.com/2011/01/21/ninject-mini-tutorial-part-1/)和[Ninject Mini-Tutorial Part2](http://stefanoricciardi.com/2011/02/04/ninject-mini-tutorial-part-2/)。这应该有助于你开始。

在那里你可以在 Github 上找到对源代码的引用。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-12-11T11:50:36.843

Ninject 可用于各种类型的应用程序。它可以是 ASP.NET WebForms 应用程序、ASP.NET MVC 应用程序或其他应用程序。

除了 bryanray 提到的 Ninject “dojo” 演练之外，有关详细的（带有屏幕截图）分步教程（带有要下载的示例应用程序），请查看以下内容。

[http://peakbyte.wordpress.com/2009/09/28/how-to-use-ninject-ioc-with-asp-net-mvc/](http://peakbyte.wordpress.com/2009/09/28/how-to-use-ninject-ioc-with-asp-net-mvc/)

请注意，本教程是在 ASP.NET MVC 2.0 未发布时编写的。需要进行微小的修改才能使其与 ASP.NET MVC 2.0 一起使用，例如获取适当的 Ninject.Framework.MVC.dll

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-06-23T21:58:18.590

还可以查看[DimeCast 中的这些截屏视频](http://www.dimecasts.net/Casts/ByTag/Ninject)。良好的开端。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-20T17:21:06.880

你看过Google Code上[的 ninject-contrib 项目吗？](http://code.google.com/p/ninject-contrib/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-28T03:58:49.310

Ninject“道场”也有一个很好的入门指南。

更新：最初提供的链接不再有效。所有当前文档都可以在 Github wiki 上找到：[http](http://wiki.github.com/ninject/ninject) ://wiki.github.com/ninject/ninject - 谢谢，Martin。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-08-10T14:56:22.730

您可以查看 Rob 的 MVC Starter 站点 MVC 应用程序（MVC2 和 Ninject）：[http://mvcstarter.codeplex.com/](http://mvcstarter.codeplex.com/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-16T18:23:00.647

我会推荐这本书[Pro ASP.NET MVC 3 Framework](https://rads.stackoverflow.com/amzn/click/com/1430234040)。它有一些关于如何实现 Ninject 以及 Moq 和单元测试的优秀示例和解释，采用易于阅读的格式，不会让你觉得自己像个傻瓜。

# c# - 将Datagrid导出到excel asp

> ID：271485
> 
> 赞同：1
> 
> 时间：2008-11-07T08:03:50.853
> 
> 标签：c#, asp.net, datagrid, export-to-excel

将 Datagrid 导出到 excel 的最佳方法是什么？我没有任何将数据网格导出到excel的经验，所以我想知道你们如何将数据网格导出到excel。我读到有很多方法，但我想只做一个简单的导出 excel 到 datagrid 函数。我正在使用 asp.net C#

干杯..

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T08:06:56.853

最简单的方法是简单地将 csv 或 html（特别是 a `<table><tr><td>...</td></tr>...</table>`）写入输出，并通过 content-type 标头简单地假装它是 excel 格式。Excel 将愉快地加载；csv更简单...

这是一个类似的示例（它实际上需要一个 IEnumerable，但它在任何来源（例如 a `DataTable`，循环遍历行）中都是相似的。

```
 public static void WriteCsv(string[] headers, IEnumerable<string[]> data, string filename)
        {
            if (data == null) throw new ArgumentNullException("data");
            if (string.IsNullOrEmpty(filename)) filename = "export.csv";

            HttpResponse resp = System.Web.HttpContext.Current.Response;
            resp.Clear();
            // remove this line if you don't want to prompt the user to save the file
            resp.AddHeader("Content-Disposition", "attachment;filename=" + filename);
            // if not saving, try: "application/ms-excel"
            resp.ContentType = "text/csv";
            string csv = GetCsv(headers, data);
            byte[] buffer = resp.ContentEncoding.GetBytes(csv);
            resp.AddHeader("Content-Length", buffer.Length.ToString());
            resp.BinaryWrite(buffer);
            resp.End();
        }
        static void WriteRow(string[] row, StringBuilder destination)
        {
            if (row == null) return;
            int fields = row.Length;
            for (int i = 0; i < fields; i++)
            {
                string field = row[i];
                if (i > 0)
                {
                    destination.Append(',');
                }
                if (string.IsNullOrEmpty(field)) continue; // empty field

                bool quote = false;
                if (field.Contains("\""))
                {
                    // if contains quotes, then needs quoting and escaping
                    quote = true;
                    field = field.Replace("\"", "\"\"");
                }
                else
                {
                    // commas, line-breaks, and leading-trailing space also require quoting
                    if (field.Contains(",") || field.Contains("\n") || field.Contains("\r")
                        || field.StartsWith(" ") || field.EndsWith(" "))
                    {
                        quote = true;
                    }
                }
                if (quote)
                {
                    destination.Append('\"');
                    destination.Append(field);
                    destination.Append('\"');
                }
                else
                {
                    destination.Append(field);
                }

            }
            destination.AppendLine();
        }
        static string GetCsv(string[] headers, IEnumerable<string[]> data)
        {
            StringBuilder sb = new StringBuilder();
            if (data == null) throw new ArgumentNullException("data");
            WriteRow(headers, sb);
            foreach (string[] row in data)
            {
                WriteRow(row, sb);

            }
            return sb.ToString();
        } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T08:13:22.003

你可以这样做：

```
private void ExportButton_Click(object sender, System.EventArgs e)
{
  Response.Clear();
  Response.Buffer = true;
  Response.ContentType = "application/vnd.ms-excel";
  Response.Charset = "";
  this.EnableViewState = false;
  System.IO.StringWriter oStringWriter = new System.IO.StringWriter();
 System.Web.UI.HtmlTextWriter oHtmlTextWriter = new System.Web.UI.HtmlTextWriter(oStringWriter);
  this.ClearControls(dataGrid);
  dataGrid.RenderControl(oHtmlTextWriter);
  Response.Write(oStringWriter.ToString());
  Response.End();
} 
```

完整的例子[在这里](http://www.c-sharpcorner.com/UploadFile/DipalChoksi/ExportASPNetDataGridToExcel11222005041447AM/ExportASPNetDataGridToExcel.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-29T18:32:23.940

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)可以做到。

[您可以在此处](http://www.spreadsheetgear.com/support/samples/)查看带有 C# 和 VB 源代码的实时 ASP.NET 示例。其中一些示例演示了将 DataSet 或 DataTable 转换为 Excel - 您可以轻松地从 DataGrid 中获取 DataSet 或 DataTable。如果您想自己试用，可以[在此处](https://www.spreadsheetgear.com/downloads/register.aspx)下载免费试用版。

免责声明：我拥有 SpreadsheetGear LLC

# java - 链接语言

> ID：271488
> 
> 赞同：15
> 
> 时间：2008-11-07T08:07:10.190
> 
> 标签：java, c++, python, ruby, perl

我之前问[过一个](https://stackoverflow.com/questions/269417/which-language-should-i-use)关于人工智能原型使用哪种语言的问题。共识似乎是，如果我希望它更快，我需要使用 Java 或 C++ 之类的语言，但 Python / Perl / Ruby 对接口位有好处。

所以，这让我想到了另一个问题。将这些语言连接在一起有多容易？哪种组合效果最好？那么，如果我想要一个 Ruby CGI 类型的程序调用 C++ 或 Java AI 函数，那么容易做到吗？关于我在哪里寻找关于做那种事情的信息的任何指示？或者不同的组合会更好？

我编写 Web 应用程序的主要经验是从 C++ CGI 开始，然后转向 Java servlet（大约 10 年前），然后在远离编程很长一段时间后，我做了一些 PHP。但是我没有用脚本语言编写 Web 应用程序的经验，然后调用编译语言以获得速度关键位。所以欢迎任何建议！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-07T09:46:13.737

[Boost.Python](http://www.boost.org/doc/libs/1_36_0/libs/python/doc/tutorial/doc/html/index.html)提供了一种将 C++ 代码转换为 Python 模块的简单方法。它相当成熟，在我的经验中运作良好。

比如不可避免的Hello World……

```
char const* greet()
{
  return "hello, world";
} 
```

可以通过编写 Boost.Python 包装器向 Python 公开：

```
#include <boost/python.hpp>

BOOST_PYTHON_MODULE(hello_ext)
{
  using namespace boost::python;
  def("greet", greet);
} 
```

就是这样。我们完成了。我们现在可以将其构建为共享库。生成的 DLL 现在对 Python 可见。这是一个示例 Python 会话：

```
>>> import hello_ext
>>> print hello.greet()
hello, world 
```

（示例取自 boost.org）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-07T09:14:32.600

首先，元评论：我强烈建议用高级语言编写整个事情，疯狂地进行分析，并仅在分析表明有必要时进行优化。先优化算法，再优化代码，再考虑引入重铁。当/如果您需要用较低级别的语言重新实现时，拥有最佳算法和干净的代码将使事情变得更容易。

对于 Python，[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython) /C# 可能是最简单的优化路径。

使用 C++ 的 CPython 是可行的，但我发现 C 更容易处理（但作为 C 并不那么容易）。两个可以缓解这种情况的工具是[cython](http://cython.org/) / [pyrex](http://www.cosc.canterbury.ac.nz/greg.ewing/python/Pyrex/)（用于 C）和[shedskin](http://shed-skin.blogspot.com/)（用于 C++）。这些将 Python 编译成 C/C++，从那里你可以毫不费力地访问 C/C++ 库。

我从未使用过 jython，但我听说 jython/Java 优化路径并没有那么糟糕。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-07T10:42:10.910

我同意首先用 Python 等高级语言编码的想法，分析然后实现任何需要在 C/C++ 中加速的代码并将其包装以供高级语言使用。

作为 boost 的替代方案，我想建议[SWIG](http://www.swig.org/ "痛饮")从 C 创建 Python 可调用代码。它使用起来相当轻松，并且将为各种语言编译可调用模块。（Python、Ruby、Java、Lua。仅举几例）来自 C 代码。

包装过程是半自动化的，因此无需在基本 C 代码中添加新功能，从而使工作流程更加顺畅。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-07T15:11:13.987

如果您选择 Perl，则有大量资源可用于连接其他语言。

[内联::C](http://search.cpan.org/dist/Inline/C/C.podI)
[内联::CPP](http://search.cpan.org/dist/Inline-CPP/)
[内联::Java](http://search.cpan.org/dist/Inline-Java/Java.pod)

来自[Inline::C-Cookbook](http://search.cpan.org/dist/Inline/C/C-Cookbook.pod)：

```
use Inline C => <<'END_C';

  void greet() {
    printf("Hello, world\n");
  }
END_C

greet; 
```

* * *

[在 Perl 6 中，使用NativeCall](https://doc.perl6.org/language/nativecall)从本地库代码中导入子程序变得更加容易。

```
use v6.c;

sub c-print ( Str() $s ){
  use NativeCall;

  # restrict the function to inside of this subroutine because printf is
  # vararg based, and we only handle '%s' based inputs here

  # it should be possible to handle more but it requires generating
  # a Signature object based on the format string and then do a
  # nativecast with that Signature, and a pointer to printf

  sub printf ( str, str --> int32 ) is native('libc:6') {}

  printf '%s', $s
}

c-print 'Hello World'; 
```

这只是一个简单的示例，您可以创建一个具有指针表示的类，并让一些方法是您正在使用的库中的 C 代码。（仅当 C 代码的第一个参数是指针时才有效，否则您必须包装它）

如果您需要 Perl 6 子例程/方法名称不同，您可以使用`is symbol`trait 修饰符。

Perl 6 也有内联模块。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-07T14:10:07.760

Perl 有几种使用其他语言的方法。看看[内联::](http://search.cpan.org/perldoc?Inline)**CPAN 上的模块系列。按照这个问题中其他人的建议，我会用一种动态语言（Perl、Python、Ruby 等）编写整个东西，然后优化需要它的部分。使用 Perl 和 Inline::*您可以在 C、C++ 或 Java 中进行优化。或者您可以查看[AI::Prolog](http://search.cpan.org/perldoc?AI::Prolog)，它允许您嵌入 Prolog 以进行 AI/逻辑编程。*

 ** * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-07T08:11:45.503

从脚本开始并从该脚本调用基于编译的语言可能是一种很好的方法，仅用于更高级的需求。

例如，[从 ruby​​ 脚本调用 java](http://www.javaworld.com/javaworld/jw-07-2006/jw-0717-ruby.html)效果很好。

```
require "java"
# The next line exposes Java's String as JString
include_class("java.lang.String") { |pkg, name| "J" + name }
s = JString.new("f") 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-07T08:17:10.280

您可以使用一种高级语言（例如 Python 或 Ruby）构建程序，然后调用以低级语言编译的模块以获得您需要的性能。您可以根据所需的低级语言选择平台。

例如，如果你想为快速的东西做 C++，你可以只使用普通的 Python 或 Ruby 并调用用 C++ 编译的 DLL。如果您想使用 Java，您可以使用 Jython 或 Java 平台上的其他动态语言之一来调用 Java 代码，这比 C++ 路线更容易，因为您有一个通用虚拟机，因此可以直接使用 Java 对象在 Jython 或 JRuby 中。使用 Iron 语言和 C# 在 .Net 平台上也可以完成相同的操作，尽管您似乎对 C++ 和 Java 有更多经验，因此这些将是更好的选择。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-09T15:33:16.237

我有不同的观点，我很幸运地将 C++ 和 Python 集成到一些实时视频图像处理中。

我想说您应该将语言与每个模块的任务相匹配。如果您要响应网络，请用 Python 进行，Python 可以很好地跟上网络流量。UI：Python，人很慢，Python 非常适合在 Mac 上使用 wxPython 或 PyObjC 或 PyGTK 的 UI。如果您正在对大量数据、信号处理或图像处理进行数学运算......使用 C 或 C++ 进行单元测试，然后使用**SWIG**创建与任何更高级别语言的绑定。

我在我的 C++ 中使用了 wxWidgets 中的图像库，它们已经通过 wxPython 暴露给 Python，因此它非常强大和快速。SCONS 是一个构建工具（如 make），它知道如何处理 swig 的 .i 文件。

最顶层可以是 C 或 Python，如果顶层是 C 或 C++，您将拥有更多的控制权并减少打包和部署问题......但是复制 Py2EXE 或 Py2App 给你的东西需要很长时间在 Windows 或 Mac 上（或在 Linux 上冻结。）

享受混合编程的力量！（我称以紧密耦合的方式使用多种语言“混合”，但这只是我的一个怪癖。）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-09T18:18:50.677

如果问题域很难（而 AI 问题通常很困难），那么我会首先选择一种表达能力强或适合该领域的语言，然后再担心加快速度。例如，Ruby 具有元编程原语（能够轻松检查和修改正在运行的程序），这使得实现某些类型的算法变得非常容易/有趣。

如果您以这种方式实现它，然后需要加速它，那么您可以使用基准测试/分析来定位瓶颈并为此链接到编译语言，或者优化算法。以我的经验，最大的性能提升来自于调整算法，而不是来自使用不同的实现语言。

# c# - C# 编程标准中应包含哪些内容？

> ID：271490
> 
> 赞同：2
> 
> 时间：2008-11-07T08:09:55.193
> 
> 标签：c#, coding-style

我的任务是编写我们部门的 C# 编程标准（包括指南）。我应该包括什么样的标准/指南？我已经从网络上的各种标准中获取了一些信息（以及来自 Code Complete 的部分），但我想听听该领域的开发人员的意见。

我已经有了：命名约定 - 常规/变量/类/方法/接口/控件

一般编程实践 - 文档（评论等），[WIP]

OO 编程实践 - 封装，[WIP]

还有什么用处？我不应该包括什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T08:18:36.003

您是否已经建议大家阅读《[类库开发人员的设计指南](http://msdn.microsoft.com/en-us/library/czefa0ke.aspx)》？这涵盖了大部分。除此之外，我想锤击回家：

*   您应该很少创建自己的结构。不要将它们视为轻量级类。
*   结构永远不应该是可变的。
*   字段应该始终是私有的，除了字段类型不可变的只读字段
*   仅当您确定更简单的解决方案太慢时才尝试无锁编程 - 并且有证据！
*   可读性为王
*   注意文化问题 - 特别是阅读 Microsoft 的[字符串处理建议](http://msdn.microsoft.com/en-us/library/ms973919.aspx)

当我想到它们时，我会添加更多...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T08:22:30.613

有关如何处理命名空间、程序集/项目/解决方案命名约定、文件的命名约定.. 项目分组的信息（例如，您的项目和项目是否在同一个文件中？）

*   文件名准则
*   命名空间命名/组织指南
*   设计和架构指南，例如使用接口创建 louse 耦合和使单元测试更容易（例如依赖注入和模拟）
*   关于何时应该重构事物的建议（长方法等）
*   参数的命名和大小写
*   单元测试（如果你使用它）和模拟指南
*   项目分组（例如，您有一个类的通用和非通用实现，它们是按照命名约定放在同一个文件中还是单独的文件中？）
*   如何处理第三方依赖
*   促进使用 FxCop、StyleCop 和其他指标等工具

我脑子里只有几件事

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T08:25:56.970

关于源文件中最大方法长度、最大类大小和最大位置的指南很有用。

此外，您可以设置一些关于缩进和代码布局等的指导方针，但我发现使用 Visual Studio 中的设置更容易做到这一点，然后让您的开发人员为此导入相同的设置文件。这样人们就不必考虑这一点，Visual Studio 会为他们完成工作。

FXCop 和类似的工具也可以自动检查最佳实践。因此，只需让 FXCop 文件可用以检查您关心的所有规则，就可以分发有关该指南的指南。不要在现有的大型代码库中引入大的 FXCop 检查，尽管尝试在一段时间内增加检查，这样人们就不会受到 1000 个 FXCop 错误的打击

简而言之：

尽量保持指南简短，只包括真正重要的事情。使它们易于阅读（您可以将命名约定编写为示例类，例如，在其中使用一些带有文本的额外框突出显示所有规则）并使用工具在可能的地方自动检查，以便开发人员获得轻松和早期的反馈。

# c# - C# 结合 GDI+ 和 OpenGL/DirectX

> ID：271498
> 
> 赞同：2
> 
> 时间：2008-11-07T08:14:03.110
> 
> 标签：c#, winforms, opengl, directx, gdi+

*背景*：我目前在我的 C# 项目中使用自定义控件（基本控件只是绘制自定义外观（使用 gdi+？））。这些控件中的大多数都具有用于不规则形状等的透明段。

*问题*：我希望在一组控件上覆盖一个半透明（不规则形状）面板。目前我将覆盖面板剪辑到所涉及的控件区域。这工作正常，结果看起来不错，但是过程太慢了。

*问题*：有什么方法可以通过混合一点 OpenGL/DirectX 并让视频卡执行所有必要的渲染而不是依赖相当慢的 CPU 来加快渲染过程？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T09:23:28.103

AFAIK 你不能真正混合 GDI+ 和 OpenGL/DX。

如果您的性能变慢并且**绝对确定**它是 GDI+ 中的瓶颈，而不是您的代码中的瓶颈，那么放弃 GDI+ 并用 DX/OGL 替换它*可能*是有意义的。（不过，您必须编写自己的控件，这将是 @$$ 的一大痛点）

或者，对于更简单的方法，试试 WPF/Silverlight！默认情况下它是可定制的和可换肤的，它基于 DX。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T22:19:17.743

看看 WPF 和 Silverlight。你晚上会睡得更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T16:32:10.267

您是否尝试在控件上打开 DoubleBuferring 以查看这是否可以提高性能？

[http://www.codeproject.com/KB/graphics/DoubleBuffering.aspx](http://www.codeproject.com/KB/graphics/DoubleBuffering.aspx)

# odbc - OLEDB 与 ODBC

> ID：271504
> 
> 赞同：21
> 
> 时间：2008-11-07T08:18:06.923
> 
> 标签：odbc, oledb, driver

OLEDB 和 ODBC 有什么区别？我什么时候使用哪个以及如何知道我正在查看的是 OLEDB 驱动程序还是 ODBC 驱动程序？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-07T08:24:33.730

OLEDB 和 ODBC 是两个不同的数据库 API。ODBC 是一个较旧的标准，实际上并不特定于 Windows - 您可以获得基于 Unix 的 ODBC 库。OLEDB 是用于数据库连接的基于 COM 的 API。

如果您使用的数据库不附带本机 OLEDB 驱动程序，则有一个驱动程序用于使用 OLEDB 前端包装 ODBC。IIRC DB2/400 和 Sybase OLEDB 驱动程序（例如）使用这种方法。

Windows 中的 ODBC 管理员只关心 ODBC 驱动程序。ODBC 和 OLEDB 都可以使用格式略有不同的连接字符串。您可以从连接字符串中看出 - [www.connectionstrings.com](http://www.connectionstrings.com)有许多不同数据库驱动程序的连接字符串示例。

编辑：Oracle 为一周中的每一天提供驱动程序技术。

*   Oracle 有一个[本地 OLEDB 驱动程序](http://www.oracle.com/technology/software/tech/windows/ole_db/index.html)，称为“Oracle provider for OLEDB”或类似的驱动程序。如果您使用的是 ADO（非 .Net，它位于 OLEDB 之上），这将是首选驱动程序。

*   他们还有一个[ODBC 驱动程序](http://www.oracle.com/technology/software/tech/windows/odbc/index.html) ，例如，该驱动程序可用于从 Oracle 数据库中提取到 MS-Access 或与不支持 OLEDB 的应用程序或系统一起使用。例如，较旧的 Delphi/Oracle 或 Powerbuilder/Oracle 应用程序可能会使用此驱动程序。

*   Oracle 还有一个称为 [OCI](http://www.orafaq.com/faqoci.htm)的特定于 Oracle 的接口。如果您使用 C 语言编写，这是最快的界面，也可以在非 Windows 平台上工作，但会将您的应用程序与 Oracle 联系起来。动态语言绑定（例如用于 Python 的[cx_Oracle](http://python.net/crew/atuining/cx_Oracle/)）往往是 OCI 的包装器。

*   如果您使用的是 .Net，您可能需要[ODP.Net](http://www.oracle.com/technology/tech/windows/odpnet/index.html)而不是使用 .Net 为 OLEDB 提供的。这是 Oracle 提供的标准 .Net 接口库。

*   Oracle有几个[JDBC 驱动程序](http://www.oracle.com/technology/tech/java/sqlj_jdbc/htdocs/jdbc_faq.htm#02_00)。有一个类型 2 驱动程序是 OCI 的包装器和一个类型 4 驱动程序，它是用 Java 本地编写的，并直接通过网络与服务器通信。如果您使用 Java，则 type-4 驱动程序可能是大多数应用程序的最佳选择（您不必安装完整的 Oracle 客户端），除非您有特殊原因需要 type-2 驱动程序。

# java - 为什么 System.setProperty() 不能在运行时更改类路径？

> ID：271506
> 
> 赞同：16
> 
> 时间：2008-11-07T08:21:01.847
> 
> 标签：java, classpath

我指的是关于以编程方式更改类路径的[问题](https://stackoverflow.com/questions/252893/how-do-you-change-the-classpath-within-java#252905)。

我阅读并发现**System**类下有一些函数作为 getproperties，我们可以在其中检索属性，然后也可以使用 setProperties() 设置它。

然而我得到的答案是它不起作用。我自己没有尝试过，但是，我正在接听电话。

只是为了澄清一下，如果这些 setProperty() 和 getProperty() 方法不能在运行时改变它，为什么会存在这些方法。或者这仅特定于类路径属性？

如果有人能提出一个他们真正有帮助的场景，我将不胜感激？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-07T13:32:16.043

您当然可以在任何时间点设置您想要的任何系统属性。问题是，会有影响吗？对于类路径，答案是否定的。系统类加载器在启动序列的早期初始化。它将类路径复制到自己的数据结构中，并且不再读取类路径属性。更改它不会影响系统中的任何内容。

造成这种情况的原因可能有两个。次要原因是性能。您可能需要构建某种数据结构以快速查找资源，并且每次重新解析类路径可能效率低下。更重要的原因是安全性。您不希望流氓类更改您下面的类路径并加载另一个类的受损版本。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-07-29T08:04:13.543

## 修改类路径

即使您不能使用系统属性设置类路径（因为 JVM 读取系统属性一次：在启动时），您仍然可以通过强制调用类加载器的`addURL`方法来更改类路径。请注意，以下解决方案未考虑当前线程。因此，它可能并非在所有情况下都是准确的。

## 示例解决方案

Sun 网站上以下代码的原始来源已被删除：

```
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;                   

import java.io.File;
import java.io.IOException;

import java.net.URL;
import java.net.URLClassLoader;

/**
 * Allows programs to modify the classpath during runtime.              
 */                                                                     
public class ClassPathUpdater {                                         
  /** Used to find the method signature. */                             
  private static final Class[] PARAMETERS = new Class[]{ URL.class };   

  /** Class containing the private addURL method. */
  private static final Class<?> CLASS_LOADER = URLClassLoader.class;

  /**
   * Adds a new path to the classloader. If the given string points to a file,
   * then that file's parent file (i.e., directory) is used as the
   * directory to add to the classpath. If the given string represents a
   * directory, then the directory is directly added to the classpath.
   *
   * @param s The directory to add to the classpath (or a file, which
   * will relegate to its directory).
   */
  public static void add( String s )
    throws IOException, NoSuchMethodException, IllegalAccessException,
           InvocationTargetException {
    add( new File( s ) );
  }

  /**
   * Adds a new path to the classloader. If the given file object is
   * a file, then its parent file (i.e., directory) is used as the directory
   * to add to the classpath. If the given string represents a directory,
   * then the directory it represents is added.
   *
   * @param f The directory (or enclosing directory if a file) to add to the
   * classpath.
   */
  public static void add( File f )
    throws IOException, NoSuchMethodException, IllegalAccessException,
           InvocationTargetException {
    f = f.isDirectory() ? f : f.getParentFile();
    add( f.toURI().toURL() );
  }

  /**
   * Adds a new path to the classloader. The class must point to a directory,
   * not a file.
   *
   * @param url The path to include when searching the classpath.
   */
  public static void add( URL url )
    throws IOException, NoSuchMethodException, IllegalAccessException,
           InvocationTargetException {
    Method method = CLASS_LOADER.getDeclaredMethod( "addURL", PARAMETERS );
    method.setAccessible( true );
    method.invoke( getClassLoader(), new Object[]{ url } );
  }

  private static URLClassLoader getClassLoader() {
    return (URLClassLoader)ClassLoader.getSystemClassLoader();
  }
} 
```

该链接不再有效： http: [//forums.sun.com/thread.jspa?threadID=300557](http://forums.sun.com/thread.jspa?threadID=300557)

## 示例用法

以下示例将`/home/user/dev/java/app/build/com/package`在运行时添加到类路径：

```
try {
  ClassPathUpdater.add( "/home/user/dev/java/app/build/com/package/Filename.class" );
}
catch( Exception e ) {
  e.printStackTrace();
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-07T08:26:56.970

System.setProperty 可用于在程序开始时设置一些安全或协议处理程序。像：

```
/*
Add the URL handler to the handler property. This informs 
IBMJSSE what URL handler to use to handle the safkeyring 
support. In this case IBMJCE.
*/
System.setProperty("java.protocol.handler.pkgs", "com.ibm.crypto.provider"); 
```

或[使用 SSL](http://talkingcode.co.uk/2008/07/04/java-ssl-and-the-keystore-of-doom/)：

```
System.setProperty("javax.net.ssl.keyStore", context.getRealPath(KEYSTORE));
System.setProperty("javax.net.ssl.keyStorePassword", "password");
System.setProperty("javax.net.ssl.trustStore", context.getRealPath(TRUSTSTORE));
System.setProperty("javax.net.debug", "ssl");
HttpClient httpClient = new HttpClient();
GetMethod httpGet = new GetMethod("https://something.com");
httpClient.executeMethod(httpGet);
return new String(httpGet.getResponseBody()); 
```

但请注意，因为它**会在运行时更改在同一 jvm中运行的*所有***应用程序的环境。
例如，如果一个应用程序需要使用 saxon 运行，而另一个应用程序需要使用 xalan 运行，并且两者都使用 System.setProperty 来设置transformerFactory，那么您将遇到麻烦

正如[Monitored System.setProperty](http://blogs.oracle.com/foo/entry/monitored_system_setproperty)文章中所说，
System.setProperty() 可能是一个邪恶的调用。

*   它是 100% 线程敌对的
*   它包含超全局变量
*   当这些变量在运行时发生神秘变化时，调试起来非常困难

* * *

关于类路径属性，正如[我在上一个问题中所说](https://stackoverflow.com/questions/252893/how-do-you-change-the-classpath-within-java#252967)，它不能作为运行时轻易更改。

特别是 java System property java.class.path 用于在 JRE 实例化时构建链接链接，然后**不再重新读取**。因此，您对属性所做的更改实际上不会对现有虚拟机产生任何影响。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-22T00:55:46.810

还有一种方法可以在运行时更改 java.library.path，为此，只需执行以下操作：

```
System.setProperty( "java.library.path", newPath);
Field fieldSysPath = ClassLoader.class.getDeclaredField("sys_paths");
fieldSysPath.setAccessible(true);
fieldSysPath.set(null, null); // that's the key. 
```

当 ClassLoader 类中的这个私有静态字段设置为 null 时，下次尝试加载本机库时，ClassLoader 将使用 java.library.path 中的新值再次初始化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T13:25:57.663

其基本思想`getProperty()`是可以从 JVM 外部配置程序/代码，使用`java -Dfoo=bar`语法在命令行上传递属性。

由于您可能希望在无法控制命令行的情况下在其他软件组件（例如日志记录组件）中配置某些行为 - 考虑部署在 Servlet 容器中 -`setProperty()`作为以编程方式更改的便捷方式设置，例如，在实例化您的日志记录实用程序之前。

该问题表现出的`classpath`问题是，程序通常只会在首次初始化此类系统属性时仅读取一次。因此，在 JVM 启动后更改类路径不会对您的应用程序本身产生任何影响，因为 JVM 已经初始化，并且在您已经获得 Logger 实例（或其他）之后更改一些日志记录配置，通常也不会产生任何影响.

# .net - 免费的 .NET Windows 控件库？

> ID：271508
> 
> 赞同：5
> 
> 时间：2008-11-07T08:21:12.097
> 
> 标签：.net, winforms

有谁知道任何好的和免费的 .NET Windows 控件库

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T08:39:55.943

我认为[组件工厂](http://www.componentfactory.com/)有一些。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-11T12:44:45.927

市场上最好的组件供应商之一，[Developer Express](http://www.devexpress.com/Products/Free/WebRegistration60/)，有一些很棒的。这些应该让你开始；尽管您通过付费订阅获得的任何其他组件都非常值得。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T08:38:48.647

在[CodePlex](http://www.codeplex.com/Project/ProjectDirectory.aspx?TagName=Controls,Windows%20Forms)上有一些不错的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T21:06:31.290

我真的很喜欢 Ascend.NET。有据可查，优秀的设计师支持，包括源代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T08:27:25.300

Mono [WinForms](http://www.mono-project.com/WinForms)落后于 Microsoft，但包含许多熟悉的控件。如果你准备好尝试不同的东西，Mono 有其他的[Gui ToolKits](http://www.mono-project.com/Gui_Toolkits)。

# fault-tolerance - HP (Tandem) Non stop 与 Linux 集群相比如何？

> ID：271514
> 
> 赞同：4
> 
> 时间：2008-11-07T08:23:52.170
> 
> 标签：fault-tolerance, hp-nonstop, tandem

HP NonStop 系统（以前称为“Tandem”）以其高可用性和可靠性以及更高的价格而闻名。

在这些方面和其他方面，基于 Linux 或 Unix 的集群与它们相比如何？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-07T08:31:57.740

在容错机器上，容错直接在硬件中处理，对应用程序透明。对集群进行编程需要您明确处理应用程序中的容错。

在实践中，集群应用程序架构比为诸如 NonStop 等容错平台构建的应用程序构建起来更加复杂且容易出错。这意味着由应用程序错误驱动的不可靠性的范围要大得多，正如伦敦证券交易所[发现的那样艰难。](http://www.reuters.com/article/ousiv/idUSL01084620080908?sp=true) 他们有一个现有的基于 Tandem 的系统，这是证券交易所交易应用程序的常见架构。他们的新 CEO 有一个聪明的想法，即微软是前进的方向，并让一家 5 大咨询公司构建了一个基于 120 台服务器集群的 .Net 系统。

集群应用程序的问题在于故障可以相互关联。如果系统中存在应用程序或配置错误，通常会在所有节点上复制它。这意味着您可以获得一个可以摧毁整个集群的情况或事件。集群应用程序的额外复杂性使它们在开发和部署时更容易出错，这增加了发生这种情况的几率。构建在（例如）Linux 和 J2EE 上的集群系统容易受到相同类型的故障模式的影响。

恕我直言，这是旧式大型机架构的主要优势。几家供应商（IBM、HP、DEC 以及可能我想不到的其他几家）制造了容错系统。这类系统的底层编程模型比集群的 n 层应用服务器要简单一些。这意味着出错的可能性相对较小，并且只要付出一定的努力，您就可以实现更可靠的系统。数量惊人的旧建筑仍然活跃且良好，并且在其市场利基中过着舒适的生活。IBM 仍然销售大量 Z 和 I 系列机器；Unisys 仍然生产 A 系列和 2200 系列；VMS 和 NonStop 在 HP 中仍然存在。这些系统的销售并非全部面向现有客户——例如，在 ISeries 上运行的商业承保系统 (GENIUS) 仍然是该领域的市场领导者，在我撰写本文时，新的部署正在进行中。我知道，该应用程序已经经历了两次重写它的尝试（Java 中的 1 次和 .Net 中的 1 次），并且“老派”平台似乎并没有真正限制它的风格。

我还不会做空任何屏幕刮板供应商......

Gray & Reuter 的[Transaction Processing: Concepts and Techniques](https://rads.stackoverflow.com/amzn/click/com/1558601902)有点枯燥和学术，但对容错系统架构有很好的处理。其中一位作者是 Tandem 系统设计的关键参与者。

# gwt - 如何在 GWT 中制作看起来像 Outlook 的堆栈面板

> ID：271515
> 
> 赞同：2
> 
> 时间：2008-11-07T08:24:09.907
> 
> 标签：gwt

默认的 GWT StackPanel 不够好，我想拥有类似于 Outlook 堆栈面板的功能。可能有什么东西已经存在了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T01:55:46.537

如果您不介意使用 EXT-GWT，这是一个更漂亮且完全兼容的 GWT UI 工具包，那么这可能是您所寻找的更多。

[示例](http://extjs.com/examples/layouts/accordionlayout.html)。

GXT 也被称为可以为 GUI 做很多好事。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-24T18:46:09.297

我获取了 TabPanel 源代码并对其进行了修改，以便将选项卡绘制成看起来像 Outlook。

# java - Https WebService 消息：消息不包含有效的安全元素

> ID：271518
> 
> 赞同：3
> 
> 时间：2008-11-07T08:25:31.340
> 
> 标签：java, web-services, https, axis

我正在使用轴 2 Web 服务客户端。

对 web 服务的第一次 https 调用会引发异常，并显示以下消息：“消息不包含有效的安全元素”。

我认为问题可能出在安全模式上：也许它必须是消息级别的安全性。在这种情况下，如何在轴上配置它？

编码：

```
System.setProperty("javax.net.ssl.keyStore", jksFile);
System.setProperty("javax.net.ssl.keyStorePassword", jksPassword);

MyServicePortProxy proxy = new MyServicePortProxy();
Stub stub = (Stub) proxy.getMyServicePort();

proxy.setEndpoint(endpoint);
stub.setUsername(username);
stub.setPassword(password);

// throws exception with the above message:
proxy.serviceMethod(...); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T15:13:25.183

在您的 XML 服务定义中，您可能需要创建一个服务策略 - [ [http://schemas.xmlsoap.org/ws/2004/09/policy/]](http://schemas.xmlsoap.org/ws/2004/09/policy/])

看看这些文章：

[http://www.javaranch.com/journal/200603/Journal200603.jsp#a2](http://www.javaranch.com/journal/200603/Journal200603.jsp#a2) [http://www.javaranch.com/journal/200709/web-services-authentication-axis2.html](http://www.javaranch.com/journal/200709/web-services-authentication-axis2.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T15:03:35.843

看看[http://ws.apache.org/wss4j/package.html](http://ws.apache.org/wss4j/package.html)我们必须定义一个 client-config.wsdd 告诉轴包括用户名/密码（如果你使用的是 ws-security）。我对不同的标准以及它们之间的区别有点弱。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T20:43:08.700

注意你的时钟偏差。如果从服务器的角度来看，客户端提供的安全元素中的时间戳离过去或未来太远，它可能会拒绝它并使用此消息。

# c# - 在 C# 和 VB.NET 中自动转换为字符串

> ID：271520
> 
> 赞同：4
> 
> 时间：2008-11-07T08:26:19.637
> 
> 标签：c#, vb.net, casting

我可以在 C# 中做到这一点..

```
int number = 2;
string str = "Hello " + number + " world"; 
```

..str 以“Hello 2 world”结尾。

在 VB.NET 我可以做到这一点..

```
Dim number As Integer = 2
Dim str As String = "Hello " + number + " world" 
```

..但我得到一个 InvalidCastException “从字符串“Hello”到类型“Double”的转换无效。”

我知道在这两种情况下我都应该使用 .ToString() ，但是这里的代码是怎么回事？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-07T08:32:39.110

在 VB 中，我相信字符串连接运算符是 & 而不是 + 所以试试这个：

```
Dim number As Integer = 2
Dim str As String = "Hello " & number & " world" 
```

基本上当 VB 看到 + 我怀疑它尝试进行数字加法或使用类型中定义的加法运算符（或者毫无疑问其他更复杂的事情，基于选项......）请注意，`System.String`没有定义加法运算符 - 它都是隐藏的在编译器中通过调用`String.Concat`. （这允许更有效地连接多个字符串。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-07T08:33:09.157

`+`Visual Basic 对和运算符进行了区分`&`。`&`如果表达式不是字符串，则将转换为字符串。

[`&`运算符 (Visual Basic)](http://msdn.microsoft.com/en-us/library/wfx50zyk.aspx)

操作员使用更复杂的`+`评估逻辑来确定最终转换成什么（例如，它受**Option Strict**配置等因素的影响）

[`+`运算符 (Visual Basic)](http://msdn.microsoft.com/en-us/library/9c5t70w2.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T09:08:23.670

如果可能的话，我建议远离原始字符串连接。

不错的选择是使用 string.format：

```
str = String.Format("Hello {0} workd", Number) 
```

或者使用 System.Text.StringBuilder 类，它在更大的字符串连接上也更有效。

两者都自动将其参数转换为字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T08:33:20.967

VB 加号 (+) 运算符不明确。

如果您没有启用 Option Explicit，如果我没记错的话，可以这样做：

```
Dim str = 1 + "2" 
```

并将 str 设为整数 = 3。

如果您明确需要字符串连接，请使用 & 运算符

```
Dim str = "Hello " & number & " world" 
```

它会很乐意为您将数字转换为字符串。

我认为这种行为是为了向后兼容而保留的。

在 VB 中编程时，始终使用 & 符号来连接字符串。

# java - 无法检查本地声明的变量

> ID：271521
> 
> 赞同：36
> 
> 时间：2008-11-07T08:26:25.690
> 
> 标签：java, eclipse, debugging

有时，当我在 Eclipse 中调试代码时，虽然我可以毫无困难地查看和检查类成员变量，但我无法检查函数中本地声明的变量的值。顺便说一句，当前函数的任何参数都会丢失它们的“真实”名称，而是会在“变量”窗口中看到它们的值，如 arg0、arg1、arg2 等，但至少这些值是可见的。

目前，这与核心 JDK 中定义的类有关。我已验证已安装和当前的 JRE 是 JDK。

有没有人能够阐明这种行为？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-07T08:40:20.903

显然，[答案](http://dev.eclipse.org/newslists/news.eclipse.platform/msg56943.html)是：

> JDK 附带的 rt.jar（核心 Java 类所在的位置）未使用 .class 文件中包含的完整调试信息进行编译，因此调试器没有局部变量信息。
> 
> 不幸的是，这不是 Eclipse 可以做的——所有的调试器都会遇到与 JDK 核心类相同的问题。

[Eclipse 3.4](http://www.eclipse.org/eclipse/development/readme_eclipse_3.4.html)的发行说明指出：

> **缺少调试**
> 属性 如果要能够显示行号和局部变量，调试器要求使用调试属性编译类文件。很多时候，类库（例如，“rt.jar”）在编译时没有完整的调试属性，因此这些类的局部变量和方法参数在调试器中不可见。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-02T17:55:51.723

以前[可以](http://forums.java.net/jive/thread.jspa?messageID=10811&tstart=0)从 http://download.java.net/jdk6/binaries/ 获取 debug rt.jar，但现在不行了。

因此，现在[使用 -g 构建自己的 rt.jar](http://www.javalobby.org/java/forums/t103334.html)似乎是唯一的选择。这非常简单：只需使用 JDK 中的 javac 和 jar 即可。

*   `mkdir \tmp; mkdir \tmp\out`
*   `src.zip`在JDK安装目录中解压到`tmp\src`
*   `cd src`
*   `find -name *.java > files.txt`
*   `javac -verbose -g -d \tmp\out -J-Xmx512m -cp "<jdk>\jre\lib\rt.jar";"<jdk>\lib\tools.jar" @files.txt`
*   `cd \tmp\out; jar cvf rt.jar *`

如果您使用 Eclipse，则不需要 -Xbootclasspath/p:，只需将调试 jar 放入启动配置中 JRE 之前的 Bootstrap Entries。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-12T14:23:58.183

您可以在以下位置找到 1.6.0_25 的调试二进制文件：http: [//download.java.net/jdk6/6u25/promoted/b03/index.html](http://download.java.net/jdk6/6u25/promoted/b03/index.html)

这应该可以让您调试到 1.6 的 Java 库代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-08-13T05:39:56.523

我尝试了链接（[http://www.javaadvent.com/2014/12/recompiling-java-runtime-library-with.html](http://www.javaadvent.com/2014/12/recompiling-java-runtime-library-with.html)），下载了 ant 脚本并对其进行了修改。修改：传入`<compilerarg line="-g" />`javac。它生成了 rt.jar。替换了 JRE 的 rt.jar。（不要忘记保留备份）。

现在我可以在 Eclipse 中调试期间查看、检查 rt.jar 中任何类的局部变量。

# java - 在 Java 中避免 NullPointerException

> ID：271526
> 
> 赞同：4279
> 
> 时间：2008-11-07T08:31:40.203
> 
> 标签：java, nullpointerexception, null

我用`object != null`很多来避免[`NullPointerException`](https://docs.oracle.com/javase/9/docs/api/java/lang/NullPointerException.html)。

什么是替代方案：

```
if (someobject != null) {
    someobject.doCalc();
} 
```

* * *

## 回答 #1

> 赞同：2785
> 
> 时间：2008-11-07T12:06:40.507

对我来说，这听起来像是初级到中级开发人员在某些时候往往会面临的一个相当普遍的问题：他们要么不知道，要么不信任他们参与的合约，并且防御性地过度检查空值。此外，在编写自己的代码时，他们倾向于依靠返回空值来指示某些内容，因此需要调用者检查空值。

换句话说，有两种情况会出现空值检查：

1.  如果 null 是合同条款中的有效响应；和

2.  如果它不是有效的响应。

(2) 容易。使用`assert`语句（断言）或允许失败（例如， [NullPointerException](http://docs.oracle.com/javase/6/docs/api/index.html?java/lang/NullPointerException.html)）。断言是在 1.4 中添加的一个未被充分利用的 Java 特性。语法是：

```
assert <condition> 
```

或者

```
assert <condition> : <object> 
```

where`<condition>`是一个布尔表达式，并且`<object>`是一个对象，其`toString()`方法的输出将包含在错误中。

如果条件不成立，则`assert`语句将抛出`Error`( )。`AssertionError`默认情况下，Java 忽略断言。您可以通过将选项传递`-ea`给 JVM 来启用断言。您可以启用和禁用单个类和包的断言。这意味着您可以在开发和测试时使用断言验证代码，并在生产环境中禁用它们，尽管我的测试显示断言对性能几乎没有影响。

在这种情况下不使用断言是可以的，因为代码只会失败，如果你使用断言就会发生这种情况。唯一的区别是，如果使用断言，它可能会以更有意义的方式发生得更快，并且可能带有额外的信息，这可能会帮助您弄清楚如果您没有预料到它为什么会发生。

(1) 有点难。如果您无法控制所调用的代码，那么您将陷入困境。如果 null 是有效响应，则必须检查它。

但是，如果它是您确实控制的代码（通常是这种情况），那么情况就不同了。避免使用空值作为响应。使用返回集合的方法很容易：几乎总是返回空集合（或数组）而不是空值。

对于非收藏品，可能会更难。以此为例：如果您有这些接口：

```
public interface Action {
  void doSomething();
}

public interface Parser {
  Action findAction(String userInput);
} 
```

Parser 获取原始用户输入并找到要做的事情，也许如果您正在为某事实现命令行界面。现在，如果没有适当的操作，您可能会制定返回 null 的合同。这会导致您正在谈论的空值检查。

另一种解决方案是永远不要返回 null 而是使用[Null Object 模式](https://en.wikipedia.org/wiki/Null_Object_pattern)：

```
public class MyParser implements Parser {
  private static Action DO_NOTHING = new Action() {
    public void doSomething() { /* do nothing */ }
  };

  public Action findAction(String userInput) {
    // ...
    if ( /* we can't find any actions */ ) {
      return DO_NOTHING;
    }
  }
} 
```

比较：

```
Parser parser = ParserFactory.getParser();
if (parser == null) {
  // now what?
  // this would be an example of where null isn't (or shouldn't be) a valid response
}
Action action = parser.findAction(someInput);
if (action == null) {
  // do nothing
} else {
  action.doSomething();
} 
```

到

```
ParserFactory.getParser().findAction(someInput).doSomething(); 
```

这是一个更好的设计，因为它导致更简洁的代码。

也就是说，findAction() 方法抛出一个带有有意义的错误消息的异常可能是完全合适的——尤其是在这种依赖用户输入的情况下。findAction 方法抛出一个异常要比调用方法用一个简单的 NullPointerException 炸毁而没有任何解释要好得多。

```
try {
    ParserFactory.getParser().findAction(someInput).doSomething();
} catch(ActionNotFoundException anfe) {
    userConsole.err(anfe.getMessage());
} 
```

或者，如果您认为 try/catch 机制太丑陋，而不是什么都不做，您的默认操作应该向用户提供反馈。

```
public Action findAction(final String userInput) {
    /* Code to return requested Action if found */
    return new Action() {
        public void doSomething() {
            userConsole.err("Action not found: " + userInput);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：691
> 
> 时间：2010-03-05T10:31:19.393

如果您使用（或计划使用）Java IDE（如[JetBrains IntelliJ IDEA](https://www.jetbrains.com/idea/)、[Eclipse](https://www.eclipse.org/)或[Netbeans](https://netbeans.org/) ）或 findbugs 等工具，则可以使用注释来解决此问题。

基本上，你有`@Nullable`和`@NotNull`。

您可以使用 in 方法和参数，如下所示：

```
@NotNull public static String helloWorld() {
    return "Hello World";
} 
```

或者

```
@Nullable public static String helloWorld() {
    return "Hello World";
} 
```

第二个示例无法编译（在 IntelliJ IDEA 中）。

`helloWorld()`当您在另一段代码中使用第一个函数时：

```
public static void main(String[] args)
{
    String result = helloWorld();
    if(result != null) {
        System.out.println(result);
    }
} 
```

现在 IntelliJ IDEA 编译器会告诉你检查是没有用的，因为`helloWorld()`函数永远不会返回`null`。

使用参数

```
void someMethod(@NotNull someParameter) { } 
```

如果你写这样的东西：

```
someMethod(null); 
```

这不会编译。

最后一个例子使用`@Nullable`

```
@Nullable iWantToDestroyEverything() { return null; } 
```

这样做

```
iWantToDestroyEverything().something(); 
```

你可以确定这不会发生。:)

这是让编译器比通常检查更多内容并强制执行更强大的合同的好方法。不幸的是，并非所有编译器都支持它。

在 IntelliJ IDEA 10.5 及更高版本中，他们添加了对任何其他`@Nullable` `@NotNull`实现的支持。

请参阅博客文章*[更灵活和可配置的@Nullable/@NotNull 注释](https://blog.jetbrains.com/idea/2011/03/more-flexible-and-configurable-nullublenotnull-annotations/)*。

* * *

## 回答 #3

> 赞同：346
> 
> 时间：2008-11-07T09:27:00.250

## 如果不允许空值

如果您的方法是在外部调用的，请从以下内容开始：

```
public void method(Object object) {
  if (object == null) {
    throw new IllegalArgumentException("...");
  } 
```

然后，在该方法的其余部分中，您将知道它`object`不为空。

如果它是一个内部方法（不是 API 的一部分），只需记录它不能为空，仅此而已。

例子：

```
public String getFirst3Chars(String text) {
  return text.subString(0, 3);
} 
```

但是，如果您的方法只是传递值，而下一个方法传递它等等，则可能会出现问题。在这种情况下，您可能需要检查上述参数。

## 如果允许 null

这真的取决于。如果发现我经常这样做：

```
if (object == null) {
  // something
} else {
  // something else
} 
```

所以我分支，做两件完全不同的事情。没有丑陋的代码片段，因为我确实需要根据数据做两件不同的事情。例如，我应该处理输入，还是应该计算一个好的默认值？

* * *

我实际上很少使用成语“ `if (object != null && ...`”。

如果您展示了您通常在哪里使用该成语的示例，那么给您提供示例可能会更容易。

* * *

## 回答 #4

> 赞同：249
> 
> 时间：2009-01-17T05:08:35.463

哇，当我们有 57 种不同的方式来[推荐](http://tech.puredanger.com/java7/#null)`NullObject pattern`.[处理"](http://tech.puredanger.com/java7/#null) — if-not-equal-null 逻辑的简化语法。

Alex Miller 给出的示例如下所示：

```
public String getPostcode(Person person) {  
  return person?.getAddress()?.getPostcode();  
} 
```

该`?.`方法仅在左侧标识符不为空时取消引用，否则将表达式的其余部分评估为`null`. 有些人，比如 Java Posse 的成员 Dick Wall 和[Devoxx 的选民](http://blog.joda.org/2008/12/jdk-7-language-changes-devoxx-votes_3751.html)真的很喜欢这个提议，但也有反对意见，理由是它实际上会鼓励更多地使用`null`作为哨兵价值。

* * *

*更新：* Java 7 中的 null 安全运算符的[官方提案](http://mail.openjdk.java.net/pipermail/coin-dev/2009-March/000047.html)已在[Project Coin 下提交。](http://openjdk.java.net/projects/coin/)语法与上面的示例略有不同，但概念相同。

* * *

*更新：* null-safe 运营商提案没有进入 Project Coin。因此，您不会在 Java 7 中看到这种语法。

* * *

## 回答 #5

> 赞同：207
> 
> 时间：2010-01-14T13:45:06.277

## 如果不允许未定义的值：

您可以配置您的 IDE 以警告您潜在的 null 取消引用。例如，在 Eclipse 中，请参阅*Preferences > Java > Compiler > Errors/Warnings/Null analysis*。

## 如果允许未定义的值：

*如果您想定义一个新的 API，其中未定义的值是有意义*的，请使用[选项模式](http://www.codecommit.com/blog/scala/the-option-pattern)（可能对函数式语言很熟悉）。它具有以下优点：

*   API 中明确说明了输入或输出是否存在。
*   编译器强制您处理“未定义”的情况。
*   [Option 是一个 monad](http://james-iry.blogspot.com/2007/08/martians-vs-monads-null-considered.html)，因此不需要详细的 null 检查，只需使用 map/foreach/getOrElse 或类似的组合器来安全地使用 value [(example)](http://blog.tackley.net/2010/09/option-in-scala-vs-null-in-java.html)。

Java 8 有一个内置[`Optional`](http://docs.oracle.com/javase/8/docs/api/java/util/Optional.html)类（推荐）；对于早期版本，有库替代品，例如[Guava](http://code.google.com/p/guava-libraries/wiki/UsingAndAvoidingNullExplained)或[FunctionalJava](http://code.google.com/p/functionaljava)。但是像许多函数式模式一样，在 Java 中使用 Option（甚至 8 个）会产生相当多的样板文件，您可以使用不太冗长的 JVM 语言（例如 Scala 或 Xtend）来减少这些样板文件。[`Optional`](https://google.github.io/guava/releases/19.0/api/docs/com/google/common/base/Optional.html)[`Option`](http://www.functionaljava.org/javadoc/4.4/functionaljava/fj/data/Option.html)

*如果您必须处理可能返回 null 的 API*，那么您在 Java 中将无能为力。Xtend 和 Groovy 具有[Elvis 运算符](https://www.eclipse.org/xtend/documentation.html#operators) `?:`和[null-safe dereference operator](https://www.eclipse.org/xtend/documentation.html#nullSafeFeatureCalls) `?.`，但请注意，这在 null 引用的情况下返回 null，因此它只是“推迟”对 null 的正确处理。

* * *

## 回答 #6

> 赞同：204
> 
> 时间：2008-11-09T12:24:58.347

只针对这种情况——

在调用 equals 方法之前不检查变量是否为空（下面的字符串比较示例）：

```
if ( foo.equals("bar") ) {
 // ...
} 
```

将导致`NullPointerException`if`foo`不存在。

如果您像这样比较您的 s，您可以避免这种情况`String`：

```
if ( "bar".equals(foo) ) {
 // ...
} 
```

* * *

## 回答 #7

> 赞同：179
> 
> 时间：2013-04-25T15:22:50.317

Java 8 的新`java.util.Optional`类可以说解决了一些问题。至少可以说它提高了代码的可读性，并且在公共 API 的情况下，可以让客户端开发人员更清楚地了解 API 的合同。

他们是这样工作的：

给定类型 ( ) 的可选对象`Fruit`被创建为方法的返回类型。它可以为空或包含`Fruit`对象：

```
public static Optional<Fruit> find(String name, List<Fruit> fruits) {
   for (Fruit fruit : fruits) {
      if (fruit.getName().equals(name)) {
         return Optional.of(fruit);
      }
   }
   return Optional.empty();
} 
```

现在看看这段代码，我们在`Fruit`( `fruits`) 列表中搜索给定的 Fruit 实例：

```
Optional<Fruit> found = find("lemon", fruits);
if (found.isPresent()) {
   Fruit fruit = found.get();
   String name = fruit.getName();
} 
```

您可以使用`map()`运算符对可选对象执行计算或从中提取值。 `orElse()`允许您为缺失值提供后备。

```
String nameOrNull = find("lemon", fruits)
    .map(f -> f.getName())
    .orElse("empty-name"); 
```

当然，检查空值/空值仍然是必要的，但至少开发人员意识到该值可能为空，并且忘记检查的风险是有限的。

在从头开始构建的 API 中，`Optional`只要返回值可能为空，并且仅在不能为空时返回普通对象`null`（约定），客户端代码可能会放弃对简单对象返回值的空检查......

当然`Optional`也可以用作方法参数，在某些情况下可能比 5 或 10 个重载方法更好地指示可选参数。

`Optional`提供其他方便的方法，例如`orElse`允许使用默认值，以及`ifPresent`与[lambda 表达式](https://en.wikipedia.org/wiki/Anonymous_function)一起使用。

我邀请您阅读这篇文章（我编写此答案的主要来源），其中很好地解释`NullPointerException`了（通常是空指针）问题以及带来的（部分）解决方案`Optional`：*[Java Optional Objects](http://java.dzone.com/articles/java-optional-objects)*。

* * *

## 回答 #8

> 赞同：130
> 
> 时间：2008-11-07T09:10:19.657

根据您检查的对象类型，您可以使用 apache commons 中的一些类，例如：[apache commons lang](http://commons.apache.org/lang/)和[apache commons collections](http://commons.apache.org/collections/)

例子：

```
String foo;
...
if( StringUtils.isBlank( foo ) ) {
   ///do something
} 
```

或（取决于您需要检查的内容）：

```
String foo;
...
if( StringUtils.isEmpty( foo ) ) {
   ///do something
} 
```

StringUtils 类只是众多类之一；公共领域中有很多很好的类可以进行空安全操作。

下面是一个示例，说明当您包含 apache 库时如何在 JAVA 中使用空验证（commons-lang-2.4.jar）

```
public DOCUMENT read(String xml, ValidationEventHandler validationEventHandler) {
    Validate.notNull(validationEventHandler,"ValidationHandler not Injected");
    return read(new StringReader(xml), true, validationEventHandler);
} 
```

如果您使用的是 Spring，Spring 在其包中也具有相同的功能，请参见 library(spring-2.4.6.jar)

关于如何使用 spring 中的这个静态类的示例（org.springframework.util.Assert）

```
Assert.notNull(validationEventHandler,"ValidationHandler not Injected"); 
```

* * *

## 回答 #9

> 赞同：102
> 
> 时间：2008-11-07T08:55:26.053

*   如果您认为一个对象不应该为空（或者它是一个错误），请使用断言。
*   如果您的方法不接受空参数，请在 javadoc 中说明并使用断言。

只有当您想处理对象可能为空的情况时，您才必须检查对象！= null...

有人提议在 Java7 中添加新注释以帮助处理 null / notnull 参数： [http ://tech.puredanger.com/java7/#jsr308](http://tech.puredanger.com/java7/#jsr308)

* * *

## 回答 #10

> 赞同：93
> 
> 时间：2011-05-23T18:18:14.057

我是“快速失败”代码的粉丝。问问自己 - 在参数为空的情况下，您是否在做一些有用的事情？如果您对代码在这种情况下应该做什么没有明确的答案......即它不应该首先为空，然后忽略它并允许抛出 NullPointerException。调用代码对 NPE 的意义与对 IllegalArgumentException 的意义一样，但如果抛出 NPE，开发人员将更容易调试和理解出了什么问题，而不是您的代码试图执行一些其他意外的意外事件逻辑 - 最终导致应用程序失败。

* * *

## 回答 #11

> 赞同：81
> 
> 时间：2008-11-07T08:50:24.503

而不是空对象模式——它有它的用途——你可能会考虑空对象是一个错误的情况。

抛出异常时，检查堆栈跟踪并解决错误。

* * *

## 回答 #12

> 赞同：80
> 
> 时间：2008-11-07T09:04:11.573

有时，您有对其参数进行操作的方法，这些参数定义了对称操作：

```
a.f(b); <-> b.f(a); 
```

如果你知道 b 永远不能为空，你可以交换它。它对 equals 最有用：而不是`foo.equals("bar");`better do `"bar".equals(foo);`。

* * *

## 回答 #13

> 赞同：79
> 
> 时间：2008-12-29T13:50:07.533

Google 集合框架提供了一种很好且优雅的方式来实现空值检查。

库类中有一个方法，如下所示：

```
static <T> T checkNotNull(T e) {
   if (e == null) {
      throw new NullPointerException();
   }
   return e;
} 
```

用法是（带`import static`）：

```
...
void foo(int a, Person p) {
   if (checkNotNull(p).getAge() > a) {
      ...
   }
   else {
      ...
   }
}
... 
```

或者在您的示例中：

```
checkNotNull(someobject).doCalc(); 
```

* * *

## 回答 #14

> 赞同：75
> 
> 时间：2011-11-21T12:58:18.847

Null 不是“问题”。它是一个[完整](http://en.wikipedia.org/wiki/Functional_completeness)的建模工具集的一个组成部分。软件旨在模拟世界的复杂性，而 null 则承担着它的负担。Null在 Java 等中**表示“无数据”或“未知” 。**因此，为这些目的使用空值是合适的。我不喜欢“空对象”模式；我认为这引发了“[谁来守护监护人](http://en.wikipedia.org/wiki/Who_will_guard_the_guards%3F)”的问题。
如果你问我女朋友叫什么名字，我会告诉你我没有女朋友。在 Java 语言中，我将返回 null。另一种方法是抛出有意义的异常来指示一些不能（或不要）的问题

1.  **对于“未知问题”，请给出“未知答案”。**（从业务角度来看这是正确的，请确保为空值）在使用之前在方法内检查一次参数是否为 null 可以减轻多个调用者在调用前检查它们的麻烦。

    ```
    public Photo getPhotoOfThePerson(Person person) {
        if (person == null)
            return null;
        // Grabbing some resources or intensive calculation
        // using person object anyhow.
    } 
    ```

    以前导致正常的逻辑流程从我的照片库中获取不存在的女朋友的照片。

    ```
    getPhotoOfThePerson(me.getGirlfriend()) 
    ```

    它适合新的 Java API（期待）

    ```
    getPhotoByName(me.getGirlfriend()?.getName()) 
    ```

    虽然对于某些人来说，不找到存储在数据库中的照片是相当“正常的业务流程”，但我曾经在其他一些情况下使用如下所示的配对

    ```
    public static MyEnum parseMyEnum(String value); // throws IllegalArgumentException
    public static MyEnum parseMyEnumOrNull(String value); 
    ```

    并且不要讨厌输入`<alt> + <shift> + <j>`（在 Eclipse 中生成 javadoc）并为您的公共 API 写三个额外的词。除了那些不阅读文档的人之外，这对于所有人来说已经绰绰有余了。

    ```
    /**
     * @return photo or null
     */ 
    ```

    或者

    ```
    /**
     * @return photo, never null
     */ 
    ```

2.  **这是相当理论上的情况，在大多数情况下，您应该更喜欢 java null 安全 API（以防它会在另外 10 年内发布），但`NullPointerException`它是`Exception`.** 因此，它是一种`Throwable`表示合理应用程序可能想要捕获的条件的形式（[javadoc](http://javasourcecode.org/html/open-source/jdk/jdk-6u23/java/lang/Exception.html)）！要使用异常的第一个最大优势并将错误处理代码与“常规”代码分开（[根据 Java 的创建者](http://docs.oracle.com/javase/tutorial/essential/exceptions/advantages.html)），对我来说，catch 是合适的`NullPointerException`。

    ```
    public Photo getGirlfriendPhoto() {
        try {
            return appContext.getPhotoDataSource().getPhotoByName(me.getGirlfriend().getName());
        } catch (NullPointerException e) {
            return null;
        }
    } 
    ```

    可能会出现以下问题：

    问：如果`getPhotoDataSource()`返回 null 怎么办？
    A. 这取决于业务逻辑。如果我找不到相册，我不会给你看照片。如果 appContext 没有初始化怎么办？该方法的业务逻辑支持这一点。如果相同的逻辑应该更严格，那么抛出异常是业务逻辑的一部分，应该使用显式检查 null （案例 3）。新的**Java Null-safe API 更适合这里有选择地指定什么暗示和不暗示**在程序员错误的情况下被初始化为快速失败。

    Q. 可以执行冗余代码并且可以获取不必要的资源。
    A. 如果`getPhotoByName()`尝试打开数据库连接，`PreparedStatement`最后创建并使用人名作为 SQL 参数，可能会发生这种情况。未知问题的方法*给出了一个未知的答案*（案例 1）在这里有效。在获取资源之前，该方法应检查参数并在需要时返回“未知”结果。

    问：由于 try 闭包打开，这种方法会降低性能。
    A. 软件首先应该易于理解和修改。只有在此之后，才可以考虑性能，并且仅在需要时才考虑！和需要的地方！（[来源](http://www.amazon.co.uk/Code-Complete-Practical-Handbook-Construction/dp/0735619670/ref=dp_ob_title_bk)），以及许多其他）。

    PS。这种方法使用起来与在某些地方使用*与“常规”代码原则分开的错误处理代码一样合理。*考虑下一个例子：

    ```
    public SomeValue calculateSomeValueUsingSophisticatedLogic(Predicate predicate) {
        try {
            Result1 result1 = performSomeCalculation(predicate);
            Result2 result2 = performSomeOtherCalculation(result1.getSomeProperty());
            Result3 result3 = performThirdCalculation(result2.getSomeProperty());
            Result4 result4 = performLastCalculation(result3.getSomeProperty());
            return result4.getSomeProperty();
        } catch (NullPointerException e) {
            return null;
        }
    }

    public SomeValue calculateSomeValueUsingSophisticatedLogic(Predicate predicate) {
        SomeValue result = null;
        if (predicate != null) {
            Result1 result1 = performSomeCalculation(predicate);
            if (result1 != null && result1.getSomeProperty() != null) {
                Result2 result2 = performSomeOtherCalculation(result1.getSomeProperty());
                if (result2 != null && result2.getSomeProperty() != null) {
                    Result3 result3 = performThirdCalculation(result2.getSomeProperty());
                    if (result3 != null && result3.getSomeProperty() != null) {
                        Result4 result4 = performLastCalculation(result3.getSomeProperty());
                        if (result4 != null) {
                            result = result4.getSomeProperty();
                        }
                    }
                }
            }
        }
        return result;
    } 
    ```

    聚苯乙烯。对于那些快速投反对票（而且阅读文档不那么快）的人，我想说我一生中从未遇到过空指针异常（NPE）。但是这种可能性是Java 创建者**有意设计**的，因为 NPE 是`Exception`. 我们在 Java 历史上有一个先例，`ThreadDeath`它`Error`不是因为它实际上是一个应用程序错误，而仅仅是因为它不打算被捕获！多少 NPE 适合成为一个`Error`比`ThreadDeath`！但事实并非如此。

3.  **仅当业务逻辑暗示它时才检查“无数据”。**

    ```
    public void updatePersonPhoneNumber(Long personId, String phoneNumber) {
        if (personId == null)
            return;
        DataSource dataSource = appContext.getStuffDataSource();
        Person person = dataSource.getPersonById(personId);
        if (person != null) {
            person.setPhoneNumber(phoneNumber);
            dataSource.updatePerson(person);
        } else {
            Person = new Person(personId);
            person.setPhoneNumber(phoneNumber);
            dataSource.insertPerson(person);
        }
    } 
    ```

    和

    ```
    public void updatePersonPhoneNumber(Long personId, String phoneNumber) {
        if (personId == null)
            return;
        DataSource dataSource = appContext.getStuffDataSource();
        Person person = dataSource.getPersonById(personId);
        if (person == null)
            throw new SomeReasonableUserException("What are you thinking about ???");
        person.setPhoneNumber(phoneNumber);
        dataSource.updatePerson(person);
    } 
    ```

    如果 appContext 或 dataSource 未初始化，未处理的运行时 NullPointerException 将杀死当前线程并由[Thread.defaultUncaughtExceptionHandler](https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.UncaughtExceptionHandler.html)处理（供您定义和使用您喜欢的记录器或其他通知机制）。如果未设置，[ThreadGroup#uncaughtException](https://docs.oracle.com/javase/7/docs/api/java/lang/ThreadGroup.html#uncaughtException(java.lang.Thread,%20java.lang.Throwable))会将堆栈跟踪打印到系统错误。应该监视应用程序错误日志并为每个未处理的异常打开 Jira 问题，这实际上是应用程序错误。程序员应该在初始化东西的某个地方修复错误。

* * *

## 回答 #15

> 赞同：71
> 
> 时间：2012-08-10T07:08:00.533

Java 7 有一个新的`java.util.Objects`实用程序类，其中有一个`requireNonNull()`方法。如果它的参数为空，所有这些都会抛出一个`NullPointerException`，但它会稍微清理一下代码。例子：

```
Objects.requireNonNull(someObject);
someObject.doCalc(); 
```

* * *

该方法对于在构造函数中的赋值之前[检查](https://stackoverflow.com/questions/3322638/is-it-okay-to-throw-nullpointerexception-programatically)最有用，每次使用它都可以节省三行代码：

```
Parent(Child child) {
   if (child == null) {
      throw new NullPointerException("child");
   }
   this.child = child;
} 
```

变成

```
Parent(Child child) {
   this.child = Objects.requireNonNull(child, "child");
} 
```

* * *

## 回答 #16

> 赞同：52
> 
> 时间：2009-07-29T20:52:38.367

最终，完全解决这个问题的唯一方法是使用不同的编程语言：

*   在 Objective-C 中，你可以做相当于在 上调用方法`nil`，并且绝对不会发生任何事情。这使得大多数空检查变得不必要，但它会使错误更难诊断。
*   在Java 派生语言[Nice](http://nice.sourceforge.net/safety.html#id2487946)中，所有类型都有两个版本：潜在空版本和非空版本。您只能在非空类型上调用方法。通过显式检查 null 可以将可能为 null 的类型转换为非 null 类型。这使得更容易知道哪些地方需要空检查，哪些地方不需要。

* * *

## 回答 #17

> 赞同：39
> 
> 时间：2011-03-15T12:42:25.210

确实是 Java 中常见的“问题”。

首先，我对此的看法：

我认为在 NULL 不是有效值的情况下传递 NULL 时“吃”一些东西是不好的。如果您没有以某种错误退出该方法，那么这意味着您的方法没有出错，这是不正确的。然后你可能在这种情况下返回 null，并且在接收方法中你再次检查 null，它永远不会结束，你最终会得到“if！= null”等等。

因此，恕我直言，null 必须是一个严重错误，它会阻止进一步执行（也就是说，null 不是有效值）。

我解决这个问题的方法是这样的：

首先，我遵循这个约定：

1.  所有公共方法/API 始终检查其参数是否为空
2.  所有私有方法都不会检查 null，因为它们是受控方法（如果上面没有处理，就让 nullpointer 异常死掉）
3.  唯一不检查 null 的其他方法是实用程序方法。它们是公开的，但是如果你出于某种原因调用它们，你就会知道你传递了什么参数。这就像试图在不提供水的情况下在水壶中煮水......

最后，在代码中，公共方法的第一行是这样的：

```
ValidationUtils.getNullValidator().addParam(plans, "plans").addParam(persons, "persons").validate(); 
```

注意addParam()返回self，这样可以添加更多参数进行检查。

如果任何参数为空，方法`validate()`将抛出已检查（选中或未选中更多是设计/品味问题，但我已选中）。`ValidationException``ValidationException`

```
void validate() throws ValidationException; 
```

例如，如果“plans”为空，则消息将包含以下文本：

"**参数 [plans] 遇到非法参数值 null** "

如您所见，用户消息需要 addParam() 方法中的第二个值（字符串），因为您无法轻松检测传入的变量名称，即使使用反射（无论如何都不是本文的主题......）。

是的，我们知道，在这一行之外，我们将不再遇到空值，因此我们只需安全地调用这些对象上的方法。

这样，代码干净、易于维护和可读。

* * *

## 回答 #18

> 赞同：38
> 
> 时间：2008-11-07T09:27:17.813

问这个问题表明您可能对错误处理策略感兴趣。如何以及在何处处理错误是一个普遍存在的架构问题。有几种方法可以做到这一点。

我最喜欢的是：允许异常泛滥——在“主循环”或其他具有适当职责的函数中捕获它们。检查错误情况并适当地处理它们可以被视为一项专门的责任。

当然也可以看看 Aspect Oriented Programming - 他们有巧妙的方法插入`if( o == null ) handleNull()`你的字节码。

* * *

## 回答 #19

> 赞同：37
> 
> 时间：2010-08-17T03:59:45.513

除了使用之外，`assert`您还可以使用以下内容：

```
if (someobject == null) {
    // Handle null here then move on.
} 
```

这略好于：

```
if (someobject != null) {
    .....
    .....

    .....
} 
```

* * *

## 回答 #20

> 赞同：36
> 
> 时间：2012-10-18T03:42:36.160

只是永远不要使用空值。不允许。

在我的类中，大多数字段和局部变量都具有非空默认值，并且我在代码中的任何地方都添加了合同声明（始终开启断言）以确保执行此操作（因为它比让它更简洁、更具表现力）作为 NPE 出现，然后必须解析行号等）。

一旦我采用了这种做法，我注意到问题似乎会自行解决。您会在开发过程中更早地发现一些东西，并意识到您有一个弱点......更重要的是......它有助于封装不同模块的关注点，不同的模块可以相互“信任”，并且不再乱扔垃圾带有`if = null else`构造的代码！

这是防御性编程，从长远来看会产生更清晰的代码。始终清理数据，例如在这里通过执行严格的标准，问题就会消失。

```
class C {
    private final MyType mustBeSet;
    public C(MyType mything) {
       mustBeSet=Contract.notNull(mything);
    }
   private String name = "<unknown>";
   public void setName(String s) {
      name = Contract.notNull(s);
   }
}

class Contract {
    public static <T> T notNull(T t) { if (t == null) { throw new ContractException("argument must be non-null"); return t; }
} 
```

合约就像迷你单元测试，即使在生产中也一直在运行，当事情失败时，你知道为什么，而不是你必须以某种方式弄清楚的随机 NPE。

* * *

## 回答 #21

> 赞同：31
> 
> 时间：2012-03-23T20:16:39.240

Guava 是谷歌非常有用的核心库，它有一个很好用的 API 来避免空值。我发现[UsingAndAvoidingNullExplained](http://code.google.com/p/guava-libraries/wiki/UsingAndAvoidingNullExplained)非常有帮助。

正如维基中解释的那样：

> `Optional<T>`是一种用非空值替换可为空的 T 引用的方法。Optional 可能包含非空 T 引用（在这种情况下，我们说引用是“存在的”），或者它可能不包含任何内容（在这种情况下，我们说引用是“不存在的”）。从来没有说它“包含空值”。

用法：

```
Optional<Integer> possible = Optional.of(5);
possible.isPresent(); // returns true
possible.get(); // returns 5 
```

* * *

## 回答 #22

> 赞同：27
> 
> 时间：2015-04-27T04:16:49.873

对于每个 Java 开发人员来说，这是一个非常常见的问题。因此，Java 8 中有官方支持来解决这些问题，而不会产生混乱的代码。

Java 8 引入了`java.util.Optional<T>`. 它是一个容器，可能包含也可能不包含非空值。Java 8 提供了一种更安全的方法来处理在某些情况下值可能为 null 的对象。它的灵感来自[Haskell](http://en.wikipedia.org/wiki/Haskell_%28programming_language%29)和[Scala](http://en.wikipedia.org/wiki/Scala_%28programming_language%29)的思想。

简而言之，Optional 类包括显式处理值存在或不存在的情况的方法。但是，与空引用相比的优势在于 Optional<T> 类迫使您考虑值不存在时的情况。因此，您可以防止意外的空指针异常。

在上面的例子中，我们有一个家庭服务工厂，它返回一个句柄到家中可用的多个电器。但这些服务可能可用也可能不可用/功能；这意味着它可能会导致 NullPointerException。与其`if`在使用任何服务之前添加空条件，不如将其包装到 Optional<Service> 中。

包装到选项<T>

让我们考虑一种从工厂获取服务引用的方法。与其返回服务引用，不如用 Optional 包装它。它让 API 用户知道返回的服务可能或可能不可用/功能，防御性使用

```
public Optional<Service> getRefrigertorControl() {
      Service s = new  RefrigeratorService();
       //...
      return Optional.ofNullable(s);
   } 
```

如您所见`Optional.ofNullable()`，它提供了一种简单的方法来包装引用。还有另一种方法可以获取 Optional 的引用，无论是`Optional.empty()`& `Optional.of()`。一个用于返回一个空对象而不是重新调整 null，另一个用于分别包装一个不可为空的对象。

那么它究竟如何帮助避免空检查？

一旦你包装了一个引用对象，Optional 提供了许多有用的方法来在没有 NPE 的情况下调用包装的引用上的方法。

```
Optional ref = homeServices.getRefrigertorControl();
ref.ifPresent(HomeServices::switchItOn); 
```

Optional.ifPresent 如果给定的 Consumer 是非空值，则使用引用调用给定的 Consumer。否则，它什么也不做。

```
@FunctionalInterface
public interface Consumer<T> 
```

表示接受单个输入参数且不返回结果的操作。与大多数其他功能接口不同，消费者预计将通过副作用进行操作。它是如此干净且易于理解。在上面的代码示例中，`HomeService.switchOn(Service)`如果 Optional 持有引用为非空，则调用。

我们经常使用三元运算符来检查空条件并返回替代值或默认值。Optional 提供了另一种处理相同条件而不检查 null 的方法。如果 Optional 具有空值，则 Optional.orElse(defaultObj) 返回 defaultObj。让我们在示例代码中使用它：

```
public static Optional<HomeServices> get() {
    service = Optional.of(service.orElse(new HomeServices()));
    return service;
} 
```

现在 HomeServices.get() 做同样的事情，但以更好的方式。它检查服务是否已经初始化。如果是则返回相同或创建一个新的新服务。Optional<T>.orElse(T) 有助于返回默认值。

最后，这是我们的 NPE 以及 null 无检查代码：

```
import java.util.Optional;
public class HomeServices {
    private static final int NOW = 0;
    private static Optional<HomeServices> service;

public static Optional<HomeServices> get() {
    service = Optional.of(service.orElse(new HomeServices()));
    return service;
}

public Optional<Service> getRefrigertorControl() {
    Service s = new  RefrigeratorService();
    //...
    return Optional.ofNullable(s);
}

public static void main(String[] args) {
    /* Get Home Services handle */
    Optional<HomeServices> homeServices = HomeServices.get();
    if(homeServices != null) {
        Optional<Service> refrigertorControl = homeServices.get().getRefrigertorControl();
        refrigertorControl.ifPresent(HomeServices::switchItOn);
    }
}

public static void switchItOn(Service s){
         //...
    }
} 
```

完整的帖子是*[NPE 以及 Null 免检查代码……真的吗？](http://ydtech.blogspot.in/2015/04/npe-as-well-as-null-check-free-code.html)*.

* * *

## 回答 #23

> 赞同：24
> 
> 时间：2011-08-21T18:33:43.130

我喜欢 Nat Pryce 的文章。以下是链接：

*   [使用多态调度避免空值](http://www.natpryce.com/articles/000778.html)
*   [用“告诉，不要问”的方式避免空值](http://www.natpryce.com/articles/000777.html)

在文章中，还有一个指向 Java Maybe 类型的 Git 存储库的链接，我觉得这很有趣，但我认为单独使用它并不能减少检查代码的膨胀。在网上做了一些研究后，我认为**!= null**代码膨胀主要可以通过精心设计来减少。

* * *

## 回答 #24

> 赞同：22
> 
> 时间：2008-11-13T22:08:04.167

我试过了，`NullObjectPattern`但对我来说并不总是最好的方法。有时“不采取行动”是不合适的。

`NullPointerException`是一个*运行时异常*，这意味着它是开发人员的错误，并且有足够的经验它会告诉您错误的确切位置。

现在回答：

尽量使您的所有属性及其访问器尽可能私有，或者完全避免将它们暴露给客户端。当然，您可以在构造函数中包含参数值，但是通过缩小范围，您不会让客户端类传递无效值。如果您需要修改这些值，您可以随时创建一个新的`object`. 您只检查构造函数中的值**一次**，在其余方法中，您几乎可以确定这些值不为空。

当然，经验是理解和应用这个建议的更好方法。

字节！

* * *

## 回答 #25

> 赞同：21
> 
> 时间：2016-03-23T00:03:43.357

Java 8 或更新版本的最佳替代方案可能是使用[`Optional`](https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html)该类。

```
Optional stringToUse = Optional.of("optional is there");
stringToUse.ifPresent(System.out::println); 
```

这对于可能的空值的长链特别方便。例子：

```
Optional<Integer> i = Optional.ofNullable(wsObject.getFoo())
    .map(f -> f.getBar())
    .map(b -> b.getBaz())
    .map(b -> b.getInt()); 
```

关于如何在 null 上引发异常的示例：

```
Optional optionalCarNull = Optional.ofNullable(someNull);
optionalCarNull.orElseThrow(IllegalStateException::new); 
```

Java 7 引入了[`Objects.requireNonNull`](https://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#requireNonNull(T,%20java.lang.String))一种方法，当需要检查某些内容是否为非空时，该方法可以派上用场。例子：

```
String lowerVal = Objects.requireNonNull(someVar, "input cannot be null or empty").toLowerCase(); 
```

* * *

## 回答 #26

> 赞同：17
> 
> 时间：2014-02-12T11:41:36.560

我可以更笼统地回答它！

当方法以我们不期望的方式获取参数时，我们**通常会遇到这个问题（错误的方法调用是程序员的错）。**例如：你期望得到一个对象，而不是你得到一个空值。你期望得到一个至少有一个字符的字符串，而不是你得到一个空字符串......

所以没有区别：

```
if(object == null){
   //you called my method badly! 
```

}

或者

```
if(str.length() == 0){
   //you called my method badly again!
} 
```

在我们执行任何其他功能之前，他们都想确保我们收到了有效的参数。

如其他一些答案中所述，为避免上述问题，您可以遵循**按合同设计**模式。请参阅[http://en.wikipedia.org/wiki/Design_by_contract](http://en.wikipedia.org/wiki/Design_by_contract)。

要在 java 中实现此模式，您可以使用**javax.annotation.NotNull 之**类的核心 java 注释，或者使用**Hibernate Validator**等更复杂的库。

只是一个样本：

```
getCustomerAccounts(@NotEmpty String customerId,@Size(min = 1) String accountType) 
```

现在您可以安全地开发方法的核心功能，而无需检查输入参数，它们可以保护您的方法免受意外参数的影响。

您可以更进一步，确保在您的应用程序中只能创建有效的 pojo。（来自休眠验证器站点的示例）

```
public class Car {

   @NotNull
   private String manufacturer;

   @NotNull
   @Size(min = 2, max = 14)
   private String licensePlate;

   @Min(2)
   private int seatCount;

   // ...
} 
```

* * *

## 回答 #27

> 赞同：17
> 
> 时间：2014-04-12T13:27:57.620

我高度无视建议在每种情况下都使用空对象的答案。这种模式可能会破坏合同，将问题埋得越来越深，而不是解决问题，更不用说使用不当会产生另一堆需要未来维护的样板代码。

实际上，如果从方法返回的某些内容可以为 null 并且调用代码必须对此做出决定，则应该有一个更早的调用来确保状态。

还要记住，如果不小心使用，空对象模式会占用大量内存。为此 - NullObject 的实例应该在所有者之间共享，而不是每个所有者的唯一实例。

此外，我不建议在类型是原始类型表示的情况下使用这种模式——比如数学实体，它们不是标量：向量、矩阵、复数和 POD（普通旧数据）对象，它们旨在保持状态以 Java 内置类型的形式。在后一种情况下，您最终会调用具有任意结果的 getter 方法。例如 NullPerson.getName() 方法应该返回什么？

为了避免荒谬的结果，值得考虑这种情况。

* * *

## 回答 #28

> 赞同：16
> 
> 时间：2013-06-14T13:05:31.063

1.  永远不要将变量初始化为 null。
2.  如果 (1) 不可行，请将所有集合和数组初始化为空集合/数组。

在您自己的代码中执行此操作，您可以避免 != null 检查。

大多数时候，空值检查似乎可以保护集合或数组上的循环，因此只需将它们初始化为空，就不需要任何空值检查。

```
// Bad
ArrayList<String> lemmings;
String[] names;

void checkLemmings() {
    if (lemmings != null) for(lemming: lemmings) {
        // do something
    }
}

// Good
ArrayList<String> lemmings = new ArrayList<String>();
String[] names = {};

void checkLemmings() {
    for(lemming: lemmings) {
        // do something
    }
} 
```

这有一点点开销，但对于更简洁的代码和更少的 NullPointerExceptions，这是值得的。

* * *

## 回答 #29

> 赞同：15
> 
> 时间：2014-04-11T20:14:20.343

这是大多数开发人员最常见的错误。

我们有很多方法来处理这个问题。

**方法一：**

```
org.apache.commons.lang.Validate //using apache framework 
```

notNull（对象对象，字符串消息）

**方法二：**

```
if(someObject!=null){ // simply checking against null
} 
```

**方法3：**

```
@isNull @Nullable  // using annotation based validation 
```

**方法4：**

```
// by writing static method and calling it across whereever we needed to check the validation

static <T> T isNull(someObject e){  
   if(e == null){
      throw new NullPointerException();
   }
   return e;
} 
```

* * *

## 回答 #30

> 赞同：12
> 
> 时间：2017-10-09T10:35:33.260

**Java 8 在 java.util 包中引入了一个新类 Optional。**

**Java 8 可选的优点：**

1.) 不需要空值检查。
2.) 在运行时不再有 NullPointerException。
3.) 我们可以开发干净整洁的 API。

**可选**- 可能包含或不包含非空值的容器对象。如果存在值，isPresent() 将返回 true，而 get() 将返回该值。

有关更多详细信息，请在此处找到 oracle 文档：- [https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html](https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html)

* * *

## 回答 #31

> 赞同：12
> 
> 时间：2017-11-14T11:57:24.770

总而言之，避免声明

```
if (object != null) {
    ....
} 
```

1.  从 java 7 开始，您可以使用`Objects`以下方法：

    Objects.isNull(对象)

    Objects.nonNull(对象)

    Objects.requireNonNull(对象)

    Objects.equals(object1, object2)

2.  从 java 8 开始，您可以使用 Optional 类（[何时使用](https://stackoverflow.com/questions/23454952/uses-for-optional)）

`object.ifPresent(obj -> ...);`爪哇 8

`object.ifPresentOrElse(obj -> ..., () -> ...);`爪哇9

3.  依靠方法契约 ( [JSR 305](https://minds.coremedia.com/2012/10/31/jsr-305-nonnull-and-guava-preconditions/) ) 并使用[Find Bugs](http://findbugs.sourceforge.net/)。用注释`@javax.annotation.Nullable`和`@javax.annotation.Nonnnul`. 也有先决条件。

    Preconditions.checkNotNull(object);

4.  在特殊情况下（例如对于字符串和集合），您可以使用 apache-commons（或 Google guava）实用程序方法：

> public static boolean isEmpty(CharSequence cs) //apache CollectionUtils
> 
> public static boolean isEmpty(Collection coll) //apache StringUtils
> 
> public static boolean isEmpty(Map map) //apache MapUtils
> 
> public static boolean isNullOrEmpty(@Nullable String string) //番石榴字符串

5.  当您需要在 null 使用 apache commons lang 时分配默认值

> public static Object defaultIfNull(Object object, Object defaultValue)

* * *

## 回答 #32

> 赞同：11
> 
> 时间：2010-10-13T15:14:44.503

```
public static <T> T ifNull(T toCheck, T ifNull) {
    if (toCheck == null) {
           return ifNull;
    }
    return toCheck;
} 
```

* * *

## 回答 #33

> 赞同：8
> 
> 时间：2011-03-10T22:00:54.277

您可以使用[FindBugs](http://findbugs.sourceforge.net)。他们还有一个[Eclipse](http://en.wikipedia.org/wiki/Eclipse_%28software%29)插件），可以帮助您找到重复的空检查（除其他外），但请记住，有时您应该选择防御性编程。还有[Java 的合同](http://code.google.com/p/cofoja/)可能会有所帮助。

* * *

## 回答 #34

> 赞同：8
> 
> 时间：2016-01-25T15:42:16.137

我遵循以下准则以避免空检查。

1.  尽量避免成员变量的***惰性初始化。***在声明本身中初始化变量。这将处理 NullPointerExceptions。

2.  在周期的早期决定成员变量的***可变性。***`final`有效地使用关键字等语言结构。

3.  如果您知道不会更改方法的增强，请将它们声明为`final`.

4.  尽可能限制数据的***变异。***有些变量可以在构造函数中创建并且永远不能更改。***除非确实需要，否则删除公共 setter 方法***。

    例如，假设您的应用程序中的一个类 ( `A.java`) 正在维护一个集合，例如`HashMap`. 不要`public`在 A.java 中提供 getter 方法，允许`B.java`直接在 .java 中添加元素`Map`。而是提供一个 API `A.java`，它将一个元素添加到集合中。

    ```
    // Avoid
    a.getMap().put(key,value)

    //recommended

    public void addElement(Object key, Object value){
           // Have null checks for both key and value here : single place
           map.put(key,value);
    } 
    ```

5.  最后，`try{} catch{} finally{}`在正确的地方有效地使用积木。

* * *

## 回答 #35

> 赞同：8
> 
> 时间：2018-07-12T17:35:17.980

您可以通过遵循该问题的大多数其他答案来避免`NullPointerException`大多数情况，我只想添加一些**已经引入的方法 `Java 9`**来优雅地处理这种情况，并展示一些较旧的方法也可以是使用，从而减少你的努力。

1.  `public static boolean isNull(Object obj)`

    如果提供的引用为 null，则返回 true，否则返回 false。

    从 Java 1.8 开始

2.  `public static boolean nonNull(Object obj)`

    如果提供的引用为非 null，则返回 true，否则返回 false。

    从 Java 1.8 开始

3.  `public static <T> T requireNonNullElse​(T obj, T defaultObj)`

    如果它是非空的，则返回第一个参数，否则返回非空的第二个参数。

    从 Java 9 开始

4.  `public static <T> T requireNonNullElseGet​(T obj, Supplier<? extends T> supplier)`

    如果第一个参数非空，则返回第一个参数，否则返回供应商.get() 的非空值。

    从 Java 9 开始

5.  `public static <T> T requireNonNull​(T obj, Supplier<String> messageSupplier)`

    检查指定的对象引用是否不为空，否则抛出自定义的 NullPointerException。

    从 Java 1.8 开始

有关上述功能的更多详细信息，请参见[此处](https://docs.oracle.com/javase/9/docs/api/java/util/Objects.html#isNull-java.lang.Object-)。

* * *

## 回答 #36

> 赞同：7
> 
> 时间：2016-11-28T09:29:50.917

由于`Java 7`类`java.util.Objects`存在。

但是`Java 8`，您可以使用`Objects.isNull(var)`和类的`Objects.nonNull(var)`方法`Objects`来进行空指针检查。

例如，

```
String var1 = null;
Date var2 = null;
Long var3 = null;

if(Objects.isNull(var1) && Objects.isNull(var2) && Objects.isNull(var3))
    System.out.println("All Null");
else if (Objects.nonNull(var1) && Objects.nonNull(var2) && Objects.nonNull(var3))
    System.out.println("All Not Null"); 
```

* * *

## 回答 #37

> 赞同：7
> 
> 时间：2017-07-04T09:41:26.430

如果您使用的是 java8 或更高版本，请选择`isNull(yourObject)`from `java.util.Objects`。

例子：-

```
String myObject = null;

Objects.isNull(myObject); //will return true 
```

用法：下面的代码返回一个非空值（如果名称不为空，则返回该值，否则返回默认值）。

```
final String name = "Jobin";
String nonNullValue = Optional.ofNullable(name).filter(Objects::nonNull).orElse("DefaultName"); 
```

* * *

## 回答 #38

> 赞同：7
> 
> 时间：2019-06-11T12:39:56.207

Java 8 在`java.util`包中引入了一个新类 Optional。它用于表示一个值存在或不存在。这个新结构的主要优点是没有太多的空检查和`NullPointerException`. 它避免了任何运行时`NullPointerExceptions`，并支持我们开发干净整洁的 Java API 或应用程序。和`Collections`and一样`arrays`，它也是一个最多容纳一个值的 Container。

以下是一些您可以关注的有用链接

[https://www.mkyong.com/java8/java-8-optional-in-depth/](https://www.mkyong.com/java8/java-8-optional-in-depth/)

[https://dzone.com/articles/java-8-optional-avoid-null-and](https://dzone.com/articles/java-8-optional-avoid-null-and)

* * *

## 回答 #39

> 赞同：6
> 
> 时间：2008-11-07T10:43:47.677

无论您在何处传递数组或向量，都将它们初始化为空，而不是 null。- 这样你可以避免大量检查 null 并且一切都很好:)

```
public class NonNullThing {

   Vector vectorField = new Vector();

   int[] arrayField = new int[0];

   public NonNullThing() {

      // etc

   }

} 
```

* * *

## 回答 #40

> 赞同：6
> 
> 时间：2011-10-21T09:02:37.010

另一种选择：

下面的简单函数有助于隐藏空检查（我不知道为什么，但我没有发现它是同一个*公共*库的一部分）：

```
public static <T> boolean isNull(T argument) {
    return (argument == null);
} 
```

你现在可以写

```
if (!isNull(someobject)) {
    someobject.doCalc();
} 
```

这是 IMO 一种更好的表达方式`!= null`。

* * *

## 回答 #41

> 赞同：6
> 
> 时间：2014-03-05T22:44:01.493

我发现 Guava Preconditions 在这种情况下非常有用。我不喜欢将空值留给空指针异常，因为了解 NPE 的唯一方法是定位行号。生产版本和开发版本中的行号可以不同。

使用 Guava Preconditions，我可以检查空参数并在一行中定义有意义的异常消息。

例如，

```
Preconditions.checkNotNull(paramVal, "Method foo received null paramVal"); 
```

* * *

## 回答 #42

> 赞同：5
> 
> 时间：2016-07-05T15:24:21.573

在 Java 8 中，您可以将 type`T`用于 local-variable/field/method-argument/method-return-type 如果它从未分配`null`（并且不检查`null`）或 type`Optional<T>`如果它可以是`null`。然后使用 method `map`for processing`T ->`和 method `flatMap`for processing `T -> Optional<R>`：

```
class SomeService {
    @Inject
    private CompanyDao companyDao;

    // return Optional<String>
    public Optional<String> selectCeoCityByCompanyId0(int companyId) {
        return companyDao.selectById(companyId)
                .map(Company::getCeo)
                .flatMap(Person::getHomeAddress)
                .flatMap(Address::getCity);
    }

    // return String + default value
    public String selectCeoCityByCompanyId1(int companyId) {
        return companyDao.selectById(companyId)
                .map(Company::getCeo)
                .flatMap(Person::getHomeAddress)
                .flatMap(Address::getCity)
                .orElse("UNKNOWN");
    }

    // return String + exception
    public String selectCeoCityByCompanyId2(int companyId) throws NoSuchElementException {
        return companyDao.selectById(companyId)
                .map(Company::getCeo)
                .flatMap(Person::getHomeAddress)
                .flatMap(Address::getCity)
                .orElseThrow(NoSuchElementException::new);
    }
}

interface CompanyDao {
    // real situation: no company for such id -> use Optional<Company> 
    Optional<Company> selectById(int id);
}

class Company {
    // company always has ceo -> use Person 
    Person ceo;
    public Person getCeo() {return ceo;}
}

class Person {
    // person always has name -> use String
    String firstName;
    // person can be without address -> use Optional<Address>
    Optional<Address> homeAddress = Optional.empty();

    public String getFirstName() {return firstName;}   
    public Optional<Address> getHomeAddress() {return homeAddress;}
}

class Address {
    //  address always contains country -> use String
    String country;
    //  city field is optional -> use Optional<String>
    Optional<String> city = Optional.empty();

    String getCountry() {return country;}    
    Optional<String> getCity() {return city;}
} 
```

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2012-12-03T03:15:23.840

您可以在方法调用之前使用拦截器。这就是[面向方面的编程](https://en.wikipedia.org/wiki/Aspect-oriented_programming)所关注的。

假设 M1(Object test) 是一个方法，而 M2 是我们在方法调用之前应用方面的方法，`M2(Object test2)`...... 如果`test2 != null`然后调用M1，否则做另一件事。它适用于您要为其应用方面的所有方法。如果要为实例字段和构造函数应用方面，可以使用[AspectJ](https://en.wikipedia.org/wiki/AspectJ)。[Spring](http://en.wikipedia.org/wiki/Spring_Framework)也可以是方法方面的最佳选择。

* * *

## 回答 #44

> 赞同：4
> 
> 时间：2019-05-15T09:14:00.267

!= null 检查的另一种替代方法是（如果您无法在设计上摆脱它）：

```
Optional.ofNullable(someobject).ifPresent(someobject -> someobject.doCalc()); 
```

或者

```
Optional.ofNullable(someobject).ifPresent(SomeClass::doCalc); 
```

SomeClass 是某个对象的类型。

但是，您无法从 doCalc() 获取返回值，因此仅对 void 方法有用。

* * *

## 回答 #45

> 赞同：3
> 
> 时间：2012-03-23T20:31:43.973

您还可以使用 Checker Framework（JDK 7 及更高版本）静态检查空值。这可能会解决很多问题，但需要运行一个目前仅适用于 OpenJDK AFAIK 的额外工具。[https://checkerframework.org/](https://checkerframework.org/)

* * *

## 回答 #46

> 赞同：3
> 
> 时间：2012-07-13T21:46:16.470

好的，我现在已经在技术上回答了一百万次，但我必须这么说，因为这是与 Java 程序员的无休止的讨论。

对不起，但我几乎不同意以上所有内容。我们必须在 Java 中测试 null 的原因是因为 Java 程序员必须不知道如何处理内存。

我这样说是因为我有长期的 C++ 编程经验，而我们不这样做。换句话说，你不需要。请注意，在 Java 中，如果你碰到一个悬空指针，你会得到一个正常的异常；在 C++ 中，此异常通常不会被捕获并终止程序。

不想这样做？然后遵循一些简单的规则 ala C/C++。

不要轻易地实例化事物，*认为*每一个“新”都会给你带来很多麻烦，并遵循这些简单的规则。

一个类只能以 3 种方式访问​​内存 ->

1.  它可以“拥有”类成员，他们将遵循以下规则：

    1.  所有“HAS”成员都是在构造函数中创建的“新”。
    2.  您将在 Java 中的析构函数或等效的 close() 函数中为同一个类关闭 /de allocate ，而不是其他类。

这意味着您需要记住（就像 Java 一样）每个资源的所有者或父级，并尊重该所有权。一个对象只会被创建它的类删除。还有->

2.  一些成员将被“使用”但不拥有或“拥有”。这是另一个类中的“OWN”，并作为参数传递给构造函数。由于这些属于另一个类，我们永远不会删除或关闭它，只有父类可以。

3.  类中的方法还可以实例化本地对象以供内部使用，这些对象永远不会从类中传递出去，或者它们应该是普通的“拥有”对象。

最后，要使所有这些工作，您需要有一个规范的设计，其中包含层次形式的类并且不产生循环。

在这种设计下，并遵循上述规则，层次设计中的子类永远不会访问被销毁的指针，因为这意味着父类在子类之前被销毁，而层次化非循环设计不会允许它。

最后，还请记住，在启动系统时，您应该从上到下构建层次结构并从下到上破坏。你永远不会在任何地方都有一个空指针，或者有人违反了规则。

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2015-12-16T05:54:05.260

Java 8 现在有 Optional 类来包装考虑中的对象，如果存在值，isPresent() 将返回 true，而 get() 将返回该值。

[http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html](http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html)

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2018-02-07T19:00:18.787

使用 Java 8，您可以将供应商传递给如下所示的辅助方法，

```
if(CommonUtil.resolve(()-> a.b().c()).isPresent()) {

} 
```

上面替换了样板代码，如下所示，

```
if(a!=null && a.b()!=null && a.b().c()!=null) {

} 
```

//CommonUtil.java

```
 public static <T> Optional<T> resolve(Supplier<T> resolver) {
        try {
            T result = resolver.get();
            return Optional.ofNullable(result);
        } catch (NullPointerException var2) {
            return Optional.empty();
        }
    } 
```

* * *

## 回答 #49

> 赞同：3
> 
> 时间：2020-11-09T07:30:09.023

```
public class Null {

public static void main(String[] args) {
    String str1 = null;
    String str2 = "";

    if(isNullOrEmpty(str1))
        System.out.println("First string is null or empty.");
    else
        System.out.println("First string is not null or empty.");

    if(isNullOrEmpty(str2))
        System.out.println("Second string is null or empty.");
    else
        System.out.println("Second string is not null or empty.");
}

public static boolean isNullOrEmpty(String str) {
    if(str != null && !str.isEmpty())
        return false;
    return true;
}
} 
```

输出

```
str1 is null or empty.
str2 is null or empty. 
```

在上面的程序中，我们有两个字符串 str1 和 str2。str1 包含空值，str2 是空字符串。

我们还创建了一个函数 isNullOrEmpty()，顾名思义，它检查字符串是空还是空。它使用 != null 和字符串的 isEmpty() 方法使用 null 检查来检查它。

简单来说，如果一个字符串不是 null 并且 isEmpty() 返回 false，那么它既不是 null 也不是空的。否则，它是。

但是，如果字符串仅包含空白字符（空格），则上述程序不会返回空。从技术上讲，isEmpty() 认为它包含空格并返回 false。对于带空格的字符串，我们使用字符串方法 trim() 来修剪所有前导和尾随空白字符。

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2013-01-10T07:45:59.320

首先，我们不能真正删除所有空条件。我们可以使用`@NotNull`和`@Nullable`注释来减少它们（**如前所述**）。但这需要一些框架的支持。这就是[OVal](http://oval.sourceforge.net)可以提供帮助的地方。

基本思想是对象/参数/构造函数应始终满足先决条件。您可以有很多先决条件，例如`Nullable`,`NotNull`并且 OVal 会注意对象在调用时应该处于一致状态。

我猜 OVal 在内部使用 AspectJ 来验证先决条件。

```
@Guarded
public class BusinessObject
{
  public BusinessObject(@NotNull String name)
  {
    this.name = name;
  }

  ...
} 
```

例如，

```
// Throws a ConstraintsViolatedException because parameter name is null
BusinessObject bo = new BusinessObject(null); 
```

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2014-01-27T20:54:30.387

避免不必要的方法`null-checks`很简单：

`You need to know which variables can be null, and which cannot, and you need to be confident about which category a given variable fall into.`

但是，尽管可以说得足够简单，但实现它却更难。关键就在这`confident`部分，因为你怎么能确定一个变量不能为空呢？

没有快速修复，简单的答案，但这里有一些提示：

1.  干净的代码。能够推理一段代码的行为的最重要的事情是它是以易于理解的方式编写的。根据变量所代表的内容命名变量，以它们所做的命名方法，应用`Single responsibility principle`（`S`在`SOLID`：[http://en.wikipedia.org/wiki/SOLID_(object-orientated_design)](http://en.wikipedia.org/wiki/SOLID_(object-oriented_design))中，这意味着每段代码都应该有一个单一的责任，只做这个而不是别的）。一旦你的代码是干净的，就更容易推理它，也可以跨多个代码层/层。对于凌乱的代码，试图理解一个方法的作用可能会让你忘记你为什么要首先阅读这个方法。（提示：阅读 Robert C. Martin 的“清洁代码”）

2.  避免返回`null`值。如果某个`null`值会使您的程序无法正常运行，请`exception`改为抛出一个（确保添加适当的错误处理。）返回`null`值可能是可接受的情况，例如尝试从数据库中获取对象。在这些情况下，编写处理这些`null`值的代码，并在耳后记下我们有一些可能返回的东西`null`。`null`尽可能接近返回方法的调用者处理返回值`null`（不要盲目地将其传递回调用链。）

3.  永远不要将显式`null`值作为参数传递（至少不能跨类传递）。如果您曾经处于传递`null`-parameter 是唯一选择的位置，那么创建一个没有此参数的新方法是可行的方法。

4.  验证您的输入！确定应用程序的“入口点”。它们可以是 web 服务、REST 服务、远程 EJB 类、控制器等。对于这些入口点中的每个方法，问问自己：“如果这个参数为空，这个方法会正确执行吗？” 如果答案是否定的，则添加`Validate.notNull(someParam, "Can't function when someParam is null!");`。`IllegalArgumentException`如果缺少所需的参数，这将抛出一个。这种类型的入口点验证的好处是，您可以轻松地在从入口点执行的代码中假设该变量永远不会为空！此外，如果这失败了，在入口点，调试会比你刚刚得到一个`NullPointerException`在你的代码深处，因为这样的失败只能意味着一件事：客户端没有向你发送所有必需的信息。在大多数情况下，您想要验证所有输入参数，如果您发现自己处于需要允许大量`null`-values 的位置，这可能是接口设计不良的标志，需要重构/添加以适应需求客户。

5.  使用`Collection`s 时，返回一个空而不是 null！

6.  使用数据库时，请使用`not null`-constraints。这样，您将知道从数据库读取的值不能为空，并且您不必检查它。

7.  构建你的代码并坚持下去。这样做可以让您对代码的行为做出假设，例如，如果应用程序的所有输入都经过验证，那么您可以假设这些值永远不会为空。

8.  如果您还没有这样做，请为您的代码编写自动化测试。通过编写测试，您将对您的代码进行推理，并且您也会更加确信它可以完成它应该做的事情。此外，自动化测试通过让您立即知道这段代码没有像以前那样做，从而防止您在重构过程中出现错误。

当然，您仍然必须进行空值检查，但它可以减少到最低限度（即*知道*您可能会获得空值的情况，而不是为了确定而无处不在。）当涉及到空值检查时，我实际上更喜欢使用三元运算符（但要小心使用，当你开始嵌套它们时，它们会变得非常混乱。）

```
public String nullSafeToString(final Object o) {
    return o != null ? o.toString() : "null";
} 
```

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2020-10-21T02:23:33.447

有一种从 JDK 检查空值的好方法。Optional.java 有很多方法可以解决这些问题。如以下：

```
 /**
     * Returns an {@code Optional} describing the specified value, if non-null,
     * otherwise returns an empty {@code Optional}.
     *
     * @param <T> the class of the value
     * @param value the possibly-null value to describe
     * @return an {@code Optional} with a present value if the specified value
     * is non-null, otherwise an empty {@code Optional}
     */
    public static <T> Optional<T> ofNullable(T value) {
        return value == null ? empty() : of(value);
    } 
```

```
 /**
     * Return {@code true} if there is a value present, otherwise {@code false}.
     *
     * @return {@code true} if there is a value present, otherwise {@code false}
     */
    public boolean isPresent() {
        return value != null;
    } 
```

```
 /**
     * If a value is present, invoke the specified consumer with the value,
     * otherwise do nothing.
     *
     * @param consumer block to be executed if a value is present
     * @throws NullPointerException if value is present and {@code consumer} is
     * null
     */
    public void ifPresent(Consumer<? super T> consumer) {
        if (value != null)
            consumer.accept(value);
    } 
```

帮助javer真的非常有用。

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2012-09-12T14:54:01.960

我更喜欢这个

```
public void simpleFunc(SomeObject someObject){
    someObject = someObject != null ? someObject : new SomeObject(null);
    someObject.doSomething();
} 
```

当然，在我的示例中 SomeObject 可以优雅地处理空参数。例如记录此类事件并且什么都不做。

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2013-10-31T19:18:24.977

我们一直在使用 Apache 库（Apache Commons）来解决这个问题。

```
ObjectUtils.equals(object, null) 
```

或者

```
CollectionUtils.isEmpty(myCollection); 
```

或者

```
StringUtils.isEmpty("string"); 
```

作为一种实践，我喜欢之前的答案，即为集合提供初始默认值或空集以最大限度地减少需求。

这些可以是简单的用途，使您避免出现 NullPointerException 或使用空集合。这并没有回答如何处理 null 对象的问题，但这些提供了对对象或集合的基本验证的一些检查。

希望这可以帮助。

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2015-11-17T17:37:37.150

可以使用 Java 8 lambda 以几乎漂亮的方式定义处理嵌套空检查的 util 方法。

```
void example() {
    Entry entry = new Entry();
    // This is the same as H-MANs solution 
    Person person = getNullsafe(entry, e -> e.getPerson());    
    // Get object in several steps
    String givenName = getNullsafe(entry, e -> e.getPerson(), p -> p.getName(), n -> n.getGivenName());
    // Call void methods
    doNullsafe(entry, e -> e.getPerson(), p -> p.getName(), n -> n.nameIt());        
}

/** Return result of call to f1 with o1 if it is non-null, otherwise return null. */
public static <R, T1> R getNullsafe(T1 o1, Function<T1, R> f1) {
    if (o1 != null) return f1.apply(o1);
    return null; 
}

public static <R, T0, T1> R getNullsafe(T0 o0, Function<T0, T1> f1, Function<T1, R> f2) {
    return getNullsafe(getNullsafe(o0, f1), f2);
}

public static <R, T0, T1, T2> R getNullsafe(T0 o0, Function<T0, T1> f1, Function<T1, T2> f2, Function<T2, R> f3) {
    return getNullsafe(getNullsafe(o0, f1, f2), f3);
}

/** Call consumer f1 with o1 if it is non-null, otherwise do nothing. */
public static <T1> void doNullsafe(T1 o1, Consumer<T1> f1) {
    if (o1 != null) f1.accept(o1);
}

public static <T0, T1> void doNullsafe(T0 o0, Function<T0, T1> f1, Consumer<T1> f2) {
    doNullsafe(getNullsafe(o0, f1), f2);
}

public static <T0, T1, T2> void doNullsafe(T0 o0, Function<T0, T1> f1, Function<T1, T2> f2, Consumer<T2> f3) {
    doNullsafe(getNullsafe(o0, f1, f2), f3);
}

class Entry {
    Person getPerson() { return null; }
}

class Person {
    Name getName() { return null; }
}

class Name {
    void nameIt() {}
    String getGivenName() { return null; }
} 
```

*^(（这个答案首先发布[在这里](https://stackoverflow.com/questions/4390141/java-operator-for-checking-null-what-is-it-not-ternary/33711967#33711967)。）)*

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2017-12-27T04:35:17.313

您拥有的一种选择

*   在方法上使用[检查器框架](https://checkerframework.org/api/org/checkerframework/checker/nullness/qual/RequiresNonNull.html)的 @RequiresNonNull 。例如，如果您调用一个带有这样注释的方法，并且带有一个空参数，那么您会得到这个。它会在编译期间失败，甚至在你的代码运行之前！因为在运行时它将是 NullPointerException

    ```
    @RequiresNonNull(value = { "#1" })
    static void check( Boolean x) {
        if (x) System.out.println("true");
        else System.out.println("false");
    }

    public static void main(String[] args) {

        check(null);

    } 
    ```

得到

```
[ERROR] found   : null
[ERROR] required: @Initialized @NonNull Boolean
[ERROR] -> [Help 1] 
```

还有其他方法，例如使用 Java 8 的 Optional、Guava Annotations、Null Object 模式等。只要您获得避免 !=null 的目标就没有关系

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2021-11-15T11:33:19.853

`Objects.isNull(null)` 如果您使用的是 Java8，那么您可以尝试此代码。

> 如果您不使用 Java8，请尝试使用以下代码

```
Object ob=null;
if(ob==null){ **do something} 
```

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2010-05-20T13:16:47.257

对于实用程序类，您可以检查参数是否不为空。

在所有其他情况下，您可能不必这样做。尽可能使用封装，从而减少您想要检查 null 的地方。

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2015-10-19T14:00:36.850

您可以使用 JUnit 之类的框架将您的类与单元测试结合起来。这样您的代码将是干净的（没有无用的检查），并且您将确保您的实例不会为空。

这是（许多）使用单元测试的一个很好的理由。

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2018-08-20T22:05:53.487

[具有 null 安全性的Kotlin](https://kotlinlang.org)是优雅的替代方案，但这意味着更大的变化。

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2019-01-03T06:21:26.727

函数式方法可能有助于包装重复的空检查并执行匿名代码，如下例所示。

```
 BiConsumer<Object, Consumer<Object>> consumeIfPresent  = (s,f) ->{
        if(s!=null) {
            f.accept(s);
        }
    };

    consumeIfPresent.accept(null, (s)-> System.out.println(s) );
    consumeIfPresent.accept("test", (s)-> System.out.println(s));

    BiFunction<Object, Function<Object,Object>,Object> executeIfPresent  = (a,b) ->{
        if(a!=null) {
            return b.apply(a);
        }
        return null;
    };
    executeIfPresent.apply(null, (s)-> {System.out.println(s);return s;} );
    executeIfPresent.apply("test", (s)-> {System.out.println(s);return s;} ); 
```

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2020-08-09T10:12:28.283

您可以为对象和字符串创建一个通用方法，以便您可以在您的应用程序中使用它 - 这可以帮助您和您的同事：创建一个类，例如。StringUtilities 并添加方法，例如。获取空字符串

```
public static String getNullString(Object someobject)
{
   if(null==someobject )
        return null;

   else if(someobject.getClass().isInstance("") && 
          (((String)someobject).trim().equalsIgnoreCase("null")|| 
          ((String)someobject).trim().equalsIgnoreCase("")))
        return null;

   else if(someobject.getClass().isInstance(""))
        return (String)someobject;

   else
        return someobject.toString().trim();
} 
```

只需将此方法称为，

```
if (StringUtilities.getNullString(someobject) != null)
{ 
  //Do something
} 
```

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2020-10-20T02:56:43.380

在 Java 中避免 Null 检查的最佳方法是正确处理和使用异常。根据我的经验，当您靠近前端时，空检查变得更加普遍和需要，因为它更靠近可能通过 UI 提供无效信息的用户（例如，没有值，正在为某个字段提交）。

有人可能会争辩说，您应该能够控制 UI 正在做什么，以免忘记大多数 UI 是通过某种第三方库完成的，例如，对于空白文本框，它可能返回 NULL 或空字符串，视情况或图书馆而定。

您可以像这样将两者结合起来：

```
try
{
  myvar = get_user_supplied_value(); 
  if (myvar == null || myvar.length() == 0) { alert_the_user_somehow(); return; };

  process_user_input(myvar);
} catch (Exception ex) {
  handle_exception(ex);
} 
```

人们采取的另一种方法是说：

```
if (myvar && myvar.length() > 0)  { }; 
```

你也可以抛出一个异常（这是我更喜欢的）

```
if (myvar == null || myvar.length() == 0) {
 throw new Exception("You must supply a name!");
}; 
```

但这取决于你。

* * *

## 回答 #64

> 赞同：-1
> 
> 时间：2016-10-04T08:57:46.360

空对象模式可以用来解决这个问题。为此，应该修改 someObject 的类。

```
public abstract class SomeObject {
   public abstract boolean isNil();
}

public class NullObject extends SomeObject {
   @Override
   public boolean isNil() {
      return true;
   }
}
public class RealObject extends SomeObject {
   @Override
   public boolean isNil() {
      return false;
   }
} 
```

现在不是检查，

```
 if (someobject != null) {
    someobject.doCalc();
} 
```

我们可以用，

```
if (!someObject.isNil()) {
   someobject.doCalc();
} 
```

参考：[https ://www.tutorialspoint.com/design_pattern/null_object_pattern.htm](https://www.tutorialspoint.com/design_pattern/null_object_pattern.htm)

* * *

## 回答 #65

> 赞同：-5
> 
> 时间：2011-02-16T23:14:35.617

另一个建议是进行防御性编程 - 您的类/函数提供已知且安全的默认值，而 null 保留用于真正的错误/异常。

例如，当出现问题（比如将数字转换为字符串）时，不要让函数返回返回 null 的字符串，而是让它们返回一个空字符串 ("")。在继续之前，您仍然需要测试返回值，但不会有例外的特殊情况。这种编程风格的另一个好处是您的程序将能够区分正常操作和异常并做出相应的响应。

# java - 交叉引用和垃圾回收

> ID：271530
> 
> 赞同：11
> 
> 时间：2008-11-07T08:33:03.837
> 
> 标签：java

有一个具有广泛对象图的应用程序。该图主要由一组子图组成，这些子图通过唯一的参考连接到图的其余部分。但是在内部，每个这样的子图都有一些对象之间的交叉引用。有时需要丢弃这样的子图。将指向该子图的唯一引用设置为 null 以使其有资格进行垃圾收集就足够了吗？

我担心的是内部交叉引用可能会“保护”整个子图免受垃圾收集。换句话说，垃圾收集器是否足够明智地确定子图中的所有引用都不会离开子图的边界，因此可以清除整个子图。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-07T08:55:07.053

正如这个[SO question](https://stackoverflow.com/questions/176745/circular-references-in-java)中所述，循环引用得到了很好的管理。

Java 不做引用计数，它使用[跟踪垃圾收集](https://en.wikipedia.org/wiki/Tracing_garbage_collection)（例如标记和清除、复制收集或它们的某种组合）。如果遵循所有活动引用以找出哪些对象是“可访问的”，然后它会清理其他所有内容。

本身不可访问的对象中的引用不会影响可访问性，因此它们是否为空都无关紧要。

可以想象，设置对 null 的引用可能会产生重大影响的唯一情况是在长时间运行的方法中间丢弃一个非常大的对象。

在这种情况下，将 null 设置为图的引用将有助于形成**隔离岛**（即使对于内部循环引用），如[本文所述](http://detailfocused.blogspot.com/2008/03/garbage-collection.html)。

[您将在垃圾收集的真相](http://java.sun.com/docs/books/performance/1st_edition/html/JPAppGC.fm.html)中找到有关无法访问状态的更多详细信息：

**无法到达**

当不再存在对它的强引用时，对象进入不可访问状态。
当一个对象不可达时，它是一个收集的候选对象。

注意措辞：
仅仅因为一个对象是收集的候选对象并不意味着它会立即被收集。JVM 可以自由地延迟收集，直到对象立即需要消耗内存为止。

重要的是要注意，不仅仅是任何强引用都会在内存中保存一个对象。这些必须是从垃圾收集根链接的引用。GC 根是一类特殊的变量，包括：

*   堆栈上的临时变量（任何线程的）
*   静态变量（来自任何类）
*   来自 JNI 原生代码的特殊引用

**循环强引用不一定会导致内存泄漏**。考虑一个创建两个对象的代码，并为它们分配相互引用。

```
public void buidDog() {
   Dog newDog = new Dog();
   Tail newTail = new Tail();
   newDog.tail = newTail;
   newTail.dog = newDog;
} 
```

在方法返回之前，有来自`buildDog`方法中临时堆栈变量的强引用指向`Dog`和`Tail`。

在`buildDog`方法返回后，`Dog`和`Tail`都变得无法从根目录访问，并且成为收集的候选对象（尽管 VM 可能实际上在无限的时间内不会收集这些对象）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T08:35:13.443

是的 - 垃圾收集器可以处理循环引用等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T08:57:35.533

JVM 在“不可达岛”的概念上运行。如果存在无法到达的互连对象“孤岛”，则该对象集有资格进行整体垃圾回收。

# vb.net - VB.NET - 如何将对象分配给对象实例（内部有更好的描述）

> ID：271546
> 
> 赞同：0
> 
> 时间：2008-11-07T08:43:05.983
> 
> 标签：vb.net

我有一个对象实例，当它访问实例化对象时，我使用 ME 访问它。我有一个获取这些对象集合的方法，我希望将第一个对象分配给实例化对象。

这是一些代码

```
Dim Books As New BookCollection(True)
Books.ListByThemeFeatured(ThemeID, 1) ' Fills the collection

If Books.Count > 0 Then
   Me = Books(0) ' Should set the first item to the current object
End If 
```

这可能吗？

编辑：我指的是被实例化的类。在这种情况下，它是一个 BookEntity 类。此方法将使用以下代码调用

```
 Dim Book As New BookEntity
 Book.FeaturedBook() ' Should fill the book entity with a featured book 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-07T08:59:22.707

你不能。您正在寻找的是一种静态（在 VB 中共享）方法：

```
Dim Book as BookEntity
Book = BookEntity.FeaturedBook() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T09:04:41.370

这似乎是不可能的，因为您尝试替换您没有句柄的对象实例。一种选择可能是将当前 Book 实例的所有成员替换为 Books(0) 的值，例如：

```
Me.ConstructMeFrom(Books(0)) 
```

其中 ConstructMeFrom 替换了 Book 的所有字段：

```
Sub ConstructMeFrom(Book newBook)
    Me.Title = newBook.Title
    Me.PageCount = newBook.PageCount
    'etc
End Sub 
```

或者您可以设计一些方法来修改保存您的实例的句柄的值。例如，您可以使用委托将一个实例本身替换为另一个实例。我不熟悉 vb 语法，但这是在 c# 中如何完成的：

```
public class Book
{
    public delegate void Replacer(Book book);

    public void ReplaceMe(Replacer replacer, Book newBook)
    {
        replacer(newBook);
    }

    public int PageCount;
}

static void Main(string[] args)
{
    Book b1 = new Book() { PageCount = 3 };
    Book b2 = new Book() { PageCount = 5 };
    b1.ReplaceMe(book => b1 = book, b2);
    Console.WriteLine(b1.PageCount); // Output is 5.
} 
```

**更新：**

C# 示例与您更新的示例：

```
FeaturedBook(Replacer replacer)
{
    Book featuredBook = FindTheFeaturedBookFromSomeList();
    replacer(featuredBook);
} 
```

现在这样做：

```
BookEntity Book;
Book = BookEntity.FeaturedBook(delegate(BookEntity b) { Book = b; }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T09:14:37.433

要么使用子

```
public sub FeaturedBooks() 
    dim FB as Book = GetFeaturedBook() 
    CopyToMe(FB) 
end sub

private shared sub CopyToMe(Abook as book)
    Me.Bookname = aBook.BookName
     etc
end sub 
```

或具有共享功能，例如您可以编写：

```
Dim Book as BookEntity = BookEntity.FeaturedBook()

Class BookEntity

Public shared function FeaturedBook() as BookEntity
    Dim NewBook as BookEntity
    Get the featured book into here...

    return NewBook
end function

end class 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-22T02:33:48.787

我很抱歉，但该代码“闻起来很糟糕”......你为什么需要替换当前`BookEntity`对象？您的代码看起来正在做一些应该超出 a 范围的事情`BookEntity`。

我认为相反，您应该有一个类似的类`BookDisplayer`，该类具有`CurrentBook`处理显示新书所需的逻辑的属性。当然，假设这就是你想要完成的事情。

**编辑**：

看起来像下面的代码示例：

```
Book.FeaturedBook() ' Should fill the book entity with a featured book 
```

应该看起来像这样，而`FeaturedBook`逻辑则存在于`BookCollection`类中：

```
Book = Books.GetFeaturedBook()
' NOW perform display logic 
```

# firefox - 如果表单上次导致重定向，Firefox 3 不允许“返回”到表单

> ID：271550
> 
> 赞同：1
> 
> 时间：2008-11-07T08:48:18.610
> 
> 标签：firefox, redirect

问候，

这是我遇到的问题。我有一个页面在第一次访问时直接重定向到另一个页面。但是，如果用户单击“返回”，则页面的行为会有所不同，而是显示内容（跟踪会话 ID 以确保这是第二次加载页面）。为此，我告诉用户的浏览器禁用相关页面的缓存。

这在 IE7 中运行良好，但 Firefox 3 不允许我单击“返回”到导致重定向的页面。我认为这样做是为了防止让很多用户感到沮丧的典型的返回->再次重定向循环。关于如何覆盖此行为的任何想法？

阿列克谢

编辑：我们重定向到的页面是我们无法控制的外部站点。服务器端重定向不起作用，因为这不会在浏览器中生成“后退”按钮。

去引用：

> 线程中的一些人正在谈论服务器端重定向和重定向标头（同样的事情）......请记住，我们需要客户端重定向，可以通过两种方式完成：
> 
> a) 一个 META 标头 - 不推荐，并且有一些问题 b) Javascript，至少可以通过三种方式完成（“location”、“location.href”和“location.replace()”）
> 
> 服务器端重定向不会也不应该激活后退按钮，并且无法显示典型的“您现在将被重定向”页面......所以这不好（这是我们目前正在做的事情，实际上..您会立即被重定向到“幸运”页面）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T08:56:21.573

我认为 Mozilla 团队打破了这种特别烦人的模式，朝着正确的方向迈出了一步。想办法绕过它以某种方式违背了目的，不是吗？

当用户第一次点击它时，您可以简单地使您的页面呈现不同的方式，而不是在第一次遇到时重定向。在服务器端应该很容易，因为您已经拥有能够进行区分的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T10:26:22.750

我强烈支持 Firefox 的行为。

最基本的重定向方式是让服务器将[HTTP 状态码 302](http://www.greenbytes.de/tech/webdav/rfc2616.html#status.302) + [Location header](http://www.greenbytes.de/tech/webdav/rfc2616.html#header.location)发送回客户端。这样，客户端（通常是浏览器）不会将请求 URI 放入其历史记录中，而只是将相同的请求重新发送到所提倡的 URI。

现在，Firefox 似乎也开始将这种行为应用于尝试重定向的服务器响应，例如通过 Javascript 的 onload 事件。

如果您希望浏览器不显示页面，我认为最好的解决方案是服务器首先不发送页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-08T06:28:00.667

您可以通过创建 iframe 并将页面状态保存在 iframe 中的表单字段中来解决此问题，然后再进行重定向。所有浏览器都保存 iframe 的表单字段。

[这个页面](http://codinginparadise.org/weblog/2005/08/ajax-tutorial-saving-session-across.html)很好地描述了如何让它工作。当您单击地图搜索结果时，这与谷歌地图使用的技术相同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T09:57:42.590

它可能有助于消除重复动作。

人们做事的很多方式是

page 1 -> [Action] -> page 2 -> 重定向到没有操作参数的 page 2。

现在，如果您在这种情况下被允许单击后退按钮并在没有重定向的情况下访问该页面，则该操作将被盲目地重新执行。

相反，firefox 假定服务器发送重定向标头是有充分理由的。

尽管注意到，您可以在重定向标头之后传递内容，但发送重定向标头（至少在 php 中）不会终止执行，因此理论上，如果您忽略重定向请求，您将获得页面做奇怪的事情。

（我规避了这一点，因为我们所有的重定向都是通过同一个函数调用完成的，我在重定向之后直接调用显式终止，因为人们在编码时假设这是它的行为方式）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-06T11:29:53.410

在 firefox 的 URL 窗口中输入 about:config
将 firefox
browser.sessionstore.postdata中
的这个设置从 0 改为 1

# c# - 为什么在 C# 中经常看到“null != variable”而不是“variable != null”？

> ID：271561
> 
> 赞同：105
> 
> 时间：2008-11-07T08:57:34.973
> 
> 标签：c#, coding-style

在c#中，您陈述条件的顺序的执行速度有什么不同吗？

```
if (null != variable) ...
if (variable != null) ... 
```

最近，我经常看到第一个，因为我习惯了第二个，所以它引起了我的注意。

如果没有区别，第一个有什么好处？

* * *

## 回答 #1

> 赞同：167
> 
> 时间：2008-11-07T09:03:56.723

这是 C 的保留。在 C 中，如果您使用错误的编译器或没有出现足够高的警告，则编译时不会发出任何警告（并且确实是合法代码）：

```
// Probably wrong
if (x = 5) 
```

当你实际上可能是说

```
if (x == 5) 
```

您可以通过以下方式在 C 中解决此问题：

```
if (5 == x) 
```

这里的错字将导致无效代码。

现在，在 C# 中，这一切都很麻烦。除非您要比较两个布尔值（很少见，IME），否则您可以编写更具可读性的代码，因为“if”语句需要以布尔表达式开头，并且“ `x=5`”的类型是`Int32`, not `Boolean`。

我建议，如果您在同事的代码中看到这一点，请以现代语言的方式教育他们，并建议他们将来编写更自然的形式。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-05-24T16:30:24.190

首先使用 null 是有充分理由的：`if(null == myDuck)`

如果您`class Duck`覆盖了`==`运算符，则`if(myDuck == null)`可以进入无限循环。

Using `null`first 使用默认的相等比较器，实际上是按照您的意图进行的。

（我听说你最终会习惯阅读以这种方式编写的代码——我只是还没有经历过这种转变）。

这是一个例子：

```
public class myDuck
{
    public int quacks;
    static override bool operator ==(myDuck a, myDuck b)
    {
        // these will overflow the stack - because the a==null reenters this function from the top again
        if (a == null && b == null)
            return true;
        if (a == null || b == null)
            return false;

        // these wont loop
        if (null == a && null == b)
            return true;
        if (null == a || null == b)
            return false;
        return a.quacks == b.quacks; // this goes to the integer comparison
    }
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-01-31T09:54:38.310

就像大家已经注意到的那样，它或多或少来自 C 语言，如果你不小心忘记了第二个等号，你可能会得到错误的代码。但还有另一个与 C# 相匹配的原因：可读性。

举个简单的例子：

```
if(someVariableThatShouldBeChecked != null
   && anotherOne != null
   && justAnotherCheckThatIsNeededForTestingNullity != null
   && allTheseChecksAreReallyBoring != null
   && thereSeemsToBeADesignFlawIfSoManyChecksAreNeeded != null)
{
    // ToDo: Everything is checked, do something...
} 
```

如果您只是将所有*空*词交换到开头，则可以更轻松地发现所有检查：

```
if(null != someVariableThatShouldBeChecked
   && null != anotherOne
   && null != justAnotherCheckThatIsNeededForTestingNullity
   && null != allTheseChecksAreReallyBoring
   && null != thereSeemsToBeADesignFlawIfSoManyChecksAreNeeded)
{
    // ToDo: Everything is checked, do something...
} 
```

所以这个例子可能是一个不好的例子（参考编码指南），但想想你快速滚动一个完整的代码文件。通过简单地看到模式

```
if(null ... 
```

您立即知道接下来会发生什么。

如果反过来，你总是必须*扫描*到行尾才能看到无效检查，只是让你跌跌撞撞地找出在那里进行了什么样的检查。所以也许语法高亮可能会对你有所帮助，但是当这些关键字位于行尾而不是前面时，你总是会变慢。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-07T09:03:38.987

我猜这是一个切换语言的 C 程序员。

在 C 中，您可以编写以下代码：

```
int i = 0;
if (i = 1)
{
    ...
} 
```

注意这里使用了一个等号，这意味着代码会将 1 分配给变量 i，然后返回 1（赋值是一个表达式），并在 if 语句中使用 1，这将被视为 true。换句话说，上面是一个错误。

然而，在 C# 中，这是不可能的。两者确实没有区别。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-07T09:03:54.740

在早期，人们会忘记“！” （或额外的 '=' 表示相等，这更难发现）并进行分配而不是比较。将 null 放在前面消除了该错误的可能性，因为 null 不是左值（即不能分配给它）。

现在，大多数现代编译器在您在条件中进行赋值时都会发出警告，而 C# 实际上会给出错误。大多数人只是坚持使用 var == null 方案，因为它对某些人来说更容易阅读。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-10-03T08:39:56.963

我看不出遵循这个约定有什么好处。在不存在布尔类型的 C 中，编写

```
if( 5 == variable) 
```

而不是

```
if (variable == 5) 
```

因为如果你忘记了其中一个等号，你最终会得到

```
if (variable = 5) 
```

它将 5 分配给变量并始终评估为真。但是在 Java 中，布尔值就是布尔值。使用 !=，根本没有理由。

不过，一个好的建议是写

```
if (CONSTANT.equals(myString)) 
```

而不是

```
if (myString.equals(CONSTANT)) 
```

因为它有助于避免 NullPointerExceptions。

我的建议是询问规则的正当性。如果没有，为什么要遵循它？它不利于可读性

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T09:05:28.077

对我来说一直是你喜欢哪种风格

@Shy - 如果你让操作员感到困惑，那么你应该想要得到一个编译错误，否则你将运行带有错误的代码 - 一个错误会回来并在以后咬你，因为它会产生意外的行为

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-07-28T08:44:37.703

正如许多人指出的那样，它主要在旧的 C 代码中用于识别编译错误，因为编译器认为它是合法的

像 java、go 这样的新编程语言足够聪明，可以捕捉到这样的编译错误

不应该在代码中使用“null！= variable”之类的条件，因为它非常不可读

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2009-06-09T14:56:49.277

还有一件事......如果您将变量与常量（例如整数或字符串）进行比较，则将常量放在左侧是一种好习惯，因为您永远不会遇到 NullPointerExceptions ：

```
int i;
if(i==1){        // Exception raised: i is not initialized. (C/C++)
  doThis();
} 
```

然而

```
int i;
if(1==i){        // OK, but the condition is not met.
  doThis();
} 
```

现在，由于默认情况下 C# 会实例化所有变量，因此您不应该在该语言中遇到这个问题。

# .net - 如何在 Silverlight 的组合框中为选定和下拉状态使用不同的模板？

> ID：271569
> 
> 赞同：6
> 
> 时间：2008-11-07T09:00:48.210
> 
> 标签：.net, wpf, silverlight, xaml, combobox

我似乎无法为 ComboBoxItem 设置 ContentTemplate。我尝试这样做的原因是我想在组合框中为我的数据显示 2 次。当组合框打开（菜单关闭）时，我想要一个文本框（带有图像名称）和它下面的图像控件。当我选择项目时，我希望组合框只显示一个带有图像名称的文本框。

我想我可以通过修改 ComboBox 的 ItemTemplate 和 ItemContainerStyle 来实现。ItemContainerStyle 包含以下 ContentPresenter：

```
<ContentPresenter HorizontalAlignment="Left" Margin="{TemplateBinding Padding}" x:Name="contentPresenter" Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}"/> 
```

所以我假设我可以在这里设置 ContentTemplate 并且它会起作用。但我似乎无法让它工作：

```
<DataTemplate x:Key="ComboBoxDataTemplate">
            <Grid>
                <TextBlock Text="{Binding Path='Name'}"/>
            </Grid>
        </DataTemplate>

<DataTemplate x:Key="ComboBoxItemTemplate">
            <StackPanel>
                <TextBlock Text="{Binding Path='Name'}"/>
                <Image Source="{Binding Path='Source'}" Width="64" Height="64"/>
            </StackPanel>
        </DataTemplate>

        <Style x:Key="ComboBoxItemStyle1" TargetType="ComboBoxItem">
...
            <Setter Property="ContentTemplate" Value="{StaticResource ComboBoxItemTemplate}"/>

... 
```

这是我的组合框：

```
<ComboBox Width="70" Margin="3,0,0,0"
                        ItemsSource="{StaticResource Source}"
                        ItemTemplate="{StaticResource ComboBoxDataTemplate}"
                        ItemContainerStyle="{StaticResource ComboBoxItemStyle1}"
                        /> 
```

我可以让它工作的唯一方法是从 ItemContainerStyle 中删除 ContentPresenter，并将其替换为我的自定义模板 (ComboBoxItemTemplate) 的内容。但我认为我不应该使用这种方法，因为这意味着 ContentPresenter 不再存在（并且 ComboBox 中的代码可能依赖于它的存在）。

任何有关显示具有不同下拉列表和选定模板的组合框的帮助将不胜感激！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-09-14T11:42:55.937

ComboBox.ItemTemplate 只是设置 ComboBoxItem.ContentTemplate 的一种便捷方式。因此，您上面的代码基本上尝试设置 ComboBoxItem.ContentTemplate 两次。

正如 Jobi 指出的那样，您可以尝试仅使用自定义样式。如果您始终知道 Content 的类型，则可以安全地排除 ContentPresenter。ContentPresenter 只允许您使用 DataTemplate 来显示一些随机数据。但是您可以将其替换为 TextBlock 和 Image。您只是失去了指定 DataTemplate 的能力。

Jobi 方法的问题在于，即使它在下拉列表中，选择项也不会显示它的图像。实际选中的项目显示在两个位置（下拉列表和 ComboBox 的主体）。在一个位置您需要一个 DataTemplate，而在另一个位置您需要一个不同的 DataTemplate。

最好的办法是重新设计 ComboBox。您可以从[此处](http://msdn.microsoft.com/en-us/library/dd334408(v=VS.95).aspx1.1.)获取默认样式。有一个名为“ContentPresenter”的 ContentPresenter。您需要：

1.  删除/更改 ContentPresenter 的名称，因此 ComboBox 不会自动设置 Content/ContentTemplate 属性
2.  像这样绑定 ContentPresenter.Content 属性：“{TemplateBinding SelectedObject}”
3.  将 ContentPresenter.ContentTemplate 属性设置为不带图像的 DataTemplate
4.  使用 Image 和 TextBlock 将 ComboBox.ItemTemplate 属性设置为 DataTemplate
5.  给 ComboBox Style 一个明确的键，例如 x:Key="MyComboBoxStyle"
6.  使用 ComboBox 上的样式，例如 Style="{StaticResource MyComboBoxStyle}"

当在 ComboBox 的正文中显示所选项目时，这实际上会忽略 ComboBoxItem.ContentTemplate，但在下拉菜单中显示 ComboBoxItem 时会使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T10:26:14.717

您只需使用 ItemsContainerStyle 即可实现此目的。添加您的 TextBlock 和 Image 而不是 ContentPresenter。添加 VisualStateManager 并根据 VSM 的选定状态切换 Image 控件的可见性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T21:59:09.220

DataTemplate 主要是为了你的数据可视化，最好把所有 UI 相关的动态都放在 ControlTemplate（控制行为）里面。如果您没有 ContentPresenter，则没有潜在问题。唯一的问题是，如果您想从其他 ComboBox 重用此 ControlTemplate。然后你可以用 ContentPresenter 声明另一个干净的 Control 模板。

# perl - 如何使用外部数据过滤 DBIX::Class 结果集？

> ID：271571
> 
> 赞同：7
> 
> 时间：2008-11-07T09:02:43.637
> 
> 标签：perl, dbix-class

使用[DBIx::Class](http://search.cpan.org/dist/DBIx-Class/)并且我有一个结果集，需要通过 SQL 无法生成的数据进行过滤。我需要做的是有效地等同于这个假设的例子：

```
my $resultset     = $schema->resultset('Service')->search(\%search);
my $new_resultset = $resultset->filter( sub {
    my $web_service = shift;
    return $web_service->is_available;
} ); 
```

通读文档让我不知道如何完成这样的策略。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T09:48:19.923

由于 DBIC 结果集的设计目标，您不能真正做到：

*   它们编译为 SQL 并运行单个查询，它们不会早于您要求结果时执行此操作。
*   它们是可组合的。

允许通过在 Perl 端运行的代码进行过滤会使实现这些属性变得非常麻烦，并且会隐藏这样一个事实，即这样的结果集在组合时实际上运行 N 个查询。

无论如何，你为什么想要这个？为什么简单地检索结果并自己过滤它们是不够的？

*   **封装**？（例如，在您的业务逻辑层中隐藏过滤逻辑，但在显示逻辑层中启动查询。）然后编写一个自定义 ResultSet 子类，该子类具有一个运行查询并执行所需过滤的访问器。

*   **开销**？（例如，您将拒绝大多数结果，因此您不希望为它们创建对象的开销。）然后使用 HashRefInflator。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-28T16:03:41.077

如果您过滤结果并最终得到一个行列表，您可以创建一个新的结果集，如下所示：[http ://search.cpan.org/~abraxxa/DBIx-Class-0.08127/lib/DBIx/Class/Manual/Cookbook .pod#Creating_a_result_set_from_a_set_of_rows](http://search.cpan.org/~abraxxa/DBIx-Class-0.08127/lib/DBIx/Class/Manual/Cookbook.pod#Creating_a_result_set_from_a_set_of_rows)。

这可以使结果保持一致，但我想您将无法链接它或在其上使用任何其他结果集方法。

# ios-simulator - 每次运行时如何保持iphone模拟器应用程序目录相同

> ID：271577
> 
> 赞同：2
> 
> 时间：2008-11-07T09:04:15.677
> 
> 标签：ios-simulator

我遇到了iphone模拟器应用程序目录的问题，当我每次运行应用程序时，应用程序目录的名称每次都会更改，谁能告诉我如何保持静态应用程序目录？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T19:54:52.530

我要在这里猜测并说..

您不需要静态目录。

我认为您需要以编程方式获取“基本目录”。

```
NSString *docsDirectory = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
NSString *path = [docsDirectory stringByAppendingPathComponent:@"fileName.txt"];

```

您应该将您的用户文件保存在那里（或类似的地方）

或者类似的东西

```
NSBundle* bundle = [NSBundle mainBundle];
NSString* 路径 = [捆绑可执行路径]
//或者
NSString* 路径 = [捆绑资源路径];

```

然后将您自己的路径附加到该路径上。

希望有帮助。

新信息：

如果您要保存信息（日志、统计信息等），您可以使用 Xcode 管理器检索保存在上述 NSDocumentDirectory 中的文件。

*   选择您的设备
*   得到了摘要标签
*   在“应用程序”部分找到您的应用程序。
*   展开条目，它应该有一个“应用程序数据”条目。
*   按右侧的向下箭头保存文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T12:45:02.847

如果您只是从模拟器跳板中重新启动应用程序，它将继续使用相同的目录。如果你在 Xcode 中重建应用程序，它会移动，并且没有办法阻止它。Xcode 应该在安装新版本时将您拥有的所有数据从旧目录迁移到新目录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-26T05:21:35.620

我猜问题是 XCode 有时会“丢失”文件。

所以我刚才丢失了所有的偏好，并且无法找回它们，因为 XCode 一旦丢失，就无法恢复它们。

这是我为解决问题所做的：

*   打开控制台，注意它用于新启动的目录，在我的例子中是 /Users/nik/Library/Application Support/iPhone Simulator/User/Applications/D713AFE6-D6B3-4D1E-A1B9-28FD679FD124/Documents/
*   退出应用程序
*   转到 /Users/nik/Library/Application Support/iPhone Simulator/User/Applications 并查找在 /Documents 中仍然包含首选项文件的启动
*   将首选项文件复制到上面的最后一个启动位置
*   再次启动 - 现在一切正常。XCode 创建了另一个临时启动目录，但将文件从“最后一次”启动中移了过来。

我现在还将首选项文件保存在另一个位置，因此下次发生这种情况时，我可以方便地使用它们。

# wix - WIX：如何根据运行安装程序的操作系统更改注册表项？

> ID：271580
> 
> 赞同：4
> 
> 时间：2008-11-07T09:05:12.697
> 
> 标签：wix, windows-installer

我想通过以下方式设置注册表项

如果操作系统是 Vista 则 HKLM\MyKey1\MyValue=1 否则 HKLM\MyKey2\MyValue=1

我知道如何在 WIX 中设置注册表项，但似乎无法在元素上设置条件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T09:18:41.607

从技术上讲，您应该使用两个不同的组件来安装这些注册表项，因为它们是完全不同的路径。然后您可以使用 VersionNT 属性调节组件。

# html - 如何从 CGI 脚本启动 HTMLDOC？

> ID：271583
> 
> 赞同：2
> 
> 时间：2008-11-07T09:07:25.530
> 
> 标签：html, pdf, cgi

`.pdf`我有一个从 HTML 页面生成文件的 CGI 脚本。我的问题是，当它从 Web 浏览器启动时，没有创建`.pdf`文档。

到目前为止我做了什么：

*   chmod 设置设置为上述建议 (777)
*   测试了脚本文件的正常输出，效果很好
*   从命令行在服务器上本地运行时，`.cgi`脚本有效

为什么从 Web 浏览器运行时脚本不起作用？

```
#!/usr/bin/perl
use LWP::Simple;
use HTML::HTMLDoc;
use CGI;
print "Content-type: text/html\n\n";
print "<html><head><title>test</title></head>";
print "<body>";

my $htmldoc->set_html_content(qq~<html><body>A PDF file</body></html>~);
my $pdf = $htmldoc->generate_pdf() or die($!);
$pdf->to_file('/var/www/tom.pdf');
print "</body></html>"; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-10-05T16:05:10.670

最可能的原因是`/var/www`apache进程（或您正在使用的任何Web服务器）不可写，因此如果您从命令行运行它 - 使用您的用户权限 - 它会成功，但是当从Web浏览器调用时服务器以自己的（非常有限的）权限运行它，然后写入失败。

需要先检查`to_file`方法的返回码，看是否写入成功，然后写入允许web服务器写入的目录，比如`/var/tmp`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-28T10:41:12.910

你在哪里将生成的文件发送到浏览器？

请注意，您不能在 HTML 中嵌入 PDF；你必须要么

*   将文件放在您的网络服务器将交付它的地方，并将文件的链接发送到浏览器
*   或将内容类型设置为`application/pdf`并仅返回文件（周围没有任何 HTML 标记）。

# c# - 将空参数传递给 C# 方法

> ID：271588
> 
> 赞同：36
> 
> 时间：2008-11-07T09:13:10.153
> 
> 标签：c#, methods, null

有没有办法将空参数传递给 C# 方法（类似于 c++ 中的空参数）？

例如：

是否可以将以下 c++ 函数转换为 C# 方法：

```
private void Example(int* arg1, int* arg2)
{
    if(arg1 == null)
    {
        //do something
    }
    if(arg2 == null)
    {
        //do something else
    }
} 
```

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-11-07T09:19:24.803

是的。.NET 中有两种类型：引用类型和值类型。

引用类型（通常是类）总是由引用引用，因此它们支持 null 而无需任何额外工作。这意味着如果变量的类型是引用类型，则该变量自动成为引用。

默认情况下，值类型（例如 int）没有 null 的概念。但是，它们有一个称为 Nullable 的包装器。这使您能够封装不可为空的值类型并包含空信息。

不过，用法略有不同。

```
// Both of these types mean the same thing, the ? is just C# shorthand.
private void Example(int? arg1, Nullable<int> arg2)
{
    if (arg1.HasValue)
        DoSomething();

    arg1 = null; // Valid.
    arg1 = 123;  // Also valid.

    DoSomethingWithInt(arg1); // NOT valid!
    DoSomethingWithInt(arg1.Value); // Valid.
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-07T10:00:37.247

我认为最接近的 C# 等价`**int***`于`**ref int?**`. 因为`**ref int?**`允许被调用方法将值传递回调用方法。

`**int***`

*   可以为空。
*   可以为非 null 并指向一个整数值。
*   ***如果不为 null，则可以更改值***，并将更改传播给调用者。
*   ***设置为 null 不会传回给调用者***。

`**ref int?**`

*   可以为空。
*   可以有一个整数值。
*   ***值总是可以更改***的，并且更改会传播给调用者。
*   ***值可以设置为 null，并且此更改也会传播到调用者***。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-07T09:16:09.070

您可以为此使用 NullableValueTypes（如 int？）。代码将是这样的：

```
private void Example(int? arg1, int? arg2)
{
    if(!arg1.HasValue)
    {
        //do something
    }
    if(!arg2.HasValue)
    {
        //do something else
    }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-07T09:15:40.460

从 C# 2.0 开始：

```
private void Example(int? arg1, int? arg2)
{
    if(arg1 == null)
    {
        //do something
    }
    if(arg2 == null)
    {
        //do something else
    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-07T09:17:07.867

从 C# 2.0 开始，您可以使用可为空的泛型类型 Nullable，并且在 C# 中有一个简写符号，类型后跟 ?

例如

```
private void Example(int? arg1, int? arg2)
{
    if(arg1 == null)
    {
        //do something
    }
    if(arg2 == null)
    {
        //do something else
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-12-05T14:02:45.563

OP 的问题已经得到很好的回答，但标题足够宽泛，我认为它受益于以下入门：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace consolePlay
{
    class Program
    {
        static void Main(string[] args)
        {
            Program.test(new DateTime());
            Program.test(null);
            //Program.test(); // <<< Error.  
            // "No overload for method 'test' takes 0 arguments"  
            // So don't mistake nullable to be optional.

            Console.WriteLine("Done.  Return to quit");
            Console.Read();
        }

        static public void test(DateTime? dteIn)
        {
            Console.WriteLine("#" + dteIn.ToString() + "#");
        }
    }
} 
```

输出：

```
#1/1/0001 12:00:00 AM#
##
Done.  Return to quit 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-07-16T22:07:33.547

您可以使用 2 种方式：int? 或 Nullable，两者具有相同的行为。您可以毫无问题地进行混合，但更好的选择是使代码最干净。

选项 1（带？）：

```
private void Example(int? arg1, int? arg2)
    {
        if (arg1.HasValue)
        {
            //do something
        }
        if (arg1.HasValue)
        {
            //do something else
        }
    } 
```

选项 2（可以为空）：

```
private void Example(Nullable<int> arg1, Nullable<int> arg2)
    {
        if (arg1.HasValue)
        {
            //do something
        }
        if (arg1.HasValue)
        {
            //do something else
        }
    } 
```

从 C#4.0 开始，一种新的方式可以更灵活地执行相同的操作，在这种情况下，框架提供[了带有默认值的可选参数](https://msdn.microsoft.com/en-us/library/dd264739.aspx)，这样，如果在没有所有参数的情况下调用该方法，您可以设置一个默认值。

选项 3（使用默认值）

```
private void Example(int arg1 = 0, int arg2 = 1)
    {
        //do something else
    } 
```

# sql - 获取一系列日期之间的日期

> ID：271595
> 
> 赞同：16
> 
> 时间：2008-11-07T09:16:20.160
> 
> 标签：sql, sql-server, tsql, datetime, date-range

我需要使用 SQL Server 2005 获取日期范围内的所有日期

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-11-07T12:09:06.587

干得好：

```
DECLARE @DateFrom smalldatetime, @DateTo smalldatetime;
SET @DateFrom='20000101';
SET @DateTo='20081231';
-------------------------------
WITH T(date)
AS
( 
SELECT @DateFrom 
UNION ALL
SELECT DateAdd(day,1,T.date) FROM T WHERE T.date < @DateTo
)
SELECT date FROM T OPTION (MAXRECURSION 32767); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-07T09:23:56.213

如果您在表格中有日期并且只想选择两个日期之间的日期，您可以使用

```
select * from yourTable where yourDate between date1 and date2 
```

如果您想从无到有生成日期，您可以使用循环来完成，或者您可以使用日期填充临时表，然后从中进行选择。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-12-04T12:48:14.320

```
DECLARE @Date1 DATE='2016-12-21', @Date2 DATE='2016-12-25'
SELECT DATEADD(DAY,number,@Date1) [Date] FROM master..spt_values WHERE type = 'P' AND DATEADD(DAY,number,@Date1) <= @Date2 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T16:09:43.480

这是日期生成的 Oracle 版本：

```
SELECT TO_DATE ('01-OCT-2008') + ROWNUM - 1 g_date
  FROM all_objects
 WHERE ROWNUM <= 15 
```

而不是 all_objects 它可以是任何具有足够行来覆盖所需范围的表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-13T09:38:52.330

稍微复杂一点但可能更灵活的方法是使用包含一组连续数字的表格。这允许多个具有不同间隔的日期范围。

```
/* holds a sequential set of number ie 0 to max */
/* where max is the total number of rows expected */
declare @Numbers table ( Number int  )

declare @max int 
declare @cnt int

set @cnt = 0
/* this value could be limited if you knew the total rows expected */
set @max = 999 

/* we are building the NUMBERS table on the fly */
/* but this could be a proper table in the database */
/* created at the point of first deployment */
while (@cnt <= @max)
begin
      insert into @Numbers select @cnt
      set @cnt = @cnt + 1
end

/* EXAMPLE of creating dates with different intervals */

declare @DateRanges table ( 
   StartDateTime datetime, EndDateTime datetime, Interval int )

/* example set of date ranges */
insert into @DateRanges
select '01 Jan 2009', '10 Jan 2009', 1 /* 1 day interval */
union select '01 Feb 2009', '10 Feb 2009', 2 /* 2 day interval */

/* heres the important bit generate the dates */
select
      StartDateTime
from
(
      select
            d.StartDateTime as RangeStart,
            d.EndDateTime as RangeEnd,
            dateadd(DAY, d.Interval * n.Number, d.StartDateTime) as StartDateTime
      from 
            @DateRanges d, @Numbers n
) as dates
where
      StartDateTime between RangeStart and RangeEnd
order by StartDateTime 
```

我实际上使用它的变体将日期分成时间段（有不同的时间间隔，但通常是 5 分钟长）。我的@numbers 表最多包含 288 个，因为这是您在 24 小时内可以拥有的 5 分钟插槽的总数。

```
/* EXAMPLE of creating times with different intervals */

delete from @DateRanges 

/* example set of date ranges */
insert into @DateRanges
select '01 Jan 2009 09:00:00', '01 Jan 2009 12:00:00', 30 /* 30 minutes interval */
union select '02 Feb 2009 09:00:00', '02 Feb 2009 10:00:00', 5 /* 5 minutes interval */

/* heres the import bit generate the times */
select
      StartDateTime,
      EndDateTime
from
(
      select
            d.StartDateTime as RangeStart,
            d.EndDateTime as RangeEnd,
            dateadd(MINUTE, d.Interval * n.Number, d.StartDateTime) as StartDateTime,
            dateadd(MINUTE, d.Interval * (n.Number + 1) , StartDateTime) as EndDateTime
      from 
            @DateRanges d, @Numbers n
) as dates
where
      StartDateTime >= RangeStart and EndDateTime <= RangeEnd
order by StartDateTime 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-11-07T12:22:02.097

如果您想要获取数据库中两个日期之间的所有日期（即客户在 2008 年第三季度下订单的日期），您可以编写如下内容：

```
select distinct(orderPlacedDate) 
from orders 
where orderPlacedDate between '2008-07-01' and 2008-09-30' 
order by orderPlacedDate 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-11-07T11:07:13.760

要生成一系列日期，您可以编写一个表值函数。这是一个为数据仓库创建日期维度的函数——您可以通过删除特殊内容来相当容易地调整它。

编辑：这里没有日期维度层次结构。

```
if object_id ('ods.uf_DateHierarchy') is not null
    drop function ods.uf_DateHierarchy
go

create function ods.uf_DateHierarchy (
       @DateFrom datetime
      ,@DateTo   datetime
) returns @DateHierarchy table (
        DateKey           datetime
) as begin
    declare @today           datetime  
    set @today = @Datefrom

    while @today <= @DateTo begin
        insert @DateHierarchy (DateKey) values (@today)
        set @today = dateadd (dd, 1, @today)
    end

    return
end

go 
```

# java - 如何在我的安装程序中正确地重新打包 JRE 安装程序？

> ID：271596
> 
> 赞同：2
> 
> 时间：2008-11-07T09:16:35.450
> 
> 标签：java, installation

我有一个正在为其编写安装程序的 Java 应用程序。我们正在使用 AdvancedInstaller 程序来创建我们的安装程序（嗯，我们目前正在评估它，但肯定会很快购买许可证），虽然它对 Java 应用程序有特殊支持，但它更倾向于将它们重新打包为桌面 -类型应用程序，我们的软件是一系列 Java 服务和其他实用程序，在 EXE 包装器中分发是没有意义的。该软件的目标受众非常具体，我们知道我们的软件可能会自动分发到新映像的 Windows 2003 Server 机器上。因此，要求 Java 作为先决条件基本上会为一些糟糕的系统管理员带来更多的工作，如果可能的话，我宁愿通过在我们自己的内部重新打包 JRE 的安装程序来避免这种情况。

我发现如果我尝试从我的 MSI 执行 JRE 的安装程序作为预安装步骤，它会抱怨另一个安装程序已经在运行（当然是我的），所以它退出了。当我尝试将 JRE 安装程序添加为 AdvancedInstaller 项目中的软件先决条件（作为捆绑的 EXE，而不是 URL 链接）时，它似乎从未真正安装，尽管我试图强制安装它。

重新打包 JRE 的最佳方法是什么？我不是真正的 Java 人，所以我不太了解其他开发人员如何处理同样的问题，除了要求他们的用户自行寻找和安装 JRE。这里理想的解决方案是我们找到一个可以从另一个 MSI 安装程序内部执行的 EXE 安装程序，或者如果可能的话，将所有文件打包到 JRE 中，然后创建适当的注册表和环境变量。我该怎么做呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T09:32:50.267

我不知道这是否是这样做的“方法”，但遇到了一个有点类似的问题，我们只需将*已安装*的JRE 与我们的应用程序文件的其余部分一起存档，并确保我们所有的启动脚本都不使用`java ...`，但是而是`..\..\jre\bin\java ...`或类似的。JRE 作为我们安装过程的一部分在我们安装的子目录中解包，仅此而已。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T12:46:25.933

我同意[bdumitriu 的回答](https://stackoverflow.com/questions/271596/how-do-i-properly-repackage-the-jre-installer-in-my-installer#271622)：

一个简单的 jre zip 就足够了，除非您想将该 jre 链接到：

*   默认 java（这意味着您必须在任何其他 java 路径引用之前将解压缩的 jre 的 java.exe 添加到路径中）
*   某些脚本的默认 java （您可以将 JAVA_HOME 定义为引用新解压缩的 jre，但这可能对在新 JRE 之前也使用 JAVA_HOME 的其他脚本产生副作用）
*   .jnlp 或 .jar 文件等文件关联（这需要一些[注册表修改](http://www.tech-archive.net/Archive/WinXP/microsoft.public.windowsxp.help_and_support/2006-01/msg03838.html)）
*   浏览器 java 插件注册（也需要修改注册表）

如果最后两点您对此部署所关注的桌面不感兴趣，那么一个简单的 zip 就足够了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-29T08:56:13.767

[http://www.syswow64.co.uk/2013/05/java-7-update-21-1721-enterprise.html](http://www.syswow64.co.uk/2013/05/java-7-update-21-1721-enterprise.html)

许多博客和文章中的问题是围绕为企业部署创建“deployment.config”和“deployment.properties”文件。在我的情况下，我想将安全级别设置为“中”，但每次我打开 Java 控制面板时，它都被设置为默认的 HIGH 设置。

# delphi - 如何保存 Tlistview 布局

> ID：271598
> 
> 赞同：2
> 
> 时间：2008-11-07T09:18:08.723
> 
> 标签：delphi, tlistview

如何在 Delphi 2007 中保存 Tlistviews 布局？

我被要求编写一些代码以允许用户重新排序 TListview 中的列（以及我们应用程序中的所有 TListviews），我使代码正常工作（通过操作列索引并将宽度设置为零以隐藏不需要的列）但现在我需要一种方法来保存视图的状态何时形成退出。

做这个的最好方式是什么？我考虑过序列化，但我不需要数据或排序顺序，这对我来说有点矫枉过正。

需要考虑的一些事情 它需要基于每个用户 它需要灵活，以防我们在列表视图中间添加一个新列 不保证列标题将是唯一的 列表视图名称可能不是在整个应用程序中独一无二

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T09:30:39.337

如果您只想保存和加载数据的某个部分，您可以将其存储在 ini 或 xml 文件中。可以将一般数据写入文件。列是另一个问题。您需要为每列找到一个唯一标识。ini 可能是这样的：

```
[Settings]

[Col_1]
position=1
width=500
title=hello world
align=left
sort=ascending

.. etc for more fields and more columns. 
```

如果你使用 listview 帮助类，你只需要编写一次代码：

```
TListviewHelper = class helper for TListView;
public
  procedure SaveToFile(const AFilename: string);
  procedure LoadFromFile(const AFileName: string);
end;

procedure TListviewHelper.SaveToFile(const AFilename: string);
var
  ini : TIniFile;
begin
  ini := TIniFile.Create(AFileName);
  try
    // Save to ini file
  finally
    ini.Free;
  end;
end;

procedure TListviewHelper.LoadFromFile(const AFileName: string);
var
  ini : TIniFile;
begin
  ini := TIniFile.Create(AFileName);
  try
    // Load from ini file
  finally
    ini.Free;
  end;
end; 
```

如果 TListviewHelper 在范围内，您可以访问额外的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T15:10:34.253

我建议您从 Tlistview 继承（或者是否有 TCustomListView）来创建自己的组件，类助手很好但非官方的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-07-04T08:23:31.323

存储列顺序的最简单方法可能是将每个列的 ID 定义为有意义的字符串，并以正确的顺序将列表存储在注册表中。例如，假设您的列的顺序如下：

```
Name | First name | Age | Job title 
```

那么注册表中存储的字符串可能是：

```
"Name,FName,Age,JTitle" 
```

存储在适当的注册表项中，在适当的键下（通常`HCKU\SOFTWARE\MyApplication`，例如在键`ColumnOrder`下）

# java - Windows下同时运行多个Java版本

> ID：271609
> 
> 赞同：98
> 
> 时间：2008-11-07T09:24:32.423
> 
> 标签：java

我们有几个在 Java 5 上运行的应用程序，现在想引入一个基于 Java 6 的应用程序。这两个 Java 版本可以在 Windows 下一起运行吗？

是否有任何控制面板为不同的应用程序设置适当的 Java 版本，或任何其他方式来设置，将使用哪个版本的 Java 来运行该特定应用程序？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-11-07T09:33:37.053

当然你可以在 Windows 下使用多个版本的 Java。并且不同的应用程序可以使用不同的 Java 版本。您的应用程序是如何启动的？通常你会有一个批处理文件，其中有类似的东西

```
java ... 
```

这将使用 PATH 变量搜索 Java 可执行文件。因此，如果 Java 5 首先在 PATH 上，则运行 Java 6 应用程序将遇到问题。然后，您应该修改批处理文件以使用某个 Java 版本，例如通过定义具有`JAVA6HOME`值的环境变量`C:\java\java6`（如果 Java 6 安装在此目录中）并更改批处理文件调用

```
%JAVA6HOME%\bin\java ... 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-09-05T12:04:05.137

我对在 Windows 中跟踪 Java 文件的 CLASSPATH、JAVA_HOME 和 PATH 想法的笨拙感到震惊。我来到这里是因为有多个 JRE，以及如何满足于它。没有反刍的信息，来自一个比我聪明得多的人，我宁愿指出他关于这个问题的文章，对我来说，它完美地解决了这个问题。

文章作者：Ted Neward：[多个 Java 主页：为 Java 应用程序提供自己的 JRE](http://www.tedneward.com/files/Papers/MultipleJavaHomes/MultipleJavaHomes.pdf)

> 随着 Java 作为服务器端开发语言的指数级增长，Java 开发工具、环境、框架和扩展也出现了等量的指数级增长。不幸的是，并非所有这些工具都可以在相同的 Java VM 安装下很好地协同工作。有些需要符合 Servlet 2.1 的环境，有些需要 2.2。有些仅在 JDK 1.2 或更高版本下运行，有些在 JDK 1.1（并且没有更高版本）下运行。有些需要 Swing 1.0 之前的“com.sun.swing”包，有些需要“javax.swing”包名。
> 
> 更糟糕的是，即使在企业内部也可以发现这个问题，因为仅仅六个月前使用 Java 开发的系统可能会突然“无法正常工作”，因为新的（看似无关的）应用程序版本需要安装一些 Java 扩展。这会使整个公司的 Java 应用程序部署复杂化，并导致客户想知道为什么在臭名昭著的“安装这个应用程序破坏我的系统”问题始于微软的 DLL 方案五年后，我们仍然没有除此之外没有太大进展。（事实上​​，新的 .NET 倡议实际上是为了解决刚才描述的臭名昭著的“DLL-Hell”问题。）
> 
> 本文介绍了如何配置 Java 安装，以便给定应用程序接收其自己的私有 JRE，从而允许多个 Java 环境共存，而不会让客户（或系统管理员）发疯...

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-07T09:34:00.623

绝对可以同时安装多个 JRE/JDK 版本。此外，您不必为此做任何特别的事情，因为 Sun 正在为每个文件夹创建一个不同的文件夹（在 Program Files 下）。

没有控制面板来检查哪个 JRE 适用于每个应用程序。基本上，可以工作的 JRE 将是 PATH 环境变量中的第一个。您可以更改它或 JAVA_HOME 变量，或创建特定的 cmd/bat 文件来启动您想要的应用程序，每个应用程序在路径中都有不同的 JRE。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-04-02T13:38:48.897

我们可以使用 SDKMan 在同一台机器上安装多个版本的 Java 开发工具包。

SDKMan 的一些要点如下：

1.  SDKMan 是免费使用的，它是由开源社区开发的。
2.  SDKMan 是用[bash](https://www.gnu.org/software/bash/)编写的，它只需要在您的系统上存在[curl](http://curl.haxx.se/)和[zip/unzip](http://www.info-zip.org/)程序。
3.  SDKMan 可以为 JVM 安装大约 29 个软件开发工具包，例如 Java、Groovy、Scala、Kotlin 和 Ceylon。Ant、Gradle、Grails、Maven、SBT、Spark、Spring Boot、Vert.x。
4.  我们不需要担心设置`_HOME`和`PATH`环境变量，因为 SDKMan 会自动处理它。

SDKMan 可以在任何基于 UNIX 的平台上运行，例如 Mac OSX、Linux、Cygwin、Solaris 和 FreeBSD，我们可以使用以下命令安装它：

```
$ curl -s "https://get.sdkman.io" | bash  
$ source "$HOME/.sdkman/bin/sdkman-init.sh" 
```

> 因为 SDKMan 是用[bash](https://www.gnu.org/software/bash/)编写的，并且只需要[curl](http://curl.haxx.se/)和[zip/unzip](http://www.info-zip.org/)在您的系统上存在。您也可以在 Windows 上安装 SDKMan，方法是先安装[Cygwin](https://www.cygwin.com/install.html)或[Git Bash for Windows](https://git-scm.com/download/win)环境，然后运行上述命令。

命令`sdk list java`将为我们提供可以使用 SDKMan 安装的 Java 版本列表。

**安装 Java 8**

```
$ sdk install java 8.0.201-oracle 
```

**安装 Java 9**

```
$ sdk install java 9.0.4-open 
```

**安装 Java 11**

```
$ sdk install java 11.0.2-open 
```

**卸载 Java 版本**

如果您想卸载任何 JDK 版本，例如 11.0.2-open，您可以执行以下操作：

```
$ sdk uninstall java 11.0.2-open 
```

**切换当前 Java 版本**

如果要为所有终端和应用程序激活一个版本的JDK，可以使用命令

```
sdk default java <your-java_version> 
```

上述命令还将自动更新 PATH 和 JAVA_HOME 变量。您可以阅读我的文章[如何在同一台机器上安装多个 Java 版本](https://www.programmingmitra.com/2019/03/how-to-install-multiple-versions-of-java-on-the-same-machine.html)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-07T09:38:08.340

应该可以针对特定应用程序以不同方式更改设置 JAVA_HOME 环境变量。

从命令行或批处理脚本启动时，您可以使用它`set JAVA_HOME=C:\...\j2dskXXX`来更改 JAVA_HOME 环境。

您可能还需要更改`PATH`环境变量以使用正确的 java 二进制文件。为此，您可以使用`set PATH=%JAVA_HOME%\bin;%PATH%`.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-07T12:17:08.630

使用“java -version:1.5”等调用 Java 应该使用正确的 Java 版本运行。（显然将 1.5 替换为您想要的版本。）

如果在 Windows 上正确安装了 Java，则在它使用的注册表中存储的每个版本都有指向 vm 的路径，因此您无需在 Windows 上弄乱环境版本。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-06-18T23:17:54.097

或者使用链接。虽然在运行环境中更新 PATH 相当不愉快，但很容易重新创建指向新版本 JRE/JDK 的链接。所以：

*   安装要使用的不同版本的 JDK
*   通过[junction](https://technet.microsoft.com/en-us/sysinternals/bb896768.aspx)或内置 mklink 命令创建指向该文件夹的链接
*   将路径设置为链接
*   如果要使用其他版本的java，删除链接，创建一个新的，PATH/JAVA_HOME/hardcoded scripts 保持不变

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-04-06T08:49:51.350

使用我自己的 java 版本启动 JMeter 时，我使用了一个简单的脚本

```
setlocal
set JAVA_HOME="c:\java8"
set PATH=%JAVA_HOME%\bin;%PATH%;
java -version 
```

要拥有一个 java “便携式”，您可以在此处使用此方法：

[https://www.whitebyte.info/programming/java/how-to-install-a-portable-jdk-in-windows-without-admin-rights](https://www.whitebyte.info/programming/java/how-to-install-a-portable-jdk-in-windows-without-admin-rights)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-17T05:42:06.433

如果您使用[Java Web Start](http://en.wikipedia.org/wiki/Java_Web_Start)（您可以从任何 URL 启动应用程序，甚至是本地文件系统），它将负责为您的应用程序找到正确的版本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-08-17T06:27:57.183

使用Java Web Start，你可以安装多个JRE，然后调用你需要的。在 win 上，您可以制作一个 .bat 文件：

1-在线版本：< *your_JRE_version* \bin\javaws.exe> -localfile -J-Djnlp.application.href=< *.jnlp文件的*url.jnlp> -localfile -J "< *path_temp_jnlp_file_.jnlp* >"

2- 从缓存启动：< *your_JRE_version* \bin\javaws.exe> -localfile -J "< *path_of_your_local_jnlp_file* .jnlp>"

# java - 离线/在线数据同步策略

> ID：271610
> 
> 赞同：40
> 
> 时间：2008-11-07T09:24:35.107
> 
> 标签：java, database, jakarta-ee, data-synchronization

我的要求是我有服务器 J2EE Web 应用程序和客户端 J2EE Web 应用程序。有时客户端可以离线。当客户端上线时，他应该能够来回同步更改。此外，我应该能够根据一些过滤器/规则来控制需要同步哪些行/表。是否有任何现有的 Java 框架可以做到这一点？如果我需要自己实施，您可以建议哪些不同的策略？

我想到的一个解决方案是在同步期间维护 sql 日志并在另一端执行相同的语句。你觉得这个策略有什么问题吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-07T19:34:00.040

有许多用于数据同步/复制的 Java 库。我知道的两个是[daffodil](http://opensource.replicator.daffodilsw.com/)和[SymmetricDS](http://www.symmetricds.org/)。在前世，我愚蠢地（在 Java 中）实现了我自己的数据复制过程。这似乎是一种应该相当简单的事情，但如果数据可以同时在多个地方更新，那就非常复杂了。我强烈建议您使用上述项目之一来尝试绕过自己处理这种复杂性。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-07T12:55:22.827

同步的最大问题是当用户离线编辑某些内容时，它同时在线编辑。你需要合并这两条改变的数据，或者处理 UI 让用户说出哪个版本是正确的。如果您消除了两者同时被编辑的可能性，那么您就不必解决这个棘手的问题。

该方法通常是在所有表中添加一个“修改”字段，并将给定行中给定记录的客户端修改字段与服务器修改日期进行比较。如果它们不匹配，则替换服务器的数据。

小心使用自动生成的密钥 - 当您从客户端复制到服务器时，您需要确保保持数据完整性。在服务器上再次严格运行 SQL 语句可能会使您处于自动生成的键已更改的情况，并且突然您的外键指向的记录与您的预期不同。

通常在从其他来源导入数据时，您会跟踪来自外部来源的主键以及您自己的个人主键。这使得在困难的同步情况下更容易确定数据集之间的变化和差异。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-21T23:41:20.193

您的同步器需要确定何时可以更新数据以及何时需要人工调解潜在的冲突。我写了[一篇论文，解释了如何使用测井和代数定律来做到这一点](http://www.cs.tufts.edu/~nr/pubs/sync-abstract.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-03T15:10:06.663

什么最适合作为应用程序中的客户端数据存储？您可以选择嵌入式数据库，如 SQLite 或消息队列或一些对象存储，或者（如果这些都不能使用，因为它是一个 Web 应用程序）通过 HTML 5 的[LocalStorage](http://diveintohtml5.org/storage.html) API使用 Web DB 或[IndexedDB](http://www.w3.org/TR/IndexedDB/)保存在客户端上的文件/文档.

查看论文[Gold Rush: Mobile Transaction Middleware with Java-Object Replication](http://www.usenix.org/publications/library/proceedings/coots97/full_papers/butrico/butrico_html/)。Microsoft 的偶尔连接系统文档描述了两种方法：面向服务或面向消息和面向数据。淘金热采取了较早的方法。后一种方法使用数据库合并复制。

# c++ - 使用 C++ 解析文件，将值加载到结构中

> ID：271612
> 
> 赞同：4
> 
> 时间：2008-11-07T09:25:33.700
> 
> 标签：c++, file, parsing

我有以下文件/行：

```
pc=1 ct=1 av=112 cv=1100 cp=1700 rec=2 p=10001 g=0 a=0 sz=5 cr=200
pc=1 ct=1 av=113 cv=1110 cp=1800 rec=2 p=10001 g=0 a=10 sz=5 cr=200 
```

等等。我希望解析这个并获取键值对并将它们放在一个结构中：

```
struct pky
{
    pky() :
      a_id(0),
      sz_id(0),
      cr_id(0),
      cp_id(0),
      cv_id(0),
      ct_id(0),
      fr(0),
      g('U'),
      a(0),
      pc(0),
      p_id(0)
    { }
}; 
```

其中要么使用所有结构字段，要么可以省略一些结构字段。

如何创建一个 C++ 类，它会做同样的事情？我是 C++ 新手，不知道有任何函数或库可以完成这项工作。

每一行都将被处理，并且在刷新之前每次都会使用一行填充该结构并使用它。该结构稍后用作函数的参数。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T09:53:14.890

你可以这样做：

```
std::string line;
std::map<std::string, std::string> props;
std::ifstream file("foo.txt");
while(std::getline(file, line)) {
    std::string token;
    std::istringstream tokens(line);
    while(tokens >> token) {
        std::size_t pos = token.find('=');
        if(pos != std::string::npos) {
            props[token.substr(0, pos)] = token.substr(pos + 1);
        }
    }

    /* work with those keys/values by doing properties["name"] */
    Line l(props["pc"], props["ct"], ...);

    /* clear the map for the next line */
    props.clear();
} 
```

我希望它会有所帮助。行可以是这样的：

```
struct Line { 
    std::string pc, ct; 
    Line(std::string const& pc, std::string const& ct):pc(pc), ct(ct) {

    }
}; 
```

现在只有在分隔符是空格时才有效。您也可以使其与其他分隔符一起使用。改变

```
while(tokens >> token) { 
```

例如，如果您想使用分号，请输入以下内容：

```
while(std::getline(tokens, token, ';')) { 
```

实际上，看起来您只有整数作为值，而空格作为分隔符。你可能想改变

```
 std::string token;
    std::istringstream tokens(line);
    while(tokens >> token) {
        std::size_t pos = token.find('=');
        if(pos != std::string::npos) {
            props[token.substr(0, pos)] = token.substr(pos + 1);
        }
    } 
```

然后进入这个：

```
 int value;
    std::string key;
    std::istringstream tokens(line);
    while(tokens >> std::ws && std::getline(tokens, key, '=') && 
          tokens >> std::ws >> value) {
            props[key] = value;
    } 
```

`std::ws`只是吃空白。您应该将道具的类型更改为

```
std::map<std::string, int> props; 
```

然后也让 Line 接受 int 而不是 std::string 的。我希望这不是一次太多的信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T14:41:13.627

这是为您的结构定义流运算符的理想场所：

```
#include <string>
#include <fstream>
#include <sstream>
#include <istream>
#include <vector>
#include <algorithm>
#include <iterator>

std::istream& operator>> (std::istream& str,pky& value)
{
    std::string line;
    std::getline(str,line);

    std::stringstream dataStr(line);

    static const std::streamsize max = std::numeric_limits<std::streamsize>::max();

    // Code assumes the ordering is always as follows
    // pc=1 ct=1 av=112 cv=1100 cp=1700 rec=2 p=10001 g=0 a=0 sz=5 cr=200
    dataStr.ignore(max,'=') >> value.pc;
    dataStr.ignore(max,'=') >> value.ct_id;
    dataStr.ignore(max,'=') >> value.a; // Guessing av=
    dataStr.ignore(max,'=') >> value.cv_id;
    dataStr.ignore(max,'=') >> value.cp_id;
    dataStr.ignore(max,'=') >> value.fr; // Guessing rec=
    dataStr.ignore(max,'=') >> value.p_id;
    dataStr.ignore(max,'=') >> value.g;
    dataStr.ignore(max,'=') >> value.a_id;
    dataStr.ignore(max,'=') >> value.sz_id;
    dataStr.ignore(max,'=') >> value.cr_id;

    return str;
}

int main()
{
    std::ifstream  file("plop");

    std::vector<pky>  v;
    pky data;

    while(file >> data)
    {
        // Do Somthing with data
        v.push_back(data);
    }

    // Even use the istream_iterators
    std::ifstream    file2("plop2");
    std::vector<pky> v2;

    std::copy(std::istream_iterator<pky>(file2),
              std::istream_iterator<pky>(),
              std::back_inserter(v2)
             );
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T10:01:06.450

这似乎奏效了。当然，您会提取我在 main 中编写的代码并将其粘贴到类或其他东西中，但您明白了。

```
#include <sstream>
#include <string>
#include <vector>
#include <map>

using namespace std;

vector<string> Tokenize(const string &str, const string &delim)
{
    vector<string> tokens;

    size_t p0 = 0, p1 = string::npos;
    while(p0 != string::npos)
    {
        p1 = str.find_first_of(delim, p0);
        if(p1 != p0)
        {
            string token = str.substr(p0, p1 - p0);
            tokens.push_back(token);
        }
        p0 = str.find_first_not_of(delim, p1);
    }

    return tokens;
}

int main()
{
    string data = "pc=1 ct=1 av=112 cv=1100 cp=1700 rec=2 p=10001 g=0 a=0 sz=5 cr=200 pc=1 ct=1 av=113 cv=1110 cp=1800 rec=2 p=10001 g=0 a=10 sz=5 cr=200";
    vector<string> entries = Tokenize(data, " ");
    map<string, int> items;

    for (size_t i = 0; i < entries.size(); ++i)
    {
        string item = entries[i];

        size_t pos = item.find_first_of('=');
        if(pos == string::npos)
            continue;

        string key = item.substr(0, pos);
        int value;
        stringstream stream(item.substr(pos + 1));
        stream >> value;
        items.insert (pair<string, int>(key, value));
    }

} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T09:51:38.607

不幸的是，您的源数据文件是面向人的，这意味着您将不得不进行大量字符串解析才能将其放入结构中。否则，如果数据直接作为二进制文件写入，您可以使用 fread() 将其直接弹出到结构中。

如果你想使用“优雅”（即丑陋的简约方法），你可以做一个循环来解析每一行，基本上使用 strchr() 首先找到'='字符，然后是下一个空格，然后使用atoi() 将每个数字转换为真正的 int，然后使用一些指针黑客将它们全部推送到结构中。明显的缺点是，如果结构发生变化，或者甚至以某种方式重新组织，那么这里的整个算法就会悄无声息地崩溃。

因此，对于更易于维护和可读的东西（但会产生更多代码），您可以将每个值推入一个向量中，然后遍历该向量并将每个值复制到适当的结构字段中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-13T06:44:43.460

你在这里学到的是**怪物**。

[http://en.wikipedia.org/wiki/Scanf](http://en.wikipedia.org/wiki/Scanf)

不要使用此功能从不受信任的数据中提取字符串，但只要您信任数据，或者只获取数字，为什么不呢。

如果您通过使用另一种语言熟悉正则表达式，请使用`std::tr1::regex`或`boost::regex`- 它们是相同的。如果不熟悉，您将通过熟悉自己来帮自己一个忙。

# java - 在最近的 JVM 中，不可见的引用仍然是一个问题吗？

> ID：271613
> 
> 赞同：24
> 
> 时间：2008-11-07T09:25:46.803
> 
> 标签：java, memory-leaks, garbage-collection, jvm, sun

我正在阅读*[Java 平台性能](http://java.sun.com/docs/books/performance/1st_edition/html/JPAppGC.fm.html)*（遗憾的是，自从我最初提出这个问题以来，该链接似乎已经从互联网上消失了），第 A.3.3 节让我担心。

我一直在假设退出范围的变量将不再被视为 GC 根，但本文似乎与此相矛盾。

最近的 JVM，尤其是 Sun 的 1.6.0_07 版本，是否还有这个限制？如果是这样，那么我有很多代码要分析......

我问这个问题是因为这篇论文是 1999 年的——有时情况会发生变化，尤其是在 GC 领域。

* * *

由于该论文不再可用，我想解释一下这个问题。该论文暗示在方法内定义的变量将被视为 GC 根，直到方法退出，而不是直到代码块结束。因此，必须将变量设置为 null 以允许对引用的对象进行垃圾收集。

这意味着在 main() 方法（或包含无限循环的类似方法）的条件块中定义的局部变量将导致一次性内存泄漏，除非您在变量退出范围之前将其置空。

[所选答案](https://stackoverflow.com/a/271824/7938)中的代码很好地说明了这个问题。在文档中引用的 JVM 版本上，当 foo 对象在 try 块结束时超出范围时，无法进行垃圾回收。相反，JVM 将保持打开引用直到 main() 方法结束，即使任何东西都不可能使用该引用。

这似乎是一个想法的起源，即使变量引用为空将有助于垃圾收集器，即使该变量即将退出范围。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T11:33:53.737

这段代码应该清除它：

```
public class TestInvisibleObject{
  public static class PrintWhenFinalized{
    private String s;
    public PrintWhenFinalized(String s){
      System.out.println("Constructing from "+s);
      this.s = s;
    }
    protected void finalize() throws Throwable {
      System.out.println("Finalizing from "+s);
    }   
  }
  public static void main(String[] args) {
    try {
        PrintWhenFinalized foo = new PrintWhenFinalized("main");
    } catch (Exception e) {
        // whatever
    }
    while (true) {
      // Provoke garbage-collection by allocating lots of memory
      byte[] o = new byte[1024];
    } 
  }
} 
```

在我的机器（jdk1.6.0_05）上打印：

> 从主构建
> 
> 从主要完成

所以看起来问题已经解决了。

请注意，使用 System.gc() 代替循环不会由于某种原因导致对象被收集。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-08-23T15:01:34.523

问题仍然存在。我用 Java 8 对其进行了测试，并且可以证明这一点。

你应该注意以下几点：

1.  强制进行有保证的垃圾回收的唯一方法是尝试以 OutOfMemoryError 结束的分配，因为 JVM 需要在抛出之前尝试释放未使用的对象。但是，如果请求的数量太大而无法成功，即超出地址空间，则此方法不成立。尝试提高分配直到获得 OOME 是一个很好的策略。

2.  第 1 点中描述的保证 GC 不保证最终确定。未指定调用 finalize() 方法的时间，它们可能根本不会被调用。所以给一个类添加 finalize() 方法可能会阻止它的实例被收集，所以 finalize 不是分析 GC 行为的好选择。

3.  在局部变量超出范围后创建另一个新的局部变量将重用其在堆栈帧中的位置。在下面的示例中，对象 a 将被收集，因为它在堆栈帧中的位置被局部变量 b 占用。但是 b 一直持续到 main 方法的末尾，因为没有其他局部变量可以占据它的位置。

    ```
    import java.lang.ref.*;

    public class Test {
        static final ReferenceQueue<Object> RQ=new ReferenceQueue<>();
        static Reference<Object> A, B;
        public static void main(String[] s) {
            {
                Object a=new Object();
                A=new PhantomReference<>(a, RQ);
            }
            {
                Object b=new Object();
                B=new PhantomReference<>(b, RQ);
            }
            forceGC();
            checkGC();
        }

        private static void forceGC() {
            try {
                for(int i=100000;;i+=i) {
                  byte[] b=new byte[i];
                }
            } catch(OutOfMemoryError err){ err.printStackTrace();}
        }

        private static void checkGC() {
            for(;;) {
                Reference<?> r=RQ.poll();
                if(r==null) break;
                if(r==A) System.out.println("Object a collected");
                if(r==B) System.out.println("Object b collected");
            }
        }
    } 
    ```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T12:34:19.310

文章指出：

> ...当超出范围时，JVM 的有效实现不太可能将引用归零

我认为发生这种情况是因为这样的情况：

```
public void doSomething() {  
    for(int i = 0; i < 10 ; i++) {
       String s = new String("boo");
       System.out.println(s);
    }
} 
```

在这里，“高效 JVM”在 String 的每个声明中都使用了相同的引用，但如果 GC 没有启动，堆中将有 10 个新字符串。

在文章示例中，我认为对 foo 的引用保留在堆栈中，因为“高效 JVM”*认为*这很可能会创建另一个 foo 对象，如果是这样，它将使用相同的引用。想法？？？

```
public void run() {
    try {
        Object foo = new Object();
        foo.doSomething();
    } catch (Exception e) {
        // whatever
    }
    while (true) { // do stuff } // loop forever
} 
```

我还使用分析执行了下一个测试：

```
public class A {

    public static void main(String[] args) {
        A a = new A();  
        a.test4();
    }

    public void test1() {  
        for(int i = 0; i < 10 ; i++) {
           B b = new B();
           System.out.println(b.toString());
        }
        System.out.println("b is collected");
    }

    public void test2() {
        try {
            B b = new B();
            System.out.println(b.toString());
        } catch (Exception e) {
        }
        System.out.println("b is invisible");
    }

    public void test3() {
        if (true) {
            B b = new B();
            System.out.println(b.toString());
        }
        System.out.println("b is invisible");
    }

    public void test4() {
        int i = 0;
        while (i < 10) {
            B b = new B();
            System.out.println(b.toString());
            i++;
        }
        System.out.println("b is collected");
    }

    public A() {
    }

    class B {
        public B() {
        }

        @Override
        public String toString() {
            return "I'm B.";
        }
    }
} 
```

并得出结论：

teste1 -> b 被收集

teste2 -> b 是不可见的

teste3 -> b 是不可见的

teste4 -> b 被收集

...所以我认为，在循环中，JVM 在循环结束时不会创建不可见的变量，因为它们不太可能在循环外再次声明。

有什么想法吗？？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T09:42:49.763

你真的有那么多代码要分析吗？基本上我只能看到对于非常长时间运行的方法来说这是一个重大问题——这些方法通常只是每个线程堆栈顶部的方法。

如果它目前未修复，我一点也不感到惊讶，但我认为它可能不像你担心的那样重要。

# c# - 使用 linq 更新对象的性能更好

> ID：271615
> 
> 赞同：2
> 
> 时间：2008-11-07T09:26:17.160
> 
> 标签：c#, linq, performance, optimization, linq-to-objects

我有两个自定义对象列表，如果另一个列表中有一个与另一对字段匹配的对象，我想更新一个列表中所有对象的字段。

这段代码更好地解释了问题并产生了我想要的结果。然而，对于较大的 20k 列表和具有匹配对象的 20k 列表，这需要相当长的时间（31 秒）。通过使用通用列表 Find(Predicate) 方法，我可以将这一点提高约 50%。

```
using System;
using System.Linq;
using System.Linq.Expressions;
using System.Collections.Generic;
namespace ExperimentFW3
{
    public class PropValue
    {
        public string Name;
        public decimal Val;
        public decimal Total;
    }
    public class Adjustment
    {
        public string PropName;
        public decimal AdjVal;
    }
    class Program
    {
        static List<PropValue> propList;
        static List<Adjustment> adjList;

        public static void Main()
        {
            propList = new List<PropValue>{
                new PropValue{Name = "Alfa", Val=2.1M},
                new PropValue{Name = "Beta", Val=1.0M},
                new PropValue{Name = "Gamma", Val=8.0M}
            };
            adjList = new List<Adjustment>{
                new Adjustment{PropName = "Alfa", AdjVal=-0.1M},
                new Adjustment{PropName = "Beta", AdjVal=3M}
            };

            foreach (var p in propList)
            {
                Adjustment a = adjList.SingleOrDefault(
                    av => av.PropName.Equals(p.Name)
                    );
                if (a != null)
                    p.Total = p.Val + a.AdjVal;
                else
                    p.Total = p.Val;
            }
        }
    }
} 
```

期望的结果是：Alfa total=2,Beta total=4,Gamma total=8

但我想知道这是否有可能做得更快。即使在结果集中循环超过 20k 个项目时，内部加入这两个列表也需要很少的时间。

```
var joined = from p in propList
             join a in adjList on p.Name equals a.PropName
             select new { p.Name, p.Val, p.Total, a.AdjVal }; 
```

所以我的问题是，是否有可能像使用 T-SQL 那样做一些事情？对调整值使用 ISNULL(val,0) 的左连接的 UPDATE。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T09:47:30.927

该连接应该相当快，因为​​它将首先遍历所有`adjList`元素以创建查找，然后对于其中的每个元素`propList`将只使用查找。这比您在较大代码中的 O(N * M) 方法更快 - 尽管可以通过在循环之前调用[`ToLookup`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.tolookup.aspx)（或者[`ToDictionary`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.todictionary.aspx)您只需要一个值）来轻松修复。`adjList`

编辑：这是使用`ToDictionary`. 未经测试，请注意...

```
var adjDictionary = adjList.ToDictionary(av => av.PropName);
foreach (var p in propList)
{
    Adjustment a;
    if (adjDictionary.TryGetValue(p.Name, out a))
    {
        p.Total = p.Val + a.AdjVal;
    }
    else
    {
        p.Total = p.Val;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T14:06:26.583

如果 adjList 可能有重复的名称，您应该在推送到字典之前对项目进行分组。

```
Dictionary<string, decimal> adjDictionary = adjList
  .GroupBy(a => a.PropName)
  .ToDictionary(g => g.Key, g => g.Sum(a => a.AdjVal))

propList.ForEach(p => 
  {
    decimal a;
    adjDictionary.TryGetValue(p.Name, out a);
    p.Total = p.Val + a;
  }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-19T11:35:32.887

我知道我发布此内容迟了，但我认为有人会欣赏下面更清晰的简短答案，该答案在 adjList 中处理每次查找的多个记录。创建 LookUp 将允许对多个项目进行快速查找，如果 LookUp 中没有记录，将返回一个空列表。

```
var adjLookUp = adjList.ToLookUp(a => a.PropName);
foreach (var p in propList) 
    p.Total = p.Val + adjLookUp[p.Name].Sum(a => a.AdjVal); 
```

# python - 在 Eclipse 中使用 Pydev 的交互式控制台？

> ID：271625
> 
> 赞同：36
> 
> 时间：2008-11-07T09:34:27.533
> 
> 标签：python, debugging, console, pydev, interactive

我正在使用 Pydev 插件在 Eclipse 中调试我的 Python 代码。我可以打开一个 Pydev 控制台，它给了我两个选项：“当前活动编辑器的控制台”和“Python 控制台”。但是，它们对于在断点后检查当前变量状态都没有用。

例如，代码在断点处停止，我想使用控制台检查“动作”变量。但是我的变量不可用。我该如何做诸如“dir（action）”之类的事情？（即使它没有使用控制台）。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-04T15:02:58.013

此处记录了此功能：

[http://pydev.org/manual_adv_debug_console.html](http://pydev.org/manual_adv_debug_console.html)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-01-22T14:38:10.547

在调试透视图中打开的控制台实际上是交互式的，尽管我花了一段时间才意识到这一点。输入内容后，您需要按两次回车键，然后对其进行评估。有关 Pydev 网站的更多信息：http: [//pydev.org/manual_adv_debug_console.html](http://pydev.org/manual_adv_debug_console.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T10:16:48.930

双击“动作”或任何其他变量。

Ctrl+Shift+D

如果你使用手表，我无法想象更好的互动。你可以看到每一个变化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-12T19:38:48.240

当我设置断点并按 F11 时，Eclipse 会启动调试器并提示打开“Debug Perspective”。然后您可以打开 Window-->Show View --> Expressions 打开表达式视图，然后您可以右键单击表达式视图窗口并选择“添加监视表达式”以添加任何表达式（例如 dir）相反我是还可以在 PyDev 控制台中输入 dir(some expression) 并获得相同的效果。我正在使用 PyDev 1.4.6.2788

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-21T20:16:44.180

在小型显示器上，您可能没有意识到调试交互式控制台与常规交互式控制台不同：它在您键入的底部有第二个命令提示符，而不是像普通控制台那样在顶部。

# c# - 如何在运行时向 ItemTemplate (Repeater) 添加控件？

> ID：271637
> 
> 赞同：2
> 
> 时间：2008-11-07T09:43:17.207
> 
> 标签：c#, repeater

我正在设计一个丰富的中继器控件，它需要在运行时添加一些控件（特别是一个无序列表）。

我选择的解决方案是将必要的标记 onInit 分别注入到页眉、项目和页脚模板中。
我可以取出模板（使用 InstantiateIn），然后根据需要添加标记，但我不知道如何将模板添加回转发器？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T11:47:25.287

在过去，我只是简单地处理[`ItemDataBound Event`](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.repeater.onitemdatabound.aspx "MSDN-Repeater.ItemDataBound 事件")并修改了当前`RepeaterItem`需要做的任何事情。

例子：

```
private void Repeater1_ItemDataBound(object Sender, RepeaterItemEventArgs e)
{
    // Make sure you filter for the item you are after
    if ((e.Item.ItemType == ListItemType.Item) || (e.Item.ItemType == ListItemType.AlternatingItem))
    {
        PlaceHolder listLocation = (PlaceHolder)e.Item.FindControl("listPlaceHolder");
        var subItems = ((MyClass)e.Item.DataItem).SubItems;

        listLocation.Controls.Add(new LiteralControl("<ul>");

        foreach(var item in subItems)
        {
            listLocation.Controls.Add(new LiteralControl("<li>" + item + "</li>"));
        }

        listLocation.Controls.Add(new LiteralControl("</ul>");
    }
} 
```

# python - 如何判断字符串是否为base64

> ID：271657
> 
> 赞同：6
> 
> 时间：2008-11-07T09:54:34.827
> 
> 标签：python, jython, base64, mime

我有很多来自不同来源的电子邮件。他们都有附件，其中许多都有中文的附件名称，因此这些名称被他们的电子邮件客户端转换为base64。

当我收到这些电子邮件时，我希望解码名称。但还有其他名称不是 base64。如何使用**jython**编程语言区分字符串是否为 base64？

IE。

第一个附件：

```
------=_NextPart_000_0091_01C940CC.EF5AC860
Content-Type: application/vnd.ms-excel;
 name="Copy of Book1.xls"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="Copy of Book1.xls" 
```

第二个附件：

```
------=_NextPart_000_0091_01C940CC.EF5AC860
Content-Type: application/vnd.ms-excel;
 name="=?gb2312?B?uLGxvmhlbrixsb5nLnhscw==?="
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="=?gb2312?B?uLGxvmhlbrixsb5nLnhscw==?=" 
```

请注意“ **Content-Transfer-Encoding** ”都有 base64

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-07T10:35:59.157

标头值告诉您：

```
=?gb2312?B?uLGxvmhlbrixsb5nLnhscw==?=

“=？” 引入一个编码值
“gb2312”表示原始值的字符编码
“B”表示使用了 B 编码（等于 Base64）（替代
         是“Q”，它指的是接近引用可打印的东西）
“？” 用作分隔符
"uLG..." 是实际值，使用之前指定的编码进行编码
"?=" 结束编码值

```

所以分裂“？” 实际上得到你这个（JSON符号）

```
["=", "gb2312", "B", "uLGxvmhlbrixsb5nLnhscw==", "="]

```

在结果数组中，如果“B”在位置 2，你在位置 3 上面对一个 base-64 编码的字符串。一旦你解码它，一定要注意位置 1 上的编码，可能最好转换使用该信息将整个过程转换为 UTF-8。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-07T11:38:38.970

> 请注意两者`Content-Transfer-Encoding`都有 base64

在这种情况下不相关，`Content-Transfer-Encoding`仅适用于正文有效负载，不适用于标头。

```
=?gb2312?B?uLGxvmhlbrixsb5nLnhscw==?= 
```

那是一个**RFC2047**编码的标头原子。解码它的 stdlib 函数是`email.header.decode_header`. 不过，它仍然需要一些后处理来解释该函数的结果：

```
import email.header
x= '=?gb2312?B?uLGxvmhlbrixsb5nLnhscw==?='
try:
    name= u''.join([
        unicode(b, e or 'ascii') for b, e in email.header.decode_header(x)
    ])
except email.Errors.HeaderParseError:
    pass # leave name as it was 
```

然而...

```
Content-Type: application/vnd.ms-excel;
 name="=?gb2312?B?uLGxvmhlbrixsb5nLnhscw==?=" 
```

这是完全错误的。哪个邮件程序创建了它？RFC2047 编码只能发生在原子中，并且带引号的字符串不是原子。RFC2047 §5 明确否认这一点：

> *   “编码字”不得出现在“引用字符串”中。

当存在长字符串或 Unicode 字符时，对参数标头进行编码的公认方法是**RFC2231**，这是一个全新的伤害包。但是你应该使用一个标准的邮件解析库来为你解决这个问题。

因此，您可以根据需要检测`'=?'`文件名参数，并尝试通过 RFC2047 对其进行解码。但是，严格来说正确的做法是信守邮件并真正调用文件`=?gb2312?B?uLGxvmhlbrixsb5nLnhscw==?=`！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-07T10:24:32.753

@gnud，@edg - 除非我误解，否则他是在询问文件名，而不是文件内容 @setori - Content-Trasfer-Encoding 告诉您文件的内容是如何编码的，而不是“文件名”。

我不是专家，但文件名中的这一部分告诉他后面的字符：

=?gb2312?B?

我正在寻找 RFC 中的文档……啊！这里是：[https ://www.rfc-editor.org/rfc/rfc2047](https://www.rfc-editor.org/rfc/rfc2047)

RFC 说：

***通常，“编码字”是一系列可打印的 ASCII 字符，以“=?”开头，以“?=”结尾，中间有两个“?”。***

其他要查看的是 SharpMimeTools 中的代码，这是我在[错误跟踪](http://ifdefined.com/bugtrackernet.html)应用程序[BugTracker.NET中使用的 MIME 解析器（C# 中）](http://ifdefined.com/bugtrackernet.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-06T13:58:52.103

有比 bobince 的方法更好的方法来处理`decode_header`. 我在这里找到它：http: [//mail.python.org/pipermail/email-sig/2007-March/000332.html](http://mail.python.org/pipermail/email-sig/2007-March/000332.html)

```
name = unicode(email.header.make_header(email.header.decode_header(x))) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T10:17:08.820

好吧，您将电子邮件标题解析为字典。然后检查是否设置了 Content-Transfer-Encoding，以及它是否 = "base64" 或 "base-64"。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-02T08:14:45.810

问题：“”“另外我实际上需要知道它是什么类型的文件，即 .xls 或 .doc 所以我确实需要解码文件名才能正确处理附件，但如上所述，jython 似乎不支持 gb2312 ，知道任何环岛吗？"""

数据：

```
Content-Type: application/vnd.ms-excel;
 name="=?gb2312?B?uLGxvmhlbrixsb5nLnhscw==?=" 
```

观察：

(1) 第一行表示 Microsoft Excel，所以`.xls`看起来比`.doc`

(2)

```
>>> import base64
>>> base64.b64decode("uLGxvmhlbrixsb5nLnhscw==")
'\xb8\xb1\xb1\xbehen\xb8\xb1\xb1\xbeg.xls'
>>> 
```

(a) 扩展名似乎是`.xls`——不需要`gb2312`编解码器
(b) 如果你想要一个文件系统安全的文件名，你可以使用 base64 的“-_”变体，或者你可以对其进行百分比编码
（c ) 对于它的价值，文件名是`XYhenXYg.xls`其中 X 和 Y 是 2 个中文字符，它们一起表示“复制”，其余的是文字 ASCII 字符。

# asp.net - Lucene.NET --> 拒绝访问段

> ID：271661
> 
> 赞同：3
> 
> 时间：2008-11-07T09:56:54.930
> 
> 标签：asp.net, lucene.net, access-denied, segments

我对 Lucene.NET 有疑问。在索引期间，我收到错误“拒绝访问路径段”。或者有时“拒绝访问可删除的路径”。我最终给了“所有人”对索引目录的完全安全权限，但问题仍然存在。

然后我发现在索引运行期间，lucene将segments文件重命名为'segments.new'，*然后*发生了这个错误。我猜有些进程在重命名后仍然试图从旧的段文件中读取？我不知道为什么会发生这种情况，或者如何解决这个问题。奇怪的是，我的合作开发者可以毫无问题地在他们的计算机上运行索引。

错误发生在 Lucene.Net.Index.IndexModifier.AddDocument(Document) 中。

任何想法将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-11T04:22:20.980

我支持 Imma 的解决方案。我也有这个问题。对我来说，解决方法是将 try/catch 放在 IndexWriter.AddDocument(doc) 周围：

```
 int attemptNo = 0;
 while (attemptNo < 2)
 {
    try
    {
       writer.AddDocument(doc);
       break;
    }
    catch (Exception e)
    {
       String ErrMsg = String.Format("{0} ({1}): While adding Document {2}/{3}, caught {4}", DateTime.Now, attemptNo, doc.GetField("kanji").StringValue(), doc.GetField("kana").StringValue(), e.Message);
       attemptNo++;
       System.Threading.Thread.Sleep(30);
       Application.Current.Dispatcher.Invoke(System.Windows.Threading.DispatcherPriority.Normal, (Action)delegate()
       {
          ViewModel.Log.Add(ErrMsg);
       });
    } 
```

参考： http: [//issues.apache.org/jira/browse/LUCENE-665](http://issues.apache.org/jira/browse/LUCENE-665)：

“问题的要点是：在 Windows 上，您有时会在将segments.new 重命名为segments 或将deletable.new 重命名为可删除等时看到间歇性的“拒绝访问”错误。Lucene 通常先将文件写入X.new，然后重命名为X。”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-25T01:55:40.803

我想我找到了一个解决方案..至少它对我有用..我正在测试“segments.new”问题，下面你有代码..所以你可以在循环中看到我创建了数千个 lucene 文档（6000）.. 在大约 1360 文档出现一个错误，说他无法重命名 blablabla.. 代码是用 c# 编写的.. 基本上你只需要为错误插入一个 try catch（在循环内），当弹出错误，您只需再次尝试将 int 循环数 (y) 减一 (y = y - 1) ..

//-----------------**问题**------------------ --------

for (int y = 0; y < 6000; y++) { Document doc = new Document();

```
 doc.Add(new Field("URL", "C:/Users/blabla/(convert-csharp)/IMssg", Field.Store.YES, Field.Index.TOKENIZED));

 writer.AddDocument(doc); 
```

}

//--------------------**解决方案**---------------------------- -------------

IndexWriter writer = new IndexWriter("C:/Users/blabla/(convert-csharp)/IMssg", new StandardAnalyzer(), false);

for (int y = 0; y < 6000; y++) { 尝试 {

```
 Document doc = new Document();

 doc.Add(new Field("URL", "C:/Users/blabla/(convert-csharp)/IMssg", Field.Store.YES, Field.Index.TOKENIZED));

 writer.AddDocument(doc);

  }
   catch (Exception t) 
  {

   y = (y < 0) ? 0 : y - 1;

   string gfff = t.Message.ToString();

   } 
```

}

writer.Close();

我不是英国人，如果某个词有任何错误，我很抱歉……现在考虑到 immanouel

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T11:04:32.600

此问题是由锁定段（.new）文件的在线病毒扫描程序引起的。我不得不编写一个自定义的 Lucene Directory 实现来解决这个问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T10:14:41.883

我怀疑您的 IndexModifier 与 Searcher 争用。

这是我在[错误跟踪](http://ifdefined.com/bugtrackernet.html)应用程序[BugTracker.NET](http://ifdefined.com/bugtrackernet.html)中使用 Lucene.Net 的方法，它似乎工作正常。

我在应用程序启动时创建索引。

我创建了一个搜索器并保留它，这样每次搜索都不会重新加载索引。所有线程共享同一个搜索器。当搜索器搜索时，它会抓取一个锁，搜索，然后释放锁，以便另一个线程可以搜索。在我的应用程序中强制搜索到单个文件是可行的，因为 Lucene.NET 速度很快，并且错误跟踪系统并不那么忙。

同时，我有一个 IndexWriter 可以在数据发生更改时更新索引。它只是发生了一点变化，因此它也可以快速完成任务。当它需要运行时，它会获取相同的锁，销毁搜索器，更新索引，然后重新创建搜索器。新的搜索器会一直存在，直到索引的下一次更新。搜索者总是使用最新的索引。

您可以获取 BugTracker.NET 源代码并查看文件 my_lucene.cs 和 search_text.aspx。这一切都在这两个文件中，并且没有那么多代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-24T08:15:53.080

我读到了这个。但是，我没有运行任何病毒扫描程序。我还为索引目录禁用了 Vista 搜索索引，从任务管理器中终止了搜索索引进程，以确保没有其他进程锁定文件。不幸的是，无济于事。此外，问题似乎更多的是它试图访问的“段”文件*已经消失*（因为 lucene 将其重命名为segments.new）。我不确定它们是否是相同的问题...

# axis2 - 在 AXIS2 中关闭 HTTP 分块时出现问题

> ID：271665
> 
> 赞同：0
> 
> 时间：2008-11-07T09:59:01.777
> 
> 标签：axis2, transfer-encoding, chunked-encoding

我有一个客户端在没有 HTTP 分块的情况下向我发送请求（它们使用内容长度）。当我的服务器响应时，分块被启用，客户端无法处理这个 - 即使他们应该能够使用 HTTP 1.1 .....

我试图通过从axis2配置文件（axis2.xml）中删除下面的条目来禁用分块，但响应仍然是分块的。

分块

所以问题是，是否还有其他地方启用了覆盖axis2设置的分块？也许在tomcat设置中？

网络服务器详细信息 - tomcat 6.0.16、axis2 2.1.3

谢谢迈克

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-15T14:59:13.157

您可以按如下方式以编程方式禁用分块：

选项选项 = 新选项（）；[...] options.setProperty(HTTPConstants.CHUNKED, "false");

资料来源：http: [//jcesarperez.blogspot.com/2008/10/resolviendo-problemas-de.html](http://jcesarperez.blogspot.com/2008/10/resolviendo-problemas-de.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-08T14:48:15.627

如果您为 Web 服务创建了存根，只需执行以下操作：

`myStub._getServiceClient().getOptions().setProperty(HTTPConstants.CHUNKED, false);`

# maintenance - 100万左右的知名项目。代码行？

> ID：271666
> 
> 赞同：0
> 
> 时间：2008-11-07T09:59:13.727
> 
> 标签：maintenance

我知道这个问题对我的情况非常具体，似乎不会对社区有太多好处，但对于某些人来说，看看我们是否能得到一些好的答案可能会很有趣。

有谁知道任何代码行数约为 100 万的项目？

我正在将一些东西放在一起进行管理，我希望将我们的软件（大约 100 万行代码）与其他一些软件进行比较。

我知道使用代码行在很多方面都存在很大争议，比如衡量生产力；然而，我想做的是使用这个统计数据作为我们产品持续维护的一小部分更大的演示。

维基百科有一些示例（[源代码行 - 维基百科](http://en.wikipedia.org/wiki/Source_lines_of_code#Example)），但它们太大了。

任何帮助是极大的赞赏。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T10:08:37.187

只是一个想法。如何检查[http://www.ohloh.net/](http://www.ohloh.net/)

您很可能会使用他们的 API 找到一些类似的项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T10:14:21.777

我真的不明白你在找什么？只是一些有大约 100 万行代码的项目名称？

我对这样的指标也不感兴趣......代码行数**真的很**主观，恕我直言。这取决于开发人员编写代码的方式，如何处理格式化......例如，在字符 80 处换行将比在第 150 列处换行产生更多的 LoC。此外，注释（或每个开头的许可证信息）文件）真的可以增加 LoC 的数量！

为了您的信息，[Sonar](http://sonar.codehaus.org)可以帮助您完成任务（它使用[JavaNCSS](http://www.kclee.de/clemens/java/javancss/)工具来测量这些信息）。在[在线演示](http://nemo.sonar.codehaus.org)中，您可以看到一些开源项目的此信息（只需在“树形图”上移动鼠标），但在这里，您将只有大约 100K LoC 的项目。

# .net - 如何从特殊文件夹转换为完整文件名

> ID：271668
> 
> 赞同：0
> 
> 时间：2008-11-07T10:00:40.197
> 
> 标签：.net, windows-vista, windows-xp

有没有办法将特殊文件夹路径转换为完整的文件名（并返回），还是我需要自己编写代码（我不知道，但如果存在则没有意义）

例如，我想存储应用程序模板的文件名，然后用户可以更改它，它存在于 LocalApplicationData 文件夹中。

我想存储的是文件的位置，格式为：

%LOCALAPPDATA%\MyApp\Templates\Report Template.xls

这样这个应用程序文件就可以被许多用户使用，每个用户打开它时都会从他们自己的本地应用程序目录中获取报告模板。

我可以写

```
replace("%LOCALAPPDATA%", _
    System.Environment.GetFolderPath(
         System.Environment.SpecialFolder.LocalApplicationData))

and vice versa 
```

当我来保存文件位置时，是否有一个 System.IO （或类似的）调用来为我执行此操作，而不必遍历每个可能的特殊文件夹？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T10:12:37.847

看：[Environment.ExpandEnvironmentVariables](http://msdn.microsoft.com/en-us/library/system.environment.expandenvironmentvariables.aspx)

不过，环顾四周后，我认为没有内置的方法可以将其转换回来。

你可以这样做：

```
static void Main(string[] args)
{
    var values = Enum.GetValues(typeof(Environment.SpecialFolder));

    foreach (Environment.SpecialFolder value in values)
        Console.WriteLine(value + " : " + Environment.GetFolderPath(value));

    Console.ReadKey();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T10:43:45.740

识别“特殊文件夹”的正常 Windows 方法是通过它们的[CSIDL](http://msdn.microsoft.com/en-us/library/bb762494.aspx)。Environment.SpecialFolder 只是它的一个小包装。正如您所指出的，在对 chakrit 帖子的评论中，大多数 CSIDL 根本没有相应的环境变量。这可能是为什么没有功能可以为少数 CSIDL 找到环境变量的原因。

# java - J2ME 中的 Image.createImage 问题

> ID：271672
> 
> 赞同：0
> 
> 时间：2008-11-07T10:02:10.553
> 
> 标签：java, java-me, image.createimage

我在 J2ME 上试过这个

```
try {
    Image immutableThumb = Image.createImage( temp, 0, temp.length);
} catch (Exception ex) {
    System.out.println(ex);
} 
```

我遇到了这个错误： `java.lang.IllegalArgumentException:`

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T10:11:37.490

如果第一个参数的格式不正确或无法解码，Image.createImage() 将引发 IllegalArgumentException。（我假设 temp 是一个字节 []）。

[http://java.sun.com/javame/reference/apis/jsr118/javax/microedition/lcdui/Image.html#createImage(byte[],%20int,%20int)](http://java.sun.com/javame/reference/apis/jsr118/javax/microedition/lcdui/Image.html#createImage(byte[],%20int,%20int))

（此 URL 由于某种原因拒绝成为超链接（？））

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T11:11:47.447

很难说没有更多细节或更多周边代码，但我最初的怀疑是您尝试加载的文件是设备不支持的格式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-13T11:40:09.937

让我们看一下文档：抛出 IllegalArgumentException

> 如果 imageData 格式不正确或无法解码

因此，可能的原因可能是图像格式不受支持，也可能是数据被截断。请记住，您应该将整个文件传递给该方法，包括所有标题。如果您对格式有疑问，最好选择**PNG**，无论如何它必须支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-17T10:57:57.443

我的 MIDLET 也遇到了同样的问题，而我的问题是我从套接字的 InputStream 读取的 JPEG 图像附带的 HTTP 标头。我通过找到由两个字节标识的 JPEG SOI 标记来解决它：`FFD8`在我的字节数组中。然后，当我`FFD8`在我的字节数组中找到 的位置时，我会修剪代表 HTTP 标头的起始字节，然后我可以调用`createImage()`而不会引发任何异常...

您应该检查您是否属于这种情况。只需检查这是真的`(temp[0] == 0xFF && temp[1] == 0xD8)`，如果不是，修剪开头，`temp`以便删除 HTTP 标头或其他一些垃圾......

**PS** 我假设您正在阅读 JPEG 图像，如果没有，请在`temp`数组中查找适当的标题。

此外，如果这没有帮助，并且您正在阅读 JPEG 图像，请确保数组以（EOI 标记）开头`FFD8`和结尾。`FFD9`如果它没有以 EOI 结尾，就像我为 SOI 解释的那样修剪结尾……

**PPS** 如果您发现其中的数据`temp`是有效的，那么您的平台无法解码 JPEG 图像或图像`temp`对于 JPEG 解码器来说太大。

# winforms - DataGridView 中的只读行

> ID：271675
> 
> 赞同：4
> 
> 时间：2008-11-07T10:05:05.477
> 
> 标签：winforms

我有一个绑定的 DataGridView，其中取决于某些 BoundItem 属性值，该行将是只读的。实现这一点的最佳方法是什么？谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-07-04T22:50:19.847

尝试活动 CellBeginEdit

```
Private Sub Dgv_CellBeginEdit(ByVal sender As Object, ByVal e As System.Windows.Forms.DataGridViewCellCancelEventArgs) Handles Dgv.CellBeginEdit
  If YourCondition(BoundItem.Property) then e.cancel = true
End Sub 
```

这使单元格只读取决于您的条件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T10:10:46.340

在 rowenter 事件中，相应地设置该行的只读属性

```
private sub MyView_RowEnter(...) handles MyView.RowEnter
    MyView.Rows(e.Rowindex).ReadOnly = (condition)
end sub 
```

# c# - GDI+ 和 WPF 之间的 C# 转换

> ID：271686
> 
> 赞同：25
> 
> 时间：2008-11-07T10:14:19.327
> 
> 标签：c#, wpf, gdi+

我正在*考虑将*我的 c# 应用程序从使用自定义 GDI+ 绘制的控件迁移到具有自定义控件等的 WPF 应用程序。我想知道所涉及的内容和预期的内容。

人们可以推荐任何可能有帮助的资源吗？或者确实有任何可能有益的个人经历？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-11-08T18:14:24.523

*（我提前为这篇长文道歉……我想表达的东西太多了……我希望它对你有帮助。）*

这就是我们现在正在做的事情（将大量使用自定义 (GDI+) 绘制控件的 Windows 窗体应用程序迁移到 WPF）。事实上，我在团队中的角色是构建这些 GDI+ 控件……现在是构建 WPF 控件。

我同意 Bijington 的观点，即从头开始让您的应用程序完全 100% WPF 是要走的路……如果您能说服权力走这条路。但是，我们自己正在就地转换我们的 Windows 窗体应用程序，利用[WPF 互操作](http://msdn.microsoft.com/en-us/library/ms742522.aspx)功能。有一些限制，但总的来说，这是一种有效的方法（并不像我预期的那样令人沮丧）。

**我建议您使用您的 GDI+ 控件之一并在 WPF 中构建相同的控件。**然后，当你完成后，把它扔掉，然后再做一次。在第一次努力中，您总是会学到一些东西……并发现有更好的方法来代替。我会从一些小事开始……自定义按钮是一个很好的起点。

执行上述操作将使您了解您想做的所有其他事情都需要什么。

我要警告您的一件事是 WPF 的学习曲线，特别是如果您来自 Windows 窗体背景......特别是如果您要构建自定义外观控件。正如安倍所说，这是一个完全不同的世界。WPF 确实带来了很大的力量，但这种力量是以学习如何使用它为代价的。Abe 提到 WPF 中的自定义控件是如何“无外观”的，并且它们的“外观”可以通过 ControlTemplate 提供。这只是 WPF 中提供自定义外观的用户界面部分的众多方法之一。

让我列举一些额外的方法：

1.  使用 WPF 的样式功能设置现有控件的样式。
2.  利用 WPF 的内容模型和/或从 ContentControl 派生的控件。这允许您将任意外观的“内容”粘贴到控件的视觉效果中（例如，可能将自定义绘制的形状粘贴到按钮的中间）。
3.  利用 UserControl 从其他控件/元素组成控件。
4.  从 WPF 中的现有控件/类派生，扩展它的行为并提供一组不同的默认视觉效果。
5.  从 FrameworkElement 派生，通过重写部分或全部 MeasureOverride、ArrangeOverride 和 OnRender 方法创建自定义 WPF 元素。
6.  还有更多......如果你能相信的话。

在 Windows 窗体中，就像他们给了您一把锤子 (UserControl) 和一把螺丝刀 (Control)。但是，在 WPF 中……他们为您提供了包含所有 100 种工具的整个工具箱。这是学习曲线大于正常的部分原因。但是，现在您可以使用以前从未有过的锯子来锯掉 2x4 的末端，而不是使用锤子和/或螺丝刀来尝试做同样的事情。

### 资源

*（好消息是有很多资源可以帮助你。）*

1.  **图书**
    *   Chris Sells 和 Ian Griffiths 编写的 WPF 编程（特别是第 18 章）
    *   Matthew MacDonald 的 Pro WPF（特别是第 24 章）
    *   由 Adam Nathan 发布的 WPF（特别是第 16 章）
    *   应用程序 = 代码 + Charles Petzold 的标记（特别是第 10、11 和 12 章）
    *   Chris Anderson 的 Essential WPF（特别是第 3 章）

        我最喜欢的书是 Charles Petzold 的书和 Adam Nathan 的书。然而，Sells & Griffiths 编写的 Programming WPF 第 18 章确实很好地概述了该主题，特别是涵盖了以下问题：我真的需要自定义控件吗？
2.  **论坛**
    *   WPF[论坛](http://social.msdn.microsoft.com/Forums/en-US/wpf/threads/)
    *   StackOverflow
        这里有两篇你特别想看的帖子（[一](https://stackoverflow.com/questions/183315/what-are-the-best-resources-for-learning-wpf-net)、[二](https://stackoverflow.com/questions/129772/how-to-begin-wpf-development)）。
3.  **MSDN**
    我同意 Bijington 的观点，即[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms754130.aspx)非常出色。

4.  **博客**
    在我在[上面](https://stackoverflow.com/questions/129772/how-to-begin-wpf-development#154252)的论坛部分中引用的两篇 StackOverflow 文章中的一篇中，我指向了我的“必读”列表中的一组博客。特别是，我会特别指出[Pavan Podila](http://blog.pixelingene.com/)和[Kevin Moore](http://work.j832.com/)的博客。Kevin Moore 曾经是 WPF 控件的 WPF 程序经理，他有一组很好的控件，称为[WPF Bag-o-Tricks](http://j832.com/bagotricks/)，它们很有用，但更重要的是，您可以从中学习控件。

5.  **样品、样品和更多样品**
    那里只有大量样品。几乎太多了！我将指向[Family.Show](http://www.codeplex.com/familyshow)（它是作为 WPF 的端到端参考示例创建的），我将指向[WPF SDK 示例](http://msdn.microsoft.com/en-us/library/ms771633.aspx)，特别是该部分中的[控件自定义示例](http://msdn.microsoft.com/en-us/library/ms771268.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T17:38:18.853

为 WPF 开发控件的方式发生了范式转变。您只需定义预期的行为，而不是定义所有行为并查找控件。

这是迁移到 WPF 的最困难的方面。您的控件类定义了行为契约，并公开了将用于呈现的属性，并且 ControlTemplate 用于定义控件的外观。

这也是 WPF 最强大的功能之一；在未来的任何时候，您的控件的使用者可以在不改变其行为方式的情况下改变它的外观。这使您的控件更容易进行主题化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T14:31:33.663

这实际上是我目前正在进行的一个项目，尽管我很幸运能够重新开始。如果你能做到这一点，我强烈推荐它，显然保留旧系统/控件的核心功能，但重新开始。从一个基础开始并知道以前哪里出错/正确总是很好。

就我个人而言，我发现[msdn 网站](http://msdn.microsoft.com/en-us/library/ms754130.aspx) 非常有用，如果不是 stackoverflow 也是一个非常好的知识场所。如果您需要任何指示，我很乐意提供指点。

此外，如果您对数据绑定有任何疑问，那么这里就是您要去的地方： [bea costa](http://www.beacosta.com/blog/) 她已经涵盖了那里的大部分内容。

另外需要注意的是，使用 wpf 而不是 GDI，我们体验到了性能的巨大改进。

# html - 将图像包装在 a 标签中，但仅在文本上有下划线

> ID：271688
> 
> 赞同：1
> 
> 时间：2008-11-07T10:14:22.307
> 
> 标签：html, css

[我的截图 http://dl.getdropbox.com/u/240752/stars.gif](http://dl.getdropbox.com/u/240752/stars.gif)

我想要它，以便只有文本带有下划线。我能看到这样做的唯一方法是：

```
.no-underline {
   text-decoration:none;
}
.underline {
  text-decoration:underline;
}

<a href="#" class="no-underline"><span class="underline">Average customer review rating</span><img src="img/five-stars.gif" alt="five stars" width="78" height="16" title="5 star review rating" /></a> 
```

这是最好的方法吗？还是有人知道更精简的方式？谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T10:19:24.980

真的没有其他解决方案。虽然你可以缩短一点：

```
<a href="#" class="imgLink"><span>Link Text</span> <img src="..."></a>

a.imgLink { text-decoration: none; }
a.imgLink span { text-decoration: underline; } 
```

这样你只需要指定一个类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T10:43:29.207

您在哪个浏览器中遇到此问题？大多数浏览器不会对图像应用文本装饰，因为它没有意义。

其他尺寸，就这样做：

`<a class="imgLink" href="">some text<img src="" /></a>`

```
.imgLink {
    文字装饰：下划线；
}

.imgLink img {
    文字装饰：无；
}

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-16T15:58:04.610

如果您想为可重用的链接类型添加不带下划线的图像标记，例如显示维基百科样式的外部链接箭头，请尝试以下样式：

```
a.externalLink{
    padding-right: 15px;
    background: transparent url('badge.png') no-repeat center right;
} 
```

然后在您的标记中：

```
<a href="foo" class="externalLink">bar</a> 
```

# c# - linux环境下的C#

> ID：271690
> 
> 赞同：7
> 
> 时间：2008-11-07T10:15:33.083
> 
> 标签：c#, linux, installation

我目前在 Unix 环境中使用 C/C++ 工作，并且是 Linux 环境的新手。我想了解 Linux 操作系统并学习 C# 作为我职业生涯的下一级编程语言。

我决定在我的笔记本电脑上安装 Ubuntu Linux。但我不确定我们是否可以在 Linux 环境中编写、编译和运行 C# 程序。

我知道的唯一 C# IDE 是 MS Visual Studio。有没有可能在 Linux 环境中使用 C# 工作的方法？

如果我没有其他选择，我将在我的笔记本电脑上安装两个操作系统 - Vista 来学习 C# 和 Linux 用于其他操作系统。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-07T10:19:08.817

学习[单声道](http://www.mono-project.com/Main_Page)。

> Mono 项目是由 Novell 赞助的一项开放式开发计划，旨在开发 Microsoft .NET 开发平台的开放源代码 UNIX 版本。它的目标是使 UNIX 开发人员能够构建和部署跨平台的 .NET 应用程序。该项目实施了微软开发的各种技术，这些技术现已提交给 ECMA 进行标准化。

您可以使用[MonoDevelop](http://monodevelop.com/Main_Page) IDE。

> MonoDevelop 是一个免费的 GNOME IDE，主要为 C# 和其他 .NET 语言设计。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-07T10:22:46.813

[Mono](http://www.mono-project.com)是一个开源的 .NET 编译器、运行时和库。
[Monodevelop](http://monodevelop.com/)是一个开源 C# IDE，主要用于 linux 开发。它包括一个 GUI 设计器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T12:41:39.890

您还可以使用[wine](http://www.winehq.org/)，它是 Windows API 的免费实现。为此： sudo apt-get install wine 然后您将能够运行 Microsoft 应用程序并 [几乎] 做任何您喜欢的事情。

编辑：我的错误，[Visual Studio](http://appdb.winehq.org/objectManager.php?sClass=version&iId=11022)不起作用:-(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T16:10:20.157

在无缝模式下运行 Visual Studio 的 Vista 虚拟机？然后它会像任何其他应用程序一样集成到您的桌面，但您将受益于运行真正的 MS 东西（对于 C#，拥有真正的 MS 仍然是一种好处而不是一种负担）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-06-07T17:35:32.453

I know this is an old question, but I see no one has mentioned Microsoft Visual Studio Code IDE. This could be what you are looking for if you want to do C# in Linux. As a relative NOOB I can say it brings Visual Studio to Linux. If you need a GUI IDE in Linux, this was it for me. see [instructions to install it here](https://code.visualstudio.com/docs/setup/linux)

# java - 升级到 icefaces 1.7.2 后的 javax.faces.application.ViewExpiredException

> ID：271698
> 
> 赞同：1
> 
> 时间：2008-11-07T10:20:04.197
> 
> 标签：java, seam, icefaces, backwards-compatibility

您好，我刚刚将 icefaces 1.7.1 升级到 1.7.2 并在同一链接上单击两次后开始出现 javax.faces.application.ViewExpiredException 异常。我正在使用 JBoss Seam 2.0.2，我想这是我在升级过程中犯的一些愚蠢的错误，但我不知道是什么。我刚刚用较新的 jar 替换了三个 jar（icefaces.jar、icefaces-comps.jar 和 icefaces-facelets.jar。还有什么我应该做的吗？当我切换回 1.7.1 时，一切正常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-01-26T11:22:56.657

我的观点是 ICEfaces 并不完全向后二进制兼容，如果不重新编译 JBoss Seam 组件就无法更新。您可以在 JBoss Seam[包](http://seamframework.org/Seam2/Seam2DistributionDownloads)的 changelog.txt 文件中找到兼容的组合。我有以下组合：

*   JBoss Seam 2.1.2 和 ICEfaces 1.8.0
*   JBoss Seam 2.1.1 和 ICEfaces 1.7.2 SP1
*   JBoss Seam 2.1.0 和 ICEfaces 1.7.2
*   JBoss Seam 2.0.2 和 ICEfaces 1.7.0
*   JBoss Seam 2.0.0 和 ICEfaces 1.6.1（[更多信息](http://support.icesoft.com/jive/entry.jspa?entryID=721&categoryID=71)）
*   JBoss Seam 1.2.1 和 ICEfaces 1.6.0
*   JBoss Seam 1.1.0 和 ICEfaces 1.5.1

您可以阅读详细的[1.7.2](http://www.icefaces.org/releasenotes/icefaces-1.7.2-RN.html#Changes_172)更新日志或尝试将 ICEface 或 JBoss Seam 更新到较新的版本。[在icefaces 论坛](http://www.icefaces.org/JForum/posts/list/10432.page)上也发现了这个问题。

# .net - 在 ASP.NET MVC 中测试 HtmlHelper

> ID：271699
> 
> 赞同：23
> 
> 时间：2008-11-07T10:21:35.910
> 
> 标签：.net, asp.net-mvc, unit-testing, html-helper

有没有办法（单元）测试我自己的 HtmlHelpers？如果我想要自定义控件（由 HtmlHelper 呈现）并且我知道该控件的要求，我该如何先编写测试 - 然后编写代码？有没有特定的（好的）方法可以做到这一点？

这值得吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-14T11:47:24.313

主要问题是您必须模拟 HtmlHelper，因为您可能正在使用帮助程序的方法来获取路由或值或返回另一个扩展方法的结果。HtmlHelper 类有很多属性，其中一些非常复杂，例如 ViewContext 或当前的 Controller。

[Ben Hart 的这篇文章](http://web.archive.org/web/20090615064637/http://blog.benhartonline.com/post/2008/10/17/Mocking-ASPNET-MVC-HtmlHelper-extension-methods-using-Moq.aspx)解释了如何使用 Moq 创建这样的模拟。可以很容易地翻译成另一个模拟框架。

这是我的 Rhino Mocks 版本适应了 MVC 框架的变化。它没有经过全面测试，但它对我有用，但不要指望完美的结果：

```
 public static HtmlHelper CreateHtmlHelper(ViewDataDictionary viewData)
    {
        var mocks = new MockRepository();

        var cc = mocks.DynamicMock<ControllerContext>(
            mocks.DynamicMock<HttpContextBase>(),
            new RouteData(),
            mocks.DynamicMock<ControllerBase>());

        var mockViewContext = mocks.DynamicMock<ViewContext>(
            cc,
            mocks.DynamicMock<IView>(),
            viewData,
            new TempDataDictionary());

        var mockViewDataContainer = mocks.DynamicMock<IViewDataContainer>();

        mockViewDataContainer.Expect(v => v.ViewData).Return(viewData);

        return new HtmlHelper(mockViewContext, mockViewDataContainer);
    } 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-05-11T00:40:45.173

如果有人正在寻找如何创建`HtmlHelper<T>`（这就是我所追求的），这里有一个可能会有所帮助的实现——我的类型是一个名为 Model 的类：

```
public static HtmlHelper<Model> CreateHtmlHelper()
{
    ViewDataDictionary vd = new ViewDataDictionary(new Model());

    var controllerContext = new ControllerContext(new Mock<HttpContextBase>().Object,
                                                  new RouteData(),
                                                  new Mock<ControllerBase>().Object);

    var viewContext = new ViewContext(controllerContext, new Mock<IView>().Object, vd, new TempDataDictionary(), new Mock<TextWriter>().Object);

    var mockViewDataContainer = new Mock<IViewDataContainer>();
    mockViewDataContainer.Setup(v => v.ViewData).Returns(vd);

    return new HtmlHelper<Model>(viewContext, mockViewDataContainer.Object);
} 
```

或者更通用的实现：

```
 public HtmlHelper<T> CreateHtmlHelper<T>() where T : new()
    {
        var vd = new ViewDataDictionary(new T());

        var controllerContext = new ControllerContext(new Mock<HttpContextBase>().Object,
                                                      new RouteData(),
                                                      new Mock<ControllerBase>().Object);

        var viewContext = new ViewContext(controllerContext, new Mock<IView>().Object, vd, new TempDataDictionary(), new Mock<TextWriter>().Object);

        var mockViewDataContainer = new Mock<IViewDataContainer>();
        mockViewDataContainer.Setup(v => v.ViewData).Returns(vd);

        return new HtmlHelper<T>(viewContext, mockViewDataContainer.Object);
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-01T13:54:59.967

我正在创建一个自定义助手，这是我用来模拟具有 Moq 和 ASP MVC 2 的 httphelper 的代码。我还将作为参数传递一个 HttpRequestBase 的模拟。如果你不需要它，你可以删除它

```
公共静态 HtmlHelper CreateHtmlHelper(ViewDataDictionary viewData, Mock requestMock)
        {
            var contextBaseMock = new Mock();
            contextBaseMock.SetupGet(cb => cb.Request).Returns(requestMock.Object);

            var cc = new ControllerContext(contextBaseMock.Object,
                                            新的路线数据（），
                                            新的 Mock().Object);
            var vctx = 新的 ViewContext(
                抄送，
                新的 Mock().Object，
                视图数据，
                新的 TempDataDictionary(),
                新 HtmlTextWriter(新 StreamWriter(新 MemoryStream())));

            var mockViewDataContainer = new Mock();

            mockViewDataContainer.SetupGet(v => v.ViewData).Returns(viewData);

            返回新的 HtmlHelper(vctx, mockViewDataContainer.Object);
        }

```

# jboss - JBoss AS / Wildfly 社区版本对应 Red Hat EAP 版本？

> ID：271700
> 
> 赞同：14
> 
> 时间：2008-11-07T10:21:38.500
> 
> 标签：jboss, jboss-eap-4.3.x

据我所知，JBoss Application Server (AS) 的 EAP 版本只是一堆社区版的 JBoss 项目，其中包含一些糖。

那么，**JBoss EAP 4.3.0**对应的JBoss Application Server的**社区版是什么？**

 *** * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-19T15:29:31.163

这个回复真的很晚，但我在谷歌搜索中遇到了未回答的问题，我想确保有正确的回复。我为 JBoss 支持工作，因此您可以认为这是一个合格的答案。

JBoss EAP 是唯一商业支持的 JBoss 版本。它包含 JBoss AS 和 JBoss Seam。EAP 与 JBoss AS 在 4.2.1 版左右（不完全是，但足够接近）从 JBoss AS 分歧（就其构建的 svn 分支而言）。EAP 的使用寿命为 5 年，并经过严格的测试和认证。EAP 已支付商业支持和补丁（称为 CP 或累积补丁），旨在保持 ABI/API 随着时间推移的稳定性，同时允许修复安全问题和错误。在 CP 中引入功能实际上是违反政策的，但有时会发生。

如果您熟悉[Red Hat Enterprise Linux](http://www.redhat.com/rhel/)与[Fedora](http://fedoraproject.org/)的不同之处，您可以认为差异非常相似。不过，JBoss 项目/产品拆分要新得多，因此差异较小。这是描述我所说的官方页面。

[http://www.jboss.com/products/community-enterprise](http://www.jboss.com/products/community-enterprise)

干杯，

克里斯

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-01-06T14:44:32.143

根据[JBoss Enterprise Application Platform Component Details](https://access.redhat.com/articles/112673)，**JBoss EAP 4.3**基于：

> **JBoss Application Server 4.2.1**包含各种更新、组件升级和错误修复

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-10-01T09:58:21.803

EAP 与社区版本的主要区别在于，EAP 是官方支持的社区版本配置，具有各种组件的固定版本。RedHat 发现很难支持 man+dog 使用的不同组件版本，因此将其固定为一组。

至于版本控制，EAP 版本号大致跟踪社区版本，但有所不同：

*   EAP 4.2 基于 JBossAS 4.2
*   EAP 4.3 也是基于 JBossAS 4.2.1，但 JBossMQ 被 JBossMessaging 取代，并支持 Java6
*   EAP 5.0 基于 JBossAS 5.1
*   EAP 5.1 似乎也是基于 JBossAS 5.1，带有一些累积补丁

编辑：

*   EAP 6.x 基于 JBoss Application Server 7.x

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-03T15:10:24.517

我一直在深入研究 JBoss 版本信息，试图找到我正在处理的更具体问题的答案，我想我会分享我的观察结果。您可以从 JBoss 的 JIRA 错误跟踪器中获取发布名称和日期的图片：您可以​​查看[社区](https://jira.jboss.org/jira/browse/JBAS)版和[企业](https://jira.jboss.org/jira/browse/JBPAPP)版的信息。

我对 4.2 分支而不是 4.3 感兴趣。如果您回溯几年，您会发现[社区版 4.2.0.GA](https://jira.jboss.org/jira/browse/JBAS/fixforversion/12311408)于 2007 年 5 月 14 日发布，六周后[企业版 4.2.0.GA](https://jira.jboss.org/jira/browse/JBPAPP/fixforversion/12311205)于 7 月 3 日发布2007 年之后，编号出现了分歧：[社区版发布了点升级 - 4.2.1.GA](https://jira.jboss.org/jira/browse/JBAS/fixforversion/12311049)、[4.2.2.GA](https://jira.jboss.org/jira/browse/JBAS/fixforversion/12311522)和[4.2.3.GA](https://jira.jboss.org/jira/browse/JBAS/fixforversion/12311686) - 此后每隔几个月。企业版发布了一系列基于 4.2.0 的“累积补丁”版本，从[4.2.0.GA_CP01](https://jira.jboss.org/jira/browse/JBPAPP/fixforversion/12311447)到[4.2.0.GA_CP06](https://jira.jboss.org/jira/browse/JBPAPP/fixforversion/12312660)几个月前。这些版本如何相互关联？我仍然不确定这一点，但我认为理论上企业版没有获得任何新功能（在该分支内），只有错误修复，但这些错误修复适用于企业版和社区版。事实上，我怀疑在我的错误[10](https://jira.jboss.org/jira/browse/JBPAPP-366)的情况下，该修复程序是针对社区版开发的，然后交叉移植到企业版，尽管我对此还不确定。

回到你的实际问题，事情不太清楚。[Enterprise 4.3.0.GA](https://jira.jboss.org/jira/browse/JBPAPP/fixforversion/12311517)于 2008年1 月 7 日发布，在[Community 4.2.2.GA](https://jira.jboss.org/jira/browse/JBAS/fixforversion/12311522)之后，但在[4.2.3.GA](https://jira.jboss.org/jira/browse/JBAS/fixforversion/12311686)之前。没有 Community 4.3.0，也没有任何 x > 0 的 Enterprise 4.2.x。Chris 说 Enterprise 和 Community 版本“不同”，我认为他的意思是 Enterprise 版本不是不再基于仅修复社区版本的错误，而是现在是一个完全独立的开发流 - 可能会在适当的地方从社区版本中删除代码。

因此，您的问题的答案是以下组合： 4.2.2.GA （但只是遥远的）、 4.2.0.GA （加上多年的单独开发）和[*mu*](http://en.wikipedia.org/wiki/Mu_%28negative))。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-24T11:14:49.087

虽然 JBoss AS / Wildfly 确实是 JBoss EAP 的基础，但它绝对不仅仅是添加的“一些糖”。

EAP 经过了广泛的测试，并且修复了许多错误和安全问题。

此外，经过一段时间的性能测试、浸泡测试和代码分析后，EAP 通常也会更快。

此外，EAP 工件（罐子）都是由 Red Hat 构建的，即 Red Hat 负责其中的任何内容 - 即，您不会得到任何人放入中央存储库或您可能在您的`settings.xml`（在如果您构建自己的 AS）。其中许多第三方库已更改 - CVE 已修复，性能问题已解决等。

最后，EAP 在功能方面要好得多。例如，JBoss AS 的最新 7.x 版本是 7.1.1，一年多，而 EAP 6.1 大约一个月，在可管理性、稳定性、可配置性等方面要好得多。有几个这两者之间有数百次提交差异。

因此，说“JBoss EAP X 基于 JBoss AS Y”可能是正确的，但同时具有误导性。

检查[EAP 6.1](http://www.jboss.org/products/eap)。

# javascript - 使用元刷新或 javascript 摆脱 iframe？

> ID：271706
> 
> 赞同：4
> 
> 时间：2008-11-07T10:24:50.240
> 
> 标签：javascript, html, iframe, redirect

我基本上有一个页面显示已刷新到浏览器的“处理”屏幕。稍后我需要重定向此页面，目前我们使用元刷新，这通常工作正常。

使用包括 3D 安全在内的新支付系统，我们最终可能会在 iframe 中被第三方引导回我们的网站。

我需要能够使用 javascript 或元刷新从该页面重定向，并在 iframe 存在时从 iframe 中退出。

干杯!

（我之前已经摆脱了 iframe，但找不到我的旧代码，谷歌搜索也没用，我认为现在是尝试 Stackoverflow 的最佳时机！）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T12:20:25.440

所以我在我的重定向页面中添加了以下内容。幸运的是，他们没有发布任何内容，因此可以简单地重定向。也可以使用 javascript，因为它需要到达站点中的那个点。

```
<script type="text/javascript" language="javascript">
    if (top.frames.length>0)
    setTimeout("top.location = window.location;",100);
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T14:28:14.993

我正在做类似的事情以将旧站点保留在其框架集中：

```
<SCRIPT TYPE="text/JavaScript">
    if (window == top){top.location.replace("/foo.html");}
</SCRIPT> 
```

因此，要突破 iframe，只需将 == 更改为 !=

我看到您在示例中使用了 setTimeout 。等待突破 iframe 是一项要求，还是您希望它立即发生？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-05T06:00:38.053

如果您使用的是 JavaScript：

```
parent.document.location = "http://www.google.com" 
```

如果您使用的是 html：

```
<a href="http://www.google.com" target=_top >Google</a> 
```

# c# - 收藏 与列表 你应该在你的接口上使用什么？

> ID：271710
> 
> 赞同：171
> 
> 时间：2008-11-07T10:28:08.003
> 
> 标签：c#, .net, collections, code-analysis

代码如下所示：

```
namespace Test
{
    public interface IMyClass
    {
        List<IMyClass> GetList();
    }

    public class MyClass : IMyClass
    {
        public List<IMyClass> GetList()
        {
            return new List<IMyClass>();
        }
    }
} 
```

当我运行代码分析时，我得到以下建议。

> 警告 3 CA1002：Microsoft.Design：将“IMyClass.GetList()”中的“List”更改为使用 Collection、ReadOnlyCollection 或 KeyedCollection

我应该如何解决这个问题，这里有什么好的做法？

* * *

## 回答 #1

> 赞同：249
> 
> 时间：2008-11-07T11:45:24.417

要回答关于为什么不的问题的“为什么”部分[`List<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1)，原因是面向未来和 API 的简单性。

**面向未来**

[`List<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1)没有被设计成通过子类化来轻松扩展；它旨在快速用于内部实现。你会注意到它上面的方法不是虚拟的，因此不能被覆盖，并且它的 // 操作中[`Add`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.add)没有钩子[`Insert`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.insert)。[`Remove`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.remove)

这意味着如果您将来需要更改集合的行为（例如拒绝人们尝试添加的空对象，或者在发生这种情况时执行额外的工作，例如更新您的类状态），那么您需要更改类型集合返回到一个可以子类化的集合，这将是一个破坏性的接口更改（当然，更改诸如不允许 null 之类的语义也可能是接口更改，但诸如更新内部类状态之类的事情不会）。

因此，通过返回可以轻松子类化的类[`Collection<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.objectmodel.collection-1)或接口[`IList<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ilist-1)，[`ICollection<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.icollection-1)或者[`IEnumerable<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ienumerable-1)您可以将内部实现更改为不同的集合类型以满足您的需求，而不会破坏消费者的代码，因为它仍然可以返回为他们期望的类型。

**API 简单性**

[`List<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1)包含很多有用的操作，例如[`BinarySearch`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.binarysearch),[`Sort`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.sort)等等。但是，如果这是您要公开的集合，那么您很可能控制列表的语义，而不是消费者。因此，虽然您的班级内部可能需要这些操作，但您班级的消费者不太可能想要（甚至应该）调用它们。

因此，通过提供更简单的集合类或接口，您可以减少 API 用户看到的成员数量，并使他们更易于使用。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-11-07T10:29:33.023

我个人会声明它返回一个接口而不是一个具体的集合。如果您真的想要列表访问，请使用[`IList<T>`](http://msdn.microsoft.com/en-us/library/5y536ey6.aspx). 否则，考虑[`ICollection<T>`](http://msdn.microsoft.com/en-us/library/92t2ye13.aspx)和[`IEnumerable<T>`](http://msdn.microsoft.com/en-us/library/9eekhta0.aspx)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-07T10:41:45.137

我认为还没有人回答“为什么”部分……所以就这样吧。“为什么”您“应该”使用 a`Collection<T>`而不是 a`List<T>`的原因是因为如果您公开 a `List<T>`，那么任何可以访问您的对象的人都可以修改列表中的项目。而`Collection<T>`应该表明您正在制作自己的“添加”、“删除”等方法。

您可能不需要担心它，因为您可能只是为自己（或者可能是几个同事）编写接口。这是另一个可能有意义的例子。

如果您有一个公共数组，例如：

```
public int[] MyIntegers { get; } 
```

你会认为因为只有一个“get”访问器没有人可以弄乱这些值，但事实并非如此。任何人都可以像这样更改里面的值：

```
someObject.MyIngegers[3] = 12345; 
```

就个人而言，我只会`List<T>`在大多数情况下使用。但是，如果您正在设计一个要分发给随机开发人员的类库，并且您需要依赖对象的状态......那么您将想要制作自己的 Collection 并从那里锁定它： )

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T11:09:56.813

它主要是关于抽象您自己的实现，而不是公开 List 对象以直接操作。

让其他对象（或人）直接修改对象的状态并不是一个好习惯。想想属性获取器/设置器。

集合 -> 对于普通集合
ReadOnlyCollection -> 对于不应修改的集合
KeyedCollection -> 当你想要字典时。

如何修复它取决于你希望你的类做什么以及 GetList() 方法的目的。你能详细说明吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T11:11:25.343

在这种情况下，我通常会尝试公开所需的最少实现量。如果消费者不需要知道您实际上正在使用列表，那么您不需要返回列表。通过按照 Microsoft 建议的集合返回，您可以隐藏您正在使用您的类的消费者的列表这一事实，并将它们与内部更改隔离开来。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-11-11T16:08:39.157

有一些东西要补充，尽管自从被问到这个问题已经很长时间了。

当您的列表类型派生自`List<T>`而不是 时`Collection<T>`，您无法实现实现的受保护虚拟方法`Collection<T>`。这意味着如果对列表进行任何修改，您的派生类型将无法响应。这是因为`List<T>`假设您在添加或删除项目时知道。能够响应通知是一种开销，因此`List<T>`不提供它。

如果外部代码可以访问您的集合，您可能无法控制何时添加或删除项目。因此`Collection<T>`提供了一种方法来了解您的列表何时被修改。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-14T03:14:01.460

我认为返回类似的东西没有任何问题

```
this.InternalData.Filter(crteria).ToList(); 
```

如果我返回了一个断开 的内部数据*副本*，或者一个数据查询的分离结果——我可以安全地返回`List<TItem>`而不暴露任何实现细节，并允许以方便的方式使用返回的数据。

但这取决于我期望的消费者类型——如果这是一个类似于数据网格的东西，我更喜欢返回它，无论如何在大多数情况下`IEnumerable<TItem>` *它都是复制的项目列表:)*

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-07T10:35:16.773

好吧，Collection 类实际上只是其他集合的包装类，以隐藏它们的实现细节和其他特性。我认为这与面向对象语言中的属性隐藏编码模式有关。

我认为您不必担心，但如果您真的想取悦代码分析工具，只需执行以下操作：

```
//using System.Collections.ObjectModel;

Collection<MyClass> myCollection = new Collection<MyClass>(myList); 
```

# wcf - 完全禁用 WCF 代理

> ID：271714
> 
> 赞同：3
> 
> 时间：2008-11-07T10:30:51.587
> 
> 标签：wcf, proxy

如何配置 WCF 服务和客户端以完全绕过 IE 中配置的代理设置。我的应用程序在 LAN 中工作，我同时使用 BasicHttp 和 NetTcp 端点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T15:15:01.467

在绑定配置中将 useDefaultWebProxy 设置为 false。

# testing - 在等待构建/测试/数据库迁移运行时我应该怎么做？

> ID：271716
> 
> 赞同：8
> 
> 时间：2008-11-07T10:32:00.400
> 
> 标签：testing, build, focus

尽管我尽量保持我的单元测试与数据库断开连接，等等，但我的一天似乎仍然不可避免地会被小的定期强制中断打断，而我等待我的机器做一些无聊的事情。

![xkcd 漫画：编译](https://imgs.xkcd.com/comics/compiling.png)

我个人觉得剑术让我失去了思路。当我运行构建或测试套件时，我经常处于“状态”，我更喜欢让我保持同样专注的思维框架的东西，一旦构建/测试运行，我就会立即跳回黑客领域/迁移完成。

我曾经幻想过一个用于 Visual Studio 的俄罗斯方块插件，它在构建过程中弹出，然后在构建完成时自动暂停并消失，但我从未真正做过任何事情。最近我们正在考虑在自动测试中构建一些东西[，](http://www.zenspider.com/)它可以帮助您在等待测试运行时学习西班牙语，或者可能会为您提供相关的堆栈溢出问题以回答。

所以。请提出建议。有趣但有益的活动的积分。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T10:33:23.593

1.  堆栈溢出
2.  咖啡
3.  堆栈溢出
4.  副项目编码

另请参阅[如何在等待编译器时保持专注和专注？](https://stackoverflow.com/questions/55922/how-to-keep-concentrated-and-focused-while-waiting-for-your-compiler)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T10:38:32.897

我通常利用这段时间阅读 ant 博客来检查 bug 列表，看看是否有一些我忘记做的待处理的事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T14:15:01.793

理想吗？

*   写下关于添加的修复/功能的注释。（两年后你需要破译你所做的事情时，笔记本非常棒。）
*   阅读与您的工作相关的内容。
*   检查其他小的勘误表和错误。
*   记录（为其他人）您的功能/代码。

实际上：

*   堆栈溢出
*   斜线点
*   生活黑客
*   博客

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T11:00:49.047

花时间订购一个**新的、更快的**开发机器/服务器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T10:44:41.060

咖啡，闲聊，StackOverflow。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T10:58:17.647

我通常阅读博客、文章，主要是与工作相关的。
我有专门的时间阅读与工作无关的所有内容（午餐后 30 分钟）。
我还发现自己正在浏览我们的网站，看看是否发现了错误或可以改进的地方。

在星期五（比如今天：））我读了《怪胎天使》：）沃伦·埃利斯（Warren Ellis）在线免费漫画。那个男人对那个人大发雷霆：）
检查一下：[http ://www.freakangels.com/?p=23](http://www.freakangels.com/?p=23)

# asp.net - 在详细信息视图的插入命令上加载值

> ID：271718
> 
> 赞同：1
> 
> 时间：2008-11-07T10:34:27.943
> 
> 标签：asp.net

在详细信息视图中，如何预填充插入命令上的其中一个文本框（当用户单击插入并且视图为插入时）。

我认为这适用于代码隐藏：

将 txtBox 调暗为 TextBox = FormView1.FindControl("txtbox")

txtbox.Text = "随便我"

这是正确的吗？我在 aspx 中需要什么（不确定）？另外，我假设服务器端代码将进入 itemcommand 或 insertcreating 事件。

我已经在 VB.NET 中输入了这个，但我使用的是 C#（我可以在与语言无关的论坛上同时这样做，我可能会用另一种语言输入问题）。我还使用了一个 SqlDataSource，我的参数和插入/删除/编辑命令都已创建。

我正在尝试生成一个随机 GUID（使用 GUID 对象），它将预填充在文本框中。

另外，按钮的 postbackurl 属性不是保存表单状态的另一种方式吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T08:41:50.827

我会将 DetailsView 中的字段更新为 TemplateField：

```
<asp:TemplateField>
  <InsertItemTemplate>
    <asp:TextBox ID="txtField" runat="server" Text='<%# Bind("GUID") %>'/>
  </InsertItemTemplate>
  <ItemTemplate>
    <asp:Label ID="lblField" runat="server" Text='<%# Bind("GUID") %>'/>
 </ItemTemplate>
</asp:TemplateField> 
```

然后你有两个选择：

*   生成您的 GUID 并插入您的数据源。这可能必须使用 SQL 完成，因为您提到使用 SqlDataSource
*   删除绑定并从 DetailsView 的 DataBound 事件中的代码访问控件

    ```
    Private Sub dv_DataBound(ByVal sender As Object, ByVal e As EventArgs) Handles dv.DataBound
        dim txt as Textbox = dv.FindControl("txtField")
        txt.Text = GenerateGUID()
    End Sub 
    ```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T00:10:04.037

我也在做这样的事情。我隐藏 DetailsView 并在用户单击按钮时显示它。

```
dvDetails.ChangeMode(DetailsViewMode.Insert)
pnlDetailMenu.Visible = True
Dim ColumnTextBox As TextBox
ColumnTextBox = dvDetails.Rows(0).Cells(1).Controls(0)
If Not ColumnTextBox Is Nothing Then
    ColumnTextBox.Text = "Initial Value"
End If 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T12:55:51.873

我猜你需要使用 detailsview 事件之一。连接到 ItemCommand、ModeChanging 或 ModeChanged 事件并在那里填写您的值。

# asp.net - 如何使用来自不同网站的 ASP.NET MVC 中的数据？

> ID：271724
> 
> 赞同：0
> 
> 时间：2008-11-07T10:39:53.410
> 
> 标签：asp.net, html, asp.net-mvc, json, rest

我是第一次玩 ASP.NET MVC，所以如果这听起来很学术，我提前道歉。

我使用 ASP.NET MVC 创建了一个简单的内容管理系统。检索内容列表（在本例中为公告）的 url 如下所示：

```
http://www.mydomain.com/announcements/list/10 
```

这将返回前十个最近的公告。

我的问题如下：

1.  任何网站都可以使用此服务吗？或者我是否还必须使用 WCF 之类的东西来公开它？

2.  有哪些示例说明如何使用此服务在另一个网站上显示此数据？我主要在 .NET 世界中进行编程，但我在想如果我可以使用 javascript 使用该服务，或者使用 Json 做一些事情，它真的可以适用于任何技术。

我希望动态生成类似于以下输出的内容：

```
<div class="announcement">
    <h1>Title</h1>
    <h2>Posted Date</h3>
    <p>Teaser</p>
    <a href="www.someotherdomain.com">More</a>
</div> 
```

* * *

现在......是否可以返回 Html 表示并将其显示在网页中？这可能只使用Javascript吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T11:11:10.867

没有什么可以阻止其他客户端只是抓取该特定页面并解析您的 HTML。

但是，您可能希望使用相同的控制器生成另一个视图，该控制器生成不包含过多格式 HTML 等的数据。也许看看使用众所周知的格式，例如 RSS？

您可以使用以下内容将结果作为 JSON 返回：

```
public JsonResult GetResults()
{
return Json(new { message = "SUCCESS" });
} 
```

我想我会提供一个视图，其中包含 xml 和另一个返回 JSON 的项目，这样你就可以两全其美了。

我有一篇关于如何在[这里](http://www.simpleisbest.co.uk/Home/Index/MVC?tagId=1)使用 MVC、JQuery 和 JSON 调用和返回内容的小帖子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T11:38:13.230

您的 ROUTE 非常好，任何人都可以使用。诀窍在于您希望如何公开该路由的数据。你说XML。当然。你甚至可以做 JSon 或 Html 或者只是简单的 ole 文本。

诀窍在于您的控制器方法和视图结果对象。

这是主要视图结果的列表：-

*   动作结果
*   内容结果
*   空结果
*   json结果
*   重定向结果

例如。

```
public <ContentResult> AnnouncmentIndex(int numberOfAnnouncements)
{
   // Generate your Xml dynamically.
   string xml = "<div class=\"announcement\"><h1>Title</h1><h2>Posted Date</h3><p>Teaser</p><a href="www.someotherdomain.com">More</a></div>"

   Response.ContentType = "application/xml"; // For extra bonus points!

   return Content(xml);
} 
```

# sql - 是什么导致 LIKE 语句忽略 html 标记、逗号后的单词或以句点结尾？

> ID：271725
> 
> 赞同：1
> 
> 时间：2008-11-07T10:40:45.297
> 
> 标签：sql, mysql

我正在开发一个搜索模块，该模块在包含 html 代码的文本列中进行搜索。查询的构造如下： WHERE htmlcolumn LIKE '% searchterm %';

默认情况下，模块在搜索词的两端使用空格进行搜索，在搜索词的开头和/或结尾使用通配符，这些空格被删除（*searchterm -> LIKE '%searchterm %'; 我还添加了排除包含某些单词的结果（-searchterm -> NOT LIKE '% searchterm %'）。到目前为止一切都很好。

问题是找不到以 html-tag 开头的单词（`<br/>`在 LIKE '% searchterm.. 上搜索时找不到 searchterm，还有逗号之后或以句点结尾的单词等）。我想做的是搜索前面或后面没有字符 AZ 和 az 的单词。其他角色都还好。

任何想法我应该如何实现这一目标？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T11:01:01.120

查看 MySQL 的全文搜索，它可能能够使用非字母字符作为分隔符。它也将比 %term% 搜索快得多，因为这需要全表扫描。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T10:43:13.853

您可以使用正则表达式：[http ://dev.mysql.com/doc/refman/5.0/en/regexp.html](http://dev.mysql.com/doc/refman/5.0/en/regexp.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T10:43:29.907

我不认为单独的 SQL 的“LIKE”运算符是您尝试做的工作的正确工具。考虑使用 Lucene 或类似的东西。我能够在几天内将 Lucene.NET 集成到我的应用程序中。您将花费更多的时间来尝试挽救您当前的方法。

如果您别无选择，只能使用当前方法，请考虑将文本存储在数据库中的两列中。第一列是纯文本，带有标点符号等。第二列是经过预处理的文本，只有单词，没有标点符号，标准化以便您的“LIKE”方法更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T13:23:17.590

一般来说，最好使用全文搜索工具，但如果你真的想要一个小 SQL，这里是：

```
SELECT * FROM `t` WHERE `htmlcolumn` REGEXP '[[:<:]]term[[:>:]]' 
```

它返回包含单词“term”的所有记录，无论它是否被空格、标点符号、特殊字符等包围

# asp.net - 我应该能够从 ASP.NET 页面事件处理程序中更改其他控件吗？

> ID：271727
> 
> 赞同：0
> 
> 时间：2008-11-07T10:42:03.000
> 
> 标签：asp.net, controls, page-lifecycle

我正在尝试从复选框的 CheckedChanged 事件处理程序中禁用标签控件。我应该能够做到这一点吗？

目前，如果我将 Enabled 设置为 false，则页面重新加载时不会发生任何变化。如果我在 Page_Load 中做同样的事情，那么我会看到变化。

澄清：

这不起作用：

```
protected void chkNeverExpires_CheckedChanged(object sender, EventArgs e)
{
    this.lblMessage.Enabled = false
} 
```

但这确实：

```
protected void Page_Load(object sender, System.EventArgs e)
{
    this.lblMessage.Enabled = false
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T11:09:19.043

你确定你的事件是按照你期望的顺序触发的吗？在所有回发方法上设置断点并观察会发生什么，您是否在任何地方重置启用状态？你有什么 enableviewstate=false 吗？

编辑：您意识到 CheckedChanged 在您从另一个控件回发之前不会触发，或者您在 checbkbox 上有 AutoPostBack=true？

这工作正常：

```
<asp:Label runat="server" ID="lblTest">test</asp:Label>
<asp:CheckBox runat="server" ID="chkCheck" AutoPostBack="true" />Check

protected override void OnInit(EventArgs e)
{
    base.OnInit(e);
    chkCheck.CheckedChanged += chkCheck_CheckedChanged;
}

private void chkCheck_CheckedChanged(object sender, EventArgs e)
{
    lblTest.Enabled = false;
} 
```

# mysql - 如何在 MySQL 中为每个用户选择最多 3 个项目？

> ID：271730
> 
> 赞同：11
> 
> 时间：2008-11-07T10:43:06.990
> 
> 标签：mysql, sql, database

我经营一个网站，用户可以在其中发布项目（例如图片）。这些项目存储在 MySQL 数据库中。

我想查询最后十个发布的项目，但最多 3 个项目的约束可以来自任何单个用户。

最好的方法是什么？我首选的解决方案是对请求最后十项的 SQL 查询施加约束。但是关于如何设置数据库设计的想法是非常受欢迎的。

提前致谢！

BR

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T13:01:26.433

使用相关的子查询非常容易：

```
SELECT `img`.`id` , `img`.`userid`
FROM `img`
WHERE 3 > (
SELECT count( * )
FROM `img` AS `img1`
WHERE `img`.`userid` = `img1`.`userid`
AND `img`.`id` > `img1`.`id` )
ORDER BY `img`.`id` DESC
LIMIT 10 
```

该查询假定较大的`id`意思是稍后添加

相关子查询是一个强大的工具！:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T11:03:19.617

这很困难，因为 MySQL 不支持子查询的 LIMIT 子句。如果是这样，这将是相当微不足道的......但是，唉，这是我天真的方法：

```
SELECT
  i.UserId,
  i.ImageId
FROM
  UserSuppliedImages i
WHERE
  /* second valid ImageId */
  ImageId = (
    SELECT MAX(ImageId)
    FROM UserSuppliedImages
    WHERE UserId = i.UserId
  )
  OR
  /* second valid ImageId */
  ImageId = (
    SELECT MAX(ImageId)
    FROM   UserSuppliedImages
    WHERE UserId = i.UserId
      AND ImageId < (
        SELECT MAX(ImageId)
        FROM UserSuppliedImages
        WHERE UserId = i.UserId
      )
    )
  /* you get the picture... 
     the more "per user" images you want, the more complex this will get */
LIMIT 10; 
```

您没有评论有首选的结果顺序，所以这会选择最新的图像（假设`ImageId`是一个递增的自动递增值）。

相比之下，在 SQL Server 上，相同的内容如下所示：

```
SELECT TOP 10
  img.ImageId,
  img.ImagePath,
  img.UserId
FROM
  UserSuppliedImages img
WHERE
  ImageId IN (
    SELECT TOP 3 ImageId
    FROM UserSuppliedImages 
    WHERE UserId = img.UserId
  ) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T11:10:04.177

我会首先选择 10 个不同的用户，然后从每个用户中选择 LIMIT 3 的图像，可能通过所有这些用户的联合并将其限制为 10。

这至少会将您需要处理的数据范围缩小到相当数量。

# html - 使用正则表达式从 HTML 中的 URL 中删除查询字符串

> ID：271736
> 
> 赞同：0
> 
> 时间：2008-11-07T10:44:06.053
> 
> 标签：html, regex, url, parsing

给定一个 html 文档，从文档中的每个 url 中删除查询字符串的最正确和简洁的正则表达式模式是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T10:57:01.907

您无法使用正则表达式有效地解析 HTML。如果您事先知道页面的格式 - 例如。

*   链接始终采用 <a href="url 且没有不必要的字符转义"> 的形式，或者
*   所有链接都是绝对链接，不存在其他以 http: 开头的非链接字符串

那么你就可以摆脱它，但对于一般的 [X]HTML 正则表达式解析器是不合适的。

根据您使用的语言，您需要找到一个 HTML 解析器库（例如 Python 的 BeautifulSoup），或者一个与标准 XML 解析器相结合的 HTML 整理器，然后扫描文档中的 < a> 元素（也许其他人，例如<img>，如果您对这些感兴趣？），然后将属性值拆分为“？”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T11:02:29.387

回复：Bobince 的评论，[HTMLAgilityPack](http://www.codeplex.com/htmlagilitypack)是一个很好的 .NET html 解析器，它比其他解析器更宽容地处理不正确的标记。

使用它可以让您找到所有 A 标记，然后您可以获得 HREF 并简单地删除任何内容，包括“？”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T11:07:59.640

找到这个：

```
/href="([^\?"]*?)\?[^\"]*"/ 
```

用。。。来代替：

```
href="\1" 
```

您可能需要注意它不会剥离`<link>`标签。

# c# - 用于 html 解析的正则表达式（在 c# 中）

> ID：271741
> 
> 赞同：4
> 
> 时间：2008-11-07T10:50:29.707
> 
> 标签：c#, html, regex, parsing

我正在尝试解析 html 页面并从表行中提取 2 个值。表格行的html如下： -

```
<tr>
<td title="Associated temperature in (ºC)" class="TABLEDATACELL" nowrap="nowrap" align="Left" colspan="1" rowspan="1">Max Temperature (ºC)</td>
<td class="TABLEDATACELLNOTT" nowrap="nowrap" align="Center" colspan="1" rowspan="1">6</td>
<td class="TABLEDATACELLNOTT" nowrap="nowrap" align="Center" colspan="1" rowspan="1"> 13:41:30</td>
</tr> 
```

我现在的表达是：

```
<tr>[\s]<td[^<]+?>Max Temperature[\w\s]*</td>[\s]
<td[^<]+?>(?<value>([\d]+))</td>[\s]
<td[^<]+?>(?<time>([\d\:]+))</td>[\s]</tr> 
```

但是我似乎无法提取任何匹配项。谁能指出我正确的方向，谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T11:00:27.610

众所周知，使用正则表达式可靠地解析 HTML 非常困难。

我想我会寻找一个 HTML 解析库，或者一个“屏幕抓取”库；）

如果 HTML 来自不可靠的来源，则必须格外小心处理恶意 HTML 语法。糟糕的 HTML 处理是安全攻击的主要来源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T10:58:55.820

尝试

```
<tr>\s*
<td[^>]*>.*?</td>\s*
<td[^>]*>\s*(?<value>\d+)\s*</td>\s*
<td[^>]*>\s*(?<time>\d{2}:\d{2}:\d{2})\s*</td>\s*
</tr>\s* 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T10:58:02.560

当你写的时候，`<td[^<]+?>`我猜你是真的意思`<td[^>]*>`

那是“左大括号，td，也许是右大括号以外的东西*......* ”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T10:58:47.163

```
<tr>[\s]<td[^<]+?>Max Temperature[\w\s]*</td>[\s] 
```

尚未全部查看，但 [^<] 可能需要为 [^>] ，因为您试图匹配所有非 > 直到最大温度之前的 >。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T10:59:53.760

结束 td 之前的 " (ºC)" 与：

```
<tr>[\s]<td[^<]+?>Max Temperature[^<]*</td>[\s] 
```

那是 \wa 字边界吗？我认为那里有点棘手，我会使用更通用的方法。

第三行，在 td 标签后面有一个空格，这算吗？

```
<td[^<]+?>[\s]?(?<time>([\d\:]+))</td>[\s]</tr> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T11:03:31.537

我使用[http://www.regexbuddy.com/](http://www.regexbuddy.com/)进行此类控制。到目前为止，我测试了@sgehrig 的建议是正确的

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-05T15:45:26.007

正如@Bjarke Ebert 建议的那样，改用[Html Agility Pack](http://htmlagilitypack.codeplex.com/)或类似的库。这是完成任务的正确工具。

# .net - Asp.Net MVC：服务器控件与 Html 类呈现控件？

> ID：271742
> 
> 赞同：3
> 
> 时间：2008-11-07T10:55:16.483
> 
> 标签：.net, asp.net, asp.net-mvc

渲染这样的控件有什么好处：

```
<% Html.RenderPartial("MyControl") %> or
<%=Html.TextBox("txtName", Model.Name) %> 
```

通过网络表单样式：

```
<uc1:MyControl ID=MyControl runat=server /> 
```

我知道性能可能是一个原因，因为不需要创建对象，但是有可能从代码中调用它只是为了做一些基本的渲染逻辑可能非常有用。

如果不鼓励这样做，那么您应该如何处理这种情况：

*   您需要有条件地使控件可见，并且您不想用呈现逻辑填充 HTML。

*   您有`<input type="text" value="<%= Model.Name %>" />`，但您需要检查 Model 是否为 null，因为否则会引发 NullPointerException。

**[编辑]**当我开始使用 ASP MVC 时，我问过这个问题，现在我看到了 MVC 方式的优势，就像 Cristian 的回答一样。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T11:09:32.070

这有几个原因。“传统的” ASP.NET WebForm 控件封装了 MVC 应用程序的控制器和视图方面，这将违反该模式。此外，通过使它们成为扩展方法，您可以获得很好的能力，例如能够将它们与您自己的实现交换并交换它们以进行测试

Phil Haack（ASP.NET MVC 的项目经理）在接受 Herdering Code 播客的采访时谈到了这一点

第 24 集：Phil Haack 谈 ASP.NET MVC Beta 版（第 1 部分）

[http://herdingcode.com/?p=75](http://herdingcode.com/?p=75)

第 24 集：Phil Haack 谈 ASP.NET MVC Beta 版本（第 2 部分）

[http://herdingcode.com/?p=82](http://herdingcode.com/?p=82)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T16:22:44.077

那么对于你的第二个问题，为什么不这样做：

```
<%= Html.TextBox("txtName", ((Model != null) ? Model.Name : "")) %>

```

无论如何，您应该检查您的控制器以确保您的模型不为空！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T17:00:47.887

从长远来看，在视图中进行空检查可能会导致悲伤。我解释 MVC 编程风格的方式是在控制器中准备视图数据，以便视图可以真正干净，而不是检查和条件。

另一方面，如果需要遵循潜在的空关联，则可以将该代码放在可重用的帮助器中，例如：

```
<%= Html.BindTextBox("txtName", Model, "Person.Name") %> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T22:51:29.353

一些纯粹主义者可能会说，在您的视图中包含代码是违反 MVC 范式的。RenderPartial 为您的用户控件创建一个假 Page 对象 - 确保后者不依赖 Page 对象的任何东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T15:58:44.437

我在@Matt 回答的地方找到[了这个问题：](https://stackoverflow.com/questions/108320/code-behind-in-aspnet-mvc)

> 此代码是否 A) 处理、存储、检索、对数据执行操作或分析，或 B) 帮助显示数据？
> 
> 如果答案是 A，则它属于您的控制器。如果答案是 B，那么它属于视图。
> 
> 如果是 B，它最终变成了风格问题。如果您有一些相当长的条件操作来尝试确定是否向用户显示某些内容，那么您可能会将这些条件操作隐藏在属性后面的代码中。

并且我同意。对我来说，用 aspx 写会更干净：

```
<custom:HtmlTextBox ID="txtName" runat="server" /> 
```

在代码隐藏中，例如：

```
if(this.Model != null) 
{
   this.txtName.Text = Model.Name;
} 
```

例如，比在 .aspx 中：

```
<% if(this.Model != null) { %>
  <input type="text" name="txtName" value="<%= Model.Name %>" />
<% } else { %>
  <input type="text" name="txtName" value="" />
<% } %> 
```

能够从代码隐藏操作控件非常有用，并且不违反 MVC 模式。也许我错过了什么？

谢谢！

# html - 和 和和有什么区别？

> ID：271743
> 
> 赞同：874
> 
> 时间：2008-11-07T10:56:08.463
> 
> 标签：html, xhtml

* * *

## 回答 #1

> 赞同：1144
> 
> 时间：2008-11-07T11:07:32.323

它们**对普通的网络浏览器渲染引擎具有相同的效果**，但它们之间存在**根本区别**。

正如作者在[讨论列表帖子](https://web.archive.org/web/20091124170143/http://lists.evolt.org/archive/Week-of-Mon-20010521/032901.html)中所写：

考虑三种不同的情况：

*   网络浏览器
*   盲人
*   手机

“Bold”是一种风格——当你说*“bold a word”*时，人们基本上知道这意味着在字母周围添加更多，比如“ink”，直到它们在其他字母中更加突出。

不幸的是，这对盲人来说毫无意义。在手机和其他 PDA 上，文本已经是粗体了，因为屏幕分辨率非常小。你不能在不搞砸的情况下加粗一个粗体。

**`<b>`是一种风格**——我们知道“粗体”应该是什么样子。

**`<strong>`**然而**，它表示应该如何理解某事**。“强”在浏览器中可能（并且经常）意味着“粗体”，但它也可能意味着像 Jaws（盲人）这样的口语程序的语气较低或用下划线表示（因为你不能加粗粗体）在 Palm Pilot 上。

HTML 从来都不是关于样式的。[搜索](http://www.google.com/search?q=%22Tim+Berners+Lee%22+%22Semantic+Web%22&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:de:official&client=firefox-a)“ Tim [*Berners-Lee”*](http://en.wikipedia.org/wiki/Tim_Berners-Lee)和*“语义网”。* `<strong>`是语义的——它描述了它所包围的文本（例如，*“这个文本应该比你显示的其余文本强”*），而不是描述它所包围的文本*应该如何显示**（*例如，*“这个文本应该是粗体”*）。

 *** * *

## 回答 #2

> 赞同：258
> 
> 时间：2008-11-07T10:59:58.643

`<b>`并且`<i>`是明确的 - 它们分别指定粗体和斜体。

`<strong>`并且`<em>`是语义的 - 它们指定封闭的文本应该以某种方式“强”或“强调”，通常是粗体和斜体，但允许通过 CSS 控制实际样式。因此，这些在现代网页中是首选。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-11-07T11:00:07.003

`<strong>`并`<em>`为您的文档添加额外的语义含义。碰巧它们还为您的文本提供了粗体和斜体样式。

你当然可以用 CSS 覆盖他们的样式。

`<b>``<i>`另一方面，仅应用字体样式，不应再使用。（因为您应该使用 CSS 进行格式化，并且如果文本确实很重要，那么您可能会使其“强”或“强调”！）

希望这是有道理的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-11-14T20:57:40.233

以下是定义的摘要以及建议的用法：

`<b>`...为实用目的而引起注意的一段文本，但没有传达任何额外的重要性，也没有暗示其他声音或情绪，例如文档摘要中的**关键词**、评论中的**产品名称**、评论中的**可操作词**交互式文本驱动软件，或**文章 lede**。

`<strong>`...现在代表重要性而不是强调。

`<i>`...一段以另一种声音或语气表达的文本，或以其他方式偏离正常散文以指示不同质量的文本，例如*分类名称*、*技术术语*、*来自另一种语言的惯用短语*、*思想*，或西方文本中的*船名*。

`<em>`...表示强调。

（这些都是来自 W3C 来源的直接引用，我强调了。参见：[https](https://rawgithub.com/whatwg/html-differences/master/Overview.html#changed-elements) ://rawgithub.com/whatwg/html-differences/master/Overview.html#changed-elements和[http://www.w3.org /TR/html401/struct/text.html#h-9.2.1](http://www.w3.org/TR/html401/struct/text.html#h-9.2.1)为原件）

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-07T11:11:51.800

`<b>`和`<i>`都与风格有关，而`<em>`和`<strong>`是语义的。在 HTML 4 中，第一个被归类为[字体样式元素](http://www.w3.org/TR/REC-html40/present/graphics.html#h-15.2.1)，而后者被归类为[短语元素](http://www.w3.org/TR/REC-html40/struct/text.html#h-9.2.1)。

正如您正确指出的那样，`<i>`并且`<em>`通常被认为是相似的，因为浏览器通常都以斜体呈现。但是按照规范，`<em>` *表示强调*，表示强调`<strong>` *更强调*，说的很清楚，但经常被误解。另一方面，何时使用`<i>`或之间的区别`<b>`实际上是风格问题。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-09T02:18:43.733

虽然`<strong>`并且`<em>`当然在语义上更正确，但似乎有明确的正当理由将`<b>`and`<i>`标记用于客户编写的内容。

在此类内容中，单词或短语可能会加粗或斜体，而我们通常无法分析这种加粗或斜体的语义推理。

此外，这样的内容可以指代粗体和斜体字和短语以传达特定含义。

一个例子是一个英语考试问题，它指示学生替换粗体字。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-09-04T17:46:00.230

`<em>`并且比 和消耗`<strong>`更多的带宽。`<i>``<b>`

它们还需要更多的输入（如果不是自动生成的）。

它们还会用更多的文本使编辑器屏幕变得混乱。我似乎记得程序员喜欢较小的源文件，如果它们相同的话。（让我们成为现实，它们是相同的。是的，存在“技术”（<i>**咳嗽**</i>，咳咳，对不起）差异，但这主要是假的。）

使用上述任何标签，您可以使用样式表自定义它们的显示方式，如果您需要它们看起来不同于其默认呈现。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2020-07-14T21:35:32.960

我将在这里冒险历史和实际的热门话题：

是的，根据规范，`<strong>`在 HTML4 中具有语义含义，并且`<b>`具有严格的表示含义。

是的，当 HTML5 出现时，为`b`和引入了稍微不同的新语义含义`i`。

是的，[W3C 推荐](https://www.w3.org/International/questions/qa-b-and-i-tags.en)——基本上——TL、DR；不要使用 b 和 i。

> 您应该始终牢记 ab 元素的内容可能并不总是粗体，而 i 元素的内容可能并不总是斜体。实际样式取决于 CSS 样式定义。您还应该记住，粗体和斜体可能不是某些语言内容的首选样式。如果有更具描述性和相关性的标签可用，则不应使用 b 和 i 标签。

但：

现实世界的互联网有大量现有的 HTML，这些 HTML 永远不会更新。现实世界的互联网必须考虑在庞大的软件网络和 CMS 系统之间生成、复制和粘贴的内容，这些系统都有不同的开发团队，并且建于不同的时代。

因此，如果您正在编写 HTML 或构建一个为其他人编写 HTML 的系统——当然——肯定使用`<strong>`而不是`<b>`表示“强烈强调”，因为它在语义上更正确。

但实际上，实际情况是 和 的语义和文体意义随着时间的推移已经出于必要`<strong>`而合并。`<b>`

如果我正在构建一个允许粘贴任何样式文本的 CMS，我需要为正在粘贴`<b>`并表示“强烈强调”的人以及正在粘贴`<strong>`并表示“使此文本加粗”的人进行计划。这可能不是“正确的”，但这就是现实世界此时此刻的运作方式。

因此，如果我正在为该网站编写样式表，我可能最终会编写一些如下所示的样式：

```
b,
strong {
  font-weight: 700;
  /* ... more styles here */
}

i,
em {
  font-style: italic;
  /* ... more styles here */
} 
```

或者，我将依赖浏览器默认设置，它与我所知道的每个现代浏览器中的上述代码执行相同的操作。

或者，我可能是数以百万计的使用[normalize.css 的站点之一，它注意确保 b 和 strong 被视为相同](https://github.com/necolas/normalize.css/blob/fc091cce1534909334c1911709a39c22d406977b/normalize.css#L95)。

世界上已经有如此庞大的 HTML 海洋可以满足这种期望，我只是无法想象它`b`会被贬低，`strong`或者浏览器会在默认情况下开始以不同的方式显示它们。

就是这样了。这是我对语义、历史和现实世界的热门看法。b/i 和 strong/em 是一样的吗？不会。在现代文明崩溃之前，它们可能都存在并在几乎所有情况下都被视为相同吗？我想是的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-07T11:01:40.120

**b**或**i**表示您希望将文本呈现为粗体或斜体。**strong**或**em**表示您希望以用户理解为“重要”的方式呈现文本。默认情况下，将 strong 渲染为粗体，将 em 渲染为斜体，但某些其他文化可能使用不同的映射。

就像程序中的字符串一样，**b**和**i**将被“硬编码”，而**strong**和**em**将被“本地化”。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-07T11:04:47.883

正如其他人所说，<b> 和 <i> 是显式的（即“使此文本变粗”），而 <strong> 和 <em> 是语义的（即“应强调此文本”）。

在现代网络浏览器的上下文中，很难看出差异（它们似乎都产生相同的结果，对吧？），但想想为视障人士设计的屏幕阅读器。如果屏幕阅读器遇到 <i> 标记，它不知道该怎么做。但是，如果遇到 <em> 标签，它就知道其中的任何内容都应该向听众强调。在其中你会得到实际的区别。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-04-18T16:01:04.403

`<i>`, `<b>`,`<em>`和`<strong>`标签传统上是具有代表性的。但它们在**HTML5中被赋予了*****新的*语义含义**。

 **`<i>`并`<b>`用于 HTML4 中的字体样式。`<i>`用于斜体和`<b>`粗体。在 HTML5中，标签具有“**交替语音或情绪**”`<i>`的新语义含义，标签具有**风格偏移**的含义。**`<b>`**

 ****标签的示例用法`<i>`是 - 分类名称、技术术语、来自另一种语言的惯用短语、音译、思想、西方文本中的船名。如 -

```
<p><i>I hope this works</i>, he thought.</p> 
```

标签的示例使用`<b>`是文档摘录中的关键字、评论中的产品名称、交互式文本驱动软件中的可操作词、文章引导。

下面的示例段落在风格上与其后面的段落有偏移。

```
<p><b class="lead">The event takes place this upcoming Saturday, and over 3,000 people have already registered.</b></p> 
```

`<em>`并且`<strong>`在HTML4中有强调和强调的意思。但在 HTML5 中`<em>`意味着**强调强调**，`<strong>`意味着**强烈的重要性**。

**在以下示例中，在阅读之前**的单词时应该有语言变化......

```
<p>Make sure to sign up <em>before</em> the day of the event, September 16, 2016</p> 
```

在同一个例子中，我们可以使用`<strong>`如下标签..

```
<p>Make sure to sign up <em>before</em> the day of the event, <strong>September 16, 2016</strong></p> 
```

重视活动日期。

MDN 参考：

[https://developer.mozilla.org/en-US/docs/Web/HTML/Element/b](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/b)

[https://developer.mozilla.org/en-US/docs/Web/HTML/Element/i](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/i)

[https://developer.mozilla.org/en-US/docs/Web/HTML/Element/em](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/em)

[https://developer.mozilla.org/en-US/docs/Web/HTML/Element/strong](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/strong)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-09T03:53:19.597

正如其他人所说，区别在于硬编码字体样式，而决定`<b>`语义含义，字体样式（或说浏览器语调，或你有什么）在呈现文本时确定（或说）。`<i>``<strong>``<em>`

如果您愿意，您可以将其视为“物理”字体样式和“逻辑”样式之间的区别。稍后，您可能希望更改显示方式`<strong>`和`<em>`文本，例如，通过更改样式表中的属性以添加颜色和大小更改，甚至完全使用不同的字体。如果您使用“逻辑”标记而不是硬编码的“物理”标记，那么您只需在样式表中的一个位置更改显示属性，然后***所有引用该样式表的页面都会自动更改***，而无需不得不编辑它们。

很流畅吧？

这也是`style=`为段落、表格单元格、标题文本、标题等定义子样式（使用文本标签中的属性引用）和使用`<div>`标签的基本原理。您可以在样式表中为您的逻辑样式定义物理表示，并且更改会自动反映在引用该样式表的网页中。想要源代码的不同表示？为您的“代码”样式重新定义字体、大小、粗细、间距等。

如果您使用 XHTML，您甚至可以定义自己的语义标签，并且您的样式表会为您完成到物理字体样式和布局的转换。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-03-05T20:59:25.347

实际上，我同时使用 <strong> 和 <b> 正是出于此回复线程中提到的原因。有时，粗体字*看起来*会更好，但它在语义上并不一定比句子的其余部分更重要。这是我现在正在处理的页面中的一个示例：

“检索<strong>所有</strong>关于<b>长曲棍球</b>的书籍。”

在那句话中，“all”这个词非常重要，而“lacrosse”则不太重要——我只是想让它加粗，因为它代表一个搜索词，所以我想要一些视觉上的分离。如果您正在使用屏幕阅读器查看该页面，我真的认为不需要特意强调“曲棍球”这个词。

我倾向于想象大多数 Web 开发人员都使用其中之一，但两者都很好——正如某些人所声称的那样，<b> 绝对不会被弃用。对我来说，这只是视觉吸引力和意义之间的一条细线。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-12-15T13:48:26.887

只有在使用 CSS 样式类出于任何原因不方便或不可能时才使用它们（例如博客系统，只允许在帖子中使用一些标签并最终嵌入样式）。另一个原因是支持非常旧的浏览器（某些移动设备？）或原始搜索引擎（为`<b>`或`<strong>`标签给出分数，而不是分析 CSS 样式）。

如果您可以定义 CSS 样式，请使用它们。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-02-06T06:57:35.073

`<b>` 对于使用标签的粗体文本

对于使用 `<strong>` 标签的重要文本

`<i>` 对于使用标签的文本斜体样式

`<em>` 对于使用标签的强调文本

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-07-28T17:16:45.797

`<b>`并且，*很久*`<i>`以前没有实际的语义含义（如@splattne 指出的那样）是正确的。在现代 HTML5 ( ) 中，它们**确实**有意义。查看以下链接。*`<!DOCTYPE html>`*

 ***## 语义（来自 MDN）

*   `<b>`:[关注元素](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/b)

    *   摘要中的关键字
    *   产品名称。

```
<p>Here at company XYZ, we use <b>HTML</b> and <b>Javascript</b>.</p> 
```

*   `<i>`:[惯用文本元素](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/i)
    *   另类的声音或情绪
    *   分类名称（例如“智人”属和种）
    *   来自另一种语言的惯用术语（例如“等”）
    *   技术用词

```
<p>I <i>did</i> tell him, to arrive on time for the meeting.</p> 
```

### `<b>`对比`<strong>`

认识到 HTML5 中的有效元素和语义元素可能会有所帮助，并且巧合的是，它们在大多数浏览器中都具有相同的默认样式（粗体）（尽管一些较旧的浏览器实际上会加下划线`<strong>`）。每个元素都旨在用于某些类型的场景，如果你想加粗文本进行装饰，你应该实际使用 CSS font-weight 属性。[来源](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/strong#%3Cb%3E_vs._%3Cstrong%3E)

### `<i>`对比`<em>`

元素表示其内容的`<em>`强调重点，而`<i>`元素表示从普通散文引出的文本。[来源](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/em)

## 我的 2 美分

我个人更喜欢`<b>`and `<i>`over `<strong>`and `<em>`。

从开发人员的角度来看，它们更短，它们的语义*也很有意义*。我不知道今天的屏幕阅读器是否可以使用它们。如果没有，我想他们最终会的。A18n 是一个很难的话题，我只是按照文档的引导。MDN 说我可以使用它们，所以我这样做了。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-07T11:01:14.567

`<b>`并且`<i>`应该避免，因为它们描述了文本的样式。相反，使用`<strong>`and`<em>`因为它描述了文本的语义（意义）。

与 HTML 中的所有内容一样，您应该考虑的不是您希望它的*外观*，而是您的实际*含义*。当然，它对你来说可能只是粗体和斜体，但对屏幕阅读器来说却不是。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-11-07T11:01:27.530

“它们具有相同的效果。但是，XHTML 是一种更简洁、更新的 HTML 版本，建议使用`<strong>`标签。强更好，因为它更易于阅读 - 它的含义更清晰。此外，`<strong>`传达一种含义 - 显示文本strong - while `<b>`(for bold) 传达一种方法 - 将文本加粗。使用strong，如果您使用 CSS 样式表来更改使文本变得强大的方法，您的代码仍然有意义。

`<i>`和“之间的区别也是如此`<em>`。

谷歌迪克西特：

[http://wiki.answers.com/Q/What_is_the_difference_between_HTML_tags_b_and_strong](http://wiki.answers.com/Q/What_is_the_difference_between_HTML_tags_b_and_strong)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-11-07T11:18:26.547

你通常应该尽量避免`<b>`and `<i>`。在创建 CSS 之前的早期 HMTL 版本中，它们被引入用于布局页面（改变它的外观），比如同时删除的`font`标签，主要是为了向后兼容而保留，因为一些论坛允许内联 HTML，这很容易改变文本外观的方法（比如 BBCode 使用`[i]`，你可以使用`<i>`等等）。

自从创建 CSS 以来，布局实际上不再应该在 HTML 中完成，这就是首先创建 CSS 的原因（HTML == 结构，CSS == 布局）。这些标签将来也可能会消失，毕竟`span`如果您需要“无意义”的字体变体，您可以使用 CSS 和标签使文本变为粗体/斜体。HTML 5 仍然允许它们，但声明以这种方式标记文本*没有任何意义*。

`<em>``<strong>`另一方面，只说“强调”或“强烈强调”的东西，它完全开放给浏览器如何呈现它。默认情况下，大多数浏览器将呈现`em`为标准建议的斜体和`strong`粗体，但它们并非被迫这样做（它们可能使用不同的颜色、字体大小、字体等）。您可以使用 CSS 以您希望的方式更改行为。`em`例如，如果你愿意，你可以加粗，`strong`加粗和红色。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-06-11T14:19:01.777

**HTML 格式化元素：**

HTML 还定义了用于定义具有特殊含义的文本的特殊元素。HTML 使用 <b> 和 <i> 等元素来格式化输出，例如粗体或斜体文本。

**HTML粗体和强格式：**

> HTML <b> 元素定义粗体文本，没有任何额外的重要性。

```
<b>This text is bold</b> 
```

> HTML <strong> 元素定义了强文本，增加了语义“强”的重要性。

```
<strong>This text is strong</strong> 
```

**HTML斜体和强调格式：**

> HTML <i> 元素定义斜体文本，没有任何额外的重要性。

```
<i>This text is italic</i> 
```

> HTML <em> 元素定义了强调的文本，并增加了语义重要性。

```
<em>This text is emphasized</em> 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2020-08-18T10:13:58.913

在 HTML Lang 中，这两个标签的用法如下：

```
simple text this is test text normal text

simple text this is important textwith normal text 
```

这两个 HTML 标签之间的主要区别在于粗体使文本仅在视觉上看起来粗体，而强烈的象征意义也将相应的文本视为必不可少的，并表明它是一个清晰的单词或文本部分。

这种差异是由于 HTML 代码区分符号和物理视觉 html 标记这一事实。前者指的是相关领域的含义，后者仅仅定义了浏览器中的光学显示。[你可以从这里](https://slumcoder.com/article/difference-between-strong-and-bold-tags)检查这个

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2015-09-10T21:15:17.993

`<strong>`并且`<em>`是抽象的（这是人们说它是语义的意思）。 `<b>`并且`<i>`是使某些东西“强大”或“强调”的特定方法

比喻：

既是`<strong>`为了`<b>`又`<em>`是为了`<i>`

作为

“车辆”是“吉普车”

* * *

## 回答 #23

> 赞同：-5
> 
> 时间：2011-04-07T05:44:08.470

我们将`<strong>`标签用于对 SEO 目的具有高优先级的文本，如产品名称、公司名称等，而`<b>`简单则使其粗体。

同样，我们使用`<em>`对 SEO 具有高优先级的文本，同时`<i>`使文本简单地斜体。

# asp.net-mvc - asp.net mvc Beta1中的模型绑定

> ID：271745
> 
> 赞同：7
> 
> 时间：2008-11-07T10:56:23.157
> 
> 标签：asp.net-mvc, model-binding

我将我的 Web 应用程序从预览版 3 转换为 beta1，现在正尝试使用框架的新功能。其中之一是模型绑定。

对于这种特殊情况，我创建了一个类（目前）只是一堆简单类型属性的容器。如果我用一堆文本框创建一个表单，我希望框架用这些字段填充一个 SearchBag 实例。

*   我从哪里开始？这种行为是开箱即用的还是我实现了 SearchBagBinder？我快速浏览了 IModelBinder，但无法完全理解它，并且 DefaultModelBinder 源代码并没有让我变得更聪明。
*   这个 ModelBindingContext 是什么？
*   如何访问我的表单域？
*   如果值不是通过表单传递而是直接输入 URL 会怎样？
*   我在哪里可以找到这方面的最新信息（大多数博客都已过时）？我以为我曾经读过菲尔的一篇文章，但我似乎再也找不到了。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T12:46:39.677

> *   我从哪里开始？这种行为是开箱即用的还是我实现了 SearchBagBinder？我快速浏览了 IModelBinder，但无法完全理解它，并且 DefaultModelBinder 源代码并没有让我变得更聪明。

它是开箱即用的。您可以使用 UpdateModel 或 ModelBinder 来实现您想要做的事情。

> *   这个 ModelBindingContext 是什么？

这包含将请求绑定到您的模型的所有必要信息。与 ControllerContext 和 ActionFilterContext 类似，它基本上是 ModelBinder 的状态，并且包含执行所需操作所需的所有信息，前提是您遵循 ASP.NET MVC 团队对 ModelBinder 应该做什么的建议。

> *   如何访问我的表单域？

```
context.HttpContext.Request.Forms["myformfield"]; 
```

或者

```
foreach (var field in context.HttpContext.Request.Forms.Keys) {
    var value = context.HttpContext.Request.Forms[field];
} 
```

> *   如果值不是通过表单传递而是直接输入 URL 会怎样？

如果您需要同时检查 Form 和 QueryString ，只需遍历这两个集合。

```
foreach (var field in context.HttpContext.Request.Forms.Keys) {
    var value = context.HttpContext.Request.Forms[field];
}
foreach (var field in context.HttpContext.Request.QueryStrings.Keys) {
    var value = context.HttpContext.Request.QueryStrings[field];
} 
```

或者您可以循环访问包含 Form、QueryString、Headers 等的 Param。

```
foreach (var field in context.HttpContext.Request.Params.Keys) {
    var value = context.HttpContext.Request.Params[field];
} 
```

> *   我在哪里可以找到关于此的最新信息*（大多数博客都已过时）？我以为我曾经读过 Phill 的一篇文章，但我似乎再也找不到了。

你说得对，Phil 是作为 ASP.NET MVC 的 PM 获取信息的最佳场所。

# java - 有人知道 Java 的邮件 (SMTP) 传递库吗？

> ID：271747
> 
> 赞同：10
> 
> 时间：2008-11-07T10:57:55.307
> 
> 标签：java, smtp, email, james

我想发送邮件而不用打扰用于传递的 SMTP 服务器。

所以[JavaMail API](http://java.sun.com/products/javamail/)对我不起作用，因为我必须指定一个 SMTP 服务器来连接。

我希望库通过查询邮件地址域的 MX 记录自行找出哪个 SMTP 服务器负责哪个电子邮件地址。

我正在寻找类似[阿司匹林](https://aspirin.dev.java.net/)的东西。不幸的是，我不能使用阿司匹林本身，因为开发在 2004 年停止并且库无法与现代垃圾邮件强化服务器正确通信。

一个可嵌入版本的[James](http://james.apache.org/)可以完成这项任务。但我还没有找到关于这是否可能的文档。

或者有人知道我可以使用的其他库吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-07T11:37:19.860

一种可能的解决方案：自己获取 MX 记录并使用[JavaMail API](http://java.sun.com/products/javamail/)。

[您可以使用dnsjava](http://www.dnsjava.org/)项目获取 MX 记录：

Maven2依赖：

```
<dependency>
    <groupId>dnsjava</groupId>
    <artifactId>dnsjava</artifactId>
    <version>2.0.1</version>
</dependency> 
```

MX记录检索方法：

```
public static String getMXRecordsForEmailAddress(String eMailAddress) {
    String returnValue = null;

    try {
        String hostName = getHostNameFromEmailAddress(eMailAddress);
        Record[] records = new Lookup(hostName, Type.MX).run();
        if (records == null) { throw new RuntimeException("No MX records found for domain " + hostName + "."); }

        if (log.isTraceEnabled()) {
            // log found entries for debugging purposes
            for (int i = 0; i < records.length; i++) {
                MXRecord mx = (MXRecord) records[i];
                String targetString = mx.getTarget().toString();
                log.trace("MX-Record for '" + hostName + "':" + targetString);
            }
        }

        // return first entry (not the best solution)
        if (records.length > 0) {
            MXRecord mx = (MXRecord) records[0];
            returnValue = mx.getTarget().toString();
        }
    } catch (TextParseException e) {
        throw new RuntimeException(e);
    }

    if (log.isTraceEnabled()) {
        log.trace("Using: " + returnValue);
    }
    return returnValue;
}

private static String getHostNameFromEmailAddress(String mailAddress) throws TextParseException {
    String parts[] = mailAddress.split("@");
    if (parts.length != 2) throw new TextParseException("Cannot parse E-Mail-Address: '" + mailAddress + "'");
    return parts[1];
} 
```

通过 JavaMail 代码发送邮件：

```
public static void sendMail(String toAddress, String fromAddress, String subject, String body) throws AddressException, MessagingException {
    String smtpServer = getMXRecordsForEmailAddress(toAddress);

    // create session
    Properties props = new Properties();
    props.put("mail.smtp.host", smtpServer);
    Session session = Session.getDefaultInstance(props);

    // create message
    Message msg = new MimeMessage(session);
    msg.setFrom(new InternetAddress(fromAddress));
    msg.setRecipient(Message.RecipientType.TO, new InternetAddress(toAddress));
    msg.setSubject(subject);
    msg.setText(body);

    // send message
    Transport.send(msg);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T17:04:08.627

这是完全错误的处理方式。

任何连接到互联网的人都可以使用某种“合法”的 SMTP 服务器来提交电子邮件——您的 ISP、您的办公室等。

你想利用，因为他们为你做了几件事。

1）他们接受您的信息并负责处理该信息。放下后，就不再是你的问题了。

2) 任何邮件反垃圾邮件技术均由服务器处理。更好的是，当/如果这些技术发生变化（域键有人吗？），服务器会处理它，而不是你的代码。

3) 作为该发送邮件系统的客户端，您已经拥有与该服务器通信所需的任何凭据。主要 SMTP 服务器通过身份验证、IP 范围等被锁定。

4）你不是在重新发明轮子。利用您拥有的基础设施。您是在编写应用程序还是邮件服务器？设置邮件服务器是一项通常很容易完成的日常任务。互联网上所有那些随意的“愚蠢”用户都设法设置了电子邮件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T16:43:22.023

不。

发送电子邮件比看起来要复杂得多。电子邮件服务器擅长（或应该擅长）可靠交付。

如果需要，设置一个单独的电子邮件服务器 - 这与在 Java 中实现一个基本相同（我怀疑你会找到用于此任务的库 - 它们基本上是完整的邮件服务器），但更简单。

# mysql - 没有在 [az] 和 [AZ] 之前或之后的搜索词的正则表达式

> ID：271762
> 
> 赞同：3
> 
> 时间：2008-11-07T11:01:16.940
> 
> 标签：mysql, regex

有人可以为我提供一个正则表达式来匹配前面或后面没有`[a-z]`and的搜索词`[A-Z]`吗？（其他字符都可以。）即，在搜索时`key`，我不希望`keyboard`出现在搜索结果中，但`key.`没关系。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T11:20:28.850

由于您没有指定您使用的正则表达式引擎，我将假设一个基线，在这种情况下“ `[^A-Za-z]key[^A-Za-z]`”就足够了。

如果您还想在行首和行尾捕获字符串，您还必须使用“ `^key[^A-Aa-z]`”和“ `[^A-Aa-z]key$`”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-07T11:03:25.327

`\bkey\b`应该做你想做的。

`\b`是一个词边界

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T12:18:41.543

由于这个问题用[mysql](/questions/tagged/mysql "显示标记为“mysql”的问题")标记，我假设您使用的是 MySQL 正则表达式。然后`[[:<:]]key[[:>:]]`就是你想要的。有关详细信息，请参阅[dev.mysql.com](http://dev.mysql.com/doc/refman/4.1/en/regexp.html)上的文档。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T11:03:22.690

如果你使用 Perl，你需要的是`\b`，也就是“单词边界”：

```
m/\bkey\b/ 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T12:11:31.760

或者更简洁`[^\w]key[^\w]`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-28T19:57:23.453

`OR`如果您这样做，则不需要s ：

```
(^|[^A-Za-z])key([^A-Za-z]|$) 
```

# c# - WebClient.DownloadDataAsync 正在冻结我的 UI

> ID：271767
> 
> 赞同：6
> 
> 时间：2008-11-07T11:03:06.623
> 
> 标签：c#, .net, webclient

我在我的 Form 构造函数中，在 InitializeComponent 之后有以下代码：

```
using (WebClient client = new WebClient())
{
    client.DownloadDataCompleted += new DownloadDataCompletedEventHandler(client_DownloadDataCompleted);
    client.DownloadDataAsync("http://example.com/version.txt");
} 
```

当我启动我的表单时，UI 直到 client_DownloadDataCompleted 被提出后才会出现。client_DownloadDataCompleted 方法是空的，所以那里没有问题。

我做错了什么？在不冻结 UI 的情况下应该如何做到这一点？

谢谢你的时间。
最好的祝福。

**完整代码：**

**程序.cs**

```
using System;
using System.Windows.Forms;

namespace Lala
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new Form1());
        }
    }
} 
```

**Form1.cs**

```
using System;
using System.Net;
using System.Windows.Forms;

namespace Lala
{
    public partial class Form1 : Form
    {
        WebClient client = new WebClient();

        public Form1()
        {
            client.DownloadDataCompleted += new DownloadDataCompletedEventHandler(client_DownloadDataCompleted);
            client.DownloadDataAsync(new Uri("http://www.google.com"));
            InitializeComponent();
        }

        void client_DownloadDataCompleted(object sender, DownloadDataCompletedEventArgs e)
        {
            textBox1.Text += "A";
        }
    }

    partial class Form1
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.button1 = new System.Windows.Forms.Button();
            this.textBox1 = new System.Windows.Forms.TextBox();
            this.SuspendLayout();
            // 
            // button1
            // 
            this.button1.Location = new System.Drawing.Point(12, 12);
            this.button1.Name = "button1";
            this.button1.Size = new System.Drawing.Size(75, 23);
            this.button1.TabIndex = 0;
            this.button1.Text = "button1";
            this.button1.UseVisualStyleBackColor = true;
            // 
            // textBox1
            // 
            this.textBox1.Location = new System.Drawing.Point(12, 41);
            this.textBox1.Multiline = true;
            this.textBox1.Name = "textBox1";
            this.textBox1.Size = new System.Drawing.Size(468, 213);
            this.textBox1.TabIndex = 1;
            // 
            // Form1
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(492, 266);
            this.Controls.Add(this.textBox1);
            this.Controls.Add(this.button1);
            this.Name = "Form1";
            this.Text = "Form1";
            this.ResumeLayout(false);
            this.PerformLayout();

        }

        #endregion

        private System.Windows.Forms.Button button1;
        private System.Windows.Forms.TextBox textBox1;
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T12:32:23.480

既然我们已经有了完整的代码，我可以说我绝对没有看到问题 - 反正不像描述的那样。

我有一些日志记录来指示在 DownloadDataAsync 调用之前和之后，以及何时触发完成的处理程序。如果我通过 3G 下载一个大文件，“之前”和“之后”之间会有一个暂停，但用户界面会在文件完成下载之前出现*很长时间。*

我怀疑*连接*是同步完成的，但实际下载是异步的。当然，这仍然很不幸 - 可能将所有这些都放到不同的线程中是要走的路 - 但如果我是对的，至少值得了解。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-04-05T20:52:21.220

遇到了同样的问题，找到了解决办法。这里相当复杂的讨论： [http ://social.msdn.microsoft.com/Forums/en-US/a00dba00-5432-450b-9904-9d343c11888d/webclient-downloadstringasync-freeze-my-ui?forum=ncl](http://social.msdn.microsoft.com/Forums/en-US/a00dba00-5432-450b-9904-9d343c11888d/webclient-downloadstringasync-freeze-my-ui?forum=ncl)

简而言之，问题在于 Web 客户端正在搜索代理服务器并挂起应用程序。以下解决方案有帮助：

```
WebClient webClient = new WebClient();
webClient.Proxy = null;
... Do whatever else ... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T11:04:57.540

您想在不同的线程中运行下载，请[将此](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)视为起点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T11:15:33.273

**未删除：**许多人像我一样考虑使用块，我已经确认它*不*相关。

您可以删除 using 块吗，我认为它正在等待处置 webclient 实例。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T11:24:20.840

我强烈怀疑这与在您仍在使用 WebClient 进行异步调用时处理它有关。

尝试删除 using 语句，并改为在事件处理程序中调用 Dispose。（或者只是为了测试，根本不用担心处理它。

如果您可以发布一个[简短但完整的程序](http://pobox.com/~skeet/csharp/complete.html)来演示该问题，那将非常方便。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T11:28:02.797

除了处理其他人提到的可能仍在运行异步调用的东西之外，我强烈建议不要在表单的构造函数中做这样的重量级事情。

而是在 OnLoad 覆盖中执行此操作，您还可以在其中检查 DesignMode 属性，这将帮助您避免 VS 表单设计器的多个级别的地狱。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-26T21:48:17.510

非 UI 线程中的 DownloadDataAsync 与 DownloadData：

DownloadDataAsync 很好，因为它在处理 DownloadDataCompletedEvent 之前实际上并没有占用线程，在请求发出并且服务器响应之后。

我相信 Jon Skeet 走在正确的轨道上 - 我已经读过 DNS 解析必须在异步 HTTP 请求排队并且 DownloadDataAsync 调用返回之前同步完成。

DNS解析会慢吗？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-05-19T21:37:43.470

我刚刚在 VS2010、.NET 4 下的 WPF 项目中测试了同样的东西。

我正在下载一个带有进度条的文件，以显示使用 WebClient.DownloadDataCompleted 等完成的百分比。

而且，令我惊讶的是，我发现@Dan 提到的同样的事情：在调试器中，它以一种有趣的方式阻塞了线程。在调试中，我的进度表以 1% 的速度更新，然后有一段时间什么也不做，然后又突然以 100% 的速度更新。（Debug.WriteLn 语句自始至终都能顺利打印）。在这两次之间，UI 被冻结。

但是在调试器之外，进度条从 0% 到 100% 平滑移动，并且 UI 永远不会冻结。这是你所期望的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-04-04T20:58:50.583

试试这个：

```
client.Proxy = GlobalProxySelection.GetEmptyProxy(); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-12-27T21:17:20.113

即使在 VS2015 中，这个问题仍然存在。我终于弄清楚了，人们使用的代码没有任何问题，问题实际上是你可以多快将数据写入标签控件，这就是挂起进程并导致 UI 冻结的原因。尝试将您引用的标签替换为您的 progresschanged 处理程序中的文本框。这为我解决了 UI 中的所有滞后问题，我希望这对其他人有所帮助，因为我花了数小时试图弄清楚为什么代码有时会起作用而不是其他代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-07T11:12:52.937

我试过你的代码，它工作正常。

您能否在运行时发布您的 Main(Args[]) 方法以及 a 和 b 的值：

```
 int a, b;
    ThreadPool.GetMaxThreads(out a, out b); 
```

我在 .NET 3.5 和 VS2008 中尝试过。我很茫然，但我确信这与您机器上的设置有关。不是代码。检查这些事情：

*   检查线程池（上图）。我得到 a=250 b=1000
*   禁用所有第三方插件
*   Load VS "Clean" (你重启了吗)
*   尽可能多地关闭程序/服务
*   检查您的 IE 配置。我认为该类使用 IE 代码/设置
*   防火墙？杀毒软件？
*   在另一台电脑上试试

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-07T11:13:27.100

这对我来说有点奇怪。

尝试保留 WebClient 的成员引用，这样您就不会在构造函数中销毁它，也许它在 client.Dispose() 上阻塞

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-07T11:27:11.927

using() 语句试图在 WebClient 仍在下载时调用 Dispose()。Dispose 方法可能会在继续之前等待下载完成。

尝试不使用 using() 语句并在 DownloadDataCompleted 事件中处理 WebClient。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-07T11:38:24.353

我可以很好地运行你的代码。表格出现并在表格出现后完成下载。

**正如你所说，我没有任何冻结。**

我认为这与您在其中运行它的环境有关。

您使用的是哪个版本的 .NET/Visual Studio？

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-07T11:52:24.403

嗯....我只是好奇

**你有防火墙吗？**

*你的机器上有*防火墙吗？

也许ZoneAlarm？

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-11-07T20:43:20.990

根据我的经验，它在运行调试项目（在 Visual Studio 中运行）和第一次访问服务器时会阻塞线程。

运行已编译的 exe 时，无法感知阻塞。

# sharepoint - 将 sharepoint 安装移动到不同的端口/URL

> ID：271772
> 
> 赞同：4
> 
> 时间：2008-11-07T11:04:32.377
> 
> 标签：sharepoint

我们已经在我们的一台服务器上安装了 Windows Search Server Express，它显然运行在 sharepoint 之上。

Sharepoint 安装在端口 80 上，我们的“正常”内部网运行在该端口上。当我禁用 Intranet 并运行 sharepoint 站点时，一切都按预期工作。Intranet 在很多地方都有链接，移动它会很痛苦，所以我试图将共享点移动到另一个“地方”（希望这不那么痛苦），或者是不同的端口，或者是作为虚拟目录下的虚拟目录主站点。

首先，当我进行任何这些更改时，它无法访问 Intranet 根目录。不知道它在那里寻找什么，但是好的，我让“网络服务”（运行“Sharepoint 80”应用程序池的帐户）访问 Intranet 根目录。这让我更进一步，我很难过：

当我将 Sharepoint 网站移动到另一个端口时，它抱怨找不到 default.aspx（没有，但在端口 80 上运行时也不需要它）

当我将它移动到现有站点的子文件夹并尝试在浏览器中打开 global.asax 时，ti 告诉我这个扩展名是被禁止的，即使“应用程序配置”是 - 据我所知 - 相同与 Sharepoint 站点相同，并允许 .asax 的 GET、HEAD、POST、DEBUG。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T11:55:24.430

Sharepoint 站点应该能够在任何端口上运行 - 如果您进入 Sharepoint Central Admin 并毫无问题地创建或删除 Web 应用程序。

您是否打算在端口 80 上与 Sharepoint 和您的常规站点进行异构运行？我知道您可以在 80 上创建一个 Web 应用程序，然后没有根网站集（Sharepoint 应用程序由一个在某个端口上运行的 Web 应用程序和其中的任意数量的网站集组成，每个网站集都有自己的目录路径并且可以包含列表、库、其他网站集等）只是在不同的路径上创建一个，但我不确定这将如何与同一端口上的现有网站一起工作 - 它可能不会很好。同样，您可以从 Sharepoint Central 管理页面创建和删除网站集，该页面从您服务器上的管理工具列表链接。我会先尝试这个，好像它是一个简单的解决方案。

Windows Search Server Express 是否与 Sharepoint 自己的搜索工具相关？如果是，您可能会发现它希望使用某些共享服务提供程序工具运行，即使 Sharepoint 也不希望在与其提供服务的站点相同的端口上运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-08T10:37:22.073

更好的方法是在您的 DNS 中为您的服务器创建另一个别名 (cname)，只需为每个网站设置不同的主机标头。

例如，在 DNS 中，您的机器可能被命名为“内联网”。为该机器创建一个名为“sharepoint”的别名

在 IIS 中，为 sharepoint 创建一个新网站，并将该站点的主机标头设置为“sharepoint.domain.com”，其中 domain.com 是您的域。

对 Intranet 网站执行相同操作，但将主机标头设置为“intranet.domain.com”

这样，您的用户就不必在 URL 中使用其他端口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T14:40:29.917

谢谢！我在 sharepoint 管理网站中找到了该选项。

我将此回复添加到详细说明我已采取的步骤 - 也许它们对其他人有用。

在共享点管理网站（在另一个端口上完美运行）中，我选择了“创建或扩展 Web 应用程序”，然后选择“扩展现有 Web 应用程序”。

在那里，从下拉“Web 应用程序”中，“更改 Web 应用程序”打开一个弹出窗口，其中包含可用的 Web 应用程序。搜索服务器安装为“Sharepoint 80”，所以我选择了它。

然后我选择了“创建新的 IIS 网站”，使用新名称和新端口。默认情况下，所有其他选项对我来说都很好。

单击确定，这将在 IIS 中创建一个已正确配置的新网站。它不能通过服务器的 IP 地址 ( [http://192.xxx:8080](http://192.x.x.x:8080) ) 工作，只能使用服务器名称 - 但我没关系 :)

我仍然需要对访问权限进行一些调整，但是完整的爬网正在运行，我已经可以找到一些文档。耶！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-14T06:00:02.660

当您首先备份站点然后使用新端口号从中央管理员创建一个新站点然后将备份恢复到它时，这会容易得多（覆盖）

# java - Java：使用MulticastSocket接收时确定接收地址

> ID：271800
> 
> 赞同：2
> 
> 时间：2008-11-07T11:20:24.140
> 
> 标签：java, udp, multicast, multicastsocket

我正在使用 MulticastSocket 接收 UDP 多播数据包。如何确定这样的数据包发送到哪个地址？使用提供的方法，我只能确定发件人地址。

当然，我是在创建侦听套接字时设置 To-Address 的人，但我真的可以确定吗？广播包呢？以某种方式最终到达这里的数据包呢？我真的很想区分数据包是否真的是多播的。

谢谢！

更新：目前似乎刚刚发送到该端口的单播数据包也最终在多播套接字中接收（）:(绑定到设备也没有给我更好的结果

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T12:22:55.560

我对细节有点模糊，但是一个多播数据包将被发送到您订阅的 ip/port 组合（并且此信息将在数据包中的某个地方），假设您设法拥有一条清晰的中间路由器路径了解多播。如果你想确保多播套接字从正确的网络接口接收，有一堆函数可以将它绑定到特定的接口。

我认为您无法知道数据包是否“真正”多播，即有人总是可以伪造一个，因为没有内置真正的安全性。

# .net - Home-grown ORM vs. DataTables?

> ID：271806
> 
> 赞同：7
> 
> 时间：2008-11-07T11:25:30.680
> 
> 标签：.net, orm, datatable

This is a simplification of the issue (there are lots of ways of doing things), but among applications that need to talk to a database I have usually seen one of two patterns:

1.  Object-Relational Mapping (ORM), where (usually) each table in the database has a corresponding "row wrapper" class with public properties that match the columns in the table. Sometimes these classes also automagically retrieve related information, so that foreign key columns can instead be exposed and displayed as the related data (rather than just the PK values).
2.  DataTables (and/or DataSets), where data is retrieved from the server as a DataTable and worked with in that form (even in the UI).

One of the major differences between the two approaches is that ORM allows you to reference strongly-typed fields in your code like so:

```
Person bob = new Person();
bob.FirstName = "Bob";
collectionPeople.Add(bob); 
```

whereas with the DataTable approach your code would be something like:

```
DataRow newrow = datatablePeople.NewRow();
newrow["FirstName"] = "Bob";
datatablePeople.Rows.Add(newrow); 
```

In this case, the ORM approach benefits from compile-time checking while the DataTable approach does not. On the other hand, the DataTable (and the DataSet) are already-written data structures that do an excellent job of representing relational data directly, so code that uses them can usually be implemented more quickly. In addition, code that uses DataTables can be easily understood and modified by others; home-grown (and often COTS) ORM systems often do extra database access "under the hood" to populate foreign keys and so forth, which can create problems for the unaware.

So which approach do you generally favor and why?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T11:32:54.957

I favor the DataTables way, because I'm old, tired, and skeptical of fashions like Subsonic and Linq.

Beyond that, when you are working with an ORM, you are generally minimizing what you do in SQL. You don't put a lot of logic in the SQL and you don't batch up several SQL statements so as to do multiple things in one trip to the database. Therefore, you tend to go to the database more often, and that's a big performance hit.

Using Datasets, I can do something like:

select col1, col2... from table1
select col1, col2... from table2
select col1, col2... from table3

and then make ONE trip to the database to get all three DataSets, using Tables[0], Tables[1], Tables[2] to reference them. It makes a very big difference in performance.

Someday maybe the interaction with the database will be so fast that there would be no point in batching up the SQL, but that day isn't here yet. When it comes, I'll switch to ORM, but until then, I'm willing to have my code be a little uglier in exchange for performance. It's no fun for users to use a sluggish app.

Finally, I like SQL. I'm good at SQL. Real good. I don't want to spend my time figuring out how to co-erce Linq to emit the SQL that I want. It would slow down *MY* performance.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-07T13:30:32.257

Datatable will certainly be conceptually more straight forward in working with data. And its devoid of sometimes unnatural idioms that you find in ORM. (querying a record into local memory, before updating it; joins are pointers; the key value itself is a pointer, hence, adding a record requires loading the parent record)

The big advantages for ORM are...

1) it writes the sql for you, so you dont really have to write any sql to do basic crud. Of course writing more complex statements has to be done in a less powerful sublanguage (i.e. hql)

2) The other big advantage of ORM is when you get results back, it maps it into value objects, without writing a bunch of code to map the values and handle type conversion.

If you have strong sql skills but want advantage 2 covered, i would go with ibatis

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-07T11:47:56.923

You could combine both approaches mentioned using [Strongly Typed DataSets](http://msdn.microsoft.com/en-us/library/esbykkzb.aspx).

It's possible to add them to a Visual Studio project via "Add New Item" dialog "DataSet template" and then use visual Dataset Designer (it edits XSD file behind the scenes).

There is another [article](http://msdn.microsoft.com/en-us/magazine/cc163877.aspx) on subject.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-30T00:21:14.863

In .Net strongly typed datasets have the benefits you attribute to ORM -- the value of strong typing in the IDE and Intellisense,

The TableAdapters created in Visual Studio will write all of your CRUD SQL for you. You put your business logic in the C# (or other lang.) and not in the SQL.

I think the disconnected data model offered by datasets proves to be more efficient in practice than typical hand-coded SQL. It leads to non-chatty DB interactions where you get all of your related table data in a single query. And it has very good support for optimistic locking (providing DBConcurrency exceptions). The dataset also tracks insertions, modifications and deletions to your data, so you don't have to.

Strongly typed datasets also offer straight-forward navigation to related table data.

A good reference on DataSets is

> Programming Microsoft® ADO.NET 2.0 Core Reference by David Sceppa
> 
> Publisher: Microsoft Press Pub Date: May 17, 2006 Print ISBN-10: 0-7356-2206-X Print ISBN-13: 978-0-7356-2206-7 Pages: 800

+tom

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-07T16:43:37.920

I would look at the advantages of data objects versus DataTables (a fancy ORM library isn't really necessary though they can be nice):

*   Conceptually clean. You're forced to apply OO concepts to your data. It's easier to understand "this is a Person" versus "the Person I want is somewhere in this table".
*   Enforces separation of concerns. It's tempting to tack UI context data to a DataTable - for one UI I get a Person with a primary address in the same record, for another I get a Person with credit information in the same record. When I'm working with a model, I want that model to be consistent wherever I consume it.
*   Transform the data only once. In the DataTable-crunching apps I've seen, there's a lot of this scattered all over:

    if(row["col"] == DBNull.Value || string.IsNullOrEmpty(row["col"] as string)) ...

    I'd rather check that condition once when I populate the data object versus checking it everywhere the DataTable is used.

*   Easier to unit test. If you reference a field in a data object that doesn't exist, you get a compile-time error. If you reference a field in a DataTable that doesn't exist, you get a run-time error.

I do believe ORM can make you lazy. For instance, there's absolutely no reason to populate a set of related data objects from individual queries in the objects if those objects are always used together. Instead, write a big and efficient query that grabs all the necessary data and then builds the data object graph. Still, if you keep its limitations in mind, it does save a lot of work.

Related: [How to convince my co-workers not to use datasets for enterprise development (.NET 2.0+)](https://stackoverflow.com/questions/37378/how-to-convince-my-co-workers-not-to-use-datasets-for-enterprise-development-ne).

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-21T12:18:57.193

I used to use DataSets in early .NET days, then started using typed DataSets, over time found that the memory footprint left by DataSets are very high and it did not make sense to use unmanaged objects for every simple tasks.
Hence concluded that DTOs/POCOs are a better choice and started using NHibernate and iBatis.
My average(or below average) developers found them complex and hard to use(no pun intended).
So I made a *home grown* ORM [XmlDataMapper](http://xmldatamapper.codeplex.com//) that was much easier to use that the complex ORMs out there.

To integrate XmlDataMapper all you need to do is 4 little steps

1.  Create a Business Entity / DTO for the tables
2.  Create an XML File with the mapping information between the table and the DTO.
3.  Specify the DTO and xml file in the configuration.
4.  Just call the DTOConverter.Convert(dataReader) and other such methods to convert your database record to DTO / Business Entity

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T11:32:08.687

I used to just use a datareader to read fields onto my object using GetString, GetInt etc. but i've moved on now to a much more OO and testable approach using a Gateway to return a datatable from a query, this is then passed into a Service class which parses the table onto an object.

I never really liked ORM tools, they were always cumbersome and difficult to maintain, but i havent had a chance to play with LINQ yet so my opinion may change.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-07T12:15:52.687

I find that I'm able to develop less code and test my code better using an ORM than DataSets/DataTables. I'm currently using LINQ-to-SQL and wrapping a thin layer around the designer generated code via partial classes as my ORM. The thin layer basically allows me to add some role-based permissions and increases the testability of the code by refactoring to interfaces and using dependency injection to specify the data context (that way I can mock it up for other tests).

I've done both -- write my own ORM around DS/DT, strongly-typed DS/DT, etc. and have switched to LINQ and am not going back. I may eventually move to something like NHibernate, Entity Framework, or something else, but for now my LINQ solution offers pretty much all I need and is much simpler than my old solutions.

# c# - 将单元测试写入程序集还是单独的程序集中？

> ID：271808
> 
> 赞同：19
> 
> 时间：2008-11-07T11:26:09.633
> 
> 标签：c#, unit-testing

在编写单元测试时，您是将测试放在要测试的程序集中还是单独的测试程序集中？我已经在单独的程序集中编写了一个包含类中测试的应用程序，以便于部署，因为我可以排除程序集。是否有人在您希望测试的程序集中编写测试，如果有，这样做的理由是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T11:28:34.200

我有一个包含接口项目、测试项目、域项目和数据项目的单一解决方案。当我发布时，我只是发布了接口，它不引用测试，所以它不会被编译。

编辑：底线是你真的不希望它成为你最终版本的一部分。您可以通过使用单独的项目/程序集在 VS 中自动实现这一点。但是，您可以将它放在同一个程序集中，但如果您使用的是 nant 或 msbuild，则不要编译该代码。不过有点乱，保持整洁，使用单独的程序集:)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-07T11:32:10.917

这在网络上引起了广泛的争论。

我们使用单独的程序集和 InternalsVisibleTo 属性来帮助测试程序集查看被测试程序集的所有内部结构。我们倾向于为我们正在测试的每个组件制作一个测试组件。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-07T12:02:58.737

我想说，您唯一想在最终部署中加入任何测试代码的情况是，当测试代码用于监视和控制应用程序时。

将测试代码留在部署中：

*   **使代码膨胀，根本没有真正的优势**——所有额外的代码标记根本不会在原地使用。
*   **影响发布**- 您是否发布完整应用程序的新版本。当您只改进了测试代码时，例如，由于错误修复而扩展了测试套件。
*   **you can't easily reuse the test framework on another project** - if you are always releasing app's that are clogged with test code, any subsequent projects have to reuse the same test code. Otherwise, you finish up with the situation where app A is using v1.2 of the test platform for those aspects of the app. that are common across all your app's, e.g. a presentation layer, or a business logic framework, etc. And app. B is using v1.1 of the test framework, app. C is using v1.2.1, etc.

Decoupling on the otherhand allows you to:

*   easily upgrade and extend the test suite as required.
*   easily reuse the test suite across multiple projects.
*   use a common test framework across multiple projects.

HTH

cheers,

Rob

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-07T11:31:32.493

在不同的装配中。否则，您的程序集将引用测试框架（例如 Nunit.Framework.dll），您需要将其安装在客户机器上，

即使您发布的是一个库，并且您希望您的客户将单元测试视为示例或关于如何使用您提供的对象的规范，将其包含在生产程序集中也没有什么优势。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T15:24:24.757

You can keep them in separate assemblies in the solution, and ILMerge them later for debugging, and don't ILMerge them for release.

# php - 显示从数据库查询返回的空字段的默认值的最佳方法？

> ID：271815
> 
> 赞同：0
> 
> 时间：2008-11-07T11:29:48.270
> 
> 标签：php, database

有没有更好的方法来编写这段代码？

我想为查询返回的任何空字段显示默认值（“无数据”）：

```
$archivalie_id = $_GET['archivalie_id'];

$query =    "SELECT 
                a.*, 
                ip.description AS internal_project,
                o.description AS origin,
                to_char(ad.origin_date,'YYYY') AS origin_date  

            FROM archivalie AS a 
            LEFT JOIN archivalie_dating AS ad ON a.id = ad.archivalie_id                
            LEFT JOIN internal_project AS ip ON a.internal_project_id = ip.id
            LEFT JOIN origin AS o ON a.origin_id = o.id               

            WHERE a.id = $archivalie_id";

$result = pg_query($db, $query);

while ($row = pg_fetch_object($result))
{
    $no_data = '<span class="no-data">No data</span>';

    $internal_project = ($row->internal_project != '') ? $row->internal_project : $no_data; 
    $incoming_date = ($row->incoming_date != '') ? $row->incoming_date : $no_data; 
    $origin = ($row->origin != '') ? $row->origin : $no_data; 
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T11:35:29.880

你可以使用一个小的辅助函数

```
function dbValue($value, $default=null)
{
    if ($default===null) {
        $default='<span class="no-data">No data</span>';
    }
    if (!empty($value)) {
        return $value;
    } else {
        return $default;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T11:46:26.070

如果这不仅仅是示例代码，那么您肯定想通过编写来清理此查询......

```
$archivalie_id = pg_escape_string($_GET['archivalie_id']); 
```

或者你想用 intval() 转换 $archivalie_id 如果它显然总是一个整数。

此外，我建议用“_MYPROJECT_NODATA”之类的常量替换“无数据”，这样您就可以轻松更改无数据标签的外观或实现国际化。

然后你会使用

```
define('_MYPROJECT_NODATA', '<span class="no-data">No data</span>'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T12:13:46.653

一种方法是选择数据库服务器上的默认权限。

```
SELECT 
  IFNULL(NULLIF(a.field1, ''), 'No data')       AS field1, 
  IFNULL(NULLIF(a.field2, ''), 'No data')       AS field2, 
  IFNULL(NULLIF(ip.description, ''), 'No data') AS internal_project,
  IFNULL(NULLIF(o.description, ''), 'No data')  AS origin,
  to_char(ad.origin_date,'YYYY') AS origin_date  
FROM 
  archivalie AS a 
  LEFT JOIN archivalie_dating AS ad ON a.id = ad.archivalie_id                
  LEFT JOIN internal_project  AS ip ON a.internal_project_id = ip.id
  LEFT JOIN origin            AS o  ON a.origin_id = o.id               
WHERE 
  a.id = $archivalie_id 
```

这样您就可以立即输出值，而不必触及现有代码。将空`IFNULL(NULLIF())`字符串变为`NULL`和`NULL`。`'No data'`如果您想单独留下空字符串，请使用`IFNULL()`only。

从架构的角度来看，这可能缺乏一些优雅（取决于你如何看待它），但它是有效的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T12:23:44.980

您可以使用标准 SQL COALESCE 函数返回一个特殊的字符串而不是 null，如下所示：

```
$query =    "SELECT 
            a.*, 
            COALESCE(ip.description,'NO_DATA') AS internal_project,
            COALESCE(o.description,'NO_DATA') AS origin,
            COALESCE(to_char(ad.origin_date,'YYYY'),'NO_DATA') AS origin_date 
```

然后，您可以按照其他人的建议用程序中的适当 HTML 替换“NO_DATA”。

# html - 样式问题 - 样式和样式表的方法

> ID：271821
> 
> 赞同：1
> 
> 时间：2008-11-07T11:32:44.940
> 
> 标签：html, css

我有一个网站，通常在主页顶部有新闻项目，有时（在特定时期）在新闻项目下方会有一个或多个“快速链接”，以引导用户访问感兴趣的页面。在这些之下是通常的宣传。

我们有这些网站的替代语言版本，它们通常不包含新闻项目或快速链接，但可能会不时包含。

以前，当外观不太动态时，每个部分都是绝对定位的，并适当配置了一个 top 属性。但是由于需要更细微的变化，我发现自己在修改和更改基本 HTML 和样式表规则。

我的问题是人们如何看待这个问题的不同方法，他们有什么我没有考虑过的建议。实现预期的结果很容易，但我正在考虑使网站更易于阅读和调试的良好编码实践。

我可以为每个项目的每个变体设置单独的样式类：

```
.news {top: 100px; etc...;}
.news2 {top: 150px; etc...;}
.ql {top: 150px; etc...;}
.ql2 {top: 200px; etc...;}
.main {top: 200px; etc...;}
.main2 {top: 250px; etc...;} 
```

...这似乎有点过于冗长。

也许：

```
.news {etc...;}
.ql {etc...;}
.main {etc...;}
.top100 {top: 100px;}
.top150 {top: 150px;}
.top200 {top: 200px;}
.top250 {top: 250px;} 
```

更紧凑一些，它将样式保留在样式表中并远离 HTML。

或者，甚至可能：

```
.news {etc...;}
.ql {etc...;}
.main {etc...;} 
```

在 HTML 中：

```
<div class="news" style="top:100px;">
<div class="ql" style="top:150px;">
<div class="main" style="top:200px;"> 
```

这是最“直接”的解决方案，但显然某些样式在 HTML 中，从纯粹主义者的角度来看是“不可以”；这种观点有实际原因，但在这种情况下，这可能是处理将请求的各种和任意更改的最简单方法。

注意：该网站是由第 3 方设计的（很糟糕），尽管我试图在没有完全重写的情况下挽救它。然而，该网站将重新开发，最早可能在 2009 年第三季度或第四季度。在那个阶段，我希望从一种绝对定位的方法转变为一种更灵活的方法 - 所以这个问题是关于什么在此期间做，也作为一个普遍的风格问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T11:36:34.123

```
.top100 {top: 100px;}
.top150 {top: 150px;}
.top200 {top: 200px;}
.top250 {top: 250px;} 
```

这是一种不好的做法，因为您现在将样式信息添加到 HTML 中。最好使用描述性名称并将它们链接在一起。像：

```
.news {top: 100px; etc...;}
.news2, .ql {top: 150px; etc...;}
.ql2, .main {top: 200px; etc...;}
.main2 {top: 250px; etc...;} 
```

您可以稍后添加更多规则。

如果这**确实**是一个临时解决方案，请继续并让自己轻松。但是你现在大多数临时解决方案都会存在很多年。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-09T08:24:18.800

那么，您`"<classname>"`是否在没有快速链接的地方使用，而在有快速链接的情况下使用“ `<classname>2"`？

你可以在一个元素上使用多个类名，你知道的。所以你可以有`<elem class="<classname> quicklinks">`例如。并且在你的 CSS 中有一个单独的 .quicklinks 类来将所有内容再下移 50 像素。

然而，绝对定位并不意味着这样的事情。如果您将文本调整得这么大，事情就会开始重叠。

有可能仅快速链接的存在就可以用来使其他所有内容都下拉，前提是您不要像那样放置元素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T16:17:59.997

实际上，最好的解决方案可能是这样的：

```
.news, .news2 {top: 100px; etc...;}
.news2 {top: 150px;}
.ql, .ql2 {top: 150px; etc...;}
.ql2 {top: 200px;}
.main, .main2 {top: 200px; etc...;}
.main2 {top: 250px;} 
```

但我同意你的观点 GameCat ......

谢谢

# python - 我应该如何对客户端服务器应用程序进行压力测试/负载测试？

> ID：271825
> 
> 赞同：13
> 
> 时间：2008-11-07T11:35:00.583
> 
> 标签：python, database, client-server, load-testing, stress-testing

我开发了一个客户端-服务器风格、基于数据库的系统，我需要设计一种方法来对系统进行压力/负载测试。客户不可避免地想知道这样的事情：

• 一台服务器可以支持多少客户端？
• 服务器可以支持多少并发搜索？
• 我们可以在数据库中存储多少数据？
• ETC。

所有这些问题的关键是响应时间。我们需要能够测量响应时间和性能如何随着新负载的引入而下降，以便我们可以生成某种漂亮的图表，我们可以将其扔给客户，让他们了解在给定的情况下期望什么样的性能硬件配置。

现在，我们只是伸出手指，根据我们从经验中对系统的了解做出有根据的猜测。随着产品被置于更苛刻的条件下，这被证明不足以满足我们未来的需求。

我的任务是设计一种以有意义的方式获得此类答案的方法。我意识到这不是任何人都可以明确回答的问题，但我正在寻找有关人们如何在自己的系统上进行此类工作的建议。

需要注意的一点是，我们可以通过 Python 语言（由 SWIG 提供）完全访问我们的客户端 API，这比 C++ 更容易用于此类工作。

所以我们开始了，我把这个扔到地板上：真的很想看看你们能想出什么主意！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-07T11:44:40.333

**测试 1**：像 mad 一样连接和断开客户端，看看你如何处理会话的初始化和结束，以及你的服务器在峰值下能存活多少，同时测量有多少客户端无法连接。这是非常重要的

**测试 2**：连接客户端并让他们保持登录状态一周，做随机动作[(FuzzTest)](http://en.wikipedia.org/wiki/Fuzz_testing)。计算每个动作的往返时间。还要记录操作的顺序，因为这样你的“客户”会在你的用例中发现漏洞（非常重要，而且很难理性地测试）。

**测试 3 和 4**：确定系统的主要用例，并编写执行这些任务的脚本。然后运行几个执行相同任务的客户端（测试 3），以及执行不同任务的几个客户端（测试 4）。

**系列：** 现在您需要的另一个维度是客户数量。一个不错的系列是：5,10,50,100,500,1000,5000,10000,...

通过这种方式，您可以获得具有不同工作负载的每个系列测试的数据。

也恭喜您将您的客户 api 转换为 Python！这是做好准备的好方法。

注意：[IBM 有一个 Java 模糊测试样本](http://www.ibm.com/developerworks/java/library/j-fuzztest.html)，这对您的情况不适用，但会帮助您为您的系统设计一个好的模糊测试

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-07T11:55:19.017

如果你习惯用 Python 编写测试代码，我发现[funkload](http://funkload.nuxeo.org/)非常有能力。您没有说您的服务器是基于 http 的，因此您可能必须调整他们的测试工具以适应您自己的客户端/服务器风格。

一旦你在 Python 中进行了测试，funkload 可以在多个线程上运行它，监控响应时间，并在测试结束时为你总结。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-07T12:25:41.200

对于性能，您关注两件事：延迟（应用程序的响应能力）和吞吐量（每个间隔有多少操作）。对于延迟，您需要有一个可接受的基准。对于吞吐量，您需要具有可接受的最小吞吐量。

这些是你的起点。为了告诉客户每个间隔可以做多少 xyz，那么您将需要了解硬件和软件配置。了解生产硬件对于获得准确的数据很重要。如果您不知道硬件配置，那么您需要设计一种方法将您的数据从测试硬件映射到最终的生产硬件。

如果没有硬件知识，那么您实际上只能观察性能随时间的趋势，而不是绝对的。

了解软件配置同样重要。您是否有集群服务器配置，是否负载平衡，服务器上是否运行其他任何东西？您可以扩展您的软件还是必须扩展硬件以满足需求。

要了解您可以支持多少客户，您需要了解什么是标准操作集。一个快速的测试是删除客户端并编写一个存根客户端，然后尽可能多地启动这些客户端。让每一个连接到服务器。您最终将达到服务器连接资源限制。如果没有连接池或更好的硬件，您将无法获得比这更高的值。通常，您会在此之前遇到架构问题，但无论哪种情况，您都有上限。

获取这些信息并设计一个您的客户可以执行的脚本。您需要将脚本执行操作所需的时间与预期用户执行操作所需的时间进行映射。如上所述开始增加您的数量，以达到客户增加导致性能下降更大的程度。

压力测试有很多方法，但关键是了解预期负载。询问您的客户他们的期望。每个间隔的预期需求是多少？从那里你可以计算出高负荷。

您可以对许多连续运行数小时或数天的客户进行浸泡测试。您可以尝试尽可能快地连接尽可能多的客户端，以查看您的服务器如何处理高需求（也是 DOS 攻击）。

并发搜索应该通过代表客户端的标准行为搜索来完成，或者编写脚本来建立一个等待多个线程的信号量，然后您可以一次释放它们。这很有趣并且会惩罚您的数据库。执行搜索时，您需要考虑可能存在的任何缓存层。您需要测试缓存和不缓存（在每个人都提出唯一搜索请求的情况下）。

数据库存储基于物理空间；您可以根据字段长度和预期数据填充来确定行大小。统计推断或创建数据生成脚本（对您的负载测试场景很有用，应该是您组织的资产），然后将生成的数据映射到业务对象。您的客户会关心他们可以存储多少“业务对象”，而您会关心可以存储多少原始数据。

其他需要考虑的事项：预期可用性是多少？让服务器联机需要多长时间。如果需要两天时间才能恢复在线，那么 99.9% 的可用性并不好。另一方面，如果重新启动需要 5 秒并且您摔倒了，那么较低的可用性更容易接受。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T12:16:08.130

如果您有预算，LoadRunner 将是完美的选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-10T05:04:21.383

相关说明：Twitter 最近开源了他们的[负载测试框架](https://github.com/twitter/iago/)。可能值得一试:)

# .net - VS 解决方案，项目与 dll 最佳实践

> ID：271828
> 
> 赞同：10
> 
> 时间：2008-11-07T11:37:06.117
> 
> 标签：.net, visual-studio

每当我有一个跨不同网站/应用程序使用的库时，我总是将库的项目添加到同一个解决方案中并从那里引用它。这在需要在解决方案中进行调试时非常有用，但在所有其他情况下，这似乎毫无意义，并且在解决方案资源管理器中占用了更多空间。

另一个正面或负面的情况是，如果该库由公司中的其他人更新，然后我构建另一个使用相同东西的应用程序，他们可能会破坏构建。如果由于某种原因无法使用当前应用程序修复，那么您可以返回源代码管理并回滚到旧版本，但这似乎有点过头了。

我只是想知道其他人对这个问题的想法是什么。您通常做什么，引用 dll 或将项目添加到您的解决方案中。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T11:42:30.103

我们将生产 Dll 保存在网络驱动器上的知名位置，并通过 DFS UNC 路径（无驱动器号）进行引用。这样，我们可以同时使用不同版本的库，并且更新不会破坏代码/强制重新编译，直到需要使用较新的版本。可以使用标准命名方案来确保项目始终希望使用最新版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T12:35:50.620

您还可以在 GAC 中注册您的 dll。GAC 处理所有引用、版本控制等并且是安全的。分配了一个强密钥，这是位于 GAC 中的 dll 的先决条件，您可以安全地访问 Dll，并且在您使用共享服务器的地方，这可能是无价的。您使用此 dll 的站点有一个用于程序集的中央调用端口。GAC 有很多优势，在 MSDN 上有几篇文章，毫无疑问，谷歌上有数百篇文章专门介绍它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T11:39:16.143

将库保存在项目之间的某个共享文件夹中，然后引用它。这样，当它更新时，更改将在任何地方持续存在。对于调试，我认为如果您将库的 .pdb 文件放在手边，那么您应该能够进入 dll，但是，您是否应该关心调试库？

# c++ - 是否可以在 IIS 托管的 C++ 应用程序中启动自定义线程？

> ID：271833
> 
> 赞同：1
> 
> 时间：2008-11-07T11:38:57.440
> 
> 标签：c++, multithreading, iis, multicast

我们在 IIS 中托管了一个基于 C++ 的 WebServices 应用程序，我们发现当我们尝试启动自己的 C++ 线程时，IIS 会出现故障并崩溃。这些线程是基于 boost.thread 的，它清楚地传递到下面的标准 Windows 线程 API。

我需要启动线程的原因是监听来自我们的中间层服务器的多播，以保持本地缓存的最新状态。没有为我们编写另一个流程来倾听我们，我不知道我还能做什么。

所以问题是，这应该工作吗？用 IIS 做这种事情有固有的限制吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T15:01:49.873

听起来您正在创建一个持久线程，它的寿命比启动它的请求的寿命长。您没有提及它是 ASP.NET C++/CLI、托管 C++ 还是 ISAPI 扩展或过滤器，甚至是 CGI。

从概念上讲，IIS 调用的代码只应该在请求的生命周期内“存活”。运行时间更长的代码将受制于 IIS 对应用程序池的回收。

您最好的选择是拥有另一个进程来监听通知，并在该进程中维护您的缓存。然后，您可以使用共享内存（请参阅[Boost.Interprocess](http://www.boost.org/doc/libs/1_37_0/doc/html/interprocess.html)）从您的 Web 服务访问该缓存。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T11:44:07.307

我不了解 C++，但在我的 C# ASP.NET 应用程序中，我正在创建线程并且它工作正常。.NET 是“真正的”线程吗？我不知道......但他们的行为就像你想要一个线程来表现一样。也许你可以让你的应用程序的那部分是 ASP.NET C#？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T12:52:38.073

*没有为我们编写另一个流程来倾听我们，我不知道我还能做什么。*

除了使用额外的线程之外，还有许多其他解决方案。例如，轮询 + 非阻塞 IO 将是一种选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T13:39:46.230

创建一个线程可能不是问题——这可能是您在该线程中所做的事情。我将查看共享对象的代码，这些对象也被 IIS 创建的线程使用。

# delphi - 在 Delphi 2009 的 dfm 中添加的 DoubleBuffered 属性在 Delphi 2007 中不存在

> ID：271843
> 
> 赞同：6
> 
> 时间：2008-11-07T11:45:26.070
> 
> 标签：delphi, delphi-2009, delphi-2007

这是否意味着我不能在 delphi 2007 和 2009 之间共享表单？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-08T20:32:21.967

DoubleBuffered 在 TWinControl 中已有一段时间了。Delphi 2009 的不同之处在于它是现在发布的。如果您只能忽略错误（而不是使属性工作），那么这是一个可能的解决方案：

```
unit Delphi2009Form;

interface

uses
  Windows, Classes, SysUtils, Controls, Forms;

type
{$IFDEF VER200}
  TDelphi2009Form = class(TForm);
{$ELSE}
  TDelphi2009Form = class(TForm)
  private
    procedure ReaderError(Reader: TReader; const Message: string; var Handled: Boolean);
  protected
    procedure ReadState(Reader: TReader); override;
  end;

  TReaderErrorProc = procedure(const Message: string);

var
  ReaderErrorProc: TReaderErrorProc = nil;
{$ENDIF}

implementation

{$IFNDEF VER200}
type
  THackReader = class(TReader);

procedure TDelphi2009Form.ReaderError(Reader: TReader; const Message: string; var Handled: Boolean);
begin
  with THackReader(Reader) do
    Handled := AnsiSameText(PropName, 'DoubleBuffered') or AnsiSameText(PropName, 'ParentDoubleBuffered');
  if Handled and Assigned(ReaderErrorProc) then
    ReaderErrorProc(Message);
end;

procedure TDelphi2009Form.ReadState(Reader: TReader);
begin
  Reader.OnError := ReaderError;
  inherited ReadState(Reader);
end;
{$ENDIF}

end. 
```

然后将项目中的表单声明更改为从 TDelphi2009Form 继承，例如：

```
type
  TFormMain = class(TDelphi2009Form)
  ... 
```

这将在运行时起作用 - 属性错误将被忽略。为了让它在设计时也能工作，创建一个仅设计包，将 designide.dcp 添加到它的 requires 子句中，并添加以下单元：

```
unit Delphi2009FormReg;

interface

uses
  Delphi2009Form;

procedure Register;

implementation

uses
  DesignIntf, DesignEditors, ToolsAPI;

procedure ShowReaderError(const Message: string);
begin
  with BorlandIDEServices as IOTAMessageServices do
    AddTitleMessage(Message);
end;

procedure Register;
begin
  RegisterCustomModule(TDelphi2009Form, TCustomModule);
  ReaderErrorProc := ShowReaderError;
end;

initialization

finalization
  ReaderErrorProc := nil;

end. 
```

在 Delphi 2007 IDE 中安装包，在 IDE 中打开表单时，DoubleBuffered 和 ParentDoubleBuffered 属性的属性错误将被自动忽略。当您在 Delphi 2007 中保存表单时，属性的值将丢失，因此您应该在代码中初始化它们。

**编辑**：我添加了代码以将阅读器错误消息输出到 IDE 消息窗口：

![IDE 错误消息](https://lh5.ggpht.com/_3WiBCMA-GcU/SRghHnKCIGI/AAAAAAAAAYk/kliBO4joSbo/messages.png)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-07T12:26:48.093

是的。除非您从 DFM 中删除未在 Delphi 2007 中发布的属性，否则这是不可能的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-07T13:06:02.460

Delphi 项目一直非常容易移植到新版本。您必须更加小心，但是将当前代码与旧编译器一起使用也非常简单。我在 Delphi 2005/2006/2007 中维护了其他人仍然需要在 Delphi 6 和 7 中使用的代码。

如果您从 DFM 中删除不兼容的属性，它们应该可以在旧版本中正常工作，而不会在 Delphi 2009 中弄乱它们。最大的例子是 Delphi 2006 中引入的显式*属性。我有一个自制的“DFM 洗涤器”，可以去除这些出去。请记住，这些属性的存在是有原因的，因此您应该只清理那些打算向后兼容的属性。

您还可以考虑投资静态代码分析工具，例如 CodeHealer 或 Pascal Analyzer。除了指出问题（尤其是 CodeHealer）并帮助您清理代码之外，您还可以选择要分析的 Delphi 版本，从而更容易找到除 DFM 属性之外的不兼容性。它们可以作为构建过程的一部分自动化。

只是一个注释。共享源代码，但为每个版本保留单独的项目。这在 Delphi 2007 和 Delphi 2009 之间尤其重要。较新的 .dproj 文件使用相同的扩展名，但与 Delphi 2007 不兼容。您也可能遇到资源不兼容的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T12:33:42.917

每个表单都有一个 dfm 文件，其中包含表单及其组件的属性设置。某些属性值具有默认值，因此如果保留默认值，则不会存储它们。只是做了一个小测试：

*   2009年创建表格
*   添加几个标准控件
*   保存
*   在 2006 年打开它（对不起，这台电脑上没有 2007 年）

它在没有消息的情况下工作。但也许你没那么幸运。

使用 Delphi，在版本之间共享数据通常有点麻烦。升级的可能性很大，但降级很麻烦。所以我建议不要在不同版本之间共享表单文件。

据我所知，不可能在 dfm 文件中添加条件定义。但是话又说回来，我们真的想要那个……我更喜欢一种忽略未知属性的机制。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-07T13:49:33.077

您可以安全地在表单的 OnCreate 方法中的代码中添加属性，并在它们周围包裹一个 {$IFDEF VER200} // NEW PROPERTIES {$ENDIF}。您可以将 DoubleBuffered 留在 ifdefs 之外，就像在 Delphi 2007 中一样，只是对属性检查器不可用。

您只需要担心您设置的与默认值不同的属性。对于双缓冲，如果设置为 true，您只需要担心这一点。

在 Delphi 2007 中加载 Delphi 2009 表单时，您将收到一个警告，指出某个属性将被破坏，只需记下这些属性，因为这些是您需要处理的属性。

我正在使用这种方法将我的代码从 Delphi 2006 迁移到 Delphi 2009。我的大多数项目都包含几个共享单元，并且必须在 Delphi 2006 中编译发布版本，在 Delphi 2009 中编译“下一个”版本。我还大量使用 {$IFDEF UNICODE} 定义我需要确保字符串是宽字符串或 ansistring，具体取决于例程。

# c++ - MFC：更改列表控件的字体

> ID：271845
> 
> 赞同：2
> 
> 时间：2008-11-07T11:47:08.360
> 
> 标签：c++, visual-c++, mfc, messages

我需要在运行时更改列表控件的字体，以便使用固定宽度的字体。我已经看到了一些建议我应该捕获 NM_CUSTOMDRAW 消息的示例，但我想知道是否有更好的方法来做到这一点。

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T12:41:28.173

创建一个适当的 CFont 对象，并通过调用 SetFont() 设置控件的字体，传入 CFont，如下所示：

```
m_font.CreatePointFont(90,"Courier New");
m_listCtrl.SetFont(&m_font); 
```

这假设您有一个带有“CFont m_font”成员的窗口或对话框对象，以及附加到列表控件的“m_listCtrl”成员。

# delphi - 如何使用 fastMM 追踪棘手的内存泄漏？

> ID：271850
> 
> 赞同：7
> 
> 时间：2008-11-07T11:52:01.737
> 
> 标签：delphi, memory-leaks, delphi-2009, fastmm

将项目从 Delphi 2007 升级到 Delphi 2009 后，我遇到了未知的内存泄漏，到目前为止，我一直在尝试使用 fastMM 对其进行跟踪，以下是 fastMM 堆栈跟踪报告的内容：

```
A memory block has been leaked. The size is: 20

This block was allocated by thread 0x111C, and the stack trace (return addresses) 
  at the time was:
40339E [System.pas][System][@GetMem][3412] 534873 [crtl][_malloc]
56D1C4 [canex.cpp][MidasLib][DllGetDataSnapClassObject][3918]
56D316 [canex.cpp][MidasLib][DllGetDataSnapClassObject][3961]
56D5EE [canex.cpp][MidasLib][DllGetDataSnapClassObject][4085]
562D48 [DBCommon.pas][DBCommon][TFilterExpr.PutExprNode][1583]
408E46 [System.pas][System][DynArraySetLength][20464]
56D5EE [canex.cpp][MidasLib][DllGetDataSnapClassObject][4085]
408E92 [System.pas][System][@DynArraySetLength][20486]
528C1B [Forms.pas][Forms][TCustomForm.DoCreate][3260]
171A1A [GetRawStackTrace]

The block is currently used for an object of class: Unknown

The allocation number is: 302844 
```

有时我会得到这个：

```
A memory block has been leaked. The size is: 20

This block was allocated by thread 0x111C, and the stack trace (return addresses) 
  at the time was:
40339E [System.pas][System][@GetMem][3412]
534873 [crtl][_malloc]
56D1C4 [canex.cpp][MidasLib][DllGetDataSnapClassObject][3918]
56D316 [canex.cpp][MidasLib][DllGetDataSnapClassObject][3961]
77DC921A [RtlAnsiStringToUnicodeString]
56D5EE [canex.cpp][MidasLib][DllGetDataSnapClassObject][4085]
7726B8F5 [GetProcAddress]
7726B907 [GetProcAddress]
589B1E [ossrv.cpp][MidasLib][DllGetDataSnapClassObject][3163]
56D5EE [canex.cpp][MidasLib][DllGetDataSnapClassObject][4085]
408E92 [System.pas][System][@DynArraySetLength][20486]

The block is currently used for an object of class: Unknown 
```

有没有更好的方法来找出真正导致内存泄漏的原因？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-03T12:01:42.153

此内存泄漏是由 Delphi 错误引起的，QC [#67709](http://qc.embarcadero.com/wc/qcmain.aspx?d=67709)

上次 Delphi 2009 更新修复了它，难怪我无法修复它。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-07T18:01:49.383

只要泄漏的内存块的大小不会随着您的程序使用的时间越长/越多而增长，那么它就不是问题。如果您有长期存在的对象，这些对象仅在您终止应用程序时才被释放，这与您泄露它们一样 - 所有内存在终止时被回收（当然，除非它们处理内存之外的资源）。

您要关注的内存泄漏是随着时间或使用而累积的内存泄漏。如果每次都是 20 个字节，那么不要担心。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T15:12:13.050

我不知道 D2009 VCL 中是否有任何泄漏，因此假设您的代码中有泄漏，首先我会检查以下内容：

*   是否有任何以该表单创建的数组或列表（因为`@DynArraySetLength`）在您处理表单时未释放。
*   是否有任何函数可以创建并返回一些应该由外部调用者释放的对象，如果你有这种函数，请检查调用者是否释放了该对象。
*   如果这没有显示泄漏，那么您应该检查您在表单代码中创建的每个对象是否在您销毁表单时被销毁。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T03:53:58.593

上次我在这些方面遇到令人费解的泄漏时，我查看了违规对象的原始内存 - 并看到了向我显示它是哪种数据的文本。当它说它不知道它是什么类型的对象时，这可能意味着它首先不是一个对象——所以看看动态分配的东西，包括字符串。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T12:54:24.030

IIRC VCL 有一些像这样的非常小的泄漏，您可以忽略而不必担心。这可能是其中之一！？希望有人澄清这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T19:08:34.117

我会说您的 Form OnCreate 事件处理程序中发生了一些事情，该处理程序正在增长 DynArray。
并且最后没有发布 DynArray。
但是，如果没有看到代码并使用 FastMM 实际调试它，几乎不可能猜测到底发生了什么。

# clickonce - clickonce 在哪里获取 cd 文件

> ID：271852
> 
> 赞同：1
> 
> 时间：2008-11-07T11:55:07.347
> 
> 标签：clickonce

我创建了一个 clickonce 部署并将其发布到网站。我想将安装程序（1.0.0 版）放在一张 CD 上，以便分发给客户。在已发布文件夹的路径中创建了一个 setup.exe，但这非常小，不可能是 cd 所需的全部内容。

我把这个传给了一个单独运行 setup.exe 文件的联合开发人员，它告诉他所需的文件丢失了。我应该将哪些文件放在 cd 上，是否有特定的位置？

在通过发布向导时，我选择了此安装程序将进入 cd 的选项。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T12:03:58.267

我认为您需要该文件夹中的所有文件，而不仅仅是 setup.exe 文件。

> 应用程序文件
> autorun.inf
> install.html
> YourApp.application
> setup.exe

在 Application Files 文件夹中，我相信您可以省略旧版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T12:05:51.600

在文件夹中，我看到了 setup.exe 和 myappname.application。还有另外两个文件夹，一个叫做应用程序文件。另一个称为 windowsinstaller3_1。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T19:56:41.283

仅供参考，setup.exe 是先决条件，而不是应用程序。.application 文件是用于安装应用程序的部署清单。它会依次为您设置的任何先决条件调用 setup.exe。

# python - 如何扫描网页并获取图像和 youtube 嵌入？

> ID：271855
> 
> 赞同：2
> 
> 时间：2008-11-07T11:55:41.370
> 
> 标签：python, web-applications, screen-scraping

我正在构建一个网络应用程序，我需要在其中获取所有图像和任何嵌入在给定 URL 上的 Flash 视频（例如 youtube）。我正在使用 Python。

我用谷歌搜索过，但没有找到任何关于这个的好信息（可能是因为我不知道这被称为搜索什么），有没有人有这方面的经验并且知道如何做到这一点？

如果有可用的代码示例，我很乐意看到一些代码示例。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T11:58:27.263

[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)是一个很棒的屏幕抓取库。使用 urllib2 获取页面，并使用 BeautifulSoup 将其解析。这是他们文档中的代码示例：

```
import urllib2
from BeautifulSoup import BeautifulSoup

page = urllib2.urlopen("http://www.icc-ccs.org/prc/piracyreport.php")
soup = BeautifulSoup(page)
for incident in soup('td', width="90%"):
    where, linebreak, what = incident.contents[:3]
    print where.strip()
    print what.strip()
    print 
```

# .net - 在 .NET 桌面和浏览器之间共享 JavaScript 代码

> ID：271856
> 
> 赞同：4
> 
> 时间：2008-11-07T11:55:53.320
> 
> 标签：.net, javascript, script#, jscript.net, managed-jscript

我有一组核心、复杂的 JavaScript 数据结构/类，我希望它们能够在浏览器中作为 JavaScript 使用，并在带有 .NET 3.5 的桌面上运行。是否可以将 Web 友好的 JavaScript 编译成我的 C# 代码可以访问的程序集？

*   托管 JScript - 是否有可用的编译器来生成可以在桌面 CLR 上运行的东西？我只看到了 Silverlight 运行时的已发布示例。听起来它不像在桌面上正式可用，但我愿意尝试一些不那么幸运的东西，比如我可以用 Silverlight 工具编译然后在桌面 CLR 上运行吗？
*   JScript .NET - 听起来它有足够的自定义语言扩展，在浏览器中运行相同的代码真的很难，但也许有办法......？

如果这些都不起作用，我想我的选择是：

*   有一个 C# 版本和一个 JavaScript 版本，我必须保持同步（糟糕）。
*   编写一个在编译时运行的预处理器，将我的 JavaScript 转换为 JScript .NET 或我可以编译为 .NET 程序集的东西。
*   Script#：看起来这会将 C# 代码转换为 JavaScript 代码。不太好，因为我希望能够直接大量调整 JavaScript 代码，但它可以工作。

任何人都成功地使用了这些选项？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T15:14:02.437

JScript.Net 实际上大部分都符合 EMCAScript3。只要您将代码视为处理库（仅让它进行处理等 - 使用回调与程序交互），您应该没问题。我正在做类似的事情，使用 javascript 作为我的核心解析库，然后在 python、dotnet 和 php 中使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-01T22:53:16.037

托管 JavaScript (IronJScript) 似乎已被杀死。看到[这个答案](https://stackoverflow.com/questions/775339/where-can-you-download-managed-jscript-for-the-dlr/886173#886173)：

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T12:19:49.357

另一种选择如何：

*   通过 winforms 的 WebBrowser 控件在桌面应用程序中托管 javascript 应用程序？

这可能吗？

您还可以从 WebBrowser 控件访问 DOM，但并非完全支持您想要的所有内容。

# java - 如何测试 Web 应用程序？

> ID：271861
> 
> 赞同：8
> 
> 时间：2008-11-07T11:59:05.793
> 
> 标签：java, servlets, automated-tests, web-applications

如果我有 java-webapp (servlets)，为这个应用程序创建自动化测试的最佳方法是什么？

我应该启动服务器吗？但这是非常脆弱的。我应该直接调用servlet吗？但这怎么能做到呢？我不知道如何创建 ServletResponse/ServletRequest。

测试 webapp 功能的最佳方法是什么？我应该检查生成的 HTML 文本吗？但是，如果我更改模板（错字），测试就会被破坏。

您在测试 Web 应用方面有哪些最佳实践和经验？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T12:06:23.940

看看[硒](http://selenium.openqa.org/)。这是一个非常好的工具，至少应该为您指出集成测试的正确方向。除此之外，使用 JUnit 对您的 servlet 和其他支持类进行单元测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T13:07:03.397

看看[Selenium](http://selenium.openqa.org/)用于 webapp 测试，[Abbott](http://abbot.sourceforge.net/doc/overview.shtml)用于 java 小程序测试。我们已经设法将两者混合在一起，以便 Selenium 通过 javascript 调用 Abbott 测试。它们都是允许您在查看页面时记录操作，然后自动生成测试代码的工具。记录基本测试后，您可以对其进行修改和调整。您可以用最少的努力获得漂亮的测试。他们会以你的名字命名一种饮料。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T12:04:33.880

同样的问题。在我的 TODO 列表中，我有[jetty](http://www.mortbay.org/jetty/)和[httpunit](http://httpunit.sourceforge.net/)。

此外，如果您使用某种框架（Spring、Struts 等），您通常可以单独测试各个部分，而无需部署整个内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T04:44:41.690

我几乎只使用[htmlunit](http://htmlunit.sourceforge.net/ "htmlunit")并且没有任何抱怨。一旦我们建立了一套不错的测试工具方法，测试甚至是复杂的 Web 应用程序都非常容易。它也适用于 javascript。我们甚至在 AJAX 应用程序中使用它也没有问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-15T21:35:53.547

我整天测试 Web 应用程序，我使用[Watir](http://wtr.rubyforge.org/)。

# mysql - 在本地连接到 MySQL 的最佳方式？

> ID：271864
> 
> 赞同：9
> 
> 时间：2008-11-07T12:02:43.027
> 
> 标签：mysql, windows

MySQL 提供了多种连接方式（在 Windows 上），它们是：

*   共享内存
*   命名管道
*   TCP/IP

我的问题是，如果 MySQL 将在 Web 服务器的同一台机器上运行，那么哪种方法最适合安全性和性能？

PS 这是一个单一的网络服务器方案，没有网络农场。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T12:12:34.567

就性能而言，如果两者都在同一台机器上运行，那么共享内存是更好的选择，因为它不会遇到可能在机器上或以后安装的防火墙软件的问题。

但是，如果将来由于扩容而需要分离 Web 服务器和数据库，则需要进行更改以支持这一点。

因此，从长远来看，更好的选择是使用 TCP/IP，因为这将允许以最小的痛苦来分隔服务器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-12-18T16:22:13.770

所有情况下的 TCP/IP

我也会这么说，它是唯一在开发中经过彻底测试的配置。还

1) 命名管道不能保证安全。可以通过 \ServerName\pipe\PipeName 访问它们（即使 C 客户端不会，Connector/NET 也可以做到这一点）。

2) 共享内存有几个缺点。例如，不可能知道共享内存客户端是否已经死亡。也就是说，如果应用程序在没有断开连接的情况下退出，则服务器端的资源不会被清理（对于 n wait_timeout 时间段，默认为 8 小时）。此外，在使用共享内存时存在过多的同步。

3) 本地主机 TCP 访问非常快，至少在现代 Windows 上是这样，尽管我相信直到 Vista/WS2008 才出现这种情况。我将它与管道进行了基准测试，没有显着差异。至于安全性，这就是防火墙的用途。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-02-09T18:33:36.567

共享内存比 tcp/ip 快 4 倍。使用 tcp/ip 将简单的行插入表中大约需要 200 微秒，使用共享内存需要大约 55 微秒（在我的 i5 3ghz 上）。使用 c/connector 测试。使用 net/connector 速度提升仅为 3 倍左右。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T00:29:00.420

For security reasons, it is clearly beneficial to disable TCP/IP-networking. I'm working on a .NET app, and I have had no problems connecting over a named pipe using the MySql connector. It works with the Mysql GUI tools as well :), and thats all I require.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T15:49:42.623

我会说命名管道，因为它确实提供了与 TCP/IP 相比的显着差异（通过导入的大型转储进行测试）。

但是您可能需要考虑 Web 服务器上的实际应用程序将如何使用这些连接中的任何一个来执行，因为例如驱动程序可能无法使用命名管道。

我在使用 php（在 Windows 上）和命名管道时遇到了问题，因此您还需要检查故事的那一部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T13:12:30.857

共享内存或命名管道比 TCP/IP 提供更少的开销，但是，Windows 甚至支持命名管道吗？

另一方面，TCP/IP 是最兼容和可扩展的方式，许多连接器甚至不支持任何其他 afaik。

如果不需要，您不应该将您的场景限制在“同一台机器”或平台“窗口”，考虑可扩展性总是好的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-12-26T04:18:43.380

为了获得更好的性能，我可以根据客户端和服务器的位置提示您一些示例：

**同一台机器**：共享内存，然后是命名管道，然后是 TCP/IP

**不同的机器**：TCP/IP

原因是当您在同一台机器上共享内存时，避免了通过操作系统中托管的网络堆栈的往返。共享内存是一种更有效的 IPC 方法。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-11-07T12:11:02.760

TCP/IP 在所有情况下。

# ms-access - 在 Access 中打开表单时启用控件

> ID：271870
> 
> 赞同：0
> 
> 时间：2008-11-07T12:05:17.297
> 
> 标签：ms-access, forms, combobox, recordset, access-control

我有一个表单，我想根据 ComboBox 控件中的值启用/禁用其控件。与表单中的所有其他控件一样，此 ComboBox 控件链接到表。在 ComboBox 的 Change 事件中，我放置了启用/禁用其他控件的代码。

我遇到的问题是，当我打开表单时，控件未启用/禁用。我必须重新选择 ComboBox 值以启用或禁用所有其他控件。

我注意到的一件事是 ComboBox 内的 RecordSet 控件通常不会更改为 ComboBox 的 value 属性中显示的值。

我尝试使用
`combobox.recordset.filter = "Key = " & combobox.value`
但出现错误
`Operation is not supported for this type of object.`

* * *

## 更新

我认为我的问题必须在如何访问combobox.recordset 中的值方面做得更多。我的印象是 combobox.recordset 保存了从表中收到的值。但是，它似乎拥有来自记录源的第一条记录。

我猜我需要通过使用另一个记录集对象来搜索我需要的那些值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T12:13:01.023

大多数访问控制事件不是由对控件的编程更改触发的。您可能希望调用代码以从表单的加载事件中启用控件。

您没有提及您正在使用的 Access 版本，但我不相信任何版本都具有组合框的 Recordset 属性。

您是否希望将组合框设置为特定值？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-08T03:18:41.600

在评论中，lamcro 观察了梳状框是否具有 Recordset 的问题：

> 当我进入表单 VB 代码并“添加观察”CB 控件时，记录集属性就在那里。我什至可以进入并查看它自己的属性。

我在设置监视列表时看到了它，但是组合框的记录集无法通过代码访问或更改。为了过滤组合框，您需要使用它的 Rowsource。

这可以通过以下两种方式之一来完成：

1.  使用事件为您的组合框动态分配新的行源，或者
2.  使用对要在其他组合框的 Rowsource 的 WHERE 子句中过滤其值的控件的引用。

假设您有 cmbComboBox1，当您在其中选择一个值时，您希望根据 cmbComboBox1 中选择的值过滤 cmbComboBox2 中列出的值。对于方法 1，您将使用第一个组合框的 AfterUpdate 来设置第二个组合框的行源：

```
 Private Sub cmbComboBox1_AfterUpdate()
    Dim strRowsource As String

    strRowsource  = "SELECT * FROM MyTable"
    If Not IsNull(Me!cmbComboBox1) Then
       strRowsource  = strRowsource & " WHERE MyField = " & Me!cmbComboBox1
    End If
    Me!cmbComboBox2.Rowsource = strRowsource
  End Sub 
```

要使用第二种方法，您需要将第二个组合框的 Rowsource 定义为基于测试第一个组合框的值：

```
SELECT * FROM MyTable 
WHERE (MyField=[Forms]![MyForm]![cmbComboBox1] 
        AND IsNull([Forms]![MyForm]![cmbComboBox1])=False) 
   OR IsNull([Forms]![MyForm]![cmbComboBox1])=True 
```

如果第一个组合框有值，则过滤行源，如果有值，*则不**过滤*它。也就是说，您将获得一个未经过滤的列表，直到为第一个组合框选择了一个值。

 *然后，在 cmbComboBox1 的 Afterupdate 事件中，您将重新查询第二个组合框：

```
 Private Sub cmbComboBox1_AfterUpdate()
    Me!cmbComboBox2.Requery
  End Sub 
```

定义一个参数可能也是一个好主意，以确保对表单控件的引用得到适当的解析，因此您的 Rowsource 将是这样的：

```
PARAMETERS [Forms]![MyForm]![cmbComboBox1] Long;
SELECT * FROM MyTable 
WHERE (MyField=[Forms]![MyForm]![cmbComboBox1] 
        AND IsNull([Forms]![MyForm]![cmbComboBox1])=False) 
   OR IsNull([Forms]![MyForm]![cmbComboBox1])=True 
```

（假设您正在过滤 Autonumber PK - 如果数据类型不同，您当然会使用不同的数据类型）

我倾向于使用动态 Rowsource 分配，仅仅是因为我发现它在不同的 Access 版本中问题较少（即，对表单控件的引用在所有版本的 Access 中的解析方式不同）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T12:09:29.423

在这里尝试做的一种方法是将 combobox.change() 放在 form.current() 方法中。

然后，一旦表单启动并运行，这将就像组合框已更改一样。

我以前做过类似的事情，但目前我面前没有代码。一旦我看到它，我会在这里更详细地发布它，但我相信这是我做的方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T17:43:57.423

'在表单属性上检查您的密钥预览

'在这里调试combobox.value (Ctrl+G 调试窗口)

调试.打印组合框.值

me.filter = "Key = " & combobox.value

'潜在的 me.reload 或 me.refresh 取决于 ms 访问版本

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T13:48:14.140

你能解释一下你有什么类型的组合框以及你想做什么吗？例如，您是否有一个未绑定的组合框，用于查找表单的记录，或者您是否有一个绑定的组合框，用于更新表中的字段？这是由 RowSource 和 ControlSource 属性控制的，Comboboxes 没有记录集属性。当您打开表单时，未绑定的组合框不会有值，当您从一个记录移动到另一个记录时，该值也不会改变，但是使用当前事件分配一个值很容易。

编辑我仍然不清楚你想做什么。根据您的评论，在选择选项时修改控件时是否遇到问题，或者在打开表单时设置组合值时遇到问题？您是否想更改组合的 RowSource，也许正如您的原始帖子所暗示的那样？

# java - JEdi torPane 的自动缩放

> ID：271881
> 
> 赞同：0
> 
> 时间：2008-11-07T12:10:51.310
> 
> 标签：java, text-editor, jeditorpane

我使用 JEditorPane 作为编辑器在我的应用程序中编写注释。内容类型设置为“text/plain”。当我在其中写入文本并且文本填充了可用空间并且我继续输入时，文本不会向上移动以显示光标。所以我不知道我在哪里输入以及我在输入什么，因为它是可见的。

您能告诉我如何通过向上移动上述文本来始终显示插入符号吗？

相反，如果我可以在输入时自动调整编辑器的大小可能会更好。JEdi​​torPane 在 JPanel 内，所以我也必须调整它的大小。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T14:14:26.567

您需要将编辑器放在 JScrollPane 中。ScrollPane 将自动添加滚动条并消除调整编辑器大小的需要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-29T21:36:38.010

编辑添加完整的解决方案

您必须先添加一个 JScrollPane。然后，如果您不希望滚动条可见，但希望文本区域自动滚动，请设置

```
scrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
scrollPane.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_NEVER); 
```

在滚动窗格上。这将隐藏滚动条，但为您提供自动滚动。

以下是您如何使用滚动窗格实现自动滚动，并自动调整大小到给定的最大值。

```
import java.awt.BorderLayout;
import java.awt.Dimension;

import javax.swing.JEditorPane;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.ScrollPaneConstants;
import javax.swing.event.CaretEvent;
import javax.swing.event.CaretListener;

public class SPTest extends JFrame {

    private static final long serialVersionUID = 1L;

    private JEditorPane editor;
    private JScrollPane scrollPane;
    private JPanel topPanel;
    private JLabel labelTop;

    public SPTest() {
        super("Editor test");
        initComponents();
        setDefaultCloseOperation(EXIT_ON_CLOSE);
        setVisible(true);
    }

    private void initComponents() {
        editor = new JEditorPane("text/plain", null);
        scrollPane = new JScrollPane(editor);
        topPanel = new JPanel();
        labelTop = new JLabel("main contents here");
        topPanel.add(labelTop);

        setSize(600, 400);
        editor.setMinimumSize(new Dimension(100, 30));
        editor.setPreferredSize(new Dimension(100, 60));
        scrollPane.setPreferredSize(new Dimension(600, 60));
        scrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        scrollPane.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_NEVER);
        scrollPane.setMinimumSize(new Dimension(100, 30));

        final int MAX_HEIGHT_RSZ = 120;
        editor.addCaretListener(new CaretListener() {

            public void caretUpdate(CaretEvent e) {
                int height = Math.min(editor.getPreferredSize().height, MAX_HEIGHT_RSZ);
                Dimension preferredSize = scrollPane.getPreferredSize();
                preferredSize.height = height;
                scrollPane.setPreferredSize(preferredSize);
                SPTest.this.validate();
            }
        });

        setLayout(new BorderLayout());
        add(topPanel, BorderLayout.NORTH);
        add(scrollPane, BorderLayout.SOUTH);
    }

    public static void main(String[] args) {
        new SPTest();
    }

} 
```

您可以调整大小 您可以使用此 JScrollPane 而不是 JPanel 作为编辑器的容器。

# java - 处理数据库中的空字符串的最佳实践（Java 中）

> ID：271888
> 
> 赞同：5
> 
> 时间：2008-11-07T12:13:47.513
> 
> 标签：java, database, swing

在我的数据库应用程序中，有时我必须处理`null`数据库中的字符串。在大多数情况下，这很好，但是当以表单形式显示数据时，Swing 组件（`JTextField`例如使用）无法处理空字符串。（`.setText(null)`失败）

（**编辑：**我刚刚注意到它`JTextField`实际上接受了一个字符串，但是对于所有其他意外值可能导致问题`null`的情况，问题仍然存在。）`null`

null 值没有特殊含义，它们可以（必须）被视为空字符串。

处理这个问题的最佳实践是什么？*不幸的是，我无法更改数据库*。

*   检查每个值是否`null`在调用之前`setText()`？
*   `setText()`为每个调用添加一个 try-catch 处理程序？
*   引入过滤所有`null`字符串的静态方法？
*   `null`从数据库读取后立即将所有值替换为空字符串？
*   ... [你的建议]

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T12:18:05.570

如果您使用任何 ORM 工具或以某种方式将 DB 字段映射到 Java bean，您总是可以拥有：

```
公共无效setFoo（字符串str）{
  this.foo = str != null ？字符串：“”；
}

```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T12:28:12.850

从 SQL 角度尝试：

```
select ISNULL(column_name,'') from ... 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T18:02:56.153

使用 Beans Binding API 将值从您的实体对象绑定到您的 SWING 小部件。Beanins Binding 将透明地处理 null 值，并且不会用空字符串替换 null。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-08T02:34:07.680

我认为你所有的答案都是合理的，但是由于你标记了这个“最佳实践”，我想提醒你空对象设计模式。只要看起来值得努力，对于需要保护的任何类，为该类的“空”对象编写特殊的实例化代码。这个想法是这个“空”对象是真实的，并且无论你要求它做什么都可以适当地表现。您的空“字符串”对象可以提供您想要的任何值。

这种模式还意味着您可以摆脱大量的空检查，并且代码更加健壮。它确实会消耗一些 CPU 来向空值发送消息并且让它们什么都不做，因此当大部分对象预期为空值时，它是不太可取的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T12:16:50.970

如果可以，请为 DB 中的字段添加默认值 - 空字符串。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T12:32:10.580

您可以扩展或包装 JTextField 并覆盖 setText() 方法以将 NULL 替换为空字符串。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T12:47:05.760

正如鲁本所说，我将扩展 JTextField 以覆盖 setText() 方法并将 NULL 替换为空字符串。

但是，我还将覆盖 getText() 方法以用 NULL 覆盖空字符串，这样当您保存回数据库时，您不会用空字符串覆盖其中的空值。

# javascript - 有没有什么快速获取 从一个 by value, using JavaScript? I have a <select>. Using JavaScript, I need to get a specific <option> from the list of options, and all I know is the value of the option. The option may or may not be selected. Here'

> ID：271892
> 
> 赞同：4
> 
> 时间：2008-11-07T12:16:26.150
> 
> 标签：javascript, html

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T12:22:17.137

我会这样做：

```
// first, build a reverse lookup
var optCount      = mySelect.options.length;
var reverseLookup = {};
for (var i = 0; i < optCount; i++)
{
  var option = mySelect.options[i];
  if (!reverseLookup[option.value])
  {
    // use an array to account for multiple options with the same value
    reverseLookup[option.value] = [];
  }
  // store a reference to the DOM element
  reverseLookup[option.value].push(option);
}

// then, use it to find the option
var foundOptions = reverseLookup["Value that you are looking for"];
if (foundOptions && foundOptions.length)
{
  alert(foundOptions[0].id);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T12:21:50.943

我建议您不要选择数千个选项。

也许您可以以不同的方式构建您的数据，在我看来，包含数千个条目的选择似乎是错误的。

也许您的应用程序需要这个，但它不是这个元素的典型用法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T20:02:24.477

这是 Tomalak 对速度进行微调的答案。您会看到向下迭代的 while 循环比向上迭代的 for 循环更快。（我很懒，所以我不会提供链接。）

```
var i = mySelect.options.length - 1;
var reverseLookup = {};
while ( i >= 0 )
{
  var option = mySelect.options[i];
  if (!reverseLookup[option.value])
  {
    // use an array to account for multiple options with the same value
    reverseLookup[option.value] = [];
  }
  // store a reference to the DOM element
  reverseLookup[option.value].push(option);
  i--;
}

// then, use it to find the option
var foundOptions = reverseLookup["Value that you are looking for"];
if (foundOptions && foundOptions.length)
{
  alert(foundOptions[0].id);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T12:20:34.940

不，没有，你正在以最好的方式做到这一点。您可以尝试更快查找的唯一另一件事是为每个选项提供一个 ID 标记，以便您可以将它们作为 DOM 对象查找，而不是遍历 DOM 对象的子对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T12:20:55.157

您可以遍历所有选项一次并将所有项目放入关联数组中。然后你就可以找了`myOptions[valueImLookingFor]`。

我没有对此进行测试，不能保证它会更快/更好。但它应该摆脱所有这些循环。

根据您的设置和需要，您还可以在客户端生成一个 javascript 数组并将其放入标记中，而不是（或附加于）选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T12:21:51.817

我的建议是查看像[Dojo 这样的框架/工具包及其选择 DOM 节点的方式](http://dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/selecting-dom-nodes-dojo-query)。

该工具包解决了许多浏览器的不一致问题，并允许您快速轻松地选择和操作 DOM 节点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T12:23:24.030

我认为这可能表明选择中的“数千”个项目可能不是最好的用户体验。也许您应该考虑尝试将您的下拉列表限制为几个在用户选择它们时缩小结果的范围。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-07T12:20:25.847

使用 jQuery，这样的事情可能会更快：

```
$("#idselect option[value='yourval']") 
```

[http://docs.jquery.com/Selectors/attributeEquals#attributevalue](http://docs.jquery.com/Selectors/attributeEquals#attributevalue)

# paypal - 集成 PayPal 结账

> ID：271899
> 
> 赞同：10
> 
> 时间：2008-11-07T12:19:09.437
> 
> 标签：paypal, payment, shop

我有一个以通常方式集成 PayPal 的商店系统，即用户被重定向到 paypal.com 以登录并确认付款，之后用户被引导回到我的商店系统中的确认页面。

现在我的客户在询问整个过程是否可以在商店内部运行。

我对此有两三个想法（并不是说它真的很重要，但该网站是基于 PHP 的）：

1.  使用 cURL 函数服务器端与 paypal 对话，在商店页面内显示所有必需的表格。可能不是一个好主意。

2.  使用 an`<iframe>`来按原样显示贝宝页面。最重要的是，这应该可以正常工作，但不会那么漂亮。

3.  使用某种 PayPal API。我只看到了一些似乎需要使用 PayPal 的 Pro 帐户（对于卖家）并且仅适用于信用卡付款的东西。

我不是 PayPal 集成方面的专家，当前的解决方案随商店软件一起提供。如果你们中的任何人能够阐明优点、缺点和不可能的情况，我将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-07T12:40:04.307

这是几个月前的事情，所以可能已经改变了，但据我所知，Paypals API 不允许您将 Paypal 界面完全集成到商店中。这是因为一旦您离开贝宝服务器，他们就会失去控制，并可能对 API 的滥用负责。

据我所记得，使用 Paypal 进行付款确实需要用户登录到他们的 paypal 帐户，因此 Paypal 不希望它受除他们自己的任何其他网站的控制。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-07T15:57:24.097

Paypal 提供[直接付款](https://www.paypal.com/IntegrationCenter/ic_direct-payment.html)作为其 API 的一部分。这使您无需访问 PayPal 网站即可处理付款。[如文档中所述，如果您使用Direct Payment](https://www.paypal.com/IntegrationCenter/ic_direct-payment.html)，您还必须提供[Express Checkout](https://www.paypal.com/IntegrationCenter/ic_expresscheckout.html)（重定向到 Paypal）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T12:47:14.840

供应商很少这样做，但您可以自定义 PayPal 页面的外观，使它们有点与您的网站相匹配。我很高兴他们很少这样做，因为自定义页面通常类似于对接。MySpace 式的体验并没有让我对财务充满信心。

我认为拥有 PayPal 帐户的人非常习惯于使用 PayPal 支付费用，如果 PayPal 的东西出现在您的商店中，他们实际上可能*不会信任您的网站。*如果您只是想通过客户来吸引信用卡，请使用其他服务。

# c# - 你能检测到 C# 字段是否被赋予了默认值吗？

> ID：271904
> 
> 赞同：7
> 
> 时间：2008-11-07T12:20:26.797
> 
> 标签：c#, reflection, default

假设您有一个类声明，例如：

```
 class MyClass
{
  int myInt=7;
  int myOtherInt;
} 
```

现在，在通用代码中是否有一种方法，使用反射（或任何其他方式，就此而言），我可以推断出 myInt 具有分配的默认值，而 myOtherInt 没有？请注意使用显式默认值初始化和留给它的隐式默认值之间的区别（默认情况下，myOtherInt 将初始化为 0）。

根据我自己的研究，似乎没有办法做到这一点 - 但我想在放弃之前我会在这里问一下。

[编辑]

即使对于可空类型和引用类型，我也想区分那些被保留为空的类型和那些已经显式初始化为空的类型。这样我就可以说带有初始化程序的字段是“可选的”，而其他字段是“强制性的”。目前我不得不使用属性来做到这一点——在这种情况下，这让我对它们的冗余信息感到厌烦。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-07T12:32:45.197

我编译了您的代码并将其加载到 ILDASM 中并得到了这个

```
.method public hidebysig specialname rtspecialname 
        instance void  .ctor() cil managed
{
    // Code size       15 (0xf)
    .maxstack  8
    IL_0000:  ldarg.0
    IL_0001:  ldc.i4.7
    IL_0002:  stfld      int32 dummyCSharp.MyClass::myInt
    IL_0007:  ldarg.0
    IL_0008:  call       instance void [mscorlib]System.Object::.ctor()
    IL_000d:  nop
    IL_000e:  ret
} // end of method MyClass::.ctor 
```

注意`ldc.i4.7`and`stfld int32 dummyCSharp.MyClass::myInt`似乎是为 myInt 字段设置默认值的说明。

**所以这样的赋值实际上被编译为构造函数中的附加赋值语句。**

要检测这种分配，那么您将需要反射以反映 MyClass 的构造函数方法的 IL 并查找`stfld`（设置字段？）命令。

* * *

编辑：如果我在构造函数中显式添加一些赋值：

```
class MyClass
{
    public int myInt = 7;
    public int myOtherInt;

    public MyClass()
    {
        myOtherInt = 8;
    }
} 
```

当我在 ILDASM 中加载它时，我得到了这个：

```
.method public hidebysig specialname rtspecialname 
                instance void  .ctor() cil managed
{
    // Code size       24 (0x18)
    .maxstack  8
    IL_0000:  ldarg.0
    IL_0001:  ldc.i4.7
    IL_0002:  stfld      int32 dummyCSharp.MyClass::myInt
    IL_0007:  ldarg.0
    IL_0008:  call       instance void [mscorlib]System.Object::.ctor()
    IL_000d:  nop
    IL_000e:  nop
    IL_000f:  ldarg.0
    IL_0010:  ldc.i4.8
    IL_0011:  stfld      int32 dummyCSharp.MyClass::myOtherInt
    IL_0016:  nop
    IL_0017:  ret
} // end of method MyClass::.ctor 
```

请注意，我添加的 myOtherInt 上的额外分配是*在*调用 Object 类的构造函数之后添加的。

```
IL_0008:  call       instance void [mscorlib]System.Object::.ctor() 
```

所以你有它，

**在 IL 中调用 Object 类的构造函数*之前*完成的任何赋值都是默认值赋值。**

它后面的任何内容都是类的实际构造函数代码中的语句。

不过应该进行更广泛的测试。

ps很有趣:-)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T12:25:58.453

您可能需要为此行为考虑一个可为空的 int ：

```
class MyClass
{
  int? myInt = 7;
  int? myOtherInt = null;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T12:31:29.270

默认值是与任何其他值一样的值。没有办法区分这两种情况：

```
int explicitly = 0;
int implicitly; 
```

在这两种情况下，您都将它们的值设为 0，一种方法只是节省您的打字时间。没有神奇的“默认未初始化值”——它们都是零。他们工作起来完全一样。然而，你甚至在考虑这个事实表明你已经严重偏离了好主意的轨道。你在做什么？您的具体需求是什么？你问错问题了；）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T12:43:51.383

对于使用可空类型作为可选参数的值类型应该可以工作。如果不是可选的，也可以将字符串初始化为空。

```
int mandatoryInt;
int? optionalInt; 
```

然而，这确实让我觉得有点脏，我会坚持使用属性作为这样做的明确方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T13:37:56.157

可能这不是最简单的解决方案......

您可以使用 de DefaultValue 属性来设置值，例如：

导入 System.ComponentModel 和 System.Reflection

```
private int myNumber = 3;
[System.ComponentModel.DefaultValue(3)]
public int MyNumber
{
    get
    {
        return myNumber;
    }
    set
    {
        myNumber = value;
    }
} 
```

然后用反射恢复默认值：

```
PropertyInfo prop = this.GetType().GetProperty("MyNumber");
MessageBox.Show(((DefaultValueAttribute)(prop.GetCustomAttributes(typeof(DefaultValueAttribute), true).GetValue(0))).Value.ToString()); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T15:25:14.897

制作一个包含值和初始化标志的通用结构怎么样？

```
public struct InitializationKnown<T> {
    private T m_value;
    private bool m_initialized;

    // the default constructor leaves m_initialized = false, m_value = default(T)
    // InitializationKnown() {}

    InitializationKnown(T value) : m_value(value), m_initialized(true) {}

    public bool initialized { 
        get { return m_initialized; }
    }
    public static operator T (InitializationKnown that) {
        return that.m_value;
    }
    // ... other operators including assignment go here
} 
```

然后只需使用它来代替您需要了解初始化的成员。它是懒惰的未来或承诺的一个非常基本的变体。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-07T15:52:40.380

如果我想将其构建为通用运行时功能，我会这样做。对于标量类型，我会创建一个默认值属性并使用它来确定默认性。

这是该任务的部分解决方案-我相信它可能会更好，但我只是将其淘汰：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Reflection;
using System.Linq;
using System.Data;

namespace FieldAttribute
{
    [global::System.AttributeUsage(AttributeTargets.All, Inherited = false, AllowMultiple = true)]
    sealed class DefaultValueAttribute : Attribute
    {
        public DefaultValueAttribute(int i)
        {
            IntVal = i;
        }

        public DefaultValueAttribute(bool b)
        {
            BoolVal = b;
        }

        public int IntVal { get; set; }
        public bool BoolVal { get; set; }

        private static FieldInfo[] GetAttributedFields(object o, string matchName)
        {
            Type t = o.GetType();
            FieldInfo[] fields = t.GetFields(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance);

            return fields.Where(fi => ((matchName != null && fi.Name == matchName) || matchName == null) &&
                            (fi.GetCustomAttributes(false).Where(attr => attr is DefaultValueAttribute)).Count() > 0).ToArray();
        }

        public static void SetDefaultFieldValues(object o)
        {
            FieldInfo[] fields = GetAttributedFields(o, null);
            foreach (FieldInfo fi in fields)
            {
                IEnumerable<object> attrs = fi.GetCustomAttributes(false).Where(attr => attr is DefaultValueAttribute);
                foreach (Attribute attr in attrs)
                {
                    DefaultValueAttribute def = attr as DefaultValueAttribute;
                    Type fieldType = fi.FieldType;
                    if (fieldType == typeof(Boolean))
                    {
                        fi.SetValue(o, def.BoolVal);
                    }
                    if (fieldType == typeof(Int32))
                    {
                        fi.SetValue(o, def.IntVal);
                    }
                }
            }
        }

        public static bool HasDefaultValue(object o, string fieldName)
        {
            FieldInfo[] fields = GetAttributedFields(o, null);
            foreach (FieldInfo fi in fields)
            {
                IEnumerable<object> attrs = fi.GetCustomAttributes(false).Where(attr => attr is DefaultValueAttribute);
                foreach (Attribute attr in attrs)
                {
                    DefaultValueAttribute def = attr as DefaultValueAttribute;
                    Type fieldType = fi.FieldType;
                    if (fieldType == typeof(Boolean))
                    {
                        return (Boolean)fi.GetValue(o) == def.BoolVal;
                    }
                    if (fieldType == typeof(Int32))
                    {
                        return (Int32)fi.GetValue(o) == def.IntVal;
                    }
                }
            }
            return false;
        }
    }

    class Program
    {
        [DefaultValue(3)]
        int foo;

        [DefaultValue(true)]
        bool b;

        public Program()
        {
            DefaultValueAttribute.SetDefaultFieldValues(this);
            Console.WriteLine(b + " " + foo);
            Console.WriteLine("b has default value? " + DefaultValueAttribute.HasDefaultValue(this, "b"));
            foo = 2;
            Console.WriteLine("foo has default value? " + DefaultValueAttribute.HasDefaultValue(this, "foo"));
        }

        static void Main(string[] args)
        {
            Program p = new Program();
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-07T13:07:30.603

此方法使用属性获取/设置过程：

```
 class myClass
    {
       #region Property: MyInt
       private int _myIntDefault = 7;
       private bool _myIntChanged = false;
       private int _myInt;
       private int MyInt
       {
          get
          {
             if (_myIntChanged)
             {
                return _myInt;
             }
             else
             {
                return _myIntDefault;
             }
          }
          set
          {
             _myInt = value;
             _myIntChanged = true;
          }
       }

       private bool MyIntIsDefault
       {
          get
          {
             if (_myIntChanged)
             {
                return (_myInt == _myIntDefault);
             }
             else
             {
                return true;
             }
          }
       }
       #endregion
    } 
```

这是一个领域的很多代码 - 你好片段！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-07T15:10:20.933

您可以将字段包装在私有/受保护的属性中。如果您想知道它是否已设置，请检查私有字段（例如_myInt.HasValue()）。

```
class MyClass
{

    public MyClass()
    {
        myInt = 7;
    }

    int? _myInt;
    protected int myInt
    {
        set { _myInt = value; }
        get { return _myInt ?? 0; }
    }

    int? _myOtherInt;
    protected int myOtherInt
    {
        set { _myOtherInt = value; }
        get { return _myOtherInt ?? 0; }
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-07T17:26:08.507

如果您想要的是这个，请查看底部的代码。
它是用 Oxygene[1] 编写的，希望这不是问题。

[1] 或 Delphi Prism 现在如何称呼它

```
 var inst1 := new Sample();
var inst2 := new Sample(X := 2);

var test1 := new DefaultValueInspector<Sample>(true);
var test2 := new DefaultValueInspector<Sample>(inst2, true);

var d := test1.DefaultValueByName["X"];

var inst1HasDefault := test1.HasDefaultValue(inst1, "X");
var inst2HasDefault := test1.HasDefaultValue(inst2, "X");

Console.WriteLine("Value: {0}; inst1HasDefault: {1}; inst2HasDefault {2}",
                  d, inst1HasDefault, inst2HasDefault);

d := test2.DefaultValueByName["X"];

inst1HasDefault := test2.HasDefaultValue(inst1, "X");
inst2HasDefault := test2.HasDefaultValue(inst2, "X");

Console.WriteLine("Value: {0}; inst1HasDefault: {1}; inst2HasDefault {2}",
                  d, inst1HasDefault, inst2HasDefault); 
```

输出：

```
值：1；inst1HasDefault：真；inst2HasDefault False
值：2；inst1HasDefault：假；inst2HasDefault True
```

```
 uses 
    System.Collections.Generic, 
    System.Reflection;

type
    DefaultValueInspector<T> = public class
    private
        method get_DefaultValueByName(memberName : String): Object;
        method get_DefaultValueByMember(memberInfo : MemberInfo) : Object;
   protected
        class method GetMemberErrorMessage(memberName : String) : String;
        method GetMember(memberName : String) : MemberInfo;

        property MembersByName : Dictionary<String, MemberInfo> 
            := new Dictionary<String, MemberInfo>(); readonly;

        property GettersByMember : Dictionary<MemberInfo, Converter<T, Object>> 
            := new Dictionary<MemberInfo, Converter<T, Object>>(); readonly;

        property DefaultValuesByMember : Dictionary<MemberInfo, Object> 
            := new Dictionary<MemberInfo, Object>(); readonly;
    public
        property UseHiddenMembers : Boolean; readonly;

        property DefaultValueByName[memberName : String] : Object
            read get_DefaultValueByName;
        property DefaultValueByMember[memberInfo : MemberInfo] : Object
            read get_DefaultValueByMember;

        method GetGetMethod(memberName : String) : Converter<T, Object>;
        method GetGetMethod(memberInfo : MemberInfo) : Converter<T, Object>;

        method HasDefaultValue(instance : T; memberName : String) : Boolean;
        method HasDefaultValue(instance : T; memberInfo : MemberInfo) : Boolean;

        constructor(useHiddenMembers : Boolean);
        constructor(defaultInstance : T; useHiddenMembers : Boolean);    
  end;

implementation

constructor DefaultValueInspector<T>(useHiddenMembers : Boolean);
begin
    var ctorInfo := typeOf(T).GetConstructor([]);
    constructor(ctorInfo.Invoke([]) as T, useHiddenMembers);
end;

constructor DefaultValueInspector<T>(defaultInstance : T; useHiddenMembers : Boolean);
begin
    var bf := iif(useHiddenMembers, 
                  BindingFlags.NonPublic)
              or BindingFlags.Public
              or BindingFlags.Instance;

    for mi in typeOf(T).GetMembers(bf) do
        case mi.MemberType of
            MemberTypes.Field :
            with matching fi := FieldInfo(mi) do
            begin
                MembersByName.Add(fi.Name, fi);
                GettersByMember.Add(mi, obj -> fi.GetValue(obj));
            end;
            MemberTypes.Property :
            with matching pi := PropertyInfo(mi) do
                if pi.GetIndexParameters().Length = 0 then
                begin
                   MembersByName.Add(pi.Name, pi);
                   GettersByMember.Add(mi, obj -> pi.GetValue(obj, nil));
                end;
        end;

    for g in GettersByMember do
        with val := g.Value(DefaultInstance) do
            if assigned(val) then 
                DefaultValuesByMember.Add(g.Key, val);
end;

class method DefaultValueInspector<T>.GetMemberErrorMessage(memberName : String) : String;
begin
    exit "The member '" + memberName + "' does not exist in type " + typeOf(T).FullName 
         + " or it has indexers."
end;

method DefaultValueInspector<T>.get_DefaultValueByName(memberName : String): Object;
begin
    var mi := GetMember(memberName);
    DefaultValuesByMember.TryGetValue(mi, out result);
end;

method DefaultValueInspector<T>.get_DefaultValueByMember(memberInfo : MemberInfo) : Object;
begin
    if not DefaultValuesByMember.TryGetValue(memberInfo, out result) then
        raise new ArgumentException(GetMemberErrorMessage(memberInfo.Name),
                                    "memberName"); 
end;

method DefaultValueInspector<T>.GetGetMethod(memberName : String) : Converter<T, Object>;
begin
    var mi := GetMember(memberName);
    exit GetGetMethod(mi);
end;

method DefaultValueInspector<T>.GetGetMethod(memberInfo : MemberInfo) : Converter<T, Object>;
begin
    if not GettersByMember.TryGetValue(memberInfo, out result) then
        raise new ArgumentException(GetMemberErrorMessage(memberInfo.Name),
                                    "memberName"); 
end;

method DefaultValueInspector<T>.GetMember(memberName : String) : MemberInfo;
begin
    if not MembersByName.TryGetValue(memberName, out result) then
        raise new ArgumentException(GetMemberErrorMessage(memberName),
                                    "memberName"); 
end;

method DefaultValueInspector<T>.HasDefaultValue(instance : T; memberName : String) : Boolean;
begin
    var getter := GetGetMethod(memberName);
    var instanceValue := getter(instance);
    exit Equals(DefaultValueByName[memberName], instanceValue);
end;

method DefaultValueInspector<T>.HasDefaultValue(instance : T; memberInfo : MemberInfo) : Boolean;
begin
    var getter := GetGetMethod(memberInfo);
    var instanceValue := getter(instance);
    exit Equals(DefaultValueByMember[memberInfo], instanceValue);
end; 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-11-07T12:31:33.343

如果您在为变量赋值之前尝试使用变量，则可以将编译器设置为生成警告。我有默认设置以及它的行为方式。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-11-07T12:36:19.917

以下是否有帮助：

```
bool isAssigned = (myOtherInt == default(int)); 
```

# c# - 如果将笔式驱动器插入 USB 端口，如何使用 c# 检测？

> ID：271907
> 
> 赞同：13
> 
> 时间：2008-11-07T12:21:24.923
> 
> 标签：c#, windows, usb, monitoring, usb-flash-drive

有没有办法找出局域网中何时有人将随身碟插入 USB 端口？以编程方式（最好在 C# 中）或通过某些工具。基本上我会想象一个客户端应用程序位于每个终端上并监视 USB 端口并将信息发送到服务器。

a.) 我可以获取正在复制的文件的详细信息吗？b.) 有没有办法在没有客户端应用程序的情况下做到这一点？

编辑

我不想完全禁用 USB 端口。它需要有依据。基本上只是希望 LAN 上的用户负责任地共享数据，并且知道传输的任何数据都会受到监控和记录，并且可以在以后受到质疑。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-07T13:02:43.483

[假设 Windows，给出 C# 注释。请相应地标记]

是的，这是可能的。并且可以获得文件的详细信息。不过，这将需要编程。注意[WM_DEVICECHANGE](http://msdn.microsoft.com/en-us/library/aa363480(VS.85).aspx)并在之后重新枚举驱动器。它将为您提供 USB pendrives，但也为您提供 SD 卡。我希望这对你来说是一个奖励。

要在知道驱动器已到达后获取更多详细信息，请使用[System.IO.FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)

**更新** 我找到了一个更好的解决方案 - 如果您注册卷接口通知，您将获得新驱动器的卷路径。首先，创建一个`DEV_BROADCAST_DEVICEINTERFACE`with `dbcc_classguid=GUID_DEVINTERFACE_VOLUME`。然后将此传递给`RegisterDeviceNotification()`. 您将再次获得 WM_DEVICECHANGE 但您现在可以将 lParam 从消息转换为`DEV_BROADCAST_DEVICEINTERFACE*`.

您可以将`dbcc_name`收到的传递给`GetVolumeNameForVolumeMountPoint()`. 您还可以将所有驱动器号从 传递`GetLogicalDriveStrings()`到`GetVolumeNameForVolumeMountPoint()`。您将拥有一个匹配的卷名；这是新的驱动器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T13:28:04.460

另请查看存储有关 USB 设备的所有信息的注册表。HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\USB

您可以挂钩注册表中该键的更改并据此采取行动。

这个免费的实用程序在四处寻找时有很大帮助：http: [//www.nirsoft.net/utils/usb_devices_view.html](http://www.nirsoft.net/utils/usb_devices_view.html)

您可以选择一个 USB 驱动器，选择打开该驱动器的注册表项并启用/禁用该设备等等。

在注册表中，您可以查看设备是否已连接、是否为大容量存储类型以及其他有趣的信息。它很容易过滤 regkeys 以获得 usb-massstorage 驱动器，然后连接并等待更改（连接/断开连接）。

使用 Windows Management Instrumentation，您可以注册以接收注册表事件：http: [//msdn.microsoft.com/en-us/library/aa393035 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa393035(VS.85).aspx)

查看 .Net 中的 System.Management

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T12:34:55.613

如果它是一个小型环境并且您想阻止使用任何 USB 设备，那么您可以在设备管理器中禁用 USB 端口，确保没有用户被设置为机器上的管理员，这应该会阻止所有 USB 使用。

如果您真的对此感到偏执，只需打开机器并拔掉端口即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T12:29:59.103

您是否试图阻止使用 USB 拇指驱动器？如果是这样，则有一个组策略允许您限制访问。

# flash - 制作Flash“弹出”的最佳方法

> ID：271916
> 
> 赞同：1
> 
> 时间：2008-11-07T12:23:46.057
> 
> 标签：flash, actionscript-3

在我的网站上，我想要一个小的 Flash 横幅，用户可以以某种方式激活它，它会变得更大以显示更多信息。

我已经看到广告横幅，当您将鼠标悬停在它们上时会令人讨厌地这样做，尽管我想要求用户单击特定的“更多”按钮。

我可以想到两种方法 1) 将 Flash 电影设为全尺寸，并使用“wmode”参数将其置于透明模式以进行闪烁，并且仅在被要求时才绘制完整的东西。2）将电影放在html页面上的一个div中，并使用css的绝对定位来定位它。当用户点击时，对页面上的javascript进行flash回调，使div变大，覆盖页面的一部分

两者似乎都有缺点和兼容性问题。有没有人有任何建议使用，或第三种方式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T14:14:06.833

我会使用 javascript 在用于“正常”模式的小型 swf 和大型覆盖模式（使用 wmode=transparent）之间进行交换。

这是因为覆盖页面的 flash 不会让点击通过，而且某些设置根本不支持 flash 的透明度（特别是一些 linux 配置 iirc），这会使整个站点无法使用。

此外， wmode=transparent 也很慢。因此，仅在必要时使用它。

# sql-server - 如何添加 SQL Server 2008 服务实例？

> ID：271923
> 
> 赞同：7
> 
> 时间：2008-11-07T12:30:51.970
> 
> 标签：sql-server, sql-server-2008

我从 SQl 服务器 05 升级到 08 并遇到了一些问题。卸载 05 并重新启动几次之后 08 安装好了，但现在我没有运行任何 SQL Server 服务。

我无法通过 SQL Server 管理工作室连接到 (local)\SQLExpress 或 .\SQLEXPRESS，并且 SQL Server 服务对话框不显示任何服务。那里没有添加按钮，那么如何添加新服务？

我是否以编程方式或其他方式执行此操作？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T12:36:56.607

我遇到过类似的问题，我们使用的解决方案是重新安装 SQL Server 2008，并在它要求您提供默认实例或命名实例时，使用命名实例并继续。

这不会影响任何当前安装的实例，但会创建一个提供的名称的新实例，然后从那里应该可以使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T12:43:43.147

如果它是您要创建的实例，您可能想看看[这个问题](https://stackoverflow.com/questions/265081/how-to-create-default-instance-after-creating-a-named-instance)- 它可能以相同的方式工作

# emacs - Emacs 中你最喜欢的插件是什么？

> ID：271924
> 
> 赞同：3
> 
> 时间：2008-11-07T12:31:16.993
> 
> 标签：emacs

我发现以下内容在我的日常工作中非常有用：

*   我做
*   emacs 缪斯
*   示波器
*   桌面
*   标签栏

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T16:33:14.260

**我已经成为org-mode**和 muse-mode的忠实粉丝。我使用 muse-mode，这是我在发现 org-mode 之前发现的，用于管理我主要保存与工作相关的笔记的本地 wiki。

我使用 org-mode 来管理我的任务并用它来做笔记。作为任务管理器，我发现它无与伦比。我打算“现在任何一天”将我的缪斯模式笔记迁移到 org-mode ......好吧，只要我开始破解一个 python 脚本来为我转换链接。我会错过缪斯模式的一些更像 wiki 的功能，但我认为最终我会从 org-mode 中的所有内容中受益。

对我来说，它取代了 OmniOutliner 和 OmniFocus。纯文本。适用于任何支持 emacs 的平台。使用源代码控制在计算机之间轻松保持同步。有什么不喜欢的？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-07T16:30:05.810

*   任何东西 - 它是一个易于扩展的 emacs 快速银器。纳夫说。
*   塞代
*   nxml + nxhtml
*   欧洲央行
*   亚斯片段
*   Org (jsut 开始了，已经 awesmoe)
*   我编写和修改的所有小库
    *   [用于 emacs 的ToDoChiKu](http://www.emacswiki.org/emacs/ToDoChiKu) Snarl/growl 通知绑定
    *   [FreeTagging](http://www.emacswiki.org/emacs/Tagging) - 通过美味/flickr 风格的标签为您的源代码提供视图。您可以通过标签（或其否定）过滤一段源，它还显示标签云。
    *   [twit.el](http://www.emacswiki.org/emacs/TwIt)用于 emacs 的推特
    *   [FileJournal](http://www.emacswiki.org/emacs/file-journal.el)最近使用的文件列表，包含任何内容

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T15:21:20.147

*   [塞代](http://cedet.sf.net)
*   牛羚
*   宽3米
*   [emacs-jabber](http://emacs-jabber.sf.net)
*   VC & DVC
*   AUCTeX
*   xml

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T13:45:36.140

[杰迪](http://jdee.sourceforge.net/)。它是 Emacs 的一个伟大的 Java 开发者补充。它添加了完整 IDE 的许多功能（代码完成是我的最爱）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-16T20:22:27.417

作为 Drupal/PHP 开发人员：

*   emacs 入门套件
*   **组织模式**
*   马吉特
*   nxhtml
*   格本
*   欧洲央行

和钢琴棒很好的衡量标准

# linux - 如何在本地安装包？

> ID：271938
> 
> 赞同：1
> 
> 时间：2008-11-07T12:38:25.857
> 
> 标签：linux, debian

背景：我现在有一台无法无线使用的kubuntu笔记本电脑，即我没有安装无线助手。但我有一台 Windows 笔记本电脑，我可以将 debian 软件包单独下载到 USB 记忆棒上。

如何在本地计算机上安装 debian 包？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T12:43:58.123

安装 U 盘后：

```
dpkg --install /path/to/foo_VVV-RRR.deb 
```

（其中 fooVVV-RRR.deb 是包的文件名）

您可以在[Debian GNU/Linux FAQ](http://www.debian.org/doc/FAQ/ch-pkgtools.en.html)中找到更多命令。

旁注：这是来自命令行。我不知道如何让突触来做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T13:00:24.220

如果你不是命令行爱好者，双击文件管理器中的 .deb 文件应该会启动一个包安装程序。与当然具有完全相同的效果`dpkg -i`。

# c++ - 线程工作方法中的单例 getInstance

> ID：271939
> 
> 赞同：1
> 
> 时间：2008-11-07T12:40:02.623
> 
> 标签：c++, multithreading

这个问题是关于在工作线程中使用单例对象的 getter 方法。首先是一些伪代码：

```
// Singleton class which contains data
class MyData
{
    static MyData* sMyData ;

    int  mData1[1024];
    int  mData2[1024];
    int  mData3[1024];

    MyData* getInstance()
    {
        // sMyData is created in the very beginning.
        return sMyData ;
    }

    void getValues(int idx, int& data1,int& data2,int& data3)
    {
        data1 = mData1[idx];
        data2 = mData2[idx];
        data3 = mData3[idx];
    }

    int* getData1()
    {
        return &mData1[0];
    }
}

class MyThread
{
    void workerMethod()
    {
        MyData* md = MyData::getInstance();

        int d1,d2,d3;
        md->getValue( 12, d1,d2,d3 );

        int* data1 = md->getData1();
        d1 = data1[34];
    }
} 
```

现在如您所见，我有一些 getter 方法（都是只读的），MyData::getInstance()、MyData::getValue() 和 MyData::getData1()。第一个问题是这些方法的线程安全性如何？

由于它们通常被称为方法，因此我试图避免使用互斥锁保护这些方法。

第二个问题是：在多线程应用程序中，尤其是在工作方法中，从中央源读取数据的建议方法是什么。

谢谢 ！

保罗

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T12:45:07.947

假设没有其他线程会尝试写入单例对象中的数据，则不需要保护它们：根据定义，在没有写入器的情况下，多个读取器是线程安全的。这是一种常见的模式，程序的初始化代码设置一个单例，然后只能由工作线程读取。

但是，如果*任何**线程*在其他线程读取数据时写入该数据，则必须以某种方式保护它。如果您有很多读者并且只有偶尔的作家，那么值得考虑某种“读写”锁，它允许在没有任何作家的情况下有多个读者。

 ** * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T12:51:07.937

无法判断这是否是线程安全的。如果数据在对象创建期间被初始化并且从不改变，那么这将正确运行。如果您通过其他方法改变底层数据，那么读者将不得不对作者执行某种同步，这是没有办法的。

根据您正在做什么，您可能可以使用比互斥锁更轻的东西，例如原子更新同步命令，或使用读写器锁，但如果不了解更多关于您在做什么的信息，就无法判断。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T12:50:36.143

你的方法没问题，但是你有两个主要问题。

首先，MyData::getInstance() 应该是静态的并且不创建实例。为了最大限度地减少互斥锁的使用，您应该检查[双重检查锁](http://en.wikipedia.org/wiki/Double_checked_locking_pattern "双重检查锁")。

其次，线程安全取决于 getter 方法的调用者，而不是 MyData 类。如果那是您正在寻找的东西，那就太好了。如果没有，那么您将不得不在 MyClass 中提出某种访问控制。此外，由于您包含的数据类型只是一个基本类型 (int)，因此在您的代码投入生产之前，您很有可能永远不会看到任何同步问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T14:55:41.397

首先回去阅读这个问题以获得更好的singelton版本：
[任何人都可以为我提供C++中的Singelton示例吗？](https://stackoverflow.com/questions/270947/can-any-one-provide-me-a-sample-of-singleton-in-c)

另请注意：不要**将**单例用作美化的全局变量。
它只会增加糟糕设计的复杂性。只需使用全局变量。

只要您只从单例中读取，它在使用时是线程安全的。

唯一不是线程安全的（语言不保证）是在创建期间。因此，从技术上讲，您应该在创建实例的部分周围添加锁，以确保在任何人可以使用它之前已经完全创建了单例。

注意：不要被使用双重检查锁定来优化你的锁定策略。它不能**在**C++ 中正常工作。阅读这篇[DDJ 文章](http://www.aristeia.com/Papers/DDJ_Jul_Aug_2004_revised.pdf)。

如果您可以保证在单线程环境中（在创建任何线程之前）实例化单例（可能也是第一次调用 getInstance()），那么您可以在实例化期间免除对锁的需求。

如果您更改代码以便其他线程可以写入单例，那么您需要考虑锁定和一致性。如果您的写入不是原子的，您只需要锁定。如果您的写入只是更新一个整数，那么它已经是原子的，不需要更改。如果您的代码不是原子的：

*   在方法中写入多个整数
*   执行读取然后写入

然后，您将需要锁定对象，直到所有写入完成，因此还要锁定具有读取访问权限的方法，以阻止它们从对象读取，同时另一个方法更新对象。

因此，这是成员变量只能由成员方法访问的另一个原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T14:58:19.007

为了线程安全，您需要将类视为一个整体。正如所写的那样，您的课程将不是线程安全的。虽然您的 getValues 方法没问题，但 getData1 方法有问题。

您说它们是（只读）getter 方法。但是，两者都没有被声明为 const 方法。getData1 作为 const 方法无效，因为它返回一个非 const 指针。此外，在公开实现时，返回指向私有类数据的指针是不好的。

如果这是一个单例类，用于在线程启动之前在初始化时保存一些基本静态的数据集，那么所有访问器都应该是 const 方法。getInstance 还应该返回一个指向该类的 const 指针（并且是另一个答案提到的静态方法）。

# asp.net - 以中等信任度在 ASP.NET 中存储临时用户文件

> ID：271944
> 
> 赞同：5
> 
> 时间：2008-11-07T12:42:15.007
> 
> 标签：asp.net, file-io, medium-trust

我有一个场景，我的 ASP.NET Web 应用程序的用户提交由文本信息和图像组成的推荐。提交过程有以下步骤：

*   首先，用户输入内容并选择图像的路径
*   当他点击预览时，信息再次显示，以便他可以确认
*   一旦确认信息将保存在数据库中

问题是我不想在用户实际确认之前将上传的图像存储在数据库中。相反，我将它们存储为临时文件，并仅在最终确认后才将它们放入数据库中。

由于我还希望我的应用程序以中等信任度运行，因此我仅对应用程序目录具有写入权限，而在外部没有任何权限。我什至想将 ASPNET / NETWORK SERVICE 用户的写入权限限制为 ~/App_Data 文件夹。我的方案的问题是，一旦在此文件夹中创建了一个临时文件，应用程序池就会被回收，我不希望在每次提交证明时都这样做。

您如何建议我保留这些临时文件？如果我更新文件，则不会重新启动池 - 仅在创建或重命名时。但我不认为我可以为所有用户将整个图像存储在一个文件中。你怎么看？

**更新**：我应该注意我正在使用第三方控件进行上传。它使我可以在上传后以编程方式访问文件内容的二进制流，但在第二次回发后我无法保留它（第一步和回发实际上是上传）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T13:01:15.280

我会推荐[IsolatedStorage](http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx)。这是一种虚拟文件夹。

[以下是CodeProject 示例](http://www.codeproject.com/KB/dotnet/IsolatedStorage.aspx)的摘录：

```
IsolatedStorageFileStream stream = 
  new IsolatedStorageFileStream(ISOLATED_FILE_NAME, 
  FileMode.Create, isoStore);

StreamWriter writer = new StreamWriter( stream );
writer.WriteLine( "This is my first line in the isolated storage file." );
writer.WriteLine( "This is second line." );
writer.Close(); 
```

**更新**：要清理您的文件，只需执行以下操作：

```
string fileName = "isolatestorage.txt";

IsolatedStorageFile storage = IsolatedStorageFile.GetStore(
    IsolatedStorageScope.User | IsolatedStorageScope.Assembly, null, null);

string[] files = storage.GetFileNames(fileName);
foreach(string file in files) {
    if(file == fileName) {
        storage.DeleteFile(file);
        break;
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T12:49:43.993

您仍然可以使用普通的[Path.GetTempFilename](https://msdn.microsoft.com/en-us/library/system.io.path.gettempfilename.aspx) () 方法在 ASP.NET 场景中获取临时文件。

它应该为您提供一个可由 NETWORK_SERVICE 写入的临时文件路径，但也位于实际 Windows 的临时文件夹之一中，而不是您的应用程序文件夹中。

如果您的主机正确配置了他的服务器，那应该可以正常工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-09T03:23:29.047

众所周知，Microsoft 提供的默认 web_mediumtrust.config 文件是不切实际的。

这是来自默认 web_mediumtrust.config 文件的片段。默认情况下，您不能使用 System.IO 来发现或写入临时文件夹。

```
 <IPermission
                                class="FileIOPermission"
                                version="1"
                                Read="$AppDir$"
                                Write="$AppDir$"
                                Append="$AppDir$"
                                PathDiscovery="$AppDir$"
                        /> 
```

尽管我没有像@Seb 提到的那样尝试隔离存储，但默认配置文件似乎允许这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T13:03:27.240

这是对对我的问题发表评论的 Leppie 的回复（以避免字符限制）

来自：http: [//blogs.msdn.com/johan/archive/2007/05/16/common-reasons-why-your-application-pool-may-unexpectedly-recycle.aspx](http://blogs.msdn.com/johan/archive/2007/05/16/common-reasons-why-your-application-pool-may-unexpectedly-recycle.aspx)

> ...有时您的应用程序池会莫名其妙地无缘无故地回收。这通常是配置问题，或者是由于您在应用程序目录中执行文件系统操作。

你确定它不应该回收吗？

# oracle - Oracle 同义词选择

> ID：271953
> 
> 赞同：1
> 
> 时间：2008-11-07T12:44:06.063
> 
> 标签：oracle, synonym

遇到一种情况，在模式中我有一个表，比如表 ACTION ，而我也有一个名为 ACTION 的同义词，它将另一个表引用到另一个模式。

现在，当我运行查询

从动作中选择 *

它将从表中选择记录，但不选择同义词。

无论如何让我从同义词和表格中同时选择？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T13:26:48.393

我不认为您的 ACTION 同义词与您的 ACTION 表位于相同的架构中，因为这在 Oracle 中是不允许的。您的 ACTION 同义词很可能存在于其他模式中，也许它是一个 PUBLIC 同义词。如果是这种情况，您可以使用

```
select * from ACTION
union 
select * from public.ACTION 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T13:01:27.917

好吧，你的底层 ACTION 表应该被重命名，比方说做 LOCAL_ACTION。

假设您的 ACTION 同义词在 otheruser.LOCAL_ACTION 表上...

然后您可以将 ACTION 同义词重新定义为：

```
SELECT * from LOCAL_ACTION
UNION
SELECT * from otheruser.LOCAL_ACTION 
```

然后最后， select * from ACTION 将为您提供两个表的组合列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T13:44:31.010

表和私有同义词确实共享相同的名称空间，所以这是一个公共同义词：http: [//download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements008.htm#sthref723](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements008.htm#sthref723)

请注意，UNION 是结果集的隐式不同。你需要的是 UNION ALL。

```
select * from ACTION
union all
select * from public.ACTION 
```

# ms-access - 任何人都知道将 Access 2007 连接到 SQL Server 2008 的魔力吗？

> ID：271954
> 
> 赞同：1
> 
> 时间：2008-11-07T12:44:09.197
> 
> 标签：ms-access, sql-server-2008

我从不使用 Access 2007 - 直到今天。

我想连接到现有的 SQL Server 2008 数据库。我试过使用：

*   外部数据 ODBC 选项 - 但得到 DSN 错误
*   使用 ODBC 升迁向导 - 出现错误
*   使用 SNAC 升迁向导 - 获取 ODBC 错误。所以这似乎不是首发:-)

我做了一些搜索，只发现其他人有同样的问题。即将做更多...但希望你们中的一个人有答案 OTTOYH。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-02T15:30:13.827

Access 2007 中的升迁向导不知道 SQL Server 2008，因此不会连接。您应该使用SQL Server 2008 随附的用于 Access 工具的[SQL Server 迁移助手。](http://www.microsoft.com/sqlserver/en/us/product-info/migration-tool.aspx#Access)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-08T03:22:09.317

If you create a DSN that points to the SQL Server, can you not then create linked tables via ODBC that use the DSN? If not, then there's something wrong with the DSN, seems to me.

Perhaps you could outline the exact steps you are taking in order to connect to SQL Server 2008 (including any errors you get), instead of just reporting what went wrong.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T12:51:33.817

尝试链接到 ODBC 连接时出现什么错误？只是为了确认一下，您是从“外部数据”功能区的“导入”部分选择 ODBC 数据库吗？如果您测试您的 ODBC 连接，它是否通过了？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T12:57:53.320

ODBC 连接很好，数据库很好等等。看起来这是一个“Access 2007 对 SQL 2008 一无所知”之类的问题。

更新：它现在适用于外部数据库！我关闭了访问。重新打开访问。我没有创建新的 DSN，而是指向我上次创建的 DSN（避开向导）。工作得很好。

DSN 包含：

```
[ODBC]
DRIVER=SQL Server
UID=ericnel
DATABASE=AccessTest
WSID=ERICNEL1
APP=2007 Microsoft Office system
Trusted_Connection=Yes
SERVER=ericnel1
Description=test 
```

虽然升迁向导仍然认为 SQL 2008 不是 SQL Server :-)

# xml - SQL Server 2005 - 将 XML 字段放入文件；一些xml字段到他们自己的文件中

> ID：271957
> 
> 赞同：0
> 
> 时间：2008-11-07T12:45:04.377
> 
> 标签：xml, sql-server-2005, sqlcmd

我的行结构看起来像 ID bigint、ScanRept XML

我想结束一个名为 4.xml 的文件，其中仅包含 ID 号为 4 的 ScanRept 列中的 xml。

我不想以交互方式进行（通过进入 Manager Studio，找到行，右键单击该字段并执行另存为） - 如果我找不到更好的方法，我会这样做。

我确实有可用的 C#；如果这对 sqlcmd 可行，那是我的偏好（因为可能会有很多我现在无法预料的变化）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-07T13:36:10.857

可能有更好的方法来做到这一点......但如果不测试这样的东西可能会起作用。C#

```
SqlDataAdapter adapter = new SqlDataAdapter("SELECT ID, ScanRept FROM TableName", "connString");
DataTable dt = new DataTable();
adapter.Fill(dt);

foreach (DataRow row in dt.Rows)
{
    string type = row["ID"].ToString();
    string location = "C\\" + type + ".xml";
    string xml = row["ScanRept"].ToString();
    XmlTextWriter writer = new XmlTextWriter(location, null);
    writer.WriteString(xml);
    writer.Flush();
    writer.Close();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T17:41:41.563

命令行方法`bcp`：

```
bcp "SELECT ScanRept FROM <DBName>.dbo.<TableName> WHERE ID = 4" queryout 4.xml -c -S<ServerName> -U<UserName> -P<Password> 
```

或用于受信任的连接

```
bcp "SELECT ScanRept FROM <DBName>.dbo.<TableName> WHERE ID = 4" queryout 4.xml -c -S<ServerName> -T 
```

命令行方法`sqlcmd`：

```
sqlcmd -U<Username> -P<Password> -S<ServerName> -h -1 -Q "SET NOCOUNT ON SELECT ScanRept FROM <DBName>.dbo.<TableName> WHERE ID = 4;" -o 4.xml 
```

或用于受信任的连接

```
sqlcmd -E -S<ServerName> -h -1 -Q "SET NOCOUNT ON SELECT ScanRept FROM <DBName>.dbo.<TableName> WHERE ID = 4;" -o 4.xml 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T18:12:45.493

谢谢你们俩-很好的提示

Panos，它会在一定长度后截断 - 即 258 个字符？

Toytown，除了 writer.WriteRaw() 是我需要的，否则它会编码 XML 标记以使其成为有效数据，例如，< 变成 & lt 分号

到目前为止，除了一个长长的 xml 流（没有缩进，没有换行符）之外，我什么也得不到。我不确定我的数据中是否有任何格式化空格，但我知道当我右键单击 SSMS 中的字段时，它会打开 MS XML 编辑器，显示它的所有格式都很漂亮。

好吧，正如法国人所说，“那个该死的 XML 对我的法语 Too-SHEE 来说是一种痛苦”。您的两条评论都有帮助，一旦我在这个 dang open id 事物上注册，我就会为您的答案投票。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T21:43:34.883

这是另一种让它写得很漂亮的方法，就像热法国女孩喜欢的方式：

```
 string IRIXno = args[0] ;

        string connectionString ;

        string query = "Select ID, Report FROM Reports WHERE id =" + IRIXno;

        try

        {

            connectionString = ConfigurationSettings.AppSettings["ConnectionString"];

        }

        catch

        {

            Console.WriteLine("YOur connection string isn't set or something.");

            return;

        }

        SqlConnection conn = new SqlConnection(connectionString);

        conn.Open();

        SqlCommand sqlComm = new SqlCommand(query, conn);

        sqlComm.CommandType = CommandType.Text;

        SqlDataReader reader = sqlComm.ExecuteReader();

        reader.Read(); // one and only row

        XmlDocument doc = new XmlDocument();

        XmlReader xmlReader = reader.GetSqlXml(1).CreateReader() ;//second column is our guy

        doc.Load(xmlReader); 

        string outfile = "H:\\" + IRIXno + ".xml";

        doc.Save(outfile) ; 
```

# glut - 设置鼠标位置

> ID：271965
> 
> 赞同：3
> 
> 时间：2008-11-07T12:47:41.907
> 
> 标签：glut

glut中是否有将鼠标移动到特定位置的功能？SDL (SDL_WarpMouse) 中有一个类似的功能，但我想坚持 glut。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T12:52:47.637

我刚刚找到它，您只需要提出正确的问题，谷歌就会提供帮助：D

它的`glutWarpPointer(middleX, middleY)`;

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T23:40:57.387

除非您还隐藏指针，否则这将非常难看。我曾经在一个课堂项目中使用过它，它成功了，但看起来很糟糕。但话又说回来，我用它来模拟纯粹的相对鼠标移动（基本上它不能离开窗口）。但除此之外，是的，它可以完成工作。

# c# - 关于使用 F# 创建可从 C# 使用的 Matrix 程序集

> ID：271966
> 
> 赞同：5
> 
> 时间：2008-11-07T12:48:14.883
> 
> 标签：c#, f#, language-interoperability

C# 中没有内置矩阵函数，但 F# powerpack 中有。

与其使用第三方或开源 C# 库，我想知道在 F# 中滚动我自己的库，并将有用的部分暴露给 C#。

想知道是否有人已经想到这一点，或尝试过，以及这是否是一个好主意。

我应该将它公开为一个类，还是一组静态函数？

或者我应该创建一个 C# 包装类，并将该调用向下调用到 F#？还是让 F# 使用 C# 类作为输入和输出？

有什么想法吗？

感谢下面的[Hath](https://stackoverflow.com/questions/271966/about-using-f-to-create-a-matrix-assembly-usable-from-c#272250)回答：您可以直接在 C# 中使用 F# 库（运算符也是如此！）：

```
using System;
using System.Text;
using Microsoft.FSharp.Math;

namespace CSharp
{
  class Program
  {
    static void Main(string[] args)
    {

        double[,] x = { { 1.0, 2.0 }, { 4.0, 5.0 } };
        double[,] y = { { 1.0, 2.0 }, { 7.0, 8.0 } };
        Matrix<double> m1 = MatrixModule.of_array2(x);
        Matrix<double> m2 = MatrixModule.of_array2(y);
        var mp = m1 * m2;

        var output = mp.ToArray2();
        Console.WriteLine(output.StringIt());

      Console.ReadKey();
    }
  }

  public static class Extensions
  {
    public static string StringIt(this double[,] array)
    {
      var sb = new StringBuilder();
      for (int r = 0; r < array.Length / array.Rank; r++)
      {
          for (int c = 0; c < array.Rank; c++)
          {
              if (c > 0) sb.Append("\t");
              sb.Append(array[r, c].ToString());
          }
          sb.AppendLine();
      }
      return sb.ToString();
    }
  }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T14:36:08.893

不能只引用c#中需要的f#库直接使用吗？

我做了类似的事情来引用 FSharp.Core.dll 来获取

```
Microsoft.FSharp.Math.BigInt class. 
```

因此，您可能只需参考 FSharp.PowerPack.dll 即可获得

```
Microsoft.FSharp.Math.Matrix<A> class 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T13:35:43.930

XNA 框架中有非常好的 Matrix 类。我要么引用那个 dll，要么很可能使用反射器并将代码复制并粘贴到我自己的解决方案中。我知道它不能直接回答你的问题，而只是另一个想法......

# c++ - 如何改进/替换 sprintf，我认为它是一个性能热点？

> ID：271971
> 
> 赞同：9
> 
> 时间：2008-11-07T12:51:43.740
> 
> 标签：c++, c, performance, printf, strftime

通过分析我发现这里的 sprintf 需要很长时间。是否有更好的替代方案仍然可以处理 y/m/dh/m/s 字段中的前导零？

```
SYSTEMTIME sysTime;
GetLocalTime( &sysTime );
char buf[80];
for (int i = 0; i < 100000; i++)
{

    sprintf(buf, "%4d-%02d-%02d %02d:%02d:%02d",
        sysTime.wYear, sysTime.wMonth, sysTime.wDay, 
        sysTime.wHour, sysTime.wMinute, sysTime.wSecond);

} 
```

* * *

注意：OP 在评论中解释说这是一个精简的示例。“真实”循环包含使用来自数据库的不同时间值的附加代码。分析已确定`sprintf()`为罪犯。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-07T13:09:07.073

如果您正在编写自己的函数来完成这项工作，那么 0 .. 61 的字符串值的查找表将避免对除年份之外的所有内容进行任何算术运算。

编辑：请注意，为了应对闰秒（并匹配[`strftime()`](http://en.cppreference.com/w/c/chrono/strftime)），您应该能够打印 60 和 61 的秒值。

```
char LeadingZeroIntegerValues[62][] = { "00", "01", "02", ... "59", "60", "61" }; 
```

或者，怎么样[`strftime()`](http://en.cppreference.com/w/c/chrono/strftime)？我不知道性能比较如何（它很可能只是调用 sprintf()），但它值得一看（它可以自己进行上述查找）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-07T13:01:13.173

您可以尝试依次填充输出中的每个字符。

```
buf[0] = (sysTime.wYear / 1000) % 10 + '0' ;
buf[1] = (sysTime.wYear / 100) % 10 + '0';
buf[2] = (sysTime.wYear / 10) % 10 + '0';
buf[3] = sysTime.wYear % 10 + '0';
buf[4] = '-'; 
```

... ETC...

不漂亮，但你明白了。如果不出意外，它可能有助于解释为什么 sprintf 不会那么快。

OTOH，也许你可以缓存最后的结果。这样你只需要每秒生成一个。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-07T13:01:19.850

Printf 需要处理很多不同的格式。您当然可以获取[printf 的源代码，](http://www.menie.org/georges/embedded/printf.c)并以此为基础推出您自己的版本，专门处理**sysTime**结构。这样，您传入一个参数，它就完成了需要完成的工作，仅此而已。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-07T13:07:03.363

“长”时间是什么意思 - 因为`sprintf()`是循环中唯一的语句并且循环的“管道”（增量，比较）可以忽略不计，所以`sprintf()` *必须*消耗最多的时间。

还记得那个男人在第三街的一个晚上丢失了他的结婚戒指，但在第五街寻找它，因为那里的灯光更亮的老笑话吗？您已经构建了一个旨在“证明”您的假设`sprintf()`无效的示例。

`sprintf()`如果您分析除您使用的所有其他函数和算法之外还包含的“实际”代码，您的结果将更加准确。或者，尝试编写您自己的版本来解决您需要的特定零填充数字转换。

你可能会对结果感到惊讶。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-07T14:00:31.337

看起来 Jaywalker 提出了一种非常相似的方法（比我快了不到一个小时）。

除了已经建议的查找表方法（下面的 n2s[] 数组）之外，如何生成格式缓冲区以减少通常的 sprintf 密集度？除非年/月/日/小时已更改，否则下面的代码只需在每次循环中填写分钟和秒。显然，如果其中任何一个发生了变化，您确实会再次受到 sprintf 的影响，但总体而言，它可能不会超过您目前所看到的（与数组查找结合使用时）。

```
 static char fbuf[80];
static SYSTEMTIME lastSysTime = {0, ..., 0};  // initialize to all zeros.

for (int i = 0; i < 100000; i++)
{
    if ((lastSysTime.wHour != sysTime.wHour)
    ||  (lastSysTime.wDay != sysTime.wDay)
    ||  (lastSysTime.wMonth != sysTime.wMonth)
    ||  (lastSysTime.wYear != sysTime.wYear))
    {
        sprintf(fbuf, "%4d-%02s-%02s %02s:%%02s:%%02s",
                sysTime.wYear, n2s[sysTime.wMonth],
                n2s[sysTime.wDay], n2s[sysTime.wHour]);

        lastSysTime.wHour = sysTime.wHour;
        lastSysTime.wDay = sysTime.wDay;
        lastSysTime.wMonth = sysTime.wMonth;
        lastSysTime.wYear = sysTime.wYear;
    }

    sprintf(buf, fbuf, n2s[sysTime.wMinute], n2s[sysTime.wSecond]);

} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-07T13:07:36.030

缓存结果怎么样？这不是一种可能吗？考虑到这个特定的 sprintf() 调用在您的代码中过于频繁，我假设在大多数这些连续调用之间，年、月和日不会改变。

因此，我们可以实现如下所示。声明一个旧的和当前的 SYSTEMTIME 结构：

```
SYSTEMTIME sysTime, oldSysTime; 
```

另外，声明单独的部分来保存日期和时间：

```
char datePart[80];
char timePart[80]; 
```

因为，第一次，您必须同时填写 sysTime、oldSysTime 以及 datePart 和 timePart。但是随后的 sprintf() 可以变得更快，如下所示：

```
sprintf (timePart, "%02d:%02d:%02d", sysTime.wHour, sysTime.wMinute, sysTime.wSecond);
if (oldSysTime.wYear == sysTime.wYear &&
  oldSysTime.wMonth == sysTime.wMonth &&
  oldSysTime.wDay == sysTime.wDay)
  {
     // 我们可以重用日期部分
     strcpy (buff, datePart);
     strcat (buff, timePart);
  }
别的 {
     // 我们还需要重新生成日期部分
     sprintf (datePart, "%4d-%02d-%02d", sysTime.wYear, sysTime.wMonth, sysTime.wDay);
     strcpy (buff, datePart);
     strcat (buff, timePart);
}

memcpy (&oldSysTime, &sysTime, sizeof (SYSTEMTIME));

```

上面的代码有一些冗余，使代码更容易理解。您可以轻松排除。如果您知道小时和分钟的变化不会比您对例行程序的调用更快，您可以进一步加快速度。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-07T13:48:35.450

我会做几件事...

*   缓存当前时间，因此您不必每次都重新生成时间戳
*   手动进行时间转换。`printf`-family 函数中最慢的部分是格式字符串解析，在每次循环执行时都将循环用于解析是很愚蠢的。
*   尝试对所有转换使用 2 字节查找表 ( `{ "00", "01", "02", ..., "99" }`)。这是因为您想避免模数运算，而 2 字节的表意味着您一年只需要使用一个模数。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-07T13:03:05.290

您可能会通过手动滚动一个在返回 buf 中布置数字的例程来提高 w perf，因为您可以避免重复解析格式字符串，并且不必处理 sprintf 处理的许多更复杂的情况。我讨厌实际上建议这样做。

我建议您尝试弄清楚您是否可以以某种方式减少生成这些字符串所需的数量，它们是否有时是可选的，它们是否可以被缓存等等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-02T05:40:01.393

我目前正在解决类似的问题。

我需要在嵌入式系统上记录带有时间戳、文件名、行号等的调试语句。我们已经有一个记录器，但是当我将旋钮转到“完整记录”时，它会占用我们所有的 proc 周期并使我们的系统处于可怕的状态，表明任何计算设备都不应该经历。

有人确实说过“如果不改变你正在测量/观察的东西，你就无法测量/观察某物”。

所以我正在改变一些事情来提高性能。目前的情况是，我比原始*函数调用*快 2 倍（该日志记录系统的瓶颈不在函数调用中，而是在日志阅读器中，它是一个单独的可执行文件，如果我编写自己的日志堆栈，我可以丢弃它）。

我需要提供的界面类似于 - `void log(int channel, char *filename, int lineno, format, ...)`。我需要附加通道名称（当前在列表中进行*线性搜索*！对于每个调试语句！）和时间戳，包括毫秒计数器。以下是我正在做的一些事情以使这更快 -

*   将频道名称字符串化，这样我就可以`strcpy`而不是搜索列表。将宏定义`LOG(channel, ...etc)`为`log(#channel, ...etc)`. 如果您通过定义获得固定的*10*字节通道长度来固定`memcpy`字符串的长度，则可以使用`LOG(channel, ...)` `log("...."#channel - sizeof("...."#channel) + *11*)`
**   每秒生成几次时间戳字符串。你可以使用 asctime 什么的。然后将固定长度的字符串 memcpy 到每个调试语句。*   如果您想实时生成时间戳字符串，那么带有分配的查找表（不是 memcpy！）是完美的。但这仅适用于 2 位数字，也许适用于一年。*   三位数（毫秒）和五位数（lineno）呢？我不喜欢 itoa，`digit = ((value /= value) % 10)`也不喜欢自定义 itoa()，因为 div 和 mods 很*慢*。我写了下面的函数，后来发现在 AMD 优化手册（汇编）中有类似的东西，这让我相信这些是最快的 C 实现。

    ```
    void itoa03(char *string, unsigned int value)
    {
       *string++ = '0' + ((value = value * 2684355) >> 28);
       *string++ = '0' + ((value = ((value & 0x0FFFFFFF)) * 10) >> 28);
       *string++ = '0' + ((value = ((value & 0x0FFFFFFF)) * 10) >> 28);
       *string++ = ' ';/* null terminate here if thats what you need */
    } 
    ```

    同样，对于行号，

    ```
    void itoa05(char *string, unsigned int value)
    {
       *string++ = ' ';
       *string++ = '0' + ((value = value * 26844 + 12) >> 28);
       *string++ = '0' + ((value = ((value & 0x0FFFFFFF)) * 10) >> 28);
       *string++ = '0' + ((value = ((value & 0x0FFFFFFF)) * 10) >> 28);
       *string++ = '0' + ((value = ((value & 0x0FFFFFFF)) * 10) >> 28);
       *string++ = '0' + ((value = ((value & 0x0FFFFFFF)) * 10) >> 28);
       *string++ = ' ';/* null terminate here if thats what you need */
    } 
    ```* 

 *总的来说，我的代码现在非常快。`vsnprintf()`我需要使用大约 91% 的时间，而我的其余代码只占用 9% （而其余代码，即除了以前`vsprintf()`占用 54% 的时间）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-05-09T19:03:36.320

我测试过的两个快速格式化程序是[**FastFormat**](http://www.fastformat.org/)和**Karma::generate**（[Boost Spirit](https://www.boost.org/doc/libs/1_67_0/libs/spirit/doc/html/spirit/karma.html)的一部分）。

您可能还会发现对其进行基准测试或至少查找现有基准很有用。

例如[这个](http://www.zverovich.net/2013/09/07/integer-to-string-conversion-in-cplusplus.html)（虽然它缺少 FastFormat）：

[![C ++中的快速整数到字符串转换](https://i.stack.imgur.com/FBjiB.png)](https://i.stack.imgur.com/FBjiB.png)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-07T12:59:23.753

StringStream 是我从谷歌得到的建议。

[http://bytes.com/forum/thread132583.html](http://bytes.com/forum/thread132583.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-07T13:05:55.487

很难想象你会在格式化整数方面击败 sprintf。你确定 sprintf 是你的问题吗？

# asp.net - 什么更有效 - 使用 ASP.NET AJAX 或 jQuery 进行服务器调用？

> ID：271972
> 
> 赞同：3
> 
> 时间：2008-11-07T12:52:03.677
> 
> 标签：asp.net, jquery, ajax, asp.net-ajax

我在上一个项目中专门使用 jQuery 来完成我所有的 AJAX 调用。我使用 $.ajax 和 $.getJSON 调用将数据返回到页面。但是，我在网上看到大量使用 jQuery 处理 UI 和数据格式的示例，但使用 ASP.NET AJAX 实际执行 Web 服务调用和检索数据。使用 ASP.NET AJAX 检索 AJAX 调用的数据是否更有效？它的性能是否比 jQuery 好？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-07T12:57:22.073

我认为无论您使用 ASP.NET Ajax 还是 jQuery，都不会产生太大的影响。可能会有所不同的是返回什么数据以及它采用什么格式，即 XML、HTML 或 JSON。

例如，从 Ajax 调用返回轻量级 JSON 对象可能比大型 XML 文档更有效：您始终可以使用 Firebug 或类似的东西来监控 Ajax 响应的大小。

不过，您可能必须根据其自身的优点来判断每种情况。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-25T09:06:25.827

在我切换到 jQuery 之前，我在 2 年内广泛使用了 Microsoft 的 Ajax Control Toolkit，根据我的经验，我认为 jquery ajax 调用比 ajax 控制工具包库更轻量级、更高效。除此之外，效率当然取决于您通过 ajax 调用发送和接收的数据。

您还可以在 jQuery ajax 调用中添加自定义 HTTP 状态代码，以捕获服务器上的任何错误并返回适当的响应。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T01:43:37.067

我自己也一直在想同样的事情。当 MS 宣布未来的 JQuery 支持时，我想知道“推荐”的方法来处理两个框架重叠的事情（即：对服务器进行异步调用），因为这两个库之间存在一些重叠。

我认为您将获得的最大效率提升显然是在您使用的数据传输中（json 与 xml），但我不太熟悉 JQuery 的 $.ajax 和 $.getJSON 实现与使用类似 Sys.Net.WebServiceProxy 的东西调用服务器。关于 asp.net ajax 客户端堆栈的一个好处是网络调用的钩子，我们使用它来创建可以检查来自服务器的响应并执行特定操作的基本行为（即：查找某些 HTTP 状态代码）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T12:04:57.267

我认为 ASP.Net 的库已适应使用 jquery ... [http://www.aspcode.net/ASPNET-and-JQuery-first-example.aspx](http://www.aspcode.net/ASPNET-and-JQuery-first-example.aspx)

如果属实，则意味着两者在速度上是联系在一起的。尽管 jQuery 库可能更新得更快。

# iis - GAC 问题：不断更新旧版本

> ID：271976
> 
> 赞同：0
> 
> 时间：2008-11-07T12:53:43.033
> 
> 标签：iis, web-config, gac

我创建了一个简单的 httpModule，在 GAC 上注册并将其添加到全局 web.config。

我对模块进行了一些更改，更新了版本并在 web.config 上也进行了更改。

发生的事情是我不断获得旧版本。我重新启动了计算机，将其从 GAC 中删除，删除了消费者应用程序 .net 临时文件，但消费者应用程序仍然呈现来自 httpModule 的旧 html 代码。

有什么想法吗？

谢谢，布鲁诺·菲格雷多 [http://www.brunofigueiredo.com](http://www.brunofigueiredo.com)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T13:02:01.067

不要使用 GAC。

很简单，您拥有的任何依赖项都应该是二进制部署的，以避免版本控制问题。

我之前在博客上写过：[http ://www.tigraine.at/2008/10/13/handling-dependencies/](http://www.tigraine.at/2008/10/13/handling-dependencies/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T12:59:01.837

您的 bin 文件夹中是否有旧版本？另一种选择是针对旧版本编译一些其他代码。如果一切都失败了，你可以使用[bindingRedirect](http://nayyeri.net/blog/redirect-assembly-versions-using-bindingredirect-element/)来强制你的新版本。

# sql - 在 SQL Server 中使用纯 SQL 在数据库之间复制 BLOB 值

> ID：271979
> 
> 赞同：5
> 
> 时间：2008-11-07T12:55:40.657
> 
> 标签：sql, sql-server, tsql, stored-procedures, blob

我需要从 SQL Server 2005 数据库中提取一些 BLOB 数据并生成一个 SQL 脚本以将相同的数据插入到另一个数据库中，另一个服务器中。

我只能使用 SQL 脚本来执行此操作，我不能使用任何其他实用程序或用 Java 或 .NET 编写程序来执行此操作。

我的另一个大限制是，当我运行脚本时，我无法访问原始数据库（原始 BLOB 数据所在的位置），将 BLOB 数据复制到目标数据库，因此数据应该已经在其中编码SQL 脚本文件。

总结：有没有办法将 BLOB 数据编码为文本，以便我可以将其转储到脚本文本文件中的 SQL INSERT 命令中并运行它？

如果需要，我可以运行特殊的 T-SQL 语句和存储过程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T13:26:27.240

TEXTCOPY 是 SQL Server 7.0 和 2000 中包含的示例应用程序，但在 SQL Server 2005 中不再可用。

但是，在 SQL Server 2005 中搜索 TEXTCOPY 时，我发现这种替代方法可能会奏效：

[http://sequelserver.blogspot.com/2007/01/texcopy-sql-server-2005.html](http://sequelserver.blogspot.com/2007/01/texcopy-sql-server-2005.html)

它依赖于从文件系统写入和读取二进制数据，在我的情况下这并不理想（理想情况下，我想用 SQL 脚本文本文件本身对二进制数据进行编码），但它是迄今为止我发现的最好的。

这是关于如何使用 BULK OPENROWSET 进行二进制导入/导出操作的另一个很好的来源：http: [//msdn.microsoft.com/en-us/library/ms191184.aspx](http://msdn.microsoft.com/en-us/library/ms191184.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T13:01:30.893

这篇文章“[将文本或图像复制到 SQL Server 中或从 SQL Server 中复制出来](http://www.databasejournal.com/features/mssql/article.php/1443521/Copy-Text-or-Image-into-or-out-of-SQL-Server.htm)”可能会有所帮助：

您可以将 TEXTCOPY 命令行工具集成到存储过程中：

```
CREATE PROCEDURE sp_textcopy (
  @srvname     varchar (30),
  @login       varchar (30),
  @password    varchar (30),
  @dbname      varchar (30),
  @tbname      varchar (30),
  @colname     varchar (30),
  @filename    varchar (30),
  @whereclause varchar (40),
  @direction   char(1))

AS

DECLARE @exec_str varchar (255)
SELECT @exec_str =
         'textcopy /S ' + @srvname +
         ' /U ' + @login +
         ' /P ' + @password +
         ' /D ' + @dbname +
         ' /T ' + @tbname +
         ' /C ' + @colname +
         ' /W "' + @whereclause +
         '" /F ' + @filename +
         ' /' + @direction
EXEC master..xp_cmdshell @exec_str 
```

您必须稍微更改/扩展它才能将创建的文件读入另一个数据库。

正如[Vinko](https://stackoverflow.com/users/5190/vinko-vrsalovic)在对此答案的评论中所写，请记住，这需要在表面区域配置中启用 xp_cmdshell。

**文本复制说明：**

*将单个文本或图像值复制到 SQL Server 中或从 SQL Server 中复制出来。该值是指定“表”的单行（由“where 子句”指定）的指定文本或图像“列”。*

*如果方向是 IN (/I)，则将指定“文件”中的数据复制到 SQL Server 中，替换现有的文本或图像值。如果方向是 OUT (/O)，则将文本或图像值从 SQL Server 复制到指定的“文件”中，替换任何现有文件。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-02T07:59:13.687

看看这个问题并在页面上搜索 bcp - 有 varbinary(max) 的导入和导出示例（这是此类列的新标准类型）。您可以运行任意查询以进行导出。

[如何使用 sql server management studio 将 blob 插入数据库](https://stackoverflow.com/questions/1643627/how-to-insert-a-blob-into-a-database-using-sql-server-management-studio)

# desktop - 签署桌面应用程序

> ID：271980
> 
> 赞同：3
> 
> 时间：2008-11-07T12:55:46.880
> 
> 标签：desktop

我想知道如何将桌面应用程序签名为我公司的产品。我不确定细节。我认为这个过程是我必须从像威瑞信这样的公司购买证书谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T12:59:29.043

您需要使用 Authenticode 证书对代码进行签名。

完整信息在这里：http: [//msdn.microsoft.com/en-us/library/ms537359 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms537359(VS.85).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T13:07:04.427

1.  申请 SPC。
2.  核实申请人的证件。
3.  生成并颁发软件发布者 X.509 证书。
4.  分发签名软件。

[资源](http://msdn.microsoft.com/en-us/library/ms537361(VS.85).aspx#Obtaining_Certificat)

# .net - 在 .NET 中获取 Windows XP 颜色

> ID：271992
> 
> 赞同：2
> 
> 时间：2008-11-07T13:01:06.840
> 
> 标签：.net, colors, systemcolors

我试图在我的 .NET 应用程序中获得 Windows XP 使用的特定颜色。

在 Windows XP 中，如果您进入“类别视图”中的控制面板，在左侧您有一些“另见”选项（Windows 更新、帮助和支持、其他控制面板选项）。我想要获得的颜色是这些选项后面显示的浅蓝色背景颜色。

我不需要颜色的十六进制/RGB 值，因为它可以根据桌面上使用的样式设置而改变。

**我的问题是 - 是否可以在 .NET 应用程序中以编程方式获取这种颜色？**

该颜色似乎不在 SystemColors 中，尽管它与 SystemColors.InactiveCaptionText 非常相似（我想我可能会使用它）。我只是想知道是否有办法获得确切的颜色。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T15:31:21.733

感谢坦伯格的提示

我在 System.Windows.Forms.VisualStyles 中找到了我需要的答案

我使用 VisualStyleRenderer 来绘制我需要的颜色。

如果有人感兴趣，我追求的颜色是 VisualStyleElement.ExplorerBar.NormalGroupBackground。 [见 msdn 页面](http://msdn.microsoft.com/en-us/library/system.windows.forms.visualstyles.visualstyleelement.explorerbar.normalgroupbackground(VS.80).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T13:38:01.367

快速猜测：[谷歌“VisualStyles.dll”](http://www.google.com/search?q=visualstyles.dll)，也许在[http://www.codeproject.com/KB/miscctrl/ThemedExplorerControls.aspx?display=Print的源代码中有提示](http://www.codeproject.com/KB/miscctrl/ThemedExplorerControls.aspx?display=Print)********************``*