# StackOverflow 问答 000235000-000235999

# algorithm - ACM 问题：抛硬币，帮我确定这是什么类型的问题

> ID：235003
> 
> 赞同：10
> 
> 时间：2008-10-24T19:40:30.687
> 
> 标签：algorithm

我正在为即将到来的 ACM 编程竞赛练习一周，但我被这个编程问题难住了。

**问题如下：**

* * *

你有一个由大小为 4 的方格组成的拼图。每个方格都有一个硬币；每枚硬币都显示正面 (H) 和反面 (T)。这里展示了一个这样的谜题：

> HHHH
> TTTT
> HTHT
> TTHT

当前显示为反面 (T) 的任何硬币都可以翻转为正面 (H)。然而，每当我们掷硬币时，我们也必须在同一行的上下左右翻转相邻的硬币。因此，如果我们翻转第二行中的第二个硬币，我们还必须翻转另外 4 个硬币，给我们这样的安排（改变的硬币以粗体显示）。

> H **T** HH
> **H** **H** **H** T
> H **H** HT
> TTHT

如果硬币在拼图的边缘，因此一侧或另一侧没有硬币，那么我们翻转的硬币就更少。我们不会“环绕”到另一边。例如，如果我们翻转上面排列的右下角硬币，我们会得到：

> HTHH
> HHHT
> HHH **H**
> T **T T** **H**

注意：只有显示（T）尾巴的硬币可以选择翻转。然而，每当我们翻转这样的硬币时，相邻的硬币也会被翻转，无论它们的状态如何。

谜题的目标是让所有硬币都出现正面。虽然某些安排可能没有解决方案，但所有给出的问题都会有解决方案。我们正在寻找的答案是，对于任何给定的 4x4 硬币网格，为了使网格完全正面，翻转的最少次数是多少。

例如网格：
HTHH
TTTH
HTHT
HHTT

这个网格的答案是：2 次翻转。

* * *

到目前为止我做了什么：

我将我们的网格存储为二维布尔数组。正面 = 真，反面 = 假。我有一个**flip(int row, int col)**方法，可以根据上述规则翻转相邻的硬币，我有一个**isSolved()**方法，可以确定拼图是否处于已解决状态（所有正面）。所以我们有我们的“机制”。

我们遇到的问题是我们应该如何循环，以最少的次数深入？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-24T19:58:18.530

您的拼图是经典的[广度优先搜索](http://en.wikipedia.org/wiki/Breadth-first_search)候选者。这是因为您正在寻找“移动”最少的解决方案。

如果您知道到达目标的移动次数，那么这将是[深度优先搜索](http://en.wikipedia.org/wiki/Depth-first_search)的理想选择。

这些 Wikipedia 文章包含大量有关搜索工作方式的信息，它们甚至包含多种语言的代码示例。

如果您确定不会用完堆栈空间，则任何一种搜索都可以是递归的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-24T19:46:47.070

**编辑：我没有注意到你不能使用硬币作为主要动作，除非它显示出反面。这确实使秩序变得重要。我将把这个答案留在这里，但也考虑再写一个。**

这里没有伪代码，但想一想：你能想象自己掷硬币两次吗？会有什么效果？

或者，写下一些任意板（字面意思，写下来）。设置一些真实世界的硬币，并选择两个任意的，X 和 Y。做一个“X 翻转”，然后一个“Y 翻转”，然后另一个“X 翻转”。写下结果。现在将电路板重置为初始版本，然后进行“Y 翻转”。比较结果，想想发生了什么。多试几次，有时 X 和 Y 靠得很近，有时不行。对你的结论充满信心。

这种思路应该会引导你找到一种方法来确定一组有限的*可能*解决方案。您可以相当容易地测试所有这些。

希望这个提示不是太明显 - 我会密切关注这个问题，看看您是否需要更多帮助。这是一个很好的谜题。

至于递归：你*可以*使用递归。就个人而言，我不会在这种情况下。

编辑：实际上，重新考虑我可能会使用递归。它可以让生活变得更简单。

* * *

好吧，也许这还不够明显。让我们将硬币标记为 AP，如下所示：

```
ABCD
EFGH
IJKL
MNOP 
```

翻转 F 将始终涉及以下硬币更改状态：BEFGJ。

翻转 J 将始终涉及以下硬币更改状态：FIJKN。

如果你掷硬币两次会发生什么？无论发生什么其他翻转，这两个翻转都会相互抵消。

换句话说，翻转 F 然后 J 与翻转 J 然后 F 相同。翻转 F 然后 J 然后 F 与翻转 J 开始相同。

因此，任何解决方案都不是真正的“翻转 A 然后 F 然后 J”的路径 - 它是“翻转 <这些硬币>；不要翻转 <这些硬币>”。（不幸的是，“翻转”这个词被用于翻转主要硬币和改变特定移动状态的辅助硬币，但没关系 - 希望我的意思很清楚。）

每个硬币将被用作或不用作主要移动，0 或 1。有 16 个硬币，所以有 2^16 种可能性。所以 0 可能代表“什么都不做”；1 可能代表“只是 A”；2 可能代表“只是 B”；3“A和B”等

测试每个组合。如果（不知何故）有多个解决方案，请计算每个解决方案中的位数以找到最少的数字。

实现提示：“当前状态”也可以表示为 16 位数字。使用特定硬币作为主要移动将始终将当前状态与固定数字（对于该硬币）进行异或。这使得计算任何特定动作组合的效果变得非常容易。

* * *

好的，这是 C# 中的解决方案。它显示了它找到的每个解决方案需要多少移动，但它不跟踪这些移动是哪些移动，或者移动的最少数量是多少。那是一个 SMOP :)

输入是一个列表，其中列出了哪些硬币开始出现反面 - 因此对于问题中的示例，您将使用“BEFGJLOP”参数启动程序。代码：

```
using System;

public class CoinFlip
{
    // All ints could really be ushorts, but ints are easier 
    // to work with
    static readonly int[] MoveTransitions = CalculateMoveTransitions();

    static int[] CalculateMoveTransitions()
    {
        int[] ret = new int[16];
        for (int i=0; i < 16; i++)
        {
            int row = i / 4;
            int col = i % 4;
            ret[i] = PositionToBit(row, col) +
                PositionToBit(row-1, col) +
                PositionToBit(row+1, col) +
                PositionToBit(row, col-1) +
                PositionToBit(row, col+1);
        }
        return ret;
    }

    static int PositionToBit(int row, int col)
    {
        if (row < 0 || row > 3 || col < 0 || col > 3)
        {
            // Makes edge detection easier
            return 0;
        }
        return 1 << (row * 4 + col);
    }

    static void Main(string[] args)
    {
        int initial = 0;
        foreach (char c in args[0])
        {
            initial += 1 << (c-'A');
        }
        Console.WriteLine("Initial = {0}", initial);
        ChangeState(initial, 0, 0);
    }

    static void ChangeState(int current, int nextCoin, int currentFlips)
    {
        // Reached the end. Success?
        if (nextCoin == 16)
        {
            if (current == 0)
            {
                // More work required if we want to display the solution :)
                Console.WriteLine("Found solution with {0} flips", currentFlips);
            }
        }
        else
        {
            // Don't flip this coin
            ChangeState(current, nextCoin+1, currentFlips);
            // Or do...
            ChangeState(current ^ MoveTransitions[nextCoin], nextCoin+1, currentFlips+1);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T00:27:13.823

正如其他人已经提到的，我建议进行广度优先搜索。

这里的大秘密是拥有多个游戏板副本。不要想到“董事会”。

我建议创建一个包含棋盘表示的数据结构，以及从起始位置到达该棋盘的有序移动列表。移动是一组翻转中中心硬币的坐标。我将在下面将此数据结构的一个实例称为“状态”。

我的基本算法看起来像这样：

```
Create a queue.
Create a state that contains the start position and an empty list of moves.
Put this state into the queue.
Loop forever:
    Pull first state off of queue.
    For each coin showing tails on the board:
        Create a new state by flipping that coin and the appropriate others around it.
        Add the coordinates of that coin to the list of moves in the new state.
        If the new state shows all heads:
            Rejoice, you are done.
        Push the new state into the end of the queue. 
```

如果您愿意，您可以对队列的长度或移动列表的长度添加限制，以选择放弃的地方。您还可以跟踪您已经看到的电路板以检测循环。如果队列清空并且您没有找到任何解决方案，则不存在。

此外，已经发表的一些评论似乎忽略了这样一个事实，即该问题仅允许显示尾巴的硬币处于移动中间。这意味着顺序非常重要。如果第一步将硬币从正面翻转到反面，那么该硬币可能是第二步的中心，但它不可能是第一步的中心。同样，如果第一步将硬币从反面翻转到正面，则该硬币不能成为第二步的中心，即使它可能是第一步的中心。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-24T20:19:21.747

以行优先顺序读取的网格只不过是一个 16 位整数。问题给出的网格*和*16 个可能的移动（或“生成器”）都可以存储为 16 位整数，因此问题相当于找到尽可能少的生成器数量，通过按位异或求和，得到网格结果。我想知道是否有比尝试所有 65536 种可能性更聪明的选择。

编辑：确实有一种方便的方法来进行暴力破解。您可以尝试所有 1 步模式，然后尝试所有 2 步模式，以此类推。当 n 步模式与网格匹配时，您可以停下来，展示获胜模式并说解决方案至少需要 n 步。枚举所有 n 步模式*是*一个递归问题。

EDIT2：您可以使用以下（可能是错误的）递归伪代码的方式进行暴力破解：

```
// Tries all the n bit patterns with k bits set to 1
tryAllPatterns(unsigned short n, unsigned short k, unsigned short commonAddend=0)
{
    if(n == 0)
        tryPattern(commonAddend);
    else
    {
        // All the patterns that have the n-th bit set to 1 and k-1 bits
        // set to 1 in the remaining
        tryAllPatterns(n-1, k-1, (2^(n-1) xor commonAddend) );

        // All the patterns that have the n-th bit set to 0 and k bits
        // set to 1 in the remaining
        tryAllPatterns(n-1, k,   commonAddend );
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T20:40:17.087

为了详细说明 Federico 的建议，问题在于找到一组 16 个生成器，它们一起异或给出起始位置。

但是，如果我们将每个生成器视为整数模 2 的向量，这就变成了找到向量的线性组合，它等于起始位置。解决这个问题应该只是高斯消除（mod 2）的问题。

编辑：再想一想之后，我认为这会起作用：构建所有生成器的二进制矩阵`G`，并让`s`成为起始状态。我们正在寻找`x`满足`Gx=s`（mod 2）的向量。进行高斯消元后，我们要么得到这样的向量，`x`要么发现没有解。

然后问题是找到`y`这样的向量，`Gy = 0`并且`x^y`设置尽可能少的位，我认为找到它的最简单方法是尝试所有这些`y`。由于它们只依赖于`G`，因此可以预先计算它们。

不过，我承认蛮力搜索会更容易实现。=)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-25T09:10:42.750

好的，现在我已经正确阅读了规则，这是一个答案:)

这是使用状态队列和到达那里所采取的动作的广度优先搜索。它不会尝试阻止循环，但是您必须指定要尝试的最大迭代次数，因此它不能永远持续下去。

这个实现创建了*很多*字符串——一个不可变的移动链接列表在这方面会更整洁，但我现在没有时间。

```
using System;
using System.Collections.Generic;

public class CoinFlip
{
    struct Position
    {
        readonly string moves;
        readonly int state;

        public Position(string moves, int state)
        {
            this.moves = moves;
            this.state = state;
        }

        public string Moves { get { return moves; } } 
        public int State { get { return state; } }

        public IEnumerable<Position> GetNextPositions()
        {
            for (int move = 0; move < 16; move++)
            {
                if ((state & (1 << move)) == 0)
                {                    
                    continue; // Not allowed - it's already heads
                }
                int newState = state ^ MoveTransitions[move];
                yield return new Position(moves + (char)(move+'A'), newState);
            }
        }
    }

    // All ints could really be ushorts, but ints are easier 
    // to work with
    static readonly int[] MoveTransitions = CalculateMoveTransitions();

    static int[] CalculateMoveTransitions()
    {
        int[] ret = new int[16];
        for (int i=0; i < 16; i++)
        {
            int row = i / 4;
            int col = i % 4;
            ret[i] = PositionToBit(row, col) +
                PositionToBit(row-1, col) +
                PositionToBit(row+1, col) +
                PositionToBit(row, col-1) +
                PositionToBit(row, col+1);
        }
        return ret;
    }

    static int PositionToBit(int row, int col)
    {
        if (row < 0 || row > 3 || col < 0 || col > 3)
        {
            return 0;
        }
        return 1 << (row * 4 + col);
    }

    static void Main(string[] args)
    {
        int initial = 0;
        foreach (char c in args[0])
        {
            initial += 1 << (c-'A');
        }

        int maxDepth = int.Parse(args[1]);

        Queue<Position> queue = new Queue<Position>();
        queue.Enqueue(new Position("", initial));

        while (queue.Count != 0)
        {
            Position current = queue.Dequeue();
            if (current.State == 0)
            {
                Console.WriteLine("Found solution in {0} moves: {1}",
                                  current.Moves.Length, current.Moves);
                return;
            }
            if (current.Moves.Length == maxDepth)
            {
                continue;
            }
            // Shame Queue<T> doesn't have EnqueueRange :(
            foreach (Position nextPosition in current.GetNextPositions())
            {
                queue.Enqueue(nextPosition);
            }
        }
        Console.WriteLine("No solutions");
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-13T17:58:24.550

如果您正在为 ACM 练习，我会考虑这个难题也适用于非平凡的板，比如 1000x1000。蛮力/贪婪可能仍然有效，但要小心避免指数爆炸。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-02-24T16:25:36.417

这是经典的“熄灯”问题。实际上有一个简单的`O(2^N)`蛮力解决方案，其中`N`是宽度或高度，以较小者为准。

让我们假设以下适用于宽度，因为您可以转置它。

一个观察结果是您不需要按两次相同的按钮 - 它只是取消。

关键概念只是您只需要确定是否要为第一行的每个项目按下按钮。每隔一个按钮按下由一件事唯一决定 - 所考虑按钮上方的灯是否亮起。如果您正在查看 cell `(x,y)`，并且 cell`(x,y-1)`处于打开状态，则只有一种方法可以将其关闭，即按`(x,y)`。从上到下遍历行，如果最后没有灯亮，你就有了解决方案。然后，您可以采取所有尝试的最小值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-24T20:44:39.573

这是一个[有限状态机](http://en.wikipedia.org/wiki/Finite_state_machine)，其中每个“状态”是对应每个硬币价值的 16 位整数。

每个状态有 16 个出站转换，对应于你抛硬币后的状态。

绘制出所有状态和转换后，您必须在图中找到从开始状态到状态 1111 1111 1111 1111 的最短路径，

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-10-14T13:44:44.183

我坐下来尝试自己解决这个问题（基于我在这个线程中收到的帮助）。我使用的是一个二维布尔数组，所以它不如使用 16 位整数和位操作的人好。

无论如何，这是我在 Java 中的解决方案：

```
import java.util.*;

class Node
{
    public boolean[][] Value;
    public Node Parent;

    public Node (boolean[][] value, Node parent)
    {
        this.Value = value;
        this.Parent = parent;
    }
}

public class CoinFlip
{
    public static void main(String[] args)
    {
        boolean[][] startState =  {{true, false, true, true},
                                   {false, false, false, true},
                                   {true, false, true, false},
                                   {true, true, false, false}};

        List<boolean[][]> solutionPath = search(startState);

        System.out.println("Solution Depth: " + solutionPath.size());
        for(int i = 0; i < solutionPath.size(); i++)
        {
            System.out.println("Transition " + (i+1) + ":");
            print2DArray(solutionPath.get(i));
        }

    }

    public static List<boolean[][]> search(boolean[][] startState)
    {
        Queue<Node> Open = new LinkedList<Node>();
        Queue<Node> Closed = new LinkedList<Node>();

        Node StartNode = new Node(startState, null);
        Open.add(StartNode);

          while(!Open.isEmpty())
          {
              Node nextState = Open.remove();

              System.out.println("Considering: ");
              print2DArray(nextState.Value);

              if (isComplete(nextState.Value))
              {
                  System.out.println("Solution Found!");
                  return constructPath(nextState);
              }
              else
              {
                List<Node> children = generateChildren(nextState);
                Closed.add(nextState);

                for(Node child : children)
                {
                    if (!Open.contains(child))
                        Open.add(child);
                }
              }

          }

          return new ArrayList<boolean[][]>();

    }

    public static List<boolean[][]> constructPath(Node node)
    {
        List<boolean[][]> solutionPath = new ArrayList<boolean[][]>();

        while(node.Parent != null)
        {
            solutionPath.add(node.Value);
            node = node.Parent;
        }
        Collections.reverse(solutionPath);

        return solutionPath;
    }

    public static List<Node> generateChildren(Node parent)
    {
        System.out.println("Generating Children...");
        List<Node> children = new ArrayList<Node>();

        boolean[][] coinState = parent.Value;

        for(int i = 0; i < coinState.length; i++)
        {
            for(int j = 0; j < coinState[i].length; j++)
            {
                if (!coinState[i][j])
                {
                    boolean[][] child = arrayDeepCopy(coinState);
                    flip(child, i, j);
                    children.add(new Node(child, parent));

                }
            }
        }

        return children;
    }

    public static boolean[][] arrayDeepCopy(boolean[][] original)
    {
         boolean[][] r = new boolean[original.length][original[0].length];
         for(int i=0; i < original.length; i++)
                 for (int j=0; j < original[0].length; j++)
                       r[i][j] = original[i][j];

         return r;
    }

    public static void flip(boolean[][] grid, int i, int j)
    {
        //System.out.println("Flip("+i+","+j+")");
        // if (i,j) is on the grid, and it is tails
        if ((i >= 0 && i < grid.length) && (j >= 0 && j <= grid[i].length))
        {
            // flip (i,j)
            grid[i][j] = !grid[i][j];
            // flip 1 to the right
            if (i+1 >= 0 && i+1 < grid.length) grid[i+1][j] = !grid[i+1][j];
            // flip 1 down
            if (j+1 >= 0 && j+1 < grid[i].length) grid[i][j+1] = !grid[i][j+1];
            // flip 1 to the left
            if (i-1 >= 0 && i-1 < grid.length) grid[i-1][j] = !grid[i-1][j];
            // flip 1 up
            if (j-1 >= 0 && j-1 < grid[i].length) grid[i][j-1] = !grid[i][j-1];
        }
    }

    public static boolean isComplete(boolean[][] coins)
    {
        boolean complete = true;

        for(int i = 0; i < coins.length; i++)
        {
            for(int j = 0; j < coins[i].length; j++)
            {
                if (coins[i][j] == false) complete = false; 
            }

        }
        return complete;
    }

    public static void print2DArray(boolean[][] array) 
    {
        for (int row=0; row < array.length; row++) 
        {
            for (int col=0; col < array[row].length; col++)
            {
                System.out.print((array[row][col] ? "H" : "T") + " ");
            }
            System.out.println();
        }
    }

} 
```

# frameworks - 什么是脚手架？它是特定平台的术语吗？

> ID：235018
> 
> 赞同：117
> 
> 时间：2008-10-24T19:46:15.403
> 
> 标签：frameworks, code-generation, crud, scaffolding

脚手架，是什么？它是 Rails 独有的吗？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-10-24T19:48:22.620

脚手架通常是指为应用程序快速设置的骨架。它不是唯一的，因为其他平台也有它。它通常也不意味着是“最终”系统。只是第一种，最小的方法。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-10-24T19:47:54.243

来自[维基百科](http://en.wikipedia.org/wiki/Scaffold_(programming))：

> 脚手架是一种构建数据库支持的软件应用程序的元编程方法。它是一些模型-视图-控制器框架支持的技术，程序员可以在其中编写描述如何使用应用程序数据库的规范。编译器使用此规范生成应用程序可用于创建、读取、更新和删除数据库条目的代码，有效地将模板视为构建更强大应用程序的“支架”。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2017-01-15T06:05:47.650

就像建筑工地中的真正[脚手架](https://en.wikipedia.org/wiki/Scaffolding)`scaffolding`一样，为您的项目 提供某种（**快速**、**简化**、**临时**）**结构**，您可以依靠它来构建***真正的***项目。

它可以（并且现在）用于描述许多事情——从抽象 DB 层到 Web 应用程序文件夹结构，再到生成和管理项目依赖项。

它**不是**特定于任何语言/技术的东西，就像术语一样，`skeleton`或者`boilerplate`与平台无关。

它只是从[真正的脚手架](https://www.google.com.hk/search?newwindow=1&biw=1821&bih=908&tbm=isch&sa=1&q=scaffolding&oq=scaffolding&gs_l=img.3...3468.3468.0.3971.1.1.0.0.0.0.0.0..0.0....0...1c.1.64.img..1.0.0.GsIVz5OnV-w)借来的一个术语（如上所述）。您构建一些快速、简化的（有时是外部的，有时是临时的）结构，它将帮助您在该临时结构的下方、上方、内部或外部构建真正的、更复杂的、最终确定的结构。

.. 就像真正的脚手架一样，脚手架结构旨在支持项目的**构建过程**，而不是**项目本身**（有一些例外）。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2008-10-24T19:48:10.420

支架通常是某种类型的代码生成，您将其指向数据库，并且该技术创建基本的 CRUD（创建、读取、更新、删除）屏幕。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2016-10-12T20:13:48.493

我相信[维基百科](https://en.wikipedia.org/wiki/Scaffold_%28programming%29)和这里的一些答案提供了一个狭隘和受限的观点。脚手架**不仅**适用于数据库之上的 CRUD 操作。Scaffolding 有一个更广泛的目标，即为您提供适用于**任何**技术的框架应用程序。

[Yeoman](http://yeoman.io/)是一种现代且有用的**脚手架**工具。用他们自己的话：

> # 用于现代 webapps 的 web 脚手架工具
> 
> **什么是约曼？**
> 
> Yeoman 帮助您启动新项目，提供最佳实践和工具来帮助您保持生产力。
> 
> 为此，我们提供了一个生成器生态系统。生成器基本上是一个插件，可以使用`yo`命令运行来搭建完整的项目或有用的部分。
> 
> 通过我们的官方生成器，我们推广“Yeoman 工作流程”。这个工作流是一个健壮且固执己见的客户端堆栈，包含可以帮助开发人员快速构建漂亮 Web 应用程序的工具和框架。我们负责提供入门所需的一切，而不会出现与手动设置相关的任何正常问题。
> 
> 借助可以开箱即用的模块化架构，我们利用从多个开源社区获得的成功和经验教训，确保开发人员使用的堆栈尽可能智能。
> 
> 作为良好文档和经过深思熟虑的构建过程的坚定信徒，Yeoman 包括对 linting、测试、缩小等的支持，因此开发人员可以专注于解决方案，而不是担心小事。

而已。使用脚手架创建快速启动应用程序，作为示例或解决方案的基础。它可以让你更快地从头开始构建东西。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-10-24T19:49:52.353

尽管我认为它起源于那里（至少我第一次听到它的地方），但它并不是唯一的 Rails 术语。

Scaffolding 是一个框架，它允许您使用很少或没有代码对数据库执行基本的 CRUD 操作。通常，您然后通过并添加代码以按照您想要替换脚手架的方式管理数据。它通常只是为了让您快速启动和运行。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-07-12T15:06:10.143

> 不，它也用于其他技术，例如 ASP.NET MVC

它从程序员在几乎每个项目中使用的一些预定义代码创建一个基本布局，例如：对于数据库数据访问，它可以为创建、读取、更新、删除操作创建一个 crud 方法，或者您可以使用它来为您的视图创建布局/ html代码

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-11-29T18:36:37.123

Scaffolding is writing any piece of code that would not be part of the business logic but would help in unit testing and integration testing.

This is a software engineering term and not bound to any framework or programming language.

# unit-testing - 为什么单元测试应该只测试一件事？

> ID：235025
> 
> 赞同：64
> 
> 时间：2008-10-24T19:48:02.123
> 
> 标签：unit-testing

[什么是好的单元测试？](/questions/61400/what-makes-a-good-unit-test)说测试应该只测试一件事。这样做有什么好处？

编写更大的测试来测试更大的代码块不是更好吗？调查测试失败无论如何都很难，我看不到较小的测试对它有帮助。

编辑：单词单元不是那么重要。假设我认为单位更大一些。这不是这里的问题。真正的问题是，为什么要对所有方法进行一个或多个测试，因为覆盖许多方法的少数测试更简单。

一个例子：一个列表类。为什么要对添加和删除进行单独测试？首先添加然后删除的一个测试听起来更简单。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-10-24T19:50:04.210

只测试一件事将隔离一件事并证明它是否有效。这就是单元测试的想法。测试不止一件事的测试没有错，但这通常被称为集成测试。根据上下文，它们都有优点。

举个例子，如果您的床头灯没有打开，而您更换灯泡并切换延长线，您不知道哪个更改解决了这个问题。应该进行单元测试，并分离您的关注点以隔离问题。

更新：我读了这篇文章和链接的文章，我得说，我很震惊：[https ://techbeacon.com/app-dev-testing/no-1-unit-testing-best-practice-stop-doing-it](https://techbeacon.com/app-dev-testing/no-1-unit-testing-best-practice-stop-doing-it)

这里有物质，它让精神汁液流动。但我认为这与我们应该进行上下文要求的测试的原始情绪相吻合。我想我只是补充说我们需要更接近确定在系统上进行不同测试的好处，而不是交叉手指的方法。测量/量化和所有好东西。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2008-10-24T20:00:43.937

我将在这里冒险，并说“只测试一件事”的建议并不像有时被证明的那样真正有用。

有时测试需要进行一定的设置。有时他们甚至可能需要一定的*时间*来设置（在现实世界中）。通常你可以一次测试两个动作。

优点：所有设置只发生一次。您在第一次行动之后的测试将证明世界是您在第二次行动之前所期望的样子。更少的代码，更快的测试运行。

缺点：如果*任*一操作失败，您将得到相同的结果：相同的测试将失败。与在两个测试中的每一个中只有一个操作相比，您将获得更少的关于问题所在的信息。

实际上，我发现这里的“骗局”并不是什么大问题。堆栈跟踪通常会很快缩小范围，无论如何我都会确保修复代码。

这里稍微不同的“缺点”是它打破了“编写新测试，使其通过，重构”循环。我认为这是一个*理想*的周期，但并不总是反映现实。有时，在当前测试中添加额外的动作和检查（或者可能只是对现有动作的另一次检查）比创建新的更实用。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-24T19:50:37.407

通常不推荐检查不止一件事的测试，因为它们耦合更紧密且脆弱。如果您更改代码中的某些内容，则更改测试将花费更长的时间，因为要考虑的事情更多。

[编辑：]好的，说这是一个示例测试方法：

```
[TestMethod]
public void TestSomething() {
  // Test condition A
  // Test condition B
  // Test condition C
  // Test condition D
} 
```

如果您对条件 A 的测试失败，那么 B、C 和 D 似乎也会失败，并且不会为您提供任何用处。如果您的代码更改也会导致 C 失败怎么办？如果您将它们分成 4 个单独的测试，您就会知道这一点。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-24T20:00:36.043

哈……单元测试。

将任何“指令”推得太远，它很快就会变得无法使用。

单一单元测试测试单一事物就像单一方法完成单一任务一样好。但是恕我直言，这并不意味着单个测试只能包含单个断言语句。

是

```
@Test
public void checkNullInputFirstArgument(){...}
@Test
public void checkNullInputSecondArgument(){...}
@Test
public void checkOverInputFirstArgument(){...}
... 
```

好于

```
@Test
public void testLimitConditions(){...} 
```

在我看来，这是品味问题，而不是良好做法。我个人更喜欢后者。

但

```
@Test
public void doesWork(){...} 
```

实际上是“指令”希望你不惜一切代价避免的，也是最快消耗我理智的东西。

作为最后的结论，将语义相关且易于测试的事物组合在一起，以便失败的测试消息本身实际上足以让您直接进入代码。

**关于失败的测试报告的经验法则：如果您必须先阅读测试的代码，那么您的测试结构不够好，需要更多地拆分成更小的测试。**

我的 2 美分。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-21T15:34:56.640

想想造一辆汽车。如果您要应用您的理论，即只是测试大型事物，那么为什么不进行测试以驾驶汽车穿越沙漠。它崩溃了。好的，所以告诉我是什么导致了问题。你不能。那是一个场景测试。

功能测试可能是打开引擎。它失败。但这可能是由于多种原因。你仍然不能告诉我到底是什么导致了这个问题。不过我们越来越近了。

单元测试更具体，首先会确定代码在哪里出错，但它也将（如果进行适当的 TDD）帮助将您的代码构建成清晰的模块化块。

有人提到使用堆栈跟踪。忘了它。那是第二个手段。遍历堆栈跟踪或使用调试是一件痛苦的事情，而且可能很耗时。特别是在较大的系统和复杂的错误上。

单元测试的良好特性：

*   快速（毫秒）
*   独立的。它不受或依赖于其他测试
*   清除。它不应该臃肿，或者包含大量的设置。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-24T20:08:51.097

使用测试驱动开发，您将首先编写测试，然后编写代码以通过测试。如果您的测试有重点，这会使编写代码以通过测试更容易。

例如，我可能有一个带有参数的方法。我可能首先想到的一件事是，如果参数为 null 会发生什么？它应该抛出一个 ArgumentNull 异常（我认为）。所以我写了一个测试来检查当我传递一个空参数时是否抛出了那个异常。运行测试。好的，它抛出 NotImplementedException。我通过更改代码以引发 ArgumentNull 异常来解决这个问题。运行我的测试它通过了。然后我想，如果它太小或太大会发生什么？啊，这是两个测试。我先写太小的案例。

关键是我不会一下子想到方法的行为。我通过思考它应该做什么来逐步（和合乎逻辑地）构建它，然后在我开始时实现代码和重构以使其看起来漂亮（优雅）。这就是为什么测试应该小而有重点的原因，因为当您考虑行为时，您应该以可理解的小增量进行开发。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-25T00:04:46.237

仅验证一件事的测试使故障排除更容易。这并不是说您不应该有测试多个事物的测试，或者共享相同设置/拆卸的多个测试。

这里应该是一个说明性的例子。假设您有一个带有查询的堆栈类：

*   获取大小
*   是空的
*   顶部

和改变堆栈的方法

*   推（一个对象）
*   流行音乐（）

现在，考虑下面的测试用例（我在这个例子中使用 Python 之类的伪代码。）

```
class TestCase():
    def setup():
        self.stack = new Stack()
    def test():
        stack.push(1)
        stack.push(2)
        stack.pop()
        assert stack.top() == 1, "top() isn't showing correct object"
        assert stack.getSize() == 1, "getSize() call failed" 
```

从这个测试用例中，您可以确定是否有问题，但不能确定它是否与`push()`or`pop()`实现或返回值的查询隔离：`top()`和`getSize()`.

如果我们为每种方法及其行为添加单独的测试用例，事情就会变得更容易诊断。此外，通过对每个测试用例进行全新设置，我们可以保证问题完全在失败的测试方法调用的方法中。

```
def test_size():
    assert stack.getSize() == 0
    assert stack.isEmpty()

def test_push():
    self.stack.push(1)
    assert stack.top() == 1, "top returns wrong object after push"
    assert stack.getSize() == 1, "getSize wrong after push"

def test_pop():
    stack.push(1)
    stack.pop()
    assert stack.getSize() == 0, "getSize wrong after push" 
```

就测试驱动开发而言。我个人编写更大的“功能测试”，首先测试多种方法，然后在我开始实现各个部分时创建单元测试。

另一种看待它的方式是单元测试验证每个单独方法的契约，而更大的测试验证对象和整个系统必须遵循的契约。

我仍在使用三个方法调用`test_push`，但是两者`top()`都是`getSize()`由单独的测试方法测试的查询。

您可以通过向单个测试添加更多断言来获得类似的功能，但随后的断言失败将被隐藏。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-09-08T10:01:55.617

如果您要测试的东西不止一个，那么它被称为集成测试……而不是单元测试。您仍然可以在与单元测试相同的测试框架中运行这些集成测试。

集成测试通常较慢，单元测试较快，因为所有依赖项都是模拟/伪造的，因此没有数据库/Web 服务/慢速服务调用。

我们在提交到源代码控制时运行我们的单元测试，而我们的集成测试只在夜间构建中运行。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-24T19:51:30.353

如果您测试了多个事物并且您测试的第一个事物失败了，那么您将不知道您正在测试的后续事物是通过还是失败。当你知道一切都会失败时，更容易修复。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-24T20:01:25.807

GLib，但希望仍然有用，答案是 unit = one。如果你测试不止一件事，那么你就不是单元测试。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-24T20:15:30.147

较小的单元测试可以更清楚地说明问题出在哪里。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-24T20:57:10.203

关于您的示例：如果您在同一个单元测试中测试添加和删除，您如何验证该项目是否已添加到您的列表中？这就是为什么您需要添加并验证它是在一个测试中添加的。

或者以灯为例：如果你想测试你的灯并且你所做的只是打开然后关闭开关，你怎么知道灯曾经打开过？您必须在两者之间采取步骤来查看灯并确认它已打开。然后您可以将其关闭并验证它是否已关闭。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-04T13:10:19.377

我支持单元测试应该只测试一件事的想法。我也偏离了很多。今天我有一个测试，昂贵的设置似乎迫使我在每个测试中做出多个断言。

```
namespace Tests.Integration
{
  [TestFixture]
  public class FeeMessageTest
  {
    [Test]
    public void ShouldHaveCorrectValues
    {
      var fees = CallSlowRunningFeeService();
      Assert.AreEqual(6.50m, fees.ConvenienceFee);
      Assert.AreEqual(2.95m, fees.CreditCardFee);
      Assert.AreEqual(59.95m, fees.ChangeFee);
    }
  }
} 
```

同时，我真的很想看到我所有失败的断言，而不仅仅是第一个。我期待他们都失败，我需要知道我真正得到了多少。但是，每个测试划分的标准 [SetUp] 会导致对慢速服务的 3 次调用。突然我想起了一篇文章，它暗示使用“非常规”测试结构是隐藏单元测试一半好处的地方。（我认为这是 Jeremy Miller 的帖子，但现在找不到了。）突然想到 [TestFixtureSetUp]，我意识到我可以进行一次服务调用，但仍然有单独的、富有表现力的测试方法。

```
namespace Tests.Integration
{
  [TestFixture]
  public class FeeMessageTest
  {
    Fees fees;
    [TestFixtureSetUp]
    public void FetchFeesMessageFromService()
    {
      fees = CallSlowRunningFeeService();
    }

    [Test]
    public void ShouldHaveCorrectConvenienceFee()
    {
      Assert.AreEqual(6.50m, fees.ConvenienceFee);
    }

    [Test]
    public void ShouldHaveCorrectCreditCardFee()
    {
      Assert.AreEqual(2.95m, fees.CreditCardFee);
    }

    [Test]
    public void ShouldHaveCorrectChangeFee()
    {
      Assert.AreEqual(59.95m, fees.ChangeFee);
    }
  }
} 
```

此测试中有更多代码，但它通过一次向我显示所有不符合预期的值来提供更多价值。

一位同事还指出，这有点像 Scott Bellware 的[specunit.net：http://code.google.com/p/specunit-net/](http://code.google.com/p/specunit-net/)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-04T13:24:01.017

非常细化的单元测试的另一个实际缺点是它违反了[DRY 原则](http://en.wikipedia.org/wiki/Don't_repeat_yourself#Teaching_DRY_coding_skills)。我从事的项目的规则是类的每个公共方法都必须有一个单元测试（[TestMethod]）。显然，每次创建公共方法时都会增加一些开销，但真正的问题是它为重构增加了一些“摩擦”。

它类似于方法级别的文档，拥有它很好，但它是另一件必须维护的东西，它使更改方法签名或名称变得更加麻烦，并减慢“floss 重构”（如[“重构工具：适用于目的”](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.139.191&rep=rep1&type=pdf)，由 Emerson Murphy-Hill 和 Andrew P. Black 撰写。PDF，1.3 MB）。

就像设计中的大多数事情一样，“测试应该只测试一件事”这句话没有捕捉到一个权衡。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-02-27T23:17:48.727

当测试失败时，有三个选项：

1.  实现被破坏了，应该被修复。
2.  测试坏了，应该修复。
3.  不再需要该测试，应将其删除。

*具有描述性名称*的细粒度测试可以帮助读者了解编写测试的*原因*，从而更容易知道选择上述哪个选项。测试的名称应该描述测试指定的行为 - 并且*每个测试只有一个行为*- 这样只需阅读测试的名称，读者就会知道系统做了什么。有关更多信息，请参阅[本文](http://blog.orfjackal.net/2010/02/three-styles-of-naming-tests.html)。

另一方面，如果一个测试做了很多不同的事情并且它有一个非描述性的名称（例如在实现中以方法命名的测试），那么很难找出测试背后的动机，并且很难知道何时以及如何更改测试。

当每个测试只测试一件事时，这是它的样子（使用[GoSpec ）：](http://github.com/orfjackal/gospec)

```
func StackSpec(c gospec.Context) {
  stack := NewStack()

  c.Specify("An empty stack", func() {

    c.Specify("is empty", func() {
      c.Then(stack).Should.Be(stack.Empty())
    })
    c.Specify("After a push, the stack is no longer empty", func() {
      stack.Push("foo")
      c.Then(stack).ShouldNot.Be(stack.Empty())
    })
  })

  c.Specify("When objects have been pushed onto a stack", func() {
    stack.Push("one")
    stack.Push("two")

    c.Specify("the object pushed last is popped first", func() {
      x := stack.Pop()
      c.Then(x).Should.Equal("two")
    })
    c.Specify("the object pushed first is popped last", func() {
      stack.Pop()
      x := stack.Pop()
      c.Then(x).Should.Equal("one")
    })
    c.Specify("After popping all objects, the stack is empty", func() {
      stack.Pop()
      stack.Pop()
      c.Then(stack).Should.Be(stack.Empty())
    })
  })
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-07-24T14:17:30.737

> 真正的问题是，为什么要对所有方法进行一个或多个测试，因为覆盖许多方法的少数测试更简单。

好吧，这样当某些测试失败时，您就会知道哪个方法失败了。

当您必须修理一辆无法正常工作的汽车时，如果您知道发动机的哪个部分出现故障，那就更容易了。

> 一个例子：一个列表类。为什么要对添加和删除进行单独测试？首先添加然后删除的一个测试听起来更简单。

假设添加方法坏了不加，去除方法坏了不去除。您的测试将检查列表在添加和删除后是否与最初的大小相同。您的测试将成功。尽管您的两种方法都会被破坏。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-03-16T11:55:27.040

免责声明：这是一个深受“xUnit 测试模式”一书影响的答案。

在每次测试中只测试一件事是提供以下好处的最基本原则之一：

*   **缺陷本地化**：如果测试失败，您会立即知道失败的原因（如果您对所使用的断言做得很好，最好无需进一步故障排除）。
*   **测试作为规范**：测试不仅作为安全网，而且可以很容易地用作规范/文档。例如，开发人员应该能够阅读单个组件的单元测试并理解它的 API/合同，而无需阅读实现（利用封装的好处）。
*   **TDD 的不可行性**：TDD 基于具有小块功能并完成（编写失败的测试、编写代码、验证测试成功）的渐进式迭代。如果测试必须验证多项内容，则此过程会受到高度干扰。
*   **缺乏副作用**：与第一个有点相关，但是当一个测试验证多个事物时，它更有可能与其他测试相关联。因此，这些测试可能需要有一个共享的测试夹具，这意味着一个会受到另一个的影响。因此，最终您可能有一个测试失败，但实际上另一个测试是导致失败的测试，例如通过更改夹具数据。

我只能看到一个原因，您可能会从验证多个事物的测试中受益，但这实际上应该被视为代码异味：

*   **性能优化**：在某些情况下，您的测试不仅在内存中运行，而且还依赖于持久存储（例如数据库）。在其中一些情况下，让测试验证多个事物可能有助于减少磁盘访问次数，从而减少执行时间。但是，理想情况下，单元测试应该只能在内存中执行，所以如果你偶然发现这种情况，你应该重新考虑你是否走错了路。在单元测试中，所有持久依赖项都应替换为模拟对象。端到端功能应该由不同的集成测试套件覆盖。通过这种方式，您不再需要关心执行时间，因为集成测试通常由构建管道执行，而不是由开发人员执行，

# delphi - 为什么调用 .Free 后还要分配 Delphi 对象？

> ID：235033
> 
> 赞同：24
> 
> 时间：2008-10-24T19:50:09.560
> 
> 标签：delphi

在Delphi中，为什么调用析构函数后Assigned()函数仍然返回True？

下面的示例代码将“sl is still assigned”写入控制台。

但是，我可以调用 FreeAndNil(sl); 它不会被分配。

我在 Delphi 中编程已经有一段时间了，但这对我来说从来没有意义。

有人可以解释吗？

```
program Project1;
{$APPTYPE CONSOLE}
uses SysUtils, Classes;

var
  sl : TStringList;

begin
  sl := TStringList.Create;
  sl.Free;
  if Assigned(sl) then
    WriteLn('sl is still assigned')
  else
    WriteLn('sl is not assigned');
end. 
```

我尝试比较 VCL 操作...... FreeAndNil 简短而甜蜜且有意义：

```
procedure FreeAndNil(var Obj);
var
  P: TObject;
begin
  P := TObject(Obj);
  TObject(Obj) := nil;  // clear the reference before destroying the object
  P.Free;
end; 
```

但是 TObject.Free 在神秘的汇编程序中，我不明白：

```
procedure TObject.Free;
asm
        TEST    EAX,EAX
        JE      @@exit
        MOV     ECX,[EAX]
        MOV     DL,1
        CALL    dword ptr [ECX].vmtDestroy
@@exit:
end; 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-24T19:51:44.813

如果使用 sl.Free，则对象被释放，但变量 sl 仍然指向现在无效的内存。

使用 FreeAndNil(sl) 释放对象并清除指针。

顺便说一句，如果你这样做：

```
var
  sl1, sl2: TStringList;
begin
  sl1 := TStringList.Create;
  sl2 := sl1;
  FreeAndNil(sl1);
  // sl2 is still assigned and must be cleared separately (not with FreeAndNil because it points to the already freed object.)
end;

procedure TObject.Free;
asm
    TEST    EAX,EAX
    JE      @@exit              // Jump to exit if pointer is nil.
    MOV     ECX,[EAX]           
    MOV     DL,1
    CALL    dword ptr [ECX].vmtDestroy  // Call cleanup code (and destructor).
@@exit:
end; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-24T19:59:51.630

Delphi VCL 的“对象”实际上总是指向对象的指针，但是这方面通常对您隐藏。仅释放对象会使指针悬空，因此您应该改用 FreeAndNil。

“神秘的汇编程序”大致翻译为：

```
if Obj != NIL then
  vmtDestroy(obj);  // which is basically the destructor/deallocator. 
```

因为 Free 首先检查 NIL，所以多次调用 FreeAndNil 是安全的......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-09-08T17:08:33.173

TObject 的 Free 方法就像 C++ 中的“删除操作符”。调用 free 将首先调用 Destroy 函数，然后它会释放为对象分配的内存块。默认情况下，指向内存的指针不会设置为零，因为这将用完一条指令。

在大多数情况下，正确的做法是不要将指针设置为零，因为在大多数情况下这无关紧要。但是，有时它很重要，因此对于这些情况，您应该只使用 nil 指针。

例如。在创建对象然后在函数末尾释放的函数中，将变量设置为零是没有意义的，因为这只是在浪费 CPU 时间。

但是对于以后可能再次引用的全局对象或字段，您应该将其设置为零。使用 FreeAndNil 或只是自己将指针设置为 nil，没关系。但要远离默认情况下不需要归零的变量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-09-25T18:17:45.217

我们有简单的规则：

1.  如果你想用它`Assigned()`来检查一个对象`Obj`是否已经被创建，那么确保你用`FreeAndNil(Obj)`它来释放它。

2.  `Assigned()`只说是否分配了地址。

3.  本地对象引用总是被分配一个垃圾地址（一些随机地址），所以在使用它之前最好将它设置为 nil。

示例：（这不是完整的代码）

```
{Opened a new VCL application, placed a Button1, Memo1 on the form
Next added a public reference GlobalButton of type TButton
Next in OnClick handler of Button1 added a variable LocalButton 
Next in body, check if GlobalButton and LocalButton are assigned}

  TForm2 = class(TForm)
    Button1: TButton;
    Memo1: TMemo;
    procedure Button1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
    GlobalButton: TButton;
  end;

procedure TForm2.Button1Click(Sender: TObject);
var
  LocalButton: TButton;
begin
  if Assigned(GlobalButton) then  
    Memo1.Lines.Add('GlobalButton assigned');
  if Assigned(LocalButton) then  
    Memo1.Lines.Add('LocalButton assigned');
end; 
```

# java - 为什么将 50,000 个对象插入 HashMap 时出现 OutOfMemoryError？

> ID：235047
> 
> 赞同：14
> 
> 时间：2008-10-24T19:53:40.100
> 
> 标签：java, hashmap, out-of-memory

我正在尝试将大约 50,000 个对象（因此 50,000 个键）插入到`java.util.HashMap<java.awt.Point, Segment>`. 但是，我不断收到 OutOfMemory 异常。（`Segment`是我自己的课-重量很轻-一个`String`字段和3个`int`字段）。

```
线程“主”java.lang.OutOfMemoryError 中的异常：Java 堆空间
    在 java.util.HashMap.resize(HashMap.java:508)
    在 java.util.HashMap.addEntry(HashMap.java:799)
    在 java.util.HashMap.put(HashMap.java:431)
    在 bus.tools.UpdateMap.putSegment(UpdateMap.java:168)
```

这似乎很荒谬，因为我看到机器上有大量可用内存——在可用 RAM 和用于虚拟内存的 HD 空间中。

Java 是否可能在一些严格的内存要求下运行？我可以增加这些吗？

有一些奇怪的限制`HashMap`吗？我将不得不实施我自己的吗？还有其他值得关注的课程吗？

（我在具有 2GB RAM 的 Intel 机器上在 OS X 10.5 下运行 Java 5。）

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-24T19:55:32.717

您可以通过将 -Xmx128m（其中 128 是兆字节数）传递给 java.util.Date 来增加最大堆大小。我不记得默认大小，但让我觉得它相当小。

您可以使用[Runtime](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html)类以编程方式检查可用内存量。

```
// Get current size of heap in bytes
long heapSize = Runtime.getRuntime().totalMemory();

// Get maximum size of heap in bytes. The heap cannot grow beyond this size.
// Any attempt will result in an OutOfMemoryException.
long heapMaxSize = Runtime.getRuntime().maxMemory();

// Get amount of free memory within the heap in bytes. This size will increase
// after garbage collection and decrease as new objects are created.
long heapFreeSize = Runtime.getRuntime().freeMemory(); 
```

[（来自Java Developers Almanac](http://www.exampledepot.com/egs/java.lang/GetHeapSize.html)的示例）

[这在关于 Java HotSpot VM 的常见问题](http://java.sun.com/docs/hotspot/HotSpotFAQ.html)和[Java 6 GC 调优页面](http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html)中也有部分解决。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-24T20:32:09.163

有些人建议更改 HashMap 的参数以收紧内存要求。我建议**测量而不是猜测**；可能是其他原因导致 OOME。特别是，我建议使用[NetBeans Profiler](http://profiler.netbeans.org/)或[VisualVM](https://visualvm.dev.java.net/)（Java 6 附带，但我看到您坚持使用 Java 5）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-24T20:15:57.667

如果您事先知道对象的数量，可以尝试的另一件事是使用 HashMap(int capacity,double loadfactor) 构造函数，而不是使用默认值 (16,0.75) 的默认无参数构造函数。如果 HashMap 中的元素数量超过（容量 * loadfactor），则 HashMap 中的底层数组将调整为 2 的下一个幂，并且表将被重新散列。该数组还需要一个连续的内存区域，例如，如果您从 32768 大小的数组翻倍到 65536 大小的数组，您将需要 256kB 的可用内存块。为避免额外的分配和重新散列惩罚，只需从一开始就使用更大的散列表。它还会减少您没有足够大的连续内存区域以适应地图的机会。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-24T20:16:06.370

这些实现通常由数组支持。数组是固定大小的内存块。hashmap 实现首先以给定的容量将数据存储在其中一个数组中，比如 100 个对象。

如果它填满了数组并且您继续添加对象，则地图需要秘密增加其数组大小。由于数组是固定的，它通过在内存中创建一个全新的数组以及稍大的当前数组来实现这一点。这被称为增长阵列。然后旧数组中的所有项目都被复制到新数组中，旧数组被取消引用，希望它会被垃圾收集并在某个时候释放内存。

通常，通过将项目复制到更大的数组中来增加地图容量的代码是导致此类问题的原因。有“愚蠢”实现和智能实现，它们使用增长或负载因子，根据旧数组的大小确定新数组的大小。有些实现隐藏了这些参数，有些则没有，所以你不能总是设置它们。问题是当你不能设置它时，它会选择一些默认的负载因子，比如 2。所以新数组的大小是旧数组的两倍。现在你应该是 50k 的地图有一个 100k 的后备数组。

看看你是否可以将负载因子降低到 0.25 或其他东西。这会导致更多的哈希映射冲突，这会损害性能，但是您遇到了内存瓶颈并且需要这样做。

使用此构造函数：

( [http://java.sun.com/javase/6/docs/api/java/util/HashMap.html#HashMap(int](http://java.sun.com/javase/6/docs/api/java/util/HashMap.html#HashMap(int) , float))

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T20:04:05.553

启动 java 时，您可能需要设置标志 -Xmx512m 或更大的数字。我认为 64mb 是默认值。

编辑添加：在您通过分析器确定对象实际使用了多少内存之后，您可能需要查看弱引用或软引用，以确保您不会意外地从垃圾收集器中获取一些内存作为人质。你不再使用它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-24T19:57:56.597

也可能想看看这个：

[http://java.sun.com/docs/hotspot/gc/](http://java.sun.com/docs/hotspot/gc/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-24T20:09:28.740

在这些答案中隐含的是，Java 具有固定的内存大小，并且不会超过配置的最大堆大小。这不像 C 语言，它只受运行它的机器的限制。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-24T20:14:16.687

默认情况下，JVM 使用有限的堆空间。限制取决于 JVM 实现，不清楚您使用的是什么 JVM。在 Windows 以外的操作系统上，具有 2 Gb 或更大容量的机器上的 32 位 Sun JVM 将使用默认最大堆大小为物理内存的 1/4，在您的情况下为 512 Mb。但是，“客户端”模式 JVM 的默认值只有 64 Mb 最大堆大小，这可能是您遇到的问题。其他供应商的 JVM 可能会选择不同的默认值。

当然，您可以使用`-Xmx<NN>m`to 选项显式指定堆限制`java`，其中`<NN>`是堆的兆字节数。

作为一个粗略的猜测，你的哈希表应该只使用大约 16 Mb，所以堆上肯定还有一些其他的大对象。如果您可以`Comparable`在 a 中使用一个键`TreeMap`，那将节省一些内存。

有关详细信息，请参阅[“5.0 JVM 中的人体工程学”](http://java.sun.com/docs/hotspot/gc5.0/ergo5.html#0.0.%20Garbage%20collector,%20heap,%20and%20runtime%20compiler|outline)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-24T20:23:48.947

默认情况下，Java 堆空间是有限的，但这听起来仍然很极端（尽管您的 50000 个段有多大？）

我怀疑您还有其他问题，例如集合中的数组变得太大，因为所有内容都被分配到同一个“插槽”中（当然也会影响性能）。但是，如果您的积分是均匀分布的，这似乎不太可能。

我想知道为什么您使用 HashMap 而不是 TreeMap？即使点是二维的，您也可以使用比较函数对它们进行子类化，然后进行 log(n) 查找。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-26T03:47:34.983

胡思乱想：与 HashMap 相关的哈希桶并不是特别节省内存。您可能想尝试使用 TreeMap 作为替代方案，看看它是否仍能提供足够的性能。

# windows - 如何在任务栏上设置 WindowText？

> ID：235055
> 
> 赞同：0
> 
> 时间：2008-10-24T19:55:58.923
> 
> 标签：windows, winapi

```
const char* title = "old title";
HWND hwnd = FindWindow(title, title);
SetWindowText(hwnd, "new title"); 
```

这将标题栏设置为“新标题”，但任务栏中的标题仍然是“旧标题”。我如何设置两者？

如果相关，这是在拥有窗口的进程中加载​​的 DLL 中完成的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T20:07:06.360

这应该设置窗口标题和任务栏项目。你的来电

```
HWND hwnd = FindWindow(title, title); 
```

看起来不太好，第一个参数必须是类名（查看[FindWindow](http://msdn.microsoft.com/en-us/library/ms633499(VS.85).aspx)）。在我看来，问题出在其他地方，但我可能错了。

# c++ - 现代编译器是否将 x * 2 操作优化为 x << 1？

> ID：235072
> 
> 赞同：34
> 
> 时间：2008-10-24T20:02:18.863
> 
> 标签：c++, optimization, compiler-construction

C++ 编译器是否将乘以 2 操作优化`x*2`为位移操作`x<<1`？

我愿意相信是的。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-24T20:10:53.980

实际上 VS2008 将此优化为 x+x：

```
01391000  push        ecx  
    int x = 0;

    scanf("%d", &x);
01391001  lea         eax,[esp] 
01391004  push        eax  
01391005  push        offset string "%d" (13920F4h) 
0139100A  mov         dword ptr [esp+8],0 
01391012  call        dword ptr [__imp__scanf (13920A4h)] 

    int y = x * 2;
01391018  mov         ecx,dword ptr [esp+8] 
0139101C  lea         edx,[ecx+ecx] 
```

在 x64 构建中，它更加明确并使用：

```
 int y = x * 2;
000000013FB9101E  mov         edx,dword ptr [x] 

    printf("%d", y);
000000013FB91022  lea         rcx,[string "%d" (13FB921B0h)] 
000000013FB91029  add         edx,edx 
```

这将是“最大化速度”（/O2）上的优化设置

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-24T21:16:55.797

Raymond Chen 的这篇文章可能很有趣：

**x/2 什么时候不同于 x>>1？**：http: [//blogs.msdn.com/oldnewthing/archive/2005/05/27/422551.aspx](http://blogs.msdn.com/oldnewthing/archive/2005/05/27/422551.aspx)

引用雷蒙德：

> > 当然，编译器可以自由地识别这一点并重写您的乘法或移位操作。事实上，它很有可能这样做，因为 x+x 比乘法或移位更容易配对。您的移位或乘以 2 可能会被重写为更接近 add eax, eax 指令的东西。
> > 
> > [...]
> > 
> > 即使您假设移位用符号位填充，如果 x 为负，移位和除法的结果也不同。
> > 
> > (-1) / 2 ≡ 0
> > (-1) >> 1 ≡ -1
> > 
> > [...]
> > 
> > **故事的寓意是写下你的意思。如果你想除以二，那么写“/2”，而不是“>>1”。**

我们只能假设告诉编译器你想要什么是明智的，而不是你想让他做什么：**编译器比人类更擅长优化**小规模代码（感谢 Daemin 指出这个微妙的点）：如果你真的想要优化，使用分析器，并研究算法的效率。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-24T20:14:54.237

VS 2008 将矿井优化为 x << 1。

```
 x = x * 2;
004013E7  mov         eax,dword ptr [x] 
004013EA  shl         eax,1 
004013EC  mov         dword ptr [x],eax 
```

编辑：这是使用禁用优化 (/Od) 的 VS 默认“调试”配置。使用任何优化开关（/O1、/O2（VS“零售”）或/Ox）都会导致添加自我代码 Rob 发布。此外，为了更好地衡量，我验证确实与/Od 和 /Ox 中的 cl 编译器的`x = x << 1`处理方式相同。`x = x * 2`因此，总而言之，用于 x86 的 cl.exe 版本 15.00.30729.01 处理方式`* 2`相同`<< 1`，我希望几乎所有其他最近的编译器都这样做。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-24T20:03:45.180

如果 x 是浮点数，则不会。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-24T20:05:39.777

是的。他们还优化了其他类似的操作，例如乘以 2 的非幂，可以重写为一些移位的总和。他们还将优化除以 2 的幂为右移，但请注意，在处理有符号整数时，这两个操作是不同的！编译器必须发出一些额外的位旋转指令以确保正数和负数的结果相同，但它仍然比除法更快。它也同样通过 2 的幂来优化模数。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-24T20:39:48.883

答案是“如果它更快”（或更小）。这在很大程度上取决于目标架构以及给定编译器的寄存器使用模型。一般来说，答案是“是的，总是”，因为这是一个非常简单的窥视孔优化实现，通常是一个不错的胜利。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-04T06:34:16.107

这只是优化器可以做的事情的开始。要查看您的编译器做了什么，请查找导致它发出汇编源代码的开关。对于 Digital Mars 编译器，可以使用 OBJ2ASM 工具检查输出汇编器。如果您想了解编译器的工作原理，查看汇编器输出可能会很有启发性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-24T21:22:51.730

我敢肯定他们都做了这些优化，但我想知道它们是否仍然相关。较旧的处理器通过移位和加法进行乘法运算，这可能需要多个周期才能完成。另一方面，现代处理器具有一组桶形移位器，它们可以在一个时钟周期或更短的时间内同时完成所有必要的移位和加法。有没有人真正对这些优化是否真的有帮助进行基准测试？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-24T20:05:29.777

是他们会。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-24T20:44:51.040

除非在语言标准中指定了某些内容，否则您永远不会得到此类问题的有保证的答案。如有疑问，请让您的编译器吐出汇编代码并检查。这将是真正了解的唯一方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-25T00:43:42.103

@费鲁乔巴列塔

这是个好问题。我去谷歌搜索试图找到答案。

我无法直接找到英特尔处理器的答案，但[这个](https://www.openrce.org/blog/view/1128/Opcode_execution_cost)页面有人试图计时。它显示转变的速度是广告和倍增的两倍多。位移非常简单（乘法可以是位移和加法），这是有道理的。

于是我用谷歌搜索了 AMD，发现了一份 2002 年的 Athlon 优化指南，其中列出了将数字乘以 2 到 32 之间的常数的最快方法。有趣的是，这取决于数字。有些是广告，有些是轮班。在[第 122 页](http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/22007.pdf)。

[Athlon 64](http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/25112.PDF)的指南显示了相同的内容（第 164 页左右）。它说乘法是 3（32 位）或 4（64 位）循环操作，其中移位为 1，加法为 2。

看来它作为优化仍然有用。

但是，忽略循环计数，这种方法会阻止您占用乘法执行单元（可能），所以如果您在一个紧密的循环中进行大量乘法运算，其中一些使用常量而一些不使用额外的调度空间可能是有用。

但那是猜测。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-09-12T07:45:01.117

为什么你认为这是一种优化？

为什么不`2*x`→ `x+x`？或者乘法运算与左移运算一样快（也许只有在被乘数中设置了一位）？如果您从不使用结果，为什么不将其从编译输出中排除呢？如果编译器已经加载`2`到某个寄存器，那么乘法指令可能会更快，例如如果我们必须首先加载移位计数。也许移位操作更大，并且您的内部循环将不再适合 CPU 的预取缓冲区，从而影响性能？也许编译器可以证明您调用函数的唯一时间`x`将具有值 37 并且`x*2`可以替换为`74`? 也许你在做`2*x`什么`x`是循环计数（在循环两字节对象时非常常见，尽管是隐式的）？然后编译器可以将循环从

```
 for(int x = 0; x < count; ++x) ...2*x... 
```

等同于（撇开病理）

```
 int count2 = count * 2
    for(int x = 0; x < count2; x += 2) ...x... 
```

它将`count`乘法替换为单个乘法，或者它可能能够利用`lea`将乘法与内存读取相结合的指令。

**我的观点是**：有数百万个因素决定是否替换`x*2`为`x<<1`产生更快的二进制文件。优化编译器将尝试为给定的程序生成最快的代码，而不是为孤立的操作生成。因此，同一代码的优化结果可能会因周围的代码而有很大差异，而且它们可能根本不是微不足道的。

通常，很少有基准测试显示编译器之间存在很大差异。因此，一个公平的假设是编译器做得很好，因为如果还剩下便宜的优化，至少有一个编译器会实现它们——所有其他编译器都会在下一个版本中跟进。

* * *

## 回答 #13

> 赞同：-9
> 
> 时间：2008-10-24T20:32:20.893

这取决于你有什么编译器。例如，Visual C++ 在优化方面是出了名的差。如果您编辑帖子以说明您使用的是什么编译器，那么回答起来会更容易。

# asp.net - 从 UserControl 链接到样式表的首选方法？

> ID：235081
> 
> 赞同：3
> 
> 时间：2008-10-24T20:04:52.213
> 
> 标签：asp.net, css, user-controls

我们主要在工作中使用 ASP.NET 环境。现在，我正在构建一个使用“模块”的应用程序，它只是一个用户控件，它的 Javascript 就在控件中，以及一个指向该控件样式表的链接元素。我想让它保持模块化，并希望这个控件的样式独立于标记/javascript。

所以我想知道这样做的首选方法是什么？显然，如果我不想要我所追求的“主题”功能，我可以只使用控件顶部的样式标签。正如我所说，现在我有一个链接元素，我认为这不合适。

有没有人有任何首选的方法，如果有，是什么以及为什么？

* * *

我简要地考虑了 ASP.NET 主题，但我认为这些控件的想法有些不同。

它基本上是一个购物车系统。我不想深入探讨，但我们正在使用一个非常简洁的安全系统，我们不想使用预制的购物车。我正在开发一组可以放在页面上的控件，例如在 SiteFinity（这是我们使用的 CMS 系统）或我们可能拥有的任何其他项目中。通常我会将它们编译成一个 DLL，这样我们就可以从工具箱中拖放 ACTUAL 控件，然后我可以使用内部“通用”样式并允许任何人可能想要的附加样式，以及提供一些更高级的样式作为好。

这是我第一次这样做，或者真的是我们店里的第一次有人这样做，所以我一边走一边想办法。我可能离基地很远，但希望我不是。

* * *

对，这样做的想法是有一个“主题”，它实际上只是一个 CSS 文件和一个 jQuery 模板。我让它们命名相同，并在用户控件上有一个 Theme 属性来设置它。

当这些控件最终确定时，我可能会将 javascript 重构为代码隐藏上的 RegisterScriptBlock，但现在它们只是在控件本身的脚本标记中。

引发这个问题的是 IE 的 DebugBar，它警告我在 div 中不允许链接元素。我不太在乎，但是在考虑之后，我不知道如何链接到css文件而不这样做。我曾考虑过在主节点上有一个“空”链接标签，然后在 UserControl 的 Page_Load 后面的代码中设置它，但这看起来很糟糕。

我想我可以使用@import，但我认为链接标签是首选，对吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T20:10:43.323

我认为您应该做的是使用 Page.RegisterScriptBlock 来注册您的脚本块。最好的情况下，您不应该将它们内联在脚本块内的 ascx 中。这并不总是可能的，但理论上这是最好的方法。

理想情况下，您的样式也应该与您的标记分开。您的控件可以具有类和 ID，但您的样式基于您的应用程序而不是您的控件。理论上，控件可以在您可能需要不同样式的其他应用程序中使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T04:01:59.137

听起来您正在推出自己的主题引擎......为什么不使用 ASP.NET 主题？

如果您决定自己动手，这里有一些您可能感兴趣的[CssFriendly 项目的代码。](http://www.codeplex.com/cssfriendly)（我认为只要我引用它的来源就可以发布代码。）.css 文件被标记为嵌入式资源，下面的代码用于根据需要包含它们。

```
string filePath = page.ClientScript.GetWebResourceUrl(type, css);

// if filePath is not empty, embedded CSS exists -- register it
if (!String.IsNullOrEmpty(filePath))
{
    if (!Helpers.HeadContainsLinkHref(page, filePath))
    {
        HtmlLink link = new HtmlLink();
        link.Href = page.ResolveUrl(filePath);
        link.Attributes["type"] = "text/css";
        link.Attributes["rel"] = "stylesheet";
        page.Header.Controls.Add(link);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T20:09:30.097

这取决于您的应用程序有多大，以及它是否依赖于其他地方的主题，恕我直言。

如果您使用的是 .skin 文件，或者应用程序的大部分内容也插入了主题，那么您不妨选择主题。

但是，如果您只需要几个样式，最好手动设置样式表，将 css 文件保持在外部（内联样式是 PITA，破坏了 css 的核心目的之一）。

无论哪种情况，都不要忘记在控件上设置 CssClass 属性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T16:11:29.677

为了正确起见，我将有一个 import.css 文件 - 构造类的命名以遵循您的控件，并在文档的标题中导入样式。

如果您有一个名为“30DayPricingCalc”的模块，那么您可以命名类/ID：

**30DayPricingCalc.css**

```
.30daypricingcalc_main_content
{
  ...
} 
```

另外，如果您还没有，我会设置一个通用可重复使用样式列表以节省您的空间。因为元素将允许每个对象有多个类。

此外，链接标签现在的重要性比以前少了很多。我们已经不再支持 IE5 一代浏览器，而 IE6 支持 @import 标记。

干杯!

# cruisecontrol.net - 通过 CruiseControl 发送带有错误日志的电子邮件

> ID：235090
> 
> 赞同：5
> 
> 时间：2008-10-24T20:07:12.600
> 
> 标签：cruisecontrol.net

您如何配置 CruiseControl 以在构建失败时发送包含错误日志的电子邮件？我已经让它在构建失败时向用户发送电子邮件，但它不包括导致构建失败的实际错误。我知道，如果我仅将其配置为向已进行修改的用户发送电子邮件，则错误日志将包含在这些电子邮件中。这是我所拥有的样本：

<publishers>
    <rss/>
    <xmllogger/>
    <email from="abc@abc.com" mailhost="abc.abc.com" includeDetails="TRUE">
     <users>
         <user name="Joe" group=" devs" address="joe@abc.com"/>
         <user name="Jim" group="devs" address="jim@abc.com"/>
     </users>
     <groups>
         < group name="devs" notification="Failed"/>
     </groups>
     </email>
</publishers>

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T20:48:04.997

You can check if \cruisecontrol.net\server\xsl\compile.xsl is the same as \cruisecontrol.net\webdashboard\xsl\compile.xsl.

Compile.xsl is the default file used to print the error messages from your error log. The one in \webdashboard\ is used for the web dashboard (as the name implies) and the one under \server\ is used for emails.

You can also check ccnet.exe.config whether or not \cruisecontrol.net\server\xsl\compile.xsl is used for emails.

Mine's for example points to compile.xsl on \server:

```
<!-- Specifies the stylesheets that are used to transform the build results when using the EmailPublisher -->
<xslFiles>
    <file name="xsl\header.xsl" />
    <file name="xsl\compile.xsl" />
    <file name="xsl\unittests.xsl" />
    <file name="xsl\fit.xsl" />
    <file name="xsl\modifications.xsl" />
    <file name="xsl\fxcop-summary.xsl" />
</xslFiles> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T20:19:28.907

您的电子邮件发布者将获取 buildlog.xml 并根据您使用的控制台或服务配置中配置的任何 XSL 对其进行转换。无论您将其配置为发送给谁以及何时发送，电子邮件的内容都应该没有区别。只要您在电子邮件发布者和发布者部分中的电子邮件之前进行合并。我看不出有什么不同你确定同样的失败会产生不同的电子邮件吗？我的猜测是你在某个糟糕的地方失败了，并且构建日志不是以一种方式生成的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T20:48:47.367

The build log is getting generated. I can see the error. It's just not included in the email.

# .net - 在 .NET 中，您将如何处理允许多租户 SaaS 应用程序的租户任意向模型实体添加属性？

> ID：235095
> 
> 赞同：1
> 
> 时间：2008-10-24T20:08:13.673
> 
> 标签：.net, dynamic, entity, extensibility, saas

因此，我们正在构建一个多租户系统以作为服务运行。我们从头开始。我们正在关注 DDD；该域（目前）有大约 20 个实体，以后还会有更多。它由我们托管，地理上冗余（除了 SQL 查询之外的所有内容都有 n+1 ;-) ），并且设计灵活（嗯，最后是我们自己的要求，而不是业务'，尽管他们希望我们能够当然可以根据需要轻松更改它）。我们基于 .NET，并将使用关系数据库作为我们的后备存储。我们并不反对（完全）使用开源工具和库。

业务的必备功能之一是系统的租户可以扩展某些实体。例如，客户端 A 可能希望实体 Foo 具有 Title 和 Abstract 属性，而客户端 B 可能希望实体 Foo 具有 Publish Date 和 Directed-By 属性——而不是 Title Abstract。

也可能是它应该为需要的租户支持多种语言的数据 - 例如，一个租户可能有兴趣将其整个帐户翻译成两种（或更多）语言；“静态”字符串和作为数据附加到实体的字符串。

所以。任意数量的字段（在一些通用基线之上；所有租户都将获得关于这些实体的某些内容），可由客户端定义（他们也可以在其中定义数据类型）。数据翻译的可能性（不复制实体 - 例如，没有用英语设置一组，然后用法语设置相同的一组）。强类型、可搜索、可查询的后备存储也是如此（因此，XML 字段中没有额外的东西，除非有办法让它成为强类型和可搜索的）。高性能（但作为次要要求；该功能非常重要，可以在必要时购买硬件）。

数据量？在我们当前的系统中，一个“普通”客户端有数百个实体，一个“大”客户端有数千个实体。请求通常会过滤这些列表以显示在 10-200 之间，最常见的事情可能涉及六个实体（在新系统中应该是可扩展的）。

其他点？每个实体都有指向拥有它的租户的直接链接。

在 .NET 领域如何处理这个问题？有人建议我们将实体放入一个 IoC 容器中，并在运行时动态地将它们 glob 在一起——但是如何将其映射到关系数据库呢？

我还记得很久以前读过[Ayende](http://ayende.com/Blog/archive/2007/10/16/Lucene-as-a-data-repository.aspx)关于 Lucene.NET 的帖子，这听起来不错，但目前我们还没有任何使用 Lucene.NET 或 nHibernate 的经验。（我们目前将 Linq2Sql 用于我们的 ORM，但如果我们需要更改它以支持这一点，坦率地说，我个人会很高兴）。

我读[了这个从 Ayende 链接的 Castle dev list thread](http://groups.google.com/group/castle-project-users/browse_thread/thread/35c08000eb8f06d6/1145442775fd96e4)，看起来 nHibernate 有一个叫做 IUserType 的东西可能会有所帮助——我想知道我们是否可以应用它，为每个租户拉出适当的 IoC？因此，每个可扩展实体的每个租户都有一个 IUserType，并将数据本身存储在 SQL Server（我们最可能的 RDBMS）内部的 XML 列中。

最后，我刚刚阅读了一个关于动态更改每个租户每个实体的 DB 表的建议 - 但这听起来很不错......老实说，令人担忧！我的意思是，它*可以*工作，但将这种能力授予租户（他们可能不太懂技术）听起来并不是一个好主意。我想它可能仅限于管理员员工......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T02:11:13.080

看看[Ayende](http://ayende.com/Blog/archive/2008/08/13/Mutli-Tenancy--multi-tenant-apps-and-frameworks.aspx)关于多租户的系列文章。他分析了几种解决[可扩展性](http://ayende.com/Blog/archive/2008/08/07/Multi-Tenancy--Extensible-Data-Model.aspx)问题的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T21:48:26.243

There are a variety of ways to accomplish it, but the issues of multi-tenancy go deeper than just the data model. I hate to be plugging product, but check out [SaaSGrid](http://www.apprenda.com) by my the company I work at, [Apprenda](http://www.apprenda.com).We're a cloud operating system that allows you to write single tenant SOA apps (feel free to use NHibernate for data access) that automatically injects multi-tenancy into your app. When you publish your app, you can do things like choose a data model (isolated database or shared) and SaaSGrid will deploy accordingly and your app will run without any code changes - just write code as if it were for a single tenant!

# iis-6 - 在 Nant 中以编程方式创建 IIS6 网站/应用程序池

> ID：235113
> 
> 赞同：2
> 
> 时间：2008-10-24T20:15:48.447
> 
> 标签：iis-6, nant, application-pool

我对 Nant 比较陌生，我想做的是在 IIS6 中创建一个新网站和 AppPool

有没有办法在南特做到这一点？

本质上，该任务需要设置所有适当的属性，包括正确版本的 .net Framework

理想情况下，我还想检查该站点是否已存在于 IIS 中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T20:26:11.453

你看过[NantContrib](http://nantcontrib.sourceforge.net/)吗？它可能会提供一些更好的 IIS 支持，而无需编写您自己的任务（或脱壳）。

它有一些特定于 IIS 的任务，例如[iisapppool](http://nantcontrib.sourceforge.net/release/latest/help/tasks/iisapppool.html)和[mkiisdir](http://nantcontrib.sourceforge.net/release/latest/help/tasks/mkiisdir.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T20:23:25.560

您可以使用 ADSUTIL 从命令行执行此操作，您可以在此处找到更多信息：

[http://blogs.msdn.com/david.wang/archive/2007/12/12/howto-create-custom-application-pool-by-commandline.aspx](http://blogs.msdn.com/david.wang/archive/2007/12/12/howto-create-custom-application-pool-by-commandline.aspx)

要在 Nant 中执行此操作，您可以使用 exec 任务。

您打算如何部署您的应用程序？你需要这个只是为了本地安装吗？如果您能提供更多详细信息，可能会有更好的解决方案。

# asp.net-mvc - ASP.Net MVC 路由到用户名

> ID：235118
> 
> 赞同：23
> 
> 时间：2008-10-24T20:17:46.337
> 
> 标签：asp.net-mvc

我正在尝试使用用户名创建路由...

所以 URL 将是 mydomain.com/abrudtkhul（abrudtkhul 是用户名）

我的应用程序将具有基于用户名的公共配置文件（例如：[http](http://delicious.com/abrudtkuhl) ://delicious.com/abrudtkuhl ）。我想复制这个 URL 方案。

如何在 ASP.Net MVC 中构造它？我也在使用会员/角色提供者。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-24T21:38:42.460

这是您想要做的，首先定义您的路线图：

```
routes.MapRoute(
             "Users",
              "{username}", 
              new { controller = "User", action="index", username=""}); 
```

这允许您做的是设置以下约定：

*   控制器：用户（UserController 类型）
*   Action: Index (这被映射到 UserController 的 Index 方法)
*   用户名：这是 Index 方法的参数

因此，当您请求 url **http://mydomain.com/javier**时，这将被转换为对**UserController.Index(string username)**的调用，其中**username**设置为*javier*的值。

现在，由于您计划使用 MembershipProvider 类，因此您想要更像这样的东西：

```
 public ActionResult Index(MembershipUser usr)
 {
    ViewData["Welcome"] = "Viewing " + usr.UserName;

    return View();
 } 
```

为此，您将需要使用 ModelBinder 来完成从用户名绑定到 MembershipUser 类型的工作。为此，您需要创建自己的 ModelBinder 类型并将其应用于 Index 方法的用户参数。您的课程可能如下所示：

```
public class UserBinder : IModelBinder
{
   public ModelBinderResult BindModel(ModelBindingContext bindingContext)
   {
      var request = bindingContext.HttpContext.Request;
      var username = request["username"];
      MembershipUser user = Membership.GetUser(username);

      return new ModelBinderResult(user);
   }
} 
```

这允许您将 Index 方法的声明更改为：

```
public ActionResult Index([ModelBinder(typeof(UserBinder))] 
    MembershipUser usr)
{
    ViewData["Welcome"] = "Viewing " + usr.Username;
    return View();
} 
```

如您所见，我们已将**[ModelBinder(typeof(UserBinder))]**属性应用于方法的参数。这意味着在调用您的方法之前，将调用您的**UserBinder**类型的逻辑，因此在调用该方法时，您将拥有 MembershipUser 类型的有效实例。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-22T20:16:04.563

如果您想拥有一些其他功能控制器（如帐户、管理员、配置文件、设置等），您可能需要考虑不允许某些类型的用户名。此外，您可能希望您的静态内容不触发“用户名”路由。为了实现这种功能（类似于 twitter url 的处理方式），您可以使用以下路由：

```
// do not route the following
routes.IgnoreRoute("{resource}.axd/{*pathInfo}");
routes.IgnoreRoute("content/{*pathInfo}"); 
routes.IgnoreRoute("images/{*pathInfo}");

// route the following based on the controller constraints
routes.MapRoute(
    "Default",                                              // Route name
    "{controller}/{action}/{id}",                           // URL with parameters
    new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
    , new { controller = @"(admin|help|profile|settings)" } // Constraints
);

// this will catch the remaining allowed usernames
routes.MapRoute(
    "Users",
    "{username}",
    new { controller = "Users", action = "View", username = "" }
); 
```

然后，您需要为约束字符串中的每个标记（例如 admin、help、profile、settings）设置一个控制器，以及一个名为 Users 的控制器，当然还有本示例中的 Home 的默认控制器。

如果您有很多不想允许的用户名，那么您可以考虑通过创建自定义路由处理程序来采用更动态的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T20:22:32.460

你可以有一个看起来像这样的路线：

```
{username} 
```

默认值为

```
Controller = "Users" 
```

对于以下成品：

```
 routes.MapRoute(
                    "Users",
                    "{username}",
                    new { controller = "Users" } 
```

因此，用户名是唯一的 url 参数，MVC 假定它将它传递给用户控制器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T20:22:56.793

您是否尝试将其作为参数传递给控制器​​？

理论上你可以这样做：

routes.MapRoute("name", "{user}/{controller}/{action}", new { controller = "blah", action = "blah", user = "" })

我对 ASP.NET 路由不太熟悉，但我认为*应该*可以。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T21:11:35.543

```
routes.MapRoute(
             "Users",
              "{username}", 
              new { controller = "Users", action="ShowUser", username=""}); 
```

好的，这将默认将用户名参数设置为 {username} 的值

因此，即使您已经编写了 username="" ，它也会知道传递 {username} .. 的值，因为字符串匹配。

这会期望

对于 url 表单

[http://website.com/username](http://website.com/username)

*   用户控制器
*   ShowUser Action（控制器中的方法）
*   ShowUser 操作（方法）上的用户名参数

# asp.net - 您可以在 ASP.NET 中以编程方式更改会话超时吗？

> ID：235119
> 
> 赞同：7
> 
> 时间：2008-10-24T20:17:54.917
> 
> 标签：asp.net, iis, session, timeout

可以完成还是唯一的方法是在 IIS 上配置它？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T20:22:33.160

您通常编辑 Global.asax 文件的 Session_Start 方法并将[Session.TimeOut](http://msdn.microsoft.com/en-us/library/system.web.sessionstate.httpsessionstate.timeout.aspx)设置为您想要的任何内容。您也可以在代码中的其他任何地方执行此操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-24T20:24:35.370

可以，但如果您在共享托管环境中，**它不会覆盖IIS 设置（默认为 20 分钟）。**

我所做的是应用**SQL Sessions**的使用，它会使 Web 应用程序变慢一点，但是您可以完全控制会话，如果您对应用程序更新某些内容并且编译器需要重新编译资源/类再次，用户**不会被注销**。

会话将保存在 SQL 数据库的特殊表中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-01-04T11:02:37.603

如果您在托管环境中并且不允许覆盖 IIS 默认会话超时（正如其他人在评论中提到的那样），您可以通过使用反复刷新会话的 iframe 来欺骗 IIS 使会话保持更长时间（种类就像一个保持活动的 ping），无论你需要什么时间间隔。我有这种情况并使用了这种方法

[会话超时时的 ASP.NET 推送重定向](https://stackoverflow.com/questions/484964/asp-net-push-redirect-on-session-timeout/5863952#5863952)

# iphone - UITableView 索引放大镜字符是什么？

> ID：235120
> 
> 赞同：57
> 
> 时间：2008-10-24T20:19:08.330
> 
> 标签：iphone, cocoa-touch, uitableview, icons

在 Apple 的 iPhone 应用程序（如联系人）中，它们在表格视图索引的顶部有一个漂亮的放大镜图标。由于表格视图索引 API 是基于字符的，我假设这个放大镜是 Unicode 字符。到目前为止，我已经求助于在那里放置一个问号字符，但这看起来很蹩脚。

谁能告诉我放大镜是什么字符？

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2009-06-15T22:44:01.617

[`UITableViewIndexSearch`](https://developer.apple.com/library/ios/documentation/UIKit/Reference/UITableView_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40006943-CH3-SW49)作为部分索引标题返回（与 @"{search}" 相同）也有效。

在 Swift 中，你会使用`UITableView.indexSearch`.

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2008-11-12T02:44:53.757

`@"{search}"`FTW。

返回该标题，它会神奇地被正确的字形替换。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2010-03-21T17:08:37.213

在 tableView:sectionForSectionIndexTitle:AtIndex: 显式滚动到顶部并返回 NSNotFound：

```
- (NSInteger) tableView:(UITableView *)tableView
sectionForSectionIndexTitle:(NSString *)title
                atIndex:(NSInteger)index {
    if (index == 0) {
        [tableView setContentOffset:CGPointZero animated:NO];
        return NSNotFound;
    }
    return index;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-09-21T10:45:29.737

放大镜已经有一个现有的 UTF 代码点。它是[U+1F50D](http://www.isthisthingon.org/unicode/index.phtml?page=1F&subpage=5&glyph=1F50D)。然而，让 Xcode 识别这个数字有点棘手。根据 Apple 的字符串编程指南，UTF 位应分成两个 UTF-16 代理对（0xD83D、0xDD0D）。检查[此代理对计算器](http://www.russellcottrell.com/greek/utilities/SurrogatePairCalculator.htm)以供参考。

可以通过以下方式获得具有代理对内容的 NSString 实例：

```
[NSString stringWithFormat:@"%C%C", 0xD83D, 0xDD0D]; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-04-20T22:53:42.990

在这种情况下使用了一个常量 UITableViewIndexSearch，如下所述：

[http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UITableView_Class/Reference/Reference.html#//apple_ref/doc/constant_group/Section_Index_Icons](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UITableView_Class/Reference/Reference.html#//apple_ref/doc/constant_group/Section_Index_Icons)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-24T22:37:22.390

您当然可以在表格视图索引中放置一个 Unicode 字符（我已经使用其他字符完成了此操作）并将您的标题放在第一个表格部分以代替 tableViewHeader。也就是说，我还没有在任何 unicode 参考文献中找到放大镜。我发现的关闭是电话录音机符号 - ⌕ (\u2315)。不幸的是，它指向错误的方向，“手柄”延伸到“放大镜”中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-28T07:27:30.580

例如，在 sectionIndexTitlesForTableView 添加一个 NSMutableArray* 标题，除了您的索引之外，添加 [titles addObject: UITableViewIndexSearch]

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-09-23T15:22:56.983

我知道这是一篇旧帖子，但因为它与我正在寻找的内容相似......如果有人正在寻找放大镜的 Unicode 字符，那将是这个 \u128269 表示的：

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-24T21:04:13.390

有人[声称 Apple 告诉他们](http://forums.macrumors.com/showthread.php?t=555877)SDK 不支持这一点。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-25T10:58:02.487

您可以使用空格作为索引字符，然后覆盖`UIImageView`禁用用户交互并包含以下图像的字符[：（来源：][[booleanmagic.com](http://booleanmagic.com/uploads/searchicon.png)][）][![搜索图标](https://i.stack.imgur.com/Qn4wY.png)](https://i.stack.imgur.com/Qn4wY.png)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-22T01:15:24.680

我可以理解为什么有人可能不想使用该图像，尽管它非常漂亮......字符更容易维护并且可以轻松扩展。

⚦ 是类似放大镜的字形的另一个 unicode 选项。再次，它没有面向正确的方向。我相信它确实是某种雌雄同体的性别符号。上面 unicode 符号的 html 是 ⚦

我真的认为应该在“26：Misc. Symbols”下的unicode字符集中添加一个放大镜符号。

# asp.net - 不使用 ASP.net ajax 工具包可以做 ajax 吗？

> ID：235127
> 
> 赞同：2
> 
> 时间：2008-10-24T20:22:04.863
> 
> 标签：asp.net, ajax, asp.net-ajax

您可以在不使用 ajax 工具包的情况下在 ASP.net webform 上执行 ajax 吗？（请发布示例链接）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T20:24:57.960

是的...请参阅我在这篇文章中的示例

[AJAX - 如何将值传递回服务器](https://stackoverflow.com/questions/85500/ajax-how-to-pass-value-back-to-server#86520)

这可以比 ASP.NET ajax 执行得更好，但需要更长的编码时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T20:28:33.867

当然。在 ajax 一词出现之前，人们已经使用 ajax 多年了。Jquery 是一个流行的库，您可以使用它来调用服务器而无需刷新页面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T20:26:35.820

当然可以！我在 .NET 1.1 中所做的（在 ASP.Net Ajax 发布之前）是定义一个`HttpHandler`监听对 的调用`ajax.aspx`，运行适当的方法，然后返回结果。我使用[Prototype 库](http://prototypejs.org)进行 Ajax 调用，尽管您可以使用任何其他库，或者手动进行。

我是凭记忆去的，但这是我使用的代码（对于 .NET 2.0，但你明白了）：

```
// client-side js:
var foo = new Ajax.Request('ajax.aspx',
{
   method:'get',
   parameters: { method: 'GetFive' },
   onSuccess: function(transport){
     var response = transport.responseText || "no response text";
     alert("Success! \n\n" + response);
},
onFailure: function(){ alert('Something went wrong...') }
});

// web.config:
<httpHandlers>
  <!-- pre existing handlers go here -->
  <add verb="GET" path="ajax.aspx" type="Fully.Qualified.Name.AjaxHandler, AssemblyName" validate="false" />
</httpHandlers>

// AjaxHandler.cs
public class AjaxHandler : IHttpHandler {
  internal delegate object AjaxFunction();

  private Dictionary<string, AjaxFunction> functions;

  public bool IsReusable {
    get { return true; }
  }

  public void ProcessRequest(HttpContext context) {
    this.functions = new Dicionary<string, AjaxFunction>();
    this.functions.Add("GetFive", delegate() {
      return 5;
    });

    string functionName = context.Request["method"];
    AjaxFunction func = this.functions[functionName];
    if (func != null) {
      object val = func();
      context.Response.Write(val);
    }
  }
} 
```

[重要说明：以上内容未经测试，设计得并不好，甚至可能无法编译，但它应该给你正确的想法。]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T20:40:41.220

这是一个流行的工具：[AjaxPro](http://www.ajaxpro.info/)。

正如其他人所指出的，您可以使用 XmlHttpRequest 对象和 javascript 自己编写整个事情。但是，如果您的应用程序将使用非常复杂的技术，那么自己编写代码将变得非常乏味。这些工具变得更加强大和易于使用。

顺便说一句，ASP.Net Ajax 有两个元素。一种是包含在 Visual Studio 2008 中的 Ajax 扩展，可以添加到 Visual Studio 2005。它可以用于比“工具包”更多的功能。诸如部分页面刷新和检索数据而不执行完整回发之类的事情。另一个是 Ajax Control Toolkit，需要单独下载。“工具包”主要包括花哨的控件，尤其是具有 DHTML 效果（显示、隐藏、模拟动画）的控件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T20:41:56.990

哦，绝对的。

您可以在 ASP.NET 表单中使用诸如[jQuery之类的库，而不是 UpdatePanel 以及围绕它的所有用具。](http://jquery.com/)

在我以前工作的地方，早在 AJAX 出现之前，我们就在做 AJAX。那是在我们的东西只在 IE 中工作的日子里:-)

在使用 ASP.NET 服务器控件的 ASP.NET 表单中，您需要做的一件事是使用服务器在从 javascript 引用控件时为您的控件生成的正确客户端 ID。因此，如果您有一个 ID 为“telephoneNumber”的标签，则需要将其引用为 <%=telephone.ClientID %>。例如

```
$("#<%=telephoneNumber.ClientID %>").attr("disabled", "disabled"); 
```

使用 jQuery 之类的库，您仍然可以调用 ASP.NET Web 服务，但您可能更适合研究 WCF 和 JSON 序列化。

您不必丢弃 ASP.NET ajax 位中的所有内容，我仍然使用脚本服务调用 Web 服务。在我可以用 JSON 替换之前，这是一个半路：

[http://msdn.microsoft.com/en-us/magazine/cc163499.aspx](http://msdn.microsoft.com/en-us/magazine/cc163499.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T21:24:28.167

Ajax 只是意味着当用户使用 javascript 查看您的网页时，返回服务器并获取其他内容。然后使用 javascript DOM 使用您获取的内容更新页面。

XMLHttpRequest 对象很好，但即使在它之前，您也可以使用隐藏的 IFRAME 来做同样的事情......

这是您开始所需的所有 javascript 代码：

```
function GetXmlHttpObject()
{
    var objXMLHttp=null
    if (window.XMLHttpRequest)
    {
        objXMLHttp=new XMLHttpRequest()
    }
    else if (window.ActiveXObject)
    {
        objXMLHttp=new ActiveXObject("Microsoft.XMLHTTP")
    }
    return objXMLHttp
}

function stateChanged()
{
    if (xmlHttp.readyState==4 || xmlHttp.readyState=="complete")
    {
        // do something with xmlHttp.responseText
    }
}

function SendAsyncHttpRequest()
{
    xmlHttp=GetXmlHttpObject()

    if (xmlHttp==null)
    {
        return
    }

    var url = "http://YOUR_URL"
    xmlHttp.onreadystatechange=stateChanged
    xmlHttp.open("GET",url,true)
    xmlHttp.send(null)
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T09:22:20.200

是的！

那里有 ASP.NET AJAX 的“无数”替代品。*他们中的大多数*实际上也更好。你可能想看看我的项目；[Ra-Ajax](http://ra-ajax.org/samples/Viewport-Calendar-Starter-Kit.aspx)满足您的需求 :)

# asp.net - 我怎么知道 .aspx 调用何时结束？

> ID：235145
> 
> 赞同：2
> 
> 时间：2008-10-24T20:27:04.913
> 
> 标签：asp.net, javascript, apache-flex

我正在构建一个 Flex 应用程序，该应用程序在使用 SQL Reporting Services 构建 PDF 报告的同一网络服务器上调用 .aspx 页面。生成报告后，它会提示用户打开或保存 PDF。

我们正在尝试找到一种显示进度条的方法，让用户知道他们请求的报告正在构建，然后在报告构建完成后销毁进度条。

我尝试使用 JavaScript 打开一个新窗口并尝试捕捉窗口何时关闭，以及尝试 XMLHTTPRequest，但似乎没有任何效果。

有没有人有什么建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T21:08:41.820

There are 2 options:

1.  Use the `FileReference` class in Flex to programmatically invoke your aspx file. You will be able to track the progress of the call from within Flex by listening to its events. But the users can only save the PDF, not open it.
2.  Have an intermediate HTML page that displays a loading icon and then refresh itself to your PDF generating ASPX page. Encode your aspx url along with parameters etc and set it as a parameter to this intermediate page so it knows what to load.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T21:51:27.833

如果您无法控制页面以在其上放置 JavaScript 以点击 URL（或回调父/打开器），那么您可能会考虑创建自己的 aspx 页面来托管 ReportViewer 控件，并在其中显示报告。这将要求您创建一个带有页面和 web.config 的 .NET 网站 - 您只需让它接收您的报告所需的任何参数，并且可以通过 inline-to-the -aspx 代码，而不是需要深入的 .NET 知识。

或者，您可以点击 SS-RS API 并直接呈现报告。在这里，您将制作一个带有参数的 URL，以便 SS-RS API 站点上的报告接受。我认为，尽管我不确定，SS-RS UI 在幕后使用 API 本身。默认情况下，API 托管在一个名为“reportserver”的站点中——您可能会在呈现报告时嗅探 HTTP 流量，以便开始使用您需要点击的 URL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-07T19:15:52.433

此处未提及的另一个选项是创建一个 .Net Web 服务，将其添加到您的 flex 项目中，当它到达结果处理程序时，您知道该文件是在此时创建的。

# .net - 工具条溢出

> ID：235146
> 
> 赞同：1
> 
> 时间：2008-10-24T20:27:27.627
> 
> 标签：.net, winforms

我需要将 ToolStrip 中的标准溢出功能替换为“更多...”按钮，然后该按钮会弹出一个包含溢出项目的菜单。有没有人对如何做到这一点有任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T17:52:29.903

不久前我写了一些与此非常相似的东西。我使用的代码粘贴在下面，您可以随意修改它以满足您的需要。

ToolStripCustomiseMenuItem 基本上是您的“更多”按钮，单击时会填充下拉上下文菜单。希望这对您有所帮助，至少这应该是一个很好的起点……</p>

```
 public class ToolStripCustomiseMenuItem : ToolStripDropDownButton {
        public ToolStripCustomiseMenuItem()
            : base("Add Remove Buttons") {
            this.Overflow = ToolStripItemOverflow.Always;
            DropDown = CreateCheckImageContextMenuStrip();
        }

    ContextMenuStrip checkImageContextMenuStrip = new ContextMenuStrip();
    internal ContextMenuStrip CreateCheckImageContextMenuStrip() {
        ContextMenuStrip checkImageContextMenuStrip = new ContextMenuStrip();
        checkImageContextMenuStrip.ShowCheckMargin = true;
        checkImageContextMenuStrip.ShowImageMargin = true;
        checkImageContextMenuStrip.Closing += new ToolStripDropDownClosingEventHandler(checkImageContextMenuStrip_Closing);
        checkImageContextMenuStrip.Opening += new CancelEventHandler(checkImageContextMenuStrip_Opening);
        DropDownOpening += new EventHandler(ToolStripAddRemoveMenuItem_DropDownOpening);
        return checkImageContextMenuStrip;
    }

    void checkImageContextMenuStrip_Opening(object sender, CancelEventArgs e) {

    }

    void ToolStripAddRemoveMenuItem_DropDownOpening(object sender, EventArgs e) {
        DropDownItems.Clear();
        if (this.Owner == null) return;
        foreach (ToolStripItem ti in Owner.Items) {
            if (ti is ToolStripSeparator) continue;
            if (ti == this) continue;
            MyToolStripCheckedMenuItem itm = new MyToolStripCheckedMenuItem(ti);
            itm.Checked = ti.Visible;
            DropDownItems.Add(itm);
        }
    }

    void checkImageContextMenuStrip_Closing(object sender, ToolStripDropDownClosingEventArgs e) {
        if (e.CloseReason == ToolStripDropDownCloseReason.ItemClicked) {
            e.Cancel = true;
        }
    }
}

internal class MyToolStripCheckedMenuItem : ToolStripMenuItem {
    ToolStripItem tsi;
    public MyToolStripCheckedMenuItem(ToolStripItem tsi)
        : base(tsi.Text) {
        this.tsi = tsi;
        this.Image = tsi.Image;
        this.CheckOnClick = true;
        this.CheckState = CheckState.Checked;
        CheckedChanged += new EventHandler(MyToolStripCheckedMenuItem_CheckedChanged);
    }

    void MyToolStripCheckedMenuItem_CheckedChanged(object sender, EventArgs e) {
        tsi.Visible = this.Checked;
    }

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T21:12:23.357

您可以通过调用捕获按钮上的绘制事件

```
toolStrip1.OverflowButton.Paint += new PaintEventHandler(OverflowButton_Paint); 
```

理论上应该允许你说“更多......”，但我无法将溢出按钮的宽度设置为（窄）默认宽度。

此外，另一个想法是您可以捕获`VisibleChanged`溢出按钮，然后手动将拆分按钮注入工具条。棘手的部分是弄清楚该按钮的放置位置。

# asp.net-mvc - 在 ASP.NET MVC 应用程序中应该在哪里进行缓存？

> ID：235147
> 
> 赞同：14
> 
> 时间：2008-10-24T20:27:44.133
> 
> 标签：asp.net-mvc, caching

我需要使用**System.Web.Caching.Cache**缓存一些数据。不确定是否重要，但数据不是来自数据库，而是来自大量自定义对象。

ASP.NET MVC 对我来说相当新，我想知道发生这种缓存的意义在哪里？

### 模型还是控制器？

**在某种程度上，在模型**级别缓存是有意义的，但我不一定知道这样做的含义（如果有的话）。如果缓存是在**控制器**级别完成的，那会影响所有请求，还是只影响当前的**HttpContext**？

**那么......应该在哪里完成应用程序数据缓存，以及实际执行它的好方法是什么？**

### 更新

感谢您的精彩回答！我仍在尝试收集在不同情况下缓存最有意义的位置。如果要缓存整个页面，那么将其保留在视图中是有意义的，但是当它不是整个页面时在哪里画线？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-24T21:00:54.987

我认为这最终取决于*您*要缓存的内容。如果你想缓存渲染页面的结果，这与请求的 Http 特性紧密耦合，并且会建议使用 ActionFilter 级别的缓存机制。

另一方面，如果您想缓存驱动页面本身的数据，那么您应该考虑模型级缓存。在这种情况下，控制器并不关心数据何时生成，它只是对数据执行逻辑操作并准备查看。*模型级缓存的另一个论点是，如果您对未*附加到 Http 上下文的模型数据有其他依赖项。

例如，我有一个网络应用程序，我的大部分模型都被抽象成一个完全不同的项目。这是因为将有第二个使用相同支持的网络应用程序，并且我们可能有一个非基于网络的应用程序也使用相同的数据。我的大部分数据来自网络服务，这可能是性能杀手，所以我有模型级缓存，控制器和视图对此一无所知。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T20:35:10.467

我不知道您的问题的答案，但 Jeff Atwood 在最近的 hanselminutes 节目中谈到了 SO 团队如何使用 stackoverflow.com 的 MVC 框架进行缓存，这可能会帮助您：

[http://www.hanselminutes.com/default.aspx?showID=152](http://www.hanselminutes.com/default.aspx?showID=152)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T02:43:55.913

## 快速回答

我将从*CONTROLLER*缓存开始，使用[OutputCache](http://msdn.microsoft.com/en-us/library/hdxfb6cy.aspx "MSDN 上定义的 OutputCache 属性")属性，然后在需要时添加模型缓存。它实施起来更快，并且立竿见影。

## 详细答案（因为我喜欢我的声音）

这是一个例子。

```
[OutputCache(Duration=60, VaryByParam="None")]
public ActionResult CacheDemo() {
  return View();
} 
```

这意味着如果用户点击该站点（对于属性中定义的缓存要求），需要完成的工作就会减少。如果只有模型缓存，那么即使缓存了逻辑（很可能是 DB 命中），Web 服务器仍然必须呈现页面。当渲染结果始终相同时，为什么要这样做？

因此，从`OutputCach`ing 开始，然后在您对站点进行性能测试时转到模型缓存。

输出缓存也更容易开始。您不必担心网络场分布式缓存问题（如果您是场的一部分）和模型的缓存提供程序。

## 高级缓存技术

您还可以应用甜甜圈缓存 -> 仅缓存 UI 页面的一部分 :)[看看](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx "哈克 FTW")！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T19:25:36.270

我会选择模型级别的缓存。（一般来说，建议似乎是在控制器级别最小化业务逻辑并尽可能多地移动到模型类中。）

这样做怎么样：

我在模型中有一些由该类表示`Entry` 的条目和一个条目源（来自数据库，或“大量自定义对象”）。在模型中，我创建了一个用于检索条目的接口：

```
公共接口 IEntryHandler
{
    IEnumerable<Entry> GetEntries();
}

```

在模型中，我有一个`IEntryHandler` 从缓存读取条目并写入缓存的实际实现。

```
公共类 EntryHandler : IEntryHandler
{
    公共 IEnumerable<Entry> GetEntries()
    {
        // 检查对象是否在缓存中：
        List<Entry> entries = [从缓存中获取条目]
        如果（条目 == 空）
        {
            // 缓存中没有条目，所以我们从源中读取它们：
            entries = [从数据库中获取条目或'过多的自定义对象']
            [将检索到的条目保存到缓存以供以后使用]
        }
        返回条目；
    }
}

```

然后控制器将调用`IEntryHandler`：

```
公共类 HomeController : 控制器
{
    私人 IEntryHandler _entryHandler;

    // 默认构造函数，使用缓存和数据库/自定义对象
    公共 HomeController()
        ：这个（新的EntryHandler（））
    {
    }

    // 这个构造函数允许我们对控制器进行单元测试
    // 通过编写一个实现 IEntryHandler 的测试类
    // 但不影响数据库/自定义对象中的缓存或条目
    公共 HomeController(IEntryHandler entryHandler)
    {
        _entryHandler = entryHandler;
    }

    // 此控制器操作将条目列表返回到视图：
    公共行动结果索引（）
    {
        返回视图(_entryHandler.GetEntries());
    }
}

```

这样就可以在不触及真正的缓存/数据库/自定义对象的情况下对控制器进行单元测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T20:43:53.633

我认为缓存应该以某种方式与模型相关。我认为控制器不应该更关心数据。控制器的职责是将数据（无论数据来自何处）映射到视图。

试着想想为什么你需要缓存？你想保存处理，数据传输还是什么？这将帮助您了解您需要缓存层的确切位置。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-27T01:02:36.440

这完全取决于操作的成本。如果您有复杂的查询，那么在控制器级别缓存数据可能是有意义的，这样查询就不会再次执行（直到缓存过期）。

请记住，缓存是一个非常复杂的主题。您可以在许多不同的地方存储缓存：

*   Akamai / CDN 缓存
*   浏览器缓存
*   内存中应用程序缓存
*   .NET 的缓存对象
*   页面指​​令
*   分布式缓存（memcached）

# haskell - 使用 foldr 实现 zip

> ID：235148
> 
> 赞同：20
> 
> 时间：2008-10-24T20:27:52.120
> 
> 标签：haskell, functional-programming, fold, combinators

我目前正在阅读 Real World Haskell 的第 4 章，我正试图围绕[使用 foldr 来实现 foldl](http://book.realworldhaskell.org/read/functional-programming.html#x_E9)。

（这是他们的代码：）

```
myFoldl :: (a -> b -> a) -> a -> [b] -> a

myFoldl f z xs = foldr step id xs z
    where step x g a = g (f a x) 
```

我想我会尝试`zip`使用相同的技术来实现，但我似乎没有取得任何进展。甚至可能吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-24T20:47:12.707

```
zip2 xs ys = foldr step done xs ys
  where done ys = []
        step x zipsfn []     = []
        step x zipsfn (y:ys) = (x, y) : (zipsfn ys) 
```

这是如何工作的： (foldr step done xs) 返回一个消耗 ys 的函数；所以我们沿着 xs 列表建立一个嵌套的函数组合，每个函数都将应用于 ys 的相应部分。

如何想出它：我从一般想法开始（来自之前看到的类似示例），写道

```
zip2 xs ys = foldr step done xs ys 
```

然后依次填写以下每一行，以使类型和值正确显示。在较难的情况之前先考虑最简单的情况是最容易的。

第一行可以更简单地写成

```
zip2 = foldr step done 
```

正如mattiast所示。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2014-10-09T18:04:31.303

答案已经在这里给出，但不是（说明性的）推导。因此，即使经过这么多年，也许值得添加它。

其实很简单。第一的，

```
折叠 fz xs
   = 折叠 fz [x1,x2,x3,...,xn] = f x1 (折叠 fz [x2,x3,...,xn]) 
   = ... = f x1 (f x2 (f x3 (.. . (f xn z) ...)))

```

因此通过 eta 展开，

```
折叠 fz xs ys
   = foldr fz [x1,x2,x3,...,xn] ys = f x1 (foldr fz [x2,x3,...,xn]) ys
   = ... = f x1 (f x2 (f x3 (... (f xn z) ...))) ys

```

在这里很明显，*如果`f`在它的第二个参数中是非强制的，它**首先*在`x1`and上工作`ys`，在哪里。`f x1`**`r1`**`ys``r1 =`**`(f x2 (f x3 (... (f xn z) ...)))`**`= foldr f z [x2,x3,...,xn]`

所以，使用

```
f x1 r1 [] = []
f x1 r1 (y1:ys1) = (x1,y1) : r1 ys1

```

我们通过*调用*输入列表的*其余部分*来安排信息*从左到右的传递*，作为下一步。就是这样。 ***`r1`***`ys1`**`foldr f z [x2,x3,...,xn]`**`ys1 = f x2`**`r2`**`ys1`**

 *** * *

当`ys`短于`xs`（或相同长度）时，`[]`火灾`f`和处理停止。但是 if `ys`is long than `xs`then`f`的`[]`情况不会触发，我们将进入最终应用程序，`f xn`**`z`**`(yn:ysn)`

```
f xn z (yn:ysn) = (xn,yn) : z ysn

```

由于我们已经到了 结束`xs`，*`zip`*处理必须停止：

```
z _ = []

```

这意味着`z = const []`应该使用以下定义：

```
zip xs ys = foldr f (const []) xs ys
  where
    f x r []     = []
    f x r (y:ys) = (x,y) : r ys 
```

从的角度来看`f`，`r`它扮演着*成功延续*`f`的角色，在发出对之后，当处理要继续时调用`(x,y)`。

*“**当有更多**s 时如何处理更多”*也是如此，并且中的-case`r`是*“**当没有更多**s 时如何处理”*。或者可以自己停下来，累了就回来。*`ys``x`*`z = const []`*`nil`*`foldr`*`ys``x`*`f``[]``ys`

* * *

请注意如何`ys`将其用作一种累积值，它沿着 list 从左到右传递`xs`，从一次调用`f`到下一次调用（“累积”步骤在这里是从其中剥离一个 head 元素）。

[自然](https://wiki.haskell.org/Foldl_as_foldr_alternative)这对应于左折叠，其中一个累加步骤是“应用函数”，`z = id`当“没有更多`x`的 s”时返回最终的累加值：

```
foldl f a xs =~ foldr (\x r a-> r (f a x)) id xs a 
```

同样，对于有限列表，

```
foldr f a xs =~ foldl (\r x a-> r (f x a)) id xs a 
```

并且由于组合函数可以决定是否继续，现在可以有可以提前停止的左折叠：

```
foldlWhile t f a xs = foldr cons id xs a
  where 
    cons x r a = if t x then r (f a x) else a 
```

或跳过左折叠, `foldlWhen t ...`, 与

```
 cons x r a = if t x then r (f a x) else r a 
```

等等

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-24T20:47:08.273

我找到了一种使用与您的方法非常相似的方法：

```
myzip = foldr step (const []) :: [a] -> [b] -> [(a,b)]
    where step a f (b:bs) = (a,b):(f bs)
          step a f [] = [] 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-24T21:00:15.347

对于这里的非本地 Haskeller，我编写了该算法的 Scheme 版本，以便更清楚地了解实际发生的情况：

```
> (define (zip lista listb)
    ((foldr (lambda (el func)
           (lambda (a)
             (if (empty? a)
                 empty
                 (cons (cons el (first a)) (func (rest a))))))
         (lambda (a) empty)
         lista) listb))
> (zip '(1 2 3 4) '(5 6 7 8))
(list (cons 1 5) (cons 2 6) (cons 3 7) (cons 4 8)) 
```

结果`foldr`是一个函数，当应用于列表时，将返回列表的 zip 与给定函数的列表折叠在一起。`lambda`由于惰性求值，Haskell 隐藏了内部。

* * *

进一步分解：

输入 zip：'(1 2 3) 调用 foldr 函数

```
el->3, func->(lambda (a) empty) 
```

这扩展为：

```
(lambda (a) (cons (cons el (first a)) (func (rest a))))
(lambda (a) (cons (cons 3 (first a)) ((lambda (a) empty) (rest a)))) 
```

如果我们现在要返回它，我们将有一个函数，它接受一个元素的列表并返回对（3 个元素）：

```
> (define f (lambda (a) (cons (cons 3 (first a)) ((lambda (a) empty) (rest a)))))
> (f (list 9))
(list (cons 3 9)) 
```

继续，foldr 现在调用 func 与

```
el->3, func->f ;using f for shorthand
(lambda (a) (cons (cons el (first a)) (func (rest a))))
(lambda (a) (cons (cons 2 (first a)) (f (rest a)))) 
```

这是一个函数，它现在接受一个包含两个元素的列表，然后用 zip 压缩它们`(list 2 3)`：

```
> (define g (lambda (a) (cons (cons 2 (first a)) (f (rest a)))))
> (g (list 9 1))
(list (cons 2 9) (cons 3 1)) 
```

发生了什么？

```
(lambda (a) (cons (cons 2 (first a)) (f (rest a)))) 
```

`a`，在这种情况下，是`(list 9 1)`

```
(cons (cons 2 (first (list 9 1))) (f (rest (list 9 1))))
(cons (cons 2 9) (f (list 1))) 
```

而且，您还记得，`f`它的论点用 .zip 压缩`3`。

这继续等等......

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-03-01T21:47:52.047

所有这些解决方案的问题`zip`在于它们只折叠一个列表或另一个列表，如果他们都是“好生产者”，这可能是一个问题，用列表融合的说法。您真正需要的是一个可以折叠两个列表的解决方案。幸运的是，有一篇关于这方面的论文，名为[“Coroutining Folds with Hyperfunctions”](https://arxiv.org/pdf/1309.5135.pdf)。

你需要一个辅助类型，一个超函数，它基本上是一个以另一个超函数作为参数的函数。

```
newtype H a b = H { invoke :: H b a -> b } 
```

这里使用的超函数基本上就像普通函数的“堆栈”。

```
push :: (a -> b) -> H a b -> H a b
push f q = H $ \k -> f $ invoke k q 
```

您还需要一种将两个超功能端到端组合在一起的方法。

```
(.#.) :: H b c -> H a b -> H a c
f .#. g = H $ \k -> invoke f $ g .#. k 
```

这与`push`法律有关：

```
(push f x) .#. (push g y) = push (f . g) (x .#. y) 
```

结果证明这是一个关联运算符，这就是恒等式：

```
self :: H a a
self = H $ \k -> invoke k self 
```

您还需要忽略“堆栈”上的所有其他内容并返回特定值的东西：

```
base :: b -> H a b
base b = H $ const b 
```

最后，您需要一种从超函数中获取值的方法：

```
run :: H a a -> a
run q = invoke q self 
```

`run`将所有`push`ed 函数首尾相连，直到遇到 a`base`或无限循环。

所以现在你可以将两个列表折叠成超函数，使用从一个到另一个传递信息的函数，并组装最终值。

```
zip xs ys = run $ foldr (\x h -> push (first x) h) (base []) xs .#. foldr (\y h -> push (second y) h) (base Nothing) ys where
  first _ Nothing = []
  first x (Just (y, xys)) = (x, y):xys

  second y xys = Just (y, xys) 
```

折叠两个列表之所以重要，是因为 GHC 所做的称为*列表融合的东西，*[在 GHC.Base 模块](http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#build)中讨论过，但可能应该更知名。成为一个好的列表生成器并使用`build`with`foldr`可以防止大量无用的生成和立即消耗列表元素，并且可以进一步优化。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-01-12T12:44:24.050

我试图自己理解这个优雅的解决方案，所以我尝试自己推导类型和评估。所以，我们需要写一个函数：

```
zip xs ys = foldr step done xs ys 
```

在这里，我们需要导出`step`and `done`，无论它们是什么。Recall[`foldr`](http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:foldr)的类型，实例化为列表：

```
foldr :: (a -> state -> state) -> state -> [a] -> state 
```

但是，我们的`foldr`调用必须实例化为如下所示，因为我们必须接受的不是一个，而是两个列表参数：

```
foldr :: (a -> ? -> ?) -> ? -> [a] -> [b] -> [(a,b)] 
```

因为`->`是[右关联的](https://stackoverflow.com/q/34720928/596361)，这相当于：

```
foldr :: (a -> ? -> ?) -> ? -> [a] -> ([b] -> [(a,b)]) 
```

我们`([b] -> [(a,b)])`对应`state`于原始`foldr`类型签名中的类型变量，因此我们必须用它替换每一个出现`state`：

```
foldr :: (a -> ([b] -> [(a,b)]) -> ([b] -> [(a,b)]))
      -> ([b] -> [(a,b)])
      -> [a]
      -> ([b] -> [(a,b)]) 
```

这意味着我们传递给的参数`foldr`必须具有以下类型：

```
step :: a -> ([b] -> [(a,b)]) -> [b] -> [(a,b)]
done :: [b] -> [(a,b)]
xs :: [a]
ys :: [b] 
```

回想一下，`foldr (+) 0 [1,2,3]`扩展为：

```
1 + (2 + (3 + 0)) 
```

因此，如果`xs = [1,2,3]`和`ys = [4,5,6,7]`，我们的`foldr`调用将扩展为：

```
1 `step` (2 `step` (3 `step` done)) $ [4,5,6,7] 
```

这意味着我们的`1 `step` (2 `step` (3 `step` done))`构造必须创建一个递归函数，该函数将遍历`[4,5,6,7]`并压缩元素。（请记住，如果原始列表之一较长，则多余的值将被丢弃）。IOW，我们的构造必须具有类型`[b] -> [(a,b)]`。

`3 `step` done`是我们的基本情况，其中`done`是一个初始值，如`0`. `foldr (+) 0 [1..3]`我们不想在 3 之后压缩任何东西，因为 3 是 的最终值`xs`，所以我们必须终止递归。在基本情况下如何终止对列表的递归？你返回空列表`[]`。但回想一下`done`类型签名：

```
done :: [b] -> [(a,b)] 
```

因此我们不能只返回`[]`，我们必须返回一个忽略它接收到的任何东西的函数。因此使用[`const`](http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:const)：

```
done = const [] -- this is equivalent to done = \_ -> [] 
```

现在让我们开始弄清楚`step`应该是什么。它将一个类型的值`a`与一个类型的函数结合起来，`[b] -> [(a,b)]`并返回一个类型的函数`[b] -> [(a,b)]`。

在`3 `step` done`中，我们知道稍后将进入我们的压缩列表的结果值必须是`(3,6)`（从原始`xs`和知道`ys`）。因此`3 `step` done`必须评估为：

```
\(y:ys) -> (3,y) : done ys 
```

请记住，我们必须返回一个函数，在其中我们以某种方式压缩元素，上面的代码是有意义的和类型检查的。

现在我们假设应该如何`step`评估，让我们继续评估。以下是我们`foldr`评估中所有减少步骤的样子：

```
3 `step` done -- becomes
(\(y:ys) -> (3,y) : done ys)
2 `step` (\(y:ys) -> (3,y) : done ys) -- becomes
(\(y:ys) -> (2,y) : (\(y:ys) -> (3,y) : done ys) ys)
1 `step` (\(y:ys) -> (2,y) : (\(y:ys) -> (3,y) : done ys) ys) -- becomes
(\(y:ys) -> (1,y) : (\(y:ys) -> (2,y) : (\(y:ys) -> (3,y) : done ys) ys) ys) 
```

评估产生了这个步骤的实现（请注意，我们`ys`通过返回一个空列表来说明元素提前用完）：

```
step x f = \[] -> []
step x f = \(y:ys) -> (x,y) : f ys 
```

因此，完整的功能`zip`实现如下：

```
zip :: [a] -> [b] -> [(a,b)]
zip xs ys = foldr step done xs ys
  where done = const []
        step x f [] = []
        step x f (y:ys) = (x,y) : f ys 
```

PS：如果你受到优雅折叠的启发，请阅读[*使用 foldr 编写 foldl*](https://stackoverflow.com/a/28754327/596361)，然后阅读 Graham Hutton 的[*关于 fold 的普遍性和表现力的教程*](http://www.cs.nott.ac.uk/~gmh/fold.pdf)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-11-30T04:38:36.947

一个简单的方法：

```
lZip, rZip :: Foldable t => [b] -> t a -> [(a, b)]

-- implement zip using fold?
lZip xs ys = reverse.fst $ foldl f ([],xs) ys
     where f  (zs, (y:ys)) x = ((x,y):zs, ys)

-- Or;
rZip xs ys = fst $ foldr f ([],reverse xs) ys
     where f x (zs, (y:ys))  = ((x,y):zs, ys) 
```

# frameworks - 游戏编程 - 如何避免重新发明轮子

> ID：235151
> 
> 赞同：11
> 
> 时间：2008-10-24T20:30:24.657
> 
> 标签：frameworks, choice

概括：

> **我可以在不重新发明轮子的情况下用 C 编写“厚客户端”游戏**，还是应该硬着头皮使用一些库或 SDK？我是一个中等的 C 程序员，并且不害怕使用指针、数据结构、内存位置等。如果它能给我制作一个伟大的“厚客户端”游戏所需的控制权。*但是，我正在考虑为了权力和控制而不是* 易用性而避开高级语言和框架。

有时我对修补 2D 格斗/平台游戏作为一个副项目很感兴趣。我主要是一名具有 Python、Ruby 和 PHP 经验的 Linux 服务器端程序员。我知道其中一些语言有很好的框架，比如[PyGame](http://www.pygame.org/news.html)。我也知道人们在 Air 和 .NET 等方面取得的成功......但我有一些担忧：

*   **性能**：脚本语言是出了名的慢。如果我正在制作一款实时游戏，我希望它尽可能快。
*   **庞大的二进制文件**：使用 .NET 之类的框架或 Ruby 之类的脚本语言通常会导致您不需要的大型 CLR 或库。我想做的游戏会小而简单——我不希望它的CLR比游戏本身大！
*   **额外的东西**：老实说，我只是不喜欢继承一些大型游戏库的包袱，如果我能更好地围绕我自己的代码。

我问这个问题是因为我知道我很容易患上这里没有发明综合症。我一直想自己编程，我敢肯定这会浪费很多时间。然而，这对我来说非常有效——例如，我没有使用[Rails](http://www.rubyonrails.org/)（一个非常大的 Web 项目框架，其中包含一个 ORM 和 GUI 工具包），而是使用了一系列较小的 Ruby 工具，如[rack](http://rack.rubyforge.org/)和[sequel](http://sequel.rubyforge.org/)组合在一起漂亮。

所以，我转向你，SO专家。我是不是太天真了？这是我的看法：

*   **使用 C**
    *   **缺点**
        *   可能会让我讨厌编程
        *   重新发明轮子的高风险
        *   需要很长时间以至于我失去兴趣的高风险
    *   **优点**
        *   久经考验 - 大多数 A-list 游戏都是用 C 语言完成的（今天仍然如此吗？）
        *   对内存管理、速度、资产管理等的高度控制，我相信自己会学会处理这些
        *   没有杂物
*   **使用框架或 SDK**
    *   **缺点**
        *   交付物过大的风险
        *   在游戏开发的各个方面都依赖于原始库作者——如果没有我想要的功能怎么办？我必须自己编程，这还不错，但首先部分违背了使用高级框架的目的
        *   性能问题的高风险
    *   **优点**
        *   更快的开发时间
        *   可能更容易维护
        *   没有浪费时间重新发明通用范式

我还能在这个列表中添加什么？这是一个纯粹的判断电话，还是有人可以为我达成交易？欢迎提出书籍建议。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-24T20:53:11.337

我相信你在一个谬误下工作。

有几个专门用于游戏编程的框架——由对游戏设计复杂性有丰富经验的人编写，几乎可以肯定比你做的更多。

换句话说，如果您不使用框架，您将面临“性能问题的高风险”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-19T15:13:18.200

我目前的想法是：

*   如果您想学习编程，请从基本元素开始制作游戏引擎（甚至实现基本数据结构 - 列表、地图等）。我做过一次，虽然这是一次学习经历，但我犯了很多错误，我不会再这样做了。然而，对于学习如何编程以及制作一些很酷的东西并看到结果，我会给予很高的评价。

*   如果您想制作一款合适的游戏，请使用您想要的任何库并自己设计所有游戏基础架构。这就是我现在正在做的事情，我正在使用所有好的东西，比如 STL、ATL/WTL、Boost、SQLite、DirectX 等。到目前为止，我已经学到了很多关于中间/游戏逻辑方面的知识代码和设计。

*   如果您只是想与艺术家和其他人合作创建成品游戏，请使用现有引擎之一（OGRE、Irrlicht、Nebula、Torque 等），然后添加您的游戏逻辑和艺术。

我学到的最后一点智慧是不要担心这里没有发明综合症。我开始意识到其他库（例如 STL、Boost、DirectX 等）的开发时间要多一个数量级（或三个），远远超过我在这部分上花费的时间游戏/引擎。因此，您自己实现这些东西的唯一原因是您是否想了解它们。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-24T21:45:29.000

我建议您尝试[pyglet](http://www.pyglet.org/)。

*   它具有良好的性能，因为它利用了opengl
*   它是一个紧凑的一体化库
*   它除了python没有额外的依赖

做一些测试，看看你是否可以让它足够快。只有当你向自己证明它没有下降到更低的水平时。虽然，我相当有信心 python + pyglet 可以处理它......在最坏的情况下你必须编写一些 C 扩展。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-24T20:47:32.907

今天，我相信您可以放心地忽略性能问题，除非您专门尝试做一些突破极限的事情。例如，如果您的游戏不比 Quake II 复杂，那么您应该选择能让您在时间上发挥最大作用的工具和**库**。

我为什么选择 Quake II？因为在[为 .NET 编译的版本中](http://www.vertigosoftware.com/Quake2.htm)运行，所以它在当前机器上以超过可接受的帧速率与软件渲染器一起运行。（如果您喜欢 - 比较以可接受的速率模拟多个处理器和图形硬件的 MAME）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-24T21:07:27.500

您需要问自己，您是在构建引擎还是构建游戏。如果您的目的是创建游戏，那么您绝对应该查看已建立的游戏引擎。对于 2D 游戏开发，请查看[Torque Game Builder](http://www.garagegames.com/products/torque/tgb/)。它是一个非常强大的 2D 游戏引擎/SDK，可以让您从第一天开始投入生产。他们有很多与之集成的工具、内容包，如果您想进行更改和/或学习，您可以获得完整的源代码这个怎么运作。它还兼容 Mac OSX，并且在社区中有 Linux 版本。

如果您正在控制台方面寻找东西，他们也有。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-11T00:22:49.103

我很惊讶没有人提到[XNA](http://www.xna.com/)。它是一个围绕 DirectX 构建的框架，用于进行托管 DirectX 编程，同时消除了较低级别 DirectX 编程的大量绒毛和冗长。

性能方面，对于大多数 2D 和 3D 游戏任务，尤其是构建类似格斗游戏的东西，这个平台运行得非常好。它不像你在做裸机 DirectX 编程*那样快，但它让你非常接近，并且在托管环境中，同样如此。*

XNA 的另一个很酷的好处是大部分代码都可以在 Xbox 360 上运行，甚至可以通过网络连接进行调试（如果游戏在 Xbox 上运行）。XNA 游戏现在也可以通过 Xbox Live 团队的批准在 Xbox Live Arcade 上分发和销售。因此，如果您希望将项目带入商业状态，您可能有可用的分发方式供您使用。

像所有 MS 开发工具一样，文档和支持是一流的，并且有一个庞大的开发者社区，其中包含大量教程、现有项目等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-24T20:41:25.197

您希望能够在控制台上玩游戏吗？你想把它作为一种学习体验吗？您希望最终产品是跨平台的吗？到目前为止，您查看过哪些图书馆？

对于 2d 游戏，我认为性能不会成为问题，我建议使用可以在最短的时间内让你在屏幕上显示结果的东西。如果你有很多使用 Python 的经验，那么 pyGame 是一个不错的选择。

如果你打算将来做一些 3d 游戏，我建议你看看 Ogre ( [http://www.ogre3d.org](http://www.ogre3d.org) )。它是一个跨平台的 3d 图形引擎，可以抽象出图形 API。然而，对于 2d 项目，它可能是矫枉过正。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-24T20:44:12.213

当今顶级游戏最常见的实现语言是 C++，并且很多游戏都嵌入了用于游戏事件脚本的脚本语言（例如 Python 或 Lua）。

您用于编写游戏的工具与您编写游戏的原因以及您的要求有很大关系。这与任何其他编程项目没有什么不同，真的。如果它是一个附带项目，并且您是自己做的，那么只有您可以评估您需要花费多少时间以及您的性能要求是什么。

一般来说，今天的 PC 足以运行以脚本语言编写的 2D 平台游戏。使用脚本语言可以让您更快地制作原型，并且您将有更多时间来调整游戏玩法。同样，这与任何其他项目没有什么不同。

如果您使用 C++，并且您的理由不必比“因为我想要”更详细，我建议您查看 SDL 以获得渲染和音频支持。它会让事情变得更容易一些。

如果你想学习底层技术（DirectX，或者你想编写优化的 blitter 出于某种不正当的原因），那么一定要使用 C++。

说了这么多，我会提醒你不要过早优化。对于 2D 游戏，您最好先使用 Python 和 PyGame。如果这些工具在现代 PC 上被证明是不合适的，我会感到惊讶。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-24T21:16:23.643

至于人们对 C/C++/Python 的评价，我是一名游戏开发者，我的公司鼓励 C。不是 b/c C++ 不好，而是因为写得不好的 C++ 是游戏开发的毒药，因为它很难阅读/与 C 相比，调试。（正确使用 C++ 会带来好处，但如果让初级人员使用它会犯一些错误，您的时间会浪费很多）

至于实际问题：如果您的目的只是让某些东西正常工作，请使用库。

否则，出于一个非常重要的原因，自己编写代码：*练习*
操作数据结构的练习。有时您需要管理自己的数据。练习调试实用程序代码。

通常，lib 可以满足您的需求并且很棒，但有时*您*的特定用例被 lib 处理得非常糟糕，您将从编写自己的代码中获得很大的好处。与 PC 相比，尤其是在游戏机上

（编辑：）关于脚本和垃圾收集：它*会*在控制台上杀死你，在最近的一个游戏中，我不得不在虚幻引擎上重写垃圾收集的主要部分，以满足我们在*编辑器*部分的需求。在实际游戏中必须完成更多工作（不仅仅是我）（公平地说，尽管我们正在超越虚幻的原始规格）

脚本通常很好，但它不是“我赢”按钮。一般来说，如果您突破平台的限制，收益就会消失。在决定脚本的合适程度时，我会使用“我必须保留的平台 CPU 百分比”作为我的评估函数

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-19T16:15:48.370

支持 C/C++/obj-C 的一个考虑因素是，您可以针对不同的关注领域混合和匹配各种库。换句话说，您不会被框架中某个功能的实现所困。

[我在我的游戏](http://physle.com)中使用这种方法；使用[花栗鼠](http://wiki.slembcke.net/main/published/Chipmunk)进行 2D 物理，Lua 作为嵌入式脚本语言，以及 Apple 的 openGL ES 实现。我用 C 语言编写了胶水将所有这些联系在一起。最终产品是定义游戏对象、创建它们的实例以及在它们在暴露给 Lua 的 C 函数中相互交互时处理事件的能力。这种方法在[许多高性能游戏](http://en.wikipedia.org/wiki/Lua_(programming_language)#Games)中得到了很大的成功。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-24T21:00:37.513

如果您还不了解 C++，我肯定会建议您继续使用脚本语言。从头到尾制作一款游戏需要很大的动力，同时强迫自己学习一门新语言是让事情进展得足够慢以至于失去兴趣的好方法（尽管这是学习新语言的好方法语言...）。

大多数脚本语言无论如何都会被编译为字节码，因此它们最大的性能损失将是垃圾收集。我没有足够的经验来明确描述命中垃圾收集有多大，但我倾向于认为在小型游戏中它应该不会太糟糕。

此外，如果您使用现有的脚本语言库来制作游戏，那么大多数性能关键区域（如图形）无论如何都可以用 C++ 编写（希望由游戏库编写）。因此，尽管您的大部分项目都是用 Python 编写的，但实际上 80% 的 CPU 可能实际上都花在了 C++ 代码中。

我想说，问问自己你还想要什么：从头到尾编写游戏并学习游戏开发，或者学习一门新语言（C++）。如果您想编写游戏，请使用脚本语言。如果您想学习一门新语言，请使用 C++。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-24T21:09:09.370

是的，除非你只是想了解制作游戏的所有细节，否则你肯定想要使用游戏引擎，只专注于构建游戏逻辑，而不是图形、音频、资源管理的细节，等等

我个人喜欢推荐[GarageGames](http://www.garagegames.com)的 Torque Game Builder（又名 Torque 2D） 。但是您可能也可以找到一些满足您需求的免费游戏引擎。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-24T20:50:02.230

我很确定大多数现代游戏都是用 C++ 完成的，而不是 C。（我采访过的每家游戏公司都问过 C++ 问题。）
为什么不使用 C++ 和现有的库来处理物理 + 碰撞、声音、图形引擎等。你仍然写游戏，但世俗的东西得到了照顾。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-12-16T20:47:50.700

抽象问题有很多不同的解决方案，每种解决方案都以不同的方式处理它。

我当前的项目使用 C#、DirectX 9、HLSL 和 SlimDX。这些中的每一个都提供了经过仔细校准的抽象级别。HLSL 允许我实际读取我正在编写的着色器代码，而 SlimDX/C# 允许我忽略指针、循环依赖和处理非托管代码。

也就是说，这些技术都不会影响我开发人工智能、照明或物理的难易程度！我仍然必须以一种我不会使用更高级别的框架的方式来分解我的教科书。

即使使用像 XNA 这样的框架，如果大多数视频游戏开发概念对您来说都是陌生的，那么仍然有很多东西需要学习和学习。XNA 将允许您巧妙地避开万向节锁定，但对于那些不了解基本着色概念的人来说，可悲了。另一方面，像 DarkBASIC 之类的东西不会解决您的万向节锁定问题，但阴影主要是为您处理的。

这是一个足够大的领域，您的第一个引擎永远不会是您实际使用的引擎。如果你自己写，你写得不够好。如果您使用第三方库，肯定有一些方面会惹恼您并且您会想要替换。

作为一个想法，可能值得采用各种库/框架（一定要让 XNA 成为您的一站，即使您决定不想使用它，它也是一个很好的基准）并尝试构建各种原型。也许是风景（有水体）或空间物理演示。

# .net - 将 .NET StreamWriter 输出重定向到字符串变量

> ID：235156
> 
> 赞同：38
> 
> 时间：2008-10-24T20:31:24.703
> 
> 标签：.net, streamwriter

我想知道是否可以将 StreamWriter 输出重定向到变量

就像是

```
String^ myString;
StreamWriter sw = gcnew StreamWriter([somehow specify myString])
sw->WriteLine("Foo"); 
```

那么 myString 将包含 Foo。我想这样做的原因是重用一个复杂的函数。我可能应该将它重构为一个字符串返回函数，但它仍然是一个很好的 hack 知道

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-24T20:42:40.950

您可以使用 StringWriter 将值直接写入字符串构建器对象来执行此操作

```
StringBuilder sb = new StringBuilder();
StringWriter sw = new StringWriter(sb);
// now, the StringWriter instance 'sw' will write to 'sb' 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-10-24T20:40:17.570

[StreamWriter](http://msdn.microsoft.com/en-us/library/system.io.streamwriter.aspx)和[StringWriter](http://msdn.microsoft.com/en-us/library/system.io.stringwriter.aspx)都扩展了 TextWriter，也许您可​​以重构使用 StreamWriter 的方法以改用 TextWriter，以便它可以写入流或字符串？

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2015-04-16T15:38:58.220

您应该能够使用 Memory Stream 执行所需的操作。

```
MemoryStream mem = new MemoryStream(); 
StreamWriter sw = new StreamWriter(mem);
sw.WriteLine("Foo"); 
// then later you should be able to get your string.
// this is in c# but I am certain you can do something of the sort in C++
String result = System.Text.Encoding.UTF8.GetString(mem.ToArray(), 0, (int) mem.Length); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-05-15T03:37:56.880

试试这个代码=]

```
StringBuilder sb = new StringBuilder();
StringWriter sw = new StringWriter(sb);
string s = sb.ToString(); <-- Now it will be a string. 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T20:41:49.940

正如您提到的那样，重构方法以返回字符串。以你尝试的方式来破解它，虽然在学术上很有趣，但会使代码变得混乱，并且让任何跟随你的人都很难维护它。

# asp.net - 如何在运行时设置 ObjectDataSource 选择参数

> ID：235166
> 
> 赞同：21
> 
> 时间：2008-10-24T20:35:56.830
> 
> 标签：asp.net, objectdatasource

我正在尝试在运行时向 objectDataSource 添加参数，如下所示：

```
 Parameter objCustomerParameter = new Parameter("CustomerID", DbType.String, customerID);
        Parameter objGPDatabaseParameter = new Parameter("Database", DbType.String, gpDatabase);

        //set up object data source parameters
        objCustomer.SelectParameters["CustomerID"] = objCustomerParameter;
        objCustomer.SelectParameters["Database"] = objGPDatabaseParameter; 
```

应该在 objectDataSource 生命周期的哪个时间点添加这些参数（什么事件）？此外，一些值来自母版页属性（在包含 objectDataSource 的页面的 page_load*之后加载）。*

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-25T13:43:12.647

将它们添加到您尝试使用的操作的事件中。例如，如果这些参数是 SELECT 命令的一部分，则将它们添加到 Selecting 事件中，如果它们需要使用 UPDATE 命令，则将它们添加到 Updating 事件中。

ObjectDataSource 在执行每个操作之前引发一个事件，此时您可以插入参数（或验证/更改现有参数）。

另外，不要尝试修改ODS本身的参数集合。您希望将参数添加到传递给事件处理程序的 ObjectDataSourceSelectingEventArgs。

就像是：

```
e.InputParameters["CustomerID"] = customerId;
e.InputParameters["database"] = dbName; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T20:49:29.160

尽早添加；在`PreInit`活动中。这是初始化的一部分，所以应该在那里完成。

有关详细信息，请参阅[ASP.NET 页面生命周期概述](http://msdn.microsoft.com/en-us/library/ms178472.aspx)。

# sharepoint - 提交问题 - 一次发送到 2 个位置

> ID：235167
> 
> 赞同：1
> 
> 时间：2008-10-24T20:35:56.923
> 
> 标签：sharepoint, infopath

当用户点击提交时，如何将 InfoPath 表单提交到 SharePoint 库和电子邮件箱？

我需要我的表单以特定顺序被多个用户批准；然后重新提交到 SharePoint 站点和另一个电子邮件箱，以便下一个批准者可以看到批准，并批准他们自己的批准，然后提交并让它再次放到 Sharepoint 上，等等。

电子邮件链有效（表单作为附件），并且显示批准，但表单不会在 SharePoint 表单库上更新。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-03T22:23:33.757

您可以添加额外的数据源以进行提交（发送到 SharePoint 库），并在保存和关闭规则之前将规则添加到您的提交按钮。

但是 - 我会建议一种基于工作流的方法和一个保存在 SharePoint 网站上的表单。我有一个非常相似的任务，需要分阶段获得批准。

如果有固定数量的批准者，请为每个批准者创建字段 - 如果数量不固定，您将需要一些替换规则，将当前批准者更改为下一个批准者。然后，您将需要一个（或多个）由您之前提升的标志字段（或多个）触发的工作流。（使它们在发布期间可从外部写入 - 工作流将需要它）此字段（或多个字段）触发发送电子邮件的工作流。发送后应清除该标志以避免无限循环。

邮件应包含指向 SharePoint 库的链接。审批者应该在那个库上工作，而不是通过网络发送 XML 文件。

*提示*：在该库上启用版本控制 - 您（或批准者）可以跟踪更改。

*提示 2*：如果此过程将成为日常工作的一部分，也许自定义视图和警报将帮助审批者跟踪表单的状态。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T21:08:26.453

Sorry for asking but have you considered using a workflow rather then emails? I'm not sure whether the basic workflows in WSS 3.0 will cater for your senario but the MOSS workflow should be more than adequate.

# templates - 在哪里可以找到最好的用户故事模板？

> ID：235188
> 
> 赞同：35
> 
> 时间：2008-10-24T20:41:41.123
> 
> 标签：templates, agile, methodology, extreme-programming

我想在一个新项目中实现用户故事，我在哪里可以找到一个好的模板或敏捷开发中使用的其他模板？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-24T21:16:51.663

我找到的最好的模板是：

```
As a <user> I want to <do something> so that <I can accomplish goal>. 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-27T16:04:48.990

请参阅九个框技术来详细说明您的用户故事。它本身并不是一个真正的模板，但它会导致填写“**作为用户，我想要......所以......** ”模板，这是非常有效的。[迈克科恩比我解释得更好](http://blog.mountaingoatsoftware.com/?p=24)。

它还允许发现非功能性需求（*[**ilities**](http://en.wikipedia.org/wiki/List_of_system_quality_attributes)*）。

编辑：九盒页面的原始链接现已被域名抢注，但该页面可在[互联网档案](http://web.archive.org/web/20071217082912/http://dnicolet1.tripod.com/agile/index.blog/1765142/nine-boxes/)中找到。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-24T20:48:49.223

Alistair Cockburn 有一个[用例模板](http://alistair.cockburn.us/Basic+use+case+template)。Dan North 将其用于[用户故事](http://dannorth.net/whats-in-a-story)。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-01-02T11:53:40.450

一个更关注用户目标的更好的是：

```
In order to <accomplish a goal>, as a <user> I want to <do something> 
```

这种格式鼓励每个人思考用户想要达到的目标，并且可以提示您的团队改变用户的角色或重新思考整个美国。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T20:47:20.850

请记住，用户故事的核心在于与客户的*对话*以及自动化验收测试：[http ://www.xprogramming.com/xpmag/expCardConversationConfirmation.htm](http://www.xprogramming.com/xpmag/expCardConversationConfirmation.htm)

# python - Pylons Routes 中的尾部斜线

> ID：235191
> 
> 赞同：7
> 
> 时间：2008-10-24T20:42:08.533
> 
> 标签：python, routes, pylons

在最新版本的 Routes (1.10) 中使尾部斜杠无关紧要的最佳方法是什么？我目前正在使用明显非 DRY：

```
map.connect('/logs/', controller='logs', action='logs')
map.connect('/logs', controller='logs', action='logs') 
```

我认为打开最小化可以解决问题，但我的印象是它在较新版本的 Routes 中被禁用是有原因的。不幸的是，文档似乎没有跟上 Routes 的开发，所以我找不到任何好的资源。有任何想法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-09-17T20:19:09.237

作为最后一条路线添加的以下片段对我有用：

```
map.redirect('/*(url)/', '/{url}',
             _redirect_code='301 Moved Permanently') 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-24T20:58:16.100

有两种可能的方法来解决这个问题：

1.  [完全在 pylons 中完成](http://wiki.pylonshq.com/display/pylonscookbook/Adding+trailing+slash+to+pages+automatically)。
2.  [添加一个 htaccess 规则来重写尾部斜杠](http://enarion.net/web/apache/htaccess/trailing-slash/)。

就我个人而言，我不喜欢斜杠，因为如果你有这样的 uri：

[http://example.com/people](http://example.com/people)

您应该能够通过以下方式获取 xml 格式的相同数据：

[http://example.com/people.xml](http://example.com/people.xml)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-10T13:19:46.337

[http://www.siafoo.net/snippet/275](http://www.siafoo.net/snippet/275)有一个基本的中间件，它从请求中删除尾部斜杠。聪明的想法，在我意识到它的作用之后，我更好地理解了 WSGI 应用程序中的中间件的概念。

# markdown - 将 HTML 转换回 Markdown 以便在 wmd 中进行编辑

> ID：235224
> 
> 赞同：18
> 
> 时间：2008-10-24T20:54:01.303
> 
> 标签：markdown, wmd

我很想知道当您在此站点上编辑帖子时会发生什么。

我将 wmd 用于我的降价编辑器，当然当我去编辑时，我得到的 HTML 不是像 stackoverflow 上那样的降价。现在，有没有办法可以同时存储两者？还是将HTML简单地转换回markdown以在wmd编辑器中显示是否足够可靠？

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-10-03T14:32:13.797

如果您想将 HTML 批量转换为 Markdown，我可以推荐 [Aaron Swartz 的 html2text.py Python 脚本](http://www.aaronsw.com/2002/html2text/)，您可以使用它：

```
cat my.html | python html2text.py # outputs markdown 
```

**2012 年 5 月 11 日编辑：**现在我使用[Pandoc](http://johnmacfarlane.net/pandoc/README.html)，它就像是用于文本文档的瑞士刀。可以转换html<>textile<>markdown<>epub<>pdf<>latex等

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-24T20:57:25.430

看看`optionsExample.html`你的大规模杀伤性武器分布。可以选择将结果作为 Markdown 发送到服务器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-31T06:32:32.283

正如 Chris 所说，您可以将 Markdown 发送到服务器，以便将其存储在那里。我开始尝试使用 MarkdownJ 在服务器端进行转换，但它没有（在撰写本文时）正确地将图像转换为 HTML，因此我最终使用了 Java 6 脚本：Rhino 引擎 + showdown.js。由于 WMD 使用 showdown.js，您可以获得相同的 Markdown 到 HTML 转换。像魅力一样工作（无论如何，对于 Java 6）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-04T00:52:39.803

我刚刚知道[Markdownify](http://milianw.de/projects/markdownify/)（以前称为 html2text.php）“在 Markdown 中编写文本并将它们保存在 HTML 中。您不需要原始 Markdown 输入的副本，因为 Markdownify 可以将保存的 HTML 转换回 Markdown。因为页面展示次数远多于写入操作，这为您提供了一种提高页面性能的简单方法。CMS 或类似软件的另一个好处是现在只保存一种文本格式 - HTML。用户现在可以选择是否写入纯 HTML 文本或使用成熟的所见即所得编辑器。当然他可以用 Markdown 编写！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-12-09T23:05:46.687

开源 html 到用 JavaScript 编写的降价转换器：

*   [domchristie/to-markdown](https://github.com/domchristie/to-markdown)

    MarkItDown：将富文本复古转换为 Markdown。[在线尝试](http://markitdown.medusis.com/)。

*   [bambax/MarkItDown](https://github.com/bambax/markitdown.medusis.com)

    用 JavaScript 编写的 HTML 到 Markdown 转换器。[在线尝试](http://domchristie.github.io/to-markdown)。

# templates - 编辑 Template Monster .fla 文件时出现问题

> ID：235226
> 
> 赞同：0
> 
> 时间：2008-10-24T20:55:00.740
> 
> 标签：templates, flash

我在这方面运气最差。我们购买了一个模板来更新我们自己的网站（没有足够的时间从头开始我们自己的网站！）但是当我对 Flash CS4 原生文件进行简单更改并重新导出 swf 时，它无法正常工作！

我想知道是否有人在 Template Monster Flash 网站模板中遇到过同样的问题。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-24T22:17:29.433

请通过“它无法正常工作！”的含义向我们提供更多详细信息。文字大小不对？按钮不起作用？整个屏幕都是空白的？等等等等

要尝试的一件事是检查您要导出到哪个版本的 flash 和哪个版本的 actionscript，确保它们与设计时使用的版本相同。您也可以尝试下载旧版本的 Flash，看看是否能解决问题（它们都有 30 天的试用期）。最后，你确实为产品付了钱，如果它有缺陷，请联系卖给你的人。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T10:03:47.363

***使用flash mx ppl ..这很容易..***

# forms - 如何使用 drupal 6.x 视图 2 向视图添加表单？

> ID：235228
> 
> 赞同：3
> 
> 时间：2008-10-24T20:55:06.450
> 
> 标签：forms, drupal, drupal-views, views2

我想在视图顶部添加一个 drupal 表单。视图不需要接收表单的结果，但表单的 _submit 钩子应该能够读取表单所在视图的第一个参数。

添加这个的最佳位置在哪里？自定义模块或模板文件以及必要的文件名/挂钩是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T17:49:20.027

看来你想要的钩子是

```
_views_pre_view 
```

使用变量 $view, $display_id, $args 并且您希望将 $view->attachment_before 设置为等于表单。

# c# - 从 C# 程序读取 Outlook 消息时如何避免 Outlook 安全警报

> ID：235231
> 
> 赞同：15
> 
> 时间：2008-10-24T20:56:04.450
> 
> 标签：c#, outlook

我需要从 C# 程序读取 Outlook 收件箱中新邮件的主题、发件人地址和邮件正文。但是我收到了安全警报“一个程序正在尝试访问您存储在 Outlook 中的电子邮件地址。你想允许这个吗？

通过一些谷歌搜索，我发现很少有第三方 COM 库可以避免这种情况。但我正在寻找一种不需要任何第三方 COM 库的解决方案。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-07-28T22:55:23.193

我在访问 Outlook 邮件项目的发件人电子邮件地址时遇到了同样的问题。为了避免“安全警报”，不要创建新的应用程序对象，而是使用**Globals.ThisAddIn.Application**来创建新的邮件项。

```
string GetSenderEmail(Outlook.MailItem item)
    {
        string emailAddress = "";
        if (item.SenderEmailType == "EX")
        {
            Outlook.MailItem tempItem = (Outlook.MailItem)Globals.ThisAddIn.Application.CreateItem(Outlook.OlItemType.olMailItem);
            tempItem.To = item.SenderEmailAddress;
            emailAddress = tempItem.Recipients[1].AddressEntry.GetExchangeUser().PrimarySmtpAddress.Trim();

        }
        else
        {
            emailAddress = item.SenderEmailAddress.Trim();

        }

        return emailAddress;
    } 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-24T21:14:09.810

抱歉，我在 Outlook 2003 和 Outlook 2007 加载项中都遇到了这个烦人的问题，唯一有效的解决方案是购买[兑换](http://www.dimastr.com/redemption/)许可证。据我所知，在 Outlook 2007 中，只有当您的防火墙已关闭或您的防病毒软件已过时，才会出现令人讨厌的弹出窗口。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-02T02:56:49.727

试试这个

工具-->宏-->安全-->程序访问

然后选择从不就可疑活动向我发出警告。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-02T03:05:06.790

“但我正在寻找一种不需要任何第三方 COM 库的解决方案。”

你不会找到它。Kasper 已经指出了我所知道的唯一解决方案。赎回是保持 Outlook 插件和代码正常工作的唯一方法。我为富兰克林柯维做过商业 Outlook 插件。我们探索了很多东西，但救赎是唯一让我们克服这一障碍的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T21:53:25.287

如果您的应用程序不是 Outlook 插件，您可以查看[MAPI](http://msdn.microsoft.com/en-us/library/ms528826(EXCHG.10).aspx)以从收件箱中读取数据

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-12T17:44:08.163

为此，我们使用Mapilab 的[Outlook Advanced Security 。](http://www.mapilab.com/outlook/security/)它是免费的，也可用于商业用途，并且仍然保证 Outlook 的安全（仅允许从批准的应用程序访问）。刚才提到的解决方案要么花钱，要么可能危及安全。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-20T17:02:00.853

您可以使用 Outlook 的信任中心禁用安全弹出窗口。[在这里](http://msdn.microsoft.com/en-us/library/bb226709.aspx)检查。

# asp.net-mvc - ASP.NET MVC - 控制器中应该存在业务逻辑吗？

> ID：235233
> 
> 赞同：99
> 
> 时间：2008-10-24T20:57:02.513
> 
> 标签：asp.net-mvc, design-patterns, controller, business-logic

几天前， Derik Whitaker 发表了[一篇文章](http://devlicio.us/blogs/derik_whittaker/archive/2008/10/22/how-is-interacting-with-your-data-repository-in-your-controller-different-or-better-than-doing-it-in-your-code-behind.aspx)，这引起了我一段时间以来的好奇：**业务逻辑是否应该存在于控制器中？**

到目前为止，我看到的所有 ASP.NET MVC 演示都将存储库访问和业务逻辑放在控制器中。有些甚至还会在那里进行验证。这导致了相当大、臃肿的控制器。这真的是使用MVC框架的方式吗？看起来这最终会导致大量重复的代码和逻辑分布在不同的控制器上。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-10-24T21:00:17.017

业务逻辑确实应该在模型中。你应该瞄准胖模型，瘦控制器。

例如，而不是：

```
public interface IOrderService{
    int CalculateTotal(Order order);
} 
```

我宁愿有：

```
public class Order{
    int CalculateTotal(ITaxService service){...}        
} 
```

这假设税收是由外部服务计算的，并且需要您的模型了解外部服务的接口。

这将使您的控制器看起来像：

```
public class OrdersController{
    public OrdersController(ITaxService taxService, IOrdersRepository ordersRepository){...}

    public void Show(int id){
        ViewData["OrderTotal"] = ordersRepository.LoadOrder(id).CalculateTotal(taxService);
    }
} 
```

或类似的东西。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2012-07-17T21:17:53.143

我喜欢[Microsoft Patterns & Practices](https://msdn.microsoft.com/en-us/library/hh404093.aspx)提供的图表。我相信这句格言“一张照片胜过千言万语”。

![该图显示了 MVC 和业务服务层的架构](https://i.stack.imgur.com/VqqTF.jpg)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-19T20:04:51.700

这是一个有趣的问题。

我认为有趣的是，大量示例 MVC 应用程序实际上未能遵循 MVC 范式，即真正将“业务逻辑”完全置于模型中。Martin Fowler 指出，MVC 不是四人组意义上的模式。相反，如果程序员要创建超出玩具应用程序的东西，则必须将模式添加*到*范式中。

所以，简短的回答是“业务逻辑”确实不应该存在于控制器中，因为控制器具有处理视图和用户交互的附加功能，我们只想创建一个目的的对象。

一个更长的答案是，在将逻辑从控制器移动到模型之前，您需要对模型层的设计进行一些思考。也许您可以使用 REST 处理所有应用程序逻辑，在这种情况下，模型的设计应该相当清晰。如果没有，你应该知道你将使用什么方法来防止你的模型变得臃肿。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-04-17T22:10:16.633

您可以查看 Stephen Walther 编写的这个很棒的教程，该教程显示[了使用服务层进行验证](http://www.asp.net/mvc/tutorials/validating-with-a-service-layer-cs)。

> 了解如何将验证逻辑从控制器操作中移到单独的服务层中。在本教程中，Stephen Walther 解释了如何通过将服务层与控制器层隔离来保持关注点的清晰分离。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-08-28T11:01:46.797

业务逻辑不应包含在控制器中。控制器应该尽可能瘦，最好遵循以下模式：

1.  查找域实体
2.  作用于域实体
3.  为查看/返回结果准备数据

此外，控制器可以包含一些应用程序逻辑。

那么我在哪里放置我的业务逻辑呢？在模型中。

什么是模型？这是一个很好的问题。请参阅[Microsoft 模式和实践文章](http://msdn.microsoft.com/en-us/library/hh404093.aspx)（感谢 AlejandroR 以获得出色的发现）。在这里，模型分为三类：

*   **视图模型**：这只是一个数据包，具有从视图传递数据和向视图传递数据的最少逻辑（如果有的话），包含基本的字段验证。
*   **领域模型**：具有业务逻辑的胖模型，对单个或多个数据实体进行操作（即实体 A 处于给定状态，而不是实体 B 上的操作）
*   **数据模型**：存储感知模型，包含在单个实体中的逻辑仅与该实体相关（即如果字段 a 则字段 b）

当然，MVC 是一种范式，有多种形式。我在这里描述的是 MVC 只占据顶层，参见[Wikipedia 上的这篇文章](http://en.wikipedia.org/wiki/Multitier_architecture#Comparison_with_the_MVC_architecture)

> 今天，MVC 和类似的模型-视图-展示器 (MVP) 是关注点分离设计模式，专门应用于更大系统的表示层。在简单的场景中，MVC 可能代表系统的主要设计，直接进入数据库；但是，在大多数情况下，MVC 中的控制器和模型对服务或数据层/层的依赖松散。这都是关于客户端-服务器架构的

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2014-06-13T15:26:12.727

如果您使用依赖注入器，您的业务逻辑将转到它们，因此您将获得整洁干净的控制器。

# jquery - JQuery and YUI, can they live together?

> ID：235236
> 
> 赞同：18
> 
> 时间：2008-10-24T20:58:09.267
> 
> 标签：jquery, yui

Can JQuery and YUI live together w/o any conflicts?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-24T21:02:47.947

Yes. They live in different namespaces, plus jQuery has a [noConflict option](http://docs.jquery.com/Core/jQuery.noConflict).

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-12-01T23:24:23.857

是的 YUI3 使用 YUI 对象，jQuery 使用 $。例如，您可以使用 YUI 3 Test 模块并在其中使用 $ 进行 DOM 操作/遍历（我认为 jQuery 非常适合这些目的），例如您可以这样做：

```
YUI().use("test", function(){
    test : function() {
       $('div li').addClass("example");
       Y.Assert.areEqual("example", $('div li').attr("class"));
    }
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-01T23:28:56.203

当然，必要时我会这样做。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-24T22:14:36.350

[也可以看看](https://stackoverflow.com/questions/201768/mixing-jquery-and-yui-together-in-an-app-is-it-easily-possible)

# c# - 一般业务对象实践（和异常错误 - redux）

> ID：235240
> 
> 赞同：2
> 
> 时间：2008-10-24T20:58:46.927
> 
> 标签：c#, error-handling, object

最近，[我发表了一篇关于与我一起工作的开发人员没有正确使用 try catch 块](https://stackoverflow.com/questions/204814/is-there-any-valid-reason-to-ever-ignore-a-caught-exception)，以及不幸地在危急情况下使用 try...catch 块并完全忽略异常错误的帖子。让我心痛。这是他们执行此操作的数千段代码之一的示例（省略了一些无关紧要的代码：

```
public void AddLocations(BOLocation objBllLocations)
{
    try
    {
        dbManager.Open();
        if (objBllLocations.StateID != 0)
        {
             // about 20 Paramters added to dbManager here
        }
        else
        {
           // about 19 Paramters added here
        }
        dbManager.ExecuteNonQuery(CommandType.StoredProcedure, "ULOCATIONS.AddLocations");
    }
    catch (Exception ex)
    {
    }
    finally
    {
        dbManager.Dispose();
    }
} 
```

在我看来，这绝对是令人讨厌的，并且在发生某些潜在问题的情况下不会通知用户。我知道很多人说 OOP 是邪恶的，并且添加多个层会增加代码行数和程序的复杂性，从而可能导致代码维护方面的问题。就我个人而言，我的大部分编程背景在这方面都采用了几乎相同的方法。下面我列出了在这种情况下我通常编码方式的基本结构，并且我在我的职业生涯中一直在使用多种语言进行此操作，但是这个特定的代码是用 C# 编写的。但是下面的代码是我如何使用对象的一个​​很好的基本概念，它似乎对我有用，但由于这是一些相当智能的编程地雷的一个很好的来源，我想知道我是否应该重新评估这个我的技术 用了这么多年。主要是因为，在接下来的几周内，我将投入到外包开发人员提供的不太好的代码中，并修改大量代码。我想尽可能地做到这一点。很抱歉长代码参考。

```
// *******************************************************************************************
/// <summary>
/// Summary description for BaseBusinessObject
/// </summary>
/// <remarks>
/// Base Class allowing me to do basic function on a Busines Object
/// </remarks>
public class BaseBusinessObject : Object, System.Runtime.Serialization.ISerializable
{
    public enum DBCode
    {   DBUnknownError,
        DBNotSaved,
        DBOK
    }

    // private fields, public properties
    public int m_id = -1;
    public int ID { get { return m_id; } set { m_id = value; } }
    private int m_errorCode = 0;
    public int ErrorCode { get { return m_errorCode; } set { m_errorCode = value; } }
    private string m_errorMsg = "";
    public string ErrorMessage { get { return m_errorMsg; } set { m_errorMsg = value; } }
    private Exception m_LastException = null;
    public Exception LastException { get { return m_LastException; } set { m_LastException = value;} }

    //Constructors
    public BaseBusinessObject()
    {
        Initialize();
    }
    public BaseBusinessObject(int iID)
    {
        Initialize();
        FillByID(iID);
    }
    // methods
    protected void Initialize()
    {
        Clear();
        Object_OnInit();
        // Other Initializable code here
    }
    public void ClearErrors()
    {
        m_errorCode  = 0; m_errorMsg = ""; m_LastException = null;
    }

    void System.Runtime.Serialization.ISerializable.GetObjectData(
         System.Runtime.Serialization.SerializationInfo info, 
        System.Runtime.Serialization.StreamingContext context)
    {
      //Serialization code for Object must be implemented here
    }
    // overrideable methods
    protected virtual void Object_OnInit()     
    {
        // User can override to add additional initialization stuff. 
    }
    public virtual BaseBusinessObject FillByID(int iID)
    {
        throw new NotImplementedException("method FillByID Must be implemented");
    }
    public virtual void Clear()
    {
        throw new NotImplementedException("method Clear Must be implemented");
    }
    public virtual DBCode Save()
    {
        throw new NotImplementedException("method Save Must be implemented");
    }
}
// *******************************************************************************************
/// <summary>
/// Example Class that might be based off of a Base Business Object
/// </summary>
/// <remarks>
/// Class for holding all the information about a Customer
/// </remarks>
public class BLLCustomer : BaseBusinessObject
{
    // ***************************************
    // put field members here other than the ID
    private string m_name = "";
    public string Name { get { return m_name; } set { m_name = value; } }
    public override void Clear()
    {
        m_id = -1;
        m_name = "";
    }
    public override BaseBusinessObject FillByID(int iID)
    {
        Clear();
        try
        {
            // usually accessing a DataLayerObject, 
            //to select a database record
        }
        catch (Exception Ex)
        {
            Clear();
            LastException = Ex;
            // I can have many different exception, this is usually an enum
            ErrorCode = 3;
            ErrorMessage = "Customer couldn't be loaded";
        }
        return this;
    }
    public override DBCode Save()
    {
        DBCode ret = DBCode.DBUnknownError;
        try
        {
            // usually accessing a DataLayerObject, 
            //to save a database record
            ret = DBCode.DBOK;
        }
        catch (Exception Ex)
        {
            LastException = Ex;
            // I can have many different exception, this is usually an enum
            // i do not usually use just a General Exeption
            ErrorCode = 3;
            ErrorMessage = "some really weird error happened, customer not saved";
            ret = DBCode.DBNotSaved;
        }
        return ret;
    }
}
// *******************************************************************************************
// Example of how it's used on an asp page.. 
    protected void Page_Load(object sender, EventArgs e)
    {
        // Simplifying this a bit, normally, I'd use something like, 
        // using some sort of static "factory" method
        // BaseObject.NewBusinessObject(typeof(BLLCustomer)).FillByID(34);
        BLLCustomer cust = ((BLLCustomer)new BLLCustomer()).FillByID(34);
        if (cust.ErrorCode != 0)
        {
            // There was an error.. Error message is in 
            //cust.ErrorMessage
            // some sort of internal error code is in
            //cust.ErrorCode

            // Give the users some sort of message through and asp:Label.. 
            // probably based off of cust.ErrorMessage
            //log can be handled in the data, business layer... or whatever
            lab.ErrorText = cust.ErrorMessage;
        }
        else
        {
            // continue using the object, to fill in text boxes, 
            // literals or whatever. 
            this.labID = cust.ID.toString();
            this.labCompName = cust.Name;
        }
    } 
```

最重要的是，我的问题是，我是否过度复杂化了多层和继承的类，或者我的旧概念是否仍然有效且稳定？现在有更好的方法来完成这些事情吗？我是否应该像同事开发人员建议的那样从页面后面的 asp.net 页面代码直接进行 SQL 调用（尽管最后一个解决方案让我感到恶心），而不是通过业务对象和数据层（数据层不是显示，但基本上保存所有存储的过程调用）。是的，另一位开发人员确实问我为什么要进行分层工作，当您可以直接在页面后面的 *.aspx.cs 代码中输入您需要的内容，然后我就可以享受超过 1k 行代码的乐趣在后面。这里有什么建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T21:19:45.977

您是否考虑过使用像 NHibernate 这样的 ORM？重新发明轮子是没有意义的。

对我来说，这是一种代码味道：

```
BLLCustomer cust = ((BLLCustomer)new BLLCustomer()).FillByID(34); 
```

括号太多了！

我发现在像 C# 这样的语言中使用活动记录模式总是以泪水告终，因为单元测试很难（呃）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T22:37:33.183

从第一个代码到下一个代码的跳跃是巨大的。是否需要复杂的业务对象层将取决于相关应用程序的大小。至少我们的政策是在处理异常的地方记录异常。你如何向用户展示取决于你，但拥有日志是必不可少的，这样开发人员可以在必要时获得更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T22:19:50.850

为什么不在 Page_Load 事件中捕获异常呢？一些您可能期望并知道如何处理的异常，其他异常应由全局异常处理程序处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T22:49:29.713

我的经验法则是只捕获我可以处理的错误或给用户一些有用的东西，这样如果他们再次做他们所做的任何事情，它很可能对他们有用。我捕获数据库异常；但只是在有关正在使用的数据的错误中添加更多信息；然后我重新抛出它。一般来说，处理错误的最佳方法是在 UI 堆栈顶部以外的任何地方都不捕获它们。只需一页来处理错误并使用 global.asax 路由到它就可以处理几乎所有情况。使用状态码绝对不合时宜。它是COM的残余。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T06:09:22.273

是否可以使用抽象基类而不是具体类？这将强制在开发时实现您的方法，而不是运行时异常。

这里最好同意的评论来自舞蹈，你应该只处理你可以从那时恢复的异常。抓住别人并重新投掷是最好的方法（尽管我认为它很少这样做）。另外，请确保它们已记录.... :)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-25T13:01:51.327

你的错误处理方式似乎已经过时了。只需创建一个新的异常并从异常继承，至少您拥有调用堆栈。然后你应该使用 nlog 或 log4net 之类的东西登录。这是 2008 年，所以使用泛型。你将不得不做更少的铸造。

并像之前所说的那样使用 ORM。不要试图重新发明轮子。

# silverlight - 在 Silverlight 中，如何启动/导航到另一个页面？

> ID：235248
> 
> 赞同：3
> 
> 时间：2008-10-24T21:02:07.853
> 
> 标签：silverlight

在 Silverlight 中，我如何启动/导航到另一个页面？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-24T21:03:22.610

```
System.Windows.Browser.HtmlPage.Window.Navigate(
   new Uri( "http://www.google.com" ),
   "_blank"
   ); 
```

如果您只想在当前浏览器窗口中导航，则可以省略目标（“_blank”）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-15T04:33:38.940

从另一个页面导航到另一个页面。

```
Frame frame =this.parent as Frame;
frame.navigate(new Uri("/Views/Details.xaml"),Uri.Relative); 
```

请注意，您必须在 MainPage.xaml 中已有一个框架。所以其他页面只是调用父级中的框架

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-24T11:55:18.477

假设您正在编辑 Page 类文件的代码

```
this.NavigationService.Navigate(new Uri("/OtherPage.xaml", UriKind.Relative)); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-05T23:26:15.443

为避免在使用 _blank 时出现弹出窗口被阻止的问题，请确保从 HyperlinkBut​​ton 控件的单击事件中调用 Navigate，如下所述：

[http://www.tjsblog.net/2010/10/20/opening-a-new-chrome-page-in-silverlight/](http://www.tjsblog.net/2010/10/20/opening-a-new-chrome-page-in-silverlight/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-21T11:58:02.580

大家也可以试试这个

```
this.content=new (place the page name which You want to navigate);

           but this code only works while navigate page having in same folder else You have to write like in given below manner 
```

this.Content = new Views.（放置您要导航的页面名称）；

```
 here in place of Views write the folder name where the page having... 
```

希望对大家也有帮助。

# c# - 在 C# 中维护使用指令的“干净”列表有什么好处？

> ID：235250
> 
> 赞同：14
> 
> 时间：2008-10-24T21:02:23.300
> 
> 标签：c#, visual-studio, resharper, using

我知道 VS2008 具有使用指令进行清理的删除和排序功能，Resharper 也是如此。除了您的代码“干净”并消除了引用将来可能不存在的命名空间的问题之外，维护 using 指令的“干净”列表有什么好处？

代码少？更快的编译时间？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-24T21:08:39.480

如果你总是只有你需要的 using 指令，并且总是对它们进行适当的排序，那么当你区分两个版本的代码时，你将永远不会看到不相关的更改。

此外，如果您有一组简洁的 using 指令，那么任何查看代码的人都可以通过查看 using 指令*大致*了解将要使用的内容。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-24T21:05:39.500

对我来说，这基本上都是为了减少噪音（加上让 Resharper 开心！）。

我相信编译时间的任何改进都是微乎其微的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-24T21:59:18.660

没有运行时影响。这纯粹是编译时间。它可能会影响以下方面：

1.  命名空间冲突的机会更少
2.  代码文件中的“噪音”更少
3.  非常明确地说明文件中预期的名称空间和可能的类型
4.  使用菜单删除未使用和排序意味着开发人员之间使用语句的一致性更高。减少愚蠢签入的机会只是为了修复它。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-24T22:01:51.667

1.  噪音更小。
2.  明确期望使用什么类型（“我的 UI 层依赖于 System.Net。哇，为什么？”）
3.  更清洁的引用：如果您有最少的 using 语句集，则可以清理您的引用。我经常看到开发人员只是不断地向他们的项目中添加引用，但是当不再需要它们时，他们从不删除它们。如果您没有任何实际需要引用的内容（并且 using 语句很重要），那么清理您的引用就变得微不足道了。（您为什么要这样做？在已分解为组件的大型系统中，它将通过消除未使用的依赖项来简化您的构建依赖项。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T21:05:57.863

对我来说，开头的 using 语句的干净列表可以很好地理解预期的类型。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-24T21:07:35.707

几年前，当我第一次安装 ReSharper（在一个 18 项目解决方案上）时，我看到编译时间有了不错的增长。从那时起，它只是保持清洁。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-24T21:40:36.373

我无法谈论编译时间和性能方面的好处，但是如果您最小化您的 using 声明，那么命名空间冲突的可能性就会降低。如果您使用多个第三方库，这一点尤其重要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-27T10:10:49.187

有一个编译时差异：当你删除一个引用，但在你的代码中仍然有一个 using 指令时，你会得到一个编译器错误。因此，拥有一个干净的 using 指令列表可以更轻松地删除未使用的引用。

通常编译器会删除未使用的引用，但我不知道当代码中有 using 时这是否有效。

# windows - 如何在 Emacs 中运行 Cygwin Bash Shell？

> ID：235254
> 
> 赞同：39
> 
> 时间：2008-10-24T21:03:31.283
> 
> 标签：windows, shell, command-line, emacs, cygwin

我在 Windows 上运行 GNU Emacs，所以输入：

```
M-x shell 
```

启动 Windows 命令行 DOS shell。但是，我希望能够从 Emacs 中运行 Cygwin Bash Shell（或任何其他非 Windows shell）。这怎么能很容易做到呢？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-24T21:43:26.787

`shell-file-name`是控制 Emacs 在要运行 shell 命令时使用哪个 shell 的变量。

`explicit-shell-file-name`是控制哪个 shell`M-x shell`启动的变量。

[肯的​​回答](https://stackoverflow.com/questions/235254/how-can-i-run-cygwin-bash-shell-from-within-emacs#235344)改变了这两个，你可能想要也可能不想要。

您还可以通过临时更改来拥有一个启动不同 shell 的函数`explicit-shell-file-name`：

```
(defun cygwin-shell ()
  "Run cygwin bash in shell mode."
  (interactive)
  (let ((explicit-shell-file-name "C:/cygwin/bin/bash"))
    (call-interactively 'shell))) 
```

您可能还希望将`--login`参数传递给 bash，因为您正在开始一个新的 Cygwin 会话。你可以通过设置来做到这一点`explicit-bash-args`。（请注意，`M-x shell`使用`explicit-`PROGRAM ，其中 PROGRAM 是 shell 路径名的文件名部分。这就是为什么在设置 shell 时`-args`不应包含 的原因。`.exe`

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-01-05T19:41:10.940

我发现的最佳解决方案如下：

```
;; When running in Windows, we want to use an alternate shell so we
;; can be more unixy.
(setq shell-file-name "C:/MinGW/msys/1.0/bin/bash")
(setq explicit-shell-file-name shell-file-name)
(setenv "PATH"
    (concat ".:/usr/local/bin:/mingw/bin:/bin:"
        (replace-regexp-in-string " " "\\\\ "
            (replace-regexp-in-string "\\\\" "/"
                (replace-regexp-in-string "\\([A-Za-z]\\):" "/\\1"
                    (getenv "PATH")))))) 
```

像 cjm[建议](https://stackoverflow.com/a/235356/107357)的那样传递“--login”的问题是您的 shell 将始终在您的主目录中启动。但是如果你正在编辑一个文件并且你点击了“Mx shell”，你希望你的shell在那个文件的目录中。此外，我用“Mx grep”和“Mx compile”测试了这个设置。我怀疑这里的其他示例由于目录和 PATH 问题而无法与这些示例一起使用。

这个 elisp 片段属于您的 ~/.emacs 文件。如果您想使用 Cygwin 而不是 MinGW，请将第一个字符串更改为 C:/cygwin/bin/bash。第二个字符串被添加到您的 Windows PATH 之前（在将该 PATH 转换为适当的 unixy 形式之后）；在 Cygwin 中，您可能想要 "~/bin:/usr/local/bin:/usr/bin:" 或类似的东西。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-24T21:36:12.887

我将 XEmacs 与 Cygwin 一起使用，并且可以相对容易地从 XEmacs 运行 bash。

这是来自的相关部分`init.el`

```
;; Let's use CYGWIN bash...
;;
(setq binary-process-input t) 
(setq w32-quote-process-args ?\") 
(setq shell-file-name "bash") ;; or sh if you rename your bash executable to sh. 
(setenv "SHELL" shell-file-name) 
(setq explicit-shell-file-name shell-file-name) 
(setq explicit-sh-args '("-login" "-i")) 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-14T12:03:58.193

关于这个主题的另一个重要提示。

如果您使用 Emacs shell 模式并且有时需要 bash 和 cmd，请将其设置为默认使用 bash，因为您可以在 bash 中键入 cmd 并且生成的 dos shell 工作正常。

如果您将 Emacs 设置为使用 cmd 作为 shell（这是 NT emacs 的安装方式），则 dos shell 可以正常工作，但如果您键入 bash 或 bash -i 来运行 bash shell，则生成的 shell 无法正常工作 -见答案 0。

但如果 bash 是 emacs 调用的“第一个”shell，它就可以正常工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T22:47:57.000

您可以直接从 Emacs *shell* 缓冲区中的默认 Windows 命令行 shell 运行 bash：

```
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\temp>bash
bash 
```

但是，没有命令提示符可见，这可能会导致您的命令及其输出结果混合在一起而迷失方向。

此外，由于某些未知原因，如果您确实输入了命令并按回车键，则会在命令语句的末尾附加一个回车符 (\r)，从而导致 bash 错误：

```
ls
bash: line 1: $'ls\r': command not found 
```

一种解决方法是在每个命令的末尾手动添加一个注释字符 (#)，从而有效地注释掉 \r 文本：

```
ls #
myfile,txt
foo.bar
anotherfile.txt 
```

这种整体方法远非理想，但如果您想从 Windows 的本机 shell 进入 bash 以执行一些快速操作，然后退出以继续在 Windows 中工作，则可能会很有用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-01-29T19:15:49.693

我正在使用 EmacsW32。`C-h a shell$`给出了一个 shell 启动命令列表，命令 cmd-shell 和 cygwin-shell 看起来很有趣。这两个命令都需要 EmacsW32。它们也可以在菜单中找到：**Tools > W&32 Shells**。

如果你是第一次运行 cygwin-shell，并且你没有在 Emacs 中设置 cygwin 路径，它会引导你到 Customization 页面，你可以通过按 Find 按钮设置 cygwin 路径。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-20T09:18:41.240

由于这些方法对我不起作用，我通过以下方式得到它：

（我使用的是 NTEmacs，它默认打开一个 dos shell，所以也许你的 emacs 行为相同）

创建一个名为 SHELL（'SHELL' 而不是 '$SHELL'）的 Windows 环境变量，并为其提供 cygwin 安装的 bash.exe 的路径（例如 c:\programs\cygwin\bin\bash.exe）

现在在做 Mx shell 时，它会打开一个 bash。

问候，

英诺

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-19T12:18:46.790

除了@Chris Jones 关于避免 bash 的 --login 参数的回答之外，我还设置了以下命令行参数：

```
 (setq explicit-bash-args '("--noediting" "-i")) 
```

--noediting 选项可防止干扰 GNU readline 库，而 -i 选项指定 shell 是交互式的。我还将主目录中的 .emacs_bash 文件用于任何 emacs 特定的 bash 自定义。

# java - 在 JApplet 中使用 JFileChooser

> ID：235258
> 
> 赞同：5
> 
> 时间：2008-10-24T21:05:05.460
> 
> 标签：java, applet, jfilechooser

可以`JApplet`使用 a`JFileChooser`以便用户可以选择其硬盘驱动器上的文件吗？或者这会违反 Java 小程序的安全性吗？（我假设正在使用默认的安全设置。我不想让我的用户授予我额外的权限。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T21:25:44.250

[该线程](http://forums.sun.com/thread.jspa?threadID=5322793&tstart=91)表明您需要在`JFileChooser`允许 a 之前对您的小程序进行数字签名。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T10:35:29.573

如前所述，您需要对您的小程序进行签名，这会在向用户显示小程序时导致“模糊的安全警告”。当用户同意运行这个小程序时，这个小程序就被赋予了完全的访问权限和功能，就像一个普通的应用程序一样，具有明显的安全隐患。对于我正在开发的 Web 应用程序，我也处于同样的两难境地，但还不确定它是否会被部署。

如果您正在处理较小的文件，您也可以使用网络浏览器中的内置文件浏览器并从您的服务器反弹文件内容。

此外，您可以针对已签名的小程序采取的一些安全措施包括：

*   验证小程序代码的来源。

    ```
    URL appletUrl = MyApplet.class.getProtectionDomain().getCodeSource().getLocation();
    if(appletUrl.toString().equalsIgnoreCase(safeAppletUrl) == false)
       return false; 
    ```

*   验证运行小程序的基本 URL。

    ```
    URL documentUrl = this.getDocumentBase(); 
    if(documentUrl.toString().equalsIgnoreCase(safeDocumentUrl) == false)
       return false; 
    ```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T21:21:49.530

在那种情况下（使用默认设置），你是对的，默认安全管理器不允许访问本地文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T21:37:09.563

您可能必须使用 PrivilegedAction 从用户的硬盘读取任何内容。正如@mmyers 所说，您还必须签署您的小程序。

所以你的答案是肯定的，我以前做过，所以我知道可以做到。

# php - PHP如何同时连接2个数据库

> ID：235264
> 
> 赞同：18
> 
> 时间：2008-10-24T21:07:06.613
> 
> 标签：php, mysql, database

我正在尝试从 1 个 PHP 脚本连接到同一 MySQL 实例上的 2 个数据库。

目前我想出的唯一方法是连接到两个数据库，每个数据库都有不同的用户。

我在迁移脚本中使用它，我从原始数据库中获取数据并将其插入到新数据库中，因此我正在循环浏览大量结果。

连接到 1 个数据库，然后尝试与同一用户启动第二个连接，只会将当前数据库更改为新数据库。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-24T21:15:55.813

您需要将布尔值 true 作为可选的第四个参数传递给 mysql_connect()。有关更多信息，请参阅[PHP 的 mysql_connect() 文档](http://php.net/mysql_connect)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-24T21:42:35.683

如果您的数据库用户可以访问这两个数据库并且它们位于同一台服务器上，则您可以使用一个连接，只需在表名之前指定要使用的数据库即可。例子：

```
SELECT column
FROM database.table 
```

根据您需要做的事情，您也许可以做一个[`INSERT INTO`](http://dev.mysql.com/doc/refman/5.0/en/insert-select.html)并节省大量处理时间。

```
INSERT INTO database1.table (column)
SELECT database2.table.column
FROM database2.table 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-24T21:32:14.207

卢卡斯是对的。我假设两个数据库都托管在同一主机上。

或者，您可以只创建 1 个数据库连接并根据需要继续交换数据库。这是伪代码。

```
$db_conn = connect_db(host, user, pwd);
mysql_select_db('existing_db', $db_conn);
 -- do selects and scrub data --
mysql_select_db('new_db', $db_conn);
-- insert the required data -- 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-24T21:17:53.313

我建议使用两个连接处理程序

```
 $old = mysql_connect('old.database.com', 'user', 'pass);
   mysql_select_db('old_db', $old);

   $new = mysql_connect('new.database.com','user','pass);
   mysql_select_db('new_db', $new)

   // run select query on $old
   // run matching insert query on $new 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-24T22:21:46.413

如果可以，请使用 PDO：您可以打开任意数量的数据库连接。

另外，假设您一遍又一遍地执行相同的查询，您可以使用准备好的语句。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-08-06T10:11:48.440

您可以使用以下代码轻松同时使用 2 个数据库：

```
<?php
  define('HOST', "YOURHOSTNAME");
  define('USER', "YOURHOSTNAME");
  define('PASS', "YOURHOSTNAME");
  define('DATABASE1', "NAMEOFDATABASE1");
  define('DATABASE2', "NAMEOFDATABASE2");

  $DATABASE1  = mysqli_connect(HOST, USER, PASS, DATABASE1);
  $DATABASE2  = mysqli_connect(HOST, USER, PASS, DATABASE2);
  if(!$DATABASE1){
      die("DATABASE1 CONNECTION ERROR: ".mysqli_connect_error());
   }
  if(!$DATABASE2){
      die("DATABASE2 CONNECTION ERROR: ".mysqli_connect_error());
   }

   $sql = "SELECT * FROM TABLE";   /* You can use your own query */

   $DATABASE1_QUERY = mysqli_query($DATABASE1, $sql);
   $DATABASE2_QUERY = mysqli_query($DATABASE2, $sql);

   $DATABASE1_RESULT = mysqli_fetch_assoc($DATABASE1_QUERY);
   $DATABASE2_RESULT = mysqli_fetch_assoc($DATABASE2_QUERY);

   /* SHOW YOUR RESULT HERE WHICH DATABASE YOU WANT FROM */
   echo  $DATABASE1_RESULT['id'];
   echo  $DATABASE2_RESULT['id'];

  /*After complete your all work don't forgot about close database connections*/
  mysqli_close($DATABASE1);
  mysqli_close($DATABASE2);
      ?> 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2016-08-06T10:29:06.907

首先连接两个数据库

```
$database1 = mysql_connect("localhost","root","password");
$database2 = mysql_connect("localhost","root","password"); 
```

现在选择数据库

```
$database1_select = mysql_select_db("db_name_1") or die("Can't Connect To Database",$database1);
$database_select = mysql_select_db("db_name_2") or die("Can't Connect To Database",$database2); 
```

现在，如果我们要运行查询，请在末尾指定数据库名称，例如，

```
$select = mysql_query("SELECT * FROM table_name",$database1); 
```

# regex - 如何使我的正则表达式匹配第一个模式而不是最后一个？

> ID：235272
> 
> 赞同：1
> 
> 时间：2008-10-24T21:09:00.850
> 
> 标签：regex, perl

我可能做这一切都错了。我有一个充满数据的文本文件，我想匹配和替换文件中“项目”和“目录号”的模式。但是文件中每个元素的顺序非常重要，所以我想从文件顶部开始匹配/替换，然后向下工作。

下面的代码片段确实有效，但是当我执行它时，它替换了“SeaMonkey”和“SMKY-1978”模式的第三个实例，然后替换了该模式的第二个实例。我想做的是替换模式的第一个实例，然后替换第二个。

所以我希望输出说“找到**Kurt 的**SMKY-1978 SeaMonkeys”，然后是“找到**Shane 的**SMKY-1978 SeaMonkeys”，然后不理会 Mick 的 SMKY-1978 SeaMonkeys，因为我只想找到并替换前 2 个实例图案。现在它说“找到**Shane 的**SMKY-1978 SeaMonkeys”和“找到**Mick 的**SMKY-1978 SeaMonkeys”，因为每次执行 for 循环时它都匹配最后一个模式。

那么我是否错过了一个鲜为人知的微妙正则表达式字符，或者我只是在做我想做的事情，完全和完全错误？

这是工作代码：

```
# my regexp matches from the bottom to the top but I'd like it to replace from the top down
local $/=undef;
my $DataToParse = <DATA>;
my $item = "SeaMonkeys";
my $catNum = "SMKY-1978";
my $maxInstancesToReplace = 2;
parseData();
exit();

sub parseData {
    for (my $counter = 0; $counter < $maxInstancesToReplace; $counter++) {
        # Stick in a temporary text placeholder that I will replace later after more processing
        $DataToParse =~ s/(.+)\sELEMENT\s(.+?)\s\(Item := \"$item\".+?CatalogNumber := \"$catNum.+?END_ELEMENT(.+)/$1 ***** Found $2\'s $catNum $item. (counter: $counter) *****$3/s;
    } 
    print("Here's the result:\n$DataToParse\n");
}

__DATA__
    ELEMENT Kurt (Item := "BrightLite",
                  ItemID := 29,
                  CatalogNumber := "BTLT-9274",
                  Vendor := 100,
    END_ELEMENT

    ELEMENT Mick (Item := "PetRock",
                  ItemID := 36,
                  CatalogNumber := "PTRK-3475/A",
                  Vendor := 82,
    END_ELEMENT

    ELEMENT Kurt (Item := "SeaMonkeys",
                  ItemID := 12,
                  CatalogNumber := "SMKY-1978/E",
                  Vendor := 77,
    END_ELEMENT

    ELEMENT Joe (Item := "Pong",
                 ItemID := 24,
                 CatalogNumber := "PONG-1482",
                 Vendor := 5,
    END_ELEMENT

    ELEMENT Shane (Item := "SeaMonkeys",
                   ItemID := 1032,
                   CatalogNumber := "SMKY-1978/E",
                   Vendor := 77,
    END_ELEMENT

    ELEMENT Kurt (Item := "Battleship",
                  ItemID := 99,
                  CatalogNumber := "BTLS-5234",
                  Vendor := 529,
    END_ELEMENT

    ELEMENT Mick (Item := "SeaMonkeys",
                  ItemID := 8,
                  CatalogNumber := "SMKY-1978/F",
                  Vendor := 77,
    END_ELEMENT

    ELEMENT Frank (Item := "PetRock",
                   ItemID := 42,
                   CatalogNumber := "PTRK-3475/B",
                   Vendor := 82,
    END_ELEMENT

    ELEMENT Joe (Item := "SeaMonkeys",
                 ItemID := 8,
                 CatalogNumber := "SMKY-1979/A",
                 Vendor := 77,
    END_ELEMENT 
```

这是它当前输出的内容：

```
结果如下：
        元素库尔特（项目：=“BrightLite”，
                      项目 ID := 29,
                      目录编号 := "BTLT-9274",
                      供应商：= 100，
        END_ELEMENT

        元素米克（项目：=“PetRock”，
                      项目 ID := 36,
                      CatalogNumber := "PTRK-3475/A",
                      供应商：= 82，
        END_ELEMENT

        ELEMENT Kurt (Item := "SeaMonkeys",
                      项目 ID := 12,
                      目录编号 := "SMKY-1978/E",
                      供应商：= 77，
        END_ELEMENT

        元素乔（项目：=“乒乓”，
                     项目 ID := 24,
                     CatalogNumber := "PONG-1482",
                     供应商：= 5，
        END_ELEMENT

 ***** 找到 Shane 的 SMKY-1978 SeaMonkeys。（计数器：1）*****

        元素库尔特（项目：=“战舰”，
                      项目 ID := 99,
                      目录编号 := "BTLS-5234",
                      供应商：= 529，
        END_ELEMENT

 ***** 找到 Mick 的 SMKY-1978 SeaMonkeys。（计数器：0）*****

        元素弗兰克（项目：=“PetRock”，
                       项目 ID := 42,
                       CatalogNumber := "PTRK-3475/B",
                       供应商：= 82，
        END_ELEMENT

        元素乔（项目：=“SeaMonkeys”，
                     项目 ID := 8,
                     目录编号 := "SMKY-1979/A",
                     供应商：= 77，
        END_ELEMENT
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-24T21:19:38.787

.+ 在您的正则表达式开头是“贪婪的”。这意味着它将匹配最大字符数。

您的正则表达式写得更好（它会更具可读性和更快）为

```
my $re=qr/\sELEMENT\s(.+?)\s\(Item := "$item".+?CatalogNumber := "$catNum.+?END_ELEMENT/; 
```

我认为你可以简单地重复这场比赛：

```
sub parseData {
    my $re=qr/\sELEMENT\s(.+?)\s\(Item := "$item".+?CatalogNumber := "$catNum.+?END_ELEMENT(.+)/;
    foreach my $counter (0..$maxInstancesToReplace) {
      # Stick in a temporary text placeholder that I will replace later after more processing
      $DataToParse =~ s/$re/ ***** Found $1\'s $catNum $item. (counter: $counter) *****$2/s;
    } 
    print("Here's the result:\n$DataToParse\n");
} 
```

如果无法重复，则应使用 /e 正则表达式修饰符。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-01T05:09:26.663

最好的解决方案似乎是从数据中获取每个 ELEMENT ... END_ELEMENT 部分，并且一次只对一个部分进行正则表达式，而不是一次将整个完整的数据集提供给正则表达式。不完全是我想要完成的事情，但我重写了我的程序来做这个零碎的处理，它就像一个魅力。

# php - 针对非微软平台的面向触摸屏的网站开发建议

> ID：235281
> 
> 赞同：4
> 
> 时间：2008-10-24T21:14:31.387
> 
> 标签：php, flash, touchscreen, kiosk

我们目前正在设计一个可以从博物馆的信息亭访问的网站。用户将需要能够浏览当前包含静态 HTML 内容的许多不同网页，以及浏览基于 Flash 并在 Flash 播放器中运行的各种交互式演示文稿。用户可能还需要从信息亭将一些信息输入到简单的注册表单中。

我们目前将其设计为在浏览器中运行的一个原因是，从信息亭访问的相同站点和交互式演示文稿也将在 Web 上可用。

有没有人建议这种设计是否可行，或者我们是否应该简单地构建两个版本的内容，一个用于网络，一个用于信息亭？有人在构建可在触摸屏上和通过网络访问的网站方面有哪些经验？

这对我自己和我的公司来说都是第一次努力，所以任何警告、建议和建议都将不胜感激。

*注意：*我们目前正在使用 Flash 来构建我们的交互式内容和用于服务器端所有内容的 LAMPP 堆栈，因此 SilverLight 并不是一个真正的选择。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T22:30:45.430

为信息亭设计是 90% 的 UI 优化。通读一遍

[http://www.voltagecreative.com/blog/2008/05/best-practices-of-touch-screen-interface-design/](http://www.voltagecreative.com/blog/2008/05/best-practices-of-touch-screen-interface-design/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T22:46:04.400

您可以拥有相同的内容，但您应该拥有不同的 CSS 文件。触摸屏版本需要使用更大的字体，在某些情况下还需要使用触摸屏键盘，而家庭用户则不需要。

此外，您可能希望在家庭版的侧边栏上宣传博物馆活动，以吸引人们进入博物馆，而这些在售货亭是不必要的干扰。

此外，您可能希望为家庭用户链接到外部网站和资源，但阻止从博物馆内部进行外部 Web 浏览，因此样式表也可用于停用指向外部资源的链接，而不删除文本。

使用样式表和/或 JavaScript 将它们分开，但尽量保持内容页面相同，这样您就不必维护两组内容。

-亚当

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T22:29:03.107

为您的 UI 使用浏览器似乎是一个不错的决定，我担心的是其他应用程序甚至浏览器弹出窗口会干扰您的信息亭的可用性。可能的缓解措施是使用 Microsoft WebBrowser 控件创建您自己的浏览器应用程序，以确保不会出现任何弹出窗口，并将所有文件本地存储在 kiosk 机器上，这样只要它有电就可以运行（并且您不必担心向用户显示网络可访问性错误）。

# spring - 使用 Spring Webflow 2，需要哪些请求参数（如果有）来触发视图状态的“提交”转换？

> ID：235282
> 
> 赞同：1
> 
> 时间：2008-10-24T21:14:56.707
> 
> 标签：spring, jsp, spring-webflow

我的视图状态到动作状态的转换似乎没有发生。在下面的示例中，我希望在用户提交表单时视图状态转换为操作状态。很基本的东西。但是该`setA()`方法不会被调用。

在jsp中， `submit input`元素是否需要命名为“ `_`eventId”，或“ `_`eventId `_`submit”，还是不需要命名？还是有其他问题？在评估元素的`on`属性时，webflow 会检查什么？`transition`

```
<flow ... start-state="stateA">
<var name="flowBean" class="demo.webflow.WebFlowBean" />
<view-state id="stateA" view="fooView">
    <transition on="submit" to="changeA" />
</view-state>
<action-state id="changeA">
    <evaluate expression="flowScope.flowBean.setA(requestParameters.value)" />
    ...
</action-state> 
```

JSP：

```
<form action="demo.htm" name="myform" id="myform" method="post">
<input type="hidden" name="_flowExecutionKey" value='<c:out value="${flowExecutionKey}"/>'/>
<input type="submit" name="????" value="Continue"/> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-24T21:32:23.237

发现问题了，我想。我`action`从我的 中删除了该属性`form`，现在一切正常：

```
<form name="myform" id="myform" method="post"> 
```

我猜想，通过在其中包含该`action`URL，我以某种方式在每次提交时重新启动流程。

# http - 为什么浏览器没有文件上传进度条？

> ID：235284
> 
> 赞同：11
> 
> 时间：2008-10-24T21:15:46.050
> 
> 标签：http, browser, upload

我想知道为什么没有浏览器具有如此简单但必不可少的功能。我错过了什么吗？有技术原因吗？

我厌倦了所有那些 javascript/flash/java 黑客...

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-24T22:15:26.287

没有技术原因阻止浏览器计算要发送的总字节数，然后跟踪服务器接收到的字节数（感谢 Kibbee 的评论）。Firefox 在 0.9 版之前有一个功能性的上传进度指示器，但该[版本](https://bugzilla.mozilla.org/show_bug.cgi?id=249338)在 2004 年打破了它。

阅读 Bugzilla 更新后，似乎该功能并没有让足够多的用户受益，无法从开发人员那里获得任何吸引力。

经常上传超大文件的用户倾向于使用为此目的而设计的 FTP 等工具，因此不会受到影响。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-24T22:26:26.437

添加到 flamingLogos 参数中，您可以在代理后面操作，该代理在一秒钟内获取 5 兆字节的纯善，然后通过 56kbit 调制解调器将其发送到服务器。

我认为一个错误的进度条比没有进度条稍微糟糕一点，而且会有很多人一直是错误*的*。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-01T05:26:58.990

是的，这很愚蠢，出于某种原因，浏览器制造商忽略了它。我强烈反对大文件用户使用 FTP——几乎没有人知道这一点，所有常见的 Web 应用程序都需要 HTTP 上传视频、音频和图片（例如 youtube）。

具有讽刺意味的是，用户参与和媒体是 Web 2.0 的关键，但用户参与的主要机制却没有被浏览器处理得如此糟糕。

对于 Firefox，多年来一直存在一些错误，例如为了更好地显示上传进度： [https ://bugzilla.mozilla.org/show_bug.cgi?id=243468](https://bugzilla.mozilla.org/show_bug.cgi?id=243468)

获得投票！:)

状态栏中的现有进度条已损坏多年 - 请参阅错误 249338 - 它会让您静默中止上传 - 请参阅错误 432768。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-09-04T02:12:38.070

如果您使用的是 Firefox，则可以使用为此目的而设计的新 UploadProgress 插件[https://addons.mozilla.org/en-US/firefox/addon/221510/](https://addons.mozilla.org/en-US/firefox/addon/221510/)，它会显示您的上传进度和估计剩余时间。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T21:17:51.037

无论您是否“偷偷摸摸”地谈论它（例如，使用隐藏的 iframe），您都必须回帖才能上传文件；浏览器自己的进度条（通常在状态栏中向下）在这个意义上是文件上传进度条，尽管不完全是。

![替代文字](https://i160.photobucket.com/albums/t162/JasonBunting/ProgressBar.gif)

只是你不能轻易地为自己使用这些数据，所以你必须用很多客户端到服务器的通信技巧来近似它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-24T23:33:09.250

没有真正的技术原因，您不能像下载一样拥有合理的进度指示器。您应该将其建议为您最喜欢的浏览器的功能请求。

也就是说，我认为有这么多基于 javascript/flash/ajax 的上传组件的主要原因并不是提供进度条（尽管这是一个不错的奖励）。这通常是因为他们希望提供更好的 UI 来选择要上传的数据，并且有时在上传之前对数据进行操作。HTML 规范中的基本文件上传功能导致“浏览...”按钮弹出文件打开对话框并将原始文件数据按原样上传到服务器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-03-12T11:11:48.400

Chrome 有一个显示加载百分比的上传栏。

或者，就像[Peuchele](https://stackoverflow.com/users/439418/peuchele)所说，Firefox 也有一个[插件](https://addons.mozilla.org/it/firefox/addon/uploadprogress/)。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-24T21:19:15.683

网络浏览器一直是网络浏览器。它是一种消费机制。我们通过同一个门户上传信息的能力有点像黑客。

# javascript - 如何在 VS 命令窗口中列出 JavaScript 对象的方法？

> ID：235289
> 
> 赞同：3
> 
> 时间：2008-10-24T21:16:44.940
> 
> 标签：javascript, visual-studio, debugging, window, command

在 Visual Studio 2008 中调试 JavaScript 时，我使用 ? 命令窗口中的命令列出 JavaScript 对象的成员我总是得到省略号 {...}。例子：

```
>? Page_Validators 
{...}
    [0]: {object}
    [1]: {object}
    [2]: {object}
    [3]: {object}
    [4]: {object}
    [5]: {object}
    length: 6 
```

我假设这些是对象的成员函数。有没有办法列出该 {...} 中的成员？单行命令将是理想的。

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-24T22:03:28.370

我刚试过这个，它有效，但有一个警告：

```
? (function () { var m = []; for (var p in Page_Validators) { if(typeof Page_Validators[p] == "function") { m.push(p); } } return m; })() 
```

这将向您显示作为对象一部分的所有方法，但不会显示内置的继承方法（如`toString()`or `valueOf()`）。

希望有帮助。

# mysql - One-to-many relationship in the same table

> ID：235295
> 
> 赞同：5
> 
> 时间：2008-10-24T21:18:01.583
> 
> 标签：mysql, one-to-many, doctrine

Im trying to use to define a one-to-many relationship in a single table. For example lets say I have a Groups table with these entries:

```
Group:
  Group_1:
    name: Atlantic Records
  Group_2:
    name: Capital Records
  Group_3:
    name: Gnarls Barkley
  Group_4:
    name: Death Cab For Cutie
  Group_5:
    name: Coldplay
  Group_6:
    name: Management Company

```

The group Coldplay could be a child of the group Capital Records and a child of the group Management Company and Gnarls Barkley could only be a child of Atlantic Records.

What is the best way to represent this relationship. I am using PHP and mySQL. Also I am using PHP-Doctrine as my ORM if that helps.

I was thinking that I would need to create a linking table called group_groups that would have 2 columns. owner_id and group_id. However i'm not sure if that is best way to do this.

Any insight would be appreciated. Let me know if I explained my problem good enough.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T21:31:18.530

There are a number of possible issues with this approach, but with a minimal understanding of the requirements, here goes:

There appear to be really three 'entities' here: Artist/Band, Label/Recording Co. and Management Co.

Artists/Bands can have a Label/Recording CO Artists/Bands can have a Management Co.

Label/Recording Co can have multiple Artists/Bands

Management Co can have multiple Artists/Bands

So there are one-to-many relationships between Recording Co and Artists and between Management Co and Artists.

Record each entity only once, in its own table, with a unique ID.

Put the key of the "one" in each instance of the "many" - in this case, Artist/Band would have both a Recording Co ID and a Management Co ID

Then your query will ultimately join Artist, Recording Co and Management Co.

With this structure, you don't need intersection tables, there is a clear separation of "entities" and the query is relatively simple.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T21:21:55.630

A couple of options:

Easiest: If each group can only have one parent, then you just need a "ParentID" field in the main table.

If relationships can be more complex than that, then yes, you'd need some sort of linking table. Maybe even a "relationship type" column to define what *kind* of relationship between the two groups.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T21:44:22.653

在这种特殊情况下，您最好遵循 Ken G 的建议，因为您确实在一个表中对三个单独的实体进行建模。

一般来说，这可能会出现——如果你有一个“人”表，并且正在模拟每个人的朋友是谁，举一个人为的例子。

在这种情况下，您确实会有一个“链接”或关联或婚姻表来管理这些关系。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T15:47:36.297

这似乎是 STI（单表继承）和嵌套集/树结构的混合。嵌套集/树是一个父多个子：

[http://jgeewax.wordpress.com/2006/07/18/hierarchical-data-side-note/](http://jgeewax.wordpress.com/2006/07/18/hierarchical-data-side-note/)

[http://www.dbmsmag.com/9603d06.html](http://www.dbmsmag.com/9603d06.html)

[http://www.sitepoint.com/article/hierarchical-data-database](http://www.sitepoint.com/article/hierarchical-data-database)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-12T18:16:03.537

我认为最好的是使用 NestedSet [http://www.doctrine-project.org/documentation/manual/1_0/en/hierarchical-data#nested-set](http://www.doctrine-project.org/documentation/manual/1_0/en/hierarchical-data#nested-set)

只需设置 actAs NestedSet

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T22:15:54.943

我同意 Ken G 和 JohnMcG 的观点，即您应该将管理和标签分开。然而，他们可能忘记了一个乐队可以在一段时间内拥有多个经理和/或多个经理。在这种情况下，您将需要多对多关系。

*   管理层有很多乐队
*   乐队有很多管理层
*   标签有很多条带
*   乐队有很多标签

在这种情况下，您最初使用关系表的想法是正确的。那就是在家完成多对多的关系。但是，group_groups 可以更好地命名。

最终这将取决于您的要求。例如，如果您要存储 CD 标题，那么您可能更愿意将标签附加到特定 CD 而不是乐队。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-24T21:22:55.067

Yes, you would need a bridge that contained the fields you described. However, I would think your table should be split if it is following the same type of entities as you describe.

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-24T21:30:27.250

(I am assuming there is an id column which can be used for references).

You can add a column called parent_id (allow nulls) and store the id of the parent group in it. Then you can join using sql like: "Select a.*, b.* from group parent join group child on parent.id = child.parent_id".

I do recommend using a separate table for this link because: 1\. You cannot support multiple parents with a field. You have to use a separate table. 2\. Import/Export/Delete is way more difficult with a field in the table because you may run into key conflicts. For example, if you try to import data, you need to make sure that you first import the parents and then children. With a separate table, you can import all groups and then all relationships without worrying about the actual order of the data.

# windows - 是否有更好的客户端来查看系统监视器日志？

> ID：235310
> 
> 赞同：2
> 
> 时间：2008-10-24T21:21:44.150
> 
> 标签：windows, performance, memory-leaks, sysadmin

有谁知道用于显示 Windows[系统监视器](http://support.microsoft.com/kb/248345)日志文件的更好的 GUI 客户端？（系统监视器有时称为[性能监视器](http://support.microsoft.com/?kbid=330138)。）我试图通过比较内存使用情况来跟踪运行在 Windows XP 或 2K3 上的 C# 应用程序中的长期内存泄漏运行日志。

具体来说，我想要一个允许我看到以下内容的客户端（因为系统监视器无法或困难）：

*   指定查看数据的确切日期时间范围（或至少比小时更细的粒度）
*   沿水平轴显示时间间隔
*   显示时间范围的最大值、最小值、平均值
*   在某处显示捕获源数据的时间间隔（1 秒、5 分钟等）

（如果不存在这样的东西，我愿意听取有关更好的长期性能/内存捕获工具的建议。）

**编辑：**我已经完成了谷歌搜索，除了关于如何创建系统监视器日志的教程外，没有找到任何东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T11:30:03.427

看到[这个](https://stackoverflow.com/questions/37425/what-is-the-best-way-to-interpret-perfmon-analysis-into-application-specific-ob#158314)问题。

PAL 工具在创建带有图表和图形的 HTML 报告方面做得很好。通过创建您自己的阈值文件，您可以控制报告中的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T11:57:56.563

虽然我接受了 Patrick Cuff 的回答，但出于我的需要，我找到了一种更好的方法来绘制数据：Excel

它仍然不能提供我需要的一切，但它是对系统监视器 GUI 的显着改进。我使用 relog 命令行工具将日志转换为 CSV，然后将 CSV 导入 Excel。Excel 不会自动处理第三个，但我可以在图表中添加新列，它确实让我可以更好地控制我正在显示的数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T23:48:28.127

我过去使用的技巧之一是使用性能/系统监视器将这些数据记录到 SQL 数据库中。SQL 表达式可以很好地解决这个问题。然后，您可以使用 Reporting Services 生成报告，或者对于更具冒险精神的类型，您可以使用 Analysis Services 进行一些多维数据集分析。因此，虽然这并不能解决 UI 问题，但它确实允许您制作自己的 UI。当我之前完成此操作时，我只使用了一个简单的 Reporting Services 图表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T04:32:37.887

带有报告服务的 SCOM 2007 实际上在这方面做得很好。如果不是，SQLh2 工具几乎一样好而且它是免费的。不过，您可能必须自己自定义报告

# java - 有史以来最轻的 Java 虚拟机是什么？（KVM 除外）

> ID：235315
> 
> 赞同：3
> 
> 时间：2008-10-24T21:22:27.253
> 
> 标签：java, jvm

我想在一台带有 GNU/Linux 16MB RAM 机器的 Psion 5MX 上安装 Java，可以吗？

不幸的是，[“KVM 必须由制造商安装”](http://www.java.com/en/download/faq/5000080100.xml)。

我想要的是能够编写基本的 Java 代码，测试和绘制简单的算法。重要说明：我不需要图形部分，因为我只使用控制台（没有图形服务器），但这将在 Debian 内部。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T22:14:14.340

除了操作系统和内存，请给我们更多关于机器的细节。还请详细说明您希望在这样一台动力不足的机器上使用 Java 完成什么（与编写本机代码相比，Java 在嵌入的地方有一些很大的开销）。

答案是也许。我见过 Java 在 4MB RAM 的机器上运行，但它没有运行 Linux（实际上根本没有操作系统）。链接：[Nintendo DS 上的 Java](http://www.volny.cz/molej/pstrosnds/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T19:52:04.397

Wikipedia 上有一个[Java 虚拟机列表](http://en.wikipedia.org/wiki/List_of_Java_virtual_machines "Java 虚拟机列表")，其中有一些是开源的并针对嵌入设备。就像[Mika](http://www.k-embedded-java.com/mika/trac/ "米卡")一样，它看起来非常小巧便携。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T06:15:44.040

[Squawk 虚拟机](http://en.wikipedia.org/wiki/Squawk_virtual_machine)专为小型设备而设计。它的性能可能低于标准，因为它大部分是在 java 中。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-10T20:51:59.743

可能有点晚了，但我也建议 Squawk。它在具有 160k 内存（或该区域中的某物）的太阳黑子设备上运行。160 兆赫的 CPU。整个 JVM 是开源的，因此您可以尝试为自己的设备重新编写它:)

# c++ - 在一组中保存一堆 const char* 的最简单、最安全的方法？

> ID：235326
> 
> 赞同：4
> 
> 时间：2008-10-24T21:27:41.437
> 
> 标签：c++, stl

我想将一堆 const char 指针保存到 std::set 容器 [1] 中。std::set 模板需要一个比较器函子，标准 C++ 库提供了 std::less，但它的实现是基于直接比较两个键，这不是指针的标准。

我知道我可以定义自己的仿函数并通过将指针转换为整数并进行比较来实现 operator()，但是有没有更干净、“标准”的方法呢？

请不要建议创建 std::strings - 这是浪费时间和空间。字符串是静态的，因此可以根据它们的地址比较它们的（不）相等性。

1：指针指向静态字符串，所以它们的生命周期没有问题——它们不会消失。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-24T21:34:57.680

如果你不想将它们包装在`std::string`s 中，你可以定义一个仿函数类：

```
struct ConstCharStarComparator
{
  bool operator()(const char *s1, const char *s2) const
  {
    return strcmp(s1, s2) < 0;
  }
};

typedef std::set<const char *, ConstCharStarComparator> stringset_t;
stringset_t myStringSet;
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T21:32:42.223

## “优化方式”

如果我们忽略“过早的优化是万恶之源”，标准的做法是添加一个比较器，这很容易写：

```
struct MyCharComparator
{
   bool operator()(const char * A, const char * B) const
   {
      return (strcmp(A, B) < 0) ;
   }
} ; 
```

与 a 一起使用：

```
std::set<const char *, MyCharComparator> 
```

## 标准方式

用一个：

```
std::set<std::string> 
```

即使您将静态 const char * 放入其中，它也会起作用（因为 std::string 与 const char * 不同，其内容具有可比性）。

当然，如果你需要提取数据，你必须通过std::string.c_str()来提取数据。另一方面，但由于它是一个集合，我想您只想知道“AAA”是否在集合中，而不是提取“AAA”的值“AAA”。

*注意：我确实读过“请不要建议创建 std::strings”，但是，你问的是“标准”方式......*

## “从不做”的方式

我在回答后注意到以下评论：

> > 请不要建议创建 std::strings - 这是浪费时间和空间。**字符串是静态的**，因此可以**根据它们的地址来比较它们的（不）相等性**。

*这有点 C 的味道（使用已弃用的“静态”关键字，用于 std::string bashing 的可能过早优化，以及通过它们的地址进行字符串比较）。*

无论如何，**你不想通过它们的地址来比较你的字符串。**因为我猜你想要的最后一件事是有一个包含：

```
{ "AAA", "AAA", "AAA" } 
```

当然，如果只使用相同的全局变量来包含字符串，那就另当别论了。

在这种情况下，我建议：

```
std::set<const char *> 
```

当然，如果您比较具有相同内容但变量/地址不同的字符串，它将不起作用。

而且，当然，如果**静态 const char ***字符串是在标头中定义的，则它不适用于这些字符串。

但这是另一个故事。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-25T12:57:22.243

继续使用默认排序，即 less<>。该标准保证 less 即使对于指向不同对象的指针也有效：

“对于更大、更少、greater_equal 和 less_equal 模板，任何指针类型的特化都会产生一个总顺序，即使内置运算符 <、>、<=、>= 没有。”

保证完全适用于您的`set<const char*>`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T21:30:50.387

根据“一堆”的大小，我倾向于`std::string`在集合中存储相应的一堆 s。这样您就不必编写任何额外的胶水代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T21:33:12.440

集合必须包含`const char*`吗？

立即想到的是将字符串存储在 a 中`std::string`，然后将它们放入`std::set`. 这将允许比较没有问题，并且您始终可以`const char*`通过简单的函数调用获得原始数据：

```
const char* data = theString.c_str(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T21:49:47.540

要么使用比较器，要么使用要包含在集合中的包装器类型。（注意：`std::string` *也是*一个包装器......）

```
const char* a("a");
const char* b("b");

struct CWrap {
    const char* p;
    bool operator<(const CWrap& other) const{
        return strcmp( p, other.p ) < 0;
    }
    CWrap( const char* p ): p(p){}
};

std::set<CWrap> myset;
myset.insert(a);
myset.insert(b); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-25T07:33:55.490

其他人已经发布了很多解决方案，展示了如何与 进行词法比较`const char*`，所以我不会打扰。

> 请不要建议创建 std::strings - 这是浪费时间和空间。

如果`std::string`是浪费时间和空间，那么`std::set`也可能是浪费时间和空间。a 中的每个元素`std::set`都与空闲存储区分开分配。根据您的程序使用集合的方式，这可能会比`std::set`'s O(log n) 查找对性能的帮助更大。`std::vector`根据集合的预期生命周期，使用其他数据结构（例如 sorted 或静态分配的在编译时排序的数组）可能会获得更好的结果。

> 标准 C++ 库提供 std::less，但它的实现是基于直接比较两个键，这不是指针的标准。
> 
> 字符串是静态的，因此可以根据它们的地址比较它们的（不）相等性。

这取决于指针指向的内容。如果所有的键都是从同一个数组分配的，那么使用`operator<`来比较指针不是未定义的行为。

包含单独静态字符串的数组示例：

```
static const char keys[] = "apple\0banana\0cantaloupe"; 
```

如果您创建一个`std::set<const char*>`并用指向该数组的指针填充它，它们的顺序将是明确定义的。

但是，如果字符串都是单独的字符串文字，则比较它们的地址很可能会涉及未定义的行为。它是否有效取决于您的编译器/链接器实现、您如何使用它以及您的期望。

如果您的编译器/链接器支持字符串池并启用了它，那么重复的字符串文字应该具有相同的地址，但在所有情况下都可以保证吗？依靠链接器优化来获得正确的功能是否安全？

如果您仅在一个翻译单元中使用字符串文字，则集合排序*可能*基于字符串首次使用的顺序，但如果您将另一个翻译单元更改为使用相同的字符串文字之一，则集合排序可能会更改。

> 我知道我可以定义自己的仿函数并通过将指针转换为整数并比较它们来实现 operator()

将指针投射到`uintptr_t`使用指针比较似乎没有任何好处。无论哪种方式，结果都是相同的：特定于实现。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-24T21:42:45.090

由于性能原因，您可能不想使用 std::string 。

我正在运行 MSVC 和 gcc，他们似乎都不介意这一点：

```
bool foo = "blah" < "grar"; 
```

编辑：但是，在这种情况下的行为是未指定的。看评论...

他们也不抱怨`std::set<const char*>`。

如果您使用的编译器确实会抱怨，我可能会继续使用您建议的将指针转换为`int`s 的仿函数。

编辑：嘿，我被否决了......尽管是这里为数不多的最直接回答他的问题的人之一。我是 Stack Overflow 的新手，如果发生这种情况，有什么方法可以保护自己吗？话虽如此，我会在这里尝试：

问题不是在寻找`std::string`解决方案。每次你`std::string`在集合中输入一个 in 时，它都需要复制整个字符串（直到 C++0x 是标准的，无论如何）。此外，每次进行集合查找时，都需要进行多个字符串比较。

但是，将指针存储在集合中不会导致字符串复制（您只是在复制指针），并且每次比较都是对地址的简单整数比较，而不是字符串比较。

该问题表明存储指向字符串的指针很好，我认为没有理由我们都应该立即假设该语句是错误的。如果您知道自己在做什么，那么使用`const char*`over each`std::string`或调用`strcmp`. 是的，它不太安全，更容易出错，但这些是性能的常见权衡，并且由于问题从未说明应用程序，我认为我们应该假设他已经考虑了利弊并决定支持性能.

# browser - 为什么浏览器中的 http auth UI 如此糟糕？

> ID：235327
> 
> 赞同：7
> 
> 时间：2008-10-24T21:28:40.187
> 
> 标签：browser, http-authentication

为什么没有注销按钮？为什么没有“您登录的网站”列表？是因为 HTTP 规范有问题吗？

如果 Web 开发人员实际上可以依赖 HTTP 身份验证，他们的生活会轻松得多……

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-24T21:31:59.400

就 HTTP 而言，它是[无状态](http://www.webopedia.com/TERM/H/HTTP.html)的。互联网可扩展的主要原因之一。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T22:20:00.270

没有技术原因。我想如果有的话，auth UI 被忽略了，因为越来越少的网站仍在使用 HTTP 基本身份验证，更多地倾向于各种与 cookie 相关的登录方案……正是因为 auth UI 太差了！

一个人可能会拼凑一个 Firefox 插件来很容易地做到这一点，这将是最快的修复。（对于文件上传用户界面不佳的另一个问题也是如此。）我会使用它！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T22:04:30.193

您是否输入了针对主要浏览器的错误报告？（至少，那些带有错误跟踪器、Firefox、Chrome（Chromium）等的。

打开的 HTTP Auth 会话列表会很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T22:17:09.480

因为它不是“知道”它已登录的浏览器。它是在每个请求上对浏览器进行身份验证的服务器。每个服务器都可以有不同的身份验证机制——使用不同的名称和内容进行身份验证 cookie、基本身份验证等。

# performance - 寻找处理与 Web 应用程序相关的长时间运行操作的模式/方法/建议

> ID：235345
> 
> 赞同：3
> 
> 时间：2008-10-24T21:37:00.263
> 
> 标签：performance, apache, architecture, web-applications, lamp

我正在开发一个消费者网络应用程序，该应用程序需要执行与每个客户请求相关的长时间运行的后台进程。长跑是指1到3分钟之间的任何地方。

这是一个示例流程。对象/小部件并不重要。

1.  客户来到站点并指定他们正在寻找的对象/小部件。
2.  我们搜索/清理/过滤匹配某些初始条件的小部件。<-- 长时间运行的进程
3.  客户进一步配置有关他们正在寻找的小部件的更多详细信息。
4.  当长期运行的过程完成后，客户可以完成转换前的最后几个步骤。

第 3 步和第 4 步并不重要。我之所以提到它们，是因为我们可以在进行长期运行的过程中争取一些时间。

我们工作的环境是一个 LAMP 堆栈——目前使用的是 PHP。让长时间运行的进程占用 mod_php（或 fastcgi 进程）中的 apache 线程似乎不是一个好的设计。我们应用程序的 apache 层*应该*专注于提供内容而不是数据处理 IMO。

几个问题：

1.  我们的想法是否正确，我们应该将这个“长期运行”的部分从 apache/web 应用程序层中分离出来？
2.  在 Linux/Apache/MySQL/PHP 下是否有*标准/典型的*方法来解决这个问题（如果合适，我们愿意使用不同的语言进行处理）？
3.  关于如何打破它的任何建议？例如，我们是否创建了一个通过 FIFO 队列搅动的守护进程？

编辑：澄清一下，只有大约 1/4 的长期运行过程是以数据库为中心的。我们正在努力优化这部分。我们可能会做一些工作，但我们现在能做的事情是有限的。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T06:12:11.040

正如 Jonnii 所建议的，您可以启动一个子进程来进行后台处理。但是，这需要小心谨慎：

*   确保通过的任何参数都正确转义
*   确保不会同时运行多个进程副本

如果该过程的多个副本运行，则没有什么可以阻止（甚至不是恶意的，只是不耐烦的）用户在启动它的页面上点击重新加载，最终启动如此多的副本以致机器耗尽内存并停止运行。

因此，您可以使用子流程，但要小心，以受控的方式进行操作，并正确测试它。

另一种选择是让守护程序永久运行以等待请求，该守护程序处理它们，然后将结果记录在某处（可能在数据库中）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T21:44:53.150

考虑通过 AJAX 从 Web 服务而不是您的应用程序提供搜索结果。大概您可以将其卸载到另一台服务器，并让您的 Web 应用程序根据需要处理内容。

只是好奇：1-3 分钟对于查找查询来说似乎很长。您是否查看了要查询的列上的索引以提高速度？或者你需要做一些算法过程——也许你可以离线执行一些，并预先填充一些带有提示的常见搜索？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T23:32:44.773

这里有一些关于这个问题的Java版本的讨论。

请参阅[java：与批处理服务器通信的最佳技术是什么](https://stackoverflow.com/questions/229131/java-what-are-the-best-techniques-for-communicating-with-a-batch-server)

您可能会做两件重要的事情：

1.  切换到 Java 并使用 JMS。

2.  阅读 JMS 但使用另一个队列管理器。例如，Unix 命名管道可能是一个可接受的实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T23:50:34.973

Java servlet 可以进行[后台处理](http://www.unix.com.ua/orelly/java-ent/servlet/ch03_05.htm)。您可以在具有线程支持的 Web 技术中执行类似于此技术的操作。我不知道PHP虽然。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T21:44:14.260

这是穷人的解决方案：

```
exec ("/usr/bin/php long_running_process.php > /dev/null &"); 
```

或者，您可以：

1.  在您的数据库中插入一行，其中包含后台请求的详细信息，然后守护程序可以读取和处理该行。

2.  将消息写入消息队列，然后由守护进程读取并处理。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-24T21:44:59.000

不是一个完整的答案，但我认为使用 AJAX 并将第二步传递给比 PHP（C、C++、C#）更快的东西，然后一个 PHP 函数从一些堆栈中挑选结果，很可能只是一个数据库。

# visual-studio-2008 - 如何在 VS2008 重启之间保存大纲切换？

> ID：235348
> 
> 赞同：0
> 
> 时间：2008-10-24T21:39:44.317
> 
> 标签：visual-studio-2008

有谁知道 Visual Studio 2008 中的一个技巧，可以让它记住您在重新启动之间对 aspx 文件进行的大纲切换？（代码块左侧的小加号或减号）

在cs文件后面的代码中，它记得#region标签上的切换......希望我可以在aspx HTML端做类似的事情。

到目前为止，当我打开它时，我不得不重新关闭它们，或者在打开时执行 Edit -> Outlining -> Toggle all Outlining 以将它们全部关闭。中间一点都不开心。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T21:54:10.743

我关掉那些傻逼。这样，状态总是一样的，我看到了所有的代码，它提醒我必须清理它。

但是，要回答您的问题，我认为关闭文件后没有有效的方法来控制它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-14T17:40:55.673

我也对这个缺点感到沮丧，所以我提交[了有关 Microsoft Connect 的反馈](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=467059)。如果此问题困扰您，请在 MS Connect 上对其进行评分。

# newsletter - 时事通讯发送缓慢 - 2 封邮件到同一服务器之间的延迟/每小时最多电子邮件？

> ID：235349
> 
> 赞同：0
> 
> 时间：2008-10-24T21:39:50.167
> 
> 标签：newsletter, flooding

我必须制作一个时事通讯发送实用程序应用程序，它将从我们的中央数据库收集订阅者列表并发送时事通讯。我考虑过如果我一次清除所有电子邮件，可能会因为泛滥而被列入黑名单，所以我决定使用基于桌面的软件，它会慢慢地通过电子邮件发送这些邮件。

我的问题是

*   每小时可以发送到同一电子邮件域（收件人/传入服务器）的最大电子邮件是多少？
*   或者两封电子邮件到同一服务器之间应该有什么延迟，因为它不认为它会泛滥？

以上任何一个更适合邮件服务器配置的现实世界......

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T03:27:48.450

我每 2 封邮件后做 Thread.Sleep(2000)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T02:46:55.257

它确实会因配置而异，因此不一定有一个万能的答案。您可能需要与您的 ISP 核实 - 您可能需要担心的是他们或他们的上游。

由于您要发送时事通讯，您是否可以通过密件抄送而不是单个消息添加多个收件人？对所有相关人员来说，这应该不那么“滥用”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-23T13:15:36.707

我已经实现每个收件人域最多发送 600 封电子邮件。这似乎在一段时间内工作得很好，听起来像是一个好的解决方案。

尽管如此，系统管理员对此的一些见解将不胜感激。

# javascript - Javascript/ECMAScript 中函数的范围是什么？

> ID：235360
> 
> 赞同：13
> 
> 时间：2008-10-24T21:44:44.773
> 
> 标签：javascript, functional-programming, scope, ecma262

今天我和一位同事讨论了 Javascript 中的嵌套函数：

```
function a() {
   function b() {
      alert('boo')
   }
   var c = 'Bound to local call object.'
   d = 'Bound to global object.'
} 
```

在这个例子中，试验指出 b 在 a 的主体之外是不可到达的，就像 c 一样。但是，d 是 - 在执行 a() 之后。[在ECMAScript v.3 标准](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)中寻找这种行为的确切定义，我没有找到我正在寻找的确切措辞；Sec.13 p.71没有说的是，函数声明语句创建的函数对象要绑定到哪个对象。我错过了什么吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-24T21:54:18.327

这是静态范围。函数中的语句在该函数范围内。

然而，Javascript 有一个古怪的行为，那就是没有**var**关键字，你就隐含了一个**全局变量**。这就是你在测试中看到的。您的“d”变量是可用的，因为它是一个隐含的全局变量，尽管它是写在函数体中的。

另外，回答你问题的第二部分：一个函数存在于它声明的任何范围内，就像一个变量一样。

**旁注：** 您可能不想要全局变量，尤其是不隐含的变量。建议您始终使用 var 关键字，以防止混淆并保持一切清洁。

**旁注：** ECMA 标准可能不是找到有关 Javascript 答案的最有用的地方，尽管它肯定不是一个糟糕的资源。请记住，浏览器中的 javascript 只是该标准的实现，因此标准文档将为您提供在构建 javascript 引擎时（主要）由实现者遵循的规则。它无法提供有关您关心的实现的具体信息，即主要浏览器。特别是有几本书，它们将为您提供有关主要浏览器中的 javascript 实现如何表现的非常直接的信息。为了说明差异，我将在下面包含 ECMAScript 规范和一本关于 Javascript 的书的摘录。我觉得你'

这是来自**ECMAScript 语言规范**：

> 10.2*进入执行上下文*
> 
> 每个函数和构造函数调用都会进入一个新的执行上下文，即使一个函数正在递归调用自身。每个返回都退出一个执行上下文。抛出的异常，如果没有被捕获，也可能退出一个或多个执行上下文。
> 
> 当控制进入执行上下文时，作用域链被创建和初始化，变量实例化被执行，并且 this 值被确定。
> 
> 作用域链的初始化、变量实例化和 this 值的确定取决于输入的代码类型。

这是来自**O'Reilly 的[Javascript：权威指南（第 5 版）](http://oreilly.com/catalog/9780596101992/index.html)**：

> 8.8.1 词法作用域
> 
> JavaScript 中的函数是词法而不是动态范围的。这意味着它们在定义它们的范围内运行，而不是在执行它们的范围内运行。定义函数时，当前作用域链被保存并成为函数内部状态的一部分。...

强烈推荐道格拉斯·克罗克福德（Douglas Crockford）的书来解决这些问题：

[JavaScript，好的部分 http://oreilly.com/catalog/covers/9780596517748_cat.gif](http://oreilly.com/catalog/covers/9780596517748_cat.gif)

[**Javascript，The Good Parts**](http://oreilly.com/catalog/9780596517748/index.html)，也来自 O'Reilly。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T21:53:03.273

据我了解，就范围界定而言，这些是等效的：

```
function a() { ... } 
```

和

```
var a = function() { ... } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T23:02:19.203

值得注意的是，虽然 d 被创建为“全局”，但实际上它是作为窗口对象的属性创建的。这意味着您可能会无意中覆盖窗口对象上已经存在的内容，或者您​​的变量实际上可能根本无法创建。所以：

```
function a() {
    d = 'Hello World';
}
alert(window.d); // shows 'Hello World' 
```

但你不能这样做：

```
function a() {
    document = 'something';
} 
```

因为你不能覆盖 window.document 对象。

出于所有实际目的，您可以想象您的所有代码都在一个巨大的`with(window)`块中运行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T23:39:25.230

Javascript 有两个作用域。全球性和功能性。如果您使用“var”关键字在函数内声明变量，它将是该函数和任何内部函数的本地变量。如果您在函数之外声明变量，则它具有全局范围。

最后，**如果你在第一次声明变量时省略了 var 关键字，javascript 会假定你想要一个全局变量，无论你在哪里声明它**。

因此，您正在调用函数 a，而函数 a 正在声明一个全局变量 d。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T21:56:57.090

...

```
function a() {
   function b() {
      alert('boo')
   }
   var c = 'Bound to local call object.'
   d = 'Bound to global object.'
} 
```

前面没有*var*， d 是全局的。这样做使 d 私有：

```
function a() {
   function b() {
      alert('boo')
   }
   var c = 'Bound to local call object.'
   var d = 'Bound to local object.'
} 
```

# ant - 覆盖 Ant javac 任务中的编译器属性

> ID：235363
> 
> 赞同：8
> 
> 时间：2008-10-24T21:45:26.427
> 
> 标签：ant

我正在尝试通过命令行覆盖 Ant 编译器属性，以便所有“javac”任务都使用我指定的编译器。我遇到的问题是任何为编译器设置自己的值的目标都会覆盖我在命令行中设置的目标。所以，即使我正在输入以下命令。

```
ant -Dbuild.compiler=mycompiler 
```

由于该 compiler="modern" 属性，任何具有以下内容的目标都将使用现代编译器而不是 mycompiler

```
<javac srcdir="."  
       destdir="${classes.dir}/core"  
       compiler="modern"  
       encoding="UTF-8">  
    <include name="org/**" />  
    <include name="com/**" />  
    <compilerarg line="${config.build.compilerarg}" />  
</javac> 
```

有什么方法可以从命令行覆盖它，还是我一直在编辑构建文件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-24T23:05:51.473

Ant[`javac`任务文档](http://ant.apache.org/manual/Tasks/javac.html)说：

> 可以使用不同的编译器。这可以通过设置全局 build.compiler 属性来指定，这将影响整个构建过程中的所有任务，或者通过设置特定于当前任务的编译器属性来指定。build.compiler 属性或编译器属性的有效值为：

听起来好像您可以***指定***全局 build.compiler 属性**或**设置特定的编译器属性。

因此，您似乎需要修改构建文件，并且：

1.  从 javac 调用中删除编译器属性并允许全局 build.compiler 设置向下级联

2.  将编译器属性的值从硬编码字符串 **compiler="modern"**更改为属性 **compiler="${javac.compiler}"**

# iphone - 应用程序能否找到有关当前在 iPhone/iPod Touch 上播放歌曲的信息？

> ID：235369
> 
> 赞同：7
> 
> 时间：2008-10-24T21:49:27.727
> 
> 标签：iphone, objective-c, ipod-touch

我在少量可用的 iPhone/iPod Touch 开发信息中搜索了一下，找不到任何支持或反对的信息。应用程序能否找到有关当前在 iPhone/iPod Touch 上播放歌曲的信息？由于在您使用 3rd 方应用程序时音乐可以继续播放，是否有函数或库可以为您提供有关正在播放的内容的信息？（曲目、艺术家、专辑等）我一般都知道应用程序是沙盒的，但我认为也许有办法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T22:05:10.520

Apple 非常严格地允许访问与设备上的媒体（您提供的媒体除外）有关的任何内容。我还没有找到一种方法来做到这一点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T11:30:01.910

如果您不打算将您的应用程序放在 App Store 上，您可以导入 MobileMusicPlayer.h，如本示例应用程序所示：[song-info](http://thebends.googlecode.com/svn/trunk/iphone-apps/music-player/song-info.c)

编辑：与 iPod 应用程序交互现在是[iPhone OS 3.0 SDK的一部分](http://developer.apple.com/iphone/library/documentation/Audio/Conceptual/iPodLibraryAccess_Guide/Introduction/Introduction.html)

# css - CSS 和 Safari/Chrome

> ID：235373
> 
> 赞同：3
> 
> 时间：2008-10-24T21:51:00.563
> 
> 标签：css, safari, google-chrome, flickr

我一直在尝试修改以下菜单，使其在 IE、Firefox 和 Safari/Chrome 中看起来相同，但我似乎无法让它在 Safari/Chrome 中看起来正确。

谁能告诉我如何解决它？在 Safari 或 Chrome 中查看时，请注意菜单忽略了填充。

[查看类似 flickr 的菜单](http://www.candesprojects.com/downloads/flickr-horizontal-menu/)

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T04:07:26.233

在显示为内联或显示为内联的元素上进行填充。[http://www.maxdesign.com.au/presentation/inline/](http://www.maxdesign.com.au/presentation/inline/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T14:56:54.050

尝试制作`inline`元素`inline-block`以使填充正常工作。

# c++ - C++动态类（动态破解）

> ID：235376
> 
> 赞同：5
> 
> 时间：2008-10-24T21:52:39.890
> 
> 标签：c++, dynamic

有没有办法在运行时向类添加一个字段（以前不存在的字段）？像这样的片段：

```
Myobject *ob; // create an object
ob->addField("newField",44); // we add the field to the class and we assign an initial value to it
printf("%d",ob->newField); // now we can access that field 
```

我真的不在乎它会如何完成，我不在乎它是否是一个丑陋的黑客，我想知道它是否可以完成，如果可能的话，还有一个小例子。

**另一个例子：**假设我有一个描述这个类的 XML 文件：

```
<class name="MyClass">
   <member name="field1" />
   <member name="field2" />
</class> 
```

我想将字段“field1”和“field2”“添加”到类中（假设类已经存在）。假设这是该类的代码：

```
class MyClass {
}; 
```

我不想在运行时创建一个类，我只想将成员/字段添加到现有的。

谢谢 ！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-24T22:40:08.187

## 使用地图和变体。

例如，使用 boost::variant。见[http://www.boost.org/doc/libs/1_36_0/doc/html/variant.html](http://www.boost.org/doc/libs/1_36_0/doc/html/variant.html)

（当然，您可以创建自己的，以适应您的 XML 属性的类型。）

```
#include <map>
#include <boost/variant.hpp>

typedef boost::variant< int, std::string > MyValue ;
typedef std::map<std::string, MyValue> MyValueMap ; 
```

通过将 MyValueMap 添加为类的成员，您可以根据其名称添加属性。这意味着代码：

```
oMyValueMap.insert(std::make_pair("newField", 44)) ;
oMyValueMap.insert(std::make_pair("newField2", "Hello World")) ;
std::cout << oMyValueMap["newField"] ;
std::cout << oMyValueMap["newField2"] ; 
```

通过将它封装在一个 MyObject 类中，并在这个 MyObject 类中添加正确的重载访问器，上面的代码变得更加清晰：

```
oMyObject.addField("newField", 44) ;
oMyObject.addField("newField2", "Hello World") ;
std::cout << oMyObject["newField"] ;
std::cout << oMyObject["newField2"] ; 
```

但是这样做会在一定程度上失去 C++ 的类型安全性。但对于 XML，我想这是不可避免的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T22:04:01.927

无法按照您描述的方式进行操作，因为编译器需要在编译时解析引用 - 它会产生错误。

但请参阅[通用设计模式](http://steve-yegge.blogspot.com/2008/10/universal-design-pattern.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T22:31:37.457

您无法使该语法起作用（因为在编译时进行静态检查），但是如果您愿意修改语法，则可以很容易地达到相同的效果。拥有一个带有 string->blob 映射的字典成员会相当容易，并且具有如下成员函数：

```
template< typename T > T get_member( string name );
template< typename T > void set_member( string name, T value ); 
```

如果需要，您可以使语法更紧凑/更棘手（例如：使用“->”运算符覆盖）。您还可以利用一些特定于编译器的技巧（例如，MSVC 支持 __declspec(property)，它允许您将对成员变量的引用映射到特定格式的方法）。但是，归根结底，您将无法做编译器在该语言中不接受的事情并让它编译。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-24T22:07:57.770

**简短版：**做不到。对此没有本机支持，c++ 是静态类型的，*编译器*必须知道要操作的每个对象的结构。

**建议：**使用嵌入式解释器。并且不要自己编写（见下文），获得一个已经在工作和调试的。

* * *

**你可以做什么：**为你的需要实现足够多的interperter。

使用像这样的数据成员设置类会很简单

```
std::vector<void*> extra_data; 
```

您可以在运行时附加任意数据。这样做的代价是您必须使用以下方法手动管理这些数据：

```
size_t add_data_link(void *p); // points to existing data, returns index
size_t add_data_copy(void *p, size_t s) // copies data (dispose at
                                        // destruction time!), returns 
                                        // index 
void* get_data(size_t i); //... 
```

但这不是限制，多加注意，您可以将任意数据与名称相关联，并且您可以根据需要继续详细说明此方案（添加类型信息等），但这会发生什么最重要的是实现一个interperter来照顾你的运行时灵活性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T22:05:22.250

不——C++ 不支持像这样对类型系统进行任何操作。即使具有某种程度的运行时反射的语言（例如 .NET）也不会完全支持这种范式。您需要一种更加动态的语言才能做到这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-16T16:55:53.260

我正在看这个，我做了一些搜索，这个代码片段来自：[Michael Hammer's Blog](http://www.michael-hammer.at/blog/c++_dynamic_parametrization/) 似乎是一个很好的方法，通过使用[boost::any](http://www.boost.org/doc/libs/1_48_0/doc/html/any.html)

首先，您定义一个结构，该结构定义一个包含键（即变量名）和值的 std::map。定义了一个函数来广告该对并将其与一个函数一起设置以获取值。如果你问我，这很简单，但这似乎是在做更复杂的事情之前开始的好方法。

```
struct AnyMap {
  void addAnyPair( const std::string& key , boost::any& value );

  template<typename T>
  T& get( const std::string key ) {
    return( boost::any_cast<T&>(map_[key]) );
  }

  std::map<const std::string, boost::any> map_;
};

void AnyMap::addAnyPair( const std::string& key , boost::any& value ) {
  map_.insert( std::make_pair( key, value ) );
} 
```

归根结底，这是一个 hack，因为 C++ 是严格的类型检查语言，因此对于那些违反规则的人来说是个怪物。

# gwt - 一般问题，您想从 Web 框架中得到什么？

> ID：235379
> 
> 赞同：1
> 
> 时间：2008-10-24T21:53:46.317
> 
> 标签：gwt, frameworks

在 MVC 应用程序中，构成该应用程序的一些组件是什么。您希望拥有哪些工具和功能。不管服务器端语言是什么，你想要什么？

我在我的代码中看到很多我编写了一些似乎应该已经存在的功能。我查看了谷歌网络工具包，他们似乎做对了。小部件是小部件，您只需将它们添加到您的应用程序中。

例如。我使用 J2EE 应用程序，但在其他语言中，组件是相同的。

1.  控制器对象
2.  控制器处理程序，由控制器对象中的方法定义。
3.  定义 URL 映射和设置的配置文件。
4.  模板服务器页面文件（例如 JSP/ASP 文件）。
5.  定义应用程序对象和数据库之间的 O/RM 映射的配置文件。
6.  定义数据库连接属性的配置文件。
7.  JavaScript 库（例如 jQuery）
8.  记录配置文件
9.  资源消息包文件
10.  验证配置文件或代码
11.  中间件组件和对象（EJB 配置、JMS/消息传递配置等）。
12.  信用卡或其他中间件连接 API 和库。

你还能想到什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T04:46:23.953

内置单元测试组件

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-25T05:25:49.617

我认为您从这个非常详尽的列表中缺少的一件事是请求属性与表单对象的自动绑定，以及在适当的情况下将这些对象保存到会话中。此处的表单对象是服务器上的对象，表示基于 HTML 的当前状态，用于向用户显示。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-25T12:27:40.847

我认为脚手架和自动管理界面也是非常好的功能，我不想错过；）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-26T02:37:06.297

您已经假设所有 MVC 应用程序都是网站。MVC 不仅广泛用于 Web 应用程序，因此诸如 URL 映射器、模板服务器页面和“服务器端”语言之类的东西与 MVC 模式无关，就像在 Web 应用程序中使用的 MVC 的特定实现和改编一样。

# agile - 功能规范和敏捷流程

> ID：235383
> 
> 赞同：12
> 
> 时间：2008-10-24T21:55:00.900
> 
> 标签：agile, agile-processes, waterfall

在传统的 Waterfall 中，需求是按照深奥的模板收集的——通常是在 MS-Word 文档中。在“严格”的瀑布模型中，该文档在需求阶段之后被冻结，变更控制/变更管理流程负责引入受控变更。(**) [通常情况下，文件会变成“活文件”，最终变成“活生生的噩梦”]

目前，我要领导一个项目，该项目是将现有桌面应用程序重写为 Web（从 VB 6.0 到 ASP.Net）。客户有一个他想要重写的应用程序的基线版本。[所以需求被冻结......没有范围蔓延]。要按原样重用的数据模型。只迁移前端/业务规则。看应用程序，我觉得它最多只有 3/4 个主要屏幕，仅此而已。

一些团队成员想要在开始新开发之前记录（在我看来是老派的思想）整个事情。我和其他一些人认为，将 UI 转换为 Web 应该相对容易，查找旧代码，编写业务逻辑，进行自动化单元测试，进行集成测试并逐屏交付（或逐个业务功能）

我的问题是：在敏捷开发中，如果我不对其进行优化，我该如何保持“敏捷”。我的观点是写详细的文档是反敏捷的。你怎么看？敏捷大师将如何解决上述问题（将现有的 VB 6.0 应用程序重写为 ASP.Net）？

* * *

免责声明： *创建 1000 页的功能规范可能是为了履行合同义务、政治上的必要性，系统可能真的很复杂（现在，“复杂性”的定义是通往黑暗之地的旅程）。*

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-26T14:24:58.947

首先，如果客户或产品负责人要求拥有（阅读准备支付）文档，您可以**制作文档并保持敏捷。**

增量和迭代地扩展您的文档，就像您对代码所做的那样。测试一点，编码一点，然后……记录一点。

我看到了三种方法：要么包括在任务估计中编写文档的时间，创建文档特定的任务，要么有文档积压项目/故事。

文档故事的风险在于它们可能计划得很晚，在实施之后很长时间，所以我不推荐这样做。

文档任务具有在迭代计划中**可见**的优势，因此不应忘记或忽视它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T08:40:03.513

I've put a lot of thought on the subject - we work in a Scrum environment, and we've ended up having difficulties to organize the documentation.

What I'm heading to at the moment, though it's quite early so I don't know if it'll pass the long term test, is to use a wiki for the documentation.

Basically, the workflow is the following :

1.  Stories come up in the backlog
2.  Story gets picked up by a programmer
3.  Programmer does the code, and in the DoD (Definition of Done), also has to write some tests against the new functionnality, and has to edit the wiki to add a page for the new functionnality.

The wiki is organized with mediawiki templates, pretty much inspired from mediawiki extensions doc pages, with the name of the functionnality, the version it has been introduced into, anything that can be usefull. The template adds pictos to distinguish between different kinds of features (and of their status).

At the end of the day, the wiki has the great advantage of letting you add the documentation page without being bothered about where or how to put it, but obviously regularly you need someone to come behind and organize the mess.

The important thing to keep in mind, whatever tool you use, is that the developper should write some doc just after the development has taken place (including technical aspects) - and not before, and not months after...

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T22:17:33.957

敏捷并不意味着“没有规范”。这意味着尽早且经常地测试和发布（但不一定要投入生产）。

Scrum 中的待办事项是“规范”。如果您实际上没有写下和管理功能列表，您将失去功能，并且您将永远无法确定产品何时发布（将无法估计剩余的工作量，因为您有不知道你在哪里或者还有多少事情要做）。功能列表必须由某人管理。最简单的方法是写下产品应该做的所有事情（您可以根据需要获得尽可能复杂的措辞和定义）并跟踪已完成的内容和剩下的事情。您还将如何将工作分配给开发人员并将状态报告给“管理层？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-04-11T08:58:29.883

在我看来，功能规范是必要的，具体取决于技术团队对产品的参与程度以及团队的高级程度。如果技术团队参与产品定义，您肯定需要更少的文档，因为假设的空间会更小。如果您有一个由初级工程师组成的团队，您需要更强大的文档，否则事情将不会按照冲刺结束时定义的方式完成。
另请注意，由于不接近利益相关者和产品远见者的天然障碍，远程团队需要更多功能规范形式的文档。拥有预先的功能规范是敏捷的一个特征。我看到很多技术团队的任务仅由用户故事描述，而且我经常看到这些团队未能实现发布并满足利益相关者的期望。

这个主题非常广泛，有很多意见，但在我看来，这可以归结为开发人员不必猜测需求这一事实。

事实上，我相信可交付成果的成功和质量与开发人员需要做出的猜测/假设的数量成反比。我认为敏捷性会随着指定的好坏而增加，因为你会犯更少的错误，并且会花费更少的时间来纠正这些错误。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-25T08:31:53.453

如果创建功能规范是合同的必要条件，那么您应该仔细考虑其中的内容。如果您未能兑现您在功能规格中的承诺，您可能会被拒绝付款。

不幸的是，如果你采用这个过程，你将不会保持非常敏捷。客户*真的*希望重新编写的应用程序具有相同的功能吗？如果是，那为什么要重写？我确信有一个从未使用过的功能。

我不会费心记录旧版本。您已经有一个参考，即应用程序本身。软件中没有歧义。

文档编写不是反敏捷的。在没有优先考虑并从客户那里获得反馈的情况下设计一些东西是。敏捷的一个重要方面是获得客户的认可。如果他们不相信，那么该项目将比应有的更艰难。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-03-17T16:32:48.940

正如已经指出的那样，敏捷并不意味着很少或没有文档——“工作软件优于综合文档”。

我处理文档的方式几乎是颠倒过来，只考虑文档的*所有*部分（包括作为技术规范的代码和单元测试）。因此，描述业务/用户需求的故事（或您用来分配工作的任何其他机制）应该足够详细，以供从事工作的团队估计；否则，它是不完整和模糊的。此外，我在自己的实践中做的事情，如果故事（或其他）估计需要超过一个工作日才能符合团队对“完成”的定义，它很可能应该被分解（这种原子化然后编译最终导致相当广泛的文档，但不会像不这样做那样假设很多未知数 - 并且可以导致非常有趣的重用和模式启示）。

*使用 BDD 样式要求的示例：*

```
Given I am working on a document
When I select "Save As..."
Then a menu should appear allowing me to choose a name, 
and a file type, 
and a location in the file system,
and a file should be created in the file system 
```

我们可能需要/想要添加 UI 元素来完成此操作，菜单项、情节提要、键盘快捷键等。等等。

*所有*这些相关的工件都可以附加到基础故事/需求上；产生更完整的文档。但是，仅将您实际实施的那些故事添加到您的软件 Web 版本的文档中。

这就是事情变得有点颠倒并变得更加“敏捷”的地方。在开发期间和开发之后，重新访问文档化的需求并添加团队编辑所做的更改/修改/改进（无需通过仅文档化的 CCB）。编辑/更新文档和相关资产的能力无需通过所有审查委员会和诸如此类的 - 或者当我们在开发过程中发现文档在某种程度上不完整时将文档“扔回墙上”使我们能够适应未知数 - 因此，敏捷。

该文档应该具有某种形式的版本控制或历史记录，它允许我们描述我们想要的系统，但也描述实际实现的系统 - 注意另一个关于文档是完成定义的一部分的答案/建议（我也做）。（Wiki 对此有好处；然而，一个完全集成的概念更可取 - 例如，能够将票证与版本控制系统中的主干中的文件相关联会很好。）

总结一下。预先创建详尽的文档，在开发工作期间和/或之后不久就无法更改，这将使您无法敏捷 - 能够快速适应未知情况。然而，参考领先的精益软件开发，他们提到如果政策不允许正确使用某些实践/流程，那么你是否说你是精益（或 scrum 或敏捷）都没关系。

确保您不会过于详尽的一种方法-可能已经在此答案中使用了这种心态-仅在需要时才编写*所需*的内容（通常在开发中存在类似的概念）。另一种方法是让每个人都明白，您不需要预先尝试并弄清楚*所有事情*（从瀑布到敏捷的最大转变） - 我们将记录每个想法，它可能会或可能不会最终发布。最后，弃用（并删除）任何不再适用的东西……我记得曾经看过一个系统的文档，当我查看系统时，有一半的文档实际上不再适用于系统了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-24T22:30:59.860

由于您有一份描述产品应该做什么的文档，我会将其用作初始积压工作，并开始将工作拆分为从最高优先级到最低优先级排序的小块。然后将在迭代期间处理每组片段。简而言之，将 Scrum 与您的初始文档一起用作 backlog。

如果不进行优先级排序工作，我不会直接进行实施。它不需要大量的写作，但更多地参考您想要处理的部分。

我不会预先记录整个事情。

此外，您将有一些与您要处理的平台直接相关的任务，这些任务需要被捕获并添加到 sprint backlog 中。

此外，您可能会意识到您不想在几次迭代后实现所有需求。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-07-03T13:29:58.863

敏捷有一个以敏捷特性列表、产品待办列表形式存在的功能规范文档，甚至在冲刺待办列表中的任务也是如此。它们不被称为文件的事实并没有减少它们。与瀑布中的功能规范的区别？...敏捷功能规范仅包含所需的内容（哈哈），因此内容较少，还记得您的“工作软件优于综合文档”吗？

# c++ - 在 C++ 中使用 NaN？

> ID：235386
> 
> 赞同：33
> 
> 时间：2008-10-24T21:56:22.533
> 
> 标签：c++, floating-point, nan

在 C++ 中使用 NaN 的最佳方法是什么？

我发现`std::numeric_limits<double>::quiet_NaN()`和`std::numeric_limits<double>::signaling_NaN()`。我想`signaling_NaN`用来表示一个未初始化的变量，如下所示：

```
double diameter = std::numeric_limits<double>::signaling_NaN(); 
```

但是，这会在分配时发出信号（引发异常）。我希望它在使用时引发异常，而不是在分配时。

有什么方法可以在`signaling_NaN`不引发分配异常的情况下使用？是否有一个好的、可移植的替代方案在`signaling_NaN`使用时会引发浮点异常？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-11T18:32:35.827

在进一步研究之后，它看起来像`signaling_NaN`提供的那样没用。如果启用了浮点异常，则调用它算作处理信号 NaN，因此它会立即引发异常。如果浮点异常被禁用，则处理信号 NaN 会自动将其降级为安静的 NaN，因此`signaling_NaN`这两种方式都不起作用。

[Menkboy 的代码](https://stackoverflow.com/questions/235386/using-nan-in-c#235490)有效，但尝试使用信号 NaN 会遇到其他问题：没有可移植的方法来启用或禁用浮点异常（如[这里](https://stackoverflow.com/questions/85726/converting-floating-point-exceptions-into-c-exceptions#88829)和[这里](https://stackoverflow.com/questions/235664/how-to-use-stdsignalingnan#236025)所提到的），如果您依赖于启用的异常，第三方代码可能禁用它们（如此[处](https://stackoverflow.com/questions/235664/how-to-use-stdsignalingnan#237391)所述）。

所以看起来[莫蒂的解决方案](https://stackoverflow.com/questions/235386/using-nan-in-c#236952)确实是最好的选择。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-25T20:02:27.903

信号 NAN 的意思是当 CPU 遇到它时会触发一个信号（因此得名）。如果您想检测未初始化的变量，那么提高编译器的警告级别通常会检测到所有使用未初始化值的路径。如果您无法使用存储布尔值的包装类来说明值是否已初始化：

```
template <class T>
class initialized {
    T t;
    bool is_initialized;
public:
    initialized() : t(T()), is_initialized(false) { }
    initialized(const T& tt) : t(tt), is_initialized(true) { }
    T& operator=(const T& tt) { t = tt; is_initialized = true; return t; }
    operator T&() {
         if (!is_initialized)
             throw std::exception("uninitialized");
         return t; 
   }
}; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T22:35:59.523

您可以将信号 NaN 写入变量而不会触发类似这样的异常（nb：未经测试）

```
void set_snan( double &d )
{
    long long *bits = (long long *)&d;
    *bits = 0x7ff0000080000001LL;
} 
```

它适用于大多数地方，但不，它不是 100% 便携的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-25T19:57:05.107

好吧，看看安静和信号 NaN 的定义，我真的无法区分。

您可以自己使用这些函数中使用的代码，也许它可以防止异常，但是在这两个函数中没有看到异常，我认为它可能与其他东西有关。

如果要直接分配 NaN：

```
double value = _Nan._Double; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-11-05T15:49:34.910

简单的答案：在头文件中做这样的事情并在其他地方使用它：

```
#define NegativeNaN log(-1) 
```

如果您希望对它们进行某种操作，最好在`exp()`like`extended_exp()`等周围编写一些扩展的包装函数！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T22:42:48.773

您的 C++ 实现可能具有用于访问浮点环境以测试和清除某些浮点异常的 API。有关更多信息，请参阅[我对相关问题的回答](https://stackoverflow.com/questions/85726/converting-floating-point-exceptions-into-c-exceptions#88829)。

# asp-classic - 使用 ASP 将文件从 Web 用户上传到服务器

> ID：235391
> 
> 赞同：1
> 
> 时间：2008-10-24T21:58:03.170
> 
> 标签：asp-classic, user-input

我正在尝试找出如何使用 ASP 页面将文件从 Web 用户上传到服务器。显示的页面有一个“文件”类型的输入标签，如下所示：

```
<input type="file" name="uploadfile"> 
```

以及将表单信息传递到另一个 .ASP 页面的提交按钮。此页面必须采用从 Input 控件获取的路径，并使用它以某种方式将文件保存到服务器。

我一直在想一定有一种通用的方法可以做到这一点，因为我在很多网站上都看到过这种事情，但它是如何做到的呢？是否有某种可以调用的服务器对象？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T22:01:39.093

这个[脚本](http://www.webconcerns.co.uk/asp/uploadasp/default.asp)会帮助你。

此外，您可以搜索“ [asp 上传文件](http://www.google.com/search?q=asp+upload+file)” - 有大量结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T22:08:23.057

如果您正在做任何严肃的上传或拥有商业产品，您确实需要在经典 asp 中使用 COM 组件。查看 SA-FileUp。从那以后，它一直是事实上的标准。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T19:15:58.277

如果您的托管服务不允许您安装组件，您可能还需要查看此脚本：

[http://chris.brimson-read.com.au/index.php?option=com_content&view=article&id=6&Itemid=7](http://chris.brimson-read.com.au/index.php?option=com_content&view=article&id=6&Itemid=7)

我见过各种各样的上传脚本，它们......质量各不相同。我没有在所选答案中使用脚本，但值得尝试一些不同的选项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T02:52:25.643

我可以推荐[SA-FileUp](http://fileup.softartisans.com/)和 Dundas Upload。它们都易于安装，并且有关于如何实现的很好的教程。

# theory - 理论计算机科学什么时候有用？

> ID：235394
> 
> 赞同：28
> 
> 时间：2008-10-24T22:00:55.427
> 
> 标签：theory, turing-machines, halting-problem, computation

在课堂上，我们学习了停机问题，图灵机，归约等。很多同学说这些都是抽象无用的概念，了解它们没有任何意义（即，一旦课程结束就可以忘记它们）结束并且不会丢失任何东西）。

为什么理论有用？您是否曾经在日常编码中使用它？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-24T22:12:09.493

真实的故事：

当我从研究生院毕业获得第一份编程工作时，拥有我工作的公司的人是飞行员。在我被录用几周后，其中一个人问我这个问题：

> 阿肯色州有106个机场。你能写一个程序来找到降落在每个人身上所需的最短路线吗？

我认真地认为他是在问我关于旅行商问题和 NP 完备性的知识。但事实证明他不是。他对此一无所知。他真的想要一个能找到最短路径的程序。当我解释说有 106 个因子解决方案并且找到最好的一个是众所周知的计算上难以解决的问题时，他感到很惊讶。

这就是一个例子。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-25T00:06:00.527

当我大学毕业时，我以为我和其他人一样：“我有 CS 学士学位，很多其他人也是如此，我们基本上都可以做同样的事情。” 我最终发现我的假设是错误的。我脱颖而出，这与我的背景有很大关系——尤其是我的学位。

我知道有一个“轻微”的区别，因为我的大学是美国第一所（据说是 1987 年的第二个）获得其 CS 学位课程认证的大学之一，我在 CS 中获得了“BS”，而我在第二类毕业以获得该认证。当时，我认为这并不重要。

在高中和大学期间，我还注意到我在 CS 方面做得特别好——比同龄人好得多，甚至比我的许多老师还要好。我经常被要求帮助，做过一些辅导，被要求帮助完成一个研究项目，并且在没有其他人的情况下被允许进行独立学习。我很高兴能够提供帮助，但我并没有考虑太多不同之处。

大学毕业后（美国足协），我在空军呆了四年，其中两年正在申请我的计算机科学学位。在那里，我注意到我的同事中很少有人拥有与计算机相关的学位甚至培训。空军让我参加了五个月的认证培训，在那里我再次发现缺乏学位或培训。但在这里我开始注意到不同之处——很明显，我遇到的许多人并不真正知道他们在做什么，其中包括受过培训或获得学位的人。请允许我举例说明。

在我的空军认证培训中，总共有 13 人（包括我）。作为空军军官或同等学历，我们都有学士学位。根据年龄和等级，我处于中间（我是六名 O-1 和六名 O-3 及以上的 O-2）。在这次培训结束时，空军给我们所有人盖上橡皮图章，让我们所有人都同样有能力为国防部的任何部门获取、建造、设计、维护和操作任何计算机或通信系统。

然而，在我们十三个人中，只有六人拥有任何形式的计算机相关学位；其他七人拥有从航空到化学/生物学再到心理学的学位。在我们六个拥有计算机科学学位的人中，我了解到有两个从未编写过任何类型的程序，并且从未使用过电脑，只是随便（写论文、玩游戏等）。我了解到，我们中的另外两个人在他们的计算机科学学位课程中已经在一台计算机上编写了一个程序。只有另外一个人和我自己写过不止一种程序，或者使用过不止一种计算机——事实上，我们发现我们两个写过很多程序，使用过很多种计算机。

在我们为期五个月的培训即将结束时，我们班被分配了一个编程项目，我们分成四组分别进行。为了公平地传播“编程人才”，我们的导师分班，他们分配了团队负责人、技术负责人和开发人员的角色。每个小组都有一周的时间在教练提供的飞行力学库之上为飞行模拟器实施（在 Ada 中）全屏、基于文本的用户界面（这是 1990 年）。我被指派为我的四人团队的技术主管。

我的团队负责人（没有计算机学位）要求我们三个人将项目分成任务，然后将其中的三分之一分配给我们每个人。我在第一天的中间完成了我的第三个任务，然后在剩下的时间里帮助我的另外两个队友，和我的团队负责人交谈（BSing ;^），并在我的电脑上玩。

第二天早上（第二天），我的团队负责人私下告诉我，我们的另外两个队友没有取得任何进展（其中一个实际上无法写出能够编译的“如果”语句），他让我接手他们的工作。我在下午三点前完成了整个项目，我的团队花了一整天的时间在模拟器上飞行。

另一个具有同等 CS 学位的人也被指定为他团队的技术主管，他们在第三天结束时完成了工作。他们也开始飞行他们的模拟器。到本周末，另外两支球队还没有完成，甚至没有取得重大进展。我们不被允许帮助其他球队，所以就这样了。

与此同时，到第三天中午，我注意到飞行模拟器似乎表现“错误”。因为我的一个同学有航空学学位，所以我问他这件事。他一头雾水，然后坦白自己根本不知道是什么让飞机飞起来的！？！我傻眼了！事实证明，他的整个学位课程都是关于安全和坠机调查的——飞行背后没有真正的数学或科学。另一方面，我可能辅修过航空学（还记得 USAFA 吗？），但我们设计了机翼并进行了真正的风洞测试。因此，我在本周剩下的时间里悄悄地重写了教练提供的飞行力学库，直到模拟器“正确”飞行。

从那时起，我作为一名承包商和偶尔作为一名员工度过了近 20 年，一直从事软件开发和相关活动（DBA、架构师等）。我继续找到更多相同的东西，最终我放弃了我年轻的假设。

那么，我到底发现了什么？不是每个人都是平等的，这没关系——我不是一个更好的人，因为我可以有效地编程，但如果你需要我的话，我会更有用。我了解到我的背景真的很重要：在一个电工和电气工程师家庭长大，制造电子套件，从字面上阅读学校/公共图书馆的每一本计算机书籍，因为我没有真正的计算机，然后搬到新的我的高中确实有电脑的城市，然后得到了我自己的电脑作为礼物，去有许多不同大小和类型的电脑（PC到大型机）的学校，从一所非常好的工程学校获得认可的学位，不得不写作在不同类型的计算机上使用不同语言的大量程序，

最终，我了解到我的能力建立在了解计算机如何从电气层面向上工作的基础之上——离散电子元件、电路、子系统、接口、协议、位、字节、处理器、设备、驱动程序、库、程序、系统、网络，一直到我现在经常工作的大型企业级企业集团。所以，当这该死的东西行为不端时，我确切地知道如何以及为什么。我知道什么不能做，什么可以做。而且我知道很多关于已经完成的事情，已经尝试过的事情，以及相对未探索的事情。

最重要的是，在我学会了所有这些之后，我才知道我什么都不知道。面对所有可能知道的事情，我的知识是微不足道的。

我对此很满意。但我建议你试试。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-24T22:23:24.960

当然，它很有用。

想象一个开发模板引擎的开发人员。你知道那种事...

```
Blah blah blah ${MyTemplateString} blah blah blah. 
```

它开始很简单，用一个厚脸皮的小正则表达式来执行替换。

但渐渐地，模板变得更加花哨，开发人员包括模板化列表和字符串映射的功能。为此，他编写了一个简单的小语法并生成了一个解析器。

变得非常狡猾，模板引擎最终可能包含条件逻辑的语法，以根据参数的值显示不同的文本块。

具有 CS 理论背景的人会认识到模板语言正在慢慢变得图灵完备，也许解释器模式将是实现它的好方法。

为模板构建解释器后，计算机科学家可能会注意到大多数模板请求是重复的，一遍又一遍地重新生成相同的结果。因此开发了一个缓存，所有请求在执行昂贵的转换之前都通过缓存进行路由。

此外，一些模板比其他模板复杂得多，渲染时间也更长。也许有人想到在渲染每个模板之前估计它的执行。

可是等等！！！团队有人指出，如果模板语言真的是图灵完备的，那么估计每个渲染操作的执行时间的任务就是Halting Problem的一个实例！！咳咳，不要这样！！！

在实践中，关于理论的事情是，所有的实践都是基于理论的。理论上。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-10-24T22:05:00.240

我最常用的东西：

*   编写可优雅扩展的算法的计算复杂度
*   了解内存分配、分页和 CPU 缓存的工作原理，以便编写高效的代码
*   对数据结构的理解
*   了解线程、锁定和相关问题

至于图灵机等方面的东西。我认为这很重要，因为它定义了我们所有人操作的约束条件。欣赏这一点很重要。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-10-26T17:10:59.387

这是学习代数和被教如何使用计算器之间的区别

如果您了解代数，您就会意识到同一个问题可能以不同的形式表现出来，并且您了解将问题转换为更简洁形式的规则

如果您只知道如何使用计算器，您可能会浪费大量时间来处理（a）已经解决、（b）无法解决或（c）与其他问题类似（已解决或未解决）您无法识别，因为它的形式不同

假装一下，计算机科学是物理学……这个问题看起来很傻吗？

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-24T22:07:19.987

我的一个朋友正在研究一种带有一些模板的语言。我被要求做一些咨询。我们讨论的部分内容是关于模板功能，因为如果模板是图灵完备的，他们将不得不真正考虑 VM-ish 属性以及他们的编译器如何/是否支持它。

我的故事是这样的：自动机理论仍然被教授，因为它仍然具有相关性。停止问题仍然存在，并且限制了您可以做的事情。

现在，这些事情是否与数据库管理员敲定 C# 代码有关？可能不是。但是当你开始进入更高级的水平时，你会想要了解你的根源和基础。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-24T22:31:19.813

虽然我没有将它们直接应用到日常工作中，但我知道我对正规计算机科学的教育影响了我的思维过程。我当然从一开始就避免了某些错误，因为我从灌输给我的正式方法中吸取了教训。

在他们学习的时候，它可能看起来毫无用处；但我敢打赌，你的同学最终会遇到一个问题，他们将使用他们所教的东西，或者至少是它背后的思维模式......

*打蜡...打蜡...打蜡...打蜡...这与空手道有什么关系？*

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-27T21:33:42.630

在一项工作中，我的任务是改进我们的配电模型的网络跟踪算法，因为他们使用的算法太慢了。三相网络本质上是三个 n 树（因为电网中不允许使用环路）。网络节点在数据库中，一些原始团队无法弄清楚如何构建内存模型，因此跟踪是通过数据库上的连续深度 SELECT 完成的，在每个阶段进行过滤。因此，要从变电站跟踪一个节点，十个节点至少需要 10 个数据库查询（最初的团队成员是数据库专家，但缺乏良好的算法背景）。

我编写了一个解决方案，将数据库中的 3 个 n-tree 节点网络转换为一个数据结构，其中每个节点在节点结构数组中存储一次，并且使用内部的双向链接指针将 n-tree 关系转换为三个二叉树阵列，以便可以轻松地在任一方向上跟踪网络。

它至少要快两个数量级，在很长的下游轨迹上要快三个数量级。

可悲的是，为了让他们理解算法，我不得不向其他几位接受过数据库和 VB 培训的程序员实际教授一门关于 n 树、二叉树、指针和双向链表的课程。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-25T00:48:30.893

这是一个经典的二分法，在“如何”和“什么”之间。你的同学正在研究“如何”编写软件，他们非常关注近焦；从这个角度来看，从实现的角度来看，似乎了解诸如停止状态和图灵机之类的东西并不重要。

但是，“如何”在计算机科学领域所期望的实际工作中很少。事实上，我认识的大多数成功的工程师可能会认为它不到实际工作的 20%。“做什么”要重要得多；为此，计算机科学的基础知识至关重要。您想做的“什么”与设计有关，而不是与实施有关；好的设计是……好吧，我们就称它为“不平凡的”。

***“构建软件设计有两种方法：一种方法是简单到没有明显的缺陷，另一种方法是复杂到没有明显的缺陷。第一种方法要困难得多。”*** - 汽车霍尔

祝你学业顺利！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-24T22:10:10.290

我认为理解计算的基本模型是有用的：确保在实践中你永远不需要能够将图灵机转换为寄存器机，但是学习如何看到两个非常不同的问题实际上是同一概念的实例是至关重要的技能。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-24T22:10:19.357

大多数知识不是“实用的”，而是帮助您以您无法预料的方式连接点，或者为您提供更丰富的词汇来描述更复杂的想法。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-25T00:26:02.250

重要的不是你研究的具体问题，而是你通过研究它们学到的原理。我每天在工作中都会使用有关算法、数据结构、编程语言和操作系统的概念。如果你是一名程序员，你会一直做出影响系统性能的决定。你需要在基本的抽象概念上有坚实的基础才能做出正确的选择。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2014-08-19T18:35:00.780

从 CS 毕业后，我也有类似的想法：我们研究的一堆理论在实践中完全没用。这在短时间内被证明是正确的，但是当您处理复杂的任务时，理论绝对比实践更有价值。经过几年的编码，每个人都可以编写一些“工作”的程序，但并不是每个人都能理解如何。无论我们大多数人在某个时候会处理什么性能问题、网络延迟、精度、可扩展性等。在这个阶段，理论是至关重要的。为了在处理复杂系统时设计一个好的解决方案，了解内存管理的工作原理、进程和线程的概念、内存是如何分配给它们的，或者用于性能的高效数据结构等非常重要。

例如，有一次我正在做一个包含大量数学计算的项目，但在某个时候我们的软件失败了。在调试时，我发现经过一些数学运算后，我收到了一个数值为 1.000000000002 的数字，但从数学的角度来看，它不能 > 1，这在程序的某个后期阶段给出了传说中的**NaN**异常。我花了一些时间来解决这个问题，但如果我更加关注“ *Double and Float 的近似*”课程，我就不会浪费时间了。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-08-19T14:57:18.217

如果您在一家从事开创性工作的公司工作，那么能够与架构师和开发人员交流其好处是很重要的。有很多关于各种技术的炒作，定位自己可能很困难。当你用科学和理论的术语来构建你的创新时，你肯定处于优势，客户会觉得你是真实的东西。我可以告诉人们：有一种处理状态、编码和非确定性（即复杂性）的新方法，你绝对可以比现在更有效率。

如果你在你的职业生涯中放眼长远，学习理论会给你带来深度，你需要成长的深度。学习第 5 或第 6 种编程语言的投资回报将远低于学习第 2 和第 3 语言。接触理论将使您了解真正的工程，了解自由度在哪里以及如何做出正确的权衡。

重要概念 1) 状态，2) 编码，3) 非确定性。如果你不认识他们，他们不会帮助你。理论应该为您提供的是大局和基本概念如何组合在一起的感觉。它应该可以帮助你磨练你的直觉。

示例：上面的一些答案提到了停机问题和图灵机。当我在大学里看到图灵的论文时，我一点也不觉得开悟。有一天，我遇到了 Goedel 的不完备性定理，尤其是 Goedel 编号。事情开始变得很有意义。多年后，我在一家书店读到了 Georg Cantor 的故事。现在我真正开始了解图灵机和停机问题。自己尝试并在 Wikipedia 上查找“康托尔对角线论证”。这是您在智力上会遇到的最令人敬畏的事情之一。

深思熟虑：典型的图灵机并不是设计状态转换机的唯一方法。具有两个而不是一个磁带的图灵机将为您提供更多算法的速度。[http://www.math.ucla.edu/~ynm/papers/eng.ps](http://www.math.ucla.edu/~ynm/papers/eng.ps)

通过阅读本书，您可以比我更有效地接触这些见解。链接在这篇文章的底部。（至少，请查看亚马逊上的目录以了解这一切）：

我发现罗森伯格的这本书耸人听闻。[http://www.amazon.com/The-Pillars-Computation-Theory-Nondeterminism/dp/0387096388](https://rads.stackoverflow.com/amzn/click/com/0387096388)如果你只有一本关于理论的书恕我直言，这应该是一本。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-24T22:06:46.290

我不是每天都使用它。但它给了我很多理解，这对我每天都有帮助。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-24T22:45:57.100

我发现我每天都需要从 CS 理论世界获得幸福，就是说出“低耦合和高内聚”的口头禅。[罗杰·S·普雷斯曼在](https://rads.stackoverflow.com/amzn/click/com/007301933X)[史蒂夫·麦康奈尔](https://rads.stackoverflow.com/amzn/click/com/0735619670)让它成为时尚之前就让它变得学术化了。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-25T01:02:32.317

是的，我通常使用状态图来设计程序的形状和流程。一旦它在理论上起作用，我就开始编码和测试，同时检查状态。

我发现它们也是向其他人解释流程行为的有用工具。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-26T17:39:20.890

简单的。例如：如果我使用的是**RSACryptoServiceProvider**，我想知道那是什么以及为什么我可以信任它。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-27T20:57:41.377

因为 C++ 模板实际上是某种 lambda 演算。见 www.cs.nott.ac.uk/types06/slides/michelbrink_types_06.pdf

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-01-06T19:05:02.237

我现在正在学习我的分布式算法课程。有一章是关于容错的，它包含一些关于有多少进程可能失败（或行为不端）的上限的证明，以便分布式算法可以正确处理它。

对于许多问题，行为不端的进程的界限高达进程总数的三分之一。我认为这非常有用，因为您知道尝试开发更好的算法（在给定的假设下）是没有意义的。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-02-01T18:35:16.477

即使不直接使用理论课程，它也可以帮助您更好地思考某些事情。

你不知道你的老板会要求你做什么，你可能不得不使用一些你认为不会有好处的东西，正如 Jeffrey L Whitledge 所说。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-01-14T06:39:37.317

老实说，我有点不同意这里的很多答案。我写了我的第一个编译器（为了好玩；我*真的*有太多的咖啡/空闲时间）而没有参加编译器课程；基本上我只是扫描了另一个编译器的代码并遵循了模式。我可以用 C 语言编写一个解析器，但如果我的生活依赖于它，我想我不记得如何绘制下推自动机了。

当我决定要在我的玩具（命令式）编程语言中加入类型推断时，我首先查看了大约五篇论文，盯着一个叫做“类型化 lambda 演算”的东西……………… **** ……？起初我尝试用“泛型变量”和“非泛型变量”来实现一些东西，但不知道发生了什么。然后我把它全部报废了，拿着一个笔记本坐在那里，思考如何在支持所有我需要的东西（子类型、一流函数、参数化类型等）的情况下实际实现它。经过几天的思考和编写测试程序，我花了一个多星期的时间试图弄清楚理论上的废话。

了解计算的基础知识（即虚拟内存如何工作、文件系统如何工作、线程/调度、SMP、数据结构）都被证明非常有用。复杂性理论和 Big-O 的东西有时被证明是有用的（特别是对诸如 RDBMS 设计之类的东西有用）。停机问题和自动机/图灵机理论？绝不。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-02-21T13:51:41.943

我知道这已经过时了，但我对那些声称理论“无用”并且他们可以在没有理论的情况下实践他们的职业的人的简短回复是这样的：

**没有基础理论，就*没有*实践。**

> 为什么理论有用？

理论是建立其他事物的基础。当理论*应用时*，实践就是结果。

**考虑今天的计算机。**今天的普通计算机是在图灵机之上建模和构建的，为了简单起见，图灵机是一个用于计算的抽象/理论模型。这个理论模型是计算的*基础*，我们今天使用的所有计算设备，从高端服务器到袖珍手机，都可以工作，因为底层基础是健全的。

**考虑算法分析。**简单来说，算法分析和时间复杂性理论已被用于对问题进行分类（例如 P、NP、EXP 等）以及我们在尝试解决不同类别中的不同问题时的算法行为。

假设您的一个朋友在某个地方 X 找到了一份工作，并且在那里，一位经理提出了一些简单的请求，例如以下示例：

> **示例 1：**我们拥有一支庞大的送货车队，他们前往多个州的不同城市。我们需要*您*实施一个系统来确定每辆车的最短路线是什么，并从所有可能性中选择*最佳路线。*你能做到吗？

认为这个理论是“无用的”，你的朋友没有意识到他们刚刚遇到了旅行商问题 (TSP) 并开始不假思索地设计这个系统，只是发现他们检查*所有*可能性的天真尝试，因为最初要求，太慢了，他们的系统无法用于任何实际目的。

事实上，他们*不知道为什么*系统在检查 5 个城市时工作在“可接受”的水平，但在 10 个城市时变得非常缓慢，并且在只检查 40 个城市时就卡住了。他们认为它*只是*“比 5 城市测试多 2 倍和 8 倍的城市”，并想知道为什么该程序不简单地分别需要“多 2 倍和 8 倍的时间”......

理解该理论将使他们至少一目了然地意识到以下几点：

1.  这是TSP
2.  TSP 是 NP 难的
3.  他们算法的增长顺序是*O(n!)*

数字不言自明：

```
+--------------+-------+-----------------------------------------------------------------+
|  No. Cities  | O(N!) |  Possibilities                                                  |
+--------------+-------+-----------------------------------------------------------------+
|       5      |   5!  | 120                                                             |
|      10      |  10!  | 3,628,800                                                       |
|      40      |  40!  | 815,915,283,247,897,734,345,611,269,596,115,894,272,000,000,000 |  <-- GG
+--------------+-------+-----------------------------------------------------------------+ 
```

他们可能一开始就意识到他们的系统*不会*像他们想象的那样工作。该系统后来被认为不切实际，并在大量时间、精力和其他资源被分配给该项目并最终浪费在该项目上后被取消——这一切都是因为认为“理论毫无用处”。

所以在这次失败之后，管理人员认为“好吧，也许那个系统被低估了；毕竟，我们国家有很多城市，我们的计算机根本没有我们需要的速度来满足我们最近取消的系统的要求。已经成功”。

管理团队将缓慢的计算机归咎于项目失败的原因。毕竟，他们不是 CS 理论专家，也不必如此，而那些本应是该主题的专家并且可以告知他们的人却没有。

但他们有另一个项目。其实比较简单。他们一周后来，要求说以下内容：

> **例 2：**我们只有几台服务器，我们有程序员不断提交程序，由于未知原因，最终陷入无限循环并占用服务器。我们需要*你*编写一个程序，对提交的代码进行处理，检测提交的程序在运行过程中是否会造成无限循环，并在此基础上决定是否允许提交的程序运行。你能做到吗？

你亲爱的朋友再次接受挑战并立即开始工作。工作几个星期后，没有任何结果，你的朋友压力很大，不知道该怎么办。又一次失败……你的朋友现在因为没能解决这个“简单的问题”而感到“愚蠢”……毕竟，请求本身使它*听起来*很简单。

不幸的是，您的朋友虽然坚持“理论是无用的”，但并没有意识到，据称简单的请求实际上是一个关于可判定性的棘手问题（即停止问题本身），并且没有已知的解决方案。这是一项不可能完成的任务。

因此，即使开始着手解决该特定问题也是一个可避免和可预防的错误。如果有理解所要求内容的理论框架，他们可以提出一个不同的、*可实现*的解决方案......例如实施一个可以简单地监控`kill -SIGTERM <id>`任何*用户*进程的监控进程（根据用户列表) 在某些假设下（例如，我们知道每个程序运行都应该在 10 分钟内终止，因此任何运行超过 20 分钟的实例都应该被`kill`编辑），从而在某些任意/合理的时间间隔内垄断 CPU。

总之，*没有理论的实践就像没有地基的建筑*。迟早，*来自正确角度的适量压力会使它自行塌陷*。没有例外。

> 您是否曾经在日常编码中使用它？

是的，但不是*直接*的。*相反，我们间接*依赖它。这里需要注意的是，不同的理论概念将或多或少适用，具体取决于您碰巧正在研究的问题领域。

当然，我们：

1.  每天使用计算机，这依赖于计算模型（例如图灵机）
2.  编写代码，这依赖于可计算性理论（例如什么是可计算的）和 lambda 演算（例如用于编程语言）
3.  依靠色彩理论和模型（例如 RGB 和 CMYK 颜色模型）进行彩色显示和打印等。
4.  计算机图形学中的欧拉定理，以便可以构建矩阵以围绕任意轴旋转对象，等等......

事实是，仅仅*使用*飞机旅行的人不需要理解甚至允许飞机首先建造和飞行的理论……但是当人们期望有人*建造*所说的机器并使它们工作时。 .. 你真的能期待一个连飞行原理都不懂的人会有好的结果吗？

Was it really a coincidence that, for most of history, no one was able to build a flying machine (and a few even died testing theirs) until the Wright brothers understood certain theoretical concepts about flight and managed to put them into practice?

It's no coincidence. We have a lot of working technology today because the people who built them understood, and applied, the theoretical principles that allowed them to work in the first place.

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2008-10-24T22:15:45.897

我想这取决于你进入哪个领域。

# unit-testing - 对大型数据集进行单元测试？

> ID：235402
> 
> 赞同：11
> 
> 时间：2008-10-24T22:03:44.377
> 
> 标签：unit-testing

对大型数据集进行单元测试的最佳方法是什么？我正在维护的一些遗留代码具有一百个或更多成员的结构；我们正在处理的代码的其他部分创建或分析数百个样本的数据集。

到目前为止，我发现的最佳方法是从磁盘序列化结构或数据集，执行被测操作，将结果序列化到磁盘，然后将包含序列化结果的文件与包含预期结果的文件进行比较。这不是非常快，并且违反了单元测试的“不要碰磁盘”原则。然而，我能想到的唯一选择（编写代码来初始化和测试数百个成员和数据点）似乎令人难以忍受的乏味。

有没有更好的解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T22:22:52.963

实际上，如果您要实现的目标是单元测试，则应该模拟底层数据结构并模拟数据。这种技术使您可以完全控制输入。例如，您编写的每个测试都可能处理一个数据点，并且您将针对每个条件进行一组非常简洁的测试。有几个开源的模拟框架，我个人推荐 Rhino Mocks ( [http://ayende.com/projects/rhino-mocks/downloads.aspx](http://ayende.com/projects/rhino-mocks/downloads.aspx) ) 或 NMock ( [http://www.nmock.org](http://www.nmock.org) )。

如果您无法模拟出我建议重构的数据结构，以便您能够:-) 它值得！或者您可能还想尝试允许模拟具体类的TypeMock ( [http://www.typemock.com/ )。](http://www.typemock.com/)

但是，如果您正在对大型数据集进行测试，那么您实际上是在运行功能测试而不是单元测试。在这种情况下，将数据加载到数据库或从磁盘中是一种典型操作。而不是避免它，你应该努力让它与你的自动化构建过程的其余部分并行运行，这样性能影响就不会阻碍你的任何开发人员。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T22:22:11.957

> 到目前为止，我发现的最佳方法是从磁盘序列化结构或数据集，执行被测操作，将结果序列化到磁盘，然后将包含序列化结果的文件与包含预期结果的文件进行比较。

我已经编写了使用上述技术的代码，除了在测试中从磁盘序列化之外，我已经将序列化的数据转换为编译器可以为您放入可执行文件的字节数组。

例如，您的序列化数据可以转换为：

```
unsigned char mySerialisedData[] = { 0xFF, 0xFF, 0xFF, 0xFF, ... };

test()
{
    MyStruct* s = (MyStruct*) mySerialisedData;

} 
```

有关更详细的示例（在 C# 中），请参阅此[单元测试](http://anonsvn.mono-project.com/viewvc/trunk/mcs/class/Mono.Security/Test/Mono.Security/StrongNameTest.cs?revision=101823&view=markup)。它显示了一个使用一些硬编码的序列化数据作为测试输入的示例，测试程序集签名。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T22:13:56.460

这仍然是一种可行的方法。虽然，我会将其归类为功能测试，或者不是纯粹的单元测试。一个好的单元测试是对那些可以很好地分布你可能遇到的边缘情况的记录进行抽样，然后把它们写下来。然后，您将通过对所有数据的批量测试进行最后一次“验收”或“功能”测试。

我在测试大量数据时使用过这种方法，我发现它工作得很好，因为小单元是可维护的，然后我知道批量测试有效，而且都是自动的。

# excel - 在 VBA 精度问题中比较 double

> ID：235409
> 
> 赞同：15
> 
> 时间：2008-10-24T22:05:55.603
> 
> 标签：excel, vba, comparison, double

我无法在 Excel VBA 中比较 2 双倍

假设我有以下代码

```
Dim a as double
Dim b as double
a = 0.15
b = 0.01 
```

在对 b 进行几次操作之后，b 现在等于 0.6

然而，与双数据类型相关的不精确性让我很头疼，因为

```
if a = b then
 //this will never trigger
end if 
```

你知道我怎样才能消除双精度类型的尾随不精确吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-24T22:12:46.340

您无法比较浮点值是否相等。有关如何处理内在错误的讨论，请参阅这篇关于“[比较浮点数”的文章。](http://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/)

除非您事先确定浮点数的绝对范围是多少，否则它不像与恒定误差范围进行比较那么简单。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-04-07T06:14:21.673

如果你要这样做......

```
Dim a as double  
 Dim b as double  
 a = 0.15  
 b = 0.01 
```

您需要像这样在 IF 语句中添加轮函数...

```
 If Round(a,2) = Round(b,2) Then   
     //code inside block will now trigger.
  End If 
```

另请参阅[此处以获取其他 Microsoft 参考](http://support.microsoft.com/kb/78113)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-24T22:09:40.387

在平等方面比较双打是不明智的。

一些十进制值映射到几个浮点表示。所以一个 0.6 并不总是等于另一个 0.6。

如果我们从另一个中减去一个，我们可能会得到类似 0.00000000051 的结果。

我们现在可以将相等定义为具有小于某个误差范围的差异。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-06-04T15:14:25.800

这是我写的一个简单的函数：

```
Function dblCheckTheSame(number1 As Double, number2 As Double, Optional Digits As Integer = 12) As Boolean

If (number1 - number2) ^ 2 < (10 ^ -Digits) ^ 2 Then
    dblCheckTheSame = True
Else
    dblCheckTheSame = False
End If

End Function 
```

调用它：

```
MsgBox dblCheckTheSame(1.2345, 1.23456789)
MsgBox dblCheckTheSame(1.2345, 1.23456789, 4)
MsgBox dblCheckTheSame(1.2345678900001, 1.2345678900002)
MsgBox dblCheckTheSame(1.2345678900001, 1.2345678900002, 14) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T23:18:39.170

正如已经指出的那样，许多十进制数不能精确地表示为传统的浮点类型。根据您的问题空间的性质，您最好使用 Decimal VBA 类型，它可以以完美的精度表示十进制数（以 10 为基数），直到某个小数点。这通常用于表示货币，例如通常需要 2 位小数精度的情况。

```
Dim a as Decimal
Dim b as Decimal
a = 0.15
b = 0.01 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-27T21:36:58.350

Currency 数据类型可能是一个不错的选择。它以固定的四位数精度处理相对较大的数字。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-06-06T17:53:45.610

轮班？？不确定这是否会回答所有情况，但我在比较 VBA 中的舍入双精度值时遇到了问题。当我比较舍入后看起来相同的数字时，VBA 会在 if-then 比较语句中触发 false。我的解决方法是运行两次转换，首先是双精度字符串，然后是双精度字符串，然后进行比较。

***模拟示例*** 我没有记录导致本文中提到的错误的确切数字，并且我示例中的金额当前不会触发问题，旨在代表问题的类型。

```
 Sub Test_Rounded_Numbers()

      Dim Num1 As Double

      Dim Num2 As Double

      Let Num1 = 123.123456789

      Let Num2 = 123.123467891

      Let Num1 = Round(Num1, 4) '123.1235

      Let Num2 = Round(Num2, 4) '123.1235

      If Num1 = Num2 Then

           MsgBox "Correct Match, " & Num1 & " does equal " & Num2
      Else
           MsgBox "Inccorrect Match, " & Num1 & " does not equal " & Num2
      End If

      'Here it would say that "Inccorrect Match, 123.1235 does not equal 123.1235."

 End Sub

 Sub Fixed_Double_Value_Type_Compare_Issue()

      Dim Num1 As Double

      Dim Num2 As Double

      Let Num1 = 123.123456789

      Let Num2 = 123.123467891

      Let Num1 = Round(Num1, 4) '123.1235

      Let Num2 = Round(Num2, 4) '123.1235

      'Add CDbl(CStr(Double_Value))
      'By doing this step the numbers
      'would trigger if they matched
      '100% of the time

      If CDbl(CStr(Num1)) = CDbl(CStr(Num2)) Then

           MsgBox "Correct Match"
      Else
           MsgBox "Inccorrect Match"

      End If

      'Now it says Here it would say that "Correct Match, 123.1235 does equal 123.1235."
 End Sub 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-07T18:29:23.473

迟到的答案，但我很惊讶没有发布解决方案来解决（当前）接受的[答案](https://stackoverflow.com/a/235431/6609896)中链接的文章中概述的问题，即：

*   四舍五入检查绝对容差的相等性（例如，如果四舍五入为 4d.p.，则为 0.0001 个单位），这在比较多个数量级的不同值时是垃圾（所以不仅仅是与 0 比较）
*   当前答案中没有提到与同时被比较的数字之一成比例的相对容差，但在非零比较中表现良好（但是在与零比较时会很糟糕，因为当时比例会爆炸）。

* * *

为了解决这个问题，我从 Python 中获得了灵感：*[PEP 485 -- A Function for testingapproximateequality](https://www.python.org/dev/peps/pep-0485)* to implement the following (in a standard module):

### 代码

```
'@NoIndent: Don't want to lose our description annotations
'@Folder("Tests.Utils")

Option Explicit
Option Private Module
Private Const OVERFLOW_ERR As Long = 6

'Based on Python's math.isclose https://github.com/python/cpython/blob/17f94e28882e1e2b331ace93f42e8615383dee59/Modules/mathmodule.c#L2962-L3003
'math.isclose -> boolean
'    a: double
'    b: double
'    relTol: double = 1e-09
'        maximum difference for being considered "close", relative to the
'        magnitude of the input values
'    absTol: double = 0.0
'        maximum difference for being considered "close", regardless of the
'        magnitude of the input values
'Determine whether two floating point numbers are close in value.
'Return True if a is close in value to b, and False otherwise.
'For the values to be considered close, the difference between them
'must be smaller than at least one of the tolerances.
'-inf, inf and NaN behave similarly to the IEEE 754 Standard.  That
'is, NaN is not close to anything, even itself.  inf and -inf are
'only close to themselves.
'@Description("Determine whether two floating point numbers are close in value, accounting for special values in IEEE 754")
Public Function IsClose(ByVal a As Double, ByVal b As Double, _
                        Optional ByVal relTol As Double = 0.000000001, _
                        Optional ByVal absTol As Double = 0 _
                        ) As Boolean

    If relTol < 0# Or absTol < 0# Then
        'sanity check on the inputs
        Err.Raise 5, Description:="tolerances must be non-negative"

    ElseIf a = b Then
        'short circuit exact equality -- needed to catch two infinities of
        'the same sign. And perhaps speeds things up a bit sometimes.
        IsClose = True
        Exit Function

    ElseIf IsInfinity(a) Or IsInfinity(b) Then
        'This catches the case of two infinities of opposite sign, or
        'one infinity and one finite number. Two infinities of opposite
        'sign would otherwise have an infinite relative tolerance.
        'Two infinities of the same sign are caught by the equality check
        'above.
        IsClose = False
        Exit Function

    Else
        'Now do the regular computation on finite arguments. Here an
        'infinite tolerance will always result in the function returning True,
        'since an infinite difference will be <= to the infinite tolerance.

        'NaN has already been filtered out in the equality checks earlier.
        'Need to account for possible overflow here as both the difference
        'and tolerances may be more than the range of a double and classified
        'as infinite
        Dim diff As Double
        diff = diffWithOverflow(a, b)

        If diff <= absTol Then
            IsClose = True
            Exit Function

        ElseIf diff <= absMultiplyWithOverflow(relTol, b) Then
            IsClose = True
            Exit Function

        ElseIf diff <= absMultiplyWithOverflow(relTol, a) Then
            IsClose = True
            Exit Function

        End If

    End If

End Function

'@Description("Returns |a*b| allowing for +inf in case of overflow, throws on all other errors")
Private Function absMultiplyWithOverflow(ByVal a As Double, ByVal b As Double) As Double
    On Error GoTo checkErr
    absMultiplyWithOverflow = Abs(a * b)

cleanExit:
    Exit Function

checkErr:
    If Err.Number = OVERFLOW_ERR Then Resume cleanExit
    Err.Raise Err.Number
End Function

'@Description("Returns |b-a| allowing for +inf in case of overflow, throws on all other errors")
Private Function diffWithOverflow(ByVal a As Double, ByVal b As Double) As Double
    On Error GoTo checkErr
    diffWithOverflow = Abs(b - a)

cleanExit:
    Exit Function

checkErr:
    If Err.Number = OVERFLOW_ERR Then Resume cleanExit
    Err.Raise Err.Number
End Function

'@Description "Checks if Number is IEEE754 +inf, won't raise an error"
Public Function IsInfinity(ByVal Number As Double) As Boolean
    On Error Resume Next                         'in case of NaN
    IsInfinity = Abs(Number) = PosInf
    On Error GoTo 0
End Function

'@Description("IEEE754 -inf")
Public Static Property Get NegInf() As Double
    On Error Resume Next
    NegInf = -1 / 0
    On Error GoTo 0
End Property

'@Description("IEEE754 signaling NaN (sNaN)")
Public Static Property Get NaN() As Double
    On Error Resume Next
    NaN = 0 / 0
    On Error GoTo 0
End Property

'@Description("IEEE754 +inf")
Public Static Property Get PosInf() As Double
    On Error Resume Next
    PosInf = 1 / 0
    On Error GoTo 0
End Property 
```

### 例子

该`IsClose`函数可用于检查绝对差异：

```
assert(IsClose(0, 0.0001233, absTol:= 0.001)) 'same to 3 d.p.? 
```

...或相对差异：

```
assert(IsClose(1234.5, 1234.6, relTol:= 0.0001)) '0.01% relative difference? 
```

...但通常您同时指定两者，如果满足任一公差，则数字被认为接近。它对仅接近自身的 +-infinity 和几乎没有的 NaN 具有特殊处理（请参阅 PEP 以获得完整的理由，或[我的代码审查帖子](https://codereview.stackexchange.com/q/263839/146810)，我希望对此代码提供反馈:)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2020-05-23T12:14:03.067

如果可能，请尝试使用 Single 值。转换为 Double 值会产生随机错误。

```
Public Sub Test()
Dim D01 As Double
Dim D02 As Double
Dim S01 As Single
Dim S02 As Single
S01 = 45.678 / 12
S02 = 45.678
D01 = S01
D02 = S02
Debug.Print S01 * 12
Debug.Print S02
Debug.Print D01 * 12
Debug.Print D02
End Sub

    45,678 
    45,678 
    45,67799949646 
    45,6780014038086 
```

# javascript - 是否有 Internet Explorer 认可的 selectionStart 和 selectionEnd 替代品？

> ID：235411
> 
> 赞同：19
> 
> 时间：2008-10-24T22:06:53.357
> 
> 标签：javascript, internet-explorer

找出在真实浏览器中选择的内容很简单：

```
var range = {
  start: textbox.selectionStart,
  end: textbox.selectionEnd
} 
```

但是 IE 像往常一样不理解。执行此操作的最佳跨浏览器方法是什么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2010-11-17T18:24:29.870

我将再次发布此功能，因为这个问题与另一个问题相关联。

以下将在所有浏览器中完成这项工作，并在不严重影响性能的情况下处理所有新行问题。[经过一番折腾](https://stackoverflow.com/questions/3622818/ies-document-selection-createrange-doesnt-include-leading-or-trailing-blank-lin)后，我已经达到了这个目的，现在我非常确信这是最好的此类功能。

**更新**

此函数确实假定 textarea/input 具有焦点，因此您可能需要在调用 textarea`focus()`之前调用它的方法。

```
function getInputSelection(el) {
    var start = 0, end = 0, normalizedValue, range,
        textInputRange, len, endRange;

    if (typeof el.selectionStart == "number" && typeof el.selectionEnd == "number") {
        start = el.selectionStart;
        end = el.selectionEnd;
    } else {
        range = document.selection.createRange();

        if (range && range.parentElement() == el) {
            len = el.value.length;
            normalizedValue = el.value.replace(/\r\n/g, "\n");

            // Create a working TextRange that lives only in the input
            textInputRange = el.createTextRange();
            textInputRange.moveToBookmark(range.getBookmark());

            // Check if the start and end of the selection are at the very end
            // of the input, since moveStart/moveEnd doesn't return what we want
            // in those cases
            endRange = el.createTextRange();
            endRange.collapse(false);

            if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
                start = end = len;
            } else {
                start = -textInputRange.moveStart("character", -len);
                start += normalizedValue.slice(0, start).split("\n").length - 1;

                if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
                    end = len;
                } else {
                    end = -textInputRange.moveEnd("character", -len);
                    end += normalizedValue.slice(0, end).split("\n").length - 1;
                }
            }
        }
    }

    return {
        start: start,
        end: end
    };
}

var el = document.getElementById("your_input");
el.focus();
var sel = getInputSelection(el);
alert(sel.start + ", " + sel.end); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-24T23:20:13.753

IE 的 Range 实现是一种狡猾的恐怖。它真的希望您使用可执行的 execCommand 接口，而不是任何涉及对文本进行索引的操作。

我知道有两种获取索引的方法，它们都有问题。第一个使用 range.text 作为您的示例代码。不幸的是 range.text 有去除前导和尾随换行符的习惯，这意味着如果插入符号/选择位于除第一行之外的行的开头，则 beforeLength 将关闭（换行数* 2）个字符，您'会得到错误的选定文本。

第二种方法是使用 range.moveStart/End （在重复的范围上），如该问题的答案中所述：[Internet Explorer TextRange 中的字符偏移量](https://stackoverflow.com/questions/164147/character-offset-in-an-internet-explorer-textrange)（但是，当您使用已知的 textarea 父级时，您可以忽略关于节点查找）。这没有同样的问题，但它确实报告了所有索引，就好像换行符是简单的 LF 字符一样，即使 textarea.value 和 range.text 会将它们作为 CRLF 序列返回！因此，您不能直接使用它们来索引 textarea，但您可以使用一堆换行计数来修复它们，或者在使用它之前将所有 CR 从值中替换掉。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-24T22:08:08.593

我目前的解决方案很冗长，并且基于[这个线程](http://www.webdeveloper.com/forum/showthread.php?t=111407)，但我愿意接受更好的解决方案。

```
function getSelection(inputBox) {
    if ("selectionStart" in inputBox) {
        return {
            start: inputBox.selectionStart,
            end: inputBox.selectionEnd
        }
    }

    //and now, the blinkered IE way
    var bookmark = document.selection.createRange().getBookmark()
    var selection = inputBox.createTextRange()
    selection.moveToBookmark(bookmark)

    var before = inputBox.createTextRange()
    before.collapse(true)
    before.setEndPoint("EndToStart", selection)

    var beforeLength = before.text.length
    var selLength = selection.text.length

    return {
        start: beforeLength,
        end: beforeLength + selLength
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-24T23:36:04.063

来自[BootstrapFormHelpers](https://github.com/winmarkltd/BootstrapFormHelpers/blob/0d89ab451ded3a4c6a47acb0e4bf023504a94434/js/bootstrap-formhelpers-phone.js)

```
 function getCursorPosition($element) {
    var position = 0,
        selection;

    if (document.selection) {
      // IE Support
      $element.focus();
      selection = document.selection.createRange();
      selection.moveStart ('character', -$element.value.length);
      position = selection.text.length;
    } else if ($element.selectionStart || $element.selectionStart === 0) {
      position = $element.selectionStart;
    }

    return position;
  }

  function setCursorPosition($element, position) {
    var selection;

    if (document.selection) {
      // IE Support
      $element.focus ();
      selection = document.selection.createRange();
      selection.moveStart ('character', -$element.value.length);
      selection.moveStart ('character', position);
      selection.moveEnd ('character', 0);
      selection.select ();
    } else if ($element.selectionStart || $element.selectionStart === 0) {
      $element.selectionStart = position;
      $element.selectionEnd = position;
      $element.focus ();
    }
  } 
```

# python - 如何实现串行设备使用的自定义代码页，以便可以在 Python 中将文本转换为它？

> ID：235416
> 
> 赞同：2
> 
> 时间：2008-10-24T22:07:57.050
> 
> 标签：python, encoding, utf

我有一个滚动的 LED 标志，可以从自定义代码页获取 ASCII 或（使用某些特定代码）字符的消息。

例如，欧元符号应发送为

```
<U00> 
```

并且 ä 是

```
<U64> 
```

[（您可以在文档](http://www.domoticaforum.eu/uploaded/Jfn/20082291593_RGB%20ledbar%20conrad.pdf)中找到完整的代码页）

我的问题是，实现此自定义代码页并拥有可以将 UTF 字符串转换为我的自定义代码页的编解码器的最 Pythonic 方式是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T22:13:59.410

1.  为您的编码选择一个名称，也许是“led_display”，无论如何。
2.  使用标准库实现和注册[编解码器。](http://docs.python.org/library/codecs.html)
3.  巨蟒般的利润！

# sql - 使用 T-SQL 聚合仅相邻的记录

> ID：235418
> 
> 赞同：4
> 
> 时间：2008-10-24T22:08:01.077
> 
> 标签：sql, tsql, aggregate, temporal-database

我有（为示例简化）一个包含以下数据的表

```
Row Start       Finish       ID  Amount
--- ---------   ----------   --  ------
  1 2008-10-01  2008-10-02   01      10
  2 2008-10-02  2008-10-03   02      20
  3 2008-10-03  2008-10-04   01      38
  4 2008-10-04  2008-10-05   01      23
  5 2008-10-05  2008-10-06   03      14
  6 2008-10-06  2008-10-07   02       3
  7 2008-10-07  2008-10-08   02       8
  8 2008-10-08  2008-11-08   03      19 
```

日期代表一个时间段，ID 是系统在该时间段内所处的状态，而金额是与该状态相关的值。

我想要做的是聚合具有*相同ID 号的**相邻*行的数量，但保持相同的整体顺序，以便可以组合连续的运行。因此，我想得到如下数据：

 *```
Row Start       Finish       ID  Amount
--- ---------   ----------   --  ------
  1 2008-10-01  2008-10-02   01      10
  2 2008-10-02  2008-10-03   02      20
  3 2008-10-03  2008-10-05   01      61
  4 2008-10-05  2008-10-06   03      14
  5 2008-10-06  2008-10-08   02      11
  6 2008-10-08  2008-11-08   03      19 
```

我追求可以放入 SP 的 T-SQL 解决方案，但是我看不到如何通过简单的查询来做到这一点。我怀疑它可能需要某种迭代，但我不想走那条路。

我想要进行此聚合的原因是该过程的下一步是执行按序列中出现的唯一 ID 分组的 SUM() 和 Count()，这样我的最终数据将类似于：

```
ID  Counts Total
--  ------ -----
01       2    71
02       2    31
03       2    33 
```

但是，如果我做一个简单的

```
SELECT COUNT(ID), SUM(Amount) FROM data GROUP BY ID 
```

在原来的桌子上，我得到了类似的东西

```
ID  Counts Total
--  ------ -----
01       3    71
02       3    31
03       2    33 
```

这不是我想要的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T05:31:23.223

If you read the book "Developing Time-Oriented Database Applications in SQL" by [R T Snodgrass](http://www.cs.arizona.edu/~rts/) (the pdf of which is available from his web site under publications), and get as far as Figure 6.25 on p165-166, you will find the non-trivial SQL which can be used in the current example to group the various rows with the same ID value and continuous time intervals.

*The query development below is close to correct, but there is a problem spotted right at the end, that has its source in the first SELECT statement. I've not yet tracked down why the incorrect answer is being given.* [If someone can test the SQL on their DBMS and tell me whether the first query works correctly there, it would be a great help!]

It looks something like:

```
-- Derived from Figure 6.25 from Snodgrass "Developing Time-Oriented
-- Database Applications in SQL"
CREATE TABLE Data
(
    Start   DATE,
    Finish  DATE,
    ID      CHAR(2),
    Amount  INT
);

INSERT INTO Data VALUES('2008-10-01', '2008-10-02', '01', 10);
INSERT INTO Data VALUES('2008-10-02', '2008-10-03', '02', 20);
INSERT INTO Data VALUES('2008-10-03', '2008-10-04', '01', 38);
INSERT INTO Data VALUES('2008-10-04', '2008-10-05', '01', 23);
INSERT INTO Data VALUES('2008-10-05', '2008-10-06', '03', 14);
INSERT INTO Data VALUES('2008-10-06', '2008-10-07', '02',  3);
INSERT INTO Data VALUES('2008-10-07', '2008-10-08', '02',  8);
INSERT INTO Data VALUES('2008-10-08', '2008-11-08', '03', 19);

SELECT DISTINCT F.ID, F.Start, L.Finish
    FROM Data AS F, Data AS L
    WHERE F.Start < L.Finish
      AND F.ID = L.ID
      -- There are no gaps between F.Finish and L.Start
      AND NOT EXISTS (SELECT *
                        FROM Data AS M
                        WHERE M.ID = F.ID
                        AND F.Finish < M.Start
                        AND M.Start < L.Start
                        AND NOT EXISTS (SELECT *
                                            FROM Data AS T1
                                            WHERE T1.ID = F.ID
                                              AND T1.Start <  M.Start
                                              AND M.Start  <= T1.Finish))
      -- Cannot be extended further
      AND NOT EXISTS (SELECT *
                          FROM Data AS T2
                          WHERE T2.ID = F.ID
                            AND ((T2.Start <  F.Start  AND F.Start  <= T2.Finish)
                              OR (T2.Start <= L.Finish AND L.Finish <  T2.Finish))); 
```

The output from that query is:

```
01  2008-10-01      2008-10-02
01  2008-10-03      2008-10-05
02  2008-10-02      2008-10-03
02  2008-10-06      2008-10-08
03  2008-10-05      2008-10-06
03  2008-10-05      2008-11-08
03  2008-10-08      2008-11-08 
```

**Edited**: There's a problem with the penultimate row - it should not be there. And I'm not clear (yet) where it is coming from.

Now we need to treat that complex expression as a query expression in the FROM clause of another SELECT statement, which will sum the amount values for a given ID over the entries that overlap with the maximal ranges shown above.

```
SELECT M.ID, M.Start, M.Finish, SUM(D.Amount)
    FROM Data AS D,
         (SELECT DISTINCT F.ID, F.Start, L.Finish
              FROM Data AS F, Data AS L
              WHERE F.Start < L.Finish
                AND F.ID = L.ID
                -- There are no gaps between F.Finish and L.Start
                AND NOT EXISTS (SELECT *
                                    FROM Data AS M
                                    WHERE M.ID = F.ID
                                    AND F.Finish < M.Start
                                    AND M.Start < L.Start
                                    AND NOT EXISTS (SELECT *
                                                        FROM Data AS T1
                                                        WHERE T1.ID = F.ID
                                                          AND T1.Start <  M.Start
                                                          AND M.Start  <= T1.Finish))
                  -- Cannot be extended further
                AND NOT EXISTS (SELECT *
                                    FROM Data AS T2
                                    WHERE T2.ID = F.ID
                                      AND ((T2.Start <  F.Start  AND F.Start  <= T2.Finish)
                                        OR (T2.Start <= L.Finish AND L.Finish <  T2.Finish)))) AS M
    WHERE D.ID = M.ID
      AND M.Start  <= D.Start
      AND M.Finish >= D.Finish
    GROUP BY M.ID, M.Start, M.Finish
    ORDER BY M.ID, M.Start; 
```

This gives:

```
ID  Start        Finish       Amount
01  2008-10-01   2008-10-02   10
01  2008-10-03   2008-10-05   61
02  2008-10-02   2008-10-03   20
02  2008-10-06   2008-10-08   11
03  2008-10-05   2008-10-06   14
03  2008-10-05   2008-11-08   33              -- Here be trouble!
03  2008-10-08   2008-11-08   19 
```

**Edited**: This is *almost* the correct data set on which to do the COUNT and SUM aggregation requested by the original question, so the final answer is:

```
SELECT I.ID, COUNT(*) AS Number, SUM(I.Amount) AS Amount
    FROM (SELECT M.ID, M.Start, M.Finish, SUM(D.Amount) AS Amount
            FROM Data AS D,
                 (SELECT DISTINCT F.ID, F.Start, L.Finish
                      FROM  Data AS F, Data AS L
                      WHERE F.Start < L.Finish
                        AND F.ID = L.ID
                        -- There are no gaps between F.Finish and L.Start
                        AND NOT EXISTS
                            (SELECT *
                                FROM  Data AS M
                                WHERE M.ID = F.ID
                                  AND F.Finish < M.Start
                                  AND M.Start < L.Start
                                  AND NOT EXISTS
                                      (SELECT *
                                          FROM Data AS T1
                                          WHERE T1.ID = F.ID
                                            AND T1.Start <  M.Start
                                            AND M.Start  <= T1.Finish))
                          -- Cannot be extended further
                        AND NOT EXISTS
                            (SELECT *
                                FROM  Data AS T2
                                WHERE T2.ID = F.ID
                                  AND ((T2.Start <  F.Start  AND F.Start  <= T2.Finish) OR
                                       (T2.Start <= L.Finish AND L.Finish <  T2.Finish)))
                 ) AS M
            WHERE D.ID = M.ID
              AND M.Start  <= D.Start
              AND M.Finish >= D.Finish
            GROUP BY M.ID, M.Start, M.Finish
          ) AS I
        GROUP BY I.ID
        ORDER BY I.ID;

id     number  amount
01      2      71
02      2      31
03      3      66 
```

**Review**: Oh! Drat...the entry for 3 has twice the 'amount' that it should have. Previous 'edited' parts indicate where things started to go wrong. It looks as though either the first query is subtly wrong (maybe it is intended for a different question), or the optimizer I'm working with is misbehaving. Nevertheless, there should be an answer closely related to this that will give the correct values.

For the record: tested on IBM Informix Dynamic Server 11.50 on Solaris 10\. However, should work fine on any other moderately standard-conformant SQL DBMS.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T22:11:47.510

可能需要创建一个游标并循环遍历结果，跟踪您正在使用的 id 并在此过程中累积数据。当 id 更改时，您可以将累积的数据插入临时表并在过程结束时返回表（从中选择全部）。基于表的函数可能会更好，因为您可以在执行过程中将其插入返回表中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T02:19:22.643

> 我怀疑它可能需要某种迭代，但我不想走那条路。

我认为这是您必须采用的路线，使用游标填充表变量。如果您有大量记录，您可以使用永久表来存储结果，然后当您需要检索数据时，您可以只处理新数据。

我会在源表中添加一个默认值为 0 的位字段，以跟踪哪些记录已被处理。假设没有人在表上使用 select *，添加具有默认值的列不会影响应用程序的其余部分。

如果您需要帮助编写解决方案，请在此帖子中添加评论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T16:45:35.333

好吧，我决定使用连接和游标的混合物沿着迭代路线前进。通过将数据表与自身连接起来，我可以创建一个仅包含连续记录的链接列表。

```
INSERT INTO #CONSEC
  SELECT a.ID, a.Start, b.Finish, b.Amount 
  FROM Data a JOIN Data b 
  ON (a.Finish = b.Start) AND (a.ID = b.ID) 
```

然后我可以通过使用游标对其进行迭代来展开列表，并更新回数据表以进行调整（并从数据表中删除现在无关的记录）

```
DECLARE CCursor  CURSOR FOR
  SELECT ID, Start, Finish, Amount FROM #CONSEC ORDER BY Start DESC

@Total = 0
OPEN CCursor
FETCH NEXT FROM CCursor INTO @ID, @START, @FINISH, @AMOUNT
WHILE @FETCH_STATUS = 0
BEGIN
  @Total = @Total + @Amount
  @Start_Last = @Start
  @Finish_Last = @Finish
  @ID_Last = @ID

  DELETE FROM Data WHERE Start = @Finish
  FETCH NEXT FROM CCursor INTO @ID, @START, @FINISH, @AMOUNT
  IF (@ID_Last<> @ID) OR (@Finish<>@Start_Last)
    BEGIN
      UPDATE Data
        SET Amount = Amount + @Total
        WHERE Start = @Start_Last
      @Total = 0
    END  
END

CLOSE CCursor
DEALLOCATE CCursor 
```

这一切都有效，并且对于我正在使用的典型数据具有可接受的性能。

我确实发现了上面代码的一个小问题。最初我通过游标在每个循环上更新数据表。但这没有用。似乎您只能对记录进行一次更新，并且多次更新（为了不断添加数据）恢复为读取记录的原始内容。

# c++ - 有没有一种标准的方法来使用 stl 在 linux 上使用 gcc 进行 findfirst、findnext？

> ID：235422
> 
> 赞同：10
> 
> 时间：2008-10-24T22:08:36.427
> 
> 标签：c++, linux, gcc, stl, file

我似乎无法在 gcc for Linux 上找到 _findfirst / findfirst、_findnext / findnext API，如果它包含在那里，我实际上宁愿使用标准模板库 (STL)。

有谁知道有哪些 API 可用于在 Linux for C++ (gcc) 下列出目录中的文件？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-24T22:57:07.497

它不是 C++ 风格的 API，但您找不到的 API（DOS/Windows 风格的 findfirst/findnext 的 Linux/Unix 对应）是 opendir/readdir/closedir。

使用 opendir/readdir/closedir 的主要优点是您不需要任何额外的库（它是您已经在使用的 C 库的一部分）。实际上，Boost 文件系统库使用 opendir/readdir/closedir 来获取目录中的文件列表。

参考：

*   [http://www.opengroup.org/onlinepubs/009695399/functions/opendir.html](http://www.opengroup.org/onlinepubs/009695399/functions/opendir.html)
*   [http://www.opengroup.org/onlinepubs/009695399/functions/readdir.html](http://www.opengroup.org/onlinepubs/009695399/functions/readdir.html)
*   [http://www.opengroup.org/onlinepubs/009695399/functions/closedir.html](http://www.opengroup.org/onlinepubs/009695399/functions/closedir.html)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-24T22:23:54.443

查看[Boost.Filesystem](http://www.boost.org/doc/libs/1_36_0/libs/filesystem/doc/index.htm)库。

特别是[basic_directory_iterator](http://www.boost.org/doc/libs/1_36_0/libs/filesystem/doc/reference.html#Class-template-basic_directory_iterator)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T22:27:36.543

STL 还没有列出目录中文件的功能。但它确实具有打开您已经知道的文件的功能。

除了 Boost.Filesystem，还有[STLSoft](http://stlsoft.org)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-08-16T07:10:21.397

从 C++17 开始，标准库包含[`std::filesystem`](https://en.cppreference.com/w/cpp/filesystem)其源代码在[`Boost.Filesystem`](https://www.boost.org/doc/libs/1_77_0/libs/filesystem/doc/index.htm). 现在[`std::filesystem::directory_iterator`](https://en.cppreference.com/w/cpp/filesystem/directory_iterator)是显而易见的选择，因为它独立于平台，提供比[`_findfirst`](https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/findfirst-functions)/ [`findnext`](https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/findnext-functions?view=msvc-)/ [`opendir`](https://pubs.opengroup.org/onlinepubs/009695399/functions/opendir.html)/ [`readdir`](http://www.opengroup.org/onlinepubs/009695399/functions/readdir.html)/更好的抽象[`closedir`](http://www.opengroup.org/onlinepubs/009695399/functions/closedir.html)并且不引入任何依赖项。如果您不能使用符合 C++17 的编译器，请暂时使用 Boost，稍后再切换。

# visual-studio - Visual Studio 2008 语法着色问题

> ID：235423
> 
> 赞同：1
> 
> 时间：2008-10-24T22:08:51.667
> 
> 标签：visual-studio, visual-studio-2008, syntax-highlighting

在 VB.NET 网站中，用户类型语法着色不起作用。造成这种情况的潜在原因是什么？

注意：C# 按预期工作。

更新：似乎不理解“用户类型”和“标识符”之间的区别。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T22:22:59.673

这可能不是您的问题，但您至少可以检查一下。转到工具 >> 选项...，选择文本编辑器 >> VB.NET 并验证颜色等是否符合您的喜好。

# python - Linux 上 Python 中的环境变量

> ID：235435
> 
> 赞同：14
> 
> 时间：2008-10-24T22:13:54.997
> 
> 标签：python, gdb, environment-variables

Python 对环境变量的访问并不能准确地反映操作系统对进程环境的看法。

os.getenv 和 os.environ 在特定情况下无法按预期运行。

有没有办法正确获取正在运行的进程的环境？

* * *

为了说明我的意思，请使用两个大致等效的程序（第一个在 C 中，另一个在 python 中）：

```
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
int main(int argc, char *argv[]){
    char *env;
    for(;;){
        env = getenv("SOME_VARIABLE");
        if(env)
            puts(env);
        sleep(5);
    }
} 
```

* * *

```
import os
import time
while True:
    env = os.getenv("SOME_VARIABLE")
    if env is not None:
        print env
    time.sleep(5) 
```

* * *

现在，如果我们运行 C 程序并使用 gdb 附加到正在运行的进程，并通过执行以下操作强制更改引擎盖下的环境：

```
(gdb) print setenv("SOME_VARIABLE", "my value", 1)
[Switching to Thread -1208600896 (LWP 16163)]
$1 = 0
(gdb) print (char *)getenv("SOME_VARIABLE")
$2 = 0x8293126 "my value" 
```

那么前面提到的 C 程序将开始每 5 秒喷出一次“我的价值”。但是，前面提到的 python 程序不会。

在这种情况下，有没有办法让 python 程序像 C 程序一样运行？

（是的，我意识到这是对正在运行的进程执行的非常模糊且可能具有破坏性的操作）

另外，我目前使用的是 python 2.4，这可能已在更高版本的 python 中修复。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-24T22:28:38.507

这是一个非常好的问题。

事实证明，`os`模块初始化`os.environ`为 的值，该值是在解释器启动时设置的。换句话说，标准库似乎不提供对[getenv](http://www.opengroup.org/onlinepubs/000095399/functions/getenv.html)函数的访问。[`posix`](http://docs.python.org/library/posix.html)`.environ`

在这种情况下，在 unix上使用[ctypes](http://docs.python.org/library/ctypes.html)可能是安全的。因为你会调用一个超标准的 libc 函数。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-28T03:38:23.317

你可以`ctypes`很简单地做到这一点：

```
>>> from ctypes import CDLL, c_char_p
>>> getenv = CDLL("libc.so.6").getenv
>>> getenv.restype = c_char_p
>>> getenv("HOME")
'/home/glyph' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T23:50:56.333

另一种可能性是使用 pdb 或其他一些 python 调试器，并在 python 级别而不是 C 级别更改 os.environ。 [这是](https://stackoverflow.com/questions/132058/getting-stack-trace-from-a-running-python-application#133384)我发布的一个小秘诀，用于中断正在运行的 python 进程并在接收信号时提供对 python 控制台的访问。或者，只需在要中断的代码中的某个位置粘贴一个 pdb.set_trace() 即可。在任何一种情况下，只需运行语句“ `import os; os.environ['SOME_VARIABLE']='my_value'`”，就 python 而言，您应该进行更新。

我不确定这是否也会用 setenv 更新 C 环境，所以如果你有 C 模块直接使用 getenv，你可能需要做更多的工作来保持同步。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-25T14:53:21.713

我不相信许多程序会期望对其环境进行外部修改，因此在启动时加载传递的环境的副本是等效的。您只是偶然发现了一个实现选择。

如果您在程序中看到所有的 set-at-startup 值和 putenv/setenv 工作，我认为没有什么可担心的。有更简洁的方法可以将更新的信息传递给正在运行的可执行文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T22:16:52.557

查看 Python 源代码（2.4.5）：

*   Modules/posixmodule.c 在 convertenviron() 中获取环境，该环境在启动时运行（参见 INITFUNC）并将环境存储在特定于平台的模块（nt、os2 或 posix）中

*   Lib/os.py 查看 sys.builtin_module_names，并从 posix、nt 或 os2 导入所有符号

所以是的，它是在启动时决定的。os.environ 在这里不会有帮助。

如果您真的想这样做，那么想到的最明显的方法是创建您自己的基于 C 的自定义 python 模块，并使用始终调用系统调用的 getenv。

# perl - 如何将文件加载到 Perl 哈希中？

> ID：235437
> 
> 赞同：11
> 
> 时间：2008-10-24T22:13:56.633
> 
> 标签：perl, file, hash

给定以下文件：

```
department=value1
location=valueA
location=valueB
department=value2 
```

我使用以下内容将文件加载到 Perl 哈希中：

```
use File::Slurp;
use Data::Dumper;
my %hash = map {
   s/#.*//;
   s/^\s+//;
   s/\s+$//;
   m/(.*?)\s*=\s*(.*)/;
} read_file($file);
print Dumper(\%hash); 
```

然而，结果如下：

```
$VAR1 = {
          'location' => 'valueB',
          'department' => 'value2'
        }; 
```

如何将上述文件加载到哈希中，例如，

```
$VAR1 = {
          'location' => 'valueA,valueB',
          'department' => 'value1,value2'
        }; 
```

谢谢。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-24T22:35:53.250

干得好：

```
my %hash;
while (<FILE>)
{
   chomp;
   my ($key, $val) = split /=/;
   $hash{$key} .= exists $hash{$key} ? ",$val" : $val;
} 
```

这将遍历“=”符号上的每一行拆分，并添加一个条目或附加到哈希表中的现有条目。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-26T00:21:20.237

如果您可以控制数据文件，请考虑从自定义格式切换到 YAML 之类的格式。这为您提供了开箱即用的强大功能，而无需越来越多地破解您的自定义格式。特别是，创建列表的多个键是不明显的。YAML 的做法更加清晰。

```
name:       Wally Jones
department: [foo, bar]
location:   [baz, biff] 
```

另请注意，YAML 允许您雕刻键/值对，以便它们对齐以便于阅读。

解析它的代码由一个模块完成，[YAML::XS](http://search.cpan.org/perldoc?YAML::XS)是其中最好的。

```
use File::Slurp;
use YAML::XS;
use Data::Dumper;

print Dumper Load scalar read_file(shift); 
```

数据结构如下所示：

```
$VAR1 = {
          'department' => [
                            'foo',
                            'bar'
                          ],
          'location' => [
                          'baz',
                          'biff'
                        ],
          'name' => 'Wally Jones'
        }; 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-24T22:39:36.613

您可以在 map 函数中添加一些代码来检查哈希条目是否存在并附加新值吗？

我已经有一段时间没有使用 Perl 了，但是当我过去做这样的事情时，我逐行读取文件（而 $inputLine = <FILE>）并使用 split on '=' 来加载散列附加检查以查看哈希是否已经具有该键，并附加该条目是否已存在。

# vim - Vim 80 列布局问题

> ID：235439
> 
> 赞同：425
> 
> 时间：2008-10-24T22:14:01.687
> 
> 标签：vim, coding-style

我在 Vim 中进行 80 列指示的方式似乎不正确：`set columns=80`. 有时我也是`set textwidth`，但我希望能够看到并预测`set columns`替代方案的行溢出。

这有一些**不幸**的副作用：

1.  我不能`set number`害怕在具有不同行号顺序的文件之间进行拆分；即 < 100 行文件和 >= 100 行文件将需要两个不同`set columns`的值，因为额外的列用于附加数字显示。
2.  我还开始新的 (g)Vim 会话，而不是垂直拆分窗口。这是因为每次打开或关闭窗格时都会`vsplit`强制我进行，因此开始新会话不那么麻烦。`set columns`

当你想要`set numbers`垂直分割等时，你如何处理 80 个字符的指示？

* * *

## 回答 #1

> 赞同：784
> 
> 时间：2010-09-22T00:55:01.030

从 vim 7.3 开始，您可以使用`set colorcolumn=80`(`set cc=80`简称)。

由于早期版本不支持此功能，因此我的`.vimrc`用途是：

```
if exists('+colorcolumn')
  set colorcolumn=80
else
  au BufWinEnter * let w:m2=matchadd('ErrorMsg', '\%>80v.\+', -1)
endif 
```

另请参阅[有关该`colorcolumn`选项](http://vimdoc.sourceforge.net/htmldoc/options.html#%27colorcolumn%27)的在线文档。

* * *

## 回答 #2

> 赞同：592
> 
> 时间：2008-10-25T05:51:11.577

我在我的 .vimrc 中有这个设置：

```
highlight OverLength ctermbg=red ctermfg=white guibg=#592929
match OverLength /\%81v.\+/ 
```

对于超过 80 列限制的文本，这会以微妙的红色突出显示背景（无论如何，在 GUI 模式下是微妙的 - 在终端模式下则不那么如此）。

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2009-07-13T01:01:40.967

更短的方式：

```
match ErrorMsg '\%>80v.\+' 
```

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2016-03-04T11:31:13.677

我更喜欢：

```
highlight ColorColumn ctermbg=gray
set colorcolumn=80 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2010-07-22T04:31:55.960

西蒙霍华德的回答很棒。但`/\%81v.\+/`未能突出显示超过第 81 列的选项卡。所以我做了一点调整，基于我在[VIM wiki](http://vim.wikia.com/wiki/VimTip810)上找到的东西和上面 HS 的颜色选择：

```
highlight OverLength ctermbg=darkred ctermfg=white guibg=#FFD9D9
match OverLength /\%>80v.\+/ 
```

现在 VIM 将突出显示超过第 80 列的任何内容。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2014-01-28T13:16:13.437

![在此处输入图像描述](https://i.stack.imgur.com/AGsQy.png)

极简主义，不夸张的方法。只有第 79 个字符过长的行会被突出显示。它克服了一些常见问题：在新窗口上工作，溢出的单词被正确突出显示。

```
augroup collumnLimit
  autocmd!
  autocmd BufEnter,WinEnter,FileType scala,java
        \ highlight CollumnLimit ctermbg=DarkGrey guibg=DarkGrey
  let collumnLimit = 79 " feel free to customize
  let pattern =
        \ '\%<' . (collumnLimit+1) . 'v.\%>' . collumnLimit . 'v'
  autocmd BufEnter,WinEnter,FileType scala,java
        \ let w:m1=matchadd('CollumnLimit', pattern, -1)
augroup END 
```

注意：请注意，`FileType scala,java`这将其限制为 Scala 和 Java 源文件。您可能想要自定义它。如果您省略它，它将适用于所有文件类型。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2014-11-01T01:23:36.847

标记超出指定范围的第一个字符的好方法：

```
highlight ColorColumn ctermbg=magenta "set to whatever you like
call matchadd('ColorColumn', '\%81v', 100) "set column nr 
```

来自达米安康威的[谈话](https://www.youtube.com/watch?v=aHm36-na4-4)。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2015-05-15T17:14:08.153

您也可以画线查看 80 限制：

```
let &colorcolumn=join(range(81,999),",")
let &colorcolumn="80,".join(range(400,999),",") 
```

结果：

![在此处输入图像描述](https://i.stack.imgur.com/6kqGm.png)

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-10-24T23:31:17.973

较新版本的 vim 允许一个`:set numberwidth=x`值，它设置行号显示的宽度。我并没有真正使用折叠等，所以我不知道。但是，绘制一条细垂直线超出了控制台应用程序的能力。GVim 可能允许这样做（我不使用它，所以不能在那里发表评论）。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-24T22:39:59.233

恐怕您已经对解决方案集施加了限制，好吧，这些解决方案会让您获得空集。

使用`:set textwidth=80`将解决您提到的所有问题，*除了*您无法轻易看到即将出现的行数限制。如果您`:set ruler`是 ，您将启用状态栏上的 x,y 位置显示，您可以使用它来查看您所在的列。

除此之外，我不知道该告诉你什么。仅仅因为必须这样做而丢失数字列、折叠列和拆分是一种耻辱`:set columns=80`。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-10-25T05:39:41.087

你可以试试这个：

```
au BufWinEnter * if &textwidth > 8
\ | let w:m1=matchadd('MatchParen', printf('\%%<%dv.\%%>%dv', &textwidth+1, &textwidth-8), -1)
\ | let w:m2=matchadd('ErrorMsg', printf('\%%>%dv.\+', &textwidth), -1)
\ | endif 
```

这将在每个缓冲区中设置两个突出显示，一个用于在您`&textwidth`设置的任何内容之前的 8 列中的字符，另一个用于该列之外的字符。这样你就有了一定程度的期待。当然，如果您想要或多或少的预期，您可以调整它以使用不同的宽度（您以失去这些列中的语法突出显示的形式付出代价）。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2010-09-28T03:56:40.013

好吧，看看 :help 列，它并没有真正被弄乱。

在控制台中，通常由控制台设置决定（即自动检测）；在 GUI 中，它确定（并由其确定）gvim 窗口的宽度。

所以通常你只是让控制台和窗口管理器通过注释掉来完成他们的工作`set columns`

我不确定“看到并预期行溢出”是什么意思。如果您希望 EOL 大致插入第 80 列，请使用`set textwidth`或`set wrapmargin`; 如果您只想软换行（即换行，但没有实际的 EOL），请使用`set linebreak`and `set showbreak`。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-12-29T13:21:05.063

这个不在左侧字段中，但它是一个很好的小地图，如果您有行号，则可以将当前拆分的大小调整为 80 个字符：

```
" make window 80 + some for numbers wide  
noremap <Leader>w :let @w=float2nr(log10(line("$")))+82\|:vertical resize <c-r>w<cr> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-12-13T17:38:26.233

您可以尝试将窗口大小设置为允许 80 个字符的实际文本。不过，这仍然不适用于垂直拆分。

`let &co=80 + &foldcolumn + (&number || &relativenumber ? &numberwidth : 0)`

这需要 vim 7+，relativenumber 为 7.3。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-12-21T08:56:27.547

使用 set colorcolumn 设置列线

```
set autoindent                                                                  
set smartindent                                                                 
set nowrap                                                                      
set hlsearch                                                                    
set tabstop=4                                                                   
set shiftwidth=4                                                                
syntax on                                                                       
set colorcolumn=80 
```

# c# - 使用递归从 IDictionary 中删除项目

> ID：235446
> 
> 赞同：3
> 
> 时间：2008-10-24T22:16:29.857
> 
> 标签：c#, recursion, idictionary

有人有更巧妙的方法来做到这一点吗？似乎它应该比这更容易，但我有一个心理障碍。基本上我需要从字典中删除项目并递归到也是字典的项目的值。

```
private void RemoveNotPermittedItems(ActionDictionary menu)
{
    var keysToRemove = new List<string>();
    foreach (var item in menu)
    {
        if (!GetIsPermitted(item.Value.Call))
        {
            keysToRemove.Add(item.Key);
        }
        else if (item.Value is ActionDictionary)
        {
            RemoveNotPermittedItems((ActionDictionary)item.Value);
            if (((ActionDictionary)item.Value).Count == 0)
            {
                keysToRemove.Add(item.Key);
            }
        }
    }
    foreach (var key in (from item in menu where keysToRemove.Contains(item.Key) select item.Key).ToArray())
    {
        menu.Remove(key);
    }
} 
```

动作字典是这样的：

```
public class ActionDictionary : Dictionary<string, IActionItem>, IActionItem 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T06:17:26.563

如果您反向迭代字典（从“menu.Count - 1”到零），您实际上不需要收集键并再次迭代它们。当然，如果您开始删除事物，则按正序迭代会产生变异的集合异常。

我不知道 ActionDictionary 是什么，所以我无法测试您的确切场景，但这里有一个使用 just 的示例`Dictionary<string,object>`。

```
 static int counter = 0;
    private static void RemoveNotPermittedItems(Dictionary<string, object> menu)
    {
        for (int c = menu.Count - 1; c >= 0; c--)
        {
            var key = menu.Keys.ElementAt(c);
            var value = menu[key];
            if (value is Dictionary<string, object>)
            {
                RemoveNotPermittedItems((Dictionary<string, object>)value);
                if (((Dictionary<string, object>)value).Count == 0)
                {
                    menu.Remove(key);
                }
            }
            else if (!GetIsPermitted(value))
            {
                menu.Remove(key);
            }
        }
    }

    // This just added to actually cause some elements to be removed...
    private static bool GetIsPermitted(object value)
    {
        if (counter++ % 2 == 0)
            return false;
        return true;
    } 
```

我还颠倒了“if”语句，但这只是假设您希望在调用方法以对项目的值采取行动之前进行类型检查......假设“GetIsPermitted”总是返回TRUE动作字典。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T22:24:23.070

首先，您的`foreach`循环比它需要的要复杂得多。做就是了：

```
foreach (var key in keysToRemove)
{
    menu.Remove(key);
} 
```

我有点惊讶`Dictionary`没有`RemoveAll`方法，但看起来不像......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T04:44:43.693

虽然 foreach 和 GetEnumerator 失败，但 for 循环有效，

 `````
var table = new Dictionary<string, int>() {{"first", 1}, {"second", 2}};
for (int i = 0; i < table.Keys.Count; i++)//string key in table.Keys)
{
    string key = table.Keys.ElementAt(i);
    if (key.StartsWith("f"))
    {
        table.Remove(key);
    }
} 
````  `但 ElementAt() 是一个 .NET 3.5 功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T01:43:58.253

选项 1：字典仍然是一个集合。遍历 menu.Values。

您可以迭代 menu.Values 并在迭代时将其删除。这些值不会以任何排序顺序出现（这对您的情况应该没问题）。您可能需要使用 for 循环并调整索引而不是使用 foreach - 如果您在迭代时修改集合，枚举器将引发异常。

（当我在我的开发机器上时，我会尝试添加代码）

选项 2：创建自定义迭代器。

Winforms 中从 ListBox SelectedItems 返回的某些集合实际上并不包含该集合，它们提供了一个围绕基础集合的包装器。有点像 WPF 中的 CollectionViewSource。ReadOnlyCollection 也做了类似的事情。

创建一个可以将嵌套字典“扁平化”为可以枚举它们的类，就像它们是单个集合一样。实现一个删除函数，看起来像是从集合中删除一个项目，但实际上是从当前字典中删除。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-12T17:45:36.180

在 My Opinion 中，您可以定义自己的泛型类，该类派生自`KeyValuePair<...>`TKey 和 TValue 将是`List<T>`，并且您可以在派生类的新方法或方法中使用 the`RemoveAll`或`RemoveRange`of来删除所需的项目。`List<T>``RemoveRange()``RemoveAll()`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-16T16:53:58.533

我知道您可能已经找到了很好的解决方案，但如果您可以将您的方法签名修改为（我知道这可能不适合您的场景），那么只是出于“光滑”的原因：

```
private ActionDictionary RemoveNotPermittedItems(ActionDictionary menu)
{
 return new ActionDictionary(from item in menu where GetIsPermitted(item.Value.Call) select item)
.ToDictionary(d=>d.Key, d=>d.Value is ActionDictionary?RemoveNotPermittedItems(d.Value as ActionDictionary) : d.Value));
} 
```

我可以看到几种方法，您可以在不修改和具体化新词典的情况下使用带有过滤项目的词典。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-05-17T15:41:57.687

它并没有那么复杂，但是一些惯用的变化使它更短更容易看：

```
 private static void RemoveNotPermittedItems(IDictionary<string, IActionItem> menu)
    {
        var keysToRemove = new List<string>();

        foreach (var item in menu)
        {
            if (GetIsPermitted(item.Value.Call))
            {
                var value = item.Value as ActionDictionary;

                if (value != null)
                {
                    RemoveNotPermittedItems(value);
                    if (!value.Any())
                    {
                        keysToRemove.Add(item.Key);
                    }
                }
            }
            else
            {
                keysToRemove.Add(item.Key);
            }
        }

        foreach (var key in keysToRemove)
        {
            menu.Remove(key);
        }
    }

    private static bool GetIsPermitted(object call)
    {
        return ...;
    } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-05-17T17:22:37.557

更改`keysToRemove`to的类型，`HashSet<string>`您将获得 O(1)`Contains`方法。使用`List<string>`它是 O(n)，您可能会猜到它会更慢。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-05-18T03:06:06.170

未经测试，直到我明天在我的 VS 机器上：o

```
private void RemoveNotPermittedItems(ActionDictionary menu)
{
    foreach(var _checked in (from m in menu
                             select new
                             {
                                 gip = !GetIsPermitted(m.Value.Call),
                                 recur = m.Value is ActionDictionary,
                                 item = m
                             }).ToArray())
    {
        ActionDictionary tmp = _checked.item.Value as ActionDictionary;
        if (_checked.recur)
        {
            RemoveNotPermittedItems(tmp);
        }
        if (_checked.gip || (tmp != null && tmp.Count == 0) {
            menu.Remove(_checked.item.Key);
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-05-18T10:15:34.667

我认为

```
public class ActionSet : HashSet<IActionItem>, IActionItem 
```

和

```
bool Clean(ActionSet nodes)
    {
        if (nodes != null)
        {
            var removed = nodes.Where(n => this.IsNullOrNotPermitted(n) || !this.IsNotSetOrNotEmpty(n) || !this.Clean(n as ActionSet));

            removed.ToList().ForEach(n => nodes.Remove(n));

            return nodes.Any();
        }

        return true;
    }

    bool IsNullOrNotPermitted(IActionItem node)
    {
        return node == null || *YourTest*(node.Call);
    }

    bool IsNotSetOrNotEmpty(IActionItem node)
    {
        var hset = node as ActionSet;
        return hset == null || hset.Any();
    } 
```

应该快速工作

# c# - C#如何将数据网格中的列按字母顺序排序？

> ID：235450
> 
> 赞同：5
> 
> 时间：2008-10-24T22:16:59.840
> 
> 标签：c#, winforms, datagrid

如何按字母顺序对 winforms datagrid 控件中的列进行排序？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T22:34:35.017

您是否尝试过将 DataGrid 绑定到 DataTable 对象（而不是视图）并将 DataGrid 上的“AllowSorting”属性设置为 true？我相信网格会自动为您对表格源进行排序。

如果没有，您始终可以在单击列标题时捕获该事件并重建 DataView 以绑定到 DataGrid。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-28T15:44:41.967

我的项目通常是内存中项目的列表。使用数据绑定网格，您必须在源中对数据进行排序，而不是在网格本身内。

这是我的列表排序的代码。也许这会给你一个起步的想法。

[http://jspot.jerryhanel.com/2012/06/28/sort-your-databound-grid-effortless/](http://jspot.jerryhanel.com/2012/06/28/sort-your-databound-grid-effortlessly/)

# c# - 访问修改后的闭包

> ID：235455
> 
> 赞同：323
> 
> 时间：2008-10-24T22:18:25.097
> 
> 标签：c#, resharper, closures

```
string [] files = new string[2];
files[0] = "ThinkFarAhead.Example.Settings.Configuration_Local.xml";
files[1] = "ThinkFarAhead.Example.Settings.Configuration_Global.xml";

//Resharper complains this is an "access to modified closure"
for (int i = 0; i < files.Length; i++ )
{
    // Resharper disable AccessToModifiedClosure
    if(Array.Exists(Assembly.GetExecutingAssembly().GetManifestResourceNames(),
    delegate(string name) { return name.Equals(files[i]); }))
         return Assembly.GetExecutingAssembly().GetManifestResourceStream(files[i]);
    // ReSharper restore AccessToModifiedClosure
} 
```

尽管 ReSharper 抱怨说这是“访问修改后的闭包”，但上述内容似乎工作正常。任何人都可以阐明这一点吗？

（这个话题[在这里](https://stackoverflow.com/questions/304258)继续）

* * *

## 回答 #1

> 赞同：319
> 
> 时间：2008-10-24T22:20:44.997

在这种情况下，没关系，因为您实际上是*在*循环中执行委托。

但是，如果您要保存委托并稍后使用它，您会发现所有委托在尝试访问 files[i] 时都会抛出异常 - 它们捕获的是*变量* `i`而不是委托时的值创建。

简而言之，这是一个需要注意的*潜在*陷阱，但在这种情况下，它不会伤害你。

有关结果违反直觉的更复杂示例，请参见[本页底部。](http://jonskeet.uk/csharp/csharp2/delegates.html#captured.variables)

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2013-03-29T17:31:15.950

我知道这是一个老问题，但我最近一直在研究闭包，并认为代码示例可能有用。在幕后，编译器正在为您的函数调用生成一个表示词法闭包的类。它可能看起来像：

```
private sealed class Closure
{
    public string[] files;
    public int i;

    public bool YourAnonymousMethod(string name)
    {
        return name.Equals(this.files[this.i]);
    }
} 
```

如上所述，您的函数有效，因为谓词在创建后立即被调用。编译器将生成如下内容：

```
private string Works()
{
    var closure = new Closure();

    closure.files = new string[3];
    closure.files[0] = "notfoo";
    closure.files[1] = "bar";
    closure.files[2] = "notbaz";

    var arrayToSearch = new string[] { "foo", "bar", "baz" };

    //this works, because the predicates are being executed during the loop
    for (closure.i = 0; closure.i < closure.files.Length; closure.i++)
    {
        if (Array.Exists(arrayToSearch, closure.YourAnonymousMethod))
            return closure.files[closure.i];
    }

    return null;
} 
```

另一方面，如果您要存储然后调用谓词，您会看到对谓词的每次调用实际上都会在闭包类的同一实例上调用相同的方法，因此将使用相同的值一世。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-08-13T23:17:05.017

“文件”是一个**捕获的外部变量**，因为它已被匿名委托函数捕获。它的生命周期由匿名委托函数延长。

> 捕获的外部变量 当一个外部变量被匿名函数引用时，就称该外部变量已被匿名函数捕获。通常，局部变量的生命周期仅限于执行与其关联的块或语句（局部变量）。但是，捕获的外部变量的生命周期至少会延长，直到从匿名函数创建的委托或表达式树符合垃圾回收的条件。

[MSDN 上的外部变量](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/expressions#outer-variables)

> 当局部变量或值参数被匿名函数捕获时，局部变量或参数不再被认为是固定变量（Fixed and moveable variables），而是被认为是可移动变量。因此，任何获取捕获的外部变量地址的不安全代码都必须首先使用 fixed 语句来修复变量。请注意，与未捕获的变量不同，捕获的局部变量可以同时暴露给多个执行线程。

# google-app-engine - 如何在 GAE 中有效地实现会话？

> ID：235470
> 
> 赞同：12
> 
> 时间：2008-10-24T22:25:23.240
> 
> 标签：google-app-engine, session, memcached

我想知道如何为我正在工作的 GAE 应用程序实施我自己的会话（更多是为了练习）......起初我正在考虑使用数据存储来存储会话数据。但是，每次需要将某些内容添加到会话“存储桶”中时，都需要将其保存到数据存储中。显然这很糟糕，因为我们想最小化我们的写入。然后我考虑使用 memcache ... 似乎是个好主意，但由于 memcache 被谷歌“通过内存压力驱逐”，我们面临着可能的会话损坏问题。这是否意味着我们只剩下以下选项：

1.  将所有会话数据存储在 cookie 中
2.  将所有会话数据写入 datastore 和 memcache，然后只从 memcache 中读取

有人有其他想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-03-21T06:12:56.407

**更新 - 2011 年 3 月 21 日**

在给出这个答案时，**app-engine-patch 已停产**，并且**gaeutilities** [提供的功能](https://github.com/dound/gae-sessions/wiki/comparison-with-alternative-libraries)比**gae-sessions**最差。

*   GitHub [gae 会话](https://github.com/dound/gae-sessions)
*   HowTo [10 步教程](http://blog.stannard.net.au/2011/01/09/how-to-use-sessions-on-google-app-engine-with-python-and-gae-sessions/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T23:11:53.660

我建议在推出您自己的之前检查（并参与）这三个 appengine 会话的实现：

*   [应用引擎补丁](http://code.google.com/p/app-engine-patch/)
*   [实用工具](http://gaeutilities.appspot.com/)
*   [会议](https://github.com/dound/gae-sessions)

您的选项看起来不错，但在它们之间进行选择可能取决于应用程序中会话数据的大小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T18:12:03.063

如果您使用 web2py（版本 1.46 或更高版本）会话在 GAE 上默认打开。这是通过脚手架模型顶部的以下三行 web2py 代码实现的：

```
from gluon.contrib.gql import *
db=GQLDB()
session.connect(request,response,db=db) 
```

这是一个重要的示例操作：

```
def index():
    session.c=session.c+1 if session.c else 1
    return dict(counter=session.c) 
```

# gcc - 使用 GCC for AmigaOS 重新编译应用程序的常见问题解答？

> ID：235480
> 
> 赞同：2
> 
> 时间：2008-10-24T22:31:07.987
> 
> 标签：gcc

我正在尝试重新编译一些开源应用程序以在 amigaOS 下工作。有人可以向我指出一个很好的分步指南，解释在编译之前我需要对源代码进行哪些更改（从经验法则的角度来看）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T18:57:58.850

这是一个很好的[起点](http://www.monkeyhouse.eclipse.co.uk/amiga/dev.htm)。 [这](http://amiga.sourceforge.net/amigadevhelp/)看起来也是一个很好的资源。

您希望移植什么样的软件？

# .net - MCML 入门资源？

> ID：235484
> 
> 赞同：3
> 
> 时间：2008-10-24T22:32:48.110
> 
> 标签：.net, media, center, vmc, mcml

谁能推荐一些对学习 MCML 有用的参考资料或其他资源？

我有一个使用 C# 和 .Net 3.5 进行了一段时间的小型宠物项目。我已经到了希望能够将输出从它发送到 Windows Media Center 的地步，但是我一直很难找到关于如何创建 MCML 元素来表示我的 C# 数据对象的连贯解释。特别是我很难找到有关为 C# 集合中的每个元素创建 MCML 元素的信息。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T19:07:50.197

[Windows Media Center Sandbox](http://blog.mediacentersandbox.com/)可能是最好的资源。但我想你已经知道了。[媒体中心开发博客](http://mediacenterdev.blogspot.com/)也很不错。[这篇文章](http://mediacenterdev.blogspot.com/2007/02/thinking-and-transferring-data-in-mcml.html)能让你入门吗？

我自己虽然很n00b..

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T10:39:48.347

除了跟上[沙盒](http://discuss.mediacentersandbox.com/)。我会推荐以下。

1.  看看[Media Center SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=A43EA0B7-B85F-4612-AA08-3BF128C5873E&displaylang=en)，Z 应用程序和 MCML 采样器是一个好的开始。
2.  查看一些开源 MCML 应用程序，如[VideoBrowser](http://code.google.com/p/videobrowser/)、[OML](http://code.google.com/p/open-media-library/)、[MusicBrowser](http://code.google.com/p/music-browser/)或[Vmc Netflix](http://code.google.com/p/vmcnetflix/)，阅读源代码，尝试了解它们是如何工作的。

理想情况下，我建议在学习 MCML 时尝试加入现有的项目，因为 MCML 真的很难让你理解并且学习曲线非常陡峭。忘记表达式混合，在 MCML 中进行开发时，您在 Visual Studio 中推送 XML 文件并处理复杂、不完整和有缺陷的框架。

对于您的问题，您确实需要了解数据绑定，开源项目和示例应用程序都有关于如何完成此操作的示例。

# ocaml - 我的 SHA256 的 OCaml 实现是否健全？

> ID：235493
> 
> 赞同：0
> 
> 时间：2008-10-24T22:36:57.443
> 
> 标签：ocaml, digest, sha256, sha

我是一名新手 OCaml 程序员，并认为我会尝试实现一个非常棘手的算法，从而使自己陷入困境。我愿意接受所有大大小小的批评，无论是风格、安全还是性能相关。

我已经知道的一个批评是该算法要求整个消息都适合内存（而 SHA256 的参考实现可以一次处理一个块）。

我特别担心是否有任何递归函数不是尾递归的。

我已经测试了代码，它确实在 x86_64 Linux 上生成了正确的消息摘要。

提前感谢您的考虑。

# 编辑：

如果没有任何事情发生在你身上，请不要在这里花太多时间。我正在寻找明显破坏的行为，而不是重写。

```
let as_bytes bits =
  match (bits mod 8) with
    | 0 -> (bits / 8)
    | _ -> failwith "as_bytes: bits must be multiple of 8"
let as_bits bytes = bytes * 8
let k = [|
    0x428a2f98l; 0x71374491l; 0xb5c0fbcfl; 0xe9b5dba5l;
    0x3956c25bl; 0x59f111f1l; 0x923f82a4l; 0xab1c5ed5l;
    0xd807aa98l; 0x12835b01l; 0x243185bel; 0x550c7dc3l;
    0x72be5d74l; 0x80deb1fel; 0x9bdc06a7l; 0xc19bf174l;
    0xe49b69c1l; 0xefbe4786l; 0x0fc19dc6l; 0x240ca1ccl;
    0x2de92c6fl; 0x4a7484aal; 0x5cb0a9dcl; 0x76f988dal;
    0x983e5152l; 0xa831c66dl; 0xb00327c8l; 0xbf597fc7l;
    0xc6e00bf3l; 0xd5a79147l; 0x06ca6351l; 0x14292967l;
    0x27b70a85l; 0x2e1b2138l; 0x4d2c6dfcl; 0x53380d13l;
    0x650a7354l; 0x766a0abbl; 0x81c2c92el; 0x92722c85l;
    0xa2bfe8a1l; 0xa81a664bl; 0xc24b8b70l; 0xc76c51a3l;
    0xd192e819l; 0xd6990624l; 0xf40e3585l; 0x106aa070l;
    0x19a4c116l; 0x1e376c08l; 0x2748774cl; 0x34b0bcb5l;
    0x391c0cb3l; 0x4ed8aa4al; 0x5b9cca4fl; 0x682e6ff3l;
    0x748f82eel; 0x78a5636fl; 0x84c87814l; 0x8cc70208l;
    0x90befffal; 0xa4506cebl; 0xbef9a3f7l; 0xc67178f2l
  |]
  let hash s =
    let add_int32 x y = Int32.add x y in

    let left_int32 x n = Int32.shift_left x n in
    let right_int32 x n = Int32.shift_right_logical x n in
    let or_int32 x y = Int32.logor x y in
    let xor_int32 x y = Int32.logxor x y in
    let and_int32 x y = Int32.logand x y in
    let not_int32 x = Int32.lognot x in

    let rotate x n = (or_int32 (right_int32 x n) (left_int32 x (32 - n))) in
    let shift x n = right_int32 x n in
    let ch x y z = xor_int32 (and_int32 x y) (and_int32 (not_int32 x) z) in
    let maj x y z = (xor_int32 (and_int32 x y) (xor_int32 (and_int32 x z) (and_int32 y z))) in
    let sum0 x = (xor_int32 (rotate x  2) (xor_int32 (rotate x 13) (rotate x 22))) in
    let sum1 x = (xor_int32 (rotate x  6) (xor_int32 (rotate x 11) (rotate x 25))) in
    let rh00 x = (xor_int32 (rotate x  7) (xor_int32 (rotate x 18) (shift  x  3))) in
    let rh01 x = (xor_int32 (rotate x 17) (xor_int32 (rotate x 19) (shift  x 10))) in

    let as_bytes bits =
      match (bits mod 8) with
        | 0 -> (bits / 8)
        | _ -> failwith "as_bytes: bits must be multiple of 8"
    in
    let as_bits bytes = bytes * 8 in
    let sha = [|
      0x6a09e667l;
      0xbb67ae85l;
      0x3c6ef372l;
      0xa54ff53al;
      0x510e527fl;
      0x9b05688cl;
      0x1f83d9abl;
      0x5be0cd19l
    |]
    in
    let message = Buffer.create (as_bytes 512) in (* smallest possible buffer is at least 512 bits *)
      begin
        Buffer.add_string message s;
        let original_length = as_bits (Buffer.length message) in 
        Buffer.add_char message '\x80'; (* append '1' bit *)
          let pad_start = as_bits (Buffer.length message) in
          let pad_blocks = if (original_length mod 512) < 448 then 1 else 2 in
          let message_length = ((original_length / 512) + pad_blocks) * 512 in
            begin (* appending k bits of 0 (where message_length-64 is our k) *)
              for i = as_bytes pad_start to (as_bytes (message_length - (as_bytes  64)))-8 do
                Buffer.add_char message '\x00'
              done;
              Buffer.add_buffer message (Bin.pack64 (Int64.of_int original_length))
            end
      end;
      let rec process_block i blocks =
        let array_of_block i = 
          let boff = i*(as_bytes 512) in
          let to_int32 x = (Int32.of_int (int_of_char x)) in
          let w = Array.make (as_bytes 512) 0l in
            begin
              for t = 0 to 15 do
                w.(t) <- (or_int32 (left_int32 (to_int32 (Buffer.nth message (boff + (t*4  )))) 24)
                         (or_int32 (left_int32 (to_int32 (Buffer.nth message (boff + (t*4+1)))) 16)
                         (or_int32 (left_int32 (to_int32 (Buffer.nth message (boff + (t*4+2))))  8)
                                               (to_int32 (Buffer.nth message (boff + (t*4+3))))   )));
              done;
              for t = 16 to 63 do
                w.(t) <- add_int32 (add_int32 (rh01 w.(t-2)) w.(t-7)) (add_int32 (rh00 w.(t-15)) w.(t-16))
              done;
              w
            end
        in
          if i = blocks then 
            let sha256 = Buffer.create (as_bytes 256) in
            let rec pack_sha256 i =
              match i with
                | 8 -> Buffer.contents sha256
                | _ ->
                    begin
                      Buffer.add_buffer sha256 (Bin.pack32 sha.(i));
                      pack_sha256 (i+1)
                    end
            in pack_sha256 0
          else
            begin
              let w = array_of_block i in
              let tem = [| 0l; 0l |] in
                begin
                  let a = ref sha.(0) in 
                  let b = ref sha.(1) in
                  let c = ref sha.(2) in
                  let d = ref sha.(3) in 
                  let e = ref sha.(4) in
                  let f = ref sha.(5) in
                  let g = ref sha.(6) in
                  let h = ref sha.(7) in
                    for t = 0 to 63 do
                      begin
                        tem.(0) <- add_int32 (add_int32 !h (sum1 !e)) (add_int32 (ch !e !f !g) (add_int32 k.(t) w.(t)));
                        tem.(1) <- add_int32 (sum0 !a) (maj !a !b !c);
                        h := !g;
                        g := !f;
                        f := !e;
                        e := add_int32 !d tem.(0);
                        d := !c;
                        c := !b;
                        b := !a;
                        a := add_int32 tem.(0) tem.(1);
                       end
                    done;
                    sha.(0) <- add_int32 sha.(0) !a;
                    sha.(1) <- add_int32 sha.(1) !b;
                    sha.(2) <- add_int32 sha.(2) !c;
                    sha.(3) <- add_int32 sha.(3) !d;
                    sha.(4) <- add_int32 sha.(4) !e;
                    sha.(5) <- add_int32 sha.(5) !f;
                    sha.(6) <- add_int32 sha.(6) !g;
                    sha.(7) <- add_int32 sha.(7) !h;

                    (* good faith attempt to clear memory *)
                    for i = 0 to 63 do w.(t) <- 0 done;
                    tem.(0) <- 0; tem.(1) <- 0;
                    a := 0; b := 0; c := 0; d := 0; e := 0; f := 0; g := 0; h := 0;
                end;
            process_block (i+1) blocks
          end
  in process_block 0 ((Buffer.length message) / (as_bytes 512))

  let hexdigits s =
    let rec hexdigits_inner hx i =
      match i with
        | 32 -> hx
        | _ -> hexdigits_inner (hx ^ (Printf.sprintf "%02x" (int_of_char s.[i]))) (i+1)
    in
      hexdigits_inner "" 0 
```

因此，在单独的文件中定义的包函数是：

```
let pack64 x = 
  let b = Buffer.create 8 in 
    for i = 0 to 7 do
      let shft = (7-i)*8 in
        Buffer.add_char b (char_of_int (Int64.to_int (Int64.logand (Int64.shift_right x shft) 0xFFL)));
    done;
    b

let pack x n = 
  if (n mod 8) = 0 then
    let n' = n/8 in
    let b = Buffer.create n' in 
      for i = 0 to n'-1 do
        let shft = ((n'-1)-i)*8 in
          Buffer.add_char b (char_of_int (Int32.to_int (Int32.logand (Int32.shift_right x shft) 0xFFl)));
      done;
      b
  else
    raise (Invalid_argument ("pack: " ^ (string_of_int n) ^ " is not a multiple of 8"))

let pack32 x = pack x 32
let pack16 x = pack x 16
let pack8 x = pack x 8 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T23:47:09.130

您应该做的第一件事是从标准中获取测试向量并验证您的实现是否生成完全相同的结果。如果没有，它就坏了。

如果您有一个“已知的健全”实现（openssl 命令可能有一个），您还可以生成其他测试向量。

最后，使用逐渐变大的文件运行一些性能测试，并与已知的快速实现进行比较（openssl 应该相当快）。如果它失败（耗尽所有内存或太慢），您必须对其进行修复。

如果它通过了所有这些测试，它应该足够好。散列算法不应该有很多安全问题（除非您正在散列敏感数据，否则您必须非常小心地覆盖您使用的所有内存）。

# delphi - 如何创建带有下拉菜单的按钮？

> ID：235498
> 
> 赞同：6
> 
> 时间：2008-10-24T22:37:59.363
> 
> 标签：delphi, button, popupmenu

有没有办法显示 IE/Firefox 后退按钮样式、下拉菜单按钮？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-25T00:00:56.463

我假设您的意思是单击时会下拉菜单的按钮。

您也可以手动编码您的按钮单击以在其下下拉一个 TPopupMenu。

**示例**：在表单上放置带有 TClickEvent（可能是 TButton）和 TPopupMenu 的任何内容。添加一些菜单项。然后添加以下 OnClick 事件处理程序：

```
procedure TForm86.Button1Click(Sender: TObject);
var
  button: TControl;
  lowerLeft: TPoint;
begin
  if Sender is TControl then
  begin
    button := TControl(Sender);
    lowerLeft := Point(button.Left, button.Top + Button.Height);
    lowerLeft := ClientToScreen(lowerLeft);
    PopupMenu1.Popup(lowerLeft.X, lowerLeft.Y);
  end;
end; 
```

还有中提琴！就像魔术一样。如果您打算重用它，您可以将它全部包装在一个组件中。 *甚至可能在网上出售。*

**注意：**如果您想要延迟，则在另一个方法中提取该代码，然后设置一个计时器 OnClick 并打开 OnMouseLeave 的计时器。然后，如果计时器触发，您可以调用提取的方法。不知道你会如何在键盘点击时做到这一点。我不知道 Firefox 等是否也支持。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-24T23:29:25.310

当然。在页面上放置一个工具栏。右键单击工具栏，添加一个按钮。将按钮的样式设置为 tbsDropDown。在页面上放置一个 PopupMenu。双击 PopupMenu 以定义菜单项。然后，返回到您创建的按钮并将其 DropdownMenu 属性设置为指向您刚刚创建的 PopupMenu。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-07-28T23:54:14.430

吉姆的回答很好，但一开始对我不太有效。ClientToScreen 使用 Form86 的方法，只有当按钮直接在窗体上时才正确。它应该是被调用的按钮的 ClientToScreen 方法，如下所示：

```
procedure TForm86.Button1Click(Sender: TObject);
var
  button: TControl;
  lowerLeft: TPoint;
begin
  if Sender is TControl then
  begin
    button := TControl(Sender);
    lowerLeft := Point(0, button.Height);
    lowerLeft := button.ClientToScreen(lowerLeft);
    PopupMenu1.Popup(lowerLeft.X, lowerLeft.Y);
  end;
end; 
```

无论按钮在哪里，这都有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T23:35:32.490

如果您不想使用工具栏，raize (www.raize.com) 和 express 编辑器 (www.DevExpress.com) 库具有可以执行此操作的组件。

# php - 使用 PHP 验证 Crontab 条目

> ID：235504
> 
> 赞同：13
> 
> 时间：2008-10-24T22:40:21.230
> 
> 标签：php, regex, validation, cron, crontab

使用 PHP 验证 crontab 条目的最佳方法是什么？我应该使用正则表达式还是外部库？我有一个 PHP 脚本，可以从 crontab 文件中添加/删除条目，但希望有某种方法来验证时间间隔部分是否采用有效格式。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-04-09T20:07:06.917

谁说正则表达式不能做到这一点？

感谢我的雇主[Salir.com](http://www.salir.com)，这是一个 PHPUnit 测试，它可以进行此类验证。随意修改和分发。如果您保留@author 通知和网站链接，我将不胜感激。

```
<?php
/**
 * @author Jordi Salvat i Alabart - with thanks to <a href="www.salir.com">Salir.com</a>.
 */

abstract class CrontabChecker extends PHPUnit_Framework_TestCase {
    protected function assertFileIsValidUserCrontab($file) {
        $f= @fopen($file, 'r', 1);
        $this->assertTrue($f !== false, 'Crontab file must exist');
        while (($line= fgets($f)) !== false) {
            $this->assertLineIsValid($line);
        }
    }

    protected function assertLineIsValid($line) {
        $regexp= $this->buildRegexp();
        $this->assertTrue(preg_match("/$regexp/", $line) !== 0);
    }

    private function buildRegexp() {
        $numbers= array(
            'min'=>'[0-5]?\d',
            'hour'=>'[01]?\d|2[0-3]',
            'day'=>'0?[1-9]|[12]\d|3[01]',
            'month'=>'[1-9]|1[012]',
            'dow'=>'[0-7]'
        );

        foreach($numbers as $field=>$number) {
            $range= "($number)(-($number)(\/\d+)?)?";
            $field_re[$field]= "\*(\/\d+)?|$range(,$range)*";
        }

        $field_re['month'].='|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec';
        $field_re['dow'].='|mon|tue|wed|thu|fri|sat|sun';

        $fields_re= '('.join(')\s+(', $field_re).')';

        $replacements= '@reboot|@yearly|@annually|@monthly|@weekly|@daily|@midnight|@hourly';

        return '^\s*('.
                '$'.
                '|#'.
                '|\w+\s*='.
                "|$fields_re\s+\S".
                "|($replacements)\s+\S".
            ')';
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-24T23:12:57.233

嗯，有趣的问题。

如果您要真正验证它，正则表达式是不够的，您必须实际解析条目并验证每个调度位。这是因为每个位都可以是数字、星期几字符串、范围 (2-7)、一组 (3、4、星期六)、Vixie cron 式快捷方式 (60/5) 或任何组合以上——任何单一的正则表达式方法都会变得非常麻烦、快速。

仅仅使用`crontab`Vixie cron 的程序来验证是不够的，因为它实际上并没有完全验证！我可以`crontab`接受各种非法的东西。

Dave Taylor 的 Wicked Cool Shell Scripts（[Google 书籍链接](http://books.google.com/books?id=Df7P1WyG87sC&pg=PA147&lpg=PA147&source=web&ots=duLswqHFGM&sig=CIGfV56qkKVAGnz17zF76JmFhgQ&hl=en&sa=X&oi=book_result&resnum=1&ct=result#PPA147)）有一个 sh 脚本，可以进行部分验证，我发现讨论很有趣。您也可以使用或调整代码。

我还找到了两个 PHP 类的链接，它们按照你说的做（我没有评估它们的质量）：

*   [http://www.phpclasses.org/browse/package/1189.html](http://www.phpclasses.org/browse/package/1189.html)
*   [http://www.phpclasses.org/browse/package/1985.html](http://www.phpclasses.org/browse/package/1985.html)

另一种方法（取决于您的应用程序需要做什么）可能是让 PHP 以编程方式构建 crontab 条目并插入它，因此您知道它始终有效，而不是尝试验证不受信任的字符串。然后，您只需要制作一个“构建 crontab 条目”UI，如果您不需要非常复杂的调度组合，这可能很简单。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-06T16:01:18.910

感谢 Jordi Salvat i Alabart 发布了很好的解决方案。

我只修改了 Jordi Salvat i Alabart 发布的现有解决方案。它对我很有效，但我想通过捕获组来提取特定部分。我添加了非捕获括号，以便能够提取 crontab 记录的特定部分。当您在以下位置测试输出正则表达式时，很容易看到要使用哪个捕获组： [http ://www.regexplanet.com/advanced/java/index.html](http://www.regexplanet.com/advanced/java/index.html)

```
<?php
/**
 * @author Jordi Salvat i Alabart - with thanks to <a href="www.salir.com">Salir.com</a>.
 */

function buildRegexp() {
    $numbers = array(
        'min' => '[0-5]?\d',
        'hour' => '[01]?\d|2[0-3]',
        'day' => '0?[1-9]|[12]\d|3[01]',
        'month' => '[1-9]|1[012]',
        'dow' => '[0-6]'
    );

    foreach ($numbers as $field => $number) {
        $range = "(?:$number)(?:-(?:$number)(?:\/\d+)?)?";
        $field_re[$field] = "\*(?:\/\d+)?|$range(?:,$range)*";
    }

    $field_re['month'].='|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec';
    $field_re['dow'].='|mon|tue|wed|thu|fri|sat|sun';

    $fields_re = '(' . join(')\s+(', $field_re) . ')';

    $replacements = '@reboot|@yearly|@annually|@monthly|@weekly|@daily|@midnight|@hourly';

    return '^\s*(' .
            '$' .
            '|#' .
            '|\w+\s*=' .
            "|$fields_re\s+" .
            "|($replacements)\s+" .
            ')' .
            '([^\\s]+)\\s+' .
            '(.*)$';
} 
```

此代码生成正则表达式：

```
^\s*($|#|\w+\s*=|(\*(?:\/\d+)?|(?:[0-5]?\d)(?:-(?:[0-5]?\d)(?:\/\d+)?)?(?:,(?:[0-5]?\d)(?:-(?:[0-5]?\d)(?:\/\d+)?)?)*)\s+(\*(?:\/\d+)?|(?:[01]?\d|2[0-3])(?:-(?:[01]?\d|2[0-3])(?:\/\d+)?)?(?:,(?:[01]?\d|2[0-3])(?:-(?:[01]?\d|2[0-3])(?:\/\d+)?)?)*)\s+(\*(?:\/\d+)?|(?:0?[1-9]|[12]\d|3[01])(?:-(?:0?[1-9]|[12]\d|3[01])(?:\/\d+)?)?(?:,(?:0?[1-9]|[12]\d|3[01])(?:-(?:0?[1-9]|[12]\d|3[01])(?:\/\d+)?)?)*)\s+(\*(?:\/\d+)?|(?:[1-9]|1[012])(?:-(?:[1-9]|1[012])(?:\/\d+)?)?(?:,(?:[1-9]|1[012])(?:-(?:[1-9]|1[012])(?:\/\d+)?)?)*|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\s+(\*(?:\/\d+)?|(?:[0-6])(?:-(?:[0-6])(?:\/\d+)?)?(?:,(?:[0-6])(?:-(?:[0-6])(?:\/\d+)?)?)*|mon|tue|wed|thu|fri|sat|sun)\s+|(@reboot|@yearly|@annually|@monthly|@weekly|@daily|@midnight|@hourly)\s+)([^\s]+)\s+(.*)$ 
```

或生成此正则表达式的 Java 替代方法（没有 @X 的东西）：

```
public static String buildRegex(){
    // numbers intervals and regex
    Map<String, String> numbers = new HashMap<String, String>();
    numbers.put("min", "[0-5]?\\d");
    numbers.put("hour", "[01]?\\d|2[0-3]");
    numbers.put("day", "0?[1-9]|[12]\\d|3[01]");
    numbers.put("month", "[1-9]|1[012]");
    numbers.put("dow", "[0-6]");

    Map<String, String> field_re = new HashMap<String, String>();

    // expand regex to contain different time specifiers
    for(String field : numbers.keySet()){
        String number = numbers.get(field);
        String range = "(?:"+number+")(?:-(?:"+number+")(?:\\/\\d+)?)?";
        field_re.put(field, "\\*(?:\\/\\d+)?|"+range+"(?:,"+range+")*");
    }

    // add string specifiers
    String monthRE = field_re.get("month");
    monthRE = monthRE + "|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec";
    field_re.put("month", monthRE);

    String dowRE = field_re.get("dow");
    dowRE = dowRE + "|mon|tue|wed|thu|fri|sat|sun";
    field_re.put("dow", dowRE);

    StringBuilder fieldsReSB = new StringBuilder();
    fieldsReSB.append("^\\s*(")
            .append("$")
            .append("|#")
            .append("|\\w+\\s*=")
            .append("|");        
            .append("(")
            .append(field_re.get("min")).append(")\\s+(")
            .append(field_re.get("hour")).append(")\\s+(")
            .append(field_re.get("day")).append(")\\s+(")
            .append(field_re.get("month")).append(")\\s+(")
            .append(field_re.get("dow"))
            .append(")")
            .append("\\s+)")
            .append("([^\\s]+)\\s+")
            .append("(.*)$");

    return fieldsReSB.toString();
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-07T15:25:01.120

有一个不错的 PHP 库可用于 Cron 表达式验证：

*   [https://github.com/mtdowling/cron-expression](https://github.com/mtdowling/cron-expression)

通过 composer 安装这个库：

```
composer require mtdowling/cron-expression 
```

检查 Cron 表达式是否有效

```
$isValid = Cron\CronExpression::isValidExpression($expression); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T22:45:58.050

您应该能够使用正则表达式相当容易地做到这一点。事实上，如果你能在 Google 上找到一个现有的正则表达式，我不会感到惊讶。这是未经测试的，但可能类似于：

```
/^((\*)|(\d+((-\d+)|(,\d+)+))\s+){5}/ 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-02-18T09:14:24.260

使用模式： `/^((?:[1-9]?\d|\*)\s*(?:(?:[\/-][1-9]?\d)|(?:,[1-9]?\d)+)?\s*){5}$/`

在 PHP 中：

```
<?php 
$cron = "*/5 1-2 3 3,4,5 *"; 
$result = preg_match( "/^((?:[1-9]?\d|\*)\s*(?:(?:[\/-][1-9]?\d)|(?:,[1-9]?\d)+)?\s*){5}$/", $cron, $matches); 
print_r($matches); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-12-11T18:06:35.693

感谢 Jordi Salvat i Alabart 和 ph4r05。

我在 php 上发布了一些修改过的现有解决方案。Perl 替代生成正则表达式：

```
sub _BuildRegex {
    my $number = {
            'min'   =>      '[0-5]?\d',
            'hour'  =>      '[01]?\d|2[0-3]',
            'day'   =>      '0?[1-9]|[12]\d|3[01]',
            'month' =>      '[1-9]|1[012]',
            'dow'   =>      '[0-6]'
    };

    my $field_re = {};
    foreach my $nmb ( qw/min hour day month dow/ ) {
            my $range = "(?:$number->{$nmb})(?:-(?:$number->{$nmb})(?:\\/\\d+)?)?";
            $field_re->{$nmb} = "\\*(?:\\/\\d+)?|$range(?:,$range)*";
    }

    $field_re->{'month'} .='|[jJ]an|[fF]eb|[mM]ar|[aA]pr|[mM]ay|[jJ]un|[jJ]ul|[aA]ug|[sS]ep|[oO]ct|[nN]ov|[dD]ec';
    $field_re->{'dow'} .= '|[mM]on|[tT]ue|[wW]ed|[tT]hu|[fF]ri|[sS]at|[sS]un';

    my $ff = [];
    push @$ff, $field_re->{$_} foreach ( qw/min hour day month dow/ );

    my $fields_req = '(' . join(')\s+(', @$ff) . ')';

    my $replacements = '@reboot|@yearly|@annually|@monthly|@weekly|@daily|@midnight|@hourly';

    return '^\s*(' .
         '$' .
         '|#' .
         '|\w+\s*=' .
         "|$fields_req\\s+" .
         "|($replacements)\\s+" .
         ')' .
         '([^\\s]+)\\s+' .
         '(.*)$';
} 
```

# sql - SQL Server 2005 中的分层查询

> ID：235515
> 
> 赞同：11
> 
> 时间：2008-10-24T22:44:43.887
> 
> 标签：sql, sql-server, sql-server-2005

早在我在 Oracle 商店工作时，我就认为 CONNECT_BY 是理所当然的。现在我坚持使用 SQL Server 2005 并且有一些讨厌的对象层次结构。具体来说，我们有一个自引用表，其中所有子记录都有一个带有其父 ID 的列。目前，我们有一个将子级映射到层次结构中的级别的视图和一个讨厌的查询，它可以完成繁重的工作以将父母与他们的孩子联系起来。虽然这种方法有效，但它远非优雅且带有污点。我只是好奇其他人如何从 SQL Server 2005 检索分层数据。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-24T22:54:38.237

这将创建典型的层次表并使用 CTE 选择层次结构并为每个项目创建路径。

```
CREATE TABLE tblHierarchy (ID int, ParentID int NULL, Name varchar(128));

INSERT INTO tblHierarchy VALUES (1, NULL, '1');
INSERT INTO tblHierarchy VALUES (2, NULL, '2');
INSERT INTO tblHierarchy VALUES (3, NULL, '3');
INSERT INTO tblHierarchy VALUES (4, 1, '1.1');
INSERT INTO tblHierarchy VALUES (5, 1, '1.2');
INSERT INTO tblHierarchy VALUES (6, 4, '1.1.1');

WITH Parent AS
(
    SELECT
        ID,
        ParentID,
        Name AS Path
    FROM
        tblHierarchy
    WHERE
        ParentID IS NULL

    UNION ALL

    SELECT
        TH.ID,
        TH.ParentID,
        CONVERT(varchar(128), Parent.Path + '/' + TH.Name) AS Path
    FROM
        tblHierarchy TH
    INNER JOIN
        Parent
    ON
        Parent.ID = TH.ParentID
)
SELECT * FROM Parent 
```

输出：

```
ID  ParentID    Path
1   NULL        1
2   NULL        2
3   NULL        3
4   1       1/1.1
5   1       1/1.2
6   4       1/1.1/1.1.1 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T22:58:00.553

两者都使用后，我发现 CONNECT BY 比 CTE 更灵活、更易于使用。这个问题与我几周前回答的问题没有什么不同。有关CONNECT BY 和 CTE 的简要比较，请参见[此处](https://stackoverflow.com/questions/112866/database-schema-for-a-hierarchial-groups#114477)，有关使用 CTE 的查询示例，请参见[此处。](https://stackoverflow.com/questions/69923/stored-procedures-reverse-engineering#93967)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T22:55:06.957

仅供参考。SQL Server 2008 支持新的数据类型[Hierarchy ID](http://msdn.microsoft.com/en-us/magazine/cc794278.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T22:51:08.633

在 SQL Server 2005 中，您可以为此使用公用表表达式 (CTE)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-02T06:50:53.680

要先遍历层次结构的深度，然后再遍历下一个兄弟级别，可以使用 CTE：

```
declare @tempTable TABLE
(
    ORGUID int,
    ORGNAME nvarchar(100), 
    PARENTORGUID int,
    ORGPATH nvarchar(max)
)

;WITH RECORG(ORGuid, ORGNAME, PARENTORGUID, ORGPATH)
as
(
    select 
        org.UID,
        org.Name,
        org.ParentOrganizationUID,
        dbo.fGetOrganizationBreadcrumbs(org.UID)
    from Organization org
    where org.UID =1

    union all

    select 
        orgRec.UID,
        orgRec.Name,
        orgRec.ParentOrganizationUID,
        dbo.fGetOrganizationBreadcrumbs(orgRec.UID) 
    from Organization orgRec
    inner join RECORG recOrg on orgRec.ParentOrganizationUID = recOrg.ORGuid

)
insert into @tempTable(ORGUID, ORGNAME, PARENTORGUID,ORGPATH)

select ORGUID, ORGNAME, PARENTORGUID,ORGPATH 
from  RECORG rec 

select * 
from @tempTable where ORGUID in(select MIN(tt.ORGUID) 
                                from @tempTable tt 
                                group by tt.PARENTORGUID) 
```

# asp.net - 用于 Safari 或 Chrome 的 ASP.NET 容器特定母版页

> ID：235533
> 
> 赞同：0
> 
> 时间：2008-10-24T22:54:26.613
> 
> 标签：asp.net, browser, safari, google-chrome, master-pages

有没有人能够为 Safari 或 Chrome创建**容器特定的母版页？**

我找不到其中任何一个的任何“.browser”文件。

%SystemRoot%\Microsoft.NET\Framework\version\CONFIG\Browsers 目录多久更新一次？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T10:36:40.727

对于 .browser 文件，请尝试：

[http://owenbrady.net/browsercaps/](http://owenbrady.net/browsercaps/)

具体来说，您可以在此处找到您要查找的内容：

[http://owenbrady.net/browsercaps/OceanAppleWebKit.browser.xml](http://owenbrady.net/browsercaps/OceanAppleWebKit.browser.xml)

# visual-studio - 是否可以将 TFS 中分支的所有更改压缩到一个提交中？

> ID：235555
> 
> 赞同：4
> 
> 时间：2008-10-24T23:07:27.307
> 
> 标签：visual-studio, tfs

对于个人项目，我将 Git 用于 SCM，但在工作中我们使用 TFS。我喜欢 Git 的一件事是它允许人们在将更改拉回主分支时轻松压缩分支中所做的所有更改。

这样做的好处是，如果他们的更改有任何问题，即使没有创建标签，也可以轻松地将其删除，并恢复到合并之前的版本。

这是。或 TFS 中的等价物？这是搁置变化适合等式的地方吗？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T23:08:41.843

在 TFS 中执行合并会导致一次提交；来自源分支的所有更改都汇总到一个针对目标分支挂起的变更集中。因此，据我了解您的问题，答案是“是”。

# javascript - 如何使用 jQuery 随机显示一组元素？

> ID：235556
> 
> 赞同：4
> 
> 时间：2008-10-24T23:07:58.537
> 
> 标签：javascript, jquery

使用 jQuery，您将如何以随机顺序在页面上`show()`每`div.foo`X 毫秒出现一个新页面？

**澄清**：我想从隐藏所有这些元素开始，并以所有这些元素显示结束，所以`show()`两次对同一个元素没有意义。

我原本以为我会创建一个列出所有元素的数组，随机选择一个，显示一个，使用 将其从数组中删除`splice()`，然后从剩余列表中随机选择下一个 - 等等。但由于我的数组是一个 jQuery 对象，`splice()`不可用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T05:15:24.223

一个有趣的方法是使用 shuffle 函数扩展 Javascript 的 Array 基础对象。在 Prototype 中（在 JQuery 中应该相同，除了 jQuery.extend）。这是快速而肮脏的洗牌，还有很多其他方法可以做到这一点。

```
Object.extend(Array.prototype, {
  shuffle : function() {
    this.sort( function() { return 0.5 - Math.random(); } );
    return this;
  }
}); 
```

因此，假设您已经准备好您的 div 数组，请调用 shuffle() 方法并简单地按顺序（它们现在被打乱）并显示它们（根据您的间隔）。可能希望通过克隆 shuffle 方法返回的数组而不是直接对其进行排序来实现“非破坏性”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T00:50:00.657

我自己不使用 jQuery，但是这个呢：

```
var intervalMilliseconds = X; // set to your value for X
var divFoos = $("div.foo").get();
var intervalId = setInterval(function() {
   $(divFoos.splice(Math.floor(Math.random() * divFoos.length), 1)).show();
   if(divFoos.length == 0) clearInterval(intervalId);
}, intervalMilliseconds); 
```

这应该够了吧。

* * *

更新：由于您的描述并不明确，我假设您的意思是您最终想要显示所有这些，并且一旦它们可见，我们就完成了。如果没有，请进一步解释，以便我可以更新（如果您还不能从我提供的代码中确定您需要什么）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T02:12:30.707

这是我的做法~~（未经测试）~~：

```
(function () {
    var int, els;
    int = 100; // interval, in milliseconds
    els = $('div.foo');
    setInterval(function () {
        var idx;
        idx = Math.floor(els.length * Math.random());
        $(els[idx]).show();
        setTimeout(function () {
            $(els[idx]).hide();
        }, int);
    }, int);
})(); 
```

# php - 如何阻止机器人在 PHP 中增加我的文件下载计数器？

> ID：235558
> 
> 赞同：12
> 
> 时间：2008-10-24T23:09:11.623
> 
> 标签：php, bots

当用户单击链接以在我的网站上下载文件时，他们会转到[此 PHP 文件](http://viewsourcecode.org/viewsource/homebrew.php)，该文件会增加该文件的下载计数器，然后 header() 将它们重定向到实际文件。但是，我怀疑机器人正在跟踪下载链接，因此下载次数不准确。

*   我如何让机器人知道他们不应该点击链接？
*   有没有办法检测大多数机器人？
*   有没有更好的方法来计算文件的下载次数？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-24T23:14:23.283

robots.txt：[http ://www.robotstxt.org/robotstxt.html](http://www.robotstxt.org/robotstxt.html)

并非所有机器人都尊重它，但大多数都尊重它。如果您真的想阻止通过机器人进行访问，请将指向它的链接设为 POST 而不是 GET。机器人不会遵循 POST 网址。（即，使用一个小表单回发到将您带到相关 URL 的站点。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T23:30:46.727

我认为 Godeke 的 robots.txt 答案就足够了。如果您绝对不能让机器人成为您的计数器，那么我建议您使用 robots 文件，同时不要使用一些[常见的机器人用户代理](http://support.free-conversant.com/2701)来增加点击次数。

两种方式都不是完美的。但两者的混合可能更严格一些。如果是我，我可能会坚持使用 robots 文件，因为它很容易并且可能是最有效的解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T23:37:59.927

Godeke 是对的，robots.txt 是阻止机器人下载的第一件事。

关于计数，这确实是一个网络分析问题。您是否没有保留您的 www 访问日志并通过[Webalizer](http://www.webalizer.com/)或[AWStats](http://awstats.sourceforge.net/)等分析程序（或 Webtrends 或 Urchin 等花哨的替代方案）运行它们？对我来说，这是收集此类信息的方法，因为它很简单，并且在用户下载文件时没有 PHP、重定向或其他性能损失。您只是在使用您保留的 Apache 日志。（并且`grep -c`会给你一个特定文件或通配符模式的快速“n”脏计数。）

您可以将统计软件配置为忽略机器人或特定用户代理和其他标准的点击（如果您稍后更改标准，您只需重新处理旧的日志数据）。当然，这确实需要您拥有所有旧日志，因此如果您一直在折腾它们，那么`logrotate`您将不得不在没有任何历史数据的情况下开始。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T08:30:23.190

[您还可以使用http://www.bad-behavior.ioerror.us/](http://www.bad-behavior.ioerror.us/)检测不尊重 robots.txt 的恶意机器人。

# java - 如何检测 java 虚拟机内存不足的情况？

> ID：235560
> 
> 赞同：3
> 
> 时间：2008-10-24T23:09:48.923
> 
> 标签：java, virtual-machine, low-memory

我最近在我的应用程序中遇到了一些 OutOfMemory 错误。是否可以提前检测到虚拟机内存不足？换句话说，在 OutOfMemory 错误实际发生之前抢先处理它们？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-25T00:45:15.393

Java（从 Java 5 开始）现在有一个标准 JMX bean，可用于接收内存不足通知。见`java.lang.management.MemoryMXBean`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T23:26:32.930

我建议一个更好的问题是“为什么我的应用程序内存不足？”

您可能需要在启动时增加 JVM 可用的内存；您可能有内存泄漏（不再需要时没有释放的对象。）

有关该应用程序的更多信息也可能会有所帮助

*   它是否连续运行，24x7x365？
*   它是否运行一次并退出？

使用性能监控/分析工具来查找内存问题的原因确实是您最好的选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T00:08:47.837

看看 Runtime 的 freeMemory 方法（详见[http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html)）

简而言之：做

```
Runtime.getRuntime().freeMemory() 
```

# c# - 是否可以抛出 MessageQueueException？

> ID：235564
> 
> 赞同：4
> 
> 时间：2008-10-24T23:10:46.377
> 
> 标签：c#, .net, exception, tdd, rhino-mocks

我在 RhinoMocks 中使用一个模拟对象来表示一个调用 MessageQueue.GetPublicQueues 的类。我想模拟消息队列在工作组模式下运行时抛出的异常，即MessageQueueException，以确保我正确捕获异常

MessageQueueException 没有公共构造函数，只有标准的受保护异常构造函数。有没有合适的方法从模拟对象/Expect.Call 语句中抛出这个异常？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T00:46:47.340

反射可以打破可访问性规则。您*将使*保修失效，.NET 更新很容易破坏您的代码。试试这个：

```
using System.Reflection;
using System.Messaging;
...
        Type t = typeof(MessageQueueException);
        ConstructorInfo ci = t.GetConstructor(BindingFlags.NonPublic | BindingFlags.Instance, 
          null, new Type[] { typeof(int) }, null);
        MessageQueueException ex = (MessageQueueException)ci.Invoke(new object[] { 911 });
        throw ex; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-16T23:36:47.060

您可以通过尝试创建无效队列来导致此问题。可能比被框架更改俘虏更安全（通过使用私有/受保护的构造函数）：

```
MessageQueue mq = MessageQueue.Create("\\invalid"); 
```

# c++ - 一个组件的整体实现可以分为两个对象吗？

> ID：235570
> 
> 赞同：1
> 
> 时间：2008-10-24T23:12:59.633
> 
> 标签：c++, com, xpcom

我已经看到 Microsoft COM 和 XPCOM，至少从我到目前为止所阅读和收集的内容来看，组件中接口的实现基本上必须在派生所有虚拟接口的单个​​类中。它是否正确？我错过了什么？

有没有办法让多个对象（可能在单独的 DLL 中）每个都提供它们的功能，并且仍然能够使用 QueryIterface 在它们之间自由转换？

我正在寻找的是具有一些功能的组件，但仍然允许外部客户端代码使用（可能）新接口创建组件的新扩展。理想情况下，这应该在不泄露组件的当前来源及其实现的情况下发生。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T00:38:52.567

这应该是可能的，尽管标准的高级包装器可能不支持。大多数包装器（ATL、MFC 等）仅支持将 COM 对象映射到单个类。但是，QueryInterface 可以返回不同的指针并调用 COM 对象代码，因此第一个 COM 对象可以加载不同的 DLL，实例化不同的对象，并返回指向其接口 (vtable) 的指针。

据我所知，这一切都是可能的，您可能会自己编写很多低级胶水代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T20:47:18.763

是的，ATL 支持[分离接口](http://msdn.microsoft.com/en-us/library/wh8b86c9(VS.80).aspx) 这允许在另一个类中实现接口，该类仅在请求接口时才实例化。由于它只传递一个接口，我想它也可以放入一个单独的 DLL 中。

（也可以被请求一次后[缓存）](http://msdn.microsoft.com/en-us/library/csx8h562(VS.80).aspx)

# tomcat - 通过 Infoview 的 Business Objects XI 3.0 仪表板错误

> ID：235593
> 
> 赞同：1
> 
> 时间：2008-10-24T23:26:35.940
> 
> 标签：tomcat, business-objects, dashboard, infoview

我正在测试最新的 Business Objects Edge 试用版，但是当我以管理员身份登录 Infoview 时，当我单击以创建或组织仪表板时，我收到以下两条错误消息之一...

提交响应后无法转发

或者

Servlet 引擎异常：null URL：/PerformanceManagement/scripts/tools/err_page.jsp?null

堆栈跟踪：

```
 java.lang.NullPointerException
    at com.bo.aa.util.SecurityStore.GetLogonToken(SecurityStore.java:28)
    at com.bo.aa.util.SecurityStore.getSecurityValue(SecurityStore.java:79)
    at com.bo.aa.impl.DBServerImpl.getSecurityToken(DBServerImpl.java:166)
    at org.apache.jsp.jsp.appsHome_jsp._jspService(appsHome_jsp.java:536)
    at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:97)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
    at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:334)
    at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)
    at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
    at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
    at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
    at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)
    at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
    at java.lang.Thread.run(Thread.java:595) 
```

非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T09:06:11.560

找到解决方案

我已经有了我的问题的答案。

原因：初始化用户密码错误

解决方案：使用空白密码创建一个新用户。此用户是管理员组的成员。用 InitConfig.properties 文件（c:\Program Files\Business Objects\Performance Management 12.0 或）中的新用户替换 Initialization User 并重新启动所有 Performance Management 服务器和 Apache Tomcat，然后再次登录 InfoView，现在应该出现问题得到解决。

# php - 用 PHP 覆盖文件中的行

> ID：235604
> 
> 赞同：18
> 
> 时间：2008-10-24T23:34:10.917
> 
> 标签：php, file-io, fopen, fwrite

覆盖文件中特定行的最佳方法是什么？我基本上想在文件中搜索字符串 '@parsethis' 并用其他内容覆盖该行的其余部分。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-25T08:08:11.770

如果文件真的很大（日志文件或类似的东西）并且您愿意牺牲速度来消耗内存，您可以打开两个文件并基本上通过使用文件而不是系统内存来完成[Jeremy Ruten](https://stackoverflow.com/questions/235604/overwite-line-in-file-with-php#235610)提出的技巧。

```
$source='in.txt';
$target='out.txt';

// copy operation
$sh=fopen($source, 'r');
$th=fopen($target, 'w');
while (!feof($sh)) {
    $line=fgets($sh);
    if (strpos($line, '@parsethis')!==false) {
        $line='new line to be inserted' . PHP_EOL;
    }
    fwrite($th, $line);
}

fclose($sh);
fclose($th);

// delete old source file
unlink($source);
// rename target file to source file
rename($target, $source); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-24T23:38:08.570

如果文件不是太大，最好的方法可能是使用[file()](http://php.net/file)将文件读入行数组，在行数组中搜索字符串并编辑该行，然后[implode()](http://php.net/implode)数组返回一起并[fwrite()](http://php.net/fwrite)将其返回到文件中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-25T00:13:55.470

您的主要问题是新线的长度可能与旧线不同。如果您需要更改行的长度，则没有办法在更改的行之后至少重写所有文件。最简单的方法是创建一个新的、修改过的文件，然后将其移到原始文件上。这样就可以随时为读者提供完整的文件。使用锁定以确保一次只有一个脚本在修改文件，并且由于您要替换文件，因此对不同的文件进行锁定。退房`flock()`。

如果您确定新行与旧行的长度相同，您可以在读/写模式下打开文件（`r+`用作 的第二个参数`fopen()`）并调用`ftell()`以保存该行在您之前的每次开始的位置调用`fgets()`读取一行。找到要覆盖的行后，您可以使用`fseek()`返回到行的开头和`fwrite()`新数据。强制线始终保持相同长度的一种方法是将其空间填充到最大可能长度。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-11-14T14:15:09.507

这是一个解决方案，仅适用于使用 PHP 中的 sed 重写文件的一行。我的文件仅包含样式变量并且格式为：$styleVarName: styleVarProperty;\n
为此，我首先将“:”添加到 myStyleVarName 的末尾，然后 sed 用新属性替换该行的其余部分并添加一个分号。确保字符在 myStyleVarProp 中正确转义。

```
$command = "pathToShellScript folder1Name folder2Name myStyleVarName myStyleVarProp";
shell_exec($command);

/* shellScript */
#!/bin/bash
file=/var/www/vhosts/mydomain.com/$1/$2/scss/_variables.scss
str=$3"$4"
sed -i "s/^$3.*/$str;/" $file 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T08:44:40.637

或者如果您的文件不是太大：

```
$sample = file_get_contents('sample');
$parsed =preg_replace('#@parsethis.*#', 'REPLACE TO END OF LINE', $sample); 
```

您必须选择文件中不存在的分隔符“#”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-04-16T07:06:31.677

如果你想用另一个文件的内容完全替换一个文件的内容，你可以使用这个：

```
rename("./some_path/data.txt", "./some_path/data_backup.txt");
rename("./some_path/new_data.txt", "./some_path/data.txt"); 
```

因此，在第一行中备份文件，在第二行中将文件替换为新文件的内容。

据我所知，重命名返回一个布尔值。如果重命名成功则为真，如果重命名失败则为假。因此，只有在第一步成功时才能运行第二步，以防止覆盖文件，除非已成功进行备份。查看：

[https://www.php.net/manual/en/function.rename.php](https://www.php.net/manual/en/function.rename.php)

希望这对某人有用。

干杯

阿德里安

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-25T00:05:13.897

我很可能会按照 Jeremy 的建议去做，但这里的另一种方法是另一种解决方案。这尚未经过测试或使用，适用于 *nix 系统。

```
$cmd = "grep '@parsethis' " . $filename;
$output = system($cmd, $result);
$lines = explode("\n", $result);
// Read the entire file as a string
// Do a str_repalce for each item in $lines with "" 
```

# x++ - 使用 Axapta 报告工具在同一行上打印来自不同表的列的最佳方法是什么？

> ID：235605
> 
> 赞同：5
> 
> 时间：2008-10-24T23:34:25.393
> 
> 标签：x++, axapta

似乎*axapta*报告中的每个正文部分只能打印单个表中的列（始终）。例如：我有一个包含以下表格的报表：SalesLine、InventTable 和 CustTable。然后我想在同一行上打印每个表中的列。似乎我可以在将字段放置在可编程部分时这样做，但当我将它们放置在正文部分时却不行。

我发现了一些丑陋或性能不佳的解决方法。必须有一个干净的方法来做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T19:24:04.237

应该可以做到这一点，基本系统中有几个报告以这种方式工作。以 4.0 中的 SalesContractShipment 报告为例。

在您的报表上，为 SalesLine 创建一个数据源，然后在该报表下分别为 InventTable 和 CustTable 创建一个数据源。在 InventTable 和 CustTable 上，确保 FetchMode 设置为 1:1。如果您创建自定义 fetch 方法，请确保以正确的顺序调用 send()。您应该首先发送 CustTable，然后是 InventTable，最后是 SalesLine。在报表设计中，为 SalesLine 创建一个主体。然后，您应该能够使用该正文中三个表中的任何一个的字段。

如果您仍然遇到问题，我可以考虑两种解决方法。一种是基于这三个表创建一个视图，并基于该视图创建一个报告。另一种是基于 SalesLine 创建报表并使用 displayMethods 从 InventTable 或 CustTable 中查找您需要的任何字段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-05T13:54:40.293

您应该能够向报表添加多个数据源，然后为您添加的第一个数据源创建一个正文。右键单击正文并选择 New Control -> Field From AnyTableThatIsADataSource。然后，您可以添加所需的任何字段，它将打印所有这些字段的列。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-27T12:06:35.450

将所有字段放在最后一个 SourceTable_Body 中，它会显示所有字段，因为 QueryRun 逐表并用每个对应的 Body 填充 body，所以最后一个 body 将包含所有字段的数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-01T17:59:21.690

考虑使用临时表。先用你的数据填充它，然后在报告中使用。

# asp.net - 在 ASP.Net 中向客户端发送大量复选框的最佳方式是什么？

> ID：235608
> 
> 赞同：2
> 
> 时间：2008-10-24T23:37:53.717
> 
> 标签：asp.net, viewstate, dynamically-generated-co

我有以下情况：

用户将在页面上定义某个过滤器，在回发时，我将使用该过滤器查询数据库并向用户返回一堆匹配的记录，每个记录旁边都有一个复选框，因此他可以选择是否对每个记录进行操作那些记录。

在 Classic ASP / PHP 中，我可以生成许多名为“chk__*”的控件，然后在回发时通过所有 $ *POST 条目寻找前缀为“chk* ”的条目。

在 ASP.Net 2.0 中执行此操作的最佳方法是什么？

我可以通过使用包含复选框的模板实现中继器，将中继器绑定到数据集，然后在第二个回发时，我只是这样做：

```
For Each it As RepeaterItem In repContacts.Items
    Dim chkTemp As CheckBox = DirectCast(it.FindControl("cbSelect"), CheckBox)
    If chkTemp.Checked Then

    End If
Next 
```

然而，这有一个*小*缺点，就是给我一个巨大的视图状态，这真的很糟糕，因为客户端需要将整个视图状态重新上传到服务器，而这些人可能会通过糟糕的连接使用我的网站。

还有其他想法吗？（我也可以像过去一样动态创建控件并通过 Request.Form 进行迭代，但是，我正在寻找一个更清洁的

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T00:03:14.963

你看过 CheckBoxList 控件吗？您可以将其绑定到您的数据集，提供文本成员和值成员项，它还可以让您轻松查看检查了哪些项。如果需要，还可以动态添加更多复选框项目。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T23:58:57.810

以与经典 ASP 中相同的方式执行此操作。使用 <input type="checkbox"> 而不是 <asp:checkbox>。您可以使用 Request.Form 访问原始帖子参数

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T23:58:19.637

当面临荒谬的 Viewstate 条件时，我推荐经典的 ASP 解决方案。失去了它提供的好功能很遗憾，但是将*一些*启用 Viewstate 的控件 (asp:*) 与一些经典技术 (input type="...") 结合起来让我在过去省去了*很多*麻烦。

有时您只想做一些简单的事情，而简单的解决方案胜过“所见即所得”的表单编辑。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T03:36:30.070

我所做的一件事是在会话中通过 AJAX 记录检查的状态，然后在回发（通过 AJAX 的全部或部分）上，在会话中查找要执行所选操作的项目。

基本思想是在复选框中添加一个 onclick 处理程序，该处理程序知道关联项目的 id。在点击处理程序中，通过 AJAX 将此 id 传回服务器并将其记录在会话中——您还需要传达复选框状态，以便您可以取消选中项目。让提交控件的处理程序使用有关从会话中选择了哪些项目的数据。

这种方式也允许您处理分页数据，因为您可以在呈现（完整或部分）带有选中项目的页面时从会话中设置复选框的初始值。

它可能看起来像这样。假设 ASP.NET AJAX 带有 PageMethods（当然还有 ScriptManager）。

```
<script type='text/javascript'>
   function record(checkbox,item)
   {
       var context = { ctl : checkbox };
       PageMethods.Record(item,checkbox.checked,onSuccess,onFailure,context);
   }

   function onSuccess(result,context)
   {
      // do something, maybe highlight the row, maybe nothing
   }

   function onFailure(error,context)
   {
       context.ctl.checked = false;
       alert(error.get_Message());
   }
</script>

...
<tr><td><input type='checkbox' onclick='record(this,"item_1");'></td><td>Item 1</td></tr>
...

Codebehind

[WebMethod(EnableSessionState=true)]
public static void Record( string itemName, bool value )
{
     List<string> itemList = (List<string>)Session["Items"];
     if (itemList == null)
     {
        itemList = new List<string>();
        Session["Items"] = itemList;
     }
     if (itemList.Contains(itemName) && !value)
     {
         itemList.Remove(itemName);
     }
     else if (!itemList.Contains(itemName) && value)
     {
         itemList.Add(itemName);
     }       
}

protected void button_OnClick( object sender, EventArgs e )
{
     List<string> itemList = (List<string>)Session["Items"];
     if (itemList != null)
     {
         foreach (string item in itemList)
         {
             // do something with the selected item
         }
     }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T23:50:29.793

禁用 ViewState。如果无法完成，请尝试使用[Session 来存储视图状态](http://msdn.microsoft.com/en-us/library/system.web.ui.sessionpagestatepersister.aspx)

# c++ - 函数模板的多个定义

> ID：235616
> 
> 赞同：11
> 
> 时间：2008-10-24T23:44:24.063
> 
> 标签：c++, templates, linker

假设一个头文件定义了一个函数模板。现在假设`#include`这个头文件有两个实现文件，每个都有一个函数模板的调用。在两个实现文件中，函数模板都使用相同的类型进行实例化。

```
// header.hh
template <typename T>
void f(const T& o)
{
    // ...
}

// impl1.cc
#include "header.hh"

void fimpl1()
{
    f(42);
}

// impl2.cc
#include "header.hh"

void fimpl2()
{
    f(24);
} 
```

人们可能期望链接器会抱怨`f()`. 具体来说，如果`f()`不是模板，那么情况确实如此。

*   为什么链接器不抱怨多个定义`f()`？
*   标准中是否规定链接器必须优雅地处理这种情况？换句话说，我可以总是指望类似于上面的程序来编译和链接吗？
*   如果链接器可以足够聪明地消除一组函数模板实例化的歧义，为什么它不能对常规函数做同样的事情，因为它们与实例化函数模板的情况相同？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-24T23:49:44.007

为了支持 C++，链接器足够聪明，可以识别它们都是相同的函数，并抛出除一个之外的所有函数。

编辑：澄清：链接器不比较函数内容并确定它们是相同的。模板函数被标记为这样，链接器识别它们具有相同的签名。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-25T05:30:38.500

Gnu C++ 编译器手册对此[进行了很好的讨论](http://gcc.gnu.org/onlinedocs/gcc/Template-Instantiation.html)。摘录：

> C++ 模板是第一个需要来自环境的智能比通常在 UNIX 系统上发现的更多智能的语言功能。不知何故，编译器和链接器必须确保每个模板实例在需要时在可执行文件中只出现一次，否则根本不出现。解决这个问题有两种基本方法，称为 Borland 模型和 Cfront 模型。
> 
> ## Borland模型
> 
> Borland C++ 解决了模板实例化问题，方法是在其链接器中添加与公共块等效的代码；编译器在每个使用它们的翻译单元中发出模板实例，链接器将它们折叠在一起。这种模型的优点是链接器只需要考虑目标文件本身；无需担心外部复杂性。这个缺点是因为模板代码被重复编译而增加了编译时间。为这个模型编写的代码倾向于在头文件中包含所有模板的定义，因为它们必须被视为被实例化。
> 
> ## 前锋模型
> 
> AT&T C++ 翻译器 Cfront 通过创建模板存储库的概念解决了模板实例化问题，模板存储库是一个自动维护的存储模板实例的地方。存储库的更现代版本的工作方式如下：在构建单个目标文件时，编译器将在存储库中遇到的任何模板定义和实例化。在链接时，链接包装器在存储库中添加对象并编译任何以前未发出的所需实例。该模型的优点是更优化的编译速度和使用系统链接器的能力；要实现 Borland 模型，编译器供应商还需要更换链接器。缺点是大大增加了复杂性，因此可能会出错；对于某些代码，这可能同样透明，但实际上很难在一个目录中构建多个程序，在多个目录中构建一个程序。为这个模型编写的代码倾向于将非内联成员模板的定义分离到一个单独的文件中，该文件应该单独编译。
> 
> 在 GNU/Linux 或 Solaris 2 等 ELF 系统或 Microsoft Windows 上与 GNU ld 版本 2.8 或更高版本一起使用时，G++ 支持 Borland 模型。在其他系统上，G++ 都没有实现自动模型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T23:57:45.643

这或多或少只是模板的一种特殊情况。

编译器只生成实际使用的模板实例。由于它无法控制从其他源文件生成什么代码，它必须为每个文件生成一次模板代码，以确保完全生成该方法。

由于很难解决这个问题（标准有一个`extern`模板关键字，但 g++ 没有实现它）链接器只接受多个定义。

# .net - WCF 和 System.Configuration 命名空间

> ID：235618
> 
> 赞同：6
> 
> 时间：2008-10-24T23:46:45.603
> 
> 标签：.net, wcf, system.configuration

当引用的 .NET Framework 2.0 程序集尝试在 IIS 托管的 WCF 服务中执行以下代码行时，我收到一个错误：

错误信息：

> 当不在独立 exe 中运行时，必须指定 exePath。

源代码：

```
ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None); 
```

有没有人遇到过这个问题，他们知道如何解决吗？

**编辑：**我的问题是，从向后兼容 .NET 2.0 程序集的 WCF 服务打开配置文件（app.config 和 web.config）的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T01:26:29.400

引用的 .NET 2.0 程序集是我为我们的企业库开发的用于处理常见任务的类库的一部分。它旨在用于 ASP.NET 和 WinForm 应用程序。

这是我用来确定要打开哪种类型的配置文件的源代码：

```
//Open app.config or web.config file
if (HttpContext.Current != null)
    this.m_ConfigFile = WebConfigurationManager.OpenWebConfiguration("~");
else
    this.m_ConfigFile = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T23:00:24.493

我能够通过从我以前的答案中删除现有代码并将其替换为以下 ConfigurationManager 实现来解决配置问题：

```
string MySetting = ConfigurationManager.AppSettings.Get("MyAppSetting"); 
```

如果适用于 ASP.NET 应用程序、WinForms 应用程序和 WCF 服务。3 年前，我刚刚过度设计了我的类库的初始实现......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T02:28:31.440

这取决于您要完成的工作。在 ASP.NET 上，您通常不会将 ConfigurationManager 用于此类事情，而是使用 WebConfigurationManager。也就是说，没有确切的等价物，因为实际上，OpenExeConfiguration 允许的用户/漫游/等内容在 Web 应用程序上没有意义。

你需要它做什么？

# cgi - 配置 EasyPHP 以使用 CGI

> ID：235631
> 
> 赞同：3
> 
> 时间：2008-10-24T23:52:57.527
> 
> 标签：cgi, config, easyphp

我正在尝试修改我的 EasyPHP 以在 CGI 模式下运行。

根据此链接：[http](http://www.easyvitools.com/phpserial/php_ser_reference.html) ://www.easyvitools.com/phpserial/php_ser_reference.html 我必须在这一行中添加：LoadModule php5_module "C:/Program Files/EasyPHP 2.0b1/php5/php5apache2.dll" 到 httpd。会议

但是，每次我这样做时，EasyPHP 都会给我这个错误：

> Apache 配置文件中的错误：
> 
> “”apache.exe：.../apache/conf/httpd.conf 的第 126 行出现语法错误。文件 C:..../php5/php5apache2.dll 中的 API 模块结构 'php5_module' 是乱码 - 也许这不是 APache 模块 DSO？""

我检查了文件 php5apache2.dll 存在并且在配置文件中是正确的。有谁知道什么可能导致这个问题，或者我做错了什么将其更改为 CGI 模式而不是使用默认的 APache 处理程序？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T01:26:12.533

我相信您可能需要重新阅读说明：

**评论**这一行：

```
#LoadModule php5_module "c:/Php/php5apache2.dll" 
```

并添加 2 行：

ScriptAlias /php/ "c:/php/"
动作应用程序/x-httpd-php "/php/php-cgi.exe"

因此，您实际上添加的行似乎需要注释掉/删除。您需要在 httpd.conf 中使用这些替代指令。

# data-structures - 移动物体的空间数据结构？

> ID：235637
> 
> 赞同：19
> 
> 时间：2008-10-24T23:56:07.427
> 
> 标签：data-structures, geometry, collision-detection, spatial, neighbours

我想知道处理大量移动对象（球体、三角形、框、点等）的最佳数据结构是什么？我试图回答两个问题，最近邻和碰撞检测。

我确实意识到，传统上，像 R 树这样的数据结构用于最近邻查询，而 Oct/Kd/BSP 用于处理静态对象或很少移动对象的碰撞检测问题。

我只是希望那里有其他更好的东西。

我感谢所有的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-25T04:22:54.097

1.  您可以将场景划分为八叉树并利用场景一致性。您正在测试的移动对象将在树的特定节点中针对特定数量的帧，具体取决于其速度。这意味着您可以假设它将在节点中，因此可以快速删除许多不在节点中的对象。当然，棘手的一点是当您的对象靠近分区边缘时，您必须确保更新对象所在的节点。

2.  运动的物体有方向和速度。您可以使用对象移动方向的垂直分割轻松地将场景分成两部分。该分区错误一侧的任何对象都不需要检查。当然要补偿其他物体的速度。因此，如果另一个对象相当慢，您可以轻松地将其从进一步的检查中删除。

3.  始终使用轴对齐的边界框之类的东西来简化您正在测试的任何形状。初始碰撞测试

4.  您可以计算对象与另一个移动对象之间的距离以及速度。如果另一个移动物体以更快的速度沿相同的大致方向移动，您可以将其从检查中排除。

5.  根据对象的形状，还有许多其他优化。圆形或正方形或更复杂的形状都具有您可以在移动时进行的特定优化。

6.  假设某些对象确实停止或可以停止移动，您可以跟踪停止的对象。这些对象可以被视为静态对象，因此检查速度更快，您可以将所有静态优化技术应用于它们。

7.  我知道更多，但我想不出来。好久没做这个了。

当然，这取决于您如何进行碰撞检测。您是否根据速度逐步更新对象的位置并检查它是否是静态的。或者您是否通过挤压形状并找出初始碰撞点来补偿速度。前者对于快速移动的物体需要一小步。后者更复杂，成本更高，但效果更好。此外，如果您要旋转物体，那么事情会变得更加棘手。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T00:23:55.637

Bounding Spheres 可能会帮助您处理许多移动物体；您计算对象的半径平方，并从它的中心跟踪它。如果两个对象中心之间的平方距离小于两个对象的平方半径之和，则可能发生碰撞。一切都是用平方距离完成的；没有平方根。

您可以按对象之间的最小平方距离对最近的邻居进行排序。当然，碰撞检测会变得复杂，对于非球形物体，Bounding Spheres 不一定会为您提供碰撞信息，但它可以很好地修剪您需要比较碰撞的对象树。

当然，您需要跟踪对象的 CENTER；理想情况下，您希望每个对象都是刚性的，以避免重新计算边界球体的大小（尽管重新计算并不是特别困难，特别是如果您使用刚性对象树，每个对象都有自己的边界球体是非刚性的；但它变得复杂）。

基本上，要回答有关数据结构的问题，您可以将所有对象保存在主数组中；我有一组“区域”数组，其中包含对主数组中对象的引用，您可以根据它们的笛卡尔坐标快速将对象分类；“区域”数组的重叠定义至少应为主对象数组中最大对象半径的 2 倍（如果可行；显然会出现对象边界球体缩放与对象数量的问题）。

完成后，您可以通过比较一个区域内所有对象的距离来进行快速碰撞测试；同样，这是区域定义变得重要的地方，因为您正在对区域数量与比较数量进行重大权衡。但是，它更简单一点，因为您的距离比较归结为简单的减法（当然还有 abs() 操作）。

当然，您必须在非球形对象之间进行实际的碰撞检测，这可能很重要，但此时您已经大大减少了潜在比较的数量。

基本上，它是一个两层系统；第一个是区域数组，您可以在其中对场景进行粗略排序。其次，你有你的区域内距离比较；您将在其中对发生碰撞的对象进行基本的碰撞检测和碰撞标记。

这种算法可能有空间在动态区域确定中使用树来平衡您的区域大小，以确保您的区域大小不会因“拥挤”区域而增长过快；但是，这类事情并非微不足道，因为对于不同大小的物体，您对密度的排序变得……至少可以说是复杂的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T01:16:25.983

进行碰撞检测的一种有趣方法是使用在特殊八叉树结构中组织的轴向对齐边界框 (AABB)。AABB 的帮助是因为它们可以非常快速地进行粗略的碰撞计算，因为您最多只需要执行 6 次比较。

您应该对八叉树结构使用一些技巧：

1）节点占据的边界区域应该是普通八叉树的两倍（八叉树将空间划分为无重叠）。因为每个节点应该重叠其相邻节点的一半区域。由于 AABB 只能属于一个节点，因此这种额外的大小和重叠允许它在一个节点中保留更长的时间。

2) 同样在每个节点中 - 并且可能在层次结构的每个级别中 - 您保持与节点邻居的链接。这将涉及大量额外代码，但它允许您在接近 O(1) 时间而不是 O(2logn) 时间的时间内在节点之间移动元素。

如果八叉树占用太多内存，您可以将其更改为使用稀疏八叉树结构，只保留游戏世界中实际包含实体的部分的树。然而，这意味着当实体在世界中移动时，您必须为每一帧执行更多计算。

您可能想尝试而不是八叉树的其他一些想法是使用 kd-tree（我相信这是正确的名称），或者使用 AABB 从下向上构建结构。

KD 树（来自内存）使用轴向对齐的平面划分空间，因此它们非常适合与 AABB 一起使用。

另一个想法不是从上到下强制八叉树生成（从一个包围整个世界的盒子开始），而是从基础实体构建它并构建更大的 AABB，直到最大的一个包含整个世界。虽然我不确定它如何与许多快速移动的实体一起工作。

（我已经有一段时间没有完成这种空间游戏开发编码了。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T09:14:45.400

[RDC](http://lab.polygonal.de/articles/recursive-dimensional-clustering/)可能很有用，尤其是当您的对象稀疏（没有很多交叉点）时。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-25T09:02:36.120

sweep and prune broad phase + gjk narrow phase

# variables - 是否有变量命名约定的简明目录？

> ID：235650
> 
> 赞同：3
> 
> 时间：2008-10-25T00:02:23.433
> 
> 标签：variables, dictionary, naming-conventions, naming, catalog

这些年来，我遇到了许多不同风格的变量名。

当前关于命名约定的维基百科条目相当简单......

我希望看到一个简洁的变量命名约定目录，通过名称/描述来识别它，以及一些示例。

如果某个约定特别受到某个平台社区的青睐，那也值得注意。

我正在把它变成一个社区维基，所以请为每个约定创建一个答案，并根据需要进行编辑。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T00:45:55.640

我见过的最好的命名约定集是在“[代码完整](https://rads.stackoverflow.com/amzn/click/com/0735619670)”一书中，史蒂夫·麦康奈尔（Steve McConnell）有一个关于命名约定和大量示例的精彩部分。他的示例贯穿了不同语言的许多“最佳实践”，但最终由开发人员、开发经理或架构师来决定具体的行动。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T00:54:58.430

[PEP8](http://www.python.org/dev/peps/pep-0008/)是 Python 代码的样式指南，是标准库的一部分，在 Python 社区中比较有影响力。对于加分，除了涵盖 Python 标准库使用的命名约定外，它还提供了一般命名约定的概述。

根据 PEP8：标准库中的变量、实例变量、函数和方法应该使用下划线分隔的小写单词以提高可读性：

```
foo
parse_foo
a_long_descriptive_name 
```

要将名称与保留字区分开来，请附加下划线：

```
in_
and_
or_ 
```

弱私有的名称（不是由 'from M import *' 导入的）以单个下划线开头。使用名称修改强制执行隐私的名称以双下划线开头。：

```
_some_what_private
__a_slightly_more_private_name 
```

Python“特殊”方法的名称以双下划线开头和结尾：

```
__hash__  # hash(o) = o.__hash__()
__str__   # str(o) = o.__str__() 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T00:10:52.217

[Sun在此处](http://java.sun.com/docs/codeconv/html/CodeConventions.doc8.html)发布了 Java 的变量名称约定列表。该列表包括命名包、类、接口、方法、变量和常量的约定。

关于变量状态的部分

> > 除变量外，所有实例、类和类常量都是大小写混合，首字母小写。内部单词以大写字母开头。变量名称不应以下划线 _ 或美元符号 $ 字符开头，即使两者都允许。
> > 
> > 变量名应该简短而有意义。变量名的选择应该是助记符，也就是说，旨在向不经意的观察者表明其使用的意图。应避免使用单字符变量名称，临时“一次性”变量除外。临时变量的常用名称是 i、j、k、m 和 n，表示整数；c、d 和 e 用于字符。

一些例子包括

```
int             i;
char            c;
float           myWidth; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T01:29:24.773

无论您的命名约定是什么，它通常都不允许您轻松区分：

*   实例（通常是私有）变量
*   局部变量（用作参数或函数的局部变量）

我使用基于[不定冠词](http://en.wikipedia.org/wiki/Indefinite_article)(a, an, some) 用于局部变量的命名约定，并且没有用于实例变量的冠词，正如关于[变量前缀](https://stackoverflow.com/questions/111605/what-kind-of-prefix-do-you-use-for-member-variables#111736)的问题中所解释的那样。

因此，前缀（我的方式，或[该问题中列出的](https://stackoverflow.com/questions/111605/what-kind-of-prefix-do-you-use-for-member-variables)任何其他前缀）可以是改进*变量*命名约定的一种方式。

我知道您的问题不仅限于变量，我只是想指出命名约定的那一部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T12:59:45.837

有，Einar Hoest的[“Java 程序员手册” 。](http://phrasebook.nr.no)

他分析了方法名的语法结构和方法体的结构，收集了如下信息：

> **add-[名词]-***这些方法通常有参数并创建对象。他们很少返回字段值。该短语几乎出现在所有应用程序中。

等等......从数百个开源项目中收集。

有关更多背景信息，请参阅他的[SLE08 论文](http://www.nr.no/~einarwh/papers/sle08-hoest-programmers-phrasebook.pdf)。

# string - 在Powershell中的字符串中替换变量的成员

> ID：235651
> 
> 赞同：6
> 
> 时间：2008-10-25T00:02:36.010
> 
> 标签：string, powershell

我在 PowerShell 脚本中有以下字符串表达式：

```
"select count(*) cnt from ${schema}.${table} where ${col.column_name} is null" 
```

模式和表分别解析为 $schema 和 $table 的值。但是，为 ${col.column_name} 提供了一个空字符串。作为字符串替换的一部分，如何在变量的成员中添加点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-25T00:12:33.150

怎么样：

```
"select count(*) cnt from $schema.$table where $($col.column_name) is null" 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T21:06:20.663

我认为您遇到的问题主要与语法有关。如果您有一个名为 $foo 的变量，则 ${foo} 引用同一个变量。因此，您的 sql 字符串中的 ${table} 和 ${schema} 引用可以正常工作。

问题在于 ${col.column_name}。您的变量（我假设）称为 $col，并且有一个名为 column_name 的成员。正如罗伯特和史蒂文都在他们的回答中指出的那样，要引用这一点，您应该使用 $($col.column_name)。通常，$(expression) 将被替换为表达式的值。

允许在变量名中使用大括号的原因是变量名中可以包含不寻常的字符。我建议不要使用 ${} 语法（除非您有令人信服的理由），而是将其替换为直接的 $var 变量引用和 $($var.member) 字符串中的成员引用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-25T00:20:23.990

一种方法是：

```
"select count(*) cnt from $schema.$table where $($col.column_name) is null" 
```

另一种选择是

```
"select count(*) cnt from {0}.{1} where {2} is null" -f $schema, $table, $col.column_name 
```

# c++ - 如何使用 std::signaling_nan？

> ID：235664
> 
> 赞同：7
> 
> 时间：2008-10-25T00:09:16.540
> 
> 标签：c++, visual-c++, floating-point, nan

在查看了关于 SO（[在 C++ 中使用 NaN](https://stackoverflow.com/questions/235386/using-nan-in-c)）的另一个问题后，我开始好奇`std::numeric_limits<double>::signaling_NaN()`。

我无法让signaling_NaN 引发异常。我想也许通过发出信号它真的意味着一个信号，所以我尝试捕捉 SIGFPE 但不......

这是我的代码：

```
double my_nan = numeric_limits<double>::signaling_NaN();
my_nan++;
my_nan += 5;
my_nan = my_nan / 10;
my_nan = 15 / my_nan;
cout << my_nan << endl; 
```

`numeric_limits<double>::has_signaling_NaN`评估为真，所以它在我的系统上实现。

有任何想法吗？

我正在使用 ms visual studio .net 2003 的 C++ 编译器。我回家后想在另一个上测试它。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T06:45:51.280

您可以使用该[`_control87()`](http://msdn.microsoft.com/en-us/library/e9b52ceh.aspx)函数来启用浮点异常。从 MSDN 文档中`_control87()`：

> 笔记：
> 
> 默认情况下，运行时库会屏蔽所有浮点异常。

启用浮点异常后，您可以使用[`signal()`](http://msdn.microsoft.com/en-us/library/xdkz3x12.aspx)或[SEH（结构化异常处理）](http://msdn.microsoft.com/en-us/library/ms680657(VS.85).aspx)来捕获它们。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-26T02:17:18.503

一个警告：使用第 3 方 DLL 可能会默默启用这些异常。对于加载以默认启用它们的语言编写的 DLL 尤其如此。

我在两种情况下发生过这种情况：从嵌入式浏览器控件打印到 HP 打印机，以及从用 Delphi 编写的 InnoSetup 注册我的 DLL（将一些初始值设置为 NaN）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T00:18:10.953

来自[TFM](http://msdn.microsoft.com/en-us/library/hf16y784.aspx)：

```
cout << "The signaling NaN for type float is:  "
    << numeric_limits<float>::signaling_NaN( )
    << endl; 
```

->

> 浮点类型的信号 NaN 是：1.#QNAN

其中“Q”代表“安静”。不知道为什么它会返回它，但这就是它不会为你抛出异常的原因。

出于好奇，这会更好吗？

```
const double &real_snan( void )
{
    static const long long snan = 0x7ff0000080000001LL;
    return *(double*)&snan;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T17:19:05.283

关键在于[`numeric_limits<T>::has_signaling_NaN`](http://msdn.microsoft.com/en-us/library/1b2b997k%28VS.80%29.aspx)。这对你有什么价值？（MSDN 似乎暗示它总是`false`适用于 MSVC？）

# asp.net - 跨重定向使用 Asp.Net MVC TempData 时是否存在可能的“竞争条件”？

> ID：235665
> 
> 赞同：16
> 
> 时间：2008-10-25T00:10:26.960
> 
> 标签：asp.net, asp.net-mvc, redirect, tempdata

使用 TempData 时，我的理解是它只会为一个请求保留您放入其中的任何内容。因此，当使用 TempData 跨重定向保留数据时（为了使用 Post-Request-Get 模式），是否有可能来自用户的其他一些请求可能会在发送重定向的响应和发送重定向的响应之间进入服务器？用户的浏览器请求重定向到的页面？在这种情况下，get 将不再有可用的 TempData，对吗？

现在，我知道发生这样的事情非常罕见，但考虑到用户可能在另一个选项卡中打开了另一个页面，并且该页面上可能发生了 ajax 或定时回调请求，它突然不会在我看来这一切都是不可能的。它只是通常被认为太遥远而无法担心，还是我误解了什么？

编辑：更具体地说明我所询问的场景。

1.  在 Tab 1 中，用户浏览到带有帖子表单的页面
2.  在选项卡 2 中，用户浏览到网站上的另一个页面，该页面在计时器上执行 ajax 回调
3.  在选项卡 1 中，用户将表单发布到服务器
4.  当服务器收到帖子时，它会在 TempData 中保存一些数据并发送回重定向响应
5.  在选项卡 2 中，发生了定时 ajax 回调，向服务器发送 GET 请求。TempData 已从会话中删除
6.  在选项卡 1 中，浏览器接收重定向并发出 GET 请求
7.  服务器处理 GET 请求并查找 TempData，但它不再存在

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-25T02:31:02.027

好吧，浏览 ASP.NET MVC 代码显示，虽然 TempData 存储在会话中，但在加载时从会话中删除。它被加载到控制器的 ExecuteCore() 方法中。

所以我认为这意味着是的，你完全可能会遇到竞争条件，来自不同浏览器选项卡的请求（你有一个很好的例子）可能会导致这个问题。但这取决于每个浏览器处理请求的模型。浏览器可能会将所有请求序列化到同一服务器，以便一次只执行一个。实际上，他们不会这样做，但是，他们会将其限制为（我认为）对同一服务器的 5 个并发请求的最大值。

鉴于 ASP.NET MVC 站点可能是对任何浏览器的服务请求（毕竟是网络 :)），它是一个真实的场景，尽管可能很少见，正如您所说。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-27T00:43:23.343

使用 TempData 时完全有可能出现竞争条件。但是，您当然必须“不幸”才能在正常使用下体验它。为了进入竞争条件，以下条件必须全部为真：

1.  您必须首先使用 TempData。
2.  您必须打开多个浏览器窗口/选项卡/任何内容并共享相同的浏览器会话。
3.  来自第二个浏览器选项卡的请求必须“潜入”在第一个浏览器选项卡的请求和响应之间。

请注意，第 2 项很大程度上取决于您使用的浏览器。取决于您如何设置 IE，仅仅因为您打开了多个窗口并不意味着它们共享浏览器 cookie，因此它们不一定共享会话（基于 cookie）。

但是，从某种意义上说，如果遇到某些东西会爆炸，则不存在竞争条件。这可能就是 Haacked 所指的。但是，您*可能会*遇到竞争条件，即您在一个请求中设置了一些 TempData，然后在您*认为*会得到它的下一个请求中没有将其取回。它只会是空的。

谢谢，艾隆

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T00:42:06.723

TempData 使用 Session 对象，它不会遇到这个问题，AFAIK。你遇到过这个具体的问题吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-06T07:25:37.983

我认为这永远不会发生，尽管一开始我也有同样的困惑。想想如果你在调试模式下运行你的 mvc web 应用程序，那么你在重定向操作中设置一个断点。然后你给 tempdata 一个值，然后你会在redirect viewResult和other view中得到tempdate，你会发现在redirect action完成之前，其他请求永远不会被响应。那么这是什么意思？它说mvc应用程序以单线程模式运行，它可以处理一个一次请求一次。所以你提到的上述场景永远不会发生。

# vim - 如何在 Windows 系统的 gVim 中添加字体

> ID：235671
> 
> 赞同：22
> 
> 时间：2008-10-25T00:13:24.083
> 
> 标签：vim, unicode, fonts, cjk

我想在 Gvim 中添加一个 UTF-8 字体，但我不知道怎么做。我尝试按照本手册中的步骤进行操作，但仍然无效。 [http://www.inter-locale.com/whitepaper/learn/learn_to_type.html](http://www.inter-locale.com/whitepaper/learn/learn_to_type.html)（页面中间的vim部分）

谁能告诉我如何在 Vim 中添加字体以便显示日文字符？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-28T16:22:16.630

正如其他人所说，您必须使用固定宽度的字体。Vim 是一个文本编辑器，而不是一个所见即所得的编辑器。

如果您有一个包含所需字符的固定宽度字体，那么：

```
:set guifont=* 
```

选择您要使用的字体、大小等。一旦您对它感到满意，请执行以下操作：

```
:set guifont? 
```

并将输出当前设置的值。把它`set guifont=foo`放在你的`.gvimrc`（或`.vimrc`用`if has("gui_running")`块里）。

```
set guifont=<C-R>=&guifont<CR> 
```

这会将当前值放入文件中。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2011-01-28T12:13:08.940

对于 Windows，我发现使用[guifontwide](http://vimdoc.sourceforge.net/htmldoc/options.html#%27guifontwide%27)设置提供了预期的功能（即混合字符显示：同一文件中的日文、中文和英文）。这在 Vim 帮助文件中既不直观也不明显（至少对我来说不是！），但是在你的启动设置中有这样的东西会起作用：

```
set guifont=Consolas:h10 
set guifontwide=MingLiU:h10 "For windows to display mixed character sets
set encoding=utf-8 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-25T21:03:32.427

引用[vim 文档](http://vimdoc.sourceforge.net/htmldoc/usr_45.html#45.1)：

> 对于 MS-Windows，某些字体的 Unicode 字符数量有限。尝试使用“Courier New”字体。您可以使用 Edit/Select Font... 菜单来选择并试用可用的字体。但是只能使用固定宽度的字体。例子：

```
 :set guifont=courier_new:h12 
```

所以，我想，除非你找到一个包含你想要显示的字符的固定宽度字体，否则你就不走运了。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-01-30T21:05:34.173

这是我用的...

```
set gfn=MingLiU:h16:cDEFAULT
set fenc=utf-8
set encoding=utf-8 
```

把它放在你的 _vimrc 文件中，退出并重新打开。对我来说就像一个魅力。+T

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-25T05:48:08.057

在 Windows 下，您必须为 Gvim 使用固定宽度的字体。

Vim Tips Wiki 上有几个相关页面：

*   [使用 Unicode](http://vim.wikia.com/wiki/Working_with_Unicode)
*   [设置guifont](http://vim.wikia.com/wiki/Setting_the_font_in_the_GUI)
*   [完美的编程字体](http://vim.wikia.com/wiki/The_perfect_programming_font)

# java - 什么是java信号调度线程？

> ID：235674
> 
> 赞同：12
> 
> 时间：2008-10-25T00:17:14.653
> 
> 标签：java, multithreading

我正在查看 java 进程的线程转储，并注意到一些线程被信号调度程序阻塞。

什么是信号调度器？它有什么作用？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-25T00:29:16.813

我在 IBM developerWorks 上找到了一篇关于此的文章。当操作系统向 JVM 发出信号时，信号调度线程会将信号传递给适当的处理程序

IBM 软件工程师 Chris White[关于 Java 信号处理和终止的启示](https://web.archive.org/web/20090214230330/http://ibm.com:80/developerworks/java/library/i-signalhandling)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-25T03:56:09.080

操作系统信号本质上是单线程的，因此它们都在同一个线程上处理很重要。因此，调度程序是实现这一目标的自然方式。可以把它想象成 AWT 的单个 GUI 事件线程。

顺便说一句，如果您是 Linux 并且您的 JVM 加载了一个插入自己的信号处理程序的本机库，那么您将需要预加载[libjsig.so](http://java.sun.com/j2se/1.4.2/docs/guide/vm/signal-chaining.html)。当第三方网络库断断续续地断开我与被误导的 sigpipes 的连接时，我发现了一种艰难的方式。

# java - 转换实现相同接口的类的快速方法

> ID：235685
> 
> 赞同：2
> 
> 时间：2008-10-25T00:31:38.023
> 
> 标签：java, design-patterns

在 Java 中，如何快速（或一般地）将一个实现接口的类转换为另一个实现相同接口的类？

我的意思是，如果他们是 POJO，一个类设置器应该将其他类获取器作为参数。

这种情况有模式吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T00:37:53.363

Apache Bean Utilities 包为此提供了一个工具。

```
org.apache.commons.beanutils.BeanUtils
    .BeanUtils.copyProperties

public static void copyProperties(Object dest, Object orig)
                       throws IllegalAccessException,
                              InvocationTargetException

Copy property values from the origin bean to the destination bean for all cases where the property names are the same.

For more details see BeanUtilsBean.

Parameters:
    dest - Destination bean whose properties are modified
    orig - Origin bean whose properties are retrieved 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T00:37:06.190

我相信这种情况的模式称为[Proxy](http://en.wikipedia.org/wiki/Proxy_pattern)：

> 代理，在其最一般的形式中，是一个类，作为另一个事物的接口。另一件事可能是任何东西：网络连接、内存中的大对象、文件或其他一些昂贵或无法复制的资源。

# sql - 是否可以更改 SQL 用户定义的数据类型？

> ID：235690
> 
> 赞同：2
> 
> 时间：2008-10-25T00:37:42.070
> 
> 标签：sql, sql-server, sql-server-2005, alias-data-type

我有一堆使用 PK 列的用户定义数据类型的表。是否可以使用 SQL Server 2005 更改此类型？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T00:52:52.227

我建议始终可以重构糟糕或过时的数据库设计，这仅取决于您愿意为此付出多少工作。

如果您希望用代理键替换用户定义的数据，那么您应该能够简单地更改现有表以包含不可为空的标识列，这应该会导致所有现有记录自动分配一个新键.

使用唯一 ID 填充新字段后，如果您需要移出并替换对该表的外键引用，那么我只需更改这些表以包含新字段并使用如下内容：

```
UPDATE child_table 
SET new_fk_val = 
    SELECT new_pk_val 
    FROM parent_table
    WHERE parent_table.old_pk_val = child_table.old_fk_val 
```

完成该步骤后，您可以删除旧的外键约束，删除旧的外键列，删除旧的主键列，建立新的主键约束，然后建立新的外键约束。

当然，如果旧版本的父子表关系导致子表中有无效记录，则可能必须执行以下操作：

```
DELETE FROM child_table 
WHERE old_fk_val NOT IN 
    ( SELECT old_pk_val FROM parent_table) 
```

# asp.net - 如何配置 IIS 6.0 以同时使用默认内容页面和通配符应用程序映射

> ID：235694
> 
> 赞同：2
> 
> 时间：2008-10-25T00:39:12.377
> 
> 标签：asp.net, iis

在我的文件系统中

```
    /文件.aspx
    /目录/default.aspx

```

我想配置 IIS，使其返回适当的文件（添加 aspx 扩展名）或目录（默认内容页面），如下所示：

```
    /文件-> /文件.aspx
    /目录-> /目录/default.aspx
    /directory/ -> /directory/default.aspx

```

我已将通配符应用程序映射集配置为 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll。当“验证该文件是否存在”未选中时，文件请求有效，但目录请求无效（返回 404）。选中“验证该文件是否存在”时，目录请求有效，但文件请求无效。

如何配置它以便文件和目录请求都可以工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T23:18:48.190

我推荐使用 UrlRewriter：

[http://urlrewriter.net/](http://urlrewriter.net/)

这使您可以创建所需的所有以上映射。您必须做的一件事（如果您使用的是 IIS 6 或更早版本）是配置 IIS，以便所有扩展都由 asp.net 处理。该文档解释了如何执行此操作。然后，您以正则表达式的形式在 web.config（或我使用的单独的 rewriter.config）中创建一堆规则来创建映射。

顺便说一句，对于上面的例子，你可能不需要对最后两条规则做任何事情。IIS 会自动处理这些。对于第一条规则，它将类似于：

```
<rewrite url="^/file$" to="/file.aspx" /> 
```

您可以变得更聪明并编写通用规则，这样您就不必为每个文件编写一个规则。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T00:40:39.287

您必须添加将 / 请求映射到 default.aspx 的 ASP.NET global.asax 或 HttpModule。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T15:30:55.637

我查看了 url 重写，但最终决定采用更简单的解决方案。我只是将 file.aspx 移到一个目录中并将其重命名为 default.aspx。

# javascript - 将 jquery 幻灯片效果转换为 mootools

> ID：235695
> 
> 赞同：1
> 
> 时间：2008-10-25T00:40:33.060
> 
> 标签：javascript, jquery, mootools, slider

当人们单击选项卡时，我有一个脚本可以从菜单后面向下滑动 div。但是它在 jquery 中，我想使用 mootools（很多原因我不会在这里讨论）。但是我目前坚持使用 mootools 1.1。但由于某种原因，我的尝试不起作用:(

html

```
print("code sample");
   <div id="panel">
    <form action="">
           < form here > 
    </form>
</div>
<div class="slide">
  <p class="sl"><a href="#" class="btn-slide" id="toggle"><span></span></a></p> 
```

div id面板包含向下滑动的表单，div类滑动，P标签被一个通过css悬挂的选项卡/按钮替换，单击此选项卡向下滑动。

jquery（工作正常）

```
print("code sample");
  <script type="text/javascript">
  $j(document).ready(function(){
$j(".btn-slide").click(function(){
    $j("#panel").slideToggle("slow");
    $j(this).toggleClass("active"); return false;
});

  });
  </script> 
```

我的哞尝试

```
print("code sample");
 <script type="text/javascript">
window.addEvent('domready', function(){
 var mySlide = new Fx.Slide('panel');
    $('toggle').addEvent('click', function(e){
        e = new Event(e);
        mySlide.toggle();
        e.stop();
    });
});
 </script> 
```

就像我上面所说的，我目前仅限于 moo 1.1，但如果有一个适用于 1.1 和 1.2 的答案，或者如果它有类似的变化，我会很高兴听到，因为它会在某个时候更新。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-27T14:24:57.167

这应该在 1.11 和 1.2 中都有效：

```
window.addEvent('domready', function() {
    var mySlide = new Fx.Slide('panel');
    $('toggle').addEvent('click', function(e) {
        e = new Event(e); // this isn't needed in 1.2
        e.stop();
        mySlide.toggle();
        this.toggleClass('active');
    });
}); 
```

但是，在 MooTools 1.2 及更高版本中，Fx.Slide 不包含在核心中 - 您必须将其作为[MooTools More](http://mootools.net/more)的一部分下载。

一个工作演示：http: [//jsbin.com/ewasa](http://jsbin.com/ewasa)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:51:35.463

这行得通吗？

```
function toggleSlide(){
    var theSlider = new Fx.Slide('slide');
    $('theSlide').addEvent('click', function(e){
        e = new Event(e);
        theSlider.toggle();
        e.stop();
    });
} 
```

# .net - System.Windows.Forms.WebBrowser.Refresh 显示上一页

> ID：235700
> 
> 赞同：0
> 
> 时间：2008-10-25T00:44:49.357
> 
> 标签：.net, winforms, webbrowser-control

我的 WinForms 应用程序有一个带有`System.Windows.Forms.WebBrowser`控件的选项卡。有几个控件可以设置 WebBrowser 的`.Url`属性，当窗体重新绘制时，它会调用 WebBrowser 的`.Refresh(WebBrowserRefreshOption.Completely)`方法。

但是，有时会重新绘制表单并且 WebBrowser 内容不会改变。我打破了`.Refresh( )`,`.Url`是以前的 Url。这是怎么回事？

根据[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.url.aspx)：

> 如果设置此属性的值，然后立即再次检索它，如果 WebBrowser 控件没有时间加载新文档，则检索到的值可能与设置的值不同。

那不是很特别吗？为什么不`.Refresh( )`等到控件“有时间加载新文档”后再重绘呢？有没有办法强迫这种情况发生？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T01:05:24.603

除非您正在做一些非常特别的事情，否则强制 WB 重新绘制自己是没有意义的。因为它是它自己的控件并且有它自己的Handle，它非常有能力在它认为有必要的时候重新绘制自己。由于您强制它在与其 ReadyState 完全不同步的时刻重新绘制，因此可以预期得到一个“旧”的 url。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T00:51:02.650

尝试将事件处理程序添加到在“DocumentCompleted”事件触发时运行的代码中。然后在其中添加您的刷新代码。MSDN 中有一些代码示例。如果您这样做，您将不会浪费任何时间来猜测页面是否已加载，并且一旦准备好就可以继续处理。

[http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.documentcompleted.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.documentcompleted.aspx)

# windows - Windows 中的 Mercurial 应该使用哪种合并工具？

> ID：235711
> 
> 赞同：14
> 
> 时间：2008-10-25T00:55:16.620
> 
> 标签：windows, mercurial, merge

我刚开始使用 Mercurial，我应该做的一件事就是选择一个合并工具。我正在考虑为此目的使用 WinMerge，但我找不到特别选择它的方法。有所有其他合并工具的参考，但没有 WinMerge。

所以，我应该使用 WinMerge 还是有更好的工具来完成这项工作（请记住，我使用的是 Windows）。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-25T01:04:06.400

看看kdiff3： http: [//kdiff3.sourceforge.net/](http://kdiff3.sourceforge.net/)

它最初是为 KDE/linux 设计的，但已移植到 Windows。它将非常智能地区分/合并多达 3 个文件，它在突出差异和建议如何合并文件方面做得很好，而且它和人们希望的一样直观。

祝你好运！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-25T01:21:02.387

[Beyond Compare](http://www.scootersoftware.com)是比较/合并工具的黄金标准。我已经使用过它以及提到的许多免费的，可以告诉你它值 50 美元。

他们有一个页面[在这里](http://www.scootersoftware.com/support.php?zz=kb_vcs.php)讨论各种 SCM 包的配置。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-25T01:19:04.823

[WinMerge](http://winmerge.org/Wiki/Mercurial)很好用...

**编辑：**这可能有用：

*   [Mercurial 合并计划](https://www.mercurial-scm.org/wiki/MergeProgram)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-25T01:12:07.303

我使用了免费的[DiffMerge](http://www.sourcegear.com/diffmerge/ "差异合并")。

查看[屏幕截图](http://www.sourcegear.com/diffmerge/screenshots.html)以了解其工作原理，我发现界面非常直观。

祝你好运！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-19T01:40:04.970

我使用 p4merge。 [http://www.perforce.com/perforce/products/merge.html](http://www.perforce.com/perforce/products/merge.html)

它很漂亮而且很清楚。

[这里](http://markmail.org/message/hyodqao763gzbypq)显示了如何配置。

# ruby - 从 Ruby 打开 RSA 私钥

> ID：235759
> 
> 赞同：6
> 
> 时间：2008-10-25T01:47:16.563
> 
> 标签：ruby, encryption, openssl, encryption-asymmetric

我*想*我知道如何创建自定义加密的 RSA 密钥，但是如何读取像 ssh-keygen 那样加密的密钥呢？

我知道我可以这样做：

```
OpenSSL::PKey::RSA.new(File.read('private_key')) 
```

但是后来 OpenSSL 要求我输入密码......我怎样才能将它作为参数传递给 OpenSSL？

而且，我怎样才能创建一个与 ssh-keygen 生成的兼容的？

我做这样的事情来创建私人加密密钥：

```
pass = '123456'
key = OpenSSL::PKey::RSA.new(1024)
key = "0000000000000000#{key.to_der}"
c = OpenSSL::Cipher::Cipher.new('aes-256-cbc')
c.encrypt
c.key = Digest::SHA1.hexdigest(pass).unpack('a2' * 32).map {|x| x.hex}.pack('c' * 32)
c.iv = iv
encrypted_key = c.update(key)
encrypted_key << c.final 
```

此外，由 OpenSSL::PKey::RSA.new(1024) 生成的密钥（未加密）在我尝试无密码登录时不起作用（即，我将公钥复制到服务器并使用私钥登录）。

此外，当我通过 OpenSSL 打开一个 ssh-keygen 文件然后检查其内容时，它似乎在密钥的开头和结尾有其他字符。这是正常的吗？

我不太了解其中的一些安全知识，但我正在努力学习。我做错了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-14T07:58:11.933

根据这里的博客文章：

[http://stuff-things.net/2008/02/05/encrypting-lots-of-sensitive-data-with-ruby-on-rails/](http://stuff-things.net/2008/02/05/encrypting-lots-of-sensitive-data-with-ruby-on-rails/)

你可以简单地做：

OpenSSL::PKey::RSA.new(File.read('private_key'), 'passphrase')

祝你好运。

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2008-10-25T03:32:12.683

我在这方面取得了一些进展。如果我使用 Net::SSH 库，我可以这样做：

```
Net::SSH::KeyFactory.load_private_key 'keyfile', 'passphrase' 
```

通过阅读源代码，我还没有弄清楚库对 OpenSSL 的 PKey::RSA.new 做了什么来完成这个......然后我再次测试，果然，OpenSSL 可以很好地打开私钥而无需Net::SSH ...我做了很多测试，以至于我以前没有正确测试过。

但是我仍然有创建 SSH 兼容密钥对的问题......也许我会再次测试并得到答案：P......不，我对那部分不感兴趣

# c++ - 如何在 C 中限制套接字连接的带宽？

> ID：235762
> 
> 赞同：25
> 
> 时间：2008-10-25T01:54:16.393
> 
> 标签：c++, c, sockets, network-programming

我正在使用 BSD 套接字编写客户端-服务器应用程序。它需要在后台运行，不断传输数据，但不能占用正常使用的网络接口带宽。根据接口的速度，我需要将此连接限制到某个最大传输速率。

以编程方式实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-25T02:12:51.923

每次传输后持续休眠 1 秒的问题是您的网络性能会不稳定。

令 BandwidthMaxThreshold 为所需的带宽阈值。

令 TransferRate 为连接的当前传输速率。

然后...

如果您检测到您的 TransferRate > BandwidthMaxThreshold，那么您执行 SleepTime = 1 + SleepTime * 1.02（将睡眠时间增加 2%）

在每次网络操作之前​​或之后做一个 Sleep(SleepTime)

如果您检测到您的 TransferRate 比您的 BandwidthMaxThreshold 低很多，您可以减少您的 SleepTime。或者，您可以始终随着时间的推移衰减/减少您的睡眠时间。最终，您的 SleepTime 将再次达到 0。

除了增加 2% 之外，您还可以线性增加 TransferRate - BandwidthMaxThreshold 之间的差值。

这个解决方案很好，因为如果用户的网络已经没有你想要的那么高，你将没有睡眠。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-25T13:10:31.197

最好的方法是使用[令牌桶](http://en.wikipedia.org/wiki/Token_bucket)。

仅当您有足够的令牌来填充数据包时才发送（1460 字节将是一个很好的数量），或者如果您是接收方，则仅当您有足够的令牌时才从套接字读取；*一些简单的数学运算会告诉您在获得足够的令牌之前必须等待多长时间，这样您就可以睡这么长的时间（小心计算您实际*睡眠的时间获得了多少令牌，因为大多数操作系统都可以让你的进程睡眠的时间比你要求的要长）。

要控制爆发的大小，请限制您可以拥有的最大代币数量；很多可能是一秒钟的代币。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-25T03:29:46.840

我在[涓涓细流](http://monkey.org/~marius/trickle/)方面运气不错。这很酷，因为它可以在不修改的情况下限制任意用户空间应用程序。它通过预加载自己的发送/接收包装函数来工作，这些函数会为您计算带宽。

我发现的最大缺点是很难协调您想要共享有限带宽的多个应用程序。“涓涓细流”有帮助，但我发现它很复杂。

2017 年更新：看起来涓涓细流已移至[https://github.com/mariusae/trickle](https://github.com/mariusae/trickle)

# c++ - 取消 libcurl 简易句柄

> ID：235763
> 
> 赞同：5
> 
> 时间：2008-10-25T01:55:04.783
> 
> 标签：c++, c, multithreading, curl, libcurl

有没有一种简单的方法可以从另一个线程中取消 curl_easy_perform ？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-25T02:06:52.980

您必须使用回调函数（写入/读取/进度）来执行取消。另一个线程需要设置一个标志，回调函数检查标志并返回适当的值以取消操作。

# java - 我想要一个带有嵌入式编译器并在 linux 下工作并且不需要大量 ram 的 java 编辑器

> ID：235766
> 
> 赞同：-1
> 
> 时间：2008-10-25T02:01:17.360
> 
> 标签：java, compiler-construction, editor

我想要一个带有 Linux 编译器的 Java IDE，并且不需要大量的 RAM。我有 256 MB 的内存，所以我的选择有限

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T02:58:42.907

Eclipse 将是您想要的最后一件事。我可以推测你可能已经从标题中尝试过了。对于占用空间小的我建议使用 JEdit。它更小、更成熟且可扩展。如果你运行 KDE，还有 Kate。虽然它没有嵌入式编译器支持，但您可以添加一个作为外部命令。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T03:05:47.887

“IDE”是什么意思。

您可以将 Emacs 与这种内存脚印一起使用，将 Ant 用于构建，并且 emacs 将允许您在编辑器中进行调试，还可以带您编译错误......

但它不会有 GUI 开发组件。

有关将 Emacs 用作全功能 Java IDE 的更多详细信息，请阅读此 IBM 文档：

[http://www.ibm.com/developerworks/java/library/j-emacs/](http://www.ibm.com/developerworks/java/library/j-emacs/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T02:51:09.507

在我的第一门编程课程中，我们使用[BlueJ](http://www.bluej.org)作为我们的“IDE”。真的很基本，但可以完成工作。老实说，它没有很多功能，但它是轻量级、可移植和有效
的。虽然你必须将它与外部编译器链接，但如果你已经在这台计算机上使用 Java 进行开发，这应该不是问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T05:26:00.100

jEdit will work easily.

Eclipse 1.x will work in that amount of RAM. Depending on your version of java, Eclipse 1.x will definitely work in that RAM.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T02:16:36.003

256MB 的 RAM 是否还包括程序空间，或者代码是否会存储在闪存或其他存储器类型的其他地方？

您可以获得可嵌入的 Java 机器和用于 linux 的小型 Java 编译器。然而，IDE 很棘手，因为您不只是说编辑器，而是想要一个完整的集成环境。

由于您已经安装了 Java，我建议您使用 Eclipse。它在 PC 上看起来体积庞大且资源密集，但您可以通过删除您不想要/不需要的功能（类）来显着减少它。

-亚当

# hash - 是否存在 md5(x) == x 的 MD5 固定点？

> ID：235785
> 
> 赞同：115
> 
> 时间：2008-10-25T02:21:51.267
> 
> 标签：hash, md5

MD5 变换中是否存在固定点，即是否存在 x 使得`md5(x) == x`?

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2008-10-25T04:34:57.737

由于 MD5 和的长度为 128 位，因此任何固定点也必须是 128 位长。假设任何字符串的 MD5 和均匀分布在所有可能的和上，那么任何给定的 128 位字符串是不动点的概率是¹ */* [2 ^(128)]。

因此，没有 128 位字符串是不动点的概率为 (1 - ¹ */* [2 ^(128)] ) ^(2 ^(128))，因此存在不动点的概率为 1 - (1 - ¹ */* [2 ^(128)] ) ^(2 ^(128))。

^(由于 (1 − 1) */* [n] ) ^n的 n 趋于无穷大的极限是¹ */* [*e*]，并且 2 ^(128)肯定是一个非常大的数字，所以这个概率几乎正好是 1 − ¹ */* [*e*] ≈ 63.21%。

当然，实际上并不涉及随机性——要么有一个固定点，要么没有。但是，我们可以有 63.21% 的把握有一个固定点。（另外，请注意，这个数字不取决于密钥空间的大小——如果 MD5 和是 32 位或 1024 位，则答案将是相同的，只要它大于大约 4 或 5 位）。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2015-03-09T12:09:10.483

我的蛮力尝试找到了 12 个前缀和 12 个后缀匹配。

前缀 12：54db1011d76dc70a0a9df3ff3e0b390f -> 54db1011d76d137956603122ad86d762

后缀 12：df12c1434cec7850a7900ce027af4b78 -> b2f6053087022898fe920ce027af4b78

博文：https: [//plus.google.com/103541237243849171137/posts/SRxXrTMdrFN](https://plus.google.com/103541237243849171137/posts/SRxXrTMdrFN)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-25T02:24:13.337

由于哈希是不可逆的，因此很难弄清楚。解决这个问题的唯一方法是计算散列的每个可能输出的散列，看看你是否想出了一个匹配项。

详细地说，一个 MD5 散列中有 16 个字节。这意味着有 2^(16*8) = 3.4 * 10 ^ 38 种组合。如果计算一个 16 字节值的哈希值需要 1 毫秒，那么计算所有这些哈希值需要 10790283070806014188970529154.99 年。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-23T01:40:10.463

虽然我没有是/否的答案，但我的猜测是“是”，而且可能有 2^32 个这样的固定点（用于位串解释，而不是字符串解释）。我正在积极研究这个问题，因为它看起来是一个很棒的、简洁的谜题，需要大量的创造力（如果你不立即满足于蛮力搜索的话）。

我的方法如下：将其视为数学问题。我们有 128 个布尔变量和 128 个根据输入（应该匹配）来描述输出的方程。通过插入算法表中的所有常量和填充位，我希望方程可以大大简化，以产生针对 128 位输入情况优化的算法。这些简化的方程然后可以用一些很好的语言编程以进行有效的搜索，或者再次抽象地处理，一次分配单个位，注意矛盾。您只需要查看输出的几位就知道它与输入不匹配！

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-25T02:24:03.023

可能，但发现它需要比我们更长的时间，或者会涉及妥协 MD5。

* * *

## 回答 #6

> 赞同：-8
> 
> 时间：2009-05-06T15:32:34.790

有两种解释，如果任一种选择，找到固定点的概率增加到 81.5%。

*   **解释1：二进制**MD5输出的MD5是否匹配其输入？
*   **解释2：十六进制**的MD5输出的MD5是否匹配其输入？

* * *

## 回答 #7

> 赞同：-23
> 
> 时间：2009-05-06T15:29:02.520

严格来说，由于 MD5 的输入是 512 位，输出是 128 位，我会说从定义上来说这是不可能的。

# process - 在决定一个功能时，你会做什么？

> ID：235787
> 
> 赞同：2
> 
> 时间：2008-10-25T02:24:08.250
> 
> 标签：process, software-design

您主要考虑实施它的原因，还是不实施它的原因？各有什么优势？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T09:39:59.787

这篇[精美的 Joel Spolsky 帖子](http://www.joelonsoftware.com/articles/SetYourPriorities.html)基本上说：

1.  列出可能的特征。
2.  投票过滤掉最差的功能。
3.  为每个功能分配成本。
4.  为每个参与者分配有限的功能预算。
5.  在分配预算时找出哪些功能很受欢迎。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T02:32:25.223

我首先考虑的是利益相关者（客户）。
该功能会帮助*他*吗？它确实是带来价值的功能特性吗？

然后我考虑技术影响和由此产生的复杂性，以评估实现成本与不具有该功能之间的权衡。

基于这两个反射的首要元素，我可以开始知道我是否必须实施它。

我想在执行或不执行它的原因之间没有明确的界限。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T02:32:46.843

我通常会进行成本效益分析。实施这将花费多少（金钱或时间）以及收益价值多少（再次金钱或时间）。

如果收益远远超过成本，那么它就完成了。

衡量标准通常是有偿工作的钱，个人物品的时间，尽管有时会有交叉。不管桌上有多少钱，我都不会牺牲太多与孩子们在一起的美好时光。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T06:34:19.183

很多时候，我们被要求加入某个功能。我的部分工作是能够在认为他们一直知道要包含什么内容的用户的上下文中解释这一点。当然，他们知道*自己*想要什么，但你可以打赌其他人想要一些稍微不同的东西。在我的世界里，重要的是我们可以提前一步思考并交付更多。我们的报酬是思考业务如何运作并为他们提供服务。

因此，我想出了添加一些更强大的东西的策略，然后也提供用户想要的东西。因此，当其他人要求某物时，它已经在那里了。这可以节省大量昂贵的交付周期。

不幸的是，这并不总是可用或实用的，但如果可能的话，我喜欢这样做。我喜欢以编码应该是*主动*的而不是*被动*的为座右铭。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T02:46:00.703

我认为考虑利弊很重要，最终结果是成本效益分析。

根据提出新功能的产品类型，该分析的前景可能会发生很大变化。我的很多工作都是在大型复杂应用程序上，这些应用程序随着时间的推移而发展，是我客户业务的核心。

因此，对新特性的大量分析都集中在为什么不实现一个特性上；我将主要关注风险：

*   引入新功能的区域的架构如何？
*   已经实施的单元测试水平如何？
*   新功能是否在应用程序的核心实现？
*   如果我们遗漏了某些东西并且错误出现在野外会发生什么，它是否会导致系统崩溃（无论是从字面上还是通过有效地使系统不适合其目的）

归根结底，是否开发新功能由客户决定。作为专业的软件开发人员，我们有责任告知他们可能的成本，这些成本可能对他们来说是不可见的，超出了赤裸的金钱和时间。

令人高兴的另一面是，我们也有责任提出他们可能认为甚至不可能的新功能！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-25T06:37:13.607

应该是客户/客户/利益相关者/消费者应该推动需要的功能。客户可以是现实世界的用户（您正在交付的单个公司或个人），也可以不是（您正在为其制造产品的市场）。但无论哪种方式，它都必须来自最终用户。

我们将所有新功能称为“用户故事”。

您当然需要做的是了解用户**为什么**想要该功能 - 用户试图解决的问题或想要获得的优势是什么。在了解“如何”之前，您需要从用户那里获得“为什么”部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-25T03:24:41.890

幻想决策问题：是否`feature`提高`product`了做它特别适合做的事情的能力？如果是，执行`feature`，否则不执行。

现实决策问题：我们是否有足够的资金来证明实施的合理性`feature`？不？废话。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-25T02:34:56.310

客户可以决定功能。如果我想到什么，我就由客户来管理它。我们一起找出如何让客户最重要的功能尽快实施。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-06T23:11:29.233

如果某项功能可以帮助用户更快地完成某项任务或通过更多知识完成某项任务，则实施该功能。如果它会帮助用户，请实施它，如果它使您的应用程序看起来更好但并不能真正帮助用户使用应用程序（只是看起来不错），那么不要实施它。

# windows-vista - vbscript 检测 UAC 是否升高

> ID：235822
> 
> 赞同：7
> 
> 时间：2008-10-25T03:12:18.683
> 
> 标签：windows-vista, vbscript, windows-server-2008, uac

我的 vbscript 如何检测它是否在 UAC 提升的上下文中运行？

我检测用户并查看用户是否在管理员组中没有问题。但这仍然不能回答在 Vista 或 Windows 2008 下运行时进程是否提升了 privs 的问题。请注意，我只需要*检测*此状态；不要试图提升或（错误..）去提升。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-03T07:35:59.023

我最终确定的方法取决于 Vista 和 Windows 2008 都有 whoami.exe 实用程序，它会检测拥有该进程的用户的完整性级别。一些屏幕截图在这里有所帮助：

[WHOAMI，正常和升高，在 Vista http://lh3.ggpht.com/_Svunm47buj0/SQ6ql4iNjPI/AAAAAAAAAeA/iwbcSrAZqRg/whoami%20-%20adminuser%20-%20groups%20-%20cropped.png?imgmax=512](http://lh3.ggpht.com/_Svunm47buj0/SQ6ql4iNjPI/AAAAAAAAAeA/iwbcSrAZqRg/whoami%20-%20adminuser%20-%20groups%20-%20cropped.png?imgmax=512)

您可以看到，当 cmd 运行提升时，whoami /groups 报告“高”强制完整性级别和与非提升运行时不同的 SID。图中，顶部会话正常，下方会话在 UAC 提示后运行提升。

知道了，这是我使用的代码。它主要检查操作系统版本，如果是 Vista 或 Server 2008，则调用运行 whoami.exe /groups 的 CheckforElevation，并在输出中查找字符串 S-1-16-12288。在这个例子中，我只是回显状态；在实际脚本中，我根据结果分支到不同的操作。

```
sub GetOSVersion
Dim strComputer, oWMIService, colOSInfo, oOSProperty, strCaption, strOSFamily
strComputer = "."
Set oWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
Set colOSInfo = oWMIService.ExecQuery("Select * from Win32_OperatingSystem")
'I hate looping through just to get one property. But dunno another way!
For Each oOSProperty in colOSInfo 
  strCaption = oOSProperty.Caption 
Next
If InStr(1,strCaption, "Vista", vbTextCompare) Then strOSFamily = "Vista"
If InStr(1,strCaption, "2008", vbTextCompare) Then strOSFamily = "2008"
If InStr(1,strCaption, "XP", vbTextCompare) Then strOSFamily = "XP"
If InStr(1,strCaption, "2003", vbTextCompare) Then strOSFamily = "2003"
If InStr(1,strCaption, "2000", vbTextCompare) Then strOSFamily = "2000"
If strOSFamily = "" Then 
    Wscript.Echo "No known OS found. (Script can detect Windows 2000, 2003, XP, Vista, 2008.)" 
Else 
    Wscript.Echo "OS Family = " & strOSFamily
End If
Select Case strOSFamily 'if Vista/2008 then call CheckforElevation
Case "Vista"
    CheckforElevation
Case "2008"
    CheckforElevation
Case Else
    Exit Sub
End Select
end sub

sub CheckforElevation 'test whether user has elevated token 
Dim oShell, oExecWhoami, oWhoamiOutput, strWhoamiOutput, boolHasElevatedToken
Set oShell = CreateObject("WScript.Shell")
Set oExecWhoami = oShell.Exec("whoami /groups")
Set oWhoamiOutput = oExecWhoami.StdOut
strWhoamiOutput = oWhoamiOutput.ReadAll
If InStr(1, strWhoamiOutput, "S-1-16-12288", vbTextCompare) Then boolHasElevatedToken = True
If boolHasElevatedToken Then
    Wscript.Echo "Current script is running with elevated privs."
Else
    Wscript.Echo "Current script is NOT running with elevated privs."
End If
end sub 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-11-10T20:24:52.653

这是我较短的解决方案：

```
Function IsElevated
    IsElevated = CreateObject("WScript.Shell").Run("cmd.exe /c ""whoami /groups|findstr S-1-16-12288""", 0, true) = 0
End function 
```

该函数是独立的，执行时不会显示任何闪烁的控制台窗口。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-05-25T14:47:44.833

我发布的解决方案是几个可用于生产的 VBScript，它们利用 whoami 来查找此信息。关于它们的一个很酷的事情是，如果您将资源工具包版本 whoami.exe 的副本放在脚本旁边（或每台机器的 system32 文件夹中），它们可以与 XP 一起使用（有关 XP 上可用的信息）。

[CSI_IsSession.vbs](http://csi-windows.com/toolkit/csi-issession)包含一个函数，它可以告诉您几乎所有关于 UAC 或脚本正在运行的当前会话的信息。

[VBScriptUACKit.vbs](http://csi-windows.com/toolkit/vbscriptuackit)（使用 CSI_IsSession.vbs）允许您通过重新启动自身来选择性地在脚本中提示 UAC。经过设计和调试，可在许多执行场景下工作。

这两个脚本都包含演示如何使用核心脚本代码的示例代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-05-27T13:59:37.103

在 WSH Jscript 中短一点

```
function isElevated(){
    var strCaption  = "";
    for (var enumItems=new Enumerator(GetObject("winmgmts:\\\\.\\root\\CIMV2").ExecQuery("Select * from Win32_OperatingSystem")); !enumItems.atEnd(); enumItems.moveNext()) {
        strCaption  +=  enumItems.item().Caption;
    }
    if(/Vista|2008|Windows\s7|Windows\s8/.test(strCaption)){
        return (new ActiveXObject("WScript.Shell").run('cmd.exe /c "whoami /groups|findstr S-1-16-12288"', 0, true)) == 0;
    }else{return true}
}    

WScript.Echo(isElevated()); 
```

# graphics - 学习底层图形编程

> ID：235826
> 
> 赞同：48
> 
> 时间：2008-10-25T03:15:38.070
> 
> 标签：graphics

我对了解可用于制作图形应用程序的不同抽象层很感兴趣。

我看到很多术语：在最高抽象级别，我听说过 C#、.NET、pyglet 和 pygame 之类的东西。再往下，我听说了 DirectX 和 OpenGL。然后是 DirectDraw、SDL、Win32 API 以及 WxWidgets 等其他多平台库。

我如何才能很好地了解其中一层的结束位置以及下一层的开始位置？在 C 中在 Windows 中创建窗口的“最低级别”方法是什么？C++呢？（代码示例将是神圣的。）在 X11 中呢？OpenGL 和 DirectX 的 Windows 实现是否构建在 Win32 API 之上？我可以从哪里开始了解这些事情？

[在建议编程 Windows](http://www.charlespetzold.com/pw5/)的地方还有另一个问题。对于 Linux 来说呢？有没有类似的书？

我知道这是非常低级的，并且有许多更友好的工具可用，但我至少想了解表面下发生的事情的基础知识。尽管我很想立即开始使用窗口和向量，但从 pygame 之类的东西开始对我来说太高级了；我真的需要制作完整的概念电路，*了解如何在计算机上绘制东西*。

我当然会感谢对书籍和资源的建议，但我认为如果这个问题的答案充满了许多不同的方法来使用不同的图形编程方法来访问“Hello world”，那将是非常酷的。C？C++？使用 OpenGL？使用 DirectX？在 Windows XP 上？在 Ubuntu 上？也许我要求太多了。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-30T12:24:23.660

最低级别是显卡的显存。计算机首次启动时，显卡通常设置为 80x25 字符传统模式。

此时，您可以使用 BIOS 提供的中断写入文本。您还可以从 16 种不同颜色的调色板中更改前景色和背景色。您可以使用访问端口/寄存器来更改显示模式。此时您可以说，将不同的字体加载到显存中并仍然使用 80x25 模式（操作系统安装通常会这样做），或者您可以继续启用 VGA/SVGA。这很复杂，这就是驱动程序的用途。

一旦卡处于“更高”模式，您将通过访问映射到视频卡的内存来更改屏幕上的内容。它是逐个像素水平存储的，其中一些像素的“脏区域”未在每行末尾映射到屏幕，您必须对其进行补偿。但是，是的，您可以将内存中图像的像素直接复制到屏幕上。

对于 DirectX、OpenGL 之类的东西。不是直接写入屏幕，而是将命令发送到图形卡并自动更新其屏幕。像“嘿，你，画这个图像，我在这里，这里和这里加载到 VRAM”或“用这个变换矩阵画这些三角形......”这样的命令与逐个像素相比只需要一小部分时间。CPU会感谢你的。

DirectX/OpenGL 是一个程序员友好的库，用于将这些命令发送到具有所有支持功能的卡，以帮助您顺利完成。更直接的方法只会徒劳无功。

SDL 是一个抽象层，因此无需费心阅读它，我猜它在每个系统上都有不同的工作方式。一方面，它可能使用半直接屏幕书写，另一种 Direct3D 等。只要代码保持跨平台......无论是最快的。

GDI/GDI+ 和 XWindow 系统。它们是专门为绘制窗口而设计的。最初他们使用逐像素的方法进行绘制（这已经足够了，因为他们只需要在按下按钮或移动窗口等时重新绘制），但现在他们使用 Direct3D/OpenGL 来加速绘图（以及特殊的影响）。优化取决于这些库的版本和实现。

因此，如果您想要最大的功率和速度，DirectX/openGL 是您的最佳选择。SDL 对于从跨平台环境中获得最大收益当然很有用，并且无论如何都与 OpenGL 集成。窗口系统排在最后，但不要低估它。尤其是微软最近提出的东西。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-25T03:19:53.397

[Michael Abrash 的图形编程“黑皮书”](http://www.drdobbs.com/high-performance-computing/184404919)是一个很好的起点。另外，您可以免费下载！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-25T03:23:10.737

如果你真的想从底部开始，那么画一条线是最基本的操作。计算机图形只是在网格（屏幕）上填充像素，因此您需要确定要填充哪些像素以获得从 (x0,y0) 到 (x1,y1) 的线。

查看[Bresenham 的算法](http://en.wikipedia.org/wiki/Bresenhams_line_algorithm)以了解所涉及的内容。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-25T03:37:24.733

成为一名优秀的图形和图像处理程序员不需要这种低层次的知识，但我确实讨厌对我正在使用的内容一无所知。我看到有两种方法可以实现这一点——高层向下，或底层向上。

自上而下是跟踪操作如何从高级图形操作（例如画圆）到硬件的问题。深入了解 OpenGL。然后 Mesa 的源代码（免费！）提供了如何在软件中实现 OpenGL 的一瞥。接下来是 Xorg 的源代码，首先要查看操作如何从 API 调用通过客户端到达 X 服务器。最后，您将深入研究与硬件接口的设备驱动程序。

自下而上：构建自己的图形硬件。想想它可以连接到计算机的方式——如何通过几个字节大小的寄存器处理大量像素，DMA 将如何工作。编写一个设备驱动程序，并尝试设计一个可能对应用程序程序员有用的图形库。

自下而上的方式是我多年前学习的方式，当时它可能使用慢速 8 位微处理器。电路和硬件-软件接口的直接经验让我对困难的设计决策有了很好的理解——例如，在设备驱动程序或更高级别中使用智能硬件绘制矩形。这些都没有实际的日常价值，但为理解新技术提供了知识基础。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-25T03:24:59.797

请参阅打开 GPU 文档部分：http: [//developer.amd.com/documentation/guides/Pages/default.aspx](http://developer.amd.com/documentation/guides/Pages/default.aspx)

高温高压

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-30T12:20:14.947

在 MSWindows 上，这很容易：您使用 API 提供的内容，无论是标准的**Windows 编程 API**还是**DirectX 系列 API**：这就是您所使用的，并且它们都有很好的文档记录。

在 X windows 环境中，您可以使用所提供**的任何 X11 库**。如果你想了解 X 上开窗背后的原理，我建议你这样做，别管很多人告诉你不要这样做，它真的会帮助你理解 X 下的图形和开窗。你可以阅读关于 X 编程的文档（谷歌它）。（在这个练习之后，你会喜欢更高级别的库！）

除了上述之外，在绝对最低级别（不包括芯片级别），您可以调用切换到各种可用图形模式的中断 - 有几个 - 然后写入屏幕缓冲区，但为此你必须使用汇编程序，其他任何东西都会太慢。走这条路根本不便携。

另一篇文章提到了**Abrash 的黑皮书**- 一个极好的资源。

编辑：至于关于 Linux 编程的书籍：这是一个社区的东西，周围有很多方法；还可以找到一个论坛，加入它，只要你文明行事，你就会得到你可能需要的所有帮助。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-25T03:22:28.680

马上，我会说“你要求太多了”。根据我所拥有的一点经验，我建议您阅读一些教程或买一本关于directX 或OpenGL 的书来开始。低于此值将非常复杂。我在 OGL 或 DX 中看到的大多数书籍都有很好的介绍，解释了函数/类的作用。

一旦你掌握了其中一个的窍门，你就可以随时深入图书馆，看看他们到底在做什么来降低。

或者，如果你真的，绝对必须学习最低水平......阅读上面帖子中的书。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-25T03:36:42.333

libX11 是 X11 的最低级别库。我相信 opengl/directx 直接与驱动程序/硬件对话（或模拟不受支持的操作），因此它们将是最低级别的库。

如果您想从*非常*低级的编程开始，请查找 VGA 的 x86 汇编代码并启动 dosbox 或类似的副本。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-06-13T09:56:39.460

Vulkan api is an api which gives you very low level access to most if not all features of the gpu, computational and graphical, it works on amd and Nvidia gpus (not all)

you can also use CUDA, but it only works on Nvidia gpus and has access to computational features only, no video output.

# vim - 在vi中快速缩进多行

> ID：235839
> 
> 赞同：2299
> 
> 时间：2008-10-25T03:27:28.013
> 
> 标签：vim, editor, indentation, vi

它应该是微不足道的，甚至可能在帮助中，但我不知道如何导航它。如何在vi中快速缩进多行？

* * *

## 回答 #1

> 赞同：2725
> 
> 时间：2008-10-25T03:28:37.450

使用`>`命令。要缩进五行，`5``>``>`. 标记一行并缩进它，`V``j``j``>`缩进三行（仅限 Vim）。要缩进花括号块，请将光标放在其中一个花括号上，然后使用`>``%`或从块内的任何位置使用`>``i``B`。

如果您正在复制文本块并且需要在新位置对齐块的缩进，请使用`]``p`而不是仅使用`p`. 这会将粘贴的块与周围的文本对齐。

此外，该[`shiftwidth`](http://vimdoc.sourceforge.net/htmldoc/options.html#'shiftwidth')设置允许您控制要缩进的空格数。

* * *

## 回答 #2

> 赞同：1007
> 
> 时间：2011-03-06T17:29:30.413

这个答案总结了这个问题的其他答案和评论，并添加了基于[Vim 文档](http://vimdoc.sourceforge.net/)和[Vim wiki](http://vim.wikia.com)的额外信息。为了简洁起见，这个答案不区分 Vi 和 Vim 特定的命令。

在下面的命令中，“re-indent”的意思是“根据你的[缩进设置缩](http://vim.wikia.com/wiki/VimTip83)进行”。[`shiftwidth`](http://vimdoc.sourceforge.net/htmldoc/options.html#%27shiftwidth%27)是控制缩进的主要变量。

**一般命令**

```
>>   Indent line by shiftwidth spaces
<<   De-indent line by shiftwidth spaces
5>>  Indent 5 lines
5==  Re-indent 5 lines

>%   Increase indent of a braced or bracketed block (place cursor on brace first)
=%   Reindent a braced or bracketed block (cursor on brace)
<%   Decrease indent of a braced or bracketed block (cursor on brace)
]p   Paste text, aligning indentation with surroundings

=i{  Re-indent the 'inner block', i.e. the contents of the block
=a{  Re-indent 'a block', i.e. block and containing braces
=2a{ Re-indent '2 blocks', i.e. this block and containing block

>i{  Increase inner block indent
<i{  Decrease inner block indent 
```

您可以`{`用`}`or替换`B`，例如`=iB`是一个有效的块缩进命令。查看[“Indent a Code Block”](http://vim.wikia.com/wiki/Indent_a_code_block)中的一个很好的示例来尝试这些命令。

另外，请记住

```
.    Repeat last command 
```

，因此可以轻松方便地重复缩进命令。

**重新缩进完整的文件**

另一种常见的情况是需要在整个源文件中修复缩进：

```
gg=G  Re-indent entire buffer 
```

您可以将此想法扩展到多个文件：

```
" Re-indent all your C source code:
:args *.c
:argdo normal gg=G
:wall 
```

或多个缓冲区：

```
" Re-indent all open buffers:
:bufdo normal gg=G:wall 
```

**在可视模式下**

```
Vjj> Visually mark and then indent three lines 
```

**在插入模式**

这些命令适用于当前行：

```
CTRL-t   insert indent at start of line
CTRL-d   remove indent at start of line
0 CTRL-d remove all indentation from line 
```

**防爆命令**

当您想要缩进特定范围的行而不移动光标时，这些非常有用。

```
:< and :> Given a range, apply indentation e.g.
:4,8>   indent lines 4 to 8, inclusive 
```

**使用标记缩进**

另一种方法是通过[标记](http://www.marksanborn.net/software/using-markers-in-vim/)：

```
ma     Mark top of block to indent as marker 'a' 
```

...将光标移动到结束位置

```
>'a    Indent from marker 'a' to current location 
```

**控制缩进的变量**

你可以在你的[.vimrc 文件](http://vimdoc.sourceforge.net/htmldoc/starting.html#vimrc)中设置这些。

```
set expandtab       "Use softtabstop spaces instead of tab characters for indentation
set shiftwidth=4    "Indent by 4 spaces when using >>, <<, == etc.
set softtabstop=4   "Indent by 4 spaces when pressing <TAB>

set autoindent      "Keep indentation from previous line
set smartindent     "Automatically inserts indentation in some cases
set cindent         "Like smartindent, but stricter and more customisable 
```

Vim 具有基于文件类型的智能缩进。尝试将其添加到您的 .vimrc 中：

```
if has ("autocmd")
    " File type detection. Indent based on filetype. Recommended.
    filetype plugin indent on
endif 
```

**参考**

*   [缩进代码块](http://vim.wikia.com/wiki/Indent_a_code_block)
*   [视觉上移动方块](http://vim.wikia.com/wiki/VimTip224)
*   [缩进源代码](http://vim.wikia.com/wiki/VimTip83)
*   `:help =`

* * *

## 回答 #3

> 赞同：127
> 
> 时间：2009-01-20T21:11:13.267

一个很大的选择是：

```
gg=G 
```

它真的很快，一切都缩进了;-)

* * *

## 回答 #4

> 赞同：113
> 
> 时间：2008-10-25T04:21:02.197

也试试这个**C 缩进**缩进。`:help =`获取更多信息：

`={`

这将自动缩进您所在的当前代码块。

要不就：

`==`

自动缩进当前行。

* * *

## 回答 #5

> 赞同：82
> 
> 时间：2008-10-25T09:16:00.620

更多视觉人的按键：

1.  进入命令模式：
    `Escape`

2.  移动到该区域的开头以缩进：
    `h``j``k``l``↑``↓``←``→`

3.  开始一个块：
    `v`

4.  移动到该区域的末尾以缩进：
    `h``j``k``l``↑``↓``←``→`

5.  （可选）键入所需的缩进级别数
    `0..9`

6.  在块上执行缩进：
    `>`

* * *

## 回答 #6

> 赞同：69
> 
> 时间：2008-10-25T04:00:31.363

除了[已经给出和接受的答案](https://stackoverflow.com/questions/235839/indent-multiple-lines-quickly-in-vi/235841#235841)之外，还可以放置一个标记，然后从当前光标缩进到该标记的所有内容。

因此，输入`ma`您想要缩进块顶部的位置，将光标向下移至您需要的位置，然后键入`>'a`（注意“ `a`”可以替换任何有效的标记名称）。这有时比`5>>`or更容易`vjjj>`。

* * *

## 回答 #7

> 赞同：69
> 
> 时间：2014-04-18T18:41:23.727

所有命令的主人是
`gg=G`

这会缩进整个文件！

下面是一些用于在 Vim 或 gVim 中快速缩进行的简单而优雅的命令。

缩进当前行
`==`

缩进当前行下方的所有行

`=G`

缩进`n`当前行下方的行

`n==`

例如，在当前行下面缩进 4 行

`4==`

要缩进代码块，请转到其中一个大括号并使用命令

`=%`

这些是缩进多行的最简单但功能强大的命令。

* * *

## 回答 #8

> 赞同：31
> 
> 时间：2013-11-04T22:57:14.357

转到文本的开头

*   按下`v`进入视觉模式。
*   使用`up`/`down`箭头突出显示文本。
*   按`=`缩进您突出显示的所有行。

* * *

## 回答 #9

> 赞同：30
> 
> 时间：2009-02-15T05:42:04.327

当您选择一个块并使用`>`缩进时，它会缩进然后返回正常模式。我的 .vimrc 文件中有这个：

```
vnoremap < <gv

vnoremap > >gv 
```

它使您可以根据需要多次缩进您的选择。

* * *

## 回答 #10

> 赞同：29
> 
> 时间：2008-10-25T04:08:38.650

除了提供的解决方案外，我还喜欢一次做一个段落`>}`

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2015-01-31T19:17:54.243

假设您使用 2 个空格来缩进您的代码。类型：

```
:set shiftwidth=2 
```

*   类型`v`（进入可视块编辑模式）
*   使用箭头键（或`h`/ `j`/ `k`/ `l`）移动光标以突出显示要缩进或取消缩进的行。

然后：

*   键入`>`一次缩进（2 个空格）。
*   键入`2``>`以缩进两次（4 个空格）。
*   键入`3``>`以缩进三次（6 个空格）。
*   ...
*   键入`<`以取消缩进一次（2 个空格）。
*   键入`2``<`以取消缩进两次（4 个空格）。
*   键入`3``<`以取消缩进三次（6 个空格）。
*   ...

你明白了。

（*空行不会缩进，我觉得这很好。*）

* * *

我在 (g)vim 文档中找到了缩进块的答案：

```
:help visual-block
/indent 
```

> 如果要对命令进行计数，请在键入操作符之前执行此操作：“v{move-around}3>”（将第 3 行缩进向右移动）。

* * *

## 回答 #12

> 赞同：20
> 
> 时间：2012-09-18T14:12:41.853

Vim UI 的美妙之处在于它的一致性。编辑命令由命令和光标移动组成。光标移动始终相同：

*   `H`到屏幕顶部，`L`到底部，`M`到中间
*   *n*`G`转到第*n*行，`G`单独到文件底部，`g``g`到顶部
*   `n`移动到下一个搜索匹配，`N`到上一个
*   `}`到段尾
*   `%`到下一个匹配的括号，括号或标签类型
*   `enter`到下一行
*   `'``x`标记*x*其中*x*是一个字母或另一个`'`。
*   还有更多，包括`w`和`W`for word，`$`或`0`线的提示等，这里不适用，因为不是*线*移动。

因此，为了使用 vim，您必须学会移动光标并记住一系列命令，例如`>`缩进（和`<`“outdent”）。

因此，为了将行从光标位置缩进到屏幕顶部，您`>``H`可以`>``G`缩进到文件底部。

如果您键入而不是键入`>``H`，`d``H`那么您正在删除相同的行块，`c``H`以替换它等。

某些光标移动更适合特定命令。特别是，该`%`命令可以方便地缩进整个 HTML 或 XML 块。如果文件的语法突出显示 ( `:syn on`)，则将光标设置在标记的文本中（例如，在 <div> 的“i”中并输入`>``%`将缩进到结束的 </div> 标记。

这就是 Vim 的工作方式：人们只需要记住光标移动和命令，以及如何混合它们。所以我对这个问题的回答是“转到要缩进的行的一端，然后键入`>`命令并移动到块的另一端”如果*缩进*被解释为移动行，`=`如果*缩进*被解释为漂亮的打印。

* * *

## 回答 #13

> 赞同：17
> 
> 时间：2015-08-21T13:33:52.253

您可以使用该`norm i`命令在行首插入给定文本。在第 2-10 行之前插入 10 个空格：

```
:2,10norm 10i 
```

请记住，命令末尾必须有一个空格字符 - 这将是我们要插入的字符。我们还可以用任何其他文本缩进一行，例如用五个下划线字符缩进文件中的每一行：

```
:%norm 5i_ 
```

或者更花哨的东西：

```
:%norm 2i[ ] 
```

更实际的例子是用 # 字符注释 Bash/Python/etc 代码：

```
:1,20norm i# 
```

重新缩进使用`x`而不是`i`. 例如，要从每一行中删除前 5 个字符：

```
:%norm 5x 
```

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2009-11-11T17:33:42.180

做这个：

```
$vi .vimrc 
```

并添加这一行：

```
autocmd FileType cpp setlocal expandtab shiftwidth=4 softtabstop=4 cindent 
```

这仅适用于 cpp 文件。您可以对另一种文件类型执行此操作，也只需修改文件类型...

* * *

## 回答 #15

> 赞同：13
> 
> 时间：2014-07-15T09:22:47.537

```
:line_num_start,line_num_end> 
```

例如，

```
14,21> shifts line number 14 to 21 to one tab 
```

为更多选项卡增加“>”符号。

例如，

```
14,21>>> for three tabs 
```

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2012-01-04T00:41:53.617

`VISUAL MODE`使用与注释代码块相同的过程来快速执行此操作。

如果您不想更改`shiftwidth`或使用任何`set`指令并且足够灵活以使用 TABS 或 SPACES 或任何其他字符，这将非常有用。

1.  将光标定位在块的开头
2.  v 切换到`-- VISUAL MODE --`
3.  选择要缩进的文本
4.  键入`:`以切换到提示
5.  替换为 3 个前导空格：

    `:'<,'>s/^/ /g`

6.  或用前导标签替换：

    `:'<,'>s/^/\t/g`

7.  简要说明：

    `'<,'>`- 在视觉选择范围内

    `s/^/ /g`- 在整个范围内的每一行的开头插入 3 个空格

    （或者）

    `s/^/\t/g``Tab`-在整个范围内的每一行的开头插入

* * *

## 回答 #17

> 赞同：12
> 
> 时间：2012-02-17T15:16:52.450

`>}`或`>{`从当前行缩进到下一段

`<}`或`<{`相同的取消缩进

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2010-11-10T19:16:06.600

我喜欢为缩进标记文本：

1.  转到文本行的开头，然后键入`m``a`（`a`是 'm'ark 中的标签：它可以是任何字母）
2.  转到文本的最后一行并输入`m``z`（同样，`z`可以是任何字母）
3.  `:'a,'z>`或`:'a,'z<`将缩进或突出（这是一个词吗？）
4.  瞧！文本被移动（空行保持空白，没有空格）

PS：您可以使用该`:'a,'z`技术为可能使用行、数字或`%`.

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2012-06-04T05:12:04.323

对我来说，MacVim (Visual) 解决方案是，用鼠标选择并按“>”，但是在将以下行放入“~/.vimrc”之后，因为我喜欢空格而不是制表符：

```
set expandtab
set tabstop=2
set shiftwidth=2 
```

能够从命令行（Terminal.app）调用MacVim也很有用，因为我有以下帮助目录“~/bin”，我在其中放置了一个名为“macvim”的脚本：

```
#!/usr/bin/env bash
/usr/bin/open -a /Applications/MacPorts/MacVim.app $@ 
```

当然在“~/.bashrc”中：

```
export PATH=$PATH:$HOME/bin 
```

[MacPorts](http://en.wikipedia.org/wiki/MacPorts)经常与“~/.profile”混淆，因此 PATH 环境变量可能会变得很长。

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2015-09-10T18:41:24.017

`:help left`

在`ex mode`您可以使用`:left`或`:le`对齐指定数量的线条。具体来说，`:left`将*左对齐 [范围] 中的行。它将行中的缩进设置为 [indent]（默认为 0）。*

`:%le3`or `:%le 3` or `:%left3`or`:%left 3`将通过填充三个空格来对齐整个文件。

`:5,7 le 3`将通过用三个空格填充它们来对齐第 5 到 7 行。

`:le`没有任何值或`:le 0`将与 0 的填充左对齐。

这适用于 Vim 和 gVim。

* * *

## 回答 #21

> 赞同：9
> 
> 时间：2013-05-07T07:13:15.853

`5==`将从当前光标位置缩进五行。

所以你可以在`==`. 它将缩进行数。这是在命令模式下。

`gg=G`将从上到下缩进整个文件。

* * *

## 回答 #22

> 赞同：9
> 
> 时间：2013-11-05T16:19:18.740

我在评论中没有找到我使用的方法，所以我会分享它（我认为仅限 Vim）：

1.  `Esc`进入命令模式
2.  移动到要缩进的最后一行的第一个字符
3.  `Ctrl`+`V`开始块选择
4.  移动到要缩进的第一行的第一个字符
5.  `Shift`+`I`进入特殊插入模式
6.  键入您需要缩进的任意数量的空格/制表符（例如两个
7.  按下`Esc`和空格将出现在所有行中

当您不想更改缩进/制表符设置`vimrc`或记住它们以在编辑时更改它时，这很有用。

为了取消缩进，我使用相同的`Ctrl`+`V`块选择来选择空格并使用`D`.

* * *

## 回答 #23

> 赞同：9
> 
> 时间：2014-02-06T04:04:42.950

我不知道为什么很难找到像这样一个简单的答案......

我自己也费了很大力气才知道这一点。这很简单：

*   编辑`.vimrc`主目录下的文件。
*   添加这一行

    ```
    set cindent 
    ```

    在您要正确缩进的文件中。

*   在普通/命令模式类型

    ```
    10==   (This will indent 10 lines from the current cursor location)
    gg=G   (Complete file will be properly indented) 
    ```

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2020-02-28T14:05:12.053

1.  按“SHIFT + v”进入视觉线模式。
2.  使用光标键或“j”和“k”键选择要缩进的文本。
3.  要向右缩进，请按“SHIFT + 点”（> 字符）。要向左缩进，请按“SHIFT + 逗号”（< 字符）。

来源：[https ://www.fir3net.com/UNIX/General/how-do-i-tab-multiple-lines-within-vi.html](https://www.fir3net.com/UNIX/General/how-do-i-tab-multiple-lines-within-vi.html)

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2013-07-02T07:24:33.230

经常使用 Python，我发现自己经常需要将块移动不止一个缩进。您可以使用任何块选择方法来执行此操作，然后只需在`>`

例如，`V5j3>`将 5 行缩进 3 次 - 如果您使用 4 个空格进行缩进，则为 12 个空格。

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2015-03-01T13:20:25.460

缩进文件类型中的每一行，`Esc`然后`G=gg`.

* * *

## 回答 #27

> 赞同：7
> 
> 时间：2017-09-28T23:59:37.367

我使用块模式视觉选择：

*   去块的前面移动（在顶部或底部）。
*   按`Ctrl`+`V`进入可视块模式。
*   导航以选择行前的列。
*   按`I`( `Shift`+ `I`) 进入插入模式。
*   键入一些空格。
*   按`Esc`。所有线路都会移动。

这不是一个单一任务者。有用：

*   在行的中间。
*   在所有行上插入任何字符串。
*   更改列（使用`c`代替`I`）。
*   猛拉，删除，替换等...

* * *

## 回答 #28

> 赞同：7
> 
> 时间：2018-11-15T05:36:49.433

*   对于代码块，{}：`=`+`%`

*   对于选定的行：`Shift`+`v`使用向上/向下箭头键选择，然后按`=`。

*   对于整个文件：`gg`++`=``G`

注意：*'gg' 表示转到第 1 行，'=' 是缩进命令，'G' 将光标移动到文件末尾*。

* * *

## 回答 #29

> 赞同：6
> 
> 时间：2013-12-23T03:30:05.970

## 如何将 vi 中突出显示的代码立即缩进多个空格：

**选项 1：使用 Visual Block 模式将 vi 中的代码块缩进三个空格：**

1.  选择要缩进的代码块。在正常模式下使用`Ctrl+V`并向下箭头选择文本。当它被选中时，输入`:`给选定文本块一个命令。

2.  命令行中会出现以下内容：`:'<,'>`

3.  要将缩进设置为三个空格，请键入`le 3`并按 Enter。这是出现的：`:'<,'>le 3`

4.  所选文本立即缩进三个空格。

**选项 2：使用 Visual Line 模式将 vi 中的代码块缩进三个空格：**

1.  在 vi 中打开文件。
2.  将光标放在一些代码上
3.  处于正常模式并按以下键：

    ```
    Vjjjj:le 3 
    ```

    **对你所做的解释：**

    `V`表示开始选择文本。

    `jjjj`向下四行箭头，突出显示四行。

    `:`告诉 vi 您将为突出显示的文本输入指令。

    `le 3`表示将突出显示的文本缩进三行。

    所选代码立即增加或减少三个空格缩进。

**选项3：使用Visual Block模式和特殊插入模式来增加缩进：**

1.  在 vi 中打开文件。
2.  将光标放在一些代码上
3.  在正常模式下按以下键：

    `Ctrl+V`

    ```
    jjjj 
    ```

    （按空格键五次）

    `Esc` `Shift+i`

    所有突出显示的文本都缩进了五个空格。

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2014-12-19T20:18:30.537

要将所有文件缩进四：

```
esc 4G=G 
```

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2020-07-22T21:06:11.570

对于喜欢现代编辑器使用`<TAB>`->`Tab`和`<S-TAB>`-> `Shift`+缩进所选行的人`Tab`：

```
vnoremap <TAB> >gv
vnoremap <S-TAB> <gv 
```

用法：点击`V`逐行视觉模式，选择你想要的行，然后点击`Tab`（也许用`shift`），然后缩进应用你想要的，选择仍然......

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2020-10-06T10:32:29.293

对于麦克，

1.  使用 vim 打开文件

    vim 部署1.yml

2.  使用 Shift + 'v' 选择行，然后使用 'up' 或 'down' 键

    [![在此处输入图像描述](https://i.stack.imgur.com/mhCIn.png)](https://i.stack.imgur.com/mhCIn.png)

3.  使用 Shift + '>' 或 Shift + '<' 缩进选定的行

    [![在此处输入图像描述](https://i.stack.imgur.com/MUB0x.png)](https://i.stack.imgur.com/MUB0x.png)

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2018-04-25T07:14:41.943

假设`|`表示光标在 Vim 中的位置。如果要缩进的文本包含在如下代码块中：

```
int main() {
line1
line2|
line3
} 
```

您可以这样做`>i{`，这意味着“*在 (* *) 块 ( ) 中**缩进 ( )`>``i``{`* ”并获得：

```
int main() {
    line1
    line2|
    line3
} 
```

现在假设这些线是连续的，但在一个块之外，例如：

```
do
line2|
line3
line4
done 
```

要缩进第 2 到 4 行，您可以直观地选择行并键入`>`。或者你可以更快`>2j`地获得：

```
do
    line2|
    line3
    line4
done 
```

请注意，这`>Nj`意味着从当前行缩进到`N`下面的行。如果要缩进的行数很大，用户可能需要几秒钟的时间来计算`N`. 为了节省宝贵的时间，您可以激活*相对数字*选项（`set relativenumber`从 Vim 版本 7.3 开始可用）。

# html - 使用 iText 将 HTML 转换为 PDF

> ID：235851
> 
> 赞同：41
> 
> 时间：2008-10-25T03:36:52.253
> 
> 标签：html, pdf, itext

有谁知道是否可以使用 iText 将 HTML 页面（url）转换为 PDF？

如果答案是“不”，那也没关系，因为我将停止浪费时间尝试解决问题，而只是在我知道可以的许多组件之一上花一些钱:)

提前感谢您的回复！

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-07-08T07:17:47.287

我认为这正是您想要的

[http://today.java.net/pub/a/today/2007/06/26/generating-pdfs-with-flying-saucer-and-itext.html](http://today.java.net/pub/a/today/2007/06/26/generating-pdfs-with-flying-saucer-and-itext.html)

[http://code.google.com/p/flying-saucer](http://code.google.com/p/flying-saucer)

> Flying Saucer 的主要目的是将符合规范的 XHTML 和 CSS 2.1 作为 Swing 组件呈现到屏幕上。虽然它最初旨在将标记嵌入桌面应用程序（例如 iTunes 音乐商店），但 Flying Saucer 也已扩展了 iText 的工作。这使得将 XHTML 呈现为 PDF 以及图像和屏幕变得非常容易。飞碟需要 Java 1.4 或更高版本。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-22T12:46:18.557

我最终使用了来自 webSupergoo 的 ABCPdf。它工作得非常好，根据您上面的评论，它为我节省了大约 350 美元。再次感谢丹尼尔和布拉奇的评论。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-09-04T09:11:44.623

最简单的方法是使用 pdfHTML。它是一个 iText7 附加组件，可将 HTML5 (+CSS3) 转换为 pdf 语法。

代码非常简单：

```
 HtmlConverter.convertToPdf(
        "<b>This text should be written in bold.</b>",       // html to be converted
        new PdfWriter(
            new File("C://users/mark/documents/output.pdf")  // destination file
        )
    ); 
```

要了解更多信息，请访问[http://itextpdf.com/itext7/pdfHTML](http://itextpdf.com/itext7/pdfHTML)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-14T21:20:30.367

你的问题的答案实际上是双重的。首先，您需要指定您打算如何处理呈现的 HTML：将其保存到新的 PDF 文件，或在另一个呈现上下文中使用它（即，将其添加到您正在生成的其他文档中）。

前者使用 Flying Saucer 框架相对容易完成，可以在这里找到：[https ://github.com/flyingsaucerproject/flyingsaucer](https://github.com/flyingsaucerproject/flyingsaucer)

后者实际上是一个更全面的问题，需要进一步分类。使用 iText，您将无法（至少很简单）将 iText 元素（即`Paragraph`、`Phrase`等`Chunk`）与生成的 HTML 结合起来。您可以通过使用`ContentByte`'`addTemplate`方法并为此模板生成 HTML 来解决此问题。

另一方面，如果您想在生成的 HTML 上加盖水印、日期等内容，您可以使用 iText 执行此操作。

所以底线：您不能轻易地将呈现的 HTML 集成到其他 pdf 生成上下文中，但您可以将 HTML 直接呈现为空白 PDF 文档。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-09-20T13:52:06.257

使用 itext 库：

这是示例代码。它工作得很好：

```
 String htmlFilePath = filePath + ".html";
        String pdfFilePath = filePath + ".pdf";

        // create an html file on given file path
        Writer unicodeFileWriter = new OutputStreamWriter(new FileOutputStream(htmlFilePath), "UTF-8");
        unicodeFileWriter.write(document.toString());
        unicodeFileWriter.close();

        ConverterProperties properties = new ConverterProperties();
        properties.setCharset("UTF-8");
        if (url.contains(".kr") || url.contains(".tw") || url.contains(".cn") || url.contains(".jp")) {
            properties.setFontProvider(new DefaultFontProvider(false, false, true));
        }

        // convert the html file to pdf file.
        HtmlConverter.convertToPdf(new File(htmlFilePath), new File(pdfFilePath), properties); 
```

Maven 依赖项

```
 <dependency>
        <groupId>com.itextpdf</groupId>
        <artifactId>itext7-core</artifactId>
        <version>7.1.6</version>
        <type>pom</type>
    </dependency>

    <dependency>
        <groupId>com.itextpdf</groupId>
        <artifactId>html2pdf</artifactId>
        <version>2.1.3</version>
    </dependency> 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-08-09T18:04:58.393

使用 iText 的 HTMLWorker

[例子](http://javaxtendsolutions.wordpress.com/2011/01/03/itext-1-5-html-to-pdf/)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-12-22T12:21:32.693

也许你可以尝试：

[http://www.allcolor.org/YaHPConverter/](http://www.allcolor.org/YaHPConverter/)

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-12-04T22:18:21.817

今年早些时候我需要 HTML 到 PDF 的转换时，我尝试了 Winnovative HTML 到 PDF 转换器的试用（我认为 ExpertPDF 也是同一个产品）。效果很好，所以我们在那家公司购买了许可证。之后我就不再深入探讨了。

# html - 如何拉伸背景图像以覆盖整个 HTML 元素？

> ID：235855
> 
> 赞同：94
> 
> 时间：2008-10-25T03:41:52.760
> 
> 标签：html, css, background-image

我正在尝试获取 HTML 元素（body、div 等）的背景图像以拉伸其整个宽度和高度。

运气不太好。除了作为背景图像之外，它甚至可能还是我必须以其他方式做到这一点？

我目前的CSS是：

```
body {
    background-position: left top;
    background-image: url(_images/home.jpg);
    background-repeat: no-repeat;
} 
```

提前致谢。

编辑：我不热衷于维护 Gabriel 建议中的 CSS，所以我改为更改页面的布局。但这似乎是最好的答案，所以我将其标记为这样。

* * *

## 回答 #1

> 赞同：203
> 
> 时间：2011-03-16T20:21:03.050

```
<style>
    { margin: 0; padding: 0; }

    html { 
        background: url('images/yourimage.jpg') no-repeat center center fixed; 
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
    }
</style> 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-07-09T12:52:34.810

使用`background-size`属性：[http ://www.w3.org/TR/css3-background/#the-background-size](http://www.w3.org/TR/css3-background/#the-background-size)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-05-07T10:44:27.727

总之你可以试试这个......

```
<div data-role="page" style="background:url('backgrnd.png'); background-repeat: no-repeat; background-size: 100% 100%;" > 
```

我用过很少的css和js的地方......

```
<link rel="stylesheet" href="css/jquery.mobile-1.0.1.min.css" />
<script src="js/jquery-1.7.1.min.js"></script>
<script src="js/jquery.mobile-1.0.1.min.js"></script> 
```

它对我来说很好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-25T03:50:51.430

不确定是否可以拉伸背景图像。如果您发现它在所有目标浏览器中都不可能或不可靠，您可以尝试使用拉伸的 img 标签，将 z-index 设置为较低，并将 position 设置为 absolute，以便其他内容显示在其顶部。

让我们知道你最终会做什么。

编辑：我的建议基本上是加布里埃尔链接中的内容。所以试试吧:)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-27T19:09:49.583

要扩展@PhiLho 的答案，您可以将一个非常大的图像（或任何尺寸的图像）放在一个页面上，其中包含：

```
{ 
background-image: url(_images/home.jpg);
background-repeat:no-repeat;
background-position:center; 
} 
```

或者您可以使用背景颜色与图像背景相匹配的较小图像（如果它是纯色）。这可能适合也可能不适合您的目的。

```
{ 
background-color: green;
background-image: url(_images/home.jpg);
background-repeat:no-repeat;
background-position:center; 
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-12-22T16:48:08.353

如果您需要在调整屏幕大小时拉伸背景图像并且不需要与旧浏览器版本兼容，则可以使用：

```
body {
    background-image: url('../images/image.jpg');
    background-repeat: no-repeat;
    background-size: cover;
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-06-12T19:50:39.333

如果你有一个大的横向图像，这个例子在纵向模式下调整背景的大小，使它显示在顶部，在底部留空：

```
html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
}

body {
    background-image: url('myimage.jpg');
    background-position-x: center;
    background-position-y: bottom;
    background-repeat: no-repeat;
    background-attachment: scroll;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
}

@media screen and (orientation:portrait) {
    body {
        background-position-y: top;
        -webkit-background-size: contain;
        -moz-background-size: contain;
        -o-background-size: contain;
        background-size: contain;
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-07-09T14:33:29.243

我主要使用以下代码来实现所要求的效果：

```
body {
    background-image: url('../images/bg.jpg');
    background-repeat: no-repeat;
    background-size: 100%;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-03-04T08:46:14.707

```
background: url(images/bg.jpg) no-repeat center center fixed; 
-webkit-background-size: cover;
-moz-background-size: cover;
-o-background-size: cover;
background-size: cover; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-05-28T16:21:45.377

这个对我有用

```
.page-bg {
  background: url("res://background");
  background-position: center center;
  background-repeat: no-repeat;
  background-size: 100% 100%;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-25T14:15:48.230

你不能在纯 CSS 中。在所有其他组件后面有一个覆盖整个页面的图像可能是你最好的选择（看起来这就是上面给出的解决方案）。无论如何，它看起来很糟糕。我会尝试使用足够大的图像来覆盖大多数屏幕分辨率（比如高达 1600x1200，高于它更稀缺），以限制页面的宽度，或者只是使用平铺的图像。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-02-21T23:19:14.413

图片{

```
background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  padding: 0 3em 0 3em; 
margin: -1.5em -0.5em -0.5em -1em; 
  width: absolute;
  max-width: 100%; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-04-28T22:16:23.113

只需将 div 设置为 body 的直接子代（例如类名 bg），包含 body 中的所有其他元素，并将其添加到 CSS 文件中：

```
.bg {
    background-image: url('_images/home.jpg');//Put your appropriate image URL here
    background-size: 100% 100%; //You need to put 100% twice here to stretch width and height
} 
```

请参阅此链接：[https](https://www.w3schools.com/css/css_rwd_images.asp) : //www.w3schools.com/css/css_rwd_images.asp 向下滚动到显示以下内容的部分：

> 2.  如果 background-size 属性设置为“100% 100%”，则背景图像将拉伸以覆盖整个内容区域

无论您如何调整它，它都会显示“img_flowers.jpg”拉伸到屏幕或浏览器的大小。

# recursion - 递归算法的迭代版本，以制作二叉树

> ID：235868
> 
> 赞同：4
> 
> 时间：2008-10-25T03:52:43.313
> 
> 标签：recursion, iteration, binary-tree, non-recursive

鉴于此算法，我想知道是否存在迭代版本。另外，我想知道迭代版本是否可以更快。

这是某种伪蟒蛇...

该算法返回对树根的引用

```
make_tree(array a)
  if len(a) == 0
        return None;

  node = pick a random point from the array
  calculate distances of the point against the others
  calculate median of such distances
  node.left = make_tree(subset of the array, such that the distance of points is lower to the median of distances)
  node.right = make_tree(subset, such the distance is greater or equal to the median)
  return node 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-25T05:15:34.613

一个只有一次递归调用的递归函数通常可以不费太多力气就变成尾递归函数，然后再转换成迭代函数就很简单了。这里的典型例子是阶乘：

```
# naïve recursion
def fac(n):
    if n <= 1:
        return 1
    else:
        return n * fac(n - 1)

# tail-recursive with accumulator
def fac(n):
    def fac_helper(m, k):
        if m <= 1:
            return k
        else:
            return fac_helper(m - 1, m * k)
    return fac_helper(n, 1)

# iterative with accumulator
def fac(n):
    k = 1
    while n > 1:
        n, k = n - 1, n * k
    return k 
```

但是，您的案例涉及两个递归调用，除非您对算法进行重大修改，否则您需要保留一个堆栈。管理自己的堆栈可能比使用 Python 的函数调用堆栈快一点，但增加的速度和深度可能不值得复杂。这里的典型例子是斐波那契数列：

```
# naïve recursion
def fib(n):
    if n <= 1:
        return 1
    else:
        return fib(n - 1) + fib(n - 2)

# tail-recursive with accumulator and stack
def fib(n):
    def fib_helper(m, k, stack):
        if m <= 1:
            if stack:
                m = stack.pop()
                return fib_helper(m, k + 1, stack)
            else:
                return k + 1
        else:
            stack.append(m - 2)
            return fib_helper(m - 1, k, stack)
    return fib_helper(n, 0, [])

# iterative with accumulator and stack
def fib(n):
    k, stack = 0, []
    while 1:
        if n <= 1:
            k = k + 1
            if stack:
                n = stack.pop()
            else:
                break
        else:
            stack.append(n - 2)
            n = n - 1
    return k 
```

现在，您的情况比这要困难得多：一个简单的累加器将很难用一个指向需要生成子树的指针来表达一个部分构建的树。你会想要一个[拉链](http://www.haskell.org/haskellwiki/Zipper)——用 Python 这样的非真正功能语言来实现并不容易。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-25T03:57:52.820

制作迭代版本只是使用您自己的堆栈而不是普通的语言调用堆栈。我怀疑迭代版本会更快，因为普通调用堆栈为此目的进行了优化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-25T04:16:11.877

您获得的数据是随机的，因此树可以是任意二叉树。对于这种情况，您可以使用线程二叉树，它可以被遍历和构建而无需递归且无需堆栈。节点有一个标志，指示该链接是否是到另一个节点的链接或如何到达“下一个节点”。

来自[http://en.wikipedia.org/wiki/Threaded_binary_tree](http://en.wikipedia.org/wiki/Threaded_binary_tree) ![替代文字](https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Threaded_tree.svg/330px-Threaded_tree.svg.png)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T10:06:30.750

根据您如何定义“迭代”，前面的答案没有提到另一种解决方案。如果“迭代”只是意味着“不受堆栈溢出异常的影响”（但“允许使用 'let rec'”），那么在支持尾调用的语言中，您可以使用延续（而不是“显式堆”）。下面的 F# 代码说明了这一点。它与您的原始问题类似，因为它从数组中构建了一个 BST。如果数组是随机打乱的，树是相对平衡的，递归版本不会创建太深的堆栈。但是关闭混洗，树变得不平衡，递归版本堆栈溢出，而迭代版本继续愉快地继续。

```
#light 
open System

let printResults = false
let MAX = 20000
let shuffleIt = true

// handy helper function
let rng = new Random(0)
let shuffle (arr : array<'a>) = // '
    let n = arr.Length
    for x in 1..n do
        let i = n-x
        let j = rng.Next(i+1)
        let tmp = arr.[i]
        arr.[i] <- arr.[j]
        arr.[j] <- tmp

// Same random array
let sampleArray = Array.init MAX (fun x -> x) 
if shuffleIt then
    shuffle sampleArray

if printResults then
    printfn "Sample array is %A" sampleArray

// Tree type
type Tree =
    | Node of int * Tree * Tree
    | Leaf

// MakeTree1 is recursive
let rec MakeTree1 (arr : array<int>) lo hi =  // [lo,hi)
    if lo = hi then
        Leaf
    else
        let pivot = arr.[lo]
        // partition
        let mutable storeIndex = lo + 1
        for i in lo + 1 .. hi - 1 do
            if arr.[i] < pivot then
                let tmp = arr.[i]
                arr.[i] <- arr.[storeIndex]
                arr.[storeIndex] <- tmp 
                storeIndex <- storeIndex + 1
        Node(pivot, MakeTree1 arr (lo+1) storeIndex, MakeTree1 arr storeIndex hi)

// MakeTree2 has all tail calls (uses continuations rather than a stack, see
// http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!171.entry 
// for more explanation)
let MakeTree2 (arr : array<int>) lo hi =  // [lo,hi)
    let rec MakeTree2Helper (arr : array<int>) lo hi k =
        if lo = hi then
            k Leaf
        else
            let pivot = arr.[lo]
            // partition
            let storeIndex = ref(lo + 1)
            for i in lo + 1 .. hi - 1 do
                if arr.[i] < pivot then
                    let tmp = arr.[i]
                    arr.[i] <- arr.[!storeIndex]
                    arr.[!storeIndex] <- tmp 
                    storeIndex := !storeIndex + 1
            MakeTree2Helper arr (lo+1) !storeIndex (fun lacc ->
                MakeTree2Helper arr !storeIndex hi (fun racc ->
                    k (Node(pivot,lacc,racc))))
    MakeTree2Helper arr lo hi (fun x -> x)

// MakeTree2 never stack overflows
printfn "calling MakeTree2..."
let tree2 = MakeTree2 sampleArray 0 MAX
if printResults then
    printfn "MakeTree2 yields"
    printfn "%A" tree2

// MakeTree1 might stack overflow
printfn "calling MakeTree1..."
let tree1 = MakeTree1 sampleArray 0 MAX
if printResults then
    printfn "MakeTree1 yields"
    printfn "%A" tree1

printfn "Trees are equal: %A" (tree1 = tree2) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T04:00:58.010

是的，可以使任何递归算法迭代。隐式地，当您创建递归算法时，每次调用都会将先前的调用放入堆栈中。您要做的是将隐式调用堆栈变为显式调用堆栈。迭代版本不一定会更快，但您不必担心堆栈溢出。（在我的回答中使用网站名称是否会获得徽章？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-25T04:04:00.607

虽然从一般意义上说，将递归算法直接转换为迭代算法确实需要显式堆栈，但有一个特定的算法子集可以直接以迭代形式呈现（不需要堆栈）。这些渲染可能没有相同的性能保证（迭代函数列表与递归解构），但它们确实经常存在。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-30T11:28:18.043

这是基于堆栈的迭代解决方案（Java）：

```
public static Tree builtBSTFromSortedArray(int[] inputArray){

    Stack toBeDone=new Stack("sub trees to be created under these nodes");

    //initialize start and end 
    int start=0;
    int end=inputArray.length-1;

    //keep memoy of the position (in the array) of the previously created node
    int previous_end=end;
    int previous_start=start;

    //Create the result tree 
    Node root=new Node(inputArray[(start+end)/2]);
    Tree result=new Tree(root);
    while(root!=null){
        System.out.println("Current root="+root.data);

        //calculate last middle (last node position using the last start and last end)
        int last_mid=(previous_start+previous_end)/2;

        //*********** add left node to the previously created node ***********
        //calculate new start and new end positions
        //end is the previous index position minus 1
        end=last_mid-1; 
        //start will not change for left nodes generation
        start=previous_start; 
        //check if the index exists in the array and add the left node
        if (end>=start){
            root.left=new Node(inputArray[((start+end)/2)]);
            System.out.println("\tCurrent root.left="+root.left.data);
        }
        else
            root.left=null;
        //save previous_end value (to be used in right node creation)
        int previous_end_bck=previous_end;
        //update previous end
        previous_end=end;

        //*********** add right node to the previously created node ***********
        //get the initial value (inside the current iteration) of previous end
        end=previous_end_bck;
        //start is the previous index position plus one
        start=last_mid+1;
        //check if the index exists in the array and add the right node
        if (start<=end){
            root.right=new Node(inputArray[((start+end)/2)]);
            System.out.println("\tCurrent root.right="+root.right.data);
            //save the created node and its index position (start & end) in the array to toBeDone stack
            toBeDone.push(root.right);
            toBeDone.push(new Node(start));
            toBeDone.push(new Node(end));   
        }

        //*********** update the value of root ***********
        if (root.left!=null){
            root=root.left; 
        }
        else{
            if (toBeDone.top!=null) previous_end=toBeDone.pop().data;
            if (toBeDone.top!=null) previous_start=toBeDone.pop().data;
            root=toBeDone.pop();    
        }
    }
    return result;  
} 
```

# sql-server - 文档/图像数据库存储库设计问题

> ID：235872
> 
> 赞同：3
> 
> 时间：2008-10-25T03:56:25.227
> 
> 标签：sql-server, middleware, document-imaging

问题：

我应该编写我的应用程序以直接访问数据库图像存储库还是编写一个中间件来处理文档请求。

背景：

我有一个自定义文档图像和工作流应用程序，目前存储大约 1500 万个文档/文档图像（90%+ 单页，4 组 tiff，其余 PDF、Word 和 Excel 文档）。图像存储库是一个商业的第 3 方应用程序，它非常昂贵并且坦率地说开销太大。我只需要一个系统来存储和检索文档图像。

我正在考虑将映像直接移动到 SQL Server 2005 数据库中。索引信息非常有限 - 基本上是 2 个索引字段。这是一个人寿保险单管理系统，因此我使用保单编号和系统范围的唯一 ID 编号对图像进行索引。还有其他索引值，但它们与图像数据分开存储和维护。这些索引值使我能够查找单个图像检索的唯一 id 值。

数据库服务器是一个双四核 windows 2003 机器，带有托管数据库文件的 SAN 驱动器。当前的图像存储库大小约为 650GB。我还没有进行任何测试来查看转换后的数据库会有多大。我并不是真的在询问数据库设计——我正在与我们的 DBA 在这方面进行合作。如果情况发生变化，我会回来的:-)

当前要替换的系统显然是一个中间件应用程序，但它是一个非常重量级的系统，分布在 3 个 windows 服务器上。如果我走这条路，那将是一个单一的服务器系统。

我主要关心的是可扩展性和性能 - 非常重视性能。我有大约 100 个用户，未来几年的使用增长可能会很慢。大多数用户主要是阅读用户——他们不经常向系统添加图像。我们有一个部门负责扫描和以其他方式将图像添加到存储库。我们还有一些其他应用程序接收文档（通过 ftp），它们会在收到文档时自动将它们插入到存储库中，或者将完整的索引信息或作为用户查看和索引的“批次”。

大多数（90%+）的文档/图像非常小，< 100K，可能< 50K，所以我相信将图像存储在数据库文件中将是最有效的，而不是获取 SQL 2008 并使用文件流。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T04:36:26.393

通常情况下，可扩展性和性能最终是相互结合的，因为从现在起六个月后，管理层会回来说“应用程序 X 中的函数 Y 运行速度慢得令人无法接受，我们如何加快速度？” 答案通常是升级后端解决方案。在升级后端时，横向扩展几乎总是比硬件扩展成本更低。

因此，长话短说，我建议构建一个中间件应用程序，专门处理来自用户应用程序的传入请求，然后将它们路由到适当的目的地。这将从后端存储解决方案中充分抽象出您的前端用户应用程序，因此当可伸缩性确实成为问题时，只需更新中间件应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T04:34:20.780

这很简单。将应用程序写入接口，使用某种工厂机制来提供该接口，并根据需要实现该接口。

一旦你对你的界面感到满意，那么应用程序（大部分）与实现隔离，无论它是直接与数据库还是其他组件通信。

提前考虑一下您的界面设计，但做得非常愚蠢，“它很简单，它在这里工作，它现在工作”实现提供了一个很好的平衡，既可以在未来验证系统，又不必过度设计它。

很容易争辩说，此时您甚至不需要一个接口，而只是一个您实例化的简单类。但是，如果您的合同定义明确（即接口或类签名），那就是保护您免受更改（例如重做后端实现）的原因。如果您认为有必要，您可以随时将类替换为接口。

至于可扩展性，测试它。然后，您不仅知道是否需要扩展，而且可能还知道何时。“对 100 个用户来说效果很好，对 200 个用户有问题，如果我们达到 150 个，我们可能会考虑再看看后端，但现在还不错。”

这是尽职调查和负责任的设计策略，恕我直言。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T21:55:09.273

我同意 gabriel1836。但是，另一个好处是您可以暂时运行一个混合系统一段时间，因为您不会在一夜之间将 1400 万个文档从您的专有系统转换为您自己开发的系统。

另外，我强烈建议您将文档存储在数据库之外。将它们存储在文件系统（本地、SAN、NAS 无关紧要）上，并将指向文档的指针存储在数据库中。

我很想知道您现在使用的是什么文档管理系统。

此外，不要低估替换专有系统提供的捕获（扫描和导入）的工作量。

# visual-c++-6 - 编译期间的 VC6 和奇怪的 WINVER 消息

> ID：235875
> 
> 赞同：1
> 
> 时间：2008-10-25T04:00:20.910
> 
> 标签：visual-c++-6, platform-sdk

我在 VC6 项目编译中收到以下消息：

> OTE：WINVER 已定义为 0x0500 或更高版本，它启用了 Windows NT 5.0 和 Windows 98 功能。当这些标头发布时，Windows NT 5.0 beta 1 和 Windows 98 beta 2.1 是当前版本。对于此版本，当 WINVER 定义为 0x0500 或更高版本时，您只能构建 beta 或测试应用程序。要构建零售应用程序，请将 WINVER 设置为 0x0400 或访问[http://www.microsoft.com/msdn/sdk](http://www.microsoft.com/msdn/sdk) 以查看零售 Windows NT 5.0 或 Windows 98 标头是否可用。有关更多信息，请参阅 SDK 发行说明。

知道发生了什么吗？

它构建和链接很好。

我的 XP 机器上有 VC6、VS2005 和 2008。

也许我的平台 SDK 不是最新的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T10:36:06.527

您看到的警告消息来自随 Visual C++ 6.0 安装提供的 Platform SDK，它似乎可以追溯到 Windows 2000 处于测试阶段时。

如果您的应用程序需要`WINVER`，`0x0500`并且您仍然需要使用 Visual C++ 6.0，我建议您安装更新的 Platform SDK。根据[这篇博](http://blogs.msdn.com/mapo/archive/2007/06/07/last-platform-sdk-compatible-with-visual-studio-6-0.aspx)文，与 Visual C++ 6.0 兼容的最新平台 SDK 是 2003 年 2 月版。[（这里](http://blogs.msdn.com/windowssdk/archive/2006/06/20/640172.aspx)有另一个帖子可能有用。）

不过请注意 - 我不知道 2003 年 2 月的 Platform SDK 是否会与您的 Visual Studio 2005 和 2008 安装共存。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T04:20:43.460

或者 VC6 的包含路径不包括你的 SDK，它只使用 VC6 附带的那些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T12:08:15.933

您是否安装了最新的 VC6 服务包？

# architecture - “电话回家”的软件；好的？坏的？邪恶的？发出什么通知？如何？

> ID：235879
> 
> 赞同：16
> 
> 时间：2008-10-25T04:01:43.997
> 
> 标签：architecture

**电话回家**

每个人都想时不时地。...当软件长大并成为成熟产品时呢？不应该是成年了，安静的住在自己的新家吗？或者，它应该表现出它从哪里来的一些感情？...

我听说有人说他们会从盘片中剔除任何试图在没有他们说的情况下进行交流的部分。我还注意到现在有大量产品经常要求允许发送统计使用信息。而且中间有很多层次。

我坐在栅栏上。

有很长的段落解释了这个问题是如何向我提出的，但是为了我们所有人的利益，我写了然后删除了它。可以说，我是首席科学家，是公司的一名官员，也是*我们*开发工作的负责人；这真的很重要，我正在寻找编程社区的见解，因为我在这里没有得到任何有用的反馈......

**对PHONE HOME**的最大争论是，一些参与者担心可能会有严重的企图欺骗合同，如果软件偶尔打电话回家，它将有助于检测作弊行为（对此有处罚）。

其他赞成的论点是它可以提供使用统计数据，并可能检测何时更新是合适的。

最大的反对理由是它具有攻击性。

我也不知道我将如何构建它。很明显，所有一直打电话回家的东西都不会飞。有六种主要产品，有些将运行 24 X 7 X 365.24，有些会像 frigen yo-yo 一样上下波动，但所有这些产品的一些数据都会很好 - 本地存储库？

然后是连接策略——邮件消息虽然方便，但可能是一个糟糕的电话，因为它可能更加突兀（也许）。然后，一个简单的 TCP ssh 调用也可能不是那么好。

那么，怎么样？如果你是专业人士，请告诉我为什么。如果你反对，为什么也反对。“做对了？”的例子 您喜欢某处的合同文本 - 还是讨厌？

接下来，如果我们决定去做，我们应该怎么做——你会怎么做？为什么？

坦率地说，我被*深深地*撕裂了。我一般都讨厌这样的事情，但作为公司的官员，我必须承认自己的感受，这里可能有很多钱，被冒犯可能不是一个好理由。

谢谢你的想法。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-25T04:56:59.940

Informed consent, where informed means that the type, frequency and content of the information you'll be sending is told to the client is truly the only reasonable option, else you start closely resembling a malware author. People will find out and will dislike you a lot if you tried to pull it off sneakily. You probably can and should present it as a means to improve the service though, everybody likes software that reports bugs by itself.

This means you cannot rely on this to be your cheat detection mechanism, but, given that there's a lot of money on the table, you may be able to contractually put some random inspections. For instance you could register locally the data you'd otherwise send and go look at it in the inspections. I don't think you are forced to declare you'll be locally registering usage information (IANAL, YMMV, WTF, BBQ)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-25T04:58:03.777

I would tend to use this in moderation. Any informational activity should be opt-in rather than opt-out (i.e. crash reports, statistics, etc).

For protection of your assets, I think it's fine. Many will tell you that it won't stop cheating, because people can fool it, but it can help. Just don't collect any information in doing so that could be (realistically) deemed an invasion of privacy, and I don't see any problem with it. Also make sure that whatever is being done is honed and tested well enough that it's not going to adversely affect the user experience. i.e. if it fails to connect when trying to phone home, and the software no longer works as a result, that could be a big problem.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T06:17:07.423

您在对其他人的评论中提到，主要关注的是想要创建自己的许可证的子供应商。如果是这样的话，我会专注于让他们诚实的任何软件解决方案。我从这个解决方案中看到的最重要的好处是，您不会以这种方式影响最终用户，只会影响中间的经销商。如果这种安排对他们来说是有利可图的，那么就值得做任何必要的事情来确保他们的活动是光明正大的。

例如，您创建密钥生成软件并分发给经销商。该软件可以自动将生成的许可证和任何其他相关数据传达回您的公司。如果软件无法在家通信，则不会生成密钥。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T04:06:07.530

我不确定如果我卖了软件我会这样做，如果我这样做了，我肯定会让用户选择是否参与，但我可以看到某些类型的错误有一些真正的价值（不常见，但相当出乎意料的）直接向错误数据库报告。您可能需要过滤它们，以便根据消息中的某些签名丢弃重复项，或者至少将其标记为这样。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-25T04:28:02.837

我认为是德沃夏克或类似的人曾经报道过这一点。我完全同意他的立场。知情同意是最好的方法。

收缩包装软件应该在包装盒外面清楚地说明需要哪些网络端口，这应该扩展到包括电话主页要求和收集的信息类型。

其他商业软件也一样。在安装过程中、在书面文档、帮助/关于、所需端口和传输的数据类型中显着列出。

我认为法律应该要求这与（美国）食品成分清单相同。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-25T06:02:33.223

Pro, with users' consent (or just add it to your contract)... For me it's mostly about the statistics tracking and I'm kinda a data nazi... but it's nice to be able to show the numbers to the boss... You can examine how many people have purchased it versus how many actually use it; how they use it, when, relationships between customer size and contract monetary amount, etc. The bigwigs love their pie charts, and the Devs really need a good idea what areas need improvement.

Another great reason is that your app can be made to submit feedback directly to the Dev team, if there's a small customer base. Else, submit feedback to a panel of filter people who will build reports and send those to the Dev staff. Either way this feature allows you to know exactly what customers want, quickly and easily, without having to create focus groups and assume the Business people are telling you the truth about customer communications.

Not that the Business people ever lie to the software people, nor obfuscate the meaning of something... :)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-27T14:48:20.250

这里有一些指导方针。

打电话回家检查许可证合规性：

*   仅在安装时。
*   提供互联网或电子邮件选项。
*   使用单向标识符哈希。

打电话回家检查更新：

*   仅在用户许可的情况下。
*   如有必要，使用单向标识符哈希。

电话回家记录崩溃：

*   仅在用户许可的情况下。
*   如有必要，使用单向标识符哈希。
*   允许用户查看正在传递的信息。

电话回家传递统计信息：

*   仅在用户许可的情况下。
*   如有必要，使用单向标识符哈希。
*   允许用户查看正在传递的信息。
*   加密传递的信息。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-25T18:36:18.497

这实际上取决于您是否信任您的客户，以及*您*从努力中获得了多少价值。

有些人会不恰当地使用您的代码。不管你做什么——如果它有价值，就会有人偷走它。不过，这些并不是销售损失，也不认为是。花费 100 万美元试图阻止这种情况只会是 100 万美元，没有投资回报率。

有些客户会为他们的部分使用付费，但不是全部。 **通常**，这是一个疏忽。一旦他们发现过度使用，他们就会为额外的支持付费。监控自己的合规性对客户（希望避免法律费用）和您（因为这将导致购买适当的许可证）都很有价值。花费 100 万美元来实现自我合规将带来投资回报（尽管 ROI 的多少将取决于您的应用程序、您的客户以及他们意外过度使用的程度）。这里的麻烦在于确定投资回报率——很难量化。

一定要现实地看待这一点。追求你能得到的钱，不要试图追逐那些你无论如何都拿不到钱的海盗。这只是浪费了可用于为实际付费客户改进产品的资金，您可以获得某种投资回报率。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-25T06:37:53.060

电话=家庭示例：

一些公司的产品激活需要定期打电话回家才能继续工作。我认为这听起来像你在说什么。我相信 Windows 激活是这样的。

一些公司使用选择加入的家庭电话系统来跟踪您最常使用的功能，或者您如何使用 UI 等。

还有一些公司有崩溃报告之类的东西（例如，微软接受人们非常认真地发送给他们的崩溃报告）和一些（我见过的最新的 CCNetConfig）甚至让你当场提交错误。

这些都不是间谍软件或恶意软件。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-25T09:29:55.990

对用户有好处吗？

用户可以从软件调用中获得许多好处。使用“手动调用”（即用户选择一个命令，表明软件现在将以某种方式连接到您的服务器），没有什么不好的，它可以例如简化更新过程，下载示例或插件，显示您当前的时事通讯，提交准确的诊断和崩溃信息。

自动呼叫需要用户同意，并且显然在技术上独立于他们的另一个功能不应该要求他们。一个典型的用途是更新通知，还有使用情况统计——这开始是为了让你受益。

我们的大多数用户喜欢我们的产品，他们也喜欢我们。在那种情况下，我认为大多数人不会反对一个既有益于我们又不伤害他们的功能。

* * *

打电话回家并不令人反感。打电话回家以牺牲用户隐私为代价赚取额外费用。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-25T05:10:38.227

"I also haven’t a clue how I would architect this. "

A simple way would be to write an application that gets installed along with every one of your revenue generating apps. It knows how to determine what versions of your software is running and it can be triggered to run periodically or it is called from your other apps, etc.

You need a server that just publishes/provides a map (pairs of data) for a product/platform and a version. Then the business logic of determining if a new version is available is on the client. Alternatively you can keep that logic on the server side (a lot to be said for that) and have the client side app send a request with just the current ver/platform info and a response will be generated whether a new version or patch is recommended.

that's just off the top of my head - a real design is called for especially since you have existing software out there apparently.

As for checking for unauthorized use and for collecting statistics I think those are terrible ideas. Companies get burned by that and many earn bad reputations.

Unless you sell it as a service contract that you are going to monitor the software health, etc and the customer asks for it I would drop it.

Come up with a better way to protect your software.

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-25T08:56:52.450

To me, the important aspects are:

*   Explicit opt-in/opt-out.
*   Ensure there's a direct benefit to the user of phoning home (such as updates).
*   Actively design your application to expect and be enhanced via such updates.
*   Make sure you provide regular updates.
*   For users that opt-out, provide a manual means for them to phone home.
*   Do it quietly. Logitech's updates really p* me off - they typically throw up a large dialogue once a week telling me that they're about to check for updates, then another telling me that there aren't any (and there never are).
*   Make sure the app continues to function properly even if it can't phone home.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-25T08:28:17.673

应用程序“phon[ing] home”是一个非常通用的术语，主要以相当歇斯底里的方式使用（“iPhone 手机回家！！”、“Microsoft Vista 手机回家！！”）

任何检查更新的软件都是“打电话回家”。我根本不在乎它是否这样做。

相反，提交尽可能多的信息的垃圾软件（广告软件/间谍软件/病毒）*是*一个问题。

我想这取决于..

*   ..发送什么数据
*   ..如果用户知道发送了什么数据

Sparkle（OS X 应用程序更新框架）能够在检查更新时发送一些基本的系统信息。

我见过的几乎每个使用 Sparkle 的应用程序在“检查更新”旁边都有一个名为“发送匿名系统信息”的选项。更重要的是，它有一个“显示发送的信息”按钮。发回的数据包括 CPU 类型（Intel 或 PPC）、mac 型号（Mabook、Macbook Pro 等）、CPU 数量、CPU 速度。

这是一个很棒的系统——大多数人根本不在乎，它让开发人员了解人们正在使用他们的应用程序的系统类型。如果您对此感到怀疑，您可以禁用更新检查，或者如果您想要自动更新，请告诉它不发送任何信息（显然，除了您的 IP 地址）

# f# - F# int64 转 int

> ID：235880
> 
> 赞同：13
> 
> 时间：2008-10-25T04:02:16.540
> 
> 标签：f#, type-conversion

如何在不使用 的情况下将 an 转换为 F#`Int64`中的类型？`Int32``Microsoft.FSharp.Compatibility.Int32.of_int64`

我这样做是因为当我尝试时交互式似乎不起作用：

```
open Microsoft.FSharp.Compatibility 
```

作为`FSharp.PowerPack`参考添加它说：

> 错误 FS0039：未定义命名空间“兼容性”。

**编辑：**有人对这个问题有答案吗？关于 int 类型的建议很有用且内容丰富，但我在 F# 交互式中打开 powerpack 命名空间时遇到了同样的问题。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-25T04:11:49.530

F# 1.9.6 具有类型转换功能，因此您可以这样做：

```
let num = 1000
let num64 = int64(num) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-25T04:40:17.603

请注意，在这种类型的转换中，当您减小值的大小时，最重要的字节会被丢弃，因此您的数据可能会被截断：

```
> let bignum =  4294967297L;;
val bignum : int64

> let myint = int32(bignum);;
val myint : int32

> myint;;
val it : int32 = 1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T07:00:42.887

请注意，用于转换为每个整数类型的函数与类型本身具有相同的名称，并且在库规范中定义（见下文）。（随着 CTP (1.9.6.2) 的发布，与之前的版本相比，很多库和命名空间发生了一些变化，但它可能会更加“稳定”。）

[http://research.microsoft.com/fsharp/manual/FSharp.Core/Microsoft.FSharp.Core.Operators.html](http://research.microsoft.com/fsharp/manual/FSharp.Core/Microsoft.FSharp.Core.Operators.html)

# apache-flex - 声明式和编程式 SWFLoader

> ID：235885
> 
> 赞同：1
> 
> 时间：2008-10-25T04:06:57.590
> 
> 标签：apache-flex, swfloader

声明式和程序式 SWFLoader 在安全性方面有何区别？在 ff. 代码中，loader1 会引发安全异常，而 loader2 不会。

```
public someFunction(source:String):void
{
  var loader1:SWFLoader = new SWFLoader();
  loader1.load(source);

  loader2.source = source;
}

...

<mx:SWFLoader id="loader2"/> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T21:06:56.303

我认为在安全性方面没有任何区别。*请记住，在实际编译开始之前， mxmlc*编译器会将MXML 转换为 ActionScript ，因此声明性 SWFLoader（或任何其他声明性元素，就此而言）只是创建内容的一种简便方法，而不是手动编码。您可以使用`-compiler.keep-generated-actionscript`mxmlc 参数查看从您的 MXML 生成的代码类型。

在该示例的行中您没有看到运行时错误的原因`loader2.source = source;`是，由于前一行代码调用了一个错误，因此该函数的执行将停在那里。尝试注释掉你调用的那一行，`loader1.load(source)`你会看到下一行抛出这种安全错误：

```
SecurityError: Error #2148: SWF file http://example.com/test.swf cannot access local resource file:///Users/username/Desktop/picture.jpg. Only local-with-filesystem and trusted local SWF files may access local resources.
    at flash.display::Loader/_load()
    at flash.display::Loader/load()
    at mx.controls::SWFLoader/loadContent()
    at mx.controls::SWFLoader/load()
    at mx.controls::SWFLoader/commitProperties()
    at mx.core::UIComponent/validateProperties()
    at mx.managers::LayoutManager/validateProperties()
    at mx.managers::LayoutManager/doPhasedInstantiation()
    at Function/http://adobe.com/AS3/2006/builtin::apply()
    at mx.core::UIComponent/callLaterDispatcher2()
    at mx.core::UIComponent/callLaterDispatcher() 
```

# ruby - 对象流行度（Prevayler、Madeleine）是否已在生产系统中使用？

> ID：235889
> 
> 赞同：4
> 
> 时间：2008-10-25T04:08:22.720
> 
> 标签：ruby, persistence

对象流行机制是否已在实际生产系统中使用？我指的是像[Prevayler](http://www.prevayler.org/wiki/)或[Madeleine这样的东西](http://madeleine.rubyforge.org/)

我发现的唯一东西是[Instiki](http://en.wikipedia.org/wiki/Instiki)，一个 wiki 引擎。但自从他们开始他们已经切换到 SQLite。（实际的[instiki](http://www.instiki.org/)页面已关闭）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-11-20T17:17:57.070

我曾经工作的一家公司使用 Prevayler 作为基于计算机的学生考试/评估系统的一部分大约五六年。

Prevayler 用于将考生的测试状态存储在物理上位于单个测试中心内的服务器上。存储的数据量相当低，因为最多只有几百名考生在一个考试中心参加考试。因此，在 2004 年在商品硬件上运行 Prevayler 是切实可行的——“服务器”在大多数情况下只是一个典型的低端台式机，为了运行考试而临时借用。

这个想法是，如果考生的计算机在他们参加考试时崩溃了，那么他们可以在同一台或不同的计算机上快速恢复考试。它工作得很好。

当某些新要求导致对象模型发生变化时，偶尔会遇到困难，因为默认情况下 Prevayler 将对象模型与磁盘上的数据表示紧密耦合。这对我们来说实际上并不是一个主要问题，因为对象模型的更改发生在考试之间，此时我们通常可以负担得起丢弃旧数据（由于我们的设计不佳而导致一些例外）。

您可以做很多事情来使更改对象模型变得可行，这是最适合您的应用程序的问题。对我们来说，丢弃旧数据通常是最好的解决方案。

还有一个后端系统将来自所有考试中心的考生的考试汇总到一个 SQL 数据库中。这存储的数据量比 Prevayler 当时可以合理处理的要多。今天在那里使用 Prevayler 可能是可行的，但我不认为使用模式特别适合 Prevayler，因为大多数数据往往被写入，读取一次以进行标记，然后被遗忘并被视为存档数据除非查询到测试结果。

那家公司已经离开了 Prevayler，但其原因更多的是政治而非技术。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T14:05:19.910

*好吧，我们在一个计划在明年某个时候投入*生产的项目中使用 Prevayler ，但我们还不够接近，无法提供任何真正的球探报告。我们*认为*它会起作用......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-03T11:40:48.510

“LMAX 是一个新的零售金融交易平台。因此它必须以低延迟处理许多交易。该系统建立在 JVM 平台上，以业务逻辑处理器为中心，可在单线程上每秒处理 600 万笔订单. 业务逻辑处理器使用事件溯源完全在内存中运行。”

[http://martinfowler.com/articles/lmax.html](http://martinfowler.com/articles/lmax.html)

# .net - 为什么 AllowPartiallyTrustedCallers 不是默认值？

> ID：235895
> 
> 赞同：1
> 
> 时间：2008-10-25T04:19:56.083
> 
> 标签：.net, assemblies

对于允许除完全受信任的调用方以外的任何内容的 .NET 程序集，必须使用[AllowPartiallyTrustedCallers](http://msdn.microsoft.com/en-us/library/system.security.allowpartiallytrustedcallersattribute.aspx)对程序集进行签名和属性化。

但是即使这样，CLR 仍然（幸运的是）检查代码权限以确保部分受信任的调用者可以执行所需的代码。

所以我的问题是，为什么不对所有程序集假定 AllowPartiallyTrustedCallers 属性？为什么不让那些真正不希望部分受信任的呼叫者必须使用诸如 DenyPartiallyTrustedCallers 之类的属性的相反呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T04:28:45.910

编写部分受信任的调用者无法调用的代码很容易。编写无法调用的代码很难。这就是为什么最好选择加入而不是退出。

让权限较少的人呼叫权限较多的人是一件大事。

# .net - 解释 Visual Studio 2005 线程窗口

> ID：235927
> 
> 赞同：1
> 
> 时间：2008-10-25T05:04:03.590
> 
> 标签：.net, visual-studio, multithreading

我在 Visual Studio 2005 中创建了一个简单的 .NET windows 应用程序，在输入主窗体加载事件时，我的线程窗口如下图所示：

[http://img519.imageshack.us/my.php?image=threadshh4.jpg](http://img519.imageshack.us/my.php?image=threadshh4.jpg)

我的问题是

1）为什么我还没有启动任何线程时首先有这么多线程（除了我的应用程序的“主线程”）

2）这个名为“.Net SystemEvents”的线程是做什么的？

3）为什么除了主线程之外的所有线程的“位置”列下的条目都是空的？

**编辑：**
4）是否有可能使这些线程无法启动？或者一段时间后离开？
5) 他们打算做什么？他们的目的是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T05:14:49.530

1) 它们是属于托管框架的线程。

2）它监视您可以为其注册事件处理程序的系统事件，例如当您更改显示设置时等。

3) 因为它们是框架的一部分而不是您的应用程序代码，所以调试器不知道源位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T17:41:29.180

请记住，非托管线程和托管线程之间存在一对多的关系。

有一种方法可以将 SystemEvents 通知程序移动到您的线程中：

```
public static class ThreadingHelper_NativeMethods
{
   [DllImport("user32.dll")]
   public static extern bool IsGUIThread(bool bConvert);
}

     // This code forces initialization of .NET BroadcastEventWindow to the UI thread.
     // http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/fb267827-1765-4bd9-ae2f-0abbd5a2ae22
     if (ThreadingHelper_NativeMethods.IsGUIThread(false))
     {
        Microsoft.Win32.SystemEvents.InvokeOnEventsThread(new MethodInvoker(delegate()
        {
           int x = 0;
        }));
     } 
```

# vb6 - How do I make a function happen 50% of the time in vb6

> ID：235940
> 
> 赞同：0
> 
> 时间：2008-10-25T05:17:03.673
> 
> 标签：vb6, random

Making a small app, and I want a function to execute 50% of the time. So if I were to dbl click the exe half the time the function would execute, and the other half it wouldn't. I can't seem to find anyway to easily do this, the one solution I tried seemed to determine the chance on compile rather than on run. Thanks in advance!

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T10:19:00.943

不要忘记播种随机发生器！否则，它每次都会给你相同的价值。您使用“”播种它`Randomize Timer`，例如：

```
Private Sub Main()
    Randomize Timer
    If Rnd > 0.5 Then
        ExecuteFunction ()
    End If
End Sub 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T05:20:07.583

Generate a random decimal number between 0 and 1\. If it is greater than 0.5 run, if it is less than or equal to 0.5 do not run.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T05:26:13.907

For example:

```
Private Sub Main()
    If Rnd > 0.5 Then
        ExecuteFunction ()
    End If
End Sub 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T06:30:29.127

如果您希望它随机运行，其他人已经提供了该解决方案。如果您想要一个更具确定性的行为（它必须准确地每秒钟运行一次），您将需要在执行之间存储状态。

您可以通过（例如）尝试从文件中读取整数（如果文件不存在，将其设置为零）将状态保存在注册表或文件系统中，加 1 并将其写回同一个文件。

如果写回的数字是偶数，则运行您的函数，否则退出。

这样，您将在执行和不执行之间交替。

# django - 如何查找特定用户的 django 会话？

> ID：235950
> 
> 赞同：60
> 
> 时间：2008-10-25T05:27:42.000
> 
> 标签：django, authentication, session

我正在编写一个应用程序，我将从 django 和独立应用程序访问数据库。两者都需要进行会话验证，并且两者的会话应该相同。Django 有一个内置的身份验证/会话验证，这就是我正在使用的，现在我需要弄清楚如何为我的独立应用程序重用相同的会话。

我的问题是如何查找特定用户的 session_key？

从外观上看，没有任何东西可以将 auth_user 和 django_session 联系在一起

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2014-09-29T10:19:05.737

这个答案是在最初的问题发布五年后发布的，但是在搜索这个问题的解决方案时，这个 SO 线程是谷歌的顶级结果之一（它仍然是 Django 不支持开箱即用的东西）。

对于只关心登录用户会话的用例，我有一个替代解决方案，它使用附加`UserSession`模型将用户映射到他们的会话，如下所示：

```
from django.conf import settings
from django.db import models
from django.contrib.sessions.models import Session

class UserSession(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL)
    session = models.ForeignKey(Session) 
```

`UserSession`然后，您可以在用户登录时简单地保存一个新实例：

```
from django.contrib.auth.signals import user_logged_in

def user_logged_in_handler(sender, request, user, **kwargs):
    UserSession.objects.get_or_create(user = user, session_id = request.session.session_key)

user_logged_in.connect(user_logged_in_handler) 
```

最后，当您想列出（并可能清除）特定用户的会话时：

```
from .models import UserSession

def delete_user_sessions(user):
    user_sessions = UserSession.objects.filter(user = user)
    for user_session in user_sessions:
        user_session.session.delete() 
```

这就是它的具体细节，如果你想了解更多细节，我有一篇[博客文章](http://gavinballard.com/associating-django-users-sessions/)涵盖了它。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2011-06-04T17:36:31.230

我找到了这个代码片段

```
from django.contrib.sessions.models import Session
from django.contrib.auth.models import User

session_key = '8cae76c505f15432b48c8292a7dd0e54'

session = Session.objects.get(session_key=session_key)
uid = session.get_decoded().get('_auth_user_id')
user = User.objects.get(pk=uid)

print user.username, user.get_full_name(), user.email 
```

这里 [http://scottbarnham.com/blog/2008/12/04/get-user-from-session-key-in-django/](http://scottbarnham.com/blog/2008/12/04/get-user-from-session-key-in-django/)

尚未验证它，但看起来很简单。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-10-25T06:44:49.583

这有点棘手，因为并非每个会话都必须与经过身份验证的用户相关联；Django 的会话框架也支持匿名会话，任何访问您网站的人都会有一个会话，无论他们是否登录。

由于会话对象本身是序列化的，这一点变得更加棘手——因为 Django 无法知道您究竟想要存储哪些数据，它只是将会话数据的字典序列化为字符串（使用 Python 的标准“pickle”模块）并将其填充到您的数据库中。

如果您有会话密钥（将由用户的浏览器作为 cookie 值“sessionid”发送），获取数据的最简单方法是使用该密钥查询会话表以获取会话，这将返回一个 Session目的。然后，您可以调用该对象的“get_decoded()”方法来获取会话数据字典。如果您不使用 Django，可以查看源代码 (django/contrib/sessions/models.py) 以了解会话数据是如何反序列化的。

但是，如果您有用户 id，则需要遍历所有 Session 对象，反序列化每个对象并查找具有名为“_auth_user_id”的键的对象，并且该键的值是用户 id .

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-10-25T23:33:16.977

修改`django_session`表以添加显式`user_id`可以使生活更轻松。假设您这样做（或类似的事情），这里有四种方法可以根据您的喜好调整事物：

分叉`django.contrib.session`代码。我知道，我知道，这是一个可怕的建议。但它只有 500 行，包括所有后端并减去测试。破解非常简单。仅当您要对事情进行认真的重新安排时，这才是最佳途径。

如果您不想分叉，您可以尝试连接到`Session.post_save`信号并在那里进行调整。

或者你可以 MonkeyPatch `contrib.session.models.Session.save()`。只需包装现有方法（或创建一个新方法），突破/合成您需要的任何值，将它们存储在新字段中，然后`super(Session, self).save()`.

另一种方法是`SessionMiddleware`在您的*settings.py*文件中放入 2 个（是的，两个）中间件类——一个在之前，一个在之后。这是因为中间件的处理方式。后面列出的`SessionMiddleware`将在入站请求中获得一个已附加会话的请求。前面列出的可以对响应进行任何处理和/或更改/重新保存会话。

我们使用最后一种技术的变体来为搜索引擎蜘蛛创建伪会话，以使它们能够对通常仅限成员的材料进行特殊访问。我们还检测该字段来自相关搜索引擎的入站链接，`REFERER`并为用户提供对该文章的完全访问权限。

**更新：**

我的答案现在很古老，尽管它仍然大部分是正确的。请参阅下面@Gavin_Ballard 的最新答案（2014 年 9 月 29 日），了解解决此问题的另一种方法。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-02-03T22:16:26.497

彼得罗威尔，感谢您的回复。这是一个巨大的帮助。这就是我为使其正常工作所做的。只需要更改 djang.contrib.sessions 中的一个文件。

在 django/contrib/sessions/models.py 中，将 user_id 添加到表中（手动添加到 DB 表或删除表并运行 manage.py syncdb）。

```
class Session(models.Model):

    ...

    user_id = models.IntegerField(_('user_id'), null=True)

    ...

    def save(self, *args, **kwargs):
        user_id = self.get_decoded().get('_auth_user_id')
        if ( user_id != None ):
            self.user_id = user_id

        # Call the "real" save() method.
        super(Session, self).save(*args, **kwargs) 
```

现在在您登录的视图中（如果您使用 django 的基本登录，则必须覆盖它）

```
# On login, destroy all prev sessions
        # This disallows multiple logins from different browsers
        dbSessions = Session.objects.filter( user_id = request.user.id )
        for index, dbSession in enumerate( dbSessions ):
            if ( dbSession.session_key != request.session.session_key ):
                dbSession.delete() 
```

这对我有用。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-07-18T11:26:19.447

当我想踢出垃圾邮件发送者时，我遇到了这个问题。似乎将他们的帐户设置为“非活动”是不够的，因为他们仍然可以参加之前的会话。那么 - 如何删除特定用户的会话，或者如何故意使特定用户的会话过期？

答案是使用该`last_login`字段来跟踪会话被禁用的时间，这会告诉您`expire_date`是两周后，这使您可以对会话表执行有用的过滤器：

```
from django.contrib.sessions.models import Session
from django.contrib.auth.models import User
from datetime import datetime
from dateutil.relativedelta import relativedelta

baduser = User.objects.get(username="whoever")     
two_weeks = relativedelta(weeks=2)
two_hours = relativedelta(hours=2)
expiry = baduser.last_login + two_weeks
sessions = Session.objects.filter(
    expire_date__gt=expiry - two_hours,
    expire_date__lt=expiry + two_hours
) 
print sessions.count() # hopefully a manageable number

for s in sessions:
    if s.get_decoded().get('_auth_user_id') == baduser.id:
        print(s)
        s.delete() 
```

# asp.net-mvc - 保存 dbml 后，我的 MVC 中无法访问 Linq DataContext 类

> ID：235955
> 
> 赞同：2
> 
> 时间：2008-10-25T05:30:39.543
> 
> 标签：asp.net-mvc, linq, linq-to-sql, datacontext

我刚刚下载了 MVC，我正在学习一个教程。一切都很好，直到我尝试声明一个 DataContext 对象。

我的 dbml 被命名为**db.dbml**（在名为 test.dbml 上尝试了另一个），当我尝试这个时：

```
public dbDataContext db = new dbDataContext(); 
```

我得到：

> 找不到类型或命名空间名称“dbDataContext”...

我错过了什么吗？在 webforms 中，这就是我所要做的，而在教程中，这就是所有显示的内容。我今天下载了最新的MVC...

谢谢你。

**编辑：我正在使用 VS2008 SP1

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-31T20:04:14.330

如果您使用部分类，这是一个 sp1 错误，请参阅以下内容和解决方法： [https ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=361577](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=361577)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T00:27:44.870

几个快速的问题：您的数据上下文的名称是“dbDataContext”吗？...此外，它是否在命名空间中？（您是否引用了该命名空间）。

另一个问题......这是运行时错误还是编译时错误？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T00:32:38.543

尝试将上下文添加到命名空间 {ProjectName}.Models...

因为模型存储在模型命名空间中..尝试检查您是否在当前上下文中包含命名空间..

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-11-04T03:11:11.710

添加课程后，只需构建解决方案即可。您将在列表中找到您的课程

# agile - Are you an agile/pragmatic developer in a waterfall organization?

> ID：235957
> 
> 赞同：5
> 
> 时间：2008-10-25T05:32:21.990
> 
> 标签：agile, waterfall

If so, how do you deal with things that just don't "feel" right such as:

*   not writing unit tests
*   not having a continuous build
*   not refactoring
*   not having a team coding standard
*   not pair programming
*   not doing iterations
*   no daily standups
*   no retrospectives

Now, some agile organizations do leave out some of these practices, but most successful ones incorporate most of them.

What do you do to deal with the seeming chaos of the traditional development processes?

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-25T05:54:53.363

Actually, I'm a Waterfall developer in an Agile organization.

Things that don't "feel" right to me include:

*   Starting work on a project with barely any idea what it should do.
*   Documenting the processes, but not the products; being unable to get information without having to go talk to someone. All I should need is a Requirements document, a Design document (which I may write myself), and Google.
*   Spending more time in meetings than coding.
*   Spending more time coding at home than at work.
*   Having no idea when the project will be done.
*   PM's being useful in any way.
*   Having a meeting to prepare for a meeting to prepare for a meeting where somebody else logs onto a server and copies a file; thus spending six hours on a process that takes six minutes
*   Multiple checkouts
*   Knowing how something should flow, but not having actual requirements.
*   Developers' unique skill sets are downplayed or outright ignored as they make the developer non-interchangeable.
*   When there are no stories remaining... nothing to do... just kinda sit there... Could be adding a new feature; may not be needed but the time isn't being wasted...
*   Every six months when I change contracts, I have to adapt to a new coding standard? By the time I get used to it, I'm already looking for my next contract.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T06:29:35.057

不要陷入“抱怨”模式。我会选择回答问题的“处理它”部分。根据我的经验，我已经达到了以下选项

1.  稍微简单的方法：退出并找到一个更适合您的地方......我说有点容易，因为杂项。子问题：您附近可能不存在“敏捷”工作场所。搬迁可能不是可行的方法，敏捷工作场所中的人可能是“不敏捷”的，
2.  中路：个人继续敏捷。帮助和教其他感兴趣的人..也许是组织。会慢慢变好。希望最好的，祈祷你不要达到“不归路的退出点”
3.  超级困难的方法：努力为您的组织带来变革。这不是每个人的一杯茶。一个组织的文化不可能在短时间内改变……你需要一个管理中的“本地赞助商”来开始任何实质性的事情。再加上这样一个事实，即除了你自己，你无法真正改变另一个人。因此，如果你充满激情、耐心、坚持不懈、高度乐观并愿意全力以赴，我会全心推荐“**[无畏变革](http://www.cs.unca.edu/%7Emanns/intropatterns.html)**”。[（来源：][[informit.com](http://www.informit.com/ShowCover.aspx?isbn=0201741571&type=f)][）]
    [![替代文字](https://i.stack.imgur.com/1nuYl.jpg)](https://i.stack.imgur.com/1nuYl.jpg)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T05:41:30.817

Why are these practices incompatible with waterfall? As far as I can tell almost all of these if not absolutely all of them are possible with a waterfall approach. There is no particular reason waterfall development has to be chaotic. It may have other drawbacks/challenges but chaos is not likely to be high on the list.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T08:45:24.767

说真的，如果你的组织像你描述的那样混乱和业余，我会在他们倒闭之前开始寻找另一份工作。正如[马丁·福勒曾经打趣的那样](http://martinfowler.com/articles/xp2000.html)

> 如果您无法更改您的组织，请更改您的组织

另一方面，如果你觉得他们可以改变，那么我会尝试通过在你的清单上的任何其他内容之前引入**回顾来开始改变。**如果你能让人们互相交谈并开始识别正在发生的浪费，并且相关人员有足够的授权来听取反馈并做出改变，无论多么试探，你都会走在正确的轨道上。

您确定的所有其他实践都是消除特定类型浪费的技术——例如，编写单元测试以减少在项目后期修复缺陷的浪费。通过举办回顾展，您将了解这些浪费，并为人们提供一个空间，让他们决定他们可能喜欢更专业地做事。

归根结底，这是关于自尊：你、你的同事和整个组织的自尊。您是否满足于只是按照以往的方式糊弄过去，或者您是否想尽可能地做好自己的工作？

祝你好运！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T06:20:47.133

首先，敏捷方法强调这些实践，但没有引入它们。在敏捷出现之前，他们就已经在软件开发过程中出现了。所以简单地说，如果你没有使用 Scrum/XP/RUP，那么你就没有遵循这些实践是完全错误的。如果您是专业的软件开发组织，这些实践将以一种或另一种形式存在。

其次，无论您是瀑布组织中的敏捷开发人员还是反之亦然，您都不能做太多事情，至少不能有效或显着。组织所拥有的发展“文化”取决于管理层和执行人员的承诺和重点。如果那不存在，你可以做你的'一点'，但你最终会失败。这就是许多组织在过渡到敏捷时失败的原因，因为他们不愿意进行文化变革。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-25T07:35:56.857

我在一个伪敏捷组织中，这是我对您提出的这些观点的回应：

*   不编写单元测试：我相信 100% 的覆盖率。是的，很容易说你可以拥有 100% 的覆盖率并编写非常糟糕的测试，但是，我编写的任何新代码，我都会尽我所能进行验收或集成测试，并对*我*所做的工作有 100% 的覆盖率。在构建中，我进行了覆盖检查以确保它不会低于当前限制。
*   没有连续构建：由于每个人之前的工作方式，大多数人在没有覆盖检查的情况下运行构建，因此可以在没有测试的情况下随意检查他们喜欢的任何内容。更不用说连续构建有时似乎开启，有时似乎关闭。我非常接近建立自己的 CI 盒。
*   不重构：我尽我所能重构，所以当我再次看到同一个类时我不会呕吐。
*   没有团队编码标准：公司有编码标准，但是它有很多问题。因此，我尽我所能与更高层的人一起提出问题以改变它。有时以他们认为正确的方式编码会很痛苦。例如，在整个文件中为公共、私有、受保护、字段、常量等放置巨大的 java 注释部分标题。我相信这是从前完成的，因为类变得如此失控（例如数千行长）以至于它们需要节标题，以便您可以找到公共方法的开始位置和私有方法的开始位置（！！）
*   不结对编程：幸运的是，我身后有一个跟我想法一样的人，我们尽可能多地转动椅子来交谈和讨论想法以弥补。
*   不做迭代：我们有 3 周的迭代，但感觉非常临时。每次迭代之间都有一个清理/审查周，这使得它理论上是一个 4 周的迭代。我对此无能为力。很难说服他们缩短这些迭代时间，因为代码太糟糕了，实际上*需要*3 周来编写本应该只需要 1 周的东西。
*   没有每日站立：我们有站立。
*   没有回顾：我们有回顾。

# asp.net - 在没有 ViewState 的情况下提高 OnMenuItemClick？

> ID：235959
> 
> 赞同：2
> 
> 时间：2008-10-25T05:38:20.073
> 
> 标签：asp.net, viewstate

我有一个（派生的）菜单控件，它显示来自自定义数据源的相当大的项目列表。我需要在菜单上禁用 ViewState 以避免在某些其他控件导致当前选择在回发时更改时非常烦人的“无法选择禁用或不可选择的菜单项”。

不幸的是，当菜单的 ViewState 被禁用时，菜单生成的回*发*不会引发任何事件。如果我启用 ViewState，则会引发 OnMenuItemClick 事件。如果我禁用 ViewState，则不会引发 OnMenuItemClick。我很困惑。

我需要为菜单关闭 ViewState，那么如何处理来自实际菜单的回发？

在这一点上，我倾向于使用菜单的加载事件，解析 __EVENTTARGET 以查看它是否是菜单，然后从那里开始。从技术上讲，这将在正常情况下处理回发事件，但这没关系，我猜。

有更好的想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T09:06:02.617

是的，您可以选择使用视图状态重新填充绑定控件，或者您可以在事件触发之前对其进行数据绑定（Page_Load 很好）。

不过，我不一定总是在 Page_PreRender 中重新绑定它，如果此回发没有任何更改（更改发生在页面上的其他地方），则没有理由再次绑定它。

相反，当您知道必须更改时，您可能只能绑定某些事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T03:40:19.523

我已经弄清楚了问题的本质。使用 Reflector 我们可以看到处理实际回发然后引发事件的低级方法的重要部分：

```
string str = HttpUtility.HtmlDecode(eventArgument);
...
MenuItem item = this.Items.FindItem(str.Split(new char[] { '\\' }), 0);
if (item != null)
    this.OnMenuItemClick(new MenuEventArgs(item)); 
```

如您所见，MenuEventArgs 被交给了一个 MenuItem。如果在当前的 Items 集合中找不到与传入的帖子数据匹配的对象，则不会引发该事件。禁用 ViewState 后，菜单没有任何项目（它们将使用 ViewState 重建）。所以不会引发事件。

为了解决这个问题，我已经告诉菜单在加载期间使用尚未更新的数据构建自己（此时它将与上次请求结束时相同）。这与从 ViewState 重建菜单基本相同，因此我对性能或其他方面的感觉并不差。OnMenuItemClick 然后按预期触发。最后，在 PreRender 期间，我告诉 Menu 再次重建，因此它反映了在生命周期的回发处理部分发生的更改。

我在这上面浪费了很多时间，所以希望这些信息可以帮助处于类似情况的其他人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-14T20:33:34.207

在 Page_Load 中将控件重新绑定到站点地图数据并检查是否为 IsPostBack。

```
if (IsPostBack) {
            Menu.DataBind();
} 
```

这对我有用并减少了视图状态。

# connection - VistaDB 连接问题以编程方式使用 SQLConnection 和 ConnectionString

> ID：235960
> 
> 赞同：0
> 
> 时间：2008-10-25T05:39:13.083
> 
> 标签：connection, vistadb

使用 web.config 文件中的连接字符串连接到 VistaDB 时出现错误。

在我指定 ProviderName 之后使用 SQLDataSource 可以正常工作。在另一个页面上，我只连接代码和

*这是连接字符串的代码：*

Public Function CreateConnection() As SqlConnection _connectionString = ConfigurationManager.ConnectionStrings("ConnectionString").ToString() Return New SqlConnection(_connectionString) End Function

*这是错误：*

> 建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。服务器未找到或无法访问。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。（提供者：SQL 网络接口，错误：26 - 错误定位服务器/指定的实例）

**如何解决此错误？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T21:51:21.267

您不能将 SqlConnection 与 VistaDB 连接字符串一起使用。那是您从 SQL Server 得到的错误 - 它找不到该服务器。

请改用 VistaDBConnection。

# javascript - 从 AJAX 调用返回的 html 中调用 jQuery 函数

> ID：235967
> 
> 赞同：21
> 
> 时间：2008-10-25T05:45:36.877
> 
> 标签：javascript, jquery, ajax

我正在开发一个使用 jQuery 的网页。我有一个从服务器获取数据并更新 div 的 Ajax 调用。在该数据中有一个 jQuery 函数，但在将数据加载到页面后不会调用该函数。我已经在页面中包含了正确的 js 文件。

这是从 Ajax 调用返回并放入 div 的内容：

```
<script type="text/javascript">
    $(function() {
         $('input').myFunction('param');             
    }); 
</script>
<p> other html </p> 
```

在将 html 插入页面后，如何让返回的 javascript 运行？

（我正在使用带有 jRails 插件的 Rails）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-25T06:14:12.840

如果您想要 JavaScript 标记评估，带有 html 内容，您应该将 ajax 调用的 dataType 选项设置为“html”：

```
$.ajax({
  type: "GET",
  url: "yourPage.htm",
  dataType: "html"
}); 
```

或者 dataType "script"，如果你想加载和执行一个 .js 文件：

```
$.ajax({
  type: "GET",
  url: "test.js",
  dataType: "script"
}); 
```

更多信息：[Ajax/jQuery.ajax](http://docs.jquery.com/Ajax/jQuery.ajax#options)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-21T18:10:06.853

我有一个类似的问题，我想将小的 jquery 日期选择器添加到我通过 ajax 检索的几个字段中。这就是我为解决它所做的......只是又快又脏。而不是从我的 ajax 调用中返回整个块：

```
<script type="text/javascript">
    $(function() {
         $('input').myFunction('param');                         
    }); 
</script>
<p> other html </p> 
```

我会返回这个（注意编造的 |x| 分隔符）

```
 $(function() {
         $('input').myFunction('param');                         
    }); 

|x|

<p> other html </p> 
```

然后当我通过 ajax 接收到数据时，我将返回值分成两部分：要执行的 javascript 和要显示的 html：

```
 r = returnvalfromajax.split("|x|");       
 document.getElementById('whatever').innerHTML = r[1];  
 eval(r[0]); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-06T16:55:07.087

改变

```
<script type="text/javascript">
...
</script> 
```

到：

```
<script>
...
</script> 
```

为我解决了这个问题。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-07-17T14:16:10.077

好吧，您可以使用 jQuery load() 函数：[http](http://docs.jquery.com/Ajax/load#urldatacallback) ://docs.jquery.com/Ajax/load#urldatacallback 作为回调，您可以定义将在加载新内容示例后执行的函数：

$("#feeds").load("new_content.html",, doSomething());

在 new_content.html 中你可以定义函数 doSomething()...

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-12-02T13:49:16.033

对于 ajax.net，该`endRequestHandler(sender, args)`解决方案工作正常

* * *

## 回答 #6

> 赞同：-7
> 
> 时间：2009-05-11T10:10:59.390

你试过 Sys.WebForms.PageRequestManager.add_endRequest 方法吗？

```
 $(document).ready(function()
    {
        Sys.WebForms.PageRequestManager.getInstance().add_endRequest(endRequestHandler);           
    }
    );
    function endRequestHandler(sender, args)
    {
        // whatever
    } 
```

# c# - 在不同的应用程序中复制和修改选定的文本

> ID：235972
> 
> 赞同：10
> 
> 时间：2008-10-25T05:53:34.897
> 
> 标签：c#, .net, clipboard, hotkeys

我有一个在后端运行的 Windows 应用程序。我将此应用程序中的功能映射到热键。就像我在这个函数中放入一个消息框并将热键作为`Alt`++ 。然后按，同时出现消息框。到目前为止，我的应用程序运行良好。`Ctrl``D``Alt``Ctrl``D`

现在我想在这个函数中编写一个代码，这样当我使用像记事本这样的另一个应用程序时，我选择一个特定的文本行并按热键`Alt`++它应该复制选定的文本，并在其后面加上“_copied”`Ctrl`和`D`将其粘贴回记事本。

任何尝试过类似应用程序的人都请帮助我提供宝贵的意见。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-07T18:49:56.293

你的问题有两个答案

## 我的应用程序如何设置全局热键

您必须调用一个名为 RegisterHotKey 的 API 函数

```
BOOL RegisterHotKey(
    HWND hWnd,         // window to receive hot-key notification
    int id,            // identifier of hot key
    UINT fsModifiers,  // key-modifier flags
    UINT vk            // virtual-key code
); 
```

更多信息在这里： http: [//www.codeproject.com/KB/system/nishhotkeys01.aspx](http://www.codeproject.com/KB/system/nishhotkeys01.aspx)

## 如何从前台窗口中获取选定的文本

最简单的方法是将 crl-C 发送到窗口，然后捕获剪贴板内容。

```
[DllImport("User32.dll")] 
private static extern bool SetForegroundWindow(IntPtr hWnd);

[DllImport("user32.dll", CharSet=CharSet.Auto)]
static public extern IntPtr GetForegroundWindow();

[DllImport("user32.dll")]
static extern void keybd_event(byte bVk, byte bScan, uint dwFlags, uint dwExtraInfo);

.....

private void SendCtrlC(IntPtr hWnd)
    {
    uint KEYEVENTF_KEYUP = 2;
    byte VK_CONTROL = 0x11;
    SetForegroundWindow(hWnd);
    keybd_event(VK_CONTROL,0,0,0);
    keybd_event (0x43, 0, 0, 0 ); //Send the C key (43 is "C")
    keybd_event (0x43, 0, KEYEVENTF_KEYUP, 0);
    keybd_event (VK_CONTROL, 0, KEYEVENTF_KEYUP, 0);// 'Left Control Up

} 
```

免责声明：Marcus Peters 的代码来自此处：[http](http://bytes.com/forum/post1029553-5.html)
://bytes.com/forum/post1029553-5.html 为了您的方便而在此处发布。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T09:54:04.007

使用[Clipboard](http://msdn.microsoft.com/library/system.windows.forms.clipboard.aspx)类将内容复制到剪贴板，然后粘贴到记事本中。

您还可以将内容写入文本文件，并通过运行 notepad.exe 应用程序并将文本文件的路径作为命令行参数使用记事本打开它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-01-28T16:01:54.003

## 2020 年更新

### 如何从前台窗口中获取选定的文本

不知道这可能持续了多长时间，但我没有与大多数 SO 线程中关于该主题的建议的Win32 编程（主要是`user32.dll`各种 Windows 消息`WM_GETTEXT, WM_COPY`和各种调用）作斗争，**我很容易设法在任何窗口中访问选定的文本我的 C# 代码如下**：`SendMessage(handle, WM_GETTEXT, maxLength, sb)`

 **```
// programatically copy selected text into clipboard
await System.Threading.Tasks.Task.Factory.StartNew(fetchSelectionToClipboard);

// access clipboard which now contains selected text in foreground window (active application)
await System.Threading.Tasks.Task.Factory.StartNew(useClipBoardValue); 
```

这里调用的方法：

```
static void fetchSelectionToClipboard()
{
  Thread.Sleep(400);
  SendKeys.SendWait("^c");   // magic line which copies selected text to clipboard
  Thread.Sleep(400);
}

// depends on the type of your app, you sometimes need to access clipboard from a Single Thread Appartment model..therefore I'm creating a new thread here
static void useClipBoardValue()
{
  Exception threadEx = null;
  // Single Thread Apartment model
  Thread staThread = new Thread(
     delegate ()
       {
          try
          {
             Console.WriteLine(Clipboard.GetText());
          }
          catch (Exception ex)
          {
            threadEx = ex;
          }
      });
  staThread.SetApartmentState(ApartmentState.STA);
  staThread.Start();
  staThread.Join();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T16:04:48.647

我认为您可以使用[SendInput](http://msdn.microsoft.com/en-us/library/ms646310.aspx "发送输入")函数将文本发送到目标窗口，或者如果您之前已将其放入剪贴板，则只需将其粘贴的命令即可。

# javascript - StackOverflow 中如何设置代码颜色？

> ID：235982
> 
> 赞同：15
> 
> 时间：2008-10-25T06:03:40.023
> 
> 标签：javascript, syntax-highlighting

StackOverflow 对我来说最喜欢的功能是它可以在 post 中自动检测代码并为代码设置适当的颜色。

我想知道颜色是如何设置的。当我在页面上做`Ctrl`+`F5`时，代码似乎首先是黑色文本，然后变为彩色。它是由 jQuery 完成的吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-25T06:10:43.973

来自[Stack Overflow 播客 #11](https://stackoverflow.fogbugz.com/default.asp?W12621)：

> **阿特伍德：**是的。好的，这来自于我认为是某个 Google 工程师编写的项目——它被称为“Prettify”。有趣的是，它实际上推断出所有的语法高亮，这听起来像是不可能的——如果你仔细想想，这听起来真的很疯狂。但它实际上有点工作。现在，他只支持它，有些方言不能很好地使用它，但是对于所有那种方言，你可以在谷歌上找到。我认为它来自谷歌的谷歌代码。它是实际代码，它是 Google Code 上的实际 JavaScript，它突出显示了当您在 Google Code 上托管项目时返回的代码。还有你，还有你，嗯，'
> 
> **Spolsky：**他们怎么知道，他们怎么知道你写的是什么语言？因此，评论是什么，并且...
> 
> **阿特伍德：**我不知道。这很疯狂。它是 prettify.js，所以如果有人对此感兴趣，只需在网络上搜索“prettify.js”，你就会找到它。

在这里你可以找到 prettify.js：[http ://code.google.com/p/google-code-prettify/](http://code.google.com/p/google-code-prettify/)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-25T07:41:39.780

在回复..

> Spolsky：他们怎么知道，他们怎么知道你写的是什么语言？

它没有。荧光笔非常愚蠢，但由于大多数编程语言非常相似，因此设法摆脱了它。几乎所有东西都使用足够接近的语法来......

```
AFunction("a string")
1 + 4 # <- numbers
      #     /\ a comment
      // also a comment.. 
```

..大多数东西都能正确突出显示。以上不是一种实际的编程语言，但它完美地突出显示。

也有例外，例如，它有时可以将 a`/`视为正则表达式的开头（如在 Perl/Ruby 中）。如果不是：

```
this [^\s>/] # is highlighted as a regex, not a comment 
```

..但这些是相当罕见的，它可以很好地解决大多数事情，比如..

```
/*
this is a multi-line comment
"with a string" =~ /and a regex/
*/
but =~ /this is a regex with a [/*] multiline comment
markers in it! */ 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T14:05:46.663

正如 dbr 所说，它对最常见的语言结构做了一个虚拟的亮点。这不适用于一些奇异的语法。我想知道我们是否可以在不突出显示的情况下进行代码部分，顺便说一句。

```
For id = 1 To 10 Do
  CallSomething() // It likes CamelCase identifiers...
End

for id = 1 to 10 do # Also highlight some common keywords...
  if id % 2 then call_something(); x++; end
end

'str' "str" 12 + 15.6 * -7e+9 /* Some common constant forms */
=/regex/ ~/regex/ +/RE/ !/regexpr/ but not /[^regex]/ (no operator before it)

(* Some comment conventions are overlooked... *)
-- Lua's (and some other languages')
; So are these comments...
' And these (Basic) 
```

足以让普通代码产生错觉，并且比在浏览器中加载十几个语法更好。

# language-agnostic - 您什么时候遇到过该领域的停机问题？

> ID：235984
> 
> 赞同：66
> 
> 时间：2008-10-25T06:08:25.567
> 
> 标签：language-agnostic, field, theory, turing-machines, halting-problem

您什么时候亲自遇到过该领域的**[停顿问题](https://en.wikipedia.org/wiki/Halting_problem)**？这可能是当同事/老板提出一个违反计算基本限制的解决方案时，或者当你意识到你试图解决的问题实际上是不可能解决的。

我最近一次想到它是在学习类型检查器时。我们班意识到不可能编写一个完美的类型检查器（一个接受所有运行时没有类型错误的程序，并拒绝所有运行时出现类型错误的程序），因为这实际上可以解决停机问题. 另一个是当我们意识到，在同一个类中，在类型检查阶段不可能确定除以零是否会发生，因为在运行时检查一个数字是否为零也是停止问题的一个版本。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-10-25T06:13:45.900

我*确实*被分配了停止问题，例如“编写监视器插件以确定主机是否永久关闭”。严重地？好的，所以我会给它一个阈值。“不，因为它可能会在之后重新出现。”

大量的理论阐述随之而来。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-01-23T13:16:09.573

几年前，我记得读过一篇名为 Basic Infinite Loop Finder 或 BILF 的产品的评论（我相信是在 Byte 杂志上）。BILF 应该扫描您的 Microsoft Basic 源代码并找到任何未终止的循环。它声称能够在代码中找到任何无限循环。

审稿人非常精明地指出，要使该程序在所有情况下都能正常工作，它必须解决停机问题，并且甚至提供了一个数学证明来证明它为什么不能在所有情况下工作。

在下一期中，他们发表了公司代表的一封信，解释说该问题将在下一版本中得到解决。

**更新：**我在 imgur 上看到了这篇文章的图片。我记错杂志了。是创意计算，而不是字节。否则，这和我记忆中的差不多。

[你可以在imgur](http://imgur.com/a/3XdPg)上看到它的高分辨率版本。

![在此处输入图像描述](https://i.stack.imgur.com/t3HJ9.png) ![在此处输入图像描述](https://i.stack.imgur.com/LupU1.png)

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-10-25T06:37:51.983

[我现在正在做的项目](http://pythoscope.org)到处都是无法确定的问题。它是一个单元测试生成器，所以通常它试图完成的是回答*“这个程序做什么”这个*问题。这是停止问题的一个实例。开发过程中出现的另一个问题是*“两个（测试）功能是否相同”*？甚至*“这两个调用（断言）的顺序是否重要”*？

这个项目的有趣之处在于，即使你不能在**所有**情况下都回答这些问题，但你**可以**找到 90% 的时间解决问题的智能解决方案，这对于这个领域来说实际上是非常好的。

尝试推理其他代码的其他工具，如优化编译器/解释器、静态代码分析工具，甚至重构工具，可能会遇到（因此被迫寻找解决方法）停止问题。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-12-02T17:27:44.027

**示例 1\. 我的报告有多少页？**

当我学习编程时，我玩弄了一个从数据中打印出漂亮报告的工具。显然我希望它非常灵活和强大，因此它将成为结束所有报告生成器的报告生成器。

报告定义最终变得如此灵活，以至于它是图灵完备的。它可以查看变量，在备选方案之间进行选择，使用循环来重复事情。

我定义了一个内置变量 N，即报表实例中的页数，因此您可以在每页上放置一个表示“第 n 页”的字符串。我做了两次，第一次计算页面数（在此期间 N 设置为零），第二次使用从第一遍获得的 N 实际生成它们。

有时第一遍会计算 N，然后第二遍会生成不同数量的页面（因为现在非零 N 会改变报告所做的事情）。我尝试迭代地进行传递，直到 N 稳定下来。然后我意识到这是没有希望的，因为如果它没有安定下来怎么办？

这就引出了一个问题，“如果迭代永远不会确定他们报告产生的页数的稳定值，我至少可以检测并警告用户吗？” 幸运的是，此时我已经对阅读图灵、哥德尔、可计算性等产生了兴趣，并建立了联系。

多年后，我注意到 MS Access 有时会打印“第 6 页，共 5 页”，这真是一件了不起的事情。

**示例 2：C++ 编译器**

编译过程涉及扩展模板。模板定义可以从多个特化中选择（足以充当“条件”），它们也可以是递归的。所以它是一个图灵完备的（纯函数式）元系统，其中模板定义是语言，类型是值，编译器实际上是一个解释器。这是一个意外。

因此，不可能检查任何给定的 C++ 程序并判断编译器原则上是否可以在成功编译该程序时终止。

编译器供应商通过限制模板递归的堆栈深度来解决这个问题。您可以在 g++ 中调整深度。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-11-20T21:12:02.890

很多个月前，我正在协助我们公司的一位顾问，他正在实施一个非常复杂的轨道系统，将金属零件篮子移入和移出 1500 度的高炉。轨道本身是车间里一个相当复杂的“迷你铁路场”，在几个地方相交。几个电动托盘会根据时间表在周围穿梭一篮子零件。尽可能短的时间打开炉门是非常重要的。

由于工厂处于全面生产状态，顾问无法“实时”运行他的软件来测试他的调度算法。相反，他编写了一个漂亮的图形模拟器。当我们看到虚拟托盘在他的屏幕轨道布局上移动时，我问“你怎么知道你是否有任何调度冲突？”

他的回答很快，“简单——模拟永远不会停止。”

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-10-25T06:24:41.837

复杂的静态代码分析可能会遇到停机问题。

例如，如果 Java 虚拟机可以证明一段代码永远不会越界访问数组索引，它可以省略检查并运行得更快。对于某些代码，这是可能的；随着它变得越来越复杂，它变成了停止问题。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-11-21T22:59:17.727

这对于 GPU 应用程序中的着色器来说仍然是一个问题。如果着色器有一个无限循环（或一个很长的计算），驱动程序应该（在某个时间限制后）停止它，杀死片段，还是让它运行？对于游戏和其他商业内容，前者可能是您想要的，但对于科学/GPU 计算，后者才是您想要的。更糟糕的是，某些版本的 windows 假设由于图形驱动程序已经有一段时间没有响应，它会杀死它，这在 GPU 上进行计算时人为地限制了计算能力。

应用程序没有 API 可以控制驱动程序的行为或设置超时等，而且驱动程序当然无法判断着色器是否会完成。

我不知道这种情况最近是否有所改善，但我想知道。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-11-20T20:55:02.987

另一个常见的版本是“我们需要消除多线程代码中的任何死锁”。从管理的角度来看，这是一个完全合理的请求，但是为了防止在一般情况下出现死锁，您必须分析软件可能进入的每个可能的锁定状态，这毫不奇怪，相当于停机问题。

有一些方法可以通过在锁定之上施加另一层（如定义的获取顺序）来部分“解决”复杂系统中的死锁，但这些方法并不总是适用。

* * *

为什么这相当于停机问题：

假设你有两个锁，A 和 B，以及两个线程，X 和 Y。如果线程 X 有锁 A，也想要锁 B，而线程 Y 有锁 B，也想要 A，那么你就有了死锁。

如果 X 和 Y 都可以访问 A 和 B，那么确保您永远不会进入错误状态的唯一方法是确定每个线程可以通过代码采取的所有可能路径，以及它们的顺序在所有这些情况下都可以获取并持有锁。然后确定两个线程是否可以以不同的顺序获取多个锁。

但是，确定每个线程可以通过代码采取的所有可能路径（在一般情况下）等同于停机问题。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-25T08:22:33.847

Perl 的测试系统维护一个测试计数器。您要么将要运行的测试数量放在程序的顶部，要么声明您不会跟踪它。这可以防止您的测试过早退出，但是还有其他保护措施，所以它并不是那么重要。

每隔一段时间，就会有人尝试编写一个程序来为您计算测试次数。当然，这被一个简单的循环打败了。无论如何，他们都会继续前进，做越来越复杂的技巧来尝试检测循环并猜测会有多少次迭代并解决停机问题。通常他们宣称它必须“足够好”。

[这是一个特别详细的例子。](http://search.cpan.org/perldoc?Test::Count)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-26T08:36:07.670

我曾经在 ATM（自动柜员机）领域从事一个集成项目。客户要求我从我的系统生成一个报告，以报告我的系统未收到国家交换机发送的交易！！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-09-16T16:14:12.047

我找到了伯克利的一篇论文：*Looper: Lightweight Detection of Infinite Loops at Runtime* [http://www.eecs.berkeley.edu/~jburnim/pubs/BurnimJalbertStergiouSen-ASE09.pdf](http://www.eecs.berkeley.edu/~jburnim/pubs/BurnimJalbertStergiouSen-ASE09.pdf)

LOOPER 可能很有用，因为大多数无限循环都是微不足道的错误。然而，这篇论文**甚至没有提到停机问题！**

他们对自己的局限性有何看法？

> [LOOPER] 通常无法推断循环，其中非终止取决于每次循环迭代中堆突变的细节。这是因为我们的符号执行在具体化指针方面是保守的，而且我们的符号推理不够强大。**我们相信将我们的技术与形状分析和更强大的不变量生成和证明相结合将是有价值的未来工作。**

换句话说，“问题将在下一个版本中修复”。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-09-18T03:15:18.567

从[（Eclipse）可视化编辑器的功能概述](http://wiki.eclipse.org/Functional_Overview_of_Visual_Editor)：

> Eclipse 可视化编辑器 (VE) 可用于打开***任何***.java 文件。然后它解析 Java 源代码以寻找可视 bean。...
> 
> 一些可视化编辑工具将仅提供该特定可视化工具本身生成的代码的可视化模型。后续直接编辑源代码会阻止可视化工具解析代码和构建模型。
> 
> 然而，Eclipse VE ... 可以用于从头开始编辑 GUI，也可以用于从“硬编码”或内置于不同可视化工具中的 Java 文件。源文件可以使用图形查看器、JavaBeans 树或属性视图进行更新，也**可以**由源代码编辑器直接编辑。

也许我现在应该坚持使用马蒂斯。

无关，这里有人[要求](https://stackoverflow.com/questions/1541787/eclipse-plugin-to-find-out-unused-methods-in-a-class-package)Eclipse 中的停止问题。

公平地说，VE 的领域非常有限，它可能不会因为反射等棘手的事情而疯狂。***尽管如此，从任何***java 文件中构建 GUI 的说法似乎都停止了。

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2008-12-04T10:59:52.917

“您如何向我保证您的代码 100% 没有错误？”**``***