# StackOverflow 问答 000652000-000652999

# php - 在 PHP 中检测 MIME 类型

> ID：652002
> 
> 赞同：6
> 
> 时间：2009-03-16T20:16:54.577
> 
> 标签：php, mime-types, mime

我正在寻找最好的（可能在大多数 PHP 5.2 安装并且仍在积极开发中）检测 PHP 中文件 MIME 类型的方法。

我知道该`mime_content_type()`方法和 Fileinfo 扩展名，但是`mime_content_type()`不可靠且已弃用，并且 Fileinfo 不是“标准” PHP（5.2）安装。

我还有其他选择吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-01-05T05:46:57.137

（大声笑对不起，我意识到这是几个月前我正在整理的时候问的。哦，好吧。不妨添加这个......）

如果它是 *nix 服务器，您可以使用*file*命令。

```
file -bi <filepath> 
```

我猜你必须在 PHP 中使用“exec”来做到这一点？我是 PHP 新手，所以不要引用我的话，但是......

```
$content_type = exec("file -bi " . escapeshellarg($filepath)); 
```

我没有对其进行测试，因此您可能需要转义路径字符串并格式化输出。

不知道这是否比其他方法更可靠。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T20:25:33.777

你看过这个 PEAR 包吗？

[http://pear.php.net/package/MIME_Type](http://pear.php.net/package/MIME_Type)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T21:31:49.657

您可以对正在运行的网络服务器进行子请求，然后解析标头以获取 mime 类型。由于这很慢，因此使用 curl 仅获取标头而不是完整请求。如果您正在查看大文件，这一点很重要。

如果您正在运行 Apache 并使用 php 作为模块，请查看 VIRTUAL 函数。与使用 curl 相比，这是一种更快的子请求方式。

否则，您可以通过扩展名查找 mime 类型。这将使所有命名良好的文件都能正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-05T19:54:30.390

简单： [http ://www.php.net/manual/en/function.mime-content-type.php#107798](http://www.php.net/manual/en/function.mime-content-type.php#107798)

# include - 在 SVG 中包含 SVG 文件

> ID：652004
> 
> 赞同：8
> 
> 时间：2009-03-16T20:17:09.680
> 
> 标签：include, svg

我的 SVG 文件的 defs 部分中有一个 linearGradient，并使用 fill="url(#myGradientName)" 引用它。到目前为止效果很好。

我想我应该能够将我的整个 defs 部分放在它自己的 SVG 文件中，然后从我所有的 SVG 图像中引用它。也就是说，类似：

样式.svg：

```
<svg xmlns=...>
  <defs>
    <linearGradient id="myGradient" ...>
    </linearGradient>
  </defs>
</svg> 
```

图片.svg：

```
<svg xmlns=...>
  <rect width="100" height="100" fill="styles.svg#myGradient"/>
</svg> 
```

但我似乎无法应用这种风格。我对这个文件 (styles.svg#myGradient) 外部的 ID 有错误的语法吗？我是否需要先以某种方式明确包含该文件？

我一直在讨论 SVG 规范，看起来这应该是可能的，但没有一个例子真正表明它已经完成。

编辑：[FOP FAQ](http://xmlgraphics.apache.org/fop/faq.html#svg-url)建议正确的语法是 fill="url(grad.svg#PurpleToWhite)"，但这在 Gecko 或 Webkit 中不起作用。这是正确的，没有人支持它，还是我做错了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T21:00:20.933

看起来这仅在[Firefox 3.1](https://developer.mozilla.org/web-tech/2008/10/10/svg-external-document-references/)下受支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-10-18T16:18:15.840

你确实需要说`fill="url(styles.svg#myGradient)"`。这适用于 Firefox 4 beta 6，我想它适用于 Firefox 3.5。但是 Chrome (7.0.517.41 beta) 和 IE9 beta (9.0.7930.16406) 仍然不支持这个。看起来他们都在当前文档中查找#myGradient，而不是实际转到指定的 URL。总的。

以下是我用来测试的完整文件：

样式.svg

```
<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="myGradient">
      <stop offset="0" stop-color="red" />
      <stop offset="1" stop-color="black" />
    </linearGradient>
  </defs>
</svg> 
```

图片.svg

```
<svg xmlns="http://www.w3.org/2000/svg">
  <rect width="100" height="100" fill="url(styles.svg#myGradient)"/>
</svg> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-09T19:11:56.187

实际上，FOP 常见问题解答是正确的，正确的语法是使用`url(...)`. 刚刚用我的 Firefox 进行了检查，它只处理*周围*的填充`url()`。如果处理方式不同，这将是 Safari 或 Opera 中的错误。

我巧合地提出了一个[类似的问题](https://stackoverflow.com/questions/1104024/gradient-servers-as-external-files-in-svg)，但同样收效甚微。

干杯，

# c# - 预处理器指令

> ID：652008
> 
> 赞同：3
> 
> 时间：2009-03-16T20:19:24.867
> 
> 标签：c#, .net, asp.net, vb.net, debugging

是否有所有预处理器指令的简单参考？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T20:22:14.223

对于 C#：

> [http://msdn.microsoft.com/en-us/library/ed8yd1ha(vs.71).aspx](http://msdn.microsoft.com/en-us/library/ed8yd1ha(vs.71).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T20:24:52.920

C# 编译器没有传统意义上的预处理器，但它确实支持有限数量的预处理器，如命令#define、#if 等，但您将无法执行与 C/ 等相同的特技。 C++ 预处理器可以做到。

编辑：在输入其他提供的支持选项列表时。竖起大拇指。

# sql - SQL 外连接函数

> ID：652013
> 
> 赞同：3
> 
> 时间：2009-03-16T20:21:45.923
> 
> 标签：sql, mysql, stored-procedures, join

我以前写过这个函数，但我似乎不记得它并且它没有进入版本控制。现在，更多的是与睡眠剥夺有关，我不记得如何重建它。

这是想法。我有两个表，“regPrice”和“custPrice”，共享密钥“itemID”。它们都有一个“价格”列，并且 custPrice 也有另一个键“acct”，因此如果 custPrice 中存在价格，它应该返回那个。如果没有 custPrice 条目，它应该返回 regPrice。

伪代码：

```
if(select custPrice where acct = passedAcct and itemID = passedItemID) {
   return custPrice;
else 
   return regPrice; 
```

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T20:27:32.697

```
SELECT COALESCE(c.price, r.price) AS price
FROM regPrice r LEFT OUTER JOIN custPrice c
 ON (r.itemID = c.itemID AND c.acct = ?)
WHERE r.itemID = ?; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T20:43:38.553

```
select r.itemID, r.Acct,
case when c.price is null then r.price else c.price end as price
from regPrice r
left outer join custPrice c
on r.itemID = c.itemID
and r.Acct = @passedAcct
where r.itemID = @passedItemID 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T20:26:39.640

查看 COALESCE 函数，除非您不使用 NULL，在这种情况下您将需要使用 CASE。

# asp.net-mvc - asp.net mvc新手问题

> ID：652036
> 
> 赞同：2
> 
> 时间：2009-03-16T20:25:51.140
> 
> 标签：asp.net-mvc

我最近开始研究 asp.net mvc。这是我的问题。

假设应用程序上的每个页面都需要用户设置的变量，例如日期。如果用户从我提供的 url 开始，这一切都很好，因为我要求那个日期并将其保存到会话中。如果用户保存其他一些 url（到不同的控制器和操作），我如何将用户重定向到第一页。

换句话说，我想我正在寻找类似 [Authorize] 属性的东西，但在应用程序级别。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T20:31:50.253

我可能会创建一个基本控制器，我的所有控制器都来自该控制器。在基本控制器中，我将覆盖 OnActionExecuting 方法以检查会话中是否存在所需变量。如果变量不存在，我会将 ActionExecutingContext Result 属性设置为 RedirectToRouteResult 到适当的控制器/操作以设置变量。

另一种选择是创建一个自定义的 FilterAttribute 来装饰适当的控制器/动作，它的作用基本相同。如果过滤器仅适用于某些控制器或操作，而不是您在问题中描述的全部，我只会这样做。

# regex - 如何检查文件名是否与通配符模式匹配

> ID：652037
> 
> 赞同：32
> 
> 时间：2009-03-16T20:26:18.127
> 
> 标签：regex, .net

我有一个通配符模式，可能是“*.txt”或“POS??.dat”。

我还有内存中需要与该模式进行比较的文件名列表。

我将如何做到这一点，请记住，我需要与 IO.DirectoryInfo.GetFiles(pattern) 使用的语义完全相同。

编辑：盲目地将其翻译成正则表达式是行不通的。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2010-12-07T09:22:39.537

我有一个完整的代码答案给你，95% 喜欢`FindFiles(string)`.

[不存在的 5% 是此功能的MSDN](http://msdn.microsoft.com/en-us/library/8he88b63.aspx)文档的第二个注释中的短名称/长名称行为。

如果您仍然希望获得该行为，则必须完成对输入数组中每个字符串的短名称的计算，然后将长名称添加到匹配集合中（如果是长名称或短名称）匹配模式。

这是代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;

namespace FindFilesRegEx
{
    class Program
    {
        static void Main(string[] args)
        {
            string[] names = { "hello.t", "HelLo.tx", "HeLLo.txt", "HeLLo.txtsjfhs", "HeLLo.tx.sdj", "hAlLo20984.txt" };
            string[] matches;
            matches = FindFilesEmulator("hello.tx", names);
            matches = FindFilesEmulator("H*o*.???", names);
            matches = FindFilesEmulator("hello.txt", names);
            matches = FindFilesEmulator("lskfjd30", names);
        }

        public string[] FindFilesEmulator(string pattern, string[] names)
        {
            List<string> matches = new List<string>();
            Regex regex = FindFilesPatternToRegex.Convert(pattern);
            foreach (string s in names)
            {
                if (regex.IsMatch(s))
                {
                    matches.Add(s);
                }
            }
            return matches.ToArray();
        }

        internal static class FindFilesPatternToRegex
        {
            private static Regex HasQuestionMarkRegEx   = new Regex(@"\?", RegexOptions.Compiled);
            private static Regex IllegalCharactersRegex  = new Regex("[" + @"\/:<>|" + "\"]", RegexOptions.Compiled);
            private static Regex CatchExtentionRegex    = new Regex(@"^\s*.+\.([^\.]+)\s*$", RegexOptions.Compiled);
            private static string NonDotCharacters      = @"[^.]*";
            public static Regex Convert(string pattern)
            {
                if (pattern == null)
                {
                    throw new ArgumentNullException();
                }
                pattern = pattern.Trim();
                if (pattern.Length == 0)
                {
                    throw new ArgumentException("Pattern is empty.");
                }
                if(IllegalCharactersRegex.IsMatch(pattern))
                {
                    throw new ArgumentException("Pattern contains illegal characters.");
                }
                bool hasExtension = CatchExtentionRegex.IsMatch(pattern);
                bool matchExact = false;
                if (HasQuestionMarkRegEx.IsMatch(pattern))
                {
                    matchExact = true;
                }
                else if(hasExtension)
                {
                    matchExact = CatchExtentionRegex.Match(pattern).Groups[1].Length != 3;
                }
                string regexString = Regex.Escape(pattern);
                regexString = "^" + Regex.Replace(regexString, @"\\\*", ".*");
                regexString = Regex.Replace(regexString, @"\\\?", ".");
                if(!matchExact && hasExtension)
                {
                    regexString += NonDotCharacters;
                }
                regexString += "$";
                Regex regex = new Regex(regexString, RegexOptions.Compiled | RegexOptions.IgnoreCase);
                return regex;
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2014-09-27T00:01:22.040

你可以简单地做到这一点。您不需要正则表达式。

```
using Microsoft.VisualBasic.CompilerServices;

if (Operators.LikeString("pos123.txt", "pos?23.*", CompareMethod.Text))
{
  Console.WriteLine("Filename matches pattern");
} 
```

或者，在 VB.Net 中，

```
If "pos123.txt" Like "pos?23.*" Then
  Console.WriteLine("Filename matches pattern")
End If 
```

在 c# 中，您可以使用扩展方法来模拟它。它不会完全像 VB Like，但它会像......非常酷。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T20:35:28.433

您可以将通配符转换为正则表达式：

```
*.txt -> ^.+\.txt$

POS??.dat _> ^POS..\.dat$ 
```

使用该`Regex.Escape`方法将不是通配符的字符转义为模式的文字字符串（例如转换`".txt"`为`"\.txt"`）。

通配符`*`转换为`.+`, 并`?`转换为`.`

将 ^ 放在模式的开头以匹配字符串的开头，将 $ 放在末尾以匹配字符串的结尾。

现在您可以使用该`Regex.IsMatch`方法检查文件名是否与模式匹配。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2020-04-23T16:01:49.307

只需调用 Windows API 函数 PathMatchSpecExW()。

```
[Flags]
public enum MatchPatternFlags : uint
{
    Normal          = 0x00000000,   // PMSF_NORMAL
    Multiple        = 0x00000001,   // PMSF_MULTIPLE
    DontStripSpaces = 0x00010000    // PMSF_DONT_STRIP_SPACES
}

class FileName
{
    [DllImport("Shlwapi.dll", SetLastError = false)]
    static extern int PathMatchSpecExW([MarshalAs(UnmanagedType.LPWStr)] string file,
                                       [MarshalAs(UnmanagedType.LPWStr)] string spec,
                                       MatchPatternFlags flags);

    /*******************************************************************************
    * Function:     MatchPattern
    *
    * Description:  Matches a file name against one or more file name patterns.
    *
    * Arguments:    file - File name to check
    *               spec - Name pattern(s) to search foe
    *               flags - Flags to modify search condition (MatchPatternFlags)
    *
    * Return value: Returns true if name matches the pattern.
    *******************************************************************************/

    public static bool MatchPattern(string file, string spec, MatchPatternFlags flags)
    {
        if (String.IsNullOrEmpty(file))
            return false;

        if (String.IsNullOrEmpty(spec))
            return true;

        int result = PathMatchSpecExW(file, spec, flags);

        return (result == 0);
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-16T20:40:41.680

某种正则表达式/全局是要走的路，但有一些微妙之处；您的问题表明您想要与`IO.DirectoryInfo.GetFiles`. 这可能是一个挑战，因为涉及 8.3 与长文件名等的特殊情况。整个故事都在[MSDN](http://msdn.microsoft.com/en-us/library/system.io.directoryinfo.getfiles.aspx)上。

如果您不需要精确的行为匹配，有几个很好的 SO 问题：

[.NET 中的 glob 模式匹配](https://stackoverflow.com/questions/188892/glob-pattern-matching-in-net)
[如何在 C# 中实现 glob](https://stackoverflow.com/questions/398518/how-to-implement-glob-in-c)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-04-01T18:25:14.573

对于在多年后遇到这个问题的任何人，我在 MSDN 社交板上发现 GetFiles() 方法将接受 * 和 ? searchPattern 参数中的通配符。（至少在 .Net 3.5、4.0 和 4.5 中）

```
Directory.GetFiles(string path, string searchPattern) 
```

[http://msdn.microsoft.com/en-us/library/wz42302f.aspx](http://msdn.microsoft.com/en-us/library/wz42302f.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-12-07T06:32:32.727

请尝试以下代码。

```
static void Main(string[] args)
    {
        string _wildCardPattern = "*.txt";

        List<string> _fileNames = new List<string>();
        _fileNames.Add("text_file.txt");
        _fileNames.Add("csv_file.csv");

        Console.WriteLine("\nFilenames that matches [{0}] pattern are : ", _wildCardPattern);
        foreach (string _fileName in _fileNames)
        {
            CustomWildCardPattern _patetrn = new CustomWildCardPattern(_wildCardPattern);
            if (_patetrn.IsMatch(_fileName))
            {
                Console.WriteLine("{0}", _fileName);
            }
        }

    }

public class CustomWildCardPattern : Regex
{
    public CustomWildCardPattern(string wildCardPattern)
        : base(WildcardPatternToRegex(wildCardPattern))
    {
    }

    public CustomWildCardPattern(string wildcardPattern, RegexOptions regexOptions)
        : base(WildcardPatternToRegex(wildcardPattern), regexOptions)
    {
    }

    private static string WildcardPatternToRegex(string wildcardPattern)
    {
        string patternWithWildcards = "^" + Regex.Escape(wildcardPattern).Replace("\\*", ".*");
        patternWithWildcards = patternWithWildcards.Replace("\\?", ".") + "$";
        return patternWithWildcards;
    }
} 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2014-01-17T07:44:53.710

使用 RegexOptions.IgnoreCase 将修复它。

```
public class WildcardPattern : Regex {
    public WildcardPattern(string wildCardPattern)
        : base(ConvertPatternToRegex(wildCardPattern), RegexOptions.IgnoreCase) {
    }

    public WildcardPattern(string wildcardPattern, RegexOptions regexOptions)
        : base(ConvertPatternToRegex(wildcardPattern), regexOptions) {
    }

    private static string ConvertPatternToRegex(string wildcardPattern) {
        string patternWithWildcards = Regex.Escape(wildcardPattern).Replace("\\*", ".*");
        patternWithWildcards = string.Concat("^", patternWithWildcards.Replace("\\?", "."), "$");
        return patternWithWildcards;
    }
} 
```

# .net - WCF - 客户端代理配置与服务 web.config 不匹配

> ID：652048
> 
> 赞同：3
> 
> 时间：2009-03-16T20:29:06.297
> 
> 标签：.net, wcf, web-services, configuration

我有一个需要处理大型数据流的简单 WCF 服务，因此我有很多配置值超出了默认值。我最近一直在将我的所有代码移动到一个新的、重组的解决方案中，并且我刚刚转移了该服务。但是，当我尝试生成客户端代理（在 VS2008 中使用 WCFTestClient.exe 或“添加服务引用”）时，客户端代理配置中的值与我为服务设置的值不匹配。

这是服务器配置 - 注意 maxBufferSize、maxReceivedMessageSize、maxStringContentLength 和 MaxArrayLength 的值增加

```
 <system.serviceModel>
    <bindings>    
      <basicHttpBinding>
        <binding name="default" maxBufferSize="5000000" maxReceivedMessageSize="5000000">
          <readerQuotas maxStringContentLength="5000000" maxArrayLength="5000000" />
          <!-- turn this setting on to require SSL/https -->
          <!-- <security mode="Transport" /> -->
        </binding>       
      </basicHttpBinding>
    </bindings>
    <behaviors>
      <serviceBehaviors>
        <behavior name="Consent.Service.SubjectConsentServiceBehavior">
          <serviceMetadata httpGetEnabled="true" />
          <serviceDebug includeExceptionDetailInFaults="true" />
        </behavior>
      </serviceBehaviors>
    </behaviors>
    <services>
      <service behaviorConfiguration="Consent.Service.SubjectConsentServiceBehavior"
        name="Consent.Service.SubjectConsentService">
        <endpoint address="" binding="basicHttpBinding" bindingConfiguration="default"
          contract="Consent.Service.ISubjectConsentService">
          <identity>
            <dns value="localhost" />
          </identity>
        </endpoint>
        <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange" />
      </service>
    </services>
  </system.serviceModel> 
```

这是VS2008生成的代理，带有“添加服务参考”

```
<system.serviceModel>
    <bindings>
        <basicHttpBinding>
            <binding name="BasicHttpBinding_ISubjectConsentService" closeTimeout="00:01:00"
                openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"
                allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard"
                maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536"
                messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered"
                useDefaultWebProxy="true">
                <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"
                    maxBytesPerRead="4096" maxNameTableCharCount="16384" />
                <security mode="None">
                    <transport clientCredentialType="None" proxyCredentialType="None"
                        realm="" />
                    <message clientCredentialType="UserName" algorithmSuite="Default" />
                </security>
            </binding>
        </basicHttpBinding>
    </bindings>
    <client>
        <endpoint address="http://server/Consent/services/SubjectConsent.svc"
            binding="basicHttpBinding" bindingConfiguration="BasicHttpBinding_ISubjectConsentService"
            contract="ServiceReference1.ISubjectConsentService" name="BasicHttpBinding_ISubjectConsentService" />
    </client>
</system.serviceModel> 
```

客户端代理将这 4 个值设置为默认值。

任何想法为什么客户端使用默认值？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T20:51:11.640

服务器配置文件中设置的值不会作为 Web 服务元数据的一部分公开（因为它们与传输层相关，而不是服务本身），因此客户端（或者，在这种情况下，“添加服务引用” "函数）无法自动找出它们。（“添加服务引用”所做的只是要求 WSDL 并生成相应的类；它无法访问配置文件中与传输相关的设置。）

因此，您需要在客户端和服务器上覆盖它们。

# jquery - 将 JQuery 的 toggle() 与 #anchors 混合使用

> ID：652049
> 
> 赞同：0
> 
> 时间：2009-03-16T20:29:06.547
> 
> 标签：jquery, anchor, toggle

嘿，我有以下困境：我有一组 DIV，其中包含默认隐藏的子 DIVS。最初，我使用 javascript 和带有锚点的 onclick 来实现切换和“移动到锚点”效果。现在我已经转向 JQuery 替代方案，我在重现相同的“移动到锚点”效果时遇到了问题。切换工作得很好。

当您单击父 div 中的“h2 a”链接时，子 div 通过切换显示。这是一个父子 div 设置的示例：

```
<div class="full email">
<a id="test_anchor"></a>
  <h2 class="subsubtitle"><a href="#test_anchor">TITLE AND LINK</a></h2>
  <div class="description full">
  <p>THIS IS WHAT SHOWS ALL THE TIME, REGARLDESS OF THE TOGGLE</p>
  </div><!-- #description ends here -->

     <div id="c_1">
     THE DIV AND THE CONTENTS THAT ARE SHOWN AND HIDDEN
     </div><!-- #c_1 div ends here -->

</div><!-- .full .email ends here --> 
```

//这里是JQuery：

```
$(document).ready(function(){

$("#c_1,#c_2,#c_3,#c_4").hide();

$("div div h2 a").toggle(
    function() { $(this).parent().siblings("div:last").slideDown("slow") },
    function() { $(this).parent().siblings("div:last").hide() }

    );

}); 
```

现在的问题是：我如何激活或重新激活该#anchor，以便 Jquery slideDown/hide 功能和古旧的“移动到锚点”都发挥作用？

亲切的问候 G.Campos

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T20:43:03.267

您使用切换功能所做的是切换匹配元素的可见性，而不是它们内部的内容。

尝试这样的事情：

```
$(function (){
  $("#c_1,#c_2,#c_3,#c_4").hide(); // good practice to hide in JS instead of CSS file :)

  // Assign toggle functionality.
  $("h2.subsubtitle a").click(function (){
    var jDiv = $(this).parent().siblings("div:last");

    if( jDiv.is(":visible") ){
      jDiv.hide("slow"); // you're toggling this div, not the anchor.
    } else {
      jDiv.show("slow");
    }

    return true; // if switched to false, anchor won't link to anything.
  });
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T23:05:48.103

您是否试图实现[这样](http://jsbin.com/ikawo)的目标？

相关的jQuery代码

```
$(function(){

    $("#c_1").hide();

    $("h2.subsubtitle a").toggle(
     function () { $(this).parent().siblings("div:last").slideDown("slow"); return false;},
     function () { $(this).parent().siblings("div:last").slideUp("slow"); return false; }                      
    );

}); 
```

**编辑：**

作为对您的评论的回应，我在[此示例](http://jsbin.com/ivavi)中添加了一些显示/隐藏部分，并且在 IE6 和 Firefox 3 中对我来说似乎一切正常。您可以通过添加`/edit`到 URL 来编辑它的代码。这个例子对你有用吗？你使用的是什么浏览器？

# java - 从 Java 运行 Ant 时设置 JAVA_HOME

> ID：652053
> 
> 赞同：5
> 
> 时间：2009-03-16T20:30:26.637
> 
> 标签：java, ant, javac

原因很长而且很无聊，但是我需要运行一个 Ant 脚本来从 Java 1.4 应用程序编译 Java 1.5 代码。不过，我不断收到此错误：

```
BUILD FAILED

build.xml:16: Unable to find a javac compiler;
com.sun.tools.javac.Main is not on the classpath.
Perhaps JAVA_HOME does not point to the JDK.
It is currently set to "C:\j2sdk1.4.2_16\jre" 
```

在我的代码中，我有：

```
Project p = new Project();
p.setUserProperty("ant.file", buildFile.getAbsolutePath());
p.setProperty("java.home", "C:\Program Files\Java\jdk1.6.0_04");
p.fireBuildStarted();
p.init();
// so on and so forth 
```

但它忽略了它。我也尝试过 p.setUserProperty(String, String)，但这也不起作用。有没有办法在不启动单独进程的情况下做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T21:02:42.207

您的构建文件中的 javac 任务有`fork="yes"`吗？如果不是，那么`java.home`属性设置为什么都没有关系；ant 将尝试`Main`在同一个 java 进程中调用 javac 方法，从您的错误来看，该进程是 JRE，而不是 JDK。

**编辑**尝试将`executable`javac 任务的属性设置为`javac`二进制文件的完整路径并添加`compiler="extJavac"`到任务中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T20:58:02.577

反斜杠不应该加倍吗？

```
p.setProperty("java.home", "C:\\Program Files\\Java\\jdk1.6.0_04"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T05:44:11.860

您是否正确设置了环境变量 JAVA_HOME 和 ANT_HOME？如果您通过代码进行设置，它应该可以工作。

还要检查您的 %JAVA_HOME%\bin 目录 %ANT_HOME%\bin 是否应该在环境变量“路径”中。

您的问题似乎是环境中不存在 %JAVA_HOME%\bin 。可变路径。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-05T06:36:35.307

完成这项工作的另一种方法是将“tools.jar”添加到您的类路径中。javac 编译器包含在这个 jar 中。

java -cp $JAVA_HOME/lib/tools.jar ...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-13T06:01:49.477

javac 选项在 tools.jar 中可用。在eclipse中，即使你的JRE HOME指向一个jdk，所有的系统库都指向JDK_HOME\jre\lib。没有tools.jar。您可以将 tools.jar 添加为外部 Jar 文件。这应该可以解决您的问题

# visual-studio - Visual Studio Addin - 1\. 如何添加上下文菜单？2\. 如何获得插入符号的位置

> ID：652056
> 
> 赞同：4
> 
> 时间：2009-03-16T20:31:41.470
> 
> 标签：visual-studio, visual-studio-addins

我正在编写一个（非常）简单的 Visual Studio 插件。使它工作得更好的两件事是：

1.  上下文菜单。

2.  知道当前文档中的插入符号位置（这样我就可以在该位置注入文本）。

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T21:19:06.830

要将上下文菜单添加到插件，请从以下位置创建 CommandBarPopup：

```
_applicationObject.CommandBars["Code Window"] 
```

[您可以在此处](http://www.codeproject.com/KB/macros/addingmenuitems.aspx)查看示例。

您问题的第二部分稍微简单一些，当前的“选择”（或插入点）由以下人员处理：

```
(TextSelection)_applicationObject.ActiveDocument.Selection 
```

“_applicationObject”是由插件项目向导创建的 DTE 应用程序对象的一个​​实例。

# sql - 快速从sqlserver中选择随机抽样

> ID：652064
> 
> 赞同：17
> 
> 时间：2009-03-16T20:33:55.363
> 
> 标签：sql, sql-server, database, performance, random

我有一个超过 1000 万行的巨大表。我需要有效地从中获取 5000 个随机样本。我有一些约束将我正在寻找的总行数减少到 9 百万。

我尝试通过 NEWID() 使用 order，但是该查询将花费太长时间，因为它必须对所有行进行表扫描。

有没有更快的方法来做到这一点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-16T20:46:16.007

如果您可以使用伪随机抽样并且您使用的是 SQL Server 2005/2008，那么请查看 TABLESAMPLE。例如，来自 SQL Server 2008 / AdventureWorks 2008 的示例基于行工作：

```
USE AdventureWorks2008; 
GO 

SELECT FirstName, LastName
FROM Person.Person 
TABLESAMPLE (100 ROWS)
WHERE EmailPromotion = 2; 
```

问题是 TABLESAMPLE 并不是完全随机的，因为它从每个物理页面生成给定数量的行。除非您也限制了 TOP，否则您可能无法准确返回 5000 行。如果您使用的是 SQL Server 2000，您将不得不生成一个与主键匹配的临时表，或者您将不得不使用使用 NEWID() 的方法来完成它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-16T20:42:18.073

您是否考虑过使用 TABLESAMPLE 子句？

例如：

```
select *
from HumanResources.Department tablesample (5 percent) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-11-23T06:05:20.557

SQL Server 2000 解决方案，关于 Microsoft（而不是大型表上的慢 NEWID()）：

```
SELECT * FROM Table1
WHERE (ABS(CAST(
 (BINARY_CHECKSUM(*) *
  RAND()) as int)) % 100) < 10 
```

> Microsoft 的 SQL Server 团队意识到，不能轻松地随机抽取行样本是 SQL Server 2000 中的一个常见问题。因此，该团队通过引入 TABLESAMPLE 子句解决了 SQL Server 2005 中的问题。此子句通过选择随机数据页并返回这些页上的所有行来选择行子集。但是，对于我们这些仍然拥有在 SQL Server 2000 上运行的产品并需要向后兼容，或者需要真正的行级随机性的人来说，BINARY_CHECKSUM 查询是一种非常有效的解决方法。

可以在这里找到解释：http: [//msdn.microsoft.com/en-us/library/cc441928.aspx](http://msdn.microsoft.com/en-us/library/cc441928.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-16T20:40:14.960

是的，tablesample 是你的朋友（请注意，它在统计意义上不是随机的）： [Tablesample at msdn](http://msdn.microsoft.com/en-us/library/ms189108.aspx)

# svn - 构建服务器和源代码控制存储库

> ID：652067
> 
> 赞同：3
> 
> 时间：2009-03-16T20:35:37.433
> 
> 标签：svn, build-process, cruisecontrol.net

我们使用 CruiseControl.NET 作为构建服务器，使用 Subversion 进行源代码控制。我们的 IT 人员建议将它们放在一个虚拟机上。出于某种原因，我觉得这很有趣，但我无法解释为什么。与构建服务器相比，源代码控制服务器的服务器“瞬态”似乎要少得多。有没有其他人对这个想法感到不舒服，也许解释一下原因？

我意识到虚拟机很便宜；这里还有其他一些我没有解释的考虑因素。这个问题的范围是：将构建服务器和源代码控制服务器放在一个盒子上是否存在任何次优或风险？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T20:46:05.257

考虑到它在开发环境中的中心位置，应该非常尊重您的 Subversion 存储库持有机器。它应该有尽可能少的变化以确保稳定性。

随着不同项目的构建、工作负载的变化以及登录到它的人数可能远远高于存储库服务器通常看到的数量，构建服务器可能会有一定程度的流失。

如果可能的话，我不想组合功能，对于 IT 人员来说，tin 似乎没有得到充分利用，但它是一种安全分离，对于受控的开发环境很重要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T20:38:44.010

我明白你的意思。构建服务器有利于改变：硬件、配置等。这些改变会导致它无法运行。您不希望这种情况发生在您的 SVN 服务器上。

我会坚持为源代码控制服务器使用单独的 VM。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T20:39:11.450

我们有这样的设置——但是使用 Perforce 和 CruiseControl.Net。

只要一切都正确备份，并且有专用于服务器的体面资源，你应该没问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T20:40:02.633

这不是VM的优势之一吗？您可以将它们放在单独的“盒子”中吗？

我们公司的反间谍软件和防病毒软件*都有*自己的虚拟机，可以大声喊叫

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T20:40:18.517

只要性能不是问题并且您定期备份到另一个位置，我看不出有问题。我的公司几乎完全按照你的描述做，除了物理服务器，而不是虚拟机。即使有构建运行（它们每小时运行一次），SVN 的响应能力似乎也不会受到影响。

# wpf - 在 WPF 中使用 BitmapSource 作为图像源

> ID：652068
> 
> 赞同：2
> 
> 时间：2009-03-16T20:37:52.157
> 
> 标签：wpf, event-handling, bitmap, freeze, bitmapsource

我试图通过在每次事件确定源需要更新时更改源图像来更新 XAML 中的图像（下面的_browserScreenshot）对象。现在我有这个：

```
public BitmapSource GetScreen()
{
    Bitmap bitmap = new Bitmap(app.Browser.ClientRectangle.Width, app.Browser.ClientRectangle.Height);
    app.Browser.DrawToBitmap(bitmap, app.Browser.Bounds);

    BitmapSource bitmapSource = System.Windows.Interop.Imaging.CreateBitmapSourceFromHBitmap(bitmap.GetHbitmap(), IntPtr.Zero, Int32Rect.Empty, System.Windows.Media.Imaging.BitmapSizeOptions.FromEmptyOptions());

    bitmapSource.Freeze();

    bitmap.Dispose();
    bitmap = null;
    return bitmapSource;
} 
```

然后我有一个事件处理程序，如图所示：

```
app.BitmapSource.Changed += new EventHandler(BitmapSource_Changed);

void BitmapSource_Changed(object sender, EventArgs e)
{
    Window1._browserScreenshot.Source = app.GetScreen();
} 
```

现在，每当此事件触发时，都会拍摄新的屏幕截图，并且应该更新 Image 的源（此处称为 _browserScreenshot）控件。我不断收到有关更改 IsFrozen 属性的错误，但我无法弄清楚如何正确更改它并按照我想要的方式进行工作。提前谢谢大家。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T00:44:10.630

以下行原来是我的问题：

bitmapSource.Freeze();

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T16:54:25.890

您很可能*想*冻结对象。您遇到的问题是您希望每次都创建一个全新的 BitmapSource 并让垃圾收集器处理旧图像。

# sql - 基于字段组合在SQL中查找重复记录

> ID：652071
> 
> 赞同：1
> 
> 时间：2009-03-16T20:38:26.960
> 
> 标签：sql, sql-server-2005, ssis, service, integration

我有一个项目，其中一个重要的部分是确定记录在数据库中的重复位置（Sql Server 2005）。我知道找到重复记录的明显方法。但是，在这种情况下，我们希望对该过程相当聪明。表格将包含有关潜在客户（潜在客户）的信息。初始表将接受所有潜在客户。然后，我们将完成一个重复过程，该过程将通过匹配多个字段来检查潜在客户是否重复。例如，我们可能想要匹配姓氏、名字、电子邮件和邮政编码。这只是一个例子，但本质上我们想使用各种字段创建一个密钥来知道这个人是否存在。不是被骗的记录将进入决赛桌。

我想为此使用 SSIS，但不确定使用 SSIS 完成此操作的最佳方法。有人可以引导我朝着正确的方向前进，或者提供一个链接到一个使用 SSIS 通过检查字段组合来处理欺骗的示例的链接吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T21:06:58.717

在我看来，您试图通过猜测用户来智取用户。不幸的是，这几乎永远不会奏效，因为您可能确实有两个名称相同但邮政编码不同的客户端，或者其他类似的示例。

您最好的选择是“建议”他们将要保存的客户已经存在（并向他们展示副本），但无论如何都允许他们保存。所以这个过程可能需要看起来像这样：

1.  用户输入信息并按保存
2.  系统使用标准检测潜在的重复，并提示用户
3.  用户将取消或确认，然后您将采取适当的行动

如果没有潜在的重复，则可以安全地跳过步骤 2-3。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T20:49:06.170

```
-- List all Duplicates
select m1.lastname, m1.firstname, m1.email, m1.zipcode
from tblMain m1
inner join tblMain m2
on isnull(m1.lastname, '') = isnull(m2.lastname, '')
and isnull(m1.firstname, '') = isnull(m2.firstname, '')
and isnull(m1.email, '') = isnull(m2.email, '')
and isnull(m1.zipcode, '') = isnull(m2.zipcode)
and m1.ID <> m2.ID
order by 1, 2, 3, 4 
```

要删除最新的重复项，请使用以下内容：

```
delete from tblMain
where ID in 
(
    select m1.ID
    from tblMain m1
    inner join tblMain m2
    on isnull(m1.lastname, '') = isnull(m2.lastname, '')
    and isnull(m1.firstname, '') = isnull(m2.firstname, '')
    and isnull(m1.email, '') = isnull(m2.email, '')
    and isnull(m1.zipcode, '') = isnull(m2.zipcode)
    and m1.ID > m2.ID
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T20:54:04.397

我不明白你怎么能确定 SSIS 是你问题的答案。为什么不能简单地在“最终”表中创建唯一键以确保不添加重复项？也许你应该更好地解释你的问题......

# c# - 如何使用 XML Reader 反序列化 Xml 片段

> ID：652073
> 
> 赞同：3
> 
> 时间：2009-03-16T20:38:38.410
> 
> 标签：c#, xml, serialization

我正在尝试反序列化 Xml 片段。我快到了，但它会抛出一个错误，因为它不需要第一个元素。流中的 XML 示例如下：

```
 <Project xmlns="http://schemas.datacontract.org/2004/07/Swissmod.Service.Model" xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
  <ClientID>1</ClientID> 
  <Created>2009-03-16T20:34:57.022167+00:00</Created> 
  <ID>22</ID> 
  <LastModified>2009-03-11T20:34:57.022167+00:00</LastModified> 
  <ProjectDescription>Description here</ProjectDescription> 
  <ProjectTitle>Poject title</ProjectTitle> 
  <UserID>5</UserID> 
  <Version>1234567</Version> 
  </Project> 
```

我正在使用以下代码进行反序列化：

```
 XmlSerializer serializer = new XmlSerializer(typeof(Project));
  XmlReaderSettings settings = new XmlReaderSettings();
  settings.ValidationFlags = XmlSchemaValidationFlags.None;
  settings.ValidationType = ValidationType.None;
  settings.ConformanceLevel = ConformanceLevel.Auto;
  settings.IgnoreProcessingInstructions = true;
  settings.NameTable = new NameTable();
  settings.NameTable.Add("http://schemas.datacontract.org/2004/07/Swissmod.Service.Model");
  XmlReader reader = XmlReader.Create(wresp.GetResponseStream(),settings);
  Project p = (Project)serializer.Deserialize(reader); 
```

但是上面抛出了以下错误：

```
There is an error in XML document (1, 2).
"<Project xmlns='http://schemas.datacontract.org/2004/07/Swissmod.Service.Model'> was not expected." 
```

任何人都知道如何使用 XML Reader 读取 XML 片段？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T20:46:23.493

在您的 Project 类定义中，您是否尝试过在 XmlRoot 属性中指定命名空间？

# grid - 可滚动网格（雅虎电子邮件之类）

> ID：652078
> 
> 赞同：0
> 
> 时间：2009-03-16T20:40:00.217
> 
> 标签：grid, scrollbar

我想知道是否有人知道一个可滚动的 gridview 控件，它的工作原理类似于 yahoo 电子邮件 gridview。

![替代文字](https://ruturajv.files.wordpress.com/2006/10/yahoo-mail-ajax.gif)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T20:44:57.787

如果我猜的话，我会说这是一个高度定制的[YUI DataTable](http://developer.yahoo.com/yui/datatable/)，所以这可能值得一试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T20:44:04.107

如果您使用的是 jquery，我推荐[jqgrid](http://www.trirand.com/blog/)。

[extjs](http://extjs.com/)中也有一个不错的网格组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T07:28:02.937

如果您正在寻找具有类似雅虎滚动功能的 ASP.NET AJAX 网格解决方案，Telerik 网格可能会为您提供类似雅虎的延迟滚动。在他们的网站上查看[这个演示。](http://demos.telerik.com/aspnet-ajax/grid/examples/client/virtualscrollpaging/defaultcs.aspx)

迪克

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T07:32:06.687

DHX 的[dhtmlxGrid 控件](http://www.dhtmlx.com/docs/products/dhtmlxGrid/index.shtml)也可以做到这一点。基本版是免费的。

他们有 50,000 条记录的示例，[有](http://www.dhtmlx.com/docs/products/dhtmlxGrid/samples/loading_big_datasets/50000_paging.html)和[没有分页](http://www.dhtmlx.com/docs/products/dhtmlxGrid/samples/loading_big_datasets/50000.html)。

# asp.net - 尝试将 rss 提要绑定到转发器的问题

> ID：652080
> 
> 赞同：0
> 
> 时间：2009-03-16T20:40:05.223
> 
> 标签：asp.net

我正在尝试将数据表绑定到中继器。为此，根据代码示例，我需要在选择中继器的数据源属性时调用 dataview()，然后编写 databind()。

当我这样做时，我仍然得到数据绑定源不是从 IDatasourceControl 派生的异常。

将数据表绑定到转发器的正确​​方法是什么？我希望每条记录在中继器中重复（显然）。

我看过这个链接（[http://blogs.x2line.com/al/archive/2008/06/21/3469.aspx](http://blogs.x2line.com/al/archive/2008/06/21/3469.aspx)）。ASPX 页面上表达式中的 Container.Dateitem 究竟是什么意思？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T22:40:14.000

使用中继器，您应该能够执行以下操作：

```
rpYourRepeater.DataSource = dtYourDataTable;
rpYourRepeater.DataBind(); 
```

就是这样。

只需验证您的 DataSourceID 是否与数据表中的真实字段相关联，或者将 DataSourceID 完全排除在外，因为您实际上并不需要它，具体取决于您在做什么。

除非您想开始在数据上放置过滤器，否则您不需要任何数据视图的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T22:40:19.943

我猜您正在尝试绑定到**DataSourceID**。您应该在转发器中绑定到**DataSource**。

# c# - WPF将图标添加到Windows导致属性错误

> ID：652085
> 
> 赞同：1
> 
> 时间：2009-03-16T20:41:15.610
> 
> 标签：c#, .net, wpf

这是我得到的确切错误。 [（来源：][[clip2net.com](http://clip2net.com/clip/m12122/1237235885-clip-36kb.png)][）][![替代文字](https://i.stack.imgur.com/Gr2xa.png)](https://i.stack.imgur.com/Gr2xa.png)

favicon.ico 已作为资源添加到项目中，并且我已将构建操作设置为“资源”。 [（来源：][[clip2net.com](http://clip2net.com/clip/m12122/1237236030-clip-6kb.png)][）][![替代文字](https://i.stack.imgur.com/CPbLS.png)](https://i.stack.imgur.com/CPbLS.png)

我找到了一些需要添加一些代码的解决方案。我的问题是为什么我不能使用 Visual Studio 界面来做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T20:57:51.470

我刚刚在 Visual Studio 2008 SP 1 中尝试过，它工作正常。我将文件拖到项目中，我只需在属性窗格中键入“favicon.ico”即可。

您确定它位于应用程序的根级别吗？如果您将它放在项目的子文件夹中，则需要完整的相对路径（如“icons\favicon.ico”）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T21:36:02.423

如果您的图标在文件夹下，您是否包含文件夹名称？

[1237239323-clip-25kb http://clip2net.com/clip/m0/1237239323-clip-25kb.png](http://clip2net.com/page/m0/727896)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T21:43:07.537

我对 close.bmp 也有类似的问题。我将其重命名为 close-image.bmp，并对其进行了修复。但是现在，我再次尝试将其重命名为 close.bmp，今天它可以工作了。似乎是解决方案的问题......阅读此讨论：

[http://social.msdn.microsoft.com/Forums/en-US/vswpfdesigner/thread/b03061e5-5500-442f-9c88-a6d82f97c2b7](http://social.msdn.microsoft.com/Forums/en-US/vswpfdesigner/thread/b03061e5-5500-442f-9c88-a6d82f97c2b7)

另外，您的设置是正确的。您需要包含它并制作“构建操作：资源”

# asp.net - 我使用 addedcontrol 方法修复了 safari/asp:menu 问题。为什么这行得通？

> ID：652093
> 
> 赞同：1
> 
> 时间：2009-03-16T20:43:03.330
> 
> 标签：asp.net

我在母版页的 cs 文件中使用了以下代码来修复 safari 和 asp:menu 控件的呈现问题。我很好奇为什么它实际上解决了这个问题。这是代码：

```
protected override void AddedControl(Control control, int index)
{
   if (Request.ServerVariables["http_user_agent"].IndexOf("Safari", 
       StringComparison.CurrentCultureIgnoreCase) != -1)

   this.Page.ClientTarget = "uplevel";

   base.AddedControl(control, index); 
```

}

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T20:51:46.257

问题是 ASP.NET 错误地将 Safari 识别为“低级”浏览器（例如古老的）。您的修复是强制它识别为更现代的浏览器，能够处理一些菜单的 javascript。

这也可以通过一系列其他技术来实现，例如覆盖 Page_PreInit 或将正确配置的 safari.browser 添加到 App_Browsers。

# vba - 将焦点放在任何对象上

> ID：652094
> 
> 赞同：6
> 
> 时间：2009-03-16T20:43:11.707
> 
> 标签：vba, ms-access

有人如何使用 VBA 在 MS Access 中设置打开的 Query 对象的焦点？

我正在做这样的事情......

```
 If Application.CurrentData.AllQueries(myqueryname).IsLoaded = True Then
      'set the focus

      ' Export to office links for analysis
      CommandBars("Menu Bar").Controls("Tools").Controls("Office Links").Controls("Analyze It With Microsoft Office Excel").accDoDefaultAction 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T20:49:41.083

docmd 又是你的朋友 :-)

```
'set the focus
DoCmd.SelectObject acQuery, myqueryname, False 
```

# java - 密件抄送收件人数量限制

> ID：652104
> 
> 赞同：4
> 
> 时间：2009-03-16T20:46:37.160
> 
> 标签：java, email, smtp

我有一个以编程方式生成和发送电子邮件的应用程序。收件人列表可以超过 1000 个。我一直在循环发送单独的电子邮件，但每封电子邮件大约需要 0.5 秒。我现在正在研究的方法是删除消息正文中的自定义并发送一封包含密件抄送中所有地址的电子邮件。（也许其他解决方案是可能的，我欢迎他们，但我主要感兴趣的是深入研究这个 BCC 解决方案的复杂性。）

一封电子邮件允许的收件人数量是否有限制？这是否完全取决于我的电子邮件客户端和/或 SMTP 服务器的配置？我的域控制之外是否还有其他限制？此外，如何处理密件抄送？我假设密件抄送分发需要在某个时候分解为单独的邮件消息。邮件客户端（在我的例子中是 javax.mail）是否对此负责，或者邮件服务器是否这样做？

我也对如何测试我的新电子邮件冲击波程序的建议感兴趣？

我不认为通过在 google 或任何地方创建 1000 个帐户（我也不想）来进行有效的测试。我听说有一些针对同一主机上的多个收件人的邮件服务器优化。就我而言，大多数将是不同的主机。

另一种方法是让所有收件人都参与进来，看看他们是否收到了电子邮件。我可以这样做，但我想避免向它们发送垃圾邮件，假设如果第一次事情不顺利，我可能需要多次测试。

还是我只是假设一些限制并发送一批电子邮件，每个电子邮件的收件人数量是任意数量，比如 50 或 100？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T20:50:20.830

BCC 在您的 SMTP 服务器内部工作；没有收件人知道其他密件抄送的电子邮件地址，因此这是一个完全取决于您的 SMTP 服务器的限制。

您应该咨询您的服务器管理员。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-17T22:34:11.243

更明确的是，涵盖 SMTP (2821) 的 RFC 没有提及邮件服务器特定限制之外的收件人限制：

“如果 SMTP 服务器对 RCPT 命令的数量有实现限制并且这个限制已经用尽，它必须使用 452 的响应代码（但客户端也应该为 552 做好准备，如上所述）。如果服务器有对 RCPT 命令数量的配置站点策略限制，它可以改为使用 5XX 响应代码。如果策略限制旨在适用于特定消息正文的总收件人计数被强制执行，这将是最合适的，即使消息正文在多个邮件事务中发送。”

[http://www.ietf.org/rfc/rfc2821.txt](http://www.ietf.org/rfc/rfc2821.txt)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T19:39:37.867

感谢您的意见。据我所知，传出 SMTP 服务器将负责分解每条消息。在构建新消息时，传出 SMTP 服务器将只为每个密件抄送收件人发送适用的 RCPT TO 命令。所以在所有收件人都是密件抄送的情况下，每条消息将只有一个 RCPT TO 命令。

既然如此，看来我真的只需要关心我们的传出 SMTP 服务器配置。无需担心目标 SMTP 服务器。

我得到了一个建议，这似乎是测试这个的好方法。我可以将我的消息发送给多个收件人，每个收件人都有一个我们有效父域的唯一虚假子域。当没有找到子级的 MX 记录时，将使用父级。传出 SMTP 服务器不会意识到虚假域不存在，因此这应该避免针对具有公共域的多个收件人进行任何 SMTP 优化。我们可能还可以配置这些消息将全部路由到同一个收件箱。

# arrays - 在二维数组中查找邻居

> ID：652106
> 
> 赞同：33
> 
> 时间：2009-03-16T20:47:33.880
> 
> 标签：arrays, multidimensional-array, language-agnostic

有没有一种简单的方法可以在二维数组中找到一个元素的邻居（即一个元素周围的八个元素）？不只是以不同的组合减去和添加到索引，如下所示：

```
array[i-1][i]
array[i-1][i-1]
array[i][i-1]
array[i+1][i] 
```

... 等等。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-16T20:53:25.880

（伪代码）

```
row_limit = count(array);
if(row_limit > 0){
  column_limit = count(array[0]);
  for(x = max(0, i-1); x <= min(i+1, row_limit); x++){
    for(y = max(0, j-1); y <= min(j+1, column_limit); y++){
      if(x != i || y != j){
        print array[x][y];
      }
    }
  }
} 
```

当然，这几乎与原始硬编码解决方案一样多行，但是有了这个，您可以尽可能多地扩展“邻居”（2-3 个或更多单元格）

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-16T22:39:35.687

我认为 Ben 的方法是正确的，尽管我可能会对其进行重新排序，以可能改善局部性。

```
array[i-1][j-1]
array[i-1][j]
array[i-1][j+1]

array[i][j-1]
array[i][j+1]

array[i+1][j-1]
array[i+1][j]
array[i+1][j+1] 
```

避免边界检查问题的一个技巧是使数组维度比需要的大 2。所以，像这样的小矩阵

```
3 1 4
1 5 9
2 6 5 
```

实际上实现为

```
0 0 0 0 0
0 3 1 4 0
0 1 5 9 0
0 2 6 5 0
0 0 0 0 0 
```

然后在求和时，我可以在两个维度上从 1 到 3 下标，并且上面的数组引用保证有效，并且对最终总和没有影响。我假设该示例使用 c 和基于零的下标

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-09-29T05:10:31.680

这是来自@seb 原始伪代码的一个有效的 Javascript 示例：

```
function findingNeighbors(myArray, i, j) {
  var rowLimit = myArray.length-1;
  var columnLimit = myArray[0].length-1;

  for(var x = Math.max(0, i-1); x <= Math.min(i+1, rowLimit); x++) {
    for(var y = Math.max(0, j-1); y <= Math.min(j+1, columnLimit); y++) {
      if(x !== i || y !== j) {
        console.log(myArray[x][y]);
      }
    }
  }
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-16T21:16:42.530

@SebaGR 的替代方案，如果您的语言支持：

```
var deltas = { {x=-1, y=-1}, {x=0, y=-1}, {x=1, y=-1},
               {x=-1, y=0},               {x=1, y=0},
               {x=-1, y=1},  {x=0, y=1},  {x=1, y=1} };
foreach (var delta in deltas)
{
    if (x+delta.x < 0 || x + delta.x >= array.GetLength(0) ||
        y+delta.y < 0 || y + delta.y >= array.GetLength(1))
        continue;

    Console.WriteLine("{0}", array[x + delta.x, y + delta.y]);
} 
```

如果您可以静态分配增量，则在可读性和可能的​​性能方面略有优势。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-16T20:51:50.750

要打印 的邻居`L[row][column]`：

```
 print(L[row-1][column-1], L[row-1][column], L[row-1][column+1])
  print(L[row][column-1], L[row][column], L[row][column+1])
  print(L[row+1][column-1], L[row+1][column], L[row+1][column+1]) 
```

这可能是最快/最简单的方法就是打印可能的邻居。确保进行索引越界检查。

某些语言可能会提供这样做的捷径，但我不知道。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-04-23T05:08:57.577

这是在 python3+ 中@Seb 的答案的一个实现，它简洁并使用生成器来获得最大性能：

```
def neighbours(pos, matrix):
    rows = len(matrix)
    cols = len(matrix[0]) if rows else 0
    for i in range(max(0, pos[0] - 1), min(rows, pos[0] + 2)):
        for j in range(max(0, pos[1] - 1), min(cols, pos[1] + 2)):
            if (i, j) != pos:
                yield matrix[i][j] 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-07-07T19:35:38.650

这是 Python 中一个方便的方法：

```
def neighbors(array,pos):
    n = []
     string = "array[pos.y+%s][pos.x+%s]"
    for i in range(-1,2):
        for j in range(-1,2):
            n.append(eval(string % (i,j)))
    return n 
```

假设 pos 是一些 2D Point 对象，而 array 是一个 2D 数组。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-04-14T06:16:04.243

由于在一个元素周围的矩阵中只有 8 个元素，您可以使用数组来存储不同的索引值。例如，

```
 int iarr[8] = {-1,-1,-1,0,0,+1,+1,+1};
  int jarr[8] = {-1,0,+1,-1,+1,-1,0,+1};
  for(int i = 0 ; i < 8 ; i++)
   {
    if(arr[x-iarr[i]][y-jarr[i]] == 1)
    {
     //statements
    }
   }  
  /* x and y are the position of elements from where you want to reach out its neighbour */ 
```

因为两个数组都只包含 8 个值，所以空间可能不是问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-01-07T21:07:08.373

我通常采用的方法在此博客的底部进行了描述： [https ://royvanrijn.com/blog/2019/01/longest-path/](https://royvanrijn.com/blog/2019/01/longest-path/)

我喜欢对 8 个“方向”使用单个整数循环，而不是对方向进行硬编码或使用两个嵌套循环，并使用 (i % 3)-1 和 (i / 3)-1; 请查看带有图像的博客。

它不会嵌套那么深并且易于编写，不需要很多代码！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-05-28T16:37:39.973

网格（矢量 2D 或一维......这里不是问题）
X 和 Y，元素的坐标（或者只是通过参考传递你的矢量元素......）

```
int neighbour(const Grid & g, const size_t & x, const size_t & y) {
    for (int i = -1; i < 2; ++i)
        for (int j = -1; j < 2; ++j)
            if (x + i >= 0 && x + i < g.row && y + j >= 0 && y + j < g.col)
                //Do some stuff
    return 0;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-06-07T22:05:11.763

JS 示例：

```
 function findingNeighbors(myArray, i, j){
        return myArray.reduce(function(a, b, c){
            if(Math.max(0, i-1) <= c && c <= Math.min(i+1, myArray.length-1)){
                a = a.concat(
                    b.reduce(function(d, e, f){
                    if(f == j && c == i)
                        return d;
                    if(Math.max(0, j-1) <= f && f <= Math.min(j+1, myArray.length-1))
                        d.push(e)
                    return d;
                    },[])
                );
            }
            return a;
        },[]);
    } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-08-03T03:46:03.233

```
// My approach in JS

let size = 10
//or some arbitrary number for the size of your grid.

const neighbors = [

[-1, -1], 
[-1, 0], 
[-1, 1], 
[0, -1], 
[0, 1], 
[1, -1], 
[1, 0], 
[1, 1]

]

for (let i = 0; i < size; i++) {
    for (let j = 0; j < size; j++) {
        neighbors.forEach(([x, y]) => {
            const newI = i + x;
            const newJ = j + y;

            if (
                newI >= 0 && 
                newI < size && 
                newJ >= 0 && 
                newJ < size
               ) {
                // you can access your grid neighbors here ----> grid[newI][newJ];
              }
    ```

I've found this approach helpful because it defines all of the array coordinates as transformations of the existing i and j indexes in your for loops. 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-16T21:11:08.550

很大程度上取决于您的数据是什么。例如，如果您的二维数组是一个逻辑矩阵，您可以将行转换为整数并使用按位运算来找到您想要的。

对于更通用的解决方案，我认为您会遇到索引问题，例如 SebaGR 的解决方案。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-11-24T21:37:17.743

行和列是行和列的总数

定义一个 CellIndex 结构或类。或者您可以只返回实际值而不是索引。

```
public List<CellIndex> GetNeighbors(int rowIndex, int colIndex)
{
var rowIndexes = (new int[] { rowIndex - 1, rowIndex, rowIndex + 1 }).Where(n => n >= 0 && n < Rows);

var colIndexes = (new int[] { colIndex - 1, colIndex, colIndex + 1 }).Where(n => n >= 0 && n < Cols);

return (from row in rowIndexes from col in colIndexes where row != rowIndex || col != colIndex select new CellIndex { Row = row, Col = col }).ToList();
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-03-21T19:58:47.377

```
private ArrayList<Element> getNeighbors(Element p) {
    ArrayList<Element> n = new ArrayList<Element>();

    for (int dr = -1; dr <= +1; dr++) {
        for (int dc = -1; dc <= +1; dc++) {
            int r = p.row + dr;
            int c = p.col + dc;

            if ((r >= 0) && (r < ROWS) && (c >= 0) && (c < COLS)) {
                // skip p
                if ((dr != 0) || (dc != 0))
                    n.add(new Element(r, c));
            }               
        }
    }

    return n;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-03-11T07:24:14.130

尽管列表推导中的嵌套 for 循环有点难看，但它更短：

```
def neighbours(m, i, j):
    return [m[x][y] for x in [i-1,i,i+1] for y in [j-1,j,j+1] if x in range(0,len(m)) and y in range(0,len(m[x])) and (x,y) != (i,j)] 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-07-10T22:17:32.327

这是 C# 的一些代码：

```
public Cell[,] MeetNeigbours(Cell[,] Grid)
    {
        for (int X = 0; X < Grid.GetLength(0); X++)
        {
            for (int Y = 0; Y < Grid.GetLength(1); Y++)
            {
                int NeighbourCount = 0;
                for (int i = -1; i < 2; i++)
                {
                    for (int j = -1; j < 2; j++)
                    {
                        if (CellExists(Grid, (X + i)), (Y + j) && (i != 0 && j != 0))
                        {
                            Grid[X, Y].Neighbours[NeighbourCount] = Grid[(X + i), (Y + j)];
                        }
                        if(!(i == 0 && j == 0))
                        {
                            NeighbourCount++;
                        }
                    }
                }
            }
        }
        return Grid;
    }

    public bool CellExists(Cell[,] Grid, int X, int Y)
    {
        bool returnValue = false;
        if (X >= 0 && Y >= 0)
        {
            if (X < Grid.GetLength(0) && Y < Grid.GetLength(1))
            {
                returnValue = true;
            }
        }

        return returnValue;
    } 
```

“Cell”类看起来像这样：

```
public class Cell
{
    public Cell()
    {
        Neighbours = new Cell[8];
    }

    /// <summary>
    /// 0 3 5
    /// 1 X 6
    /// 2 4 7
    /// </summary>
    public Cell[] Neighbours;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-02-26T20:02:22.307

这在最近的一个项目中对我很有帮助，所以这里是 @Seb 的 swift 伪代码实现。这是假设二维数组是正方形的：

```
func adjacentIndexPaths(to indexPath: IndexPath) -> [IndexPath] {
var neighboringSquareIndexes: [IndexPath] = []

// gridSquareCount is the size of the 2D array. For example, in an 8 x 8 [[Array]], gridSquareCount is 8
let maxIndex = gridSquareCount - 1
var neighborRowIndex = max(0, indexPath.section - 1)
var neighborColumnIndex = max(0, indexPath.row - 1)

while neighborRowIndex <= min(indexPath.section + 1, maxIndex) {
    while neighborColumnIndex <= min(indexPath.row + 1, maxIndex) {
        if neighborRowIndex != indexPath.section || neighborColumnIndex != indexPath.row {
            neighboringSquareIndexes.append(IndexPath(row: neighborColumnIndex, section: neighborRowIndex))
        }
        neighborColumnIndex += 1
    }
    neighborRowIndex += 1
    neighborColumnIndex = max(0, indexPath.row - 1)
}

return neighboringSquareIndexes } 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-05-20T18:39:57.833

在 JavaScript 中

```
 let arr = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]

        function getNeighborsNumbersAtIthJth(i, j) {
            let allPosibleIndexes = [
                [i - 1, j],
                [i, j - 1],
                [i - 1, j - 1],
                [i + 1, j],
                [i, j + 1],
                [i + 1, j + 1],
                [i + 1, j - 1],
                [i - 1, j + 1]
            ];
            let allPosibleValues = []
            allPosibleIndexes.forEach(([i, j]) => {
                try {
                    allPosibleValues.push(arr[i][j])
                } catch (err) {

                }
            })
            return allPosibleValues.filter(v => v != undefined);
        }
        console.log(getNeighborsNumbersAtIthJth(1, 1));//[2, 4, 1, 8, 6, 9, 7, 3]
        console.log(getNeighborsNumbersAtIthJth(0, 1));//[1, 5, 3, 6, 4]
        console.log(getNeighborsNumbersAtIthJth(0, 0));//[4, 2, 5] 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-07-29T00:42:22.467

我使用一个方向数组并运行一个循环来获得适当的方向。像这样的东西（代码在 JS 中）

```
function getAdjacent(matrix, i, j, k) {
  const directions = [
    [i - 1, j - 1],
    [i - 1, j],
    [i - 1, j + 1],
    [i, j - 1],
    [i, j + 1],
    [i + 1, j - 1],
    [i + 1, j],
    [i + 1, j + 1],
  ];
  const [row, col] = directions[k];
  // Check for last rows and columns
  if (row < 0 || row >= matrix.length || col < 0 || col >= matrix[i].length) {
    return undefined;
  }
  return matrix[row][col];
}

function run(){
  const hello = 'hello';
  const matrix = [
    [1, 2, 1],
    [2, 1, 1],
    [1, 1, 1]
  ];

  for (let i = 0; i < matrix.length; i++) {
    for (let j = 0; j < matrix[i].length; j++) {
      let sum = 0;
      for (let k = 0; k < 8; k++) {
        const res = getAdjacent(matrix, i, j, k);
        console.log(i, j, k, res); // Do whatever you want here
      }
    }
  }
}

run();
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-12-09T17:32:23.633

Python 中的这个示例也可能会有所启发：

```
from itertools import product
def neighbors(coord: tuple, grid=(10, 10), diagonal=True):
    """Retrieve all the neighbors of a coordinate in a fixed 2d grid (boundary).

    :param diagonal: True if you also want the diagonal neighbors, False if not
    :param coord: Tuple with x, y coordinate
    :param grid: the boundary of the grid in layman's terms
    :return: the adjacent coordinates
    """
    width = grid[0] - 1
    height = grid[1] - 1
    retx, rety = coord
    adjacent = []
    nb = [x for x in product([-1, 0, 1], repeat=2) if x != (0, 0)]
    if not diagonal:
        nb = [x for x in nb if x not in product([-1, 1], repeat=2)]
    for x, y in nb:
        xx = retx + x
        yy = rety + y
        if xx < 0 or xx > width or yy < 0 or yy > height:
            # not within its boundaries
            continue
        adjacent.append((xx, yy))
    return adjacent 
```

第一条产品线 ( `nb = [x for x in product([-1, 0, 1], repeat=2) if x != (0, 0)]`) 将生成其相邻元素的所有坐标，包括对角线坐标。(0,0) 被删除，因为那是我们自己，所以不是邻居:-)

```
[(-1, -1), (-1, 0), (-1, 1), (0, -1), (0, 1), (1, -1), (1, 0), (1, 1)] 
```

如果您不想要对角线邻居，您可以告诉它删除那些 ( `product([-1, 1], repeat=2)`)，然后检查网格的边界并生成坐标的结果列表。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2022-01-31T05:09:31.147

`Ruby`=> 返回一个邻居数组。

```
array = [
    [1, 2, 5, 6],
    [8, 89, 44, 0],
    [8, 7, 23, 0],
    [6, 9, 3, 0]
  ]

  def neighbours(array, (i , j)) 
    [
      [i, j - 1],
      [i, j + 1],
      [i - 1, j - 1],
      [i - 1, j],
      [i - 1, j + 1],
      [i + 1, j - 1],
      [i + 1, j],
      [i + 1, j + 1],
    ].select { |h, w|
        h.between?(0, array.length - 1) && w.between?(0, array.first.length - 1)
      }.map do |row, col|
          array[row][col]
      end 
  end

  array.each_with_index do |row, i|
    row.each_with_index do |col, j|
      p(array[i][j], neighbours(array, [i, j]))
    end 
  end 
```

# vb.net - nHibernate 选择查询？

> ID：652107
> 
> 赞同：0
> 
> 时间：2009-03-16T20:48:30.010
> 
> 标签：vb.net, nhibernate

我有一个要转换为使用 NHibernate 的 ado.net 语句：

```
Dim sql As New StringBuilder()
sql.AppendLine("SELECT r.RoleId,  r.RoleName ")
sql.AppendLine("FROM dbo.aspnet_Roles r ")
sql.AppendLine("WHERE r.RoleId IN ")
sql.AppendLine(" (select roleID from dbo.MenuRole where menuId = @MenuId) ")
sql.AppendLine("Order By r.RoleName") 
```

稍后，我使用以下命令填充参数： cmd.Parameters.AddWithValue("@MenuId", menuId)

考虑到我想返回一个：IList(Of AspnetRole)

我正在使用：

```
Dim managerFactory As IManagerFactory = New ManagerFactory()
Dim roleManager As IAspnetRoleManager = managerFactory.GetAspnetRoleManager() 
```

如何使用 nHiberate 构建和使用该查询？

（PS 我正在使用 Codesmithtools 和 VB.net 以及 VS2008 和 SQL Server 2008）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T21:59:22.913

首先，您必须将 aspnet_roles 表和 MenuRole 表映射到它们对应的类。一旦你映射了它们，我还将一个多对一的 MenuRole 属性映射到 AspnetRole 类。

完成后，条件查询应如下所示：

```
Dim c As ICriteria = Session.CreateCriteria(TypeOf(AspnetRole))
c.Add(Restrictions.Eq("Menu.Id", menuId)
return c.List(Of AspnetRole) 
```

# java - 在 Java 中通过包 java.sql 使用 SQL

> ID：652117
> 
> 赞同：0
> 
> 时间：2009-03-16T20:51:18.863
> 
> 标签：java, php, sql, database, derby

在一次讲座中，我的教授给出了一些涉及数据库和 java.sql 包的操作示例。这些示例应该以 pdf 文件的形式在线上传，但由于某种原因，我的 pdf 阅读器没有显示所有函数的名称和类名。

我想知道 Java 中以下 PHP 函数的等价物：

```
mysql_connect
mysql_query
mysql_fetch_row
mysql_fetch_assoc
mysql_close 
```

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T20:55:17.810

如果您查阅适用于您正在使用的版本的 Java API 文档（我使用的是 JDK 1.5，所以它是[http://java.sun.com/j2se/1.5.0/docs/api/](http://java.sun.com/j2se/1.5.0/docs/api/)）并单击 java .sql，您可以看到所有用于 Java JDBC 访问的类。

基本上，您使用 DriverManager 创建一个到数据库的新连接，并使用 Connection.prepareStatement、PreparedStatement.execute() 和 PreparedStatement.executeQuery() 进行查询，并使用 ResultSet.next() 循环遍历结果集并拉出结果使用 ResultSet.getXXXX。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-06T22:35:24.673

If you're just getting started with JDBC, consider working your way through Sun's tutorial at: [http://java.sun.com/docs/books/tutorial/jdbc/basics/](http://java.sun.com/docs/books/tutorial/jdbc/basics/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T01:07:35.207

直接使用 JDBC (java.sql) 非常冗长且容易出错，尤其是对于初学者来说，因为您需要手动执行非常重复的步骤，并“最终”关闭如此多的数据库对象（连接、语句、结果集）。

如果您不介意引入额外的依赖项，Apache Commons 有一个名为[DbUtils](http://commons.apache.org/dbutils/)的漂亮小包装器包，它可以轻松运行查询和更新（同时仍保持在 SQL 级别，而不是对象关系映射器）更高层次的抽象）。

# c# - （更多）在线程二叉树中旋转节点时的高效锁定

> ID：652127
> 
> 赞同：3
> 
> 时间：2009-03-16T20:55:02.037
> 
> 标签：c#, multithreading, data-structures, concurrency, tree

所以，我想出了这个方案，用于在多个线程同时具有读写访问权限的二叉树中旋转时锁定节点，这涉及每次旋转锁定四个节点，这似乎非常多？我想出了一种更聪明的方法，然后我想出了一种减少所需锁定的方法，但谷歌并没有出现太多（我可能使用了错误的术语）。

这是我目前的方案，橙色和红色节点被旋转移动或更改，需要锁定，绿色节点与任何受旋转影响但本身不受旋转影响的节点相邻。

[二叉树旋转](http://totmacher.eu/upload/binarytree.jpg)

我认为必须有一种更好的方法来做到这一点，我的一个想法是拍摄受影响的四个节点的快照，在快照中旋转它们，然后用快照替换当前节点（假设在我正在做旋转）-这将使我*几乎*可以无锁，但考虑到旋转是一个相当快速的操作（重新分配三个指针），我担心内存开销可能会很大？

我想我正在寻找如何有效地做到这一点的指针（没有双关语）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T21:17:27.583

看看不可变二叉树。您必须更改更多节点（每个节点到根），但这不会改变双向插入的复杂性`log n`。事实上，它甚至可以提高性能，因为您不需要任何同步代码。

例如，Eric Lippert 写了一些关于 C# 中不可变 avl 树的文章。最后一个是：[C# 中的不变性第 9 部分：学术？加上我的 AVL 树实现](http://blogs.msdn.com/ericlippert/archive/2008/01/21/immutability-in-c-part-nine-academic-plus-my-avl-tree-implementation.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:17:08.330

Lock-free algorithms, as far as I can see, lack reference counts, which makes their general use problematic; you can't know if the pointer you have to an element is valid - maybe that element went away.

Valois' gets around this with some exotic memory allocation arrangement *which is not useful in practise*.

The only way I can see to do lock-free balanced trees is to use a modified MCAS, where you can also do increment/decrement, so you can maintain a reference count. I've not looked to see if MCAS can be modified in this way.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T21:18:37.567

考虑到锁本身通常会占用一些严重的资源，因此通常会有一个锁用于整个数据结构。我猜你想避免这种情况，这一定是一些非常特殊的场景，你有很多 CPU 密集型工作线程不断更新树？

你可以通过让每 N 个节点共享一个锁来获得平衡。进入轮换操作时，找到受影响节点使用的唯一锁集。大多数情况下，它只是一把锁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T00:28:23.147

最佳解决方案取决于您的应用。但是，如果您喜欢一个内存数据库，并且想要对其进行并发更新并且想要非常细粒度的锁定，那么您还可以查看不需要像二叉树那样经常进行节点旋转的 B 树. 它们也是自动平衡的，与二叉树不同，二叉树需要更多的旋转来保持平衡（例如 Splay 或 AVL 树）。

如果您想对树进行事务性修改，则可以使用功能性 B 树（Thomas Danecker 将其称为不可变树）。这些是一种“写入时复制”的二叉树，您唯一需要锁定的是根节点。所以你只需要一把锁。实际上，这些操作的复杂性与二叉树相同，因为功能二叉树上的所有操作都是 O(log n) 并且无论何时从任何树下来都会花费相同的对数时间。

每个节点拥有一个锁很可能不是正确的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T02:49:32.917

John Valois 的[论文](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.41.9506)简要描述了一种使用辅助节点实现二叉搜索树的方法。我在并发 LinkedHashMap 的[设计中使用了辅助节点方法。](http://code.google.com/p/concurrentlinkedhashmap/wiki/Design)您可能可以在 CiteSeerX 上找到许多其他关于并发树的论文（非常宝贵的资源）。除非真的有必要，否则我会远离使用树作为并发数据收集，因为它们由于重新平衡而往往具有较差的并发特性。通常更务实的方法，如跳过列表，效果更好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T10:08:51.113

我尝试使用写入时的部分复制使二叉树无锁读取。我在这里发布了一个不完整的实现[http://groups.google.com/group/comp.programming.threads/msg/6c0775e9882516a2?hl=en&](http://groups.google.com/group/comp.programming.threads/msg/6c0775e9882516a2?hl=en&)

# iphone - 将 iPhone 应用程序安装到 iPhone

> ID：652129
> 
> 赞同：2
> 
> 时间：2009-03-16T20:55:29.900
> 
> 标签：iphone

我遵循了这个网站的教程：

[http://theappleblog.com/2008/08/04/tutorial-build-a-simple-rss-reader-for-iphone/](http://theappleblog.com/2008/08/04/tutorial-build-a-simple-rss-reader-for-iphone/)

制作我的第一个 iPhone 应用程序，现在我想在我的 iPhone 上测试这个应用程序，我需要采取哪些步骤才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T22:34:48.600

你有两个选择。[您可以像大多数人一样在iPhone 开发中心](http://developer.apple.com/iphone/ "iPhone 开发中心")注册成为 iPhone 开发人员，然后通过在概览菜单中选择“设备 - iPhone OS 2.2”然后点击构建并开始直接部署到设备。

如果您不使用任何 2.2 特定的 API，您可以使用“设备 - iPhone OS 2.1”进行编译，然后通过 SFTP 将您的应用程序包发送到越狱的 iPhone，并使用 ldid 实用程序伪造代码设计过程，让您可以无需注册成为开发人员即可在设备上随意摆弄您的应用程序，也无需为安装开放工具链而头疼。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T20:57:12.423

成为注册的 iPhone 开发者。如果不先执行此操作，您将无法部署到手机。

[http://developer.apple.com/iphone/](http://developer.apple.com/iphone/)

# php - Flex 与 PHP 通信的最佳方法？

> ID：652134
> 
> 赞同：8
> 
> 时间：2009-03-16T20:57:52.780
> 
> 标签：php, xml, apache-flex, amfphp, weborb

Flex 和 PHP 之间通信的最佳方法是什么？

过去，我们将 AMFPHP 与 AS2 一起使用，它在大多数情况下都运行良好（AMFPHP 的优势在于它还具有 JSON 模式，可以让您无缝地使用相同的远程 PHP 与 Javascript 或 Actionscript 前端）。

但是，似乎 AMFPHP 不再真正维护了。那么人们建议用什么来代替它呢？到目前为止，我发现的是：

1.  **[Zend_AMF](http://framework.zend.com/wiki/display/ZFPROP/Zend_Amf+-+Wade+Arnold)**（对我们来说看起来太复杂了，否则我们没有使用 Zend 框架）
2.  **[AMFPHP](http://www.amfphp.org/)**（有一些支持 Flex 的更新，看起来相当稳定，但不确定是否长期支持）
3.  **XML**（AS3 有很好的 XML 处理例程，但它在 PHP 方面更痛苦）
4.  **[WebORB](http://www.themidnightcoders.com/products/weborb-for-php)**（我没有这方面的经验）
5.  **使用 JSON 或其他一些数据到文本的序列化系统（php 的 serialize()、XML 等）**自行滚动****

 **大多数情况下，我倾向于 AMFPHP，即使是因为它的缺点，因为那是我习惯的。有什么理由我应该考虑改用其他东西吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T15:22:09.677

如果您想进行快速高效的通信，我强烈建议您坚持使用[AMF 协议](http://en.wikipedia.org/wiki/Action_Message_Format)而不是 REST 或 JSON 自定义格式。

**ZendAMF 实际上并不是很混乱。**[看GotoAndLearn](http://gotoandlearn.com/play?id=90) 的介绍教程，很简单。

如您所知， AMFPHP[的一些开发人员](http://framework.zend.com/wiki/display/ZFPROP/Zend_Amf+-+Wade+Arnold)转而从事 ZendAMF 工作。所以从某种意义上说，ZendAMF 是 AMFPHP 的延续。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T07:02:23.130

ZendAMF 不错的短读 - [http://theflashblog.com/?p=441](http://theflashblog.com/?p=441)

对我来说，这不是明智之举。Zend 框架是目前最好的 php 框架之一，现在您可以与 Flash 客户端对话。最重要的是 Adob​​e 支持，这在我的书中已经完成。

备择方案 ：

WebORB for php [http://www.themidnightcoders.com/products/weborb-for-php](http://www.themidnightcoders.com/products/weborb-for-php)

AMFPHP [http://www.amfphp.com](http://www.amfphp.com) 如果您阅读上面的 url，您可能会知道为什么我不再关注它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T21:05:10.640

我不能告诉你什么是最好的（因为这可能有点主观），但我能做的就是告诉你我最近的一个项目。

由于这是一个非常丰富的 Web 应用程序，并且对服务器的数据请求会很频繁，因此我想确保请求的大小尽可能小。这意味着选择 JSON 作为格式。

接下来，由于应用程序的性质以及我的 flash/flex 开发人员在 1000 英里之外的事实，我需要一个简单且无状态的 API。这最终导致我们使用 HTTP + REST。

因此，我的应用程序的通信层是一个简单的 Zend Framework 支持的 REST 资源集，其 URI 如下

```
user/10
review/15
location/8/reviews 
```

它们都返回 JSON。所有错误也有一个通用的 JSON 格式（异常被捕获并转换为 JSON 对象），因此 flash 客户端可以轻松处理故障。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T04:32:00.853

如果您不使用 Zend 之类的框架，那么常规的 ol AMFPHP 仍然很棒，如果没有其他原因，它很简单。我想如果你觉得舒服，为什么不去呢？这些 AMF 接口的作用在于，它们真的不需要做太多事情，而 AMFPHP 在类映射、记录集解析成 ArrayCollection、出色的性能方面确实有什么……它甚至可以很好地处理 XML，因为它被压缩了。与 Charles 结合的服务浏览器也覆盖了我。

我无法理解 ZendAMF 工作与原始 AMFPHP 之间的关系。虽然我可以挖掘，但我只是说在关注 Nabble 上的 AMFPHP 邮件列表，阅读 Wade Arnold 的博客时......这并不完全清楚。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-23T06:44:12.243

您应该考虑使用 Zend AMF。Zend 框架被设计为一个选择框架，因此为您的应用程序选择单个组件（在本例中为 Zend AMF）是完全可以的。

Zend AMF 非常易于使用。您所要做的就是指定要公开的函数/类，并指定到动作脚本类的类映射。其他一切都非常透明。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-18T14:37:46.050

此链接是一个截屏视频，展示了如何使用 WebORB for PHP WDMF（WebORB Data Management for Flex）。

[http://www.themidnightcoders.com/products/weborb-for-php/developer-den/screencasts/weborb-data-management-for-flex-and-php.html](http://www.themidnightcoders.com/products/weborb-for-php/developer-den/screencasts/weborb-data-management-for-flex-and-php.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T21:02:54.047

在所有涉及 Flash 和 PHP 后端的项目中，我使用 AMFPHP 或 XML 请求。

AMFPHP 确实简化了对未来维护的应用程序的*理解*，尽管它将整个事情与特定技术联系在一起，并且在服务器端涉及一些额外的开销——创建所有需要的类。

根据 XML，您在这里获得的是标准 REST Web 服务，它不依赖于 Flash（例如，您也可以从桌面应用程序中提取数据，而使用 JSON 或任何其他依赖于浏览器的技术则不允许这样做）。

如果您想要 100% 的未来“支持”，那么我会推荐根本不需要任何支持的东西：XML。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-20T20:06:13.043

[使用SimpleXML](http://www.php.net/simplexml)可以使 PHP 上的 XML 简单得多。

我只是使用 JSON 作为对 PHP api 的简单调用的返回值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-23T13:25:01.563

我肯定会选择 WebORB。我在以前的工作中将它与 .NET 一起使用，使用它进行编码是一种乐趣。它的易用性和经过深思熟虑的管理控制台使其学习速度非常快，并且它的文档非常完整；我知道留在 AMF 是很诱人的，因为它是您已经知道的，但我相信尝试 WebORB 是值得的。

看看这个使用 PHP 生成 Actionscript 的[截屏视频，它非常漂亮。](http://www.themidnightcoders.com/products/weborb-for-php/developer-den/screencasts/using-weborb-actionscript-generator-with-php.html)

干杯。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-25T15:42:07.113

PHP 有一个相当不错的`serialize()`功能，所以对于我最近做的一个项目（游戏的高分），我使用了 Sephiroth 的[Serializer](http://www.sephiroth.it/test/unserializer/)。它使 Flash 方面的序列化几乎与 PHP 中的序列化一样容易。序列化器还处理 AMF 之类的数据类型（与 json/xml 不同）。

缺点——它不如 AMF 紧凑，但这不是 gzip 压缩无法处理的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-03-30T01:22:17.210

AMF 具有相当的情境优势。如果您要传输大型复杂对象，请务必使用 AMF。但人们对 AMF 在传输小物体时所带来的开销知之甚少。如果您只传输具有 3 个属性的对象，则使用 AMF 可以使您的有效负载大小增加三倍。

顺便说一句，我是 RESTful 架构的大力倡导者。由于 JSON 和 AMF 都只是表示，因此您可以构建一个接受两者的 REST 服务，并在运行时与您的客户端协商实际表示。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-03-19T18:08:53.347

“如果您想进行快速高效的通信，我强烈建议您坚持使用 AMF 协议”

如果您想要快速、高效和通用的通信，请使用 json。然后，您的 Web 服务将可用于 flash、ajax 或常规 http 请求。

# r - 如何从列表中删除元素？

> ID：652136
> 
> 赞同：326
> 
> 时间：2009-03-16T20:59:36.223
> 
> 标签：r, list, indexing, r-faq

我有一个列表，我想从中删除一个元素。我怎样才能做到这一点？

我已经尝试在参考手册中查找我认为该函数的明显名称，但我没有找到任何合适的名称。

* * *

## 回答 #1

> 赞同：257
> 
> 时间：2009-03-24T21:08:08.680

如果您不想就地修改列表（例如，将删除了元素的列表传递给函数），您可以使用索引：负索引表示“不包含此元素”。

```
x <- list("a", "b", "c", "d", "e"); # example list

x[-2];       # without 2nd element

x[-c(2, 3)]; # without 2nd and 3rd 
```

此外，逻辑索引向量也很有用：

```
x[x != "b"]; # without elements that are "b" 
```

这也适用于数据框：

```
df <- data.frame(number = 1:5, name = letters[1:5])

df[df$name != "b", ];     # rows without "b"

df[df$number %% 2 == 1, ] # rows with odd numbers only 
```

* * *

## 回答 #2

> 赞同：243
> 
> 时间：2009-03-16T21:16:57.553

我根本不知道 R，但是一些创造性的谷歌搜索把我带到了这里：[http://tolstoy.newcastle.edu.au/R/help/05/04/1919.html](http://tolstoy.newcastle.edu.au/R/help/05/04/1919.html)

那里的关键引述：

> 我没有找到关于如何从列表中删除元素的 R 的明确文档，但反复试验告诉我
> 
> 我的列表 [[5]] <- 空
> 
> 将删除第 5 个元素，然后“关闭”由删除该元素引起的孔。这会影响索引值，所以我必须小心删除元素。我必须从列表的后面工作到前面。

[稍后在线程中对该帖子](http://tolstoy.newcastle.edu.au/R/help/05/04/1917.html)的回复指出：

> 要删除列表中的元素，请参阅 R FAQ 7.1

R FAQ的[相关部分](http://cran.r-project.org/doc/FAQ/R-FAQ.html#How-can-I-set-components-of-a-list-to-NULL_003f)说：

> ...不要将 x[i] 或 x[[i]] 设置为 NULL，因为这将从列表中删除相应的组件。

这似乎告诉您（以某种倒退的方式）如何删除元素。

希望这会有所帮助，或者至少可以引导您朝着正确的方向前进。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2018-05-02T21:08:59.033

我想补充一点，如果它是一个*命名列表*，您可以简单地使用`within`.

```
l <- list(a = 1, b = 2)    
> within(l, rm(a))
$b
[1] 2 
```

所以你可以覆盖原来的列表

```
l <- within(l, rm(a)) 
```

`a`从 list中删除命名的元素`l`。

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2011-01-13T20:58:21.550

以下是如何删除R中**列表**的最后一个元素：

```
x <- list("a", "b", "c", "d", "e")
x[length(x)] <- NULL 
```

如果 x 可能是一个向量，那么您需要创建一个新对象：

```
x <- c("a", "b", "c", "d", "e")
x <- x[-length(x)] 
```

*   适用于**列表**和**向量**

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2010-07-26T16:14:54.890

从单行列表中删除 Null 元素：

`x=x[-(which(sapply(x,is.null),arr.ind=TRUE))]`

干杯

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2014-02-26T12:20:10.353

如果您有一个命名列表并想要删除特定元素，您可以尝试：

```
lst <- list(a = 1:4, b = 4:8, c = 8:10)

if("b" %in% names(lst)) lst <- lst[ - which(names(lst) == "b")] 
```

这将创建一个`lst`包含元素`a`, `b`,的列表`c`。第二行在`b`检查元素是否存在后删除它（以避免@hjv 提到的问题）。

或更好：

```
lst$b <- NULL 
```

这样，尝试删除不存在的元素（例如`lst$g <- NULL`）就没有问题了

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-10-25T15:34:22.007

有 rlist 包（[http://cran.r-project.org/web/packages/rlist/index.html](http://cran.r-project.org/web/packages/rlist/index.html)）来处理各种列表操作。

示例（[http://cran.r-project.org/web/packages/rlist/vignettes/Filtering.html](http://cran.r-project.org/web/packages/rlist/vignettes/Filtering.html)）：

```
library(rlist)
devs <- 
  list(
    p1=list(name="Ken",age=24,
      interest=c("reading","music","movies"),
      lang=list(r=2,csharp=4,python=3)),
    p2=list(name="James",age=25,
      interest=c("sports","music"),
      lang=list(r=3,java=2,cpp=5)),
    p3=list(name="Penny",age=24,
      interest=c("movies","reading"),
      lang=list(r=1,cpp=4,python=2)))

list.remove(devs, c("p1","p2")) 
```

结果是：

```
# $p3
# $p3$name
# [1] "Penny"
# 
# $p3$age
# [1] 24
# 
# $p3$interest
# [1] "movies"  "reading"
# 
# $p3$lang
# $p3$lang$r
# [1] 1
# 
# $p3$lang$cpp
# [1] 4
# 
# $p3$lang$python
# [1] 2 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2018-09-10T15:32:32.397

与元素的位置一起使用`-`（负号），例如，如果要删除第三个元素，则将其用作`your_list[-3]`

**输入**

```
my_list <- list(a = 3, b = 3, c = 4, d = "Hello", e = NA)
my_list
# $`a`
# [1] 3

# $b
# [1] 3

# $c
# [1] 4

# $d
# [1] "Hello"

# $e
# [1] NA 
```

**从列表中删除单个元素**

```
 my_list[-3]
 # $`a`
 # [1] 3

 # $b
 # [1] 3

 # $d
 # [1] "Hello"

 # $e
 [1] NA 
```

**从列表中删除多个元素**

```
 my_list[c(-1,-3,-2)]
 # $`d`
 # [1] "Hello"

 # $e
 # [1] NA 
```

* * *

```
 my_list[c(-3:-5)]
 # $`a`
 # [1] 3

 # $b
 # [1] 3 
```

* * *

```
 my_list[-seq(1:2)]
 # $`c`
 # [1] 4

 # $d
 # [1] "Hello"

 # $e
 # [1] NA 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-06-10T14:31:31.190

不知道你是否还需要这个问题的答案，但我从我有限的（3 周的自学 R）经验中发现，使用`NULL`分配实际上是错误的或次优的，尤其是在动态更新的情况下类似于 for 循环的列表。

更准确地说，使用

```
myList[[5]] <- NULL 
```

会抛出错误

> myList[[5]] <- NULL : 替换长度为零

或者

> 提供的元素多于替换的元素

我发现工作更一致的是

```
myList <- myList[[-5]] 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-04-28T15:20:47.603

只是想快速添加（因为我在任何答案中都没有看到），对于命名列表，您也可以执行`l["name"] <- NULL`. 例如：

```
l <- list(a = 1, b = 2, cc = 3)
l['b'] <- NULL 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2018-01-11T13:22:02.567

在命名列表的情况下，我发现这些辅助函数很有用

```
member <- function(list,names){
    ## return the elements of the list with the input names
    member..names <- names(list)
    index <- which(member..names %in% names)
    list[index]    
}

exclude <- function(list,names){
     ## return the elements of the list not belonging to names
     member..names <- names(list)
     index <- which(!(member..names %in% names))
    list[index]    
}  
aa <- structure(list(a = 1:10, b = 4:5, fruits = c("apple", "orange"
)), .Names = c("a", "b", "fruits"))

> aa
## $a
##  [1]  1  2  3  4  5  6  7  8  9 10

## $b
## [1] 4 5

## $fruits
## [1] "apple"  "orange"

> member(aa,"fruits")
## $fruits
## [1] "apple"  "orange"

> exclude(aa,"fruits")
## $a
##  [1]  1  2  3  4  5  6  7  8  9 10

## $b
## [1] 4 5 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2020-07-24T08:23:40.697

您还可以使用包的`extract`功能从列表中负索引`magrittr`以删除列表项。

```
a <- seq(1,5)
b <- seq(2,6)
c <- seq(3,7)
l <- list(a,b,c)

library(magrittr)

extract(l,-1) #simple one-function method
[[1]]
[1] 2 3 4 5 6

[[2]]
[1] 3 4 5 6 7 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-08-25T21:00:37.100

使用 lapply 和 grep：

```
lst <- list(a = 1:4, b = 4:8, c = 8:10)
# say you want to remove a and c
toremove<-c("a","c")
lstnew<-lst[-unlist(lapply(toremove, function(x) grep(x, names(lst)) ) ) ]
#or
pattern<-"a|c"
lstnew<-lst[-grep(pattern, names(lst))] 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-07-19T20:13:58.863

这是一个可以使用基数 R 完成的简单解决方案。它从原始数字列表中删除数字 5。您可以使用相同的方法从列表中删除您想要的任何元素。

```
#the original list
original_list = c(1:10)

#the list element to remove
remove = 5

#the new list (which will not contain whatever the `remove` variable equals)
new_list = c()

#go through all the elements in the list and add them to the new list if they don't equal the `remove` variable
counter = 1
for (n in original_list){
  if (n != ){
    new_list[[counter]] = n
    counter = counter + 1
  }
} 
```

`new_list`变量不再包含 5 。

```
new_list
# [1]  1  2  3  4  6  7  8  9 10 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-02-01T18:51:32.937

包中有几个选项`purrr`没有提到：

`pluck`并且`assign_in`可以很好地使用嵌套值，您可以使用名称和/或索引的组合来访问它：

```
library(purrr)

l <- list("a" = 1:2, "b" = 3:4, "d" = list("e" = 5:6, "f" = 7:8))

# select values (by name and/or index)
all.equal(pluck(l, "d", "e"), pluck(l, 3, "e"), pluck(l, 3, 1))
[1] TRUE

# or if element location stored in a vector use !!!
pluck(l, !!! as.list(c("d", "e")))
[1] 5 6

# remove values (modifies in place)
pluck(l, "d", "e") <- NULL

# assign_in to remove values with name and/or index (does not modify in place)
assign_in(l, list("d", 1), NULL)
$a
[1] 1 2

$b
[1] 3 4

$d
$d$f
[1] 7 8 
```

或者您可以`modify_list`通过分配`zap()`或删除值`NULL`：

```
all.equal(list_modify(l, a = zap()), list_modify(l, a = NULL))
[1] TRUE 
```

您可以使用带有`discard`and的谓词函数删除或保留元素`keep`：

```
# remove numeric elements
discard(l, is.numeric)
$d
$d$e
[1] 5 6

$d$f
[1] 7 8

# keep numeric elements
keep(l, is.numeric)
$a
[1] 1 2

$b
[1] 3 4 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2012-11-16T14:56:36.743

您可以使用`which`.

```
x<-c(1:5)
x
#[1] 1 2 3 4 5
x<-x[-which(x==4)]
x
#[1] 1 2 3 5 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2015-07-01T16:47:37.620

这个怎么样？同样，使用索引

```
> m <- c(1:5)
> m
[1] 1 2 3 4 5

> m[1:length(m)-1]
[1] 1 2 3 4 
```

或者

```
> m[-(length(m))]
[1] 1 2 3 4 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2018-10-27T04:47:34.493

如果您想避免使用数字索引，可以使用

```
a <- setdiff(names(a),c("name1", ..., "namen")) 
```

从 a中删除名称`namea...namen`。这适用于列表

```
> l <- list(a=1,b=2)
> l[setdiff(names(l),"a")]
$b
[1] 2 
```

以及向量

```
> v <- c(a=1,b=2)
> v[setdiff(names(v),"a")]
b 
2 
```

# c# - OnMouseEnter 用于表单上的所有控件

> ID：652139
> 
> 赞同：0
> 
> 时间：2009-03-16T21:00:35.503
> 
> 标签：c#, winforms

我为我的表单设置了 OnMouseEnter 和 OnMouseLeave 事件处理程序。当鼠标移到表单上时，我想将不透明度设置为 100%，当鼠标移开时，我想将其设置为 25%。它工作得很好，除非鼠标移到窗体上的一个按钮上。OnMouseLeave 事件触发并再次隐藏窗体。有没有一种很好的方法来处理这个问题，而不必为表单上的每个控件连接 OnMouseEnter？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T21:10:52.607

我认为如果不处理所有孩子的 MouseEnter 和 MouseLeave 事件，这是不可能的，但您不必手动连接它们。

这是我从我的项目中复制和粘贴的一些代码。它几乎完成了您在此处描述的操作。[我实际上从这个站点](http://seewinapp.blogspot.com/2005/08/mouseenter-and-mouseleave-events-on.html)复制了这个想法和框架。

在构造函数中，我调用 AttachMouseOnChildren() 来附加事件。

OnContainerEnter 和 OnContainerLeave 用于处理鼠标进入/离开表单本身。

```
 #region MouseEnter & Leave

    private bool _childControlsAttached = false;

    /// <summary>
    /// Attach enter & leave events to child controls (recursive), this is needed for the ContainerEnter & 
    /// ContainerLeave methods.
    /// </summary>
    private void AttachMouseOnChildren() {
        if (_childControlsAttached) {
            return;
        }
        this.AttachMouseOnChildren(this.Controls);
        _childControlsAttached = true;
    }

    /// <summary>
    /// Attach the enter & leave events on a specific controls collection. The attachment
    /// is recursive.
    /// </summary>
    /// <param name="controls">The collection of child controls</param>
    private void AttachMouseOnChildren(System.Collections.IEnumerable controls) {
        foreach (Control item in controls) {
            item.MouseLeave += new EventHandler(item_MouseLeave);
            item.MouseEnter += new EventHandler(item_MouseEnter);
            this.AttachMouseOnChildren(item.Controls);
        }
    }

    /// <summary>
    /// Will be called by a MouseEnter event, with any of the controls within this
    /// </summary>
    void item_MouseEnter(object sender, EventArgs e) {
        this.OnMouseEnter(e);
    }

    /// <summary>
    /// Will be called by a MouseLeave event, with any of the controls within this
    /// </summary>
    void item_MouseLeave(object sender, EventArgs e) {
        this.OnMouseLeave(e);
    }

    /// <summary>
    /// Flag if the mouse is "entered" in this control, or any of its children
    /// </summary>
    private bool _containsMouse = false;

    /// <summary>
    /// Is called when the mouse entered the Form, or any of its children without entering
    /// the form itself first.
    /// </summary>
    protected void OnContainerEnter(EventArgs e) {
        // No longer transparent
        this.Opacity = 1;
    }

    /// <summary>
    /// Is called when the mouse leaves the form. When the mouse leaves the form via one of
    /// its children, this will also call OnContainerLeave
    /// </summary>
    /// <param name="e"></param>
    protected void OnContainerLeave(EventArgs e) {
        this.Opacity = DEFAULT_OPACITY;
    }

    /// <summary>
    /// <para>Is called when a MouseLeave occurs on this form, or any of its children</para>
    /// <para>Calculates if OnContainerLeave should be called</para>
    /// </summary>
    protected override void OnMouseLeave(EventArgs e) {
        Point clientMouse = PointToClient(Control.MousePosition);
        if (!ClientRectangle.Contains(clientMouse)) {
            this._containsMouse = false;
            OnContainerLeave(e);
        }
    }
    /// <summary>
    /// <para>Is called when a MouseEnter occurs on this form, or any of its children</para>
    /// <para>Calculates if OnContainerEnter should be called</para>
    /// </summary>
    protected override void OnMouseEnter(EventArgs e) {
        if (!this._containsMouse) {
            _containsMouse = true;
            OnContainerEnter(e);
        }
    }

    #endregion 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T21:46:20.790

编辑：我将把这个答案留在这里，即使它不能可靠地工作。原因：防止其他人尝试同样的事情。查看消息末尾的原因是它不起作用。

通过获取光标位置并检查它是否在窗体的客户区域内，您可以很容易地为客户矩形执行此操作：

```
private void Form1_MouseLeave(object sender, EventArgs e)
{
    Point clientPos = PointToClient(Cursor.Position);
    if (!ClientRectangle.Contains(clientPos))
    {
        this.Opacity = 0.25;
    }
} 
```

这假设您的子控件都不会更改不透明度。

但是，您会发现它不是一个完美的解决方案，因为当鼠标移动到标题栏时，Form 会变为 0.25%。您可以通过检查鼠标位置是否在窗口矩形内（使用 Bounds 属性）来解决此问题，但是如果鼠标移出标题栏并移出窗口，您的窗口将保持不透明。

从外部进入标题栏时，您会遇到类似的问题。

我认为您必须处理`WM_NCMOUSEENTER`and`WM_NCMOUSELEAVE`消息才能使这项工作可靠。

为什么它不能工作：即使处理非客户区通知也可能失败。鼠标有可能进入子控件，这将阻止窗体被通知。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T23:42:11.260

我认为可靠地处理您感兴趣的鼠标事件的一种方法是在您的[Application对象上设置一个](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.aspx)[IMessageFilter](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.aspx)，您可以从中拦截所有鼠标消息（[WM_MOUSEMOVE](http://msdn.microsoft.com/en-us/library/ms645616(VS.85).aspx)等 ..），即使它们被发送到表单的子控件。

这是一些演示代码：

```
using System;
using System.Windows.Forms;

namespace Test
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        public static Form frm = null;
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            frm = new Form1 {Opacity = 0.25};
            frm.Controls.Add(new Button{Dock = DockStyle.Fill, Text = "Ok"});

            Application.AddMessageFilter(new MouseMoveFilter());
            Application.Run(frm);
        }
    }

    public class MouseMoveFilter : IMessageFilter
    {
        #region IMessageFilter Members
        private const int WM_MOUSELEAVE     = 0x02A3;
        private const int WM_NCMOUSEMOVE    = 0x0A0;
        private const int WM_MOUSEMOVE      = 0x0200;
        private const int WM_NCMOUSELEAVE   = 0x2A2;

        public bool PreFilterMessage(ref Message m)
        {
            switch (m.Msg)
            {
                case WM_NCMOUSEMOVE:
                case WM_MOUSEMOVE:
                    Program.frm.Opacity = 1;
                    break;

                case WM_NCMOUSELEAVE:
                case WM_MOUSELEAVE:
                    if (!Program.frm.Bounds.Contains(Control.MousePosition))
                        Program.frm.Opacity = 0.25;
                    break;

            }
            return false;
        }

        #endregion
    }
} 
```

或者，您可以从 Form 类继承并覆盖 PreProcessMessage() 来完成同样的事情......

# java - 如何让 Weblogic 8.1 提供静态内容？

> ID：652140
> 
> 赞同：1
> 
> 时间：2009-03-16T21:01:57.730
> 
> 标签：java, weblogic, static-content

我来自开源世界，我习惯于让 Apache 提供我的图像、css、javascript 等，而 Tomcat 或其同类应用服务器处理所有 Java EE 提升。

但是现在我正在使用 Weblogic 8.1 做一个项目，我似乎无法弄清楚如何让它工作。例如，文档根的概念。我该如何配置？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T22:14:12.893

你可能想看看[这里](http://e-docs.bea.com/wls/docs81/adminguide/web_server.html#105827)和[这里](http://e-docs.bea.com/wls/docs81/webapp/index.html)：

这是BEA所说的简短版本：

> 网络应用程序
> 
> HTTP 和 Web 应用程序是根据 Sun Microsystems 的 Servlet 2.3 规范部署的，该规范将 Web 应用程序的使用描述为将基于 Web 的应用程序的组件组合在一起的标准化方式。这些组件包括 JSP 页面、HTTP servlet 和静态资源，例如 HTML 页面或图像文件。

基本上，我必须做的就是将我的一组静态页面配置为一个应用程序，然后将其部署为这样。在您部署的任何目录或 .war 中，您都需要一个 WEB-INF 目录，并且可能需要一个 web.xml 文件，该文件指向您的静态文件。

我们正在运行 WL 10，但概念应该相同：

这是我们用来提供一些静态内容的 config.xml 的片段：

```
<app-deployment>
    <name>myStaticContentApp</name>
    <target>myAppServer</target>
    <module-type>war</module-type>
    <source-path>myStaticContentDir</source-path>
    <deployment-order>100</deployment-order>
    <security-dd-model>Advanced</security-dd-model>
    <staging-mode>nostage</staging-mode>
  </app-deployment> 
```

然后在目录“myStaticContentDir”中，我们有静态文件，然后是一个 WEB-INF 目录，其中包含 web.xml：

```
<!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd">
<web-app>
  <welcome-file-list>
    <welcome-file>myStaticFile.html</welcome-file>
  </welcome-file-list>
</web-app> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T22:40:29.817

我看到它完成的方式是将静态内容放在 DMZ 中的 Web 服务器上，并让它处理所有静态内容，例如静态 HTML 页面和图像。只允许将动态内容请求中继回 WebLogic。

# sql - 如何在 SQL Server 中将索引从一个表复制到另一个表

> ID：652148
> 
> 赞同：20
> 
> 时间：2009-03-16T21:03:25.917
> 
> 标签：sql, sql-server, database, indexing

我需要将索引从一个表复制到另一个表。有很多索引，我不想从头开始重新创建它们。无论如何似乎容易出错。

我已经复制了结构使用

```
SELECT * INTO [BackupTable] FROM [OriginalTable] 
```

但这不会复制索引、约束、触发器等

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-16T21:23:10.567

是否要复制索引定义？

然后您可以使用 Microsoft SQL 管理工具中的“脚本”选项对索引、触发器等进行反向工程

只需右键单击 SQL Management Studio 表列表中的表名，然后选择“将表编写为”，然后选择“创建到”

您不能复制索引数据，因为它与索引的物理存储有关

首先**检查您是否将“工具/选项/SQL Server 对象资源管理器/脚本/脚本索引”设置为“真”。**这在某些版本的 SQL 管理工具中设置为 false（感谢 Mark）

![在此处输入图像描述](https://i.stack.imgur.com/KEMcp.png)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-05-03T19:29:24.910

默认情况下，右键单击表“CREATE”不包括索引或触发器，仅包括表定义和约束。

您可以右键单击*数据库*并单击“任务”->“生成脚本”，这将允许您执行此操作

编辑：这是默认设置，但正如 TFD 所说，它可以更改，谢天谢地。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T21:22:09.023

我对 SQL Server 并不特别熟悉，但是根据在其他数据库中定义和使用数据库表的方式，我想说仅通过复制数据或使用 SELECT INTO 是无法做到这一点的。

索引需要定义为表结构的一部分，并且需要为表中可能存在的任何现有数据生成。

执行此操作的唯一方法是在创建表之后使用 ALTER TABLE 语句在 CREATE TABLE 语句期间。

处理数据本身的语句与处理表定义是分开的，所以我认为不会有任何解决方法或捷径。

我确信会有可用的工具来生成 ALTER TABLE 语句，以根据您已经拥有的表创建所有适当的索引，使其变得简单可靠。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T21:24:14.353

您可以使用 sysindexes （或 sys.indexes 取决于您的版本）中的信息构建脚本来重新创建所有索引，但使用 Select * into 方法也不会获取外键和主键或任何扩展属性. 如果您使用的是 2005+ 版本，您应该真正考虑使用 SSIS，或者如果您使用的是 2000，则应该考虑使用 DTS，两者都有向导来简化这种复制。

[SSIS 导入导出](http://msdn.microsoft.com/en-us/library/ms140052(SQL.90).aspx)

[DTS 导入导出](http://msdn.microsoft.com/en-us/library/aa176528(SQL.80).aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T21:24:38.487

右键单击 SSMS 中的索引并执行 script as > create 。

更改表名和索引名，你应该设置

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2017-04-07T21:21:31.103

你应该明白这里的想法

```
Sub CopyTemp(tblName As String, Optional WithIndex As Boolean = False)
    Dim db As DAO.Database
    Dim tDefOrig As DAO.TableDef
    Dim tDefNew As DAO.TableDef

    Dim idxOrig As DAO.Index
    Dim idxNew As DAO.Index
    Dim fld As DAO.Field

    Dim tempName As String

    tempName = "temp" & tblName

    Set db = CurrentDb
    db.Execute "Select * Into " & tempName & " From " & tblName

    If WithIndex = True Then
        Set tDefOrig = db.TableDefs(tblName)
        Set tDefNew = db.TableDefs(tempName)

        For Each idxOrig In tDefOrig.Indexes
            Set idxNew = tDefNew.CreateIndex(idxOrig.Name)
            With idxNew
                For Each fld In idxOrig.Fields
                    .Fields.Append .CreateField(fld.Name)
                Next
                .Primary = idxOrig.Primary
                .Unique = idxOrig.Unique
            End With
            tDefNew.Indexes.Append idxNew
            tDefNew.Indexes.Refresh
        Next
    End If

End Sub 
```

# database-design - 如何使用来自其他几个表的外键对表建模

> ID：652149
> 
> 赞同：5
> 
> 时间：2009-03-16T21:04:48.143
> 
> 标签：database-design, data-modeling

我正在尝试创建一个包含两个主要实体的联系人应用程序 - 个人和公司。一个人可以有许多电子邮件、号码和地址。一家公司也可以有许多电子邮件、号码和地址。我正在尝试确定适合这种情况的设计。

选项 #1 - 多个外键
电子邮件、号码和地址将有两列称为 person_id 和 company_id。根据数据所属的实体，一个将为空，另一个将包含一个链接回父级的 id。

选项 #2 - 每个实体每个类型一个表
我复制每个表，因此会有一个 company_addresses 表和一个 person_addresses 表。我会有两倍多的表，但这是目前最有意义的解决方案。

选项 #3 - 一个链接表
我创建一个表 - “链接”。该表将包含四列：source_id、source_entity、dest_id、dest_entity。因此，如果一家公司获得一个新号码，您将有如下一行：1，号码，2，公司。

选项 #4 - 多个链接表
我为每种类型的链接（company_address、person_address、company_email、person_email 等）创建一个表

你会选择哪个选项？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T21:27:33.910

你已经提到了一些我认为你应该避免的做法。[我在AppDevelopers 所犯的数据库开发错误](https://stackoverflow.com/questions/621884/database-development-mistakes-made-by-appdevelopers/621891#621891)（例如独占弧）中写了更多关于此的内容。

至于你的问题，我实际上不会选择这些选项。你绊倒的是一个[通用的派对模型](http://www.tdan.com/view-articles/5014/)。基本上，您有一个带有子类型（例如 Person 和 Organisation）的 Party 实体。Contacts 有一个 Party ID 作为外键。通用超类/超实体的使用比这要深刻得多，但是您会发现您也将它用于许多其他事情（例如整个角色概念）。

很多这些数据库设计建模问题都有成熟的解决方案，但这往往不是程序员曾经教过的那种东西。我强烈建议您阅读[The Data Model Resource Book, Vol。1：适用于所有企业的通用数据模型库](https://rads.stackoverflow.com/amzn/click/com/0471380237)，其中详细介绍了如何对人员和组织进行建模以及许多其他典型问题。

这里要记住的关键点是你所做的事情以前已经做过。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T21:11:00.110

选项＃2或者我会这样做：

您可以创建一个 EntityTable 来定义 Id 和 Entity 类型，然后您可以将您的地址、电子邮件表链接到该表。

然后，您创建引用回实体的人员和公司表。换句话说，您的子类实体。

选项 #1 - 我过去曾使用过它，随着事情变得复杂和发展，管理起来可能会让人头疼。

选项#3 - 你不能使用参照完整性，并且你从节省几个键击来执行选项#2 所获得的成本将不值得清理坏数据或处理额外的复杂性。

# memory-management - 如何解决访问冲突写入位置错误？

> ID：652153
> 
> 赞同：12
> 
> 时间：2009-03-16T21:07:09.077
> 
> 标签：memory-management, access-violation

我有一个简单的程序，但在`*(str + start)`. 为什么？我应该可以改变它。正确的？

```
void fn()
{
     char *str = "Hello wordl!";
     int end = strlen(str);
     int start = 0;
     end--;
     while(start < end)
     {
         *(str + start) = *(str + end);  <--- Access violation writing location *(str + Start).
         end--;
         start++;
     }
} 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-16T21:18:56.597

`char *str = "Hello World";`是一个常量字符串，不能修改。编译器可以随意将其放入不可写的位置，从而导致您看到的崩溃。

将声明替换为`char str[] = "Hello World";`应该做你想做的事，将字符串放入堆栈上的可修改数组中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T21:10:53.700

不，你不应该。"Hello world" 是一个常量字符串文字，您需要在 C 中使用 malloc() 分配内存，[如果](http://man.cx/malloc)您想要可以自由修改的内存，则需要在 C++中使用[new分配内存。](http://www.cplusplus.com/reference/std/new/operator%20new%5B%5D.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T01:59:19.433

正如其他人指出的那样，文字字符串可能存储在内存的只读区域中。您是否在打开警告的情况下进行编译？您应该收到有关丢弃字符串文字的 constness 的警告。

你可以做的是：

```
char *str = strdup("Hello, world!");
// Modify the string however you want
free(str); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T21:11:53.090

这是因为您正在写入字符串文字的存储空间，该存储空间可能位于内存的受保护区域中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-08-21T09:47:00.683

在您的示例中，您好 wordl！是常量字符串，任何修改此常量字符串的尝试都会导致异常。相反，您可以这样做 -

```
string s = "Hello wordl!";
char* ptr = &s[0]; 
```

然后玩ptr。

# c++ - 不完整类型的无效使用

> ID：652155
> 
> 赞同：57
> 
> 时间：2009-03-16T21:07:16.937
> 
> 标签：c++, templates, typedef, crtp

我正在尝试在我的项目中使用来自子类的 typedef，我在下面的示例中隔离了我的问题。

有谁知道我要去哪里错了？

```
template<typename Subclass>
class A {
    public:
        //Why doesn't it like this?
        void action(typename Subclass::mytype var) {
            (static_cast<Subclass*>(this))->do_action(var);
        }
};

class B : public A<B> {
    public:
        typedef int mytype;

        B() {}

        void do_action(mytype var) {
            // Do stuff
        }
};

int main(int argc, char** argv) {
    B myInstance;
    return 0;
} 
```

这是我得到的输出：

```
sean@SEAN-PC:~/Documents/LucadeStudios/experiments$ g++ -o test test.cpp
test.cpp: In instantiation of ‘A<B>’:
test.cpp:10:   instantiated from here
test.cpp:5: error: invalid use of incomplete type ‘class B’
test.cpp:10: error: forward declaration of ‘class B’ 
```

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-03-16T21:36:47.770

原因是当实例化一个类模板时，它的所有成员函数的声明（不是定义）也被实例化了。当需要专门化的完整定义时，会精确地实例化类模板。例如，当它用作基类时就是这种情况，就像您的情况一样。

所以发生的事情是`A<B>`在

```
class B : public A<B> 
```

此时`B`还不是一个完整的类型（它在类定义的右大括号之后）。但是，`A<B>::action`的声明需要`B`完整，因为它是在它的范围内爬行：

```
Subclass::mytype 
```

您需要做的是将实例化延迟到`B`完成的某个点。这样做的一种方法是修改 的声明，`action`使其成为成员模板。

```
template<typename T>
void action(T var) {
    (static_cast<Subclass*>(this))->do_action(var);
} 
```

它仍然是类型安全的，因为如果`var`不是正确的类型，传递`var`给`do_action`将失败。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-03-16T22:07:47.540

您可以通过使用特征类来解决此问题：
它要求您为使用的每个实际类设置一个特殊的特征类。

```
template<typename SubClass>
class SubClass_traits
{};

template<typename Subclass>
class A {
    public:
        void action(typename SubClass_traits<Subclass>::mytype var)
        {
                (static_cast<Subclass*>(this))->do_action(var);
        }
};

// Definitions for B
class B;   // Forward declare

template<> // Define traits for B. So other classes can use it.
class SubClass_traits<B>
{
    public:
        typedef int mytype;
};

// Define B
class B : public A<B>
{
    // Define mytype in terms of the traits type.
    typedef SubClass_traits<B>::mytype  mytype;
    public:

        B() {}

        void do_action(mytype var) {
                // Do stuff
        }
};

int main(int argc, char** argv)
{
    B myInstance;
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T21:29:29.053

你派生`B`自`A<B>`，所以编译器做的第一件事，一旦它看到类的定义，`B`就是尝试实例化`A<B>`。为此，它需要知道`B::mytype`的参数`action`。但是由于编译器只是在找出 的实际定义的过程中`B`，它还不知道这个类型，你会得到一个错误。

解决此问题的一种方法是将参数类型声明为另一个模板参数，而不是在派生类中：

```
template<typename Subclass, typename Param>
class A {
    public:
        void action(Param var) {
                (static_cast<Subclass*>(this))->do_action(var);
        }
};

class B : public A<B, int> { ... }; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T21:45:05.240

不完全是您所要求的，但您可以将操作设为模板成员函数：

```
template<typename Subclass>
class A {
    public:
        //Why doesn't it like this?
        template<class V> void action(V var) {
                (static_cast<Subclass*>(this))->do_action();
        }
};

class B : public A<B> {
    public:
        typedef int mytype;

        B() {}

        void do_action(mytype var) {
                // Do stuff
        }
};

int main(int argc, char** argv) {
    B myInstance;
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T21:17:15.370

您需要使用指针或引用，因为此时不知道正确的类型，编译器无法实例化它。

而是尝试：

```
void action(const typename Subclass::mytype &var) {
            (static_cast<Subclass*>(this))->do_action();
    } 
```

# php - 一个类可以扩展一个类并实现一个接口吗

> ID：652157
> 
> 赞同：110
> 
> 时间：2009-03-16T21:08:09.557
> 
> 标签：php, php-parse-error

一个类可以在 PHP 中同时扩展一个接口和另一个类吗？
基本上我想这样做：

```
interface databaseInterface{
 public function query($q);
 public function escape($s);
 //more methods
}

class database{ //extends both mysqli and implements databaseInterface
 //etc.
} 
```

如何做到这一点，只需做：

```
class database implements databaseInterface extends mysqli{ 
```

导致致命错误：

```
解析错误：语法错误，意外的 T_EXTENDS，在 *file* 行 *line* 中需要 '{'

```

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2009-03-16T21:11:26.477

换个方式试试：

```
class database extends mysqli implements databaseInterface { ...} 
```

这应该有效。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-16T21:14:56.200

是的，它可以。您只需要保留正确的顺序。

```
class database extends mysqli implements databaseInterface { ... } 
```

此外，一个类可以实现多个接口。只需用逗号分隔它们。

但是，我不得不警告您，**扩展 mysqli 类是非常糟糕的主意**。继承本身可能是面向对象编程中最被高估和滥用的概念。

相反，我建议以 mysqli 方式（或 PDO 方式）做与 db 相关的事情。

另外，一件小事，但命名约定确实很重要。那么你的类`database`似乎更一般`mysqli`，因此它表明后者继承自`database`而不是周围的方式。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2015-09-12T13:53:41.193

是的，事实上，如果你想实现多个接口，你可以这样做：

```
public class MyClass extends BaseClass implements myInterface1, myInterface2, myInterface3{ 

} 
```

# asp.net - 请求管道中是否存在请求和响应都可用和填充的事件？

> ID：652158
> 
> 赞同：0
> 
> 时间：2009-03-16T21:08:13.707
> 
> 标签：asp.net, httpmodule, pipeline

我需要绑定到请求和响应都填充的请求管道中的事件。Request 很简单，但我需要 Response 对象的 StatusCode。在管道中的哪个点填充响应？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T21:16:57.600

在“请求由 HttpApplication 管道处理”部分下查看[此页面。](http://msdn.microsoft.com/en-us/library/ms178473(VS.85).aspx)“ [EndRequest](http://msdn.microsoft.com/en-us/library/system.web.httpapplication.endrequest(VS.85).aspx) ”事件应该有你需要的。

# jquery - 使用 JQuery 使用 CDATA 解析 XML

> ID：652159
> 
> 赞同：6
> 
> 时间：2009-03-16T21:08:24.907
> 
> 标签：jquery, xml, parsing, fogbugz, fogbugz-on-demand

**编辑：**我在这里遗漏了两件事。AJAX 调用返回的标头中缺少“Content-Type:text/xml”会阻止 JQuery 将返回的数据视为文档。一旦正确处理，此代码将正确解析并仅输出索引和项目名称。

```
$("a.getprojects").click(function(d){
  d.preventDefault();
  var api_token = $("#token").val();
  var form_fbod = $("#fbod").val();
  $.post("fbinfo.php", {fbod: form_fbod, token: api_token, cmd : 'listProjects', extra:''}, function(returned_xml) {
    var output = '';
    $(returned_xml).find("project").each(function(){
      var project = $(this);
      output += project.find("ixProject").text();
      output += " ";
      output += project.find("sProject").text();
      output += "\n";
    });
    $("#output").val(output);
  });
}); 
```

**原文**：我很喜欢使用[FogBugz API](http://www.fogcreek.com/FogBugz/docs/60/topics/advanced/API.html)和 JQuery 来组合我认为很酷的小工具，但是我遇到了 JQuery 的限制。CDATA 标签似乎混淆了它。

这是我正在使用的代码：

```
 $("a.getprojects").click(function(d){
    d.preventDefault();
    var api_token = $("#token").val();
    var form_fbod = $("#fbod").val();
    $.post("fbinfo.php", {fbod: form_fbod, token: api_token, cmd : 'listProjects', extra:''}, function(xml) {
      var output = xml;
      $(xml).find("project").each(function(){
        var project = $(this);
        output += "\n\n";

        output += project.html();

      });
      $("#output").val(output);

    });
  }); 
```

这是我得到的输出：

```
<?xml version="1.0" encoding="UTF-8"?><response>
    <projects>
<project>
<ixProject>2</ixProject>
<sProject><![CDATA[Inbox]]></sProject>
<ixPersonOwner>2</ixPersonOwner>
<sPersonOwner><![CDATA[Rich]]></sPersonOwner>
<sEmail><![CDATA[rich@example.com]]></sEmail>
<sPhone></sPhone>
<fInbox>true</fInbox>
<ixGroup>1</ixGroup>
<iType>1</iType>
<sGroup><![CDATA[Internal]]></sGroup>
</project>

<project>
<ixProject>1</ixProject>
<sProject><![CDATA[Sample Project]]></sProject>
<ixPersonOwner>2</ixPersonOwner>
<sPersonOwner><![CDATA[Rich]]></sPersonOwner>
<sEmail><![CDATA[rich@example.com]]></sEmail>
<sPhone></sPhone>
<fInbox>false</fInbox>
<ixGroup>1</ixGroup>
<iType>1</iType>
<sGroup><![CDATA[Internal]]></sGroup>
</project>
</projects>
</response>

<ixproject>2</ixproject>
<sproject></sproject>
<ixpersonowner>2</ixpersonowner>
<spersonowner></spersonowner>
<semail></semail>
<sphone></sphone>
<finbox>true</finbox>
<ixgroup>1</ixgroup>
<itype>1</itype>
<sgroup></sgroup>

<ixproject>1</ixproject>
<sproject></sproject>
<ixpersonowner>2</ixpersonowner>
<spersonowner></spersonowner>
<semail></semail>
<sphone></sphone>
<finbox>false</finbox>
<ixgroup>1</ixgroup>
<itype>1</itype>
<sgroup></sgroup> 
```

JQuery 的原生 XML 解析似乎丢弃了 CDATA 元素的内容。FogBugz 将我们的大部分字符串数据放在 CDATA 标记中，因为我们允许在大多数地方使用特殊字符和标点符号。将输出包含在 CDATA 标记中可以让我们相对放心，我们正在通过我们的 API 发回有效数据。XML 的 PHP 解析工作得很好。我的在线研究产生了一些人抱怨这个，但没有做太多的工作。有了 JQuery 的可扩展性，我认为那里有一些东西。有没有其他人做到这一点？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T04:02:23.243

> 似乎 JQuery 原生的 XML 解析

jQuery 没有原生的 XML 解析。它只是使用标准的 XMLHttpRequest.responseXML 属性来获取响应的 XML DOM。

> 丢弃 CDATA 元素的内容

您发送响应的内容类型是什么？因为我怀疑它根本没有被解析为 XML。在这种情况下，jQuery 将向您传回文档的字符串，而不是 XML DOM。

然后，当您调用“$(xml)”时，它将从该字符串（*）创建文档内容——被解析为 HTML，*而不是*XML。在 HTML 中没有 CDATA 部分这样的东西，因此浏览器可能会丢弃它们，或者将它们视为注释。

我怀疑这是因为当文档是 XML 时，“project.html()”实际上不应该工作。'html()' 只返回与标准 'innerHTML' 属性(**) 相同的结果，它只适用于 HTML 文档；它在 XML 元素上未定义。

> 将输出包含在 CDATA 标记中可以让我们相对放心，我们正在通过我们的 API 发回有效数据。

好吧，“相对”：如果您的数据恰好包含“]]>”，您仍然会输。<![CDATA[ 部分旨在作为提高手工创作的可写性的拐杖；机器生成的 XML 应该只以正常方式使用实体编码。通常，服务器应用程序应该使用适当的 XML 工具来生成响应，在这种情况下，这将自动完成。

（*：我从来不明白 jQuery 什么时候觉得需要将文档片段创建和 CSS 选择压缩到同一个函数中。它们是完全不同的操作，你不想混淆，就像这里可能发生的那样。）

（**：实际上，它首先尝试使用正则表达式过滤掉 jQuery 自定义属性。不幸的是，由于正则表达式无法解析 HTML，它会很高兴地过滤掉恰好看起来像 HTML 属性的文本的有效部分。哎呀。没有之一jQuery 更漂亮的部分。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-07-30T19:50:22.513

jquery 现在确实有一个 xml 解析器，它应该可以解决您的问题。$.parseXML(xml) [http://api.jquery.com/jQuery.parseXML/](http://api.jquery.com/jQuery.parseXML/)

# java - 如何在 Java 中的 ISO-8859-1 和 UTF-8 之间进行转换？

> ID：652161
> 
> 赞同：77
> 
> 时间：2009-03-16T21:09:49.537
> 
> 标签：java, java-me, utf-8, character-encoding, iso-8859-1

有谁知道如何将字符串从 ISO-8859-1 转换为 UTF-8 并返回 Java？

我从网上获取一个字符串并将其保存在 RMS (J2ME) 中，但我想保留特殊字符并从 RMS 获取字符串，但使用 ISO-8859-1 编码。我该怎么做呢？

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-03-16T22:21:00.053

一般来说，你不能这样做。UTF-8 能够编码任何 Unicode 代码点。ISO-8859-1 只能处理其中的一小部分。因此，从 ISO-8859-1 转码到 UTF-8 是没有问题的。当发现不受支持的字符时，从 UTF-8 倒退到 ISO-8859-1 将导致“替换字符”(�) 出现在您的文本中。

要转码文本：

```
byte[] latin1 = ...
byte[] utf8 = new String(latin1, "ISO-8859-1").getBytes("UTF-8"); 
```

或者

```
byte[] utf8 = ...
byte[] latin1 = new String(utf8, "UTF-8").getBytes("ISO-8859-1"); 
```

您可以使用较低级别的[`Charset`](http://java.sun.com/javase/6/docs/api/java/nio/charset/package-summary.html)API 进行更多控制。例如，您可以在找到不可编码的字符时引发异常，或者使用不同的字符替换文本。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2016-08-12T08:45:00.630

***这对我*** *有用：（“üzüm bağları”是用土耳其语写的正确）*

将 ISO-8859-1 转换为 UTF-8：

```
String encodedWithISO88591 = "Ã¼zÃ¼m baÄlarÄ±";
String decodedToUTF8 = new String(encodedWithISO88591.getBytes("ISO-8859-1"), "UTF-8");
//Result, decodedToUTF8 --> "üzüm bağları" 
```

将 UTF-8 转换为 ISO-8859-1

```
String encodedWithUTF8 = "üzüm bağları";
String decodedToISO88591 = new String(encodedWithUTF8.getBytes("UTF-8"), "ISO-8859-1");
//Result, decodedToISO88591 --> "Ã¼zÃ¼m baÄlarÄ±" 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-16T21:30:47.177

如果你有一个`String`，你可以这样做：

```
String s = "test";
try {
    s.getBytes("UTF-8");
} catch(UnsupportedEncodingException uee) {
    uee.printStackTrace();
} 
```

如果你有一个 'broken' `String`，你做错了什么，将 a 转换为`String`另`String`一种编码的 a 显然不是要走的路！您可以将 a 转换`String`为 a `byte[]`，反之亦然（给定编码）。在 Java`String`中是 AFAIK 编码的，`UTF-16`但这是一个实现细节。

假设您有 a `InputStream`，您可以读入 a `byte[]`，然后将其转换为 a `String`using

```
byte[] bs = ...;
String s;
try {
    s = new String(bs, encoding);
} catch(UnsupportedEncodingException uee) {
    uee.printStackTrace();
} 
```

甚至更好（感谢埃里克森）`InputStreamReader`这样使用：

```
InputStreamReader isr;
try {
     isr = new InputStreamReader(inputStream, encoding);
} catch(UnsupportedEncodingException uee) {
    uee.printStackTrace();
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2016-06-13T17:24:57.450

这是字符串输出的一种简单方法（我创建了一个方法来执行此操作）：

```
public static String (String input){
    String output = "";
    try {
        /* From ISO-8859-1 to UTF-8 */
        output = new String(input.getBytes("ISO-8859-1"), "UTF-8");
        /* From UTF-8 to ISO-8859-1 */
        output = new String(input.getBytes("UTF-8"), "ISO-8859-1");
    } catch (UnsupportedEncodingException e) {
        e.printStackTrace();
    }
    return output;
}
// Example
input = "Música";
output = "MÃºsica"; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-11-21T17:43:10.703

正则表达式也可以很好并且可以有效地使用（替换所有未`ISO-8859-1`用空格覆盖的 UTF-8 字符）：

```
String input = "€Tes¶ti©ng [§] al€l o€f i¶t _ - À ÆÑ with some 9umbers as"
            + " w2921**#$%!@# well Ü, or ü, is a chaŒracte⚽";
String output = input.replaceAll("[^\\u0020-\\u007e\\u00a0-\\u00ff]", " ");
System.out.println("Input = " + input);
System.out.println("Output = " + output); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-06T13:03:21.690

Apache Commons IO [Charsets 类](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/Charsets.html)可以派上用场：

```
String utf8String = new String(org.apache.commons.io.Charsets.ISO_8859_1.encode(latinString).array()) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-10-30T14:52:32.957

这是一个将 UNICODE (ISO_8859_1) 转换为 UTF-8 的函数

```
public static String String_ISO_8859_1To_UTF_8(String strISO_8859_1) {
final StringBuilder stringBuilder = new StringBuilder();
for (int i = 0; i < strISO_8859_1.length(); i++) {
  final char ch = strISO_8859_1.charAt(i);
  if (ch <= 127) 
  {
      stringBuilder.append(ch);
  }
  else 
  {
      stringBuilder.append(String.format("%02x", (int)ch));
  }
}
String s = stringBuilder.toString();
int len = s.length();
byte[] data = new byte[len / 2];
for (int i = 0; i < len; i += 2) {
    data[i / 2] = (byte) ((Character.digit(s.charAt(i), 16) << 4)
                         + Character.digit(s.charAt(i+1), 16));
}
String strUTF_8 =new String(data, StandardCharsets.UTF_8);
return strUTF_8;
} 
```

**测试**

```
String strA_ISO_8859_1_i = new String("الغلاف".getBytes(StandardCharsets.UTF_8), StandardCharsets.ISO_8859_1);

System.out.println("ISO_8859_1 strA est = "+ strA_ISO_8859_1_i + "\n String_ISO_8859_1To_UTF_8 = " + String_ISO_8859_1To_UTF_8(strA_ISO_8859_1_i)); 
```

**结果**

> ISO_8859_1 strA est = Ø§ÙØºÙØ§Ù String_ISO_8859_1To_UTF_8 = الغلاف

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-11-09T23:09:46.143

将 ISO-8859-1 字符串转换为 UTF-8 字符串的最简单方法。

```
private static String convertIsoToUTF8(String example) throws UnsupportedEncodingException {
    return new String(example.getBytes("ISO-8859-1"), "utf-8");
} 
```

如果我们想将 UTF-8 字符串转换为 ISO-8859-1 字符串。

```
private static String convertUTF8ToISO(String example) throws UnsupportedEncodingException {
    return new String(example.getBytes("utf-8"), "ISO-8859-1");
} 
```

此外，一种无需使用 String 类的构造函数即可将 ISO-8859-1 字符串转换为 UTF-8 字符串的方法。

```
public static String convertISO_to_UTF8_personal(String strISO_8859_1) {
    String res = "";
    int i = 0;
    for (i = 0; i < strISO_8859_1.length() - 1; i++) {
        char ch = strISO_8859_1.charAt(i);
        char chNext = strISO_8859_1.charAt(i + 1);
        if (ch <= 127) {
            res += ch;
        } else if (ch == 194 && chNext >= 128 && chNext <= 191) {
            res += chNext;
        } else if(ch == 195 && chNext >= 128 && chNext <= 191){
            int resNum = chNext + 64;
            res += (char) resNum;
        } else if(ch == 194){
            res += (char) 173;
        } else if(ch == 195){
            res += (char) 224;
        }
    }
    char ch = strISO_8859_1.charAt(i);
    if (ch <= 127 ){
        res += ch;
    }
    return res;
} 
```

}

该方法基于将本网站的 utf-8 编码为 iso-8859-1。 [将 utf-8 编码为 iso-8859-1](http://string-functions.com/encodingtable.aspx?encoding=65001&decoding=28591)

# jquery - jQuery：将鼠标悬停在两个元素上

> ID：652177
> 
> 赞同：4
> 
> 时间：2009-03-16T21:16:00.007
> 
> 标签：jquery, hover

我有一个`<img>`，一旦将鼠标悬停在上面，就会在 `<div>`更大版本的图片以及文本和超链接中进行动画处理和淡入淡出。当鼠标移出时，`<div>`动画并消失。这很好用，只有我的悬停功能只与它`<img>`本身有关。只要 a)`<div>`出现在 上`<img>`，或 b) 鼠标离开`<img>`到达`<div>`，jQuery 就会读取 mouseout 并动画`<div>`离开。如何重新编写我的 jQuery 来解决这个问题？提前致谢 ...

这是 HTML 的一部分：

```
<img runat="server" src="~/images/pc_blocks_navigation_spec1.gif" class="navigation_spec1" alt="" />
<div class="navigation_spec1_panel">
    <p>filler <a href="#">test</a></p>
</div> 
```

...和jQuery ...

```
$('.navigation_spec1_panel').hide().css('opacity','0.0');
$('.navigation_spec1').hover(function() { 
    $('.navigation_spec1_panel').animate({ 
          width: '337px', 
          height: '234px',
          opacity: 1.0 }, 
        1250 ); 
    }, function() { 
    $('.navigation_spec1_panel').animate({ 
          width: '1px', 
          height: '1px',
          opacity: 0.0 }, 
        1250); 
    });
}); 
```

（旁注：我的动画`<div>`不会出现`<div>`在 IE 6 或 7 中在此之后编码的其他 s之上/之上。`<div>`无论z-index如何，它们都出现在它们后面。建议？）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T22:10:18.003

**选项 1：**将 img 和 div 放在另一个 div 中，并在该外部 div 上设置事件。

**选项 2：**在两个元素的 mouseout-event 上使用 setTimer，在两个元素的 mouseover-event 上使用 clearTimer，这为焦点移动创建了一个小的时间跨度，而不会触发淡出代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T21:24:50.063

你的意思是你的 div 放在你的图像上吗？

如果是这种情况，您可以将 mouseout 功能分配给 div 而不是图像：

```
$('.navigation_spec1_panel').hide().css('opacity','0.0');

$('.navigation_spec1').mouseover(function() { 
    $('.navigation_spec1_panel').animate({ 
          width: '337px', 
          height: '234px',
          opacity: 1.0 }, 
        1250 ); 
    };
});

$('.navigation_spec1_panel').mouseout(function() { 
    $(this).animate({ 
          width: '1px', 
          height: '1px',
          opacity: 0.0 }, 
        1250); 
    });
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T21:56:34.807

（注意：这对我自己来说是一个可以接受的答案，但是因为初始条件已经改变。我相信这个问题仍然可行）

我已将代码更改为不使用`<div>`带有`<a>`内部的 a，而是使用`<a>`带有尺寸和背景图像的 a。这样，我只有一个标签，使之前的错误没有意义。我还没有在 IE 中测试过这个，但是......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-13T20:27:40.947

这个 jQuery 方法有点复杂，但它可以很好地维持悬停在两个元素上。此示例假设您使用两个单独的 DIV 元素，其 id 为“div1”和“div2”。此示例还假设一个元素将是“触发器”（即 div1），一个元素将是“响应”（即 div2）。当用户的鼠标悬停在触发器上时，将显示响应。当用户的鼠标离开触发器和响应时，响应被隐藏。我使用 jQuery slideUp 和 slideDown 作为过渡效果，但任何 jQuery 过渡都可以替代。我还添加了一些填充和边框样式来帮助直观地展示这个概念。

**HTML：**

```
<style>
    #div1 { padding: 20px; border: 1px solid #000000; }
    #div2 { padding: 20px; border: 1px solid #ff0000; }
</style>

<div id='div1'>Some Content</div>
<div id='div2'>Some Other Content</div> 
```

javascript 代码使用 setTimeout 调用添加一个小的延迟，以允许鼠标从一个 DIV 转换到另一个 DIV。如果两个 DIV 彼此相对放置，则此超时可能非常小。更改“hover_timeout”的值将更改过渡时间裕度。

**注意：** “mouseenter”和“mouseleave”的使用对于这个例子很重要。有关使用 mouseenter 与 mouseover 的更多详细信息，请参阅此堆栈帖子：[Jquery mouseenter() vs mouseover()](https://stackoverflow.com/questions/7286532/jquery-mouseenter-vs-mouseover)

**JAVASCRIPT：**

```
var trigger_element = "#div1";
var response_element = "#div2";
var hover_timeout = 250; // milliseconds

function hideElement(waitTime)
{
    setTimeout(function() 
    {
        if (!$(trigger_element).is(":hover") && !$(response_element).is(":hover"))
        {
            $(response_element).slideUp();
        }
    },waitTime);
}

// trigger mouse enter
$(trigger_element).mouseenter (function() 
{
        $(response_element).slideDown();
});

// trigger mouse leave
$(trigger_element).mouseleave (function() 
{
    hideElement(hover_timeout);
});

// response mouse enter
$(response_element).mouseenter (function() 
{
    // do nothing
});

// response mouse leave
$(response_element).mouseleave (function() 
{
    hideElement(hover_timeout);
}); 
```

# python - 同时插入和扩展列表？

> ID：652184
> 
> 赞同：6
> 
> 时间：2009-03-16T21:17:23.870
> 
> 标签：python

有没有更好的方法同时插入和扩展列表？这是我目前如何做的一个丑陋的例子。（假设我想在“2”元素之后插入“2.4”和“2.6”）：

```
>>> a = ['1', '2', '3', '4']
>>> b = a[:a.index('2')+1] + ['2.4', '2.6'] + a[a.index('2'):]
>>> b
<<< ['1', '2', '2.4', '2.6', '3', '4'] 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-16T21:23:15.837

```
>>> a = ['1', '2', '3', '4']
>>> a
['1', '2', '3', '4']
>>> i = a.index('2') + 1  # after the item '2'
>>> a[i:i] = ['2.4', '2.6']
>>> a
['1', '2', '2.4', '2.6', '3', '4']
>>> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T21:34:32.567

`list.insert(i, x)`您可以使用Python 将其定义为轻松插入单个元素`s[i:i] = [x]`。

```
a = ['1', '2', '3', '4']
for elem in reversed(['2.4', '2.6']):
    a.insert(a.index('2')+1, elem)) 
```

如果要插入列表，可以创建自己的函数，省略 []：

```
def iextend(lst, i, x):
    lst[i:i] = x

a = ['1', '2', '3', '4']
iextend(a, a.index('2')+1, ['2.4', '2.6']
# a  = ['1', '2', '2.4', '2.6', '3', '4'] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T21:29:32.627

我不完全清楚你在做什么；如果您想添加值并让列表保持有序，那么对整个事物进行排序会更干净（并且可能更快）：

```
a.extend(['2.4', '2.6'])
a.sort() 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T21:39:56.047

看看[bisect 模块](http://docs.python.org/library/bisect.html)。我认为它可以满足您的需求。

# objective-c - 为什么 Objective-C 文件使用 .m 扩展名？

> ID：652186
> 
> 赞同：224
> 
> 时间：2009-03-16T21:17:51.890
> 
> 标签：objective-c, file-extension

自从我开始学习 Objective-C 和 Cocoa 以来，我一直想知道他们为什么选择 .m 作为实现文件的扩展名——它应该意味着什么，还是只是一个随机的字母？

* * *

## 回答 #1

> 赞同：503
> 
> 时间：2009-03-16T21:46:30.697

今天大多数人将它们称为“方法文件”，但是

> **“当 Objective-C 首次引入时， .m**扩展名最初代表“消息”，指的是 Objective-C 的核心特性 [...]”

（摘自Mark Dalrymple 和 Scott Knaster所著的“[在 Mac 上学习 Objective-C ”一书，第 9 页）](https://rads.stackoverflow.com/amzn/click/com/1430218150)

**编辑：**为了满足我的要求，我向Objective-C 的发明者[Brad Cox发送了电子邮件，询问了这个问题，他用这句话回答了：](http://www.virtualschool.edu/cox/)

> “因为 .o 和 .c 被占用了。就这么简单。”

这是作为视觉证据的电子邮件：

![视觉证明](https://i.stack.imgur.com/O7pPJ.png)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-16T22:03:42.870

它代表“方法”。从[comp.lang.objective-C 常见问题解答](http://nextstep.sdf-eu.org/clocFAQ/#tools-files)：

> Objective-C 源代码的组织通常类似于 C 或 C++ 源代码的组织，声明和对象接口进入以 .h 扩展名命名的*头*文件，定义和对象实现进入以 .m 命名的文件（简称对于*方法*）扩展。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T21:25:39.920

.m 文件包含 (m) 方法。可能的原因？

# ajax - 处理 Web 服务故障的最佳实践

> ID：652187
> 
> 赞同：2
> 
> 时间：2009-03-16T21:17:54.527
> 
> 标签：ajax, web-services

在 Ajax Web 应用程序中，当从浏览器到服务器的 Web 服务调用失败时，您会怎么做？

*   自动重试，希望是间歇性网络故障或服务器错误。（但是当您遇到真正的服务器问题时，由于重试的流量成倍增加，您可能会面临更多问题。）
*   失败，并向用户显示一条消息，例如“请稍后再试”。

我知道没有正确或错误的答案，只是想知道人们认为什么是最佳实践。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T21:30:40.470

正如您所说，没有正确或错误的答案，必须根据具体情况做出选择：

*   新消息的 webmail 轮询将静默失败，重试并警告用户如果服务器在一定数量的重试后可访问（就像邮件客户端会做的那样）
*   动态加载其内容的页面将立即让用户知道内容不可用，以及为什么不让他触发重试（就像任何浏览器一样）
*   ETC

没有正确的答案，但我认为能够拦截 Web 服务故障然后自动化用户（我们）的这个坏习惯将是一种耻辱：重试，重试，重试......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T21:26:06.923

静默重试一次或两次，然后失败并向用户发出警告。

为了避免重复，每个单独的请求都包含一个唯一的 ID，并在服务器上丢弃具有相同 ID 的请求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T01:45:13.133

这取决于您的用例。你可以从失败中恢复过来吗？失败的预期频率是多少？“重试”操作的努力程度可能超过收益。使用您对应用程序的了解来确定实现复杂的错误处理是否值得……通常情况下并非如此。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T21:30:28.973

最近我一直在家里使用 Google Docs。有时，我的连接会中断一段时间，然后最终恢复。我想知道应用程序何时无法保存（以不同的时间间隔进行），但我并不总是担心何时保存，并且我不希望模型中断（只是某处的消息）。如果真的很糟糕（无法保存很长时间），我将整个缓冲区复制到记事本并保存为备份。

这是一个很好的例子，因为我的“交易”本质上是本地的，直到我需要保存它。上下文在我的电脑上有一段时间，然后是服务器，然后是我的电脑。如果应用程序每次无法运行时都挂起，那么我将无法将它用于任何重要的事情。

如果应用程序只是一个访问服务器的屏幕，那么它的本地部分是微不足道的。它应该让用户了解“交易”的当前状态（成功或失败）。

所以这真的取决于有多少上下文是本地的，有多少是远程的......

保罗。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-25T14:03:09.453

我也会谨慎使用自动重试。如果他们愿意，我会让消费者重试。我推荐的一件事是使用 HTTP 错误代码来表示发生了哪种错误（例如 415 - 不支持媒体类型等）。这样消费者就知道如何响应错误消息。

# c++ - 使用Boost序列化和发送数据结构？

> ID：652193
> 
> 赞同：23
> 
> 时间：2009-03-16T21:19:53.397
> 
> 标签：c++, serialization, boost, boost-asio

我有一个看起来像这样的数据结构：

```
类型定义结构
{
  无符号短 m_short1;
  无符号短 m_short2;
  无符号字符 m_character;
} 我的数据类型；

```

我想使用 boost::serialization 序列化这个数据结构，然后使用 boost::asio 通过 TCP/IP 传输它，然后让另一个应用程序接收数据并使用相同的 boost 库对其进行反序列化。

[我正在尝试遵循 boost::serialization 教程](http://www.boost.org/doc/libs/1_38_0/libs/serialization/doc/tutorial.html)，（[正如其他一些 SO 问题所建议](http://stackoverflow.com/questions/523872/how-do-you-serialize-an-object-in-c)的那样），但该示例专门用于写入/读取文件，而不是使用 boost::asio 的套接字。

我很确定我有合适的工具来完成这项工作——我只需要帮助让它们一起工作。写入套接字与写入文件没有什么不同，对吧？

任何建议都非常感谢。谢谢！

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-16T21:54:20.070

asio 文档中有一个很好的序列化[示例：](http://www.boost.org/doc/libs/1_38_0/doc/html/boost_asio/examples.html) [server.cpp](http://www.boost.org/doc/libs/1_38_0/doc/html/boost_asio/example/serialization/server.cpp)、[stock.hpp](http://www.boost.org/doc/libs/1_38_0/doc/html/boost_asio/example/serialization/stock.hpp)、[connection.hpp](https://www.boost.org/doc/libs/1_38_0/doc/html/boost_asio/example/serialization/connection.hpp)。

这是一个片段：

```
std::ostringstream archive_stream;
boost::archive::text_oarchive archive(archive_stream);
archive << your_struct;
outbound_data_ = archive_stream.str();
boost::asio::async_write(socket_, 
    boost::asio::buffer(outbound_data_), handler); 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2011-07-26T20:25:50.690

我想我会与任何尝试`struct`使用 Boost 序列化 C++ 的人分享这个。对于上面给出的示例，要使`struct`序列化，您将添加一个`serialize`函数：

```
typedef struct
{
  unsigned short m_short1;
  unsigned short m_short2;
  unsigned char m_character;

  template <typename Archive>
  void serialize(Archive& ar, const unsigned int version)
  {
    ar & m_short1;
    ar & m_short2;
    ar & m_character;
  }
} MyDataType; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-18T11:44:43.350

对于这种简单的结构，boost::serialization 是矫枉过正和巨大的开销。

做更简单的：

```
vector<uint16_t> net(3,0);

net[0]=htons(data.m_short1);
net[1]=htons(data.m_short2);
net[2]=htons(data.character);

asio::async_write(socket,buffer((char*)&net.front(),6),callback);

vector<uint16_t> net(3,0);
asio::async_read(socket,buffer((char*)&net.front(),6),callback);

callback:
data.m_short1=ntohs(net[0]);
data.m_short2=ntohs(net[1]);
data.character=ntohs(net[2]); 
```

并且为自己节省了 boost::serialization 的巨大开销

而且，如果您使用具有相同字节顺序的计算机工作（大/小）的私有协议，它只是按原样发送结构--POD。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-11-21T23:05:08.460

编辑：我在下面收回我的答案，我提出的确实比 stringstream 解决方案具有时间和空间优势，但 asio::stream API 缺少一些长期需要的重要功能（例如定时中断）。

* * *

我原来的答案：

使用来自 boost::asio 的流，与将其写入 std::stringstreams 然后一次性发送相比，它具有时间和空间优势。方法如下：

客户端代码：

```
boost::asio::ip::tcp::iostream stream("localhost", "3000");

if (!stream)
  throw std::runtime_error("can't connect"); 
```

服务器代码：

```
boost::asio::io_service ios;
boost::asio::ip::tcp::endpoint endpoint
  = boost::asio::ip::tcp::endpoint(ip::tcp::v4(), 3000);
boost::asio::ip::tcp::acceptor acceptor(ios, endpoint);
boost::asio::ip::tcp::iostream stream;

// Your program stops here until client connects.
acceptor.accept(*stream.rdbuf()); 
```

然后，在您连接到客户端或服务器流之后，只需执行以下操作：

```
MyDataType obj;

// Send the object.
boost::archive::text_oarchive archive(stream);
archive << obj;

// Or receive it.
boost::archive::text_iarchive archive(stream);
archive >> obj; 
```

正如 Tymek 在他的回答中所写，您当然需要将“序列化”功能添加到您的 MyDataType 中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T21:50:11.000

您对获取构造函数参数的 boost::archive 进行序列化 - 目标流，您将在其中保存数据。您可以使用 boost.iostreams 库来定义您自己的流，它将通过网络发送数据，而不是文件或仅使用 asio 套接字流（[http://www.boost.org/doc/libs/1_36_0/doc/html/boost_asio/参考/ip__tcp/iostream.html](http://www.boost.org/doc/libs/1_36_0/doc/html/boost_asio/reference/ip__tcp/iostream.html)）。这是一个好方法，我们在这方面做了类似的事情，但是我们的流（zip/encrypt/send）很少，并且所有操作都使用了 boost iostreams 库。

简单而虚拟的方式 - 将您的数据存储在临时文件中并发送此文件:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T22:08:37.290

boost 序列化档案可以用任何流构建。因此，任何 oarchive 都可以使用任何 ostream，任何 iarchive 都可以使用任何 istream。因此，您可以归档到 ostringstream，使用 asio 传输字符串，并从中重建数据。

例如，请参见 binary_oarchive [here](http://www.boost.org/doc/libs/1_38_0/boost/archive/binary_oarchive.hpp)的参考。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-16T21:56:21.937

我怀疑您首先要存档到内存，然后将其写入套接字。

# database - Web 服务和数据库如何相互关联？

> ID：652194
> 
> 赞同：4
> 
> 时间：2009-03-16T21:20:36.377
> 
> 标签：database, web-services, database-design, architecture

Web 服务是捆绑在一起并封装为小的独立实体的一小部分功能或数据的想法非常清楚，并且很有意义。但是服务如何与它们使用或提供接口的数据库相关联？

例如，当从具有处理所有事情的海量数据库的单片 2 层架构迁移到基于服务的架构时，数据库会受到怎样的影响？数据库是分块成更小的数据库，每个数据库都通过一个服务进行交互，还是每个服务都只是与原始的海量数据库交互？

此外，如果数据库被拆分为，例如，用于用户身份验证的服务和用于产品信息的服务，那么在原始海量数据库中跟踪每个用户的产品浏览量的多对多实体将在哪里结束？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-16T21:30:13.293

简单地说，“没关系”。

做适合你的。

在服务 API 级别，数据库“不存在”，它只是一个实现细节。

如果 API 正确完成，数据库的实现不应该“渗透”到客户端的 API 层。

一旦你在 API 级别完成了这些，你可以选择让数据库保持“原样”（如果它是功能性的、执行性的、可维护的等），或者你可以一次或逐步地开始将它全部分解。

显然，拆分数据库将有其自身的挑战和问题。

因此，我将从服务及其 API 开始，并确保您和您的客户对这些感到满意。仅此过程可能会为您做出决定。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T00:46:30.717

[我认为 Martin Fowler 在他的Database Thaw](http://martinfowler.com/bliki/DatabaseThaw.html)文章中对这个主题有一个有趣的看法（我想说的是必读！）：

> 如果您将集成协议从 SQL 切换到 HTTP，这意味着您现在可以将数据库从 IntegrationDatabases 更改为 ApplicationDatabases。这种变化是深刻的。... 如果您通过 HTTP 进行集成，那么应用程序如何存储自己的数据就不再重要了，这反过来意味着应用程序可以选择对自己的需求有意义的数据模型。

所以“从 DB 到 WS”的切换会让你更关心你的*数据*。无需首先调整所有内容以适应关系模型，但您可以使用其他模型以及键/值存储、图形数据库或面向文档的方法。- 任何最适合手头领域的东西。在许多情况下，它当然可以是不同模型的组合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T21:36:52.577

我的看法是 Will Hartung 的答案几乎是完美的，但我会包括 ETL（提取、转换和加载）的特殊情况。

这种集成模式有时在 WS 的上下文中使用，并且涉及 WS 调用（有时由企业服务总线 (ESB) 路由或编排），以直接从数据库中提取数据。

# c# - 在深度不可变类型上进行延迟初始化是否需要锁？

> ID：652195
> 
> 赞同：11
> 
> 时间：2009-03-16T21:21:28.760
> 
> 标签：c#, lazy-loading, immutability, lock-free

如果我有一个非常不可变的类型（所有成员都是只读的，如果它们是引用类型成员，那么它们也指的是非常不可变的对象）。

我想在类型上实现一个惰性初始化属性，如下所示：

```
private ReadOnlyCollection<SomeImmutableType> m_PropName = null;
public ReadOnlyCollection<SomeImmutableType> PropName
{
    get
    {
        if(null == m_PropName)
        {
            ReadOnlyCollection<SomeImmutableType> temp = /* do lazy init */;
            m_PropName = temp;
        }
        return m_PropName;
    }
} 
```

据我所知：

```
m_PropName = temp; 
```

...是线程安全的。我不太担心两个线程都竞相同时初始化，因为这种情况很少见，从逻辑角度来看，两个结果都是相同的，如果我没有，我宁愿不使用锁到。

这行得通吗？优缺点都有什么？

**编辑：** 感谢您的回答。我可能会继续使用锁。然而，令我惊讶的是，没有人提出编译器意识到临时变量是不必要的，只是直接分配给 m_PropName 的可能性。如果是这种情况，那么读取线程可能会读取尚未完成构造的对象。编译器会阻止这种情况吗？

（答案似乎表明运行时不允许这种情况发生。）

**编辑：** 所以我决定采用[受 Joe Duffy 的这篇文章](https://web.archive.org/web/20080216100813/http://www.bluebytesoftware.com/blog/2007/11/17/ImmutableTypesCanCopyTheWorldSafely.aspx)启发的 Interlocked CompareExchange 方法。

基本上：

```
private ReadOnlyCollection<SomeImmutableType> m_PropName = null;
public ReadOnlyCollection<SomeImmutableType> PropName
{
    get
    {
        if(null == m_PropName)
        {
            ReadOnlyCollection<SomeImmutableType> temp = /* do lazy init */;
            System.Threading.Interlocked(ref m_PropName, temp, null);
        }
        return m_PropName;
    }
} 
```

这应该确保在此对象实例上调用此方法的所有线程都将获得对同一对象的引用，因此 == 运算符将起作用。可能会浪费工作，这很好 - 它只是使它成为一个乐观的算法。

正如下面的一些评论所指出的，这取决于 .NET 2.0 内存模型的工作。否则，应将 m_PropName 声明为 volatile。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T21:33:57.310

那可行。[如规范](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)5.5 节所述，在 C# 中写入引用保证是原子的。这可能仍然不是一个好方法，因为您的代码在调试和阅读时会更加混乱，以换取对性能的影响可能很小。

Jon Skeet 有一个关于在 C# 中实现单例的精彩[页面](http://www.yoda.arachsys.com/csharp/singleton.html)。

关于此类小型优化的一般建议是不要执行它们，除非分析器告诉您此代码是热点。此外，如果不检查规范，您应该警惕大多数程序员无法完全理解的代码。

编辑：正如评论中所指出的，即使您说您不介意创建对象的 2 个版本，但这种情况非常违反直觉，因此永远不应该使用这种方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T21:26:29.293

我很想听听对此的其他答案，但我认为这没有问题。重复的副本将被放弃并获得 GCed。

不过，您需要制作该字段`volatile`。

关于这一点：

> 然而，令我惊讶的是，没有人提出编译器意识到临时变量是不必要的，只是直接分配给 m_PropName 的可能性。如果是这种情况，那么读取线程可能会读取尚未完成构造的对象。编译器会阻止这种情况吗？

我考虑过提及它，但没有任何区别。在构造函数完成之前，new 运算符不会返回引用（因此不会发生对字段的赋值）——这是由运行时保证的，而不是编译器。

但是，语言/运行时并不能真正保证其他线程看不到部分构造的对象——[这取决于构造函数的作用](http://incrediblejourneysintotheknown.blogspot.com/2009/03/readonly-fields-and-thread-safety.html)。

**更新：**

OP 还想知道[这个页面是否有一个有用的想法](http://blog.markrendle.net/post/Lazy-initialization-thread-safety-and-my-favourite-operator.aspx)。他们最终的代码片段是[双重检查锁定](http://en.wikipedia.org/wiki/Double_checked_locking_pattern)的一个实例，这是一个经典的例子，成千上万的人互相推荐，却不知道如何正确地做到这一点。问题是 SMP 机器由多个具有自己内存缓存的 CPU 组成。如果他们必须在每次内存更新时同步缓存，这将抵消拥有多个 CPU 的好处。因此它们只在“内存屏障”处同步，这发生在取出锁、发生互锁操作或`volatile`访问变量时。

通常的事件顺序是：

*   Coder 发现双重检查锁定
*   Coder 发现内存障碍

在这两个事件之间，他们发布了很多损坏的软件。

此外，许多人相信（就像那个人那样）您可以通过使用互锁操作来“消除锁定”。但是在运行时它们是一个内存屏障，因此它们会导致所有 CPU 停止并同步它们的缓存。与锁相比，它们的优势在于它们不需要调用操作系统内核（它们只是“用户代码”），但[它们可以像任何同步技术一样降低性能](http://www.bluebytesoftware.com/blog/2009/01/09/SomePerformanceImplicationsOfCASOperations.aspx)。

摘要：线程代码看起来比实际编写要容易 1000 倍。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T21:36:09.067

你应该使用锁。否则，您将面临两个`m_PropName`现有实例和不同线程正在使用的风险。在许多情况下，这可能不是问题；但是，如果您希望能够使用`==`而不是`.equals()`那么这将是一个问题。罕见的竞争条件并不是更好的错误。它们很难调试和重现。

在您的代码中，如果两个不同的线程同时获取您的属性`PropName`（例如，在多核 CPU 上），那么它们可以接收将包含相同数据但不是相同对象实例的属性的不同新实例。

不可变对象的一个​​关键好处`==`是等同于`.equals()`，允许使用性能更高的对象`==`进行比较。如果您不在延迟初始化中进行同步，那么您可能会失去这个好处。

你也失去了不变性。您的对象将使用不同的对象（包含相同的值）初始化两次，因此已经获得您的属性值但再次获得它的线程可能会第二次收到不同的对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T03:41:05.667

当数据可能并不总是被访问并且可能需要大量资源来获取或存储数据时，我完全支持惰性初始化。

我认为这里忘记了一个关键概念：根据 C# 设计概念，**默认情况下不应使实例成员线程安全。** 默认情况下，只有静态成员应该是线程安全的。除非您正在访问一些静态/全局数据，否则不应在代码中添加额外的锁。

从您的代码显示的内容来看，惰性初始化都在实例属性中，因此我不会为其添加锁。如果按照设计，它应该被多个线程同时访问，那么继续添加锁。

顺便说一句，它可能不会减少多少代码，但我是 null-coalesce 运算符的粉丝。你的 getter 的主体可以变成这样： 它摆脱了额外的东西，在我看来使它更简洁和可读。

`m_PropName = m_PropName ?? new ...();
return m_PropName;`

`"if (m_PropName == null) ..."`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T21:29:32.563

我不是 C# 专家，但据我所知，如果您要求只创建一个 ReadOnlyCollection 实例，这只会造成问题。您说创建的对象将始终是相同的，两个（或更多）线程是否确实创建了一个新实例并不重要，所以我会说可以在没有锁的情况下执行此操作。

稍后可能会成为一个奇怪的错误的一件事是，如果要比较实例的相等性，这有时会不一样。但是，如果您牢记这一点（或者只是不这样做），我认为没有其他问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T22:02:56.447

不幸的是，你需要一把锁。当您没有正确锁定时，会有很多非常微妙的错误。对于一个令人生畏的例子，看看这个[答案](https://stackoverflow.com/questions/9666/is-accessing-a-variable-in-c-an-atomic-operation/73827#73827)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-10T17:16:52.650

如果仅在字段为空白或已包含*要写入的值*或在某些情况下*等效*的. 请注意，没有两个可变对象是等价的；包含对可变对象的引用的字段只能与*对同一对象*的引用一起写入（这意味着写入无效）。

根据情况，可以使用三种通用模式进行延迟初始化：

1.  如果计算要写入的值会很昂贵，并且希望避免不必要地花费这种努力，请使用锁。双重检查锁定模式在内存模型支持它的系统上很好。
2.  如果一个人正在存储一个不可变的值，如果它看起来有必要就计算它，然后存储它。其他看不到存储的线程可能会执行冗余计算，但它们会简单地尝试使用已经存在的值写入字段。
3.  如果要存储对生产成本低廉的可变类对象的引用，则在必要时创建一个新对象，然后在该字段仍为空白时使用“Interlocked.CompareExchange”来存储它。

请注意，如果可以避免锁定线程中除第一个访问之外的任何访问，则使惰性读取器线程安全不应带来任何显着的性能成本。虽然可变类通常不是线程安全的，但所有声称不可变的类对于读取器操作的任何组合都应该是 100% 线程安全的。任何不能满足这种线程安全要求的类都不应声称是不可变的。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-16T21:48:50.207

这绝对是个问题。

考虑这种情况：线程“A”访问属性，并且集合被初始化。在将本地实例分配给字段“m_PropName”之前，线程“B”访问该属性，除非它完成。线程“B”现在具有对该实例的引用，该实例当前存储在“m_PropName”中......直到线程“A”继续，此时“m_PropName”被该线程中的本地实例覆盖。

现在有几个问题。首先，线程“B”不再有正确的实例，因为拥有对象认为“m_PropName”是唯一的实例，但是当线程“B”在线程“A”之前完成时，它泄露了一个初始化的实例。另一个是如果集合在线程“A”和线程“B”获得它们的实例之间发生了变化。那么你有不正确的数据。如果您在内部观察或修改只读集合，情况可能会更糟（当然，您不能使用 ReadOnlyCollection，但如果您将其替换为可以通过事件观察或在内部修改的其他实现，则可以，但是不是外部的）。

# apache-flex - 如何获得 Flex Accordion 儿童的尺寸？

> ID：652197
> 
> 赞同：0
> 
> 时间：2009-03-16T21:23:03.077
> 
> 标签：apache-flex, accordion

我正在计算嵌入基于 Canvas 的组件中的图像的 maxHeight，该组件是基于 Canvas 的组件的一部分，该组件是 Accordion 的子组件。

我需要获取当前选定的子容器可用的实际像素数。奇怪的是，measuredHeight 和 getExplicitOrMeasuredHeight() 给出了我用作 Accordion 子容器的 Canvas 的设计时大小。不是基于`height="100%"`or的运行时大小`top="10" bottom="10"`。

我希望 Accordion 的子级将调整到 Accordion 的客户区域，这将允许我的代码在不引入滚动条的情况下计算出图像的大小。我已经浏览了 Accordion.as 源，但没有任何反应。我即将对 Accordion 进行子类化，只是为了创建`protected function get contentHeight():Number`一个公共函数。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-16T20:35:20.680

也许这会有所帮助：

```
accordion.height - (accordion.numChildren * Number(accordion.getStyle("headerHeight"))) 
```

和可选的 + 边框宽度。

# c# - 如何以编程方式删除受信任的根证书颁发机构中的证书？

> ID：652206
> 
> 赞同：4
> 
> 时间：2009-03-16T21:24:17.287
> 
> 标签：c#, internet-explorer, digital-certificate, certificate-authority

我需要能够从组织中的每台 PC 中删除特定证书。是的，我可以逐座进行，但我要到星期四才能完成，而且我没有人力来逐座进行。

是否有使用 C# 的编程方式来执行此操作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T21:32:07.690

我认为您不需要编写任何 C# - 看看[`certmgr.exe /del`](http://msdn.microsoft.com/en-us/library/e78byta0%28VS.80%29.aspx).

如果你今天真的*想写*一些 C# 来做到这一点，那么看看[`X509Store.Remove`](http://msdn.microsoft.com/en-us/library/system.security.cryptography.x509certificates.x509store.remove.aspx).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T22:30:23.197

MSDN中有一个例子（[点击这里](http://msdn.microsoft.com/en-us/library/system.security.cryptography.x509certificates.openflags(VS.80).aspx)）

我认为这个例子是不言自明的，但摘录如下：

```
using System;
using System.Security.Cryptography;
using System.Security.Cryptography.X509Certificates;
using System.IO;

public class X509store2
{
    public static void Main (string[] args)
    {
        //Create new X509 store called teststore from the local certificate store.
        X509Store store = new X509Store ("ROOT", StoreLocation.CurrentUser);
        store.Open (OpenFlags.ReadWrite);

        ...

        store.Remove (certificate1);
        store.RemoveRange (collection);

        ...

        //Close the store.
        store.Close ();
    }    
} 
```

# c# - 以下代码的等效 LINQ to XML 是什么？

> ID：652213
> 
> 赞同：1
> 
> 时间：2009-03-16T21:25:49.903
> 
> 标签：c#, linq-to-xml

以下代码的等效 Linq to XML 是什么：

```
public List<listing> GetList()
    {
        List<listing> listings = new List<listing>();

        if(File.Exists(this.XmlFilePath))
        {
            DataSet ds = new DataSet();
            ds.ReadXml(this.XmlFilePath);
            DataTable dt = ds.Tables["listing"];

            for(int row = 0; row < dt.Rows.Count; row++)
            {
                listing listing = new listing();

                listing.A = dt.Rows[row]["A"].ToString();
                listing.B = dt.Rows[row]["B"].ToString();
                listing.C = dt.Rows[row]["C"].ToString();
                listing.D= dt.Rows[row]["D"].ToString();
                listing.E = dt.Rows[row]["E"].ToString();

                listings.Add(listing);
            }
        }
        return listings;
    } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T21:46:05.253

```
 public List<Listing> GetList()
    {
        if (File.Exists(this.xmlFilePath))
        {
            XDocument doc = XDocument.Load(this.xmlFilePath);

            var listings = from row in doc.Root.Elements("listing")
                           select new Listing
                           {
                               A = (string)row.Element("A"),
                               B = (string)row.Element("B"),
                               C = (string)row.Element("C"),
                               D = (string)row.Element("D"),
                               E = (string)row.Element("E")
                           };

            return listings.ToList();
        }
        else
        {
            return new List<Listing>();
        }
    } 
```

# iphone - 如何通过 AudioServicesSetProperty 设置 kAudioServicesPropertyIsUISound？

> ID：652216
> 
> 赞同：2
> 
> 时间：2009-03-16T21:26:25.940
> 
> 标签：iphone

如何使用 AudioServicesSetProperty 将 kAudioServicesPropertyIsUISound 设置为 0？谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T03:05:32.923

假设您的 SystemSoundID 对象是“systemSoundID”

```
UInt32 flag = 0;
err = AudioServicesSetProperty(kAudioServicesPropertyIsUISound,
                               sizeof(UInt32),
                               &systemSoundID,
                               sizeof(UInt32),
                               &flag); 
```

# asp.net-mvc - 在 HtmlHelper 扩展方法中访问 HtmlHelper 方法 - ASP.NET MVC RC2

> ID：652219
> 
> 赞同：4
> 
> 时间：2009-03-16T21:28:34.407
> 
> 标签：asp.net-mvc, extension-methods, html-helper

我正在尝试在 ASP.NET MVC RC2 中构建 HtmlHelper 扩展。此代码在 Preview 5 中运行良好，但在 RC2 中不再运行，我试图了解原因。这是代码：

```
public static string EmptyDropDownList(this HtmlHelper htmlHelper, string name, object htmlAttributes)
{
    return htmlHelper.DropDownList(name, new SelectList(new string[0]), htmlAttributes);
} 
```

问题是我无法从扩展方法中访问 htmlHelper 上的所有方法。因此，找不到 htmlHelper.DropDownList。

有什么建议么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-16T21:35:43.093

您需要包含 System.Web.Mvc.Html 命名空间，因为大多数 HtmlHelper 方法实际上是在该命名空间中的类中定义的扩展。

[您可以在www.codeplex.com/aspnet](http://www.codeplex.com/aspnet)上找到 RC1（可能很快还会找到 RC2 源代码）。单击源代码选项卡并向下导航到 MVC 源代码树。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-13T23:24:49.063

两种选择：

一种。使用“使用”添加到页面，因此使用 razor 视图页面（mvc 3 和 mvc 4），例如

```
 @using UrWeb.Helpers 
```

或者

湾。添加到内部 web.config 命名空间部分，例如

```
 <add namespace="UrWeb.Helpers"/> 
```

# documentation - 编写技术规范的过程

> ID：652234
> 
> 赞同：15
> 
> 时间：2009-03-16T21:30:58.613
> 
> 标签：documentation

我有点担心这可能是重复的，但是我已经搜索了该站点，并且我能找到的每个问题似乎都更侧重于*功能规范*而不是技术规范。

我正在寻找有关如何传达应该*如何*做某事而不是应该做什么*的信息。*我认为在最简单的层面上，我正在寻找帮助向初级编码人员解释实现功能规范的正确方法的最佳方法。

大多数关于文档的答案似乎都假设，一旦给出详细的需求列表，开发人员就会知道实现它的最佳方法，我倾向于发现情况往往并非如此。到目前为止，我发现的最好的资源似乎是 Steve McConnell 的 10*Software Development，但我想知道是否还有其他人有一些有用的答案。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-16T21:37:08.973

我建议从[无痛功能规范开始阅读 Joel 的系列文章 - 第 1 部分：为什么要打扰？](http://www.joelonsoftware.com/articles/fog0000000036.html) 他甚至有一个指向[Project Aardark 规范](http://www.joelonsoftware.com/articles/AardvarkSpec.html)（现为 Copilot）的链接，您可以下载并阅读该链接，作为一个良好规范的示例。

不过有一点：您在帖子中提到了技术和功能规范。有区别。

您似乎（也）谈到了编码标准的问题。

就我个人而言，我更喜欢基于 Wiki 的纯技术设计文档方法。开发人员不喜欢编写大型 Word 文档。Wiki 允许您编写内容、协作、插入类图或任何适当的东西。

我发现了一些关于此的更多信息，例如关于[技术与功能规范](http://discuss.fogcreek.com/askjoel/default.asp?cmd=show&ixPost=4202&ixReplies=8)的线程，其中 Joel 写道：

> 我的想法是，您只是不编写涵盖应用程序全部功能的“技术规范”……这就是功能规范的用途。一旦你有了一个完整的功能规范，剩下的唯一要记录的就是内部架构和特定算法的点，它们 (a) 完全不可见（在幕后）和 (b) 从功能规范中不够明显。
> 
> 因此，技术规范最终不存在。取而代之的是，您可能有也可能没有一些关于小主题的技术文章：

和

> 请记住，如果您谈论的任何内容会影响用户界面，甚至影响您正在构建的事物的行为，它都会出现在功能规范中......所以剩下的技术规范就是程序员唯一感兴趣的东西，而且，事实上，很多东西可能最好在评论中，所以你最多应该有一些关于算法等主题的短文——当你需要考虑一个问题时，你可以按需写这些文章为未来的程序员设计或记录“大图”，这样他们就不必弄清楚你的代码试图完成什么。

这比我描述得更有说服力。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T00:26:04.480

有趣的是，我认为这个问题会得到几十个有争议的答案，相反，我们得到的建议是编码标准将解决这个问题，或者让开发人员继续解决这个问题就是答案。从这个问题来看，我认为关键是我们谈论的是初级编码人员，当你刚开始时，从功能规范到完成的代码有一个巨大的飞跃，我们都知道有不止一种方法可以做到这一点。

我的方法是采用系统的特定部分，使用所有技术层——DB、UI、Web 服务等，并记录应该如何实现，也许使用类图，也许只是建议特定的库和方法。通过这种方式，您的技术规范不会太大，可以补充和扩展架构文档（如果您不想要太多的文档，这可以是一个要点列表）。

然后团队可以完全实现系统的一个垂直切片，它有很多优势，你可以提前构建和发布一个小切片，架构被证明，迭代 0 的东西（源代码控制，版本控制，构建）都得到了锻炼——这只是这样做的方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T21:52:07.097

两个想法：

我知道就提议的实现进行交流的最有用的方法是使用类图和序列图。

我认为即使是初级开发人员也应该负责创建初始描述。思考问题空间，然后接受对设计的批评，将更快地发展他们的能力。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-24T20:12:25.660

我认为这归结为某些设计基础：

*   您创建需求列表或功能规范
*   你看看所有可能的方法来解决这个问题
*   您决定哪种方式最适合或导致最佳结果

您所描述的表明他们没有对优缺点进行良好的（如果有的话）分析。最终归结为青少年自己能够如何收集正确的信息，然后做出正确的决定。这可能涉及询问更高级的程序员;-)

* * *

确定最佳选择的设计方法的一些示例：

*   [http://www.wikid.eu/index.php/Itemised_response](http://www.wikid.eu/index.php/Itemised_response)
*   [http://www.wikid.eu/index.php/Weighted_objectives_method](http://www.wikid.eu/index.php/Weighted_objectives_method)
*   [http://www.wikid.eu/index.php/Harris_profile](http://www.wikid.eu/index.php/Harris_profile)
*   [http://www.mycoted.com/Brainwriting](http://www.mycoted.com/Brainwriting)
*   [http://www.qicbok.com/tools/creativitytools_brainwriting635.cfm](http://www.qicbok.com/tools/creativitytools_brainwriting635.cfm)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T22:06:05.283

使用编码标准、代码审查以及可能的静态分析工具（如 FxCop）来增强功能规范，您将获得很多好处。代码可以基于合理的架构，但由于本地级别的不良风格而难以更改。

# php - 我在哪里可以找到 SlickEdit 的 PHP 标记文件？

> ID：652236
> 
> 赞同：0
> 
> 时间：2009-03-16T21:31:47.690
> 
> 标签：php, text-editor, slickedit

我正在尝试 SlickEdit，它说它可以为 PHP 使用“标签文件”。有谁知道我在哪里可以找到这个标签文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T22:20:39.570

它支持在 PHP 源代码上创建标记文件的能力。您仍然需要将其指向 PHP 源代码的方向。

要创建这些标记文件，请转到工具 | 标记文件... | 添加标签文件...

选择 PHP，然后添加包含源代码的目录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T22:12:20.183

标记文件基本上是代码项目中跨文件分布的名称索引。这可用于在文件之间跳转和自动完成。有关该概念的一些相关信息在 Wikipedia 上：[Ctags](http://en.wikipedia.org/wiki/Ctags)。

至于在 SlickEdit 中创建它，请查看帮助中的“构建和管理标签文件”部分。您应该能够使用工具 -> 标记文件对话框来添加要索引的文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T22:13:47.900

根据“ [SlickEdit 2008 - Languages Supported](http://www.slickedit.com/index.php?option=com_content&task=view&id=160&Itemid=57) ”，SlickEdit 已经支持 PHP，开箱即用。安装的时候不包含标签文件？看起来它应该已经存在了。

# wpf - Wpf 工具包。将 DataGrid 列标题绑定到 DynamicResource

> ID：652240
> 
> 赞同：7
> 
> 时间：2009-03-16T21:32:27.330
> 
> 标签：wpf, datagrid, wpftoolkit, dynamicresource

我正在尝试使用以下代码将 DataColumn Header 绑定到 DynamicResource。

```
<Window.Resources>
    <sys:String x:Key="HeaderText">Header Text</sys:String>
</Window.Resources>
<Grid>
    <tk:DataGrid>
        <tk:DataGrid.Columns>
            <tk:DataGridTextColumn Header="{DynamicResource HeaderText}" Width="100"/>
        </tk:DataGrid.Columns>
    </tk:DataGrid>
</Grid> 
```

但出于某种奇怪的原因，列标题仍然为空。然而，StaticResource 运行良好。您能否帮我弄清楚如何将该 Header 属性绑定到一些 DynamicResource。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-07-09T05:31:46.443

尝试这个：

```
<Window.Resources>
    <sys:String x:Key="HeaderText">Header Text</sys:String>
    <Style x:Key="HeaderTextStyle" TargetType="{x:Type Primitives:DataGridColumnHeader}">
       <Setter Property="Content" Value="{DynamicResource HeaderText}" />
    </Style>
</Window.Resources>
<Grid>
    <tk:DataGrid>
        <tk:DataGrid.Columns>
            <tk:DataGridTextColumn HeaderStyle="{StaticResource HeaderTextStyle}" Width="100"/>
        </tk:DataGrid.Columns>
    </tk:DataGrid>
</Grid> 
```

WPF Toolkit 的 DataGrid 具有不是可视控件的 DataGridColumns，因此它们有一些有趣的规则。其中一个有趣的规则是，只有 Binding 属性可以是 Binding - 其他一切都必须是静态的。为了避免这种情况，您可以创建一个包含动态内容的静态样式资源。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-11-09T20:43:04.667

这适用于我使用字典进行国际化

```
<DataGrid>
    <DataGrid.Columns>
        <DataGridTextColumn Binding="{x:Null}" Width="120">
            <DataGridTextColumn.Header>
                <TextBlock Text="{DynamicResource gridColumnHeader1}" />
            </DataGridTextColumn.Header>
        </DataGridTextColumn>
    </DataGrid.Columns>
</DataGrid> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-27T11:56:19.203

如果您只想更改标题并且不想打扰样式，请执行此操作。（信用转到上面的海报）

```
 <Window.Resources>
    <sys:String x:Key="HeaderText">Header Text</sys:String>
    <TextBlock x:Key="HeaderSR" Text="{DynamicResource HeaderText}"/>
</Window.Resources>
<Grid>
    <tk:DataGrid>
        <tk:DataGrid.Columns>
            <tk:DataGridTextColumn Header="{StaticResource HeaderSR}" Width="100"/>
        </tk:DataGrid.Columns>
    </tk:DataGrid>
</Grid> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-17T02:55:04.770

尝试这个...

```
<DataGrid>
   <DataGrid.Columns>
       <DataGridTextColumn    Binding="{Binding InputDate,Mode=OneWay,StringFormat='{}{0:dd MMM yy}'}" Width="70" >
          <DataGridTextColumn.Header>
              <TextBlock Text="{DynamicResource ResourceKey=inputDate}" />
           </DataGridTextColumn.Header>
        </DataGridTextColumn>
    </DataGrid.Columns>
</DataGrid> 
```

# asp.net - ASP.NET 上的 P/Invoke [DllImport]

> ID：652255
> 
> 赞同：0
> 
> 时间：2009-03-16T21:41:05.763
> 
> 标签：asp.net, pinvoke, dllimport

我在使用 DLLImport 时遇到了一些并发问题，我有一个 Dll 提供了一些我需要通过网络发送的报告，所以我有这个：

```
[DllImport("Rep.dll", EntryPoint = "PrintRep", CallingConvention = CallingConvention.StdCall, 
CharSet = CharSet.Ansi)]
private static extern string PrintRep(several params...); 
```

在 Dll 端有很多变量和实例，然后返回报告的路径。

我现在拥有的代码对 PrintRep 的调用有一个锁定，它可以工作，但显然会使挂起的请求等待，有没有办法在没有锁定的情况下工作？因为如果我取出锁，我会收到几个“尝试在受保护的内存上写入”错误，并且 Dll 最终会挂起。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T22:12:30.930

报告 DLL 线程安全吗？我猜不会，因为您说如果您卸下锁，则会出现错误。因此，您有两个选择，使 DLL 线程安全（需要源并更改旧 dll），或者将请求序列化到 DLL，您已经完成了。这是你唯一的两个选择。但是，您是否需要让您的用户立即等待报告？您能否维护一份等待报告的用户列表以及调用所需的参数，然后将网页返回给用户，让他们知道您将通过电子邮件将报告发送给他们。然后，您可以以串行方式处理报告，而不会导致您的用户等待结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T21:55:11.957

如果*所有*Web 请求都基于此调用等待，则应考虑在单独的线程上调用它，保持锁定，并仅使 PrintRep 调用请求者等待调用返回等待。

如果只有等待 PrintRep 调用完成的人是在等待的人，那么除了实现某种服务器端工作队列以及让用户以某种方式返回以检查队列之外，您无能为力，也许通过定时 AJAX 回调。

不管你做什么，避免在任何 ThreadPool 线程上调用它。ASP.Net 使用这些来处理页面请求。

# sql-server-2005 - 从 XQuery 和 SQL Server 2005 获取行集

> ID：652268
> 
> 赞同：0
> 
> 时间：2009-03-16T21:48:03.487
> 
> 标签：sql-server-2005, xquery

我可以从 SQL Server 2005 中的以下代码中获取第一条记录。如何获取所有记录？如果我删除 '[1]' 索引，我会得到一些单例错误......

```
declare @xml xml
set @xml = 
'<my:myFields xmlns:my="http://schemas.microsoft.com/office/infopath/2003/myXSD/2009-03-16T20:13:11">
<my:field>test1</my:field>
<my:field>test2</my:field>
<my:field>test3</my:field>
<my:field>test4</my:field>
</my:myFields>'
SELECT @xml.value('declare namespace     my="http://schemas.microsoft.com/office/infopath/2003/myXSD/2009-03-16T20:13:11";         
(/my:myFields/my:field)[1]', 'varchar(100)') as test 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T14:22:06.400

```
declare @xml xml
set @xml = 
'<my:myFields xmlns:my="http://schemas.microsoft.com/office/infopath/2003/myXSD/2009-03-16T20:13:11">
<my:field>test1</my:field>
<my:field>test2</my:field>
<my:field>test3</my:field>
<my:field>test4</my:field>
</my:myFields>'

SELECT Y.ID.value('.', 'varchar(100)') as test
FROM @xml.nodes('declare namespace my="http://schemas.microsoft.com/office/infopath/2003/myXSD/2009-03-16T20:13:11"; 
                (/my:myFields/my:field)') as Y(ID) 
```

# entity-framework - ADO.NET 实体中的常用列

> ID：652269
> 
> 赞同：0
> 
> 时间：2009-03-16T21:48:17.103
> 
> 标签：entity-framework, .net-3.5, inheritance

使用 EDMX 设计器时，有没有办法将各种表中的公共列提取到 ADO.NET 实体框架中的单个基类中？例如，我的数据库中的每个表都有一个“LastUpdatedBy”和“LastUpdatedDate”列，这是审计所必需的。我想在我生成的 ObjectContext 的“SavingChanges”事件中自动设置这些值，而不需要转换为单个实体类型。请参阅[如何：在保存更改时执行业务逻辑（实体框架）](http://msdn.microsoft.com/en-us/library/cc716714.aspx)的示例。您可以在示例中看到它们如何转换为实体以访问各种属性。我希望能够只使用一次基本类型（如果它属于那种类型）并设置属性。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T11:34:50.363

恐怕可能不会——据我了解，EDMX 设计器将为每个表/实体生成一个（尽管是部分的）类，并且您不能真正将任何常见的基表“注入”到混合中。

您可以调查的可能是将您的公共数据放入接口（ICommonData）中，然后让类实现该接口。

不过，不确定如何将该接口注入到 EDMX 设计者的流程中：-(

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-25T22:02:04.907

看看[这篇文章](http://weblogs.asp.net/stevesheldon/archive/2008/02/23/a-method-to-handle-audit-fields-using-linq-to-sql.aspx?CommentPosted=true#commentmessage)。[它适用于 LINQ to SQL，但可以按照本文](http://morshedanwar.wordpress.com/2009/03/26/implementing-audit-trail-using-adonet-entity-framework-part-1/)所述轻松适应 EF 。第一个处理您的场景，其中所有表都具有所需的审计列，第二个考虑对整个数据库使用单个审计表，并为每次更改保留新旧值。

我被困在两者之间，因为第二种方法无法识别新添加的记录，但第一种方法没有更改历史记录。不得不在一个应用程序中实现两种审计策略让我感到不舒服，而且我需要一个 CreatedOn 值，所以我必须至少使用第一种方法。

顺便说一句，如果你和我一样，发现 XML 序列化是一种笨拙的方式来存储对象状态的历史，你可以看看这个[EF 特定的解决方案](http://blogs.msdn.com/simonince/archive/2009/04/20/auditing-data-changes-in-the-entity-framework-part-2.aspx)，它使用 AuditValues 详细表来存储更改属性的旧值和新值，但是这个没有根本不审核插入。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-17T21:11:55.333

它确实审计插入 - 但请阅读第 1 部分以了解我为什么以一种从后到前的方式这样做（我明白你为什么说它没有......而且它没有插入“插入”审计记录，但审计线索仍然存在）；

[http://blogs.msdn.com/b/simonince/archive/2009/04/20/auditing-data-changes-in-the-entity-framework-part-1.aspx](http://blogs.msdn.com/b/simonince/archive/2009/04/20/auditing-data-changes-in-the-entity-framework-part-1.aspx)

Simon

# security - src 使用 HTTPS 的 SWF 是否安全？

> ID：652275
> 
> 赞同：1
> 
> 时间：2009-03-16T21:50:19.750
> 
> 标签：security, ssl, https, flash

这是一个场景：

我在[http://somesite.com/page.html](http://somesite.com/page.html)嵌入 form.swf 。SWF 从[https://example.com/form.swf](https://example.com/form.swf)加载并提交到[https://example.com/secureform.php](https://example.com/secureform.php)。

那么，传输到服务器是否安全？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T21:59:21.070

这取决于您所说的安全是什么意思。我想你是在问提交的数据是否安全，答案是如果你使用的是 HTTPS，是的。

SWF 上的 HTTPS 确保 Flash 对象不会在服务器和客户端之间被恶意修改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T22:10:08.177

是的，您将不得不详细说明“安全”的含义。HTTPS 仅提供传输安全性（在大多数情况下）。它不提供端点安全性。也就是说，没有办法保证连接的任何一端都是安全的，只能保证传输（大部分）是安全的。如果任一端点已被黑客入侵，则可能通过更改的 SSL 证书发生多种攻击。所以你不能相信客户数据。我现在假设您可以信任服务器数据（或者您遇到了真正的麻烦:-)）。

# python - 是否可以在 Python 中创建匿名对象？

> ID：652276
> 
> 赞同：69
> 
> 时间：2009-03-16T21:50:45.693
> 
> 标签：python, anonymous-types

我正在调试一些 Python，它以对象列表作为输入，每个对象都有一些属性。

我想硬编码一些测试值——比如说，一个包含四个对象的列表，它们的“foo”属性设置为某个数字。

还有比这更简洁的方法吗？

```
x1.foo = 1
x2.foo = 2
x3.foo = 3
x4.foo = 4
myfunc([x1, x2, x3, x4]) 
```

理想情况下，我只想说：

```
myfunc([<foo=1>, <foo=2>, <foo=3>, <foo=4>]) 
```

（显然，这是虚构的语法。但有没有类似的东西真的有效？）

注意：这永远不会被签入。这只是一些一次性的调试代码。所以不要担心可读性或可维护性。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2015-04-06T21:54:38.767

我发现了这个：[http](http://www.hydrogen18.com/blog/python-anonymous-objects.html) ://www.hydrogen18.com/blog/python-anonymous-objects.html ，在我有限的测试中，它似乎有效：

```
>>> obj = type('',(object,),{"foo": 1})()
>>> obj.foo
1 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-03-16T22:40:38.493

我喜欢 Tetha 的解决方案，但它过于复杂。

这里有一些更简单的：

```
>>> class MicroMock(object):
...     def __init__(self, **kwargs):
...         self.__dict__.update(kwargs)
...
>>> def print_foo(x):
...     print x.foo
...
>>> print_foo(MicroMock(foo=3))
3 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2017-03-15T17:29:27.333

如此简短，如此 Python！哦

```
>>> Object = lambda **kwargs: type("Object", (), kwargs) 
```

然后您可以`Object`用作通用对象构造函数：

```
>>> person = Object(name = "Bernhard", gender = "male", age = 42)
>>> person.name
'Bernhard'
>>> 
```

编辑：好吧，从技术上讲，这会创建一个类对象，而不是对象对象。但是您可以将其视为匿名对象，或者通过附加一对括号来修改第一行以立即创建一个实例：

```
>>> Object = lambda **kwargs: type("Object", (), kwargs)() 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-03-16T21:59:28.543

看看这个：

```
 class MiniMock(object):
    def __new__(cls, **attrs):
        result = object.__new__(cls)
        result.__dict__ = attrs
        return result

def print_foo(x):
    print x.foo

print_foo(MiniMock(foo=3)) 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2018-03-29T08:47:23.723

也许你可以使用[namedtuple](https://docs.python.org/2/library/collections.html#collections.namedtuple)来解决这个问题，如下所示：

```
from collections import namedtuple
Mock = namedtuple('Mock', ['foo'])

mock = Mock(foo=1)
mock.foo  // 1 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2016-01-28T11:06:48.567

另一个明显的黑客：

```
class foo1: x=3; y='y'
class foo2: y=5; x=6

print(foo1.x, foo2.y) 
```

但是对于您的确切用例，直接调用带有匿名对象的函数，我不知道任何单行比

```
myfunc(type('', (object,), {'foo': 3},), type('', (object,), {'foo': 4})) 
```

丑陋，做的工作，但不是真的。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2017-07-18T22:32:57.530

从 Python 3.3 开始，有[types.SimpleNamespace](https://docs.python.org/3/library/types.html#types.SimpleNamespace)完全符合您的要求：

```
myfunc([types.SimpleNamespace(foo=1), types.SimpleNamespace(foo=2), types.SimpleNamespace(foo=3), types.SimpleNamespace(foo=4)]) 
```

这有点罗嗦，但你可以用别名来清理它：

```
_ = types.SimpleNamespace
myfunc([_(foo=1), _(foo=2), _(foo=3), _(foo=4)]) 
```

现在这实际上非常接近您问题中的虚构语法。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2018-08-30T04:16:59.797

```
anonymous_object = type('',(),{'name':'woody', 'age':'25'})()
anonymous_object.name
> 'woody' 
```

有一种很酷的方法，但很难理解。它使用 type() 创建一个带有默认初始化参数的无名类，然后在没有任何参数的情况下初始化它并获取匿名对象。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2020-11-28T07:47:26.907

我将使用 lambda

```
obj = lambda: None
obj.s = 'abb'
obj.i = 122 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2013-07-17T12:40:53.333

非经典：

```
def mock(**attrs):
    r = lambda:0
    r.__dict__ = attrs
    return r 

def test(a, b, c, d):
    print a.foo, b.foo, c.foo, d.foo

test(*[mock(foo=i) for i in xrange(1,5)])
# or
test(mock(foo=1), mock(foo=2), mock(foo=3), mock(foo=4)) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-04-16T06:58:37.310

我是这样做的：

```
from mock import patch
import requests

class MockResponse:

    def __init__(self, text, status_code):
        self.text = text
        self.status_code = status_code

class TestSomething(unittest.TestCase):

    @patch('requests.get',return_value=MockResponse('the result',200))
    def test_some_request(self, *args, **kwargs):
        response = requests.get('some.url.com')
        assert response.text=='the result'
        assert response.status_code=='200' 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-01-15T20:43:36.100

如果您使用的是 Python 3.7 或更高版本，则可以使用[命名元组](https://docs.python.org/3.3/library/collections.html#collections.namedtuple)通过不可变性、文档字符串和方便的元组方法来增强创建的对象：

```
from collections import namedtuple

PyObj = lambda **kwargs: namedtuple('PyObj', kwargs.keys())._make(kwargs.values())

o = PyObj(foo = 1)
print(o)
# prints: PyObj(foo=1)
o.foo
# returns: 1
o.foo = 0
# exception:
# Traceback (most recent call last):
#   File "<stdin>", line 1, in <module>
# AttributeError: can't set attribute

print(PyObj(foo = 1, bar = 'baz'))
# prints: PyObj(foo=1, bar='baz') 
```

需要 Python 3.7+ 以确保键和值的顺序相同。

但是，如果属性列表是预定义的，可以`namedtuple`直接使用，正如[华超](https://stackoverflow.com/users/3282254/huachao)建议的那样，不需要定义`PyObj`函数，可以在v2.7中使用。

```
from collections import namedtuple
foo = namedtuple('Foo', 'foo')

myfunc = lambda l: [x.foo * 10 for x in l]
myfunc([foo(1), foo(2), foo(3), foo(4)])
# returns [10, 20, 30, 40] 
```

另外，它看起来更像您正在寻找的语法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-01-30T14:04:33.897

是的，我非常怀念 JavaScript 中直接的匿名对象，特别是在函数返回值中，你可以说

```
function george() { 
    return {fred:6, jim:9}; 
}
x = george();
y = x.fred; 
```

您可以使用字典来获得相同的效果，但是所有这些方括号和单引号看起来都很混乱。所以我现在执行以下操作：

```
def fred():
    class rv:
        x=0
    rv.y = 6
    return rv

def jim():
    class rv:
        x=0
    rv.y = 9
    return rv
a = fred()
b = jim()
print(a.y, b.y, id(a.y), id(b.y)) 
```

拥有一个全局类 RV 会感觉更好，并实例化它以获得相同的效果，但这样函数就没有外部依赖项。

# sqlite - 使用 sqlite 管理 Makefile 构建标志

> ID：652282
> 
> 赞同：1
> 
> 时间：2009-03-16T21:53:25.330
> 
> 标签：sqlite, build-process, makefile

我从一个源代码树构建超过两打目标，通常具有三个活动分支，包括生产和调试构建。迄今为止，我使用了一个定义目标的个人 Makefile，其中包括一个通用 Makefile，该 Makefile 定义了编译标志，然后包含来自特定源树的 Makefile。这行得通，但我不禁想到有更好的方法。

我想使用 sqlite3 数据库来存储和组织构建标志的完整列表。在编译时，将查询数据库以生成基于项目版本、平台和开发/生产的标志并开始构建。

该数据库将是一个单独的地方，我可以在其中记录和跟踪我所有开发构建的当前设置。一组基本的存储标志将被版本、目标平台上的更细粒度的标志覆盖，然后构建质量级别。

作为实现这样的事情的一部分，我还将创建一些 shell 脚本来操作数据库和获取/设置标志，并允许我实验室中的其他开发人员更容易地采用它。

这已经完成了吗？有没有这样的例子？

有没有不同/更好的方法来处理这个问题？

两件事： * 我无法修改原始项目的 Makefile。* 尝试使用类似 automake 的东西会很麻烦，因为在代码库的现有模块中启用调试级别所需的配置标志数量将达到数百个。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T22:37:37.267

我怀疑您可能想看看更复杂的构建系统。看看[ant](http://ant.apache.org/manual/index.html)、[jam](http://www.perforce.com/jam/jam.html)和其他构建系统工具。我认为执行您所描述的标准 GNU 方式是通过 ./configure ( [autoconf](http://www.gnu.org/software/autoconf/) ) 脚本，尽管我可以看到管理不同的配置会很困难。

尽管编写自己的 Makefile 配置系统是可能的，但我怀疑如果您希望您的代码得到更广泛的采用，那么使用更标准的构建系统是正确的答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T22:42:54.320

恕我直言，为此使用数据库是矫枉过正的。使用 makefile 包含是处理此问题的一种干净且简单的方法。您对这种方法有什么顾虑/问题/问题？也许有一种方法可以重组您的 makefile 以实现您的目标，而无需添加数据库，也无需切换到完全不同的构建系统。

# python - 可以使用神经网络来找到函数最小值（a）吗？

> ID：652283
> 
> 赞同：10
> 
> 时间：2009-03-16T21:53:30.633
> 
> 标签：python, artificial-intelligence, neural-network, minimization

我对神经网络有点兴趣，并考虑在 python 中使用一个用于比较时域中的各种最小化技术（最快）的轻型项目。

然后我意识到我什至不知道神经网络是否有利于最小化。你怎么看？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T22:15:08.943

在我看来，这是一个比神经网络更适合[遗传算法的问题。](http://en.wikipedia.org/wiki/Genetic_algorithm)神经网络往往需要解决有界问题，需要针对已知数据进行训练等——而遗传算法的工作原理是在不需要训练的情况下为问题找到越来越好的近似解决方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-11-28T18:04:47.317

反向传播通过最小化错误来工作。但是，您可以真正最小化您想要的任何东西。因此，您可以使用类似反向支持的更新规则来找到最小化输出的人工神经网络输入。

这是一个大问题，很抱歉简短的回答。我还应该补充一点，与更成熟的方法相比，我建议的方法听起来效率很低，并且只能找到局部最小值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T22:08:40.767

反向传播神经网络的训练过程通过最小化最佳结果的误差来工作。但是让一个训练有素的神经网络找到一个未知函数的最小值将非常困难。

如果您将问题限制在特定的函数类，它可以工作，而且速度也很快。神经网络擅长发现模式，如果有的话。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-06-06T08:08:24.867

虽然这对于这个问题的作者来说有点太晚了。也许有人想测试一些优化算法，当他读到这个......

如果您正在使用机器学习中的回归（NN、SVM、多元线性回归、K 最近邻）并且想要最小化（最大化）回归函数，实际上这是可能的，但此类算法的效率取决于平滑度，（您正在搜索的区域的步长...等）。

为了构建这样的“机器学习回归”，您可以使用[scikit-learn](http://scikit-learn.org/stable/)。您必须训练和验证您的 MLR[支持向量回归](http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVR.html)。（“适合”方法）

```
SVR.fit(Sm_Data_X,Sm_Data_y) 
```

然后，您必须定义一个函数，该函数返回对数组“x”的回归预测。

```
def fun(x):
    return SVR.predict(x) 
```

您可以使用[scipiy.optimize.minimize](http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html)进行优化。请参阅文档链接后面的示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T22:14:42.907

他们的目的非常糟糕。神经网络的一大问题是它们陷入局部最小值。您可能想研究支持向量机。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-02T12:17:53.453

[实际上，您可以使用 NN 来找到函数最小值，但它与Erik](http://#652351)提到的遗传算法结合使用效果最好。

基本上 NN 会找到与函数局部最小值或最大值相对应的解决方案，但这样做非常精确（评论[Tetha 的](http://#652362)答案，说明 NN 是分类器，如果说数据输入是否最小，则可以使用）

相比之下，遗传算法倾向于从可能的整个输入范围中找到更通用的解决方案，然后为您提供近似的结果。

解决方案是结合两个世界

1.  从遗传算法中得到近似结果
2.  使用该结果使用 NN 找到更精确的答案

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-09-13T15:02:25.507

您可以教 NN 逼近一个函数。如果一个函数是可微的，或者你的神经网络有多个隐藏层，你可以教它给出一个函数的导数。

例子：

```
You can train  a 1 input 1 output NN to give output=sin(input)

You can train it also give output=cos(input) which is derivative of sin()

You get a minima/maxima of sin when you equate cos to zero.

Scan for zero output while giving many values from input. 0=cos() -> minima of sin 
```

当你达到零输出时，你知道输入值是函数的最小值。

训练需要的时间更少，清零需要很长时间。

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2009-03-16T22:17:49.170

神经网络是分类器。它们将两类数据元素分开。他们（通常）通过预先分类的数据元素来学习这种分离。因此，我说：不，除非你做一个超越破损的大伸展。

# sql - 在 MySQL 上的多字段索引中选择字段

> ID：652285
> 
> 赞同：0
> 
> 时间：2009-03-16T21:54:12.707
> 
> 标签：sql, mysql

我有这个我想优化的 MySQL 查询：

```
SELECT min(`topic_id`) FROM `gallery_topics` where `topic_id` > 11 AND `topic_poster` = 5 AND `topic_status` = 0 
```

我想添加一个包含多个字段的索引来优化这个查询，所以我添加了一个名为 previous_by_author 的键，这三个键按以下顺序排列：

1.  topic_id
2.  主题海报
3.  主题状态

我对此查询进行了 EXPLAIN，期望 EXPLAIN 查询会告诉我该查询使用了我的新 previous_by_author 索引。但是，EXPLAIN 报告该查询使用 user_start_time 索引，该索引使用以下两个字段：1\. topic_poster 和 2\. topic_start_time。

我不明白，topic_start_time 是一个日期时间字段，甚至不在我的查询中！

这是 EXPLAIN 查询的完整结果：

```
id select_type 表类型 possible_keys      
1 SIMPLE gallery_topics ref PRIMARY,user_start_time,previous_by_author

（续行）

关键 key_len 参考行 额外
user_start_time 8 const 4 使用 where

```

我应该在多字段索引中使用哪些字段，以便我的查询可以利用最佳索引？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T22:02:20.097

在不知道*所有*可用索引是什么的情况下，很难说为什么选择了一个特别的索引。但是更容易看出为什么*没有*选择新索引：因为您有一个大于条件`topic_id`，并且索引存储首先按 排序的值`topic_id`，MySQL 将必须读取（至少从索引）*所有*带有`topic_id > 11`和的行检查 WHERE 子句的附加条件。最好将多列索引放在`topic_id` *最后*，这样 MySQL 会根据两个相等条件对索引中的值进行分组；然后，检查大于条件很容易。

另外，表中有多少行？如果您没有具有代表性的测试数据，那么查询规划器将决定做什么，所有的赌注都将落空。

摘要：要优化与您显示的查询完全相同的查询，请尝试使用索引

1.  `topic_status`
2.  `topic_poster`
3.  `topic_id`

# jquery - 使用 jQuery 时 Internet Explorer 7 中的褪色问题

> ID：652286
> 
> 赞同：2
> 
> 时间：2009-03-16T21:54:14.563
> 
> 标签：jquery, internet-explorer, opacity

我在我正在处理的网站上使用 jQuery，一切正常 - 除了 Internet Explorer 7（和以前的版本，但该网站不支持它们）。在 Safari 或 Firefox 中查看[http://dev.staffanestberg.com/fromsweden/](http://dev.staffanestberg.com/fromsweden/)，然后在 IE7 中查看，您就会明白我的意思。我目前正在使用内置效果 FadeTo 来淡化内容，但我也尝试过创建自定义效果以及同时使用 Show/Hide、Animate 和 FadeUp/FadeDown。我也在这个站点上使用 SWFaddress，这可能会导致与 IE7 结合使用时出现错误，但在其他浏览器中不会也出现这种情况吗？我错过了什么？

-斯塔凡

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-01-28T00:42:21.533

**淡入淡出jQuery的字体Cleartype问题**

[这](http://jquery-howto.blogspot.com/2009/02/font-cleartype-problems-with-fadein-and.html)是对确切问题的一个非常好的解释。它与IE中的*clear type字体有关。*这是我使用的修复程序。

**例子：**

```
// This causes this text glich
$("#message").fadeIn();

// This will fix it
document.getElementById("#message").style.removeAttribute("filter"); 
```

**修复是删除过滤器。**

```
$('#message').fadeIn(function(){
    this.style.removeAttribute("filter");
}); 
```

[**资源**](http://jquery-howto.blogspot.com/2009/02/font-cleartype-problems-with-fadein-and.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T06:49:20.797

我已经成功地让 show/hide、fadeTo、fadeUp 和 fadeDown 在 IE6 及更高版本中工作。我发现我在涉及显示元素的动画中遇到的很多问题都与加载时没有隐藏的相关元素有关。

尝试在 html 中或以编程方式将淡入的元素（表格或 div）设置为 style="display:none"。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-11T12:09:16.090

```
jQuery.fn.fixClearType = function(){
    return this.each(function(){
        if(typeof this.style.filter  && this.style.removeAttribute)
        this.style.removeAttribute("filter");
    })
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-22T14:48:13.110

我发现，最有效的方法是简单地应用背景......将其视为 GIF。所以没有jQuery。纯 CSS

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-28T00:39:22.253

也许这对你来说是一个很好的解决方案（对我来说是）。解决方案简单但有效（而且非常好）。当 IE 的父级背景没有颜色（完全透明）时，IE 会出现 alpha 透明度问题。

我们在这里所做的（参见下面的示例）是首先添加一个几乎透明的 div（对眼睛透明）。因为它是画布/容器中的第一个 div（例如=> 一个 div）并且它是绝对放置的，所以这个 div 之后的所有内容都将放在第一个 div 的顶部，所以这成为所有其他内容的背景在这个画布里面。

因为现在有背景，所以在淡入或淡出（更改不透明度时）或将画布的不透明度设置为低于 100 时，IE 不会显示令人讨厌的黑点（像素）或黑色区域。

**如何 - 以 100x100 图像为例：**

```
<div id="mycanvas" style="display:none;">
<div style="position:absolute; background:#FFF; display:block; filter:alpha(opacity=1); opacity:0; width:100px; height:100px;">
</div>
<img id="myImage" src="example.png" width="100" height="100"/>
</div> 
```

使用 jQuery 淡入或淡出图像：

```
 $("#mycanvas").fadeIn("slow", function() 
{setTimeout(function(){$("#mycanvas").fadeOut("slow");},2000 );}
); 
```

这也是可能的：

```
$("myImage").fadeIn("slow"); 
```

而已！

好消息是这个解决方案也适用于 VML/SVG (Raphael) 或其他具有 alpha 透明度的内容。此外，您不必更改/破解您的 JS 代码，因为这种“破解”不会影响其他浏览器。

希望能帮助到你。

# python - 在python中按日期对字典值列表进行排序

> ID：652291
> 
> 赞同：31
> 
> 时间：2009-03-16T21:56:51.670
> 
> 标签：python

我有一个列表，当我遍历我的数据时，我正在向它附加一个字典……我想按字典键之一进行排序。

前任：

```
data = "data from database"
list = []
for x in data:
     dict = {'title':title, 'date': x.created_on}
     list.append(dict) 
```

我想按“日期”的值以相反的顺序对列表进行排序

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-03-16T22:14:17.447

你可以这样做：

```
list.sort(key=lambda item:item['date'], reverse=True) 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-16T23:01:22.107

```
from operator import itemgetter

your_list.sort(key=itemgetter('date'), reverse=True) 
```

### 相关说明

*   不要使用`list`,`dict`作为变量名，它们是 Python 中的内置名称。它使您的代码难以阅读。

*   您可能需要根据上下文将字典替换为`tuple`或[`collections.namedtuple`](http://docs.python.org/library/collections.html#collections.namedtuple)或自定义类结构类

    ```
    from collections import namedtuple
    from operator    import itemgetter

    Row = namedtuple('Row', 'title date')
    rows = [Row(row.title, row.created_on) for row in data]
    rows.sort(key=itemgetter(1), reverse=True) 
    ```

例子：

```
>>> lst = [Row('a', 1), Row('b', 2)]
>>> lst.sort(key=itemgetter(1), reverse=True)
>>> lst
[Row(title='b', date=2), Row(title='a', date=1)] 
```

或者

```
>>> from operator import attrgetter
>>> lst = [Row('a', 1), Row('b', 2)]
>>> lst.sort(key=attrgetter('date'), reverse=True)
>>> lst
[Row(title='b', date=2), Row(title='a', date=1)] 
```

这是`namedtuple`内部的外观：

```
>>> Row = namedtuple('Row', 'title date', verbose=True)

class Row(tuple):
        'Row(title, date)'

        __slots__ = ()

        _fields = ('title', 'date')

        def __new__(cls, title, date):
            return tuple.__new__(cls, (title, date))

        @classmethod
        def _make(cls, iterable, new=tuple.__new__, len=len):
            'Make a new Row object from a sequence or iterable'
            result = new(cls, iterable)
            if len(result) != 2:
                raise TypeError('Expected 2 arguments, got %d' % len(result))
            return result

        def __repr__(self):
            return 'Row(title=%r, date=%r)' % self

        def _asdict(t):
            'Return a new dict which maps field names to their values'
            return {'title': t[0], 'date': t[1]}

        def _replace(self, **kwds):
            'Return a new Row object replacing specified fields with new values'

            result = self._make(map(kwds.pop, ('title', 'date'), self))
            if kwds:
                raise ValueError('Got unexpected field names: %r' % kwds.keys())

            return result

        def __getnewargs__(self):
            return tuple(self)

        title = property(itemgetter(0))
        date = property(itemgetter(1)) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T15:12:41.587

实际上，我昨天有这个几乎完全相同的问题，并[使用 search 解决了它](https://stackoverflow.com/questions/72899/in-python-how-do-i-sort-a-list-of-dictionaries-by-values-of-the-dictionary)。适用于您的问题的最佳答案是：

```
from operator import itemgetter
list.sort(key=itemgetter('date'), reverse=True) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T22:02:45.963

直接对数据（或数据的副本）进行排序，然后构建字典列表。使用使用适当键函数排序的函数进行排序（可能是 operator.attrgetter）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-16T23:06:37.180

如果你对整个简洁的事情感兴趣：

```
data = "data from database"
sorted_data = sorted(
    [{'title': x.title, 'date': x.created_on} for x in data], 
    key=operator.itemgetter('date'),
    reverse=True) 
```

# unit-testing - 什么是单元测试，你是怎么做的？

> ID：652292
> 
> 赞同：145
> 
> 时间：2009-03-16T21:57:29.157
> 
> 标签：unit-testing

### 许多帖子的完全重复：

[什么是单元测试？](https://stackoverflow.com/questions/1383/what-is-unit-testing)
[什么是好的单元测试？](https://stackoverflow.com/questions/61400/what-makes-a-good-unit-test)
[单元测试新手](https://stackoverflow.com/questions/580960/new-to-unit-testing)
[单元测试 - 定义](https://stackoverflow.com/questions/633053/unit-testing-definitions)
[学习单元测试](https://stackoverflow.com/questions/135651/learning-unit-testing)
[如何正确地模拟和单元测试](https://stackoverflow.com/questions/476540/how-to-properly-mock-and-unit-test)
[单元测试：初学者问题](https://stackoverflow.com/questions/473561/unit-testing-beginner-questions)
[等等……](https://stackoverflow.com/questions/tagged/unit-testing)
此外，Google for [site:stackoverflow.com “你好吗”单元测试](http://www.google.com/search?hl=en&c2coff=1&q=site%3Astackoverflow.com+%22how+do+you%22+unit-test&btnG=Search)

我已经阅读了一些关于单元测试的问题，但我不完全知道它是什么或你是如何做到的。我希望有人可以告诉我以下内容：

*   究竟什么是单​​元测试？它是内置在代码中还是作为单独的程序运行？或者是其他东西？
*   你怎么做呢？
*   什么时候应该做？是否有时间或项目不这样做？一切都是可单元测试的吗？

非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2009-03-16T22:25:08.967

## 什么是单元测试？

单元测试只是验证单个代码单元（主要是函数）是否按预期工作。通常您自己编写测试用例，但有些可以自动生成。

测试的输出可以像控制台输出一样简单，也可以像[NUnit](http://www.nunit.org/index.php?p=home)这样的 GUI或不同的语言特定框架中的“[绿灯”。](http://www.nunit.org/index.php?p=nunit-gui&r=2.4.8)

执行单元测试被设计得很简单，通常测试以函数的形式编写，它将确定返回的值是否等于您编写函数时所期望的值（或者您*最终*编写它时所*期望*的值 -当您首先编写测试时，这称为[测试驱动开发）。](http://en.wikipedia.org/wiki/Test_Driven_Development)

 *## 你如何进行单元测试？

想象一个您想要测试的非常简单的函数：

```
int CombineNumbers(int a, int b) {
    return a+b;
} 
```

单元测试代码如下所示：

```
void TestCombineNumbers() {
    Assert.IsEqual(CombineNumbers(5, 10), 15); // Assert is an object that is part of your test framework
    Assert.IsEqual(CombineNumbers(1000, -100), 900);
} 
```

当您运行测试时，您将被告知这些测试已通过。现在您已经构建并运行了测试，您知道这个特定的功能或单元将按照您的预期执行。

现在想象另一个开发人员出现并更改`CombineNumbers()`功能以提高性能或其他原因：

```
int CombineNumbers(int a, int b) {
    return a * b;
} 
```

当开发人员运行您为这个非常简单的函数创建的测试时，他们会看到第一个`Assert`失败，他们现在知道构建已损坏。

## 什么时候应该进行单元测试？

它们应该尽可能多地进行。当您在开发过程中执行测试时，您的代码会自动设计得比您只是编写函数然后继续前进的情况更好。此外，诸如[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)之类的概念将自然地演变到您的代码中。

最明显的好处是知道在进行更改时，如果它们都通过了测试，则不会影响其他单个代码单元。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2009-03-16T22:04:29.313

单元测试涉及将您的程序分解为多个部分，并对每个部分进行一系列测试。

通常测试作为单独的程序运行，但测试方法会有所不同，具体取决于语言和软件类型（GUI、命令行、库）。

大多数语言都有[单元测试框架](http://en.wikipedia.org/wiki/List_of_unit_testing_frameworks)，你应该为你自己研究一个。

测试通常会定期运行，通常是在每次更改源代码之后。越频繁越好，因为你越早发现问题。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-16T22:17:37.440

**什么...**

一种针对一系列测试自动测试代码的方法，旨在强制执行期望的结果并管理更改。

从这个意义上说，“单元”是代码中对测试有意义的最小原子组件，例如，通常是某个类的方法。此过程的一部分是构建存根对象（或“模拟”），它允许您将单元作为独立对象使用。

**如何...**

几乎总是，单元测试过程是内置在 IDE 中（或通过扩展），因此它在每次编译时都执行测试。存在许多用于帮助创建单元测试（实际上是模拟对象）的框架，通常命名为*foo* Unit（参见 jUnit、xUnit、nUnit）。这些框架提供了一种正式的方式来创建测试。

作为一个过程，测试驱动开发 (TDD) 通常是单元测试的动机（但单元测试不需要 TDD），它假设测试是规范定义的一部分，因此要求首先编写它们，并带有代码只是为了“解决”这些测试而写的。

**什么时候...**

*几乎*总是。非常小的一次性项目可能不值得，但前提是您非常确定它们确实是一次性的。理论上每个面向对象的程序都是可单元测试的，但是一些设计模式使这变得困难。众所周知，单例模式是有问题的，相反，依赖注入框架非常面向单元测试。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-16T22:09:00.127

什么是单元测试？很难定义。在技​​术层面上，您构建函数来调用代码库中的函数并验证结果。基本上，你会得到一堆像“assert(5+3) == 8”这样的东西，只是更复杂（如 DataLayer(MockDatabase()).getUser().name == "Dilbert"）。在工具视图级别上，您添加了一个自动化的、特定于项目的检查，如果一切仍然像您假设的那样正常工作。如果您重构并实现复杂的算法，这将非常非常有用。结果通常是一堆文档和更少的错误，因为代码的行为是固定的。

我为所有边缘案例构建测试用例，并以类似于分代垃圾收集器的工作方式运行它们。当我实现一个类时，我只运行涉及该类的测试用例。完成该课程的工作后，我会运行所有单元测试以查看一切是否仍然有效。

您应该尽可能多地进行测试，只要测试代码很容易保持未经测试。鉴于此，不，并非所有内容都可以以理智的方式进行测试。想想用户界面。想想航天飞机或核弹的驱动程序（至少不是纯 JUnit 测试；））。但是，很多代码是可测试的。数据结构是。算法是。大多数应用程序逻辑类都是。所以测试一下！

HTH。泰达

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-16T22:08:31.627

> 究竟什么是单​​元测试？它是内置在代码中还是作为单独的程序运行？或者是其他东西？

[来自 MSDN](http://msdn.microsoft.com/en-us/library/aa292197(VS.71).aspx)：单元测试的主要目标是获取应用程序中最小的可测试软件，将其与代码的其余部分隔离，并确定它的行为是否完全符合您的预期。

本质上，您正在编写少量代码来测试代码的各个部分。在 .net 世界中，您可以使用 NUnit 或 MBunit 之类的东西，甚至是 Visual Studio 中的内置测试工具来运行这些小段代码。在 Java 中，您可能会使用 JUnit。本质上，测试运行者将构建您的项目，加载并执行单元测试，然后让您知道它们是通过还是失败。

> 你怎么做呢？

好吧，单元测试说起来容易做起来难。要熟练掌握它需要相当多的练习。您需要以一种易于单元测试的方式构建代码，以使您的测试有效。

> 什么时候应该做？是否有时间或项目不这样做？一切都是可单元测试的吗？

你应该在有意义的地方做。并非所有东西都适合单元测试。例如，UI 代码很难进行单元测试，而且这样做通常不会带来什么好处。然而，业务层代码通常非常适合测试，这是大多数单元测试的重点。

单元测试是一个庞大的话题，为了充分了解它如何最大程度地使您受益，我建议您准备一本有关单元测试的书，例如“[示例测试驱动开发](https://rads.stackoverflow.com/amzn/click/com/0321146530)”，这将使您很好地掌握这些概念以及如何将它们应用到您的代码中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-16T22:13:30.477

我发现说明它的最简单方法是查看一些代码。NUnit 网站上的这个入门页面很好地介绍了内容和方法

[http://www.nunit.org/index.php?p=quickStart&r=2.5](http://www.nunit.org/index.php?p=quickStart&r=2.5)

一切都可以测试吗？一般来说，如果它计算了一些东西，那么是的。UI 代码是另一个需要处理的问题，因为模拟用户点击按钮是很棘手的。

你应该测试什么？我倾向于围绕我知道会很棘手的事情编写测试。复杂的状态转换，关键业务计算，诸如此类。一般来说，我不太担心测试基本的输入/输出东西，尽管纯粹主义者无疑会说我在这方面错了，*一切都*应该测试。像许多其他事情一样，没有正确的答案！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-16T22:15:33.030

在“如何做”部分：

我认为[ScalaTest](http://www.artima.com/scalatest/)的介绍很好地说明了不同风格的单元测试。

在“何时做”部分：

单元测试不仅仅是为了测试。通过进行单元测试，您还可以强制软件设计成为可单元测试的东西。许多人认为这种设计在很大程度上是 Good Design(TM)，而不管测试带来的其他好处。

因此，进行单元测试的一个原因是迫使您的设计变得更容易维护，如果您没有为单元测试而设计它。

# iphone - 在可可中的字符串上使用 MD5 哈希？

> ID：652300
> 
> 赞同：42
> 
> 时间：2009-03-16T21:59:40.477
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch

> **可能重复：**
> [Objective C 中的 MD5 算法](https://stackoverflow.com/questions/1524604/md5-algorithm-in-objective-c)

我需要在可可中使用 MD5 技术对字符串进行哈希处理。使用的任何框架都必须能够在 iphone 上访问。如果可能，请提供代码。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2010-06-23T18:19:01.670

在 Facebook Connect 源代码中注意到了这一点。看起来很扎实，试试看。

```
#import <CommonCrypto/CommonDigest.h>

...

+ (NSString*)md5HexDigest:(NSString*)input {
    const char* str = [input UTF8String];
    unsigned char result[CC_MD5_DIGEST_LENGTH];
    CC_MD5(str, strlen(str), result);

    NSMutableString *ret = [NSMutableString stringWithCapacity:CC_MD5_DIGEST_LENGTH*2];
    for(int i = 0; i<CC_MD5_DIGEST_LENGTH; i++) {
        [ret appendFormat:@"%02x",result[i]];
    }
    return ret;
}
... 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-03-16T22:07:41.270

嗯，首先，MD5 不是加密。因此，如果您正在寻找加密，那您就找错地方了。

但是，如果您只想在 iPhone 上使用 MD5 对某些内容进行哈希处理，这应该会为您提供所需的信息：

```
#import <CommonCrypto/CommonDigest.h>

NSString *md5(NSString *str) {
    const char *cStr = [str UTF8String];
    unsigned char result[CC_MD5_DIGEST_LENGTH];
    CC_MD5( cStr, strlen(cStr), result );
    return [NSString stringWithFormat:@"%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X",
        result[0], result[1],
        result[2], result[3],
        result[4], result[5],
        result[6], result[7],
        result[8], result[9],
        result[10], result[11],
        result[12], result[13],
        result[14], result[15]
    ];
}

//…

NSString *digest = md5(@"test");
NSLog(@"MD5 TEST %@", digest); 
```

（来自[在 iPhone 上计算 MD5](http://discussions.apple.com/thread.jspa?messageID=7362074)）

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2010-01-20T01:33:01.443

这就是我使用的。归功于[Alistair McMillan](http://amcmillan.livejournal.com/155200.html)。

```
#import <CommonCrypto/CommonDigest.h>

+ (NSString *) md5:(NSString *)str {
 const char *cStr = [str UTF8String];
 unsigned char result[16];
 CC_MD5( cStr, strlen(cStr), result );
 return [NSString stringWithFormat:
  @"%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X",
  result[0], result[1], result[2], result[3], 
  result[4], result[5], result[6], result[7],
  result[8], result[9], result[10], result[11],
  result[12], result[13], result[14], result[15]
  ]; 
} 
```

*注意＃1：我不必链接到任何库*

*注意 #2：我在 iphone 的外部框架列表中找不到 -lcrypto，并且没有 -lcrypto*

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-06-21T18:02:26.907

值得一提的是，OpenSSL 方法在最新版本的 OS X 上已被弃用，并且 MD5 摘要通常是小写的。就我个人而言，我更喜欢展开风格以提高效率，我认为为此使用 ObjC 类别更合适。

对于 MD5Digest.h：#include

```
@interface NSString (MD5Digest)
- (NSString*) md5Digest;
@end

@interface NSData (MD5Digest)
- (NSString*) md5Digest;
@end 
```

和 MD5Digest.m：

```
#include <CommonCrypto/CommonDigest.h>
#include "MD5Digest.h"

static NSString* md5Digest(const void *data, CC_LONG length)
{
    unsigned char digest[CC_MD5_DIGEST_LENGTH];
    unsigned char* d = CC_MD5(data, length, digest);

    return [NSString stringWithFormat:@"%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x",
        d[0], d[1], d[2], d[3], d[4], d[5], d[6], d[7], d[8], d[9], d[10], d[11], d[12], d[13], d[14], d[15],
        nil];
}

@implementation NSString (MD5Digest)

- (NSString*) md5Digest
{
    return md5Digest([self UTF8String], [self lengthOfBytesUsingEncoding:NSUTF8StringEncoding]);
}

@end

@implementation NSData (MD5Digest)

- (NSString*) md5Digest
{
    return md5Digest([self bytes], [self length]);
}

@end 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-08-18T09:30:56.957

我将以下内容添加到我的“NSString+MyGoonk”类别中：

```
#include <openssl/md5.h>

- (NSString *)md5
{
    NSData *data = [self dataUsingEncoding: NSUTF8StringEncoding];
    unsigned char *digest = MD5([data bytes], [data length], NULL);
    return [NSString stringWithUTF8String: (char *)digest];
} 
```

两件事情：

1.  这假设您的字符串是 UTF8。我确信有一种方法可以使它更通用，但我几乎从不使用其他任何东西。

2.  您必须将 -lcrypto 链接到您的项目中。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-05-10T01:04:58.343

在花了太多时间试图弄清楚这一点之后，我用正确的代码和如何使用它做了一个全面的帖子。你可以在我的博客上找到这篇文章。[http://www.saobart.com/md5-has-in-objective-c/](http://www.saobart.com/md5-has-in-objective-c/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-16T22:09:19.143

MD5 不是加密，它是一个[加密哈希函数](http://en.wikipedia.org/wiki/Cryptographic_hash_function)。它是一种单向函数，其输出为 128 位数字。*它是加密*的这一事实意味着它是一个计算困难的问题，给定一个 MD5 哈希输出，计算一个其 MD5 为该值的字符串。因此，MD5 可用于数据完整性检查，但不能用于加密。

# c# - 带有值转换器的动态数据模板

> ID：652304
> 
> 赞同：1
> 
> 时间：2009-03-16T22:03:20.483
> 
> 标签：c#, wpf, xaml, datatemplate, valueconverter

我想在 wpftoolkit 数据网格中显示数据，其中数据是

```
public class Thing
{
    public string Foo { get; set; }
    public string Bar { get; set; }
    public List<Candidate> Candidates { get; set; }
}

public class Candidate
{

    public string Name { get; set; }
    public CandidateType CandidateType { get; set; }
}

public enum CandidateType
{
    Type1,
    Type2,
    Type42
} 
```

其中候选人列表中的候选人数量可在运行时配置。

所需的网格布局如下所示

`Foo | Bar | Candidate 1 | Candidate 2 | ... | Candidate N`

因此，我似乎无法为 xaml 中的候选人创建 DataTemplate，因为绑定表达式会发生变化。

我在 AutoGeneratedColumns 事件中添加必要的列，如下所示：

```
private void DataGrid_AutoGeneratedColumns(object sender, EventArgs e)
{
    ViewModel vm = DataContext as ViewModel;

    for (int i = 0; i < vm.LotsOfThings.First().Candidates.Count; i++)
    {
        string assName = Assembly.GetExecutingAssembly().GetName().Name;
        ParserContext ctx = new ParserContext();
        ctx.XamlTypeMapper = new XamlTypeMapper(new string[] { assName });
        ctx.XamlTypeMapper.AddMappingProcessingInstruction("src", "WpfToolkitDataGridTester", assName);
        ctx.XmlnsDictionary.Add("", "http://schemas.microsoft.com/winfx/2006/xaml/presentation");
        ctx.XmlnsDictionary.Add("x", "http://schemas.microsoft.com/winfx/2006/xaml");
        ctx.XmlnsDictionary.Add("src", "clr-namespace:WpfToolkitDataGridTester;assembly=" + assName);
        var template = XamlReader.Parse(@"<DataTemplate>
                                            <DataTemplate.Resources>
                                                <src:FooConverter x:Key='fooConverter' />
                                            </DataTemplate.Resources>
                                            <TextBlock  
                                                Foreground='{Binding Candidates[" + i + @"].CandidateType,Converter={StaticResource fooConverter}}'
                                                Text='{Binding Candidates[" + i + @"].Name}' />
                                        </DataTemplate>", ctx) as DataTemplate;
        dg.Columns.Add(new DataGridTemplateColumn
        {
            Header = "Candidate " + (i + 1),
            CellTemplate = template
        });
    }
} 
```

但是，这会失败并出现以下异常：XML 命名空间“clr-namespace:WpfToolkitDataGridTester;assembly=WpfToolkitDataGridTester”中不存在标记“FooConverter”。行'3'位置'54'。

将 StaticResource 更改为 DynamicResource 不会发生任何变化。

我错过了什么？

FWIW：硬编码的数据模板

```
<DataTemplate x:Key="candidateTemplate">
  <DataTemplate.Resources>
    <src:FooConverter x:Key="fooConverter" />
  </DataTemplate.Resources>
  <TextBlock 
    Foreground="{Binding Candidates[0].CandidateType,Converter={StaticResource fooConverter}}"
    Text="{Binding Candidates[0].Name}" />
</DataTemplate> 
```

和这样定义的模板列

```
<wpftk:DataGridTemplateColumn CellTemplate="{StaticResource candidateTemplate}" /> 
```

“有效”，但显然不会产生预期的结果，因为 Candidates[0] 是硬编码的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T07:00:57.773

无论出于何种原因，如果我这样做，它会按预期工作......

```
 string assName = Assembly.GetExecutingAssembly().GetName().Name;
    StringBuilder sb = new StringBuilder();
    sb.Append("<DataTemplate ");
    sb.Append("xmlns='http://schemas.microsoft.com/winfx/2006/xaml/presentation' ");
    sb.Append("xmlns:x='http://schemas.microsoft.com/winfx/2006/xaml' ");
    sb.Append("xmlns:src='clr-namespace:WpfToolkitDataGridTester;assembly=" + assName + "' >");
    sb.Append("<DataTemplate.Resources>");
    sb.Append("<src:FooConverter x:Key='fooConverter' />");
    sb.Append("</DataTemplate.Resources>");
    sb.Append("<TextBlock ");
    sb.Append("Foreground='{Binding Candidates[" + i + "].CandidateType,Converter={StaticResource fooConverter}}' ");
    sb.Append("Text='{Binding Candidates[" + i + @"].Name}' />");
    sb.Append("</DataTemplate>");
    var template = (DataTemplate)XamlReader.Parse(sb.ToString()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T09:29:46.117

当 XAML 文件编译为 BAML 时，它引用*程序集*而不是内存中的源。由于 BAML 被编译到同一个程序集中，因此实际类型尚不可用。

我发现一个短期的解决方法是暂时注释掉样式，构建项目，然后恢复样式。

然而，更持久的解决方案是将转换器移动到另一个组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T22:16:43.557

`FooConverter`在更高级别（可能作为 的资源`DataGrid`）而不是在 each中声明 one 是否有帮助`DataTemplate`？

# nhibernate - NHibernate 中的延迟加载

> ID：652305
> 
> 赞同：4
> 
> 时间：2009-03-16T22:03:36.817
> 
> 标签：nhibernate, lazy-loading

如果客户有许多附加到他们的订单。您将如何使用 NHibernate 延迟加载订单列表。

是不是需要设置映射文件？任何帮助或示例都会很棒。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T22:12:35.830

克里斯的建议是我会怎么做，但是如果你想在运行时这样做，你可以将你的标准上的 Fetchmode 设置为惰性，如下所示：

```
criteria.SetFetchMode("Orders", FetchMode.Lazy) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T22:08:10.443

这是一篇好文章：

[http://blogs.chayachronicles.com/sonofnun/archive/2007/03/30/230.aspx](http://blogs.chayachronicles.com/sonofnun/archive/2007/03/30/230.aspx)

从上面的文章：

最常见的是简单地用 'lazy="true"' 属性标记类或在映射声明中放置 'default-lazy="true"'：

```
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="@core.assembly@"
 default-access="nosetter.camelcase-underscore" default-lazy="true"> 
```

或者

```
<class name="Cei.eMerge.Core.Domain.Contacts.Contact" table="Contact" lazy="true" > 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T22:25:16.953

要延迟加载实体的特定集合，请在集合映射上使用“lazy=true”。例如：

```
<bag name="EmploymentHistory" cascade="all" inverse="true" lazy="true">
  <key column="PersonID" />
  <one-to-many class="MyDomain.EmploymentRecord, MyDomainAssembly" />
</bag> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T23:32:01.427

这里的所有答案都是正确的，但如果有这么多订单，您可能还想使用过滤器，这样您就不必加载所有这些。

```
客户客户 = session.CreateCriteria(...)
              .SetFetchMode("订单", FetchMode.Lazy)
              .UniqueResult<客户>();

Ilist<Order> 订单 = session.CreateFilter(customer.Orders," WHERE this.OrderDate < ?")
                      .SetDateTime(...).List();

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T07:55:58.723

您是否希望 Customer 实体具有包含他所有 Orders 的属性？我认为这可能是一个相当大的集合。
我认为，您必须问自己的问题是：
我真正需要多少次才能直接访问客户的订单？

也许，在这种情况下，您不想进行双向关联？也许您不想在 Customer 类中有 Orders 集合。
然后，我将向我的订单存储库添加一个方法，该方法具有以下签名：

```
IList<Order> GetOrdersForCustomer( Customer c ); 
```

但是，我不知道这是否适合您的情况。

# c# - 转义逐字字符串文字

> ID：652310
> 
> 赞同：7
> 
> 时间：2009-03-16T22:04:49.497
> 
> 标签：c#, string, escaping, verbatim-string

我有以下无法编译的字符串：

```
String formLookupPull = @"SELECT value1, '"+tableName+"', '"+columnName+"' FROM lkpLookups WHERE ""table"" = '" + tableName + "' and ""field"" = '" + columnName + "';"; 
```

违规部分是：

```
""table"" = 
```

和

```
""field"" = 
```

编译器在转义序列上搞混了。任何人都可以看到有什么问题吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-16T22:10:50.857

为了解决您的标题问题...

要在逐字字符串文字中转义引号，请使用引号转义序列`""`（即两个引号字符）

```
string a = @"He said ""Hi!""..."; // He said "Hi!"... 
```

有关转义等的更多详细信息，请参见[MSDN 。](http://msdn.microsoft.com/en-us/library/aa691090.aspx)

请注意，在您发布的代码中，唯一的逐字字符串是第一个字符串（`@`在它之前）。随后的字符串不是逐字记录的，因此正确的转义序列应该是`\"`.

你可以让它看起来更漂亮`string.Format`：

```
String formLookupPull = 
   string.Format(@"SELECT value1, '{0}', '{1}' FROM lkpLookups" +
                 @"WHERE ""table"" = '{0}' and ""field"" = '{1}';", 
                 tableName, columnName) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-16T22:12:57.420

问题在于，并非您要连接的所有字符串都是*逐字*字符串文字，只有连接的第一部分是。

换句话说，

```
@"SELECT value1, '" 
```

是整个语句中用于构建最终字符串的唯一*逐字文字。*

您需要在其余字符串前面添加 @ 以使它们全部逐字记录。

这将使它看起来像：

```
String formLookupPull = @"SELECT value1, '"+tableName+ @"', '"+columnName+ @"' FROM lkpLookups WHERE ""table"" = '" + tableName + @"' and ""field"" = '" + columnName + @"';"; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T22:08:10.707

您想用来`\"`转义引号，而不是`""`.

像这样：

```
.. FROM lkpLookups WHERE \"table\" = '" .. 
```

**编辑：**

进一步说明：

`@`您连接的所有字符串中的第一个只有一个。在文字字符串（`@`前面有一个）中，你用双引号转义引号。在普通字符串中，它是斜线引号。

例如。

```
string s = @"this is a literal string with ""quotes"" in it, " 
         +  "and this is a normal string with \"quotes\" in it";

string t = @"two literal strings" + @", concatenated together."; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-16T22:10:09.983

好吧，在您第一次引用结束之后，无论如何都不再使用 @ 符号，因此您可以自由使用转义字符。尝试将您的“表”包裹在“[”中，例如 [table] 和 [field]，或者使用 \ 转义“”字符。

```
String formLookupPull = @"SELECT value1, '" + tableName + "', '" + columnName + "' FROM lkpLookups WHERE [table] = '" + tableName + "' and [field] = '" + columnName + "';"; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-16T22:11:40.777

如果您不能使用 SQL 参数，则 String.Format 可能比纯“+ 连接”更简洁易读。

```
string formLookupPull = 
  string.Format(@"SELECT value1, '{0}', '{1}' 
                       FROM lkpLookups 
                   WHERE ""table"" = '{0}' AND ""field"" = '{1}';",
                tableName, columnName); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T22:08:27.743

```
String formLookupPull = @"SELECT value1, '"+tableName+"', '"+columnName+"' FROM lkpLookups WHERE \"table\" = '" + tableName + "' and \"field\" = '" + columnName + "';"; 
```

我也相信您在构建此查询之前正确地转义了这些变量:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-16T22:14:54.577

你为什么引用列的字面名称，对我来说似乎没有必要。

"SELECT value1, " + tableName + "," + columnName +" FROM lkpLookups WHERE table = '" + tableName + "' and field = '" = columnName + "';";

未经测试，但我想你会明白的。

# java - 在 Java 中向后迭代 SortedSet / SortedMap 的最佳方法

> ID：652311
> 
> 赞同：21
> 
> 时间：2009-03-16T22:05:22.337
> 
> 标签：java, collections

我需要向后遍历 SortedMap 的条目集（这是一个 SortedSet）。我正在编写的代码对性能非常敏感，因为每秒会从很多地方调用它数千次，甚至更多。关于以最快的方式进行操作的任何建议？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-16T22:18:41.633

在 Java 1.6 中，您可以使用[NavigableSet](http://java.sun.com/javase/6/docs/api/java/util/NavigableSet.html)。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2012-11-19T09:57:53.750

在填写地图之前使用它：

```
SortedMap sortedMap = new TreeMap(java.util.Collections.reverseOrder()); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T22:17:12.993

迭代集合的更快方法是获取它的数组副本。这可以在不创建对象甚至方法调用的情况下向前和向后迭代。缺点是你需要在它发生变化时更新它以及你的收藏。

在以下示例中，向前或向后迭代超过 1000 个元素平均需要 1,208 ns。

```
import java.util.Comparator;
import java.util.Random;
import java.util.NavigableSet;
import java.util.TreeSet;

/*
Average time for iteration of 1000 elements was 1,208 ns
*/
public class Main {
    public static void main(String... args) {
        doPerfTest(true);
        doPerfTest(false);
    }

    private static void doPerfTest(boolean warmup) {
        NavigableSet<MyData> set = new TreeSet<MyData>(new MyCompataror());
        Random random = new Random();
        for (int i = 0; i < 1000; i++) {
            set.add(new MyData("text-" + random.nextLong(), random.nextInt()));
        }
        MyData[] myDatas = set.toArray(new MyData[set.size()]);
        long start = System.nanoTime();
        final int runs = 500 * 1000;
        for (int i = 0; i < runs; i+=2) {
            // forward iteration
            for (MyData md : myDatas) {

            }
            // reverse iteration
            for (int j = myDatas.length - 1; j >= 0; j--) {
                MyData md = myDatas[j];
            }
        }
        long time = System.nanoTime() - start;
        if (!warmup)
            System.out.printf("Average time for iteration of 1000 elements was %,d ns", time / runs);
    }

    static class MyCompataror implements Comparator<MyData> {
        public int compare(MyData o1, MyData o2) {
            int cmp = o1.text.compareTo(o2.text);
            if (cmp != 0)
                return cmp;
            return o1.value > o2.value ? +1 :
                    o1.value < o2.value ? -1 : 0;
        }
    }

    static class MyData {
        String text;
        int value;

        MyData(String text, int value) {
            this.text = text;
            this.value = value;
        }
    }
} 
```

现在将主循环替换为，平均时间变为 20,493。

```
// forward iteration
for(Iterator<MyData> it = set.iterator(); it.hasNext();) {
    MyData md = it.next();
}
// reverse iteration
for(Iterator<MyData> it = set.descendingIterator(); it.hasNext();) {
    MyData md = it.next();
} 
```

现在让我们将其与每次复制（我已经说过不如仅在更改时复制最佳）进行比较，时间下降到 15,134 ns！

因此，使用 NavigableSet 可能是所讨论的三个选项中**最慢的。**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T22:12:48.013

您可以定义一个 SortedMap，例如一个带有自定义[Comparator的](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html)[TreeMap](http://java.sun.com/javase/6/docs/api/java/util/TreeMap.html) ，它可以反转排序顺序。如果您需要在两个方向上进行迭代，那么将数据结构的*两个*副本保留在内存中是否可行？

 *# windows-mobile - 位置感知移动应用程序的框架？

> ID：652314
> 
> 赞同：2
> 
> 时间：2009-03-16T22:06:24.847
> 
> 标签：windows-mobile, compact-framework, mobile, frameworks, gps

根据定义，像 Windows Mobile 手机/PDA 这样的移动设备可以在多种位置使用，并且应该相应地进行调整。如果我在家，我希望它切换到我的本地 WLAN，而不是使用 3G 或 GPRS。如果我在开会，我希望它是静音蜂鸣器而不是响亮的铃声。如果我在嘈杂的环境中，我希望铃声进行相应的调整。如果我正在通勤回家，我可能想向我的 SO 发送自动 SMS。

我可能会使用许多数据源来确定我所处的环境和环境：

1.  当前的GSM小区
2.  可用的 WLAN 网络 SSID
3.  GPS 坐标（如果该设备处于活动状态）
4.  日历状态（在会议中）
5.  麦克风（嘈杂或安静的环境）
6.  ActiveSync 状态（可能在我的电脑上）

我预计未来几代手机将允许更多种类的位置相关配置和行为。目前，我可能仅限于为自己写一些东西。然而，整合位置数据源并权衡来自不同来源的证据，以了解我在哪里以及我在做什么，这不仅仅是一个应用程序感兴趣的事情，也是最终用户不希望配置为将定义分开的事情几个应用程序。

我发现的[最近的问题是关于如何获取移动单元 ID。](https://stackoverflow.com/questions/82184/public-cell-id-databases)我猜可以找到其他 API（但欢迎提供任何帮助）。

是否有任何框架或想法可以帮助我整合这些数据源，让用户配置环境，并在位置或情况发生变化时触发事件？根据来自多个来源的证据，我应该如何表示一个位置？您是否有可以帮助我的适用 API 和组件的快速链接？最好用于[CF](http://en.wikipedia.org/wiki/.NET_Compact_Framework)（而不仅仅是[Windows XP](http://msdn.microsoft.com/en-us/library/ms700657(VS.85).aspx)）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T06:49:59.860

[这](http://www.codeproject.com/KB/mobile/DeepCast.aspx)是 Code Project 中的一篇非常有趣的文章，介绍了如何检索 CellID，然后将其映射到坐标。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T04:39:20.883

在提供有关已发布建议的更多见解时：

**地点信息** CodeProject 上对“Deep Cast”的引用利用了谷歌的网络服务，除了手机中的 GPS 硬件（如果存在）之外，还利用蜂窝塔 ID 推断一个人的位置。假设谷歌在蜂窝塔 ID 上具有广泛的覆盖范围，使得该方法明显可靠。这种方法的缺点是不清楚谷歌对使用该服务的人的看法。Google 可能的处置可能包括 (1) 反对其他程序使用此功能 (2) 鼓励开发人员使用该功能或​​ (3) 冷漠（即不限制使用它但也不支持使用它）。冷漠性格的危险在于，在遥远的未来某个时候，谷歌可能会在没有警告的情况下更改服务的界面。

Skyhook Wireless 服务非常可靠。Apple 使用 Skyhook Wireless 作为 iPhone 和 iPod 中的 WiFi 位置。几个月前，Skyhook 扩展了这项服务，以便不再只在 Windows 手机上进行基于 WiFi 的定位，它现在将使用 WiFi、GPS 和蜂窝塔定位。这项服务的缺点是，如果您打算在商业上使用它，则需要考虑许可。由于 .Net Compact Framework 的互操作能力的限制，从 .Net/托管应用程序中使用这个 SDK 最初是一件痛苦的事情。我设法制作了一个 .Net 包装器并将其发布到 Skyhook Wireless 讨论组。

**基于位置的提醒**

几个月前，有一篇关于基于位置的提醒的 MSDN 文章。有关详细信息，请参阅[http://msdn.microsoft.com/en-us/magazine/2009.01.wm6gps.aspx上的文章和示例代码](http://msdn.microsoft.com/en-us/magazine/2009.01.wm6gps.aspx)

**环境噪声检测**

几年前有一个 MSDN Magazine 代码示例演示了如何根据环境噪音水平自动调整手机的音量。有关详细信息，请参阅[http://msdn.microsoft.com/en-us/magazine/cc163341.aspx](http://msdn.microsoft.com/en-us/magazine/cc163341.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T22:16:56.410

[您可能会对Buddycloud](http://www.buddycloud.com/)及其[API](http://www.buddycloud.com/cms/node/1)感兴趣。它们允许根据您列出的许多内容进行查询。

此外，您可以使用蓝牙来检测您与他人的距离等。有趣的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T05:52:00.327

对于第 1 - 3 点（至少），有

*   [Navizon 定位系统 API 和 SDK](http://www.navizon.com/fordevelopers.asp)
*   [Skyhook 开发者网络](http://www.skyhookwireless.com/developers/)

# asp.net-mvc - 绕过asp.net MVC中的模型绑定器以获取复杂的动作参数？

> ID：652316
> 
> 赞同：0
> 
> 时间：2009-03-16T22:07:16.280
> 
> 标签：asp.net-mvc, binding

是否有一个属性可以关闭复杂动作参数的模型绑定？

我的场景是这样的：我正在使用 Linq to SQL，但让生成的类实现接口。例如，IUser。我的一些控制器操作接受 IUser 参数，我的一些视图绑定 IUser 模型，但我不希望默认模型绑定器构造它。我为此使用动作过滤器。这背后的想法是，如果某个操作需要用户详细信息，则操作过滤器会在调用该操作之前从数据库中获取它。

为了避免在 DefaultModelBuilder 启动时发生的错误，我制作了一个空模型绑定器，它只从 CreateModel 返回空值。

```
ModelBinderDictionary binders = System.Web.Mvc.ModelBinders.Binders;
binders[typeof(IUser)] = new NullModelBinder(); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-18T21:40:04.167

遵循架构并创建一个 IUser 绑定器来执行您的操作过滤器正在执行的操作不是更简单吗？目前，您正在扭曲操作过滤器以执行它不完全打算执行的操作，并且在此过程中您还忽略了专门为执行您想要实现的操作而设计的扩展点（以特定方式创建参数的实例） .

您是否有充分的理由在操作过滤器中创建 IUser 而不是使用自定义活页夹？

# algorithm - 使用预定义的排序值列表对对象进行排序

> ID：652337
> 
> 赞同：1
> 
> 时间：2009-03-16T22:12:20.883
> 
> 标签：algorithm, sorting

我想知道以与不同数组相同的顺序对对象数组进行排序的最快方法是什么。

这是 C# 中的一个示例：

```
class MyClass
{
    public MyClass(int value)
    {
        this.value = value;
    }
    int value;
    public int Value
    {
        get { return value; }
        set { this.value = value; }
    }
}

    static List<int> sortedValuesList;
    static List<MyClass> objectList; 
```

以与 sortedValuesList 相同的顺序对 objectList 进行排序的最快方法是什么？可能有多个具有相同值的对象。

我已经有可以做到这一点的简单算法，但它是 O(n^2) 并且需要额外的内存。

**编辑：** 我想目前还不清楚我想要做什么。假设用户在屏幕上看到销售人员的数据网格。他可以按他想要的任何列对它们进行排序。现在用户点击一个按钮，就会显示一个客户表。每个客户都会引用其中一位销售人员。我想根据之前数据网格中销售人员的顺序对客户列表进行排序。

这只是一个理论问题，因为我不需要更多性能。我只是想知道当您需要使用查找表来比较对象时是否有一些不错的排序算法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T23:03:55.737

把它分成几个步骤：

1.  浏览您的 sortedValuesList 并从值 -> 索引位置构建地图；这是 O(n log n)
2.  浏览您的对象并在临时字段中添加索引（再次，O（n log n））
3.  按临时字段对列表进行排序（也是 O(n log n)）

总算法，O(n log n)。

或者，如果您不想拥有暂存字段，则可以每次通过映射查找排序键以获得总体 O(n (log n)^2)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T22:13:09.027

这是我非常简单的解决方案：

 `````
class Program
{
    static List<int> sortedValuesList;
    static List<MyClass> objectList;

    static void Main(string[] args)
    {
        //Generate some test data;
        Random random = new Random();
        objectList = new List<MyClass>();
        sortedValuesList = new List<int>();
        for (int i = 0; i < 10; i++) {
            MyClass a = new MyClass(random.Next() % 20);
            objectList.Add(a);
            if (!sortedValuesList.Contains(a.Value))
                sortedValuesList.Add(a.Value);
        }

        //Shuffle id's
        for (int i = sortedValuesList.Count - 1; i > 0; i--) {
            int n = random.Next(i + 1);
            int tempId = sortedValuesList[n];
            sortedValuesList[n] = sortedValuesList[i];
            sortedValuesList[i] = tempId;
        }

        Console.WriteLine("Reference list:");
        for (int i = 0; i < sortedValuesList.Count; i++) {
            Console.WriteLine(string.Format("{0,2} {1,5}", i, sortedValuesList[i]));
        }

        Console.WriteLine("unsorted list:");
        for (int i = 0; i < objectList.Count; i++) {
            Console.WriteLine(string.Format("{0,2} {1,5}", i, objectList[i].Value));
        }

        //Sort
        List<MyClass> sortedList = new List<MyClass>();
        foreach (int id in sortedValuesList) {
            sortedList.AddRange(
                objectList.FindAll(delegate(MyClass a) { return a.Value == id; })
            );
        }

        Console.WriteLine("After sorting:");
        for (int i = 0; i < sortedList.Count; i++) {
            Console.WriteLine(string.Format("{0,2} {1,5}", i,  sortedList[i].Value));
        }
        Console.ReadKey();

    }
} 
````  `* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T22:15:50.580

首先，帮自己一个忙并使用 List 的通用版本，因此将您的 objectList 定义为

```
static List<MyClass> objectList; 
```

但是，在任何一种情况下，由于 List 是对实际对象的引用的集合，并且由于您似乎希望两个列表具有相同的顺序，为什么不将一个列表分配给另一个列表呢？我错过了什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T22:41:02.343

听起来你想要一张地图：

```
static Dictionary<int, MyClass> sortedObjectList 
```

# jquery - 可选表行 Jquery Asp.net

> ID：652355
> 
> 赞同：3
> 
> 时间：2009-03-16T22:16:23.993
> 
> 标签：jquery, asp.net, select

我想创建一个可以通过 jquery 选择行的表。我还想将某些表格单元格值从一行上的双击事件传递到另一个页面。

有没有人有这将如何工作的例子？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T23:23:19.777

```
var selected = null;

$(document).ready(function(){
   $("#<%=myTable.ClientID %>").find("tr").click(function(){
      $(selected).removeClass("selected");
      $(this).addClass("selected");
      selected = this;
   });

   $("#<%=myTable.ClientID %>").find("tr").dblclick(function(){

      /* if you just want to dig into that record I would put a custom attribute on the row */
      window.location = "<%=ResolveUrl("~/one/folder/deeper/") %>?record=" + $(this).attr("RecordId");

      /* or you could have a hidden LinkButton in the row (Text="" or not set) that you could trigger. Make sure you set the CommandName="Something" and CommandArgument="RecordId" */
      $(this).find("a").click();
   });

}); 
```

# jquery - 原型和 jQuery 干扰

> ID：652356
> 
> 赞同：0
> 
> 时间：2009-03-16T22:16:26.443
> 
> 标签：jquery, prototypejs

我有很多 jquery 代码和一个使用原型的小 .js 脚本

问题是当我尝试在原型中调用 $$ 方法时出现错误：$$ 未定义

所以我想知道让$$工作的长手方法

```
$$('table.'+triggerClass).each(function(t){ 
```

有没有办法强制那部分代码使用原型，因为它可以在 jquery 中完成`jQuery.noConflict();`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T22:24:33.087

我不确定原型是否有 $$() 的长手版本。但是，我对您的建议是不要同时使用 jQuery 和 Prototype。我这么说有几个原因：

1.  jQuery 和 Prototype 都是相当大的库，这意味着您的用户需要大量下载
2.  jQuery 和 Prototype 在功能上有很多重叠，并且会出现像你现在这样的冲突问题。

我建议你重写使用原型的小 js 脚本来使用 jQuery。（并不是说我推荐一个，只是考虑到你的情况，这就是我会做的）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T22:33:22.567

正如另一个答案所说，尽量不要同时使用两者。Prototype 非常适合轻量级的东西，jquery 适合更复杂的东西。

话虽如此，您需要重新映射 jQuery 以消除冲突：

```
jQuery.noConflict(); 
```

然后只需将 jQuery 对象分配给一个新变量。见[这里](http://docs.jquery.com/Core/jQuery.noConflict "这里")。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T17:01:35.943

`$$()`是一个原型函数，所以如果你试图让代码“保持原样”，你将无法让它工作 *. 如果您可以更改代码（并将 JQuery 置于无冲突模式）：

```
JQuery('table.'+ triggerClass).each(function(t){}) 
```

但是同样，如果您没有触发无冲突模式，则无法保证哪个库将提供服务`$()`。

* 我想在理论上，如果你真的想保留保留，你可以将 $$() 映射到 JQuery() ，但有可能破坏原型代码中的内容。

# php - PHP 库或命令行？

> ID：652360
> 
> 赞同：2
> 
> 时间：2009-03-16T22:17:17.237
> 
> 标签：php, command-line, curl, imagemagick

我最近遇到了两种情况，我选择使用命令行而不是 PHP 库来做某事。例如，在 PHP 中这样做：

```
`curl http://someplace.com`

```

而不是这个：

```
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, "http://www.example.com/");
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_exec($ch);
curl_close($ch);

```

另一种情况是使用 ImageMagick 的命令行界面，而不是 PHP 界面。

一些与我交谈过的人认为使用库更好。有人说更好更快，有人说更安全，等等。

你有什么意见？使用其中一种有什么好处？

我知道一个好处，就是我只有一行代码而不是 5 行。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T22:21:47.990

我总是使用这些库：

1.  无需分叉两次（一次用于子外壳，另一次用于您正在运行的程序）-因此更快

2.  无需担心转义命令行参数，这有助于安全

如果担心代码行数，将这 5 行代码写在一个函数中，然后在需要时调用该函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T22:22:36.757

执行应用程序既具有潜在危险，又几乎总是一项昂贵的操作。除其他事项外，您需要正确转义您传递给程序的每个参数。

创建一个新进程的成本也远高于在现有进程中调用一个简单函数。

虽然您现在所做的工作可能很好，但一旦您的应用程序有数千个并发用户，它就不会了。（你正在计划，不是吗？:)）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T06:23:40.517

使用命令行调用和使用库之间的权衡是应用程序的速度和运行应用程序的计算机的速度。

每次您进行这样的命令行调用时，PHP 都必须派生一个进程（实际上是两个，shell 和您要运行的命令）。这意味着，您的计算机必须启动另一个应用程序。这是一个消耗大量系统资源的昂贵的东西。想想如果您（或您的启动过程）尝试在您的计算机上一次启动太多程序会发生什么。

当您使用库时，无需派生任何进程。PHP 本身正在做其他应用程序会做的工作。

也就是说，我知道很多生产 Web 应用程序都可以通过调用 PHP 库无法使用的命令行应用程序来摆脱困境。如果它是应用程序的低流量部分，或者是一个不经常被点击的页面，你可能能够逃脱它，但是当你扩大规模时，你给自己买了一个受伤的世界。

还需要考虑安全性。当您像这样从 PHP 运行命令时，如果您使用变量来构建命令字符串，您将面临类似的风险

```
;rm -rf / 
```

被注入到您的命令中，这会很糟糕（rm -rf / 将删除您的整个文件系统）。是的，您可以转义您的输入变量来处理这个问题，但是请询问任何资深的 PHP 开发人员如何手动转义 SQL 查询。

So, in short, you can probably get away with it, but it's not a best practice and you're buying yourself a load of pain in the future when the s--- hits the fan.

# c# - XNA：防止方法返回

> ID：652366
> 
> 赞同：1
> 
> 时间：2009-03-16T22:20:04.360
> 
> 标签：c#, xna, drawablegamecomponent

我希望`DrawableGameComponent`类中的方法在**满足特定条件之前不返回**

假设我有这个课程（来自`DrawableGameComponent`课程的片段）：

```
public override void Update(GameTime gameTime)
        {
            if (moving && pixFromLastMove <= distanceToMove)
            {
                position += velocity;
                pixFromLastMove += velocity.Length();
            }
            else
            {
                moving = false;
            }
            if (rotating)
            {
                rotation += 0.1f;
                var cRotation = MathHelper.Clamp(rotation, -MathHelper.PiOver2, angleBeforeRotation + degToRotate);
                if (cRotation != rotation)
                {
                    rotation = cRotation;
                    angleBeforeRotation = rotation;
                    rotating = false;
                }
            }
            base.Update(gameTime);
        }

public void Ahead(int pix)
        {
            moving = true;
            distanceToMove = pix;
            pixFromLastMove = 0;
            velocity = new Vector2((float) Math.Cos(rotation), (float) Math.Sin(rotation))*5.0f;

            //DO NOT RETURN UNTIL THIS ROBOT HAS MOVED TO ITS DESTINATION
            }

public void TurnLeft(int deg)
        {
            rotating = true;
            degToRotate = MathHelper.ToRadians(deg);
            angleBeforeRotation = rotation;

            //DO NOT RETURN UNTIL THIS ROBOT HAS BEEN FULLY ROTATED
        } 
```

这个类正在`Draw()`主线程中绘制（）（因为这个drawablegamecomponent在单独的线程中执行），并且在主线程中我有一个我想要按顺序执行的命令列表......但是目前，因为`Ahead`方法在为 赋值后立即返回`velocity`，这些方法将几乎同时运行，而这反过来只是同时执行所有动画。

那么你认为我应该怎么做才能防止命令（等）的方法`Ahead`在`TurnLeft`满足特定条件之前返回？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T22:41:03.717

您需要为 Update() 方法创建某种状态机。例如

```
public override void Update() { 
    if (movingRobot) {
        OnlyUpdateRobotPosition();
    }
    else {
        DoStuffPerhapsIncludingStartingRobotMove();
    }
} 
```

还是我错过了这个问题？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T23:15:06.023

啊，两个字：合作多任务。借助[Fibers](http://msdn.microsoft.com/en-us/library/ms682661(VS.85).aspx)（或您选择的协作式多任务构建块）的乐趣，您可以（在奠定了一些基础工作之后，例如[在 C# 中启用纤维](http://www.java2s.com/Tutorial/CSharp/0520__Windows/Fiber.htm)）执行以下操作：

```
public void Ahead(int pix)
{
  moving = true;
  distanceToMove = pix;
  pixFromLastMove = 0;
  velocity = new Vector2((float) Math.Cos(rotation), (float) Math.Sin(rotation))*5.0f;

  //DO NOT RETURN UNTIL THIS ROBOT HAS MOVED TO ITS DESTINATION
  while(!HasReachedDestination())
  {
    Yield(); // let another fiber run
  }
} 
```

然而，为了完成这项工作，您需要实现一个简单的循环调度程序。C# 并不是真正的我的船，但我要做的是保持简单并创建某种我称之为合作（或其他）的基类。此类将具有所有已创建纤维的静态列表以及静态方法 Create() 和 Yield()。Create() 将创建一个新的纤程（或其他），而 Yield() 将简单地安排下一个纤程执行（循环方式），在纤程世界中将包括对 SwitchToFiber() 的调用。它还将有一个名为 Start() （或其他）的虚拟方法，这是光纤开始运行的地方。

为了使它更花哨，您可以稍后保留单独的可运行或不可运行的纤程列表（即等待某些事情发生）。在这种情况下，您可以将 Ahead 中的循环简化为：

```
WaitFor(HasReachedDestination); 
```

但我建议先了解合作多任务的概念。

最后，关于应该制作纤维的一些想法，通常你的主要更新循环是一根纤维，更新和绘制所有对象，然后调用 Yield()。所有游戏对象也将是纤维（如果您有很多游戏对象，这可能不可行）。对于您的游戏对象，您可以执行以下操作：

```
public override Start()
{
  do
  {
    if(EnemyToTheLeft())
    {
      TurnLeft(90); // this will call Yield and return when we have finished turning
      Shoot();
    }
    Yield(); // always yield
  }while(!dead);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T22:02:26.257

我同意 Pop Catalin：最好不要阻止这些命令功能。我认为你可以通过多考虑设计来改进你的游戏。让我为您提供一些关于如何改进设计的想法。

首先，听起来您所描述的问题是您想以特定顺序向游戏组件发送大量移动命令，并让它以特定顺序执行这些命令。正如您所注意到的，计算机执行计算（速度或旋转）所花费的时间与组件实际执行动作（移动或旋转）所花费的时间是不同的。

计算期间阻塞的问题（Ahead、TurnLeft 等）是调用该函数的更新循环无法更新任何其他组件。如果只需要担心一个组件，这可能会正常工作，但在大多数游戏中通常情况并非如此。

现在是好的部分：我们如何解决这个问题？我认为 erikkallen 的想法是正确的，但我会更进一步。听起来游戏组件是某种会四处移动的实体，那么为什么不给它一个动作队列呢？一个简单的实现是让你的调用函数调用如下：

```
gameComponent.queueAction( (MethodInvoker)delegate() 
                           { gameComponent.Ahead(10); }); 
```

您的 queueAction 函数可能如下所示：

```
public void queueAction(MethodInvoker action)
{
    queue.Enqueue(action);
} 
```

在更新函数的顶部，您可以添加：

```
if(noCurrentAction && queue.Count > 0)
{
    ((MethodInvoker)queue.Dequeue()).Invoke();
    noCurrentAction = false;
} 
```

您需要在 Update 函数的末尾添加一行，例如：

```
if(!moving && !rotating)
    noCurrentAction = true; 
```

现在，我绝对不会称其为最佳解决方案，但实现它并不需要太多代码。当然，如果您需要同时移动和旋转，则必须对其进行一些调整。当您添加不同类型的操作时，它也会变得更加混乱。

对于更通用的解决方案，我会考虑制作一个基本 Action 类，并从中派生特定的 action 类。然后您可以将动作推送到队列中，并且您的 Update 函数可以调用动作的 Update 函数，这将完成游戏组件 Update 函数现在正在执行的两个部分的工作。

这些只是一些需要思考的想法，我希望这里的一些东西能让你开始。

我想提到的最后一件事是，我没有看到您使用传递给 Update 的 gameTime 变量。您的组件移动和旋转的量可能需要成为自上次调用 Update 以来经过的时间的函数。这意味着 Update 函数将根据经过的时间量移动和旋转您的游戏组件，而不仅仅是调用 Update 函数的次数。我不太擅长解释它，这取决于你希望你的游戏如何运作。这里有[几个](http://blogs.msdn.com/shawnhar/archive/2007/07/25/understanding-gametime.aspx)来自 Shawn Hargreaves（XNA 专家）的不同[帖子。](http://blogs.msdn.com/shawnhar/archive/2007/11/23/game-timing-in-xna-game-studio-2-0.aspx)此外，还有一个 XNA 论坛[帖子](http://forums.xna.com/forums/p/15333/80250.aspx#80250)讨论了我试图提出的观点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T22:25:53.910

尽管我发现您的设计有些奇怪，但完成您想要的最佳方法是使用[EventWaitHandle](http://msdn.microsoft.com/en-us/library/system.threading.eventwaithandle.aspx)并从另一个线程发出信号。

假设您的班级有一个等待句柄的实例

您可以在您的方法中调用 waithadle.WaitOne()，并在满足条件时使用 waithandle.Set() 从另一个线程发出偶数信号，此时您的方法将从等待中恢复。

# javascript - 就在我想我终于理解了 Javascript 作用域的时候

> ID：652372
> 
> 赞同：5
> 
> 时间：2009-03-16T22:22:00.347
> 
> 标签：javascript, scope

我遇到了一些事情，说明我显然还不明白。

谁能解释一下为什么“this”的值会在下面发生变化？

```
var MyFunc = function(){
    alert(this);
    var innerFunc = function(){
        alert(this);
    }
    innerFunc();
};

new MyFunc(); 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-16T22:27:42.703

在 JavaScript 中，`this`表示*调用*函数的上下文对象，而不是定义它的作用域（或调用它的作用域）。对于`MyFunc`， this 引用正在创建的新对象；但是对于`innerFunc`，它引用全局对象，因为`innerFunc`调用时没有指定上下文。

这往往会使那些使用 Java 或类似 OO 语言的人绊倒，在这些语言中，`this`几乎总是引用定义了被调用方法的类的实例。请记住：JavaScript 没有方法。或者上课。只是对象和功能。

### 另请参阅：[JavaScript 中“this”关键字行为的基本原理是什么？](https://stackoverflow.com/questions/541167/what-is-the-rationale-for-the-behavior-of-the-this-keyword-in-javascript)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T09:27:57.360

只需执行以下操作：

```
var MyFunc = function(){
    var self = this;
    alert(self);
    var innerFunc = function(){
        alert(self);
    }
    innerFunc();
};

new MyFunc(); 
```

这样 self 总是意味着这个，不管你从哪里调用它，这通常是你想要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T22:39:55.077

作为旁注，“this”不一定总是引用实际函数，因为您可以使用“强制”this-reference 调用函数，请考虑一个事件处理程序，其中 this 将引用实际元素触发了该事件。

使用

`yourFunction.apply(thisReference, arguments)`

您可以在“this”将指向您作为第一个参数传递的任何内容的地方调用它。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-16T22:25:14.097

乍一看，我会说这是因为外部“this”引用了 MyFunc，而内部“this”引用了 innerFunc。

但是，Javascript 并不是我有任何特别专长的东西。

# java - 如何防止小程序跨网页卸载？

> ID：652376
> 
> 赞同：0
> 
> 时间：2009-03-16T22:23:39.297
> 
> 标签：java, javascript, caching, applet

我有一个大的小程序，需要大约 40 秒来初始化（出租车被缓存，所以忽略这个问题的下载时间）。

问题是，如果用户转到启动小程序（单个窗口）的页面 A，然后导航到页面 B，小程序将被卸载。如果用户返回到页面 A，他们将再次产生 40 秒的初始化时间。

我希望能够启动小程序，只产生一次 40 秒的初始化时间。小程序需要驻留在单个浏览器窗口中（与我的 Web 应用程序相同的窗口）。换句话说，我无法在弹出窗口中启动小程序。

有人对如何防止小程序卸载有任何创意吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T22:48:23.263

唯一的选择是将您的内容放在包含整个文档的 iframe 中，并为小程序使用绝对定位。

```
<body>
 <iframe id='content' src='FIRST_URL'></iframe>
 <object id='applet'></object>
</body> 
```

使用这样的 CSS：

```
#content {
  width:100%;
  height: 100%;
}

#applet {
  position: absolute;
  left: LEFT_POSITION;
  top: TOP_POSITION;
  width: DESIRED_WIDTH;
  height: DESIRED_HEIGHT;
} 
```

有很多缺点：

*   无论页面如何，小程序都将始终定位在同一位置
*   您将很难获得 iframe 全宽和全高，尤其是在 IE 中
*   您可能还会让小程序正常显示（iframe 顶部的对象，我无法想象您会遇到什么麻烦）
*   如果您的用户点击指向您网站外部的链接，则小程序将保留，除非您为该链接设置目标（即 target='top' 或 target='__blank'）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-27T17:40:33.530

您可以通过以下方式显示警告：

```
if(window.body)window.body.onbeforeunload=function(){if(window.event)window.event.returnValue="UNLOAD MSG";};else window.onbeforeunload=function(){return "UNLOAD MSG";}; 
```

这适用于几乎所有浏览器，但您无法更改文本周围的文本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T22:40:57.897

将 Applet 放在不卸载的框架中，或阻止用户转到包含 Applet 的网页中的另一个页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T20:09:46.217

我想也许有一种方法可以弹出一个小浏览器窗口并在其中加载小程序，然后使用 Javascript 以某种方式将小程序从较小的窗口拉入较大的浏览器。

我认为我不能以这种方式操作 DOM。

还有其他想法吗？

# c# - 在 excel 2007 中打开时，Excel 电子表格生成导致“文件格式与扩展名错误不同”

> ID：652377
> 
> 赞同：31
> 
> 时间：2009-03-16T22:24:24.380
> 
> 标签：c#, excel, webforms, xls

电子表格仍会显示，但会显示警告消息。出现这个问题的原因似乎是 Excel 2007 对匹配其扩展名的格式比早期版本的 Excel 更加挑剔。

该问题最初是由 ASP.Net 程序发现的，并在 Excel 错误中产生“您尝试打开的文件，”Spreadsheet.aspx-18.xls'，格式与文件扩展名指定的格式不同。验证...”。但是，当我打开文件时，它显示得很好。我使用的是 Excel 2007。Firefox 将文件识别为 Excel 97-2003 工作表。

这是产生问题的 ASP.NET 页面：

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Spreadsheet.aspx.cs" Inherits="Spreadsheet" %> 
```

文件后面的代码如下所示：

```
public partial class Spreadsheet : System.Web.UI.Page {
    protected void Page_Load(object sender, EventArgs e)
    {
        Response.ContentType = "application/vnd.ms-excel";
        Response.Clear();
        Response.Write("Field\tValue\tCount\n");

        Response.Write("Coin\tPenny\t443\n");
        Response.Write("Coin\tNickel\t99\n"); 

    } 
```

}

吨

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-16T22:40:43.483

[http://blogs.msdn.com/vsofficedeveloper/pages/Excel-2007-Extension-Warning.aspx](http://blogs.msdn.com/vsofficedeveloper/pages/Excel-2007-Extension-Warning.aspx)

这是一个链接，基本上描述了 MS 知道您描述的问题，并且无法从 ASP.NET 代码中抑制它。它必须在客户端的注册表中被抑制/修复。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-07-21T14:56:31.217

如果您像我一样将 Excel 工作表生成为 2003 XML 文档，则可以通过执行以下操作来删除警告：

**添加到 XML 输出：**

```
<?xml version="1.0" encoding="utf-16"?>
  <?mso-application progid="Excel.Sheet"?>
  ... 
```

**添加到下载页面：**

```
// Properly outputs the xml file
response.ContentType = "text/xml";

// This header forces the file to download to disk
response.AddHeader("content-disposition", "attachment; filename=foobar.xml"); 
```

现在 Excel 2007 将不会显示文件内容和文件扩展名不匹配的警告。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-04-28T02:39:03.670

我看到这个问题被问了很多次。我今天遇到了同样的困难，所以我使用 NPOI [npoi.codeplex.com/解决了这个问题](http://npoi.codeplex.com/)

```
public static class ExcelExtensions
{
    /// <summary>
    /// Creates an Excel document from any IEnumerable returns a memory stream
    /// </summary>
    /// <param name="rows">IEnumerable that will be converted into an Excel worksheet</param>
    /// <param name="sheetName">Name of the Ecel Sheet</param>
    /// <returns></returns>
    public static FileStreamResult ToExcel(this IEnumerable<object> rows, string sheetName)
    {
        // Create a new workbook and a sheet named by the sheetName variable
        var workbook = new HSSFWorkbook();
        var sheet = workbook.CreateSheet(sheetName);

        //these indexes will be used to track to coordinates of data in our IEnumerable
        var rowIndex = 0;
        var cellIndex = 0;

        var excelRow = sheet.CreateRow(rowIndex);

        //Get a collection of names for the header by grabbing the name field of the display attribute
        var headerRow = from p in rows.First().GetType().GetProperties()
                        select rows.First().GetAttributeFrom<DisplayAttribute>(p.Name).Name;

        //Add headers to the file
        foreach (string header in headerRow)
        {
            excelRow.CreateCell(cellIndex).SetCellValue(header);
            cellIndex++;
        }

        //reset the cells and go to the next row
        cellIndex = 0;
        rowIndex++;

        //Inset the data row
        foreach (var contentRow in rows)
        {
            excelRow = sheet.CreateRow(rowIndex);

            var Properties = rows.First().GetType().GetProperties();

            //Go through each property and inset it into a single cell
            foreach (var property in Properties)
            {
                var cell = excelRow.CreateCell(cellIndex);
                var value = property.GetValue(contentRow);

                if (value != null)
                {
                    var dataType = value.GetType();

                    //Set the type of excel cell for different data types
                    if (dataType == typeof(int) ||
                        dataType == typeof(double) ||
                        dataType == typeof(decimal) ||
                        dataType == typeof(float) ||
                        dataType == typeof(long))
                    {
                        cell.SetCellType(CellType.NUMERIC);
                        cell.SetCellValue(Convert.ToDouble(value));
                    }
                    if (dataType == typeof(bool))
                    {
                        cell.SetCellType(CellType.BOOLEAN);
                        cell.SetCellValue(Convert.ToDouble(value));
                    }
                    else
                    {
                        cell.SetCellValue(value.ToString());
                    }
                }
                cellIndex++;
            }

            cellIndex = 0;
            rowIndex++;
        }

        //Set the width of the columns
        foreach (string header in headerRow)
        {
            sheet.AutoSizeColumn(cellIndex);
            cellIndex++;
        }

        return workbook.GetDownload(sheetName);
    }

    /// <summary>
    /// Converts the NPOI workbook into a byte array for download
    /// </summary>
    /// <param name="file"></param>
    /// <param name="fileName"></param>
    /// <returns></returns>
    public static FileStreamResult GetDownload(this NPOI.HSSF.UserModel.HSSFWorkbook file, string fileName)
    {
        MemoryStream ms = new MemoryStream();

        file.Write(ms); //.Save() adds the <xml /> header tag!
        ms.Seek(0, SeekOrigin.Begin);

        var r = new FileStreamResult(ms, "application/vnd.ms-excel");
        r.FileDownloadName = String.Format("{0}.xls", fileName.Replace(" ", ""));

        return r;
    }

    /// <summary>
    /// Get's an attribute from any given property
    /// </summary>
    /// <typeparam name="T"></typeparam>
    /// <param name="instance"></param>
    /// <param name="propertyName"></param>
    /// <returns></returns>
    public static T GetAttributeFrom<T>(this object instance, string propertyName) where T : Attribute
    {
        var attrType = typeof(T);
        var property = instance.GetType().GetProperty(propertyName);
        return (T)property.GetCustomAttributes(attrType, false).First();
    }
} 
```

希望你觉得这很有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-05-12T08:05:30.240

我试图在几天内解决这个问题。最后，我在这里找到了解决方案：[http ://www.aspsnippets.com/Articles/Solution-ASPNet-GridView-Export-to-Excel-The-file-you-are-trying-to-open-is-与文件扩展名指定的格式不同的格式.aspx](http://www.aspsnippets.com/Articles/Solution-ASPNet-GridView-Export-to-Excel-The-file-you-are-trying-to-open-is-in-a-different-format-than-specified-by-the-file-extension.aspx)

**命名空间：**

```
using System.IO;
using System.Data;
using ClosedXML.Excel; 
```

**代码：**

```
DataTable dt = new DataTable("GridView_Data");
// Fill your DataTable here...

//Export:
    using (XLWorkbook wb = new XLWorkbook())
    {
        wb.Worksheets.Add(dt);

        Response.Clear();
        Response.Buffer = true;
        Response.Charset = "";
        Response.ContentType = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
        Response.AddHeader("content-disposition", "attachment;filename=GridView.xlsx");
        using (MemoryStream MyMemoryStream = new MemoryStream())
        {
            wb.SaveAs(MyMemoryStream);
            MyMemoryStream.WriteTo(Response.OutputStream);
            Response.Flush();
            Response.End();
        }
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T22:30:22.870

我更喜欢使用网格并更改响应类型我还没有遇到过这种方法的问题。我没有使用直接制表符分隔的文件。一种可能性是\n 可能必须是\r\n。只是盲射。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-03-16T22:39:56.247

采用

内容类型=应用程序/vnd.openxmlformats-officedocument.spreadsheetml.sheet

并将扩展名指定为 xlsx

# sql-server - 如何正确实施快照隔离和 tempdb 问题？

> ID：652378
> 
> 赞同：5
> 
> 时间：2009-03-16T22:24:30.480
> 
> 标签：sql-server, transactions, snapshot-isolation

快照隔离功能帮助我们解决了读者在大容量网站上锁定作者的问题。它通过在 SqlServer 中使用 tempdb 对行进行版本控制来实现。

我的问题是正确实现此快照隔离功能，是否只是在我的 SqlServer 上执行以下操作

```
ALTER DATABASE MyDatabase
SET ALLOW_SNAPSHOT_ISOLATION ON

ALTER DATABASE MyDatabase
SET READ_COMMITTED_SNAPSHOT ON 
```

我是否还必须编写包含 TransactionScope 的代码，例如

```
using (new TransactionScope(TransactionScopeOption.Required, 
    new TransactionOptions { IsolationLevel = IsolationLevel.SnapShot})) 
```

[最后，Brent 在这篇文章](http://www.brentozar.com/archive/2007/09/pass-summit-2007-day-one-notes/)的“并发的隐藏成本”一节中指出了他的担忧，他在其中提到当您在 tempdb 中对行进行版本化时，tempdb 可能会用完空间，并且可能会出现性能问题，因为它必须查找版本化的行。所以我的问题是我知道这个网站使用快照隔离，其他人在大型网站上使用这个功能，你对性能有什么看法？

谢谢，雷。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2015-08-11T23:33:57.463

正如[https://msdn.microsoft.com/en-us/library/tcbchxcb(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/tcbchxcb(v=vs.110).aspx)中所述，“只需执行以下操作” ，“如果 READ_COMMITTED_SNAPSHOT 选项设置为关闭，您必须为每个会话显式设置快照隔离级别才能访问版本化行。” 您的第二个 ALTER DATABASE 命令将 READ_COMMITTED_SNAPSHOT 设置为 ON，因此代码不需要指定该 TransactionScope。

性能硬币有两个方面，每当人们寻求关于性能“足够”与“不足”的意见时：“供应”是平淡无奇或“需求”是压倒性的......对于这篇文章，“供应”可以指与 tempdb 使用的性能和空间有关，而“需求”可能与对 tempdb 的写入发生率有关。在供应方面，可以使用各种硬件（从单轴 5400 RPM 磁盘到 SSD 阵列）。在需求方面，这不是 SQL Server 问题（尽管未能正确规范数据库设计可能是一个因素），与其客户端代码问题一样多。

My SQL Server 看到客户端同时要求大约 50 次写入/分钟和 2000 次批处理/分钟，其中写入通常在 OTLP/短端。对于每个 SQL Server，我有 1 TB 的数据库和 30 GB 的 tempdb。所有数据库通常都归一化为第三范式。所有数据库都在 SSD 上运行。我不担心超过 tempdb 磁盘的 IO 吞吐能力。因此，我不必担心在我的系统上启用快照隔离。但是，我见过其他尝试启用快照隔离的系统，但很快就放弃了。

您的系统的体验可能与任何其他受访者的系统相差几个数量级。您应该寻求分析/可靠地重放系统的写入，以及重放 tempdb 的其他用途（包括排序），以便为您自己的系统得出您自己的结论（对于具有足够空间让您的系统产生的各种硬件） tempdb 大小）。负载测试不应该是事后的想法:)。您还应该对 tempdb 磁盘的 IO 吞吐能力进行基准测试 - 请参阅[https://technet.microsoft.com/library/Cc966412](https://technet.microsoft.com/library/Cc966412)，并准备好在其 IO 吞吐能力最终不足时花更多的钱。

# java - Java 等效于 javascript 中的 setInterval

> ID：652389
> 
> 赞同：14
> 
> 时间：2009-03-16T22:28:37.133
> 
> 标签：java, timing

基本上我希望每隔 10 毫秒调用一个函数。

我怎样才能在 Java 中实现这一点？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-16T22:32:11.883

您可能想看看[Timer](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Timer.html#scheduleAtFixedRate(java.util.TimerTask,%20long,%20long))。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-16T22:34:16.183

查看 java.util.Timer

[http://java.sun.com/javase/6/docs/api/java/util/Timer.html](http://java.sun.com/javase/6/docs/api/java/util/Timer.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T22:41:12.173

您还可以使用 ScheduleExecutorService。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T22:30:11.497

我会说您将创建一个线程并在线程循环中添加一个 System.sleep(10) 以使线程“休眠”10 毫秒，然后再继续。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-07-14T19:54:58.647

使用 ExecutorService

```
 ScheduledExecutorService es = Executors.newSingleThreadScheduledExecutor();
    es.scheduleAtFixedRate(() -> System.out.println("Hello World! from ScheduledExecutorService"), 10000, 10000, TimeUnit.MILLISECONDS);
    //es.shutdown(); 
```

或者通过使用定时器

```
 Timer timer = new Timer();
    timer.scheduleAtFixedRate(new TimerTask() {
        @Override
        public void run() {
            System.out.println("Hello World! from Timer");
        }
    }, 10000, 10000);
    //timer.cancel(); 
```

干杯!

# c# - 在 C# 中公开 DLL 的方法

> ID：652395
> 
> 赞同：5
> 
> 时间：2009-03-16T22:31:22.087
> 
> 标签：c#, dll, using-directives

在有人使用 Microsoft Visual 开发环境在 C# 中创建 DLL 后，其他程序员将如何获取该代码，创建一个包含 DLL 源的新项目并创建一个使用 DLL 的 API 的 GUI？

我已经完成了以下四个步骤：

1) 在解决方案资源管理器中，右键单击“参考”并选择“添加参考...”。

2) 选择“浏览”选项卡。

3) 导航到 DLL 并选择它。

4) 在代码顶部添加适当的“使用”指令。

接下来是什么？声明一个新对象后，如何查看要使用的方法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-16T22:33:33.157

查看菜单 -> 对象浏览器

您应该能够查看 DLL 中包含并公开公开的对象/方法等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T22:32:32.240

您应该能够像往常一样使用智能感知和对象资源管理器。如果没有来源，那将是您最好的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T22:34:29.957

我没有想到任何代码，但是您研究过反射库吗？你应该能够找出并运行你需要的一切......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T22:37:22.947

您可以通过 red-gate 中的 .NET Reflector 工具加载 DLL，并查看所有 api 甚至它是如何实现的[http://www.red-gate.com/products/reflector/](http://www.red-gate.com/products/reflector/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T22:33:48.290

好...

假设您的库名为 MyLib.DLL

你会这样做：

```
MyLib ml = new MyLib();
ml.YourMethodsShouldAppearHere(); //If they are public of course. 
```

;)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T22:37:12.930

[您可以在这个名为“ .NET Reflector](http://www.red-gate.com/products/reflector/) ”的第 3 方工具中打开任何 .NET DLL 。该工具将允许您查看所有类型/方法/属性，甚至可以反编译 DLL 中包含的代码。

.NET Reflector 类似于 Visual Studio 中的对象浏览器，但功能更强大。

如果您还没有尝试过 Reflector，我强烈推荐它（它真的很容易使用）！

# jquery - Silverlight 视频拉伸

> ID：652408
> 
> 赞同：2
> 
> 时间：2009-03-16T22:37:30.980
> 
> 标签：jquery, wpf, silverlight, xaml, silverlight-2.0

**我想要什么：** 当我拖动角落时，能够使用 JS 调整 SL 播放器中实际视频的大小。

**到目前为止我所拥有的：** [http](http://resopollution.com/granicus/silverlight_test/test_silverlight.html) ://resopollution.com/granicus/silverlight_test/test_silverlight.html （尝试拖动角落，它会裁剪视频，而不是调整视频大小）。我在这里使用 jquery 来动态调整外部 div 和 OBJECT 标记的大小...

XAML：

```
<UserControl
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
x:Class="VideoPlayer2.Page"
Width="640" Height="480">

<Grid x:Name="LayoutRoot" Background="#FF282828">
    <MediaElement Source="Bear.wmv" Stretch="Uniform"/>
</Grid> 
```

如果可以动态改变视频本身的实际大小，有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T22:46:39.367

您的用户控件具有预定义的宽度和高度，并且您的网格正在拉伸以填充它，而不考虑对象标签的大小。删除那些。

# python - 检查嵌套列表中是否存在值

> ID：652423
> 
> 赞同：2
> 
> 时间：2009-03-16T22:41:50.657
> 
> 标签：python

在我的清单中：

```
animals =  [ ['dog', ['bite'] ],
             ['cat', ['bite', 'scratch'] ],
             ['bird', ['peck', 'bite'] ], ]

add('bird', 'peck')
add('bird', 'screech')
add('turtle', 'hide') 
```

add 函数应该在将动物和动作添加到列表之前检查是否没有添加它们。有没有办法在不将每个步骤的循环嵌套到列表中的情况下实现这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T22:49:44.727

您使用了错误的数据类型。使用 a `dict`of `set`s 代替：

```
def add(key, value, userdict):
    userdict.setdefault(key, set())
    userdict[key].add(value) 
```

用法：

```
animaldict = {}
add('bird', 'peck', animaldict)
add('bird', 'screech', animaldict)
add('turtle', 'hide', animaldict) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T22:53:08.227

虽然可以构建一个通用函数，使用 a.index 或在动物中使用“狗”进行测试来查找列表中的动物，但您确实需要在这里有一个字典，否则随着添加更多动物，add 函数将大幅缩放：

```
animals = {'dog':set(['bite']),
           'cat':set(['bite', 'scratch'])} 
```

然后，您可以使用 setdefault“一次性”添加功能：

```
animals.setdefault('dog', set()).add('bite') 
```

如果它不存在，它将创建“狗”键，并且由于 setdefault 返回存在或刚刚创建的集合，因此您可以添加咬动作。集自动确保没有重复。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T22:58:03.083

基于递归的解决方案，在 Python 2.5 或更高版本中，您可以使用`defaultdict`该类，如下所示：

```
from collections import defaultdict

a = defaultdict(set)

def add(animal, behavior):
    a[animal].add(behavior)

add('bird', 'peck')
add('bird', 'screech')
add('turtle', 'hide') 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T22:52:15.920

```
animals_dict = dict(animals)

def add(key, action):
    animals_dict.setdefault(key, [])
    if action not in animals_dict[key]:
        animals_dict[key].append(action) 
```

（更新使用`setdefault`- 不错的@recursive）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T22:54:02.750

为此，您确实应该使用字典。或者一个类`Animal`。

你可以像这样改进你的代码：

```
if not any((animal[0] == "bird") for animal in animals):
    # append "bird" to animals 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T02:05:44.380

虽然我同意其他人的看法。您选择的数据结构，这里是您问题的答案：

```
def add(name, action):
    for animal in animals:
        if animal[0] == name:
            if action not in animal[1]:
                animal[1].append(action)
            return
    else:
        animals.append([name, [action]]) 
```

`for`循环是数据结构的必然结果，这就是为什么每个人都建议您考虑使用字典的原因。

# sql - 使用任意小数位数格式化 SQL 数值查询结果

> ID：652428
> 
> 赞同：3
> 
> 时间：2009-03-16T22:44:06.423
> 
> 标签：sql, sql-server, oracle, formatting, decimal

我有一个包含这两列的数据库表：

*   金额：数字（18,0）
*   DecimalPlaces：数字 (18,0)

该表可以存储各种货币的金额，从金额中删除小数位（我无法更改此数据模型）。例如，可能有两行这样的：

*   1290, 2（这是 12.90 英镑，需要显示为“12.90”）
*   3400, 0（这是3400日元，需要显示为“3400”）

我需要一个针对 Oracle 和 SQL Server 的 SQL 查询，它将使用正确的小数位数格式化每个金额，并保留任何尾随零，如上图所示。我不能使用存储过程、报告工具或 Excel。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T05:03:00.290

您的问题是，在一个查询中对 SQLServer 和 Oracle 都没有一种简单的方法来执行此操作。

对 SQLServer 执行此操作的正确方法是使用 STR：

```
Select STR(Amount, 18, DecimalPlaces) from myTable; 
```

对 Oracle 执行此操作的正确方法是使用 to_char：

```
SELECT to_char (amount, '99999999999999.'||rpad('',DecimalPlaces, '0')) 
from MyTable; 
```

jms 和 Andrew 提供的查询在 Oracle 查询中不起作用，因为 Oracle SQL 使用 LENGTH() 而不是 LEN()。Oracle 使用 to_char() 而不是 Cast()。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T22:48:46.040

到目前为止，我能想到的最好的是：

```
select Amount/power(10, DecimalPlaces) from MyTable 
```

但它并不完全符合我的要求：

*   **甲骨文**：尾随零被去除，所以 15.00 美元看起来像“15”，而不是“15.00”
*   **SQL Server**：添加了大量额外的尾随零，因此 $23.99 看起来像“23.99000000000”而不是“23.99”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T23:05:09.183

怎么样？

选择 12345 数量，2 个小数位，substr（to_char（12345），1，长度（to_char（12345））-2）|| '。' || substr( to_char( 12345 ), -2 ) 双重结果 /

```
 amount decimalPlaces result
 ---------- ------------- ------
     12345              2 123.45 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T23:49:00.263

这很严重，但适用于 SQL 服务器上的当前输入。

```
select 
    substring(
     CAST(
      CAST(
        (amount *  power(-0.100000000000000000,decimalPlaces*1.000000000000000000)) as numeric(36,18)
      )as varchar(30)
     )
    ,1,len(cast(amount as varchar(20))) + (CASE WHEN decimalPlaces = 0 THEN 0 ELSE 1 END )) 

from
 myTable 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T05:59:41.823

在 SQL 服务器中，您可以：

```
select stuff(convert(varchar,amount) ,
         len(convert(varchar,amount)) - DecimalPlaces - 1, 0, ".") 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T23:46:18.333

Martlark 对 Oracle 的回答让我想到了这个 SQL Server 解决方案：

```
select
  left(cast(Amount as varchar), len(cast(Amount as varchar)) - DecimalPlaces) +
  left('.', DecimalPlaces) +
  right(cast(OriginalCurrencyAmount as varchar), DecimalPlaces
) as FormattedAmount
from MyTable 
```

# xml - 体面的 KDE XML 查看器？

> ID：652429
> 
> 赞同：4
> 
> 时间：2009-03-16T22:45:13.973
> 
> 标签：xml, linux, kde

您在 KDE 中选择的 XML 查看器是什么？可以体面地格式化 XML 的东西。我四处寻找，但没有找到任何合理的东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T23:12:10.570

我只是在 Kate 中打开，如果格式有问题，请通过`xmllint --format`. 当然我激活了过滤器插件，所以它就在菜单中

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T03:08:25.227

(n)vi(m)

取决于您的系统以及是否需要语法突出显示:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T20:05:03.040

对于可视化编辑，请使用[Congolemerate](http://www.conglomerate.org/)或 Kxmleditor。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T22:47:22.437

你说的“体面”是什么意思？

我不太使用 XML，但 Firefox 可以满足我的需要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-23T15:32:29.500

我自己也经历了同样的事情，并没有为 KDE 找到好的选择。

然而！以下是一些其他选项：

*   有两个 Chrome 浏览器扩展

    1.  XV（我最喜欢的）在这里找到：[XV at chrome app store](https://chrome.google.com/webstore/detail/eeocglpgjdpaefaedpblffpeebgmgddk)。它具有预先折叠的源视图（可配置深度），以及大纲视图和 XPath 查询功能。
    2.  myXMLia 在这里找到：[myXMLia at chrome app store](https://chrome.google.com/webstore/detail/igmlklkcpaicipgblfckillahieebimf)。它有一个很好的 XML 网格视图，就像我猜一些高端查看器一样。
*   还有一个 windows 工具（带有 2008 年过时的 debian 包），其 windows 版本在 wine 下运行良好。它包括一个预先折叠的源视图、一个 XPath 查询功能、一个 XML 差异工具和一个非常酷的 XSLT 转换工具。

    *   在这里找到：[xmlTreeNav](http://freshmeat.net/projects/xmltreenav/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-11T19:56:29.653

查看 xmls 跨操作系统的快速通用解决方案可能是这个[web 应用程序](http://view.xmlgrid.net/)。它在每个浏览器上运行（至少他们声称如此）。您只需复制并粘贴 xml 并单击提交以将其显示在树视图中。

# c# - 比较已编译的 .NET 程序集？

> ID：652432
> 
> 赞同：51
> 
> 时间：2009-03-16T22:46:13.690
> 
> 标签：c#, .net, vb.net, debugging, reverse-engineering

有没有什么好的程序可以用来比较编译 .NET 程序集？

例如，我有 HelloWorld.dll (1.0.0.0) 和 HelloWorld.dll (2.0.0.0)，我想比较差异我该怎么做？

我知道我可以使用 .NET Reflector 并使用 Assembly Diff 插件。有没有其他好的工具可以做到这一点？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-03-16T23:00:53.873

[比较 .NET 程序集的方法](http://immitev.blogspot.com/2008/10/ways-to-compare-net-assemblies.html)建议

商业的：

*   [依赖](http://www.ndepend.com/)

自由：

*   [JustAssembly](http://www.telerik.com/justassembly)（仅显示 API 的差异）
*   [位差](https://github.com/grennis/bitdiffer)（相同）
*   [Reflector Diff Add-in](http://www.codingsanity.com/diff.htm)（您已经发现，但不再可用）

* * *

Beyond Compare（商业）等现有的比较工具可以通过特殊配置来做到这一点。以下是如何为 Beyond Compare 执行此操作：

*   前往`Tools`→`Options`
*   点击`New..`，选择“文本格式”，点击`OK`
*   给它一个名字（比如，EXE 或 DLL），并将掩码指定为`*.exe`或`*.dll`
*   单击选项卡`Conversion`并选择“外部程序（Unicode 文件名）”
*   在“加载”下，指定路径`ildasm`并添加 `%s /OUT:%t /NOBAR`（即`C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin\NETFX 4.8 Tools\ildasm.exe %s /OUT:%t /NOBAR`：）
*   请务必检查`disable editing`。
*   点击`Save`，然后`Close`
*   重启BC，打开两个`exe`文件进行比较，现在应该会`ilasm`自动反编译成。

您还可以为这种新格式添加语法突出显示。我计划将语法文件发送给他们，以便[共享](https://www.scootersoftware.com/download.php?zz=kb_moreformatsv3)。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-16T22:59:32.283

两种方式。

您可以使用经典工具进行 ILDASM 和 diff。

或者您可以使用 NDepends，这将花费该功能。

[片断 C# 臃肿..]

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-07-20T22:09:11.327

我只需要比较同一个 DLL 的两个版本，它们具有相同的版本（我需要实现一个小修补程序，并将 DLL 部署到生产环境中，但我想确保没有其他更改泄漏到代码中）。理想情况下，我希望 Assemby Diff 加载项向我展示差异，但它不起作用（它认为我正在将 DLL 与自身进行比较）。所以这就是我所做的：

*   创建了两个文件夹来保存反汇编的源文件。
*   使用**Reflector**的**导出**选项（从上下文菜单中）从上一步创建的文件夹中的每个 DLL 生成源文件。
*   使用免费的[**DiffMerge**](http://www.sourcegear.com/diffmerge/)工具比较两个目录；这些工具向我展示了修改后的文件和不同之处。

这有点笨拙，但似乎有效。不过，我希望 Assembly Diff 插件能够正常工作。

更新：Assembly Diff 插件的最新版本应该解决比较同一程序集的两个版本的问题。试试看。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-08-28T14:15:24.750

[NDepend](http://www.NDepend.com)工具提供了许多功能来处理 .NET 代码差异。*免责声明：我是该工具的开发人员之一*。

**Search by Change**面板专门用于浏览程序集代码差异。请注意：

*   您可以插入 NDepend 菜单使用的任何代码差异工具*比较源文件的旧版本和新版本*
*   如果您没有源代码，只有原始程序集，则可以选择*使用 Reflector 反汇编比较旧和新版本*

![NDepend 按差异面板搜索](https://i.stack.imgur.com/UaRuf.png)

另请注意，在屏幕截图中生成了一个[CQLinq 代码查询](http://www.ndepend.com/Features.aspx#CQL)来浏览差异。

```
from m in Application.Methods 
where m.CodeWasChanged() 
select new { m, m.NbLinesOfCode } 
```

默认情况下提出了许多其他默认差异查询和规则，这将使您能够以智能的方式浏览 .NET 代码差异。

*   [过去 100% 覆盖但不再覆盖的类型](http://www.ndepend.com/DefaultRules/webframe.html?Q_Types_that_used_to_be_100__covered_but_not_anymore.html)
*   [API 重大更改：方法](http://www.ndepend.com/DefaultRules/webframe.html?Q_API_Breaking_Changes__Methods.html)
*   [避免使复杂的方法更加复杂](http://www.ndepend.com/DefaultRules/webframe.html?Q_Avoid_making_complex_methods_even_more_complex_%28Source_CC%29.html)
*   [避免通过类型测试降低代码覆盖率](http://www.ndepend.com/DefaultRules/webframe.html?Q_Avoid_decreasing_code_coverage_by_tests_of_types.html)
*   [从现在开始，所有添加或重构的类型都应该尊重基本的质量原则](http://www.ndepend.com/DefaultRules/webframe.html?Q_From_now,_all_types_added_or_refactored_should_respect_basic_quality_principles.html)
*   [避免将不可变类型转换为可变类型](http://www.ndepend.com/DefaultRules/webframe.html?Q_Avoid_transforming_an_immutable_type_into_a_mutable_one.html)
*   [启发式查找从一个命名空间或程序集移动到另一个的类型](http://www.ndepend.com/DefaultRules/webframe.html?Q_Heuristic_to_find_types_moved_from_one_namespace_or_assembly_to_another.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-08-08T11:43:12.117

另一种选择是来自 Microsoft的[LibCheck 。](http://www.microsoft.com/en-us/download/details.aspx?id=11287)

用于获取公共 API 差异的相当古老的控制台工具。如果不调试并重新定位到更新的 .net 版本，我就无法运行。但是，它给了我非常清晰的输出，我稍后会使用它。

这是[一篇](https://www.safaribooksonline.com/library/view/windows-developer-power/0596527543/ch04s05.html)带有屏幕截图的文章。

* * *

## 回答 #6

> 赞同：-11
> 
> 时间：2009-03-16T23:01:14.230

Java 有一个不错的：[Semantic Diff Utilities](https://stackoverflow.com/questions/523307/semantic-diff-utilities/)

# php - 使用 Magento 的 addFieldToFilter 按现有列过滤

> ID：652435
> 
> 赞同：2
> 
> 时间：2009-03-16T22:48:08.223
> 
> 标签：php, orm, magento, entity-attribute-value

假设情况。我想`sales/order`用 grand_total 等于`total_paid`. 我知道我可以使用`addFieldToFilter`特定值进行过滤，但是否可以使用此方法按其他数据库值进行过滤。如果没有，Magento 系统中是否有任何数据访问对象允许这样做。

```
$orders = Mage::getModel('sales/order');
$orders = $orders->getCollection();
$orders->addFieldToFilter('total_paid',Array('eq'=>30));  //would find all the orders that were 30 
//syntax to find all the orders whose total_paid value is equal to it's grand_total attribute
//???????? 
```

`non-eav`我掌握的SQL 概念是：

```
SELECT * FROM Orders o WHERE o.total_paid = o.grand_total 
```

这是否可以纯粹通过对象方法调用来完成，还是我需要进行加载后过滤？

其他系统如何`ORM`处理这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T12:03:06.653

我一直在等待一个明确的答案，但既然什么都没有出现，我不妨分享一下我发现的东西。我跟踪了 addFieldToFilter ，显然你使用的每个值都被引用了，所以你不能通过使用列的名称来真正“破解”它。事实上，我没有看到任何方法可以做到这一点，至少在这个班级中没有。

实际上，我认为您至少现在需要进行加载后过滤。这当然是低效代码的定义，但是如果计算效率是一个优先事项，那么你一开始就不会使用 Magento ......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-08T21:29:04.310

只需要在我的一个项目中解决这个问题，并在寻找更好的解决方案时遇到了这个问题。我的黑客看起来像这样：

```
$orders = Mage::getModel('sales/order')->getCollection();
$orders->getSelect()
       ->where('total_paid=grand_total'); 
```

Magento 的 ORM 忽略了数据库的这种基本功能，这让我很恼火。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-04-22T05:52:28.853

有一个“礼貌”的解决方法。请参阅下面我尝试过滤 where 的示例`created_at <= expire_at`。

```
Mage::getSingleton('foo/bar')->getCollection()
            ->addExpressionFieldToSelect('expired', '(created_at >= expire_at)', ['created_at' , 'expire_at'])
            ->addFilter('(created_at >= expire_at)', 0) 
```

这很愚蠢，但仍然使用类解决了问题。

PS：我希望在发布这个问题 11 年后你已经解决了这个问题。:D（开个玩笑。我喜欢你的工作。）

# c# - 将调试符号更改为无是否会提高 VS 编译项目的性能？

> ID：652442
> 
> 赞同：0
> 
> 时间：2009-03-16T22:50:59.573
> 
> 标签：c#, debugging, compilation, project

将调试符号更改为无是否会提高 VS 编译项目的性能？

发布模式的默认值为“pdb-only”。

如果我将其更改为无会有任何不利影响吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T22:54:40.550

不，生成 PDB 对可执行文件的性能没有任何影响。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-16T22:54:14.747

是的，因为 pdb 不会被加载到内存中，但有关更多详细信息，请查看此[链接](http://weblogs.asp.net/scottgu/archive/2006/04/11/Don_1920_t-run-production-ASP.NET-Applications-with-debug_3D001D20_true_1D20_-enabled.aspx)

# python - 在 Google App Engine 中分离模型和请求处理程序

> ID：652449
> 
> 赞同：2
> 
> 时间：2009-03-16T22:55:07.397
> 
> 标签：python, google-app-engine, model

我想将我的模型移动到一个单独的目录，类似于使用 Rails 来减少代码混乱的方式。有什么方法可以轻松做到这一点？

谢谢，科林

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T22:59:44.203

我假设您使用的是基本的 webkit，而不是 Django 或其他花哨的东西。在这种情况下，只需创建一个名为 models 的子目录。将您用于模型的任何 python 文件放在此处。在此文件夹中创建一个名为 __init__.py 的空白文件。

然后在你的 main.py 或“控制器”或你有什么，放：

```
import models 
```

在顶部。

您刚刚创建了一个[python 包](http://docs.python.org/tutorial/modules.html#packages)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-14T14:37:44.700

布兰登的回答就是我所做的。此外，我更喜欢 Rails 的每个文件一个模型的自定义。我并不完全坚持它，但这是我的基本模式，特别是因为 Python 倾向于鼓励比 Ruby 更多但更简单的代码行。

所以我所做的就是让模型也成为一个包：

```
models/
models/__init__.py
models/user.py
models/item.py
models/blog_post.py 
```

在主要的 .py 文件中，我放置了我的基本类定义，可能还有一些辅助函数（Python 的模块系统使快速辅助函数与类定义耦合更加安全）。我`__init__.py`把它们缝合在一起：

```
"""The application models"""
from user import User
from item import Item
from blog_post import BlogPost 
```

这有点多余，但我对命名空间有很多控制权。

# c# - 当 DataSet 中的项目可能为空时，如何正确转换它？

> ID：652456
> 
> 赞同：4
> 
> 时间：2009-03-16T22:58:42.613
> 
> 标签：c#, casting, null, dataset

我有一个存储过程返回的数据集，其中一个项目可能为空。我正在尝试将数据集中的每一行转换为强类型对象，但我似乎无法正确转换空值。

我已经创建了我的场景模型，如下所示：

```
DataSet ds = new DataSet();
ds.Tables.Add(new DataTable());
ds.Tables[0].Columns.Add("Name", typeof(string));
ds.Tables[0].Columns.Add("Amount", typeof(decimal));
ds.Tables[0].Rows.Add("My Name Here", null); //create row with a null item

DataRow dataRow = ds.Tables[0].Rows[0];

Person p = new Person
{ 
    Name = (string)dataRow["Name"], 
    Amount = (decimal)dataRow["Amount"]
} 
```

不幸的是，我遇到了以下异常：`System.InvalidCastException: Specified cast is not valid.`

如果我尝试使用可为空的类型（十进制？），我会收到此错误：`System.NotSupportedException: DataSet does not support System.Nullable<>.`

在调试器中，我对 dataRow["Amount"] 中的值进行了以下测试：

```
dataRow["Amount"] is decimal (false)
dataRow["Amount"] is decimal? (false)
dataRow["Amount"] == null (false)
dataRow["Amount"] is object (true) 
```

我所能确定的是它是某种对象......这并不是特别有用。

你们中的任何人都可以发现我做错了什么吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T23:05:07.777

您可以使用`dataRow.IsNull("Amount")`或`Convert.IsDBNull(dataRow["Amount"])`或`(dataRow["Amount"] as Decimal) != null`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T23:04:16.143

您还可以检查数据库是否返回 Null，如下所示：

```
if (dataRow["Amount"] is System.DBNull.Value) 
```

这应该使您能够在尝试强制转换之前检查该值以避免该错误消息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T23:15:43.243

您是否尝试过使用 decimal.TryParse？

如：

```
decimal result;

if (decimal.TryParse(dataRow["Amount"].ToString(), out result))
{
//do something
} 
```

# ios - AppDelegate 的用途是什么，我如何知道何时使用它？

> ID：652460
> 
> 赞同：151
> 
> 时间：2009-03-16T23:00:54.793
> 
> 标签：ios, objective-c, cocoa-touch

我刚刚开始使用 iPhone 应用程序。我怎么知道什么时候应该把东西放在 AppDelegate 和自定义类中？是否存在与另一种编程语言（如 Python 或 PHP）使用 AppDelegate 类似模式的规则或任何类型的类比？

* * *

## 回答 #1

> 赞同：265
> 
> 时间：2009-03-17T07:40:10.597

我通常会避免 Andrew 使用“应用程序的核心”一词所暗示的设计方法。我的意思是，我认为您应该避免将太多东西集中在一个中心位置——好的程序设计通常涉及按“关注区域”分离功能。

委托对象是当它所连接的对象达到某些事件或状态时收到通知的对象。在这种情况下，Application Delegate 是一个在 UIApplication 对象达到特定状态时接收通知的对象。在许多方面，它是一种专门的一对一观察者模式。

这意味着 AppDelegate 的“关注领域”正在处理特殊的 UIApplication 状态。其中最重要的是：

*   applicationDidFinishLaunching: - 适合处理启动配置和构建
*   applicationWillTerminate: - 适合最后清理

您应该避免将其他功能放在 AppDelegate 中，因为它们并不真正属于那里。此类其他功能包括：

*   文档数据——你应该有一个文档管理器单例（用于多个文档应用程序）或一个文档单例（用于单个文档应用程序）
*   按钮/表格/视图控制器、视图委托方法或其他视图处理（除了在 applicationDidFinishLaunching 中构建顶级视图：）——这项工作应该在各自的视图控制器类中。

许多人将这些东西混入他们的 AppDelegate 是因为他们很懒，或者他们认为 AppDelegate 控制着整个程序。你应该避免集中在你的 AppDelegate 中，因为它混淆了应用程序中的关注区域并且无法扩展。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-03-16T23:14:04.730

您的应用程序委托是您的应用程序的核心。它实际上是您的“程序控制器”。

Application Delegate 是接收应用程序级消息的类，包括最常用于启动其他视图创建的 applicationDidFinishLaunching 消息。

虽然不完全相似，但您可以将其视为 Cocoa 程序的“main()”例程。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-01-27T18:01:12.713

@Shivam，谢谢。

据我了解，与 Android 中`appDelegate`的 an 很接近。`Application`,可以媲美 Android 的 Lifecycle `viewDidLoad`。`viewDidDisappear`每个应用程序都有一个生命周期，从启动到来电中断，再到显示通知。如果您需要您的代码在这些事件发生时做一些特别的事情，`system`那么您需要编写方法代码。

在 Android 中，我们使用`onPause`, `onDestroy`, `onCreate`kinda 回调方法来处理此类系统事件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-02-10T10:44:31.567

希望这会有所帮助...

刚接触这种语言的程序员总是有同样的问题——程序是从 main 方法开始的吗？是的，在这种情况下你是对的；IOS 应用程序也是从一个 main 方法开始的。
您的主类调用以下函数：

```
 UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); 
```

UIApplicationMain 启动 Cocoa Touch 运行循环和创建`UIApplication`对象的应用程序基础结构。我们的应用程序需要内容，因此objective-c 使用委托来处理它。这就是为什么我们称它为 AppDelegate（充当 的代表`UIApplication`）。我们实现了该委托的一些可选方法，并且它的行为相应。

# iis - 在 IIS 7.0 和 win2k8 中有多少个不同的地方要设置日期格式

> ID：652465
> 
> 赞同：2
> 
> 时间：2009-03-16T23:03:24.227
> 
> 标签：iis, iis-7, asp-classic, windows-server-2008

我正在尝试使用 win2k8 将旧的经典 asp 应用程序迁移到 IIS 7.0，如果我能提供帮助，我肯定不想更改旧代码。

我在控制面板的区域和语言选项中的日期格式和语言选项中的自定义区域选项中设置了日期格式为 dd-MMM-yy。

即使在重新启动后，我仍然使用此日期格式收到 Conversion_failed_when_converting_datetime_from_character_string 错误。

我也在使用 SQL Server Express 2005。

您还需要在哪里设置日期格式？它们都应该从机器设置中提取吗？

旧代码做了一些非常愚蠢的事情，但我不想再次更改它然后再次测试它。

旧代码有效地执行此“插入MyTable（ThisDate）值（'”＆Now（）＆“'）”

生成插入 MyTable (ThisDate) 值（'17/03/2009 3:40:48 pm'）

消息 241，级别 16，状态 1，第 1 行从字符串转换日期时间时转换失败。

它实际上抱怨的是字符串的“pm”部分，尽管机器上的区域设置指定不使用它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-01-17T10:30:30.663

This is a very annoying problem which comes from installing Server 2008 with a different region setting to what you ultimately want to use.

Typically this problem arises where the Server is set to USA and the user then subsequently sets the location to UK. Then when the code is executed it returns 1/17/2012 instead of 17/1/2012 and yes SQL Server may return errors like "Conversion_failed_when_converting_datetime_from_character_string".

The problem is that the IUSR account has its own region setting and it's this setting that the server uses when executing classic ASP. This is what you have to do to fix it...

Open the Region and Language options from the Control Panel. You should see the "Administrative" tab, click on Copy Settings. Make sure that the settings listed under 'Current User' are those that you want replicated, if they're not then backtrack to the keyboard layout etc and set them. Tick the box 'Welcome screen and system accounts' and then OK. Reboot.

Now it should work.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T01:02:07.013

对于任何关注区域设置的应用程序，您只需设置一个位置，并且您已经在那里设置了它。

“ `Conversion_failed_when_converting_datetime_from_character_string`”是什么来的？VB脚本？也许它不注意区域设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-20T20:38:09.133

您所要做的就是将 .Net 全球化部分中的文化设置更改为您所在的国家/地区，它应该可以解决它。

# c# - Silverlight 以编程方式选择文本

> ID：652467
> 
> 赞同：1
> 
> 时间：2009-03-16T23:04:05.940
> 
> 标签：c#, silverlight

我正在使用具有 TextBox 和 Button 的 Silverlight 控件。当我单击按钮（在下面调用 SelectText）时，我想选择文本框中的所有文本。

这是我的代码：

```
 private void SelectText()
    {
        TextBox tb = this.txtFirstName;
        tb.SelectionStart = 0;
        tb.SelectionLength = 3;
        // tb.Select(0, this.txtFirstName.Text.Trim().Length - 1);
        // tb.SelectAll();
        // tb.Text = String.Empty;
    } 
```

注释代码是我已经尝试过的，但都没有工作。

有人对我做错了什么有建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T23:53:16.057

您可能需要将焦点放在文本框上以查看发生的实际选择（在选择之前或之后，这可能无关紧要，但您必须尝试）：

```
private void SelectText()
    {
        TextBox tb = this.txtFirstName;
        tb.SelectionStart = 0;
        tb.SelectionLength = 3;
        // tb.Select(0, this.txtFirstName.Text.Trim().Length - 1);
        // tb.SelectAll();
        // tb.Text = String.Empty;
        tb.Focus();
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T23:07:13.670

SelectAll() 有效——我不止一次使用过它。发生此方法后是否有东西在操纵文本框？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-10T00:14:41.743

这对整个用户控件有效。

```
public partial class MainPage : UserControl
{
    public MainPage()
    {
        InitializeComponent();
    }
    protected override void OnGotFocus(RoutedEventArgs e)
    {
        TextBox tb = e.OriginalSource as TextBox;
        if (tb != null)
            tb.SelectAll();
        base.OnGotFocus(e);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T06:08:06.937

焦点解决方案对我有用，但有时我在 SelectAll() 期间得到这个 ExecutionEngineException ，这完全是假的！即使是 try...catch 也不会阻止它，也没有关于该错误的更多详细信息。

# c# - 如何使用 C# 从 mpg 视频创建缩略图？

> ID：652476
> 
> 赞同：6
> 
> 时间：2009-03-16T23:06:09.197
> 
> 标签：c#, asp.net, thumbnails, mpeg

我想使用 C#/.NET 批量处理 mpg 的目录以生成缩略图。

有人对我如何做到这一点有任何好的建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T23:07:08.037

我知道这不是 C# .NET，但[ffmpeg](http://www.ffmpeg.org/)是一个很好的工具来做到这一点。可以作为任何语言的命令行工具运行。

[这是一个小教程](http://blog.jeffhaynie.us/extract-thumbnail-from-video.html)，可以帮助您入门。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T03:12:44.453

几年前我这样做了，但我似乎失去了来源。无论如何，我发现的最小阻力路线是使用 DirectShow，托管代码有一个互操作包装器，即[directshow.net](http://directshownet.sourceforge.net/about.html)。您需要使用来自[Windows Media Format SDK的](http://msdn.microsoft.com/en-us/library/dd407257(VS.85).aspx)[IMediaDet](http://msdn.microsoft.com/en-us/library/dd390180(VS.85).aspx)的[GetBitmapBits](http://msdn.microsoft.com/en-us/library/dd390182(VS.85).aspx)。

CodeProject上有一个例子：[Extract Frames from Video Files](http://69.10.233.10/KB/graphics/ExtractVideoFrames.aspx)

# mysql - 如何在 Mysql 中进行此查询？

> ID：652484
> 
> 赞同：1
> 
> 时间：2009-03-16T23:08:07.490
> 
> 标签：mysql, sql-match-all

我有 3 个表格、消息、主题和`message_subject_rel`. 这个想法是让消息与很多主题相关，然后进行跨主题搜索。

假设我有一条消息：

```
Id: 1, Message: This is a message 
```

2个科目：

```
Id:1, Subject: Math
Id:2, Subject: Science 
```

并且有 2`message_subject_rel`个条目：

```
Id: 1, message_id: 1, subject_id: 1
Id: 2, message_id: 1, subject_id: 2 
```

如果我想搜索与数学相关的消息，我会与 3 个表进行简单连接，where 子句将是 subject = "Math"

但我不知道该怎么做，就是搜索与数学和科学相关的消息。如果我做一个简单的连接，我会得到类似的表格：

```
id  message     user_id     created_at  ip  id  message_id  subject_id  id  subject 
```

如果我这样做，`where subject = "Math" and subject = "Science"`我不会得到任何结果，因为每条消息在每一行中只有一个相关的主题，但是对于超过 1 个主题的消息，重复的行。

那么，你有什么推荐的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T23:27:21.547

[这与从连接表过滤](https://stackoverflow.com/questions/648308/filtering-from-join-table/)基本相同的问题

我会根据这个问题调整我的答案。

**加入解决方案：**

```
SELECT m.*
FROM messages m
 JOIN message_subject_rel ms1 ON (m.id = ms1.message_id)
 JOIN subjects s1 ON (ms1.subject_id = s1.id AND s1.subject = 'Math')
 JOIN message_subject_rel ms2 ON (m.id = ms1.message_id)
 JOIN subjects s2 ON (ms2.subject_id = s2.id AND s2.subject = 'Science'); 
```

**分组解决方案：**

请注意，您需要在`GROUP BY`子句中列出所有 m.* 列，除非您使用 MySQL。

```
SELECT m.*
FROM messages m 
 JOIN message_subject_rel ms ON (m.id = ms.message_id)
 JOIN subjects s ON (ms.subject_id = s.id)
WHERE s.subject IN ('Math', 'Science'))
GROUP BY m.id, ...
HAVING COUNT(*) = 2; 
```

**子查询解决方案：**

```
SELECT m.*
FROM messages m
WHERE m.id = ANY (SELECT message_id 
                  FROM message_subject_rel ms JOIN subjects s 
                    ON (ms.subject_id = s.id) 
                  WHERE s.subject = 'Math')
  AND m.id = ANY (SELECT message_id 
                  FROM message_subject_rel ms JOIN subjects s 
                    ON (ms.subject_id = s.id) 
                  WHERE s.subject = 'Science'); 
```

**修改后的 GROUP BY 解决方案：**

通过隔离子查询中的搜索来简化 GROUP BY 子句。

```
SELECT m.*
FROM messages m
WHERE m.id IN (
  SELECT ms.message_id FROM message_subject_rel ms JOIN subjects s
    ON (ms.subject_id = s.id)
  WHERE s.subject IN ('Math', 'Science'))
  GROUP BY ms.message_id HAVING COUNT(*) = 2
); 
```

PS：你的表没有理由`message_subject_rel`需要一`ID`列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T23:11:57.823

在 where 子句中进行内部选择。

SELECT FROM [tables and joins] WHERE subject = "Math" AND message_id IN (SELECT message_id FROM [tables and joins] WHERE subject = "Science")

# performance - 主键顺序增加的性能

> ID：652485
> 
> 赞同：0
> 
> 时间：2009-03-16T23:09:18.190
> 
> 标签：performance, database-design, primary-key

寻找有关为特定密钥模式选择数据库提供程序的指导。

唯一的关键字段将是一个预先分配的唯一顺序递增的数字。每天将添加、处理（更新）50 到 100,000 个项目，然后保留一周左右，之后通常会删除编号最低的记录。记录的数量每天不会有很大的波动，但在周末可能会下降。在 100M 左右之后，这些数字可能会回到 1。

我需要找到一个数据库实现，其中索引查找、添加和删除的效率保持不变。我是否应该担心随着关键值范围不断向上移动，性能可能会下降？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T23:17:57.373

> 索引查找、添加和删除保持不变

您可以通过在每次插入时重建索引来确保它保持不变（只是一直非常慢 - 根本没有性能下降:)），或者通过每小时/每天运行一次索引维护等来接近恒定。

> 随着关键值范围不断向上移动，性能可能会下降？

只要您有一个索引，它就应该是 logN 性能——例如，拥有 1,000,000 行的速度大约是 1,000 行速度的一半（搜索索引值时）。（1,000,000,000,000 将再次是该速度的一半）。

所以不，你不应该担心性能。

> 在 100M 左右之后，这些数字可能会回到 1。

好的 - 如果你愿意。一般来说，真的不需要 - 只需使用一个大整数。

与性能一样：测试你想要做什么。编写一个插入 10,000,000 行的脚本，看看会发生什么。

我的观点是，如果您要将 id 包装在 100M 记录中，那么您能做的最糟糕的事情实际上就是将它们全部分配。这也将代表碎片索引条件（您只有 100K 记录，但它们分布在 10M 的空间中）-但是您*将*进行索引/数据库维护对吗？

# dynamic - JRXML 中的动态查询字符串

> ID：652486
> 
> 赞同：0
> 
> 时间：2009-03-16T23:10:24.800
> 
> 标签：dynamic, jasper-reports, query-string, report

我正在尝试构建一个足够智能的报告，可以根据某种输入参数稍微修改其 sql 查询。

例如，如果那个特殊的修改参数值为“1”，它会在 select 中添加一个字段并将 group by 子句添加到查询中。

我研究了 java 表达式，但 jrxml 的 queryString 标记似乎不支持它们。还尝试创建一个包含 java 表达式的变量，并在 queryString 标记中使用该变量......这也不起作用！

现在我正在考虑可能有一个包含所有逻辑的存储过程，并且只是让 jrxml 使用修改输入参数调用该存储过程，但是我正在处理的项目似乎没有大量存储proc，所以我想看看在我走这条路之前是否还有其他解决方案。

谢谢你的帮助。

* * *

谢谢各位大神帮忙，非常感谢。但是，我找到了另一种解决方法，并将其发布以供参考：[here](http://www.coderanch.com/t/435096/Other-Open-Source-Projects/RESOLVED-jasper-iReport-multi-reports)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T14:58:01.870

JasperDesign actually lets you modify portions of your jrxml document. So say you have a package "reports" where you store your report built either by hand or by a tool like iReport. As long as your query is defined in the tag `<queryString>` the following will work allowing you to change the query on the fly:

```
try {
    String fileName = getClass().getClassLoader().getResource("com/foo/myproject/reports/TestReport.jrxml").getFile();
    File theFile = new File(fileName);
    JasperDesign jasperDesign = JRXmlLoader.load(theFile);

    //Build a new query
    String theQuery = "SLECT * FROM myTable WHERE ...";

    // update the data query
    JRDesignQuery newQuery = new JRDesignQuery();
    newQuery.setText(theQuery);
    jasperDesign.setQuery(newQuery);

    JasperReport jasperReport = JasperCompileManager.compileReport(jasperDesign);
    Connection conn = MyDatabaseClass.getConnection();
    JasperPrint jasperPrint = JasperFillManager.fillReport(jasperReport, null, conn);
    JasperViewer.viewReport(jasperPrint);
} catch (Exception ex) {
    String connectMsg = "Could not create the report " + ex.getMessage() + " " + ex.getLocalizedMessage();
    System.out.println(connectMsg);
} 
```

With something like this you can create a member variable of your class that holds the new query and build it with whatever user constrains desired. Then at view time just modify the design.

-Jeff

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-27T13:01:32.527

JasperDesign helped me to solve the problem of building dynamic query on Jrxml file.

To build the Dynamic SQL, I was using the [Squiggle](http://joe.truemesh.com/squiggle/)(Google Code) to build the SQL dynamically. Thanks jeff

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T10:26:09.997

我已经使用存储过程完成了它，这些过程对这些东西来说很好。否则，您可能会切换到 Java。只需从数据库中获取数据并根据用户提供的参数对其进行过滤、分组并作为 bean 的集合发送到将进行渲染的 Jasper 报告。

# ruby-on-rails - Rails 中的外键损坏

> ID：652487
> 
> 赞同：1
> 
> 时间：2009-03-16T23:10:34.067
> 
> 标签：ruby-on-rails, activerecord

所以这是一个快速的问题。我正在使用带有庞大遗留数据库的 Rails，它有许多损坏的外键需要被视为 nil。

所以当我这样做时： Foo.find(:all, :conditions => {...}, :include => :bar)

Rails 使用 SELECT * FROM 条 WHERE id IN (...) 连接所有条。到目前为止一切顺利，只有两个 sql 查询。

现在的问题是，对于损坏的 fks，当我稍后尝试执行 foo.bar 时，Rails 会尝试使用 SELECT * FROM bars WHERE id = broken_id 重新获取 bar。然后它返回 nil （对我来说是正确的），但所有这些 SELECT id= 原来是一个主要的性能问题，因为它用太多的 sql 查询轰炸了 mysql。

有什么简单的方法可以检查 foo.bar 是否已经设置，并且不只是强制它为零？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T04:17:37.433

您可以使用该[`loaded?`](http://caboo.se/doc/classes/ActiveRecord/Associations/AssociationProxy.html#M006685)方法测试关联是否已加载：

```
foo.bar.loaded? 
```

如果您知道您使用`:include`并`foo.bar.loaded?`返回的事实，`false`那么您摔倒了一个损坏的 fkey，请跳过此`foo.bar`。

# jquery - jQuery 多事件处理程序 - 如何取消？

> ID：652495
> 
> 赞同：49
> 
> 时间：2009-03-16T23:13:25.060
> 
> 标签：jquery, event-handling, jquery-events

我有两个函数在两个不同时间绑定到单击事件（使用 jQuery）。他们被解雇的顺序很重要。他们以正确的顺序开火。问题是，当第一个函数返回 false 时，第二个函数仍在触发！

**如何正确取消活动？**

示例代码：

```
$(document).click(function() { 
  alert('a');
  return false;
});

$(document).click(function() {
  alert('b');
}); 
```

单击页面时，您仍然会看到“b”警报消息。这是无法接受的！

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-03-16T23:31:06.123

使用[`stopImmediatePropagation`](http://docs.jquery.com/Events/jQuery.Event#event.stopImmediatePropagation.28.29)jQuery 事件对象的功能。

> 阻止其余的处理程序被执行。此方法还通过调用 event.stopPropagation() 来停止冒泡。

```
$(document).click(function(event) { 
  alert('a');
  event.stopImmediatePropagation();
  return false;
});

$(document).click(function() {
  alert('b');
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T23:28:45.943

我要问的第一件事是：为什么你有**两个**函数绑定到同一个点击事件？可以访问代码，为什么不只打一个电话？

```
$(function (){
    var callbackOne = function(e){
        alert("I'm the first callback... Warning, I might return false!");
        return false;
    };

    var callbackTwo = function(e){
        alert("I'm the second callback");
    };

    $(document).click(function (e){
        if(callbackOne(e)){
            callbackTwo(e);
        }
    });
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-04T18:41:33.217

谢谢， unbind 适用于重新定义功能。

```
 $(document).ready(function(){
        $("#buscar_mercaderia").click(function(){ alert('Seleccione Tipo de mercaderia'); 
   });
$(".tipo").live('click',function(){
            if($(this).attr('checked')!=''){
                if($(this).val()=='libro'){
                    $("#buscar_mercaderia").unbind('click');
                    $("#buscar_mercaderia").click(function(){  window.open('buscar_libro.php','Buscar Libros', 'width=800,height=500'); });
                }else if($(this).val()=='otra'){
                    $("#buscar_mercaderia").unbind('click');
                    $("#buscar_mercaderia").click(function(){ window.open('buscar_mercaderia.php','Buscar Mercaderias', 'width=800,height=500');  });
                }
            }
        }) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T23:16:17.890

使用 unbind 有帮助吗？

```
$(document).click(function() { 
  alert('a');
  $(this).unbind('click');
  return false;
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T23:19:27.633

如果 nickf 所说的不起作用，您可以使用小型状态机：

```
var trigger = 0;

$(document).click(function() { 

  alert('a');
  if(you_want_to_return_false) {
    trigger = 1;
    return false;
  }
});

$(document).click(function() {
  if(trigger !== 0) {
  alert('b');
  } 
  trigger = 0;
}); 
```

不是最漂亮的解决方案，但它会起作用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-09-08T19:47:52.220

另一种解决方案是去抖动或限制函数。

通过这种方式，您可以确保尽管它多次触发，但它只在设定的持续时间内执行。这将允许您的代码按原样工作。

# flexbuilder - 如何在 Flex Builder 3 中执行自定义构建步骤？

> ID：652497
> 
> 赞同：0
> 
> 时间：2009-03-16T23:14:14.697
> 
> 标签：flexbuilder

我想在 Flex Builder 3 中做一些我会在 Visual Studio 中使用自定义构建步骤的事情。它们不在项目属性中，谷歌也没有太多帮助。

是否可以更一般地在 Flex Builder 3 或 Eclipse 中添加自定义构建步骤？如果是这样，我现在做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T23:41:48.190

[Flex 文档的 Advanced Build Options 部分](http://livedocs.adobe.com/flex/3/html/build_6.html#139360)表明您可以使用 Apache Ant 在 Flex Builder 中创建自定义构建器。

有关在 Eclipse 中使用 Ant 的更多信息，请参见[Simon Whatley 的博客](http://www.simonwhatley.co.uk/using-ant-with-eclipse)

# c++ - unix-fork-monitor-child-progress

> ID：652503
> 
> 赞同：3
> 
> 时间：2009-03-16T23:16:47.110
> 
> 标签：c++, unix, parallel-processing, fork

我有一个应用程序，其中一些并行处理会有所帮助。出于讨论的目的，假设有一个目录，其中包含 10 个文本文件，我想启动一个程序，该程序分叉 10 个进程，每个进程获取一个文件，并将文件内容大写。我承认父程序可以使用**等待**函数之一或使用**select**函数等待子程序完成。

我想做的是让父进程监视每个分叉进程的进度，并在进程运行时显示进度条之类的东西。

我的问题。

对于分叉的进程将这些信息传回给父进程，我有什么合理的替代方案？使用哪些 IPC 技术是合理的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T00:09:55.953

在这种只想监控进度的情况下，最简单的选择是使用共享内存。每个进程在共享内存块上更新它的进度值（例如整数），并且主进程定期读取该块。基本上，您不需要在此方案中进行任何锁定。此外，它是一个“轮询”风格的应用程序，因为主控器可以随时读取信息，因此您不需要任何事件处理来处理进度数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T21:58:05.210

如果您需要的唯一进展是“完成了多少工作？”，那么一个简单的

```
while (jobs_running) {
    pid = wait(&status);
    for (i = 0; i < num_jobs; i++)
        if (pid == jobs[i]) {
            jobs_running--;
            break;
        }
    printf("%i/%i\n", num_jobs - jobs_running, num_jobs);
} 
```

会做。为了在进行中报告进度，这里是其他一些建议的愚蠢实现。

管道：

```
#include <poll.h>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <unistd.h>

int child(int fd) {
    int i;
    struct timespec ts;
    for (i = 0; i < 100; i++) {
        write(fd, &i, sizeof(i));
        ts.tv_sec = 0;
        ts.tv_nsec = rand() % 512 * 1000000;
        nanosleep(&ts, NULL);
    }
    write(fd, &i, sizeof(i));
    exit(0);
}

int main() {
    int fds[10][2];
    int i, j, total, status[10] = {0};
    for (i = 0; i < 10; i++) {
        pipe(fds[i]);
        if (!fork())
            child(fds[i][1]);
    }
    for (total = 0; total < 1000; sleep(1)) {
        for (i = 0; i < 10; i++) {
            struct pollfd pfds = {fds[i][0], POLLIN};
            for (poll(&pfds, 1, 0); pfds.revents & POLLIN; poll(&pfds, 1, 0)) {
                read(fds[i][0], &status[i], sizeof(status[i]));
                for (total = j = 0; j < 10; j++)
                    total += status[j];
            }
        }
        printf("%i/1000\n", total);
    }
    return 0;
} 
```

共享内存：

```
#include <semaphore.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/mman.h>
#include <time.h>
#include <unistd.h>

int child(int *o, sem_t *sem) {
    int i;
    struct timespec ts;
    for (i = 0; i < 100; i++) {
        sem_wait(sem);
        *o = i;
        sem_post(sem);
        ts.tv_sec = 0;
        ts.tv_nsec = rand() % 512 * 1000000;
        nanosleep(&ts, NULL);
    }
    sem_wait(sem);
    *o = i;
    sem_post(sem);
    exit(0);
}

int main() {
    int i, j, size, total;
    void *page;
    int *status;
    sem_t *sems;
    size = sysconf(_SC_PAGESIZE);
    size = (10 * sizeof(*status) + 10 * sizeof(*sems) + size - 1) & size;
    page = mmap(0, size, PROT_READ|PROT_WRITE, MAP_SHARED|MAP_ANONYMOUS, -1, 0);
    status = page;
    sems = (void *)&status[10];
    for (i = 0; i < 10; i++) {
        status[i] = 0;
        sem_init(&sems[i], 1, 1);
        if (!fork())
            child(&status[i], &sems[i]);
    }
    for (total = 0; total < 1000; sleep(1)) {
        for (total = i = 0; i < 10; i++) {
            sem_wait(&sems[i]);
            total += status[i];
            sem_post(&sems[i]);
        }
        printf("%i/1000\n", total);
    }
    return 0;
} 
```

为清楚起见，省略了错误处理等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T23:22:58.577

一些选项（不知道哪个，如果有的话，会适合你——很大程度上取决于你实际在做什么，与“大写文件”的类比相反）：

*   信号
*   fifos / 命名管道
*   孩子的 STDOUT 或其他传递的句柄
*   消息队列（如果适用）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T01:33:57.873

如果您想要的只是进度更新，那么到目前为止最简单的方法可能是使用匿名管道。pipe(2) 调用将为您提供两个文件描述符，一个用于管道的每一端。在你 fork 之前调用它，让父母听第一个 fd，孩子写第二个。（这是有效的，因为文件描述符和包含它们的双元素数组都是在进程之间共享的——本身不是共享内存，但它是写时复制，所以除非你覆盖它们，否则它们共享值。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T23:20:26.463

就在今天早些时候，有人告诉我他们总是使用管道，子进程可以通过管道向父进程发送一切进展顺利的通知。这似乎是一个不错的解决方案，并且在您想要打印错误但不再能够访问 stdout/stderr 等的地方特别有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T01:26:23.507

[Boost.MPI](http://www.boost.org/doc/html/mpi.html)在这种情况下应该很有用。您可能会认为它矫枉过正，但绝对值得研究：
www.boost.org/doc/html/mpi.html

# .net - .NET 文化变革事件？

> ID：652505
> 
> 赞同：5
> 
> 时间：2009-03-16T23:18:54.140
> 
> 标签：.net, culture

我有一个 .NET 自定义控件，它以与文化相关的方式显示信息。为了提高性能，我在控件中缓存了一些信息，而不是每次都生成它。我需要知道文化是否发生了变化，以便我可以适当地重新生成这些内部信息。

我有什么活动吗？还是我每次绘画时都必须测试文化设置以查看它是否发生了变化？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T11:48:37.507

您可以处理[`SystemEvents.UserPreferenceChanged`](https://msdn.microsoft.com/en-us/library/microsoft.win32.systemevents.userpreferencechanged(v=vs.110).aspx)事件：

```
SystemEvents.UserPreferenceChanged += (sender, e) => 
{
    // Regional settings have changed
    if (e.Category == UserPreferenceCategory.Locale)
    {
        // .NET also caches culture settings, so clear them
        CultureInfo.CurrentCulture.ClearCachedData();

        // do some other stuff
    }
}; 
```

Windows 还将[`WM_SETTINGSCHANGE`消息](https://msdn.microsoft.com/en-us/library/windows/desktop/ms725497(v=vs.85).aspx)广播到所有窗体。您可以尝试通过覆盖 WndProc 来检测它，所以它看起来像：

```
// inside a winforms Form
protected override void WndProc(ref Message m)
{
    const int WM_SETTINGCHANGE = 0x001A;

    if (m.Msg == WM_SETTINGCHANGE)
    {
        // .NET also caches culture settings, so clear them
        CultureInfo.CurrentCulture.ClearCachedData();

        // do some other stuff
    }

    base.WndProc(ref m);
} 
```

请注意，您可能还想调用[`CultureInfo.CurrentCulture.ClearCachedData()`](https://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.clearcacheddata(v=vs.110).aspx)以使新创建的线程的文化信息无效，但请记住，`CurrentCulture`现有线程不会被更新，如 MSDN 中所述：

> 该`ClearCachedData`方法不会**刷新**现有`Thread.CurrentCulture`线程的属性中的信息。但是，未来的线程将具有新的`CultureInfo`属性值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T23:47:28.800

我怀疑你可以通过让你的代码通过一个中心属性来改变文化来做到这一点，该属性*本身*会做一些事情，比如引发一个事件；但要非常小心：静态事件是一种非常简单的方法，可以让*大量*对象卡在内存中（即 GC 将它们视为活动的）。如果你采用这种方法，你可能想看看`WeakReference`......

# java - 选择时JTable没有更新

> ID：652507
> 
> 赞同：2
> 
> 时间：2009-03-16T23:19:12.393
> 
> 标签：java, jtable

当我在 JTable 中选择一行时，我的 JTable 不再更新。当我不选择一行时，下面的代码按预期工作。一行被添加到 JTable。

```
 @Override
public void update (Observable arg0, Object arg1)
{
    if (arg0 instanceof Logger)
    {
        LogItem last = systemController.logController.getLog().getLastLogItem();
        this.history.add(last);
        this.logTableModel.addItem(last);

        this.logTable.tableChanged(new TableModelEvent(this.logTableModel));
        ((DefaultTableModel)this.logTable.getModel()).fireTableStructureChanged();
        this.logTable.repaint();
        this.logTable.doLayout();
    }

} 
```

当我关闭窗口并重新打开它时，我可以看到新行。

有人能解释一下为什么在选择一行后，我在 JTable 中看不到任何更新吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T23:33:44.450

您的代码存在许多问题。您不应该调用 fireTableStructureChanged，因为这与表结构（列数等）相关，而不是表数据本身（添加行、更改单元格值等）。此外，您不需要在表本身上调用 repaint 和 doLayout，因为这应该由模型更改触发。

我认为您应该查看 Java 教程中的[How to Use Tables](http://java.sun.com/docs/books/tutorial/uiswing/components/table.html)，特别是查看使用表模型、侦听数据更改和触发数据更改事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T23:38:35.013

update() 调用是否发生在 Swing 事件线程中？如果不是，代码将需要用类似的东西包装：

```
SwingUtilities.invokeLater(new Runnable() { public void run() {
  logTableModel.addItem(last);
}}); 
```

# apache-flex - 将 FlexBuilder 中 Flex 使用的网络服务器更改为 .NET Framework 3.5

> ID：652510
> 
> 赞同：0
> 
> 时间：2009-03-16T23:20:11.377
> 
> 标签：apache-flex, flexbuilder, webdev.webserver

我只需要重新格式化并重新安装 Flex 并重建一个项目。

问题是我使用 ASP.NET 作为我的服务器端技术并在我的文件中使用 LINQ。`WebDev.Webserver.exe`FlexBuilder 启动的版本是错误的版本，所以我收到此错误：

> 编译器错误消息：CS0234：命名空间“System”中不存在类型或命名空间名称“Linq”（您是否缺少程序集引用？）
> 
> Microsoft (R) Visual C# 2005 编译器版本 8.00.50727.3053，适用于 Microsoft (R) Windows (R) 2005 Framework 版本 2.0.50727 版权所有 (C) Microsoft Corporation 2001-2005。版权所有。

我知道更改为最新版本的 ASP.NET / Framework 将解决此问题 - 但我只是不知道如何在 Flexbuilder 中进行更改。我什至不记得我以前是否成功过，或者我只是在 IIS7 中创建了一个虚拟目录。

我会在哪里更改版本？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T04:37:27.790

原来我只`web.config`设置了一个非常小的文件。

```
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <directoryBrowse enabled="true" />
    </system.webServer>
</configuration> 
```

一旦我在 Visual Studio 中打开项目（我还没有这样做） - 它会将 web.config 升级到那些非常长的项目之一，然后使用 3.5 框架。我不必在 Flex 环境中进行任何更改。

# c# - 您认为泛型属性在 .NET 中有用吗？

> ID：652512
> 
> 赞同：7
> 
> 时间：2009-03-16T23:21:14.480
> 
> 标签：c#, .net, generics, c#-3.0, properties

我不是在谈论使用泛型参数类型声明属性或字段的泛型类。我说的是可以应用于泛型和非泛型类的泛型属性。

我不是在谈论这个：

```
public class Base<T>
{
    public T BaseProperty { get; set; }
} 
```

我说的是这个：

```
public class Base
{
    public T BaseProperty<T>
    {
       get
       {
          // Insert magic
       }
       set
       {
          // Insert magic
       }
    }
} 
```

或这个：

```
public class Base<U>
{
    public T BaseProperty<T>
    {
       get
       {
          // Insert magic
       }
       set
       {
          // Insert magic
       }
    }

    public U OtherBaseProperty { get; set; }
} 
```

用法会是这样的：

```
var b = new Base();
b.BaseProperty<int> = 42;
int i = b.BaseProperty<int>;
b.BaseProperty<string> = "Hi";
string s = b.BaseProperty<string>; 
```

或者对于第二个例子：

```
var b = new Base<string>();
b.BaseProperty<int> = 42;
int i = b.BaseProperty<int>;
b.OtherBaseProperty = "Hi";
string s = b.OtherBaseProperty; 
```

// Insert Magic 指的是处理对类型参数具有不同类型的通用属性 getter 或 setter 的每次调用。

例如这个：

```
b.BaseProperty<int> = 42; 
```

需要区别对待：

```
b.BaseProperty<string> = "Hi"; 
```

我设想，对于每种类型 T，如果在调用 setter 之前调用 getter，则返回 default(T)。当 setter 被调用时，该值按类型 T 存储，以便在随后调用 getter 时返回为该类型设置的先前值。

请注意，属性只是方法。

**你认为这会有用吗？**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-16T23:47:17.723

有几次我希望能够做到这一点，是的。

但是，所涉及的语法会非常难看，而且它很少有用，我认为我宁愿把它吸起来并使用通用方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T23:26:33.483

不 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T23:29:03.353

没有杀手级用例，不。如果需要，您已经可以使用一对通用方法实现相同的目标。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T23:49:31.930

不。

泛型方法是有意义的，因为它们体现了一些可以合理地应用于不同类型的（泛型）操作。

但是属性只有作为具有明确内容的唯一命名值才有意义。正如您所建议的那样，“通用属性”实际上仅相当于具有不同签名和不同内容的同名属性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T23:54:08.160

如果可能的话，这是一个对我来说很方便的例子。

```
var settings = new Settings();  
int timeout = settings<int>["CacheInMinutes"]; 
```

Settings 加载配置变量的 XML 文件的位置。

与以下相比：

```
var settings = new Settings();  
int timeout = int.Parse(settings["CacheInMinutes"]); 
```

真的没有太大区别，但是，嘿，我仍然更喜欢通用索引器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-04-13T05:09:32.493

好吧，我有需要在非泛型类中使用泛型属性的情况。

例如，您有一个`IComponent`类想要为其父级提供`IContainer`property `Parent`，因为该组件可以属于任何容器类型。所以你需要提供泛型属性而不是泛型方法

```
Component c = new Component();
Container p = new Container();
p.Add(c); 
```

然后您使用通用属性访问其父级（现在不适用）

```
c.Parent.ContainerProperty;
c.Parent.ContainerMethod(); 
```

而是使用详细的方法，例如

```
c.Parent().ContainerProperty;
c.Parent().ContainerMethod(); 
```

好吧，在这种情况下，通用属性更漂亮也更有意义，因为您不需要输入任何参数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T23:42:01.870

如果出于某种奇怪的原因你决定想要它，你可以用一些方法来伪造它：

```
public class Thing
{
    Dictionary<Type, object> xDict = new Dictionary<Type,object>();
    public void set_X<T>(T x)
    {
        xDict[typeof(T)] = x;
    }
    public T get_X<T>()
    {
        return (T)xDict[typeof(T)];
    }
} 
```

但是，您为什么要这样做是完全不同的事情。通常从你想做的事情开始比你想做的事情更有意义。

# unix - 横幅命令是怎么回事？

> ID：652517
> 
> 赞同：20
> 
> 时间：2009-03-16T23:25:01.723
> 
> 标签：unix, standards

在某些版本的 UNIX 和 Linux 中，有一个横幅命令（通常是 /usr/bin/banner）可以打印出如下所示的出色输出：

```
 #####  #######    #     #####  #    #
#     #    #      # #   #     # #   #
#          #     #   #  #       #  #
 #####     #    #     # #       ###
      #    #    ####### #       #  #
#     #    #    #     # #     # #   #
 #####     #    #     #  #####  #    # 
```

在其他版本中，banner 命令（通常是 /usr/games/banner）会打印一个巨大的横幅，就像您在 1980 年使用 Printshop 制作的那样，适合在生日聚会等场合使用。

我倾向于喜欢在我的脚本中使用横幅，但由于这个问题，它本质上是不可移植的。“横幅”是 UNIX 的一部分，为什么不是 POSIX 标准的一部分？这是 BSD 与 SysV 的一些区别，但为什么还没有解决？

我知道有 figlet 可以复制我喜欢的横幅。但是我对这个命令的问题是可移植性。横幅*应该*是 UNIX 的一部分，恕我直言，即使它们需要以*不同*的名称包含两个版本（尽管理想情况下，行为应该合并到一个命令中，并带有所需输出的选项）。

如果我使用横幅，在脚本的可移植性方面我只是运气不好？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-08-30T05:32:50.980

在 Unices 中，没有什么比直接 C 更便于移植了。

您可能会发现我在这里的草稿比从发行版中的草稿更容易修改和扩展（如果没有别的原因，由于隐含的版权）。此代码旨在易于阅读和理解，无需任何注释。

[*不要害怕那个大数组，实际代码很短。在最底部有用于可视化和构建位图的“注释”。如果你能理解为什么空格字符在被编码为反斜杠的情况下仍然有效，那么你就明白了整个事情。剩下的只是填写字母表。*]

```
#include <stdio.h>
#include <string.h>

enum {
    A = 1<<0,
    B = 1<<1,
    C = 1<<2,
    D = 1<<3,
    E = 1<<4,
    F = 1<<5,
    G = 1<<6,
    H = 1<<7,
};

char vec[] = " 0123456789"
    "abcdefghijklmnopqrstuvwxyz"
    "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    ".,:!/\\|+-*=";

unsigned char map[sizeof(vec)][8] = {
    /* */ {A, B, C, D, E, F, G, H}, /* :) */
    /*0*/ {B|C|D|E|F, A|F|G, A|E|G, A|D|G, A|C|G, A|B|G, B|C|D|E|F, 0},
    /*1*/ {G, F|G, G, G, G, G, G, 0},
    /*2*/ {B|C|D|E|F, A|G, G, C|D|E|F, B, A, A|B|C|D|E|F|G, 0},
    /*3*/ {B|C|D|E|F, A|G, G, C|D|E|F, G, A|G, B|C|D|E|F, 0},
    /*4*/ {A|F, A|F, A|F, B|C|D|E|F|G, F, F, F, 0},
    /*5*/ {A|B|C|D|E|F|G, A, A, B|C|D|E|F, G, A|G, B|C|D|E|F, 0},
    /*6*/ {B|C|D|E|F, A, A, A|B|C|D|E|F, A|G, A|G, B|C|D|E|F, 0},
    /*7*/ {B|C|D|E|F|G, G, F, E, D, C, B, 0},
    /*8*/ {B|C|D|E|F, A|G, A|G, B|C|D|E|F, A|G, A|G, B|C|D|E|F, 0},
    /*9*/ {B|C|D|E|F, A|G, A|G, B|C|D|E|F|G, G, G, B|C|D|E|F, 0},
    /*a*/ {0, 0, B|C|D|E, F, B|C|D|E|F, A|F, B|C|D|E|G, 0},
    /*b*/ {B, B, B, B|C|D|E|F, B|G, B|G, A|C|D|E|F, 0},
    /*c*/ {0, 0, C|D|E, B|F, A, A, B|F, C|D|E},
    /*d*/ {F, F, F, B|C|D|E|F, A|F, A|F, B|C|D|E|G, 0},
    /*e*/ {0, 0, B|C|D|E, A|F, A|B|C|D|E|F, A, B|C|D|E, 0},
    /*f*/ {C|D|E, B, B, A|B|C|D, B, B, B, 0},
    /*g*/ {0, 0, B|C|D|E|G, A|F, A|F, B|C|D|E, F, B|C|D|E},
    /*h*/ {B, B, B, B|C|D|E, B|F, B|F, A|B|F, 0},
    /*i*/ {0, C, 0, B|C, C, C, A|B|C|D|E, 0},
    /*j*/ {0, D, 0, D, D, D, A|D, B|C},
    /*k*/ {B, B|E, B|D, B|C, B|D, B|E, A|B|E|F, 0},
    /*l*/ {A|B, B, B, B, B, B, A|B|C, 0},
    /*m*/ {0, 0, 0, A|C|E|F, A|B|D|G, A|D|G, A|D|G, 0},
    /*n*/ {0, 0, 0, B|D|E, B|C|F, B|F, B|F, 0},
    /*o*/ {0, 0, B|C|D|E, A|F, A|F, A|F, B|C|D|E, 0},
    /*p*/ {0, 0, A|B|C|D|E, B|F, B|F, B|C|D|E, B, A|B},
    /*q*/ {0, 0, B|C|D|E|G, A|F, A|F, B|C|D|E, F, F|G},
    /*r*/ {0, 0, A|B|D|E, B|C|F, B, B, A|B, 0},
    /*s*/ {0, 0, B|C|D|E, A, B|C|D|E, F, A|B|C|D|E, 0},
    /*t*/ {0, C, C, A|B|C|D|E, C, C, D|E, 0},
    /*u*/ {0, 0, A|F, A|F, A|F, A|F, B|C|D|E|G, 0},
    /*v*/ {0, 0, A|G, B|F, B|F, C|E, D, 0},
    /*w*/ {0, 0, A|G, A|G, A|D|G, A|D|G, B|C|E|F, 0},
    /*x*/ {0, 0, A|F, B|E, C|D, B|E, A|F, 0},
    /*y*/ {0, 0, B|F, B|F, B|F, C|F, A|D|E, B|C|D},
    /*z*/ {0, 0, A|B|C|D|E|F, E, D, C, B|C|D|E|F|G, 0},
    /*A*/ {D, C|E, B|F, A|G, A|B|C|D|E|F|G, A|G, A|G, 0},
    /*B*/ {A|B|C|D|E, A|F, A|F, A|B|C|D|E, A|F, A|F, A|B|C|D|E, 0},
    /*C*/ {C|D|E, B|F, A, A, A, B|F, C|D|E, 0},
    /*D*/ {A|B|C|D, A|E, A|F, A|F, A|F, A|E, A|B|C|D, 0},
    /*E*/ {A|B|C|D|E|F, A, A, A|B|C|D|E, A, A, A|B|C|D|E|F, 0},
    /*F*/ {A|B|C|D|E|F, A, A, A|B|C|D|E, A, A, A, 0},
    /*G*/ {C|D|E, B|F, A, A, A|E|F|G, B|F|G, C|D|E|G, 0},
    /*H*/ {A|G, A|G, A|G, A|B|C|D|E|F|G, A|G, A|G, A|G, 0},
    /*I*/ {A|B|C|D|E, C, C, C, C, C, A|B|C|D|E, 0},
    /*J*/ {A|B|C|D|E, C, C, C, C, C, A|C, B},
    /*K*/ {A|F, A|E, A|D, A|B|C, A|D, A|E, A|F, 0},
    /*L*/ {A, A, A, A, A, A, A|B|C|D|E|F, 0},
    /*M*/ {A|B|F|G, A|C|E|G, A|D|G, A|G, A|G, A|G, A|G, 0},
    /*N*/ {A|G, A|B|G, A|C|G, A|D|G, A|E|G, A|F|G, A|G, 0},
    /*O*/ {C|D|E, B|F, A|G, A|G, A|G, B|F, C|D|E, 0},
    /*P*/ {A|B|C|D, A|E, A|E, A|B|C|D, A, A, A, 0},
    /*Q*/ {C|D|E, B|F, A|G, A|G, A|C|G, B|D|F, C|D|E, F|G},
    /*R*/ {A|B|C|D, A|E, A|E, A|B|C|D, A|E, A|F, A|F, 0},
    /*S*/ {C|D|E, B|F, C, D, E, B|F, C|D|E, 0},
    /*T*/ {A|B|C|D|E|F|G, D, D, D, D, D, D, 0},
    /*U*/ {A|G, A|G, A|G, A|G, A|G, B|F, C|D|E, 0},
    /*V*/ {A|G, A|G, B|F, B|F, C|E, C|E, D, 0},
    /*W*/ {A|G, A|G, A|G, A|G, A|D|G, A|C|E|G, B|F, 0},
    /*X*/ {A|G, A|G, B|F, C|D|E, B|F, A|G, A|G, 0},
    /*Y*/ {A|G, A|G, B|F, C|E, D, D, D, 0},
    /*Z*/ {A|B|C|D|E|F|G, F, E, D, C, B, A|B|C|D|E|F|G, 0},
    /*.*/ {0, 0, 0, 0, 0, 0, D, 0},
    /*,*/ {0, 0, 0, 0, 0, E, E, D},
    /*:*/ {0, 0, 0, 0, D, 0, D, 0},
    /*!*/ {D, D, D, D, D, 0, D, 0},
    /*/ */ {G, F, E, D, C, B, A, 0},
    /*\\*/ {A, B, C, D, E, F, G, 0},
    /*|*/ {D, D, D, D, D, D, D, D},
    /*+*/ {0, D, D, B|C|D|E|F, D, D, 0, 0},
    /*-*/ {0, 0, 0, B|C|D|E|F, 0, 0, 0, 0},
    /***/ {0, B|D|F, C|D|E, D, C|D|E, B|D|F, 0, 0},
    /*=*/ {0, 0, B|C|D|E|F, 0, B|C|D|E|F, 0, 0, 0}
};

int enc(int c) { return strchr(vec,c)-vec; }

void show(char *s) {
    int row,col;
    char *sp;
    for (row=0; row<8; row++, putchar('\n'))
        for (sp = s; *sp; sp++)
            if (strchr(vec,*sp)!=NULL)
                for (col=0; col<8; col++)
                    putchar(map[enc(*sp)][row] & 1<<col ? *sp:' ');
}

int main(int c,char **v) {
    for (--c,++v;*v;v++,c--) show(*v);
    return 0;
}

/*
   01234567  01234567  01234567  01234567  01234567  01234567
0   #####               #           ###               #
1  #     #              #          #                  #
2  #     #    ####      #          #        #### #    #
3   #####         #     #####    #####     #    #     ####
4  #     #    #####     #    #     #       #    #     #   #
5  #     #   #    #     #    #     #        ####      #   #
6   #####     #### #   # ####      #            #    ##   #
7                                           ####
*/

/*
   01234567  01234567  01234567  01234567  01234567  01234567
0                       #
1    #          #       #  #
2                       # #      #         #####      #### #
3   ##          #       ##       ### ##     #   #    #    #
4    #          #       # #      #  #  #    #   #    #    #
5    #          #       #  #     #  #  #    ####      ####
6  #####     #  #      ##  ##    ## #  #    #             #
7             ##                           ##             ##
*/

/*
   01234567  01234567  01234567  01234567  01234567  01234567
0
1
2  ## ##      ####     #    #     #   #    ######    #     #
3   ##  #    #          #  #      #   #        #     #     #
4   #         ####       ##       #   #       #      #  #  #
5   #             #     #  #       #  #      #       #  #  #
6  ##        #####     #    #    #  ##      ######    ## ##
7                                 ###
*/

/*
   01234567  01234567  01234567  01234567  01234567  01234567
0     #      #####       ###     ####      #####     #     #
1    # #     #    #     #   #    #   #       #       #     #
2   #   #    #    #    #         #    #      #       #     #
3   #   #    #####     #         #    #      #       #     #
4   #####    #    #    #         #    #      #       #  #  #
5  #     #   #    #     #   #    #   #       #       # # # #
6  #     #   #####       ###     ####      # #        #   #
7                                           #
*/ 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-08-30T01:18:35.940

所需的横幅是 System V 横幅，安装 sysvbanner 包以获取它，至少在 Ubuntu 11 上

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-04-15T11:47:46.930

这是一个受@luser droog 代码启发的shell 实现。它不符合 POSIX，但可与 ksh93 和 bash 一起使用，这使其对于大多数当前的 Unix 实现具有足够的可移植性。

```
#!/bin/ksh93
# or #!/bin/bash

A=$((1<<0))
B=$((1<<1))
C=$((1<<2))
D=$((1<<3))
E=$((1<<4))
F=$((1<<5))
G=$((1<<6))
H=$((1<<7))

function outLine
{
  typeset r=0 scan
  for scan
  do
    typeset l=${#scan}
    typeset line=0
    for ((p=0; p<l; p++))
    do
      line="$((line+${scan:$p:1}))"
    done
    for ((column=0; column<8; column++))
      do
        [[ $((line & (1<<column))) == 0 ]] && n=" " || n="#"
        raw[r]="${raw[r]}$n"
      done
      r=$((r+1))
    done
}

function outChar
{
    case "$1" in
    (" ") outLine "" "" "" "" "" "" "" "" ;;
    ("0") outLine "BCDEF" "AFG" "AEG" "ADG" "ACG" "ABG" "BCDEF" "" ;;
    ("1") outLine "F" "EF" "F" "F" "F" "F" "F" "" ;;
    ("2") outLine "BCDEF" "AG" "G" "CDEF" "B" "A" "ABCDEFG" "" ;;
    ("3") outLine "BCDEF" "AG" "G" "CDEF" "G" "AG" "BCDEF" "" ;;
    ("4") outLine "AF" "AF" "AF" "BCDEFG" "F" "F" "F" "" ;;
    ("5") outLine "ABCDEFG" "A" "A" "ABCDEF" "G" "AG" "BCDEF" "" ;;
    ("6") outLine "BCDEF" "A" "A" "BCDEF" "AG" "AG" "BCDEF" "" ;;
    ("7") outLine "BCDEFG" "G" "F" "E" "D" "C" "B" "" ;;
    ("8") outLine "BCDEF" "AG" "AG" "BCDEF" "AG" "AG" "BCDEF" "" ;;
    ("9") outLine "BCDEF" "AG" "AG" "BCDEF" "G" "G" "BCDEF" "" ;;
    ("a") outLine "" "" "BCDE" "F" "BCDEF" "AF" "BCDEG" "" ;;
    ("b") outLine "B" "B" "BCDEF" "BG" "BG" "BG" "ACDEF" "" ;;
    ("c") outLine "" "" "CDE" "BF" "A" "BF" "CDE" "" ;;
    ("d") outLine "F" "F" "BCDEF" "AF" "AF" "AF" "BCDEG" "" ;;
    ("e") outLine "" "" "BCDE" "AF" "ABCDEF" "A" "BCDE" "" ;;
    ("f") outLine "CDE" "B" "B" "ABCD" "B" "B" "B" "" ;;
    ("g") outLine "" "" "BCDEG" "AF" "AF" "BCDE" "F" "BCDE" ;;
    ("h") outLine "B" "B" "BCDE" "BF" "BF" "BF" "ABF" "" ;;
    ("i") outLine "C" "" "BC" "C" "C" "C" "ABCDE" "" ;;
    ("j") outLine "D" "" "CD" "D" "D" "D" "AD" "BC" ;;
    ("k") outLine "B" "BE" "BD" "BC" "BD" "BE" "ABEF" "" ;;
    ("l") outLine "AB" "B" "B" "B" "B" "B" "ABC" "" ;;
    ("m") outLine "" "" "ACEF" "ABDG" "ADG" "ADG" "ADG" "" ;;
    ("n") outLine "" "" "BDE" "BCF" "BF" "BF" "BF" "" ;;
    ("o") outLine "" "" "BCDE" "AF" "AF" "AF" "BCDE" "" ;;
    ("p") outLine "" "" "ABCDE" "BF" "BF" "BCDE" "B" "AB" ;;
    ("q") outLine "" "" "BCDEG" "AF" "AF" "BCDE" "F" "FG" ;;
    ("r") outLine "" "" "ABDE" "BCF" "B" "B" "AB" "" ;;
    ("s") outLine "" "" "BCDE" "A" "BCDE" "F" "ABCDE" "" ;;
    ("t") outLine "C" "C" "ABCDE" "C" "C" "C" "DE" "" ;;
    ("u") outLine "" "" "AF" "AF" "AF" "AF" "BCDEG" "" ;;
    ("v") outLine "" "" "AG" "BF" "BF" "CE" "D" "" ;;
    ("w") outLine "" "" "AG" "AG" "ADG" "ADG" "BCEF" "" ;;
    ("x") outLine "" "" "AF" "BE" "CD" "BE" "AF" "" ;;
    ("y") outLine "" "" "BF" "BF" "BF" "CDE" "E" "BCD" ;;
    ("z") outLine "" "" "ABCDEF" "E" "D" "C" "BCDEFG" "" ;;
    ("A") outLine "D" "CE" "BF" "AG" "ABCDEFG" "AG" "AG" "" ;;
    ("B") outLine "ABCDE" "AF" "AF" "ABCDE" "AF" "AF" "ABCDE" "" ;;
    ("C") outLine "CDE" "BF" "A" "A" "A" "BF" "CDE" "" ;;
    ("D") outLine "ABCD" "AE" "AF" "AF" "AF" "AE" "ABCD" "" ;;
    ("E") outLine "ABCDEF" "A" "A" "ABCDE" "A" "A" "ABCDEF" "" ;;
    ("F") outLine "ABCDEF" "A" "A" "ABCDE" "A" "A" "A" "" ;;
    ("G") outLine "CDE" "BF" "A" "A" "AEFG" "BFG" "CDEG" "" ;;
    ("H") outLine "AG" "AG" "AG" "ABCDEFG" "AG" "AG" "AG" "" ;;
    ("I") outLine "ABCDE" "C" "C" "C" "C" "C" "ABCDE" "" ;;
    ("J") outLine "BCDEF" "D" "D" "D" "D" "BD" "C" "" ;;
    ("K") outLine "AF" "AE" "AD" "ABC" "AD" "AE" "AF" "" ;;
    ("L") outLine "A" "A" "A" "A" "A" "A" "ABCDEF" "" ;;
    ("M") outLine "ABFG" "ACEG" "ADG" "AG" "AG" "AG" "AG" "" ;;
    ("N") outLine "AG" "ABG" "ACG" "ADG" "AEG" "AFG" "AG" "" ;;
    ("O") outLine "CDE" "BF" "AG" "AG" "AG" "BF" "CDE" "" ;;
    ("P") outLine "ABCDE" "AF" "AF" "ABCDE" "A" "A" "A" "" ;;
    ("Q") outLine "CDE" "BF" "AG" "AG" "ACG" "BDF" "CDE" "FG" ;;
    ("R") outLine "ABCD" "AE" "AE" "ABCD" "AE" "AF" "AF" "" ;;
    ("S") outLine "CDE" "BF" "C" "D" "E" "BF" "CDE" "" ;;
    ("T") outLine "ABCDEFG" "D" "D" "D" "D" "D" "D" "" ;;
    ("U") outLine "AG" "AG" "AG" "AG" "AG" "BF" "CDE" "" ;;
    ("V") outLine "AG" "AG" "BF" "BF" "CE" "CE" "D" "" ;;
    ("W") outLine "AG" "AG" "AG" "AG" "ADG" "ACEG" "BF" "" ;;
    ("X") outLine "AG" "AG" "BF" "CDE" "BF" "AG" "AG" "" ;;
    ("Y") outLine "AG" "AG" "BF" "CE" "D" "D" "D" "" ;;
    ("Z") outLine "ABCDEFG" "F" "E" "D" "C" "B" "ABCDEFG" "" ;;
    (".") outLine "" "" "" "" "" "" "D" "" ;;
    (",") outLine "" "" "" "" "" "E" "E" "D" ;;
    (":") outLine "" "" "" "" "D" "" "D" "" ;;
    ("!") outLine "D" "D" "D" "D" "D" "" "D" "" ;;
    ("/") outLine "G" "F" "E" "D" "C" "B" "A" "" ;;
    ("\\") outLine "A" "B" "C" "D" "E" "F" "G" "" ;;
    ("|") outLine "D" "D" "D" "D" "D" "D" "D" "D" ;;
    ("+") outLine "" "D" "D" "BCDEF" "D" "D" "" "" ;;
    ("-") outLine "" "" "" "BCDEF" "" "" "" "" ;;
    ("*") outLine "" "BDF" "CDE" "D" "CDE" "BDF" "" "" ;;
    ("=") outLine "" "" "BCDEF" "" "BCDEF" "" "" "" ;;
    (*) outLine "ABCDEFGH" "AH" "AH" "AH" "AH" "AH" "AH" "ABCDEFGH" ;;
    esac
}

function outArg
{
  typeset l=${#1} c r
  for ((c=0; c<l; c++))
  do
    outChar "${1:$c:1}"
  done
  echo
  [ -z "$COLUMNS" ] && COLUMNS=$(tput cols 2>/dev/null)
  for ((r=0; r<8; r++))
  do
    printf "%-*.*s\n" "${COLUMNS:-80}" "${COLUMNS:-80}" "${raw[r]}"
    raw[r]=""
  done
}

for i
do
  outArg "$i"
  echo
done 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-17T00:48:29.650

总是有[FIGLet](http://www.figlet.org/)。为 unix、windows、dos、mac 等提供源代码。希望这能为您指明正确的方向。

此外，还有[TOIlet](http://caca.zoy.org/toilet.html)，可以认为是 figlet++。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-16T23:59:34.607

对于 unix 系统来说，这并不是必不可少的，我不确定为什么它会成为标准的一部分。还有许多其他的事情可以说是标准制定机构应该关注的更重要的事情。

如果它在系统上不可用，您可以简单地安装它或构建一个等效的。

在 debian 上有一个横幅克隆，它有一个包含 155 行代码的单个 c 文件，其中大部分只是字形。可以在包页面上找到源代码。 [http://packages.debian.org/testing/misc/sysvbanner](http://packages.debian.org/testing/misc/sysvbanner)

甚至用您选择的脚本语言构建另一个克隆应该不会太难。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-17T00:25:29.927

因为在 POSIX 标准化时有两种不同的行为，早在 80 年代后期，`banner`标准中就省略了。这不是必需的，也没有一个普遍的标准可以选择作为“标准”。

是的，如果你`banner`在你的脚本中使用，你就不走运了；该行为跨平台不可靠。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-01-06T13:14:24.897

bsdmainutils 软件包版本 8.0.13 中的横幅命令现在称为printerbanner，位于此处/usr/bin/printerbanner。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-10-26T12:44:08.213

如果有人感兴趣，这里有一个 Java 版本。它会生成一个字符串，这取决于您是使用 System.out.println() 还是您选择的 Logging 框架。

```
public class Banner {
    public static String print(String s, char stdCh) {
        StringBuilder sb = new StringBuilder();
        for (int row = 0; row < 8; row++) {
            sb.append('\n');
            for (char ch : s.toCharArray()) {
                int enc = CHAR_LIST.indexOf(ch);
                if (enc < 0) continue;
                for (int col = 0; col < 8; col++) {
                    sb.append(isPresent(row, enc, col) ? charToPrint(ch, stdCh) : ' ');
                }
            }
        }
        return sb.append('\n').toString();
    }

    private static char charToPrint(char ch, char stdCh) {
        return ch != ' ' && stdCh != 0 ? stdCh : ch;
    }

    private static boolean isPresent(int row, int enc, int col) {
        return (map[enc][row] & 1 << col) != 0;
    }

    // @formatter:off
    private static final String CHAR_LIST = " 0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.,:!/\\|+-*=";

    private static int        A = 1<<0;
    private static int        B = 1<<1;
    private static int        C = 1<<2;
    private static int        D = 1<<3;
    private static int        E = 1<<4;
    private static int        F = 1<<5;
    private static int        G = 1<<6;
    private static int        H = 1<<7;

    // define the 'font'
    private static int[][] map = new int[][] {
        /* */ {A, B, C, D, E, F, G, H},
        /*0*/ {B|C|D|E|F, A|F|G, A|E|G, A|D|G, A|C|G, A|B|G, B|C|D|E|F, 0},
        /*1*/ {G, F|G, G, G, G, G, G, 0},
        /*2*/ {B|C|D|E|F, A|G, G, C|D|E|F, B, A, A|B|C|D|E|F|G, 0},
        /*3*/ {B|C|D|E|F, A|G, G, C|D|E|F, G, A|G, B|C|D|E|F, 0},
        /*4*/ {A|F, A|F, A|F, B|C|D|E|F|G, F, F, F, 0},
        /*5*/ {A|B|C|D|E|F|G, A, A, B|C|D|E|F, G, A|G, B|C|D|E|F, 0},
        /*6*/ {B|C|D|E|F, A, A, A|B|C|D|E|F, A|G, A|G, B|C|D|E|F, 0},
        /*7*/ {B|C|D|E|F|G, G, F, E, D, C, B, 0},
        /*8*/ {B|C|D|E|F, A|G, A|G, B|C|D|E|F, A|G, A|G, B|C|D|E|F, 0},
        /*9*/ {B|C|D|E|F, A|G, A|G, B|C|D|E|F|G, G, G, B|C|D|E|F, 0},
        /*a*/ {0, 0, B|C|D|E, F, B|C|D|E|F, A|F, B|C|D|E|G, 0},
        /*b*/ {B, B, B, B|C|D|E|F, B|G, B|G, A|C|D|E|F, 0},
        /*c*/ {0, 0, C|D|E, B|F, A, A, B|F, C|D|E},
        /*d*/ {F, F, F, B|C|D|E|F, A|F, A|F, B|C|D|E|G, 0},
        /*e*/ {0, 0, B|C|D|E, A|F, A|B|C|D|E|F, A, B|C|D|E, 0},
        /*f*/ {C|D|E, B, B, A|B|C|D, B, B, B, 0},
        /*g*/ {0, 0, B|C|D|E|G, A|F, A|F, B|C|D|E, F, B|C|D|E},
        /*h*/ {B, B, B, B|C|D|E, B|F, B|F, A|B|F, 0},
        /*i*/ {0, C, 0, B|C, C, C, A|B|C|D|E, 0},
        /*j*/ {0, D, 0, D, D, D, A|D, B|C},
        /*k*/ {B, B|E, B|D, B|C, B|D, B|E, A|B|E|F, 0},
        /*l*/ {A|B, B, B, B, B, B, A|B|C, 0},
        /*m*/ {0, 0, 0, A|C|E|F, A|B|D|G, A|D|G, A|D|G, 0},
        /*n*/ {0, 0, 0, B|D|E, B|C|F, B|F, B|F, 0},
        /*o*/ {0, 0, B|C|D|E, A|F, A|F, A|F, B|C|D|E, 0},
        /*p*/ {0, 0, A|B|C|D|E, B|F, B|F, B|C|D|E, B, A|B},
        /*q*/ {0, 0, B|C|D|E|G, A|F, A|F, B|C|D|E, F, F|G},
        /*r*/ {0, 0, A|B|D|E, B|C|F, B, B, A|B, 0},
        /*s*/ {0, 0, B|C|D|E, A, B|C|D|E, F, A|B|C|D|E, 0},
        /*t*/ {0, C, C, A|B|C|D|E, C, C, D|E, 0},
        /*u*/ {0, 0, A|F, A|F, A|F, A|F, B|C|D|E|G, 0},
        /*v*/ {0, 0, A|G, B|F, B|F, C|E, D, 0},
        /*w*/ {0, 0, A|G, A|G, A|D|G, A|D|G, B|C|E|F, 0},
        /*x*/ {0, 0, A|F, B|E, C|D, B|E, A|F, 0},
        /*y*/ {0, 0, B|F, B|F, B|F, C|F, A|D|E, B|C|D},
        /*z*/ {0, 0, A|B|C|D|E|F, E, D, C, B|C|D|E|F|G, 0},
        /*A*/ {D, C|E, B|F, A|G, A|B|C|D|E|F|G, A|G, A|G, 0},
        /*B*/ {A|B|C|D|E, A|F, A|F, A|B|C|D|E, A|F, A|F, A|B|C|D|E, 0},
        /*C*/ {C|D|E, B|F, A, A, A, B|F, C|D|E, 0},
        /*D*/ {A|B|C|D, A|E, A|F, A|F, A|F, A|E, A|B|C|D, 0},
        /*E*/ {A|B|C|D|E|F, A, A, A|B|C|D|E, A, A, A|B|C|D|E|F, 0},
        /*F*/ {A|B|C|D|E|F, A, A, A|B|C|D|E, A, A, A, 0},
        /*G*/ {C|D|E, B|F, A, A, A|E|F|G, B|F|G, C|D|E|G, 0},
        /*H*/ {A|G, A|G, A|G, A|B|C|D|E|F|G, A|G, A|G, A|G, 0},
        /*I*/ {A|B|C|D|E, C, C, C, C, C, A|B|C|D|E, 0},
        /*J*/ {A|B|C|D|E, C, C, C, C, C, A|C, B},
        /*K*/ {A|F, A|E, A|D, A|B|C, A|D, A|E, A|F, 0},
        /*L*/ {A, A, A, A, A, A, A|B|C|D|E|F, 0},
        /*M*/ {A|B|F|G, A|C|E|G, A|D|G, A|G, A|G, A|G, A|G, 0},
        /*N*/ {A|G, A|B|G, A|C|G, A|D|G, A|E|G, A|F|G, A|G, 0},
        /*O*/ {C|D|E, B|F, A|G, A|G, A|G, B|F, C|D|E, 0},
        /*P*/ {A|B|C|D, A|E, A|E, A|B|C|D, A, A, A, 0},
        /*Q*/ {C|D|E, B|F, A|G, A|G, A|C|G, B|D|F, C|D|E, F|G},
        /*R*/ {A|B|C|D, A|E, A|E, A|B|C|D, A|E, A|F, A|F, 0},
        /*S*/ {C|D|E, B|F, C, D, E, B|F, C|D|E, 0},
        /*T*/ {A|B|C|D|E|F|G, D, D, D, D, D, D, 0},
        /*U*/ {A|G, A|G, A|G, A|G, A|G, B|F, C|D|E, 0},
        /*V*/ {A|G, A|G, B|F, B|F, C|E, C|E, D, 0},
        /*W*/ {A|G, A|G, A|G, A|G, A|D|G, A|C|E|G, B|F, 0},
        /*X*/ {A|G, A|G, B|F, C|D|E, B|F, A|G, A|G, 0},
        /*Y*/ {A|G, A|G, B|F, C|E, D, D, D, 0},
        /*Z*/ {A|B|C|D|E|F|G, F, E, D, C, B, A|B|C|D|E|F|G, 0},
        /*.*/ {0, 0, 0, 0, 0, 0, D, 0},
        /*,*/ {0, 0, 0, 0, 0, E, E, D},
        /*:*/ {0, 0, 0, 0, D, 0, D, 0},
        /*!*/ {D, D, D, D, D, 0, D, 0},
        /*/ */ {G, F, E, D, C, B, A, 0},
        /*\\*/ {A, B, C, D, E, F, G, 0},
        /*|*/ {D, D, D, D, D, D, D, D},
        /*+*/ {0, D, D, B|C|D|E|F, D, D, 0, 0},
        /*-*/ {0, 0, 0, B|C|D|E|F, 0, 0, 0, 0},
        /***/ {0, B|D|F, C|D|E, D, C|D|E, B|D|F, 0, 0},
        /*=*/ {0, 0, B|C|D|E|F, 0, B|C|D|E|F, 0, 0, 0}
    };

    /*
       01234567  01234567  01234567  01234567  01234567  01234567
    0   #####               #           ###               #
    1  #     #              #          #                  #
    2  #     #    ####      #          #        #### #    #
    3   #####         #     #####    #####     #    #     ####
    4  #     #    #####     #    #     #       #    #     #   #
    5  #     #   #    #     #    #     #        ####      #   #
    6   #####     #### #   # ####      #            #    ##   #
    7                                           ####
    */

    /*
       01234567  01234567  01234567  01234567  01234567  01234567
    0                       #
    1    #          #       #  #
    2                       # #      #         #####      #### #
    3   ##          #       ##       ### ##     #   #    #    #
    4    #          #       # #      #  #  #    #   #    #    #
    5    #          #       #  #     #  #  #    ####      ####
    6  #####     #  #      ##  ##    ## #  #    #             #
    7             ##                           ##             ##
    */

    /*
       01234567  01234567  01234567  01234567  01234567  01234567
    0
    1
    2  ## ##      ####     #    #     #   #    ######    #     #
    3   ##  #    #          #  #      #   #        #     #     #
    4   #         ####       ##       #   #       #      #  #  #
    5   #             #     #  #       #  #      #       #  #  #
    6  ##        #####     #    #    #  ##      ######    ## ##
    7                                 ###
    */

    /*
       01234567  01234567  01234567  01234567  01234567  01234567
    0     #      #####       ###     ####      #####     #     #
    1    # #     #    #     #   #    #   #       #       #     #
    2   #   #    #    #    #         #    #      #       #     #
    3   #   #    #####     #         #    #      #       #     #
    4   #####    #    #    #         #    #      #       #  #  #
    5  #     #   #    #     #   #    #   #       #       # # # #
    6  #     #   #####       ###     ####      # #        #   #
    7                                           #
    */

    // @formatter:on
} 
```

# string - 引号是一种字符串分隔符吗？还是“分隔符”是指不包括引号的其他类型的字符？

> ID：652518
> 
> 赞同：0
> 
> 时间：2009-03-16T23:25:49.990
> 
> 标签：string, delimiter

当人们谈论字符串分隔符时，它是否包括引号，或者这是否意味着除引号之外的所有内容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T23:27:22.403

它表示用于定义字符串开头和结尾的任何字符（例如引号，但在其他上下文中，其他字符）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T23:52:07.557

如果您谈论的字符串定界符几乎总是表示引号，则存在细微差别，“或”。

如果您谈论的是分隔字符串，那么您通常谈论的是一串标记，它们之间有分隔符，即

"this,is,a,delimited,string" -

使用逗号作为分隔符是很常见的，但是当标记已经包含逗号时会导致问题 - 例如

“一，百万，美元，1,000,000 美元”

在这种情况下，通常会进一步分隔令牌，因此我们得到

“一百万美元”“1,000,000 美元”

另一种常见的替代方法是使用不常见的字符作为分隔符，并且有一个使用管道符号 | 的小约定。

“一|百万|美元|1,000,000美元”

# haskell - Haskell：使用数组参数递归

> ID：652521
> 
> 赞同：0
> 
> 时间：2009-03-16T23:27:17.053
> 
> 标签：haskell, recursion

免责声明：我是 Haskell 的新手，我不太记得大学里的 FP，所以我的代码中可能有不止一两个错误。这也是我的欧拉问题 3 代码。

我正在尝试以两个数组作为参数和一个数组作为结果递归调用一个函数。

目标：

*   假设这个问题的 n 是 10
*   创建一个从 1 到 n 的所有自然数的列表（变量是 'allNumbers' 是代码）
*   创建另一个从 1 到 n 的所有自然数列表（变量是 'allFactors' 是代码）
*   取“allFactors”中的第一个元素，并将“allFactors”的其余数字乘以该数字。（这会生成一个数字数组）
*   从“allNumbers”中删除所有这些数字
*   从 1 继续到 n，直到 'allFactors' 为空。

这是我的代码：

```
mkList :: Int -> [Int]
mkList n = [1..n-1]

modArray :: Int -> Int -> [Int]
modArray a b =  [ x*b | x <- [1..a], x `mod` b == 0] 

modArrayAll :: [Int] -> [Int] -> [Int]
modArrayAll [] [] = [] 
modArrayAll (x:xs) (y:ys) = (e) 
    where
        m = head( ys)
        n = length( xs)
        e = (modArrayAll xs ys ) \\ modArray n m 
```

（主要）

```
let allNumbers =  mkList (first + 1)
let allFactors = mkList (first + 1)
let mainList2 =  modArrayAll allNumbers allFactors 
```

这会产生一个空列表。但是，如果我有：

```
e = xs \\ modArray n m  --WORKS for one iteration 
```

我得到了从 1 到 10 的所有奇数。

我的问题：为什么这不像我期望的那样工作？我希望递归堆栈会遇到空数组条件并且只返回一个不会从调用数组中删除的空数组，它会继续只返回素数？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T07:00:59.100

我复制了你的目标笔记：

```
-- assume n is 10 for this question
n=10

-- create a list of all natural numbers from 1 to n (variable is 'allNumbers' is code)
allNumbers = [1..n]

-- create another list of all natural numbers from 1 to n (variable is 'allFactors' is code)
allFactors = [2..n] -- i suspect you really wanted this rather than [1..n]

-- take the first element in 'allFactors' and
-- multiply the rest of the numbers of 'allFactors' by this number.
-- (this generates an array of numbers)
-- continue from 1 to n until 'allFactors' is empty
factorProducts = [ x*y | x <- allFactors, y <- allFactors]

--  remove all these numbers from 'allNumbers'
whatYouWanted = allNumbers \\ factorProducts 
```

目前，您似乎仍在以一种相当紧迫的心态思考。尝试更多地考虑你想要什么，而不是如何得到它:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T00:21:31.900

`modArray n m`创建一个 的倍数列表，`m`然后将其从整数的“主列表”中删除。但是`modArray n m`包括`1*m`，因此每个数字都被删除，因为它是自身的“倍数”。在您的测试用例中，您只得到奇数作为结果，而您希望 2 仍然在结果列表中。此外，1 包含在您的因子列表中，这将消除所有数字，因为它们都是 1 的倍数。

递归的终止情况是`modArrayAll [] [] = []`，因此返回一个空列表。然后在周围的递归调用中，这里使用这个返回值：

```
(modArrayAll xs ys) \\ modArray n m 
```

这会尝试`modArray n m`从 . 返回的已经为空的列表中删除更多元素（由 . 返回的那些）`modArrayAll xs ys`。任何地方都没有添加新元素，结果列表保持为空。使用您的算法，您希望`[]`-case 返回整个数字列表，而不是一个空列表。然后`\\ modArray n m`在周围的递归函数调用中可以过滤掉越来越多的非质因子。

# visual-c++ - How do I create a directory in a makefile

> ID：652524
> 
> 赞同：4
> 
> 时间：2009-03-16T23:28:36.457
> 
> 标签：visual-c++, makefile, nmake

I'm using Visual Studio 2005 nmake, and I have a test makefile like this:

```
sometarget:
    -mkdir c:\testdir 
```

I want to always create the directory, without having to specify 'sometarget'. For example, I can do this:

```
!if [if not exist c:\testdir\$(null) mkdir c:\testdir]
!endif 
```

But that requires two lines, where I really only want to do the "-mkdir c:\testdir". If I just replace it with "-mkdir c:\testdir" I get an error from nmake - "fatal error U1034: syntax error : separator missing".

How can I always execute the mkdir, without messing about with !if [] stuff?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T03:17:56.860

I think this will work:

```
 -@ if NOT EXIST "dir" mkdir "dir" 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T00:36:13.970

Make always wants to do things based on targets. It's not a general scripting tool. It looks at the targets and checks to see if they exist. If the target does not exist it executes the commands for that target.

The usual way to do this is to have a dummy target that is never going to be generated by the make scripts, so every time make runs it has to execute the relevant commands.

Or, you could add the command to a batch file that then calls your make file.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-03-24T17:45:10.330

I'm not sure if there is an equivalent in Windows with nmake, but I managed to create a directory without using targets on Linux. I used the make function "shell". For example:

```
# Find where we are
TOPDIR := $(shell pwd)
# Define destination directory
ROOTFS := $(TOPDIR)/rootfs
# Make sure destination directory exists before invoking any tags
$(shell [ -d "$(ROOTFS)" ] || mkdir -p $(ROOTFS))

all:
    @if [ -d "$(ROOTFS)" ]; then echo "Cool!"; else echo "Darn!"; fi 
```

I hope Windows has the equivalent.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-20T15:05:53.797

`$(DIRNAME): @[ -d $@ ] || mkdir -p $@`

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2010-04-20T14:47:20.567

Try using this:

```
-mkdir -p c:\testdir 
```

# neural-network - 神经网络 - 输入值

> ID：652530
> 
> 赞同：25
> 
> 时间：2009-03-16T23:29:34.520
> 
> 标签：neural-network

我有一个可能微不足道的问题，但在我看过的任何地方都没有描述。我正在研究神经网络，我所看到的任何地方都有一些理论和一些简单的例子，其中一些 0 和 1 作为输入。我想知道：我是否必须只将一个值作为一个神经元的输入值，或者它可以是一个向量，比如说，3 个值（例如 RGB 颜色）？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-06-30T22:33:48.500

上述答案在技术上是正确的，但不能解释简单的事实：*从来没有*需要将数字向量提供给单个神经元的情况。

从实际的角度来看，这是因为（如先前的解决方案之一所示）您可以只为向量中的每个数字拥有一个神经元，然后将所有这些都作为单个神经元的输入。这应该会让你在训练后得到你想要的行为，因为第二层神经元可以有效地利用整个向量。

从数学的角度来看，编码理论有一个基本定理，即*任何*数字向量都可以表示为单个数字。因此，如果您真的不想要额外的神经元层，您可以简单地将 RGB 值编码为单个数字并将其输入到神经元。虽然，这种编码功能可能会使大多数学习问题变得更加困难，所以我怀疑这种解决方案在大多数情况下是否值得。

总结一下：人工神经网络在没有给输入单元一个向量的情况下使用，但不会因此而失去计算能力。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-16T23:49:22.523

在处理多维数据时，我相信据说两层神经网络可以提供更好的结果。

在你的情况下：

```
R[0..1] => (N1)----\
                    \
G[0..1] => (N2)-----(N4) => Result[0..1]
                    /
B[0..1] => (N3)----/ 
```

如您所见，N4 神经元可以处理 3 个条目。

[0..1] 间隔是一种约定，但在 imo 中是一个很好的间隔。这样，您可以轻松编写一组可以采用任意数量条目的通用神经元类（我有模板 C++ 类，其中条目数作为模板参数个人）。因此，您只需对神经元的逻辑进行一次编码，然后就可以玩弄网络结构和/或神经元内的功能组合。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-12-24T18:34:40.710

通常，单个神经元的输入是介于 0 和 1 之间的值。该约定不仅是为了便于实现，而且因为将输入值归一化到相同的范围可确保每个输入具有相似的权重。（如果您有一些具有 8 位颜色且像素值介于 0 和 7 之间的图像，以及一些具有 16 位颜色且像素值介于 0 和 255 之间的图像，那么您可能不希望仅仅因为数值为更高。同样，您可能希望您的图像具有相同的尺寸。）

就使用像素值作为输入而言，尝试收集比其像素更高级别的图像表示是很常见的（[更多信息](http://ufldl.stanford.edu/wiki/index.php/Feature_extraction_using_convolution)）。例如，给定一个 5 x 5（归一化）灰度图像：

```
[1 1 1 1 1]
[0 0 1 0 0] 
[0 0 1 0 0] 
[0 0 1 0 0] 
[0 0 1 0 0] 
```

我们可以使用以下特征矩阵来帮助发现图像的水平、垂直和对角线特征。有关更多信息，请参阅[python haar 人脸检测](http://docs.opencv.org/trunk/doc/py_tutorials/py_objdetect/py_face_detection/py_face_detection.html)。

```
[1 1]  [0 0]  [1 0]  [0 1]  [1 0], [0 1]
[0 0], [1 1], [1 0], [0 1], [0 1], [1 0] 
```

要为此图像构建输入向量*v*，请获取第一个 2x2 特征矩阵并通过逐元素乘法将其“应用”到图像中的第一个位置。申请，

```
[1 1] (the first feature matrix) to [1 1] (the first position in the image)
[0 0]                               [0 0] 
```

将导致 2，因为 1*1 + 1*1 + 0*0 + 0*0 = 2。将 2 附加到此图像的输入向量的后面。然后将此特征矩阵移动到下一个位置，向右移动一个，并再次应用它，将结果添加到输入向量中。对特征矩阵的每个位置和每个特征矩阵重复执行此操作。这将为单个图像构建您的输入向量。确保为每个图像以相同的顺序构建向量。

在这种情况下，图像是黑白的，但是使用 RGB 值，您可以扩展算法以执行相同的计算，但将 3 个值添加到每个像素的输入向量 - 每种颜色一个。这应该为每个图像提供一个输入向量，并为每个神经元提供一个输入。然后在通过网络运行之前需要对向量进行归一化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T00:08:25.567

通常，单个神经元将多个实数作为其输入并输出一个实数，该实数通常通过将 sigmoid 函数应用于实数之和（缩放，然后加上或减去一个恒定偏移量）来计算。

如果您想输入两个 RGB 向量（2 x 3 实数），您需要决定如何组合这些值。如果将所有元素加在一起并应用 sigmoid 函数，则相当于得到六个实数“平”。另一方面，如果您处理 R 元素，然后是 G 元素和 B 元素，所有这些都单独处理（例如，将这些对相加或相减），您实际上拥有三个独立的神经元。

所以简而言之，不，单个神经元不接受向量值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-06-02T16:58:07.897

使用归一化为可见光谱的光波长作为输入。

网上有一些近似公式。搜索 RGB 到波长的转换或使用 HSL 颜色模型并提取色相分量，也可能使用饱和度和亮度。出色地...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T23:31:10.070

它可以是任何你想要的，只要你相应地编写你的内部函数。

您提到的示例使用 [0;1] 作为其域，但您可以使用 R、R² 或任何您想要的，只要您在神经元中使用的函数是在此域上定义的。

在您的情况下，您可以在 R3 上定义您的函数以允许处理 RGB 值

一个简单的例子：使用 (x1, y1, z1),(x2,y2,z2)->(ax1+x2,by1+y2,cz1+z2) 作为将两种颜色转换为一种颜色的函数，ab 和 c 是你的学习系数，您将在学习阶段确定。

[维基百科](http://en.wikipedia.org/wiki/Artificial_neural_network)上提供了非常详细的信息（包括您问题的答案）。

# python - 在python中将二进制缓冲区写入文件

> ID：652535
> 
> 赞同：6
> 
> 时间：2009-03-16T23:30:36.157
> 
> 标签：python, binary, io

我有一些python代码：

1.  从压缩的数据库中获取 BLOB。
2.  在 C 中调用解压缩数据的解压缩例程。
3.  将未压缩的数据写入文件。

它使用[ctypes](http://docs.python.org/library/ctypes.html)调用共享库中的 C 例程。

这主要是有效的，除了实际写入文件。为了解压缩，我将数据解压缩到使用 ctypes`create_string_buffer`方法创建的 python 缓冲区中：

`c_uncompData_p = create_string_buffer(64000)`

所以解压调用是这样的：

`c_uncompSize = mylib.explodeCharBuffer (c_data_p, c_data_len, c_uncompData_p)`

生成的未压缩数据的大小作为返回值返回。

但是......我不知道如何强制 python 只写`c_uncompSize`字节 - 如果我这样做：

`myfile.write (c_uncompData_p.raw)`

它写出整个 64k 缓冲区（数据是二进制的 - 所以它不是以空值结尾的）。

所以，我的问题是 - 使用 Python 2.5 如何打印出 c_uncompSize 字节，而不是整个 64k？

谢谢杰米

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T23:41:07.457

切片也适用于 c_char_Arrays：

```
myfile.write(c_uncompData_p[:c_uncompSize]) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T04:01:25.227

`buffer()`可能有助于避免不必要的复制（由[@elo80ka 的答案](https://stackoverflow.com/questions/652535/writing-a-binary-buffer-to-a-file-in-python/652565#652565)中的切片引起）：

```
myfile.write(buffer(c_uncompData_p.raw, 0, c_uncompSize)) 
```

在您的示例中，这无关紧要（由于`c_uncompData_p`只写一次而且很小），但总的来说它可能很有用。

* * *

只是为了练习，这里是使用 C 的`stdio`答案`fwrite()`：

```
from ctypes import *

# load C library
try: libc = cdll.msvcrt # Windows
except AttributeError:
     libc = CDLL("libc.so.6") # Linux

# fopen()
libc.fopen.restype = c_void_p
def errcheck(res, func, args):
    if not res: raise IOError
    return res
libc.fopen.errcheck = errcheck
# errcheck() could be similarly defined for `fwrite`, `fclose` 

# write data
file_p  = libc.fopen("output.bin", "wb")
sizeof_item = 1 # bytes
nitems  = libc.fwrite(c_uncompData_p, sizeof_item, c_uncompSize, file_p)
retcode = libc.fclose(file_p)
if nitems != c_uncompSize: # not all data were written
   pass
if retcode != 0: # the file was NOT successfully closed
   pass 
```

# c++ - 奇怪的 SAL 注释警告

> ID：652542
> 
> 赞同：3
> 
> 时间：2009-03-16T23:32:16.823
> 
> 标签：c++, annotations, compiler-warnings, sal

我正在尝试为我的项目使用 Micosoft 的 SAL 注释，但是我收到以下警告，我不知道为什么。

例如，我创建了一个新的 C++ 控制台应用程序，并拥有以下代码：

```
#include <sal.h>

class Whatever
{
public:
    _Check_return_ int Method(__in int number) ;
};

int main()
{
    return 0;
} 
```

当我使用 Visual Studio 2008 编译时，我收到以下警告：

警告 C6540：在此函数上使用属性注释将使其所有现有的 __declspec 注释无效

在文件“c1xxast”中

我究竟做错了什么？如果我删除`_Check_return_`或`__in`，警告就会消失。

我找不到对警告 C6550 的任何引用。但是，可以在此处找到相同的文本：http: [//msdn.microsoft.com/en-us/library/dd445322.aspx](http://msdn.microsoft.com/en-us/library/dd445322.aspx)，但这不是很有帮助。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-21T18:08:42.113

问题可能是因为您混合了 SAL 注释类型。虽然在 MSDN 上说得很清楚，但 SAL 注释有两种类型：attribute 和 ... er ... not。

VC2005 中的`#define`s`<sal.h>`使用无属性版本，以下划线开头，后跟**小写**字母。较新的 VC2008 版本扩展到编译器属性，并以下划线后跟**大写**字母开头（和结尾）。

您混合了两种类型：

属性：

*   _在_
*   _Check_return_

非属性：

*   __在
*   __checkReturn

尝试更改注释以始终使用单一类型。

[这篇博客文章](http://ovidiupl.spaces.live.com/blog/cns!1E8A6038167E4BE9!660.entry)对此进行了更多解释。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T23:34:37.053

您必须将 SAL 注释添加到方法的声明和定义中。我猜 SAL 很不高兴，因为它找不到方法的定义并假设缺少属性。

**编辑**澄清

对于非抽象方法，SAL 注释必须出现在两个位置。对于抽象方法，SAL 不会寻找定义。在某些配置中，它实际上将确保接口的实现具有适当的符号。

# scripting - 如何计算一个 cmd 文件的调用次数？

> ID：652544
> 
> 赞同：1
> 
> 时间：2009-03-16T23:32:52.533
> 
> 标签：scripting, batch-file, cmd

如何计算一个 cmd 文件的调用次数？

我正在为这样的事情苦苦挣扎，但它没有用：

```
@IF NOT EXIST Calls.log echo. > Calls.log 
@for  %%i in (Calls.log) do set size=%%~zi
@IF %size% EQU 0 (
@ECHO 1 > Calls.log
) ELSE (
@set /p v=<Calls.log
@set /A v+=1
@echo %v% > Calls.log
) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T01:12:52.090

如果您要做的只是计算调用 cmd 脚本的次数，那么您可以在每次运行时将一个字符附加到文件中，而不是在每次运行脚本时摆弄表达式评估。这还具有使脚本更快的优点，因为计数的分析移到了其他地方。

计数器文件每次扩展一个字节，因此请注意您是否调用它的次数非常多，因为文件会扩展。但即使每秒调用一次，一个 1G 的文件也只能在 30 年后才会累积。

在脚本的顶部，只需输入：

```
set >>countfile.txt <nul: /p x=X 
```

这只是在每次调用脚本时将字符添加`X`到文件的末尾。`countfile.txt`它使用`set/p`带有输入/输出重定向的“”命令，这是我所知道的在没有 CR/LF 之后获取字符的唯一方法（如 UNIX“ `echo -n`”）。

要计算迄今为止的调用次数，您可以使用文件大小环境变量修饰符，如下面的脚本所示（我希望这比运行脚本的频率要低，因此最好将 grunt 工作放在这里 [事实上，这不是很多繁重的工作，因为它不计算字符，而是直接从目录条目中获取信息]）：

```
 @echo off
    goto :main
:getsize
    echo %~z1
    goto :eof
:main
    setlocal enableextensions enabledelayedexpansion
    call :getsize countfile.txt
    endlocal 
```

要重置计数，请使用以下极其复杂的命令（我正在考虑申请专利）：

```
del countfile.txt 
```

我建议的另一件事-您不需要在每个命令前加上“ `@`”来防止回声，您可以简单地将“ `@echo off`”放在脚本顶部以实现全局无回声。如果您想选择性地回显某些命令，请忽略本段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T00:32:48.190

完整的`if`块被立即解析，因此其中的所有环境变量都将在块执行*之前被它们的值替换。*`if`您需要启用延迟变量扩展并使用`!v!`：

```
@setlocal enabledelayedexpansion
@IF NOT EXIST Calls.log echo. > Calls.log
@for  %%i in (Calls.log) do set size=%%~zi
@IF %size% EQU 0 (
    @ECHO 1 > Calls.log
) ELSE (
    @set /p v=<Calls.log
    @set /A v+=1
    @echo !v! > Calls.log
) 
```

您可以将代码简化如下：

```
@echo off
setlocal enabledelayedexpansion
IF NOT EXIST Calls.log (
    ECHO 1 > Calls.log
) ELSE (
    set /p v=<Calls.log
    set /A v+=1
    echo !v! > Calls.log
) 
```

无需事先创建文件（甚至我会用 解决`copy nul Calls.log`，因为这样可以确保文件大小为 0）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T00:48:38.527

以下代码适用于我的电脑：

```
@if not exist Calls.log (
echo 0 > Calls.log
)
@set /p v=< Calls.log
@set /a v=v+1
echo %v% > Calls.log 
```

# c# - 在 C# 中阅读 MS Exchange 电子邮件

> ID：652549
> 
> 赞同：93
> 
> 时间：2009-03-16T23:34:58.423
> 
> 标签：c#, email, exchange-server, mapi

我需要能够监视和阅读来自 MS Exchange Server（我公司内部）上特定邮箱的电子邮件。我还需要能够阅读发件人的电子邮件地址、主题、邮件正文并下载附件（如果有）。

使用 C#（或 VB.NET）执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-03-17T00:30:01.787

一团糟。[Microsoft 正式不支持通过](http://blogs.msdn.com/mstehle/archive/2007/10/03/fyi-why-are-mapi-and-cdo-1-21-not-supported-in-managed-net-code.aspx).NET 互操作 DLL 的 MAPI 或 CDO ——它看起来工作正常，但由于它们不同的内存模型而存在内存泄漏问题。您可以使用 CDOEX，但这仅适用于 Exchange 服务器本身，而不适用于远程；无用。您可以与 Outlook 互操作，但现在您只是对 Outlook 产生了依赖；矫枉过正。最后，您可以使用[Exchange 2003 的 WebDAV 支持](http://msdn.microsoft.com/en-us/library/aa143161.aspx)，但 WebDAV 很复杂，.NET 对它的内置支持很差，而且（雪上加霜）Exchange 2007*几乎完全放弃了*WebDAV 支持。

男人要做什么？我最终使用[AfterLogic 的 IMAP 组件](http://www.afterlogic.com/products/net-imap-component)通过 IMAP 与我的 Exchange 2003 服务器进行通信，结果运行良好。（我通常会寻找免费或开源的库，但我发现所有的 .NET 库都想要——尤其是当涉及到 2003 年 IMAP 实现的一些怪癖时——而且这个库足够便宜，并且可以在第一个试试看。我知道外面还有其他人。）

但是，如果您的组织使用 Exchange 2007，那么您很幸运。[Exchange 2007 带有一个基于 SOAP 的 Web 服务接口](http://msdn.microsoft.com/en-us/library/bb204119.aspx)，它最终提供了一种与 Exchange 服务器交互的统一的、独立于语言的方式。如果您可以要求 2007+，这绝对是要走的路。（对我来说可悲的是，我的公司有一个“但 2003 年没有被打破”的政策。）

如果您需要同时连接 Exchange 2003 和 2007，IMAP 或 POP3 绝对是最佳选择。

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2011-07-08T09:05:50.113

嗯，

我在这里可能有点太晚了，但这不是 EWS 的重点吗？

[https://msdn.microsoft.com/en-us/library/dd633710(EXCHG.80).aspx](https://msdn.microsoft.com/en-us/library/dd633710(EXCHG.80).aspx)

从邮箱中获取邮件大约需要 6 行代码：

```
ExchangeService service = new ExchangeService(ExchangeVersion.Exchange2007_SP1);

//service.Credentials = new NetworkCredential( "{Active Directory ID}", "{Password}", "{Domain Name}" );

service.AutodiscoverUrl( "First.Last@MyCompany.com" );

FindItemsResults<Item> findResults = service.FindItems(
   WellKnownFolderName.Inbox,
   new ItemView( 10 ) 
);

foreach ( Item item in findResults.Items )
{
   Console.WriteLine( item.Subject );
} 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2016-03-17T18:26:12.033

1.  当前首选（Exchange 2013 和 2016）API 是[EWS](https://msdn.microsoft.com/en-us/library/office/dd877012.aspx)。它完全基于 HTTP，可以从任何语言访问，但有[.Net](https://msdn.microsoft.com/en-us/library/office/dn567668.aspx)和[Java](https://github.com/OfficeDev/ews-java-api)特定的库。

    您可以使用[EWSEditor](https://github.com/dseph/EwsEditor)来使用 API。

2.  [扩展 MAPI](https://msdn.microsoft.com/en-us/library/office/cc815424.aspx)。这是 Outlook 使用的本机 API。它最终使用`MSEMS`Exchange MAPI 提供程序，它可以使用 RPC（Exchange 2013 不再支持它）或 RPC-over-HTTP（Exchange 2007 或更高版本）或 MAPI-over-HTTP（Exchange 2013 和更高版本）与 Exchange 通信。

    API 本身只能从非托管 C++ 或[Delphi](http://www.dimastr.com/outspy/download/MAPI_headers.zip)访问。您还可以使用[Redemption](http://www.dimastr.com/redemption)（任何语言） - 它的[RDO](http://www.dimastr.com/redemption/rdo_introduction.htm)对象系列是扩展的 MAPI 包装器。要使用扩展 MAPI，您需要安装 Outlook 或[MAPI 的独立 (Exchange) 版本](https://www.microsoft.com/en-us/download/details.aspx?id=42040)（在扩展支持下，它不支持 Unicode PST 和 MSG 文件，并且无法访问 Exchange 2016）。可在服务中使用扩展 MAPI。

    您可以使用[OutlookSpy](http://www.dimastr.com/outspy/)或[MFCMAPI](https://mfcmapi.codeplex.com/)使用 API 。

3.  [Outlook 对象模型](https://msdn.microsoft.com/en-us/library/office/aa221870(v=office.11).aspx)- 不是特定于 Exchange，但它允许访问运行代码的机器上 Outlook 中的所有可用数据。不能在服务中使用。

4.  [交换活动同步](https://technet.microsoft.com/en-us/library/aa998357.aspx)。Microsoft 不再为此协议投入任何重要资源。

5.  Outlook 用于安装 CDO 1.21 库（它包装了扩展 MAPI），但它已被 Microsoft 弃用并且不再接收任何更新。

6.  曾经有一个名为 MAPI33 的第三方 .Net MAPI 包装器，但它不再被开发或支持。

7.  WebDAV - 已弃用。

8.  用于 Exchange 的协作数据对象 (CDOEX) - 已弃用。

9.  Exchange OLE DB 提供程序 (EXOLEDB) - 已弃用。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-17T01:20:25.457

这是我用来做 WebDAV 的一些旧代码。我认为它是针对 Exchange 2003 编写的，但我不记得了。如果有帮助，请随意借用...

```
class MailUtil
{
    private CredentialCache creds = new CredentialCache();

    public MailUtil()
    {
        // set up webdav connection to exchange
        this.creds = new CredentialCache();
        this.creds.Add(new Uri("http://mail.domain.com/Exchange/me@domain.com/Inbox/"), "Basic", new NetworkCredential("myUserName", "myPassword", "WINDOWSDOMAIN"));
    }

    /// <summary>
    /// Gets all unread emails in a user's Inbox
    /// </summary>
    /// <returns>A list of unread mail messages</returns>
    public List<model.Mail> GetUnreadMail()
    {
        List<model.Mail> unreadMail = new List<model.Mail>();

        string reqStr =
            @"<?xml version=""1.0""?>
                <g:searchrequest xmlns:g=""DAV:"">
                    <g:sql>
                        SELECT
                            ""urn:schemas:mailheader:from"", ""urn:schemas:httpmail:textdescription""
                        FROM
                            ""http://mail.domain.com/Exchange/me@domain.com/Inbox/"" 
                        WHERE 
                            ""urn:schemas:httpmail:read"" = FALSE 
                            AND ""urn:schemas:httpmail:subject"" = 'tbintg' 
                            AND ""DAV:contentclass"" = 'urn:content-classes:message' 
                        </g:sql>
                </g:searchrequest>";

        byte[] reqBytes = Encoding.UTF8.GetBytes(reqStr);

        // set up web request
        HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create("http://mail.domain.com/Exchange/me@domain.com/Inbox/");
        request.Credentials = this.creds;
        request.Method = "SEARCH";
        request.ContentLength = reqBytes.Length;
        request.ContentType = "text/xml";
        request.Timeout = 300000;

        using (Stream requestStream = request.GetRequestStream())
        {
            try
            {
                requestStream.Write(reqBytes, 0, reqBytes.Length);
            }
            catch
            {
            }
            finally
            {
                requestStream.Close();
            }
        }

        HttpWebResponse response = (HttpWebResponse)request.GetResponse();
        using (Stream responseStream = response.GetResponseStream())
        {
            try
            {
                XmlDocument document = new XmlDocument();
                document.Load(responseStream);

                // set up namespaces
                XmlNamespaceManager nsmgr = new XmlNamespaceManager(document.NameTable);
                nsmgr.AddNamespace("a", "DAV:");
                nsmgr.AddNamespace("b", "urn:uuid:c2f41010-65b3-11d1-a29f-00aa00c14882/");
                nsmgr.AddNamespace("c", "xml:");
                nsmgr.AddNamespace("d", "urn:schemas:mailheader:");
                nsmgr.AddNamespace("e", "urn:schemas:httpmail:");

                // Load each response (each mail item) into an object
                XmlNodeList responseNodes = document.GetElementsByTagName("a:response");
                foreach (XmlNode responseNode in responseNodes)
                {
                    // get the <propstat> node that contains valid HTTP responses
                    XmlNode uriNode = responseNode.SelectSingleNode("child::a:href", nsmgr);
                    XmlNode propstatNode = responseNode.SelectSingleNode("descendant::a:propstat[a:status='HTTP/1.1 200 OK']", nsmgr);
                    if (propstatNode != null)
                    {
                        // read properties of this response, and load into a data object
                        XmlNode fromNode = propstatNode.SelectSingleNode("descendant::d:from", nsmgr);
                        XmlNode descNode = propstatNode.SelectSingleNode("descendant::e:textdescription", nsmgr);

                        // make new data object
                        model.Mail mail = new model.Mail();
                        if (uriNode != null)
                            mail.Uri = uriNode.InnerText;
                        if (fromNode != null)
                            mail.From = fromNode.InnerText;
                        if (descNode != null)
                            mail.Body = descNode.InnerText;
                        unreadMail.Add(mail);
                    }
                }

            }
            catch (Exception e)
            {
                string msg = e.Message;
            }
            finally
            {
                responseStream.Close();
            }
        }

        return unreadMail;
    }
} 
```

和model.Mail：

```
class Mail
{
    private string uri;
    private string from;
    private string body;

    public string Uri
    {
        get { return this.uri; }
        set { this.uri = value; }
    }

    public string From
    {
        get { return this.from; }
        set { this.from = value; }
    }

    public string Body
    {
        get { return this.body; }
        set { this.body = value; }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T00:03:59.463

我使用了[在 CodeProject.com 上发布的代码](http://www.codeproject.com/KB/IP/Pop3MimeClient.aspx)。如果您想使用 POP3，它是我找到的更好的解决方案之一。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T23:50:03.053

如果您的 Exchange 服务器配置为支持 POP 或 IMAP，那么这是一个简单的方法。

另一种选择是 WebDAV 访问。有一个可用的[库](http://www.independentsoft.de/webdavex/index.html)。这可能是您最好的选择。

我认为有使用 COM 对象访问 Exchange 的选项，但我不确定它有多容易。

我猜这完全取决于您的管理员到底愿意为您提供什么访问权限。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T00:01:17.720

您应该能够使用 MAPI 访问邮箱并获取您需要的信息。不幸的是，我所知道的唯一 .NET MAPI 库 (MAPI33) 似乎没有维护。这曾经是通过 .NET 访问 MAPI 的好方法，但我现在无法评价它的有效性。有关您可以从何处获取它的更多信息：[MAPI33.dll 的下载位置？](https://stackoverflow.com/questions/362359/download-location-for-mapi33dll)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T01:17:27.397

我最终得到了一个使用 Redemption 的解决方案，看看这些问题......

*   [使用赎回...](https://stackoverflow.com/questions/589254/using-redemption-outlook-with-a-user-other-than-the-logged-in-user-and-gettin/652720#652720)

*   [在 64 位机器上使用 Redemption](https://stackoverflow.com/questions/593636/using-redemption-dll-outlook-on-a-64-bit-machine)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-17T03:58:32.533

一种选择是使用 Outlook。我们有一个邮件管理器应用程序可以访问交换服务器并使用 Outlook 作为界面。它很脏，但它有效。

示例代码：

```
public Outlook.MAPIFolder getInbox()
        {
            mailSession = new Outlook.Application();
            mailNamespace = mailSession.GetNamespace("MAPI");
            mailNamespace.Logon(mail_username, mail_password, false, true);
            return MailNamespace.GetDefaultFolder(Outlook.OlDefaultFolders.olFolderInbox);
        } 
```

# c# - 如何从 WPF 应用程序中检测到 Lock This Computer 命令？

> ID：652550
> 
> 赞同：21
> 
> 时间：2009-03-16T23:35:21.637
> 
> 标签：c#, wpf, desktop, locking

更喜欢使用 WPF 的 C#、.Net 3.5 中的答案（Windows 窗体也可以）

我有一个应用程序，它本质上是一个工具栏窗口或托盘图标。它需要检测用户是否锁定了他/她的工作站并离开，以便在集中式系统中更新此人的状态。

使用 SystemEvents，我可以很容易地检测到会话切换或注销，但我终生无法弄清楚如何检测或接收 Lock 事件。

感谢您的任何帮助。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-03-16T23:44:30.070

当您处理[`Microsoft.Win32.SystemEvents.SessionSwitch`](http://msdn.microsoft.com/en-us/library/microsoft.win32.systemevents.sessionswitch(VS.85).aspx)事件时（听起来您已经在检测注销），请检查是否`Reason`为：[`SessionSwitchReason`](http://msdn.microsoft.com/en-us/library/microsoft.win32.sessionswitchreason.aspx)`.SessionLock`

```
 using Microsoft.Win32;
 // ...
 // Somewhere in your startup, add your event handler:
    SystemEvents.SessionSwitch += 
       new SessionSwitchEventHandler(SystemEvents_SessionSwitch);
 // ...

 void SystemEvents_SessionSwitch(object sender, SessionSwitchEventArgs e)
 {
     switch(e.Reason)
     {
         // ...
         case SessionSwitchReason.SessionLock:
            // Do whatever you need to do for a lock
            // ...
         break;
         case SessionSwitchReason.SessionUnlock:
            // Do whatever you need to do for an unlock
            // ...
         break;
         // ...
     }
 } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T23:42:47.407

您需要[P/Invoke](https://docs.microsoft.com/en-us/dotnet/framework/interop/platform-invoke-examples) [`WTSRegisterSessionNotification`](http://pinvoke.net/default.aspx/wtsapi32.WTSRegisterSessionNotification "样品在这里")。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T23:43:25.190

这是来自 CodeProject 的内容。

[http://www.codeproject.com/KB/vb/DetectWindowslockunlock.aspx](http://www.codeproject.com/KB/vb/DetectWindowslockunlock.aspx)

# java - 有人可以解释 ivy.xml 依赖项的 conf 属性吗？

> ID：652555
> 
> 赞同：69
> 
> 时间：2009-03-16T23:36:11.277
> 
> 标签：java, apache, ant, ivy

我找不到关于 Ivy 依赖标签的*conf*属性的任何详尽解释：

```
<dependency org="hibernate" name="hibernate" rev="3.1.3" conf="runtime, standalone -> runtime(*)"/> 
```

看到那个*conf*属性了吗？`->`我找不到关于符号右侧的任何解释（我能理解） 。请记住，我不知道关于 Maven 的第一件事，所以请考虑到这一点来解释这个属性。

是的，我已经看过这个：[http ://ant.apache.org/ivy/history/latest-milestone/ivyfile/dependency.html](http://ant.apache.org/ivy/history/latest-milestone/ivyfile/dependency.html)

谢谢，
丹

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-03-17T08:44:07.997

首先，[Ivy 不是 Maven](http://ant.apache.org/ivy/m2comparison.html) ;)
Maven2 是一个软件项目管理和理解工具，而 Ivy 只是一个依赖管理工具。

Ivy 在很大程度上依赖于一个称为**配置**的独特概念。
在 Ivy 中，模块配置是一种**使用或查看模块**的方式。
例如，您可以在模块中进行测试和运行时配置。但您也可以拥有 MySQL 和 Oracle 配置。或者 Hibernate 和 JDBC 配置。

在每个配置中，您可以声明：

*   需要什么工件（jar，war，...）。
*   您对其他模块的依赖关系，并描述您需要的依赖项配置。这称为配置映射。

所以[conf](http://ant.apache.org/ivy/history/latest-milestone/ivyfile/dependency-conf.html)属性正是这样做的： 描述依赖项的配置映射。
映射的[子元素](http://ant.apache.org/ivy/history/latest-milestone/ivyfile/mapped.html)是您的“符号右侧`->`”，表示映射的依赖项配置的名称。`'*'`通配符可用于指定该模块的所有配置。

[在查理哈伯德](https://sourceforge.net/u/charliehubbard/profile/)的“[常春藤配置的最简单解释](http://wrongnotes.blogspot.com/2014/02/simplest-explanation-of-ivy.html)”中查看更多信息

> 其中重要的部分是 Ivy 下载依赖项并组织它们。
> 
> 一个常春藤模块（即`ivy.xml`文件）有两个主要部分：
> 
> *   你需要什么依赖？
> *   你希望他们如何组织？
> 
> 第一部分配置在`<dependencies>`元素下。
> 第二个由`<configurations>`元素控制
> 
> 当 Ivy 下载这些依赖项时，它需要知道在拉取这些传递依赖项时要使用什么范围（我们是为了测试、运行时、编译等而拉取它吗？）。我们必须告诉 Ivy 如何将我们的配置映射到 Maven 范围，以便它知道要拉取什么。

* * *

Maven2 本身有一个叫做**scope**的东西。
您可以将依赖项声明为测试范围或构建时范围的一部分。
然后根据这个范围，您将获得依赖项工件（maven2 中每个模块只有一个工件），其依赖项取决于它们的范围。范围是在 maven2 中预定义的，您无法更改它。

这意味着：

> 许多库下载了很多不必要的依赖项*。*
> 例如，Hibernate 下载一堆 JBoss JAR，而 Display Tag 下载所有各种 Web 框架 JAR。我发现自己排除了几乎和我添加的一样多的依赖项。

问题是 hibernate 可以与多个缓存实现、多个连接池实现一起使用……而这不能通过范围进行管理，而 Ivy 配置为此类问题提供了一个优雅的解决方案。
例如，在 Ivy 中，**假设 hibernate 有一个像这样的 Ivy 文件**，那么你可以像这样声明一个依赖项：

```
<dependency org="hibernate" name="hibernate" rev="2.1.8" conf="default->proxool,oscache"/> 
```

使用它的 proxool 和 oscache 实现来休眠，就像这样：

```
<dependency org="hibernate" name="hibernate" rev="2.1.8" conf="default->dbcp,swarmcache"/> 
```

使用 dbcp 和 swarmcache 进入休眠状态。

通过将您的默认`master`配置映射到“ `proxool,oscache`”或“ ”，您可以从模块“休眠”中*准确*`dbcp,swarmcache`指定您需要的内容。

 ** * *

您可以通过列出为与库关联的每个模块定义的 Ivy 配置来找到这些“proxool，...”参数。例如：

```
<ivy-module version="2.0">
<info organisation="ssn-src" module="pc"/>
<configurations defaultconfmapping="default->default">
    <conf name="default" />
    <conf name="provided" description="they are provided by the env." />
    <conf name="compile" extends="default,provided" />
    <conf name="war" extends="default"/>
</configurations>
<dependencies> 
```

[示例](http://mail-archives.apache.org/mod_mbox/ant-ivy-user/200812.mbox/%3C7916a6a60812030821u6f831ad2ub0921b2bfac8ec63@mail.gmail.com%3E)：

> 假设`modA`有两个配置，默认和测试。
> 实际上，想要省略`conf`依赖元素的属性是非常不寻常的。for可能有依赖关系
> ：`ivy.xml``modA`

```
<dependency org="theteam" name="modB" rev="1.0" conf="default->*" /> 
```

> 您从默认开始，而不是从默认和测试开始。
> 
> 上面的例子使 modA 的默认值依赖于 modB 的 conf1、conf2 和 conf3。
> 或者你可能想说 modA 的默认值只取决于 modB 的 conf1：

```
<dependency org="theteam" name="modB" rev="1.0" conf="default->*conf1*" /> 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2014-02-17T22:02:42.020

我已经阅读了这些答案，坦率地说，我觉得它们没有多大帮助。我认为它们可以改进，所以我通过展示一个实际示例来写下我如何使用和理解配置：

[http://wrongnotes.blogspot.com/2014/02/simplest-explanation-of-ivy.html](http://wrongnotes.blogspot.com/2014/02/simplest-explanation-of-ivy.html)

不幸的是，您必须对 maven 及其依赖有所了解，因为 Ivy 使用 Maven 存储库来下载这些 jar 文件。因此，Ivy 必须了解 Maven 并将其传递给您。但是，我认为我保持它非常简单，而没有过多地介绍有关 maven 的细节。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-07-31T20:50:36.627

感谢VonC！

它进一步帮助了我。

当涉及到选项（配置）tieTYT 时，您可以在 Ivy 存储库中的 ivy-[revision number].xml 文件中找到它们：组织名称 --> 模块名称。

从[http://www.springsource.com/repository/app/](http://www.springsource.com/)下载的 JUnit 4.6 修订版的示例配置元素。

```
<configurations>
    <conf name="compile" visibility="public" description="Compile dependencies"/>
    <conf name="optional" visibility="public" extends="compile" description="Optional dependencies"/>
    <conf name="provided" visibility="public" description="Provided dependencies"/>
    <conf name="runtime" visibility="public" extends="compile" description="Runtime dependencies"/>
</configurations> 
```

在我项目的 ivy.xml 文件中，我有一个配置编译测试。在依赖项元素中，我具有以下依赖项：

```
<dependency org="org.junit" name="com.springsource.org.junit"
        rev="4.6.0" conf="compile-test->compile" /> 
```

如您所见，我的编译测试配置依赖于 JUnit 的 ivy.xml 文件中的编译配置。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-05-04T17:15:15.010

它曾经帮助我以这种方式理解事物：

1.  ivy 配置只是模块工件的某些子集的名称。
2.  模块之间的依赖关系是根据配置名称指定的。

# asp.net-2.0 - 如何使用 ASP.NET 自动刷新网页？

> ID：652557
> 
> 赞同：0
> 
> 时间：2009-03-16T23:38:10.023
> 
> 标签：asp.net-2.0, refresh

我有一个可以“模拟”实时视频的 asp.net 应用程序。我这样做是从 mysql 数据库中获取多张图片。

问题是如何在网页上显示它。？我每张图片刷新页面 1 秒，结果是图片断断续续和闪烁。

```
 Response.AppendHeader("Refresh", "1") 
```

如何使页面的刷新率达到每秒 4 次？或者是否有任何实现以大陆方式显示。

如果您能回复，我将不胜感激。美好的一天（^_^）...

这是我用来从数据库中读取图像的脚本。

If dr.Read Then dr.Read() Response.ContentType = "image/jpeg" '获取或设置输出流的类型 Response.BinaryWrite(dr.Item("file")) '将二进制字符流写入http 输出流 Else Response.Write("目前没有活动的网络广播。") End If dr.Close()

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T23:45:50.830

```
create a javascript method to change the image using xmlhttpobject and recursively set a timer

         function Timer() {

             setTimeout("getImage(['imageContainer1'])", 200);
             t = setTimeout("Timer()", 100);
                       }

        function getImage(params) {
            var request=getXMLhttpObject();
            makeRequest("ajax/ObtainImage.aspx?name='myimage'+param[1]+'.jpg",request,  imageResponseHandler(request, params));

                   }

    function getXMLhttpObject() {

            return  (navigator.appName == "Microsoft Internet Explorer")? new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();
                              }

 function makeRequest(url,request, Handler) {

             request.open("GET", url, true);
             request.onreadystatechange = Handler;
             request.send(null);

         }

    function imageResponseHandler(request,params) {
             return function() {
                 if (request.readyState == 4)
                     document.getElementById(params[0]).src = request.responseText;
             }

         } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T23:40:42.997

我会使用一些 Javascript/Ajax 来更改内容或元刷新（可能不是快速刷新的最佳选择）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T23:43:54.970

也许您需要考虑在页面上加载多张图片并使用 javascript 在它们之间循环。您可以使用 AJAX 获取图片，而不是刷新页面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T23:56:03.897

如果你真的想模拟视频，你需要能够每秒至少显示 15 张图片（15fps）。每秒发出这么多请求并不是一个好主意。

如果你绝对必须这样做，我建议先“缓冲”图片，然后再显示它们，如果可能的话，分批获取它们：

```
buffer = []       // cache loaded images
bufferSize = 30   // load 30 images before playing

function loadImage(src) {
   var img = new Image()
   img.src = src
   buffer.push(img)
}

function animate(target) {
   if (buffer.length > 0) {
      var img = buffer.shift()
      document.getElementById(target).src = img.src
   }
}

function bufferImages() {
   for (var i=0; i<bufferSize; i++) {
      loadImage('/ajax/ObtainImage.aspx?name=img')
   }
}

setInterval("animate('imgTarget')", 65)  // should give us about 15fps 
setInterval("bufferImages()", 1000)  // every second 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-27T21:58:17.443

将此添加到您的 html 文档的头部。不是最有效的方法，但它会起作用。

```
<meta http-equiv="refresh" content=".25" /> 
```

# javascript - Visual Studio 中 CSS/javascript 的 Vim 样式折叠

> ID：652577
> 
> 赞同：5
> 
> 时间：2009-03-16T23:45:15.280
> 
> 标签：javascript, css, visual-studio, code-organization

有没有人知道在 Visual Studio 中进行[VIM 样式折叠的方法？](http://www.linux.com/articles/114138)我在 c# 类文件中使用 #region 块，它们很棒，但不幸的是，javascript 和 css 没有等效的功能。我目前正在处理的网站/应用程序有相当多的 css 选择器和 javascript，并且导航单个文件变得越来越困难。

我们考虑过的一种选择是将 css 和 javascript 分解为类似于 jquery 模块的单独文件，但这会在增加 http 请求的总数方面引入性能问题。

如果有人对管理疯狂有任何建议，我将不胜感激！

**更新**：Richard Kimber 建议[使用 Visual Studio 的书签功能](http://blog.dogma.co.uk/2009/02/javascriptcss-bookmark-tip-for-visual.html)使按标题导航更易于管理。这是朝着正确方向迈出的一步，但不如代码折叠/阻塞有用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-01-18T19:58:02.053

我发现了一个 Microsoft 扩展，它改进了 Visual Studio 2010 的 JavaScript 文本编辑器。

[http://visualstudiogallery.msdn.microsoft.com/en-us/872d27ee-38c7-4a97-98dc-0d8a431cc2ed](http://visualstudiogallery.msdn.microsoft.com/en-us/872d27ee-38c7-4a97-98dc-0d8a431cc2ed)

我已经使用过它，它为 JavaScript 文件提供了以下所有内容：

*   大括号匹配
*   大纲/代码折叠
*   当前单词突出显示
*   IntelliSense 文档评论支持

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T22:07:29.960

我知道我并没有真正帮助解决这个问题，但你听说过[ViEmu 吗](http://www.viemu.com/)？可以说，它是 VS 中的 vim 仿真。尽管它不支持 vim 的所有功能，但它确实为 VS 导航带来了一种味道。我自己没有用过，但其他人说得很好，所以你可能想试一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-08T19:41:27.410

我目前正在使用[Brian Grinstead](https://stackoverflow.com/users/76137/brian-grinstead)建议的[JScript Editor Extensions 。](http://visualstudiogallery.msdn.microsoft.com/872d27ee-38c7-4a97-98dc-0d8a431cc2ed/)如果它支持区域折叠，我还没有弄清楚如何。它确实支持 JavaScript 中的函数折叠。

还有[JSEnhancements](http://visualstudiogallery.msdn.microsoft.com/0696ad60-1c68-4b2a-9646-4b5f4f8f2e06)和[JSOutlining](http://jsoutlining.codeplex.com/)。虽然没有尝试过其中任何一个。

这个问题是[this](https://stackoverflow.com/questions/1921628/how-to-implement-regions-code-collapse-in-javascript)和[this](https://stackoverflow.com/questions/652577/vim-style-folding-for-css-javascript-in-visual-studio)的部分副本。

# sql - 用于建立优先级的 Sql 数据库查询设计

> ID：652582
> 
> 赞同：2
> 
> 时间：2009-03-16T23:48:39.030
> 
> 标签：sql, database, join

我在尝试编写查询时遇到问题。

我的表格布置如下：

```
tblTicketIssues
TicketID | RequesterID

tblPersonnelProfile
PersonnelID | FirstName | LastName

tblTicketAttribute
TicketID | Attribute | AttributeValue 
```

我必须显示以下字段：

```
TicketID, 
RequesterFullName, 
UrgentPriorityID, 
MediumPriorityID, 
LowPrioritytID 
```

这是具有挑战性的部分：

> 如果 tblTicketAttribute.Attribute= "Urgent" 那么来自 tblTicketAttribute.AttributeValue 的值将显示在 UrgentPriority 列中
> 
> 如果 tblTicketAttribute.Attribute= "Medium" 则 tblTicketAttribute.AttributeValue 的值显示在 MediumPriority 列中
> 
> 如果 tblTicketAttribute.Attribute= "Low" 则 tblTicketAttribute.AttributeValue 的值显示在 LowPriority 列中

中的值`tblTicketAttribute.Attribute`包括“**紧急**”、“**中**”、“**低**”、“ **30 岁以上**”、“ **60 岁以上**”、“ **90 岁以上**”、“**已关闭**”

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T00:02:16.597

查看 CASE 语句。

```
select
 ticketID
 ,Lastname +', '+firstname
 ,CASE attribute 
      WHEN 'Urgent' THEN attributeValue 
      ELSE '' 
 END as UrgentPriorityID
 ,CASE attribute 
      WHEN 'Medium' THEN attributeValue 
      ELSE '' 
 END as MediumPriorityID
 ,CASE attribute 
      WHEN 'Low' THEN attributeValue 
      ELSE '' 
 END as LowPrioritytID

from
 ... 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T00:04:00.397

我已经假设它`RequestorID`是`PersonnelID`主键的外键`tblPersonnelProfile`。这应该适用于 SQL Server

```
SELECT
    issues.TicketID, 
    personnel.FirstName + ' ' + personnel.LastName AS RequesterFullName, 
    CASE WHEN attribute.Attribute = 'Urgent' THEN attribute.AttributeValue ELSE NULL END AS UrgentPriorityID, 
    CASE WHEN attribute.Attribute = 'Medium' THEN attribute.AttributeValue ELSE NULL END AS MediumPriorityID, 
    CASE WHEN attribute.Attribute = 'Low' THEN attribute.AttributeValue ELSE NULL END AS LowPrioritytID
FROM
    tblTicketIssues issues
INNER JOIN
    tblPersonnelProfile personnel
ON
    issues.RequestorID = personnel.PersonnelID
INNER JOIN
    tblTicketAttribute attribute
ON
    issues.TicketID = attribute.TicketID 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T01:40:37.873

使用`CASE`jms 或 Russ 所做的语句可能是更好的方法，但您也可以使用子选择来解决问题：

```
SELECT  ti.TicketID,
        pp.FirstName || ' ' || pp.LastName AS RequesterFullName,
        (SELECT ta.AttributeValue FROM tblTicketAttribute AS ta WHERE ta.Attribute = 'Urgent' AND ta.TicketID = ti.TicketID) AS UrgentPriorityID,
        (SELECT ta.AttributeValue FROM tblTicketAttribute AS ta WHERE ta.Attribute = 'Medium' AND ta.TicketID = ti.TicketID) AS MediumPriorityID,
        (SELECT ta.AttributeValue FROM tblTicketAttribute AS ta WHERE ta.Attribute = 'Low' AND ta.TicketID = ti.TicketID) AS LowPriorityID
FROM    tblTicketIssues AS ti
        INNER JOIN tblPersonnelProfile AS pp ON ti.RequestorID = pp.PersonnelID; 
```

我怀疑这`CASE`会快得多，但在你测量之前你永远不会知道，有时子选择方法是你唯一的选择。`WHERE`如果谓词为假，您将在子选择列中自动获得 NULL 。

此外，您还可以看到格式化 SQL 查询的完整方式，以及更多的 Oracle 式连接运算符。

我还应该提到，如果 tblTicketAttribute 中的 TicketID 列不是唯一的，则子选择将不起作用，但如果是这种情况，其他选项也可能会产生不稳定的结果。

# java - .NET 世界是否有 Maven 替代方案或端口？

> ID：652583
> 
> 赞同：73
> 
> 时间：2009-03-16T23:48:44.897
> 
> 标签：java, .net, maven-2, build-process, build

.NET 世界是否有 Maven 替代方案或端口？

我很想使用 Java 世界拥有的良好依赖管理系统，但我找不到任何可与 .NET 项目相媲美的东西......

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-09-08T20:56:53.243

[NMaven](http://incubator.apache.org/nmaven/)是为 .NET提供[Apache Maven](http://maven.apache.org/)的第一个/官方努力；该项目未能通过 Apache 官方项目的高要求，并于 2008 年 11 月从 Apache 孵化器中退出。为了分叉和生存该项目已经进行了多次努力，但只有一个（[NPanday](http://incubator.apache.org/npanday/)）成功了并且已经能够在 2010 年 8 月重新加入 Apache 孵化器。遗憾的是，NPanday 项目也于 2015 年 1 月退役，因为它缺乏活跃的提交者。

*   活跃项目（截至 2015 年 7 月）

    *   没有任何

*   非活动项目（截至 2015 年 7 月）

    *   [NMaven：执行 .NET 构建的 Maven 插件。](http://nmaven.codeplex.com/)

    *   [Byldan：一个 .NET 版本的 Maven。用 C# 编写。](http://byldan.codeplex.com/)

    *   [Npanday：一个将 Apache Maven 集成到 .NET 开发环境中的项目。](http://incubator.apache.org/npanday/)

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2010-12-07T08:09:46.607

[NuGet](http://nuget.codeplex.com/)（以前称为 NuPack）解决了 Maven 的一些特性。[您可以在Phil Haack](http://haacked.com/archive/2010/11/09/nuget-ctp2-released.aspx)、[Scott Hanselman](http://www.hanselman.com/blog/PDC10BuildingABlogWithMicrosoftUnnamedPackageOfWebLove.aspx)，当然还有[Scott Guthrie](http://weblogs.asp.net/scottgu/archive/2010/10/06/announcing-nupack-asp-net-mvc-3-beta-and-webmatrix-beta-2.aspx)处了解它。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-22T21:48:29.020

[Byldan](http://www.codeplex.com/byldan/)是 Maven 的一个端口，但它不是 100% 的工具模拟。Shane Isbell 从事这个项目已经有一段时间了，你可以[在这里阅读更多关于它的信息](http://www.sonatype.com/people/tag/byldan/)。

尽管引用 NMaven 的答案旁边有某种绿色复选框，但它是不正确的：没有任何东西称为 Apache NMaven，因为该项目从未脱离 ASF 孵化器。主干继续作为 Codeplex 的 NMaven 存在。NMaven 是用 Java 编写的，而 Byldan 是用 C# 编写的。大多数为 .NET 平台寻找 Maven 之类的东西的人不会想要处理用 Java 编写的工具。Byldan，IMO，是最合适的工具，因为它是用 C# 编写的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-10-06T20:51:43.390

似乎虽然所有似乎都缺乏[Npanday](http://incubator.apache.org/npanday/)是最成熟和积极开发的 .NET Maven 依赖管理，如果我必须打赌，那就是那个。我认为理想情况下，任何 .NET 解决方案都将与[Byldan](http://byldan.codeplex.com/)之类的 Maven 兼容，因此它可以使用相同的 Maven 存储库，例如 Maven 中心。

我对最初看起来比 NPanday 更有希望的 Byldan 的问题是，它自 2008 年以来一直没有得到积极开发，NPanday 于 9 月 8 日发布，从 2008 年开始，从 1.2.1 版到 Byldan 的 0.6 版。

**更新：**

似乎 NuGet 确实在 .NET 世界中执行了一些 Maven 类型的功能。如果没有明确这样做，微软似乎也隐含地支持 NuGet。完全公开我没有使用 NuGet 的经验，但根据 2011 年 11 月的 MSDN 杂志文章[here](http://msdn.microsoft.com/en-us/magazine/hh547106.aspx)，它看起来很有希望。NuGet 还具有完整的 Visual Studio 2010 集成并支持 Windows Phone、Silverlight 和 Windows Presentation Foundation。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-03-11T09:36:30.727

David Ebbo 使用[NuGet](http://en.wikipedia.org/wiki/NuGet)完成了一些额外的工作。有关更多详细信息，请参阅他的博文*[使用 NuGet 而无需提交包](http://blog.davidebbo.com/2011/03/using-nuget-without-committing-packages.html)*。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-24T04:46:33.607

还有一个名为[Refix](http://refix.codeplex.com/)的项目。想法？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T21:11:07.467

[Apache NMaven 是一套插件和集成](http://incubator.apache.org/nmaven/)，允许 .NET 代码在 Maven 构建脚本中发挥作用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-03-24T04:48:07.897

[CodePlex](http://en.wikipedia.org/wiki/CodePlex)上的另一个是[Crude](http://crude.codeplex.com/)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-24T15:11:01.137

[Naven](https://bitbucket.org/fhenus/naven/overview)似乎是最近针对 .NET 构建过程的声明性方法的一项举措。

来自 Java 背景，对我来说，这是 .NET 生态系统中最缺乏的部分之一。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-02-05T06:54:01.317

[Gradle](https://docs.gradle.org/current/userguide/userguide.html)可能是一个可能的替代方案。它目前不[支持原生 C# - 仅支持 Java 和 C++](https://github.com/gradle/gradle/issues/1428)。然而，.Net 的插件[至少有一个似乎仍然活跃](https://github.com/CombinationAB/gradle-dotnet-plugin)。后者在技术上是一个包装器，您仍然需要安装 dot-net 工具。

# linq-to-sql - 领域驱动设计 (Linq to SQL) - 如何删除聚合的一部分？

> ID：652585
> 
> 赞同：7
> 
> 时间：2009-03-16T23:49:15.097
> 
> 标签：linq-to-sql, domain-driven-design, repository-pattern

我似乎对整个 DDD\LinqToSql 业务感到有些困惑。我正在使用 POCOS 和 linq to sql 构建一个系统，并且我有聚合根的存储库。因此，例如，如果您有 Order->OrderLine 类，那么您有一个 Order 存储库，但没有 OrderLine，因为 Order 是聚合的根。仓库有删除Order的delete方法，但是如何删除OrderLines呢？您可能会认为您在 Order 上有一个名为 RemoveOrderLine 的方法，该方法从 OrderLines 集合中删除了该行，但它还需要从底层 l2s 表中删除 OrderLine。由于没有 OrderLine 存储库，您应该怎么做？

也许有专门的公共存储库来查询域对象实际用于删除聚合中的内容的根和内部通用存储库？

```
public class OrderRepository : Repository<Order> {
    public Order GetOrderByWhatever();
}

public class Order {
    public List<OrderLines> Lines {get; set;} //Will return a readonly list
    public RemoveLine(OrderLine line) {
        Lines.Remove(line);
        //************* NOW WHAT? *************//
        //(new Repository<OrderLine>(uow)).Delete(line) Perhaps??
        // But now we have to pass in the UOW and object is not persistent ignorant. AAGH!
    }
} 
```

我很想知道其他人做了什么，因为我不能成为唯一一个为此苦苦挣扎的人....我希望....谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T01:46:53.380

您在调用相关逻辑的订单上调用 RemoveOrderLine。这不包括对它的持久版本进行更改。

稍后，您在存储库上调用 Save/Update 方法，该方法接收修改后的订单。具体的挑战在于了解域对象中发生了什么变化，有几个选项（我相信不止我列出的选项）：

*   让域对象跟踪更改，其中包括跟踪需要从订单行中删除 x。类似于实体跟踪的东西也可能被排除在外。
*   加载持久版本。在存储库中拥有识别持久版本和内存版本之间差异的代码，并运行更改。
*   加载持久版本。在根聚合中有代码，可以让您在给定原始根聚合的情况下获得差异。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T02:09:54.777

首先，您应该公开接口以获取对聚合根的引用（即 Order()）。使用工厂模式来新建聚合根的新实例（即 Order()）。

话虽如此，您的 Aggregate Root 上的方法控制对其相关对象的访问 - 而不是自身。此外，切勿在聚合根（即您在示例中说明的 Lines() IList 集合）上公开复杂类型。这违反了减量法则 (sp ck)，即您不能“点走”您的方法，例如 Order.Lines.Add()。

而且，您违反了允许客户端访问对聚合根上的内部对象的引用的规则。聚合根*可以*返回内部对象的引用。只要不允许外部客户端持有对该对象的引用。即，您传递给RemoveLine() 的“OrderLine”。您不能允许外部客户端控制模型的内部状态（即 Order() 及其 OrderLines()）。因此，您应该期望 OrderLine 是一个新的实例，并据此采取行动。

```
public interface IOrderRepository
{
  Order GetOrderByWhatever();
}

internal interface IOrderLineRepository
{
  OrderLines GetOrderLines();
  void RemoveOrderLine(OrderLine line);
}

public class Order
{
  private IOrderRepository orderRepository;
  private IOrderLineRepository orderLineRepository;
  internal Order()
  {
    // constructors should be not be exposed in your model.
    // Use the Factory method to construct your complex Aggregate
    // Roots.  And/or use a container factory, like Castle Windsor
    orderRepository = 
            ComponentFactory.GetInstanceOf<IOrderRepository>();
    orderLineRepository = 
            ComponentFactory.GetInstanceOf<IOrderLineRepository>();
  }
  // you are allowed to expose this Lines property within your domain.
  internal IList<OrderLines> Lines { get; set; }  
  public RemoveOrderLine(OrderLine line)
  {
    if (this.Lines.Exists(line))
    {
      orderLineRepository.RemoveOrderLine(line);
    }
  }
} 
```

不要忘记创建 Order() 新实例的工厂：

```
public class OrderFactory
{
  public Order CreateComponent(Type type)
  {
    // Create your new Order.Lines() here, if need be.
    // Then, create an instance of your Order() type.
  }
} 
```

您的外部客户端确实有权通过接口直接访问 IOrderLinesRepository，以获取聚合根中值对象的引用。但是，我试图通过强制我的引用全部脱离聚合根的方法来阻止它。因此，您可以将上面的 IOrderLineRepository 标记为内部的，这样它就不会暴露。

我实际上将我所有的聚合根创建分组到多个工厂中。我不喜欢“一些聚合根将拥有复杂类型的工厂，而另一些则没有”的方法。在整个领域建模中遵循相同的逻辑要容易得多。“哦，所以 Sales() 是像 Order() 一样的聚合根。它也必须有一个工厂。”

最后一点是，如果有一个组合，即 SalesOrder()，它使用 Sales() 和 Order() 两种模型，您将使用服务来创建和操作该 SalesOrder() 实例，而不是 Sales()或 Order() 聚合根，也不是它们的存储库或工厂，拥有对 SalesOrder() 实体的控制权。

我强烈推荐[这本](http://www.infoq.com/minibooks/domain-driven-design-quickly)由 Abel Avram 和 Floyd Marinescu 撰写的关于域驱动设计 (DDD) 的免费书籍，因为它以 100 页的大字体直接回答了您的问题。以及如何将您的域实体更多地解耦为模块等。

编辑：添加更多代码

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-04T23:10:27.570

在解决了这个确切的问题之后，我找到了解决方案。在查看了设计师使用 l2sl 生成的内容后，我意识到解决方案是 order 和 orderline 之间的双向关联。一个订单有多个订单行，一个订单行有一个订单。解决方案是使用两种方式关联和一个名为 DeleteOnNull 的映射属性（您可以在谷歌上搜索完整信息）。我遗漏的最后一件事是您的实体类需要从 l2s 实体集中注册 Add 和 Remove 事件。在这些处理程序中，您必须将订单行上的订单关联设置为空。如果您查看 l2s 设计器生成的一些代码，您可以看到一个示例。

我知道这是一个令人沮丧的问题，但经过几天的努力，我已经开始工作了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-14T21:39:07.993

作为后续....我已切换到使用 nhibernate（而不是链接到 sql），但实际上您不需要 OrderLine 的存储库。如果您只是从 Order 中的集合中删除 OrderLine，它只会从数据库中删除 OrderLine（假设您已正确完成映射）。当我用内存存储库换出时，如果您想搜索特定的订单行（不知道订单父级），您可以编写一个 linq to nhibernate 查询，将订单链接到 orderlineid = value 的 orderline。这样，它在从数据库和内存中查询时就可以工作。那么你去...

# oracle-apex - 为什么将 Oracle Application Express 用于 Web 应用程序？

> ID：652587
> 
> 赞同：51
> 
> 时间：2009-03-16T23:49:23.023
> 
> 标签：oracle-apex

我相信我们正在转向 Oracle Apex 以实现未来的发展。我在 wikipedia 上阅读了有关 Oracle Apex 的信息，它的优点和缺点。在我看来，弊大于利，但也许我错了。我的感觉是 Oracle Apex 是为几乎没有编程知识的 DBA 设置的，可以像 MS Access 一样快速设置 Web 应用程序。

如果您有 Oracle Apex 的工作经验，可以分享一下您的想法吗？从 Wikipedia 的条目来看，您似乎不需要了解任何编程语言，只需要了解 PL/SQL？

编辑：Oracle Apex 是否可扩展？它可以像 Facebook 那样处理流量吗？

编辑：在 Oracle Apex 3.2 上工作了近两年。我可以肯定地说我讨厌它，我不明白为什么有人想在浏览器、pl/sql 上创建 web 应用程序/页面，而没有办法进行版本控制。

感谢。

杰克

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-11-30T21:59:54.783

请注意我的经验是使用 APEX 2.x-3.0。

在 12 个月的时间里，我将 Apex 用于一些内部应用程序，但最终将其用于 ASP.NET。

一些 Oracle 传道者声称它能够创建与 ASP.NET/J2EE 等更主流框架相当的高度动态内容。从技术上讲，这是真的，但从技术上讲，你可以乘坐单人独木舟穿越大西洋也是如此。如果您想将自己投入到一个复杂程度适中的 APEX 项目中，那么我建议您查看一个[简单讨论论坛](http://www.oracle.com/technology/products/database/application_express/packaged_apps/packaged_apps.html#FORUM)的 APEX 示例。将其与 ASP.NET MVC 讨论论坛示例或 RoR 实现进行比较。

话说回来：

**好的**

*   非常容易生成一个具有基本 CRUD 数据输入、简单报告并用数据填充它的受人尊敬的 Web 应用程序。如果您是负责将公司的 Excel/Access 数据库整合到中央数据库/Web 环境中的 IT 人员，那么您应该看看 APEX，它非常适合这项任务。如果您期望范围增长到甚至中等复杂性，那么我将直接转向更灵活的框架。

*   如果您是 DBA/PLSQL 专家，但没有传统 Web 开发经验，那么您将做好充分准备，在 Web 应用程序中公开现有业务逻辑，而无需使用 HTML/CSS/JavaScript。

*   APEX 支持论坛拥有大量信息，并且配备了 APEX 开发人员。

**坏的**

当应用程序超越 CRUD 数据输入并需要更多动态和事件驱动的行为时，我对 Apex 的体验开始走下坡路。

*   基于 Web 的 GUI 并不酷。调试很痛苦。

*   版本控制？谁需要版本控制？

*   当您（不可避免地）需要在框架的有限范围之外做任何事情时，您将不得不亲自动手使用 PL/SQL。针对数据库编写业务逻辑很好，但在 2007 年，从 PL/SQL 过程生成 HTML 让人感到不舒服。

*   鉴于您可以隐藏页面和重定向逻辑的大量偷偷摸摸的地方，程序流程既难以可视化，也不利于模块化、可分离和可重用的代码。OOP 开发人员不会对此印象深刻。使用 APEX 可以拥有结构良好的可维护应用程序，但它比应有的困难。这与 MVC 相去甚远。

*   我使用的版本中的框架错误数量不可接受。我希望这在最近的版本中有所改善，但是将 IDE 集成到 APEX 平台本身的范例让**我经历了一些最黑暗的、破坏灵魂的调试会话**。例如，我试图重现一个会导致用户丢失会话数据的间歇性错误。使用会话信息弹出窗口，我看到有时会话数据会在不应该发生的情况下发生变化。我花了 2 天时间试图在我的代码中找到错误，但没有运气。几乎神志不清，我偶然注意到我可以在调试窗口中重现错误的会话数据，*但应用程序本身不会进入错误状态*. 当我意识到可能发生的事情时，我的心沉了下去。Oracle 后来证实我在 APEX 中发现了一个错误，该错误导致会话信息窗口间歇性地向我显示上一个会话的数据。我浪费了 2 天的时间来调试一个带有错误会话调试窗口的会话相关错误。那是我构建的最后一个 Apex 应用程序。

*   **PL/SQL 不是也永远不会成为 Web 开发中的下一件大事。**在与 APEX 合作了一段时间后，我意识到它不会让我成为一个更好的 Web 开发人员。掌握 APEX 真的是关于 PL/SQL。如果您打算将您的职业生涯专注于 Oracle 技术，那很好，请注意 APEX 与主流 Web 技术的方向如此相切，以至于您可以从 APEX 到其他 Web 框架的可移植技能集很少。

如果您正在考虑 APEX 提供简单的基于 Web 的数据输入和报告，那么值得一看。如果您正在为动态 Web 内容和丰富的 UI 交互寻找 .NET/JAVA/PHP 的替代方案，我建议您到别处寻找。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2010-01-25T19:49:27.860

我怀着极大的兴趣阅读了这一页。我们的开发团队已经使用 Apex 大约 2 年了，我想总结一下我们的经验。

对于构建基本的 CRUD 应用程序，Apex 确实非常出色。事实上，我建议您自己尝试一下。我们确实在设置它时遇到了一些最初的小困难，但这些似乎已经在 3.2 版本中解决了。

**好的**

*   非常适合简单的应用程序。如果您的应用程序会变得越来越复杂，请考虑另一种解决方案。
*   内置模板意味着您的应用程序看起来非常专业（尽管有些人会对此争论不休）。
*   一个很好的支持论坛和社区，有很多热心的人随时为您提供帮助。
*   一些精湛的内置控件。喜欢图表和报告（但见下文）。

**坏的**

*   调试器很糟糕。如果您使用过 Visual Studio（甚至是旧版本的 Microsoft Access），您会对调试器感到畏缩。没有断点，调试消息在大列表中喷出到屏幕上，不得不手动将调试消息打印到屏幕上。可怕。许多、许多小时失去支持的事业。

*   一旦您的应用程序变得复杂或需要任何丰富的功能，您就必须求助于 Javascript 和 HTML / CSS hack，这会使调试和支持变得更加复杂（尽管您可以使用 Firebug 或 Visual Studio 等工具来协助解决此问题）。

*   我们遇到了无法解释的会话状态错误，样式表在没有解释的情况下从应用程序中“分离”——仅举几个问题。

*   支持不熟悉的应用程序可能具有挑战性，因为如果没有好的调试器，可能很难遵循页面逻辑流程。而且我不买“好吧 - 应用程序应该编码得更好”的股票反应。因为在现实世界中，它们不是——尤其是当您使用承包商时。

*   报告看起来不错，但如果您无法打印或导出为 PDF，则效果不佳。当然你可以买一个报告服务器，最后我们使用了另一种解决方案。

**全面的**

我会说一定要将 Apex 用于简单的 CRUD 应用程序。对于任何复杂程度不高的东西，请使用 .Net 或 Java。我不会注意到 Apex 上的 Wiki 文章，因为它非常歪曲。请注意“难以调试”（我认为最大的失败）已从文章中删除。

还需要非常警惕的是，您可以快速将 Access 数据库直接转换为 Apex 的荒谬说法。是的，如果您的 Access DB 非常非常简单，它将起作用。正如我们发现的那样，任何中等复杂的东西，算了吧。

我们绝对不会将它用于面向 Web 的应用程序，仅用于内部应用程序。做你认为理所当然的事情，比如.Net，有太多的困难。我知道有一些网站，例如 AskTom，但这些网站并不十分复杂。我们会在上面看到下一个 Facebook 吗？我认为不会——尽管我确信读到这篇文章的人会对此有所了解。

Apex 在之前的评论中得到了总结——经理们看到了演示，很快就接受了，确信他们找到了可以缩短开发时间的灵丹妙药。我有经理打电话给我说，我们需要一个 db 应用程序，请在一周内在 Apex 中构建 40 个表 - 这就是神话已经发生的程度。实际情况有些不同。是的，有些事情更快、更快，但您会在其他领域浪费时间——调试、支持和定制。

当然你最好自己决定。安装它，试一试，你可能会喜欢它。但是，在您对实际应用程序进行了很好的审查之前，不要被快速开发时间的说法所迷惑。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-03-17T14:28:24.627

我参与了一个将 5000 个模块的 Oracle Forms 应用程序迁移到 APEX的**大型项目。**这是对 APEX 的极端使用，但它工作得很好。**APEX仅**适用于由 DBA、实习生或最终用户构建的小型内部应用程序完全是一个神话：它当然也适用于那些（并且比大多数其他工具更适用），但它也可以用于构建极其复杂的应用程序。

要构建复杂的应用程序（而不是默认的开箱即用的 APEX 应用程序），您需要团队中具有 Javascript 技能和 CSS 技能的人。但大多数开发人员最初只需要 PL/SQL。

是否可扩展？是的：可能比大多数其他解决方案更具可扩展性！APEX 对数据库服务器的开销非常小，并且只需要最少量的应用程序服务器。“脸书大小”？我不确定，但我不明白为什么不这样做，假设您在一台足够大且功能强大的机器上有一个 Oracle 数据库，可以处理“Facebook 大小”的数据和交易量。与任何 Oracle 项目一样，可扩展性主要受到不良数据库设计和编写不佳的 SQL 的阻碍，而不是工具。不过，没有多少人会发现自己正在构建“Facebook 大小”的系统：你是吗？

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-17T18:39:56.050

APEX 是一个使用数据库和 PL/SQL 来生成网页的框架。如果您能弄清楚浏览器的输出需要是什么，您可以在 APEX 中创建它。如果您发现框架的任何部分存在限制，您可以编写 PL/SQL 过程并将它们直接公开给 Web 服务器，但仍然可以利用 APEX 系统为您管理的安全性、日志记录、会话状态等。

您应该了解 PL/SQL、SQL、HTML、JavaScript 和 CSS。当然，界面看起来像一个大数据输入应用程序，但您输入的数据主要是每种语言的代码片段。

它的扩展性和数据库一样好。它通常使用 Apache 作为 Web 服务器，但仅用于提供静态文件并将请求传回数据库，其中网页由 APEX 模式中的 PL/SQL 代码创建。您可以使用 AJAX 来最小化上下管道的流量大小。您可以为特定项目、列表、页面区域、页面等设置缓存。

由于框架中的大多数事情都非常简单，自然会有一些事情在框架内做起来稍微复杂一些。上面给出的颜色编码示例可能是您使用 CSS 执行的操作，或者您可能需要使用打印语句来生成所需的输出。问题是学习框架如何让生活更轻松，然后当你达到极限时，你可以轻松地求助于更直接的方法。

来自 VB.Net 你会错过一步一步的调试和拖放。您永远不会错过这样一个事实，即页面生命周期的某些部分将执行绑定并重置您绑定到页面另一部分中的对象的值。

祝你好运。

格雷格

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-01-04T08:55:38.920

我是一名 DBA，我从来不需要使用 APEX 或最近使用其他任何东西进行编程（除了一些用于管理目的的 bash 脚本和自定义 SQL 脚本），因为我的工作远离开发应用程序（除了让开发人员感到痛苦之外） . 当然，我的背景是开发人员，我相信 APEX 是严格基于 Oracle 的以数据为中心的程序的未来。

现在这里的关键词是以数据为中心，因为我不同意许多其他 DBA 的观点，即所有应用程序都是以数据为中心的（你知道那种仍然认为 ODBC 代表**ORACLE**数据库连接的 DBA）。当然，所有应用程序都涉及数据，但所有应用程序都以数据为中心吗？我怀疑，就像我怀疑 APEX 是否会用于图像处理或移动游戏类应用程序一样。然而，尽管 RIA 和 Web 2.0 大肆宣传，但事实是我们周围的大多数企业都渴望那些以数据为中心的普通旧应用程序，而 Oracle 是最好的数据库，我可以向您保证，Oracle 和 APEX 可以处理的不仅仅是 Facebook 的可扩展性当然，前提是你在底层基础设施上投入了与 Facebook 人员相同数量的资金。

顺便说一句，我也讨厌 Oracle 的 APEX 主题设计（糟糕的不专业的 UI，想象一下它是银行或航空公司业务的主要 UI）、有限的功能（尽管这似乎在未来会改变）、更多的问题（专业PDF 报告无需为 BI 发布者支付企业数据库许可？触摸我的数据库:)

你看，Oracle 有一个叫做 PL/SQL 的 gem，它多年来一直在完善，以比任何其他语言更直观的方式处理数据。现在，随着 Forms/Reports 的缓慢死亡，宝石正在枯萎，我很肯定，没有一个应届毕业生会费心去严格地学习它以用于数据库存储过程（只要看看 Java 和 .Net 开发人员之间的激烈战争，你就会意识到，一旦你接触了大括号{} 其他任何东西都会成为异端）。对于成千上万的优秀 PL/SQL 开发人员来说，APEX 仍然是他们可以保持生产力并开发出色的以数据为中心的应用程序的唯一避难所，没有 APEX PL/SQL 肯定会成为下一个 COBOL。这就是为什么 PL/SQL 社区将推动 Oracle 将 APEX 转变为比我们今天看到的更强大的 A 级平台。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-03-17T02:21:42.203

我不确定你为什么不认为 PL/SQL 是一种编程语言......

APEX 非常适合您希望在数据之上拥有轻量级 UI 的内部应用程序。您可以相当轻松地构建它，而无需编写任何代码。

我还发现 APEX 非常适合开发较小的面向客户的应用程序。我不想构建一个巨大的应用程序，它会让数百名开发人员使用 APEX 来开发它。但是，如果您有 3 或 4 名开发人员正在构建一个小型站点的情况，那么 APEX 很可能与 Java/PHP/ASP.Net/假设同样熟练的开发人员一样好。例如，如果您的开发人员都拥有大量 ASP.Net 专业知识，那么他们将有一个学习曲线来编写 APEX 应用程序。但是，如果您有一群 PL/SQL 开发人员尝试学习如何构建 ASP.Net 站点，那么您至少会遇到同样的难度。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2010-03-15T16:56:28.047

不要将业务逻辑放入 Apex。仅用于演示。

如果您将代码放在应用程序中，您将无法维护它，并且您将通过所有点击获得 RSI。我总是创建一个包装层，并且在 Oracle 世界中遵循 Tom Kytes 的建议 - 将业务逻辑尽可能靠近数据。这也意味着您的 PL/SQL 模块可以被其他系统等调用 - 最重要的是 - 您的应用程序的真正核心将是可以使用您最喜欢的文本编辑器/IDE 操作的纯文本文件。

*   创建一个视图，其中包含要为每个屏幕检索的所有数据。
*   为所有 CRUD 操作创建一个包装器包。（我想这就是创建、读取、更新和删除）

简而言之：

不要将您的应用程序逻辑放在 APEX 中。

那是我的建议。. . .

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-03-17T16:01:55.900

Apex 仅适用于非程序员和 DBA 是一种不幸的误解。我们已经使用它来构建多个业务线、任务关键型、面向客户的 Web 应用程序。

GUI 由 Apex 页面模板 (HTML)、CSS 和一些 Javascript 处理，以增强用户体验。所有业务逻辑都放在 PL/SQL 包中。这是使您的应用程序易于维护以及在其他 Apex 应用程序和其他客户端工具（例如 C# WinForms、Delphi、Java 应用程序等）中重用业务逻辑的关键。

至于性能，Apex 引擎增加的开销很小，应用程序的响应时间和可扩展性很大程度上取决于 SQL 查询（和数据模型）的质量。可以这样想：使用 Apex，您的用户和数据库之间唯一的东西就是一层薄薄的 PL/SQL。这是常识，它必须比在 GUI 和数据库之间具有 17 层复杂性（通常包括大量 Web 服务和对象关系映射层）的典型 .NET 或 Java 应用程序更快。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-03-17T08:29:56.283

Oracle 的 Metalink 支持站点是用 Apex 编写的，因此它绝对可以扩展。不过，他们现在正在迁移到一个更新的基于 Flash 的支持站点。我知道他们通过收购另一家公司获得了该平台，而不是为了响应任何 Apex 限制而构建它。

如果你想用任何网络应用程序“超级性感”，你可能需要使用 Flash/Silverlight/Air。在此之下，任何基于 HTML 的站点，包括 Apex 站点，都可以使用 Javascript 进行美化。JQuery 库将包含在 Apex (4.0) 的下一个主要版本中，尽管您现在可以包含该版本（或任何其他库）。

Wikipedia 文章中提到的缓存问题已得到解决，尽管大多数安装仍会将图像和脚本放在传统的目录结构上，而不是从数据库中提供它们。

当您被锁定在 Oracle 数据库中时，我没有得到文章中的“平台”锁定“con”。Oracle 可用于 Windows、Linux 和 AIX（以及其他）。这比 ASP / SQL Server 少了很多锁。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-03-17T00:22:03.770

在我的项目中，我们使用 Oracle APEX 来查看系统的内部视图。它非常适合这个目的。

无需编程。 `PL/SQL`甚至`SQL`是可选的。因此，我们的 DBA 和操作员可以根据自己的喜好塑造视图。

不利的一面是，如果您需要的功能未编程到系统中，则很难添加它。例如，我们想对我们的输出进行颜色编码，但无法做到这一点。

我不想在 APEX 上构建面向客户的网站。

* * *

关于可扩展性的问题，APEX 的一个优点是它建立在 Oracle 之上。专注于编写好的 SQL 和正确设计表，事情应该可以很好地扩展。我会更关心获得足够多的用户来解决可扩展性问题。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2010-08-23T04:02:01.663

非常喜欢从上到下阅读该主题，因为这感觉像是一场激烈的辩论。为了提醒线程的开头，它以“我相信我们正在迁移到 Oracle Apex 以进行未来开发......”作为 .NET 程序员的杰克担心他的管理层的决定并考虑为 Oracle Apex 寻找相反的事实最终最终在公共场合清洗了（所有 Web 框架的）肮脏的亚麻布。尽管受害者是 Oracle Apex，但如果在 .net 和 j2ee 专家之间进行辩论，同样的情况也可能发生在 .net 或 j2ee 上。我的观点是所有框架都有自己的优点和缺点。这就是为什么我们实际上有这么多。争论什么对生活更重要（性、食物或水？）当然，我们会在需要时选择最合适的项目，这是浪费时间。

*   Oracle APEX 套件适用于您拥有大量 Oracle 数据库以及真正拥有 Pl/SQL 爱好者的环境。可以真正轻松地构建丰富、复杂、以 web 2.0*数据为中心*的应用程序（Apex 4.0），但调试和版本控制仍然一团糟，您还必须坚持使用 Oracle 数据库（是的，您可以有变通方法，但不健壮）。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-03-17T04:46:03.807

如果您想查看在 APEX 中完成的外部网站，我建议您查看[Oracle 工具用户组](http://www.odtug.com/apex/f?p=500:1:0)网站或[询问 Tom](http://asktom.oracle.com/pls/asktom/f?p=100:1:1479194539842163)。两者都是大型、经常使用的网站，具有很多自定义功能。

您对维基百科文章的印象是正确的。您需要的唯一编程知识是 PL/SQL。如果您的大部分站点都是简单的报告，您甚至不需要编写 SQL 查询，向导界面将为您构建查询和输出。如果你想要很酷的客户端工作，你需要了解 CSS 和 Javascript。PL/SQL 仅用于更复杂的数据验证。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-12-19T17:29:16.313

我不同意。它不仅适合具有少量开发技能的开发人员或 DBA。

实际上，我们使用我们自己的 CSS 模板、大量动态操作和交互（使用 jQuery 和几个框架）、微调的安全性、我们自己的 apex 插件和复杂的 PL/SQL 流程来生产高度定制的应用程序。

当然，我使用的是 apex > 4.0。

因此，如果需要，您可以构建复杂的应用程序（我们每个页面有多达 100 个不同的流程/验证和动态操作）。并且它可能需要强大的编程技能才能在 javascript 和 PL/SQL(OOP) 或 Java 存储过程中正确编码 + 良好的 SQL 知识以使用递归 SQL 和一些有趣的功能定义多达 500 行代码的优化查询。

# asp.net - ASP.NET 分页控件

> ID：652594
> 
> 赞同：14
> 
> 时间：2009-03-16T23:53:16.913
> 
> 标签：asp.net, paging

我正在 ASP.NET 中寻找一个像样的分页控件，就像 Stackoverflow 分页器一样。有人可以推荐一个吗？

我更喜欢一个不使用 Postback 的，只是一个可自定义的查询字符串。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-17T06:04:27.270

自己滚动很容易。我基于具有两个属性的堆栈溢出寻呼机创建了一个简单的用户控件...

1.  根据基础数据可用的总页数
2.  要显示的链接数

所选页面是通过读取查询字符串来确定的。最大的挑战是用新的页码更改 URL。此方法使用查询字符串参数“p”来指定要显示的页面...

```
string getLink(int toPage)
{
    NameValueCollection query = HttpUtility.ParseQueryString(Request.Url.Query);
    query["p"] = toPage.ToString();

    string url = Request.Path;

    for(int i = 0; i < query.Count; i++)
    {
        url += string.Format("{0}{1}={2}", 
            i == 0 ? "?" : "&", 
            query.Keys[i], 
            string.Join(",", query.GetValues(i)));
    }

    return url;
} 
```

一个简单的公式来确定要显示的页码范围...

```
int min = Math.Min(Math.Max(0, Selected - (PageLinksToShow / 2)), Math.Max(0, PageCount - PageLinksToShow + 1));
int max = Math.Min(PageCount, min + PageLinksToShow); 
```

然后使用类似的东西生成每个链接（其中 min 和 max 指定要创建的页面链接的范围）......

```
for (int i = min; i <= max; i++)
{
    HyperLink btn = new HyperLink();
    btn.Text = (i + 1).ToString();
    btn.NavigateUrl = getLink(i);
    btn.CssClass = "pageNumbers" + (Selected == i ? " current" : string.Empty);
    this.Controls.Add(btn);
} 
```

还可以创建“上一个”（和“下一个”）按钮...

```
HyperLink previous = new HyperLink();
previous.Text = "Previous";
previous.NavigateUrl = getLink(Selected - 1); 
```

第一个和最后一个按钮是直截了当的......

```
HyperLink previous = new HyperLink();
previous.Text = "1";
first.NavigateUrl = getLink(0); 
```

在确定何时显示“...”时，当链接范围不在第一页或最后一页旁边时显示文字控件...

```
if (min > 0)
{
    Literal spacer = new Literal();
    spacer.Text = "&hellip;";
    this.Controls.Add(spacer);
} 
```

对上面的“max < PageCount”执行相同的操作。

所有这些代码都放在 CreateChildControls 的覆盖方法中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T20:03:10.743

我期待更多的答案，但看起来很多人只是自己做。[我在codeproject.com](http://www.codeproject.com/KB/custom-controls/ASPNETPagerControl.aspx)上找到了一个经常维护的不错的

![cp](https://www.codeproject.com/KB/custom-controls/ASPNETPagerControl/pagerControl_pager_intro_1.gif)

它与stackoverflow.com 不太一样。如果有一个体面的开源控件具有各种不同的输出选项，那就太好了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T23:58:39.817

我使用过 DevExpress 和 Telerik 页面控件，并且更喜欢 DevExpress 寻呼机。我*不确定*DevExpress 寻呼机是否可以直接与查询字符串一起工作，但如果它不能，我会感到惊讶，因为它非常灵活。至于下载后现有页面之间的分页，一切都可以驻留在客户端上，或者，如果需要访问服务器，则该控件完全配备了 AJAX。我建议您从 www.devexpress.com 开始搜索，然后再查看 www.Telerik.com（也配备了 AJAX）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T00:01:08.453

不是控件，但这是在数据库级别实现分页的方式：[SQL Server 2005 Paging](http://www.sqlservercentral.com/articles/T-SQL/66030/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-31T03:07:18.137

我编写了一个名为：Flexy Pager 的寻呼机控件
阅读更多： http: [//www.codeproject.com/Articles/748270/Flexy-Pager-for-ASP-NET-WebForm-MVC](http://www.codeproject.com/Articles/748270/Flexy-Pager-for-ASP-NET-WebForm-MVC)

![在此处输入图像描述](https://i.stack.imgur.com/JCOic.png)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-09-05T02:28:01.710

你可以试试[NPager](https://github.com/nabinked/NPager)。对页面索引使用查询字符串，没有回发。需要 Bootstrap 进行样式设置，但是您可以使用“分页”CSS 类为控件创建自己的自定义 CSS 类。这是一个有效的[演示](http://webformspagernet.azurewebsites.net/default.aspx)

[![在此处输入图像描述](https://i.stack.imgur.com/Icgzy.png)](https://i.stack.imgur.com/Icgzy.png)

# flash - 如何让我的访客使用 Flash Player 收听不同的在线电台？

> ID：652600
> 
> 赞同：0
> 
> 时间：2009-03-16T23:57:07.887
> 
> 标签：flash, streaming, audio-player, webradio

在我发现 WMP 对 Firefox 用户来说不是最好的主意，因为他们需要安装额外的插件，我想尝试 JW 播放器，我搜索了所有关于音频流和 Flash 播放器的信息。

我得到了类似 www.onlineradio.com/32.asx 的东西 -> 它不在我的服务器上，而是在不同的服务器上，但我似乎找不到让我的访问者按照他们的意愿播放这些内容的解决方案。它适用于 WMP。JW Player 无法按我希望的方式工作，或者我可能以错误的方式使用它。

请帮我解决这个问题。

编辑： Flash 不能做到这一点但 WMP 可以做到这一点有什么真正的原因吗？FF和IE都没有解决方案吗？- 当然我不会联系所有的收音机。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T01:50:01.203

出于安全原因，除非您在 Web 服务器上设置代理，或者让广播电台的所有者将您的网站添加到他们服务器上的 crossdomain.xml 文件中，否则您不能使用 flash 来执行此操作。

[http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_14213](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_14213)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T00:25:55.930

我不确定您是否真的在使用 RTMP 时遇到困难，或者您是否真的无法找到连接的“位置”...

如果您找不到接入点，您可能会开始向拥有收音机的人发送电子邮件，显示您的兴趣并询问访问信息......（如果您在任何常见问题解答等中找不到它）。这不仅对提供商公平，而且您也会得到明确的答案。如果他们习惯了这种请求，您可能会幸运地获得有关他们服务的详细技术规格文档。

获得详细信息后，我们可能会帮助您设置现成的播放器或创建自己的播放器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T10:56:05.413

有很多流媒体解决方案可用于音频流 1.Icecast 2.Shoutcast 只需通过这些您可能会得到答案....还有其他商业解决方案也可用于此...如 1.Flash 流媒体服务器 2 .Helix 服务器 3.Windows 媒体服务 9 有关流式服务器的一些想法，您可以参考 [http://streamingserve.blogspot.com](http://streamingserve.blogspot.com)

# c++ - 为什么 MFC::CHttpFile 'PUT' 不适合我？

> ID：652605
> 
> 赞同：0
> 
> 时间：2009-03-17T00:00:58.923
> 
> 标签：c++, http, mfc, curl, mfc-networking

我的代码与供应商提供的一个小型 Java 应用程序对话。这个 Java 应用程序在 localhost:57000 设置了一个 Web 服务器，用于控制“机器”的状态。出于这个问题的目的，我需要将“机器”的状态从“关闭”更改为“开启”。为了实现这一点，我应该将以下字符串 HTTP PUT 到[http://localhost:57000/settings.xml](http://localhost:57000/settings.xml)的“机器” ：

```
<settings><machine_state><status>on</status></machine_state></settings> 
```

此 Curl 命令完美运行：

curl -X PUT -H "Content-Type:application/xml" -d @settings.xml [http://localhost:57000/settings.xml](http://localhost:57000/settings.xml) "

其中本地文件“settings.xml”中包含上述 xml 字符串。

我想做 Curl 对 MFC 的 WININET 类所做的事情。恕我直言，以下代码应该与 curl 所做的完全相同。遗憾的是，尽管 localhost Web 服务器返回代码 200，但它忽略了我的 xml 字符串。我错过了什么小东西？

```
int MyHttp::HttpPutThread() NOTHROW
{
    try {
            m_xml =  "<settings><machine_state><status>on</status></machine_state></settings>";
            m_url = "settings.xml"
        CInternetSession session; 
        SetSessionOptions(session);
        CString server = "localhost:57920";
        boost::scoped_ptr<CHttpConnection> phttp(session.GetHttpConnection(server));
        LPCTSTR accept = 0;//"text/xml";
        boost::scoped_ptr<CHttpFile> phttpfile(phttp->OpenRequest(
            "PUT", //verb
            "settings.xml", //object name
            0, //referer
            1, //context
            &accept, // accept types
            0, //version
            INTERNET_FLAG_EXISTING_CONNECT));           

        CString header = "Content-Type:application/xml\r\n";
        if(phttpfile->SendRequest(header,(LPVOID)m_xml.GetBuffer(), m_xml.GetLength()))
        {       // LOG_DEBUG (Same as TRACE) output are shown in comment
            DWORD code(0);
            phttpfile->QueryInfoStatusCode(code);
            LOG_DEBUG("HttpPutThread result code: %d", code); // '200'
            CString object = phttpfile->GetObject();
            LOG_DEBUG("object: %s", object); // 'settings.xml'
            CString statustxt;
            phttpfile->QueryInfo(HTTP_QUERY_STATUS_TEXT,statustxt);
            LOG_DEBUG("status text:%s", statustxt); // 'HTTP/1.0 200 OK'
            CString rawheaders;
            phttpfile->QueryInfo(HTTP_QUERY_RAW_HEADERS,rawheaders);
            LOG_DEBUG("raw headers:%s", rawheaders); // http://localhost:57000/settings.xml
            LOG_DEBUG("File url:%s",phttpfile->GetFileURL());
            LOG_DEBUG("Verb:%s", phttpfile->GetVerb()); // 'PUT'

        } else      
        {
                    //This does not happen
            LOG_DEBUG("PUT failed in AffHttp::HttpPutThread");  
        }

    } catch(CInternetException* pe)
    {
            //No exceptions are thrown
        LOG_DEBUG("Exception HttpPutThread:%d", pe->m_dwError);
        pe->Delete();
    }
    return 0;
} 
```

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T02:14:05.490

我最终用我自己的低级套接字代码替换了 MFC 类，以与 Curl 完全相同的顺序发送完全相同的文本。看起来像小型嵌入式“码头”Java 服务器只是反对 MFC 类生成的头文件之一。

# java - Clojure GUI 计算器。“-”始终返回 0，“/”始终返回 1

> ID：652617
> 
> 赞同：3
> 
> 时间：2009-03-17T00:09:39.510
> 
> 标签：java, swing, clojure

我很清楚这段代码很糟糕。我刚刚做到了，所以我可以尝试不同的 Swing 东西。这是一个有趣的问题。这将创建 4 个按钮，一个用于加法、减法、除法和乘法。乘法和加法完美无缺，完全没有问题，但是当用户尝试减去它时，它总是返回 0。当用户尝试除法时，它总是根据输入返回 1 或 1.0。我想不通。这是代码：

```
(ns rayne.main
  (:gen-class)
  (:import (javax.swing JFrame JTextField JButton JOptionPane)
           (java.awt.event ActionListener)
           (java.awt GridLayout)))

(def numbers (ref []))
(def times-clicked (ref 0))

(defn calc [nseq op]
  (let [n1 (first nseq)
        n2 (last nseq)]
  (cond
    (= op "+") (+ n1 n2)
    (= op "*") (* n1 n2)
    (= op "-") (- n2 n1)
    (= op "/") (/ n1 n2))))

(defn add-op-button [op text button]
  (.addActionListener button
    (proxy [ActionListener] []
      (actionPerformed [e]
      (dosync
       (ref-set times-clicked (inc @times-clicked))
       (if (= @times-clicked 2)
         (do
         (let [result (.toString (calc @numbers op))
               result2 (read-string result)]
           (.setText text result)
           (ref-set numbers [])
           (ref-set times-clicked 0)))
       (do
         (ref-set numbers (conj @numbers (read-string (.getText text))))
         (.setText text ""))))))))

(defn -main []
  (let [frame (JFrame. "Calculator")
        add-button (JButton. "+")
        sub-button (JButton. "-")
        mul-button (JButton. "*")
        div-button (JButton. "/")
        clr-button (JButton. "Clear")
        text-field (JTextField.)]
    (add-op-button "+" text-field add-button)
    (add-op-button "-" text-field sub-button)
    (add-op-button "*" text-field mul-button)
    (add-op-button "/" text-field div-button)
(doto frame
  (.setLayout (GridLayout. 1 5))
  (.add text-field)
  (.add add-button)
  (.add sub-button)
  (.add mul-button)
  (.add div-button)
  (.setSize 500 100)
  (.setVisible true)))) 
```

由于复制粘贴和动态格式化，缩进可能搞砸了，但确实如此。我再一次知道代码很糟糕。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T00:32:31.437

用户第二次单击按钮时，数字不会添加到列表中`numbers`，因此您正在`calc`对一个元素的列表进行操作。

由于列表只有一个元素，所以第一个元素 ( `n1`) 和最后一个元素 ( `n2`) 是相同的，并且

```
x / x => 1
x - x => 0 
```

我很惊讶你的加法和乘法正在工作......：-/

我认为您可以通过将更新移动`@numbers`到之前来解决此问题`if`：

```
(ref-set numbers (conj @numbers (read-string (.getText text))))
(if (= @times-clicked 2) 
```

否则将`inc`rement`@times-clicked`移到`if`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T00:37:00.367

看起来 add 只是将数字添加到自身，而乘法函数实际上只是将第一个数字平方。

# flexbuilder - FlexBuilder Web 服务列表为空

> ID：652621
> 
> 赞同：0
> 
> 时间：2009-03-17T00:14:01.217
> 
> 标签：flexbuilder

我有一个来自 Flex 项目的 Web 服务列表。我正在尝试将项目加载到新机器上，但它已经忘记了列表中的所有 Web 服务。

我将原始设置文件复制到：

```
 "myproject-web\.settings\webservices.xml" 
```

这包含相当多的网络服务，我不想重新导入它们。这将涉及删除所有生成的代码并逐一检查并添加它们。

问题是当我转到“数据 > 管理 Web 服务”时，我看不到任何这些项目。

所以我尝试了明显的：

*   添加新的网络服务
*   检查 webservices.xml 文件是否被修改。实际上，新服务已附加到该文件的内容中
*   关闭并重新打开 Flex Builder
*   该列表仅包含我添加的一项新服务，而不包含旧服务。

我怎样才能“欺骗”Flexbuilder 识别列表中的其他 Web 服务。它必须在其他地方存储一个列表。

注意：这是几个月前的[同一个问题](https://stackoverflow.com/questions/43877/managing-web-services-in-flexbuilder-how-does-the-manager-work)，但没有答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-03T22:04:06.177

我也遇到了这个问题。我必须做的是将工作空间的 .metadata.plugins\com.adobe.flexbuilder.webservices 文件夹中的 wsdl.xml 文件从一台计算机复制到另一台计算机。

就个人而言，这感觉是错误的地方，因为有关正在使用的 Web 服务的信息是项目的一部分，而不是工作区。如果您检查该文件的内容，它甚至包含您的项目名称，因此它知道它是项目特定的数据。也许它在这里是因为它是 eclipse 的限制，但我怀疑不是。也许 Adob​​e 应该考虑修改 eclipse 插件以将这些数据存储在项目文件中的某个位置。

# javascript - 如何嵌入可滚动文本框以在我的网页上输出文本？

> ID：652637
> 
> 赞同：1
> 
> 时间：2009-03-17T00:26:46.490
> 
> 标签：javascript, html

是否可以嵌入可滚动文本框以在我的网页上以 HTML 或 JavaScript 输出文本？

如果可能，我尽量不使用任何 Java 库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T00:36:55.607

```
<textarea></textarea> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T00:35:13.910

```
 <style type="text/css" media="screen">

    #messages{
        border : solid 2px #ff0000; background : #D5D5D5;  padding : 4px; width : 500px; height : 350px; overflow : auto; 
    }
</style>

    <div id='messages'>
</div> 
```

使用 jquery 向下滚动：

```
$('#messages').scrollTop( $('#messages')[0].scrollHeight ); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T00:33:39.640

由于问题很模糊，我将推荐[jScroller](http://jscroller.markusbordihn.de/)（因为我已经将它用于某些项目）

# apache - 这些行是 Apache 错误日志中的错误或信息吗？

> ID：652642
> 
> 赞同：0
> 
> 时间：2009-03-17T00:30:48.167
> 
> 标签：apache

我刚刚查看了我的一个特定站点的 error_logs，我已经有一段时间没有做过了，在 Apache 的 error_log 中，我发现了数百行具有相同格式的行：

```
[Mon Mar 16 19:20:03 2009] [error] [client xx.81.239.xxx] [Mon Mar 16 19:20:03 2009] [info] Executing "/home/get/public_html/fileReader.php" as UID 32596, GID 32599, referer: http://www.mysite.com/index.php
[Mon Mar 16 19:20:03 2009] [error] [client xx.3.27.xx] [Mon Mar 16 19:20:03 2009] [info] Executing "/home/get/public_html/fileReader.php" as UID 32596, GID 32599, referer: http://www.mysite.com/index.php
[Mon Mar 16 19:20:03 2009] [error] [client xx.202.191.xx] [Mon Mar 16 19:20:02 2009] [info] Executing "/home/get/public_html/fileReader.php" as UID 32596, GID 32599, referer: http://www.mysite.com/index.php 
```

我已经用 Google 搜索过，但找不到任何关于此的内容。这是什么意思？甚至是错误吗？如果没有，怎么记录？

谢谢大家

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T02:53:15.547

这些日志条目[来自](http://suphp.sourcearchive.com/documentation/0.6.2-3/Application_8cpp-source.html#l00112)suPHP [。](http://www.google.com/search?q=suphp)它们是信息消息，而不是错误（代码说`logger.logInfo(...)`，*不是* `logger.logError(...)`）。您可以通过将 suPHP 的`loglevel` [配置选项](http://www.suphp.org/DocumentationView.html?file=CONFIG)设置为“警告”、“错误”或“无”来抑制它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T00:36:05.860

这些条目可能是一些[自定义错误日志格式](http://httpd.apache.org/docs/2.2/mod/mod_log_config.html#formats)。

# iphone - 在 iPhone 上使用照片滑块/缩略图的更好方法？

> ID：652644
> 
> 赞同：1
> 
> 时间：2009-03-17T00:32:14.807
> 
> 标签：iphone

我有一个可能很大的图像列表，并且想要像照片应用程序但带有自定义工具栏的东西。

我想知道这是怎么做到的。我看到了 Apple [http://developer.apple.com/iphone/library/samplecode/Scrolling/index.html](http://developer.apple.com/iphone/library/samplecode/Scrolling/index.html)的示例，但这不适用于大量图像。

我有一个产品列表，我的一些客户需要在设备中下载多达 12,000 种产品（我有一个用于移植到 iPhone 的 PocketPC 的解决方案）。

在这个线程[中如何在横向模式下查看缩略图？](https://stackoverflow.com/questions/530045/how-make-a-view-of-thumbnails-in-landscape-mode)有人建议可以使用 TableView，但是我不确定……主要是如何隐藏部分标题……

**更新**更正链接

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T03:20:00.177

“滚动”演示不适用于大型图像集，但一些小的调整可以很容易地解决这个问题。诀窍是使用 UIScrollView 委托方法按需加载图像，然后在它们消失后将其卸载。为了获得不错的性能，您需要加载中央图像和两侧的一两个图像 - 这意味着您可以扩展该设计以支持任意数量的图像，但内存中的图像仍然永远不会超过 3-5时间。

您发布的 Stackoverflow 链接实际上并没有提到表格视图，所以我不确定您在那里想到的方法。如果通过“节标题”您指的是节页眉和/或页脚文本，则不要提供任何内容。表格视图对此没有默认设置，因此如果您不给表格视图一个，那么它就不会显示一个。

# asp.net - 从目标页面上的 URL 重新路由中检索值？

> ID：652649
> 
> 赞同：0
> 
> 时间：2009-03-17T00:35:32.273
> 
> 标签：asp.net, query-string, url-routing

好的......让 URL 路由工作得很好，但无法弄清楚如何实际读取目标页面中的值。

此处的一个示例显示了使用 RequestContext 中的 RouteValue 对象。现在所有这些都在 System.Web.Routing 命名空间中，但每个人似乎都只是将它们连接到 MVC。RequestContext 来自哪里？

我如何读取这些参数？？？

查询字符串也是空白的。

蒂亚！凯文

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T03:39:02.893

我自己解决了这个问题......耶！:)

开始乱搞，看到 IHttpHandler 接口为 GetHttpHandler 方法提供了 RequestContext。

所以，我修改了我的基页面类（我总是在 System.Web.UI.Page 和我自己的页面之间放置一个层，为此目的将其称为 BasePage 或类似名称）。所以我在 PVBasePage 上添加了一个公共属性来接收一个 RequestContext 对象。

```
public RequestContext RequestContext { get; set; } 
```

然后，我的路由类代码如下：

```
IHttpHandler IRouteHandler.GetHttpHandler(RequestContext requestContext)
{
    // create the page object as my own page...
    var page = BuildManager.CreateInstanceFromVirtualPath(VirtualPath
        , typeof(PVBasePage)) as PVBasePage;
    // pass in the request context
    page.RequestContext = requestContext;
    // return this page in the form of a IHttpHandler
    return page as IHttpHandler;
} 
```

因此，我没有像示例代码中那样直接将实例创建为 IHttpHandler，而是将其创建为我自己的页面。设置请求上下文属性，然后将页面作为 IHttpHandler 返回给调用者。

经过测试，它可以工作。呜呼！

希望这可以帮助其他人。

# .net - 使用 .Net ServiceInstaller 在服务安装中设置“启动参数”？

> ID：652654
> 
> 赞同：9
> 
> 时间：2009-03-17T00:38:44.433
> 
> 标签：.net, service, installation

我目前正在编写一个小的 Windows 服务应用程序，我可以通过以下方式成功地安装/卸载它等：

```
 serviceProcessInstaller = new ServiceProcessInstaller();
        serviceInstaller = new System.ServiceProcess.ServiceInstaller();
        serviceProcessInstaller.Account = ServiceAccount.LocalSystem;
        serviceInstaller.ServiceName = "ABC";
        serviceInstaller.StartType = ServiceStartMode.Automatic;
        serviceInstaller.Description = "DEF";
        Installers.AddRange(new Installer[] { serviceProcessInstaller, serviceInstaller }); 
```

...但我显然无法在那里设置启动参数...或者我可以吗？我宁愿以后不要继续修改注册表..因此问题...有什么办法可以以编程方式设置这些参数吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-11-02T14:03:34.017

这是一个更简洁的答案：

在您的 ServiceInstaller 类（使用 Installer 作为基类的类）中，添加以下两个覆盖：

```
public partial class ServiceInstaller : System.Configuration.Install.Installer {

    public ServiceInstaller () {
         ...
    }

    protected override void OnBeforeInstall(System.Collections.IDictionary savedState) {
        Context.Parameters["assemblypath"] += "\" /service";
        base.OnBeforeInstall(savedState);
    }

    protected override void OnBeforeUninstall(System.Collections.IDictionary savedState) {
        Context.Parameters["assemblypath"] += "\" /service";
        base.OnBeforeUninstall(savedState);
    }

} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-18T00:12:37.837

参数可以通过 P/Invoking ChangeServiceConfig API 来设置。它们出现在 lpBinaryPathName 参数中您的可执行文件的引用路径和文件名之后。

当服务通过 Main 方法启动时，这些参数将可供您的服务使用：

```
static void Main(string[] args) 
```

（Main 传统上位于名为 Program.cs 的文件中）。

下面显示了如何修改安装程序以在正常服务安装逻辑运行后调用此 API。您最有可能需要修改的部分在构造函数中。

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Configuration.Install;
using System.ComponentModel;
using System.Configuration.Install;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.ServiceProcess;
using System.Text;

namespace ServiceTest
{
    [RunInstaller(true)]
    public class ProjectInstaller : Installer
    {
        private string _Parameters;

        private ServiceProcessInstaller _ServiceProcessInstaller;
        private ServiceInstaller _ServiceInstaller;

        public ProjectInstaller()
        {
            _ServiceProcessInstaller = new ServiceProcessInstaller();
            _ServiceInstaller = new ServiceInstaller();

            _ServiceProcessInstaller.Account = ServiceAccount.LocalService;
            _ServiceProcessInstaller.Password = null;
            _ServiceProcessInstaller.Username = null;

            _ServiceInstaller.ServiceName = "Service1";

            this.Installers.AddRange(new System.Configuration.Install.Installer[] {
                _ServiceProcessInstaller,
                _ServiceInstaller});

            _Parameters = "/ThisIsATest";
        }

        public override void Install(IDictionary stateSaver)
        {
            base.Install(stateSaver);

            IntPtr hScm = OpenSCManager(null, null, SC_MANAGER_ALL_ACCESS);
            if (hScm == IntPtr.Zero)
                throw new Win32Exception();
            try
            {  
                IntPtr hSvc = OpenService(hScm, this._ServiceInstaller.ServiceName, SERVICE_ALL_ACCESS);
                if (hSvc == IntPtr.Zero)
                    throw new Win32Exception();
                try
                {
                    QUERY_SERVICE_CONFIG oldConfig;
                    uint bytesAllocated = 8192; // Per documentation, 8K is max size.
                    IntPtr ptr = Marshal.AllocHGlobal((int)bytesAllocated); 
                    try
                    {
                        uint bytesNeeded;
                        if (!QueryServiceConfig(hSvc, ptr, bytesAllocated, out bytesNeeded))
                        {
                            throw new Win32Exception();
                        }
                        oldConfig = (QUERY_SERVICE_CONFIG) Marshal.PtrToStructure(ptr, typeof(QUERY_SERVICE_CONFIG));
                    }
                    finally
                    {
                        Marshal.FreeHGlobal(ptr);
                    }

                    string newBinaryPathAndParameters = oldConfig.lpBinaryPathName + " " + _Parameters;

                    if (!ChangeServiceConfig(hSvc, SERVICE_NO_CHANGE, SERVICE_NO_CHANGE, SERVICE_NO_CHANGE,
                        newBinaryPathAndParameters, null, IntPtr.Zero, null, null, null, null))
                        throw new Win32Exception();
                }
                finally
                {
                    if (!CloseServiceHandle(hSvc))
                        throw new Win32Exception();
                }
            }
            finally
            {
                if (!CloseServiceHandle(hScm))
                    throw new Win32Exception();
            }
        }

        [DllImport("advapi32.dll", CharSet=CharSet.Auto, SetLastError=true)]
        private static extern IntPtr OpenSCManager(
            string lpMachineName,
            string lpDatabaseName,
            uint dwDesiredAccess);

        [DllImport("advapi32.dll", CharSet=CharSet.Auto, SetLastError=true)]
        private static extern IntPtr OpenService(
            IntPtr hSCManager,
            string lpServiceName,
            uint dwDesiredAccess);

        [StructLayout(LayoutKind.Sequential, CharSet=CharSet.Auto)]
        private struct QUERY_SERVICE_CONFIG {
            public uint dwServiceType;   
            public uint dwStartType;
            public uint dwErrorControl;
            public string lpBinaryPathName;
            public string lpLoadOrderGroup;
            public uint dwTagId;
            public string lpDependencies;
            public string lpServiceStartName;
            public string lpDisplayName;
        }

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool QueryServiceConfig(
            IntPtr hService,
            IntPtr lpServiceConfig,
            uint cbBufSize,
            out uint pcbBytesNeeded);

        [DllImport("advapi32.dll", CharSet=CharSet.Auto, SetLastError=true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool ChangeServiceConfig(
            IntPtr hService,
            uint dwServiceType,
            uint dwStartType,
            uint dwErrorControl,
            string lpBinaryPathName,
            string lpLoadOrderGroup,
            IntPtr lpdwTagId,
            string lpDependencies,
            string lpServiceStartName,
            string lpPassword,
            string lpDisplayName);

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool CloseServiceHandle(
            IntPtr hSCObject);

        private const uint SERVICE_NO_CHANGE = 0xffffffffu;
        private const uint SC_MANAGER_ALL_ACCESS = 0xf003fu;
        private const uint SERVICE_ALL_ACCESS = 0xf01ffu;
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-20T10:58:06.540

有一种将启动参数添加到服务的托管方式（不在管理控制台 (services.msc) 的“启动参数”/“启动参数”部分，而是在“可执行文件路径”/“Pfad zur EXE-Datei”中，例如所有 Windows 的本机服务都可以）。

将以下代码添加到 System.Configuration.Install.Installer 的子类中：（在 C# 友好的 VB 代码中）

```
'Just as sample
Private _CommandLineArgs As String() = New String() {"/Debug", "/LogSection:Hello World"}

''' <summary>Command line arguments without double-quotes.</summary>
Public Property CommandLineArgs() As String()
  Get
    Return _CommandLineArgs
  End Get
  Set(ByVal value As String())
    _CommandLineArgs = value
  End Set
End Property

Public Overrides Sub Install(ByVal aStateSaver As System.Collections.IDictionary)
  Dim myPath As String = GetPathToExecutable()
  Context.Parameters.Item("assemblypath") = myPath
  MyBase.Install(aStateSaver)
End Sub

Private Function GetPathToExecutable() As String
  'Format as something like 'MyService.exe" "/Test" "/LogSection:Hello World'
  'Hint: The base class (System.ServiceProcess.ServiceInstaller) adds simple-mindedly
  '      a double-quote around this string that's why we have to omit it here.
  Const myDelimiter As String = """ """ 'double-quote space double-quote
  Dim myResult As New StringBuilder(Context.Parameters.Item("assemblypath"))
  myResult.Append(myDelimiter)
  myResult.Append(Microsoft.VisualBasic.Strings.Join(CommandLineArgs, myDelimiter))
  Return myResult.ToString()
End Function 
```

玩得开心！

恰

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-22T11:12:06.213

我找到了一种在服务安装时添加启动参数的方法：

[我是否作为服务运行](https://stackoverflow.com/questions/200163/am-i-running-as-a-service/2111492#2111492)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T00:22:16.097

这在托管代码中是不可能的。

但是有一个不错的解决方案。如果您想要的只是具有相同的 Windows 服务和 GUI 可执行文件（最常见的场景）。你甚至不需要参数。只需检查`System.Environment.UserInteractive`属性的 Main 方法并决定要做什么......

```
static void Main(string[] args)
{
    if (System.Environment.UserInteractive)
    {
        // start your app normally
    }
    else
    {
        // start your windows sevice
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-26T19:40:43.403

出于某种奇怪的原因，我的 QUERY_SERVICE_CONFIG 结构没有得到 lpBinaryPathName 的完整值，只有第一个字符。将其更改为下面的类似乎可以解决问题。[在http://www.pinvoke.net/default.aspx/advapi32/QueryServiceConfig.html](http://www.pinvoke.net/default.aspx/advapi32/QueryServiceConfig.html)有完整的代码

**编辑：**另请注意，这会设置 Windows 服务的“可执行文件路径”，但不会设置 Windows 服务的“启动参数”。

```
[StructLayout(LayoutKind.Sequential)]
public class QUERY_SERVICE_CONFIG
{
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.U4)]
    public UInt32 dwServiceType;
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.U4)]
    public UInt32 dwStartType;
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.U4)]
    public UInt32 dwErrorControl;
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
    public String lpBinaryPathName;
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
    public String lpLoadOrderGroup;
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.U4)]
    public UInt32 dwTagID;
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
    public String lpDependencies;
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
    public String lpServiceStartName;
    [MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
    public String lpDisplayName;
} 
```

# c# - 在 C# 的未来版本中是否有任何“扩展属性”计划？

> ID：652658
> 
> 赞同：5
> 
> 时间：2009-03-17T00:41:38.030
> 
> 标签：c#, properties, extension-methods

我以前想过这个问题，在阅读[这个](https://stackoverflow.com/questions/652512/do-you-think-generic-properties-would-be-useful-in-net)问题时又想到了这个问题。

在 C# 的未来版本中是否有任何“扩展属性”计划？

在我看来，用更多的“编译器魔法”来实现它们可能非常简单。例如，在扩展方法名称上使用*get_*和*set_*前缀会将该方法转换为扩展属性：

```
 public class Foo
    {
        public string Text { get; set; }
    }
    public static class FooExtensions
    {
        public static string get_Name(this Foo foo)
        {
            return foo.Text;
        }
        public static void set_Name(this Foo foo, string value)
        {
            foo.Text = value; 
        }
    } 
```

是否有任何技术限制可以防止这种情况发生？这会在幕后产生太多的东西吗？不够重要，不值得付出努力？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T00:46:41.247

功能请求的官方网站是[http://connect.microsoft.com/VisualStudio](http://connect.microsoft.com/VisualStudio)。

[这里](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=344478)已经有扩展属性的请求。

微软在 2008 年 7 月 29 日的回答包括以下内容：

> 扩展属性是一个常见的要求，实际上我们在设计下一个版本的语言方面取得了很大进展，但由于各种困难最终不得不放弃它。它仍然在我们的雷达上。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T00:46:50.980

一般来说，我认为这会鼓励不良做法。

属性应该代表有关对象的某种状态，而方法应该代表工作单元。但是许多开发人员倾向于将计算密集型或运行时间相对较长的代码放在更适合作为方法的 getter 和 setter 中。

扩展对象*与*派生对象不同。如果您需要添加属性，从哲学的角度来看，您正在谈论需要向对象添加状态信息。这应该通过从类派生来完成。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T00:46:03.790

尽管我不认为您提出的建议是一个好主意，但您可以使用`dynamic`C# 4 中即将推出的类型获得几乎相同的东西。计划的一部分是允许在运行时添加新的属性和方法以现有的对象和类型。一个区别是您不会对扩展属性进行编译时检查。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T02:00:52.690

对于这种把戏，可能有话要说。

只需查看 WPF 中的附加属性。它们确实为陈述性行为依恋提供了巨大的力量。但我不确定在声明性上下文之外会是什么样子......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T00:47:34.647

我不确定那将如何工作。扩展必须是静态的，因此属性本身也必须是静态的。这意味着您用来支持这些属性的任何东西也都是静态的。但是期望您对这些的计划使用期望它们与关键字指示的实例相关联，`this`而不是与类型本身相关联。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T01:06:28.657

“扩展属性”今天可以通过继承获得。添加这样的野兽会鼓励糟糕的 oop 实践，并且通常比它的价值更麻烦。

# configuration - 面向 Internet 的 Windows Server 2008——它安全吗？

> ID：652665
> 
> 赞同：10
> 
> 时间：2009-03-17T00:46:19.593
> 
> 标签：configuration, windows-server-2008

我真的对保护或配置面向互联网的“实时”网络服务器一无所知，而这正是管理层分配给我的工作。除了正在安装的操作系统（和 Windows 更新），我什么都没做。我已经阅读了微软和网络上的一些指南，但它们似乎都不是非常全面/最新的。谷歌让我失望了。

我们将部署一个 MVC ASP.NET 站点。

当您准备在新的 Windows 服务器上部署应用程序时，您的个人检查是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T01:19:56.020

这就是我们所做的一切：

*   **确保已启用 Windows 防火墙**。它具有“默认关闭”策略，因此开箱即用的规则设置相当安全。但是，如果您知道自己永远不会需要它们，那么关闭其他规则永远不会有坏处。我们在公共互联网接口上禁用了除 HTTP 之外的几乎所有内容，但我们喜欢 Ping（谁不喜欢 Ping？）所以我们手动启用它，如下所示：

    `netsh firewall set icmpsetting 8`

*   **禁用管理员帐户**。设置好并开始使用后，请授予您自己的命名帐户管理员权限。禁用默认管理员帐户有助于减少有人入侵它的机会（无论多么轻微）。（默认情况下，另一个常见的默认帐户 Guest 已被禁用。）

*   **避免在具有管理员权限的帐户下运行服务**。如今，大多数信誉良好的软件对此都非常满意，但检查一下也无妨。例如，在我们最初的服务器设置中，Cruise Control 服务具有管理员权限。当我们在新服务器上重建时，我们使用的是普通帐户。这需要更多的工作（您必须只授予完成工作所需的权利，而不是一次性授予所有权限）但*更*安全。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-29T07:26:23.310

几年前我不得不锁定一个...

作为系统管理员，在项目的早期就参与开发人员。Web 应用程序的测试、部署以及操作和维护是 SDLC 的一部分。

这些指南通常适用于任何 DMZ 主机，无论是 Linux 还是 Windows 操作系统。

有几本书专门用于 IIS7 管理和强化，但归结为

1.  决定您的防火墙架构和配置，并检查其是否合适。请记住保护您的服务器免受受感染主机的内部扫描。根据风险级别考虑使用透明的应用层网关来清理流量并使网络服务器更易于监控。

1、你把系统当做堡垒主机。锁定操作系统，减少攻击面（服务、端口安装的应用程序，即没有交互式用户或混合工作负载，配置防火墙 RPC 以仅响应指定的管理 DMZ 或内部主机）。考虑 ssh、OOB 和/或管理 LAN 访问并托管 IDS 验证程序，如 AIDE tripwire 或 osiris。如果网络服务器很敏感，除了 IIS/FW 日志外，考虑使用 argus 来监控和记录流量模式。

2.  基线系统配置，然后定期审核基线，最小化或控制更改以保持准确。自动化它。powershell 是你的朋友。

3.  美国 NIST 维护一个国家清单程序存储库。NIST、NSA 和 CIS 有值得研究的操作系统和网络服务器清单，即使它们是针对早期版本的。查看 apache 清单以及配置建议。查看 addison wesley 和 OReilly apache 安全书籍以掌握这些问题。

[http://checklists.nist.gov/ncp.cfm?prod_category://checklists.nist.gov/ncp.cfm?prod_category](http://checklists.nist.gov/ncp.cfm?prod_category://checklists.nist.gov/ncp.cfm?prod_category) [http://www.nsa.gov/ia/guidance/security_configuration_guides/web_server_and_browser_guides.shtml](http://www.nsa.gov/ia/guidance/security_configuration_guides/web_server_and_browser_guides.shtml) www. cisecurity.org 为订阅者提供清单和基准测试工具。目标至少为 7 或 8。

4.  从其他人的错误中学习（如果你犯了错误，请分享你自己的错误）：列出面向公众的应用程序产品并在 NIST 的 NVD（漏洞数据库..）中监控它们（它们也聚合 CERT 和 OVAL）订阅并阅读 microsoft.public.iinetserver .iis.security 和 microsoft 安全警报。（NIST NVD 已经关注 CERT）Michael Howard 是 MS 的代码安全专家，请阅读他的博客（并确保您的开发人员也阅读过）它位于：http: [//blogs.msdn.com/michael_howard/default.aspx](http://blogs.msdn.com/michael_howard/default.aspx)

[http://blogs.iis.net/](http://blogs.iis.net/)是 IIS 团队的博客。附带说明一下，如果您是 Windows 用户，请始终阅读您使用的 MS 产品组的团队博客。

David Litchfield 写了几本关于 DB 和 Web 应用程序强化的书籍。他是一个值得倾听的人。阅读他的博客。

如果您的开发人员也需要温和地介绍（或提醒）网络安全和系统管理员！我推荐 Sverre Huseby 的“Innocent code”。自从库克的鸡蛋以来，我还没有喜欢过这样的安全书。它制定了有用的规则和原则，并从头开始解释事情。它是一个非常强大的可访问读物

5.  您是否再次进行基线和审核？（你做了一个改变，你做了一个新的基线）。

6.  请记住，IIS 是一个元服务（FTP.SMTP 和其他服务在其下运行）。让您的生活更轻松，并在一个盒子上一次运行一项服务。备份您的 IIS 元数据库。如果您在同一个盒子上安装应用程序服务器（如 tomcat 或 jboss），请确保它们也受到保护和锁定。为这些应用程序提供安全的 Web 管理控制台，包括 IIS。如果您也必须在盒子上安装数据库。可以以类似的方式利用这篇文章

7.  logging.an 无人关注的面向公众的服务器（无论是 http、imap smtp）是专业的失败。检查您的日志将它们泵入 RDMS 并寻找快慢和讨厌的。您的威胁几乎总是自动化的和愚蠢的。尽可能在防火墙级别阻止它们。

8.  在获得许可的情况下，使用 P0f 和 nikto 对您的盒子进行扫描和指纹识别。使用 selenium 测试应用程序。*确保 IIS和*任何应用程序以受控方式谨慎处理网络服务器错误。，为 3xx、4xx 和 5xx 响应代码设置错误文档。

9.  现在你已经完成了所有这些，你已经覆盖了你的屁股，你可以查看应用程序/网站的漏洞。对开发人员保持温和，大多数人只会在违规和声誉/信任受损之后才担心这一点。马已经狂奔，早已不复存在。现在解决这个问题。这个更便宜。与您的开发人员讨论威胁树。

10.  考虑您对 Dos 和 DDoS 攻击的反应。从好的方面来说，考虑良好的流量/斜线和容量问题。与开发人员和营销部门联络，以处理容量问题和服务器/带宽配置，以响应活动/销售新服务。询问他们期望（或提醒）什么样的活动响应。提前计划足够的准备时间以允许配置。与您的网络人员交朋友，在短时间内讨论带宽配置。由于配置错误或性能不佳或配置不足而导致的不可用也是一个问题.. 监控系统的性能、磁盘、ram http 和 db 请求。了解正常和预期性能的指标..（上帝，有 IIS 的 apachetop 吗？；））计划适当的容量。

11.  在这一切过程中，你可能会问自己：“我是不是太偏执了？”。错误的问题..它是“我够偏执吗？” 请记住并接受您将永远落后于安全曲线，并且此列表可能看起来很详尽，这只是一个开始。以上所有都是谨慎和勤奋的，绝不应该被认为是过度的。

被黑客入侵的网络服务器有点像野火（或这里的丛林大火），你可以做好准备，它会处理几乎所有事情，除了蓝月亮事件。计划如何监控和应对污损等。

避免成为安全狂暴者或安全达莱克/小鸡。安静地工作，并*与*您的利益相关者和项目同事一起工作。安全是一个过程，而不是一个事件，让他们保持循环并温和地教育人们是在安全改进和接受你需要做的事情方面获得增量回报的最佳方式。避免居高临下，但请记住，如果您必须在沙子上画一条线，选择您的战斗，您只能做几次。

11.  利润！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T03:13:40.550

您最大的问题可能是应用程序安全性。当开发人员告诉您应用程序池身份需要是本地管理员组的成员时，请不要相信他。这是上面“不要以管理员身份运行服务”提示的一个微妙的转折。

另外两个值得注意的项目：1）确保您有办法备份此系统（并定期测试所述备份）。2) 确保您有办法修补此系统，理想情况下，在将这些补丁投入生产之前对其进行测试。尽量不要依赖自己的良好记忆力。不过，我宁愿让您将该框设置为使用 windowsupdate，也不愿将其禁用。

祝你好运。防火墙提示是无价的；保持启用状态，只允许 tcp/80 和 tcp/3389 入站。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T01:04:37.087

相应地使用角色，您为服务帐户使用的权限越少越好，尽量不要以管理员身份运行，

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-21T06:44:44.183

如果您正在尝试保护 Web 应用程序，您应该及时了解[OWASP](https://www.owasp.org/index.php/Main_Page)上的信息。这是一个简介；

> 开放 Web 应用程序安全项目 (OWASP) 是一个 501c3 非营利性全球慈善组织，专注于提高应用程序软件的安全性。我们的使命是让应用程序安全可见，以便人们和组织可以就真正的应用程序安全风险做出明智的决定。每个人都可以自由参与 OWASP，我们所有的材料都可以在自由和开放的软件许可下获得。您可以在我们的 wiki 上找到有关 OWASP 的所有信息，并在我们的 OWASP 博客上找到当前信息。请随时更改和改进我们的网站。全球有数百人审查网站的更改以帮助确保质量。如果您是新手，您可能需要查看我们的入门页面。问题或意见应发送到我们的众多邮件列表之一。如果您喜欢您在此处看到的内容并希望支持我们的努力，请考虑成为会员。

对于您的部署（服务器配置、角色等），他们提供了很多很好的建议，尤其是 Bob 和 Jeff。一段时间以来，攻击者一直在使用完全基于内存的后门程序和木马程序。*我们最近开发了一种验证服务器内存*的新型安全产品（使用类似于 Tripwire（参见 Bob 的回答）验证文件的技术）。

它被称为[BlockWatch](http://blockwatch.security-objectives.com)，主要设计用于云/管理程序/VM 类型的部署，但如果您可以提取它们，也可以验证物理内存。

例如，您可以使用 BlockWatch 来验证您的内核和进程地址空间*代码部分*是否符合您的预期（您安装到磁盘上的合法文件）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T01:38:59.843

使用防火墙阻止传入端口 135、137、138、139、445。内置的就可以了。Windows server 2008 是第一个直接使用 RDP 与 ssh 一样安全的服务器。

# c - 知道任何使用 libevent 实现 HTTP 服务的小项目吗？

> ID：652670
> 
> 赞同：1
> 
> 时间：2009-03-17T00:47:00.827
> 
> 标签：c, libevent

我的C有点生锈了。我有一些想法想尝试通过 libevent 实现。你知道我可以用作参考的任何代码库吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-14T02:56:33.913

两个具有相当直接代码的好项目是[simplehttp](http://code.google.com/p/simplehttp/source/browse/#svn/trunk/server)和[libevent-longpolling](http://code.google.com/p/libevent-longpolling/)

为了回答这个问题，我可以指出两个地方，即在谷歌代码中搜索[evhttp.h](http://www.google.com/codesearch?q=evhttp.h)（或类似的 libevent 头文件）或在 code.google.com 中搜索[label:libevent](http://code.google.com/hosting/search?q=label:libevent)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T01:05:55.850

本文[包含](http://aleccolocco.blogspot.com/2008/10/gazillion-user-comet-server-with.html)示例代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-09T00:45:19.213

我有几个：

*   [http://github.com/ngerakines/barbershop](http://github.com/ngerakines/barbershop) -- 使用 libevent 在 c 中移动优先级队列守护程序。二叉搜索树和链表的有趣的东西。
*   [http://github.com/ngerakines/johnlocke](http://github.com/ngerakines/johnlocke) -- 我目前正在开发的一个 torrent 跟踪器。非常正在进行中和 alpha 质量，但有效。
*   [http://github.com/ngerakines/mochevent](http://github.com/ngerakines/mochevent) -- 一个 erlang 网格的 libevent http 服务前端。

# .net - 在 .net CF 3.5 中获取特定时区？

> ID：652671
> 
> 赞同：2
> 
> 时间：2009-03-17T00:47:05.520
> 
> 标签：.net, compact-framework, pocketpc

我想在我的 PocketPC 上安装一个世界时钟。获取本地时间没有问题，获取 UTC 时间更不是问题。但我似乎无法获得特定的时区？假设我想要纽约的当前时区，不知道它是否是夏令时（所以我不知道它是东部时间 (GMT-5) 还是东部夏令时 (GMT-4)）。

可悲的是，紧凑框架中似乎不存在 TimeZoneInfo，所以我想知道除了手动硬编码未来 10 年所需时区的夏令时更改以获得正确的转换之外，是否真的没有其他方法......

编辑：TimeZone 存在，但它是一个我必须自己实现的抽象类，我想避免这种情况，因为它容易出错并且在 DST 周转日期上需要一些魔法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T01:01:21.227

OpenNetCF 库支持[TimeZones](http://blog.opennetcf.com/ctacke/PermaLink,guid,feccc834-0947-4b03-b9ef-1a08b7da1411.aspx)。

编辑：紧凑框架支持[TimeZone](http://msdn.microsoft.com/en-us/library/system.timezone_members(VS.85).aspx)，但正如迈克尔指出的那样，这是一个抽象类！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T15:18:36.227

[在 Windows Mobile 上使用 C# 的 TimeZones](http://www.burmistrovich.com/news/post/2008/07/06/TimeZones-with-C-on-Windows-Mobile.aspx)怎么样

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T15:28:58.260

使用网络服务下载最新的时区信息怎么样？

[http://www.twinsun.com/tz/tz-link.htm](http://www.twinsun.com/tz/tz-link.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T09:18:03.970

看看[http://www.michaelbrumm.com/simpletimezone.html](http://www.michaelbrumm.com/simpletimezone.html)。还有一种方法可以从注册表中获取时区信息（不仅仅是您的本地时区），请参阅[http://msdn.microsoft.com/en-us/library/ms725481(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms725481(VS.85).aspx)

更新：也许这会有所帮助：[http ://social.msdn.microsoft.com/forums/en-US/windowsgeneraldevelopmentissues/thread/feed3c46-18ea-4d5a-b5cf-7d85823fae01/](http://social.msdn.microsoft.com/forums/en-US/windowsgeneraldevelopmentissues/thread/feed3c46-18ea-4d5a-b5cf-7d85823fae01/)

我不确定紧凑型设备是否具有相同的信息，但您可以从 PC 中提取时区，然后将它们存储在紧凑型设备上的结构或文件中。但是您可能不得不不时更新它，因为这些事情往往会发生变化。

# c# - 枚举拳击和平等

> ID：652673
> 
> 赞同：16
> 
> 时间：2009-03-17T00:48:22.600
> 
> 标签：c#, .net, enums, boxing

为什么这会返回 False

```
 public enum Directions { Up, Down, Left, Right }

    static void Main(string[] args)
    {
        bool matches = IsOneOf(Directions.Right, Directions.Left, Directions.Right);
        Console.WriteLine(matches);
        Console.Read();
    }

    public static bool IsOneOf(Enum self, params Enum[] values)
    {
        foreach (var value in values)
            if (self == value)
                return true;
        return false;
    } 
```

虽然这返回 True？

```
 public static bool IsOneOf(Enum self, params Enum[] values)
    {
        foreach (var value in values)
            if (self.Equals(value))
                return true;
        return false;
    } 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-17T00:56:28.243

Enum 没有实现 == 相等运算符，但它确实覆盖了 Equals 方法。

由于它没有实现 ==，因此系统会执行引用相等检查。请注意， System.Enum 是一个类而不是一个结构。因此，诸如 Directions.Left 之类的值被装箱。在这种特殊情况下，装箱对象最终成为单独的对象，因此它们无法通过引用相等测试。

编译器理解具体 Enum 类型（例如 Directions）的 ==，但编译器不会针对 System.Enum 类型执行此特殊处理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T00:53:20.403

正如JB所说，拳击。您可以通过将 Enum 更改为 Directions 来看到这一点：

```
public static bool IsOneOf(Directions self, params Directions[] values)
{
    foreach (var value in values)
        if (self == value)
            return true;
    return false;
} 
```

返回 true。

# string - 对于字符串，“可变”与“可修改”一词相同吗？

> ID：652678
> 
> 赞同：4
> 
> 时间：2009-03-17T00:51:50.610
> 
> 标签：string, mutable

当我们谈论字符串是可变的时，这是否与使用单词“可更改”或“可修改”同义，或者是否有一些额外的细微差别来解释为什么使用这个行话而不是像“可修改”这样更简单的词？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T00:58:10.830

我认为“可变”这个词是一个不错的选择。

如果您使用“可修改”，则不太清楚。例如，如果您的字符串是堆分配类型，当您说您正在修改“字符串”时，不清楚您是在更改堆上的数据（字符串的内容）还是字符串的堆指针。

但是，对我来说，“可变”表明字符串的实际数据正在发生变化。我认为这是因为它与变异的根源相同。如果某物正在变异，它不会从查看 A 变为查看 B（即：更改指针），而是自身发生变异，或者（迭代地）变成它最初不是的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T00:54:17.080

可变对象是在创建后可以修改的对象。所以在某种程度上，它是“可修改”的同义词。“可变”一词的意思是“有责任或可能发生变化或变更”。我认为这听起来比“可修改”更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T01:00:17.813

是的，可变是指在创建后能够更改的对象，而不可变是指无法更改的对象。可变的字面意思是“变异的能力”，我认为这完全符合可变对象的行为方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T01:36:46.650

*   可变的
    *   “有责任或可能发生变化或变更。”
*   可修改
    *   “在一定程度上改变其形式或性质；部分改变；”

反过来

*   不可变
    *   “不可变的；不变的；不变的”
*   不可修改
    *   “在形式、性格或力量上无法改变”

在编程中，您经常听到可变和不可变这两个术语，而不是可修改和不可修改。但是，我认为可以肯定地说，任何一种方式都具有相同的含义。

但是在罗马时......所以你应该使用 mutable 和 immutable 因为它们是更常用的术语（至少在我的经验中）。

至于为什么会这样选择？我问了我的岳母（她说的话:-)，从非编程的角度来看，“可变”比“可修改”更短......对我来说似乎有足够的理由。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T01:02:34.517

特别是关于字符串，在可变字符串中，如果将第一个字符从“A”更改为“B”，那么您仍然在处理内存中的相同字节；其中一个刚刚取了不同的值。使用不可变字符串，即在Java 中，新对象将在内存中的新位置创建，因为原始对象无法更改。

可变是一个合适的词来描述它，它的优点是没有加载现实世界的含义或解释，这使得它难以精确使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T01:21:25.563

而且由于您没有指出您所说的具体上下文（如果这是范围蔓延，请原谅我）......

.NET 中的字符串特别是不可变的，而不是可变的。一旦它们被创建，就是这样。他们从不改变。如果进行了更改尝试，则会创建新字符串并释放旧字符串以进行垃圾收集。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T02:10:02.310

下面是一个非常简单的可变/不可变解释，以 java 为例：

**可变的**

*   无需重新分配内存即可更改
*   StringBuffer [api 文档](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/StringBuffer.html)是标准字符串类的可变版本

*   要更改 String 类的标准值，您需要重新分配内存

我从未真正听说过使用可修改一词。

# algorithm - 使用常量存储总结无限序列

> ID：652680
> 
> 赞同：2
> 
> 时间：2009-03-17T00:52:54.867
> 
> 标签：algorithm, statistics

假设我们经常对特定值进行采样，并希望保留样本的统计信息。最简单的方法是存储每个样本，这样我们就可以计算我们想要的任何统计数据，但这需要无限存储。使用恒定的存储量，我们可以跟踪一些统计数据，例如最小值和最大值。仅使用常量存储我们还能跟踪什么？我正在考虑百分位数、标准差和任何其他有用的统计数据。

这是理论上的问题。在我的实际情况下，样本只是毫秒计时：为长时间运行的应用程序分析信息。将有数百万个样本，但不会超过十亿左右。那么，使用不超过 10 个变量的样本可以保留哪些统计信息？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T01:05:42.230

最小值、最大值、平均值、总数、方差都很简单有用。那是5个值。通常你会存储总和而不是平均值，当你需要平均值时，你可以将总和除以计数。

所以，在你的循环中

```
maxVal=max(x, maxVal);
minVal=min(x, minVal);
count+=1;
sum+=x;
secondorder+=x*x; 
```

稍后，您可以打印任何这些统计信息。可以随时计算平均值和标准差，它们是：

```
mean=sum/count;
std=sqrt(secondorder/count - mean*mean); 
```

中位数和百分位数估计更困难，但可能。通常的技巧是制作一组直方图箱，并在其中发现样本时填充这些箱。然后，您可以通过查看这些 bin 总体的分布来估计中位数等。这只是分布的**近似值**，但通常足够了。要找到准确的中位数，您必须存储所有样本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T01:10:03.080

嗯，很多。考虑，例如，σ。从平均值和数据点重复计算的方差的平方根。在点*X [i]*，您对直到这一点的所有点都有一个估计方差；然后将*(x-μ)²*添加到下一个估计值。[维基百科](http://en.wikipedia.org/wiki/Algorithms_for_calculating_variance)中有一个很好的部分。

通常，您要查找的内容称为“在线计算方法”。

# c++ - G++ 编译器不允许递归？

> ID：652683
> 
> 赞同：4
> 
> 时间：2009-03-17T00:54:46.157
> 
> 标签：c++, recursion

我创建了一个使用递归的非常简单的程序。我正在使用 g++ 编译器。我可以编译它，但是当我尝试运行它时，我收到一条错误消息，上面写着 SEGMENTATION FAULT。这是我的代码：

```
#include <iostream.h>
using namespace std;

int Recurse(int);

int main(int argc, char *argv[])
{
        Recurse(10);
        cout << endl;
}

int Recurse(int numTimes)
{
    if (numTimes == 0)
        return 0;
    else
        {
                cout << numTimes << " ";
        Recurse(numTimes--);
        }
} 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-17T00:57:01.767

在您的递归调用中，您使用的是后缀`--`( `numTimes--`)，而不是前缀版本 ( `--numTimes`)。结果， 的值`numTimes`在递归调用之后递减。这意味着 Recurse 被无限调用 10。使用前缀版本（它会在调用之前递减它），或者只是通过`numTimes-1`（因为不需要修改 numTimes 值）。

您看到段错误的原因是您的堆栈溢出到受保护的内存中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T00:57:01.550

可能是导致无限递归的“numTimes--”。后缀 -- 将减少 -- 方法中的值，但将返回变量的原始值。

尝试将其更改为 --numTimes。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T00:58:19.003

在将 numTimes 传递给 Recurse() 之后，您正在递增 numTimes，因此您通过连续递归到值为 10 的 Recurse 并且从不向 cout 输出任何内容来破坏堆栈。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T01:00:38.967

首先，你想使用

```
#include <iostream> 
```

没有.h

现在程序：

```
#include <iostream>
using namespace std;

int Recurse(int);

int main(int argc, char *argv[]) {
        Recurse(10);
        cout << endl;
}

int Recurse(int numTimes) {
    if (numTimes == 0)
        return 0;
    else {
        cout << numTimes << " ";
        return Recurse(--numTimes);
    }
} 
```

您需要在评估之前应用 - 1 。

# asp.net - 将 Asp.net 默认验证与自定义提交操作混合

> ID：652693
> 
> 赞同：0
> 
> 时间：2009-03-17T00:59:49.780
> 
> 标签：asp.net, javascript, validation

我有一个页面，其提交按钮确实点提交。它宁愿在 OnClientClick 中有一些 javascript，它采用一些逻辑并将用户重定向到计算的 URL。问题是我想在这个设置中使用 ASP.net 默认验证。我需要能够在 javascript 中查询客户端验证的状态。我怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T01:06:47.923

这似乎是您正在寻找的，[使用来自客户端代码的 ASP.NET 验证](http://weblogs.asp.net/srkirkland/archive/2008/02/13/using-asp-net-validation-from-client-code.aspx)

```
<asp:Button ID="btnAddEntry" runat="server" OnClientClick="ValidateAndAddNewEntry(); return false;" CausesValidation="true" ValidationGroup="AddEntry" Text="Create" /> 
```

JavaScript

```
function ValidateAndAddNewEntry()  {

var res = Page_ClientValidate("AddEntry");   
    if ( res == true )  
    {  
        //Do work  
    }  
} 
```

# iphone - 发布子视图

> ID：652712
> 
> 赞同：0
> 
> 时间：2009-03-17T01:11:43.637
> 
> 标签：iphone

我有一个 UIScrollView，其中包含多页信息，这些信息作为子视图添加到 scrollView。每个 subView 的控制器都存储在 scrollViewController 中的 NSMutableArray 中。

我在子视图中有一些内存泄漏，我试图通过确保调用每个子视图控制器的 dealloc 方法来修复它们。我通过从 scrollView 控制器的 dealloc 方法中释放视图控制器来做到这一点。

当我在释放 subViews 控制器后尝试释放数组时，应用程序崩溃。

代码如下......我做错了什么？

```
- (void)dealloc {

// Loop through the array of subView controllers and release them
for ( int i = 0; i < [viewControllers count]; i ++ ) {
    [[viewControllers objectAtIndex:i] release];
}

[viewControllers release];  // Crashes here unless I remove the loop above
[scrollView release];
[pageControl release];
[theKnot release];
[super dealloc]; 
```

}

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T01:43:03.873

`NSMutableArray`获得它包含的对象的所有权——它在添加时增加它们的引用计数，并在释放它自己时释放它的对象。

假设您在将每个视图控制器放入`viewControllers`数组后释放或自动释放它，则无需循环对象`viewControllers`并释放它们——数组将为您完成。

释放数组时您崩溃了，因为数组试图释放您已经释放但现在无效的对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T01:43:31.890

NSArray 在释放时释放其内容，因此对象在您的循环中被释放 - 这可能是在释放它们 - 然后由数组释放。

如果您打算创建 iPhone 应用程序，您应该阅读 Apple 的[内存管理指南。](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)这并不难，但这是你必须学习的东西。否则你会得到泄漏和崩溃并且不知道为什么。一旦你了解了 Cocoa 的几条简单规则，一切就会一目了然。

# c++ - std::allocator 构造/销毁与放置 new/p->~T()

> ID：652715
> 
> 赞同：9
> 
> 时间：2009-03-17T01:12:05.803
> 
> 标签：c++, allocation, standards

对于我的一个项目，我正在从头开始编写一些 STL 容器（我有我的理由）。由于我如此密切地模仿 STL 的功能和接口，我正在尽我最大的努力遵守“如果它与标准构造具有相同名称，它将尽可能地符合标准”的策略。

所以，当然，我的容器将分配器作为模板参数，这非常好，因为它允许一些自定义分配方案。关于我的问题。

该`std::allocator`接口将内存分配与对象构造分开。同样，它将释放与销毁分开。这是有道理的，因为从哪里获取内存与在 c++ 中正确构造对象或多或少无关。

因此，对于默认实现，有两个构造/释放函数看起来像这样（直接从书中提取）：

```
void construct(pointer p, const T& val)    { new(p) T(val); }
void destroy(pointer p)                    { p->~T(); } 
```

如您所见，construct 只是调用placement new，而destroy 只是调用析构函数。

是否有任何理由使用这些而不是仅使用放置新和析构函数语法？“正确”的分配器可以以另一种方式实现这些吗？还是我保证所有符合标准的分配器实现都会以这种方式实现构造/销毁方法？

更重要的是，可以肯定地说我总是可以使用`std::uninitialized_copy`and`std::uninitialized_fill`来构造容器的元素吗？

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-17T01:28:18.713

分配器可以在构造/销毁之前和之后添加日志语句，或者它想要做的任何其他副作用。

当然，实际的构造必须通过调用placement new 和析构函数来进行，但在规则手册中并没有说在构造/销毁函数中必须发生*任何其他事情*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T01:20:02.743

这只是为了隐藏方法中的分配细节。即，我们正在提供用于构造和销毁的 API，将来我们可以更改实现。现在我们使用placement new来分配内存，将来如果我们想改变分配，我们只需要改变这两个方法。

# silverlight - Silverlight 渗透率

> ID：652717
> 
> 赞同：16
> 
> 时间：2009-03-17T01:12:18.173
> 
> 标签：silverlight, plugins

### 副本：[Silverlight 安装基础 - 它有多大？](https://stackoverflow.com/questions/60121/silverlight-install-base-how-big-is-it)

* * *

嗨，有人知道安装了 Silverlight 插件的所有北美互联网用户的渗透率（以 % 为单位）吗？环顾四周，但找不到任何全面的数字。

我正在寻找普通大众的渗透率，**而不仅仅是在开发社区**中。接近[Adob​​e 的 Flash 版本渗透统计数据](http://www.adobe.com/products/player_census/flashplayer/version_penetration.html)会很棒。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-17T01:34:35.720

我能找到的最好的是：

[http://riastats.com](http://riastats.com)

和：

[http://www.statowl.com/custom_ria_market_penetration.php](http://www.statowl.com/custom_ria_market_penetration.php)

两者的 Silverlight 都在 20% 左右。

**一年后更新：现在两个网站的 Silverlight 渗透率都在 55% 左右**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T01:20:37.937

微软估计 Silverlight 插件下载量超过 1 亿次，但我不确定这如何转化为百分比。仍然绝对低于Flash。请查看[此博客](http://www.silverlight-travel.com/blog/tag/microsoft-silverlight/)以获取更深入的信息。

不要忘记，MS 可以通过 Windows Update 推出 Silverlight 以立即覆盖数百万台 PC。（虽然这对 Mac 用户没有帮助）通过 Windows 更新推送它也将覆盖所有可能不习惯自己安装插件的“管道工乔”用户

对他们来说，真正的挑战是获得一个体面的 Silverlight 应用程序基础，人们希望获得该插件。那里有点鸡和蛋的问题。

我认为 Silverlight 作为大型公司的 Intranet Web 应用程序平台可能会取得更大的成功（我目前正在构建一个）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T02:11:18.203

在[2008 年 12 月 12 日的 DotNetRocks 播客中](http://www.dotnetrocks.com/default.aspx?showNum=404)，Richard 和 Carl 采访了微软 Silverlight 团队的产品经理 Tim Heuer。令我惊讶的是蒂姆说，

> 是的，真的很好。是的，我认为这可能是一个准确的数字。我认为我经常听到的很多公关术语是世界上每四分之一的人都可以使用带有 Silverlight 的机器。

资料来源： http: [//perseus.franklins.net/dotnetrocks_0404_tim_heuer.pdf](http://perseus.franklins.net/dotnetrocks_0404_tim_heuer.pdf)（第 14 页）

四分之一的机器可以***使用***具有 Silverlight 的机器，这与四分之一的机器具有 Silverlight 并不完全相同。我假设自 12 月以来采用率有所上升，但那句话告诉我，在那个时候，采用率低于 25%。如果是这样，那将支持 webdtc 发现的 Silverlight 采用率为 20%。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-22T11:50:28.817

我相信渗透率对于您的用户群的实际统计数据绝对没有用。

我们有很多 mac 用户，仍然有 25% 是 PowerPC，silverlight 不是为 PowerPC 来的，现在我们不能告诉我们的客户继续购买 1000 到 1500 美元的新 intel mac，他们会跟我们说再见，因为他们有其他供应商。

Silverlight 很好，但老实说，它只适用于 Windows 用户，如果可用，您可以告诉您的用户下载并安装它。但我认为我们需要等待 2-3 年，到那时，silverlight 可以稳定地用于更大的用户群。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T03:00:06.887

采用率似乎每月增长约 2%，因此如果这种情况继续下去，您预计到今年年底将增长约 40%。希望 NCAA 锦标赛使用 Silverlight 的事实，然后希望在今年晚些时候发布 Silverlight 3 将加快这一速度。

# c# - 删除内联静态事件

> ID：652722
> 
> 赞同：2
> 
> 时间：2009-03-17T01:14:45.017
> 
> 标签：c#, events, static, inline

我在我临时附加的静态方法中有一个静态事件，因为我不希望它在内存中徘徊，或者如果我调用它两次，我会触发两个事件处理程序。

对于这些是否应该是静态的，我几乎没有发言权，并且不希望承担讨论/重构的责任。

最初我是这样做的

```
public static void DoSomething()
{
    try
    {
        MyStaticClass.MyEvent +=new EventHandler<HandledEventArgs>(MyStaticClass_HandleMe);
        ... //Doing Stuff
    }
    finally
    {
        MyStaticClass.MyEvent -=new EventHandler<HandledEventArgs>(MyStaticClass_HandleMe);//Detach from event
    }
} 
```

这一直工作正常，但我想内联处理事件，以与方法中的另一个事件保持一致，以及设置一个函数本地并被另一个事件使用的取消布尔值。

```
public static void DoSomething()
{
    try
    {
        bool cancel = false;
        MyStaticClass.MyEvent +=new EventHandler<HandledEventArgs>(delegate(object sender, HandledEventArgs e)
        {
            cancel = true;
        })
        ... //Doing Stuff dependent on cancel = false;
    }
    finally
    {
        //???
    }
} 
```

我的问题是，在场景 2 中，如何清理并脱离静态事件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T01:31:18.363

你可以尝试这样的事情：

```
public static void DoSomething()
{
    bool cancel = false;
    EventHandler<EventArgs> handler = delegate { cancel = true; };

    try
    {
        MyStaticClass.MyEvent += handler;
    }
    finally
    {
        MyStaticClass.MyEvent -= handler;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T01:31:01.890

看到[这个线程的一个很好的方法。](https://stackoverflow.com/questions/183367/unsubscribe-anonymous-method-in-c)

基本上，只需将您的内联方法存储在一个委托中，然后在您的 finally 期间取消订阅它。

# java - 如何使用数组、函数和二分搜索完成作业？

> ID：652726
> 
> 赞同：-5
> 
> 时间：2009-03-17T01:19:51.557
> 
> 标签：java, arrays, function

所以基本上我想做的是一个程序，询问用户他希望他的数组有多大，并让用户介绍数组中的值。然后我希望用户能够引入一个数字，并让程序确定该数字在哪个数组中或确定它不存在。以下程序目前随机生成数组的值，用户介绍他想要使用多少个数组元素。但我不知道如何将其融入我之前解释的内容中。

```
package laboratorio9;

import java.util.Random;
import java.util.Arrays;

public class ArregloBinario
{
    private int[] datos;
    private static Random generador = new Random();

    public ArregloBinario (int tamanio)
    {
        datos = new int[tamanio];

        for (int i=0; i<tamanio; i++)
            datos[i] = 10 + generador.nextInt(90);

        Arrays.sort(datos);
    }

    public int busquedaBinaria(int elementoBusqueda)
    {
        int inferior = 0;
        int superior = datos.length-1;
        int medio = (inferior + superior + 1 ) / 2;
        int ubicacion = -1;

        // **HOW CAN I CHANGE THE FOLLOWING NTO A RECURSIVE FUNCTION>**
        do 
        {
            System.out.print(elementosRestantes(inferior,superior));

            for (int i = 0; i<medio; i++)
                System.out.print("  ");
            System.out.println(" * ");

            if (elementoBusqueda == datos[medio])
                ubicacion=medio;
            else if (elementoBusqueda<datos[medio])
                superior = medio-1;
            else 
                inferior = medio+1;

            medio = (inferior + superior + 1) / 2;
        } while ((inferior <=superior) && (ubicacion == -1));
        return ubicacion;                
    }

    public String elementosRestantes(int inferior, int superior)
    {
        StringBuilder temporal = new StringBuilder();

        for (int i = 0; i < inferior; i++)
            temporal.append( "  " );

        for (int i = inferior; i <= superior; i++)
            temporal.append( datos[i] + " ");

        temporal.append("\n");
        return temporal.toString();
    }

    public String toString()
    {
        return elementosRestantes(0, datos.length-1);
    }
}

// MAIN CLASS //

package laboratorio9;

import java.util.Scanner;

public class PruebaBusquedaBinaria {
    public static void main(String[] args)
    {
        Scanner entrada = new Scanner(System.in);

        int enteroABuscar;
        int posicion;

        System.out.println("Please write the number of elements in the array.");
        int number = entrada.nextInt();

        ArregloBinario arregloBusqueda = new ArregloBinario(number);
        System.out.println(arregloBusqueda);

        System.out.print("Write a value (-1) to go out: ");
        enteroABuscar = entrada.nextInt();
        System.out.println();

        while (enteroABuscar != -1)
        {
            posicion = arregloBusqueda.busquedaBinaria(enteroABuscar);

            if (posicion==-1)
                System.out.println("The value " + enteroABuscar + " was not found.\n");
            else
                System.out.println("The value " + enteroABuscar +
                        " was found in position " + posicion + ".\n");

            System.out.print(
                    "Write a number (-1 to go out): ");
            enteroABuscar = entrada.nextInt();
            System.out.println();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T02:44:53.287

首先，这是固定间距的原始 ArregloBinario 类：

```
package laboratorio9;

import java.util.Random;
import java.util.Arrays;

public class ArregloBinario
{
    private int[] datos;
    private static Random generador = new Random();

    public ArregloBinario (int tamanio)
    {
        datos = new int[tamanio];

        for (int i=0; i<tamanio; i++)
            datos[i] = 10 + generador.nextInt(90);

        Arrays.sort(datos);
    }

    public int busquedaBinaria(int elementoBusqueda)
    {
        int inferior = 0;
        int superior = datos.length-1;
        int medio = (inferior + superior + 1 ) / 2;
        int ubicacion = -1;

        // **HOW CAN I CHANGE THE FOLLOWING NTO A RECURSIVE FUNCTION>**
        do 
        {
            System.out.print(elementosRestantes(inferior,superior));

            for (int i = 0; i<medio; i++)
                System.out.print("   ");
            System.out.println(" * ");

            if (elementoBusqueda == datos[medio])
                ubicacion=medio;
            else if (elementoBusqueda<datos[medio])
                superior = medio-1;
            else 
                inferior = medio+1;

            medio = (inferior + superior + 1) / 2;
        } while ((inferior <=superior) && (ubicacion == -1));
        return ubicacion;                
    }

    public String elementosRestantes(int inferior, int superior)
    {
        StringBuilder temporal = new StringBuilder();

        for (int i = 0; i < inferior; i++)
            temporal.append( "   " );

        for (int i = inferior; i <= superior; i++)
            temporal.append( datos[i] + " ");

        temporal.append("\n");
        return temporal.toString();
    }

    public String toString()
    {
        return elementosRestantes(0, datos.length-1);
    }
} 
```

这是一个递归版本：

```
package laboratorio9;

import java.util.Random;
import java.util.Arrays;

public class ArregloBinario
{
    private int[] datos;
    private static Random generador = new Random();

    public ArregloBinario (int tamanio)
    {
        datos = new int[tamanio];

        for (int i=0; i<tamanio; i++)
            datos[i] = 10 + generador.nextInt(90);

        Arrays.sort(datos);
    }

    private int recursive (int elem, int inf, int sup, int med) {
        System.out.print(elementosRestantes(inf,sup));

        for (int i = 0; i<med; i++)
            System.out.print("   ");
        System.out.println(" * ");

        if (inf > sup)
            return -1;

        if (elem == datos[med])
            return med;

        if (elem<datos[med])
            return recursive (elem,inf,med-1,(inf + med) / 2);

    return recursive (elem,med+1,sup,(med + sup + 2) / 2);
    }

    public int busquedaBinaria(int elementoBusqueda)
    {
        int inf = 0;
        int sup = datos.length-1;
        int med = (inf + sup + 1 ) / 2;
        int ubi = -1;

        return recursive (elementoBusqueda,inf,sup,med);
    }

    public String elementosRestantes(int inferior, int superior)
    {
        StringBuilder temporal = new StringBuilder();

        for (int i = 0; i < inferior; i++)
            temporal.append( "   " );

        for (int i = inferior; i <= superior; i++)
            temporal.append( datos[i] + " ");

        temporal.append("\n");
        return temporal.toString();
    }

    public String toString()
    {
        return elementosRestantes(0, datos.length-1);
    }
} 
```

这是一个在 Eclipse 下运行的示例，作为它所经历的密集测试:-)

```
Please write the number of elements in the array.
20
14 18 19 20 22 31 43 50 55 58 58 59 62 71 72 74 85 92 95 98 

Write a value (-1) to go out: 95
14 18 19 20 22 31 43 50 55 58 58 59 62 71 72 74 85 92 95 98 
                               * 
                                 59 62 71 72 74 85 92 95 98 
                                              * 
                                                85 92 95 98 
                                                       * 
The value 95 was found in position 18.

Write a number (-1 to go out): -1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T02:35:58.800

```
import java.util.Scanner;
import java.util.Arrays;
public class tester
{
    public static void main(String[] args)
    {
        int randomNums[];
        Scanner myScanner = new Scanner(System.in);
        int len = myScanner.nextInt();

        //create the array with length determined from input
        randomNums = new int[len];

        //populates the array with random numbers
        for(int y=0;y<len;y++)
        {
            randomNums[y] = (int)(Math.random()*50+1);
            System.out.println(randomNums[y]);
        }

        Arrays.sort(randomNums);
        int index=0;
        while(true)
        {
            int searchFor = myScanner.nextInt();
            //input of -1 will end search
            if (searchFor==-1)
                break;
            else
            {
                 index = rBinarySearch(randomNums,0,len,searchFor); 
            }
            if (index==-1)
                System.out.println("not found");
            else
                System.out.println("the element was found at index: " + index);
        }
    }

    public static int rBinarySearch(int[] sorted, int first, int upto, int key) {

        if (first < upto) {
            int mid = first + (upto - first) / 2;  // Compute mid point.
            if (key < sorted[mid]) {
                return rBinarySearch(sorted, first, mid, key);

            } else if (key > sorted[mid]) {
                return rBinarySearch(sorted, mid+1, upto , key);

            } else {
                return mid;   // Found it.
            }
        }
        return -(first + 1);  // Failed to find key
    }
} 
```

# svn - 适用于 OS X 的类似 SVN 服务器软件，类似于 Visual SVN

> ID：652732
> 
> 赞同：1
> 
> 时间：2009-03-17T01:23:52.530
> 
> 标签：svn, macos, version-control, visualsvn

我的设计公司客户需要版本控制来保留我为他们编写的所有新源代码。颠覆似乎是一个不错的选择，

他们所有的服务器都是 OSX。

有谁知道一个好的 SVN 的 OSX 服务器管理器，类似于 Windows 的视觉 SVN？

我正在寻找一个的原因是因为我觉得他们的 IT 人员担心安装任何东西或向基础架构添加任何东西。我想为他尽可能地顺畅这个过程。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T20:32:40.407

正如其他人所说，Versions 是一个非常好的 OS X 颠覆客户端。然而，它不是一个像 VisualSVN 这样的 svn*管理器。*我一直在寻找一段时间，但找不到任何与 OS X 类似的东西。Visual SVN，你可能知道也可能不知道，实际上只是一个围绕专门的 apache 安装的管理控制台。它工作得非常好，但除了方便之外，VisualSVN 和简单地滚动你自己的 apache 设置之间几乎没有区别。

您可能想查看（没有双关语）SVN 管理器： [http ://svnmanager.sourceforge.net/](http://svnmanager.sourceforge.net/)

假设它应该做你想做的事，事实上从描述中它听起来好像它在技术上与 VisualSVN（Apache 设置）相同。我还没有尝试过（还）所以我不能告诉你它是否有效或效果如何。

如果您发现任何有用的信息，请告诉我！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T01:26:44.287

查看OSX的[版本](http://versionsapp.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T02:54:00.037

您可能还想查看[Cornerstone](http://www.zennaware.com/cornerstone/)。[本文](http://jadeohlhauser.com/2008/c_vs_v/)将 Cornerstone 与 Versions 进行比较，并通过其他 Mac SVN 客户端进行循环，尽管它似乎没有涵盖[SynchroSVN](http://www.syncrosvnclient.com/)

还有SVN[自己的客户列表](http://subversion.tigris.org/links.html#clients)..

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T18:39:34.050

[BinaryMethod](http://www.binarymethod.com)正在为 Mac OS X 开发服务器管理器。他们还没有发布它，但你可以要求对它进行 beta 测试。该工具称为[SvnXact](http://www.binarymethod.com/content/svnxact.php)。

# java - java.sql.SQLException：Mac OS X 上没有合适的驱动程序尝试使用 Derby

> ID：652736
> 
> 赞同：1
> 
> 时间：2009-03-17T01:27:38.717
> 
> 标签：java, sql, exception, derby

当我尝试使用 Java 连接到数据库时，我得到一个 java.sql.SQLException：没有合适的驱动程序。我在使用 NetBeans IDE 的 Mac OS 10.5 上。EmbeddedDriver 似乎有问题，但我不确定我缺少什么：

```
 public class A
    {
        Connection conn = null;

        public A(String URL, String username, String password) throws SQLException
        {       
                try
                {
                     Class.forName("org.apache.derby.jdbc.EmbeddedDriver");
                     conn = DriverManager.getConnection(URL, username, password);
                }
                catch (SQLException sqlException)
                {
                    sqlException.printStackTrace();
                    invalidate();
                }
                catch (ClassNotFoundException classNotFound)
                {
                    classNotFound.printStackTrace();
                    invalidate();
                }
        }
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T01:31:12.827

“没有合适的驱动程序”通常意味着您提供的用于连接的 URL 的语法不正确。你的网址是什么？

服务器版本将具有主机和端口；根据这些文档，我相信嵌入式 URL 应该是“jdbc:derby:flixnet”：[http ://db.apache.org/derby/papers/DerbyTut/embedded_intro.html](http://db.apache.org/derby/papers/DerbyTut/embedded_intro.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-06T16:24:22.020

使用“org.apache.derby.jdbc.ClientDriver”。如我所见，您访问的是 derby 服务器而不是嵌入式数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T01:32:33.523

它在这里被声明为常量：

```
final String DATABASE_URL = "jdbc:derby://localhost:1527/flixnet"; 
```

不要问名称...我通过右键单击 NetBeans 中的数据库然后转到“属性”->“数据库 URL”来获得此 URL。

我已经添加了来自同一目录的 /Applications/NetBeans/glassfish-v3-prelude/javadb/lib/derby.jar 和 derbyclient.jar 的 derby.jar 和 derbyclient.jar 文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T01:45:29.857

您是否将 derbyclient.jar 添加到 Netbeans 项目的“库”文件夹中？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-15T18:07:46.620

我有同样的问题。试试这个：

1.  确保将 JDK 和 Netbeans 更新到最新版本

2.  右键单击项目的库

3.  选择“添加库...”

4.  找到并选择“Java DB Driver”，然后单击“添加库”

这就是我解决问题的方法，我希望这对像我这样的新程序员有帮助:) PS它会为你添加“derbyclient.jar”

# c - Vala（类 C# 语言）编译成 C？

> ID：652738
> 
> 赞同：23
> 
> 时间：2009-03-17T01:29:20.020
> 
> 标签：c, gtk, vala

我是一名 C# 开发人员，偶然发现了一种新的 linux 编程语言，称为 vala。它的语法几乎与 C# 完全相同，非常棒。我从来都不是 Mono 的忠实粉丝。这允许程序员以 C# 风格的语言编写 GTK+ 应用程序。我的问题是：vala 会编译成 C 吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-17T01:33:42.087

**是的，Vala 直接编译为 C。**从 Vala 主页：

> *valac 从 Vala 源文件生成 C 源文件和头文件，就像您直接用 C 编写库或应用程序一样。在 C 应用程序中*使用 Vala 库与使用任何其他基于 GObject 的库看起来没有什么不同。不会有 vala 运行时库，应用程序可以使用它们的 tarball 分发生成的 C 代码，因此用户没有额外的运行或构建时依赖项。

您可以[在此处](http://live.gnome.org/Vala)阅读更多相关信息（还可以获取教程、邮件列表等）。这是一个相当有趣的项目。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-17T01:33:34.317

来自[维基百科](http://en.wikipedia.org/wiki/Vala_(programming_language))：

> Vala 不是直接编译成汇编程序或中间语言，而是编译成 C，然后用平台的标准 C 编译器编译。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-17T08:43:02.100

正如 John 和 Chris 所指出的，Vala 确实被编译为 C。

事实上，您可以通过运行带有`-C`(or `--ccode`) 标志的 Vala 编译器来查看生成的 C 代码。

# .net - Linq 警告

> ID：652742
> 
> 赞同：6
> 
> 时间：2009-03-17T01:32:15.303
> 
> 标签：.net, linq

Linq 是对 .NET 的一个很棒的补充，我发现它在许多情况下都能很好地为我服务，即使我才刚刚开始学习如何使用 Linq。

但是，在阅读有关 Linq 的文章时，我发现开发人员需要注意一些微妙的事情，因为这可能会导致麻烦。

我已经包含了一个明确的警告，这是我遇到的延迟执行的结果。

所以我想知道，Linq 的新开发人员应该知道哪些其他警告？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T01:33:14.973

在 foreach 循环中构建查询

```
IEnumerable<char> query = "Not what you might expect";
foreach(char vowel in "aeiou")
{
    query = query.Where(c => c != vowel);
} 
```

由于延迟执行，上面的代码只从字符串中删除了“u”。

为了删除所有元音，您需要执行以下操作：

```
IEnumerable<char> query = "Not what you might expect";
foreach(char vowel in "aeiou")
{
    char temp = vowel;
    query = query.Where(c => c != temp);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T02:05:44.473

我认为 LINQ 相当可靠，并且没有很多大的警告。我遇到的几乎每一个“问题”都是延迟执行的结果，这并不是真正的问题，而是一种不同的思维方式。

我面临的最大问题 - 在性能分析方面，LINQ 是游戏规则的改变者（或至少是规则的破坏者）。延迟执行有时会使分析应用程序变得更加困难，并且还会以意想不到的方式显着改变运行时性能特征。某些 LINQ 操作的速度似乎非常神奇，而其他操作所需的时间比我预期的要长得多——但从代码或分析器结果中并不总是很明显。

话虽如此，总的来说，延迟执行足以弥补它减慢手动编码例程的情况。我更喜欢更简单、更干净的代码，而不是它替换的代码。

此外，我发现我使用 LINQ to Objects 的次数越多，我就越需要重新思考我的设计并重新设计我的集合。

例如，在我开始频繁使用 linq 到对象之前，我从未意识到我暴露 IList 而不是 IEnumerable 的频率是多少。我现在完全理解为什么 MS 设计指南警告不要经常使用 IList（例如，不要只为 Count 属性返回 IList 等）。当我有采用 IList 的方法时，从 linq 查询传递 IEnumerable 结果需要 .ToList() 或对该方法的 API 进行改造。

但这几乎总是值得重新思考 - 我发现许多地方通过可枚举和使用 LINQ 会产生巨大的性能。收益。如果您考虑一下并充分利用它，延迟执行就很棒。例如，使用 .Take() 将集合限制为前 2 个元素（如果这就是所有需要的话）在 linq 前更具挑战性，并且大大加快了我的一些更糟糕的循环。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-21T23:38:00.730

好问题。正如 Reed 指出的那样，它们大部分都源于[*延期执行*](http://msdn.microsoft.com/en-us/library/bb738633.aspx)（但与他不同的是，我发现这是一个缺点。只是在想为什么不能通过记忆状态来执行延期执行）。这里有几个例子——都或多或少是延迟执行问题的变体。

1）**我懒得按时做某事**

> Linq 仅按需执行。

新手（包括我过去）常犯的一个错误是不知道延迟执行。例如，像

```
 var p = listOfAMillionComplexItems.OrderBy(x => x.ComplexProperty); 
```

运行很快，但是直到您枚举列表才完成实际排序，换句话说，直到您需要执行结果时才完成执行。要执行它，您需要类似以下内容：

```
foreach(var item in p)...
//or
p.Count();
//or
p.ToList();
//etc 
```

将它们视为 SQL 查询。如果你有

```
var query = from i in otherValues where i > 5 select i; 
```

认为它类似于写作

```
string query = "SELECT i FROM otherValues WHERE i > 5"; 
```

后者是否会调用 db？不，你必须

```
Execute(query); 
```

Linq 也是如此。

2）**我活在当下**

> 以后要小心 Linq 表达式中的变量发生变化。

为了安全起见，如果变量可以在实际执行查询之前更改，请先备份变量，然后在查询中使用备份。

[从这里：](http://visualstudiomagazine.com/articles/2010/08/31/5-traps-to-avoid-in-csharp.aspx)

```
decimal minimumBalance = 500;
var customersOver500 = from c in customers 
                       where c.Balance > minimumBalance 
                       select c;

minimumBalance = 200;
var customersOver200 = from c in customers
                       where c.Balance > minimumBalance 
                       select c;

int count1 = customersOver500.Count();
int count2 = customersOver200.Count(); 
```

*假设我们有四个客户的余额如下：100、300、400 和 600。count1 和 count2 将是什么？它们都是 3。“customersOver500”引用了“minimumBalance”变量，但直到迭代查询结果（通过 for/each 循环、ToList() 调用甚至是“Count ()" 调用如上所示）。在使用该值处理查询时，minimumBalance 的值已更改为 200，因此两个 LINQ 查询产生相同的结果（余额超过 200 的客户）。*

3）**我的记忆力太弱，记不起过去的贵重物品**

> 与上面相同，上下文略有不同。

或者来自同一个站点：

*考虑这个使用 LINQ-to-SQL 获取客户列表的简单方法示例：*

```
public IEnumerable<Customer> GetCustomers()
{
    using(var context = new DBContext())
    {
        return from c in context.Customers
               where c.Balance > 2000
               select c;
    }
} 
```

*似乎非常无害——直到您在尝试枚举集合时得到“ObjectDisposedException”。为什么？因为 LINQ 在您尝试枚举结果之前实际上不会执行查询。DBContext 类（它公开了 Customers 集合）在此调用退出时被释放。一旦您尝试枚举该集合，就会引用 DBContext.Customers 类并获得异常。*

4)**不要试图抓住我，我可能还是会溜走**

> 如果不明智地使用，try-catch 对语句毫无意义。

相反，全局异常处理在这里会更好。

```
try
{
    wallet = bank.Select(c => Convert.ToInt32(""));
}
catch (Exception ex)
{
    MessageBox.Show("Cannot convert bad int");
    return;
}

foreach(int i in wallet)
  //kaboom! 
```

我们既没有得到正确的错误消息，也没有函数退出`return`。

5）**我不仅不守时，而且我也没有从错误中吸取教训**

> 每次枚举它们时都会执行 Linq。所以不要重用 Linq 枚举。

假设您有一个`IQueryable`或`IEnumerable`从一个 Linq 表达式返回。现在枚举集合将执行语句，但只执行一次？不，每次你这样做。这在过去曾咬过我。如果你有：

```
var p = listOfAMillionComplexItems.OrderBy(x => x.ComplexProperty);
MessageBox.Show(p.Count().ToString()); //long process.
MessageBox.Show(p.Count().ToString()); //long process still. 
```

所以最好做

```
int i = p.Count(); //store in a variable to access count
//or better
var list = p.ToList(); //and start using list 
```

6）**如果你不知道用我，我会引起副作用！**

> 与上面相同，只是为了说明重用 Linq 枚举如何导致不良行为。

确保您不进行副作用编程（因为在 Linq 中重新枚举更为常见）举一个狂野的例子，

```
p = bag.Select((t, i) => {if(i == 1) MessageBox.Show("Started off"); return t;}); 
```

如果你列举两次，你就会知道会发生什么不受欢迎的事情。

7）**注意我在链接时执行的顺序**

> 不仅对于变量，即使是链接的 Linq 函数也可以按照与您通常期望的顺序不同的顺序执行（尽管行为是正确的）。不要认为势在必行（一步一步），想想 Linq 如何可能执行它。

例如，

```
var d = Enumerable.Range(1, 100);
var f = d.Select(t => new Person());
f = f.Concat(f);
f.Distinct().Count() ?? 
```

中不同的人的数量是`f`多少？我猜是 100，不，但它是 200。问题是，当实际执行连接逻辑时，`f`仍然`d.Select(t => new Person()` **未执行**。所以这有效地产生了

```
f = d.Select(t => new Person()).Concat(d.Select(t => new Person())); 
```

然后有 200 个不同的成员。[这是实际问题的链接](https://stackoverflow.com/questions/13500641/is-the-order-of-execution-of-linq-the-reason-for-this-catch)

8)**嘿，实际上我们比你想象的要聪明。**

> 本身并不是一个警告，但在许多情况下，Linq 可以胜过您的命令式程序。因此，在优化之前，请三思而后行，甚至进行基准测试。

延迟执行基本上是按需执行的原因，使得 Linq 比看起来要高效得多。迭代器块根据需要一次“生成”一个项目，从而在不再需要时停止执行。这是一个很好的问题，详细说明了这一点：[LINQ 扩展方法的顺序不会影响性能？](https://stackoverflow.com/questions/10110013/order-of-linq-extension-methods-does-not-affect-performance)

9)**我不是要计算数字**

> 滥用 Linq 会使代码效率低下且可读性差。

对于数字运算算法，Linq 不是正确的工具，尤其是对于复杂性可以呈指数级扩展的大型数据集。有时只有两个 for 循环就足够了。与 LINQ to SQL 相比，这同样适用于原始 SQL。

10)**雇用我做合适的工作**

> 要求 Linq 关注您的正常业务是糟糕的编程选择，这违背了可读性。

一些例如：

```
medicines.Any(p =>
{
    Console.WriteLine(p);
    return false;
}); 
```

对于可枚举的 foreach。

或者

```
medicines = medicines.Select(p =>
{
    p.Id = 3;
    return p;
}); 
```

只是糟糕的工具。

11)**调试和分析可能是一场噩梦**

> 很难理解 VS 的 Linq 表达式背后发生的事情

并不是说它完全不可能，但它的任务是调试 linq 查询与来自 VS 本身的非 linq 代码一样有效。由于延迟执行的性质，分析也变得有点困难。但它不应该阻止任何人做微不足道的一两个班轮！

* * *

一堆或多或少与延迟执行有关的警告！[这里有一个同上的问题](https://stackoverflow.com/questions/3703681/common-linq-standard-query-operator-mistakes-mis-steps)。关于 SO 的一些相关阅读：

[何时不使用 LINQ 的示例](https://stackoverflow.com/questions/779876/examples-on-when-not-to-use-linq?lq=1)

[LINQ（语言集成查询）的优缺点](https://stackoverflow.com/questions/271384/pros-and-cons-of-linq-language-integrated-query)

[人们在开始使用 LINQ 时犯的最大错误是什么？](https://stackoverflow.com/questions/777400/what-is-the-biggest-mistake-people-make-when-starting-to-use-linq)

[linq的缺点](https://stackoverflow.com/questions/814476/drawbacks-of-linq?lq=1)

# python - 如何解锁 sqlite3 数据库？

> ID：652750
> 
> 赞同：1
> 
> 时间：2009-03-17T01:33:18.047
> 
> 标签：python, django

我的天啊！

多么明显的问题……我基于 django 的脚本锁定了我的 sqlite 数据库……

有谁知道如何解决？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T01:37:21.717

您的数据库已锁定，因为您在某处运行了事务。

停止所有 Django 应用程序。如有必要，重新启动。

您也有可能在事务中间使 SQLite 客户端崩溃并且文件锁留在原地。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-28T12:49:00.267

确保数据库文件不是只读的，或者您没有其他应用程序已经打开数据库。例如

```
$ ps aux | grep sqlite
martin   21118  0.0  0.3

$ kill -9 21118 
```

# jquery - 如何将 jQuery 对象转换为字符串？

> ID：652763
> 
> 赞同：422
> 
> 时间：2009-03-17T01:38:51.247
> 
> 标签：jquery, stringification

如何将 jQuery 对象转换为字符串？

* * *

## 回答 #1

> 赞同：636
> 
> 时间：2009-03-17T01:44:25.430

我假设您要的是完整的 HTML 字符串。如果是这样的话，这样的事情就可以解决问题：

```
$('<div>').append($('#item-of-interest').clone()).html(); 
```

[这在此处](http://jquery-howto.blogspot.com/2009/02/how-to-get-full-html-string-including.html)进行了更深入的解释，但本质上您创建一个新节点来包装感兴趣的项目，进行操作，删除它，然后获取 HTML。

如果您只是在字符串表示之后，请使用`new String(obj)`.

# 更新

我在 2009 年写了原始答案。截至 2014 年，大多数主流浏览器现在都支持`outerHTML`作为本机属性（例如，请参见[Firefox](https://developer.mozilla.org/en-US/docs/Web/API/Element.outerHTML)和[Internet Explorer](http://msdn.microsoft.com/en-us/library/ie/ms534310(v=vs.85).aspx))），因此您可以这样做：

```
$('#item-of-interest').prop('outerHTML'); 
```

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2011-09-29T03:18:54.170

使用 jQuery 1.6，这似乎是一个更优雅的解决方案：

```
$('#element-of-interest').prop('outerHTML'); 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2012-03-16T11:37:06.487

只需使用 .get(0) 获取本机元素，并获取其 outerHTML 属性：

```
var $elem = $('<a href="#">Some element</a>');
console.log("HTML is: " + $elem.get(0).outerHTML); 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-03-17T01:47:09.340

你能再具体一点吗？如果您尝试获取标签内的[HTML](http://en.wikipedia.org/wiki/HTML)，您可以执行以下操作：

HTML 片段：

```
<p><b>This is some text</b></p> 
```

jQuery：

```
var txt = $('p').html(); // Value of text is <b>This is some text</b> 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-11-17T11:55:56.387

找出 HTML 节点（对象）可用的属性和方法的最佳方法是执行以下操作：

```
console.log($("#my-node")); 
```

从 jQuery 1.6+ 你可以只使用 outerHTML 在你的字符串输出中包含 HTML 标签：

```
var node = $("#my-node").outerHTML; 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-05-13T10:26:35.613

jQuery 在这里，所以：

```
jQuery.fn.goodOLauterHTML= function() {
    return $('<a></a>').append( this.clone() ).html();
} 
```

返回所有 HTML 内容：

```
$('div' /*elys with HTML text stuff that you want */ ).goodOLauterHTML(); // alerts tags and all 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-06-09T12:11:32.887

这对我来说似乎很好用：

```
$("#id")[0].outerHTML 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-03-30T11:36:18.610

接受的答案不包括文本节点（未定义被打印出来）。

此代码段解决了它：

```
var htmlElements = $('<p><a href="http://google.com">google</a></p>↵↵<p><a href="http://bing.com">bing</a></p>'),
    htmlString = '';

htmlElements.each(function () {
    var element = $(this).get(0);

    if (element.nodeType === Node.ELEMENT_NODE) {
        htmlString += element.outerHTML;
    }
    else if (element.nodeType === Node.TEXT_NODE) {
        htmlString += element.nodeValue;
    }
});

alert('String html: ' + htmlString);
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-02-13T18:37:50.270

无需克隆并添加到 DOM 即可使用 .html()，您可以：

```
$('#item-of-interest').wrap('<div></div>').html() 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-26T04:48:15.627

可以使用`jQuery.makeArray(obj)`实用功能：

```
var obj = $('<p />',{'class':'className'}).html('peekaboo');
var objArr = $.makeArray(obj);
var plainText = objArr[0]; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-12-15T15:14:34.673

如果您想对 HTML 元素进行字符串化以便将其传递到某处并将其解析回元素，请尝试为该元素创建一个唯一查询：

```
// 'e' is a circular object that can't be stringify
var e = document.getElementById('MyElement')

// now 'e_str' is a unique query for this element that can be stringify 
var e_str = e.tagName
  + ( e.id != "" ? "#" + e.id : "")
  + ( e.className != "" ? "." + e.className.replace(' ','.') : "");

//now you can stringify your element to JSON string
var e_json = JSON.stringify({
  'element': e_str
}) 
```

比

```
//parse it back to an object
var obj = JSON.parse( e_json )

//finally connect the 'obj.element' varible to it's element
obj.element = document.querySelector( obj.element )

//now the 'obj.element' is the actual element and you can click it for example:
obj.element.click(); 
```

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2009-03-17T01:42:55.997

```
new String(myobj) 
```

如果要将整个对象序列化为字符串，请使用[JSON](http://en.wikipedia.org/wiki/JSON)。

# mysql - 在 MySQL 中使用 Join 删除

> ID：652770
> 
> 赞同：553
> 
> 时间：2009-03-17T01:44:05.523
> 
> 标签：mysql

这是创建我的表的脚本：

```
CREATE TABLE clients (
   client_i INT(11),
   PRIMARY KEY (client_id)
);
CREATE TABLE projects (
   project_id INT(11) UNSIGNED,
   client_id INT(11) UNSIGNED,
   PRIMARY KEY (project_id)
);
CREATE TABLE posts (
   post_id INT(11) UNSIGNED,
   project_id INT(11) UNSIGNED,
   PRIMARY KEY (post_id)
); 
```

在我的 PHP 代码中，删除客户端时，我想删除所有项目帖子：

```
DELETE 
FROM posts
INNER JOIN projects ON projects.project_id = posts.project_id
WHERE projects.client_id = :client_id; 
```

posts 表没有外键`client_id`，只有`project_id`. 我想删除项目中通过的帖子`client_id`。

这现在不起作用，因为没有删除任何帖子。

* * *

## 回答 #1

> 赞同：1397
> 
> 时间：2010-11-16T09:51:36.947

您只需要指定要从`posts`表中删除条目：

```
DELETE posts
FROM posts
INNER JOIN projects ON projects.project_id = posts.project_id
WHERE projects.client_id = :client_id 
```

编辑：有关更多信息，您可以查看[此替代答案](https://stackoverflow.com/a/29204958/214545)

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2015-03-23T07:18:09.470

由于您选择了多个表，因此要删除的表不再是明确的。您需要*选择*：

```
DELETE posts FROM posts
INNER JOIN projects ON projects.project_id = posts.project_id
WHERE projects.client_id = :client_id 
```

在这种情况下，`table_name1`和`table_name2`是同一张表，所以这将起作用：

```
DELETE projects FROM posts INNER JOIN [...] 
```

如果您愿意，您甚至可以从两个表中删除：

```
DELETE posts, projects FROM posts INNER JOIN [...] 
```

请注意，`order by`并且`limit` [不适用于多表删除](http://dev.mysql.com/doc/refman/5.7/en/delete.html)。

另请注意，如果为表声明别名，则在引用该表时必须使用别名：

```
DELETE p FROM posts as p INNER JOIN [...] 
```

* * *

^([来自 Carpetsmoker 等的贡献](https://stackoverflow.com/revisions/4192849/4)。)

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2011-09-01T04:14:09.530

或同样的事情，但语法略有不同（IMO 更友好）：

```
DELETE FROM posts 
USING posts, projects 
WHERE projects.project_id = posts.project_id AND projects.client_id = :client_id; 
```

顺便说一句，使用 mysql 连接几乎总是比子查询快...

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2014-03-15T15:11:15.893

您也可以像这样使用 ALIAS，它只在我的数据库上使用过！t 是需要删除的表！

```
DELETE t FROM posts t
INNER JOIN projects p ON t.project_id = p.project_id
AND t.client_id = p.client_id 
```

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2009-03-17T01:52:46.237

我更习惯于这个子查询解决方案，但我还没有在 MySQL 中尝试过：

```
DELETE  FROM posts
WHERE   project_id IN (
            SELECT  project_id
            FROM    projects
            WHERE   client_id = :client_id
        ); 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2016-08-14T04:12:47.073

**单表删除：**

**为了从`posts`表中删除条目：**

```
DELETE ps 
FROM clients C 
INNER JOIN projects pj ON C.client_id = pj.client_id
INNER JOIN posts ps ON pj.project_id = ps.project_id
WHERE C.client_id = :client_id; 
```

**为了从`projects`表中删除条目：**

```
DELETE pj 
FROM clients C 
INNER JOIN projects pj ON C.client_id = pj.client_id
INNER JOIN posts ps ON pj.project_id = ps.project_id
WHERE C.client_id = :client_id; 
```

**为了从`clients`表中删除条目：**

```
DELETE C
FROM clients C 
INNER JOIN projects pj ON C.client_id = pj.client_id
INNER JOIN posts ps ON pj.project_id = ps.project_id
WHERE C.client_id = :client_id; 
```

* * *

**多个表删除：**

为了从连接结果中删除多个表中的条目，您需要在`DELETE`逗号分隔列表之后指定表名：

假设您要删除特定客户端的所有三个表（ `posts`、、`projects`）中的条目：`clients`

```
DELETE C,pj,ps 
FROM clients C 
INNER JOIN projects pj ON C.client_id = pj.client_id
INNER JOIN posts ps ON pj.project_id = ps.project_id
WHERE C.client_id = :client_id 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2015-08-05T05:54:56.710

MySQL DELETE 记录与 JOIN

您通常在 SELECT 语句中使用 INNER JOIN 从一个表中选择在其他表中有相应记录的记录。我们还可以使用带有 DELETE 语句的 INNER JOIN 子句从表中删除记录以及其他表中的相应记录，例如，从 T1 和 T2 表中删除满足特定条件的记录，您使用以下语句：

```
DELETE T1, T2
FROM T1
INNER JOIN T2 ON T1.key = T2.key
WHERE condition 
```

请注意，您将表名 T1 和 T2 放在 DELETE 和 FROM 之间。如果省略 T1 表，DELETE 语句只删除 T2 表中的记录，如果省略 T2 表，则只删除 T1 表中的记录。

连接条件 T1.key = T2.key 指定了 T2 表中需要删除的对应记录。

WHERE 子句中的条件指定需要删除 T1 和 T2 中的哪些记录。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-03-06T11:59:46.333

尝试如下：

```
DELETE posts.*,projects.* 
FROM posts
INNER JOIN projects ON projects.project_id = posts.project_id
WHERE projects.client_id = :client_id; 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-09-12T18:05:07.387

使用比使用更好的子选择进行删除的另一种方法`IN`是`WHERE` `EXISTS`

```
DELETE  FROM posts
WHERE   EXISTS ( SELECT  1 
                 FROM    projects
                 WHERE   projects.client_id = posts.client_id); 
```

使用 this 而不是 join 的一个原因是`DELETE`with`JOIN`禁止使用`LIMIT`. 如果您希望在块中删除以免产生全表锁，您可以添加`LIMIT`使用此`DELETE WHERE EXISTS`方法。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2015-06-13T05:50:06.667

```
mysql> INSERT INTO tb1 VALUES(1,1),(2,2),(3,3),(6,60),(7,70),(8,80);

mysql> INSERT INTO tb2 VALUES(1,1),(2,2),(3,3),(4,40),(5,50),(9,90); 
```

**从一张表中删除记录：**

```
mysql> DELETE tb1 FROM tb1,tb2 WHERE tb1.id= tb2.id; 
```

**从两个表中删除记录：**

```
mysql> DELETE tb2,tb1 FROM tb2 JOIN tb1 USING(id); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-10-07T08:55:04.987

如果加入对您不起作用，您可以尝试此解决方案。用于在不使用外键 + 特定 where 条件时从 t1 中删除孤立记录。即它从table1中删除记录，这些记录具有空字段“code”并且table2中没有记录，通过字段“name”匹配。

```
delete table1 from table1 t1 
    where  t1.code = '' 
    and 0=(select count(t2.name) from table2 t2 where t2.name=t1.name); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-04-04T09:18:58.180

试试这个，

```
DELETE posts.*
FROM posts
INNER JOIN projects ON projects.project_id = posts.project_id
WHERE projects.client_id = :client_id 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-10-27T10:14:23.037

一种解决方案是使用子查询

```
DELETE FROM posts WHERE post_id in (SELECT post_id FROM posts p
INNER JOIN projects prj ON p.project_id = prj.project_id 
INNER JOIN clients c on prj.client_id = c.client_id WHERE c.client_id = :client_id 
); 
```

子查询返回需要删除的ID；所有三个表都使用连接连接，并且仅删除满足过滤条件的那些记录（在您的情况下，即 where 子句中的 client_id）。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2016-07-12T21:42:35.293

-- 请注意，您不能在需要删除的表上使用别名

```
DELETE tbl_pagos_activos_usuario
FROM tbl_pagos_activos_usuario, tbl_usuarios b, tbl_facturas c
Where tbl_pagos_activos_usuario.usuario=b.cedula
and tbl_pagos_activos_usuario.cod=c.cod
and tbl_pagos_activos_usuario.rif=c.identificador
and tbl_pagos_activos_usuario.usuario=c.pay_for
and tbl_pagos_activos_usuario.nconfppto=c.nconfppto
and NOT ISNULL(tbl_pagos_activos_usuario.nconfppto)
and c.estatus=50 
```

# asp.net - 有没有办法对 ASP.NET 开发 Web 服务器进行远程调用？

> ID：652777
> 
> 赞同：19
> 
> 时间：2009-03-17T01:47:51.333
> 
> 标签：asp.net, iis, asp.net-development-serv

我**知道**一般来说，这是做不到的，那就是让另一台PC远程调用托管在ASP.NET DEvelopment Web Server下的站点（一般只能使用localhost：port来访问它）。

但我想知道是否有人看到或知道绕过它的方法？我是我办公室的 RESTful API 开发人员，我希望 PHP 人员在我的机器上测试 API，以便我可以连接 Visual Studio 2005 调试器，并且我可以更轻松地发现问题。

主要问题是，我的机器是 Vista 机器，不幸的是，我开发的 API 不能在 IIS7 下工作，即使是经典应用程序池模式（这消除了在本地 IIS 上托管它们是不可能的）。

或者，有没有办法在另一台机器上使用 IIS6 来满足我的需求？

**更新**

根据我得到的建议，经过多次试验和错误，我能够让 Squid 充当反向代理，并完全按照我的意愿去做。我已经在博客上写了[http://www.ashleyangell.com/index.php/2009/03/configuring-a-basic-reverse-proxy-in-squid-on-windows-website-accelerator/](http://www.ashleyangell.com/index.php/2009/03/configuring-a-basic-reverse-proxy-in-squid-on-windows-website-accelerator/)以防其他人想要做同样的事情。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-05-25T10:13:41.810

这比 Squid 选项要容易得多：

[“从 iPhone 访问 Visual Studio ASP.NET 开发服务器”](http://web.archive.org/web/20100926083848/http://www.pluralsight-training.net/community/blogs/jimw/archive/2009/09/03/accessing-the-visual-studio-asp-net-development-server-from-iphone.aspx)

此外，还有一个在 Windows 7 下也能正常运行的更新：

[“iPhone 访问 Visual Studio ASP.NET 开发服务器 - Windows 7 更新”](http://web.archive.org/web/20100925095856/http://www.pluralsight-training.net/community/blogs/jimw/archive/2010/08/18/iphone-accessing-the-visual-studio-asp-net-development-server-windows-7-update.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-08-14T18:47:41.567

我刚刚成功地尝试了[http://code.activestate.com/recipes/483732-asynchronous-port-forwarding/](http://code.activestate.com/recipes/483732-asynchronous-port-forwarding/)。这是一个仅转发流量的 Python 脚本。

假设您的开发服务器运行的机器是`192.168.42.42`并且开发服务器在端口`12345`上，使用命令行参数运行脚本（在同一台机器上）

```
-l 192.168.42.42 -p 8000 -r 127.0.0.1 -P 12345 
```

然后，您可以从另一台机器上通过`http://192.168.42.42:8000`.

请务必`sender.handle_close`按照 Dwight Walker 在评论中的说明进行更改：

```
def handle_close(self):
    self.close()
    if len(self.receiver.to_remote_buffer) == 0:
        self.receiver.close() 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T02:03:59.890

你不能在[经典应用程序池模式下](http://www.newguid.net/blog/post/2008/12/03/Run-webapplication-on-IIS7-(Vista)-in-classic-mode.aspx)运行 IIS7吗？

开发 Web 服务器严格限制为 Localhost，您要么需要反编译并重新编译它，要么在您的机器上设置某种代理。

还有一个不相关的主题：即使 Win2003 Server SP2 R2 应该支持到 2012 年 3 月，也许应该将 IIS7 支持添加到您的应用程序中，以确保您也可以在 2008 Server 上运行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-18T05:34:14.080

基本上我花了 5 个小时来完成这项工作，最终如果你想要一个 5 分钟的修复，那就去：

```
1\. Port forward incoming traffic to your local ip on your network
TCP Any -> 3127-3128
TCP Any -> 80-81
TCP Any -> 8080
TCP Any -> 8000
TCP Any -> 8888
to
192.1681.1.3 (the local ip of the machine running .NET Dev server.)

2\. Download SPI Port Forward

3\. Heres the tricky part - Setup 2 forwarding rules as follows:
Local port: 8080 Remote: localhost Remote port 8080
Local port: 8080 Remote: localhost Remote port: .NET Dev server port

Without that second rule the .NET dev server wont serve the page

4\. now visit your public IP address at port 8080 -- and you got it 
```

Z

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T16:47:11.250

您可能想查看 UltiDev 的[Cassini Web 服务器](http://ultidev.com/products/Cassini/)版本。他们采用了 Microsoft 开源 Cassini Web 服务器并对其进行了增强，以允许远程连接等。

您可以将 VS 附加到该进程，并观察从 PHP 应用程序调用的 RESTful API，正如您在上面描述的那样。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-12T22:55:58.807

只需使用一个简单的 Java TCP 隧道。下载这个 Java 应用程序，然后将流量返回。无需弄乱 IIS！

[http://jcbserver.uwaterloo.ca/cs436/software/tgui/tcpTunnelGUI.shtml](http://jcbserver.uwaterloo.ca/cs436/software/tgui/tcpTunnelGUI.shtml)

在命令提示符下，您将像这样运行 java 应用程序...假设您希望在端口 80 上进行外部访问，并且您的标准调试环境在端口 1088 上运行...

java -jar tunnel.jar 80 localhost 1088（也在这里回答：Accessing asp.net development server external to VM）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T02:06:05.550

将 IIS 7 切换到经典管道并不能解决您的兼容性问题？VS 2005 有一个远程调试器，之前的许多版本也是如此。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-10T13:36:45.900

就在这里！:D

我也在四处寻找以克服这个限制一段时间，无意中我偶然发现了以下文章：

[http://eeichinger.blogspot.com/2009/12/sniff-http-traffic-with-aspnet.html](http://eeichinger.blogspot.com/2009/12/sniff-http-traffic-with-aspnet.html)

我自己还没有尝试过，但看起来又快又简单（尽管有些人可能会说这是硬核）。
顺便提一句。我建议您查看[Erich Eichinger 博客上的](http://eeichinger.blogspot.com/)其他一些帖子，因为这里有更多真正有价值的东西。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-09-04T09:51:01.403

这篇文章帮助了我： [http](http://staticvoidmain.cognitioab.se/index.php/2013/01/remote-debugging-asp-net-development-server-with-spi-port-forward/) ://staticvoidmain.cognitioab.se/index.php/2013/01/remote-debugging-asp-net-development-server-with-spi-port-forward/ 它建议使用第三方您的开发人员机器上的应用程序充当代理（有点）。所以你连接到这个应用程序，它会将你的所有请求转发到开发服务器。像魔术一样工作:)

# c++ - 自动将类定义与声明分开？

> ID：652779
> 
> 赞同：3
> 
> 时间：2009-03-17T01:48:13.610
> 
> 标签：c++, templates, compilation, declaration, instantiation

我正在使用一个几乎完全**由头文件中的模板类和函数**组成的库，如下所示：

```
// foo.h
template<class T>
class Foo {
  Foo(){}
  void computeXYZ() { /* heavy code */ }
};
template<class T>
void processFoo(const Foo<T>& foo) { /* more heavy code */ } 
```

现在这很糟糕，因为每当我包含其中一个头文件（实际上我在每个编译单元中都包含其中的许多头文件）时，**编译时间都是难以忍受的。**

因为作为模板参数我只使用一种或两种类型，所以我打算为每个库头文件创建**一个只包含声明的文件**，没有繁重的代码，如下所示：

```
// NEW: fwd-foo.h
template<class T>
class Foo {
  Foo();
  void computeXYZ();
};
template<class T>
void processFoo(const Foo<T>& foo); 
```

然后是一个文件，它创建了我需要的所有实例化。该文件可以**一劳永逸地单独编译**：

```
// NEW: foo.cpp
#include "foo.h"
template class Foo<int>;
template class Foo<double>;
template void processFoo(const Foo<int>& foo);
template void processFoo(const Foo<double>& foo); 
```

现在我可以只包含`fwd-foo.h`在我的代码中并且编译时间很短。我会`foo.o`在最后链接反对。

`fwd-foo.h`当然，缺点是我必须自己创建这些新`foo.cpp`文件。当然，这是一个维护问题：当一个新的库版本发布时，我必须让它们适应那个新版本。还有其他缺点吗？

我的主要问题是：

我有没有机会创建这些新文件，尤其是从原始文件`fwd-foo.h`中**自动**`foo.h`创建？我必须对许多库头文件（可能 20 个左右）执行此操作，并且最好使用自动解决方案，尤其是在发布新库版本并且我必须使用新版本再次执行此操作的情况下。是否有任何工具可用于此任务？

**编辑：**

附加问题：在这种情况下，新支持的`extern`关键字如何帮助我？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T11:01:26.043

我们使用[lzz](http://www.lazycplusplus.com)将单个文件拆分为单独的标题和翻译单元。默认情况下，它通常也会将模板定义放入标题中，但是，您可以指定您不希望这种情况发生。

为了向您展示如何使用它，请考虑以下几点：

```
// t.cc
#include "b.h"
#include "c.h"

template <typename T> 
class A {
  void foo () {
    C c;
    c.foo ();
    b.foo ();
  }
  B b;
} 
```

将上述文件复制到“t.lzz”文件中。根据需要将任何*#include*指令放入单独的 $hdr 和 $src 块中：

```
// t.lzz
$hdr
#include "b.h"
$end

$src
#include "c.h"
$end

template <typename T> 
class A {
  void foo () {
    C c;
    c.foo ();
    b.foo ();
  }
  B b;
} 
```

现在最后，在文件上运行 lzz，指定它将模板定义放入源文件中。您可以使用源文件中的*$pragma*执行此操作，也可以使用命令行选项“-ts”：

这将导致生成以下文件：

```
// t.h
//

#ifndef LZZ_t_h
#define LZZ_t_h
#include "b.h"
#undef LZZ_INLINE
#ifdef LZZ_ENABLE_INLINE
#define LZZ_INLINE inline
#else
#define LZZ_INLINE       
#endif
template <typename T>
class A
{
  void foo ();
  B b;
};
#undef LZZ_INLINE
#endif 
```

和：

```
// t.cpp
//

#include "t.h"
#include "c.h"
#define LZZ_INLINE inline
template <typename T>
void A <T>::foo ()
          {
    C c;
    c.foo ();
    b.foo ();
  }
#undef LZZ_INLINE 
```

然后，您可以通过一些 grep/sed 命令运行这些命令以删除 LZZ 辅助宏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T03:25:27.417

尝试使用预编译的头文件。我知道 GCC 和 MSVC 支持这个功能。但是，使用是特定于供应商的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T07:11:17.000

很长一段时间以来，我一直在研究同样的问题。在您提出的解决方案中，您定义了两次模板类。如果它定义了相同的东西（以相同的顺序）就可以了，但是你迟早会遇到问题。

我想出的是反过来考虑这个问题。只要您不专门化您的实现，它就可以正常工作。

它使用两个宏，这避免了必须在实现文件中更新模板参数（但是，如果你想向类添加默认模板参数，请小心）。

```
// foo.h
#define FOO_TEMPLATE template<typename T>
#define FOO_CLASS Foo<T>

FOO_TEMPLATE
class Foo {
  Foo();
  void computeXYZ();
};

// foo_impl.h
#include "foo.h"
FOO_TEMPLATE
FOO_CLASS::Foo(){}

FOO_TEMPLATE
void FOO_CLASS::computeXYZ() { /* heavy code */ } 
```

通过这样做，您基本上可以像使用非模板类一样工作（当然，您可以使用模板函数做同样的事情）。

**编辑：关于 c++0x 中的 extern 关键字**

我相信 c++0x 中的 extern 关键字会有所帮助，但它不会神奇地解决所有问题！

从[这篇文章中](http://articles.directorym.net/Whats_New_in_C00X-a923867.html)，

> 外部模板
> 
> 每个实例化模板的模块本质上都会在目标代码中创建它的副本。然后，由链接器在最后阶段处理所有冗余目标代码，从而减慢构成程序员一天（或有时是白日梦）的关键编辑-编译-链接周期。为了缩短这个目标代码垃圾收集，许多编译器供应商已经实现了一个可以放在模板前面的 extern 关键字。这是一个将现有行业实践（双关语）编纂成标准化的案例。在实践中，这是通过向编译器发送通知来实现的，基本上是“不要在此处实例化它”：
> 
> ```
> extern template class std::vector; 
> ```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-17T03:22:59.920

C++0x 将使用外部模板修复您的编译时间问题。不过，我不知道一种自动的方式来做你问的事情。

# xaml - 是否可以使用 Nant 编译 Silverlight 控件项目？

> ID：652782
> 
> 赞同：0
> 
> 时间：2009-03-17T01:50:38.457
> 
> 标签：xaml, nant

我试图用 Nant 编译我的 Silverlight 控制项目，但没有运气。由于我的项目包含 XAML 文件，我不确定 Nant 是否能够从 XAML 文件生成 .g.cs 文件以编译到项目中。我遇到过人们建议使用 MsBuild 任务的帖子。有没有办法避免使用 MsBuild 任务并仅使用 Nant 编译项目？我不反对使用 MsBuild 任务。但如果可能的话，宁愿不使用它。

谢谢你，维什

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-25T11:33:03.017

据我了解，nant 目前不支持此功能。对于编译步骤的这些部分，大多数人都必须使用 shell 到 msbuild。

但是，如果您知道预编译器的额外命令，例如用于生成 g.cs 文件的程序，那么理论上您可以使用新任务扩展 nant 以执行该步骤，然后您可以获得所需的内容。

可能需要做更多的工作，但如果你让它工作，我相信他们也可以使用它，如果有人还没有为它做任何事情。

# facebook - Javascript 压缩工作流程

> ID：652783
> 
> 赞同：0
> 
> 时间：2009-03-17T01:51:36.863
> 
> 标签：facebook

任何拥有大量 Javascript 代码的网站都希望对其进行压缩以进行部署。最好的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T01:53:29.480

一种方法是编写一个调用缩小程序的 shell 脚本，然后在完成后调用 appcfg.py。我不确定 appcfg.py 本身是否支持触发 jsmin 或 YUI 压缩器或其他东西的钩子。

在运行时测试应用程序是否已部署并放置一个指向不同 javascript 文件的链接（如果是）并没有太大的性能影响，但是在运行时进行实际压缩对性能的影响有点太大了。

shell 脚本可能看起来像这样：

```
rm根/js/js.js
猫根/js/*.js > 根/js/js.js
java -jar ~/opt/yuicompressor-2.4.2.jar root/js/js.js -o root/static/js.js --line-break 4000

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T17:35:28.190

您还可以找到有用的[google.load()](http://code.google.com/intl/fr/apis/ajaxlibs/documentation/) api，它将这个问题转移到 google 的服务器。

此外，以这种方式维护和升级库更容易。

# c++ - 你遇到过的最糟糕的现实世界宏/预处理器滥用是什么？

> ID：652788
> 
> 赞同：176
> 
> 时间：2009-03-17T01:57:42.077
> 
> 标签：c++, c, macros, preprocessor

您遇到过的最糟糕的现实世界宏/预处理器滥用是什么（请不要做作的 IOCCC 回答 *哈哈* *）* **？**

如果真的很有趣，请添加一个简短的片段或故事。目标是教一些东西，而不是总是告诉人们“永远不要使用宏”。

* * *

ps：我以前使用过宏......但通常当我有一个“真正的”解决方案时我最终会摆脱它们（即使真正的解决方案是内联的，所以它变得类似于宏）。

* * *

**奖励：**举一个宏确实比非宏解决方案更好的例子。

**相关问题：** [C++ 宏何时有益？](https://stackoverflow.com/questions/96196/when-are-c-macros-beneficial)

* * *

## 回答 #1

> 赞同：409
> 
> 时间：2009-03-17T03:31:59.757

根据记忆，它看起来像这样：

```
#define RETURN(result) return (result);}

int myfunction1(args) {
    int x = 0;
    // do something
    RETURN(x)

int myfunction2(args) {
    int y = 0;
    // do something
    RETURN(y)

int myfunction3(args) {
    int z = 0;
    // do something
    RETURN(z) 
```

是的，没错，任何函数中都没有右括号。语法高亮一团糟，所以他用 vi 来编辑（不是 vim，它有语法着色！）

他是一位俄罗斯程序员，主要从事汇编语言工作。他热衷于保存尽可能多的字节，因为他以前曾在内存非常有限的系统上工作。“它是用于卫星的。只有很少的字节，所以我们将每个字节用于很多事情。” （有点摆弄，将机器指令字节重用于它们的数值）当我试图找出什么样的卫星时，我只能得到“轨道卫星。用于进入轨道”。

他还有两个怪癖：一个安装在显示器上方的凸面镜“用于知道谁在看”，以及偶尔突然从椅子上下来做十个快速俯卧撑。他将最后一个解释为“编译器在代码中发现错误。这是惩罚”。

* * *

## 回答 #2

> 赞同：274
> 
> 时间：2009-03-17T02:38:07.423

我最糟糕的：

```
#define InterlockedIncrement(x) (x)++
#define InterlockedDecrement(x) (x)-- 
```

我花了两天的时间来追踪一些多线程 COM 引用计数问题，因为某些白痴将其放在了头文件中。我不会提及我当时工作的公司。

这个故事的寓意是什么？如果您不理解某些内容，请阅读文档并了解它。不要只是让它消失。

* * *

## 回答 #3

> 赞同：166
> 
> 时间：2009-03-17T02:04:27.910

```
#define ever (;;)
for ever { 
   ...
} 
```

* * *

## 回答 #4

> 赞同：145
> 
> 时间：2009-03-17T04:32:05.510

```
#include <iostream>
#define System S s;s
#define public
#define static
#define void int
#define main(x) main()
struct F{void println(char* s){std::cout << s << std::endl;}};
struct S{F out;};

public static void main(String[] args) {
  System.out.println("Hello World!");
} 
```

挑战：任何人都可以用更少的定义和结构来做到这一点吗？;-)

* * *

## 回答 #5

> 赞同：130
> 
> 时间：2009-03-17T02:01:09.757

```
#define private public 
```

* * *

## 回答 #6

> 赞同：107
> 
> 时间：2009-03-17T03:36:12.540

```
#define if while 
```

这是拿某人开的玩笑，受影响的人并不觉得这很有趣

* * *

## 回答 #7

> 赞同：106
> 
> 时间：2009-03-17T02:19:20.633

可怕的：

```
#define begin {
#define end }
/* and so on */ 
```

说真的，如果你想用 Pascal 编码，买一个 Pascal 编译器，不要破坏美丽的 C 语言。

* * *

## 回答 #8

> 赞同：93
> 
> 时间：2009-03-17T02:34:46.777

一个“建筑师”，非常谦虚的人，你知道的类型，有以下几点：

```
#define retrun return 
```

因为他喜欢打字快。这位脑外科医生过去喜欢对比他聪明的人（几乎所有人）大喊大叫，并威胁要对他们使用黑带。

* * *

## 回答 #9

> 赞同：69
> 
> 时间：2009-03-17T10:36:22.483

真实世界？MSVC 在 minmax.h 中有宏，称为`max`and `min`，每次我打算使用标准`std::numeric_limits<T>::max()`函数时都会导致编译器错误。

* * *

## 回答 #10

> 赞同：58
> 
> 时间：2009-03-17T10:22:45.153

Pascal 语法和法语关键字的混合：

```
#define debut {
#define fin }
#define si if(
#define alors ){
#define sinon }else{
#define finsi } 
```

* * *

## 回答 #11

> 赞同：56
> 
> 时间：2009-03-17T04:21:08.050

Raymond Chen[非常反对使用流量控制宏](http://blogs.msdn.com/oldnewthing/archive/2005/01/06/347666.aspx)。他最好的例子直接来自原始的 Bourne shell 源代码：

```
ADDRESS alloc(nbytes)
    POS     nbytes;
{
    REG POS rbytes = round(nbytes+BYTESPERWORD,BYTESPERWORD);

    LOOP    INT     c=0;
    REG BLKPTR  p = blokp;
    REG BLKPTR  q;
    REP IF !busy(p)
        THEN    WHILE !busy(q = p->word) DO p->word = q->word OD
        IF ADR(q)-ADR(p) >= rbytes
        THEN    blokp = BLK(ADR(p)+rbytes);
            IF q > blokp
            THEN    blokp->word = p->word;
            FI
            p->word=BLK(Rcheat(blokp)|BUSY);
            return(ADR(p+1));
        FI
        FI
        q = p; p = BLK(Rcheat(p->word)&~BUSY);
    PER p>q ORF (c++)==0 DONE
    addblok(rbytes);
    POOL
} 
```

* * *

## 回答 #12

> 赞同：54
> 
> 时间：2009-08-07T00:00:14.390

我想为比赛提交一个名为[chaos-pp](http://chaos-pp.cvs.sourceforge.net/chaos-pp/order-pp/example/bottles.c?revision=1.10&view=markup)的 gem ，它通过预处理器宏实现了一种功能语言。

示例之一是完全由预处理器计算第 500 个斐波那契数：

预处理器之前的原始代码如下所示：

```
int main(void) {
   printf
     ("The 500th Fibonacci number is "
      ORDER_PP(8stringize(8to_lit(8fib(8nat(5,0,0)))))
      ".\n");
   return 0;
} 
```

预处理文件我们得到以下结果（经过相当长的等待）：

```
$ cpp -I../inc fibonacci.c 2>/dev/null | tail
  return fib_iter(n, 0, 1);
}
# 63 "fibonacci.c"
int main(void) {
   printf
     ("The 500th Fibonacci number is "
      "139423224561697880139724382870407283950070256587697307264108962948325571622863290691557658876222521294125"
      ".\n");
   return 0;
} 
```

* * *

## 回答 #13

> 赞同：52
> 
> 时间：2009-03-17T07:35:48.003

直接来自Qt：

```
#define slots   /* */
#define signals /* */ 
```

与 boost::signals 等其他库进行交互真的很不错......只是一个例子，Qt 中还有许多其他库可以创建看起来很有趣的代码，例如：

```
class X : public QObject {
   Q_OBJECT
private slots:
   //...
public signals:
   //...
}; 
```

那就是 C++ ......但突然间：

```
boost::signals::trackable 
```

不再是有效的 C++。

* * *

## 回答 #14

> 赞同：50
> 
> 时间：2009-03-17T03:02:45.977

Windows.h 有很多滥用宏的函数。

* * *

MrValdez 对 Windows.h 中的 GetObject 宏感到恼火

GetObject 宏将 GetObject() 函数更改为 GetObjectA() 或 GetObjectW() （取决于构建是否分别以非 unicode 和 unicode 编译）

MrValdez 讨厌在 GetObject 函数行之前做

```
#undef GetObject

Object *GetObject() 
```

另一种方法是将函数名称更改为其他名称，例如 GetGameObject()

* * *

jdkoftinoff 在评论中指出：问题是所有的 windows API 函数都是宏。

Adam Rosenfield 提到，可以通过在包含 windows.h 之前定义 NOGDI、WIN32_LEAN_AND_MEAN、NOMINMAX 等来解决问题以消除问题。

* * *

## 回答 #15

> 赞同：45
> 
> 时间：2009-10-29T13:26:14.583

```
#define return if (std::random(1000) < 2) throw std::exception(); else return 
```

这太邪恶了。它是随机的，这意味着它一直在不同的地方触发，它改变了返回语句，它通常有一些代码可能会自行失败，它改变了你永远不会怀疑的无辜关键字，它使用来自 std 空间的异常，因此您不会尝试搜索您的来源以找到它的来源。简直太棒了。

* * *

## 回答 #16

> 赞同：36
> 
> 时间：2009-06-25T19:18:28.097

我和一位同事在我们的一些对象流代码中发现了这两个宝石。这些宏在每个进行流式传输的***单个***类文件中实例化。这个可怕的代码不仅遍布我们的代码库，当我们就它联系原作者时，他在我们的内部 wiki 上写了一篇 7 页的文章，捍卫这是完成他在这里尝试做的事情的唯一可能方法。

不用说，它已经被重构并且不再在我们的代码库中使用。

**不要被突出显示的关键字所迷惑。这都是一个宏**

```
#define DECLARE_MODIFICATION_REQUEST_PACKET( T )                                                \
namespace NameSpace                                                                     \
{                                                                                       \
                                                                                        \
class T##ElementModificationRequestPacket;                                                          \
}                                                                                       \
                                                                                        \
DECLARE_STREAMING_TEMPLATES( IMPEXP_COMMON_TEMPLATE_DECLARE, NameSpace::ElementModificationRequestPacket<T>, OtherNameSpace::NetPacketBase )    \
DLLIMPEXP_COMMON_TEMPLATE_DECLARE( NameSpace::ElementModificationRequestPacket<T> )     \
DECLARE_AUTOGENERATION_TEMPLATES( DLLIMPEXP_COMMON_TEMPLATE_DECLARE, NameSpace::T##ModificationRequestPacket, NameSpace::ElementModificationRequestPacket<T> )      \
                                                                                        \
namespace NameSpace {                                                                   \
class DLLIMPEXP_COMMON T##ModificationRequestPacket : public ElementModificationRequestPacket<T>\
{                                                                                       \
public:                                                                                 \
    T##ModificationRequestPacket( NetBase * pParent )                                   \
    : ElementModificationRequestPacket<T>( pParent ), m_Gen() {}                            \
                                                                                        \
    T##ModificationRequestPacket( NetBase * pParent,                                    \
                            Action          eAction,                                    \
                            const T &   rT )                                            \
    : ElementModificationRequestPacket<T>( pParent, eAction, rT ), m_Gen() {}               \
                                                                                        \
    T##ModificationRequestPacket( const T##ModificationRequestPacket & rhs )                        \
    : ElementModificationRequestPacket<T>( rhs ), m_Gen() {}                                \
                                                                                        \
    virtual                     ~T##ModificationRequestPacket( void ) {}                        \
                                                                                        \
    virtual Uint32          GetPacketTypeID( void ) const                           \
    {                                                                                   \
        return Net::T##_Modification_REQUEST_PACKET;                                        \
    }                                                                                   \
                                                                                        \
    virtual OtherNameSpace::ClassID GetClassID ( void ) const                           \
    {                                                                                   \
        return OtherNameSpace::NetBase::GenerateHeader( OtherNameSpace::ID__LICENSING,  \
                                                         Net::T##_Modification_REQUEST_PACKET );    \
    }                                                                                   \
                                                                                        \
    virtual T##ModificationRequestPacket * Create( void ) const                             \
    { return new T##ModificationRequestPacket( m_pParent ); }                                   \
                                                                                        \
    T##ModificationRequestPacket() {}                                                           \
                                                                                        \
protected:                                                                              \
    OtherNameSpace::ObjectAutogeneration<T##ModificationRequestPacket> m_Gen;                       \
                                                                                        \
    friend class OtherNameSpace::StreamingBase::StreamingClassInfoT<T##ModificationRequestPacket >;                     \
    OtherNameSpace::StreamingBase::Streaming<T##ModificationRequestPacket, ElementModificationRequestPacket<T> >    m_Stream;   \
                                                                                        \
};                                                                                      \
}                                                                                       \
DLLIMPEXP_COMMON_TEMPLATE_DECLARE( ThirdNameSpace::ListenerBase<const NameSpace::T##ModificationRequestPacket> )            \
DLLIMPEXP_COMMON_TEMPLATE_DECLARE( ThirdNameSpace::BroadcasterT<const NameSpace::T##ModificationRequestPacket> )            \
typedef  ThirdNameSpace::BroadcasterT<const T##ModificationRequestPacket>  T##ModifiedBroadcaster;

#define IMPLEMENT_MODIFICATION_REQUEST_PACKET( T )                                                                  \
DLLIMPEXP_COMMON_TEMPLATE_INSTANTIATE( NameSpace::ElementModificationRequestPacket<T> )                         \
DLLIMPEXP_COMMON_TEMPLATE_INSTANTIATE( ThirdNameSpace::ListenerBase<const NameSpace::T##ModificationRequestPacket> )        \
DLLIMPEXP_COMMON_TEMPLATE_INSTANTIATE( ThirdNameSpace::BroadcasterT<const NameSpace::T##ModificationRequestPacket> )        \
INSTANTIATE_STREAMING_TEMPLATES( DLLIMPEXP_COMMON_TEMPLATE_INSTANTIATE, NameSpace::ElementModificationRequestPacket<T>, OtherNameSpace::NetPacketBase ) \
INSTANTIATE_AUTOGENERATION_TEMPLATES( DLLIMPEXP_COMMON_TEMPLATE_INSTANTIATE, NameSpace::T##ModificationRequestPacket, NameSpace::ElementModificationRequestPacket<T> ) 
```

* * *

更新（2009 年 12 月 17 日）：

关于这个可怕的宏作者的更多好消息。截至 8 月，负责这一怪物的员工已被解雇。

* * *

## 回答 #17

> 赞同：33
> 
> 时间：2009-10-20T13:08:09.853

我自己做了以下事情，我想我从中学到了一些东西。

1992 年左右，我写了一个小型的 Lisp 解释器。它不是用普通的 C 语言实现的，而是用类似 C 的解释语言实现的。不过，这种类 C 语言使用了标准的 C 预处理器。

Lisp 解释器当然包含函数**car**，它在 Lisp 中用于返回列表中的第一个元素，以及**cdr**，它返回列表的其余部分。它们是这样实现的：

```
LISPID car(LISPID id) {
    CHECK_CONS("car", 1, id);
    return cons_cars[id - CONS_OFFSET];
} /* car */

LISPID cdr(LISPID id) {
    CHECK_CONS("cdr", 1, id);
    return cons_cdrs[id - CONS_OFFSET];
} /* cdr */ 
```

（数据存储在数组中，因为没有结构**。CONS_OFFSET**是常数 1000。）

**car**和**cdr**在 Lisp 中经常使用，而且很短，而且由于在实现语言中函数调用不是很快，我通过将这两个 Lisp 函数实现为宏来优化我的代码：

```
#define car(id) (CHECK_CONS("car", 1, (id)), cons_cars[(id) - CONS_OFFSET])
#define cdr(id) (CHECK_CONS("car", 1, (id)), cons_cdrs[(id) - CONS_OFFSET]) 
```

**CHECK_CONS**检查它的参数是否实际上是一个列表，并且由于它在解释器中也经常使用并且很短，所以我也将它写为一个宏：

```
#define CHECK_CONS(fun, pos, arg)   \
    (!IS_CONS(arg) ?        \
        LISP_ERROR("Arg " + pos + " to " + fun +    \
                   " must be a list: " + lispid2string(arg)) : 0) 
```

**IS_CONS**和**LISP_ERROR**也经常使用，所以我也把它们做成了宏：

```
#define IS_CONS(id) \
    (   intp(id) && (id) >= CONS_OFFSET     \
     && ((id) - CONS_OFFSET) < sizeof(cons_cars))

#define LISP_ERROR(str)     (throw((str) + "\n")) 
```

似乎合理？

但是，为什么整个系统会在这一行崩溃：

```
id2 = car(car(car(car((id1)))); 
```

我花了很长时间才找到问题所在，直到最后我检查了预处理器将那条短线扩展为什么。它被扩展为一个 31370 个字符的行，为了清楚起见，我在这里将其分成几行（其中 502 行）：

```
id2 = ((!(intp( (((!(intp( (((!(intp( (((!(intp( (id1)) && (
(id1)) >= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (id1))) + "\n")) : 0), cons_cars[(id1) - 1000])))
&& ( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp( (id1)) && (
(id1)) >= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (id1))) + "\n")) : 0), cons_cars[(id1) - 1000]))) -
1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" +
" must be a list: " + lispid2string( (((!(intp( (id1)) && ( (id1))
>= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg "
+ 1 + " to " + "car" + " must be a list: " + lispid2string(
(id1))) + "\n")) : 0), cons_cars[(id1) - 1000])))) + "\n")) : 0),
cons_cars[(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) -
1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" +
" must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) && ( (((!(intp( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) >= 1000 && (( (((!(intp(
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) - 1000) < sizeof(cons_cars))
? (throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 &&
(( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to
" + "car" + " must be a list: " + lispid2string( (id1))) + "\n"))
: 0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && (
(id1)) >= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (id1))) + "\n")) : 0), cons_cars[(id1) - 1000])))
>= 1000 && (( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) -
1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" +
" must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000])))) + "\n")) : 0),
cons_cars[(((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 && ((
(id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to "
+ "car" + " must be a list: " + lispid2string( (id1))) + "\n")) :
0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1))
>= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg "
+ 1 + " to " + "car" + " must be a list: " + lispid2string(
(id1))) + "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && ((
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000])) - 1000]))) && ( (((!(intp(
(((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) -
1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" +
" must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) && ( (((!(intp( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) >= 1000 && (( (((!(intp(
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) - 1000) < sizeof(cons_cars))
? (throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 &&
(( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to
" + "car" + " must be a list: " + lispid2string( (id1))) + "\n"))
: 0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && (
(id1)) >= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (id1))) + "\n")) : 0), cons_cars[(id1) - 1000])))
>= 1000 && (( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) -
1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" +
" must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000])))) + "\n")) : 0),
cons_cars[(((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 && ((
(id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to "
+ "car" + " must be a list: " + lispid2string( (id1))) + "\n")) :
0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1))
>= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg "
+ 1 + " to " + "car" + " must be a list: " + lispid2string(
(id1))) + "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && ((
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000])) - 1000]))) >= 1000 && ((
(((!(intp( (((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 && ((
(id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to "
+ "car" + " must be a list: " + lispid2string( (id1))) + "\n")) :
0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1))
>= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg "
+ 1 + " to " + "car" + " must be a list: " + lispid2string(
(id1))) + "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && ((
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) && ( (((!(intp( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) >= 1000 && (( (((!(intp(
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) - 1000) < sizeof(cons_cars))
? (throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 &&
(( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to
" + "car" + " must be a list: " + lispid2string( (id1))) + "\n"))
: 0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && (
(id1)) >= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (id1))) + "\n")) : 0), cons_cars[(id1) - 1000])))
>= 1000 && (( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) -
1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" +
" must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000])))) + "\n")) : 0),
cons_cars[(((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 && ((
(id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to "
+ "car" + " must be a list: " + lispid2string( (id1))) + "\n")) :
0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1))
>= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg "
+ 1 + " to " + "car" + " must be a list: " + lispid2string(
(id1))) + "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && ((
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000])) - 1000]))) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (((!(intp( (((!(intp( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) && ( (((!(intp( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) >= 1000 && (( (((!(intp(
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && (( (((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000]))) - 1000) < sizeof(cons_cars))
? (throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 &&
(( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to
" + "car" + " must be a list: " + lispid2string( (id1))) + "\n"))
: 0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && (
(id1)) >= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (id1))) + "\n")) : 0), cons_cars[(id1) - 1000])))
>= 1000 && (( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) -
1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" +
" must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000])))) + "\n")) : 0),
cons_cars[(((!(intp( (((!(intp( (id1)) && ( (id1)) >= 1000 && ((
(id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to "
+ "car" + " must be a list: " + lispid2string( (id1))) + "\n")) :
0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1)) && ( (id1))
>= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg "
+ 1 + " to " + "car" + " must be a list: " + lispid2string(
(id1))) + "\n")) : 0), cons_cars[(id1) - 1000]))) >= 1000 && ((
(((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1))
- 1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car"
+ " must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])))) + "\n")) : 0), cons_cars[(((!(intp(
(id1)) && ( (id1)) >= 1000 && (( (id1)) - 1000) <
sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" + " must
be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000])) - 1000])) - 1000])))) + "\n")) : 0),
cons_cars[(((!(intp( (((!(intp( (((!(intp( (id1)) && ( (id1)) >=
1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ? (throw(("Arg " +
1 + " to " + "car" + " must be a list: " + lispid2string( (id1)))
+ "\n")) : 0), cons_cars[(id1) - 1000]))) && ( (((!(intp( (id1))
&& ( (id1)) >= 1000 && (( (id1)) - 1000) < sizeof(cons_cars)) ?
(throw(("Arg " + 1 + " to " + "car" + " must be a list: " +
lispid2string( (id1))) + "\n")) : 0), cons_cars[(id1) - 1000])))
>= 1000 && (( (((!(intp( (id1)) && ( (id1)) >= 1000 && (( (id1)) -
1000) < sizeof(cons_cars)) ? (throw(("Arg " + 1 + " to " + "car" +
" must be a list: " + lispid2string( (id1))) + "\n")) : 0),
cons_cars[(id1) - 1000]))) - 1000) < sizeof(cons_cars)) 
```

* * *

## 回答 #18

> 赞同：29
> 
> 时间：2009-09-23T14:21:35.973

我曾经不得不将一个 C 应用程序从 unix 移植到 windows，其具体性质将保持未命名以保护有罪。编写它的人是一位不习惯编写生产代码的教授，显然是从其他语言开始接触 C 的。也碰巧英语不是他的第一语言，尽管他来自的国家大多数人都说得很好。

他的应用程序大量使用预处理器将 C 语言转换成他可以更好理解的格式。但他最常使用的宏定义在一个名为“Thing.h”的头文件中（说真的），其中包括以下内容：

```
#define I  Any void_me
#define thou  Any void_thee
#define iam(klas)  klas me = (klas) void_me
#define thouart(klas)  klas thee = (klas) void_thee
#define my  me ->
#define thy  thee ->
#define his  him ->
#define our  my methods ->
#define your  thy methods -> 
```

...然后他用它来写下如下的怪物：

```
void Thing_setName (I, const char *name) {
iam (Thing);
if (name != my name) {
    Melder_free (my name);
    my name = Melder_wcsdup (name);
    }
    our nameChanged (me);
}

void Thing_overrideClass (I, void *klas) {
iam (Thing);
my methods = (Thing_Table)klas;
if (! ((Thing_Table) klas) -> destroy)
    ((Thing_Table) klas) -> _initialize (klas);
} 
```

整个项目（约 60,000 LOC）是用类似的风格编写的——marco hell、怪异的名字、旧英语行话等。幸运的是，我们能够把代码扔掉，因为我找到了一个执行相同算法的 OSS 库几十个快几倍。

（我已经复制并编辑了我最初在这个问题上做出[的](https://stackoverflow.com/questions/143701/what-is-the-worst-class-variable-function-name-you-have-ever-encountered/194124#194124)这个答案）。

* * *

## 回答 #19

> 赞同：27
> 
> 时间：2009-03-17T05:52:00.000

我遇到过的最糟糕的情况是在一个产品中包含一组可执行文件，而指定的技术负责人没有找到库。

相反，他拥有在多个 Visual Source Safe 文件夹中共享的文件集。然后他意识到他们需要对每个应用程序的行为略有不同。

您可以在此处应用许多重构步骤。

相反，他使用#ifdefs

```
 void DisplayLoadError()
   {
   #if defined __TIMETABLE_EDITOR
   MessageBox("Timetable Editor failed to load the correct timetable", MB_ERROR);
   #else if defined __SCHEDULESET_EDITOR
   MessageBox("Schedule Set Editor faied to load the correct Schedule Set", MB_ERROR);
   #else if defined __ROSTER_EDITOR
   MessageBox("Roster Editor failed to load the correct Roster", MB_ERROR);
   #endif
   } 
```

* * *

## 回答 #20

> 赞同：17
> 
> 时间：2009-03-17T02:42:32.560

使用 LINE 预处理器为通过网络传递的消息生成唯一 ID：

```
NetworkMessages.h

#define MSG_LOGIN  __LINE__
#define MSG_LOGOUT __LINE__
#define MSG_CHAT   __LINE__ 
```

这是一个宏确实比非宏解决方案更好的示例：

在非宏解决方案中，必须构建函数和变量来跟踪消息的 ID。开发人员可能会也可能不会使消息 ID 跟踪变得复杂，而这更易于阅读和调试。

此外，只需将消息添加到源中即可更轻松地添加新消息。

这种情况的缺点是该文件必须包含在所有使用消息的代码中。每当编辑消息时，编译时间都会增加。

* * *

## 回答 #21

> 赞同：16
> 
> 时间：2009-03-17T02:20:15.670

一个相当糟糕的例子：

```
#ifdef __cplusplus
#define class _vclass
#endif 
```

这允许包含调用的成员变量的 C 结构`class`由 C++ 编译器处理。其中有两个带有此构造的标题；其中一个在末尾还包含“#undef class”，而另一个则不包含。

* * *

## 回答 #22

> 赞同：14
> 
> 时间：2009-03-19T13:04:27.767

在国际混淆 C 编码竞赛的一年中，有一个条目，整个程序是：

`P`

附带条件是您可以`P`在 makefile 中定义为您想要的任何程序。

我记得，它在其中一个类别中获胜，第二年出现了一条规则，不允许这种进入方式。

（编辑：六个月后或什么......我确信当我写这篇文章时，“没有 IOCCC”的事情不是主要问题......）

* * *

## 回答 #23

> 赞同：12
> 
> 时间：2010-03-11T21:34:59.423

有一天我很无聊，正在玩 Objective-C 中的积木......

```
#define Lambda(var, body) [^ id(id (var)) { return (body);} copy]
#define Call(f, arg) ((id(^)(id))(f))(arg)
#define Int(num) [NSNumber numberWithInteger:(num)]
#define Mult(a, b) Int([(a) integerValue] * [(b) integerValue])
#define Add(a, b) Int([(a) integerValue] + [(b) integerValue])
#define Sub1(n) Int([(n) integerValue] - 1)
#define Add1(n) Int([(n) integerValue] + 1)
#define If(cond, thenblock, elseblock) ([(cond) integerValue] ? (thenblock) : (elseblock))
#define Cons(car, cdr_) [[ConsType alloc] initWithCar:(car) cdr:(cdr_)]
#define Car(list) [(list) car]
#define Cdr(list) [(list) cdr]
#define Define(var, value) id var = (value)
#define Nullq(value) Int(value == nil) 
```

允许“有趣”的事情，例如：

```
Define(Y, Lambda(f, Call(Lambda(x, Call(x, x)),
                         Lambda(x, Call(f, Lambda(y, Call(Call(x, x), y)))))));
Define(AlmostTotal, Lambda(f, Lambda(list, If(Nullq(list), Int(0),
                                              Add(Car(list), Call(f, Cdr(list)))))));
Define(Total, Call(Y, AlmostTotal));
Print(Call(Total, Cons(Int(4), Cons(Int(5), Cons(Int(8), nil))))); 
```

（为简洁起见，未显示一些函数和类定义）

* * *

## 回答 #24

> 赞同：11
> 
> 时间：2009-03-17T02:03:22.593

我看到的最糟糕的是不使用:-)

有人在方法内部编写了一个 strcpy （我认为就是这样......现在已经超过 10 年了）函数（因为他们不想要调用 strcpy 的开销......叹息）。

他们发现它不适用于日文字符，因此他们在开始时添加了一个“if”来处理 ASCII 或 Unicode。那时代码大约有一个屏幕长......可能会破坏缓存的一致性并抹去他应该为代码内联而节省的钱。

除了类型之外，代码是相同的（所以应该使用宏）。

当然，他们编写的 strcpy 比标准库中手动调整的汇编程序慢得多……

当然，如果他们只是将这一切都作为一个宏来完成，它可能会被调用 strcpy 所取代......

当然我退出了公司（不是直接因为那个......）

* * *

## 回答 #25

> 赞同：11
> 
> 时间：2009-03-17T02:38:29.590

强制性的

```
#define FOR  for 
```

和

```
#define ONE  1
#define TWO  2
... 
```

谁知道？

* * *

## 回答 #26

> 赞同：11
> 
> 时间：2009-06-25T19:42:52.277

我维护在宏中有 goto 的代码。所以一个函数最后会有一个标签，但函数代码中没有可见的 goto。更糟糕的是，除非您水平滚动，否则宏通常位于其他语句的末尾，通常不在屏幕上。

```
#define CHECK_ERROR if (!SomeCondition) goto Cleanup

void SomeFunction() 
{ 
    SomeLongFunctionName(ParamOne, ParamTwo, ParamThree, ParamFour); CHECK_ERROR  
    //SomeOtherCode  
    Cleanup:    
   //Cleanup code  
} 
```

* * *

## 回答 #27

> 赞同：11
> 
> 时间：2009-09-18T06:29:13.917

```
#define TRUE 0 // dumbass 
```

几年后，这样做的人解释了自己 - 大多数（如果不是全部）C 库函数返回 0 表示一切顺利。因此，他希望能够编写如下代码：

```
if (memcpy(buffer, packet, BUFFER_SIZE) == TRUE) {
; // rape that packet
} 
```

不用说，我们团队中的任何人（测试人员或开发人员）都不敢再看他的代码。

* * *

## 回答 #28

> 赞同：10
> 
> 时间：2009-03-17T04:08:47.923

```
#include <iostream>
#define public_static_void_main(x) int main()
#define System_out_println(x) std::cout << x << std::endl

public_static_void_main(String[] args) {
  System_out_println("Hello World!");
} 
```

* * *

## 回答 #29

> 赞同：10
> 
> 时间：2010-05-03T11:35:11.307

一位对幻数规则看不懂的同学：
`#define TWO_HUNDRED_AND_EIGHTY_THREE_POINT_ONE 283.1`

* * *

## 回答 #30

> 赞同：9
> 
> 时间：2009-06-25T19:26:36.520

ASA - [http://www.ingber.com/#ASA](http://www.ingber.com/#ASA)

你真的必须下载它才能欣赏它。整个工作流程由宏决定。它完全不可读。举个例子 -

```
 if (asa_open == FALSE) {
asa_open = TRUE;
++number_asa_open;
#if ASA_PRINT
if (number_asa_open == 1) {
  /* open the output file */
#if USER_ASA_OUT
  if (!strcmp (OPTIONS->Asa_Out_File, "STDOUT")) {
#if INCL_STDOUT
    ptr_asa_out = stdout;
#endif /* INCL_STDOUT */
  } else {
#if ASA_SAVE
    ptr_asa_out = fopen (OPTIONS->Asa_Out_File, "a");
#else
    ptr_asa_out = fopen (OPTIONS->Asa_Out_File, "w");
#endif
  }
#else /* USER_ASA_OUT */
  if (!strcmp (ASA_OUT, "STDOUT")) {
#if INCL_STDOUT
    ptr_asa_out = stdout;
#endif /* INCL_STDOUT */
  } else {
#if ASA_SAVE
    ptr_asa_out = fopen (ASA_OUT, "a");
#else
    ptr_asa_out = fopen (ASA_OUT, "w");
#endif
  }
#endif /* USER_ASA_OUT */
} else {
#if USER_ASA_OUT
  if (!strcmp (OPTIONS->Asa_Out_File, "STDOUT")) {
#if INCL_STDOUT
    ptr_asa_out = stdout;
#endif /* INCL_STDOUT */
  } else {
    ptr_asa_out = fopen (OPTIONS->Asa_Out_File, "a");
  }
#else
  if (!strcmp (ASA_OUT, "STDOUT")) {
#if INCL_STDOUT
    ptr_asa_out = stdout;
#endif /* INCL_STDOUT */
  } else {
    ptr_asa_out = fopen (ASA_OUT, "a");
  }
#endif
  fprintf (ptr_asa_out, "\n\n\t\t number_asa_open = %d\n",
           number_asa_open);
}
#endif /* ASA_PRINT */
} else {
++recursive_asa_open;
#if ASA_PRINT
if (recursive_asa_open == 1) {
  /* open the output file */
#if ASA_SAVE
#if USER_ASA_OUT
  if (!strcmp (OPTIONS->Asa_Out_File, "STDOUT")) {
#if INCL_STDOUT
    ptr_asa_out = stdout;
#endif /* INCL_STDOUT */
  } else {
    ptr_asa_out = fopen (OPTIONS->Asa_Out_File, "a");
  }
#else
  if (!strcmp (ASA_OUT, "STDOUT")) {
#if INCL_STDOUT
    ptr_asa_out = stdout;
#endif /* INCL_STDOUT */
  } else {
    ptr_asa_out = fopen (ASA_OUT, "a");
  }
#endif
#else /* ASA_SAVE */
#if USER_ASA_OUT
  if (!strcmp (OPTIONS->Asa_Out_File, "STDOUT")) {
#if INCL_STDOUT
    ptr_asa_out = stdout;
#endif /* INCL_STDOUT */
  } else { 
```

等等等等

这只是设置选项。整个程序就是这样。

* * *

## 回答 #31

> 赞同：9
> 
> 时间：2009-09-18T16:38:05.437

一位曾经是编码员的“技术经理”在我们的 C++ 项目中引入了以下*精彩的*宏，因为他认为`NULL`在 DOM 解析例程中检查值的工作量太大：

```
TRYSEGV
CATCHSEGV 
```

在幕后，这些使用`setjmp`,`longjmp`和*信号处理程序*来`SIGSEGV`模拟“捕获”段错误的能力。

当然，一旦代码退出原始`TRYSEGV`宏调用的范围，代码中的任何内容都不会重置跳转指向，因此代码中的*任何*段错误都会返回到（现在无效的）`jump_env`指针。

代码会立即死在那里，但不会在破坏程序堆栈并使调试或多或少毫无意义之前死掉。

* * *

## 回答 #32

> 赞同：8
> 
> 时间：2009-03-17T03:13:53.313

[AI Game Programming Wisdom](https://rads.stackoverflow.com/amzn/click/com/1584500778)有一章，其中使用宏为有限状态机创建**脚本语言**。

由于这本书和代码是受版权保护的材料，这里有一个[谷歌书链接](http://books.google.com/books?id=4f5Gszjyb8EC&pg=PA326&lpg=PA326&dq=macro+ai+game&source=bl&ots=9ASPntSylj&sig=KNg7dAxVv5cRdI75yDjBaFThi7U&hl=en&ei=NRS_SZtpj4w1w4PAqA0&sa=X&oi=book_result&resnum=6&ct=result)到详细说明宏的页面（生成的脚本语言可以在第 324 页找到。）

* * *

## 回答 #33

> 赞同：7
> 
> 时间：2009-07-01T05:05:46.043

在 Lucent，我曾经看过 Steve Bourne 最初的 Unix shell 的源代码，发现他使用 C 预处理器使 C 看起来像~~Pascal 或~~Algol。处理 if 语句的部分如下所示：

```
#define IF   if (
#define THEN ) {
#define ELSE } else {
#define ELIF } else if (
#define FI   ; } 
```

我的一个朋友告诉我，他在 1990 年代中期对其进行了一些维护，但还是一样。（这里有一个关于代码库固有的保守主义的教训。）

当然，史蒂夫在早期这样做是作为一个实验，如果他以后再写的话，我肯定会重新考虑。

更新：根据 Wikipedia 的[Bourne Shell 文章](http://en.wikipedia.org/wiki/Bourne_shell)，宏赋予它**Algol 68**的味道。而且，[全套宏](http://minnie.tuhs.org/cgi-bin/utree.pl?file=V7/usr/src/cmd/sh/mac.h)在这里！他们显然影响了国际混淆 C 代码竞赛的创始人。

* * *

## 回答 #34

> 赞同：7
> 
> 时间：2011-08-11T14:54:49.833

我喜欢这个例子，它使用宏来近似 PI 的值。圆圈越大，近似值越准确。

```
#define _ -F<00||--F-OO--;
int F=00,OO=00;main(){F_OO();printf("%1.3f\n",4.*-F/OO/OO);}F_OO()
{
            _-_-_-_
       _-_-_-_-_-_-_-_-_
    _-_-_-_-_-_-_-_-_-_-_-_
  _-_-_-_-_-_-_-_-_-_-_-_-_-_
 _-_-_-_-_-_-_-_-_-_-_-_-_-_-_
 _-_-_-_-_-_-_-_-_-_-_-_-_-_-_
_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
 _-_-_-_-_-_-_-_-_-_-_-_-_-_-_
 _-_-_-_-_-_-_-_-_-_-_-_-_-_-_
  _-_-_-_-_-_-_-_-_-_-_-_-_-_
    _-_-_-_-_-_-_-_-_-_-_-_
        _-_-_-_-_-_-_-_
            _-_-_-_
} 
```

* * *

另一个是`c`程序

```
c 
```

要编译，您需要定义`c`为

```
-Dc="#include <stdio.h> int main() { char *t =\"Hello World\n\"; while(*t) putc(*t++, stdout); return 0; }" 
```

* * *

## 回答 #35

> 赞同：6
> 
> 时间：2009-10-23T13:31:57.593

C中的协程（AKA Stackless线程）。:)这是邪恶的诡计。

```
#define crBegin static int state=0; switch(state) { case 0:
#define crReturn(i,x) do { state=i; return x; case i:; } while (0)
#define crFinish }
int function(void) {
    static int i;
    crBegin;
    for (i = 0; i < 10; i++)
        crReturn(1, i);
    crFinish;
}

int decompressor(void) {
    static int c, len;
    crBegin;
    while (1) {
        c = getchar();
        if (c == EOF)
            break;
        if (c == 0xFF) {
            len = getchar();
            c = getchar();
            while (len--)
            crReturn(c);
        } else
        crReturn(c);
    }
    crReturn(EOF);
    crFinish;
}

void parser(int c) {
    crBegin;
    while (1) {
        /* first char already in c */
        if (c == EOF)
            break;
        if (isalpha(c)) {
            do {
                add_to_token(c);
        crReturn( );
            } while (isalpha(c));
            got_token(WORD);
        }
        add_to_token(c);
        got_token(PUNCT);
    crReturn( );
    }
    crFinish;
} 
```

* * *

## 回答 #36

> 赞同：5
> 
> 时间：2009-06-25T18:42:48.230

```
switch (device_id)
{
#ifndef PROD_1
#ifndef PROD_2
#ifdef PROD_3
  case ID_1:
#endif

#ifdef PROD_4

#ifdef PROD_5
  case ID_2:
  case ID_3:
  case ID_4:
#elif defined(PROD_4)
#ifndef PROD_6
  case ID_1:
#endif // PROD_6
  case ID_5:
#endif

  case ID_6:
#endif

#ifdef PROD_7
  #ifndef PROD_8
    case ID_7:
  #endif
#endif 
```

（改名是为了保护不那么无辜的人）

请注意，我们甚至还没有得到任何代码，这只是为了得到第一个实际的代码位。这实际上发生在几个函数中（以几乎但不完全相同的方式），每个函数最终只有 4 种可能的变化（它们也大多是复制/粘贴，略有变化和它们自己的#ifdefs）。

* * *

## 回答 #37

> 赞同：4
> 
> 时间：2009-08-07T13:25:03.930

```
#define interface struct 
```

在一些 Optima++ 头文件中（Optima++ 是/曾经是我必须使用的 Watcom/Powersoft IDE）。

* * *

## 回答 #38

> 赞同：4
> 
> 时间：2009-09-18T13:05:16.113

```
#define FLASE FALSE 
```

程序员是一个糟糕的打字员，这是他最常犯的错误。

* * *

## 回答 #39

> 赞同：4
> 
> 时间：2010-09-18T22:17:40.930

必须从记忆中执行此操作，但大概是这样的：使用 lib 编写 Symbian 应用程序。隐藏在您*需要*包含的头文件中的是这个小宝石：

```
// Here come the register defines:
#define C <something>
#define N <something>
<two more single letter defines> 
```

在我们的代码中，加载具有硬编码文件名的文件失败。当我们将文件位置从 C 盘更改为 D 盘时，它神奇地工作了......

* * *

## 回答 #40

> 赞同：3
> 
> 时间：2009-09-18T06:00:29.380

```
#define unless(cond) if(!cond)
#define until(cond) while(!cond) 
```

用过的：

```
unless( ptr == NULL) 
    ptr->foo(); 
```

* * *

## 回答 #41

> 赞同：3
> 
> 时间：2009-11-24T22:44:17.750

我见过的最糟糕的是在我当前的项目中，其中有很多案例：

```
#if PROGRAMA
     .
     .
    if(...)
    {
     .
     .
     .
#else
    .
     .
    if(...)
    {
     .
     .
     .
#endif
     } 
```

是的，他用一个关闭来关闭 2 个打开。

* * *

## 回答 #42

> 赞同：2
> 
> 时间：2009-03-17T02:35:44.260

当我第一次遇到 C 中的宏时，他们让我难过了好几天。以下是我所面临的。我想这对 C 专家来说非常有意义并且非常高效，但是对我来说尝试弄清楚到底发生了什么意味着将所有不同的宏剪切和粘贴在一起，直到可以查看整个函数。这肯定不是好习惯？！使用普通的旧功能有什么问题？！

```
#define AST_LIST_MOVE_CURRENT(newhead, field) do { \
typeof ((newhead)->first) __list_cur = __new_prev; \
AST_LIST_REMOVE_CURRENT(field); \
AST_LIST_INSERT_TAIL((newhead), __list_cur, field); \
} while (0) 
```

* * *

## 回答 #43

> 赞同：2
> 
> 时间：2009-03-17T04:30:47.933

好的宏：（虽然我个人不喜欢使用这种语法所需的双括号；我更喜欢可变参数宏（仅限 C99）或 PRINTF_0、PRINTF_1 等，具体取决于参数的数量）

```
#ifdef DEBUG
#define PRINTF(x) printf x
#else
#define PRINTF(x)
#endif 
```

减少非调试构建的代码大小/执行时间（第一个比第二个多）；还可以防止泄漏调试文本字符串，这可能会带来很小的安全风险

* * *

## 回答 #44

> 赞同：2
> 
> 时间：2009-03-17T04:34:37.987

与雷蒙德的咆哮相关的是以下可怕的（在我看来，当然）宏：

```
#define CALL_AND_CHECK(func, arg) \
    int result = func(arg);       \
    if(0 != result)               \
    {                             \
        sys.exit(-1);             \
    }                             \ 
```

我对使用宏的做法很陌生，并且使用了这个宏，但我*预计*我传递给它的函数会失败。而且我是在后台线程中执行此操作的，所以这让我困扰了好几天，为什么我的整个应用程序都“崩溃”了。

顺便说一句，如果在编写这个宏时只有 std::tr1::function 存在，我的生活就会恢复一周！

* * *

## 回答 #45

> 赞同：2
> 
> 时间：2009-08-07T12:58:01.587

我曾经把这个可怕的 C++ 代码放在一起，它使用宏来帮助将函数挂钩到 DLL 的导入表中。

```
 #define ARGLIST(...) __VA_ARGS__

#define CPPTYPELESSARG(typelessParams) thisptr, typelessParams
#define CPPTYPEDARG(typedParams) void* thisptr, typedParams
#define CPPTYPELESSNOARG thisptr
#define CPPTYPEDNOARG void* thisptr

#define CPPHOOKBODY(hookName, params) void *thisptr; \
    __asm { mov thisptr, ecx } \
    return On##hookName ( params );

#define CHOOKBODY(hookName, typelessParams) return On##hookName( typelessParams );

#define CPPHOOK(InjectHookRef, importLib, importFunc, hookName, returnType, typedParams, typelessParams) \
    HOOKIMPL(InjectHookRef, importLib, importFunc, hookName, returnType, CPPTYPEDARG(typedParams), typelessParams, \
    typedParams, __thiscall, __stdcall, CPPHOOKBODY(hookName, CPPTYPELESSARG(typelessParams)))

#define CPPHOOKNOARG(InjectHookRef, importLib, importFunc, hookName, returnType, typedParams, typelessParams) \
    HOOKIMPL(InjectHookRef, importLib, importFunc, hookName, returnType, CPPTYPEDNOARG, typelessParams, \
    typedParams, __thiscall, __stdcall, CPPHOOKBODY(hookName, CPPTYPELESSNOARG))

#define CDECLHOOK(InjectHookRef, importLib, importFunc, hookName, returnType, typedParams, typelessParams) \
    HOOKIMPL(InjectHookRef, importLib, importFunc, hookName, returnType, typedParams, typelessParams, \
    typedParams, __cdecl, __cdecl, CHOOKBODY(hookName, typelessParams))

#define CDECLFUNC(name, address, returnType, args) \
    typedef returnType (__cdecl *name##Ptr)(args); \
    name##Ptr name = (name##Ptr) address;

#define CPPFUNC(name, address, returnType, args) \
    typedef returnType (__thiscall *name##Ptr)(void* thisptr, args); \
    name##Ptr name = (name##Ptr) address;

#define STDFUNC(name, address, returnType, args) \
    typedef returnType (__stdcall *name##Ptr)(args); \
    name##Ptr name = (name##Ptr) address;

#define STDHOOK(InjectHookRef, importLib, importFunc, hookName, returnType, typedParams, typelessParams) \
    HOOKIMPL(InjectHookRef, importLib, importFunc, hookName, returnType, typedParams, typelessParams, \
    typedParams, __stdcall, __stdcall, CHOOKBODY(hookName, ARGLIST(typelessParams)))

#define HOOKIMPL(InjectHookRef, importLib, importFunc, hookName, returnType, typedParams, typelessParams, hookParams, fnPtrCall, hookCall, hookBody) \
        typedef returnType (fnPtrCall *##hookName##OrigPtr )( typedParams ); \
        class hookName : public IHook \
        { \
        public: \
            typedef hookName##OrigPtr func_type; \
        private: \
            static void* m_origFunction; \
            static bool m_bModifyImport; \
            static std::string m_lib; \
            static std::string m_importFunc; \
            static std::string m_sHookName; \
            static returnType hookCall hookName##FnHook ( hookParams ) \
            { \
                hookBody \
            } \
            static bool ImplIsModifyImport() { return hookName::m_bModifyImport; } \
            static void ImplSetModifyImport(bool bModify) { hookName::m_bModifyImport = bModify; } \
            static const std::string& ImplGetLibName() { return hookName::m_lib; } \
            static const std::string& ImplGetImportFunctionName() { return hookName::m_importFunc; } \
            static void ImplSetOriginalAddress(void* fn) { hookName::m_origFunction = fn; } \
            static void* ImplGetOriginalAddress() { return hookName::m_origFunction; } \
            static returnType On##hookName ( typedParams ); \
            static void* ImplGetNewAddress() { return hookName::##hookName##FnHook; } \
            static const std::string& ImplGetHookName() { return hookName::m_sHookName; } \
        public: \
            hookName() \
            { \
                InjectHookRef.AddHook((IHook*)this); \
                hookName::m_lib = importLib; \
                hookName::m_importFunc = importFunc; \
                hookName::m_sHookName = #hookName; \
                hookName::m_origFunction = NULL; \
                hookName::m_bModifyImport = true; \
            } \
            virtual bool IsModifyImport() const { return hookName::ImplIsModifyImport(); } \
            virtual void SetModifyImport(bool bModify) { hookName::ImplSetModifyImport(bModify); } \
            virtual const std::string& GetHookName() const { return hookName::ImplGetHookName(); } \
            virtual const std::string& GetLibName() const { return hookName::ImplGetLibName(); } \
            virtual const std::string& GetImportFunctionName() const { return hookName::ImplGetImportFunctionName(); } \
            virtual void* GetOriginalAddress() const { return hookName::ImplGetOriginalAddress(); } \
            virtual void* GetNewAddress() const { return hookName::ImplGetNewAddress(); } \
            virtual void SetOriginalAddress(void* fn) { hookName::m_origFunction = fn; } \
            static func_type GetTypedOriginalAddress() { return reinterpret_cast(hookName::m_origFunction); } \
        }; \
        void* hookName::m_origFunction = NULL; \
        bool hookName::m_bModifyImport = false; \
        std::string hookName::m_lib; \
        std::string hookName::m_importFunc; \
        std::string hookName::m_sHookName; \
        static hookName g##hookName##Inst; 
```

这反过来又允许我这样做：

```
`CPPHOOK(gIH, "SimEngine.dll", "?AddEntity@Player@@UAEXPAVEntity@@@Z", PlayerAddEntity, void, void* ent, ent);

/* Called when the engine calls Player::AddEntity(entity) */
void PlayerAddEntity::OnPlayerAddEntity(void *thisptr, void *ent)
{
    unsigned int id = getPlayerID(thisptr);

```
gIH.GetLog()->Info("Player %d adding entity %s.", 
    getPlayerID(thisptr), getEntityName(ent));

gPlayers[id] = thisptr;

/*if( id == 2 && gPlayers[1] && gPlayers[2] )
    EntitySetOwner::GetTypedOriginalAddress() (ent, gPlayers[1]);*/
//gEnts[ent] = Entity(ent, Vector3f());

PlayerAddEntity::GetTypedOriginalAddress() (thisptr, ent); 
```

}` 
```

* * *

 `## 回答 #46

> 赞同：2
> 
> 时间：2009-08-09T01:47:59.763

任何使用 sendmail 及其神奇的配置语法的东西

* * *

## 回答 #47

> 赞同：2
> 
> 时间：2009-08-20T17:11:14.953

我正在添加另一个随着时间的推移已经开始惹恼我的人：

```
#define ARRAYSIZE(x) (sizeof(x)/sizeof((x)[0])) 
```

那就是如果他们做对了；我见过所有可能的括号排列是否存在的版本。我已经看到它在同一个头文件中定义了两次。

我的论点主要适用于 Windows（尽管我假设其他 OS SDK 也有类似的东西），几乎每个人似乎都觉得有必要在他们的项目标题中定义这个宏，我不明白为什么。

WinNT.h（包含在 Windows.h 中）定义了一个非常好的版本，如果您传递指针类型而不是数组 ，它会执行一些模板巫术来导致*编译时错误。*

当然，如果你正在构建一个 C 程序，它会完全回到我上面写的内容，但我仍然不会无缘无故地重新定义 SDK 默认具有的东西。

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2009-10-23T13:43:54.717

```
#define "CR_LF" '\r' 
```

这让我困惑了一段时间！

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2010-04-01T10:21:42.320

一位过去的雇主发现现代 Unix 系统上没有[BASIC-PLUS](http://en.wikipedia.org/wiki/BASIC-PLUS)的实现，因此他们尝试使用 C 预处理器宏重新实现它：

```
#define IF if(
#define THEN ) {
#define ENDIF }
#define GOTO goto L 
```

...ETC。

太可怕了。

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2010-04-06T21:23:39.223

这取自一个流行的开源程序。事实上，它通过隐藏丑陋的遗产使代码的某些部分更具可读性。

```
#define EP_STATUS    CASTLING][(BOARD_FILES-2)
#define HOLDINGS_SET CASTLING][(BOARD_FILES-1) 
```

我想这里没有什么不好的，我只是觉得很有趣。

[http://git.savannah.gnu.org/cgit/xboard.git/tree/common.h](http://git.savannah.gnu.org/cgit/xboard.git/tree/common.h)

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2010-04-06T21:38:12.307

请参阅[此答案](https://stackoverflow.com/questions/2163402/tips-for-a-programmer-with-dyslexia/2163489#2163489)，了解阅读障碍的同事如何通过一个包含`#define fasle false`.

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2011-03-28T10:14:06.650

```
#define PROCESS_AND_RETURN(X) \
X.process(); \
// Important: Return only after invoking virtual method process() \
return X 
```

由于“重要”注释，宏永远不会返回对象和崩溃！

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2009-03-17T03:22:06.117

预处理器的另一个“创造性”使用，尽管它更多地是在使用的术语中而不是在机制中（这是非常平凡的）：

```
/***********************************************************************
 * OS2 and PCDOS share a lot of common codes.  However, sometimes
 * OS2 needs codes similar to those of UNIX.  NOTPCDOS is used in these
 * situations
 */

#ifdef OS2
#define PCDOS
#define NOTPCDOS
#else /* OS2 */
#ifndef PCDOS
#define NOTPCDOS
#endif /* PCDOS */
#endif /* OS2 */ 
```

正版代码 - 我以为我已经删除了它，但显然没有。我一定是在某个临时分支中这样做了，并且没有获得将其检回主代码的权限。“待办事项”列表的另一项。

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2009-03-17T04:53:27.627

在声明中发现，非常混乱：

```
NON_ZERO_BYTE         Fixed(8)  Constant('79'X), 
```

后来发现：

```
IF WORK_AREA(INDEX) = ZERO_BYTE THEN  /* found zero byte */ 
   WORK_AREA(INDEX) = NON_ZERO_BYTE ; /* reset to nonzero*/ 
```

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2009-03-17T05:33:40.777

最严重的滥用（我偶尔会这样做）是使用预处理器作为某种数据文件替换，即：

```
#define FOO_RELATION \  
BAR_TUPLE( A, B, C) \  
BAR_TUPLE( X, Y, Z) \ 
```

然后在其他地方：

```
#define BAR_TUPLE( p1, p2, p3) if( p1 ) p2 = p3;
FOO_RELATION
#undef BAR_TUPLE 
```

这将导致：

```
if( A ) B = C;
if( X ) Y = Z; 
```

这种模式可以用来做各种（可怕的）事情......生成 switch 语句或巨大的 if else 块，或与“真实”代码接口。您甚至可以使用它来 ::cough:: 在非 oo 上下文菜单系统 ::cough:: 中生成上下文菜单。并不是说我会做任何如此蹩脚的事情。

编辑：固定不匹配的括号和扩展示例

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2009-03-17T06:03:10.037

尝试调试真正喜欢宏的大项目，并且有很多宏调用其他宏调用其他宏等。（5-10级宏并不少见）

然后用很多 #ifdef 这个宏 #else 那个宏来填充它，所以如果你按照代码，它就像一棵不同路径的树，它可以去。

唯一的解决方案是大多数情况下是预编译并阅读它......

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2009-08-07T00:56:26.283

我同意在大多数情况下，宏使用起来很糟糕，但我发现了一些它们有用的例子。

恕我直言，这实际上非常出色，因为您只能使用 sprintf 获得类似的东西，然后需要资源分配等等，此外，所有工作都完全由预处理器完成

```
// Macro: Stringize
//
//      Converts the parameter into a string
//
#define Stringize( L )          #L

// Macro: MakeString
//
//      Converts the contents of a macro into a string
//
#define MakeString( L )     Stringize(L)

// Macro: $LINE
//
//      Gets the line number as a string
//
#define $LINE                   MakeString( __LINE__ )

// Macro: $FILE_POS
//
//      Gets the current file name and current line number in a format the Visual Studio
//      can interpret and output goto
//
// NOTE: For VS to properly interpret this, it must be at the start of the line (can only have whitespace before)
//
#define $FILE_POS               __FILE__ "(" $LINE ") : " 
```

我讨厌使用的另一个，但发现它非常有用的是做这样的事情，它基本上允许我快速生成具有可变数量模板参数的模板

```
#define TEMPLATE_DEFS    typename ReturnType
#define TEMPLATE_DECL   ReturnType
#define FUNCTION_PARAMS void
#define FUNCTION_PASS   
#define GENERIC_CALLBACK_DECL_NAME      CallbackSafePointer0
#include "Callback.inl"

#define TEMPLATE_DEFS   typename ReturnType, typename P1
#define TEMPLATE_DECL   ReturnType, P1
#define FUNCTION_PARAMS P1 param1
#define FUNCTION_PASS   param1
#define GENERIC_CALLBACK_DECL_NAME      CallbackSafePointer1
#include "Callback.inl"

#define TEMPLATE_DEFS   typename ReturnType, typename P1, typename P2
#define TEMPLATE_DECL   ReturnType, P1, P2
#define FUNCTION_PARAMS P1 param1, P2 param2
#define FUNCTION_PASS   param1, param2
#define GENERIC_CALLBACK_DECL_NAME      CallbackSafePointer2
#include "Callback.inl"

#define TEMPLATE_DEFS   typename ReturnType, typename P1, typename P2, typename P3
#define TEMPLATE_DECL   ReturnType, P1, P2, P3
#define FUNCTION_PARAMS P1 param1, P2 param2, P3 param3
#define FUNCTION_PASS   param1, param2, param3
#define GENERIC_CALLBACK_DECL_NAME      CallbackSafePointer3
#include "Callback.inl"

// and so on... 
```

虽然这使得阅读“Callback.inl”有点可怕，但它确实完全消除了用不同数量的参数重写相同的代码。我还应该提到“Callback.inl”#undefs 文件末尾的所有宏，因此，宏本身不会干扰任何其他代码，它只会使“Callback.inl”更难编写（虽然阅读和调试并不难）

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2009-09-18T03:36:17.220

当时，将宏作为参数“传递”到另一个宏中似乎是个好主意。（我只是无法忍受在多个地方定义一个值列表的想法。）这里的代码是人为的（并且不是很激励），但给了你这个想法：

```
#define ENUM_COLORS(CallbackMacro) \
    CallbackMacro(RED)   \
    CallbackMacro(GREEN) \
    CallbackMacro(BLUE)  \
    // ...

#define DEFINE_COLOR_TYPE_CALLBACK(Color) \
    Color,

enum MyColorType {
    ENUM_COLORS(DEFINE_COLOR_TYPE_CALLBACK)
};

void RegisterAllKnownColors(void)
{
#define REGISTER_COLOR_CALLBACK(Color) \
    RegisterColor(Color, #Color);

    ENUM_COLORS(REGISTER_COLOR_CALLBACK)
}

void RegisterColor(MyColorType Color, char *ColorName)
{
    // ...
} 
```

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2009-09-23T14:36:50.090

它不是 C 宏，但...

许多年前，我有一项有趣的任务，就是将原始的 Transport Tycoon 从 PC 移植到 Mac。PC 版本完全用汇编程序编写，因此我们必须先检查整个源代码并将其移植到“PC”C 代码，然后再将其移植到 Mac。大多数代码都可以，甚至在某些地方是面向对象的。但是，世界渲染系统令人难以置信。对于没有玩过游戏的任何人，都可以在三个缩放级别之一中查看世界。代码大致如下：

```
macro DrawMacro <list of arguments>
   a couple of thousand lines of assembler with loads of conditionals
   based on the macro arguments

DrawZoomLevel1:
   DrawMacro <list of magic numbers>

DrawZoomLevel2:
   DrawMacro <list of more magic numbers>

DrawZoomLevel3:
   DrawMacro <list of even more magic numbers> 
```

我们一定是在使用稍旧的 MASM 版本，因为当我们尝试汇编宏时，它会使汇编器崩溃。

斯基兹

* * *

## 回答 #60

> 赞同：1
> 
> 时间：2010-02-02T14:50:30.117

BSD 内核中的 NFS 代码在宏之间使用 goto。它仍在使用中，并且代码确实有效。我知道有几个人试图清理它，但一段时间后他们都放弃了——太乱了。

你可以在这里看到它： [http ://www.openbsd.org/cgi-bin/cvsweb/src/sys/nfs/nfsm_subs.h?rev=1.43](http://www.openbsd.org/cgi-bin/cvsweb/src/sys/nfs/nfsm_subs.h?rev=1.43)

* * *

## 回答 #61

> 赞同：1
> 
> 时间：2010-03-11T22:08:59.947

我曾经看到一个宏包，它可以为每个 C 关键字加上别名，让您可以有效地用克林贡语进行编程。没错，*克林贡语*。（联合国）幸运的是，该项目几年前被放弃并拆除。

* * *

## 回答 #62

> 赞同：1
> 
> 时间：2011-04-14T13:43:17.273

我大约 10 年前使用的 ASIC 的驱动程序代码有很多部分，如下所示：

```
int foo(state_t *state) {
    int a, b, rval;

    $
    if (state->thing == whatever) {
        $
        do_whatever(state);
    }
    // more code

    $
    return rval;
} 
```

经过一番摸索，我们终于找到了定义：

```
#if DEBUG
#define $ dolog("%s %d", __FILE__, __LINE__);
#else
#define $
#endif 
```

这很难找到，因为使用它的源文件都*没有*包含文件。有一个名为`top.c`源文件的文件，如下所示：

```
#include <namechanged.h>
#include <foo.c>
#include <bar.c>
#include <baz.c> 
```

果然，这是 Makefile 中唯一引用的文件。每当您更改任何内容时，都必须重新编译*所有内容*。这是“使代码更快”。

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2009-03-19T15:22:26.257

```
#define protected private 
```

有时似乎是个好主意，但如果你需要，你可能应该只是字符串替换。受保护是相当邪恶的，允许内部访问后代并不比仅仅公开项目好多少......

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2009-06-25T19:48:11.190

任何使用标记连接运算符的宏`##`。

我看到一个我的一位同事有幸与之合作。他们尝试自定义实现字符串实习，因此他们使用大量（当然）无法正常工作的宏重新实现字符串。试图弄清楚它做了什么让我的眼睛因为所有`##`的散落而爆炸。

* * *

## 回答 #65

> 赞同：0
> 
> 时间：2009-07-01T14:19:49.430

我使用头文件作为大宏：

```
// compile-time-caller.h
#define param1 ...
#define param2 ...
#include "killer-header.h"

// killer-header.h
// uses param1 and param2 
```

我还创建了*递归*头文件。

```
// compile-time-caller.h
#define param1 ...
#define param2 ...
#include "killer-header.h"

// killer-header.h"
#if ... // conditional taking param1 and param2 as parameters
#define temp1 param1
#define temp2 param2
#define param1 ... // expression taking temp1 and temp2 as parameters
#define param2 ... // expression taking temp1 and temp2 as parameters
#include "killer-header.h"
// some actual code
#else
// more actual code
#endif 
```

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2009-09-18T03:05:30.923

我不喜欢 Boost Preprocessor 的东西。我曾经试图弄清楚如何使用它（无论如何我们在项目中都有 Boost ......），但据我所知，使用它会使我的错误消息变得如此难以阅读，以至于不值得。

我喜欢相当于循环宏的想法，但它太过分了。

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2009-09-18T16:45:45.657

```
#undef near
#undef far 
```

当我刚接触游戏编程时，我正在为相机类编写一个平截头体，这是我编写的一个游戏，我的代码中有非常奇怪的错误。

事实证明，微软在 windows.h 中有一些用于近处和远处的#defines，这导致我的 _near 和 _far 变量在包含它们的行上出错。很难找到问题，因为（当时我还是个新手）而且它们只存在于整个项目的四行中，所以我没有马上意识到。

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2009-10-20T11:54:25.913

我在 libtidy 中找到了它：

```
 /* Internal symbols are prefixed to avoid clashes with other libraries */
 #define TYDYAPPEND(str1,str2) str1##str2
 #define TY_(str) TYDYAPPEND(prvTidy,str)

 TY_(DocParseStream)(bar,foo); 
```

问题是 Visual Studio 2005 和其他 IDE`go to definition`和`go to declaration`功能只能找到`#define TY_(...)`而不是所需的`DocParseStream`声明。

也许这样更安全。

我认为他们应该为每个函数加上一个前缀，而不是调用一个宏来完成这项工作..它使代码混乱..但也许我错了。你觉得怎么样..？

ps：貌似内部函数const和其他的几乎都是用this..前缀的。。刚才同事跟我说是常用的..wtf？也许我错过了什么。

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2011-05-18T18:59:02.043

温柔点，我写这篇文章是我能想到的一般捕获异常的唯一方法。

我用它来捕获和阻止异常从我的公共接口函数中传播出来......

```
/// Catch all generic exceptions and log appropriately.
/// Logger is insulated from throwing, so this is a NO THROW operation.
#define CatchAll( msg ) \
    catch( const Poco::Exception &e )   \
    {   \
        try{ LogCritical( Logs.System(), std::string( e.displayText() ).append( msg ) );}catch(...){assert(0);} \
    }   \
    catch( const std::exception &e )    \
    {   \
        try{LogCritical( Logs.System(), std::string( e.what() ).append( msg ) );}catch(...){assert(0);} \
    }   \
    catch(...)  \
    {   \
        try{ LogCritical( Logs.System(), std::string( "Exception caught in " __FUNCTION__ ". " ).append( msg ) );}catch(...){assert(0);}    \
    } 
```

我不喜欢复杂性，我讨厌宏，但是你会如何“做”一个通用的 catch 处理程序？这并不是最终目的，这只是我的通用 catch 处理程序，用于隔离遗留的公共函数，并在我知道函数被跨边界调用时快速添加*至少某种程度*的保护，如果一个边界可能会抛出将抛出 C++ 异常（欢迎您，JNI）。

那么它会让你逃跑和躲藏，还是这样做的唯一方法？

基本上...

```
try{
// some block of code capable of throwing
}
CatchAll() 
```

* * *

## 回答 #70

> 赞同：-1
> 
> 时间：2009-03-17T04:29:56.500

任何使用 Token 连接运算符 ## 的东西。我已经看到这用于将 C++ 中的伪模板系统和其他可怕的东西一起破解。使用它最糟糕的事情是你的错误消息变得多么神秘。

然而，我已经看到了它的一个很好的用途。有一个宏#MONITOR_COMPONENT(classname) 在编译时生成类，这些类将从预定义的监视器类和类名继承，并且会自动注册到用于监视每个组件的单例类。

它奏效了吗？是的，这是最好的方法吗..可能不是。

# air - 在 AIR 中，如何创建一个不可调整大小的窗口应用程序？

> ID：652791
> 
> 赞同：2
> 
> 时间：2009-03-17T02:00:21.117
> 
> 标签：air

如何使我的 AIR 应用程序窗口无法调整大小？请注意，我不是在谈论任何新创建的窗口，而是实际的 AIR 应用程序的窗口 (WindowedApplication)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T05:20:31.200

在您的 application.xml 文件中，在 initialWindow 下将 resizable 设置为 false：

```
<application....>
    <!-- Normal app stuff like id, name, etc -->
    <initialWindow>
        <!-- Normal initialWindow stuff like content, title, systemChrome -->
        <minimizable>true</minimizable>
        <maximizable>false</maximizable>
        <resizable>false</resizable>
        <width>800</width>
        <height>600</height>
    </initialWindow>
</application> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T02:05:50.293

尝试：

```
var windowOptions:NativeWindowInitOptions = new NativeWindowInitOptions();
NativeWindowInitOptions.resizable = false; 
```

有关可以使用窗口选项做什么的更多信息，请参见[此处。](http://www.webreference.com/programming/adobe_air/working_with_windows/2.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-10T14:18:32.250

将应用程序的最小宽度设置为与 maxwidth 相同，将 minheight 设置为与 maxheight 相同

# c# - nHibernate SetFirstResult & SetMaxResults 问题

> ID：652793
> 
> 赞同：3
> 
> 时间：2009-03-17T02:00:46.483
> 
> 标签：c#, sql-server, nhibernate

我正在使用 nHibernate 并尝试实现一些分页。如果我运行此代码

```
IList list = session.CreateQuery("FROM Author").List(); 
```

它返回 8 条记录。如果我运行这段代码

```
IList list = session.CreateQuery("FROM Author")
    .SetFirstResult(1).SetMaxResults(5).List(); 
```

它返回 0 条记录。当我查看生成的 SQL 时，我看不到有任何分页逻辑。

最可能的错误是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-03T23:02:23.230

我不确定 NHibernate，但在 Java 中，结果索引是基于 0 的。尝试调用 .SetFirstResult(0) 而不是 .SetFirstResult(1)，否则如果只有一行，它将返回 0 个结果。不过，听起来你有 8 行，所以我不知道为什么无论如何你都不会得到一些结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T03:04:43.863

您的语法正确，因此只要该表中有数据，我不确定它为什么会返回 0 结果。

就生成的 SQL 而言，MSSQL Server 不支持 LIMIT 和 OFFSET 命令，因此无法在服务器上以这种方式实现分页。（nb 我的理解是 SQL Server 2005 改进了分页方法，但仍然不支持 LIMIT 或 OFFSET）因此，对于 SQL 2000，必须检索所有行，然后从该结果集中选择子集。

我可以建议的唯一另一件事是检查您的查询是否在单独的事务中。我已经看到建议这可能会有所帮助的帖子。可能有一些问题，因为我使用 SetFirstResult/SetMaxResults 进行的单元测试是成功的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-12T20:07:39.727

也许在 web.config 或 app.config 中检查您的方言和连接提供程序

```
 <property name="dialect">NHibernate.Dialect.MsSql2008Dialect</property>
  <property name="connection.provider">NHibernate.Connection.DriverConnectionProvider</property>
  <property name="connection.driver_class">NHibernate.Driver.SqlClientDriver</property> 
```

# windows - Win32 当前目录、锁定和 shell 集成

> ID：652811
> 
> 赞同：0
> 
> 时间：2009-03-17T02:11:03.243
> 
> 标签：windows, winapi, directory

在 Win32 中，主线程的当前工作目录设置为启动可执行文件的位置。我的问题是，即使在对其他地方调用**SetCurrentDirectory()**之后，该进程显然仍然有一个引用此初始启动目录的文件系统对象（可使用 Process Explorer 之类的工具进行验证） - 这意味着该目录无法被进程删除。

这里有人知道一个不太老套的解决方案吗？我特别遇到了与资源管理器集成的程序的问题（向 HKCR\Directory\shell 注册表项添加动词），我需要处理右键单击目录中的文件并删除源目录，这是不可能的因为初始工作目录设置为，您猜对了，右键单击的目录。

**编辑**：我将采用“使用帮助程序从 sane-directory 启动”的方法。它可能不是超级优雅，但它可以工作并且不需要任何讨厌的黑客攻击。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T02:22:31.687

您最简单的解决方案可能是只生成一个在您指定的任何目录（c:\，例如）中运行的小助手进程，然后退出并让它做它的事情。它可能需要与互斥锁同步，或者可能只是在计时器上重试两到三次......

我有另一个想法：您可以将 CreateFile() 与 FILE_FLAG_DELETE_ON_CLOSE 一起使用。然后当每个人都放开它时它应该会消失，但前提是它是用 FILE_SHARE_DELETE 打开的。

# c++ - 宏和 Visual C++

> ID：652813
> 
> 赞同：0
> 
> 时间：2009-03-17T02:13:54.937
> 
> 标签：c++, visual-c++, macros, c-preprocessor

我试图更好地了解宏在*现代*C++ 和 Visual C++ 中的位置（如果有的话），还参考了 Windows 编程库：宏在这些情况下解决了什么问题（如果有）没有就无法解决使用它们？

[我记得从这篇博客文章](http://www.hanselman.com/blog/TheWeeklySourceCode33MicrosoftOpenSourceInsideGoogleChrome.aspx)中读到了谷歌浏览器对宏的 WTL 使用（除其他外），它们也在 MFC 中使用 - 这是该博客文章中的一个宏示例，我想用大量的解释如果可能，请详细说明：

```
// CWindowImpl
BEGIN_MSG_MAP(Edit)
  MSG_WM_CHAR(OnChar)
  MSG_WM_CONTEXTMENU(OnContextMenu)
  MSG_WM_COPY(OnCopy)
  MSG_WM_CUT(OnCut)
  MESSAGE_HANDLER_EX(WM_IME_COMPOSITION, OnImeComposition)
  MSG_WM_KEYDOWN(OnKeyDown)
  MSG_WM_LBUTTONDBLCLK(OnLButtonDblClk)
  MSG_WM_LBUTTONDOWN(OnLButtonDown)
  MSG_WM_LBUTTONUP(OnLButtonUp)
  MSG_WM_MBUTTONDOWN(OnNonLButtonDown)
  MSG_WM_MOUSEMOVE(OnMouseMove)
  MSG_WM_MOUSELEAVE(OnMouseLeave)
  MSG_WM_NCCALCSIZE(OnNCCalcSize)
  MSG_WM_NCPAINT(OnNCPaint)
  MSG_WM_RBUTTONDOWN(OnNonLButtonDown)
  MSG_WM_PASTE(OnPaste)
  MSG_WM_SYSCHAR(OnSysChar)  // WM_SYSxxx == WM_xxx with ALT down
  MSG_WM_SYSKEYDOWN(OnKeyDown)
END_MSG_MAP() 
```

我已经在 MSDN 上阅读了[这些与宏有关的](http://msdn.microsoft.com/en-us/library/ttsbh614(VS.80).aspx) [文章](http://msdn.microsoft.com/en-us/library/503x3e3s(VS.80).aspx)，但我也在尝试学习编写或避免宏以及在何处/何时使用它们的最佳实践。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T02:26:59.710

所有这些宏都在公共 sdk 头文件中定义，因此您可以根据需要自行阅读它们的作用。基本上这里发生的是你正在使用宏生成一个 WndProc 函数。每个 MSG_WM_* 条目都是一个 case 语句，通过将其参数从 wParam 和 lParam 转换为其原始类型并调用将这些类型作为参数的辅助函数（然后您可以实现）来处理给定的窗口消息（如果合适的话——一些窗口消息有 0 或 1 个参数）。

在我看来，这一切都是废话。你不得不预先编写一堆样板，但作为交换，你使以后的调试变得更加困难。宏在我的现代编程世界中没有太多的位置，除了检查它们是否被定义。做流量控制的宏，或者假设特定的局部变量总是被定义的，等等，让我很不高兴。特别是当我必须调试它们时。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T02:33:09.243

彼得，你不妨问问 vi 还是 EMACS 是更好的编辑器。（顺便说一下，EMACS。）很多人认为 C 预处理器是一个可怕的想法。其中包括 Stroustrup 和 Jim Gosling。这就是为什么 Java 没有预处理器，并且 Stroustrup 在 C++ 中放入了无数的东西，从`const`模板到模板，以避免使用预处理器。

还有其他人发现添加新语言很方便，就像在该代码中一样。

如果你阅读原始的 Bourne shell 代码，你会发现它看起来像

```
IF a == b THEN
   do_something();
   do_more();
ELSE
   do_less();
FI 
```

Steve Bourne 基本上使用宏来赋予它类似 Algol68 的外观（那是当时非常酷的语言。）除了 Steve Bourne 之外的任何人都很难使用它。

然后看看 Obfuscated C 竞赛，其中一些最令人惊叹的混淆利用了`#define`.

就个人而言，我不太介意，虽然那个例子有点令人生畏（你如何调试它？）但是做那种事情是没有网络的。那里没有多少瓦伦达人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T02:32:05.893

（这个问题有点支离破碎，但忽略了 Windows 部分）：

[X-Macros](http://www.ddj.com/cpp/184401387)使用预处理器来避免代码重复。

# cocoa - 使用可可调用 C 函数

> ID：652814
> 
> 赞同：1
> 
> 时间：2009-03-17T02:14:04.127
> 
> 标签：cocoa, cocoa-touch

我有一个具有以下方法签名的 C 函数。

```
NSString* md5( NSString *str ) 
```

如何调用这个函数，传入一个字符串，并保存返回的字符串？

我尝试了以下方法，但没有奏效：

```
NSString *temp= [[NSString alloc]initWithString:md5(password)]; 
```

感谢您的帮助

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T02:22:45.040

你太难了 's 中的内容`[]`实际上是 smalltalk。你想要的只是调用 C 中的函数：

```
NSString * temp = md5(password); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T03:08:25.133

什么是密码？密码是常见的“char *”指针吗？您输入的**md5**签名是否正确？

如果是这种情况，您可以：

```
NSString *temp = [[NSString alloc] initWithCString:password  encoding:NSASCIIStringEncoding]; 
```

如果您的 md5 签名是：char *md5(char *password)，并且您将密码存储在 NSString 中，您可以：

```
NSString password = @"mypass";
char buff[128];
NSString *temp = [[NSString alloc] initWithString:password];
[temp getCString:buff maxLength:128 encoding:NSASCIIStringEncoding];
char *md5 = md5(buff);
// then you could do whatever you want with md5 var 
```

# c++ - 有没有人使用过 __COUNTER__ 预处理器宏？

> ID：652815
> 
> 赞同：59
> 
> 时间：2009-03-17T02:14:51.177
> 
> 标签：c++, c

该`__COUNTER__`符号由[VC++](http://msdn.microsoft.com/en-us/library/b0084kay(VS.80).aspx)和 GCC 提供，每次使用时都会给出一个递增的非负整数值。

我有兴趣了解是否有人使用过它，以及它是否值得标准化？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-08-18T17:25:18.503

`__COUNTER__`在需要唯一名称的任何地方都很有用。我已将它广泛用于 RAII 风格的锁和堆栈。考虑：

```
struct TLock
{
  void Lock();
  void Unlock();
}
g_Lock1, g_Lock2;

struct TLockUse
{
  TLockUse( TLock &lock ):m_Lock(lock){ m_Lock.Lock(); }
  ~TLockUse(){ m_Lock.Unlock(); }

  TLock &m_Lock;
};

void DoSomething()
{
  TLockUse lock_use1( g_Lock1 );
  TLockUse lock_use2( g_Lock2 );
  // ...
} 
```

命名锁的用途很乏味，如果它们没有全部声明在块的顶部，甚至可能成为错误的来源。你怎么知道你是在`lock_use4`还是`lock_use11`？这也是对命名空间的不必要污染——我永远不需要按名称引用锁使用对象。所以我使用`__COUNTER__`：

```
#define CONCAT_IMPL( x, y ) x##y
#define MACRO_CONCAT( x, y ) CONCAT_IMPL( x, y )
#define USE_LOCK( lock ) TLockUse MACRO_CONCAT( LockUse, __COUNTER__ )( lock )

void DoSomething2()
{
  USE_LOCK( g_Lock1 );
  USE_LOCK( g_Lock2 );
  // ...
} 
```

但是不要纠结于我将对象称为锁这一事实——任何需要成对调用的函数都适合这种模式。您甚至可能对给定块中的同一个“锁”有多种用途。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-17T02:19:42.710

除了 DEBUG 宏之外，我从未将它用于任何其他用途。可以说很方便

```
#define WAYPOINT \
    do { if(dbg) printf("At marker: %d\n", __COUNTER__); } while(0); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-17T04:52:29.613

我在编译时断言宏中使用它来让宏为 typedef 创建一个唯一的名称。看

*   [在 C 中构建时断言表达式的方法](https://stackoverflow.com/questions/174356/ways-to-assert-expressions-at-build-time-in-c/175216#175216)

如果你想要血淋淋的细节。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-05-09T23:09:12.970

它用于[xCover](http://www.sourceforge.net/projects/xcover)代码覆盖库中，用于标记执行通过的行，以查找未覆盖的行。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2015-01-25T13:16:49.193

> 很想知道有没有人用过

是的，但正如您从本问答中的许多示例中看​​到的那样，`__LINE__`标准化的 ，在大多数情况下也足够了。

`__COUNTER__`仅在计数必须每次增加 1 或必须在多个`#include`文件上具有连续性的情况下才真正需要。

> 是否值得标准化？

`__COUNTER__`, 不像`__LINE__`, 是非常危险的，因为它取决于包含哪些头文件以及什么顺序。如果两个`.cpp`文件（翻译单元）包含一个使用 的头文件`__COUNTER__`，但头文件在不同的实例中得到不同的计数序列，则可能对同一事物使用不同的定义，违反了单定义规则。

单一定义的违反规则很难被捕获，并且可能会产生错误和安全风险。的少数用例`__COUNTER__`并没有真正超过缺点和缺乏可扩展性。

即使您从未发布过使用 的代码`__COUNTER__`，它在对枚举序列进行原型设计时也很有用，从而省去了在具体成员资格之前指定名称的麻烦。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-17T05:16:21.707

如果我正确理解了该功能，我希望我在使用 Perl 时拥有该功能，将事件日志功能添加到现有的 GUI 中。我想确保所需的手动测试（叹气）为我们提供了完整的覆盖范围，因此我将每个测试点记录到一个文件中，并记录一个`__counter__`值可以很容易地查看覆盖范围中缺少的内容。事实上，我手动编写了等效的代码。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-07-15T23:07:23.697

Boost.Asio 使用它来实现无堆栈协程。

请参阅此[头文件](http://www.boost.org/doc/libs/1_61_0/boost/asio/coroutine.hpp)和[示例](http://www.boost.org/doc/libs/1_61_0/doc/html/boost_asio/example/cpp03/http/server4/request_parser.cpp)。

生成的协程如下所示：

```
struct task : coroutine
{
  ...
  void operator()()
  {
    reenter (this)
    {
      while (... not finished ...)
      {
         ... do something ...
         yield;
         ... do some more ...
         yield;
       }
     }
   }
   ...
}; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-06-11T04:23:20.660

[TensorFlow 的`REGISTER_KERNEL_BUILDER`宏](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/op_kernel.h#L1213)中有一个用法。每个 TensorFlow Op 可以有一个或多个内核作为其实现。这些内核在注册商处注册。内核的注册是通过定义一个全局变量来完成的——变量的构造函数可以进行注册。在这里，作者使用`__COUNTER__`给每个全局变量一个唯一的名称。

```
#define REGISTER_KERNEL_BUILDER(kernel_builder, ...) \
  REGISTER_KERNEL_BUILDER_UNIQ_HELPER(__COUNTER__, kernel_builder, __VA_ARGS__)

#define REGISTER_KERNEL_BUILDER_UNIQ_HELPER(ctr, kernel_builder, ...) \
  REGISTER_KERNEL_BUILDER_UNIQ(ctr, kernel_builder, __VA_ARGS__)

#define REGISTER_KERNEL_BUILDER_UNIQ(ctr, kernel_builder, ...)          \
  static ::tensorflow::kernel_factory::OpKernelRegistrar                \
  registrar__body__##ctr##__object(                                 \
      SHOULD_REGISTER_OP_KERNEL(#__VA_ARGS__)                       \
      ? ::tensorflow::register_kernel::kernel_builder.Build()   \
      : nullptr,                                                \
      #__VA_ARGS__, [](::tensorflow::OpKernelConstruction* context) \
            -> ::tensorflow::OpKernel* {                \
              return new __VA_ARGS__(context);          \
            }); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2021-04-12T03:18:41.677

# 生成类类型 ID (C++)

*我曾经`__COUNTER__`在面向对象的游戏中为实体和碰撞器自动生成类型 ID。*

该游戏使用多态性来实现其功能。要序列化子对象，我必须想出一种方法来存储实体子类型并序列化/反序列化它们以进行场景保存和加载。从保存文件中读取实体（反序列化）时，我需要知道要读取哪些属性；使用`__COUNTER__`，我为每个实体类都有一个唯一且恒定的 ID，并且可以使用此 ID 将它们作为正确的实体类型加载。

这种方法意味着要使新的 Entity 类型可序列化，我所要做的就是`typeID = __COUNTER__;`在构造函数中覆盖默认 ID。在雪碧的情况下：

```
Sprite(/* TODO: Sprite Arguments */) : Entity(/* TODO: Entity Arguments */) {
    typeID = __COUNTER__;
} 
```

...并继续概述其 iostream 重载：

```
friend std::ostream& operator<<(std::ostream& os, const Sprite& rhs) {
    return os << /* TODO: Outline Output */;
}
friend std::istream& operator>>(std::istream& is, Sprite& rhs) {
    return is >> /* TODO: Outline Input */;
} 
```

这是为您的类生成类型 ID 的一种非常轻量级的方法，并且避免了一堆复杂的逻辑。作为预处理器命令，它非常基本，但它为一些关键设备提供了有用的工具。

**注意：**如果您想在调用计数器时将 ID 值重新设置为 0，请将其值存储在第一个 ID 的生成中，然后将所有后续 ID 减去该值。

谢谢阅读！-YZM

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-02-26T21:17:56.447

我在这篇文章中用它来生成独特的类型：http: [//www.codeproject.com/Articles/42021/Sealing-Classes-in-C](http://www.codeproject.com/Articles/42021/Sealing-Classes-in-C)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-12-13T06:40:52.040

它用于 ClickHouse 的指标系统。

```
namespace CurrentMetrics
{
    #define M(NAME) extern const Metric NAME = __COUNTER__;
        APPLY_FOR_METRICS(M)
    #undef M
    constexpr Metric END = __COUNTER__;

    std::atomic<Value> values[END] {};    /// Global variable, initialized by zeros.

    const char * getDescription(Metric event)
    {
        static const char * descriptions[] =
        {
        #define M(NAME) #NAME,
            APPLY_FOR_METRICS(M)
        #undef M
        };

        return descriptions[event];
    }

    Metric end() { return END; }
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-03-19T01:30:47.830

我已将它用于驱动程序 shim 层，我需要确保至少启用了一个物理驱动程序。

例如：

```
#if defined( USE_DRIVER1 )
#include "driver1.h"
int xxx1 = __COUNTER__;
#endif
#if defined( USE_DRIVER2 )
#include "driver2.h"
int xxx2 = __COUNTER__;
#endif
#if __COUNTER__ < 1
#error Must enable at least one driver.
#endif 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-10-13T12:49:49.457

`__COUNTER__`保证是唯一的，不像`__LINE__`. 一些编译器允许`__LINE__`重置。#include 文件也将重置`__LINE__`。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-10-10T15:36:14.933

在我们的代码中，我们忘记为我们的一些产品添加测试用例。我现在实现了一些宏，这样我们就可以在编译时断言我们对每个要添加或删除的产品都有测试用例。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-04-25T08:59:51.463

在这篇[博](https://www.gingerbill.org/article/2015/08/19/defer-in-cpp/)文中，它用于模拟`defer`C++11 中的 golang 语句。

```
template <typename F>
struct privDefer {
    F f;
    privDefer(F f) : f(f) {}
    ~privDefer() { f(); }
};

template <typename F>
privDefer<F> defer_func(F f) {
    return privDefer<F>(f);
}

#define DEFER_1(x, y) x##y
#define DEFER_2(x, y) DEFER_1(x, y)
#define DEFER_3(x)    DEFER_2(x, __COUNTER__)
#define defer(code)   auto DEFER_3(_defer_) = defer_func([&](){code;}) 
```

然后你可以这样做：

```
int main()
{
    FILE* file = open("file.txt");
    defer(fclose(file));

    // use the file here
    // ....
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-06-11T00:51:08.687

`__COUNTER__`当您在运行时加密字符串并且您希望每个字符串都有一个唯一的密钥时非常有用，而不是在某处为您的加密密钥存储一个计数器，您可以使用 Counter 来确保每个字符串都有它自己的唯一密钥！

我在我的`XorString`1 头库中使用它在运行时解密字符串，所以如果任何黑客/破解者试图查看我的二进制文件，他们不会在那里找到字符串，但是当程序运行时，每个字符串都会被解密并显示为普通的。

```
#pragma once
#include <string>
#include <array>
#include <cstdarg>

#define BEGIN_NAMESPACE( x ) namespace x {
#define END_NAMESPACE }

BEGIN_NAMESPACE(XorCompileTime)

constexpr auto time = __TIME__;
constexpr auto seed = static_cast< int >(time[7]) + static_cast< int >(time[6]) * 10 + static_cast< int >(time[4]) * 60 + static_cast< int >(time[3]) * 600 + static_cast< int >(time[1]) * 3600 + static_cast< int >(time[0]) * 36000;

// 1988, Stephen Park and Keith Miller
// "Random Number Generators: Good Ones Are Hard To Find", considered as "minimal standard"
// Park-Miller 31 bit pseudo-random number generator, implemented with G. Carta's optimisation:
// with 32-bit math and without division

template < int N >
struct RandomGenerator
{
private:
    static constexpr unsigned a = 16807; // 7^5
    static constexpr unsigned m = 2147483647; // 2^31 - 1

    static constexpr unsigned s = RandomGenerator< N - 1 >::value;
    static constexpr unsigned lo = a * (s & 0xFFFF); // Multiply lower 16 bits by 16807
    static constexpr unsigned hi = a * (s >> 16); // Multiply higher 16 bits by 16807
    static constexpr unsigned lo2 = lo + ((hi & 0x7FFF) << 16); // Combine lower 15 bits of hi with lo's upper bits
    static constexpr unsigned hi2 = hi >> 15; // Discard lower 15 bits of hi
    static constexpr unsigned lo3 = lo2 + hi;

public:
    static constexpr unsigned max = m;
    static constexpr unsigned value = lo3 > m ? lo3 - m : lo3;
};

template <>
struct RandomGenerator< 0 >
{
    static constexpr unsigned value = seed;
};

template < int N, int M >
struct RandomInt
{
    static constexpr auto value = RandomGenerator< N + 1 >::value % M;
};

template < int N >
struct RandomChar
{
    static const char value = static_cast< char >(1 + RandomInt< N, 0x7F - 1 >::value);
};

template < size_t N, int K, typename Char >
struct XorString
{
private:
    const char _key;
    std::array< Char, N + 1 > _encrypted;

    constexpr Char enc(Char c) const
    {
        return c ^ _key;
    }

    Char dec(Char c) const
    {
        return c ^ _key;
    }

public:
    template < size_t... Is >
    constexpr __forceinline XorString(const Char* str, std::index_sequence< Is... >) : _key(RandomChar< K >::value), _encrypted{ enc(str[Is])... }
    {
    }

    __forceinline decltype(auto) decrypt(void)
    {
        for (size_t i = 0; i < N; ++i) {
            _encrypted[i] = dec(_encrypted[i]);
        }
        _encrypted[N] = '\0';
        return _encrypted.data();
    }
};

//--------------------------------------------------------------------------------
//-- Note: XorStr will __NOT__ work directly with functions like printf.
//         To work with them you need a wrapper function that takes a const char*
//         as parameter and passes it to printf and alike.
//
//         The Microsoft Compiler/Linker is not working correctly with variadic 
//         templates!
//  
//         Use the functions below or use std::cout (and similar)!
//--------------------------------------------------------------------------------

static auto w_printf = [](const char* fmt, ...) {
    va_list args;
    va_start(args, fmt);
    vprintf_s(fmt, args);
    va_end(args);
};

static auto w_printf_s = [](const char* fmt, ...) {
    va_list args;
    va_start(args, fmt);
    vprintf_s(fmt, args);
    va_end(args);
};

static auto w_sprintf = [](char* buf, const char* fmt, ...) {
    va_list args;
    va_start(args, fmt);
    vsprintf(buf, fmt, args);
    va_end(args);
};

static auto w_sprintf_ret = [](char* buf, const char* fmt, ...) {
    int ret;
    va_list args;
    va_start(args, fmt);
    ret = vsprintf(buf, fmt, args);
    va_end(args);
    return ret;
};

static auto w_sprintf_s = [](char* buf, size_t buf_size, const char* fmt, ...) {
    va_list args;
    va_start(args, fmt);
    vsprintf_s(buf, buf_size, fmt, args);
    va_end(args);
};

static auto w_sprintf_s_ret = [](char* buf, size_t buf_size, const char* fmt, ...) {
    int ret;
    va_list args;
    va_start(args, fmt);
    ret = vsprintf_s(buf, buf_size, fmt, args);
    va_end(args);
    return ret;
};

//Old functions before I found out about wrapper functions.
//#define XorStr( s ) ( XorCompileTime::XorString< sizeof(s)/sizeof(char) - 1, __COUNTER__, char >( s, std::make_index_sequence< sizeof(s)/sizeof(char) - 1>() ).decrypt() )
//#define XorStrW( s ) ( XorCompileTime::XorString< sizeof(s)/sizeof(wchar_t) - 1, __COUNTER__, wchar_t >( s, std::make_index_sequence< sizeof(s)/sizeof(wchar_t) - 1>() ).decrypt() )

//Wrapper functions to work in all functions below
#define XorStr( s ) []{ constexpr XorCompileTime::XorString< sizeof(s)/sizeof(char) - 1, __COUNTER__, char > expr( s, std::make_index_sequence< sizeof(s)/sizeof(char) - 1>() ); return expr; }().decrypt()
#define XorStrW( s ) []{ constexpr XorCompileTime::XorString< sizeof(s)/sizeof(wchar_t) - 1, __COUNTER__, wchar_t > expr( s, std::make_index_sequence< sizeof(s)/sizeof(wchar_t) - 1>() ); return expr; }().decrypt()

END_NAMESPACE 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-07-14T16:56:15.960

我发现它对于在 UI 中显示步骤很有用。这使得添加、删除或重新排序步骤变得非常容易，而不必担心步骤被贴错标签。

```
#include <iostream>

#define STR_IMPL(s)  #s
#define STR(s)  STR_IMPL(s)
#define STEP  STR(__COUNTER__) ": "

int main()
{
    std::cout 
        << STEP "foo\n"
        << STEP "bar\n"
        << STEP "qux\n"
        ;
} 
```

输出：

```
0: foo
1: bar
2: qux 
```

让它从 1 开始而不是 0 留作练习。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2013-01-20T19:16:44.943

我打算`__COUNTER__`给我们代码库中的每个文件一个唯一标识符，以便该唯一代码可以用于在嵌入式系统中记录 ASSERT。

这种方法比使用字符串存储文件名（使用 ）要高效得多`__FILE__`，尤其是在具有微型 ROM 的嵌入式系统上。我在阅读这篇文章时想到了这个想法 -在 Embedded.com 上[断言自己。](http://www.embedded.com/electronics-blogs/other/4023329/Assert-Yourself)可惜它只适用于基于 GCC 的编译器。

# networking - SCTP 是否适合点对点应用程序？

> ID：652817
> 
> 赞同：2
> 
> 时间：2009-03-17T02:17:24.803
> 
> 标签：networking, network-programming, network-protocols, p2p, sctp

我正在考虑对用 C 编写的 p2p 应用程序使用[SCTP而不是 TCP。我应该这样做吗？](http://en.wikipedia.org/wiki/SCTP)另外，SCTP 的速度与 TCP 的速度相比如何？

编辑：我发现[SCTP 可以通过 UDP 建立隧道](http://tools.ietf.org/id/draft-ietf-sigtran-sctptunnel-00.txt)，唯一的问题是隧道 SCTP 不能与非隧道 SCTP 互操作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T09:05:13.340

您是否考虑过您的目标系统是否都预装了 SCTP，或者您的应用程序是否需要包含 SCTP 本身？根据我的经验，我不希望所有系统都安装 SCTP，如果是 Windows，我希望它们不会。

如果您在应用程序本身中包含 SCTP，那么与使用预安装的 TCP 相比，传递到内核外的消息数量将增加一倍以上，这将影响性能。

您是否考虑过您希望从 SCTP 获得哪些好处？您提到了容错，但要使其与 SCTP 一起使用，它需要应用程序具有多个以太网端口和 IP 地址。这可能在您的应用程序上吗？

尽管我很喜欢 SCTP（！），但我会认真考虑坚持使用 TCP，除非您确定需要 SCTP，或者除非您控制部署应用程序的主机。

问候

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:18:24.947

如果是局域网，那当然可以。

但是请注意，如果您打算在开放的互联网上使用它，许多消费级防火墙不够灵活，无法允许无法识别的 IP 协议通过它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T19:15:50.097

它对你有什么帮助？

您是 P2P，因此每个对等点必须至少有一个对其他对等点开放的套接字。

如果你打开了一个套接字，那么你可以做你需要做的一切。如果您采用了每个文件一个套接字的方法，并且在两个给定的对等点之间同时传输了多个文件，那么 SCTP 将为每个文件节省一个套接字。但是，在任何规模的普通 P2P 网络上，您几乎*永远不会*在两个对等方之间同时传输多个文件。

只需一个套接字，并拥有自己的小协议；发送带有标头的数据包，标头指示内容类型，例如命令或文件的一部分-如果是，则说明哪个文件以及哪个字节范围。

当然，您会为此付出一些开销，而如果您有一个用于命令的套接字和一个用于每个文件的套接字，那么您的效率会更高。每个对等方保存一个套接字（假设一次下载一个）值得使用 SCTP 的时间/麻烦/复杂性吗？

# asp.net-mvc - 保护 ASP.Net MVC 站点

> ID：652818
> 
> 赞同：7
> 
> 时间：2009-03-17T02:17:49.407
> 
> 标签：asp.net-mvc, security

作为 web 和 MVC 的相对新手，我正在寻找我应该实施的安全最佳实践的一个很好的总结。

该网站将公开面对“中度敏感数据”（这意味着我们不会被起诉，但如果数据泄露，可能不会交到很多朋友！）并将采取以下安全措施：a：表格/会员资格身份验证和授权 b：参数化查询以防止 sql 注入。c：自动超时，x 分钟不活动 c：客户端到服务器加密的 SSL

你还有什么推荐的？

*保护 IIS 和网络不属于我的领域，所以我对我需要对软件做的事情更感兴趣。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T02:20:43.860

*   如果您使用 cookie 来识别用户，请务必使用任意令牌（例如[GUID](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)）存储在客户端上以进行识别。我见过太多的网站将我的电子邮件地址或用户名存储在我的 cookie 中......只需将其更改为另一个！

*   编写您的软件，使其可以在[中等信任](http://msdn.microsoft.com/en-us/library/ms998341.aspx)下运行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T02:36:23.417

如果您是 Web 开发新手，您应该了解[跨站脚本 (XSS)](http://en.wikipedia.org/wiki/Cross-site_scripting)。您可以在 ASP.NET MVC 中使用 Http.Encode 辅助方法来防止这种情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T03:56:05.287

确保防止乱序请求。在允许查看敏感数据之前确保客户端已通过身份验证，或者在某些情况下，在允许数据操作之前确保客户端已通过正确的通道。例如，仅当请求来自产品详细信息页面时，才允许将商品添加到您的购物车。如果你不检查，任何人都可以搞砸这个动作。URL 类似于[http://server/cart/add/XYZ123](http://server/cart/add/XYZ123)，任何人都可以调整“id”参数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T03:18:04.237

这是另一个需要注意的大问题：CSRF

[http://blog.codeville.net/2008/09/01/prevent-cross-site-request-forgery-csrf-using-aspnet-mvcs-antiforgerytoken-helper/](http://blog.codeville.net/2008/09/01/prevent-cross-site-request-forgery-csrf-using-aspnet-mvcs-antiforgerytoken-helper/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T03:38:35.560

看看 Phil Haack 的这篇[文章](http://haacked.com/archive/0001/01/01/take-charge-of-your-security.aspx)- 参与开发的 MS 开发人员之一。

另外看看 [Microsoft Anti-Cross Site Scripting Library](http://blogs.msdn.com/yaleeyangmsblog/archive/2007/02/06/microsoft-anti-cross-site-scripting-library-v1-5.aspx)以过滤掉所有传入的参数

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T03:41:12.637

1.  也许您应该选择可以从外部调用的方法。例如，要小心创建一个方法，例如删除[http://yourhost.com/edit/deletealltable](http://yourhost.com/edit/deletealltable)之类的任何表。确保你设计好你的类和方法。并提供属性 [NonAction] 以防止调用公共方法。

2.  确保以最少的精美设计根据需要显示数据（尤其是敏感数据），并根据需要使用客户端脚本。

3.  删除任何未使用的垃圾文件，例如解决方案文件夹中未使用的文件。

4.  检查并仔细检查并验证任何输入控件，例如文本框。我可以在文本框中给出一些东西来破解你的系统。
5.  如果您在 MVC 和常规 ASP.NET 之间使用混合，请删除它们之间的任何依赖关系。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T03:45:29.977

确保您完全涵盖了基础知识，独立于 ASP.NET。确保您的 DBMS 有一个单独的用户，该用户具有最低要求的权限（例如，CRUD 和从指定数据库执行存储过程）设置为从 Web 应用程序访问数据库。参数化查询是一个绝妙的主意，但无论如何都要清理您的输入：这并不是对 sql 注入的完全防御。

保持您的设计简洁易懂。清楚地记录您所做的一切，尤其是在数据库方面。*如果你所有的好*工作在几个月或几年后被两个程序员毁掉，那就太糟糕了——比如说，一个没有意识到 Web 应用程序的数据库用户（现在访问不同服务器上的数据库）不应该的人。t 具有 root 权限，并且另一个添加了未正确清理输入的控件。对于这类事情，能做的只有这么多，但设计傻瓜可能会维护你的代码并不是为了让程序员认为你很可爱——而是为了让傻瓜不会把你赶出去的业务。

# c# - .NET 会从“命名匿名”类型中受益吗？

> ID：652819
> 
> 赞同：17
> 
> 时间：2009-03-17T02:19:12.100
> 
> 标签：c#, .net, linq, c#-4.0, anonymous-types

考虑一下：

```
var me = new { FirstName = "John", LastName = "Smith" }; 
```

这很好，因为我们可以这样做：

```
Console.WriteLine("{0} {1}", me.FirstName, me.LastName); 
```

但是我们不能这样做：

```
public T GetMe()
{
    return new { FirstName = "John", LastName = "Smith" };
} 
```

因为我们不知道 T 的类型。

我们可以这样做：

```
public object GetMe()
{
    return new { FirstName = "John", LastName = "Smith" };
} 
```

但是我们必须使用反射检查对象的属性才能访问它们：

```
var p = new Prog();
object o = p.GetMe();
Type t = o.GetType();
foreach (var prop in t.GetProperties())
{
    Console.WriteLine(prop.Name + ": " + prop.GetValue(o, null));
} 
```

但是，如果我们可以在定义时命名一个匿名类型呢？当然它不再是匿名的，但是它会比普通的类定义更简洁和可维护。

考虑一下：

```
public Person GetMe()
{
    return new public class Person { FirstName = "John", LastName = "Smith" };
} 
```

好处是可以从方法返回复杂的 Linq 查询的结果，而无需显式定义类。

考虑这个相对复杂的 Linq 查询：

```
List<int> list = new List<int>();
var query = from number in list
            select
                new
                    {
                        Number = number,
                        Square = number*number,
                        Absolute = Math.Abs(number),
                        Range = Enumerable.Range(0, number)
                    }; 
```

而不是像这样定义一个类：

```
public class MyNumbers
{
    public int Number { get; set; }
    public int Square { get; set; }
    public int Absolute { get; set; }
    public IEnumerable<int> Range { get; set; }
} 
```

为了从方法中返回查询变量，我们可以这样做：

```
List<int> list = new List<int>();
return from number in list
            select new public class MyNumbers
                    {
                        Number = number,
                        Square = number*number,
                        Absolute = Math.Abs(number),
                        Range = Enumerable.Range(0, number)
                    }; 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T02:32:47.670

实际上，您可以通过“hack”从方法中获取匿名类型。考虑一下：

```
public object MyMethod()
    {
        var myNewObject = new
        {
            stringProperty = "Hello, World!",
            intProperty = 1337,
            boolProperty = false
        };

        return myNewObject;
    }

    public T Cast<T>(object obj, T type)
    {
        return (T)obj;
    } 
```

您现在可以这样做：

```
var obj = MyMethod();
var myNewObj = Cast(obj, new { stringProperty = "", intProperty = 0, boolProperty = false }); 
```

myNewObj 现在将成为与匿名类型相同类型的对象。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-09T21:26:00.067

您需要的语言功能是：

```
public var GetMe()
{
    return new { FirstName = "John", LastName = "Smith" };
} 
```

也就是说，`var`作为方法返回类型是有效的，编译器将从返回的任何内容中推断出实际类型。然后，您必须在呼叫站点执行此操作：

```
var me = GetMe(); 
```

任何两个具有相同类型成员的匿名类型都是相同的类型，因此如果您编写其他返回相同模式的函数，它们将具有相同的类型。对于任何类型 A 和 B，其中 B 具有 A 成员的子集，则 A 与 B 赋值兼容（B 就像 A 的基类）。如果你写：

```
public var GetMeFrom(var names)
{
    return new { FirstName = names["First"], LastName = names["Last"] };
} 
```

编译器将有效地将其定义为具有两个类型参数的泛型方法，`T1`即名称的类型和接受字符串`T2`的索引器返回的类型。将受到约束，因此它必须有一个接受字符串的索引器。在调用站点，您只需传递具有接受字符串并返回*您喜欢的任何类型*的索引器的任何内容，这将确定返回的类型和类型。`T1``T1`*`FirstName``LastName``GetMeFrom`*

 *因此，类型推断将为您解决所有这些问题，自动捕获从代码中可发现的任何类型约束。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-17T03:43:01.260

恕我直言，根本问题与匿名类型无关，但声明一个类太冗长了。

**选项1：**

如果你可以这样声明一个类：

```
public class MyClass
{ properties={ int Number, int Square, int Absolute, IEnumerable<int> Range } } 
```

或其他类似的快速方法（例如元组示例），那么您就不会觉得需要使用匿名类型来做一些骇人听闻的事情来保存一些代码。

当“编译器即服务”出现在 C#5 中时，希望他们能很好地集成它，我们将能够使用元编程干净利落地解决这类问题。派对就像 1958 年一样！

**选项 2：**

或者，在 C#4 中，您可以只传递一个匿名类型 as`dynamic`并避免所有强制转换。当然，如果您重命名变量等，这会使您面临运行时错误。

**选项 3：**

如果 C# 以与 C++ 相同的方式实现泛型，那么您可以将匿名类型传递给方法，只要它具有正确的成员，它就可以编译。您将获得静态类型安全的所有好处，而没有任何缺点。每次我必须输入`where T : ISomething`C# 时，我都会因为他们没有这样做而感到恼火！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-17T02:54:18.337

您所描述的（称为匿名类型）基本上是“元组类型”。

我认为它们将是 C# 的一个很好的补充。

如果我正在为 C# 设计这样的功能，我会使用如下语法公开它：

```
tuple<int x, int y> 
```

这样你就可以做到：

```
public tuple<int x, int y> GetStuff()
{
} 
```

然后我会更改匿名类型的定义，以便：

```
new { x = 2, y = 2} 
```

有`tuple<int x, int y>`它的类型，而不是匿名类型。

让它与当前的 CLR 一起工作有点棘手，因为一旦您可以在公共签名中命名一个匿名类型，您就需要能够在单独编译的程序集中统一它们。它可以通过在任何使用元组类型的程序集中嵌入“模块构造函数”来完成。有关示例，请参见[这篇文章。](https://stackoverflow.com/questions/185836/equivalent-of-class-loaders-in-net)

这种方法的唯一缺点是它不尊重 CLR 用于类型生成的“惰性”模型。这意味着使用许多不同元组类型的程序集可能会遇到稍慢的加载类型。更好的方法是直接向 CLR 添加对元组类型的支持。

但是，除了更改 CLR 之外，我认为模块构造函数方法是执行此类操作的最佳方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-20T02:20:07.897

我会喜欢这个功能，有很多次我想要这个。

一个很好的例子是处理 XML。您解析它们取回一个对象，但随后您需要制作该对象的具体版本以发送回调用者。很多时候，您得到的 XML 发生了相当大的变化，并且需要您创建许多类来处理它。如果您可以使用 LinqToXml 作为 var 构建对象，然后返回它，那不是很好吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-20T02:03:19.657

我认为这对于元组来说是一个很好的编译器魔法：

创建一个元组：

```
(int, string, Person) tuple = (8, "hello", new Person()); 
```

相当于：

```
Tuple<int,string,Person> tuple = new Tuple<int,string,Person>(8 ,"hello", new Person()); 
```

在一个函数中：

```
public (int, string, Person) GetTuple(){
    return ...
} 
```

获取值：

```
int number = tuple[1];
string text = tuple[2];
Person person = tuple[3]; 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-17T03:00:32.237

您可以创建一个具有 FirstName 和 LastName 属性的接口并使用它吗？

# windows - 葡萄酒的反义词是什么？

> ID：652826
> 
> 赞同：15
> 
> 时间：2009-03-17T02:21:26.637
> 
> 标签：windows, linux, emulation

如果我想在 Windows 上运行原生的类 Unix 应用程序怎么办？那里最好的应用程序是什么？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-17T02:24:06.677

[Cygwin](http://cygwin.org/)最接近您正在寻找的内容，但与 Wine不**完全一样。**

 *> *Cygwin 是一个类似 Linux 的 Windows 环境。它由两部分组成：* 
> 
> **   一个 DLL (cygwin1.dll)，充当 Linux API 仿真层，提供大量 Linux API 功能。*
> 2.  *一组提供 Linux 外观的工具。*

它与 Linux 应用程序不是二进制兼容的，您仍然需要从源代码重新构建它们才能在 Cygwin 下运行。然而，一旦重建，它们应该像在 Linux 上一样工作。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-17T02:28:31.050

不太一样，但您也可以在虚拟机（例如 Virtualbox）中运行完整的 linux 安装：http: [//virtualbox.org/](http://virtualbox.org/)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-17T02:59:28.010

看看[andLinux](http://www.andlinux.org/)（基于[coLinux](http://www.colinux.org/)）。

从网站：

> andLinux 是一个完整的 Ubuntu Linux 系统，可在基于 Windows 2000 的系统（2000、XP、2003、Vista；仅限 32 位版本）中无缝运行。
> 
> ...
> 
> 虽然这项技术有点像在虚拟机中运行 Linux，但 coLinux 的不同之处在于它更多地是 Windows 和 Linux 内核的合并，而不是模拟 PC，因此效率更高。Xming 用作 X 服务器，PulseAudio 用作声音服务器。
> 
> andLinux 不仅用于开发，而且无需修改即可运行几乎所有 Linux 应用程序。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-17T02:33:05.843

**不是** [赛格温。](http://cygwin.org/)

> 什么不是 Cygwin？
> 
> *   Cygwin**不是**在 Windows 上运行本机 linux 应用程序的方法。*如果您希望它在 Windows 上运行，您必须从源代码重新构建您的应用程序。*
>     
>     
> *   Cygwin**不是**一种神奇地使本机 Windows 应用程序了解 UNIX® 功能（如信号、ptys 等）的方法。同样，如果您想利用 Cygwin 功能，您需要从源代码构建您的应用程序。

Cygwin 将提供一个类似 Linux 的 shell，但不能直接在 Windows 中运行 linux 应用程序。Cygwin **“充当提供大量 Linux API 功能的 Linux API 仿真层”。**

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-17T20:02:41.617

在遥远的过去，有[一个 LINE Is Not an Emulator](http://sourceforge.net/projects/line/)，它的目标是与 Wine 完全相反：为在 Windows 下运行的 Linux 可执行文件提供二进制兼容性。

它有点工作，至少作为概念证明，但没有太大的需要。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-17T02:43:10.093

如果您有兴趣将这些 *nix 应用程序移植到 Win32 环境，您可以查看[MinGW](http://www.mingw.org/)项目。我主要将它用于 Windows 上的 GCC，但它们也提供了一个有趣的环境，称为 MSYS：

> 一个提供 POSIX 兼容的 Bourne shell 环境的最小系统，带有一小部分 UNIX 命令行工具。主要开发用于执行用于构建开源软件的配置脚本和 Makefile，但也可用作通用命令行界面来替代 Windows cmd.exe。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-17T02:30:17.207

有一段时间，微软提供了[SFU](http://technet.microsoft.com/en-us/interopmigration/bb380242.aspx)，它适用于某些事情。Cygwin 工作得更好。

如果您希望 ABI 兼容性，因为 wine 为 windows 二进制文件提供了 unix 系统，那么事情就相当惨淡了。 [CoLinux](http://www.colinux.org/)也可以工作，但通常对任何类型的图形应用程序都没有帮助，除非您也配置了 Windows X11 服务器。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-17T03:01:04.513

我使用过基于[coLinux](http://www.colinux.org/)构建的[andLinux](http://andlinux.org)。该组织已经编译了一个 Ubuntu 安装（我认为是 Gutsy，但我很容易升级到 Intrepid）。

一个警告：andLinux 上的开发非常缓慢——最后一个测试版已经发布了将近一年。

# algorithm - 这将被称为什么类型的游戏逻辑？

> ID：652833
> 
> 赞同：4
> 
> 时间：2009-03-17T02:25:35.097
> 
> 标签：algorithm

所以假设有一个游戏有一个由理论水平组成的“生命条”。随着用户执行特定动作，根据他们动作的准确性，生命条以相应的速度增长。随着它增长并进入下一个级别，所需操作的标准会发生变化，因此用户现在必须弄清楚这些新操作是什么，以保持条形图增长而不是缩小。当用户试图了解哪些行为/模式会导致增长时，诸如“时间”之类的东西以及不受欢迎的行为会慢慢地让他们失望。

我想知道是否有人知道任何可能具有类似逻辑的开源游戏。

或者，如果这种类型的逻辑有一个名称，那么我可以尝试找到一些可以帮助我设置类似内容的算法。

TIA

*-add*
似乎没有这样的技术术语，也许有人可以提出一些伪顶级逻辑。我以前从未制作过游戏，我想提高我朝着最佳方向前进的机会。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T02:28:58.707

这听起来有点像我的 Stack Overflow 声誉评分。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T02:39:57.637

听起来您正在尝试为业力建模...我认为有一些网站具有类似业力的系统（SO 的代表系统可以说是这样的）。

我会从一些简单的事情开始......如果用户做了“好”的事情，它就会上升。如果他们做坏事，它就会下降。如果他们什么都不做（懒惰？），它会慢慢下降。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T03:42:13.867

出于此代码的目的，我们假设条形图保存了玩家的分数。

```
Score = Max score that can be received from the action without modifier
Accuracy = [0..1] Where 0 is total miss on the action and 1 is a perfect hit.
           Example: The score for a headshot
LevelModifier = [0..1] Where 0 means that in this level, it doesn't give any 
                scores and 1 means that the player receives the max bonus. 

                You can also refer to this as a difficulty modifier. 
                The higher the level, the more bonus you get.

ScoreDelta = (Score * Accuracy) * LevelModifier

ScoreBar += ScoreDelta 
```

对于计时器，您可以每秒降低他们的 ScoreBar。

```
ScoreBar -= TimePenalty 
```

出于游戏原因，您可以在玩家执行操作时重置计时器。这将奖励不断移动的玩家。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T02:30:55.367

这听起来很像体验吧。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T04:27:14.883

听起来您最好使用[状态机](http://en.wikipedia.org/wiki/Finite_State_Machine)。

```
State A:
* Walk Forward : ++Points
* Jump         : Points += 100
* Points < 100 : Go to State A
* Points > 100 : Points = 0; Go to State B
* Points > 150 : Points = 0; Go to State C

State B:
* Kill Bad Guy : ++Points
* Get Hurt     : --Points
* Points < -50 : Points = 0; Go to State A
* Points < 100 : Go to State C
* Points > 100 : Points = 0; Go to State D
...etc... 
```

'Points == 150' 条件只是我为了展示状态机的强大功能而编造的。如果玩家做了一些特别好的事情来从低于 100 跳到高于 150，那么他就可以跳过一个关卡。您甚至可以拥有只能通过这种方式访问​​的奖励级别。

编辑：哇，我全神贯注于我的打字，我有点忘了最初的问题是什么。希望我的回答现在更有意义。

（我认为大多数其他回答者都将您的描述解释为对数增长。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T02:37:20.140

老实说，真正做到这一点的最好方法可能只是反复试验。发明一个公式，不要太复杂。在游戏中玩它。如果感觉有点厚实、僵硬或松软或其他什么，调整它，添加术语，只是实验。

最终，它会在美学上令人愉悦。那就是你想要的。应该感觉健康条的响应会跟随您所付出的努力。

此外，只需编写游戏，您就会非常了解它。一定要给你的朋友/同事/任何随机的受害者一个尝试的机会，并确定他们是否像你一样觉得它在美学上是正确的。

# asp.net-mvc - ASP.NET MVC - 我可以在 MVC 中使用常见的 ASP.NET 用户角色配置吗？

> ID：652834
> 
> 赞同：0
> 
> 时间：2009-03-17T02:25:40.090
> 
> 标签：asp.net-mvc

是否可以在 ASP.NET MVC 应用程序上使用 commom ASP.NET 角色的配置？

谢谢！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T02:30:06.397

是的。ASP.NET MVC 和 ASP.NET Web 窗体都可以使用 ASP.NET 附带的角色配置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T02:30:20.123

是的！角色提供者仅提供一组通用合同来管理他们所在的用户和组（“角色”）。MVC 中的一切工作方式与传统 WebForms 中的相同 - 一旦通过登录识别用户或您处理该用户（身份验证提供程序）和会员提供者），您编写的任何特定于角色的代码都可以使用。

# asp.net-mvc - 使用 Web 平台安装程序安装 MVC 框架，但 MVC 模板不可用

> ID：652836
> 
> 赞同：0
> 
> 时间：2009-03-17T02:26:24.830
> 
> 标签：asp.net-mvc, installation

我刚刚使用 Web 平台安装程序安装了 Visual Web Developer 和 MVC 框架，我使用了 ASP.NET 选项，它说 MVC 已安装，但是当我打开一个新项目时它确实显示在模板列表中。

我使用受限用户在 Windows XP 中安装（输入管理员密码以允许安装）我想这是问题所在，但是，我该如何解决呢？

我尝试使用管理员帐户登录并执行 MVC 安装程序，但仍然无法在 Visual Web Developer 中获取模板。

有什么线索吗？或者任何手动注册模板的方法？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T02:52:54.593

我卸载了 MVC 框架并重新安装，现在模板注册得很好。

不知道我第一次做错了什么，但幸运的是它现在正在工作。

# windows - 自定义具有多个级别的 Windows 右键单击 菜单

> ID：652844
> 
> 赞同：0
> 
> 时间：2009-03-17T02:31:35.083
> 
> 标签：windows, customization, right-click

我了解通过 regedit 等自定义右键菜单所需的过程。但是我需要能够进入多个级别，例如在 WinZip 等应用程序中。这是一张图片，用于说明我需要什么

[替代文字 http://img14.imageshack.us/img14/9658/multiplemenus.jpg](http://img14.imageshack.us/img14/9658/multiplemenus.jpg)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T03:02:20.673

你需要写一个Shell Extension；[此处](http://www.theserverside.net/tt/articles/showarticle.tss?id=ShellExtensions)有使用托管代码 (C#) 编写指南的指南 。它将涉及执行一系列互操作并实现 Windows shell 将使用的 COM 接口，即[IShellExtInit](http://msdn.microsoft.com/en-us/library/bb775096(VS.85).aspx)和[IContextMenu](http://msdn.microsoft.com/en-us/library/bb776095(VS.85).aspx)。

但是，有人可能会争辩说，在托管代码中编写 Shell 扩展是[不可取](http://blogs.msdn.com/junfeng/archive/2005/11/18/494572.aspx)的。它将强制 Windows 资源管理器加载 CLR，（或任何使用标准 Windows“打开文件”对话框的应用程序）——本机代码 (C++) 将是更好的选择。

# ajax - 通过 GUID 保护 AJAX 请求

> ID：652851
> 
> 赞同：6
> 
> 时间：2009-03-17T02:34:43.280
> 
> 标签：ajax, algorithm, security, guid, server-side

我正在编写一个将通过 AJAX 发出请求并希望锁定这些调用的网络应用程序。经过一番研究，我正在考虑使用某种形式的随机令牌（字符串）与请求（GUID？）一起传回。这是我算法的重要部分：

1.  将令牌分配给 JavaScript 变量（在服务器端生成）。
2.  此外，将该令牌存储在数据库中并为其指定一个有效时间段（即 10 分钟）。
3.  如果令牌仍未使用并且在其有效时间窗口内，则允许调用。
4.  如果有效则返回请求的信息，否则，记录请求并忽略它。

着眼于安全，这有意义吗？对于令牌，GUID 会起作用吗？它应该是别的东西吗？有没有一种加密请求中变量的好方法？

**编辑：**

我知道这些 AJAX 请求并不是真正的“安全”，但我想添加基本的安全性，因为我想阻止其他人使用我打算编写的服务。这种随机令牌将是防止滥用电话的基本前线防御。将被请求（甚至提交以生成此类数据）的数据极不可能重复。

也许我在使用 GUID 时错了……随机生成的字符串（令牌）怎么样？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T02:45:13.613

如果您这样做是为了信任您发送到客户端浏览器的代码，请更改方向。您真的不想信任用户输入，其中包括您发送到浏览器的来自 js 的调用。应该在服务器上建立逻辑，这样就不会发生任何错误。也就是说，asp.net 使用签名字段，如果绝对必要，您可能希望采用这种方式。

扩展一点：Asp.net 防篡改视图状态，它作为 html 隐藏字段发送（取决于配置）。我确信有更好的链接作为参考，但至少在这个链接中提到了：http: [//msdn.microsoft.com/en-us/library/ms998288.aspx](http://msdn.microsoft.com/en-us/library/ms998288.aspx)

> 验证。这指定了用于生成 HMAC 以使 ViewState 和表单身份验证票证防篡改的散列算法。此属性还用于指定用于 ViewState 加密的加密算法。此属性支持以下选项：
> 
> *   SHA1–SHA1 用于防篡改 ViewState，如果已配置，还用于表单身份验证票证。当为验证属性选择 SHA1 时，使用的算法是 HMACSHA1。

该算法的 .net 类链接[http://msdn.microsoft.com/en-us/library/system.security.cryptography.hmacsha1.hmacsha1.aspx](http://msdn.microsoft.com/en-us/library/system.security.cryptography.hmacsha1.hmacsha1.aspx)。

**更新 2：** 为了防篡改，您希望对数据进行签名（而不是对其进行加密）。请注意，通常在使用密码学时，您应该真正避免使用自定义实现或算法。关于步骤，我会坚持：

*   将令牌分配给 JavaScript 变量（在服务器端生成）。*您包括信息以识别请求以及发出请求的确切日期和时间。签名将验证服务器端应用程序发布的数据。*
*   如果合适，确定重复提交。

也就是说，asp.net 默认验证视图状态的原因是，开发人员依赖传入的信息，因为只有应用程序不应该处理这些信息。这可能适用于您的场景，不要依赖这种机制。如果您想评估某人是否可以做某事，请使用身份验证+授权。如果您想知道 ajax 调用仅发送有效选项，请验证它们。不要在粒度级别公开 API，而不是您可以适当授权操作的 API。这种机制只是一种额外的措施，以防万一发生滑倒，而不是真正的保护。

附言。使用上面的 HMACSHA1，您将使用固定密钥对其进行实例化

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T02:38:06.410

“保护”是一个模糊的术语。你到底想完成什么？使用 GUID 是防止重复提交相同请求的一种非常好的方法，但仅此而已。

如果在客户端和服务器之间传递的信息是真正敏感的，您应该通过 HTTPS 进行。就保护实际通信而言，这确实是唯一的答案。

编辑：回答您关于 GUID 是否是“正确”方式的问题 - 没有正确的方法可以按照您的建议进行操作。使用任何令牌，无论是 GUID 还是您自己创建的东西，除了防止重复提交同一请求外，不会产生任何影响。就是这样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T02:38:11.633

这实际上取决于您要通过安全性实现的目标。如果您的意思是防止未经授权使用 HTTP 端点，那么您几乎无能为力，因为用户将拥有对用于进行调用的 HTML 和 JavaScript 的完全访问权限。

如果您的意思是阻止某人嗅探 AJAX 请求中的数据，那么我只会使用 SSL。

以您建议的方式使用的 GUID 实际上只是重新发明了会话 ID cookie。

# javascript - 用于网络的类似 iPhone（老虎机）的“选择器”选择框？

> ID：652857
> 
> 赞同：8
> 
> 时间：2009-03-17T02:36:22.497
> 
> 标签：javascript, user-interface, picker

我正在寻找可以在网络上使用的类似 iPhone 的“选择器”控件。

可访问性不是问题。JavaScript 将在所有客户端上可用，并且 Web 应用程序将在提供给用户的环境中运行。如果解决方案可以优雅地降级为选择框，那就太好了。Flash 和 Silverlight 并不理想（出于我不想跳入的原因），但 Flash 和 Silverlight 中的类似解决方案可能会受到其他人的赞赏。

以下是 iPhone 上的控件示例：

![截屏](https://farm4.static.flickr.com/3647/3360349695_c9d123e6fd.jpg)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-08-16T21:08:52.957

我知道这个问题有点老了，但是既然我有答案，我也可以给出它。其他人仍然可以寻找它（就像我一样）。我创建了这个控件以将其用作 jQuery 的插件。见我的博客：

[http://marinovdh.wordpress.com/2011/09/14/use-the-iphone-uipickerview-control-as-a-selectbox-on-your-website-with-jquery/](http://marinovdh.wordpress.com/2011/09/14/use-the-iphone-uipickerview-control-as-a-selectbox-on-your-website-with-jquery/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T14:49:12.367

听起来您正在寻找已经构建的东西，但我还没有看到，但看起来您可以使用[YUI 的](http://developer.yahoo.com/yui/)Carousel Control plus Animations 构建一个，[正如 carousel control 页面上的本节所解释的那样](http://developer.yahoo.com/yui/carousel/#animation)。

祝你好运！！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T14:20:10.303

ComponentOne 可能有您正在寻找的东西。[在http://www.componentone.com](http://www.componentone.com)查看适用于 iPhone 的 C1 Studio 。它是一套 ASP.NET 控件，模仿 iPhone UI 元素的本机外观。

# c# - TabControl 中的轨迹栏背景

> ID：652859
> 
> 赞同：5
> 
> 时间：2009-03-17T02:36:37.800
> 
> 标签：c#, winforms, trackbar

我在 TabControl 内的 TabPage 上有一个 TrackBar 控件。TrackBar 的背景被绘制为灰色，而 TabPage 被绘制为白色。无法将 TrackBar 的 BackColor 属性设置为透明，也无法覆盖绘图，因为 TrackBar 没有 DrawMode 属性。我必须有哪些选项才能使 TrackBar 适合？为什么它不支持视觉样式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-04-17T09:27:22.527

简单的

```
class MyTransparentTrackBar : TrackBar
{
    protected override void OnCreateControl()
    {
        SetStyle(ControlStyles.SupportsTransparentBackColor, true);
        if (Parent != null)
            BackColor = Parent.BackColor;

        base.OnCreateControl();
    }
} 
```

我也遇到过这个问题（需要一个标签控件上的透明背景轨迹栏，它可以在启用和禁用视觉样式的情况下工作）。这对我有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-26T07:46:05.680

不会在这里干涉，但上述建议都不适合我。诀窍是以下几行：

```
private const int WM_DWMCOMPOSITIONCHANGED = 0x031A;
private const int WM_THEMECHANGED = 0x031E;

protected override void OnVisibleChanged(EventArgs e)
{
    Color color = this.BackColor;
    trackBarQuality.BackColor = Color.FromArgb(color.R, color.G, color.B);
}

protected override void WndProc(ref Message m)
{
    if (m.Msg == WM_DWMCOMPOSITIONCHANGED || m.Msg == WM_THEMECHANGED)
        OnVisibleChanged(new EventArgs());

    base.WndProc(ref m);
} 
```

所以我基本上从背景颜色中消除了alpha通道。不过，仍然需要使用 Vista 和 Win 7 进行测试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T02:54:03.827

您可能想查看 CodePlex 上的[TransparentTrackBar](http://www.codeplex.com/TransparentTrackBar)项目。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-02-19T20:34:42.167

显而易见的解决方案似乎是将 TrackBar 的 BackColor 设置为 System-ControlLightLight。

（但是对于四年前的问题有一个明显的解决方案的问题是，它可能暗示我误解了一些东西。）

# c# - NHibernate Fluent 跨 DLL 的自动映射

> ID：652861
> 
> 赞同：1
> 
> 时间：2009-03-17T02:37:47.453
> 
> 标签：c#, .net, nhibernate, fluent-nhibernate, nhibernate-mapping

我在 1 个项目/dll 中有一个 Person 类和一个派生自另一个项目/dll 中的 Person 的 StandardUser 类。我有一个包含 StandardUser 的 Password 类（Password 和 StandardUser 在同一个 dll 中）。

我似乎无法让流利的自动映射在这种情况下工作。

它告诉我：NHibernate.MappingException：来自表密码的关联指的是未映射的类：DomainModel.Users.DomainObjects.StandardUser

如果我将 Person 类移动到与 StandardUser 相同的 dll 中，那么它可以工作。如果 Password 包含 Person 而不是 StandardUser，它也可以工作。

我是否遗漏了某些内容，或者 Fluent Automappings 不支持此功能？

* * *

**编辑/回答：**看来您必须在 AutoMappings 中映射 StandardUser 的程序集。在映射基类之前添加。我不确定这是设计使然还是错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T02:57:39.933

看来您必须在映射基类之前在 AutoMappings.Add 中映射 StandardUser 的程序集。我不确定这是设计使然还是错误。

# computer-science - 计算机模拟：资源密集程度如何？

> ID：652862
> 
> 赞同：1
> 
> 时间：2009-03-17T02:38:01.493
> 
> 标签：computer-science, simulation

**问题：**

*   计算机模拟如何，通常是资源密集型的？

例如，[Simul8](http://www.simul8.com/products/what_is_simulation.htm)：离散事件模拟包 - 为什么计算密集，哪些因素（计算）对此有影响？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T02:59:32.987

离散事件模拟是一个非常广泛的术语；您可以模拟任何东西，从柠檬水摊到跨国企业的交易和物流，再到复杂的软件系统，再到尚不存在的新型计算机架构（并且比运行模拟的机器更复杂和先进）。

我将使用我的领域（计算机体系结构）中的一个示例，但是计算成本高昂的方式应该可以很好地概括。很多时候，您试图模拟一个分布式系统，其中有许多具有自己更简单控制逻辑的独立代理，它们共同实现了一个非常复杂的动态。在计算系统的情况下，模拟器的组合工作集至少与所有组成组件的架构、微架构和内存状态组合一样大。如果每个组件都非常复杂，这意味着您在完成模拟的每个时间步长时的时间和空间局部性会大大降低。每个时间步都需要遍历整个工作集所暗示的低缓存利用率可能会影响性能一到两个数量级。这种模式是不可避免的，因为在多个时间步长上独立运行每个组件并且只定期合并结果是有问题的，而且您的系统越复杂和耦合越多。

此外，您通常希望保留各种统计信息，这些统计信息会在组件模拟之上引入大量额外的空间和时间开销。

简而言之，您的下限是模拟所有组件的复杂性之和。在实践中，如果您有许多组件，如果您的组件比运行模拟的主机更复杂甚至根本*不同，并且如果您有大量的仪器，则会引入很多低效率。*

最后一件事：离散事件模拟通常涉及将项目放入队列中，并根据追逐一堆指针来查找在哪个队列中放置请求。这些操作难以并行化，使事情进一步复杂化。然而，正如我之前提到的，“离散事件模拟”一词可以涵盖从琐碎到不可能的任何事情，因此很难提取一般模式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T02:55:41.640

计算机模拟通常会快速运行多个场景并进行比较。

例如，财务模拟通常与具有数千次运行[的蒙特卡罗模拟一起运行。](http://en.wikipedia.org/wiki/Monte_Carlo_method)

> 一次模拟通常会涉及超过 10,000 次模型评估，在过去，这项任务仅在使用超级计算机时才可行。- [http://www.vertex42.com/ExcelArticles/mc/MonteCarloSimulation.html](http://www.vertex42.com/ExcelArticles/mc/MonteCarloSimulation.html)

# ruby - 在红宝石中结合正则表达式

> ID：652874
> 
> 赞同：1
> 
> 时间：2009-03-17T02:47:29.817
> 
> 标签：ruby, regex, parsing, text

鉴于此文本：

```
    /* F004 (0309)00 */  
    /* 字段 1 */  
    /* 字段 2 */  
    /* F004 (0409)00 */  
    /* 字段 1 */  
    /* 字段 2 */  

```

我如何将它解析到这个数组中：
`[
["F004"],["0309"],["/* field 1 */\n/* field 2 */"],
["F004"],["0409"],["/* field 1 */\n/* field 2 */"]
]`

我得到了解析前两项的代码：

```
form = /\/\*\s+(\w+)\s+\((\d{4})\)[0]{2}\s+\*\//m
text.scan(form) 
```

`[
["F004"],["0309"],
["F004"],["0409"]
]`

这是我尝试解析所有三个并因无效正则表达式错误而失败的代码：

```
form = /\/\*\s+(\w+)\s+\((\d{4})\)[0]{2}\s+\*\//m
form_and_fields = /#{form}(.[^#{form}]+)/m
text.scan(form_and_fields) 
```

* * *

编辑：这最终对我有用，这要归功于rampion和singpolyma：

```
form = /
  \/\*\s+(\w+)\s+\((\d+)\)\d+\s+\*\/    #formId & edDate
  (.+?)                                 #fieldText
  (?=\/\*\s+\w+\s+\(\d+\)\d+\s+\*\/|\Z) #stop at beginning of next form
                                        # or the end of the string
/mx
text.scan(form) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T03:31:12.227

您似乎误解了字符类（例如`[a-f0-9]`，或`[^aeiouy]`）的工作方式。 `/[^abcd]/`不否定模式`abcd`，它说“匹配任何不是`'a'`或`'b'`或`'c'`或的字符`'d'`”。

如果要匹配模式的否定，请使用`/(?!pattern)/`构造。这是一个零宽度匹配 - 这意味着它实际上不匹配任何字符，它匹配一个位置。类似于如何匹配字符串的开头`/^/`和`/$/`结尾，或者`/\b/`匹配单词的边界。例如：`/(?!xx)/`匹配模式“xx”没有开始的每个位置。

一般来说，在使用模式否定之后，您需要匹配某个字符才能在字符串中向前移动。

所以要使用你的模式：

```
form = /\/\*\s+(\w+)\s+\((\d{4})\)[0]{2}\s+\*\//m
form_and_fields = /#{form}((?:(?!#{form}).)+)/m
text.scan(form_and_fields) 
```

从内到外（我将使用`(?#comments)`）

*   `(?!#{form})`否定您的原始模式，因此它匹配原始模式无法开始的任何位置。
*   `(?:(?!#{form}).)+`意味着匹配一个字符，然后再试一次，尽可能多次，但至少一次。 `(?:(?#whatever))`是一个非捕获括号 - 适合分组。

在 irb 中，这给出：

```
irb> text.scan(form_and_fields)
=> [["F004", "0309", "  \n    /* field 1 */  \n    /* field 2 */  \n    ", nil, nil], ["F004", "0409", "  \n    /* field 1 */  \n    /* field 2 */  \n", nil, nil]] 
```

额外`nil`的 s 来自`form`在否定模式中使用的捕获组，`(?!#{form})`因此在成功匹配时不会捕获任何内容。

这可以清理一些：

```
form_and_fields = /#{form}\s*(.+?)\s*(?:(?=#{form})|\Z)/m
text.scan(form_and_fields) 
```

现在，我们不使用零宽度的负前瞻，而是使用零宽度的正前瞻`(?=#{form})`来匹配下一次出现的位置`form`。所以在这个正则表达式中，我们匹配所有内容，直到下一次出现`form`（**不**包括下一次出现在我们的匹配中）。这让我们可以去掉字段周围的一些空白。我们还必须检查我们击中字符串末尾的情况 - `/\Z/`，因为这也可能发生。

在 irb 中：

```
irb> text.scan(form_and_fields)
=> [["F004", "0309", "/* field 1 */  \n    /* field 2 */", "F004", "0409"], ["F004", "0409", "/* field 1 */  \n    /* field 2 */", nil, nil]] 
```

现在请注意，最后两个字段是第一次填充的——b/c 零宽度正向预测中的捕获括号匹配了一些东西，即使它在此过程中没有被标记为“已使用”——这就是为什么那个位可以进行第二次复赛。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T03:03:44.770

```
a.scan(/\/\*\s+(\S+)\s+\((\d+)\)\d+\s+\*\/\s+(\/\*.+\*\/\s+\n\s+\/\*.+\*\/)/)
=> [["F004", "0309", "/* field 1 */  \n    /* field 2 */"], ["F004", "0409", "/* field 1 */  \n    /* field 2 */"]] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T04:05:18.023

对于它的价值，如果您扩展代码并使用多个更简单的正则表达式，您可能会发现您的代码最终更具可读性。例如（未经测试）：

```
 transformed_lines = []

  text.each_line do |line|
    if line =~ /(\w|\d)+\s\(\d+)\)/
      transformed_lines << [ $1, $2, "" ]
    else
      transformed_lines.last.last << line.strip
    end
  end 
```

更好的是，考虑创建一个类或简单的结构来存储结果，以便更清楚地知道去哪里：

```
 transformed_lines << OpenStruct.new :thingy_one => $1, :thingy_two => $2, :fields => ""
  ...
  transformed_lines.last.fields << line.strip 
```

# reporting-services - Reporting Services 表达式中的日期数学

> ID：652878
> 
> 赞同：0
> 
> 时间：2009-03-17T02:52:21.413
> 
> 标签：reporting-services, expression, dateadd, date-math

我正在尝试将日期添加到日期，然后进行比较以查看它是否超出了对单元格进行颜色编码的范围。它不起作用——我想我可能会犯一个简单的语法错误。

```
iif(
  (DateAdd("d", CInt(Fields!Days.Value), Fields!Date.Value) < Now), "Red", "White")
) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T03:58:04.063

看起来你最后有一个额外的“）”。

=iif((DateAdd("d", CInt(Fields!Days.Value), Fields!Date.Value) < Now), "Red", "White")

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T03:04:32.837

您是否以“=”符号开始您的表达？

```
=iif(
    DateAdd("d", CInt(Fields!Days.Value), Fields!Date.Value) < Now, 
    "Red", "White") 
```

# delphi - 如何在 Delphi 中添加越来越多的已保存文件？

> ID：652886
> 
> 赞同：0
> 
> 时间：2009-03-17T02:56:41.730
> 
> 标签：delphi, save, numbers

我正在制作一个程序来拍摄屏幕快照，并将其作为位图图片保存到文件夹中。我似乎遇到了问题，图片只是覆盖了自己。

谁能告诉我怎么做，所以当它保​​存时，这个数字会比上一个高一个吗？例如： 保存1：Screenshot0001.bmp 保存2：Screenshot0002.bmp 保存3：Screenshot0003.bmp

等等。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T03:19:09.557

有很多方法可以完成这样的事情。

1.  像你的数码相机那样做；有一个计数器并将其保存在文件或注册表中。您可能会遇到多用户问题，并且您仍然必须处理图像已经存在的情况。

2.  不要使用递增的数字，而是在文件名中写入日期时间。文件名 := 'Screenshot_'+FormatDateTime('yyyymmdd-hhnnss-zzz.bmp',now());

3.  执行以下代码以查找最新号码。我认为这符合您的描述，但请记住，当您编写更多图像时，此代码会变慢。有数千张图片和慢速驱动器或网络，它可能会“挂起”您的程序。

..

```
i := 0;
while FileExists(Format('%sScreenshot%.04d.bmp',[ImgPath,i])) do
  inc(i); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T03:17:45.283

在程序启动时，迭代所有 Screenshot*.bmp 文件，解析出数字部分并找到最高的 - 将此值分配给您的计数器。进行快照时，进入一个循环，尝试使用“仅在不存在时创建”（CREATE_NEW）语义创建 Screenshot.bmp，递增计数器直到找到未使用的名称。

或者，使用时间戳而不是计数器 :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T06:54:38.710

您需要这样的例程来模拟 Windows 文件复制，其中第一个文件是“我的文件”，第二个是“我的文件 (2)”，然后是“我的文件 (3)”等。

```
function AppendDuplicationNumber( const AStr : string ) : string;
// Used to make strings unique
// This examines the string AStr for trailing '(n)' where
// 'n' is an integer.
// If the (n) part is found, n is incremented, otherwise '(2)' is
// appended to the string.
var
  iLH, iRH, I : integer;
  S           : string;
begin
  Result := AStr;
  iLH    := CharPosBackwards( '(', Result );
  If iLH > 0 then
    begin
    iRH := PosEx( ')', Result, iLH );
    If iRH > 0 then
      begin
      I := StrToIntDef( Copy( Result, iLH+1, iRH-iLH-1 ), 0 );
      If I > 0 then
        begin
        Inc(I);
        S := IntToStr( I );
        Delete( Result, iLH+1, iRH-iLH-1 );
        Insert( S, Result, iLH+1 );
        Exit;
        end;
      end;
    end;

  // Did not increment existing (n), so append it.
  Result := Result + ' (2)';
end; 
```

# android - 如何防止应用程序超时？

> ID：652888
> 
> 赞同：3
> 
> 时间：2009-03-17T02:58:14.973
> 
> 标签：android, multithreading, android-service

我创建了一个多线程应用程序，但如果服务器不可用，它仍然会挂起。

在主活动中，我创建了以下方法：

```
@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);

    //bind GUI elements
    ...

    //start TCPConnection Service in a new thread
    establishTCPConnection();
    ...

}

private void establishTCPConnection(){
    TCPClientServiceThread = new Thread(null, backgroundConnection, "connection");
    TCPClientServiceThread.start();
}

..

private Runnable backgroundConnection = new Runnable(){
    public void run(){
        //establish TCP connection
        doEstablishTCPConnection();
    }
};

private void doEstablishTCPConnection()
{
    //start TCPConnection service
    startService(new Intent(this, TCPClientService.class));
} 
```

这是 TCPClientService 类：

```
public class TCPClientService extends Service{

...

private String serverAddress = "192.168.1.5";
private int portNumber = 1000;

@Override
public void onCreate()
{
    //TODO: Actions to perform when service is created
    connectionAvailable = false;

    IntentFilter dataReceiverFilter;
    dataReceiverFilter = new IntentFilter(MotranetClient.MOTION_DATA_UPDATED);
    dataReceiver = new DataReceiver();
    registerReceiver(dataReceiver, dataReceiverFilter);

    EstablishConnection();
}

@Override
public IBinder onBind(Intent intent)
{
    //TODO: Replace with service binding implementation
    return null;
}

private void EstablishConnection()
{
    try {
           InetAddress serverAddr = InetAddress.getByName(serverAddress);
           Log.d("TCP", "C: Connecting...");
           Socket socket = new Socket(serverAddr, portNumber);
           String message = "testing connection";

               try {
                Log.d("TCP", "C: Sending: '" + message + "'");
                PrintWriter out = new PrintWriter( new BufferedWriter( new OutputStreamWriter(socket.getOutputStream())),true);
                out.println(message);
                Log.d("TCP", "C: Sent.");
                  Log.d("TCP", "C: Done.");
                  connectionAvailable = true;

             } catch(Exception e) {
                 Log.e("TCP", "S: Error", e);
                 connectionAvailable = false;

               } finally {
                  socket.close();
                  announceNetworkAvailability(connectionAvailable);
                }

         } catch (Exception e) {
              Log.e("TCP", "C: Error", e);
              announceNetworkAvailability(connectionAvailable);
         }
    }

} 
```

当服务器不可用时，线路

```
Socket socket = new Socket(serverAddr, portNumber); 
```

导致一些延迟，我相信这是挂起的原因。但是如果 TCPClientService 服务在自己的线程中执行，我不知道为什么这会影响主要活动的超时。

如果有人能展示如何防止应用程序在服务器不可用时挂起，我将非常感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T16:50:42.897

Android 平台总是在主事件线程中运行 Activity 和 Services 的生命周期方法。因此，您创建另一个线程，并从中调用 startService ...但是当创建并启动服务时，将从主事件线程调用 onCreate() 等方法，而不是从您的用户线程调用。

正确的方法是不要从另一个线程调用 startService，而是正常调用 startService，然后让 Service 从 onCreate() 中生成一个连接线程。

ssakl 的解决方案并没有解决我担心的基本问题。

# vb6 - VB加网格中的颜色

> ID：652889
> 
> 赞同：1
> 
> 时间：2009-03-17T02:59:20.180
> 
> 标签：vb6, grid

有没有办法将颜色放在行中（flexgrids）？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T03:13:32.063

```
Dim i as Integer
With myFlexGrid
  .Row = rowToChange
  For i = 0 to .Cols - 1
    .Col = i
    .CellBackColor = vbColorValue
  Next i
End With 
```

这将更改您使用 myFlexGrid.Row 设置的任何行的整行颜色。这不适用于您指定为固定的行。

# lisp - 对 let 语句的 Lisp 评估

> ID：652901
> 
> 赞同：8
> 
> 时间：2009-03-17T03:03:59.217
> 
> 标签：lisp, scheme, interpreter

我正在编写一个 Scheme 解释器，我面临着一个有效的 let 语句，例如：

```
;; should print 7
(let ((a 4) (b 3))
    (let ((a (* a a)) 
          (b (* b b)))
       (+ a b)
       (- a b))) 
```

我的解释器只实现了 Scheme 的一个纯函数子集，所以不会有 set! 之类的副作用。在纯函数式语言中，为什么要在上面的 let 语句中允许多个表达式？

在编写我的解释器时，除了 let 中的最后一个表达式，我还有什么理由应该评估任何东西？似乎它们永远不会影响评估的最后一个语句的结果。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T04:13:52.123

实际上，除了最后一条语句之外，您不能“删除”所有语句，因为前面的语句可能是非终止的。例如：

```
(define (func) (func))

(let ()
  (func) ;; does not return
  1) 
```

在这里，如果您不`(func)`进行评估，则会得到错误的结果（即 1），而您应该得到非终止计算。

另一个问题是 call/cc (call-with-current-continuation) （是的，它属于功能子集）可用于从非尾位置实际*返回计算，例如：*

```
(call-with-current-continuation
  (lambda (ret)
    (let ()
      (ret 3)
      4))) 
```

这将返回*3*而不是 4。这仍然是纯粹的功能。

注意顺便说一句，这`(let () x y z)`相当于单语句形式`(let () (begin x y z))`，所以真正的问题是你是否需要`begin`:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T04:08:27.673

你是对的（几乎）：如果你正在实现 Scheme 的纯函数子集（即 no `set!`, `set-car!`, `set-cdr!`），那么除了 a 中的最后一个之外的任何表达式`let`都将丢弃它们的返回值，因为你保证没有副作用，默默地忽略它们并没有危险。

**但是，**您需要考虑一种小情况，即当前面的表达式为`define`s 时：

```
(let ((x 3))
  (define y 4)
  (+ x y)) 
```

这既合法又实用。但是，有一些好消息 - 在块内（如 a `let`），您必须将所有`define`s 放在顶部。如，这不被视为合法方案：

```
(let ((x 3))
  (+ 2 3)
  (define y 4)
  (+ x y)) 
```

这意味着当评估一个块时，您所要做的就是扫描顶部的`define`s 并将它们包装到等效的`letrec`表达式中，然后继续忽略除最后一个表达式之外的所有表达式（然后您将返回）。

**编辑：** [antti.huima](https://stackoverflow.com/questions/652901/lisp-evaluation-of-let-statements/653009#653009)对 call/cc 提出了很好的观点。如果你要在你的实现中包含延续，你真的不能对什么时候评估事情做出很多假设。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T03:38:59.087

好的，这`let`只是创建一个绑定，比如`define`. 那里没有任何东西可以改变绑定变量`set!`。所以现在，想想你的名字的*范围*是什么：你绑定到 4`a`的 '(+ ab) a` 是什么？`the same as the`（提示：没有。）

这里真正的要点是，即使在像这样的 hinky 情况下，您也需要正确行事：范围和绑定规则简单且定义明确，而做这样*看起来*令人困惑的事情只是它们的结果。这很方便，因为通过与 进行本地词法范围绑定`let`，您可以编写更清晰的程序，即使存在不正当的情况。

**更新** 哦，我离开了一点。调用没有持久效果是对的`(+ a b)`，但是在一般情况下，您不能假设这是真的，并且您无法通过单独检查程序文本来确定它是否正确。（考虑一下：那里可能有其他函数代替“ `+`”。）但是，如果您认为在不评估各种`let`子句的情况下会得到正确的结果，那么您还不明白它要做什么.

# visual-c++ - 如何着手设计如下界面

> ID：652902
> 
> 赞同：0
> 
> 时间：2009-03-17T03:04:12.697
> 
> 标签：visual-c++

我有 Visual C++ 6.0 和 Visual C++ 2005 但从未编程尝试过如下图所示的编程... 谁能告诉我创建类似的 GUI 会涉及什么？我是否对顶部工具栏使用占位符并且对两个部分（本地计算机和 FTP 服务器）使用相同的占位符？

[http://www.flickr.com/photos/14402427@N02/3353415463/](http://www.flickr.com/photos/14402427@N02/3353415463/) [http://www.internet-soft.com/ftpcomm.htm](http://www.internet-soft.com/ftpcomm.htm)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T03:24:25.503

下半部分将使用 SplitterWindow，左右各有不同的位来填充它。上半部分是一个（或多个）MenuStrips（我认为这是类名 - 我没有打开 VS，而且我我现在感觉有点懒），菜单显示为文本或按钮。这假定您使用的是 VC++ 2005 和 .NET 2.0 。我不建议使用 MFC 和 VC++ 6.0 执行此操作，尤其是作为新手。会很痛……很痛。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T03:42:07.690

我同意，尝试在您的第一个项目上创建一个完整的应用程序可能会很痛苦，您为什么不查找一些具有可用源代码的开源 ftp 程序呢？然后你可以通过修改或添加一些简单的功能来练习你的技能。如果它有用，您可以将您的程序回馈给社区。

我认为.net 应用程序现在在网上相对容易找到。我用 .net 与 Harper & Charlie 相呼应，你不必从你的皇冠上拔出那么多头发。

只是我的两分钱。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T16:54:14.777

感谢大家的反馈和建议。我的开头段落不是很清楚我想说的是我没有编写像 URL 中的图片所示的这个 FTP 客户端 GUI 这么复杂的东西。我想尝试这个 GUI 的原因是因为我使用的是相同的 FTP 客户端，并且想对其进行一些修改。我将尝试另一个带有源代码或简单 GUI 的 FTP GUI。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-17T03:29:15.413

哦，*伙计*，如果你从来没有编程过，那不是开始的方式。

# flash - Flash Remoting 与 ASP.Net 通信的最佳客户端架构是什么？

> ID：652910
> 
> 赞同：0
> 
> 时间：2009-03-17T03:11:57.857
> 
> 标签：flash, remoting, weborb, fluorinefx

我们发现作为服务器后端的 ASP.Net 和作为用户界面的 Adob​​e Flash 的结合是完美的结合。

到目前为止，我们一直使用 Javascript 作为这两种技术之间的通信管道。这工作得很好，但是我们希望能够来回传递对象，而不仅仅是字符串变量，我们还希望有更好的性能。

您可以使用多种方法进行交流：

*   Javascript
*   Web 服务（在 MX 中正确支持，在 CS3 中不支持，对 CS4 不确定）
*   闪存远程处理
*   其他的？

我的研究表明，Flash Remoting 是表现最好的。

在服务器上，您需要提供远程网关（Flash Remoting（999 美元）、FluorineFx、WebORB、AMF.Net）。

从客户端使用远程处理的最佳方式是什么？

问题在于 Flash 远程处理库似乎不是很好或得到很好的支持。他们在 MX 中，而不是在 CS3 中，还不确定 CS4。

Flex 显然具有出色的远程处理支持，但是我们喜欢在 Flash 中制作自由形式 UI 的能力，而不仅限于 Flex 控件。我已经看到了在 flex 中嵌入 flash swf 的建议——但我不愿意引入另一层。我没有广泛使用 Flex，所以我可能在这里遗漏了一些东西。

有没有人在这方面有任何经验？我应该尝试将我的 swf 嵌入到 flex 中吗？或者 CS4 是否提供足够好的远程处理支持？

谢谢。

鲍比 - 这是个好主意。JSON 可能会解决问题。

悬崖.meyers - 我们已经在服务器上使用了氟。问题在于在客户端上使用 Flash（不是 Flex）（见上文），并且 Flash 缺乏对远程处理的良好支持。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T06:39:07.377

不知道您所说的良好支持是什么意思。我们也遇到了这个问题，并且正在使用氟。我围绕 NetConnection 对象构建了一组类。一切正常，我们的 VO/DTO 对象可以正确翻译并在 Flash 中正确键入。我遇到的唯一问题是错误对象被键入为 Object 并且显然没有有用的文档。我们遇到的另一件事是现在我们必须手动转码 VO/DTO 对象，而不是从相同的定义文件自动生成 C# 和 AS3 代码。

我们现在已经在两个项目中使用了它，并且没有出现任何问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T04:29:47.827

您是否尝试过构建提供 JSON 的 Web 服务？在使用 Flash Remoting 路线之前，我会尝试一下，看看它如何满足您的需求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T08:07:18.633

我们已经使用 Fluorine 或 WebORB 远程网关在 Flash 中完成了几个项目。我们遇到了一些问题（我认为例如使用 ObjectEncoding.AMF3 时存在问题），但对我来说这是最好的解决方案。我们还使用了 JSON，这也是一个不错的选择，但不如 WebORB 或 FluorineFX（对我而言）。

也许看看 WebORB 示例。我认为有些例子是用 Flash 而不是 Flex 编写的。

```
private var service:NetConnection;
service=new NetConnection();
service.objectEncoding=ObjectEncoding.AMF0;
service.connect("GatewayUrl");
responder=new Responder(callResult, callFault);
service.call("name_service", responder, parameters); 
```

这基本上就是您需要做的所有事情（除了使用 registerClassAlias 注册您的课程）。

当然，Flex 更好地支持远程处理。

查看我博客上的此[链接以获取另一个示例。](http://blog.johlero.eu/?p=26)

# java - 将 Java 密钥库转换为 PEM 格式

> ID：652916
> 
> 赞同：146
> 
> 时间：2009-03-17T03:14:29.380
> 
> 标签：java, encryption, https, openssl, ssl-certificate

我正在尝试使用 keytool 和 openssl 应用程序将 Java 密钥库文件转换为 PEM 文件。但是我找不到进行转换的好方法。有任何想法吗？

我没有将密钥库直接转换为 PEM，而是尝试先创建一个 PKCS12 文件，然后再转换为相关的 PEM 文件和密钥库。但我无法使用它们建立连接。（请注意，我只需要一个 PEM 文件和一个 Keystore 文件来实现安全连接。没有像“从 java 密钥库文件开始”这样的限制。:) 所以从其他格式开始对我的情况是可以接受的）

但是从 jks 到 pem 的直接转换方法更可取。

* * *

## 回答 #1

> 赞同：240
> 
> 时间：2009-03-18T00:32:33.857

这很简单，至少使用jdk6......

```
bash$ keytool -keystore foo.jks -genkeypair -alias foo \
        -dname 'CN=foo.example.com,L=墨尔本,ST=维多利亚,C=AU'
输入密钥库密码：  
重新输入新的密码：
输入密钥密码
        （如果与密钥库密码相同，则返回）：  
bash$ keytool -keystore foo.jks -exportcert -alias foo | \
       openssl x509 -inform der -text
输入密钥库密码：asdasd
证书：
    数据：
        版本：3 (0x2)
        序列号：1237334757 (0x49c03ae5)
        签名算法：dsaWithSHA1
        发行人：C=AU，ST=维多利亚，L=墨尔本，CN=foo.example.com
        有效性
            不早于：格林威治标准时间 2009 年 3 月 18 日 00:05:57
            不晚于：格林威治标准时间 2009 年 6 月 16 日 00:05:57
        主题：C=AU，ST=维多利亚，L=墨尔本，CN=foo.example.com
        主题公钥信息：
            公钥算法：dsaEncryption
            DSA 公钥：
                酒馆：
                    00:e2:66:5c:e0:2e:da:e0:6b:a6:aa:97:64:59:14:
                    7e:a6:2e:5a:45:f9:2f:b5:2d:f4:34:27:e6:53:c7:

bash$ keytool -importkeystore -srckeystore foo.jks \
       -destkeystore foo.p12 \
       -srcstoretype jks \
       -deststoretype pkcs12
输入目标密钥库密码：  
重新输入新的密码：
输入源密钥库密码：  
已成功导入别名 foo 的条目。
导入命令完成：1 个条目成功导入，0 个条目失败或取消

bash$ openssl pkcs12 -in foo.p12 -out foo.pem
输入导入密码：
MAC 验证正常
输入 PEM 密码：
验证 - 输入 PEM 密码：

bash$ openssl x509 -text -in foo.pem
证书：
    数据：
        版本：3 (0x2)
        序列号：1237334757 (0x49c03ae5)
        签名算法：dsaWithSHA1
        发行人：C=AU，ST=维多利亚，L=墨尔本，CN=foo.example.com
        有效性
            不早于：格林威治标准时间 2009 年 3 月 18 日 00:05:57
            不晚于：格林威治标准时间 2009 年 6 月 16 日 00:05:57
        主题：C=AU，ST=维多利亚，L=墨尔本，CN=foo.example.com
        主题公钥信息：
            公钥算法：dsaEncryption
            DSA 公钥：
                酒馆：
                    00:e2:66:5c:e0:2e:da:e0:6b:a6:aa:97:64:59:14:
                    7e:a6:2e:5a:45:f9:2f:b5:2d:f4:34:27:e6:53:c7:

bash$ openssl dsa -text -in foo.pem
读取 DSA 密钥
输入 PEM 密码：
私钥：（1024 位）
私人：
    00:8f:b1:af:55:63:92:7c:d2:0f:e6:f3:a2:f5:ff:
    1a:7a:fe:8c:39:dd
酒馆：
    00:e2:66:5c:e0:2e:da:e0:6b:a6:aa:97:64:59:14:
    7e:a6:2e:5a:45:f9:2f:b5:2d:f4:34:27:e6:53:c7:

```

你最终得到：

*   foo.jks - java 格式的密钥库。
*   foo.p12 - PKCS#12 格式的密钥库。
*   foo.pem - 来自密钥库的所有密钥和证书，采用 PEM 格式。

（如果您愿意，可以将最后一个文件拆分为密钥和证书。）

* * *

命令摘要 - 创建 JKS 密钥库：

```
keytool -keystore foo.jks -genkeypair -alias foo \
    -dname 'CN=foo.example.com,L=Melbourne,ST=Victoria,C=AU' 
```

命令摘要 - 将 JKS 密钥库转换为 PKCS#12 密钥库，然后转换为 PEM 文件：

```
keytool -importkeystore -srckeystore foo.jks \
   -destkeystore foo.p12 \
   -srcstoretype jks \
   -deststoretype pkcs12

openssl pkcs12 -in foo.p12 -out foo.pem 
```

如果您的 JKS 密钥库中有多个证书，并且您只想导出与其中一个别名关联的证书和密钥，则可以使用以下变体：

```
keytool -importkeystore -srckeystore foo.jks \
   -destkeystore foo.p12 \
   -srcalias foo \
   -srcstoretype jks \
   -deststoretype pkcs12

openssl pkcs12 -in foo.p12 -out foo.pem 
```

命令摘要 - 将 JKS 密钥库与 PEM 文件进行比较：

```
keytool -keystore foo.jks -exportcert -alias foo | \
   openssl x509 -inform der -text

openssl x509 -text -in foo.pem

openssl dsa -text -in foo.pem 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2012-11-17T02:46:53.457

`openssl`使用 StoBor 的命令时，我不断收到错误消息：

```
MAC verified OK
Error outputting keys and certificates
139940235364168:error:06065064:digital envelope routines:EVP_DecryptFinal_ex:bad decrypt:evp_enc.c:535:
139940235364168:error:23077074:PKCS12 routines:PKCS12_pbe_crypt:pkcs12 cipherfinal error:p12_decr.c:97:
139940235364168:error:2306A075:PKCS12 routines:PKCS12_item_decrypt_d2i:pkcs12 pbe crypt error:p12_decr.c:123: 
```

出于某种原因，只有这种类型的命令适用于我的 JKS 文件

```
keytool -importkeystore -srckeystore foo.jks \
   -destkeystore foo.p12 \
   -srcstoretype jks \
   -srcalias mykey \
   -deststoretype pkcs12 \
   -destkeypass DUMMY123 
```

关键是设置`destkeypass`，参数的值无关紧要。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2011-05-20T19:24:46.800

使用 keytool 从 jks 直接转换为 pem 文件

```
keytool -exportcert -alias selfsigned -keypass password -keystore test-user.jks -rfc -file test-user.pem 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-17T05:18:15.353

该`keytool`命令将不允许您从密钥库中导出私钥。您必须编写一些 Java 代码来执行此操作。打开密钥库，获取所需的密钥，并将其保存到 PKCS #8 格式的文件中。也保存相关的证书。

```
KeyStore ks = KeyStore.getInstance("jks");
/* Load the key store. */
...
char[] password = ...;
/* Save the private key. */
FileOutputStream kos = new FileOutputStream("tmpkey.der");
Key pvt = ks.getKey("your_alias", password);
kos.write(pvt.getEncoded());
kos.flush();
kos.close();
/* Save the certificate. */
FileOutputStream cos = new FileOutputStream("tmpcert.der");
Certificate pub = ks.getCertificate("your_alias");
cos.write(pub.getEncoded());
cos.flush();
cos.close(); 
```

使用 OpenSSL 实用程序将这些文件（二进制格式）转换为 PEM 格式。

```
openssl pkcs8 -inform der -nocrypt < tmpkey.der > tmpkey.pem
openssl x509 -inform der < tmpcert.der > tmpcert.pem 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2016-01-12T13:07:17.127

将 JKS 文件转换为 PEM 和 KEY 格式（.crt 和 .key）的简化说明：

```
keytool -importkeystore -srckeystore <Source-Java-Key-Store-File> -destkeystore <Destination-Pkcs12-File> -srcstoretype jks -deststoretype pkcs12 -destkeypass <Destination-Key-Password>

openssl pkcs12 -in <Destination-Pkcs12-File> -out <Destination-Pem-File>

openssl x509 -outform der -in <Destination-Pem-File> -out <Destination-Crt-File>

openssl rsa -in <Destination-Pem-File> -out <Destination-Key-File> 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-02-18T16:02:12.743

使用以下命令可以轻松地将 JKS KeyStore 转换为单个 PEM 文件：

```
keytool -list -rfc -keystore "myKeystore.jks" | sed -e "/-*BEGIN [A-Z]*-*/,/-*END [A-Z]-*/!d" >> "myKeystore.pem" 
```

解释：

1.  `keytool -list -rfc -keystore "myKeystore.jks"`以 PEM 格式列出 'myKeyStore.jks' KeyStore 中的所有内容。但是，它也会打印额外的信息。
2.  `| sed -e "/-*BEGIN [A-Z]*-*/,/-*END [A-Z]-*/!d"`过滤掉我们不需要的一切。我们只剩下 KeyStore 中所有内容的 PEM。
3.  `>> "myKeystore.pem"`将 PEM 写入文件“myKeyStore.pem”。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-06-05T10:25:12.077

首先将密钥库从 JKS 转储到 PKCS12

1. **keytool -importkeystore -srckeystore ~/.android/debug.keystore -destkeystore middle.p12 -srcstoretype JKS -deststoretype PKCS12**

将新的 pkcs12 文件转储到 pem

2.  **openssl pkcs12 -in middle.p12 -nodes -out middle.rsa.pem**

您应该同时拥有 pem 格式的证书和私钥。把它们分开。将“BEGIN CERTIFICATE”和“END CERTIFICATE”之间的部分放入cert.x509.pem 将“BEGIN RSA PRIVATE KEY”和“END RSA PRIVATE KEY”之间的部分放入private.rsa.pem 将私​​钥转换为pk8格式为由signapk预期

3.openssl **pkcs8 -topk8 -outform DER -in private.rsa.pem -inform PEM -out private.pk8 -nocrypt**

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-10-04T12:40:21.297

我找到了一个非常有趣的解决方案：

[http://www.swview.org/node/191](http://www.swview.org/node/191)

然后，我将公钥/私钥对分成两个文件 private.key publi.pem 并且它可以工作！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-04-27T13:41:54.777

如果您没有安装 openssl 并且您正在寻找一个快速的解决方案，有一个名为[portcle](http://portecle.sourceforge.net/)的软件非常有用且下载量很小。

缺点是据我所知没有命令行。但是从 GUI 中，导出 PEM 私钥非常简单：

1.  打开你的 JKS 密钥库
2.  右键单击您的私钥条目并选择导出
3.  选择私钥和证书以及 PEM 格式

    [![使用 Portcle 从 JKS 导出 PEM 私钥](https://i.stack.imgur.com/aB3te.png)](https://i.stack.imgur.com/aB3te.png)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-17T03:46:56.697

好吧， OpenSSL 应该从 #12 文件[中轻松完成：](http://gagravarr.org/writing/openssl-certs/general.shtml)

```
openssl pkcs12 -in pkcs-12-certificate-file -out pem-certificate-file
openssl pkcs12 -in pkcs-12-certificate-and-key-file -out pem-certificate-and-key-file 
```

也许有关错误/失败的更多详细信息？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-03-10T20:07:08.340

试试 Keystore Explorer [http://keystore-explorer.org/](http://keystore-explorer.org/)

KeyStore Explorer 是 Java 命令行实用程序 keytool 和 jarsigner 的开源 GUI 替代品。它也确实是 openssl/pkcs12。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-03-10T07:09:47.733

首先创建密钥库文件为

C:\Program Files\Android\Android Studio\jre\bin> **keytool -keystore androidkey.jks -genkeypair -alias androidkey**

输入密钥库密码：
重新输入新密码：
您的名字和姓氏是什么？未知： **FirstName LastName**
您的组织单位的名称是什么？未知： **移动开发**
贵组织的名称是什么？未知： **您的公司名称**
您所在城市或地区的名称是什么？您所在的州或省的名称是什么？
本机的两个字母的国家/地区代码是什么？未知：IN //按回车

> 现在它会要求确认

CN=FirstName LastName、OU=Mobile Development、O=your company name、L=CityName、ST=StateName、C=IN 是否正确？[否]： **是的**

输入密钥密码（如果与密钥库密码相同，则返回）：如果您想要相同的密码，请按 Enter

> 密钥已生成，现在您可以使用以下命令简单地获取 pem 文件

C:\Program Files\Android\Android Studio\jre\bin> **keytool -export -rfc -alias androidkey -file android_certificate.pem -keystore androidkey.jks**
输入密钥库密码：
证书存储在文件中

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-10-17T10:45:10.707

我只留下以下两个命令来完成这项工作

```
# openssl pkcs12 -info -nodes -in /srv/apache-tomcat-8.5.72/conf/cert.jks -nokeys 2>&1| sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > server.crt
Enter Import Password:
# openssl pkcs12 -info -nodes -in /srv/apache-tomcat-8.5.72/conf/cert.jks -nocerts 2>&1| sed -ne '/-BEGIN PRIVATE KEY-/,/-END PRIVATE KEY-/p' > server.key
Enter Import Password: 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-02-03T13:22:47.110

打开您的终端并转到 jks 文件位置并写下这个 >>>> keytool -export -rfc -alias key0 -file android_certificate.pem -keystore androidkey.jks

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2018-08-31T09:44:22.517

> 将 Java 密钥库转换为 PEM 格式

最准确的答案必须是这是不可能的。

Java 密钥库只是加密密钥**和**证书的存储工具，而 PEM 只是 X.509 证书的文件格式。

# jquery - 在 jQuery 中，我想删除 div 中的所有 HTML

> ID：652917
> 
> 赞同：75
> 
> 时间：2009-03-17T03:17:41.463
> 
> 标签：jquery

我有一个 div，我想删除该 div 中的所有 HTML。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2009-03-17T03:18:42.207

你想使用[空](http://docs.jquery.com/Manipulation/empty)函数：

```
$('#mydiv').empty(); 
```

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2009-03-17T10:39:40.323

我不认为`empty()`或者`html()`是你正在寻找的东西。我猜你正在寻找类似`strip_tags`PHP 的东西。如果要执行此操作，则需要添加此功能：

```
jQuery.fn.stripTags = function() {
    return this.replaceWith( this.html().replace(/<\/?[^>]+>/gi, '') );
}; 
```

假设这是您的 HTML：

```
<div id='foo'>This is <b>bold</b> and this is <i>italic</i>.</div> 
```

然后你做：

```
$("#foo").stripTags(); 
```

这将导致：

```
<div id='foo'>This is bold and this is italic.</div> 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-17T06:03:11.003

另一种方法是将 html 设置为空字符串：

```
$('#mydiv').html(''); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-05T11:45:13.157

```
var htmlJ = $('<p><span>Test123</span><br /><a href="http://www.google.com">goto Google</a></p>');
console.log(htmlJ.text()); // "Test123goto Google" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-13T18:40:26.620

```
 function stripsTags(text)
  {
    return $.trim($('<div>').html(text).text());
  } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-04-30T20:00:16.263

假设你有一个这样的 html

```
<div class="prtDiv">
   <div class="first">
     <div class="hello">Hello</div>
     <div class="goodbye">Goodbye</div>
  </div>
</div> 
```

如果您希望永久删除“第一个”div 下的所有 html。就用这个

```
$('.first').empty(); 
```

结果会是这样

```
<div class="prtDiv">
   <div class="first">

  </div>
</div> 
```

对于临时（如果您想再次添加它们），我们可以尝试像 detach()

```
$('.first').detach(); 
```

# c# - c# 使用算子进行计算（净工资）（总工资）

> ID：652928
> 
> 赞同：-2
> 
> 时间：2009-03-17T03:24:40.227
> 
> 标签：c#

我不明白如果计算`netPay = grossPay - (fedtax withholding + social security tax withholding)`. 我的计算在程序中是否正确？处理这样的`editedTax`？？如果有人可以提供帮助，我将不胜感激。

**更多信息**：当我`netPay`在输出中显示时，我收到一个运行时错误，我无法将负数转换为货币`{0:c2}`。

```
using System;
using System.Collections.Generic;
using System.Text;

namespace ConsoleApplication5
{
    class Program
    {
        static void Main(string[] args)
        {
            string empName;
            string userInput;

            double netPay;
            double editedTax1;
            double grossPay;
            double editedTax2;
            double hrsWorked;
            double ovtWorked;
            double payRate;

            const double FED_TAX = .28;
            const double SS_TAX = 7.65;

            // step 1
            Console.WriteLine("       WEEKLY PAYROLL INFORMATION");

            // step 2
            Console.WriteLine("       --------------------------");

            // step 3
            Console.Write("\n       Please enter the employer's name: ");
            empName = Console.ReadLine();

            //step 4
            Console.Write("\n       Please enter the number of hours worked this week: ");
            userInput = Console.ReadLine();
            hrsWorked = Convert.ToDouble(userInput);

            // step 5
            Console.Write("\n       Please enter the number of OVERTIME HOURS worked this week: ");
            userInput = Console.ReadLine();
            ovtWorked = Convert.ToInt32(userInput);

            // step 6
            Console.Write("\n       Please enter employee's HOURLY PAY RATE: ");
            userInput = Console.ReadLine();
            payRate = Convert.ToDouble(userInput);

            // step 7
            grossPay = (hrsWorked * payRate + ovtWorked * 1.5 * payRate);

            // step 8
            editedTax1 = FED_TAX * grossPay;

            // step 9
            editedTax2 = SS_TAX * grossPay;

            // step 10
            netPay = editedTax1 + editedTax2 - grossPay;

            // step 11
            Console.WriteLine("\n\n       The weekly payroll information summary for: " + empName);

            Console.WriteLine("\n       Gross pay:                             {0:C2}    ", grossPay);

            // step 12
            Console.WriteLine("       Federal income taxes witheld:          {0:C2}      ", editedTax1);
            Console.WriteLine("       Social Security taxes witheld:         {0:C2}    ", editedTax2);
            Console.WriteLine("       Net Pay:                               {0:C2}", netPay);

        }
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T03:30:51.930

`netPay`与您在下面的描述相比，在代码中分配了相反的值。
我没有看到任何语法错误或任何东西。

你有什么问题？你尝试过哪些事情？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T03:58:35.263

您在计算中得到负数的原因是您的 SS_TAX 是 7.65。我认为你想要的数字是 0.0765。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T03:33:58.880

我不确定您到底要什么，但是赋值语句中的简单替换会产生以下公式：

自从

```
editedTax1 = FED_TAX * grossPay;

editedTax2 = SS_TAX * grossPay;

netPay = editedTax1 + editedTax2 - grossPay; 
```

然后

```
netPay = FED_TAX * grossPay + SS_TAX * grossPay - grossPay; 
```

意义

```
netPay = grossPay * (FED_TAX + SS_TAX - 1); 
```

所以这里似乎有点不对劲......

* * *

你确定你不想

```
netPay = grossPay - (editedTax1 + editedTax2); 
```

代替

```
netPay = editedTax1 + editedTax2 - grossPay; 
```

这似乎与您要查找的内容相匹配

```
netPay = grossPay - (FED_TAX * grossPay + SS_TAX * grossPay); 
```

或者

```
netPay = grossPay * (1 - (FED_TAX + SS_TAX)); 
```

...当然，除非我错过了什么。

* * *

编辑：我错过了一些东西。您的税收常数是一个百分比，但是当您使用它们进行计算时，您并没有除以 100。你有两个选择：

1.  在计算中使用值时除以 100，例如：

    `editedTax1 = (FED_TAX / 100) * grossPay;`

2.  将常量存储为十进制表示，而不是百分比，例如：

    `const double FED_TAX = .0028;`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T04:32:50.377

我已经在我的机器上测试了这段代码，它工作正常：

```
using System;
using System.Collections.Generic;
using System.Text;

namespace ConsoleApplication5
{
    class Program
    {
        static void Main(string[] args)
        {
            const double FEDERAL_TAX_RATE= 0.28;
            const double SOCIAL_SECURITY_RATE = 0.0765;  // I am assuming the 7.65 was supposed to be 7.65%... therefore it should be 0.0765

            Console.WriteLine("       WEEKLY PAYROLL INFORMATION");
            Console.WriteLine("       --------------------------");
            Console.Write("\n       Please enter the employer's name: ");
            string empName = Console.ReadLine();
            Console.Write("\n       Please enter the number of hours worked this week: ");
            double hrsWorked = Convert.ToDouble(Console.ReadLine());
            Console.Write("\n       Please enter the number of OVERTIME HOURS worked this week: ");
            double ovtWorked = Convert.ToInt32(Console.ReadLine());
            Console.Write("\n       Please enter employee's HOURLY PAY RATE: ");
            double payRate = Convert.ToDouble(Console.ReadLine());
            double grossPay = CalculateGrossPay(hrsWorked, payRate, ovtWorked);
            double federalTaxWithheld = CalculateTax(grossPay, FEDERAL_TAX_RATE);
            double socialSecurityWithheld = CalculateTax(grossPay, SOCIAL_SECURITY_RATE);
            double netPay = CalculateNetPay(grossPay, federalTaxWithheld + socialSecurityWithheld);

            Console.WriteLine("\n\n       The weekly payroll information summary for: " + empName);
            Console.WriteLine("\n       Gross pay:                             {0:C2}    ", grossPay);
            Console.WriteLine("       Federal income taxes witheld:          {0:C2}      ", federalTaxWithheld);
            Console.WriteLine("       Social Security taxes witheld:         {0:C2}    ", socialSecurityWithheld);
            Console.WriteLine("       Net Pay:                               {0:C2}", netPay);

            Console.ReadLine();  // You don't need this line if your running from the command line to begin with
        }

        static double CalculateGrossPay(double HoursWorked, double PayRate, double OvertimeHoursWorked)
        {
            return PayRate * (HoursWorked + 1.5 * OvertimeHoursWorked);
        }

        static double CalculateTax(double GrossPay, double TaxRate) 
        {
            return GrossPay * TaxRate;
        }

        static double CalculateNetPay(double GrossPay, double TaxAmount)
        {
            return GrossPay - TaxAmount;
        }
    }
} 
```

由于这似乎是您的第一门编程课程，因此我将为您提供一些他们可能不会在您的课程中强调的指针：

*   使用描述性变量名称。如果您发现自己在变量名后面加上了一个数字，那么它可能会采用一种不同且更具可读性的方式！
*   利用函数，它们将常见任务捆绑在一段代码中，并显着提高了可读性。
*   您可能希望在此代码中添加一些[异常处理](http://msdn.microsoft.com/en-us/library/ms229005.aspx)或验证。例如，如果您不小心`-1`进入了`OverTimeHours`怎么办？

我知道这在您的编程之旅中可能并不重要，但是开始使用使您的代码更具可读性和更少混乱的编码技术总是好的，特别是对于将来可能需要维护它的人。

# sql - 如何添加外键关系？

> ID：652929
> 
> 赞同：2
> 
> 时间：2009-03-17T03:24:47.733
> 
> 标签：sql, sql-server-2005, foreign-keys, data-integrity

我正在使用未使用表之间的 FK 关系实现的现有 SQL 2005 数据库。我尝试添加与数据库图的关系，但我的应用程序在尝试编辑或插入与新 FK 相关的任何数据时立即崩溃。

```
dbo.person [person_id | firstname | lastname | dateofbirth]
dbo.campaign [campaign_id | campaign_description]
dbo.disposition [disposition_id | disposition_description]
dbo.person_campaigns [person_campaign_id | person_id | campaign_id | disposition_id] 
```

person_campaigns 表是将人员、活动和处置联系在一起的地方。您能否提供适当的 SQL 语法以在这些实体之间添加正确的 FK 关系？

**编辑**

```
CREATE TABLE [dbo].[person_campaigns](
    [person_campaigns_id] [int] IDENTITY(1,1) NOT NULL,
    [person_id] [int] NOT NULL,
    [d_campaign_id] [int] NOT NULL,
    [d_physician_disposition_id] [int] NULL,
 CONSTRAINT [PK_person_campaigns] PRIMARY KEY CLUSTERED 
(
    [person_campaigns_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

CREATE TABLE [dbo].[d_campaign](
    [d_campaign_id] [int] IDENTITY(1,1) NOT NULL,
    [name] [varchar](50) NULL,
    [year] [int] NULL,
    [isactive] [bit] NOT NULL,
 CONSTRAINT [PK_d_campaign] PRIMARY KEY CLUSTERED 
(
    [d_campaign_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [dbo].[d_campaign] ADD  CONSTRAINT [DF_d_campaign_isactive]  DEFAULT ((1)) FOR [isactive]
GO

CREATE TABLE [dbo].[d_disposition](
    [d_disposition_id] [int] IDENTITY(1,1) NOT NULL,
    [name] [varchar](50) NULL,
    [isactive] [bit] NOT NULL,
 CONSTRAINT [PK_d_disposition] PRIMARY KEY CLUSTERED 
(
    [d_disposition_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [dbo].[d_disposition] ADD  CONSTRAINT [DF_d_disposition_isactive]  DEFAULT ((1)) FOR [isactive]
GO

CREATE TABLE [dbo].[person](
    [person_id] [int] IDENTITY(1,1) NOT NULL,
    [firstname] [varchar](30) NULL,
    [lastname] [varchar](30) NULL,
    [dateofbirth] [datetime] NULL
 CONSTRAINT [PK__person__0BC6C43E] PRIMARY KEY CLUSTERED 
(
    [person_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T04:13:52.917

最简单的方法是通过数据库图表编辑器；一次做一个并保存图表以在每次连接后影响表格。如果它“炸毁”，很可能是因为表包含不存在的外键值；你必须先清理这些。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T04:02:59.653

如果您必须在创建表后添加它们，则语法为

```
 create table  person (person_id int primary key 
,firstname varchar(10)
, lastname varchar(10)
, dateofbirth varchar(10))

create table campaign (campaign_id int primary key
, campaign_description varchar(10))
create table  disposition (disposition_id int primary key  
,disposition_description varchar(10))

create table person_campaigns(person_campaign_id int
,person_id int, campaign_id int ,disposition_id int)
go
alter table person_campaigns  add Constraint 
fk_person_campaigns_person_id
Foreign Key (person_id) References person(person_id)
GO

alter table person_campaigns add Constraint 
fk_person_campaigns_campaign_id
Foreign Key (campaign_id) References campaign(campaign_id)
GO

alter table person_campaigns add Constraint
fk_person_campaigns_disposition_id
Foreign Key (disposition_id) References disposition(disposition_id) 

GO 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T14:41:29.510

假设我有两个应该有外键但没有的表。首先要做的是检查如果我设置外键是否会出现数据问题。

类似于以下代码的内容将为您提供子表中在父表中没有匹配项的记录。

```
select t2.FKField, t2.PKfield from table2 t2
left join Table1 t1 on t2.fkfield = t1.pkfield
where t1.pkfield is null 
```

一旦您可以看到现有数据有什么问题，那么您需要创建一种方法来修复它。修复将根据您拥有的与父表无关的数据以及表所代表的内容而有所不同。假设您的父表包含汽车的 VIN 号作为 PK。如果您的子表包含该商店处理的汽车，则您可能希望通过将不存在的 VINS 添加到主表来解决此问题，因为您不想丢失所处理内容的历史记录。在其他结构中，您可能只想删除子表中不匹配的记录，因为它们没有意义。在其他情况下，您可能希望将这些记录更新为某个默认值（可能是客户表中称为未知的客户）。在其他情况下，您可能需要转到审计表或备份以查找在未删除关联子记录的情况下删除的 PK 的值。解决此问题的实际方法在很大程度上取决于数据的用途以及保留所有历史记录的重要性。由于您永远不应该出于法律（和会计）原因删除任何可能与金融交易相关的记录，因此您需要非常小心。

修复所有数据后，运行代码来创建 FK 约束。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T03:46:33.640

由于我在这台 PC 上没有 SQL Server 并且我不记住语法，所以最简单的方法是创建两个新的测试表，使用 ID 字段创建 TableA，使用 TableA 的 FK 字段创建 TableB .ID，然后编写 TableB 以查看 ADD CONSTRAINT 语法。通过数据库图使用 SQL Server Management Studio 执行此操作。

但是，如果您能够在数据图中成功创建 FK，并且您只能添加或更新记录，我相信还有其他问题。编写 person_campaigns 表并发布代码。

# ruby-on-rails - Rails：从一个查询中搜索多个表

> ID：652933
> 
> 赞同：3
> 
> 时间：2009-03-17T03:26:38.103
> 
> 标签：ruby-on-rails, search

如何编写条件语句`find`或`paginate`方法以允许用户同时搜索`Project`和`Project Category`命名？

现在我的代码看起来像这样

```
@projects = Project.paginate :per_page => 20, :page => params[:page], :conditions => ['name LIKE ?', "%#{params[:search]}%"] 
```

所以我也有`Category`带`name`字段的表。如何`name`在此搜索查询中将这两个 s 组合在一起？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T04:11:07.480

假设您的`Project`模型`has_many :categories`：

> `@projects = Project.paginate :per_page => 20, :page => params[:page], :joins => :categories, :conditions => ['projects.name LIKE ? OR categories.name LIKE ?', "%#{params[:search]}%", "%#{params[:search]}%"], :order => 'projects.id DESC'`

`:order`如果/根据需要更改上述内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T03:35:16.083

我会做：

```
@categories = Category.find :conditions => ["name like ?", "%#{params[:search]}%"] 
```

连接@projects 和@categories，然后将结果作为最终的搜索结果列表。

# sharepoint - Sharepoint 2007 模板到站点定义的转换

> ID：652935
> 
> 赞同：1
> 
> 时间：2009-03-17T03:27:18.567
> 
> 标签：sharepoint, sharepoint-2007

有没有办法（半）自动将 sharepoint 2007 站点模板转换为站点定义？这似乎比从头开始构建站点定义更快，但提供了站点定义的好处。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T09:22:31.897

我认为使用[VSeWSS 1.2](http://blogs.msdn.com/sharepoint/archive/2008/06/04/announcing-the-vsewss-version-1-2.aspx)，您可以将站点转换为站点定义。

摘自 SharePoint 团队博客上的 VSeWSS 1.2 公告：

> **SharePoint 解决方案生成器** 此独立程序从现有的 SharePoint 站点生成站点定义项目。该程序使开发人员能够使用浏览器和 Microsoft Office SharePoint Designer 在使用 Visual Studio 创建代码之前自定义其网站的内容。

因此，从站点模板创建站点然后运行 ​​VSeWSS 1.2 应该可以解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-11T07:38:21.933

一种方法是将站点模板 (.stp) 文件重命名为 .cab 并提取内容并获取 onet.xml 架构并根据需要对其进行自定义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T16:21:46.710

您要转换的网站模板使用了哪个定义？我发现 SharePoint 解决方案生成器很受欢迎。例如，我无法让它处理博客网站。不过值得一试。

# c# - 在 MonoDevelop 中读取控制台输入

> ID：652936
> 
> 赞同：19
> 
> 时间：2009-03-17T03:27:47.350
> 
> 标签：c#, monodevelop

我正在尝试一个简单的 C# 程序，它接受输入并将其作为输出传递。例如，输出应该是：

```
What is your name?
{user input}
Your name is {user input} 
```

该程序是：

```
public static void Main(string[] args)
{
    Console.WriteLine("What is your name?");
    string name = Console.ReadLine();
    Console.WriteLine("Your name is: " + name);
    Console.ReadKey();
} 
```

这包含在一个名为“MainClass”的类中

它的输出是：

```
What is your name?
Your name is: 
```

为什么这不起作用，我怎样才能使它起作用？

PS 我正在使用 MonoDevelop 并添加了 Console.ReadKey(); 在最后一个 WriteLine 之后。没变。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-11T20:38:45.793

您正尝试在 MonoDevelop 的应用程序输出窗口中输入，它是只读的。

您可以通过右键单击项目的“选项”菜单项并在树下检查，将 MonoDevelop 配置为在命令提示符下自动运行`Run on external console`程序`Run > General`。

[替代文字 http://psf.biz/public/monodevelop_run_on_external_console.jpg](http://psf.biz/public/monodevelop_run_on_external_console.jpg)

我猜那个给我-1的人被那个巨大的“在我的机器上工作”标志蒙蔽了，但这*是*正确且唯一的答案。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T03:32:38.010

![在我的机器上工作](https://codinghorror.typepad.com/.a/6a0120a85dcdae970b0128776ff992970c-pi)

您的问题是程序在读取控制台输入后立即退出吗？如果是这样，则`Console.ReadKey();`在最后一个之后添加一个，`WriteLine`以便程序等待按键。否则，我不知道问题是什么；我复制+粘贴了代码，它起作用了。

# apache2 - Windows/Apache2.2环境下的Windows loginID帮助

> ID：652937
> 
> 赞同：0
> 
> 时间：2009-03-17T03:27:53.997
> 
> 标签：apache2, cgi, single-sign-on, windows-authentication, ntlm

我真的可以使用一些帮助来解决看似微不足道的问题。总之，我想知道在 Windows 环境中访问在 Apache 中运行的 Perl .cgi 的用户的 Window 登录 ID。

这是我的基本 Apache2 conf 添加：

---- 开始 httpd.conf -----

```
...

LoadModule sspi_auth_module modules/mod_auth_sspi.so
...
<IfModule mod_auth_sspi.c>
    <Location "C:/Program Files/Apache Software Foundation/Apache2.2/cgi-bin">
        AuthName "A Protected Place"
        AuthType SSPI
        SSPIAuth On
        SSPIAuthoritative On
        #SSPIBasic On
        SSPIOfferBasic On
        #SSPIDomain On
        #SSPIBasicPreferred
        #SSPIUsernameCase lower
        require valid-user
    </Location>
</IfModule>
...
<Directory "C:/Program Files/Apache Software Foundation/Apache2.2/cgi-bin">
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>
... 
```

---- 结束 httpd.conf -----

此外，我还使用以下出色说明在我的机器上启用了 SSL：http: [//tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-serversetup.html#tsvn-serversetup-apache-7](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-serversetup.html#tsvn-serversetup-apache-7)

上面的站点要求加载 Apache 模块 mod_auth.so，但我在我的默认 Apache2 安装中找不到它。此外，如您所见，我已将 mod_auth_sspi-1.0.4-2.2.2 模块手动添加到我的 Apache2 环境中。

现在，当我同时尝试**[http://localhost/cgi-bin/test.cgi](http://localhost/cgi-bin/test.cgi)**和**[https://localhost/cgi-bin/test.cgi](https://localhost/cgi-bin/test.cgi)**时，我在 http/ 中看不到 REMOTE_USER 的任何内容环境变量。我知道 SSL 正在工作，因为 https 调用显示了大量 SSL 变量。另外，我对 SSL 没有要求，但我只使用它，因为上面的链接说它是获取 Windows 登录信息所必需的。

我真的很感激任何见解。如果有帮助，我很乐意完整分享 httpd.conf 文件。基本上，重申一下，我正在寻找的只是一种在 Windows/Apache2.2 托管环境中捕获我的 Perl .cgi 中的 Windows loginID 的方法。

非常感谢大家的帮助，

猎犬加尼

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T17:27:34.257

这可能没有太大帮助，但我认为您不需要做任何特别的事情来获取这些信息。我正在使用 mod_auth_sspi 运行 Apache 2.2 安装，并使用 REMOTE_USER 环境变量成功获取您正在寻找的信息。（例如，当我访问其中一个页面时，REMOTE_USER 是“MYDOMAIN\oeuftete”。）

我不使用 SSPIOfferBasic 选项，这是唯一实质性的配置差异，但我认为这无关紧要。我还在指令中指定选项，而不是在单独的指令中。

我想我的意思是，根据你给出的，它*应该*有效。所以也许还有其他事情发生。

* * *

编辑：这是我的 httpd.conf 的基础知识。

```
LoadModule sspi_auth_module modules/mod_auth_sspi.so

<IfModule mime_module>
    AddHandler cgi-script .pl
</IfModule>

<IfModule alias_module>
    Alias /sotest "C:/Some/path/"
</IfModule>

<Directory "C:/Some/path">
    Options ExecCGI

    Order allow,deny
    Allow from all

    AuthName "Foo"
    AuthType SSPI
    SSPIAuth On
    SSPIAuthoritative On

    require valid-user
</Directory> 
```

以及该目录中的简短 test.pl。

```
#!perl -T
#

use CGI;

my $q = CGI->new;

print $q->header;
print $q->start_html;
print $ENV{'REMOTE_USER'};
print $q->end_html; 
```

这是转到 sotest/test.pl 的结果页面：

```
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<title>Untitled Document</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
</head>
<body>
MYDOMAIN\oeuftete
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-17T03:45:57.837

不是 Windows 程序员，所以我不确定 loginID 是什么，但也许 [Win32::LoginName 和 Win32::LookupAccountName](http://search.cpan.org/perldoc/Win32)会有所帮助？

# web-applications - 用于对大型列表进行排序的 UI 隐喻

> ID：652939
> 
> 赞同：2
> 
> 时间：2009-03-17T03:28:20.297
> 
> 标签：web-applications, user-interface

作为 Web 应用程序的一部分，我有一个需要按任意顺序排序的项目队列。

如果有几个项目（比如少于 20 个），我可以将其显示为一个列表，并让用户拖放行来设置排序顺序。

但是，如果我有很多项目（例如，超过 100 个）怎么办？是否有任何现有的隐喻可以对这样的大列表进行排序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T04:04:08.497

我在以前的应用程序中遇到过类似的事情，我发现最好的解决方案是分层组织事物，并让用户一次对不同级别的事物进行排序。

# mysql - 针对此特定场景的 MySQL 连接

> ID：652948
> 
> 赞同：-1
> 
> 时间：2009-03-17T03:34:16.133
> 
> 标签：mysql, join

我在使用 MySQL 连接时遇到问题。

### `Table_A`：

```
 A_id  Cost1  A1_id  Cost2
 1     500     0     200
 1     100     1     100
 1     50      2      60
 1     10      3      50
 2      5      0      10 
```

### `Table_B`（参考`B_id`：来自`Table_A` `A1_id`）：

```
 B_id  FName  LName
 1     X      A
 2     Y      B
 3     Z      C 
```

### `Table_C`（参考`C_id`：来自`Table_A` `A_id`）：

```
C_id  Towns

 1    Atlanta
 2    NewYork 
```

我需要合并所有三个表，如以下输出：

*   我提取了`Towns`那个匹配`(Table_A.A_id=Table_C.C_id)`。
*   我提取了`Fname`，`Lname`那个匹配`(table_A.A1_id=Table_b.b_id)`。
*   我需要跳过`Towns`if `A1_id != 0`。
*   我需要跳过`Fname`, `Lname`if `A1_id == 0`。

剩余的数据可能是一个值或空值，我将其指定为“#”。对于给定的场景，什么是有效的 MySQL 查询？

### 输出：

```
A_id  Cost1  A1_id cost2 Fname Lname Towns
1     500     0    200    #     #    Atlanta
1     100     1    100    X     A     #
1      50     2     60    Y     B     #
1      10     3     50    Z     C     # 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T03:45:05.110

我认为应该是这样的。

```
select A_id, Cost1,  A1_id, cost2, Fname, Lname, Towns
from Table_A
left join Table_B on table_A.A1_id = Table_b.b_id
left join Table_C on Table_A.A_id  = Table_C.C_id 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T07:03:48.157

对我来说，这看起来像是两个不同查询的 UNION。我将假设 ID 列从不包含负值。

```
SELECT A.A_id, A.Cost1, A.A1_id, A.Cost2, B.Fname, B.Lname, C.Town
    FROM Table_A AS A
              INNER JOIN Table_B AS B ON A.A1_id = B.B_id
         LEFT OUTER JOIN Table_C AS C ON A.A_id  = C.C_id
    WHERE A.A1_id != 0
      AND C.C_id < 0
UNION
SELECT A.A_id, A.Cost1, A.A1_id, A.Cost2, B.Fname, B.Lname, C.Town
    FROM Table_A AS A
         LEFT OUTER JOIN Table_B AS B ON A.A1_id = B.B_id
              INNER JOIN Table_C AS C ON A.A_id  = C.C_id
    WHERE A.A1_id = 0
      AND B.B_id < 0; 
```

我对这个提法并不完全有信心。B.B_id < 0 和 C.C_id < 0 的条件有可能需要与相应的 ON 子句相关联。

还有一个不错的机会是，在单个 SELECT 中使用两个左外连接和适当的 OR'd 过滤器可以获得正确的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T03:38:58.807

如果我理解正确的话，应该是：

```
select fname, lname, towns
from table_a, table_b table_c
where table_a.a_id = table_c.c_id
  and table_a.a1_id = table_b.b_id
  and table_a.a1_id <> 0; 
```

# air - 如何将项目异步添加到 Adob e AIR 中的本机上下文菜单？

> ID：652950
> 
> 赞同：0
> 
> 时间：2009-03-17T03:35:55.367
> 
> 标签：air

一旦调用了本机上下文菜单，我需要从一组远程服务调用中填充它。然而，当前的实现需要在打开菜单之前设置项目。

有任何想法吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T05:59:07.087

编辑：我再次重新阅读了您的问题，并意识到您想在打开菜单时更新菜单，而不是在打开菜单之前。您可以侦听另一个名为[显示](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/NativeMenu.html#event:displaying)的事件，但在我使用 HTML/JS 测试应用程序完成的测试中，似乎该事件没有触发。如果您使用的是 Flex，您可以对此进行调查，或者找出我是否在这里做错了什么：

```
 window.htmlLoader.contextMenu = new air.NativeMenu();
    menu1 = new air.NativeMenu();
    loading=new air.NativeMenuItem("Loading...");
    menu1.addItem(loading);
    menu1.addEventListener(air.Event.DISPLAYING, addMenu1Items);
    function addMenu1Items(){
        menu1.removeItem(loading);
        item11 = new air.NativeMenuItem("Item 1");
        item11.addEventListener(air.Event.SELECT, function(e){alert("You clicked Menu 1,Item 1");e.preventDefault();});

        item12 = new air.NativeMenuItem("Item 2");
        item12.addEventListener(air.Event.SELECT, function(e){alert("You clicked Menu 1,Item 2");e.preventDefault();});

        menu1.addItem(item11);
        menu1.addItem(item12);
    } 
```

我刚刚使用 HTML / Javascript 应用程序进行了测试，以下内容似乎对我有用（无耻地从以下位置撕下和修改：http: [//www.adobe.com/devnet/air/ajax/quickstart/adding_menus.html](http://www.adobe.com/devnet/air/ajax/quickstart/adding_menus.html)如果您碰巧使用的是 Flex，那么还有一个版本：http: [//www.adobe.com/devnet/air/flex/quickstart/adding_menus.html](http://www.adobe.com/devnet/air/flex/quickstart/adding_menus.html)）。

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Context</title>
    <script src="lib/air/AIRAliases.js" language="JavaScript" type="text/javascript"></script>
    <script type="text/javascript">
        window.htmlLoader.contextMenu = new air.NativeMenu();
        menu1 = new air.NativeMenu();

        item11=new air.NativeMenuItem("Item 1");
        item11.addEventListener(air.Event.SELECT,function(e){alert("You clicked Menu 1,Item 1");e.preventDefault();});

        item12=new air.NativeMenuItem("Item 2");
        item12.addEventListener(air.Event.SELECT,function(e){alert("You clicked Menu 1,Item 2");e.preventDefault();});

        menu1.addItem(item11);
        menu1.addItem(item12);

        menu2 = new air.NativeMenu();
        item21=new air.NativeMenuItem("Item 1");
        item21.addEventListener(air.Event.SELECT,function(e){alert("You clicked Menu 2,Item 1");e.preventDefault();});

        item22=new air.NativeMenuItem("Item 2");
        item22.addEventListener(air.Event.SELECT,function(e){alert("You clicked Menu 2,Item 2");e.preventDefault();});

        menu2.addItem(item21);
        menu2.addItem(item22);

        window.htmlLoader.contextMenu.addSubmenu(menu1,"Menu 1");
        window.htmlLoader.contextMenu.addSubmenu(menu2,"Menu 2");

        //Displays the context menu
        function showContextMenu(event){
            event.preventDefault();
            window.htmlLoader.contextMenu.display(window.nativeWindow.stage, event.clientX, event.clientY);
        }

        function addItemToContextMenu(){
            menux = new air.NativeMenu();
            item=new air.NativeMenuItem("Item &1");
            item.addEventListener(air.Event.SELECT,function(e){alert("You clicked Menu X,Item 1");e.preventDefault();});
            menux.addItem(item);
            menux.addItem(new air.NativeMenuItem("Item &2"));
            window.htmlLoader.contextMenu.addSubmenu(menux,"Menu X");
        }

        function clearAndAdd() {
            window.htmlLoader.contextMenu = new air.NativeMenu();
            addItemToContextMenu();
        }
    </script>
</head>
<body id="body">
<div id="contextDiv"  oncontextmenu="showContextMenu(event)">
Right click to bring up the context menu.<br><br>
<input type="button" value="Add Item To Context Menu" onclick="addItemToContextMenu()"><input type="button" value="Clear Menu and Add Item to Context Menu" onclick="clearAndAdd();">
</div>
</body>
</html> 
```

# lucene - 使用 MultiFieldQueryParser

> ID：652956
> 
> 赞同：1
> 
> 时间：2009-03-17T03:40:15.510
> 
> 标签：lucene, lucene.net

我正在使用 MultiFieldQueryParser 来解析 aa、bb 等字符串但是在解析之后，它会删除字符串中的点。我在这里想念什么？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T03:47:47.303

我不确定 MultiFieldQueryParser 是否按照您的想法执行。另外...我不确定我知道您要做什么。

我确实知道，对于任何查询解析器，像“aa”和“bb”这样的字符串都会去掉句点，因为至少在默认的分析器中，所有标点符号都被视为空格。

就 MultiFieldQueryParser 而言，这只是一个允许您指定多个默认字段进行搜索的 QueryParser。所以用查询

> 标题：“人鼠之间”“约翰·斯坦贝克”

将在所有默认字段中查找字符串“John Steinbeck”，而仅在标题字段中搜索“Of Mice and Men”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T03:46:17.633

您的解析器使用什么分析器？如果它是 StopAnalyzer，那么该点可能是一个停用词，因此被忽略。如果它是清理输入（包括删除点）的 StandardAnalyzer，也是如此。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T14:52:24.827

[（重复我从骗子](https://stackoverflow.com/questions/660298/multifieldqueryparser-is-removing-dots-from-the-acronym)的回答。应该删除其中之一）。

专门处理首`StandardAnalyzer`字母缩略词，并将 CFA（例如）转换为 cfa。这意味着您应该能够进行搜索，只要您确保使用相同的分析器进行索引和查询解析。

我建议您运行一些更基本的测试用例来消除其他因素。尝试使用普通用户`QueryParser`而不是多字段用户。

这是我写的一些代码来玩`StandardAnalyzer`：

```
StringReader testReader = new StringReader("C.F.A. C.F.A word");
StandardAnalyzer analyzer = new StandardAnalyzer();
TokenStream tokenStream = analyzer.tokenStream("title", testReader);
System.out.println(tokenStream.next());
System.out.println(tokenStream.next());
System.out.println(tokenStream.next()); 
```

顺便说一下，这个输出是：

```
(cfa,0,6,type=<ACRONYM>)
(c.f.a,7,12,type=<HOST>)
(word,13,17,type=<ALPHANUM>) 
```

请注意，例如，如果首字母缩略词不以点结尾，则分析器会假定它是 Internet 主机名，因此搜索“CFA”将不会匹配文本中的“CFA”。

# lua - 如何在 Lua 中获取哈希表中的键数？

> ID：652957
> 
> 赞同：44
> 
> 时间：2009-03-17T03:40:56.430
> 
> 标签：lua, hashtable

```
myTable = {}
myTable["foo"] = 12
myTable["bar"] = "blah"
print(#myTable) -- this prints 0 
```

我真的必须遍历表中的项目来获取键的数量吗？

```
numItems = 0
for k,v in pairs(myTable) do
    numItems = numItems + 1
end
print(numItems) -- this prints 2 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-17T04:01:11.450

我尝试了 # 运算符和 table.getn()。我认为 table.getn() 会做你想做的事，但事实证明它返回的值与 # 相同，即 0。字典似乎在必要时插入了 nil 占位符。

循环遍历键并计算它们似乎是获取字典大小的唯一方法。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T04:07:54.697

[长度运算符：](http://www.lua.org/manual/5.1/manual.html#2.5.5)

> 表 t 的长度被定义为任何整数索引 n，使得 t[n] 不为 nil 且 t[n+1] 为 nil；此外，如果 t[1] 为 nil，则 n 可以为零。对于从 1 到给定 n 的非 nil 值的常规数组，它的长度正好是 n，它的最后一个值的索引。如果数组有“洞”（即其他非 nil 值之间的 nil 值），那么 #t 可以是直接在 nil 值之前的任何索引（也就是说，它可以将任何这样的 nil 值视为结束的数组）。

所以获得长度的唯一方法是迭代它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-11-03T18:35:18.827

除了手动迭代键之外，通过元方法自动跟踪它很简单。考虑到您可能不想跟踪您创建的每个表，您可以编写一个函数，允许您将任何表转换为键可数对象。以下内容并不完美，但我认为它可以说明这一点：

```
function CountedTable(x)
  assert(type(x) == 'table', 'bad parameter #1: must be table')

  local mt = {}
  -- `keys`  will represent the number of non integral indexes
  -- `indxs` will represent the number of integral indexes
  -- `all`   will represent the number of both 
  local keys, indxs, all = 0, 0, 0

  -- Do an initial count of current assets in table. 
  for k, v in pairs(x) do
    if (type(k) == 'number') and (k == math.floor(k)) then indxs = indxs + 1
    else keys = keys + 1 end

    all = all + 1
  end

  -- By using `__nexindex`, any time a new key is added, it will automatically be
  -- tracked.
  mt.__newindex = function(t, k, v)
    if (type(k) == 'number') and (k == math.floor(k)) then indxs = indxs + 1
    else keys = keys + 1 end

    all = all + 1
    t[k] = v
  end

  -- This allows us to have fields to access these datacounts, but won't count as
  -- actual keys or indexes.
  mt.__index = function(t, k)
    if k == 'keyCount' then return keys 
    elseif k == 'indexCount' then return indxs 
    elseif k == 'totalCount' then return all end
  end

  return setmetatable(x, mt)
end 
```

使用它的例子包括：

```
-- Note `36.35433` would NOT be counted as an integral index.
local foo = CountedTable { 1, 2, 3, 4, [36.35433] = 36.35433, [54] = 54 }
local bar = CountedTable { x = 23, y = 43, z = 334, [true] = true }
local foobar = CountedTable { 1, 2, 3, x = 'x', [true] = true, [64] = 64 }

print(foo.indexCount)    --> 5
print(bar.keyCount)      --> 4
print(foobar.totalCount) --> 6 
```

[*现场工作示例*](http://codepad.org/QGWsh55p)

希望这有帮助！:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-16T20:53:03.417

Lua 将 table 存储为两个独立的部分：一个 hash 部分和一个 array 部分，len 操作符只处理数组部分，意思是 value 由一个 number 值索引，加上下面提到的规则，所以你没有任何计数的选择您需要使用**pairs()**函数遍历表的“哈希”值。

# mysql - 使用准备好的语句在数据库中插入和更新表时出现问题

> ID：652960
> 
> 赞同：0
> 
> 时间：2009-03-17T03:41:25.400
> 
> 标签：mysql, mysqli, php

PHP5 的新手，仍然有一些问题。我想出了如何使用准备好的语句选择现在尝试插入/更新我的代码如下

```
function input_lab_results($name, $image, $descrip) {
    $query = "INSERT INTO pat_table (pat_name, pat_image, pat_descrip, pat_doctor, pat_resident, pat_create, pat_modify) VALUES (?, ?, ?, ?, ?, ?, ?)";

    if($stmt = $this->conn->prepare($query)){
        $stmt->bind_param('sssiidd', $name, $image, $descrip, 0, 0, date("Ymd"), date("Ymd"));
        $stmt->execute();
        die();
    } else{
        die($this->conn->error);
    }
} 
```

我得到的错误是

> 致命错误：无法通过第 43 行的引用 html/classes/mySQL.php 传递参数 4

任何帮助/参考将不胜感激。谢谢你。

* * *

每个人都在提到使用 PDO，请问你们有什么好的教程或示例吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T04:16:10.213

我把它改成

```
function input_lab_results($name, $image, $descrip) {
    $query = "INSERT INTO pat_table (pat_name, pat_image, pat_descrip, pat_doctor, pat_resident, pat_create, pat_modify) VALUES (?, ?, ?, 0, 0, ?, ?)";

    if($stmt = $this->conn->prepare($query)){
        $stmt->bind_param('sssdd', $name, $image, $descrip, date("Ymd"), date("Ymd"));
        $stmt->execute();
        die();
    } else{
        die($this->conn->error);
    }
} 
```

基本上我改变了它在哪里阅读？？对于查询中的整数 0 我没有绑定它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T04:31:52.843

这不是`$descrip`问题所在；它是 0（参数 4 和 5）。解决方案是传递变量而不是整数：

```
 `$query = "INSERT INTO pat_table (pat_name, pat_image, pat_descrip, pat_doctor, pat_resident, pat_create, pat_modify) VALUES (?, ?, ?, ?, ?, ?, ?)";`

    $pat_doctor = 0;
    $pat_resident = 0;

    if($stmt = $this->conn->prepare($query)){
            $stmt->bind_param('sssiidd', $name, $image, $descrip, $pat_doctor, $pat_resident, date("Ymd"), date("Ymd"));` 
```

显然 mysqli_bind_param 希望其参数作为引用，因此它会查找它们在内存中的存储位置，而不是复制它们的值。这是有道理的，因为您希望绑定到 sql 语句的某些内容（例如该图像）可能足够大，以至于您不希望有多余的副本到处乱跑。文字，字符串或其他，不能通过引用访问。见：[http ://us.php.net/references](http://us.php.net/references)

我不建议将 0 硬编码到 sql 语句中，因为它会不必要地混淆您的代码。

顺便说一下，让我建议 PDO。它的语法更加健全。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T13:01:05.427

不要使用`bind_param`- 这是一个非常不直观且容易出错的接口，它主要是来自底层 C-api 的遗留物。使用[`bind_value`](http://www.php.net/manual/en/pdostatement.bindvalue.php)或更好 - 将一组值作为参数传递给[`PDOStatement->execute`](http://www.php.net/manual/en/pdostatement.execute.php). 例如。：

```
$query = "INSERT INTO pat_table (pat_name, pat_image, pat_descrip, pat_doctor, pat_resident, pat_create, pat_modify) VALUES (?, ?, ?, 0, 0, ?, ?)";
if ($stmt = $this->conn->prepare($query)) {
  $stmt->execute(array($name, $image, $descrip, date("Ymd"), date("Ymd")));
  die();
} else {
  die($this->conn->error);
} 
```

# sql-server-2005 - 如何以非美国英语安装 SQL Server 2005 Express

> ID：652965
> 
> 赞同：0
> 
> 时间：2009-03-17T03:44:42.753
> 
> 标签：sql-server-2005, windows-server-2008

有谁知道如何让 SQL Server 2005 Express 不安装为美国英语？

我所有的 win2k8 区域设置都设置为英语（新西兰），但它始终安装为美国英语。

我在安装程序中找不到任何地方可以更改它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T07:07:51.143

好的，所以日期格式是问题所在。所以你的意思是你的应用程序试图插入这样的日期：

```
insert into Table1 (DateField1) values ('31/3/2008') 
```

哪个失败是因为它认为“31”是月份？是的，我在澳大利亚也遇到了这个问题。您的选择是：

**1) 更改数据库的默认语言，以及现有用户的语言。**语言实际上是在每个登录的基础上配置的，例如 SQL Management Studio，安全性 --> 登录，右键单击登录，转到属性，然后将“默认语言”从英语更改为英式英语。为确保所有新用户也发生这种情况，您需要更改服务器的默认语言，通过以下方式完成：

```
select * from sys.syslanguages 
```

....然后找到您要查找的语言，即英式英语并记下`langid`. 要设置它，假设英式英语有 langid = 23：

```
sp_configure 'default language', 23
go
reconfigure
go 
```

**2）使您的应用程序使用适当的转换进行日期选择/插入，即**

```
insert into Table1 (DateField) values (convert(datetime, '31/3/2008', 103))
select DateField1 from Table1 where DateField1 = convert(datetime, '31/3/2008, 103)) 
```

**3) 让您的应用程序使用国际格式进行日期选择/插入。来自 BOL：**

> 我们建议您使用不依赖于 DATEFORMAT 并且是多语言的日期时间格式。ISO 8601 格式“1998-02-23T14:23:05”和“1998-02-23T14:23:05-08:00”是唯一的国际标准格式。它们不依赖于 DATEFORMAT 或默认登录语言，并且是多语言的。

我猜在这种情况下，您可以比应用程序更轻松地更改数据库，但如果不是这种情况，那么您真的应该让应用程序以更全局的方式做事。应用程序/数据库设计应尽可能与格式无关。

# flash - 将 FLV 视频放在网站上 - 如何在播放前添加静态图像

> ID：652975
> 
> 赞同：1
> 
> 时间：2009-03-17T03:51:20.227
> 
> 标签：flash, video, flv, dreamweaver

我正在尝试将 FLV 视频放在网站上。

我尝试使用 Dreamweaver CS3（插入 - 媒体 - Flash 视频），它工作得很好，除了 2 个问题：

1.  视频开始为黑色（在播放视频之前如何显示图像？）

2.  浏览器甚至在单击播放按钮之前就开始下载整部电影（我希望仅在用户单击播放后才下载视频）

有人对此有解决方案吗？谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T03:54:09.033

我不知道 Dreamweaver 的 FLV 播放器是否支持这个。但是，您可以使用其他播放器，例如[JW FLV 媒体播放器](http://www.longtailvideo.com/players/jw-flv-player/)，它支持您要求的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-12T13:53:53.340

只需在 Flash 的组件检查器中单击预览，它就会在您嵌入 html 代码时显示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-29T23:02:37.323

将您的图像添加到视频的前 5 帧。我通常会从视频中的某个地方拍摄快照，但任何你想替换黑屏的图像都可以。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T03:56:21.930

浏览器在预缓存方面可能会或可能不会做的事情没有定义，因此无法真正控制。如果您真的认为自己比浏览器更了解，请在应该开始加载视频后使用 JavaScript 插入标签。

鉴于您想要的行为，这可能是最好的。将 <img/> 标签放在带有 ID 的页面中，然后当您要播放视频时，让 javascript 将 <img/> 替换为 <object></object>

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T03:59:56.493

也许一个简单的 javascript 函数在这里效果最好，例如：

```
<div id="videodiv" style="width:300px; height:300px;"
      onclick="this.innerHTML='whatever HTML dreamweaver gives you'">
  <img src="yourimage">
</div> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-22T06:49:09.653

您需要编辑您的 Flash 视频播放器以在您的 flv 文件之前插入图像，并使其不会在网页打开时自动加载。

Moyea [Web Player](http://www.playerdiy.com/)可以解决这两个问题。它使您可以在 FLV 电影的任何位置添加图像，请参阅此功能的屏幕截图：

![添加图像屏幕](https://2.bp.blogspot.com/_R69oAh1uRvY/Sma073zm2AI/AAAAAAAAAXc/3_UcjV5Ye18/s400/insert+image+on+flash+video+player.jpg)

您可以通过取消选中“自动加载”使 FLV 在网页打开时不自动加载：

![自动加载复选框](https://4.bp.blogspot.com/_R69oAh1uRvY/SlMctW3t8NI/AAAAAAAAAXE/HuPfh1-CvKI/s400/auto+load+flv+player.jpg)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-11-06T22:45:46.773

> 在属性区域中，只需单击“自动播放”并将其关闭。

这是正确的，但可能还不够完整 - 在舞台上单击您的 FLVPlayback 组件以将其选中，然后在组件检查器中（按 shift + F7 打开）单击“autoPlay”并选择“false”。

# c# - 使用 C# 的 MySQL 参数化查询

> ID：652978
> 
> 赞同：31
> 
> 时间：2009-03-17T03:56:17.237
> 
> 标签：c#, mysql

我有下面的代码（我已经包含了我认为所有相关的部分）：

```
private String readCommand = "SELECT LEVEL FROM USERS WHERE VAL_1 = ? AND VAL_@ = ?;";
public bool read(string id)
{
    level = -1;
    MySqlCommand m = new MySqlCommand(readCommand);
    m.Parameters.Add(new MySqlParameter("", val1));
    m.Parameters.Add(new MySqlParameter("", val2));
    MySqlDataReader r = m.ExecuteReader();
    if (r.HasRows)
        level = Convert.ToInt32(r.GetValue(0).ToString());
    r.Close();
    return true;
} 
```

当我运行它时，我在添加第一个参数时得到一个 IndexOutOfBoundsException。我做错了什么？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-03-17T04:08:02.667

试试这个：

```
private String readCommand = 
             "SELECT LEVEL FROM USERS WHERE VAL_1 = @param_val_1 AND VAL_2 = @param_val_2;";

public bool read(string id)
{
    level = -1;
    MySqlCommand m = new MySqlCommand(readCommand);
    m.Parameters.AddWithValue("@param_val_1", val1);
    m.Parameters.AddWithValue("@param_val_2", val2);
    level = Convert.ToInt32(m.ExecuteScalar());
    return true;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-02-02T11:37:59.783

```
protected void Login1_Authenticate(object sender, AuthenticateEventArgs e)
{
    MySqlConnection con = new MySqlConnection("server=localhost;User Id=root;database=result;password=1234");
    con.Open();

    MySqlCommand cmd = new MySqlCommand("Select * from users where username=?username and password=?password", con);
    cmd.Parameters.Add(new MySqlParameter("username", this.Login1.UserName));
    cmd.Parameters.Add(new MySqlParameter("password", this.Login1.Password)); 

    MySqlDataReader dr = cmd.ExecuteReader();
    if (dr.HasRows ==true)
    {
        e.Authenticated = true;
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T04:09:15.003

您需要在查询中使用命名参数。例如：

```
String readCommand = "SELECT LEVEL FROM USERS WHERE VAL_1 = ?param1 AND VAL_2 = ?param2"; 
```

然后，在实例化 MySqlParameter 对象时传递参数名称，如下所示：

```
m.Parameters.Add(new MySqlParameter("param1", val1)); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-11-13T08:01:39.550

```
m.Parameters.AddWithValue("parameter",value) 
```

将是参数化查询的更好选择。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T04:37:38.587

我不认为 MySql.Data 类支持未命名的参数。如果您热衷于使用它们，您可以通过 Odbc 驱动程序访问您的 MySql 数据库，它们支持这一点。

您需要在查询中命名参数：

```
"SELECT LEVEL FROM USERS WHERE VAL_1 = @val1 AND VAL_2 = @val2;" 
```

我选择了参数指示符“@”，但 MySql.Data 的最新版本同时支持“@”和“？”。

然后更新您的参数构造函数以传入正确的参数名称（您不需要在此处包含参数指示符，尽管这样做没有任何区别）。

```
m.Parameters.Add(new MySqlParameter("val1", val1)); 
```

PS。您可能已经知道这一点，或者它只是在代码段中被省略了，但我认为您忘记在您的 ExecuteReader 实例上调用 Read。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-04-29T06:51:38.553

如果你想多次执行sql，那么你应该使用这种方式：

```
conn.Open();
cmd.Connection = conn;

cmd.CommandText = "INSERT INTO myTable VALUES(NULL, @number, @text)";
cmd.Prepare();

cmd.Parameters.AddWithValue("@number", 1);
cmd.Parameters.AddWithValue("@text", "One");

for (int i=1; i <= 1000; i++)
{
    cmd.Parameters["@number"].Value = i;
    cmd.Parameters["@text"].Value = "A string value";

    cmd.ExecuteNonQuery();
} 
```

第一次没有“ExecuteNonQuery”，只是添加带有伪造值的参数，然后在循环中添加真实值。

请参阅此链接： [https ://dev.mysql.com/doc/connector-net/en/connector-net-programming-prepared-preparing.html](https://dev.mysql.com/doc/connector-net/en/connector-net-programming-prepared-preparing.html)

# .net - “System.Web.Security.SqlMembershipProvider”需要与架构版本“1”兼容的数据库架构

> ID：652980
> 
> 赞同：1
> 
> 时间：2009-03-17T03:57:11.943
> 
> 标签：.net, sql-server, sql-server-2005-express, profiles

我想使用配置文件并且能够使用 aspent_regsql -A p 来安装表。我可以在整个 SQL 管理工作室看到它们。

我实际上使用的是 SQLExpress 2005，并且我的 dbo.aspnet_SchemaVersions 已填充。有谁知道可能出了什么问题？

顺便说一句，我很确定我的连接字符串和应用程序代码都没有问题。提前致谢。

```
<system.web>
<membership>

  <providers>

    <remove name="AspNetSqlMembershipProvider" />

    <add name="AspNetSqlMembershipProvider"

      type="System.Web.Security.SqlMembershipProvider,

       System.Web, Version=2.0.0.0, Culture=neutral,                                

       PublicKeyToken=b03f5f7f11d50a3a"

      connectionStringName="RGConnectionString" />

  </providers>

</membership>
<profile>
  <providers>
    <add name="ProfileProvider" type="System.Web.Security.SqlProfileProvider,

       System.Web, Version=2.0.0.0, Culture=neutral,                                

       PublicKeyToken=b03f5f7f11d50a3a"

      connectionStringName="RGConnectionString"/>
  </providers> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T04:55:19.463

好吧，我的傻瓜。我很确定这是 SQLExpress 数据库的问题，但实际上是我的`web.config`文件非常奇怪。我通过向提供程序添加正确的属性来使其工作：

```
 <connectionStrings>
    <add name="RGConnectionString"
         connectionString="Data Source=(local)\SQLExpress;Initial Catalog=aspnetdb;Integrated Security=true"
         providerName="System.Data.SqlClient" />
  </connectionStrings>

  <system.web>

    <membership>
      <providers>
        <remove name="AspNetSqlMembershipProvider" />
        <add name="AspNetSqlMembershipProvider"
             type="System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
             connectionStringName="RGConnectionString" 
             enablePasswordRetrieval="true"
             enablePasswordReset="true"
             requiresQuestionAndAnswer="true"
             requiresUniqueEmail="true"
             passwordFormat="Clear"
             maxInvalidPasswordAttempts="5"
             minRequiredPasswordLength="8"
             minRequiredNonalphanumericCharacters="0"
             passwordAttemptWindow="10"
             passwordStrengthRegularExpression="" 
             applicationName="/" />
      </providers>
    </membership>

    <profile>
      <providers>
        <add name="ProfileProvider"
             type="System.Web.Profile.SqlProfileProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
             connectionStringName="RGConnectionString"
             applicationName="/" />
      </providers>
    </profile>

  </system.web> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-02-20T14:03:09.320

如果您编写数据库脚本而不填充 [aspnet_SchemaVersions] 表，则可能会发生这种情况。此表包含有关成员资格表架构的信息。如果此表为空，您将看到有关会员版本的错误。

# c++ - 读取一组用于在图书馆计算机系统中搜索的关键字文档

> ID：652993
> 
> 赞同：0
> 
> 时间：2009-03-17T04:04:10.477
> 
> 标签：c++

**项目场景描述**：在图书馆计算机系统中搜索和文章，需要结合使用关键字和布尔运算符，例如'and'(&) 和'or()。例如，如果您要搜索有关纳米技术和桥梁建设的文章和书籍，则查询将是纳米技术和桥梁建设。为了正确检索书籍和文章，每个文档都使用一组表示文档内容的关键字来表示。

假设每个文档（书籍、文章等）都由唯一的文档编号表示。您将获得一组由其编号和关键字表示的文件，这些文件包含在该文件中，如下所示。

```
887 5 
nanotechnology 
bridge construction
carbon fiber 
digital signal processing 
wireless 
```

上面的数字 887 对应于文档编号，5 是为文档提供的关键字的数量。每个关键字将位于单独的行上。您项目的输入将包含一组文档编号和每个文档的关键字。输入的第一行将包含一个整数，该整数对应于要处理的文档记录数。

倒排列表数据结构是我们为每个关键字存储一组包含该关键字的文档编号的位置。例如，对于关键词碳纤维，我们将有以下内容：

> 桥梁建设 887, 117, 665, 900 碳纤维 887, 1098, 654, 665, 117

编号为 887、1098、654、665 和 117 的文件都将包含关键字碳纤维，关键字桥梁结构可在编号为 887、117、665 和 900 的文件中找到。

**这个项目有两个主要方面**：

1.  我需要读取包含文档信息的文件（使用标准输入）并构建倒排列表数据结构
2.  将布尔查询应用于倒排列表数据结构。

布尔查询的处理如下例所示。为了获得包含关键字 bridge construction & carbon fiber 的文档，我们执行集合相交操作并获得文档 887、117 和 665。布尔查询 bridge construction | carbon fiber 将产生一个集合并集操作，该查询的文档是 887、1098、654、665 和 900。

好的，我的问题是：

**我如何阅读文档，因为我的第一堂课是一个存储一组文档编号的 setClass？**

我的问题是所有文档都在一个文本文件中，例如：

```
25                                                      //first document number 
329 7                                                   //second document number 
ARAMA
ROUTING ALGORITHM
AD-HOC
CSMA
MAC LAYER
JARA
MANET
107 4                                                            //third document number 
ANALYSIS
CROSS-LAYER
GEOGRAPHIC FORWARDING
WIRELESS SENSOR NETWORKS 
```

**那么如何阅读文档编号，因为它们都有不同数量的关键字呢？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T04:57:02.707

第一行的“25”实际上是文件中的文档数吗？我会接受这个假设（如果不是，请阅读文档，直到你点击 EOF）

这是一些用于读取文件的伪代码：

```
int numDocs = readLine // assuming first number is number of docs

for (int i = 0; i < numDocs; ++i)
{
    string line = readLine
    int docNumber = getFirstNumber(line)
    int numKeywords = getSecondNumber(line)

    for (int j = 0; j < numKeywords; ++j)
    {
        string keyword = readline
        associate keyword with docNumber // however this works
    }
} 
```

# jquery - 在 jQuery 中，我在 JSON 结果中返回 HTML，我必须转义什么？

> ID：652997
> 
> 赞同：7
> 
> 时间：2009-03-17T04:06:55.853
> 
> 标签：jquery, json

在我的[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)请求（使用[jQuery](http://en.wikipedia.org/wiki/JQuery)）中，我返回一个[JSON](http://en.wikipedia.org/wiki/JSON)响应。

所以 json.Html 将有一个我想在 div 中附加的 HTML 字符串。

在服务器端，我是否必须转义 HTML？

在我的 MVC 操作中，我将返回：

```
return Content("{html: ???????}, "application/json"); 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T04:12:53.637

另一种解决方案是简单地返回 HTML 并使用 jQuery 的`load()`：

```
$('#someDiv').load('servershtml.html'); 
```

不过，要按照自己的方式进行操作，您只需要转义双引号和反斜杠。

该[规范](http://json.org)非常易读且简短。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T04:10:46.093

在转义要放入 JSON 字符串的内容时，您只需要在引号和斜杠（ala \" 和 \\）中添加斜杠。HTML 字符在 JSON 字符串中没有任何意义，所以它们很好 :)

当然，请确保您的字符串本身是格式正确的 (X)HTML，以便在插入 div 时不会爆炸。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-11-15T15:14:08.170

使用 HTML 创建 JSON 时，您必须先**转义双引号字符**，然后再转**义 CLRF 字符**，它会很好地返回 HTML。

我在从 AJAX 请求调用的 oracle 过程中使用 pl/sql。如果你愿意，我可以发布实现。

你应该在[http://www.jsonlint.com/](http://www.jsonlint.com/)测试你的输出，看看它是否有效。

所以

```
{
    "id": "1",
    "html_value": "<a href=\"http://www.google.com\">test link returnin html code</a>"
} 
```

不同于

```
{
    "id": "1",
    "html_value": "<a href=\"http://www.google.com\">test link returnin
 html code</a>"
} 
```

因为 CLRF 字符。您应该在服务器端将其替换为`&nbsp`; 或`<br/>`。

希望这会有所帮助，亚历克斯

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-08-14T15:55:28.553

我将发布我的 PHP 经验。我希望它可以帮助。

通常，使用该`json_encode()`函数对数据进行编码，例如：

```
json_encode(array('data1' => 'String data with text',
              'data2' => '<a href="www.stackoverflow.com">The Site</a>')); 
```

由于`json_encode()`仅适用于 UTF-8 字符串，我建议通过函数将每个字符串编码为 UTF-8 `utf8_encode()`，即

```
json_encode(array(utf8_encode('data1') => utf8_encode('String data with text'),
              utf8_encode('data2') => utf8_encode('<a href="www.stackoverflow.com">The Site</a>'))); 
```

此外，如果您使用特殊字符（如意大利语中的*è*和*à*），我建议对返回的 json UTF8 编码 HTML 进行解码。如果您需要在 HTML 页面中使用它（例如作为 AJAX 调用的结果），这将特别有用。要通过*Javascript*解码，请使用：

```
decodeURIComponent(escape(html)); 
```

`html`返回的编码 HTML 代码在哪里。

问候。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T06:08:19.103

如果您将`dataType` [配置选项](http://docs.jquery.com/Ajax/jQuery.ajax#options)设置为，`'json'`则传递给`complete`事件的对象将是该 javascript 对象。基本上，jQuery 将完成将响应内容（假设其格式正确的 JSON）转换为 javascript 对象的工作。例子...

```
$.ajax({
    dataType: 'json',
    complete: function(myJsonObject) {
        alert(myJsonObject.someMember);
    }
}); //$.ajax({ 
```

如果您想知道如何从 .net 生成格式正确的 JSON，那么我鼓励您探索[Json.NET](http://james.newtonking.com/projects/json-net.aspx)，因为它使生成 JSON 变得非常非常容易。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-05-07T09:59:18.570

如果您使用的是 PHP json_encode 可以为您解决问题：

```
$htmlSnippet = '<a href="#"></foo>';
return json_encode(array("html" => $htmlSnippet)); 
```

在 jQuery 中，您可以声明 dataType 'json'（参见上面的答案）或通过[jQuery.parseJSON解码](http://api.jquery.com/jQuery.parseJSON/)**`*``****