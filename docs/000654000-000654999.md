# StackOverflow 问答 000654000-000654999

# c# - 如何修复这些编译错误？

> ID：654003
> 
> 赞同：-2
> 
> 时间：2009-03-17T12:27:17.193
> 
> 标签：c#, compiler-errors

```
for (int z = 0; z < alParmValues.Count; z++)
{
    asd.Add((alParmValues[z].ToString().Split(',')));// asd is list<string> 
    def.Add(alMethSign[z].ToString().Substring(alMethSign[z].ToString().IndexOf('(') + 1, alMethSign[z].ToString().IndexOf(')') - (alMethSign[z].ToString().IndexOf('(') + 1)).Split(','));// def is list<string>
} 
```

这些是我编译时遇到的错误：

```
Error 7  The best overloaded method match for 'System.Collections.Generic.List<string>.Add(string)' has some invalid arguments
    D:\HUTT\Code\HUTT\NUnitClasses\BaseGenerator.cs 1118    18  HUTT   
Error 8  Argument '1': cannot convert from 'string[]' to 'string'
    D:\HUTT\Code\HUTT\NUnitClasses\BaseGenerator.cs 1118    27  HUTT 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T12:30:14.130

编译器告诉您，您不能使用`List.Add()`期望 a`string`作为输入的方法，因为您将返回的`Split()`返回 a交给它`string[]`。要使用 a`string[]`作为输入，请使用`AddRange()`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T12:29:45.440

使用 AddRange 而不是 Add。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T12:30:14.550

尝试添加范围

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T12:30:42.083

String.Split 返回一个字符串数组 (string[])，但 List.Add 需要一个字符串类型的参数。

# asp.net - 会话过期时如何重定向到登录页面（ASP.NET 3.5 FormsAuthen）

> ID：654005
> 
> 赞同：9
> 
> 时间：2009-03-17T12:27:59.453
> 
> 标签：asp.net

我正在使用 FormsAuthentication 和 ASP.Net SqlMembership Provider。当基础会话过期时，我想提供一个重定向到登录页面的功能。

我将以下代码块放在我的**BasePage OnInit**中。据我测试，即使我提供了正确的用户 ID 和密码，它总是会继续重定向到登录页面。按权利，它应该带我到默认页面。

```
if (Context.Session != null && Session.IsNewSession && this.Request.IsAuthenticated)
        {
            string cookieHeader = Request.Headers["Cookie"];
            if (cookieHeader != null && cookieHeader.IndexOf("ASP.NET_SessionId") >= 0)
            {

                    HttpContext.Current.Session.Abandon();                       
                    FormsAuthentication.SignOut();                        
                    Response.Redirect(FormsAuthentication.LoginUrl);                                           

            }
        } 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-17T13:02:48.200

您不需要任何自定义代码来实现此功能，它由框架支持。只需在 web.config 中配置它：

```
<authentication mode="Forms">
    <forms defaultUrl="~/Default.aspx"
        loginUrl="~/Login.aspx"
        slidingExpiration="true"
        timeout="60" />
</authentication> 
```

使用上面的配置，当会话过期时，用户将始终被重定向到 Login.aspx 页面。有 60 分钟的超时时间，滑动到期意味着每次用户向 Web 应用程序发出请求时都会延长超时时间，因此如果他保持活动状态，则会话不会到期。与您尝试执行的操作相比，这样的配置为您提供了另一个优势 - 一旦用户登录，他将自动重定向回他最初请求的资源。而且您始终可以覆盖和自定义此行为。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-17T13:40:25.210

[Pawel 的回答](https://stackoverflow.com/questions/654005/how-to-redirect-to-login-page-when-session-is-expired-asp-net-3-5-formsauthen/654138#654138)部分正确，但您还需要将`Session`生命周期设置为比表单身份验证 cookie 生命周期更长的值。表单身份验证`timeout`值仅影响身份验证 cookie 的生命周期。在他提供的示例中，身份验证 cookie 的生命周期为 60 分钟，但默认会话生命周期为 20 分钟。如果用户离开他们的机器超过 20 分钟，他们的会话数据将被丢弃，随后尝试引用存储在会话中的值将导致抛出异常（例如`System.NullReferenceException`，如果尝试`.ToString()`或强制转换）。

[`sessionState`](http://msdn.microsoft.com/en-us/library/h6bb9cz9.aspx)您可以通过在 web.config 文件中配置设置来在应用程序中全局设置：

```
<sessionState 
    mode="InProc" 
    cookieless="false" 
    timeout="70"/> 
```

向会话超时添加五或十分钟可提供良好的缓冲。

# c# - IDataReader.GetName(i) 是否适用于空数据读取器？

> ID：654008
> 
> 赞同：4
> 
> 时间：2009-03-17T12:28:20.500
> 
> 标签：c#, idatareader

我希望在空数据读取器的情况下输出具有空值的字段名称..即

产品：- 价格：-

那么，当 IDataReader.GetName(i) 和 IDataReader.FieldCount 没有结果时可以安全使用吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T13:57:53.247

实际上我只是测试了我自己，对一个空集执行一个阅读器。然后不调用 Read(); 当数据读取器有 0 行时，我成功地为所有列添加了 FieldCount 和 GetName(i)。

# php - 正则表达式如果存在则替换行，如果不存在则添加行

> ID：654012
> 
> 赞同：2
> 
> 时间：2009-03-17T12:29:14.693
> 
> 标签：php, regex

我需要通读 Apache httpd.conf 文件，并找到以下行：

```
#LoadModule blah blah 
```

并取消注释，即替换为

```
LoadModule blah blah 
```

这里要注意的是，由于 conf 文件可能会有所不同，因此 LoadModule 行很可能已经被取消注释。

也有可能该行根本不存在，在这种情况下，我的脚本必须在 conf 文件的末尾添加这样一行。

知道如何用 PHP 编写这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T12:36:37.920

尝试这个：

```
preg_replace('/^#(LoadModule blah blah)/m', '$1', $str) 
```

如果`blah blah`应该是变量，请将其替换为“<code>.+”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T12:48:28.843

```
$line  = "LoadModule blah blah";
$input = "your config file";
$count = 0;
$limit = 1;  // replace first occurrence only, change to -1 to replace all

$output = preg_replace("/^#?(?=\Q$line\E)/m", "", $input, $limit, $count);

if ($count == 0) $output = $output."\n$line"; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T13:05:02.143

```
<?php
$found = false;
$f = fopen('apache.conf', 'r+');

while($line = fgets($f)) {
    if(preg_match("/^(#*)(\s*)LoadModule\s+blah.*/", $line)) {
        $found = true;
        if(substr($line, 0, 1) == '#') {
            fputs($f, preg_replace("/^(#+)(\s*)/", "", $line));
        }
        break;
    }
}

if(!$found) {
    fputs($f, "LoadModule blah blah\n");
}

fclose($f);
?> 
```

# macos - 在 macOS 中安装 pyqt 的问题

> ID：654018
> 
> 赞同：0
> 
> 时间：2009-03-17T12:29:50.620
> 
> 标签：macos, installation, pyqt

你好，

我正在尝试在 macOS 中安装 pyqt。我在互联网上读到我需要：sip + pyqt + qt（显然）我安装 qt & sip 没有问题。当我尝试安装 pyqt 时，我可以在终端看到以下错误：

```
 python configure.py
    Error: A Qt installation could not be found. Use the -q argument or the QTDIR environment variable to explicitly specify the correct directory. 
```

有人知道我应该在终端上写什么吗？

谢谢，

纳乔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-06-08T17:42:37.023

python configure.py -q /usr/bin/qmake-4.x

x 当然是你拥有的任何 qmake 版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T23:27:31.707

你想为 Qt 3 安装 PyQt 还是为 Qt 4 安装 PyQt4？

错误消息看起来像来自 PyQt for Qt 3 的错误消息，在这种情况下，-q 选项的参数是包含安装 Qt 可执行文件、库和头文件的 bin、lib 和 include 目录的目录。

# java - $NON-NLS-1$ 是什么意思？

> ID：654037
> 
> 赞同：331
> 
> 时间：2009-03-17T12:34:27.473
> 
> 标签：java, eclipse, eclipse-rcp

在 Eclipse 源代码中，我在这样使用的注释中发现了一些“$NON-NLS-1$”：

```
private String toolTip = ""; //$NON-NLS-1$ 
```

这意味着什么 ？

* * *

## 回答 #1

> 赞同：385
> 
> 时间：2009-03-17T12:40:34.977

它们使 Eclipse 在遇到字符串文字时发出的警告静音（并且已配置为抱怨）。

这个想法是 UI 消息不应该嵌入为字符串文字，而是来自资源文件（以便它们可以被翻译、校对等）。因此，可以将 Eclipse 配置为检测字符串文字，这样您就不会意外地在代码中留下未外部化的 UI 字符串；但是，有些字符串不应该被外部化（例如正则表达式），因此 //$NON-NLS-1$ 为您提供了一种将这一事实传达给编译器的方法。

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2009-03-17T12:37:14.097

该字符串不可翻译。它告诉 Eclipse 编辑器不要将该字符串标记为无资源。这对于多语言应用程序很重要。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2016-10-26T15:41:59.353

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-02-08T17:53:34.893

如果你是安卓开发者。用户可能看到的所有字符串都应该在资源文件 /res/values/strings.xml 中，以便在您使用 R.string 的代码中读取 strings.xml 文件。通过添加标签 //$NON-NLS-$ 你是请注意，用户不会看到该字符串。

Eclipse Helios 中的警告可能会在`Window -> preferences -> java -> Compiler -> code style -> "Non-externalized Strings (missing/unused &NON-NLS$ tag)`.

如果您计划将您的活动编程为多语言，建议您将其打开。然后将 &NON-NLS$ 标记添加到您的活动内部的字符串中。如果您右键单击警告或错误，Eclipse 将在快速修复中添加 &NON-NLS$ 标记。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-17T12:38:35.217

Eclipse 使用它来指示不需要翻译字符串，可能是因为应用程序的用户不会看到它。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-17T12:38:33.890

它告诉编译器不要抱怨非外部化字符串，并且它不需要本地化。

# runtime - NAnt新手-支持图

> ID：654044
> 
> 赞同：0
> 
> 时间：2009-03-17T12:37:37.870
> 
> 标签：runtime, nant, target

你们中的任何人都可以解释一下这里显示的**框架支持图表**：[nant.sourceforge.net](http://nant.sourceforge.net/)。

我的主要兴趣是术语**目标**和**运行时**在 nant 上下文中的含义？

提前致谢/derdres

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T00:33:19.557

**Target**是指可以编译项目的受支持框架（即，使用 NAnt，您可以编译 .NET 3.5 项目、Mono 2.0 项目、Silverlight 2.0 项目等）。

**运行时**是指可以运行 NAnt 的框架（例如，如果您安装了 .NET 1.0，则可以运行 NAnt）。

# vb.net - 如何从实时/测试 Web 服务中获得相同类型的消息结构

> ID：654048
> 
> 赞同：0
> 
> 时间：2009-03-17T12:38:27.993
> 
> 标签：vb.net, web-services, environment-variables

我有两个单独的 Web 服务，第一个配置为从实时数据库中提取数据，第二个配置为从测试数据库中提取数据。

当从应用程序使用这些 Web 服务时，返回的对象是在 Web 服务中定义的 MyMessageData 类。

在应用程序中，我想实例化一个空的 MyMessageData（来自实时 Web 服务），然后使用配置设置来决定从哪个 Web 服务检索实际数据。

这对测试不起作用，因为应用程序看不到来自 live 的实例化 MyMessageData 类与从测试 Web 服务返回的 MyMessageData 类型相同。

你能建议我得到这种行为的方法吗？

我想到的可能的选择是：

*   提取 MyMessageData 以便两个 Web 服务使用相同的类型，但是对于像 MessageDataClass 这样小的东西来说，这似乎是一个很长的路要走
*   将两个 MyMessageData 类与 MyMessage 类分开的绑定函数，这是我试图避免的

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T12:31:32.037

您是否使用单独的服务参考或 Web 参考进行测试和实时测试？不。使用一个服务参考。那会给你一种类型。然后，更改配置以将引用指向实时或测试站点的 URL。

# c# - 在循环中创建的分隔字符串

> ID：654054
> 
> 赞同：1
> 
> 时间：2009-03-17T12:39:16.683
> 
> 标签：c#, .net, sql, loops

我正在寻找在循环中创建一个与另一个分隔的字符串的最佳方法。我的意思是，例如，SQL 阅读器：

```
StringBuilder sb = new StringBuilder();
while(reader.Read())
{
  sb.Append(reader[0]);
  sb.Append("<br />");
}
string result = sb.ToString();
result = result.Remove(result.LastIndexOf("<br />")); // <- 
```

或创建 SQL 查询字符串；

```
StringBuilder sb = new StringBuilder();
foreach(string v in values)
{
  sb.Append(v);
  sb.Append(",");
}
string query = sb.ToString()
query = query.Remove(query.LastIndexOf(",")); // <-
query = String.Concat("INSERT INTO [foo] ([bar]) VALUES(", query, ")"); 
```

这是我发现的最好的：

```
List<string> list = new List<string>;
while(reader.Read())
{
  list.Add(reader[0]);
}
string result = String.Join("<br />", list.ToArray()); 
```

**编辑：** ~~我知道`StringBuilder`，我没有在这里使用它只是为了清楚起见~~。我的一般想法是不要使用`Remove`/ `LastIndexOf`！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T12:53:06.710

我不是 StringBuilder 的粉丝，除非你真的知道你需要担心性能。它产生丑陋的代码。我会这样写...

```
private IEnumerable<string> ReadAllStrings(DataReader reader)
{
    while(reader.Read())
        yield return reader[0];
}

String.Join("<br />", ReadAllStrings(reader).ToArray()); 
```

如果我经常这样做，我可能会考虑一种扩展方法：

```
public static class Extensions
{
    public static string JoinWith(this IEnumerable<string> strings, string separator)
    {
        return String.Join(separator, strings.ToArray());
    }
} 
```

然后，我的代码将如下所示：

```
ReadAllStrings(reader).JoinWith("<br />"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T12:50:34.750

怎么样：

```
StringBuilder builder;
while (reader.Read())
{
    if( builder == null )
    {
        builder = new StringBuilder(reader[0]);
    }
    else
    {
        builder.Append("<br />");
        builder.Append(reader[0]);
    }
}
string result = builder.ToString(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T13:38:40.783

这只是显示的几个更好的想法的组合：

```
public static class Extensions
{

    public static string JoinStrings(this DataReader reader, int ColumnIndex, string delimiter)
    {
        var result = new StringBuidler();
        var delim = String.Empty;
        while (reader.Read())
        {
           result.Append(delim).Append(reader[ColumnIndex].ToString());
           delim = delimiter;
        }
        return result.ToString();
    }
} 
```

现在你所要做的就是这样称呼它：

```
string result = reader.JoinStrings(0, "<br/>"); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T13:44:36.417

另一个 .Net 2.0 解决方案 - 更改顺序：

```
reader.Read();
StringBuilder sb = new StringBuilder(reader[0]);
while(reader.Read())
{
  sb.Append("<br />");
  sb.Append(reader[0]);
}
string result = sb.ToString(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T13:48:58.730

```
public class Separator 
{

    private string sep;
    private bool first = true;

    public Separator(string sep) 
    {
        this.sep = sep;
    }

    public virtual string ToString() 
    {
        string reply = first ? "" : sep;
        first = false;
        return reply;
    }
}

var sep = new Separator("<br/>");
var builder = new StringBuilder();
while (reader.Read())
{
    builder.Append (sep.ToString()) ;
    builder.Append (reader[0]) ;
} 
```

# javascript - 在 JavaScript 中我应该在哪里使用位运算符？

> ID：654057
> 
> 赞同：75
> 
> 时间：2009-03-17T12:41:15.977
> 
> 标签：javascript, bitwise-operators

我读过[“什么是按位运算符？”](https://stackoverflow.com/questions/276706/what-are-bitwise-operators) ，所以我知道[按位运算符是](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators)**什么** ，但我仍然不清楚如何使用它们。任何人都可以提供任何真实世界的例子来说明位运算符在 JavaScript 中的用处吗？

谢谢。

## 编辑：

只是深入研究**[jQuery 源代码](http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js)**，我发现了几个使用位运算符的地方，例如：（只有 & 运算符）

```
// Line 2756:
event.which = (event.button & 1 ? 1 : ( event.button & 2 ? 3 : ( event.button & 4 ? 2 : 0 ) ));

// Line 2101
var ret = a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1; 
```

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-03-17T12:52:28.350

例子：

解析十六进制值以获取 RGB 颜色值。

```
var hex = 'ffaadd';
var rgb = parseInt(hex, 16); // rgb is 16755421

var red   = (rgb >> 16) & 0xFF; // returns 255
var green = (rgb >> 8) & 0xFF;  // 170
var blue  = rgb & 0xFF;     // 221 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2013-03-27T17:00:57.747

我在生产脚本中*大量*`Math`使用按位运算符进行数值转换，因为有时它们比它们或`parseInt`等效的要快得多。

我必须付出的代价是**代码的可读性**。所以我通常`Math`在开发中使用，在生产中按位使用。

[您可以在 jsperf.com 上找到一些性能技巧](http://jsperf.com/math-floor-vs-math-round-vs-parseint/18)。

正如你所看到的，浏览器多年来都没有进行优化`Math.ceil`，`parseInt`所以我预测按位将在未来以更快、更短的方式[做事](https://stackoverflow.com/questions/2526682/why-is-javascripts-math-floor-the-slowest-way-to-calculate-floor-in-javascript)。

[关于SO的一些进一步阅读......](https://stackoverflow.com/questions/4024429/what-does-a-single-vertical-bar-mean-in-javascript)

* * *

奖励：**备忘单**：一种将任何内容转换为 `| 0`整数的简单快捷的方法：

```
( 3|0 ) === 3;             // it does not change integers
( 3.3|0 ) === 3;           // it casts off the fractional part in fractionalal numbers
( 3.8|0 ) === 3;           // it does not round, but exactly casts off the fractional part
( -3.3|0 ) === -3;         // including negative fractional numbers
( -3.8|0 ) === -3;         // which have Math.floor(-3.3) == Math.floor(-3.8) == -4
( "3"|0 ) === 3;           // strings with numbers are typecast to integers
( "3.8"|0 ) === 3;         // during this the fractional part is cast off too
( "-3.8"|0 ) === -3;       // including negative fractional numbers
( NaN|0 ) === 0;           // NaN is typecast to 0
( Infinity|0 ) === 0;      // the typecast to 0 occurs with the Infinity
( -Infinity|0 ) === 0;     // and with -Infinity
( null|0 ) === 0;          // and with null,
( (void 0)|0 ) === 0;      // and with undefined
( []|0 ) === 0;            // and with an empty array
( [3]|0 ) === 3;           // but an array with one number is typecast to number
( [-3.8]|0 ) === -3;       // including the cast off of the fractional part
( [" -3.8 "]|0 ) === -3;   // including the typecast of strings to numbers
( [-3.8, 22]|0 ) === 0     // but an Array with several numbers is typecast to 0
( {}|0 ) === 0;                // an empty object is typecast to 0
( {'2':'3'}|0 ) === 0;         // or a not empty object
( (function(){})|0 ) === 0;    // an empty function is typecast to 0 too
( (function(){ return 3;})|0 ) === 0; 
```

对我来说还有一些魔力：

```
3 | '0px' === 3; 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2010-02-08T19:36:48.470

在 JavaScript 中，您可以使用双位否定 ( `~~n`) 来代替`Math.floor(n)`（如果`n`是正数）或`parseInt(n, 10)`（即使`n`是负数）。`n|n`并且`n&n`总是产生与 相同的结果`~~n`。

```
var n = Math.PI;
n; // 3.141592653589793
Math.floor(n); // 3
parseInt(n, 10); // 3
~~n; // 3
n|n; // 3
n&n; // 3

// ~~n works as a replacement for parseInt() with negative numbers…
~~(-n); // -3
(-n)|(-n); // -3
(-n)&(-n); // -3
parseInt(-n, 10); // -3
// …although it doesn’t replace Math.floor() for negative numbers
Math.floor(-n); // -4 
```

单个按位否定 ( `~`) 计算`-(parseInt(n, 10) + 1)`，因此将返回两个按位否定`-(-(parseInt(n, 10) + 1) + 1)`。

应该注意的是，在这三个备选方案中，**[`n|n`似乎是最快的](http://ernestdelgado.com/archive/benchmark-on-the-floor/)**。

**更新：**此处提供更准确的基准：http: **[//jsperf.com/rounding-numbers-down](http://jsperf.com/rounding-numbers-down)**

（如发布在[最奇怪的语言功能](https://stackoverflow.com/questions/1995113/strangest-language-feature/2019171#2019171)上）

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2014-02-27T06:58:50.170

## `^`按位异或作为切换器

`value ^= 1`每次调用时都会改变`value`to `0, 1, 0, 1, ...` ，（它基本上类似于：）`boolVal != boolVal`：

```
function toggle(evt) {
  const EL = evt.currentTarget;
  EL.isOn ^= 1; // Bitwise toggle
  EL.textContent = EL.isOn ? "ON" : "OFF"; // Unleash your ideas
}

document.querySelectorAll("button").forEach( el =>
  el.addEventListener("click", toggle)
);
```

```
<button>OFF</button>
<button>OFF</button>
<button>OFF</button>
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-03-17T12:49:00.323

鉴于 Javascript 正在取得的进步（尤其是允许使用 js 进行服务器端编程的 nodejs），JS 中的代码越来越复杂。以下是我使用按位运算符的几个例子：

*   IP地址操作：

    ```
    //computes the broadcast address based on the mask and a host address
    broadcast = (ip & mask) | (mask ^ 0xFFFFFFFF)

    //converts a number to an ip adress 
    sprintf(ip, "%i.%i.%i.%i", ((ip_int >> 24) & 0x000000FF),
                             ((ip_int >> 16) & 0x000000FF),
                             ((ip_int >>  8) & 0x000000FF),
                             ( ip_int        & 0x000000FF)); 
    ```

注意：这是 C 代码，但 JS 几乎相同

*   CRC算法大量使用它们

查看有关此的[维基百科条目](http://en.wikipedia.org/wiki/Computation_of_CRC)

*   屏幕分辨率操作

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2014-06-27T19:39:49.850

判断一个数是否为奇数：

```
function isOdd(number) {
    return !!(number & 1);
}

isOdd(1); // true, 1 is odd
isOdd(2); // false, 2 is not odd
isOdd(357); // true, 357 is odd 
```

比模数更快 - 在性能*真正*重要的地方使用！

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2012-06-12T16:15:48.330

关于如何使用按位非和双位非的其他几个例子：

**楼层操作**

```
~~2.5    // 2
~~2.1    // 2
~~(-2.5) // -2 
```

**检查 indexOf 是否返回 -1**

```
var foo = 'abc';
!~foo.indexOf('bar'); // true 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-03-17T12:49:13.757

您可以使用它们来翻转布尔值：

```
var foo = 1;
var bar = 0;
alert(foo ^= 1);
alert(bar ^= 1); 
```

这有点傻，而且在大多数情况下，按位运算符在 Javascript 中没有很多应用程序。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2016-01-18T10:35:00.170

```
var arr = ['abc', 'xyz'] 
```

烦得写

```
if (arr.indexOf('abc') > -1) {
  // 'abc' is in arr
}

if (arr.indexOf('def') === -1) {
  // 'def' is not in arr
} 
```

检查数组中是否有东西？

您可以`~`像这样使用按位运算符：

```
if (~arr.indexOf('abc')) {
  // 'abc' is in arr
}

if (! ~arr.indexOf('def')) {
  // 'def' is not in arr
} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-03-17T12:50:05.393

**[位掩码](http://en.wikipedia.org/wiki/Mask_(computing))**。

广泛使用，例如，在 JS 事件中。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-17T12:52:41.050

我曾经将它用于[权限小部件](http://candyscript.com/projects/minikit/samples/permissions.html)。unix 中的文件权限是位掩码，所以要解析它，需要使用位操作。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-03-29T08:43:00.300

我正在使用它们将三个数字展平为 1 作为将多维数组存储在[Uint16Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array)中的一种方式。这是我正在开发的体素游戏的片段：

```
function Chunk() {
  this._blocks = new Uint16Array(32768);
  this._networkUpdates = [];
}

Chunk.prototype.getBlock = function(x, y, z) {
  return this._blocks[y + (x << 5) + (z << 10)];
};

Chunk.prototype.setBlock = function(x, y, z, value) {
  this._blocks[y + (x << 5) + (z << 10)] = value;
  this._networkUpdates.push(value + (y << 15) + (x << 20) + (z << 25));
};

Chunk.prototype.getUpdates = function() {
  return this._networkUpdates;
};

Chunk.prototype.processUpdate = function(update) {
  // this._blocks[Math.floor(update / 65536)] = update % 65536;
  this._blocks[update >> 16] = update & 65535;
};

var chunk = new Chunk();
chunk.setBlock(10, 5, 4);
alert(chunk.getBlock(10, 5, 4));
alert(chunk.getUpdates()[0]);
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-03-19T10:21:11.750

这个答案包含对[马克的答案的](https://stackoverflow.com/a/654098)解释。

通过阅读这些解释并运行代码片段，可以获得一个想法。

```
var hex = 'ffaadd';
var rgb = parseInt(hex, 16); // rgb value is 16755421 in decimal = 111111111010101011011101 in binary = total 24 bits

var red   = (rgb >> 16) & 0xFF; // returns 255
var green = (rgb >> 8) & 0xFF;  // returns 170
var blue  = rgb & 0xFF;         // returns 221  

// HOW IS IT

// There are two bitwise operation as named SHIFTING and AND operations.
// SHIFTING is an operation the bits are shifted toward given direction by adding 0 (zero) bit for vacated bit fields.
// AND is an operation which is the same with multiplying in Math. For instance, if 9th bit of the given first bit-set is 0
// and 9th bit of the given second bit-set is 1, the new value will be 0 because of 0 x 1 = 0 in math.

// 0xFF (000000000000000011111111 in binary) - used for to evaluate only last 8 bits of a given another bit-set by performing bitwise AND (&) operation. 
// The count of bits is 24 and the first 16 bits of 0xFF value consist of zero (0) value. Rest of bit-set consists of one (1) value.
console.log("0xFF \t\t\t\t: ", 0xFF) 

// 111111111010101011011101 -> bits of rgb variable
// 000000000000000011111111 -> 255 after (rgb >> 16) shifting operation
// 000000000000000011111111 -> 255 complement (changes the first 16 bits and does nothing for the last 8 bits)
// 000000000000000011111111 -> result bits after performing bitwise & operation
console.log("Red - (rgb >> 16) & 0xFF \t: ", (rgb >> 16) & 0xFF) // used for to evaluate the first 8 bits

// 111111111010101011011101 -> bits of rgb variable
// 000000001111111110101010 -> 65450 -> 'ffaa'
// 000000000000000011111111 -> 255 complement (changes the first 16 bits and does nothing for the last 8 bits)
// 000000000000000010101010 -> result bits after performing bitwise & operation
// calculation -> 000000001111111110101010 & 000000000000000011111111 = 000000000000000010101010 = 170 in decimal = 'aa' in hex-decimal
console.log("Green - (rgb >> 8) & 0xFF \t: ", (rgb >> 8) & 0xFF) // used for to evaluate the middle 8 bits 

// 111111111010101011011101 -> 'ffaadd'
// 000000000000000011111111 -> 255 complement (changes the first 16 bits and does nothing for the last 8 bits)
// 000000000000000011011101 -> result bits after performing bitwise & operation 
// calculation -> 111111111010101011011101 & 000000000000000011111111 = 221 in decimal = 'dd' in hex-decimal
console.log("Blue - rgb & 0xFF \t\t: ", rgb & 0xFF) // // used for to evaluate the last 8 bits.

console.log("It means that `FFAADD` hex-decimal value specifies the same color with rgb(255, 170, 221)")

/* console.log(red)
console.log(green)
console.log(blue) */
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-11-12T05:41:01.870

当您使用十六进制值和位时，它们似乎非常有用。由于 4 位可以代表 0 到 F。

1111 = F 1111 1111 = FF。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-04-09T23:00:59.577

**使用 Node.js 的示例**

假设您有一个包含这些内容的文件（称为 multiply.js），您可以运行

```
`node multiply <number> <number>` 
```

并获得与在相同的两个数字上使用乘法运算符一致的输出。函数中进行的位移`Mulitply`是如何获取表示一个数字的位掩码并使用它来翻转另一个数字中的位以进行快速操作的示例。

```
var a, b, input = process.argv.slice(2);

var printUsage = function() {
  console.log('USAGE:');
  console.log('  node multiply <number> <number>');
}

if(input[0] === '--help') {+
  printUsage();
  process.exit(0);
}

if(input.length !== 2) {
  printUsage();
  process.exit(9);
}

if(isNaN(+input[0]) || isNaN(+input[1])) {
  printUsage();
  process.exit(9);
}

// Okay, safe to proceed

a = parseInt(input[0]),
b = parseInt(input[1]);

var Multiply = function(a,b) {
  var x = a, y = b, z = 0;

  while( x > 0 ) {
    if(x % 2 === 1) {
      z = z + y;
    }
    y = y << 1;
    x = x >> 1;
  }

  return z;
}

var result = Multiply(a,b);

console.log(result); 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2013-07-16T04:04:26.000

我刚刚发现这个问题试图确认按位运算`AND`符是否也在`&`Javascript 中。

既然你问了一个例子：

```
if ($('input[id="user[privileges]"]').length > 0) {
    $('#privileges button').each(function () {
        if (parseInt($('input[id="user[privileges]"]').val()) & parseInt($(this).attr('value'))) {
            $(this).button('toggle');
        }
    });
} 
```

给定隐藏字段的位掩码值，它使用 jQuery 填充按钮的状态：

*   `none`=`0`
*   `user`=`1`
*   `administrator`=`2`
*   `user`+ `administrator`=`3`

# virtualization - 与 VirtualBox Host ->Guest 中的端口转发相关

> ID：654063
> 
> 赞同：0
> 
> 时间：2009-03-17T12:42:41.387
> 
> 标签：virtualization

我在 Ubuntu 8.10 上运行的 VirtualBox 中有 WindowsXP 作为 GuestOS。我能够在 WindowsXP (Guest) 中使用 Netmeeting 并连接到 Intranet 中的其他机器。

Netmeeting 侦听端口 1503 和 1720（以及其他端口）。

现在我想知道如何从 Intranet 上的机器连接到 VirtualBox 内部的 Netmeeting。来宾操作系统只有 NAT 转换的 IP 地址 (10.0.2.15)。

VirtualBox 提供了一种使用 VBoxManage 转发端口的方法。但我的问题是，在主机操作系统中，没有应用程序正在侦听端口 1503 和 1720。在这种情况下，我如何将请求转发到 Host:1503 -> GuestOS:1503 ？我应该使用任何虚拟监听器来监听 1503 和 1720 以便它们的端口是“开放的”吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T16:01:44.207

您需要更改防火墙脚本并为相关端口添加 DNAT 规则。您不应该*在*主机操作系统上的这些端口上监听任何东西，如果您没有执行 DNAT，这将阻止到这些端口的任何数据包到达来宾，并且如果您这样做将毫无用处，因为内核永远不会发送任何内容到他们。

# wpf - 是否可以使用可检查的 MenuItem 作为 RadioButton 的控制模板？

> ID：654074
> 
> 赞同：0
> 
> 时间：2009-03-17T12:44:19.400
> 
> 标签：wpf, radio-button, controltemplate

我的 WPF 应用程序中有一个菜单，其中包含多个选项，它们就像一个单选按钮组（选择一个取消选择其余选项）。我想使用可检查的菜单项作为单选按钮的模板。

我试图设置模板，但它似乎不像预期的那样工作。选择和取消选择项目似乎与单选按钮的值不同步。

我想我可以使用更复杂的模板并使用 Path 或其他东西“伪造”选定的标记，但对于这样一个简单的目的来说，这似乎需要做很多工作。此外，当使用更复杂的模板时，我必须解决我不想做的不同主题。

这是一个简单的例子来演示这个问题。

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">  
  <Page.Resources>
    <ControlTemplate x:Key="Template" TargetType="{x:Type RadioButton}">      
      <MenuItem x:Name="item" Header="{TemplateBinding Content}" IsCheckable="True" IsChecked="False" />

      <ControlTemplate.Triggers>
        <Trigger Property="IsChecked" Value="True">
          <Setter TargetName="item" Property="IsChecked" Value="True" />
        </Trigger>
      </ControlTemplate.Triggers>      
    </ControlTemplate>
  </Page.Resources> 

  <StackPanel>
    <RadioButton Content="Foo" Template="{StaticResource Template}"/>  
    <RadioButton Content="Bar" Template="{StaticResource Template}"/>  
    <RadioButton Content="Biz" Template="{StaticResource Template}"/>  
  </StackPanel>  
</Page> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T16:50:28.997

问题似乎是`MenuItem`的鼠标事件处理程序正在接管`RadioButton`. 当我设置`IsHitTestVisible`为**false**并添加一个`MenuItem`来吸收鼠标事件时，它似乎可以按您的预期工作：**`Border`**

 **```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Page.Resources>
        <ControlTemplate x:Key="Template" TargetType="{x:Type RadioButton}">
            <Border Background="Transparent">
                <MenuItem Header="{TemplateBinding Content}" IsCheckable="False" IsChecked="{TemplateBinding IsChecked}" IsHitTestVisible="False"/>
            </Border>
        </ControlTemplate>
    </Page.Resources>
    <StackPanel>
        <RadioButton Content="Foo" IsChecked="True" Template="{StaticResource Template}"/>
        <RadioButton Content="Bar" Template="{StaticResource Template}"/>
        <RadioButton Content="Biz" Template="{StaticResource Template}"/>
    </StackPanel>
</Page> 
```

# vb.net - Visual Studio 2003，宏，Process.Attach 不总是工作

> ID：654075
> 
> 赞同：0
> 
> 时间：2009-03-17T12:44:43.953
> 
> 标签：vb.net, visual-studio, macros

我正在使用 Visual Studio 2003，并且我有一个类似于此的宏：

```
 Dte.Debugger.DetachAll()

    For Each proc As EnvDTE.Process In DTE.Debugger.LocalProcesses
        If proc.Name.IndexOf("ehexthost.exe") <> -1 Then
            proc.Attach()
        End If
    Next 
```

第一次使用宏，它工作正常。以后的每一次，即使我从这个过程中分离出来，`.Attach()`似乎也没有做任何事情。

当我逐步执行宏时也会发生同样的事情......`proc.Attach()`在正确的过程中被调用，但没有任何反应。

注意：在“进程”窗口中查看进程时，我的进程的“类型”列显示`".NET, Win32".`

知道发生了什么吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T13:57:45.667

在运行宏之前尝试调用以下命令。它将确保 VS 在附加到新进程之前未附加到任何进程。

```
Dte.Debugger.DetachAll() 
```

# php - 如何在 ADODB 中使用查询缓存？

> ID：654078
> 
> 赞同：0
> 
> 时间：2009-03-17T12:45:59.083
> 
> 标签：php, database, caching, adodb

如何在 PHP 中使用带有 ADOdb 的查询缓存？它是 ADOdb 中的默认值还是需要任何配置？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T12:53:26.883

设置缓存目录，例如

```
$GLOBALS['ADODB_CACHE_DIR']=$_SERVER['DOCUMENT_ROOT'].'/../cache/adodb'; 
```

现在您可以使用 Cache* 方法（如[CacheGetOne）](http://phplens.com/lens/adodb/docs-adodb.htm#cachegetone)来获取缓存结果

```
$data = $rs->CacheGetOne($seconds_to_cache, $sql); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-13T11:36:09.320

你可以这样做：

```
CacheFlush($sql=false,$inputarr=false); 
```

# .net - 具有不同入口点的 DllImport（不同项目中相同导入的不同 DLL）

> ID：654089
> 
> 赞同：0
> 
> 时间：2009-03-17T12:49:47.797
> 
> 标签：.net, opengl-es, dllimport

[作为我最近](https://stackoverflow.com/questions/653577/debug-net-compact-framework-app-locally-without-emulator-or-device)关于 .NET Compact Framework 调试的问题的后续，我目前正在尝试从 .NET Compact Framework 和 .NET Framework 应用程序中使用 OpenGL ES。我使用[这个包装器](http://www.koushikdutta.com/2008/08/net-compact-framework-wrapper-for.html)，它是为 OpenGL ES 创建并从 libGLES_CM.dll 导入的。

为了使调试更容易，我创建了一个 .NET Framework 应用程序，使用相同的文件重新创建了 OpenGL ES 和 EGL 的导入项目（只是为桌面框架构建），为 DLL 名称创建了常量，以便它们将从 libGLESv2.dll 和Windows 上的 libEGL.dll 和 CF 上的 libGLES_CM.dll。DLL 来自 PowerVR OpenGL ES Emulation SDK（目标设备具有 PowerVR SGX）并且只是围绕真实 OpenGL 实现的 OpenGL ES 包装器。问题来了：

在包装器库中，OpenGL 函数位于两个静态类（gl 和 egl）中，并具有通常的名称，但没有 gl/egl 前缀，因此调用它们将`egl.GetDisplay()`代替`egl.eglGetDisplay()`. 它们是这样导入的：

```
[DllImport(DllName, EntryPoint = "eglGetDisplay")]
static extern IntPtr GetDisplay(EGLNativeDisplayType display_id); 
```

这在 Compact Framework 上运行良好。根据`_eglGetDisplay@4` *_* _到 Dependency Walker。

我设法将下划线添加到桌面项目的函数名称中，但不是为 CF 项目，通过有条件地将字符串常量设置为空字符串或“_”，并将它和入口点名称连接起来，所以它看起来像这：

```
[DllImport(DllName, EntryPoint = FunctionPrefix + "eglGetDisplay")] 
```

这里没问题。但是仍然找不到该函数，因为缺少@4（那到底是什么？）。如果我添加@4，这可行，但由于这里所有函数都有不同的值，我必须手动执行此操作，并且对于 CF 版本，这些数字可能不正确。奇怪的部分来了：

如果我只是不指定入口点，而是将函数命名为应该命名的函数，则导入工作正常！现在这很丑，因为有双重前缀（静态类名和函数名），尽管我可以通过为此添加一个包装器来解决这个问题。因为我不会严重依赖这些功能（只需要一个相当简单的 2D 引擎），这不会是一个问题，但它只是感觉不对。

为什么指定入口点时不起作用？我该怎么做才能让它像它应该的那样工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T13:06:24.137

如果 CF 和桌面 API 有不同的入口点，您需要使用它。这意味着您需要定义不同的 DllImport。

最简单的可能是让两个包装类实现所有内部（.NET）名称，它们调用它们的导入，然后根据平台在运行时实例化正确的一个。然后通过通用接口访问 API。

```
Interface IGLImports {
   IntPtr GetDisplay(EGLNativeDisplayType display_id);
}

static class CFRawImports {
  [DllImport(DllName, EntryPoint = "eglGetDisplay")]
  static extern IntPtr GetDisplay(EGLNativeDisplayType display_id);
}

static class DeskRawImports {
  [DllImport(DllName, EntryPoint = "_eglGetDisplay@4")]
  static extern IntPtr GetDisplay(EGLNativeDisplayType display_id);
}

class DesktopImports : IGLImports {
  public IntPtr GetDisplay(EGLNativeDisplayType display_id) {
    return DeskRawImports.GetDisplay(display_id);
  }
}

class CFImports : IGLImports {
  public IntPtr GetDisplay(EGLNativeDisplayType display_id) {
    return CFRawImports.GetDisplay(display_id);
  }
}

static class ImportLoader {
  public static IGLImports GetImports() {
    if (isCF) {
      return new CFImports();
    } else {
      return new DesktopImports();
    }
  }
}

class MyApp {
  private static IGLIMports gl = ImportLoader.GetImports();

  // In code use gl.GetDesktop(...) 
```

* * *

编辑：接口和四个类应该可以通过少量代码生成来创建。包含名称 DesktopImport CFImport 的输入文件（如果这些名称不同，可能会添加 dll 名称）。将是学习VS的T4模板的借口......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:05:07.523

修饰名称是编译器在编译函数定义或原型期间创建的字符串。名称中的“@4”表示它的总参数长度为 4 个字节（一个 32 位整数？）。

您可以使用[dumpbin.exe](http://msdn.microsoft.com/en-us/library/aa446532.aspx)从您的 .dll 中获取修饰名称。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-17T05:37:34.353

使用 #define yourdllname_API **extern "C"** __declspec(dllexport) 在你的 dll 中公开方法，避免函数装饰，因为你不会得到上面提到的异常，例如：

动态链接库：

```
#ifdef DEPLOYHOOK_EXPORTS
#define DEPLOYHOOK_API  extern "C" __declspec(dllexport)
#else
#define DEPLOYHOOK_API  __declspec(dllimport)
#endif

// This class is exported from the DeployHook.dll

DEPLOYHOOK_API int nDeployHook;

DEPLOYHOOK_API bool InstallHook(void);
DEPLOYHOOK_API bool UnInstallHook(void); 
```

调用项目/exe：

```
[DllImport("DeployHook.dll",EntryPoint = "InstallHook",CharSet = CharSet::Auto, SetLastError = true)]   extern bool InstallHook(void); 
```

//EntryPointNotFoundException 避免

# javascript - Jquery UI 选项卡和 jcarousel lite pluings 在 Internet Explorer (IE) 中似乎不起作用（冲突）

> ID：654092
> 
> 赞同：1
> 
> 时间：2009-03-17T12:50:16.657
> 
> 标签：javascript, jquery, jquery-ui, jquery-ui-tabs, jcarousellite

我的网页中有 jquery-UI 选项卡和[jcarousel lite 插件](http://www.gmarwaha.com/jquery/jcarousellite/demo.php)，除了 IE 之外的所有浏览器都可以正常工作，我认为存在某种冲突，就好像我取出 jcarousel JS 然后选项卡工作正常。

有没有人对这个问题或如何解决它有任何建议？谢谢

```
<script type="text/javascript">
$(document).ready(function() {

    $('#tabs > ul').tabs({ 
        fx: { opacity: 'toggle' } 
    }); 

    $("#carousel").jCarouselLite({
        btnNext: ".prev",
        btnPrev: ".next",
        visible: 4,
    });

});
</script> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T11:30:41.987

发现只是“可见：4”末尾的逗号需要取出。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T11:28:48.690

[![替代文字](https://i.stack.imgur.com/IwFIp.png)](https://i.stack.imgur.com/IwFIp.png)
[（来源：[stackoverflow.com](http://i.stackoverflow.com/Content/Img/stackoverflow-logo-250.png)）] jquery 的 Nise 代码

$（函数（）{

$(".mouseWheel .jCarouselLite").jCarouselLite({ btnNext: ".mouseWheel .next", btnPrev: ".mouseWheel .prev", easing: "easeinout", visible: 4, mouseWheel: true });

});

$(function() { $(".anyClass2").jCarouselLite({ btnNext: ".next2", btnPrev: ".prev2" }); });

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T11:52:33.483

我将上面的 javascript 放入[http://javascriptlint.com/online_lint.php](http://javascriptlint.com/online_lint.php) - 这是结果的片段

```
10                  btnPrev: ".next",
11                  visible: 4,
12          });
    ========^
    warning: trailing comma is not legal in ECMA-262 object initializers 
```

# constraints - 在数据库中强制执行表间约束的最佳方法

> ID：654096
> 
> 赞同：4
> 
> 时间：2009-03-17T12:52:09.910
> 
> 标签：constraints, database-agnostic

我正在寻找检查表间约束的最佳方法，这是外键向前迈出的一步。例如，检查日期子记录值是否在两个父行列的范围日期之间。例如：

```
Parent table  
ID    DATE_MIN   DATE_MAX
----- ---------- ----------
1     01/01/2009 01/03/2009
...

Child table
PARENT_ID  DATE
---------- ----------
1          01/02/2009
1          01/12/2009   <--- HAVE TO FAIL!
... 
```

我看到两种方法：

*   [如本文](http://www.dbazine.com/oracle/or-articles/tropashko8)（或其他 RDBMS 上的其他等效项）所示，在提交时创建物化视图。
*   使用存储过程和触发器。

还有其他方法吗？哪个是最好的选择？

**更新**：这个问题的动机**不是**“对数据库或应用程序施加约束”。我认为这是一个令人厌烦的问题，任何人都按照她喜欢的方式行事。而且，对于批评者，我很抱歉，我正在开发对数据库的限制。**从这里开始**，问题是“哪个是管理数据库表间约束的最佳选择？”。我在问题标题上添加了“内部数据库”。

**更新 2**：有人添加了“ *oracle* ”标签。当然物化视图是 oracle 工具，但我对**任何**选项都感兴趣，无论它是在 oracle 还是其他 RDBMS 上。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T14:48:35.747

**编辑：** Dana the Sane 删除了他的帖子，无论 DBA 反对如何，都将其放在数据层中。

* * *

DBA 对像 Dana 这样的开发人员大喊大叫的原因是他们假设应用程序和数据库之间的比例是 1:1。他们看到这一点是因为他们看到了支持应用程序的数据，而他们的应用程序只需将数据存储在一个地方。

DBA 将数据视为最重要的事情，并不关心应用程序的出现或消失。

如果您失去了对 MS Word 的使用，您是否会关心您是否仍然可以访问您的文档？不，数据对您很重要，应用程序不重要。

如果您让任何东西绕过您的应用程序来获取您的数据，那么您就失去了数据层中的约束。如果你的约束在你的数据库层，那么几十个应用程序都可以让你使用它。

理想情况下，您永远不会向任何人授予 INSERT、UPDATE 或 DELETE。相反，您将授予 EXECUTE On 将为您执行 CRUD 的软件包。如果您从一开始就这样做，那么向孩子的 INSERT 添加规则的能力（例如检查出生日期是否在父母日期之间）实际上是无限的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-25T07:59:53.033

## 数据库约束

强制执行**数据库约束**（跨越两个或多个关系的约束 - 其中**引用完整性约束**是使用语法简写`foreign key`/`references`语句的特殊情况）的最佳方法**是通过标准 SQL 语句以*声明***方式：

```
create assertion <name> check (<condition>) 
```

在您的情况下，类似于：

```
create assertion Child_DATE_between_MIN_MAX check (
  not exists (
    select DATE_MIN, DATE, DATE_MAX
      from Parent, Child
     where ID = PARENT_ID
       and DATE < DATE_MIN
       and DATE > DATE_MAX
  )
) 
```

**更新：**我忘了那`<condition>`是一个严格的布尔值，因此旧代码不正确。

**不幸**的是（这里有点讽刺）大多数 SQL-DBMS 没有实现断言。

因此，如果可用的话，剩下的就是通过存储过程和触发器或检查约束以程序**方式实现此检查。**在这种情况下，需要调用相同的存储过程来更新父子关系；所以一个过程和两个触发器或检查约束。

[Lurker Indeed 的回答](https://stackoverflow.com/questions/654096/best-way-to-enforce-inter-table-constraints-inside-database/654794#654794)显示了这样的解决方案，但它需要对 Child 关系进行类似的检查。

## 对表演的担忧

Damien_The_Unbeliever 在[对同一答案](https://stackoverflow.com/questions/654096/best-way-to-enforce-inter-table-constraints-inside-database/654794#654794)的评论中认为：

> 1）您可能会为每次插入/更新进行全表扫描

在这里，我将解决这个反对意见，因为它很常见，甚至对于 ASSERTION 来说似乎也是有效的（这很可能是一种流行的误解，它说服用户不要向 SQL-DBMS 实现者询问它们，即使他们知道它在标准）。

好吧，是的，他是对的.. 如果有人使用糟糕的 DBMS！

有一个有趣的理论可以应用于完整性维护：[**微分关系微积分**](http://www.computer.org/portal/web/csdl/doi/10.1109/69.683760)[（在此处](http://scilib.kiev.ua/ieee/tkde/1998/02/k2/k0328.pdf)提供 .pdf 文件；您还可以在每本关于 DB 理论的体面书籍中找到对该主题的充分处理）。

核心思想是可以强制执行完整性约束，通常只检查更新所涉及的关系子集。更严格地说，引用链接论文的摘要：

> ... 一阶语句的形式微分对于维护数据库完整性很有用，因为一旦数据库约束被表示为一阶语句，它相对于事务的导数就为维护完整性提供了必要和充分的条件。**导数通常比原始约束更容易测试，因为它通过在事务之前假设完整性来保持完整性，并且只测试新的违规行为**。...

还有其他技术可以处理**增量完整性约束维护**。DBMS 开发人员没有充分的理由忽视这种理论。事实上，[An Amateur's Introduction to Integrity Constraints and Integrity Checking in SQL](http://209.85.129.132/search?q=cache:od2xPlokRwkJ:www.iai.uni-bonn.de/~behrend/btw_paper.pdf) ( [.pdf](http://www.iai.uni-bonn.de/~behrend/btw_paper.pdf) ) 的作者在介绍中写道：

> **1 简介**
> 
> ... 但是，支持 SQL 的商业关系 DBMS 产品（例如，Oracle [Ora99] 或 DB2 [IBM99]）不支持更高级的约束形式。即使在 SQL'92 标准发布 8 年多的今天，**这些商业系统都不支持断言**，这是 SQL 中最普遍的约束形式！ **另一方面，致力于完整性的****科学文献**，即研究论文，提供了大量有希望的结果，适用于非常普遍和强大的完整性约束形式。...

 **因此，请：要求您的 SQL-DBMS 供应商（商业或免费/开源）**现在**实施 ASSERTION ，至少具有合理的性能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:37:45.787

我会去存储过程和触发路线；它们的主要目的之一是确保数据库级别的数据完整性。

大多数数据库也有某种形式的检查约束，其中几乎任何你可以放在 WHERE 子句中的东西都可以用作对数据的检查：

```
CREATE FUNCTION CheckFnctn()
RETURNS int
AS 
BEGIN
   DECLARE @retval int
   SELECT @retval = COUNT(*) 
   FROM PARENT
   INNER JOIN CHILD ON PARENT.ID = CHILD.PARENT_ID
   WHERE CHILD.DATE < PARENT.DATE_MIN OR CHILD.DATE > PARENT.DATE_MAX
   RETURN @retval
END;
GO
ALTER TABLE CHILD
ADD CONSTRAINT chkDates CHECK (dbo.CheckFnctn() = 0 );
GO 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T17:25:14.653

好的，在具体的例子中，我会去冗余存储冗余数据。通过 CHECK 和 FK（以及超级键）的组合，我们确保数据始终正确，然后我们围绕它包装视图和触发器以隐藏实现细节：

```
create table dbo.Parents (
    ParentID int IDENTITY(1,1) not null,
    ValidFrom datetime not null,
    ValidTo datetime not null,
    /* Natural Key column(s) */
    CONSTRAINT PK_dbo_Parents PRIMARY KEY (ParentID),
    CONSTRAINT UQ_dbo_Parents_DRI UNIQUE (ParentID, ValidFrom, ValidTo),
    /* Unique constraint on Natural Key */
    CONSTRAINT CK_dbo_Parents_ValidDates CHECK (ValidFrom <= ValidTo) /* Semi-open interval */
)
go
alter table dbo.Parents add constraint DF_dbo_Parents_ValidFrom DEFAULT (CURRENT_TIMESTAMP) for ValidFrom
go
alter table dbo.Parents add constraint DF_dbo_Parents_ValidTo DEFAULT (CONVERT(datetime,'99991231')) for ValidTo
go
create table dbo._Children (
    ChildID int IDENTITY(1,1) not null, /* We'll need this in the update trigger */
    ParentID int not null,
    ChildDate datetime not null,
    _ParentValidFrom datetime not null,
    _ParentValidTo datetime not null,
    CONSTRAINT PK_dbo__Children PRIMARY KEY (ChildID),
    CONSTRAINT FK_dbo__Children_Parents FOREIGN KEY (ParentID,_ParentValidFrom,_ParentValidTo) REFERENCES dbo.Parents (ParentID,ValidFrom,ValidTo) ON UPDATE CASCADE,
    CONSTRAINT CK_dbo__Children_ValidDate CHECK (_ParentValidFrom <= ChildDate and ChildDate < _ParentValidTo) /* See, semi-open */
)
go
alter table dbo._Children add constraint DF_dbo__Children_ChildDate DEFAULT (CURRENT_TIMESTAMP) for ChildDate
go
create view dbo.Children (ChildID,ParentID,ChildDate)
with schemabinding
as
select ChildID,ParentID,ChildDate from dbo._Children
go
create trigger dbo.T_Children_I on dbo.Children instead of insert
as
begin
    set nocount on

    insert into dbo._Children (ParentID,ChildDate,_ParentValidFrom,_ParentValidTo)
    select i.ParentID,i.ChildDate,p.ValidFrom,p.ValidTo
    from
        inserted i
            inner join
        dbo.Parents p
            on
                i.ParentID = p.ParentID
end
go
create trigger dbo.T_Children_U on dbo.Children instead of update
as
begin
    set nocount on
    if UPDATE(ChildID)
    begin
        RAISERROR('Updates to ChildID are not allowed',16,1)
        return
    end

    update c
    set
        ParentID = i.ParentID,
        ChildDate = i.ChildDate,
        _ParentValidFrom = p.ValidFrom,
        _ParentValidTo = p.ValidTo
    from
        inserted i
            inner join
        dbo._Children c
            on
                i.ChildID = c.ChildID
            inner join
        dbo.Parents p
            on
                i.ParentID = p.ParentID
end
go
insert into dbo.Parents(ValidFrom,ValidTo)
select '20081201','20090101' union all
select '20090201','20090301'
/* (2 row(s) affected) */
go
insert into dbo.Children (ParentID,ChildDate)
select 1,'20081215'
/* (1 row(s) affected) */
go
insert into dbo.Children (ParentID,ChildDate)
select 1,'20090115'
/*
Msg 547, Level 16, State 0, Procedure T_Children_I, Line 6
The INSERT statement conflicted with the CHECK constraint "CK_dbo__Children_ValidDate". The conflict occurred in database "Play", table "dbo._Children".
The statement has been terminated.
*/
go
update dbo.Parents set ValidTo = '20090201' where ParentID = 1
/* (1 row(s) affected) */
go
insert into dbo.Children (ParentID,ChildDate)
select 1,'20090115'
/* (1 row(s) affected) */
go
update dbo.Parents set ValidTo = '20090101' where ParentID = 1
/*
Msg 547, Level 16, State 0, Line 1
The UPDATE statement conflicted with the CHECK constraint "CK_dbo__Children_ValidDate". The conflict occurred in database "Play", table "dbo._Children".
The statement has been terminated.
*/
go
insert into dbo.Children (ParentID,ChildDate)
select 2,'20090215'
/* (1 row(s) affected) */
go
update dbo.Children set ChildDate = '20090115' where ParentID=2 and ChildDate = '20090215'
/*
Msg 547, Level 16, State 0, Procedure T_Children_U, Line 11
The UPDATE statement conflicted with the CHECK constraint "CK_dbo__Children_ValidDate". The conflict occurred in database "Play", table "dbo._Children".
The statement has been terminated.
*/
go
delete from dbo.Children
/* (3 row(s) affected) */
go
/* Clean up after testing */
drop view dbo.Children
drop table dbo._Children
drop table dbo.Parents
go 
```

这是针对 SQL Server 的。在 2005 年测试，但至少也应该在 2000 年和 2008 年工作。这里的一个好处是，即使触发器被禁用（例如嵌套触发器被关闭），你也不能在基表中得到*错误的数据*

# asp.net - 如何修复在 IIS 中运行的 Web 服务中的“无法识别 URL 的请求格式...”错误？

> ID：654099
> 
> 赞同：37
> 
> 时间：2009-03-17T12:52:33.873
> 
> 标签：asp.net, web-services

在 IIS 中运行 Web 服务时出现以下错误：

> “/收件箱服务”应用程序中的服务器错误。无法识别以“/GetMailsInfo”结尾的 URL 的请求格式。说明：执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。
> 
> 异常详细信息：System.InvalidOperationException：无法识别 URL 意外以“/GetMailsInfo”结尾的请求格式。
> 
> 源错误：
> 
> 在执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪来识别有关异常起源和位置的信息。
> 
> 堆栈跟踪：
> 
> [InvalidOperationException：无法识别 URL 意外以“/GetMailsInfo”结尾的请求格式。]
> System.Web.Services.Protocols.WebServiceHandlerFactory.CoreGetHandler（类型类型，HttpContext 上下文，HttpRequest 请求，HttpResponse 响应）+490982 System.Web.Services。 Protocols.WebServiceHandlerFactory.GetHandler(HttpContext context, String verb, String url, String filePath) +104
> System.Web.Script.Services.ScriptHandlerFactory.GetHandler(HttpContext context, String requestType, String url, String pathTranslated) +127
> System.Web.HttpApplication.MapHttpHandler(HttpContext context, String requestType, VirtualPath path, String pathTranslated, Boolean useAppConfig) +175 System.Web.MapHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +120 System.Web.HttpApplication. ExecuteStep(IExecutionStep step, Boolean& completedSynchronously) +155
> 
> 版本信息：Microsoft .NET Framework 版本：2.0.50727.42；ASP.NET 版本：2.0.50727.42

有谁知道我为什么会看到这个错误以及是否有任何方法可以解决它？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-03-17T12:54:54.320

[由于默认情况下禁用](http://support.microsoft.com/default.aspx?scid=kb;en-us;819267)HTTP GET 和 HTTP POST ，请尝试将以下内容添加到您的配置文件中：

```
<configuration>
    <system.web>
    <webServices>
        <protocols>
            <add name="HttpGet"/>
            <add name="HttpPost"/>
        </protocols>
    </webServices>
    </system.web>
</configuration> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-11-02T22:11:44.280

我有同样的问题。要解决它，请将 [ScriptService] 添加到您的服务中

```
 using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Web;
    using System.Web.Script.Services;
    using System.Web.Services;

    namespace DemosAjaxcontroltoolkit
    {
        /// <summary>
        /// Summary description for WebService
        /// </summary>
        [ScriptService] 
        [WebService(Namespace = "http://tempuri.org/")]
        [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
        [System.ComponentModel.ToolboxItem(false)]
        // To allow this Web Service to be called from script, using ASP.NET AJAX, uncomment the following line. 
        // [System.Web.Script.Services.ScriptService]
        public class WebService : System.Web.Services.WebService
        {

            [System.Web.Script.Services.ScriptMethod()]
            [WebMethod]

            public string[] GetWords(string prefixText, int count)
            {
                List<string> words = new List<string>();
                words.Add("Apple");
                words.Add("Appertizer");
                words.Add("Apple tree");
                words.Add("Apple Cider");
                words.Add("Afternoon");
                words.Add("Morning");
                words.Add("Breakfeast");
                words.Add("Lunch");
                words.Add("Spider");
                words.Add("Morning");
                words.Add("Day");
                words.Add("Travel");
                words.Add("Night");
                words.Add("Car");
                words.Add("Bikes");
                words.Add("Love");
                words.Add("Good");

                //return words.Where(w => w.StartsWith(prefixText)).Take(count).ToList();

                //List<string> returnedList = words.Where(w => w.StartsWith(prefixText)).Take(count).ToList();
                return words.Where(w => w.ToUpper().StartsWith(prefixText.ToUpper())).ToArray();
            }

        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-05-16T16:52:48.457

只是出于兴趣（- 在通过 AJAX 访问 Web 服务的情况下）；我发现如果未传递“内容类型”标头（-即使它是本地/“HttpPostLocalhost”请求），则会出现问题，所以我自己传递标头（例如通过 jQuery 的“$.ajax” ()' 方法而不是通过 jQuery 的 '$.getJSON()' 方法），而不是诉诸于此：

[https://support.microsoft.com/en-us/kb/819267](https://support.microsoft.com/en-us/kb/819267)

# windows-mobile - 如何在紧凑框架中检测插件 USB

> ID：654105
> 
> 赞同：1
> 
> 时间：2009-03-17T12:53:29.423
> 
> 标签：windows-mobile, compact-framework, usb, detection, pocketpc

我想将一个带有串行端口的跟踪盒连接到一个 Windows Mobile 的 USB 串行端口。当我通过 USB 将 Windows 移动设备与跟踪盒连接时，是否有检测 USB 插件的方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T21:28:31.020

在某些系统更改期间会触发一个名为 NOTIFICATION_EVENT_DEVICE_CHANGE 的系统事件。我不知道连接您的 USB 设备是否会生成该事件，但这是一个开始的地方。该事件通过本机函数 CeRunAppAtEvent 访问。不要让它的名字欺骗你，CeRunAppAtEvent 既可以用来启动程序，也可以用来通知正在运行的程序事件。

您问题上的标签表明您正在使用紧凑型框架。由于 CeRunAppAtEvent 是本机函数，您将无法直接访问它。您将需要做一些 P/Invokes。为了加快速度，我将向您推荐另一个资源。

以下代码使用 CeRunAppAtEvent 在某些事件期间启动程序。我会以此为起点，看看您是否可以在连接 USB 设备时启动程序。

[http://www.codeproject.com/KB/mobile/WiMoAutostart.aspx](http://www.codeproject.com/KB/mobile/WiMoAutostart.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-29T17:25:26.133

调用[RequestDeviceNotifications](http://msdn.microsoft.com/en-us/library/ms919831.aspx)。它可以[像这篇博](http://blog.opennetcf.com/ctacke/2009/04/20/DetectingDiskInsertionAndRemovalInTheCompactFramework.aspx)文一样工作，只是您要寻找通用设备而不是专门寻找文件系统。

# javascript - 如何在浏览器中检测对 VML 或 SVG 的支持

> ID：654112
> 
> 赞同：60
> 
> 时间：2009-03-17T12:58:21.457
> 
> 标签：javascript, internet-explorer, svg, browser-detection, vml

我正在编写一些 javascript，需要在 SVG 或 VML 之间进行选择（或两者兼而有之，或其他东西，这是一个奇怪的世界）。虽然我知道目前只有 IE 支持 VML，但我更愿意检测功能而不是平台。

SVG 似乎有一些您可以使用的属性：例如 window.SVGAngle。

这是检查 SVG 支持的最佳方式吗？

VML有什么等价物吗？

不幸的是 - 在 Firefox 中，我可以很高兴地在 VML 中进行所有渲染而不会出错 - 屏幕上什么也没有发生。从脚本中很难检测到这种情况。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-04-01T17:30:28.110

我建议对 crescentfresh 的答案进行一项调整 - 使用

```
document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1") 
```

而不是

```
document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape", "1.0") 
```

检测 SVG。WebKit 目前对报告功能非常挑剔，`feature#Shape`尽管有相对可靠的 SVG 支持，但返回 false。[在对https://bugs.webkit.org/show_bug.cgi?id=17400](https://bugs.webkit.org/show_bug.cgi?id=17400)的`feature#BasicStructure`评论中建议了替代方案，并给出了我在 Firefox/Opera/Safari/Chrome (true) 和 IE (false) 上所期望的答案。

请注意，该`implementation.hasFeature`方法将忽略通过插件的支持，因此如果您想检查例如适用于 IE 的 Adob​​e SVG Viewer 插件，您需要单独执行此操作。我想 RENESIS 插件也是如此，但尚未检查。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2011-03-30T23:17:47.033

SVG 检查在 Chrome 中对我不起作用，所以我查看了 Modernizer 库在他们的检查中做了什么（[https://github.com/Modernizr/Modernizr/blob/master/modernizr.js](https://github.com/Modernizr/Modernizr/blob/master/modernizr.js)）。

根据他们的代码，这对我有用：

```
function supportsSVG() {
    return !!document.createElementNS && !!document.createElementNS('http://www.w3.org/2000/svg', "svg").createSVGRect;
  } 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2009-03-17T14:38:08.893

对于 VML 检测，[谷歌地图的作用](http://maps.google.com/intl/en_ALL/mapfiles/73/maps2.api/main.js)如下（搜索“ `function Xd`”）：

```
function supportsVml() {
    if (typeof supportsVml.supported == "undefined") {
        var a = document.body.appendChild(document.createElement('div'));
        a.innerHTML = '<v:shape id="vml_flag1" adj="1" />';
        var b = a.firstChild;
        b.style.behavior = "url(#default#VML)";
        supportsVml.supported = b ? typeof b.adj == "object": true;
        a.parentNode.removeChild(a);
    }
    return supportsVml.supported
} 
```

我明白你对 FF 的意思：它允许创建任意元素，包括 vml 元素（`<v:shape>`）。看起来这是对[邻接属性](http://msdn.microsoft.com/en-us/library/bb250527(VS.85).aspx)的测试，可以确定创建的元素是否真正被解释为 vml 对象。

对于 SVG 检测，这很好用：

```
function supportsSvg() {
    return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape", "1.0")
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-01-27T01:55:38.690

你可能想跳过这个并使用一个 JS 库，它允许你跨浏览器进行矢量绘图，如果这是意图的话。然后，该库将处理此问题，如果支持则输出到 SVG，如果不支持则回退到画布、VML、flash、silverlight 等，具体取决于可用的内容。

将执行此操作的库示例如下：

*   **dojo.gfx** ( [http://docs.dojocampus.org/dojox/gfx/](http://docs.dojocampus.org/dojox/gfx/) )
*   **拉斐尔**( [http://raphaeljs.com/](http://raphaeljs.com/) )
*   **SVGWeb** ( [http://code.google.com/p/svgweb/](http://code.google.com/p/svgweb/) )

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-11-18T06:06:00.103

```
var svgSupport = (window.SVGSVGElement) ? true : false; 
```

如果您假设非 SVG 浏览器是 IE5.5 或更高版本并且可以支持 VML，则可以工作。在 IE6、Firefox 8、Chrome 14.0 上测试。

Raphael 非常酷，但它不支持组的概念，这可能会根据您所做的工作而有所限制。不过，德米特里可能会因为我这么说而激怒我。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-01-26T20:45:57.793

您可能想查看[http://www.modernizr.com/docs/#features-misc](http://www.modernizr.com/docs/#features-misc)，因为它包含对 SVG 功能的实际检测的支持，而不是很容易损坏的用户代理嗅探。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-06-13T16:26:12.513

SVG 检查在 Chrome 中不起作用，因为它指定了 1.0 版。这应该会更好：

```
document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape", "1.1") 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-01-09T06:36:42.457

另一方面...如果您想在提供页面之前知道：刮掉此页面： [http](http://caniuse.com/#cats=SVG&statuses=rec&nodetails=1) ://caniuse.com/#cats=SVG&statuses=rec&nodetails=1 对于传入的浏览器/用户代理。免责声明：我还没有实现这个。正如我希望 caniuse.com 将发布一个可使用的 api。

马克T

# c# - 如何跳过“foreach”循环的迭代？

> ID：654113
> 
> 赞同：355
> 
> 时间：2009-03-17T12:58:22.377
> 
> 标签：c#, .net, loops

在 Perl 中，我可以使用命令跳过 foreach（或任何循环）迭代`next;`。

有没有办法跳过迭代并跳转到 C# 中的下一个循环？

```
 foreach (int number in numbers)
 {
     if (number < 0)
     {
         // What goes here to skip over the loop?
     }

     // otherwise process number
 } 
```

* * *

## 回答 #1

> 赞同：745
> 
> 时间：2009-03-17T13:00:10.343

你要：

```
foreach (int number in numbers) //   <--- go back to here --------+
{                               //                                |
    if (number < 0)             //                                |
    {                           //                                |
        continue;   // Skip the remainder of this iteration. -----+
    }

    // do work
} 
```

这里有更多关于[**`continue`关键字**](http://msdn.microsoft.com/en-us/library/923ahwt1.aspx)的信息。

* * *

**更新：**针对布赖恩在评论中的后续问题：

> 如果我嵌套了 for 循环并想跳过其中一个扩展循环的迭代，您能否进一步澄清我会做什么？
> 
> ```
> for (int[] numbers in numberarrays) {
>   for (int number in numbers) { // What to do if I want to
>                                 // jump the (numbers/numberarrays)?
>   }
> } 
> ```

A`continue`始终适用于最近的封闭范围，因此您不能使用它来跳出最外层的循环。如果出现这样的情况，你需要根据你想要的做一些更复杂的事情，比如`break`从内循环，然后`continue`在外循环。有关[**`break`关键字**](http://msdn.microsoft.com/en-us/library/adbctzc4.aspx)的文档，请参见此处。`break`C# 关键字类似于 Perl`last`关键字。

另外，考虑采用 Dustin 的建议，只过滤掉您不想事先处理的值：

```
foreach (var basket in baskets.Where(b => b.IsOpen())) {
  foreach (var fruit in basket.Where(f => f.IsTasty())) {
    cuteAnimal.Eat(fruit); // Om nom nom. You don't need to break/continue
                           // since all the fruits that reach this point are
                           // in available baskets and tasty.
  }
} 
```

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-03-17T13:35:19.947

另一种方法是在循环执行之前使用 LINQ 进行过滤：

```
foreach ( int number in numbers.Where(n => n >= 0) )
{
    // process number
} 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-17T13:02:22.133

你也可以翻转你的 if 测试：

```
 foreach ( int number in numbers )
{
     if ( number >= 0 )
     {
        //process number
     }
 } 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-03-17T12:59:49.427

```
foreach ( int number in numbers )
{
    if ( number < 0 )
    {
        continue;
    }

    //otherwise process number
} 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2013-12-06T15:31:55.467

使用 linq 的另一种方法是：

```
foreach ( int number in numbers.Skip(1))
{   
    // process number  
} 
```

如果要跳过多个项目中的第一个。

或者`.SkipWhere`，如果您想指定跳过的条件，请使用。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-03-17T13:00:43.417

您可以使用该[`continue`](http://msdn.microsoft.com/en-us/library/923ahwt1.aspx)语句。

例如：

```
foreach(int number in numbers)
{
    if(number < 0)
    {
        continue;
    }
} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-03-17T13:00:24.150

使用 continue 语句：

```
foreach(object number in mycollection) {
     if( number < 0 ) {
         continue;
     }
  } 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2019-07-02T06:55:48.483

最简单的方法如下：

```
//Skip First Iteration

foreach ( int number in numbers.Skip(1))

//Skip any other like 5th iteration

foreach ( int number in numbers.Skip(5)) 
```

# javascript - 在 JavaScript 中分配样式表会创建好的 html，但不会显示样式

> ID：654114
> 
> 赞同：2
> 
> 时间：2009-03-17T12:58:30.740
> 
> 标签：javascript, html, css

我有一些 Javascript 正在打开一个空白窗口，为它分配一个样式表，然后向它写入一些文本。除了内容没有应用样式外，这一切都很好。

代码如下所示：

```
var newWindow = window.open('', 'SecondWindow', 'toolbar=0,stat=0');
var style = newWindow.document.createElement('link');
style.type = "text/css";
style.rel = "stylesheet";
style.href = "styles/style.css"; 
newWindow.document.getElementsByTagName("head")[0].appendChild(style);
newWindow.document.body.innerHTML="<p class='verystylish'>Hello world!</p>"; 
```

如果我使用 Firefox Web Developer 工具查看生成的源代码，将其保存为 html 文件，然后手动打开 html 文件，它会正确应用样式，所以看起来我需要做一些事情来强制浏览器以某种方式应用样式或重新渲染页面。有什么建议么？

编辑添加，生成的源代码如下所示：

```
<html>
  <head>
    <title></title>
    <link href="styles/style.css" rel="stylesheet" type="text/css">
  <head>
  <body>
    <p class='verystylish'>Hello world!</p>
  </body>
</html> 
```

问题是没有为段落分配任何样式。但是打开具有相同源代码的文件会正确呈现。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T04:49:43.830

默认情况下会打开一个新窗口，其 URL 为“about:blank”。因此，相对 URL 引用将不起作用。要更改窗口的位置以匹配原始文档，请调用：

```
newWindow.document.open(); 
```

然后，您应该将所需文档的框架写入窗口。如果需要，您现在可以包含样式表，因为 document.write 是在旧版浏览器中添加样式表的一种比 DOM 方法更可靠的方法。此方法还允许您编写 DOCTYPE，这样您就不会意外地进入 Quirks 模式。

```
newWindow.document.write(
    '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">'+
    '<html><head>'+
    '  <link rel="stylesheet" href="styles/style.css">'+
    '</head><body>'+
    '</body></html>'+
);
newWindow.document.close(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:15:31.930

“它正确应用样式”是什么意思？你在谈论`class="verystylish"`吗？如果是这样，那么这并不意味着样式正在被应用，而是新的段落元素具有该类。

除了那个，你没有向窗口写任何东西`<P>`。您不必编写页面的整个代码，包括`<HTML>`,`<HEAD>`和`<BODY>`标签吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T14:52:46.113

Firefox 没有正确设置基本 URL，因此相对链接 /styles/styles.css 没有指向任何地方（或者至少，这是我通过在新窗口中生成 < a> 元素然后询问的印象相应的浏览器将链接位置复制到剪贴板）。

这意味着如果您加载一个具有正确基本 URL 的空 html 文档（而不是 about:blank），它可能会起作用。过去我不得不做类似的事情（保留一份 about:blank 可用），因为我收到了关于显示混合安全/不安全项目的警告。

# internet-explorer - 在 IE6 和 IE7 上使用修订版 436 渲染 SIFR 时出现问题

> ID：654115
> 
> 赞同：0
> 
> 时间：2009-03-17T12:58:45.747
> 
> 标签：internet-explorer, internet-explorer-6, internet-explorer-7, sifr

我似乎对 SIFR3 有问题。我使用的是版本 436，从我的所有测试来看，这似乎是与 IE6 和 IE7 相关的问题，因为我无法在 Firefox、Chrome、Windows 的 Safari 甚至 IE8 中复制该问题。

问题出现在我公司的网站上，可以在这里看到：[http ://www.wyldeia.co.uk/blog.php](http://www.wyldeia.co.uk/blog.php)

当您第一次进入 IE6 或 IE7 中的页面时，它似乎呈现良好。但是，如果您单击另一页，然后单击浏览器中的后退按钮，则所有文本都将替换为“使用 sIFR3 修订版 436 渲染”的错误。如果您刷新页面，那么问题就会消失，直到您浏览并再次返回。

我已经在两台运行 IE7.0.6000.16809 的独立机器和另一台运行 IE6 的独立机器上进行了尝试，然后我将其升级到 IE8。我最初认为它可能与 Flash 播放器有关，但在从 Flash 播放器的版本 9 升级到 10 时，问题仍然存在。进一步挖掘表明，错误可能是由于 Flash 字体文件损坏，或者存在由 SIFR3 的先前版本生成的文件。但是，我已经使用提供的 fla 版本 436 导出了 flash 字体文件，但问题仍然存在。

通常我喜欢自己追踪答案，但因为我对此有点不知所措，所以如果有人对这里可能发生的事情有任何想法，我将非常感激！

问候，

标记

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-05-13T17:58:24.320

我找到了一个解决方案，
如果您尝试用鼠标光标悬停，文本将显示正确，所以..

我只在检测到 IE9 时编写了几行代码来`sifr-config.js`
强制闪存重置**onReplacemment**回调。

您必须使用 Jquery 进行浏览器检测或使用其他 javascript 方式

请参阅以下链接： [http ://www.voo-doo.net/robotphobia/2011/05/fix-sifr-ie9](http://www.voo-doo.net/robotphobia/2011/05/fix-sifr-ie9)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T22:26:33.253

我知道这可能发生的唯一情况是，如果`innerHTML`sIFR 电影的祖先发生了变化。这会重置 Flash 影片 HTML，这在 IE 中会导致 Flash 变量丢失。通常 sIFR 可以解决这个问题，但如果更改发生在浏览器历史记录之后，它可能无法解决。

建议：

1.  页面上是否运行设置`innerHTML`属性的代码？尝试禁用此功能。

2.  尝试禁用任何非 sIFR 代码，看看是否有帮助。

3.  设置`sIFR.useDomLoaded = false;`before `sIFR.activate()`，这会延迟 sIFR 初始化，直到页面加载，所以可能是什么原因导致这将在那个时候运行。

如果确实是这个问题，我认为没有任何解决方法。但肯定知道这是一件好事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-16T22:17:47.120

我有同样的症状，并通过将包含元素的字体大小设置为使用 px 而不是 em 来解决它。

# java - 关闭套接字和 ObjectOutputStream 的正确方法？

> ID：654117
> 
> 赞同：8
> 
> 时间：2009-03-17T12:59:02.423
> 
> 标签：java, networking, sockets, serialization

我正在用 Java 编写一个网络应用程序，以在客户端和服务器之间进行通信，我使用序列化对象来表示数据/命令并通过对象输出/输入流发送它们。

我在干净地关闭连接时遇到问题，我认为我缺少一些我并不真正了解的基本知识，我以前从未使用过带有序列化的套接字。

无论我尝试关闭连接的任何命令（先关闭客户端，先关闭服务器）`ConnectionReset`都会引发异常。我无法捕获此异常，因为客户端在另一个线程中运行到程序的其余部分不断侦听消息，这必须完成，因为在 Java`socket.read()`中是一种阻塞方法。

关闭我用来发送对象的套接字的正确方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T13:46:36.380

您需要向您的侦听器（无论是客户端还是服务器，都无所谓）发送某种信号以停止侦听更多数据。这是一个非常简单的例子：

```
ObjectInputStream ois = new ObjectInputStream(new BufferedInputStream(sock.getInputStream()));

while (true) {
    Object obj = ois.readObject();

    if (obj instanceof String) {
        if ((String)obj).equalsIgnoreCase("quit")) {
            break;
        }
    }

    // handle object
}

ois.close();
sock.close(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T13:37:35.997

您可能不应该等待从套接字读取（），而另一端正在关闭它。在一个好的网络协议中，客户端可以在关闭连接之前通知服务器它没有更多要写的东西（可能通过向它发送一个特殊的关闭字符）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-26T03:47:24.990

`ObjectInputStream.readObject()``EOFException`如果对等方已完成发送对象并关闭连接，将抛出。你一定忽略了它。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-01-28T09:32:05.233

您可以通过 TCP/IP 协议实现您的协议。使用该协议的数据包的头部分将表示不同类型的数据包，如连接数据包、数据数据包、关闭连接数据包等。

# php - PHP 和 URL 函数中的变量变量

> ID：654120
> 
> 赞同：1
> 
> 时间：2009-03-17T12:59:29.567
> 
> 标签：php, variables

这是一段代码：

```
$obj = new myClass();
$obj->{$_GET["func"]}($_GET["param"]) 
```

它基于可变变量工作，但我真的不明白如何。据我所知，变量变量用于这样的东西：

```
require "dbsettings.php"
$member_id = $_GET['id'];
$db = new DBconnector();
$vars = array('username','passw','email','info','datejoined','dateofbirth');

foreach ($vars as $var) {
  $$var = $db->getUserInfo($member_id,$var);
}
echo $username;
echo $passw;
echo $email;
echo $info;
echo $datejoined;
echo $dateofbirth; 
```

那么，在第一段代码中，发生了什么？另外，大括号有什么作用？他们告诉编译器怎么想？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T13:09:03.910

```
$obj->{$_GET["func"]}($_GET["param"]) 
```

只需调用名称存储在 $_GET["func"] 中的方法，并作为参数 $_GET["param"] 传递。

括号用于消除方法名称的歧义（您也可以在字符串中使用括号用于类似目的，例如`echo "calling {$_GET['func']}";`

有关更多信息，请参阅[有关变量变量的 PHP 手册页](http://uk.php.net/manual/en/language.variables.variable.php)，例如

> 为了在数组中使用可变变量，您必须解决歧义问题。也就是说，如果您编写，`$$a[1]`那么解析器需要知道您是否打算`$a[1]`用作变量，或者您是否想要`$$a`用作变量，然后是该变量的`[1]`索引。解决这种歧义的语法是：`${$a[1]}` 第一种情况和`${$a}[1]`第二种情况。

**关于安全的说明**

由于这是公认的答案，我要补充一点，您不应该如此盲目地使用用户输入，$obj 上可能存在您不想被调用的方法。

例如，您可以根据允许的方法数组检查方法名称，例如

```
$method=$_GET["func"];
$ok=in_array($method, array('foo', 'bar', 'frobozz')); 
```

或者，您只能允许遵循特定模式的方法名称，例如以“ajax”为前缀：

```
$method=$_GET["func"];
$ok=preg_match('/^ajax[A-Za-z]/', $method); 
```

或者该想法的变体，将前缀添加到传递的方法名称中，以便只能调用具有该前缀的方法

```
$method='ajax'.preg_replace('/[^A-Za-z]/', '', $_GET["func"]); 
```

还有其他方法，但希望这能说明一个基本原则：*假设你最大的敌人构建了`$_GET`数组！*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:09:19.667

它基本上是根据参数调用一个函数。

因此，如果您提出如下请求：

```
mypage.php?func=prop&param=value 
```

你最终会得到这个函数调用：

```
$obj->prop('value') 
```

大括号用于将数组表示法保持在一起，并将 ["func"] 应用于 $_GET 变量而不是 $obj->$_GET （可能是有效数组）。如果您不使用大括号，您将执行的操作类似于：

```
($obj->$_GET)["func"](...) 
```

在这种情况下，请注意您将要求数组 $obj->$_GET 的键“func”，而不仅仅是 $_GET。

# javascript - 令人抓狂的 IE javascript 问题？

> ID：654125
> 
> 赞同：2
> 
> 时间：2009-03-17T13:00:03.153
> 
> 标签：javascript, jquery, internet-explorer

我有一个使用一点 jQuery 的页面和一个名为“kwick”的效果 - 在我托管在[http://www.batsumaru.com/main.html](http://www.batsumaru.com/main.html)的示例页面中，它在所有浏览器中都可以正常工作，没问题。但是在[http://www.batsumaru.com](http://www.batsumaru.com)生成实际代码时， Internet Explorer 显示脚本错误（对象不支持）。

我尽力调试，但无法弄清楚发生了什么，代码从一页到另一页似乎相同，谁能告诉我可以为我扭转这一局面并帮助我应对 IE 的美妙世界的天才洞察力?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T13:19:55.477

这是一个 IE“错误”（因为它假装具有 ID 的元素是 Javascript 全局级别的标识符）和 Kwick 插件的组合，该插件无法`var`使用变量。

Kwick 在内部使用了一个名为 的变量`container`，但不使用`var`它，因此它将在全局范围内创建。您的页面包含一个带有 ID 的 div，`container`因此 IE 假定 Kwick 代码正在尝试为基于 COM 的元素的默认属性分配一个值，DOM 元素没有默认属性，因此出现“不支持”错误。

将 div ID 更改为其他内容，一切都应该很好。

# python - Python 哈希函数

> ID：654128
> 
> 赞同：0
> 
> 时间：2009-03-17T13:00:41.170
> 
> 标签：python, hash

在python中散列层次结构（类似于文件结构）的好方法是什么？

我可以将整个层次结构转换为一个虚线字符串，然后对其进行哈希处理，但是有没有更好（或更有效）的方法来做到这一点而无需一直来回走动？

我可能想要散列的结构示例是：

```
a -> b1 -> c -> 1 -> d
a -> b2 -> c -> 2 -> d
a -> c -> 1 -> d 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T13:12:32.577

如果您可以将层次结构组件作为元组访问，只需对其进行散列 - 元组是可散列的。您可能不会在与分隔字符串之间的转换中获得很多收益，但这是一个开始。

如果这没有帮助，也许您可​​以提供有关如何存储层次结构/路径信息的更多信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T16:48:32.557

你想如何访问你的层次结构？

如果您总是要检查完整路径，那么按照建议，使用元组：例如：

```
>>> d["a","b1","c",1,"d"] = value 
```

但是，如果您要执行诸如“快速找到“a -> b1”下面的所有项目，将其存储为嵌套哈希表可能更有意义（否则您必须遍历所有项目以找到您'感兴趣）。

为此，defaultdict 可能是最简单的存储方式。例如：

```
from collections import defaultdict

def new_dict(): return defaultdict(new_dict)
d = defaultdict(new_dict)

d["a"]["b1"]["c"][1]["d"] = "test"
d["a"]["b2"]["c"][2]["d"] = "test2"
d["a"]["c"][1]["d"] = "test3"

print d["a"]["c"][1]["d"]  # Prints test3
print d["a"].keys()        # Prints ["c", "b1", "b2"] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T14:51:34.743

[您可以通过实现该方法](http://docs.python.org/reference/datamodel.html#object.__hash__)使任何对象可散列[`__hash__()`](http://docs.python.org/reference/datamodel.html#object.__hash__)

因此，您可以简单地`__hash__()`向存储您的层次结构的对象添加一个合适的方法，例如递归计算哈希等。

# html - 绝对定位网站上的所有内容？

> ID：654134
> 
> 赞同：9
> 
> 时间：2009-03-17T13:01:56.767
> 
> 标签：html, css, web-standards, css-position

我与某人讨论了绝对定位。他声称最好的做法是确保在大多数浏览器中一切看起来都一样，并且这是保持网站外观和感觉的最简单方法。

我不同意他的观点，绝对定位将是补救措施，也是布局网页的整体最佳方法。

就我而言，我更热衷于使用边距/宽度/仔细浮动调整的方法，有时还使用偶尔的表格。这是一个轻微的概括，当然，我不会仅仅因为我在意识形态上反对它而停止使用绝对定位，只是我发现方法绝对定位，一条规则适合所有方法，正如我的同行所倡导的那样比较怀疑。

对此的普遍共识是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-17T13:10:36.513

互联网不是印刷品，我认为绝对定位所有内容并不理想。我认为您可以通过使用您的方法确保事情看起来更好，也许可以通过在某些宽度上使用 EM 来增强页面，以使页面在不同的屏幕尺寸（和 DPI）上更加流畅。这使您的内容可以更好地扩展，并且随着移动浏览变得越来越流行，这一点很重要。

根据我的经验，当您计划页面必须适应不同的设备时，页面总体上看起来会更好，而不是像您在打印中看到的那样尝试强制 100% 像素完美的布局。这不是互联网的本质。

**编辑：**多想一下，如果你不小心的话，使用所有绝对的东西可能真的会用移动浏览器咬你。当您的网站在 iPhone 之类的设备上使用绝对定位时会发生什么（假设您将某些元素与角落对齐）？定位将与 iPhone 的角对齐，这是一个奇数比（与计算机相比）和小得多的分辨率；把一切都搞砸了。如果您使用浮动/宽度/等的组合，您将确保网站保持其原始大小并且您只需要滚动。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-17T13:06:37.707

我的一般观点是目的证明手段是正当的。

实用主义在这里至高无上。最终目标是让它尽可能快地在最广泛的浏览器上运行。是否使用绝对定位，是否使用表格，是否使用纯CSS……所有这些问题，充其量都是次要的。

实际上，我发现那里有多少“表仇恨”很奇怪，但是，正如无数次记录的那样，如果您想做一些事情（例如垂直居中）并使其与 IE6 兼容，那么没有更快、更容易和更多的方法了兼容的解决方案。

我不赞成或反对表格、绝对定位或任何东西。我唯一“支持”的是它有效。

因此，在这种情况下，我发现关于“激进”绝对定位的论点——由于缺乏更好的描述——无关紧要的干扰。

在大多数情况下，使用所有这些东西（表格、绝对定位、纯 CSS 等）您并没有解决所有问题，您只是在用一组问题换另一组问题。这可能没问题，因为在你正在做的事情的背景下，一组问题可能更可取，但没有灵丹妙药（无论是绝对定位还是其他任何东西）。

根据经验，我在获得绝对定位以做我想做的事情（跨浏览器）时遇到的问题与任何其他方法一样多。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-17T13:22:16.687

绝对定位通常很糟糕。您很少希望您的网站在某人的 1024x768 笔记本电脑上与他们的 1920x1200 台式机上的全屏显示相同。另外，祝你好运，用不同的用户字体大小来协调你的绝对定位。

提醒您的同行，用户更愿意看到*他们*想要的网站外观，而不是*他*想要的外观和感觉（在合理范围内）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-17T13:07:40.873

保证所有浏览器的一切看起来都一样是一个困难的目标，主要是因为你总是瞄准一个移动的目标。

网站是本质上主要是文本的内容的交付机制。如果您的内容依赖于像素完美的定位，例如动画图形等，那么 HTML 和 Javascript 可能不是您的最佳解决方案。如果您的段落在 Firefox 中的页面上比在 IE 中低一个像素，这真的很重要吗？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-17T13:09:35.720

虽然它可能非常主观，但我不喜欢绝对定位，因为您*应该*检查禁用 CSS 以查看非 CSS 感知浏览器的内容如何降级（例如搜索引擎、基于控制台的文本浏览器和 HTML- >盲人语音浏览器）。

不绝对定位的另一个主要优点是，您可以拥有更通用的 CSS，在整个网站上共享，而不必在代码中乱扔定位语句——如果客户突然让他们的徽标具有不同的效果，那就太可怕了纵横比，需要移动一切......

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-18T11:26:41.787

使用绝对定位总是会在以后咬你。站点应尽可能处于正常流动状态，以便元素可以相互关联（增长/缩小，隐藏时折叠等）。

使用绝对定位的布局，每当内容发生变化时，您总是需要调整布局。

我只是出于三个原因真正使用绝对定位：

1）我将一个元素放在其他元素之上，比如一个弹出框。

2) 确实没有什么好的方法可以将元素放置在正常流程中需要的位置

4）元素将被动态操作（javascript），这需要在正常流程之外发生。

在使用绝对定位时，我倾向于遵守的另一条规则是使用另一个元素作为相对定位的父元素。这样，绝对定位的元素将相对于该父元素，而不是视口（视口通常会根据页面的查看方式改变其尺寸）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-18T05:07:30.153

> 他声称确保在大多数浏览器中一切看起来都一样的最佳实践

您*无法*确保在大多数浏览器中一切看起来都一样。根据平台、设置和可用性，字体总是以不同的方式呈现。如果您使用完全绝对定位（例如，每个元素的水平*和*垂直位置以像素为单位），那么字体大小的任何偏差都可能导致文本行相互重叠，从而使页面不可读.

有 WYSIWYG 设计工具可以做到这一点（有些人会以这种方式滥用 Dreamweaver），但它通常被认为是一种非常糟糕的方法。更常见的是，绝对定位仅用于水平轴，以制作固定宽度的页眉和页脚，同时允许页面中的文本根据需要占用尽可能多的垂直空间。（这就是 SO 所做的，例如，在许多其他方面。）

关于浏览器宽度的固定与液体布局争论是一场将永远肆虐的宗教战争，但显然正确的总结是液体是最好的。;-)

（......如果更难完成，抓住。）

> 这是保持网站外观和感觉的最简单方法。

是的！解决问题的坏方法通常是最简单的。但是“最佳实践”？几乎不。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-17T13:06:53.450

仅当您 100% 确定所涉及的元素永远不必缩放其大小并且不会四处移动时，才使用绝对定位。如果您绝对定位了某个元素，然后另一个元素增长，它们可能会重叠并且您的布局被破坏。我会非常小心地使用绝对定位，并且通常建议反对它。几乎总是可以通过使用浮动元素和/或相对定位来实现相同的布局。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-18T10:56:47.177

> 仅当您 100% 确定所涉及的元素永远不必缩放其大小并且不会四处移动时，才使用绝对定位。如果您绝对定位了某个元素，然后另一个元素增长，它们可能会重叠并且您的布局被破坏。

这是正确的。我刚为某个人修了一个网站赚了 500 美元，并教他他的绝对定位网站在他添加逗号的那一刻就坏了，因为文本会重新流动，整个事情就会崩溃。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-17T15:06:25.160

**cletus**有一点。作为开发人员，最终的问题是——我们想要做到多彻底？如果让您的网站快速发布是最重要的，那么可能会牺牲额外的预防措施。如果使网站“防弹”是一个优先事项，那么这样做将花费大量时间和精力。我个人绝不会以方便的名义牺牲可扩展性和/或可用性。在我的书中，每次缩放都使布局的绝对定位不合格。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-17T15:10:59.110

我完全不喜欢绝对定位，但我看到 Web 开发人员使用它来获得更好的搜索结果，因为他们可以轻松地将最重要的文本部分放在 HTML 的开头，并使用绝对定位将其定位到它的位置实际上属于。

即使是那个论点，我也不会使用它，因为有一些方法可以让 HTML 对搜索引擎友好，但仍然使用流畅的布局，例如[The Perfect 3 Column Liquid Layout](http://matthewjamestaylor.com/blog/perfect-3-column.htm)或其他变体。

# isaserver - ISA 服务器，发布通配符站点

> ID：654145
> 
> 赞同：1
> 
> 时间：2009-03-17T13:04:48.383
> 
> 标签：isaserver

我们的 DNS 服务器上有一个通配符 dns 映射，所有对 *.A.com 的请求都被重定向到我们的 ISA 服务器。我们需要将所有请求重定向到内部网站[http://10.10.10.10](http://10.10.10.10)。我们还需要保持主机头完整，以便我们可以在 Web 服务器上重写 url。
ISA有可能吗？

亲切的问候，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T13:19:03.437

我相信这是可能的。

设置侦听器以侦听端口 80 上的所有内容。

在公共名称选项卡集中 *.A.com。

在 To 选项卡中将 IP 地址设置为 10.10.10.10

此外，请确保选中 Forward the original host header 而不是实际的，复选框。

# c# - 通过 MSComm1 发送 ctrl-E

> ID：654146
> 
> 赞同：2
> 
> 时间：2009-03-17T13:04:49.960
> 
> 标签：c#, serial-port

如何通过串口 MSComm1 发送 ctrl-E ？它应该继续传递 ctrl-E .... 像 for 循环或做 while 循环 ..这是我的代码：

MSComm1.CommPort = Convert.ToInt16(Settings.Default.PortName); SendKeys.Send("^(e)");
MSComm1.Settings = Settings.Default.BaudRate.ToString().Trim() + "," + Settings.Default.Parity.Substring(0, 1).ToString().Trim() + "," + Settings.Default .DataBits.ToString().Trim() + "," + Settings.Default.StopBits.ToString().Trim();
MSComm1.PortOpen = 真；
MSComm1.InputLen = 0;
MSComm1.InputMode = MSCommLib.InputModeConstants.comInputModeText;
if (Settings.Default.FlowControl == "Xon/Xoff")
{
MSComm1.Handshaking = MSCommLib.HandshakeConstants.comXOnXoff;
}
else if (Settings.Default.FlowControl == "None")
{
MSComm1.Handshaking = MSCommLib. HandshakeConstants.com无；
}
否则 if (Settings.Default.FlowControl == "RTS")
{
MSComm1.Handshaking = MSCommLib.HandshakeConstants.comRTS;
}
else if (Settings.Default.FlowControl == "RTSXon/Xoff")
{
MSComm1.Handshaking = MSCommLib.HandshakeConstants.comRTSXOnXOff; }

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T13:08:40.963

Control-E 是 5 的键盘快捷键，因此：

```
serial.Write(new byte[]{ 5 }, 0, 1); 
```

（假设 serial 是 System.IO.Ports.SerialPort 的一个实例。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:09:03.787

[从这里](http://msmvps.com/blogs/coad/archive/2005/03/23/SerialPort-_2800_RS_2D00_232-Serial-COM-Port_2900_-in-C_2300_-.NET.aspx)使用 C# 进行串行端口通信：

```
private static void SendSampleData() {
  // Instantiate the communications
  // port with some basic settings
  SerialPort port = new SerialPort("COM1", 9600, Parity.None, 8, StopBits.One);

  // Open the port for communications
  port.Open();

  // Write a string
  port.Write("Hello World");

  // Write a set of bytes
  port.Write(new byte[] {0x0A, 0xE2, 0xFF}, 0, 3);

  // Close the port
  port.Close(); 
} 
```

现在您只需要以某种方式对 Ctrl+E 进行编码。

# batch-file - 批处理文件：获取绝对路径

> ID：654152
> 
> 赞同：5
> 
> 时间：2009-03-17T13:05:22.813
> 
> 标签：batch-file

我收到一个包含以下内容的文件：

```
\direcotry1\directory2\directory3\file1
\direcotry1\file2
\direcotry1\directory2\directory3\directory4\file3
\direcotry1\file4
\direcotry1\directory2\file5
file6 
```

文件中的文件数量和目录数量是可变的。

我需要的只是路径。

```
\direcotry1\directory2\directory3\ for file1
\direcotry1\ for file2
\direcotry1\directory2\directory3\directory4\ for file3
\direcotry1\ for file4
\direcotry1\directory2\ for file5
and nothing for file6 
```

我使用了变量 %%~pi，它适用于除最后一个之外的所有变量。对于它返回的最后一个 \cft\
我猜 \cft\ 是在调用 bat 文件的程序从那里启动它时返回的。

```
FOR /F %%i in (test.txt) DO (
  echo %%~pi
  command1
  command2
) 
```

有谁知道如何避免 batfile 返回 \cft\？当没有路径时，我希望蝙蝠什么都不返回。

非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T01:12:28.160

在进行了一些测试之后，似乎`"%%~pi"`会将当前目录添加到每个不以 . 开头的元素的前缀`"\"`。我认为它假设是这种情况，因为如果您只使用“文件”，那将是您要打开的文件——类似地，“x\y”将是文件“\x\y”。

例如，以下脚本：

```
@echo off
for /f %%i in (test.txt) DO (
    echo %%~pi
) 
```

在以下文件上运行时：

```
\directory1\directory2\directory3\file1
\directory1\file2
\directory1\directory2\directory3\directory4\file3
\directory1\file4
\directory1\directory2\file5
file6
x\y
\z 
```

将产生（我在 \Documents and Settings\Administrator 目录中）：

```
\directory1\directory2\directory3\
\directory1\
\directory1\directory2\directory3\directory4\
\directory1\
\directory1\directory2\
\Documents and Settings\Administrator\
\Documents and Settings\Administrator\x\
\ 
```

所以答案很简单。首先检测那些不以开头的行`"\"`并对其进行特殊处理。以下脚本：

```
@echo off
setlocal enableextensions enabledelayedexpansion
for /f %%i in (test.txt) DO (
    set ch0=%%i
    set ch0=!ch0:~0,1!
    if not "!ch0!"=="\" (
        echo.
    ) else (
        echo.%%~pi
    )
)
endlocal 
```

生成您想要的输出，如下所示：

```
\directory1\directory2\directory3\
\directory1\
\directory1\directory2\directory3\directory4\
\directory1\
\directory1\directory2\

\ 
```

setlocal/endlocal 是我现在大部分脚本中的内容，因为它可以防止环境变量泄漏一级并且延迟扩展非常棒（使用`"!"`而不是`"%"`）。

我使用 ch0 临时变量来获取文件的第一个字符（`"!ch0:~0,1!"`是一个子字符串运算符，“在 ch0 变量的偏移量 0 处获取一个字符”，`"%"`如果您不进行延迟扩展，您也可以使用该版本）。

然后我将其与`"\"`. 如果是斜线，我会回显`"%%~pi"`，否则我只会根据您的规范输出一个空行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T13:18:58.240

您可以将要忽略的目录存储在变量中：

```
FOR %%i in (file) do set ignoredir=%%~pi
FOR /F %%i in (test.txt) DO (
  if not %%~pi == %ignoredir% echo %%~pi
)
set ignoredir= 
```

这按预期工作。输出：

```
\direcotry1\directory2\directory3\
\direcotry1\
\direcotry1\directory2\directory3\directory4\
\direcotry1\
\direcotry1\directory2\ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T13:09:44.503

**更新2：**

正如 Lieven 所指出的，如果您可以强制 test.txt 文件中的所有内容都以“\”开头，那么您可以使用以下代码：

```
@echo off
FOR /F %%i in (test.txt) DO (
  if not "%%~pi" == "\" echo %%~pi
) 
```

**更新：**

实际上，在再次阅读您的问题后，我注意到您需要的是一个 EXIST 语句。

FOR /F %%i in (test.txt) DO (如果存在 %%i echo %%~pi command1 command2 )

这是你需要的吗？

**我原来的帖子...**

当您调用批处理文件时，只需执行以下操作：

```
yourbatchfile.bat >nul 2>nul 
```

任何进入 stdout 和 stderr （你的屏幕显示）的东西都将被传送到任何地方，也不会出现。请注意，该批处理文件绝对不会输出任何内容...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T13:18:44.403

这似乎是由于 file6 前面缺少反斜杠。
是否可以将输入更改为始终具有前导反斜杠？

您的输入将变为

```
\directory1\directory2\directory3\file1 
\directory1\file2 
\directory1\directory2\directory3\directory4\file3 
\directory1\file4 
\directory1\directory2\file5 
\file6 
```

# c# - C#如何转换表达式 > 到表达式 >

> ID：654153
> 
> 赞同：15
> 
> 时间：2009-03-17T13:06:04.747
> 
> 标签：c#, linq-to-sql, lambda, repository-pattern, expression-trees

我之前使用过基于 lamdas 的 C# 表达式，但我没有手工编写它们的经验。给定一个`Expression<Func<SomeType, bool>> originalPredicate`，我想创建一个`Expression<Func<OtherType, bool>> translatedPredicate`.

在这种情况下 SomeType 和 OtherType 具有相同的字段，但它们不相关（没有继承并且不基于公共接口）。

背景：我有一个基于 LINQ to SQL 的存储库实现。我将 LINQ to SQL 实体投影到我的模型实体中，以将我的模型保存在 POCO 中。我想将表达式传递给存储库（作为规范的一种形式），但它们应该基于模型实体。但我不能将这些表达式传递给数据上下文，因为它需要基于 LINQ to SQL 实体的表达式。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-17T13:51:32.420

使用`Expression`，最简单的方法是使用转换**表达式**：

```
class Foo {
    public int Value { get; set; }
}
class Bar {
    public int Value { get; set; }
}
static class Program {
    static void Main() {
        Expression<Func<Foo, bool>> predicate =
            x => x.Value % 2 == 0;
        Expression<Func<Bar, Foo>> convert =
            bar => new Foo { Value = bar.Value };

        var param = Expression.Parameter(typeof(Bar), "bar");
        var body = Expression.Invoke(predicate,
              Expression.Invoke(convert, param));
        var lambda = Expression.Lambda<Func<Bar, bool>>(body, param);

        // test with LINQ-to-Objects for simplicity
        var func = lambda.Compile();
        bool withOdd = func(new Bar { Value = 7 }),
             withEven = func(new Bar { Value = 12 });
    }
} 
```

但是请注意，不同的提供者将对此提供不同的支持。例如，EF 可能不喜欢它，即使 LINQ-to-SQL 喜欢。

**另一种选择是完全**重建表达式树，使用反射找到相应的成员。复杂得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-04-24T14:12:05.200

我发现了另一种方法，它还包括包装您的原始委托。

```
Func<T, object> ExpressionConversion<U>(Expression<Func<T, U>> expression)
{
    Expression<Func<T, object>> g = obj => expression.Compile().Invoke(obj);
    return g.Compile();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T13:08:33.927

没有隐含的方式来进行翻译。您必须将现有委托包装在从参数类型创建新类型的 lambda 中：

```
var translatedPredicate = x => originalPredicate(OtherTypeFromSomeType(x)) 
```

Where从参数`OtherTypeFromSomeType`创建`OtherType`实例。`SomeType`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-05-09T22:36:45.523

我和你有同样的问题，我用 EF 解决了这个问题：

```
var viewModeValue = dbContext.Model.Select(m => new ViewModel{Field = m.Field}).Where(predicate) //predicate is an Expression<Func<ViewModel, bool>> 
```

Entity Framework 知道如何构建正确的 sql 命令。转换表达式要复杂得多，因为它是不可变的，如果你做错了什么，可能会导致不希望的运行时效果，至少在我的情况下，它是不需要的。

# c++ - 分析用 C 或 C++ 编写的程序

> ID：654154
> 
> 赞同：4
> 
> 时间：2009-03-17T13:06:05.853
> 
> 标签：c++, c, profile

你会建议什么最好的工具来分析 C/C++ 代码并确定哪些部分花费的时间最多。目前，我只是依靠日志，但是由于引入了不必要的延迟，因此信息当然不准确。

优选地，如果存在这样的工具，该工具还能够检测/建议可以优化的区域。

平台：Linux

该应用程序应在嵌入式环境中使用，因此它应该是轻量级的和外部的（不是某些 IDE 上的插件）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T13:10:44.687

我可以衷心推荐[`callgrind`](http://valgrind.org/info/tools.html#callgrind)与[KCachegrind](http://kcachegrind.sourceforge.net/html/Home.html)结合使用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T13:16:39.417

linux/freebsd 上的“gprof”是一个非常简单有效的工具，可以识别哪些例程在运行时占用 CPU。它提供了函数的嵌套和平面配置文件。它为您提供在分析器运行时执行的每个函数占用的 CPU 时间百分比，以及函数本身占用的百分比，以及其子函数占用的百分比。这可以帮助您轻松隔离有问题的功能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T13:11:49.303

我使用 Microsoft Visual C++ 的分析器获得了很好的体验，还有其他外部程序，例如[Intels VTune](http://www.intel.com/cd/software/products/asmo-na/eng/239144.htm)，但它们中的大多数都不是免费的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T13:12:27.070

取决于平台。如果您使用的是 MSVC，则它的某些版本具有内置的分析器。AMD 和 Intel 都有可用的分析器（CodeAnalyst 和 VTune）。

在 Linux 上，我唯一使用的是 gprof，但我知道还有其他的（我认为 AMD 或 Intel 的也可能在 Linux 版本中可用）

当然，整个 Valgrind 套件也可能会有所帮助。一些工具，如 callgrind 或 cachegrind 可以为您提供大量有关性能的信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T13:18:49.690

有很多很好的分析工具，比如 Quantify 或 KCachegrind。这些工具的一个问题是它们会降低运行时性能，因此在某些大型系统上它们可能无法很好地扩展。

有时只需在调试器中运行并按 ctrl-c，查看堆栈跟踪并重复此操作可能 4 次就足够了。

如果你总是在代码的同一部分，那么你已经找到了你可能花费大部分时间的地方。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T13:20:10.983

你显然想要两件事：

1.  分析您的代码并对其进行测量。

2.  检测可以优化的区域。

这些是不同的问题。尽管您可能被告知了什么，但它们并不相同。

对于问题 (1)，将建议许多好的分析器。

对于问题 (2)，分析器只能间接帮助。
有一种更简单且通常更有效的技术。

[看这里](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T13:26:05.087

如果我们谈论的是 UNIX 世界，我会选择 gprof / oprofile。

您确实需要重新编译您的应用程序（至少使用 gprof）。

[教授](http://www.cs.utah.edu/dept/old/texinfo/as/gprof.html)

[轮廓](http://oprofile.sourceforge.net/news/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T13:14:32.213

如果您使用的是 Windows，我建议您使用[AQTime](http://www.automatedqa.com/)。支持几乎所有的编译器，包括 .NET、Delphi 和 VB（当然还有所有的 C++ 编译器 (; )，并且是我尝试过的最好的分析工具。它不仅仅是一个性能分析器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-06T22:08:45.647

对于性能测量， [oprofile是一个不错的选择，因为](http://oprofile.sourceforge.net)[Linux 工具项目](http://www.eclipse.org/linuxtools/) 中有一个用户友好的 eclipse 插件。

# indexing - 在 Lucene 中索引令牌二元组

> ID：654155
> 
> 赞同：6
> 
> 时间：2009-03-17T13:06:19.707
> 
> 标签：indexing, lucene

我需要在 Lucene 中索引双元词（令牌）。我可以生成 n-gram 并将它们编入索引，但我想知道 Lucene 中是否有一些东西可以为我做这件事。我发现 Lucene 只索引 n-gram 的字符。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T13:24:39.973

使用 NGramTokenizer：

[http://lucene.apache.org/java/2_3_2/api/contrib-analyzers/org/apache/lucene/analysis/ngram/NGramTokenizer.html](http://lucene.apache.org/java/2_3_2/api/contrib-analyzers/org/apache/lucene/analysis/ngram/NGramTokenizer.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-14T20:53:20.913

您正在寻找的类是 ShingleFilter：[http ://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/shingle/ShingleFilter.html](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/shingle/ShingleFilter.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T13:14:59.047

根据您需要索引二元语法的原因，[SpanQuery](http://lucene.apache.org/java/2_2_0/api/index.html?org/apache/lucene/search/spans/SpanQuery.html)和/或[SnowballAnalyzer](http://lucene.apache.org/java/2_3_2/api/index.html?org/apache/lucene/analysis/snowball/SnowballAnalyzer.html)可能会有所帮助。

# .net - 通缉：不受 AbandonedMutexException 影响的跨进程同步

> ID：654166
> 
> 赞同：3
> 
> 时间：2009-03-17T13:08:12.120
> 
> 标签：.net, windows, multithreading, synchronization, mutex

我有几个线程获取互斥体然后终止。

互斥体存储在主存储库中，并在程序存在时正确释放。但是，当分配 Mutex 的线程存在时，互斥锁会自动释放，随后会获取 AbandonedMutexException（也根据[文档](http://msdn.microsoft.com/en-us/library/system.threading.abandonedmutexexception.aspx)）。

如何避免此异常，并在分配线程完成后继续使用互斥锁？.Net 中是否有另一个更合适的同步结构没有这个限制。

**注意**- 我正在寻找一种与 Mutex 具有相似语义的跨进程同步机制。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T13:47:28.017

**对问题的回应**

AFAIK 不存在这样的 Mutex 类。AbandonedMutexException 非常烦人，但它代表了一种没有自动解决方案的真实情况。

当你有跨进程，甚至是跨线程通信时，你必须处理这样一个事实，即任何一个参与实体都可能因各种原因意外并突然终止。互斥锁的存在是为了保护资源，如果一个线程在持有互斥锁时被放弃，操作系统就无法保证它以任何一致的方式留下数据。这非常重要，因为这意味着放弃线程可能会使其他线程依赖的某些不变量无效。

AbandonedMutexException 是一种主动说“坏事发生了，你现在处于不确定状态”的方式。对于操作系统，这里真的没有其他办法。

**回复您的回答**

EventWaitHandle 与 Mutex 不同，用于不同的目的。

互斥锁用于保护特定资源，就像锁定语句一样。当一个特定的线程获得一个互斥锁时，就说它拥有这个互斥锁。一次只能有一个所有者。因此，如果所有涉及的线程都同意仅在拥有 Mutex 所有权时才接触资源，则您可以跨 thread.s 安全地访问资源

EventWaitHandle 可以在一定程度上可视化为线程安全事件。它具有信号和非信号的概念，任何数量的线程都可以等待它达到信号状态。当它收到信号时，其中一个等待线程将被唤醒并开始处理。

您可以使用 EventWaitHandle 来实现一种线程安全形式。不是锁定所有权是访问资源的关键，而是从事件发出信号是访问资源的关键。然而，魔鬼再次出现在细节中。

1.  谁负责发出事件信号？使用互斥体，每个线程基本上都在尖叫“我我我”，操作系统选择一个线程来获胜。使用 EventWaitHandle，您将负责决定下一个线程何时开始。
2.  当有人通过 taskmgr 杀死进程时会发生什么？如果被杀死的进程有一个线程当前正在响应 EventWaitHandle 上的事件怎么办？
3.  # 2 但是当下一个发出信号等待句柄的项目被取下时会发生什么？您必须考虑到这一点以避免死锁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:27:26.223

看起来 EventWaitHandle 做了我想要的。它有一个带名字的构造函数，所以它非常适合跨进程同步，而且它没有这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-08T21:42:48.130

在收到`AbandonedMutexException`. 从[文档](http://msdn.microsoft.com/en-us/library/system.threading.abandonedmutexexception.aspx)：

> 下一个请求互斥锁所有权的线程可以处理此异常并继续，前提是可以验证数据结构的完整性。

当然，这假设您*知道*您（和您的线程）在崩溃时正在做什么，这基本上意味着获取线程也可以在退出之前释放互斥锁。

所以最终你自己的使用解决方案`EvenWaitHandle`比互斥锁更好。

# c# - 如何减少任务管理器中应用程序的内存消耗

> ID：654172
> 
> 赞同：0
> 
> 时间：2009-03-17T13:09:25.457
> 
> 标签：c#, .net, winforms, visual-studio-2008

我在 VS2008 中使用 C# 开发了一个 winforms 应用程序。当我运行此应用程序时，我在任务管理器中观察到它显示消耗了 80 MB 内存。我怎样才能减少这种情况？即使是非常小的应用程序也需要 8 MB 内存...

我可以做些什么来减少内存占用？

非常感谢您提前。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T13:14:43.727

任务管理器的内存编号并不总是那么清晰，但是这个小技巧可以欺骗该编号...不适用于生产

```
public static void RefreshMemory() {
    try {
        Process curProc = Process.GetCurrentProcess();
        curProc.MaxWorkingSet = curProc.MaxWorkingSet;
    } catch {
        // Handle the exception
    }
} 
```

使用 JetBrains dotTrace 或其他类似工具跟踪内存对象使用情况也会很有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T13:17:00.163

嗯，.NET 框架有相当大的开销——正如您所观察到的，最简单的“hello world”控制台应用程序有一个 4 mb 的工作集。您可以做很多事情来减少内存占用（减少嵌入式资源，确保在 Release 配置中构建等）

但归根结底，.NET 旨在提高开发人员的效率而不是内存/资源效率，因此，如果您的应用程序必须在非常小的高效内存空间中运行，您应该考虑用 C++ 或其他一些语言编写它您管理自己的资源。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T13:17:13.313

您的问题显然有过早优化的味道。

您应该仅在以下情况下处理内存使用：

1.  您正在为没有大量可用内存的设备进行开发（例如使用便携式 .net 框架）
2.  就内存大小而言，您已达到 .net 的限制（即大约 1.3gbp）
3.  你的客户在抱怨。

不要误会我的意思，这并不意味着您必须浪费内存，或者在编码时不应该考虑内存。我只是说，在你的情况下，内存使用可能不是什么大问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T17:37:16.043

除了之前所有的好评之外，请记住您在任务管理器中看到的数字是*虚拟内存*，而不是物理内存。通过查看任务管理器，程序使用的实际物理 RAM 量并不明显。此外，任务管理器会向您显示一系列快照 - 如果您真的有问题，您会想随着时间的推移使用 Perfmon 或其他东西来查看它，此外还有关于使用 JetBrains 的 dotTrace 进行分析的出色建议。

但是，在您的代码正常工作并且具有较高的测试覆盖率并且知道实际*需要*优化什么之前，不要进行*任何*优化。否则，您将面临优化不存在的问题的风险，更糟糕的是，优化*错误*的问题，而忽略*真正的*问题或可能使问题变得更糟。

 ***# vb.net - 将带有 msflexgrid 的 VB6 应用程序移植到 vb.Net

> ID：654179
> 
> 赞同：0
> 
> 时间：2009-03-17T13:10:40.023
> 
> 标签：vb.net, datagridview

我正在将一个 vb6 应用程序移植到 VB.net。其中一个关键表单上有一个大的 msflexgrid - 大约 1000 列和 50 行。它有 2 个标题行 - 第一个标题行合并了单元格以形成一个主标题，第二行有子标题。不需要任何数据输入，并且不受约束。代码决定在每个单元格中显示什么（如果有的话）。它仅用于以字符和彩色背景的形式显示数据，并在鼠标悬停时显示带有更多信息的工具提示文本。在 vb6 中运行良好。我正在尝试决定是否：a) 在 .

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-23T10:30:32.457

我建议使用`DataGridView`.NET，主要是因为在 .NET 中使用 COM 对象很痛苦。有一个 MSDN 页面，您可以在此处准确了解您想要做什么，并[在](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework.windowsforms/topic47894.aspx)[此处](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewadvancedborderstyle.aspx)进行一些额外的讨论。

# clickonce - 为 VSTO Outlook 加载项创建 (ClickOnce) 设置

> ID：654185
> 
> 赞同：5
> 
> 时间：2009-03-17T13:12:33.967
> 
> 标签：clickonce, ms-office, vsto, add-in, registry

所以我创建了一个 Outlook 加载项并使用单击一次设置来部署它。

当用户是管理员时，设置运行良好，否则：不行。

使用“运行方式...”运行设置并以管理员身份登录可以工作，但加载项安装在管理员下，而不是当前用户下。该插件不会出现在 Outlook 中。

我尝试遵循本指南：http: [//blogs.msdn.com/mshneer/archive/2008/04/24/deploying-your-vsto-add-in-to-all-users-part-iii.aspx](http://blogs.msdn.com/mshneer/archive/2008/04/24/deploying-your-vsto-add-in-to-all-users-part-iii.aspx)

但我卡在第一部分：http: [//blogs.msdn.com/mshneer/archive/2007/09/04/deploying-your-vsto-add-in-to-all-users-part-i.aspx](http://blogs.msdn.com/mshneer/archive/2007/09/04/deploying-your-vsto-add-in-to-all-users-part-i.aspx)

我按照示例并按照描述启动excel：

> 现在启动 Excel 应用程序。检查 HKCU 配置单元中的注册表项，例如，您会发现两个有趣的注册表项出现在您的 HKCU 配置单元下：
> 
> *   HKCU\Software\Microsoft\Office\TestKey 包含注册表值 TestValue 的注册表项
> *   您现在还拥有 HKCU\Software\Microsoft\Office\12.0\User Settings\TestPropagation 注册表项，其中 Count 值设置为 1

但是在我的机器上，没有创建密钥......接下来我可以尝试什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T05:41:28.140

如果我正确理解了这个问题，让我描述一下您的场景：将为所有用户安装 clickonce 应用程序，因此必须首先通过具有管理员权限的部署机制运行才能将密钥写入 HKLM。此后，标准用户登录，Microsoft Office 在启动时将 HKLM 密钥复制到 HKCU，此后该计算机上的任何用户都在标准用户的上下文下运行加载项。

如果在用户启动 Office 时让 Office 使用 HKLM 密钥复制到 HKCU 的所有尝试都用尽了，我会将 vbs 脚本和 reg 文件放在一起，将 vbs 脚本放在所有用户启动文件中（使用一些管理员级别的部署工具）并在没有 Office 帮助的情况下自行管理 HKCU 中特殊密钥的创建。当用户登录时，vbs 脚本文件将静默运行 regedit 以将适当的密钥放置在 HKCU 中。

这类似于我们在办公室管理 WordPerfect 的方式。

更新：使用修补程序[KB976477](http://support.microsoft.com/kb/976477)解决此问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T04:05:34.957

为了清楚起见，您将注册表项添加到“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\12.0\User Settings”

而且它们还没有出现在 HKCU\Software\Microsoft\Office\ 中？

我假设您必须运行 64 位操作系统？

如果是这样，修复很简单，试试这个

Windows 注册表编辑器版本 5.00 [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Wow6432Node\Microsoft\Office\12.0\User Settings\TestPropagation] "Count"=dword:00000001 [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Wow6432Node\Microsoft\Office\12.0\User Settings\ TestPropagation\Create\Software\Microsoft\Office\TestKey] "TestValue"="Test"

请注意，密钥的路径位于 Wow6432Node 密钥下。它必须在那里，否则它将无法在 64 位操作系统上运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T21:51:29.363

我已经有几年没有这样做了，但是从内存中，办公室插件可以像这样“注册”：

1.  将文件放在正确的位置
2.  注册代表您的插件的 .NET COM 对象
3.  将注册表项放在下面`Microsoft\Office\Addins`，告诉办公室加载您的 COM 对象。

如果我的想法是正确的，那么问题将是您需要注册 COM 对象。注册 COM 对象是每台机器的操作，因此需要管理员权限。

您将能够看到这是否确实发生了。您在 office 插件下的注册表项将被称为类似`MyAddin.Connect`. 然后，您可以在下面搜索`HKEY_CLASSES_ROOT`，`MyAddin.Connect`当您以管理员身份运行安装时它应该存在，而在以每个用户身份运行时*不存在。*

如果是这样，您可以通过对 COM 对象进行每个用户注册来解决它，但这有点痛苦。

现在事情可能变得更容易了，但是当我不得不这样做时，您使用了一个名为`RegCap.exe`将与 COM 对象关联的注册表项捕获到 .reg 文件中的实用程序，然后使用文本编辑器修改 .reg 文件以替换`HKLM`为`HKCU`,然后，您无需注册 COM 对象，而是加载此 .reg 文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-04T09:59:08.787

如果要将 Outlook 加载项安装到所有用户，则需要使用共享加载项而不是 VSTO 加载项。VSTO 加载项是基于每个用户而不是每台机器的，因此对于标准用户，您必须暂时授予用户本地管理员权限才能安装它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-04T22:12:59.323

您使用该加载项的目标是什么版本的 Office，以及您的目标是什么版本的 .NET Framework？另外，您使用的是什么版本的 Visual Studio？

这应该有效；我现在有两个使用 ClickOnce 部署的 Office 加载项在生产中。

您列出的文章是关于为所有用户安装的。这不使用 ClickOnce，与您的情况无关。

在找出您正在使用/定位的版本后，我可以为您提供一些部署步骤。:-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-27T11:46:31.663

1.  创建一个本地管理员帐户，例如 TESTAccount。
2.  使用单击一次为该用户安装插件。
3.  以管理员身份重新登录并将 TESTAccount 复制到默认用户。

现在，当任何人登录机器时，将从默认配置文件为他们创建一个新配置文件，因此将安装插件。

# mbunit - 如何将 MBUnit 测试添加到 CruiseControl.Net 配置文件

> ID：654187
> 
> 赞同：2
> 
> 时间：2009-03-17T13:13:53.883
> 
> 标签：mbunit

如何将 MBUnit(tag) 测试添加到`CruiseControl.Net`配置文件。

谢谢， 拉贾小号

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-21T08:11:29.990

我假设您正在寻找从 CCNet 运行 MbUnit 测试？

如果您已经在使用 NAnt 或 MSBuild 来编译代码，那么我建议您只使用这些相同脚本中的 MbUnit 或 Gallio 任务。优点是你也可以在你的开发者机器上运行你的测试而不涉及 CCNet（假设你在那里使用相同的脚本）。

另一种选择是使用 CCNet 任务来运行 MbUnit.Console.exe 或 Gallio.Echo.exe 来运行您的测试。

顺便说一句，Gallio 包含有关如何配置 CCNet 仪表板以显示测试结果的说明。

# semantics - 切换耶拿推理机

> ID：654189
> 
> 赞同：5
> 
> 时间：2009-03-17T13:14:05.087
> 
> 标签：semantics, jena

我有一个 Jena 本体模型 ( [OntModel](http://jena.sourceforge.net/javadoc/com/hp/hpl/jena/ontology/OntModel.html) )，我正在以编程方式对其进行修改。该模型最初是使用[默认的 ModelFactory 方法创建的，用于创建本体模型（无参数）](http://jena.sourceforge.net/javadoc/com/hp/hpl/jena/rdf/model/ModelFactory.html#createOntologyModel())。问题是，随着程序的运行和模型的更改，默认的 Jena Reasoner 会运行（运行、运行和运行）。这个过程对于我需要的东西来说太慢了，并且会在大型数据集上耗尽内存。

我将程序更改为使用[不同的本体模型工厂方法](http://jena.sourceforge.net/javadoc/com/hp/hpl/jena/rdf/model/ModelFactory.html#createOntologyModel(com.hp.hpl.jena.ontology.OntModelSpec))来创建没有推理器的模型。这运行得非常快，并且没有出现我之前看到的内存问题（即使对于非常大的数据集）。这种方法的问题是我只能通过直接使用它的直接类类型来访问数据（我无法使用它的父类访问对象）。

例如，假设我有两个类资源，“花”和“种子”。这些继承自一个共同的父母，“植物材料”。我的程序获取所有“种子”，运行一个名为“grow”的方法，将“种子”对象转换为“花”对象。使用 Reasoner（甚至是 micro Reasoner）时，“grow”方法运行速度太慢并且内存不足。如果我关闭 Reasoner，那么我将无法使用“植物材料”类访问所有“花”和“种子”。

有没有一种首选的方法（一种快乐的媒介）来做到这一点......允许使用它们的超类访问对象，同时又快又不占用内存？

我一直在寻找一种在运行“增长”方法时“关闭推理器”的方法，然后在方法完成后将其转回。这有可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T20:34:25.747

我得到了一些[帮助和建议](http://tech.groups.yahoo.com/group/jena-dev/message/38647)，这就是我解决这个问题的方法。

基本上，我可以在没有 Reasoner 的情况下访问另一个模型，将我对基本模型的所有更改批量化，然后使用推理器重新绑定完整模型以获取更新。

这是一些伪代码。它不完全符合我的“真实”场景，但你明白了。

```
// Create a model with a reasoner and load the full model from owl files or
// whatever
OntModel fullModel = ModelFactory.createOntologyModel();
fullModel.read(...);

// create a model without a reasoner and load it from the full model with
// reified statements
OntModel basicModel = ModelFactory.createOntologyModel(OntModelSpec.OWL_MEM);
basicModel.add(fullModel);

// batch modifications to the basic model programatically
//(**** RUNS REALLY QUICK *****)

// rebind the full model
fullModel.rebind();

// continue on.... 
```

# macos - Mac OS X 上的 Vim 插入模式

> ID：654191
> 
> 赞同：112
> 
> 时间：2009-03-17T13:14:29.313
> 
> 标签：macos, vim

显然 Mac 键盘没有`Insert`键（或者可能有，但我找不到）。如何在Mac 上的**vim中进入插入模式？**

* * *

## 回答 #1

> 赞同：240
> 
> 时间：2009-03-17T13:16:34.860

如果这是一个看起来很简单的问题，您只需按`i`。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-17T13:17:28.213

`i`无论平台如何，Vim 都使用（或`a`用于追加）进入插入模式。覆盖模式很少使用`Shift`+进入`r`。我从来没有在`Insert`这里使用过钥匙。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-06-15T20:38:09.493

该`Insert`键的另一个用途是在替换模式和插入模式之间切换。您可以在 Mac 上轻松完成此操作，只需为您映射另一个键即可。在您`~/.vimrc`刚刚放置`imap <F13> <Insert>`的`F13`键中（在我的 Mac 键盘上，它是最接近`Insert`常规键盘上键位置的键）。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-17T13:16:38.480

按 "i" 进入 VIM 中的插入模式。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-04-09T16:19:58.077

进入插入模式：按`i`

退出插入模式：按`esc`，键入`:x`

# c++ - 将 GNU C++ 程序移植到 Visual C++

> ID：654197
> 
> 赞同：4
> 
> 时间：2009-03-17T13:16:34.703
> 
> 标签：c++, visual-studio, visual-c++, g++, port

您如何将带有由 Linux 中的 GNU C++ 制作的 makefile 的 C++ 程序移植到 Visual C++？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T17:28:44.053

我可以建议的一件事是使用 CMake。如果您使用 CMake 实现构建系统以在 Linux 上为 GCC 自动生成 makefile，则只需稍作修改即可为 VC++ 自动生成项目和解决方案。

当然，这意味着学习一个全新的构建工具，所以它可能不适合你。这只是一个建议。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T13:27:12.947

我不知道一种简单的方法来简单地从一个转换到另一个，但是..

假设你只使用ANSI C/C++特性，通常不需要转换makefile，只需要看看里面有哪些.c/.cpp文件，然后添加到VS工程中即可；您还必须检查编译器选项和定义的宏，才能将它们放入 VS 项目中。我这样做是为了编译 expat、freetype、agg 等库，没有问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T03:49:02.887

**移植构建系统：**您可以使用 GNU make 的 Windows 端口，并更改 makefile 以在 Windows 上构建时调用 Visual C++ 命令行工具（、、、`cl.exe`等），在 Linux 上构建时调用 GNU 编译器工具`link.exe`。`lib.exe`这种方法的难度取决于生成文件的复杂性。

**移植代码：**这取决于您使用的 API 和库，以及您将遇到的编译器警告/错误/怪癖。如需更具体的答案，请提出更具体的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T09:41:44.307

提到了 CMake。我已经使用 CMake 并成功编译了生成的 Visual Studio 项目。我发现 CMake 文档非常无用——我不得不询问现有用户——而官方手册（需要花钱）当时已经绝版。此外，它生成的 Visual Studio 项目根据编写转换器的人首选的模板进行了非常严格的格式设置。我无法弄清楚如何自定义项目选项或对源文件进行分组。

我经常在 Visual Studio 和 G++ 上进行交叉编译。在大多数情况下，您只需将所有源文件和头文件添加到 Visual Studio 项目中（“添加现有文件”，并添加整个源代码树），然后编译它。通常你会得到错误，所以你从那里开始修复错误。如果您使用了特定于平台的库，您可能会卡在移植到替代或删除功能上。

再提醒一句：Visual Studio 和 G++ 有不同的编译器怪癖。在大多数情况下，它们都非常符合 C++ 标准，但在其中一个中工作的稍微不标准的代码可能在另一个中不起作用。我发现在处理模板时尤其如此，在许多情况下，Visual Studio 奇怪地允许语法错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-08-21T04:33:44.747

CMake 具有生成视觉工作室项目的优点。

如果您不需要，我建议使用 Meson 构建系统。更好，类似的建议。需要 python3 和 ninja，但没有人是完美的。:)

# c# - 为什么我看到多个系统托盘图标？

> ID：654212
> 
> 赞同：13
> 
> 时间：2009-03-17T13:20:35.803
> 
> 标签：c#, systray

我在我的应用程序中添加了一个通知图标，而且我经常在我的系统托盘中看到多达 3 个通知图标副本。是否有一个原因？

有没有办法阻止它发生。

在我的应用程序关闭后，这种情况通常会持续存在，直到我移到系统托盘上，系统托盘展开并折叠，然后它们都消失了。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-17T13:24:54.810

这是在调试应用程序时吗？如果是这样，这是因为从系统托盘中删除图标的消息仅在应用程序正常退出时发送，如果它因异常而终止或因为您从 Visual Studio 中终止它，该图标将一直保留，直到您将鼠标悬停在它上面。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-04-08T11:43:31.707

您可以使用父窗口的 Closed 事件终止图标。这适用于我的 WPF 应用程序，即使在 Visual Studio 中进行测试（在我的情况下为 2010）：

```
 parentWindow.Closing += (object sender, CancelEventArgs e) =>
        {
            notifyIcon.Visible = false;
            notifyIcon.Icon = null;
            notifyIcon.Dispose();
        }; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-31T17:14:21.357

我做了什么：

1.  创建一个更新系统托盘的类库。

    ```
    using System;
    using System.Diagnostics;
    using System.Runtime.InteropServices;

    namespace SystrayUtil
    {
        internal enum MessageEnum
        {
            WM_MOUSEMOVE = 0x0200,
            WM_CLOSE = 0x0010,
        }

        internal struct RECT
        {
            internal int Left;
            internal int Top;
            internal int Right;
            internal int Bottom;

            internal RECT(int left, int top, int right, int bottom)
            {
                Left = left;
                Top = top;
                Right = right;
                Bottom = bottom;
            }
        }

        public sealed class Systray
        {
            [DllImport("user32.dll", SetLastError = true)]
            private static extern IntPtr FindWindow(string lpClassName, string lpWindowName);

            [DllImport("user32.dll", SetLastError = true)]
            private static extern IntPtr FindWindowEx(IntPtr hwndParent, IntPtr hwndChildAfter, string lpszClass, IntPtr lpszWindow);

            [DllImport("user32.dll", SetLastError = true)]
            private static extern IntPtr SendMessage(IntPtr hWnd, int message, uint wParam, long lParam);

            [DllImport("user32.dll", SetLastError = true)]
            private static extern bool GetClientRect(IntPtr hWnd, out RECT usrTray);

            public static void Cleanup()
            {
                RECT sysTrayRect = new RECT();
                IntPtr sysTrayHandle = FindWindow("Shell_TrayWnd", null);
                if (sysTrayHandle != IntPtr.Zero)
                {
                    IntPtr childHandle = FindWindowEx(sysTrayHandle, IntPtr.Zero, "TrayNotifyWnd", IntPtr.Zero);
                    if (childHandle != IntPtr.Zero)
                    {
                        childHandle = FindWindowEx(childHandle, IntPtr.Zero, "SysPager", IntPtr.Zero);
                        if (childHandle != IntPtr.Zero)
                        {
                            childHandle = FindWindowEx(childHandle, IntPtr.Zero, "ToolbarWindow32", IntPtr.Zero);
                            if (childHandle != IntPtr.Zero)
                            {
                                bool systrayWindowFound = GetClientRect(childHandle, out sysTrayRect);
                                if (systrayWindowFound)
                                {
                                    for (int x = 0; x < sysTrayRect.Right; x += 5)
                                    {
                                        for (int y = 0; y < sysTrayRect.Bottom; y += 5)
                                        {
                                            SendMessage(childHandle, (int)MessageEnum.WM_MOUSEMOVE, 0, (y << 16) + x);
                                        }
                                    }
                                }
                            }
                        }
                    } 
                }
            }
        }
    } 
    ```

2.  将dll复制到`"%ProgramFiles%\Microsoft Visual Studio x.x\Common7\IDE\PublicAssemblies\SystrayUtil.dll"`

    其中 xx 是 Visual Studio 的版本号

3.  录制宏并保存

4.  编辑宏

    添加对创建的 dll 的引用。

    添加`Imports SystrayUtil`到 Module EnvironmentEvents 顶部的导入列表。

    删除所有不需要的项目并将以下代码添加到 EnvironmentEvents 模块

    ```
    Public Sub DebuggerEvents_OnEnterDesignMode(ByVal Reason As EnvDTE.dbgEventReason) Handles DebuggerEvents.OnEnterDesignMode
    Systray.Cleanup()
    MsgBox("Entered design mode!")
    End Sub 
    ```

5.  如果它有效，请删除`MsgBox("Entered design mode!")`，因为每次从调试会话返回时弹出一个消息框很烦人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-11T07:34:05.947

当您通常关闭应用程序时，这应该可以工作：

```
// in form's constructor
Application.ApplicationExit += new EventHandler(this.OnApplicationExit);

private void OnApplicationExit(object sender, EventArgs e)
{
    try
    {
        if (notifyIcon1!= null)
        {
            notifyIcon1.Visible = false;
            notifyIcon1.Icon = null;
            notifyIcon1.Dispose();
            notifyIcon1= null;
        }
    }
    catch { }
} 
```

当您从 Visual Studio 停止调试按钮停止应用程序时 - 进程被终止并且不会触发任何处置事件。

# c++ - 使用 .h 作为 c++ 文件的标头是否错误？

> ID：654220
> 
> 赞同：3
> 
> 时间：2009-03-17T13:22:37.547
> 
> 标签：c++, header-files, file-extension

使用 .h 作为 c++ 文件的标头是否错误？

我到处都能看到它，尤其是用“C 风格”编写的代码。我注意到 Emacs 总是为 .h 标头选择 C ​​突出显示样式，而为 hpp 或 hh 选择 c++。

标记你的标题.h实际上是“错误的”还是只是让我烦恼的事情？

编辑：

这让我很恼火有一个很好的（ish）原因，如果我有标记为“hpp & cpp”的项目文件，我可以使用“grep something *pp”等。否则我必须输入“.h cpp”

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T13:25:24.153

没有错。这是 Microsoft Visual C++ 的默认设置。

只要遵循你喜欢的标准，并坚持下去。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T13:45:11.033

调用 C++ 头文件 .h并没有*错。*没有关于您的代码必须使用哪些扩展的规则。对于非标头，MSVC 使用 .cpp，在 Linux 上也使用 .cc。没有一个全球标准，而且 .h 绝对是非常广泛使用的。

但我会说调用你的标题 .hpp（我也见过 .hh 几次）比仅使用 .h 更加一致和信息丰富。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T17:31:03.157

您可以自由使用`.h`, `.H`, `.hpp`, `.hxx`, `.hh`, 或 whathaveyou。就像您可以自由地使用`.c`C 源代码和`.C`, `.cpp`, `.cc`, 或`.cxx`C++ 源代码一样。扩展主要是一种约定。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T13:25:19.893

就像其他文件一样——.c 用于 C，.cpp 用于 C++——使用 .h 用于 C，.hpp 用于 C++。这将满足大多数编译器/编辑器。不这样做并没有错，但它可以用来提示您实际使用的两种语言中的哪一种。

如果您想在不重命名文件的情况下停止该行为，您应该查看 Emacs 配置并尝试更改源代码检测。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T13:32:09.660

由于 Emacs 没有简单的方法来确定 .h 文件是 C 还是 C++，因此为 .h 文件选择 C ​​并为 .hpp 文件选择 C++ 并不可笑。

请注意，所有 boost 头文件都以 .hpp 为后缀。

# sas - ytd 报告和 12 mtd 有什么区别？

> ID：654227
> 
> 赞同：2
> 
> 时间：2009-03-17T13:23:43.610
> 
> 标签：sas, business-logic

12 mtd ， 12 mtd rolling 和 ytd 计算有什么区别

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T13:28:20.900

12 mtd 可以追溯到 12 个月，而 ytd 是从当年（日历、财政等）的第一天到当天。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T12:18:00.773

例子：

今天=20090318

报告类型 - 报告期

* * *

12MTD 报告 - 20080401 至 20090318

年初至今报告 - 20090101 至 20090318

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T12:36:25.177

除了[Hank Gay](https://stackoverflow.com/users/4203/hank-gay)的回答，12 mtd 计算与 12 mtd 滚动计算相同。

一般来说，您通常会看到 3 mtd 滚动或 6 mtd 滚动计算。

# c# - 异常猎人有免费的替代品吗？

> ID：654235
> 
> 赞同：8
> 
> 时间：2009-03-17T13:25:25.963
> 
> 标签：c#, exception

我在 Java 和 C# 之间来回切换，而我在 C# 中编码时错过的一件事是强制异常检查（尽管我承认我在使用 Java 编码时有时也发现它真的很烦人）。

我知道[Exception Hunter](http://www.red-gate.com/products/Exception_Hunter/index.htm)可以帮助您追踪一段代码可能抛出的异常，但有没有免费/更便宜的替代方案？对于这种软件插件，我真的无法证明 200 英镑是合理的，因为它只是一个烦恼，而不是一个主要问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-18T22:53:05.460

是的。在您的代码上运行免费的[Microsoft Pex 。](http://research.microsoft.com/en-us/projects/Pex/)它将显示所有可能抛出的异常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T13:40:41.340

虽然我理解强制例外的事情，但我不确定它的真正重要性……例如，最*有趣*的例外是那些你通常**不会**包括（甚至不期望）的例外。例如，我目前正在与 CF35 中看起来非常像 CLI 错误的问题作斗争，它会间歇性地`MethodMissingException`从确实存在的代码中引发（强调：间歇性地）。

如果您想记录您的异常，请使用`///<exception ... >...</exception>`标记。关于这个主题的其他想法，也许可以查看[Vexing Exceptions](http://blogs.msdn.com/ericlippert/archive/2008/09/10/vexing-exceptions.aspx)（我想知道[GhostDoc](http://www.roland-weigelt.de/ghostdoc/)是否有帮助？）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T09:01:50.247

[获得卓越](http://getexceptional.com/)的网站是一种可能性。基本思想是您创建软件，所有异常都会发送到此站点到您的帐户，您可以在其中提取它们。当然，它不会读取您的代码并查看存在哪些异常。

我不知道是否还有 C# 库，但 API 并不太难。

# .net - .NET 单跳规则和 SharePoint Webparts

> ID：654239
> 
> 赞同：1
> 
> 时间：2009-03-17T13:26:27.067
> 
> 标签：.net, security, sharepoint, web-parts, identity

您好我有一个 SharePoint Webpart，它被编译为 DLL 并放置在我的 SP 站点的 BIN 文件夹中。我的 webpart 在我的本地机器上工作，但是当我把它投入生产时它失败了

```
(401) Unauthorized. 
```

在做了一些研究之后，我发现了所谓的“单跳规则”。这意味着我必须传递网络用户的凭据，或者使用

```
<identity impersonate= "true" /> 
```

在我的 web.config 中。我不想对网络用户进行硬编码，所以我的问题是如何在我的 Web 部件中使用模拟？dll 是否支持 web.configs？谢谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T13:52:59.453

您的 webpart 生产失败可能是因为 CAS；您可能需要提升权限级别或附加要授予您的程序集的特殊访问权限，因为它不完全受信任，因为它位于 bin 文件夹中。

如果你确定这只是一个模拟问题，你能不能只在你的 web.config 中使用节点？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T14:04:29.393

在 SharePoint 应用程序的 web.config 中，Impersonate 始终设置为 true，因此问题肯定出在其他地方。部署到 Web 应用程序的 BIN 文件夹的 Web 部件在沙箱中运行，并且默认情况下具有有限的权限。也许这就是问题的根源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T19:16:39.393

是的，正如 Tudor 所提到的，它很可能是代码访问安全性。如果你把它放在 GAC 中，你就不会遇到这个问题（GAC 是完全信任的）。

下面是一些可以帮助您使用 CAS 和 SharePoint Web 部件的文章。诀窍是知道您需要哪些 IPermissions。

*   [http://msdn.microsoft.com/en-us/library/ms916855.aspx](http://msdn.microsoft.com/en-us/library/ms916855.aspx)
*   [http://www.combined-knowledge.com/Downloads/Code%20Access%20Security%20in%20SharePoint%202007%20for%20Administrators.pdf](http://www.combined-knowledge.com/Downloads/Code%20Access%20Security%20in%20SharePoint%202007%20for%20Administrators.pdf)
*   [http://www.dotnetmafia.com/blogs/dotnettipoftheday/archive/2007/07/05/how-to-configure-code-access-security-for-a-web-part.aspx](http://www.dotnetmafia.com/blogs/dotnettipoftheday/archive/2007/07/05/how-to-configure-code-access-security-for-a-web-part.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T13:46:11.733

我认为没有办法在 DLL 中添加它。反正据我所知。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T19:19:45.393

如果您正在查看“双跳”问题，那么您将不会使用 NTLM。您需要使用 Kerberos 身份验证，因为 Kerberos 票证可以从用户跳到 Web 服务器再到 Web 服务。您需要使用 SetSPN 设置服务主体名称。

此 Web 部件是否调用外部 Web 服务？还是基于本地安全的权限错误？

# apache-flex - Flex 深度链接和命名锚链接

> ID：654253
> 
> 赞同：2
> 
> 时间：2009-03-17T13:28:50.433
> 
> 标签：apache-flex, anchor, deep-linking

OK 在 flex 中的深度链接使用 URL 中的锚（#）文本。因此，指向同一页面上命名锚点的链接将覆盖 Flex 使用的锚点文本并重置应用程序。有谁知道他们可以重合的方法吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T16:25:48.573

看看这个[问题](https://bugs.adobe.com/jira/browse/SDK-9722)。

> 在 HTML 页面中使用命名锚点时，DeepLinking 的行为很奇怪 [...]

可以在[此处](http://labs.adobe.com/wiki/index.php/Flex_3:Feature_Introductions:_Deep_Linking)找到完整的问题列表。

如果您打算使用此功能，可能会对[UrlKit 0.5感兴趣。](http://joeberkovitz.com/blog/2006/09/22/urlkit-05-hits-the-streets/)

# programming-languages - 您可以推荐哪些快速的低级语言？

> ID：654255
> 
> 赞同：4
> 
> 时间：2009-03-17T13:29:08.933
> 
> 标签：programming-languages, low-level

我对用于性能计算的类 C 语言产生了兴趣。您能否推荐一些具有以下属性的替代编程语言：

*   必须靠近硬件（位摆弄、指针或一些替代的安全方法，如引用）
*   没有托管代码（没有 jvm/.net 语言）
*   必须非常快（如C）
*   必须高于 ASM 级别（是的，我对 ASM 之上的宏语言感兴趣）
*   可能晦涩难懂，不是很普遍

我主要对鲜为人知的语言感兴趣。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T13:31:08.290

[汇编语言](http://en.wikipedia.org/wiki/Assembly_language)或[D 编程语言](http://www.digitalmars.com/d/)怎么样？

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-17T13:32:14.043

如果您对此一无所知并且只是对拓宽视野感兴趣，请查看[Forth](http://en.wikipedia.org/wiki/Forth_%28programming_language%29)。阅读 Forth 总是让我觉得 C 是高级别的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-17T13:35:08.310

你没有在你的问题中明确声明它不能是 C，所以我会继续推荐 C。它满足你的三个项目符号的愿望，你不必担心语言的不同版本（比如每种不同类型的汇编器）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-17T13:35:10.387

好吧，我一直更喜欢 C 和/或 C++，因为有多种风格（MSVC、glibc 等），它可以在许多不同的平台（例如移动设备、Windows、linux）和设备上运行，并且可以跨平台编写（不同的处理器架构），甚至用于高端图形（例如 DirectX）。

您可以获得对平台资源的“体面”访问（条件各不相同），它可以像您选择磨练它一样快，而且它比 ASM 更容易（恕我直言）编写。还有相当多的支持工具和代码分析工具可以让事情变得更容易一些。

C 和 C++ 也已经存在了很长一段时间，所以它（即使在今天）也有一个优秀而热情的社区！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-17T13:48:03.007

向前！

在某些架构上，Forth 可以比机器语言更快。编译后的代码非常密集，因此可以优化使用代码缓存。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T13:31:14.093

组装将是最接近硬件的，因此是最快的

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T13:47:35.003

[Ada](http://en.wikipedia.org/wiki/Ada_(programming_language))最初是为嵌入式系统设计的（除其他外）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-17T13:56:54.827

[OpenCL](http://en.wikipedia.org/wiki/OpenCL)可能很有趣。它有点像 OpenGL 着色器语言（带有扩展的 C 的子集），但用于通用并行数组计算。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-17T15:35:13.467

您可以开始使用 VHDL、Verilog、System C 对 FPGA 进行编程......

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-09T21:11:39.800

## 主题变奏曲

[**FORTRAN**](http://en.wikipedia.org/wiki/Fortran)比 C 更老，并且仍然是数值计算的主要参与者之一。直到 1990 年（当该语言大幅现代化时），该语言没有任何形式的指针（检查与否）。这种缺乏意味着无法动态管理内存。它还使[编译器的别名](http://en.wikipedia.org/wiki/Aliasing_%28computing%29)分析变得容易，这是使 Fortran 代码快速运行的原因之一。

[**ALGOL**](http://en.wikipedia.org/wiki/ALGOL)是第一个结构化编程语言。尽管它在程序员方面的成功有限，但它对语言设计师的影响很大。

[**Ada**](http://en.wikipedia.org/wiki/Ada_%28programming_language%29)是一种命令式语言，具有强大的类型系统和良好的模块化，这使得它非常适合具有强保证要求的低级编程（它是由美国政府赞助的，考虑到军事和航空电子应用）。它受到[Pascal](http://en.wikipedia.org/wiki/Pascal_%28programming_language%29)的启发，如[Modula-2](http://en.wikipedia.org/wiki/Modula-2)和[Modula-3](http://en.wikipedia.org/wiki/Modula-3)。

远离低级命令式编程的主流，还有[**FORTH**](http://en.wikipedia.org/wiki/FORTH)。FORTH 可以在内存很少的设备上编译，甚至解释；它在低端嵌入式系统（包括微控制器）上有很多用途。该语言基于反向波兰表示法，因 HP 计算器而闻名（事实上，HP 计算器的语言深受 FORTH 的影响）。许多实现没有变量：所有数据都保存在一个或多个堆栈上。

只是为了好玩，我会提到深奥语言的[鼻祖 INTERCAL](http://en.wikipedia.org/wiki/INTERCAL)。

## 会让你大吃一惊的东西

[深奥的语言](http://en.wikipedia.org/wiki/Esoteric_programming_language)可能具有指导意义，并且有很多工作接近机器（通常是虚拟机，但原则上，如果您足够疯狂，您可以在实际计算机上实现它们）。你可以看看[brainfuck](http://en.wikipedia.org/wiki/Brainfuck)（图灵机和C之间的一种中间阶段），或者许多单指令语言，或者[befunge](http://en.wikipedia.org/wiki/Befunge)（如果内存是一个*二维*数组呢？）。

[**Cyclone**](http://en.wikipedia.org/wiki/Cyclone_%28programming_language%29)看起来很像 C。语法相同，Cyclone 有指针、未标记的结构和联合、goto 语句和手动内存管理。然而它是一种*安全*的语言：你不能有一个悬空指针或缓冲区溢出。您可以访问高级功能，例如模式匹配、异常、多态、抽象类型和可选的自动内存管理（不仅是垃圾收集，还有区域）。旋风既有用又有指导意义；对于 C 的死忠，它可能是发现什么是安全语言的好方法。Cyclone 可以编译为 C，因此您可以在任何有 C 编译器的地方运行程序。

换个方向，如果你想接近硬件，但还没有真正设计硬件，看看[**同步语言**](http://en.wikipedia.org/wiki/Synchronous_programming_language)，比如[Lustre](http://www-verimag.imag.fr/DIST-TOOLS/SYNCHRONE/lustre-v6/)和[Esterel](http://en.wikipedia.org/wiki/Esterel)。这些语言用于对高可靠性实时系统进行编程，例如核电站、飞机和铁路信号。这些语言放弃了图灵完备性，并确保程序员可以准确地知道他们的程序将运行多快以及它将需要多少内存。如果您认为 C 语言接近机器，那么找出*真正*接近机器的语言可能会令人震惊。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-17T13:39:47.723

你不可能比汇编语言更接近，除非你在芯片制造商那里找到一份工作并开始编写微代码！！！

如果您使用的是 Windows，我认为您可以使用 Microsoft MASM（宏汇编器），它可以让您快速启动并运行。我很久以前使用它，它不是一个糟糕的产品。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-17T13:43:57.027

回答我的问题似乎有点尴尬，但我找到了两种语言：

*   耐热玻璃
*   瓦拉

它们可能无法满足所有约束条件，但它们非常适合性能计算，并且都可以转换为 C。

# configuration - FitNesse 配置文件

> ID：654259
> 
> 赞同：5
> 
> 时间：2009-03-17T13:30:46.777
> 
> 标签：configuration, configuration-files, fitnesse

我使用 FitNesse 作为功能测试框架。当 FitNesse 运行需要配置的代码时，我遇到了麻烦。

如果我需要从配置文件中获取连接字符串，我可以通过将其添加到 FitServer.exe.config 来使其工作。但是，我不喜欢这种解决方案。我希望 FitNesse 加载我自己的配置文件，即 TheNameOfMyApp.dll.config。

这可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T18:24:58.223

当然，很容易做到。我假设您使用的是 dotnet 或 dotnet2 测试运行器。我正在使用 dotnet2 测试运行程序，这是我设置它的方式：

首先，当您定义 COMMAND_PATTERN 时，包括 -c suite.config。例如，我在根目录中有以下内容：

```
!define COMMAND_PATTERN {%m -c suite.config %p}
!define TEST_RUNNER {..\..\bin\Debug\FitServer.exe} 
```

suite.config 与 Fitnesse.jar 位于同一目录中：

```
<suiteConfig>
    <fit.Settings>
        <appConfigFile>..\..\MyProjectFolder\fitnesse\MyProjectName.config</appConfigFile>
    </fit.Settings>
    <fit.Assemblies>
    </fit.Assemblies>
    <fit.FileExclusions>
        <add>^\.svn$</add>
    </fit.FileExclusions>
    <fit.Namespaces>
    </fit.Namespaces>
    <fit.CellHandlers>
    </fit.CellHandlers>
    <fitlibrary.CellHandlers>
    </fitlibrary.CellHandlers>
</suiteConfig> 
```

MyProjectName.config 如下所示：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <appSettings>
        <add key="keyname" value="something" />
    </appSettings>

</configuration> 
```

如果您为 appConfigFile 使用绝对路径，您可以让事情变得更容易。我从绝对路径开始，开始工作，然后通过反复试验切换到相对路径。

请注意，我正在从非标准位置运行我的测试运行程序，这将影响 suite.config 中的相对路径。该路径是相对于您的 TEST_RUNNER 位置的，而不是相对于 suite.config 或 Fitnesse.jar 的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T13:34:41.917

是的，这是可能的，但工作量很大。您需要定义一个包含测试的测试项目和一个“包装”项目，您可以在其中定义为测试提供数据和配置设置的功能。

# asp.net - 我必须使用 jQuery 的 load() 方法将现有的 asp.net Web 应用程序集成到另一个页面中

> ID：654270
> 
> 赞同：1
> 
> 时间：2009-03-17T13:32:55.367
> 
> 标签：asp.net, jquery, ajax

我必须使用 jQuery load() 调用将现有的简单 asp.net 网络表单应用程序（包括回发等）集成到另一个外部站点，该应用程序旨在通过 iframe 集成。我怀疑在不重写应用程序的情况下这是可能的。

该应用程序是一个基本的问卷调查，最终将用户引导至产品建议。

有人对我如何解决这个问题有任何指示吗？我想我可能不得不用 Web 服务和对 RenderUserControls 的动态调用来重写应用程序，我还需要访问调用 load() 的页面并编写额外的 jQuery 方法来处理用户输入......我可能会有删除所有asp.net 的回发调用并重写用户输入的处理？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T06:27:50.647

首先你应该注意这个`load()`函数，就像所有的 ajax 一样，只能在同一个域上工作。因此，如果“外部站点”在另一个域上，则 ajax 是错误的选择。

这听起来确实很辛苦，具体取决于页面的复杂性。回发可能发生在许多地方——图像点击、组合选择等。此外，还有一些隐藏字段需要担心，例如视图状态和事件处理程序——它们在两个页面上具有相同的名称。如果外部站点没有状态和回发，您将有更轻松的时间。

如果页面相对简单，这可能是可以做到的。根据我的经验，表单在其他表单中效果不佳，因此您必须删除其中一个（可能是加载页面的表单），或者将它们一个接一个地放置。正如您所提到的，您必须重写回发，您需要[序列化](http://docs.jquery.com/Ajax/serialize)数据。您可以更改此字符串以适合原始页面上的名称（如果您更改了视图状态的名称等，将其更改回序列化字符串比弄乱 ID 更容易），将其发布到原始页面，然后重新加载。

就个人而言，尽管我很喜欢 jQuery，而且这个项目听起来很有趣（而且确实如此），但我可能会选择服务器端解决方案。创建用户控件（可能使用 ajax 本身）或使用 Web 服务或更好的通用处理程序公开页面功能听起来要容易得多。

# iphone - 是否可以以编程方式删除 Cocoa/iPhone 中域的 cookie

> ID：654273
> 
> 赞同：0
> 
> 时间：2009-03-17T13:33:42.353
> 
> 标签：iphone, objective-c, cookies

基本上我使用 NSURLRequest 向服务器发出请求，例如：GET www.example.com/blah

服务器的响应告诉浏览器设置一些 cookie。我需要这些 cookie 来向 www.example.com/blah2 和 blah3 等发出后续请求。

一旦我完成了一系列顺序请求，我需要重新运行它们，除非我想从服务器获取新的 cookie。理想情况下，我想在重新运行 GET 序列之前删除 example.com 域上的所有 cookie。

在 Cocoa/iPhone SDK 中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T14:20:01.837

调查`NSHTTPCookieStorage`。它应该能够做你需要的一切。

# stored-procedures - 存储过程选择作为参数

> ID：654274
> 
> 赞同：2
> 
> 时间：2009-03-17T13:34:13.057
> 
> 标签：stored-procedures, select

以下是否可能：

EXEC sp_Edu3_DeleteTreeStructure（从 TreeStructures 中选择 TreeStructureId）

SP 通常采用一个参数。我想要的是为查询找到的每个 TreeStructureId 执行 SP。

谢谢，列文卡登

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T13:40:37.143

您可以使用 CURSOR 来执行此操作。

```
DECLARE @treeStructureId int

DECLARE TreeStructureCursor CURSOR FOR
    SELECT
        TreeStructureId
    FROM
        TreeStructures

OPEN TreeStructureCursor

FETCH NEXT FROM TreeStructureCursor
INTO @treeStructureId

WHILE @@FETCH_STATUS = 0
BEGIN
    EXEC sp_Edu3_DeleteTreeStructure(@treeStructureId)

    FETCH NEXT FROM TreeStructureCursor
    INTO @treeStructureId
END

CLOSE TreeStructureCursor
DEALLOCATE TreeStructureCursor 
```

# jsf - 如何将现有的 JSF 组件添加到我自己的自定义组件中？

> ID：654284
> 
> 赞同：5
> 
> 时间：2009-03-17T13:35:49.493
> 
> 标签：jsf, taglib, uicomponents

我有一个扩展 UIComponent 和 UIOutput 的标记类。在这个类中，我有 encodeBegin 和 encodeEnd ，我可以使用我的 contextWriter 来输出任何我想要的 html 标签，方法是使用 writer.startElement("div", myComponent) 等等。

我现在的问题是我需要插入例如 a 而不是使用 writer.startElement。我可以通过 getChildren().add(HtmlCommandButton button = new HtmlCommandButton()); 但是当这样做时，我似乎无法输出我希望它们出现的组件，就像我可以使用 write.startElement 一样。

关于如何利用我自己的标签库中的richfaces标签、JSF标签和类似标签，有人有什么好的解决方案吗？简而言之，我真正想做的是在我的 encodeBegin 中：

```
writer.startElement("a4j:commandButton", myComponent);
writer.writeAttribite("action", "#{Handler.myAction}", null);
writer.endElement("a4j:commandButton"); 
```

提前致谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T16:51:39.507

您不能随意使用*ResponseWriter*。我可以想到如何以编程方式添加子控件的两种方法是通过*绑定*属性（[请参阅此答案](https://stackoverflow.com/questions/650838/jsf-responsewriter-custom-components/652333#652333)）或在通常创建控件的位置（在 JSP 中，即在[标记类](http://java.sun.com/javaee/5/docs/api/javax/faces/webapp/UIComponentELTag.html#createComponent(javax.faces.context.FacesContext,%20java.lang.String))中）。

JSF 组件包含其他控件有两种方式：作为子控件或作为命名方面。组件总是控制它们如何渲染它们的切面；如果他们要渲染他们的孩子，他们必须为[getRendersChildren](http://java.sun.com/javaee/5/docs/api/javax/faces/component/UIComponent.html#getRendersChildren())返回 true 。

这是未经测试的代码，但顺序如下：

```
 @Override
  public boolean getRendersChildren() {
    return true;
  }

  @Override
  public void encodeBegin(FacesContext context)
      throws IOException {
    // should really delegate to a renderer, but this is only demo code
    ResponseWriter writer = context.getResponseWriter();
    writer.startElement("span", this);
    String styleClass = getStyleClass();
    writer
        .writeAttribute("class", styleClass, "styleClass");

    UIComponent headerComponent = getFacet("header");
    if (headerComponent != null) {
      headerComponent.encodeAll(context);
    }

    writer.startElement("hr", null);
  }

  @Override
  public void encodeChildren(FacesContext context)
      throws IOException {
    ResponseWriter writer = context.getResponseWriter();
    for (UIComponent kid : getChildren()) {
      kid.encodeAll(context);
      writer.startElement("br", null);
    }
  }

  @Override
  public void encodeEnd(FacesContext context)
      throws IOException {
    ResponseWriter writer = context.getResponseWriter();
    writer.endElement("span");
  } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T14:07:08.500

不是真正的答案，更多的是猜测，但也许您可以扩展其中一个 facelets 控件？

或者，或者直接使用 facelets - 尽管我自己没有使用它，但这似乎正是你真正想要的。或者，您可以在希望 HTML 出现的位置添加 UIOutput 控件，并将每个控件的值设置为您希望出现的 HTML - 这正是 f:verbatim 在幕后所做的，或者从查看源代码看来：- )

# sql - 如何将此 GROUP BY / MIN SQL 查询转换为 LINQ？

> ID：654285
> 
> 赞同：22
> 
> 时间：2009-03-17T13:36:35.297
> 
> 标签：sql, linq, linq-to-sql, translate

我计划在子查询中使用它，但无法找出将以下查询转换为 LINQ 的正确语法：

```
select ChapterID, min(MeetingDate)
from ChapterMeeting
group by ChapterID 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-17T13:46:41.340

```
var query = myDataContext.ChapterMeeting
  .GroupBy(cm => cm.ChapterID)
  .Select(g => new {
      g.Key,
      MinMeetingDate = g.Min(cm => cm.MeetingDate)
  }); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-17T13:52:46.257

好吧，艾米打败了我，但如果你想用“理解”语法来查看它：

```
var q = (
    from cm in context.ChapterMeeting
    group cm by cm.ChapterID into cmg
    select new {
        ChapterID = cmg.Key,
        FirstMeetingDate = cmg.Min(cm => cm.MeetingDate)}); 
```

# c# - 如何确定控件当前是否正在失效？

> ID：654286
> 
> 赞同：0
> 
> 时间：2009-03-17T13:37:11.783
> 
> 标签：c#, .net, winforms, datagridview, invalidation

我正在编写一个`DataGridView`托管控件的自定义单元类。我正在听该`Invalidated`事件以了解是否应该重新定位和重新绘制单元格，但我得到了循环，因为重新定位单元格会使其他托管单元格无效，然后使第一个单元格无效，依此类推。我不想使用静态成员来避免循环，因为如果它们曾经一起使用，那不会防止由相似但不相关的单元类引起的循环。所以我需要检查网格当前是否失效。我怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T15:27:32.753

您不必“听”无效的事件。当用户控件无效时，会自动调用 onpaint。

可能有更好的方法来解决您的最终问题（绘制您的自定义数据网格视图）。您可以尝试发布有关您的实施的详细问题，并询问有关如何进行的一些想法，这样您就不必解决这些（看似奇怪的）问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T13:41:31.073

听起来您想覆盖 DataGridViewCell 类的 Paint 成员，而不是尝试侦听和响应 Invalidated 事件。基类会为您处理这些问题，并将图形对象和位置信息直接提供给 Paint 方法

# java - GraphViz 的纯 Java 重新实现？

> ID：654294
> 
> 赞同：54
> 
> 时间：2009-03-17T13:39:56.473
> 
> 标签：java, drawing, graphviz, graph-visualization

是否有 GraphViz 的开源 Java 替代品？我知道 Grappa 的存在，它基本上将 Graph 接口包装为 GraphViz 作为 JavaAPI。但是布局仍然由 GraphViz 二进制文件完成。

我正在寻找一个纯 Java 的开源库，它提供与 GraphViz 相同的功能和布局算法。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-02T01:43:32.697

您可以查看具有可视化和分析功能的[JUNG（Java 通用网络/图形框架） 。](http://jung.sourceforge.net/)它是开源的。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-11-06T23:44:53.720

有趣的是，Eclipse 项目有一个 SWT/JFace 组件/框架，能够以纯 Java 显示和生成（导入/导出）Graphviz 的“DOT”格式：

[ZEST（主页和下载链接）](http://wiki.eclipse.org/Zest)

有关使用示例，请参阅[http://wiki.eclipse.org/Graphviz_DOT_as_a_DSL_for_Zest](http://wiki.eclipse.org/Graphviz_DOT_as_a_DSL_for_Zest)。

尽管 ZEST 被吹捧为 Eclipse 插件，但 DOT 操作 API 似乎可以独立使用，也可以在 Eclipse 安装外部使用。

澄清一下，DOT 功能是[ZEST 2](http://wiki.eclipse.org/Zest)功能的一部分，它本身是[GEF4](http://wiki.eclipse.org/GEF/GEF4)项目的子组件。

干杯

富有的

**更新（2017 年 5 月）** [https://github.com/nidi3/graphviz-java](https://github.com/nidi3/graphviz-java)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-17T14:00:11.573

[尽管我从未使用过JGraph](http://www.jgraph.com/jgraph.html) ，但您可以查看它，因此现在无法评论它与 GraphViz 的比较。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-17T13:42:39.447

[yFiles](http://www.yworks.com/en/products_yfiles_about.html)似乎提供了所有这些，但它不是免费的，也不是很便宜。不过话说回来，好像是个很专业的产品（没用过，除了[yEd](http://www.yworks.com/en/products_yed_about.html)，可以免费使用）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-08-12T02:25:22.273

我猜[ZGRViewer](http://zvtm.sourceforge.net/zgrviewer.html)是你想要的。我真的很喜欢 ZGRViewer 和 AJaPaD。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-02-27T14:57:43.503

大约四年前，我与[yFiles合作过，非常棒。](http://www.yworks.com/en/products_yfiles_about.html)它的成本很高（尽管显然比 JGraph 便宜），但我在 CS 研究实验室工作，并且可以获得他们慷慨的学术定价。

# jquery - 如何使用 jQuery 获得锚点的 :hover css 样式？

> ID：654295
> 
> 赞同：5
> 
> 时间：2009-03-17T13:40:13.150
> 
> 标签：jquery, css, hover, anchor

如何使用 jquery 即时获取 css 样式表中的 :hover ？

愚蠢的例子：

```
a.foo {
    color: red;
    font-size: 11px;
}

a.foo:hover {
    color: blue;
    font-size: 12px; 
} 
```

如何在鼠标越过锚点之前检索该颜色和字体大小？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-02-12T11:21:40.507

如果您确实需要，可以通过 document.styleSheet 属性访问此信息。此处提供了一个示例：http: [//jsfiddle.net/Xm2zU/1/](http://jsfiddle.net/Xm2zU/1/)

请注意，IE 需要自己的代码来执行此操作，因为它使用“.rules”而不是“.cssRules”等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:48:50.587

看看[jQuery 的额外选择器](http://www.softwareunity.com/jquery/JQueryMoreSelectors/)。

此外，您可以使用该`hover`事件，具体取决于您想要实现的目标。请参阅：[jQuery 悬停和类选择器](https://stackoverflow.com/questions/275891/jquery-hover-and-class-selector)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-17T09:38:15.697

> 如何在鼠标越过锚点之前检索该颜色和字体大小？

不可以。在将鼠标悬停在该元素上之前，您无法检索**:hover伪类的样式声明。**这是因为 JavaScript 只能使用 DOM 与 HTML 交互。除非元素上有鼠标悬停，否则样式信息（对于悬停状态）对 DOM 不可用，因此您无法检索这些值（即使通过模拟悬停状态）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-13T09:30:15.107

您可以改用`.hover()`函数。 [http://api.jquery.com/hover/](http://api.jquery.com/hover/)

```
$( "a.foo" ).hover(
  function() {
    $( this ).css( 'color','red' );
  }, function() {
    $( this ).css( 'color','blue');
  }
); 
```

# svn - 从项目中删除 Subversion 源代码控制 (Visual Studio/TortoiseSVN)

> ID：654296
> 
> 赞同：6
> 
> 时间：2009-03-17T13:40:18.360
> 
> 标签：svn, tortoisesvn

> **可能重复：**
> [如何删除文件夹的 Subversion 控制？](https://stackoverflow.com/questions/154853/how-do-you-remove-subversion-control-for-a-folder)

我正在为我的项目实现使用 Subversion 作为源代码控制工具，但是在确定要使用什么结构时我犯了一些错误。所以我向一些我想撤消的文件夹（项目）添加了版本控制。

我怎么做？我是否必须复制文件夹，删除原始文件夹并将源代码管理添加到新文件夹？

我使用 TortoiseSVN 和[Visual Studio 2008](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2008)。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-17T13:43:07.607

只需删除文件夹及其所有子文件夹中的 .svn 文件夹即可。

更简单的方法是使用 TortoiseSVN 导出文件夹。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T15:56:28.657

除了之前的评论：

使用 TortoiseSVN 有一种非常简洁的导出方式。如果您**右键单击**并拖放您的 SVN 文件夹，当您释放鼠标按钮时，您将看到一个包含这些条目的菜单提示

```
SVN Export to here
SVN Export all to here 
```

后者还复制不受 SVN 控制的文件。

这种右键单击技巧也可用于在存储库中拖动文件和文件夹（同时编辑工作副本），以实现原本棘手的移动和复制。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T13:50:44.950

Can Berk Güder 是正确的，但根据我对 SVN 的经验（并不总是很愉快），我可能会补充说，您可能想检查您的 SVN 存储库以确保没有任何孤儿在那里闲逛重新提交时不可调和。

并且要小心 TortoiseSVN，它的状态并不总是正确的。可能最好运行 Clean post 集成。

另外，看看 VisualSVN。它克服了 DLL 意外进入您的源代码控制的问题，并且与 Visual Studio 2008 配合得非常好。我使用它，它会自动添加精美的东西。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-10-14T07:12:59.247

您还可以使用从 Visual Studio 切换解决方案。它创造了奇迹。

# safari - JSP 页面在 Safari 中默认加载一半滚动

> ID：654305
> 
> 赞同：0
> 
> 时间：2009-03-17T13:41:33.210
> 
> 标签：safari

我有一个网络应用程序。它在 Firefox 和 IE 中显示良好。但是当我使用 Safari 时，在加载足够长的页面时似乎会出现问题，以便在其中包含垂直滚动条。默认情况下，页面加载并显示页面的底部或中间。仅当 Safari 未最大化为全屏时才会发生这种情况。

有没有人经历过这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T18:42:25.357

我想到了。当有一个文本字段被聚焦时，每当页面加载或刷新时，Safari 都会尝试将文本字段保留在显示区域内（与 FF 或 IE 不同）。因此，我的文本字段向下滚动，因此在每次页面加载时都会向下滚动。

# java - 方法变量和包名之间的 Java 命名冲突

> ID：654308
> 
> 赞同：3
> 
> 时间：2009-03-17T13:42:49.290
> 
> 标签：java, web-services, axis, convention, name-clash

我有一些由 Axis 框架从 WSDL 文件生成的类。在其中一个类中，有一个生成的方法

```
 public com.initechsystems.www.initech7.initechbo.Organization createOrganization(com.initechsystems.www.initech7.initechbo.Organization org) throws java.rmi.RemoteException {

//(... snip ...)
_call.setProperty(org.apache.axis.client.Call.SEND_TYPE_ATTR, Boolean.FALSE);
//(... snip ...)
} 
```

方法参数中的变量名 org 与包 org.apache.axis.client 产生命名冲突，因为编译器无法区分包和变量。我意识到我可以通过更改方法中的变量名 org 轻松解决此问题，但我想避免这种情况，因为它会减慢工作流程。除了修改 WSDL 文件或生成的类之外，还有其他方法吗？

**编译器错误：**

```
 D:\projects\java\initechdir\target\generated-sources\axistools\wsdl2java\com\initechsystems\www\initech7\initechws\OrganizationManagement\OrganizationManagementSoapStub.java:[1678,29] cannot find symbol
symbol  : variable apache
location: class com.initechsystems.www.initech7.initechbo.Organization 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T14:12:15.490

有没有办法使生成的代码具有导入语句？这将阻止您必须拥有类的完全限定名称。

因此，如果您可以添加：

```
import org.apache.axis.client.Call; 
```

到该文件，那么您的方法调用将是：

```
_call.setProperty(Call.SEND_TYPE_ATTR, Boolean.FALSE); 
```

我不确定Axis是否有这个选项。如果不是，我会说重命名变量（也许是“组织”）将是最好的事情。我建议避免手动编辑自动生成的文件，因为这会使重新生成它们变得更加困难。

# php - 清理 php 会话文件

> ID：654310
> 
> 赞同：70
> 
> 时间：2009-03-17T13:43:34.420
> 
> 标签：php, session

在我的网站上，我使用 PHP 会话。会话信息存储在我的 ./session 路径中的文件中。几个月后，我发现这些会话文件永远不会被删除，现在这个目录中有 145.000 个。

这些应该如何清理？我是否必须以编程方式执行此操作，或者是否可以在某个地方使用可以自动进行此清理的设置？

**编辑**忘了提及：这个站点在提供商处运行，所以我无权访问命令行。我确实有 ftp 访问权限，但会话文件属于另一个用户（我猜是网络服务器进程运行的那个）从我得到的第一个答案中，我认为这不仅仅是服务器或 PHP 上的设置，所以我想我会必须在 PHP 中为它实现一些东西，并定期从浏览器调用它（可能来自在我家自己的机器上运行的 cron 作业）

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-03-17T14:45:27.190

要正确处理会话，请查看[http://php.net/manual/en/session.configuration.php](http://php.net/manual/en/session.configuration.php)。

在那里你会发现这些变量：

*   session.gc_probability
*   session.gc_divisor
*   session.gc_maxlifetime

这些控制垃圾收集器 (GC) 运行每个页面请求的概率。

您可以在脚本或 .htaccess 文件的开头使用[ini_set()](http://php.net/manual/en/function.ini-set.php)设置它们，以便在某种程度上确定它们会在某个时候被删除。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-03-17T13:50:52.453

Debian/Ubuntu 使用 /etc/cron.d/php5 中定义的 cronjob 来处理这个问题

```
# /etc/cron.d/php5: crontab fragment for php5
#  This purges session files older than X, where X is defined in seconds
#  as the largest value of session.gc_maxlifetime from all your php.ini
#  files, or 24 minutes if not defined.  See /usr/lib/php5/maxlifetime

# Look for and purge old sessions every 30 minutes
09,39 *     * * *     root   [ -d /var/lib/php5 ] && find /var/lib/php5/ -type f -cmin +$(/usr/lib/php5/maxlifetime) -print0 | xargs -r -0 rm 
```

maxlifetime 脚本通过检查 php.ini 简单地返回会话应该保持活动状态的分钟数，它看起来像这样

```
#!/bin/sh -e

max=1440

for ini in /etc/php5/*/php.ini; do
        cur=$(sed -n -e 's/^[[:space:]]*session.gc_maxlifetime[[:space:]]*=[[:space:]]*\([0-9]\+\).*$/\1/p' $ini 2>/dev/null || true);
        [ -z "$cur" ] && cur=0
        [ "$cur" -gt "$max" ] && max=$cur
done

echo $(($max/60))

exit 0 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2014-01-30T08:40:52.137

如果有人想使用 cronjob 执行此操作，请记住：

```
find .session/ -atime +7  -exec rm {} \; 
```

真的很慢，当有很多文件时。

考虑改用这个：

```
find .session/ -atime +7 | xargs -r rm 
```

如果文件名中有空格，请使用：

```
find .session/ -atime +7 -print0 | xargs -0 -r rm 
```

`xargs`将用要删除的文件填充命令行，然后运行`rm`比 少得多`-exec rm {} \;`的命令，这将为每个文件调用`rm`命令。

只是我的两分钱

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-03-30T16:31:35.097

cd 到会话目录，然后：

1) 查看超过 40 分钟的会话： `find . -amin +40 -exec stat -c "%n %y" {} \;`

2) 删除超过 40 分钟的会话： `find . -amin +40 -exec rm {} \;`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-17T13:46:56.223

使用 cron 和 find 来删除早于给定阈值的文件。例如删除至少一周未访问的文件。

```
find .session/ -atime +7  -exec rm {} \; 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-05-13T10:50:39.053

您可以创建脚本 /etc/cron.hourly/php 并放在那里：

```
#!/bin/bash

max=24
tmpdir=/tmp

nice find ${tmpdir} -type f -name 'sess_*' -mmin +${max} -delete 
```

然后使脚本可执行（chmod +x）。

现在每小时将删除所有修改数据超过 24 分钟的会话文件。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-02-25T00:05:52.340

```
# Every 30 minutes, not on the hour<br>
# Grabs maxlifetime directly from \`php -i\`<br>
# doesn't care if /var/lib/php5 exists, errs go to /dev/null<br>

09,39 * * * *   find /var/lib/php5/ -type f -cmin +$(echo "\`php -i|grep -i session.gc_maxlifetime|cut -d' ' -f3\` / 60" | bc) -exec rm -f {} \\; >/dev/null 2>&1 
```

故障：仅文件： **find /var/lib/php5/ -type f**
超过分钟： **-cmin**
获取 php 设置： **$(echo "`php -i|grep -i session.gc_maxlifetime** 算术： **|cut -d ' ' -f3` / 60" | bc)**
RM 匹配文件： **-exec rm -f {} \;**

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-18T02:44:22.587

我最好的猜测是您在共享服务器上，并且会话文件与所有用户混合在一起，因此您不能也不应该删除它们。如果您担心扩展和/或您的用户会话隐私，您可以做的是将会话移动到数据库。

开始将该 Cookie 写入数据库，在时间到期时，您可以在多个服务器上扩展您的应用程序还有很长的路要走。

除此之外，我不会担心 145.000 个文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-07T16:53:54.407

使用下面的 cron：

```
39 20     * * *     root   [ -x /usr/lib/php5/maxlifetime ] && [ -d /var/lib/php5 ] && find /var/lib/php5/ -depth -mindepth 1 -maxdepth 1 -type f -cmin +$(/usr/lib/php5/maxlifetime) -print0 | xargs -r -0 rm 
```

# javascript - 可以使用 jQuery 进一步简化这段 Javascript 代码吗？

> ID：654313
> 
> 赞同：2
> 
> 时间：2009-03-17T13:44:26.777
> 
> 标签：javascript, jquery, refactoring, prototypejs

我有以下 Javascript 片段，它只是将 onclick 附加到按钮，然后更新其下方 em 标记的文本。我正在慢慢地尝试自学并更多地使用 jQuery，因为我发现我更喜欢这种语法，而且对于某些任务，使用它更令人愉快。

我发现的一些最好的例子来自 Stackoverflow，所以我再次来看看如何用 jQuery 重构和改进它；有什么想法吗？

```
$$('em.green').each(function(em) { 
  em.up('button').onclick = function() { 
    em.update('Saving...') 
  }; 
}); 
```

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T14:29:16.730

试试这个，稍微短一点：

```
$('button').click(function(i, button) { 
  $(button).closest('em.green').html('Saving...');
}); 
```

使您不必遍历每个 EM，然后绑定 onclick。可能还有助于为按钮添加一个类，这样您就不会绑定到页面上的每个按钮，以防万一还有其他按钮。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T14:02:05.873

这是您的原型代码的逐行翻译。没有太大不同：

```
$('em.green').each(function(i, em) {
    $(em).closest('button').click(function() { 
        $(em).html('Saving...') 
    })
}); 
```

IMO 原型版本看起来也一样好，如果不是更好（没有`$`到处洒）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T15:45:59.137

这有点短，可能更容易理解，但重复了“em.green”选择器。

```
$('button:has(em.green)').click(function() {
    $(this).find('em.green').html('Saving...');
}); 
```

[crescentfresh 的回答](https://stackoverflow.com/questions/654313/can-this-snippet-of-javascript-be-simplified-more-with-jquery/654396#654396)也不错，不需要每次都搜索 em 元素。不过，性能影响应该不明显，因为您可能在按钮下没有巨大的元素树。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T16:03:10.780

Matthew Crumley 的回答很好，但是为什么要附加多个处理程序呢？

额外的好处是，如果您在文档生命周期的后期创建任何 em.green 元素，这也将起作用。

```
$('button:has(em.green)').live('click', function(){
  $(this).find('em.green').html('Saving...')
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T18:10:02.080

（我无法编辑，所以我必须创建一个新答案，但是:)

略短：

```
$('button').click(function() { 
  $(this).closest('em.green').html('Saving...');
}); 
```

使您不必遍历每个 EM，然后绑定 onclick。可能还有助于为按钮添加一个类，这样您就不会绑定到页面上的每个按钮，以防万一还有其他按钮。

不需要包含函数参数，使用 this 变量来指定要查找其最近父级的上下文。

# sharepoint - 软件架构师应具备哪些有关 SharePoint 的知识？

> ID：654318
> 
> 赞同：5
> 
> 时间：2009-03-17T13:45:28.987
> 
> 标签：sharepoint, architecture

在我们公司，我们目前正在尝试定义我们的软件架构师必须了解的有关 SharePoint 的基本知识，以便他们构建和/或领导 SharePoint 实施项目。我们公司的许多架构师都有 .NET 开发人员背景，并且非常了解 .NET 开发以及各种框架组件和工具。但是，他们目前缺乏 SharePoint 知识。事实上，他们甚至不想知道细节。他们想要了解足够多的信息，以便做出正确的架构决策并应用经过验证的模式。如果需要更具体的知识，他们会询问 SharePoint 专家。

那么架构师需要具备哪些基本的 SharePoint 知识/技能？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T14:33:57.763

列表、文档、工作流、权限等技能有点太基础了，是 SharePoint 开发人员的要求。

我认为也许场地（和场地结构）是一个属于建筑师的领域。

SharePoint 架构师可以在更多领域提供帮助：

*   容量规划 - 在一个场中运行多台服务器。可扩展性和其他神奇的词。

*   了解使用 SharePoint 的功能和业务场景 - 这是一个非常常见的问题。
    经理问：SharePoint 能为我做什么？开发者问：好吧，你想让它做什么。然后经理问：嗯，我不知道它可以为我做什么，那么我怎么知道我想要它做什么？

*   与 SharePoint 功能密切相关的是与每个组件相关的各种许可成本。

*   以及熟悉开发和定制成本。使用与 ASP.NET 相同的项目时间，然后将其乘以一个大系数，然后再加一个常数。

*   与可以做什么和成本多少密切相关的是投资回报率的所有重要问题。 **所有人都欢呼最高的投资回报率！**

*   SharePoint 部署可能是一个巨大的问题和很多痛苦。

*   SharePoint 从 v2 (MOSS 2003) 升级到 v3 (MOSS 2007)。我们应该会在 2010 年看到新版本的 SharePoint（？）。在下一版 Office 面世后不久。所以过去的升级经验可能会有用。

*   了解第 3 方 Web 部件。我相信 SharePoint 架构师应该能够为您提供他们从 CodePlex 尝试过的至少 5 个 Web 部件，并告诉您他们对它们的看法。这些都是免费的，很容易在你自己的闲暇时抓住和玩。

*   一些商业webpart的知识。因为它们仍然比自己编写便宜。

*   至少有 5 个他们虔诚地关注的 SharePoint 博客（了解社区）。如果没有自己的 SharePoint 博客（回馈社区）。

*   如果他们在 StackOverflow 上，他们必须尝试回答 SharePoint 问题（例如这个问题）。

*   参加本地 SharePoint 用户组。我认为社区很重要。尤其是您从直接与人交谈以及了解他们使用 SharePoint 安装所做的事情中学到的东西。你可能会让自己感到惊讶。

*   SharePoint 集成体验 - 这有两种同样重要的风格 - 来自 SharePoint 访问现有系统（业务目录、Web 部件等），以及其他系统通过 Web 服务或 API 访问 SharePoint 内容。

*   此外，SharePoint 与 Office、OCS、报告服务、性能点、项目服务器一起使用（或很好地使用）。

*   SharePoint 托管安排 - Microsoft SharePoint 在线服务可能是开始使用 SharePoint 的一种流行且更便宜的选择。它可以在内部托管，也可以由第三方公司托管。了解选项总是有用的。

*   必须已使用反射器阅读过 SharePoint 代码（最好还有头发）。

我认为成为 SharePoint 架构师至少需要几年的时间（您的里程可能会有所不同）。您的 .NET 架构师需要成为 SharePoint 架构师，否则我同意其他人在我面前的总结 - 找一个已经是 SharePoint 架构师的人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:54:41.727

从功能和技术的角度来看，架构师应该对我们的产品作品有很好的了解。

所以在我看来，建筑师应该：

*   从设计到推出，至少参与了 2 次 Sharepoint 部署。
*   了解我们主要的共享点组件可以使用 API。即站点、列表、文档和工作流组件。

由于您的架构师都没有这方面的知识，我会将他们与现有 Sharepoint 项目中的 Sharepoint 专家配对，以便他们获得所需的知识。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-06T00:19:44.570

理想情况下，SharePoint 架构师技能属于以下类别

1.  基础设施级别/运营
    1.  容量规划
    2.  物理架构（农场设置、网络、操作系统、许可）
2.  应用程序级别（功能和非功能）\
    1.  需求和可行性分析（定制与 OOTB 开发/实施）
    2.  需求的技术功能映射
    3.  信息架构
    4.  逻辑架构
    5.  概念架构
    6.  详细设计
    7.  数据库设计（不是传统的数据库设计），这是关于网站集/Web 应用程序的内容数据库数量。
3.  部署
    1.  首次部署和增量部署的最佳方式

架构师将协同工作的其他一些活动是规划、估计、执行/实施、风险管理（评估、缓解）的项目经理。

除了与技术团队、测试人员、用户界面专业人员、供应商、客户（业务和 IT 团队）合作的日常任务之外。

与 Enterprise Architect 组（如果有）进行交互。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-07T19:20:05.160

在我不那么谦虚的意见中，我认为整个“Sharepoint Architect”/“Expert”这件事被**夸大了**。Sharepoint 是一种**集中**组织数字资源以进行**集中协作**或**以集中方式协同工作**的工具。

WROX 书籍“Beginning Sharepoint 2010 - Building Business Solutions”中对 Microsoft Sharepoint 是什么以及做什么的最佳解释

“由于计算机在任何业务中都扮演着不可或缺的角色，因此在组织中创建、使用和共享的信息越来越多是数字化的，这并不奇怪。您开展的业务越多，您的业务就越成功，您必须管理的更多信息。通常，对于公司日常运营中发生的每个流程和交易，您都有某种形式的文档。从提案到法律文件，从销售收据到人力资源政策，公司运作所需的信息量是惊人的。

为了管理您的信息过载，SharePoint 提供了一些工具，您可以使用这些工具构建业务应用程序以更好地存储、共享和管理数字信息。有了它，您可以为您的各个公司团队创建列表、库和网站，以帮助更有效地运行您的业务流程。通过将组织的重要业务数据定位在一个位置，用户可以在需要时更轻松、更直观地找到正确的信息，而不是通过电子邮件、计算机硬盘驱动器或文件共享等不同的位置进行搜索。

什么是共享点 2010？SharePoint 2010 是一个可扩展且可扩展**的基于 Web 的**平台，由支持团队内、整个企业和 Web 上的协作和信息共享的工具和技术组成。总包是一个平台，您可以在该平台上构建业务应用程序，以帮助您更好地存储、共享和管理组织内的数字信息。由于您可以使用或不使用代码进行构建，因此该软件包使普通业务用户能够创建、部署和管理团队网站，而无需依赖熟练的资源，例如系统管理员或开发人员。 **使用列表、库和 Web 部件，您可以将团队网站转变为专门为提高组织的业务流程效率而构建的业务应用程序**。”

为组织 Sharepoint 部署创建架构不是火箭科学。1\. 确定组织的结构 2\. 确定 Sharepoint 在集中组织数字资源方面可以做什么。3\. 制定 Sharepoint 建设计划。4\. 构建、测试、改进。5\. 维护它、测试它、改进它、添加它。那里！没那么难。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T13:54:00.527

如果您不了解 Sharepoint 的来龙去脉（他们应该是构建它的专家），Sharepoint 可能是一个令人讨厌的野兽。他们至少应该知道列表、站点和权限是如何工作的。理想情况下，他们还应该知道所有 Web 部件如何在页面上组合在一起以及它们应该如何交互。真的，如果架构师不想了解 sharepoint，他们将创建一个 .net Web 应用程序并强制它在 sharepoint 上运行。它不会真正遵循共享点应用程序应该如何工作的范式。

我会看一家名为[Mind Sharp](http://www.mindsharp.com)的公司，以获取他们应该学习什么的指导。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T10:40:00.783

我的建议是在 Sharepoint 世界中寻找一个不只是阅读 PowerPoint 的实干家，这只是基于其他人所说的话。

我们在 Sharepoint 农场中抓取 500000 个项目时遇到了问题，每个人都给出了另一个故事如何获得更好的速度......通常人们指的是文件夹中不超过 2000 个项目，但这不会改变抓取速度...... .

所以一个好的架构是一个能够自己对他的设计进行概念验证的人，而不仅仅是参考一些模糊的故事......

我见过许多没有现实生活经验的 Sharepoint 建筑师......

# linq-to-xml - 在下面为初学者解释 LINQ to XML？

> ID：654328
> 
> 赞同：2
> 
> 时间：2009-03-17T13:47:39.340
> 
> 标签：linq-to-xml

有人可以解释下面的 LINQ to XML 吗？另外，检查方法是否返回带有数据的列表的正确方法是什么？你只是检查列表是否为空。

### 代码：

```
public List<Listing> GetList()
{
    if (File.Exists(this.xmlFilePath))
    {
        XDocument doc = XDocument.Load(this.xmlFilePath);

        var listings = from row in doc.Root.Elements("listing")
                       select new Listing
                       {
                           A = (string)row.Element("A"),
                           B = (string)row.Element("B"),
                           C = (string)row.Element("C"),
                           D = (string)row.Element("D"),
                           E = (string)row.Element("E")
                       };

        return listings.ToList();
    }
    else
    {
        return new List<Listing>();
    }
} 
```

### XML:

```
<Listings>
   <listing>
     <a>A</a>
     <b>B</b>
     <c>C</c>
     <d>D</d>
     <e>E</e>
    </listing>
    <listing>
     <a>F</a>
     <b>G</b>
     <c>C</c>
     <d>H</d>
     <e>I</e>
    </listing>
</Listings> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T14:00:19.000

您可以通过检查变量上的方法`listings`的结果来检查是否有任何数据，并回答下面评论部分中提出的问题，“所以，没有办法实际返回？我必须返回一个对象？”，请看以下代码：`Count()``listings``null``List<listing>()`

```
public List<Listing> GetList()
{
  if (File.Exists(this.xmlFilePath))
  {
    XDocument doc = XDocument.Load(this.xmlFilePath);

    var listings = from row in doc.Root.Elements("listing")
             select new Listing
             {
               A = (string)row.Element("A"),
               B = (string)row.Element("B"),
               C = (string)row.Element("C"),
               D = (string)row.Element("D"),
               E = (string)row.Element("E")
             };

    // Check if we have any matches         
    if(listings.Count() > 0)
    {
      return listings.ToList();
    }

    return null;
  }
  return null;
} 
```

我想这就是你所追求的。

没有太多可以解释代码是如何工作的。在查询的第一部分：

```
var listings = from row in doc.Root.Elements("listing") 
```

该表达式`doc.Root.Elements("listing")`选择`<listing>`文档根 ( `<Listings>`) 下面的所有元素。

查询的第二部分为每个元素创建一个新`Listing`对象，并将每个元素和子元素`<listing>`的内部文本分配给创建的每个新对象的每个属性。`A,B,C,D``E``A,B,C,D``E``Listing`

包含：的行返回对象`return listings.ToList();`的泛型`List<T>`。`Listing`

使用提供的示例 XML，您会发现每个`Listing`对象的`A,B,C,D,`和`E`属性都是`null`. 这是因为每个`row.Element()`选择器的字符大小写与被查询的 XML 不同，即您的 XML 具有`<a>`并`row.Element("A")`使用大写字母`'A'`。LINQ to XML 中的 XML 节点匹配区分大小写。

# c# - 我可以有一个“屏幕外”控制吗？

> ID：654330
> 
> 赞同：1
> 
> 时间：2009-03-17T13:48:13.367
> 
> 标签：c#, .net, winforms, datagridview

我正在尝试创建一个`DataGridView`承载控件的单元格类（一直，而不仅仅是在编辑时）。到目前为止，我的方法是将控件添加到网格并尝试将其位置与单元格的位置同步。

是否可以将单元格保持在屏幕外，将鼠标和键盘事件路由到它，并将其绘制到单元格上？

更新：通过“屏幕外”，我并不是说应该将它添加到另一个控件中以使其不显示；我的意思是它根本不应该被添加到另一个控件中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:09:42.993

您可以创建控件而不将其添加到表单中，然后在需要时将其用作单元格编辑器。通常对于网格，当您单击一个单元格进行编辑时，它将创建一个新控件并将其放在正确的位置，或者它将使用现有控件。您可以通过创建自己的自定义单元格/列类型来简化此过程。请参阅此 MSDN 页面：http: [//msdn.microsoft.com/en-us/library/7fb61s43.aspx](http://msdn.microsoft.com/en-us/library/7fb61s43.aspx)。

大多数网格（包括 DataGridView 和第 3 方网格）都具有添加自定义单元格的功能。

# java - 有可用于 Java Swing 的好的免费日期和时间选择器吗？

> ID：654342
> 
> 赞同：55
> 
> 时间：2009-03-17T13:50:54.700
> 
> 标签：java, swing, datepicker, datetimepicker

有可用于 Java Swing 的好的免费日期和时间选择器吗？

有很多可用的日期选择器，但没有日期和时间选择器。这是迄今为止我遇到的最接近的：[寻找日期和时间选择器](http://forum.worldwindcentral.com/showthread.php?t=15566)

有人吗？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-03-20T09:27:51.783

对于时间选择器，您可以使用 JSpinner 并设置仅显示时间值的 JSpinner.DateEditor。

```
JSpinner timeSpinner = new JSpinner( new SpinnerDateModel() );
JSpinner.DateEditor timeEditor = new JSpinner.DateEditor(timeSpinner, "HH:mm:ss");
timeSpinner.setEditor(timeEditor);
timeSpinner.setValue(new Date()); // will only show the current time 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2012-05-30T16:10:12.603

您可以扩展 swingx JXDatePicker 组件：

> “JXDatePicker 只处理没有时间的日期。很多时候我们需要让用户选择日期和时间。这是一个如何使用 JXDatePicker 一起处理日期和时间的示例。”

[http://wiki.java.net/twiki/bin/view/Javadesktop/JXDateTimePicker](http://wiki.java.net/twiki/bin/view/Javadesktop/JXDateTimePicker)

编辑：这篇文章从网上消失了，但正如 SingleShot 发现的那样，它仍然可以在互联网档案中找到。可以肯定的是，这是完整的工作示例：

```
import org.jdesktop.swingx.calendar.SingleDaySelectionModel;
import org.jdesktop.swingx.JXDatePicker;

import javax.swing.*;
import javax.swing.text.DefaultFormatterFactory;
import javax.swing.text.DateFormatter;
import java.text.DateFormat;
import java.text.ParseException;
import java.util.*;
import java.awt.*;

/**
 * This is licensed under LGPL.  License can be found here:  http://www.gnu.org/licenses/lgpl-3.0.txt
 *
 * This is provided as is.  If you have questions please direct them to charlie.hubbard at gmail dot you know what.
 */
public class DateTimePicker extends JXDatePicker {
    private JSpinner timeSpinner;
    private JPanel timePanel;
    private DateFormat timeFormat;

    public DateTimePicker() {
        super();
        getMonthView().setSelectionModel(new SingleDaySelectionModel());
    }

    public DateTimePicker( Date d ) {
        this();
        setDate(d);
    }

    public void commitEdit() throws ParseException {
        commitTime();
        super.commitEdit();
    }

    public void cancelEdit() {
        super.cancelEdit();
        setTimeSpinners();
    }

    @Override
    public JPanel getLinkPanel() {
        super.getLinkPanel();
        if( timePanel == null ) {
            timePanel = createTimePanel();
        }
        setTimeSpinners();
        return timePanel;
    }

    private JPanel createTimePanel() {
        JPanel newPanel = new JPanel();
        newPanel.setLayout(new FlowLayout());
        //newPanel.add(panelOriginal);

        SpinnerDateModel dateModel = new SpinnerDateModel();
        timeSpinner = new JSpinner(dateModel);
        if( timeFormat == null ) timeFormat = DateFormat.getTimeInstance( DateFormat.SHORT );
        updateTextFieldFormat();
        newPanel.add(new JLabel( "Time:" ) );
        newPanel.add(timeSpinner);
        newPanel.setBackground(Color.WHITE);
        return newPanel;
    }

    private void updateTextFieldFormat() {
        if( timeSpinner == null ) return;
        JFormattedTextField tf = ((JSpinner.DefaultEditor) timeSpinner.getEditor()).getTextField();
        DefaultFormatterFactory factory = (DefaultFormatterFactory) tf.getFormatterFactory();
        DateFormatter formatter = (DateFormatter) factory.getDefaultFormatter();
        // Change the date format to only show the hours
        formatter.setFormat( timeFormat );
    }

    private void commitTime() {
        Date date = getDate();
        if (date != null) {
            Date time = (Date) timeSpinner.getValue();
            GregorianCalendar timeCalendar = new GregorianCalendar();
            timeCalendar.setTime( time );

            GregorianCalendar calendar = new GregorianCalendar();
            calendar.setTime(date);
            calendar.set(Calendar.HOUR_OF_DAY, timeCalendar.get( Calendar.HOUR_OF_DAY ) );
            calendar.set(Calendar.MINUTE, timeCalendar.get( Calendar.MINUTE ) );
            calendar.set(Calendar.SECOND, 0);
            calendar.set(Calendar.MILLISECOND, 0);

            Date newDate = calendar.getTime();
            setDate(newDate);
        }

    }

    private void setTimeSpinners() {
        Date date = getDate();
        if (date != null) {
            timeSpinner.setValue( date );
        }
    }

    public DateFormat getTimeFormat() {
        return timeFormat;
    }

    public void setTimeFormat(DateFormat timeFormat) {
        this.timeFormat = timeFormat;
        updateTextFieldFormat();
    }

    public static void main(String[] args) {
        Date date = new Date();
        JFrame frame = new JFrame();
        frame.setTitle("Date Time Picker");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        DateTimePicker dateTimePicker = new DateTimePicker();
        dateTimePicker.setFormats( DateFormat.getDateTimeInstance( DateFormat.SHORT, DateFormat.MEDIUM ) );
        dateTimePicker.setTimeFormat( DateFormat.getTimeInstance( DateFormat.MEDIUM ) );

        dateTimePicker.setDate(date);

        frame.getContentPane().add(dateTimePicker);
        frame.pack();
        frame.setVisible(true);
    }
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-09-04T17:23:30.073

使用两者结合..这就是我所做的：

```
public static JPanel buildDatePanel(String label, Date value) {
JPanel datePanel = new JPanel();

JDateChooser dateChooser = new JDateChooser();
if (value != null) {
    dateChooser.setDate(value);
}
for (Component comp : dateChooser.getComponents()) {
    if (comp instanceof JTextField) {
    ((JTextField) comp).setColumns(50);
    ((JTextField) comp).setEditable(false);
    }
}

datePanel.add(dateChooser);

SpinnerModel model = new SpinnerDateModel();
JSpinner timeSpinner = new JSpinner(model);
JComponent editor = new JSpinner.DateEditor(timeSpinner, "HH:mm:ss");
timeSpinner.setEditor(editor);
if(value != null) {
    timeSpinner.setValue(value);
}

datePanel.add(timeSpinner);

return datePanel;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-08-25T13:54:54.680

FLib [-JCalendar](http://flib.sourceforge.net/JCalendar/doc/screenshots.html)组件具有组合的日期和时间选择器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T15:27:23.407

正如你所说的日期选择器很容易，那里有很多。

至于时间选择器，请查看 Google 日历在创建新条目时是如何做到的。它允许您输入任何内容，同时它以 30 分钟为增量提供下拉菜单。当您更改分钟时，下拉列表会发生变化。

如果您需要允许用户选择秒数，那么您能做的最好的就是可键入/下拉组合

# javascript - 可能的最高 z-index 是多少？

> ID：654343
> 
> 赞同：4
> 
> 时间：2009-03-17T13:50:55.573
> 
> 标签：javascript, ajax, z-index

我在规格中找不到。我正在使用很多 3rd 方 javascript，并希望确保某些部分出现在其他所有内容之上。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T13:55:33.020

来自[CSS 2.1 规范](http://www.w3.org/TR/CSS21/syndata.html#numbers)：

> ## 4.3.1 整数和实数
> 
> 某些值类型可能具有整数值（用 表示）或实数值（用 表示）。实数和整数仅以十进制表示法指定。An由一个或多个数字“0”到“9”组成。A 可以是 ，也可以是零个或多个数字，后跟一个点 (.)，后跟一个或多个数字。整数和实数前面都可以用“-”或“+”表示符号。-0 相当于 0，不是负数。
> 
> 请注意，许多允许整数或实数作为值的属性实际上将值限制在某个范围内，通常是非负值。

所以规范不限制范围。我猜想**2^31 - 1**（有符号的 32 位整数）是大多数实现的限制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:55:39.853

对象的 zIndex 可以像您希望的那样高（显然遵守有符号的 int 限制）。但是，如果您想检查页面上是否有任何其他对象高于您将动态设置的对象，您可以检查[一下](http://www.bytemycode.com/snippets/snippet/322/)。

# sql-server - 奇怪的 SQL Server 权限问题

> ID：654348
> 
> 赞同：0
> 
> 时间：2009-03-17T13:52:23.340
> 
> 标签：sql-server, permissions

我们有一个使用 SQL Server 2005 数据库的系统，其中包含许多视图，这些视图每天自动运行，并将结果集通过电子邮件发送给客户端。

我对这个系统了解不多，因为我的一个同事会照顾它，但显然它运行良好。我们最近更改了安装 SQL 的服务器上的管理员密码。从那时起，显然一些观点已经停止工作。我的同事说他通过删除视图并重新创建它们来解决问题。

就我而言，服务器管理员密码应该与视图无关，因为运行它们的应用程序正在使用带有自己登录名的 SQL 身份验证。

有什么想法可能导致这种情况吗？所有视图似乎都在 DBO 模式中，并且不绑定到任何特定的用户帐户。我不相信它与服务器管理员登录密码更改有任何关系，但只是想听听您的想法。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T17:38:58.460

这些意见应该继续有效。也许您在进程的某处硬编码了 sa 密码。

# php - 距离 XYZ 日期还有多少天？

> ID：654363
> 
> 赞同：29
> 
> 时间：2009-03-17T13:56:01.083
> 
> 标签：php, datetime

我正在尝试构建一个倒计时小部件。

给定某个日期，PHP 中确定距离该日期还有多少天的最简单方法是什么？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-03-17T13:58:47.007

```
 <?php
         $cdate = mktime(0, 0, 0, 12, 31, 2009);
         $today = time();
         $difference = $cdate - $today;
         if ($difference < 0) { $difference = 0; }
         echo floor($difference/60/60/24)." days remaining";
       ?> 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2012-01-10T17:25:16.260

扩展 schnaader 的答案，这是一个单行函数，它以日期字符串作为参数，但只返回天数：

```
<?php
function days_until($date){
    return (isset($date)) ? floor((strtotime($date) - time())/60/60/24) : FALSE;
}
?> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-17T15:07:14.673

不要将日期视为整数。使用您的数据库，它对处理日历/时间有很好的支持。

```
select datediff("2009-11-12", now()) 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-17T15:12:56.093

PHP 5.3 引入了实现 'diff' 函数的 DateTime 类。见[http://www.php.net/manual/en/datetime.diff.php](http://www.php.net/manual/en/datetime.diff.php)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-08-23T12:34:11.140

天分秒格式：

```
// current time
$today = new DateTime(format_date(time(), 'custom', 'd M Y H:i:s'));
// date to which we want to compare (A Drupal field in my case).
$appt  = new DateTime(format_date($yourdate_is_timestamp, 'custom', 'd M Y H:i:s' ));

// Months
$months_until_appt = $appt->diff($today)-> m;
// days
$days_until_appt = $appt->diff($today)-> days;
// hours
$hours_until_appt = $appt->diff($today)-> h;
// minutes
$minutes_until_appt = $appt->diff($today)-> i;
// seconds
$seconds_until_appt = $appt->diff($today)-> s;

echo 'days until: ' . $days_until_appt;
echo 'hours until: ' . $hours_until_appt;
echo 'minutes until: ' . $minutes_until_appt;
echo 'seconds until: ' . $seconds_until_appt; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-03-30T11:51:32.260

我刚刚在我的实时应用程序代码中遇到了这个问题，系统错误地将今天和明天视为今天。我们刚刚进入英国夏令时，这导致我们的应用出现问题。

*我现在正在使用以下内容，这给了我正确的结果：*

```
function days_away_to($dt) {
    $mkt_diff   = strtotime($dt) - time();
    return floor( $mkt_diff/60/60/24 ) + 1; # 0 = today, -1 = yesterday, 1 = tomorrow
} 
```

当然，使用 DateTime 类是最好的解决方案......

# wpf - 在 WPF 中，是否可以为单个事件触发器指定多个路由事件？

> ID：654368
> 
> 赞同：3
> 
> 时间：2009-03-17T13:56:45.217
> 
> 标签：wpf, xaml, routed-events, event-triggers

我有一个事件触发器，我想触发它​​以响应两个不同的路由事件。我不想重复事件响应代码（在 XAML 中）两次。我可以为单个事件触发器声明指定多个路由事件吗？

单个事件的示例：

```
<Style.Triggers>
    <EventTrigger RoutedEvent="Button.MouseEnter">
        <--XAML MAGIC-->
        ... 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T14:18:11.530

抱歉... WPF 的 EventTrigger 实现只允许一个路由事件。

通常，您将从路由事件触发情节提要。我建议以下妥协：

```
<!--Define a storyboard as a resource-->
<Storyboard x:Key="MyStoryboard1">
   <!--Many properties and etc...-->
</Storyboard>

<Style.Triggers>
   <EventTrigger RoutedEvent="Button.MouseEnter">
      <BeginStoryboard Storyboard="{StaticResource MyStoryboard1}">
         <!--Other properties/name if necessary-->
      </BeginStoryboard>
   </EventTrigger>
   <EventTrigger RoutedEvent="Button.MouseDown">
      <BeginStoryboard Storyboard="{StaticResource MyStoryboard1}">
         <!--Other properties/name if necessary-->
      </BeginStoryboard>
   </EventTrigger>
</Style.Triggers> 
```

这个概念是通过共享资源来减少重复代码。

希望这可以帮助！

# django - 在 clean() 期间修改 Django 表单字段的值

> ID：654380
> 
> 赞同：28
> 
> 时间：2009-03-17T13:58:52.560
> 
> 标签：django, django-forms

我正在向我的 Django 应用程序中的表单和自定义字段添加自定义验证。我希望能够在触发错误时修改字段的值。例如，如果出现错误，应重新显示表单，并使用 clean() 更正的字段值和错误消息“数据已在下面更正。再次单击保存以确认这些更改是否正常”

我试过像这样在cleaned_data []中返回修改后的数据，但它不起作用。它正确显示错误，但当重新显示表单时，字段值不会更新为更正的 HTML。

```
class T34AtividadeForm(ModelForm):
    def clean(self):
        # Return cleaned html
        error,html = fix_imgs(cleaned_data.get("a34_descricao"))
        if error:
            msg = u'Data has been corrected below. Click save again to confirm if these changes are OK';
            self._errors['a34_descricao'] = ErrorList([msg])
            # This doesn't work
            cleaned_data["a34_descricao"] = html
            # This doesn't work either
            self.a34_descricao = html

    return cleaned_data 
```

我也想对字段做同样的事情，但由于错误是由异常触发的，我没有机会返回更正的值。与表单 clean() 方法一样，错误显示正确，但值没有更新。

```
class HTMLField(CharField):
    widget = HTMLTextarea

    def clean(self, value):
        value = super(HTMLField,self).clean(value)
        error,html = fix_imgs(value)
        if error:
            # This doesn't work
            self.value = html
            raise forms.ValidationError(u'Data has been corrected below. Click save again to confirm if these changes are OK.')
        return html 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2018-12-25T19:44:18.737

`clean()`如果您更新`self.data`表单的属性，则可以修改字段的值。`self.data`是[QueryDict](https://docs.djangoproject.com/en/2.1/ref/request-response/#querydict-objects)类的一个实例。默认情况下，querydicts 是不可变的。要使它们可变，您应该使用`.copy()`方法。从文档中：

> request.POST 和 request.GET 的 QueryDict 在正常的请求/响应周期中访问时将是不可变的。要获得可变版本，您需要使用 QueryDict.copy()

```
self.data = self.data.copy()
self.data['your_field'] = 'new value' 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T14:11:49.097

在 clean 方法中更改 self 数据以更改显示的值

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-11-24T20:22:21.133

在 clean() 中更新值的方法是更新表单数据字典中的值：

```
self.data["a34_stuff"] = "html" 
```

这肯定有效。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-11-02T14:24:43.520

我们不能重新编辑`request.data` ，因为它是**不可变的 dict**。你需要复制它，做你的东西并返回它。

但是在不同的解决方案之后，我发现了这种方式*（在 Django 2.2.6 中测试）*

```
class MyForm(ModelForm):

    def clean(self):
        cleaned_data = super(MyForm, self).clean()
        self.instance.field = 'value'
        return cleaned_data 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-03-17T15:11:35.833

我正在为另一个清理函数中的特定字段设置一个值，但它不起作用，因为它被主清理函数覆盖。为了设置值并保留它：

*   没有工作。

```
 def clean_tipo_cupon(self):
        tipo_cupon = self.cleaned_data['tipo_cupon']
        qscu = mdlcat.TipoCuponVenta.objects.filter(
            id=tipo_cupon, estado_id=1,
        )
        if not qscu.exists():
            wmessage = u'introducido no paso validación'
            raise forms.ValidationError(wmessage)

        qscu = qscu.first()
        if not qscu.default_owner is None:
            self.cleaned_data['default_owner'] = qscu.default_owner.id

        return tipo_cupon 
```

*   在这里，它就像一个魅力。

```
 def clean(self):
        cleaned_data = super().clean()
        for item in self.fields.keys():
            if isinstance(cleaned_data.get(item), str):
                cleaned_data[item] = cleaned_data.get(item).upper()

        # if a default owner is configured by coupon type
        # it will be assigned
        tipo_cupon = cleaned_data['tipo_cupon']
        qscu = mdlcat.TipoCuponVenta.objects.filter(
            id=tipo_cupon, estado_id=1,
        )
        qscu = qscu.first()
        if not qscu.default_owner is None:
            self.cleaned_data['default_owner'] = qscu.default_owner.id

        return cleaned_data 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-21T10:57:44.220

这是我尝试并为我工作的方式：

```
 inst = my_form.save(commit=False)
 if not inst.a34_stuff: # or incorrect
     inst.data["a34_stuff"] = "corrected" 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-03-18T18:30:18.850

如果您的表单是模型表单，则更好的方法是获取实例并更正该数据：

```
inst = my_form.save(commit=False)
if inst.a34_stuff is None: #or incorrect
    inst.a34_stuff = "corrected"
    request.user.message_set.create(message = "Error corrected")
    return HttpResponseRedirect(reverse('your_url_name',
            args=[]) 
```

PS：我不确定这是否真的有效......不确定表格是否会改变。

# c# - 在 C# 代码中使用块有什么意义？

> ID：654381
> 
> 赞同：0
> 
> 时间：2009-03-17T13:59:07.503
> 
> 标签：c#, using-statement

我看到大量具有以下语法的代码片段

```
using (RandomType variable = new RandomType(1,2,3))
{
   // A bunch of code here.

} 
```

为什么不直接声明变量并使用它呢？

这种 Using 语法似乎只会使代码混乱并使其可读性降低。如果它是如此重要以至于该变量仅在该范围内可用，为什么不将该块放在一个函数中呢？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-17T14:01:45.347

使用有一个非常明确的目的。

它设计用于实现 IDisposable 的类型。

在您的情况下，如果 RandomType 实现 IDisposable，它将在块的末尾获得 .Dispose()'d。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-17T14:01:26.033

```
using (RandomType variable = new RandomType(1,2,3))
{
   // A bunch of code here.
} 
```

与以下内容几乎相同（有一些细微差别）：

```
RandomType variable = new RandomType(1,2,3);

try
{
    // A bunch of code
}
finally
{
    if(variable != null)
        variable.Dispose()
} 
```

请注意，在调用“Using”时，您可以将任何内容转换为 IDisposable：

```
using(RandomType as IDisposable) 
```

finally 中的 null 检查将捕获实际上未实现 IDisposable 的任何内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T14:02:34.517

不，它不会弄乱你的代码，或者降低它的可读性。

using 语句只能用于 IDisposable 类型（即实现 IDisposable 的类型）。

通过在 using-block 中使用该类型，该类型的 Dispose 方法将在 using-block 的范围结束时使用。

所以，告诉我哪些代码对你来说可读性较差：

```
using( SomeType t = new SomeType() )
{
   // do some stuff
} 
```

或者

```
SomeType t = new SomeType();

try
{
   // do some stuff
}
finally
{
   if( t != null ) 
   {
      t.Dispose();
   }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T14:02:15.593

在 using 语句中使用的对象必须实现 IDisposable，因此在范围结束时，您可以保证 Dispose() 将被调用，因此理论上，您的对象应该在此时释放。在某些情况下，我发现它使我的代码更清晰。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T14:03:54.247

using 关键字提供了一种确定性方式来清理对象分配的托管或非托管资源。如果您不使用 using 关键字，则您有责任在完成该对象后调用 Dispose()（或在某些情况下为 Close()）。否则，资源可能直到下一次垃圾回收才会被清理，甚至根本不会被清理。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T14:07:53.443

根据[MSDN](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)，以下`using`代码：

```
using (Font font1 = new Font("Arial", 10.0f)) 
{
    byte charset = font1.GdiCharSet;
} 
```

扩展为：

```
{
  Font font1 = new Font("Arial", 10.0f);
  try
  {
    byte charset = font1.GdiCharSet;
  }
  finally
  {
    if (font1 != null)
      ((IDisposable)font1).Dispose();
  }
} 
```

它确实不会使您的代码混乱。其实恰恰相反！

# xml - 在 Haskell 中，如何从 XML 文档中提取字符串？

> ID：654384
> 
> 赞同：7
> 
> 时间：2009-03-17T13:59:43.073
> 
> 标签：xml, haskell

如果我有这样的 XML 文档：

```
<root>
  <elem name="Greeting">
    Hello
  </elem>
  <elem name="Name">
    Name
  </elem>
</root> 
```

和一些像这样的 Haskell 类型/数据定义：

```
 type Name = String
 type Value = String
 data LocalizedString = LS Name Value 
```

我想编写一个具有以下签名的 Haskell 函数：

```
 getLocalizedStrings :: String -> [LocalizedString] 
```

其中第一个参数是 XML 文本，返回值为：

```
 [LS "Greeting" "Hello", LS "Name" "Name"] 
```

我该怎么做？

如果 HaXml 是最好的工具，我将如何使用 HaXml 来实现上述目标？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T15:34:28.803

我从来没有真正费心弄清楚如何使用[HaXML](http://www.cs.york.ac.uk/fp/HaXml/)从 XML 文档中提取位；[HXT](http://www.fh-wedel.de/~si/HXmlToolbox/)满足了我的所有需求。

```
{-# LANGUAGE Arrows #-}
import Data.Maybe
import Text.XML.HXT.Arrow

type Name = String
type Value = String
data LocalizedString = LS Name Value

getLocalizedStrings :: String -> Maybe [LocalizedString]
getLocalizedStrings = (.) listToMaybe . runLA $ xread >>> getRoot

atTag :: ArrowXml a => String -> a XmlTree XmlTree
atTag tag = deep $ isElem >>> hasName tag

getRoot :: ArrowXml a => a XmlTree [LocalizedString]
getRoot = atTag "root" >>> listA getElem

getElem :: ArrowXml a => a XmlTree LocalizedString
getElem = atTag "elem" >>> proc x -> do
    name <- getAttrValue "name" -< x
    value <- getChildren >>> getText -< x
    returnA -< LS name value 
```

您可能想要更多的错误检查（即不要`atTag`像我一样懒惰地使用；实际上验证它`<root>`是根，`<elem>`是直接后代等），但这在您的示例中工作得很好。

* * *

现在，如果您需要介绍[Arrow](http://haskell.org/haskellwiki/Arrow) s，不幸的是我不知道有什么好的。我自己学会了“扔进海里学游泳”的方式。

需要记住的一点是`proc`/`-<`语法只是基本箭头操作（`arr`,`>>>`等）的糖，就像`do`/`<-`只是基本单子操作（`return`,`>>=`等）的糖一样。以下是等价的：

```
getAttrValue "name" &&& (getChildren >>> getText) >>^ uncurry LS

proc x -> do
    name <- getAttrValue "name" -< x
    value <- getChildren >>> getText -< x
    returnA -< LS name value 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T20:38:39.820

使用 XML 包之一。

最受欢迎的是，按顺序，

1.  haxml
2.  hxt
3.  xml-light
4.  六边形

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T23:53:35.917

FWIW，HXT 似乎有点矫枉过正，一个简单的 TagSoup 就可以了 :)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T14:06:25.490

这是我对 TagSoup 的**第二次**尝试（在收到其他人的一些好的意见后）：

```
module Xml where

import Data.Char
import Text.HTML.TagSoup

type SName = String
type SValue = String

data LocalizedString = LS SName SValue
     deriving Show

getLocalizedStrings :: String -> [LocalizedString]
getLocalizedStrings = create . filterTags . parseTags
  where 
    filterTags :: [Tag] -> [Tag]
    filterTags = filter (\x -> isTagOpenName "elem" x || isTagText x)

    create :: [Tag] -> [LocalizedString]
    create (TagOpen "elem" [("name", name)] : TagText text : rest) = 
      LS name (trimWhiteSpace text) : create rest
    create (_:rest) = create rest
    create [] = []               

trimWhiteSpace :: String -> String
trimWhiteSpace = dropWhile isSpace . reverse . dropWhile isSpace . reverse

main = do
  xml <- readFile "xml.xml"  -- xml.xml contains the xml in the original question.
  putStrLn . show . getLocalizedStrings $ xml 
```

第一次尝试展示了一种从字符串中修剪空白的幼稚（和错误）方法。

# c# - 显示给定行执行次数的 C++ 报告工具

> ID：654389
> 
> 赞同：1
> 
> 时间：2009-03-17T14:00:34.677
> 
> 标签：c#, java, c++, code-coverage

我想知道 C++ 中是否有一个工具可以为您提供报告，其中显示以下内容：

1.  整个项目的源代码。通常每个源文件一个 HTML 页面。
2.  除了源代码之外，还有行号，当然是为了便于阅读。
3.  对于每一行，在行号的左侧，都会显示该行执行次数的值。

当然，您需要执行一个脚本来运行单元测试并从那里生成报告。

如果您熟悉 Java 的代码覆盖工具 Cobertura 和 C# 的 NCover，这是它的重要特性之一。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T14:02:21.303

查看[C 和 C++ 的代码覆盖工具列表](http://www.codecoveragetools.com/index.php/coverage-process/code-coverage-tools-c.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T04:05:24.557

当您使用 gcc 作为编译器时，您可以生成 gcov 输出。使用[gcov](http://gcc.gnu.org/onlinedocs/gcc/Gcov.html)创建生成分析输出的可执行文件，然后使用[lcov](http://ltp.sourceforge.net/coverage/lcov.php)为您的代码生成漂亮的 HTML 输出。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-06T22:08:36.520

请参阅[SD 探查器](http://www.semanticdesigns.com/Products/Profilers/CppProfiler.html)。它会按照您的喜好生成输出，但作为 GUI 而不是 HTML。

# wpf - 如何在 Intranet 上运行完全信任 XBAP？

> ID：654392
> 
> 赞同：2
> 
> 时间：2009-03-17T14:01:28.217
> 
> 标签：wpf, xbap, full-trust

我制作了一个托管旧 WinForms 控件的 WPF 浏览器应用程序（我还没有完全迁移到 WPF）。使用 WindowsFormsHost 意味着我的浏览器应用程序需要完全信任才能运行。这对我来说不是问题，因为这个应用程序只打算在我公司的 Intranet 上运行。但是，在我将 xbap 部署到网络共享后，它拒绝运行，并显示“未授予信任”。

我可以使用哪些方法向存储在我公司 Intranet 上的 XBAP 应用程序授予完全信任？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T16:55:59.247

到目前为止，我已经找到了两种方法来做到这一点。[通过在目标机器上安装证书的](http://blogs.microsoft.co.il/blogs/maxim/archive/2008/03/05/wpf-xbap-as-full-trust-application.aspx)一种非常复杂的方法。

[或者通过更简单的方法，这里](http://bombayboy.wordpress.com/2006/08/30/wpf-browser-hosted-applications-xbap-aptcafriend-assembly/)只适合内网：

> 部署修改给定区域的默认权限集的自定义 CLR 安全策略

所以我就这么做了，而且效果很好。这是我如何让它工作的详细步骤：

1.  打开控制面板 > 管理工具 > .NET Framework 2.0 配置
2.  展开运行时安全策略 > 机器 > 代码组 > All_Code
3.  右键单击 All_Code，然后单击新建…</li>
4.  创建一个新的代码组，我将我的命名为 MyProject_FullTrust_Zone
5.  选择 URL 条件类型并指定将部署应用程序的网络路径。
6.  选择使用现有权限集，并将其设置为完全信任。

现在这种方法的唯一问题是我必须将此更改部署到数百台机器上。所以也许还有更简单的方法可以做到这一点？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-02T20:37:12.923

计划在 2010 年上半年发布的[.Net 4.0](http://blogs.msdn.com/llobo/archive/2009/11/06/new-wpf-features-full-trust-xbap-deployment.aspx)将成为可能。它现在处于测试阶段，但它附带一个[上线许可证](http://blogs.msdn.com/jeffbe/archive/2009/10/19/going-live-with-visual-studio-2010-beta-2.aspx)，即使使用测试版.Net 框架。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T16:40:23.327

虽然我还没有尝试过，但是否将 XBAP 的路径添加为受信任的站点？

# gdb - 使用 GDB 检查映射地址

> ID：654393
> 
> 赞同：17
> 
> 时间：2009-03-17T14:01:32.100
> 
> 标签：gdb, mmap

我正在使用我[在 Linux 的 Direct Memory Access 上](https://stackoverflow.com/questions/647783/direct-memory-access-in-linux/)发布的驱动程序将一些物理内存映射到用户空间地址。但是，我不能使用 GDB 查看任何地址；即，x 0x12345678（其中 0x12345678 是 mmap 的返回值）失败并出现错误“无法访问地址 0x12345678 处的内存”。

有没有办法告诉GDB这个内存可以查看？或者，我可以在 mmap 中做一些不同的事情（调用或 foo_mmap 那里的实现）允许它访问这个内存吗？

请注意，我不是在询问 /dev/mem（如第一个片段中那样），而是询问通过 ioremap()、virt_to_phys() 和 remap_pfn_range() 获取的内存的 mmap

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-23T10:55:06.883

我相信 Linux 不会通过 ptrace() 访问 I/O 内存。您可以编写一个简单地读取 mmap 的地址并让 gdb 调用它的函数。这是您的 foo-user.c 程序的略微修改版本以及 gdb 会话的输出。

```
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>
#include <sys/mman.h>

char *mptr;

char peek(int offset)
{
    return mptr[offset];
}

int main(void)
{
    int fd;
    fd = open("/dev/foo", O_RDWR | O_SYNC);
    if (fd == -1) {
        printf("open error...\n");
        return 1;
    }
    mptr = mmap(0, 1 * 1024 * 1024, PROT_READ | PROT_WRITE,
             MAP_FILE | MAP_SHARED, fd, 4096);
    printf("On start, mptr points to 0x%lX.\n", (unsigned long) mptr);
    printf("mptr points to 0x%lX. *mptr = 0x%X\n", (unsigned long) mptr,
           *mptr);
    mptr[0] = 'a';
    mptr[1] = 'b';
    printf("mptr points to 0x%lX. *mptr = 0x%X\n", (unsigned long) mptr,
           *mptr);
    close(fd);
    return 0;
}

$ make foo-user CFLAGS=-g
$ gdb -q foo-user
(gdb) break 27
Breakpoint 1 at 0x804855f: file foo-user.c, line 27.
(gdb) run
Starting program: /home/me/foo/foo-user 
On start, mptr points to 0xB7E1E000.
mptr points to 0xB7E1E000\. *mptr = 0x61

Breakpoint 1, main () at foo-user.c:27
27          mptr[0] = 'a';
(gdb) n
28          mptr[1] = 'b';
(gdb) print peek(0)
$1 = 97 'a'
(gdb) print peek(1)
$2 = 98 'b' 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-09-26T17:30:05.160

我有你的难题的答案:) 我在没有太多帮助的情况下在网上到处搜索，最后自己调试了它。

这篇文章对我来说是一个很好的起点。我想以类似的方式实现某些目标，我已经使用 MMAP 实现了一个 char 驱动程序，以将我的自定义托管内存映射到用户空间进程。使用 GDB 时，ptrace PEEK 调用 access_process_vm() 来访问 VMA 中的任何内存。这会导致 EIO 错误，因为通用访问无法获取内存的 PA。事实证明，您必须通过实现 VMA 的 vm_operations_struct 的 .access 来实现该内存的访问功能。下面是一个例子：

```
//Below code needs to be implemented by your driver:
static struct vm_operations_struct custom_vm_ops = {
    .access = custom_vma_access,
};

static inline int custom_vma_access(struct vm_area_struct *vma, unsigned long addr,
          void *buf, int len, int write)
{
    return custom_generic_access_phys(vma, addr, buf, len, write);
}

static int custom_generic_access_phys(struct vm_area_struct *vma, unsigned long addr,
            void *buf, int len, int write)
{
    void __iomem *maddr;
    //int offset = (addr & (PAGE_SIZE-1)) - vma->vm_start;
    int offset = (addr) - vma->vm_start;

    maddr = phys_to_virt(__pa(custom_mem_VA));
    if (write)
        memcpy_toio(maddr + offset, buf, len);
    else
        memcpy_fromio(buf, maddr + offset, len);

    return len;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-06-01T19:14:11.727

要访问 mmapped 内存，GDB 将调用 ptrace，然后调用 __access_remote_vm() 来访问 mmapped 内存。如果内存映射有 VMIO 等标志 | VM_PFNMAP（例如，remap_pfn_range() 设置它们），GDB 将通过用户定义的 vm 访问方法访问内存。

内核没有为 access() 编写我们自己的实现，而是提供了一个名为 generic_access_phys() 的通用版本，并且该方法可以像 /dev/mem 设备那样通过 vm_operations_struct 轻松链接：

```
static const struct vm_operations_struct mmap_mem_ops = {
        .access = generic_access_phys };

int mmap_mem()
{
    .... ....
    vma->vm_ops = &mmap_mem_ops;
    .... ....
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-22T15:58:07.490

据我了解，GDB 将使用[ptrace](http://www.rt.com/man/ptrace.2.html)在您的进程内存中四处寻找。也许您应该编写一个简单的程序，该程序仅附加到您的进程并用于`ptrace`从该内存中读取。这可能有助于缩小潜在问题的范围。如果这没有问题，那么您知道我错了:)，或者 GDB 正在发生其他可疑的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-14T03:11:48.707

你去“信息文件”

```
(gdb) help info files
Names of targets and files being debugged.
Shows the entire stack of targets currently in use (including the exec-file,
core-file, and process, if any), as well as the symbol file name.
(gdb) info files
Symbols from "/bin/ls".
Unix child process:
        Using the running image of child Thread 4160418656 (LWP 10729).
        While running this, GDB does not access memory from...
Local exec file:
        `/bin/ls', file type elf32-powerpc.
        Entry point: 0x10002a10
        0x10000134 - 0x10000141 is .interp
        0x10000144 - 0x10000164 is .note.ABI-tag
        0x10000164 - 0x100008f8 is .gnu.hash
        0x100008f8 - 0x10001728 is .dynsym
        0x10001728 - 0x100021f3 is .dynstr
        0x100021f4 - 0x100023ba is .gnu.version
...
        0x0ffa8300 - 0x0ffad8c0 is .text in /lib/libacl.so.1
        0x0ffad8c0 - 0x0ffad8f8 is .fini in /lib/libacl.so.1
        0x0ffad8f8 - 0x0ffadbac is .rodata in /lib/libacl.so.1
        0x0ffadbac - 0x0ffadd58 is .eh_frame_hdr in /lib/libacl.so.1
        0x0ffadd58 - 0x0ffae4d8 is .eh_frame in /lib/libacl.so.1
        0x0ffbe4d8 - 0x0ffbe4e0 is .ctors in /lib/libacl.so.1
        0x0ffbe4e0 - 0x0ffbe4e8 is .dtors in /lib/libacl.so.1
...

(gdb) info sh
From        To          Syms Read   Shared Object Library
0xf7fcf960  0xf7fe81a0  Yes         /lib/ld.so.1
0x0ffd0820  0x0ffd5d10  Yes         /lib/librt.so.1
0x0ffa8300  0x0ffad8c0  Yes         /lib/libacl.so.1
0x0ff6a840  0x0ff7f4f0  Yes         /lib/libselinux.so.1
0x0fdfe920  0x0ff1ae70  Yes         /lib/libc.so.6
0x0fda23d0  0x0fdb0db0  Yes         /lib/libpthread.so.0 
```

如果做不到这一点，您可以使用“mem”来配置内存范围。

```
(gdb) mem 1 1414
(gdb) info mem
Num Enb Low Addr   High Addr  Attrs
1   y   0x00000001 0x00000586 rw nocache
(gdb) disable mem 1
(gdb) info mem
Num Enb Low Addr   High Addr  Attrs
1   n   0x00000001 0x00000586 rw nocache 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T15:50:58.593

我认为如果 GDB 无法访问该内存，则它不会映射到您的进程地址空间，因此您会得到“无法访问地址 0x12345678 的内存”。如果该应用程序正常运行，您将遇到分段错误。此外，也许你的驱动程序被搞砸了，你应该检查你是否真的可以从内核中访问内存。试试这里的例子：

```
#include <cstdio>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/mman.h>

int main() {
    int fd = open("/dev/zero", O_RDONLY);
    void* addr = mmap(NULL, 1024, PROT_READ, MAP_PRIVATE, fd, 0);
    for (int x = 0; x < 10; x++) {
        printf("%X\n", ((char*)addr)[x]);
    }
    close(fd);
    return 0;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-07T08:19:25.100

如果您打开一个 AF_PACKET 套接字并对其进行映射，gdb 将无法访问此内存。所以你的驱动没有问题。要么是 ptrace 的问题，要么是 gdb 的问题。

# osgi - OSGi r4.1 中的 ServiceTracker

> ID：654400
> 
> 赞同：0
> 
> 时间：2009-03-17T14:02:42.863
> 
> 标签：osgi, apache-felix

我正在使用`org.osgi.util.tracker.ServiceTracker`（PrintableServiceTracker 实现 ServiceTrackerCustomizer 并在添加新服务时简单地打印）。

```
Filter filter = bc.createFilter("(objectClass=se.enea.print.Printable)");
            tracker = new ServiceTracker(bc, filter, new PrintableServiceTracker(bc)); 
```

我在新的电子书“ [OSGi in action](http://manning.com/hall/) ”中读到了“伪注册”，我想知道我是否必须明确地进行伪注册，或者框架是否会自动处理？

（ServiceTracker 是否会捕获已安装的 Printable 服务。是否会为每个预安装的 Printable 服务调用 ServiceTracker.addingService(ServiceReference)）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T14:23:36.353

不确定伪注册是什么意思，但 PrintableServiceTracker 中的方法 addedService 不仅会为新服务调用，还会为现有服务调用。

# c# - 确定收集对象的初始容量的最佳方法是什么？

> ID：654408
> 
> 赞同：0
> 
> 时间：2009-03-17T14:05:52.620
> 
> 标签：c#, collections

使用具有容量的对象时，您可以使用哪些准则来确保使用集合时的最佳效率？.NET 框架似乎也将其中一些容量设置得很低。例如，我认为StringBuilder的初始容量为16。这是否意味着在将16个字符串插入StringBuilder之后，StringBuilder对象被重新分配并且大小增加了一倍？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T14:10:16.823

如果您预先知道集合或 StringBuilder 的大小，最好将其作为容量传递给构造函数。这样，只会发生一次分配。如果您不知道确切的数字，即使是近似值也会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T14:10:00.647

有了`StringBuilder`，它不是*字符串*的数量，而是*字符*的数量。一般来说; 如果您可以预测长度，请继续告诉它-但是由于它使用加倍，因此如果您需要使用等，偶尔重新分配不会产生*巨大的开销。*`Add`

在大多数情况下，差异将是微不足道的和微优化。不告诉它大小的最大问题是，除非集合具有“修剪”方法，否则您的大小可能几乎是您真正需要的大小的两倍（如果您很不幸的话）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T14:13:29.577

只有两种情况我会明确设置集合的容量

1.  我知道将出现在集合中的项目的确切数量，并且我使用的是 Array 或 List<T>。
2.  我正在调用一个写入 char[] 的函数，并且我正在使用 StringBuilder 与参数进行互操作。在这种情况下，您必须为 CLR 设置容量以编组为本机代码。

有趣的是，对于#1，它几乎总是在我将从 COM 接口返回的数据复制到 BCL 集合类时完成。所以我想你可以说我只在互操作场景中这样做:)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T14:54:34.437

说到`StringBuilder`，我敢用最坏情况下的尺寸。`StringBuilder`需要连续的内存块，这很难在高度碎片化的堆上分配。

不过，我会估计其他系列。

# cocoa - 计算可可的时差

> ID：654412
> 
> 赞同：13
> 
> 时间：2009-03-17T14:06:25.443
> 
> 标签：cocoa, time, nsdate, nstimeinterval

我有两个格式的时间值：%H%M%S (EG161500)

这些值是基于文本的整数。

Cocoa 中是否有一个简单的函数可以使用 60 秒和分钟的刻度来计算这两个整数之间的差异？

因此，如果

```
time 1 = 161500
time 2 = 171500

timedifference = 003000 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-17T22:35:31.140

```
NSDateFormatter *dateFormatter = [[[NSDateFormatter alloc] init] autorelease];
[dateFormatter setDateFormat:@"HHmmss"];

NSDate *date1 = [dateFormatter dateFromString:@"161500"];
NSDate *date2 = [dateFormatter dateFromString:@"171500"];

NSTimeInterval diff = [date2 timeIntervalSinceDate:date1]; // diff = 3600.0 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-17T14:12:52.790

操作日期的类是`NSDate`. 获取时间间隔的方法是`-timeIntervalSinceDate:`。结果是一个`NSTimeInterval`值，它`double`表示以秒为单位的时间间隔。

您可以从with创建一个`NSDate`对象，前提是您的日期格式为*2001-03-24 10:45:32 +0600*。`NSString``+dateWithString:`

 ** * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-05-23T12:56:57.797

试试这个代码。

```
- (NSTimeInterval)intervalBetweenDate:(NSDate *)dt1 andDate:(NSDate *)dt2 {

NSTimeInterval interval = [dt2 timeIntervalSinceDate:dt1];
NSLog(@"%f",interval);
return interval; 
```

}

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T15:02:30.893

我将创建一个 NSFormatter 子类来从输入数据中解析该格式的时间值（您可以将一个放在文本字段上以自动转换用户输入，或使用它从代码中的数据源解析）。让它返回组合的秒数作为包裹在 NSNumber 中的 NSTimeInterval（双表示秒）。从那里很容易减去差异，并使用您创建的相同 NSFormatter 类显示它。在解析和显示值时，您是负责编写从秒转换为小时：分钟：秒或您喜欢的任何格式的代码的人。如果对您的应用程序有意义，您还可以将这些值转换为像 mouviciel 提到的 NSDate。请记住，您将始终存储与参考日期的时差，

# dotnetnuke - 页面中缺少 DotNetNuke 模块

> ID：654413
> 
> 赞同：2
> 
> 时间：2009-03-17T14:06:41.620
> 
> 标签：dotnetnuke, dotnetnuke-module

我一直在为 nuke 4.8.4 站点开发的 nuke 模块有一个奇怪的问题。

我有一个模块只是拒绝允许将另一个模块放置在同一窗格中的下方。只要它是窗格中的最后一个模块，一切都可以正常加载，但是如果将其移动到其他模块上方，则其他模块将不会加载。

我最初认为模块的标记有些奇怪，导致它覆盖其他模块 - 但是当我在页面上查看源代码时，源代码中甚至不存在其他模块。

以前有没有人见过这个问题，如果有，你是如何解决这个问题的？

编辑：我们已经构建了十几个模块 - 一个模块在我的机器上执行此操作，但一个不同的模块在另一位开发人员的机器上执行此操作。在每台机器上，为一个开发者损坏的模块对另一个开发者来说工作正常。

我们注意到的另一件有趣的事情是，如果这些模块中的一个在页面上，GetTabModules 将为一个模块返回 2 行，它们都具有相同的 ModuleID。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-09-15T05:01:18.000

这有时会发生在我们身上，尤其是在较旧的站点上，尤其是在历史悠久的情况下，可能是回收箱中装满了旧的/已删除的模块。似乎我们一直在尝试将模块向上或向上移动，并且与其他模块相比它不会移动。

问题很容易看出，如果你查看数据库并且可以看到所涉及的 Module_Tab 记录与页面上的其他模块具有相同的排序顺序号，或者它具有空值并在 NULL 上添加 +1 或 -1仍然返回 NULL ！

所以对我们来说，答案始终是执行以下步骤来清除您的问题（这可以在不访问数据库的情况下完成）：

1.  清空回收站，然后返回页面
2.  将所有模块移出它们所在的窗格......因此，如果它们都在内容窗格中，请将它们移到左侧或页脚窗格中。
3.  然后，按照您希望在页面上看到它们的顺序，将每一个添加回内容窗格，一次一个。

此过程使它们的排序顺序清晰/无关，然后将每个模块重新添加，开始一个从 1 到 2 的新排序号，等等，之后，所有模块将在正常的向上/向下移动操作下正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T14:21:17.980

听起来您的模块代码正在炸毁 DNN。我将在附加调试器的情况下运行该站点，并逐步执行实例化模块的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T14:51:50.437

我们卸载并重新安装了有问题的模块，它们现在工作正常。一定是安装过程中的某种错误。我将升级到 4.9.2，看看我们是否会遇到类似的问题。

# web-services - 如何将单体应用程序分解为 Web 服务？

> ID：654415
> 
> 赞同：2
> 
> 时间：2009-03-17T14:07:46.343
> 
> 标签：web-services

无论是从头开始，还是通过拆分现有应用程序，都没有处理太多创建 Web 服务的工作，从哪里开始呢？Web 服务应该封装一个实体，就像一个类一样，还是该服务应该有更多/更少？

我意识到这在很大程度上是基于对需求的逐案分析，但是是否有任何一般的指导方针或最佳实践，甚至是网络服务老手可以传授给相对新手的小块信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T14:18:17.553

我们的网络服务是围绕功能区域构建的。有时这只是针对单个实体，有时还不止于此。

例如，如果您有 CRM，您的其中一项 Web 服务可能围绕管理联系人展开。创建、更新、搜索等。如果您执行某种类型的批处理类型处理，则可能存在用于创建和提交作业的 Web 服务。

至于最佳实践，请记住 Web 服务会增加处理开销。主要是在数据通过网络时对数据进行序列化/反序列化。因此，主要优势仅在于可扩展性。这意味着您可以通过增加每笔交易处理时间来换取通过多台机器运行服务的能力。

引入 Web 服务的主要部分是跨多个应用程序共有的区域，或者您打算公开公开的区域，或者将受益于更大的负载平衡的区域。

当然，您需要分析您的应用程序以查看真正的瓶颈在哪里。在某些情况下，它没有意义。例如，如果您有一个不共享其代码的应用程序和/或瓶颈主要与数据库相关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T14:14:02.727

Web 服务正是它们听起来像 Web 的服务。

应将 Web 服务构建为应用程序服务层的 API。

服务通常封装比单个类更大的实体。

要了解有关服务层和重构以添加服务层的更多信息，请阅读 DDD。

祝你好运

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T14:18:02.187

第一个问题是：您将应用程序功能重构为一组 Web 服务的目的是什么？

# c# - c# wcf - 在代理类上调用 open() 时抛出异常

> ID：654420
> 
> 赞同：3
> 
> 时间：2009-03-17T14:09:47.930
> 
> 标签：c#, wcf, exception

我有以下问题，基本上我有一个在小型测试中运行良好的 WCF 服务。但是，当我尝试进行批处理/负载测试`InvalidOperationException`时，当在代理类上调用 open() 方法时，我会收到一条消息：

> *“通信对象 System.ServiceModel.Channels.ServiceChannel 处于 Opened 状态时无法修改。”*

我搜索了谷歌，但找不到其他人真正引用此异常消息。

我想诊断可能需要有关服务的一些进一步信息 - 当服务通过其公开的方法之一接收数据时，它基本上执行一些处理并将数据路由到与数据关联的服务（不同的数据将导致不同的路由）。为了确保服务尽快运行，数据的接收、处理和路由的每个周期都由线程池中的单独线程处理。这可能是一个线程调用`proxyClass.Open()`而另一个线程已经在使用它而引起的问题吗？`lock`如果确实是这个问题，一个块会消除这个问题吗？

谢谢大家， - 我在这个项目上工作**了太久**，终于想看看它的背面 - 但这似乎是最后一个绊脚石，所以非常感谢任何帮助:-)

==================================================== =======================

感谢您强调我不应该使用`using`WCF 代理类的构造。然而，MSDN 文章并不是有史以来写得最清楚的文献，所以一个简单的问题：我应该使用这样的代理吗：

```
try
{
    client = new proxy.DataConnectorServiceClient();
    client.Open();
    //do work
    client.Close();
 }
 .................. //catch more specific exceptions
 catch(Exception e)
 {
    client.Abort();
 } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T14:23:10.893

你是如何使用代理的？为每个调用创建新的代理对象。添加一些关于如何使用代理的代码。

使用代理的理想方式是为每个调用创建新代理并在完成后处理它。您正在为错误的打开代理调用 proxy.open() 。它应该只调用一次。

尝试在 finally 中使用类似下面的东西，因为 wcf 不会处理失败的代理并且它会堆积起来。不确定它是否会有所帮助，但可以试一试。

```
if (proxy.State == CommunicationState.Faulted)
{
    proxy.Abort();
}
else
{
    try
    {
        proxy.Close();
    }
    catch
    {
        proxy.Abort();
    }
} 
```

为什么要这样做？ [http://msdn.microsoft.com/en-us/library/aa355056.aspx](http://msdn.microsoft.com/en-us/library/aa355056.aspx)

您在上面发布的代码会起作用，但您总是会吃异常。因此，在单独的捕获中处理与 wcf 相关的异常，并且您使用 Excelion 的通用捕获将中止然后抛出异常。

```
try
{
    ...
    client.Close();
}
catch (CommunicationException e)
{
    ...
    client.Abort();
}
catch (TimeoutException e)
{
    ...
    client.Abort();
}
catch (Exception e)
{
    ...
    client.Abort();
    throw;
} 
```

此外，如果您仍然想使用 using 语句的便利性，那么您可以覆盖代理中的 dispose 方法，并在 wcf 错误的情况下使用 abort 方法进行处理。

并且不需要调用 .Open() 因为它会在第一次调用时打开。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-13T21:21:38.910

我假设您使用的是 .NET 3.5 或更高版本。在 .NET 3.5 中，WCF ClientBase'1 类（生成的客户端代理的基类）已更新为使用缓存的 ChannelFactories/Channels。因此，除非您使用禁用缓存的客户端使用/创建策略之一（客户端构造函数接收 Binding 对象，或在创建支持通道之前访问某些属性之一），即使您正在创建一个新的客户端实例，它很可能仍在使用相同的通道。换句话说，在调用 .Open() 之前，请始终确保您正在检查 .Created 状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T14:15:12.287

听起来您确实在同一个对象上多次调用了 Open()。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-13T22:33:12.903

前段时间我们遇到了和你一样的障碍。

using 语句的问题在于，如果您进入错误状态，它仍会尝试在块结束时关闭。另一个对我们至关重要的考虑因素是每次创建代理的成本。

我们从这些博客文章中学到了很多：

[http://blogs.msdn.com/wenlong/archive/2007/10/26/best-practice-always-open-wcf-client-proxy-explicitly-when-it-is-shared.aspx](http://blogs.msdn.com/wenlong/archive/2007/10/26/best-practice-always-open-wcf-client-proxy-explicitly-when-it-is-shared.aspx)

和

[http://blogs.msdn.com/wenlong/archive/2007/10/27/performance-improvement-of-wcf-client-proxy-creation-and-best-practices.aspx](http://blogs.msdn.com/wenlong/archive/2007/10/27/performance-improvement-of-wcf-client-proxy-creation-and-best-practices.aspx)

希望它也会对您有所帮助。

干杯，瓦格纳。

# c# - 更新面板中的按钮正在执行完整的回发？

> ID：654423
> 
> 赞同：1
> 
> 时间：2009-03-17T14:11:01.110
> 
> 标签：c#, asp.net, ajax, iis

我正在关注如何从此处（[http://www.asp.net/Ajax/Documentation/Live/tutorials/IntroductionUpdatePanel.aspx](http://www.asp.net/Ajax/Documentation/Live/tutorials/IntroductionUpdatePanel.aspx)）使用更新面板的简单示例。在更新面板之外，我有另一个 html 输入控件，它调用一个 javascript 函数，该函数在警报框中向用户显示计数。简单的东西。我的问题是页面在 IIS 和内置的 asp.net Web 服务器（cassini）上运行时表现不同。在 IIS 下，单击更新面板中的按钮会导致完整的回发，因此每次在 js 函数中显示给用户的计数都会重置。在内置 Web 服务器下，点击更新面板内的按钮会表现出我期望它的行为方式以及我希望它的行为方式，因为它只刷新标签，这样客户端的计数器就不会被重置。

.net 3.5 是目标框架，我正在运行 IIS 5.1。

我在其他地方看到过描述相同问题的帖子（[http://forums.asp.net/t/1169282.aspx](http://forums.asp.net/t/1169282.aspx)）

```
<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Untitled Page</title>

    <script type="text/javascript">
    var count=0;
    function incrementCounter()
    {
        count ++;
        alert(count);
    }
    </script>
</head>
<body>
    <form id="form1" runat="server">
    <asp:ScriptManager ID="ScriptManager1" runat="server">
    </asp:ScriptManager>
    <asp:UpdatePanel ID="UpdatePanel1" runat="server">
        <ContentTemplate>
            <asp:Label ID="Label1" runat="server" Text="Panel Created"></asp:Label>
            <asp:Button ID="Button1" runat="server" Text="Button"     onclick="Button1_Click" />
        </ContentTemplate>
    </asp:UpdatePanel>

    <input type="button" id="Button2" value="JS Clicker" onclick="incrementCounter();" />
    </form>
</body>
</html> 
```

### 更新：

感谢 Crossbrowser 的回答。我的回复将在“添加评论”窗口中占据很大空间。好的，所以按照这个简单的例子（[http://www.asp.net/Ajax/Documentation/Live/tutorials/IntroductionUpdatePanel.aspx](http://www.asp.net/Ajax/Documentation/Live/tutorials/IntroductionUpdatePanel.aspx)）你可以看到更新模式没有设置为条件所以我已经反映了这些变化. 但是我的问题仍然存在。那就是在 IIS 上运行的页面会导致完整的回发。即浏览器中的进度条加载，屏幕闪烁，我维护的客户端计数丢失。在内置的 asp.net 网络服务器上运行代码不会。这就是我问题的症结所在。我遇到过其他人（[http://forums.asp.net/t/1169282.aspx](http://forums.asp.net/t/1169282.aspx)）的这个问题。

所以我的问题是，与内置的 asp.net 相比，在 IIS 上运行时有什么不同？

更新代码：

```
<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Untitled Page</title>

    <script type="text/javascript">
    var count=0;
    function incrementCounter()
    {
        count ++;
        alert(count);
    }
    </script>
</head>
<body>
    <form id="form1" runat="server">
    <asp:ScriptManager ID="ScriptManager1" runat="server">
    </asp:ScriptManager>
    <asp:UpdatePanel ID="UpdatePanel1" runat="server">
        <ContentTemplate>
            <asp:Label ID="Label1" runat="server" Text="Panel Created"></asp:Label>
            <asp:Button ID="Button1" runat="server" Text="Button" onclick="Button1_Click" />
        </ContentTemplate>
    </asp:UpdatePanel>

    <input type="button" id="Button2" value="JS Clicker" onclick="incrementCounter();" />
    </form>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T02:49:07.450

由于您使用的是 .NET Framework 3.5，因此我假设您使用的是 Visual Studio 2008，并且您说您将 IIS 5.1 用于生产平台。

作为 Visual Studio 2008 一部分的本地 Web 服务器基于 IIS 6/7 架构，而不是 IIS 5。因此，要回答您的问题，即 IIS 与本地 Web 服务器相比有何不同......不幸的是，在这个案例，你正在混合苹果和橙子。

您是否仅限于 IIS 5.1？... 即客户端授权或其他原因。如果您不是，并且您正在使用 Visual Studio 2008 (.NET Framework 3.5) 进行开发，那么您确实应该使用 IIS7（或至少 6 个），因为您很可能不会遇到此问题。

同样，IIS7 可能不适合您。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:53:46.163

您是否尝试过使用触发器？例如

```
<asp:UpdatePanel ID="UpdatePanel1" runat="server" UpdateMode="Conditional">
        <ContentTemplate>
            <asp:Label ID="Label1" runat="server" Text="Panel Created"></asp:Label>
            <asp:Button ID="Button1" runat="server" OnClick="Button1_Click" Text="Panel Refresh" />
        </ContentTemplate>
        <Triggers>
            <asp:AsyncPostBackTrigger ControlID="Label1" EventName="Click" />
        </Triggers>
    </asp:UpdatePanel> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T12:48:02.450

由于您的 UpdatePanel 的**UpdateMode**设置为有条件的，因此您必须指定一个触发器。

或者，您可以将属性**ChildrenAsTriggers**定义为*true*。

[UpdatePanel.UpdateMode 参考](http://msdn.microsoft.com/en-us/library/system.web.ui.updatepanel.updatemode.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T15:55:46.570

在 IIS 管理器中，检查站点的“页面和控件”设置。具体来说，查看状态和设置部分。这些看起来可能会影响您的页面与服务器的交互方式和时间。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-17T14:18:04.417

您是否尝试使用该`<asp:Button runat="server">`元素而不是 HTML`<input>`元素？

# sql-server - 如何聚合行以降低 SQL 查询中数据的分辨率？

> ID：654425
> 
> 赞同：1
> 
> 时间：2009-03-17T14:11:39.643
> 
> 标签：sql-server, reporting-services

我正在使用一个 MSSQL 2000 数据库，其中包含为环境中的所有服务器收集的大量 Windows 性能数据。我正在使用 SSRS 2005 构建自定义报告图表以可视化随时间变化的指标。

如果我想查看，比如说，上个月大量的数据点会创建一个丑陋的报告，在 X 轴上带有不可读的标签。我想按时间将数据聚合减少到*n 个*数据点，以便给出分组时间跨度的平均值。

我尝试使用花哨的 GROUP BY 子句构建查询，但无法构建可以执行的东西。我认为这应该是 SQL 的常见任务，但我没有在网上找到任何答案。

表结构基本上如下所示。这实际上是[MOM 2005](http://technet.microsoft.com/en-us/opsmgr/bb498244.aspx) OnePoint 数据库，但我认为应用程序无关紧要。

```
CREATE TABLE PerfTable (
   [time] datetime,
   value float,
   Server nvarchar(356),
   ObjectName nvarchar(225),
   CounterName nvarchar(225),
   InstanceName nvarchar(225),
   Scale float
); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T14:22:47.743

可能值得构建一个视图来查看几个月的数据并使用其背后的 SQL 来减少数据量。

然后您可以从该视图运行报告。

此外，您可能值得向我们介绍所涉及的表结构以及您当前用于获取结果的 SQL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-27T19:09:47.217

我有一个与我所要求的密切相关的解决方案。如果我想按时间单位分组，这很简单：

按小时分组：

```
select
   dateadd(hh, datediff(hh, '1970-01-01', [time]), '1970-01-01'),
   Server, ObjectName, CounterName, InstanceName, avg(value)
from PerfTable
group by
   dateadd(hh, datediff(hh, '1970-01-01', [time]), '1970-01-01'),
   ComputerName, ObjectName, CounterName, InstanceName
order by
   dateadd(hh, datediff(hh, '1970-01-01', [time]), '1970-01-01') desc,
   ObjectName, CounterName, InstanceName, ComputerName 
```

这只是没有解决缩小到*n 个*数据点的需要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T14:16:25.233

您真的需要减少从 SQL 返回的记录数，还是只需要减少图表呈现的数据？

从 SQL 中获取所有值可能更容易，然后将数据处理成以后更有用的东西。更改查询将减少网络使用量，因为将发送更少的数据，但如果这不是问题，那么查询可能不是最好的地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T14:37:05.197

您可以使用 DATEPART 函数来获取按特定日期、小时或分钟（或其他几个）过滤的数据块。您应该能够按这些分组并获得所需的平均值/聚合。

好的，这是获取 n 个聚合的解决方案（就每个时间块中的数据而言）：

```
declare @points as int
declare @start as float
declare @period as float

set @points = 20

select 
@start=cast(min(time) as float), 
@period=cast(max(time)-min(time) as float) 
from perftable

select avg(value),
round((cast(time as float)-@start)/(@period/@points),0,1)
from perftable
group by
round((cast(time as float)-@start)/(@period/@points),0,1) 
```

@points 变量是您想要获得的数量 od 聚合。@start 是报表中第一条记录的时间，转换为浮动 @period 是报表中开始日期和结束日期之间的差异

其余的几乎是将日期线性缩放到范围 [0;@points]，将结果截断为整数并按截断结果分组。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T14:49:54.637

假设我们想要 3 个时间跨度和该跨度内“价值”的平均值。

首先我们确定周期.. start-end、start-end、start-end 等您可以在自己的代码中执行此操作，因此我使用参数。

在此示例中，我们还按“服务器”分组，但您可以添加额外的列或将其删除。

```
DECLARE @startdate1 as DateTime
DECLARE @enddate1 as DateTime
DECLARE @startdate2 as DateTime
DECLARE @enddate2 as DateTime
DECLARE @startdate3 as DateTime
DECLARE @enddate3 as DateTime
SELECT 
  CASE WHEN time >= @startdate1 AND time < @enddate1 THEN 'PERIOD1'
    ELSE CASE WHEN time >= @startdate2 AND time < @enddate2 THEN 'PERIOD2'
     ELSE CASE WHEN time >= @startdate3 AND time < @enddate3 THEN 'PERIOD3' 
     END 
    END
  END as Period,
  AVG(p.[value]),
  p.[Server]
FROM PerfTable p
GROUP BY 
  CASE WHEN time >= @startdate1 AND time < @enddate1 THEN 'PERIOD1'
    ELSE CASE WHEN time >= @startdate2 AND time < @enddate2 THEN 'PERIOD2'
     ELSE CASE WHEN time >= @startdate3 AND time < @enddate3 THEN 'PERIOD3' 
     END 
    END
  END,
  p.[Server] 
```

# c++ - C++中调用析构函数和构造函数的顺序是什么

> ID：654428
> 
> 赞同：58
> 
> 时间：2009-03-17T14:12:07.737
> 
> 标签：c++, constructor, destructor

在 C++ 中调用析构函数和构造函数的顺序是什么？使用一些基类和派生类的例子

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-03-17T14:13:23.930

**顺序是：**

1.  基础构造函数
2.  派生构造函数
3.  派生的析构函数
4.  基础析构函数

**例子：**

```
class B
{
public:
  B()
  {  
    cout<<"Construct B"<<endl;
  }

  virtual ~B()
  {
    cout<<"Destruct B"<<endl;
  }
};

class D : public B
{
public:
  D()
  {  
    cout<<"Construct D"<<endl;
  }

  virtual ~D()
  {
    cout<<"Destruct D"<<endl;
  }
};

int main(int argc, char **argv)
{
  D d; 
  return 0;
} 
```

**示例输出：**

> 构造 B
> 
> 构造 D
> 
> 破坏D
> 
> 破坏B

**多级继承就像一个堆栈：**

如果您考虑将一个项目推入堆栈作为构造，并将其取出作为破坏，那么您可以将多个级别的继承视为堆栈。

这适用于任意数量的级别。

示例 D2 派生自 D 派生自 B。

将 B 压入堆栈，将 D 压入堆栈，将 D2 压入堆栈。所以施工顺序是B、D、D2。然后找出破坏顺序开始弹出。D2、D、B

**更复杂的例子：**

更复杂的例子请看@JaredPar 提供的链接

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-17T14:16:04.077

C++ FAQ Lite 中提供了这些事件的详细描述，包括虚拟继承和多重继承。第 25.14 和 25.15 节

[https://isocpp.org/wiki/faq/multiple-inheritance#mi-vi-ctor-order](https://isocpp.org/wiki/faq/multiple-inheritance#mi-vi-ctor-order)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-17T14:33:58.090

另外，请记住，虽然数组元素是先构造的 -> 最后一个，但它们会以相反的顺序被破坏：最后一个 -> 第一。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-03-07T19:06:47.477

我必须添加到以前的答案，因为每个人似乎都忽略了它

当您**创建****派生**类实例时，确实会在**派生**的构造函数***内***的代码**之前**调用**基**类的构造函数***内***的代码，但请记住，从技术上讲**，****派生****在****基地**。

 ********当你调用**派生**类析构函数时，派生析构函数***内的代码确实在基析构函数******内***的代码**之前**被调用，但也要记住，**基**类在**派生****之前**被**销毁**。

 *******当我说**created/destroyed**时，我实际上指的是**allocated/deallocated**。

如果您查看这些实例的内存布局，您会发现派生实例**构成**了基础实例。例如：

派生的内存：0x00001110 到 0x00001120

基础内存：0x00001114 到 0x00001118

因此，派生类必须在构造中的基类**之前分配。**派生类必须在销毁中的基类**之后释放。**

如果您有以下代码：

```
class Base 
{
public:
    Base()
    {
        std::cout << "\n  Base created";
    }
    virtual ~Base()
    {
        std::cout << "\n  Base destroyed";
    }
}

class Derived : public Base 
{
public:
    Derived()
    // Derived is allocated here 
    // then Base constructor is called to allocate base and prepare it
    {
        std::cout << "\n  Derived created";
    }
    ~Derived()
    {
        std::cout << "\n  Derived destroyed";
    }   
    // Base destructor is called here
    // then Derived is deallocated
} 
```

因此，如果您创建`Derived d;`并让它超出范围，那么您将在@Brian 的答案中获得输出。但是内存中的对象行为并不是真正的顺序相同，更像是这样：

建造：

1.  派生分配

2.  基地分配

3.  基础构造函数调用

4.  派生构造函数调用

破坏：

1.  派生的析构函数调用

2.  基析构函数调用

3.  基数解除分配

4.  派生解除分配

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-10-03T13:18:30.073

[这在order-dtors-for-members](https://isocpp.org/wiki/faq/dtors#order-dtors-for-members)中有明确描述。基本上，规则是“先构建，最后销毁”。

构造函数调用顺序：

1.  base 的构造函数在“：”之后按出现的顺序调用
2.  派生类成员的构造函数按出现顺序在类的构造函数之前调用

析构函数的调用顺序与被调用的构造函数相反。

例子：

```
#include <iostream>

struct base0 {  base0(){printf("%s\n", __func__);};~base0(){printf("%s\n", __func__);}; };
struct base1 { base1(){printf("%s\n", __func__);}; ~base1(){printf("%s\n", __func__);};};
struct member0 { member0(){printf("%s\n", __func__);};  ~member0(){printf("%s\n", __func__);};};
struct member1 { member1(){printf("%s\n", __func__);}; ~member1(){printf("%s\n", __func__);};};
struct local0 { local0(){printf("%s\n", __func__);}; ~local0(){printf("%s\n", __func__);}; };
struct local1 { local1(){printf("%s\n", __func__);};  ~local1(){printf("%s\n", __func__);};};
struct derived: base0, base1
{
  member0 m0_;
  member1 m1_;
  derived()
  {
    printf("%s\n", __func__);
    local0 l0;
    local1 l1;
  }
  ~derived(){printf("%s\n", __func__);};
};
int main()
{
  derived d;
} 
```

输出：

```
base0
base1
member0
member1
derived
local0
local1
~local1
~local0
~derived
~member1
~member0
~base1
~base0 
```

# asp.net - 外部配置文件中的 browserCaps

> ID：654430
> 
> 赞同：2
> 
> 时间：2009-03-17T14:12:26.613
> 
> 标签：asp.net, web-config, browsercaps

BrowserCaps 设置相当长。有没有办法将其分解为外部配置文件。

有人知道标记吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-25T21:21:33.667

1.  在您的项目中创建一个新的 web.config 文件并将其命名为 browserCaps.config

2.  将最新 browserCaps ( [http://owenbrady.net/browsercaps/CodeProject.xml](http://owenbrady.net/browsercaps/CodeProject.xml) ) 的 XML 粘贴到这个新文件中。

3.  在项目的现有 web.config 文件中，在该`<system.web></system.web>`部分中添加以下键：

    `<browserCaps configSource="browserCaps.config"/>`

另请参阅此链接：[http ://weblogs.asp.net/fmarguerie/archive/2007/04/26/using-configsource-to-split-configuration-files.aspx](http://weblogs.asp.net/fmarguerie/archive/2007/04/26/using-configsource-to-split-configuration-files.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-24T20:16:41.373

它只是 XML，可以在此处找到 BrowserCaps 文件的更新版本（支持[这个先前的答案](https://stackoverflow.com/questions/431765/asp-net-request-browser-crawler-dynamic-crawler-list/431991#431991)，为我指明了那个方向）：

> [Browser Detective 和 BrowserCaps 资源](http://owenbrady.net/browsercaps/)

如果您使用的是 ASP.NET 2.0+，那么由于从 .NET 2.0 开始[不推荐使用 browserCaps 元素](http://msdn.microsoft.com/en-us/library/sk9az15a.aspx)，您应该考虑在 /App_Browsers 文件夹中使用[.browser 文件。](http://msdn.microsoft.com/en-us/library/ms228122.aspx)

# silverlight - Silverlight 数据网格的 ColSpan

> ID：654440
> 
> 赞同：2
> 
> 时间：2009-03-17T14:16:42.687
> 
> 标签：silverlight, datagrid

我需要使用 rowspawns 为 TimeManagement 系统自定义 Datagrid。我想要的外观是这样的：

```
Customers| Projects  | Tasks  | Moanday | Tuesday | Wednesday | Thursday | Friday |
         |           | Task 1 |   0     |   0     |    0      |    0     |   0    |
Customer1| Project 1 | Task 2 |   0     |   0     |    0      |    0     |   0    |
         |           | Task 3 |   0     |   0     |    0      |    0     |   0    | 
```

Preferebly，我希望能够只给 DataGrid.ItemSource 一个客户列表，它应该基于此工作。我现在的模型是

```
 public class Customer
    {
       public string Name{get; set;}
       public List<Project> Projects{ get; set;}
    }
    public class Project
    {
       public string Name {get; set;}
       public List<Task> Tasks{ get; set; }
    }
    public class Task
    {
       public string Name { get; set;}
       public Week Week { get; set; }
    }
    public class Week 
    {
       public double Monday { get; set; }
       ...
    } 
```

*   我希望客户单元格在其所有项目行上都有一个行跨度。
*   我希望项目单元格的所有任务行都有一个行跨度。
*   而且，最重要的是，我需要用户能够使用键盘上的箭头键进行导航。

我的第一次尝试是在另一个数据网格的单元格内创建新的数据网格。似乎用户无法使用箭头键从一个数据网格导航到另一个数据网格。

任何帮助深表感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T20:41:22.460

查看 DataGrid 中的“RowDetailsTemplate”。这是一个可以在一行下方展开的部分。在 RowDetailsTemplate 中，您可以添加所需的任何内容，例如网格甚至数据网格。将 RowDetailsVisibilityMode 属性设置为 Visible，它将始终显示。

祝你好运。

——马特

# generics - 扩展方法字典 。移除所有？是否可以？

> ID：654441
> 
> 赞同：8
> 
> 时间：2009-03-17T14:16:52.110
> 
> 标签：generics, c#-3.0, extension-methods

我一直在尝试编写一个扩展方法来模仿 List.RemoveAll(Predicate)。

到目前为止，我有这个：

```
public static void RemoveAll<TKey,TValue>(this Dictionary<TKey,TValue> dict, 
                                     Predicate<KeyValuePair<TKey,TValue>> condition)
{
    Dictionary<TKey,TValue> temp = new Dictionary<TKey,TValue>();

    foreach (var item in dict)
    {
        if (!condition.Invoke(item))
            temp.Add(item.Key, item.Value);
    }

    dict = temp;
} 
```

任何指针？这是一个完全幼稚的实现吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-17T14:20:35.673

您的代码将不起作用，因为您正在按值传递 Dictionary 类。这意味着调用函数将看不到最终分配（dict = temp）。在 C# 中通过 ref 或 out 传递扩展方法目标是不合法的（在 VB 中，通过 ByRef 是合法的）。

相反，您需要修改 Dictionary inline。尝试以下

```
public static void RemoveAll<TKey,TValue>(this Dictionary<TKey,TValue> dict, 
                                     Func<KeyValuePair<TKey,TValue>,bool> condition)
{
    foreach ( var cur in dict.Where(condition).ToList() ) {
      dict.Remove(cur.Key);
    }
} 
```

**编辑**

交换 Where 和 ToList 的顺序以减小列表分配内存的大小。它现在只会为要删除的项目分配一个列表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T14:21:26.110

```
public static void RemoveAll<TKey,TValue>(
    this Dictionary<TKey,TValue> dict, 
    Predicate<KeyValuePair<TKey,TValue>> condition)
{
    var toRemove = new List<TKey>();

    foreach (var item in dict)
    {
        if (!condition(item))
            toRemove.Add(item);
    }
    foreach (var key in toRemove)
    {
        dict.Remove(key);
    }
} 
```

如果要删除的键的数量相对于字典大小来说很小，这将更快（如果删除的数量可能为零，您可以通过懒惰地创建 toRemove 列表来加快速度。

这归结为与 Jared 更新的答案相同，但如果您愿意，可以推迟创建删除列表。如果这不是问题（并且您没有理由在过程的中途中断点），那么 Jared 的会更干净、更简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T14:23:32.297

该方法不起作用，因为“dict”参数不是通过引用传递的，实际上不能，因为不支持将 ref 作为扩展方法的第一个参数。

```
public static void RemoveAll<TKey,TValue>(this Dictionary<TKey,TValue> dict, 
                                 Predicate<KeyValuePair<TKey,TValue>> condition)
{
    var temp = new List<TKey>();

    foreach (var item in dict)
    {
        if (!condition(item))
            temp.Add(item.Key);
    }

    foreach (var itemKey in temp)
      dict.Remove(itemKey)
} 
```

我也希望看到 RemoveAllByKey 和 RemoveAllByValue 实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T20:59:37.243

但如果你愿意，你可以返回一个新的和不同的字典。您的签名将更改为：

```
public static Dictionary<TKey, TValue> RemoveAll<TKey,TValue>(this Dictionary<TKey,TValue> dict, 
                                 Predicate<KeyValuePair<TKey,TValue>> condition) 
```

调用代码会说：

```
var newDict = oldDict.RemoveAll(kvp=> kvp.Name.StartsWith("something")); 
```

而且，如果你想修改 oldDict，你可以这样称呼它：

```
oldDict = oldDict.RemoveAll(kvp=> kvp.Name.StartsWith("something")); 
```

# .net - 以编程方式检测发布/调试模式 (.NET)

> ID：654450
> 
> 赞同：65
> 
> 时间：2009-03-17T14:19:27.657
> 
> 标签：.net, debugging, release

> **可能重复：**
> [如何确定 .NET 程序集是否使用 TRACE 或 DEBUG 标志编译](https://stackoverflow.com/questions/629674)

> **可能重复：**
> [如何识别 DLL 是 Debug 还是 Release 构建（在 .NET 中）](https://stackoverflow.com/questions/798971/how-to-idenfiy-if-the-dll-is-debug-or-release-build-in-net)

以编程方式检查当前程序集是在调试还是发布模式下编译的最简单方法是什么？

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2009-03-17T14:21:30.540

```
bool isDebugMode = false;
#if DEBUG
isDebugMode = true;
#endif 
```

如果你想在调试和发布版本之间编程不同的行为，你应该这样做：

```
#if DEBUG
   int[] data = new int[] {1, 2, 3, 4};
#else
   int[] data = GetInputData();
#endif
   int sum = data[0];
   for (int i= 1; i < data.Length; i++)
   {
     sum += data[i];
   } 
```

或者，如果您想对函数的调试版本进行某些检查，您可以这样做：

```
public int Sum(int[] data)
{
   Debug.Assert(data.Length > 0);
   int sum = data[0];
   for (int i= 1; i < data.Length; i++)
   {
     sum += data[i];
   }
   return sum;
} 
```

`Debug.Assert`不会包含在发布版本中。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-17T14:22:17.027

我希望这对你有用：

```
public static bool IsRelease(Assembly assembly) {
    object[] attributes = assembly.GetCustomAttributes(typeof(DebuggableAttribute), true);
    if (attributes == null || attributes.Length == 0)
        return true;

    var d = (DebuggableAttribute)attributes[0];
    if ((d.DebuggingFlags & DebuggableAttribute.DebuggingModes.Default) == DebuggableAttribute.DebuggingModes.None)
        return true;

    return false;
}

public static bool IsDebug(Assembly assembly) {
    object[] attributes = assembly.GetCustomAttributes(typeof(DebuggableAttribute), true);
    if (attributes == null || attributes.Length == 0)
        return true;

    var d = (DebuggableAttribute)attributes[0];
    if (d.IsJITTrackingEnabled) return true;
    return false;
} 
```

# javascript - 限制文本区域长度的最佳 JavaScript 解决方案是什么？

> ID：654451
> 
> 赞同：7
> 
> 时间：2009-03-17T14:19:35.817
> 
> 标签：javascript, html

是否有规范的解决方案来限制某人可以输入文本区域的字符数？

我当然有服务器端验证，但想通过添加客户端代码来模拟您在 input[type="text"] 上使用 maxlength 获得的体验来改善用户体验，这样用户就永远不会看到“您的输入太长”错误消息，如果他们启用了 javascript。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-17T14:36:25.417

我的非技术性 $0.02

执行 SO 在他们的评论字段中所做的事情，提供有关用户剩余字符长度的反馈，并允许他们超过最大值，但不要提交 > 300 个字符。原因如下：

*   允许用户超过最大字符数可以让他们完成一个想法。然后他们可以返回并编辑该想法。没有什么比句尾无法完成更糟糕的了。*   提供对字符长度的反馈使人们不必猜测它们的长度是多少。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T14:36:46.447

我会这样做：

```
$ ('#textarea-id').bind (
  'change input keyup keydown keypress mouseup mousedown cut copy paste',
  function () { return ($(this).val().length <= maxlength) }
) 
```

这么多的狂欢只是为了*完全*确定:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T14:25:11.873

将 onchange 事件附加到 textarea。在那里您可以检查该值是否大于适当的值。jQuery 示例：

```
$("#textarea-id").change(function (){
  var text = $(this).val();
  if( text.length > MAX ){
    return false;
  }
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T14:38:17.317

这会做到...

```
function textareaMaxLen(event) {
  var max = parseInt(this.attr("maxlength"), 10);
  if(this.value.length >= max)
    this.value = this.value.substr(0, max);
}

$("textarea").keyup(textareaMaxLen).blur(textareaMaxLen); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T14:29:11.240

我过去做过这样的事情：

```
<textarea onkeyup="checkLength(this);"></textarea> 
```

然后实现这个函数：

```
function checkLength(control) {
            if (control.value.length > 5) {
                control.value = control.value.substr(0, 5);
            }
        } 
```

这是一个将长度固定为 5 的非常基本的示例，但希望能给您带来想法！

# c++ - 是否有任何忽略默认内联函数的 C++ 标准的编译器？

> ID：654452
> 
> 赞同：1
> 
> 时间：2009-03-17T14:19:40.560
> 
> 标签：c++, inline, standards-compliance

C++ ISO 标准说：

```
"A function defined within a class definition is an inline function." 
```

有没有忽略这条规则的编译器？
（请不要将 inline 误认为 inlineD - 我的问题是如果有一个编译器，它不会把它应该的内联建议放在那里）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T14:28:02.257

您似乎误解了“内联”的含义。这并不意味着函数会自动内联；根据 7.1.2-2，它表明内联替换是首选。

因此，您无法从代码中判断一个函数是否被标记为内联，因为编译器可以自由决定一种或另一种方式。这只是一个编译器提示。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T14:25:58.877

该标准规定所有编译器都可以忽略内联请求，无论是隐式的还是显式的。他们是否这样做通常取决于函数是否可以实际内联 - 例如递归函数不能。

**编辑：**只是为了澄清-提问者忽略了这一点，从标准中的前一段到他引用的内容：

> 在调用点执行此内联替换不需要实现

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T14:47:51.083

我怀疑你的测试有缺陷。你不能只用一个这样的文件来测试编译器是否忽略了内联说明符。

您需要包含包含内联函数定义的标头，并将其包含到多个实现文件中，然后将它们链接在一起。如果您收到有关该函数的多个已定义实例的链接器错误，则编译器*将*忽略有关其最重要属性的内联说明符：允许在整个程序中多次定义它，同时仍为其保留相同的地址及其本地静态变量。

您的测试可能检查的是编译器是否内联对函数的调用，这实际上只是对编译器的提示，并且只是内联说明符的许多其他更重要后果的一小部分。如果编译器没有内联对该函数的调用，则可以这样做。该标准不要求它在这件事上做任何事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T16:25:26.060

请参阅我对一个非常相似的问题的回答：[“内联”何时无效？（在 C 中）](https://stackoverflow.com/questions/582919/when-is-inline-ineffective-in-c/582932#582932)

总结：内联只需要允许多个定义。任何调用更改的函数都是完全可选的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T14:43:51.500

编译器的内联通常基于函数的调用次数、函数中伪指令的数量以及一堆其他的东西。查看[有关优化选项的 GCC 文档](http://gcc.gnu.org/onlinedocs/gcc-4.3.3/gcc/Optimize-Options.html#Optimize-Options)，了解它是如何工作的。基本上，`inline`关键字只是增加编译器内联可能性的提示。内联的实际决定通常很复杂。

# excel - 将文本数据更改为正确的数据类型

> ID：654470
> 
> 赞同：1
> 
> 时间：2009-03-17T14:23:39.817
> 
> 标签：excel, vba, dts

我正在从 DTS 填充 Excel 工作表。结果被格式化为文本，因为 DTS 将单元格视为 varchar(255)。

单元格格式正确。问题是 Excel 将数据视为文本而不是日期时间或数字。

例如，单元格中的值显示为“2009-01-01 00:00:00”。如果我按 F2 编辑单元格，然后按 ENTER，Excel 会意识到它是一个日期，然后根据单元格格式对其进行格式化。

如何使用 VBA 将值格式化为数字或日期时间？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T14:53:28.403

似乎您可以将单元格或范围的值分配给自身，并让 Excel 确定数据类型。您可以一次执行此操作，例如：

```
Worksheets("MySheet").Range("A:A").Value 
     = Worksheets("MySheet").Range("A:A").Value 
```

# c - NCurses 初始化而不清除屏幕

> ID：654471
> 
> 赞同：9
> 
> 时间：2009-03-17T14:23:52.670
> 
> 标签：c, ncurses

我正在编写一个类似于 shell 的程序。启动后，会出现提示，您可以输入一些特定于应用程序的命令。

到目前为止，这工作得很好。但是，我想像在 Bash 中一样添加对命令历史记录的支持，以便用户可以点击向上或向下箭头并查看以前输入的命令。

我已经包含了 ncurses 库，并且我使用 getch() 做了一个简单的 hello world 测试，以确保正确报告向上和向下箭头。

困扰我的事情是，我调用 initscr() 似乎是一个要求，这将清除屏幕以便我使用 getch()。

好的，所以问题是：

有人知道不用先调用 initscr() 就可以使用 ncurses getch() 函数的方法吗？如果没有，我可以让它不清除屏幕吗？基本上，我希望 getch() 的行为与 getchar() 相同，如果这有意义的话。

提前致谢！

编辑：我认为最好的例子是 Python 如何在交互模式下运行。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T14:30:59.393

Curses 想要完全控制屏幕，并优化对屏幕的写入，尤其是在慢速串行线路上。为此，它需要知道屏幕上的内容，而对于大多数终端来说，唯一合理的方法是从空屏幕开始并跟踪您向终端写入的内容。

因此，我怀疑 (n)curses 是您的 shell 的错误工具。您可能需要在抽象层上走一步，并使用 terminfo 和来自终端（标准输入）的非阻塞读取。

（这不是很有帮助。对不起。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-18T21:19:07.587

[使用像readline()](http://tiswww.case.edu/php/chet/readline/rltop.html)这样的接口可能比使用成熟的 ncurses 更简单。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-17T14:31:13.870

您可以从[rlwrap](https://linux.die.net/man/1/rlwrap)中调用您的程序，并拥有没有痛苦的功能......

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-17T14:31:29.547

这是关于此的另一个[讨论](http://lists.gnu.org/archive/html/bug-ncurses/2008-07/msg00001.html)。提供的解决方案是：

1.  “'filter()' 函数让你可以将诅咒用作单行。”
2.  “您可以在 C 中编写等效的东西，使用 setupterm 获取终端数据，使用 tparm、tputs 进行格式化和输出。”

当然，还有第三个选项可以获取 ncurses 源代码并对其进行修改，使其不再清除屏幕。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-18T04:14:43.120

您是否考虑过创建自定义 terminfo 或 termcap 条目的简单权宜之计，该条目缺少清除屏幕的顺序，然后在运行程序之前将终端设置切换到正确的位置？您也可以在 ncurses 中使用 newterm() 和 set_term()。这过去使用 termcap 更容易，因为您可以包含另一个终端并覆盖它的一些功能。

# javascript - FCKEditor - 如何制作一个简单的插件？

> ID：654472
> 
> 赞同：4
> 
> 时间：2009-03-17T14:24:13.887
> 
> 标签：javascript, plugins, fckeditor

我有一个使用 FCKEditor 的网站。我想做一个非常简单的插件：当用户选择文本然后点击 MyPluginIcon 时，编辑器将文本包围在具有特定类的 span 标签中。

所以它就像粗体或斜体按钮一样，但用于：

`<span class="blah">EtcEtc</span>`

我远不是 JS 专家，所以一直在找一个插件来复制。我查看了 FCK wiki，但我发现的所有插件都非常复杂（文件浏览器等等）。你知道一个**超级简单**的FCK 插件我可以作为我的插件的基础吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T15:15:25.417

回答我自己的问题！希望将来有人发现它会有所帮助。

我使用了这里的基本文件：http: [//www.iondev.lu/fckeditor/netnoi.txt](http://www.iondev.lu/fckeditor/netnoi.txt)

我发现并用我自己的名字替换了“netnoi”，并取消注释图标行以制作图标（16x16）。

以及如何从这里安装它的说明：http: [//docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Customization/Plug-ins](http://docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Customization/Plug-ins)

请务必检查插件目录是否正确——在 drupal 中，插件文件夹与默认的 FCK 安装不同。

编辑：显然 netnoi.txt 不见了。这是我使用的：

```
/***
 * Create blank command
 */
var FCKPixelCaps_command = function()
{

}

/***
 * Add Execute prototype
 */
FCKPixelCaps_command.prototype.Execute = function()
{
        // get whatever is selected in the FCKeditor window
        var selection = FCK.EditorDocument.getSelection();

        // if there is a selection, add tags around it
        if(selection.length > 0)
        {
                FCK.InsertHtml('<span class="caps">' + selection + '</span>');
        } else {
                // for debugging reasons, I added this alert so I see if nothing is selected
                alert('nothing selected');
        }
}

/***
 * Add GetState prototype
 * - This is one of the lines I can't explain
 */
FCKPixelCaps_command.prototype.GetState = function()
{
        return;
}

// register the command so it can be use by a button later
FCKCommands.RegisterCommand( 'PixelCaps_command' , new FCKPixelCaps_command() ) ;

/***
 * Create the  toolbar button.
 */

// create a button with the label "Netnoi" that calls the netnoi_command
var oPixelCaps = new FCKToolbarButton( 'PixelCaps_command', 'Pixels & Pulp Caps' ) ;
oPixelCaps.IconPath = FCKConfig.PluginsPath + 'PixelCaps/caps.gif' ;

// register the item so it can added to a toolbar
FCKToolbarItems.RegisterItem( 'PixelCaps', oPixelCaps ) ; 
```

# flex3 - 为什么在 FLEX 3 中有些模块会加载而有些模块不会加载？

> ID：654474
> 
> 赞同：0
> 
> 时间：2009-03-17T14:24:41.890
> 
> 标签：flex3, module

我有一个包含多个模块的应用程序。任何时候都只加载一个模块。3 个模块中有 2 个加载没有问题，但第三个新模块不会触发 ModuleEvent.Ready。我有一个处理 ModuleEvent.PROGRESS 的事件处理函数，它只是跟踪加载的字节数与总字节数。它似乎完全加载了模块，但从未触发 ready 事件。这是我加载模块的方式：

```
 public var moduleInfo:IModuleInfo;

    public function loadModule(url:String):void{

         if(moduleInfo != null)
            moduleInfo.release();       

          moduleInfo = ModuleManager.getModule(url+"?"+"x="+Math.random().toString());
          moduleInfo.addEventListener(ModuleEvent.READY,moduleLoadHandler,false,0,true);
          moduleInfo.addEventListener(ModuleEvent.PROGRESS,onModuleProgress,false,0,true);
          moduleInfo.load(ApplicationDomain.currentDomain);

        } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T15:37:28.970

好的，事实证明我已经很久没有创建一个新模块了。我忘记了一件关键的事情。由于我的模块位于不同的项目中，我需要将主 mxml 文件的根标记从 Application 更改为 Module。:)

生活和学习，当你错了时，永远不要羞于承认。

# java - 是否有一个行为类似于自动 ID SQL 表的 Java 集合（或类似集合）？

> ID：654480
> 
> 赞同：6
> 
> 时间：2009-03-17T14:26:30.450
> 
> 标签：java, data-structures, collections

请注意，我实际上并没有在这里对数据库做任何事情，所以 ORM 工具可能不是我想要的。

我想要一些容器，每个容器都包含许多对象，一个容器中的所有对象都属于同一类。容器应该显示数据库表的一些行为，即：

*   允许将对象的字段之一用作唯一键，即不会将在该字段中具有相同值的其他对象添加到容器中。
*   在接受一个新对象时，容器应该发出一个返回给插入方法调用者的数字 id。

当请求“重复条目”时，容器应该跳过插入并返回已经存在的对象的键，而不是抛出错误。

现在，我将编写一个通用容器类，它接受实现接口的对象以获取键字段的值，并使用以这些值作为键的 HashMap 作为实际的存储类。使用现有的内置类有更好的方法吗？我正在查看 HashSet 等，但它们似乎不适合。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T14:28:53.050

没有一个 Collections 类可以满足您的需要。你必须自己写！

PS 你还需要决定你的类是否是线程安全的。

PPS [ConcurrentHashMap](http://download.oracle.com/javase/1,5.0/docs/api/java/util/concurrent/ConcurrentHashMap.html)很接近，但并不完全相同。如果您可以子类化或包装它或包装进入映射的对象，以便您仅依赖该类来实现线程安全，那么您将拥有一个高效且线程安全的实现。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T15:16:20.953

[您可以使用HashSet](http://java.sun.com/j2se/1.4.2/docs/api/java/util/HashSet.html)模拟此行为。如果要添加到集合中的对象具有可用作唯一 ID 的字段，则只需让对象的 hashCode() 方法返回该字段（或使用[计算的哈希码](http://www.javapractices.com/topic/TopicAction.do?Id=28)值，任何一种方式都应该有效）。

[添加](http://java.sun.com/j2se/1.4.2/docs/api/java/util/HashSet.html#add(java.lang.Object))重复条目时，HashSet 不会抛出错误，它只会返回 false。您可以包装（或扩展）HashSet，以便您的 add 方法返回您想要的唯一 ID 作为返回值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T14:35:19.757

我在想你可以用 ArrayList 来做，使用数组中的当前位置作为“id”，但这并不妨碍你在现有位置进行插入，而且当你在那个位置插入时，它会移动一切都好。但是您可以将自己的类基于 ArrayList，在 .add 之后返回 .size() 的当前值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T15:20:41.537

对象的哈希码不能用作“数字 id”是否有原因？

If not, then all you'd need to do is wrap the call into a ConcurrentHashMap, return the object's hashCode and use the putIfAbsent(K key, V value) method to ensure you don't add duplicates.

putIfAbsent also returns the existing value, so you could get its hashCode to return to your user.

See [ConcurrentHashMap](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ConcurrentHashMap.html)

# embedded - 从嵌入式到桌面的可重用知识

> ID：654485
> 
> 赞同：2
> 
> 时间：2009-03-17T14:28:14.860
> 
> 标签：embedded, desktop, reusability

在嵌入式电信系统开发（C、MAKE、Symbian、100 编译器等）工作了大约 8 年后，我正在考虑通过进入桌面开发（VC++、MFC、C# 等）“稍微”改变我的道路。

然而，我担心的是，我在嵌入式系统方面的经验在进入桌面开发时可能不会给我带来太多价值。例如，我工作了这么长时间的特定领域问题和环境仍然没有给我太多谈判薪水的机会，因为它在桌面上几乎没有价值。

我认为这个地方可能对这方面有帮助。

**所以，问：**

**如果您忽略了在编程语言级别上明显的通用经验，请举例说明您在使用嵌入式系统时学到的东西，您可以在桌面环境中重用这些东西。**

PS：我应该注意我不是桌面领域的初学者——因为很多年前我所有的爱好项目都集中在桌面开发上。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T19:50:48.637

在验证操作和处理有限资源时，嵌入式工程师通常会更加自律。

这也可以转化为更早提出异常处理策略。

典型的例子是检查 malloc 的返回值。我见过很少有桌面软件能持续检查它，但它在嵌入式环境中很常见。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T06:49:30.627

许多仅使用桌面的开发人员可以从使程序适合 128K 的 FLASH 和 32K 的 SRAM 的经验中受益，更不用说仅通过一个或两个 LED 和几个按钮与用户进行有意义的交流。提出这一要求可能会减少应用程序行业中的一些地方性代码膨胀。:-)

即使您不转向直接的应用程序开发，嵌入式体验也可以很好地转化为驱动程序开发，以及低级实用程序和长期运行的服务。在所有这些领域，对于成功的嵌入式开发人员来说，几乎是第二天性的学科仍然很有价值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T01:47:32.817

拥有一套干净、组织良好的源代码的纪律是很好地转化为“桌面体验”的关键技能。——我注意到我编写和学习的嵌入式项目通常比桌面项目更干净。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T07:31:50.650

在切换到嵌入式环境之前，我做了将近 5 年的桌面开发人员。我发现在嵌入式环境中工作更具挑战性，因为我们必须处理内存限制、CPU 速度慢、交叉编译问题等。

在学会了很多耐心、纪律和低层次的复杂性之后，桌面开发应该像在公园里散步一样容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-30T15:09:07.343

嵌入式系统上的状态机/事件驱动编程与桌面上的事件驱动编程没有什么不同。您在嵌入式系统（尤其是电信嵌入式系统）上对这些编码技术的丰富经验应该会让您成为一名出色的桌面程序员。

同样，您对通信协议的体验应该很好地转移到桌面上。大多数桌面应用程序都与网络有关。

# c# - System.Windows.Forms.Panel.Enabled = 假色过载？

> ID：654497
> 
> 赞同：0
> 
> 时间：2009-03-17T14:32:06.503
> 
> 标签：c#, .net-2.0

我在一个 Windows 应用程序中有一个 System.Windows.Forms.Panel 控件，该控件在面板中有许多标签和文本框。当您调用 Panel.Enabled = false 命令时，所有文本框和标签都会变灰并变为不可编辑，这是所需的效果。当面板被禁用时，有没有办法使浅灰色过载？

使用的解决方案：

由于禁用时无法覆盖禁用的颜色，因此使用以下内容仅禁用面板上的文本框和标签，而不是空白的 Panel.Enabled = false;。

```
//Loop through the Member info Panel and find all the group boxes 
foreach (Control cItem in Panel.Controls)
{
    //A group box is found 
    if (cItem is GroupBox)
    {
        //Loop through all the group box components
        foreach (Control cSubItem in cItem.Controls)
        {
            //If its a label of text box disable it
            if (cSubItem is TextBox || cSubItem is Label) 
            { 
                cSubItem.Enabled = false; 
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T14:36:35.887

无法全面覆盖禁用每个 Label 和 TextBox 时的着色方式。但是您可以在禁用包含面板后覆盖每个单独的控件并将它们设置为适当的颜色。

禁用时，TextBox 类（更具体地说是 TextBoxBase 类）将优先使用显式颜色而不是默认的灰色进行绘制。

我不久前写了一篇关于如何实现这种效果的博客文章：http: [//blogs.msdn.com/jaredpar/archive/2007/02/12/readonly-textbox-that-doesn-t-look-funny.aspx](http://blogs.msdn.com/jaredpar/archive/2007/02/12/readonly-textbox-that-doesn-t-look-funny.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T19:16:36.243

作为替代方案：如果您希望控件具有不同的启用/禁用颜色，您可以遍历在面板中注册的控件，并为其 EnabledChanged 事件分配自定义函数以更改其颜色（基于我假设的类型）。您可能想要过滤您修改的控件类型，但您可以使用它来实现您的目标，我相信。

更新：试试这个： `public void deselected(object sender, EventArgs e) { foreach (Control c in this.Controls) { //TODO:check type of control and change background color } }` 这需要放在你的 Form 类中，但你可以在事件中使用它。希望有帮助。

# database - 针对新项目的平台/框架/语言/等方面的建议

> ID：654498
> 
> 赞同：0
> 
> 时间：2009-03-17T14:32:47.877
> 
> 标签：database, version-control, programming-languages, frameworks

我知道这本身不是一个编程问题，但我想从 SO 社区获得尽可能多的关于我希望开始的新项目的意见。该项目是从零开始的，因此对编程语言、数据库、框架、平台以及其他方面的每一个决定都是悬而未决的。我希望得到您对此事的意见，您认为每个选项的优点和缺点。

***数据库：*** 目前我可以选择使用 MSSQL 或 MySQL。虽然我倾向于使用 MySQL，因为它是免费的，而且很可能具有我需要的所有功能。但是，有很多分层数据的可能性，MSSQL 中新的分层数据类型非常吸引人。它真的简化了这么多事情吗？此外，MSSQL 还支持许多更高级的 SQL 函数，这些函数从长远来看可能有用也可能没用。虽然对于开发我可以访问 Server 2008，但随着开发团队的成长和生产，我可以获得多个许可证，成本是否合理？

***编程语言：*** 该项目将有一个基于 Web 的前端 UI 和一个基于服务器的组件，这些组件将完成一些繁重的工作。

对于基于 Web 的 UI，我正在考虑用 PHP 做 Apache/IIS，或者用 C# 用 ASP.Net 做 IIS。我想使用一个好的框架来正确利用应该构建应用程序代码和开发的良好设计模式。以及从长远来看使修改易于实施。我还希望 GUI 看起来不错，并且不喜欢从组件供应商那里购买 .Net 控件的想法。相反，我更喜欢使用优秀的 CSS 以及 YUI 和 javascript 等开源来使 UI 更时尚的想法。

对于基于服务器的组件，我正在考虑使用 C#。我没有真正的 C++ 开发经验，我想要好的库和足够的速度就足够了。然而，虽然基于 Web 的 UI 和基于服务器的组件是松散耦合的，但可能存在 UI 需要与基于服务器的组件通信（调用方法等等）的情况，我想选择可以很好地使用的语言/框架彼此。

欢迎所有关于要合并的框架的建议。

***版本控制：*** 我在 SVN 方面有过很好的经验，在 TFS 方面有过非常糟糕的经验。我从未与 GIT 合作过。您认为在功能和一般开发人员熟悉度方面哪个更好。我想选择其他开发人员会知道并且不会遇到麻烦的东西。

如果问题有点多余，或者我没有提供足够的信息或使用错误的术语，我深表歉意。我计划在收到反馈后编辑和改进问题。谢谢！

**编辑：** 谁：这很可能是由大学生或初级开发人员组成的初创公司。我希望该项目能够利用大多数人熟悉或易于掌握的技术。

什么：我需要数小时和数天来解释解决方案。但最终，当您将其分解时，它是一个基于 Web 的 UI（认为标准 Web 应用程序仅用于管理数据库数据）将用于知识渊博的客户。基于服务器的组件将是非常独立的，除了它应该能够与 Web 应用程序通信。

我可以根据需要提供更多信息，但我希望用户有机会在您匆忙结束问题之前回答并提供他们的想法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T11:49:03.283

您应该首先选择平台，然后选择最适合该平台的语言（如果有任何选择）。

您应该考虑的一件事是特定平台和语言的劳动力池和劳动力池成本。如果您还没有想法，人力资源部门通常可以获得成本指标。

例如，在我所在的城市，.NET 平台的每位软件工程师比开源的要贵得多，因为 .NET 开发人员的比率更高（大约 40%）。C# 的比率比 VB.NET 高一点，但也倾向于带来更全面的候选人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T14:56:19.613

显然，这在很大程度上取决于具体要求，但话又说回来，即使有那些我可能也无法确定！

几个月来，我自己一直在从事一个从头开始的项目，并且通常发现：

*   为所有层选择 Microsoft 就容易多了（我的主观意见）。例如，我将 C# 用于 UI、后端，并将 MSSQL 用于数据库。非微软供应商没有任何问题，我不是微软的粉丝，我只是努力使用不熟悉的工具提高工作效率。不过，这取决于您的经验所在。
*   **数据库：**特别是我发现 .NET 和 MSSQL 很容易结合在一起。当我开始这个项目时，我使用的是 PostgreSQL（因为它是免费的、功能齐全的并且具有开源温暖的模糊功能）。然而，我放弃了它，转而使用 MSSQL，只是因为我用不熟悉的语言和不熟悉的工具完成数据库工作需要很长时间。此外，我不确定 MSSQL 是否已经如此昂贵，例如对于 Web 应用程序，我认为 MSSQL 2008 Web 版的每个处理器非常便宜（尽管仅在 SPLA 许可上）。但是，如果您担心免费实现中的数据库功能，我个人认为 PostgreSQL 具有非常完整的功能集，很好地标准化并且快速增长。
*   **UI**：我非常缺乏经验，但 ASP.NET MVC 对我来说似乎远没有 ASP.NET Web 窗体那么痛苦。我也喜欢 PHP，但我再次将 UI 语言与后端语言相匹配，因此推荐 .NET。
*   在**frameworks**上，我现在沉浸在 DAL 中。我喜欢 Subsonic 的轻量级数据，NHibernate 的重量级数据。

我的项目还有很长的路要走，所以也许我目前只能看到短期的利弊。但总的来说，我会说：使用您最习惯使用的技术，因为您的工作效率会更高，而且最终结果可能会大致相同。如果你想学习新技术，谁不想呢？- 继续，只是预计它需要更长的时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T19:23:11.457

不想回答，因为它是如此开放的结局。但有几点：

## 钱

首先，查看[BizSpark](http://www.microsoft.com/BizSpark/)。那应该照顾3年的任何金钱方面。对于一家服务公司来说，这意味着不仅免费的 VS Team Suite 和 Office 等，还包括免费的 Windows、SQL 等。如果你的初创公司在 3 年内无法在 MS 技术上花一点钱，那*可能是*一项糟糕的业务. 所以这需要许可。

*   同样，Sun 也有[Startup Essentials](http://www.sun.com/emrkt/startupessentials/)。在硬件方面可能很有趣，但我实际上并没有将它们与戴尔/惠普相比具有竞争力的价格。

## 软件

听起来您没有足够的要求说“哦，这个稍微不那么流行的软件 X 非常适合我的域 Y，并且会给我很大的推动力”。事实上，您的项目可能根本不是那样的。也许，从技术上讲，它将是一个相对简单的应用程序，只是推送数据或其他什么。你没有具体说明。

对于一家小型初创公司来说，个人生产力可能会胜过任何其他论点。如果您的员工在 X 方面表现出色，那么这就是您最重要的论点之一。

如果您真的没有任何您最熟悉的特定系统，请保守一点。坚持使用 .NET 或 Java，因为它们将为您提供最广泛的有用可能性。

至于操作系统和数据库之类的东西，我有偏见，但我认为微软会给你提供比你在其他地方更容易利用的平台。例如，在 Windows 上设置负载平衡、集群、集中身份验证、管理服务器（更新、事件等）将比在其他平台上更容易，假设您不是这方面的专家. 配置 SQL Server，甚至是高级功能，都是小菜一碟。（去那些都不知道的人吧：在 MSSQL 和 MySQL 中设置一个数据库镜像——这将需要更多的工作？）同样，这一切都取决于您没有特定技术方面的专家。

**不要混用**——不管你做什么，坚持平台。如果您使用 .NET，MSSQL 将更好地与数据提供者（或 Linq-to-SQL 之类的东西）一起工作。如果你决定做 PHP，那么像其他人一样使用 MySQL，你会遇到更少的阻力。如果您没有在技术方面发明东西，请不要成为边缘案例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T15:38:23.147

只是抛出一些完全不同的东西：[weblocks](http://weblocks.viridian-project.de/)作为一个 web 框架怎么样？它使用[Hunchentoot](http://www.weitz.de/hunchentoot/)作为服务器，既可以独立运行，也可以与 Apache 一起运行。这一切都是在 Common Lisp 中完成的。Weblocks 可以使用[cl-sql](http://clsql.b9.com/)作为后端存储，它可以连接到许多不同的 RDBM（MySQL、PostgreSQL、Oracle、ODBC、SQLite）。

# python - Python 文件模式详细信息

> ID：654499
> 
> 赞同：13
> 
> 时间：2009-03-17T14:32:48.080
> 
> 标签：python, file-io

在 Python 中，以下语句不起作用：

```
f = open("ftmp", "rw")
print >> f, "python" 
```

我得到错误：

```
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
IOError: [Errno 9] Bad file descriptor 
```

但是使用以下代码它可以工作：

```
g = open("ftmp", "r+")
print >> g, "python" 
```

看来我需要修改文件模式。文件打开模式的深层复杂性是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-17T14:38:28.627

更好的是，让文档为您完成： http: [//docs.python.org/library/functions.html#open](http://docs.python.org/library/functions.html#open)。您在问题中的问题是没有“rw”模式......您可能想要 'r+' 就像您写的那样（如果文件尚不存在，则为 'a+' ）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-17T22:30:32.853

作为[@Jarret Hardie 的回答的补充，这里是 Python 如何在函数](https://stackoverflow.com/questions/654499/python-file-modes-detail/654518#654518)[fileio_init()](http://hg.python.org/cpython/file/3.2/Modules/_io/fileio.c#l286)中检查文件模式：

```
s = mode;
while (*s) {
    switch (*s++) {
    case 'r':
        if (rwa) {
        bad_mode:
            PyErr_SetString(PyExc_ValueError,
                    "Must have exactly one of read/write/append mode");
            goto error;
        }
        rwa = 1;
        self->readable = 1;
        break;
    case 'w':
        if (rwa)
            goto bad_mode;
        rwa = 1;
        self->writable = 1;
        flags |= O_CREAT | O_TRUNC;
        break;
    case 'a':
        if (rwa)
            goto bad_mode;
        rwa = 1;
        self->writable = 1;
        flags |= O_CREAT;
        append = 1;
        break;
    case 'b':
        break;
    case '+':
        if (plus)
            goto bad_mode;
        self->readable = self->writable = 1;
        plus = 1;
        break;
    default:
        PyErr_Format(PyExc_ValueError,
                 "invalid mode: %.200s", mode);
        goto error;
    }
}

if (!rwa)
    goto bad_mode; 
```

即：只`"rwab+"`允许使用字符；必须有一个`"rwa"`，最多一个`'+'`，并且`'b'`是一个 noop。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T18:31:35.743

事实上，这没关系，但我在第 42 行和第 45 行的以下代码（对于[S60上的 Python）中发现了套接字上的“rw”模式：](http://en.wikipedia.org/wiki/S60_%28software_platform%29)

[http://www.mobilenin.com/mobilepythonbook/examples/057-btchat.html](http://www.mobilenin.com/mobilepythonbook/examples/057-btchat.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-05-26T22:13:28.223

[https://www.geeksforgeeks.org/python-append-to-a-file/](https://www.geeksforgeeks.org/python-append-to-a-file/)

```
use the append if the file exists and write if it does not.

 import pathlib
 file = pathlib.Path("guru99.txt")
 if file.exists ():
      file1 = open("myfile.txt", "a")  # append mode  
 else:
      file1 = open("myfile.txt", "w")  # append mode

file1.write("Today \n")
file1.close() 
```

# visual-c++ - .rc2 文件中的多引号字符串，VC++

> ID：654500
> 
> 赞同：0
> 
> 时间：2009-03-17T14:33:20.993
> 
> 标签：visual-c++

我正在构建一个 VC++ 项目，我碰巧有一些数据，比如在 Resources.rc2 文件中

“我的数据包含“多引号字符串”以及“<”“>”“\”等符号

似乎需要转义引号和 <、> 和 \。

在 VS08 中使用 RC.exe 编译时出现错误 RC2104。它在第一次出现引号时终止字符串。我能做些什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T14:36:56.570

在不了解您的 RC 文件的情况下，请尝试：

[资源编译器错误 RC2104](http://msdn.microsoft.com/en-us/library/k2z28y0f(VS.71).aspx)

# vbscript - vbscript 字符串中的引号导致 wsh 无效 url 错误

> ID：654505
> 
> 赞同：1
> 
> 时间：2009-03-17T14:34:40.960
> 
> 标签：vbscript, wsh

我试图让下面的脚本产生这样的快捷方式：

> "C:\Program Files\Internet Explorer\iexplore.exe" [http://WebApp/index.aspx](http://WebApp/index.aspx)

```
set WshShell = WScript.CreateObject("WScript.Shell")
strDesktop = WshShell.SpecialFolders("Desktop")
set oUrlLink = WshShell.CreateShortcut(strDesktop & "\WebApp.url")
oUrlLink.TargetPath = ""&chr(34)& _
  "C:\Program Files\Internet Explorer\iexplore.exe" & _
   chr(34)&" http://WebApp/index.aspx"
oUrlLink.Save 
```

但它似乎不喜欢引号。

我在 URL 中得到一个无效的语法：“”C:\Program Files\Internet Explorer\iexplore.exe“ [http://WebApp/index.aspx](http://WebApp/index.aspx) ”。

如何在没有 vbscript 的情况下嵌入“内裤”？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T14:59:59.497

这是根据微软的：

```
Set objShell = CreateObject("Wscript.Shell")
strFolder = objShell.SpecialFolders.Item("Desktop")
Set objShortcut = objShell.CreateShortcut(strFolder & "\Open Web Site.lnk")
objShortcut.TargetPath = "C:\Program Files\Internet Explorer\iexplore.exe"
objShortcut.Arguments = "http://WebApp/index.aspx"
objShortcut.Save 
```

您必须使用 .lnk 作为文件扩展名，而不是 .url 因为 .Arguments 属性仅适用于 .lnk

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T14:40:04.787

这行得通吗？

```
oUrlLink.TargetPath = "C:\Program Files\Internet Explorer\iexplore.exe"
oUrlLink.Arguments = "http://WebApp/index.aspx"
oUrlLink.Save 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T14:40:56.267

将此用作目标路径

```
 "C:\Program Files\Internet Explorer\iexplore.exe http://WebApp/index.aspx" 

```

这个怎么样

```
 Target= "http://WebApp/index.aspx" 

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T14:41:02.223

在 VB 中转义引号 - 总是很痛苦。

`oUrlLink.TargetPath = """C:\Program Files\Internet Explorer\iexplore.exe"" http://WebApp/index.aspx"`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T14:41:15.453

你试过这个吗？

```
oUrlLink.TargetPath = chr(34) & "C:\Program Files\Internet Explorer\iexplore.exe" & _
                      chr(34) & " http://WebApp/index.aspx" 
```

更多关于引用的信息可以在[这里](http://www.microsoft.com/technet/scriptcenter/resources/qanda/aug04/hey0806.mspx)找到。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T14:45:57.813

这对我有用：

```
set WshShell = WScript.CreateObject("WScript.Shell")
strDesktop = WshShell.SpecialFolders("Desktop")
set oUrlLink = WshShell.CreateShortcut(strDesktop & "\WebApp.url")
oUrlLink.TargetPath = "C:\Program Files\Internet Explorer\iexplore.exe http://WebApp/index.aspx"
oUrlLink.Save 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-18T09:54:49.187

```
Set objShell = WScript.CreateObject("WScript.Shell" )
strDesktopFolder = objShell.SpecialFolders("Desktop") 
Set objShortCut = objShell.CreateShortcut(strDesktopFolder & "\test.lnk" ) 
objShortCut.TargetPath = "http://www.google.com/" 
objShortCut.Description = "Test Environment" 
objShortCut.Save 
```

* * *

以上对我来说很好，可以将快捷方式部署到桌面作为 GPO 的一部分。名称已更改以保护无辜者。

对我来说似乎有点清洁，但无论如何我都不是脚本大师。

# python - 有没有更好的方法从 Python 中的 Active Directory 域获取用户/组信息？

> ID：654520
> 
> 赞同：5
> 
> 时间：2009-03-17T14:39:46.987
> 
> 标签：python, winapi, active-directory, ldap, pywin32

对于我正在处理的 Django 应用程序，我希望允许由 Active Directory 组确定组成员身份。在浏览了 pywin32 文档一段时间后，我想出了这个：

```
>>> import win32net
>>> win32net.NetUserGetGroups('domain_name.com', 'username')
[(u'Domain Users', 7), ...] 
```

不过，在我弄清楚这一点之前，我花了一段时间谷歌搜索，而我发现的示例几乎完全使用 LDAP 来处理这类事情。有什么理由比这种方法更受欢迎吗？请记住几件事：

1.  我没有使用 Active Directory 来实际执行身份验证，只使用权限。身份验证由另一台服务器执行。
2.  虽然拥有一些跨平台功能会很好，但这可能几乎只在 Windows 上运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T15:27:17.527

AD 的 LDAP 界面有很多“怪癖”，使其使用起来比表面上看起来更难，而且在功能上往往明显落后。当我使用它时，我主要处理身份验证，但无论你在做什么，它可能都是一样的。必须以特定用户身份绑定只是为了执行普通 LDAP 服务器允许您以匿名身份执行的简单搜索，这有很多奇怪之处。

此外，至少在一年前，当我从事这项工作时，python-ldap 是唯一支持接近完整功能集的任何地方的 Python LDAP 实现，因为它建立在 OpenLDAP 之上，但是，OpenLDAP 很难在 Windows 上构建（以及一般情况下），因此大多数构建将缺少一个或多个功能。尽管您没有进行身份验证，但缺少 SASL/Kerberos 支持（在我使用它时缺少它）可能会使您的事情变得复杂。

如果你有一些可以工作的东西，并且只需要在 Windows 上运行它，我真的建议你坚持下去；通过 LDAP 使用 AD 可以变成一个大项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-02T15:59:21.690

```
import wmi

oWMI = wmi.WMI(namespace="directory\ldap")

ADUsers = oWMI.query("select ds_name from ds_user")

for user in ADUsers:
    print user.ds_name 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-07T23:27:43.113

查看[Tim Golden 的 Python 资料](http://timgolden.me.uk/python/active_directory.html)。

```
import active_directory
user = active_directory.find_user(user_name)
groups = user.memberOf 
```

# ruby-on-rails - Rails：导入数据的脚本

> ID：654524
> 
> 赞同：1
> 
> 时间：2009-03-17T14:40:21.883
> 
> 标签：ruby-on-rails, activerecord

我有几个脚本可以生成和收集大量数据，我需要这些数据来为我的数据库播种，并在未来向其中添加更多数据。将大量关系数据作为种子数据和在生产期间间歇性导入到 Rails 数据库的最佳方法是什么？

我还没有确定我的脚本的输出格式，但是数据的结构在很大程度上反映了我的 rails 模型并包含我希望导入保留的 has_many 关联。

我用谷歌搜索了一下，看到了 ar-extensions 和 seed_fu 以及使用固定装置的想法。

使用 ar 扩展，所有示例似乎都是简单的 csv 导入（可能来自似乎是其主要用例的表转储），没有提及处理关联或避免重复更新。就我而言，我的脚本中没有 id、外键或连接表，所以这似乎对我不起作用，除非我准备好自己处理这种复杂性。

使用seed_fu，它看起来可以处理数据创建的关系方面，但仍然需要我指定id（你怎么知道哪些id在生产中可用？）并将代码与数据混合。

Fixtures 也有相同的 id 问题，尽管现在它需要命名对象（我可能最终只是使用数字作为名称）而且我不确定如何避免意外重复记录。

或者我最好先将我的数据放入本地sqlite db，然后使用直接表转储技术？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:53:03.120

我以前用 CSV 文件做过这个。我有一个 cron 作业来收集数据并将其放入可访问的 CSV 文件中。然后我有一个查找 CSV 的 rake 任务（也在 cron 中，但在另一个盒子上），如果有的话，调用模型方法从 CSV 行中创建对象。

这些模型有一个`csv_create_or_update`采用 CSV 行的方法。这种技术回避了 id 问题，并且还允许对传入的数据运行（或不运行）验证。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:18:23.547

我最近收到了一个 Rails 应用程序，它需要一些导入的数据，所有这些都是在 rake 任务中处理的。所有数据都以 csv 格式文件的形式出现，并根据需要按类/模型等进行处理。这对我是系统新手来说效果相对较好，因为很容易看到数据的去向和应用方式。当您导入数据时，您可以检查 id 冲突/冲突并相应地处理它们。

# java - 在Java中实现进程之间的等待？

> ID：654525
> 
> 赞同：3
> 
> 时间：2009-03-17T14:40:54.487
> 
> 标签：java, process, exec, wait

我需要一些帮助来理解和实现我的应用程序中的各个进程之间的“等到进程完成”，这需要以*逐步的方式*进行。我的 java 文件运行一个批处理文件，然后运行一个脚本。在此结束时，我需要以连续方式（通过命令行）运行一系列命令。我在用着：

```
Runtime.getRuntime().exec("cmd /c start " + command) 
```

运行我的批处理文件和命令（不确定该信息是否相关）。现在发生的事情是，我的应用程序中需要发生的第二步是在第一步（运行运行脚本的批处理文件）完成之前执行的。在运行下一系列命令之前，我需要完成第一步。我真的希望我说得通！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T14:52:14.333

exec() 返回一个 Process 实例，您可以在其上执行 waitFor()。

但请注意：我认为“开始”实际上会产生一个单独的 Windows 进程，因此 waitFor() 可能会在命令完成之前返回。尝试从命令行中删除“开始”？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-10T16:31:51.437

简单的：

只需调用 Process 实例的方法 waitFor() 即可。它将停止线程，直到外部进程终止；

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T14:47:00.993

你能把这一系列命令放到它自己的批处理文件中吗？

否则，您可以使用[`ProcessBuilder`](http://java.sun.com/javase/6/docs/api/java/lang/ProcessBuilder.html)来获取一个[`Process`](http://java.sun.com/javase/6/docs/api/java/lang/Process.html)对象，并调用[`waitFor()`](http://java.sun.com/javase/6/docs/api/java/lang/Process.html#waitFor())它：

> 如有必要，使当前线程等待，直到此`Process`对象表示的进程终止。

**编辑：**实际上，[`exec()`](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#exec(java.lang.String))返回 a `Process`，所以你根本不需要打扰这个`ProcessBuilder`部分。

# visual-studio-2005 - 如何让我的 Windows 服务显示在系统托盘中？

> ID：654534
> 
> 赞同：7
> 
> 时间：2009-03-17T14:43:30.673
> 
> 标签：visual-studio-2005, windows-services

我有一个在 PC 启动时在后台运行的 Windows 服务。我想在用户登录后在系统托盘上显示一个图标以允许配置，但找不到如何执行此操作。

是否有我应该查找的事件告诉我用户已登录？

据我了解，Windows 服务不能有 UI，所以我需要启动一个应用程序来显示系统托盘图标吗？如何将配置更新传递给我的服务。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-17T14:53:22.227

您将需要一个单独的“代理”应用程序。Windows 服务是全局的，在系统级别运行。系统上可以同时运行多个桌面，因此虽然有多种方法可以让服务与桌面层进行交互，但以与应用程序相同的方式与“用户桌面”进行交互绝非易事已经绑定到特定的登录/桌面环境。

将服务隧道连接到桌面环境也存在安全风险（它打开了通往系统帐户的路径，除非服务在更受限制的帐户上运行），这就是默认情况下禁用与桌面交互的原因。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T14:48:01.240

您将需要一个单独的应用程序来显示托盘图标。您可以通过让服务托管 WCF 服务的 WCF 或通过[ServiceController](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.aspx)与您的服务进行通信。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T14:45:41.853

我将创建第二个应用程序，该应用程序在用户登录时运行并显示在系统托盘中。

您可以打开 Windows 服务的远程处理，并通过系统托盘中应用程序的公开方法传递配置更新。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-22T19:02:16.970

实际上，我认为您不能在系统托盘中显示服务。执行此操作的应用程序始终使用代理或其他管理工具。

大多数时候，托盘中运行的应用程序是一个非常小的应用程序，可以访问服务的设置。

配置选项可以存储在注册表、ini 文件或任何其他存储选项中。配置更改后，您需要做的就是确保重新启动服务，以便它可以重新加载新设置。

# jquery - jQuery：如何处理 sortable('serialize') 返回的列表？

> ID：654535
> 
> 赞同：15
> 
> 时间：2009-03-17T14:43:36.337
> 
> 标签：jquery, ajax, jquery-ui-sortable, serialization

使用 jQuery，我正在使用“序列化”检索可排序列表的位置，如下所示：

`var order = $('ul').sortable('serialize');`

变量 'order' 然后收到以下信息：

`id[]=2&id[]=3&id[]=1&id[]=4&id[]=5`

现在如何在 ajax 调用中使用这些数据？

这就是我打算这样做的方式，但它很难看，我无法更改参数名称“id”：

`$.post('ajax.php?'+order,{action:'updateOrder'});`

也许我需要反序列化，然后将变量“order”内爆并将其分配给一个参数？

* * *

我的服务器端代码没有问题，但 jQuery 客户端站点代码有问题。问题是，我应该将“订单”变量放在脚本中的什么位置？

在我给出的示例中，我将其添加为查询字符串：

`'ajax.php?'+order`

但我想将它作为参数传递，就像动作参数一样。以下不起作用，它返回语法错误：

`$.post('ajax.php?'+order,{action:'updateOrder',order});`

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-19T23:43:23.903

找到了！我需要添加将`key:'string'`变量名称更改为“字符串”而不是“id”的选项。

```
var order = $('#projects ul').sortable('serialize',{key:'string'});

$.post('ajax.php',order+'&action=updateOrder'); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-05-19T20:48:26.543

我认为最好的方法是根本不使用`sortable('serialize')`，而是使用 jQuery 简单地遍历排序的 id，如下所示：

```
order = [];
$('ul').children('li').each(function(idx, elm) {
  order.push(elm.id.split('_')[1])
});                                     
$.get('ajax.php', {action: 'updateOrder', 'order[]': order}); 
```

与将序列化的可排序对象显式附加到 URL（或参数）相比，这具有一个优势，因为`order[]`如果列表中没有参数，则它根本不包含参数`li`。（当我遇到这个问题时，我正在使用`sortable(connectWith: 'ul')`，所以用户完全有可能`li`从一个列表中拖动所有内容）。相反，附加序列化的可排序对象会留下不需要的“&”。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-17T14:58:11.747

假设您正在订购新闻项目，并且您的页面将其发送到“?id[]=2&id[]=3&id[]=1&id[]=4&id[]=5”您的 php 代码。

```
$_POST['id'] # would be [2,3,1,4,5]

// Now we need to update the position field of these items    

foreach($_POST['id'] as $i=>$id ):
   // For our first record, $i is 0, and $id is 2.

   $post = Post::get($id); # Do you own database access here
   $post->position = $i; # Set the position to its location in the array
   $post->save(); # Save the record
endforeach 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-03-02T19:54:08.373

```
var order = $('#projects ul').sortable('toArray'}); 
```

这也可能有效；）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-06-22T16:41:10.313

最好的方法是知道使用 var`order = $('ul').sortable('serialize');`功能，如以下链接所示：

[https://web.archive.org/web/20160701121834/http://blog.arnaud-k.fr/2010/09/29/tutorial-jquery-trier-une-liste-en-dragndrop-avec-jqueryui-可排序/](https://web.archive.org/web/20160701121834/http://blog.arnaud-k.fr/2010/09/29/tutorial-jquery-trier-une-liste-en-dragndrop-avec-jqueryui-sortable/)

在 php 文件中获取有序列表数据所需的只是代码：

```
foreach( $_POST['id'] as $order => $order_nb )
{
    ...
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-04-12T17:27:59.267

关于“关键”参数，我使用方括号来获取数组。

```
var data = $('#cms-form').serialize();
data += '&' + $('.ui-tabs-nav').sortable('serialize', {key:'nav_order[]'}); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-12-30T06:10:03.633

解决方案

我通过操作 sortable('serialize') 创建了自己的解决方案。我通过使用 jquery 函数对其进行了简化，然后将其发布到 php url 以更新数据库中列表的顺序。看看我的代码。

```
$( "#covercast_sortable" ).sortable({
        update : function () { 
            var order = $('#covercast_sortable').sortable('serialize',{key:'string'}); 
            // order var gives something like string=3&string=2&string=1
            var ar = order.split('&');
            var i = 0;
            var str = '';
            for(i;i<ar.length;i++){
                if(str != "") { str += ','; }
                // slice is used to remove 'sting=' from every value of var ar
                str += ar[i].slice(7);
            }
            // here value of str is 3,2,1 with respect to order variable
            $.ajax({
                type: "POST",
                url: 'myURL.php',
                data: 'order=' + str,
                cache: false,
                success: function (data) {
                    console.log(data);
                }
            });
        }
    }); 
```

干杯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-11-05T18:56:28.470

如果数据是

`$data = 'album[]=stat&sort[]=157204&sort[]=157205&sort[]=157206&sort[]=157208&sort[]=157207&sort[]=157209&sort[]=157210&sort[]=157211&sort[]=157212&sort[]=157213';`

并且您想在 php 中
使用[parse_str()排序为数组](http://php.net/manual/en/function.parse-str.php)
`parse_str($data, $output);`
`print_r($output);`

**输出：** 数组（[专辑] => 数组（[0] => stat）

```
[sort] => Array
    (
        [0] => 157204
        [1] => 157205
        [2] => 157206
        [3] => 157208
        [4] => 157207
        [5] => 157209
        [6] => 157210
        [7] => 157211
        [8] => 157212
        [9] => 157213
    ) 
```

)

# .net - .NET 应用程序的 Outlook 导航栏控件

> ID：654536
> 
> 赞同：2
> 
> 时间：2009-03-17T14:43:40.173
> 
> 标签：.net, controls

是否有类似 Outlook Navigation 控件的开源或免费控件？我想在我的 .NET 应用程序中添加一个。

**更新 1：** 我没有使用 WPF。我只需要控制 Windows 窗体，我使用的是 .NET Framework 2.0

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T15:00:46.497

我假设您正在寻找 WinForms 控件。这是我过去检查过的一对。

*   [XP 和 Vista 风格的丰富 OutlookBar](http://www.codeproject.com/KB/vb/OutlookBar.aspx)
*   [OutlookBar：简化的 Outlook 样式侧边栏控件](http://www.codeproject.com/KB/menus/OutlookBar.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T14:56:44.637

对于 WPF，您可以使用潜水元件的 SandShell 控件：

[用于 WPF 的 SandShell 概述](http://www.divelements.co.uk/net/controls/sandshellwpf/)

*编辑：这不是免费的，没有仔细阅读这个问题。*

马蒂亚斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T14:58:18.750

如果您正在寻找旧的 < 2007 版本，有[几个免费提供。](http://www.google.co.uk/search?q=outlook+navigation+control)

如果您想要 2007 功能区控件，可以使用[WPF Preview](http://www.codeplex.com/wpf/Wiki/View.aspx?title=WPF%20Ribbon%20Preview)或此[winforms 版本](http://www.codeproject.com/KB/toolbars/WinFormsRibbon.aspx)。

# javascript - 确认 html 表单字段的最佳方法是什么？

> ID：654543
> 
> 赞同：0
> 
> 时间：2009-03-17T14:44:43.883
> 
> 标签：javascript, validation

很多时候，您会收到一个需要输入电子邮件地址（或其他表单字段）两次的表单，以确认您第一次输入正确。某些表单禁用浏览器中的复制和粘贴操作（通过 javascript），以强制用户再次键入电子邮件地址。

我个人觉得这很烦人。你怎么认为？还有其他选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T14:51:26.257

如果你真的想检查电子邮件地址，你可以实现一个确认电子邮件地址功能，它会向提供的电子邮件地址发送一封电子邮件。该电子邮件可以包含一个链接，该链接允许用户确认他/她的电子邮件地址。

对于像密码字段这样的模糊字段，最好实现双重输入字段，以防用户输入错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T14:47:10.557

我也觉得这很烦人，因为在许多情况下，初始输入是通过我知道是正确的自动填充完成的。

请注意，这应该是一个社区维基！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T14:47:48.543

我认为这取决于网站，如果它类似于商业网站，我支持禁用复制和粘贴，因为如果地址输入错误，可能会给网站和客户带来痛苦。每个人都更容易在过程中只给客户带来 2 秒的不便，而不必稍后再处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T14:47:59.757

我个人不同意禁用复制和粘贴功能。如果用户两次输入错误的电子邮件并且相同（最坏的情况），那真的是他的错。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T14:54:49.943

你应该相信用户。如果他打错了地址，就接受它。

首先，如果您通过发送电子邮件确认注册，在“现在等待电子邮件并单击那里的确认链接”屏幕上，您仍然可以显示发送电子邮件的地址。它后面可以是一个链接“糟糕，我的电子邮件地址输入错误”，让您更正自己。

其次，如果您使用电子邮件进行通知，用户将不会收到它们，并且好奇地，他会去他/她的个人资料设置以检查通知参数。您只需确保“电子邮件”输入位于“获取通知”复选框旁边。

# c# - 为什么通过 google api 进行的 google 搜索会返回不同的结果到网页中的搜索？

> ID：654546
> 
> 赞同：10
> 
> 时间：2009-03-17T14:45:14.507
> 
> 标签：c#, search-engine

我认为这个问题几乎总结了我的查询。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T14:48:17.090

当您在登录 GMail 或其他 Google 服务时使用 Google 网页进行搜索时，它会使用有关您的浏览历史记录的信息来修改结果。它不能用 API 做到这一点，因为它假设你是为自己以外的人做的。

此外，正如[@Walden](https://stackoverflow.com/users/20661/walden)在他的回答中提到的那样，您可能会针对这两个查询访问不同的服务器，并且 Google 在服务器之间进行“缓慢同步”，因此它们可能并不都有最新的搜索数据库或最新版本的页面排名代码。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-17T14:49:24.140

对于同一查询，您的 Google 网络搜索可能会返回与我的 Google 网络搜索不同的结果。谷歌不断更新其搜索程序，并且经常会在不同的时间在不同的数据中心推出更新，因此每个数据中心，甚至数据中心中的每个集群都可能返回不同的结果。

因此，来自 API 的结果可能来自与您的 Web 请求不同的代码库（代码库版本）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T14:48:52.440

一个原因可能是不同的 Google 本地人。查询 Google.com 提供的结果与针对同一关键字的 Google.de 不同。

# c# - 带有数据绑定的 C#/WPF 中的 OK/Cancel 行为对话框

> ID：654552
> 
> 赞同：2
> 
> 时间：2009-03-17T14:47:26.360
> 
> 标签：c#, wpf, data-binding

在我的 App 类中，我有一个对象集合，如下所示：（集合在 App 类中，因为我需要在不同的窗口等应用程序范围内访问它）

```
public partial class App : Application
{
    public ObservableCollection<Person> Persons { get; set; }

    public App()
    {
        Persons = new ObservableCollection<Person>();
        Persons.Add(new Person() { Name = "Tim", Age = 20 });
        Persons.Add(new Person() { Name = "Sarah", Age = 30 });
    }
}

public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
} 
```

在应用程序的主窗口中，有一个`ComboBox`与 Persons 集合的绑定：

```
<ComboBox ItemsSource="{Binding Source={x:Static Application.Current}, Path=Persons}" DisplayMemberPath="Name"/> 
```

现在我想创建一个对话框，用户可以在其中添加/删除/编辑具有众所周知的确定/取消按钮行为的人员。这能轻易倒下吗？一件重要的事情是，`ComboBox`用户在按下 OK 之前所做的更改不得影响 中的项目。

提前致谢！

编辑：我想我应该指出我不想编辑对话框中的特定人员，而是整个人员列表。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T17:02:37.343

添加和删​​除很简单，因为它只会在您单击“确定”时发生。

对于编辑，您有更多选择：

1.  制作`Person`工具`IClonable`，传入您正在编辑的副本`Person`以绑定到编辑表单上，然后在完成后切换出`Person`您`Persons`收藏中的相应内容。这使得编辑表单变得不那么复杂，并且更 WPFey。

2.  不要在编辑表单上使用绑定，只需在`Person`完成后在控件和传入的控件之间进行手动同步。最少的WPFey。

3.  1 和 2 的组合 - 编辑表单的属性反映其控件的属性`Person`并绑定到其控件，然后`Person`在完成后将其与表单的属性同步。

# linq - linq to sql批量删除

> ID：654561
> 
> 赞同：5
> 
> 时间：2009-03-17T14:49:04.047
> 
> 标签：linq, linq-to-sql

我有以下数据库： `Posts`它有一个`Id`，`Tags`也有`Id`，和`TagsToPosts`表，它有`TagsToPosts.PostId => Posts.Id`和`TagsToPosts.TagId => Tags.Id`FK 关系。我需要通过`TagsToPosts`以下方式删除多个项目。我`IList<Tag> newTags`通过解析字符串来创建。每个标签都有它的名字。我想删除所有`TagsToPosts`指向单个帖子（`TagsToPosts.PostId == mypostid`）的项目，以及指向`Tag`不在我的`newTags`.

例如，我有一篇带有`Id = 1`三个标签的帖子：`1 => "tag1", 2 => "tag2", 3 => "tag3"`和 ManyToMany 关系表`TagsToPosts`：`1 => 1, 1 => 2, 1 => 3` 所以所有三个标签都链接到我的帖子。之后，我将`IList<Tag> newList = new List<Tag>()`通过解析字符串来创建一个新的。`newList`包含：`0 => "tag1", 0 => "tag2"`。现在我想从表 TagsToPosts 中删除第三个关系，因为我的新标签列表不包含名称为“tag3”的标签。所以我需要找到不同之处。我知道我可以使用 JOIN 找到类似的项目，但如何找到差异？

我希望这发生在一个数据库查询中，而不需要遍历每个项目来删除它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-10-09T06:21:58.277

你不能用 LINQ-to-SQL 做到这一点。

LINQ-to-SQL 不适合批量操作——它不能进行批量插入，不能批量更新，也不能批量删除。您集合中的每个对象都被单独处理。您可以在一个事务中完成所有操作，但对于每条记录总会有一个查询。

[MSDN](http://social.msdn.microsoft.com/Forums/en-US/linqprojectgeneral/thread/99054861-2490-4bbb-aa37-f92e68c85020)

更好的选择是编写一个存储过程来执行您想要的操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T15:37:25.317

你看过 Linq except 运算符吗？

例如：

```
var toDelete = (from t in TagsToPost
                select t).Except(from nt in newList
                                 select nt, new TagComparer());

class TagComparer: IEqualityComparer<TagsToPosts>
{
    public bool Equals(TagsToPosts x, TagsToPosts y)
    {
         return x.Tag.Equals(y.Tag, CompareOptions.Ordinal);
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-03T18:01:34.303

PLINQO 支持批量删除操作，无需先检索实体。

var delete = from t in TagsToPost select t).Except(from nt in newList select nt, new TagComparer())

context.Tags.Delete（删除）；

[http://plinqo.com](http://plinqo.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-06-18T20:46:45.503

我的解决方案可让您进行由类字段确定的删除：

```
public static void DeleteByPropertyList<T, R>(List<T> listToDelete, Expression<Func<T, R>> getField, DataContext context) where T : class {
    List<List<string>> partitionedDeletes = listToDelete.Select(d => string.Format("'{0}'", getField.Compile()(d).ToString())).ToList().Partition<string>(2000).ToList();
    Func<Expression<Func<T, R>>, string> GetFieldName = propertyLambda => ((MemberExpression)propertyLambda.Body).Member.Name;
    MetaTable metaTable = context.Mapping.GetTable(typeof(T));
    string tableName = string.Format("{0}.{1}", metaTable.Model.DatabaseName, metaTable.TableName);
    foreach (List<string> partitionDelete in partitionedDeletes) {
        string statement = "delete from {0} where {1} in ({2})";
        statement = string.Format(statement, tableName, GetFieldName(getField), string.Join(",", partitionDelete));
        context.ExecuteCommand(statement);
    }
}

public static IEnumerable<List<T>> Partition<T>(this IList<T> source, int size) {
    for (int i = 0; i < Math.Ceiling(source.Count / (double)size); i++)
    yield return new List<T>(source.Skip(size * i).Take(size));
} 
```

用法：

```
 List<OrderItem> deletions = new List<OrderItem>();
    // populate deletions
    LinqToSqlHelper.DeleteByPropertyList<OrderItem, long>(deletions, oi => oi.OrderItemId, context); 
```

它只适用于单个字段，但它可以很容易地扩展到复合字段。

# xml - “xmlns”属性使我的 XSLT 返回空白值

> ID：654565
> 
> 赞同：0
> 
> 时间：2009-03-17T14:50:07.163
> 
> 标签：xml, xslt, xslt-1.0

我有一个试图通过 XSL 文件转换的 XML 文件。一旦我向我的 XSL 的根元素添加了一个非空白 xmlns 属性，转换只会给我带来所有内容的空白数据。如果我删除或清空 xmlns 属性，我会得到我所期望的。

谁能告诉我为什么会这样，所以我可以阻止它！

这是我的一些 XSL（省略了一些部分并替换为 ...）：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ... >

  <xsl:import href="html_commonstructures.xsl"/>
  <xsl:output method="html"/>

  <xsl:template match="/">
    <div>
    <xsl:call-template name="ServiceStructure">
      <xsl:with-param name="structure" select="ServiceDescription" />
    </xsl:call-template>
    </div>
  </xsl:template>

  <xsl:template name="ServiceStructure">
    <xsl:param name="structure"/>
    <h3>
      <xsl:value-of select="$structure/DC.Title" /> (<xsl:value-of select="$structure/DC.Identifier" />)
    </h3>
    <!-- And so on -->
  </xsl:template>
</xsl:stylesheet> 
```

*** 编辑 *** 这是 html_commonstructures 中的一个片段：

```
<?xml version='1.0' encoding='UTF-8' ?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:rxr="http://ilrt.org/discovery/2004/03/rxr/" xmlns:esd="http://www.esd.org.uk/standards"
    xmlns:core="http://www.govtalk.gov.uk/core" xmlns:n2="http://www.govtalk.gov.uk/metadata/egms"
    xmlns:apd="http://www.govtalk.gov.uk/people/AddressAndPersonalDetails"
    xmlns:con="http://www.govtalk.gov.uk/people/ContactTypes"
    xmlns:bs7666="http://www.govtalk.gov.uk/people/bs7666">

  <!-- A template for the ControlledListStructures -->
  <xsl:template name="ControlledListStructure">
    <xsl:param name="structure"/>

    <p class="controlledlist">
      <xsl:value-of select="$structure/text()" />
      <xsl:if test="$structure/@Id | $structure/@ConceptId | $structure/@ItemName | $structure/@ListName">
        <span class="metainfo">[
          <xsl:if test="$structure/@Id">
            ID: <xsl:value-of select="$structure/@Id" />;
          </xsl:if>
          <xsl:if test="$structure/@ConceptId">
            Concept ID: <xsl:value-of select="$structure/@ConceptId" />;
          </xsl:if> 
          <xsl:if test="$structure/@ItemName">
            Item Name: <xsl:value-of select="$structure/@ItemName" />;
          </xsl:if>
          <xsl:if test="$structure/@ListName">
            List Name: <xsl:value-of select="$structure/@ListName" />
          </xsl:if>
          ]
        </span>
      </xsl:if>
    </p>
  </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T14:57:49.283

为什么首先添加 xmlns 命名空间定义？

通过添加 xmlns 属性，您可以更改 XSLT 的默认名称空间。然后，您必须调整所有表达式以使用输入文档的命名空间，即使用自由前缀添加输入文档的命名空间定义，并将表达式“ServiceDesription”替换为“myPrefix:ServiveDescription”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T14:58:41.153

如果您在 XML 文档上有一个名称空间，那么您需要在 XSLT 上有相同的名称空间。

# ajax - 如何以 django 形式处理复杂的图形 UI 元素？

> ID：654567
> 
> 赞同：0
> 
> 时间：2009-03-17T14:51:03.603
> 
> 标签：ajax, django, django-forms

我有一些与标准 django 表单输入字段一起出现的复杂 GUI 元素（例如可以突出显示多天的自定义日历）。我想处理来自这些复杂表单的数据 I/O 以及 Django 表单。

以前，在保存或呈现 Django 表单后，我会使用 AJAX 请求来处理我的 HTML 表单上的这些自定义 GUI 元素，但这会导致大量问题和自定义 AJAX 编码。在 Django 表单中处理复杂交互小部件的好方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T14:56:36.447

不确定我是否完全理解，但您可以通过 javascript 将 UI 的值保存到表单上的隐藏元素中。这可以在他们选择 UI 中的值或提交表单时完成。假设 JQuery 在提交数据发送之前使用 submit() 保存的伪代码：

```
$('#myForm').submit(function(){
  // get the value of your UI
  var calendarValue = calendarWidget.getValue()

  // #calendarData is the hidden field
  $('#calendarData').val(calendarValue)
}) 
```

这显然需要 JS，但使用 UI 元素也是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T15:00:32.897

您的问题非常含糊，因此我建议您阅读有关[编写自定义字段](http://docs.djangoproject.com/en/dev/howto/custom-model-fields/)的 Django 文档，希望这可以帮助您入门。您可能还想研究编写自定义小部件。不幸的是，文档有点缺乏，但谷歌搜索带来了几篇有用的博客文章，包括[这篇](http://jannisleidel.com/2008/11/wysiwym-editor-widget-django-admin-interface/)文章。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:13:04.690

根据您将 Django Form 子类输出到 HTML 页面的方式，您有三个选项。

第一个根本不涉及形式。任何 html 表单输入都将在 request.POST 中结束，因此您可以在那里访问它们。没错，它们不会绑定到您的 Form 子类，因此您必须使用自定义表单构造函数手动注入该值，或者在使用 request.POST 实例化它之后在您的 Form 对象上设置一些属性。这可能是最不理想的选择，但我会提到它，以防您的用例真的不支持其他任何东西。

如果您在 HTML 中手动输出表单字段，则第二个是一个选项（即：使用而`{{ myform.field }}`不仅仅是`{{ myform }}`需要一个）。使用正确的名称和 ID 将这个隐藏字段添加到 Form 子类本身，确保它有一个隐藏的 django 表单小部件。如有必要，按照 Rob 的建议使用 javascript 填充隐藏字段。当表单发布后，它将像往常一样绑定到您的表单子类，因为这一次，您的表单子类上有一个具有该名称的字段。机器`clean()`将正常工作。

第三个也是最好的选择是编写一个自定义的 django 字段；安德鲁的帖子有链接。Django 字段具有指定`js`和`css`要求的能力，因此您可以为使用日历小部件的任何页面自动封装这些依赖项。

# browser - 覆盖 Web 浏览器中的右键单击上下文菜单 - 优点和缺点

> ID：654568
> 
> 赞同：23
> 
> 时间：2009-03-17T14:51:21.683
> 
> 标签：browser, contextmenu

我们正在编写一个 Web 应用程序（不仅仅是一个网站，而是一个真正的应用程序），并针对下一个版本进行以下讨论：

*   我们的 UI 设计师想要替换浏览器的右键单击上下文菜单（在适当的地方显示我们自己的菜单，或者根本不显示菜单），因为他希望 Web 应用程序更像我们的（现有）Windows 应用程序
*   我们的开发人员（和我）强烈反对，因为这是不好的做法，而且只是您在 Web 应用程序中不做的事情

因此，我正在寻找“更可靠”的论点——比如最佳实践指南、来自信誉良好的来源的任何陈述、编码论点等——以了解这个问题的利弊，我希望可以用它来一劳永逸地解决它...

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-17T14:59:55.423

无论如何，你不能可靠地做到这一点。在 Firefox 中，转到“设置”、“内容”、“JavaScript/高级”（我猜是字幕，没有英文 Firefox (;) 来覆盖上下文菜单行为，然后砰，您的应用程序不再工作了。我的网上银行应用程序在他们的旧版本，所以我不能用鼠标复制和粘贴。我讨厌它，所以我在 Firefox 中启用了保护，它起作用了。有点。他们的新版本不再做这种坏事了。

相反，在需要上下文菜单的地方使用一个小的下拉箭头，可以单击或将鼠标悬停在上面以显示菜单。JetBrains 的[TeamCity](http://www.jetbrains.com/teamcity) Web 应用程序在这方面做得很好。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T15:05:24.647

如果你的应用要在内网运行，也许UI设计器的参数是有效的：只要应用的所有用户都是众所周知的，并且你想模拟一些Windows应用，我认为限制右键单击是可以的或任何其他输入，因为这只是此应用程序的要求，就像对任何其他应用程序一样。

但是如果你的应用程序要在互联网上运行，禁用或替换右键单击是一个非常糟糕的主意，这些只是我提醒的一些论点：

*   首先，改变用户界面的行为是激进和烦人的——没有人愿意为了访问您的网站而习惯“新控件”，而且通常人们讨厌离开他们的舒适区域。我的意思是，我知道我的右键单击做什么，我希望它总是做同样的事情。

*   人们可以理解 Windows 应用程序和 Web 应用程序之间的区别，因此无需“模仿 Windows 应用程序行为”。

*   不是每个人都使用 Windows :-)

*   此外，这是无效的，因为有几种方法可以覆盖此行为，例如 Firefox 中的设置，甚至是禁用特定 javascript 指令的插件，例如[this one](https://addons.mozilla.org/en-US/firefox/addon/1154)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-17T21:15:16.530

根据您的受众，您很有可能您的用户甚至不知道有一个右键菜单。所以请不要把它作为唯一的选择

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T14:58:31.073

我个人认为您应该不理会浏览器的默认行为……用户已经习惯了它们，因此无需让他们习惯于**您**的做事方式。

但是，如果您正在构建内部网（而不是公共站点），那么我会尽可能地进行调整以提高可用性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T21:13:01.840

我会使用的一个论点（在引号中以产生戏剧性的效果）：

> 与其他畅通无阻的 Web 界面相比，缺乏一致性和功能减少会导致**用户失去信心**——至少可以说这是不可取的。

当然，如果许多或大多数 Web 应用程序用户已经熟悉或经常使用 Windows 应用程序，那么 UI 设计师可能走在正确的轨道上，并且与 Windows 应用程序的**一致性**可能是赢家。

也就是说，在我看来，很难在网页中制作直观的自定义上下文菜单，虽然有些用户可能会喜欢它，但我猜大多数人可能永远不会使用它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T21:24:54.523

> 因为他希望 Web 应用程序更像我们的（现有）Windows 应用程序

我认为在 Windows 应用程序中单击鼠标右键是个坏主意。

在网络浏览器中，这是一场 UI 灾难，因为没有人会期待它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T15:00:51.007

我认为这取决于您是否将上下文菜单视为浏览器 chrome 的一部分。如果你这样做了（我认为这是这个观点），那么它应该是偏离目标的，但否则它是为你的应用程序添加一些可用性的好地方。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T15:02:42.343

从 Web 应用程序替换 GUI 特定区域的浏览器右键单击上下文菜单可能非常有用。这样做只是为了禁用上下文菜单会惹恼您的用户，他们可能会试图找到解决方法。此外，从应用程序的整个区域中删除或替换浏览器右键单击上下文菜单通常会很烦人，并且会使调试变得更加困难。

不幸的是，我不能提供任何更可靠的论据，而且我并没有完全支持任何一方，但我想我会分享我作为 Web 应用程序开发人员和 Web 用户的经验。

# asp.net - 在 asp.net 应用程序中管理与数据库的连接

> ID：654571
> 
> 赞同：5
> 
> 时间：2009-03-17T14:51:35.757
> 
> 标签：asp.net, vb.net, architecture, connection-pooling

我想知道，在 asp.net 中管理与数据库的连接的最佳方法是什么。

我的应用程序是使用 N 层架构构建的。DAL 由带有方法的静态类组成，例如

```
Public Shared Sub Delete( _
    ByVal connection As MyConnectionClass, _
    ByVal contact_id As Integer, _
    ByVal contact_timestamp As Date _
)

    With connection.ProcParams
        .Add(New StoredProcParam("p_contact_id", contact_id, OracleDbType.Int32))
        .Add(New StoredProcParam("p_contact_timestamp", contact_timestamp, OracleDbType.Date))
    End With

    connection.Execute("PKG_DATA_ACCESS.DeleteContact")

End Sub 
```

这里要注意的一点是，我将连接从 BLL 传递到 DAL。

这是我考虑过的几点，但对我来说似乎都不合适，所以我只是寻求建议。

我是否应该在 MasterPage 中创建连接，将其存储在一个对象中，然后在创建它们时将其传递给我的业务对象（我试图避免的事情）

我是否应该使用静态类创建连接并在其上调用 CreateConnection 之类的方法，从我的业务对象的构造函数（我想要的东西，但我不想每个对象都有一个连接，我想要它为我的对象的所有实例共享，但由于 asp.net 是多线程的，静态类对存储连接没有意义）

理想情况下，该解决方案也应该在 Windows 窗体环境中运行良好（因此在会话中没有存储连接，并在当前上下文中使用类中的静态方法检索它）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T14:58:17.627

根本不要尝试保持连接。在您使用它的每个范围内实例化它。.Net 将为您管理一个连接池，无论是在 Windows 窗体中还是在 asp.net 中。

试图在会话对象或母版页中保持连接实际上会损害性能，更不用说引入其他问题了。

来自 BC 的评论：

连接字符串必须是相同的字符串才能在同一个池中结束。

# svn - 如何使用 maven 从 subversion 获取修订号？

> ID：654572
> 
> 赞同：35
> 
> 时间：2009-03-17T14:51:40.123
> 
> 标签：svn, deployment, maven-2, version-control

我想将修订号放在 webapp 的主页上，我该如何使用 maven 来做到这一点？

PS它的两部分问题，如何获取修订号以及如何将其写入项目中的选定文件。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-26T05:14:55.023

maven 内部版本号插件是要走的路。如何使用它的示例如下：

[http://www.mojohaus.org/buildnumber-maven-plugin/usage.html](http://www.mojohaus.org/buildnumber-maven-plugin/usage.html)

您可以将它与 maven jar 插件一起使用，以将 SVN 提交号打印到清单中。

这是一个比使用包含 SVN 提交号的文件更好的解决方案，因为这增加了比实际需要的更多的移动部分。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-11-19T23:30:19.173

如果您使用的是 subversion，您可以使用此插件使 SVN 修订号可用作 maven 属性

[http://code.google.com/p/maven-svn-revision-number-plugin/](http://code.google.com/p/maven-svn-revision-number-plugin/)

我将它与 jar 插件结合起来，为我们的 jar 和 war 的 MANIFEST.MF 文件添加 SVN 修订。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-25T20:31:38.040

如果您有 svn 命令行应用程序，您可以使用以下代码 - 我们在项目中使用它（略有改动）

```
<build>
  <plugins>
    <plugin>
      <artifactId>maven-antrun-plugin</artifactId>
      <executions>
        <execution>
          <phase>generate-resources</phase>
          <goals>
            <goal>run</goal>
          </goals>
          <configuration>
            <tasks>
              <mkdir dir="${project.build.directory}/generated-web-resources/svn"/>
              <exec dir="${basedir}" executable="svn"
                  failifexecutionfails="false"
                  output="${project.build.directory}/generated-web-resources/svn/svnver.jsp">
                <arg line="info"/>
              </exec>
            </tasks>
          </configuration>
        </execution>
      </executions>
    </plugin>
    <plugin>
      <artifactId>maven-war-plugin</artifactId>
      <configuration>
        <webResources>
          <resource>
            <directory>${project.build.directory}/generated-web-resources/svn</directory>
          </resource>
        </webResources>
        <warSourceExcludes>**/_svn/**</warSourceExcludes>
      </configuration>
    </plugin>
  </plugins>
</build> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T15:17:14.273

您不说您使用的是什么平台，请原谅我对maven不熟悉。我假设它可以调用外部程序，并且你知道如何让它做到这一点。

如果在 Unix 平台上，您应该使用 program svnversion 命令，并将其输出（即指定的工作路径的版本号）通过管道传输到一个文件，然后您可以将其合并到您认为合适的网页中。

```
svnversion --help 
```

详细显示了它可以做什么。

如果是 Windows，并且您正在使用 TortoiseSVN 客户端，那么有一个出色的 Windows 命令行程序与它捆绑在一起，称为 SubWCRev。该实用程序将扩展您提供的文本文件中的宏，其中包含您正在使用的 svn 存储库的各种详细信息 - 您可以控制输出的格式。都非常方便。帮助文件在这里：[http ://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-subwcrev.html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-subwcrev.html)

# python - 在 ModelForm 中的多个表单字段上拆分 ManyToManyField

> ID：654576
> 
> 赞同：1
> 
> 时间：2009-03-17T14:52:53.570
> 
> 标签：python, django, django-forms, modelform

所以我有一个带有 ManyToManyField 的模型，称为锦标赛。我有一个带有两个锦标赛字段的 ModelForm：

```
pay_tourns = forms.ModelMultipleChoiceField(
                        queryset=Tourn.objects.all().active().pay_tourns(),
                        widget=forms.CheckboxSelectMultiple())
rep_tourns = forms.ModelMultipleChoiceField(
                        queryset=Tourn.objects.all().active().rep_tourns(),
                        widget=forms.CheckboxSelectMultiple()) 
```

all() 之后的方法来自子类 QuerySet。当我在视图中保存表单时，我会这样做：

```
post.tournaments = (post_form.cleaned_data.get('pay_tourns')
                                + post_form.cleaned_data.get('rep_tourns')) 
```

无论如何，这一切都很好。我不知道如何在加载现有帖子时填写这些表单字段。也就是说，当我将 instance=post 传递给表单时。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:27:47.223

您可以对 ModelForm 执行以下操作：

```
def __init__(self, *args, **kwargs):
    super(MyForm, self).__init__(*args, **kwargs)

    instance = kwargs.get('instance')
    if instance:
        self.fields['pay_tourns'].queryset.filter(post=instance)
        self.fields['rep_tourns'].queryset.filter(post=instance) 
```

我不明白为什么那行不通，但是我要对其进行测试以确保...

**编辑：**经过测试，它可以工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:37:23.653

Paolo Bergantino 走在了正确的轨道上，并帮助我找到了它。这是解决方案：

```
def __init__(self, *args, **kwargs):
    super(MyForm, self).__init__(*args, **kwargs)

    instance = kwargs.get('instance')
    if instance:
        self.fields['pay_tourns'].initial = [ o.id for o in instance.tournaments.all().active().pay_tourns()]
        self.fields['rep_tourns'].initial = [ o.id for o in instance.tournaments.all().active().rep_tourns()] 
```

# mysql - mysql：获取数据库中具有名为 xyz 的列的所有表

> ID：654585
> 
> 赞同：2
> 
> 时间：2009-03-17T14:55:09.727
> 
> 标签：mysql

mysql：获取数据库中具有名为 xyz 的列的所有表

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T15:02:02.033

SQL Server 和 MySql 都有 Information_Schema.Columns 表： [http ://dev.mysql.com/doc/refman/5.1/en/columns-table.html](http://dev.mysql.com/doc/refman/5.1/en/columns-table.html)

```
select c.table_name from 
information_schema.columns c 
where c.column_name = 'xyz' 
```

# oop - DDD：建模两个根之间的 M:N 关系，其中关系本身带有语义

> ID：654586
> 
> 赞同：2
> 
> 时间：2009-03-17T14:55:26.307
> 
> 标签：oop, architecture, domain-driven-design

**更新**已编辑以反映下面 Chris Holmes 要求的澄清。最初我将终端称为站点，但将其更改为更好地反映我的实际域。

从本质上讲，我认为这是一个关于建模两个根实体之间的多对多关系的问题，其中关系本身带有一些语义含义。

在我的域中

*   您可以将终端视为我们公司的分支机构
*   终端可以与任意数量的客户建立关系
*   客户可以与任意数量的终端建立关系（标准多对多）
*   客户\终端关系意味着客户可以潜在地在终端存储产品
*   这种关系可以启用\禁用。禁用仅意味着您暂时不允许存储产品，因此禁用关系与根本没有关系不同。
*   一个客户可以有多个办事处
*   与客户有关系（启用或未启用）的终端必须为该客户提供与其通信的默认办公室
*   有一些默认设置适用于客户和终端之间的所有交易，这些设置是在终端-客户关系级别上设置的

我认为我这里的对象很清楚，**终端**、**客户**、**办公室**和**终端**客户关系（因为有专门存储有关关系的信息，例如是否启用、默认办公室、广告默认设置）。通过多次重构，我确定终端和客户都应该是聚合根。这给我留下了如何设计我的 TerminalCustomerRelationship 对象以将两者联系起来的问题。

我想我可以使从 Terminal 到 TerminalCustomerRelationship 的遍历朝着关系单向，但我不知道如何打破与客户关系的关系，特别是因为它需要包含对 Office 的引用，该 Office 与顾客。

我对这些东西很陌生，虽然大多数 DDD 都非常有意义，但我感到困惑，需要一个全新的前景。有人可以就如何处理这种情况给我意见吗？

请注意，我说的是关系而不是关系。在我目前的观点中，它应该成为一个对象，就像婚姻将成为一个婚礼教堂申请中的一个对象一样。它最明显的目的是它关联两个对象，但它也有其他理所当然地属于它的属性。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T07:47:11.353

根据您的描述，您肯定需要一个“ **TerminalCustomerRelationship** ”实体来跟踪相关信息。我还将“ **IsEnabled** ”标志转换为带有时间戳的一流“事件”实体 - 这使您能够保存状态更改的历史记录（更真实地了解域中正在发生的事情。）

这是一个反映您的问题的[示例应用程序](http://www.evolving-software.co.uk/downloads/stack-overflow-654586-ddd-modeling-sample.zip)（在 VS2008 中）。您可以调整/测试代码，直到关系变得有意义。运行“ *bin/debug/TerminalSampleApp.exe* ”并右键单击“*终端->创建示例*”开始。

如果您觉得它有用，请告诉我。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:11:15.123

名称通常可以阐明对象的职责并使域模型成为焦点。

我不清楚站点是什么，这使整个模型变得混乱，这使我很难提供更好的建议。例如，如果站点是供应商，那么将 SiteCustomerRelationship 重命名为合同将很容易。在这种情况下，将 Contract 作为自己的实体是非常有意义的，并且模型看起来像 Vendor-Contract-Customer-Office。

还有其他方法可以查看这一点。[Udi 在这里](http://www.udidahan.com/2009/01/24/ddd-many-to-many-object-relational-mapping/)有一篇关于这种多对多关系的不错的帖子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T15:40:07.167

你不应该有一个像 SiteCustomerRelationship 这样的对象，它是特定于数据库的。

如果它是真正的 DDD，你应该有一个像这样的关系：

```
Aggregate<Site> Customer.Site
IEnumerable<Aggregate<Office>> Customer.Offices 
```

也许

```
Aggregate<Office> Customer.DefaultOffice 
```

# javascript - 为什么 GWT 和 Script# 风格的框架没有成为主导？

> ID：654587
> 
> 赞同：8
> 
> 时间：2009-03-17T14:56:11.720
> 
> 标签：javascript, gwt, code-generation, script#

使用 GWT，我们可以用 Java 编写代码并将其转换为 JavaScript 代码。使用 Script#，我们可以用 C# 编写代码并将其转换为 JavaScript 代码。听起来 GWT 和 Script# 将使 Web 开发人员免于遭受 javascript 的痛苦。那么，为什么这些工具没有占据主导地位呢？为什么还有人致力于编写 javascript 代码？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T15:01:21.880

多种原因，哪一个最重要因开发人员而异。这里有两个：

*   因为 JavaScript 是一种比 Java/C# 更漂亮/灵活/强大/（在此处插入选择的形容词）的语言
*   人们不信任 GWT/Script 生成的输出#

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T21:09:45.527

我只能代表 GWT，但这是我认为阻碍它的事情：

*   编译时间（GWT 需要很长时间编译，javascript 更改是即时的）
*   学习新语言（很多 Web 开发人员不知道如何编写 java 代码）
*   对泄漏抽象和编译器的 FUD。人们害怕编译器为他们制作 javascript 和泄漏抽象的东西。在我看来，两者都只是 FUD，但这并不能使它成为一个理由。
*   人们经常不明白在哪里以及如何使用 GWT，并且因为他们试图将它插入错误的漏洞而被它推迟。
*   有人认为 GWT 的创建是为了允许后端开发人员编写 javascript 代码，但事实并非如此。
*   使用 VerticalPanels、Horizo​​ntalPanels、FlowPanels 和 FlexTables 的整个想法对于已经学会如何在 HTML 中进行布局的人来说是陌生的。
*   谷歌不擅长营销。没有冒犯 GWT 伙计们，但如果它被营销/展示得更好一点，它就会像烤饼一样起飞
*   缺乏用于 GWT 的优秀小部件库。默认情况下附带的小部件很好，但我们需要更多。在我看来，像 GWT-ext 这样的库并没有帮助，因为它们只是试图将 javascript 库包装在 GWT 中，并没有利用 Java 编码的强大功能。
*   Web 开发人员的学习曲线陡峭，因为它的框架更像 Swing 而不是 HTML。

I still use it in my day to day coding, but I've long accepted that it's not about to take off.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-17T15:00:59.960

对于 UI 开发，在 JavaScript 中工作要比 Java 痛苦得多。您会使用将汇编程序翻译成 Java 的框架来编写您的 Java 应用程序吗？

JavaScript 的大部分“痛苦”是由于浏览器不兼容造成的，由于大型 JavaScript 库（例如 dojo）和浏览器本身的改进，这种情况发生了变化。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-17T15:04:03.213

因为有[泄漏的抽象](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)，并且因为 Javascript 是一种比 Java 或 C# 更优雅和更适合 ui 的语言。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T15:05:41.150

因为 GWT 不是一刀切的解决方案。

GWT 非常棒，为编写富 Internet 应用程序的 Java 开发人员节省了大量时间。但！

对于我的不了解，编写一个对 Seo 友好的 GWT 网站是相当困难的。不可能有非javascript后备。它并没有真正针对加载速度进行优化。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-17T18:24:36.010

查看 (x)HTML、CSS 和 Javascript 的一种方式是作为世界上最灵活的 UI 系统。像 GWT 这样的系统为了稳定性而牺牲了一些灵活性（注意：在基本前提之外，我对 GWT 不是很熟悉）。有许多面向软件和/或服务的商店使用 (x)HTML、CSS 和 Javascript 提供的灵活性来在市场中脱颖而出。

想象中的对话。

客户：我喜欢你构建的 UI，但是我们可以把这 20 像素宽，稍微改变一下色调，并且当你翻转这一半时有一个额外的浮动提示。

GWT Shop：是的，不幸的是，如果没有重大黑客攻击和/或大量您不想支付的额外工作，GWT 框架不支持类似的东西。

(x)HTML/CSS/Javascript Shop：是的，我们可以轻松做到这一点，这是一个估计。

我不是在这里争论赞成/反对，想象中的对话所暗示的肯定更复杂，但是有些商店如果被迫采用类似 GWT 的方法，就会失去竞争优势，所以他们不会这样做它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T15:19:42.927

JavaScript 的问题不在于语言本身，这在我看来很好，是因为 JS 被误解了，人们不认真对待也不学习它，而是在不理解的情况下复制和粘贴蹩脚的脚本代码。其次，InternetExplorer、JScript 和混乱的 DOM 实现破坏了语言的形象。

但主要问题是，您必须了解 DOM 和 JavaScript 如何工作才能编写 GWT 代码。这与 JSF 开发中的情况相同，您必须了解 HTML 和 CSS。这不像编写 Java，您不必了解整个字节码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-25T09:39:01.860

If your a jave programmer and dont want to learn jave script or care about how IE version deal with Js then GWT is the way to go!

# c# - 用于数学计算的数据类型，例如 BMR 函数

> ID：654592
> 
> 赞同：0
> 
> 时间：2009-03-17T14:56:42.967
> 
> 标签：c#, math

我正在编写一个 BMR 函数，我应该使用十进制类型作为我的返回值以获得最高精度吗？（C＃）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T15:02:59.240

假设您的意思是[基础代谢率](http://en.wikipedia.org/wiki/Metabolic_rate)，我会使用双倍。我们在这里谈论的是没有离散值的*自然量 - 例如，我们可能会说某物重 10.25 公斤，但这已经是一个估计值。*它不像货币，10.25 美元就是*这么*多钱。

我认为一个合理的经验法则是“科学的两倍，金融的小数”——但这显然不是一个绝对的规则。

# mysql - 针对 InnoDB 的 ALTER TABLE 优化 MySQL

> ID：654594
> 
> 赞同：29
> 
> 时间：2009-03-17T14:56:59.223
> 
> 标签：mysql, alter-table, performance

不久之后，我们将需要对生产数据库进行架构更改。我们需要尽量减少这项工作的停机时间，但是，ALTER TABLE 语句将运行相当长的一段时间。我们最大的表有1.5亿条记录，最大的表文件是50G。所有表都是 InnoDB，并且它被设置为一个大数据文件（而不是一个文件每个表）。我们在 8 核机器、16G 内存和 RAID10 配置上运行 MySQL 5.0.46。

我有一些 MySQL 调优的经验，但这通常侧重于来自多个客户端的读取或写入。在 Internet 上可以找到很多关于这个主题的信息，但是，关于（临时）调整 MySQL 服务器以加速 InnoDB 表上的 ALTER TABLE 或 INSERT INTO 的最佳实践的信息似乎很少。 . SELECT FROM（我们可能会使用它而不是 ALTER TABLE 以获得更多的机会来加快速度）。

我们计划做的架构更改是向所有表添加一个整数列，并使其成为主键，而不是当前的主键。我们还需要保留“旧”列，因此不能选择覆盖现有值。

什么是尽快完成这项任务的理想设置？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-07-03T20:43:32.957

您可能想查看 Percona 工具包中的[pt-online-schema-change](http://www.percona.com/doc/percona-toolkit/2.1/pt-online-schema-change.html)。本质上它的作用是：

*   复制原始表结构，运行 ALTER。
*   将旧表中的行复制到新创建的表中。
*   复制时使用触发器跟踪和同步更改。
*   一切完成后，它通过重命名两个表来交换表。

对于单实例数据库非常有效，但如果您使用复制可能会非常棘手，并且您无法负担停止从属服务器并在以后重建它们。

这里还有一个很好的网络[研讨会](http://www.percona.com/webinars/2012-05-02-zero-downtime-schema-changes-in-mysql/)。

*PS：我知道这是一个老问题，只是回答以防有人通过搜索引擎点击此问题。*

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-18T05:38:22.047

您需要更仔细地考虑您的要求。

在最简单的级别上，更改表的“最快”方法是在尽可能少的`ALTER TABLE`语句中完成，最好是一个。这是因为 MySQL 复制表的数据以更改架构并进行 15 次更改，同时进行一次复制显然（并且确实）比复制表 15 次更快，一次进行一次更改。

但是我怀疑您是在问如何以最少的停机时间进行此更改。我这样做的方式，你基本上综合了非块的`ALTER TABLE`工作方式。但它有一些额外的要求：

1.  您需要一种方法来跟踪添加和更改的数据，例如为后者使用“修改”日期字段，或`AUTO_INCREMENT`为前者使用字段。
2.  您需要空间才能在数据库上拥有两个表副本。
3.  您需要一个时间段，在该时间段内对表的更改不会比快照提前太多

基本技术如您所建议的那样，即使用`INSERT INTO ... SELECT ...`. 至少你在前面，因为你从 InnoDB 表开始，所以`SELECT`不会阻塞。我建议在`ALTER TABLE`新的空表上执行，这将保存 MySQL 再次复制所有数据，这意味着您需要在`INSERT INTO ... SELECT ...`语句中正确列出所有字段。然后你可以做一个简单的`RENAME`语句来交换它。然后你需要做另一个`INSERT INTO ... SELECT ... WHERE ...`，也许是一个`UPDATE ... INNER JOIN ... WHERE ...`来获取所有修改过的数据。**您需要*快速*`INSERT`执行此操作，否则您的代码将开始向您的快照添加新行和更新，这*将*干扰您的更新。`UPDATE`** **（如果您可以将您的应用程序从`RENAME`.**

 **除此之外，您可以为一个会话更改一些与键和缓冲区相关的设置，这些设置可能有助于主要数据的移动。像这样的东西`read_rnd_buffer_size`，并且`read_buffer_size`将有助于增加。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-10-06T12:57:56.657

1.  设置从站
2.  停止复制。
3.  在奴隶上进行 ALTER
4.  让奴隶赶上主人
5.  交换主机和从机，因此从机成为具有更改结构和最小停机时间的生产服务器

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-06-09T20:53:47.390

不幸的是，这并不总是像[staticsan](https://stackoverflow.com/questions/654594/optimizing-mysql-for-alter-table-of-innodb/657084#657084)在他的回答中提到的那样简单。在线创建新表并移动数据很容易，在维护模式下进行清理也很容易，但是，Mysql RENAME 操作会自动操作对旧表的任何外键引用。这意味着对原始表的任何外键引用仍将指向您将表重命名为的任何内容。

因此，如果您对要更改的表有任何外键引用，那么您要么更改这些表以替换对新表的引用，要么更糟的是，如果该表很大，您必须重复该过程表二。

过去对我们有用的另一种方法是处理一组 Mysql 副本来处理变更。我不是最适合谈论这个过程的人，但它基本上包括中断对一个从属的复制，在该实例上运行补丁，一旦改变表完成就重新打开复制，以便它赶上复制。一旦复制赶上，您将站点置于维护模式（如有必要）以从您的主数据库切换到这个新的修补过的从属数据库作为新的主数据库。

我不记得的唯一一件事是你将其他奴隶指向新主人的确切时间，以便他们也得到应用。对此过程有一个警告，我们通常在代码需要更改之前或在代码更改为不再引用列/键之后使用它来滚动更改补丁。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-10-02T09:57:39.500

我测试了各种策略来加速一张变更表。最终，在我的特定情况下，我的速度提高了大约 10 倍。结果可能适用于您的情况，也可能不适用于您的情况。但是，基于此，我建议尝试使用 InnoDB 日志文件/缓冲区大小参数。

**简而言之，只有增加 innodb_log_file_size 和 innodb_log_buffer_size 才会产生可衡量的效果**（小心！更改**innodb_log_file_size 是有风险的**。请参阅下文了解更多信息）。

根据粗略的写入数据速率 (iostat) 和 cpu 活动，瓶颈是基于 io 的，而不是数据吞吐量。在更快的 500 秒运行中，写入吞吐量至少与您对硬盘的预期相同。

**尝试了性能优化：**

*   [按照https://stackoverflow.com/a/5303805/1148030](https://stackoverflow.com/a/5303805/1148030)中的建议选择 * 到 outfile + 加载数据 infile
*   “禁用键”我错过了它在 InnoDB 中没有影响的事实，根据结果也是如此。这在所有情况下都打开，除了最终的更改表。 [如何在innodb中禁用索引](https://stackoverflow.com/questions/9524938/how-to-disable-index-in-innodb)
*   innodb_buffer_pool_size，“磁盘 I/O 提示”，位于[http://dev.mysql.com/doc/refman/5.1/en/innodb-tuning.html](http://dev.mysql.com/doc/refman/5.1/en/innodb-tuning.html)
*   foreign_key_checks=0 等，“批量数据加载技巧”，位于[http://dev.mysql.com/doc/refman/5.0/en/innodb-tuning.html](http://dev.mysql.com/doc/refman/5.0/en/innodb-tuning.html)
*   更大的 innodb_log_file_size（参见下面的警告）和 innodb_log_buffer_size。[请参阅http://dev.mysql.com/doc/refman/5.0/en/innodb-tuning.html](http://dev.mysql.com/doc/refman/5.0/en/innodb-tuning.html)和[http://dev.mysql.com/doc/refman/5.1/en/innodb-](http://dev.mysql.com/doc/refman/5.1/en/innodb-parameters.html#sysvar_innodb_log_file_size)上的“日志记录提示” [parameters.html#sysvar_innodb_log_file_size](http://dev.mysql.com/doc/refman/5.1/en/innodb-parameters.html#sysvar_innodb_log_file_size)和[http://dev.mysql.com/doc/refman/5.0/en/innodb-parameters.html#sysvar_innodb_log_buffer_size](http://dev.mysql.com/doc/refman/5.0/en/innodb-parameters.html#sysvar_innodb_log_buffer_size)

**更改 innodb_log_file_size 可能很危险。**请参阅[http://www.mysqlperformanceblog.com/2011/07/09/how-to-change-innodb_log_file_size-safely/](http://www.mysqlperformanceblog.com/2011/07/09/how-to-change-innodb_log_file_size-safely/)链接中解释的技术（文件移动）在我的情况下效果很好。

另请参阅[http://www.mysqlperformanceblog.com/2007/11/03/choosing-innodb_buffer_pool_size/](http://www.mysqlperformanceblog.com/2007/11/03/choosing-innodb_buffer_pool_size/)和[http://www.mysqlperformanceblog.com/2008/11/21/how-to-calculate-a-good-innodb -log-file-size/](http://www.mysqlperformanceblog.com/2008/11/21/how-to-calculate-a-good-innodb-log-file-size/)有关 innodb 和调整日志大小的信息。较大日志文件的一个缺点是崩溃后的恢复时间较长。

**试运行和粗略的时间安排：**

*   将数据简单加载到新创建的表中：6500s
*   加载数据 w。innodb_log_file_size=200M，innodb_log_buffer_size=8M，innodb_buffer_pool_size=2200M，自动提交= 0；unique_checks=0, foreign_key_checks=0: 500s
*   加载数据 w。innodb_log_file_size=200M, innodb_log_buffer_size=8M: 500s
*   等效的直接更改表 w。datainnodb_log_file_size=200M, innodb_log_buffer_size=8M: 500s

**测试详细信息**：表：InnoDB，6M 行，磁盘 2.8G，单个文件（innodb_file_per_table 选项），主键是 1 个整数，+2 非队列约束/索引，8 列，平均。行长 218 字节。服务器：Ubuntu 12.04，x86_64，虚拟机，8 核，16GB，sata 消费级磁盘，无 raid，无数据库活动，其他进程活动很少，其他和更小的虚拟机中的活动很少。mysql 5.1.53。初始服务器配置是非常默认的，除了增加了 1400M 的 innodb_buffer_pool_size。alter 表添加了 2 个小列。我没有对原始的 alter table 计时，而是尝试了等效的 load data infile 语句，最后我做了直接的 alter table 并得到了可比较的结果。

**这个问题至少与以下问题有关：**

*   [MySQL：向大表中添加字段](https://stackoverflow.com/questions/2386573/mysql-add-a-field-to-a-large-table)
*   [在大型 mysql 表中添加新列](https://stackoverflow.com/questions/1015521/add-a-new-column-in-a-large-mysql-table)
*   [mysql慢查询](https://stackoverflow.com/questions/5302419/mysql-slow-query/5303805#5303805)
*   [MySQL "set unique_checks", "set foreign_key_checks" vs. "alter table disable keys"](https://stackoverflow.com/questions/1307476/mysql-set-unique-checks-set-foreign-key-checks-vs-alter-table-disable-key)
*   [针对 InnoDB 的 ALTER TABLE 优化 MySQL](https://stackoverflow.com/questions/654594/optimizing-mysql-for-alter-table-of-innodb)

* * *

## 回答 #6

> 赞同：-5
> 
> 时间：2009-03-17T15:01:33.143

我真的不知道如何优化它，但在进行此类更新之前将站点置于离线模式通常是一个好习惯。

然后，您可以在凌晨 3 点运行您的 DB 脚本，因此如果停机时间比理想情况长很多，这无关紧要。

# .net-3.5 - 在 ADO.NET 数据服务中添加对查找表的引用

> ID：654597
> 
> 赞同：1
> 
> 时间：2009-03-17T14:57:32.247
> 
> 标签：.net-3.5, wcf-data-services

我正在尝试使用 ADO.NET 数据服务来更新我的数据库。

表：

*   人（PK PersonId；FK EntityRootId）
*   EntityRoot（PK EntityRootId，FK EntityTypeId）
*   实体类型（PK EntityTypeId）

我正在尝试创建一个 EntityRoot（不幸的名称，因为它可能与 Entity Framework 的 Entity 混淆。EntityRoot 在我的域中）并将其添加到数据库中：

```
var entRoot = EntityRoot.CreateEntityRoot(
    0, "Lou", DateTime.Now, "Lou", DateTime.Now);
var entityType = 
   (from type in myContext.EntityTypeSet
    where (type.Description == "Person")
    select type).FirstOrDefault(); // this works fine and returns the entityType I’m looking for

entRoot.EntityType = entityType;
myContext.AddToEntityRootSet(entRoot); 

// with the line below I get a runtime error:
//  “AddLink and DeleteLink methods only work when the sourceProperty is a collection.”
//myContext.AddLink(entRoot, "EntityType", entityType); 

// without the line above I get an error from the save:
//  “Entities in 'MyEntities.EntityRootSet' participate in the 'FK_EntityRoots_EntityTypeId_Lookup_EntityTypes' 
//    relationship. 0 related 'EntityTypes' were found. 1 'EntityTypes' is expected.”
myContext.BeginSaveChanges(SaveChangesOptions.Batch,
                      new AsyncCallback(OnSaveAllComplete),
                      null); 
```

如何添加对 entRoot.EntityTypeId 字段的引用？

感谢您对此的任何见解。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T15:11:59.140

我认为这样做时您应该使用 SetLink 而不是 AddLink，因为您指示的属性是从 Entity 到 EntityType（一个 Entity 有一个 EntityType）。

这基本上是错误消息告诉您的内容（AddLink 仅适用于 Collection 属性，例如从类型到实体的反向属性，或多对多关系）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T15:07:21.617

这只是您的问题中的错字还是应该是

```
myContext.AddLink(entRoot, "EntityTypes", entityType); 
```

在你的问题开始时，你写“EntityTypes”（以“s”结尾）。

# c++ - C++ 结构“可接受”多少功能？

> ID：654609
> 
> 赞同：16
> 
> 时间：2009-03-17T14:59:48.747
> 
> 标签：c++, oop, struct

我的第一篇文章，所以请放轻松！

我知道 C++ 中的结构和类之间没有真正的区别，但是包括我在内的很多人都使用结构或类来显示意图 - 用于对“普通旧数据”进行分组的结构和用于封装数据的类具有有意义的操作。

现在，这很好，但是你什么时候开始认为某些东西不再只是一个结构，而应该成为一个类？

我认为结构具有合理性的事情：

1.  仅具有简单初始化代码的构造函数。
2.  序列化代码，例如流插入/提取运算符。

我不太确定但可能会做的事情：

1.  比较运算符
2.  简单的转换功能 - 例如在从外部源接收数据后对所有成员进行字节交换。

我不认为结构应该有：

1.  动态内存分配。
2.  析构函数。
3.  复杂的成员函数。

界限在哪里？？？

另外，将类实例作为结构的成员是否合理？例如

```
class C {private: int hiddenData; public: void DoSomething();};

struct S {int a; float b; C c; };

S s; s.c.DoSomething(); 
```

请记住，我不是在谈论你可以用 C++ 做什么，我感兴趣的是你在设计好的软件时应该做什么。

想法？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T15:07:21.397

我认为有三个主要的、连贯的思想流派：

1.  不关心任何一种方式并使用`struct`和`class`互换的人。
2.  仅使用`struct`s 来表示小 POD 的人。
3.  使用`struct`s 作为记录的人。

我无法对这两种策略中的任何一种做出决定性的论据。我倾向于遵循路径 2，但当我认为它适合时，我也会将结构用于非 POD 类型，特别是对于函数对象（即使这些可能不满足 POD 要求）。

[（顺便说一句，C++ FAQ lite 对POD](http://www.parashift.com/c++-faq-lite/intrinsic-types.html#faq-26.7)有一个很好的定义）。

**编辑**我没有接触模板元编程技术，例如使用`struct`占位符（类型标签）或实现元功能。我想在这些情况下绝对没有争议：因为它们从不包含方法（甚至数据），所以总是使用`struct`)。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-17T15:05:44.927

我个人的偏好是只在根本没有方法的情况下使用结构。如果我出于任何原因需要添加一个方法，那就是一个类。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-17T16:19:20.397

**类与结构**

使用 class 或 struct 关键字是一个品味问题，以及它给读者带来的“*感觉”。*从技术上讲，它们是等价的，但是如果将结构用于 POD 并将 C-struct 类型和类用于其他任何东西，则可读性会更好。

应该在 C++ 结构中包含的基本内容：初始化数据的构造函数（我不喜欢使用 memset，如果 POD 演变成不同的东西，它以后可能会反悔）或从其他类型构造但不是复制构造函数。

如果因为生成的编译器不够好而需要定义复制构造函数或赋值运算符，则将其设为类。

通常也将结构用于将传递给 STL 算法和模板元编程的函子，如

```
struct square_int {
   int operator()( int value )
   {
      return value*value;
   }
};
std::transform( v.begin(), v.end(), v.begin(), square_int() ); 
```

或者

```
// off the top of my head
template <typename T>
struct is_pointer { enum { value = false } };

template <typename T>
struct is_pointer<T*> { enum { value = true } }; 
```

**成员方法与自由函数**

除了我之前说过的，不要添加到其他人已经回答的内容之外，我想把重点放在你在帖子中评论的其他类型的函数上，比如比较运算符等。

对称的运算符（比较、算术）、插入和删除运算符以及转换通常最好作为自由函数实现，无论您将其声明为类还是结构。

对称运算符（关于数据类型）如果被实现为成员函数，则它们不是对称的。查找规则不会将左侧转换为调用成员函数，但它会应用相同的转换来匹配自由函数。

```
 // Example of symmetry with free functions where method would be asymmetric
   int main()
   {
      std::string( "Hello " ) + "world"; // compiles as free / member function
      "Hello " + std::string( "world" ); // compiles with free function, fails with member function definition of +
   } 
```

在上面的代码中，如果 operator+ 是 std::string 的成员方法，则编译器将无法编译，因为它无法将 const char* 文字转换为 std::string 以使用该成员方法。

流的插入和提取必须始终作为自由函数实现，因为流始终位于操作的左侧。

将转换保持为自由函数将两种不同的类型解耦。如果 A 和 A' 可以相互转换，并且您决定将转换作为 A 的成员来实现，那么 A 必须知道 A' 并且 A 的所有使用都将取决于 A' 是否使用它。如果将转换定义为自由函数，则没有 A' 的 A 是完整的，并且两个类/结构之间的耦合会更小。与网络、序列化和反序列化的转换也是如此。当您在类/结构中实现它们时，您会强制所有用户了解这些转换。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T15:12:34.597

通过阅读 Visual Studio 附带的一些 STL 源代码，似乎使用的一个标准是“大部分是公共的”（以*struct*开头）还是“大部分是私有的”（以*class*开头）？

同样，如果您在班级顶部附近（可能是因为它很重要）写的内容是*public*，那么请使用*struct*。另一方面，如果您首先列出成员数据，请使用*class*。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-17T15:33:58.073

当我需要维护不变量和数据完整性时，我会使用类和封装。如果您没有不变量，并且数据实际上只是一堆项目，那么即使您添加了精美的辅助构造函数或函数，在我们的商店中使用 struct 也总是可以的。然而，你装饰得越多，那应该会让你停下来想也许它应该是一堂课。

如果您确实必须与 POD 兼容（例如与 C 代码接口），您仍然需要使用 struct. 但是，您可以将此结构包装在一个类中，并使用 get() 函数将其公开以与 C API 接口。或者创建一个辅助函数以从您的类中返回正确的 POD 结构。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-17T16:28:26.723

你可以看看标准库做了什么。每个人都喜欢的 struct **std::pair**只有构造函数。

我发现使用带有结构的构造函数非常方便和自然，我无法想象没有它们。我从不给结构体提供任何其他方法，但当然可能有自由函数或其他类的成员将它们作为参数。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-17T16:38:32.737

为了方便起见，我将在结构中添加很少的方法，前提是我实际使用它们。当然，它们都是公开的。如果我需要更多，它会立即转换为一个类。

1.  默认构造函数，用于将数据成员初始化为已知值。
2.  每个成员都有一个参数的构造函数。
3.  运算符<，以便轻松包含在集合和映射中。
4.  运营商==。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-17T18:29:50.537

我可能是少数，但我用`struct`s 来表示一件事，“位的顺序很重要”。任何必须序列化到磁盘或网络的东西，或者必须与某些第三方库兼容并且需要以正确的顺序排列的东西，或者如果它正在做某种位域魔术作为处理器特定的优化，那总是会进入`struct`. 因此，重新排列 a 中的字段`struct`总是会产生某种后果，应该仔细考虑。

`class`但是，es 具有仅在语义上有意义的字段。如果出于某种原因我或其他人想要重新排列或修改 a 的数据成员`class`，这可以很自由地发生。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-17T15:10:13.433

一致性是最重要的。约定的要点是为所有将来阅读您的代码的人提供一个共同的参考点。

就个人而言，如果我觉得我需要类的功能，我会避免使用结构。
又名：“普通旧数据”方法。

查看您的项目并设定标准，或坚持已有的标准。

不过，我建议你尽量避免继承，特别是如果所有结构都在做的是持有 POD。没有比跟踪一堆超类的整数或字符更糟糕的了。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-04T00:59:15.917

> 包括我在内的很多人都使用结构或类来显示意图 - 用于对“普通旧数据”进行分组的结构和用于封装具有有意义操作的数据的类。

恕我直言，这种区分是一种误解，但很好理解为什么会这样使用它。它基于传统约定和对类与结构的内在感觉。我会遵循 Marshall Cline 的建议：

[7.8 关键字struct和class有什么区别？](http://www.parashift.com/c++-faq-lite/classes-and-objects.html#faq-7.8)

> 由于这是大多数人已经拥有的含义，因此如果您的类具有很少的方法并且具有公共数据（这样的东西确实存在于设计良好的系统中！），您可能应该使用 struct 关键字，否则您可能应该使用该类关键词。

就个人而言，我（过度）使用`struct`关键字`metafunctions`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-17T15:34:56.433

结构的另一个常见用途是用于模板内容和本地 RAII 或仿函数类。这些是一次性的代码，它们更接近于函数而不是整个类，并且需要额外的`public:`声明只是愚蠢的。如果你看一下 boost，你会看到很多这样的东西：

```
template<
      bool C
    , typename T1
    , typename T2
    >
struct if_c
{
    typedef T1 type;
}; 
```

它显然不是 POD（实际上它根本不保存任何数据）。在其他情况下，您可以拥有仅包含构造函数/析构函数的 RAII 类：

```
struct LogOnLeavingScope : public NonCopyable
{
    string Message;
    LogOnLeavingScope(const string &message) : Message(message) {}
    ~LogOnLeavingScope() { Log(Message); }
]; 
```

Functor 类将提供相同的论点：

```
struct Logger
{
    void operator()(const string &message) { Log(message); }
} 
```

我想说 C++ 没有一个特性意味着你应该使用一个类而不是一个结构（可能除了虚函数）。这完全取决于您要呈现的界面 - 如果您对所有内容都公开，请使用结构。如果你发现你想要添加`private:`部分，这是一个好兆头，你真的想要一个类而不是一个结构。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-17T18:38:24.807

如果数据成员有访问器方法，那么它就是一个类。

如果您可以直接访问数据并且可以随意修改它，那么它就是一个结构。

结构没有理由不应该有构造函数、比较运算符等。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-17T18:46:41.620

我喜欢在结构上添加的唯一方法是属性类型方法、简单转换（以及，如果适合类型，还有运算符）和*非默认*构造函数。

### 特性

例如，我可以定义一个`RECT`结构如下：

```
typedef struct tagRECT{
    int left;
    int top;
    int right;
    int bottom;

    int get_width(){return right - left;}
    int get_height(){return bottom - top;}
    int set_width(int width){right = left + width; return width;}
    int set_height(int height){bottom = top + height; return height;}
} RECT, *PRECT; 
```

在编译器支持属性作为扩展的情况下，“set”方法返回新值以支持赋值链接。

### 简单的变换

对于存储复杂数据的 POD 类型，我可能会包含对该数据执行简单转换的方法。一个明显的示例可能是在 TransformationMatrix 结构上包含 Rotate、Scale、Shear 和 Translate 方法。

### 运营商

实际上只是上述的扩展，如果运算符对类型有意义，我会将它们添加到结构中。这对于保持对象的原子性可能是适当且必要的。一个明显的例子是复杂结构上的标准算术运算符。

### 构造函数

我**不想**在我的结构上使用默认构造函数。我不想分配一个 POD 数组并遭受一千个（或其他）默认初始化的调用。如果`memset`初始化还不够，我将提供一个 Initialize 方法。

但是，我将在结构上提供一个非默认构造函数。当可以从部分构造中推断出一个或多个字段时，这尤其有用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-17T19:11:36.753

我总是将结构用于“数据块”，即使它们用构造函数和有时比较运算符装饰，它们也永远不会添加方法（甚至没有 get/set 方法）。

我认为这表明了该类型的意图 - 结构只是要被其他事物操作的数据。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-17T21:58:35.473

每当我想将数据成员用作对象的接口时，我都会使用 struct。每当需要添加私有部分时，我会将结构更改为类。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-18T15:40:23.533

通常，我`class`在需要使用访问说明符时使用。这样做的效果是，我的大多数顶级内容都保留为类，而稀有的 POD 集合和我不那么稀有的内部类 pimpl 通常是结构。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-18T16:40:40.050

我对结构和类的简单经验法则：

```
if (data_requires_strict_alignment == TRUE) {
  use(struct);
} else {
  use(class);
} 
```

也就是说，如果您要表示的数据对应于某些具有严格成员顺序和对齐要求的数据对象（例如，在驱动程序级别与硬件交换的数据结构），请使用结构。对于所有其他情况，请使用类。类具有结构没有的许多特性和功能，根据我的经验，尽可能使用类是有益的，即使您目前没有使用任何这些附加特性（如果没有别的，纯数据类是像具有更安全的默认访问级别的结构）。当您需要结构的独特属性时，为那些情况保留结构；即，能够以精确的顺​​序和精确的对齐/填充（通常使用低级通信，例如驱动程序）指定结构成员，以便您可以将其转换为字节数组，使用`memcpy()`如果你遵循这个模型，那么类就不会被用作结构的成员（因为类定义没有指定对齐方式或 的可预测值`sizeof(class)`）。同样，如果您正在考虑构造函数或运算符，请使用类。

这个经验法则还有助于更轻松地与 C 代码交互，因为结构的使用方式与 C 结构一致。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-24T21:27:44.920

当我考虑这个问题时，我并没有区分成员函数和自由函数，但我现在发现这是一个错误。现在在我看来，结构应该很少有成员函数。很明显，结构中的所有内容都应该是公开的。

因此，拥有 struct 成员函数通常没有意义，因为任何函数都可以更改 struct 中的数据。结构上的成员函数将是一种便利而不是必需品。

唯一的例外是为了其他目的而需要成为成员函数的东西——用于初始化数组的构造函数；与地图一起使用的比较；模板使用的东西；等等

也许类和结构应该被视为对立面——类公开函数并隐藏数据，而结构公开数据并允许您隐藏函数。

回到字节交换示例：

```
struct S
{
    int data;
    S() {data = 1234;}
    void ByteSwap() {network::ByteSwap( &data );}
};

S s;
s.ByteSwap(); 
```

会成为：

```
struct S
{
    S() {data = 1234;}
    int data;
};

namespace network
{
    void ByteSwap( int* i ) {/*byte swap *i*/}
    void ByteSwap( S* s ) {ByteSwap( &s->data );}

    S s;
    ByteSwap(&s);
} 
```

当数据和某些函数并不总是强烈地归属在一起时，这是有道理的。字节交换只对网络系统感兴趣，但更高级别的函数仍然可以使用该结构，甚至不知道字节交换之类​​的低级内容。

这种情况下的另一个好处是相关的字节交换操作都保存在同一个地方。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2009-03-17T15:12:57.747

这纯粹是风格问题，对与错将由您的商店决定。有时决定是不做决定，但套用拉什的话说，他们仍然会做出选择。

根据经验，我通常将结构用于更简单的数据类型，范围从 POD 到具有成员简单函数的对象。但是没有明确的界限，一旦我定义了一个结构，我通常不会因为我添加了更多的功能而返回并将其更改为一个类。我认为这没有任何价值。

# svn - 在我的个人网站上展示代码

> ID：654616
> 
> 赞同：1
> 
> 时间：2009-03-17T15:00:52.380
> 
> 标签：svn

我想开发一个代码组合供潜在雇主浏览。[像assembla](http://code.assembla.com/we20site/subversion/nodes/We20PinaxEd)这样的网站使用的界面看起来很有希望；如何在我的个人服务器上设置类似的东西？

我也乐于接受建议和其他展示方法，例如[目录列表](http://heather.cs.ucdavis.edu/~matloff/)，但 Web 界面看起来更胜一筹。我更喜欢自己主持一切的原因是因为

*   如果 Assembla 改变他们的政策，我不想付钱。他们过去有。
*   尝试不同事物的灵活性

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T15:11:53.303

我推荐[Trac](http://trac.edgewall.org/)。它的[SVN 浏览器](http://trac.edgewall.org/browser)看起来像你想要的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T15:14:37.730

看看[Redmine](http://www.redmine.org/projects/redmine/repository/browse)或[Trac](http://trac.edgewall.org/browser)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T15:05:45.627

这是一个简单的 SVN 网络浏览器。您将代码签入 subversion 存储库并安装其中一个浏览器，也许是这个[http://www.subversionary.org/projects/web/svn-browser](http://www.subversionary.org/projects/web/svn-browser)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T15:08:13.033

您可以使用开源应用[ViewVC](http://www.viewvc.org)。默认外观有点过时，但可以轻松修改 css。

# sql-server - 设置 Windows Server 2008 / SQL Server 2008 集群

> ID：654624
> 
> 赞同：3
> 
> 时间：2009-03-17T15:02:05.950
> 
> 标签：sql-server, windows-server-2008, cluster-computing

正如我在有关托管与租用 Web 服务器的[相关问题](https://stackoverflow.com/questions/654448/setting-up-a-windows-2008-server-colocation-or-rental)中提到的那样，我正在考虑使用四台 Mac Mini（Intel Core Duo）和 Windows Server 2008 设置 Web 服务器集群。我正在开发的网站是数据库驱动的并使用 ASP .Net MVC 与 Microsoft SQL Server 2008。我完全没有设置 Web 服务器的经验，所以我只知道但不熟悉网络负载平衡和故障转移群集等技术。

有人可以推荐一种将这 4 台服务器一起配置的理想方法或列举我的最佳选择吗？例如，应该只有一台机器包含 SQL Server 数据库，还是应该在我的 Windows Server 2008 集群之上创建一个 SQL 集群。我想在可靠性和性能之间取得平衡，但我不确定这种平衡具体会是什么样子。

**更新：** 感谢您到目前为止的所有答案。当我写这个问题时，我不明白“*集群*”通常是指故障转移集群，我现在明白它提供了高可用性但*没有*性能优势。由于一位发帖者提到带有单个 5400 rpm 硬盘的 Mac Mini，作为 SQL 服务器可能存在性能问题，我想知道是否有任何可行的解决方案可以在多台机器之间分配数据库负载，无论是否使用高可用性的额外好处（我可以完全依靠备份）。我一直在阅读以下有关通过分发扩展 SQL 服务器的文章：

*   [横向扩展 SQL Server 2005](http://msdn.microsoft.com/en-us/library/aa479364.aspx)
*   [使用数据相关路由横向扩展 SQL Server](http://technet.microsoft.com/en-us/library/cc966448.aspx)

我有点困惑，如果有的话，这些分发方法中的哪一个是合适的。如果相关，假设访问数据库的站点具有与 Stack Overflow 相似的读/写比率。任何人都可以建议吗？

另外，我了解到服务器通常带有两个网络适配器，这允许一个适配器专用于与任何后端服务器进行通信。Mac Mini 只有一个网络适配器。这对性能有何不利影响？

**更新**经过进一步研究，我正在寻找对[等复制](http://www.sql-server-performance.com/articles/dba/PeertoPeer_Replication_in_SQL_Server_2008_p2.aspx)（[更多信息）。](http://technet.microsoft.com/en-us/library/ms151196.aspx)我弄错了吗？如果没有，考虑到我的硬件限制，使用它是否实用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T15:19:24.503

您可能会为您的 Web 服务器使用基本的网络负载平衡集群，但您需要更复杂的硬件来运行 SQL 集群，特别是共享仲裁驱动器。您的 Mac Mini 并不真正适合此用途。您可以改用[SQL Server 高可用性数据库镜像](http://msdn.microsoft.com/en-us/library/bb934127.aspx)。

我建议您阅读[Allan Hirt](http://www.sqlha.com/)的[Pro SQL Server 2005 High Availability](http://www.apress.com/book/view/159059780x)和Robert J. Shimonski 的[Windows Server 2003 Clustering and Load Balancing](http://www.mhprofessional.com/product.php?cat=112&isbn=0072226226)的副本，并在开始这次冒险之前进行一些研究。虽然标题指的是 SQL Server 2005 和 Windows 2003，但材料仍然与 SQL Server 2008 和 Windows Server 2008 非常相关。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T20:37:24.733

网络服务器的 NLB 和数据库服务器的镜像确实是您唯一的选择。
您需要某种共享存储来进行集群，例如 SAN、NAS 或磁盘阵列。

如果您有一个大小合适的数据库，例如。> 2-3GB 然后在具有单个 5400RPM sata 驱动器的 mac mini 上运行 db 服务器将意味着您将遇到性能问题。

如果您决定走集群路径，则需要投资更多硬件。看看[openfiler](http://www.openfiler.com)这可能是一个便宜的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:08:05.543

拆分机器。使用两个作为 Web 服务器，两个作为 SQL Server 集群。如果您不使用 SQL Server 群集，则也不需要 Windows Server 2008 群集。集群是一件非常需要掌握的事情。所以一般人走这条路根本是不可能的。对于设置任务，您将在 MS 和使用 google 中找到教程和帮助。

顺便说一句：我不会在 MAC mini 上这样做。高可用性和/或高性能应该有足够的硬件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T16:47:34.980

如果您担心数据库的负载，并且要保持低成本，那么您最好购买一台更高端的机器来运行 SQL Server，而不是尝试对几台廉价机器做一些花哨的事情。他们每个人的 SQL Server 许可证（更不用说 windows 许可证）的成本将远远超过更强大机器的额外硬件成本。

# css - 如何防止 CFDocument 中的分页出现在内容中间？

> ID：654630
> 
> 赞同：6
> 
> 时间：2009-03-17T15:03:49.643
> 
> 标签：css, coldfusion, cfdocument

我正在使用 cfdocument 标签从 html/css 动态生成 PDF 文件。有些内容块我不想跨越多个页面。

经过一番搜索，我发现根据文档支持样式“page-break-inside”。然而，在我的测试中，声明“page-break-inside：避免”没有好处。

关于让这种风格声明发挥作用的任何建议，或有其他建议？

这是一个例子。我希望 div 标签中的内容不会跨越分页符，但确实如此。样式“page-break-inside：避免”没有得到尊重。

```
<cfdocument format="flashpaper">
    <cfloop from="1" to="10" index="i">
        <div style="page-break-inside: avoid">
            <h1>Table Label</h1>
            <table>
                <tr><td>label</td><td>data</td></tr>
                <tr><td>label</td><td>data</td></tr>
                <tr><td>label</td><td>data</td></tr>
                <tr><td>label</td><td>data</td></tr>
                <tr><td>label</td><td>data</td></tr>
                <tr><td>label</td><td>data</td></tr>
                <tr><td>label</td><td>data</td></tr>
                <tr><td>label</td><td>data</td></tr>
                <tr><td>label</td><td>data</td></tr>
            </table>
        </div>
    </cfloop>
</cfdocument> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T16:23:52.087

这不是一个理想的解决方案，但我在需要保持在一起的块之前强制分页。使用 page-break-before 在块之前触发分页符。

我不认为有一种方法可以明确禁止内部中断（PDF 引擎对此表示敬意）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-07T01:45:00.180

如果您还没有解决这个问题，我遇到了同样的问题，并且在 CF8 Live Docs 中遇到了这个解决方案，它似乎对我有用。

“简单地放一个

```
<br> 
```

在 TD 内部的图像工作正常之后，图像不再被剪切。”

[http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_d-e_05.html](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_d-e_05.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-17T08:05:40.947

`div`用s （即`<td><div>Cell contents</div></td>`）包裹单元格的内容。在类似的线程上查看我的答案：[COLDFUSION: cfdocument and force a pagebreak](https://stackoverflow.com/questions/2112866/coldfusion-cfdocument-and-forcing-a-pagebreak/10631890#10631890)

# nhibernate - 使用 NHibernate 查询字符串集合

> ID：654632
> 
> 赞同：2
> 
> 时间：2009-03-17T15:04:21.903
> 
> 标签：nhibernate, hibernate

我有一个“项目”类，这个类有一个集合“标签”。

```
Item
    IList<string> Tags; 
```

我的数据库看起来像这样：

```
Items
   Id

Tags
   ItemId
   TagName 
```

我正在尝试获取所有带有标签“x”和“y”的项目。我如何使用 NHibernate（最好使用标准 API）来做到这一点？甚至可能吗？

谢谢。

编辑：我可以在不映射 Tag 对象的情况下做到这一点吗？它没有 ti be 1 查询。就像是

1.  var q = 查询将返回具有标签 x 或标签 y 的所有对象的 id”。

2.  var res = 查询将返回所有带有 ID 的项目 (q.Execute())

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:06:41.657

尝试这样的事情：

```
session.CreateCriteria(typeof(Item))
    .CreateCriteria("Tags", global::NHibernate.SqlCommand.JoinType.InnerJoin)
    .Add(Expression.Eq("TagName", "x"))
    .Add(Expression.Eq("TagName", "y"))
    .List() 
```

`Item`编辑：确保您在和之间具有双向关联`Tag`。在 Fluent 中，这看起来像：

```
public class ItemMap : ClassMap<Item>
{
    public ItemMap()
    {
        ...
        HasMany(x => x.Tags).Inverse();
        ...
    }
}

public class TagMap : ClassMap<Tag>
{
    public TagMap()
    {
        ...
        References<Item>(x => x.Item);
        ...
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-09T16:49:25.103

我最近遇到了同样的问题，并且在任何地方都没有为我的特定问题找到一个好的解决方案。在我的解决方案中，我需要一个映射的标签对象，因为它有点复杂。我将描述我所做的，以防它帮助任何人。本质上，这等效于以下 sql：

```
SELECT * 
FROM Items I 
WHERE 2 = (
    SELECT COUNT(DISTINCT TagName) 
    FROM Tags T 
    WHERE T.ItemId = I.ID) 
      AND (T.TagName = 'X' OR T.TagName = 'Y')
)

NHibernate.ICriteria criteria = session.CreateCriteria(typeof(Item),"I");

ICriterion tagCriteria = null;
foreach (string tag in tagNames) {
    ICriterion newCriteria = Expression.Eq("TagName", tag);
    if (tagCriteria == null) {
        tagCriteria = newCriteria;
    } else {
        tagCriteria = Expression.Or(tagCriteria, newCriteria);
    }
}
if (tagCriteria != null) {
    DetachedCriteria subCriteria = DetachedCriteria.For<Tags>("T");
    subCriteria.SetProjection(Projections.CountDistinct("TagName"))
        .Add(Expression.EqProperty("I.Id", "T.ItemId"))
        .Add(tagCriteria);
    criteria = criteria.Add(Subqueries.Eq(tagNames.Count,subCriteria ));
}
return criteria.List<Item>(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-16T05:45:43.757

我认为您遇到的问题与此相关：[https](https://www.hibernate.org/117.html#A2) ://www.hibernate.org/117.html#A2 - 即不能使用标准 API 以这种方式查询字符串/组件的集合。

如链接的常见问题解答中所述，我使用 HQL 解决了该问题：

```
session.CreateQuery("from Item item "
    + "where :x in elements(item.Tags) and :y in elements(item.Tags)")
    .SetString("x", X)
    .SetString("y", Y); 
```

它似乎按预期工作。

# wpf - 如何在 WPF 中制作圆角表格？

> ID：654634
> 
> 赞同：36
> 
> 时间：2009-03-17T15:04:56.287
> 
> 标签：wpf, xaml, rounded-corners

我试图使窗口（WPF）的角变圆但它不起作用，我试图使窗口本身透明并添加带圆角的内部边框但它不起作用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-17T15:12:05.177

您需要将 WindowStyle 设置为 WindowStyle.None，这将删除镶边，然后您可以允许透明度，这是 Window 元素的一个属性，并将背景颜色设置为透明。所有这些都可以作为窗口标签的属性来完成。

```
WindowStyle="None"
AllowsTransparency="True"
Background="Transparent" 
```

要使角变圆，请使用边框并设置cornerRadius 属性

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T15:47:14.157

不要使用 AllowsTransparency 它很慢而且有问题，看看这个链接，寻找“Office 2007 without Aero – 或者，你负责一切”部分：

[https://blogs.msdn.microsoft.com/wpfsdk/2008/09/08/custom-window-chrome-in-wpf/](https://blogs.msdn.microsoft.com/wpfsdk/2008/09/08/custom-window-chrome-in-wpf/)

编辑：这篇文章中的一些技术是特定于 Vista 的，但“Office 2007 without Aero”部分适用于 XP（实际上描述了为 Vista 编写的软件必须回退到 XP 上）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-09-27T13:19:48.063

我通过 Windows.Clip 解决了这个问题。

```
<Window ....
    <Window.Clip>
        <RectangleGeometry Rect="0,0,857,483" RadiusX="25" RadiusY="25"/>
    </Window.Clip>
</Window> 
```

但我认为最好的方法是使用 WindowChrome。您可以相对容易地解决调整大小问题。我还没有完全理解这项技术。所以我现在不能发布工作解决方案。目前这里有一个似乎有用的链接。 [MS-Docs ChromeClass](https://docs.microsoft.com/en-us/dotnet/api/system.windows.shell.windowchrome?view=netcore-3.1)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T15:17:16.007

您还需要在窗口周围制作几个像素宽的透明边框，否则圆角的边缘会被切断

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-03-18T14:50:41.520

它可以帮助你。

```
<Grid DataContext="{Binding ElementName=root}">
    <Border Background="#90000000" Visibility="{Binding Visibility}">
        <Border BorderBrush="Black" BorderThickness="1" Background="AliceBlue" 
                CornerRadius="10,0,10,0" VerticalAlignment="Center"
                HorizontalAlignment="Center">
            <Border.BitmapEffect>
                <DropShadowBitmapEffect Color="Black" 
                  Opacity="0.5" Direction="270" 
                  ShadowDepth="0.7" />
            </Border.BitmapEffect>
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <TextBlock x:Name="MessageTextBlock" 
                    Text="{Binding Message}" 
                    TextWrapping="Wrap" Margin="5" />
                <UniformGrid Grid.Row="1" Margin="5" 
                          Columns="2" HorizontalAlignment="Center"
                          VerticalAlignment="Bottom">
                    <Button x:Name="OkButton"  
                          Content="Ok" Margin="2"  />
                    <Button x:Name="CancelButton" 

                          Content="Cancel" Margin="2" />
                </UniformGrid>
            </Grid>
        </Border>
    </Border>
</Grid> 
```

# http - 响应所以浏览器不做任何事情 - 有可能吗？

> ID：654636
> 
> 赞同：4
> 
> 时间：2009-03-17T15:05:17.673
> 
> 标签：http, browser, response

是否可以做出这样的 HTTP 响应，浏览器会忽略它并继续显示先前显示的页面？

我的意思是以下场景：

a) 用户点击某物

b) 一些 POST 发送到服务器（或 GET，但让我们坚持使用 POST 更有趣）

c) 服务器决定出于某种原因此时不想发送回复

d) 服务器发送特制的响应

e) 浏览器不显示错误页面，不显示空白页面，不重定向到任何地方，不重新加载 - 只是继续显示它所显示的内容，就好像用户从未提交过表单一样

PS当然可以用AJAX包装，但我问是否可以使用bare-bones non-javascript解决方案

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T15:08:28.977

尝试返回 HTTP 204 No Content。[请参阅RFC 2616（超文本传输​​协议 -- HTTP/1.1）](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.5)中此响应代码的描述，其中说：

> 如果客户端是用户代理，它不应该改变导致请求被发送的文档视图。这个响应主要是为了允许输入动作发生而不导致用户代理的活动文档视图发生变化，尽管任何新的或更新的元信息应该应用于当前在用户代理的活动视图中的文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T15:08:10.240

这是一种通常称为[AJAX](http://en.wikipedia.org/wiki/AJAX)的方法。它需要[Javascript](http://en.wikipedia.org/wiki/Javascript)和[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)函数。

编辑：注意到底部的“PS”。另一个答案中建议的[204 响应](https://www.rfc-editor.org/rfc/rfc2616#section-10.2.5)看起来可能是一个有效的非 Javascript 解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:09:56.960

假设你这样做。

用户做什么？当然，再次提交表格。

几次。

然后他们决定你的网站坏了，然后离开。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T15:28:49.660

I think that you need Javascript to do that, you can send the request and depending on server response the Javascript can do a return false, avoiding the refresh/reload of the actual page.

I don't know about the 204 response, but maybe that way you can do it from the server side.

Another way of doing it (also Javascript) is to make a return false, right after the request is send, and depending on server response (with ajax) you can modify the actual page or send the user to another page.

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-03-17T15:10:11.750

不，HTTP 协议由一个请求-响应周期组成。服务器不能决定不回复（它可以，但是它破坏了协议并犯了一个错误）。

# php - phpDocumentor 到维基？

> ID：654641
> 
> 赞同：5
> 
> 时间：2009-03-17T15:05:46.190
> 
> 标签：php, wiki

我的公司正在使用 mediawiki 处理最终用户/开发人员文档。我想获取很多 phpdoc 吐出的 API 文档（用于特定功能/方法）并将其放在 wiki 标记中以便于传输。

从 phpDoc 获取 wiki 标记或 wiki 输出的任何解决方案？我环顾四周，一无所获。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-05-04T14:15:44.880

刚刚在寻找一种从 phpDoc 生成 Twiki 输出的方法时遇到了这个问题。我也没有找到一个好的解决方案，并在这里开始了一个项目：http: [//step2.co.in/content/phpdoc-twiki](http://step2.co.in/content/phpdoc-twiki)开始着手这方面的工作。如果有人有兴趣帮忙，请联系。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T20:35:40.247

根据 PHPDocumentor 网站及其[文档](http://manual.phpdoc.org/)，HTML 和 XML 输出是可能的。然后，您可以使用 MediaWiki 的内置[导入](http://www.mediawiki.org/wiki/Manual:Importing_XML_dumps)功能导入 XML，尽管您可能希望先导出以查看 XML 的格式。他们还提到，使用 XML 导入大量数据可能会导致超时，并且有一种替代方法允许您创建 SQL 查询来插入数据。此外，您可能需要一个 MediaWiki 扩展来显示代码（类似于[SyntaxHighlight GeSHi](http://www.mediawiki.org/wiki/Extension:SyntaxHighlight_GeSHi)）。

所有这些并没有真正解释如何将 PHPDocumentor 的输出转换为 MediaWiki 可用的东西（即使用 Wiki 语法）。您很可能会使用脚本将一种语法转换为另一种语法。看起来通过 PHPDocumentor 创建自己的输出格式是最简单的方法（尽管输出为 XML:DocBook 可能有效）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T20:05:57.557

一种选择（我想不到）是使用 MediaWiki 内置的 API，然后自己发布数据。（当然是通过脚本）。

唯一的另一种方法是破解 phpDoc，即使那样，您也必须以某种方式将其发布到 MediaWiki。

# memory - 系统信息的跨平台API

> ID：654643
> 
> 赞同：4
> 
> 时间：2009-03-17T15:06:07.563
> 
> 标签：memory, cross-platform, cpu-cores

我正在寻找可以提供此类信息的库：

RAM
交换空间
CPU 数量
速度 (CPU MHz)
内核数量
芯片类型

最终我会从 Java 调用它，但是一个 C 库会很好，我可以用 JNI 包装它。

感兴趣的平台包括但不限于 AIX、HP-UX、Solaris、Windows。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T22:00:02.357

像你一样，我正在寻找一个跨平台系统信息库，发现了这个：

[http://code.google.com/p/geekinfo/](http://code.google.com/p/geekinfo/)

我还没有测试它，但它可能适合您的需求。

祝你好运 ！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-22T07:34:46.377

您可以查看[Sigar](http://www.hyperic.com/products/sigar.html)，它支持您想要的指标和平台，并且同时具有 C 和 Java API。它是 GPL，它可能适合也可能不适合您的需求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:16:51.997

您是否希望远程查询这些系统？如果是这样，您最好的选择可能是使用[SNMP](http://en.wikipedia.org/wiki/Simple_Network_Management_Protocol) [库](http://www.snmp4j.org/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T15:17:14.180

您可能想查看以下文档站点：[http ://en.wikipedia.org/wiki/Hardware_abstraction_layer](http://en.wikipedia.org/wiki/Hardware_abstraction_layer)

还可以查看 Open Audit 计算机审计和库存跟踪系统[http://www.open-audit.org](http://www.open-audit.org)源代码及其用于审计 linux 机器的脚本，以获取查询 hal 数据库的示例。

您可能还想查看[Nagios Plugins](http://nagiosplugins.org)项目以获取大量用于从其他机器远程收集统计信息的开源脚本。 [Nagios](http://nagios.org/)被设计为数据中心的企业管理/正常运行时间监控系统，但脚本可以很容易地独立使用，以在不同配置下进行监控。

# c++ - 使用 const 防止数据类型更改和值更改

> ID：654645
> 
> 赞同：1
> 
> 时间：2009-03-17T15:06:45.440
> 
> 标签：c++, constants

使用 const 有什么区别：

无法更改数据类型，但可以更改 a 或 b 的值

```
int add(const int a, const int b); 
```

可以更改数据类型但不能更改 a 或 b 的值

```
int add(int const a, int const b); 
```

无法更改数据类型，也无法更改 a 或 b 的值

```
int add(const int const a, const int const b); 
```

非常感谢您的任何建议

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T15:10:40.873

**const int 和 int const 的区别：**

int const 和 const int 是一样的。

但是指针有区别：

```
char sz[3] = "hi";

//const char* allows you to change what is pointed to,
//but not change the memory at the address that is pointed to
const char *p = sz;
p = "pi";//ok
//p[0] = 'p';//not valid, bad

//char * const allows you to change the memory at the address that is 
//pointed to, but not change what is pointed to.
char * const q = sz;
//q = "pi";//not valid, bad
q[0] = 'p';//ok

//or disallow both:
const char * const r = sz;
//r = "pi";//not valid, bad
//r[0] = 'p';//not valid, bad 
```

大多数时候你想使用 const char *。

**更改变量的类型：**

您无法更改变量的类型，但可以将变量的地址重新解释为另一种类型。为此，您使用强制转换。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T15:24:15.083

我不知道应该如何更改 C++ 中变量的数据类型...

'const' 是你对编译器做出的关于不修改值的承诺。当您不这样做时它会抱怨（可能在此过程中发现 z 错误）。它还有助于它进行各种优化。

以下是一些 const 示例及其含义：

```
f ( const int a  ) 
```

f 不能改变 'a' 的值。

```
f ( int const a ) 
```

一样的，但是写的很奇怪

```
f ( const int const a ) 
```

没有任何意义，gcc 告诉我“重复的 const”

```
f ( const int * pa ) 
```

f 不能改变 pa 指向的值

```
f ( int * const pa ) 
```

f 不能改变指针的值

```
f ( const int * const pa ) 
```

f 不能改变指针的值，也不能改变指向的值

```
f ( int a ) const 
```

成员函数 f 不能修改其对象

希望它能让事情更清楚..

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T15:24:42.667

您永远不能更改任何变量的数据类型。如果你有`const int`它和`int const`往常一样。但是，对于函数声明，有一些特殊情况。

实际上，

```
int add(const int a, const int b); 
```

和

```
int add(int a, int b); 
```

或其中的任何组合`const`都声明相同的功能。在外面，它们都是相同的，实际上也都是相同的类型。它只对函数的定义很重要。如果你不放 const

```
int add(int a, int b) { a++; /* possible, increment the parameter */ } 
```

您可以更改参数（在此示例中是传递的参数的副本）。但是如果你把 const 放在函数定义中，参数将是 const

```
int add(int const a, int const b) {
    a++; // bug, a is a constant integer!
} 
```

为什么为函数声明编写 const 与否无关紧要？因为参数将被复制，所以无论如何它不会对调用者和调用者参数产生任何影响！因此，建议使用以下样式。在标头中，声明不带 const 的函数

```
int add(int a, int b); 
```

然后，在定义中，如果您希望参数为 const，请将 const 放入。

```
#include "add.hpp"

// remember, const int and int const is the same. we could have written
// int add(const int a, const int b); too
int add(int const a, int const b) { return a + b; } 
```

成员函数的计数相同

```
struct foo {
    void f(int);
};

void foo::f(int const a) { ... } 
```

请注意，我们只讨论了直接影响参数的 const 的 const。在使用引用或指针时，还有其他 const 会影响 constness。*这些*常量*不容*忽视，实际上很重要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T15:24:40.170

```
const int x; 
```

是相同的

```
int const x; 
```

关键字的顺序不相关。这也适用于**unsigned**等关键字：

```
const unsigned int x;

int unsigned const x; 
```

但是，此规则不适用于指针，因为星号 (*) 不是关键字，而是运算符。所以前面的规则不适用：

```
const int *x; 
```

不**一样**：

```
int * const x; 
```

# python - 如何使用 dict.fromkeys 为每个键创建唯一值？

> ID：654646
> 
> 赞同：12
> 
> 时间：2009-03-17T15:06:46.343
> 
> 标签：python, dictionary, fromkeys

首先，我是 Python 新手，所以如果我忽略了某些内容，我深表歉意，但我想使用`dict.fromkeys`（或类似的东西）创建一个列表字典，其中的键在另一个列表中提供。我正在执行一些计时测试，我希望键成为输入变量，列表包含运行时间：

```
def benchmark(input):
    ...
    return time_taken

runs = 10
inputs = (1, 2, 3, 5, 8, 13, 21, 34, 55)
results = dict.fromkeys(inputs, [])

for run in range(0, runs):
    for i in inputs:
        results[i].append(benchmark(i)) 
```

我遇到的问题是字典中的所有键似乎都共享同一个列表，并且每次运行都只是附加到它。有没有办法为每个键生成一个唯一的空列表`fromkeys`？如果没有，是否有另一种方法可以在不手动生成结果字典的情况下做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T15:15:24.623

查看[defaultdict](http://docs.python.org/library/collections.html#collections.defaultdict)（需要 Python 2.5 或更高版本）。

```
from collections import defaultdict

def benchmark(input):
    ...
    return time_taken

runs = 10
inputs = (1, 2, 3, 5, 8, 13, 21, 34, 55)
results = defaultdict(list) # Creates a dict where the default value for any key is an empty list

for run in range(0, runs):
    for i in inputs:
        results[i].append(benchmark(i)) 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-17T15:16:09.410

问题是在

```
results = dict.fromkeys(inputs, []) 
```

[] 只被评估一次，就在那里。

我会这样重写这段代码：

```
runs = 10
inputs = (1, 2, 3, 5, 8, 13, 21, 34, 55)
results = {}

for run in range(runs):
    for i in inputs:
        results.setdefault(i,[]).append(benchmark(i)) 
```

其他选项是：

```
runs = 10
inputs = (1, 2, 3, 5, 8, 13, 21, 34, 55)
results = dict([(i,[]) for i in inputs])

for run in range(runs):
    for i in inputs:
        results[i].append(benchmark(i)) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T15:24:09.610

如果您不想学习任何新东西，您也可以这样做（尽管我建议您这样做！）我很好奇哪种方法更快？

```
results = dict.fromkeys(inputs)

for run in range(0, runs):
    for i in inputs:
        if not results[i]:
            results[i] = []
        results[i].append(benchmark(i)) 
```

# mysql - 具有只读访问权限的 MySQL 的 ODBC 5.1 连接字符串

> ID：654656
> 
> 赞同：2
> 
> 时间：2009-03-17T15:09:14.077
> 
> 标签：mysql, database, odbc, connection-string, database-connection

我对 MySQL 数据库具有读取权限，并尝试通过 MySql ODBC 5.1 驱动程序连接到它。我从服务器收到授权失败 (401)。管理员设置我的访问权限如下：

```
mysql> grant select, create temporary tables on theDatabase.* to 'adrian' identified by 'password'; 
```

我成功地使用 dbvisualizer 等工具连接到数据库。

我试图在 C#.NET 中使用的连接字符串如下：

```
"Driver={MySQL ODBC 5.1 Driver};Server=theDatabaseServer;Database=theDatabase;User=adrian;Password=password;Option=3;" 
```

也许问题与无法在连接字符串中指定我的有限授权有关？关于如何解决这个问题的任何建议（无需请求完全访问数据库）？

“Option=3”有什么魔力……还有其他选择吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T15:16:12.093

尝试在查询字符串中输入用户“uid”和密码“pwd”。这应该是一个有效的连接字符串：

```
string ConnectionString = @"driver={MySQL ODBC 3.51 Driver};server=localhost;database=books;uid=band;pwd=letmein;"; 
```

# .net - SQLDatasource CommandTimeout 不起作用

> ID：654657
> 
> 赞同：1
> 
> 时间：2009-03-17T15:09:23.887
> 
> 标签：.net, sql-server-2005, sqldatasource

再会，

我正在使用 SQLDataSource 和动态查询生成的 c#，基于许多字段中的用户选择。但是，由于我们的表非常大，有时我会收到命令超时异常。

我试图在 SqlDataSource 的“选择”中设置属性，如下所示：

```
protected void SqlDataSource_PSearch_Selecting(object sender, SqlDataSourceSelectingEventArgs e)
{
    e.Command.CommandTimeout = 900;            
} 
```

但没有运气，就像这个属性被忽略一样。

```
.NET 2.0, Sql server 2005. 
```

任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T15:24:17.673

我对 SqlDataSource 不是很熟悉，但是 CommandTimeout 的文档提到了两种可能性：

*   在异步方法调用（例如 BeginExecuteReader）期间，CommandTimeout 属性将被忽略。

*   当针对上下文连接执行命令时，CommandTimeout 无效（在连接字符串中使用“context connection=true”打开的 SqlConnection）。

你在使用 AJAX 吗？这可能会导致异步方法调用。

# tomcat - 了解来自 JMX MBeans 的 tomcat HTTP 连接器端口

> ID：654658
> 
> 赞同：2
> 
> 时间：2009-03-17T15:09:40.423
> 
> 标签：tomcat, jmx

我正在通过 JMX 连接到 tomcat。我编写了一个简单的 JMX 客户端来连接 tomcat 并读取不同的 JMX MBean 属性来监控 tomcat。我的问题是，我想知道tomcat 的HTTP 连接器在监听哪个端口。有没有办法通过 JMX Mbean 获取这些详细信息 - 无需读取 tomcat 的 server.xml 文件。但是要通过一个 MBean 的某些属性来获得它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-03-11T08:49:52.667

每个连接器都有一个专用的 MBean。您可以通过查询来获得所有这些 MBean 的 ObjectName `*:type=Connector,*`。当然，可以有多个连接器。这些 MBean 有一个属性`port`，您可以从中查询端口号。

如果您使用[jmx4perl](http://www.jmx4perl.org)，您可以轻松地查询这些属性

```
jmx4perl http://localhost:8080/jolokia read *:type=Connector,* port

{
  "Catalina:port=8009,type=Connector" => {
     port => 8009
  },
  "Catalina:port=8080,type=Connector" => {
     port => 8080
  }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T15:18:29.093

MBean 被称为类似`Catalina:type=ThreadPool,name=http-8080`. 如您所见，连接器端口在名称中。

# c# - 我需要使用 C# 和 ASP.Net 构建一个非常轻量级的 Ajax 引擎。你有什么建议？

> ID：654664
> 
> 赞同：0
> 
> 时间：2009-03-17T15:10:41.530
> 
> 标签：c#, asp.net, jquery, ajax

我之前为我的一个项目创建了一个快速的 Ajax 框架。这是一个 ASP.Net 网站 (C#)。没有很多 Ajax 类型的函数，所以我只是创建了一个新页面，其中没有任何内容，并且在文件后面的代码中，我将一些代码放入 Page_Load 方法中，该方法将在请求中查找操作，然后调用适当的方法。

我再次处于相同的场景中，我发现我很想再次做同样的事情。我让用户创建一个新的住宿。属于住宿的两个字段是住宿类型和面积。这两个字段都由用户维护，因此他们可以在其他页面上对这两个字段进行 CRUD。我在想，如果该地区或住宿类型尚不存在，则必须转到另一个页面会很烦人。因此，我想给他们添加新区域和在同一表格中添加新住宿类型的功能。所以我有住宿类型的复选框，当他们单击新建时，我向他们显示一个文本框，他们输入值并单击添加。它对数据库进行 Ajax 调用以添加值，然后如果成功，则会出现一个新的复选框，否则会出现错误消息。

不过这次我也使用了一些 jQuery。我对 jQuery 的 Ajax 库还不太熟悉。我的问题是，“有没有...

1.  更好的
2.  更轻松
3.  更聪明
4.  更可扩展
5.  上述所有的

这样做的方法。”如果可以，请您指出正确的方向。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T15:15:07.430

鉴于 VS2008 已经在 IDE 中内置了对 AJAX 的支持（以及即将推出的 jQuery 支持），我认为您会发现很难想出不仅是更好的*用户*体验而且是更好的*开发人员*体验的东西。

Visual Studio 团队不仅投入了大量资源来使这项工作顺利进行，而且他们还知道如何将功能集成到 IDE 中，几乎可以肯定比您做得更好（我怀疑这样做的访问权限更多）。

如果您想这样做是为了好玩（或作为 MonoDevelop 的一部分，例如），这是有道理的 - 但从生产力的角度来看，我会坚持使用 Visual Studio。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T15:17:41.653

我认为您不需要创建一个全新的 Ajax 框架。许多人已经将大量时间和精力投入到其他框架中，例如 Asp.net Ajax、jQuery 等。花一些时间来了解这些框架为您提供了什么以及如何使用它们。如果您仍然发现它们缺乏，几乎所有这些都可以扩展其已构建的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:19:46.420

我不会重复 Jon Skeet 所说的话，我相信还有 20 个人正在打字。但是，如果您决定自己动手，而不是使用空白的 ASPX 页面，请考虑创建自己的[Http Handler](http://msdn.microsoft.com/en-us/library/f3ff8w4a(VS.71).aspx)。在视觉工作室中，您可以创建自己的快速而肮脏的处理程序。它们的扩展名为 .ASHX。这样做的好处是避免了页面对象框架的开销。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T15:20:49.320

根据我的经验，jQuery 是一个非常好的库，有很多社区支持。如果您在文档中找不到所需的内容，请查看 jQuery IRC 频道。我们有一个 Ajax 密集型应用程序，它在 jQuery 作为其核心框架上运行。我们对结果感到满意。如果您担心大小，Google 会托管 jQuery，以便您的客户可以在本地缓存它。

或者，您可能只想创建适当的 HttpHandler(s)，以允许您的客户端代码调用服务器端资源，而无需传统 ASP.NET Page 类的开销。

[从 MSDN 查看这篇文章](http://msdn.microsoft.com/en-us/library/f3ff8w4a(VS.71).aspx)

# php - PHP 无法将包含 PHP 代码的文件作为文本文件读取

> ID：654688
> 
> 赞同：3
> 
> 时间：2009-03-17T15:15:59.783
> 
> 标签：php, security, permissions, fopen

我偶然发现了以下特点：

$handle = fopen(realpath("../folder/files.php"), "r");

无法读取文件，但是一旦我从文件中删除 php 标签，它就会变得可读，并且我的脚本会在页面上打印非空文件内容。此外， file.php 永远不会执行，所以我想知道为什么会出现问题。

我想不知何故 Apache 或 PHP 不允许将包含 php 标签 PHP 的文件作为文本读取。

如何为我的特定文件启用它（当然在全球范围内这样做是不安全的）？

使用 PHP 5.2.x 和 Apache 2.0

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-17T15:47:55.027

我得到了它。我正在使用 Google chrome 调试页面，我意识到在查看源代码时，Chrome 出于某种原因隐藏了 PHP 标签。我在 Firefox 上进行了相同的测试，查看源代码证明一切正常。

以下是测试详情：

代码：

```
$fh = fopen("test.php","r");
while ($line = fgets($fh)){
echo $line;
} 
```

要读取的文件（test.php）：

```
testing <?php testing2 ?> testing3 
```

渲染（在 Chrome 和 firefox 上）：

```
testing  testing3 
```

查看源代码（使用火狐）：

```
testing <?php testing2 ?> testing3 
```

查看源代码（使用 Chrome - 我的错误来源）：

```
testing  testing3 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T15:44:00.467

你确定你正确地解释了输出吗？如果您将文件内容直接打印到页面输出，浏览器将不会在尖括号内显示文本，因为它认为这是一个标签。将您的内容提供为`text/plain`，或使用浏览器的“查看源代码”命令来确保您看到的是真正存在的内容，而不仅仅是浏览器选择显示的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T15:31:39.607

嗯 file_get_contents() 正在为我工​​作。只有fopen才有问题吗？

编辑：你到底得到了什么错误？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T15:51:12.743

Wadih M. 解决了这个问题。PHP 标签在浏览器中隐藏了整个标签封闭的 php 源输出，但 View Source 显示了它们。谢谢！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-29T08:49:09.983

我在用`htmlspecialchars($line);`

它解决了这个问题。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-17T15:51:23.570

重命名文件读取它获取您的数据更改它们重命名您的文件:)

# c# - TreeView 节点似乎正在缓存

> ID：654695
> 
> 赞同：1
> 
> 时间：2009-03-17T15:17:14.400
> 
> 标签：c#, treeview

我正在 c# 中创建一个自定义 Web 用户控件。它旨在与权限层次结构进行交互。我们有不同的“站点”，每个站点都有很多“应用程序”，每个应用程序都有很多“权限”

因此，我们有一个 TabPanel 可以为每个站点加载一个选项卡。然后在每个选项卡中，我们有一个 TreeView，其中父节点是应用程序，内部节点是权限。

Permissions 根据某些条件显示复选框，并根据 HasPermission 函数是否返回 true 进行检查。

所有这些代码都有效......但仅适用于选择的第一个用户。对于选择的任何后续用户，调试器的一个步骤显示正在执行的所有正确逻辑，但页面显示的信息与选择的第一个用户的信息相同。

所以基本上，它将显示保存在某个地方……我不知道在哪里。

```
public partial class Permissions : System.Web.UI.UserControl
{
    string _NTLogin;
    CoreUser _User;
    bool _IsAdmin;
    public string NTLogin
    {
        get
        {
            return _NTLogin;
        }
        set
        {
            ViewState["NTLogin"] = value;
            _NTLogin = value;
        }
    }
    public bool IsAdmin
    {
        get
        {
            return _IsAdmin;
        }
        set
        {
            ViewState["IsAdmin"] = value;
            _IsAdmin = value;
        }
    }
    protected void Page_Load(object sender, EventArgs e)
    {

    }
    public void LoadTabs()
    {
        string [] sites = MISCore.BusinessLayer.CorePermission.GetSites();
        foreach (string site in sites)
        {
            TabPanel tp = new TabPanel();
            tp.HeaderText = site;
            TabContainer1.Tabs.Add(tp);
        }
    }
    public void LoadTrees()
    {
        if(_User == null)
            return;
        TabPanelCollection tabs = TabContainer1.Tabs;
        foreach (TabPanel tab in tabs)
        {
            string site = tab.HeaderText;
            string[] apps = MISCore.BusinessLayer.CorePermission.GetApplications(site);
            TreeView tv1 = new TreeView();
            tv1.EnableViewState = false;
            foreach (string app in apps)
            {
                TreeNode tn1 = new TreeNode(app);
                tn1.SelectAction = TreeNodeSelectAction.None;
                string[] perms = MISCore.BusinessLayer.CorePermission.GetPermissions(site, app);
                foreach (string perm in perms)
                {
                    TreeNode tcn1 = new TreeNode(perm);
                    tcn1.SelectAction = TreeNodeSelectAction.None;
                    if (IsAdmin || _User.Manager.HasPermission(site, app, perm))
                    {
                        tcn1.ShowCheckBox = true;
                        if (_User.HasPermission(site, app, perm))
                        {
                            tcn1.Checked = true;
                        }
                        else
                        {
                            tcn1.Checked = false;
                        }
                    }
                    else
                    {
                        tcn1.ShowCheckBox = false;
                    }
                    tn1.ChildNodes.Add(tcn1);
                }
                tv1.Nodes.Add(tn1);
            }
            tab.Controls.Add(tv1);
        }

    }
    protected override void LoadViewState(object savedState)
    {
        base.LoadViewState(savedState);
        _NTLogin = (string)ViewState["NTLogin"];
        _IsAdmin = (bool)ViewState["IsAdmin"];
        if(_NTLogin != null)
            _User = new CoreUser(_NTLogin);
        TabContainer1.Tabs.Clear();
        LoadTabs();
        LoadTrees();
    }
} 
```

[更新] 在上述所有代码之后，我遍历树视图，它正确存储了它们的正确状态。这是显示的问题。我可以成功更改任何其他属性、工具提示、文本等以显示它们的状态，但复选框没有更新......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T19:49:22.717

应该很简单，在选项卡的参数中只需添加 EnableViewState = false。让我知道这是否适合您。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T15:31:41.603

我会使用[Fiddler](http://www.fiddlertool.com/fiddler/)来查看谁在缓存结果。通过查看请求，您将能够判断是浏览器还是服务器导致了问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T17:53:46.083

或者，如果您的客户端没问题，您可以放入一个显示刷新的小链接按钮，您或用户可以在需要时强制执行此刷新树视图方法。

# visual-studio - 如何在 Visual Studio 中调试外部类库项目？

> ID：654696
> 
> 赞同：160
> 
> 时间：2009-03-17T15:17:15.757
> 
> 标签：visual-studio, debugging

我有一个项目（A），它从位于另一个 vs 解决方案中的外部项目（B）类库中引用程序集。

我还没有理解如何在从项目 A 运行程序的同时有效地从 B 调试类库。我必须在项目 B 上启用一些东西，例如调试信息等，以便我可以在调试时从 A 介入吗？

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2009-03-17T15:20:28.807

尝试禁用 Just My Code (JMC)。

*   工具 > 选项 > 调试
*   取消选中“仅启用我的代码”

默认情况下，调试器会尝试将世界视图限制为仅包含在您的解决方案中的代码。有时这确实很有帮助，但是当您想要调试不在您的解决方案中的代码时（就像您的情况一样），您需要禁用 JMC 才能看到它。否则，代码将被视为外部代码，并且很大程度上隐藏在您的视野之外。

**编辑**

当您的代码中断时，请尝试以下操作。

*   调试 > 窗口 > 模块
*   找到您感兴趣的项目的 DLL
*   右键单击 > 加载符号 > 为您的其他项目选择 .PDB 的路径

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2015-01-27T10:00:01.160

假设路径

**项目`A`**

```
C:\Projects\ProjectA 
```

**项目`B`**

```
C:\Projects\ProjectB 
```

ProjectB 的 dll 在

```
C:\Projects\ProjectB\bin\Debug\ 
```

要调试到`ProjectB`from `ProjectA`，请执行以下操作

1.  将`B`'s 的 dll 和 dll's复制`.PDB`到`ProjectA`'s 的编译目录。
2.  现在调试`ProjectA`。当代码到达调试时需要调用dll的方法或事件等的部分时，按`F11`进入dll的代码。

**注意：不要错过复制 .PDB 文件**

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-05-08T19:54:55.137

这困扰了我一段时间。我通常最终做的是使用调试模式重建我的外部库，然后将 .dll 和 .pdb 文件复制到我网站的 bin 中。这使我可以进入库代码。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-08-08T17:23:15.867

我运行了两个 Visual Studio 实例——一个用于外部 dll，一个用于主应用程序。
在外部dll的项目属性中，设置如下：

构建事件：

*   `copy /y "$(TargetDir)$(TargetName).dll" "C:\<path-to-main> \bin\$(ConfigurationName)\$(TargetName).dll"`

*   `copy /y "$(TargetDir)$(TargetName).pdb" "C:\<path-to-main> \bin\$(ConfigurationName)\$(TargetName).pdb"`

调试：

*   启动外部程序：`C:\<path-to-main>\bin\debug\<AppName>.exe`

*   工作目录`C:\<path-to-main>\bin\debug`

这样，每当我构建外部 dll 时，它都会在主应用程序的目录中更新。如果我从外部 dll 的项目中进行调试 - 主应用程序运行，但调试器仅在外部 dll 中命中断点。如果我从主项目中进行调试，主应用程序将使用最近构建的外部 dll 运行，但现在调试器仅在主项目中命中断点。

我意识到一个调试器可以同时完成这两个工作，但我发现以这种方式保持两者一致更容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-19T19:48:50.697

[根据马丁贝克特，给我这个答案的人]

您可以调试到外部库。

在项目设置选项卡中，在“源代码”字段中查找“Visual Studio 目录”，包括 openCV 源的路径。然后确保每个调试 dll 的 .pdb 文件与 dll 位于同一目录中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-07-19T14:32:40.467

我遇到了类似的问题，因为我在 project(B) 中的断点没有被击中。我的解决方案是重建项目（B），然后调试项目（A），因为需要更新 dll。

Visual Studio 应该允许您调试到外部库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-01-29T10:30:33.407

**NuGet 引用**

假设 -Project_A（生成 project_a.dll）-Project_B（生成 project_b.dll）和 Project_B 通过 NuGet 包对 Project_A 的引用，然后只需将 project_a.dll、project_a.pdb 复制到文件夹 Project_B/Packages。实际上，应该将其复制到 /bin。

现在调试 Project_A。当代码到达调试时需要调用dll的方法或事件等的部分时，按F11进入dll的代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-05-20T12:50:03.840

一次性完成此操作的最快方法是直接在您正在编辑和启动项目 A 的 Visual Studio 实例中打开 Proj B 文件（文件 => 打开 => 文件）。您无需将文件添加到解决方案中。只需在编辑器中打开它，您就可以直接在项目 B 文件中创建断点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-01-24T12:36:11.170

如果您有**主库（项目 A）**和**外部库（项目 B）**：

1.  **在 Visual Studio 中**打开（项目 A）解决方案。****

***   右键单击**解决方案**->**添加现有项目**->然后选择外部库**（项目 B）****的 .csproj 文件**。

    ***   再次在 Visual Studio 中**右键单击 (project A)** -> **Add** -> **Project Reference...** -> 然后在要调试的外部库上**添加复选标记****(project B)**。

    *   最后在调用外部库（项目 B）的**（项目 A）中****放置刹车点并****使用 F5 运行**。**** 

 ******# apache - 从 Tomcat 提供静态内容的速度有多慢？

> ID：654701
> 
> 赞同：17
> 
> 时间：2009-03-17T15:18:15.287
> 
> 标签：apache, tomcat, webserver

所以，我有一个带有大量 JSP、servlet 的 webapp，其中很多都使用 IceFaces。显然，其中大部分都必须保留在 Tomcat 中。

但是，有人告诉我，Tomcat 上的静态内容（HTML、图像等）比 Apache 之类的纯网络服务器要慢。我的理解是，当您使用 Tomcat 作为独立网络服务器时，它首先使用的是 Apache 版本。当然，我可能在这方面弄错了。

但是从 Tomcat 提供静态图像或文件的惩罚*是什么？*是否值得为低容量站点使用自己的网络服务器？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T15:28:02.143

有关一些信息，请参阅[Tomcat 连接器常见问题解答。](http://wiki.apache.org/tomcat/FAQ/Connectors)对于现代版本的 Tomcat，性能差异比**以前小得多**。对于低容量站点，没有理由不能使用 Tomcat 提供所有内容。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-20T17:56:02.450

我同意，除非有两种情况

1.  使用 JSSE 的 Tomcat 的 SSL 明显较慢。有可以插入的本机版本，但这往往更痛苦。一般来说，SSL 不如广为人知的 Apache Httpd 服务器那么简单

2.  使用 HTTpd 服务器为虚拟 Web 主机等提供了更大的灵活性。Tomcat 在这方面没有那么灵活。不出所料，它缺少 Apache 中的所有选项 :)。一个明显的好处是内置的静态文件压缩很容易在 Apache 中添加。在tomcat中并不难，但更多的是工作。

3.  你误会了。Apache Httpd Server 是一个完全不同的野兽，没有与 Tomcat 共享的代码。

如果两者都不是问题，那么可以单独使用tomcat

# database - Oracle 导入错误

> ID：654702
> 
> 赞同：1
> 
> 时间：2009-03-17T15:18:27.500
> 
> 标签：database, oracle, oracle10g

我正在尝试导入数据库，但出现此错误：

```
Imp-00009 Abnormal end of export file
Imp-00020 Long column too large for column buffer size(7) 
```

导入创建了四个表并为其中三个创建了行，我来宾说，当导入尝试为最后一个表创建行时，我得到了错误。

我尝试在导入命令中使用“Buffer=100000”参数，结果相同。

有任何想法吗？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T15:24:08.610

根据 Oracle 文档：

IMP-00009：导出文件异常结束原因：导出文件可能来自中止的导出会话。行动：如果是这样，重试导出和导入。否则，将此报告为导入错误并将导致此错误的导出文件提交给客户支持。

因此，损坏的导出文件很有可能。但是，如果不是损坏的导出文件，则根据：

IMP-00020：对于列缓冲区大小（数量）而言，长列太大 原因：列缓冲区太小。这通常在导入 LONG 数据时发生。行动：一次增加插入缓冲区大小 10,000 个字节（例如）。使用这种循序渐进的方法，因为太大的缓冲区大小可能会导致类似的问题。

您可以尝试一次将缓冲区大小增加 10000 字节，因为正如文档所述，过长的错误大小会导致相同的消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-09-09T19:58:38.377

尝试将缓冲区大小增加到 10000000。我必须增加到大约 100000000 才能让它工作。取决于列的大小。

# grails - Grails/GORM 默认获取策略：何时将 fetchMode 设置为“eager”？（渴望与懒惰）

> ID：654704
> 
> 赞同：6
> 
> 时间：2009-03-17T15:18:59.763
> 
> 标签：grails, grails-orm

关于何时在域类中将 fetchMode 设置为“eager”的一些一般准则是什么？fetchMode“eager”与默认“lazy”的优缺点？

请包括一些具体的示例/用例，显示何时使用“eager”（fetchMode=eager），何时不使用（fetchMode=lazy）。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-17T15:56:53.900

基本上延迟加载比急切的替代方案（性能、资源的使用）有更多的好处。由于它是所有关系的默认 grails 设置（自 Grails 1.1 起），您通常不应将其配置为急切获取，除非您遇到某些问题。如：

*   跨不同的休眠会话共享域实例（例如，将域类实例放入 http 会话范围并从中访问属性 - 例如用户）
*   访问布局/视图中的域类实例时获取 LazyInitializationException
*   当您确定每次（或大部分时间）获取实例时，您将访问某个关系属性，配置此关系以进行急切获取也是有意义的。

在处理大型数据库时，急切获取可能非常危险。想象一个像这样的域类：

```
// really bad example
class TreeNode {

   String name            

   TreeNode parent

   static hasMany = [ childNodes: TreeNode ]

   static mapping {     
      parent lazy: false
      childNodes lazy: false
   }

} 
```

当您读取任何 TreeNode 实例时，它会自动将域类的所有其他实例从数据库中拉到您的内存中。当有足够的实例时，您可能会通过仅获取 1 个实例来杀死您的应用程序。

# c++ - .o 文件与 .a 文件

> ID：654713
> 
> 赞同：69
> 
> 时间：2009-03-17T15:20:45.263
> 
> 标签：c++, c, linux, gcc, build-process

这两种文件类型有什么区别。我看到我的 C++ 应用程序在构建可执行文件期间链接了这两种类型。

如何构建 .a 文件？链接，参考，尤其是示例，非常感谢。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-03-17T15:24:03.370

`.o`文件是对象。它们是编译器的输出和链接器/图书馆员的输入。

`.a`文件是档案。它们是对象组或静态库，也被输入到链接器中。

**附加内容**

我没有注意到您问题的“示例”部分。通常，您将使用生成文件来生成静态库。

```
AR = ar 
CC = gcc

objects := hello.o world.o

libby.a: $(objects)
    $(AR) rcu $@ $(objects)

%.o: %.c
    $(CC) $(CFLAGS) -c $< -o $@ 
```

这将编译成对象，`hello.c`然后`world.c`将它们归档到库中。根据平台的不同，您可能还需要运行一个调用`ranlib`来生成存档目录的实用程序。

一个有趣的旁注：`.a`文件在技术上是*存档文件*而不是库。它们类似于没有压缩的 zip 文件，尽管它们使用更旧的文件格式。像这样的实用程序生成的目录`ranlib`是使存档成为*库*的原因。Java 归档文件 ( `.jar`) 的相似之处在于它们是具有一些由 Java 归档器创建的特殊目录结构的 zip 文件。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-17T15:30:20.750

.o 文件是编译单个编译单元（本质上是源代码文件，带有关联的头文件）的结果，而 .a 文件是打包为库的一个或多个 .o 文件。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-17T17:13:39.847

D Shawley 的回答很好，我只想补充几点，因为其他答案反映了对正在发生的事情的不完整理解。

请记住，存档文件 (.a) 不限于包含目标文件 (.o)。它们可能包含任意文件。不经常有用，但请参阅[存档中嵌入的动态链接器依赖信息](https://stackoverflow.com/questions/573163/dynamic-linker-dependenciy-info-embedded-in-an-archive/)以获得愚蠢的链接器技巧。

另请注意，目标文件 (.o) 不一定是单个编译单元的结果。可以将几个较小的目标文件部分链接到一个较大的文件中。

[http://www.mihaiu.name/2002/library_development_linux/](http://www.mihaiu.name/2002/library_development_linux/) -- 在此页面中搜索“部分”

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-17T16:02:39.923

您可以使用从文件（目标文件）`ar`创建`.a`文件（静态库）`.o`

详情请参阅`man ar`。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2020-11-21T18:59:37.073

`.a`链接vs`.o`文件还有一个方面：链接时，所有`.o`作为参数传递的 s 都包含在最终的可执行文件中，而来自任何`.a`参数的条目只有在解决程序中的符号依赖关系时才会包含在链接器输出中。

更具体地说，每个`.a`文件是一个包含多个`.o`文件的档案。您可以认为每个`.o`都是代码的原子单元。如果链接器需要来自这些单元之一的符号，则整个单元将被吸入最终的二进制文件；但其他人都不是，除非他们也需要。

相反，当您`.o`在命令行上传递 a 时，链接器会因为您请求它而将其吸入。

为了说明这一点，请考虑以下示例，其中我们有一个包含两个对象`a.o`和`b.o`. 我们的程序只会引用来自`a.o`. 我们将比较链接器如何处理传递`a.o`和`b.o`一起，与包含相同两个对象的静态库。

```
// header.hh
#pragma once

void say_hello_a();
void say_hello_b(); 
```

```
// a.cc
#include "header.hh"
#include <iostream>

char hello_a[] = "hello from a";

void say_hello_a()
{
        std::cout << hello_a << '\n';
} 
```

```
// b.cc
#include "header.hh"
#include <iostream>

char hello_b[] = "hello from b";

void say_hello_b()
{
        std::cout << hello_b << '\n';
} 
```

```
// main.cc
#include "header.hh"

int main()
{
        say_hello_a();
} 
```

我们可以使用这个 Makefile 编译代码：

```
.PHONY = compile archive link all clean

all: link

compile:
        @echo ">>> Compiling..."
        g++ -c a.cc b.cc main.cc

archive: compile
        @echo ">>> Archiving..."
        ar crs lib.a a.o b.o

link: archive
        @echo ">>> Linking..."
        g++ -o main_o main.o a.o b.o
        g++ -o main_a main.o lib.a

clean:
        rm *.o *.a main_a main_o 
```

并获得两个可执行文件`main_o`，它们的不同之处在于在第一种情况下通过两个s 和在第二种情况下通过 a 提供`main_a`的内容`a.cc`和位置不同。`b.cc``.o``.a`

最后，我们使用该`nm`工具检查最终可执行文件的符号：

```
$ nm --demangle main_o | grep hello
00000000000011e9 t _GLOBAL__sub_I_hello_a
000000000000126e t _GLOBAL__sub_I_hello_b
0000000000004048 D hello_a
0000000000004058 D hello_b
0000000000001179 T say_hello_a()
00000000000011fe T say_hello_b() 
```

```
$ nm --demangle main_a | grep hello
00000000000011e9 t _GLOBAL__sub_I_hello_a
0000000000004048 D hello_a
0000000000001179 T say_hello_a() 
```

并观察到`main_a`实际上缺少`b.o`. 也就是说，链接器没有吸入`b.o`存档中的内容，`lib.a`因为没有`b.cc`引用任何符号。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-17T15:25:13.677

我相信 .a 文件是可以包含多个目标文件的存档。

# java - 在 Java 中，后自增运算符如何在 return 语句中起作用？

> ID：654715
> 
> 赞同：15
> 
> 时间：2009-03-17T15:21:09.537
> 
> 标签：java, operators

给定下面的代码，ixAdd 会做你所期望的，即在递增之前返回 ix 的值，但在离开函数之前递增类成员？

```
class myCounter {
    private int _ix = 1;

    public int ixAdd()
    {
        return _ix++;
    }
} 
```

当程序离开函数的堆栈框架（或Java中的任何内容）时，我不太确定后/前增量的通常规则是否也适用于返回语句。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-17T15:26:20.400

关键部分是在计算表达式后*立即发生后递增/递减。*它不仅发生在返回发生之前 - 它发生在任何以后的表达式被评估之前。例如，假设您写道：

```
class myCounter {
    private int _ix = 1;

    public int ixAdd()
    {
        return _ix++ + giveMeZero();
    }

    public int giveMeZero()
    {
        System.out.println(_ix);
        return 0;
    }
} 
```

这也会打印出递增的结果，因为递增发生在`giveMeZero()`调用之前。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-17T15:27:19.290

好吧，我们看一下字节码（`javap -c <classname>`自己用来看）：

```
Compiled from "PostIncTest.java"
class myCounter extends java.lang.Object{
myCounter();
  Code:
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object."<init>":()V
   4:   aload_0
   5:   iconst_1
   6:   putfield    #2; //Field _ix:I
   9:   return

public int ixAdd();
  Code:
   0:   aload_0
   1:   dup
   2:   getfield    #2; //Field _ix:I
   5:   dup_x1
   6:   iconst_1
   7:   iadd
   8:   putfield    #2; //Field _ix:I
   11:  ireturn

} 
```

如您所见，指令 6 和 7 在`ixAdd()`返回之前处理增量。因此，正如我们所预料的那样，减量运算符在 return 语句中使用时确实有效果。但是请注意，`dup`在这两个出现之前有一个指令；增加的值（当然）不会反映在返回值中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:24:27.627

是的，即使在退货声明中，通常的规则也适用于后期增量。基本上，它在低级别所做的是将返回值存储到寄存器中，然后递增类成员，然后从方法返回。

您可以在[稍后](https://stackoverflow.com/questions/654715/in-java-how-does-a-post-increment-operator-act-in-a-return-statement/654741#654741)对显示字节码的问题的回答中看到这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T15:26:36.280

是的，它确实。

但是不要那样做，在表达式中有副作用是不好的风格。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T15:31:23.693

它确实返回递增之前的值，然后递增_ix。因此，第一次在 myCounter 实例上调用 ixAdd 方法时，它将返回 1，第二次将返回 2，以此类推。

# wpf - 帮助为 ListBoxItem 创建样式

> ID：654720
> 
> 赞同：0
> 
> 时间：2009-03-17T15:22:16.913
> 
> 标签：wpf, formatting, listboxitem

我是样式的新手，需要帮助来为 ListBoxItem 创建一个样式，该样式将为项目提供透明背景，然后将鼠标悬停在上面时字体变为金色。单击时不应更改颜色，并在鼠标移开时恢复正常。它仍必须将所选对象传递给 ListBox 的 PreviewMouseRightButtonDown 事件

我目前使用来自 REUXABLES THEMES 的默认字典，但它是为应用程序显示的这一部分着色的一种方式。

谢谢，

```
 <DataTemplate x:Key="ItemsTemplate">
        <StackPanel Orientation="Vertical"
              Margin="0,5,0,5"
              Width="{Binding 
              Path=ActualWidth,
              RelativeSource={RelativeSource 
              Mode=FindAncestor, 
              AncestorType={x:Type ScrollContentPresenter}}}" MaxWidth="{Binding RelativeSource={RelativeSource FindAncestor, 
              AncestorType={x:Type ScrollViewer}}, Path=ViewportWidth}" >
            <TextBlock VerticalAlignment="Top" TextWrapping="Wrap" FontSize="14" Text="{Binding Path=CID}" />
                 <StackPanel Orientation="Horizontal" Margin="0,5,0,0" >
                    <TextBlock>
                        <Label Foreground="{DynamicResource DisabledForegroundBrush}" >Posted by</Label>
                        <Label Foreground="{DynamicResource DisabledForegroundBrush}" VerticalContentAlignment="Top" Content="{Binding Path=ACID}" />
                    </TextBlock>
                    <TextBlock>
                         <Label Foreground="{DynamicResource DisabledForegroundBrush}" Margin="3,0,0,0">at</Label>
                        <Label Foreground="{DynamicResource DisabledForegroundBrush}" Margin="3,0,3,0" VerticalContentAlignment="Top" Content="{Binding Path=Type}" />
                    </TextBlock>
                    <TextBlock>
                        <Label Foreground="{DynamicResource DisabledForegroundBrush}">(</Label>
                        <Label Foreground="{DynamicResource DisabledForegroundBrush}" VerticalContentAlignment="Top" Content="{Binding Path=Route}" />
                        <Label Foreground="{DynamicResource DisabledForegroundBrush}">)</Label>
                    </TextBlock>
                </StackPanel>

            </StackPanel>
    </DataTemplate>

    <Style x:Key="ItemsListBox" TargetType="{x:Type ListBoxItem}">
        <Setter Property="SnapsToDevicePixels" Value="true"/>
        <Setter Property="Background" Value="{DynamicResource Transparent}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource Transparent}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource Transparent}"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
    </Style>

<ListBox x:Name="ListViewFlightPlans" Grid.Column="0" ItemTemplate="{DynamicResource ItemsTemplate}" 
                         MaxWidth="800" ScrollViewer.HorizontalScrollBarVisibility="Disabled" BorderBrush="Black" BorderThickness="2,0,0,1">

            </ListBox> 
```

戴夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T17:57:27.197

不幸的是，更改`BorderBrush`为`ListBoxItem`不会产生您想要的效果，因为`Border`带有选择突出显示的 是 的 内部`ControlTemplate`的`ListBoxItem`。

[相反，您可以使用SystemColors.HighlightBrushKey](http://msdn.microsoft.com/en-us/library/system.windows.systemcolors.highlightbrushkey.aspx)的键添加新`Brush`资源，这是用于设置选择突出显示颜色的键。`ListBoxItem`

不活动的选择画笔使用[SystemColors.ControlBrushKey](http://msdn.microsoft.com/en-us/library/system.windows.systemcolors.controlbrushkey.aspx)的键，因此如果您用透明覆盖这两者，则`Brush`可以保证没有任何选择颜色。您可以在[本文](http://blogs.msdn.com/wpfsdk/archive/2007/08/31/specifying-the-selection-color-content-alignment-and-background-color-for-items-in-a-listbox.aspx)中阅读更多相关信息。

这是一个除您之外的所有内容的示例`DataTemplate`：

```
<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:sys="clr-namespace:System;assembly=mscorlib" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid.Resources>
        <x:Array x:Key="data" Type="{x:Type sys:String}">
            <sys:String>a </sys:String>
            <sys:String>bb</sys:String>
            <sys:String>ccc</sys:String>
            <sys:String>dddd</sys:String>
        </x:Array>
    </Grid.Resources>
    <ListBox ItemsSource="{StaticResource data}">
        <ListBox.Resources>
            <Style TargetType="{x:Type ListBoxItem}">
                <Style.Resources>
                    <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent"/>
                    <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="Transparent"/>
                </Style.Resources>
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Foreground" Value="Black"/>
                    </Trigger>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Foreground" Value="Gold"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </ListBox.Resources>
    </ListBox>
</Grid> 
```

# dotnetnuke - DotNetNuke 模块卸载错误

> ID：654721
> 
> 赞同：1
> 
> 时间：2009-03-17T15:22:50.313
> 
> 标签：dotnetnuke, dotnetnuke-module

每次我卸载 DotNetNuke 模块并选中删除文件的框时，它都会完全杀死我的网站。

我在 x86 Windows 7 beta 上运行 IIS7，并且在 4.8.4 和 4.9.2 中都遇到了这个问题。当错误发生时，如果我替换 bin 文件夹中的所有 DLL 文件，该站点就会恢复活力。

有谁知道这个的解决方法？

我得到的错误如下...

编译器错误消息：BC30002：未定义类型“IClientAPICallbackEventHandler”。

源错误：

第 41 行：''' -------------------------------------------- --------------------------------- 第 42 行：部分类 DefaultPage 第 43 行：继承 DotNetNuke.Framework.CDefault ：实现IClientAPICallbackEventHandler 第 44 行： 第 45 行：#Region“属性”

源文件：C:\inetpub\wwwroot\Default.aspx.vb 行：43

编辑：在卸载模块期间从 /bin 文件夹中删除的文件是： DotNetNuke.Services.Syndication.dll
DotNetNuke.WebControls.dll
DotNetNuke.WebUtility.dll
SharpZipLib.dll

我没有直接引用这些文件中的任何一个 - 所以我猜测它一定是卸载过程中的某种错误。仅当我的 DotNetNuke.dll 参考上的“复制本地”设置为“真”时，这些文件才会在卸载期间被删除。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T16:13:51.970

您是否可能针对其中一个 DNN dll 的不同版本进行编译，并将该引用设置为 Copy Local？

# .net - 使用 Windows 窗体实现 MVC

> ID：654722
> 
> 赞同：104
> 
> 时间：2009-03-17T15:23:11.827
> 
> 标签：.net, winforms, model-view-controller

我在哪里可以找到一个关于如何在 Windows 窗体中完全实现 MVC 模式的好例子？

我在各个站点（例如[The Code Project](http://en.wikipedia.org/wiki/The_Code_Project)和 .NetHeaven）上找到了许多教程和代码示例，但其中很多比 MVC 更能代表观察者模式。由于我要开发的应用程序是针对学校项目的，因此我不愿意使用[PureMVC](https://github.com/PureMVC/puremvc-csharp-standard-framework/wiki)或[MVC#](http://www.mvcsharp.org/)之类的框架。

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2009-03-25T15:53:43.137

我认为应用程序彼此之间是如此不同，我们对如何编写应用程序的理解仍然非常有限。我过去使用过的 Windows 窗体应用程序彼此如此不同。我看到的一些设计差异是（包括大多数组合）：

*   直接与数据库对话（2 层）
*   使用为给定应用程序编写的后端（3 层）
*   使用一组 Web 服务，这些服务是为许多应用程序使用而编写的，并且不能针对您的应用程序进行更改。（面向服务的架构）
*   由[CRUD](http://en.wikipedia.org/wiki/Create,_read,_update_and_delete)操作完成的更新
*   [使用命令模式](http://en.wikipedia.org/wiki/Command_pattern)完成更新（向后端服务器发送命令）
*   大量使用[数据绑定](http://www.akadia.com/services/dotnet_databinding.html)/没有使用数据绑定
*   大多数数据是“类似表格”（例如发票），在标准网格控件中运行良好/大多数 UI 数据需要自定义控件。
*   一名开发人员/10 或 20 名开发人员的团队（仅在 UI 上）
*   大量使用模拟等的单元测试/没有单元测试

因此，我认为不可能创建一种始终适合的 MVC（或 MVP）实现。

我见过的真正**解释**MVC 以及**为什么要**以这种方式构建 MVC 系统的最佳帖子是[Jeremy D Miller 的“构建你自己的 CAB”系列](http://codebetter.com/blogs/jeremy.miller/archive/2007/07/25/the-build-your-own-cab-series-table-of-contents.aspx)。在工作之后，您应该能够更好地理解您的选择。 还应考虑[Microsoft 的智能客户端指南（CAB / Microsoft 复合应用程序块） 。](http://smartclient.codeplex.com/)它有点复杂，但它可以很好地适用于适合的应用程序。

为 Winforms 项目选择[MVC/MVP 实现提供了](http://rdn-consulting.com/blog/2008/02/01/selecting-a-mvcmvp-implementation-for-a-winforms-project/)一个值得一读的概述。很多人喜欢[PureMVC](http://trac.puremvc.org/PureMVC%5FCSharp)。没用过，下次需要MVC框架的时候再看。

“ [Presenter First](http://en.wikipedia.org/wiki/Presenter_First) ”是一种软件开发方法，它结合了 Model View Presenter (MVP) 设计模式和[测试驱动开发](http://en.wikipedia.org/wiki/Test-driven_development)的思想。它使您可以从用客户的语言编写测试开始。例如：

> “当我点击‘保存’按钮时，文件应该被保存，未保存的文件警告应该消失。”</p>

我没有使用“Presenter First”的经验，但有机会我会尝试一下，因为它看起来很有前途。

您可能希望查看的其他 Stack Overflow 问题在[此处](https://stackoverflow.com/questions/2406/looking-for-a-mvc-sample-for-winforms)和[此处](https://stackoverflow.com/questions/122388/how-would-you-implement-mvc-in-a-windowsforms-application)。

如果您正在考虑在任何时候使用**WPF ，请**[查看 Model-View ViewModel (MVVM)](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx)模式。这是一个非常好的视频，你应该看看：[Jason Dolinger on Model-View-ViewModel](http://blog.lab49.com/archives/2650)。

[Winforms 的 MVVM（模型视图视图模型）设计模式](http://aviadezra.blogspot.com/2009/08/mvp-mvvm-winforms-data-binding.html)提供了另一种选择，如果需要，可以更轻松地转换为 WPF。 [Magical.Trevor](http://codermike.com/magical-trevor)是另一个适用于 Windows 窗体的 MVVM 示例，它还包括基于属性名称的自动绑定。

* * *

还要问问自己**为什么**要使用 MVC。

*   您希望能够对尽可能多的代码进行单元测试吗？
*   您是否试图允许尽可能多的代码被重用？
*   您是否正在尝试使您的代码库易于理解？
*   对给定项目有效的 101 个其他原因。

一旦你明确了你的**目标**，选择一种实现或另一种实现就变得更容易了。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-03-26T13:12:34.373

更新：除了我之前的回答之外，我建议阅读[“Presenter First”方法](http://en.wikipedia.org/wiki/Presenter_First)（尤其是 PDF 文章）

我会推荐 MVP（实际上是 PassiveView 模式）而不是 MVC。您实际上并不需要任何特殊的框架，这只是您组织代码的方式。

一种方法（我通常采用）是将每个窗口窗体拆分为三个实体：

1.  演示者/控制器类 - 这是您在开发表单时实际开始的内容。这是您的大多数/所有“业务”逻辑应该驻留的地方。
2.  一个视图接口（IView），它包含方法、属性和事件。这个界面是演示者所知道的关于您的表单的**所有信息。**
3.  最后，当您完成演示者和视图（包括单元测试）的实现后，您就可以创建实际的表单类并使其实现 IView 接口。然后就是向表单添加适当的控件并将它们连接到界面的问题。

示例代码（一个简单的伪代码，仅用于说明）：

```
interface IView
{
    string Username { get; set; }
    string Password { get; set; }

    event EventHandler LogOnButtonClicked;

    void InformUserLogOnFailed();
    void MoveToMainScreen();
}

class Presenter
{
    public Presenter(IView view)
    {
        this.view = view;
        view.LogOnButtonClicked += new EventHandler(OnLogOnButton);
    }

    private void OnLogOnButton()
    {
        // we ask some service to verify the username/password
        bool isLogOnOk = logOnService.IsUserAndPasswordOk(view.Username, view.Password);
        if (isLogOnOk)
            view.MoveToMainScreen();
        else
        {
            view.Username = "";
            view.Password = "";
            view.InformUserLogOnFailed();
        }
    }

    private IView view;
}

class Form : IView
{
    public Form()
    {
        presenter = new Presenter(this);
    }

    public string Username
    {
        get { return TextBoxUsername.Text; }
        set { TextBoxUsername.Text = value; }
    }

    public string Password
    {
        get { return TextBoxPassword.Text; }
        set { TextBoxPassword.Text = value; }
    }

    public void InformUserLogOnFailed()
    {
        MessageBox.Show("Invalid username or password.");
    }

    public void MoveToMainScreen()
    {
        // code for opening another form...
    }

    private Presenter presenter;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-17T15:37:04.633

你看过[PureMVC](http://trac.puremvc.org/PureMVC_CSharp)吗？我发现一旦他们开始构建一个特定的实现，没有人能就 MVC 的真正样子达成一致。

更新：您可以从诸如[MobileMVC 之](http://www.codeplex.com/MobileMVC)类的更简单的东西开始构建自己的。Compact Framework 代码应该可以在 Windows 上编译/运行。由于这是一项学校作业，我建议您实际上花一些时间学习 MVC 的实际工作原理。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-22T17:15:15.370

您可能想看看[差异执行](https://stackoverflow.com/questions/371898/how-does-differential-execution-work)。

在[SourceForge中](http://sourceforge.net/projects/dyndlgdemo/)

IMO，它是对 MVC 的巨大改进，尽管它仍然很不寻常。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-25T15:26:33.873

可以在[此处](http://www.ii.uni.wroc.pl/~wzychla/mvc.html)找到使用 Windows 窗体滚动您自己的 MVC 实现的一个很好的示例。源代码包括在内。

当您阅读、研究和编写此作业的代码时，您会发现对于如何实现 MVC 存在很多分歧。这是一个简单的案例，它反映了关注点的分离，也是一个很好的例子，说明了将其连接起来所需的“管道”。

当你离开学校时，你可能会想像其他海报推荐的那样依赖一个框架。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-25T20:00:37.990

Microsoft 复合接口应用程序块作为 MVC 实现开始它的生命（在它实现的其他模式中）。然而，发布版本演变为 MVP 实现，可以说是对 MVC 概念的一种不同解释。

如果您愿意检查一个非常完整（并且有些复杂）的 MVP 实现的代码，您可以发现 MS-CAB 作为 Microsoft 智能客户端软件工厂的组件之一。它带有源代码。你可以在[这里](http://smartclient.codeplex.com/)找到它。祝你好运！

# asp.net - ASP.NET GridView 格式单元格

> ID：654732
> 
> 赞同：2
> 
> 时间：2009-03-17T15:25:12.197
> 
> 标签：asp.net, gridview

我有一个名为 SpecialGridView 的类，它继承自`GridView`.

另一方面，我有使用此 SpecialGridView 来显示数据的报告页面。

属性 autogeneratedcolumns 设置为 true，我想保留此选项。

为了放置数据格式，我重写了“CreateAutoGeneratedColumn”来解析数据是否为“十进制”，从而为此类数据建立格式。但我得到一个例外“NotSupportedException”

关于如何解决它的任何想法？
提前致谢。

这是我写的代码：

```
 protected override AutoGeneratedField CreateAutoGeneratedColumn(AutoGeneratedFieldProperties fieldProperties)
 {
     AutoGeneratedField field = new AutoGeneratedField(fieldProperties.DataField);
     field.HtmlEncode = false;
     string name = fieldProperties.Name;
     ((IStateManager)field).TrackViewState();
     field.HeaderText = name;
     field.SortExpression = name;
     field.ReadOnly = fieldProperties.IsReadOnly;
     field.DataType = fieldProperties.Type;

     if (field.DataType == typeof(Decimal))
     {
        field.DataFormatString= "{0:0.00}";
     }
     return field;
 } 
```

问候。
何塞马

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T16:02:22.030

这是一个解决方案（带反射）：

```
 protected override AutoGeneratedField CreateAutoGeneratedColumn(AutoGeneratedFieldProperties fieldProperties)
     {
    AutoGeneratedField field = new AutoGeneratedField(fieldProperties.DataField);
                StateBag sb = (StateBag)field.GetType().InvokeMember("ViewState",BindingFlags.GetProperty|BindingFlags.NonPublic|BindingFlags.Instance,null,field, new object[] {});
                field.HtmlEncode = false;
                string name = fieldProperties.Name;
                ((IStateManager)field).TrackViewState();
                field.SortExpression = name;
                field.ReadOnly = fieldProperties.IsReadOnly;
                field.DataType = fieldProperties.Type;
                if (field.DataType == typeof(Decimal))
                {
                   sb["DataFormatString"]= "{0:c}";
                }
                if (field.DataType == typeof(DateTime))
                {
                    sb["DataFormatString"] = "{0:d}";
                }
                return field;
    } 
```

# c# - C# P/Invoke 结构问题

> ID：654734
> 
> 赞同：6
> 
> 时间：2009-03-17T15:25:38.577
> 
> 标签：c#, struct, pinvoke

我正在尝试为 C API（本机 Win dll）编写 C# P/Invoke 包装器，通常这工作正常。唯一的例外是在 C 代码中将结构作为参数的特定方法。该函数在没有任何异常的情况下被调用，但它返回 false 表示执行失败。

在 API 头文件中，涉及的方法和结构定义如下：

```
#define MAX_ICE_MS_TRACK_LENGTH  256
typedef struct tagTRACKDATA
{   
    UINT nLength;
    BYTE TrackData[MAX_ICE_MS_TRACK_LENGTH];
} TRACKDATA, FAR* LPTRACKDATA;
typedef const LPTRACKDATA LPCTRACKDATA;

BOOL ICEAPI EncodeMagstripe(HDC /*hDC*/,
             LPCTRACKDATA /*pTrack1*/,
             LPCTRACKDATA /*pTrack2*/,
             LPCTRACKDATA /*pTrack3*/,
             LPCTRACKDATA /*reserved*/); 
```

我尝试使用以下代码创建 C# P/Invoke 包装器：

```
public const int MAX_ICE_MS_TRACK_LENGTH = 256;

[StructLayout(LayoutKind.Sequential)]
public class MSTrackData {
    public UInt32 nLength;
    public readonly Byte[] TrackData = new byte[MAX_ICE_MS_TRACK_LENGTH];
}

[DllImport("ICE_API.dll", CharSet = CharSet.Auto, SetLastError = true)]
public static extern bool EncodeMagstripe(IntPtr hDC,
                    [In]ref MSTrackData pTrack1,
                    [In]ref MSTrackData pTrack2,
                    [In]ref MSTrackData pTrack3,
                    [In]ref MSTrackData reserved); 
```

然后我尝试使用以下 C# 代码调用 EncodeMagstripe 方法：

```
CardApi.MSTrackData trackNull = null;
CardApi.MSTrackData track2 = new CardApi.TrackData();
byte[] trackBytes = Encoding.ASCII.GetBytes(";0123456789?");
track2.nLength = (uint)trackBytes.Length;
Buffer.BlockCopy(trackBytes, 0, track2.TrackData, 0, trackBytes.Length);

if (!CardApi.EncodeMagstripe(hDC, ref trackNull, ref track2, ref trackNull, ref trackNull)) {
    throw new ApplicationException("EncodeMagstripe failed", Marshal.GetLastWin32Error());
} 
```

这会导致抛出 ApplicationException，错误代码为 801，根据文档，这意味着“数据包含太多字符，无法用于所选的 Track 2 格式。”。但是，所选曲目格式最多应允许 39 个字符（我也尝试过较短的字符串）。

我怀疑问题的发生是由于我在 MSTrackData 定义中做错了什么，但我看不出这可能是什么。有没有人有什么建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T18:15:43.167

到目前为止给出的所有答案都有一些答案，但不完整。你需要 MarshalAs - ByValArray 以及新的，你的 MSTrackDatas 已经是引用，所以你不需要通过 ref 传递它们，你必须检查调用约定 ICEAPI 代表什么，如果是 StdCall，你不需要改变任何东西如果是 cdecl，则需要将 CallingConvention 添加到 DllImport 属性中。此外，您可能需要向 bool 返回值添加 MarshalAs 属性，以确保将其编组为 4 字节 WinApi 样式 bool。以下是您（可能）需要的声明：

```
public const int MAX_ICE_MS_TRACK_LENGTH = 256;

[StructLayout(LayoutKind.Sequential)]
public class MSTrackData {
    public UInt32 nLength;
    [MarshalAs(UnmanagedType.ByValArray, SizeConst = 256)]
    public Byte[] TrackData = new byte[MAX_ICE_MS_TRACK_LENGTH];
}

[DllImport("ICE_API.dll", CharSet = CharSet.Auto, SetLastError = true)]
[return: MarshalAs(UnmanagedType.Bool)]
public static extern bool EncodeMagstripe(IntPtr hDC,
                [In] MSTrackData pTrack1,
                [In] MSTrackData pTrack2,
                [In] MSTrackData pTrack3,
                [In] MSTrackData reserved); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T15:35:27.490

我不会用 new 定义 BYTE 数组，而是使用以下代码来初始化正确的大小：

> [MarshalAs(UnmanagedType.byValTSt, SizeConst =256)] 公共只读 Byte[] TrackData;

我过去曾在 char 数组上成功使用过它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T17:05:24.747

在我看来，问题在于您正在通过引用传递引用。由于`MSTrackData`是一个类（即引用类型），因此通过引用传递它就像传递一个指向指针的指针。

将您的托管原型更改为：

```
public static extern bool EncodeMagstripe(IntPtr hDC,
                    MSTrackData pTrack1,
                    MSTrackData pTrack2,
                    MSTrackData pTrack3,
                    MSTrackData reserved); 
```

请参阅有关[传递结构](http://msdn.microsoft.com/en-us/library/awbckfbz.aspx)的 MSDN 文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-31T03:55:13.283

我遇到了几乎完全相同的问题——但使用的是 ReadMagstripe。此处为 EncodeMagstripe 提供的解决方案不适用于 ReadMagstripe！我认为它不起作用的原因是 ReadMagstripe 必须将数据返回到 TRACKDATA 结构/类中，而 EncodeMagstripe 只将数据传递给 dll 并且 TRACKDATA 中的数据不需要更改。这是最终对我有用的实现 - 使用 EncodeMagstripe 和 ReadMagstripe：

```
 public const int MAX_ICE_MS_TRACK_LENGTH = 256;
    [StructLayout(LayoutKind.Sequential)]
    public struct TRACKDATA
    {  
        public UInt32 nLength;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 256)]
        public string szTrackData;
    }

    [DllImport("ICE_API.dll", EntryPoint="_ReadMagstripe@20", CharSet=CharSet.Auto, 
        CallingConvention=CallingConvention.Winapi, SetLastError=true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    public static extern bool ReadMagstripe(int hdc, ref TRACKDATA ptrack1, ref TRACKDATA ptrack2,
         ref TRACKDATA ptrack3, ref TRACKDATA reserved);

    [DllImport("ICE_API.dll", EntryPoint="_EncodeMagstripe@20", CharSet=CharSet.Auto,
        CallingConvention = CallingConvention.Winapi, SetLastError=true)]
    public static extern bool EncodeMagstripe(int hdc, [In] ref TRACKDATA ptrack1, [In] ref TRACKDATA ptrack2,
        [In] ref TRACKDATA ptrack3, [In] ref TRACKDATA reserved);

/*
        ....
*/

    private void EncodeMagstripe()
    {
        ICE_API.TRACKDATA track1Data = new ICE_API.TRACKDATA();
        ICE_API.TRACKDATA track2Data = new ICE_API.TRACKDATA();
        ICE_API.TRACKDATA track3Data = new ICE_API.TRACKDATA();
        ICE_API.TRACKDATA reserved = new ICE_API.TRACKDATA();

        //if read magstripe
        bool bRes = ICE_API.ReadMagstripe(printer.Hdc, ref track1Data, ref track2Data,
            ref track3Data, ref reserved);

        //encode magstripe
        if (bRes)
        {
            track2Data.szTrackData = "1234567890";
            track2Data.nLength = 10;

            bRes = ICE_API.EncodeMagstripe(printer.Hdc, ref track1Data, ref track2Data, ref track3Data, ref reserved);
        }
    } 
```

# java - 按合同库（界面）设计的想法？

> ID：654737
> 
> 赞同：1
> 
> 时间：2009-03-17T15:26:44.533
> 
> 标签：java, design-by-contract, contract

我正在研究 Java 库的合同设计，这是我迄今为止在接口方面提出的。

用户可以调用executeContract，并且executeContract 在调用'require' 后调用invokeContract。在executeContract 之后调用ensure 以确保invokeContract 返回的内容的正确性。

此代码也可用作回调方法（匿名内部类调用）。

你怎么认为？这是按合同设计的吗？到目前为止，这有助于我编写可测试的 Java 代码。

```
public interface IContractHandler {

    /**
     * Execute contract will invoke the #invokeContract method.  In the execute method, 
     * check for the validity of the preconditions and the post conditions.
     * 
     * The precondition can be null.
     * 
     * @param    precondInput -  Precondition Input Data, can be null.
     * @return                   Post condition output
     */
    public Object executeContract(final Object precondInput) throws ContractError;

    /**
     * Require that the preconditions are met.
     */
    public Object require(final Object precondInput) throws ContractError;

    /**
     * Ensure that the postconditions are met.
     */
    public Object ensure(final Object precondInput) throws ContractError;

    /**
     * The precondition can be null if the contract allows for that.
     * 
     * @param    precondInput -  Precondition Input Data, can be null.
     * @return                   Post condition output
     */
    public Object invokeContract(final Object precondInput) throws ContractError;

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:38:50.833

如果您正在寻找一个通用的解决方案，我会推荐[*Java 建模语言*](http://www.eecs.ucf.edu/~leavens/JML/ "JML")。所有*前置/后置条件*( `@requires/@ensures`) 都可以在您要检查的方法上方的注释中指定。我的理解是*JML 编译器*( `jmlc`) 将运行时断言插入到字节码中。

我相信*ESC/Java2*具有类似类型的功能，但我以前从未使用过它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T16:34:37.693

实际上，在这种情况下，您正在寻找一种称为[模板方法](http://en.wikipedia.org/wiki/Template_method_pattern)的模式。接口不决定实现，这是您在 executeContract() 方法中尝试执行的操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T17:37:42.830

你怎么知道实现这个方法的人会遵守你的*executeContract*规则（即它在调用*require*之后调用*invokeContract*）？答案 - 你没有。

 *最好将*executeContract*放在一个抽象类中，这样您就可以强制执行该行为，如果您真的不希望人们改变该行为，则可以将其定为 final。

如果*invokeContract*和*require*只需要被*executeContract*调用，则无需公开。

我很惊讶*require*和*ensure* return *Object*因为它们听起来像是那种只会返回*boolean*的方法。事实上，除非你真的需要，否则返回*Object*通常是不好的。现在的方式是，实现这一点的类的消费者可以得到任何东西，并且不希望到处进行*instanceof*检查。

真的需要抛出*ContractError*吗？

希望这可以帮助。

# python - Python进程管理

> ID：654738
> 
> 赞同：6
> 
> 时间：2009-03-17T15:26:44.830
> 
> 标签：python, process, ps

python是否有任何方式可以本地或通过一些在线可用的代码（最好在GPL下）能够进行进程管理。目标类似于 ps 的功能，但最好在数组、列表和/或字典中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T15:41:29.753

[http://pypi.python.org/pypi/PSI](http://pypi.python.org/pypi/PSI)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-11T00:10:51.550

这是跨平台的： [http ://code.google.com/p/psutil/](http://code.google.com/p/psutil/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T15:32:38.090

有一个叫做[ProcessManager](http://www.humanized.com/ProcessManager/)的东西，但我以前没有使用过它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-11T00:29:09.337

如果您对模块不感兴趣，您还可以查看`/proc`文件系统 procfs。

# asp.net - 由 Visual Studio 启动的多个“开发服务器”

> ID：654744
> 
> 赞同：1
> 
> 时间：2009-03-17T15:27:26.247
> 
> 标签：asp.net, visual-studio, visual-studio-2005

有时，在 Visual Studio 中执行某些操作时，事情似乎“失控” - Visual Studio 启动了许多“开发服务器”实例 - 通知区域中出现多个图标，弹出多个连续的“toast”通知等.

我遇到此问题的两种解决方案都包含两个 Web 项目，其中一个设置为使用 ASP.NET 表单身份验证。

我也在使用 Perforce 源代码控制插件。这些解决方案受源代码控制。

可以提示此行为的操作包括从母版页创建内容页，单击解决方案资源管理器顶部的“配置”图标。具有讽刺意味的是，实际运行其中一个项目似乎并没有引起同样的问题。

一旦事情安定下来，我最终会得到一个占满一半任务栏的通知区域。沿着这些图标“运行”鼠标会导致它们消失，就像您有时会遇到意外终止的应用程序一样。

这变得非常令人沮丧，因为它往往会阻止我真正想做的事情！

感谢任何建议。希望我已经足够清楚 - 这不是一个简单的描述问题！

谢谢，

杰米

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-12T21:21:55.020

请查看[http://vishaljoshi.blogspot.com/2009/08/multiple-instances-of-visual-studio.html上的博客文章](http://vishaljoshi.blogspot.com/2009/08/multiple-instances-of-visual-studio.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T15:36:31.717

您是否检查了解决方案的“属性”页面（右键单击解决方案文件）？您应该能够将那里的启动项目设置为“单一启动项目”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T02:56:46.390

听起来 Web 配置服务在启动期间失败，VS 正在尝试重新启动它。

我要么停止使用那个工具——一旦你学会了如何操作 web.config 并在网站上获得你的基本用户/角色管理 CRUD 页面，它对我来说总是显得有点矫枉过正。但它可能只是您的身份验证数据库中的一些错误数据，如果您使用的是内置的成员资格提供程序等。如果是开发，请尝试使用 aspnet_sqlreg.exe（或其他任何名称）删除并重新创建成员资格、个人资料等数据库表和存储过程。

但首先，我会检查应用程序事件日志，看看那里的异常是否可以帮助您追踪问题。

# c# - 验证是否通过远程调用调用方法？

> ID：654746
> 
> 赞同：0
> 
> 时间：2009-03-17T15:27:32.330
> 
> 标签：c#, remoting

如何从方法中验证它是否在远程处理上下文中执行？我有一个基本的客户端 - > NT-Service 设置，该服务作为特定用户执行。此用户有权访问 SQL Server。

我正在寻找一种解决方案，可以更容易地捕获远程配置丢失或错误时发生的问题（未指定的方法等）。我希望能够以更好的错误消息失败（“此方法需要远程处理上下文才能正常工作。”）而不是因登录错误而失败。当原始用户对数据库具有只读访问权限并且在写入数据之前不会引发错误时，这就更加棘手了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T07:18:08.503

好吧，您可以使用 System.Diagnostics 中的 stacktrace 类来检查方法调用的来源。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T17:57:55.700

我喜欢使用 MS[企业库](http://msdn.microsoft.com/en-us/library/dd203099.aspx#EntLib4p1lpOverview)进行调试，您可以尝试使用日志记录和异常处理块来处理错误。

# dotnetnuke - DotNetNuke 升级 4.9.2 - 永久重定向失败

> ID：654748
> 
> 赞同：2
> 
> 时间：2009-03-17T15:27:59.053
> 
> 标签：dotnetnuke, upgrade

安装 DNN 04.09.02 升级（来自 DNN 4.8.4）时，我收到 System.IndexOutOfRangeException: PermanentRedirect 错误并且无法安装升级。我该如何解决这个问题，以便我可以安装升级？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T15:50:21.573

[该线程](http://www.dotnetnuke.com/Community/Forums/tabid/795/forumid/107/threadid/289312/scope/posts/Default.aspx)可能会帮助您：

看起来你必须手动更新它......那里描述了步骤。

还要检查[这个线程](http://www.dotnetnuke.com/Community/Forums/tabid/795/forumid/107/postid/294390/scope/posts/Default.aspx)，如果使用 AD，可能是由于 AD。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T16:12:45.170

我从 kitsune 提供的线程中重新发布了以下内容。[来源](http://www.dotnetnuke.com/Community/Forums/tabid/795/forumid/107/threadid/289312/scope/posts/Default.aspx)

首先在浏览器中尝试以下操作。将“www.yourdomain.com”替换为您的域：

[http://www.yourdomain.com/install/install.aspx?mode=install](http://www.yourdomain.com/install/install.aspx?mode=install)

如果这不起作用（对我来说不起作用），请尝试以下步骤（从 Chris 在该线程上复制）。

要手动运行升级的 SQL 部分，您需要运行您的版本和 4.9.2 之间的每个升级脚本。我从 4.9.0 升级到 4.9.2，所以我执行了以下操作：

1.  在 Web 服务器上打开目录：\Providers\DataProviders\SqlDataProvider
2.  确定需要运行哪些文件。基本上，你的旧版本之后的所有版本。就我而言，我需要运行文件 04.09.00.SqlDataProvider、04.09.01.SqlDataProvider 和 04.09.02.SqlDataProvider。
3.  在文本编辑器中打开 SQL 文件并替换“{databaseOwner}”（通常使用“dbo.”）和“{objectQualifier}”（通常使用“”，但有时使用“DNN4”或其他对象前缀）
4.  使用 SQL Management Studio 按版本顺序运行这些 SQL 文件。假设这些脚本运行没有错误，那么该站点应该可以使用了。

# .net - 将 C++ 标头与 .NET 语言一起使用

> ID：654751
> 
> 赞同：0
> 
> 时间：2009-03-17T15:28:07.087
> 
> 标签：.net, c++, com, interop, windows-media-player

我试图`.h`在 .NET 语言（可能是 C#）中使用来自 Windows SDK 的“”文件，但没有成功。此标头通过 COM 公开一些 Windows Media 播放器功能。如果我使用 Win32 C++，我可以毫无问题地使用它，所以我认为我可以使用 Managed C++ 作为“桥梁”将其暴露给 C#。

头文件是`subscriptionservices.h`随 Windows Media Player SDK 11（Windows SDK 6 的一部分）提供的。

那可能吗？如何在 .NET 应用程序中使用该头文件？

谢谢，爱德华多·科布奇

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T15:38:27.563

您可以使用 PInvoke 与 Win32 进行互操作。如果您尝试使用 COM 对象，您应该能够添加对项目的引用。你看过[这篇文章吗？](http://www.codeproject.com/KB/cs/wmp_pinvoke.aspx)

更实际地，您需要了解您正在做的工作类型。如果您要进行大量指针运算，那么我建议您使用托管 C++。如果不是 C#。祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T15:44:27.673

如果您希望从头文件中使用特定的代码片段或类型，您可以将它们粘贴到 PInvoke Interop Assistant 并获取为您生成的 C# 代码。

[http://www.codeplex.com/clrinterop/Release/ProjectReleases.aspx?ReleaseId=14120](http://www.codeplex.com/clrinterop/Release/ProjectReleases.aspx?ReleaseId=14120)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T15:37:07.613

尝试[PInvoke](http://pinvoke.net/)。我认为您不能使用实际的标头，但您可以引用外部非托管 DLL 中的函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T15:38:23.320

是的，有可能。P/Invoke 是你的朋友。使用此链接翻译标题。

[平台调用数据类型](http://msdn.microsoft.com/en-us/library/ac7ay120.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T15:44:40.683

如果你走这条路，这可能会让你在 C++ 道路上领先一步。

[http://code.msdn.microsoft.com/wmpinterop](http://code.msdn.microsoft.com/wmpinterop)

请注意，WMP 接口有一些棘手的接口可用于 P/Invoke。对我来说，编写 C++ 包装器更容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T15:51:29.950

如果 API 很简单，您可以使用 PInvoke，如果它很复杂，我建议使用 C++/CLI。这使您可以在托管世界和非托管世界之间建立一座“桥梁”。

# c# - 我可以创建泛型类型的字典吗？

> ID：654752
> 
> 赞同：69
> 
> 时间：2009-03-17T15:28:45.307
> 
> 标签：c#, generics

我想创建一个带有字符串键的 Dictionary 对象，其中包含通用类型的值。我想它看起来像这样：

```
Dictionary<string, List<T>> d = new Dictionary<string, List<T>>(); 
```

并使我能够添加以下内容：

```
d.Add("Numbers", new List<int>());
d.Add("Letters", new List<string>()); 
```

我知道我可以对字符串列表执行此操作，例如，使用以下语法：

```
Dictionary<string, List<string>> d = new Dictionary<string, List<string>>();
d.Add("Key", new List<string>()); 
```

但如果可能的话，我想为一个通用列表做这个......

**那么2个问题：**

1.  是否可以？
2.  语法是什么？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-17T15:30:08.517

编辑：现在我重读了这个问题......

您不能这样做，但自定义集合会在某种程度上处理它。你基本上有一个通用的`Add`方法：

```
public void Add<T>(string key, List<T> list) 
```

（集合本身*不会*是通用的 - 除非您想将键类型设为通用。）

但是，您不能以强类型的方式*从中提取*值，因为编译器不会知道您对特定键使用了哪种类型。如果您将键设置为类型本身，您会以*稍微*好一点的情况结束，但现有集合仍然不支持这种情况。这就是我最初的答案所回应的情况。

编辑：原始答案，当我没有完全正确阅读问题时，但无论如何这可能会提供信息......

不，恐怕你不能让一种类型的论点依赖于另一种类型的论据。这只是人们可能希望在泛型类型系统中表达但.NET 的约束不允许的事情之一。总会有这样的问题，.NET 设计者选择保持泛型*相对*简单。

但是，您可以编写一个集合来相当容易地执行它。我[在博客文章中有一个示例](http://codeblog.jonskeet.uk/2008/10/08/mapping-from-a-type-to-an-instance-of-that-type.aspx)，它只保留一个值，但很容易扩展它以使用列表。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-03-17T15:51:43.473

像这样的东西会起作用吗？

```
public class GenericDictionary
{
    private Dictionary<string, object> _dict = new Dictionary<string, object>();

    public void Add<T>(string key, T value) where T : class
    {
        _dict.Add(key, value);
    }

    public T GetValue<T>(string key) where T : class
    {
        return _dict[key] as T;
    }
} 
```

基本上，它为您包装了所有幕后演员。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-09-27T10:55:17.137

怎么样`Dictionary<string, dynamic>`？（假设您使用的是 C# 4）

```
Dictionary<string, dynamic> Dict = new Dictionary<string, dynamic>(); 
```

来源：[https ://stackoverflow.com/a/5038029/3270733](https://stackoverflow.com/a/5038029/3270733)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T15:58:16.203

我更喜欢这种将泛型类型放入集合的方式：

```
interface IList
{
  void Add (object item);
}

class MyList<T> : List<T>, IList
{
  public void Add (object item)
  {
    base.Add ((T) item); // could put a type check here
  }
}

class Program
{
  static void Main (string [] args)
  {
    SortedDictionary<int, IList>
      dict = new SortedDictionary<int, IList> ();

    dict [0] = new MyList<int> ();
    dict [1] = new MyList<float> ();

    dict [0].Add (42);
    dict [1].Add ("Hello"); // Fails! Type cast exception.
  }
} 
```

但是您确实会在编译时丢失类型检查。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-02-12T14:00:59.397

我使用[`ConditionalWeakTable`](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.conditionalweaktable-2?redirectedfrom=MSDN&view=netframework-4.7.2).

```
public class FieldByType
{
    static class Storage<T>
        where T : class
    {
        static readonly ConditionalWeakTable<FieldByType, T> table = new ConditionalWeakTable<FieldByType, T>();

        public static T GetValue(FieldByType fieldByType)
        {
            table.TryGetValue(fieldByType, out var result);
            return result;
        }

        public static void SetValue(FieldByType fieldByType, T value)
        {
            table.Remove(fieldByType);
            table.Add(fieldByType, value);
        }
    }

    public T GetValue<T>()
        where T : class
    {
        return Storage<T>.GetValue(this);
    }

    public void SetValue<T>(T value)
        where T : class
    {
        Storage<T>.SetValue(this, value);
    }
} 
```

它可以这样使用：

```
/// <summary>
/// This class can be used when cloning multiple related objects to store cloned/original object relationship.
/// </summary>
public class CloningContext
{
    readonly FieldByType dictionaries = new FieldByType();

    public void RegisterClone<T>(T original, T clone)
    {
        var dictionary = dictionaries.GetValue<Dictionary<T, T>>();
        if (dictionary == null)
        {
            dictionary = new Dictionary<T, T>();
            dictionaries.SetValue(dictionary);
        }
        dictionary[original] = clone;
    }

    public bool TryGetClone<T>(T original, out T clone)
    {
        var dictionary = dictionaries.GetValue<Dictionary<T, T>>();
        if (dictionary == null)
        {
            clone = default(T);
            return false;
        }

        return dictionary.TryGetValue(original, out clone);
    }
} 
```

另请参阅[此问题](https://stackoverflow.com/questions/32561155)，其中值的类型作为键的通用参数存储在其中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-10-17T21:34:36.447

我们使用大量反射来创建可扩展的管理工具。我们需要一种在模块定义的全局搜索中注册项目的方法。每个搜索都会以一致的方式返回结果，但每个搜索都有不同的依赖关系。这是我们为单个模块注册搜索的示例：

```
public void ConfigureSearch(ISearchConfiguration config)
    {
        config.AddGlobalSearchCallback<IEmploymentDataContext>((query, ctx) =>
        {
            return ctx.Positions.Where(p => p.Name.Contains(query)).ToList().Select(p =>
                new SearchResult("Positions", p.Name, p.ThumbnailUrl,
                    new UrlContext("edit", "position", new RouteValueDictionary(new { Id = p.Id }))
                    ));
        });
    } 
```

在模块注册期间的后台，我们遍历每个模块并将 Func 添加到具有以下实例的 SearchTable 中：

```
public class GenericFuncCollection : IEnumerable<Tuple<Type, Type, Object>>
{
    private List<Tuple<Type, Type, Object>> objects = new List<Tuple<Type, Type, Object>>();

    /// <summary>
    /// Stores a list of Func of T where T is unknown at compile time.
    /// </summary>
    /// <typeparam name="T1">Type of T</typeparam>
    /// <typeparam name="T2">Type of the Func</typeparam>
    /// <param name="func">Instance of the Func</param>
    public void Add<T1, T2>(Object func)
    {
        objects.Add(new Tuple<Type, Type, Object>(typeof(T1), typeof(T2), func));
    }

    public IEnumerator<Tuple<Type, Type, object>> GetEnumerator()
    {
        return objects.GetEnumerator();
    }

    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator()
    {
        return objects.GetEnumerator();
    }
} 
```

然后当我们最终调用它时，我们用反射来做：

```
var dependency = DependencyResolver.Current.GetService(search.Item1);
var methodInfo = search.Item2.GetMethod("Invoke");
return (IEnumerable<SearchResult>)methodInfo.Invoke(search.Item3, new Object[] { query, dependency }); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-09-30T20:11:38.920

我没有在这里找到我想要的东西，但在阅读之后我认为这可能是被要求的东西，因此试图回答。

问题是，当您使用 Dictionary 时，它是一个封闭的构造类型，并且所有元素都必须是 TValue 类型。我在很多地方都看到这个问题没有很好的答案。

事实是我想要索引，但每个元素都有不同的类型，并且基于 TKey 的值我们已经知道类型。不是试图绕过拳击，而是试图简单地获得更优雅的访问，比如 DataSetExtensions 字段。并且不想使用动态，因为类型是已知的并且它只是不想要的。

一个解决方案可以是创建一个非泛型类型，它不会在类级别公开 T ，因此会导致字典的 TValue 部分被关闭构造。然后撒上一个流利的方法来帮助初始化。

```
public class GenericObject
{
    private object value;

    public T GetValue<T>()
    {
        return (T)value;
    }

    public void SetValue<T>(T value)
    {
        this.value = value;
    }

    public GenericObject WithValue<T>(T value)
    {
        this.value = value;
        return this;
    }
}

class Program
{
    static void Main(string[] args)
    {
        Dictionary<string, GenericObject> dict = new Dictionary<string, GenericObject>();

        dict["mystring"] = new GenericObject().WithValue<string>("Hello World");
        dict["myint"] = new GenericObject().WithValue<int>(1);

        int i = dict["myint"].GetValue<int>();
        string s = dict["mystring"].GetValue<string>();
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-09-11T10:15:10.813

其他可能性是使用变量动态。

例如：

`Dictionary<string, List<dynamic>> d = new Dictionary<string, List<dynamic>>(); d.Add("Key", new List<dynamic>());`

变量动态解析运行时的类型。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-12-21T16:58:16.870

不，但您可以使用对象而不是泛型类型。

长答案：当前版本的 C# 不允许您在字典中创建泛型类型的条目。您的选择是 a) 创建一个与字典相同的自定义类，但允许它接受泛型类型，或者 b) 使您的 Dictionary 采用对象类型的值。我发现选项 b 是更简单的方法。

如果您发送特定类型的列表，那么当您去处理这些列表时，您将不得不测试它是什么类型的列表。更好的方法是创建对象列表；通过这种方式，您可以输入整数、字符串或任何您想要的数据类型，并且您不必测试来查看 List 包含什么类型的对象。这会（大概）产生您正在寻找的效果。

这是一个简短的控制台程序，可以解决问题：

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace dictionary
{
class Program
{
    static void Main(string[] args)
    {
        Dictionary<string, object> dic = new Dictionary<string, object>();
        var lstIntList = new List<object>();
        var lstStrings = new List<object>();
        var lstObjects = new List<object>();
        string s = "";

        lstIntList.Add(1);
        lstIntList.Add(2);
        lstIntList.Add(3);

        lstStrings.Add("a");
        lstStrings.Add("b");
        lstStrings.Add("c");

        dic.Add("Numbers", lstIntList);
        dic.Add("Letters", lstStrings);

        foreach (KeyValuePair<string, object> kvp in dic)
        {
            Console.WriteLine("{0}", kvp.Key);
            lstObjects = ((IEnumerable)kvp.Value).Cast<object>().ToList();

            foreach (var obj in lstObjects)
               {s = obj.ToString(); Console.WriteLine(s);}
            Console.WriteLine("");
        }

        Console.WriteLine("");
        Console.WriteLine("press any key to exit");
        Console.ReadKey();
    }//end main
}
} 
```

[![在此处输入图像描述](https://i.stack.imgur.com/AUubD.png)](https://i.stack.imgur.com/AUubD.png)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-07-19T07:37:41.343

一种方法是创建一个类型为“object”的 Dictionary 值，例如：

`Dictionary<string, object> d = new Dictionary<string, object>();`

因此，这里对象数据类型用作通用数据类型，您可以将任何内容作为值放入其中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-10-19T09:50:54.517

或者可以像这样使用泛型类型

```
public static void SafeUpdateInDictionary<T, L>(T DictionaryToBeUpdated, string Key, L Value) where T : Dictionary<string, L>
    {
        if (DictionaryToBeUpdated != null)
        {
            if(Value != null)
            {
                if (!DictionaryToBeUpdated.ContainsKey(Key))
                    DictionaryToBeUpdated.Add(Key, Value);
                else
                    DictionaryToBeUpdated[Key] = Value;
            }
        }
    } 
```

# c - 当您在程序终止之前在 malloc 之后不释放时，真正会发生什么？

> ID：654754
> 
> 赞同：607
> 
> 时间：2009-03-17T15:29:09.207
> 
> 标签：c, malloc, free

我们都被教导必须释放每个分配的指针。不过，我有点好奇不释放内存的实际成本。在某些明显的情况下，例如在`malloc()`循环或线程执行的一部分中调用时，释放非常重要，因此不会出现内存泄漏。但请考虑以下两个示例：

首先，如果我有这样的代码：

```
int main()
{
    char *a = malloc(1024);
    /* Do some arbitrary stuff with 'a' (no alloc functions) */
    return 0;
} 
```

这里的真正结果是什么？我的想法是进程死了，然后堆空间无论如何都消失了，所以错过调用并没有什么坏处`free`（但是，我确实认识到无论如何都有它对于关闭、可维护性和良好实践的重要性）。我的这个想法是对的吗？

其次，假设我有一个有点像 shell 的程序。用户可以声明变量`aaa = 123`，这些变量存储在一些动态数据结构中供以后使用。显然，很明显您会使用一些会调用某些 *alloc 函数（散列图、链表等）的解决方案。对于这种程序，调用后释放是没有意义的，`malloc`因为这些变量必须在程序执行期间始终存在，并且没有好的方法（我可以看到）用静态分配的空间来实现它。分配一堆内存但仅作为进程结束的一部分释放是不是糟糕的设计？如果是这样，有什么替代方案？

* * *

## 回答 #1

> 赞同：420
> 
> 时间：2009-03-17T15:32:32.927

几乎每个现代操作系统都会在程序退出后恢复所有分配的内存空间。我能想到的唯一例外可能是 Palm OS，其中程序的静态存储和运行时内存几乎相同，因此不释放可能会导致程序占用更多存储空间。（我只是在这里推测。）

因此，一般来说，它没有任何害处，除了存储空间超过您需要的运行时间成本。当然，在您给出的示例中，您希望保留可能使用的变量的内存，直到它被清除。

但是，当您不再需要它时立即释放内存并在程序退出时释放您仍然存在的任何东西，这被认为是一种很好的风格。这更像是一种了解您正在使用的内存的练习，并考虑您是否仍然需要它。如果你不跟踪，你可能有内存泄漏。

另一方面，在退出时关闭文件的类似警告会产生更具体的结果——如果你不这样做，你写给它们的数据可能不会被刷新，或者如果它们是临时文件，它们可能不会完成后被删除。此外，数据库句柄应该提交它们的事务，然后在你完成它们时关闭它们。同样，如果您使用的是 C++ 或 Objective C 等面向对象的语言，则在完成对象后不释放对象将意味着永远不会调用析构函数，并且该类负责的任何资源都可能不会被清理。

* * *

## 回答 #2

> 赞同：124
> 
> 时间：2009-03-17T15:32:02.383

是的，您是对的，您的示例不会造成任何伤害（至少在大多数现代操作系统上不会）。一旦进程退出，您的进程分配的所有内存将由操作系统恢复。

来源：[分配和 GC 神话](https://web.archive.org/web/20130913085611/http://www.hpl.hp.com/personal/Hans_Boehm/gc/myths.ps)（PostScript 警报！）

> 分配误区 4：非垃圾回收程序应始终释放它们分配的所有内存。
> 
> 真相：在频繁执行的代码中省略释放会导致越来越多的泄漏。他们很少被接受。但是在程序退出之前保留大部分分配内存的程序通常在没有任何干预解除分配的情况下执行得更好。如果没有免费的，Malloc 更容易实现。
> 
> 在大多数情况下，**在程序退出之前释放内存是没有意义的。** 无论如何，操作系统都会收回它。自由会在死物中触摸和翻页；操作系统不会。
> 
> 结果：小心计算分配的“泄漏检测器”。一些“泄漏”是好的！

也就是说，您真的应该尽量避免所有内存泄漏！

第二个问题：你的设计没问题。如果您需要在应用程序退出之前存储某些内容，那么可以使用动态内存分配来执行此操作。如果您事先不知道所需的大小，则不能使用静态分配的内存。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-03-17T16:43:37.517

===**未来的证明**和**代码重用**呢？===

如果您**不**编写代码来释放对象，那么您将代码限制为仅当您可以依赖被关闭的进程释放的内存时才能安全使用......即一次性使用项目或“丢弃” ^([1])项目）......您知道该过程何时结束。

如果您**确实**编写了释放（）所有动态分配的内存的代码，那么您将在未来对代码进行校对并让其他人在更大的项目中使用它。

* * *

^([1] 关于“一次性”项目。“一次性”项目中使用的代码有一种不会被丢弃的方式。接下来你知道十年过去了，你的“丢弃”代码仍在使用）。)

^(我听说过一个人写一些代码只是为了好玩，以使他的硬件更好地工作。他说“[只是爱好，不会大而专业](https://groups.google.com/d/msg/comp.os.minix/dlNtH7RRrGA/SwRavCzVE7gJ)”。多年后，很多人都在使用他的“爱好”代码。)

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2009-12-28T06:04:22.633

### 你是对的，没有伤害，退出速度更快

这有多种原因：

*   所有桌面和服务器环境都只是在 exit() 上释放整个内存空间。他们不知道程序内部的数据结构，例如堆。

*   几乎所有的`free()`实现*都不会将*内存返回给操作系统。

*   更重要的是，在 exit() 之前完成是浪费时间。在退出时，内存页面和交换空间被简单地释放。相比之下，一系列 free() 调用会消耗 CPU 时间，并可能导致磁盘分页操作、缓存未命中和缓存驱逐。

关于未来代码重用的可能性来证明无意义操作的*确定性**：*这是一个考虑因素，但可以说它不是[敏捷](https://en.wikipedia.org/wiki/Agile_software_development)方式。[雅尼！](https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it)

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2015-05-08T07:42:42.613

我完全不同意所有说 OP 正确或没有害处的人。

每个人都在谈论现代和/或传统操作系统。

但是，如果我在一个根本没有操作系统的环境中呢？什么地方没有？

想象一下，现在您正在使用线程样式的中断并分配内存。在 C 标准 ISO/IEC:9899 中，内存的生命周期表示为：

> 7.20.3 内存管理功能
> 
> 1 连续调用 calloc、malloc 和 realloc 函数分配的存储顺序和连续性未指定。如果分配成功，则返回的指针经过适当对齐，以便可以将其分配给指向任何类型对象的指针，然后用于访问已分配空间中的此类对象或此类对象的数组（直到空间被显式释放） . 已分配对象的生命周期从分配延伸到解除分配。[...]

因此，不必认为环境正在为您完成释放工作。否则它将被添加到最后一句：“或者直到程序终止。”

换句话说：不释放内存不仅仅是不好的做法。它产生不可移植且不符合 C 的代码。至少可以将其视为“正确的，如果以下内容：[...]，受环境支持”。

但是在您根本没有操作系统的情况下，没有人会为您完成这项工作（我知道通常您不会在嵌入式系统上分配和重新分配内存，但在某些情况下您可能想要这样做。）

因此，一般来说，普通的 C 语言（OP 被标记），这只是产生错误和不可移植的代码。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2009-03-18T08:36:05.567

一旦我确定我完成了它，我通常会释放每个分配的块。今天，我的程序的入口点可能是`main(int argc, char *argv[])`，但明天它可能是`foo_entry_point(char **args, struct foo *f)`并且类型为函数指针。

所以，如果发生这种情况，我现在有泄漏。

关于你的第二个问题，如果我的程序接受像 a=5 这样的输入，我会为 a 分配空间，或者在随后的 a="foo" 上重新分配相同的空间。这将一直分配到：

1.  用户键入“未设置 a”
2.  进入了我的清理功能，为信号提供服务或用户键入“退出”

我想不出任何在进程退出后不回收内存的*现代操作系统。*再说一次，free() 很便宜，为什么不清理呢？正如其他人所说，像 valgrind 这样的工具非常适合发现您确实需要担心的泄漏。即使您示例的块将被标记为 'still reachable' ，当您试图确保没有泄漏时，它只是输出中的额外噪音。

另一个神话是“*如果它在 main() 中，我不必释放它*”，这是不正确的。考虑以下：

```
char *t;

for (i=0; i < 255; i++) {
    t = strdup(foo->name);
    let_strtok_eat_away_at(t);
} 
```

如果这发生在分叉/守护进程之前（并且理论上永远运行），那么您的程序刚刚泄漏了 t 255 次的未确定大小。

一个好的，写得好的程序应该总是在自己之后清理。释放所有内存，刷新所有文件，关闭所有描述符，取消链接所有临时文件等。此清理功能应在正常终止或收到各种致命信号时达到，除非您想留下一些文件以便您可以检测崩溃并恢复。

真的，善待可怜的灵魂，当你继续做其他事情时，他们必须维护你的东西..把它交给他们'valgrind clean':)

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2009-03-17T15:33:57.027

退出时不释放内存是完全可以的；malloc() 从称为“堆”的内存区域分配内存，当进程退出时，进程的完整堆被释放。

话虽如此，人们仍然坚持在退出之前释放所有内容是好的一个原因是内存调试器（例如 Linux 上的 valgrind）将未释放的块检测为内存泄漏，如果您也有“真正的”内存泄漏，它变成如果您最后也得到“假”结果，则更难发现它们。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-03-17T15:34:45.107

如果您正在使用已分配的内存，那么您没有做错任何事情。当您编写分配内存而不释放内存且不使其对程序的其余部分可用的函数（除 main 之外）时，这将成为一个问题。然后您的程序继续运行分配给它的内存，但无法使用它。您的程序*和其他正在运行的程序*被剥夺了该内存。

编辑：说其他正在运行的程序被剥夺了内存并不是 100% 准确的。操作系统总是可以让他们使用它，但代价是将您的程序换出到虚拟内存（`</handwaving>`）。但是，关键是，如果您的程序释放了它不使用的内存，那么虚拟内存交换就不太可能是必要的。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2009-03-18T08:00:51.563

这段代码通常可以正常工作，但要考虑代码重用的问题。

您可能已经编写了一些不释放分配的内存的代码片段，它以这样的方式运行，然后自动回收内存。似乎没事。

然后其他人以每秒执行一千次的方式将您的代码段复制到他的项目中。那个人现在在他的程序中有一个巨大的内存泄漏。一般来说不是很好，对于服务器应用程序通常是致命的。

代码重用在企业中很常见。通常，公司拥有其员工编写的所有代码，每个部门都可以重复使用公司拥有的任何代码。因此，通过编写这种“看起来很无辜”的代码，您可能会令其他人头疼。这可能会让你被解雇。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2016-01-13T09:46:58.560

> 这里的真正结果是什么？

**你的程序泄露了内存。根据您的操作系统，它*可能*已被恢复。**

大多数现代**桌面**操作系统*确实会*在进程终止时恢复泄漏的内存，因此很遗憾地忽略了这个问题（正如这里的许多其他答案所看到的那样。）

但是您依赖的是您不应该依赖的安全功能，并且您的程序（或函数）可能**在下一次这种行为***确实*导致“硬”内存泄漏的系统上运行。

 **您可能在内核模式下运行，或者在不采用内存保护作为权衡的老式/嵌入式操作系统上运行。（MMU占用die空间，内存保护需要额外的CPU周期，要求程序员自己清理也不算多）。

您可以以任何您喜欢的方式使用和重用内存，但请确保在退出之前释放所有资源。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2017-10-17T01:37:49.843

实际上，[OSTEP](http://pages.cs.wisc.edu/~remzi/OSTEP/)在线教科书中有一个部分是针对操作系统本科课程的，它准确地讨论了您的问题。

相关部分是第 6 页的[Memory API 章节中的“Forgetting To Free Memory”，其中给出了以下解释：](http://pages.cs.wisc.edu/~remzi/OSTEP/vm-api.pdf)

> 在某些情况下，似乎不调用 free() 是合理的。例如，你的程序是短暂的，很快就会退出；***在这种情况下，当进程终止时，操作系统将清理其所有分配的页面，因此本身不会发生内存泄漏。***虽然这肯定“有效”（参见第 7 页的旁注），但养成这种习惯可能是个坏习惯，所以要小心选择这样的策略

这段摘录是在介绍虚拟内存概念的背景下进行的。基本上在本书的这一点上，作者解释说操作系统的目标之一是“虚拟化内存”，也就是说，让每个程序相信它可以访问一个非常大的内存地址空间。

在幕后，操作系统会将用户看到的“虚拟地址”转换为指向物理内存的实际地址。

但是，共享物理内存等资源需要操作系统跟踪正在使用它的进程。因此，如果一个进程终止，那么操作系统的能力和设计目标就是回收该进程的内存，以便它可以重新分配并与其他进程共享内存。

* * *

*编辑：*摘录中提到的旁白复制如下。

> 旁白：**为什么进程退出后没有内存泄漏**
> 
> 当您编写一个短期程序时，您可能会使用`malloc()`. 程序运行，即将完成：`free()`退出前是否需要调用一堆？虽然不这样做似乎是错误的，但在任何真正意义上都不会“丢失”任何记忆。原因很简单：系统中确实有两个级别的内存管理。第一级内存管理由操作系统执行，它在进程运行时将内存分配给进程，并在进程退出（或以其他方式死亡）时收回。第二级管理是在每个进程内，例如当你调用 `malloc()`和时在堆内`free()`。即使你没有打电话`free()`（因此在堆中泄漏内存），当程序完成运行时，操作系统将回收进程的所有内存（包括代码、堆栈和堆的那些页面）。无论您的地址空间中的堆处于何种状态，操作系统都会在进程终止时收回所有这些页面，从而确保即使您没有释放内存也不会丢失内存。
> 
> 因此，对于短期程序，内存泄漏通常不会导致任何操作问题（尽管它可能被认为是不良形式）。当您编写一个长时间运行的服务器（例如永远不会退出的 Web 服务器或数据库管理系统）时，内存泄漏是一个更大的问题，并且最终会在应用程序耗尽内存时导致崩溃。当然，内存泄漏是一个特定程序内部的一个更大的问题：操作系统本身。再次向我们展示：编写内核代码的人是最艰巨的工作……
> 
> > *来自[内存 API](http://pages.cs.wisc.edu/~remzi/OSTEP/vm-api.pdf)章节的第 7 页*
> > 
> > **[操作系统：三个简单](http://pages.cs.wisc.edu/~remzi/OSTEP/)**
> > 的部分 Remzi H. Arpaci-Dusseau 和 Andrea C. Arpaci-Dusseau Arpaci-Dusseau 书籍 2015 年 3 月（0.90 版）

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-03-17T15:33:02.817

不释放变量并没有真正的*危险*，但是如果将指向内存块的指针分配给不同的内存块而不释放第一个块，则第一个块不再可访问但仍占用空间。这就是所谓的内存泄漏，如果您经常这样做，那么您的进程将开始消耗越来越多的内存，从而从其他进程中夺走系统资源。

如果该过程是短暂的，您通常可以避免这样做，因为当该过程完成时，操作系统会回收所有分配的内存，但我建议养成释放所有您不再使用的内存的习惯。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-03-17T15:35:06.540

您是对的，进程退出时会自动释放内存。有些人力求在进程终止时不进行大量清理，因为它将全部交给操作系统。但是，当您的程序运行时，您应该释放未使用的内存。如果你不这样做，如果你的工作集变得太大，你最终可能会耗尽或导致过度分页。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-03-17T15:35:35.027

你在这方面是绝对正确的。在小型琐碎程序中，变量必须存在直到程序死亡，释放内存没有真正的好处。

事实上，我曾经参与过一个项目，其中程序的每次执行都非常复杂，但寿命相对较短，我决定只保持分配的内存，而不是因为释放错误而破坏项目的稳定性。

话虽如此，在大多数程序中，这并不是一个真正的选择，否则它会导致您耗尽内存。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-03-17T15:35:26.417

如果您是从头开始开发应用程序，您可以就何时免费调用做出一些明智的选择。您的示例程序很好：它分配内存，也许您让它工作几秒钟，然后关闭，释放它声称的所有资源。

但是，如果您正在编写其他任何东西——一个服务器/长时间运行的应用程序，或者一个供其他人使用的库，您应该期望在您 malloc 的所有内容上调用 free。

暂时忽略务实的一面，遵循更严格的方法会更安全，并强迫自己释放所有你 malloc 的东西。如果您没有在编写代码时观察内存泄漏的习惯，那么您很容易就会出现一些泄漏。所以换句话说，是的——没有它你可以逃脱；不过请小心。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2020-10-21T07:46:22.980

这取决于您正在从事的项目的范围。在你的问题的背景下，我的意思是你的问题，那么没关系。

为了进一步解释（可选），我从整个讨论中注意到的一些场景如下：

(1) - 如果您在嵌入式环境中工作，您不能依赖主操作系统为您回收内存，那么您应该释放它们，因为如果不注意内存泄漏真的会导致程序崩溃。

(2) - 如果您正在从事一个不会向其他人透露的个人项目，那么您可以跳过它（假设您在主操作系统上使用它）或将其包含在“最佳实践”中清酒。

(3) - 如果您正在开发一个项目并计划将其开源，那么您需要对您的受众进行更多研究，并确定释放内存是否是更好的选择。

(4) - 如果您有一个大型库并且您的受众仅包含主操作系统，那么您不需要释放它，因为他们的操作系统会帮助他们这样做。同时，通过不释放，您的库/程序可能有助于提高整体性能，因为程序不必关闭每个数据结构，从而延长关闭时间（想象一下在离开前关闭计算机的非常缓慢的痛苦等待房子...）

我可以继续指定要学习的课程，但这最终取决于您希望通过您的程序实现什么。在某些情况下，释放内存被认为是一种很好的做法，但在某些情况下并不是那么好，因此它最终取决于您所处的具体情况并在正确的时间提出正确的问题。祝你好运！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-07-27T04:22:17.970

如果程序在退出之前忘记释放几兆字节，操作系统将释放它们。但是，如果您的程序一次运行数周，并且程序内部的循环忘记在每次迭代中释放几个字节，那么您将出现严重的内存泄漏，这将耗尽您计算机中的所有可用内存，除非您定期重新启动它base => 如果程序用于一项非常大的任务，即使它最初不是为一个任务设计的，即使是很小的内存泄漏也可能是不好的。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2009-03-17T15:38:19.327

我认为您的两个示例实际上只是一个：`free()`应该仅在流程结束时发生，正如您指出的那样，这是无用的，因为流程正在终止。

不过，在您的第二个示例中，唯一的区别是您允许未定义数量的`malloc()`，这可能导致内存不足。处理这种情况的唯一方法是检查返回码`malloc()`并采取相应措施。

# sql - 拆分 SQL 语句

> ID：654755
> 
> 赞同：2
> 
> 时间：2009-03-17T15:29:33.340
> 
> 标签：sql, mysql, regex

我正在编写一个后端应用程序，它需要能够将多个 SQL 命令发送到 MySQL 服务器。MySQL >= 5.x 支持多个语句，但不幸的是我们正在与 MySQL 4.x 交互。

我试图找到一种方法（提示：正则表达式）用分号分割 SQL 语句，但它应该忽略单引号和双引号字符串中的分号。

[http://www.dev-explorer.com/articles/multiple-mysql-queries](http://www.dev-explorer.com/articles/multiple-mysql-queries)有一个非常好的正则表达式来做到这一点，但不支持双引号。

我很高兴听到你的建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T04:03:15.143

不能用正则表达式完成，解析SQL不够强大。可能有适用于您的语言的 SQL 解析器——它是什么？——但解析 SQL 相当困难，尤其是考虑到可用的不同语法范围。即使仅在 MySQL 中，服务器和连接级别上的许多 SQL_MODE 标志也会影响基本字符串和注释的解析方式，从而使语句的行为完全不同。

dev-explorer 的示例非常有趣，试图处理转义的撇号和尾随字符串，但对于它们的许多有效组合仍然会失败，更不用说双引号、反引号、各种注释语法或 ANSI SQL_MODE。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-13T06:39:37.383

也许使用以下Java Regexp？检查测试...

```
@Test
public void testRegexp() {
    String s = //
        "SELECT 'hello;world' \n" + //
        "FROM DUAL; \n" + //
        "\n" + //
        "SELECT 'hello;world' \n" + //
        "FROM DUAL; \n" + //
        "\n";

    String regexp = "([^;]*?('.*?')?)*?;\\s*";

    assertEquals("<statement><statement>", s.replaceAll(regexp, "<statement>"));
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T04:21:09.237

正如 bobince 所说，正则表达式可能不会强大到足以做到这一点。他们肯定不会强大到足以以任何半优雅的方式做到这一点。cdonner 提供的第二个链接也没有解决这个问题；那里的大多数答案都是试图说服提问者不要在*没有*分号的情况下这样做；如果他接受了一般建议，那么他最终会回到你所在的位置。

我认为解决这个问题的最快方法是使用字符串扫描功能，它按顺序检查字符串的每个字符，并根据一些存储状态做出反应。粗略的伪代码：

1.  读入一个字符
2.  如果字符不特殊，继续
3.  如果字符被转义（检查这可能需要检查前一个字符），继续
4.  如果该字符将开始一个新字符串或结束一个现有字符串，请切换一个标志 IN_STRING（您可能需要多个标志用于不同的字符串类型......我已经诚实地尝试并成功地保持对 SQL 引用/转义的细节一无所知）并继续
5.  如果字符是分号并且我们当前不在字符串中，我们找到了一个查询！输出它并继续扫描直到字符串结束。

语言解析不是我的任何经验领域，因此您需要仔细考虑这种方法；尽管如此，它会很快（使用 C 风格的字符串，这些步骤都不会很昂贵，可能会为 OUTPUT 保存，这取决于“输出”在您的上下文中的含义），我认为它应该完成工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T04:53:34.773

我建议看看你是否可以重新定义问题空间，这样就不需要发送仅由它们的终结符分隔的多个查询。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-17T05:26:20.380

尝试这个。刚刚用 \" 替换了第一个 ' ，它似乎适用于 ' 和 " ;+(?=([^\"|^\\'] *['|\\'][^'|^\\']* ['|\\']) *[^'|^\\']* [^'|^\\']$)

# database - 即使在“野外”安装时，什么 DBMS 也适合保持模式私有

> ID：654758
> 
> 赞同：0
> 
> 时间：2009-03-17T15:31:06.723
> 
> 标签：database, security, installation, reverse-engineering

我有一个连接到数据库服务器的应用程序服务器。我希望能够为用户提供安装程序，并以适度的舒适度相信数据库架构是安全的。

我知道，如果不控制安装它的计算机，我将不得不接受一些风险——一个拥有正确工具和知识的坚定的人可以直接查看内存并提取信息。

最初，我认为我的重点领域只是将凭据添加到安装程序，而无需在十六进制编辑器中轻松查看它们。

然而，当我开始研究时，我了解到对于 PostGreSQL，即使我静默安装数据库并且不向用户提供凭据——他们也可以简单地更改基于文本的配置文件 (pg_hba.conf)，并且重新启动服务器，无需凭据即可完全访问数据库。

这种情况在其他 DBMS 中是否安全？在这种情况下，大多数商业产品如何保护它们的模式？大多数产品会使用嵌入式数据库吗？

* * *

编辑：我假设（也许是错误的）某些产品依赖于用户从未真正直接接触过的数据库。我当然从来没有见过他们，因为他们以用户不需要的方式设计了它 - 可能使用嵌入式数据库。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T16:30:59.230

据我记得，没有商业产品可以*“保护”*他们的模式。您希望保护架构免受什么影响？

考虑以下几点：

*   毕竟，唯一可以保护 RDBMS 中任何内容的人是数据库服务器管理员。并且您希望架构免受此人的侵害？

*   如果我是一名客户并且我**的数据**包含在您的架构中，我不仅希望而且希望能够直接查看和使用它。

*   你真的需要保护你的关系设计吗？真的那么有趣吗？你有没有发明一些值得隐藏的东西？我真的不这么认为。如果你有的话，我提前道歉。

* * *

编辑：附加评论：

我不关心我使用的产品的大多数数据库内部结构。这是我认为他们中的大多数人没有采取任何行动保护他们的另一个原因。他们中的大多数都不是那么有趣。

一方面，我坚信用户不需要知道或关心数据库的内部结构。但在同一级别，作为开发人员，我认为不值得尝试保护他们。对用户隐藏它们，是的。保护它们免受直接访问，在大多数情况下，不会。并不是因为我认为保护您的架构是错误的。这是因为我认为这是一件非常困难的事情，不值得你作为开发人员花时间。

但最后，与任何与安全相关的话题一样，唯一正确的答案是所涉及的**风险**与实施安全措施的**成本是什么。**

当前的数据库引擎，无论是嵌入式的还是服务器式的，都不能轻易地隐藏数据库的模式，因此，对于大多数人来说，这样做的开发成本要比所涉及的风险大得多。

但你的情况可能不同。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T16:43:10.870

大多数商业产品不保护它们的模式。他们属于两个阵营之一：

他们要么将企业级数据库用于产品的关键组件（例如工资系统），在这种情况下，不会尝试隐藏模式/数据。在大多数情况下，客户无论如何都需要控制数据库 - 配置数据库的备份方式，能够创建集群环境等。

另一种情况是，如果您的“数据库”只是桌面应用程序的一个小设置或存储文件（例如 FireFox 中的历史和书签数据库）。在这种情况下，您应该只使用嵌入式数据库（如 SQLite，与 FireFox 相同）并添加流式加密层（有一个名为 SEE 的官方版本），或者只使用嵌入式数据库而忘记加密层，因为用户首先需要安装自己的数据库工具才能读取文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-23T16:51:43.047

你想解决什么问题？没有什么可以阻止 DBA* 对标准数据库做任何他想做的事情，正如其他人指出的那样，干扰特定站点的需求（如备份和数据库升级）是非常不利的。您最多可以加密数据库的内容，但即便如此，您也必须为您的应用程序实际运行提供一个解密密钥，而一个积极而充满敌意的 DBA 可能会破坏它。

毫无疑问，军事和情报界拥有数据库，其中甚至架构都是高度机密的，但我不知道他们是否受到技术手段的保护，或者只是拥有枪支的大个子。

(*) DBA 或系统管理员能够修改 pg_hba.conf 等文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T16:33:57.537

> 在这种情况下，大多数商业产品如何保护它们的模式？

我不相信大多数商业产品会做任何事情来保护他们的模式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-17T05:13:45.980

当某人可以物理访问运行此 DBMS 的机器时，嵌入式 DBMS 如何阻止某人修改其存储（此非嵌入式硬件上下文中的文件）？[通过默默无闻的安全](http://en.wikipedia.org/wiki/Security_through_obscurity)是一个冒险的提议。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-17T05:59:04.000

这个想法将遭受与 DRM 相同的问题。您无法阻止有决心的人访问，您只会给您的客户带来普遍的痛苦和痛苦。只是不要这样做。

SQLite 将其整个数据库格式包装到一个文件中，您可以想象就地加密和解密它。当然，缺陷是用户现在需要密钥才能使用数据库，而唯一可能发生的方法是如果您将其提供给他们，可能是通过在编译时将其硬编码（通过默默无闻的安全性）或电话回家计划（这是一个坏主意的全部原因）。另外，现在他们会恨你，因为你挫败了任何有用的备份系统的尝试，而且他们的启动性能很差。

此外，没有人真正关心模式。讨厌打破它，但模式设计不是一个难题，当然也绝不是合法的竞争优势（除了知识表示和数据仓库等一些特定领域之外）。首先，模式通常不值得保护。

如果它对您来说真的那么重要，请改为使用托管应用程序。

# asp.net - 在 ASP.Net 中制作可变大小的表格（必须有更好的方法......）

> ID：654772
> 
> 赞同：0
> 
> 时间：2009-03-17T15:33:53.253
> 
> 标签：asp.net

目前我正在编写代码来制作可变大小的表格，其中包含 asp:controls，看起来像这样：

```
TableRow tableHeader = new TableRow();
    tableHeader.ID = "tableHeader";
    userTable.Rows.Add(tableHeader);

        TableCell tableHeaderCell_1 = new TableCell();
        tableHeader.Cells.Add(tableHeaderCell_1);

        TableCell tableHeaderCell_2 = new TableCell();
            Label lblThc2 = new Label();
            lblThc2.Text = "<b>Name:</b>";
            tableHeaderCell_2.Controls.Add(lblThc2);
        tableHeader.Cells.Add(tableHeaderCell_2);

        TableCell tableHeaderCell_3 = new TableCell();
            Label lblThc3 = new Label();
            lblThc3.Text = "<b>User</b>";
            tableHeaderCell_3.Controls.Add(lblThc3);
        tableHeader.Cells.Add(tableHeaderCell_3);

        ... 
```

和看起来像的身体：

```
for(int i = 0; i < dynamicTableLength; i++)
{
    TableRow tableBodyTemp = new TableRow();
    tableBodyTemp.ID = "tableBody" + i;
    userTable.Rows.Add(tableBodyTemp);

        TableCell tableBodyCell_1 = new TableCell();
                        Label lblThc2 = new Label();
            lblThc2.Text = "<b>"+ i +"</b>";
            tableBodyCell_1.Controls.Add(lblThc2);
        tableHeader.Cells.Add(tableHeaderCell_1);

        TableCell tableBodyCell_2 = new TableCell();
            TextBox text = new TextBox();
                            text.ID = "name" + i;
                            text.GroupName = "myGroup";
        tableHeader.Cells.Add(tableHeaderCell_2);

                    ...

} 
```

当您不知道需要多少行时，必须有一种更好的方法来创建表格/表单......或者*一般来说*！

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T15:40:56.340

使用[中继器](http://www.sitepoint.com/article/asp-net-repeater-control/)控件。这使您可以将标记保留在 aspx 页面中。它还允许您非常轻松地更改标记。您将不会被限制在一个表格中 - 如果以后有必要，您可以轻松地将其更改为 div 或列表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T15:58:58.013

只需创建一些辅助方法来使您的代码更具可读性。您有几个可以重构的复制/粘贴部分，这应该会大大改善您的情况。

# asp.net - 如何找出部署 ASP.NET+VB 应用程序所需的 IIS 版本？

> ID：654776
> 
> 赞同：0
> 
> 时间：2009-03-17T15:34:11.597
> 
> 标签：asp.net, vb.net, iis

我刚刚得到了用 ASP.NET 和 VB 编写的应用程序，我可以将它部署在任何 IIS 上吗？

项目中是否有包含此类信息的文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T15:37:03.260

我猜任何支持 ISAPI 的 IIS，但建议使用 IIS 5.1 +（.NET 可能无论如何都不会在运行 IIS4 的操作系统上运行）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T15:39:03.147

IIS 6 是最新的 .NET 版本（即 Windows 2003）的最低版本，因为不支持 Win2000（此处仅考虑服务器）。

Windows 版本会告诉您 IIS 版本：

服务器 2003：IIS 6
服务器 2008：IIS 7
服务器 2008 R2：IIS 7.5

还有XP：IIS5.1；远景：IIS7

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:41:14.357

任何地方都没有文件或幻数可以告诉您这一点。它很有可能会在更新版本的 IIS 上运行，但即便如此，您仍然需要知道它需要什么功能。例如，它是否使用 WebDav？IIS 非常擅长向后兼容，但前向兼容性不太好。例如，IIS7 引入了新功能，如果应用程序正在使用它，则会阻止它在 IIS6 上运行。

你知道它需要什么版本的 .net 比其他任何版本更容易咬你吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T15:42:43.777

这是一个很好的 MSDN 链接，详细说明了哪个 IIS 版本与哪个版本的 Windows 一起提供，以及用于配置它的有用链接。

[ASP.NET 和 IIS 配置](http://msdn.microsoft.com/en-us/library/ms178477.aspx)

# sql-server - 在单独的内存分配中运行 SSIS 包或增加默认缓冲区大小？

> ID：654780
> 
> 赞同：6
> 
> 时间：2009-03-17T15:35:06.447
> 
> 标签：sql-server, sql-server-2005, ssis

我有一个 SSIS 包，它有一个失败的子包。错误消息不是很有帮助。

> 尝试向数据流任务缓冲区添加行失败，错误代码为 0xC0047020

问题似乎是我用完了虚拟内存来完成这项工作。

我找到了一个可以帮助解决问题的论坛帖子。 [http://social.msdn.microsoft.com/forums/en-US/sqlintegrationservices/thread/d6d52157-0270-4200-a8c2-585fa9a0eed5/](http://social.msdn.microsoft.com/forums/en-US/sqlintegrationservices/thread/d6d52157-0270-4200-a8c2-585fa9a0eed5/)

从提供的解决方案中，我不确定如何：

1.  增加默认缓冲区大小
2.  将一个子包分配到它自己的内存分配中。

我每天都在 SQL Server 2005 中运行该程序包。直到 12 日，我每天都运行良好。我假设我们用来将数据导入数据库的 dat 文件增长到了数据库无法处理的大小。它只是一个 8.90MB 的 csv 文件。导入是直接列到列的导入。

问题子包是第 1 步，失败后继续并成功完成接下来的 8 个步骤。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T17:04:47.450

为 SQL Server 分配了多少内存？在 SQL Server 进程空间之外分配了多少内存？

我问的原因是因为 SSIS 内存是从位于 SQL Server 进程空间之外的内存的 memToLeave 区域分配的。

有关配置可用于内存的 memToLeave 部分的内存量的详细信息，请参阅[此处。](http://www.johnsansom.com/index.php/2009/03/sql-server-memory-configuration-determining-memtoleave-settings/)

有关 SSIS 的通用性能调整，请参阅以下文章。

[http://technet.microsoft.com/en-gb/library/cc966529.aspx](http://technet.microsoft.com/en-gb/library/cc966529.aspx)

我希望这是有道理的，但是一旦您消化了材料，请随时给我留言。

干杯，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T19:33:45.883

胡思乱想：内存泄漏？

我们的 prod 集群（bigcorporatebbuild）是 SQL 2005 SP1。内存泄漏，需要每 1-4 周重新启动一次。

SP2 + HF 3068：固定

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T21:19:41.590

要更改缓冲区大小，请选择数据流任务并更改 DefaultBufferMaxRows、MaxBufferSize 属性。它们共同确定缓冲区大小。

请注意，在您链接的讨论中，用户最初增加了缓冲区大小（至 100Mb），这可能导致了问题，建议**减少**它。默认缓冲区大小（10Mb）通常应该没问题。

要在单独的进程中运行子包，请设置 Execute Package 任务（在主包中）的 ExecuteOutOfProcess 属性。

但首先：确保您真正运行的是虚拟内存，而不是实际内存，这通常更有可能。在任务管理器中查看这台机器上消耗内存的进程。

# jquery - 选择选项时删除选项的 css 类

> ID：654796
> 
> 赞同：1
> 
> 时间：2009-03-17T15:38:01.870
> 
> 标签：jquery, html, css

```
<select class="FunctieSelect">
<option class="yellow" value="-1">- kies -</option>
<option class="yellow" value="1">KSZ functie</option>
<option class="yellow" value="2">Bakker</option>
<option class="yellow" value="3">Schilder</option>
<option class="yellow" value="4">Andere</option>
</select> 
```

和

```
.yellow
{
    background-color: Yellow;
} 
```

产生以下输出：

[替代文字 http://thomasstock.net/selectCss.JPG](http://thomasstock.net/selectCss.JPG)

实际上，只有一个选项会有黄色背景，所以在选择上设置 css 对我没有帮助

=> 如何使选项在被选中时保持黄色？

我知道一个可能的解决方案是使用 jquery 进行“更改”事件，检查更改事件选择了哪个选项，然后设置选择的 css。但我想知道是否有更简单的解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T15:42:17.817

不幸的是，您看到的是浏览器的默认小部件行为，没有 CSS 覆盖。您可以使用一些选项 - 也许像[驯服选择这样的](http://icant.co.uk/forreview/tamingselect/)东西会有所帮助？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T15:50:38.047

同意安德鲁。但是，您可能会想到的另一件事是，当您更改表单元素的样式时，可用性会下降。如果您的意思是表示表单的更改部分，您可能只需突出显示选择周围的框。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T15:56:33.290

如果您想设置选择框的样式，我建议将它们替换为 JQuery Flexbox ( [demo](http://www.fairwaytech.com/flexbox/Demos.aspx) ) 之类的东西。如果不是，它们将在浏览器和平台上以不同的方式呈现。

# asp.net - 为什么 UpdatePanel 响应大小在备用请求上会发生变化？

> ID：654797
> 
> 赞同：1
> 
> 时间：2009-03-17T15:38:01.900
> 
> 标签：asp.net, firefox, asp.net-ajax, internet-explorer-7, updatepanel

我们在大页面的一小部分中使用 UpdatePanel，并注意到一个性能问题，即 IE7 受 CPU 限制并且 UpdatePanel 中的控件需要很长时间（超过 30 秒）才能呈现。我们还注意到 Firefox 似乎没有受到这些延迟的影响。

我们同时运行了 Fiddler（针对 IE）和 Firebug（针对 Firefox），并注意到真正的问题在于更新面板响应中返回的数据量。在 UpdatePanel 控件中有一个表，其中包含许多 ListBox 控件。真正的问题是每隔一段时间响应（从进行列表框选择）从 30K 到 430K 交替变化。Firefox 在合理的时间内处理 400+K 响应。无论出于何种原因，IE7 在处理这些数据时都会受到 CPU 的限制。

因此，无论我们是否应该使用 UpdatePanel，我们都想弄清楚为什么每个其他异步回发响应都比前一个响应大 10 倍以上。当响应在 30K 范围内时，IE 会在一秒钟内更新显示。在交替时间，响应时间要长 10 倍以上。知道为什么 UpdatePanel 会发生这种交替行为吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-21T18:18:46.030

它是带有 IE的已知 Microsoft 问题[KB 2000262 。](http://support.microsoft.com/kb/2000262)

[UpdatePanel Async Postsback 在 IE 中很慢……第 3 部分](http://blog.devlpr.net/2009/09/01/updatepanel-async-postsback-slow-in-ie-part-3/)。

# asp.net - Linq to SQL - 双引号问题

> ID：654802
> 
> 赞同：0
> 
> 时间：2009-03-17T15:38:52.773
> 
> 标签：asp.net, linq-to-sql, escaping, quotes

我有一个问题，如果我在 ASP.NET 中有一个文本区域并在句子的最后输入 2 个双引号，我的 sql 语句中会出现错误。我已经通过 sql profiler 进行了跟踪，但没有运气。

例如。懒惰的狐狸跳过狗“”。这失败了……

” ““懒惰的”狐狸跳过狗。这看起来不错

任何指针最受欢迎

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T15:41:32.813

您是否将用户输入直接连接到 SQL 语句中？如果是这样，那几乎肯定是问题所在。

如果您改用参数化的 SQL 语句（即，将用户数据作为参数而不是直接在 SQL 中发送）应该没问题。这样，您还可以防范 SQL 注入攻击......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T15:48:02.983

您可能应该发布**确切的**错误消息（如果可能，还应该发布说明性代码）。另外 - 请注意，使用 LINQ-to-SQL，您不需要 sql profiler 来查看跟踪：

```
ctx.Log = Console.Out; // job done 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T15:41:49.847

```
0x3A28213A 
0X6339392C 
0X7363682E 
```

# c# - DataGridViewComboBoxCell 绑定 - “值无效”

> ID：654829
> 
> 赞同：31
> 
> 时间：2009-03-17T15:45:44.127
> 
> 标签：c#, datagridview, datagridviewcombobox

我正在尝试将 DataGridView 中的单独 ComboBox 单元格绑定到自定义类，并不断收到错误消息

> DataGridViewComboBoxCell 值无效

我目前正在将单元格的数据源分配给`IList<ICustomInterface>`我拥有的字典中的一个。但是，在设置数据源时，`ComboBoxCell`未设置索引，因此选择了无效值。

我试图弄清楚如何让它选择一个实际值，例如列表中的第 0 个项目，它被赋予以消除此错误，或找到另一种解决问题的方法。有人有什么建议吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-17T15:55:20.597

发布问题后不久，我设法找到了解决方案。对于其他任何人：

问题是我试图将 分配`DataGridViewComboBoxCell.Value`给一个对象，期望因为 Cell 绑定到一个数据源，它会自动在源中找到该对象并更新。

实际上并非如此，您实际上需要将值设置为等于`ValueMember`属性的值，才能正确更新值和绑定。我相信我对两者都使用了属性“名称” `ValueMember`（`DisplayMember`控制单元格中的呈现方式），因此将值设置为`interface.ToString()`（而不是接口实例）适用于大多数情况。然后我捕获并忽略在更改源时发生的任何 DataError 异常。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2014-01-22T14:04:52.013

这是我使用枚举时的简单解决方案

```
ColumnType.ValueType = typeof (MyEnum);
ColumnType.DataSource = Enum.GetValues(typeof (MyEnum)); 
```

您可以在“InitializeComponent();”之后执行此操作

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-08-18T09:30:00.373

经过数小时的试验，我终于找到了一个可行的解决方案。

```
// Create a DataGridView
System.Windows.Forms.DataGridView dgvCombo = new System.Windows.Forms.DataGridView();

// Create a DataGridViewComboBoxColumn
System.Windows.Forms.DataGridViewComboBoxColumn colCombo = new 

System.Windows.Forms.DataGridViewComboBoxColumn();

// Add the DataGridViewComboBoxColumn to the DataGridView
dgvCombo.Columns.Add(colCombo);

// Define a data source somewhere, for instance:
public enum DataEnum
{
    One,
    Two,
    Three
}

// Bind the DataGridViewComboBoxColumn to the data source, for instance:
colCombo.DataSource = Enum.GetNames(typeof(DataEnum));

// Create a DataGridViewRow:
DataGridViewRow row = new DataGridViewRow();

// Create a DataGridViewComboBoxCell:
DataGridViewComboBoxCell cellCombo = new DataGridViewComboBoxCell();

// Bind the DataGridViewComboBoxCell to the same data source as the DataGridViewComboBoxColumn:
cellCombo.DataSource = Enum.GetNames(typeof(DataEnum));

// Set the Value of the DataGridViewComboBoxCell to one of the values in the data source, for instance:
cellCombo.Value = "Two";
// (No need to set values for DisplayMember or ValueMember.)

// Add the DataGridViewComboBoxCell to the DataGridViewRow:
row.Cells.Add(cellCombo);

// Add the DataGridViewRow to the DataGridView:
dgvCombo.Rows.Add(row);

// To avoid all the annoying error messages, handle the DataError event of the DataGridView:
dgvCombo.DataError += new DataGridViewDataErrorEventHandler(dgvCombo_DataError);

void dgvCombo_DataError(object sender, DataGridViewDataErrorEventArgs e)
{
    // (No need to write anything in here)
} 
```

就这些。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-24T02:14:04.170

我有同样的问题。

在我的情况下，解决方案是填充外键表的数据适配器。这不是自动填充的，这就是问题的原因。

在`Page_Load`事件中：

```
Me.TblUserTypesTableAdapter.Fill(Me.DonateDataSet.tblUserTypes) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-09T14:42:59.463

我有同样的问题。在（unbouod）DataGrid 中填充我的 ComboBox 列后，我通过设置`DataGridViewComboBoxColumn` 显然的 ValueMember 属性解决了我的问题，仅仅依靠`ToString()`ComboBox 中对象的属性是不够的。

实际代码：

```
/// <summary>
/// Populate the dataGridSplitVolumes data grid with all existing qualifications for the plan.
/// </summary>
/// <param name="bonus"></param>
private void PopulateDataGridSplitVolumes(Bonus_Group bonus)
{
  try
  {
    List<Qualification> qualifications = Qualification.Load(this.groupBonus.PlanID, this.ConnectionString);
    foreach (Qualification qual in qualifications)
    {
      DataGridViewComboBoxColumn col = (DataGridViewComboBoxColumn)this.dataGridSplitVolumes.Columns[0];
      col.Items.Add(qual);                    
    }
    SplitVolumeGrid_QualificationColumn.ValueMember = "Name";
  }
  catch (Exception ex)
  {
#if DEBUG
    System.Diagnostics.Debugger.Break();
#endif
    throw ex;
  }
}//PopulateDataGridSplitVolumes 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-12-11T09:12:37.890

为了人们不像我那样挣扎。

绑定组合时，您正在设置 DisplayMember（用户将看到的内容）和 ValueMember（您的应用程序将获得的内容）。

设置完这些后，您需要设置值，这就是失败的地方。基本上，值的 TYPE 需要与 ValueMember 的 TYPE 相同。

因此，如果您的值成员显然是一个 INT 类型的 ID，并且您需要将值设置为 int，例如 Cell.Value = 1;。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-12-20T09:38:24.237

使用 DataError 事件处理程序，

```
private void shahriartableDataGridView_DataError(object sender, DataGridViewDataErrorEventArgs e)
        {
            //You don't have to write anything here !
        } 
```

并且您的 DisplayMember 和 ValueMember 数据类型应该相同，在我的情况下，我对两者都有 CountryName 。一切对我来说都很好......！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-11-14T17:56:47.027

这是一个带有基本表单并`DataGridView`通过设计器添加的完整示例：

设置和绑定：

```
private void Form1_Load(object sender, EventArgs e)
{

    var colors = new List<Code>()
    {
        new Code() {Value= "R", Text = "Red"},
        new Code() {Value= "G", Text = "Green"},
        new Code() {Value= "B", Text = "Blue"}
    };

    var users = new List<User>()
    {
        new User() {Name = "Briana", FavoriteColor = "B"},
        new User() {Name = "Grace", FavoriteColor = "G"}
    };

    var colorCol = new DataGridViewComboBoxColumn();
    colorCol.DataSource = colors;
    colorCol.DisplayMember = "Text";
    colorCol.ValueMember = "Value";
    colorCol.DataPropertyName = "FavoriteColor";

    dataGridView1.Columns.Add(colorCol);
    dataGridView1.DataSource = users;

} 
```

一些课程：

```
public class Code
{
    public string Value { get; set; }
    public string Text { get; set; }
}

public class User
{
    public string Name { get; set; }
    public string FavoriteColor { get; set; }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-10-20T04:26:41.523

为单元格设置一个空值：

```
dataGridView.CurrentRow.Cells[NAME].Value = null; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-02-24T10:53:58.670

我遇到了同样的问题。该消息是100％的。组合框的值类似于：Exact、StartsWith... 我试图设置值 Exactă（不是 Exact）。当我使用 DataTable.ReadXml(...) 从 .xml 文件中读取 DataGridView 的 DataTable 时，这是自动发生的。.xml 文件中的值已关闭。

# c# - 实现接收“服务器”应用程序的项目类型

> ID：654832
> 
> 赞同：1
> 
> 时间：2009-03-17T15:46:10.897
> 
> 标签：c#

我正在为我已经制作的客户端开发一个服务器应用程序。这个想法是客户端全天创建文件（序列化对象），在一天结束时，需要前往服务器，以便可以分析这些文件并将其数据插入主D b。

我想知道是否有更好的项目类型来实现这一点：

*   使用需要上传的对象调用 web 方法的 Web 服务被接受为参数。
*   仅在端口上等待并接受数据的 Windows 服务。
*   带有一个程序的 ftp 服务器，该程序只监视 ftp 上传文件夹并在上传时抓取数据。
*   任何我没有想到的

我倾向于第一个，但我不知道为什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T15:51:05.440

您可能倾向于第一个，因为它最简单！最简单的通常是最好的！

Web 服务非常全面，可以提供从简单的 GET 到复杂的启用 WCF 的服务的任何内容。可以通过 HTTPS 和身份验证轻松添加安全性。Web 服务/WCF 可能无法很好地处理大量文件，但您可以考虑将它们拆分为数据包。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T15:53:31.490

我认为第一个将是最简单的选择，您的大部分基础架构（身份验证和协议管理突出）已经到位。因此，您可以专注于应用程序的逻辑。

# mysql - 如何在 hibernatetool Ant 任务中找到 JNDI 资源

> ID：654833
> 
> 赞同：7
> 
> 时间：2009-03-17T15:46:24.517
> 
> 标签：mysql, hibernate, ant, hbm2ddl

我想用 Ant 生成我的数据库模式。我正在使用 hbm2ddl 任务。

我正在使用带有 JNDI 的 Hibernate。我的 hibernate.cfg.xml 看起来像：

```
<!DOCTYPE hibernate-configuration PUBLIC
        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd">

<hibernate-configuration>
    <session-factory>
        <!-- Database connection settings -->
        <property name="connection.datasource">java:comp/env/jdbc/my_app</property>
        <property name="dialect">org.hibernate.dialect.MySQLDialect</property>
        <property name="current_session_context_class">thread</property>

            <!-- Mapping -->   
  </session-factory>  
</hibernate-configuration> 
```

我的 $CATALINA_HOME/webapps/myapp/META-INF/context.xml 看起来像：

```
<Context>
    <Resource name="jdbc/my_app" 
            global="jdbc/my_app"
            auth="Container"
            type="javax.sql.DataSource" 
            username="userA"
            password="userA123"
            driverClassName="com.mysql.jdbc.Driver"
            url="jdbc:mysql://localhost:3306/myapp?autoReconnect=true"
            maxActive="8" 
            maxIdle="4"/>
</Context> 
```

在 $CATALINA_HOME/webapps/myapp/WEB-INF/web.xml 我有：

```
 <resource-ref>
    <description>DB Connection</description>
    <res-ref-name>jdbc/my_app</res-ref-name>
    <res-type>javax.sql.DataSource</res-type>
    <res-auth>Container</res-auth>
</resource-ref> 
```

在**build.xml**我有下一个目标。

```
<target name="schema" description="Generate DB schema from the O/R mapping files">
    <hibernatetool destdir="${basedir}">
        <classpath path="${java.src.home}">
          <fileset dir="${java.src.home}">
                  <include name="**/*.hbm.xml"/>
          </fileset>
        </classpath>
    <configuration configurationfile="${java.src.home}/hibernate.cfg.xml"/>         
        <hbm2ddl 
            drop="true" 
            create="true"
            export="true"
            outputfilename="myapp-ddl.sql"
            delimiter=";"
            format="true"/>       
    </hibernatetool>
</target> 
```

问题是 ant 没有找到存储在 context.xml 中的 Resource 元素。

```
[hibernatetool] Error #1: org.hibernate.HibernateException: Could not find datasource 
```

我尝试在类路径元素中添加 nex 片段，但没有成功。

```
 <fileset dir="${web.home}/META-INF">
       <include name="context.xml"/>
   </fileset> 
```

**如何让 Ant 找到 context.xml 中定义的资源？**

我发布了一个完整的错误堆栈跟踪。

```
[hibernatetool] INFO: JNDI InitialContext properties:{}
[hibernatetool] java.util.zip.ZipException: error in opening zip file
[hibernatetool]     at java.util.zip.ZipFile.open(Native Method)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:114)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:131)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.getResourceURL(AntClassLoader.java:1014)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.findNextResource(AntClassLoader.java:146)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.<init>(AntClassLoader.java:108)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.findResources(AntClassLoader.java:958)
[hibernatetool]     at java.lang.ClassLoader.getResources(ClassLoader.java:1016)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12$5.run(VersionHelper12.java:149)
[hibernatetool]     at java.security.AccessController.doPrivileged(Native Method)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12.getResources(VersionHelper12.java:146)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getApplicationResources(ResourceManager.java:468)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getInitialEnvironment(ResourceManager.java:159)
[hibernatetool]     at javax.naming.InitialContext.init(InitialContext.java:219)
[hibernatetool]     at javax.naming.InitialContext.<init>(InitialContext.java:175)
[hibernatetool]     at org.hibernate.util.NamingHelper.getInitialContext(NamingHelper.java:28)
[hibernatetool]     at org.hibernate.connection.DatasourceConnectionProvider.configure(DatasourceConnectionProvider.java:52)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:124)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:56)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.ManagedProviderConnectionHelper.prepare(ManagedProviderConnectionHelper.java:27)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.execute(SchemaExport.java:180)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.create(SchemaExport.java:133)
[hibernatetool]     at org.hibernate.tool.ant.Hbm2DDLExporterTask.execute(Hbm2DDLExporterTask.java:55)
[hibernatetool]     at org.hibernate.tool.ant.HibernateToolTask.execute(HibernateToolTask.java:171)
[hibernatetool]     at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
[hibernatetool]     at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
[hibernatetool]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[hibernatetool]     at java.lang.reflect.Method.invoke(Method.java:597)
[hibernatetool]     at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
[hibernatetool]     at org.apache.tools.ant.Task.perform(Task.java:348)
[hibernatetool]     at org.apache.tools.ant.Target.execute(Target.java:357)
[hibernatetool]     at org.apache.tools.ant.Target.performTasks(Target.java:385)
[hibernatetool]     at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
[hibernatetool]     at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
[hibernatetool]     at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.EclipseDefaultExecutor.executeTargets(EclipseDefaultExecutor.java:32)
[hibernatetool]     at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.run(InternalAntRunner.java:423)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.main(InternalAntRunner.java:137)
[hibernatetool] java.util.zip.ZipException: error in opening zip file
[hibernatetool]     at java.util.zip.ZipFile.open(Native Method)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:114)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:131)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.getResourceURL(AntClassLoader.java:1014)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.findNextResource(AntClassLoader.java:146)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.<init>(AntClassLoader.java:108)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.findResources(AntClassLoader.java:958)
[hibernatetool]     at java.lang.ClassLoader.getResources(ClassLoader.java:1016)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12$5.run(VersionHelper12.java:149)
[hibernatetool]     at java.security.AccessController.doPrivileged(Native Method)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12.getResources(VersionHelper12.java:146)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getApplicationResources(ResourceManager.java:468)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getInitialEnvironment(ResourceManager.java:159)
[hibernatetool]     at javax.naming.InitialContext.init(InitialContext.java:219)
[hibernatetool]     at javax.naming.InitialContext.<init>(InitialContext.java:175)
[hibernatetool]     at org.hibernate.util.NamingHelper.getInitialContext(NamingHelper.java:28)
[hibernatetool]     at org.hibernate.connection.DatasourceConnectionProvider.configure(DatasourceConnectionProvider.java:52)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:124)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:56)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.ManagedProviderConnectionHelper.prepare(ManagedProviderConnectionHelper.java:27)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.execute(SchemaExport.java:180)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.create(SchemaExport.java:133)
[hibernatetool]     at org.hibernate.tool.ant.Hbm2DDLExporterTask.execute(Hbm2DDLExporterTask.java:55)
[hibernatetool]     at org.hibernate.tool.ant.HibernateToolTask.execute(HibernateToolTask.java:171)
[hibernatetool]     at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
[hibernatetool]     at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
[hibernatetool]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[hibernatetool]     at java.lang.reflect.Method.invoke(Method.java:597)
[hibernatetool]     at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
[hibernatetool]     at org.apache.tools.ant.Task.perform(Task.java:348)
[hibernatetool]     at org.apache.tools.ant.Target.execute(Target.java:357)
[hibernatetool]     at org.apache.tools.ant.Target.performTasks(Target.java:385)
[hibernatetool]     at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
[hibernatetool]     at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
[hibernatetool]     at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.EclipseDefaultExecutor.executeTargets(EclipseDefaultExecutor.java:32)
[hibernatetool]     at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.run(InternalAntRunner.java:423)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.main(InternalAntRunner.java:137)
[hibernatetool] java.util.zip.ZipException: error in opening zip file
[hibernatetool]     at java.util.zip.ZipFile.open(Native Method)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:114)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:131)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.getResourceURL(AntClassLoader.java:1014)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.findNextResource(AntClassLoader.java:146)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.<init>(AntClassLoader.java:108)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.findResources(AntClassLoader.java:958)
[hibernatetool]     at java.lang.ClassLoader.getResources(ClassLoader.java:1016)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12$5.run(VersionHelper12.java:149)
[hibernatetool]     at java.security.AccessController.doPrivileged(Native Method)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12.getResources(VersionHelper12.java:146)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getApplicationResources(ResourceManager.java:468)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getInitialEnvironment(ResourceManager.java:159)
[hibernatetool]     at javax.naming.InitialContext.init(InitialContext.java:219)
[hibernatetool]     at javax.naming.InitialContext.<init>(InitialContext.java:175)
[hibernatetool]     at org.hibernate.util.NamingHelper.getInitialContext(NamingHelper.java:28)
[hibernatetool]     at org.hibernate.connection.DatasourceConnectionProvider.configure(DatasourceConnectionProvider.java:52)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:124)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:56)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.ManagedProviderConnectionHelper.prepare(ManagedProviderConnectionHelper.java:27)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.execute(SchemaExport.java:180)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.create(SchemaExport.java:133)
[hibernatetool]     at org.hibernate.tool.ant.Hbm2DDLExporterTask.execute(Hbm2DDLExporterTask.java:55)
[hibernatetool]     at org.hibernate.tool.ant.HibernateToolTask.execute(HibernateToolTask.java:171)
[hibernatetool]     at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
[hibernatetool]     at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
[hibernatetool]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[hibernatetool]     at java.lang.reflect.Method.invoke(Method.java:597)
[hibernatetool]     at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
[hibernatetool]     at org.apache.tools.ant.Task.perform(Task.java:348)
[hibernatetool]     at org.apache.tools.ant.Target.execute(Target.java:357)
[hibernatetool]     at org.apache.tools.ant.Target.performTasks(Target.java:385)
[hibernatetool]     at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
[hibernatetool]     at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
[hibernatetool]     at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.EclipseDefaultExecutor.executeTargets(EclipseDefaultExecutor.java:32)
[hibernatetool]     at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.run(InternalAntRunner.java:423)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.main(InternalAntRunner.java:137)
[hibernatetool] java.util.zip.ZipException: error in opening zip file
[hibernatetool]     at java.util.zip.ZipFile.open(Native Method)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:114)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:131)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.getResourceURL(AntClassLoader.java:1014)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.findNextResource(AntClassLoader.java:146)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.<init>(AntClassLoader.java:108)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.findResources(AntClassLoader.java:958)
[hibernatetool]     at java.lang.ClassLoader.getResources(ClassLoader.java:1016)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12$5.run(VersionHelper12.java:149)
[hibernatetool]     at java.security.AccessController.doPrivileged(Native Method)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12.getResources(VersionHelper12.java:146)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getApplicationResources(ResourceManager.java:468)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getInitialEnvironment(ResourceManager.java:159)
[hibernatetool]     at javax.naming.InitialContext.init(InitialContext.java:219)
[hibernatetool]     at javax.naming.InitialContext.<init>(InitialContext.java:175)
[hibernatetool]     at org.hibernate.util.NamingHelper.getInitialContext(NamingHelper.java:28)
[hibernatetool]     at org.hibernate.connection.DatasourceConnectionProvider.configure(DatasourceConnectionProvider.java:52)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:124)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:56)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.ManagedProviderConnectionHelper.prepare(ManagedProviderConnectionHelper.java:27)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.execute(SchemaExport.java:180)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.create(SchemaExport.java:133)
[hibernatetool]     at org.hibernate.tool.ant.Hbm2DDLExporterTask.execute(Hbm2DDLExporterTask.java:55)
[hibernatetool]     at org.hibernate.tool.ant.HibernateToolTask.execute(HibernateToolTask.java:171)
[hibernatetool]     at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
[hibernatetool]     at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
[hibernatetool]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[hibernatetool]     at java.lang.reflect.Method.invoke(Method.java:597)
[hibernatetool]     at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
[hibernatetool]     at org.apache.tools.ant.Task.perform(Task.java:348)
[hibernatetool]     at org.apache.tools.ant.Target.execute(Target.java:357)
[hibernatetool]     at org.apache.tools.ant.Target.performTasks(Target.java:385)
[hibernatetool]     at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
[hibernatetool]     at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
[hibernatetool]     at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.EclipseDefaultExecutor.executeTargets(EclipseDefaultExecutor.java:32)
[hibernatetool]     at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.run(InternalAntRunner.java:423)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.main(InternalAntRunner.java:137)
[hibernatetool] java.util.zip.ZipException: error in opening zip file
[hibernatetool]     at java.util.zip.ZipFile.open(Native Method)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:114)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:131)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.getResourceURL(AntClassLoader.java:1014)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.findNextResource(AntClassLoader.java:146)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.<init>(AntClassLoader.java:108)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.findResources(AntClassLoader.java:958)
[hibernatetool]     at java.lang.ClassLoader.getResources(ClassLoader.java:1016)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12$5.run(VersionHelper12.java:149)
[hibernatetool]     at java.security.AccessController.doPrivileged(Native Method)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12.getResources(VersionHelper12.java:146)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getApplicationResources(ResourceManager.java:468)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getInitialEnvironment(ResourceManager.java:159)
[hibernatetool]     at javax.naming.InitialContext.init(InitialContext.java:219)
[hibernatetool]     at javax.naming.InitialContext.<init>(InitialContext.java:175)
[hibernatetool]     at org.hibernate.util.NamingHelper.getInitialContext(NamingHelper.java:28)
[hibernatetool]     at org.hibernate.connection.DatasourceConnectionProvider.configure(DatasourceConnectionProvider.java:52)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:124)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:56)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.ManagedProviderConnectionHelper.prepare(ManagedProviderConnectionHelper.java:27)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.execute(SchemaExport.java:180)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.create(SchemaExport.java:133)
[hibernatetool]     at org.hibernate.tool.ant.Hbm2DDLExporterTask.execute(Hbm2DDLExporterTask.java:55)
[hibernatetool]     at org.hibernate.tool.ant.HibernateToolTask.execute(HibernateToolTask.java:171)
[hibernatetool]     at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
[hibernatetool]     at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
[hibernatetool]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[hibernatetool]     at java.lang.reflect.Method.invoke(Method.java:597)
[hibernatetool]     at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
[hibernatetool]     at org.apache.tools.ant.Task.perform(Task.java:348)
[hibernatetool]     at org.apache.tools.ant.Target.execute(Target.java:357)
[hibernatetool]     at org.apache.tools.ant.Target.performTasks(Target.java:385)
[hibernatetool]     at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
[hibernatetool]     at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
[hibernatetool]     at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.EclipseDefaultExecutor.executeTargets(EclipseDefaultExecutor.java:32)
[hibernatetool]     at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.run(InternalAntRunner.java:423)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.main(InternalAntRunner.java:137)
[hibernatetool] java.util.zip.ZipException: error in opening zip file
[hibernatetool]     at java.util.zip.ZipFile.open(Native Method)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:114)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:131)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.getResourceURL(AntClassLoader.java:1014)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.findNextResource(AntClassLoader.java:146)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.<init>(AntClassLoader.java:108)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.findResources(AntClassLoader.java:958)
[hibernatetool]     at java.lang.ClassLoader.getResources(ClassLoader.java:1016)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12$5.run(VersionHelper12.java:149)
[hibernatetool]     at java.security.AccessController.doPrivileged(Native Method)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12.getResources(VersionHelper12.java:146)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getApplicationResources(ResourceManager.java:468)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getInitialEnvironment(ResourceManager.java:159)
[hibernatetool]     at javax.naming.InitialContext.init(InitialContext.java:219)
[hibernatetool]     at javax.naming.InitialContext.<init>(InitialContext.java:175)
[hibernatetool]     at org.hibernate.util.NamingHelper.getInitialContext(NamingHelper.java:28)
[hibernatetool]     at org.hibernate.connection.DatasourceConnectionProvider.configure(DatasourceConnectionProvider.java:52)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:124)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:56)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.ManagedProviderConnectionHelper.prepare(ManagedProviderConnectionHelper.java:27)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.execute(SchemaExport.java:180)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.create(SchemaExport.java:133)
[hibernatetool]     at org.hibernate.tool.ant.Hbm2DDLExporterTask.execute(Hbm2DDLExporterTask.java:55)
[hibernatetool]     at org.hibernate.tool.ant.HibernateToolTask.execute(HibernateToolTask.java:171)
[hibernatetool]     at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
[hibernatetool]     at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
[hibernatetool]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[hibernatetool]     at java.lang.reflect.Method.invoke(Method.java:597)
[hibernatetool]     at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
[hibernatetool]     at org.apache.tools.ant.Task.perform(Task.java:348)
[hibernatetool]     at org.apache.tools.ant.Target.execute(Target.java:357)
[hibernatetool]     at org.apache.tools.ant.Target.performTasks(Target.java:385)
[hibernatetool]     at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
[hibernatetool]     at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
[hibernatetool]     at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.EclipseDefaultExecutor.executeTargets(EclipseDefaultExecutor.java:32)
[hibernatetool]     at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.run(InternalAntRunner.java:423)
[hibernatetool]     at org.eclipse.ant.internal.ui.antsupport.InternalAntRunner.main(InternalAntRunner.java:137)
[hibernatetool] java.util.zip.ZipException: error in opening zip file
[hibernatetool]     at java.util.zip.ZipFile.open(Native Method)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:114)
[hibernatetool]     at java.util.zip.ZipFile.<init>(ZipFile.java:131)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.getResourceURL(AntClassLoader.java:1014)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.findNextResource(AntClassLoader.java:146)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader$ResourceEnumeration.<init>(AntClassLoader.java:108)
[hibernatetool]     at org.apache.tools.ant.AntClassLoader.findResources(AntClassLoader.java:958)
[hibernatetool]     at java.lang.ClassLoader.getResources(ClassLoader.java:1016)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12$5.run(VersionHelper12.java:149)
[hibernatetool]     at java.security.AccessController.doPrivileged(Native Method)
[hibernatetool]     at com.sun.naming.internal.VersionHelper12.getResources(VersionHelper12.java:146)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getApplicationResources(ResourceManager.java:468)
[hibernatetool]     at com.sun.naming.internal.ResourceManager.getInitialEnvironment(ResourceManager.java:159)
[hibernatetool]     at javax.naming.InitialContext.init(InitialContext.java:219)
[hibernatetool]     at javax.naming.InitialContext.<init>(InitialContext.java:175)
[hibernatetool]     at org.hibernate.util.NamingHelper.getInitialContext(NamingHelper.java:28)
[hibernatetool]     at org.hibernate.connection.DatasourceConnectionProvider.configure(DatasourceConnectionProvider.java:52)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:124)
[hibernatetool]     at org.hibernate.connection.ConnectionProviderFactory.newConnectionProvider(ConnectionProviderFactory.java:56)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.ManagedProviderConnectionHelper.prepare(ManagedProviderConnectionHelper.java:27)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.execute(SchemaExport.java:180)
[hibernatetool]     at org.hibernate.tool.hbm2ddl.SchemaExport.create(SchemaExport.java:133)
[hibernatetool]     at org.hibernate.tool.ant.Hbm2DDLExporterTask.execute(Hbm2DDLExporterTask.java:55)
[hibernatetool]     at org.hibernate.tool.ant.HibernateToolTask.execute(HibernateToolTask.java:171)
[hibernatetool]     at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
[hibernatetool]     at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
[hibernatetool]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[hibernatetool]     at java.lang.reflect.Method.invoke(Method.java:597)
[hibernatetool]     at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
[hibernatetool]     at org.apache.tools.ant.Task.perform(Task.java:348)
[hibernatetool]     at org.apache.tools.ant.Target.execute(Target.java:357)
[hibernatetool]     at org.apache.tools.ant.Target.performTasks(Target.java:385)
[hibernatetool]     at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
[hibernatetool]     at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
[hibernatetool]     at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultE 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-10-18T00:53:03.090

这是不可能的。Ant 无法引用您放在 tomcat 中的配置，因为它在容器之外运行。

要从 ant 生成模式，请使用另一个指定连接参数的 hibernate.cfg.xml 文件而不是 JNDI。

# c# - 如何编写用户可扩展的代码？

> ID：654839
> 
> 赞同：1
> 
> 时间：2009-03-17T15:48:45.790
> 
> 标签：c#, reflection, eval

作为 perl 程序员，我可以将字符串评估为代码 如果我愿意，我可以在 C# 中做同样的事情吗（使用字符串或其他包含用户输入的对象）？

我想要完成的是创建一个对象，其中它的方法可以在我的源代码中预定义，或者可以由用户在运行时通过输入表示方法或 SQL 查询的 C# 代码的字符串来定义。方法调用应始终将其标量值作为字符串返回，我相信最好提供一些预定义的“系统”变量以在方法调用中使用，并提供一些“清理”代码来验证是否实际返回了字符串.

伪 - 结构

```
 Object Statistic
      string  Name;
      functionref Method; 
```

我想到的架构基本上会实时收集这些，并根据用户的请求将它们添加到用户想要显示的统计信息列表中。定义的统计数据可以保存到文件中，并在初始化期间加载到主程序中。这样，用户就不必不断重新定义所需的统计数据。需要编辑/更新/删除统计信息。

如果这成功了，那么我（程序员）就不必在每次有人决定他们有一条他们想要在他们的统计板上显示的新信息时都去添加新代码，而我还没有为其编写代码。

关于从哪里开始阅读以在 C# 中完成此任务的任何想法？

此功能的目的是显示正在运行的系统/数据库的统计信息的程序。在设计时不一定知道要观察的值，也不一定知道如何定义检索所需的值。我想允许用户定义任何我为系统预编码之外的任何统计信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T15:54:25.167

看看[这个早先的问题](https://stackoverflow.com/questions/260/adding-scripting-functionality-to-net-apps)。

但是，还要考虑解决方案的稳定性、可扩展性和安全性。如果您允许任意执行，您的应用程序的操作和支持将不会很有趣。为外部提供的代码设置一个界限分明的沙箱。

此外，不要期望普通用户（无论他们是谁）能够成为编码人员。

[您可能希望通过依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)来提供受限但更易于管理的可扩展性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T15:58:35.143

我会附和 Pontus 所说的，特别是关于稳定性、支持成本和期望用户编写代码的内容。我还将性能添加到列表中，因为这些用户可能不知道他们的代码对性能的影响。由于这些原因和其他原因，面向用户的`eval`构造在 C# 中不被认为是明智的，**并且可能也不应该在 perl 中**。

相反，请查看`System.AddIn`.Net 中的命名空间，以便为您的应用程序提供插件功能。

# c# - 在 WPF/XAML 中，每个容器控件都应该包含一个布局控件吗？

> ID：654841
> 
> 赞同：3
> 
> 时间：2009-03-17T15:49:23.307
> 
> 标签：c#, .net, wpf, xaml

在 XAML 中设计 WPF 应用程序 UI 时，每个容器类型的控件是否应该包含一个布局控件来容纳所有子控件？

以一个分组框为例。我可以直接将控件放到组框上，也可以使用布局控件并将布局控件放在组框内，然后将控件放入其中。

我可以看到后者的好处，因为布局控件代表了一组明确定义的规则，用于孩子的行为方式。然而，在这样做时，我的 XAML 树开始变得嵌套更深，并且更难导航。

鉴于此，最好的做法是始终使用布局控件，还是在没有这样的情况下将控件放入组框和选项卡项中是完全可以接受的？如果有的话，这会产生什么负面影响？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T16:44:41.990

使用布局面板没有负面影响，因为即使您没有指定一个，VisualTree 中也有一个默认值。如果您不明确使用其中之一，您的 XAML 可能看起来更干净。

大多数 ItemsControls 都有一个 StackPanel 作为默认布局。所以这基本上是一个问题，你是否想要一个**StackPanel**行为来安排你的子项目？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T20:26:06.833

Jobi 是正确的，这两种方式都没有任何影响，但我的直觉一直是使用 Container 来保存多个控件。这在很大程度上是由我对高度结构化的组织的需求所驱动的，但大多数情况下这对我来说是有意义的。

我最终得到了很多嵌套的 Grids、StackPanels 等。是的，树可以变得很深，但我几乎只将 Blend 用于布局和设计，所以导航树并不是那么糟糕，特别是如果你记得给一切都很好的描述性名称。

我不知道这是否是“最佳实践”，但它确实对我最有效。

# iphone - 如何在我的应用重新启动时动态恢复 UIScrollView 的缩放级别和位置？

> ID：654845
> 
> 赞同：4
> 
> 时间：2009-03-17T15:50:40.870
> 
> 标签：iphone, uiscrollview, uiimageview

我的应用程序由一个`UIImageView`内部组成`UIScrollView`，我在其中显示一个大图像。滚动视图允许用户通过捏合来放大/缩小图像，这一切似乎都很好。

但是，当我的应用程序终止然后重新启动时，`UIScrollView`会再次以原始缩放级别显示图像（当前设置为显示整个图像，通过在“宽高比匹配”模式下缩放它）。

我真的很希望能够重新启动我的应用程序并使用`UIScrollView`与应用程序终止时设置的参数相同的参数重新打开。因此，如果我的图像当前放大到最大，并一直滚动到它的左下角，那应该是我再次打开应用程序时的视图。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T21:44:11.057

检查视图的 .transform 属性。如果放大，则应进行修改。保存并在下次启动时恢复。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T16:46:05.030

不久前有人问过这个问题，但我想你不会喜欢[这个答案](https://stackoverflow.com/questions/611865/how-do-i-reset-i-e-un-zoom-a-uiscrollview)。希望你能得到一个更好的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T22:22:18.383

我找到了一种以编程方式缩放 UIScrollView 的方法。这可以帮助您在启动时设置所需的缩放级别。

示例代码以及封装所需缩放魔术的 ZoomScrollView 类以及关于 UIScrollView 缩放如何（以及为什么）工作的详细讨论可在[github.com/andreyvit/ScrollingMadness/](http://github.com/andreyvit/ScrollingMadness/)上获得。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-02T19:57:35.690

我这样做：当您退出时保存缩放级别（myScrollview.zoomScale）和内容视图框架原点。

重新打开时，您可以设置缩放比例。您还必须将内容大小设置为新的缩放级别，否则边界不正确。

```
 [myScrollview setZoomScale:savedZoomScale];
    CGSize newsize = CGSizeMake(origsize.width * savedZoomScale, 
                                 origsize.height * savedZoomScale);
    myScrollview.contentSize = newsize; 
```

要设置偏移量：

```
[myScrollView setContentOffset:savedFrameOrigin animated:YES]; 
```

# database - Oracle Backup Database with sqlplus 可以吗？

> ID：654852
> 
> 赞同：1
> 
> 时间：2009-03-17T15:51:55.503
> 
> 标签：database, oracle, backup, sqlplus

我需要对数据库进行一些结构更改（更改表、添加新列、更改一些行等），但我需要确保如果出现问题，我可以回滚到初始状态：

*   所有需要的更改都在一个 SQL 脚本文件中。
*   我没有对数据库的管理访问权限。
*   我真的需要确保在服务器端完成备份，因为 BD 有超过 30 GB 的数据。
*   我需要使用 sqlplus（在通过 vpn 的 ssh 专用会话下）
*   它不可能使用“闪回数据库”！它已关闭，我无法停止数据库。

我真的很深$#$%吗？

任何想法如何使用 sqlplus 备份数据库并将备份留在数据库服务器上？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T16:31:40.850

比 exp/imp 更好，你应该使用 rman。它是专门为此目的而构建的，它可以进行热备份/恢复，如果你完全搞砸了，你仍然可以。

一个“问题”是您也必须备份 $ORACLE_HOME 目录（根据我的经验），因为您需要本地存储的信息来恢复控制文件。

在 google 上搜索 rman 在第一页上提供了一些非常好的信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T16:20:31.393

另一种方法可能是创建一个包含修改后的结构和数据的新模式，并对其进行实际测试。这假设您的数据库服务器上有足够的空间来保存所有测试数据。在将更改转储到生产环境之前，您确实应该非常清楚您的更改将起作用。

我不会使用 sqlplus 来执行此操作。看看出口/进口。导出实用程序将获取数据库的定义和数据（可以在读取一致模式下完成）。导入实用程序将读取此文件并从中创建数据库结构。但是，访问这些实用程序确实需要授予权限，特别是如果您需要备份整个数据库，而不仅仅是一个模式。

也就是说，您需要在没有管理权限的情况下执行 DBA 的任务（更改表、备份数据库等），这有点令人不安。我想我至少会在开始之前寻求 DBA 的帮助来监督您的方法，如果不是坚持 DBA（或具有适当特权和知识的人）实际执行对数据库的修改并在必要时帮助恢复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T16:22:45.053

尝试通过 sqlplus 备份 30GB 的数据是很疯狂的，这需要几个小时才能完成，并且需要 3 到 5 倍的磁盘空间，并且如果不进行更多测试可能无法恢复。

您需要使用 exp 和 imp。这些是旨在备份和恢复数据库的命令行工具。它们是命令行工具，如果您可以通过 ssh 访问 sqlplus，则可以访问 imp/exp。您不需要管理员权限即可使用它们。他们将为您有权访问的用户转储数据库（以及所有表、触发器、视图、过程）。

# c++ - 为什么要在 C++ 中使用指向成员方法的函数指针？

> ID：654853
> 
> 赞同：4
> 
> 时间：2009-03-17T15:52:49.913
> 
> 标签：c++, function-pointers

很多 C++ 书籍和教程都解释了如何做到这一点，但我还没有看到有一个令人信服的理由来选择这样做。

我非常理解为什么函数指针在 C 中是必需的（例如，当使用一些 POSIX 工具时）。但是，AFAIK 由于“this”参数，您无法向他们发送成员函数。但是，如果您已经在使用类和对象，为什么不直接使用函子之类的面向对象的解决方案呢？

您必须使用此类函数指针的真实世界示例将不胜感激。

更新：感谢大家的回答。不过，我不得不说，这些例子都没有真正让我相信，从纯 OO 的角度来看，这是一种有效的机制......

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T16:00:02.470

函子不是先验的面向对象的（在 C++ 中，术语“函子”通常是指定义`operator ()`带有任意参数和返回值的结构体，可以用作实际函数或函数指针的语法插入替换）。然而，他们的面向对象问题有很多问题，首先是可用性。这只是一大堆复杂的样板代码。为了像大多数对话框架一样拥有一个像样的信令框架，大量的继承混乱变得必要。

实例绑定函数指针在这里将非常有用（.NET 用委托充分证明了这一点）。

然而，C++ 成员函数指针仍然满足另一个需要。例如，想象一下，您想要执行一个方法的列表中有很多值，比如说它的`print()`. 指向此处的函数指针会有所`YourType::size`帮助，因为它可以让您编写这样的代码：

```
std::for_each(lst.begin(), lst.end(), std::mem_fun(&YourType::print)) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T16:03:38.250

过去，成员函数指针曾经在这样的场景中很有用：

```
class Image {
    // avoid duplicating the loop code
    void each(void(Image::* callback)(Point)) {
        for(int x = 0; x < w; x++)
            for(int y = 0; y < h; y++)
                callback(Point(x, y));
    }

    void applyGreyscale() { each(&Image::greyscalePixel); }
    void greyscalePixel(Point p) {
        Color c = pixels[p];
        pixels[p] = Color::fromHsv(0, 0, (c.r() + c.g() + c.b()) / 3);
    }

    void applyInvert() { each(&Image::invertPixel); }
    void invertPixel(Point p) {
        Color c = pixels[p];
        pixels[p] = Color::fromRgb(255 - c.r(), 255 - r.g(), 255 - r.b());
    }
}; 
```

我已经看到在商业绘画应用程序中使用了它。（有趣的是，这是用预处理器更好地解决的少数 C++ 问题之一）。

然而，今天，成员函数指针的唯一用途是在`boost::bind`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T16:01:45.540

这是我们这里的一个典型场景。我们有一个通知框架，一个类可以注册到多个不同的通知。注册通知时，我们传递成员函数指针。这实际上与 C# 事件非常相似。

```
class MyClass
{
    MyClass()
    {
        NotificationMgr::Register( FunctionPtr( this, OnNotification ) );
    }
    ~MyClass()
    {
        NotificationMgr::UnRegister( FunctionPtr( this, OnNotification ) );
    }

    void OnNotification( ... )
    {
        // handle notification
    }
}; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T16:42:45.490

我现在正在处理一些代码，我用它们来实现状态机。取消引用的成员函数实现了状态，但由于它们都在类中，它们可以共享一定数量的数据，这些数据对整个状态机都是全局的。使用普通（非成员）函数指针很难做到这一点。

不过，我仍然不确定这是否是实现状态机的好方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T16:00:01.707

这就像使用 lambdas。您总是可以将所有必要的局部变量传递给一个简单的函数，但有时您必须传递多个变量。

因此，使用成员函数将使您免于将所有必要的成员字段传递给函子。就这样。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T16:02:51.357

您专门询问了成员函数，但函数指针也有其他用途。我需要在 C++ 中使用函数指针的最常见原因是当我想使用 LoadLibrary() 加载 DLL ar 运行时。显然，这是在 Windows 中。在使用可选 DLL 形式的插件的应用程序中，动态链接不能在应用程序启动时使用，因为 DLL 通常不存在，并且使用延迟加载很痛苦。

加载库后，您必须获得指向要使用的函数的指针。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T17:02:15.927

我使用成员函数指针解析文件。根据在文件中找到的特定字符串，在映射中找到相同的值并调用相关函数。这不是一个比较字符串的大型 if..else if..else 语句。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T21:14:08.217

成员指针最重要的一个用途是创建仿函数。好消息是你几乎不需要直接使用它，因为它已经在库中作为 boost::bind 解决了，但是你必须将指针传递给这些库。

```
class Processor
{
public:
   void operation( int value );
   void another_operation( int value );
};
int main()
{
   Processor tc;
   boost::thread thr1( boost::bind( &Processor::operation, &tc, 100 ) );
   boost::thread thr2( boost::bind( &Processor::another_operation, &tc, 5 ) );
   thr1.join();
   thr2.join();
} 
```

您可以看到创建对给定类实例执行给定操作的线程的简单性。

解决上述问题的简单手工方法是自己创建一个仿函数：

```
class functor1
{
public:
    functor1( Processor& o, int v ) : o_(o), v_(v) {}
    void operator()() {
        o_.operation( v_ ); // [1]
    }
private:
    Processor& o_;
    int v_;
}; 
```

并为您要调用的每个成员函数创建一个不同的成员函数。*请注意，对于operation*和*another_operation*的仿函数是完全相同的，但是在 [1] 中的调用必须在两个仿函数中复制。使用成员函数指针，您可以编写一个简单的仿函数：

```
class functor
{
public:
   functor( void (*Processor::member)(int), Processor& p, int value )
      : member_( member ), processor_(p), value_( value ) {}

   void operator()() {
      p.*member(value_);
   }
private:
   void (*Processor::member_)(int);
   Processor& processor_;
   int value;
}; 
```

并使用它：

```
int main() {
   Processor p;
   boost::thread thr1( functor( &Processor::operation, p, 100 ) );
   boost::thread thr2( functor( &Processor::another_operation, p, 5 ) );
   thr1.join();
   thr2.join();
} 
```

再说一次，您甚至不需要将仿函数定义为 boost::bind 为您完成。即将推出的标准将按照 boost 的实现有自己的 bind 版本。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-05-20T20:30:32.470

指向成员函数的指针与对象无关。如果您想在运行时按值（或作为模板参数）引用函数，则需要它。当您没有想到要调用它的单个对象时，它就会自成一体。

因此，如果您知道函数，但不知道对象并且您希望通过值传递此知识，那么点到成员函数是*唯一*规定的解决方案。Iraimbilanja 的例子很好地说明了这一点。它可以帮助您查看[我使用成员变量的示例](https://stackoverflow.com/questions/670734/c-pointer-to-class-data-member/5834455#5834455)。原理是一样的。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-03-17T16:24:45.453

我在一个场景中使用了一个指向成员函数的函数指针，其中我必须向某个第 3 方 API 对象提供一个指向带有预定义参数列表（因此我不能传递任意参数）的回调的函数指针。

我无法在全局命名空间中实现回调，因为它应该根据使用触发回调的第 3 方 API 的对象状态来处理传入事件。

所以我希望回调的实现成为使用 3rd-party 对象的类的一部分。我所做的是，我在要实现回调的类中声明了一个公共和静态成员函数，并将指向它的指针传递给 API 对象（`static`关键字让我避免了`this`指针问题）。

然后，我的对象的`this`指针将作为回调的 Refcon 的一部分传递（幸运的是，它包含了一个通用目的`void*`）。然后，dummy 的实现使用传递的指针来调用包含在 class = ) 中的回调的实际和私有实现。

它看起来像这样：

```
public:
    void SomeClass::DummyCallback( void* pRefCon ) [ static ]
    {
        reinterpret_cast<SomeClassT*>(pRefCon)->Callback();
    }
private:
    void class SomeClass::Callback() [ static ]
    {
        // some code ...
    } 
```

# plsql - 在 sqlplus 会话中的 pl/sql 代码块中切换用户

> ID：654856
> 
> 赞同：2
> 
> 时间：2009-03-17T15:53:42.940
> 
> 标签：plsql

我有一个 pl/sql 脚本，我从 sqlplus 会话中作为 'sysdba' 运行。

在脚本执行期间，我想切换到另一个用户，以便我可以为该用户创建一些数据库链接。完成此操作后，脚本应返回到“sysdba”以进行一些整理。

我尝试使用以下内容：

```
BEGIN

<do some stuff as sysdba>

execute immediate 'connect ' || in_owner || '/' || v_password;

<create db link for user>

<switch back to sysdba>
END; 
```

但是，似乎“连接”是一个不能与“立即执行”一起运行的命令。

知道如何做到这一点吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:01:50.980

我不知道您将如何在 Orcle 中执行此操作，但简单的解决方案是将其放入您的 SQL 脚本而不是 PL/SQL 块中。

```
BEGIN

<do some stuff as sysdba>

END;

connect scott/tiger;

<create db link for user>

<switch back to sysdba>

BEGIN

<do other stuff>

END; 
```

编辑：根据您在下面的评论，我为您提供了另一个解决方案。仍然使用带有一些 PLSQL 的 SQL 脚本而不是纯 PLSQL 脚本。这一次，动态生成一个 SQL 脚本来创建链接，然后运行它。复杂性可能在于如何找出每个用户的密码。

```
BEGIN
<do some stuff as sysdba>
END;

set serverout on;
spool create_links.sql
BEGIN
    for <loop over each user> loop
        dbms_output.put_line('connect ' || user || '/' || pass ';');
        dbms_output.put_line('<create db link for user>;');
    end loop;
END;
spool off;

@@create_links.sql;

<switch back to sysdba>

BEGIN

<do other stuff>

END; 
```

最后，如果这不起作用，您可以编写一个使用“AUTHID CURRENT_USER”动态创建触发器的过程。这使得过程作为调用者而不是所有者运行。请参阅[此处](http://download.oracle.com/docs/cd/B10501_01/appdev.920/a96624/13_elems37.htm#35565)了解如何在定义过程时使用 AUTHID 关键字。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-25T06:47:39.497

您可以在创建 dblink 之前更改为不同的架构吗？

```
ALTER SESSION SET CURRENT_SCHEMA = in_owner;
<create db link for user>
ALTER SESSION SET CURRENT_SCHEMA = 'sysdba'; 
```

# c# - 从 XmlWriter.WriteStartElement 中排除命名空间的问题

> ID：654858
> 
> 赞同：2
> 
> 时间：2009-03-17T15:54:00.973
> 
> 标签：c#, .net, xml, syndication

我有一个小问题，也许你可以帮助我。

我尝试使用[XmlWriter](http://msdn.microsoft.com/en-us/library/system.xml.xmlwriter.aspx)编写一个看起来像这样的 XML 标记（[w3c 提要推荐](http://validator.w3.org/feed/docs/warning/MissingAtomSelfLink.html)）：

```
<atom:link href="http://localhost" rel="self" type="application/rss+xml" /> 
```

问题是我不能像我想要的那样使用[WriteStartElement方法（原子作为前缀，链接作为元素名称），因为这给了我一个“](http://msdn.microsoft.com/en-us/library/system.xml.xmlwriter.writestartelement.aspx) *ArgumentException: Cannot use a prefix with an empty namespace* ”。

**我的代码如下所示：**

```
public void WriteTo(XmlWriter writer, Feed feed)
{
    // RSS element
    writer.WriteStartElement("rss", "");
    writer.WriteAttributeString("version", "2.0");
    writer.WriteAttributeString("xmlns", "atom", string.Empty, "http://www.w3.org/2005/Atom");

    // Channel element
    writer.WriteStartElement("channel");

    // The link to the feed.
    writer.WriteStartElement("link", "atom");
    writer.WriteAttributeString("href", feed.FeedUrl.ToString());
    writer.WriteAttributeString("rel", "self");
    writer.WriteAttributeString("type", "application/rss+xml");
    writer.WriteEndElement();

    // Feed information
    writer.WriteElementString("title", feed.Title);
    writer.WriteElementString("description", feed.Description);
    writer.WriteElementString("link", feed.Link.ToString());

    // Iterate through all items.
    foreach (FeedItem item in feed.Items)
    {
        writer.WriteStartElement("item");
        writer.WriteElementString("title", item.Title);
        writer.WriteElementString("link", item.Link.ToString());
        writer.WriteElementString("description", item.Description);
        writer.WriteElementString("guid", item.Guid);
        writer.WriteEndElement();
    }

    // Channel element end
    writer.WriteEndElement();

    // RSS element end
    writer.WriteEndElement();
} 
```

我认为我的问题是微不足道的，很容易解决，但是如何解决呢？

**更新：**

问题已经解决了。检查 Jon Skeets 的答案以获得解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T15:56:48.017

为什么不直接使用适当的命名空间 ( `http://www.w3.org/2005/Atom`)？

您可以更早地编写名称空间声明，在这种情况下，您只需要`WriteStartElement`采用元素名称和名称空间的重载 - 我*认为*前缀会自动使用。

# apache-flex - 在 Flex 中创建类型安全的集合

> ID：654862
> 
> 赞同：4
> 
> 时间：2009-03-17T15:54:52.563
> 
> 标签：apache-flex, collections

我正在尝试在 Flex 中创建一个集合类，该类仅限于容纳我正在使用的特定类型的数据（接口）。我选择不扩展 ArrayCollection 类，因为它太通用了，并没有真正为我提供我所追求的编译时安全性。在它的简单形式中，我的集合包含一个数组，我管理如何添加和删除对象等。

我真正想做的是在每个循环中使用这些集合。它绝对不像说 c# 那样直接，您只需实现 IEnumerable 和 IEnumerator （或仅使用通用集合）。有没有办法在动作脚本中做到这一点，如果有的话，有什么关于它是如何实现的信息？

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T16:13:41.207

看看[`Vector<>`](http://livedocs.adobe.com/flex/gumbo/langref/Vector.html)。对于 Flex 中的类型化集合（从 4 开始），这几乎是最好的了。但是，否则您将需要实现自己的类。一种方法似乎是使用[Iterator Pattern](http://en.wikipedia.org/wiki/Iterator_pattern)。

另外，看看[这个](https://stackoverflow.com/questions/599825/immutable-collections-actionscript-3)SO 帖子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T16:35:17.067

您需要扩展 Flash 代理类。扩展代理允许您更改“get”和“set”的工作方式，以及“for..in”和“for..each”循环。您可以[在 Livedocs 上找到更多详细信息。](http://livedocs.adobe.com/flex/3/langref/flash/utils/Proxy.html)

这是您的问题的示例：

```
package
{
    import flash.utils.Proxy;
    import flash.utils.flash_proxy;

    public class EnumerableColl extends Proxy
    {
        private var _coll:Array;

        public function EnumerableColl()
        {
            super();
            _coll = [ 'test1', 'test2', 'test3' ];
        }

        override flash_proxy function nextNameIndex( index:int ):int
        {
            if ( index >= _coll.length ) return 0;
            return index + 1;
        } 

        override flash_proxy function nextValue( index:int ):*
        {
            return _coll[ index - 1];
        }

    }
} 
```

# tfs-migration - TFS 到 TFS 迁移工具 - 域问题

> ID：654863
> 
> 赞同：3
> 
> 时间：2009-03-17T15:55:08.567
> 
> 标签：tfs-migration, tfs-to-tfs-migration-tool

第 3 方为我们开发了一些应用程序，并一直在使用 MS Team Foundation Server 2008 进行源代码控制。我的公司最近设置了我们的 TFS 2008 环境，我们正在尝试将源代码从 3rd 方开发人员 TFS 迁移到我们的 TFS 机器。您首先想到的是尝试迁移的备份和恢复方法，但我们唯一可用的 SQL Server 是标准版许可证，而他们用于 TFS 的第 3 方开发人员的 SQL Server 是企业版。这意味着备份和还原方法将不起作用。所以我一直在尝试让 TFS 到 TFS 迁移工具（在 codeplex 上找到）迁移源代码。可悲的是我一直有问题...

第三方开发者网络在我们公司网络内的自己的子网络中。他们有自己的领域，与我们分开。所以他们的 TFS 机器在他们的域中，我们的 TFS 机器在另一个域中，并且我的 PC（具有 VS、Team Explorer、TFS Power 工具...）连接到两个网络并尝试运行 TFS 到 TFS 迁移工具。唉，当我运行迁移工具时，只有一小部分代码被迁移，并且迁移工具的日志中加载了消息......

> TfsMigrationWindowsServiceHost.exe 信息：0：TF14045：身份 <3rd party domain>\<3rd party username> 不是可识别的身份。LogicalOperationStack=Migrate ThreadId=8 DateTime=2009-03-17T15:14:08.6591468Z TfsMigrationWindowsServiceHost.exe 信息：0：无法使用身份 <3rd party domain>\<3rd party username> 签入到 TFS。转换为默认凭据。LogicalOperationStack=Migrate ThreadId=8 DateTime=2009-03-17T15:14:08.6591468Z TfsMigrationWindowsServiceHost.exe 信息：0：VCSession_2009_03_17_09_59_03_627：TF10141：没有文件签入：解决冲突并重试。LogicalOperationStack=迁移 ThreadId=8 DateTime=2009-03-17T15:14:08.9247718Z TfsMigrationWindowsServiceHost.exe 警告：0：TF10141：没有签入文件：解决冲突并重试。LogicalOperationStack=Migrate ThreadId=8 DateTime=2009-03-17T15:14:08.9247718Z TfsMigrationWindowsServiceHost.exe 信息：0：Microsoft.TeamFoundation.VersionControl.Client.CheckinException：TF10141：没有文件签入：解决冲突并重试。在 Microsoft.TeamFoundation.VersionControl.Client.Workspace.ReportCheckInConflictsAndThrow(Failure[] failures) 在 Microsoft.TeamFoundation.VersionControl.Client.Workspace.CheckInternal(String author, PendingChange[] changes, String comment, CheckinNote checkinNote, WorkItemCheckinInfo[] workItemChanges, PolicyOverrideInfo policyOverride，CheckinOptions checkinOptions) 在 Microsoft.TeamFoundation.VersionControl.Client.Workspace.CheckIn(PendingChange[] 更改，字符串作者，字符串注释，

上面的消息可以在日志中找到 100 次。我猜这个“身份”问题是绝大多数文件没有迁移过来的原因。但话又说回来，我会认为所有文件都会有这个问题......包括迁移过来的少数文件。

我发现关于“TF14045”和“TF10141”的具体信息很少。我的印象是，问题是由于第 3 方 TFS 环境中的文件签入与特定于该域的用户相关联，并且在我们的域中找不到。所以...

熟悉 TFS 到 TFS 迁移工具的人是否知道问题可能是什么？

谁能想到解决这种情况的方法，以便当其他域的用户链接到正在迁移到新环境的文件时，新的 TFS 机器不会崩溃？我确实尝试将问题 '<3rd party domain>\<3rd party username>' 添加到新的 TFS 环境，但 TFS 找不到该用户并且不会添加它们。

更好的是...如果有人知道我很想知道如何使用不同的 SQL Server 版本进行备份和恢复迁移方法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-13T20:07:56.887

我不知道这是否有帮助，但您可以尝试设置域间信任，这样您就可以使用来自两个域的用户登录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-28T21:42:53.740

我通过在工作区中手动解决问题，然后提供签入号作为“源版本”来解决冲突，从而解决了我的问题...

[TFS 集成工具 – 问题：TF10141 由于 TFS 签入失败，没有签入文件](http://blog.hinshelwood.com/tfs-integration-tools-issue-tf10141-no-files-checked-in-as-a-result-of-a-tfs-check-in-failure/)

# sql - 架构是否应该始终在 SQL 语句中显式定义？

> ID：654865
> 
> 赞同：1
> 
> 时间：2009-03-17T15:55:59.267
> 
> 标签：sql, postgresql, schema

之前我问过这个问题：

[使用 PostgreSQL 时，我应该在哪里（或如何）在 select 语句中定义模式？](https://stackoverflow.com/questions/651527/where-or-how-should-i-define-the-schema-in-a-select-statement-when-using-postgr)

我接受的答案是修改连接用户的 search_path，以便不需要在 SQL 中指定模式。但是，现在我想知道是否应该始终在 SQL 中指定模式，而不是让搜索路径自动推断模式。这似乎是一种更安全的方法，并且更易于移植到其他数据库。

这个问题与上一个问题不同，我想知道在 SQL 中定义模式的最佳实践是什么，而不是如何完成。

架构是否应该始终在 SQL 语句中显式定义？

** 注意：我不会对架构名称进行硬编码，而是允许通过 Web.config 文件对其进行配置，以便架构可以从一种安装更改为另一种安装。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T16:01:13.060

将模式硬编码到`SQL`语句中是一种不好的做法。

您应该将其保存在应用程序设置中，并`SET search_path`在连接到数据库后发出。

如果您的应用程序被多个用户使用他们自己的模式，那么如果您不将模式名称硬编码到`SQL`.

换句话说，

```
string query = "SELECT * FROM " + ConfigurationManager.AppSettings.Get("schema") + ".table"; 
```

是个坏方法；

```
SQLCommand("SET search_path = " + ConfigurationManager.AppSettings.Get("schema"), connection).ExecuteNonQuery();
string query = "SELECT * FROM table"; 
```

是个好办法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T23:43:01.183

让我们看看 - 在我维护的应用程序的数据库中，大约有十几个模式。如果我把它们放在“search_path”中，顺序是什么？我会在配置中输入模式名称（不是表名，也不是完全限定的表名）吗？

正如您现在已经猜到的那样，我不使用“search_path”。但也许您可以将完全限定的表名存储在配置中，以防您改变对模式名称或表本身的看法。

# grails - Grails/GORM：belongsTo在1:N关系中的含义

> ID：654871
> 
> 赞同：7
> 
> 时间：2009-03-17T15:57:36.020
> 
> 标签：grails, grails-orm

在普通的一对多映射中，“一”方是关联的所有者。为什么有人会使用 belongsTo-mapping 进行这样的映射？我错过了指定 belongsTo 的一些副作用吗？

换句话说：在 GORM 中指定 belongsTo-mapping 与不指定有什么影响？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-18T03:23:46.050

是否指定*belongsTo*取决于您想要的[引用操作的类型。](http://en.wikipedia.org/wiki/Foreign_key)

如果您希望 Grails 执行*On Delete、CASCADE*引用操作，请指定*belongsTo*。如果您希望 Grails*在删除时执行 RESTRICT*引用操作，则不要指定*belongsTo*。

例如

```
// "belongsTo" makes sense for me here. 
class Country {
  String name
  static hasMany = [states:State]
}

class State {
  String name;
  // I want all states to be deleted when a country is deleted. 
  static belongsTo = Country
}

// Another example, belongsTo doesn't make sense here
class Team {
  String name
  static hasMany = [players:Player]
}

class Player {
   String name
   // I want that a team should not be allowed to be deleted if it has any players, so no "belongsTo" here. 
} 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T17:48:14.600

指定belongsTo 允许Grails 透明地将更新、保存和删除级联到对象的子级。如果没有 belongsTo，如果您尝试删除主记录，如果它拥有任何详细信息，您最终会遇到外键违规。

# java - 我的 JBoss 服务器在 Linux 上达到 100% SYS CPU；什么会导致这个？

> ID：654872
> 
> 赞同：3
> 
> 时间：2009-03-17T15:58:02.337
> 
> 标签：java, performance, jboss

我们已经调试这个 JBoss 服务器问题已经有一段时间了。经过大约 10 个小时的工作，服务器进入 100% CPU 恐慌攻击并停止。在此期间，您无法运行任何新程序，因此您甚至`kill -quit`无法获得堆栈跟踪。这些高 100% SYS CPU 负载持续 10-20 秒，并且每隔几分钟重复一次。

我们已经工作了很长时间。我们怀疑它与 GC 有关，但无法用较小的程序确认。我们在 i386 32bit、RHEL5 和 Java 1.5.0_10 上运行，使用`-client`和`ParNew GC`.

到目前为止，这是我们尝试过的：

1.  我们限制了 CPU 亲和性，因此我们可以在高负载命中时实际使用服务器。`strace`我们看到一个无限循环，然后`SIGSEGV`sig 返回。

2.  我们试图用 Java 程序重现这一点。确实，SYS CPU%`WeakHashMap`在访问空指针时或在访问空指针时会攀升。问题是`fillStackTrace`占用了大量用户 CPU%，这就是为什么我们从未达到 100% SYS CPU。

3.  我们知道，经过 10 个小时的压力，GC 会变得疯狂，而 Full GC 有时需要 5 秒。所以我们假设它与记忆有关。

4.  `jstack`在此期间，所有线程都显示为阻塞。`pstack`在那段时间里，偶尔会显示 MarkSweep 堆栈跟踪，所以我们也不能确定这一点。发送`SIGQUIT`没有产生任何结果：在 SYS% 加载期结束后，Java 转储了堆栈跟踪。

我们现在正试图用一小段代码重现这个问题，以便我们可以询问 Sun。

如果您知道是什么原因造成的，请告诉我们。我们对想法持开放态度，我们一无所知，欢迎任何想法:)

谢谢你的时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T22:12:24.067

如果您确定 GC 是问题所在（根据您的描述*听起来确实如此），那么在您的 JBoss 设置中添加 -XX:+HeapDumpOnOutOfMemoryError 标志可能会有所帮助（在 JBOSS_HOME/bin/run.conf 中）。*

[您可以在此处](http://java.sun.com/javase/6/webnotes/trouble/TSG-VM/html/clopts.html)阅读有关此标志的更多信息。它最初是在 Java 6 中添加的，但后来被[向后移植](http://blogs.oracle.com/alanb/entry/heapdumponoutofmemoryerror_option_in_5_0u7)到 Java 1.5.0_07。

基本上，如果发生 OutOfMemoryError，您将获得一个“转储文件”，然后您可以在各种分析工具中打开该文件。我们在[Eclipse 内存分析器](http://www.eclipse.org/mat/)上很幸运。

这不会给你任何“免费”的答案，但如果你真的有内存泄漏，那么这将帮助你找到它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T10:18:18.920

感谢大家的帮助。

最终我们将（只有一半的 java 服务器）升级到了 JDK 1.6，问题就消失了。只是不要使用 1.5.0.10 :)

我们只通过访问空指针就设法重现了这些问题（提升 SYS 而不是 US，并杀死整个 linux。）

再次感谢大家。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T16:11:55.097

您是否尝试过分析应用程序。有一些很好的分析应用程序可以在生产服务器上运行。如果 GC 遇到问题以及使用哪些对象，这些应该会给你

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T16:37:27.967

去年我在 JBoss（JBoss 4，Linux 2.6）上遇到了类似的问题。我认为最终它确实与应用程序错误有关，但肯定很难弄清楚。我会继续尝试向进程发送“kill -3”，以获取某种堆栈跟踪并找出阻塞的原因。也许添加日志语句以查看您是否可以弄清楚是什么设置了它。您可以使用“lsof”来确定它打开了哪些文件；这将告诉您是否存在内存以外的某些资源泄漏。

另外，你为什么用 -client 而不是 -server 运行 JBoss？（并不是说我认为在这种情况下会有所帮助，只是一个一般性问题）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T22:39:24.720

您可以尝试添加命令行选项 -verbose:gc ，它应该将 GC 和堆大小打印到标准输出。管道标准输出到一个文件，看看高 cpu 时间是否与主要 gc 一致。

我记得在 Windows 上与 JBoss 有类似的问题。cpu 会定期达到 100%，Windows 报告的内存使用率会突然下降到 2.5 MB，比运行 JBoss 可能的要小得多，几秒钟后会自行恢复。好像整个服务器都停机并重新启动了自己。我最终将我的问题追溯到 Apache Commons 中永不过期的准备好的语句缓存。

如果确实是内存问题，那么您可以开始定期进行堆转储并比较两者，或者使用 JProbe Memory profiler 之类的东西来跟踪所有内容。

# javascript - 有没有办法在失去焦点时将光标重置到文本框的开头？

> ID：654879
> 
> 赞同：3
> 
> 时间：2009-03-17T15:59:56.700
> 
> 标签：javascript, html

我的表单上有一些 input[type="text"] 文本框，这些文本框的宽度有时不足以容纳输入其中的内容。

目前，如果用户键入更多适合的文本（但低于最大长度），则文本框会按您的预期滚动。当他们跳出文本框时，文本框会一直滚动到他们键入的内容的“末尾”。

我正在尝试找到一种方法，当用户从字段中跳出时将文本框重置为开头。

我在这里查看了建议：

[在 html 文本框中设置键盘插入符号位置](https://stackoverflow.com/questions/512528/set-cursor-position-in-html-textbox)

...但它在 onblur 事件中不起作用，因为该解决方案实际上导致文本框在再次模糊之前再次短暂获得焦点，从而导致无限循环。

在我放弃之前，有没有人有任何解决方案可以在 onblur 事件中将光标重置到文本框的开头？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T18:24:35.137

在 Internet Explorer 中，您可以设置 scrollLeft 属性。这在 Firefox 中不起作用，但是如果您将值重置为自身，它将滚动回到开头。显然这两种方法都适用于 Chrome。我目前没有任何其他浏览器可供测试。

```
$("input[type=text]").blur(function() {
    this.value = this.value; // Firefox
    this.scrollLeft = 0; // Internet Explorer
}); 
```

我使用 jQuery 是因为我已经习惯了，但您可以将其调整为用于事件的任何框架/方法。

# design-patterns - 基于特定标准获取子集的模式（设计中）

> ID：654882
> 
> 赞同：0
> 
> 时间：2009-03-17T16:00:46.370
> 
> 标签：design-patterns, oop, criteria, subset

我正在寻找这种一般情况的模式：

“我需要根据直接相关的标准和间接相关的数据来获取数据子集。”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T06:04:10.533

Martin Fowler 和 Eric Evans 的规范模式 ( [pdf](http://martinfowler.com/apsupp/spec.pdf) ) ( [wikipedia](http://en.wikipedia.org/wiki/Specification_pattern) ) 似乎符合您的要求。

# arrays - VBScript：函数返回一个数组

> ID：654888
> 
> 赞同：10
> 
> 时间：2009-03-17T16:02:04.493
> 
> 标签：arrays, vbscript

我有一些 VBScript 代码，其中函数返回一个数组。

```
function PreProcessFile (sFile)

    dim deData(3)

    ''populate deData with strings

    PreProcessFile = deData

End function 
```

调用此函数的代码因类型不匹配而出错。有什么想法吗？

```
'' VBScript source code
Dim m_deData(3)
set m_deData = PreProcessFile("someFile.txt") 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-17T16:03:51.307

不要在函数外显式调暗数组的大小，也不要使用 set：

```
'' VBScript source code
Dim m_deData
m_deData = PreProcessFile("someFile.txt") 
```

# php - Lucene-search 没有索引数值的问题？

> ID：654898
> 
> 赞同：4
> 
> 时间：2009-03-17T16:04:23.007
> 
> 标签：php, zend-framework, lucene

我在 PHP 中使用 Lucene（使用 Zend Framework 实现）。我有一个问题，我无法搜索包含数字的字段。

这是索引中的数据：

```
      ts | 内容
--------------+-----------------
  1236917100 | 狗 猫 沙鼠
  1236630752 | 牛猪山羊
  1235680249 | 狮子虎熊
  非数字 | 鲈鱼虾虎鱼

```

**我的问题**：对“”的查询`ts:1236630752`没有返回任何命中。但是，对 " `ts:nonnumeric`" 的查询会返回命中。

我将“ts”存储为关键字字段，[根据文档](http://framework.zend.com/apidoc/core/Zend_Search_Lucene/Document/Zend_Search_Lucene_Field.html#keyword)“未标记化，但已编入索引和存储。对非文本字段有用，例如日期或 url。” 我尝试将其视为“文本”字段，但行为是相同的，`ts:*`只是当 ts 是文本时，对“”的查询不返回任何内容。

我正在使用 Zend Framework 1.7（3 天前刚刚下载最新的）和 PHP 5.2.9。这是我的代码：

```
<?php

//=========================================================
// Initializes Zend Framework (Zend_Loader).
//=========================================================
set_include_path(realpath('../library') . PATH_SEPARATOR . get_include_path());
require_once('Zend/Loader.php');
Zend_Loader::registerAutoload();

//=========================================================
// Delete existing index and create a new one
//=========================================================
define('SEARCH_INDEX', 'test_search_index');
if(file_exists(SEARCH_INDEX))
  foreach(scandir(SEARCH_INDEX) as $file)
    if(!is_dir($file))
      unlink(SEARCH_INDEX . "/$file");

$index = Zend_Search_Lucene::create(SEARCH_INDEX);

//=========================================================
// Create this data in index:
//         ts      |    contents
//   --------------+-----------------
//     1236917100  | dog cat gerbil
//     1236630752  |  cow pig goat
//     1235680249  | lion tiger bear
//     nonnumeric  | bass goby trout
//=========================================================

function add_to_index($index, $ts, $contents) {
  $doc = new Zend_Search_Lucene_Document();
  $doc->addField(Zend_Search_Lucene_Field::Keyword('ts', $ts));
  $doc->addField(Zend_Search_Lucene_Field::Text('contents', $contents));
  $index->addDocument($doc);
}

add_to_index($index, '1236917100', 'dog cat gerbil');
add_to_index($index, '1236630752', 'cow pig goat');
add_to_index($index, '1235680249', 'lion tiger bear');
add_to_index($index, 'nonnumeric', 'bass goby trout');

//=========================================================
// Run some test queries and output results
//=========================================================

echo '<html><body><pre>';

function run_query($index, $query) {
  echo "Running query:  $query\n";
  $hits = $index->find($query);
  echo 'Got ' . count($hits) . " hits.\n";
  foreach($hits as $hit)
    echo "  ts='$hit->ts', contents='$hit->contents'\n";
  echo "\n";
}

run_query($index, 'pig');           //1 hit
run_query($index, 'ts:1236630752'); //0 hits
run_query($index, '1236630752');    //0 hits
run_query($index, 'ts:pig');        //0 hits
run_query($index, 'contents:pig');  //1 hits
run_query($index, 'ts:[1236630700 TO 1236630800]'); //0 hits (range query)
run_query($index, 'ts:*');          //4 hits if ts is keyword, 1 hit otherwise
run_query($index, 'nonnumeric');    //1 hits
run_query($index, 'ts:nonnumeric'); //1 hits
run_query($index, 'trout');         //1 hits 
```

**输出**

```
运行查询：猪
获得 1 次命中。
  ts='1236630752'，内容='牛猪山羊'

运行查询：ts:1236630752
获得 0 次点击。

运行查询：1236630752
获得 0 次点击。

运行查询：ts:pig
获得 0 次点击。

运行查询：内容：猪
获得 1 次命中。
  ts='1236630752'，内容='牛猪山羊'

运行查询：ts:[1236630700 TO 1236630800]
获得 0 次点击。

运行查询：ts:*
打了4次。
  ts='1236917100', 内容='狗猫沙鼠'
  ts='1236630752'，内容='牛猪山羊'
  ts='1235680249', contents='狮虎熊'
  ts='非数字'，内容='鲈鱼虾虎鱼'

运行查询：非数字
获得 1 次命中。
  ts='非数字'，内容='鲈鱼虾虎鱼'

运行查询：ts:nonnumeric
获得 1 次命中。
  ts='非数字'，内容='鲈鱼虾虎鱼'

运行查询：鳟鱼
获得 1 次命中。
  ts='非数字'，内容='鲈鱼虾虎鱼'

```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T16:49:55.830

find() 方法对查询进行标记，使用默认的 Analzer，您的数字将几乎被忽略。如果要搜索数字，则必须[构造查询](http://framework.zend.com/manual/en/zend.search.lucene.query-api.html)或使用包含数值的备用[分析器。](http://framework.zend.com/manual/en/zend.search.lucene.extending.html#zend.search.lucene.extending.analysis)

[http://framework.zend.com/manual/en/zend.search.lucene.searching.html](http://framework.zend.com/manual/en/zend.search.lucene.searching.html)

> 重要的是要注意查询解析器使用标准分析器来标记查询字符串的各个部分。因此，应用于索引文本的所有转换也应用于查询字符串。
> 
> 标准分析器可以将查询字符串转换为小写以不区分大小写，删除停用词，并进行其他转换。
> 
> API 方法不会以任何方式转换或过滤输入项。因此，它更适合计算机生成或未标记的字段。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T16:13:46.073

我习惯于在 Java 下使用 Lucene，所以我无法判断您的代码是否正确，但似乎该字段正在以一种去除除 [a-zA-Z] 之外的任何内容的方式进行标记化。

[使用诸如http://www.getopt.org/luke/](http://www.getopt.org/luke/)之类的索引浏览器工具来准确查看索引中的内容可能有助于阐明这种情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-09T18:32:15.933

通过使用 Zend/Search/Lucene/Analysis/Analyzer/Common/TextNum.php 作为默认值（如上所述，使用 ::setDefault(...)），我能够很容易地获取文本和数字。

我的问题是我试图索引大量具有悠久历史和许多版本号的软件和硬件。Zend Search Lucene 没有对“单词”如“1.5.3”或任何带有点（例如IP 地址）、下划线或连字符的东西进行标记。

我首先复制了 TextNum.php，重命名了 TextNumSSC.php（SSC 是我们的应用程序名称）并尝试编辑 RegEx：

```
do {
                 if (! preg_match('/[a-zA-Z0-9.-_]+/', $this->_input, $match, PREG_OFFSET_CAPTURE, $this->_position)) { 
                     // It covers both cases a) there are no matches (preg_match(...) === 0)
                     // b) error occured (preg_match(...) === FALSE)
                     return null;
                 } 
```

仍然没有运气。

然后我按照指示的方式安装了[http://codefury.net/projects/StandardAnalyzer/](http://codefury.net/projects/StandardAnalyzer/)，在Zend目录结构之外，把RegEx改成

```
'/[a-zA-Z0-9.-_]+/' 
```

现在它可以工作了。

不确定其根本原因，但在 SO 或网络上找不到任何解决此点问题的内容。

# visual-studio - 如何在 Visual Studio 2008 和 2010 中使用选定的垂直块？

> ID：654899
> 
> 赞同：0
> 
> 时间：2009-03-17T16:05:02.227
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-2010

我知道您可以在 Visual Studio 2008 中选择一个垂直块（alt-drag），但我不明白您在选择它后如何使用它。

你怎么：

1.  移动块内的选择点并让您输入的文本同时插入每一行？
2.  将块向右/向左移动一格

或者你可以复制/删除选择吗？当我看到选择功能时，我认为它类似于 TextMate 的垂直块，但也许它没有那么先进。

新行为（截至 VS2010 RC - 2010 年 2 月 13 日添加）：

*   您现在可以输入选择并在每一行显示相同的内容。
*   Tab 移动选定的块

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T16:19:56.870

我能想到的第一件事是当我有一组 UI 控件和一个数据库时 - 例如 - PageLoad() 中的这种模式：

```
Field1.Text = xxx;
Field2.Text = xxx;
Field3.Text = xxx;
Field4.Text = xxx;
Field5.Text = xxx; 
```

还有一些我需要粘贴它们的地方。例如，在我要保存值的 Button 处理程序中。

```
DBCommand.AddWithValue("", );
DBCommand.AddWithValue("", );
DBCommand.AddWithValue("", );
DBCommand.AddWithValue("", );
DBCommand.AddWithValue("", ); 
```

我会使用块副本将字段拉入目标（这里我将粘贴到值）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T17:03:01.290

当您从 Internet 复制粘贴代码时，代码通常在代码的每一行前面都有行号或“>”或其他一些 HTML 前缀，这在编译时可能会很麻烦。这是使用它的一个领域。

*免责声明：不，我不会给你关于我的编码技能的想法;-)*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T16:09:58.250

我认为这几乎只是用于复制/剪切/删除。如果我错了，并且它具有更多功能，我会很高兴听到它。

# css - 用于在标签中显示内容的表单设计

> ID：654901
> 
> 赞同：0
> 
> 时间：2009-03-17T16:05:09.543
> 
> 标签：css, forms, label

我看到*大量*包含表单域的表单设计，但我找不到在表单中显示标签的好例子。

有没有人对显示信息而不是收集信息的表单有很好的布局？我有一个显示包含多个字段的用户配置文件的表单，我想将它分布在水平区域中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:00:11.530

您可以通过制作标签和数据`display: inline-block`并为标签提供固定宽度和右对齐来获得很好的效果：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head>
        <title>Mailing label</title>

        <style type="text/css">
            .form div.row {
                margin-top: .25em;
            }

            .form span {
                display: inline-block;
                vertical-align: top;
            }

            .form span.label {
                font-weight: bold;
                margin-right: .25em;
                text-align: right;
                width: 10em;
            }
        </style>
    </head>

    <body>
        <div class="form">
            <div class="row"><span class="label">Name:</span> <span class="value">Ben Blank</span></div>
            <div class="row"><span class="label">Address:</span> <span class="value">1024 Foo Bar Drive<br/>Silicon Valley, CA, 69105</span></div>
            <div class="row"><span class="label">E-Mail:</span> <span class="value">ben.blank@example.com</span></div>
            <div class="row"><span class="label">Phone:</span> <span class="value">(202) 555-1212</span></div>
        </div>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T16:22:52.150

听起来你不是在谈论表格。显示用户数据可以模仿表单的布局，但如果您没有字段，它就不是表单。

您是指 HTML 标签，还是标签的 .Net/Java UI 概念？在 HTML 中，标签与输入字段匹配作为提示（“名字：”等）。听起来您更像是在谈论 .Net 标签，它只是一个文本占位符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T16:29:45.613

我相信这完全取决于数据的性质：

*   如果您要显示数字，则字段会更小，您将能够在一行中显示更多数据。
*   如果您要显示长文本，那将很困难。
*   它还取决于哪些数据更重要并且您想首先显示。
*   最后，不同的用户可能需要以不同的方式查看数据。

不幸的是，我相信您的问题没有灵丹妙药……对于您的特定问题，这只是常识问题。

# zend-framework - Zend 框架身份验证和重定向

> ID：654904
> 
> 赞同：1
> 
> 时间：2009-03-17T16:05:28.450
> 
> 标签：zend-framework, routing

Zend Framework 中提供受限区域并将用户重定向到登录页面的最佳方法是什么？我想要做的是在我的控制器上为受限页面设置一个标志：

```
class AdminController extends Zend_Controller_Action
{
    protected $_isRestricted = true;
    .... 
```

并有一个插件检查控制器是否受到限制以及用户是否已通过身份验证，否则将它们重定向到登录页面。如果我直接在控制器的 preDispatch 中执行此操作，我可以使用 $this->_redirect()，但查看 Action Helpers 他们将无法访问它。在每个需要它的控制器中复制/粘贴身份验证检查代码也是很多重复的代码。

我需要链接到 preDispatch 的 Action Controller 还是 Front Controller 插件？我将如何进行重定向并仍然保留基本 URL 之类的内容？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T16:13:53.297

使用[`Zend_Acl`](http://framework.zend.com/manual/en/zend.acl.html)（最好与 结合使用[`Zend_Auth`](http://framework.zend.com/manual/en/zend.auth.html)）

另见[实用 Zend_ACL + Zend_Auth 实现和最佳实践](https://stackoverflow.com/questions/2046608/practical-zend-acl-zend-auth-implementation-and-best-practices)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:53:43.680

对于一个项目，我扩展了 Zend_Controller_Action，并在该类的 preDispatch 中检查了是否已登录。我可以在每个操作的基础上使用 init() 来覆盖它，该 init() 检查操作名并关闭需求（或 preDispatch() 调用它的父级进行实际检查）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-16T06:46:20.440

在我正在进行的一个项目中，我遇到了各种用户遇到浏览器超时的问题。这意味着 Zend_Auth 不再存在于注册表中，用户无法访问所需的页面/功能。

为了阻止这种情况发生，我设置了一个插件（如你所建议的那样）并让这个插件在 preDispatch() 中执行检查。下面是一个例子：

```
class Bootstrap extends Zend_Application_Bootstrap_Bootstrap
{
    public function run()
    {
        $front  = Zend_Controller_Front::getInstance();
        $front->registerPlugin(new App_Controller_Plugin_Timeout());
        parent::run();
    }
} 
```

超时类实现任何 Zend_Auth 或 Zend_Acl 要求，通过下面的函数进行检查。

```
class App_Controller_Plugin_Timeout extends Zend_Controller_Plugin_Abstract
{
    /**
     * Validate that the user session has not timed out.
     * @param Zend_Controller_Request_Abstract $request
     * @return void
     * @todo Validate the user has access to the requested page using Zend_Acl
     */
    public function preDispatch(Zend_Controller_Request_Abstract $request)
    {
        $frontController = Zend_Controller_Front::getInstance();
        $controllerName  = $frontController->getRequest()->getControllerName();
        $actionName      = $frontController->getRequest()->getActionName();
        $authInstance    = Zend_Auth::getInstance();

        /** If the controller is not the Auth or Error controller, then check for
         *  a valid authorized user and redirect to the login page if none found */
        if (($controllerName !== 'auth') && ($controllerName !== 'index') && ($controllerName !== 'error')) {
            if (!$authInstance->hasIdentity()) {
                $this->_response->setRedirect('/index/timeout')->sendResponse();
                exit;
            }
        } else if (($controllerName == 'index') || (($controllerName == 'auth') && ($actionName !== 'logout'))) {
            /** If running the Auth or Index (default) controller (and not the logout
             *  action), check if user already signed in and redirect to the welcome page */
            if ($authInstance->hasIdentity()) {
                $this->_response->setRedirect('/general/welcome')->sendResponse();
                exit;
            }
        }
    }
} 
```

……

```
/**
 * Test that the input user belongs to a role based on the user input and
 * the values loaded into the Acl registry object setup when the site first
 * loads
 *
 * @param   mixed|Zend_Auth $userData
 * @param   string          $userRole
 * @return  boolean
 * @throws  Zend_Exception  When invalid input is provided
 */

public function isUserMemberOfRole($userData, $userRole)
{
    if (empty($userData)) {
        $auth = Zend_Auth::getInstance();
        if($auth->hasIdentity()) {
            $userData = $auth->getIdentity();
        } else {
            return FALSE;
        }
    }

    if (!is_string($userRole)){
        throw new Zend_Exception('Invalid input provided to ' . __METHOD__);
    }

    // Setup the required variables and access the registry for the Acl values
    $rolesTable = new App_Model_Internal_UsersToRoles();
    $registry   = Zend_Registry::getInstance();
    $acl        = $registry->get('acl');
    $roles      = $rolesTable->getUserRoles($userData); // returns an array of values

    foreach ($roles as $value) {
        if ($value['Name'] == $userRole) {
            return $acl->isAllowed($value['Name'], null, $userRole);
        }
    }
} 
```

我在数据库表中实现了用户访问，然后在 Bootstrap->run() 中初始化为“_init”函数，如下所示：

```
protected function _initAclObjectForUserRoles()
{
    $userTable = new App_Model_Internal_Roles();
    $acl       = new Zend_Acl();

    $userRoles = $userTable->fetchAll();
    $roles     = $userRoles->toArray();

    // Cycle through each Role and set the allow status for each
    foreach($roles as $value) {
        $department = $value['Name'];
        $acl->addRole(new Zend_Acl_Role($department));
        $acl->allow($department, null, $department);
    }

    // Add the new Acl to the registry
    $registry = Zend_Registry::getInstance();
    $registry->set('acl', $acl);
} 
```

因此，使用这种方法，您可以通过从数据库加载的角色将访问限制设置到 Zend_Acl 对象中，或者您可以通过 Timeout 插件加载控制器类属性并检查它的值。虽然，我发现在数据库中维护访问策略比在整个代码库中传播它们更容易...... :-)

# refactoring - 遗留代码噩梦

> ID：654905
> 
> 赞同：25
> 
> 时间：2009-03-17T16:06:12.550
> 
> 标签：refactoring, legacy-code

我继承了一个项目，其中类图非常类似于意大利面上的蜘蛛网。在过去的两个月里，我编写了大约 300 个单元测试来给自己一个涵盖主要可执行文件的安全网。

在任何特定时刻，我的敏捷开发书籍库都触手可及：

*   *有效地使用遗留代码*
*   *重构*
*   *代码完成*
*   *C# 中的敏捷原则模式和实践*
*   等等

问题是我触摸的所有东西似乎都破坏了其他东西。UI 类混合了业务逻辑和数据库代码。许多类之间存在相互依赖关系。每次我更改任何其他课程时，都会有几个上帝课程中断。还有一个突变的单例/实用程序类，其中包含大约一半的实例方法和一半的静态方法（尽管具有讽刺意味的是，静态方法依赖于实例而实例方法不依赖）。

我的前辈甚至认为向后使用所有数据集会很聪明。每个数据库更新都作为存储过程中的参数直接发送到数据库服务器，然后手动刷新数据集，以便 UI 显示最近的更改。

我有时会认为他们使用了某种形式的弱混淆来保证工作安全，或者作为交出代码之前的最后告别。

有没有什么好的资源来解决这个烂摊子？我的书很有帮助，但似乎只涵盖了我遇到的一半情况。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-17T16:12:26.967

听起来您正在以正确的方式解决它。

*   测试
*   重构
*   再次测试

不幸的是，这可能是一个缓慢而乏味的过程。真的没有什么可以替代挖掘和理解代码试图完成的事情。

我可以推荐的一本书（如果您还没有将其归档在“等”下）是[Refactoring to Patterns](http://www.industriallogic.com/xp/refactoring/)。它适用于处于您确切情况的人。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-17T16:12:32.020

我在类似的情况下工作。

如果它不是一个小型实用程序，而是一个大型企业项目，那么它是：

a) 修复它为时已晚
b) 超出一个人的能力来尝试 a)
c) 只能通过完全重写不可能的东西来修复

在许多情况下，重构只能在您的私人时间尝试，风险自负。如果您没有明确授权将其作为日常工作的一部分，那么您甚至可能不会因此获得任何荣誉。甚至可能被批评为“毫无意义地将时间浪费在已经完美运行了很长时间的事情上”。

只需像以前一样继续破解它，收到你的薪水等等。当您完全感到沮丧或系统达到无法进一步破解的程度时，请找另一份工作。

编辑：每当我试图解决真正架构的问题并以正确的方式做事时，我通常会直接从负责任的经理那里得到大声笑，他们说“我不关心好的架构”（尝试过德语翻译）。我个人将一个非常糟糕的组件带到了不可破解的地步，当然也提前几个月发出了警告。然后，他们不得不取消向客户承诺的一些功能，因为它不再可行。再也没有人碰它了……

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-17T16:40:28.787

我以前做过这份工作。我花了两年多的时间研究一个非常相似的传统野兽。我们两个人花了一年多的时间来稳定一切（它仍然坏了，但更好了）。

第一件事 - 如果应用程序不存在，则将异常记录到应用程序中。我们使用了[FogBugz](http://en.wikipedia.org/wiki/FogBugz)，我们花了大约一个月的时间将报告集成到我们的应用程序中；它并不完美，但它会自动报告错误。在所有事件中实现 try-catch 块通常是非常安全的，这将涵盖您的大部分错误。

从那里修复首先出现的错误。然后打小战斗，尤其是那些基于错误的战斗。如果您修复了一个意外影响其他内容的错误，请重构该块，使其与其余代码分离。

重写一个对公司成功至关重要的大型应用程序，无论它有多糟糕，都需要采取一些极端措施。即使您获得了这样做的许可，您也将花费太多时间来支持遗留应用程序，以在重写方面取得任何进展。如果您进行许多小的重构，最终要么大的不会那么大，要么您将拥有非常好的基础类来进行重写。

值得一提的是，这是一次很棒的体验。这会令人沮丧，但你会学到很多东西。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-17T16:22:53.617

我（曾经）遇到过非常纠结的代码，以至于我无法在合理的时间内用功能副本修复它。不过那是一种特殊情况，因为它是一个解析器，我不知道有多少客户可能正在“使用”它的一些错误。错误地渲染数百个“工作”源文件不是一个好的选择。

大多数时候它是迫在眉睫的，只是令人生畏。通读那本重构书。

我通常会通过稍微移动一些东西来修复错误的代码（实际上不会更改超出要求的实现代码），以便模块和类至少在某种程度上是连贯的。

完成后，您可以使用更连贯的类并重写其内容以完全相同的方式执行，但这次使用合理的代码。这是管理的棘手部分，因为他们通常不喜欢听到您将花费数周时间来编写和调试行为完全相同的东西（如果一切顺利的话）。

在这个过程中，我保证你会发现大量的错误，以及彻头彻尾的设计愚蠢。在重新编码时修复一些小错误是可以的，否则将这些东西留到以后。

使用几个类完成此操作后，您将开始看到可以更好地模块化，设计更好等的地方。此外，在不影响无关事物的情况下进行此类更改会更容易，因为代码现在更加模块化，并且您大概知道透彻。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T16:15:56.800

大多数情况下，这听起来很糟糕。但我不明白这部分：

> 我的前辈甚至认为向后使用所有数据集会很聪明。每个数据库更新都作为存储过程中的参数直接发送到数据库服务器，然后手动刷新数据集，以便 UI 显示最近的更改。

这听起来非常接近我经常写东西的方式。这有什么问题？正确的方法是什么？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T16:21:16.587

请参阅博客文章*[Anatomy of an Anti-Corruption Layer，第 1 部分](http://moffdub.wordpress.com/2008/09/21/anatomy-of-an-anti-corruption-layer-part-1/)*和*[Anatomy of an Anti-Corruption Layer，第 2 部分](https://moffdub.wordpress.com/2008/09/24/anatomy-of-an-anti-corruption-layer-part-2/)*。

它引用了 Eric Evans，*[领域驱动设计：解决软件核心的复杂性](https://rads.stackoverflow.com/amzn/click/com/0321125215)*：

*访问门面后面的废话*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T16:25:18.760

没有一本书能够涵盖所有可能的情况。它还取决于您对项目的期望以及是否有任何类型的外部规范。

*   如果您只需要偶尔进行一些小的更改，只需进行这些更改，而不必费心开始重构。
*   如果有规范（或者你可以找人来编写），如果可以通过可预见的项目更改量来证明它是合理的，请考虑完全重写
*   如果“实现就是规范”**并且**计划进行很多更改，那么您就很烦了。编写大量[单元测试](http://en.wikipedia.org/wiki/Unit_testing)并以小步骤开始重构。

实际上，无论您做什么，单元测试都将是无价的（如果您可以将它们写入一个不会因重构或重写而发生太大变化的接口，也就是说）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-17T16:31:23.723

如果您的重构正在破坏代码，尤其是似乎不相关的代码，那么您一次尝试做的事情太多了。

我建议您进行一次重构，其中您所做的只是 ExtractMethod：目标只是为代码中的每个步骤命名，而无需进行任何合并尝试。

之后，考虑打破依赖关系，替换单例，合并。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-17T17:01:03.697

如果您的重构正在破坏事物，那么这意味着您没有足够的单元测试覆盖率 - 因为单元测试应该首先破坏。我建议您在异常记录到位之后获得更好的单元测试覆盖率。

然后我建议你先做小的重构——提取方法把大的方法分解成可以理解的部分；引入变量以删除方法中的一些重复；如果您发现调用者和被调用者使用的变量之间存在重复，则可能引入参数。

并在每次重构或一组重构之后运行单元测试套件。我会说*全部*运行它们，直到您确信每次都需要重新运行哪些测试。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-17T17:13:19.533

祝你好运，这是作为开发人员的艰难部分。

我认为您的方法很好，但您需要专注于交付业务价值（单元测试的数量不是衡量业务价值的标准，但它可能会告诉您您是否处于正轨）。确定需要改变的行为、确定优先级并关注最重要的行为是很重要的。

另一个建议是保持谦虚。意识到如果你在真正的截止日期前写了这么大的东西，而其他人看到了你的代码，他们可能也会在理解它时遇到问题。有一个技巧是写干净的代码，还有一个更重要的技巧是处理别人的代码。

最后一条建议是尝试利用团队的其他成员。过去的成员可能知道有关您可以学习的系统的信息。此外，他们可能能够帮助测试行为。我知道理想的情况是进行自动化测试，但如果有人可以通过手动为您验证事情来提供帮助，请考虑获得他们的帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-17T17:25:12.250

我特别喜欢*[Code Complete](https://en.wikipedia.org/wiki/Code_Complete)*中的图表，其中您只从遗留代码开始，即模糊灰色纹理的矩形。然后当你替换其中一些时，底部有模糊的灰色，顶部有纯白色，以及代表两者之间界面的锯齿线。

也就是说，一切要么是“讨厌的旧东西”，要么是“好的新东西”。线的一侧或另一侧。

这条线是锯齿状的，因为您正在以不同的速率迁移系统的不同部分。

当你工作时，锯齿线逐渐下降，直到你的白色多于灰色，最终只有灰色。

当然，这不会让您更轻松地了解细节。但它确实为您提供了一个模型，您可以使用它来监控您的进度。在任何时候，你都应该清楚地了解界限在哪里：哪些是新的，哪些是旧的，以及双方如何通信。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-22T00:05:05.660

您可能会发现以下帖子很有用： [http ://refactoringin.net/?p=36](http://refactoringin.net/?p=36)

正如帖子中所说，不要轻易丢弃完全覆盖。此外，如果可能的话，尝试用第三方解决方案替换整个层或层，例如用于持久性的[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)或新代码。但最重要的是，尝试理解代码背后的逻辑（问题域）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-06T12:55:20.967

您可以提取并重构其中的某些部分，以打破依赖关系并将层隔离到不同的模块、库、程序集、目录中。[然后，您使用扼杀应用](http://www.martinfowler.com/bliki/StranglerApplication.html)策略将清理过的部分重新注入应用程序。起泡，冲洗，重复。

# c# - Linq to Entity，随机顺序

> ID：654906
> 
> 赞同：40
> 
> 时间：2009-03-17T16:06:19.553
> 
> 标签：c#, entity-framework, linq-to-entities

如何以随机顺序返回匹配的实体？
需要明确的是，这是实体框架的东西和 LINQ to Entities。

（航空代码）

```
IEnumerable<MyEntity> results = from en in context.MyEntity
                                where en.type == myTypeVar
                                orderby ?????
                                select en; 
```

谢谢

**编辑：**
我尝试将此添加到上下文中：

```
public Guid Random()
{
    return new Guid();
} 
```

并使用此查询：

```
IEnumerable<MyEntity> results = from en in context.MyEntity
                                where en.type == myTypeVar
                                orderby context.Random()
                                select en; 
```

但我得到了这个错误：

```
System.NotSupportedException: LINQ to Entities does not recognize the method 'System.Guid Random()' method, and this method cannot be translated into a store expression.. 
```

**编辑（当前代码）：**

```
IEnumerable<MyEntity> results = (from en in context.MyEntity
                                 where en.type == myTypeVar
                                 orderby context.Random()
                                 select en).AsEnumerable(); 
```

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-03-17T16:08:01.097

执行此操作的一种简单方法是订购，`Guid.NewGuid()`然后订购发生在客户端。您也许可以说服 EF 在服务器端做一些随机的事情，但这并不一定简单——而且使用“按随机数排序”来做这件事[显然是有](https://stackoverflow.com/questions/7952147)问题的。

要在 .NET 端而不是在 EF 中进行排序，您需要`AsEnumerable`：

```
IEnumerable<MyEntity> results = context.MyEntity
                                       .Where(en => en.type == myTypeVar)
                                       .AsEnumerable()
                                       .OrderBy(en => context.Random()); 
```

最好在列表中获取*无序*版本，然后再随机播放。

```
Random rnd = ...; // Assume a suitable Random instance
List<MyEntity> results = context.MyEntity
                                .Where(en => en.type == myTypeVar)
                                .ToList();

results.Shuffle(rnd); // Assuming an extension method on List<T> 
```

洗牌比排序更有效，除此之外。有关获取适当实例的详细信息，请参阅我[关于随机性的文章。](http://csharpindepth.com/Articles/Chapter12/Random.aspx)`Random`Stack Overflow 上有很多 Fisher-Yates shuffle 实现。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2010-11-07T22:49:26.453

Jon 的回答很有帮助，但实际上您*可以*让数据库使用`Guid`和 Linq to Entities 进行排序（至少，您可以在 EF4 中）：

```
from e in MyEntities
orderby Guid.NewGuid()
select e 
```

这会生成类似于以下的 SQL：

```
SELECT
[Project1].[Id] AS [Id], 
[Project1].[Column1] AS [Column1]
FROM ( SELECT 
    NEWID() AS [C1],                     -- Guid created here
    [Extent1].[Id] AS [Id], 
    [Extent1].[Column1] AS [Column1],
    FROM [dbo].[MyEntities] AS [Extent1]
)  AS [Project1]
ORDER BY [Project1].[C1] ASC             -- Used for sorting here 
```

在我的测试中，使用`Take(10)`生成的查询（在 SQL 中转换为`TOP 10`），该查询针对具有 1,794,785 行的表始终在 0.42 到 0.46 秒之间运行。不知道 SQL Server 是否对此进行了任何类型的优化，或者它是否为该表中的*每一*行生成了一个 GUID。无论哪种方式，这都比将所有这些行带入我的流程并尝试在那里对其进行排序要快得多。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-03-17T16:09:38.173

简单的解决方案是创建一个数组（或 a `List<T>`），然后随机化它的索引。

编辑：

```
static IEnumerable<T> Randomize<T>(this IEnumerable<T> source) {
  var array = source.ToArray();
  // randomize indexes (several approaches are possible)
  return array;
} 
```

编辑：就个人而言，我发现 Jon Skeet 的答案更优雅：

```
var results = from ... in ... where ... orderby Guid.NewGuid() select ... 
```

当然，您可以使用随机数生成器而不是`Guid.NewGuid()`.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-07-06T12:31:37.850

不幸的是，在服务器端对它进行排序的`NewGuid`hack 会导致实体在连接（或急切获取包含）的情况下重复。

请参阅有关[此问题](https://stackoverflow.com/q/7952147/1178314)的此问题。

为了克服这个问题，您可以在某些唯一值计算的服务器端使用而不是`NewGuid`sql `checksum`，在客户端计算一次随机种子来随机化它。请参阅[我](https://stackoverflow.com/a/31245404/1178314)对先前链接问题的回答。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-24T15:16:51.940

此处提供的解决方案在客户端上执行。如果你想要在服务器上执行的东西，[这里有一个 LINQ to SQL 的解决方案](http://linqinaction.net/blogs/main/archive/2008/01/10/randomizing-linq-to-sql-queries.aspx)，你可以将它转换为实体框架。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-06-26T05:56:13.987

lolo_house 有一个非常简洁、简单和通用的解决方案。您只需将代码放在单独的静态类中即可使其工作。

```
using System;
using System.Collections.Generic;
using System.Linq;

namespace SpanishDrills.Utilities
{
    public static class LinqHelper
    {
        public static IEnumerable<T> Randomize<T>(this IEnumerable<T> pCol)
        {
            List<T> lResultado = new List<T>();
            List<T> lLista = pCol.ToList();
            Random lRandom = new Random();
            int lintPos = 0;

            while (lLista.Count > 0)
            {
                lintPos = lRandom.Next(lLista.Count);
                lResultado.Add(lLista[lintPos]);
                lLista.RemoveAt(lintPos);
            }

            return lResultado;
        }
    }
} 
```

然后使用代码只是做：

```
var randomizeQuery = Query.Randomize(); 
```

很简单！谢谢lolo_house。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T16:25:54.717

这个怎么样：

```
 var randomizer = new Random();
    var results = from en in context.MyEntity
                  where en.type == myTypeVar
                  let rand = randomizer.Next()
                  orderby rand
                  select en; 

```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T17:07:33.353

Toro 的答案是我会使用的答案，但就像这样：

```
static IEnumerable<T> Randomize<T>(this IEnumerable<T> source)
{
  var list = source.ToList();
  var newList = new List<T>();

  while (source.Count > 0)
  {
     //choose random one and MOVE it from list to newList
  }

  return newList;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-10-07T01:09:41.843

这是一个很好的方法（主要用于谷歌搜索）。

您还可以在末尾添加 .Take(n) 以仅检索一组数字。

```
model.CreateQuery<MyEntity>(   
    @"select value source.entity  
      from (select entity, SqlServer.NewID() as rand  
            from Products as entity 
            where entity.type == myTypeVar) as source  
            order by source.rand"); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-03T12:50:57.403

我认为最好不要在类中添加属性。更好地使用该位置：

```
public static IEnumerable<T> Randomize<T>(this IEnumerable<T> pCol)
    {
        List<T> lResultado = new List<T>();
        List<T> lLista = pCol.ToList();
        Random lRandom = new Random();
        int lintPos = 0;

        while (lLista.Count > 0)
        {
            lintPos = lRandom.Next(lLista.Count);
            lResultado.Add(lLista[lintPos]);
            lLista.RemoveAt(lintPos);
        }

        return lResultado;
    } 
```

并且调用将（如 toList() 或 toArray()）：

var 结果 = IEnumerable.Where(..).Randomize();

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-06-14T16:29:36.983

*（来自 EF Code First 的交叉发布[：如何获取随机行](https://stackoverflow.com/questions/7781893/ef-code-first-how-to-get-random-rows/17113105#17113105)）*

比较两个选项：

* * *

## 跳过（随机行数）

### 方法

```
private T getRandomEntity<T>(IGenericRepository<T> repo) where T : EntityWithPk<Guid> {
    var skip = (int)(rand.NextDouble() * repo.Items.Count());
    return repo.Items.OrderBy(o => o.ID).Skip(skip).Take(1).First();
} 
```

*   需要 2 个查询

### 生成的 SQL

```
SELECT [GroupBy1].[A1] AS [C1]
FROM   (SELECT COUNT(1) AS [A1]
        FROM   [dbo].[People] AS [Extent1]) AS [GroupBy1];

SELECT TOP (1) [Extent1].[ID]            AS [ID],
               [Extent1].[Name]          AS [Name],
               [Extent1].[Age]           AS [Age],
               [Extent1].[FavoriteColor] AS [FavoriteColor]
FROM   (SELECT [Extent1].[ID]                                  AS [ID],
               [Extent1].[Name]                                AS [Name],
               [Extent1].[Age]                                 AS [Age],
               [Extent1].[FavoriteColor]                       AS [FavoriteColor],
               row_number() OVER (ORDER BY [Extent1].[ID] ASC) AS [row_number]
        FROM   [dbo].[People] AS [Extent1]) AS [Extent1]
WHERE  [Extent1].[row_number] > 15
ORDER  BY [Extent1].[ID] ASC; 
```

* * *

## 指导

### 方法

```
private T getRandomEntityInPlace<T>(IGenericRepository<T> repo) {
    return repo.Items.OrderBy(o => Guid.NewGuid()).First();
} 
```

### 生成的 SQL

```
SELECT TOP (1) [Project1].[ID]            AS [ID],
               [Project1].[Name]          AS [Name],
               [Project1].[Age]           AS [Age],
               [Project1].[FavoriteColor] AS [FavoriteColor]
FROM   (SELECT NEWID()                   AS [C1],
               [Extent1].[ID]            AS [ID],
               [Extent1].[Name]          AS [Name],
               [Extent1].[Age]           AS [Age],
               [Extent1].[FavoriteColor] AS [FavoriteColor]
        FROM   [dbo].[People] AS [Extent1]) AS [Project1]
ORDER  BY [Project1].[C1] ASC 
```

因此，在较新的 EF 中，您可以再次看到它`NewGuid`被翻译成 SQL（由 @DrewNoakes [https://stackoverflow.com/a/4120132/1037948](https://stackoverflow.com/a/4120132/1037948)确认）。即使两者都是“in-sql”方法，我猜 Guid 版本更快？如果您不必为了跳过而对它们进行排序，并且您可以合理地猜测要跳过的数量，那么 Skip 方法可能会更好。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2013-01-01T08:02:08.400

从理论上讲（我还没有真正尝试过），以下应该可以解决问题：

将部分类添加到您的上下文类：

```
public partial class MyDataContext{

        [Function(Name = "NEWID", IsComposable = true)] 
        public Guid Random()
        { 
            // you can put anything you want here, it makes no difference 
            throw new NotImplementedException();
        }
} 
```

执行 ：

```
from t in context.MyTable
orderby  context.Random()
select t; 
```

# php - 网页上的重复资源管理器/outlook 类型的应用程序

> ID：654908
> 
> 赞同：0
> 
> 时间：2009-03-17T16:07:20.223
> 
> 标签：php, javascript, html, css

我们有一个古老的应用程序，它基本上复制了一个文件浏览器，html 中的 Outlook 样式应用程序（顶部的菜单和工具栏，左侧的树，右侧的 gridview，是的，我知道将桌面 UI 引入网络是个坏主意，但那是 2000 年，当时似乎是个好主意）。主要问题（除了 HTML 是从 ~2000 年开始的）是它是一个仅限 Internet Explorer 的应用程序，并且由于可怕的 html 是更新的噩梦。

实现这一目标的最佳 HTML/CSS/Javascript/PHP 库是什么？我看过 YUI、MooTools、JQuery 和其他一些工具，但似乎都没有我需要的东西。如果我可以只使用 PHP 库，我会更喜欢，但是好的 HTML/CSS/Javascript 库也可以。要求是：

1.  菜单（顶部菜单和上下文菜单）。
2.  树（最好是ajax，延迟加载，树中有5000个节点，现在加载需要一段时间）。
3.  窗口和模式对话框。
4.  Grid 和 TreeView 的拆分器。

很高兴拥有

1.  Heirachacal 网格。
2.  工具提示。

提前感谢您的建议...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:15:40.220

我会建议看一下[ExtJS](http://extjs.com/)的这类事情。然后，您可以很容易地使用 JSON 在它和 PHP 之间发送数据。网格和树很容易从提供 JSON 的 URL 中填充。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:22:39.780

你检查[过 Qooxdoo](http://qooxdoo.org/)或[Capuccino](http://cappuccino.org)吗？看起来它们可能涵盖了您为这个特定项目所拥有的 UI 必需品，因为它们旨在为 Web 提供 GUI 桌面的优点；确保检查他们的演示。

至于服务器端 PHP 部分，我当然会尝试根据自己的需要定制它，但如果我必须选择一个框架，我会选择[Yii](http://www.yiiframework.com)、[Code Igniter](http://codeigniter.com)或[CakePHP](http://cakephp.org)，这取决于您的可扩展性需求。

干杯!

# iphone - UITableView：将一行移动到一个空白部分

> ID：654909
> 
> 赞同：5
> 
> 时间：2009-03-17T16:07:56.417
> 
> 标签：iphone, ios, uitableview

我有`UITableView`一些空白部分。我希望用户能够使用标准编辑模式控件将一行移入其中。到目前为止，我能做到的唯一方法是在我的“空”部分中有一个虚拟行，并尝试通过`tableView:heightForRowAtIndexPath:`将虚拟行的高度设为零来隐藏它。这似乎将其保留为 1 像素行。我可能可以通过制作一种刚刚填充的特殊类型的单元格来隐藏它`[UIColor groupTableViewBackgroundColor]`，但是有更好的方法吗？

这都是在分组模式下的`UITableView`。

更新：看起来无需任何技巧*就*可以将行移动到空白部分，但是“敏感性”已经足够糟糕了，您确实需要技巧才能使其可用于一般用户（他们不会有足够的耐心慢慢悬停该行围绕空白部分，直到点击）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-12-20T01:22:29.057

我发现在 iOS 4.3 中，虚拟行的高度必须至少为 1 个像素，才能提供允许将行移动到该部分的所需效果。

我还发现只有第一节和最后一节才需要虚拟行；中间的任何部分都没有这个问题。

它看起来像在 iOS 5.0 中，根本不需要虚拟行或特殊技巧。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T16:24:26.140

在管理编辑时，您可以监控表视图是否处于编辑模式。使用内部的标志`cellForRowAtIndexPath`来决定天气或不显示“空白”行。在“常规”模式下，该行不会显示，但当用户点击“编辑”时，应该再次调用 cellForRowAtIndexPath，这一次决定显示该行。具体如何操作取决于您的数据源以及如何将其粘贴到显示器上。如果您没有再次接到电话，您可以手动使用`insertRowsAtIndexPaths`/`deleteRowsAtIndexPaths`和/或调用`reloadData`来注入行以强制刷新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-08T12:16:56.633

我发现如果从 heightForRowAtIndexPath 方法返回 -1.0 ，它将删除 1 像素线。

# vb6 - VB6 作为标准用户安装在 Windows Vista 上

> ID：654911
> 
> 赞同：4
> 
> 时间：2009-03-17T16:08:31.890
> 
> 标签：vb6, windows-vista

我有一个需要作为标准用户安装在 Windows Vista 上的 VB6 应用程序。使用 Visual Studio 2005，我创建了一个安装项目，它将应用程序放置在标准的用户安全位置或文件夹中。我还有一个要安装并注册到用户应用程序数据文件夹的 dll。在 VS'05 中创建 Windows 安装程序后，我使用 msiinfo.exe 翻转了字数属性的第 3 位，以便 Vista 在运行 msi 时不会提示管理员凭据。应用程序安装没有任何问题，直到它尝试将 dll 注册到用户应用程序数据文件夹。当它到达那个点时，它会抛出一个错误，指出它无法为 dll 注册类型库。安装程序似乎无权将 dll 注册到用户文件夹。它是否正确？我的理解是，Vista 只抱怨标准用户更新或更改影响机器所有用户的项目。有任何想法吗？想法？建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T17:14:36.520

您可以使用 RegFree COM，而不是直接注册您的 DLL 文件。

这涉及为您的应用程序创建一个 XML 清单文件，因此 Windows 将在应用程序文件夹中查找您的 DLL 文件，而不是使用系统注册表来查找它们。

这意味着您的应用程序将正常运行，而无需您的安装程序注册 DLL。

这些链接有更多信息：

[http://msdn.microsoft.com/en-us/magazine/cc188708.aspx](http://msdn.microsoft.com/en-us/magazine/cc188708.aspx)

[http://www.devx.com/vb/Article/32888/1954](http://www.devx.com/vb/Article/32888/1954)

您可以使用免费的 Make My Manifest 软件来创建您需要的清单文件：

[http://mmm4vb6.atom5.com/](http://mmm4vb6.atom5.com/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T17:43:20.820

史蒂夫

我的建议是，如果可以的话，使用 regfree com/manifest 文件而不是注册 ocx/dll 文件，正如你所提到的，这在基本用户帐户下是一件真正的苦差事。

您也可以在这里使用一个出色的免费应用程序来为您构建清单：http: [//mmm4vb6.atom5.com/](http://mmm4vb6.atom5.com/)

我们已经使用它几年了，没有任何问题。

*编辑*MMM 网站已关闭。我[在这里](http://web.archive.org/web/20140829021337/http://mmm4vb6.atom5.com/)看到作者在托管方面遇到了问题，并提供了另一个位置来获取 Make My Manifest -[在此处下载](https://app.box.com/s/yvm0wk95e1lachm7juf5)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T17:04:51.037

一般来说，我同意[Joel Coehoorn](https://stackoverflow.com/questions/654911/vb6-install-on-windows-vista-as-a-standard-user/654966#654966)在他的回答中所说的话。

但是，知道注册表在这方面是如何工作的，我可以建议您尝试手动将 DLL 注册到`HKEY_CURRENT_USER\SOFTWARE\Classes`，基本上重复 regsvr32.exe 对`HKEY_LOCAL_MACHINE\SOFTWARE\Classes`.

这有点小技巧，也许它不起作用，但你可以尝试一下。

*   MSDN 上的相关帖子：http: [//msdn.microsoft.com/en-us/library/ms693350.aspx](http://msdn.microsoft.com/en-us/library/ms693350.aspx)（感谢 MarkJ 在评论中指出这一点）
*   vbforums.com 上的相关帖子：[http ://www.vbforums.com/showthread.php?t=507228](http://www.vbforums.com/showthread.php?t=507228)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T22:30:21.917

*   无注册表 COM：[MakeMyManifest 广受好评](http://mmm4vb6.atom5.com/)。它是为 VB6 项目创建清单的自动工具：我自己没有尝试过。
*   [DirectCOM](http://www.thecommon.net/10.html)是免注册 COM 的替代方案。它也有粉丝，我还没有尝试过。

*编辑*MMM 网站已关闭。我[在这里](http://web.archive.org/web/20140829021337/http://mmm4vb6.atom5.com/)看到作者在托管方面遇到了问题，并提供了另一个位置来获取 Make My Manifest -[在此处下载](https://app.box.com/s/yvm0wk95e1lachm7juf5)。

有一种半自动技术可以为无注册表的 COM 创建清单。您可以使用 Visual Studio 2008 创建清单（您可以使用免费版本，如 Visual Basic Express Edition）。然后手动进行一些编辑以使清单适用于 VB6。有关分步说明，请参阅[此 MSDN 文章的这一部分- 忽略有关 ClickOnce 的其余文章。](http://msdn.microsoft.com/en-us/library/aa697429(VS.80).aspx#atupvb6ap2_topic4)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-14T19:25:53.557

[Unattended Make My Manifest](http://sourceforge.net/projects/ummm/)是 MMM 的翻版，可用于在自动构建中生成清单。它使用脚本文件来添加依赖的 COM 组件。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-17T16:22:17.677

注册 DLL 会影响所有用户（DLL 是全局注册的），因此需要管理员权限。没有办法解决这个问题。

较新的编程环境的解决方案是无需注册 DLL 即可使用。但是，由于 vb6 依赖于 COM，因此您可能不走运。

# xml - Flash/XML 特征线和隐藏字符

> ID：654914
> 
> 赞同：0
> 
> 时间：2009-03-17T16:08:57.800
> 
> 标签：xml, flash, eclipse, cdata

我遇到了这个问题，当编辑我的 xml 时，下一行的所有内容都会呈现两条断线

```
<![CDATA[Line one
Line two
Line three
]]> 
```

在 Flash 中渲染为

```
一号线

第二行

三号线

```

现在我之前研究过这个，它与隐藏的断线字符有关，我使用 Flexbuilder 和或 Aptana 来编辑 xml，但是当我想要一个时如何避免有两个断线。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:27:32.267

Flash 将`\r`和都解释`\n`为换行符。如果您的输入包含 windows 行尾 ( `\r\n`)，那么您会在输出中看到一个空行。

要解决您的问题，请在输出数据之前使用以下正则表达式将两个连续出现的`\r`和替换为一个。`\n`

```
var newline:RegExp = /\r\n|\n\r/g;
var input:String = "your XML CDATA input";
var output:String = input.replace(newline, "\n"); 
```

实际上这不太可能`\n\r`发生，但由于我们已经在替换，我们也可以修复这些无效的行尾。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T16:22:40.390

也许您插入了错误的行尾字符。通常您的选择是：cr-lf、cr 和 lf。第一个在 Windows 上运行良好，第二个在 Mac 上运行良好，第三个在大多数 Unix 版本上运行良好。尝试将您的编辑器设置为使用 lf (\n)。

# simulation - 是否有任何程序可以模拟不稳定的网络连接？

> ID：654915
> 
> 赞同：11
> 
> 时间：2009-03-17T16:09:06.757
> 
> 标签：simulation, network-traffic, unreliable-connection

我们需要模拟一个不稳定的网络连接来尝试调试我们的服务器/客户端应用程序中的一些连接问题，我想知道是否有任何程序可以模拟这些条件，例如在微弱的无线网络上。

我指的不仅仅是减少带宽，还包括降低可靠性、频繁开关、短时间的断开连接等。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T16:16:21.870

我使用了一个在 linux 上运行的名为 netem 的工具。它允许您以给定的百分比增加数据包丢失，在数据包中引入延迟并处理数据包重新排序。基本上，它旨在模拟不同的网络。

启动和运行它所需要的只是一台备用机器，它可以在上面安装 Linux，并带有几个以太网卡。将它作为桥梁连接起来，并在它们之间运行 netem。做起来应该很简单。我将它用于没有 Linux 经验的大学项目，但我可能仍然在某处获得了所有设置说明。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T17:02:41.900

Ian 的解决方案似乎是一个很好的长期解决方案，但听起来有点涉及到一些快速测试。（寻找另一台机器，连接它，可能设置路由器等）

我最终只使用了 Net Limiter 并手动将限制随机设置为非常低的值（例如 1 字节/秒），这似乎足以满足我们的需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T21:09:25.690

[http://snad.ncsl.nist.gov/nistnet/](http://snad.ncsl.nist.gov/nistnet/)

设置起来有点复杂，但效果很好。

# jquery - 导致用户控件中的更新面板从 javascript / jquery 进行部分页面刷新

> ID：654918
> 
> 赞同：2
> 
> 时间：2009-03-17T16:09:42.620
> 
> 标签：jquery, partial-page-refresh

我有许多页面，每个页面都有 3 或 4 个用户控件。每个控件都有自己的更新面板。

我正在使用 JQuery 和thickbox 创建一个模式窗口，在其中我打开另一个aspx 页面并更改一些数据。

我想要做的是能够在模式窗口关闭时刷新页面上的部分或全部更新面板/内容而不刷新整个页面。当模式窗口关闭时，我有时会在 Internet Explorer 中收到一条非常烦人的弹出消息，关于刷新或取消（此时手头没有该文本）。

我对 javascript 和 jquery 还很陌生，不知道该用哪种方式进行。

谢谢

乔恩·霍金斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T20:18:37.883

在 onClose 函数中，或者无论您如何设置 onClose 事件，只要您将 myObject 定义为更新面板的触发器，您就可以执行类似的操作。

```
function RefreshMyPanel() {
    var mypage = Sys.WebForms.PageRequestManager.getInstance();
    mypage._doPostBack('myObject', '');
} 
```

我没有测试过上面的代码，但似乎这是你可以解决的方法之一。

# http - 用户代理字符串可以有多大？

> ID：654921
> 
> 赞同：209
> 
> 时间：2009-03-17T16:10:57.033
> 
> 标签：http, database-design, http-headers, user-agent

如果您要将用户代理存储在数据库中，您会容纳多大？

我发现这篇[技术网文章](http://technet.microsoft.com/en-us/library/bb496341.aspx)建议将 UA 保持在 200 以下。它看起来不像 HTTP 规范中定义的，至少我发现没有。我的 UA 已经是 149 个字符，而且似乎每个版本的 .NET 都会添加到其中。

我知道我可以解析字符串并将其分解，但我宁愿不这样做。

* * *

**编辑**
基于此[博客](http://blogs.msdn.com/ie/archive/2010/03/23/introducing-ie9-s-user-agent-string.aspx)IE9 将更改为发送短 UA 字符串。这是一个很好的改变。

* * *

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2009-03-17T16:29:36.037

HTTP 规范根本不限制标头的长度。但是，网络服务器确实限制了它们接受的标头大小，`413 Entity Too Large`如果超过则抛出。

根据网络服务器及其设置，这些限制从 4KB 到 64KB（所有标头的总和）不等。

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2012-11-03T15:07:21.137

**我对此的看法：**

*   使用**专用表**仅存储 UserAgent *（对其进行规范化）*
*   在您的相关表中，存储一个**外键值**以指向 UserAgent**自动增量主键**字段
*   将实际的 UserAgent 字符串存储在**TEXT 字段中**，而不关心长度
*   拥有另一个`UNIQUE BINARY(32)` *（或 64 或 128，具体取决于您的哈希长度）*并对**UserAgent 进行哈希处理**

**一些 UA 字符串可能会变得非常长。**这应该可以免除您的后顾之忧。还要在 INSERTer 中强制执行最大长度，以将 UA 字符串保持在 4KB 以下。除非有人在用户代理中向您发送电子邮件，否则不应超过该长度。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2011-07-06T11:59:40.017

在我们的 apache 日志中注意到类似的内容。对我来说它看起来很不正常，但我经常在日志中看到这些东西，主要来自 Windows 系统。

> 97690420803；79980706603；9867086703；996602846703；87690803；6989010903；977809603；666601903；876905337803；89670603；89970200903；786903603；696901911703；788905703；896709803；96890703；998601903；88980703；666604769703；978806603；7988020803；996608803；788903297903；98770043603；899708803；66960371603；9669088903；69990703；99660519903；97780603；888801803；9867071703；79780803；9779087603；899708603；66960456803；898706824603；78890299903；99660703；9768079803；977901591603；89670605603；787903608603；998607934903；799808573903；878909603；979808146703；9996088603；797803154903；69790603；99660565603；7869028603；896707703；97980965603；976907191703；88680703；888809803；69690903；889805523703；899707703；997605035603；89970029803；9699094903；877906803；899707002703；786905857603；69890803；97980051903；997603978803；9897097903；66960141703；7968077603；977804603；88980603；989700803；999607887803；78690772803；96990560903；98970961603；9996032903；9699098703；69890655603；978903803；698905066803；977806903；9789061703；967903747703；976900550903；88980934703；8878075803；8977028703；97980903；9769006603；786900803；98770682703；78790903；878906967903；87690399603；99860976703；796805703；87990603；968906803；967904724603；999606603；988705903；989702842603；96790603；99760703；88980166703；9799038903；98670903；697905248603；7968043603；66860703；66860127903；9779048903；89670123903；78890397703；97890603；87890803；8789030603；69990603；88880763703；9769000603；96990203903；978900405903；7869022803；699905422903；97890703；87990903；878908703；7998093903；898702507603；97780637603；966907903；896702603；9769004803；7869007903；99660158803；7899099603；8977055803；99660603；7889080903；66660981603；997604603；6969089803；899701903；9769072703；666603903；99860803；997608803；69790903；88680756703；979805677903；9986047703；89970803；66660603；96690903；8997051603；789901209803；8977098903；968900326803；87790703；98770024803；697901794603；69990803；887805925803；968908903；97880603；897709148703；877909476903；66760197703；977908603；698902703；988706504803；977802026603；88680964703；8878068703；987705107903；978902878703；8898069803；9768031703；79680803；79980803；669609328703；89870238703；99960593903；969904218703；78890603；9788000703；69690630903；889800982903；988709748803；7968052803；99960007803；969900800803；668604817603；66960903；78790734603；8868007703；79780034903；8878085903；976907603；89670830803；877900903；969904889703；7978033903；8987043903；99860703；979805903；667603803；976805348603；999604127603；97790701603；78990342903；98770672903；87990253903；9877027703；97790803；877901895603；8789076903；896708595603；997601903；799806903；97690603；87790371703；667605603；99760303703；97680283803；788902750803；787909803；79780603；79880866903；9986050903；87890543903；979800803；97690179703；876901603；699909903；96990192603；878904903；877904734903；796801446903；977904803；9887044803；797805565603；98870789703；7869093903；87790727703；797801232803；666604803；9778071903；9799086703；6969000903；89670903；8799075903；897708903；88680903；97980362603；97980503903；889803256703；88980388703；789909376803；69690703；6969025903；89970309903；96690703；877901847803；968901903；96690603；88680607603；7889001703；789904761803；976807703；976902903；878907889703；9897014903；896707046603；696909903；666603998903；969902703；79680421803；9769075603；798800192703；97990903；9689024903；668604803；969908671903；9996094703；69990642703；97890895903；977805619903；79980859903；88980443803；98970649603；997602703；888802169903；699907803；667602028803；786903283903；997607703；969909803；798809925903；9976045603；97790903；9789001903；966903603；9789069603；968906603；6989091803；896701603；6979059803；978803903；997606362603；88980803；98970803；88880921703；8997065703；899700703；698908703；797801027903；7889050903；87890603；78690703；99660069703；97980309903；976800603；666606803；898707703；79880019803；66960250803；7978049803；88780602603；79680903；88880792703；96990903；667608603；87790730903；98970903；9699032903；8987004803；88880703；89770046603；978800803；969908903；9798022603；696901903；799803703；989703703；668605903；79780903；998601371703；796803339703；87890922603；898708903；9966061903；66960891903；96790903；8779050803；98870858803；976909298603；9887029903；669608703；979806903；878903803；99960703；9789086703；979801803；66960008703；979806830803；99760212703；786906603；797807603；789907297703；96990703；786901603；796807766603；896702651603；789902585603；66660925903；9986085703；66960302703；69890703；789900703；89970903；9679060703；9789002903；979908821603；986708140803；976809828703；7988082803；79680997903；99960803；9788081903；979805703；787908603；66960602803；9887098703；978803237703；888806804603；999604703；977904703；966904635703；97680291703；977809345603；8878046703；988709803；976900773603；989703903；88780198603；87790603；986708703；78890604703；87790544803；976809850903；887806703；987707527603；79880803；9897059603；897709820603；97880804803；66960026703；9789062803；9867090803；669600603；8967087703；78890903；89770903；97980703；976802687603；66860400803；979901288603；96990160903；99860228903；966900703；66760603；9689035703；9779064703；7968023603；87890791903；98770870603；9798005803；6969087903；9779097903；6979065703；699903252603；79780989703；87690901803；978905763903；977809703；97790369703；899703269603；8878012703；78790803；87690395603；8888042803；667607689903；8977041803；6666085603；6999080703；69990797803；88680721603；99660519803；889807603；87890146703；699906325903；89770603；669608615903；9779028803；88880603；97790703；79780703；97680355603；6696024803；78790784703；97880329903；9699077703；89870803；79680227903；976905852703；8997098903；896704796703；66860598803；9897036703；66960703；9699094703；9699008703；97780485903；999603179903；89770834803；96790445603；79680460903；9867009603；89870328703；799801035803；989702903；66960758903；66860150803；6686088603；9877092803；96990603；99860603；987703663603；98870903；699903325603；87790803；97680703；8868030703；9799030803；89870703；97680803；9669054803；6979097603；987708046603；999608603；878904803；998607408903；968903903；696900703；977907491703；6686033803；669601803；99960290603；887809169903；979803703；69890903；699901447903；8987064903；799800603；98770903；8997068703；967903603；66760146803；978805087903；697908138603；799801603；88780964903；989708339903；8967048603；88880981603；789909703；796806603；977905977603；989700603；97780703；9669062603；88980714603；897709545903；988701916703；667604694903；786905664603；877900803；886805490903；89970559903；99960531803；7998033903；98770803；78890418703；669600872803；996605216603；78690962703；667604903；996600903；999608903；9699083803；787901803；97780707603；787905312703；977805803；8977033703；97890708703；989705521903；978800703；698905703；78890376903；878907703；999602903；986705903；668602719603；979901803；997606903；66760393903；987703603；78790338903；96890803；97680596803；666601603；977902178803；877902803；78790038603；8868075703；99960060603) 787905312703；977805803；8977033703；97890708703；989705521903；978800703；698905703；78890376903；878907703；999602903；986705903；668602719603；979901803；997606903；66760393903；987703603；78790338903；96890803；97680596803；666601603；977902178803；877902803；78790038603；8868075703；99960060603) 787905312703；977805803；8977033703；97890708703；989705521903；978800703；698905703；78890376903；878907703；999602903；986705903；668602719603；979901803；997606903；66760393903；987703603；78790338903；96890803；97680596803；666601603；977902178803；877902803；78790038603；8868075703；99960060603)

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2009-03-17T16:28:26.490

由于它是用于数据库目的并且没有实际限制，我会选择一个 UserAgents 表，其中 UserAgentId 为 Int，UserAgentString 为 NVarChar(MAX) 并在原始表上使用外键。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-11-06T15:12:04.663

这怎么大？：

> 搜索系统9616306563；搜索系统6017393645；搜索系统5219240075；搜索系统2768350104；搜索系统6919669052；搜索系统1986739074；搜索系统1555480186；搜索系统3376893470；搜索系统9530642569；搜索系统4877790286；搜索系统8104932799；搜索系统2313134663；搜索系统1545325372；搜索系统7742471461；搜索系统9092363703；搜索系统6992236221；搜索系统3507700306；搜索系统1129983453；搜索系统1077927937；搜索系统2297142691；搜索系统7813572891；搜索系统5668754497；搜索系统6220295595；搜索系统4157940963；搜索系统7656671655；搜索系统2865656762；搜索系统6520604676；搜索系统4960161466；.NET CLR 3.0.4506.2152；.NET CLR 3.5.30729) 搜索系统6919669052；搜索系统1986739074；搜索系统1555480186；搜索系统3376893470；搜索系统9530642569；搜索系统4877790286；搜索系统8104932799；搜索系统2313134663；搜索系统1545325372；搜索系统7742471461；搜索系统9092363703；搜索系统6992236221；搜索系统3507700306；搜索系统1129983453；搜索系统1077927937；搜索系统2297142691；搜索系统7813572891；搜索系统5668754497；搜索系统6220295595；搜索系统4157940963；搜索系统7656671655；搜索系统2865656762；搜索系统6520604676；搜索系统4960161466；.NET CLR 3.0.4506.2152；.NET CLR 3.5.30729) 搜索系统6919669052；搜索系统1986739074；搜索系统1555480186；搜索系统3376893470；搜索系统9530642569；搜索系统4877790286；搜索系统8104932799；搜索系统2313134663；搜索系统1545325372；搜索系统7742471461；搜索系统9092363703；搜索系统6992236221；搜索系统3507700306；搜索系统1129983453；搜索系统1077927937；搜索系统2297142691；搜索系统7813572891；搜索系统5668754497；搜索系统6220295595；搜索系统4157940963；搜索系统7656671655；搜索系统2865656762；搜索系统6520604676；搜索系统4960161466；.NET CLR 3.0.4506.2152；.NET CLR 3.5.30729) 搜索系统7742471461；搜索系统9092363703；搜索系统6992236221；搜索系统3507700306；搜索系统1129983453；搜索系统1077927937；搜索系统2297142691；搜索系统7813572891；搜索系统5668754497；搜索系统6220295595；搜索系统4157940963；搜索系统7656671655；搜索系统2865656762；搜索系统6520604676；搜索系统4960161466；.NET CLR 3.0.4506.2152；.NET CLR 3.5.30729) 搜索系统7742471461；搜索系统9092363703；搜索系统6992236221；搜索系统3507700306；搜索系统1129983453；搜索系统1077927937；搜索系统2297142691；搜索系统7813572891；搜索系统5668754497；搜索系统6220295595；搜索系统4157940963；搜索系统7656671655；搜索系统2865656762；搜索系统6520604676；搜索系统4960161466；.NET CLR 3.0.4506.2152；.NET CLR 3.5.30729)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-17T16:48:54.443

没有规定的限制，只有大多数 HTTP 服务器的限制。但是请记住这一点，我将实现一个具有合理固定长度的列（使用 Google 查找已知用户代理的列表，找到最大的并添加 50%），然后裁剪任何太长的用户代理 - 任何异常即使被裁剪，长用户代理也可能足够独特，或者是某种错误或“黑客”尝试的结果。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-06-05T18:06:55.417

我今天得到了这个用户代理，溢出了我们供应商的存储领域：

> Mozilla/4.0（兼容；MSIE 8.0；Windows NT 5.1；Trident/4.0；GTB6；.NET CLR 1.1.4322；.NET CLR 2.0.50727；.NET CLR 3.0.04506.30；MDDR；OfficeLiveConnector.1.3；OfficeLivePatch.0.0； .NET CLR 3.0.4506.2152；.NET CLR 3.5.30729）

荒谬的！229 个字符？

所以采用那个尺寸，加倍，再加倍，你应该准备好直到微软的下一个错误（也许明年的这个时候）。

超过1000！

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-12-23T15:39:50.263

假设用户代理字符串的长度没有限制，并准备存储这样的值。如您所见，长度是不可预测的。

在 Postgres 中，有一种[文本](http://www.postgresql.org/docs/9.1/static/datatype-character.html)类型可以接受不限长度的字符串。用那个。

但最有可能的是，您必须在某个时候开始截断。以合理有用的增量（200、1k、4k）称其为好，然后扔掉其余的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-17T16:13:47.337

我给你标准答案：

取你能想象到的最大可能值，加倍，这就是你的答案。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-08-07T14:18:05.567

这是257

> Mozilla/4.0（兼容；MSIE 8.0；Windows NT 5.1；Trident/4.0；GTB6；.NET CLR 1.1.4322；.NET CLR 2.0.50727；.NET CLR 3.0.04506.30；InfoPath.2；.NET CLR 3.0.04506.648 ；OfficeLiveConnector.1.3；OfficeLivePatch.0.0；.NET CLR 3.0.4506.2152；.NET CLR 3.5.30729)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-06-10T21:14:04.807

并不表示用户代理可以得到多大，因为有很多答案显示了他们遇到的边缘情况，但是可以在[http://www.useragentstring.com/pages/useragentstring.php 上找到最长的答案？ name=All](http://www.useragentstring.com/pages/useragentstring.php?name=All)是 250 字节。

> Mozilla/4.0（兼容；MSIE 8.0；Windows NT 6.1；Trident/4.0；SLCC2；.NET CLR 2.0.50727；.NET CLR 3.5.30729；.NET CLR 3.0.30729；Media Center PC 6.0；Media Center PC 5.0； SLCC1；OfficeLiveConnector.1.5；OfficeLivePatch.1.3；.NET4.0C；Lunascape 6.3。

# c++ - 是否有任何忽略默认内联函数的 C++ 标准的编译器？

> ID：654923
> 
> 赞同：0
> 
> 时间：2009-03-17T16:12:15.843
> 
> 标签：c++, inline, standards-compliance

C++ ISO 标准说：“在类定义中定义的函数是内联函数。” [*](http://www.scribd.com/doc/7051349/c-Standard-IncitsIsoIec148822003)

您知道任何忽略此规则的编译器吗？

您是否知道任何不会将“内联建议”放在那里的编译器？

（请不要重复关于内联的理论，我知道 - 我需要一个实用的答案）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:17:45.940

所有编译器都可以忽略他们决定的任何内联建议。例如，如果他们认为函数太复杂，则不会内联。如果您曾经获取函数的地址，则该函数可能会在某些地方内联，但会在其他地方生成完整的函数以供地址指向。

`inline`当您在类定义中定义函数作为对编译器的建议时，请考虑隐式内联。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:21:38.457

这不是一个规则，它只是一个事实陈述。该规范只是说明该函数是内联*定义*的。这使得编译器也更容易实际内联生成的代码，但标准没有任何地方要求这样做。

它们是不同的概念。生成的代码是什么样子仅取决于编译器，标准并没有真正强加任何要求（当然除了它应该按照指定的方式运行）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T16:19:49.880

在 gcc 中，您可以使用

```
-finline-limit=n
-fno-inline 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T16:24:22.443

请参阅我对一个非常相似的问题的回答：[“内联”何时无效？（在 C 中）](https://stackoverflow.com/questions/582919/when-is-inline-ineffective-in-c/582932#582932)

总结：内联只需要允许多个定义。任何调用更改的函数都是完全可选的。

# java - 休眠分离标准

> ID：654936
> 
> 赞同：0
> 
> 时间：2009-03-17T16:15:25.820
> 
> 标签：java, hibernate, criteria, detachedcriteria

我有一个 DetachedCriteria，用于根据名称字段搜索表。我想让搜索不区分大小写，并且想知道是否有办法在不使用 HQL 的情况下做到这一点。就像是：

```
private void searchByFullName(DetachedCriteria criteria, String searchCriteria) {
    criteria.add(Restrictions.like("fullName", "%" + searchCriteria.toUpperCase() + "%"));
    criteria.addOrder(Order.asc("fullName"));
} 
```

但我想确保它在搜索时会忽略大小写，因此它生成的 SQL 应该类似于：

```
SELECT * FROM PEOPLE WHERE ? LIKE toUpper(FULL_NAME); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T16:22:19.890

有喜欢

[http://www.hibernate.org/hib_docs/v3/api/org/hibernate/criterion/Restrictions.html#ilike(java.lang.String,%20java.lang.Object)](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/criterion/Restrictions.html#ilike(java.lang.String,%20java.lang.Object))

# math - GIS 为谷歌地球在 kml 中绘制抛物线飞行路径

> ID：654940
> 
> 赞同：0
> 
> 时间：2009-03-17T16:16:08.300
> 
> 标签：math, gis, kml, google-earth

我必须在谷歌地球上显示飞行路径并且（我仍然得到确切的飞行计划路径）想要以抛物线方式显示（标记面）。从起飞到着陆点。基本上我正在寻找数学公式来计算带有高度的纬度点以显示抛物线路径。

我看到了如何使用高度参数进行抛物线视图。但是不太容易，如何从两个坐标（开始；结束）获取路径上的点。

谢谢 ！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T00:45:21.923

也许我错了，但如果我记得我的物理学是正确的，如果两点之间的距离与地球的半径相比相对较小，除了高度之外，路径只会沿着一个[大圆圈](http://en.wikipedia.org/wiki/Great_circle)。

如果您将坐标写为随时间变化的参数方程，您将得到：

```
gamma = v_horz/R * t
altitude = g * t * (T0 - t) / 2    
(where T0 = 2*v_vert/g = flight time, R = earth radius, g = earth's gravity) 
(vertical velocity = derivative of altitude = g/2*T0 - gt = v_vert - gt 
```

其中 gamma = 沿大圆弧的角度，然后是弹丸。您知道起点和终点，因此您可以使用[球面三角法](http://www.jqjacobs.net/astro/arc_form.html#formula)计算起点和终点之间的弧距 G0。G0 = 时间 T0 的伽马（当弹丸着陆时）。这告诉你 omega_horz 必须是什么（= G0*R / T0）。

然后，您可以再次使用球面三角法来计算大圆上任意点的纬度/经度。（使用相似的三角形——今天太晚了，我的大脑无法正确计算数学，抱歉）

假设：

一种。

*   与地球的半径相比，起点/终点之间的距离很小
*   所讨论的飞行是弹道轨迹（一些质量 M 仅在重力作用下上下移动，没有推力或升力）
*   我们谈论的是地球，因此您可以对半径和重力 g 做出某些假设
*   忽略空气阻力（在现实生活中祝你好运）

或者

B.

*   这是针对营销类型的，所以你只想要看起来像抛物线的东西，所以无论如何都使用 A 中的假设

* * *

**编辑：**另见这些关于[射弹轨迹](http://en.wikipedia.org/wiki/Trajectory_of_a_projectile)和[大圆距离的](http://en.wikipedia.org/wiki/Great-circle_distance)维基百科文章。

# c++ - 群集环境中的 Microsoft Exchange CDOEX

> ID：654952
> 
> 赞同：0
> 
> 时间：2009-03-17T16:20:04.887
> 
> 标签：c++, exchange-server

我们有一个 VS2005 本机 C++ 应用程序，它使用 CDOEX 和 CDOEXM 连接到 Exchange 服务器，以创建和修改多个用户文件夹的日历条目。它是一个命令行实用程序，必须安装在安装 Exchange 服务器的同一台服务器上。在集群环境中使用此实用程序的正确步骤是什么？任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-11T16:00:11.850

能不能建议你看看。 [http://msdn.microsoft.com/en-us/library/aa373130%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/aa373130%28VS.85%29.aspx) 有关故障转移群集如何工作的一般信息。但我还想指出，今后（即交易所 2007 年、2010 年）你不会获得 CDOEXM。相反，您将不得不找到某种与 powershell 集成的方法。有一些类可以从程序内部显式运行 powershell 脚本，但它们是 C#，因此您要么将所有代码迁移到 C#，要么使用一些混杂的 IJW。

# qt4 - 将自定义类型的 QVariant 转换为 QString

> ID：654953
> 
> 赞同：8
> 
> 时间：2009-03-17T16:20:07.807
> 
> 标签：qt4, qvariant

我有一个名为 Money 的自定义类，我用 Q_DECLARE_METATYPE() 声明了它。

```
class Money {
public:
  Money(double d) {
    _value = d;
  }
  ~Money() {}
  QString toString() const {
    return QString(_value);
  }
private:
  double _value;
};
Q_DECLARE_METATYPE(Money);

Money m(23.32); 
```

我将它存储在 QVariant 中，我想将其转换为 QString：

```
QVariant v = QVariant::fromValue(m);

QString s = v.toString(); 
```

变量**s**最终成为空字符串，因为 QVariant 不知道如何将我的自定义类型转换为字符串。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T18:10:57.307

好的，我找到了一种方法来做到这一点。我创建了一个名为 CustomType 的父类型，其中包含一个虚拟方法，我可以实现该方法将我的自定义类型转换为“普通”QVariant：

```
class CustomType {
public:
  virtual ~CustomType() {}
  virtual QVariant toVariant() const { return QVariant(); }
}; 
```

然后我从这里继承了我的自定义 Money 类。

```
class Money : public CustomType {
public:
  Money(double d) {
    _value = d;
  }
  ~Money() {}
  QVariant toVariant() {
    return QVariant(_value);
  }
private:
  double _value;
}; 
```

这允许我传递包含在 QVariants 中的自定义 Money 变量，以便我可以在 Qt 属性系统、模型/视图框架或 sql 模块中使用它们。

但是，如果我需要将我的自定义 Money 变量存储在数据库中（使用 QSqlQuery.addBindValue），它不能是自定义类，它必须是已知类型（如 double）。

```
QVariant myMoneyVariant = myqobject.property("myMoneyProperty");
void *myData = myMoneyVariant.data();
CustomType *custType = static_cast<CustomType*>(myData);
QVariant myNewVariant = ct->toVariant(); 
```

**myNewVariant**现在具有 double 类型，而不是 Money，因此我可以在数据库中使用它：

```
myqsqlquery.addBindValue(myNewVariant); 
```

或将其转换为字符串：

```
QString s = myNewVariant.toString(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T16:39:06.060

您确定以下工作吗？

> 返回 QString(_value);

我似乎没有找到一个`QString`接受`double`. 您必须自己在这里进行转换。Qt的方法是：

```
QString toString() const {
 QVariant d(_value);
 return d.ToQString();
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-17T16:37:52.443

如果你这样尝试会发生什么？

```
class Money {
public:
  Money(double d) {
    _value = d;
  }
  ~Money() {}
  QString toString() const {
    return _value.toString();
  }
private:
  double _value;
}; 
```

# .net - 如何始终启用引发询问智能卡密码的对话框？

> ID：654957
> 
> 赞同：2
> 
> 时间：2009-03-17T16:20:39.113
> 
> 标签：.net, vb.net, certificate

设想

我正在尝试使用证书来签署文件。我第一次签名时，操作系统会提示用户设置 PIN 的对话框，但下一次不会。出于安全原因，我需要每次签名时，操作系统都会向用户询问 PIN。有谁知道该怎么做？

这是代码：

```
''// create ContentInfo
Dim content As New ContentInfo(bytesContenido)

''// create a signer
Dim signer As New CmsSigner(certificado)

''// SignedCms represents signed data
Dim signedMessage As New SignedCms(content)

''// sign the data
signedMessage.ComputeSignature(signer, False)

''// create and return PKCS #7 byte array
Return signedMessage.Encode() 
```

在某些页面上，我发现使用`CryptSetProvParam`可以清洁别针，但到目前为止还没有工作。

该声明：

```
<DllImport("advapi32.dll", CharSet:=CharSet.Auto, SetLastError:=True)> _
Public Shared Function CryptSetProvParam(ByVal hProv As IntPtr, ByVal dwParam As Int32, ByVal pbData As Byte(), ByVal dwFlags As Int32) As Boolean

End Function 
```

调用：

```
Public punteroContexto As New System.IntPtr     ''// Obtenido usando CryptAcquireContext
Public Const PP_SIGNATURE_PIN As UInt32 = 33

If (Not CryptSetProvParam(punteroContexto, PP_SIGNATURE_PIN, Nothing, 0)) Then
    Marshal.ThrowExceptionForHR(Marshal.GetLastWin32Error)
End If 
```

错误：

> 指定的类型无效。（来自 HRESULT 的异常：0x8009000A）

还使用多线程进行测试（使用另一个线程仅用于签名）并且它不起作用。

非常感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-30T18:04:45.193

```
[DllImport("Advapi32.dll", SetLastError = true)]
public static extern bool CryptSetProvParam(IntPtr hProv, uint dwParam, IntPtr pvData, uint dwFlags);

[DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
public static extern bool CryptAcquireContext(ref IntPtr hProv,
    string pszContainer, string pszProvider, uint dwProvType, uint dwFlags);

[DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
public static extern void CryptReleaseContext(IntPtr hProv, uint dwFlags);

static public bool ClearPINCache2(RSACryptoServiceProvider key)
{
    const uint PP_KEYEXCHANGE_PIN = 32;
    const uint PP_SIGNATURE_PIN = 33;
    bool bretval = false;

    IntPtr hProv = IntPtr.Zero;

    if (CryptAcquireContext(ref hProv, key.CspKeyContainerInfo.KeyContainerName,
        key.CspKeyContainerInfo.ProviderName, (uint)key.CspKeyContainerInfo.ProviderType, 0))
    {
        if ((CryptSetProvParam(hProv, PP_KEYEXCHANGE_PIN, IntPtr.Zero, 0) == true) &&
            (CryptSetProvParam(hProv, PP_SIGNATURE_PIN, IntPtr.Zero, 0) == true))
        {
            bretval = true;
        }
    }

    if (hProv != IntPtr.Zero)
    {
        CryptReleaseContext(hProv, 0);
        hProv = IntPtr.Zero;
    }

    return bretval;
} 
```

# wordpress - 在 Wordpress 中插入指向另一篇文章的链接

> ID：654961
> 
> 赞同：0
> 
> 时间：2009-03-17T16:21:25.820
> 
> 标签：wordpress

我正在构建一个基于 Wordpress 模板的网站，并且想知道是否有一种方法可以在不输入完整 URL 的情况下将一篇文章链接到另一篇文章。如果父目录或子域发生变化，我希望能够使用不会改变的东西。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T16:25:49.553

**帖子**

要链接到帖子，请在帖子管理面板上找到目标帖子的 ID，并将其插入此链接中的“123”位置：

```
<a href="index.php?p=123">Post Title</a> 
```

**类别**

要链接到类别，请在类别管理面板上找到目标类别的 ID，并将其插入此链接中的“7”位置：

```
<a href="index.php?cat=7">Category Title</a> 
```

**页面**

要链接到页面，请在页面管理面板上找到目标页面的 ID，并将其插入此链接中的“42”位置：

```
<a href="index.php?page_id=42">Page title</a> 
```

（来自[WordPress](http://codex.wordpress.org/Linking_Posts_Pages_and_Categories#Pages)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:25:16.840

[链接帖子、页面和类别](http://codex.wordpress.org/Linking_Posts_Pages_and_Categories)

即使您使用永久链接，<a href="index.php?p=123">Post Title</a> 也应该可以工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-06-19T11:25:19.203

使用下面的代码仅通过帖子 ID 获取特定的帖子网址和标题。

将 $postid 替换为您要显示的帖子 ID。

```
$postid = 1;  
echo '<a href="'.get_permalink($postid).'">'.get_the_title($postid).'</a>'; 
```

# wpf - Best place to bring up new window in Model View ViewModel

> ID：654965
> 
> 赞同：9
> 
> 时间：2009-03-17T16:21:49.407
> 
> 标签：wpf, design-patterns, mvvm

I have an MVVM application. In one of the ViewModels is the 'FindFilesCommand' which populates an ObservableCollection. I then implement a 'RemoveFilesCommand' in the same ViewModel. This command then brings up a window to get some more user input.

Where/what is the best way to do this whilst keeping with the MVVM paradigm? Somehow doing:

```
new WhateverWindow( ).Show( ) 
```

in the ViewModel seems wrong.

Cheers,

Steve

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-13T10:26:46.037

I personally look at this scenario as one where the main window view model wants to surface a task for the end user to complete.

It should be responsible for creating the task, and initializing it. The view should be responsible for creating and showing the child window, and using the task as the newly instantiated window's view model.

The task can be canceled or committed. It raises a notification when it is completed.

The window uses the notification to close itself. The parent view model uses the notification to do additional work once the task has committed if there is followup work.

I believe this is as close to the natural/intuitive thing people do with their code-behind approach, but refactored to split the UI-independent concerns into a view model, without introducing additional conceptual overhead such as services etc.

I have an implementation of this for Silverlight. See [http://www.nikhilk.net/ViewModel-Dialogs-Task-Pattern.aspx](http://www.nikhilk.net/ViewModel-Dialogs-Task-Pattern.aspx) for more details... I'd love to hear comments/further suggestions on this.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T07:45:41.647

In the Southridge realty example of Jaime Rodriguez and Karl Shifflet, they are creating the window in the viewmodel, more specifically in the execute part of a bound command:

```
 protected void OnShowDetails ( object param ) 
    {
        // DetailsWindow window = new DetailsWindow();
        ListingDetailsWindow window = new ListingDetailsWindow();
        window.DataContext = new ListingDetailsViewModel ( param as Listing, this.CurrentProfile ) ; 
        ViewManager.Current.ShowWindow(window, true); 
    } 
```

Here is the link: [http://blogs.msdn.com/jaimer/archive/2009/02/10/m-v-vm-training-day-sample-application-and-decks.aspx](http://blogs.msdn.com/jaimer/archive/2009/02/10/m-v-vm-training-day-sample-application-and-decks.aspx)

I guess thats not of a big problem. After all, the Viewmodel acts as the 'glue' between the view and the business layer/data layer, so imho it's normal to be coupled to the View (UI)...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T19:54:48.647

Onyx ([http://www.codeplex.com/wpfonyx](http://www.codeplex.com/wpfonyx)) will provide a fairly nice solution for this. As an example, look at the ICommonDialogProvider service, which can be used from a ViewModel like this:

```
ICommonFileDialogProvider provider = this.View.GetService<ICommonDialogProvider>();
IOpenFileDialog openDialog = provider.CreateOpenFileDialog();
// configure the IOpenFileDialog here... removed for brevity
openDialog.ShowDialog(); 
```

This is very similar to using the concrete OpenFileDialog, but is fully testable. The amount of decoupling you really need would be an implementation detail for you. For instance, in your case you may want a service that entirely hides the fact that you are using a dialog. Something along the lines of:

```
public interface IRemoveFiles
{
   string[] GetFilesToRemove();
}

IRemoveFiles removeFiles = this.View.GetService<IRemoveFiles>();
string[] files = removeFiles.GetFilesToRemove(); 
```

You then have to ensure the View has an implementation for the IRemoveFiles service, for which there's several options available to you.

Onyx isn't ready for release yet, but the code is fully working and usable at the very least as a reference point. I hope to release stabilize the V1 interface very shortly, and will release as soon as we have decent documentation and samples.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T04:00:19.800

I have run into this issue with MVVM as well. My first thought is to try to find a way to not use the dialog. Using WPF it is a lot easier to come up with a slicker way to do things than with a dialog.

When that is not possible, the best option seems to be to have the ViewModel call a Shared class to get the info from the user. The ViewModel should be completely unaware that a dialog is being shown.

So, as a simple example, if you needed the user to confirm a deletion, the ViewModel could call DialogHelper.ConfirmDeletion(), which would return a boolean of whether the user said yes or no. The actual showing of the dialog would be done in the Helper class.

For more advanced dialogs, returning lots of data, the helper method should return an object with all the info from the dialog in it.

I agree it is not the smoothest fit with the rest of MVVM, but I haven't found any better examples yet.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T04:31:08.120

I'd have to say, Services are the way to go here.

The service interface provides a way of returning the data. Then the actual implementation of that service can show a dialog or whatever to get the information needed in the interface.

That way to test this you can mock the service interface in your tests, and the ViewModel is none the wiser. As far as the ViewModel is concerned, it asked a service for some information and it received what it needed.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-19T08:41:56.753

What we are doing is somethng like that, what is described here: [http://www.codeproject.com/KB/WPF/DialogBehavior.aspx?msg=3439968#xx3439968xx](http://www.codeproject.com/KB/WPF/DialogBehavior.aspx?msg=3439968#xx3439968xx)

The ViewModel has a property that is called ConfirmDeletionViewModel. As soon as I set the Property the Behavior opens the dialog (modal or not) and uses the ConfirmDeletionViewModel. In addition I am passing a delegate that is executed when the user wants to close the dialog. This is basically a delegate that sets the ConfirmDeletionViewModel property to null.

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-17T20:06:48.877

For Dialogs of this sort. I define it as a nested class of the FindFilesCommand. If the basic dialog used among many commands I define it in a module accessible to those commands and have the command configure the dialog accordingly.

The command objects are enough to show how the dialog is interacting with the rest of the software. In my own software the Command objects reside in their own libraries so dialog are hidden from the rest of the system.

To do anything fancier is overkill in my opinion. In addition trying to keep it at the highest level often involving creating a lot of extra interfaces and registration methods. It is a lot of coding for little gain.

Like with any framework slavish devotion will lead you down some strange alleyways. You need to use judgment to see if there are other techniques to use when you get a bad code smell. Again in my opinion dialogs should be tightly bound and defined next to the command that use them. That way five years later I can come back to that section of the code and see everything that command is dealing with.

Again in the few instances that a dialog is useful to multiple commands I define it in a module common to all of them. However in my software maybe 1 out of 20 dialogs is like this. The main exception being the file open/save dialog. If a dialog is used by dozens of commands then I would go the full route of defining a interface, creating a form to implement that interface and registering that form.

If Localization for international use is important to your application you will need to make sure you account for that with this scheme as all the forms are not in one module.

# flash - 动态文本不会消失

> ID：654971
> 
> 赞同：0
> 
> 时间：2009-03-17T16:22:51.620
> 
> 标签：flash, loader

我的预加载器不会消失，我在 progMC 中有任何其他图形，它会消失，但文本仍然存在“正在加载：100%”

```
function loadProgress(event:ProgressEvent):void
{
    var percentLoaded:Number = event.bytesLoaded/event.bytesTotal;
    percentLoaded = Math.round(percentLoaded * 100);
    progMC.prog.text = "Loading:"+String(percentLoaded)+"%";
    //trace("Loading: "+percentLoaded+"%");
}
function loadComplete(event:Event):void
{

    var fade_out:Tween = new Tween(progMC, "alpha", Strong.easeOut, 1,0,0.3, true);

    //trace("Complete");
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:29:14.647

你必须嵌入你的字体

如果您使用 Flash IDE，这很简单，只需单击 progMC 中的 textField 并单击 embed... 确保选择了所有要嵌入的字符集，这应该会使您的文本完美地消失

# c# - 复合应用程序库中 Unity 容器的代码在哪里？

> ID：654975
> 
> 赞同：0
> 
> 时间：2009-03-17T16:23:55.957
> 
> 标签：c#, unity-container

我正在使用复合应用程序库，我遇到了例如这一行：

```
Shell shell = Container.Resolve<Shell>(); 
```

所以我想**看看构成 Resolve 方法的代码**。

所以我在 Visual Studio 中打开 CompositeApplicationLibrary_Desktop.sln。

我找到了 UnityBootstrapper.cs 之类的类，但**我在任何地方都找不到 UnityContainer 类的代码**。我找到了对它的引用，例如：

```
UnityContainer container = new UnityContainer(); 
```

但是如果我右键单击“UnityContainer()”并选择“转到定义”，**我得到的只是关于这个类的元数据**。

在哪里可以查看 UnityContainer 类的 Resolve 方法的代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T16:36:41.527

您也可以只[下载](http://msdn.microsoft.com/en-us/library/dd203104.aspx)Unity 应用程序块。该软件包中有一个 zip 文件，其中仅包含 Unity 源代码。

肯定可以在那里找到 Resolve 方法（例如，该方法调用 DoBuildUp()...）

# c# - 是否可以从委托中别名/引用委托？

> ID：654987
> 
> 赞同：2
> 
> 时间：2009-03-17T16:26:31.067
> 
> 标签：c#, .net, generics, delegates

我正在重组opur代码以使用泛型。我们确实使用（出于必要，此处无法更改）自己的代码来附加/分离/迭代/调用委托。在有声明自己的类 X、Y、Z 之前：

```
public delegate void Event_x_Delegate(ref ComParam pVal, out bool result); 
```

目前我正在将此委托传递给泛型类：

```
public sealed class Event_X_Handling  : BasicEvent<Event_X_Handling.Event_x_Delegate> 
```

与 BasicEvent 蜜蜂

```
public abstract class BasicEvent<DELEGATE> : Loggable
    where DELEGATE: class { ... 
```

这工作得很好，所以我对附加/分离功能进行了概括。

但现在我也想概括一下迭代/调用。由于 X、Y、Z 仅在“ref ComParam pVal”中有所不同，因此这样的效果很好：

```
public abstract class BasicEventListener<EVENTPARAM1> :
    BasicEvent<BasicEventListener<EVENTPARAM1>.BasicDelegate<EVENTPARAM1>> {

    #region TYPES

    public delegate void BasicDelegate<PARAM1>(ref EVENTPARAM1 pVal, out bool result);

    #endregion 
```

X,Y,Z 变为：

```
public sealed class Event_X_Handling  : BasicEventListener<ComParam> 
```

但是问题就在眼前：附加/分离现在可以使用*BasicEventListener.BasicDelegate*。但是代码很多。指*Event_X_Handling.Event_x_Delegate*，因为他们不幸使用 NET1.1 语法来创建委托（作为类型化的*Event += new Delegate_X(_listen)*）。

简而言之：有没有办法将*Event_x_Delegate*别名为*BasicDelegate*？我真的看不到任何其他可能性。

 *PS：当然，我看到通过将基类分解为迭代/调用中的动态调用，我可以在不引入*BasicDelegate*的情况下实现它。但这不是很优雅的恕我直言。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T17:41:34.770

Perahps`using`别名对您有用吗？

```
using System;

using IntFunc = System.Func<int>;

namespace DelegateAlias
{
    class Program
    {
        static int foo() { return 314; }
        static void Main(string[] args)
        {
           IntFunc f = foo;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:54:53.213

不，没有等价物`typedef`（我认为这是您所要求的）。

我不得不说，搜索和替换可能是你的朋友！

# .net - 反序列化没有类型引用的会话对象？

> ID：654988
> 
> 赞同：3
> 
> 时间：2009-03-17T16:26:56.480
> 
> 标签：.net, asp.net, serialization

我有一个 POCO（普通的旧 clr 对象）存储在会话中，并且希望能够从另一个进程（B）中引用该对象的属性。我不希望独立进程 (B) 需要对定义 poco 类的 dll 的引用。是否可以在不引用对象类的情况下将保存的对象（在会话中）转换为可读的对象（例如 xml）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:34:12.827

您不能需要程序集来获取对象的元数据，也许您可​​以避免对 dll 的引用并使用反射。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:37:38.013

您必须创建自己的自定义代码来序列化和/或反序列化对象。

如果没有对程序集的引用，.NET 就没有为您完成工作所需的元数据。

您可以在生成的 XML 中添加一个属性来指定对象类型。

```
<Object Type="1">
    <Property1>Value</Property1>
</Object> 
```

当然，目标代码需要知道如何处理此类型属性，但您不需要引用实际的 .NET 程序集。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T16:36:25.550

如果您只需要对象的快照，那么可以，您可以简单地序列化它（或只是您感兴趣的属性），然后将序列化的数据传递给进程 B。 XmlSerializer 类可能提供了最简单的序列化方法对象，然后进程 B 可以使用任何标准 XML 解析器读取数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T17:09:46.190

忘记如何序列化它 - 你将如何在另一个进程中*检索数据。*这另一个过程是什么？如果它不是另一个 ASP.NET 页面，那么它将无法访问 Session 状态！

# internet-explorer-7 - Flash Player 10 不会从 IE 7 卸载

> ID：654999
> 
> 赞同：0
> 
> 时间：2009-03-17T16:30:12.727
> 
> 标签：internet-explorer-7, activex, flash

我的网络上有一台计算机，其中 Flash Player 10 ActiveX 控件安装在 IE7 中被搞砸了，并且不被 javascript 识别为 Flash Player 10，因此您访问的任何试图识别您的 Flash 播放器的网站都会警告您您需要更新，有时只显示替代内容（例如，SWFObject 不会加载 Flash，因为它没有检测到足够新的 Flash Player 版本）。

所以，我试图卸载它。我在 Windows 控制面板中卸载了与 flash 相关的所有内容，甚至重新启动了计算机。现在控制面板中没有 Flash 任何东西的迹象，但是当我去一些网站时，Flash 仍然会在 IE 中播放，并警告 Flash 播放器需要更新（如果我右键单击 Flash 对象，它会说“关于 Adob​​e Flash Player 10”）。

那么问题来了：如何手动卸载 Flash 播放器？或者：你知道是什么导致它出错和愚蠢吗？

谢谢！:)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T16:35:40.903

在 32 位窗口上：

```
cd /d %windir%\system32\macromed\flash 
```

在 64 位窗口上：

```
cd /d %windir%\syswow64\macromed\flash 
```

这是闪存二进制文件所在的位置。您可以手动删除它们，或在此目录中运行卸载实用程序。为此，您需要关闭所有正在运行的浏览器实例。

```
cd "..\..\Downloaded Program Files" 
```

这是保存 ActiveX 安装数据的地方。您应该会看到一个名为“swflash.ini”的文件，但如果您重新安装了很多文件，它可能位于一个子目录或多个子目录中（IE 会在出现名称冲突时创建一个子目录）。也删除此文件的所有实例。

Flash 的注册表中仍然会有条目，但如果您打算重新安装它们应该没问题。否则，您可以加载 regedit 并搜索“flash”并手动删除看起来不错的键。你应该先导出你的注册表，以防你不小心删除了你不应该有的东西。***********************************