# StackOverflow 问答 000389000-000389999

# css - 如何在保持 2 列的 ContentPlaceholder 中排列 2 列 div？

> ID：389021
> 
> 赞同：0
> 
> 时间：2008-12-23T14:41:21.117
> 
> 标签：css

我有一个正在开发的 ASP.NET 站点。布局非常基本。母版页有一个标题，横幅下方有一个水平菜单，占据整个宽度。左侧是导航窗格，150 像素宽，带有图片和一些外部链接。宽度的其余部分是 ContentPlaceholder。下面是页脚。

在默认页面中，母版页的内容有几个 div。一个用于“新闻”，一个用于“常见问题解答”，一个用于“截止日期”，另一个用于“每日图表”。每个都是 450 像素宽，我会用适当的“float:left;”来设置它们。和“浮动：对；” 所以左边的内容“栏”是新闻，然后是常见问题，右边栏是截止日期和图表。如果用户将浏览器缩小太多，截止日期和图表将被推送到新闻和常见问题解答下。

现在我被指示改变行为。现在，如果用户缩小浏览器的范围，截止日期和图表应该“站稳脚跟”并保留为第二列，用户必须使用水平滚动条才能正确查看它们。

我认为使用“最小宽度：950px;” 在整体内容 div 上会这样做，但是当我缩小浏览器时，内容 div 上的“浮动：右”最终会推动导航窗格下的整个内容部分，当我进一步缩小浏览器时，截止日期和图表 div 仍然是被推送到新闻和常见问题解答下。

我知道我错过了一些简单的东西——比如“无论如何都要保持正确”的属性——以及锚或其他东西。谷歌搜索示例并没有太大帮助，因为我认为我没有在搜索中输入正确的词。

提前感谢您的任何建议。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T14:53:22.013

听起来很异端，到目前为止，最简单的方法是丢弃 div 并使用表结构。

下面是一个完整的例子。只需将其保存为 html 文件并在浏览器中预览即可。顺便说一句，您可能会使用不同的文档类型来查看它们如何影响输出。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
    <title>Untitled</title>
<style>
.box { width:250px;float:left;border: solid 1px green;}
.outer{width:600px;}
</style>    
</head>

<body>
<div class="outer">
<div class="box" style="height: 200px">Hello World!</div>
<div class="box" style="height: 300px">Hello World!</div>
<div class="box" style="height: 100px">Hello World! asd asdfasfd asdjasd hyasydufuasydf auysdfaysdfuaysdfu yasdufy ausdyf aiusdyf aiusydfuasdfasdf asf</div>
<div class="box" style="height: 50px">Hello World!</div>
</div>
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T15:11:00.090

除非我有误解，否则无论浏览器高度/宽度发生什么，您都希望页面保持不变。如果是这种情况，您可以简单地使用绝对位置并在 css 中设置绝对顶部和左侧像素设置。所以你的新闻 css 会是这样的

```
position: absolute;
top: 0px;
left: 0px;
... 
```

那么您的截止日期将是：

```
position: absolute;
top: 0px;
left: 450px;
... 
```

等等。您可能必须使用相对位置或根据您的标题设置顶部偏移量和基于链接 div 的左侧偏移量（您已经说过是 150），但是如果您希望页面保持不变，那是您最好的选择. 如果您对此有任何问题，请告诉我。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T15:52:27.213

这适用于我，在 FF3 和 IE6 中。

```
 <html>
    <head>
        <title></title>
    <style>
    .content_section{width:450px;border: solid 1px green;}
    .nav{width:150px; border: solid 1px yellow; float: left;}
    .content_container{width: 950px; border: solid 1px blue; float: left;}

    </style>    
    </head>

    <body>
    <div style="width: 1104px;">
        <div class="nav">
                Navigation here<br />Navigation here<br />Navigation here<br />Navigation here<br />Navigation here<br />Navigation here<br />Navigation here<br />Navigation here<br />
        </div>
        <div class="content_container">
            <div style="float: left;">
                <div id="news" class="content_section">news<br />news<br />news<br />news<br />news<br />news<br />news<br />news<br /></div><br />
                <div id="faq" class="content_section">faq<br />faq<br />faq<br />faq<br />faq<br />faq<br />faq<br />faq<br />faq<br /></div>
            </div>
            <div style="float: right;">
                <div id="deadlines" class="content_section">deadlines<br /></div><br />
                <div id="chart" class="content_section">chart<br />chart<br />chart<br />chart<br />chart<br />chart<br />chart<br />chart<br />chart<br /></div>
            </div>
        </div>
    </div>
    </html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T16:42:34.570

当你厌倦了自己管理这一切时，你应该看看一个不错的 CSS 网格系统。

这里有两个：

*   [蓝图 CSS 网格](http://developer.yahoo.com/yui/grids/)
*   [雅虎 CSS 网格](http://www.blueprintcss.org/)

这些系统使做你所说的事情变得微不足道。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T13:53:26.393

最简单的答案是将所有东西都包裹在一个容器中，并给容器一个宽度，使其永远不会缩小。例子

```
<div id="container">
  <div id="header"></div>
  <div id="nav"></div>
  <div id="leftContent"></div>
  <div id="rightContent"></div>
  <div id="footer"></div>
</div> 
```

这允许左右内容完全是任何高度。

# nhibernate - NHibernate：如何在一对一映射上启用延迟加载

> ID：389026
> 
> 赞同：16
> 
> 时间：2008-12-23T14:42:25.250
> 
> 标签：nhibernate, nhibernate-mapping

nhibernate 中的一对一关系可以延迟加载“假”或“代理”。我想知道是否有人知道一种方法来进行懒惰的一对一映射。

我通过使用映射到私有字段的惰性集并让公共属性返回该集的第一个结果，制定了一个技巧来实现相同的结果。它有效，但不是最干净的代码......

提前致谢！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-23T16:28:14.317

除非关联是强制性的，否则不支持延迟加载一对一。请参阅[此处](http://www.hibernate.org/162.html)了解原因。

归结为这样一个事实，即为了确定关系的另一方是否存在 (N)Hibernate 必须访问数据库。由于您已经对数据库进行了访问，因此您不妨加载完整的对象。

虽然在某些情况下访问数据库只是为了查看相关对象是否存在而不实际加载对象是有意义的（如果相关对象非常“重”），NHibernate 目前不支持它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T14:46:41.463

据我所知，没有一种简单的方法可以延迟加载一对一。我希望我是错的，但上次我检查是这样的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-16T13:21:00.850

有办法的想法。[这里](http://gnschenker.blogspot.com/2007/06/one-to-one-mapping-and-lazy-loading.html)有详细描述：

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="NHibernateTest" namespace="NHibernateTest">
  <class name="Person" >
    <id name="PersonID" type="Int32">
      <generator class="identity" />
    </id>
    <property name="LastName" type="String" length="50" />
    <property name="FirstName" type="String" length="50" />
    <many-to-one name="Photo" class="PersonPhoto" />
  </class>

  <class name="PersonPhoto">
    <id name="PersonID" type="Int32">
      <generator class="foreign">
        <param name="property">Owner</param>
      </generator>
    </id>
    <property name="Photo" type="BinaryBlob" />
    <one-to-one name="Owner" class="Person" constrained="true" />
  </class>
</hibernate-mapping> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-16T23:19:22.810

我尝试了上面 Artem Tikhomirov 使用的示例。我不断收到照片列不存在的错误。看了[这个](https://www.hibernate.org/162.html)之后，我发现映射有点不对劲。当我更改多对一映射以指定列名时，如下所示：

多对一名称=“照片”列=“PersonID”类=“PersonPhoto”唯一=“真”

我让它工作。我希望这对某人有帮助:o)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-01-24T12:55:37.457

在这里阅读答案后，我设法让它工作。**我只是要添加这个示例，因为我正在使用Constrained= False**的一对一关系，并且因为它是通过代码示例进行映射

两个班：

```
public class Pedido:BaseModel
{
    public virtual BuscaBase Busca { get; set; }
}

public class BuscaBase : BaseModel
    {       
        public virtual Pedido Pedido { get; set; }
    } 
```

映射：

```
public class PedidoMap : ClassMapping<Pedido>
{
    public PedidoMap()
    {
         Id(x => x.Id, x => x.Generator(Generators.Identity));            

         ManyToOne(x => x.Busca, m => 
         { 
             m.Cascade(Cascade.DeleteOrphans);
             m.NotNullable(true); m.Unique(true);
             m.Class(typeof(BuscaBase));
         });    
    }
}

public class BuscaBaseMap : ClassMapping<BuscaBase>
{
    public BuscaBaseMap()
    {            
        Id(x => x.Id, x => x.Generator(Generators.Sequence, g => g.Params(new { sequence = "buscaefetuada_id_seq" })));

        OneToOne(x => x.Pedido, m =>
        {
            m.Lazy(LazyRelation.NoProxy);
            m.Constrained(false);
            m.Cascade(Cascade.None);
            m.Class(typeof(Pedido));
        });            
    }
} 
```

注意：我使用的是一对一映射`m.PropertyReference(typeof(Pedido).GetProperty("Busca"));`，但这不适用于延迟加载。您必须使用 Class 指定关系

简要介绍一下此处使用的 Constrained = False，“Pedido”对象可能不存在于“BuscaBase”对象中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-02-10T23:19:42.670

对我有用的是以下内容（与@Daniel 非常相似），但我发现有必要在映射的两端指定 LazyRelation.NoProxy。

```
 public class Person
    {
        public virtual int Id { get; set; }

        public virtual string Name { get; set; }

        public virtual PersonDetails Details { get; set; }

        public class PersonMap : ClassMapping<Person>
        {
            public PersonMap()
            {
                Id(x => x.Id, m =>
                {
                    m.Generator(Generators.Native);
                });

                Property(x => x.Name);

                OneToOne(x => x.Details, m =>
                { 
                    m.Lazy(LazyRelation.NoProxy);
                    m.Cascade(Cascade.Persist); 
                });
            }
        }
    }

    public class PersonDetails
    {
        public virtual int Id { get; set; }

        public virtual string ExtraDetails { get; set; }

        public virtual Person Person { get; set; }

        public class PersonDetailsMap : ClassMapping<PersonDetails>
        {
            public PersonDetailsMap()
            {

                Id(x => x.Id, m =>
                {
                    m.Generator(Generators.Native);
                }); 

                Property(x => x.ExtraDetails);

                ManyToOne(x => x.Person, m =>
                {
                    m.Lazy(LazyRelation.NoProxy);
                    m.Unique(true);
                    m.NotNullable(true); 
                });
            }
        }
    }

using var session = NhHelper.OpenSession();

var person1 = new Person();
person1.Name = "A";

var person1Details = new PersonDetails();
person1Details.ExtraDetails = "A details"; 

person1.Details = person1Details;
person1Details.Person = person1;

session.Save(person1);
//because of PersonMapping's Cascade.Persist it is not necessary to manually save person1Details object.

using var session = NhHelper.OpenSession();
foreach(var person in session.Query<Person>()) {
  Console.WriteLine(person.Name);  //<-- does not load PersonDetails unless it's property is accessed
} 
```

*   NHibernate 5.3.5
*   Npgsql 5.0.3（Postgresql 数据库）。

# ruby-on-rails - 是使用 sql 转储创建测试数据库时加载的固定装置

> ID：389028
> 
> 赞同：3
> 
> 时间：2008-12-23T14:42:37.200
> 
> 标签：ruby-on-rails, fixtures

由于一些非标准的表创建选项，我被迫使用 sql 转储而不是标准的 schema.rb（即我在 environment.rb 中取消了这一行的注释`config.active_record.schema_format = :sql`）。我注意到，当我使用 sql 转储时，我的装置似乎没有加载到数据库中。一些数据已加载到其中，但我不确定它来自哪里。这是正常的吗？如果这是正常的，谁能告诉我这些其他数据来自哪里？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2019-07-12T02:01:04.893

这是一个非常古老的问题，但即使在将近 10 年后，答案仍然是一样的 - 似乎固定装置忽略了模式格式并且被硬编码以查找 YAML 文件。这是 Rails 5.2-stable 的 Rake 任务：

[https://github.com/rails/rails/blob/5-2-stable/activerecord/lib/active_record/railties/databases.rake#L198](https://github.com/rails/rails/blob/5-2-stable/activerecord/lib/active_record/railties/databases.rake#L198)

第 214 行用于`Dir["#{fixtures_dir}/**/*.yml"]`查找文件，因此只会`.yml`读取。

解决方案围绕着将您的 SQL 固定装置加载到原本为空的数据库中，然后使用[yaml_db gem或类似](https://github.com/yamldb/yaml_db)[本博客文章](https://yizeng.me/2017/07/16/generate-rails-test-fixtures-yaml-from-database-dump/)中描述的内容将它们转储为 YAML 。由于指向博客文章的链接通常很快就会消失，因此我复制了以下来源：

```
namespace :db do
  desc 'Convert development DB to Rails test fixtures'
  task to_fixtures: :environment do
    TABLES_TO_SKIP = %w[ar_internal_metadata delayed_jobs schema_info schema_migrations].freeze

    begin
      ActiveRecord::Base.establish_connection
      ActiveRecord::Base.connection.tables.each do |table_name|
        next if TABLES_TO_SKIP.include?(table_name)

        conter = '000'
        file_path = "#{Rails.root}/test/fixtures/#{table_name}.yml"
        File.open(file_path, 'w') do |file|
          rows = ActiveRecord::Base.connection.select_all("SELECT * FROM #{table_name}")
          data = rows.each_with_object({}) do |record, hash|
            suffix = record['id'].blank? ? conter.succ! : record['id']
            hash["#{table_name.singularize}_#{suffix}"] = record
          end
          puts "Writing table '#{table_name}' to '#{file_path}'"
          file.write(data.to_yaml)
        end
      end
    ensure
      ActiveRecord::Base.connection.close if ActiveRecord::Base.connection
    end
  end
end 
```

**上述代码由 Yi Zeng 于 2017 年 7 月 16 日发布。**你可以把它放在一个名为`lib/tasks/to_fixtures.rake`. 我将我的 SQL 夹具数据加载到原本为空/干净的测试模式数据库中，然后运行`RAILS_ENV=test bundle exec rake db:to_fixtures`​​. 它在 Rails 5.2.3 下对我来说按原样工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T15:57:59.463

If you are loading the DB from the script you dumped, that should be all that is in there. If you see anything else I would try dropping the db and recreating it from the script to make sure.

Also, if you just want to load the fixtures, you can run:

```
rake db:fixtures:load 
```

Update:

You may want to look for a way to include your options in the migrations. In my experiance it nearly always pays off to do things the rails way. If it helps, I would add custom options for using mysql cluster by using the :options option on create table:

```
class CreateYourTable < ActiveRecord::Migration
  def self.up
    create_table :your_table, :options => "ENGINE=NDBCLUSTER" do |t|
    #...
  end 
end 
```

# .net - 如何减少 WPF 应用程序的内存使用量

> ID：389047
> 
> 赞同：11
> 
> 时间：2008-12-23T14:53:04.947
> 
> 标签：.net, wpf, multithreading, memory-management

我正在开发一个使用 WPF 用 C# 编写的小书签管理应用程序。它只是位于系统托盘中，并且 99% 的时间都处于空闲状态。最近我查看了任务管理器，发现它使用了大约 25 兆的内存（在第一次激活之前大约 12 兆），我认为这对于一个大部分时间什么都不做的应用程序来说有点多。这让我想知道是否有任何方法可以通过禁用可选的 WPF 功能来减少内存使用量。

我发现了一个可能导致某些事情的事实，尽管我不知道有什么方法可以利用它。.NET 中的线程每个大约需要 1 meg，事实证明我的应用程序使用了大约 6/12 个线程（在第一次激活之前和之后）。这占我内存使用量的一半，这是相当重要的。我不直接产生任何新线程，但我不知道 WPF 以及 .NET 的其他部分如何将线程用于不同的任务，所以我发现很难对此做任何事情。将事件用于与 GUI 不直接相关的内容，例如这会产生新线程吗？

所以我想我的问题是双重的，一般来说，如何减少 .NET/WPF 应用程序的内存使用，以及如何最大限度地减少产生的线程数量？请注意，我并没有过多考虑诸如[此答案](https://stackoverflow.com/questions/60652/common-memory-optimization#60693)中提出的小细节，而是如何设计整个应用程序中的低内存使用率。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T15:00:52.153

不幸的是，根据我的经验，对于我制作的小型 WPF 应用程序，~25MB 是我见过的最低值，至少在 Windows XP 上是这样。我认为即使是空模板 WPF 应用程序也需要大约 20MB。你在什么操作系统上运行？

Windows Vista 是一个更好的故事，对于一个空模板 WPF 应用程序，您可能会看到大约 13-15MB。

对于您的应用程序使用 6-12 个线程并且仅使用 ~25MB，我会说您做得很好。:-)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T15:22:15.263

如果它是一个系统托盘应用程序，您可以在 WinForms（甚至 C++）中实现该程序的一部分，并且仅在用户双击您的图标时才生成 WPF 应用程序。这样，您只需在实际使用时为内存付费。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T15:33:09.857

不确定这是否有帮助，但在 MS Visual C++ 中，默认堆栈大小为 1 MB，并且可以使用编译器选项设置为您想要的任何值。显然，C# 应用程序继承了这个默认大小（因此每个线程至少占用 1MB）。但是当我执行“csc /？”时，似乎没有任何设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T15:49:01.043

.NET/Java 应用程序的一个事实是 CLR/JVM 将[分配比实际需要/使用的更大的堆内存](http://blogs.technet.com/markrussinovich/archive/2005/04/16/the-coming-net-world-i-m-scared.aspx)。他们通常不太愿意释放分配给 OS 的资源，除非 OS 物理内存不足。

但是，[内存管理确实是一个困难的话题](http://blogs.technet.com/markrussinovich/archive/2008/11/17/3155406.aspx)。问题是：如何定义应用程序的[内存使用量](http://msdn.microsoft.com/en-us/library/ms998579.aspx)？总分配的虚拟内存？总工作集？私人工作集？在堆中使用内存？堆分配？最小值、峰值还是平均值？

您可以做的一件事是使用[CLR Profiler](http://msdn.microsoft.com/en-us/library/ms979205.aspx)检查是否分配了过多的堆。您可以尝试通过花费内存消耗时间来优化它，以防止堆发光过多。

# macos - Mac 浏览器 - 用于 Mac 的 IE5.x 正式死了吗？

> ID：389050
> 
> 赞同：1
> 
> 时间：2008-12-23T14:55:12.430
> 
> 标签：macos, internet-explorer

我很少使用 Mac，所以我的曝光率很低，但我可以安全地假设 Mac 上的 IE 已经死了吗？

我知道微软没有进一步开发它，并且 Firefox、Safari（Opera 和 Camino）都在 Mac 上运行（从我的统计数据来看，它们是最常用的，按此顺序）......

所以问题是：它死了吗？如果是这样，它是什么时候死的？

我仍然看到带有 Mac IE hacks 的 CSS 模板......但我认为是时候摆脱这些负担了。我对吗？

PS 对于托管大型商业网站的任何人，我都会对使用 Mac IE 的客户的百分比感兴趣。*（客户是实际购买某物的用户，而不仅仅是网络开发人员 ping amazon.com 以查看其外观）*

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-23T15:08:03.730

它死了。我刚刚调出这个月的报告，发现 350 万次点击中有 9 次点击（约 0.0000257%）。

如果您需要死亡时间，我会说是在 2006 年，当时微软[发布了一份声明](http://en.wikipedia.org/wiki/Internet_Explorer_for_Mac)，敦促用户“迁移到更新的网络浏览技术，如 Apple 的 Safari”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T15:07:28.990

是的。赞美主。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T15:08:03.980

请参阅本文档。

[http://support.microsoft.com/gp/lifesupsps/](http://support.microsoft.com/gp/lifesupsps/)

Mac IE 的最高版本是 5.2.3。

还有更多：

[http://en.wikipedia.org/wiki/Internet_Explorer_5#Apple_Macintosh](http://en.wikipedia.org/wiki/Internet_Explorer_5#Apple_Macintosh)

高温高压

科尔比非洲

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T15:04:17.030

我认为Mac上的IE已经死了。作为一个长期使用 Mac 的用户，我认为没有人真正经常使用这个浏览器。

根据这个统计[http:](http://www.upsdell.com/BrowserNews/stat.htm) //www.upsdel​​l.com/BrowserNews/stat.htm 使用百分比低于 0.3%。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T14:58:35.327

一年多前，我曾在一家大型商业网站工作，Mac 上的 IE5.5 使用率低于 0.5% - 那是在一个许多内部用户使用该浏览器的组织中（我们不得不支持它）

我想说，除非您所针对的人群特别有可能使用它，否则我真的不会打扰。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T15:18:34.147

我在 mac 上看到 0.22% 的 IE 使用率。所以，我也认为它已经死了。我在 Opera 上也只看到 0.23%。

*   每月访问次数为 10,025，点击次数为 22。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-24T00:05:00.090

我当时真的很喜欢 Mac IE，并且仍然认为它是老式调制解调器冲浪者最好的浏览器之一，并且它包含的功能仍然没有在其他地方复制。

尽管如此，当 Safari 2 推出时，Mac IE 已经太长了，从未更新过，并且不再与缓慢发展的 Aqua 外观和感觉相匹配。最后几个忠实用户放弃了它。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-23T14:58:56.400

它在 os x 出现的时候就死了。我还没有看到它已经使用了很多年，我会说它可以安全地假设它不再被使用了。我不认为它被移植为原生 os x 应用程序，并且较新的 os x 版本无法运行非原生应用程序。

# java - Java 是开发跨平台 GUI 应用程序的最佳语言吗？

> ID：389051
> 
> 赞同：30
> 
> 时间：2008-12-23T14:55:42.600
> 
> 标签：java, user-interface, desktop-application

为了“最好”，我打算让代码不需要或需要很少的平台特定调整。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-23T15:00:59.940

我强烈推荐使用 Java 进行跨平台 GUI 开发。[特别是，我推荐Netbeans IDE](http://www.netbeans.org/)附带的 GUI 构建器。它非常简单且非常强大。您可以通过点击和拖放来创建 GUI，并轻松自定义各种按钮和其他组件所执行的操作。

我更喜欢 Python 作为一门语言，但没有任何用于 GUI 开发的免费工具能与此相近，而且我使用的其他语言似乎也是如此。（我应该指出，[QT](http://trolltech.com/products/)拥有出色的 GUI 开发人员，可以开发各种语言，例如 C 和 Python，但它仅在用于开源项目时是免费的。）

编辑：QT 最近被重新授权为 LGPL，因此您可以在商业应用程序中自由使用它。用于此 (PyQT) 的 Python 绑定尚未重新授权，但已创建另一个名为[PySide的项目来提供 Python QT 绑定。](http://www.pyside.org/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-09-24T08:38:49.173

我个人鄙视模拟 Java GUI 所在的本机 GUI 的整个概念。无论你走到哪里，都不必在家，而是让你到处都是游客，经常需要翻译。Eclipse GWT 是一个更好的工具包，可以更好地利用本地资源，但它仍然认为人们喜欢编写 Java 代码，讨厌使用 Java 应用程序，想想看：你喜欢桌面上的哪些 Java 应用程序？

在我看来，Tk 在您选择运行它的任何操作系统上都同样丑陋和受限，Qt 也是如此。

Mono 需要一个很好的尝试，因为它是回答“为什么 Linux 很烂”的问题的一种方式，如果你还记得那篇旧帖子 bi Miguel de Icaza。Mono 带有一套成熟的小部件和 API，并且不会试图限制您可以做的事情，以便为您提供可移植性。

Silverlight 接近于可移植性并且具有出色的界面定义语言，但缺乏对系统的访问权限，即使在同一台机器上，您也必须将应用程序拆分为服务器和 UI 以克服它。

Adobe AIR 是一条狗，本地系统访问并不容易。

如果可以选择，我倾向于完全避免使用 GUI，并尝试使用 Web 服务器，甚至是本地 Web 服务器，以及 Json、JQuery 和所有这些东西。我发现我可以有更多的选择，并且比使用原生小部件更有效率。这结合了使用真实语言服务器端的优势和 GUI 中 JavaScript 的奇妙无序和蔼可亲。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T23:42:33.733

是的：使用 Eclipse RCP。您不仅可以编写跨平台应用程序，还可以使用它编写多语言应用程序。SWT 为多个平台和窗口系统提供本机外观。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-09-24T04:51:40.040

所以据我了解，目前还没有真正的跨平台高级语言和 GUI 工具包。

1.  Java 是跨平台的，SWT 和 Swing 中的 GUI 看起来都不错，当您真的努力调整它们的像素精度并为支持的平台提供外观修改时。目前有一些优秀的 GUI 设计师，但没有 15 年前的 OpenStep 那样伟大。

2.  QT 现在是 LGPL 的，只要您只动态链接到它。好吧，但是 QT 有自己的一系列问题，并且是 C++ 的超集。您必须针对 QT-hacked 编译器进行编译，而不是针对通用 C++ 编译器。

3.  没有尝试wxWidgets，但从它的外观来看，它可以工作，但根本不是高级工具包！

4.  似乎可以选择用 C# 和开源 .NET 编写并通过 Mono 在 Windows 以外的其他平台上运行它......没有尝试，但在我看来，这只是将 Microsoft 移植到其他平台上。

5.  有 GNUstep，但现在它正在寻找我，就像它只是由一些开源极客粉丝开发的一样。看到 Mac OS X 之外的 OpenStep 堆栈真的很有趣，但现在这在我看来是不可行的。

即使是 Java，虽然它是自包含的，但目前也没有提供出色的 GUI 设计器功能。在开始学习如何使用 SWT 编码时，我曾经使用过 GUI 设计器工具，现在我发现自己手动编码，这确实不错，但确实应该没有必要。但那是几年前的事了，我得再试一次。

您当然可以用一种语言（Java 或 C/C++，如果您想要速度）创建跨平台应用程序核心和服务代码，创建类似服务器或 unix 工具的东西，然后从您创建的 GUI 连接到它每个所需的平台都使用自己的工具。结果是 GUI 是平台原生的，利用了平台的特性，并且为每个所需的平台创建应该相当简单。（Mac 上的 Cocoa 和 Windows 上的 .Net 为它们原生的平台提供了丰富的功能）。

我们将不得不研究这种理想解决方案的稳健性和成熟度。它应该有良好的商业和社区支持，并且现在已经相当发展，因此这些工具的未来实现将为我们提供的不仅仅是所有受支持平台的最低共同点，而是利用跨平台工具包括并采用相关平台原生的精心设计的概念和丰富的功能，并跨平台分发。

只有这样，跨平台开发才能真正可行并被大量采用。

建议？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T14:59:20.050

Java 确实不错，但我最近通过[PyQt4使用 Python 和](http://wiki.python.org/moin/PyQt4)[Qt](http://trolltech.com/products)做得很好。我发现我完成工作的速度也比在[Swing](http://en.wikipedia.org/wiki/Swing_(Java))或[SWT](http://www.eclipse.org/swt/)中更快。

到目前为止，不需要针对特定​​平台进行调整，并且 Qt4 小部件在不同平台上看起来都不错。Qt GUI 构建器非常好，使用 Python 可以轻松集成一些其他跨平台框架（特别是[VTK](http://vtk.org)、[scipy-cluster](http://code.google.com/p/scipy-cluster/)和一些[SWIG](http://www.swig.org/)包装的对象，用于与性能工具输出的文件进行交互）。

请注意，Qt 不是免费的，除非您在开源项目中使用它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-18T14:04:15.300

只要有人正确定义了**“平台独立性”**，**Java 就是最好的。**

有些人认为 C# 是最好的，但那些人似乎误解了“平台独立”这个词；）

*注意：我指的是只要微软和 Novel 遵守约定，C# 就可以移植到 Linux/Unix 上。社区本身永远无法维护 .NET 这样庞大的平台*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T15:09:09.937

如今，有许多语言可以让您高效地创建跨平台 GUI 应用程序。Java、Python、Tcl/tk、C#...

我认为您需要更多地定义应用程序的要求，例如：

*   UI 是基于 Web 还是基于桌面？
*   应用程序是大还是小？
*   它会具有某种“扩展”功能（例如插件）吗？
*   它会在网络上运行吗？它可能是分布式/负载平衡的吗？

该列表可以永远持续下去，确定有关您的应用程序的定义点，并开始基于整体研究该语言。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-12-14T14:22:24.570

对于原生二进制文件，wxWidgets 是一个方便的解决方案。

我会告诉你，在用户体验方面，它甚至比 Java 还要好。尽管您可以让 Java 中所有平台的表示层看起来几乎相同，但它们看起来都像 Java。另一方面，wxWidgets 让用户感觉像是一个特定于平台的构建（确实如此），但是您可以使用相同的代码为多个平台（至少是主要平台）编译。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-03T19:09:17.827

我还认为 Mono 是平台独立性和优秀 IDE 工具的有力竞争者。Java 的性能在桌面上很糟糕。只需检查[http://www.codeproject.com/KB/dotnet/RuntimePerformance.aspx](http://www.codeproject.com/KB/dotnet/RuntimePerformance.aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-23T14:58:42.407

我认为这取决于您计划定位的平台类型。Java 将拥有最多的带有 VM 的平台。但是，如果您只想使用 Windows 和 Linux，则可以使用 C#（在 linux 上使用 mono）。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2008-12-23T14:59:39.317

根据你的定义，没有。即使使用最新的图形库，您也可以期望在不同平台上进行大量测试。

Flash可能是最好的。广泛传播，更好地在不同平台上看到相同的内容。

# .net - 如何通过标签名称在 Watin 中查找元素？

> ID：389066
> 
> 赞同：7
> 
> 时间：2008-12-23T15:00:46.553
> 
> 标签：.net, watin

如何使用 Watin 使用它们的 TagName 来查找特定元素或元素列表？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-31T08:37:44.683

从 WatiN 2.0 beta 1 开始，这已更改为：

```
ie.ElementWithTag("h1", constraint); 
```

使用 Find.XXX 方法时会创建约束。

这是一个例子：

```
ie.ElementWithTag("h1", Find.ByClass("blue")); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-04T12:35:23.850

例如，要查找页面上的第一个 <h1>，请使用：

```
ie.Element("h1", Find.ByIndex(0)) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-10T16:00:11.313

这对我有用：

> var element = ie.Element(x => x.Text == "[innerText]" && x.TagName == "[tagname]");

# c++ - 以编程方式读取网页

> ID：389069
> 
> 赞同：33
> 
> 时间：2008-12-23T15:01:03.307
> 
> 标签：c++, c, http

我想用 C/C++ 编写一个程序，该程序将动态读取网页并从中提取信息。例如，假设您想编写一个应用程序来跟踪和记录 ebay 拍卖。有没有简单的方法来抓取网页？提供此功能的库？有没有一种简单的方法来解析页面以获取特定数据？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-23T15:05:04.173

看看[cURL 库](http://curl.haxx.se/libcurl/c/example.html)：

```
 #include <stdio.h>
 #include <curl/curl.h>

 int main(void)
 {
   CURL *curl;
   CURLcode res;

   curl = curl_easy_init();
   if(curl) {
     curl_easy_setopt(curl, CURLOPT_URL, "curl.haxx.se");
     res = curl_easy_perform(curl);
      /* always cleanup */
    curl_easy_cleanup(curl);
   }
   return 0;
 } 
```

顺便说一句，如果不严格要求 C++。我鼓励您尝试 C# 或 Java。它更容易，并且有一个内置的方法。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-09-11T16:54:01.263

窗口代码：

```
#include <winsock2.h>
#include <windows.h>
#include <iostream>
#pragma comment(lib,"ws2_32.lib")
using namespace std;
int main (){
    WSADATA wsaData;
    if (WSAStartup(MAKEWORD(2,2), &wsaData) != 0) {
        cout << "WSAStartup failed.\n";
        system("pause");
        return 1;
    }
    SOCKET Socket=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);
    struct hostent *host;
    host = gethostbyname("www.google.com");
    SOCKADDR_IN SockAddr;
    SockAddr.sin_port=htons(80);
    SockAddr.sin_family=AF_INET;
    SockAddr.sin_addr.s_addr = *((unsigned long*)host->h_addr);
    cout << "Connecting...\n";
    if(connect(Socket,(SOCKADDR*)(&SockAddr),sizeof(SockAddr)) != 0){
        cout << "Could not connect";
        system("pause");
        return 1;
    }
    cout << "Connected.\n";
    send(Socket,"GET / HTTP/1.1\r\nHost: www.google.com\r\nConnection: close\r\n\r\n", strlen("GET / HTTP/1.1\r\nHost: www.google.com\r\nConnection: close\r\n\r\n"),0);
    char buffer[10000];
    int nDataLength;
    while ((nDataLength = recv(Socket,buffer,10000,0)) > 0){        
        int i = 0;
        while (buffer[i] >= 32 || buffer[i] == '\n' || buffer[i] == '\r') {
            cout << buffer[i];
            i += 1;
        }
    }
    closesocket(Socket);
        WSACleanup();
    system("pause");
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T18:13:55.150

有一个免费的 TCP/IP 库可用于支持 HTTP 和 HTTPS 的 Windows - 使用它非常简单。

[终极 TCP/IP](http://www.codeproject.com/KB/MFC/UltimateTCPIP.aspx)

```
CUT_HTTPClient http;
http.GET("http://folder/file.htm", "c:/tmp/process_me.htm"); 
```

您还可以获取文件并将它们存储在内存缓冲区中（通过`CUT_DataSource`派生类）。所有常见的 HTTP 支持都在那里 - PUT、HEAD 等。对代理服务器的支持轻而易举，安全套接字也是如此。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T15:06:39.927

您可以使用套接字编程来做到这一点，但是实现可靠地获取页面所需的协议部分是很棘手的。最好使用库，例如[​​ neon](http://www.webdav.org/neon/)。这很可能安装在大多数 Linux 发行版中。在 FreeBSD 下使用 fetch 库。

对于解析数据，因为许多页面不使用有效的 XML，所以您需要实现启发式，而不是真正的基于 yacc 的解析器。您可以使用正则表达式或状态转换机来实现这些。由于您尝试做的事情涉及大量反复试验，因此您最好使用脚本语言，例如 Perl。由于高网络延迟，您不会看到任何性能差异。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T15:10:37.687

尝试使用像 Qt 这样的库，它可以从网络中读取数据并从 xml 文档中获取数据。[这](https://doc.qt.io/archives/4.6/xml-rsslisting-rsslisting-cpp.html)是一个如何读取 xml 提要的示例。例如，您可以使用 ebay 提要。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-30T16:58:57.497

你没有提到任何平台，所以我给你一个Win32的答案。

从 Internet 下载任何内容的一种简单方法是`URLDownloadToFile`将`IBindStatusCallback`参数设置为`NULL`. 为了使函数更有用，需要实现回调接口。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-04-24T17:12:04.460

它可以在多平台 QT 库中完成：

```
QByteArray WebpageDownloader::downloadFromUrl(const std::string& url)
{
    QNetworkAccessManager manager;
    QNetworkReply *response = manager.get(QNetworkRequest(QUrl(url.c_str())));
    QEventLoop event;
    QObject::connect(response, &QNetworkReply::finished, &event, &QEventLoop::quit);
    event.exec();
    return response->readAll();
} 
```

该数据可以例如保存到文件，或转换为 std::string：

```
const string webpageText = downloadFromUrl(url).toStdString(); 
```

请记住，您需要添加

```
QT       += network 
```

到QT项目配置编译代码。

# c# - AddExtension 属性在 C# 2.0 中如何工作？

> ID：389070
> 
> 赞同：8
> 
> 时间：2008-12-23T15:02:57.143
> 
> 标签：c#, c#-2.0

我想打开一个保存文件对话框，让用户输入一个文件名，如果他们忘记了 .csv 扩展名，就把它加进去。

SaveFileDialog AddExtension 属性似乎可以工作，但它没有。我什至将 DefaultExt 属性设置为 .csv，但仍然没有添加任何内容。我的文件保存得很好，但没有扩展名，所以用户不能只是双击文件并在 Excel 中打开它。

我必须遗漏一些明显的东西。这就是我所拥有的

```
 SaveFileDialog sfd = new SaveFileDialog();
        sfd.DefaultExt = "*.csv";
        sfd.Filter = "Comma Separated(*.csv)|*.*";
        if (sfd.ShowDialog() == DialogResult.OK)
        {
            // Do my file saving
        } 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-23T15:07:11.720

尝试只使用`"csv"`-`DefaultExt`而且，你应该是`using`这样的（它是`IDisposable`）：

```
 using (SaveFileDialog sfd = new SaveFileDialog())
        {
            sfd.AddExtension = true;
            sfd.DefaultExt = "csv";
            sfd.Filter = "Comma Separated(*.csv)|*.*";
            if (sfd.ShowDialog() == DialogResult.OK)
            {
                // Do my file saving
            }
        } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T19:07:56.487

它没有附加对话框中的扩展名，尽管它应该。相反，它会在对话框关闭时附加到 sfd.filename 的扩展名。

# asp.net - 为 .NET 报告对象数据的最佳解决方案是什么？

> ID：389082
> 
> 赞同：1
> 
> 时间：2008-12-23T15:08:05.773
> 
> 标签：asp.net, oop, reporting, product

我们的项目使用对象作为报告的数据源。

我们的业务层返回单个对象或 IEnumerable。我们的报表（相当复杂）需要显示对象及其相关对象的值类型属性。典型的情况是，从一个列表中，显示一个包含类别数据的主报表，然后是一个包含每个类别内每个产品的数据的子报表，然后是每个产品的每个部分的子报表，等等。

从数据库报告不是我们的选择。

到目前为止，我们已经尝试过 - Reporting Services：工作，但必须弄乱报表的 XML 定义来定义数据源类，如果使用对象数据源，则很难使用，架构上不太干净 - Telerik Reports：非常好（尤其是漂亮的架构）但似乎有复杂报告（主/子）的问题，没有提供很好的分页控制，传闻有性能/崩溃问题（不成熟的产品）。

有谁知道可以集成到 ASP.NET 应用程序中并与对象作为数据源一起工作的良好报告解决方案？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T15:36:15.593

我们正在使用 ActiveReports 和 XtraReports。我也有使用 Telerik Reports 的经验。XtraReports 和 Telerik Reports 是可用的最佳报告工具之一。我对带有分层数据的主/详细报告也没有任何问题。但是 XtraReports 和 Telerik Reports 有很好的官方支持。如果您对他们的组件有任何问题，他们通常会提供解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T20:44:40.490

除了能够将报表绑定到对象集合（请参阅 IListDataSource）之外，您还可以使用[ActiveReports](http://www.datadynamics.com/Products/ProductOverview.aspx?Product=ARNET3)未绑定模式更好地控制数据绑定。有关 ActiveReports 中未绑定模式的更多信息，请参阅以下内容：[http ://www.datadynamics.com/Help/ARNET3/ActiveReports3_start.htm](http://www.datadynamics.com/Help/ARNET3/ActiveReports3_start.htm)

# c# - 是否有用于解析 SQL Server Proc 的开源代码？

> ID：389083
> 
> 赞同：1
> 
> 时间：2008-12-23T15:08:16.820
> 
> 标签：c#, sql-server

我正在考虑编写一个基于存储过程的内容生成代码的工具。像参数和东西。

我想知道是否有人知道一个开源库，其中包含所有正则表达式和可以轻松解析所有这些内容的东西。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T15:09:49.267

尝试[GOLD 解析器](http://www.devincook.com/goldparser/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T15:19:41.430

如果 proc 已经在 Sql Server 中，并且您只是在查找参数信息，则可以查询[INFORMATION_SCHEMA.PARAMETERS](http://msdn.microsoft.com/en-us/library/ms173796.aspx)。此外，[sp_help](http://msdn.microsoft.com/en-us/library/ms187335(SQL.90).aspx)会将其显示为第二个结果集。

# html - 嵌套 HTML 定义列表是否正确（ )?

> ID：389086
> 
> 赞同：39
> 
> 时间：2008-12-23T15:10:25.973
> 
> 标签：html, markup, semantics

嵌套定义列表在语义上是否正确，或者它们应该只是“名称/值对的平面列表”。

[规格](http://www.w3.org/TR/html401/struct/lists.html#h-10.1)似乎并没有禁止它。

进一步的[这个问题](https://stackoverflow.com/questions/388843/)。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-12-23T15:19:21.430

那么规范似乎允许它，只要只`<dd>`包含嵌套列表。规范声明 a`<dt>`是一个内联元素，因此它不能包含嵌套列表。A`<dd>`是一个块元素，因此其中一个内的内部列表很好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T15:15:50.313

当然。`DL`嵌套s没有任何问题。您可以在语义上拥有“子定义”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T15:21:22.207

有趣的问题。

确实 DefLists 旨在表示键和值，但它们的多重性不是 1，而是 1+。如果允许这种复杂性，并且记住 dt 是内联的，我认为用其他事物的树来表示定义事物没有语义问题。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2019-12-06T10:31:18.713

我通过用无序或有序列表替换嵌套定义列表来解决这个问题，例如。

```
<dl>
  <dd>Black hot drink</dd>
  <ul>
    <dd>White cold drink</dd>
    <ol>
      <dd>Red sweet drink</dd>
    </ol>
  </ul>
</dl> 
```

* * *

## 回答 #5

> 赞同：-6
> 
> 时间：2008-12-23T15:17:14.057

如果它适用于所有浏览器，请执行此操作。

我知道这可能会引起争议，很多人可能会告诉你这不是应该使用的方式。网页设计的不成文规则，例如几乎任何事情都使用列表，这正是人们决定要做的事情。没有理由使用浮动（目的是在文本块中浮动图像）来布局网站上的每个小细节。但是，如果您尝试使用表格，那么您显然是泡沫前时代的白痴，并且您不知道如何设计。

所以，做你想做的事，不要为了解决问题而让事情变得更复杂。

# visual-studio-2008 - Visual Studio 2008 关于 Vista 的问题

> ID：389090
> 
> 赞同：1
> 
> 时间：2008-12-23T15:11:00.090
> 
> 标签：visual-studio-2008, windows-vista

有人对Vista 上的VS2008 有任何问题吗？对我来说，当我在解决方案资源管理器中选择项目时，屏幕经常变为空白。没有其他应用程序会导致这种情况发生。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T15:20:36.217

我们的一个人遇到了这个问题。出于某种奇怪的原因，请检查您的视频驱动程序是否是最新的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T16:03:59.577

我最初对 Visual Studio 2008 和 Vista 有一些问题，但不是您描述的问题类型。一旦我安装了 Vista 兼容性更新，一切似乎都运行良好。我认为最新的 SP 也会解决这个问题。

# linq - 如何创建动态 LINQ 连接扩展方法

> ID：389094
> 
> 赞同：14
> 
> 时间：2008-12-23T15:12:34.283
> 
> 标签：linq, linq-to-sql, c#-3.0, linq-to-entities, linq-to-objects

有一个动态[LINQ](http://en.wikipedia.org/wiki/Language_Integrated_Query)扩展方法库作为[Visual Studio 2008](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2008)的示例发布。我想用 join 方法扩展它。下面的代码在运行时失败并出现参数未匹配异常。哪里有问题？

```
public static IQueryable Join(this IQueryable outer, IEnumerable inner,
                              string outerSelector, string innerSelector, string resultsSelector,
                              params object[] values)
{
    if (inner == null)
        throw new ArgumentNullException("inner");
    if (outerSelector == null)
        throw new ArgumentNullException("outerSelector");
    if (innerSelector == null)
        throw new ArgumentNullException("innerSelector");
    if (resultsSelector == null)
        throw new ArgumentNullException("resultsSelctor");

    LambdaExpression outerSelectorLambda =
        DynamicExpression.ParseLambda(outer.ElementType, null,
                                      outerSelector, values);
    LambdaExpression innerSelectorLambda =
        DynamicExpression.ParseLambda(inner.AsQueryable().ElementType,
                                      null, innerSelector, values);

    ParameterExpression[] parameters = new ParameterExpression[] {
        Expression.Parameter(outer.ElementType, "outer"),
        Expression.Parameter(inner.AsQueryable().ElementType,
        "inner")
    };
    LambdaExpression resultsSelectorLambda =
        DynamicExpression.ParseLambda(parameters, null,
                                      resultsSelector, values);

    return outer.Provider.CreateQuery(
        Expression.Call(
            typeof(Queryable), "Join", new Type[] {
                outer.ElementType,
                inner.AsQueryable().ElementType,
                outerSelectorLambda.Body.Type,
                innerSelectorLambda.Body.Type,
                resultsSelectorLambda.Body.Type
            },
            outer.Expression, inner.AsQueryable().Expression,
            Expression.Quote(outerSelectorLambda),
            Expression.Quote(innerSelectorLambda),
            Expression.Quote(resultsSelectorLambda))
        );
} 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-05T11:36:00.147

我现在自己修好了。将太多参数传递给 CreateQuery(... ) 调用是一个男生错误。将以下代码粘贴到 DynamicQueryable 类中的 Dynamic.cs 文件中，以获得动态 Join 扩展方法。[您可以在http://code.msdn.microsoft.com/csharpsamples](http://code.msdn.microsoft.com/csharpsamples)找到 DynamicQuery 示例项目的源代码。
享受。

```
 public static IQueryable Join(this IQueryable outer, IEnumerable inner, string outerSelector, string innerSelector, string resultsSelector, params object[] values)
    {
        if (inner == null) throw new ArgumentNullException("inner");
        if (outerSelector == null) throw new ArgumentNullException("outerSelector");
        if (innerSelector == null) throw new ArgumentNullException("innerSelector");
        if (resultsSelector == null) throw new ArgumentNullException("resultsSelctor");

        LambdaExpression outerSelectorLambda = DynamicExpression.ParseLambda(outer.ElementType, null, outerSelector, values);
        LambdaExpression innerSelectorLambda = DynamicExpression.ParseLambda(inner.AsQueryable().ElementType, null, innerSelector, values);

        ParameterExpression[] parameters = new ParameterExpression[] {
            Expression.Parameter(outer.ElementType, "outer"), Expression.Parameter(inner.AsQueryable().ElementType, "inner") };
        LambdaExpression resultsSelectorLambda = DynamicExpression.ParseLambda(parameters, null, resultsSelector, values);

        return outer.Provider.CreateQuery(
            Expression.Call(
                typeof(Queryable), "Join",
                new Type[] {outer.ElementType, inner.AsQueryable().ElementType, outerSelectorLambda.Body.Type, resultsSelectorLambda.Body.Type  },
                outer.Expression, inner.AsQueryable().Expression, Expression.Quote(outerSelectorLambda), Expression.Quote(innerSelectorLambda), Expression.Quote(resultsSelectorLambda)));
    }

    //The generic overload.
    public static IQueryable<T> Join<T>(this IQueryable<T> outer, IEnumerable<T> inner, string outerSelector, string innerSelector, string resultsSelector, params object[] values)
    {
        return (IQueryable<T>)Join((IQueryable)outer, (IEnumerable)inner, outerSelector, innerSelector, resultsSelector, values);
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-06-13T13:42:31.833

You can install the nuget package of System.Linq.Dynamic.Core - [https://github.com/StefH/System.Linq.Dynamic.Core](https://github.com/StefH/System.Linq.Dynamic.Core)

This has the join method implemented along with various other helper methods.

Using this library you can do a simple join in the following the way

`myContext.TableA.Join(myContext.TableB,'Id','TableAId','outer',null)`

in the result selector `outer` and `inner` are key words to access the result of the join.

Using a key with multiple properties and/or selecting a result with multiple properties can be done in the following way

`myContext.TableA.Join(myContext.TableB,'new (Id as key1,Code as key2)','new (TableAId as key1,AnotherCol as key2)','new(outer.Id,inner.Desc)',null)`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-23T07:20:14.463

Here is some sample code showing a join on multiple columns. Using a datatable and datarows you need to always access fields via the indexer.

```
 DataTable t1 = new DataTable();
  t1.Columns.Add("FundId", typeof(int));
  t1.Columns.Add("Date", typeof(DateTime));
  t1.Columns.Add("CodeA", typeof(string));
  t1.Rows.Add(1, new DateTime(2010, 01, 01), "A1");
  t1.Rows.Add(2, new DateTime(2010, 01, 01), "A2");
  t1.Rows.Add(3, new DateTime(2010, 01, 01), "A3");

  DataTable t2 = new DataTable();
  t2.Columns.Add("FundId", typeof(int));
  t2.Columns.Add("Date", typeof(DateTime));
  t2.Columns.Add("CodeB", typeof(string));
  t2.Rows.Add(1, new DateTime(2010, 01, 01), "B1");
  t2.Rows.Add(2, new DateTime(2010, 01, 01), "B2");
  t2.Rows.Add(3, new DateTime(2010, 01, 01), "B3");

  IQueryable outerTable = t1.AsEnumerable().AsQueryable();
  IEnumerable innerTable = t2.AsEnumerable();

  var query = outerTable.Join
    (
      innerTable, 
      "new(get_Item(0) as FundId, get_Item(1) as Date)",
      "new(get_Item(0) as FundId, get_Item(1) as Date)",
      "new(outer.get_Item(0) as FundId, outer.get_Item(2) as CodeA, inner.get_Item(2) as CodeB)"
    ); 
```

# .net - .NET 中是否有内置的 IsLowerCase()？

> ID：389100
> 
> 赞同：1
> 
> 时间：2008-12-23T15:16:30.733
> 
> 标签：.net, string

`IsLowerCase()`.NET中有内置的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T15:29:13.640

```
public static bool IsLowerCase( this string text ) {
    if ( string.IsNullOrEmpty( text ) ) { return true; }
    foreach ( char c in text )
        if ( char.IsLetter( c ) && !char.IsLower( c ) )
            return false;

    return true;
}

"someString".IsLowerCase(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-23T15:19:22.507

你的意思是`Char.IsLower(ch);`？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-23T15:55:32.917

请记住，本地化使这成为一个重要的问题。只要您不在乎，第一个示例就可以：

```
string s = ...
s.All(c => char.IsLower(c)); 
```

如果您确实关心，请这样做：

```
s.ToLower(CultureInfo.CurrentUICulture) == s; 
```

这使您有机会解决文化问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T15:20:37.700

编辑：没有看到您问题的实际含义。你可以使用：

```
char.IsLower(c); 
```

至于在案例之间轻松转换：

当然是：

[MSDN 说](http://support.microsoft.com/kb/312890)：

```
 string upper = "CONVERTED FROM UPPERCASE";
 Console.WriteLine(upper.ToLower()); 
```

这是`string`课堂的一部分。

还有`TextInfo`类：

```
CultureInfo cultureInfo   = Thread.CurrentThread.CurrentCulture;
TextInfo textInfo = cultureInfo.TextInfo;

Console.WriteLine(textInfo.ToTitleCase(title));
Console.WriteLine(textInfo.ToLower(title));
Console.WriteLine(textInfo.ToUpper(title)); 
```

这允许更多的变化来改变上限和诸如此类的东西（比如`ToTitleCase`）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T15:42:13.630

正如其他人所提到的，您可以使用 char.IsLower(ch) 轻松地为单个字符执行此操作

但是要扩展 String 原语，这并不是很困难。您可以使用 Runtime.CompilerServices 命名空间相对简单地扩展 BCL：

```
Imports System.Runtime.CompilerServices
Module CustomExtensions

    <Extension()> _
    Public Function IsLowerCase(ByVal Input As String) As Boolean
        Return Return Input.All(Function(c) Char.IsLower(c))
    End Function

End Module 
```

或者在 C# 中，这将是：

```
using System.Runtime.CompilerServices; 
static class CustomExtensions 
{ 
    public static bool IsLowerCase(this string Input) 
    { 
        return Input.All(c => char.IsLower(c)); 
    }
} 
```

现在您可以使用：

```
Console.WriteLine("ThisIsMyTestString".IsLowerCase()) 
```

这将返回 false，因为字符串中包含大写字符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T15:47:16.240

怎么样：

```
public bool IsLower(string TestString)
    {
        if (String.IsNullOrEmpty(TestString))
        {
            return true;
        }

        string testlower = TestString.ToLowerInvariant();

        if (String.Compare(TestString, testlower, false) == 0)
        {
            return true;
        }
        else
        {
            return false;
        }

    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T15:58:29.573

balabaster，请不要将此方法与 FindAll/Count 一起使用。所有你需要的是

```
return Input.ToList().Exists(c => Char.IsUpper(c)); 
```

它将停止第一个大写字符的迭代。FindAll 创建一个新列表，您只使用 Count 属性。如果我们有一个大写的长字符串，您最终会得到原始字符串的副本。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-23T16:16:23.763

伙计们，为什么这种 LINQ 滥用 (ToList(), ToArray(), All(), Any(), ...) ？我也喜欢 LINQ 和 lambda，但在这种情况下，我认为我们需要的是旧的 foreach。请参阅 TcKs 的答案作为参考 - 但如果我们删除多余的，我们可以做得更好

```
char.IsLetter( c ) 
```

因为 IsLower() 正在做同样的检查。

# windbg - Windows 调试工具：符号代理不代理

> ID：389103
> 
> 赞同：1
> 
> 时间：2008-12-23T15:17:26.443
> 
> 标签：windbg

我正在尝试使用 Debugging Tools for Windows 中的 symproxy.dll 设置符号代理。当我从调试器发出“.reload /f”时，找不到任何符号文件。看起来 Symproxy 并没有使用 Microsoft 符号服务器来实际获取符号。例如，我在 Wireshark 中什么也看不到。

SYMPROXY.DLL 肯定正在加载——我可以在事件日志中看到一些条目，并且[http://my-server/symbols/status](http://my-server/symbols/status)返回看起来有效的信息。

据我所知，我已按照文档中的说明进行操作。为什么 symproxy 不去微软的网站？我究竟做错了什么？我需要这个工作，因为我正在调试的机器没有外部访问权限。

运行 symproxy 的机器可以访问 Internet——我经常用它来调试。在注册表中为 symproxy 配置的符号路径看起来是正确的。它不必通过代理即可访问 Internet，我也在注册表中进行了配置。

当我在另一个盒子上使用 !sym 嘈杂时，它会联系 symproxy，但只是说“找不到文件”。就像 symproxy 只是为内容提供服务，而不是像它应该做的那样对 MS 符号服务器进行旁观。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T16:22:54.920

也试试简单的`.symfix c:\symbols`。这会将您的搜索路径设置为默认符号站点。您还可以检查您的搜索路径以查看它们的设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T22:27:04.670

您有几个可用的选项：

1.  确保您使用 .symfix（或 .symfix+）命令来对抗 Microsoft 的符号服务器。“+”版本保留了所有其他符号路径，只是将官方 MS 符号服务器附加到您的列表中。
2.  尝试在重新加载命令之前输入“！sym noise”。这将指示 WinDbg 准确地向您展示它是如何解析符号的，以及它在此过程中遇到的错误（没有 PDB，无法访问远程服务器等）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T09:07:48.217

同时，我已经在共享机器上安装并配置了 Squid。这似乎有效。我更喜欢使用 symproxy，但我只是没有时间深入研究它为什么不起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T16:17:57.520

首先，您是否有正确的符号服务器设置： http: [//msdl.microsoft.com/download/symbols](http://msdl.microsoft.com/download/symbols)

第二，你的代理盒子可以上网吗？并设置为允许 symproxy 访问？可能是 symproxy 本身没有被代理（检查调试工具目录中的 symhttp.doc）。

我会尝试几个步骤来调试调试器 - 您可以在代理盒上运行带有故障转储的 windbg，如果是这样，您可以手动将符号复制到调试器盒中。如果没有，您需要解决互联网访问问题。

# delphi - 在登录之前，如何在运行时确定 Crystal XI 报表的连接方式？

> ID：389113
> 
> 赞同：2
> 
> 时间：2008-12-23T15:19:09.590
> 
> 标签：delphi, crystal-reports, activex, delphi-2007

在我的 (Win32) 应用程序中，我正在显示 Crystal Reports。

我在运行时设置登录信息。但是，Crystal 决定使用几个不同的名称来引用数据库名称，具体取决于报表的连接方式。例如，如果报表通过 ODBC 连接进行连接，则称为“数据源”，但如果直接连接，则称为“服务器”。

当然，直到运行时我们才知道要调用哪个报告。

目前，我通过吞下异常并尝试另一种方法来解决此问题，如下所示：

```
procedure TCrystalReporter11.SetLoginInfo(const username, password,
  server : string);
var
  i : integer;
begin
  //set user name and password
  //crystal only accepts these values if they are CONST params
  for i := 1 to FRpt.Database.Tables.Count do begin
    FRpt.Database.Tables[i].ConnectionProperties.Item['User ID'] := username;
    FRpt.Database.Tables[i].ConnectionProperties.Item['Password'] := password;
    try
      {
      Some reports use direct connections, and others use an ODBC Data Source.
      Crystal XI uses a different label to refer to the database name in each
      method.
      I don't know how to determine in advance which method is being used, so:
          First, we try the direct connection.
          If that fails, we try the "data source" method.

      Reference: "Crystal Reports XI Technical Reference", pages 41 thru 46;
                 "Common ConnectionProperties"
      }
      FRpt.Database.Tables[i].ConnectionProperties.Item['Server'] := server;
    except on E: Exception do
      FRpt.Database.Tables[i].ConnectionProperties.Item['Data Source'] := server;
    end;
  end;
end; 
```

理想情况下，我想说的是：

```
case  FRpt.Database.Tables[i].ConnectionProperties.ConnectMethod of
  crymethod_ODBC : sIdx := 'Data Source';
  crymethod_Direct : sIdx := 'Server';
  ...other methods...
end;  //case
FRpt.Database.Tables[i].ConnectionProperties.Item[sIdx] := server; 
```

# 所以我的问题是：

在登录之前，如何在运行时确定 Crystal XI 报表的连接方式？

# 背景资料：

*   我正在使用德尔福 2007
*   我正在使用 ActiveX 库显示报告，这既麻烦又困难、愚蠢且不可避免（[请参阅这篇文章](https://stackoverflow.com/questions/378089/how-can-i-display-crystal-xi-reports-inside-a-delphi-2007-application)）。
*   报告在 Crystal XI，SP4 中
*   为了便于讨论，我们假设报告都是针对 Oracle 10g 数据库的
*   我的开发机器使用的是 Windows Vista，大多数用户使用的是 XP。

非常感谢有人可以提供的任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T15:37:42.297

在 Tables[i].ConnectionProperties 中查找 DSN 项。非 ODBC 不会有它，ODBC 总是应该的，AFAIK。

# .net - “自定义事件”如何在 VB.Net 中工作？

> ID：389124
> 
> 赞同：8
> 
> 时间：2008-12-23T15:20:08.747
> 
> 标签：.net, vb.net, events

在 C# 中，如果我想创建一个“自定义事件”，你可以这样做：

```
private EventHandler _MyEvent;
Public Event EventHandler MyEvent 
{
   add{ _MyEvent += value; }
   remove{ _MyEvent -= Value; }
}
protected void RaiseMyEvent()
{
   if(_MyEvent != nul)
      _MyEvent(this, EventArgs.Empty);
} 
```

在 VB 中，这不是那么简单，我也无法在网上找到任何帮助。这不起作用：

```
private _MyEvent as EventHandler
Public Custom Event MyEvent as EventHandler
   AddHandler(ByVal value as EventHandler)
      _MyEvent += value 'does not work
      addhandler _MyEvent, value 'does not work
      [Delegate].Combine(_MyEvent, value) '_MyEvent still nothing
   End AddHandler
   RemoveHandler(ByVal value as EventHandler)
      'Same kind of stuff here
   End RemoveHandler
   RaiseEvent(sender as Object, e as EventArgs)
      if(_MyEvent IsNot Nothing) Then '_MyEvent is always nothing
         _MyEvent.Invoke(sender, e)
      End If
   End RaiseEvent
End Event 
```

请帮忙。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-24T03:00:12.107

VB 为您完成了很多工作。

只需声明一个事件：

```
Public Event DidSomething(sender as object, e as EventArgs) 
```

然后在代码中的任何地方，调用下降的 Raise 事件

```
RaiseEvent DidSomething(me, EventArgs.Empty) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-23T15:31:45.773

委托是不可变的，因此方法“[Delegate].Combine”返回新委托，但不修改参数。所以你需要：

```
_MyEvent = [Delegate].Combine(_MyEvent, value) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-02-06T20:32:05.667

...现在，如果您（或其他任何人在询问）如何创建*处理*引发事件的方法，基于“DidSomething”示例，您将执行以下操作：

```
Private Sub NowDoSomething(sender As Object, e As EventArgs) Handles Me.DidSomething
   'Code for Event here
End Sub 
```

# asp.net-mvc - NET 3.5 - MVC PetShop 应用程序？

> ID：389132
> 
> 赞同：5
> 
> 时间：2008-12-23T15:21:30.710
> 
> 标签：asp.net-mvc

真的有 MVC PetShop 应用程序吗？ScottGu 提到了一些事情，但他是在开玩笑吗？

更新

是的，但是他们在 3.5 中做到了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T15:27:36.827

[http://www.codeplex.com/petshopmvc](http://www.codeplex.com/petshopmvc)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T09:24:43.300

我认为他们在谈论[MS .Net Pet Shop——](http://msdn.microsoft.com/en-us/library/aa479071.aspx)它是作为基准测试应用程序创建的，用于将 .Net/SQL 与 J2EE/Oracle 进行比较——他们很可能正在开发更新版本——我似乎找不到参考 ScottGu 博客上的 MVC Pet Shop。

我知道 Scott Hanselman[提到](http://www.hanselman.com/blog/ASPNETMVCSamplesOxiteAndCommunity.aspx)过，但我不知道他有多认真——他说的是阅读代码，而不是把来自雷德蒙德的一切都当作福音。

然而， [Rob Conery](http://blog.wekeroad.com/)一直在[MVC Storefront](http://blog.wekeroad.com/mvc-storefront/)上工作——我不确定它是否专门用于 Pet Store。

# sql-server - 将 Sql Server 2005 数据库备份还原到 Sql Server 2000

> ID：389135
> 
> 赞同：1
> 
> 时间：2008-12-23T15:22:34.950
> 
> 标签：sql-server, database, sql-server-2005, backup, restore

有没有办法将 Sql Server 2005 DB 恢复到 Sql Server 2000？我也无法附上。任何工具，想法等？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T16:49:03.747

我从 Microsoft 找到了这个实用程序，称为 Microsoft SQL Server Database Publishing Wizard 1.1 [http://www.microsoft.com/downloads/details.aspx?FamilyId=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en)。它会生成一个包含所有架构和数据的脚本，并且可以在 SQL Server 2000 上运行。它会重新创建数据库。无论如何，它对我有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T16:58:37.143

因为 SQL 2005 比 SQL 2000 具有更多的新功能/语法。您不能直接进行还原。

我会这样做。首先从 SQL 2005 生成架构脚本。在 SQL 2000 上运行脚本以创建 db 模式。然后使用 SSIS 或导入/导出工具将数据从 SQL 2005 导入 SQL 2000。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T15:24:51.060

[www.sqlaccessories.com](http://www.sqlaccessories.com)提供了一些很棒的工具，使您能够做到这一点（使用他们的结构/数据差异工具）。我没有尝试直接从管理工作室进行操作。

当然，如果db使用sql server 2005特有的特性，你就得做一些手动的调整了。

来自他们的简介：“您甚至可以同步不同版本的 MS SQL Server 上的数据库，例如一个在 SQL Server 2005 上，另一个在 SQL Server 2008 上”

我可以确认这行得通。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T15:26:19.437

最好的方法是将备份恢复到 SQL Server 2005 实例，然后将数据导出到 SQL 2000 实例。有几种方法可以进行导出。您可以将所有数据转换为平面文件、使用包，或者将 db 编写为 SQL 并在 SQL 2000 数据库上运行脚本。

# java - 雅虎实用程序的 Netbeans 智能感知

> ID：389136
> 
> 赞同：1
> 
> 时间：2008-12-23T15:22:41.050
> 
> 标签：java, javascript, netbeans, intellisense

在 netbeans 中，我创建了一个使用 Yahoo utils 的 html 页面。如果我输入“雅虎”。然后命名空间、渲染、隐藏在交互式文档中不可见。请告诉我如何配置 Netbeans 来处理这个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T16:02:40.890

I don't use Netbeans, but I do know that Javascript is case-senstive, and that the global Yahoo object is `YAHOO`, not `yahoo`.

So try it in all caps.

# c# - 通过 XML 属性扩展 ASP.Net TreeView 中的节点

> ID：389140
> 
> 赞同：3
> 
> 时间：2008-12-23T15:24:56.410
> 
> 标签：c#, asp.net, xml, data-binding, treeview

我有一个绑定到 XML 数据源的 ASP.Net TreeView 控件。我希望能够控制在 XML 定义文件中展开哪些节点以及折叠哪些节点。Expanded='' 对我不起作用。在以下简单示例中，我希望完全扩展节点 2。

ASP 页面...

```
<asp:XmlDataSource ID="oXmlDataSource" runat="server" />
<asp:TreeView ID="TreeView1" runat="server" EnableViewState="false" DataSourceID="oXmlDataSource"></TreeView> 
```

代码背后...

```
oXmlDataSource.Data = MyXMLString;
oXmlDataSource.XPath = "/Tree/Node"; 
```

这是XML...

```
<?xml version='1.0' encoding='utf-8' ?>
<Tree Text='example.aspx' Href='example.aspx'>
      <Node Text='Example Node 1' Href='0800200c9a66.aspx' Expanded='false'></Node>
      <Node Text='Example Node 2' Href='0800200c9a66.aspx' Expanded='true'>
         <Node Text='Example Node 3' Href='0800200c9a66.aspx' Expanded='false'></Node>
         <Node Text='Example Node 4' Href='0800200c9a66.aspx' Expanded='false'></Node>
         <Node Text='Example Node 5' Href='0800200c9a66.aspx' Expanded='false'></Node>
         <Node Text='Example Node 6' Href='0800200c9a66.aspx' Expanded='false'></Node>
      </Node>
</Tree> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T20:32:47.023

不幸的是，您不能在 XML 中执行此操作。这是控制的缺点。您将需要使用 XML 填充 TreeView，然后递归遍历所有节点并展开您需要的分支。尝试以下操作：

将 OnPreRender attrobite 添加到 TreeView 控件...

```
<asp:XmlDataSource ID="oXmlDataSource" runat="server" />
<asp:TreeView ID="TreeView1" runat="server" EnableViewState="false" DataSourceID="oXmlDataSource" OnPreRender="TreeView1_PreRender"></TreeView> 
```

然后将以下代码添加到后面的代码中（我建议添加一些测试并添加尝试/捕获）...

```
protected void TreeView1_PreRender(object sender, EventArgs e)
{
    SelectCurrentPageTreeNode(TreeView1);
}

private void SelectCurrentPageTreeNode(TreeView tvTreeView)
{
    tvTreeView.CollapseAll();

    if (Request.Url.PathAndQuery != null)
    {
        ExpandTreeViewNodes(tvTreeView, Request.Url.PathAndQuery);
    }
}

private TreeNode ExpandTreeViewNodes(TreeView tvTreeView, string sPathAndQuery)
{
    if (tvTreeView != null)
    {
        if (!string.IsNullOrEmpty(sPathAndQuery))
        {
            sPathAndQuery = sPathAndQuery.ToLower();
            {
                TreeNode tnWorkTreeNode = null;

                for (int iLoop = 0; iLoop < tvTreeView.Nodes.Count; iLoop++)
                {
                    tvTreeView.Nodes[iLoop].Expand();

                    tvTreeView.Nodes[iLoop].Selected = true;
                    if (tvTreeView.Nodes[iLoop].NavigateUrl.ToLower() == sPathAndQuery)
                    {
                        return (tvTreeView.Nodes[iLoop]);
                    }
                    else
                    {
                        tnWorkTreeNode = ExpandTreeViewNodesR(tvTreeView.Nodes[iLoop], sPathAndQuery);
                    }

                    if (tnWorkTreeNode != null)
                    {
                        return (tnWorkTreeNode);
                    }

                    tvTreeView.Nodes[iLoop].Collapse();
                }
            }
        }
    }

    return (null);
}

private static TreeNode ExpandTreeViewNodesR(TreeNode tvTreeNode, string sPathAndQuery)
{
    TreeNode tnReturnTreeNode = null;

    if (tvTreeNode != null)
    {
        tvTreeNode.Expand();
        if (tvTreeNode.NavigateUrl.ToLower() == sPathAndQuery)
        {
            return (tvTreeNode);
        }
        else
        {
            tnReturnTreeNode = null;

            for (int iLoop = 0; iLoop < tvTreeNode.ChildNodes.Count; iLoop++)
            {
                tvTreeNode.ChildNodes[iLoop].Selected = true;
                tnReturnTreeNode = ExpandTreeViewNodesR(tvTreeNode.ChildNodes[iLoop], sPathAndQuery);

                if (tnReturnTreeNode != null)
                {
                    return (tnReturnTreeNode);
                }
            }
            tvTreeNode.Collapse();
        }
    }
    return (null);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T18:04:41.080

嗯......嗯，默认情况下使用“扩展”不会让你到任何地方，因为 DataBinding 甚至不会看那个......我想你可以设置某种自定义 DataBinding，但我的建议是挂接到 OnTreeNodeDataBound 事件并在那里根据需要展开/折叠，尽管您的里程可能会因该方法而异。

您的问题围绕树视图的数据绑定方式发生：如果您有方便的反射器，请查看 TreeView 控件上的 DataBindRecursive 方法。如果您手边没有反射器，请安装它。:)

# c# - 如何从后面的 ASP.NET 代码访问 HTML 表单输入

> ID：389149
> 
> 赞同：37
> 
> 时间：2008-12-23T15:26:49.013
> 
> 标签：c#, asp.net, html, forms

我有一个基本的 HTML 表单，它根据数据库中存在的记录数插入到服务器端*div标记中。*这个 HTML 表单很好，一切看起来都很好。但是在我的操作页面上，我似乎无法从后面的代码中访问输入元素。我曾尝试使用*Request*范围，但我对这种方法一无所知。还有其他建议吗？

以下所有建议都很棒，通常我会这样做。但是这些表单是在页面编译后即时构建的，所以`runat='server'`没有为我做任何事情。它只是将它传递给 HTML 页面。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-12-23T16:28:12.120

如果您正在访问纯 HTML 表单，则必须通过提交按钮（或通过 JavaScript 发布）将其提交到服务器。这通常意味着您的表单定义将如下所示（我的内存不足 - 请确保您检查 HTML 元素是否正确）：

```
<form method="POST" action="page.aspx">

    <input id="customerName" name="customerName" type="Text" />
    <input id="customerPhone" name="customerPhone" type="Text" />
    <input value="Save" type="Submit" />

</form> 
```

您应该能够像这样访问 customerName 和 customerPhone 数据：

```
string n = String.Format("{0}", Request.Form["customerName"]); 
```

如果您有`method="GET"`表单（不推荐 - 它会弄乱您的 URL 空间），您将不得不像这样访问表单数据：

```
string n = String.Format("{0}", Request.QueryString["customerName"]); 
```

当然，这只有在表单是“已发布”、“已提交”或通过“回发”完成（即，有人单击“保存”按钮，或通过 JavaScript 以编程方式完成）时才有效。

另外，请记住，以这种方式访问​​这些元素只能在您不使用服务器控件（即`runat="server"`）时完成。使用服务器控件，id 和 name 是不同的。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-12-23T15:36:15.513

我猜你需要将这些输入元素设置为**runat="server"**。

所以你将无法访问控件

```
<input type="text" name="email" id="myTextBox" /> 
```

但你将能够与

```
<input type="text" name="email" id="myTextBox" runat="server" /> 
```

并通过使用从中读取

```
string myStringFromTheInput = myTextBox.Value; 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-23T15:31:17.770

通常应该使用`Request.Form["elementName"]`.

例如，如果你有`<input type="text" name="email" />`那么你可以使用`Request.Form["email"]`它来访问它的值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-23T15:34:31.167

IMO 最简单的方法是`runat`在所有元素上包含 ID 和服务器标签：

```
<div id="MYDIV" runat="server" /> 
```

由于听起来这些是动态插入的控件，您可能会喜欢 FindControl()。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T16:01:12.017

由于您使用的是 ASP.NET 代码隐藏，因此向元素添加 id 和`runat=server`.

然后，您可以在后面的代码中引用对象。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-23T15:32:47.877

您说您正在动态创建一个表单 - 您真的是指一个 <form> 及其内容，因为 ASP.NET 对页面上的多个表单存在问题并且它已经为您创建了一个 überform？

# sharepoint - 从 Sharepoint 中的数据视图 Web 部件向 RSS 源传递参数

> ID：389157
> 
> 赞同：0
> 
> 时间：2008-12-23T15:29:10.083
> 
> 标签：sharepoint, dataviewwebpart

我在 Sharepoint 中有一个从 RSS 源提供的数据视图 Web 部件。我已正确配置数据源以读取 RSS 提要，并添加了几个运行时参数。我的问题是，如何在运行时提供这些值？例如，参数之一是 startDate，它应该填充当前日期。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-24T04:34:17.660

经过一些快速的谷歌搜索后，我发现这些日期功能可能会有所帮助 [http://www.zvon.org/xxl/XSL-Ref/Tutorials/Date-Time/dt1.html](http://www.zvon.org/xxl/XSL-Ref/Tutorials/Date-Time/dt1.html)

本文旨在描述如何将查询字符串变量放入数据视图 Web 部件 [http://itfootprint.wordpress.com/2007/05/23/using-query-string-and-data-view-webpart/](http://itfootprint.wordpress.com/2007/05/23/using-query-string-and-data-view-webpart/)

jt

# c# - vs.net xsd

> ID：389164
> 
> 赞同：3
> 
> 时间：2008-12-23T15:31:17.787
> 
> 标签：c#, xsd, xsd.exe

过去，我使用 XSD.exe 从 xsd 创建 c# 类。今天，我在 VS.NET 2008 SP1 中添加了一个 XSD，它会自动从我的 xsd 生成一个数据集，虽然我不想要一个数据集。每次我修改我的 xsd 时，有没有办法让 vs.net 自动执行 xsd.exe。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T16:03:31.590

选择 *.xsd 文件，打开属性窗口（F4 键）并删除“自定义工具”和“自定义工具命名空间”。这将消除“数据集”问题。

“来自 xsd 的 c# 类”问题可以通过另一个自定义工具来解决。看看[XsdCondeGenTool](http://weblogs.asp.net/cazzu/archive/2004/05/14/XsdCodeGenTool.aspx) - 有样本，怎么做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T16:04:03.290

我相信您最好的选择是将 xsd.exe 作为预构建事件运行，并将 XSD 的构建操作设置为“无”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T17:07:52.757

xsd.exe 是否生成数据集或类取决于命令行参数。从 xsd /? 中提取：

> /classes 为这个模式生成类。缩写形式是'/c'。
> 
> /dataset 为此架构生成子类数据集。缩写形式是“/d”。

当架构更改时，预构建事件可以帮助更新您的自动生成的类。您可能要考虑[Nant](http://nant.sourceforge.net/ "南特")。Nant 是 Java 构建脚本 Ant 的 .Net 端口。使用 Nant，您可以创建能够调用 xsd.exe 的相当复杂的构建脚本。我还想象他们可以帮助调用一些脚本，这些脚本可以更新您的项目文件以引用 xsd 生成的类（不是我做过的事情，但我认为非常可行）。

# rest - API 版本控制的最佳实践？

> ID：389169
> 
> 赞同：877
> 
> 时间：2008-12-23T15:32:42.387
> 
> 标签：rest, versioning

是否有任何已知的 Web 服务 REST API 版本控制方法或最佳实践？

我注意到[AWS 通过端点的 URL 进行版本控制](http://docs.aws.amazon.com/AmazonSimpleDB/latest/DeveloperGuide/APIUsage.html)。这是唯一的方法还是有其他方法可以实现相同的目标？如果有多种方式，每种方式的优点是什么？

* * *

## 回答 #1

> 赞同：682
> 
> 时间：2008-12-29T20:24:36.380

这是一个很好但很棘手的问题。**URI 设计**主题同时**是 REST API 中最突出的部分**，因此是对该 API 用户的潜在**长期承诺**。

由于应用程序及其 API 的演变是不争的事实，甚至类似于编程语言等看似复杂的产品的演变，因此**URI 设计**应具有较少**的自然约束**并**应保留随着时间的推移**。应用程序和 API 的生命周期越长，对应用程序和 API 用户的承诺就越大。

另一方面，生活中的另一个事实是，很难预见将通过 API 消耗的所有资源及其方面。[幸运的是，没有必要设计整个 API，直到Apocalypse](http://en.wikipedia.org/wiki/Apocalypse)才会使用。正确定义所有资源端点以及每个资源和资源实例的寻址方案就足够了。

随着时间的推移，您可能需要为每个特定资源添加新资源和新属性，但是一旦资源寻址方案公开并因此成为最终方案，API 用户访问特定资源所遵循的方法不应改变。

此方法适用于早期 API 版本中支持的 HTTP 动词语义（例如 PUT 应始终更新/替换）和 HTTP 状态代码（它们应继续工作，以便在没有人工干预的情况下工作的 API 客户端应该能够继续工作像那样）。

此外，由于将 API 版本嵌入 URI 会破坏[超媒体作为应用程序状态引擎](http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_5)的概念（在 Roy T. Fieldings 博士论文中陈述），因为资源地址/URI 会随时间变化，我会得出结论，**API版本不应长时间保存在资源 URI 中，**这意味着**API 用户可以依赖的资源 URI 应该是永久链接**。

当然，**可以在基本 URI 中嵌入 API 版本，**但**仅限于合理且受限的用途，例如调试**与新 API 版本一起使用的 API 客户端。此类版本化的 API 应该是有时间限制的，并且仅对有限的 API 用户组可用（例如在封闭测试期间）。否则，你会在不应该的地方做出承诺。

关于维护有过期日期的 API 版本的一些想法。所有通常用于实现 Web 服务的编程平台/语言（Java、.NET、PHP、Perl、Rails 等）都允许将 Web 服务端点轻松绑定到基本 URI。通过这种方式，很容易**收集并保持**文件/类/方法的集合**在不同的 API 版本中分开**。

从 API 用户 POV 来看，当它很明显但仅限于有限的时间时，即在开发期间，使用和绑定到特定的 API 版本也更容易。

从 API 维护者的 POV 来看，通过使用主要处理文件作为（源代码）版本控制的最小单元的源代码控制系统，可以更轻松地并行维护不同的 API 版本。

但是，由于 API 版本在 URI 中清晰可见，有一个警告：人们也可能反对这种方法，因为**API 历史在 URI 设计中变得可见/透明** **，因此随着时间的推移容易发生变化，**这违反了 REST 的准则。我同意！

绕过这个合理反对的方法是在无版本 API 基础 URI 下实现最新的 API 版本。在这种情况下，API 客户端开发人员可以选择：

*   针对最新的开发（承诺自己维护应用程序，保护它免受可能破坏他们**设计糟糕的 API 客户端**的最终 API 更改）。

*   绑定到特定版本的 API（这很明显），但仅限于有限的时间

例如，如果 API v3.0 是最新的 API 版本，则以下两个应该是别名（即对所有 API 请求的行为相同）：

```
http://shonzilla/api/customers/1234 
http://shonzilla/api /v3.0 /customers/1234
http://shonzilla/api /v3 /customers/1234

```

**此外，如果 API 客户端正在使用的API 版本已过时或不再受支持，**则应通知仍尝试指向*旧*API 的 API 客户端使用最新的先前 API 版本。因此，访问任何过时的 URI，如下所示：

 **```
http://shonzilla/api /v2.2 /customers/1234
http://shonzilla/api /v2.0 /customers/1234
http://shonzilla/api /v2 /customers/1234
http://shonzilla/api /v1.1 /customers/1234
http://shonzilla/api /v1 /customers/1234

```

应该返回**指示重定向的任何 30x HTTP 状态代码，这些代码**与 HTTP 标头一起使用，`Location`该标头重定向到资源 URI 的适当版本，该版本仍然是这个：

```
http://shonzilla/api/customers/1234

```

至少有两个重定向 HTTP 状态代码适用于 API 版本控制方案：

*   [301 Moved Permanent](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.2)表示具有请求 URI 的资源被永久移动到另一个 URI（应该是不包含 API 版本信息的资源实例永久链接）。此状态码可用于指示过时/不受支持的 API 版本，通知 API 客户端**版本化资源 URI 已被资源永久链接替换**。

*   [302 Found](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.3)表示请求的资源暂时位于另一个位置，而请求的URI可能仍然支持。当无版本 URI 暂时不可用并且应该使用重定向地址重复请求（例如，指向嵌入了 APi 版本的 URI）并且我们想告诉客户端继续使用它（即永久链接）。

*   其他场景参见[HTTP 1.1 规范的 Redirection 3xx 章节](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3)

* * *

## 回答 #2

> 赞同：273
> 
> 时间：2011-07-19T16:08:50.557

URL 不应包含版本。该版本与您请求的资源的“想法”无关。您应该尝试将 URL 视为您想要的概念的路径 - 而不是您希望项目返回的方式。版本规定了对象的表示，而不是对象的概念。正如其他海报所说，您应该在请求标头中指定格式（包括版本）。

如果您查看具有版本的 URL 的完整 HTTP 请求，它看起来像这样：

```
(BAD WAY TO DO IT):

http://company.com/api/v3.0/customer/123
====>
GET v3.0/customer/123 HTTP/1.1
Accept: application/xml

<====
HTTP/1.1 200 OK
Content-Type: application/xml
<customer version="3.0">
  <name>Neil Armstrong</name>
</customer> 
```

标题包含包含您要求的表示的行（“接受：应用程序/xml”）。那是版本应该去的地方。每个人似乎都掩盖了这样一个事实，即您可能想要不同格式的相同内容，并且客户应该能够要求它想要什么。在上面的示例中，客户端请求资源的*任何*XML 表示形式，而不是它想要的真正表示形式。理论上，服务器可以返回与请求完全无关的内容，只要它是 XML 并且必须对其进行解析才能意识到它是错误的。

更好的方法是：

```
(GOOD WAY TO DO IT)

http://company.com/api/customer/123
===>
GET /customer/123 HTTP/1.1
Accept: application/vnd.company.myapp.customer-v3+xml

<===
HTTP/1.1 200 OK
Content-Type: application/vnd.company.myapp-v3+xml
<customer>
  <name>Neil Armstrong</name>
</customer> 
```

此外，假设客户认为 XML 过于冗长，现在他们想要 JSON。在其他示例中，您必须为同一客户提供一个新 URL，因此您最终会得到：

```
(BAD)
http://company.com/api/JSONv3.0/customers/123
  or
http://company.com/api/v3.0/customers/123?format="JSON" 
```

（或类似的东西）。事实上，每个 HTTP 请求都包含您要查找的格式：

```
(GOOD WAY TO DO IT)
===>
GET /customer/123 HTTP/1.1
Accept: application/vnd.company.myapp.customer-v3+json

<===
HTTP/1.1 200 OK
Content-Type: application/vnd.company.myapp-v3+json

{"customer":
  {"name":"Neil Armstrong"}
} 
```

使用这种方法，你在设计上有更多的自由，实际上是在秉承 REST 的原始思想。您可以在不中断客户端的情况下更改版本，或者随着 API 的更改逐步更改客户端。如果您选择停止支持表示，您可以使用 HTTP 状态代码或自定义代码来响应请求。客户端还可以验证响应格式是否正确，并验证 XML。

还有许多其他优点，我在我的博客上讨论了其中一些：http: [//thereisnorightway.blogspot.com/2011/02/versioning-and-types-in-resthttp-api.html](http://thereisnorightway.blogspot.com/2011/02/versioning-and-types-in-resthttp-api.html)

最后一个示例说明将版本放入 URL 是多么糟糕。假设您想要对象内部的一些信息，并且您已经对各种对象进行了版本控制（客户是 v3.0，订单是 v2.0，shipto 对象是 v4.2）。这是您必须在客户端中提供的讨厌的 URL：

```
(Another reason why version in the URL sucks)
http://company.com/api/v3.0/customer/123/v2.0/orders/4321/ 
```

* * *

## 回答 #3

> 赞同：98
> 
> 时间：2011-01-04T20:57:12.390

我们发现将版本放在 URL 中是实用且有用的。它可以让您一目了然地知道您正在使用什么。正如公认的答案所暗示的那样，我们将 /foo 别名为 /foo/（最新版本）以便于使用、更短/更清晰的 URL 等。

永远保持向后兼容性通常成本高昂和/或非常困难。我们更愿意提前通知弃用、此处建议的重定向、文档和其他机制。

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2011-10-13T10:51:30.647

我同意对资源表示进行版本控制更好地遵循 REST 方法……但是，自定义 MIME 类型（或附加版本参数的 MIME 类型）的一个大问题是对写入 HTML 中的 Accept 和 Content-Type 标头的支持不佳， JavaScript。

例如，为了创建资源，IMO 不可能在 HTML5 表单中使用以下标头进行 POST：

```
Accept: application/vnd.company.myapp-v3+json
Content-Type: application/vnd.company.myapp-v3+json 
```

这是因为 HTML5`enctype`属性是一个枚举，因此除了通常的 , 之外的任何内容`application/x-www-formurlencoded`都是`multipart/form-data`无效`text/plain`的。

...我也不确定 HTML4 中的所有浏览器都支持它（它具有更宽松的 encytpe 属性，但是否转发 MIME 类型将是浏览器实现问题）

正因为如此，我现在觉得最合适的版本化方式是通过 URI，但我接受这不是“正确”的方式。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2012-06-05T15:09:52.800

将您的版本放在 URI 中。API 的一个版本并不总是支持另一个版本的类型，因此资源只是从一个版本迁移到另一个版本的论点是完全错误的。这与将格式从 XML 切换到 JSON 不同。这些类型可能不存在，或者它们可能在语义上发生了变化。

版本是资源地址的一部分。您正在从一个 API 路由到另一个 API。在标题中隐藏寻址不是 RESTful。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2011-10-24T16:39:53.580

有几个地方可以在 REST API 中进行版本控制：

1.  如前所述，在 URI 中。如果重定向等使用得当，这可能是易于处理的，甚至是美观的。

2.  在 Accepts: 标头中，因此版本位于文件类型中。就像“mp3”与“mp4”。这也将起作用，尽管 IMO 它的工作原理不如...

3.  在资源本身。许多文件格式都嵌入了它们的版本号，通常在标题中；这允许较新的软件通过了解文件类型的所有现有版本来“正常工作”，而如果指定了不受支持的（较新）版本，则较旧的软件可以退出。在 REST API 的上下文中，这意味着您的 URI 永远不必更改，只需您对所传递的特定数据版本的响应即可。

我可以看到使用所有三种方法的原因：

1.  如果您喜欢“彻底清扫”新 API，或者您想要这种方法的主要版本更改。
2.  如果您希望客户端在执行 PUT/POST 之前知道它是否会工作。
3.  如果客户端必须执行其 PUT/POST 来确定它是否可以工作，是否可以。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2014-03-06T07:16:52.813

对 REST API 进行版本控制类似于对任何其他 API 进行版本控制。可以进行小的更改，大的更改可能需要一个全新的 API。对您来说最简单的方法是每次都从头开始，此时将版本放在 URL 中最有意义。如果您想让客户端的生活更轻松，您可以尝试保持向后兼容性，您可以通过弃用（永久重定向）、多个版本的资源等来做到这一点。这更繁琐，需要更多的努力。但这也是 REST 在“Cool URIs don't change”中所鼓励的。

最后，它就像任何其他 API 设计一样。权衡努力与客户便利。考虑为您的 API 采用语义版本控制，这可以让您的客户清楚地了解您的新版本向后兼容的程度。

# svn - 可以将类似目录树的不同（旧）版本导入到 SVN 中吗？

> ID：389171
> 
> 赞同：0
> 
> 时间：2008-12-23T15:32:52.637
> 
> 标签：svn, repository

如果存储库中已经存在大量文件，是否可以将目录树导入 subversion？许多将被导入的文件将与存储库中的文件匹配，无论是路径还是内容，但有些会较旧，有些会较新，有些文件将在存储库或导入的树中，但不在另一个. 是否可以这样做，将导入的文件视为存储库的头部，以便更改、删除的文件仍保留其历史记录？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T15:40:47.113

以下是轻松完成这项工作的步骤。

1.  使用不覆盖文件的选项将目录复制到 svn 目录。
2.  对目录中的所有文件进行递归添加（这将导致新文件添加到 svn。）
3.  再做一次，时间允许覆盖。
4.  犯罪

如果你这样做会发生什么，你会将之前在该目录中不存在的所有文件添加到 SVN，然后你将覆盖那些确实存在的文件，这将被 svn 视为更改。然后您可以将它们签入。我将在这些步骤中执行此操作，以确保您将这两个操作分开，以便您可以验证它们独立正确地发生。

# php - PHP 中的 Kerberos 身份验证

> ID：389175
> 
> 赞同：14
> 
> 时间：2008-12-23T15:33:17.517
> 
> 标签：php, apache2, single-sign-on, kerberos

让我们假设我对 Kerberos 了解不多 - 只是基础知识。

我有...

*   Debian Linux 2.6 网络服务器
    *   阿帕奇 2.2
        *   mod_auth_kerb/5.3
        *   PHP/5.2
*   一个（工作的）Kerberos 领域
*   视窗客户端
    *   火狐 3
    *   麻省理工学院网络身份管理器中的登录身份“user@EXAMPLE.COM”

如何在 PHP 脚本中使用此信息，以便在访问者拥有类似的 kerberos 票证时无需登录网站？我不希望 Apache 处理身份验证。我需要找出哪个用户正在通过 PHP 访问该站点。

那可能吗？如果是这样：如何？

到目前为止我发现了什么：我必须[在 Firefox 中“启用”域](http://grolmsnet.de/kerbtut/firefox.html)。

然而，仅此而已...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-24T04:09:15.853

我不确定这是否会有所帮助，但如果您使用该参数，Apache 将使用[modauthkerb包向 PHP 发送用户名信息。](http://modauthkerb.sourceforge.net/configure.html#saving)`KrbSaveCredentials`您应该在 php 中获得两个全局变量：

```
 $_SERVER['REMOTE_USER']
 $_SERVER['KRB5CCNAME'] 
```

[http://archives.postgresql.org/pgsql-admin/2004-08/msg00144.php](http://archives.postgresql.org/pgsql-admin/2004-08/msg00144.php)看起来他们已经完成了这项工作。

这样，如果您可以看到用户是什么，那么实际上不需要 php 进行身份验证。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-10-18T08:50:39.650

mod_auth_kerb 将为您处理实际身份验证。之后，它将设置 REMOTE_USER 和 KRB5CCNAME 环境变量。请注意，有一些警告：

*   如果启用了 Krb5AuthToLocal 选项，mod_auth_kerb 可以在 Kerberos 主体和本地用户名之间进行转换。
*   如果启用了 Krb5AuthToLocal，当身份验证成功时，mod_auth_kerb 将调用 Kerberos 库来执行从经过身份验证的名称到本地名称的转换，因为 Kerberos 主体并不总是与操作系统中的实际用户相同（您可以将主体映射到用户名）。
*   当使用 MIT Kerberos 时，此映射是在 /etc/krb5.conf 中的 auth_to_local 规则的帮助下执行的，有关详细信息，请参阅 krb5.conf 手册页。
*   mod_auth_kerb 有一个错误，即生成的本地名称不应具有比主体本身更长的名称。这对于来自默认领域的主体通常是正确的，因为它们没有领域部分，即“用户”而不是“用户@REALM”。但是，如果您有多个受信任的领域，则来自非默认领域的用户将显示为“user@ANOTHER.REALM”，然后 mod_auth_kerb 会崩溃。这个错误应该在 Fedora 18+ 和 RHEL6.5 中修复，不确定 Debian，因为上游的 mod_auth_kerb 有点死了。
*   因此，您的 REMOTE_USER 变量将包含 Kerberos 主体或本地用户名，具体取决于 mod_auth_kerb 的配置方式。如果您的应用程序依赖 REMOTE_USER 值必须是真实的现有系统用户这一事实，则需要确保启用 Krb5AuthToLocal 选项并且此类用户在系统中可见（通过 winbind 或 sssd）。

对于您的情况，我建议您查看 Tom McLaughlin 的优秀方法：http: [//blogs.freebsdish.org/tmclaugh/2010/07/15/mod_auth_kerb-ad-and-ldap-authorization/](http://blogs.freebsdish.org/tmclaugh/2010/07/15/mod_auth_kerb-ad-and-ldap-authorization/)

# ruby-on-rails - 使用 Erubis 2.6.2 和 Rails 2.2.2 不兼容？

> ID：389178
> 
> 赞同：2
> 
> 时间：2008-12-23T15:34:49.403
> 
> 标签：ruby-on-rails, ruby, conflict, erubis

据说安装[erubis](http://www.kuwata-lab.com/erubis/)很简单：

```
gem install erubis

# And in environment.rb:
require 'erubis/helpers/rails_helper' 
```

但我还没有发现是这样的。请注意，我的代码中没有明显的错误；它与 ERB 一起运行得很好。

1.  我把这条线放在哪里？包含后`boot.rb`立即无法启动服务器，并且在文件末尾我收到意外的 nil 对象错误（nil.controller）。哪里最好？
2.  与给定版本是否存在已知冲突？
3.  有什么解决方法可以让 erubis 发挥作用吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T11:37:00.170

The latest Erubis (2.6.4) and Rails 2.2 (and 2.3) are still not compatible. The main issue is that the generated ruby code from Erubis uses "_buf" as the buffer variable and Rails 2.2 and 2.3 require "@output_buffer" to be used.

The reason for "@output_buffer" to be used is that ActionView helpers like CaptureHelper are designed around "@output_buffer" being the primary buffer in the generated code.

I have created a gem called [elkinsware-erubis_rails_helper](http://github.com/elkinsware/erubis_rails_helper/tree/master) that fixes these issues and allows Erubis and Rails 2.3 (for sure but it should work for 2.2).

In your environment.rb file add:

```
 config.gem 'erubis' , :version => '2.6.4'
 config.gem 'elkinsware-erubis_rails_helper', :lib => 'erubis_rails_helper', :source => 'http://gems.github.com' 
```

And then you can add a config/initializers/erubis_config.rb where you can adjust the Erubis/Rails options.

```
 #Erubis::Helpers::RailsHelper.engine_class = Erubis::Eruby # or Erubis::FastEruby
 #Erubis::Helpers::RailsHelper.init_properties = {}
 #Erubis::Helpers::RailsHelper.show_src = false
 #Erubis::Helpers::RailsHelper.preprocessing = true 
```

The source is at [http://github.com/elkinsware/erubis_rails_helper/tree/master](http://github.com/elkinsware/erubis_rails_helper/tree/master)

Let me know if you have any issues with the gem.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T09:57:25.183

1.  Either put it on the bottom or environment.rb, or put it in an initializer (config/initializers/anything.rb). When you put it before the Rails::Initializer block, the rails environment hasn't fully loaded yet, and erubis/helpers/rails_helpers seems to assume a fully loaded Rails environment.
2.  I have never used erubis, so I can't answer that.
3.  Workarounds? See #1, I guess.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T19:52:56.310

显然这被打破了：

[http://kleinptr.wordpress.com/2009/02/04/erubis-and-rails-222/](http://kleinptr.wordpress.com/2009/02/04/erubis-and-rails-222/)

他们正在修复：

[http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/328613](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/328613)

# c++ - 断言和 NDEBUG

> ID：389180
> 
> 赞同：10
> 
> 时间：2008-12-23T15:35:55.267
> 
> 标签：c++, error-handling

在阅读了一些关于滥用异常的线程之后（基本上是说如果函数的先决条件不正确，你不想展开堆栈 - 可能表明你的所有内存都已损坏或同样危险的东西）我正在考虑使用 assert() 更多经常。以前我只使用 assert() 作为调试工具，我认为这就是很多 C++ 程序员使用它的方式。我担心我的部分错误处理会在未来某个时候被引入运行时构建的 NDEBUG #define 关闭。有没有办法解决这个问题并且其他人对此有问题（即我应该担心它）吗？

谢谢，帕特

编辑：我正在阅读的线程的重点是，如果您的应用程序真的被窃听，那么展开堆栈可能会损坏系统，例如，如果析构函数将某些内容写入文件并且文件句柄已损坏。我不建议使用 assert 进行正常的错误处理。我目前的用例很弱，但看看你的想法：

```
 //check later code won't crash the system
  if( buf.length() % 2 )
    return false;
  // do other stuff that shouldn't affect bufs length
  //copy 2 bytes into buf at a time, if length is odd then don't know 
  //what will happen so use assert to make sure it can't damage anything
  assert( !(buf.length() % 2) );
  for( i = 0; i != buf.length(); i += 2 )
    memcpy( buf + i, data, 2 ); 

```

编辑2：讨论在这里： [http ://groups.google.com/group/comp.lang.c++.moderated/browse_frm/thread/80083ac31a1188da](http://groups.google.com/group/comp.lang.c++.moderated/browse_frm/thread/80083ac31a1188da)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-23T15:41:32.993

您可以构建自己的断言，而不是使用股票 C assert.h。您的断言不会被禁用。

看看 assert() 如何在 /usr/include/assert.h （或任何地方）中实现。这只是一些最终调用“断言失败”函数的预处理器魔法。

在我们的嵌入式环境中，我们一直替换 assert()。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-23T19:53:15.760

我喜欢定义自己的断言宏。我做了两个 -- ASSERT 测试总是（即使是优化的构建），DASSERT 只对调试构建有影响。您可能希望默认为 ASSERT，但如果某些东西的测试成本很高，或者性能敏感区域的内部循环内的断言可以更改为 DASSERT。

另外，请记住，断言只能用于完全无意义的条件，这些条件表明程序中存在逻辑错误并且您无法从中恢复。这是对您的编程正确性的测试。绝不应该使用断言来代替错误处理、异常或健壮性，并且您绝不应该断言与格式错误或不正确的用户输入相关的任何事情——这些事情应该被优雅地处理。断言只是受控崩溃，您有机会输出一些额外的调试信息。

这是我的宏：

```
/// ASSERT(condition) checks if the condition is met, and if not, calls
/// ABORT with an error message indicating the module and line where
/// the error occurred.
#ifndef ASSERT
#define ASSERT(x)                                                      \
    if (!(x)) {                                                         \
        char buf[2048];                                                 \
        snprintf (buf, 2048, "Assertion failed in \"%s\", line %d\n"    \
                 "\tProbable bug in software.\n",                       \
                 __FILE__, __LINE__);                                   \
        ABORT (buf);                                                    \
    }                                                                   \
    else   // This 'else' exists to catch the user's following semicolon
#endif

/// DASSERT(condition) is just like ASSERT, except that it only is 
/// functional in DEBUG mode, but does nothing when in a non-DEBUG
/// (optimized, shipping) build.
#ifdef DEBUG
# define DASSERT(x) ASSERT(x)
#else
# define DASSERT(x) /* DASSERT does nothing when not debugging */
#endif 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-23T16:01:13.030

好吧，[一个失败的断言是一个**错误**](https://stackoverflow.com/questions/17732/when-should-assertions-stay-in-production-code)，不多也不少。与取消引用空指针相同，只是您自己给了您的软件一根棍子来打击您。勇敢的决定，你值得称赞！

用异常跳出问题几乎没有帮助，它不能修复错误。所以我建议实现你自己的 ASSERT() 宏，它：

*   尝试尽可能多地收集有关失败的数据（断言表达式、堆栈跟踪、用户环境等）
*   努力使用户尽可能轻松地向您报告，并且
*   弹出一个消息框，为给您带来的不便道歉，并粗暴地中止了该应用程序。

如果性能是一个问题，您可以考虑使用某种 SOFT_ASSERT() 宏，该宏会从发布版本中消失。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T15:42:25.660

除了在调试期间检查假设的随意方式之外，我会避免依赖断言。在发布代码中，您重新定义的断言将由随机崩溃处理，这对用户不友好

如果在调试过程中，您的假设（例如给定条件永远不会为真）被证明是无效的。相应地更改错误处理代码以考虑该条件。

否则，有一个更加用户友好的工具来处理违反假设的条件。创建一个名为 CAssumptionViolated 的异常，将它扔到您要断言的地方。在您的主程序中捕获它，并为用户提供一种提醒您错误的方法。更好的是，提供异常的调试信息。更好的是，以某种方式自动将调试信息转发给您的组织。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T15:51:22.410

也许我没有正确理解您，但是 IMO assert() 不应该在发布代码中用于执行您所描述的操作，即强制执行不变量。

如果一个函数的前提条件不正确，你想做什么？您希望如何将其传达给：

*   交互式用户？
*   你的支持人员？

在这两种情况下，您都需要调用一些错误处理代码，并且（在我看来）异常只是票证。

但是，如果您仍然想走这条路，您可以将以下内容放在每个源文件的顶部：

```
#undef NDEBUG 
```

我不推荐这个。请不要这样做。没有人会感谢你:-)

塞布

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-23T16:00:52.313

我已经看到程序实现了自己的断言和验证宏。在调试模式下使用断言并在调试和发布模式下验证。具体来说，验证可用于在检查失败时从程序中优雅地退出（或者比彻底崩溃更优雅）。可能我见过的第一个也是最好的用途之一是在 Unreal 代码中（我相信您仍然可以查看 Unreal 标头）。

# database - 什么是单元测试数据库转换的好策略或工具？（不是单元测试数据库，而是转换）

> ID：389181
> 
> 赞同：2
> 
> 时间：2008-12-23T15:35:59.230
> 
> 标签：database, unit-testing, tdd

我正在开展一个项目，我们将旧系统转换为全新系统。我们目前正在从旧系统的数据库转换到新系统的数据库，并且一个团队正在努力创建一组地图和转换，以便在开发结束时运行以转换旧系统。

我想实现单元测试，这样我们就可以知道地图和转换的新变化，不破坏现有的工作，我们可以使用测试驱动的开发方法。

关于如何做到这一点的任何建议或想法？我不认为有这个框架，但如果有我想知道它。

（更新）

这是一个 Oracle 数据库，这可能是有用的信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T15:41:08.813

这是 Oracle 特有的，但如果这是您选择的数据库，那么您应该尝试[Ounit](http://www.ounit.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T15:41:15.740

在这种情况下，您需要做的第一件事是确定您的“单位”是什么。然后弄清楚它的功能应该是什么。之后，您可以像其他任何东西一样对其进行测试。

我猜你会想要测试旧系统中的数据是否仍在新系统中，这让我觉得被称为单元测试有点大。您可能希望将数据插入旧数据库。应用映射。然后从您的新数据库中选择它，这至少可以确保您可以取回您输入的内容。这需要对您要测试的每个实体或一组实体进行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T15:44:28.027

您可以尝试[dbUnit](http://dbunit.sourceforge.net/)或[SqlUnit](http://sqlunit.sourceforge.net/)。虽然是特定于 MS 的，但[本文](http://msdn.microsoft.com/en-us/library/bb381703(VS.80).aspx)可能有助于理解一些 DB 测试模式。

警告：我没有使用任何这些，因此无法提出任何建议。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-05T09:45:22.240

这并不适合单元测试。

在所有转换完成之前，“新”数据库通常在逻辑上是不一致的。此外，大多数错误将是由于映射的不一致以及它们处理空外键等的方式。

我建议您使用有限的数据集定义新旧表的特定单元测试集，以测试特定案例并测试新表的正确性，但是，您仍然需要运行整套转换/每次更改时映射。当您在一小部分数据上运行时，这应该不会太痛苦，此外，您可以添加特定数据来测试已知/可能的错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-05T09:30:01.243

我过去做过这种事情；我看不出测试整个迁移如何成为“单元测试”。也许您可以考虑“新数据库中所有销售额的总和必须是旧数据库”。单元测试并不是真正的选择，除非您正在编写单独的 PL/SQL 函数来帮助转换（即，从一种存储列的方式转换为另一种）。这些对于单元测试来说应该是微不足道的。

我过去做过的一些测试：-

*   **报告比较** 通常至少有几个报告从一个系统转移到另一个系统。比较这些的输出。一半的时间你会在旧系统中发现错误。
*   **总计**计算数据的总计和哈希总计以确定它是否正确。以不同的方式拆分和切分您的数据。
*   **抽查**调查随机记录的详细信息。

作为开发人员，在编写系统时拥有大量测试数据非常有用。开发人员编写的单元测试应该针对新创建的数据以及您导入的历史数据运行。

# c# - 更改 WPF 工具栏面板的背景

> ID：389192
> 
> 赞同：1
> 
> 时间：2008-12-23T15:41:24.647
> 
> 标签：c#, wpf, toolbar

我正在尝试在 C# 代码中重现具有两个渐变背景的 Visual Studio 样式工具栏。我可以看到如何在 XAML 中执行此操作，但是如何深入到对象以在我的 C# 代码中更改其“MainPanelBorder”边框的背景？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T15:46:29.143

您需要使用

```
myToolbar.Template.FindName("MainPanelBorder", myToolbar) as Panel 
   //Or whatever the type of the item is in the template. 
```

# .net - 如何找到 ManualResetEvent 的状态？

> ID：389196
> 
> 赞同：75
> 
> 时间：2008-12-23T15:43:03.253
> 
> 标签：.net, multithreading, locking

我正在使用 的实例`ManualResetEvent`来控制对资源的线程访问，但我遇到了问题。有谁知道我在调试过程中如何找出对象的状态？

也就是说，我想知道`ManualResetEvent`当前是否阻塞了任何线程，甚至可能阻塞了多少线程和哪些线程。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-12-23T15:52:00.303

对超时值为零的事件执行 a `WaitOne`。

如果设置了事件，它将返回 true，如果发生超时，它将返回 false。换句话说，true -> event 被设置，false -> event 没有被设置。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-08-07T19:35:13.747

这是工作代码：

```
private ManualResetEvent pause = new ManualResetEvent(false);
pause.WaitOne(); // caller thread pauses
pause.Set();    // another thread releases paused thread

// Check pause state
public bool IsPaused { get { return !pause.WaitOne(0); } } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-09-05T22:58:52.917

您可以在 Debugger Watch 窗口中进行函数调用。在 Watch 窗口中添加一个调用`mreVariable.WaitOne(0)`并查看它的计算结果。注意：您不应将其用于 AutoResetEvents，因为这可能会改变实际状态。

# windows - 如何创建自己的 URL 协议？（例如所以：//...）

> ID：389204
> 
> 赞同：229
> 
> 时间：2008-12-23T15:45:41.580
> 
> 标签：windows, protocols, protocol-handler

我见过：

*   `http://www...`
*   `ftp://blah.blah...`
*   `file://blah.blah...`
*   `unreal://blah.blah...`
*   `mailto://blah.blah...`

你看到`http`的第一部分叫什么？

我可以自己注册吗？

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2008-12-23T15:51:12.193

带有`HTTP://`,`FTP://`等的部分称为[URI 方案](https://www.iana.org/assignments/uri-schemes/uri-schemes.xhtml)

您可以通过注册表注册自己的。

```
HKEY_CLASSES_ROOT/
  your-protocol-name/
    (Default)    "URL:your-protocol-name Protocol"
    URL Protocol ""
    shell/
      open/
        command/
          (Default) PathToExecutable 
```

资料来源：[https](https://www.iana.org/assignments/uri-schemes/uri-schemes.xhtml) ://www.iana.org/assignments/uri-schemes/uri-schemes.xhtml，http : [//msdn.microsoft.com/en-us/library/aa767914 (v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/aa767914(v=vs.85).aspx)

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2011-09-01T22:23:36.067

打开记事本并将下面的代码粘贴到其中。将“YourApp”更改为您的应用名称。将其保存到 YourApp.reg 并通过在资源管理器中单击它来执行它。就是这样！干杯! 欧文·汉杰斯

```
REGEDIT4

[HKEY_CLASSES_ROOT\YourApp]
@="URL:YourApp Protocol"
"URL Protocol"=""

[HKEY_CLASSES_ROOT\YourApp\DefaultIcon]
@="\"C:\\Program Files\\YourApp\\YourApp.exe\""

[HKEY_CLASSES_ROOT\YourApp\shell]

[HKEY_CLASSES_ROOT\YourApp\shell\open]

[HKEY_CLASSES_ROOT\YourApp\shell\open\command]
@="\"C:\\Program Files\\YourApp\\YourApp.exe\" \"%1\" \"%2\" \"%3\" \"%4\" \"%5\" \"%6\" \"%7\" \"%8\" \"%9\"" 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-12-23T16:04:02.370

这对于每个浏览器都是不同的，在 IE 和 Windows 中，您需要创建它们所谓的可插入协议处理程序。

基本步骤如下：

1.  实现 IInternetProtocol 接口。
2.  实现 IInternetProtocolRoot 接口。
3.  实现 IClassFactory 接口。
4.  选修的。实现 IInternetProtocolInfo 接口。事务处理程序提供对 HTTP 协议的支持。
5.  如果实现了 IInternetProtocolInfo，请提供对 PARSE_SECURITY_URL 和 PARSE_SECURITY_DOMAIN 的支持，以便 URL 安全区域管理器可以正确处理安全问题。为您的协议处理程序编写代码。
6.  提供对 BINDF_NO_UI 和 BINDF_SILENTOPERATION 的支持。
7.  在注册表中的 HKEY_CLASSES_ROOT\PROTOCOLS\Handler 下为您的协议处理程序添加一个子项。
8.  在子项下创建一个字符串值 CLSID，并将该字符串设置为协议处理程序的 CLSID。

有关windows 端的更多详细信息，请参阅[MSDN 上的 About Asynchronous Pluggable Protocols 。](http://msdn.microsoft.com/en-us/library/aa767916%28VS.85%29.aspx)windows SDK 中也有一个示例。

一个快速的谷歌也展示了关于 codeproject 的这篇文章：http: [//www.codeproject.com/KB/IP/DataProtocol.aspx](http://www.codeproject.com/KB/IP/DataProtocol.aspx)。

最后，作为一名安全人员，我必须指出，这段代码需要经过实战。这是一个高风险，因为要可靠地做到这一点，你不能在托管代码中做到这一点，而必须在 C++ 中做到这一点（我想你可以使用 VB6）。您应该考虑是否真的需要这样做，如果需要，请仔细设计并安全编码。攻击者只需在页面上包含链接即可轻松控制传递给您的内容。例如，如果您有一个简单的缓冲区溢出，那么没有人会更好地这样做：`<a href="custom:foooo{insert long string for buffer overflow here}"> Click me for free porn</a>`

强烈考虑使用 VC8 及以上编译器中包含的 strsafe 和新的安全 CRT 方法。如果您不知道我在说什么，请参阅[http://blogs.msdn.com/michael_howard/archive/2006/02/27/540123.aspx 。](http://blogs.msdn.com/michael_howard/archive/2006/02/27/540123.aspx)

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-12-23T15:57:55.377

这是已注册[URI 方案](http://www.iana.org/assignments/uri-schemes.html)的列表。每个都有一个 RFC - 一个定义它的文档，这几乎是一个标准。RFC 告诉新应用程序（例如浏览器、ftp 客户端等）的开发人员他们需要支持什么。如果您需要一个新的基础级协议，您可以使用未注册的协议。其他答案告诉你如何。请记住，您可以使用现有协议做很多事情，从而获得它们现有的实现。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-23T16:14:35.173

对于大多数 Microsoft 产品（Internet Explorer、Office、“打开文件”对话框等），您可以[注册一个应用程序](http://msdn.microsoft.com/en-us/library/aa767914(VS.85).aspx)，以便在打开具有适当前缀的 URI 时运行。这是更常见的[解释](http://msdn.microsoft.com/en-us/library/aa767743(VS.85).aspx)的一部分——如何实现你自己的协议。

对于 Mozilla，解释在[这里](http://www.mozilla.org/projects/netlib/new-handler.html)，Java-[在这里](http://java.sun.com/developer/onlineTraining/protocolhandlers/)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-23T15:50:36.640

它被称为协议。唯一阻止您制定自己的协议的是您必须：

1.  编写一个能够理解该协议的浏览器或用户代理，无论是 URL 形式还是实际数据格式
2.  编写一个理解该协议的服务器
3.  最好有一个协议规范，以便浏览器和服务器可以继续协同工作。

Windows 使#1 变得非常简单，在许多情况下，这就是您真正需要的。即：

[将应用程序注册到 URL 协议](http://msdn.microsoft.com/en-us/library/aa767914.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T15:50:58.090

第一部分称为协议，是的，您可以注册自己的协议。在 Windows 上（我假设你正在这样做，因为 C# 标签 - 对不起 Mono 粉丝），它是[通过注册表完成的](http://msdn.microsoft.com/en-us/library/aa767914(VS.85).aspx)。

* * *

## 回答 #8

> 赞同：-11
> 
> 时间：2008-12-23T15:49:08.483

您实际上不必进行任何注册。我见过很多程序，比如 emule，创建了自己的协议规范（我认为它就是这样称呼的）。在那之后，您基本上只需要在注册表中设置一些值，以了解哪些程序处理该协议。我不确定是否有任何官方的协议说明符注册表。如果您希望人们从他们的浏览器中打开您的应用程序，那么没有什么可以阻止您为自己的应用程序创建自己的协议说明符。

# geolocation - 地理空间坐标和距离（以公里为单位）

> ID：389211
> 
> 赞同：14
> 
> 时间：2008-12-23T15:48:57.453
> 
> 标签：geolocation, geospatial, distance, geography

这是对[这个问题](https://stackoverflow.com/questions/378281/latlon-distance-heading-latlon)的跟进。

我似乎被困在这一点上。基本上，我需要能够来回转换以参考标准度数系统中的坐标，或者通过测量沿国际日期变更线从南极向北的距离，然后从日期的那个点开始向东的距离线。为了做到这一点（以及一些更一般的距离测量的东西），我有一种方法来确定两个纬度/经度点之间的距离，另一种方法需要一个纬度/经度点、一个航向和一个距离，然后返回该课程结束时的纬度/经度点。

这是我定义的两个静态方法：

```
/* Takes two lon/lat pairs and returns the distance between them in kilometers.
*/
public static double distance (double lat1, double lon1, double lat2, double lon2) {
    double theta = toRadians(lon1-lon2);
    lat1 = toRadians(lat1);
    lon1 = toRadians(lon1);
    lat2 = toRadians(lat2);
    lon2 = toRadians(lon2);

    double dist = sin(lat1)*sin(lat2) + cos(lat1)*cos(lat2)*cos(theta);
    dist = toDegrees(acos(dist)) * 60 * 1.1515 * 1.609344 * 1000;

    return dist;
}

/* endOfCourse takes a lat/lon pair, a heading (in degrees clockwise from north), and a distance (in kilometers), and returns
 * the lat/lon pair that would be reached by traveling that distance in that direction from the given point.
 */
public static double[] endOfCourse (double lat1, double lon1, double tc, double dist) {
    double pi = Math.PI;
    lat1 = toRadians(lat1);
    lon1 = toRadians(lon1);
    tc = toRadians(tc);
    double dist_radians = toRadians(dist / (60 * 1.1515 * 1.609344 * 1000));
    double lat = asin(sin(lat1) * cos(dist_radians) + cos(lat1) * sin(dist_radians) * cos(tc));
    double dlon = atan2(sin(tc) * sin(dist_radians) * cos(lat1), cos(dist_radians) - sin(lat1) * sin(lat));
    double lon = ((lon1-dlon + pi) % (2*pi)) - pi;
    double[] endPoint = new double[2];
    endPoint[0] = lat; endPoint[1] = lon;
    return endPoint;
} 
```

这是我用来测试它的函数：

```
public static void main(String args[]) throws java.io.IOException, java.io.FileNotFoundException {
    double distNorth = distance(0.0, 0.0, 72.0, 0.0);
    double distEast = distance(72.0, 0.0, 72.0, 31.5);
    double lat1 = endOfCourse(0.0, 0.0, 0.0, distNorth)[0];
    double lon1 = endOfCourse(lat1, 0.0, 90.0, distEast)[1];
    System.out.println("end at: " + lat1 + " / " + lon1);
    return;
} 
```

“结束于”值应该是 appx。72.0 / 31.5。但相反，我得到大约 1.25 / 0.021。

我想我一定是错过了一些愚蠢的东西，忘记在某处转换单位，或者其他什么......任何帮助将不胜感激！

**更新 1：**

我已经（正确地）写了距离函数来返回米，但是在评论中错误地写了公里......当我今天回到它时，这当然让我感到困惑。无论如何，现在已经修复了，我已经修复了 endOfCourse 方法中的因式分解错误，而且我还意识到我也忘记了在该方法中将弧度转换回度数。无论如何：虽然看起来我现在得到了正确的纬度数（71.99 ...），但经度数却很差（我得到的是 3.54 而不是 11.5）。

**更新 2：** 我在测试中有一个错字，如下所述。它现在已在代码中修复。然而，经度数仍然是错误的：我现在得到的是 -11.34 而不是 11.5。我认为这些行一定有问题：

```
double dlon = atan2(sin(tc) * sin(dist_radians) * cos(lat1), cos(dist_radians) - sin(lat1) * sin(lat));
double lon = ((lon1-dlon + pi) % (2*pi)) - pi; 
```

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-12-23T15:58:58.137

您在代码中遇到了严重的幻数。表达方式：

```
 (60 * 1.1515 * 1.609344 * 1000) 
```

出现两次，但没有太多解释。在一些帮助下：1.609344 是一英里的公里数；60 是一个学位的分钟数；1000是一公里的米数；1.1515 是海里的法定英里数（感谢 DanM）。一海里是赤道纬度一分钟的长度。

我假设您使用的是球形地球模型，而不是球形地球？代数不够复杂，不能成为椭球体。

第一个公式 - 两个纬度和经度对之间的转换 - 很奇怪。您需要 delta-lat (Δλ) 和 delta-lon (Δφ) 来找出答案。此外，对之间的距离：

```
(60° N, 30° W), (60° N, 60° W)
(60° N, 60° W), (60° N, 90° W) 
```

应该是一样的——但我很确定你的代码会产生不同的答案。

所以，我认为你需要回到你的球面三角参考材料，看看你做错了什么。（我需要一段时间才能找到关于这个主题的书——它需要从它所在的任何一个盒子中打开。）

[ *...时间流逝...拆包完成...* ]

*给定一个在顶点处具有角A*、*B*、*C*的球面三角形以及与这些顶点相对的边*a*、*b*、*c*（即，边*a*从*B*到*C*等），余弦公式为：

```
cos a = cos b . cos c + sin b . sin c . cos A 
```

将此应用于问题，我们可以将给定的两个点称为*B*和*C ，并创建一个在**A*处具有直角的直角球面三角形。

最糟糕的 ASCII 艺术：

```
 + C
                 /|
                / |
            a  /  | b
              /   |
             /    |
            /     |
         B +------+ A
              c 
```

*c*边等于经度差；*b*边等于纬度差；角度*A*是 90°，所以 cos *A = 0。因此，我相信**a*的等式是：

```
cos a = cos Δλ . cos Δφ + sin Δλ . sin Δφ . cos 90°

a = arccos (cos Δλ . cos Δφ) 
```

然后通过乘以地球的半径将以弧度表示的角度*a转换为距离。*或者，给定*度数*（和度数的小数），则 60 海里对应于 1 度，因此 60 * 1.1515 法定英里和 60 * 1.1515 * 1.609344 公里对应于 1 度。除非您想要以米为单位的距离，否则我认为不需要 1000 倍。

Paul Tomblin 指出，[Aviation Formulary v1.44](http://www.edwilliams.org/avform.htm#Dist)是方程式的来源——事实上，它就在那里，并且在位置差异很小的情况下，还有一个数值更稳定的版本。

转到基本的三角学，我们也知道：

```
cos (A - B) = cos A . cos B + sin A . sin B 
```

在我给出的公式中应用两次很可能最终得到航空公式中的公式。

（我的参考资料： AE Roy 和 D Clarke 的[“天文学：原理与实践，第四版”](https://rads.stackoverflow.com/amzn/click/com/0750309172)（2003 年）；我的副本是 1977 年的第一版，Adam Hilger，ISBN 0-85274-346-7。）

* * *

**注意**查看（谷歌）'定义：“海里”'；根据定义，现在一海里似乎是 1852 米（1.852 公里）。乘数 1.1515 对应于海里的旧定义，大约为 6080 英尺。使用`bc`10 的比例，我得到：

```
(1852/(3*0.3048))/1760
1.1507794480 
```

哪个因素对你有用取决于你的基础是什么。

* * *

从第一原理看第二个问题，我们有一个稍微不同的设置，我们需要“另一个”球面三角方程，正弦公式：

```
sin A   sin B   sin C
----- = ----- = -----
sin a   sin b   sin c 
```

改编上一张图：

```
 + C
                 /|
                / |
            a  /  | b
           |  /   |
           |X/    |
           |/     |
         B +------+ A
              c 
```

给定起点*B*，角度*X* = 90º - B，长度（角度）*a*和角度*A* = 90°。你所追求的是*b*（纬度增量）和*c*（经度增量）。

所以，我们有：

```
sin a   sin b
----- = ----
sin A   sin B 
```

或者

```
 sin a . sin B
sin b = -------------
            sin A 
```

或者，因为 A = 90°，所以 sin A = 1，并且 sin B = sin (90° - X) = cos X：

```
sin b = sin a . cos X 
```

这意味着您将行进的距离转换为角度*a*，取其正弦值，乘以路线方向的余弦值，然后取结果的反正弦值。

给定*a*，*b*（刚刚计算）和*A*和*B*，我们可以应用余弦公式得到*c*。请注意，我们不能简单地重新应用正弦公式来获得*c* ，因为我们没有*C*的值，并且因为我们正在使用球面三角学，所以没有方便的规则 C = 90° - B（总和球面三角形的内角可以大于 180°；考虑一个所有角都等于 90° 的等边球面三角形，这是完全可行的）。

* * *

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-23T15:59:47.807

查看[http://www.movable-type.co.uk/scripts/latlong.html](http://www.movable-type.co.uk/scripts/latlong.html)

该网站有很多不同的公式和 Javascript 代码可以帮助您。我已经成功地将它翻译成 C# 和 SQL Server UDF，并且我到处都在使用它们。

例如 Javascript 计算距离：

```
var R = 6371; // km
var φ1 = lat1.toRadians();
var φ2 = lat2.toRadians();
var Δφ = (lat2-lat1).toRadians();
var Δλ = (lon2-lon1).toRadians();

var a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
        Math.cos(φ1) * Math.cos(φ2) *
        Math.sin(Δλ/2) * Math.sin(Δλ/2);
var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

var d = R * c; 
```

享受！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T16:07:03.533

您在公里和弧度之间的转换是错误的。海里是 1/60 度，所以假设 1.15... 是您从英里到海里的转换，而 1.6... 是您从公里到法定英里的转换，

```
 nm = km /  (1.1515 * 1.609344);
   deg = nm / 60;
   rad = toRadians(deg); 
```

换句话说，我认为你偏离了 1000 倍。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T17:33:54.810

关于您更新的问题：不应该

```
double lon1 = endOfCourse(lat1, 0.0, 90.0, distEast)[0]; 
```

是

```
double lon1 = endOfCourse(lat1, 0.0, 90.0, distEast)[1]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T20:55:59.580

除了其他答案和更新中提到的实现错误之外，我发现了这些公式的大问题。

最大的问题是：距离方法（用于计算两点之间的距离）是计算大圆距离。当然，这是有道理的——这是两点之间的最短路径。 *但是*，除非您在赤道，否则位于同一平行线（纬线）上的两点之间的大圆距离与直接沿纬线行驶时这两点之间的距离不同。

所以：功能正常工作；但是，我在原始问题中提出的替代坐标系要求我们仅查看沿 IDL 向北的距离，然后查看沿所得纬度平行线向东的距离。计算沿特定平行线的距离与计算沿大圆的距离完全不同！

无论如何，你有它。

# data-structures - 实践中的高级数据结构

> ID：389216
> 
> 赞同：45
> 
> 时间：2008-12-23T15:49:35.847
> 
> 标签：data-structures

在我从事编程的 10 年中，我一方面可以数出我使用过的数据结构的数量：数组、链表（我将堆栈和队列与此混为一谈）和字典。考虑到我编写的几乎所有应用程序都属于数据表单/CRUD 类别，这并不令人惊讶。

我从来不需要使用红黑树、跳过列表、双端队列、循环链表、优先级队列、堆、图或过去 50 年来研究的数十种奇异数据结构中的任何一种. 我觉得我错过了。

这是一个开放式问题，但这些“异国情调”的数据结构在实践中在哪里使用？有没有人有使用这些数据结构来解决特定问题的实际经验？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-23T19:24:30.063

一些例子。它们含糊不清，因为它们是为雇主工作的：

*   获得前 N 个结果的[堆](http://en.wikipedia.org/wiki/Heap_(data_structure))会导致 Google 风格的搜索。（从索引中的候选者开始，线性地遍历它们，通过最大大小为 N 的最小堆筛选它们。）这是用于图像搜索原型的。

*   [布隆过滤器](http://en.wikipedia.org/wiki/Bloom_filter)将有关数百万用户所见内容的某些数据的大小缩减到适合现有服务器的数量（为了速度，所有这些数据都必须在 RAM 中）；最初的设计将需要许多新服务器来仅用于该数据库。

*   [三角阵列表示](http://en.wikipedia.org/wiki/Array_data_structure#Non-linear_formulas)将推荐引擎的密集对称阵列的大小减半（出于同样的原因，再次使用 RAM）。

*   用户必须根据某些关联进行分组；[union-find](http://en.wikipedia.org/wiki/Disjoint-set_data_structure#Disjoint-set_forests)使这变得简单、快速和准确，而不是缓慢、笨拙和近似。

*   一个根据附近居民的驾驶时间选择零售地点的应用程序使用了[Dijkstra 最短路径](http://en.wikipedia.org/wiki/Dijkstra's_algorithm)和优先队列。其他 GIS 工作利用了[四叉树](http://en.wikipedia.org/wiki/Quadtree)和[Morton](http://en.wikipedia.org/wiki/Z-order_(curve))索引。

了解数据结构领域的内容会派上用场——“在实验室里呆上几周可以节省你在图书馆里呆的时间”。布隆过滤器案例之所以有价值，只是因为它的规模：如果问题是在初创公司而不是雅虎出现的，我会使用一个普通的旧哈希表。我认为其他示例在任何地方都是合理的（尽管现在您不太可能自己编写代码）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-23T15:53:56.337

[B树](http://en.wikipedia.org/wiki/B-tree)在数据库中。

[R-trees](http://en.wikipedia.org/wiki/R-tree)用于地理搜索（例如，如果我有 10000 个形状，每个形状都有一个散布在二维平面周围的边界框，这些形状中的哪一个与任意边界框 B 相交？）

[C++ STL](http://www.sgi.com/tech/stl/Deque.html)[中](http://en.wikipedia.org/wiki/Deque)形式的双端队列是可增长的向量（比链表更节省内存，并且在中间“窥视”任意元素的恒定时间）。据我所知，我从未完全使用过双端队列（从两端插入/删除），但它足够通用，您可以将其用作堆栈（从一端插入/删除）或队列（插入一方面，从另一端删除）并且还具有查看中间任意元素的高性能访问权限。

我刚刚读完[Java 泛型和集合](http://books.google.com/books?id=3keGb40PWJsC)——“泛型”部分让我头疼，但集合部分很有用，它们指出了跳过列表和树之间的一些区别（两者都可以实现映射/集）：跳过列表为您提供了从一个元素到下一个元素的内置恒定时间迭代（树是 O(log n) ），并且在多线程情况下实现无锁算法要简单得多。

优先级队列用于调度其他事情（这是一个简要讨论应用程序的[网页）；](http://users.csc.tntech.edu/~algviz/priority_queue/applications.php)堆通常用于实现它们。我还发现堆排序（至少对我而言）是最容易理解和实现的 O(n log n) 排序。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-23T15:53:47.400

它们经常在图书馆的幕后使用。例如，有序字典数据结构（即允许按键排序遍历的[关联数组）很可能不使用](http://en.wikipedia.org/wiki/Associative_array)[红黑树来实现。](http://en.wikipedia.org/wiki/Red-black_tree)

许多数据结构（想到[展开树）因其在某些情况下的最佳行为（在展开树的情况下](http://en.wikipedia.org/wiki/Splay_tree)[是参考的时间局部性](http://en.wikipedia.org/wiki/Memory_locality)）而有趣，因此它们主要与这些情况下的使用相关。在大多数情况下，了解这些数据结构的真正好处是能够在正确的情况下使用它们，并对它们的行为有合理的理解。

以排序为例：

*   在大多数情况下，[快速排序](http://en.wikipedia.org/wiki/Quicksort) 或修改后的快速排序在各个段变得足够小时时下降到另一种方法通常是大多数用途的最快排序算法。但是，快速排序往往会在几乎排序的数据上表现出次优行为。

*   [堆排序](http://en.wikipedia.org/wiki/Heap_sort)的主要优点是它可以用最少的中间存储就地完成，这使得它非常适合在内存受限的系统中使用。虽然它的平均速度较慢（尽管仍然是 n log(n)），但它并没有受到快速排序的最坏情况性能的影响。

*   第三个例子是[归并排序](http://en.wikipedia.org/wiki/Merge_sort)，它可以按顺序进行，使其成为对比主存大得多的数据集进行排序的最佳选择。另一个名称是“外部排序”，这意味着您可以使用外部存储（磁盘或磁带）对中间结果进行排序。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-23T15:53:27.897

这取决于您工作的抽象级别。

我知道我和你有类似的经历。在大多数软件开发的当前抽象级别。字典和列表是我们使用的主要数据结构。

我认为，如果您低头查看较低级别的代码，您会看到更多“异国情调”的数据结构。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-23T15:55:47.190

[我在嵌入式工作中不断使用环形缓冲区/循环队列来服务中断（例如串行端口）。](http://www.coe.uncc.edu/~jmconrad/ECGR4101Common/notes/UNCC-IESLecture12%20-%20Interrupt-Driven%20Serial%20Communications.ppt)

[树结构在计算机图形学中大量使用。](http://en.wikipedia.org/wiki/Kd-tree)

[如果您使用 STL 映射或设置数据结构，那么您可能在不知不觉中使用了红黑树！](http://www.ddj.com/184410531)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-23T18:33:16.280

我认为您看到大多数高级算法都使用了花哨的数据结构。我想到的主要示例是 A*，它使用由堆实现的图形和优先级队列。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-18T03:36:22.453

在金融领域，您需要使用树来计算依赖于许多其他动态值的工具的价值。电子表格具有类似的依赖关系树，编译器在转换为机器代码之前会创建一个抽象语法树。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-04-21T22:44:50.317

[**斐波那契堆**](http://en.wikipedia.org/wiki/Fibonacci_heap)用于高效实现[**Dijkstra 算法**](http://en.wikipedia.org/wiki/Dijkstra's_algorithm)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-23T15:54:17.193

是的，有时。我看到的问题是，许多人虽然知道它们，但他们不知道如何真正应用它们。大多数人恢复到数组链表等。在大多数情况下，他们将作为更高级的数据结构完成工作（有时你真的必须“踢”到位），他们只是效率较低。人们倾向于做对他们来说更容易的事情，但这不一定是做某事的最佳方式。我不能责怪他们，我相信我也这样做，但这就是为什么你在编程中看不到很多“高级”概念的原因。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-23T16:04:12.103

我使用循环链表来实现我将永远迭代的队列（在 C 中），即网络连接队列。

但是我发现，当我使用高级语言时，我发现自己不会费心以这种方式实现队列，因为我可以动态地扩大和缩小列表，而不必过多担心它。当然，这是有性能代价的，因为我对内存分配何时发生的控制较少，但这是我们为能够拥有非常灵活的列表而付出的代价之一。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-23T16:16:17.587

当代码需要时，您会倾向于看到更复杂的数据结构。通常，当您在较低级别处理更复杂的代码时，我会看到这一点，即在核心操作系统中，编写类库的基本部分（实现字符串、数组等），编写高性能或多线程代码等。我认为它们发挥重要作用的另一个地方是在实现特定算法时，搜索、采样、统计分析、优化等算法通常是在考虑特定数据结构的情况下编写的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-23T16:38:22.440

我经常使用集合、排序集合（始终保持其元素排序，并支持快速元素插入）和惰性列表。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-10-28T07:51:57.360

平衡树（红黑等）通常用于抽象数据类型的实现。

只有相对较少的抽象数据类型，例如

*   列表
*   地图
*   有序地图
*   多地图
*   有序多图
*   优先级队列（看起来很像一个有序的多图）

同样，集合看起来很像地图，但您不需要值，只需要键。

我不时发现其中大部分很有用；优先级队列是一种非常有用的数据结构，在各种算法中都有应用（例如调度、路径查找等）。

您说“字典”，您可能指的是地图或有序地图。

一些地图是无序的（通常实现为哈希） - 这是有序地图的有用子集。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-05-06T10:06:31.387

我使用**循环列表**进行缓存。

C++ 类模板提供了获取对象的接口 ( `Cache<Obj, Len>`)。它的几个实例返回不同类型的“屏幕”，就像在图形界面的不同视图中一样。在幕后，如果请求的“屏幕”不可用，它会被创建（昂贵的操作）并推送到环形缓冲区的头部，将最旧的一个推出（卸载其纹理等）。

因此，在始终从硬盘读取一堆图像文件与将所有图像加载到 RAM 中并永久保存它们之间实现了折衷。折衷由各种缓冲区的长度控制。

# memory - 如何确定最大堆栈使用量？

> ID：389219
> 
> 赞同：51
> 
> 时间：2008-12-23T15:50:36.313
> 
> 标签：memory, embedded, stack, code-analysis

有哪些方法可用于确定嵌入式/内存受限系统的最佳堆栈大小？如果它太大，则浪费了可以在其他地方使用的内存。但是，如果它太小，那么我们会得到这个网站的同名......

尝试快速开始：Jack Ganssle 在*[《设计嵌入式系统的艺术》中](https://rads.stackoverflow.com/amzn/click/com/0750698691)*指出，**“通过经验，人们学会了标准的、科学的方法来计算堆栈的适当大小：随机选择一个大小并希望。”** 谁能做得比这更好？

要求提供更具体的示例。那么，如何使用[IAR Embedded Workbench](http://www.iar.com/website1/1.0.1.0/50/1/index.php?)工具链在没有操作系统的情况下针对具有 2 kB RAM的[MSP430 MCU的 C 程序呢？](http://focus.ti.com/mcu/docs/mcuprodoverview.tsp?sectionId=95&tabId=140&familyId=342)此 IDE 可以在使用 JTAG 调试器时显示堆栈内容和使用情况。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-23T16:21:54.783

确定最深堆栈使用的最常见方法是使用一些已知但不寻常的值初始化堆栈内存，然后定期（或在大型测试运行结束时）查看该模式停止的位置。

这正是 IAR IDE 确定使用的堆栈数量的方式。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-23T16:13:35.237

您用静态分析标记了您的问题，但这是一个很难通过静态分析解决的问题。堆栈使用取决于程序的运行时配置文件，尤其是在使用递归或 alloca 时。鉴于这是一个嵌入式平台，我想运行*ps*或*top*之类的东西并查看您的应用程序正在使用多少堆栈也很困难。

一种有趣的方法是使用当前堆栈帧的地址来确定使用了多少堆栈。您可以通过获取函数参数或局部变量的地址来做到这一点。对*main*函数和您认为使用最多堆栈的函数执行此操作。差异将告诉您应用程序所需的堆栈数量。这是一个示例（假设习惯上从高到低的堆栈增长）。

```
char *stack_top, stack_bottom;

int
main(int argc, char *argv[])
{
    stack_top = (char *)&argc;
    // ...
    printf("Stack usage: %d\n", stack_top - stack_bottom);
}

void
deeply_nested_function(void)
{
    int a;
    stack_bottom = (char *)&a;
    // ...
} 
```

如果您的编译器允许您指定自定义函数序言（许多这样做是为了允许基于图形的程序分析），您甚至可以安排所有函数调用此类测量代码。然后你的测量功能类似于

```
void
stack_measurement_function(void)
{
    int a;
    stack_bottom = min(stack_bottom, (char *)&a);
    // ...
} 
```

我使用类似于我所描述的方法来生成[这些图表](http://www.spinellis.gr/codequality/stack.gif)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-07-14T04:41:08.853

使用好的源代码静态分析工具，您可以为您的应用程序生成调用图。鉴于此，以及编译器生成的本地/临时数量的估计，您可以直接计算堆栈需求的保守估计。

我所说的“好”分析工具是一种可以读取所有涉及的编译单元，可以确定直接函数调用，可以确定间接指针，在编译单元中，可以计算整个系统的保守点分析，可以构建考虑到点分析的调用图。这消除了许多工具，这就是为什么人们会看到诸如“在运行时填充堆栈并查看会发生什么”之类的临时方法。您还需要估计编译器在堆栈上放置的堆栈需求；您可以通过简单地了解所有类型的存储需求有多大来估算其中的大部分内容，这对于嵌入式系统 C 程序通常相当容易确定。最后，您需要相信您的应用程序没有递归调用，

DMS Software Reengineering Toolkit 满足 C 程序的所有这些要求。请参阅[http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html) 您仍然必须对其进行配置以通过爬取调用图并使用各种大小估计来计算堆栈需求。

如果您想要一个快速的答案，请使用堆栈填充技巧。如果您想要一个可以在每次更改源代码后重新计算的答案，您将需要静态分析方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-08-07T19:12:00.900

我现在正在解决这个问题 - 即堆栈大小的分析计算。这显然将是一段高度递归的代码，因为函数调用可以将索引数组作为其一个或多个参数，并且一个或多个数组索引可能涉及函数调用！

然而，一些实现可以从复杂性中解脱出来：

(1) 使用高级语言编译器时，每条语句/代码行执行结束时的堆栈指针应与开始时的位置相同。（至少这是一个很好的规则，否则你会遇到问题！）

(2)每个函数或子程序调用返回后的堆栈指针应与调用前相同。因此，最大堆栈大小是程序中所有语句中每个语句达到的峰值堆栈大小的最大值。（至少这是一个很好的规则，否则你会遇到问题！）

当然，一条语句可以包含我上面提到的递归问题，但至少找到整个程序的最大堆栈大小要求的问题归结为找到每个语句的最大堆栈大小要求，然后选择其中的最大值。

在所有调用的函数也都被编译之前，这无法完成。因此，我为每个编译的模块生成一个文件，记录每个语句的堆栈大小（基本上是每个函数调用之前的峰值和每个函数调用之前的值（不包括由函数引起的任何未知的堆栈大小添加） call) 以及所涉及的函数名称。然后，一旦编译了所有函数，我就使用递归例程回顾性地处理这些文件，以确定峰值堆栈大小。

幸运的是，除了递归例程之外，最大可能的堆栈大小要求并不取决于程序流，尽管在典型的流（取决于数据）中，可能永远不会达到最大可能的堆栈大小。

示例：假设函数 1 调用函数 2，并且两者的程序流程都依赖于数据值 X。假设有一个 X 范围导致函数 1 执行其最差的语句，其中包括对函数 2 的调用，该语句不执行对于相同范围的 X，它是最坏情况的陈述。由于我们同时使用函数 1 和函数 2 的最坏情况来计算最大可能的堆栈大小，因此我们可能高估了堆栈大小。至少我们在安全方面犯了错误。

如果需要，我喜欢在 OS 堆栈上为中断例程提供自己的堆栈空间，因此它们不会增加程序堆栈要求，除了从中断返回的地址

* * *

## 回答 #5

> 赞同：-11
> 
> 时间：2011-12-27T22:58:00.207

*   ***永远***不要**使用递归或递归算法。（当心正则表达式库）**
***   **不要**使用数组，总是使用 malloc()。*   **不要**使用 alloca()，一些编译器甚至在这个函数中有 bug。**

 **然后*手动*检查代码部分，寻找堆栈使用率可能最高的位置（记住我说没有数组）

*   检查代码本身*可疑* **高点的堆栈使用情况，记录到调试器界面。**
*   根据估计的堆栈使用情况设置一个上限，该上限就位。例如限制服务器连接。

# process - 如何将新的发展推向生产环境？

> ID：389221
> 
> 赞同：2
> 
> 时间：2008-12-23T15:50:49.743
> 
> 标签：process, production, staging

一旦我们的 Web 应用程序在生产环境中使用，我们就很难通过增强或错误修复来更新它。主要原因是我们 CMS 系统设计的初始缺陷。我们通常必须花费数小时来更新每个产品环境，并且多次出现错误和长时间的调试。看起来我在抱怨，所以让我们回到讨论的客观部分。

该缺陷在于内容和编程功能如何一起存储在数据库中。所以基本上数据是如何显示的，数据本身是如何存储在数据库中的。有一些文件系统更改，但它们与内容无关。此外，应用程序本身创建了许多我们无法在数据库中跟踪的引用。

正如您所看到的，当最终用户和利益相关者使用应用程序时，我们的开发团队必须以手动方式发布生产中的更改。

另一个问题是，当数据库被修改时，应用程序会动态更改文件系统。所以我们的开发环境和生产环境现在都不同了，为了同步他们的数据，他们的数据必须去，或者开发团队必须经历很多手工工作。

**我可以解释更多，甚至给你更多的例子。如果您需要，请给我评论。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T15:56:23.103

自动化手工。仔细记下您需要执行的所有操作，以便将应用程序从开发环境转移到生产环境，并创建一个脚本来自动运行这些操作。例如，脚本将删除所有包含应用程序特定数据的表，然后根据应用程序的当前需求重新创建它们。

将脚本拆分为多个部分以简化测试和调试。例如，一部分可能是 shell 命令，另一部分可能是 SQL 命令。使用充足的日志记录和错误检查。使脚本成为应用程序开发过程的一部分，并将它们置于修订控制之下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T15:58:58.137

I have definitely experience similar pains in the past... Here is how I overcame them.

1.  Split out the data that is code (that is any data in the database that is not customer data but is essential to the functioning of the app. Pull all those tables into a seperate database.

2.  Write SQL scripts that populate that data into the database. This will allow you to recreate the skeleton of your app without relying on production data or a backup.

3.  Take as much of the data that doesn't truly dynamically change, and put it in property files and configuration files. Flat file storage for this kind of data is ideal. Its faster to read, and doesn't have to be maintained with the database.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T15:57:10.560

虽然这不会解决您的所有问题，但您可能会发现有用的是拥有一组“一键式”脚本/批处理文件，它可以刷新您的开发数据库以具有与生产相同的结构并使用一些示例数据填充它。（这是我们在上一份工作中所做的，对我们来说效果很好）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T15:57:37.093

我们通过脚本以相同的方式进行所有开发、QA 和生产部署。在 QA 和生产中没有手戳过任何东西。在我们的例子中，我们使用[Ant](http://ant.apache.org/)，但这只是因为它为我们提供了进行所有更改所需的功能。因此，您需要像任何其他代码一样控制构建过程并将其版本化为脚本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T17:11:38.163

听起来您也可以使用一个好的数据库比较工具。它可以帮助您生成允许您在环境之间迁移的脚本等。

如果你有 SQL Server，我听说[Red Gate](http://www.redgate.com/)有很好的工具，比较工具叫做 SQL Compare。

我的观点相同，您需要弄清楚如何通过安装程序、SQL 脚本或自定义 .NET 应用程序来自动化“升级”，以操纵数据库和“升级”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T17:20:27.270

此外，您可能对[Liquibase](http://www.liquibase.org/)感兴趣。它是一个开源工具，用于跟踪数据库数据和模式更改，并且可以轻松地应用您在生产环境中对开发数据库执行的重构。它是独立的 DBMS（供应商）。我还建议自动执行升级产品部署的步骤，如前所述。

# c# - Windows Mobile 和 VS2008，无法连接到设备

> ID：389238
> 
> 赞同：1
> 
> 时间：2008-12-23T15:55:50.997
> 
> 标签：c#, .net, compact-framework

我刚给自己买了一个新玩具，一部装有 Windows Mobile 6 的手机。我正在尝试用 VS2008 (C#) 编写一个简单的“Hello World”应用程序，但无法连接到设备。它通过 ActiveSync（通过 USB）连接，我可以浏览文件系统，但由于某种原因，当我尝试构建应用程序并将其部署到设备时，它显示“连接到设备失败”。

我在设备上安装了 Windows Mobile 6 Professional SDK 以及 .net Compact Framework 3.5 运行时，一切正常。我可以在模拟器上运行应用程序，但由于某种奇怪的原因，我无法连接到设备。我知道这不是很多信息，但我完全不知所措！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T16:17:26.057

有几种可能性，但很可能与安全有关。运营商可以选择[锁定设备](http://blogs.msdn.com/windowsmobile/archive/2007/05/14/what-do-you-mean-by-locked.aspx)以防止您安装“未经授权”的应用程序。还有安全的粒度。许多设备可以运行应用程序，但前提是它们已签名。某些设备允许您更改此设置，或者它们至少会告诉您未签名的应用程序正在尝试运行并询问您是否正常。使用[设备安全 Powertoy](http://www.microsoft.com/downloads/details.aspx?FamilyID=7e92628c-d587-47e0-908b-09fee6ea517a&displaylang=en)可能允许您配置设备以允许您进行部署。[在此处](http://www.pocketpcfaq.com/faqs/provisioning/provisioning.htm)和[此处](http://msdn.microsoft.com/en-us/library/ms894922.aspx)阅读有关配置的更多信息。

您可能需要使用[开发证书](http://msdn.microsoft.com/en-us/library/bb158503.aspx)或真实证书对应用程序进行签名 - 特别是如果您计划部署应用程序。

# .net - 从 C++ DLL 使用 VB.NET 类库的最佳方法是什么？

> ID：389244
> 
> 赞同：2
> 
> 时间：2008-12-23T15:57:23.973
> 
> 标签：.net, c++, vb.net, dll, ntvdm

我需要在 C++ 项目中使用我的 VB.NET 项目之一。两者之间的接口将用于 C++ 代码实例化和调用 .NET 程序集对象之一上的方法。

两者都编译为 DLL（然后 C++ DLL 作为 VDD 从 NTVDM 加载，但这可能不相关。）

如果可能的话，我想避免为此使用 COM，因为我需要在不接触注册表的情况下进行部署。此外，我正在为 C++ 和 VB.NET 使用 Visual Studio 2008 Express 版本。

请问，最好的方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T16:01:38.163

如果您不想使用 COM**并且我不怪您**，我只会创建一个 Web 服务，并通过它公开您的功能。它易于在 C++ 中访问 Web 服务，并且易于在 VB.NET 中公开。

（更新）

[这](http://geekswithblogs.net/marcel/archive/2007/04/02/110610.aspx)是一个博客链接，讨论如何在没有 IIS 的情况下公开 Web 服务

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T16:24:30.300

您真的需要本机 C++ 还是可以使用 C++/CLI？

如果您可以在 C++/CLI 中完成所有操作，那么您最终将获得一个纯 .NET 应用程序。

如果您需要“本机”C++，那么您可以直接从 Visual Studio 创建一个包含托管和非托管 C++ 的程序集（本机 C++ 调用 C++/CLI，然后调用您的 VB.NET）。

而且，如果您希望将全部内容放在一个程序集中，您可以按照[将本机 C++ 链接到 C# 应用程序](http://blogs.msdn.com/texblog/archive/2007/04/05/linking-native-c-into-c-applications.aspx)的说明进行操作。它也应该适用于 VB.NET。

我强烈推荐 Heege (1-59059-756-7) 的“Expert C++/CLI”

# visual-studio - 下载团队系统时“未下载”

> ID：389253
> 
> 赞同：2
> 
> 时间：2008-12-23T15:59:13.567
> 
> 标签：visual-studio, tfs

环境：

团队基础服务器 2005 视觉工作室 2008

我有一个相当大的项目，每个代码分支下面有几个代码分支和几个子文件夹、解决方案等。

在一个特定的分支中，我有一个包含 3 个子文件夹的文件夹。其中一个文件夹被正确标记为“最新：是”。但是，其他两个标记为“最新：未下载”。文件夹中的文件标记类似。此外，我无法查看这些文件夹中的文件，因为 VS2008 无法识别我拥有最新版本。

我查看了安全属性，它们似乎在“好”文件夹和“坏”文件夹之间是相同的。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T19:44:22.607

我发现并纠正了这个问题。那是我在一个特定的代码分支中工作。但是，我的一些解决方案文件的代码类似于：

```
SccProjectName1 = $/MyProject/Release_3_3/Source/ 
```

当我真正在以后的版本中工作时，版本 3.4。由于这是硬编码到解决方案文件中的（它是如何到达那里的？），它为我创建了一个新的工作区，但仅适用于该解决方案下的项目。

当我的源代码的其余部分在工作区中映射到更高版本的分支时，当它试图从旧分支中检出一些项目文件时，一定存在冲突。

从解决方案文件中删除这行代码后，一切正常。

# delphi - 在 Delphi 中，我可以从同名的类方法中调用实例方法吗？

> ID：389254
> 
> 赞同：4
> 
> 时间：2008-12-23T15:59:33.753
> 
> 标签：delphi

Delphi 中是否可以让类方法调用具有相同名称的继承实例方法？例如，我尝试过这样的事情：

```
//... Skipped surrounding class definitions

function TSomeAbstractDialogForm.Execute: Boolean;
begin
  Result := ShowModal = mrOk;
end; 
```

我有几个继承抽象对话框表单的专用对话框类，每个类都有自己的工厂方法：

```
class function TSomeInheritingDialogForm.Execute: Boolean;
var
  Fm: TSomeInheritingDialogForm;
begin
  Fm := TSomeInheritingDialogForm.Create(nil);
  try
    Result := Fm.Execute;
  finally
    Fm.Free;
  end
end; 
```

这种方法导致了一个永无止境的循环，因为 F.Execute 没有调用基类的预期实例方法，而是一遍又一遍地调用工厂方法（导致一堆创建的表单）。

当然，显而易见的解决方案是更改工厂方法的名称（我将其命名为 CreateAndShow），但这让我很好奇。为什么编译器没有警告我隐藏方法？有没有办法在这种情况下显式调用实例方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T16:09:19.350

你可以试试硬演员。但最好重命名类函数。（例如 CreateAndExecute）。

子类中的 Execute 隐藏了父类中的执行（我认为编译器会为此发出警告）。您可以通过硬演员来访问它。但是没有办法区分实例方法和类方法。

```
function TSomeAbstractDialogForm.Execute: Boolean;
begin
  Result := ShowModal = mrOk;
end;

class function TSomeInheritingDialogForm.Execute: Boolean;
var
  Fm: TSomeInheritingDialogForm;
begin
  Fm := TSomeInheritingDialogForm.Create(nil);
  try
    Result := TSomeAbstractDialogForm(Fm).Execute;
  finally
    Fm.Free;
  end
end; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T19:41:55.457

**结果 := 继承的 Execute**不会这样做，因为它是在创建的变量上调用的，而不是在类方法中。

问题是让类函数和静态方法同名是个坏主意。编译器将它们视为两个独立的世界，可以彼此靠近编写。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T17:01:26.060

不会

```
Result := inherited Execute; 
```

做这个把戏？

# .net - 为什么 dotnet 的 char.IsLower() 是静态方法？

> ID：389257
> 
> 赞同：6
> 
> 时间：2008-12-23T16:00:31.067
> 
> 标签：.net, static, char

这似乎违背了每一个设计准则。接受 T 类型的单个参数的静态方法通常应该只是成员方法。

太奇怪了，我实际上不得不发布一个[StackOverflow 问题](https://stackoverflow.com/questions/389100/is-there-a-built-in-islowercase-in-net)来了解 IsUpper 的存在（因为它没有出现在自动完成中）

**编辑**

我知道我之前的陈述需要一点解释。一个好的设计示例是 String.ToLower()。它不是被原型化为静态 void ToLower(String foo)，而是一个成员方法。很明显（至少对我而言）char.IsLower() 也应该如此。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T16:45:31.537

结构上的实例方法**不是线程安全**的。另一方面，静态方法**是**.

静态方法接收结构的副本，实例方法接收托管指针。通过指针访问数据不是安全操作，很容易导致竞争条件。

这就是为什么结构/基元上的大多数方法都是静态的而不是实例的。

这里有一个类似的问题。

[为什么 IsNan 是 Double 类的静态方法而不是实例属性？](https://stackoverflow.com/questions/370859/why-isnan-is-a-static-method-on-the-double-class-instead-of-an-instance-property#370996)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T16:20:14.177

另请参阅[此](https://stackoverflow.com/questions/23228/why-is-stringformat-static)问题。

简短版本 - 当从字符串文字调用时，最初的 IDE 遇到了智能感知问题（我也假设为 char 文字）。因此设计者将方法设为静态来解决这个问题。

重新编辑：我在这里对 .NET 设计师屈服于来自 IDE 设计师的压力有些抱怨。但是看到 Pop 对这个问题的回答后，我现在对此不太确定了。

EDIT2：蒂姆在评论中问我们是否知道这是真的，或者只是猜测。我找不到对这个问题的确切参考，但我发现了一篇 2002 年的文章，讨论了字符串文字中的智能感知错误。大约在[这一](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1050614.html)页的一半。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T16:44:32.803

在我看来，这确实是有道理的。

有许多接受单个参数的静态方法。用这样的方法计算平方根不是很好：

```
double d = 100.0;
Console.WriteLine("Square root of d is " + d.Sqrt()); 
```

这会降低 OO 设计的“凝聚力”，这不是一个好的做法。把这个职责分给`Math`类会更好。

```
double d = 100.0;
Console.WriteLine("Square root of d is " + Math.Sqrt(d)); 
```

# visual-studio-2008 - 在 Visual Studio 2008 中调试 Web 应用程序

> ID：389277
> 
> 赞同：0
> 
> 时间：2008-12-23T16:06:29.057
> 
> 标签：visual-studio-2008, debugging, web-applications

当我的同事在他的 Visual Studio 实例中调试 Web 应用程序时，他的输出窗口会流式传输所有正在编译的程序集（至少我相信这是它正在做的事情），但我没有。我确实看到状态栏中的文本“Ready”间歇性地闪烁，我认为这类似于转储到我的同事输出窗口的内容。有谁知道我需要翻转哪个开关才能使其在我的实例上工作？我们的两个输出窗口都配置为“显示输出：”调试。我问这一切的原因是因为这个特别臭的应用程序我被要求帮助它需要大约两三分钟才能“启动”

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T17:16:22.693

您要确保对构建输出使用 Verbose（或其他比 Minimal 更多的东西）设置。然后只需确保您的输出窗口已打开，并将下拉菜单设置为“构建”。

Tools->Options->Projects and Solutions->Build and Run->MSBuild project build output verbosity dropdown

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T17:28:00.360

我注意到的另一件事是，在“构建”网站（而不是 Web 应用程序）时，与 Web 应用程序相比，构建过程需要很长时间。我认为缓慢的构建速度只是网站编译方式的副产品，而不是代码本身。

此外，通常您在就绪字段中看到闪烁的那些 dll 是正在加载到调试器中的调试程序集/符号文件/等以及附加到进程的所有内容......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T20:35:56.160

我发现如果我在“显示”时右键单击“输出”窗口的控制台区域：“调试”选择了它们有 6 个不同的输出可供选择，其中有几个没有在我的机器上选择，但它们在我的机器上被选中同事机器，现在我正在接收我正在寻找的输出。至于其他问题，我现在正在调查它，看起来很多 HttpCompileExceptions 和 NullReferenceExceptions 在“旋转”时被抛出......有趣，不确定这是否是正常行为。

# iphone - 在 iPhone 应用程序中直接在屏幕上绘制单个像素的最快方法是什么？

> ID：389289
> 
> 赞同：5
> 
> 时间：2008-12-23T16:09:01.550
> 
> 标签：iphone, cocoa-touch, opengl-es

我正在寻找一种最快的方法，可以在性能非常好的 iPhone 应用程序中将数千个单独计算的像素直接绘制到屏幕上。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T16:16:25.450

为什么不使用 OpenGL 视图？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T16:23:10.413

最有可能使用 OpenGL，例如：

```
glBegin(GL_POINTS);
glColor3f(...);
glVertex3f(...);
...
glEnd(); 
```

更快的可能是使用[顶点数组](http://www.opengl.org/sdk/docs/man/xhtml/glVertexPointer.xml)来指定点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-28T08:29:59.863

在我曾经使用过的所有图形框架中，您这样做的方式是将像素写入内存块（例如 ARGB 或 RGBA 格式），然后将整个内存块推送到图形子系统。没有“绘制一点”API 可能很快，如果您想快速绘制数千个像素，您需要推送图像/纹理/位图/无论您想要调用它，而不是推送单个点一次。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T16:21:29.060

我会创建一个视图大小的 BMP，将其添加到视图中并绘制到 BMP 中。Cocoa 没有任何方法可以将单个像素绘制到视图中，除了通过使用长度为 1 像素的线条来伪造它，就像[这个问题](https://stackoverflow.com/questions/313018/how-do-i-draw-a-point-using-core-graphics)提到的那样。

# c# - Can't debug - "The breakpoint will not currently be hit. No symbols have been loaded for this document"

> ID：389290
> 
> 赞同：16
> 
> 时间：2008-12-23T16:09:02.140
> 
> 标签：c#, .net, asp.net, debugging

I'm getting the error in the subject line. I'm running vs2k8 on server 2k3sp2\. I've tried deleting the pdbs, cache directories, verifying that debugging is set up on the specific page. The interesting thing is other pages debug just fine. Just when I go to this one page. Must be a configuration issue but the page directive looks like this:

print("<%@ Page Language='C#' AutoEventWireup='true' CodeBehind='MemberSearch.aspx.cs' Inherits='SurencyPortal.EmployerPortal.MemberSearch' Debug='true' %>");

I've also noticed that when debugging, if I open the modules window, almost all of the symbols show a status of 'Symbol not loaded'. However, after more research from the msdn article below, one of the MSFT posts said that if it's a core .net dll, it will not load symbols so I'm not worried about that. Some of the microsoft modules (like System.Enterpricesservices.wrapper.dll) show an exclamation point with the message 'the module did not load at the default load address'. Not sure why that dll is there as I don't know of any calls to it.

Here are the thing's i've tried:

[Breakpoint not hooked up when debugging in VS.Net 2005](https://stackoverflow.com/questions/163133/breakpoint-not-hooked-up-when-debugging-in-vsnet-2005)

[http://social.msdn.microsoft.com/Forums/en-US/vbide/thread/557fdedb-268e-48a8-9944-29b2b4e0dec2/#page:3](http://social.msdn.microsoft.com/Forums/en-US/vbide/thread/557fdedb-268e-48a8-9944-29b2b4e0dec2/#page:3)

Bill

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T07:28:22.513

我遇到过这样的问题的唯一一次是如果我在项目处于发布模式时尝试调试。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T16:13:50.087

I usually see this error pop up when I am working with two separate web 'sites'. I have a web front end and a web service back end. If the development server isn't running for the 'site' the code file is for, then you will receive that error message.

This may not be your problem exactly, however this is usually the situation when I see that error message. Another thing you can do is Debug -> Attach to Process if the debugger isn't attached to the correct process.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-25T08:08:57.633

放置一个内联[break 语句](http://msdn.microsoft.com/en-us/library/system.diagnostics.debugger.break.aspx)以确保您实际上正在运行代码。如果您不停止，那么您尝试调试的代码很可能没有运行，或者您没有使用托管调试器对其进行调试。

如果您确实停止但找不到源代码，那么您可能没有该模块的 pdb。检查调用堆栈窗口的顶部以查看哪个程序集包含您停止的方法。这是您需要 pdb 的程序集。模块窗口将显示该组件在磁盘上的位置。命令行工具“dumpbin -headers assembly.dll”将转储 PE 标头。检查调试目录以查看构建程序集时 pdb 的放置位置。如果调试目录不存在，则程序集是在没有调试信息的情况下构建的。如果是这种情况，那么您的问题是确定为什么在没有调试信息的情况下构建了该特定程序集。如果它确实有调试信息并且 pdb 存在，但没有被加载，那么这意味着 pdb 不是 t 由调试器找到，您应该查看 tools\options\debug\symbol 设置。或者 pdb 和程序集不匹配。如果时间戳不在 1 秒内，那么它们肯定不匹配。

如果以上没有帮助，请更新更多信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T16:35:24.553

通常，当 VS 用于调试的 .pdb 文件与代码实际执行的文件不同时，就会发生这种情况。也就是说，如果您对程序集进行了更改。
另外，请确保您`<compilation debug="true">`在 web.config 中有。我不知道它是否与 page 指令有任何关系，但这通常对我有用:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T16:48:32.123

我同意当我有多个不同步的程序集和/或一个或多个 pdb 与源不匹配时，我已经看到了这一点。就我而言，这是因为我的版本控制软件 (ClearCase) 很奇怪，而且我实际上并没有按照我的想法进行编译。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-10-28T05:57:54.407

如果您有一个“WebSite”项目，而不是“WebApplication”，我发现重叠的代码文件类可能会导致问题。有几种方法可以发生这种情况。不幸的是，Visual Studio 似乎仍然可以毫无错误地编译解决方案/项目。

1.  在网站上的文件夹之间移动页面。
2.  移动页面后合并源代码管理可能会导致页面重复，并且 Visual Studio 在调试期间会感到困惑。
3.  复制和粘贴现有页面（模板）也可能导致内存出现这种情况。

为了解决这个问题我

1.  在解决方案中搜索“Class TheProblemPageCodeSymbolIssue”以查找重复项。
2.  重构了类名后面的那些重复代码并测试了所有这些页面，以确保我可以使用调试断点。

希望有帮助。

# c# - 使用 C# 使用相同的 ObjectDataSource 更新多个数据库

> ID：389298
> 
> 赞同：1
> 
> 时间：2008-12-23T16:10:09.690
> 
> 标签：c#, .net, ado.net

有没有办法在 C# 中使用单个 ObjectDataSource 更新多个具有相同架构的数据库？？？

即仅仅通过提供多个连接字符串是否有可能更新多个数据库？我需要使用 C# 中的 ObjectDataSource 在具有相同架构的多个数据库中更新/插入相同的记录。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T16:29:53.723

是的，您可以这样做，因为使用 ObjectDataSource，您就是编写插入代码的人。在您的“更新”和“删除”方法中，您可以简单地执行两个数据库操作，一个用于您正在使用的每个数据库。您可以将其抽象为可以通过连接传递的操作，以确保您不会到处都有重复的代码。

**注意**
您不能通过单个连接来执行此操作，您必须执行两个完全独立的数据库操作。

**例子**

根据评论，要求提供更多详细信息。

基本上在您的每个方法中，只需执行两个数据库调用，一个粗略且格式不正确的示例，以显示下面的概念，用于“删除”方法。

```
public void DeleteMyObject(int objectId)
{
    SqlConnection connectionOne = new SqlConnection("MyFirstDbConnection");
    SqlConnection connedtionTwo = new SqlConnection("MySecondDbCOnnection");
    SqlCommand myCommand = new SqlCommand(connectionOne);
    myCommand.CommandText = "DELETE FROM myTable where myid = " + objectId.ToString();
    connectionOne.Open();
    myCommand.ExecuteNonQuery();
    connectionOne.Close();
    myCommand.Connection = connectionTwo;
    connectionTwo.Open();
    myCommand.ExecuteNonQuery();
    connectionTwo.Close();
} 
```

显然，需要使用存储过程，以及正确的 using 语句或 try/catch，但这可以理解。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T11:11:35.063

考虑“**米切尔卖家**”的建议并进行一些更改：-

为**ObjectDataSource**创建**OnInserting、OnUpdating、OnDeleting**事件，其中处理所有数据库上的 Insert/Update/Delete，但附加到 ObjectDataSource 的数据库除外。

例如

如果存在**DataConnectionString1**、**DataConnectionString2**和**DataConnectionString3**并且**DataConnectionString1**附加到**ObjectDataSource1**然后考虑下面给出的 ObjectDataSource1_ObjectUpdating 事件代码......

protected void ObjectDataSource1_ObjectUpdating（对象发送者，ObjectDataSourceMethodEventArgs e）

{

```
 string name = (string)e.InputParameters["name"];

    int id = (int)e.InputParameters["id"];

    if (string.IsNullOrEmpty(name))
        e.Cancel = true;

    else
    {
        // Here insert in all Databases currently present 
        // Except DB with StorageIndex = 1 as will b updated by ObjectDataSource1

        for (int index = 2; index <= 3; index++)
        {
            string DataConnectionString = ConfigurationManager.AppSettings["DataConnectionString " + index]);
            SqlConnection con = new SqlConnection(DataConnectionString);
            string query = "UPDATE student SET [name] = @name WHERE (([id] = @id))";
            int cnt = Utils.executeQuery(query, con, new object[] { "@name", "@id" }, new object[] { name, id });
        }
    }
} 
```

这就是我所做的！！！希望它也可以帮助其他人......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T16:21:13.053

我会说不；我认为这是不可能的，因为 SqlCommand 必须与一个连接字符串相关联。

既然您使用的是 ObjectDataSource，为什么不编写一个处理它的“中间层”对象呢？通常，我将有一个名为 CustomerManager 的类，它公开了 ObjectDataSource 为 CRUD 操作所需的所有方法。

假设您正在更新客户的地址，并且需要触及另一个数据库：您的 CustomerManager 类中的 Update(...) 方法然后可以在该方法内调用这两个数据库。这种方法的好处是您甚至可以将所有内容包装在 TransactionScope 块中，如果您要更新多个数据库，.NET 会自动将事务“升级”为分布式事务。

我希望这足以让你朝着正确的方向前进！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T16:56:23.123

不确定您打算做什么，但如果您的目标是避免在其中一台服务器上发生崩溃时丢失数据，那么许多数据库服务器可以自动将所有数据复制到备份服务器。如果您想了解更多信息，请谷歌搜索“sql cluster”

# architecture - 理想的 .NET 架构？

> ID：389318
> 
> 赞同：8
> 
> 时间：2008-12-23T16:17:58.347
> 
> 标签：architecture

我是从 ASP.NET 应用程序的角度来写这个问题的。但是我意识到它也可能适用于其他情况。

有很多方法可以开发 ASP.NET 网站的通用元素。以下是我遇到的一些：

*   LLBLGen
*   亚音速
*   LINQ 到 SQL
*   实体框架
*   CodeSmith + .netTiers
*   休眠
*   手工编码 DAL/BLL/Presentation

无论如何，我都不认为自己是专家级的开发人员，但我确实非常了解常见的 OOP 技术，并且可以很好地完成我的所有项目。然而，我确实很难知道如何“设计”一个网站。我的意思是，我应该使用 [n 层架构](http://en.wikipedia.org/wiki/Multitier_architecture)吗？那仍然是黄金标准吗？上述工具只是利用了这个概念吗？我很确定我想推迟 MVC 直到未来（或最终）发布。

*****编辑：在更充分地理解了问题的分离之后，我删除了处理模式（单例、工厂）的问题部分。感谢到目前为止所有回答这部分的人，但是，我的主要关注点是架构部分。*****

*编辑#2：当我意识到这不仅仅适用于特定于网络的架构时，我将标题更改为一个不可知论的问题。*

* * *

**问题：**当我坐在空白画布（解决方案文件）前，手头有所有预先编写的文档和系统要求时，我会采取哪些步骤作为第一步？我从那里去哪里？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T16:28:15.050

我认为您概述的每种方法都有其优点和缺点。您选择哪个取决于个人喜好、团队成员的经验和项目类型 - Linq2Sql 非常适合快速启动和运行，但可能不适合大型和/或复杂的企业项目，例如..你能做的最好的事情就是尝试一些并了解它们。

至于模式，它们以一种行之有效的方式帮助解决特定的和反复出现的问题。它们还有助于不编写代码的开发人员熟悉。如上所述，值得尝试一些以了解它们的作用以及何时使用它们 - 但它们解决了特定的编程问题而不是架构模式。

我的典型工作流程是：

*   创建逻辑实体模型
*   为实体模型创建数据存储
*   创建数据访问代码和业务对象
*   创建逻辑/业务层
*   创建表示层

我通常会将数据访问和业务对象、业务逻辑和演示文稿（网站/winforms）拆分到他们自己的项目中，再加上我以后可能想要重用的任何东西也放在它自己的项目中。我还有一个包含通用扩展和接口的 Base 项目，我几乎可以在我所做的所有事情中重复使用这些扩展和接口。

在架构方面，我尽量确保我的项目是松耦合的，这样您就可以轻松地从三层架构迁移到 n 层架构。松耦合还意味着您可以切换您的后备存储，您需要做的就是编写一个新的数据访问层，而您的所有逻辑和表示代码都保持不变。

我认为重要的是不要过于关注**三层**与**n**层 - 如果您将您的关注点分开正确地在以后跨多个层扩展您的系统将不是一个困难的练习。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T16:36:46.063

如此广泛（而且很好）的问题。深呼吸。

不要脱离设计模式，但与架构策略相比，它们是策略。当然要学习它们，但这在这里并不是特别相关。

您在问题中提到的许多事情并不相互排斥，可以被视为整个架构特定部分的子策略。我的个人喜好随着时间的推移和经验发生了巨大的变化，我对一些迷人的技术仍然完全天真，但我认为只有一个全球性的建筑常数：

**关注点分离**。

我认为这个原则是你的“黄金标准”，它提供了很多好的东西：单元测试、合同设计、依赖注入、MVC、n-tier。我说第一步是了解 SoC，第二步是通过测试驱动开发对其采取行动。我认为其他一切都有利有弊，但维护、概念和首先识别问题所驱动的架构的好处是毋庸置疑的。

我的书签文件夹不是我想象的那样，但这些是巩固我对此事的看法的一些在线文章：

*   [SoC的重要性](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.59.5311)
*   [TDD 简介](http://www.agiledata.org/essays/tdd.html)
*   [更多关于 TDD](http://www.developerspot.com/tutorials/php/test-driven-development/page1.html)
*   [IBM 关于参考架构的文章](http://www.ibm.com/developerworks/rational/library/2774.html)

* * *

*编辑：你从哪里开始空白画布？*

添加您选择的单元测试库并勾勒出测试（又名事实）。

**测试>设计>代码>转到1**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-23T16:24:16.370

我个人是 n 层架构的粉丝。刚开始时，我通常会为 Web 应用程序创建两个项目，第一个用于业务逻辑和数据库访问，这是一个类库项目。然后我为实际网站添加了一个 Web 应用程序项目。

我过去构建了一个数据访问框架，我使用该框架利用 Microsoft 数据应用程序块进行所有数据访问，这就是我用来构建所有数据调用的方法。

我有时使用 codesmith 或其他项目，但到目前为止，我发现运气更好，只是滚动我自己的代码，因为我可以更精细地处理数据。当然，如果我有时间研究其他 ORM 工具，我可能不需要担心它......

我发现最好的方法通常是创建业务对象、数据验证和应用程序的所有“业务”部分。然后在数据访问片段中编程，最后将所有内容与演示代码放在一起。能够做到这一点需要一些纪律，但它可以确保您以可重复使用的方式构建事物，并且我取得了巨大的成功。

您引用的这本书也可能是一个很好的例子。

*评论中的补充*

回应发表的评论。通常在我的业务/数据类库中，我将使用命名空间将逻辑与数据分开。这里完成了一些关键的事情。

1.  我的数据方法调用都限制在程序集的范围内，它们不是可以直接调用的项目，这样我就可以通过所有表示调用者的业务逻辑强制数据访问

2.  所有数据输入和输出都是通过对象完成的，而不是 DataSet 或任何其他变体

3.  验证后的业务方法会从数据组件中调用特定的方法来获取所需的信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T16:37:07.903

我不排除 ASP.NET MVC。

候选版本将于 1 月发布，令人惊讶的是，这一次微软似乎在遵循 RC 的真正含义，除非发现任何显示阻止错误，否则它也将成为 RTM 版本。

[关联](http://weblogs.asp.net/scottgu/archive/2008/12/19/asp-net-mvc-design-gallery-and-upcoming-view-improvements-with-the-asp-net-mvc-release-candidate.aspx)

# wix - 如何从 Wix/DTF 中的即时自定义操作安排延迟自定义操作？

> ID：389331
> 
> 赞同：1
> 
> 时间：2008-12-23T16:21:57.217
> 
> 标签：wix, windows-installer, custom-action, dtf

我已经看到这样的声明，即有可能，甚至很常见，从 .wxs 文件中引用一个即时自定义操作，并让该自定义操作安排后续（延迟）自定义操作。我不知道这样做的代码是什么样的。任何人？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T16:31:18.213

没关系，自己找到了答案：

Session.DoAction("ActionName")

# wpf - WPF ListBox 能不能让它循环？IE 没有在顶部和底部遇到硬停

> ID：389341
> 
> 赞同：1
> 
> 时间：2008-12-23T16:25:26.587
> 
> 标签：wpf, listbox, collections, cycle, databound

我有一个绑定到数据对象的 WPF ListBox。列表框内是一系列带有文本的图像。它以水平方式布局，将鼠标悬停在框的左侧或右侧分别向左或向右滚动项目。

假设列表框中有 20 个项目。我试图弄清楚当我点击位置 19 项目（基于 0）时，我可以循环该框并重新开始收集，以便它变为 1 -19 等等。它还需要以另一种方式循环，这样如果你在项目 0 上，向左滚动，你会得到 19。

我已经尝试过 KeyboardNavigation.DirectionalNavigation="Cycle" 但这似乎对我没有任何作用，而且我正在抓住稻草，因为这与键盘无关，它都是基于鼠标的。

```
 <ListBox ItemsSource="{Binding Source={StaticResource WPFApparelCollection}}" Margin="24,-7,39,-19" ScrollViewer.VerticalScrollBarVisibility="Hidden" ScrollViewer.HorizontalScrollBarVisibility="Hidden" SelectionMode="Single" x:Name="list1" MouseLeave="List1_MouseLeave" MouseMove="List1_MouseMove" Style="{DynamicResource ListBoxStyle1}" Background="Transparent" BorderThickness="0">
            <ListBox.Resources>
                <!-- override the system brushes so that selected items are transparent whether the ListBox has focus or not -->
                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent" />
                <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="Transparent" />
                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black" />
            </ListBox.Resources>
            <ListBox.ItemContainerStyle>
                <Style TargetType="{x:Type ListBoxItem}">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="HorizontalContentAlignment" Value="{Binding Path=HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" />
                    <Setter Property="VerticalContentAlignment" Value="{Binding Path=VerticalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" />
                    <Setter Property="Padding" Value="20,10,20,10" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                <Border x:Name="Bd" SnapsToDevicePixels="true" Background="Transparent" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="true">
                                        <Setter Property="Background" TargetName="Bd" Value="Transparent" />
                                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}" />
                                    </Trigger>
                                    <MultiTrigger>
                                        <MultiTrigger.Conditions>
                                            <Condition Property="IsSelected" Value="true" />
                                            <Condition Property="Selector.IsSelectionActive" Value="false" />
                                        </MultiTrigger.Conditions>
                                        <Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" />
                                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
                                    </MultiTrigger>
                                    <Trigger Property="IsEnabled" Value="false">
                                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListBox.ItemContainerStyle>
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel Orientation="Horizontal" IsItemsHost="True" />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Vertical">
                        <Image Source="{Binding Image}" MouseLeave="Image_MouseLeave" MouseEnter="Image_MouseEnter" Cursor="Hand" Tag="{Binding Link}" MouseLeftButtonDown="Image_MouseLeftButtonDown" VerticalAlignment="Top" HorizontalAlignment="Left"></Image>
                        <Label Content="{Binding Name}" Cursor="Hand" Tag="{Binding Link}" MouseLeftButtonDown="Label_MouseLeftButtonDown" VerticalAlignment="Bottom" Foreground="White" Style="{StaticResource Gotham-Medium}" FontSize="8pt" HorizontalAlignment="Center" />
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T15:18:01.007

这里的问题不在于**ListBox**，而在于其控件模板中的**ScrollViewer ；**因此，要使项目循环，您需要以某种方式更改**ScrollViewer**。我已经编写了一个从**ScrollViewer**派生的控件，该控件在垂直方向上循环......但是应该很容易看出如何使它也可以水平工作。

```
public class CyclicScrollViewer : ScrollViewer
{
    public CyclicScrollViewer()
    {
        this.CommandBindings.Add(new CommandBinding(ScrollBar.LineUpCommand, LineCommandExecuted));
        this.CommandBindings.Add(new CommandBinding(ScrollBar.LineDownCommand, LineCommandExecuted));
    }

    private void LineCommandExecuted(object sender, ExecutedRoutedEventArgs e)
    {
        if (e.Command == ScrollBar.LineUpCommand)
        {
            if (this.VerticalOffset == 0)
                this.ScrollToEnd();
            else
                this.LineUp();
        }

        if (e.Command == ScrollBar.LineDownCommand)
        {
            if (this.VerticalOffset == this.ScrollableHeight)
                this.ScrollToTop();
            else
                this.LineDown();
        }
    }
} 
```

*ScrollTo...*和*Line...*方法已经存在于**ScrollViewer**中，使得编码非常简单。我在这里所做的只是在滚动之前检查当前偏移量与查看器的边界。

下一步是将新的**ScrollViewer**插入到目标控件的控件模板中，在本例中为**ListBox**。这是一个 XAML 片段来演示这一点。

```
 <ControlTemplate x:Key="{x:Type ListBox}" TargetType="ListBox">
            ...
                <l:CyclicScrollViewer 
                    Padding="{TemplateBinding Control.Padding}" 
                    Focusable="False">
                    <ItemsPresenter ... />
                </l:CyclicScrollViewer>
            ...
        </ControlTemplate> 
```

我在[***此处***](http://www.box.net/shared/eu0c5o1u2u)发布了一个使用此代码的示例应用程序。此示例不支持键盘，但可以通过重写**OnKeyDown**方法并执行适当的*Line...*命令来简单地添加它。我希望这有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T15:09:40.370

有许多免费和商业的 WPF 轮播实现可以做到这一点。看看这个综述[http://mdavey.wordpress.com/2007/04/03/wpf-carousel/](http://mdavey.wordpress.com/2007/04/03/wpf-carousel/)

# ios - How to get the size of a scaled UIImage in UIImageView?

> ID：389342
> 
> 赞同：52
> 
> 时间：2008-12-23T16:27:27.033
> 
> 标签：ios, objective-c, cocoa-touch, uiimageview, uiimage

The `image.size` attribute of `UIImageView` gives the size of the original `UIImage`. I would like to find out the size of the autoscaled image when it is put in the `UIImageView` (typically smaller than the original).

For example, I have the image set to `Aspect Fit`. Now I want to know its new height and width on the screen so I can draw accurately on the new scaled image.

Is there any way to do this without figuring it out myself based on the UIImageView size & UIImage original size (basically reverse engineering its scaling)?

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2011-02-13T23:10:55.197

**目标-C：**

```
-(CGRect)frameForImage:(UIImage*)image inImageViewAspectFit:(UIImageView*)imageView
{
    float imageRatio = image.size.width / image.size.height;
    float viewRatio = imageView.frame.size.width / imageView.frame.size.height;
    if(imageRatio < viewRatio)
    {
        float scale = imageView.frame.size.height / image.size.height;
        float width = scale * image.size.width;
        float topLeftX = (imageView.frame.size.width - width) * 0.5;
        return CGRectMake(topLeftX, 0, width, imageView.frame.size.height);
    }
    else
    {
        float scale = imageView.frame.size.width / image.size.width;
        float height = scale * image.size.height;
        float topLeftY = (imageView.frame.size.height - height) * 0.5;

        return CGRectMake(0, topLeftY, imageView.frame.size.width, height);
    }
} 
```

**斯威夫特 4：**

```
func frame(for image: UIImage, inImageViewAspectFit imageView: UIImageView) -> CGRect {
  let imageRatio = (image.size.width / image.size.height)
  let viewRatio = imageView.frame.size.width / imageView.frame.size.height
  if imageRatio < viewRatio {
    let scale = imageView.frame.size.height / image.size.height
    let width = scale * image.size.width
    let topLeftX = (imageView.frame.size.width - width) * 0.5
    return CGRect(x: topLeftX, y: 0, width: width, height: imageView.frame.size.height)
  } else {
    let scale = imageView.frame.size.width / image.size.width
    let height = scale * image.size.height
    let topLeftY = (imageView.frame.size.height - height) * 0.5
    return CGRect(x: 0.0, y: topLeftY, width: imageView.frame.size.width, height: height)
  }
} 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2016-01-27T08:16:55.743

这个简单的函数将计算图像的大小：-

```
[imageView setFrame:AVMakeRectWithAspectRatioInsideRect(image.size, imageView.frame)]; 
```

有关更多详细信息，您可以参考[AVMakeRectWithAspectRatioInsideRect - AVFoundation](https://developer.apple.com/documentation/avfoundation/1390116-avmakerectwithaspectratioinsider)。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-01-24T10:31:10.047

这个简单的函数将在方面拟合后计算图像的大小：

```
-(CGSize)imageSizeAfterAspectFit:(UIImageView*)imgview{

    float newwidth;
    float newheight;

    UIImage *image=imgview.image;

    if (image.size.height>=image.size.width){
        newheight=imgview.frame.size.height;
        newwidth=(image.size.width/image.size.height)*newheight;

        if(newwidth>imgview.frame.size.width){
            float diff=imgview.frame.size.width-newwidth;
            newheight=newheight+diff/newheight*newheight;
            newwidth=imgview.frame.size.width;
        }

    }
    else{
        newwidth=imgview.frame.size.width;
        newheight=(image.size.height/image.size.width)*newwidth;

        if(newheight>imgview.frame.size.height){
            float diff=imgview.frame.size.height-newheight;
            newwidth=newwidth+diff/newwidth*newwidth;
            newheight=imgview.frame.size.height;
        }
    }

    NSLog(@"image after aspect fit: width=%f height=%f",newwidth,newheight);

    //adapt UIImageView size to image size
    //imgview.frame=CGRectMake(imgview.frame.origin.x+(imgview.frame.size.width-newwidth)/2,imgview.frame.origin.y+(imgview.frame.size.height-newheight)/2,newwidth,newheight);

    return CGSizeMake(newwidth, newheight);

} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2016-04-05T14:07:28.917

[cncool answer](https://stackoverflow.com/a/4987554/320926)的改编，作为 UIImageView 的扩展，也许对某人有用：

```
extension UIImageView{
    func frameForImageInImageViewAspectFit() -> CGRect
    {
        if  let img = self.image {
            let imageRatio = img.size.width / img.size.height;

            let viewRatio = self.frame.size.width / self.frame.size.height;

            if(imageRatio < viewRatio)
            {
                let scale = self.frame.size.height / img.size.height;

                let width = scale * img.size.width;

                let topLeftX = (self.frame.size.width - width) * 0.5;

                return CGRectMake(topLeftX, 0, width, self.frame.size.height);
            }
            else
            {
                let scale = self.frame.size.width / img.size.width;

                let height = scale * img.size.height;

                let topLeftY = (self.frame.size.height - height) * 0.5;

                return CGRectMake(0, topLeftY, self.frame.size.width, height);
            }
        }

        return CGRectMake(0, 0, 0, 0)
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-30T02:42:24.760

由于您已将图像视图设置为 Aspect Fit，您可以简单地获取图像视图的高度和宽度以及原始图像的高度和宽度，并计算缩放图像的高度和宽度。

也就是说，*更好*的方法是使用自定义视图而不是 UIImageView。然后，在自定义视图中自己绘制图像。这样你就可以控制它的各个方面。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-11-12T17:21:51.297

我写了一个有用的扩展，其中包括它的一组附加内容，可能值得一试。

**包含的功能**

```
func getScaledImageSize() -> CGRect?
func getScaledImageSizeWithPadding() -> CGRect?
func getPaddingTop() -> CGFloat? {
func getPaddingBottom() -> CGFloat? {
func getPaddingLeft() -> CGFloat? {
func getPaddingRight() -> CGFloat?
func getScaledCoordinate(forX x: CGFloat, andY y: CGFloat, multiplier:CGFloat = 100.0) -> CGPoint?
func getScaledCoordinateWithPadding(forX x: CGFloat, andY y: CGFloat, multiplier:CGFloat = 100.0) -> CGPoint? 
```

[https://gist.github.com/nathan-fiscaletti/e1b85f68559f305db7342bfff9574563](https://gist.github.com/nathan-fiscaletti/e1b85f68559f305db7342bfff9574563)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-10-26T14:44:57.153

跟进@MeetDoshi，这是一个应该适应这个的扩展。

```
extension UIImageView {
    /// Retrieve the scaled size of the image within this ImageView.
    /// - Returns: A CGRect representing the size of the image after scaling or nil if no image is set.
    func getScaledImageSize() -> CGRect? {
        if let image = self.image {
            return AVMakeRect(aspectRatio: image.size, insideRect: self.frame);
        }

        return nil;
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T17:23:42.613

如果在保持图像纵横比的情况下填充框架，则 imageview 框架将与图像大小不同。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-23T17:21:39.857

如何从它的框架中获取 UIImageView 的大小？即imageView.frame？

# database - 每周计划 - 您如何将其存储在数据库中？

> ID：389343
> 
> 赞同：11
> 
> 时间：2008-12-23T16:28:08.733
> 
> 标签：database, datetime, data-structures, timespan

目前，我正在开展一个项目来管理服务器数据库等的维护窗口。基本上，我只需要精确到小时，但允许将它们设置为每天允许或禁止一周中的。

我对如何做到这一点有一些想法，但由于我自己工作，我不想在没有反馈的情况下承诺任何事情。

**为了可视化这一点，它就像流动的“图表”**

```
 | Sun | Mon | Tue | Wed | Thu | Fri | Sat |
    -------------------------------------------
5AM |allow|allow|allow|deny |deny |allow|allow|
    -------------------------------------------
6AM |allow|deny |deny |deny |deny |deny |allow|
    -------------------------------------------
7AM |allow|deny |deny |deny |deny |deny |allow|
    -------------------------------------------
8AM |allow|deny |deny |deny |deny |deny |allow|
    -------------------------------------------
9AM |allow|deny |deny |deny |deny |deny |allow|
    -------------------------------------------
... etc... 
```

有没有这样做的标准方法或资源可以给我一些想法......

1.  制作可以轻松保存和恢复的格式
2.  使其可在数据库中搜索（例如，不必反序列化它来搜索时间）

**[更新]**

值得一提的是，即使不太可能，也可以将一天设置为“允许、拒绝、允许、拒绝……等等……”。不能保证跨度是一整天的唯一跨度。

这也不是唯一的时间表，将有数百台设备，每个都有自己的时间表，所以它会变得毛茸茸的......哈哈？？

**Rob**询问是否需要跟踪每周 - 不需要。这是适用于全年的通用时间表（定期维护）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-23T16:40:57.583

对于 (1)，我会考虑使用包含开始时间和结束时间的格式，以及一周中某一天的整数字段。我知道你说这些块总是一小时，但这可以通过你的代码来强制执行。此外，如果您的需求有一天发生变化，那么您在步骤 (2) 中的担心要比您的 DB 语句全部编写为假设 1 小时块的情况要少得多。

```
CREATE TABLE maintWindow (
   maintWindowId  int primary key auto_increment not null,
   startTime      Time,
   endTime        Time,
   dayOfWeek      int,
   ... 
```

对于 (2)，如果每条记录都有与之关联的开始和结束时间，那么很容易检查任何给定时间的窗口：

```
SELECT maintWindowId
FROM maintWindow
WHERE $time >= TIME(startTime) AND $time <= TIME(endTime) AND DAYOFWEEK($time) = dayOfWeek 
```

（其中`$time`表示您要检查的日期和时间）。

一周中每一天的允许或禁止将由单独的记录处理。恕我直言，这比一周中的每一天的硬编码更灵活，因为您将使用某种 case 语句或 if-else 开关来检查您感兴趣的那一天的正确 DB 列。

**注意：**确保您知道您的数据库在一周中的整数天使用哪种标准，并尝试使您的代码独立于它（始终询问数据库）。对于一周开始（周日或周一）和起始索引（0 或 1）的不同标准，我们玩得很开心。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T16:42:55.380

如果每周都不一样，那么就这样设置表；

```
TABLE:
    StartTime DATETIME    PrimaryKey 
```

如果设置了特定日期/小时的开始时间，则假定它是允许的，否则拒绝。

如果是通用一周的通用配置不变，试试这个；

```
TABLE:
    Hour  INT,
    Day   INT,
    Allow BIT 
```

然后为每个小时/天组合添加行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T17:05:48.360

我之前实际上使用过这种设计，基本上是为您想要定期安排的时间跨度除以您想要的周期数创建一个位图。因此，在您的示例中，您需要一个以小时为单位的周计划，因此您将拥有一个只有 21 个字节长的 168 位位图。几个日期时间加在一起是 16 个字节，您需要其中的多行来表示给定一周的可能时间表，所以如果您完全关心大小，我认为您无法击败它。

我承认它处理起来有点棘手，而且比以前的建议更不灵活。考虑一下，如果您突然想要使用 1/2 小时的时间段，您需要将所有现有数据转码为新的 336 位图并将值分发出去。

如果您使用 SQL，您可以将其存储为二进制博客并进行位旋转以比较您自己是否打开或关闭位，或者您可以将每个位存储为一列。MS SQL Server 支持高达 1024 的标准表或 30k 的宽表，因此您可以轻松地将粒度降至 10 分钟，或者对于 30k 表更精细。

我希望这会增加关于如何完成的一些不同的观点。仅当您担心空间/大小或者您可能有 10 或 100 数百万个时，才真正有必要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T17:21:59.357

您可以轻松地在表格中记录“允许”时间。这样，如果它不存在，则不允许。如果您需要更多可变的“时间表”，您可以轻松添加年份和月份字段。

```
 TABLE DBMaintSched
      ID int PK
      ServerID varchar(30) (indexed)
      Day int
      Month char(3)
      DayOfWeek char(3)
      Year int
      StartDT DateTime
      EndDT DateTime 
```

2008 年 12 月：

```
 SELECT * FROM DBMaintSched WHERE ServerID = 'SQLSERVER01' AND Month = 'DEC' AND Year = 2008 ORDER BY DAY ASC 
```

您可以在 2008 年 12 月的所有日子里进行维护。随心所欲地显示。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-10-02T10:34:25.507

每个提议的解决方案对我都有好处，无论如何，如果您遇到性能和/或表大小问题，我会考虑这个。由于您可能会在时间和您的实体（即服务器）之间建立关系，因此大小将增加 entity_number * entity_times。如果每个时间跨度都有一行，这可能会很痛苦。

这个提议在表结构方面略显丑陋，但在磁盘空间和表扫描速度方面更有效。

```
TABLE times
    entityFK int -- your entity foreign key
    day INT      -- 0-7 day identifier
    bit time0    -- ON if the time 00:00 - 00:59 is being covered
    bit time1 
    bit time2
    -- more columns
    bit time23 
```

考虑您希望在周日和周一为服务器分配 16:00 - 20:00 正常运行时间的示例，您将只有两行，例如

```
entityFK | day | time16 | time17 | time18 | time19 | -- other bits are set to 0
server1    0     1        1        1        1
server1    1     1        1        1        1 
```

您将假设每个缺失的行都意味着服务器已关闭。

如果您需要，您可以考虑为日期列使用 DATE 格式来设置特定日期（即正常运行时间仅为 2013/10/02 16:00 和 20:00 之间）。

希望能帮助到你

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T16:32:46.570

也许像

```
TABLE:
   StartTime DATETIME      PrimaryKey,
   EndTime   DATETIME      PrimaryKey,  /*if you are positive it will be in one hour incerments then you might want to omit this one*/
   Monday    BIT,
   TuesDay   BIT,
   Wednesday BIT,
   Thursday  BIT,
   Friday    BIT,
   Saturday  BIT,
   Sunday    BIT 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-06-29T20:00:00.137

用 Python 编写，这样的模块可能会工作 - [https://github.com/AndrewPashkin/pytempo](https://github.com/AndrewPashkin/pytempo)

# sql - 复合主键是否应该聚集在 SQL Server 中？

> ID：389348
> 
> 赞同：12
> 
> 时间：2008-12-23T16:29:34.720
> 
> 标签：sql, database, database-design, primary-key

考虑这个示例表（假设 SQL Server 2005）：

```
create table product_bill_of_materials
(
    parent_product_id int not null,
    child_product_id int not null,
    quantity int not null
) 
```

我正在考虑包含两个 product_id 列（我肯定想要一个唯一约束）的复合主键，而不是一个单独的唯一 ID 列。问题是，从性能的角度来看，该主键是否应该集群？

我是否还应该在每个 ID 列上创建一个索引，以便更快地查找外键？我相信这张表在读比写上会受到更多的打击。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-23T17:35:08.740

正如其他几个人已经说过的那样，这取决于您将如何访问该表。但请记住，只要该列首先出现，任何 RDBMS 都应该能够使用聚集索引按单个列进行搜索。例如，如果您的聚集索引在 (parent_id, child_id) 上，则您不需要在 (parent_id) 上建立另一个单独的索引。

您最好的选择可能是 (parent_id, child_id) 上的聚集索引，它也恰好是主键，在 (child_id) 上具有单独的非聚集索引。

最终，应该在您了解如何访问数据库之后解决索引问题。如果可以的话，提出一些标准的性能压力测试，然后使用分析工具（SQL Profiler for SQL Server）分析行为并从那里进行性能调整。如果您不具备提前执行此操作的专业知识或知识，请尝试（希望是有限的）应用程序发布，收集性能指标，并查看您需要在哪里提高性能并找出哪些索引会有所帮助.

如果你做对了，你应该能够捕获如何访问数据库的“典型”配置文件，然后当你尝试各种索引方法时，你可以在测试服务器上一遍又一遍地重新运行它。

在您的情况下，我可能只是在 (parent_id, child_id) 上放置一个聚集 PK，然后仅当我看到可以帮助的性能问题时才添加非聚集索引。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-23T16:48:04.387

“您最常查询的内容”不一定是选择集群索引的最佳理由。最重要的是您查询什么以获得多行。集群是一种适合于高效地以最少的磁盘读取次数获得多行的策略。

最好的例子是客户的销售历史。

假设您在 Sales 表上有两个索引，一个在 Customer 上（可能还有日期，但这一点适用于任何一种方式）。如果您最常在 CustomerID 上查询该表，那么您会希望将所有客户的销售记录放在一起，以便为所有记录提供一到两次磁盘读取。

主键 OTOH 可能是代理键或 SalesId，但在任何情况下都是唯一值。如果这是聚集的，与普通的唯一索引相比，它没有任何好处。

编辑：让我们来讨论这个特定的表格 - 它会揭示更多的微妙之处。

“自然”主键很可能是 parentid + childid。但按什么顺序？Parentid + childid 并不比 childid + parentid 更独特。出于聚类目的，哪种排序更合适？有人会假设它必须是 parentid + childid，因为我们会想问：“对于给定的项目，它的成分是什么”？但是，不是不太可能想要走另一条路，并询问“对于给定的成分，它是哪些项目的组成部分？”。

加入“覆盖索引”的考虑，在索引中包含满足查询所需的所有信息。如果这是真的，那么您永远不需要阅读记录的其余部分；所以集群是没有好处的；只需阅读索引就足够了。（顺便说一句，这意味着同一对字段上的两个索引，顺序相反；在这种情况下，这可能是正确的做法。或者至少一个上的复合索引，另一个上的单字段索引。 )

但这仍然不能决定哪个应该集群。这最终可能取决于哪些查询实际上需要获取 Quantity 字段的记录。

即使是这样一个清晰的例子，原则上最好在您可以用真实数据测试它们之前（显然是在生产之前）对其他索引做出决定；但是在这里问猜测是没有意义的。测试总是会给你正确的答案。

忘记担心会减慢插入速度，直到遇到问题（在大多数情况下永远不会发生），并且可以测试以确保放弃有用的索引以获得可衡量的好处。

但是，事情仍然不确定，因为像这样的联结表也经常涉及许多其他类型的查询。因此，我只需要选择一个并根据需要进行测试，因为应用程序凝胶化，并且用于测试的数据量变得可用。

顺便说一句，我希望它最终会在 parentid + childid 上进行 PK；childid 的非唯一索引；和第一个集群。如果您更喜欢代理 PK，那么您仍然需要 parentid + childid 上的唯一索引，聚集。对代理键进行聚类不太可能是最优的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T16:32:40.470

这里真正的问题是您最想查询什么？如果您一直在寻找这两个值，那么集群应该在这对上。如果您要更多地查询其中一个或另一个，您会希望集群在那个特定的那个上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T16:41:30.377

我想对你最后的陈述归零。“我相信这张表在读取方面会比在写入方面受到更多影响。” 如果是这种情况，那么您可能想要重索引。我们不在每件事上都使用大量索引的原因是您为表的更新和插入付出了性能损失。当我们的表提供更多的读取而不是写入时，就要为索引付出代价。

至于要聚类什么，您应该考虑如何最好地使用该表。如果您的表受到大量范围查询（WHERE col1 IS BETWEEN a AND b）的影响，则对表进行集群，以便范围查询已经在磁盘上按顺序设置。在 SQL Server 中，有时我们通过 PK 免费获得集群，而我们忘记了从什么开始最好集群。

至于表上的 FK 约束，因为您说读多于写，这可能是可以接受的。如果这是一个包含大量插入的表，则每个 FK 约束都需要针对父表进行验证，这可能无法为您提供所需的性能。

好问题。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-23T16:40:04.840

既然您说“我正在考虑使用复合主键”，那么您可能还有时间改变主意。我使用了许多复合键，并且我一直在寻找希望我没有使用的理由。也许其他人会不同意我的观点。

我同意 Mitchel 的回答，无论您最常查询什么，集群都会继续进行。

# jquery - 如何在 datejs 中正确设置 dateElementOrder 以使用部分日期

> ID：389353
> 
> 赞同：0
> 
> 时间：2008-12-23T16:30:36.263
> 
> 标签：jquery, datejs

在[datejs](http://groups.google.com/group/datejs)中，如果我将 dateElementOrder 设置为“dmy”或“ymd”的 pt-PT 本地化版本而不是“mdy”，则“Partial”测试夹具上的以下测试开始失败：

1/2008；1 2008；1-2008；2008/1；2008 1；2008-1

我需要做什么才能使其工作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-22T08:53:15.190

我对您使用的东西没有经验，但它是否被定义为字面上的“dmy”而不是“mdy”？我想你会区分天数和月数，也许通过确保月份被列为 01、02、03 等......，而对于个位数的天数，天数只是个位数？

这可能是一个错误，您是否将问题发布到他们的[问题](http://code.google.com/p/datejs/issues/list)页面？在你这样做之前仔细检查你的所有语法，只是为了确保它不是一个简单的错误。Javascript 可能会变得混乱。

# asp.net - ConfigurationManager.AppSettings 缓存

> ID：389361
> 
> 赞同：45
> 
> 时间：2008-12-23T16:33:31.810
> 
> 标签：asp.net, .net, performance, caching, configurationmanager

我们知道 IIS 缓存 ConfigurationManager.AppSettings，因此它只读取一次磁盘，直到 web.config 被更改。这样做是出于性能目的。

某人在：

[http://forums.asp.net/p/1080926/1598469.aspx#1598469](http://forums.asp.net/p/1080926/1598469.aspx#1598469)

表示 .NET Framework 对 app.config 的作用不同，但它会从磁盘中读取每个请求。但我很难相信，因为它会更慢。请告诉我他错了，否则我将不得不修复我编写的每个控制台/Windows 窗体/Windows 服务。

**更新**我很遗憾我误解了人们在上面链接的论坛中所说的话。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-23T16:43:02.900

快速测试似乎表明这些设置仅在应用程序启动时加载。

```
//edit the config file now.
Console.ReadLine();

Console.WriteLine(ConfigurationManager.AppSettings["ApplicationName"].ToString());
Console.WriteLine("Press enter to redisplay");

//edit the config file again now.
Console.ReadLine();
Console.WriteLine(ConfigurationManager.AppSettings["ApplicationName"].ToString());
Console.ReadLine(); 
```

您会看到所有输出都保持不变。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2018-06-21T07:58:03.837

尝试一下，

`ConfigurationManager.RefreshSection("appSettings")`

请注意文件名（**在 bin 文件夹中**）

普通文件名：appname. **exe.config**

如果调试模式：appname。**vshost.exe.Config**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-23T16:36:48.793

做与不做都没关系。如果没有，请不要修复性能问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-23T16:45:10.540

它在应用程序启动时读取应用程序配置文件 (MyApp.exe.config) 一次，可以通过在应用程序运行时更改文件轻松验证。

OP引用的论坛帖子中的评论是：

> Web.config 的值在应用程序启动时存储到缓存/内存中，因此为什么在对 web.config 进行任何更改时应用程序会重新启动。请注意，这仅适用于 Web.config，*您可能使用的任何其他 .config 文件默认从磁盘访问*

我将此注释解释为意味着默认情况下从磁盘访问**ASP.NET 应用程序中的web.config 以外的配置文件。**同样，默认情况下，从磁盘访问 WinForms/Console 应用程序中 MyApp.exe.config 以外的配置文件。

此评论并未说明默认情况下从磁盘读取 MyApp.exe.config。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-22T22:46:56.527

AppSettings 被缓存。您可以通过进一步缓存来限制 namevaluecollection 查找来提高性能。

请参阅： [DotNetPearls 静态配置模式](http://www.dotnetperls.com/appsettings-cache)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-23T16:44:58.810

正如约翰所说，只有在您真正看到性能受到影响时才花更多时间在这上面。

此外，我很确定这些应用程序将**配置保存在内存中**，并且要查看配置中的任何更改，必须**重新启动**应用程序。

对于一些关于剩余奥秘的[进一步阅读。](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration.aspx)

# iphone - UITextField - clearButtonMode 仅在代码中，不在 IB 中？

> ID：389368
> 
> 赞同：2
> 
> 时间：2008-12-23T16:37:13.520
> 
> 标签：iphone, cocoa, cocoa-touch

是否有可能在 Interface Builder 中为 UITextField 设置 clearButtonMode？这只能做代码吗？我不认为它是 UITextField 属性面板中的一个选项。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T07:46:15.853

在 Interface Builder 中没有办法做到这一点（从 2.2 SDK 开始）

请参阅[将“清除”按钮添加到 iPhone UITextField](https://stackoverflow.com/questions/320078/adding-the-clear-button-to-an-iphone-uitextfield)

**更新：**从最新版本的 XCode/SDK 开始，IB 现在支持此属性。

# c# - 根据 Windows 主题更改面板的主题（颜色）

> ID：389371
> 
> 赞同：2
> 
> 时间：2008-12-23T16:37:53.550
> 
> 标签：c#, winforms

我想根据当前选择的 Windows 主题更改面板的颜色。我已经设置了道具 EnableVisStyles。它改变了工具栏和 Windows 窗体的标题栏之类的东西。但是面板颜色保持不变。有没有办法实现这一目标？

问候， 苛刻的苏曼

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T16:47:35.310

您可能已经设置了表单或面板的颜色。进入设计器，检查表单和面板上的 BackColor 属性。它们应该设置为控制（在系统选项卡下），而不是特定的颜色。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-23T18:03:52.440

我认为罗伯是对的。您也可以右键单击该属性并选择重置。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-23T20:03:26.427

有两种不同的颜色可供选择。换一种更好的说法，我们称它们为*文字*颜色和*系统*颜色。

**文字**颜色是固定的，并且始终保持不变。如果将面板设置为灰色，它将始终为灰色。

**系统**颜色是动态的——它们被命名为一个目的并随着系统主题而变化。例如，系统颜色“控制”是控制背景的颜色。通常，这是灰色的，但它可以改变。

在**Windows.Forms**中，文字颜色可用作 System.Drawing.Color 上的静态属性，而系统颜色可用作 System.Drawing.Systemolors 上的静态属性。

我认为 WPF 的情况略有不同，但这不是我还熟悉的领域。

# wpf - WPF 按钮 - 按下时的方法

> ID：389377
> 
> 赞同：2
> 
> 时间：2008-12-23T16:38:38.960
> 
> 标签：wpf, button

我想在按钮处于鼠标按下状态（IsPressed）时调用一个方法，并在释放它时调用另一个方法。我似乎想不出一个简单的方法来做到这一点。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T16:49:14.540

如果您处于可以使用绑定的情况，请在按钮的 IsPressed 属性上设置 OneWayToSource 绑定。当源属性更改时，执行您的代码。

无论如何按下按钮，这都应该有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T16:44:19.887

您可以处理 MouseDown 和 MouseUp 事件以获得类似的效果。但这不会处理键盘（空格键）的情况。您必须使用 KeyDown 和 KeyUp 事件来做到这一点。

另请注意，如果用户在按下鼠标后将鼠标移动到不再位于按钮上方的位置，则 MouseDown 事件可能永远不会跟随 MouseUp 事件。（我认为您可以在 MouseDown 中捕获鼠标以保证您获得 MouseUp 事件）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T16:46:17.370

查看 System.Windows.Input 命名空间中的[Mouse](http://msdn.microsoft.com/en-us/library/system.windows.input.mouse.aspx)类。有可用的[MouseDown](http://msdn.microsoft.com/en-us/library/system.windows.input.mouse.mousedown.aspx)和[MouseUp](http://msdn.microsoft.com/en-us/library/system.windows.input.mouse.mouseup.aspx)附加事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T17:09:38.807

当然有更好的方法然后尝试拦截鼠标事件。IsPressed 属性上的某种触发器？

此外，我相当确定您无法在按钮上获取某些鼠标事件，因为它正在被系统拦截。

# unix - tload 中的值是什么意思？

> ID：389388
> 
> 赞同：1
> 
> 时间：2008-12-23T16:43:21.573
> 
> 标签：unix, optimization, ubuntu

我试图维护的服务器正在嘲笑我。

除其他外，我还运行了 tload。这可能会为知道如何读取这些数据的人提供有用的信息。我不。

它说：

> `1.36, 1.12, 0.59 -------------`

我应该从中收集什么？这是我们自己开发的统计服务器，它接收大量请求，并运行 logrotate & crons 日志解析脚本。它还生成包含“前 10 个”内容列表的静态 JSON 文件，并为这些文件提供请求。

*需要更多信息？随便问问*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T16:53:31.973

这些是过去 1、5 和 15 分钟间隔的负载平均值。高于 1 的平均负载意味着进程正在 CPU 上等待。[这是关于平均负载](http://en.wikipedia.org/wiki/Load_(computing))的 Wikipedia 文章。

由于您的平均负载正在下降，因此服务器上的负载似乎是短暂的、间歇性的、沉重的。这也意味着您可能会受到 CPU 限制，尽管这不一定是因为内存或 IO 瓶颈可能会导致大量上下文切换。

也就是说，1.36 并没有那么高，所以我会看看内存或 IO 限制。

# javascript - JavaScript 中的原型继承

> ID：389393
> 
> 赞同：8
> 
> 时间：2008-12-23T16:45:04.317
> 
> 标签：javascript, inheritance, prototypal-inheritance

我一直在看 Douglas Crockford 在 YUI 剧院的演讲，我有一个关于 JavaScript 继承的问题......

Douglas 给出了这个例子来说明“Hoozit”继承自“Gizmo”：

```
function Hoozit(id) {
    this.id = id;
}
Hoozit.prototype = new Gizmo();
Hoozit.prototype.test = function (id) {
    return this.id === id;
}; 
```

为什么他写`Hoozit.prototype = new Gizmo()`而不是`Hoozit.prototype = Gizmo.prototype`？

这两者有什么区别吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-23T16:48:33.823

原因是 using`Hoozit.prototype = Gizmo.prototype`意味着修改 Hoozit 的原型对象也会修改 Gizmo 类型的对象，这不是预期的行为。

`Hoozit.prototype = new Gizmo()`从 Gizmo 继承，然后单独离开 Gizmo。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-29T14:09:40.767

其他答案解决了这个问题，但如果你确实想继承原型，你可以使用一些寄生魔法：

```
Object.prototype.inherit = function(p) {
    NewObj = function(){};
    NewObj.prototype = p;
    return new NewObj(); 
};

// Paraphrasing of Nicholas Zakas's Prototype Inheritance helper
function inheritPrototype(subType, superType) {
    var prototype = Object.inherit(superType.prototype);
    prototype.constructor = subType;
    subType.prototype = prototype;
}; 
```

现在您可以替换：

```
Hoozit.prototype = new Gizmo(); 
```

和

```
inheritPrototype(Hoozit, Gizmo); 
```

除非你有一个真正的大 Gizmo 构造函数，否则这可能不值得麻烦（我的建议中唯一的胜利是你不必调用 Gizmo 的构造函数来连接原型）。*[我在TDD JavaScript 示例](http://github.com/roblevintennis/Testing-and-Debugging-JavaScript)*中有许多此类模式的示例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T16:49:44.353

如果他写 Hoozit.prototype = Gizmo.prototype 他以后对 Hoozit 原型所做的任何修改都将反映在 Gizmo 原型中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T17:08:10.773

除了 Triptych 的回答：Hoozit 实例也会继承 Gizmo 的所有实例属性，不仅是原型中定义的那些；例如：

```
function Gizmo() {
    this.foo = 'bar'; // foo is visible in every Hoozit instance
} 
```

# sharepoint - 使用母版页上的列表项

> ID：389396
> 
> 赞同：1
> 
> 时间：2008-12-23T16:45:39.867
> 
> 标签：sharepoint, sharepoint-designer

我正在使用带有自定义母版页的 MOSS Publishing 站点。我们的要求之一是有一个“站点更新”页脚。目前我们在每次网站更新时手动设置。

我要做的是引用存储此日期的特定列表项（来自自定义列表）。

我正在使用共享点设计器将数据视图插入到母版页，然后从数据源库中删除自定义共享点列表。

这工作正常，您可以在查看站点的根页面时看到日期，一旦您导航到子站点，就会返回错误说明：

*无法显示此 Web 部件。要解决此问题，请在与 Windows SharePoint Services 兼容的 HTML 编辑器（如 Microsoft Office SharePoint Designer）中打开此网页。如果问题仍然存在，请联系您的 Web 服务器管理员。*

我用谷歌搜索了这个错误并尝试在列表 ID 中添加大括号，但这并没有解决问题。有没有人有什么建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T03:53:57.927

您需要做的第一件事是找出确切的错误。这是获取更详细错误信息的一种方法。通过更改以下设置来更改 Web 应用程序的 web.config：

还可以查看 <12 hive>/LOGS 目录中的日志文件以获取更详细的错误信息。

最后，检查事件日志。

我的猜测是数据视图正在使用从子站点无效的相对 URL 引用自定义列表。

如果是这种情况，一种简单的方法是构建服务器控件，以编程方式创建自定义列表的有效 URL，并将服务器控件添加到母版页。

也可以做一些 XSL 技巧来从数据视图构建正确的 URL，但我对它们不是很熟悉。

jt

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-26T17:11:52.403

通常，列表的范围是托管它的 SPWeb。这意味着您不能通过子网站的 id 引用列表。您可以通过编写一个打开列表的父 Web 的控件来解决此问题，然后打开列表。不过，您的问题可能还有其他更优雅的解决方案。

# python - 电子邮件中的编码问题

> ID：389398
> 
> 赞同：1
> 
> 时间：2008-12-23T16:46:47.853
> 
> 标签：python, email, encoding

我有一个小 python 脚本，它从 POP 邮件地址中提取电子邮件并将它们转储到一个文件中（一个文件一个电子邮件）

然后一个 PHP 脚本运行这些文件并显示它们。

我遇到了 ISO-8859-1 (Latin-1) 编码电子邮件的问题

这是我得到的文本示例： =?iso-8859-1?Q?G=EDsli_Karlsson?= and Sj=E1um hva=F0 =F3li er kl=E1r J

我拉电子邮件的方式是这段代码。

```
pop = poplib.POP3(server)

mail_list = pop.list()[1]

for m in mail_list:
    mno, size = m.split()
    lines = pop.retr(mno)[1]

    file = StringIO.StringIO("\r\n".join(lines))
    msg = rfc822.Message(file)

    body = file.readlines()

    f = open(str(random.randint(1,100)) + ".email", "w")
    f.write(msg["From"] + "\n")
    f.write(msg["Subject"] + "\n")
    f.write(msg["Date"] + "\n")

    for b in body:
        f.write(b) 
```

我可能已经尝试过 python 和 php 中编码/解码的所有组合。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T03:39:06.320

您可以使用 python 电子邮件库（python 2.5+）来避免这些问题：

```
import email
import poplib
import random
from cStringIO import StringIO
from email.generator import Generator

pop = poplib.POP3(server)

mail_count = len(pop.list()[1])

for message_num in xrange(mail_count):
    message = "\r\n".join(pop.retr(message_num)[1])
    message = email.message_from_string(message)

    out_file = StringIO()
    message_gen = Generator(out_file, mangle_from_=False, maxheaderlen=60)
    message_gen.flatten(message)
    message_text = out_file.getvalue()

    filename = "%s.email" % random.randint(1,100)
    email_file = open(filename, "w")
    email_file.write(message_text)
    email_file.close() 
```

此代码将从您的服务器获取所有消息并将它们转换为 Python 消息对象，然后再次将它们展平为字符串以写入文件。通过使用 Python 标准库中的电子邮件包，应该为您处理 MIME 编码和解码问题。

免责声明：我没有测试过该代码，但它应该可以正常工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T08:44:28.543

这就是标头的 MIME 编码，[RFC 2047](http://www.ietf.org/rfc/rfc2047.txt)。以下是如何在 Python 中对其进行解码：

```
import email.Header
import sys

header_and_encoding = email.Header.decode_header(sys.stdin.readline())
for part in header_and_encoding:
    if part[1] is None:
        print part[0],
    else:
        upart = (part[0]).decode(part[1])
        print upart.encode('latin-1'),
print 
```

[http://www.bortzmeyer.org/decoder-en-tetes-courier.html](http://www.bortzmeyer.org/decoder-en-tetes-courrier.html)中有更详细的解释（法语）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T12:18:41.680

有一种更好的方法可以做到这一点，但这就是我最终得到的。谢谢你们的帮助。

```
import poplib, quopri
import random, md5
import sys, rfc822, StringIO
import email
from email.Generator import Generator

user = "email@example.com"
password = "password"
server = "mail.example.com"

# connects
try:
    pop = poplib.POP3(server)
except:
    print "Error connecting to server"
    sys.exit(-1)

# user auth
try:
    print pop.user(user)
    print pop.pass_(password)
except:
    print "Authentication error"
    sys.exit(-2)

# gets the mail list
mail_list = pop.list()[1]

for m in mail_list:
    mno, size = m.split()
    message = "\r\n".join(pop.retr(mno)[1])
    message = email.message_from_string(message)

    # uses the email flatten
    out_file = StringIO.StringIO()
    message_gen = Generator(out_file, mangle_from_=False, maxheaderlen=60)
    message_gen.flatten(message)
    message_text = out_file.getvalue()

    # fixes mime encoding issues (for display within html)
    clean_text = quopri.decodestring(message_text)

    msg = email.message_from_string(clean_text)

    # finds the last body (when in mime multipart, html is the last one)
    for part in msg.walk():
        if part.get_content_type():
            body = part.get_payload(decode=True)

    filename = "%s.email" % random.randint(1,100)

    email_file = open(filename, "w")

    email_file.write(msg["From"] + "\n")
    email_file.write(msg["Return-Path"] + "\n")
    email_file.write(msg["Subject"] + "\n")
    email_file.write(msg["Date"] + "\n")
    email_file.write(body)

    email_file.close()

pop.quit()
sys.exit() 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T16:53:22.457

直到最近，标头中还不允许使用普通的 Latin-N 或 utf-N，这意味着它们将通过最初在[RFC-1522](http://www.faqs.org/rfcs/rfc1522.html)中描述的方法进行编码，但后来已被取代。重音以quoted-printable 或Base64 编码，并由？Q？（或 ?B? 用于 Base64）。你必须解码它们。哦，空格被编码为“_”。参见[维基百科](http://en.wikipedia.org/wiki/MIME)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T16:50:58.813

那是 MIME 内容，这就是电子邮件的实际外观，而不是某个地方的错误。您必须在 PHP 方面使用 MIME 解码库（或自己手动解码）（如果我理解正确，它是充当电子邮件渲染器的那个）。

在 Python 中，您将使用[mimetools](http://docs.python.org/library/mimetools.html)。在 PHP 中，我不确定。Zend 框架似乎在某个地方有一个 MIME 解析器，并且可能有无数的片段漂浮在周围。

[http://en.wikipedia.org/wiki/MIME#Encoded-Word](http://en.wikipedia.org/wiki/MIME#Encoded-Word)

# c# - ASP.NET GridView RowIndex 作为 CommandArgument

> ID：389403
> 
> 赞同：56
> 
> 时间：2008-12-23T16:48:43.310
> 
> 标签：c#, asp.net, gridview

如何访问和显示 gridview 项目的行索引作为按钮字段列按钮中的命令参数？

```
<gridview>
<Columns>
   <asp:ButtonField  ButtonType="Button" 
        CommandName="Edit" Text="Edit" Visible="True" 
        CommandArgument=" ? ? ? " />
..... 
```

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-12-29T19:06:05.697

这是一个非常简单的方法：

```
<asp:ButtonField ButtonType="Button" CommandName="Edit" Text="Edit" Visible="True" 
                 CommandArgument='<%# Container.DataItemIndex %>' /> 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2010-02-24T17:43:29.490

[MSDN](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowcommand.aspx)说：

> ButtonField 类自动使用适当的索引值填充 CommandArgument 属性。对于其他命令按钮，您必须手动设置命令按钮的 CommandArgument 属性。例如，当 GridView 控件未启用分页时，您可以将 CommandArgument 设置为 <%# Container.DataItemIndex %>。

所以你不应该需要手动设置它。然后，带有 GridViewCommandEventArgs 的行命令将使其可访问；例如

```
protected void Whatever_RowCommand( object sender, GridViewCommandEventArgs e )
{
    int rowIndex = Convert.ToInt32( e.CommandArgument );
    ...
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-02-17T04:12:42.367

这是微软对此的建议 [http://msdn.microsoft.com/en-us/library/bb907626.aspx#Y800](http://msdn.microsoft.com/en-us/library/bb907626.aspx#Y800)

在 gridview 上添加一个命令按钮并将其转换为模板，然后在这种情况下给它一个命令名称“ **AddToCart** ”并添加 CommandArgument ***“<%# ((GridViewRow) Container).RowIndex %>”***

```
<asp:TemplateField>
  <ItemTemplate>
    <asp:Button ID="AddButton" runat="server" 
      CommandName="AddToCart" 
      CommandArgument="<%# ((GridViewRow) Container).RowIndex %>"
      Text="Add to Cart" />
  </ItemTemplate> 
</asp:TemplateField> 
```

然后在gridview的RowCommand事件上创建确定何时触发“AddToCart”命令，并从那里做任何你想做的事情

```
protected void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
{
  if (e.CommandName == "AddToCart")
  {
    // Retrieve the row index stored in the 
    // CommandArgument property.
    int index = Convert.ToInt32(e.CommandArgument);

    // Retrieve the row that contains the button 
    // from the Rows collection.
    GridViewRow row = GridView1.Rows[index];

    // Add code here to add the item to the shopping cart.
  }
} 
```

**我犯的一个错误是我想在模板按钮上添加操作，而不是直接在 RowCommand 事件上执行。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-23T17:04:12.547

我认为这会奏效。

```
<gridview>
<Columns>

            <asp:ButtonField  ButtonType="Button" CommandName="Edit" Text="Edit" Visible="True" CommandArgument="<%# Container.DataItemIndex %>" />
        </Columns>
</gridview> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T17:23:40.213

```
void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
{
    Button b = (Button)e.CommandSource;
    b.CommandArgument = ((GridViewRow)sender).RowIndex.ToString();
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T16:56:31.937

我通常使用 RowDatabound 事件将这些数据与 GridView 绑定：

```
protected void FormatGridView(object sender, System.Web.UI.WebControls.GridViewRowEventArgs e)
{
   if (e.Row.RowType == DataControlRowType.DataRow) 
   {
      ((Button)e.Row.Cells(0).FindControl("btnSpecial")).CommandArgument = e.Row.RowIndex.ToString();
   }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-18T10:25:25.963

```
<asp:TemplateField HeaderText="" ItemStyle-Width="20%" HeaderStyle-HorizontalAlign="Center">
                    <ItemTemplate>
                        <asp:LinkButton runat="server" ID="lnkAdd" Text="Add" CommandName="Add" CommandArgument='<%# Eval("EmpID"))%>' />
                    </ItemTemplate>
                </asp:TemplateField> 
```

这是具有强类型数据的传统方式和最新版本的 asp.net 框架，您不需要像“EMPID”那样使用字符串

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-06-16T09:48:55.217

```
<asp:LinkButton ID="LnkBtn" runat="server" Text="Text" RowIndex='<%# Container.DisplayIndex %>' CommandArgument='<%# Eval("??") %>' OnClick="LnkBtn_Click" /> 
```

在您的事件处理程序中：

```
Protected Sub LnkBtn_Click(ByVal sender As Object, ByVal e As EventArgs)
  dim rowIndex as integer = sender.Attributes("RowIndex")
  'Here you can use also the command argument for any other value.
End Sub 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-11-18T09:35:08.243

使用分页，您需要进行一些计算

```
int index = Convert.ToInt32(e.CommandArgument) % GridView1.PageSize; 
```

# linux - SFTP Rename file to append date

> ID：389415
> 
> 赞同：3
> 
> 时间：2008-12-23T16:53:50.943
> 
> 标签：linux, ssh, sftp, mainframe

I'm sending a file from a mainframe host to a linux ftp sever using sftp.

I want to append the date to the filename once the file resides on the linux box. (Ex: filename.txt becomes filename122308.txt)

I have tried the 'rename' command using 'date +%m%d%y' - the file was renamed but the flags were not executed (The filename became filename'date +%m%d%y'.txt

The 'cp' and 'mv' commands do not work... any ideas?

Thanks.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T19:38:46.727

由于 sftp 没有运行 shell，因此没有什么可以执行该`date`命令。您可能必须在发件人方面评估您想要的新名称，然后执行 sftp 重命名。

另一种选择是将文件发送到队列区域（例如带有您的日期字符串的文件夹），并在 linux 框上设置一个脚本相应地移动/重命名接收到的文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T17:15:32.070

这些命令是通过 JCL 控制卡发送的。我认为这种方法行不通。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T17:10:56.307

你可以通过命令行来做吗？存在执行 sftp 的选项...

```
sftp [[user@]host[:file [file]]] 
```

...所以你可以执行...

```
export WHEN=`date +%m%d%y`
sftp theUser@theHost:filename$WHEN.txt filename.txt <<-!
thePassword
! 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T09:40:37.557

您可以访问 Linux 服务器吗？在这种情况下，您可以在那里重命名文件。例如，您可以使用 inotify 来监视目录，然后使用脚本在该目录中创建新文件时将日期添加到文件中。

[这是](http://ubuntuforums.org/showthread.php?t=663950)Python 中的一个简单示例（尽管大多数语言都有 inotify 绑定）。您要监听的事件是 IN_CREATE。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-21T17:34:33.200

```
#Establish a local variable to store the LOGINID to be used
export USERID=xxxxx                                                  
#Establish a local variable to store the Path/file location on Remote machine
export REMOTEPATH=/some/path/    
#Establish a local variable to store the NAME of the remote Server
export TARGET=192.168.0.xx
#Establish a local variable to store the new component of the file name (in
#this case, a modification of Date)
export WHEN=`date +%m%d%y`                                                  
#Demonstrate that the USERID variable is set properly by echoing it out to the
#StandardOut
echo "User "$USERID                                               
#Demonstrate that the TARGET variable is set properly by echoing it out to the
#StandardOut
echo "Target Server: "$TARGET                              
#Demonstrate that the REMOTEPATH / server variable is set properly by echoing
#it out to the StandardOut
echo "Target Path "$REMOTEPATH                                    
#Demonstrate that the WHEN / date name modication variable is set properly by
#echoing it out to the StandardOut
echo "Date component of file "$WHEN                                  
#Just echo out that we're about to do something useful
echo "Sending file to REMOTE"                                        
#Simulate the user typing out a command by using the "echo" command.  We use
#the $REMOTEPATH and $WHEN variables to modify "what the user types" but when
#we're done, echo passes information into SFTP just like the user were sitting
#there typing in the #commands.  In this case, it should send in 
#"put /local/path/file /some/path/fileName09092009.txt"
#That is provided as the command list to sftp because of the single "-" that 
#says "get my list of commands from standard-input"  The -vvv is for verbose 
#(lots of diagnostics) and then the $USERID@$TARGET uses the USERID and TARGET
#variables to connect as user-at-server for the exchange.
#A passwordless SSH authentication is already in place, so no password 
#is needed.
echo "put  /local/path/file $REMOTEPATH/fileName$WHEN.txt " | \
    sftp -b - -vvv $USERID@$TARGET
#Just echo out that we're about to do the next step and change file
#permissions.
echo "Changing file Permissions on REMOTE"                
echo "Done" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-10T00:06:57.157

不确定您的大型机 SFTP 客户端，但许多 SFTP 客户端支持使用 ! 运行本地操作系统命令的前缀。因此您可以在发送前将文件复制到新名称，然后发送，然后删除副本。

例如：

```
!cp filename.txt filename122308.txt
put filename122308.txt
!rm filename122308.txt
exit 
```

如果空间很宝贵，请使用两次 mv 而不是 cp & rm。

# sql-server - 在没有网络连接的情况下在 MSSQL 数据库之间传输表的最简单方法是什么？

> ID：389416
> 
> 赞同：4
> 
> 时间：2008-12-23T16:53:56.763
> 
> 标签：sql-server, database

我在开发服务器上有一个小型应用程序/站点，在 SQL Server [varchar(40),varchar(40),varchar(MAX)] 中有一个数据表。我想获取数据表并将其推送到实时服务器。我曾尝试在 txt、Excel 和 Access 中导出，但每次导入时都会出现与无法解析相关的错误，原因是 varchar(MAX) 字段中的数据或从 Access 进行 unicode 到非 unicode 转换。

我觉得我在这里忽略了一个很好的解决方案。目前不需要自动化。我相信有办法在通过网络/互联网连接连接的数据库之间传输表，但我们的办公室无法访问我们的实时数据库。我之前在 MySQL 中使用过数据导出，它创建了一个在另一个数据库上运行以插入所有数据记录的脚本，但我不相信这在 MSSQL 中可用。

有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T17:03:24.090

您可以使用 sql server 备份和恢复功能（[详情请点击此处](http://searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1052507,00.html)）

如果您想将备份限制在单个表（例如因为数据库太大），您可以将表放在自己的文件组中，并在该文件组上使用 sql server 的备份功能。

如果你不知道什么是文件组，你会[在这里找到一些信息](http://www.mssqltips.com/tip.asp?tip=1112)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T17:18:21.097

> 我之前在 MySQL 中使用过数据导出，它创建了一个在另一个数据库上运行以插入所有数据记录的脚本，但我不相信这在 MSSQL 中可用。

啊哈！基本上，您可以在 Microsoft SQL 中执行此操作。存在一个鲜为人知的 Microsoft 实用程序“SQL Server 数据库发布向导”，它可以执行您所说的操作。

[http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en)

为什么这不是 SQL Server 的标准部分，我不知道。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T17:11:50.783

我会以本机格式将其 BCP 输出，然后再将其 bcp 输入。这是来自记忆，但语法是这样的：

BCP MyTable OUT MyTable.dat -n -Usqlusername -Psqlpassword -Ssqlservername

然后再把它放回去。

BCP MyTable IN MyTable.dat -n -Usqlusername -Psqlpassword -Ssqlservername

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T17:32:11.600

您可以使用[EMS 之](http://www.sqlmanager.net)类的工具。它将为您生成一个 SQL 脚本，包括数据库创建和数据插入（如果需要）。

如果需要，更新数据库名称，保存脚本，将它带到你的新服务器上，然后执行它。你完成了。

# time - 两台远程计算机之间的（时钟）同步

> ID：389417
> 
> 赞同：19
> 
> 时间：2008-12-23T16:54:17.433
> 
> 标签：time, synchronization, clock

我正在考虑在我的应用程序中编写一个简单的同步功能，其中一个出现的问题是两台远程计算机之间的时间同步，每台计算机都有自己的时钟（特别是关于文件/对象的修改日期）。

我确信已经对这个主题进行了很多研究并且不想过于理论化，但我想知道是否有任何公认的最佳实践来最小化远程时钟之间的时间差异？

例如，一开始是始终使用通用时间 (UTC) 以避免时区问题，但不能保证两台计算机将具有完全相同的系统时间。幸运的是，我正在做的工作不是很细粒度，所以这不是一个非常重要的问题，但我仍然很好奇。

一种解决方案是始终在两端使用相同的时钟，例如全局时间服务器，而不是本地系统时钟。大概这（结合共享资源锁）可以保证同步时间不会意外重叠，但它不是很实用。

一个想法突然出现在我的脑海中，将每个节点（每个客户端）与之前某个时间点计算的偏移量同步，也许是通过计算系统时钟与全局时间服务器的偏移量。这只需要偶尔进行，因为偏移量本身不太可能在短时间内发生很大变化。

**更新：**让我补充一点，我对实际同步两台计算机的系统时钟不感兴趣——我假设操作系统在大多数情况下都会处理这个问题。这只是一个关于如何确保应用程序的两个实例使用同步时间的问题，尽管在这个时代，我认为系统时钟几乎肯定会在一些非常小的增量内同步。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-23T17:25:25.123

正如其他人所推荐的那样，在您的应用程序中依赖 NTP 是一件容易的事。正确的做法是使用 Lamport 的分布式时钟同步算法。在他 1978 年的经典论文[《时间、时钟和分布式系统中事件的顺序》中](http://research.microsoft.com/en-us/um/people/lamport/pubs/time-clocks.pdf)对此进行了解释。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-23T16:57:52.683

查看“[网络时间协议](http://en.wikipedia.org/wiki/Network_Time_Protocol)”（NTP）规范。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-03-07T17:26:09.217

You can try PTP, The Precision Time Protocol (PTP) is a protocol used to synchronize clocks throughout a computer network. On a local area network it achieves clock accuracy in the sub-microsecond range, making it suitable for measurement and control systems. [http://en.wikipedia.org/wiki/Precision_Time_Protocol](http://en.wikipedia.org/wiki/Precision_Time_Protocol)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-23T16:57:45.553

[将它们与NTP](http://en.wikipedia.org/wiki/Network_Time_Protocol)网络时间协议同步。

你在哪个平台？

使用 NTP，您可以将计算机时间与原子钟同步，并使用世界官方时间。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-23T16:58:37.453

与其编写代码来同步时钟，难道不能在两台机器上都运行一个 ntp 客户端吗？

或者，如果上述方法不可行并且您的应用程序以足够的权限运行来设置时间，我会很想在应用程序中实现最小的 NTP 客户端权限并尝试将其与公共服务器同步。只是不要硬编码某人的私人服务器......

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-10-31T13:34:27.073

对于不成熟的最终用户，这是我目前必须解决的一个问题，他们可以做很多事情来破坏先前贡献者提出的明智建议。一个不成熟的最终用户至少可以做这些事情，甚至更多：

1）没有足够的计算知识能够设置ntp时间同步

2）将他们的计算机时钟设置为不正确的家庭时钟或手机时钟

3) 在 Windows XP 中不小心禁用了 ntp 时间同步并且不知道如何再次启用它，或者他们的计算机日期设置错误，在这种情况下 Windows ntp 不起作用

4) 电脑 BIOS 电池没电了，所以电脑总是在 1970 年启动！

5) 用户将笔记本电脑带到国外，暂时将笔记本电脑时钟设置为当地时间，但不更改时区，所以现在电脑会返回错误的UTC时间！！！

所以你的程序本身必须管理时间，当然你希望以最小的开销来做到这一点。

让我们假设运行您的程序的两个最终用户需要这些程序在将来的同一绝对时间做某事。

我提出了这个方案，它从 cron 工作的工作方式中汲取了一些想法，如果有人能提出改进这个想法的建议，我会很高兴。

1）当您的应用程序启动时，它通过对第三方服务器或您自己的时间服务器的soap调用将自己的内部UTC时间同步到ntp（您可以自己使用ntp保持时间）。

2) 之后，它会从系统时钟添加经过时间以保持时间。如果要求很严格，您可能需要每隔一段时间重复一次 ntp 同步。

3) 然后应用程序查看它需要按时完成的未来工作列表。它需要知道最早的工作。

4）然后它创建一个线程，它在最早的工作之前将其休眠一段时间，减去安全裕度，这取决于您的要求可能提前 10 分钟，提前一小时或两个小时等。

5) 当线程唤醒时，它会通过进一步的soap调用重新检查绝对时间，然后依靠系统时钟来增加经过的时间，直到它到达第一个作业应该执行的时间。

6) 一旦作业被触发（在另一个线程中运行），时间监控线程就会提前计算下一个任务时间，并在此期间再次进入睡眠状态。

想法的增强：

1) 用户可能会在作业到期之前关闭你的应用程序，因此你可能需要一个后台进程或服务，它使用与上述相同的同步方案，来独立监控你的作业列表，存储在数据库或文件中，并启动及时申请。（在 Windows 中，产生应用程序进程）

2) 您的应用程序可能正在动态添加较新、较早的作业或删除作业，因此您的睡眠线程可能需要可唤醒才能重新计算新的较早作业或已删除作业之后的作业。在 Win32 中，您可以通过您的线程在某个事件上等待超时来执行此操作，您将其设置为强制它重新计算睡眠时间。在 Linux 中无疑也有类似的机制。

3) 对于获取时间的 Soap 调用，请记下 Soap 的发送时间和响应的接收时间。如果周转时间太长，您不能依赖时间，可能需要重复通话，或者您可以妥协。例如，如果 Soap 说计算机时钟快 5 分钟，但 Soap 呼叫本身需要一分钟才能回复，那么您只能肯定地说计算机时钟至少快 4 分钟。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-23T17:18:37.663

我们做的一件事本质上是将所有定时操作卸载到“主机”机器上。例如，如果您有 20 台服务器都共享一个 DB，则使用 DB 的时间。如果您有一个中央服务器和一百万台客户端机器，那么客户端机器不应该负责计时任何事情；做你所有的同步服务器端。在真正的“分布式”环境中，例如 P2P 网络或其他东西，使用最直接“拥有”相关资源的机器（您要写入的文件的实际 PC）来同步/控制对文件的访问。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T17:04:17.803

任何联网的机器都应该使用 NTP。所有现代系统都包含一种简单的设置方法。如果您需要一点额外的精度，唯一的问题应该是选择特定的服务器；但它已经在毫秒范围内，所以我不在乎，通常只是指向 pool.ntp.org

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-15T20:19:38.317

Don't use NTP. NTP is for getting date/time only.

It works to synchronize events between apps that don't communicate. An alarm app and your body, for instance.

For apps that have direct communication, sharing a resource, use lamport clocks or vector clocks as Diomidis said. Lamport clocks work great to achieve a partial order between events, Vector clocks are great when you need to identify concurrent events.

# css - CSS对齐问题

> ID：389425
> 
> 赞同：2
> 
> 时间：2008-12-23T16:56:40.983
> 
> 标签：css, internet-explorer

我正在尝试为网站布局标题，我想在标题中有 4 个容器，用于将各种用户控件放入其中。

这 4 个容器需要位于主标题容器内的左上角、右上角、左下角和右下角。

到目前为止，我可以实现这一点，但我不能做的是左下角和右下角的容器需要与其容器的底部在同一水平面上对齐。

如果我为#Bottom 分配一个高度，它可以正常工作，但我不想这样做，因为我无法预测页面上将有哪些控件，因此不知道要设置什么高度。

它需要在IE7中工作。

我希望一切都说得通。

我创建了一个示例应用程序来演示这个问题......

```
<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title></title>
    <style type="text/css">

    .clearFloats
    {
        clear:both;
    }

    #topLeft
    {
        float:left;
        border: 1px solid blue;
        height:50px;
    }

    #topRight
    {
        float:right;
        border: 1px solid blue;
        height:50px;
    }

    #bottom
    {
        position:relative;
        border: 1px solid green;
    }

    #bottomLeft
    {
        float:left;
        border: 1px solid red;
        position:absolute;
        top:0;
    }

    #bottomRight
    {
        float:right;
        border: 1px solid red;
        position:absolute;
        top:0;
        right:0;
    }

    </style>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <div id="topLeft">top left</div>
        <div id="topRight">top right</div>
        <div class="clearFloats" />
        <div id="bottom">
            <div id="bottomLeft">bottom left</div>
            <div id="bottomRight">bottom right<br />Some content<br />some more content</div>
            <div class="clearFloats" />
        </div>
    </div>
    </form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T18:01:24.537

抱歉，我无法提供更多帮助，但鉴于您的限制，我不确定这是否可行。主要问题是您想与`bottom`div 的底部对齐，但是由于`bottomRight`和`bottomLeft`都被定位`absolute`，项目溢出了`bottom`div。因此，`bottom`在您的示例中，使用该属性将它们与（空）绿线上的底部对齐。

我能想出的唯一想法要求你知道你的两个元素中的哪一个会更高。您不必知道具体的高度，但是如果您可以预测哪个更高并将其设置为**not** use `position:absolute`，那么容器将起作用，而另一个（较小的）元素将就位。鉴于您的示例，如果您知道这`bottomRight`会更高：

```
#bottomLeft
{
    float:left;
    border: 1px solid red;
    position:absolute;
    bottom:0;
}

#bottomRight
{
    float:right;
    border: 1px solid red;
} 
```

如果你提前不知道哪个会更高，我不知道你还能做什么。您需要在 div 中添加**一些**内容`bottom`以使其具有适当的高度，以便 " `position: absolute; bottom: 0`" 样式具有所需的效果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T18:29:37.693

正如亚当所说的那样，有一个纯 CSS 解决方案，您需要知道哪个底部 div 将在其中包含更多文本。

下面我使用 javascript 检查bottomLeft 是否有更多内容，如果有，则翻转样式...试试下面的...然后尝试更改以使bottomLeft 有更多内容，然后刷新。希望这可以帮助。

```
<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title></title>
    <style type="text/css">

    .clearFloats
    {
        clear:both;
    }

    #topLeft
    {
        float:left;
        border: 1px solid blue;
        height:50px;
    }

    #topRight
    {
        float:right;
        border: 1px solid blue;
        height:50px;
    }

    #bottom
    {
        width:100%;
        border: 1px solid green;
        position:relative;
    }

    #bottomLeft
    {
        float:left;
        border: 1px solid red;
        position:absolute;
        bottom:0;
    }

    #bottomRight
    {
        float:right;
        border: 1px solid red;
    }

    </style>
</head>
<script type="text/javascript">

    window.onload = function() {
        var leftBot = document.getElementById('bottomLeft');
        var rightBot = document.getElementById('bottomRight');  
        //if the left is actually bigger than swap out their styling
        if (leftBot.innerHTML.length > rightBot.innerHTML.length) {
            leftBot.style.position='static';
            rightBot.style.position='absolute';
            rightBot.style.bottom = 0;
            rightBot.style.right = 0;   
        }
    }

</script>

<body >
    <form id="form1" runat="server">
    <div id="header">
        <div id="top">
            <div id="topLeft">top left</div>
            <div id="topRight">top right</div>
        </div>
        <div class="clearFloats" />
        <div id="bottom">
                <div id="bottomLeft">bottom left</div>
                <div id="bottomRight">bottom right<br />Some content<br />some more content<br/><br/>more more</div>
                <div class="clearFloats" />
        </div>
    </div>
    </form>
</body>
</html> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T17:06:43.540

您在`bottomLeft`和之间的定位`bottomRight`不一致：

```
#bottomLeft
{
    bottom:0;
}

#bottomRight
{
    top:0;
} 
```

如果你想`bottomLeft`表现得像`bottomRight`，它们应该具有相同的垂直定位。还是他们都错了？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T21:34:18.553

我可能读错了这种方式，但为什么不这样做。*警告值需要改变只是概念：

CSS：

```
#header{
  height:150px;
  width:350px;
  position:relative;
}
#header #topleft{
  position:absolute;
  top:0;
  left:0;
}
#header #topright{
  position:absolute;
  top:0;
  right:0;
}
#header #bottomleft{
  position:absolute;
  left:0;
  bottom:0;
}
#header #bottomright{
  position:absolute;
  right:0;
  bottom:0;
} 
```

HTML：

```
<div id="header">
 <div id="topleft"></div>
 <div id="topright"></div>
 <div id="bottomleft"></div>
 <div id="bottomright"></div>
</div> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T08:59:17.780

感谢大家的时间。

我选择了亚当斯的答案，因为目前我可以预测右下角容器的高度将大于左下角，这样就可以了。

我也喜欢 Jack 的 javascript 解决方案。

最终，我认为我在这里过于灵活。也许我应该做的是拥有一系列用户控件，这些控件定义了可能的各种标题布局，然后拥有一个大的底部面板并将相关控件放在那里。然后可以精确地布置一系列用户控件中的每一个，因为内容基本上是静态的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-05T12:02:20.467

当我遇到布局问题时，我无法在 1 小时内解决，我会使用表格返回。在您的情况下，使用 table 将是一个很好的解决方案，因为 IMO 它感觉比其他解决方案更稳定。

An other idea would be putting your top 2 divs in a container div, the bottom 2 divs in another container div and make one float left, the other right. This way you do not have to use absolute positioning. (Make sure that the container has overflow:auto or if you want it to work in IE6 put an element with the style "clear: both" between the two divs and the containing div)

# .net - VB.NET 中的引用

> ID：389426
> 
> 赞同：3
> 
> 时间：2008-12-23T16:56:56.880
> 
> 标签：.net, vb.net, pointers, pass-by-reference, pass-by-value

对我来说有些不清楚的是对 VB.NET 中的类的引用（指针？）。我要问的问题可以通过一些测试来回答，但我想知道是否有人可以发布一个体面的解释（或链接，也是）。

如果你创建一个类：

```
Public Class ReferenceClass

    Private myBooleanValue As Boolean = False
    Public Property BooleanValue As Boolean
        Get
            Return myBooleanValue
        End Get
        Set(value As Boolean)
            myBooleanValue = value
        End Set
    End Property

End Class 
```

然后是一个实际使用这个类作为属性的类：

```
Public Class UsingClass

     Private myReference As ReferenceClass
     Public Property Reference As ReferenceClass
        Get
             return myReference
         End Get
         Set(value As ReferenceClass)
             myReference = value
         End Set
     End Property

     Public Sub New(ByVal Reference As ReferenceClass)
         myReference = Reference
     End Sub

End Class 
```

然后像这样使用它：

```
Public Class RuntimeOrSomething

     Public Shared myReference As ReferenceClass
     Public Shared ReadOnly Property Reference As ReferenceClass
         Get
             If myReference Is Nothing Then myReference = new ReferenceClass()
             return myReference
         End Get
     End Property

     Public Shared Function BooleanCheck() As Boolean
         Reference.BooleanValue = True
         Dim tempClass As New UsingClass(Reference)
         tempClass.Reference.BooleanValue = False

         Return (tempClass.Reference.BooleanValue = Reference.BooleanValue)
     End Sub

     Public Shared Sub DoNothing()
          Reference.BooleanValue = True
          Dim someBoolean As Boolean = BooleanCheck

          ' Now Reference.Booleanvalue is "False"
     End Sub

End Class 
```

现在函数`BooleanCheck`将始终返回`true`，即使引用是`UsingClass`“按值”而不是按引用传递给新类的。因此，没有制作类的副本，但`myReference`in 中的局部变量`UsingClass`仍然引用/指向`Reference`.`RuntimeOrSomething`

这怎么能优雅地解释呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-23T17:32:44.047

引用指向对象的实例，它不是对象的实例。复制到对象的方向不会创建另一个对象，它会创建另一个也指向同一对象的引用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-23T17:25:49.570

我现在不能花太多时间来回答这个问题——在火车上打字，膝盖上有一个蹒跚学步的孩子——但我有几篇文章可能会有所帮助。它们是关于 C# 的，但同样适用于 VB.NET：

*   [引用类型和值类型](http://pobox.com/~skeet/csharp/references.html)
*   [.NET 中的参数传递](http://pobox.com/~skeet/csharp/parameters.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T20:08:08.993

来自[MSDN](http://msdn.microsoft.com/en-us/library/aa903253(VS.71).aspx)：

> 如果使用 ByVal 关键字按值传递变量参数，则过程不能修改变量本身。**但是，如果参数是引用类型，您可以修改它指向的对象的成员，即使您不能替换对象本身。**特别是，您可以修改对象的成员。例如，如果参数是数组变量，则不能为其分配新数组，但可以更改其一个或多个元素。更改的元素反映在调用代码中的底层数组变量中。

由于您的 ReferenceClass 是一个引用类型，如果您通过 ByVal 传递它，则不能用新对象（您没有）替换它，但您可以用它的内部（您做的）乱七八糟。无论你通过 ByRef 还是 ByVal，乱搞它的内脏仍然会“影响”原始对象（因为内存中只有一个对象）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T18:44:35.667

在这一行：

```
Dim tempClass as New UsingClass(Reference) 
```

属性引用的对象`Reference`是“按值”传递的，但它不是被复制的**对象，而是对被复制****对象****的*引用***（即 myReference 和 tempClass.Reference 是指向同一对象的两个不同的“指针”。然后你可以这样做`tempClass.Reference = new ReferenceClass`myReference 和 tempClass.Reference 仍然是两个不同的“指针”，但现在它们每个都指向两个不同的对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T19:20:49.430

在 VB.NET 中传递类 byval/byref 时，可以根据 C 编程和指针来考虑它，这样 -

```
ByVal = 通过 - 指针传递参数
ByRef = 通过 - 指向指针的指针传递参数

```

以字符串为例

```
' ByRef - modify str pointer to "point" to a new string
Sub Test_Ref(ByRef str as string)
    str = "New String ByRef"
End Sub

' ByVal - can't modify str pointer must return a (pointer to) new string
Function Test_Val(ByVal str as String) as String
    Return "New String ByVal"
End Sub

Sub Main()
    Dim strTest as String = "Hello World!"
    Console.WriteLine(strTest)
    Test_Ref(strTest)
    Console.WriteLine(strTest)
    Test_Val(strTest)
    Console.WriteLine(strTest) ' oops still pointing to same string
    strTest = Test_Val(strTest)
    Console.WriteLine(strTest) ' that's better :)
End Sub 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-28T08:46:30.720

如上所述，设置一个对象变量等于另一个只是将“指针”设置为内存中同一对象的一个​​实例，如果你想克隆对象看看实现 iCloneable 接口类似

```
Public Function Clone() As Object Implements ICloneable.Clone
Return Me.MemberwiseClone()
End Function 
```

分配对象时使用克隆方法

```
Dim tempClass as ReferenceClass = Reference.Clone 
```

# asp.net-2.0 - Data collection methods

> ID：389431
> 
> 赞同：0
> 
> 时间：2008-12-23T16:58:48.500
> 
> 标签：asp.net-2.0

I'm stumped again on how to proceed with a survey system I am working on. We have database data for matrix sytle questions (rows are various questions, columns are various answer types), where each cell needs to be able hold a different kind of control. We have a database framework for this. The problem comes with how to dynamcially render this onto the screen. We need to be able to control the placement of various answers. My initial thought was having to use a placeholder and write several LiteralControls into it to build the HTML for a table and control the spacing that way. Would it be possible to do this using a GridView instead? I am not sure which one would be the easier method. If there are other possiblities, I could really use the ideas. AJAX is not an option.

This is similar to a question I have previously asked, but this has more to do with the controls on the aspx page, rather than the bare logic behind it.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T21:43:31.547

取决于调查中的问题/答案类型。如果每个问题/答案都属于同一类型（例如，多个答案或只有 1 个答案），那么您将使用中继器控件和用户控件。用户控件将适当地显示问题/答案，意思是，将答案呈现为复选框列表（用于多选答案）或仅用于 1 个答案的单选按钮。

# c# - 实体框架：使用分离的对象和附加的对象

> ID：389432
> 
> 赞同：4
> 
> 时间：2008-12-23T16:58:55.067
> 
> 标签：c#, entity-framework

首先，让我列出我想做的事情。假设我有`EntityObject`、`MetaData`和`Data1`三种类型`Data2`。正如人们所期望的那样，is 对和`MetaData`的每个实例都有一个引用。现在，对于每个，我可以计算一个。`Data1``Data2``MetaData``value`

到目前为止这么简单。现在，我想让用户玩弄 和 的各种组合`Data1`，`Data2`看看`value`他们能得到什么。这显然需要创建`MetaData`. 现在，如果我不想用 的所有这些条目来混淆数据库`MetaData`，那么我想在内存上下文中创建实体对象，而不调用 a`SaveChanges()`将其写回数据库。但是，这会带来一个问题，即每当我尝试访问 in-memory 的`Data1`和`Data2`引用时，都会遇到`MetaData`以下异常：

*InvalidOperationException 未处理*

*当相关对象处于添加状态或分离状态并且最初未使用 NoTracking 合并选项检索时，无法返回此 EntityCollection 或 EntityReference 的源查询。*

如果我按照建议做，并将对象“提交”到 DB，我最终会遇到混乱问题。

无论如何，有罪的代码看起来像这样：

```
MetaData temp = MetaData.CreateMetaData(0);

MetaData.Data1 = <existing Data1 from context>;
MetaData.Data2 = <existing Data2 from context>;

//Exception here
if (!MetaData.Data1Reference.isLoaded)
    MetaData.Data1Reference.Load(); 
```

看来[这家伙](http://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/thread/7d00afc3-0f4c-460f-98cc-b2395789fa5b/)也有类似的问题。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-23T17:32:01.053

IsLoaded 仅与已从数据库具体化的实例的属性相关。正如您所发现的，对于尚未从数据库实现的实例，它不会返回有用的信息。

因此，您应该更改测试方式是否要调用 Load()。如果您知道您将使用仅在内存中创建而不是从数据库中具体化的 MetaData 实例，那么您可以编写如下代码：

```
if ((temp.EntityState != System.Data.EntityState.Added) && 
    (!temp.Data1Reference.IsLoaded)) temp.Data1Reference.Load(); 
```

我在这里掩盖了一些微妙之处。对于初学者来说，EntityState 是用 FlagsAttribute 声明的，因此它可以*包含*Additional但不*等于*Additional 。此外，如果 Data1Reference 不为空，则这些都不是必需的，因此您可能只想先测试一下。关键是，您可以编写适合您情况的代码，但它必须考虑 temp 的完整状态，而不仅仅是它的属性。

# .net - Impersonation when running a remote triggered job

> ID：389434
> 
> 赞同：2
> 
> 时间：2008-12-23T17:00:07.310
> 
> 标签：.net, message-queue, msmq

My (.NET) app allows users to tweak database values. They will then need to generate reports based on their edits, either Crystal or Reporting Services, but that's not important - what is important is that the generation won't definitely be able occur on their local box, e.g. they might not have Crystal Reports (or whatever) installed on their machine.

So I've set up a Message Queue on a network machine (which can generate the reports) and my app will post a message to that queue sending along an object with all the required information. So far, so good.

I've configured the target queue with a rule and a trigger so any new message will automagically provoke a console app on that remote machine to attempt to deal with the message.

The problem is that although everything works fine, the triggered console app runs as the local machine account. The app needs to interact with the database (which uses integrated authentication).

The console app works perfectly when I run it as an actual user, but not when triggered by Message Queuing.

The question is, can I configure the rule, trigger or console app to run as a specific user? I've tried all the config options that I can seem to see, but to no avail.

Perhaps I can impersonate a user within the app's code itself (in app.config)? It's feasible in [ASP.NET](http://support.microsoft.com/?id=306158) code, but not in WinForms code by the look of it.

**Edit:** The impersonation suggestion works well ... right up until the point when I get an error "Access is Denied" from the Process.Start() function, calling startwithcreateprocess().

The user I'm impersonating has permission to run the process on the local box (so it can run natively with no problems).

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T17:15:17.187

```
 Process p = new Process();

    p.StartInfo.UseShellExecute = false;

    SecureString password = new SecureString();
    string pwd = "mysecret123";
    foreach (char c in pwd)
    {
        password.AppendChar(c);
    }

    p.StartInfo.Domain = "DomainHere";
    p.StartInfo.UserName = "Natthawut";
    p.StartInfo.Password = password;

    p.StartInfo.FileName = "cmd";
    p.StartInfo.Arguments = "/c dir";
    p.Start(); 
```

请参阅 .NET 安全博客 - [http://blogs.msdn.com/shawnfa/archive/2004/06/02/146915.aspx](http://blogs.msdn.com/shawnfa/archive/2004/06/02/146915.aspx)

顺便说一句，我认为这与 MSMQ 无关 :)

编辑：也许我错过了一些东西。不确定 MSMQ 如何引发新进程，或者它只是用于启动控制台应用程序的应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T17:04:01.237

尝试在应用程序中使用模拟？

更粗略地说，您可以运行您的应用程序。

# javascript - why use not not !! for boolean value in MS AJAX?

> ID：389437
> 
> 赞同：2
> 
> 时间：2008-12-23T17:01:57.743
> 
> 标签：javascript, asp.net-ajax

From MS AJAX source code,

```
Type.isClass = function Type$isClass(type) {
/// <summary locid="M:J#Type.isClass" />
/// <param name="type" mayBeNull="true"></param>
/// <returns type="Boolean"></returns>
var e = Function._validateParams(arguments, [
    {name: "type", mayBeNull: true}
]);
if (e) throw e;
if ((typeof(type) === 'undefined') || (type === null)) return false;
return !!type.__class; 
```

}

Please look at the last line of code, why use !! instead of just return type.__class?

Thanks!

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T17:04:02.640

作者一定没有想到`type.__class`被保证是一个布尔值。由于您可以将任何对象传递给`Type.isClass()`：

```
Type.isClass(3);
Type.isClass({});
Type.isClass(AnActualClassFunction); 
```

...确实不能保证`type.__class`会有一个布尔值。

当然，不是 ASP.NET AJAX“类”的参数通常没有`__class`属性 - 所以如果例程简单地返回`type.__class`，可能的返回值将是`true`、`false`和`undefined`。这对于旨在返回布尔值的例程来说是不可取的。

`!!type.__class`只是保证返回一个布尔值（`true`或`false`）（`undefined`将被转换为`false`）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T17:03:41.440

保证安全的布尔转换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T18:23:52.463

所以基本上 !!val 和 Boolean(val) 之间没有区别

```
var val; // val is undefined
alert(!!val); // display false
alert(Boolean(val)); // display false as well 
```

# javascript - 为什么我不能在 IE 中捕获鼠标单击？

> ID：389438
> 
> 赞同：1
> 
> 时间：2008-12-23T17:02:03.657
> 
> 标签：javascript, internet-explorer

我有一个页面，其中有一个带有文本和图标的矩形区域，整个内容都是可点击的。锚标记设置为显示：块。其中一个图标有一个 onclick 处理程序。如果一个人点击一个图标，我只希望图标的 onclick 处理程序运行，而不是实际激活包含锚标记。

Firefox 的行为如我所愿，而 IE 则不然。

所以我试图在 onclick 处理程序中捕获事件：

```
function my_onclick_handler(evt){
  if (!evt) evt = window.event;

  // ... handle the click

  if (evt.stopPropagation) evt.stopPropagation();
  evt.cancelBubble = true;
} 
```

那没有用，所以我想也许实际上是 onmouseup 或 onmousedown 事件触发了锚标记，所以我在 onmouseup 和 onmousedown 方法中添加了一个 clickSwallow 方法：

```
function clickSwallow(evt){
  if (!evt) evt = window.event;
  if (evt.stopPropagation) evt.stopPropagation();
  evt.cancelBubble = true;
} 
```

那也没有用。在这种情况下如何防止封闭锚对点击做出反应的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T17:07:17.733

我只会使用 a `<span>`，但我认为`false`从事件处理程序返回也应该可以解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T17:06:22.213

[这篇文章](http://www.openjs.com/articles/prevent_default_action/)有一些你没有的项目（如 e.returnValue 和 e.preventDefault），但从文本看来，这些是 FF 特定的功能。不过可能值得一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T17:05:23.057

尝试将您的锚点更改为：

```
<a href="javascript:void(0)"> <img src="..." onclick=".."> </a> 
```

# c# - DataGridView ToolTipText 未显示

> ID：389439
> 
> 赞同：9
> 
> 时间：2008-12-23T17:02:10.520
> 
> 标签：c#, visual-studio, visual-studio-2008, datagridview, desktop-application

我`DataGridView`在桌面应用程序中绑定了数据，其中的列`ToolTipText`设置了属性，但是当我将鼠标悬停在网格视图（单元格或单元格标题）上时没有显示工具提示。

网格视图的`ShowCellToolTips`属性是`true`，并且我已经使用断点验证了它在鼠标悬停之前没有以编程方式更改。

我尝试创建一个`CellToolTipTextNeeded`事件处理程序来查看工具提示文本是什么，但从未调用过事件处理程序。

有什么我错过的吗？

谢谢，罗伯

**编辑：**我们正在使用框架 2.0。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-08T00:20:33.533

从您的问题看来，您设置了列的工具提示文本。列工具提示文本仅在浮动在标题上时出现。要在单元格上显示工具提示文本，您必须连接事件并在事件参数中`CellToolTipTextNeeded`设置值`e.ToolTipText`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-02-11T09:35:02.347

尝试使用 Cell.ToolTipText 属性。您可能需要循环 DataGridView 的行并手动设置工具提示：

```
 For Each row As DataGridViewRow In Me.DataGridView.Rows
   Me.DataGridView("MyCol", row.Index).ToolTipText = "MyToolTipText"
 Next 
```

可能不适合有很多行的绑定 DataGridView，但对我来说成功地工作有几百行的未绑定 DataGridView。希望这可以帮助。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-29T21:38:03.983

当我将带有单个（空）列的 datagridview 添加到表单中，将文本添加到该列的 ToolTipText 属性，并确保 datagridview 的 ShowCellToolTips 属性设置为 True 时，当我将鼠标悬停时确实会弹出一个工具提示将鼠标悬停在该列的标题上。这似乎与原始问题中的陈述相矛盾，但在我的测试中，网格没有数据绑定。不确定这是否会有所作为。但是，在一个带有数据绑定 datagridview 的项目中，我只使用了一个 ToolTip 组件：

(1) 在表单中添加一个 ToolTip 组件。
(2) 将`ToolTip on toolTip1`datagridview 的（或 ToolTip 组件的等效名称）属性设置为您要显示的任何文本。
(3) 将 datagridview 的 ShowCellToolTips 属性设置为 False。
(4) 中提琴！按预期工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-05-16T23:43:07.823

我有一个类似的问题，但能够通过在我的 DataGridView 上将 ShowCellToolTip 设置为 true 来纠正它。一旦我这样做了，我就可以发送以下代码并且一切正常。

```
tableDocTypes.ShowCellToolTips = true;
tableDocTypes.Rows[i].Cells[columnFormCabinet.Index].ToolTipText = "Cabinet is not defined on the optical server."; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-10-31T08:17:55.460

要显示网格单元的工具提示，您可以使用此事件处理程序“ **CellToolTipTextNeeded** ”。请参阅以下代码片段，

```
this.dataGridView1.ShowCellToolTips = true;
this.dataGridView1.CellToolTipTextNeeded += dataGridView1_CellToolTipTextNeeded;

void dataGridView1_CellToolTipTextNeeded(object sender, DataGridViewCellToolTipTextNeededEventArgs e)
{
    if (e.ColumnIndex >= 0 && e.RowIndex >= 0)           
    {
        e.ToolTipText = this.dataGridView1.Rows[e.RowIndex].Cells[e.ColumnIndex].Value.ToString();
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-13T18:49:52.327

我们最终使用了 ToolTip 小部件和`CellMouseEnter`,`CellMouseLeave`事件来适当地显示它。不是最佳的，但它可以解决我们遇到的奇怪行为。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-01-07T20:05:37.723

将 datagridview ShowCellToolTips 属性设置为 False

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-19T14:23:23.087

我目前在 Framework 3.5 上遇到了同样的问题。似乎需要设置 DataSource 属性才能触发 CelToolTipTextNeeded 事件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-30T07:55:32.600

我不知道这个技巧是否可以解决您的具体问题，但是您使用的是 VS2008 的 SP1 吗？正如我所发现的，此 Service Pack 解决了许多不同的问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-08-12T16:04:19.087

我发现这篇文章正在寻找有关设置每行工具提示的帮助。

我只是想确认在 VS2008 SP1 中处理 CellToolTipText 事件对我有用。

对于那些想知道如何将文本设置为基础数据行中的值的人，这可能很有用：

```
 private void myDGV_CellToolTipTextNeeded(object sender, DataGridViewCellToolTipTextNeededEventArgs e)
    {
        // This is used to set tooltiptext for individual cells in the grid.
        if (e.ColumnIndex == 2)  // I only want tooltips for the second column (0-based)
        {
            if (e.RowIndex >= 0)   // When grid is initialized rowindex == 0
            {
                // e.ToolTipText = "this is a test."; // static example.

                DataRowView drv = ((DataGridView)sender).Rows[e.RowIndex].DataBoundItem as DataRowView;
                MyTableRowClass theRow = drv.Row as MyTableRowClass;
                e.ToolTipText = theRow.Col1  + "\r\n" + theRow.Col2;
            }
        }
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-09-08T05:23:52.253

1.  将 DataGridView 的`ShowCellToolTips`属性设置为`false`
2.  将此代码放入 DataGridView 的`CellMouseEnter`事件中

    ```
    private void dgv_CellMouseEnter(object sender, DataGridViewCellEventArgs e)
    {
        if (!(dgv.Rows[e.RowIndex].Cells[e.ColumnIndex].GetType() == typeof(DataGridViewImageCell))) return;
        System.Windows.Forms.ToolTip tlp = new System.Windows.Forms.ToolTip();
        tlp.SetToolTip(dgv, "Your ToolTipText");
    } 
    ```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-11-12T06:08:45.263

有一个相关的问题，其中 CellToolTipTextNeeded 只会*偶尔*被调用。当单元格中存在溢出时，该行为是工具提示上的工具提示。当单元格的 WrapMode 设置为 true 时，每次都会正确调用 CellToolTipTextNeeded。我认为将调用 CellToolTipTextNeeded 并覆盖通用工具提示，但它似乎仅在第一次进入 datagridview.cell 时调用此事件，然后，如果鼠标离开单元格并重新打开（保留在 datagridview 中），“查看溢出工具提示”改为显示...

无论如何，信息可能会帮助其他人。

# asp.net - 在 ASP.NET 用户控件中引发 javascript 事件

> ID：389450
> 
> 赞同：1
> 
> 时间：2008-12-23T17:06:32.057
> 
> 标签：asp.net, javascript, user-controls

是否可以在 ASP.NET 用户控件中引发“自定义事件”并订阅调用页面中的事件？这样，我可以让任何包含页面对用户控件中的更改做出反应，而无需进行部分或全部回发。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T17:14:40.557

您正在尝试将服务器端代码与客户端代码混合。你可能最好使用内置的 javascript 事件：

> ```
> control.Attributes.Add("onclick", "mgr.Click();"); //server-side
> 
> //Javascript:
> var mgr = new Object();
> mgr.Click = new function(e) { //... 
> ```

也就是说，通过足够的努力和大量的骇客，您可能可以让它呈现出足够的 javascript 并使用 AJAX 调用来实现效果；但这可能不值得；并且不是内置的。

或者 - 如果您的目标是在服务器端（而不是客户端）引发自定义事件并在 javascript 中处理它们，则呈现对函数的调用：

> ```
> this.Controls.Add(new LiteralControl("<script type=\"text/javascript\">mgr.Filter('people');</script>")); 
> ```

# javascript - AJAX引起的“此页面上的脚本导致IE运行缓慢”的故障排除方法？

> ID：389451
> 
> 赞同：4
> 
> 时间：2008-12-23T17:06:39.263
> 
> 标签：javascript, ajax, internet-explorer, mootools

我的应用程序中有一个页面，它每 10 秒从服务器刷新一些内容（当前登录的用户列表）。该数据是使用[mootools 框架中的](http://docs111.mootools.net/)[Ajax](http://docs111.mootools.net/Remote/Ajax.js)类加载的，特别是使用如下所示的 Javascript：

```
var xmldata = (function() {
    new Ajax('xmldata.jsp?time='+$time(), {method: 'get', onComplete: dataLoaded, autoCancel: true}).request();
}).periodical(10000); 
```

（每 10 秒创建一个`Ajax`对象并调用它的`request()`方法，完成后将调用`dataLoaded()`方法）。

如果用户让他们的浏览器窗口在此页面上打开大约 45-60 分钟，那么尝试在其他地方导航将导致 IE（v7 肯定，v6 以及我相信，Firefox 或 Chrome 没有这个问题）显示以下内容弹出窗口：

> 停止运行此脚本？
> 此页面上的脚本导致 Internet Explorer 运行缓慢。如果它继续运行，您的计算机可能会变得无响应。

现在，在我看来，这很可能是由 mootools 框架中的底层脚本中的某种泄漏引起的——要么有太多的`Ajax.request()`调用排队等待调用，要么有些对象没有被正确清理，即使框架是应该有一些垃圾收集功能。

分析 IE 的 Javascript 引擎在幕后做了什么的最佳方法是什么？有没有可能的方法来确定我的任何一个假设是否正确？

我在[一个类似的问题](https://stackoverflow.com/questions/212550/a-script-on-this-page-is-causing-ie-to-run-slowly)中看到，[有人建议](https://stackoverflow.com/questions/212550/a-script-on-this-page-is-causing-ie-to-run-slowly#214244)使用 IBM Page Profiler 来调试这个问题。我已经尝试使用 Page Profiler 并没有取得太大的成功 - 如果您在页面的初始加载时遇到问题（分析哪个组件导致过度加载延迟），它似乎很有用，但它似乎没有能够分析在页面完全加载*后在页面内运行的 Javascript 发生了什么。*我在 Page Profiler 中看到每 10 秒请求一次对 xmldata.jsp 的异步调用，但 Page Profiler 仅显示服务器响应正常（大约 600 毫秒），但不了解父页面的脚本如何使用此数据。

此外，[在自关闭的 mootools 讨论列表上的这篇文章](http://n2.nabble.com/IE.-Stop-running-this-script-popup-error---mootools-1.11-td1572531.html)中，有人建议删除注册`unload`侦听器以调用垃圾收集方法来解决此问题的代码 - 但这似乎解决了问题的症状，而不是问题本身.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T17:15:36.297

这可能是 IE 中的内存/资源泄漏。这些最常见的来源是代码或框架代码中的闭包。我总是检查我的 javascript 框架的问题跟踪器以获取报告的错误。很多时候，我被其他用户的错误报告和修复所拯救。

要尝试跟踪问题，您可以尝试诸如[泄漏检测器](http://blogs.msdn.com/gpde/pages/javascript-memory-leak-detector.aspx)之类的方法。有一篇很棒的[msdn 文章](http://msdn.microsoft.com/en-us/library/bb250448.aspx)也解释了 IE 内存泄漏的理论。

大量泄漏源是事件处理程序，您确实需要阅读 MSDN 文章才能理解这一点。这些通常会创建您的类型的泄漏，因此考虑取消注册任何事件处理程序可能是一个好主意。

我必须承认，每 10 秒连续重新加载一个小时听起来相当不错。我不确定您是否应该*期望*IE 会变得更好（也许有点偏低，但仍然如此）。您可能需要调整您的期望或至少设定一个目标，即在一个单一版本的 IE 上运行得更好。

重新期望：对于“通用”版本的 IE，有太多不同的版本和太多不同的错误，您可以在所有这些版本上针对长时间运行的应用程序实现 100% 的稳定性。所以至少最初我认为选择特定版本作为目标是明智的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T18:00:05.583

首先，您可能想通过让它运行一个小时来检查是否存在泄漏，并查看 IE 内存使用量是否显着增加。另一个问题可能是 IE 有某种内部计数器，它计算 javascript 在页面上使用的总时间，如果使用超过 x 秒，则显示警告。即使每个请求不使用大量 CPU，在一个小时的过程中，它也可能使用大量 CPU，因此 IE 可能会将其检测为问题。此外，我不熟悉 mootools，但您可能希望确保使用异步 AJAX 调用，以尽量减少 javascript 代码中的等待时间。

# internet-explorer - Cookie 被阻止/未保存在 Internet Explorer 的 IFRAME 中

> ID：389456
> 
> 赞同：398
> 
> 时间：2008-12-23T17:08:07.840
> 
> 标签：internet-explorer, cookies, privacy, p3p

我有两个网站，假设它们是`example.com`和`anotherexample.net`. 在`anotherexample.net/page.html`，我有一个`IFRAME SRC="http://example.com/someform.asp"`。该 IFRAME 显示一个表单供用户填写并提交给`http://example.com/process.asp`. `someform.asp`当我在自己的浏览器窗口中打开表单（“ ”）时，一切正常。但是，**当我在 IE 6 或 IE 7 中加载`someform.asp`为 IFRAME 时，不会保存 example.com 的 cookie。**在 Firefox 中不会出现此问题。

出于测试目的，我在[http://newmoon.wz.cz/test/page.php](http://newmoon.wz.cz/test/page.php)创建了一个类似的设置。

`example.com`使用基于 cookie 的会话（对此我无能为力），因此没有 cookie，`process.asp`将无法执行。**如何强制 IE 保存这些 cookie？**

嗅探 HTTP 流量的结果：在 GET /someform.asp 响应中，有一个有效的每会话 Set-Cookie 标头（例如`Set-Cookie: ASPKSJIUIUGF=JKHJUHVGFYTTYFY`），但在 POST /process.asp 请求中，根本没有 Cookie 标头。

Edit3：一些 AJAX+服务器端脚本显然能够回避这个问题，但这看起来很像一个错误，而且它打开了一组全新的[安全漏洞](http://en.wikipedia.org/wiki/Session_hijacking)。我不希望我的应用程序使用错误+安全漏洞的组合只是因为它很容易。

编辑：**P3P 政策是根本原因**，下面是完整的解释。

* * *

## 回答 #1

> 赞同：432
> 
> 时间：2008-12-23T17:08:34.783

我让它工作，但解决方案有点复杂，所以请耐心等待。

# 发生了什么

事实上，Internet Explorer 对 IFRAME 页面的信任级别较低（IE 将此称为“第三方”内容）。如果 IFRAME 内的页面没有隐私政策，则其 cookie 将被阻止（由状态栏中的眼睛图标指示，当您单击它时，它会显示被阻止的 URL 列表）。

[![邪恶的眼睛](https://i.stack.imgur.com/imEhY.png)](https://i.stack.imgur.com/imEhY.png)
[（来源：[piskvor.org](http://stuff.piskvor.org/cookies_blocked_MSIE_eye.png)）]

在这种情况下，当 cookie 被阻止时，不会发送会话标识符，并且目标脚本会抛出“未找到会话”错误。

（我尝试将会话标识符设置到表单中并从 POST 变量中加载它。**这本来可以**，但出于政治原因我不能这样做。）

可以使 IFRAME 内部的页面更受信任：**如果内部页面发送带有 IE 可接受的隐私策略的 P3P 标头，则 cookie 将被接受**。

# 如何解决

## 创建 p3p 策略

[W3C 教程](http://www.w3.org/P3P/details.html)是一个很好的起点。我浏览了它，下载了[IBM 隐私政策编辑器](http://www.alphaworks.ibm.com/tech/p3peditor)，在那里我创建了隐私政策的表示，并给它一个名称以供参考（这里是`policy1`）。

**注意**：此时，您实际上需要确定您的网站是否有隐私政策，如果没有，请创建它 - 它是否收集用户数据，什么样的数据，它用它做什么，谁可以访问它，等等。你需要找到这些信息并*考虑*一下。**只是将几个标签贴在一起不会削减它。**此步骤不能仅在软件中完成，并且可能具有高度政治性（例如，“我们应该出售我们的点击统计数据吗？”）。

（例如“该网站由 ACME Ltd. 运营，它使用匿名的每个会话标识符进行操作，仅在明确允许的情况下收集用户数据并且仅用于以下目的，数据仅在必要时存储，仅我们公司可以访问它，等等。”）。

（使用此工具进行编辑时，可以查看策略中的错误/遗漏。“HTML 策略”选项卡也非常有用：在底部，它有一个“策略评估” - 快速检查策略是否会被阻止通过 IE 的默认设置）

编辑器导出到 .p3p 文件，这是上述策略的 XML 表示。此外，它可以导出此策略的“精简版”。

## 政策链接

然后需要一个政策参考文件 ( `http://example.com/w3c/p3p.xml`)（网站使用的隐私政策索引）：

```
<META>
  <POLICY-REFERENCES>
    <POLICY-REF about="/w3c/example-com.p3p#policy1">
      <INCLUDE>/</INCLUDE>
      <COOKIE-INCLUDE/>
    </POLICY-REF>
  </POLICY-REFERENCES>
</META> 
```

`<INCLUDE>`显示将使用此策略的所有 URI（在我的例子中是整个站点）。我从编辑器导出的策略文件已上传到`http://example.com/w3c/example-com.p3p`

## 发送带有响应的紧凑标头

我在 example.com 上设置了网络服务器以发送带有响应的紧凑标头，如下所示：

```
HTTP/1.1 200 OK 
P3P: policyref="/w3c/p3p.xml", CP="IDC DSP COR IVAi IVDi OUR TST"
// ... other headers and content 
```

`policyref`是策略参考文件的相对 URI（它反过来引用隐私策略），`CP`是紧凑的策略表示。**请注意，示例中的 P3P 标头组合可能不适用于您的特定网站；您的 P3P 标头必须如实代表您自己的隐私政策！**

# 利润！

在此配置中，不会出现 Evil Eye，cookie 甚至保存在 IFRAME 中，并且应用程序可以正常工作。

# 编辑：不该做什么，除非你喜欢为诉讼辩护

一些人建议“在你的 P3P 标题中添加一些标签，直到 Evil Eye 放弃”。

标签不仅是一堆比特，它们还具有**现实世界的意义**，它们的使用赋予了你**现实世界的责任**！

例如，假装你从不收集用户数据可能会让浏览器高兴，但如果你真的收集用户数据，那么 P3P 与现实相冲突。简单明了，**您是故意对用户撒谎**，这在某些国家可能是犯罪行为。如，“去监狱，不要收 200 美元”。

一些示例（[请参阅 p3pwriter 了解完整的标签集](http://www.p3pwriter.com/LRN_111.asp)）：

*   **NOI**：“网站不收集已识别的数据。” （一旦有任何自定义、登录或任何数据收集（***** 分析，有人吗？），您**必须**在 P3P 中确认）
*   **STP**：保留信息以满足所述目的。这要求尽可能早地丢弃信息。站点必须具有建立销毁时间表的保留策略。保留政策必须包含在网站的可读隐私政策中或与之链接。”（因此，如果您发送`STP`但没有保留政策，您*可能*会进行欺诈。这有多酷？一点也不。）

我不是律师，但我不愿意去法庭看看 P3P 标头是否*真的*具有法律约束力，或者您是否可以向您的用户承诺任何事情而实际上并不愿意兑现您的承诺。

* * *

## 回答 #2

> 赞同：170
> 
> 时间：2013-05-10T04:16:00.193

我一天中的大部分时间都在研究这个 P3P 事物，我觉得有必要分享我的发现。

我注意到 P3P 概念非常过时，似乎只有 Internet Explorer (IE) 真正使用/强制执行。

最简单的解释是：如果您使用 cookie，IE 希望您定义一个 P3P 标头。

这是一个好主意，幸运的是，大多数时候不提供此标头不会导致任何问题（阅读浏览器警告）。除非您的网站/Web 应用程序使用 (i)Frame 加载到其他网站。这就是IE在***中成为巨大痛苦的地方。除非设置了 P3P 标头，否则它将不允许您设置 cookie。

知道了这一点，我想找到以下两个问题的答案：

1.  谁在乎？换句话说，如果我在标题中输入“Potato”一词，我会被起诉吗？
2.  其他公司是做什么的？

我的发现是：

1.  没人在乎。我找不到表明该技术具有任何法律效力的单一文件。在我的研究中，我没有发现世界上任何一个国家都通过了一项法律，禁止你在 P3P 标题中添加“Potato”这个词
2.  Google 和 Facebook 都在其 P3P 标头字段中放置了一个链接，该链接指的是描述他们为什么没有 P3P 标头的页面。

这个概念诞生于 2002 年，令我感到困惑的是，这个过时且在法律上未实现的概念仍然强加给 IE 内的开发人员。如果此标头没有任何法律后果，则应忽略此标头（或者，在控制台中生成警告或通知）。不强制！我现在被迫在我的代码中添加一行（并向客户端发送一个标头），这完全没有任何作用。

简而言之 - 为了让 IE 满意 - 将以下行添加到您的 PHP 代码中（其他语言应该看起来相似）

```
header('P3P: CP="Potato"'); 
```

问题解决了，IE 对这个土豆很满意。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2010-02-19T15:24:43.240

通过简单地将这个小标题添加到 IFrame 中的站点（PHP 解决方案），我能够让邪恶的眼睛消失：

```
header('P3P: CP="NOI ADM DEV COM NAV OUR STP"'); 
```

**请记住按 ctrl+F5**重新加载您的站点，否则 Explorer 可能仍会显示邪恶的眼睛，尽管它工作正常。这可能是我在让它工作时遇到这么多问题的主要原因。

根本不需要任何策略文件。

编辑：我发现了一个很好的博客条目，它解释了 IFrame 中的 cookie 问题。它在 C# 代码中也有一个快速修复： [Frames, ASPX Pages and Rejected Cookies](http://aspnetresources.com/blog/frames_webforms_and_rejected_cookies)

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2013-05-24T14:16:26.077

这隐藏在其他答案的评论中，但我几乎错过了它，所以它似乎应该得到自己的答案。

回顾：为了让 IE 接受 3rd 方 cookie，您需要使用名为 p3p 的 http 标头以以下格式提供文件：

```
CP="my compact p3p policy" 
```

但是，在这一点上，p3p 作为标准几乎已经死了，您可以轻松地让 IE 工作，而无需投入时间和法律资源来创建真正的 p3p 策略。这是因为如果您的紧凑 p3p 策略标头无效，IE 实际上会将其视为良好策略并接受 3rd 方 cookie。所以你可以使用这样的 p3p 标头

```
CP="This site does not have a p3p policy." 
```

您可以选择包含指向页面的链接，该链接解释您为什么没有 p3p 政策，就像 Google 和 Facebook 所做的那样（他们指向此处： https: [//support.google.com/accounts/answer/151657](https://support.google.com/accounts/answer/151657)和此处：[https ://www.facebook.com/help/327993273962160/](https://www.facebook.com/help/327993273962160/)）。

最后，重要的是要注意，从第 3 方站点提供的所有文件都需要具有 p3p 标头，而不仅仅是设置 cookie 的文件，因此您可能无法仅在 PHP、asp.net 等中执行此操作代码。您最好设置在 Web 服务器级别（即在 IIS 或 Apache 中）。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2011-10-27T19:21:55.980

我也遇到了这个问题，以为我会发布我在 MVC2 项目中使用的代码。在页面生命周期中添加标头时要小心，否则会收到 HttpException“**服务器无法在发送 HTTP 标头后附加标头**”。我在 OnActionExecuting 方法上使用了自定义 ActionFilterAttribute（在执行操作之前调用）。

```
/// <summary>
/// Privacy Preferences Project (P3P) serve a compact policy (a "p3p" HTTP header) for all requests
/// P3P provides a standard way for Web sites to communicate about their practices around the collection, 
/// use, and distribution of personal information. It's a machine-readable privacy policy that can be 
/// automatically fetched and viewed by users, and it can be tailored to fit your company's specific policies.
/// </summary>
/// <remarks>
/// More info http://www.oreillynet.com/lpt/a/1554
/// </remarks>
public class P3PAttribute : ActionFilterAttribute
{
    /// <summary>
    /// On Action Executing add a compact policy "p3p" HTTP header
    /// </summary>
    /// <param name="filterContext"></param>
    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        HttpContext.Current.Response.AddHeader("p3p","CP=\"IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT\"");

        base.OnActionExecuting(filterContext);
    }
} 
```

示例使用：

```
[P3P]
public class HomeController : Controller
{
    public ActionResult Index()
    {
        ViewData["Message"] = "Welcome!";

        return View();
    }

    public ActionResult About()
    {
        return View();
    }
} 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2010-08-23T22:44:45.910

这是关于这个问题的一个很好的话题，但是我发现没有在这里或其他任何地方发布的一个重要细节（至少在我的情况下是必不可少的）（如果我错过了，我很抱歉）是 P3P 线路必须是传入从第 3 方服务器发送的**每个**文件的标头，即使是未设置或使用 cookie 的文件，例如 Javascript 文件或图像。否则 cookie 将被阻止。我在这里的帖子中有更多关于此的信息：http: [//posheika.net/ ?p=110](http://posheika.net/?p=110)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-04-17T07:06:34.300

在 node.js 中遇到此问题的任何人。

然后添加这个 p3p 模块，并在中间件中启用这个模块。

```
npm install p3p 
```

我正在使用 express，所以我将它添加到 app.js

首先在 app.js 中需要该模块

```
var express = require('express');
var app = express();
var p3p = require('p3p'); 
```

然后将其用作中间件

```
app.use(p3p(p3p.recommended)); 
```

它将在 res 对象中添加 p3p 标头。无需做任何额外的事情。

您将在以下位置获得更多信息：

[https://github.com/troygoode/node-p3p](https://github.com/troygoode/node-p3p)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-01-07T22:06:01.007

如果有人正在寻找 Apache 线；我们用了这个。

> 标头设置 P3P "CP=\"感谢 IE8\""

只要有 P3P 标头，我们将 CP 值设置为什么并不重要。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-04-17T10:10:20.277

一种可能的做法是将域添加到工具中允许的站点 -> 互联网选项 -> 隐私 -> 站点：somedomain.com -> 允许 -> 确定。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-04-05T13:02:35.883

[这篇文章](http://www.marco.org/1287369)提供了一些关于 P3P 的评论和一个减少 IE7 和 IE8 问题的捷径解决方案。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-06-13T12:00:40.663

我在这里没有提到的一种解决方案是使用[会话存储](http://en.wikipedia.org/wiki/Web_storage#sessionStorage)而不是 cookie。当然，这可能不适合每个人的要求，但在某些情况下，它是一个简单的解决方案。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2016-04-06T14:23:18.017

我正在调查有关通过 Azure 访问控制服务注销的问题，但无法连接任何东西的头部和尾部。

然后，偶然发现了这篇文章[https://blogs.msdn.microsoft.com/ieinternals/2011/03/10/beware-cookie-sharing-in-cross-zone-scenarios/](https://blogs.msdn.microsoft.com/ieinternals/2011/03/10/beware-cookie-sharing-in-cross-zone-scenarios/)

简而言之，IE 不会跨区域共享 cookie（例如 Internet 与受信任的站点）。

因此，如果您的 IFrame 目标和 html 页面位于不同区域的 P3P 将无济于事。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-08-21T15:39:51.587

遇到了类似的问题，今天早上也去研究如何生成P3P策略，这里是我关于如何生成自己的策略并在网站上使用的帖子:) [http://everydayopenslikeaflower.blogspot.com/2009/08/如何创建-p3p-policy-and-implement.html](http://everydayopenslikeaflower.blogspot.com/2009/08/how-to-create-p3p-policy-and-implement.html)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-09-13T14:47:09.543

我之前已经实施了完整的 P3P 政策，但不想再为我正在从事的新项目经历麻烦。我发现此链接对于问题的简单解决方案很有用，只需指定“CAO PSA OUR”的最小紧凑 P3P 策略：

[http://blog.sweetxml.org/2007/10/minimal-p3p-compact-policy-suggestion.html](http://blog.sweetxml.org/2007/10/minimal-p3p-compact-policy-suggestion.html)

该文章引用了 Microsoft 知识库文章的（现已损坏）链接。政策对我有用！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-11-09T15:46:56.617

您还可以像这样组合 p3p.xml 和 policy.xml 文件：

/home/ubuntu/sites/shared/w3c/p3p.xml

```
<META xmlns="http://www.w3.org/2002/01/P3Pv1">
  <POLICY-REFERENCES>
    <POLICY-REF about="#policy1">
      <INCLUDE>/</INCLUDE>
      <COOKIE-INCLUDE/>
    </POLICY-REF>
  </POLICY-REFERENCES>
  <POLICIES>
    <POLICY discuri="" name="policy1">
      <ENTITY>
        <DATA-GROUP>
          <DATA ref="#business.name"></DATA> 
          <DATA ref="#business.contact-info.online.email"></DATA> 
        </DATA-GROUP>
      </ENTITY>
      <ACCESS>
        <nonident/>
      </ACCESS>
      <!-- if the site has a dispute resolution procedure that it follows, a DISPUTES-GROUP should be included here -->
      <STATEMENT>
        <PURPOSE>
          <current/>
          <admin/>
          <develop/>
        </PURPOSE>
        <RECIPIENT>
          <ours/>
        </RECIPIENT>
        <RETENTION>
          <indefinitely/>
        </RETENTION>
        <DATA-GROUP>
          <DATA ref="#dynamic.clickstream"/>
          <DATA ref="#dynamic.http"/>
        </DATA-GROUP>
      </STATEMENT>
    </POLICY>
  </POLICIES>
</META> 
```

我发现添加标头的最简单方法是通过 Apache 代理并使用 mod_headers，如下所示：

```
<VirtualHost *:80>
  ServerName mydomain.com

  DocumentRoot /home/ubuntu/sites/shared/w3c/

  ProxyRequests off
  ProxyPass /w3c/ !
  ProxyPass / http://127.0.0.1:8080/
  ProxyPassReverse / http://127.0.0.1:8080/
  ProxyPreserveHost on

  Header add p3p 'P3P:policyref="/w3c/p3p.xml", CP="NID DSP ALL COR"'
</VirtualHost> 
```

因此，我们将除 /w3c/p3p.xml 之外的所有请求代理到我们的应用程序服务器。

您可以使用[W3C 验证器对其进行测试](http://www.w3.org/P3P/validator.html)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-12-12T18:37:56.060

我知道将我的贡献放在这个主题上有点晚了，但是我浪费了很多时间，也许这个答案会对某人有所帮助。

我试图在我的网站上调用第三方 cookie，当然它不能在 Internet Explorer 10 上运行，即使是在低安全级别...不要问我为什么。在 iframe 中，我使用 ajax 调用了 read_cookie.php (echo $_COOKIE)。

而且我不知道为什么我无法设置 P3P 策略来解决问题......

在我的搜索过程中，我看到了一些关于让 JSON 中的 cookie 工作的东西。我什至没有尝试，因为我认为如果 cookie 不会通过 iframe，它就不会再通过数组...

你猜怎么着！所以如果你 json_encode 你的 cookie 然后在你的 ajax 请求之后解码，你会得到它！

也许我错过了什么，如果我错过了，我很抱歉，但我从未见过如此愚蠢的事情。为安全起见阻止第三方 cookie，为什么不，但如果编码则让它通过？现在安全在哪里？

我希望这篇文章能再次对某人有所帮助，如果我错过了什么并且我很愚蠢，请教育我！

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-08-27T15:18:04.077

**如果您拥有需要嵌入的域**，那么您可以在调用包含 IFrame 的页面之前重定向到该域，这将创建 cookie 并重定向回来，如下所述：[http://www.mendoweb。是/博客/internet-explorer-safari-third-party-cookie-problem/](http://www.mendoweb.be/blog/internet-explorer-safari-third-party-cookie-problem/)

这将适用于 Internet Explorer，但也适用于 Safari（因为 Safari 也会阻止第三方 cookie）。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2015-02-26T18:38:40.043

这终于对我有用（经过很多麻烦并使用 IBM 的策略生成器生成了一些策略）。您可以在此处下载策略生成器：http: [//www.softpedia.com/get/Security/Security-Related/P3P-Policy-Editor.shtml](http://www.softpedia.com/get/Security/Security-Related/P3P-Policy-Editor.shtml)

我无法再从 IBM 官方网站下载生成器。

我在我的 Web-App 的根文件夹中创建了这些文件

```
/index.php
/w3c/policy.html (Human readable format)
/w3c/p3p.xml
/w3c/policy.p3p 
```

1.  Index.php：只需发送一个额外的标头：

```
header('P3P: policyref="/w3c/p3p.xml", CP="ALL DSP NID CURa ADMa DEVa HISa OTPa OUR NOR NAV DEM"'); 
```

2.  p3p.xml 的内容

```
<META>
    <POLICY-REFERENCES>
        <POLICY-REF about="/w3c/policy.p3p#App">
            <INCLUDE>/</INCLUDE>
            <COOKIE-INCLUDE/>
        </POLICY-REF>
    </POLICY-REFERENCES>
</META> 
```

3.  我的 policy.html 文件的内容

```
<html>
<head>
<STYLE type="text/css">
title { color: #3333FF}
</STYLE>
<title>Privacy Statement for YOUR COMPANY NAME</title>
</head>
<body>
<h1 class="title">Privacy Policy</h1>
<!-- "About Us" section of privacy policy -->
<h2>About Us</h2>
<p>This is a privacy policy for YOUR COMPANY NAME.
Our homepage on the Web is located at <a href="YOURWEBSITE">
YOURWEBSITE</a>.
The full text of our privacy policy is available on the Web at 
<a href="ABSOLUTE URL OF THIS FILE">
ABSOLUTE URL OF THIS FILE</a>
This policy does not tell users where they can go to exercise their opt-in or opt-out options.
<p>We invite you to contact us if you have questions about this policy.
You may contact us by mail at the following address:
<pre>FIRSTNAME LASTNAME
YOUR ADDRESS HERE
</pre>
<p>You may contact us by e-mail at 
<a href="mailto:info@YOURMAIL.de">
info@YOURMAIL.eu</a>. 
You may call us at TELEPHONENUMBER.
<!-- "Privacy Seals" section of privacy policy -->
<h2>Dispute Resolution and Privacy Seals</h2>
<p>We have the following privacy seals and/or dispute resolution mechanisms.
If you think we have not followed our privacy policy in some way, they can help you resolve your concern.
<ul>
<li>
<b>Dispute</b>:
Contact us for further information
</ul>
<!-- "Additional information" section of privacy policy -->
<h2>Additional Information</h2>
<p>
This policy is valid for 1 day from the time that it is loaded by a client.
</p>
<!-- "Data Collection" section of privacy policy -->
<h2>Data Collection</h2>
<p>P3P policies declare the data they collect in groups (also referred to as "statements").
This policy contains 1 data group.
<hr width="50%" align="center">
<h3>Group "App control data"</h3>
<p>We collect the following information:
<ul>
<li>HTTP cookies</li>
</ul>
<p>This data will be used for the following purposes:</p>
<ul>
<li>Completion and support of the current activity.</li>
<li>Web site and system administration.</li>
<li>Research and development.</li>
<li>Historical preservation.</li>
<li>Other purposes<p>Control Flow of the application</p></li>
</ul>
<p>This data will be used by ourselves and our agents.
<p>The data in this group has been marked as non-identifiable. This means that there is no
reasonable way for the site to identify the individual person this data was collected from.
<p>The following explanation is provided for why this data is collected:</p>
<blockquote>This cookie data is only used to control the application within an iframe (e.g. a Facebook App)</blockquote>
<!-- "Use of Cookies" section of privacy policy -->
<hr width="50%" align="center">
<h2>Cookies</h2>
<p>Cookies are a technology which can be used to provide you with tailored information from a Web site. A cookie is an element of data that a Web site can send to your browser, which may then store it on your system. You can set your browser to notify you when you receive a cookie, giving you the chance to decide whether to accept it.
<p>Our site makes use of cookies.
Cookies are used for the following purposes:
<ul>
<li>Site administration
<li>Completing the user's current activity
<li>Research and development
<li>Other
(Control Flow of the application)
</ul>
<!-- "Compact Policy Explanation" section of privacy policy -->
<hr width="50%" align="center">
<h2>Compact Policy Summary</h2>
<p>The compact policy which corresponds to this policy is:
<pre>
    CP="ALL DSP NID CURa ADMa DEVa HISa OTPa OUR NOR NAV"
</pre>
<p>The following table explains the meaning of each field in the compact policy.
<center><table width="80%" border="1" cols="2">
<tr><td align="center" valign="top" width="20%"><b>Field</b></td><td align="center" valign="top" width="80%"><b>Meaning</b></td></tr>
<tr><td align="left" valign="top" width="20%"><tt>CP=</tt></td>
<td align="left" valign="top" width="80%">This is the compact policy header; it indicates that what follows is a P3P compact policy.</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>ALL</tt></td>
<td align="left" valign="top" width="80%">
Access to all collected information is available.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>DSP</tt></td>
<td align="left" valign="top" width="80%">
The policy contains at least one dispute-resolution mechanism.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>NID</tt></td>
<td align="left" valign="top" width="80%">
The information collected is not personally identifiable.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>CURa</tt></td>
<td align="left" valign="top" width="80%">
The data is used for completion of the current activity.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>ADMa</tt></td>
<td align="left" valign="top" width="80%">
The data is used for site administration.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>DEVa</tt></td>
<td align="left" valign="top" width="80%">
The data is used for research and development.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>HISa</tt></td>
<td align="left" valign="top" width="80%">
The data is used for historical archival purposes.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>OTPa</tt></td>
<td align="left" valign="top" width="80%">
The data is used for other purposes.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>OUR</tt></td>
<td align="left" valign="top" width="80%">
The data is given to ourselves and our agents.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>NOR</tt></td>
<td align="left" valign="top" width="80%">
The data is not kept beyond the current transaction.
</td></tr>
<tr><td align="left" valign="top" width="20%"><tt>NAV</tt></td>
<td align="left" valign="top" width="80%">
Navigation and clickstream data is collected.
</td></tr>
</table></center>
<p>The compact policy is sent by the Web server along with the cookies it describes.
For more information, see the P3P deployment guide at <a href="http://www.w3.org/TR/p3pdeployment">http://www.w3.org/TR/p3pdeployment</a>.
<!-- "Policy Evaluation" section of privacy policy -->
<hr width="50%" align="center">
<h2>Policy Evaluation</h2>
<p>Microsoft Internet Explorer 6 will evaluate this policy's compact policy whenever it is used with a cookie.
The actions IE will take depend on what privacy level the user has selected in their browser (Low, Medium, Medium High, or High; the default is Medium.
In addition, IE will examine whether the cookie's policy is considered satisfactory or unsatisfactory, whether the cookie is a session cookie or a persistent cookie, and whether the cookie is used in a first-party or third-party context.
This section will attempt to evaluate this policy's compact policy against Microsoft's stated behavior for IE6.
<p><b>Note:</b> this evaluation is currently experimental and should not be considered a substitute for testing with a real Web browser.
<p><b>Satisfactory policy</b>: this compact policy is considered <em>satisfactory</em> according to the rules defined by Internet Explorer 6.
IE6 will accept cookies accompanied by this policy under the High, Medium High, Medium, Low, and Accept All Cookies settings.
</body></html>
```

4.  policy.p3p 的内容

```
<?xml version="1.0"?>
<POLICIES xmlns="http://www.w3.org/2002/01/P3Pv1">
    <!-- Generated by IBM P3P Policy Editor version Beta 1.12 built 2/27/04 1:19 PM -->

    <!-- Expiry information for this policy -->
    <EXPIRY max-age="86400"/>

<POLICY
    name="App"
    discuri="ABSOLUTE URL TO policy.html"
    xml:lang="de">
    <!-- Description of the entity making this policy statement. -->
    <ENTITY>
    <DATA-GROUP>
<DATA ref="#business.name">COMPANY NAME</DATA>
<DATA ref="#business.contact-info.online.email">info@YOURMAIL.eu</DATA>
<DATA ref="#business.contact-info.online.uri">YOURWEBSITE</DATA>
<DATA ref="#business.contact-info.telecom.telephone.number">YOURPHONENUMBER</DATA>
<DATA ref="#business.contact-info.postal.organization">FIRSTNAME LASTNAME</DATA>
<DATA ref="#business.contact-info.postal.street">STREET</DATA>
<DATA ref="#business.contact-info.postal.city">CITY</DATA>
<DATA ref="#business.contact-info.postal.stateprov">STAGE</DATA>
<DATA ref="#business.contact-info.postal.postalcode">POSTALCODE</DATA>
<DATA ref="#business.contact-info.postal.country">Germany</DATA>
    </DATA-GROUP>
    </ENTITY>

    <!-- Disclosure -->
    <ACCESS><all/></ACCESS>

    <!-- Disputes -->
    <DISPUTES-GROUP>
        <DISPUTES resolution-type="service" service="YOURWEBSITE CONTACT FORM" short-description="Dispute">
            <LONG-DESCRIPTION>Contact us for further information</LONG-DESCRIPTION>
    <!-- No remedies specified -->
        </DISPUTES>
    </DISPUTES-GROUP>

    <!-- Statement for group "App control data" -->
    <STATEMENT>
        <EXTENSION optional="yes">
            <GROUP-INFO xmlns="http://www.software.ibm.com/P3P/editor/extension-1.0.html" name="App control data"/>
        </EXTENSION>

    <!-- Consequence -->
    <CONSEQUENCE>
This cookie data is only used to control the application within an iframe (e.g. a Facebook App)</CONSEQUENCE>

    <!-- Data in this statement is marked as being non-identifiable -->
    <NON-IDENTIFIABLE/>

    <!-- Use (purpose) -->
    <PURPOSE><admin/><current/><develop/><historical/><other-purpose>Control Flow of the application</other-purpose></PURPOSE>

    <!-- Recipients -->
    <RECIPIENT><ours/></RECIPIENT>

    <!-- Retention -->
    <RETENTION><no-retention/></RETENTION>

    <!-- Base dataschema elements. -->
    <DATA-GROUP>
    <DATA ref="#dynamic.cookies"><CATEGORIES><navigation/></CATEGORIES></DATA>
    </DATA-GROUP>
</STATEMENT>

<!-- End of policy -->
</POLICY>
</POLICIES> 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-04-15T23:20:11.707

在 Rails 中，我正在使用这个 gem：[https:](https://github.com/merchii/rack-iframe) //github.com/merchii/rack-iframe 它设置了一组没有参考文件的缩写：[https ://github.com/merchii/rack-iframe/blob/master /lib/rack/iframe.rb#L8](https://github.com/merchii/rack-iframe/blob/master/lib/rack/iframe.rb#L8)

当您完全不关心 p3p 内容的含义时，它很容易安装。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-06-13T01:34:51.480

# 对于任何试图让 P3P 紧凑策略处理静态内容的人：

仅当您能够发送带有静态内容的自定义服务器端响应标头时**才有可能。**

有关更详细的解释，请参阅我的答案：[在 HTML 中设置 P3P 代码](https://stackoverflow.com/questions/24410195/set-p3p-code-in-html/30746110#30746110)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-06-18T20:27:11.540

在 Rails 3.2 中，我正在使用：

```
class ApplicationController < ActionController::Base  

  before_filter :set_p3p  

  private  
    # for IE session cookies thru iframe  
    def set_p3p  
      headers['P3P'] = 'CP="ALL DSP COR CURa ADMa DEVa OUR IND COM NAV"'  
    end  
end 
```

我从：[http ://dot-net-web-developer-bristol.blogspot.com/2012/04/setting-p3p-header-in-rails-session.html](http://dot-net-web-developer-bristol.blogspot.com/2012/04/setting-p3p-header-in-rails-session.html)

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2009-01-07T16:06:59.037

更好的解决方案是在 iframe 内对将获取/设置 cookie 的页面进行 Ajax 调用...

# c# - 运算符重载问题

> ID：389459
> 
> 赞同：2
> 
> 时间：2008-12-23T17:08:39.870
> 
> 标签：c#, .net

我正在尝试为自定义类编写运算符重载，但不知道如何处理空比较。

```
Class Customer
{
    int id;

    public static bool operator ==(Customer a, Customer b)
    {
        //When both a and b are null don't know how to compare as can't use == in here as
        //it will fall into loop
    }
} 
```

问题是当 a 和 b 都为空时结果为真，但不确定如何在不使用 == 的情况下检查它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T17:17:25.107

```
if (Object.ReferenceEquals(a,b))
     return true; 
```

ReferenceEquals() 检查它们是否指向完全相同的对象（或者它们是否都为空）

（作为一般规则，最好通过调用 ReferenceEquals 来启动 Equals() 方法，特别是在该方法的其余部分很复杂的情况下。它会使诸如`a==a`快速返回 true 之类的事情，而不必检查每个元素。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T17:13:55.100

我不是 100% 确定我理解这个问题，但你应该能够做到：

```
if (((object)a == null) && ((object)b == null))
{
    return true;
} 
```

没有任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T17:17:41.457

我通常使用`object.Equals(a, b)`.

在你的情况下：

```
public static bool operator ==(Customer a, Customer b)
{
    if(object.Equals(a, null) && object.Equals(b, null)
    { return true; }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T17:18:09.023

以下任何一项

```
 object.ReferenceEquals(a, null)
 object.Equals(a, null)
 (object)a == null; 
```

PS。我认为这在 Customer.Equals 中可能会更好，并且有 == 依赖它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T17:18:18.257

是否可以将它们强制转换为 system.object 并使用 == 运算符来检查它是否为空？我会检查它，但我不在开发机器上

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T17:30:56.343

我实现了以下内容，它像冠军一样工作：

```
public static bool operator ==(Customer a, Customer b)
{
    if(object.ReferenceEquals(a,b)
    { return true; }
    else if(((object)a == null) || ((object)b == null))
         {return false;}
    else if(a.Id == b.Id)
         {return true;}

    return false;
}

public static bool operator !=(Customer a, Customer b)
{
return !(a==b);
} 
```

# hibernate - Hibernate 和 JPA 有什么区别？

> ID：389470
> 
> 赞同：17
> 
> 时间：2008-12-23T17:13:20.263
> 
> 标签：hibernate, jpa

有人可以透视JPA和Hibernate之间的区别。还是这些互补的概念可以一起使用？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-23T19:20:07.653

粗略地说，JPA 是来自 java 社区的标准，[这里是规范](http://jcp.org/aboutJava/communityprocess/final/jsr220/index.html "JSR220")，它已经由 Hibernate 的人实现（和扩展）（[一些信息在这里](http://www.hibernate.org/397.html)）。作为规范，您不会直接使用 JPA，而是使用 JPA 实现。

请注意，如果您使用 hibernate JPA 的扩展，您将破坏与其他 JPA 实现的兼容性（尽管有些人会说“为什么要使用另一个 JPA 实现？”）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-02T05:12:38.323

2015 年更新：这是一个非常古老的问题，在过去的 6 年中发生了很多变化。如今，JPA API 的功能非常丰富，我建议使用 JPA，因为越来越多的工具和框架都与它保持一致。一个例子是 Spring Data JPA：它删除了许多常见任务的样板文件，并且非常高效：

[http://projects.spring.io/spring-data-jpa/](http://projects.spring.io/spring-data-jpa/)

原始答案：我会回应 cheng81 的评论，并投票支持使用普通的 Hibernate API。JPA 的功能集比 Hibernate 的要小，我认为没有理由仅仅因为它是一个“标准”就用“纯 JPA”来限制自己。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-15T13:45:49.390

Hibernate 是一个非常好的解决方案，但是它的许可证 (GPL) 意味着它不能在某些项目中使用。

JPA 是一个规范，它支持包括 Hibernate 在内的一系列实现，但也支持 OpenJPA 和其他具有不同特性的产品。

如果您可以只使用 Hibernate，那么它可能是值得的，因为它成熟、稳定且性能良好。但是，如果您需要将持久性引擎合并到附带非 GPL 许可证的产品中，则需要走 JPA 路线（或为商业 Hibernate 许可证付费）。

# bash - 如何在 Bash 中控制作业的“名称”？

> ID：389473
> 
> 赞同：4
> 
> 时间：2008-12-23T17:14:18.267
> 
> 标签：bash

我试图控制我的 xterm 窗口的标题，我的聪明才智终于超过了我的知识。:-)

我有三个功能：一个设置窗口的标题；一个接受传递的命令，调用标题函数，并执行命令；和一个在使用`jobs`确定标题后恢复工作的：

```
title () {
    echo -en "\e]1;$(hostname) : $1\a\e]2;$(hostname) : $2\a"
}

run () {
    title $(basename $1) "$*";
    $*
}

fg () {
    if [[ "x" == "x$1" ]]; then
        title $(jobs | awk '/\['$1'\]/{print $3}') "$(jobs | awk -F '  +' '/\[[0-9]\]\+/{print $3}')";
    else
        title $(jobs | awk '/\['$1'\]/{print $3}') "$(jobs | awk -F '  +' '/\['$1'\]/{print $3}')";
    fi;
    builtin fg $*
} 
```

现在，所有这些都运行得很好……嗯，主要是。通过手动调用函数来设置标题可以正常工作。通过`run`函数设置标题效果很好。通过恢复工作来设置标题可以正常工作……除非工作是使用以下`run`功能开始的：

```
$ nano foo.txt
<CTRL-Z>
$ run nano bar.txt
<CTRL-Z>
$ jobs
[1]-  Stopped                 nano foo.txt
[2]+  Stopped                 $* 
```

好吧，我想从技术上讲，这*是*函数正在执行的命令的名称`run`，但在这种情况下，知道这并不是一件真正有用的事情。

所以，由于我不仅已经达到而且*远远超出*了我对 Bash 的了解，也许这里有人可以帮助我解决这个问题。:-)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T21:45:42.867

好吧，这并不理想，但我想出了一个至少正确设置我的标题的解决方案：

```
fg () {
    if [[ "x" == "x$1" ]]; then
        _CMD=$(ps -o cmd --no-headers $(jobs -l | awk '/\[[0-9]\]\+/{print $2}'));
    else
        _CMD=$(ps -o cmd --no-headers $(jobs -l | awk '/\['$1'\]/{print $2}'));
    fi;
    title $(basename $(echo $_CMD | awk '{print $1}')) "$_CMD";
    unset _CMD;
    builtin fg $*;
} 
```

这使用`jobs`' -l 选项来获取进程 ID，然后使用 找到它`ps`，其中列出了正确的命令。不幸的是，`ps`它似乎很慢，在恢复时会导致明显的延迟（~¼ 秒）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-07-19T04:08:40.507

man bash 说：

> `fg [jobspec]` 在前台恢复 jobspec，并使其成为当前工作。如果 jobspec 不存在，则使用 shell 的当前作业概念。

在“当前工作”上：

> 符号 `%%` 和 `%+` 指的是 shell 对当前作业的概念，它是在前台停止或在后台启动时停止的最后一个作业。

这才是你真正想做的；无论如何模拟 fg 命令正在做什么。

这里的大多数其他技巧在参数扩展中有详细说明。

```
myfg() { # just so I know what I'm invoking while testing
    local cmdline
    cmdline=$(jobs -l "${1:-%%}") || return # bail if jobs failed
    cmdline=${cmdline:30} # Extract the part we want
    title "${cmdline%% *}" "${cmdline}"

    builtin fg "$jobspec"
} 
```

对于您的运行命令，在许多情况下， eval 命令将执行您想要的操作：

```
eval "$@" 
```

但是最好用单引号保护每个单词以防止重新评估它：

```
eval_safe() {
    local args
    args=( )
    for word in "$@"; do
        word=\'${word//\'/"'\\''"}\'
        args+=( "$word" )
    done
    eval "${args[*]}"
} 
```

引用是 bash 的语法变得*非常*混乱的地方。我没有引用`word=${...}`，而我在数组中引用它。您是否被引用*在*替换语法中很重要。在单个赋值中，bash 不进行分词，而它在数组中进行。（有可能`"${array[@]//source/target}"` 一次性完成，但我们已经在处理多个级别的引用。）

无论如何，这将评估单词并将它们传递回 bash，如果其中有奇怪的字符，则引用它们。

那是在可能没有必要的地方添加了一堆丑陋的引号，所以让我们添加：

```
[[ $word =~ ^[a-zA-Z0-9_./]+$ ]] || word=${...} 
```

这就是说，“这个词匹配这个安全的正则表达式，或者我们引用它。” 这至少是相当标准的正则表达式语法，除了与其他所有语言不同的是，您通常不分隔正则表达式。

# svn - 如果你将一组特定的修订从主干合并到一个带有颠覆的分支中，会发生什么？

> ID：389485
> 
> 赞同：1
> 
> 时间：2008-12-23T17:17:37.183
> 
> 标签：svn, branch, svn-merge

如果我在主干中对 3 个不同的文件进行更改，分别是修订版 40、45 和 47，而这些文件自修订版 15 以来都没有更改，我如何将这些修订版合并到分支中（在修订版 30 中进行并且自) 以便我只获得每个文件的 rev 15 和 rev 40、45 和 47 之间的更改？

在中间版本中进行了其他更改（显然），但它们不会影响有问题的文件，我不希望这些更改出现在分支中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T17:51:10.390

如果您只在这些提交中对这些文件进行了更改，那么请继续合并这些修订号。如果在这些提交中更改了其他文件，并且您不想要这些更改，我可能会继续进行合并，然后恢复您不想修改的文件的更改，然后进行提交。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T20:45:48.027

在我们的系统中，我们不断地进行这样的合并。在大多数情况下，一切都很好。

您可以在所有三个修订版上运行合并，只要更改不相互依赖，您就很好。

使用 TortoiseSVN 很容易，因为您可以简单地指定`40,45,47`为范围匹配。否则，只需`svn merge`为每个修订声明单独发布一个，它将把它们拉到一起。

如果您没有引入的更改影响相同的行，您将遇到合并冲突。这是最好的情况，因为这意味着您需要立即查看它以解决冲突。但是，与往常一样，仅仅因为它不是冲突，并不意味着您不会在编译/运行时遇到一些逻辑错误。

我个人每周做几百个这样的工作，所有这些都使用自动化脚本。由于我们的代码结构（一个大型存储库，其中大多数更改不会影响相同的文件），我们每周只会遇到一些冲突。

# c# - 我是 .NET 的新手——我应该专注于什么，应该忽略什么？

> ID：389487
> 
> 赞同：19
> 
> 时间：2008-12-23T17:17:51.003
> 
> 标签：c#, .net, data-binding, master-pages

所以，我有相当多的使用 php 和 Coldfusion 编程数据库驱动的 Web 应用程序的经验（不是一起，在不同的时间），我开始研究 asp.net 世界（我有一个项目正在工作这都是asp.net/c#。）

我的问题是：似乎*有很多*东西要陷入困境，如果我只是制作基于 Web 的应用程序（主要是 CRUD 类型的东西 - 没有令人费解的逻辑），我应该关注哪些主题？我只是不想在以后发现它并没有被开发社区过多使用的东西。在阅读一些书籍（ASP.net 3.5 一步一步和 ASP.net 3.5 释放）时，我发现了一些领域的主题将被解释，但在本章的末尾会说“这东西很酷，但不适合在多层应用程序中使用..."

到目前为止，我看过的主题（似乎与我习惯构建的应用程序有很大不同）是：

*   母版页
*   数据绑定
*   LINQ转SQL
*   ASP.NET MVC
*   模板和数据绑定表达式
*   asp.net 控件

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-23T17:47:37.763

好问题！我假设您可以随时掌握 C# 语法，因此我将专注于大局。

要开始使用 WebForms 应用程序，您*必须*了解页面生命周期和应用程序生命周期。这是你的首要任务。ASP.NET 使用的模型基于 Windows 基于窗体的编程，这会影响您对整个软件生产过程的看法。现在，我假设您将构建一个 WebForms 应用程序，因为 WebForms 技术（在 ASP.NET 中）更成熟，有更好的第三方支持并且有更多的文档。如果您倾向于 MVC，那么请记住，一个好的设计将是其中之一 - MVC 不是 WebForms 的一部分，它是它的替代品。

接下来，你有一些决定。您将使用标准数据访问（例如 SQLClient）工具、滚动您自己的数据访问层（或使用 DAL），还是使用 linq to SQL？我说“决定”是因为团队中的每个人都必须在这个问题上齐心协力。我衷心推荐构建一个 DAL，因为您可以根据需要对其进行优化。Linq 也不错，但[地平线上有一些不祥的云](http://vistadb.net/blog/news/microsoft-killing-linq-to-sql/)。协调、决定并坚持下去。

虽然不是强制性的，但您应该认真考虑在单独的类库 (DLL) 中构建业务逻辑。Visual Studio / ASP.NET 使创建您自己的类库并将其折叠到您的解决方案中变得非常容易。学习如何做到这一点，你将成为一个更好的开发人员多年。人们通常会基于它将您的 UI 与您的数据访问隔离开来争论这一点。虽然确实如此，但这并不是真正的优势 - 当您准备好学习和进行单元测试时，优势就会出现。刚开始假设您将从逻辑中分离 UI，并且您会在路上感谢我。

此时，您可以 (A) 构建网页并 (B) 在其中显示基于数据库的动态内容。确保您掌握了 GridView 和用于填充它们的 ObjectDataSource 对象。注意：ObjectDataSource 将数据从您的业务类库传送到您的 UI。如果您不使用业务层，那么您将使用 SQLDataSource 或 LinqDataSource 对象直接从 UI 访问您的数据。

还没有解决你的架构！

您现在需要决定是否要使用 Microsoft 的 WebParts、Login 和 Navigation 组件。这些将您锁定在站点导航、UI 等的特定方法中，但如果合适的话，可以为您节省大量时间。

一旦你知道你是否会使用这些并且你有机会习惯它们，那么我建议你熟悉母版页。我广泛使用它们，它们非常适合标准化网站的整体外观。

最后，每个专业的 ASP.NET 开发人员都必须派生出他们自己的 Page 类（例如“MyPageClass”），以便他们可以在 Page 级别封装常用操作。例如，我构建了一个会话管理对象，以便我可以以类型安全的方式访问所有常用的会话变量。派生的页面类负责提供 sessionObj 实例，以便*每个*页面都可以访问它而无需任何额外的工作。

现在您已准备好开始构建企业级 Web 应用程序！

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-23T17:26:09.520

设计一个应用程序。你*需要*知道的应该很快就会浮出水面。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T17:23:07.890

我会说你的清单是一个很好的开始。此外，如果您主要构建直接表应用程序，那么我会查看使用 REST 的 VS2008 SP1 中的“动态数据”示例应用程序。我倾向于远离 WebForms 模型并使用 ASP.Net MVC。它更适合测试，并且清晰地将业务逻辑与 UI 分开。此外，当您知道它的局限性时，Linq-to-Sql 是一个非常强大的工具。

我将首先使用 ASP.Net MVC 和 linq-to-sql 构建一个示例，让您的脚湿透。它很容易上手，并且不需要很长时间就可以学习足够的基础知识以使其有用。

最好的学习方法是做。

至于“我应该忽略什么？”：.Net Remoting 和 Web 服务。这已被称为 WCF 的更强大的框架所取代。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T17:24:22.567

你不应该忘记回顾的一件事，主要是如果你要开发一个 web 应用程序，你应该知道一个 webForm 的生命周期，你还需要熟悉服务器端是如何工作的，如何客户端工作。然后您可以查看母版页，以便在您的站点、asp .net 控件、用户控件等之间有一个共同的外观和行为。泛型、匿名方法，还有很多要学习的东西，实际上我正在努力学习每当我有空闲时间，C# 都会有一些新的东西......还有更多...... :)

祝你好运！！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T18:16:53.490

1.  先学C#
2.  选择一种 CRUD 面向对象的方法：选择是 Entity Framework（微软建议的选择）、Linq2SQL、Nhibernate（我个人的建议）。
3.  ASP.Net MVC+Nunit+JQuery+JSon 对象。
    我也会关注 WCF，因为它变得越来越重要。

Web 应用程序的一般架构和一个起始项目的两个很好的起点是：

*   [应用架构指南](http://www.codeplex.com/AppArchGuide)
*   [S#arp 架构](http://www.codeplex.com/SharpArchitecture)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T18:26:43.220

我先从基础开始。ASP.NET 2.0 和 3.5 中有很多强大的控件和“小部件”，尤其是 AJAX 控件，但我发现在没有首先了解的情况下尝试将所有这些都整理出来会令人困惑，正如你所说的' ASP.NET 中的基本 CRUD 网页——这是大多数实际项目无论如何都会归结为的。

我在 .NET Web 编程中必须处理的大多数问题和难以追踪的错误归结为我没有完全理解 ASP.NET 基础知识，如 PostBack、ViewState、Refresh 和 ASP.NET 数据绑定（基本的手工编码方法，而不是 2.0 中花哨的无代码网格的东西）——一旦你理解了这些东西，母版页、主题和 AJAX 的东西就很容易了。

我推荐 Wrox Press ASP.NET 2.0 或 Professional C# 2008

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T20:40:55.790

好吧，老实说，真正重要的一件事是了解静态使用的含义，以及它如何影响周围的事物。如果您不了解并发、线程安全和竞争条件，请不要使用静态。我只提到这一点是因为在过去的几个月里我一直在修复很多与未正确使用的静态资源有关的错误。这可能被认为是一个高级主题，但理解它非常重要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-17T14:17:17.510

如果您的网站非常繁重，请查看[动态数据](http://www.asp.net/dynamicdata/)。

如果您已经从其他平台获得了足够的知识，我还会看看诸如视图状态/控制状态之类的东西以及它们是如何工作的。

您可以从其他平台 html/javascript 重用您的大部分知识。母版页是要知道的事情，以及使用它们时页面生命周期会发生什么。

ORM/SQL 注入/输入过滤是你也应该熟记的东西。

如果您过去使用过 MVC 框架，那么请使用 MS MVC，如果没有，那么您可能需要等到对它们感到满意后再深入研究。

# opengl - 在 Cygwin 下编译最小的 GLEW 应用程序

> ID：389488
> 
> 赞同：6
> 
> 时间：2008-12-23T17:17:56.603
> 
> 标签：opengl, cygwin, glew

让我们考虑以下程序并尝试在 Cygwin 下编译它：

```
#include <GL/glut.h>
int main(int argc, char** argv)
{
    glutInit(&argc, argv);
    glLoadIdentity();
} 
```

它编译并运行得很好。`-I/usr/include/opengl`似乎非常重要。

```
g++ -I/usr/include/opengl -I../include/cygwin -L../lib/cygwin test.cpp -o test.exe -lglut32 -lglu32 -lglew32 -lopengl32 
```

现在，

```
#include <GL/glew.h> // from newest NVIDIA SDK
#include <GL/glut.h>
int main(int argc, char** argv)
{
    glewInit();
    glutInit(&argc, argv);
    glLoadIdentity();
} 
```

编译

```
g++ -I/usr/include/opengl -I../include/cygwin -L../lib/cygwin test.cpp -o test.exe -lglut32 -lglu32 -lglew32 -lopengl32 
```

失败。如何构建第二个应用程序？

### 第一的

从 NVIDIA SDK 构建 glew 的方法有多种：VS、cygwin、cygwin 和 -D_WIN32。我还尝试了来自源代码的原始 glew 的 cygwin 构建。

VS构建给出

```
/cygdrive/c/DOCUME~1/kelebron/LOCALS~1/Temp/ccErbecl.o:test.cpp:(.text+0xa8): undefined reference to `_glLoadIdentity'
collect2: ld returned 1 exit status 
```

cygwin 构建提供了许多

```
../lib/cygwin/glew32.lib(glew.o):glew.c:(.text+0x38e): undefined reference to `_glXGetProcAddress' 
```

并且带有 -D_WIN32 的 cygwin 根本无法编译（[这篇文章](http://sourceforge.net/mailarchive/forum.php?thread_name=cd39a5a20711290045u7f1f1f15g77a148c1453d8e79%40mail.gmail.com&forum_name=glew-users)让我有点激动）。

### 第二

似乎有两种方法可以
使用 -L/lib/w32api
或 -L/usr/X11R6/lib -lX11 -lXi -lXmu与 OpenGL 链接

但是，-L 指令不会改变任何东西。我有 /usr/lib/w32api/libopengl32.a，但可能缺少 X11 版本（/usr/X11R6/lib/libGL？）。我应该在 Cygwin 中包含什么软件包？我已经安装了所有从 libGL 开始的（不仅......）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-08T01:38:15.347

前阵子也遇到过类似的问题，发现在Cygwin下编译opengl代码有两种方式。
第一个与本机 win32api 库 glut32 glu32 opengl32 （也是 glui）的链接。那些有点旧：
glut v3.7.6
opengl v1.1 glui
2.11

第二种方法使用X11库 glut glu gl。他们的头文件中有更新的版本号（请注意，使用 GL 扩展需要>v1.2）：
glut v4 (freeglut)
opengl v1.3
glext
...

所以要使用第一个选项：**-I/usr/包含/opengl**
并链接到：**-lglut32 -lGLU32 -lOpenGL32**

要使用 X11 版本，请使用以下命令编译：**-I/usr/include/**（默认包含）
并链接：**-lglut -lGLU -lGL**（注意区别）
您可以添加 X11 头文件和库，但我猜它们包含在 GL 中。
**-I/usr/X11R6/include**
**-L/usr/X11R6/lib -lXmu -lXi -lXext -lX11**

在 Cygwin 安装程序中，您可以选择以下软件包：
**opengl** -- 提供 opengl、glut、
**glui libglut的 win32 版本-devel** -- X11 版本的 glut (freeglut)，这也会选择所有依赖的包。（glproto、libGL libGLU、libX11、...）
我还建议包括**Xorg-server**，因为您需要 X 服务器。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-21T03:33:57.473

只是为了确保我们谈论的是相同的问题，这是我以前得到的信息。

> $ g++ -o glew_test.exe glew_test.cpp -lglut32 -lglew32
> c:\Users\Fredrik\Users\Fredrik\AppAppData\Local\Temp/ccgSNdfr.o:
> glew_test.cpp:(.text+0x1c): undefined reference to ` __glutInitWithExit'
> c:\Users\Fredrik\AppData\Local\Temp/ccgSNdfr.o:
> glew_test.cpp:(.text+0x37): undefined reference to `__glutCreateWindowWithExit'
> c:\Users\Fredrik\AppData\Local\Temp/ccgSNdfr .o:
> glew_test.cpp:(.text+0x53): undefined reference to `__glutCreateMenuWithExit'
> c:\Users\Fredrik\AppData\Local\Temp/ccgSNdfr.o:
> glew_test.cpp:(.text+0x9e): undefined reference到 `glutInitDisplayMode'
> c:\Users\Fredrik\AppData\Local\Temp/ccgSNdfr.o:
> glew_test.cpp:(.text+0xb2): undefined reference to `glutInitWindowPosition'
> c:\Users\Fredrik\AppData\Local\Temp/ccgSNdfr.o:
> glew_test.cpp:(.text+0xc6): undefined reference to `glutInitWindowSize'
> collect2: ld 返回 1 exit status

以下页面帮助我解决了这个问题。

*   [www.mingw.org/node/28](http://www.mingw.org/node/28)
*   glew.sourceforge.net/install.html

基本上我必须在文件开头定义 _STDCALL_SUPPORTED 和 _M_IX86 并在 glew.h 之前包含 windows.h

然后我使用了标志 -lglut32 -lglew32

如果您想尝试一下，这也是源代码：

```
#define _STDCALL_SUPPORTED
#define _M_IX86
#include <windows.h>
#include <GL/glew.h>
#include <GL/glut.h>
#include <cstdio>

int main(int argc, char **argv) {
    glutInit(&argc, argv);
    glutCreateWindow("MM 2004-05");
    glewInit();
    if (glewIsSupported("GL_VERSION_2_0"))
        printf("Ready for OpenGL 2.0\n");
    else {
        printf("OpenGL 2.0 not supported\n");
    }
    return 0;
} 
```

请注意，出于某种原因，OpenGL2.0 测试需要该窗口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T20:13:48.060

听起来您想链接本机 Win32 库而不是 X11。添加*-L/lib/w32api*。否则，您需要链接 X11 库（*-L/usr/X11R6/lib -lX11 -lXi -lXmu*）以消除 glX* 链接器错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-03T22:11:30.633

以前的建议对您有用吗？

我不清楚您是否在链接或编译 GLEW 时遇到问题。我通过包含源使用 GLEW，并且过去通过链接使用过。

如果要编译 GLEW，请确保选择正确的 zip，因为使用基于 *nix 的代码的脚本可能无法在 Windows 下正确运行（不确定 Cygwin）。

GLEW 应该在标题和链接顺序中排在第一位。

# linux - 为 linux/freebsd 制作的替代品？

> ID：389496
> 
> 赞同：12
> 
> 时间：2008-12-23T17:21:18.720
> 
> 标签：linux, makefile, freebsd

为 linux/freebsd[制作](http://en.wikipedia.org/wiki/Make_(software))哪些替代品？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-23T18:25:42.083

我喜欢[SCons](http://www.scons.org)。它的构造方式使得每个构建脚本（一个`SConstruct`文件）也是一个语法上有效的 Python 程序。因此，如果需要，您可以在构建脚本中构建任意 Python 逻辑。

`make`它也比自动计算多种依赖关系快得多。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-23T18:22:12.590

我的第一个问题是，观众是什么。这是为了构建只有您的团队才能构建的内部软件吗？如果是这样，请探索一些已经提出的选项。如果这是其他人将要构建的东西，要么坚持使用 make，要么使用创建 makefile 的工具并发布它们。我们在 Linux 和其他 unix 平台上使用 autoconf 和 automake。在我看来，你需要一个很好的理由来做除了配置之外的事情；制作; 进行安装。Boost 有自己的工具（Jam 的修改版本），每次我需要尝试让它在不寻常的机器上编译时，它都会让我很烦恼。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-23T17:25:02.237

[cmake](http://www.cmake.org/)和[imake](http://en.wikipedia.org/wiki/Imake)都是构建实用程序，尽管不再维护 Imake。Cmake 也是跨平台的，也可以在 Windows 上使用。

如果你喜欢 Java，[ANT](http://en.wikipedia.org/wiki/Apache_Ant)是一个面向 Java 的构建工具（它不能很好地与 Make 配合使用）。

Troll tech 制作了一个名为[qmake](http://en.wikipedia.org/wiki/Qmake)的工具，他们用它来构建 QT。它通过生成 makefile 来工作——Troll 需要一个工具来支持跨平台构建——所以你仍然需要另一个 make 实用程序。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-23T17:23:47.980

Automake :p 在大多数 linux 应用程序发行版中常用，但它比 Makefile 提供更多的工作，但效果更好[http://www.gnu.org/software/automake/](http://www.gnu.org/software/automake/)

[http://www.openismus.com/documents/linux/automake/automake.shtml](http://www.openismus.com/documents/linux/automake/automake.shtml) <--关于如何使用 automake 和 autoconf 的很好的解释

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-23T17:29:05.507

如果您正在寻找完全不同的东西，那就是[Ant](http://ant.apache.org/)。我自己对此并不感兴趣，但它确实提供了一些可移植性优势（不依赖于 unix shell 等）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-23T18:21:24.713

我听说过有关[Jam](http://freetype.sourceforge.net/jam/index.html)的好消息。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-23T17:33:09.680

[OMake](http://omake.metaprl.org/index.html)是一个用于 C/C++、OCaml 和 LaTeX 的构建工具，具有自动依赖分析功能。它可以轻松地在多个目录上构建项目，并根据 MD5 总和而不是时间戳来查找更改。它还有一种可以在后台运行的模式，只要文件被修改，就可以构建您的项目。通常，与 make 相比，构建常见类型的项目（C/C++ 或 OCaml 程序和库）所需的代码更少。我还没有为更大的项目尝试过。

请注意，如果您想在 OCaml 中编程，此工具非常有用，因为 OCaml 链接器要求编译后的模块以依赖顺序出现在命令行中，并且每次发生更改时弄清楚此顺序并非易事。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-24T13:53:50.183

我在我的更多项目中使用了 CMake，包括移植一些基于自动工具的项目，我可以说它做得很好。它主要适用于 C/C++ 跨平台项目。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-23T20:59:54.287

我正在处理的项目继承了一些使用`Cons`而不是的代码`Make`（不要与`SCons`Greg Hewgill 的回答混淆）。

`Cons`是用 Perl 编写的，很像`SCons`用 Python 编写的。它自动管理依赖关系，您可以使用构建脚本中的任何 Perl 代码来处理复杂的构建序列。

主要缺点（也是我很抱歉我的项目使用它的主要原因）是`Cons`不会以`make -j`. 如果您要编译多个不依赖于彼此的文件，则一次`Cons`编译一个，而`make -j`并行编译它们，如果您的机器上有多个内核和线程，那就太好了。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-05-13T07:12:36.567

另一个用于跨平台构建的 make 是`kmake`（它的一部分`kbuild`，用它自己的话来说：*kBuild 是一个 makefile 框架，用于为复杂的任务编写简单的 makefile。*）。它是 GNU 的增强版本`make`。它是由 VirtualBox 开发的。他们使用它来构建适用于 Windows、Linux、MacOS 和 Solaris 的 VirtualBox 产品。相当便携！

有关详细信息，请参阅[http://svn.netlabs.org/kbuild](http://svn.netlabs.org/kbuild)。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-01-17T23:24:44.800

[WAF](https://code.google.com/p/waf/)是一个有趣的替代方案。用 python 编写，它允许你用普通的 Python 编写构建逻辑。并行构建 + 基于签名的半自动魔术依赖跟踪工作得相当好。它应该是跨平台的（即知道如何在 Windows 上进行构建），但我还没有尝试过。

它有一个相当陡峭的学习曲线，但它还附带[“The WAF book”](http://docs.waf.googlecode.com/git/book_17/single.html)来帮助这个过程。

# wpf - wpf 更新 ListViewItem 背景属性

> ID：389501
> 
> 赞同：1
> 
> 时间：2008-12-23T17:22:47.967
> 
> 标签：wpf, binding, colors, background, propertychanged

我有一个绑定到 ThreadSafeObservableCollection 的列表视图。这些项目中的每一个的背景都设置为一个通过颜色转换器运行的枚举，这是这两个设置的代码。

```
<UserControl.Resources>
    <EncoderView:EncoderStatusToColorConverter x:Key="ColorConverter"/>
    <Style x:Key="ItemContStyle" TargetType="{x:Type ListViewItem}">
        <Setter Property="Background" Value="{Binding Converter={StaticResource ColorConverter}}" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
    </Style>
</UserControl.Resources> 
```

我想要发生的是 listviewItem 的背景颜色将根据枚举值从 Red - Yellow - Green 变化。根据业务逻辑规则更新。这目前有效，但仅适用于项目的初始显示。当我更改 listItemView 绑定到的对象的“状态”属性时，背景不会更新。如果我从集合中删除对象，更改状态，然后再次将其添加到集合中，则背景会更新。
我已经尝试制作对象 IPropertyNotify，并在状态属性更改设置器上抛出事件，但这不起作用。

有谁知道我是否需要做一些特别的事情才能更新列表视图项目的背景。我也对如何解决这个问题的其他想法持开放态度，谢谢。这是 ListView 的 XAML。EncoderService.Encoders 是我的 Encoder 对象的 ThreadSafeObservableCollection。

```
 <ListView  AutomationProperties.AutomationId="FinishScreen"  
                   ItemsSource="{Binding Path=EncoderService.Encoders}" 
                   x:Name="DataListView" Grid.RowSpan="1" Grid.Row="1" Margin="5"
                   ItemContainerStyle="{StaticResource ItemContStyle}"
                   Background="Azure">
        <ListView.View>
            <GridView>
                <GridViewColumn Header="MAC">
                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <ContentControl Content="{Binding Path=MAC}" ToolTip="{Binding Path=MAC}"/>
                        </DataTemplate>
                    </GridViewColumn.CellTemplate>
                </GridViewColumn>
                <GridViewColumn Header="IDF">... 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-25T20:07:32.253

问题是 Binding to Background 占用了整个 Encoder 对象，除非您删除并添加它，否则它不会改变。即使 Encoder 实现了 INotifyPropertyChanged，Binding 仍然在查看整个 Encoder 对象，并且无法知道 Encoder 的哪些属性与您的 EncoderStatusToColorConverter 相关，因此它不会自行更新。

您的解决方案是将背景绑定的范围缩小到仅与 EncoderStatusToColorConverter 相关的属性（或属性）。绑定路径中的任何属性都将被监视更新。因此，例如，如果您只需要状态：

```
<Style x:Key="ItemContStyle" TargetType="{x:Type ListViewItem}">
    <Setter Property="Background" Value="{Binding Path=Status, Converter={StaticResource ColorConverter}}" />
    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
</Style> 
```

在这种情况下，如果您在 Encoder 上实现 INotifyPropertyChanged 并在 Status 更改时通知，则 Binding 应该为您更新。这也意味着您需要更新您的 EncoderStatusToColorConverter，使其仅采用 Status 类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T17:45:06.863

您是否尝试过使用 DataTemplateSelector？我用它来更改用于 ListBoxItem 的模板，这基本上只是根据属性更改前景色。我没有尝试过你正在做的场景，在页面加载后数据发生变化，但我不明白为什么它不起作用。

我有这堂课：

```
public class UniqueWordDataTemplateSelector : DataTemplateSelector
{
    public override DataTemplate SelectTemplate(object item, DependencyObject container)
    {
        if (item != null && item is WordScore)
        {
            WordScore word = item as WordScore;

            FrameworkElement elem = container as FrameworkElement;

            if (word.IsUnique)
                return
                    elem.FindResource("UniqueWordListTemplate") as DataTemplate;
            else
                return
                    elem.FindResource("WordListTemplate") as DataTemplate;
        }

        return null;
    }
} 
```

在我控制的资源中，我有这一行：

```
 <UserControl.Resources>
    ...
    <my:UniqueWordDataTemplateSelector x:Key="myDataTemplateSelector"/> 
```

我也有我的两个模板在这里：

```
 <DataTemplate x:Key="WordListTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="210" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="{Binding Path=Word}" Background="{x:Null}" Foreground="White"/>
            <TextBlock Text="{Binding Path=Score}" Background="{x:Null}" Foreground="White"/>
        </Grid>
    </DataTemplate>
    <DataTemplate x:Key="UniqueWordListTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="210" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="{Binding Path=Word}" Background="{x:Null}" Foreground="Gold"/>
            <TextBlock Text="{Binding Path=Score}" Background="{x:Null}" Foreground="White"/>
        </Grid>
    </DataTemplate> 
```

然后我将以下内容用于我的 ListBox：

```
 <ListBox x:Name="PlayerList2" ItemTemplateSelector="{DynamicResource myDataTemplateSelector}" IsSynchronizedWithCurrentItem="True" Background="#FF252525"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T18:06:23.277

我喜欢这种方法，并且我将尝试说服它，但我立即看到的唯一问题是我正在使用 GridView，因为我正在显示表格数据。我喜欢列标题。但我想我可以找到解决办法。我可能只是手动放入我自己的列标题。

ListItem 如何得到通知它应该更新它的数据模板？每次在其任何有界项上收到 PropertyChanged 事件时都会发生这种情况吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T20:34:53.057

我想我可能对必须实施 INotifyPropertyChanged 的​​内容感到困惑。

所以我有一个“编码器”对象的 ObservableCollection。ObservableCollection 显然是可观察的，当我从中添加和删除内容时，它会更新。但是每个“编码器”的属性都没有被更新。据我了解，这意味着“编码器”类必须实现 INotifyPropertyChanged，并在事件中发送属性的名称。这是正确的想法吗？因为目前它不起作用。在发布更多代码之前，我想确保我的理论是正确的。

谢谢

# asp.net - 为什么异步 ASHX 生成的图像在 IE6 中并不总是有效？

> ID：389503
> 
> 赞同：3
> 
> 时间：2008-12-23T17:23:08.950
> 
> 标签：asp.net, image, asynchronous, internet-explorer-6, ashx

如果你使用继承 IHttpAsyncHandler 的 WebHandler，你应该不会注意到在未确定的特定情况下浏览器 MS IE6 不会显示它，请求永远不会完成。有解决办法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T17:27:40.423

我会自己回答，但是当我第一次遇到这个问题时，我花了 3 天时间才解决它。

当通过“img”HTML 标记的“src”属性请求图像时，在某些情况下，浏览器 MS IE6 需要 Content-Length 来完成请求并显示结果。

同步 ASHX 生成的图像，自动包含“Content-Length”HTTP 标头，但异步版本不包含。所以当你写输出的时候，先把它写到一个内存流，读取总长度，把它写成一个HTTP头，然后把内存流写到输出。

像这样：

```
using (Image resizedImage = generateImage())
{
    using (MemoryStream memoryStream = new MemoryStream())
    {
        resizedImage.Save(memoryStream, ImageFormat.Jpeg);
        context.Response.AddHeader("Content-Length", memoryStream.Length.ToString());
        memoryStream.WriteTo(context.Response.OutputStream);
    }
} 
```

我已经 tcpdump 了我的代码的同步和异步版本，我注意到它们之间还有 2 个不同之处：

1) 异步处理程序将答案分成 3 个 TCP 数据包，而不是一个。

2）同步版本使用不同的“Keep-Alive”标头（我不记得是哪个）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T19:37:36.303

HTTP 规范概述了客户端应如何确定请求的长度（特别是在不使用 content-length 时）。IIRC，如果内容长度标头不存在，并且响应没有分块，则在连接关闭时检测到请求的结束（这可能表明保持活动行为发生变化的原因 - 你不能使用 keep -alive 如果连接生命周期用于指示请求长度）。不过，我希望 ASP.NET 能够自动处理这个问题。也许您缺少一些调用来告诉 ASP.NET 响应已完成。

似乎生成整个内容以便您可以在异步之前添加 content-length 标头首先破坏了使用异步 HttpHandler 的目的。

# .net - 捕获块未捕获异常

> ID：389504
> 
> 赞同：5
> 
> 时间：2008-12-23T17:23:38.793
> 
> 标签：.net, vb.net, visual-studio, visual-studio-2008, .net-3.5

我有一个在 Load 事件处理程序中抛出 ApplicationException 的子表单（故意用于测试目的）。父窗体将 ChildForm.Show() 方法包装在 Try...Catch ex As Exception 块中。catch 块只是显示一条消息并关闭子窗体。在 Visual Studio 2008 (.net 3.5 sp1) 中调试时，所有工作都按预期工作。但是，当我在 Visual Studio 之外运行它时，Catch 块似乎被遗漏了，并且发生了未处理的异常。知道为什么吗？

谢谢你。

示例代码：

```
Public Class Form1

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        Dim f2 As Form2

        f2 = New Form2

        Try
            MessageBox.Show("Opening form 2")
            f2.ShowDialog()
        Catch ex As Exception
            f2.Close()
            MessageBox.Show("Form 2 closed.")
        End Try
    End Sub

End Class

Public Class Form2

    Private Sub Form2_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        Throw New ApplicationException("Test Form_Load")
    End Sub

    Public Sub New()

        ' This call is required by the Windows Form Designer.
        InitializeComponent()

        ' Add any initialization after the InitializeComponent() call.
    End Sub

End Class 
```

堆栈跟踪：

```
System.ApplicationException：
 在 WindowsApplication1.Form2.Form2_Load 测试 Form_Load(Object sender, EventArgs e)
 在 UnhandledExceptionTest2\WindowsApplication1\Form2.vb
 System.Windows.Forms.Form.OnLoad(EventArgs e)
 System.Windows.Forms.Form.OnCreateControl()
 System.Windows.Forms.Control.CreateControl（布尔 fIgnoreVisible）
 System.Windows.Forms.Control.CreateControl()
 System.Windows.Forms.Control.WmShowWindow(Message& m) 在
 System.Windows.Forms.Control.WndProc(Message&> m) 在
 System.Windows.Forms.ScrollableControl.WndProc(Message&> m) 在
 System.Windows.Forms.ContainerControl.WndProc(Message&> m) 在
 System.Windows.Forms.Form.WmShowWindow(Message&> m) 在
 System.Windows.Forms.Form.WndProc(Message&> m) 在
 System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&> m) 在
 System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&> m) 在
 System.Windows.Forms.NativeWindow.Callback（IntPtr hWnd，Int32 msg，IntPtr wparam，IntPtr
 参数）

```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-23T19:22:07.150

Form.Load 事件的行为方式与 Windows 窗体中的大多数其他事件相同。它由消息循环调度，在这种情况下，当 Windows 发送 WM_SHOWWINDOW 消息时。消息循环中有一个异常处理程序，可防止未捕获的异常终止消息循环。该异常处理程序引发 Application.ThreadEvent 事件。默认事件处理程序显示未处理的异常对话框。

长话短说，您无法在按钮 Click 处理程序中捕获 Load 事件中引发的异常。除了在 Load 事件处理程序本身中捕获和处理异常之外，很难做到正确，我建议您在表单中添加一个公共方法。像 Initialize() 这样的东西。将代码从您的 Load 事件移到该方法中。在调用 Show() 方法后调用 Initialize()，现在你可以捕获异常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T17:43:01.313

我也有同样的问题。我最终所做的是捕获所有异常。在 C# 中：

```
Application.ThreadException += new ThreadExceptionEventHandler(MyHandler); 
```

然后显示表格。

我很想知道是否有人有更好的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T17:33:08.057

我为 C# 道歉（我不知道 Vb 语法）

你在做这样的事情吗：

```
 ChildForm child = new ChildForm();
  try {
      child.Show();
  }
  catch(Exception ex)
  {.....} 
```

如果是这样，我相信 Load 事件会发生在 New 上，而不是 Show(); （节目会触发激活）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T17:41:14.483

新窗口有自己的线程，它自己加载。为了验证这一点，您可以尝试在`Thread.Sleep`异常之前将 a 放入 Form2_Load 几秒钟。在您遇到异常之前，您的主线程窗口应该继续执行。

# apache-flex - 为什么我的 flex 图像控件不显示我的图像？

> ID：389506
> 
> 赞同：0
> 
> 时间：2008-12-23T17:23:40.977
> 
> 标签：apache-flex, image, httphandler

我创建了一个 ashx 处理程序，它将图像返回到我的 flex 应用程序。例如，如果我直接访问 url (www.mysite.com/handler.ashx?id=34)，浏览器将显示图像。如果将 flex 中的图像控件的源设置为相同的地址。我收到“错误 #2124：加载的文件是未知类型。”。任何提示

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T23:11:24.753

您可以检查一些可能会有所帮助的事项：

1.  安全性：“您可以使用 URL 引用图像，但默认安全设置仅允许 Flex 应用程序访问与您的应用程序存储在同一域中的资源。要访问其他服务器上的图像，您必须使用 crossdomain.xml 文件。 "

2.  您可以加载或嵌入其他图像吗？

查看此文档以查看您在加载图像时是否遗漏了什么：http: [//livedocs.adobe.com/flex/3/html/help.html ?content=security2_04.html](http://livedocs.adobe.com/flex/3/html/help.html?content=security2_04.html)

这是一个可以帮助解决图像 httpstatus 问题的链接：http: [//blog.flexexamples.com/2007/11/04/detecting-whether-an-image-loaded-successfully-in-flex/](http://blog.flexexamples.com/2007/11/04/detecting-whether-an-image-loaded-successfully-in-flex/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T19:42:16.640

确保带有图像的响应标头中返回的 MIME 类型正确。如果您的响应标头说它包含“text/html”而不是“image/png”之类的内容，Flash Player 可能会感到困惑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T18:21:01.297

Flash 播放器有错误。

[http://bugs.adobe.com/jira/browse/FP-42](http://bugs.adobe.com/jira/browse/FP-42)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-14T21:29:55.237

确保提供的图像不是位图。浏览器可以处理声称是 PNG/JPEG Flash 不能处理的位图。

# ssis - 通过 OleDb ACE 访问 Excel 2007 二进制文件 (.xlsb)

> ID：389520
> 
> 赞同：8
> 
> 时间：2008-12-23T17:27:05.777
> 
> 标签：ssis, oledb, excel-2007

我发现 Excel 2007 二进制格式（扩展名为 .xlsb）非常适合我的需要，因为它加载速度快且非常紧凑。我在 Excel 中提供了一堆带有大量数据的报告，这些报告实际上是通过 IS 包加载的。

所以我假设转换为这种格式，阅读 Access Ole DB Provider 12 上的文档，其中写到 xlsb 受此提供程序支持。我在 Excel 中转换了文件，然后在尝试在包中更改它们时（只需通过添加“b”后缀来更改文件的路径），我收到以下错误消息：

```
"Test connection failed because of an error in initializing provider. This 
file was created in a previous beta version of Excel 2007\.  Open the file 
with Excel 2007 to save it to the most recent version of the Excel 2007 file 
format before opening the file in Access 2007." 
```

好吧，我想可能是文件转换的问题，所以我拿起一个全新的并填写了一些信息。再试一次，同样的错误！！

然后我尝试了使用“.udl”文件的方法，同样的错误！然后我尝试在不同的机器上进行测试： - 我自己的 (Windows Vista SP1) - 我的同事 (Windows XP SP2) - IS Server (Windows Server 2003 x64 SP2)

并且错误仍然存​​在。我发现重现该错误非常容易，以至于我通过谷歌搜索没有找到任何关于它的信息，这让我有点惊讶！

有人可以帮助我吗？

提前致谢， 拉斐尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2015-09-27T10:02:42.737

我知道这是旧帖子。几天前我遇到了这个问题，经过很多努力，我能够解决它。希望它可以帮助某人。

就我而言，我有同样的错误：

> 此文件是在 Excel 2007 的早期测试版中创建的。在 Access 2007 中打开文件之前，使用 Excel 2007 打开文件以将其保存为最新版本的 Excel 2007 文件格式。

当我试图打开我的 OldDB 连接时会发生这种情况。我怀疑这是由于我的连接字符串语法或值问题，但经过大量更改后没有任何效果。

我在我的机器上安装了以下内容：

1) Microsoft Access 数据库引擎 2010 版本 14.0.7015 (从[这里](http://www.microsoft.com/en-us/download/details.aspx?id=13255)获取)

2) Microsoft Office Access 数据库引擎 2007 版本 12.0.4581 (从[这里](http://www.microsoft.com/en-us/download/details.aspx?id=23734)获取)

这是导致错误发生的连接字符串：

```
"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=C:\Project\Excel1.xlsb;Extended Properties='Excel 12.0;HDR={1}'" 
```

**然后我发现这个解决了我的挣扎：**

[Microsoft Office Access 运行时和数据连接 2007 Service Pack 2 (SP2)](http://www.microsoft.com/en-au/download/details.aspx?id=7020)。

我只需要下载、运行它并重新启动我的机器。然后瞧，我可以打开我的 OleDB 连接而不会出现该错误。

希望这会有所帮助。

# jquery - 如何从 HTML 中获取 ul 结构

> ID：389528
> 
> 赞同：5
> 
> 时间：2008-12-23T17:29:39.450
> 
> 标签：jquery, html, jsp, struts2

我正在制作一个配置页面，它将类别树拆分为 3 列以便于浏览，例如：

```
**Column 1**            **Column 2**             **Column3**  
   Category1               Category3                Category5
    *SubCategory1*         Category4                  *SubCategory5*
   Category2                 *SubCategory4*           *SubCategory6*
     *SubCategory2*        etc.
     *SubCategory3* 
```

我正在使用 jsp、jquery 和 struts2。我要做的是配置显示类别/子类别的顺序。现在我展示了这样的结构，我可以将它们从一列拖到另一列，对列的类别进行排序并对子类别进行排序，使用 jquery 并直接修改 HTML，但我不知道如何获取修改结构的数据以将其保存在我的数据库中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T17:50:47.927

我最近不得不在我的个人项目上做类似的事情，但从未真正使用过我正在编写的功能，但这是我使用的代码：

```
function refactor() {
    var array = jQuery.makeArray($('ul#remapped > li:not(.target)'));
    var mappedArray = jQuery.map(array, function(i) {
        var merged = $(i).find('ul.merge > li:not(.target) > span');
        return {
            column: $(i).children('span').text(),
            merged: jQuery.map(jQuery.makeArray(merged), function(mi) { return { column: mi.innerText }; })
        };
    });

    var xml = '<columns>';
    jQuery.each(mappedArray, function(index, item) {
        xml += '\n\t<column>';
        xml += '\n\t\t<name>' + item.column + '</name>';
        if (item.merged.length > 0) {
            xml += '\n\t\t\t<merged>';
            jQuery.each(item.merged, function(mindex, mitem) {
                xml += '\n\t\t\t\t<name>' + mitem.column + '</name>';
            });
            xml += '\n\t\t\t</merged>';
        }
        xml += '\n\t</column>';
    });
    xml += '\n</columns>';

    $('div#result').load('/Tools/Csv/Refactor', { mapping: xml });
} 
```

基本上，用户会使用 UI 随意拖放来创建他们想要的结构。然后，他们单击执行此方法的按钮。

$('ul#remapped') 查询是包含新结构的元素（在我的代码中），然后我再次根据我的 DOM 结构进行了一些额外的查询，以从 DOM 中提取我需要的值并生成一个 XML 字符串，然后将其发布到服务器。

我确定这不是*您*所需要的，但我希望它足够接近，您可以根据需要对其进行修改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T17:40:23.237

我假设结构通过拖放进行了修改。您可以在每次结构发生更改时进行 ajax 调用，并更新您拥有的 CategorySucategories 表中的数据。我不知道你的数据库结构，所以我也做了一个假设。

# sql - 在 Oracle 中比较字符串

> ID：389535
> 
> 赞同：2
> 
> 时间：2008-12-23T17:32:11.663
> 
> 标签：sql, oracle, comparison

我需要在给定字符串的表中查询值。该表区分大小写，但我想在比较中执行 ToLower()。

假设我有一个包含以下数据的类表。

```
class    teacher
-----------------
Mat101   Smith
MAT101   Jones
mat101   Abram
ENG102   Smith 
```

我的查询应该类似于

```
Select teacher From classes where lower(class) = 'math101' 
```

这是进行比较的最佳方法吗？

## 更新

我无法控制数据库或数据。我是只读消费者。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T17:56:18.430

以下是有关基于函数的索引的更多信息（上面 Dave 所指的内容）：

*   [使用基于函数的索引来提高性能](http://download.oracle.com/docs/cd/B28359_01/server.111/b28274/data_acc.htm#i9946)
*   [基于函数的索引](http://download.oracle.com/docs/cd/B28359_01/server.111/b28318/schema.htm#CNCPT1161)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T19:02:57.453

此方法要求您运行 10gr2 或更高版本。

更改会话之前：

```
SQL> WITH LETTERS AS
  2  (SELECT 'a' LETTER FROM DUAL UNION ALL
  3   SELECT 'b' LETTER FROM DUAL UNION ALL
  4   SELECT 'A' LETTER FROM DUAL UNION ALL
  5   SELECT 'B' LETTER FROM DUAL) 
  6  SELECT LETTER FROM LETTERS 
  7  WHERE LETTER = 'A';

L
-
A

SQL> 
```

如果您能够更改会话，则可以执行以下操作：

```
SQL> ALTER SESSION SET NLS_SORT=BINARY_CI;

Session altered.

SQL> ALTER SESSION SET NLS_COMP=LINGUISTIC;

Session altered.

SQL> WITH LETTERS AS
  2  (SELECT 'a' LETTER FROM DUAL UNION ALL
  3   SELECT 'b' LETTER FROM DUAL UNION ALL
  4   SELECT 'A' LETTER FROM DUAL UNION ALL
  5   SELECT 'B' LETTER FROM DUAL) 
  6  SELECT LETTER FROM LETTERS 
  7  WHERE LETTER = 'A';

L
-
a
A 
```

如上所述更改会话会导致数据库对相同字母的大写和小写版本作为等效对象进行排序和比较。更多信息，请参见[http://www.orafaq.com/node/91](http://www.orafaq.com/node/91)

HTH，加布

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T18:19:01.347

由于您添加了您是数据库的只读用户，因此**最好**的方法接近您开始使用的方法：

```
Select teacher From classes where lower(class) = LOWER('math101') 
```

请注意，我在输入参数中添加了 LOWER()，只是为了确保它也是小写的。有些人可能称之为“腰带和吊带”（又名redudant）；我称之为良好的防御性编程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T17:40:46.480

您正在谈论的那种查询的缺点是它不能在类上使用索引（作为索引查找，也就是说 - 它仍然可以用于索引的快速完整扫描）。

但是，在现代版本的 Oracle 中，您可以在 LOWER(class) 上创建一个索引，然后该查询可以使用该索引。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T18:15:06.973

不; 改进数据会更好：创建一个数字 ID 来表示这些看似无意义的类变体（可能还有一个关联的查找表来获取 ID）。在 where 子句中使用 ID 列，您应该会点击索引数字列。

如果这不是一个选项，请考虑在 lower(class) 上使用基于函数的索引。

如果这不是一个选项，并且“最佳”问题与性能严格相关，请考虑非规范化并添加一个包含 lower(class) 的列，可能填充有触发器。

如果这不是一个选项，请更新数据，使其全部为小写（并采取措施仅插入/更新小写类数据）。

如果你不能像那样更新数据，那么答案是“也许”。

在任何情况下，如果您没有测试列的索引，您就不能称之为最佳。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T21:51:57.487

如果变体（Mat101、MAT101、mat101）引用相同的东西，它们应该具有相同的标识符。

根据数据量、更新频率、查询等，您可以考虑将数据复制到您通过复制中内置的清理/标准化阶段控制的数据库中。

当您说“我无法控制数据库”时，如果您可以查询，您将对数据库产生影响。有人控制了数据库，可能值得通过电子邮件/电话说，如果他们向该列添加 lower() 索引，那么它将减少您的查询对数据库的影响。

最后，如果变体足够简单，那么您可以尝试

```
Select teacher From classes where class in (lower('mat101'), upper('mat101'), initcap('mat1010')). 
```

# postgresql - 在 Postgresql 中选择未锁定的行

> ID：389541
> 
> 赞同：47
> 
> 时间：2008-12-23T17:34:33.793
> 
> 标签：postgresql, locking

有没有办法在 Postgresql 中选择未锁定的行？我有一个多线程应用程序可以执行以下操作：

```
Select... order by id desc limit 1 for update 
```

在一张桌子上。

如果多个线程运行此查询，它们都会尝试拉回同一行。

一个获得行锁，另一个阻塞，然后在第一个更新行后失败。我真正想要的是让第二个线程获得与`WHERE`子句匹配且尚未锁定的第一行。

为了澄清，我希望每个线程在选择后立即更新第一个可用行。

因此，如果有带有 的行`ID: 1,2,3,4`，第一个线程会进来，选择带有 的行`ID=4`并立即更新它。

如果在该事务期间出现第二个线程，我希望它获取行`ID=3`并立即更新该行。

For Share 不会完成此操作，`nowait`因为`WHERE`子句将与锁定的行匹配`(ID=4 in my example)`。基本上我想要的是`WHERE`子句中的“AND NOT LOCKED”之类的东西。

```
Users

-----------------------------------------
ID        | Name       |      flags
-----------------------------------------
1         |  bob       |        0
2         |  fred      |        1
3         |  tom       |        0
4         |  ed        |        0 
```

如果查询是“ `Select ID from users where flags = 0 order by ID desc limit 1`”并且当返回一行时，下一个是“ `Update Users set flags = 1 where ID = 0`”，那么我希望第一个线程用 来抓取行，`ID 4`下一个线程用 来抓取行`ID 3`。

如果我将“”附加`For Update`到选择，那么第一个线程获取该行，第二个线程阻塞然后什么都不返回，因为一旦第一个事务提交，该`WHERE`子句就不再满足。

如果我不使用“ `For Update`”，那么我需要在后续更新中添加一个 WHERE 子句（WHERE flags = 0），这样只有一个线程可以更新该行。

第二个线程将选择与第一个线程相同的行，但第二个线程的更新将失败。

无论哪种方式，第二个线程都无法获取行并更新，因为我无法让数据库将第 4 行提供给第一个线程，将第 3 行提供给第二个线程，事务重叠。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2014-10-10T23:19:18.360

此功能`SELECT ... SKIP LOCKED`正在 Postgres 9.5 中实现。[http://www.depesz.com/2014/10/10/waiting-for-9-5-implement-skip-locked-for-row-level-locks/](http://www.depesz.com/2014/10/10/waiting-for-9-5-implement-skip-locked-for-row-level-locks/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-07-14T02:52:32.287

不不不 :-)

我知道作者的意思。我有类似的情况，我想出了一个很好的解决方案。首先，我将从描述我的情况开始。我有一个表我存储必须在特定时间发送的消息。PG 不支持函数的定时执行，所以我们必须使用守护进程（或 cron）。我使用一个自定义编写的脚本来打开几个并行进程。每个进程选择一组必须以 +1 秒 / -1 秒的精度发送的消息。表本身会使用新消息动态更新。

所以每个进程都需要下载一组行。这组行不能被其他进程下载，因为它会造成很多混乱（有些人会收到几条消息，而他们应该只收到一条消息）。这就是我们需要锁定行的原因。使用锁下载一组消息的查询：

```
FOR messages in select * from public.messages where sendTime >= CURRENT_TIMESTAMP - '1 SECOND'::INTERVAL AND sendTime <= CURRENT_TIMESTAMP + '1 SECOND'::INTERVAL AND sent is FALSE FOR UPDATE LOOP
-- DO SMTH
END LOOP; 
```

每 0.5 秒启动一个带有此查询的进程。所以这将导致下一个查询等待第一个锁来解锁行。这种方法会造成巨大的延迟。即使我们使用NOWAIT，查询也会导致我们不想要的异常，因为表中可能有必须发送的新消息。如果仅使用 FOR SHARE 查询将正确执行，但仍将花费大量时间造成巨大的延迟。

为了让它工作，我们做了一个小魔术：

1.  更改查询：

    ```
    FOR messages in select * from public.messages where sendTime >= CURRENT_TIMESTAMP - '1 SECOND'::INTERVAL AND sendTime <= CURRENT_TIMESTAMP + '1 SECOND'::INTERVAL AND sent is FALSE AND is_locked(msg_id) IS FALSE FOR SHARE LOOP
    -- DO SMTH
    END LOOP; 
    ```

2.  神秘的函数“is_locked(msg_id)”如下所示：

    ```
    CREATE OR REPLACE FUNCTION is_locked(integer) RETURNS BOOLEAN AS $$
    DECLARE
        id integer;
        checkout_id integer;
        is_it boolean;
    BEGIN
        checkout_id := $1;
        is_it := FALSE;

        BEGIN
            -- we use FOR UPDATE to attempt a lock and NOWAIT to get the error immediately 
            id := msg_id FROM public.messages WHERE msg_id = checkout_id FOR UPDATE NOWAIT;
            EXCEPTION
                WHEN lock_not_available THEN
                    is_it := TRUE;
        END;

        RETURN is_it;

    END;
    $$ LANGUAGE 'plpgsql' VOLATILE COST 100; 
    ```

当然，我们可以自定义此功能以处理您数据库中的任何表。在我看来，最好为一张表创建一个检查功能。向此函数添加更多内容只会使其变慢。无论如何，我需要更长的时间来检查这个条款，所以没有必要让它变得更慢。对我来说，这是完整的解决方案，而且效果很好。

现在，当我让我的 50 个进程并行运行时，每个进程都有一组独特的新消息要发送。发送后，我只需使用 sent = TRUE 更新该行，并且永远不会再返回它。

我希望这个解决方案也适用于你（作者）。如果您有任何问题，请告诉我:-)

哦，让我知道这是否也对你有用。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-12-25T14:02:01.967

我使用这样的东西：

```
select  *
into l_sms
from sms
where prefix_id = l_prefix_id
    and invoice_id is null
    and pg_try_advisory_lock(sms_id)
order by suffix
limit 1; 
```

并且不要忘记调用 pg_advisory_unlock

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-12-25T18:28:49.467

如果您正在尝试实现队列，请查看 PGQ，它已经解决了这个问题和其他问题。[http://wiki.postgresql.org/wiki/PGQ_Tutorial](http://wiki.postgresql.org/wiki/PGQ_Tutorial)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T16:17:57.657

看来您正在尝试执行诸如获取队列中尚未被另一个进程处理的最高优先级项之类的操作。

一个可能的解决方案是添加一个 where 子句，将其限制为未处理的请求：

```
select * from queue where flag=0 order by id desc for update;
update queue set flag=1 where id=:id;
--if you really want the lock:
select * from queue where id=:id for update;
... 
```

希望第二个事务会在标志更新发生时阻塞，然后它将能够继续，但标志会将其限制为下一个。

也有可能使用可序列化的隔离级别，您可以获得您想要的结果，而无需所有这些疯狂。

根据应用程序的性质，可能有比在数据库中更好的实现方式，例如 FIFO 或 LIFO 管道。此外，可能会颠倒您需要它们的顺序，并使用顺序来确保按顺序处理它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-23T17:56:01.693

这可以通过 SELECT ...NOWAIT; 来完成。一个例子是[here](http://blog.endpoint.com/2008/12/parallel-inventory-access-using.html)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-11T04:24:21.683

我的解决方案是使用带有 RETURNING 子句的 UPDATE 语句。

```
Users

-----------------------------------
ID        | Name       |      flags
-----------------------------------
1         |  bob       |        0  
2         |  fred      |        1  
3         |  tom       |        0   
4         |  ed        |        0 
```

而不是`SELECT .. FOR UPDATE`使用

```
BEGIN; 

UPDATE "Users"
SET ...
WHERE ...;
RETURNING ( column list );

COMMIT; 
```

因为 UPDATE 语句在表上获得了 ROW EXCLUSIVE 锁，所以它的更新是序列化的更新。仍然允许读取，但它们只能在 UPDATE 事务开始之前看到数据。

参考： Pg 文档的[并发控制](http://www.postgresql.org/docs/9.0/interactive/explicit-locking.html)章节。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T17:50:19.300

看起来您正在寻找 SELECT FOR SHARE。

[http://www.postgresql.org/docs/8.3/interactive/sql-select.html#SQL-FOR-UPDATE-SHARE](http://www.postgresql.org/docs/8.3/interactive/sql-select.html#SQL-FOR-UPDATE-SHARE)

FOR SHARE 的行为类似，除了它在每个检索到的行上获取共享锁而不是排他锁。共享锁阻止其他事务对这些行执行 UPDATE、DELETE 或 SELECT FOR UPDATE，但不会阻止它们执行 SELECT FOR SHARE。

如果在 FOR UPDATE 或 FOR SHARE 中命名了特定的表，那么只有来自这些表的行被锁定；SELECT 中使用的任何其他表都照常读取。没有表列表的 FOR UPDATE 或 FOR SHARE 子句会影响命令中使用的所有表。如果将 FOR UPDATE 或 FOR SHARE 应用于视图或子查询，它会影响视图或子查询中使用的所有表。

如果需要为不同的表指定不同的锁定行为，可以编写多个 FOR UPDATE 和 FOR SHARE 子句。如果 FOR UPDATE 和 FOR SHARE 子句都提到（或隐式影响）同一个表，则将其作为 FOR UPDATE 处理。类似地，如果在影响它的任何子句中指定了表，则将其作为 NOWAIT 处理。

FOR UPDATE 和 FOR SHARE 不能用在返回的行不能用单个表行清楚地标识的上下文中；例如，它们不能与聚合一起使用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-23T18:00:40.950

你想达到什么目的？你能更好地解释为什么解锁的行更新和完整的事务都不会做你想要的吗？

更好的是，您能否防止争用并让每个线程使用不同的偏移量？如果表的相关部分经常更新，这将无法正常工作；您仍然会发生碰撞，但仅在插入负载较重的情况下。

```
Select... order by id desc offset THREAD_NUMBER limit 1 for update 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-23T20:02:25.213

由于我还没有找到更好的答案，我决定在我的应用程序中使用锁定来同步对执行此查询的代码的访问。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-24T20:41:19.967

我在我们的应用程序中遇到了同样的问题，并提出了一个与 Grant Johnson 的方法非常相似的解决方案。FIFO 或 LIFO 管道不是一个选项，因为我们有一组应用程序服务器访问一个数据库。我们所做的是一个

```
SELECT ... WHERE FLAG=0 ... FOR UPDATE
```

紧随其后的是

```
UPDATE ... SET FLAG=1 WHERE ID=:id
```

尽快，以使锁定时间尽可能短。根据表列数和大小，仅在第一次选择中获取 ID 并标记行以获取剩余数据后，这可能会有所帮助。存储过程可以进一步减少往返次数。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-24T17:48:46.637

下面的呢？它**可能**比其他示例更原子地处理，但仍应**进行**测试以确保我的假设没有错。

```
UPDATE users SET flags = 1 WHERE id = ( SELECT id FROM users WHERE flags = 0 ORDER BY id DESC LIMIT 1 ) RETURNING ...; 
```

您可能仍然会被 postgres 内部使用的任何锁定方案所困，以在面对同时更新时提供一致的 SELECT 结果。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-12-07T12:40:33.897

^^ 那行得通。考虑具有“锁定”的“立即”状态。

假设你的桌子是这样的：

## 编号 | 姓名 | 姓氏 | 地位

例如，可能的状态是：1=待处理、2=锁定、3=已处理、4=失败、5=拒绝

每条新记录都以待处理状态插入（1）

您的程序会：“更新 mytable set status = 2 where id = (select id from mytable where name like '%John%' and status = 1 limit 1) returns id, name, surname”

然后你的程序做它的事情，如果它得出这个线程根本不应该处理该行的结论，它会：“update mytable set status = 1 where id = ?”

除此之外，它会更新到其他状态。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-11-17T07:21:52.323

在多线程和集群中使用？
这个怎么样？

```
START TRANSACTION;

// All thread retrive same task list
// If result count is very big, using cursor 
//    or callback interface provied by ORM frameworks.
var ids = SELECT id FROM tableName WHERE k1=v1;

// Each thread get an unlocked recored to process.
for ( id in ids ) {
   var rec = SELECT ... FROM tableName WHERE id =#id# FOR UPDATE NOWAIT;
   if ( rec != null ) {
    ... // do something
   }
}

COMMIT; 
```

# .net - 如何在 .NET 中将字符串数组转换为 LPCWSTR 以传递给 Win32 API 函数？

> ID：389543
> 
> 赞同：2
> 
> 时间：2008-12-23T17:34:52.687
> 
> 标签：.net, winapi, pinvoke, marshalling

我有一段 C# 代码需要将字符串数组转换为 LPCWSTR 以传递给 Win32 API 函数。我在 Marshal 类中找不到任何让它简单明了的东西。有人知道该怎么做吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T18:14:42.153

您应该将 API 函数声明为采用字符串数组。由于它被声明为常量，因此您应该添加一个`In`属性，以便在调用后不会将其编组回来。如果该函数确实只有您指定的 unicode 版本（即它需要`LPCWSTR`而不是`LPCTSTR`），那么您应该使用`CharSet=Unicode`. 如同：

```
[DllImport("kernel32.dll", CharSet=Unicode)]
static extern bool Foo([In] string[] stuff); 
```

您要调用什么 API 函数？如果你发布它，我可以给你一个很好的 P/Invoke 签名。或者您可以查看[pinvoke.net](http://pinvoke.net/)，它有一个相当不错的 P/Invoke 签名预编译列表（社区生成）。

# design-patterns - 谁能解释策略模式与控制反转的关系？

> ID：389548
> 
> 赞同：4
> 
> 时间：2008-12-23T17:38:47.560
> 
> 标签：design-patterns, inversion-of-control, strategy-pattern

谁能准确解释策略模式与控制反转的关系？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T17:46:46.530

当您使用策略模式时，您希望其他类依赖于接口而不是具体策略。一种方法是将具体策略注入到使用它作为接口的类中，而不是让类了解如何创建适当的策略。这就是 IoC/依赖注入的用武之地。

这个想法是你有某种配置或决策类来定义要使用的策略。这可能是一个 IoC 框架，但不一定非得如此。此类负责根据系统状态或配置使用适当的策略配置您的其他类。具体策略是通过构造函数或属性设置器创建和注入的，因此对实例化哪个策略类的“控制”是“反转的”——它不是由依赖它的类完成，而是由外部完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T17:57:24.293

就其本身而言，该模式不会引入控制反转。如果该模式的开发者实现它以便将可交换算法注入到控制器中，那么这就是反转。另一方面，如果实现者从其他来源（例如配置，或通过其他方式在控制器的构造函数中确定它）获取要使用的算法，那么它只是您的普通类型的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-19T04:56:15.737

没有 IOC 是完全不同的事情，您可以在此处阅读有关 IOC 和 DI 的更多信息，了解实际想法

[http://www.codeproject.com/KB/aspnet/IOCDI.aspx](http://www.codeproject.com/KB/aspnet/IOCDI.aspx)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2011-05-12T06:19:48.153

IOC 可以被认为是可以使用策略模式（手段）实现的主体（目的），因为服务定位器模式将是另一种选择。

# c# - Application.Run 抛出 ArgumentException 未处理

> ID：389551
> 
> 赞同：1
> 
> 时间：2008-12-23T17:39:16.420
> 
> 标签：c#, winforms, dispose, argumentexception

我有一个需要关闭应用程序的情况，所以我在设置一个 certian 标志时调用 this.Dispose ()。

起初我以为是调用 this.Dispose() 后调用函数的问题，所以我将代码移动到最后调用的东西，但我仍然得到“ArgumentException was unhandled”“Parameter is not valid”。在 Application.Run(new myApp(); 行。

我究竟做错了什么？一路上我错过了什么吗？或者也许有更好的方法来关闭应用程序？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T17:42:24.777

尝试使用`Application.Exit()`退出应用程序。

使用时`Application.Run(new MyForm());`，会在线程上创建一个消息循环，使用表单对象作为主表单。它尝试将到达应用程序的 Win32 消息传递给它们各自的对象。但是，当您调用`Dispose()`表单对象时，您还没有退出消息循环。当它尝试将下一条消息传递给您的表单对象时，它会失败，因为它已经被释放并抛出异常。您应该请求关闭表单（通过调用`Close`表单），然后请求表单处理事件，如果完成，然后退出消息循环。另一种方式（更直接的方式）是通过调用完全关闭线程上的消息循环，`Application.Exit()`这将导致所有相关表单关闭。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T18:51:43.700

您应该使用 this.Close() 而不是 this.Dispose() 来关闭您的主窗体。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T17:42:05.323

如果您正在关闭应用程序并因此卸载 AppDomain，您实际上不需要调用 Dispose()，因为 AppDomain 中的所有内容都将从内存中删除。

# c# - 您可以从 ObjectDataSource 中获取 DataTable 吗？

> ID：389571
> 
> 赞同：2
> 
> 时间：2008-12-23T17:45:53.710
> 
> 标签：c#, asp.net, datatable, objectdatasource

如果我在设计时定义了一个 ObjectDataSource，我可以在运行时从该 ObjectDataSource 获取一个 DataTable 吗？我有一个返回 DataTable 的方法，该方法用于 ObjectDataSource 的 Select 方法属性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T17:52:51.307

我不太明白您的问题...您是在问您在 ObjectDataSource 中定义的对象是否可以在配置的 select 方法中返回 DataTable ？是的，我一直这样做。您还可以检查 OnSelected 事件中返回的 DataTable（它是事件对象的 ReturnValue 属性）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T18:02:10.760

是的，但是您需要注意该项目的绑定时间。

如果您在谈论网页：

如果您在页面加载之前尝试访问 DataSource（在您的情况下为 DataTable），它将为空。

如果您在绑定后尝试访问它，您将能够使用该对象。

# language-agnostic - 如何处理异常

> ID：389575
> 
> 赞同：2
> 
> 时间：2008-12-23T17:48:18.540
> 
> 标签：language-agnostic, exception, exception-handling

我的技术负责人坚持这种异常机制：

```
try
{
    DoSth();
}
catch (OurException)
{
    throw;
}
catch (Exception ex)
{
    Util.Log(ex.Message, "1242"); // 1242 is unique to this catch block
    throw new OurException(ex);
} 
```

这里的 1242 是我们处理 OurException 以外的异常的 catch 方法的标识符。项目中的每个 catch 块都必须有一个唯一的标识符，这样我们就可以通过查看日志来知道异常发生在哪里。

对于每个方法，我们都必须捕获 OurException 并抛出它。如果抛出了其他类型的异常，我们必须在重新抛出它之前记录它并用 OurException 屏蔽它。

这是一个合理的方法吗？如果有的话，有什么更好的选择？

**编辑：**我被告知堆栈跟踪在发布模式下不会产生有意义的结果。您是否建议捕获和抛出通用异常可以？

**编辑2：**谢谢大家。我用你的回答作为我反对这个论点的一部分，但我被告知你没有足够的经验，不知道如何处理现实生活中的情况。我必须走这条路。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T17:59:30.327

您还可以查看[异常处理应用程序块。](http://msdn.microsoft.com/en-us/library/cc309505.aspx)

我在一些项目中使用过它，它非常有用。特别是如果您想稍后更改异常处理的工作方式以及要捕获的信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T17:57:33.483

我认为使用堆栈跟踪会比任何标识符更直观。

至于自定义异常，为什么不这样做呢？

```
try
{
DoSth();
}
catch(Exception ex)
{
Util.Log(ex.Message, ex.StackTrace);
if(ex is OurException) throw ex;
else throw new OurException(ex); // use the original exception as the InnerException
} 
```

另外，我不确定您为什么要在处理完异常后重新抛出异常-您能解释一下背后的原因吗？

@Ali A - 一个非常有效的观点，所以请允许我重新措辞 - 为什么要重新抛出异常而不是在这里完成对它的处理？

**编辑：**

与其重新抛出，为什么不这样做呢？

```
try
{
DoSth();
}
catch(Exception ex)
{
Util.HandleException(ex);
} 
```

Util.HandleException：

```
public static void HandleException(ex)
{
Util.Log(ex); // Util.Log should log the message and stack trace of the passed exception as well as any InnerExceptions - remember, than can be several nested InnerExceptions.

// Any additional handling logic, such as exiting the application, or showing the user an error message (or redirecting in a web app)
} 
```

这样，您就知道每个异常只记录一次，并且您不会将它们放回野外以造成任何额外的破坏。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T18:12:30.300

拥有`OurException`它有点奇怪。通常，您希望有专门的 catch 块，然后是最后一个，即捕获泛型的那个`Exception`是您进行日志记录的地方：

```
try 
{
    DoSomething();
}
catch (DivideByZeroException)
{
    // handle it here, maybe rethrow it, whatever
}
// more catch blocks
catch (Exception)
{
    // oops, this is unexpected, so lets log it
} 
```

但你的所作所为会奏效。我确实相信`1242`应该去。这是一种打印方法、文件名和行号的方法，您可以使用它来代替。我自己没有尝试过，但看起来不错：

```
 [Conditional("DEBUG")]
    public static void DebugPrintTrace()
    {
        StackTrace st = new StackTrace(true);
        StackFrame sf = st.GetFrame(1); // this gets the caller's frame, not this one
        Console.WriteLine("Trace "
            + sf.GetMethod().Name + " "
            + sf.GetFileName() + ":"
            + sf.GetFileLineNumber() + "\n");
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T18:03:55.047

我有两种类型的异常：可修复异常和致命异常。如果某个对象抛出可修复的异常，这意味着发生错误但对象没有损坏，可以重新使用。如果某个对象抛出致命异常，这意味着对象状态已损坏，任何使用对象的尝试都会导致新的错误。

**更新：**可能会尽快处理所有异常，并尽可能靠近错误源。例如，如果存储在集合中的对象抛出致命异常，异常处理程序只是从集合中删除该对象并将其删除，而不是整个对象集合。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-24T14:58:47.167

据我了解，异常的目的是传播意外错误。如果您将它捕获到与抛出它的方法足够接近，那么您将更多地了解如何处理它。

您的示例是捕获意外错误，然后将其重新抛出链。这不是处理异常，而是将其包装到您自己的中。

但是您的包装似乎并没有为异常增加任何价值，甚至可能使事情变得混乱。

一个极端的例子：

```
void a() {
  try {
    c();
  } catch(MyException1 ex) {
    throw;
  } catch(Exception ex) {
    log(ex);
    throw new MyException1(ex);
  }
}

void b() {
  try {
    a();
  } catch(MyException2 ex) {
    throw;
  } catch(Exception ex) {
    log(ex);
    throw new MyException2(ex);
  }
} 
```

请注意，在前面的示例中，原始异常被记录了两次。它包含在两个例外中。当您多次记录相同的异常时，跟踪变得更加困难（因为日志文件变得相当大）。

当然这可能是一个极端的例子，但我很难相信你的整个应用程序只使用了一种类型的异常。它没有充分描述可能发生的所有不同类型的错误。

我个人更喜欢只在我处理它的 catch 块中记录异常。其他任何地方都可能会创建重复的日志记录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T17:56:32.050

我认为在 throw 线上有一个硬编码的数字不是一个好习惯，你怎么知道这个数字是否被使用？或者，下一个要抛出的错误号是哪个？也许您至少可以在枚举中列出...不确定。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T17:57:20.143

除了那个奇怪的数字外，一切看起来都正确。

堆栈跟踪将包含您需要的信息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T18:00:25.193

记录堆栈跟踪会比硬编码的数字好得多。这个数字没有告诉你什么程序叫这个程序。

此外，这个数字管理起来很麻烦，而且很容易出错。

编辑：的确，stacktrace 在发布模式下并不*总是*产生有意义的结果，但我认为这个硬编码的数字方案也可以这样说！:-)

对于您使用的语言，编译器是否提供带有当前文件名和行号的宏？这比尝试自己滚动一个唯一的数字要好。而且，如果您不能自动执行此操作，请手动执行，或者提出一些方案来保证唯一性，而不需要集中分配数字！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-23T18:01:35.300

在我看来，堆栈跟踪是处理这个问题的更好方法。如果您错误地重复使用一个号码会发生什么？

至于这是否是一个好主意，在没有更多信息的情况下，我倾向于说不。如果每个方法调用都包装在一个 try/catch 块中，那将会非常昂贵。一般来说，异常分为两个阵营——那些你可以合理预期和处理的和那些真正的错误（或至少没有成功预期）。在我看来，使用霰弹枪方法捕获所有异常似乎只是为了隐藏后者而不是帮助解决它们。如果您在顶层捕获所有异常以便您拥有的唯一记录是日志消息，则尤其如此。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-23T18:04:26.747

我看不出这有什么帮助。您已经可以通过堆栈跟踪知道异常来自何处，并且您正在添加不必要的复杂性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-23T18:06:23.310

缺点：

1.  这个数字并没有激发太多信心，堆栈跟踪要好得多

2.  如果您的自定义异常可以在“catch(Exception ex)”上处理，为什么还要有 2 个 catch 块？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-23T18:28:45.637

我认为这是一个糟糕的模式，因为您可以在异常中随时获得有关整个调用堆栈的信息，因此无需通过记录并重新抛出异常来伪处理异常。仅在您真正可以解决问题的地方捕获异常。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-25T15:15:34.540

我的应用程序是在发布模式下构建的，我使用异常处理应用程序块，所以我从来没有任何`catch ex`代码块，它被 EHAB 捕获，它本身会写入包含我需要的所有信息的日志文件；堆栈跟踪等，时间等。

唯一的问题是如果有人放

```
catch ex
{
    //do stuff
    throw ex;
} 
```

因为这将清除堆栈跟踪。

# sql - SQL GROUP BY/COUNT even if no results

> ID：389581
> 
> 赞同：2
> 
> 时间：2008-12-23T17:51:30.547
> 
> 标签：sql, mysql

I am attempting to get the information from one table (games) and count the entries in another table (tickets) that correspond to each entry in the first. I want each entry in the first table to be returned even if there aren't any entries in the second. My query is as follows:

```
SELECT g.*, count(*) 
FROM games g, tickets t 
WHERE (t.game_number = g.game_number
   OR NOT EXISTS (SELECT * FROM tickets t2 WHERE t2.game_number=g.game_number))
GROUP BY t.game_number; 
```

What am I doing wrong?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T17:54:37.250

You need to do a left-join:

```
SELECT g.Game_Number, g.PutColumnsHere, count(t.Game_Number) 
FROM games g
LEFT JOIN tickets t ON g.Game_Number = t.Game_Number
GROUP BY g.Game_Number, g.PutColumnsHere 
```

Alternatively, I think this is a little clearer with a correlated subquery:

```
SELECT g.Game_Number, G.PutColumnsHere,
  (SELECT COUNT(*) FROM Tickets T WHERE t.Game_Number = g.Game_Number) Tickets_Count
FROM Games g 
```

Just make sure you check the query plan to confirm that the optimizer interprets this well.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T17:55:50.537

You need to learn more about how to use joins in SQL:

```
SELECT g.*, count(*) 
FROM games g
 LEFT OUTER JOIN tickets t 
 USING (game_number)
GROUP BY g.game_number; 
```

Note that unlike some database brands, MySQL permits you to list many columns in the select-list even if you only GROUP BY their primary key. As long as the columns in your select-list are *functionally dependent* on the GROUP BY column, the result is unambiguous.

Other brands of database (Microsoft, Firebird, etc.) give you an error if you list any columns in the select-list without including them in GROUP BY or in an aggregate function.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T17:54:58.730

"`FROM games g, tickets t`" is the problem line. This performs an inner join. Any where clause can't add on to this. I think you want a `LEFT OUTER JOIN`.

# linux - Linux 内核中的队列

> ID：389582
> 
> 赞同：6
> 
> 时间：2008-12-23T17:52:00.950
> 
> 标签：linux, data-structures, queue, kernel

我一直在寻找有关队列的通用内核实现的信息，即先进先出数据结构。我认为可能有一个，因为它可能是常用的东西，并且有一个链接列表的标准（以 list_head 结构的形式）。是否有一些我找不到的标准队列实现，或者只是使用链表作为队列并希望最好的做法可能是常见的做法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-12T09:21:53.807

您在寻找 include/linux/kfifo.h 吗？从标题：

> 一个简单的内核 FIFO 实现。

无论如何，它还是相当新的，因此不难找到链表的直接用法。此外，它们有完全不同的实现（FIFO 被实现为循环缓冲区），因此它们有不同的应用。

另请注意，它们在设计时考虑了多线程使用（考虑生产者/消费者队列），但您可以在不使用 __kfifo_put/__kfifo_get 锁定的情况下使用它们。

顺便说一句：我记得我是在 lwn.net 上了解它们的 - 将此添加为书签：lwn.net/Kernel/Index，并阅读有关 kfifo 的条目 :-)。

来自您的前内核开发人员 Blaisorblade

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-23T17:58:20.003

没错，Linux 内核通常使用链表来实现队列。这是有道理的，因为链表提供了所需的行为。请参阅 kernel/workqueue.c 中的此示例：

```
 INIT_LIST_HEAD(&wq->list);
  // ...
   case CPU_UP_CANCELED:
            list_for_each_entry(wq, &workqueues, list) {
                    if (!per_cpu_ptr(wq->cpu_wq, hotcpu)->thread) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T18:50:41.737

您似乎将抽象（fifo 队列）与实现（链表）混淆了。它们不是相互排斥的——事实上队列最常被实现为链表——没有“希望最好”。

# c# - OleDbParameter 的名称痴迷

> ID：389591
> 
> 赞同：3
> 
> 时间：2008-12-23T17:55:10.133
> 
> 标签：c#, .net, oledbparameter

由于`OleDbParameter`不使用命名参数（由于其性质），为什么 .NET`OleDbParameter`类需要一个名称？`(string parametername ...)`

所有的构造函数都需要一个参数名，我永远不知道该给它起什么名字；我的名字好吗？还是我祖母的名字？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T18:16:32.150

尽管 OleDb/Odbc 提供程序使用位置参数而不是命名参数 -

1.  如果您需要引用参数，则需要在 OleDbParameter 集合中以某种方式标识这些参数。

2.  重要的是，当构造参数化的 sql 语句时，会为每个参数声明一个变量并为其分配相应的值。然后在执行的sql语句中使用。

举个例子：

```
string sql = "SELECT * FROM MyTable WHERE Field = ?";
OleDbCommand cmd = new OleDbCommmand(sql, sqlConnection);
cmd.Parameters.Add("@FieldValue", OleDbType.Int32, 42);
OleDbDataReader dr = cmd.ExecuteReader(); 
```

执行的 SQL 将类似于（或接近我认为）：

```
DECLARE @FieldValue INT;
SET @FieldValue = 42;
SELECT * FROM MyTable WHERE Field = @FieldValue 
```

建议您使用与正在操作的列的名称最匹配的参数名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T18:15:49.547

就像编程中的其他所有内容一样，将其命名为对您的上下文有意义的名称！（姓名、订单号、城市等）。

在 c# 代码中，您可以使用名称按名称访问参数集合：

```
OleDbCommand command = new OleDbCommand();
...//Add your parameters with names, then reference them later if you need to:
command.Parameters["name"].Value = "your name or your grandmothers name here"; 
```

当您在执行语句后使用 OUT 参数提取值时，这也很有用：

```
OleDbParameter outParam = new OleDbParameter();
outParam.Direction = ParameterDirection.Output;
outParam.DbType = DbType.Date;
outParam.ParameterName = "outParam";
command.Parameters.Add(outParam);
command.ExecuteNonQuery();
DateTime outParam = Convert.ToDateTime(command.Parameters["outParam"].Value); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T18:49:26.110

有接口和工厂为数据访问的底层提供者提供一定程度的独立性 - IDataParameter、DbParameter、DbProviderFactory 等。

为了支持这一点，可以命名所有参数，即使底层提供者不使用该名称。

# wcf - WCF 服务设置问题。我在 IIS 中添加了 .svc 处理程序，但它一直消失

> ID：389601
> 
> 赞同：2
> 
> 时间：2008-12-23T17:58:12.890
> 
> 标签：wcf, iis, configuration, handler, web-services

我的网络服务正在工作，然后突然停止了。调试后，我意识到配置中可能存在问题，并且由于某种原因，.svc 映射在 IIS（处理程序映射）中消失了。

我添加了 .svc 映射，它现在正在更新我的 web.config 并向 web.config 添加一个节点（我以前的 web.config 没有这个节点，它工作得很好）。

好的，然后我上传我原来的 web.config，现在回到 IIS，它显示 .svc 映射再次被删除。

有没有其他人经历过这种奇怪的行为？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-11T03:13:49.867

解决 RC1 问题 - 手动将 .svc 映射到 aspnet_isapi.dll

见： [http ://social.msdn.microsoft.com/Forums/en-US/wcf/thread/054b1d90-1e75-42ff-8d18-639f0b273dad/](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/054b1d90-1e75-42ff-8d18-639f0b273dad/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T09:34:53.293

如果您不需要任何特殊或自定义行为，请考虑使用 @ServiceHost 的 Factory 属性，那么您将不需要任何配置...

[http://msdn.microsoft.com/en-us/library/aa967286.aspx](http://msdn.microsoft.com/en-us/library/aa967286.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T14:10:06.030

我假设您使用的是 IIS7，因为您的 web.config 不断更改。您可以发布添加到您的 web.config 中的代码吗？

另外，您是否在 IIS 的应用程序级别设置此映射？如果是这样，您（或其他人）可能会在更高级别（或者如果您的工作更高，则更低）更改映射，这会导致最初的问题。

# apache-flex - 为什么 Actionscript 中的 ArrayCollections 没有可用的 addAll() 函数？

> ID：389604
> 
> 赞同：2
> 
> 时间：2008-12-23T17:59:00.673
> 
> 标签：apache-flex, actionscript

在 Actionscript 中使用 ArrayCollections 时没有可用的 addAll() 函数有什么原因吗？我一直在使用 for 循环使用 addItem() 一次单独添加一个。这是常见的还是有更方便的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-11T19:46:21.070

我可以为此添加一些历史细微差别。显然，Adobe 听取了 Flex 社区的意见并做出了回应。在 Flex 3.4 SDK 的 ListCollectionView 类型中添加了 addAll(addList:IList) 方法。

但是以防万一还有其他人可能仍在寻找一种可以全面发挥作用的单线等效产品，这是我的一条很长的路线：

```
var arrColl1 = new ArrayCollection(['x','y','z']);
var arrColl2 = new ArrayCollection(['a', 'b', 'c']);

// Using Flex SDK version 3.4:
arrColl1.addAll( arrColl2 );

// Using any Flex SDK:
arrColl2.source.forEach(function(item:*, i:int, arr:Array):void { arrColl1.addItem(item); }, this); 
```

这基本上是 Flex 实现所做的，并且应该正确处理绑定问题，尽管它不一定是最漂亮的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T18:40:46.993

例如，尝试将其放入容器中。从本质上讲，如果您必须有一个衬里，那么使用原始数据源和新数据创建一个新的 ArrayCollection 将起作用，至少在下面的情况下是这样。直接操作源的尝试似乎不是非常有用，至少出于数据绑定的目的（如果不涉及数据绑定或事件，那么使用数组可能更好）。

```
<mx:Script>
    <![CDATA[
        import mx.collections.ArrayCollection;
        [Bindable] public var collection:ArrayCollection = new ArrayCollection([
            2,6,4,6,7,8,9
        ]);

        public function addToCollection():void {
            collection.addItem(Number(collectionValue.text));
        }

        public function newCollectionWithAddition():void {
            collection = new ArrayCollection(collection.source.concat(Number(collectionValue2.text)));
        }

        public function addToCollectionSource():void {
            collection.source.push(Number(sourceValue));
        }

        public function addToCollectionSourceWithRefresh():void {
            collection.source.push(Number(sourceValue2));
            collection.refresh();
        }
    ]]>
</mx:Script>

<mx:HBox width="100%">
    <mx:PieChart width="300" height="300">
        <mx:series>
            <mx:PieSeries dataProvider="{ collection }" />
        </mx:series>
    </mx:PieChart>
    <mx:PieChart width="300" height="300">
        <mx:series>
            <mx:PieSeries dataProvider="{ collection.source }" />
        </mx:series>
    </mx:PieChart>
</mx:HBox>

<mx:HBox>
    <mx:TextInput id="collectionValue" />
    <mx:Button label="Add To ArrayCollection"
        click="addToCollection()"
        />
</mx:HBox>

<mx:HBox>
    <mx:TextInput id="collectionValue2" />
    <mx:Button label="Create New ArrayCollection with new value"
        click="newCollectionWithAddition()"
        />
</mx:HBox>

<mx:HBox>
    <mx:TextInput id="sourceValue" />
    <mx:Button label="Add To ArrayCollection Source"
        click="addToCollectionSource()"
        />
</mx:HBox>

<mx:HBox>
    <mx:TextInput id="sourceValue2" />
    <mx:Button label="Add To ArrayCollection Source with refresh"
        click="addToCollectionSourceWithRefresh()"
        />
</mx:HBox> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T18:29:23.543

没有理由不存在，只是不存在。如果您将代码更改为使用普通`Array`而不是`ArrayCollection`，则可以使用该`Array.concat`方法。否则，唯一的选择是`addItem`在循环中。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-23T20:12:01.637

经过进一步调查，事实证明 ArrayCollection 只是 Array 的包装器，您可以通过 arrcoll1.source 访问该数组。这允许您调用 concat。我能够删除我的 for 循环并改用它。

```
var arrColl1 = new ArrayCollection(['x','y','z']);
var arrColl2 = new ArrayCollection(['a', 'b', 'c']);

arrColl1.source = arColl1.source.concat(arrColl2.source); 
```

如果您要连接一个数组，例如列表中的 selectedItems，您可以这样做：

```
arrColl1.source = arrColl1.source.concat(seletedItems); 
```

# visual-studio - 在 vs 2008 中快速为方法、属性等添加 xml 注释

> ID：389620
> 
> 赞同：0
> 
> 时间：2008-12-23T18:03:59.990
> 
> 标签：visual-studio, visual-studio-2008

假设我有 10 个方法和 10 个属性。有没有办法在 VS 2008 中一次将 xml 注释 (///) 添加到所有 10 个方法和 10 个属性，或者我必须为每个方法键入 ///。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T18:06:06.820

这个小工具是非常有用的[Ghost Doc](http://www.roland-weigelt.de/ghostdoc/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T18:06:11.280

好吧，无论如何您都必须实际输入文本，因此`///`每次输入实际上并不是任何额外的工作。我希望你不只是插入存根并将它们留在那里。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T15:48:01.077

您可以创建一个 powershell（语法与 C# 非常相似的脚本语言）脚本来为您执行此操作。

# .net - 我是否需要在 SQL 2005 上启用 Service Broker 端点才能使用 SQLCacheDependency？

> ID：389622
> 
> 赞同：0
> 
> 时间：2008-12-23T18:04:30.177
> 
> 标签：.net, asp.net, sql-server, caching

我的问题确实有三个相关的部分，希望您能帮助我弄清楚-

1.  我是否需要在 SQL 2005 上启用 Service Broker 端点才能使用 SQLCacheDependency 机制？

2.  如果是这样，是否有需要使用的特定端口？

3.  如果 web server 机器和 sql server 都不在域中，需要什么类型的身份验证，如果有的话？证书？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T08:11:31.883

不，您不需要启用服务代理端点来使用 SQLCacheDependency。Service Broker Endpoint 仅用于将 SQL Service Broker 消息从一个实例发送到另一个实例。

# c# - 类型编译错误后的新表达式需要 () 或 [] - C#

> ID：389644
> 
> 赞同：5
> 
> 时间：2008-12-23T18:14:55.477
> 
> 标签：c#, visual-studio-2008, .net-3.5

同事的以下代码在尝试使用 VS 2008 编译时抛出以下错误：

错误：

> 新表达式在类型后需要 () 或 []

代码：

MyClass 结构：

```
public class MyClass
{
    public MyClass() {}

    public string Property1 { get; set; }
    public string Property2 { get; set; }
} 
```

示例源代码：

```
List<MyClass> x = new List<MyClass>();

x.Add(new MyClass 
{
    Property1 = "MyValue",
    Property2 = "Another Value"
}); 
```

它“在我的机器上工作”，但不是他的。知道为什么吗？

**更新**
他的目标是 3.5 .NET 框架
他正在使用 System.Collections.Generics 命名空间
MyClass 对象确实有一个构造函数

**更新 1：**
@Funky81 - 您的示例和我的示例能够在我的 PC 上编译。

**更新 2：**
示例中包含 MyClass 的架构

**更新 3：**
@DK - 我让我的同事将以下配置部分添加到他的应用程序中：

```
<system.codedom>
        <compilers>
            <compiler language="c#;cs;csharp" extension=".cs" warningLevel="4" type="Microsoft.CSharp.CSharpCodeProvider, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
                <providerOption name="CompilerVersion" value="v3.5"/>
                <providerOption name="WarnAsError" value="false"/>
            </compiler>
            <compiler language="vb;vbs;visualbasic;vbscript" extension=".vb" warningLevel="4" type="Microsoft.VisualBasic.VBCodeProvider, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
                <providerOption name="CompilerVersion" value="v3.5"/>
                <providerOption name="OptionInfer" value="true"/>
                <providerOption name="WarnAsError" value="false"/>
            </compiler>
        </compilers>
    </system.codedom> 
```

他收到以下编译错误：无法识别的元素'providerOption'。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T19:04:18.013

这似乎是 VS.2008 中唯一类似但不完全相同的错误：

> 编译器错误 CS1526：新表达式 在类型后需要 ()、[]**或 {}**

请注意`{}`错误消息中的那些，它们是 c# 3.0 语法的一部分。这与框架版本无关，而与语言版本有关。

我敢打赌，不知何故使用了不同版本的编译器。

补充：这看起来可能是 ASP.Net 的问题。检查的地方在 .config 文件中，元素

```
configuration\system.codedom\compilers\compiler @language="c#..." 
```

应该有

```
<providerOption name="CompilerVersion" value="v3.5"/> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T18:29:52.217

它在我的 PC 中给了我错误的编译信息

试试这个

```
x.Add(new MyClass()
{
    Property1 = "MyValue",
    Property2 = "Another Value"
}); 
```

请注意，在 MyClass 类创建之后还有另一个括号。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-23T18:17:19.807

他的项目是针对 .NET 3.5 的吗？如果没有，该错误将在 x.Add(new MyClass 行中抛出，因为新类没有指定构造函数或索引器。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T18:34:19.837

你确定你使用的是完全相同的代码吗？

您提供的代码无法编译，因为它缺少`MyClass`. 请向我们提供完整的编译，而不仅仅是代码片段。然后将该文件发送给您的朋友，以确保您仍然可以在计算机上看到不同的行为。

错误消息指向一行和列，对吗？告诉我们在哪里。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T18:35:21.957

你们是否都处于相同的 .NET 服务包级别？我今天被咬了，因为一台机器是 .NET 3.5 RTM，另一台是 .NET 3.5 SP1。在 .NET 3.5 SP1（也安装了 .NET 2.0 SP2）中，他们为我在开发盒上使用的 System.Web.Caching.Cache.Insert 方法引入了新的重载，然后在中间预构建环境中失败：

```
public void Insert(
    string key,
    Object value,
    CacheDependency dependencies,
    DateTime absoluteExpiration,
    TimeSpan slidingExpiration,
    CacheItemUpdateCallback onUpdateCallback
) 
```

花了我几分钟的时间来锻炼为什么这在一台机器上坏了，而在另一台机器上却没有……

**更新：**错误消息*'A new expression requires () or [] after type* '通常意味着您错过了构造函数括号。你确定你没有漏掉一个 () 下线：

```
List<MyClass> x = new List<MyClass>(); 
```

还是附近的某个地方？

**再次更新**：我已经构建了以下内容：

```
using System;
using System.Collections.Generic;

namespace Test
{
    public class MyClass
    {
        public MyClass() { }

        public string Property1 { get; set; }
        public string Property2 { get; set; }
    }

    class Program
    {
        static void Main(string[] args)
        {
            List<MyClass> x = new List<MyClass>();
            x.Add(new MyClass
            {
                Property1 = "Kev",
                Property2 = "Kev 2"
            });
        }
    }
} 
```

VS2008 SP1 Targetting 3.5 - 编译正常
VS2008 SP1 Targetting 3.0 - 编译正常
VS2008 SP1 Targetting 2.0 - 编译正常

VS2008 RTM - 定位 3.5 - 编译正常
VS2008 RTM - 定位 3.0 - 编译正常
VS2008 RTM - 定位 2.0 - 编译正常

VS2005 - 8.0.50727.867（在装有 VS2008/3.5 SP1 的机器上） - 失败：

*在类型“Test.MyClass.Property1.get”之后的新表达式需要 () 或 [] 必须声明一个主体，因为它没有被标记为 abstract 或 extern
'Test.MyClass.Property1.set' 必须声明一个主体，因为它没有被标记abstract 或 extern
'Test.MyClass.Property2.get' 必须声明一个主体，因为它没有标记为 abstract 或 extern
'Test.MyClass.Property2.set' 必须声明一个主体，因为它没有标记为 abstract 或 extern*

VS2005 - 8.0.50727.762（在带有 VS2008/3.5 RTM 的机器上） - 失败：

*在类型“Test.MyClass.Property1.get”之后的新表达式需要 () 或 [] 必须声明一个主体，因为它没有被标记为 abstract 或 extern
'Test.MyClass.Property1.set' 必须声明一个主体，因为它没有被标记abstract 或 extern
'Test.MyClass.Property2.get' 必须声明一个主体，因为它没有标记为 abstract 或 extern
'Test.MyClass.Property2.set' 必须声明一个主体，因为它没有标记为 abstract 或 extern*

我倾向于认为问题不在于您提供的代码，除非使用上述代码或类似代码提供了带有编译错误示例的屏幕截图。有没有机会把事情归结为简单的东西来消除红鲱鱼？

干杯
凯夫

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-23T18:18:55.017

你的代码对我来说完美无缺。您确定项目正在编译为 3.5 框架吗？从 Project 菜单中选择项目属性，转到 Application 选项卡，然后查看 Target Framework 下拉菜单。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-24T15:46:33.137

在代码示例中的 new MyClass 之后添加“()”，或者从 MyClass 中删除空构造函数。

# php - 在 socket_read 上设置超时

> ID：389645
> 
> 赞同：18
> 
> 时间：2008-12-23T18:15:03.573
> 
> 标签：php, sockets, timeout

我想知道如何设置`socket_read`通话超时？第一次调用时`socket_read`，它会等到发送数据，如果在 5 秒内没有发送数据，我想关闭连接。有什么帮助吗？我已经试过`SO_RCVTIMEO`了，没有运气。

我正在创建一个套接字`socket_create()`并在其上侦听连接，然后在连接时侦听数据，然后对其进行处理。当超时命中时，我想运行`socket_shutdown()`然后`socket_close()`.

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2011-11-20T23:09:41.847

这设置了 5 秒的套接字超时。

```
socket_set_option($socket,SOL_SOCKET, SO_RCVTIMEO, array("sec"=>5, "usec"=>0)); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-23T18:58:12.830

您是否尝试过使用[SO_RCVTIMEO的](http://us2.php.net/manual/en/function.socket-set-option.php)[socket_set_option](http://us2.php.net/manual/en/function.socket-get-option.php)

输入操作的超时值。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T19:11:59.277

我做了一个 socket_listen ，然后我用 time()+2 和一个 while 循环手动超时，里面有 nonblock set 和 socket_read() 。似乎工作正常。有什么选择吗？

更新：我发现将套接字设置为非阻塞，然后使用 socket_listen 提供了我需要的超时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-11-29T12:57:33.730

```
$read_socket = socket_select($read, $write  = NULL, $except = NULL, 10); // 10 - Timeout
if($read_socket === FALSE)
    $this->End();
elseif($read_socket === 0)
    return FALSE;

$pdu_ = socket_read($this->session, 102400);
if($read_socket && !strlen($pdu_))
    $this->End(); 
```

# c# - C# Windows 应用程序 - 许多线程使用相同的连接？

> ID：389652
> 
> 赞同：5
> 
> 时间：2008-12-23T18:17:38.527
> 
> 标签：c#, database, multithreading, ado.net

我有 ac# WINDOWS 应用程序，它是多线程的。据我了解，在 Web 环境中，连接是自动汇集的。据我了解，在 Windows 应用程序中，情况并非如此。因此，对于 Windows 应用程序，应该使用相同的连接，而不是在每次调用后关闭，而是在应用程序关闭时关闭。

不过我很好奇——我说的对吗？如果是，两个线程可以使用相同的连接同时从数据库获取数据集，还是该功能排队？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T18:22:40.093

连接池是 ADO.NET 的一项功能。因此，连接已经被池化。不仅在网络环境中。

[http://www.ondotnet.com/pub/a/dotnet/2004/02/09/connpool.html](http://www.ondotnet.com/pub/a/dotnet/2004/02/09/connpool.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T18:42:07.090

> 据我了解，在 Web 环境中，连接是自动汇集的。据我了解，在 Windows 应用程序中，情况并非如此。

不，这是错误的，正如 m3rLinEz 指出的那样。连接始终是池化的。

> 因此，对于 Windows 应用程序，应该使用相同的连接，而不是在每次调用后关闭，而是在应用程序关闭时关闭。

在单体 WinForms 应用程序中，您*可以在应用程序运行期间保持连接打开。*但最好在需要时使用打开/关闭连接的标准模式。连接池意味着您不会注意到性能差异。而且您的数据访问代码将与 ASP.NET 等服务器应用程序兼容。

> 如果是，两个线程可以使用相同的连接同时从数据库获取数据集，还是该功能排队？

不。ADO.NET 类（连接、命令等）不是线程安全的，不应该在没有同步的线程之间共享。但如上所述，您应该更喜欢数据访问的标准模式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T18:54:33.837

好的 - 所以我的这个假设是通过观察得出的：当我尝试以典型的池方式设置 win 应用程序时，我总是会遇到 3-5 秒的延迟，同时与远程服务器建立真正的连接。即使我先打开，然后关闭，下一个查询总是会有这个延迟。

当服务器连接时，它显然不会为池中的每个连接建立连接。此外，池化机制是否足够聪明，可以抓取它知道已经打开的连接，或者它是否可以简单地抓取任何随机连接？

池中的默认最大连接数是多少？

# sql-server - 如何显示另一个数据库中的表列表？

> ID：389660
> 
> 赞同：9
> 
> 时间：2008-12-23T18:20:10.270
> 
> 标签：sql-server, system

我可以用：

```
select * from sys.tables 
```

在 mssql 中显示当前数据库中所有表的列表。无论如何我可以使用类似的语法来显示另一个数据库中的表列表吗？

假设我正在使用 A ：

```
use A 
```

语句，我可以显示数据库 B 中的表吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-23T18:23:59.403

这对我有用（MS SQL 2005 和更新版本）：

```
select * from your_database_name.sys.tables 
```

请记住，您（或您正在使用的任何身份验证上下文）仍需要对该数据库的读取权限。

要使用您的示例：

```
use a;
go

select * from sys.tables; -- selects table info from a
select * from b.sys.tables; -- selects table info from b 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T12:03:12.687

另一种可能性是使用：

```
select * from your_database_name.information_schema.tables 
```

# iphone - UITableView 变成了 UIScrollView？

> ID：389664
> 
> 赞同：2
> 
> 时间：2008-12-23T18:22:37.037
> 
> 标签：iphone, cocoa-touch

我希望有两个视图，它们是组成集的一部分。每个视图中的数据最好在 UITableView 中表示。然后，我想添加一个手势以将视图闪烁到屏幕外并引入另一个类似的视图，并带有页面指示器控件。我担心 UITableView 会拦截触摸并成为 UIView 可能正在等待的任何此类“闪烁”的响应者。这将直接阻碍应用程序的可用性。

所以我对可用性/UI 专家的问题是，将 UITableView 放在 UIPageControl 中是一个糟糕的设计选择吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-25T05:57:51.093

UITableView 是 UIScrollView 的子类。iPhone SDK 提供的 PageControl 示例很好地解释了如何将 UIScrollView 与 UIPageControl 一起使用。如果视图控制器实现了 UITableViewDelegate，则任何属于 UIScrollViewDelegate 的方法都将在视图控制器内被调用。

要实现您想要做的事情，最好的方法是将 UITableView 与 UIPageControl 一起使用，如 PageControl 示例中所述。

希望有帮助！

# visual-studio - 为什么 Visual Studio 2005 更新我的 VSMDI 文件需要这么长时间？

> ID：389666
> 
> 赞同：0
> 
> 时间：2008-12-23T18:23:13.603
> 
> 标签：visual-studio, visual-studio-2005, microsoft-test-manager

我在 Visual Studio 2005 中使用了许多项目的解决方案。不幸的是，我们正在使用测试工具。我的问题是，很多时候当我通过双击我的 VSMDI 文件打开测试管理器进行一些测试时，我得到了至少 10 分钟的沙漏，而微软可怕的代码确实知道什么，我猜想尝试寻找新的测试？有没有人有解决方法？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-03-17T14:53:50.707

我知道这是一个老问题，但我现在已经习惯了使用 MSTEST。以下是我在大型解决方案中有效使用的建议：

*   使用快捷键 CTRL-R、T（或 CTRL-T 进行调试）在当前上下文（即命名空间、类、方法）中运行测试。这非常适合 TDD 方法。
*   如果可以避免，请不要使用测试视图、测试列表或测试运行窗口。
*   通常我发现在不同的构建配置之间切换时我只会遇到 VSMDI 文件的问题。VS 想了一会儿，然后提示我签出 VSMDI 文件（我只是取消签出对话框）。

# complexity-theory - 使用规范模式真的可以降低代码的复杂性吗？

> ID：389669
> 
> 赞同：1
> 
> 时间：2008-12-23T18:24:03.477
> 
> 标签：complexity-theory, maintenance, specification-pattern

从我的阅读来看，规范模式似乎可以大大减少过滤数据所需的方法数量。您看到使用规范模式有什么好处？您是否注意到了不可预见的好处。相反，你遇到了什么陷阱？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T18:25:50.993

它并没有降低复杂性，而是使它更加熟悉和导航。如果您已经了解该模式，那么检查代码，甚至是高度复杂的代码，都会变得更易于管理，因为您可以看到该模式。把它比作一个小镇，南北使用字母街道，东/西使用编号街道。即使您以前从未去过那里，您也可能会找到东西，因为您了解这种模式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T18:46:52.743

在大型项目中工作时，您肯定会发现规范模式的使用是性能问题的热点。这是因为它们的简单和优雅，人们以原作者未想到的各种方式来组合它们，并在不同的上下文中重复使用。

这些问题通常很容易解决，即使我使用“问题”这个词，这也是一件好事；在它们成为问题之前，您不会解决这些问题。

# iphone - iPhone 应用程序的用户界面灵感

> ID：389671
> 
> 赞同：5
> 
> 时间：2008-12-23T18:24:37.187
> 
> 标签：iphone, cocoa-touch, user-interface, usability

有没有人对可能有一些鼓舞人心的用户界面来构建我自己的 iPhone 应用程序的网站有任何建议。使用传统的 UIKit 小部件不断构建应用程序是直截了当的，但它不会让您在竞争中脱颖而出。非常需要一些关于如何构建有吸引力的界面的资源来激发灵感。这适用于具有最低 Photoshop/Illustrator 技能的人，但不介意使用 iStockPhoto 等网站并使用自定义视图。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T00:34:47.727

苹果在历史上以其产品和为其编写的程序的用户界面而闻名，但近年来它因似乎允许其人机界面指南 (HIG) 失效而受到抨击。一些最好的 Mac 和 iPhone 应用程序实际上是那些偏离 HIG 的应用程序，但并没有牺牲可用性（或 App Store 的接受度）（见[链接文本](http://en.wikipedia.org/wiki/Delicious_Generation "美味的一代")）。

此类创新 iPhone 应用程序的示例可以在 Apple 设计奖获奖者的 iPhone[应用程序](http://developer.apple.com/wwdc/ada/index.html#showcase "应用程序")和[Web 应用程序](http://developer.apple.com/wwdc/ada/index.html#wepapp "网络应用")展示中找到。这些应用程序已被 Apple 自己评为具有创造性、启发性和示范性的 iPhone 平台作为移动计算设备的潜力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T20:43:02.510

前往当地的百思买、游戏站或任何其他有 xbox360、wiis 和 playstation 3 的商店。在这些机器上播放每一个演示，并仅根据 UI 体验对它们进行评分。在我看来，Triple A 主机游戏仍然引领着界面世界。软合成器紧随其后，并且通常具有漂亮的 UI（正如 Chris Schreiner 指出的那样）。快速浏览一下[逻辑](http://www.apple.com/logicstudio/instruments/)将使您了解苹果自己在这个方向上的工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T23:51:41.757

您可能想查看 Matt Gemmell 撰写的这篇[文章](http://mattgemmell.com/2008/10/29/favorites-ui-design)，了解他为收藏夹应用程序设计 UI 的过程。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-24T10:44:35.423

[10 个设计精美的 iPhone 应用程序](http://www.razorianfly.com/2009/10-gorgeously-designed-iphone-applications/)有一些设计精美的应用程序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-30T00:14:31.690

我花了很长时间把这个放在一起，这是我在互联网上可以找到的每一个 ios 灵感/移动 css 画廊的完整列表。如果您发现其他任何人，请告诉我，以便我添加它们！

[http://www.kintek.com.au/web-design-blog/iphone-mobile-css-gallery-listing-ios-inspiration/](http://www.kintek.com.au/web-design-blog/iphone-mobile-css-gallery-listing-ios-inspiration/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-23T20:22:59.353

也许这会有所帮助：我的灵感来源于软件合成领域。想到一汽的Circle。Ableton Live 是（在我的书中）值得一看的东西。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-24T10:37:39.580

这是一篇关于设计 Convertbot 应用程序的好[文章。](http://tapbots.com/blog/design/designing-convertbot)一个非常简单的应用程序，因其 UI 而脱颖而出。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-11-30T02:00:58.307

我讨厌打破你的泡沫，但伟大的设计并不是你从找到一个“网站”来查看的东西。主要大学都有研究生设计课程，这是一些人学习成为伟大设计师的地方。多门关于设计和所有相关领域（艺术、建筑、心理学、生物力学等）的课程和教科书. 不要成为他们中的另一个。

将学习伟大的设计视为比寻找网站（或学习另一种编程语言等）更重要的事情，更像是多年的努力，你可能会有机会。

或者找一个已经是经验丰富的设计师的人并与之合作。

# c# - 寻找具体日期

> ID：389677
> 
> 赞同：4
> 
> 时间：2008-12-23T18:26:46.950
> 
> 标签：c#, entity-framework

有人知道如何在实体框架中查询特定日期吗？我尝试了以下代码，但它给了我 NotSupportedException。

```
var deposit = (from tempDeposit in entities.Deposit
where !tempDeposit.IsApproved
&& tempDeposit.CreatedDate.Date == DateTime.Today
select tempDeposit).FirstOrDefault(); 
```

我也尝试了以下代码，但仍然给了我 NotSupportedException。

```
var deposit = (from tempDeposit in entities.Deposit
where !tempDeposit.IsApproved
&& tempDeposit.CreatedDate.ToFullString() == DateTime.Today.ToFullString()
select tempDeposit).FirstOrDefault(); 
```

ToFullString() 是一个扩展方法

```
public static string ToFullString(this DateTime date){
  return date.ToString("yyyyMMdd");
} 
```

请帮忙。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-23T19:42:06.750

试试这个：

```
var d1 = DateTime.Today;
var d2 = d1.AddDays(1);
var deposit = (from tempDeposit in entities.Deposit
               where !tempDeposit.IsApproved
                     && tempDeposit.CreatedDate >= d1
                     && tempDeposit.CreatedDate < d2
               select tempDeposit).FirstOrDefault(); 
```

由于您不能使用 DateTime 列的 .Date 属性，因为必须用 SQL 编写一系列转换、强制转换、截断等，所以您需要比较整个 DateTime 值、日期和时间, 到一个值，因此您需要与一个范围进行比较。

**编辑**更改以反映不支持 .AddDays。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T19:58:22.380

好吧，经过一段时间的尝试，我找到了解决方案

```
var deposit = entities1.Deposit
              .Where("CreatedDate >= @0 and CreatedDate < @1", DateTime.Today, DateTime.Today.AddDays(1))
              .FirstOrDefault(); 
```

# java - 我的构建可以规定我的代码覆盖率永远不会变得更糟吗？

> ID：389680
> 
> 赞同：6
> 
> 时间：2008-12-23T18:27:24.967
> 
> 标签：java, hudson, code-coverage, continuous-integration

我正在使用 hudson CI 来管理一个直接的 java web 项目，使用 ant 来构建。

我想强制单元测试覆盖率永远不会比以前的构建差，从而确保始终测试任何新代码，或者至少覆盖率不断提高。

有没有这样的哈德逊插件？

编辑：我目前正在使用 Emma，但愿意切换到另一个覆盖应用程序。

另外，作为澄清，我已经看到了一些 Hudson 插件中的阈值，但这并不是我所追求的。例如，我想要的是，如果 Build #12 的总体覆盖率为 46%，并且有人以 45% 的覆盖率签入 Build #13，则构建会中断。

我想这样做的原因是我有一个测试覆盖率低的代码库。我们没有时间回去追溯编写单元测试，但我想确保覆盖率不断提高。

更新：丹指出了我的计划的一个边缘案例，这肯定会成为一个问题。我想我需要重新考虑这是否是一个好主意。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-23T18:34:00.803

是的。您使用的是哪种覆盖工具？

Hudson 的 Cobertura 插件绝对支持这一点。在项目配置屏幕上，您可以指定阈值。

或者，您可以使用 cobertura-check 任务使 Ant 构建失败（而不是 Hudson）。

**编辑：**我不确定你能不能完全按照你的要求做。即使你可以，它也可能被证明是有问题的。例如，假设您的平均覆盖率为 75%，但对于一个班级，您的覆盖率为 80%。如果你删除了 80% 的类和它的所有测试，你会降低整体覆盖率，即使没有其他代码的测试比以前少。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T19:34:46.343

这是一种 hack，但我们出于与 Findbugs 和 Checkstyle 类似的原因使用它。您可以设置一个 Ant 任务来执行以下操作（这可以拆分为多个任务，但为了简洁起见，我将它们组合在一起）：

1.  运行覆盖率测试
2.  解析覆盖结果，得到覆盖百分比
3.  从上次构建中读取 tmp/lastCoverage.txt（参见步骤 #5a）
4.  将当前覆盖百分比与从 lastCoverage.txt 读取的百分比进行比较
5.  1.  如果百分比没有减少，则将新百分比写入 tmp/lastCoverage.txt 的内容
    2.  如果百分比 DID 减少，则保留原始文件并回显“COVERAGE FAILURE”（与 ant 的`echo`任务一起）。

请注意，步骤 2 到 5 不一定需要使用本机 Ant 任务来完成 - 您可以使用 Ant 任务之类的东西`javac`来运行 Java 程序来为您执行此操作。

然后，配置 Hudson：

*   在“源代码管理”下，确保选中“使用更新”。这将允许您的 lastCoverage.txt 文件在构建之间保留。请注意，如果您真的非常需要在构建之间清理一些东西，这可能会出现问题。
*   使用带有正则表达式的[Hudson Text Finder](http://hudson.gotdns.com/wiki/display/HUDSON/Text-finder+Plugin)插件在构建输出中搜索“COVERAGE FAILURE”（确保检查了插件的“Also search console output”）。文本查找器插件可以将构建标记为不稳定。

您显然可以将文件名/路径和控制台输出等内容替换为适合您的构建上下文的任何内容。

正如我上面提到的，这很 hacky，但它可能是让 Hudson 将先前构建中的内容与当前构建进行比较的少数（唯一？）方法之一。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T07:56:55.873

另一种方法是使用 Hudson 的 Sonar 插件来保持随时间推移的覆盖趋势，并使其更容易吸收和分析结果。它还将在其他度量的上下文中显示覆盖率，例如 checkstyle 和 pmd

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-23T10:12:35.700

Atlassian 的 Clover 支持您想要的。查看[clover-check](http://confluence.atlassian.com/display/CLOVER/clover-check) Ant 任务，特别是 historyDir 属性。

# python - 为 Python 类生成文档

> ID：389688
> 
> 赞同：11
> 
> 时间：2008-12-23T18:30:53.167
> 
> 标签：python, data-structures, documentation

我即将开始一个项目，我将是唯一一个编写实际代码的人，两名经验不足的程序员（害怕认为自己是有经验的！）将在一般情况下观看并提出建议。

是否有一个好的（免费）系统可以用来根据我编写的代码为类和函数提供文档？这可能会对他们掌握数据结构有很大帮助。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-23T18:37:06.087

我使用[epydoc](http://epydoc.sourceforge.net/)从嵌入式文档字符串生成 Python 模块的文档。它非常易于使用，并以多种格式生成漂亮的输出。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-23T18:37:36.087

python.org 现在使用[sphinx](http://sphinx.pocoo.org/)作为它的文档。

我个人喜欢 sphinx 在 epydoc 上的输出。我还觉得重组后的文本在文档字符串中比 epydoc 标记更容易阅读。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-24T03:23:08.117

[Sphinx](http://sphinx.pocoo.org/)可用于生成非常冗长和信息丰富的文档，这些文档超出了简单的 API 文档所提供的范围。然而，在许多情况下，您最好使用 wiki 来处理此类文档。还可以考虑编写功能测试来演示代码的用法，而不是用文字记录如何使用代码。

[Epydoc](http://epydoc.sourceforge.net/)非常擅长扫描您的文档字符串并查看您的代码以生成 API 文档，但不一定擅长提供更深入的信息。

拥有两种类型的项目文档是有好处的。但是，如果您遇到时间紧迫的问题，那么拥有良好的测试覆盖率和有意义的测试总是比文档更有益。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-22T22:43:16.640

我将 Sphinx 用于我的项目，不仅因为它看起来不错，还因为 Sphinx 鼓励编写文档供*人类*阅读，而不仅仅是*计算机*。

我发现像 epydoc 这样的工具生成的 JavaDoc 风格的文档很难读。程序员不自觉地“记录”参数和返回类型的情况经常发生，因为否则 API 文档中会出现空白。所以你最终得到了这个代码行（它应该看起来像 Java，但是我写 Java 已经有一段时间了，所以它可能无法编译......）

```
/**
 * Set the name.
 *
 * @param firstName the first name.
 * @param lastName the last name.
 */
public void setName(String firstName, String lastName) {
  this.firstName = firstName;
  this.lastName = lastName;
} 
```

这个所谓的“文档”中包含的信息量非常少。我更喜欢 Sphinx 方式，您（使用`autodoc`插件）只需编写

```
.. autofunction:: set_name 
```

然后 Sphinx 会在你的文档中添加一行，上面写着

> `set_name`( `first_name`, `last_name`)

每个 Python 程序员都应该知道发生了什么。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T18:38:30.997

查看[can-i-document-python-code-with-doxygen-and-does-it-make-sense](https://stackoverflow.com/questions/58622/can-i-document-python-code-with-doxygen-and-does-it-make-sense)的答案，尤其是那些提到[Epydoc](http://epydoc.sourceforge.net/)和[pydoctor](https://github.com/twisted/pydoctor)的答案。

# vb.net - http-handler 应该如何填充调用 xmlhttp 对象的 responsetext 属性？

> ID：389691
> 
> 赞同：2
> 
> 时间：2008-12-23T18:32:20.527
> 
> 标签：vb.net, httphandler, xmlhttprequest, serverxmlhttp

我正在尝试使用 asp.net 为客户端将使用 serverxmlhttp 从处理程序请求信息的环境实现 http 句柄 (.ashx)。这是到目前为止的代码......

**客户端.ASPX**

```
<%@ Page Language="VB" %>
<%
    On Error Resume Next
    Dim myserver_url As String = "http://mydomain.com/Server.ashx"
    Dim myparameters As String = "one=1&two=2"
    Dim xmlhttp As Object
    xmlhttp = Server.CreateObject("MSXML2.ServerXMLHTTP.4.0")
    xmlhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
    xmlhttp.open("POST", myserver_url, False)
    xmlhttp.Send(myparameters)
    If xmlhttp.Status = 200 Then        
        Dim myresults As String = ""   
        myresults = xmlhttp.responsetext
        Response.Clear()
        Response.Write("<html><body><h1>" & myresults & "</h1></body></html>")
    End If
    xmlhttp = Nothing   
%> 
```

**服务器.ASHX**

```
<%@ WebHandler Language="VB" Class="MyServerClass" %>

Imports System
Imports System.Web

Public Class MyServerClass : Implements IHttpHandler

    Public Sub ProcessRequest(ByVal context As HttpContext) Implements IHttpHandler.ProcessRequest
        context.Response.ContentType = "text/plain"
        context.Response.Write("hi there")
    End Sub

    Public ReadOnly Property IsReusable() As Boolean Implements IHttpHandler.IsReusable
        Get
            Return False
        End Get
    End Property

End Class 
```

...我的问题是客户端代码中的 myresults 字符串始终为空。问题：http-handle 应该如何填充调用它的 xmlhttp 对象的 responsetext 属性？

*附录：我也将 server.ashx 实现为 aspx 文件，但 myresults 仍然是空白的。这是那个代码。*

**服务器.ASPX**

```
<%@ Page Language="VB" %>

<%
    Response.ContentType = "text/plain"
    Response.Write("hi there")
%> 
```

提前感谢您的帮助！和平，亨利·E·泰勒

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T21:18:44.247

您的 CLIENT.ASPX 文件有一些问题。从我可以看到您正在使用服务器端代码来实例化 ActiveX 控件，从而允许您向 SERVER.ASHX 发出 HTTP 请求并读取响应流，该响应流又被写入 CLIENT.ASPX 页面的响应流。您使用 ActiveX 控件而不是标准的 .NET[类](https://stackoverflow.com/questions/386189/get-the-source-of-some-website-from-aspnet-code#386217)这一事实使我认为您正在将旧的 ASP 站点迁移到 .NET。在这种情况下，首先要做的是使用*AspCompat=true*指令标记您的页面：

```
<%@ Page Language="VB" AspCompat="true" %> 
```

另一件要提的是，您使用了错误的 ActiveX 名称*MSXML2.ServerXMLHTTP.4.0*而不是*MSXML2.ServerXMLHTTP*。您还尝试在调用[open](http://msdn.microsoft.com/en-us/library/ms763809(VS.85).aspx)方法之前使用[setRequestHeader](http://msdn.microsoft.com/en-us/library/ms764715(VS.85).aspx)方法设置请求标头。*您编写On Error Resume Next*语句的事实使您无法看到所有这些错误。代码刚刚通过，您的 SERVER.ASHX 处理程序从未真正执行，因此您得到一个空响应。这是您的 CLIENT.ASPX 代码的更正版本：

 *```
<%@ Page Language="VB" AspCompat="true" %>
<%
    Dim myserver_url As String = "http://mydomain.com/Server.ashx"
    Dim myparameters As String = "one=1&two=2"
    Dim xmlhttp As Object
    xmlhttp = Server.CreateObject("MSXML2.ServerXMLHTTP")

    xmlhttp.open("POST", myserver_url, False)
    xmlhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
    xmlhttp.Send()
    If xmlhttp.Status = 200 Then        
        Dim myresults As String = ""   
        myresults = xmlhttp.responseText
        Response.Clear()
        Response.Write("<html><body><h1>" & myresults & "</h1></body></html>")
    End If
    xmlhttp = Nothing   
%> 
```

当然，实现这一点的首选方法是使用客户端脚本语言（如 javascript），或者如果您想在服务器端执行此操作，则使用标准 .NET 类而不是 ActiveX 控件。

# php - 如何测试 Oracle 连接

> ID：389692
> 
> 赞同：3
> 
> 时间：2008-12-23T18:32:30.557
> 
> 标签：php, oracle

我正在尝试连接到当前离线的 Oracle 数据库。但是，当它在线时，它不是问题，现在它离线了，我的程序挂在 $connection = oci_connect() 线上并超时。如果它不存在，我如何简单地检查连接并退出？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T19:11:36.080

试试这个（填写你的 ip 和端口）：

```
if ( @fsockopen($db_ip,$db_port ) ) {
    //connect to database
} else {
    // didn't work
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T20:18:58.393

这会给你一个手动错误，加上将返回实际错误。

```
$connection = oci_connect() or die("Critical Error: Could not connect to database.\n\n". oci_error()); 
```

确保测试这一点，因为希望 Oracle 错误不会做一些愚蠢的事情，比如返回连接字符串（使用您的数据库密码），但我不会假设，直到您自己看到。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T18:38:31.840

您可以从对偶中选择空值。

好的，现在我明白你的要求了，我想。

您想知道在连接数据库之前如何判断数据库是否已启动？

您可以使用 TNSPING 查看数据库是否已启动...好吧，这可能不是 100% 准确，但它是一个很好的指标。转到命令提示符并键入 TNSPING 并按 Enter。因此，您必须弄清楚如何从 PHP 调用命令行工具。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-23T19:20:14.487

这是我在 ASP.NET 中所做的

```
Dim OracleConn As New OracleConnection(YOUR CONNECTION STRING HERE)
        Try
            OracleConn.Open()
            OracleConn.Close()
        Catch ex As Exception
            Session("ErrorMessage") = "OracleConn: " & ex.Message
            Response.Redirect("AccessDenied.aspx")
        End Try 
```

不一定说DB离线，但是如果无法打开连接会出现异常

# iis - 内容过期 - IIS 6

> ID：389702
> 
> 赞同：3
> 
> 时间：2008-12-23T18:36:23.607
> 
> 标签：iis, content-expiration

如果我将静态文件的内容到期时间设置为 14 天，并且我决定稍后更新一些文件，IIS 会知道提供更新的文件还是客户端必须等到到期日期？

或者如果修改日期不同，浏览器是否会请求新文件？

有时我更新服务器上的文件，我必须进行硬刷新 (CTRL+F5) 才能看到差异。目前我让它在 1 天后过期。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-26T13:31:43.750

Web 浏览器和任何中间代理都可以缓存页面直到其过期日期。这意味着 IIS 甚至可能不知道正在查看页面的客户端。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T18:37:48.160

你想要[ETags](http://en.wikipedia.org/wiki/HTTP_ETag)

> ETag 是由 Web 服务器分配给在 URL 中找到的特定版本资源的不透明标识符。如果该 URL 上的资源内容发生变化，则会分配一个新的不同的 ETag。以这种方式使用 ETag 类似于指纹，可以快速比较它们以确定资源的两个版本是否相同。[...]

# visual-studio - Visual Studio 附加库？

> ID：389705
> 
> 赞同：7
> 
> 时间：2008-12-23T18:37:29.067
> 
> 标签：visual-studio, add-in, visual-studio-addins, add-on

我希望为 Visual Studio 找到一些附加组件来解决一些特定的可用性问题。是否有一个 Visual Studio 插件库，其中包含每个人、公司、雅虎和 Hick 都创建的大量插件？

有点像[Vista 侧边栏小工具库](http://vista.gallery.microsoft.com/vista/SideBar.aspx)，但用于插件。

有点像[CodePlex](http://www.codeplex.com)，但用于插件。

是[Visual Studio Gallery](http://visualstudiogallery.com)吗？

* * *

并不是说这对我的问题很重要，而是我希望通过插件解决的*一些IDE 功能：*

*   选项卡按时间打开顺序放置
*   重命名控件重命名附加的事件处理程序
*   从事件处理程序中删除所有代码删除并取消挂钩事件处理程序
*   删除事件处理程序将其解开
*   将代码重新排列为私有、受保护和公共方法并分组。属性和事件被分组。私有变量被分组。
*   分析`using`棉绒
*   已剪切/粘贴的控件具有其事件处理程序功能
*   [完全](http://msdn.microsoft.com/en-us/library/dfz7zwas.aspx)支持[简要书签](http://en.wikipedia.org/wiki/Brief_(text_editor))（[找到它](http://vadikv.googlepages.com/numberedbookmarks)）
*   /// 自动添加抛出的异常
*   /// 评论在他们声明的项目上呈现

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T19:52:50.957

你可能正在寻找[这个](http://www.visualstudiogallery.com/?s_kwcid=visual%20studio%20plugins|2461732986)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T20:10:29.360

你检查过[MSDN 代码库](http://code.msdn.microsoft.com/)吗？

# c# - 为什么 SmtpClient.SendAsync 只能调用一次？

> ID：389709
> 
> 赞同：22
> 
> 时间：2008-12-23T18:38:00.233
> 
> 标签：c#, smtpclient, system.net.mail

我正在尝试使用 SmtpClient 在 .NET 中编写通知服务（用于完全合法的非垃圾邮件目的）。最初我只是遍历每条消息并发送它，但是这很慢，我想提高速度。所以，我改用“SendAsync”，但现在第二次调用时出现以下错误：

```
An asynchronous call is already in progress. 
```

我读到这意味着 MS 削弱了 System.Net.Mail 以防止群发邮件。它是否正确？如果是这样，是否有更好的方法在 .NET 中执行此操作，并且仍然能够记录每封电子邮件的结果（这对我们的客户很重要）。如果不是，为什么 SendAsync 只能被调用一次？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-23T18:43:15.683

根据[文档](http://msdn.microsoft.com/en-us/library/x5x13z6h.aspx)：

> 调用 SendAsync 后，您必须等待电子邮件传输完成，然后再尝试使用 Send 或 SendAsync 发送另一封电子邮件。

因此，要同时发送多封邮件，您需要多个 SmtpClient 实例。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-09-01T19:54:51.953

您也许可以使用以下内容：

```
ThreadPool.QueueUserWorkItem(state => client.Send(msg)); 
```

这应该允许您的消息在线程可用时排队并发送。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T18:42:27.853

显然，这不是试图阻止群发邮件。

原因是 SmtpClient 类不是线程安全的。如果您想同时发送多封电子邮件，您必须生成一些工作线程（在 .NET Framework 中有几种方法可以做到这一点）并在每个线程中创建单独的 SmtpClient 实例。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-23T18:46:31.387

我认为您误解了`XXXAsync`方法的类别。这些异步调用的目的是让程序继续运行，而不需要方法先完成处理并返回。然后，您可以稍后通过订阅`XXXReceived`对象的事件来处理结果。

要同时发送多封邮件，您可以考虑使用 more `Thread`s。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T18:43:39.130

每个 SMTP 客户端一次只能发送一个。如果您希望进行多个发送调用，请创建多个 SMTP 客户端。

高温下，

科尔比非洲

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-23T18:52:16.757

正如这里的其他人所注意到的，您一次只能发送一封电子邮件，但是在发送第一封电子邮件后发送另一封电子邮件的方法是处理 SmtpClient 类的 .SendCompleted 事件，然后继续处理下一封电子邮件并发送那个。

如果您想同时发送多封电子邮件，那么正如其他人所说，使用多个 SmtpClient 对象。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-06-12T14:46:59.810

*重用SmtpClient*是有原因的，它限制了与 SMTP 服务器的连接数。我无法为报告正在构建的每个线程实例化一个新类*SmtpClient*类，否则 SMTP 服务器将因连接错误过多而停止。这是我在这里找不到答案时想出的解决方案。

我最终使用*AutoResetEvent*来保持一切同步。这样，我可以在每个线程中继续调用我的*SendAsync*，但等待它处理电子邮件并使用*SendComplete*事件将其重置，以便下一个可以继续。

我设置了自动重置事件。

```
 AutoResetEvent _autoResetEvent = new AutoResetEvent(true); 
```

当我的类被实例化时，我设置了共享的 SMTP 客户端。

```
 _smtpServer = new SmtpClient(_mailServer);
        _smtpServer.Port = Convert.ToInt32(_mailPort);
        _smtpServer.UseDefaultCredentials = false;
        _smtpServer.Credentials = new System.Net.NetworkCredential(_mailUser, _mailPassword);
        _smtpServer.EnableSsl = true;
        _smtpServer.SendCompleted += SmtpServer_SendCompleted; 
```

然后当我调用异步发送时，我等待事件清除，然后发送下一个。

```
 _autoResetEvent.WaitOne();
        _smtpServer.SendAsync(mail, mail);
        mailWaiting++; 
```

我使用 SMTPClient SendComplete 事件来重置 AutoResetEvent，以便发送下一封电子邮件。

```
private static void SmtpServer_SendCompleted(object sender, System.ComponentModel.AsyncCompletedEventArgs e)
        {
            MailMessage thisMesage = (MailMessage) e.UserState;
            if (e.Error != null)
            {
                if (e.Error.InnerException != null)
                {
                    writeMessage("ERROR: Sending Mail: " + thisMesage.Subject + " Msg: "
                                 + e.Error.Message + e.Error.InnerException.Message);
                }

                else
                {
                    writeMessage("ERROR: Sending Mail: " + thisMesage.Subject + " Msg: " + e.Error.Message);
                }
            }
            else
            {
                writeMessage("Success:" + thisMesage.Subject + " sent.");
            }
        if (_messagesPerConnection > 20)
        {  /*Limit # of messages per connection, 
            After send then reset the SmtpClient before next thread release*/
            _smtpServer = new SmtpClient(_mailServer);
            _smtpServer.SendCompleted += SmtpServer_SendCompleted;
            _smtpServer.Port = Convert.ToInt32(_mailPort);
            _smtpServer.UseDefaultCredentials = false;
            _smtpServer.Credentials = new NetworkCredential(_mailUser, _mailPassword);
            _smtpServer.EnableSsl = true;
            _messagesPerConnection = 0;
        }
            _autoResetEvent.Set();//Here is the event reset
            mailWaiting--;
        } 
```

# .net - 如何从工具栏托盘或 wpf 中的其他控件检索点击处理程序中的发件人？

> ID：389710
> 
> 赞同：1
> 
> 时间：2008-12-23T18:38:23.213
> 
> 标签：.net, wpf, events

XAML：

```
<ToolBarTray Name="tlbTray" ButtonBase.Click="tlbTray_Click">

<ToolBar Name="tlbFile">
    <Button Name="btnOpen"><Image Source="images\folder.png" Stretch="None" /></Button>
    <Button Name="btnSave"><Image Source="images\disk.png" Stretch="None" /></Button>
</ToolBar>

</ToolBarTray> 
```

代码：

```
private void tlbTray_Click(object sender, RoutedEventArgs e)
{
  // How to get the name of the button or control that triggered the event
} 
```

如方法中所述。如何获取触发事件的按钮或控件的名称。还是我以错误的方式处理这个问题？我只想将所有点击事件路由到那个方法并决定从那里做什么......

谢谢！;-)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T19:03:28.747

好的，我找到了！

```
private void tlbTray_Click(object sender, RoutedEventArgs e)
{
  Button button = (Button)e.OriginalSource;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T18:50:41.910

在您的处理程序中使用：

```
Button test = (Button)sender;
if(test.Name=="btnOpen")
{
  //Do something
} 
```

# namespaces - 命名空间设计和类意识

> ID：389714
> 
> 赞同：3
> 
> 时间：2008-12-23T18:39:44.367
> 
> 标签：namespaces

我记得读过一次（我相信这本书是 .NET Framework 设计指南），当您设计框架或类库时，您应该注意如何在命名空间中安排类。具体来说，父命名空间中的类不应该知道子命名空间中的类。相反，子命名空间中的类知道它们上方命名空间中的类是完全可以的。

例如，**System命名空间中的类对****System.Data.SqlClient**命名空间中的类一无所知。但是，**System.Data.SqlClient**中的类知道**System**和**System.Data**中的类。

现在，从表面上看，这是一个非常简单的想法。但在某些情况下，这并不像您想象的那么容易实现。类在本质上是相互耦合的。例如：

*   商务舱
*   数据实体类
*   将数据实体类映射到业务对象类的类
*   将数据实体序列化到数据库和从数据库序列化的类

当然，您可以将它们分成单独的离散类，从而清楚地隔离数据和功能；那不是我的问题。我的问题是如何将它们正确排列到遵循命名空间最佳实践的命名空间中。

这对我来说总是有点模糊。我从未见过它被明确解决，而且我见过的大多数示例只是将数据对象放在根命名空间 (MyProject.DataObjects) 或类似的东西之外。好像没有人真正确定，所以我们只是不谈论它。

我可以看到，在 .NET Framework 本身中，类一直跨越命名空间边界来访问它们需要的功能。类经常从**System.Collections**、**System.Collections.Generic**、**System.Runtime**、**System.Configuration**、**System.Reflection**等访问功能。

就好像有一条潜规则规定，当涉及到命名空间时，“你对自己的孩子一无所知，但你可以知道关于你的祖父母、阿姨、叔叔、侄女的孩子的一切，侄子和堂兄弟。” 这条准则对我来说似乎违反直觉且毫无意义。它似乎使命名空间设计复杂化。

**所以这是问题**

您如何在自己的大型应用程序中设计命名空间？您真的关心保留命名空间边界吗？如果是这样，您如何解决类明确相关的问题（尽管已经尽可能多地解耦）？

我对您的经历以及您对此的意见非常感兴趣。它已经困扰我一段时间了。如果您可以为包含业务对象、数据实体等的 3 层应用程序提供命名空间安排的示例，那就太好了。我真的很想看看你们是如何获得命名空间模型的，以及为什么。

首先十分感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T18:50:00.570

如果您有两个紧密相关的类，您只需将它们放在同一个命名空间中。

我认为命名空间用于保存相关的类、函数、枚举等，所以这应该很自然。

Now it might be the case that some namespaces naturally build on items in other namespaces. But if two classes are so closely related as to build on each other, I'm not sure why I would even consider putting them in different namespaces. There's probably a good reason, but I've never come across it.

# c# - 使用 DataGridView C# 进行数据绑定

> ID：389737
> 
> 赞同：0
> 
> 时间：2008-12-23T18:51:48.507
> 
> 标签：c#, database, data-binding, datagridview

我有一个要在 DataGridView 中显示的数据库表。但是，它有几个外键，我不想向用户显示代表另一个表的整数。

我有这个带有 userId 列的 DataTable 我有另一个带有列 id 和列用户名的 DataTable

我希望 DataGridView 在 userId = id 的位置显示用户名而不是 userId。

我怎样才能做到这一点？我还必须在要显示的同一个表中的多个列上执行此操作。

编辑：Windows 窗体，而不是 Web 窗体。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T19:03:42.133

这里有几个可供考虑的选择...

1 - 如果您有权访问数据库，请创建一个返回“非规范化”数据的视图或存储过程。然后，您可以将 GridView 直接绑定到此，一切都完成了。

2 - 为您需要检索的那些字段创建模板列。然后在 GridView 的 RowDatabound 事件中，您可以通过编程方式调用并获取适当的查找信息并将其显示在指定的列中。您的代码将如下所示：

```
protected void FormatGridView(object sender, System.Web.UI.WebControls.GridViewRowEventArgs e)
{
   if (e.Row.RowType == DataControlRowType.DataRow) 
   {
      e.Row.Cells[1].Text = GetUserId(Convert.ToInt32(DataBinder.Eval(e.Row.DataItem, "userid"));
   }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T19:09:00.530

你是如何填充数据表的？您可以为 DataAdapter 的 .SelectCommand 指定带有连接和适当列的自定义 SQL，或者在 xxxCommand 对象的 .CommandText 中指定自定义 SQL。

例如

```
myAdapter.SelectCommand = "Select a.column1, a.column2, b.username from tablea a inner join tableb b on b.userid = a.userId" 
```

或者

```
myCommand.CommandType = Text;
myCommand.CommandText = ""Select a.column1, a.column2, b.username from tablea a inner join tableb b on b.userid = a.userId"; 
```

或者如前所述，您可以在数据库中创建一个视图或存储过程并调用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T19:02:46.317

您可以创建一个存储过程来进行所需的连接以获取用户的名称或您需要的任何字段，并将其映射到具有此信息的类并将 datagridView 绑定到`List<YourClass>`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T19:45:01.830

你用的是linq吗？
因为如果您使用的是 Linq，则可以将列的 DataPropertyName 设置为“User.UserName”，前提是您已在设计器中设置了正确的关联。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T19:40:32.053

您可以将 DataGridView 绑定到可以包含一个或多个数据表的 DataSet。第一个数据表可以使用包含 userid 列的 SELECT 语句填充。第二个数据表可以包含用户名和 ID。然后添加一个关系到数据集的关系集合，它将第一个表的用户 ID 映射到第二个表的 ID。使用数据集，创建一个新的默认视图管理器，它只显示用户名而不显示用户 ID。将 DataGridView 的数据源设置为数据集的 DefaultViewManager。

# asp.net - 是否可以检测是否从 Web 应用程序安装了 Microsoft Excel

> ID：389738
> 
> 赞同：3
> 
> 时间：2008-12-23T18:51:59.053
> 
> 标签：asp.net, javascript, excel, web-applications

我正在开发一个 Web 应用程序 (ASP.NET)，它具有一些需要在客户端上安装 Microsoft Excel 的功能。如果 Excel 不存在，我想禁用这些功能。

仅限 Windows/IE/Excel 的解决方案很好。这不是一个多浏览器、多操作系统的 Web 应用程序。

有什么聪明的 JavaScript 可以完成这个吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T18:56:32.553

不。

不允许您深入到客户端计算机以找出该部分。您可以做的最好的事情是假设它已安装，并仔细考虑如果未安装会发生什么，或者只是询问用户。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T19:05:58.617

你可以这样做，但你会收到各种安全警告：

```
<script>
var excelInstalled;
try 
{
    var excel = new ActiveXObject("Excel.Application");
    excelInstalled = true;
}
catch(e)
{
    excelInstalled = false;
}
alert("excelInstalled: " + excelInstalled);
</script> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T19:14:34.467

为什么选择 Excel？如果我有 OpenOffice.org 怎么办？

只需警告用户您要发送给他们的内容，用“Excel 文件”标记链接，然后让他决定。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-12T00:53:08.430

```
function hasOfficePlugin() {
var toCheckExt = ['', '12', '13', '14', '15'], i, n, mt;
    for (i = 0, n = toCheckExt.length; i < n; i++) {
        mt = navigator.mimeTypes['application/x-msoffice' + toCheckExt[i]];
        if (mt && mt.enabledPlugin && mt.enabledPlugin.name) {
            return true;
        }
    }
    return false;
} 
```

我已经用 Office 11 (2003) 和 Office 12 (2007) 测试了上述内容，它似乎在 Firefox、Safari、Chrome 和 Opera 中运行良好。虽然它在 IE 中不起作用，因为 IE 中的 navigator.mimeTypes 对象始终为空。

它正在检查是否存在 MS Office 插件。我对这个插件知之甚少——很可能它并不总是随office一起安装......但我认为，如果上面的结果为真，则表明安装了Excel是一个非常强烈的信号。当然它可能用途有限，因为它在 IE 中不起作用，但也许你可以用它做点什么......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T19:41:36.753

您无法使用标准技术访问 Web 浏览器上下文之外的客户端信息。但我看到答案之一是使用一些 ActivX 对象来检测 Excel。无论如何，这些技术仅适用于 Windows 上的 Internet Explorer。麦克呢？Windows 上的其他浏览器，如 opera 或 firefox 或 chrome 呢？我认为最好让用户通知您。只需询问用户是否安装了 excel：

```
var isExcel = window.confirm('dear user if you have Microsoft Excel installed please click on ok, otherwise click on cancel. thank you.'); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T19:50:31.197

这在开始时是个坏主意。无论你试图做什么 - 重新考虑。

如果你还坚持：

尝试为 Excel 和 OpenOffice 创建 ActiveXObject。如果失败，重定向到 NoExcel.html 或发送 XMLRequest 到服务器。
此外，您可以尝试通过 JavaScritp 找出是否有 XLS 文件扩展处理程序。最后，您可以安装 ActiveX，它会检查是否安装了 Excel。

这是针对窗户的。不知道 mac、linux、mobile ......你可以打赌，你让它工作的任何方式都将停止使用下一个修补程序。

# java - 什么是“继续”关键字，它在 Java 中是如何工作的？

> ID：389741
> 
> 赞同：314
> 
> 时间：2008-12-23T18:52:05.977
> 
> 标签：java, keyword, continue

我第一次看到这个关键字，我想知道是否有人可以向我解释它的作用。

*   `continue`关键字是什么？
*   它是如何工作的？
*   什么时候使用？

* * *

## 回答 #1

> 赞同：527
> 
> 时间：2008-12-23T18:54:47.237

`continue`有点像`goto`。你熟悉`break`吗？相比之下更容易考虑它们：

*   `break`终止循环（跳转到它下面的代码）。

*   `continue`终止当前迭代的循环内代码的其余处理，但继续循环。

* * *

## 回答 #2

> 赞同：424
> 
> 时间：2008-12-23T18:53:30.420

不带标签的语句将从最内层或循环的条件以及最内层循环的更新表达式`[continue](https://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.16)`重新执行。它通常用于提前终止循环的处理，从而避免深度嵌套的语句。在下面的示例中将获取下一行，而不处理循环中的以下语句。`while``do``for``if``continue`

```
while (getNext(line)) {
  if (line.isEmpty() || line.isComment())
    continue;
  // More code here
} 
```

带有标签的，`continue`会从带有对应标签的循环中重新执行，而不是最里面的循环。这可以用来逃避深度嵌套的循环，或者只是为了清楚起见。

有时`continue`也用作占位符，以使空循环体更清晰。

```
for (count = 0; foo.moreData(); count++)
  continue; 
```

C 和 C++ 中也存在相同的不带标签的语句。Perl 中的等价物是`next`.

不建议使用这种类型的控制流，但如果您愿意，您也可以使用`continue`模拟有限形式的`goto`. 在以下示例中，`continue`将重新执行空`for (;;)`循环。

```
aLoopName: for (;;) {
  // ...
  while (someCondition)
  // ...
    if (otherCondition)
      continue aLoopName; 
```

* * *

## 回答 #3

> 赞同：104
> 
> 时间：2008-12-23T18:56:53.677

让我们看一个例子：

```
int sum = 0;
for(int i = 1; i <= 100 ; i++){
    if(i % 2 == 0)
         continue;
    sum += i;
} 
```

这将得到从 1 到 100 的奇数之和。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2008-12-23T19:00:30.377

如果您将循环体视为子例程，`continue`则有点像`return`. C 中存在相同的关键字，并且具有相同的目的。这是一个人为的例子：

```
for(int i=0; i < 10; ++i) {
  if (i % 2 == 0) {
    continue;
  }
  System.out.println(i);
} 
```

这将只打印出奇数。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-12-23T23:18:08.080

通常，我将`continue`(and ) 视为代码*可能*`break`使用一些重构的警告，尤其是在or循环声明不是立即可见的情况下。在方法的中间也是如此，但原因略有不同。*`while``for``return`*

 *正如其他人已经说过的那样，`continue`移动到循环的下一个迭代，同时`break`移出封闭循环。

`continue`这些可能是维护定时炸弹，因为/`break`和它正在继续/中断的循环之间除了上下文之外没有直接的链接；添加一个内部循环或将循环的“胆量”移动到一个单独的方法中，你就有了`continue`/`break`失败的隐藏效果。

恕我直言，最好将它们用作最后​​的手段，然后确保它们的使用在循环的开始或结束时紧密组合在一起，以便下一个开发人员可以在一个屏幕中看到循环的“边界” .

`continue`, `break`, 和`return`（除了方法末尾的 One True Return 之外）都属于“隐藏 GOTO”的一般类别。他们将循环和函数控制放在意想不到的地方，这最终会导致错误。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2017-12-19T15:08:33.300

Java 中的“continue”表示转到当前循环的结尾，意思是：如果编译器在循环中看到 continue，它将转到下一次迭代

示例：这是打印从 1 到 10 的奇数的代码

每当编译器看到继续进入下一次迭代时，它都会忽略打印代码

```
for (int i = 0; i < 10; i++) { 
    if (i%2 == 0) continue;    
    System.out.println(i+"");
} 
```

* * *

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-03-22T18:51:15.970

如前所述`continue`，将跳过处理它下面的代码，直到循环结束。然后，如果该条件仍然成立（或者如果有标志，则转到指定循环的条件），您将移至**循环的条件并运行下一次迭代。**

必须强调的是，如果`do - while`您在 a 之后移动到底部的条件`continue`，而不是在循环的开头。

这就是为什么很多人无法正确回答以下代码将生成的内容的原因。

```
 Random r = new Random();
    Set<Integer> aSet= new HashSet<Integer>();
    int anInt;
    do {
        anInt = r.nextInt(10);
        if (anInt % 2 == 0)
            continue;
        System.out.println(anInt);
    } while (aSet.add(anInt));
    System.out.println(aSet); 
```

*如果你的答案是`aSet`只包含 100% 的奇数......你错了！

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-04-19T09:19:37.250

**Continue**是 Java 中的一个*关键字*，用于跳过当前迭代。

假设您要打印从 1 到 100 的所有奇数

```
public class Main {

    public static void main(String args[]) {

    //Program to print all odd numbers from 1 to 100

        for(int i=1 ; i<=100 ; i++) {
            if(i % 2 == 0) {
                continue;
            }
            System.out.println(i);
        }

    }
} 
```

**上面程序中的continue语句只是在****i**为偶数时跳过迭代，并在 i 为奇数时打印**i**的值。

**Continue**语句只是将您带出循环，而不执行循环内的剩余语句并触发下一次迭代。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-08-29T16:11:06.540

考虑一个 If Else 条件。continue 语句执行条件中的内容并退出条件，即跳转到下一个迭代或条件。但是 Break 离开了循环。考虑以下程序。'

```
public class ContinueBreak {
    public static void main(String[] args) {
        String[] table={"aa","bb","cc","dd"};
        for(String ss:table){
            if("bb".equals(ss)){
                continue;
            }
            System.out.println(ss);
            if("cc".equals(ss)){
                break;
            }
        }
        System.out.println("Out of the loop.");
    }

} 
```

它将打印： aa cc Out of the loop。

如果你使用 break 代替 continue(After if.)，它只会*打印 aa 和 out of the loop*。

如果满足条件“bb”等于 ss： For Continue：进入下一次迭代，即“cc”.equals(ss)。对于Break：它退出循环并打印“Out of the loop”。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-03-22T07:05:31.920

当您需要立即跳转到循环的下一次迭代时，在循环控制结构中使用 continue 语句。

它可以与 for 循环或 while 循环一起使用。Java continue 语句用于继续循环。它继续程序的当前流程并在指定条件下跳过剩余的代码。

在内部循环的情况下，它仅继续内部循环。

我们可以在所有类型的循环中使用 Java continue 语句，例如 for 循环、while 循环和 do-while 循环。

例如

```
class Example{
    public static void main(String args[]){
        System.out.println("Start");
        for(int i=0; i<10; i++){
            if(i==5){continue;}
            System.out.println("i : "+i);   
        }
        System.out.println("End.");
    }
} 
```

输出：

```
Start
i : 0
i : 1
i : 2
i : 3
i : 4
i : 6
i : 7
i : 8
i : 9
End. 
```

【5号跳过】

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-12-21T23:38:41.347

*我参加聚会有点晚了，但是...*

值得一提的`continue`是，这对于所有工作都在控制循环的条件表达式中完成的空循环很有用。例如：

```
while ((buffer[i++] = readChar()) >= 0)
    continue; 
```

在这种情况下，读取字符并将其附加到的所有工作都在控制循环`buffer`的表达式中完成。`while`该`continue`语句用作循环不需要主体的视觉指示符。

它比等价的更明显：

```
while (...)
{ } 
```

并且绝对比使用空语句更好（更安全）的编码风格，例如：

```
while (...)
    ; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-10-22T13:38:47.527

基本上在java中， continue 是一个语句。continue 语句根据特定条件跳转到循环的下一次迭代。

continue 语句通常与循环一起使用以跳过当前迭代。有关如何以及何时在 java 中使用它，请参阅下面的链接。

[https://www.flowerbrackets.com/continue-statement-java/](https://www.flowerbrackets.com/continue-statement-java/)

希望能帮助到你 ！！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-09-15T14:51:38.740

`continue`必须在循环内，否则会显示如下错误：

> 在循环外继续

# javascript - 在 jquery ui date-picker 中如何允许选择特定的工作日并禁用其他工作日

> ID：389743
> 
> 赞同：4
> 
> 时间：2008-12-23T18:52:37.617
> 
> 标签：javascript, jquery, jquery-ui, datepicker, jquery-ui-datepicker

我需要将 jquery ui 日期选择器限制为仅将未来的星期二和星期四作为可选日期。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-05-23T13:11:41.857

这一切都在文档中。beforeShowDay 函数会做你想做的事。

[http://api.jqueryui.com/datepicker/#option-beforeShowDay](http://api.jqueryui.com/datepicker/#option-beforeShowDay)

我的使用是不同的日子，但我最终在 beforeShowDay 调用我的 limitdays 函数

```
function limitDays(date){

var day = date.getDay();

  // Only make Mon, Tues, and Thurs selectable
  if(day == 1 || day == 2 || day == 4){
    return [true, ''];
  }else{
    return [false, ''];
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T18:57:39.273

为日期选择器提供一个 onSelect 处理程序，并让您的处理程序验证日期是否符合您定义的标准。我不确定 onSelect 在哪里触发，因此如果您无法停止事件并提醒用户，您可能会“撤消”选择。

一种方法是开发一个自定义日期验证器类，该类接受参数，然后从 onSelect 函数调用该日期验证器。onSelect 函数可以处理与日期选择器本身的交互以保持设计简洁。

来自[http://docs.jquery.com/UI/Datepicker/datepicker#options](http://docs.jquery.com/UI/Datepicker/datepicker#options)

```
$("div.selector").datepicker({ 
  onSelect: function(dateText) { 
    alert(dateText);
  } 
}) 
```

要更改特定日期或日期集的显示和可选择性，请使用 beforeShowDay 处理程序并让它更改相关日期的可选择性和 CSS。

```
$(".selector").datepicker({ beforeShowDay: nationalDays})   

natDays = [
  [1, 26, 'au'], [2, 6, 'nz'], [3, 17, 'ie'],
  [4, 27, 'za'], [5, 25, 'ar'], [6, 6, 'se'],
  [7, 4, 'us'], [8, 17, 'id'], [9, 7, 'br'],
  [10, 1, 'cn'], [11, 22, 'lb'], [12, 12, 'ke']
];

function nationalDays(date) {
    for (i = 0; i < natDays.length; i++) {
      if (date.getMonth() == natDays[i][0] - 1
          && date.getDate() == natDays[i][1]) {
        return [false, natDays[i][2] + '_day'];
      }
    }
  return [true, ''];
} 
```

# svn - 使用 post commit hook 在 VisualSVN Server 中导出

> ID：389759
> 
> 赞同：7
> 
> 时间：2008-12-23T18:57:57.730
> 
> 标签：svn, export, visualsvn-server, post-commit

在开发人员提交更改后，使用 VisualSVN Server 的提交后挂钩从存储库导出到目录以进行暂存/测试的最简单方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-01-20T20:17:31.160

在**VisualSVN 服务器管理器**MMC 控制台中执行以下操作：

1.  选择您的**存储库**

2.  右键单击**属性**

3.  选择**挂钩**选项卡

4.  选择**提交后挂钩**

5.  单击**编辑**按钮。**在文本框中**输入这样的一行：

    ```
    "%VISUALSVN_SERVER%bin\svn.exe" export https://svn.yourserver.com:4433/svn/YourRepository/Websites/YourWebsite/ C:\inetpub\wwwroot\YourWebsite --quiet --non-interactive --force --username <youruser> --password <yourpassword> 
    ```

6.  单击**确定**。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T10:45:52.420

1.  找到你的 SVN 服务器安装目录（我有`C:\Program Files\VisualSVN Server\bin`）。

2.  将一个可执行文件或批处理文件放入其中，然后将 post-commit 挂钩设置为如下所示：

    `postcommit.exe "%1" "%2"`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T20:25:38.440

如果您安装[svn 命令行客户端](http://subversion.apache.org/packages.html#windows)，您可以编写一个简单的提交后挂钩脚本，如下所示：

```
path\to\svn.exe export file:///%1/trunk path\to\where\you\want\to\export\to 
```

我不确定 VisualSVN 服务器提交挂钩对话框是创建`.bat`/`.cmd`文件还是只是希望运行该命令。如果是第一个，上面的行就足够了。如果是后者，首先创建一个`.bat`包含上述行的文件，然后在对话框中输入：

```
cmd.exe /C path\to\your\batfile 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T19:49:57.983

将阅读有关 Cruise Control 与 Subversion 集成的信息——我首先听说过它，但我确实讨厌在其中加入另一个变量。

在发布问题之前查看了 VisualSVN 链接，但它没有解释除了电子邮件通知之外如何使用 VisualSVNServerHooks.exe 做任何事情。不禁想知道这是否是 VisualSVNServerHooks.exe 支持的唯一功能，因为我无法在他们的网站、文档、谷歌群组、谷歌搜索等上找到任何其他功能的文档。

感谢您发布。

# vb.net - 确定当前时间是上午还是下午的最简单方法？

> ID：389761
> 
> 赞同：3
> 
> 时间：2008-12-23T18:58:29.383
> 
> 标签：vb.net, datetime

使用 VB.NET 确定当前时间是上午还是下午的最佳方法是什么？

目前我正在使用 If Date.Today.ToString.Contains("AM") 但我确信有更好的方法。

```
Good <%If Date.Today.ToString.Contains("AM") Then Response.Write("Morning") Else Response.Write("Afternoon")%> 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-23T19:01:13.557

`If Date.Now.Hour < 12 Then`... 也许？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T19:11:38.077

```
Now.ToString("t") == "A" //or //"P" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T19:03:02.727

这个怎么样：

```
Now.Hour > 17 ' Night
Now.Hour < 5  ' Day 
```

高温高压

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-26T15:06:07.697

下午检查需要 <= 否则在 17 小时 str nevers 被设置

```
dim hours as int = DateTime.Now.Hour
dim str as string
if hours < 12 Then
    str = "Morning"
else if hours <= 17 then
    str = "Afternoon"
else if hours > 17 then
    str = "Evening"
End If 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T19:13:48.353

这个怎么样：

```
dim hours as int = DateTime.Now.Hour
dim str as string
if hours < 12 Then
    str = "Morning"
else if hours < 17 then
    str = "Afternoon"
else if hours > 17 then
    str = "Evening"
End If 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-11T18:40:36.880

```
Private Function IsMidnight(ByVal value As DateTime) As Boolean
    Return value.Hour = 0 And _
        value.Minute = 0 And _
        value.Second = 0 And _
        value.Millisecond = 0
End Function 
```

用法：

```
Dim isAM as Boolean = (IsMidnight(current) Or current.Hour < 12) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-11-25T08:05:42.043

```
Dim dateValue = Dtp.Value.ToString()
If dateValue.EndsWith("AM") Then
   MsgBox("Its AM")
Else
   MsgBox("Its PM")
End If 
```

你可以做这样的事情。

# c# - 如何在 VS2005 上安装 CodeRush Xpress

> ID：389763
> 
> 赞同：4
> 
> 时间：2008-12-23T19:00:05.230
> 
> 标签：c#, visual-studio-2005, coderush-xpress

我知道[CodeRush Xpress](http://www.devexpress.com/Products/Visual_Studio_Add-in/CodeRushX/)旨在用于 VS 2008 而不是 VS 2005。
但由于我还不能迁移到 VS2008，所以我想将它安装在 VS2005 上并且不在乎它不应该工作。

我的基本假设是它可以完成，这是基于 DevExpress 的其余免费重构产品在 VS 2005 上工作的事实。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-25T14:58:10.403

这是可能的，在这里你需要做什么。

确保 VS 已关闭。
安装[RefactorCpp](http://devexpress.com/Products/Visual_Studio_Add-in/RefactorCPP/)。
安装[CodeRush Xpress](http://www.devexpress.com/Products/Visual_Studio_Add-in/CodeRushX/)。
应用此注册表补丁：

```
Windows Registry Editor Version 5.00
[HKEY_LOCAL_MACHINE\SOFTWARE\Developer Express]
[HKEY_LOCAL_MACHINE\SOFTWARE\Developer Express\CodeRush for VS\3.2]
    "HideMenu"=dword:00000000
    "LoadDXPlugInsOnly"=dword:00000000
    "StatusTextEnabled"=dword:00000001 
```

打开VS。
在 Visual Studio 中启用“DevExpress Tools”插件，工具 -> 插件管理器。检查启用和启动复选框。

现在您是 VS 2005 上 CodeRush Xpress 的骄傲用户。

PS 这适用于我：
Microsoft Visual Studio 2005 版本 8.0.50727.762 (SP.050727-7600)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T13:33:42.143

通知不好！

这是不可能的，因为该插件适用于 .NET Framework 3 和 Visual Studio 2008 aka Orcas。

我尝试在 Visual Studio 2005 中安装但不成功。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T11:58:35.130

昨天，我能够在 Refactor 的基础上在 VS 2005 上安装 CodeRush Xpress！没有此注册表黑客的 Pro。但是，这是 CodeRush Xpress 3.2.3（加上 Refactor！Pro 3.2.3），我知道 CodeRush Xpress 的初始版本不能与 Refactor 一起安装！这已在 3.2.3 中修复。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T11:34:38.297

我认为在您安装 Refactor 之前，这个 hack 不会起作用（加载项管理器中没有 CodeRush）！

# c# - LINQ 查询 - 需要解释为什么这些示例不同

> ID：389767
> 
> 赞同：8
> 
> 时间：2008-12-23T19:01:46.410
> 
> 标签：c#, linq, scope

我正在阅读“LINQ Pocket Reference”一书，有一个特定的示例（下面稍作修改）我很难理解......书中的解释有点简短，所以我想知道是否有人可以为我一步一步地分解它，这样它才有意义......

```
 IEnumerable<char> query2 = "Not what you might expect";
    foreach (char vowel in "aeiou")
    {
        var t = vowel;
        query2 = query2.Where(c => c != t);
        // iterate through query and output (snipped for brevity)
    } 
```

输出这个：

```
    不是你所期望的
    不是你可能的 xpct
    不是你想的 xpct
    Nt wht yu mght xpct
    Nt wht y mght xpct

```

这对我来说很有意义......但是，这不是。

```
 IEnumerable<char> query2 = "Not what you might expect";
    foreach (char vowel in "aeiou")
    {
        query2 = query2.Where(c => c != vowel);
        // iterate through query and output (snipped for brevity)
    } 
```

```
    不是你所期望的
    不是你可能的 xpct
    不是你所期望的
    Nt你可能期望什么
    不是你所期望的

```

这不...

有人可以更好地解释这里到底发生了什么吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-23T19:08:38.910

第一个示例发生的情况是 vowel 的值被捕获到本地（在 for 循环的范围内）变量中。

然后，查询的 where 子句将使用该捕获的变量。像这样的 where 子句使用匿名方法/lambda 方法，它可以捕获局部变量。然后发生的是它捕获变量的当前值。

然而，在第二个类中，它不捕获当前值，只捕获要使用的变量，因此由于这个变量发生了变化，每次执行循环时，都会在最后一个之上构建一个新的 Where 子句，但是由于您更改了变量，因此您还需要修改所有前面的内容。

所以在第一个例子中，你得到了这种类型的查询：

```
IEnumerable<char> query2 = "Not what you might expect";
Char t1 = 'a'; query2 = query2.Where(c => c != t1);
Char t2 = 'e'; query2 = query2.Where(c => c != t2);
Char t3 = 'i'; query2 = query2.Where(c => c != t3);
Char t4 = 'o'; query2 = query2.Where(c => c != t4);
Char t5 = 'u'; query2 = query2.Where(c => c != t5); 
```

在第二个例子中，你得到这个：

```
IEnumerable<char> query2 = "Not what you might expect";
Char vowel = 'a'; query2 = query2.Where(c => c != vowel);
vowel = 'e'; query2 = query2.Where(c => c != vowel);
vowel = 'i'; query2 = query2.Where(c => c != vowel);
vowel = 'o'; query2 = query2.Where(c => c != vowel);
vowel = 'u'; query2 = query2.Where(c => c != vowel); 
```

当您执行第二个示例时， 的值`vowel`将是 'u'，因此只有 u 将被删除。但是，您有 5 次循环在同一字符串上删除“u”，但当然只有第一个会这样做。

这种对变量的捕获是我们在使用匿名方法/lambda 时都会遇到的事情之一，您可以在此处阅读更多相关信息：[C# In Depth: The Beauty of Closures](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)。

如果您向下浏览该页面到**Comparing capture strategy: complex vs power**下的文本，您会发现这种行为的一些示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T19:09:04.307

其实，重读一遍，是有道理的。使用 temp 变量意味着在查询中捕获 temp 本身......我们正在评估循环五次，因此每个查询版本都有五个实例化的 temp 变量引用。

在没有 temp 变量的情况下，只有对循环变量的引用。

所以五个参考对一个参考。这就是为什么它会产生如图所示的结果。

在第一种情况下，一旦完全评估了循环，查询就使用了对临时变量的五个引用，因此分别删除了 a、e、i、o 和 u。

在第二种情况下，它做同样的事情......只有所有五个引用都指向同一个变量，显然只包含一个值。

故事的寓意：思考“参考”而不是“价值”。

那么，这对现在其他人有意义吗？

# c++ - 我应该使用静态数据成员吗？(C++)

> ID：389779
> 
> 赞同：5
> 
> 时间：2008-12-23T19:07:22.500
> 
> 标签：c++, variables, static, static-members

让我们考虑一个 C++ 类。在执行开始时，我想从 XML 文件中读取一组值并将它们分配给此类的 7 个数据成员。这些值在整个执行过程中不会改变，它们必须由相关类的所有对象/实例共享。静态数据成员是实现此行为的最优雅方式吗？（当然，我不考虑全局变量）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T19:31:50.750

正如其他人所提到的，在这种情况下使用静态成员似乎是合适的。请记住，这不是万无一失的；全局数据的一些问题适用于静态成员：

*   您无法控制静态成员的初始化顺序，因此您需要确保没有全局变量或其他静态变量引用这些对象。有关更多详细信息以及避免此问题的一些提示，请参阅[此 C++ 常见问题解答。](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.12)
*   如果您在多线程环境中访问这些，则需要确保在生成任何线程之前成员已完全初始化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T19:11:15.020

听起来对我来说很好地使用了静态变量。您更多地将这些用作固定参数而不是变量，并且合法地需要共享这些值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-23T19:13:56.573

静态成员可以在这里工作并且完全可以接受。另一种选择是对包含这些成员的类使用[单例模式](http://en.wikipedia.org/wiki/Singleton_pattern)，以确保它们只被构造/设置一次。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-23T22:25:16.470

这不是一个干净的设计。静态类成员是全局状态，[全局状态是坏的](http://misko.hevery.com/2008/08/25/root-cause-of-singletons/)。

如果这是一个中小型项目并且您对自动测试没有很高的目标，这可能不会给您带来麻烦，但是既然您问：有更好的方法。

更简洁的设计是为该类创建一个工厂，并让工厂在构造它时将您的七个变量传递给该类。然后工厂负责确保所有实例共享相同的值。

这样，您的课程就可以测试了，并且您已经正确地分离了您的关注点。

PS。[也](http://c2.com/cgi/wiki?SingletonsAreEvil)[不要](http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/) [使用](http://code.google.com/p/google-singleton-detector/wiki/WhySingletonsAreControversial) [单例](http://www-128.ibm.com/developerworks/webservices/library/co-single.html) 。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T19:41:53.663

听起来像是对静态类成员的适当使用。只是不要忘记它们实际上是具有命名空间和（也许）一些保护的全局变量。因此，如果您的应用程序有朝一日可能会演变出单独的“环境”或需要为每个环境设置一组这些全局变量的东西，那么您就会把自己画到一个角落里。

正如 Rob 所建议的，考虑使用单例，这在以后更容易变成某种托管环境变量。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-24T09:03:58.940

> **在执行开始时，我想从 XML 文件中读取一组值**并将它们分配给此类的 7 个数据成员。这些值在整个执行过程中不会改变，它们必须由相关类的所有对象/实例共享。

粗体字是这里的关键。只要该语句成立，就可以使用静态变量。这将如何执行？

很难。因此，如果您现在使用该声明始终正确，请继续。如果您希望将来的某个开发人员（或您）使用您的类错误（例如在程序中途读取另一个 XML 文件），那么请执行 Rasmus Farber 所说的类似操作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T23:21:24.843

是的，静态数据成员就是您要寻找的。但是您必须注意静态变量的初始化/销毁顺序。C++ 中没有机制可以确保在跨翻译单元使用静态变量之前对其进行初始化。为了安全起见，请使用看起来像单例模式并且众所周知可以解决该问题的模式。它之所以有效，是因为：

1.  所有静态对象都是在任何 xml_stuff 实例完整构造之后完整构造的。
2.  C++ 中静态对象的销毁顺序与它们的构造完成（当它们的构造函数完成执行时）完全相反。

代码：

```
class xml_stuff {
public:
    xml_stuff() {
        // 1\. touch all members once
        // => 2\. they are created before used
        // => 3\. they are created before the first xml_stuff instance
        // => 4\. they will be destructed after the last xml_stuff instance is 
        //       destructed at program exit.
        get_member1();
        get_member2();
        get_member3();
        // ...
    }  

    // the first time their respective function is called, these
    // objects will be created and references to them are returned.
    static type1 & get_member1() { static type1 t; return t; }
    static type2 & get_member2() { static type2 t; return t; }
    static type1 & get_member3() { static type1 t; return t; }
    // ... all other 7 members
}; 
```

现在， xml_stuff::get_memberN() 返回的对象在任何 xml_stuff 实例的整个生命周期内都是有效的，因为这些成员中的任何一个都是在任何 xml_stuff 实例之前构造的。使用纯静态数据成员，您无法确保这一点，因为跨翻译单元的创建顺序在 C++ 中未定义。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T22:48:20.370

只要您考虑可测试性，并且除了读取文件之外，您还有另一种设置静态变量的方法，而且您不依赖于整个过程执行时间不变的数据 - 您应该没问题。

我发现在设计代码时考虑编写测试有助于保持代码的良好分解和可重用性。

# html - z-index 的行为不像我预期的那样

> ID：389788
> 
> 赞同：5
> 
> 时间：2008-12-23T19:11:51.197
> 
> 标签：html, css, z-index

所以我有这个，大致：

```
<div id="A">
    <ul>
        <li id="B">foo</li>
    </ul>
</div>
<div id="C">
    ...
</div> 
```

它们的位置使 B 和 C 重叠。

A 有一个`z-index`，`90`B 有一个`z-index`，`92`C 有一个`z-index`。`91`但是C出现在B面前。我做错了什么？（如果需要更多细节，请告诉我。）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-23T19:22:41.470

使用`z-index`仅与同一容器中的元素相关。由于 B 包含在 A 中，因此 B 的 z-index 仅适用于解析 A 中的其他元素。就 C 而言，B 和 A 都在 z-index 90 处呈现。但是，如果将 C 放在 A 中，则 B会在前面渲染。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T06:30:44.800

如果一个元素没有 position:relative / position:absolute / position:fixed 样式，则它的 position:static 是所有元素的默认位置样式。

**对于 position:static 的元素，z-index 根本不起作用。**浏览器将按 xml 元素的顺序呈现堆栈并忽略 z-index 属性。

对于这样的情况，您必须添加位置：相对于所有 3 个元素，A、B、C。

要了解有关 z-index 和 CSS 堆叠的更多信息，请访问此处：[http ://www.tjkdesign.com/articles/z-index/teach_yourself_how_elements_stack.asp](http://www.tjkdesign.com/articles/z-index/teach_yourself_how_elements_stack.asp)

# asp.net - 无法获取要发布的 ASP.NET MVC 表单

> ID：389789
> 
> 赞同：1
> 
> 时间：2008-12-23T19:11:53.457
> 
> 标签：asp.net, asp.net-mvc

我在将表单发布到控制器中的 Save 方法时遇到问题。我是 MVC 的新手，并遵循了几个示例来尝试使其正常工作。这是我的 html 标记：

```
 <form action="Edit/Save" method="post">
        <fieldset>
            <legend>Personal Information</legend>

            <table class="editGrid">
                <tr>
                    <td><label for="txtFirstName">First Name:</label></td>
                    <td><input type="text" id="txtFirstName" value="<%=user.FirstName %>" name="FirstName" /></td>                    
                </tr>
                <tr>
                    <td><label for="txtLastName">Last Name:</label></td>
                    <td><input type="text" id="txtLastName" value="<%=user.LastName %>" name="LastName" /></td>                    
                </tr>
                <tr>
                    <td><label for="txtNtLogin">NT Login:</label></td>
                    <td><input type="text" id="txtNtLogin" value="<%=user.NtLogin %>" name="NtLogin" /></td>                   
                </tr>
                <tr>
                    <td><label for="txtHireDate">Hire Date:</label></td>
                    <td><input type="text" id="txtHireDate" value="<%=string.Format("{0:d}",user.HireDate) %>" name="HireDate" /></td>               
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Job Information</legend>

            <table class="editGrid">
                <tr>
                    <td><label for="CostCenters">Cost Center:</label></td>
                    <td><%=Html.DropDownList("CostCenters")%></td>
                </tr>
                <tr>
                    <td><label for="Managers">Manager:</label></td>
                    <td><%=Html.DropDownList("Managers")%></td>
                </tr>
                <tr>
                    <td><label for="Responsibilities">Responsibility:</label></td>
                    <td><%=Html.DropDownList("Responsibilities")%></td>
                </tr>
                <tr>
                    <td><label for="Departments">Department:</label></td>
                    <td><%=Html.DropDownList("Departments")%></td>                        
                </tr>
                <tr>
                    <td><label for="Active">Active:</label></td>
                    <td><%=Html.CheckBox("Active",user.Active) %></td>
                </tr>
                <tr>
                    <td><label for="txtHireDate">Hire Date:</label></td>
                    <td><%=Html.TextBox("txtHireDate",string.Format("{0:d}",user.HireDate)) %></td>
                </tr>
                <tr>
                    <td><label for="txtReleaseDate">Release Date:</label></td>
                    <td><%=Html.TextBox("txtReleaseDate",string.Format("{0:d}",user.ReleaseDate)) %></td>
                </tr>
            </table>
        </fieldset>
        <input type="submit" value="Save Changes" />    
</form> 
```

此表单路由到我的 EditController 中的 Save 方法。这是我的 EditController 的 Save 方法的代码：

```
 public class EditController : Controller
    {

        public ActionResult Save()
        {
//Save code goes here
          } 
```

我尝试过使用 html 表单标签，以及 Html 帮助代码：

```
using (Html.BeginForm("Save", "Edit")) 
```

这是 Global.asax 文件中我的 RegisterRoutes 方法中的条目：

```
 routes.MapRoute("EditSave", "{controller}/Save",
                    new { controller = "Edit", action = "Save" }); 
```

无论我做什么，提交按钮都不会触发 Save 方法。然而，如果我手动输入 URL，代码会直接进入 Save 方法。

编辑：根据 Craig Stuntz 的评论，我检查了页面的来源。该页面实际上包含 2 个表单，虽然只有 1 个是我自己在页面上编码的：这是出现在我的表单标记之前的 HTML：

```
<form name="aspnetForm" method="post" action="44" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUJNjM3OTAyNTUzZGQrHhVn9+t78aHxN0vHvKUJ8DQWlQ==" />
</div>

                <div id="nav">
                    <span id="navLinks">
                        <a href="#">Placeholder Link</a>
                    </span>
                    <span id="userName">
                        <span id="ctl00_lblUserName" class="UserName">Welcome, Test User</span>
                    </span> 
                </div> 

                <div id="Content">

    <div id="formContainer">

            <form action="Edit/Save" method="post"> 
```

我认为 MVC 不会生成视图状态或其他表单标签。我正在使用来自同一控制器的另一种方法提取数据并将其填充到此表单中。我在这里做错了吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T19:52:29.977

好的，得到了​​答案。感谢 Craig 让我再次查看 HTML！我的母版页在我不知情的情况下在其中生成了一个表单标签，因此我基本上在同一页面上嵌套了表单。从母版页中删除表单后，一切正常。

# linq-to-sql - LinqToSQl 并以集中的方式从 linq 适应域对象

> ID：389792
> 
> 赞同：0
> 
> 时间：2008-12-23T19:13:02.130
> 
> 标签：linq-to-sql, object, dns, adaption

想象一下下面的代码：

```
return from a in DBContext.Acts
       join artist in DBContext.Artists
       on a.ArtistID equals artist.ID into art
       from artist in art.DefaultIfEmpty()
       select new Shared.DO.Act {
                 ID = a.ID,
                 Name = a.Name,
                 Artist = new Shared.DO.Artist   {
                             ID = artist.ID,
                             Name = artist.Name
                          },
                 GigId = a.GigID
              }; 
```

可以看到，linqtosql 生成的act 对象被适配成Shared.DO.Act 对象。作为其中的一部分，linqtosql 生成的 Artist 对象被改编为 Shared.DO.Artist

在我的代码库的其他地方，我可能想要请求艺术家（见下文）：

```
return from a in DBContext.Artists
       select new Shared.DO.Artist {
                 ID = artist.ID, 
                 Name = artist.Name
              },
              GigId = a.GigID
       }; 
```

这意味着艺术家的适应代码现在出现在两个地方！一次是在获得艺术家时，也是在加载行为时

我应该如何集中这个适配代码？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-07-18T16:32:36.157

我会使用带有艺术家字典的 Artists 类来做到这一点：

```
public class Artists
{
    // key should be whatever type artist.ID is
    private Dictionary<int, Shared.DO.Artist> _artistDictionary;

    public static Get(int id)
    {
        if (_artistDictionary == null) 
            _artistDictionary = new Dictionary<int, Shared.DO.Artist>();

        if (!_artistDictionary.ContainsKey(id))
        {
            var artist = from a in DBContext.Artists
                         on a.ID equals id
                         select new Shared.DO.Artist {
                             ID = a.ID, 
                             Name = a.Name
                         };

            _artistDictionary.Add(id, artist);
        }

        return _artistDictionary[id];
    }
} 
```

# c++ - GCC 模板问题

> ID：389797
> 
> 赞同：8
> 
> 时间：2008-12-23T19:14:24.357
> 
> 标签：c++, templates, gcc

Visual Studio 可以很好地编译这段代码，但 gcc 只允许它在没有模板运算符的情况下编译。使用 Template 运算符，它会给出以下错误：

第 29 行：错误：预期的 `;' 在“itrValue”之前

```
class Test
{
  public:

  Test& operator<<(const char* s) {return *this;} // not implemented yet
  Test& operator<<(size_t      s) {return *this;} // not implemented yet

  Test& operator<< (const std::list<const char*>& strList)
  {
    *this << "count=" << strList.size() << "(";

    for (std::list<const char*>::const_iterator itrValue = strList.begin();
         itrValue != strList.end(); ++itrValue)
    {
        *this << " " << *itrValue;
    }

    *this << ")";

    return *this;
  }

  template <class T>
  Test& operator<< (const std::list<T>& listTemplate)
  {
    *this << "count=" << listTemplate.size() << "(";

    // this is line 28, the next line is the offending line
    for (std::list<T>::const_iterator itrValue = listTemplate.begin();
         itrValue != listTemplate.end(); ++itrValue)
    {
        *this << " " << *itrValue;
    }

    *this << ")";

    return *this;
  }
}; 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-23T19:21:32.517

GCC是对的，const_iterator是一个类型，并且模板依赖于模板运算符<<，你需要告诉编译器它是一个类型而不是一个变量：

```
typename std::list<T>::const_iterator 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T20:52:01.807

要完成正确的@Pieter 答案，请提供有关如何处理模板的更多信息。首先，模板只在它们被实例化时才被编译，所以如果你不为给定的类型实例化模板，那么代码将永远不会被编译。

现在，当您实例化模板时，模板代码有两步验证。首先，无论实例化类型是什么，都会验证模板的正确性。用一个更容易理解的例子来检查：

```
#include "a.h"

template <typename T> void f( T const & )
{
   T::type x;     // is T::type a type?
};

int main()
{
   A a;
   f( a );
} 
```

在第一阶段，检查模板的语法正确性，而不考虑 A 的真正含义。此时，语法 A::type 可以是名称为 'type' 的类型，也可以是同名的静态变量。

```
struct A { // version 1
    typedef int type;
};

struct A { // version 2
    static std::string type;
};
std::string A::type = "A"; 
```

在第一种情况下，type 确实是一种类型，而在第二种情况下则不是。现在标准规定，如果它真的是一个类型，那么模板的程序员必须这样声明，以用上面的语法通知编译器：

```
template <typename T> void f( T const & a )
{
    typename T::type x; // define a variable x of type T::type
} 
```

现在，为了完成处理，编译器必须检查模板代码不仅本身正确，而且当它用特定类型 T 实例化时它也是正确的。这是编译器在验证的第二阶段执行的操作。它应用类型并重新检查错误。

在您的情况下，它更具争议性，因为*每个人*（除了编译器）都知道 std::list::const_iterator 是任何给定 T 的类型。好吧，它不需要。从语言的角度来看，一些代码可以为特定的数据类型 T 提供与通用列表模板不同的模板特化。编译器无法知道是否会这样。

请注意，将 std 命名空间中的模板专门化为会改变行为的东西就像重新定义迭代器类型一样是非常错误的。但是编译器将 std 命名空间视为任何其他命名空间，并将列表视为任何其他模板化类。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T22:08:02.043

我认为值得告诉你其他消歧义。因为我已经[在这里](https://stackoverflow.com/questions/280654/why-cant-i-store-boostfunction-in-stdlist#280657)`typename`回答了另一个问题。

另一种是模板。看这里：

```
template<typename T>
struct some {
    template<int V>
    struct other {
        typedef int type;
        static const int value = V;
    };
};

template<typename V>
void doit() {
    typename some<V>::template other<42>::type * int_pointer;
} 
```

请注意我们如何必须同时使用*模板*和类型名消歧。类型名告诉编译器

> 您访问的东西`::type`确实是一种类型。不要做乘法，这会错误地假设`::type`是一个静态值（整数或其他东西）。

模板告诉编译器

> 是与参数一起使用的`other<42>`模板。`42`这不是使用`operator>`和`operator<`的`other`比较`42`以及接下来的内容（这确实是一派胡言）。

# sql-server - SQL Server 中是否有设置让 null = null 评估为真？

> ID：389803
> 
> 赞同：3
> 
> 时间：2008-12-23T19:18:04.053
> 
> 标签：sql-server

SQL Server 中是否有设置让 null = null 评估为真？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-23T19:22:56.710

这不是 SQL Server 的错，是由于 NULL 值引入了三元逻辑。null=null 永远不会是真的，而且 null <> null 也不是真的。

你可以使用 ANSI_NULL OFF 但是：

“在 SQL Server 的未来版本中，ANSI_NULLS 将始终为 ON，任何将选项显式设置为 OFF 的应用程序都会产生错误。避免在新的开发工作中使用此功能，并计划修改当前使用此功能的应用程序。”

COALESCE 不会做你需要的吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T19:20:56.107

从[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms188048.aspx)：

```
SET ANSI_NULLS OFF 
```

将创建以下比较结果：

```
 10  = NULL   False
NULL  = NULL   True
  10 <> NULL   True
NULL <> NULL   False 
```

使用以下设置，这是默认设置：

```
SET ANSI_NULLS ON 
```

相同的比较将给出以下结果：

```
 10  = NULL   NULL (Unknown)
NULL  = NULL   NULL (Unknown)
  10 <> NULL   NULL (Unknown)
NULL <> NULL   NULL (Unknown) 
```

**编辑**：好的，所以根据评论，我尝试了一些特定的 SQL 来验证这不起作用的说法，这就是我发现的：

```
SET ANSI_NULLS OFF
CREATE TABLE TestTable (USERNAME VARCHAR(20))
INSERT INTO TestTable VALUES (NULL)
SELECT * FROM TestTable WHERE USERNAME = USERNAME
SELECT * FROM TestTable WHERE USERNAME = NULL 
```

产生这个输出：

```
[USERNAME]
(0 row(s) affected)

[USERNAME]
NULL
(1 row(s) affected) 
```

所以我猜这个设置是有缺陷的。我只在一个特定的报告查询中看到并使用过这个设置，所以我不知道查询计划的不同之处在于它在一个实例中而不是在另一个实例中工作。

然后没有任何设置有效。

即使它确实有效，根据此处的其他答案，依赖此设置也是一个坏主意，因为它将在未来版本中从 SQL Server 中删除。

那好吧。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T19:31:33.123

是的，一般来说，关闭它似乎并不好。

我只是提到了这一点，以防您进行比较时您的第一个对象在比较中可能不是空值：

val IS NULL 可用于测试某些内容是否为空。

NULL = NULL 应该是 False，因为 Unknown = Unknown 是 Unknown 或 False。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T19:59:37.293

我将避免 ansi_nulls 设置并使用 isnull 函数，尽管它可能会使某些查询复杂化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T20:30:03.160

我们可能在错误的抽象级别上处理这个问题。您似乎有一个查询，您以这样的方式陈述它，以至于您没有得到您期望的结果。所以你问了一个关于如何改变数据库的问题，它会给你你期望的东西，而不是数据库理解的东西。

询问如何重述您的查询以便数据库按您的意图理解它不是更好吗？

然后你以它会使其他查询复杂化的断言结束。我认为我们中的很多人都对“哎哟”有一个普遍的反应。因为，鉴于您对 NULL 的明显理解，这可能是正确的。

We might be able to help us discuss the your understanding of NULLs, if you would tell us what it is that you think will cause these problems.

# c# - 是否有排序列表 .NET 中的类？

> ID：389813
> 
> 赞同：26
> 
> 时间：2008-12-23T19:22:29.270
> 
> 标签：c#, .net, sorting, collections

我需要根据它们的内容对一些对象进行排序（实际上是根据它们的属性之一，这不是关键，并且可能在不同对象之间重复）。

.NET 提供了两个类（[SortedDictionary](https://msdn.microsoft.com/en-us/library/f7fta44c(v=vs.110).aspx)和[SortedList](https://msdn.microsoft.com/en-us/library/ms132319(v=vs.110).aspx)），它们都是使用二叉树实现的。它们之间的唯一区别是

*   SortedList 使用的内存比 SortedDictionary 少。
*   SortedDictionary 对未排序数据具有更快的插入和删除操作，O(log n) 与 SortedList 的 O(n) 相比。
*   如果列表是从已排序的数据中一次性填充的，则 SortedList 比 SortedDictionary 快。

[我可以使用List](https://msdn.microsoft.com/en-us/library/6sh2ey19(v=vs.110).aspx)来实现我想要的，然后将它的[Sort()](https://msdn.microsoft.com/en-us/library/234b841s(v=vs.110).aspx)方法与[IComparer](https://msdn.microsoft.com/en-us/library/8ehhxeaf(v=vs.110).aspx)的自定义实现一起使用，但这不会节省时间，因为每次我想插入一个新对象时我都会对整个 List 进行排序，而一个好的 SortedList 只会在正确的位置插入项目。

我需要的是一个带有 RefreshPosition(int index) 的 SortedList 类，以仅移动已更改（或插入）的对象，而不是在每次内部对象更改时重新使用整个列表。

我错过了一些明显的东西吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-05-09T01:38:55.473

也许我很慢，但这不是*最*简单的实现吗？

```
class SortedList<T> : List<T>
{
    public new void Add(T item)
    {
        Insert(~BinarySearch(item), item);
    }
} 
```

[http://msdn.microsoft.com/en-us/library/w4e7fxsh.aspx](http://msdn.microsoft.com/en-us/library/w4e7fxsh.aspx)

* * *

不幸的是，`Add`它不是可覆盖的，所以我不得不这样`new`做，当你拥有`List<T> list = new SortedList<T>;`我真正需要做的事情时，这并不是很好......所以我继续重建整个事情......

```
class SortedList<T> : IList<T>
{
    private List<T> list = new List<T>();

    public int IndexOf(T item)
    {
        var index = list.BinarySearch(item);
        return index < 0 ? -1 : index;
    }

    public void Insert(int index, T item)
    {
        throw new NotImplementedException("Cannot insert at index; must preserve order.");
    }

    public void RemoveAt(int index)
    {
        list.RemoveAt(index);
    }

    public T this[int index]
    {
        get
        {
            return list[index];
        }
        set
        {
            list.RemoveAt(index);
            this.Add(value);
        }
    }

    public void Add(T item)
    {
        list.Insert(~list.BinarySearch(item), item);
    }

    public void Clear()
    {
        list.Clear();
    }

    public bool Contains(T item)
    {
        return list.BinarySearch(item) >= 0;
    }

    public void CopyTo(T[] array, int arrayIndex)
    {
        list.CopyTo(array, arrayIndex);
    }

    public int Count
    {
        get { return list.Count; }
    }

    public bool IsReadOnly
    {
        get { return false; }
    }

    public bool Remove(T item)
    {
        var index = list.BinarySearch(item);
        if (index < 0) return false;
        list.RemoveAt(index);
        return true;
    }

    public IEnumerator<T> GetEnumerator()
    {
        return list.GetEnumerator();
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return list.GetEnumerator();
    }
} 
```

* * *

或者也许这样的东西是更合适的`Remove`功能......

```
 public bool Remove(T item)
    {
        var index = list.BinarySearch(item);
        if (index < 0) return false;
        while (((IComparable)item).CompareTo((IComparable)list[index]) == 0)
        {
            if (item == list[index])
            {
                list.RemoveAt(index);
                return true;
            }
            index++;
        }
        return false;
    } 
```

假设项目可以比较相等但不相等......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T19:50:19.637

我最终决定写它：

```
class RealSortedList<T> : List<T>
    {
        public IComparer<T> comparer;

        public int SortItem(int index)
        {
            T item = this[index];
            this.RemoveAt(index);
            int goodposition=FindLocation(this[index], 0, this.Count);
            this.Insert(goodposition, item);
            return goodposition;
        }

        public int FindLocation(T item, int begin, int end)
        {
            if (begin==end)
                return begin;
            int middle = begin + end / 2;
            int comparisonvalue = comparer.Compare(item, this[middle]);
            if (comparisonvalue < 0)
                return FindLocation(item,begin, middle);
            else if (comparisonvalue > 0)
                return FindLocation(item,middle, end);
            else
                return middle;
        }
    } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T19:46:31.203

不要忘记将一个项目插入一个由数组支持的列表可能是一项昂贵的操作 - 插入一堆项目然后排序可能会更快，除非您真的需要在每次操作后进行排序。

或者，您可以始终包装一个列表并让您的添加操作找到正确的位置并将其插入那里。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T19:49:55.613

过去，我通过编写一个在 IList 上执行二进制搜索的扩展方法和另一个执行插入的扩展方法解决了这个问题。您可以在 CLR 源代码中查找正确的实现，因为有一个仅适用于数组的内置版本，然后只需将其调整为 IList 上的扩展。

其中一个“应该已经在 BCL 中”的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T19:43:45.750

> 我需要的是一个带有 RefreshPosition(int index) 的 SortedList 类，以仅移动已更改（或插入）的对象，而不是在每次内部对象更改时重新使用整个列表。

当此类更新使索引无效时，为什么要使用**索引进行更新？**真的，我认为通过对象引用进行更新会更方便。您可以使用 SortedList 执行此操作 - 只需记住您的`Key`类型与从对象中提取可比较数据的函数的返回类型相同。

```
class UpdateableSortedList<K,V> {
    private SortedList<K,V> list = new SortedList<K,V>();
    public delegate K ExtractKeyFunc(V v);
    private ExtractKeyFunc func;

    public UpdateableSortedList(ExtractKeyFunc f) { func = f; }

    public void Add(V v) {
        list[func(v)] = v;
    }
    public void Update(V v) {
        int i = list.IndexOfValue(v);
        if (i >= 0) {
            list.RemoveAt(i);
        }
        list[func(v)] = v;
    }
    public IEnumerable<T> Values { get { return list.Values; } }
} 
```

我猜是这样的。

# html - 详细信息视图和 CSS 合规性

> ID：389821
> 
> 赞同：4
> 
> 时间：2008-12-23T19:25:00.577
> 
> 标签：html, css, web-standards

我仍然很难不想使用表格在 HTML 中执行我的详细信息视图布局。我想通过人们运行一些样本并获得一些意见。

对于详细信息视图，您希望在 html 中看到什么？哪个跨浏览器的障碍最少？哪个最合规？如果我有一个右对齐的静态宽度标签列，哪个看起来更好？

通过详细信息视图，我的意思类似于下图。 [![替代文字](https://i.stack.imgur.com/cWaVk.png)](https://i.stack.imgur.com/cWaVk.png)

桌子

```
<table>
<tr>
<td><label /></td>
<td><input type="textbox" /></td>
</tr>
<tr>
<td><label /></td>
<td><input type="textbox" /></td>
</tr>
</table> 
```

字段集

```
<fieldset>
<label /><input type="textbox" /><br />
<label /><input type="textbox" /><br />
</fieldset> 
```

分区

```
<div class="clearFix">
<div class="label"><label /></div>
<div class="control"><input type="textbox" /></div>
</div>

<div class="clearFix">
<div class="label"><label /></div>
<div class="control"><input type="textbox" /></div>
</div> 
```

列表

```
<ul>
<li><label /><input type="textbox" /></li>
<li><label /><input type="textbox" /></li>
</ul> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T20:11:50.153

这些方法并不相互排斥，我个人会将它们混合一下：

```
<fieldset>
  <label for="name">XXX <input type="text" id="name"/></label>
  <label for="email">XXX <input type="text" id="email"/></label>
</fieldset> 
```

虽然要获得一个右对齐的标签（我个人会避免这样做，因为它更难在视觉上扫描）你需要在文本周围有一个额外的元素，而不是在输入周围，所以我会去

```
<fieldset>
  <div class="label_input"><label for="name">XXX</label><input type="text" id="name"/></div>
  <div class="label_input"><label for="email">XXX</label><input type="text" id="email"/></div>
</fieldset> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T19:41:55.487

实际上，我将其收回为仅输入的简单文本框，我发现 Fieldset 选项效果很好。

但是，通常我会在一个“行”中有多个控件，因此我使用基于 div 的布局，这样我可以将输入、验证器和所有控件放入一个元素中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T21:06:26.957

CSS：

```
label{
  float:left;
  text-align:right;
  width:115px;
  margin-right:5px;
}
input{
  margin-bottom:5px;
} 
```

HTML：

```
<label for="username">UserName:</label><input type="text" id="username" /><br />
<label for="username">UserName:</label><input type="text" id="username" /><br /> 
```

显然，您可以添加一个 div 或使用它周围的表单来获取整个表单的背景颜色等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T21:07:37.687

我更喜欢包含 div 的字段集。标签 div 是 float:left; 例如，width:20em 和内容 div 的左边距固定为 21em 或 22em。但是你必须记住包含一个清晰的 div 才能工作：

```
<fieldset>
   <div class="labels"><label for="name">Name</label></div>
   <div class="data"><input ....</div>
   <div style="clear:both"/>
// repeat for next fields
</fieldset> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T21:41:10.130

我发现表单是 css 中最难处理的事情之一，因为如果您想要严格控制，通常有很多 css 需要添加旧式 HTML 会为您处理。但是，如果您愿意接受统一的自然处理，那么将内容和呈现分开的最干净的方法是：

```
form { margin: 0; padding: 0; }
fieldset { whatever treatment you want }
#details div { margin: 5px 0; width: 100%; overflow: hidden; /* ensures that your floats are cleared */ }
#details label { float: left; width: 190px; text-align: right; }
#details input { margin-left: 200px; }

<form>
  <fieldset id="details">
    <div id="item1div">
      <label for="item1">item1 label</label>
      <input type="" id="item1" />
    </div>
    <div id="item1div">
      <label for="item1">item1 label</label>
      <input type="" id="item1" />
    </div>
  </fieldset>
</form> 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-24T01:08:41.600

您可以使用表格以表格形式格式化表单*，*但使用 CSS 向表单添加样式。CSS 纯粹主义者可能会说您不应该这样做，但现实情况是，许多浏览器经常以不同的方式呈现 CSS 表单并可能导致可访问性问题。基于表格的表单在浏览器之间更加一致，并且更易于访问。

# c# - 我应该什么时候处理数据上下文

> ID：389822
> 
> 赞同：57
> 
> 时间：2008-12-23T19:25:11.030
> 
> 标签：c#, linq, linq-to-sql

我目前正在为应用程序编写数据访问层。访问层广泛使用 linq 类来返回数据。目前为了将数据反映回数据库，我添加了一个私有数据上下文成员和一个公共保存方法。代码看起来像这样：

```
private DataContext myDb;
public static MyClass GetMyClassById(int id)
{
    DataContext db = new DataContext();
    MyClass result = (from item in db.MyClasss
                      where item.id == id
                      select item).Single();
    result.myDb = db;
    return result;
}

public void Save()
{
    db.SubmitChanges();
} 
```

这是一个粗略的简化，但它给出了一般的想法。有没有更好的方法来处理这种模式？每次我想访问数据库时，我是否应该实例化一个新的数据上下文？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-12-23T19:42:52.083

其实也没太大关系。不久前，我向 LINQ to SQL 团队的 Matt Warren 询问了这个问题，以下是回复：

> 我们实施 IDisposable 有几个原因：
> 
> 如果应用程序逻辑需要在预期使用或有效 DataContext 之后保留实体，则可以通过调用 Dispose 来强制执行该合同。该实体中的延迟加载程序仍将引用 DataContext，并且如果任何代码尝试导航延迟属性，则将尝试使用它。这些尝试都会失败。Dispose 还强制 DataContext 转储其物化实体的缓存，以便单个缓存实体不会意外地使通过该 DataContext 物化的所有实体保持活动状态，否则会导致看似内存泄漏的情况。
> 
> 自动关闭 DataContext 连接的逻辑可能会被欺骗，使连接保持打开状态。DataContext 依赖于枚举查询的所有结果的应用程序代码，因为到达结果集的末尾会触发连接关闭。如果应用程序使用 IEnumerable 的 MoveNext 方法而不是 C# 或 VB 中的 foreach 语句，则可以提前退出枚举。如果您的应用程序遇到连接未关闭的问题并且您怀疑自动关闭行为不起作用，您可以使用 Dispose 模式作为解决方法。

但基本上，在大多数情况下，您实际上并不*需要*处理它们——这是设计使然。无论如何，我个人更喜欢这样做，因为遵循“处理所有实现 IDisposable 的东西”的规则比记住大量例外更容易 - 但如果你忘记处理，你不太可能*泄漏*资源它。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-23T19:38:12.187

将您的数据上下文视为资源。并且使用资源的规则说

> “尽可能晚地获取资源，安全时尽快释放”

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-23T19:31:12.700

DataContext 非常轻量级，适用于您正在使用的工作单元应用程序。但是，我认为我不会将 DataContext 保留在我的对象中。如果您不打算使用设计器生成的代码来管理您的业务对象，您可能需要查看存储库模式。存储库模式将允许您使用与数据上下文分离的对象，然后在进行更新之前重新附加它们等。

就我个人而言，我能够在大多数情况下使用 DBML 设计器生成的代码，以及我的业务和验证逻辑的部分类实现。我还将设计器生成的数据上下文抽象化并从中继承，以允许我拦截直接添加到数据上下文中的存储过程和表值函数方法等内容，并在那里应用业务逻辑。

我一直在 ASP.NET MVC 中使用的一种模式是注入一个工厂类，该类根据工作单元的需要创建适当的数据上下文。使用工厂允许我通过（1）使用围绕现有数据上下文类的包装器相当容易地模拟数据上下文，以便它是可模拟的（模拟包装器，因为 DataContext 不容易模拟）和（2）创建假/模拟上下文和工厂来创造它们。能够从工厂随意创建它们，这样我就不必长时间保留它们。

# iphone - 关闭 iphone 键盘

> ID：389825
> 
> 赞同：15
> 
> 时间：2008-12-23T19:25:43.400
> 
> 标签：iphone, cocoa-touch, iphone-softkeyboard

我正在尝试重新创建类似于 Safari 中使用的弹出式键盘的东西。

![替代文字](https://dl.getdropbox.com/u/22784/keyboardToolbar.png)

我可以通过在我的视图和适当的按钮上放置一个工具栏来直观地重现它，但是一旦用户触摸了完成按钮，我想不出任何方法来关闭键盘。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-07-26T18:25:08.150

您需要记住几件事。开发人员忘记设置的编号 #1 部分是 textField 的**委托**。

如果您使用 Interface Builder，您必须记住您需要将 textField 的委托设置为文件 Owner。

如果您没有使用 Interface Builder，请确保将文本字段的委托设置为 self。我还包括 returnType。例如，如果 textField 被称为 gameField：

```
gameField.delegate = self;
gameField.returnKeyType = UIReturnKeyDone; 
```

您还必须为您的 ViewController 实现**UITextFieldDelegate**。

```
@interface YourViewController : UIViewController <UITextFieldDelegate> 
```

最后你需要使用**textFieldShouldReturn**方法并调用**[textField resignFirstResponder]**

```
 -(BOOL) textFieldShouldReturn:(UITextField*) textField {
    [textField resignFirstResponder]; 
    return YES;
} 
```

您的所有文本字段都将使用相同的方法，因此您只需进行一次此设置。只要为 textField 设置了委托，为接口实现 UITextFieldDelegate，您添加 textFieldShouldReturn 方法并调用您设置的 resignFirstResponder。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-12-23T19:29:12.690

你有没有尝试过：

```
[viewReceivingKeys resignFirstResponder]; 
```

`viewReceivingKeys`接收文本输入的 UIView在哪里？

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-23T20:58:36.363

如果您在 Interface Builder 中构建自己的视图，请将视图控制器设置为文本字段的委托，并在视图控制器中实现 textFieldShouldReturn: from UITextFieldDelegate。

```
- (BOOL)textFieldShouldReturn:(UITextField *)theTextField 
{
    NSLog(@"%@ textFieldShouldReturn", [self class]);
    [theTextField resignFirstResponder];
    // do stuff with the text
    NSLog(@"text = %@", [theTextField text]);
    return YES;
} 
```

[UITextFieldDelegate textFieldShouldReturn：在 iphone 可可文档中](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UITextFieldDelegate_Protocol/UITextFieldDelegate/UITextFieldDelegate.html#//apple_ref/occ/intfm/UITextFieldDelegate/textFieldShouldReturn:)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-21T10:49:35.383

如果您正在谈论从 a`UITextField`而不是 a解除键盘`UITextView`。你的问题不是很清楚吗？如果你然后确保你的类`UITextFieldDelegate`在接口文件中被标记为，

```
@interface MyController: UIViewController <UITextFieldDelegate> {
   UITextField *activeTextField;

   // ...remainder of code not show ...
} 
```

然后你应该实现下面的两个委托方法，

```
- (BOOL)textFieldShouldBeginEditing:(UITextField *)textField {
    activeTextField = textField;!    
    return YES;
}

- (BOOL)textFieldShouldReturn:(UITextField *)textField {
    activeTextField = nil; 
    [textField resignFirstResponder];
    return YES;
} 
```

但是，如果您使用的是 a`UITextView`那么事情会更复杂一些。该`UITextViewDelegate`协议缺少该`textFieldShouldReturn:`方法的等效项，大概是因为我们不应该期望 Return 键是用户希望停止在多行文本输入对话框中编辑文本的信号（毕竟，用户可能想要插入按 Return 换行）。

但是，有几种方法可以解决无法`UITextView`使用键盘辞去第一响应者的职务。通常的方法是在弹出键盘出现时在导航栏中放置一个*完成按钮。*`UITextView`轻按时，此按钮会要求文本视图辞去第一响应者的身份，然后将关闭键盘。

但是，根据您设计界面的方式，您可能希望`UITextView`在用户点击外部时退出`UITextView`。为此，您将子类`UIView`化以接受触摸，然后指示文本视图在用户在视图本身之外点击时退出。

新建一个类，

```
#import <UIKit/UIKit.h>

@interface CustomView : UIView {
   IBOutlet UITextView *textView;
}

@end 
```

然后，在实施中，实施该`touchesEnded:withEvent:`方法并要求`UITextView`辞去第一响应者的职务。

```
#import "CustomView.h"

@implementation CustomView

- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        // Initialization code
    }
    return self;
}

- (void) awakeFromNib {
    self.multipleTouchEnabled = YES;
}

- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event {
    NSLog(@"touches began count %d, %@", [touches count], touches);

    [textView resignFirstResponder];
    [self.nextResponder touchesEnded:touches withEvent:event];
}

@end 
```

添加类后，您需要保存所有更改，然后进入 Interface Builder 并单击您的视图。在 Utility 选项卡中打开身份检查器，并将*nib*文件中的视图类型更改为您的`CustomView`而不是默认`UIView`类。然后在 Connections Inspector 中，将`textView`插座拖到`UITextView`. 这样做之后，一旦你重建你的应用程序，在活动 UI 元素之外的触摸现在将关闭键盘。但是请注意，如果`UIView`您的子类化位于其他 UI 元素“之后”，这些元素将在触摸到达 UIView 层之前拦截触摸。因此，虽然这个解决方案很优雅，但它只能在某些情况下使用。在许多情况下，您将不得不求助于添加*导航栏上的完成*按钮以关闭键盘。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T19:31:08.880

使用导航控制器并在完成后弹出视图？

例如，我使用这样的代码来滑动一个关于框：

```
[[self navigationController] presentModalViewController:modalViewController animated:YES]; 
```

然后当单击该关于框中的按钮时，我使用它来摆脱它：

```
[self.navigationController dismissModalViewControllerAnimated:YES]; 
```

在我的情况下，关于框占据了整个屏幕，但我认为它不必为此工作。

*编辑：我想我可能误解了你的问题。如果您自己伪造整个键盘视图，则与我的代码类似。我认为，如果它是在顶部添加工具栏的普通键盘，那么辞职第一响应者是正确的方法。*

# c++ - C 中的命名空间

> ID：389827
> 
> 赞同：61
> 
> 时间：2008-12-23T19:27:28.637
> 
> 标签：c++, c, namespaces, c-preprocessor

有没有办法（ab）使用**C**预处理器来模拟**C**中的命名空间？

我在想一些事情：

```
#define NAMESPACE name_of_ns
some_function() {
    some_other_function();
} 
```

这将被翻译成：

```
name_of_ns_some_function() {
    name_of_ns_some_other_function();
} 
```

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-12-23T20:15:40.630

另一种选择是声明一个结构来保存所有函数，然后静态定义函数。然后你只需要担心全局名称结构的名称冲突。

```
// foo.h
#ifndef FOO_H
#define FOO_H
typedef struct { 
  int (* const bar)(int, char *);
  void (* const baz)(void);
} namespace_struct;
extern namespace_struct const foo;
#endif // FOO_H

// foo.c
#include "foo.h"
static int my_bar(int a, char * s) { /* ... */ }
static void my_baz(void) { /* ... */ }
namespace_struct const foo = { my_bar, my_baz }

// main.c
#include <stdio.h>
#include "foo.h"
int main(void) {
  foo.baz();
  printf("%d", foo.bar(3, "hello"));
  return 0;
} 
```

在上面的例子中，`my_bar`并`my_baz`不能直接从 main.c 调用，只能通过`foo`.

如果您有一堆命名空间声明具有相同签名的函数，那么您可以为该集合标准化命名空间结构，并选择在运行时使用哪个命名空间。

```
// goo.h
#ifndef GOO_H
#define GOO_H
#include "foo.h"
extern namespace_struct const goo;
#endif // GOO_H

// goo.c
#include "goo.h"
static int my_bar(int a, char * s) { /* ... */ }
static void my_baz(void) { /* ... */ }
namespace_struct const goo = { my_bar, my_baz };

// other_main.c
#include <stdio.h>
#include "foo.h"
#include "goo.h"
int main(int argc, char** argv) {
  namespace_struct const * const xoo = (argc > 1 ? foo : goo);
  xoo->baz();
  printf("%d", xoo->bar(3, "hello"));
  return 0;
} 
```

`my_bar`and的多个定义`my_baz`并不冲突，因为它们是静态定义的，但仍然可以通过适当的命名空间结构访问底层函数。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-12-23T21:44:07.630

使用命名空间前缀时，我通常会为缩短的名称添加宏，这些名称可以`#define NAMESPACE_SHORT_NAMES`在包含标题之前激活。标头 foobar.h 可能如下所示：

```
// inclusion guard
#ifndef FOOBAR_H_
#define FOOBAR_H_

// long names
void foobar_some_func(int);
void foobar_other_func();

// short names
#ifdef FOOBAR_SHORT_NAMES
#define some_func(...) foobar_some_func(__VA_ARGS__)
#define other_func(...) foobar_other_func(__VA_ARGS__)
#endif

#endif 
```

如果我想在包含文件中使用短名称，我会这样做

```
#define FOOBAR_SHORT_NAMES
#include "foobar.h" 
```

我发现这是一个比使用 Vinko Vrsalovic 描述的命名空间宏（在评论中）更干净、更有用的解决方案。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-23T19:32:23.573

您可以使用 ## 运算符：

```
#define FUN_NAME(namespace,name) namespace ## name 
```

并将函数声明为：

```
void FUN_NAME(MyNamespace,HelloWorld)() 
```

不过看起来挺别扭的。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-01-25T20:28:22.353

我使用基于结构的方法，有两个改进：我添加子结构来创建分层命名空间，当我想简化命名空间的路径时，我定义了一些简单的宏。

我们以一个*Foobar*库为例。

**foob​​ar.h**

```
#ifndef __FOOBAR_H__
#define __FOOBAR_H__

// definition of the namespace's hierarchical structure
struct _foobar_namespace {
    struct {
        void (*print)(char *s);
    } text;
    struct {
        char *(*getDateString)(void);
    } date;
};

// see the foobar.c file
// it must be the only one defining the FOOBAR macro
# ifndef FOOBAR
    // definition of the namespace global variable
    extern struct _foobar_namespace foobar;
# endif // FOOBAR

#endif // __FOOBAR_H__ 
```

**foob​​ar.c**

```
// the FOOBAR macro is needed to avoid the
// extern foobar variable declaration
#define FOOBAR

#include "foobar.h"
#include "foobar_text.h"
#include "foobar_date.h"

// creation of the namespace global variable
struct _foobar_namespace foobar = {
    .text = {
        .print = foobar_text__print
    },
    .date = {
        .getDateString = foobar_date__getDateString
    }
}; 
```

然后，可以使用命名空间：

```
#include "foobar.h"

void main() {
    foobar.text.print("it works");
} 
```

`foobar_text__print()`但是 和 之间并没有太大的区别`foobar.text.print()`。我认为第二个更具可读性，但值得怀疑。因此，通过定义一些宏来简化这些命名空间，它变得非常有用：

```
#include "foobar.h"

#define txt    foobar.text
#define date   foobar.date

void main() {
    char *today = date.getDateString();
    txt.print(today);
} 
```

这种分层命名空间可以快速定义、易于理解并减少代码冗长。

* * *

只是为了好玩，这里是`foobar.text`代码文件：

**foob​​ar_text.h**

```
#ifndef __FOOBAR_TEXT_H__
#define __FOOBAR_TEXT_H__

void foobar_text__print(char *s);

#endif // __FOOBAR_TEXT_H__ 
```

**foob​​ar_text.c**

```
#include <stdio.h>
#include "foobar_text.h"

void foobar_text__print(char *s) {
    printf("%s\n", s);
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-03-10T22:30:15.320

我想出了以下方案：

（标题）

```
// NS_PREFIX controls the prefix of each type and function declared in this
// header, in order to avoid name collision.
#define NS_PREFIX myprefix_

// Makes a string from argument (argument is not macro-expanded).
#define stringify(arg) #arg

// Concatenation that macro-expands its arguments.
#define concat(p1, p2) _concat(p1, p2) // Macro expands the arguments.
#define _concat(p1, p2) p1 ## p2       // Do the actual concatenation.

// Append the namespace prefix to the identifier.
#define ns(iden) concat(NS_PREFIX, iden)

// header content, for instance :
void ns(my_function)(int arg1, ns(t) arg2, int arg3);

// Allow implementation files to use namespacing features, else
// hide them from the including files.
#ifndef _IMPL
#undef NS_PREFIX
#undef ns
#undef stringify
#undef concat
#undef _concat
#endif // _IMPL 
```

（执行）

```
#define  _IMPL 
#include "header.h"
#undef   __IMPL 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-04-30T03:54:09.990

类似于接受的答案的方法如下：

```
// inclusion guard
#ifndef FOOBAR_H_
#define FOOBAR_H_

// long names
void foobar_some_func(int);
void foobar_other_func();

// qualified names
#ifdef FOOBAR_SHORT_NAMES
extern struct _foobar {
     void (*some_func)(int);
     void (*other_func)();
} foobar;
#endif

#endif 
```

此头文件应附带一个 .c 文件：

```
#include "foobar.h"
struct _foobar foobar = {
    foobar_some_func;
    foobar_other_func;
}; 
```

使用功能时，

```
foobar.some_func(10);
foobar.other_func(); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-12-29T22:27:58.097

我写了一篇关于如何使用 C 来利用命名空间和/或模板的教程。

[C 中的命名空间和模板](http://andycurtis.me/tutorials/2017/12/29/namespaces-and-templates-in-c/)

[C 中的命名空间和模板（使用链表）](http://andycurtis.me/tutorials/2017/12/29/namespaces-and-templates-in-c-using-linked-lists/)

对于基本命名空间，可以简单地为命名空间名称添加前缀作为约定。

```
namespace MY_OBJECT {
  struct HANDLE;
  HANDLE *init();
  void destroy(HANDLE * & h);

  void do_something(HANDLE *h, ... );
} 
```

可以写成

```
struct MY_OBJECT_HANDLE;
struct MY_OBJECT_HANDLE *my_object_init();
void my_object_destroy( MY_OBJECT_HANDLE * & h );

void my_object_do_something(MY_OBJECT_HANDLE *h, ... ); 
```

我需要的第二种使用命名空间和模板概念的方法是使用宏连接和包含。例如，我可以创建一个

```
template<T> T multiply<T>( T x, T y ) { return x*y } 
```

使用模板文件如下

乘法模板.h

```
_multiply_type_ _multiply_(multiply)( _multiply_type_ x, _multiply_type_ y); 
```

乘法模板.c

```
_multiply_type_ _multiply_(multiply)( _multiply_type_ x, _multiply_type_ y) {
  return x*y;
} 
```

我们现在可以定义 int_multiply 如下。在此示例中，我将创建一个 int_multiply.h/.c 文件。

int_multiply.h

```
#ifndef _INT_MULTIPLY_H
#define _INT_MULTIPLY_H

#ifdef _multiply_
#undef _multiply_
#endif
#define _multiply_(NAME) int ## _ ## NAME 

#ifdef _multiply_type_
#undef _multiply_type_
#endif
#define _multiply_type_ int 

#include "multiply-template.h" 
#endif 
```

int_multiply.c

```
#include "int_multiply.h"
#include "multiply-template.c" 
```

在所有这些结束时，您将拥有一个函数和头文件。

```
int int_multiply( int x, int y ) { return x * y } 
```

我在提供的链接上创建了一个更详细的教程。希望这可以帮助某人！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-06-02T22:19:04.730

您可以使用辅助`#define`宏：

```
#include <stdio.h>

#define ns(x) gargantua_ ## x

struct ns(stats) {
    int size;
};

int ns(get_size)(struct ns(stats) *st) {
    return st->size;
}

void ns(set_size)(struct ns(stats) *st, int sz) {
    st->size = sz;
}

int main(void) {
    struct ns(stats) stats = {0};

    ns(set_size)(&stats, 3);
    printf("size=%d\n", ns(get_size)(&stats));
    return 0;
} 
```

通过预处理器运行它会给你：

```
struct gargantua_stats {
    int size;
};

int gargantua_get_size(struct gargantua_stats *st) {
    return st->size;
}

void gargantua_set_size(struct gargantua_stats *st, int sz) {
    st->size = sz;
}

int main(void) {
    struct gargantua_stats stats = {0};

    gargantua_set_size(&stats, 3);
    printf("size=%d\n", gargantua_get_size(&stats));
    return 0;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-01-04T21:04:25.873

这是一个构建上述方法的示例，并将它们组合用于函数和结构以创建伪命名空间 NAMESPACE1 和 NAMESPACE2。与拥有一个包含函数的结构相比，这样做的好处是，结构保持函数方法需要跨多个伪命名空间的标准化结构，这并不总是可能的（或者根本没有，或者没有很多可以说的工作不改进代码）或可取的。

不确定宏扩展顺序是否会成为问题，但这适用于 GCC，并且似乎最大限度地减少了所需的代码更改量，同时保持了不错的（尽管远非理想）可读性。

* * *

应用程序.c：

```
#include <stdio.h>
#include "header1.h"
#include "header2.h"

/* use NAMESPACE1 and NAMESPACE2 macros to choose namespace */

int main() {
  NAMESPACE1(mystruct) data1; // structure specific to this namespace
  NAMESPACE2(mystruct) data2; 

  data1.n1 = '1';
  data1.c  = 'a';
  data2.n2 = '2';
  data2.c  = 'a';

  NAMESPACE1(print_struct)(&data1); // function specific to this namespace
  NAMESPACE2(print_struct)(&data2);

} 
```

* * *

header1.h

```
/* the below block is unnecessary, but gets rid of some compiler warnings */
#ifdef NAMESPACE_REAL
#undef NAMESPACE_REAL
#endif

/* edit the below lines to change the three occurrences of NAMESPACE1 to the desired namespace */
#define NAMESPACE1(name) NAMESPACE1 ## _ ## name
#define NAMESPACE_REAL(name) NAMESPACE1(name)

/* don't edit the next block */
#define TYPEDEF(name, ...) typedef struct NAMESPACE_REAL(name) { __VA_ARGS__ } NAMESPACE_REAL(name)
#define STRUCT(name) struct NAMESPACE_REAL(name)
#define FUNC(name) NAMESPACE_REAL(name)

/* normal header code, using FUNC and STRUCT macros */
#include <stdio.h>

TYPEDEF(mystruct,
        char n1;
        char c;
        );

void FUNC(print_struct)(STRUCT(mystruct) *data);

/* don't edit the rest */
#undef TYPEDEF 
```

* * *

api1.c：

```
#include "header1.h"

/* normal code, using FUNC and STRUCT macros */
void FUNC(print_struct)(STRUCT(mystruct) *data) {
  printf("this is the struct from namespace1: %c %c\n", data->n1, data->c);
}

/* don't edit the rest */
#undef STRUCT
#undef FUNC
#undef NAMESPACE
#undef NAMESPACE_REAL 
```

* * *

header2.h 和 api2.c 中的其他代码与 header1.h 和 header2.h 相同，修改为命名空间“NAMESPACE2”

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-12-12T15:49:31.290

我意识到这是一个老问题（11 岁），但我试图完成我认为你最初想要的，正如你上面列出的那样。

我希望在我的函数前面有一个命名空间。但我希望能够改变那个命名空间。默认情况下，我希望这个示例没有命名空间，但如果发生命名冲突，那么我希望能够为库中的所有函数添加命名空间。（与默认情况下有命名空间的 C++ 相比，这稍有倒退，您可以使用它`using namespace whatever`来消除每次都指定命名空间的需要。）但是，就像 C++ 一样，如果您放入一个`using namespace`语句并为您的代码设置别名，您将需要更新您的呼叫代码。您也可以编写一些其他宏序列来自动重命名您的调用，但这超出了我认为您正在寻找的范围。

```
#include <stdio.h>

#define NAMESPACE(...) test_ //Use this as my prepender

//Where all the magic happens which could be included in a header file.
#ifndef NAMESPACE
//No Namespace by default
#define NAMESPACE(...)
#endif

//Actual replacements
#define NSPREPENDER(...) NSPROCESSING(NAMESPACE(), __VA_ARGS__)
#define NSPROCESSING(...) NSFINALIZE(__VA_ARGS__)
#define NSFINALIZE(a,b) a ## b

//BEGIN ACTUAL PROGRAM
//Prototype
void NSPREPENDER(myprint)();

int main()
{
    test_myprint(); //If NAMESPACE(...) is defined to anything else, this code must change.

    return 0;
}

//Implementation
void NSPREPENDER(myprint)()
{
    puts("Testing");
} 
```

此代码将仅在 C99 及更高版本上编译，因为它使用可变参数宏。这些宏执行一种递归形式，所有这些都完成了，以便我们可以从顶部定义的宏中获取值。

其所有工作的细分：

*   我们定义我们希望我们的命名空间是。
*   如果未定义任何内容，请设置默认值
*   做一堆调用来绕过和（ab）使用预处理器功能。
*   将 NSPREPENDER 宏函数添加到每个 c 函数中，以便可以对其进行名称修改。
*   使用重命名的名称编写代码，因为在编译器看到它时名称将被正确重整。

此代码已使用 clang 进行了测试。

# java - 如何使用 ImageIO 将多个 BufferedImage 保存到一个文件中

> ID：389831
> 
> 赞同：2
> 
> 时间：2008-12-23T19:29:13.173
> 
> 标签：java, video, javax.imageio

我尝试了以下两个选项：

1.

```
BufferedImage Buffered_Image;
MemoryCacheImageOutputStream MemoryCache_OutputStream = 
     new MemoryCacheImageOutputStream(new FileOutputStream("C:/Test.mov",false));

while (notFinished)  // Main recording loop.
{
   Buffered_Image=robot.createScreenCapture();         // Capture Screen image.
   try { ImageIO.write(Buffered_Image,"png",MemoryCache_OutputStream); }
   catch (Exception e) { e.printStackTrace(); }
} 
```

2.

```
BufferedImage Buffered_Image;
ImageWriter writer;
try
{
  ImageOutputStream ios=ImageIO.createImageOutputStream(new File("C:/Test.mov"));
  Iterator writers=ImageIO.getImageWritersByFormatName("png");
  while (writers.hasNext())
  {
    writer=(ImageWriter)writers.next();
    writer.setOutput(ios);
    Out(writer.toString()+"  canInsertImage : "+writer.canInsertImage(0));
    // Got this: com.sun.imageio.plugins.png.PNGImageWriter@19fcc69  
    // canInsertImage : false
  }
}
catch (Exception e) { }

cntPics=0;
while (notFinished)  // Main recording loop.
{
   Buffered_Image=robot.createScreenCapture();         // Capture Screen image.
   writer.write(null,new IIOImage(Buffered_Image,null,null),null);
   if (writer.canInsertImage(-1)) {
         // Append image at highest index
         writer.writeInsert(-1,new IIOImage(Buffered_Image,null,null),null); 
   } else Out("Writer can’t append image Id : "+cntPics);
   cntPics++;
} 
```

他们都没有工作，将多个PNG图像保存到文件的正确方法是什么？

* * *

**编辑：**

你是对的，我找到了一个叫做[Krut](http://sourceforge.net/project/showfiles.php?group_id=129468)的 java 程序，可以记录屏幕会话，但是它使用 JPEGImageEncoder，图像质量没有我想要的那么好，所以我想知道我是否可以使用 ImageIO 来编码序列。

如果 ImageIO 做不到，我的下一个问题是是否有一个独立的开源 PNGImageEncoder 可以用来对其进行编码？我知道有开源的 PNGImageEncoders，但它们往往被项目缠结，很难从中获取所有支持文件，有什么想法吗？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T19:57:58.357

您似乎正在尝试通过连续写入多个 PNG 文件来创建视频 (MOV) 文件。这是行不通的。您可能必须找到一个第三方库来将您的图像编码为视频文件（这本身可能是一个很好的 SO 问题）。

编辑：我还应该注意，您实际上可以通过连续写入多个 JPG 图像来获得视频，以获得[MJPEG（Motion JPEG）](http://en.wikipedia.org/wiki/Motion_JPEG)的一种形式，但对于其他格式，例如 MOV，您将需要一个实际的编码器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T20:49:18.580

你想做什么？重新发明 MNG？即使您可以在同一个文件中写入多个 PNG 图像，它也会使任何程序都无法理解复合文件（除了您可能编写的那些）。

如果按照 Marc 的建议，您想制作电影，您可能需要查看 QuickTime for Java (QTJava)。它是[Processing](http://processing.org/)使用动画/帧制作电影的解决方案。它有几种质量/格式，从最差的（但小文件）到最高质量（结果是高文件大小）。

# java - Java 语句对象重用？

> ID：389832
> 
> 赞同：26
> 
> 时间：2008-12-23T19:30:30.643
> 
> 标签：java, jdbc

我想知道我们是否可以重用同一个 Statement 对象来执行多个查询。或者，我们应该为不同的查询创建一个新语句。

例如，

```
Connection con = getDBConnection();
Statement st1 = con.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
int i = st1.executeUpdate("update tbl_domu set domU_status=1 where domU_id=" + dom_U_id);
Statement st2 = con.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
String date = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(Calendar.getInstance().getTime());
int j = st2.executeUpdate("insert into tbl_domU_action_history values('" + dom_U_name + "', 1, '" + date + "')"); 
```

在上述情况下，对两个 executeUpdate() 查询使用相同的语句 st1 有什么害处吗？我可以将相同的 Statement 对象 st1 用于另一个 executeQuery() 吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-07T01:08:46.137

我遇到了我在 Javadocs 中寻找的响应

> 默认情况下，每个 Statement 对象只能同时打开一个 ResultSet 对象。因此，如果一个 ResultSet 对象的读取与另一个 ResultSet 对象的读取交错，则每个对象都必须由不同的 Statement 对象生成。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-23T19:32:31.387

是的你可以。`PreparedStatement`但是，使用它来避免 SQL 注入漏洞要好得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T20:06:50.010

使用准备好的语句的初衷是避免让数据库解析和重新编译语句，所以它应该更快。

我没有考虑过使用 SQL 注入漏洞，但我不确定是否进行了任何数据检查。我怀疑它依赖于驱动程序，因为驱动程序实现可以自由地将语句粘合在一起。如果有人有更详细的信息，请发帖。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-07T20:06:05.620

我不确定结果集是否会被垃圾收集，如果它们只是关闭的话。我认为在编写连接池时发生了很酷的内存泄漏，因此相同的语句/连接被重复使用了一百万次。不断降低我的 JVM。我想这也可能是特定于实现的，因为可能不会测试封闭结果集的垃圾收集。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T19:44:37.183

每当您将某些内容分配给引用类型时，您都在用新的引用替换旧的引用。

例如...

```
MyObject obj = new MyObject("foo");
obj = new MyObject("bar"); 
```

将有一个 MyObject 现在未引用的实例，其中某些属性设置为“foo”，最终将被垃圾收集。

obj 存储对 MyObject 的引用，其中某些属性设置为“bar”。

# sql - Windows 批处理文件中的 SQL 语句

> ID：389844
> 
> 赞同：2
> 
> 时间：2008-12-23T19:35:23.783
> 
> 标签：sql, batch-file

有没有什么方法可以让 Windows 批处理文件直接输入 SQL 语句而不调用脚本？我希望批处理文件登录到 SQL，然后直接输入语句。

**编辑：**我正在使用 Oracle v10g

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T19:39:10.783

对于单个命令，您可以使用此技巧：

```
echo select * from dual; | sqlplus user/pw@db 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T19:45:21.020

要在 SQL Server 2005/2008 上运行某些东西，您可以使用`sqlcmd`命令行实用程序。`sqlcmd -h`打印开关列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T19:41:14.867

简短的回答：不。批处理文件本身不能做到这一点。

长答案：您可能能够接近，这取决于您使用的是哪种数据库服务器，以及命令行客户端提供的功能。

您使用的是哪种数据库服务器？Oracle、mySql、Sybase、微软、Terradata、？？？

例如，对于 Sybase 数据库，您可以使用 isql 命令行客户端从批处理文件运行：

```
isql -S server -D database -U user -P password -i script 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T19:51:56.013

您可以使用powershell[中的](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)[sqlcmd](http://msdn.microsoft.com/en-us/library/ms162773.aspx)（用于 sql server）或[System.Data.Odbc.OdbcCommand](http://msdn.microsoft.com/en-us/library/system.data.odbc.odbccommand.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T19:52:41.363

[outwit 工具套件](http://www.spinellis.gr/sw/outwit/)的 odbc 命令允许您在已定义适当 ODBC 数据源的任何数据库上运行 select 语句。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-10T07:48:28.047

您可以使用[http://tekkies.co.uk/go/runsqloledb](http://tekkies.co.uk/go/runsqloledb)

例如 RunSQLOLEDB "Provider=SQLOLEDB;Data Source=(local);..." "SELECT GetDate()" 或 RunSQLOLEDB @ConnectionString.txt @Query.sql

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-11-30T19:59:49.693

这是一个粗略的 MSSQL 示例脚本，可以针对 Oracle 进行修改：

```
@ECHO off
SETLOCAL ENABLEDELAYEDEXPANSION
:: batch file for sql query
SET STARTDATE=20101010
SET ENDDATE=20111109
SET AGENCYNAME=Agency
SET DBNAME=AccidentDB

SET SQLSTRING=SELECT Acc.INC_ID,^
 Veh.MAKE, Veh.MODEL, Veh.LIC_NUM^
 FROM Acc,^
 lnk_Acc_Veh, Veh^
 WHERE     (INC_NUM LIKE '20115000%')^
 AND lnk_Acc_Veh.link_id=Veh.key^
 AND lnk_Acc_Veh.link_id=Acc.key^
 AND Acc.date ^> '%STARTDATE%' OR Acc.date ^< '%ENDDATE%';

CLS
@ECHO.
@ECHO.
@ECHO DBNAME is %DBNAME%
@ECHO.
@ECHO SQLSTRING is "!SQLSTRING!"
@ECHO.
@ECHO ------------------------------------------------------
@sqlcmd.exe -b -S localhost -E -d !DBNAME! -Q "!SQLSTRING!" -W
@ECHO.
@ECHO Report is done. Hit any key to close this window....
@pause>nul 
```

# asp.net - 在会话状态中存储数据的不同方式

> ID：389845
> 
> 赞同：0
> 
> 时间：2008-12-23T19:35:48.637
> 
> 标签：asp.net, session-state

我被要求为 ASP .NET / MVC C# 3.5 Web 应用程序提出状态管理策略

我选择在状态服务器上存储会话——这将是一个单独的物理盒子。我担心存储到会话中时序列化/反序列化对象所花费的时间......

有谁知道这样做时获得最佳性能的技术？

还可以在将信息存储在会话帮助中之前压缩信息，或者这也会导致性能时间变慢。

编辑：我为状态服务器使用一个单独的框，因为我们将有多个 Web 服务器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T19:39:46.427

就个人而言，这里最常见的元素是减少投入会话的信息量。

压缩可能会节省空间，但完成它需要更多的 CPU 时间，很可能会导致性能下降或至少没有净收益。除非你在谈论非常大的物体。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T19:39:50.733

[会话、应用程序和缓存的 Zip 压缩示例](http://www.hanselman.com/blog/TheWeeklySourceCode35ZipCompressingASPNETSessionAndCacheState.aspx)，在 StackOverflow 上使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T19:47:45.100

确保在不使用会话状态的页面上禁用它。“默认情况下，ASP.NET 会话状态管理器在每个请求中对会话数据存储执行两次访问——一次读取访问和一次写入访问，无论请求的页面是否使用会话状态。” [——MSDN 杂志](http://msdn.microsoft.com/en-us/magazine/cc163577.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T19:54:16.337

请注意，您不要试图过早地优化您的解决方案。在实现诸如会话压缩之类的东西之前，进行一系列基准测试以确定您的应用程序中是否需要类似的东西可能是一个好主意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T20:01:58.363

您确定要在会话存储中存储这么多数据吗？单个用户会话的典型使用是几百字节！

至于序列化和反序列化，那么小的尺寸可以忽略不计。

当然，您会期待更多的用户，但仍然如此。

如果您在会话中存储大量数据，那么 IMO，您做错了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T20:09:02.033

一些人指出每个用户的会话状态中的数据过多是问题的征兆，但他们并没有直接指出解决方案：保留一个用户 SQL 数据库并将所有用户信息存储在其中。然后会话状态通常只包含登录用户的 ID。任何其他状态都可能与用户的当前活动直接相关，这表明它可能更适合作为内存中的 cookie 或查询字符串变量进行携带。无论如何，这通常是更好的选择，这样当用户单击后退和前进按钮时，事情就会进入损坏状态。

# apache-flex - 为什么 Flex 的 ArrayCollection 的 Contain 方法看内存引用？

> ID：389846
> 
> 赞同：5
> 
> 时间：2008-12-23T19:36:19.477
> 
> 标签：apache-flex, programming-languages, arraycollection

在 Flex 中使用`.contains()`on an`ArrayCollection`时，它总是会查看内存引用。它似乎没有查看`.equals()`方法或`.toString()`方法或任何可覆盖的东西。相反，我需要遍历`ArrayCollection`每次并检查每个单独的项目，直到找到我正在寻找的东西。

有谁知道为什么 Flex/ActionScript 是这样制作的？为什么不提供一种让人们以`contains()`他们想要的方式使用该方法的方法呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T17:41:26.290

难道你不能扩展 ArrayCollection 并覆盖 contains() 方法吗？或者，您可以将 ArrayCollection 的源代码粘贴到项目中的“mx/collections”包中并修改源代码；这种“猴子修补技术”将覆盖整个项目的行为。但是，对于以这种方式更改 ArrayCollection，我会非常谨慎：因为它在 Flex API 中的所有地方都使用过，所以您很有可能会开始破坏框架中的其他组件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T18:38:39.323

contains() 方法通过引用搜索，正确（我相信即使是原语），所以如果你试图在 ArrayCollection 中找到一个字符串或一个 int，你必须自己进行搜索，通过循环的一些变体或搜索。但是，我认为我们中的任何人都无法告诉您为什么该方法上没有可选参数来指示是按 ref 还是按 val 搜索；正如他们所说，事情就是这样。

但我肯定会警告你不要对框架代码进行猴子修补——那只是自找麻烦。:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-02T13:45:21.370

好吧，看起来 ArrayCollection 实际上并不直接查看内存，而只是作为最后的手段。它将尝试查找对象的唯一 ID (UID)。如果 UID 不存在，它将使用 UIDUtil.as 为其创建一个。

您可以通过让您的对象实现 IUID 接口并为该对象提供您自己的 UID 来解决整个默认 UID 问题。ArrayCollection 将查看您提供的 UID。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-10T06:05:01.780

我建议一个简单的：

```
in_array($haystack, $arrayCollection->toArray()); 
```

# c++ - 连接池打开时打开第二个连接时 SQL Native Client 崩溃？

> ID：389859
> 
> 赞同：0
> 
> 时间：2008-12-23T19:39:36.273
> 
> 标签：c++, sql-server-2000, odbc, sqlncli

我正在使用一个 C++ 应用程序，该应用程序使用 SQL Native Client 通过 ODBC 与 SQL Server 2000 数据库进行通信。

在做任何数据库工作之前，我分配一个环境句柄如下：

`retcode = SQLAllocHandle( SQL_HANDLE_ENV, SQL_NULL_HANDLE, &EnvironmentHandle );`

这成功完成。

为了启用连接池，在上述语句之前，我调用：

`retcode = SQLSetEnvAttr( NULL, SQL_ATTR_CONNECTION_POOLING, (SQLPOINTER) SQL_CP_ONE_PER_HENV, SQL_IS_INTEGER );`

`SQLSetEnvAttr`，当包含时，返回一个好的代码，表示成功。但是，它会导致我的应用程序在第二次`SQLDriverConnect`调用以建立与数据库的连接时崩溃（注意：此时第一个连接将使用创建`SQLDriverConnect`并断开使用`SQLDisconnect`。）如果我将此行注释掉，应用程序将继续没有麻烦。

这可能是什么原因造成的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T19:19:24.263

您是否有机会遇到与此人相同的问题：[http ://www.mydatabasesupport.com/forums/ms-sqlserver/218008-2003-cluster-sql-2000-connection-pooling-causes-crash.html](http://www.mydatabasesupport.com/forums/ms-sqlserver/218008-2003-cluster-sql-2000-connection-pooling-causes-crash.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T09:47:49.163

这可能是完全不同的问题（即我不使用 C++），但也许它可以帮助你。

当我打开池时，我正在处理的应用程序也崩溃了。

当数据库查询返回多个记录集时会出现问题。

当我尝试移动到下一个记录集时，我的应用程序崩溃了。

这是不同的东西，但可能与您的情况有关。

# sharepoint - SharePoint 中的备注字段中允许的最大字符数是多少？

> ID：389863
> 
> 赞同：2
> 
> 时间：2008-12-23T19:40:23.697
> 
> 标签：sharepoint, moss, wss

文本字段 ( [SPFieldText](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spfieldtext.aspx) ) 有 255 个字符的限制。Note 字段 ( [SPFieldMultiLineText](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spfieldmultilinetext.aspx) ) 的限制（如果有）是多少？MSDN 上的相关文档（上面链接）没有列出这些限制。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T19:48:11.917

好吧，根据文档， notes 字段与类型设置为 note 的字段相同。这相当于 SQL Server 中的 nText 字段。这是文档中该字段的限制：

> 最大长度为 2^30 - 1 (1,073,741,823) 个字符的可变长度 Unicode 数据。

以下是链接：

您链接的页面： [spFieldMultilineText](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spfieldmultilinetext.aspx) 在该页面上它指出

> SPFieldMultiLineText 类对应于通过 Field 元素的 Type 属性指定的 Note 数据类型。

通过指向 Field 元素的链接将带您到[Field Element](http://msdn.microsoft.com/en-us/library/ms437580.aspx)

查看 Type 属性，我们看到：

> 注意 允许用户输入多行文本。此字段不可排序或分组。所有文本都被定义为没有 HTML 标记的纯 ASCII 字符。任何看起来像 HTML 标记或 URL 的东西都被简单地引用（例如，Server.HTMLEncode），看起来像纯文本。用于编辑此格式的控件是一个简单的 TEXTAREA 块。使用 NumLines 属性指定要显示的行数。对应于 ntext SQL 数据类型，由 SPFieldMultiLineText 类表示。"

特别感兴趣的是**“...对应于 ntext SQL 数据类型...”**

“ntext SQL 数据类型”的快速 google 将您带到[nText](http://msdn.microsoft.com/en-us/library/ms187993.aspx)

# asp.net - 从动态添加的 ASP.NET 用户控件中捕获事件

> ID：389904
> 
> 赞同：4
> 
> 时间：2008-12-23T19:56:24.087
> 
> 标签：asp.net, user-controls, placeholder-control

我有一个 ASP.NET Web 表单，我正在向其中添加一个可变编号的用户控件。我有两个问题：

1.  用户控件在第一个 PageLoad 事件中添加到表单上的 PlaceHolder（我只在“（！this.IsPostback）”时添加它们，但是当表单被回发时，控件消失了。这正常吗？因为表单上的其他控件保持其状态，我希望这些动态添加的控件也保留在表单上。我是否必须为每次回发添加它们？

2.  我还有一个按钮和一个按钮单击事件的事件处理程序，但是当我单击按钮时，这个事件处理程序永远不会被调用。为了捕捉动态添加的控件上的事件，我需要做些什么特别的事情吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T20:00:05.013

1.  是的，您需要在每个回发中添加它们。
2.  是的...在asp.net 调度事件之前，控件需要在控件层次结构中（即尽可能早地在页面生命周期中创建动态控件）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T19:59:11.473

1.  为此，请在页面初始化而不是页面加载时添加控件。（在回发时重新添加）
2.  您需要知道添加的按钮的 ID 以将它们绑定到事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T20:00:56.230

[1）您应该在Pre-init（页面生命周期](http://msdn.microsoft.com/en-us/library/ms178472.aspx)）上添加控件

2）您必须将事件处理程序附加到创建按钮的事件。（事件可能在页面生命周期中比以声明方式创建的控件的相同事件发生得晚得多）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T20:35:35.813

我遇到了类似的问题。我有一个显示自定义 Web 控件集合的页面。我的解决方案是添加一个额外的不可见 Web 控件，这样当我单击一个按钮以添加另一个控件时，我将只使用不可见的控件。然后在回发时，我的加载功能会向集合中添加另一个不可见的控件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-16T13:19:59.007

我昨天发现，您实际上可以通过在 loadviewstateevent 触发后立即加载控件树来使您的应用程序正常工作。如果您覆盖 loadviewstate 事件，调用 mybase.loadviewstate，然后在其后放置您自己的代码以重新生成控件，这些控件的值将在页面加载时可用。在我的一个应用程序中，我使用视图状态字段来保存可用于重新创建这些控件的 ID 或数组信息。

```
Protected Overrides Sub LoadViewState(ByVal savedState As Object)
    MyBase.LoadViewState(savedState)
    If IsPostBack Then
        CreateMyControls()
    End If
End Sub 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-09-20T12:50:19.347

我遇到了完全相同的问题，并挣扎了 5-6 个小时。我发布这个也许像我这样的人可以得到帮助。

1) 您应该在 Page.PreInit 事件中初始化您的控件。（在我的情况下，我必须将控件添加到占位符，因此我扩展了 PreInit 以加载这些控件，但您不需要这样做。这取决于您的场景。）

2) 在您的 Page.PreInit 事件中初始化它们之后，您应该将这些确切的方法绑定到您的控件。

这是我的示例代码：

```
protected override void OnPreInit(EventArgs e)
{
    // Loading controls...
    this.PrepareChildControlsDuringPreInit();

    // Getting ddl container from session and creating them...
    if (GetDDLSession().Count != 0)
    {
        foreach (DropDownList ddl in GetDDLSession())
        {
            ddl.SelectedIndexChanged += SelectedIndexChanged;
            phDropDowns.Controls.Add(ddl);
        }
    }
    base.OnPreInit(e);
}

public static void PrepareChildControlsDuringPreInit(this Page page)
{
    // Walk up the master page chain and tickle the getter on each one 
    MasterPage master = page.Master;
    while (master != null) master = master.Master;
} 
```

# c# - 如何创建一个用户控件，其大小可以大于使用 WPF 创建的大小

> ID：389905
> 
> 赞同：1
> 
> 时间：2008-12-23T19:57:08.453
> 
> 标签：c#, wpf, user-controls

我已经使用 WPF 创建了一个用户控件，我想将它添加到 window.xml 中。我已经做到了，但我不能让我的控件的高度高于它在自己的 xaml 文件中的高度。我的 MaxWidth 和 MaxHeight 都是无穷大，但我不能使控件比它在其 xaml 文件中的值高。

为了解决这个问题，我必须让我的所有用户控件都很大，这样我就可以根据需要调整它们的大小。这似乎不对，我必须遗漏一些东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-26T15:05:11.627

删除高度和宽度是要走的路。设计器（混合）具有一些特殊的设计器宽度和高度属性，可用于设计，但不会为运行时设置高度。

```
xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
 mc:Ignorable="d" d:DesignWidth="412" d:DesignHeight="230" 
```

那就是将位于 Window/UserControl 顶部的 xaml。 [这](http://www.kirupa.com/blend_wpf/design_time_sizing_pg2.htm)应该有助于解释事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T15:20:14.857

如果您使用的是 VS 设计器，我不知道有任何宽度/高度属性。但是，我在我的 xaml 中非常有效地使用了 MinWidth/MinHeight 属性来处理我认为您所描述的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T20:14:14.627

如果我删除控件 XAML 文件中的高度和宽度，我将无法将设计器用于我的用户控件。如此简短的回答，确实解决了我的问题，但现在我不能将设计器用于用户控件。看来我也好不到哪里去。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T20:27:53.820

问题可能是您的用户控件中的内部控件没有延伸到您的控件。尝试在内部控件上设置 Horizo​​ntalAlignment="Stretch" 或 Width="Auto"，或者您可以尝试绑定 Width 属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T20:32:15.963

好的，经过进一步调查，我说错了。它是导致问题的网格。如果我将网格宽度和高度设置为自动，那么一切正常，但我失去了使用设计器的能力。

我将 Grid 及其控件的所有对齐方式都设置为 Stretch。

所以总而言之，如果我设置 Grid.Width = Auto 和 Grid.Height = Auto，一切正常，但是当我这样做时，我失去了使用设计器的能力。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T20:06:29.650

为什么你希望你的控件的高度高于它在自己的 XAML 文件中的高度？难道你不能只删除控件的 XAML 文件中的高度，并在使用它的其他 XAML 文件（或代码）中声明它时显式设置控件的高度吗？

# c++ - C++ 命名空间和包含

> ID：389922
> 
> 赞同：45
> 
> 时间：2008-12-23T20:04:20.327
> 
> 标签：c++, namespaces, header-files

为什么我们在 C++ 程序中同时需要`using namespace`和指令？`include`

例如，

```
#include <iostream>

using namespace std;

int main() {
 cout << "Hello world";
} 
```

`#include <iostream>`为什么仅仅拥有或仅仅拥有`using namespace std`并摆脱另一个是不够的？

（我在想一个与 Java 的类比，从哪里`import java.net.*`导入所有内容`java.net`，你不需要做任何其他事情。）

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-12-23T21:30:24.380

using 指令和 include 预处理器指令是两个不同的东西。`include`大致对应Java的环境`CLASSPATH`变量，或者`-cp`java虚拟机的选项。

它所做的就是让编译器知道这些类型。仅包括`<string>`例如将使您能够参考`std::string`：

```
#include <string>
#include <iostream>

int main() {
    std::cout << std::string("hello, i'm a string");
} 
```

现在，使用指令就像`import`在 Java 中一样。它们使名称在它们出现的范围内可见，因此您不必再完全限定它们。就像在 Java 中一样，必须知道使用的名称才能使其可见：

```
#include <string> // CLASSPATH, or -cp
#include <iostream>

// without import in java you would have to type java.lang.String . 
// note it happens that java has a special rule to import java.lang.* 
// automatically. but that doesn't happen for other packages 
// (java.net for example). But for simplicity, i'm just using java.lang here.
using std::string; // import java.lang.String; 
using namespace std; // import java.lang.*;

int main() {
    cout << string("hello, i'm a string");
} 
```

在头文件中使用 using 指令是一种不好的做法，因为这意味着碰巧包含它的每个其他源文件都将使用非限定名称查找来查看这些名称。与在 Java 中，您只使名称对出现导入行的包可见，而在 C++ 中，如果它们直接或间接包含该文件，它会影响整个程序。

即使在实现文件中，在全局范围内执行此操作时也要小心。最好尽可能在本地使用它们。对于命名空间 std，我从不使用它。我和许多其他人，总是写`std::`在名字前面。但是，如果您碰巧这样做，请这样做：

```
#include <string>
#include <iostream>

int main() {
    using namespace std;
    cout << string("hello, i'm a string");
} 
```

* * *

关于命名空间是什么以及为什么需要它们，请阅读 Bjarne Stroustrup 在 1993 年提出的将它们添加到即将到来的 C++ 标准中的提案。写的很好：

[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/1993/N0262.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/1993/N0262.pdf)

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-12-23T20:10:42.217

在`C++`概念上是分开的。这是设计和有用的。

您可以包含没有名称空间会模棱两可的内容。

使用命名空间，您可以引用两个具有相同名称的不同类。当然，在这种情况下，您不会使用该`using`指令，或者如果您使用了，则必须在您想要的名称空间中指定其他东西的名称空间。

另请注意，您不需要 using - 您可以使用 std::cout 或您需要访问的任何内容。您在项目前加上名称空间。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-23T20:12:17.127

在 C++中`#include`并`using`具有不同的功能。

`#include`将包含文件的文本放入源文件（实际上是[翻译单元](http://en.wikipedia.org/wiki/Translation_unit)），另一方面，命名空间只是一种具有唯一名称的机制，以便不同的人可以创建“foo”对象。

这来自 C++ 没有模块的概念。

请记住，C++ 中的命名空间是开放的，这意味着不同的文件可以定义同一命名空间的不同部分（有点像 .NET 的部分类）。

```
//a.h
namespace eg {
    void foo();
}

//b.h
namespace eg {
    void bar();
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-23T20:13:00.090

包含定义功能的存在。

使用使它们更容易使用。

`cout`iostream 中定义的实际名称为“std::cout”。

您可以通过编写来避免使用命名空间。

```
std::cout << "Hello World"; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-23T20:22:55.093

这些关键字用于不同的目的。

using 关键字使命名空间中的名称可在当前声明区域中使用。它主要是为了方便，这样您就不必一直使用完全限定名称。这个[页面](http://www.cplusplus.com/doc/tutorial/namespaces.html)详细解释了它。

#include 语句是一个预处理器指令，它告诉预处理器处理指定文件的内容，就好像这些内容已经出现在源程序中指令出现的位置一样。也就是说，您可以将此语句视为将包含的文件复制到当前文件中。然后编译器编译整个文件，就好像您将所有代码写在一个大文件中一样。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-23T21:28:45.647

我认为其他答案略微忽略了这一点。在所有 C++、Java 和 C# 中，`using`/`import`事物是完全可选的。所以这没有什么不同。

然后你必须做一些其他的事情来让代码在所有三个平台上都是可见的。

在 C++ 中，您至少必须将其包含到当前的翻译单元中（对于向量、字符串等的许多实现来说已经足够了），通常您还必须向链接器添加一些内容，尽管有些库会根据包括（例如，在 Windows 上构建时提升）。

在 C# 中，您必须添加对其他程序集的引用。这会处理包含和链接设置的等价物。

而在Java 中，您必须确保代码位于类路径中，例如将相关的jar 添加到其中。

因此，在所有三个平台上都需要非常相似的东西，并且`using`/ `import`（方便）和实际链接解析（要求）之间的分离在所有三个平台上都是相同的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-23T21:34:02.733

正如所指出的，C++ 和 Java 是不同的语言，并且做的事情有些不同。此外，C++ 更像是一种“开玩笑的”语言，而 Java 更像是一种设计语言。

虽然`using namespace std;`不一定是一个坏主意，但将它用于所有名称空间将消除整个好处。命名空间的存在使您可以编写模块而不用考虑与其他模块的名称冲突，并且`using namespace this; using namespace that;`可以产生歧义。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-23T20:13:25.627

如果你想真正理解这一点，你需要理解[命名空间。](http://www.glenmccl.com/ns_comp.htm)

`include`你只包括头文件。

随着`using namespace`您声明您正在使用包含诸如 cout 之类的东西的给定名称空间。所以如果你这样做：

```
using namespace std; 
```

你用`cout`你可以做

```
cout << "Namespaces are good Fun"; 
```

代替：

```
std::cout << "Namespaces are Awesome"; 
```

请注意，如果您不这样做，`#include <iostream>`您将无法在声明等中使用两者，因为您不包括标题`std::cout`。`cout`

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-23T22:20:55.743

甚至 Stroustrup 也称这种`#include`机制有些骇人听闻。然而，它确实使单独编译变得更加容易（运送编译的库和头文件而不是所有源代码）。

真正的问题是“为什么 C++ - 在它已经有了`#include`机制之后 - 添加命名空间？”

我所知道的关于为什么`#include`还不够的最好例子来自 Sun。显然，Sun 开发人员在使用他们的一个产品时遇到了一些问题，因为他们编写了一个函数，该函数恰好具有与从一个文件中包含`mktemp()`的函数相同的签名，而该文件本身是通过项目实际需要的头文件包含的。`mktemp()`

当然，这两种功能是不兼容的，不能用一种代替另一种。另一方面，编译器和链接器在构建二进制文件时并没有意识到这一点，有时`mktemp()`会调用一个函数，有时会调用另一个函数，这取决于不同文件的编译或链接顺序。

问题源于这样一个事实，即 C++ 最初与 C 兼容——并且基本上是在 C 之上搭载的。而 C 只有一个全局名称空间。C++ 通过命名空间解决了这个问题——在与 C 不兼容的代码中。

C# 和 Java (1) 都有命名空间机制（`namespace`在 C# 中，`package`在 Java 中），(2) 通常是通过为开发人员处理引用二进制文件的 IDE 开发的，并且 (3) 不允许独立函数（类范围是一个命名空间，并降低了污染全局命名空间的风险），因此他们对这个问题有不同的解决方案。但是，对于您正在调用的方法仍然可能存在一些歧义（例如，类继承的两个接口之间的名称冲突），在这种情况下，所有三种语言都需要程序员明确指定它们是哪种方法实际寻找，通常是在父类/接口名称前面加上。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-24T08:22:39.523

一个班轮（并不是说这是新事物:)）：

*使用 std*允许您省略*std::*前缀，但如果没有*iostream*则根本不能使用*cout*。

 ** * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-05-25T15:47:45.293

在 C++ 中，include 指令将在预处理步骤中将头文件复制并粘贴到源代码中。需要注意的是，头文件通常包含在命名空间中声明的函数和类。例如，`<vector>`标头可能类似于以下内容：

```
namespace std {
    template <class T, class Allocator = allocator<T> > class vector;
    ...
} 
```

假设您需要在 main 函数中定义一个向量，您这样做`#include <vector>`了，并且您的代码中现在有上面的代码：

```
namespace std {
    template <class T, class Allocator = allocator<T> > class vector;
    ...
}
int main(){
   /*you want to use vector here*/
} 
```

请注意，在您的代码中，矢量类仍位于`std`命名空间中。但是，您的 main 函数位于默认`global`命名空间中，因此仅包含标头不会使向量类在`global`命名空间中可见。您必须使用`using`或使用前缀 like `std::vector`。

# c - 为什么我不能使用 fork() 获得 system V 消息队列？

> ID：389923
> 
> 赞同：-1
> 
> 时间：2008-12-23T20:04:25.210
> 
> 标签：c, linux, message-queue

我这里有一个程序：

```
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/ipc.h>
#include <sys/types.h>
#include <sys/msg.h>
#include <sys/wait.h>
#include <errno.h>

#include "linkedlist.h"
#include "globals.h"
#include "card.h"
#include "logging.h"
#include "stack.h"
#include "servers.h"
#include "player.h"

#define VERSION "0.1"

#define ERR -1

/*
 * Main function runs, loads 5 named table objects. For each table
 * created a fork is created for that specific table object that
 * allows each table to run independently.
 *
 * Usernames details are also created and prepared. These are hardcoded
 * until I add database logic later.
 *
 * After the tables are prepared, the main function starts a server
 * listening thread that waits for UNIX sockets to connect to it. When
 * they arrive it spawns a handling thread that does a quick login check
 * and then asks the user which of the named tables they want to play on
 *
 * The socket information is then connected to the table, so the table can
 * then communicate with user. When the table is full, the table algorithm
 * is responcible for basically looping contineously, creating new "games"
 * until only one player is left. He is the winner. When he wins, the table
 * exits.
 *
 * the game loop does all the real work for the texas holdem game, hosting
 * rounds of bets, dealing cards etc.
 */

void table_process(int tables_id);
void main_game_loop(void);

int main(int argc, char **argv)
{
  int main_process_id;
  int connection_process_id;

  char table_config_name[8];
  char *table_name;
  stack *my_deck;
  card *current_card;
  int i;
  int s;

  printf("------------ PRT POKER -----------\nA texas holdem poker server\n~~~~Version: %s~~~~~~~\n", VERSION);

  config_load("poker.conf");
  logging_init();

  if (key = ftok("/mnt/mydocuments/git/texas_holdem/poker", 'a') == -1)
  {
    logging_critical("Call to ftok failed");
    exit(1);
  }

//  if ((msg_queue = msgget(key, 0644 | IPC_CREAT)) == -1)
//  {
//    logging_critical("call to msgget failed");
//    exit(1);
//  }

  //read int the list of tables from the configuration file

  config_get_int("players_per_table", &player_count);
  logging_info("players per table: %i", *player_count);

  config_get_int("table_count", &table_count);
  logging_info("number of tables: %i", *table_count);

  table_names = malloc(sizeof(char*) * (*table_count));

  logging_info("Table count: %d", *table_count);

  for (i = 0; i < *table_count; i++)
  {
    sprintf(table_config_name, "table_%d", (i + 1));  
    config_get_string(table_config_name, &table_name);

    table_names[i] = table_name;

    logging_info("Created table %d: %s", i, table_name);

    if (fork() == 0)
    {
      table_process(i);
      _exit(0);
    }
  }

  main_process_id = getpid();

  connection_process_id = fork();
  logging_info("connecton process: %d", connection_process_id);

  if (connection_process_id == 0)
  {
    wait_for_players();
    _exit(0);
  }
  else
    waitpid(connection_process_id, &s, 0);

  logging_info("Application ended");
  return 0;
}

void table_process(int table_id)
{
  linkedlist *players;
  player *p;
  int players_added;

  if ((msg_queue = msgget(key, 0644 | IPC_CREAT)) == -1)
  {
    logging_critical("call to msgget failed");
    exit(1);
  }

  logging_info("table %s (%i) running in process %d", table_names[table_id], table_id, getpid());

  players = linkedlist_new();

  players_added = *player_count;
  while (players_added > 0)
  {
    logging_info("still waiting for %i players to join %s with queue id %i", players_added, table_names[table_id], table_id + MSG_QUEUE_OFFSET);

    //THIS DOESN'T WORK!!!! IT DOESN'T WAKE UP
    if (msgrcv(msg_queue, &p, sizeof(player), table_id + MSG_QUEUE_OFFSET, 0) == -1)
    {
      logging_critical("recieving from message queue failed");
      _exit(1);
    }
    else
      logging_info("played joined %s", table_names[table_id]);

    logging_debug("player = %s, %s", p->name, p->password);

    players_added--;
  }

  logging_info("table %s ready to start!!!!!", table_names[table_id]);
}

void main_game_loop(void)
{
  logging_debug("main_game_loop");
} 
```

该程序应该启动并分叉成 4 个线程。前三个线程调用 msgget() 来创建系统 V 消息队列。

然后他们都调用 msgrcv() 并等待不同的 id 出现。

第四个线程侦听连接的客户端，然后调用 msgsnd()。出于某种原因，没有一个等待消息的分叉再次醒来。

1.  我确定消息队列是正确的。

2.  我在 msgsrcv 之前有一个打印语句，所以我可以看到每个语句的分叉都正确发生。之后还有一个打印语句，所以我可以看到代码没有通过它。

3.  我已经从命令提示符运行了 ipcs。

4.  肯定创建了一个消息队列，并且其中肯定有一条消息。

5.  如果我将 msgrcv 更改为“0”，那么其中一个线程将唤醒，但这不是我想要的行为。

6.  msgget() 不会引发错误。

7.  msgsnd() 没有抛出错误。

8.  我很肯定结构中的 id 是正确的。

任何想法我做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T20:26:27.847

至少有一件事是错误的：您已将“p”声明为指向播放器的指针，并且在将其传递给 msgrcv 时再次获取了它的地址。更重要的是，您传递的大小很可能对于指针来说太大了（即 sizeof(player) > sizeof(player*)）。堆栈损坏等待发生。

或者，尝试使用 strace（在 Linux 上；在 Solaris 上使用 truss）实时查看发生了什么。

# unix - Unix kill 命令是否确保动态分配的内存将正确返回？

> ID：389927
> 
> 赞同：6
> 
> 时间：2008-12-23T20:05:19.340
> 
> 标签：unix, memory-management, operating-system, kill

我在新分配的项目中发现了一堆脚本，它们是“关闭”脚本。他们只是做一些基本的搜索并运行 Unix`kill`命令。他们有什么理由不应该以这种方式关闭进程？这是否确保动态分配的内存将正确返回？还有其他负面影响吗？我的直觉是，这是终止进程的最后手段。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-23T20:11:45.957

该`kill`命令向 Unix 进程发送信号。该信号默认为 SIGTERM，这是程序退出的礼貌请求。

当进程因任何原因退出时，Unix 操作系统**会**清理其内存分配、文件句柄和其他资源。唯一没有被清理的资源是那些应该被共享的资源，比如文件和共享内存的内容（比如 System V IPC）。

许多程序不需要在退出时进行任何特殊清理并使用默认的 SIGTERM 行为，即让操作系统停止进程。

如果一个程序确实需要特殊行为，它可以安装一个信号处理程序，然后它可以运行一个函数来处理信号。

现在 SIGKILL 信号，即数字 9，**是**邪恶的，但也是必要的。这个信号永远不会到达进程本身，操作系统会简单地停止进程。这应该只在真正需要时使用。在陷入死锁的多线程程序或安装了 TERM 信号处理程序但在退出过程中搞砸的程序中，它通常变得必要。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-23T20:09:05.293

**kill**是程序结束的礼貌请求。它清理它的内存，关闭它的句柄和其他类似的细节。它发送一个 SIGTERM

**kill -9**告诉操作系统通过球抓住进程并将其扔出酒吧。显然它并不关心细节——尽管它确实回收了所有内存，因为它是操作系统的责任来跟踪它。但是因为它是强制关闭，所以在尝试再次运行程序时可能会遇到问题（例如，不清理 .pid 文件）

另见 [维基百科]( [http://en.wikipedia.org/wiki/Kill_(Unix)](http://en.wikipedia.org/wiki/Kill_(Unix))

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-23T20:08:58.833

每个进程都在自己的受保护地址空间中运行，当进程结束时（无论是自愿退出还是被外部信号杀死），该地址空间将被完全回收。所以是的，只要它的内存被正确释放。

根据过程，下次尝试运行它时可能会或可能不会导致其他问题。例如，如果它被意外终止，它可能会打开一些文件并使它们处于不一致的状态。（文件会自动关闭，但可能是在写入一些应用程序数据的过程中，如果被中断，文件可能包含不完整/不一致的数据。）

通常，当系统关闭时，所有进程都会收到信号 15 (SIGTERM)，在该信号上它们可以执行任何需要执行的清理/关闭操作。然后不久之后，他们将收到信号 9 (SIGKILL)，立即杀死他们，而没有给他们任何反应的机会。这使所有进程都有机会自行清理，然后强行终止任何未及时响应的进程。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T20:09:22.017

```
kill -9 
```

是不得已而为之，不是`kill`。

1.  是的，内存被回收（这是操作系统的责任）
2.  程序可以随心所欲地响应信号，由特定程序来做“正确的事情”

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T20:10:12.140

默认情况下，kill 将发送终止信号，该信号将允许进程正常退出。如果进程似乎没有及时退出，一些脚本将退回到 kill -9 强制退出，“准备好与否”。

在所有情况下，操作系统管理的东西都将被返回，例如动态内存、文件关闭等。但是应用程序级别的东西可能不会在 -9 杀戮时被整理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T20:13:21.743

`kill`只是向进程发送一个信号。该进程可以捕获信号（信号 9 除外）并运行代码以执行关闭。应用程序的关闭应该是短暂的，但它可能不是瞬时的。

无论如何，一旦进程退出，操作系统将回收动态分配的内存，关闭打开的文件描述符和其他资源。

可能有一些资源仍然存在，例如，如果应用程序拥有共享内存或其他（仍然存在的）进程也拥有的套接字。

# ruby-on-rails - 如何获得基于 FreeBSD 构建的 Hpricot 0.6 Gem？

> ID：389931
> 
> 赞同：1
> 
> 时间：2008-12-23T20:08:12.643
> 
> 标签：ruby-on-rails, freebsd, hpricot

当我在我的 FreeBSD 服务器上运行 rake gems:build with hpricot 0.6.164 时，我得到：

> 错误：无法构建 gem 原生扩展。
> 
> /user/localbin/ruby18 extconf.rb gems:build RB_USER_INSTALL 检查 -lc 中的 main() ...是创建 Makefile
> 
> 制作
> 
> make install /usr/bin/install -c -o root -g wheel -m 0755 hpricot_scan.so /user_directory/vendor/gems/hpricot-0.6.164/lib/universal-java1.6 安装：/user_directory/vendor/gems /hpricot-0.6.164/lib/universal-java1.6/hpricot_scan.so: chown/chgrp: 不允许操作 *** 错误代码 71
> 
> 在 /user_directory/vendor/gems/hpricot-0.6.164/ext/hpricot_scan 中停止。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T20:13:32.803

我发现在运行 rake gems:build 命令时需要将 RB_USER_INSTALL 设置为 true。

例子：

> RB_USER_INSTALL=true rake gems:build

# python - 如何从 Python 中读取 Perl 数据结构？

> ID：389945
> 
> 赞同：11
> 
> 时间：2008-12-23T20:11:08.393
> 
> 标签：python, perl, configuration, data-structures

我经常看到人们使用 Perl 数据结构来代替配置文件。即一个单独的文件，仅包含：

```
%config = (
    'color' => 'red',
    'numbers' => [5, 8],
    qr/^spam/ => 'eggs'
); 
```

使用纯 Python 将这些文件的内容转换为与 Python 等效的数据结构的最佳方法是什么？目前我们可以假设没有要评估的真实表达式，只有结构化数据。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-23T20:19:38.547

是否需要使用纯 Python？如果没有，您可以在 Perl 中加载它并将其转换为 YAML 或 JSON。然后使用 PyYAML 或类似的东西在 Python 中加载它们。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-24T01:41:06.510

我只是把 Perl 数据结构变成别的东西。没有看到实际文件，我的解决方案可能没有做一些额外的工作。

如果文件中唯一的内容是一个变量声明（所以，`1;`最后没有，等等），将`%config`它转换为 YAML 非常简单：

```
perl -MYAML -le 'print YAML::Dump( { do shift } )' filename 
```

返回它评估的`do`最后一个东西，所以在这个小代码中它返回哈希键值对的列表。诸如 YAML::Dump 之类的东西喜欢使用引用，因此它们可以得到有关顶层结构的提示，所以我通过`do`用花括号括起来将其变成哈希引用。对于你的例子，我会得到这个 YAML 输出：

```
---
(?-xism:^spam): 鸡蛋
红色
数字：
  - 5
  - 8

```

不过，我不知道 Python 会如何喜欢那个字符串化的正则表达式。你真的有一个正则表达式的键吗？我很想知道如何将其用作配置的一部分。

* * *

如果文件中有多余的东西，生活就会更加艰难。可能有一个非常聪明的方法可以解决这个问题，但我使用了相同的想法，只是硬编码了我想要的变量名。

我在 CPAN.pm 模块使用的 Perl 数据结构上尝试了这个，看起来效果很好。唯一丑陋的是它提供的变量名的先验知识。既然您已经看到 Perl 代码中的配置错误，请避免在 Python 代码中犯同样的错误。:)

YAML：

```
 perl -MYAML -le 'do shift; print YAML::Dump( $CPAN::Config )' MyConfig.pm 
```

JSON：

```
 perl -MJSON::Any -le 'do shift; my $j = JSON::Any->new; print $j->objToJson( $CPAN::Config )' MyConfig.pm 
```

或者

```
# suggested by JF Sebastian
perl -MJSON -le 'do shift; print to_json( $CPAN::Config )' MyConfig.pm 
```

XML::Simple 效果不佳，因为它将所有内容都视为属性，但也许有人可以对此进行改进：

```
perl -MXML::Simple -le 'do shift; print XMLout( $CPAN::Config )' MyConfig.pm 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-23T20:56:23.230

不确定用例是什么。这是我的假设：您将进行一次从 Perl 到 Python 的一次性转换。

Perl 有这个

```
%config = (
    'color' => 'red',
    'numbers' => [5, 8],
    qr/^spam/ => 'eggs'
); 
```

在 Python 中，它将是

```
config = {
    'color' : 'red',
    'numbers' : [5, 8],
    re.compile( "^spam" ) : 'eggs'
} 
```

所以，我猜这是一堆要替换的RE

*   `%variable = (`和`variable = {`
*   `);`和`}`
*   `variable => value`和`variable : value`
*   `qr/.../ =>`和`re.compile( r"..." ) : value`

然而，Python 的内置`dict`函数并没有使用正则表达式作为哈希键做任何不寻常的事情。为此，您必须编写自己的子类`dict`，并覆盖`__getitem__`以单独检查 REGEX 键。

```
class PerlLikeDict( dict ):
    pattern_type= type(re.compile(""))
    def __getitem__( self, key ):
        if key in self:
            return super( PerlLikeDict, self ).__getitem__( key )
        for k in self:
            if type(k) == self.pattern_type:
                if k.match(key):
                    return self[k]
        raise KeyError( "key %r not found" % ( key, ) ) 
```

这是使用类似 Perl 的 dict 的示例。

```
>>> pat= re.compile( "hi" )
>>> a = { pat : 'eggs' } # native dict, no features.
>>> x=PerlLikeDict( a )
>>> x['b']= 'c'
>>> x
{<_sre.SRE_Pattern object at 0x75250>: 'eggs', 'b': 'c'}
>>> x['b']
'c'
>>> x['ji']
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 10, in __getitem__
KeyError: "key 'ji' not found"
>>> x['hi']
'eggs' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T23:57:12.180

我也找到[了 PyPerl](http://search.cpan.org/dist/pyperl/)，但似乎没有得到维护。我想这就是我正在寻找的东西——一个对 Perl 做了一些基本解释并将结果作为 Python 对象传递的模块。一个死于任何过于复杂的 Perl 解释器都可以。:-)

# c++ - 基类的前向声明

> ID：389957
> 
> 赞同：19
> 
> 时间：2008-12-23T20:13:45.207
> 
> 标签：c++, class, forward-declaration

我正在尝试创建适当的头文件，其中不包含太多其他文件以保持它们清洁并加快编译时间。

我在执行此操作时遇到了两个问题：

1.  基类的前向声明不起作用。

    ```
    class B;

    class A : public B
    {

        // ...
    } 
    ```

2.  STD 类的前向声明不起作用。

    ```
    namespace std
    {
        class string;
    }

    class A
    {
        string aStringToTest;
    } 
    ```

我该如何解决这些问题？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-23T20:16:46.010

第一个你不能解决的问题。

第二个问题与标准库类无关。这是因为您将类的实例声明为您自己的类的成员。

这两个问题都是由于要求编译器必须能够从其定义中找出类的总大小。

但是，编译器可以计算出指向类的指针的大小，即使它还没有完整的定义。因此，在这种情况下，一个可能的解决方案是在消费类中拥有一个指针（或引用）成员。

在基类案例中没有多大帮助，因为您不会得到“是”关系。

也不值得为之类的事情做`std::string`。首先，它应该是一个方便的字符缓冲区包装器，以使您免于对如此简单的事情进行内存管理。如果你然后持有一个指向它的指针，只是为了避免包含标题，你可能把一个好主意走得太远了。

其次（正如评论中指出的那样），`std::string`是`std::basic_string<char>`. 所以你需要转发声明（然后使用）它，到那时事情变得非常模糊和难以阅读，这是另一种成本。是不是真的值得吗？

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-23T21:33:29.397

正如 Earwicker 之前回答的那样，在任何一种情况下都不能使用前向声明，因为编译器需要知道类的大小。

您只能在一组操作中使用前向声明：

*   声明将前向声明的类作为参数或返回它的函数
*   声明成员指针或对前向声明类的引用
*   在类定义中声明前向声明类型的静态变量

你不能用它来

*   声明给定类型的成员属性（编译器需要大小）
*   定义或创建该类型的对象或删除它
*   调用类的任何静态或成员方法或访问任何成员或静态属性

（我忘记了吗？）

考虑到声明 an`auto_ptr`与声明原始指针不同，因为`auto_ptr`实例化将在指针超出范围时尝试删除指针，并且删除需要类型的完整声明。如果使用`auto_ptr`in 来保存前向声明的类型，则必须提供析构函数（即使为空）并在看到完整的类声明后定义它。

还有一些其他的微妙之处。当您转发声明一个类时，您是在告诉编译器它将是一个类。这意味着它不能是一个`enum`或`typedef`另一个类型。这就是您尝试转发 declare 时遇到的问题`std::string`，因为它是模板的特定实例化的 typedef：

```
typedef basic_string<char> string; // aproximate 
```

要转发声明字符串，您需要转发声明`basic_string`模板，然后创建`typedef`. 问题是标准没有说明`basic_string`模板采用的参数数量，它只是说明如果它采用多个参数，则其余参数必须具有默认类型，以便上面的表达式编译。这意味着没有标准的方式来向前声明模板。

另一方面，如果您想转发声明一个非标准模板（即非 STL），只要您知道参数的数量，您就可以这样做：

```
template <typename T, typename U> class Test; // correct
//template <typename T> class Test; // incorrect even if U has a default type

template <typename T, typename U = int> class Test {
   // ...
}; 
```

最后，罗迪给你的建议是：尽可能多地前向声明，但假设必须包含一些东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-23T20:15:56.667

在这两种情况下，编译器都需要知道类型的大小。因此，前向声明是不够的。基类可以添加成员或需要虚拟表。字符串成员需要增加类的大小以存储 STL 字符串类的大小。

前向声明 STL 类通常是不可取的，因为实现通常包括加速编译的显式模板实例化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T20:17:51.030

您正在努力解决实际上不是问题的事情。使用您需要的头文件，并在可能的情况下减少对它们的要求。但不要试图把它推向极端，因为你会失败。

在某些情况下，PIMPL 成语可能会对您有所帮助，但不是在这里。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T20:20:45.877

对于您的基类，您需要拥有完整的类型定义，而不仅仅是声明。派生类型标头将需要#include 其基类的标头。

对于 std 命名空间中的类，您必须包含正确的标头 - 在这种情况下为 <string> - 然后执行以下三件事之一：

1.  完全限定类型：std::string aStringToTest

2.  只为该类型添加 using 声明： using std::string;

3.  为 std 命名空间添加 using 声明： using namespace std;

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T17:01:48.940

> 似乎前向声明对基类和 stl 类没有用。

更正...前向声明对于基类和对象成员是不合适的。（不是“无用”，而是“不适用”。）

基类在被声明为另一个类的基类时必须被声明（而不是前向声明）。

一个对象成员必须在被另一个类声明时被声明（而不是前向声明），或者作为参数，或者作为返回值。注意：按引用或按指针没有该约束。

更正... STL 类的前向声明是——根据 ISO 14882——未定义的行为。 [http://www.gotw.ca/gotw/034.htm](http://www.gotw.ca/gotw/034.htm)

# c# - C#的源代码分析工具

> ID：389968
> 
> 赞同：15
> 
> 时间：2008-12-23T20:18:54.337
> 
> 标签：c#

> **可能重复：**
> [哪些静态分析工具可用于 C#？](https://stackoverflow.com/questions/38635/what-static-analysis-tools-are-available-for-c)

伙计们，我正在寻找 C# 的开源或免费源代码分析工具。该工具应该能够从源代码生成指标，例如圈复杂度、行数、注释行数、SEI 可维护性等。有人知道这样的工具吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T20:36:32.930

NDepend 将为您的代码提供大量统计信息：

[http://codebetter.com/blogs/patricksmacchia/archive/2008/11/25/composing-code-metrics-values.aspx](http://codebetter.com/blogs/patricksmacchia/archive/2008/11/25/composing-code-metrics-values.aspx)

有一个免费的“试用”版本，它包含的功能比专业产品少，但可以免费用于开源和学术开发。下载页面上的试用版会在上一个版本用完之前更新为新版本：

[http://www.ndepend.com/NDependDownload.aspx](http://www.ndepend.com/NDependDownload.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-23T20:32:00.473

[NDepend](http://www.ndepend.com/)对非学术或开源软件的使用不是免费的，但它很棒，并且会为您提供这些指标（以及许多其他指标，使用其内置的代码查询语言）。

这个问题或多或少是这个问题的欺骗：[Calculate code metrics](https://stackoverflow.com/questions/60394/calculate-code-metrics)，你会在那里找到一整套好的建议。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T20:37:42.893

[Gendarme](http://mono-project.com/Gendarme)是完全开源和免费的。这是mono下的一个子项目。您可以通过三种方式运行这些工具：向导、控制台、NAnt。它将生成一个总结所有违反规则的 html 报告。值得一看。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-09T05:33:07.180

[SourceMonitor](http://www.campwoodsw.com/sourcemonitor.html)是一个免费的 C# 度量工具，它已经相当老了，但它仍然很有用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T20:28:54.410

反射器有很多插件（也是免费的）：

[反射器插件](http://www.codeplex.com/reflectoraddins)

我相信 CodeMetrics 插件可以满足您的需求

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-30T11:17:14.767

[Axivion Bauhaus Suite](http://www.software-acumen.com/bauhaus/overview/)可免费用于学术用途，但不可用于商业用途。

这包括：

*   软件架构可视化
*   软件架构规则检查
*   界面分析
*   循环检测
*   克隆（拷贝）检测
*   死码检测
*   检测代码风格违规
*   一整套预定义的软件指标
*   添加您自己的指标和分析的能力...

在各种平台上支持 C/C++、C#、Java

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T20:40:52.763

[Visual Studio 的代码指标](http://blogs.msdn.com/fxcop/archive/2007/10/03/new-for-visual-studio-2008-code-metrics.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-23T21:12:46.927

大多数这些功能都包含在 Visual Studio 2008 Team System 中。

在工具下 | 分析菜单中有代码指标选项。大多数你想要的特性都在那里：圈复杂度、LOC 和 Microsoft 的（SEI 可维护性指数的一个变体，它从 0 到 100，其中 100 是最可维护的）——以及继承深度和类耦合作为奖金功能。它不包括注释行数。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-04-08T18:23:37.137

[我为 .Net - Nitriq](http://www.nitriq.com)编写了一个（完全）免费的代码分析应用程序

# multithreading - _nolock CRT 函数

> ID：389989
> 
> 赞同：2
> 
> 时间：2008-12-23T20:24:22.173
> 
> 标签：multithreading, visual-c++, crt

我最近发现了[_nolock 函数](http://msdn.microsoft.com/en-us/library/ms235386.aspx)的存在，我很惊讶我在这些方面能找到这么少的信息。它说它提高了性能，但我找不到任何基准。它还说，如果程序自己锁定，它们可以在多线程程序中使用，但是必须锁定什么？所有 CRT 调用都应该通过同一个锁吗？每个功能一个？每组功能一个？如果是这样，什么定义了组？

您能否指出有关这些功能的一些详细信息？谢谢 ：-）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T20:31:00.617

如果您从多个线程访问该文件，则需要锁定对该文件的访问。否则，一个线程可以写在另一个线程的中间。通过打印到 stdio 来试用它们以查看效果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T20:39:09.803

如果您点击各个函数的链接，您将看到以下行：

> 仅在线程安全上下文中使用此函数，例如单线程应用程序或调用范围已处理线程隔离的情况。

对性能差异进行基准测试的唯一方法是创建一个小程序并对其进行测试。正如 monjardin 指出的那样，您需要使用该函数锁定对您正在访问的文件的访问（除非，如文档中所述，您处于单线程环境中）。

# c# - Extracting mantissa and exponent from double in c#

> ID：389993
> 
> 赞同：31
> 
> 时间：2008-12-23T20:26:10.657
> 
> 标签：c#, .net, floating-point

Is there any straightforward way to get the mantissa and exponent from a double in c# (or .NET in general)?

I found [this example](https://jonskeet.uk/csharp/DoubleConverter.cs) using Google, but I'm not sure how robust it would be. Could the binary representation for a double change in some future version of the framework, etc?

The other alternative I found was to use System.Decimal instead of double and use the [Decimal.GetBits()](https://docs.microsoft.com/en-us/dotnet/api/system.decimal.getbits) method to extract them.

Any suggestions?

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-23T21:03:08.710

The binary format shouldn't change - it would certainly be a breaking change to existing specifications. It's defined to be in IEEE754 / IEC 60559:1989 format, as Jimmy said. (C# 3.0 language spec section 1.3; ECMA 335 section 8.2.2). The code in DoubleConverter should be fine and robust.

For the sake of future reference, the relevant bit of the code in the example is:

```
public static string ToExactString (double d)
{
    …

    // Translate the double into sign, exponent and mantissa.
    long bits = BitConverter.DoubleToInt64Bits(d);
    // Note that the shift is sign-extended, hence the test against -1 not 1
    bool negative = (bits & (1L << 63)) != 0;
    int exponent = (int) ((bits >> 52) & 0x7ffL);
    long mantissa = bits & 0xfffffffffffffL;

    // Subnormal numbers; exponent is effectively one higher,
    // but there's no extra normalisation bit in the mantissa
    if (exponent==0)
    {
        exponent++;
    }
    // Normal numbers; leave exponent as it is but add extra
    // bit to the front of the mantissa
    else
    {
        mantissa = mantissa | (1L << 52);
    }

    // Bias the exponent. It's actually biased by 1023, but we're
    // treating the mantissa as m.0 rather than 0.m, so we need
    // to subtract another 52 from it.
    exponent -= 1075;

    if (mantissa == 0) 
    {
        return negative ? "-0" : "0";
    }

    /* Normalize */
    while((mantissa & 1) == 0) 
    {    /*  i.e., Mantissa is even */
        mantissa >>= 1;
        exponent++;
    }

    …
} 
```

The comments made sense to me at the time, but I'm sure I'd have to think for a while about them now. After the very first part you've got the "raw" exponent and mantissa - the rest of the code just helps to treat them in a simpler fashion.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T20:30:23.940

The representation is a IEEE standard and shouldn't change.

[https://msdn.microsoft.com/en-us/library/system.double(v=vs.110).aspx](http://msdn.microsoft.com/en-us/library/aa691146(VS.71).aspx)

> The Double type complies with the IEC 60559:1989 (IEEE 754) standard for binary floating-point arithmetic.

EDIT: The reason why decimal has a getBits and double does not is that decimal preserves significant digits. 3.0000m == 3.00m but the exponents/mantissas are actually different. I think floats/doubles are uniquely represented.

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2021-04-12T21:50:47.110

I can think of another way by using `double.ToString("E17")` and parsing the resulting scientific notation string. But this method will be inaccurate for the mantissa extraction if the double has too many significant digits.

```
public class DoubleParser
{
    public static int GetExponent(double d)
    {
        var doubleParts = ExtractScientificNotationParts(d);
        return Convert.ToInt32(doubleParts[1]);
    }

    public static double GetMantissa(double d)
    {
        var doubleParts = ExtractScientificNotationParts(d);
        return Convert.ToDouble(doubleParts[0]);
    }

    private static string[] ExtractScientificNotationParts(double d)
    {
        var doubleParts = d.ToString(@"E17").Split('E');
        if (doubleParts.Length != 2)
            throw new ArgumentException();

        return doubleParts;
    }
} 
```

Use the class above like so:

```
var value1 = 43948530544.3433;
var mantissa = DoubleParser.GetMantissa(value1);  // 4.39485305443433
var exponent = DoubleParser.GetExponent(value1);  // 10

var value2 = 0.00000000009869232667160136;
mantissa = DoubleParser.GetMantissa(value2);  // 9.8692326671601371
exponent = DoubleParser.GetExponent(value2);  // -11 
```*******