# StackOverflow 问答 000472000-000472999

# python - __slots__ 的用法？

> ID：472000
> 
> 赞同：1011
> 
> 时间：2009-01-23T05:37:23.087
> 
> 标签：python, oop, python-internals, slots

Python的目的是什么[`__slots__`](https://docs.python.org/3/reference/datamodel.html#slots)——尤其是关于我什么时候想用它，什么时候不想用？

* * *

## 回答 #1

> 赞同：1457
> 
> 时间：2015-01-21T04:46:42.340

> # `__slots__`在 Python 中，应该避免这种情况的目的和情况是什么？

## TLDR：

特殊属性[`__slots__`](https://docs.python.org/3/reference/datamodel.html#slots)允许您明确说明您希望对象实例具有哪些实例属性，并具有预期的结果：

1.  **更快**的属性访问。
2.  **节省**内存空间。

节省的空间来自

1.  将值引用存储在插槽而不是`__dict__`.
2.  如果父类拒绝它们并且您[`__dict__`](https://docs.python.org/3/library/stdtypes.html#object.__dict__)声明.[`__weakref__`](https://stackoverflow.com/questions/36787603/what-exactly-is-weakref-in-python)`__slots__`

### 快速注意事项

小警告，您应该只在继承树中声明一次特定的插槽。例如：

```
class Base:
    __slots__ = 'foo', 'bar'

class Right(Base):
    __slots__ = 'baz', 

class Wrong(Base):
    __slots__ = 'foo', 'bar', 'baz'        # redundant foo and bar 
```

当你犯了这个错误时，Python 不会反对（它可能应该），否则问题可能不会出现，但是你的对象会占用比它们原本应该占用的更多空间。蟒蛇 3.8：

```
>>> from sys import getsizeof
>>> getsizeof(Right()), getsizeof(Wrong())
(56, 72) 
```

这是因为 Base 的槽描述符有一个与 Wrong 分开的槽。这通常不应该出现，但它可以：

```
>>> w = Wrong()
>>> w.foo = 'foo'
>>> Base.foo.__get__(w)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: foo
>>> Wrong.foo.__get__(w)
'foo' 
```

最大的警告是多重继承 - 不能组合多个“具有非空槽的父类”。

为了适应这种限制，请遵循最佳实践：除一个或所有父抽象之外，它们的具体类和您的新具体类将共同继承的所有抽象 - 给抽象空槽（就像抽象基类中的标准库）。

有关示例，请参见下面的多重继承部分。

### 要求：

*   要将名为 in`__slots__`的属性实际存储在插槽而不是 a`__dict__`中，类必须继承自`object`（在 Python 3 中是自动的，但在 Python 2 中必须是显式的）。

*   为了防止创建 a `__dict__`，您必须继承自`object`，并且继承中的所有类都必须声明`__slots__`，并且它们都不能有`'__dict__'`条目。

如果您想继续阅读，这里有很多细节。

## 为什么使用`__slots__`：更快的属性访问。

Python 的创建者 Guido van Rossum[表示](http://python-history.blogspot.com/2010/06/inside-story-on-new-style-classes.html)，他实际上是`__slots__`为了更快地访问属性而创建的。

证明显着更快的访问是微不足道的：

```
import timeit

class Foo(object): __slots__ = 'foo',

class Bar(object): pass

slotted = Foo()
not_slotted = Bar()

def get_set_delete_fn(obj):
    def get_set_delete():
        obj.foo = 'foo'
        obj.foo
        del obj.foo
    return get_set_delete 
```

和

```
>>> min(timeit.repeat(get_set_delete_fn(slotted)))
0.2846834529991611
>>> min(timeit.repeat(get_set_delete_fn(not_slotted)))
0.3664822799983085 
```

在 Ubuntu 上的 Python 3.5 中，时隙访问速度快了近 30%。

```
>>> 0.3664822799983085 / 0.2846834529991611
1.2873325658284342 
```

在 Windows 上的 Python 2 中，我测得它快了大约 15%。

## 为什么使用`__slots__`：节省内存

的另一个目的`__slots__`是减少每个对象实例占用的内存空间。

[我自己对文档的贡献清楚地说明了这背后的原因](https://docs.python.org/3/reference/datamodel.html#slots)：

> 使用时节省的空间`__dict__`可能很大。

[SQLAlchemy 将](http://docs.sqlalchemy.org/en/rel_1_0/changelog/migration_10.html#significant-improvements-in-structural-memory-use)大量内存节省归功于`__slots__`.

为了验证这一点，在 Ubuntu Linux 上使用 Python 2.7 的 Anaconda 发行版，带有`guppy.hpy`（又名 heapy）和`sys.getsizeof`，没有声明的类实例的大小`__slots__`是 64 字节。这*不*包括`__dict__`. 再次感谢 Python 的惰性求值，在`__dict__`被引用之前显然不会被调用，但是没有数据的类通常是无用的。当调用存在时，该`__dict__`属性至少额外增加 280 个字节。

相比之下，`__slots__`声明为`()`（无数据）的类实例只有 16 个字节，总共 56 个字节，其中一个项目在插槽中，64 个字节有两个。

对于 64 位 Python，我说明了 Python 2.7 和 3.6 中的内存消耗（以字节为单位），对于 dict 在 3.6 中增长的每个点（除了 0、1 和 2 属性）（没有定义槽）`__slots__`：`__dict__`

```
 Python 2.7             Python 3.6
attrs  __slots__  __dict__*   __slots__  __dict__* | *(no slots defined)
none   16         56 + 272†   16         56 + 112† | †if __dict__ referenced
one    48         56 + 272    48         56 + 112
two    56         56 + 272    56         56 + 112
six    88         56 + 1040   88         56 + 152
11     128        56 + 1040   128        56 + 240
22     216        56 + 3344   216        56 + 408     
43     384        56 + 3344   384        56 + 752 
```

因此，尽管 Python 3 中的 dicts 较小，但我们看到`__slots__`实例的扩展性如何以节省我们的内存，这是您想要使用`__slots__`.

为了我的笔记的完整性，请注意，在 Python 2 中，类名称空间中的每个插槽的一次性成本为 64 字节，在 Python 3 中为 72 字节，因为插槽使用属性等数据描述符，称为“成员”。

```
>>> Foo.foo
<member 'foo' of 'Foo' objects>
>>> type(Foo.foo)
<class 'member_descriptor'>
>>> getsizeof(Foo.foo)
72 
```

## 示范`__slots__`：

要拒绝 a 的创建`__dict__`，您必须子类化`object`。Python 3 中的所有子类`object`，但在 Python 2 中，您必须明确：

```
class Base(object): 
    __slots__ = () 
```

现在：

```
>>> b = Base()
>>> b.a = 'a'
Traceback (most recent call last):
  File "<pyshell#38>", line 1, in <module>
    b.a = 'a'
AttributeError: 'Base' object has no attribute 'a' 
```

或者子类化另一个定义的类`__slots__`

```
class Child(Base):
    __slots__ = ('a',) 
```

现在：

```
c = Child()
c.a = 'a' 
```

但：

```
>>> c.b = 'b'
Traceback (most recent call last):
  File "<pyshell#42>", line 1, in <module>
    c.b = 'b'
AttributeError: 'Child' object has no attribute 'b' 
```

要在子类化槽对象时允许`__dict__`创建，只需添加`'__dict__'`（`__slots__`注意槽是有序的，您不应该重复已经在父类中的槽）：

```
class SlottedWithDict(Child): 
    __slots__ = ('__dict__', 'b')

swd = SlottedWithDict()
swd.a = 'a'
swd.b = 'b'
swd.c = 'c' 
```

和

```
>>> swd.__dict__
{'c': 'c'} 
```

或者你甚至不需要`__slots__`在你的子类中声明，你仍然会使用父类的插槽，但不限制 a 的创建`__dict__`：

```
class NoSlots(Child): pass
ns = NoSlots()
ns.a = 'a'
ns.b = 'b' 
```

和：

```
>>> ns.__dict__
{'b': 'b'} 
```

但是，`__slots__`可能会导致多重继承问题：

```
class BaseA(object): 
    __slots__ = ('a',)

class BaseB(object): 
    __slots__ = ('b',) 
```

因为从具有两个非空槽的父级创建子类失败：

```
>>> class Child(BaseA, BaseB): __slots__ = ()
Traceback (most recent call last):
  File "<pyshell#68>", line 1, in <module>
    class Child(BaseA, BaseB): __slots__ = ()
TypeError: Error when calling the metaclass bases
    multiple bases have instance lay-out conflict 
```

如果你遇到这个问题，你*可以*从父母中移除`__slots__`，或者如果你可以控制父母，给他们空槽，或者重构抽象：

```
from abc import ABC

class AbstractA(ABC):
    __slots__ = ()

class BaseA(AbstractA): 
    __slots__ = ('a',)

class AbstractB(ABC):
    __slots__ = ()

class BaseB(AbstractB): 
    __slots__ = ('b',)

class Child(AbstractA, AbstractB): 
    __slots__ = ('a', 'b')

c = Child() # no problem! 
```

### 添加`'__dict__'`以`__slots__`获取动态分配：

```
class Foo(object):
    __slots__ = 'bar', 'baz', '__dict__' 
```

现在：

```
>>> foo = Foo()
>>> foo.boink = 'boink' 
```

因此，使用`'__dict__'`in slot 时，我们会失去一些大小优势，因为动态分配的好处是仍然有我们所期望的名称的 slot。

当你从一个没有开槽的对象继承时，你会得到相同的语义`__slots__`——名称`__slots__`指向开槽的值，而任何其他值都放在实例的`__dict__`.

避免`__slots__`因为您希望能够即时添加属性实际上不是一个好的理由 -如果需要，只需添加`"__dict__"`到您的属性中。`__slots__`

如果您需要该功能，您可以类似`__weakref__`地显式添加。`__slots__`

### 子类化命名元组时设置为空元组：

内置的 namedtuple 使不可变实例非常轻量级（本质上是元组的大小），但要获得好处，如果您将它们子类化，您需要自己做：

```
from collections import namedtuple
class MyNT(namedtuple('MyNT', 'bar baz')):
    """MyNT is an immutable and lightweight object"""
    __slots__ = () 
```

用法：

```
>>> nt = MyNT('bar', 'baz')
>>> nt.bar
'bar'
>>> nt.baz
'baz' 
```

并且试图分配一个意外的属性会引发一个，`AttributeError`因为我们已经阻止了创建`__dict__`：

```
>>> nt.quux = 'quux'
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: 'MyNT' object has no attribute 'quux' 
```

您*可以*`__dict__`通过离开来允许创建`__slots__ = ()`，但不能将非空`__slots__`与元组的子类型一起使用。

## 最大的警告：多重继承

即使多个父级的非空插槽相同，它们也不能一起使用：

```
class Foo(object): 
    __slots__ = 'foo', 'bar'
class Bar(object):
    __slots__ = 'foo', 'bar' # alas, would work if empty, i.e. ()

>>> class Baz(Foo, Bar): pass
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: Error when calling the metaclass bases
    multiple bases have instance lay-out conflict 
```

在父级中使用空`__slots__`似乎提供了最大的灵活性，**允许子级选择阻止或允许**（通过添加`'__dict__'`以获取动态分配，参见上面**的部分）创建`__dict__`**：

```
class Foo(object): __slots__ = ()
class Bar(object): __slots__ = ()
class Baz(Foo, Bar): __slots__ = ('foo', 'bar')
b = Baz()
b.foo, b.bar = 'foo', 'bar' 
```

您不必*有*插槽 - 因此，如果您添加它们并稍后删除它们，它应该不会导致任何问题。

**在这里走出困境**：如果您正在编写[mixins](https://stackoverflow.com/questions/860245/mixin-vs-inheritance/27907511#27907511)或使用不打算实例化的[抽象基类](https://stackoverflow.com/questions/372042/difference-between-abstract-class-and-interface-in-python/31439126#31439126)`__slots__`，那么就子类的灵活性而言，这些父类中的空似乎是最好的方法。

为了演示，首先，让我们用我们想在多重继承下使用的代码创建一个类

```
class AbstractBase:
    __slots__ = ()
    def __init__(self, a, b):
        self.a = a
        self.b = b
    def __repr__(self):
        return f'{type(self).__name__}({repr(self.a)}, {repr(self.b)})' 
```

我们可以通过继承和声明预期的插槽直接使用上述内容：

```
class Foo(AbstractBase):
    __slots__ = 'a', 'b' 
```

但是我们不关心这个，那是微不足道的单继承，我们需要另一个我们可能也继承自的类，也许有一个嘈杂的属性：

```
class AbstractBaseC:
    __slots__ = ()
    @property
    def c(self):
        print('getting c!')
        return self._c
    @c.setter
    def c(self, arg):
        print('setting c!')
        self._c = arg 
```

现在，如果两个基地都有非空插槽，我们就无法执行以下操作。（事实上​​，如果我们愿意，我们可以给`AbstractBase`非空槽 a 和 b，并把它们排除在下面的声明之外——把它们留在里面是错误的）：

```
class Concretion(AbstractBase, AbstractBaseC):
    __slots__ = 'a b _c'.split() 
```

现在我们通过多重继承获得了两者的功能，并且仍然可以拒绝`__dict__`和`__weakref__`实例化：

```
>>> c = Concretion('a', 'b')
>>> c.c = c
setting c!
>>> c.c
getting c!
Concretion('a', 'b')
>>> c.d = 'd'
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: 'Concretion' object has no attribute 'd' 
```

## 避免插槽的其他情况：

*   当您想对`__class__`另一个没有它们的类（并且您无法添加它们）执行分配时，请避免使用它们，除非插槽布局相同。（我非常有兴趣了解谁在这样做以及为什么这样做。）
*   如果你想子类化可变长度的内置函数，比如 long、tuple 或 str，并且你想为它们添加属性，请避免使用它们。
*   如果您坚持通过类属性为实例变量提供默认值，请避免使用它们。

您也许可以从`__slots__` [文档的其余部分（3.7 开发文档是最新的）](https://docs.python.org/3.7/reference/datamodel.html#slots)中梳理出进一步的警告，我最近对此做出了重要贡献。

## 对其他答案的批评

当前的最佳答案引用了过时的信息，并且非常随意，并且在某些重要方面未达到目标。

### 不要“仅`__slots__`在实例化大量对象时使用”

我引用：

> `__slots__`“如果你要实例化很多（成百上千）同一个类的对象，你会想要使用它。”

例如，来自`collections`模块的抽象基类没有被实例化，而是`__slots__`为它们声明。

为什么？

如果用户希望拒绝`__dict__`或`__weakref__`创建，则这些东西在父类中必须不可用。

`__slots__`在创建接口或 mixin 时有助于提高可重用性。

确实，许多 Python 用户并不是为了可重用性而编写的，但是当您这样做时，可以选择拒绝不必要的空间使用是很有价值的。

### `__slots__`不会破坏酸洗

腌制开槽对象时，您可能会发现它抱怨具有误导性`TypeError`：

```
>>> pickle.loads(pickle.dumps(f))
TypeError: a class that defines __slots__ without defining __getstate__ cannot be pickled 
```

这实际上是不正确的。此消息来自最旧的协议，这是默认协议。您可以使用参数选择最新的协议`-1`。在 Python 2.7 中是`2`（在 2.3 中引入），在 3.6 中是`4`.

```
>>> pickle.loads(pickle.dumps(f, -1))
<__main__.Foo object at 0x1129C770> 
```

在 Python 2.7 中：

```
>>> pickle.loads(pickle.dumps(f, 2))
<__main__.Foo object at 0x1129C770> 
```

在 Python 3.6 中

```
>>> pickle.loads(pickle.dumps(f, 4))
<__main__.Foo object at 0x1129C770> 
```

所以我会记住这一点，因为这是一个已解决的问题。

## 对（直到 2016 年 10 月 2 日）接受的答案的批评

第一段是一半简短的解释，一半是预测性的。这是唯一真正回答问题的部分

> 正确使用`__slots__`是为了节省对象的空间。与允许随时向对象添加属性的动态字典不同，有一个不允许在创建后添加的静态结构。这为每个使用插槽的对象节省了一个 dict 的开销

后半段是一厢情愿，而且离题：

> 虽然这有时是一个有用的优化，但如果 Python 解释器足够动态，以至于它只需要 dict 实际添加到对象时，它就完全没有必要了。

Python 实际上做了类似的事情，只是在`__dict__`访问时创建，但是创建大量没有数据的对象是相当荒谬的。

第二段过于简单化并忽略了要避免的实际原因`__slots__`。以下*不是*避免插槽的真正原因（出于*实际*原因，请参阅上面的其余答案。）：

> 它们以一种可能被控制狂和静态打字小鬼滥用的方式改变了具有插槽的对象的行为。

然后继续讨论用 Python 实现这个不正当目标的其他方法，而不讨论与`__slots__`.

第三段则是一厢情愿。总的来说，回答者甚至没有创作的大部分内容都是不合时宜的内容，并且为该网站的批评者提供了弹药。

# 内存使用证据

创建一些普通对象和开槽对象：

```
>>> class Foo(object): pass
>>> class Bar(object): __slots__ = () 
```

实例化其中的一百万个：

```
>>> foos = [Foo() for f in xrange(1000000)]
>>> bars = [Bar() for b in xrange(1000000)] 
```

检查`guppy.hpy().heap()`：

```
>>> guppy.hpy().heap()
Partition of a set of 2028259 objects. Total size = 99763360 bytes.
 Index  Count   %     Size   % Cumulative  % Kind (class / dict of class)
     0 1000000  49 64000000  64  64000000  64 __main__.Foo
     1     169   0 16281480  16  80281480  80 list
     2 1000000  49 16000000  16  96281480  97 __main__.Bar
     3   12284   1   987472   1  97268952  97 str
... 
```

访问常规对象及其`__dict__`并再次检查：

```
>>> for f in foos:
...     f.__dict__
>>> guppy.hpy().heap()
Partition of a set of 3028258 objects. Total size = 379763480 bytes.
 Index  Count   %      Size    % Cumulative  % Kind (class / dict of class)
     0 1000000  33 280000000  74 280000000  74 dict of __main__.Foo
     1 1000000  33  64000000  17 344000000  91 __main__.Foo
     2     169   0  16281480   4 360281480  95 list
     3 1000000  33  16000000   4 376281480  99 __main__.Bar
     4   12284   0    987472   0 377268952  99 str
... 
```

这与 Python 的历史是一致的，来自[Unifying types and classes in Python 2.2](https://www.python.org/download/releases/2.2.2/descrintro/)

> 如果子类化一个内置类型，额外的空间会自动添加到实例中以容纳`__dict__`和`__weakrefs__`. （`__dict__`虽然在您使用它之前不会初始化，因此您不必担心创建的每个实例的空字典占用的空间。）如果您不需要这个额外的空间，您可以将短语“ `__slots__ = []`”添加到你的班。

* * *

## 回答 #2

> 赞同：271
> 
> 时间：2009-01-23T05:54:46.123

引用[Jacob Hallen 的话](http://code.activestate.com/lists/python-list/531365/)：

> 正确使用`__slots__`是为了节省对象的空间。与允许随时向对象添加属性的动态字典不同，有一个不允许在创建后添加的静态结构。[这种使用`__slots__`消除了每个对象使用一个 dict 的开销。] 虽然这有时是一种有用的优化，但如果 Python 解释器足够动态，以至于它只需要 dict 实际添加到目的。
> 
> 不幸的是，插槽有副作用。它们以一种可能被控制狂和静态打字小鬼滥用的方式改变了具有插槽的对象的行为。这很糟糕，因为控制狂应该滥用元类，而静态类型的小伙伴们应该滥用装饰器，因为在 Python 中，应该只有一种明显的方式来做某事。
> 
> 使 CPython 足够聪明以处理节省空间`__slots__`是一项重大任务，这可能是它不在 P3k 更改列表中的原因（目前）。

* * *

## 回答 #3

> 赞同：137
> 
> 时间：2009-01-23T05:50:21.173

`__slots__`如果您要实例化同一类的很多（数百、数千）个对象，您会想要使用。`__slots__`仅作为内存优化工具存在。

强烈建议不要使用它`__slots__`来约束属性创建。

酸洗对象`__slots__`不适用于默认（最旧的）泡菜协议；有必要指定更高版本。

python的一些其他自省功能也可能受到不利影响。

* * *

## 回答 #4

> 赞同：69
> 
> 时间：2009-01-23T13:38:21.337

每个 python 对象都有一个`__dict__`属性，它是一个包含所有其他属性的字典。例如，当您键入`self.attr`python 时，实际上是在做`self.__dict__['attr']`. 正如您可以想象的那样，使用字典来存储属性需要一些额外的空间和时间来访问它。

但是，当您使用 时`__slots__`，为该类创建的任何对象都没有`__dict__`属性。相反，所有属性访问都是通过指针直接完成的。

因此，如果想要一个 C 风格的结构而不是一个完整的类，您可以使用它`__slots__`来压缩对象的大小并减少属性访问时间。一个很好的例子是包含属性 x 和 y 的 Point 类。如果你打算有很多点，你可以尝试使用`__slots__`以节省一些内存。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2015-06-03T07:43:05.077

除了其他答案，这里是一个使用示例`__slots__`：

```
>>> class Test(object):   #Must be new-style class!
...  __slots__ = ['x', 'y']
... 
>>> pt = Test()
>>> dir(pt)
['__class__', '__delattr__', '__doc__', '__getattribute__', '__hash__', 
 '__init__', '__module__', '__new__', '__reduce__', '__reduce_ex__', 
 '__repr__', '__setattr__', '__slots__', '__str__', 'x', 'y']
>>> pt.x
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: x
>>> pt.x = 1
>>> pt.x
1
>>> pt.z = 2
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: 'Test' object has no attribute 'z'
>>> pt.__dict__
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: 'Test' object has no attribute '__dict__'
>>> pt.__slots__
['x', 'y'] 
```

因此，要实现`__slots__`，它只需要额外的一行（如果还没有的话，让你的类成为一个新样式的类）。通过这种方式，您可以[将这些类的内存占用减少 5 倍](http://dev.svetlyak.ru/using-slots-for-optimisation-in-python-en/)，但代价是必须编写自定义 pickle 代码（如果有必要）。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2012-11-25T03:06:11.730

插槽对于库调用非常有用，可以在进行函数调用时消除“命名方法调度”。这在 SWIG[文档](http://www.swig.org/Doc2.0/Python.html#Python_builtin_types)中有所提及。对于希望减少使用插槽的常用函数的函数开销的高性能库，速度要快得多。

现在这可能与 OPs 问题没有直接关系。它更多地与构建扩展有关，而不是与在对象上使用**槽**语法有关。但它确实有助于完整了解插槽的使用情况以及它们背后的一些推理。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2014-06-04T22:09:43.207

类实例的属性具有 3 个属性：实例、属性名称和属性值。

在***常规属性访问***中，实例充当字典，属性名称充当该字典中查找值的键。

**实例（属性）--> 值**

在***__slots__ access***中，属性的名称充当字典，实例充当字典中查找值的键。

**属性（实例）-> 值**

在***flyweight 模式***中，属性的名称充当字典，值充当查找实例的字典中的键。

**属性（值）-> 实例**

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2016-11-02T09:18:07.440

一个非常简单的`__slot__`属性示例。

## 问题：没有`__slots__`

如果我的类中没有`__slot__`属性，我可以为我的对象添加新属性。

```
class Test:
    pass

obj1=Test()
obj2=Test()

print(obj1.__dict__)  #--> {}
obj1.x=12
print(obj1.__dict__)  # --> {'x': 12}
obj1.y=20
print(obj1.__dict__)  # --> {'x': 12, 'y': 20}

obj2.x=99
print(obj2.__dict__)  # --> {'x': 99} 
```

如果您查看上面的示例，您可以看到**obj1**和**obj2**具有自己的**x**和**y**属性，python 还`dict`为每个对象（**obj1**和**obj2**）创建了一个属性。

假设如果我的类**Test**有数千个这样的对象？为每个对象创建一个附加属性`dict`会在我的代码中导致大量开销（内存、计算能力等）。

## 解决方案：使用`__slots__`

现在在下面的示例中，我的类**Test**包含`__slots__`属性。现在我不能向我的对象添加新属性（除了 attribute `x`），python 不再创建`dict`属性。这消除了每个对象的开销，如果您有很多对象，这可能会变得很重要。

```
class Test:
    __slots__=("x")

obj1=Test()
obj2=Test()
obj1.x=12
print(obj1.x)  # --> 12
obj2.x=99
print(obj2.x)  # --> 99

obj1.y=28
print(obj1.y)  # --> AttributeError: 'Test' object has no attribute 'y' 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-02-07T20:56:29.350

另一个有点晦涩的用法`__slots__`是从 ProxyTypes 包（以前是 PEAK 项目的一部分）向对象代理添加属性。它`ObjectWrapper`允许您代理另一个对象，但拦截与代理对象的所有交互。它不是很常用（并且不支持 Python 3），但我们已经使用它来实现一个线程安全的阻塞包装器，该包装器围绕基于 tornado 的异步实现，该实现通过 ioloop 反弹对代理对象的所有访问，使用线程安全`concurrent.Future`对象同步并返回结果。

默认情况下，对代理对象的任何属性访问都会为您提供代理对象的结果。如果需要在代理对象上添加属性，`__slots__`可以使用。

```
from peak.util.proxies import ObjectWrapper

class Original(object):
    def __init__(self):
        self.name = 'The Original'

class ProxyOriginal(ObjectWrapper):

    __slots__ = ['proxy_name']

    def __init__(self, subject, proxy_name):
        # proxy_info attributed added directly to the
        # Original instance, not the ProxyOriginal instance
        self.proxy_info = 'You are proxied by {}'.format(proxy_name)

        # proxy_name added to ProxyOriginal instance, since it is
        # defined in __slots__
        self.proxy_name = proxy_name

        super(ProxyOriginal, self).__init__(subject)

if __name__ == "__main__":
    original = Original()
    proxy = ProxyOriginal(original, 'Proxy Overlord')

    # Both statements print "The Original"
    print "original.name: ", original.name
    print "proxy.name: ", proxy.name

    # Both statements below print 
    # "You are proxied by Proxy Overlord", since the ProxyOriginal
    # __init__ sets it to the original object 
    print "original.proxy_info: ", original.proxy_info
    print "proxy.proxy_info: ", proxy.proxy_info

    # prints "Proxy Overlord"
    print "proxy.proxy_name: ", proxy.proxy_name
    # Raises AttributeError since proxy_name is only set on 
    # the proxy object
    print "original.proxy_name: ", proxy.proxy_name 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-23T11:15:19.957

你有 - 基本上 - 没有用 for `__slots__`。

当您认为您可能需要时`__slots__`，您实际上想要使用**轻量级**或**轻量级**设计模式。这些是您不再想使用纯 Python 对象的情况。相反，您需要一个类似 Python 对象的包装器来围绕数组、结构或 numpy 数组。

```
class Flyweight(object):

    def get(self, theData, index):
        return theData[index]

    def set(self, theData, index, value):
        theData[index]= value 
```

类包装器没有属性——它只提供作用于底层数据的方法。这些方法可以简化为类方法。实际上，它可以简化为仅对底层数据数组进行操作的函数。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-01-12T18:42:31.110

最初的问题是关于一般用例，而不仅仅是关于内存。所以这里应该提到的是，当实例化大量对象时，您也会获得更好的*性能——这很有趣，例如在将大型文档解析为对象或从数据库中解析时。*

这是使用插槽和不使用插槽创建具有一百万个条目的对象树的比较。作为对树使用普通字典时的性能参考（OSX 上的 Py2.7.10）：

```
********** RUN 1 **********
1.96036410332 <class 'css_tree_select.element.Element'>
3.02922606468 <class 'css_tree_select.element.ElementNoSlots'>
2.90828204155 dict
********** RUN 2 **********
1.77050495148 <class 'css_tree_select.element.Element'>
3.10655999184 <class 'css_tree_select.element.ElementNoSlots'>
2.84120798111 dict
********** RUN 3 **********
1.84069895744 <class 'css_tree_select.element.Element'>
3.21540498734 <class 'css_tree_select.element.ElementNoSlots'>
2.59615707397 dict
********** RUN 4 **********
1.75041103363 <class 'css_tree_select.element.Element'>
3.17366290092 <class 'css_tree_select.element.ElementNoSlots'>
2.70941114426 dict 
```

测试类（ident，appart from slots）：

```
class Element(object):
    __slots__ = ['_typ', 'id', 'parent', 'childs']
    def __init__(self, typ, id, parent=None):
        self._typ = typ
        self.id = id
        self.childs = []
        if parent:
            self.parent = parent
            parent.childs.append(self)

class ElementNoSlots(object): (same, w/o slots) 
```

测试代码，详细模式：

```
na, nb, nc = 100, 100, 100
for i in (1, 2, 3, 4):
    print '*' * 10, 'RUN', i, '*' * 10
    # tree with slot and no slot:
    for cls in Element, ElementNoSlots:
        t1 = time.time()
        root = cls('root', 'root')
        for i in xrange(na):
            ela = cls(typ='a', id=i, parent=root)
            for j in xrange(nb):
                elb = cls(typ='b', id=(i, j), parent=ela)
                for k in xrange(nc):
                    elc = cls(typ='c', id=(i, j, k), parent=elb)
        to =  time.time() - t1
        print to, cls
        del root

    # ref: tree with dicts only:
    t1 = time.time()
    droot = {'childs': []}
    for i in xrange(na):
        ela =  {'typ': 'a', id: i, 'childs': []}
        droot['childs'].append(ela)
        for j in xrange(nb):
            elb =  {'typ': 'b', id: (i, j), 'childs': []}
            ela['childs'].append(elb)
            for k in xrange(nc):
                elc =  {'typ': 'c', id: (i, j, k), 'childs': []}
                elb['childs'].append(elc)
    td = time.time() - t1
    print td, 'dict'
    del droot 
```

# c# - 在c#中生成一系列加起来为N的随机数

> ID：472013
> 
> 赞同：14
> 
> 时间：2009-01-23T05:47:41.070
> 
> 标签：c#, .net, random

如何在 C# 中生成 1-9 之间的 30 个随机数，所有这些随机数加起来为 200（或任意 N）？

我正在尝试生成一串可以加在一起为 N 的数字。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-23T06:58:57.820

我不确定这方面的统计数据是什么，但这里的问题是您不想随机选择一个数字，该数字无法通过过冲或下冲将 N 与 M 个条目相加。这是我的做法：

```
static void Main()
{
    int count = 30;
    int[] numbers = getNumbers(count, 155);
    for (int index = 0; index < count; index++)
    {
        Console.Write(numbers[index]);
        if ((index + 1) % 10 == 0)
            Console.WriteLine("");
        else if (index != count - 1)
            Console.Write(",");
    }
    Console.ReadKey();
}
static int[] getNumbers(int count, int total)
{
    const int LOWERBOUND = 1;
    const int UPPERBOUND = 9;

    int[] result = new int[count];
    int currentsum = 0;
    int low, high, calc;

    if((UPPERBOUND * count) < total ||
        (LOWERBOUND * count) > total ||
        UPPERBOUND < LOWERBOUND)
        throw new Exception("Not possible.");

    Random rnd = new Random();

    for (int index = 0; index < count; index++)
    {
        calc = (total - currentsum) - (UPPERBOUND * (count - 1 - index));
        low = calc < LOWERBOUND ? LOWERBOUND : calc;
        calc = (total - currentsum) - (LOWERBOUND * (count - 1 - index));
        high = calc > UPPERBOUND ? UPPERBOUND : calc;

        result[index] = rnd.Next(low, high + 1);

        currentsum += result[index];
    }

    // The tail numbers will tend to drift higher or lower so we should shuffle to compensate somewhat.

    int shuffleCount = rnd.Next(count * 5, count * 10);
    while (shuffleCount-- > 0)
        swap(ref result[rnd.Next(0, count)], ref result[rnd.Next(0, count)]);

    return result;
}
public static void swap(ref int item1, ref int item2)
{
    int temp = item1;
    item1 = item2;
    item2 = temp;
} 
```

我没有太多时间来测试这个，如果我的逻辑在某个地方存在缺陷，我深表歉意。

编辑：

我做了一些测试，一切看起来都很可靠。如果你想要一个漂亮漂亮的传播，看起来你想要一些类似的东西`Total = Count * ((UPPER + LOWER) / 2)`。尽管我相当肯定，随着和之间的差异`UPPER`增加`LOWER`，这变得更加灵活。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-23T06:28:01.033

问题是我们希望所有数字都以 1-9 为界**并**加起来为 N。因此我们必须一个一个地生成每个数字并确定下一个数字的实际范围。

这当然会在列表末尾产生统计偏差，因此我建议在生成后对数组进行一次洗牌。

要确定下一个数字的界限，请执行以下操作： 上限 = 将剩余总和减去（剩余元素数 * min）。下限 = 将剩余总和减去（剩余元素数 * 最大值）。

类似（未经测试）：

```
public static List<int> RandomList(int digitMin, int digitMax, 
                                   int targetSum, int numDigits)
{
    List<int> ret = new List<int>(numDigits);

    Random random = new Random();
    int localMin, localMax, nextDigit;
    int remainingSum = targetSum;

    for(int i=1; i<=numDigits; i++)
    {
          localMax = remainingSum - ((numDigits - i) * min);
          if(localMax > max)
              localMax = max;

          localMin = remainingSum - ((length - i) * max);
          if(localMin > min)
              localMin = min;

          nextDigit = random.Next(localMin, localMax);
          ret.Add(nextDigit);
          remainingSum -= nextDigit;
    }

    return ret;
} 
```

这里的想法是，当您生成数字时，剩余数字的可能值范围会变小，就像限制函数将目标总和归零一样。有点。

编辑：我不得不将 for 循环更改为基于 1，因为我们希望在生成这个之后剩下的元素数量。

Edit2：将其放入一个完整的方法中，并更改`length`为`numDigits`可读性。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T05:57:51.750

我的原始声明：

您只能生成 29 个随机数。第 30 个数字将由其他 29 个和总和定义。这在统计上很重要...

我想在考虑并[ping](https://stackoverflow.com/questions/472662/random-numbers)社区之后添加一些澄清......

我现在相信我原来的陈述是错误的。这太宽容了（lc 指出）。你甚至不能生成 29 个真正的随机数。随着您越来越接近 30，最终数字的随机性与 rnd[1..9] 的随机性不同。lc 试图减轻这种情况以提出解决方案，但我相信他提出的解决方案（和 Spencer）回答了一个非常不同的问题。这个问题是“在 1 到 9 之间的所有 30 位数字中，加起来为 200，随机构建一个”。

我认为的情况是，所述问题是无法解决的，我相信可以用[鸽子洞原理](http://en.wikipedia.org/wiki/Pigeonhole_principle)证明（Knuth 也使用它来表明某些“随机”洗牌并不是真正随机的），但我没有算了一下。

大家好好谈谈。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-23T05:56:27.870

该程序将尝试为您提供答案。但是因为您正在处理随机数，所以这可能永远不会给您答案。

```
public static IEnumerable<int> GetRandom()
{
    var rand = new Random();
    while (true)
    {
        yield return
        rand.Next(1, 9);
    }
}

public static List<int> GetThirtyThatAddToTwoHundred()
{
    do
    {
        var current = GetRandom().Take(30);
        if (200 == current.Sum())
        {
            return current.ToList();
        }
    } while (true);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-03-20T01:01:05.210

这是一个老问题，但我发现它正在寻找解决这个问题的方法，以便在随机数据生成测试应用程序中实际使用。

基于这篇文章中的想法，我想出了两个潜在的解决方案。

第一种方法：

1.  找出可以重复的最小整数值加起来接近所需总数的数字。本质上，只做整数除法。
2.  使用等于步骤 1 中找到的数字的所有值初始化一个数组。
3.  如果有余数（通常会有余数），则将数组中的项随机加一并递减余数，直到余数为 0。此时我们有一个数组，它将等于所需的总数，但它会非常不-随机的。
4.  对于多次迭代，从数组中的两个位置随机加减。示例：将位置 0 加 1 并从位置 4 中减去 1。这样做时，请进行边界检查（所有数字应至少为 0，并且所有数字不应大于上限）。

第二种方法要简单得多，但会产生较少的随机分布：

1.  初始化所需长度的 0 数组。
2.  在数组中选择一个随机索引并加 1。如果该索引处的值超过上限，则忽略它并选择另一个索引。
3.  重复步骤 2 所需的总数所指示的次数。

这是代码：

```
public static int[] getRandomsWithTotalA(int desiredTotal, int desiredNumbers, int upperBound)
{
    Random r = new Random();

    // Is this even a possible feat?
    if (desiredNumbers * upperBound < desiredTotal) throw new ArgumentException("This is not possible!", "desiredTotal");

    // Start by figuring out the closest number we can get to by repeating the initial number.
    int lowestRepeating = desiredTotal / desiredNumbers;

    // Determine the remainder
    int lowestRepeatingRemainder = desiredTotal % desiredNumbers;

    // Initialize and populate an array of numbers with the lowest repeater.
    int[] results = Enumerable.Repeat(lowestRepeating, desiredNumbers).ToArray();

    // We will perform (n*desiredTotal) shuffles.
    int shuffles = (desiredTotal * desiredNumbers);

    while (shuffles > 0)
    {
        int a = r.Next(desiredNumbers);
        int b= r.Next(desiredNumbers);
        if (a==b) continue; // do nothing if they're equal - try again.

        // Test bounds.
        if (results[a]+1>upperBound) continue;
        if (results[b]-1<0) continue;

        // Add one to the first item.
        results[a]++;

        // Do we still have a remainder left? If so, add one but don't subtract from
        // somewhere else.
        if (lowestRepeatingRemainder>0)
        {
            lowestRepeatingRemainder--;
            continue;
        }
        // Otherwise subtract from another place.
        results[b]--;
        // decrement shuffles
        shuffles--;
    }

    return results;
}

public static int[] getRandomsWithTotalB(int desiredTotal, int desiredNumbers, int upperBound)
{
    Random r = new Random();

    // Is this even a possible feat?
    if (desiredNumbers * upperBound < desiredTotal) throw new ArgumentException("This is not possible!", "desiredTotal");

    // Initialize and populate an array of numbers with the lowest repeater.
    int[] results = new int[desiredNumbers];

    while (desiredTotal > 0)
    {
        int a = r.Next(desiredNumbers);

        // Test bounds.
        if (results[a] + 1 > upperBound) continue;

        // Add one to the first item.
        results[a]++;

        desiredTotal--;
    }

    return results;
} 
```

示例运行：

```
static void Main(string[] args)
{
    foreach (int i in getRandomsWithTotalA(200, 30, 9))
    {
        Console.Write("{0}, ", i);
    }
    Console.WriteLine("\n");
    foreach (int i in getRandomsWithTotalB(200, 30, 9))
    {
        Console.Write("{0}, ", i);
    }
}

3, 8, 7, 5, 9, 9, 8, 9, 9, 6, 8, 7, 4, 8, 7, 7, 8, 9, 2, 7, 9, 5, 8, 1, 4, 5, 4, 8, 9, 7,

6, 8, 5, 7, 6, 9, 9, 8, 5, 4, 4, 6, 7, 7, 8, 4, 9, 6, 6, 5, 8, 9, 9, 6, 6, 8, 7, 4, 7, 7, 
```

可以理解的是，这些方法的分布并不像人们希望的那样均匀。尤其是使用第二种方法时，这很有意义；如果您有一个真正均匀分布的随机源，那么您选择要增加的项目应该在所有可能值上具有相等的概率。第一个也可能会好一些，但它仍然受到随机源也理想地均匀分布的影响。

我觉得至少可以通过在索引选择中引入某种形式的偏差来改进第一种方法，或者可能随机化我们添加和减去多少（不总是1），或者随机化我们是否真的这样做加/减与否。只是调整迭代次数似乎会改变分布，但一段时间后，我们似乎开始偏爱外部边界。（也许不可能得到真正均匀的分布！）

无论如何，你去吧......至少是一个很好的起点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T15:49:19.623

在此处进行了所有讨论之后，还有另一种方法可以生成不会引入偏见的列表。是的，它确实与问题所问的不同，但不是随机选择数字，您可以随机增加数字直到达到总和。如下所示（再次未经测试）：

```
public static List<int> RandomListByIncrementing(int digitMin, int digitMax, 
                                                 int targetSum, int numDigits)
{
    if(targetSum < digitMin * numDigits || targetSum > digitMax * numDigits)
        throw new ArgumentException("Impossible!", "targetSum");

    List<int> ret = new List<int>(Enumerable.Repeat(digitMin, numDigits));
    List<int> indexList = new List<int>(Enumerable.Range(0, numDigits-1));

    Random random = new Random();
    int index;

    for(int currentSum=numDigits * digitMin; currentSum<targetSum; currentSum++)
    {
        //choose a random digit in the list to increase by 1
        index = random.Next(0,indexList.Length-1);

        if(++ret[indexList[index]] == digitMax)
        {
            //if you've increased it up to the max, remove its reference
            //because you can't increase it anymore
            indexList.RemoveAt(index);
        }
    }

    return ret;
} 
```

这里的想法是您保留对您的号码列表的引用列表。随机选择一个参考，并增加相应的数字。如果您不能再增加它，请删除该引用，以便您下次不要选择它。

现在，在一天结束的时候没有什么洗牌的事情要做，尽管可以说这仍然会产生一组可用的问题答案，这是一个“感觉更好”或运行速度更快的问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-20T21:16:00.010

所以我不得不问：这样做有实际目的吗，还是只是一个练习或家庭作业？有很多工作正在进行以防止“偏见”。这是实际要求，还是任何相当随机的解决方案都可以？在不了解需求的情况下，很容易浪费大量时间。如果这是一个真正的问题，请解释实际要求是什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T06:02:09.840

如果来自真实随机性的统计偏差是可以接受的，您可以将数字相加到 N - [最大随机数]，然后选择最后一个数字作为 N - sum（到目前为止已选择）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-23T06:21:25.883

算法：

1.  设置总计 = 200（或其他）
2.  生成 1-9 之间的随机数
3.  检查是否 (total - newRandomNumber >= 0)，如果没有转到 6
4.  总计 -= newRandomNumber
5.  将 newRandomNumber 添加到数组中，转到 2。
6.  新随机数 = 总数
7.  如果 newRandomNumber != 0 则将 newRandomNumber 添加到数组
8.  结尾

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-23T06:48:00.463

此方法将返回 30 个随机数，它们加起来为任意 N。有一些 0 值是可能的。如果这不可行，只需将数组全部初始化为一个，如果总和大于任意N，则将 vals[nextIdx] 设置为 1 而不是 0。希望这会有所帮助。

```
 private int[] getNumbers(int arbitraryN) {
        int[] vals = new int[30];
        int nextIdx = 0;
        int nextNumber=0;
        Random r = new Random();
        if (arbitraryN > 270 || arbitraryN < 30)
            throw new Exception("Not a Valid number");
        while (vals.Sum() < arbitraryN)
        {
            nextNumber = r.Next(1, 9);
            nextIdx = r.Next(29);
            vals[nextIdx] = nextNumber;
            if (vals.Sum() > arbitraryN)
            {
                vals[nextIdx] = 0;
                vals[nextIdx] = 270 - vals.Sum();
                break;
            }
        }
        return vals;
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-23T06:59:56.367

不能保证从 1 到 9 的 30 个随机数加起来是任何特定的 N。

您可以找到一个数字列表，这些数字加起来为 N，范围为 1-9，但数字不一定是 30。我相信您需要的最小数字数是 23，即 (22*9) + 2。当然，最大值是 200 (200*1)。所以列表的长度在 [23,200] 之内。因此，随机列表长度为 30 的可能性非常低。如果所有列表长度都可以获得（我认为它们是），那么从长远来看，您的机会约为 0.5%。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-23T08:29:42.083

我认为这是最简单的方法，所以它可能缺乏一些复杂性，但它会让你到达那里。

```
 String output = "";
        int sum = 0;
        int result = 200;       //enter the "end number"

        Random r = new Random();

        while (sum != result) {
            int add;
            if ((result - sum) > 10)
            {
                add = r.Next(1, 10);
            }
            else
            {
                add = r.Next(result - sum + 1);
            }

            sum += add;
            output += add.ToString() + " + ";
        }

        output = output.Remove(output.Length - 2);

        Console.WriteLine(output); 
```

希望能帮助到你！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-23T15:04:34.020

如果你想要一个无偏的算法，那么简单的实现是这样的：

```
while (true) {
  numbers = [];
  total = 0;
  for (i = 0; i < COUNT; ++i) {
    next = rand(BOUNDS);
    total += next;
    numbers.push(next);
  }

  if (total == TARGET) {
    return numbers;
  }
} 
```

这是非终止和缓慢的，但它没有偏见。如果你想要一个无偏的算法，我不相信这里发布的算法是无偏的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-24T01:27:59.157

为了得到一个不偏向较小数字（或任何其他偏差）的答案，理想情况下，您将生成**所有可能**的数字集，加起来为 N。获得所有集后，随机选择其中一个集。选择中奖组后，如果需要，您可以随机调整该组中数字的顺序。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-24T04:01:47.600

我想我会尝试分而治之的方法。它似乎工作得很好。由于算法的约束元素，我确信结果并不是真正随机的，但它很接近。本质上，我将列表一分为二，目标总和一分为二，然后递归，直到获得 3 个或更少元素的列表。然后我使用随机数字的蛮力迭代，直到获得这些较小的总和。这是下面运行示例的代码。

```
using System;
using System.Collections.Generic;

namespace AddUpClient {
    class Program {

        static void Main() {
            AddUpWorker worker = new AddUpWorker();
            int MinDigit = 1;
            int MaxDigit = 9;
            int ItemsToSum = 30;
            int TargetSum = 150;

            try {
                //Attempt to get a list of pseudo-random list of integers that add up to the target sum
                IList<int> Results = worker.AddUp(MinDigit, MaxDigit, ItemsToSum, TargetSum);

                EvaluateResults(TargetSum, Results);
                Console.ReadLine();
            }
            catch (Exception E) {
                Console.Out.WriteLine("Error: {0}", E.Message);
                return;
            }

        }

        private static void EvaluateResults(int TargetSum, IList<int> Results)
        {
            Console.Out.WriteLine("Results have {0} items.", Results.Count);

            int Sum = 0;
            foreach (int Result in Results) {
                Sum += Result;
                Console.Out.WriteLine("Result: {0} Running total: {1}", Result, Sum);
            }
            Console.Out.WriteLine();
            Console.Out.WriteLine("Result = {0}", (Sum == TargetSum ? "SUCCESS" : "FAIL"));
        }
    }

    internal class AddUpWorker {

        Random RGenerator = new Random();

        public IList<int> AddUp(int MinDigit, int MaxDigit, int ItemsToSum, int TargetSum) {

            Console.Out.WriteLine("AddUp called to sum {0} items to get {1}", ItemsToSum, TargetSum);
            if (ItemsToSum > 3) {

                int LeftItemsToSum = ItemsToSum/2;
                int RightItemsToSum = ItemsToSum - LeftItemsToSum;

                int LeftTargetSum = TargetSum/2;
                int RightTargetSum = TargetSum - LeftTargetSum;

                IList<int> LeftList = AddUp(MinDigit, MaxDigit, LeftItemsToSum, LeftTargetSum);
                IList<int> RightList = AddUp(MinDigit, MaxDigit, RightItemsToSum, RightTargetSum);

                List<int> Results = new List<int>();
                Results.AddRange(LeftList);
                Results.AddRange(RightList);
                return Results;
            }

            // 3 or less

            int MinSumWeCanAchieve = ItemsToSum*MinDigit;
            int MaxSumWeCanAchieve = ItemsToSum*MaxDigit;

            if (TargetSum < MinSumWeCanAchieve)
                throw new ApplicationException("We added up too fast");

            if (TargetSum > MaxSumWeCanAchieve)
                throw new ApplicationException("We added up too slow");

            //Now we know we can achieve the result -- but it may not be too efficient...

            int[] TrialNumbers = new int[ItemsToSum];
            int MaxIteration = 100000;
            int IterationPrintInterval = 1000;
            int TrialSum;
            bool PrintIteration;

            for (int Iteration = 1; Iteration <= MaxIteration; ++Iteration) {

                PrintIteration = ((Iteration % IterationPrintInterval) == 0);

                if (PrintIteration)
                    Console.Out.WriteLine("Iteration {0} attempting to sum {1} numbers to {2}",
                        Iteration, ItemsToSum, TargetSum);

                TrialSum = 0;
                for (int j=0; j < ItemsToSum; ++j) {
                    TrialNumbers[j] = RGenerator.Next(MinDigit, MaxDigit + 1);
                    TrialSum += TrialNumbers[j];
                }
                if (PrintIteration)
                    ShowArray(string.Format("Iteration: {0}", Iteration), TrialNumbers);

                if (TrialSum == TargetSum) {    //Yay
                    ShowArray(string.Format("Success in {0} iterations: ", Iteration), TrialNumbers);
                    return new List<int>(TrialNumbers);
                }
                //try again....
            }

            throw new ApplicationException(string.Format("Maximum of {0} trials exceeded", MaxIteration));
        }

        private void ShowArray(string Prefix, int[] numbers)
        {
            for (int i = 0; i < numbers.Length; ++i) {
                if (i == 0)
                    Console.Write("{0} {1}", Prefix, numbers[i]);
                else
                    Console.Write(", {0}", numbers[i]);
            }
            Console.WriteLine();
        }
    }
}

AddUp called to sum 30 items to get 150
AddUp called to sum 15 items to get 75
AddUp called to sum 7 items to get 37
AddUp called to sum 3 items to get 18
Success in 10 iterations:  7, 2, 9
AddUp called to sum 4 items to get 19
AddUp called to sum 2 items to get 9
Success in 12 iterations:  5, 4
AddUp called to sum 2 items to get 10
Success in 2 iterations:  1, 9
AddUp called to sum 8 items to get 38
AddUp called to sum 4 items to get 19
AddUp called to sum 2 items to get 9
Success in 11 iterations:  4, 5
AddUp called to sum 2 items to get 10
Success in 6 iterations:  8, 2
AddUp called to sum 4 items to get 19
AddUp called to sum 2 items to get 9
Success in 3 iterations:  8, 1
AddUp called to sum 2 items to get 10
Success in 1 iterations:  4, 6
AddUp called to sum 15 items to get 75
AddUp called to sum 7 items to get 37
AddUp called to sum 3 items to get 18
Success in 3 iterations:  4, 6, 8
AddUp called to sum 4 items to get 19
AddUp called to sum 2 items to get 9
Success in 17 iterations:  3, 6
AddUp called to sum 2 items to get 10
Success in 24 iterations:  1, 9
AddUp called to sum 8 items to get 38
AddUp called to sum 4 items to get 19
AddUp called to sum 2 items to get 9
Success in 3 iterations:  2, 7
AddUp called to sum 2 items to get 10
Success in 3 iterations:  1, 9
AddUp called to sum 4 items to get 19
AddUp called to sum 2 items to get 9
Success in 4 iterations:  5, 4
AddUp called to sum 2 items to get 10
Success in 2 iterations:  9, 1
Results have 30 items.
Result: 7 Running total: 7
Result: 2 Running total: 9
Result: 9 Running total: 18
Result: 5 Running total: 23
Result: 4 Running total: 27
Result: 1 Running total: 28
Result: 9 Running total: 37
Result: 4 Running total: 41
Result: 5 Running total: 46
Result: 8 Running total: 54
Result: 2 Running total: 56
Result: 8 Running total: 64
Result: 1 Running total: 65
Result: 4 Running total: 69
Result: 6 Running total: 75
Result: 4 Running total: 79
Result: 6 Running total: 85
Result: 8 Running total: 93
Result: 3 Running total: 96
Result: 6 Running total: 102
Result: 1 Running total: 103
Result: 9 Running total: 112
Result: 2 Running total: 114
Result: 7 Running total: 121
Result: 1 Running total: 122
Result: 9 Running total: 131
Result: 5 Running total: 136
Result: 4 Running total: 140
Result: 9 Running total: 149
Result: 1 Running total: 150

Result = SUCCESS 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-01-23T06:36:29.457

```
public static List<int> getNumbers(int n)
    {
        Random random = new Random(DateTime.Now.Millisecond);
        List<int> obtainedNumbers = new List<int>(); 
        do
        {
            obtainedNumbers.Add(random.Next(1, 9));
        }
        while (n - obtainedNumbers.Sum() > 0);
        return obtainedNumbers;
    } 
```

JaredPar 代码喜欢我，但速度很慢，就像扔硬币，希望得到 n 值。代码不错

# c++ - new 在堆栈而不是堆上（如 alloca 与 malloc）

> ID：472015
> 
> 赞同：16
> 
> 时间：2009-01-23T05:49:23.360
> 
> 标签：c++, stack, new-operator

有没有办法使用关键字在堆栈（ala ）而不是堆（ ）`new`上分配？`alloca``malloc`

我知道我可以自己破解，但我不想这样做。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-23T05:58:05.790

*要在堆栈上分配，要么通过 value*将您的对象声明为局部变量，或者您可以实际使用 alloca 获取指针，然后使用就地 new 运算符：

```
void *p = alloca(sizeof(Whatever));
new (p) Whatever(constructorArguments); 
```

然而，虽然使用 alloca 和 in-place new 确保内存在返回时被释放，但您放弃了自动析构函数调用。如果您只是想确保在退出范围时释放内存，请考虑使用`std::auto_ptr<T>`或其他一些智能指针类型。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-23T06:11:05.903

Jeffrey Hantin 是非常正确的，您可以使用placement new 来使用alloca 在堆栈上创建它。但是，说真的，为什么？相反，只需执行以下操作：

```
class C { /* ... */ };

void func() {
    C var;
    C *ptr = &var;

    // do whatever with ptr
} 
```

您现在有一个指向堆栈上分配的对象的指针。而且，当您的功能存在时，它将被正确地销毁。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-23T11:06:59.147

你可以这样做：

```
Whatever* aWhatever = new ( alloca(sizeof(Whatever)) ) Whatever; 
```

您可以使用 RAII 类进行我认为的破坏（编辑：另请参阅[此其他答案以获取有关此方法的潜在问题的更多信息](https://stackoverflow.com/questions/472015/new-on-stack-instead-of-heap-like-alloca-vs-malloc/1617616#1617616)）：

```
template <class TYPE>
class RAII
    {
    public:
        explicit RAII( TYPE* p ) : ptr(p) {}
        ~RAII() { ptr->~TYPE(); }
        TYPE& operator*() const { return *ptr; }
    private:
        TYPE* ptr;
    }

void example()
    {
    RAII<Whatever> ptr = new ( alloca(sizeof(Whatever)) ) Whatever;
    } 
```

您可以使用宏来隐藏分配。

问候戴夫夫

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-24T10:35:47.640

**`_alloca()`与 GCC 一起使用时要小心**

GCC 有一个[错误，它与 C++ 中`_alloca()`的 SJLJ 异常处理不兼容](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=19774)（据报道 Dwarf2 可以正常工作）。当分配内存的函数抛出异常时，该错误会在析构函数开始运行之前导致堆栈损坏。这意味着在分配的对象上工作的任何 RAII 类都必须**在另一个函数中运行**才能正常工作。正确的做法是这样的：

```
void AllocateAndDoSomething()
{
  Foo* pFoo = reinterpret_cast<Foo*>(_alloca(sizeof(Foo)));
  new (pFoo) Foo;

  // WARNING: This will not work correctly!
  // ScopedDestructor autoDestroy(pFoo);
  // pFoo->DoSomething();

  // Instead, do like this:
  DoSomething(pFoo);
}

void DoSomething(Foo* pFoo)
{
  // Here, destruction will take place in a different call frame, where problems
  // with _alloca() automatic management do not occur.
  ScopedDestructor autoDestroy(pFoo);
  pFoo->DoSomething();
} 
```

# ruby-on-rails - Ruby on Rails 应用程序根目录

> ID：472020
> 
> 赞同：5
> 
> 时间：2009-01-23T05:52:45.927
> 
> 标签：ruby-on-rails, routes

如何更改 rails 应用程序以使控制器 foo 显示为应用程序根？

换句话说，现在所有的 url 看起来都像 host.com/foo/... 而我想摆脱 foo 并简单地拥有 host.com/...

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T06:01:21.447

在 routes.rb 中，添加：

```
map.root :controller => 'foo' 
```

[API](http://api.rubyonrails.org/)中的完整详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T06:01:50.243

在您的 routes.rb 中，您添加一个命名路由，如下所示：

```
map.home '', :controller => 'foo', :action => 'index' 
```

这将为请求 Web 应用程序的根目录时构建一个路由，它将使用 foo 控制器并调用 index 操作。确保你把它放在底部，所以它的优先级最低。

# ide - 什么 ide 适合开发 PyQt 应用程序？

> ID：472021
> 
> 赞同：19
> 
> 时间：2009-01-23T05:53:09.763
> 
> 标签：ide, pyqt, add-in

什么 ide 适合开发 PyQt 应用程序？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-03T06:12:30.833

我正在使用 Eclipse 的 pydev 扩展来进行 Python 开发。Snappy，适用于 Windows 和 Linux，非常好的调试器（可与 Eclipse Java IDE 调试器相媲美）。代码完成也能够绑定到 PyQt 模块。

如果你指的是写.ui文件，PyQt自带的Qt Designer就足够布局widget了，pyuic4会帮你转成Python代码（pyuic4自带PyQt）。

[蚀](http://www.eclipse.org)

[PyDev](http://pydev.sourceforge.net/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-06T08:09:00.463

我发现[eric4](http://eric-ide.python-projects.org/)非常强大。它加载 qt 程序来做标准的东西（qt-designer、qt-linguist），它的编辑器和调试器技能非常高。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-23T06:00:58.047

我发现[Wing IDE](http://www.wingware.com/doc/howtos/pyqt)非常好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-02-10T14:24:21.070

我现在将 PyCharm 用于我的大部分 Python 内容（GUI、非 GUI、桌面、在线、一切）。PyQt 支持还没有完全准备好（大部分是），但其他任何东西都可以正常运行。PyDev 是我以前的 IDE，对我来说有点复杂。然后是 Monkey Studio 和 Eric IDE，它们都是专门为 PyQt 设计的，但也有很多问题。这是它们的主要缺点。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-04-23T11:14:06.487

> 我正在使用 Eclipse 的 pydev 扩展来进行 Python 开发。Snappy，适用于 Windows 和 Linux，非常好的调试器（可与 Eclipse Java IDE 调试器相媲美）。代码完成也能够绑定到 PyQt 模块。

在 Eclipse 中设置 PyQT 可能会很麻烦，但是当它设置好后，它运行得非常好！[popdevelop](http://popdevelop.com/2010/04/setting-up-ide-and-creating-a-cross-platform-qt-python-gui-application/)上有一个指南，向您展示了如何在 Windows 中设置 Eclipse 以使用 PyQT，以及代码完成等等。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-12-28T18:25:42.180

为什么你不使用 MonkeyStudio？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-06-25T09:18:43.110

[Eric Python IDE](http://eric-ide.python-projects.org/)是我为 PyQt 找到的最好的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-08-01T05:13:08.963

在过去的 2-3 年里，我一直在使用/工作在一个名为 Ideas 的编辑器上。

它类似于 eric4，它是用 PyQt 编写的，并使用 QScintilla 编辑器进行语法高亮，但我正在处理分发绑定，因此您不必编译它。让它适用于 Windows，接近让它适用于 MacOS（尽管适用于所有平台）。

你可以在这里得到它：http: [//www.projexsoftware.com/products/ideas](http://www.projexsoftware.com/products/ideas)

我制作它的主要功能是用于向导（使得生成新的 Qt 小部件和代码变得非常容易）、可移植性（跨平台并在 Maya、Houdini、3dsmax 等 3d 应用程序中工作）和调试 - 它有一个完整的 Python 调试器。即将添加 pylint 支持。

我将很快为其添加更多视频教程，但文档站点上也有完整的用户指南。

# javascript - Google App Engine 上的 Flash ExternalInterface 问题

> ID：472026
> 
> 赞同：2
> 
> 时间：2009-01-23T05:56:31.677
> 
> 标签：javascript, flash, google-app-engine

在过去的几个小时里，我一直在为此苦苦挣扎，我真的不知道可能出了什么问题。我只是想让 Javascript 与 Flash 进行文本通信。我用这个来源找到了这个很好的例子

[http://blog.circlecube.com/wp-content/uploads/2008/02/ActionscriptJavascriptCommunication.zip](http://blog.circlecube.com/wp-content/uploads/2008/02/ActionscriptJavascriptCommunication.zip)

我在本地运行了 html 文件，它可以很好地从 Flash 发送和检索文本。然后我将相同的示例加载到我的开发谷歌应用服务器中，我无法将文本从 javascript 发送到 flash。奇怪的是，虽然 flash 能够发送 Javascript 文本。任何人都可以看看他们是否可以使用 GAE 运行它吗？太感谢了！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T07:23:46.880

它可能与谷歌应用引擎本身无关，因为整个事情都在浏览器中运行——除非在你没有提到的地方存在某种服务器依赖。假设情况并非如此......

如果您能够让 Flash 使用 ExternalInterface.call() 调用 JavaScript，但不能让 JavaScript 回调 Flash，那么可能是一两件事：您的 EI 回调和处理程序未正确连接（在 Flash 中） )，或者您的 JavaScript 在浏览器中没有 SWF 对象的句柄。

您可能会尝试发布一些代码，但与此同时，我知道这在 IE 和 FireFox 中都有效。一、浏览器代码：

```
<html>
<head>
<script language="JavaScript" type="text/javascript">

    var swfReady = false;

    function callbacksInitialized()
    {
        swfReady = true;
    }

    function helloFlash()
    {
        if (swfReady)
        {   
            // Get a handle on the Flash object
            var swfObject = navigator.appName.indexOf("Microsoft") != -1 ? window["HelloMac"] : document["HelloMac"] ;

            // Call back into the Flash file 
            swfObject.helloFlash(document.getElementById("txtMessage").value);
        }
    }

    function helloMac(message)
    {
        alert(message);
    }

</script>
</head>
<body scroll="no">
    <div align="center">

        <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
                id="HelloMac" width="600" height="300"
                codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab">
                <param name="movie" value="HelloMac.swf" />
                <param name="quality" value="high" />
                <param name="bgcolor" value="#869ca7" />
                <param name="allowScriptAccess" value="sameDomain" />
                <embed src="HelloMac.swf" quality="high" bgcolor="#869ca7"
                    width="600" height="300" name="HelloMac" align="middle"
                    play="true"
                    loop="false"
                    quality="high"
                    allowScriptAccess="sameDomain"
                    type="application/x-shockwave-flash"
                    pluginspage="http://www.adobe.com/go/getflashplayer">
                </embed>
        </object>

        <br /><br />
        <input type="text" id="txtMessage" value="Hello, Flash!" /><br />
        <input id="btnSend" type="button" value="Send to Flash" onclick="helloFlash();" />
    </div>
</body>
</html> 
```

现在，Flash 代码（在我的例子中，它是 Flex，所以希望它很清楚）：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" initialize="init()" height="300" width="600">

    <mx:Script>
        <![CDATA[

            import mx.controls.Alert;
            import flash.external.ExternalInterface;

            private function init():void
            {
                addCallbacks(); 
            }

            private function addCallbacks():void
            {
                ExternalInterface.addCallback("helloFlash", this_helloFlash);
                ExternalInterface.call("callbacksInitialized");
            }

            // Display a message from the host
            private function this_helloFlash(message:String):void
            {
                Alert.show(message);
            }

            // Send a string to the host
            private function helloMac():void
            {
                if (ExternalInterface.available)
                {
                    ExternalInterface.call("helloMac", txtMessage.text);
                }
            }

        ]]>
    </mx:Script>

    <mx:VBox horizontalCenter="0" verticalCenter="0">
        <mx:TextInput id="txtMessage" text="Hello, Mac!" />
        <mx:Button id="btnSend" label="Send to Host" click="helloMac()" />
    </mx:VBox>

</mx:Application> 
```

该示例演示了 Flash 调用带有一些文本的 JavaScript，以及 JavaScript 以相同的方式回调 Flash。需要注意的几点：

*   确保您**等待**调用 Flash，直到 Flash 通知浏览器它已准备好开始接收调用（如我的 callbacksInitialized() 方法所示）。
*   测试以确保您使用的是适当的特定于浏览器的对象引用（例如，window["HelloMac"] 与 document["HelloMac"]）。

在不知道更多的情况下，我猜它是这两个项目之一，因为这是我的经验。希望能帮助到你！如果您有任何后续，我会密切关注该帖子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T05:23:11.310

我没有在您的代码中看到对 allowDomain 函数的调用。没有安全沙箱将不允许您的闪存应用程序与服务器上的闪存通信，反之亦然。`System.security.allowDomain("mydomain.com", "mySecondDomain.com", "etc.com")`为将执行 Flash 应用程序的每个域添加一个调用。此外，嵌入代码还需要通过包含参数来指定 JavaScript 的访问权限`<param name="allowScriptAccess" value="always" />`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T17:07:12.413

是的，Christian Nunciato 的回答很有帮助。问题是您的 swf 文件在您的 javascript 调用 flash 函数时对 javascript 不可用。Christian 的技巧确保 swf 文件在您的 javascript 需要时加载并启动。

# machine-learning - 很酷的项目使用遗传算法？

> ID：472030
> 
> 赞同：49
> 
> 时间：2009-01-23T06:00:36.020
> 
> 标签：machine-learning, genetic-algorithm

我正在寻找一个使用遗传算法的实际应用程序。想到的一些事情是：

*   网站界面优化
*   使用物理模拟器进行车辆优化
*   遗传编程
*   自动测试用例生成

但没有一个人真的突然出现在我身上。所以如果你有一些空闲时间（几个月）花在遗传算法项目上，你会选择解决什么问题？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-23T12:48:10.813

一个有很多可能性的主题是使用进化算法来进化游戏策略。人们已经使用进化来生成扑克、跳棋/跳棋、围棋和许多其他游戏的策略。[J-GAP](http://jgap.sourceforge.net/)人员使用基因编程为[Robocode](http://robocode.sourceforge.net/)进化了机器人。

我最近发表了[一篇](http://blog.uncommons.org/2009/01/20/practical-evolutionary-computation-an-introduction/)关于进化计算的介绍性文章。它包括一些进化算法已经用于的细节。 [Adam Marczyk](http://www.talkorigins.org/faqs/genalg/genalg.html)还写了一篇很棒的文章，里面有很多例子。[遗传 Argonaut 博客](http://geneticargonaut.blogspot.com/)包含许多有趣的进化项目的链接。

一种不太常见的进化算法类型是[学习分类器系统](http://en.wikipedia.org/wiki/Learning_classifier_system)。这演变出一组用于对输入进行分类的规则。它可以应用于与神经网络相同的问题。为特定问题开发 LCS 可能很有趣，例如尝试根据形式预测运动结果。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-23T06:06:57.973

你可能对罗杰·阿尔辛的[蒙娜丽莎之类的东西感兴趣](http://rogeralsing.com/2008/12/07/genetic-programming-evolution-of-mona-lisa/)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-23T06:13:03.013

我认为到目前为止，[进化乐高结构](http://www.thinkartificial.org/artificial-intelligence/evolving-lego-brick-structures/)是 GA 最有趣的玩具项目。

[http://static.23.nu/md/Pictures/ZZ099735B6.jpg](http://www.demo.cs.brandeis.edu/pr/buildable/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-11-04T18:55:42.940

我已经阅读了类似于自动测试用例生成的问题。其实恰恰相反。您指定测试用例，然后让算法（遗传编程）创建将通过的代码。通过这种方式，您可以提供规范并培育您的程序。如果你用谷歌搜索一下，你可以找到一些关于它的研究。
我觉得这是一个非常有趣的想法。当然，现在没有人会创建这样的应用程序，但这是一个很好的研究领域。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-23T06:56:25.813

我玩康威的生命游戏和遗传算法玩得很开心，
尝试进化高级生命形式。但不确定它是否会让你忙
几个月。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-23T07:11:18.107

也许**找一个旅行推销员旅行**。我最近尝试在巴黎的大约 66 个地点进行徒步旅行，我发现编写所有这些东西非常有趣。我认为我的兴奋源于两个来源：我可以绘制旅行团（蒙娜丽莎的想法也是一件好事，或者如果工程是你的事，乐高结构）以及有很多方法你可以比较：

*   您可以使用简单的启发式方法，例如“从某个地方开始，总是去最近的、未访问的位置”。
*   您可以使用更复杂的启发式方法，例如“通过增加成本继续按顺序添加边（任何地方），除非它会导致三个边超出一个顶点或更小的循环”。
*   如果您的成本满足三角不等式，您可以使用近似算法，例如[基于最小生成树的简单算法。](http://en.wikipedia.org/wiki/Travelling_salesman_problem#Metric_TSP)作为奖励，您可以编写最小生成树（也许您甚至可以在那里使用 GA，尽管可以使用快速简便的精确算法）。如果您有信心，您可以编写基于最小生成树和完美匹配的更难的（3/2）近似算法。
*   如果您有任何旅行推销员之旅并且它自己交叉，您可以通过“uncrossing it”来改进它。同样，这假设了成本函数的一些条件。
*   你甚至可以尝试自己找一个游览，看看你能不能打败你的电脑。
*   最后但同样重要的是，遗传算法！这个问题非常适合 GA，因为它有一个非常清晰的适应度函数和一个非常简单的重组方法。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-23T07:19:50.150

请参阅[使用遗传编程可以解决哪些问题？](https://stackoverflow.com/questions/355460/what-problems-could-be-solved-using-genetic-programming)

我认为[车辆制造](http://www.wreck.devisland.net/ga/)真的很酷。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-23T09:23:26.437

它已被用于复杂的合成器中以生成声音补丁（例如[Clavia Nord Modular G2](http://www.nordkeyboards.com/main.asp?tm=Products&clpm=Nord_Modular_G2&clnmm=Information)）。我也会在其他机器上尝试它，我想到了 Yamaha DX7，但我想那里有很多软件替代品。或图像生成。

[在Palle Dahlstedt](http://www.id.gu.se/palle/dokt/soundsunheardof.htm)的论文中阅读补丁算法背后的理论。不过现在好像下线了……

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-28T19:59:03.490

遗传算法非常适合优化和调度。一个例子是调度一组机器，让零件和操作员随着时间的推移完成一组任务。虽然可能不是最令人兴奋的项目，但它会有现实世界的应用。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-11-04T19:01:04.793

生成音乐作品！阅读有关 David Cope 和他的程序 Emily Howell 的信息。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-23T06:50:33.063

我相信我看到有人提到[一个项目](http://klausler.com/evolved.html)，该项目使用一个来尝试找出最佳键盘布局将是——“击败德沃夏克”。:D

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-23T09:29:40.373

回到大学我做了多维函数最小化..假设你有 af(x) 它接受参数 x1,x2,x3,...,xn 并生成一个值 Y..你需要找到参数 x1,.., xn 使得 Y=Y1.. 没那么难.. 有趣的学习方式。尽管内德米德的效率更高……但这不容易陷入局部最小值。

# objective-c - 修复文本字段中的最大字符数限制

> ID：472034
> 
> 赞同：1
> 
> 时间：2009-01-23T06:01:58.933
> 
> 标签：objective-c, cocos2d-iphone

Cocos2d 中如何对文本字段进行固定字符限制？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T07:45:16.120

要修复 UITextField 中的最大字符数，您可以实现 UITextField 委托方法`textField:shouldChangeCharactersInRange`以在用户尝试编辑超过固定长度的字符串时返回 false。

```
//Assume myTextField is a UITextField
myTextField.delegate = self;

//implement this UITextFiledDelegate Protocol method in the same class
- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string {
    if ([textField.text length] > kMaxTextFieldStringLength)
        return NO;
    else
        return YES; 
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-19T06:02:34.390

要使用户能够使用退格，您应该使用这样的代码（当您按下退格时 range.length 仅为零）：

```
 myTextField.delegate = self;

//implement this UITextFiledDelegate Protocol method in the same class
- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string { 
    if (textField.text.length >= 10 && range.length == 0)
        return NO;
    return YES;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-17T04:37:05.487

仅当用户在文本字段的末尾（最后一个字符）进行编辑时，上面的示例才有效。要检查输入文本的实际长度（无论用户在哪里编辑光标位置），请使用以下命令：

```
myTextField.delegate = self;

//implement this UITextFiledDelegate Protocol method in the same class
- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string {
    if (range.location > kMaxTextFieldStringLength)
        return NO;
    else
        return YES; 
} 
```

# .net - 如何在不产生 msbuild.exe 进程的情况下从 Powershell 运行 MSBuild？

> ID：472038
> 
> 赞同：12
> 
> 时间：2009-01-23T06:07:20.903
> 
> 标签：.net, powershell, msbuild

我正在考虑通过直接点击 MSBuild 程序集从 Powershell 脚本运行 MSBuild（而不是查找 MSBuild 安装路径并将 msbuild.exe 作为子进程启动）。

有人做过吗？运行构建的最简单、最直接的方法是什么？您想指出这两种技术是否有任何优点/缺点？（我对在与脚本的其余部分相同的进程/appdomain 中运行 msbuild 可能出现的任何问题特别感兴趣）。

目前我的想法是这样的：

```
[void][System.Reflection.Assembly]::Load('Microsoft.Build.Engine, Version=3.5.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a')
[void][Microsoft.Build.BuildEngine.Engine]::GlobalEngine.BuildProjectFile("path/main.proj") 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-23T16:49:56.787

工作并产生输出的最简单的嵌入式构建调用是：

```
[void][System.Reflection.Assembly]::Load('Microsoft.Build.Engine, Version=3.5.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a')
$engine = New-Object Microsoft.Build.BuildEngine.Engine
$engine.RegisterLogger((New-Object Microsoft.Build.BuildEngine.ConsoleLogger))
$engine.BuildProjectFile('fullPath\some.proj') 
```

然而，事实证明直接在 Powershell (V1) 中嵌入 MSBuild 是有问题的：

```
'MSBUILD : warning MSB4056: The MSBuild engine must be called on
a single-threaded-apartment. Current threading model is "MTA".
Proceeding, but some tasks may not function correctly.' 
```

为什么哦，为什么我们在 2009 年仍然在托管环境中工作时缴纳 COM 税？

我的结论是在 Powershell (V1) 中嵌入 MSBuild 不是一个好主意。作为参考，我还包括了我最终使用的基于流程的方法：

```
[void][System.Reflection.Assembly]::Load('Microsoft.Build.Utilities.v3.5, Version=3.5.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a')
$msbuild = [Microsoft.Build.Utilities.ToolLocationHelper]::GetPathToDotNetFrameworkFile("msbuild.exe", "VersionLatest")
&$msbuild fullPath\some.proj 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-23T14:50:49.087

我强烈建议您查看[PSake](http://codebetter.com/blogs/james.kovacs/archive/2008/06/27/introducing-psake.aspx)。

让我引用该页面的一部分：

> 请记住，psake 是围绕 PowerShell 的语法糖。因此，您可以在 PowerShell 中执行的任何操作都可以在 psake 中执行。这意味着您可以运行 MSBuild、NAnt 或其他脚本。无需完全替换您当前的构建系统。您可以使用 psake 来自动化和扩展它！
> 
> psake 会自动将适当版本的 .NET Framework 添加到其路径中。因此，您可以在没有完全限定路径的情况下访问 MSBuild、csc.exe、vbc.exe 或安装在 $env:windir\Microsoft.NET\Framework\$version\ 中的任何其他工具。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T06:13:29.380

另一种可能更有用的方法是创建一个 msbuild cmdlet。MsBuild 有一个很好的 API，并且有很多关于如何从 C#/VB 等编译语言中使用它的示例。构建一个 cmdlet 将为您的 powershell 脚本提供更好的语法将非常容易。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-23T15:00:12.780

我一直在寻找同样的东西。在 JaredPar 的带领下，我发现了以下内容：

这是制作 cmdlet 的方法。

[http://bartdesmet.net/blogs/bart/archive/2008/02/03/easy-windows-powershell-cmdlet-development-and-debugging.aspx](http://bartdesmet.net/blogs/bart/archive/2008/02/03/easy-windows-powershell-cmdlet-development-and-debugging.aspx)

MSBuild API 是这些命名空间的一部分：

```
Microsoft.Build.Framework

Microsoft.Build.BuildEngine 
```

并且可以在此处找到 MSBuild 文档（这更多的是为了完整性而不是回答您的问题）：

[http://msdn.microsoft.com/en-us/library/wea2sca5.aspx](http://msdn.microsoft.com/en-us/library/wea2sca5.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-30T15:12:47.307

曾几何时，我一直在玩增强型 MSBuild 构建过程（例如，更积极地跳过构建的某些部分）。

有两个选择：

1.  通过加载其 DLL 在您自己的进程中托管 MSBuild。
2.  以常规方式生成 MSBuild.exe，然后注入其中（例如，记录器提供了一种不错的方式）。

我已经实现了两者并且不得不放弃＃1，因为它不够灵活。

例如，MSBuild 在其 .config 文件中有大量程序集绑定重定向。

还使用其 API 托管 MSBuild的 Visual Studio 进程 ( `devenv.exe`) 最终将这些复制粘贴到其`devenv.exe.config`. 我`.exe.config`的也必须有这些，但它会遵循特定的 MSBuild 版本。而且，当然，您必须修改配置。这实际上不是 PS 的一个选项，所以我怀疑你是否能得到一个真正稳定的解决方案。

# php - 将 Ruby/Rails 应用程序移植到 PHP 5

> ID：472039
> 
> 赞同：3
> 
> 时间：2009-01-23T06:07:33.697
> 
> 标签：php, ruby

我有一个非常大的 Ruby on Rails 应用程序，我想移植到 PHP 5.2 或 PHP 5.3（如果 5.3 发布的话）。

我一直在寻找一种自动转换简单类和 ERB 模板等简单内容的方法。我希望在语言过于不同的情况下，我必须自己做更复杂的事情。

任何人都可以建议这样做的方法吗？或者可以自动化其中一些的脚本？

**编辑：**

这样做有一个商业案例。这是否是一个合理的商业案例是另一个我不想在这里讨论的问题。我们有一个与 Rails 足够相似的框架——真正的问题是从 Ruby 到 PHP 的转换，而不是从 Rails 到 PHP。我并不是真的在寻找能够神奇地完成所有工作的东西，只是一些简单的东西，可以让你领先一步。即使它所做的只是改变：

```
def somemethod somearg
  some.ruby.code
end 
```

到：

```
public function somemethod($somearg) {
  // some.ruby.code
} 
```

并在 php 注释中留下内脏作为红宝石，这仍然会使工作更容易。

理想情况下，已经有一些东西可以做到这一点或类似的事情。否则我可能不得不自己编写工具。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T09:10:23.423

在任何两种语言之间移植应用程序是一项不平凡的工作。在这种情况下，情况就更糟了，因为 php 和 ruby​​ 的不同之处。您不能希望为此获得任何类型的自动化过程。

如果你需要这样做（*为什么*这本身就是一个不同的故事），你可以尝试使用在设计上最接近 Rails 的 php 框架之一。最好的候选者可能是[Symfony](http://www.symfony-project.org/)或可[维护的 PHP 框架](http://framework.maintainable.com/mvc/1_intro.php)。

不过我想知道-您从事这项工作的原因是什么？

编辑：

在 php 中，很多符号是全局的和不可变的，一旦定义。例如，类和函数不能重新定义，也没有命名空间支持。在 ruby​​ 中，可以 - 并且非常常用 - 在运行时操作类。这是不可能自动转换的，而且在许多情况下根本不可能做到。即使您使用 phps 魔术方法 ( `__get`/ `__set`/ `__call`) 绕过它，性能损失也会非常严重，以至于您的应用程序无法使用。做到这一点的唯一方法是手动。

您也许可以使用诸如[rumld 之](http://rumld.rubyforge.org/)类的工具来为您提供一个起点。另请参阅[this](https://stackoverflow.com/questions/52016/uml-for-ruby)，了解更多 ruby​​-to-uml 工具。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T17:51:56.317

让我给你讲一个关于自动化程序转换的故事……

几年前，我在一家教育机构工作。这家教育机构运行了一个基于 $ENTERPRISE_DB_VENDOR 的 ERP 系统，并且已经运行了大约 20 年。原始系统是用 COBOL 和一些 $ENTERPRISE_DB_VENDOR 报告工具/语言编写的。多年来，报告工具已被弃用（并添加了 C）。在某些时候，$ENTERPRISE_DB_VENDOR 杀死了该工具。不幸的是，仍然有一些重要的组件是用它编写的。

“最简单”的解决方案是让 $ERP_VENDOR 的某个出色的开发人员编写一个转换工具，将报告工具翻译成 C。几乎无法辨认，显然是由计算机生成的，但仍然可以完美运行 C。据我了解，计划是这样将成为让产品现在工作的权宜之计，但是，这些东西将被手动重写，“很快”。

前进 10 年……我的第一个任务是在网络上发布一些报告——一份最初是用旧报告语言编写的报告。然后它被转换为 C。它从未被重写——人们只是做了“小改动”来添加小功能或修复错误。是的。他们正在对计算机生成的 C 进行更改。

在考虑尝试编写自动转换工具之前，请考虑一下这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T14:18:37.310

我完全同意 troelskn，这是一项艰巨的任务，我认为您很难找到任何形式的自动化流程来移植应用程序。

你最好的选择是找到一个在设计上非常相似的框架，并一个一个地移植所有的类。

这里最乏味的将是涉及数据库的地方。据我所知，目前还没有与 Rails 的 ActiveRecord 相近的 PHP 的 ORM 解决方案。您必须自己编写大量数据库代码粘合代码，并自己编写所有模型查找器等。自从我上次检查以来，这方面可能已经有了一些改进，但是 PHP 天生就存在 ActiveRecord 设计模式的一些问题。

再一次，我必须回应我确信很多人在想什么......为什么你会想要将应用程序从 RoR 移植到 PHP *。*考虑到时间和金钱，这听起来像是一件昂贵的事情，而且没有明显的优势——当然，除非你已经用 Ruby 碰壁，因为它根本无法做 PHP 可以做的事情。我觉得这很难相信。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-24T09:51:49.360

只是一个随机的脑电波可能会有所帮助

使用 JRuby 获取 JVM 中间语言代码，然后从中生成 PHP 代码。

细节留给你解决！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-03-23T05:08:30.297

这个 ruby​​ gem 声称能够将 ruby​​ 转换为 php。没有测试过，但值得一试。 [https://rubygems.org/gems/php](https://rubygems.org/gems/php) http://php.rubyforge.org/

# performance - 第二次运行托管应用程序显示的性能与第一次不同

> ID：472040
> 
> 赞同：5
> 
> 时间：2009-01-23T06:08:22.947
> 
> 标签：performance, api, benchmarking, performancecounter

我有一个基准测试应用程序来测试我编写的一些 API 的性能。在这个基准测试应用程序中，我基本上使用 QueryPerformanceCounter 并通过将调用 API 前后 QPC 值的差异除以频率来获取时间。但是如果我从不同的驱动器运行应用程序（在同一组 Dll 上运行的相同可执行文件），基准测试结果似乎会有所不同。此外，在特定驱动器上，第一次运行应用程序、关闭应用程序并再次运行它会产生不同的基准测试结果。谁能解释这种行为？我在这里错过了什么吗？

一些更有用的信息：

行为是这样的：运行应用程序，关闭它并再次运行它，基准测试结果似乎在第二次运行时有所改善，此后保持不变。这种行为在从 C 盘运行的情况下更加突出。我还想提一下，我的基准应用程序可以选择重新运行/重新测试特定的 API，而无需关闭应用程序。我确实知道这涉及到 jitting，但我不明白的是，在第一次运行应用程序时，当您在不关闭应用程序的情况下多次重新运行 API 时，性能在运行几次后稳定下来，然后当您关闭并重新运行时同样的测试，性能似乎有所提高。

此外，您如何考虑从不同驱动器运行时的性能变化？

**[信息更新]**

我做了一个**ngen**，现在来自同一位置的不同运行之间的性能差异消失了。即如果我打开基准应用程序，运行一次，关闭它并从同一位置重新运行它，它会显示相同的值。

但是我现在遇到了另一个问题。当我从 D 驱动器启动应用程序并运行它几次（在同一启动基准程序中的 API 迭代几次），然后从第 3 次迭代开始，所有 API 的性能似乎下降了 20% 左右. 然后，如果您关闭并重新启动应用程序并运行它，对于前 2 次迭代，它会给出正确的值（与从 C 获得的值相同），然后性能再次超出该值。从 C 盘运行时看不到此行为。从 C 盘开始，无论您运行多少次，它都非常一致。

我正在使用大型双数组来测试我的 API 性能。我担心 GC 会在测试之间启动，所以我在每次测试之前和之后都明确地调用 GC.Collect() 和 GC.WaitForPendingFinalizers()。所以我认为这与GC无关。

我尝试使用 AQ 时间来了解从第 3 次迭代开始发生了什么，但有趣的是，当我使用 AQ 时间分析它运行应用程序时，性能根本没有下降。

性能计数器 as 不建议任何有趣的 IO 活动。

谢谢尼兰詹

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T09:21:40.483

运行应用程序会将其可执行文件和其他文件从硬盘驱动器带入操作系统的磁盘缓存（在 RAM 中）。如果稍后再次运行，这些文件中的许多很可能仍在缓存中。RAM 比磁盘快得多。

当然，一个磁盘可能比另一个更快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T06:10:57.667

是的。它被称为[即时编译](http://msdn.microsoft.com/en-us/library/ht8ecch6.aspx)。基本上，您的应用程序被部署为 MSIL（Microsoft 中间语言），并且在第一次运行时它会被转换为本机代码。

您始终可以运行 NGen（请参阅上面的文章），或者在性能测试脚本中设置一个预热期，在实际对性能进行基准测试之前，它会在场景中运行几次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T17:31:11.540

我认为这里有多种效果：

首先，在测试工具中多次运行相同的功能，每次使用相同的数据，可能会有所改善，因为：

*   JIT 编译将优化最频繁运行的代码以提高性能（正如Cory Foy[已经提到的）](https://stackoverflow.com/questions/472040/running-a-managed-application-2nd-time-shows-different-performance-than-1st#472044)
*   程序代码将在磁盘缓存中（正如Crashwork[已经提到](https://stackoverflow.com/questions/472040/running-a-managed-application-2nd-time-shows-different-performance-than-1st#472333)的）
*   一些程序代码如果足够小并且足够频繁地执行，它将在 CPU 缓存中

如果测试工具中函数每次运行的数据都*不同*，这可以解释为什么再次关闭并运行测试工具会改善结果：数据现在*也*将在磁盘缓存中，这不是第一次。

最后，是的，即使两个“驱动器”在同一个物理磁盘上，它们也会有不同的性能：从磁盘外部读取数据的速度比内部读取速度快。如果它们是不同的物理磁盘，那么性能差异似乎很可能。此外，一个磁盘可能比另一个磁盘碎片更多，从而导致更长的寻道时间和更慢的数据传输速率。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T18:04:21.067

此外，其他因素可能正在发挥作用。机器上的文件系统缓存，最近使用的数据的缓冲等。

最好运行多个测试（或数百个！）并在整个集合中取平均值，除非您专门测量冷启动时间。

# .net - Asp.Net MVC 路由表和控制器操作

> ID：472046
> 
> 赞同：5
> 
> 时间：2009-01-23T06:12:05.560
> 
> 标签：.net, asp.net-mvc, model-view-controller, controller, routes

我正在创建一个包含成员及其个人资料的目录。我在.net 中使用MVC 框架。

我有一个视图允许您根据某些条件查找成员，因此我的控制器有一个 Find() 操作结果，然后是另一个接受后置动词的视图。因此，somesite.com/members/find 会显示搜索工具，然后一旦提交表单，相同的 url 就会显示结果。我现在希望成员名称链接到同一控制器中的另一个 actionresult 方法以显示他们的个人资料，并且我希望 url 遵循此模式 somesite.com/members/{username}。

我如何创建一个控制器方法来做到这一点？还有比这更多的吗？
我需要在 global.asax 中绘制新路线吗？

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T06:29:56.523

首先在控制器上创建您的操作方法，如下所示：

```
public ActionResult Profile(string userName)
{
    // Do What you want with the userName
    throw new System.NotImplementedException();
} 
```

然后在 global.asax 文件中创建一个新路由来处理 somesite.com/members/{username} ，如下所示：

```
routes.MapRoute(
    "Profile",
    "members/{username}",
    new { controller = "Members", action = "Profile", userName = "" }
); 
```

就是这样。我不确定你在调用什么控制器来承载动作方法。我假设成员。

# javascript - jQuery：如何选择表格中的每个单元格，除了每行的最后一个单元格？

> ID：472048
> 
> 赞同：7
> 
> 时间：2009-01-23T06:12:34.093
> 
> 标签：javascript, jquery

我想要每行中的每个单元格，除了每行中的最后一个。我试过：

```
$("table tr td:not(:last)") 
```

但这似乎给了我每个单元格，除了表格中的最后一个。不是我想要的。

我确信这很简单，但我仍然在选择器周围。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-23T07:23:17.973

尝试：

```
$('table tr td:not(:last-child)') 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-23T07:37:27.430

你可以试试

```
$("table td:not(:last-child)") 
```

或者

```
$("table td:not(:nth-child(n))") 
```

其中 n 是子元素的从 1 开始的索引

或者

```
$("table td").not(":last-child") 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T07:26:14.257

尝试最后一个子选择器。这：

```
$("table tr td:not(:last-child)") 
```

将选择除最后一列中的单元格之外的所有行中的所有单元格。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-02T21:03:16.177

fwiw 我发现你的原创作品很好（也许是自 2009 年以来对 main jQ 的增强？）......

```
$("#myTable thead th:not(:last)").css("border-right","1px solid white"); 
```

我的表格的标题行具有海军背景，因此右侧的白色边框使表格看起来像锯齿状，与数据的黑色 1px 边框不匹配

# orm - 连接表中带有额外列的多对多映射

> ID：472052
> 
> 赞同：2
> 
> 时间：2009-01-23T06:14:34.587
> 
> 标签：orm, nhibernate-mapping, domain-driven-design

这是我希望拥有的域：

```
public class Person
{
    public int Id { get; set; }
    public IList<AcquiredCertificate> AcquiredCertificates { get; set; }
}

public class AcquiredCertificate
{
    public Person Acquirer { get; set; }
    public Certificate Certificate { get; set; }
    public DateTime DateAcquired;
}

public class Certificate
{
    public int Id { get; set; }     
} 
```

这是我拥有的架构：

```
CREATE TABLE People (
    PersonId INT PRIMARY KEY
);

CREATE TABLE Certificates (
    CertificateId INT PRIMARY KEY
);

CREATE TABLE CertificatesAcquiredByPeople (
    PersonId INT,
    CertificatedId INT,
    DateAcquired DATETIME
); 
```

这是一个人为的架构和域，但它与我正在使用的东西几乎相同。我目前通过编写第三个域实体来表示 CertificatesAcquiredByPeople 表，但这对我来说真的很奇怪。

我将如何使用 NHibernate 映射它？我相信 hbm 文件中的组件标签应该做我想要的，但我不太明白。

我的域是否因为我的证书类上有一个 DateAcquired 属性而出现问题？日期实际上只是拥有证书的人的关注点。

**[编辑]**

我现在更改了域模型以反映需要一个新实体。现在对于映射，我需要 3 个（对于每个实体）映射，还是可以使用 2 个（对于人员和证书）进行映射？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-24T18:46:04.600

根据设计，NHibernate 仅支持隐式多对多映射，如果除了中间（中间）表中表示的持有多对多关系的 FK 对之外，没有其他任何东西。

前段时间，Billy McCafferty 在博客中谈到了这个确切的“问题”（自设计以来并不是真正的问题）......

[http://devlicio.us/blogs/billy_mccafferty/archive/2008/07/11/when-to-use-many-to-one-s-vs-many-to-many-with-nhibernate.aspx](http://devlicio.us/blogs/billy_mccafferty/archive/2008/07/11/when-to-use-many-to-one-s-vs-many-to-many-with-nhibernate.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T17:33:57.680

我认为您需要 3，如果您要获得 DateTime 值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T06:23:17.660

您的实现完全正确。您的连接表包括两个键字段（为表创建一个复合主键），而 datetime 字段是多余的。它实际上是连接表上的一个额外属性，为此您需要一个实体。

在 UML 类图上，它也会显示为连接上的属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T06:40:06.750

我会将 CertificatesAcquiredByPeople 重命名为 CertificatesAcquiredEvent
之类的名称（这意味着有多个密钥和一个日期时间）

我同意就 NHibernate 而言它需要是一个单独的实体。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-24T18:55:46.547

回复：您更新的 Q，您将需要三个映射，一个用于现在参与一对多关系对的三个实体中的每一个。

# c++ - 解析字符串数组 C++ 的内容

> ID：472053
> 
> 赞同：1
> 
> 时间：2009-01-23T06:17:02.553
> 
> 标签：c++, parsing

我已经读取了一个文件，并将其内容存储到一个字符串数组中。

我需要更改一些数值，编译器将其解释为字符。

文件格式为：ABCDE,EFGHIJ KLMNOPQRS,45.58867,122.59750

我已经搜索和研究过，但没有得到任何太全面的东西。

如果有人可以请告诉我如何做到这一点，我会很高兴。

而且我不允许使用 strtod；我认为这是一个 C 函数，我的程序只需要严格使用 C++。

这是我到目前为止开发的代码：

```
#include <iostream>
#include <fstream>
#include <string>
#include <vector>
#include <iomanip>
#include <cstdlib>
#include <sstream>

using namespace std;

int main()
{

    string usrFileStr,
    fileStr = "airNames.txt",  // declaring an obj string literal
    sBuffer,
    sLine = "";

    istringstream iStrStrm;

    int lineCount = 1;
    int nStart;

    fstream inFile;                  // declaring a fstream obj
    // cout is the name of the output stream
    cout << "Enter a file: ";
    cin >> usrFileStr;

    inFile.open( usrFileStr.c_str(), ios::in ); 
    // at this point the file is open and we may parse the contents of it

    while ( getline ( inFile, sBuffer ) && !inFile.eof() )
    {
          nStart = -1 ;
          cout << "First Str " << lineCount << " (";
          for ( int x = nStart + 1; x < sBuffer.length(); x++ )
          {
              if ( sBuffer[ x ] == ',' )
              {
                   nStart = x;
                   break;
                   }
              cout << sBuffer[ x ];

          }
          cout << ") ";
          for ( int x = nStart + 1; x < sBuffer.length(); x++ )
          {

              if ( sBuffer[ x ] == ',' )
              {    
                   nStart = x;
                   break;
                   }
              cout << sBuffer[ x ];
          }
          cout << " (Second Str: "; // lattitude loop

          for ( int x = nStart + 1; x < sBuffer.length(); x++ )
          {
              if ( sBuffer[ x ] == ',' )
              {
                   nStart = x;
                   break;
                   }
              cout << sBuffer[ x ];         
          }

          cout << ", Third String: ";
          for ( int x = nStart + 1; x < sBuffer.length(); x++ )
          {
              if ( sBuffer[ x ] == ',' )
              {
                   nStart = x;
                   break;
                   }
              cout << sBuffer[ x ];
          }
          cout << ") \n";
          lineCount++;
    }

    cout << "There are a Total of: " <<  lineCount << " line(s) in the file."
    << endl;

    inFile.clear();           // clear the file of any errors
    inFile.close();  // at this point we are done with the file and may close it

    fgetc( stdin );
    return 0;
} 
```

我试图只读取小数点后的两位数，但我只得到一个字符。我的第一次尝试是使用 static_cast ，但那已经很遥远了。并且 istringstream 变量不会让它的参数是一个数组。我不知道该怎么办..

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T06:39:19.420

[`std::stringstream`](http://en.cppreference.com/w/cpp/io/basic_stringstream)

学会爱它。不是 istringstream，因为您想从中获取输出。就像是：

```
getline ( inFile, sBuffer );
stringstream myStream(sBuffer);
string first, second, third;
char comma;

myStream >> first;  
myStream >> second;
myStream >> third;

float value1, value2;
myStream >> value1;
myStream >> value2; 
```

另外，我建议您检查以确保文件实际打开。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T07:06:33.657

正如建议的那样，您想要字符串流，但是...

顺便说一句，在 C++ 程序的上下文中忽略 C 函数是愚蠢的。大多数操作系统函数都将作为 C 函数导出，而 C++ 本身通常（总是？）编译成与 C 代码等效的代码，所以坚持只使用 C++ 构造/函数并没有什么好处。在适当的时候一定要使用 C++ 提供的更高级别的抽象和方法，但是如果你试图避免所有的 C 链接函数，你会无缘无故地伤害自己。使用有效的；真正的编程已经够难了，不会跳出自我强加的限制。

当然，以上只适用于现实世界的编程；家庭作业等可能是个例外。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T08:08:10.787

使用 string.find() 可以摆脱一些循环（它可能只是在内部执行它们，但无需重新发明轮子）。您可以使用 stringstream 将数字字符串转换为浮点数或双精度数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T08:37:46.793

使用提升精神（[http://www.boost.org/doc/libs/1_37_0/libs/spirit/classic/index.html](http://www.boost.org/doc/libs/1_37_0/libs/spirit/classic/index.html)）。需要一点时间来适应，但如果你了解它，它会非常强大和有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T07:21:34.343

您也可以尝试使用 boost 正则表达式，参见： http: [//www.boost.org/doc/libs/1_37_0/libs/regex/doc/html/boost_regex/captures.html](http://www.boost.org/doc/libs/1_37_0/libs/regex/doc/html/boost_regex/captures.html)

这样，您可以为 ',' char 添加 reqex 并捕获其中的值，甚至可以验证它们......

祝你好运 ！

# mysql - MySQL查询优化-左侧还是右侧的字段？

> ID：472058
> 
> 赞同：0
> 
> 时间：2009-01-23T06:22:05.883
> 
> 标签：mysql, optimization

我~~知道~~认为我已经阅读过以下内容之一比另一个更快，但我忘记了哪个是哪个：

```
SELECT * FROM `myTable` WHERE `myDate` > NOW();
SELECT * FROM `myTable` WHERE NOW() < `myDate`; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T06:56:19.277

优化器将产生相同的执行计划，实现两边的常量相同。

# json - FilteringSelect 与 QueryReadStore：选择不粘

> ID：472059
> 
> 赞同：3
> 
> 时间：2009-01-23T06:22:10.640
> 
> 标签：json, dojo, autocomplete

我正在使用由 a`dijit.form.FilteringSelect`支持的 a`dojox.data.QueryReadStore`以允许用户选择一个区域（想想“自动完成”机制）。在用户输入的每个字符上，`QueryReadStore`都会向服务器发送一个请求，等待匹配区域的 json 列表（带有关联的 ID）。当显示足够短的列表时，用户选择了所需的项目。[诚然，每次击键查询并不是最有效的模式，但现在已经足够了。]

意外行为：在一些罕见但特定的场合，用户做出的选择“不坚持”。例如，如果用户键入“ `can`”，她会按顺序看到以下选项：

```
Atlantic Canada
Canada
English Canada
Lower Canada
Upper Canada
Western Canada 
```

如果她`Canada`在其中选择“”，dijit 关闭下拉选择，正确选择了她的选择。但是当用户离开该字段时，选择切换到“ `Atlantic Canada`”！

这种奇怪的现象系统地发生在少数特定地区。（起初，我认为这些行为不端的地区之间的共同因素是它们的名称包含重音字符或连字符，但加拿大的例子显然不是这样。到目前为止，我还没有发现一个规律的模式。）

我在任何地方都没有发现任何类似问题的提及。我非常愿意进行调查，但是，由于我是 dojo 的新手，在我求助于深入研究 dojo 的代码之前，我真的很感激指点：我应该首先看哪里？有哪些可能导致这种行为的问题？我可以排除某些假设吗？我应该如何最好地使用控制台（或 Firebug）来深入了解这一点？等等

dojo 1.1.1 和dojo 1.2.3 都会出现此问题。

这是（程序化）生成的`FilteringSelect`：

```
new dijit.form.FilteringSelect({
   name = "region";
   autoComplete = false;
   hasDownArrow = false;
   labelAttr = "name";
   queryExpr = "${0}";
   store = new dojox.data.QueryReadStore({url:'/query/regions'});
}, myNode); 
```

**编辑（2009/02/18）：附加细节**

按照 damelin 的回答，我想了解`FilteringSelect`这种情况的看法。假设我将日志记录功能连接到`FilteringSelect`的事件`onChange`并且`onBlur`，我得到以下逐个播放序列：

*   我单击该字段并输入：`can`
*   出现 6 个区域的下拉列表（如上所列）
*   使用键盘光标，我将列表向下移动到“ `Canada`”（这是 id 为 1 的区域）
*   我按下`Enter`（从而**选择**商店的一个项目）。下拉列表现已消失，文本“ `Canada`”出现在字段中。此时，第一个事件被触发，记录如下：

    ```
    onChange event: region 1 
    ```

*   我按 离开场地`tab`。在这里，两个事件一个接一个地被触发，顺序如下：

    ```
    onBlur event: region 1
    onChange event: region 246 
    ```

（区域 246 是`Atlantic Canada`。）现在这很有趣......当我离开该字段时（onBlur），`Canada`仍然是选定的值。神秘的交换在那之后才发生……

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T10:47:35.033

我想我终于找到了这种行为的解释。简而言之，这是由于未履行合同而发生的，FilteringSelect 期望 QueryReadStore 履行合同。由于 QueryReadStore 完全依赖于生成 json 的服务器模块的响应，因此由于服务器的意外响应而无法履行合同。

正如我所知道的，**在用户输入结束时，** FilteringSelect 期望 Store（在这种情况下为 QueryReadStore）只返回与输入或选择的字符串完全匹配的项目。FilteringSelect 认为输入在按下输入键或用户离开字段时结束。在这两个事件之前，输入或选择的文本只是文本。目前没有实际选择任何项目。

换句话说，在输入结束时，FilteringSelect 期望 Store 如果不应该选择任何内容，则返回零个项目，或者应该选择一个项目。因此，然后您提供区域列表，FilteringSelect 只是无法确定选择哪个区域，并且首先停止。

正如您所提到的，QueryReadStore 在每次击键时都会发送请求。在这种情况下（在输入结束之前）FilteringSelect 期望 Store 返回匹配模式的项目。默认模式是“ enteredString ***** ”，其中星号是任何序列。

为了区分两种情况，QueryReadStore 会稍微改变请求：

*   每次击键时的示例请求：/query/regions?name=enteredString*&start=0&count=5
*   输入结束时的示例请求：/query/regions?name=enteredString&start=0

如您所见，在第二个请求中，“enteredString”的末尾没有星号。这种变化可以帮助在服务器端建立正确的响应。

我希望我已经解释清楚了。如果没有，欢迎您询问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T05:58:54.317

我今天遇到了同样的问题，影响了 Dojo 版本 1.1.1 和 1.2.0。

据我所知，FilteringSelect 在用户离开该字段后执行最终查询，并期望查询结果仅包含一个结果，然后将其用于该字段的值。

在我看来，它就像一个错误（尽管我希望我被证明是错误的），但你现在可能不得不面对它。

此页面上有一些（不完整的）信息： http: [//www.nabble.com/Problems-with-QueryReadStore-td19269498.html](http://www.nabble.com/Problems-with-QueryReadStore-td19269498.html)。

后期编辑：

如果事实上，无论何时存在重复标签，无论其背后的数据存储如何，您都会遇到与 FilteringSelect 相同的问题。

例如，在小部件失去焦点后，它会重置为第一个选项：

```
 <select id="coffee2" name="coffee2" 
    dojotype="dijit.form.FilteringSelect" 
    autoComplete="false">
    <script type="dojo/method" event="onChange"  args="newValue">
        console.log(dijit.byId('coffee2').getValue() + '/' + dijit.byId('coffee2').getDisplayedValue());
    </script>
    <option value="0">AAA</option>
    <option value="1">AAA</option>
    <option value="2">AAA</option>
    <option value="3">AAA</option>
    <option value="4">AAA</option>
  </select> 
```

在我看来，更多的是一个错误而不是一个功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-01T14:40:32.007

Damn, this particular problem was a real pain in my ass too!! And here is how I got rid of it, thanks to damelin answer.

In my case, the `dijit.form.filteringSelect` backed by a `dojox.data.QueryReadStore` was needed to be filled by a formatted string coming from multiple db values itself coming from complex tables (with some parent and even manyToMany relationship). Please don't ask why, just consider I love separating db tables as soon as possible, in order to avoid duplicates. All of that is in the context of a Zend Framework application, where the `QueryReadStore` is served by a controller action which I'll name here `autocompletelistAction`.

Therefore, starting from damelin answer, I began working on my `autocompletelisteAction` to separate the two cases of `QueryReadStore` request, reading the GET parameter and its eventual asterisk.

First, I clean the parameter and search for its last char :

```
$txt = (String) $this->_request->getParam('parameter');
$lastChar = substr($txt, -1); 
```

Then, if the parameter has more than 1 char and no asterisk at the end, I'm gonna get rid of my `$txt` parameter and build my like clauses by hand :

```
if ((strlen($txt) >= 1) && ($lastChar != '*')) {
  // here, the parameter is the full text, which the user selected by
  // clicking on a shown element of the filteringSelect

  // Therefore, I "explode" the parameter to correspond to my searched values
  // and I build my SQL LIKE clauses without "%"
  // Consequence? There is only one result which is the good one.
}
else {
  // here, the parameter is a "part" of the search, which the user typed in

  // Therefore, I build my SQL LIKE clauses with "%$txt%"
}
// Here I can just launch my SQL queries with the built LIKE clauses
// and return result(s) to the QueryReadStore 
```

Why checking if `$txt` is more than one char? Because within the Zend Framework, sometimes I can "autoload" the filteringSelect with the page, which sends a fully empty argument (even without asterisk), which then would go to my "explode" functions.

This complex scenario is mine, but I think each could adapt this simple PHP test on the parameter in order to serve the right answer.

So the real job was done by [damelin here](https://stackoverflow.com/questions/472059/filteringselect-with-a-queryreadstore-selection-doesnt-stick/500574#500574) because he investigated the reasons through dojo elements.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-30T11:06:52.170

我们遇到了同样的问题。我们通过修改 FilteringSelect.js 中的 _setDisplayedValueAttr 以立即返回来解决：

```
_setDisplayedValueAttr: function(/*String*/ label, /*Boolean?*/ priorityChange){ return } 
```

这是在我们折腾了一天之后，这种变化显然是相当邪恶的，但它对我们有用。

根本问题与 _callbackSetLabel 中的这一行有关：

```
this._setValueFromItem(result[0], priorityChange); 
```

这正是您的值被设置为结果列表中的第一个的原因。我不知道为什么会这样。

希望它对你有用，顺便说一下，我们正在使用 FilteringSelect.js 的主干版本（[http://trac.dojotoolkit.org/browser/dijit/trunk/form/FilteringSelect.js](http://trac.dojotoolkit.org/browser/dijit/trunk/form/FilteringSelect.js)）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T06:53:47.103

按照 pnt 的评论...

[这个讨论](http://www.nabble.com/Problems-with-QueryReadStore-td19269498.html)清楚地说明了问题出在哪里：在“模糊”上，`QueryReadStore`最后一次重新查询服务器，使用`DisplayedValue`作为它的查询字符串。

在我的示例中，这将是“ `Canada`”。鉴于我的候选名单中的六个区域（见进一步）包含该字符串，并且我的服务器被编程为返回*包含*查询字符串的所有项目的字母列表（而不仅仅是那些以它开头的项目），整个候选名单再次是返回，然后`FilteringSelect`选择其中的第一项 --- 在本例中为“ `Atlantic Canada`”。

如果我的分析是正确的，那么一种可能的前进方式是我重构我的查询服务，以便将与查询字符串*完全匹配的任何项目放在列表的顶部（在字母顺序之前）。*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-11T14:51:34.353

“在用户输入的每个字符上，QueryReadStore 都会向服务器发送一个请求......”

有FilteringSelect属性searchDelay可以设置，在发送请求前等待指定的毫秒数。

# sql - MySQL：什么是 LIKE 的反向版本？

> ID：472063
> 
> 赞同：40
> 
> 时间：2009-01-23T06:23:43.507
> 
> 标签：sql, mysql

*MySql 中的LIKE*运算符用于查找包含我们查询文本的行，例如：

```
select name from user where name like "%john%" 
```

这将返回`John Smith`等`Peter Johnson`。

如果我需要相反的情况 - 查找查询文本中包含的行*怎么*办？例如，我给它`John Smith and Peter Johnson are best friends`并希望它从表中找到可以在此字符串中找到的所有名称。

怎么做？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-01-23T06:58:33.080

这是一种可以实现您所描述的方法：

```
SELECT name FROM user 
WHERE 'John Smith and Peter Johnson are best friends' LIKE
  CONCAT('%', name, '%') 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2016-03-24T04:00:56.857

```
select name
from users
where instr('John Smith and Peter Johnson', name) > 0 
```

我宁愿使用这种方法而不是：

```
select *
from users
WHERE  'John Smith and Peter Johnson' LIKE CONCAT('%', name ,'%') 
```

因为如果有任何`name`可能包含`%`or`_`字符（例如 name='v%alue'），那么上面的查询仍然会错误地返回该记录。另请注意，如果您的列可能包含反斜杠和/或“ [C 转义字符](https://en.wikipedia.org/wiki/Escape_sequences_in_C "C 转义字符")”，那么它们也需要被转义。[这在MySQL 字符串比较函数](http://dev.mysql.com/doc/refman/5.7/en/string-comparison-functions.html "MYSQL 字符串比较函数")中都有解释。例如下面的 SQL 将返回 1：

```
SELECT 'val\%ue' LIKE CONCAT('%', 'al\\\\\%u' ,'%'); 
```

*需要使用单个反斜杠进行转义，`\\\\`并且`%`字符被转义：`\%`.*

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-23T06:55:33.087

这是一个文本索引问题。如果我猜对了，你的任务就是在自由格式的文本中找到所有对人的引用，与喜欢或不喜欢无关。

在一般形式中，您正在查找引用的数据库表充当某些文本索引算法的字典。使用这个字典在输入字符串上建立一个索引，希望你会得到一些匹配。

# php - 是好是坏？为 PHP 带来“函数链”功能

> ID：472077
> 
> 赞同：4
> 
> 时间：2009-01-23T06:31:06.347
> 
> 标签：php, language-features

所以我在想一种方法，你可以使用内置的全局函数将方法链接引入 PHP，那就是从 F#“借用”|>（管道）运算符。它将左侧的结果通过管道传递到右侧函数的第一个参数中。当然，PHP 将不得不重新审视其某些函数的参数顺序。

这将允许您编写：

```
function StrManip($val) {  
  return str_repeat(strtolower(trim($val)),2);  
} 
```

像这样：

```
function StrManip($val) {  
  return $val |> trim() |> strtolower() |> str_repeat(2);  
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T07:31:26.977

看起来他想要的是一个带有反映内置函数的方法的 String 类。这是一个猜测，但也许你可以使用 __call 魔术方法来完成这样的工作：

**（未经测试）**

```
class String {
   private $_value = '';
   public function __construct($value) {
      $_value = $value;
   }
   public function __call ($name, $arguments) {
      return new String($name($_value, $arguments));
   }
}

$string = new String($string);
echo $string->trim()->strtolower()->str_repeat(2); 
```

您必须进行一些解析才能使 $arguments 部分起作用，并且当您链接方法时它会创建很多对象，但理论上这应该会为您提供一些您正在寻找的功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T06:47:29.590

类似的事情可以使用流畅的对象方法来完成。例如：

```
class Foo 
{
    public function bar()
    {
        echo 'Hello<br/>';
        return $this;
    }

    public function bar2()
    {
        echo 'Goodbye<br/>';
        return $this;
    }   
}

$foo = new Foo();

$foo->bar()->bar2(); 
```

输出以下内容：

你好
再见

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T06:41:33.270

我以前从未见过那个注释，但它确实看起来不错。不知何故让我想起了函数式编程（也许只是我）。

但我实际上已经不再希望 PHP 小组会对语言做出如此根本的改变。他们似乎在追赶其他语言 - 他们看看其他人在做什么，然后他们选择他们喜欢的东西，以及适合（他们）PHP世界的东西。例如，当您查看竞争时，面向对象和命名空间是相当新的功能。

我个人希望看到命名参数（á la " `strpos(needle=$foo, haystack=$bar)`"），因为我在 Python 中看到了它们。从那以后，PHP 设计组实际上一直[拒绝](http://www.php.net/~derick/meeting-notes.html#named-parameters)实施它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-24T05:02:34.233

这很有趣。这个解决方案怎么样？

```
function pipe($v, $fs)
{   
    foreach(explode('|', $fs) as $f)
    {
        if(strpos($f, '[') === FALSE){
            $v = call_user_func($f, $v);
        }else{
            list($fun, $args) = explode('[', trim($f), 2);
            $args = explode(',', str_replace('!', $v, substr($args, 0, -1)));
            $v = call_user_func_array($fun, $args);
        }
    }
    return $v;
}

echo pipe(' test STRING??', 'trim|strtolower|str_repeat[!,3]|str_replace[string,cheese,!]'); 
```

这打印出来

```
test cheese??test cheese??test cheese?? 
```

函数管道有两个参数。第一个是初始值，第二个是要应用于第一个参数的以竖线分隔的函数列表。为了允许多参数函数，可以使用 [ 和 ] 字符（就像在 PHP 中使用括号一样）。占位符“！” 可用于指定沿链插入字符串的位置。

在上面的示例中，会发生以下情况：

```
trim(' test STRING??') => 'test STRING??'
strtolower('test STRING??') => 'test string??'
str_repeat('test string??', 3) => 'test string??test string??test string??'
str_replace('string', 'cheese', 'test string??test string??test string??') => 'test cheese??test cheese??test cheese??' 
```

字符 [、] 和 ! 是随意选择的。此外，这不允许您在函数参数中使用逗号，尽管它可以扩展以允许这样做。

有趣的问题！

（从 Code Igniter 获取的 '|' 分隔函数列表的想法，尽管它们不进行变量替换。它也可以很容易地成为字符串数组，但 array() 构造函数很冗长）

# asp.net-mvc - 在 ASP.NET MVC 中实现一个简单的产品下拉列表

> ID：472078
> 
> 赞同：1
> 
> 时间：2009-01-23T06:31:08.797
> 
> 标签：asp.net-mvc

我可以在 ASP.NET MVC 中实现一个简单的产品下拉列表，当他们从下拉列表中选择时将用户重定向到一个新产品，有哪些不同或最好的方法？

我目前有我的主要映射规则：

```
 routes.MapRoute(
              "Product",
              "Products/{sku}",
              new { controller = "Products", action = "ViewProduct", sku = "1001" }
           ); 
```

这允许我输入这样的 URL 来查看我的产品：

```
/Products/1002 
```

我的页面上有一个下拉列表，它代表产品列表，并允许您从列表中进行选择。（该`sku`参数与我控制器的 ViewProduct 方法中的参数同名）：

```
<% using (Html.BeginForm("ViewProduct", "Products"))
   { %>

    <%= Html.DropDownList("sku", ViewData.Model.ProductsList)%>
    <%= Html.SubmitButton() %>  <!-- just using a button now since its easier -->

<% } %> 
```

此表单针对我在控制器中的“ViewProduct”命令（这是呈现产品信息页面的完整视图）。

问题是生成的 HTML（当我查看 的 HTML 时`/Products/1002`）看起来像这样：

```
<form action="/Products/1002" method="post">

    <select id="sku" name="sku">
        <option value="1003">Product 1003</option>
        <option value="1002">Product 1002</option>
        <option value="2001">Product 2001</option>
    </select>

<input type="submit" />
</form> 
```

它已经根据**当前**URL 创建了操作链接（我猜它真的别无选择）。问题是，当我的控制器在单击“提交”后被调用时，它会继续并再次获取产品 1002 - 并且不会被表单中的“sku”参数覆盖。

现在，实际值在 中可用`Request.Params["sku"]`，但很明显，尝试从那里获取它是一种非常可怕的做法。

一个非常复杂的解决方案如下 - 创建一个不同的路由规则，它会遇到不同的控制器方法`RedirectProduct`。

```
routes.MapRoute(
           "Product Redirect",
           "Products/RedirectProduct",
           new { controller = "Products", action = "RedirectProduct" }
        ); 
```

然后对我的表单的操作可以简单地是：

```
<% using (Html.BeginForm("RedirectProduct", "Products")) { %> 
```

这会影响我的控制器方法，该方法可以访问“sku”（我想要的正确方法来自表单参数）。控制器方法只是重定向到 /Products/XXX 。

```
public ActionResult RedirectProduct(string sku)
        {
            return new RedirectResult("/Products/" + sku);
        } 
```

我根本不喜欢这个解决方案——但我想至少介绍一下我到目前为止所拥有的东西。我不喜欢像这样添加额外的映射规则，并且当我真的只有一个时必须创建不同的动作名称。

我确信有 50 种不同的方法可以做到这一点——因此我在 stackoverflow 上提出了这个问题——试图找出最好的方法。不幸的是，此时我发现的 MVC 表单处理文档非常简单。

PS。我主要不是在寻找 JQuery 解决方案（我想先掌握“纯 MVC”），但我会欢迎。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T13:45:47.827

出现问题是因为您的 Route 使用 {sku} 并且您的表单字段称为 sku。路线中的 {sku} 取代了 sku 表单字段（看起来）。一个（相当务实的）解决方案可能是让它们以不同的方式命名，因此您的控制器操作将类似于：

```
public void ActionResult ViewProduct(string routeSku, string sku)
{
    sku = sku ?? routeSku;
    // same as before
} 
```

这将导致“sku”参数在初始获取请求中为“null”（routeSku 将是 URL 中的任何内容），当使用提交按钮时 routeSku 将是相同的，因为您要回发到相同的 URL 但sku 将是表单值。如果已设置，则逻辑将从表单中选择 sku 值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T02:36:46.467

他们为 RC1 解决了这个问题！他们正式将其归类为错误。酷（我认为！）

• 当表单发布到具有与路由参数匹配的参数名称的操作方法时，表单值现在会覆盖路由参数。这修复了尝试发布名为 id 的表单字段的表单将无法工作的问题，因为默认路由具有 id 参数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T07:05:58.820

我认为 JavaScript 是您唯一的选择。表单标签只能提交到一个 URL，所以如果你想避免 RedirectProduct 路由（我同意，这很尴尬），你必须做 javascript。像这样（使用 jQuery）可能会成功：

```
<script type="text/javascript">
function doredirect() {
    window.location="http://www.mysite.com/Products/" + $('#sku').val
}
</script>
<% using (Html.BeginForm("ViewProduct", "Products"))
   { %>

    <%= Html.DropDownList("sku", ViewData.Model.ProductsList, new { onchange="doredirect" })%>
    <%-- Won't need this anymore: 'Html.SubmitButton()' --%>

<% } %> 
```

（免责声明：我尚未对此进行全面测试，但如果您遇到问题，我会尝试在评论中提供帮助以获取此答案）

不幸的是，您失去了路由的好处，因为 URL 是在客户端生成的。如果您更改路线，则必须手动更新此代码。一种可能的解决方案是稍微欺骗路由系统并在服务器上生成一个“模板”URL，以传递给您的客户端代码。像这样：

```
<script type="text/javascript">
var urlTemplate = <%= Url.Action("ViewProduct", "Products", new { sku="__sku__" }) %>
function doredirect() {
    window.location= urlTemplate.replace(/__sku__/,$('#sku').val)
}
</script> 
```

（与上述相同的免责声明：P）

服务器端代码应该生成一个类似的 URL：`http://mysite.com/Products/__sku__`，然后 javascript 将`__sku__`令牌替换为实际的 SKU。

# c# - C#/ASP.NET Oledb - MS Excel 读取“未指定错误”

> ID：472079
> 
> 赞同：5
> 
> 时间：2009-01-23T06:31:58.327
> 
> 标签：c#, asp.net, excel, exception, oledb

我们有一个 C#/ASP.NET (2.0) 应用程序在 Windows Server 2003 企业版的 IIS 6 上运行。此应用程序使用 OleDb 读取 Excel 文件，但在某些情况下，我们会从应用程序中收到“未指定错误”异常。

该文件在打开之前由我们的文件上传代码存储在临时目录中。由于我们在 IIS 中启用了匿名访问，并且我们还在 web.config 中使用了模拟，因此文件夹 C:\Windows\Temp\ 具有 Internet 访客用户帐户 (IUSR_[MachineName]) 能够创建的适当权限，在那里修改和删除文件。

**OleDb 连接字符串：**
Provider=Microsoft.Jet.OLEDB.4.0；数据源=C:\Windows\Temp\tmp123.tmp.xls；
扩展属性="Excel 8.0;HDR=Yes;IMEX=1;"

[上面的“数据源”属性会因每个文件而改变。]

```
异常的堆栈跟踪是：
    System.Exception：FileParsingFailed ---> System.Data.OleDb.OleDbException：  
    未指定的错误  
    System.Data.OleDb.OleDbConnectionInternal..ctor（OleDbConnectionString 常量，  
    OleDbConnection 连接）在  
    System.Data.OleDb.OleDbConnectionFactory.CreateConnection（DbConnectionOptions 选项，   
    对象 poolGroupProviderInfo、DbConnectionPool 池、DbConnection owningObject) 在  
    System.Data.ProviderBase.DbConnectionFactory.CreateNonPooledConnection（DbConnection  
    owningConnection, DbConnectionPoolGroup poolGroup) 在  
    System.Data.ProviderBase.DbConnectionFactory.GetConnection（DbConnection  
    拥有连接）在  
    System.Data.ProviderBase.DbConnectionClosed.OpenConnection（DbConnection  
    外部连接，DbConnectionFactory 连接工厂）在  
    System.Data.OleDb.OleDbConnection.Open()  

```

**解决方法：**
到目前为止，我们能想出的唯一解决方法是执行 iisreset（我们还在 IIS 中将应用程序池回收配置为每天发生一次，但这似乎无济于事，因为该问题有时会持续数天）。虽然这不是一件好事，但更糟糕的是，我们在同一个网站上还有其他应用程序，每当我们重置 IIS 时这些应用程序都会受到影响。

**问题：**
1\. 我们如何解决这个错误，因为它偶尔会发生并且我们看不到模式？
2\. 除了 OleDb 之外，还有没有更好的（免费的）处理 C#/ASP.NET 的 Excel 文件的方法？（我们不喜欢在服务器上安装 MS Office，因为微软不推荐它）

**我们的局限：**
1\. 我们被 MS Office 2003 (.xls) 格式困住，无法迁移到 MS Office 2007 (OOXML) 格式。
2\. 我们不使用 CSV 的原因是因为我们的数据中可能有逗号（即使我们使用引号也很难处理）并且我们还在电子表格中使用多个工作表（这不能用 CSV 完成） .

谢谢！:)

更新：
谢谢，基思。这似乎是 Jet 引擎的一个问题，但我们使用它是因为缺乏（**免费**且易于使用的）替代品。
谢谢，乔。但是我们的预算有限——所以我们主要在寻找免费的工具/库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T00:14:27.313

确保您正在关闭您的连接。

例如，在开发 MS Access 应用程序 (Jet) 时，如果有太多连接处于打开状态，则会出现此错误。它可以正常工作（偶尔会有）一段时间，直到达到最大打开连接数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T11:32:53.493

我怀疑这个错误与古老的 Jet OLEDB 引擎有关。它相当糟糕 - 对于大多数桌面设备来说都很好，但对于企业数据交换来说没有多大用处。

如果您可以升级到最新的 C# 3/.Net 3.5，您可以使用该`System.IO.Packaging`库打开 Office 2007 文件（.xlsx 或 .xlsm 文件）。

这些文件实际上是 zip - 将它们重命名为 .zip，您就可以查看其中的 XML 文件。

XML 文件的格式相当糟糕（例如单元格注释是 VML，啊！）但可读。

或者让您的用户将 Excel 表格保存为 CSV。不过，我会避免使用 Microsoft 文本驱动程序 DB 提供程序 - 它很垃圾并且无法处理 unicode。无论如何，CSV 都很容易阅读。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T19:10:28.017

我使用 SpreadSheetGear.NET 已经有一段时间了，主要用于创建 Excel 文件，而且效果很好。

[http://www.spreadsheetgear.com/products/spreadsheetgear.net.aspx](http://www.spreadsheetgear.com/products/spreadsheetgear.net.aspx)

它在本机 .NET 中提供二进制 Excel 文件读取/写入，解决了我之前在尝试使用 OLE 和 JET 读取和创建 Excel 文件时遇到的所有问题。

基本版本曾经作为注册 Visual C++ Express 2005 的一项福利免费提供。这是未经宣传的，因此它可能会或可能不会在 2008 年版中存在。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T19:28:37.477

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/products/spreadsheetgear.net.aspx)为您提供了使用 .NET 中的 xls 和 xlsx 工作簿的 API。它比 OleDB 或 Excel COM 对象模型更容易使用和更快（继续阅读以获取一些证据）。

免责声明：我拥有 SpreadsheetGear LLC

下面是使用 SpreadsheetGear 创建 50,000 行 x 10 列工作簿的代码，将其保存到磁盘，然后使用 OleDb 和 SpreadsheetGear 对数字求和。SpreadsheetGear 在 0.31 秒内读取 500K 单元格，而使用 OleDB 则为 0.63 秒 - 快了两倍多。SpreadsheetGear 实际上创建和读取工作簿的时间比使用 OleDB 读取工作簿的时间要短。

代码如下。您可以查看[现场样品或通过](http://www.spreadsheetgear.com/support/samples/)[免费试用](https://www.spreadsheetgear.com/downloads/register.aspx)亲自试用。

```
using System;
using System.Data; 
using System.Data.OleDb; 
using SpreadsheetGear;
using SpreadsheetGear.Advanced.Cells;
using System.Diagnostics;

namespace SpreadsheetGearAndOleDBBenchmark
{
    class Program
    {
        static void Main(string[] args)
        {
            // Warm up (get the code JITed).
            BM(10, 10);

            // Do it for real.
            BM(50000, 10);
        }

        static void BM(int rows, int cols)
        {
            // Compare the performance of OleDB to SpreadsheetGear for reading
            // workbooks. We sum numbers just to have something to do.
            //
            // Run on Windows Vista 32 bit, Visual Studio 2008, Release Build,
            // Run Without Debugger:
            //  Create time: 0.25 seconds
            //  OleDb Time: 0.63 seconds
            //  SpreadsheetGear Time: 0.31 seconds
            //
            // SpreadsheetGear is more than twice as fast at reading. Furthermore,
            // SpreadsheetGear can create the file and read it faster than OleDB
            // can just read it.
            string filename = @"C:\tmp\SpreadsheetGearOleDbBenchmark.xls";
            Console.WriteLine("\nCreating {0} rows x {1} columns", rows, cols);
            Stopwatch timer = Stopwatch.StartNew();
            double createSum = CreateWorkbook(filename, rows, cols);
            double createTime = timer.Elapsed.TotalSeconds;
            Console.WriteLine("Create sum of {0} took {1} seconds.", createSum, createTime);
            timer = Stopwatch.StartNew();
            double oleDbSum = ReadWithOleDB(filename);
            double oleDbTime = timer.Elapsed.TotalSeconds;
            Console.WriteLine("OleDb sum of {0} took {1} seconds.", oleDbSum, oleDbTime);
            timer = Stopwatch.StartNew();
            double spreadsheetGearSum = ReadWithSpreadsheetGear(filename);
            double spreadsheetGearTime = timer.Elapsed.TotalSeconds;
            Console.WriteLine("SpreadsheetGear sum of {0} took {1} seconds.", spreadsheetGearSum, spreadsheetGearTime);
        }

        static double CreateWorkbook(string filename, int rows, int cols)
        {
            IWorkbook workbook = Factory.GetWorkbook();
            IWorksheet worksheet = workbook.Worksheets[0];
            IValues values = (IValues)worksheet;
            double sum = 0.0;
            Random rand = new Random();
            // Put labels in the first row.
            foreach (IRange cell in worksheet.Cells[0, 0, 0, cols - 1])
                cell.Value = "Cell-" + cell.Address;
            // Using IRange and foreach would be less code, 
            // but we'll do it the fast way.
            for (int row = 1; row <= rows; row++)
            {
                for (int col = 0; col < cols; col++)
                {
                    double number = rand.NextDouble();
                    sum += number;
                    values.SetNumber(row, col, number);
                }
            }
            workbook.SaveAs(filename, FileFormat.Excel8);
            return sum;
        }

        static double ReadWithSpreadsheetGear(string filename)
        {
            IWorkbook workbook = Factory.GetWorkbook(filename);
            IWorksheet worksheet = workbook.Worksheets[0];
            IValues values = (IValues)worksheet;
            IRange usedRahge = worksheet.UsedRange;
            int rowCount = usedRahge.RowCount;
            int colCount = usedRahge.ColumnCount;
            double sum = 0.0;
            // We could use foreach (IRange cell in usedRange) for cleaner 
            // code, but this is faster.
            for (int row = 1; row <= rowCount; row++)
            {
                for (int col = 0; col < colCount; col++)
                {
                    IValue value = values[row, col];
                    if (value != null && value.Type == SpreadsheetGear.Advanced.Cells.ValueType.Number)
                        sum += value.Number;
                }
            }
            return sum;
        }

        static double ReadWithOleDB(string filename)
        {
            String connectionString =  
                "Provider=Microsoft.Jet.OLEDB.4.0;" + 
                "Data Source=" + filename + ";" + 
                "Extended Properties=Excel 8.0;"; 
            OleDbConnection connection = new OleDbConnection(connectionString); 
            connection.Open(); 
            OleDbCommand selectCommand =new OleDbCommand("SELECT * FROM [Sheet1$]", connection); 
            OleDbDataAdapter dataAdapter = new OleDbDataAdapter(); 
            dataAdapter.SelectCommand = selectCommand; 
            DataSet dataSet = new DataSet(); 
            dataAdapter.Fill(dataSet); 
            connection.Close(); 
            double sum = 0.0;
            // We'll make some assumptions for brevity of the code.
            DataTable dataTable = dataSet.Tables[0];
            int cols = dataTable.Columns.Count;
            foreach (DataRow row in dataTable.Rows)
            {
                for (int i = 0; i < cols; i++)
                {
                    object val = row[i];
                    if (val is double)
                        sum += (double)val;
                }
            }
            return sum;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-02T11:04:16.893

我遇到了同样的问题，似乎可以通过在循环的每次迭代中关闭与文件（xls 或 csv）的连接来解决。我假设您还在循环文件列表和 .Open() 到每个文件的新连接。如果在循环结束时 .Close() 连接，问题似乎就消失了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-11T13:15:34.777

好像我弄错了，请参阅[OleDbConnection、Excel 和连接池的问题](https://stackoverflow.com/questions/6174724/problem-with-oledbconnection-excel-and-connection-pooling)

~~`Dispose()`基本上是CRice所说的，但是在使用Excel-ConnectionString调用构造函数时的实现似乎存在问题`OleDbDataAdapter (String, String)`，因为隐式创建的连接显然没有关闭。~~

~~解决方法是使用单独 的包装所有调用`OleDbDataApater`用法（您正在执行 using ... 的东西，因为它实现了）`IDisposable`~~

```
using (var conn = new OleDbConnection(connectionString)) 
```

~~然后调用`OleDbDataAdapter (String, OleDbConnection)`构造函数。~~

~~**编辑：** 我在处置时关闭连接是错误的。`conn.Dispose()`不会关闭连接，所以在里面`using (var conn = new OleDbConnection(connectionString))`你仍然需要做一个`conn.Close()`.~~

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-03-08T10:56:39.170

连接超时可能是原因之一。通过调试检查查询在应用程序中执行需要多长时间。

# ruby-on-rails - ActiveMerchant：使用不支持void操作的网关时如何授权卡？

> ID：472083
> 
> 赞同：6
> 
> 时间：2009-01-23T06:32:58.903
> 
> 标签：ruby-on-rails, ruby, payment-gateway, credit-card, payment

我正在使用 ActiveMerchant 开发 Ruby on Rails 应用程序的计费组件。我们选择的支付网关是[PaymentExpress](http://paymentexpress.com)。

我看到的代码示例如下所示，使用`authorize()`并`void()`测试卡的有效性：

```
def test_card!
  auth_response = gateway.authorize(100, card)
  gateway.void(auth_response.authorization) if auth_response.success?
  raise AuthorizationFailed.new(auth_response) unless auth_response.success?
end 
```

但是，PaymentExpress 不支持 void 操作。考虑到诸如 PaymentExpress 之类的网关在 7 天后授权请求到期，是否有其他方法可以执行此授权操作，或者是否可以省略无效操作？

我在文档或 Google 中找不到任何提及`void`授权，也找不到任何迹象表明授权的重要性。

一些帮助？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-24T22:08:01.557

一些卡处理商会将此类交易标记为潜在欺诈。他们不喜欢看到小型测试交易之后是大型交易。特别是美国运通在这方面有些激进，因为当您返回并尝试实际金额时，他们往往会拒绝交易。

如果您打算向客户收取金额`x`，那么您应该授权它金额`x`以验证卡。然后您可以使用之前的授权并进行捕获或强制发布以完成收费。这样，客户只会在他们的对帐单上看到正确的待处理和结算金额。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T05:08:05.607

事实证明，至少使用 PaymentExpress，他们会在卡存储过程中自动执行授权操作。如果授权失败，它根本不会存储卡，而是返回“INVALID CARD”。这可以在他们的交易搜索网络应用程序中看到——在存储卡时，卡上授权 1.00 美元，一周后自动失效。

# sql - MS SQL 到 MySQL

> ID：472084
> 
> 赞同：0
> 
> 时间：2009-01-23T06:33:16.500
> 
> 标签：sql, mysql, sql-server

这个存储过程在 MySQL 中会是什么样子？：

==================================================== ========================

```
Create PROCEDURE [dbo].[Customer_Insert]
(
   @CustomerID int = NULL OUTPUT,
   @CustomerRef varchar(25),
   @Name varchar(64) = NULL,
)
AS
SET NOCOUNT ON

INSERT INTO [Customers]
(
    [CustomerRef],
    [Name]
)
VALUES
(
    @CustomerRef,
    @Name       
)

SELECT @CustomerID = SCOPE_IDENTITY(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T06:52:00.877

应该很简单，这应该为您指明正确的方向。我自己没有执行过。

```
CREATE PROCEDURE Customer_Insert
(OUT CustomerID INT, IN CustomerRef VARCHAR(25), IN Name VARCHAR(64))

BEGIN

INSERT INTO Customers (CustomerRef, Name) VALUES (CustomerRef, Name);
SELECT LAST_INSERT_ID() INTO CustomerID;
END 
```

# c# - 如何从包含空格的文本文件或 cdr 文件中删除换行符或换行符？

> ID：472090
> 
> 赞同：2
> 
> 时间：2009-01-23T06:38:03.010
> 
> 标签：c#

这是我的情况，我可以使用修剪或替换来删除空格。但它不会删除每个文件末尾的换行符或换行符。如何在 C# 中删除空格和换行符？

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T06:41:19.573

您可以使用要删除的所有字符调用 Trim 方法，例如：

```
line = line.Trim(' ','\r','\n'); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-07-25T00:50:12.303

```
myString = myString.Replace(System.Environment.NewLine, string.Empty)
myString = myString.Replace(" ", string.Empty); 
```

或者，使用：

```
string replacement = Regex.Replace(s, @" |\t|\n|\r", string.Empty); 
```

对于换行和换行：

```
myString = myString.Replace(System.Environment.NewLine, "replacement text") 
```

对于空间：

```
myString = myString.Replace(" ", "replacement text"); 
```

参考：

1.  [StackOverFlow 链接 - System.Environment.NewLine](https://stackoverflow.com/questions/238002/replace-line-breaks-in-a-string-c-sharp)
2.  [StackOverFlow 链接 - 正则表达式](https://stackoverflow.com/questions/4140723/how-to-remove-new-line-characters-from-a-string)

# reporting-services - 微软报告嵌套对象数据源给出#Error

> ID：472094
> 
> 赞同：2
> 
> 时间：2009-01-23T06:39:44.990
> 
> 标签：reporting-services, object, nested

我正在尝试让嵌套对象在 Microsoft 报告中工作。[我从http://www.gotreportviewer.com/objectdatasources/index.html](http://www.gotreportviewer.com/objectdatasources/index.html)下载了示例代码，它运行正常。

我基于 Windows 窗体及其代码构建了以下小应用程序，当我引用嵌套对象值时，我得到的只是数据应该出现的地方的“#Error”。

在报告中，我使用了网站推荐的相同嵌套对象语法：

```
=Fields!Name.Value.FirstName 
```

它适用于他们在我的计算机上的应用程序，但不适用于我的。我无法理解！有没有人遇到过这种情况，或者知道为什么会这样？

此外 - 我不知道这是否相关 - 我无法将 ClientItem 的单个实例添加到 LocalReport.DataSources 对象。它必须是一个列表。但是，当它呈现时，它只在报表的表格中显示一行 (#Errored) 数据。

任何帮助，将不胜感激！

```
namespace ReportTest
{

    public class ClientItem
    {
        public int Id { get; set; }
        public ClientName Name { get; set; }
    }

    public class ClientName
    {
        public ClientName(string first, string last)
        {
            FirstName = first;
            LastName = last;
        }

        string FirstName { get; set; }
        string LastName { get; set; }
    }

    public partial class Form1 : Form
    {
        private List<ClientItem> clients = new List<ClientItem>();

        public Form1()
        {
            InitializeComponent();
            PopulateLists();
            GenerateReport();
        }

        private void PopulateLists()
        {
            clients.Add(new ClientItem { Id = 1, Name = new ClientName("Adrian", "Adesco") } );
            clients.Add(new ClientItem { Id = 2, Name = new ClientName("Brian", "Briar") } );
            clients.Add(new ClientItem { Id = 3, Name = new ClientName("Clive", "Cussler") } );
        }

        private void GenerateReport()
        {
            this.Text = "Report Control Demo";
            this.ClientSize = new System.Drawing.Size(950, 600);

            ReportViewer reportViewer = new ReportViewer();

            reportViewer.ProcessingMode = ProcessingMode.Local;

            reportViewer.LocalReport.ReportPath = "TestReport.rdlc";

            reportViewer.LocalReport.DataSources.Add(new ReportDataSource("ReportTest_ClientItem", clients));

            reportViewer.Dock = DockStyle.Fill;
            this.Controls.Add(reportViewer);

            reportViewer.RefreshReport();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T13:41:23.547

好的，测试用例问题的解决方案（上图）是将 ClientName 中的属性公开：

```
public class ClientName
{
    public ClientName(string first, string last)
    {
        FirstName = first;
        LastName = last;
    }

    public string FirstName { get; set; }
    public string LastName { get; set; }
} 
```

这为我解决了测试用例问题。

但是，我的实际报告仍然存在问题。它仍然给出错误。事实证明，这是因为子对象实际上是在不同的程序集中定义的。

为了使其工作，必须将以下行添加到包含子对象的项目的 AssemblyInfo.cs 文件中：

```
[assembly: AllowPartiallyTrustedCallers] 
```

现在它起作用了！花了很长时间才发现-希望这对某人有所帮助...

# language-agnostic - 数据传输对象模式？

> ID：472102
> 
> 赞同：2
> 
> 时间：2009-01-23T06:44:45.790
> 
> 标签：language-agnostic, design-patterns, solid-principles

我遇到了一个问题，我需要针对对象“客户”生成基于 Word 的报告。

我通常通过将 Customer 传递给一个知道如何创建 Word 文档、插入书签等的类来做到这一点。

问题在于，我发现自己将用于检索和格式化有关 Customer 对象的信息的逻辑放在此类中。

我知道这很糟糕，违反了单一责任原则。

我想创建另一个像“CustomerReportInfo”这样的类，它接受一个自定义并具有有关格式化和检索数据的所有逻辑，这样，Word 生成类很小，并且两者可以相互改变而不管彼此。

我只是想知道这个类应该叫什么？我浏览了一系列模式，但我真的看不出任何符合描述的东西。这听起来不像是一种策略或代理……听起来像 DTO，但 DTO 通常是没有功能的愚蠢类，不是吗？

关于这类似于哪种模式的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T06:49:04.313

如果是特定单词，我更喜欢 CustomerView 或 CustomerWordView。您在这里触及了 MVC 模式，在这种情况下，第三个概念是控制器类，它从数据库加载 Customer（最好让其他人加载它）并构造视图对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T06:50:11.037

我会称之为

```
CustomerReportGenerator 
```

我知道这听起来很讨厌，但它说它做了什么而无需评论或任何东西，

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T07:10:19.530

我不知道该模式的名称，但我喜欢[Application Architecture for .NET: Designing Applications and Services](http://msdn.microsoft.com/en-us/library/ms978348.aspx)。我会调用报告服务`ReportService`并让它访问 DAL 以获取`Customer`.

[替代文字 http://i.msdn.microsoft.com/ms978348.f02aa01(en-us,MSDN.10).gif](http://i.msdn.microsoft.com/ms978348.f02aa01(en-us,MSDN.10).gif)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-15T16:18:20.700

你在正确的轨道上，但并不完全在那里。您不希望创建一个新类来负责从 Customer 对象中*检索数据并**包含*该数据，而是希望每个类真正只有一个职责。因此，您创建了两个新类。

根据[这篇文章](http://msdn.microsoft.com/en-us/library/ms978717.aspx)，您似乎需要这样的架构：

> 数据 > 汇编程序 > DTO > Word 报告生成器

这`Word Report Generator`是您当前用于生成报告的类。这`DTO`是一个尽可能简单的对象，同时仍包含特定报告所需的所有数据。这`Data`是您关于客户对象的信息。然后是一个特殊的`Assembler`类，它包含“用于检索和格式化有关`Customer`对象的信息的逻辑”并使用该信息填充 DTO。

# iphone - Cocoa 中的小写“k”

> ID：472103
> 
> 赞同：34
> 
> 时间：2009-01-23T06:45:15.947
> 
> 标签：iphone, cocoa, cocoa-touch

我知道这是一个常见的约定，但是变量名中的“k”是什么意思？（即 kMaxImageViewSize） 我查看了关于变量名称的 Apple 文档，发现没有提及它。

谢谢回答

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-01-23T06:53:39.297

这是一种通用的编程符号，并非特定于Objective-C（即匈牙利符号），“k”代表“常量”。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-23T06:53:57.817

我想它的意思是“konstant”。:-)

# visual-studio-2008 - Visual Studio 2008，相对路径的愚蠢问题

> ID：472104
> 
> 赞同：0
> 
> 时间：2009-01-23T06:46:21.340
> 
> 标签：visual-studio-2008, path

发生在我身上的是，当我在 Visual Studio 之外运行我的程序时，它无法使用相对路径来查找任何内容。

事实证明这很难表达......

就像，我有程序 X，它打开 textfile.txt，对吗？如果我用绝对路径指向 textfile.txt，我很好。如果我用相对路径指向它并编译程序X，然后直接运行它（即，通过双击调试文件夹中的programX.exe），我也很好。但是，如果我使用相对路径并在 Visual Studio 之外运行程序（即按 f5），则它找不到该文件。

有谁知道发生了什么？或者，任何人都可以建议一些不与其他新手 Visual Studio 问题直接冲突的体面的关键字吗？

本

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T06:53:50.967

在 VS 2008 中，在 exe 项目的属性中，您可以指定运行目录 - 运行 exe 的目录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T06:54:48.110

不确定VS2008，但早期版本在您的项目目录下使用当前调试（或发布，我猜）目录运行程序。您可能必须确保将其用作路径的根。

或者，在您的相对路径前加上“..\”。

暂时`system("cd");`在您的代码中放置一个，以找出它**实际**从哪里运行或`GetCurrentDirectory(...)`按照尼克的建议使用。

# c# - 使用 PageMethods 访问 MultiiView 控件 ASP.Net

> ID：472113
> 
> 赞同：0
> 
> 时间：2009-01-23T06:50:42.300
> 
> 标签：c#, asp.net, javascript, pagemethods

我的 ASPX 页面上有一个多视图，我想使用 JavaScript 设置其 ActiveViewIndex。为此，我使用了放置控件的`UpdatePanel`内部。`MultiView`我已经启用`EnablePageMethods="True"`了 ScriptManager。

每当我调用服务器方法时，我都会得到：

> 你调用的对象是空的

```
function CallScreens(id) 
{
    // var id,var type
    // Call server side function
    alert('Hello');
    PageMethods.SetScreens("-1","screen",OnCallSumComplete,OnCallSumError,"");
} 
```

服务器端代码如下所示

```
[System.Web.Services.WebMethod]

public static void SetScreens(string id,string Type)
{
    try
    {
        TreeView obj = new TreeView();//Name of my Class
        obj.MultiView1.ActiveViewIndex=1;
    }
    catch (Exception ex)
    {
        throw ex;
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T09:58:07.087

您是否收到此错误，因为 MultiView1 尚未在 TreeView 对象中实例化？此外，webmethods 无权访问页面元素，因为它们被视为静态的。

# java - 为什么函数没有参数化的返回类型，因为它有参数化的输入？

> ID：472129
> 
> 赞同：3
> 
> 时间：2009-01-23T06:56:31.990
> 
> 标签：java, function, return-type

这总是迫使我们返回一个参数，以防我需要返回多个参数，比如一个列表和一个字符串。函数参数中不存在此限制。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T07:03:55.097

这个问题是 F#、haskell 等函数式语言试图解决的问题。问题是在硬件中，函数的返回值最初是通过 CPU 寄存器返回的，所以你只能返回一个值。C 语法继承了这一传统，C++（以及 C#、Java）也继承了这一点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T07:07:41.033

事实上，有些语言可以满足您的需求。例如 Python，看这段代码。它返回 2 个值：1 个字符串和另一个 int。

```
>>> def myFunc():
...   string_val = "techmaddy"
...   int_val = 10
...   return string_val, int_val
...
>>>
>>> s, i = myFunc()
>>>
>>> print s
techmaddy
>>>
>>> print i
10 
```

我希望它会有所帮助。

PS：在幕后，我猜 Python 正在将它装箱并取消装箱。我不太了解 Python，无法告诉你它到底做了什么。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T21:36:02.730

如果您需要经常这样做，那么创建一个类来保存结果并返回它。

这也允许您以与记录参数相同的方式记录您的函数返回的内容。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-23T07:58:28.683

或者，从您的方法中返回 Object[]，然后执行

```
return new Object[] { list, string}; 
```

如果您需要更多参数化的返回类型，您可以创建 Pair<X,Y> 类或 Triplet<Z,Y,Z> 并返回它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-28T08:01:38.040

幸运的是，Javascript 是一种动态语言。这意味着您可以构造任何类型的对象并将其返回。这有效地满足了您对具有“参数化”返回值的要求，尽管是以一种相当不安全的方式。

例如：

```
function stuff() {
    return {
        "foo": "a",
        "bar": "b"
    }
}

var theStuff = stuff();
alert(theStuff.foo + theStuff.bar); // should output "ab" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T21:52:21.370

处理复杂返回行为的方法是传递方法调用的接口。例如

```
public interface Results<R> {
    public void processing(String stage);
    public void success(String mesg, R result);
    public void successes(String mesg, List<R> result);
    public void thrown(Throwable t);
}

public void process(Results<R> results, String text, List<String> data); 
```

# memory - 关闭 D 垃圾收集器

> ID：472133
> 
> 赞同：25
> 
> 时间：2009-01-23T06:58:55.183
> 
> 标签：memory, memory-management, d, garbage-collection

我是一名 C++ 程序员，正在考虑将 D 用于我想玩的个人项目。我想知道是否有办法完全禁用垃圾收集器，这样做有什么风险。

我知道我可以通过覆盖 new 和 delete 以使用 malloc 和 free 来管理我自己的内存，但如果我这样做了，我宁愿垃圾收集器根本不运行。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-23T19:56:10.450

在 D2 中关闭 GC：

```
import core.memory;

void main(string[] args) {
    GC.disable;
    // Do stuff.
} 
```

如果使用 D1/Phobos：

```
import std.gc;

void main(char[][] args) {
    std.gc.disable;
    // Do stuff.
} 
```

在 D1/探戈中：

```
import tango.core.Memory;

void main(char[][] args) {
    GC.disable;
    // Do stuff.
} 
```

可以通过调用 GC.enable（D2 或 D1/Tango）或 std.gc.enable（D1/Phobos）类似地重新启用 GC。这些可以在程序中的任何时候完成。在内部，使用了一个计数器，要真正重新启用 GC，您必须在每次调用 disable() 时调用一次 enable()。

以下是一些与禁用 GC 无关的事情，因为它们会导致内存泄漏：

1.  不要使用数组追加 ( ~= ) 运算符，或使用 .length 属性来扩大已分配的数组。如果必须重新分配旧数组，它们依赖 GC 来释放旧数组，因为程序中的其他地方可能存在别名。
2.  不要使用内置的关联数组。释放这些的唯一方法是通过 GC。
3.  大多数 Phobos 和我相信的 Tango 都是在假设存在垃圾收集的情况下设计的。如果不使用 GC，这些库中的函数可能会严重泄漏内存。
4.  不要在禁用 GC 的情况下使用 D2 闭包。（无论如何，对于游戏而言，您都不会这样做。）

也就是说，虽然 D 被设计为在一些关键代码段中禁用 GC 时可用（存在实时约束的关键段，您可能不应该使用任何形式的 malloc 未明确设计为实时无论如何计算），它在很大程度上是在假设 GC 存在的情况下设计的。在您的情况下，您仍然可以将 GC 用于所有初始化内容等，并且仅在您点击游戏中实际需要实时的部分时才禁用它。

附带说明一下，GC 和手动内存管理可以在 D 中共存，实际上，在优化代码时，手动删除一些生命周期很短的大对象可以显着提高速度。这可以类似于 C++ 使用 delete 语句来完成，即使启用了 GC 也是安全的。当您没有实时限制时，这将为您提供 GC 的大部分好处以及手动内存管理的大部分性能。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-23T07:20:02.553

如果您想使用 malloc 并免费使用[std.c.stdlib](http://www.digitalmars.com/d/1.0/phobos/std_c_stdlib.html)。GC 永远不会碰这些。[std.gc](http://www.digitalmars.com/d/1.0/phobos/std_gc.html)具有内存管理所需的所有内容，包括 disable()。

不过GC也不是坏事。D 中的大多数（如果不是几乎所有）库都会在代码中的某个地方没有显式删除内存，因此它不会让你成为英雄，让它一直关闭，但如果你有一些关键的性能要求，那就可以了。

GC 让一切都变得更有效率，比如数组切片和在参数中创建新对象，而无需调用者在任何地方存储对它们的引用。好的代码会少很多，而使用 GC 代码会变得更小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-01-02T22:35:45.543

我正在阅读有关 D 语言的内容，我在 D 中似乎新的规范中发现了这一点：

> ## 40\. 更好的 C
> 
> -betterC 是 dmd 的命令行标志，它限制编译器对某些运行时特性的支持。值得注意的是，使用 betterC 编译的 D 程序或库不与 Druntime 链接。编译时特性的使用不受任何限制。 [https://dlang.org/spec/betterc.html](https://dlang.org/spec/betterc.html)

使用此命令行标志的后果之一是禁用 GC 和在其上中继的语言功能。

> ## 40.1 后果
> 
> 由于没有可用的 Druntime，许多 D 功能将无法工作。例如：
> 
> *   垃圾收集
> *   线程本地存储
> *   类型信息和模块信息
> *   课程
> *   内置线程（例如 core.thread）
> *   动态数组（但不是切片）和关联数组
> *   例外
> *   用字符串切换
> *   最终开关
> *   同步和 core.sync
> *   静态模块构造函数或解构函数
> *   结构解构器
> *   unittest（可以像往常一样使用 -betterC 标志进行测试）

另见[https://dlang.org/blog/2017/08/23/d-as-a-better-c/](https://dlang.org/blog/2017/08/23/d-as-a-better-c/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T16:32:26.680

可以将 GC 移除并替换为 malloc/free 的简单包装器。

# apache - Apache Nutch 的性能基准测试

> ID：472136
> 
> 赞同：1
> 
> 时间：2009-01-23T07:02:55.393
> 
> 标签：apache, search-engine, nutch

我想知道基于 apache nutch 的搜索引擎部署是否有任何现有的基准和大小信息。我想知道每月进行 1000 万次搜索，需要部署的硬件大小应该是多少。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-09T18:39:38.420

也许[nutch 邮件列表](http://lucene.apache.org/nutch/mailing_lists.html)可以帮助您解决这个问题。

# c# - 对字典对象进行排序

> ID：472137
> 
> 赞同：1
> 
> 时间：2009-01-23T07:03:44.050
> 
> 标签：c#

我有一个字典对象：

```
Dictionary<string, string[]> dictCompanies = new Dictionary<string, string[]>(); 
```

如何根据其键对该对象进行排序？

我尝试使用 OrderBy 如下所示，但它似乎不起作用

```
dictCompanies .OrderByDescending(c=> c.Key); 
```

我将此字典对象绑定到 aspx 页面中的复选框列表。

我尝试使用委托对这个 ListItemCollection 进行排序......但仍然没有运气......

我在这里错过了什么吗？

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-23T07:10:34.130

您无法对实际进行排序[`Dictionary<TKey,TValue>`](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)-从中产生的订单项基本上由内部实现确定。你可能想看看- 他们仍然有键/值查找[`SortedDictionary<TKey,TValue>`](http://msdn.microsoft.com/en-us/library/f7fta44c.aspx)，[`SortedList<TKey,TValue>`](http://msdn.microsoft.com/en-us/library/ms132319.aspx)但允许你根据键进行排序。`IComparer<T>`如果您想以特定方式按键排序，您可以指定您自己的。

另一种选择（取决于您的情况）是一直使用字典直到您需要它 - 然后将其复制到列表中并在绑定到控件之前对其进行排序。显然，此时您需要在每次发生任何更改时刷新绑定，但这对您来说可能不是问题。

顺便说一句，如果您的 OrderBy 语句真的像那样独立，那么您需要了解 LINQ 运算符总是运算符总是采用序列并返回不同的序列（或聚合结果）——它们从不就地修改序列。事实上，它们不能像`IEnumerable<T>`只读界面那样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T07:12:03.333

看看[SortedDictionary](http://msdn.microsoft.com/en-us/library/f7fta44c.aspx)和[SortedList](http://msdn.microsoft.com/en-us/library/ms132319.aspx)。

两者都有 O(log n) 检索，主要区别在于内存使用和插入和删除速度：

*   SortedList 使用的内存比 SortedDictionary 少。
*   SortedDictionary 对未排序的数据具有更快的插入和删除操作：O(log n) 相对于 SortedList 的 O(n)。

# .net - 如何在 WPF RichTextBox 中设置选项卡大小

> ID：472150
> 
> 赞同：6
> 
> 时间：2009-01-23T07:08:58.223
> 
> 标签：.net, wpf, tabs, richtextbox

WPF RichTextBox 可以设置为在其输入中接受选项卡。它将结果呈现为 4 个字符的缩进。我想改变那个尺寸。如何更改默认值？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T09:02:06.230

目前不支持此功能，但他们正在考虑将其用于将来的版本。令人沮丧的答案 - 我知道！

资料来源：[http](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/c610a492-cae8-444a-a657-05559da61fe3/) : //social.msdn.microsoft.com/Forums/en-US/wpf/thread/c610a492-cae8-444a-a657-05559da61fe3/（来自 LesterLobo 的回答 - MSFT）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-26T02:33:15.680

阅读有关 TabStops 的 sams 链接，您的问题的答案似乎更容易解决。只需在资源中的某处添加此样式：

```
<Style TargetType="Paragraph">
  <!-- 20.0 is default. It's pixels not characters though -->
  <Setter Property="TextIndent" Value="20" /> 
</Style> 
```

不幸的是，当您从文档中获取文本时，它会省略选项卡。我正在考虑编写自己的流文档文本编写器，以便获得更好的输出。另一个问题是附加文本不会为每行生成一个段落或为 '\t's 生成适当的缩进。所以我可能也必须创建反向。非常令人沮丧。FlowDocument 似乎并不是真正为使用而设计的。

# php - 我正在寻找一个基于 php 的免费查询分析器来查看缓慢且当前正在执行的 SQL 语句

> ID：472151
> 
> 赞同：-1
> 
> 时间：2009-01-23T07:09:37.410
> 
> 标签：php, mysql

我正在寻找一个基于 php 的免费查询分析器来查看缓慢且当前正在执行的 SQL 语句

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T08:58:33.010

我不完全知道您所说的“基于网络”是什么意思。

您可以使用[FirePHP](http://www.firephp.org/)来显示正在进行的查询，但您需要在代码中添加特殊语句。

也许在数据库级别分析 SQL 查询会更好。你在使用 MySQL 吗？然后，您可以使用[慢查询日志](http://dev.mysql.com/doc/refman/5.1/en/slow-query-log.html)或[MySQL 查询分析器](http://www.ideaticus.com/2008/07/12/php-and-mysql-query-profiler/)（自 5.something 以来已包含在数据库中）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T11:55:18.033

IMO，一旦您准备好开始对 MySQL 查询进行更详细的分析，您应该考虑熟悉 mysql 命令行工具、MySQL 配置和日志文件。

这些是您无法通过 PHP Web 界面熟悉的东西。

如果您还没有运行本地 Web 服务器，请使用 XAMPP 之类的工具来获取本地 Web 服务器环境设置，您可以在其中直接使用 mysql 配置和工具。

# windows - 在 Windows 中的桌面之间移动应用程序

> ID：472161
> 
> 赞同：1
> 
> 时间：2009-01-23T07:14:46.620
> 
> 标签：windows, language-agnostic, winapi, desktop

我试图弄清楚如何发送正在运行的应用程序来执行使用 CreateDesktop 创建的新 Windows 桌面。

我可以创建一个新桌面，然后在其中启动一个应用程序，错误我找不到使用正在运行的应用程序的方法。所有与桌面管理相关的功能（i.ec、SetThreadDesktop）始终只适用于当前线程

有什么提示吗？

* * *

谢谢您的回答。

好吧，事实上，我需要做的是移动不是我开发的应用程序（即notepad.exe）

如果查看 Powertoys ( [http://www.microsoft.com/windowsxp/downloads/powertoys/xppowertoys.mspx](http://www.microsoft.com/windowsxp/downloads/powertoys/xppowertoys.mspx) ) 的虚拟桌面管理器，它会在同一个 WindowStation 中创建多个虚拟桌面。我知道有类似的应用程序可以将正在运行的应用程序（notepad.exe、calc.exe..）从一个虚拟桌面移动到另一个虚拟桌面，而无需关闭它并再次重新打开它（然后传递新的桌面句柄 [HDESK]在调用 CreateProcess 时），但即使在阅读了所有相关的 msdn 文档之后，我仍然不知道该怎么做：|

我也想过 SetProcessWindowStation，但就我现在而言，使用 CreateDesktop 函数创建的所有新虚拟桌面都在同一个 WindowStation 上，所以......

也许我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-15T21:12:25.627

Window resources (such as HWNDs) are specific to a desktop. If you create a window in one desktop, I can't see how you would be able to move it to another desktop. For example, the HWNDs used by your application might already be in use in the other desktop.

Virtual Desktop Managers don't have to use Windows Desktops -- they can create the same effect by manipulating the windows. Take a look at [VirtuaWin](http://virtuawin.sourceforge.net/), an open source Virtual Desktop Manager.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T12:06:20.977

我没有实现任何代码，但只是大声思考......引用以下[MSDN 链接](http://msdn.microsoft.com/en-us/library/ms684859(VS.85).aspx)

> 当一个进程第一次调用 USER32 或 GDI32 函数时，它会自动建立到窗口站和桌面的连接。如果进程没有调用SetProcessWindowStation，则连接到继承自父进程的窗口站

这意味着“正在运行的应用程序”已经将**“STARTUPINFO 结构的 lpDesktop 成员”**的值设置为当前窗口站。我认为您可能需要更改此值才能将应用程序发送到另一个桌面。由于此链接提到[SetProcessWindowStation Function](http://msdn.microsoft.com/en-us/library/ms686232(VS.85).aspx)，因此可以使用

> BOOL WINAPI SetProcessWindowStation( __in HWINSTA hWinSta );

此外，正如[SetThreadDesktop 函数](http://msdn.microsoft.com/en-us/library/ms686250(VS.85).aspx)所提到的

> 将指定的桌面分配给调用线程。

所以我想，为了让它工作，你“运行应用程序”需要调用 SetThreadDesktop。如果您可以发布一些代码将会很有帮助...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-07T11:30:37.457

[只需从http://vdm.codeplex.com/](http://vdm.codeplex.com/)尝试 Vista/XP 虚拟桌面管理器

# .net - Smart Client 最大化选项卡工作区中的视图

> ID：472164
> 
> 赞同：0
> 
> 时间：2009-01-23T07:15:27.820
> 
> 标签：.net, winforms, smartclient

我的问题可能没有意义，但我有正当理由。

我们使用 .net 智能客户端框架和 CAB 来开发基于窗口的应用程序。

我们有一个趋势视图（智能客户端视图），它绘制实时数据图。我们同样使用 ProEssentials 图形控件。趋势视图带有选项卡工作区的选项卡。但是客户希望在他们喜欢并看到实时趋势时最大化视图。

问题是。如何最大化选项卡式工作区中选项卡式的视图？

如果我最大化视图，它应该继续绘制图表。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T08:11:50.700

最简单的选择是简单地显示一个不同的屏幕/控件，上面只有图表。

如果您使用`TabControl`的是选项卡式视图之类的标准控件，则如果不完全清楚 - 如果是这样，您应该能够将图表从图表中取出`TabPage`并在更高级别重新添加它（隐藏`TabControl`等） - 例如（纯粹为了说明）：

```
[STAThread]
static void Main()
{
    Application.EnableVisualStyles();
    Button button;
    TextBox textbox;

    using (Form form = new Form
    {
        Controls ={
            new TabControl { Dock = DockStyle.Fill, TabPages = {
                new TabPage { Text = "Tab Page", Controls = {
                    (textbox = new TextBox { Text = "I'm a graph control...",
                        Multiline = true, Dock = DockStyle.Fill})
                }}
            }},
            (button = new Button { Text = "Maximize", Dock = DockStyle.Bottom }),
    }}) {
        button.Click += delegate
        {
            textbox.Parent.Controls.Remove(textbox);
            form.Controls.Add(textbox);
            textbox.BringToFront();
        };
        Application.Run(form);
    }
} 
```

# asp.net - 在 ASP.NET 2.0 中，我可以有一个按钮来浏览客户端文件夹并选择路径（不是文件）吗？

> ID：472165
> 
> 赞同：0
> 
> 时间：2009-01-23T07:16:24.337
> 
> 标签：asp.net, directory, picker, folderbrowserdialog

我已经使用了隐藏的文件上传控件来浏览文件并获取文件路径，而没有真正上传它。

我的问题是，在 ASP.NET 中有没有办法，创建一个文件夹浏览按钮，当它被点击时，只是为了浏览客户端文件系统，用户可以点击路径并选择该路径而不是文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T07:42:17.780

不，您不能使用映射到 HTML 控件的标准 ASP.NET 控件。如果您正在使用 Flash、Silverlight 或 Java 小程序，则可能有可能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T07:26:51.663

不幸的是，唯一与文件相关的 HTML 控件是文件选择器 (<input type="file">)。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-24T15:27:00.010

使用 Flash 执行此任务并通过 JS 调用此操作

# iphone - 使用 UIImagePickerController 选择照片并将其上传到服务器。

> ID：472168
> 
> 赞同：0
> 
> 时间：2009-01-23T07:18:27.017
> 
> 标签：iphone

我正在使用`Picker`带有`UIImagePickerControllerSourceTypePhotoLibrary`.

在委托`didFinishPickingImage`中被调用，但是当我点击取消按钮时它没有输入：

```
(void)imagePickerControllerDidCancel:(UIImagePickerController *)picker 
```

即使控制器被解雇，也会发生这种情况。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T17:15:48.217

您需要实现 UIImagePickerControllerDelegate 的其余部分。单击取消按钮时，选择器将在其委托上调用 -imagePickerControllerDidCancel:。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T07:38:35.057

确保您认为它正在调用的类实现了正确的委托协议。

这个case应该是UIImagePickerControllerDelegate，像这样：

```
@interface YourClassViewController : UIViewController < UIImagePickerControllerDelegate> 
```

# python - Python 中 dll 导入中的错误答案

> ID：472170
> 
> 赞同：-4
> 
> 时间：2009-01-23T07:18:32.167
> 
> 标签：python, import

在我的 Python 脚本中，我正在导入一个用 VB.NET 编写的 dll。我在我的脚本中调用了一个初始化函数。它有 2 个参数：一个 XML 文件的路径和一个字符串。它返回一个整数 - 0 表示成功，否则返回错误。第二个参数通过引用传递。因此，如果成功，它将使用成功消息进行更新。否则，使用错误消息进行更新。

当我的脚本收到整数时，我应该在第二个变量中打印消息。我不能那样做。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T10:31:32.463

Python 字符串是不可变的。无法在函数内部更改字符串。

所以你真正想要的是传递某种*字符缓冲区*。您可以使用该`ctypes`模块在 python 中创建它们。

请编辑问题并粘贴一小段代码，以便我们进行测试并提供更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T07:26:34.303

Python 不支持以与 VB.NET 相同的方式“通过引用”传递字符串的概念。因此，如果没有更多的工作，可能无法做到这一点。

但是，如果没有看到您的代码，绝对不可能告诉您出了什么问题。

# java - java面试问题有什么好的资源吗？

> ID：472176
> 
> 赞同：34
> 
> 时间：2009-01-23T07:20:31.927
> 
> 标签：java, jakarta-ee

有人可以为我指出一个很好的 java/j2ee 编程和架构师职位的面试问题库吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-23T07:22:51.750

怎么样？

*   [https://stackoverflow.com/questions/64856/senior-j2ee-interview-questions](https://stackoverflow.com/questions/64856/senior-j2ee-interview-questions)
*   [https://stackoverflow.com/questions/72183/any-good-interview-questions-to-ask-prospective-junior-java-developers](https://stackoverflow.com/questions/72183/any-good-interview-questions-to-ask-prospective-junior-java-developers)

查看此站点上的资源，它收集了非常好的示例问题和答案：[http ://www.j2eebrain.com/j2ee-interview-questions-answers](http://www.j2eebrain.com/j2ee-interview-questions-answers)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T08:14:35.203

查看 Joshua Bloch 的 Java Puzzlers 一书。 [http://www.javapuzzlers.com/](http://www.javapuzzlers.com/)

[亚马逊链接](https://rads.stackoverflow.com/amzn/click/com/032133678X)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-24T18:36:06.877

签出 -[真正的面试 Java 问题](http://www.java-questions.com)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-04-23T19:17:32.967

[Java 面试问题](http://www.skill-guru.com/test/25/java-interview-questions)的另一个链接

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-28T06:12:24.623

[http://www.glassdoor.com/](http://www.glassdoor.com/)有很多很好的 Java 问题和谜题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T08:55:19.020

JCEA 问题可能有用：

[http://www.coderanch.com/t/152957/Architect-Certification-SCEA/certification/java-application-client](http://www.coderanch.com/t/152957/Architect-Certification-SCEA/certification/java-application-client)

[http://www.leocrawford.org.uk/work/jcea/part1/](http://www.leocrawford.org.uk/work/jcea/part1/)

[http://www.sweber.be/SCEA/](http://www.sweber.be/SCEA/)

# python - 如何使用 pycurl 读取标题

> ID：472179
> 
> 赞同：25
> 
> 时间：2009-01-23T07:21:48.353
> 
> 标签：python, curl, pycurl

如何读取从 PyCurl 请求返回的响应标头？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-23T08:13:57.077

有几种解决方案（默认情况下，它们被删除）。这是一个使用选项 HEADERFUNCTION 的示例，它允许您指示处理它们的函数。

其他解决方案是选项 WRITEHEADER（与 WRITEFUNCTION 不兼容）或将 HEADER 设置为 True 以便它们与正文一起传输。

```
#!/usr/bin/python

import pycurl
import sys

class Storage:
    def __init__(self):
        self.contents = ''
        self.line = 0

    def store(self, buf):
        self.line = self.line + 1
        self.contents = "%s%i: %s" % (self.contents, self.line, buf)

    def __str__(self):
        return self.contents

retrieved_body = Storage()
retrieved_headers = Storage()
c = pycurl.Curl()
c.setopt(c.URL, 'http://www.demaziere.fr/eve/')
c.setopt(c.WRITEFUNCTION, retrieved_body.store)
c.setopt(c.HEADERFUNCTION, retrieved_headers.store)
c.perform()
c.close()
print retrieved_headers
print retrieved_body 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-02-05T01:20:49.777

```
import pycurl
from StringIO import StringIO

headers = StringIO()

c = pycurl.Curl()
c.setopt(c.URL, url)
c.setopt(c.HEADER, 1)
c.setopt(c.NOBODY, 1) # header only, no body
c.setopt(c.HEADERFUNCTION, headers.write)

c.perform()

print headers.getvalue() 
```

根据需要/需要添加任何其他 curl setopts，例如 FOLLOWLOCATION。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-09-01T11:54:40.897

另一个替代，human_curl 用法：pip human_curl

```
In [1]: import human_curl as hurl

In [2]: r = hurl.get("http://stackoverflow.com")

In [3]: r.headers
Out[3]: 
{'cache-control': 'public, max-age=45',
 'content-length': '198515',
 'content-type': 'text/html; charset=utf-8',
 'date': 'Thu, 01 Sep 2011 11:53:43 GMT',
 'expires': 'Thu, 01 Sep 2011 11:54:28 GMT',
 'last-modified': 'Thu, 01 Sep 2011 11:53:28 GMT',
 'vary': '*'} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T09:26:00.347

这可能是也可能不是您的选择：

```
import urllib
headers = urllib.urlopen('http://www.pythonchallenge.com').headers.headers 
```

# xml - Groovy+ XML：使用命名空间前缀处理属性

> ID：472182
> 
> 赞同：0
> 
> 时间：2009-01-23T07:23:04.933
> 
> 标签：xml, groovy, namespaces

我正在使用 Groovy 处理 XML 文档，并为某个属性测试一个节点，该属性具有命名空间前缀。它是如何工作的：

在常规脚本中：

```
...
Element.Subelement.each {
  if (it.'@type'=='ns2:xyType')
    ...do what ever...
} 
```

在 XML 文档中：

```
<Element>
   <Subelement xsi:type="ns2:xyType"> 
      <!-- or another type, want to do something with      
           subelement only if type is "ns2:xyType" -->
   </Subelement>
</Element> 
```

寻找类似的东西：

```
if (it.'@xsi:type'=='ns2:xyType') 
```

THX 谢顿

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2017-08-03T04:52:26.933

官方文档中没有提到如何做到这一点，这很荒谬。

这是我发现的作品（Groovy 2.4）

```
def element = new XmlParser(false, false).parseText(xml)
assert element.Subelement.'@xsi:type' == 'ns2:xyType' 
```

创建 XmlSlurper 或 Parser 时为 namespaceAware 传入 false 的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-03-04T10:19:55.647

```
def xsi = new groovy.xml.Namespace("http://www.w3.org/2001/XMLSchema-instance")  
node.attributes()[xsi.type] == 'my_type' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T02:57:19.150

好吧，您的文档有点令人困惑，因为似乎从未声明过 xsi 和 ns2 命名空间，但我假设它们是在完整文档中的某个地方声明的。

来自[Groovy 文档](http://groovy.codehaus.org/Reading+XML+using+Groovy%27s+XmlSlurper)

```
def wsdl = '''
<definitions name="AgencyManagementService"
    xmlns:ns1="http://www.example.org/NS1"
    xmlns:ns2="http://www.example.org/NS2">
    <ns1:message name="SomeRequest">
        <ns1:part name="parameters" element="SomeReq" />
    </ns1:message>
    <ns2:message name="SomeRequest">
        <ns2:part name="parameters" element="SomeReq" />
    </ns2:message>
</definitions>
'''

def xml = new XmlSlurper().parseText(wsdl).declareNamespace(ns1: 'http://www.example.org/NS1', ns2: 'http://www.example.org/NS2')
println xml.'ns1:message'.'ns1:part'.size()
println xml.'ns2:message'.'ns2:part'.size() 
```

对于您的示例（请注意，您必须填写命名空间的 URL）：

```
def ggg = '''
<Element xmlns:xsi="http://www.example.org/xsi"
    xmlns:ns2="http://www.example.org/NS2">
   <Subelement xsi:type="ns2:xyType"> 
      <SubSub name="bob" />
   </Subelement>
</Element>
'''
def xml = new XmlSlurper().parseText(ggg).declareNamespace(xsi: 'http://www.example.org/xsi', ns2: 'http://www.example.org/NS2')
def elem = xml.'Subelement'
if ( elem.'@xsi:type'.text() == 'ns2:xyType' ){
   // do it  
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-03T10:59:43.417

这对我来说很好（groovy 1.8.4）。给定一个 XML 文档：

```
<container>
    <item xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="woo:FAMILY">
      <id>111</id>
      <name>Family 1</name>
   </item>
</container> 
```

这个断言通过：

```
def xml = new XmlSlurper().parseText(xmlDocStr)
assert "woo:FAMILY" == xml.item.'@xsi:type'.text() 
```

请注意，您确实必须拥有 .text() 。

# c# - 寻找相当于scanf的C#

> ID：472202
> 
> 赞同：34
> 
> 时间：2009-01-23T07:41:25.207
> 
> 标签：c#, scanf

我过去曾经用 C 语言编写代码，我发现这个`scanf`函数非常有用。不幸的是，C# 中没有等价物。

我正在使用它来解析半结构化文本文件。

我在[这里](http://www.codeproject.com/KB/recipes/csscanf.aspx)`scanf`找到了一个有趣的实现示例。不幸的是，它看起来又旧又不完整。

有谁知道`scanf`C# 实现？或者至少可以作为反向的东西`string.Format`？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-23T07:53:45.993

由于文件是“半结构化的”，您不能使用 ReadLine() 和 TryParse() 方法的组合，或者 Regex 类来解析您的数据吗？

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-02-25T06:17:14.010

如果正则表达式不适合您，我刚刚发布了`sscanf()`.NET 的替代品。该代码可以在[http://www.blackbeltcoder.com/Articles/strings/a-sscanf-replacement-for-net](http://www.blackbeltcoder.com/Articles/strings/a-sscanf-replacement-for-net)查看和下载。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-23T07:54:15.243

您可以直接从 C 运行时库中使用 scanf，但如果您需要使用不同的参数计数来运行它，这可能会很困难。我建议您为您的任务使用正则表达式或在此处描述该任务，也许还有其他方法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-08-07T12:00:38.823

我找到了比使用 C 中的 sscanf 或某些人重写的部分更好的解决方案（无冒犯）

[http://msdn.microsoft.com/en-us/library/63ew9az0.aspx](http://msdn.microsoft.com/en-us/library/63ew9az0.aspx) 看看这篇文章，它解释了如何使命名组从模式字符串中提取想要的数据。注意文章中的小错误和下面更好的版本。（冒号不是该组的一部分）

```
using System;
using System.Text.RegularExpressions;

public class Example
{
   public static void Main()
   {
      string url = "http://www.contoso.com:8080/letters/readme.html";
      Regex r = new Regex(@"^(?<proto>\w+)://[^/]+?(?<port>:\d+)?/",RegexOptions.None, TimeSpan.FromMilliseconds(150));
      Match m = r.Match(url);
      if (m.Success)
         Console.WriteLine(r.Match(url).Result("${proto}:${port}")); 
   }
}
// The example displays the following output: 
//       http::8080 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-06-22T06:38:52.360

c# 中缺少类似 scanf 的函数是有充分理由的。它很容易出错，而且不灵活。使用正则表达式更加灵活和强大。

另一个好处是，如果您需要在代码的不同部分解析相同的内容，则更容易在整个代码中重用。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-01-05T14:42:25.947

尝试导入 msvcrt.dll

```
using System.Runtime.InteropServices;

namespace Sample
{
    class Program
    {
        [DllImport("msvcrt.dll", CallingConvention = CallingConvention.Cdecl)]
        public static extern int printf(string format, __arglist);

        [DllImport("msvcrt.dll", CallingConvention = CallingConvention.Cdecl)]
        public static extern int scanf(string format, __arglist);

        static void Main()
        {
            int a, b;
            scanf("%d%d", __arglist(out a, out b));
            printf("The sum of %d and %d is %d.\n", __arglist(a, b, a + b));
        }
    }
} 
```

这在 .NET Framework 上运行良好。但在 Mono 上，它显示错误消息：

```
Unhandled Exception:
System.InvalidProgramException: Invalid IL code in Sample.Program:Main (): IL_0009: call      0x0a000001

[ERROR] FATAL UNHANDLED EXCEPTION: System.InvalidProgramException: Invalid IL code in Sample.Program:Main (): IL_0009: call      0x0a000001 
```

如果你需要 Mono 兼容性，你需要避免使用`arglist`

```
using System.Runtime.InteropServices;

namespace Sample
{
    class Program
    {
        [DllImport("msvcrt.dll", CallingConvention = CallingConvention.Cdecl)]
        public static extern int printf(string format, int a, int b, int c);

        [DllImport("msvcrt.dll", CallingConvention = CallingConvention.Cdecl)]
        public static extern int scanf(string format, out int a, out int b);

        static void Main()
        {
            int a, b;
            scanf("%d%d", out a, out b);
            printf("The sum of %d and %d is %d.\n", a, b, a + b);
        }
    }
} 
```

其中参数的数量是固定的。

**编辑 2018-5-24**

`arglist`也不适用于 .NET Core。似乎不推荐调用 C vararg 函数。您应该改用 .NET 字符串 API，例如`String.Format`。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-09-30T20:58:15.670

我认为您想要 C# 库函数 Parse 或 Convert。

```
// here's an example of getting the hex value from a command line 
// program.exe 0x00080000

static void Main(string[] args)
{
    int value = Convert.ToInt32(args[1].Substring(2), 16);
    Console.Out.WriteLine("Value is: " + value.ToString());
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T07:58:08.357

您可以使用 System.IO.FileStream 和 System.IO.StreamReader，然后从那里解析。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2016-01-06T01:48:22.467

虽然这看起来有点粗糙，但它确实完成了工作：

```
// Create the stream reader
sr = new StreamReader("myFile.txt");

// Read it
srRec = sr.ReadLine();

// Replace multiple spaces with one space
String rec1 = srRec.Replace("          ", " ");
String rec2 = rec1.Replace("         ", " ");
String rec3 = rec2.Replace("        ", " ");
String rec4 = rec3.Replace("       ", " ");
String rec5 = rec4.Replace("      ", " ");
String rec6 = rec5.Replace("     ", " ");
String rec7 = rec6.Replace("    ", " ");
String rec8 = rec7.Replace("   ", " ");
String rec9 = rec8.Replace("  ", " ");

// Finally split the string into an array of strings with Split
String[] srVals = rec9.Split(' '); 
```

然后，您可以将数组 srVals 用作记录中的单个变量。

# .net - 在托管 .NET 代码中分配非托管内存

> ID：472212
> 
> 赞同：0
> 
> 时间：2009-01-23T07:48:51.510
> 
> 标签：.net, arrays, unmanaged, managed

嗨，我有一个非托管函数，它占用 malloc 分配的一大块内存，然后以异步方式释放它。我想将它包装到托管包装器中。下面的代码可以吗？

```
void managed_fx (byte data __gc[], size_t size)
{
    //  Pin the data
    byte __pin *pinned_data = &data [0];

    //  Copy data to the unmanaged buffer.
    void *unmanaged_data = malloc (size);
    memcpy (unmanaged_data, (byte*) pinned_data, size);

    //  Forward the call
    fx (unmanaged_data, size);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T15:47:49.407

我的 MC++ 有点生疏，但我认为 __pin 固定源变量，直到“pinned_data”超出范围（至少，这就是 C++/CLI 中等效的 pin_ptr 所做的）。您通常应该尽快取消固定它，即出于性能原因，您不应该在同一范围内调用 fx。

> 在这种情况下是否需要固定？

是的。您想从非托管代码访问托管内存。

> gc 可以在 memcpy 之前释放它吗

不，对数据有很强的引用，所以 gc 不会收集它。然而，它可能会收集一些其他对象，并在压缩步骤中将数据移动到内存中。然后 malloc 将访问错误的内存区域。固定可以防止这种情况发生，但代价是 GC 需要额外记账（这就是为什么您应该尽快取消固定对象的原因）。

> malloc 是否分配非托管内存，即使它在托管代码中使用？

是的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T12:27:56.800

你是

1.  假设数据数组的大小至少一样大。这是一个等待发生的可能错误

2.  不检查 malloc() 的结果

3.  无论如何，您可能不需要这样做，只需传递固定字节指针就可以了（除非调用的 fx() 函数以某种方式更改了数据，在这种情况下可能需要复制）。基于稍后释放的内存，这很可能是不可能的。

考虑到这一点，这里是一个固定版本

```
void managed_fx (byte data __gc[], size_t size)
{
    if (data.Length < size)
        throw gcnew System.IndexOutOfRangeException(
            "the unmanaged buffer is not big enough");
    //  Pin the data
    byte __pin *pinned_data = &data [0];

    //  Copy data to the unmanaged buffer.
    void *unmanaged_data = malloc (size);
    if (unmanaged_data == NULL) 
        throw gcnew OutOfMemoryException(
            "could not allocate memory for the unmanaged buffer");
    memcpy (unmanaged_data, (byte*) pinned_data, size);

    //  Forward the call
    fx (unamanged_data, size);
} 
```

要回答进一步的问题：

固定是执行 memcpy 所必需的。它不会阻止 GC 运行时删除内存（从技术上讲，它确实如此，但简单地持有对它的引用也是如此）它会阻止它在内存中**移动。**由于 memcpy 是一个非托管函数 - 它无法处理它正在操作的指针在内存中移动。malloc 完全是非托管的（尽管运行时库可以自由使用托管堆的保留区域来执行此操作）。

源 C++/CLI 中没有明确区分“代码”是托管还是非托管。在编译时，有些部分是 CIL 中间代码，有些部分是纯原生代码，重要的是**变量是否**使用的是托管或非托管。托管引用（带有 ^ 的任何内容）只能由本身托管的代码操作/使用。这意味着如果运行时更改了托管对象在内存中的位置，则运行时可以随意更改所使用的底层指针的值。它以对托管函数安全的方式执行此操作（当周围的世界发生变化时，它们会暂停）。由于存在许多有用的函数，但不知道如何处理此类托管引用，因此您最终可能需要获取指向它们的简单指针。由于此操作是不安全的（如果 GC 开始移动引用），存在固定指针以使其安全且易于执行，因为它既需要一个指针，并且该指针的生命周期会阻止运行时移动指向的变量.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T08:12:55.440

你需要测试你的 malloc 它实际上已经分配了你的指针。不知道 C++/CLI，所以我不知道你的 pin 是否可以工作。您不需要使用 Marshalling 库来保证内存在复制时被固定吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T08:17:47.973

阅读[本文](http://blog.nostatic.org/2008/05/allocating-unmanaged-memory-in-managed.html)以获取有关如何分配非托管数据的信息。看看[Marshall](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal_members.aspx)类。也许会有一些方法可以代替您的 managed_fx 功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T15:32:14.603

好的，让我们让它更简单：

```
void managed_fx (byte data __gc[])
{
     //  Pin the data
     byte __pin *pinned_data = &data [0];

     //  Copy data to the unmanaged buffer.
     void *unmanaged_data = malloc (data.Length);
     assert (unmanaged_data);
     memcpy (unmanaged_data, (byte*) pinned_data, data.Length);

     //  Forward the call
     fx (unamanged_data, data.Length);
 } 
```

不过，我有几个问题：

1.  在这种情况下是否需要固定？gc 可以在 memcpy 发生之前释放它吗？
2.  malloc 是否分配非托管内存，即使它在托管代码中使用？

# ajax - 下拉列表 selectedchanged 事件未触发？

> ID：472218
> 
> 赞同：0
> 
> 时间：2009-01-23T07:51:48.353
> 
> 标签：ajax, event-handling, drop-down-menu

我正在使用启用 Ajax 的页面，并且我没有在此页面中使用任何控件。即使这样，`SelectedIndexChanged`事件也不会触发。我已经从数据库中添加了项目，没有重复并且还设置了`AutoPostBack`property="true"。我想在选择一个项目时从数据库中添加项目。选择始终显示第一个元素并且`SelectedIndexChanged`事件不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T07:53:41.597

您是否在回发后重新绑定下拉列表？

确保您的页面级代码隐藏具有以下条件：

```
if (!IsPostBack)
{
    // bind my drop down list
} 
```

# web-services - 部分信任 XBAP 和 Windows 集成身份验证 - Fiddler 隐藏问题

> ID：472226
> 
> 赞同：0
> 
> 时间：2009-01-23T08:00:52.033
> 
> 标签：web-services, windows-authentication, xbap

我有一个 3.5 sp1 部分信任 XBAP 的 asp.net 门户。门户在集成 Windows 身份验证下运行，但我无法让 XBAP 在集成身份验证下运行。

XBAP 下载并启动正常，但是一旦在同一服务器（不同的网站）上调用 WS，我就会收到 401 错误。如果我将 WS 设置为使用匿名身份验证，则一切正常。

使用 fiddler 进行调试隐藏了问题（我猜 fiddler 在我的帐户下作为代理运行，因此 WS 调用在 fiddler 运行时有效）

知道该怎么做吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T19:56:29.377

发现问题，忘记设置 UseDefaultCredentials=true; 在代理上

# ruby-on-rails - Rails：has_many :through 还是 has_many_and_belongs_to？

> ID：472227
> 
> 赞同：4
> 
> 时间：2009-01-23T08:01:11.563
> 
> 标签：ruby-on-rails, activerecord, join

我有一个应用程序，我想通过另一个模型（即任务 1 > 关系 < 任务 2）将模型的一个实例链接到同一模型的另一个实例，并且想知道我是否可以使用 has_many :through 来实现这一点。

基本上，关系模型将具有额外的信息（type_of_relationship，lag），因此将其作为连接模型是理想的。然而，没有两个模型可以加入，只有一个……它自己。has_many :through 还能用吗？如果是这样，连接表的外观如何？使用 Rails 约定，您将有两个名为 Activity_id 的列，这显然在数据库中不起作用。

或者，我可以使用 has_many_and_belongs_to 在任务模型和关系模型之间设置多对多，但我不确定这是否准确地描述了一种关系，该关系应该只链接任何一个关系模型中的两个任务模型（当然任务可能属于多个关系，因此是多对多）。

我的直觉说要使用 has_many_and_belongs_to 并整理模型中的规则，但有更好的方法吗？我要在这个上兜圈子！

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T08:14:59.650

has_many :through 非常适合您的情况。我不知道你的模型的细节，但假设你有用户，每个用户都可以有其他用户作为联系人。您可以对这种情况进行建模，如下所示：

```
class User < ActiveRecord::Base
  has_many :contact_records, :foreign_key => :owner_id
  has_many :contacts, :through => :contact_records, :class_name => "User"
end

class ContactRecord < ActiveRecord::Base
  belongs_to :owner, :class_name => "User"
  belongs_to :user
end 
```

# c# - 从 C# 调用 ActionScript 3 函数

> ID：472234
> 
> 赞同：15
> 
> 时间：2009-01-23T08:06:58.760
> 
> 标签：c#, winforms, flash, actionscript-3

我有一个嵌入在 Windows 窗体中的 Flash 电影（使用 Visual Studio 8 中包含的组件“Shockwave Flash 对象”）。Flash 电影是用 Flash CS4 创建的，并使用 ActionScript 3。

是否可以使用 C# 调用 Flash 电影中返回值的 ActionScript 函数？

另外，我的 Flash 电影是否可以在主应用程序中调用返回值的 C# 函数？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-23T10:07:44.647

为了使您的 Flash 播放器主机可以调用 ActionScript 函数，您必须使用 ExternalInterface.addCallback 函数，例如：

```
ExternalInterface.addCallback("testCallback", function (text : String) : String
{
    var helloText : String = "Hello, " + text;
    myTextField.text = helloText;
    return helloText;
}); 
```

为了在 C# 中从 Windows 窗体应用程序调用此函数，您必须使用 Flash 播放器组件公开的 CallFunction 方法。该方法有一个字符串参数，该参数必须包含一个描述调用的 XML；它返回一个字符串，其中包含一个描述返回值的 XML。使用上面的示例，这将是调用 testCallback 函数的方法：

```
textBox1.Text = flash.CallFunction("<invoke name=\"testCallback\" returntype=\"xml\"><arguments><string>" + textBox1.Text + "</string></arguments></invoke>"); 
```

假设您的文本框 (textBox1) 包含文本“World”，在执行上面的代码时，它将包含文本“Hello, World”。

如果您想从 Flash 调用 C# 代码，情况类似：您必须为 Flash 播放器的 FlashCall 事件定义一个事件处理程序。然后，您将使用来自 ActionScript 的以下类型的调用：

```
ExternalInterface.call("MyCSharpFunction", 17); 
```

这将使 Flash 播放器引发 FlashCall 事件并调用您的事件处理程序。您的处理程序接收到的事件参数有一个名为“request”的公共字段，其类型为字符串。请求字段包含描述从 Flash 发出的调用的 XML。对于上面使用的示例，它看起来像这样：

```
<invoke name="MyCSharpFunction" returntype="xml"><arguments><number>17</number></arguments></invoke> 
```

如果您希望返回一个值，您在 FlashCall 事件处理程序中所要做的就是在事件处理程序返回之前调用 Flash 播放器的 SetReturnValue 方法，将带有描述返回值的 XML 的字符串传递给它，例如：

```
<string>Works like a charm!</string> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T09:03:37.553

ExternalInterface.addCallback(functionName:String, closure:Function):void registers an actionscript method to be callable from it's container.

I'm not sure if it would be able to return a value. My thoughts are that this wouldn't work. If that was the case you could just do another ExternalInterface.call which sends the container the information you want as an argument.

I don't know how to actually do the calling from C# but i have seen it done by one of my colleagues for a flash installation project we were working on so i know it's possible... some how!

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-29T05:00:46.360

请参阅下面给出的链接，您将找到适合您问题的解决方案。您的要求将满足。 [点击她获取解决方案](http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7cb0.html)

# java - 字节流/C/JNI

> ID：472249
> 
> 赞同：1
> 
> 时间：2009-01-23T08:18:00.487
> 
> 标签：java, c, java-native-interface

C API 实现中通常使用哪些数据类型来存储字节流？如何将此类型转换为 jbyteArray？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-20T13:48:01.490

请参阅他们使用 NewByteArray() 并直接返回它的 Java_ReadFile_loadFile 示例。

[http://dev.cs.ovgu.de/java/Books/JDCBook/jnistring.html](http://dev.cs.ovgu.de/java/Books/JDCBook/jnistring.html)

```
 JNIEXPORT jbyteArray JNICALL Java_ReadFile_loadFile
    (JNIEnv * env, jobject jobj, jstring name) {
      caddr_t m;
      jbyteArray jb;
      struct stat finfo;
      jboolean iscopy;
      const jchar *mfile = (*env)->GetStringChars(env, 
        name, &iscopy);
  //...
      (*env)->ReleaseStringChars(env, name, mfile); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T08:24:02.157

那将是 (const) unsigned char * 代表一个保存字节本身的内存块，再加上一个 size_t 告诉你字节数。

[该线程](http://www.velocityreviews.com/forums/t148587-making-and-returning-java-byte-arrays-in-c-via-jni-help-please.html)似乎讨论了如何创建合适的 Java 类型（NewByteArray() 是函数）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-24T06:56:54.207

你的问题不是很清楚。

假设您在 C 中有一些字节表示字符，最好的办法是将这些字节转换为 Java，然后使用 Java 的字节转换将它们转换为文本。

在 JNI 中，您只需要通过使用 JNI 来实例化一个 Java 数组，或者通过将引用作为参数传入（您仍然需要在 JNI 代码中“实现”一个指针）来实现一个 Java 数组。

我以前做过后一件事，所以这里是代码仅供参考。这个 JNI 调用使用 AS/400 C API 来读取数据库记录并将字节返回给 Java——Java 代码然后使用记录格式信息将字段提取到字符串中。希望这个对你有帮助：

```
JNIEXPORT jboolean JNICALL Java_com_xxx_DB2File_jniRead(JNIEnv *jep, jobject thsObj,                    
 jlong handle, jint readOp, jbyteArray jvaDta, jint jvaDtaMax, jint flags) {                                                
    OBJDTA           *odp;                                                                                                  
    jbyte            *jniDta;                                                                                               
    _RIOFB_T         *fbp;                                                                                                  

    thsObj=thsObj;                                                                                                          
    if((odp=getDataspace(handle))==NULL) {                                                                                  
        throwEscape(jep,90003,"Invalid handle for dataspace in jniRead()");                                                 
        return JNI_FALSE;                                                                                                   
        }                                                                                                                   
    jniDta=(*jep)->GetByteArrayElements(jep,jvaDta,0);                                                                      

    // read database record here

    if(fbp->num_bytes<=0) {                                                                                                 
        (*jep)->ReleaseByteArrayElements(jep,jvaDta,jniDta,JNI_ABORT); /* do not copy changed array back to java */         
        return JNI_FALSE;                                                                                                   
        }                                                                                                                   
    if(fbp->num_bytes!=odp->rcdLen) {                                                                                       
        byte             errtxt[201];                                                                                       

        asd_errtxt(errno,errtxt,sizeof(errtxt));                                                                            
        (*jep)->ReleaseByteArrayElements(jep,jvaDta,jniDta,JNI_ABORT); /* do not copy changed array back to java */         
        throwEscape(jep,90204,"Native function jniRead failed.  Got %i, expected %i (%s)",fbp->num_bytes,odp->rcdLen,       
         errtxt);                                                                                                           
        return JNI_FALSE;                                                                                                   
        }                                                                                                                   
    (*jep)->ReleaseByteArrayElements(jep,jvaDta,jniDta,0); /* copy changed array back to java */                            
    return JNI_TRUE;                                                                                                        
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T22:59:15.267

你不需要转换它们。jbyteArray 和 char* 类型是兼容的。

Java 声明：

```
private static native int doSomething(bate[] string, int length); 
```

C声明：

```
JNIEXPORT jint JNICALL Java_package_class_doSomething(JNIEnv *env, jclass jc, jbyteArray string, jint length) {
    int i;
    for (i = 0; i < length; i++) {
        // read string[i]
    }
} 
```

您可以以相同的方式将值传递回 java。但请确保在调用 C 函数之前初始化字节数组的长度。

# perl - 如何在 Perl 中组合 .EXE 命令？

> ID：472252
> 
> 赞同：2
> 
> 时间：2009-01-23T08:21:34.533
> 
> 标签：perl, system, external-process

我有一组 .EXE 命令。如何让所有这些命令在 Perl 中作为单个文件运行？在 Perl 中调用 .EXE 文件的过程是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T08:24:09.647

Perl[`system()`](http://perldoc.perl.org/functions/system.html)函数会这样做：

```
#!/usr/bin/perl -w

system("prog1.exe");
system("prog2.exe"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T08:24:12.843

从 perl 调用系统命令的方法是使用

```
system("String containing command + args here") 
```

或者如果你想对输出进行一些处理，你可以使用反引号

```
`command + args here` 
```

您也可以将所有普通的 perl 字符串操作单行与反引号一起使用。

# javascript - Safari中未触发JQuery Click事件？

> ID：472259
> 
> 赞同：3
> 
> 时间：2009-01-23T08:26:59.890
> 
> 标签：javascript, jquery, select, safari, jquery-events

当用户从选择框中选择一个选项时，我正在尝试做某事 - 尽可能简单吗？我正在使用 JQuery 1.3.1 注册一个带有选择框 id 的点击处理程序。一切都很好，直到我使用 Chrome 和 Safari 进行测试并发现它不起作用。

1.  火狐 3.05 - 是
2.  IE 7.0.5730.13 - 是
3.  IE6Eolas - 是的
4.  萨拉菲 3.2.1 - 否
5.  铬 1.0.154.43 - 否

见下面的代码：

```
<html>
<head>
    <script language="javascript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>
    <script language="javascript">
    $(document).ready(function(){
        $('#myoption').click(function() { alert('Select Dropdown was clicked: '+ $('#myoption').val()); });
    });     
    </script>
</head>
<body>
    <select id="myoption">
    <option value="A">A</option>
    <option value="B">B</option>
    </select>
</body>
</html> 
```

有人知道我应该怎么做才能让它工作吗？警报最终会被触发，但只有在双击选择框后才会触发？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T08:35:09.997

我发现了我的问题。对于选择框，您需要为“更改”事件而不是“单击”事件注册处理程序。奇怪的是 Firefox 和 IE 使用 click 事件。

总而言之，以下代码适用于所有浏览器：

```
<html>
<head>
    <script language="javascript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>
    <script language="javascript">
    $(document).ready(function(){
        $('#myoption').change(function() { alert('Select Dropdown was clicked: '+ $('#myoption').val()); });
    });         
    </script>
</head>
<body>
    <select id="myoption">
    <option value="A">A</option>
    <option value="B">B</option>
    </select>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-21T17:40:11.773

Safari 和 Chrome 都是基于 webkit 的浏览器。Webkit 使用操作系统中的本机下拉元素，而不是自己实现下拉菜单，不幸的是，本机下拉菜单不支持点击事件。出于同样的原因，它们也不支持选项元素的 CSS 或其他巧妙的技巧。

让这些工作的唯一跨浏览器方法是使用 <ul> 和大量 javascript 手动实现这一点。

# asp.net - 在 Crystal Reports for .NET 中更改数据库

> ID：472262
> 
> 赞同：0
> 
> 时间：2009-01-23T08:29:54.393
> 
> 标签：asp.net, crystal-reports

我有一个问题在这里得到了完美的描述（[http://www.bokebb.com/dev/english/1972/posts/197270504.shtml](http://www.bokebb.com/dev/english/1972/posts/197270504.shtml)）：

设想：

Windows 智能客户端应用程序和适用于 Windows 的 CrystalReportViewer。使用 ServerFileReports 通过集中且断开连接的文件夹位置访问报告。

当访问针对 DB_DEV 设计的报表并尝试通过 CrystalReportViewer 更改其 LogonInformation 以指向 DB_UAT 时，它似乎从未真正使用更改的信息。

它总是违背 DB_DEV 信息。

知道如何更改 ServerFileReport 的数据库连接和登录信息吗？？？？

继承人代码：

来自演示者：

```
 // event that fires when the views run report button is pressed
private void RunReport(object sender, EventArgs e)
{
this.view.LoadReport(Report, ConnectionInfo);
}

protected override object Report
{
get
{
ServerFileReport report = new ServerFileReport();
report.ObjectType = EnumServerFileType.REPORT;
report.ReportPath = @"\Report2.rpt";
report.WebServiceUrl = "http://localhost/CrystalReportsWebServices2005/ServerFileReportService.asmx";
return report;

}
}
private ConnectionInfo ConnectionInfo
{
get
{
ConnectionInfo info = new ConnectionInfo();
info.ServerName = servername;
info.DatabaseName = databasename;
info.UserID = userid;
info.Password = password;
return info;
}
}

ON THE VIEW WITH THE CRYSTAL REPORT VIEWER:

public void LoadReport(object report, ConnectionInfo connectionInfo)
{
viewer.ReportSource = report;
SetDBLogon(connectionInfo);
}

private void SetDBLogon(ConnectionInfo connectionInfo)
{
foreach (TableLogOnInfo logOnInfo in viewer.LogOnInfo)
{
logOnInfo.ConnectionInfo = connectionInfo;
}
} 
```

有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T08:55:10.737

我知道这不是您正在寻找的程序化答案，但是：

对这类事情有帮助的一件事不是创建直接连接到数据库的报表，而是首先为 Crystal Reports 创建一个“数据字典”（这是在报表设计器中完成的）。然后，您将所有报告链接到该字典，该字典将字段映射到适当的数据库。

通过这种方式，您只有一个地方可以更改所有报告的数据库架构/连接信息。

此外，在您的报表设计器中将报表设置为不缓存结果（抱歉，我不记得确切的选项）。报告可以包含或不包含其初始结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T08:58:21.107

在您的 CrystalReportViewer 对象中，您应该设置

```
AutoDataBind="true" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T13:42:35.797

难道你不必浏览报表的所有“databaseTable”对象来重定向相​​应的连接吗？你会在[这里](https://stackoverflow.com/questions/204611/crystal-report-datasource-remap#217756)找到我的 VB 版本的“数据库切换”问题......

# xhtml - 为什么 HTML5 和 XHTML 2 是不同的标准？

> ID：472274
> 
> 赞同：18
> 
> 时间：2009-01-23T08:39:29.413
> 
> 标签：xhtml, html, web-standards, xhtml2

分开制定这两个标准有什么原因吗？他们似乎在解决同样的问题，但有什么区别？如果他们要保持独立，他们希望在未来的 Web 开发中扮演什么角色？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-23T09:15:28.403

Browser vendors care a great deal about backwards compatibility. The group speccing XHTML2 didn’t.

Note that XHTML2 isn’t solving all the same problems HTML5 is solving. HTML5 is much broader in scope than XHTML2\. HTML5 covers processing models, JavaScript APIs, video, audio, application widgets, etc. but XHTML2 does not.

As for expected roles, representatives from top browser vendors participate in the HTML WG but not in the XHTML2 WG. On the other hand, people showing interest in the “Backplane” are participating in the XHTML2 WG.

See also [David Baron’s post about how the W3C works](http://dbaron.org/log/2006-08#e20060818a).

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-23T10:38:59.810

本文仅回答部分问题。它没有解释这两个标准在未来可能扮演的角色：

[X/HTML 5 与 XHTML 2](https://web.archive.org/web/20151008131054/http://xhtml.com/en/future/x-html-5-versus-xhtml-2/)

至于可能的角色，人们说：

*   W3C 开始研究 XHTML 2，抛弃向后兼容性
*   有些人不喜欢这样，并开始定义 HTML 5
*   最终，W3C 也被说服采用 HTML 5
*   浏览器供应商似乎落后于 HTML 5（但不是 XHTML 2）

如果浏览器供应商不支持 XHTML 2，那么我不知道它的作用是什么。另一方面，XHTML 2 可以或多或少地转换为 XHTML 1，例如使用 XSL 转换，所以在我看来，如果他们愿意，任何人都可以（更）支持 HTML 5将会。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-01-21T19:25:45.440

XHTML2 已死。

看看 Jeremy Keith 撰写的[HTML5 FOR WEB DESIGNERS](http://www.alistapart.com/articles/a-brief-history-of-markup/)的第一章，它以总结的方式完美地解释了这些差异。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-27T21:54:57.647

HTML 5 在构建时考虑了向后兼容性，与 XHTML 2 不同，XHTML 2 的创建是为了摆脱与向后兼容性相关的限制。

W3C 允许[XHTML 2 工作组到期](http://www.w3.org/2009/06/xhtml-faq.html)，实质上结束了 XHTML 2 的开发。具有向后兼容性和新特性的 HTML 5 将成为未来的文档类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-30T04:46:20.597

这在很大程度上是一个准确的解释，IMO，但应该注意的是 HTML5 不向后兼容——即使在 IE7 中，像 section 这样的新元素也不能用 CSS 设置样式。是的，有 JavaScript 变通办法，但这些还不够，因为不是每个人都启用了 JavaScript，也不是每个开发人员都会意识到这些，同样不是每个开发人员都有能力以这种方式使用 JavaScript。

# .net - MEF on Mono doesn't work properly?

> ID：472275
> 
> 赞同：2
> 
> 时间：2009-01-23T08:39:40.207
> 
> 标签：.net, mono, mef

I've made a very simple MEF sample which runs on .NET, but doesn't work properly on Mono.

```
using System;
using System.Collections.Generic;
using System.Text;
using System.ComponentModel.Composition;

namespace Vialis
{
    class Program
    {
        [Import(typeof(ILedController))]
        public List<ILedController> Controllers
        {
            get;
            set;
        }

        static void Main(string[] args)
        {
            new Program();
        }

        public Program()
        {
            compose();
            selectController();

            Console.ReadLine();
        }

        private void compose()
        {
            var catalog = new DirectoryPartCatalog("controllers");
            var container = new CompositionContainer(catalog);

            container.AddPart(this);
            container.Compose();
        }

        private void selectController()
        {
            Console.Clear();
            Console.WriteLine("Please select the controller to use\n");

            byte i = 0;

            foreach (var controller in Controllers)
            {
                Console.WriteLine("\t{0}) {1}", i, controller.ToString());
                i++;
            }

            Console.Write("\nYour selection: ");
            var input = Convert.ToInt32(Console.ReadLine());

            Controllers[input].DisplayText(10, 10, "Hello World");
        }
    }
} 
```

This is the interface:

```
using System;
using System.Collections.Generic;
using System.Text;

namespace Vialis
{
    public interface ILedController
    {
        void DisplayText(int x, int y, string text);
    }
} 
```

This is the first implementation:

```
using System;
using System.Collections.Generic;
using System.Text;
using System.ComponentModel.Composition;

namespace Vialis
{
    [Export(typeof(ILedController))]
    public class LyanController : ILedController
    {
        public void DisplayText(int x, int y, string text)
        {
            Console.SetCursorPosition(x, y);
            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine(text);
        }
    }
} 
```

The second implementation:

```
using System;
using System.Collections.Generic;
using System.Text;
using System.ComponentModel.Composition;

namespace Vialis
{
    [Export(typeof(ILedController))]
    public class VialisController : ILedController
    {
        public void DisplayText(int x, int y, string text)
        {
            Console.SetCursorPosition(x, y);
            Console.ForegroundColor = ConsoleColor.Green;
            Console.WriteLine(text);
        }

    }
} 
```

This is what happens on .NET (Windows):

[.NET http://lh5.ggpht.com/_GWubgra2SwM/SXl-yoSRLtI/AAAAAAAADwI/sGR0FjLfg8Q/controller-selection-windows.jpg](http://lh5.ggpht.com/_GWubgra2SwM/SXl-yoSRLtI/AAAAAAAADwI/sGR0FjLfg8Q/controller-selection-windows.jpg)

Selecting the controllers:

[.NET 1 http://lh3.ggpht.com/_GWubgra2SwM/SXl-yYzs-aI/AAAAAAAADwE/WomfaQqv_Xc/vialis-controller-windows.jpg](http://lh3.ggpht.com/_GWubgra2SwM/SXl-yYzs-aI/AAAAAAAADwE/WomfaQqv_Xc/vialis-controller-windows.jpg)

[.NET 2 http://lh6.ggpht.com/_GWubgra2SwM/SXl-yE1Q-cI/AAAAAAAADwA/qznnEkiNokA/lyan-controller-windows.jpg](http://lh6.ggpht.com/_GWubgra2SwM/SXl-yE1Q-cI/AAAAAAAADwA/qznnEkiNokA/lyan-controller-windows.jpg)

But using Mono 2.2 the assemblies don't load:

[Mono http://lh5.ggpht.com/_GWubgra2SwM/SXl-xw0YXOI/AAAAAAAADv8/7j2UxJott04/controller-selection-macos.jpg](http://lh5.ggpht.com/_GWubgra2SwM/SXl-xw0YXOI/AAAAAAAADv8/7j2UxJott04/controller-selection-macos.jpg)

Any suggestions ?

INFO: Google seems to be having some picasa web problems, that is why the images don't load.

The pictures show you that on Mac OS, no controllers are listed.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T11:46:47.287

With the latest MEF release (Preview 4 - [http://www.codeplex.com/MEF](http://www.codeplex.com/MEF)) it works just fine!

Since the bug is no longer relevant I voted to close this question.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T08:54:25.827

So I'm assuming that the exports are defined in external assemblies, because you use the DirectoryPartCatalog.. either there is an issue with the file path handling in the catalog or the problem is in the AttributedAssemblyPartCatalog / AttributedTypesPartCatalog

Internally the DirectoryPartCatalog wraps each discovered assembly into an AttributedAssemblyPartCatalog which in turn uses a AttributedTypesPartCatalog

Your best bet is to add the MEF project into your solution, instead of the dll, and set a break point in the greediest constructors of DirectoryPartCatalog & AttributedAssemblyPartCatalog and step until u find the problem

Unfortunatly I do not have a mono machine setup so I can't help more than that

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T09:37:40.050

Adding the interface and the two implementations to the application assembly works. So I'll have debug like you suggested, need to find a decent debugger for mono though.

# ruby-on-rails - Netbeans 告诉我尝试运行 rails 应用程序时我的 gems 版本错误

> ID：472279
> 
> 赞同：0
> 
> 时间：2009-01-23T08:43:26.127
> 
> 标签：ruby-on-rails, ruby, netbeans

我最近一直在使用 Netbeans 6.5 - 它抱怨（在启动时，如果我尝试运行单元测试）：

“Rails 需要 RubyGems >= 1.3.1（你有 1.0.1）。请`gem update --system`再试一次。”

然而从命令行“gem --version”：1.3.1

有任何想法吗？为什么 netbeans 没有意识到我有 gems 1.3.1 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T08:58:04.103

Netbeans 具有您使用的平台的每个项目选项。它默认为 JRuby，它可能没有与您的 ruby​​ 安装相同的 gem。尝试右键单击您的项目并选择属性，然后检查列出的平台是否是您要使用的平台。如果未列出，您将需要选择管理并添加它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T08:46:51.097

您确定您在 Netbeans 中使用了正确的 PATH 吗？

# c# - 在 Windows 应用程序中显示控制台？

> ID：472282
> 
> 赞同：91
> 
> 时间：2009-01-23T08:45:27.527
> 
> 标签：c#, winforms, console

有没有办法在 Windows 应用程序中显示控制台？

我想做这样的事情：

```
static class Program
{
    [STAThread]
    static void Main(string[] args) {
        bool consoleMode = Boolean.Parse(args[0]);

        if (consoleMode) {
            Console.WriteLine("consolemode started");
            // ...
        } else {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new Form1());
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-01-23T08:48:08.927

你想做的事情不可能以理智的方式进行。有一个类似的问题[，所以看看答案](https://stackoverflow.com/questions/338951/output-to-command-line-if-started-from-command-line#339216)。

然后还有一个由[Jeffrey Knight编写的](https://stackoverflow.com/users/83418/jeffrey-knight)[疯狂方法](http://www.rootsilver.com/2007/08/how-to-create-a-consolewindow)（站点关闭 -[可以在此处进行备份。](http://web.archive.org/web/20111227234507/http://www.rootsilver.com/2007/08/how-to-create-a-consolewindow) ） ：

> 问题：如何创建可以在 GUI（Windows）模式或命令行/控制台模式下运行的应用程序？
> 
> 从表面上看，这似乎很容易：您创建一个控制台应用程序，向其中添加一个窗口窗体，然后您就可以开始运行了。但是，有一个问题：
> 
> 问题：如果你在 GUI 模式下运行，你最终会在后台看到一个窗口和一个讨厌的控制台，而且你无法隐藏它。
> 
> 人们似乎想要的是一个真正的两栖应用程序，它可以在任何一种模式下顺利运行。
> 
> 如果你把它分解，这里实际上有四个用例：
> 
> ```
> User starts application from existing cmd window, and runs in GUI mode
> User double clicks to start application, and runs in GUI mode
> User starts application from existing cmd window, and runs in command mode
> User double clicks to start application, and runs in command mode. 
> ```
> 
> 我正在发布执行此操作的代码，但有一点需要注意。
> 
> 我实际上认为这种方法会给你带来更多的麻烦，而不是它的价值。例如，您必须拥有两种不同的 UI——一种用于 GUI，一种用于命令/shell。你将不得不构建一些奇怪的中央逻辑引擎，从 GUI 与命令行中抽象出来，而且它会变得很奇怪。如果是我，我会退后一步考虑如何在实践中使用它，以及这种模式切换是否值得。因此，除非有特殊情况需要，否则我不会自己使用这段代码，因为一旦遇到需要调用 API 来完成某事的情况，我往往会停下来问自己“我是不是把事情复杂化了？ ”。
> 
> 输出类型=Windows 应用程序
> 
> ```
> using System;
> using System.Collections.Generic;
> using System.Windows.Forms;
> using System.Runtime.InteropServices;
> using System.Diagnostics;
> using Microsoft.Win32;
> 
> namespace WindowsApplication
> {
>     static class Program
>     {
>         /*
>     DEMO CODE ONLY: In general, this approach calls for re-thinking 
>     your architecture!
>     There are 4 possible ways this can run:
>     1) User starts application from existing cmd window, and runs in GUI mode
>     2) User double clicks to start application, and runs in GUI mode
>     3) User starts applicaiton from existing cmd window, and runs in command mode
>     4) User double clicks to start application, and runs in command mode.
> 
>     To run in console mode, start a cmd shell and enter:
>         c:\path\to\Debug\dir\WindowsApplication.exe console
>         To run in gui mode,  EITHER just double click the exe, OR start it from the cmd prompt with:
>         c:\path\to\Debug\dir\WindowsApplication.exe (or pass the "gui" argument).
>         To start in command mode from a double click, change the default below to "console".
>     In practice, I'm not even sure how the console vs gui mode distinction would be made from a
>     double click...
>         string mode = args.Length > 0 ? args[0] : "console"; //default to console
>     */
> 
>         [DllImport("kernel32.dll", SetLastError = true)]
>         static extern bool AllocConsole();
> 
>         [DllImport("kernel32.dll", SetLastError = true)]
>         static extern bool FreeConsole();
> 
>         [DllImport("kernel32", SetLastError = true)]
>         static extern bool AttachConsole(int dwProcessId);
> 
>         [DllImport("user32.dll")]
>         static extern IntPtr GetForegroundWindow();
> 
>         [DllImport("user32.dll", SetLastError = true)]
>         static extern uint GetWindowThreadProcessId(IntPtr hWnd, out int lpdwProcessId);
> 
>         [STAThread]
>         static void Main(string[] args)
>         {
>             //TODO: better handling of command args, (handle help (--help /?) etc.)
>             string mode = args.Length > 0 ? args[0] : "gui"; //default to gui
> 
>             if (mode == "gui")
>             {
>                 MessageBox.Show("Welcome to GUI mode");
> 
>                 Application.EnableVisualStyles();
> 
>                 Application.SetCompatibleTextRenderingDefault(false);
> 
>                 Application.Run(new Form1());
>             }
>             else if (mode == "console")
>             {
> 
>                 //Get a pointer to the forground window.  The idea here is that
>                 //IF the user is starting our application from an existing console
>                 //shell, that shell will be the uppermost window.  We'll get it
>                 //and attach to it
>                 IntPtr ptr = GetForegroundWindow();
> 
>                 int  u;
> 
>                 GetWindowThreadProcessId(ptr, out u);
> 
>                 Process process = Process.GetProcessById(u);
> 
>                 if (process.ProcessName == "cmd" )    //Is the uppermost window a cmd process?
>                 {
>                     AttachConsole(process.Id);
> 
>                     //we have a console to attach to ..
>                     Console.WriteLine("hello. It looks like you started me from an existing console.");
>                 }
>                 else
>                 {
>                     //no console AND we're in console mode ... create a new console.
> 
>                     AllocConsole();
> 
>                     Console.WriteLine(@"hello. It looks like you double clicked me to start
>                    AND you want console mode.  Here's a new console.");
>                     Console.WriteLine("press any key to continue ...");
>                     Console.ReadLine();       
>                 }
> 
>                 FreeConsole();
>             }
>         }
>     }
> } 
> ```

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2013-02-26T00:18:29.200

这有点旧（好吧，它很旧），但我现在正在做同样的事情。这是一个对我有用的非常简单的解决方案：

```
[DllImport("kernel32.dll", SetLastError = true)]
static extern bool AllocConsole();

[DllImport("kernel32.dll")]
static extern IntPtr GetConsoleWindow();

[DllImport("user32.dll")]
static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);

const int SW_HIDE = 0;
const int SW_SHOW = 5;

public static void ShowConsoleWindow()
{
    var handle = GetConsoleWindow();

    if (handle == IntPtr.Zero)
    {
        AllocConsole();
    }
    else
    {
        ShowWindow(handle, SW_SHOW);
    }
}

public static void HideConsoleWindow()
{
    var handle = GetConsoleWindow();
    ShowWindow(handle, SW_HIDE);
} 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-01-23T10:12:25.713

最简单的方法是启动 WinForms 应用程序，转到设置并将类型更改为控制台应用程序。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-01-23T09:30:58.043

# 免责声明

有一种方法可以很简单地实现这一点，但我不建议这是一个让其他人看到的应用程序的好方法。但是，如果您有一些开发人员需要同时显示控制台和窗口窗体，则可以很容易地完成。

此方法还支持仅显示控制台窗口，但不支持仅显示 Windows 窗体 - 即始终显示控制台。如果您不显示 windows 窗体，您只能与控制台窗口交互（即接收数据 - `Console.ReadLine()`, ）；`Console.Read()`输出到控制台 - `Console.WriteLine()`- 在两种模式下都有效。

这是按原样提供的；不能保证这以后不会做一些可怕的事情，但它确实有效。

## 项目步骤

从标准**控制台应用程序**开始。

`Main`将方法标记为`[STAThread]`

**在项目中添加对System.Windows.Forms**的引用

 **将 Windows**窗体**添加到您的项目。

将标准 Windows 启动代码添加到您的`Main`方法中：

## 最终结果

您将拥有一个显示控制台和可选窗口窗体的应用程序。

## 示例代码

### 程序.cs

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace ConsoleApplication9 {
    class Program {

        [STAThread]
        static void Main(string[] args) {

            if (args.Length > 0 && args[0] == "console") {
                Console.WriteLine("Hello world!");
                Console.ReadLine();
            }
            else {
                Application.EnableVisualStyles(); 
                Application.SetCompatibleTextRenderingDefault(false); 
                Application.Run(new Form1());
            }
        }
    }
} 
```

### Form1.cs

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace ConsoleApplication9 {
    public partial class Form1 : Form {
        public Form1() {
            InitializeComponent();
        }

        private void Form1_Click(object sender, EventArgs e) {
            Console.WriteLine("Clicked");
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2016-05-10T19:04:56.317

再次复活一个非常古老的线程，因为这里的答案对我来说都不是很好。

我找到了一种看起来非常健壮和简单的简单方法。它对我有用。想法：

*   将您的项目编译为 Windows 应用程序。当您的可执行文件启动时，可能会有一个父控制台，但可能没有。目标是重用现有控制台（如果存在），或者创建一个新控制台（如果不存在）。
*   AttachConsole(-1) 将寻找父进程的控制台。如果有一个，它会附在它上面，你就完成了。（我试过这个，当从 cmd 调用我的应用程序时它工作正常）
*   如果 AttachConsole 返回 false，则没有父控制台。使用 AllocConsole 创建一个。

例子：

```
static class Program
{
    [DllImport( "kernel32.dll", SetLastError = true )]
    static extern bool AllocConsole();

    [DllImport( "kernel32", SetLastError = true )]
    static extern bool AttachConsole( int dwProcessId );

    static void Main(string[] args)
    {
        bool consoleMode = Boolean.Parse(args[0]);
        if (consoleMode)
        {
           if (!AttachConsole(-1))
              AllocConsole();
           Console.WriteLine("consolemode started");
           // ...
        } 
        else
        {
           Application.EnableVisualStyles();
           Application.SetCompatibleTextRenderingDefault(false);
           Application.Run(new Form1());
        }
    }
} 
```

提醒一句：如果您在附加或分配控制台之前尝试写入控制台，这种方法似乎不起作用。我的猜测是您第一次调用 Console.Write/WriteLine 时，如果还没有控制台，那么 Windows 会自动在某处为您创建一个隐藏的控制台。（所以也许安东尼的 ShowConsoleWindow 答案在你已经写到控制台之后会更好，如果你还没有写到控制台，我的答案会更好）。需要注意的重要一点是，这不起作用：

```
static void Main(string[] args)
    {
        Console.WriteLine("Welcome to the program");   //< this ruins everything
        bool consoleMode = Boolean.Parse(args[0]);
        if (consoleMode)
        {
           if (!AttachConsole(-1))
              AllocConsole();
           Console.WriteLine("consolemode started");   //< this doesn't get displayed on the parent console
           // ...
        } 
        else
        {
           Application.EnableVisualStyles();
           Application.SetCompatibleTextRenderingDefault(false);
           Application.Run(new Form1());
        }
    } 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-24T23:44:40.753

检查此源代码。所有注释代码 - 用于在 Windows 应用程序中创建控制台。未注释 - 在控制台应用程序中隐藏控制台。从[这里](https://github.com/abatishchev/reg2run/blob/master/ManualConsole.cs)。（以前~~[在这里](http://reg2run.svn.sourceforge.net/viewvc/reg2run/trunk/ManualConsole.cs?view=markup)~~。）项目`reg2run`。

```
// Copyright (C) 2005-2015 Alexander Batishchev (abatishchev at gmail.com)

using System;
using System.ComponentModel;
using System.Runtime.InteropServices;

namespace Reg2Run
{
    static class ManualConsole
    {
        #region DllImport
        /*
        [DllImport("kernel32.dll", CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall, SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool AllocConsole();
        */

        [DllImport("kernel32.dll", CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall, SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool CloseHandle(IntPtr handle);

        /*
        [DllImport("kernel32.dll", CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall, SetLastError = true)]
        private static extern IntPtr CreateFile([MarshalAs(UnmanagedType.LPStr)]string fileName, [MarshalAs(UnmanagedType.I4)]int desiredAccess, [MarshalAs(UnmanagedType.I4)]int shareMode, IntPtr securityAttributes, [MarshalAs(UnmanagedType.I4)]int creationDisposition, [MarshalAs(UnmanagedType.I4)]int flagsAndAttributes, IntPtr templateFile);
        */

        [DllImport("kernel32.dll", CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall, SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool FreeConsole();

        [DllImport("kernel32.dll", CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall, SetLastError = true)]
        private static extern IntPtr GetStdHandle([MarshalAs(UnmanagedType.I4)]int nStdHandle);

        /*
        [DllImport("kernel32.dll", CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall, SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool SetStdHandle(int nStdHandle, IntPtr handle);
        */
        #endregion

        #region Methods
        /*
        public static void Create()
        {
            var ptr = GetStdHandle(-11);
            if (!AllocConsole())
            {
                throw new Win32Exception("AllocConsole");
            }
            ptr = CreateFile("CONOUT$", 0x40000000, 2, IntPtr.Zero, 3, 0, IntPtr.Zero);
            if (!SetStdHandle(-11, ptr))
            {
                throw new Win32Exception("SetStdHandle");
            }
            var newOut = new StreamWriter(Console.OpenStandardOutput());
            newOut.AutoFlush = true;
            Console.SetOut(newOut);
            Console.SetError(newOut);
        }
        */

        public static void Hide()
        {
            var ptr = GetStdHandle(-11);
            if (!CloseHandle(ptr))
            {
                throw new Win32Exception();
            }
            ptr = IntPtr.Zero;
            if (!FreeConsole())
            {
                throw new Win32Exception();
            }
        }
        #endregion
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-09-18T18:47:39.227

对我有用的是单独编写一个控制台应用程序来完成我想要它做的事情，将它编译成一个 exe，然后做`Process.Start("MyConsoleapp.exe","Arguments")`

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-02T20:01:29.647

实际上，在 GUI 应用程序中带有 SetStdHandle 的 AllocConsole 可能是一种更安全的方法。已经提到的“控制台劫持”的问题在于，控制台可能根本不是前台窗口（尤其是考虑到 Vista/Windows 7 中新窗口管理器的涌入）等等。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-08-18T12:14:02.423

还有一个迟来的答案。根据之前的建议，我无法将任何输出发送到使用创建的控制台`AllocConsole`，因此我从*Console application*开始。然后，如果不需要控制台：

```
 [DllImport("kernel32.dll")]
        private static extern IntPtr GetConsoleWindow();

        [DllImport("user32.dll")]
        private static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);

        private const int SW_HIDE = 0;
        private const int SW_SHOW = 5;

        [DllImport("user32.dll", SetLastError = true)]
        static extern uint GetWindowThreadProcessId(IntPtr hWnd, out int lpdwProcessId);

        public static bool HideConsole()
        {
            var hwnd = GetConsoleWindow();
            GetWindowThreadProcessId(hwnd, out var pid);

            if (pid != Process.GetCurrentProcess().Id) // It's not our console - don't mess with it.
                return false;

            ShowWindow(hwnd, SW_HIDE);

            return true;
        } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-23T08:50:49.047

在 wind32 中，控制台模式应用程序与通常的消息队列接收应用程序完全不同。它们的声明和编译方式不同。您可以创建一个同时具有控制台部分和普通窗口的应用程序并隐藏其中一个。但怀疑你会发现整个事情比你想象的要多一些。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-11-15T11:56:40.817

根据上面 Jeffrey Knight 的引用，一旦我遇到需要调用 API 来完成某事的情况，我往往会停下来问自己“我是不是把事情复杂化了？”。

如果想要拥有一些代码并在 Windows GUI 模式或控制台模式下运行它，请考虑将在这两种模式下使用的代码移至代码库 DLL，然后拥有一个使用该 DLL 的 Windows 窗体应用程序和一个控制台使用该 DLL 的应用程序（即，如果在 Visual Studio 中，您现在有一个三项目解决方案：包含大量代码的库、仅包含 Win Forms 代码的 GUI，以及仅包含您的控制台代码的控制台。）

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-06-11T12:27:39.473

创建一个 Windows 窗体应用程序。在应用程序中设置项目属性以键入控制台应用程序。该程序将打开一个控制台窗口并显示表格。

从表单或 Program.cs调用`Console.Writeline()`以将消息发送到控制台窗口。

您可以在 Program.cs 中发表评论

```
// Application.EnableVisualStyles();
// Application.SetCompatibleTextRenderingDefault(false);
// Application.Run(new Form1()); 
```

避免使用 Form1。

使用 C# 和 VS2019 测试。

# .net - ToolStrip 有时不响应鼠标单击

> ID：472301
> 
> 赞同：10
> 
> 时间：2009-01-23T08:59:07.047
> 
> 标签：.net, winforms, toolstrip

我的主窗体上有一个带有 ToolStrip 的 .NET 2.0 WinForms 应用程序。有时，ToolStrip 图标不会响应第一次鼠标单击，因此我必须单击该图标两次。它只是一个带有几个图标和工具提示文本的标准 ToolStrip，我没有做任何特别的事情。这很常见吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-12-12T10:25:58.010

前段时间我也遇到过同样的问题，我在[Rick Brewster 的博客](http://blogs.msdn.com/rickbrew/archive/2006/01/09/511003.aspx)中找到了解决方案。这个想法是在派生类 ToolStripEx 中覆盖“WndProc”。该解决方案的核心如下所示：

```
protected override void WndProc(ref Message m)
{
    base.WndProc(ref m);

    if (m.Msg == NativeConstants.WM_MOUSEACTIVATE &&
        m.Result == (IntPtr)NativeConstants.MA_ACTIVATEANDEAT)
    {
        m.Result = (IntPtr)NativeConstants.MA_ACTIVATE;
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T09:04:48.130

我在其他开发环境（VB6）中也有过这种情况，结果证明是因为第一次单击被工具栏吸收以获取焦点。或者，换句话说，工具栏在获得焦点*之前不会响应单击。*要对此进行测试，请在单击按钮之前尝试单击工具栏的空白部分。如果您在单击工具栏后不必再单击按钮两次，那么这可能就是问题所在。我认为我解决了这个问题（这是几年前的事了，所以请原谅黑客攻击）是以编程方式将焦点放在 MouseOver 事件中的工具栏上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-11-11T12:44:20.973

您可以创建自己的从 ToolStrip 继承的类，并使用自定义属性`ClickThrough`来打开或关闭行为：

```
Public Class ToolStripExtended : Inherits ToolStrip
    Private Const WM_MOUSEACTIVATE As UInteger = &H21
    Private Const MA_ACTIVATE As UInteger = 1
    Private Const MA_ACTIVATEANDEAT As UInteger = 2
    Private Const MA_NOACTIVATE As UInteger = 3
    Private Const MA_NOACTIVATEANDEAT As UInteger = 4

    Private _clickThrough As Boolean = False

    Public Sub New()
        MyBase.New()
    End Sub

    ''' <summary>
    ''' Gets or sets whether the ToolStripEx honours item clicks when its containing form does
    ''' not have input focus.
    ''' </summary>
    ''' <remarks>
    ''' Default value is false, which is the same behaviour provided by the base ToolStrip class.
    ''' </remarks>
    Public Property ClickThrough() As Boolean
        Get
            Return Me._clickThrough
        End Get

        Set(value As Boolean)
            Me._clickThrough = value
        End Set
    End Property

    Protected Overrides Sub WndProc(ByRef m As Message)
        MyBase.WndProc(m)

        If _clickThrough AndAlso m.Msg = WM_MOUSEACTIVATE AndAlso m.Result = New IntPtr(MA_ACTIVATEANDEAT) Then
            m.Result = New IntPtr(MA_ACTIVATE)
        End If
    End Sub
End Class 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T09:20:27.520

如果应用程序窗口没有获得焦点，您必须单击 ToolStrip 按钮两次。第一次单击将焦点设置到窗口，第二次引发单击事件。这是（不幸的是）默认行为，这是设计使然。Microsoft Word 显示相同的行为（即使 .NET ToolStrip 不是同一个控件）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-01-23T20:35:01.073

这是@Doc Brown 解决方案的实现：

```
public class ToolStripX : ToolStrip
{
    private const int WM_MOUSEACTIVATE = 0x0021;
    private const int MA_ACTIVATEANDEAT = 2;
    private const int MA_ACTIVATE = 1;

    protected override void WndProc(ref Message m)
    {
        base.WndProc(ref m);

        if (m.Msg == WM_MOUSEACTIVATE &&
            m.Result == (IntPtr)MA_ACTIVATEANDEAT)
        {
            m.Result = (IntPtr)MA_ACTIVATE;
        }
    }
} 
```

# android - Android：反向地理编码 - getFromLocation

> ID：472313
> 
> 赞同：54
> 
> 时间：2009-01-23T09:08:54.937
> 
> 标签：android, reverse-geocoding, street-address

我正在尝试根据 long/lat 获取地址。似乎这样的事情应该有效？

```
Geocoder myLocation = Geocoder(Locale.getDefault());
    List myList = myLocation.getFromLocation(latPoint,lngPoint,1); 
```

问题是我不断收到： 对于 savemaplocation 类型的方法 Geocoder(Locale) 未定义

任何帮助都会有所帮助。谢谢你。

* * *

谢谢，我尝试了上下文，首先尝试了语言环境，但失败了，正在查看其他一些构造函数（我见过一个只提到语言环境的构造函数）。不管，

它没有用，因为我仍然得到：方法 Geocoder(Context, Locale) 未定义类型 savemaplocation

我确实有：导入 android.location.Geocoder；

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-01-25T00:58:21.620

下面的代码片段是为我做的（lat 和 lng 是在这个位之上声明的双精度）：

```
Geocoder geocoder = new Geocoder(this, Locale.getDefault());
List<Address> addresses = geocoder.getFromLocation(lat, lng, 1); 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2011-02-12T22:35:04.507

这是一个完整的示例代码，使用 Thread 和 Handler 在不阻塞 UI 的情况下获取 Geocoder 答案。

Geocoder 调用过程，可以位于一个 Helper 类中

```
public static void getAddressFromLocation(
        final Location location, final Context context, final Handler handler) {
    Thread thread = new Thread() {
        @Override public void run() {
            Geocoder geocoder = new Geocoder(context, Locale.getDefault());   
            String result = null;
            try {
                List<Address> list = geocoder.getFromLocation(
                        location.getLatitude(), location.getLongitude(), 1);
                if (list != null && list.size() > 0) {
                    Address address = list.get(0);
                    // sending back first address line and locality
                    result = address.getAddressLine(0) + ", " + address.getLocality();
                }
            } catch (IOException e) {
                Log.e(TAG, "Impossible to connect to Geocoder", e);
            } finally {
                Message msg = Message.obtain();
                msg.setTarget(handler);
                if (result != null) {
                    msg.what = 1;
                    Bundle bundle = new Bundle();
                    bundle.putString("address", result);
                    msg.setData(bundle);
                } else 
                    msg.what = 0;
                msg.sendToTarget();
            }
        }
    };
    thread.start();
} 
```

以下是您的 UI Activity 中对此 Geocoder 过程的调用：

```
getAddressFromLocation(mLastKownLocation, this, new GeocoderHandler()); 
```

以及在您的 UI 中显示结果的处理程序：

```
private class GeocoderHandler extends Handler {
    @Override
    public void handleMessage(Message message) {
        String result;
        switch (message.what) {
        case 1:
            Bundle bundle = message.getData();
            result = bundle.getString("address");
            break;
        default:
            result = null;
        }
        // replace by what you need to do
        myLabel.setText(result);
    }   
} 
```

不要忘记将以下权限放入您的`Manifest.xml`

```
<uses-permission android:name="android.permission.INTERNET" /> 
```

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2009-01-23T10:25:25.110

看起来这里发生了两件事。

1）您`new`在调用构造函数之前错过了关键字。

2）您传递给 Geocoder 构造函数的参数不正确。您正在传递 a`Locale`它期望 a 的地方`Context`。

有两个`Geocoder`构造函数，它们都需要 a `Context`，一个也需要 a `Locale`：

```
Geocoder(Context context, Locale locale)
Geocoder(Context context) 
```

**解决方案**

修改您的代码以传入有效的 Context 并包含`new`，您应该一切顺利。

```
Geocoder myLocation = new Geocoder(getApplicationContext(), Locale.getDefault());   
List<Address> myList = myLocation.getFromLocation(latPoint, lngPoint, 1); 
```

**笔记**

如果您仍然遇到问题，则可能是权限问题。地理编码隐式使用 Internet 来执行查找，因此您的应用程序将需要`INTERNET`清单中的 uses-permission 标签。

`manifest`在清单的节点中添加以下 uses-permission 节点。

```
<uses-permission android:name="android.permission.INTERNET" /> 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-10-07T07:40:28.790

原因是不存在后端服务：

> > Geocoder 类需要一个不包含在核心 android 框架中的后端服务。如果平台中没有后端服务，Geocoder 查询方法将返回一个空列表。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-06-01T12:41:06.270

首先使用 Location 和 LocationManager 类获取纬度和经度。现在尝试下面的代码获取城市，地址信息

```
double latitude = location.getLatitude();
double longitude = location.getLongitude();
Geocoder gc = new Geocoder(this, Locale.getDefault());
try {
    List<Address> addresses = gc.getFromLocation(lat, lng, 1);
    StringBuilder sb = new StringBuilder();
    if (addresses.size() > 0) {
        Address address = addresses.get(0);
        for (int i = 0; i < address.getMaxAddressLineIndex(); i++)
            sb.append(address.getAddressLine(i)).append("\n");
            sb.append(address.getLocality()).append("\n");
            sb.append(address.getPostalCode()).append("\n");
            sb.append(address.getCountryName());
    } 
```

城市信息现在在某人。现在将 sb 转换为 String（使用 sb.toString() ）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-23T23:06:51.580

好吧，我仍然很难过。所以这里有更多代码。

在我离开我的地图之前，我调用`SaveLocation(myMapView,myMapController);`了这最终调用了我的地理编码信息。

但是由于`getFromLocation`可以抛出一个`IOException`，我不得不执行以下操作来调用 SaveLocation

```
try
{
    SaveLocation(myMapView,myMapController);
}
catch (IOException e) 
{
    // TODO Auto-generated catch block
    e.printStackTrace();
} 
```

然后我必须通过说它抛出 IOExceptions 来更改 SaveLocation ：

```
 public void SaveLocation(MapView mv, MapController mc) throws IOException{
    //I do this : 
    Geocoder myLocation = new Geocoder(getApplicationContext(), Locale.getDefault());   
    List myList = myLocation.getFromLocation(latPoint, lngPoint, 1);
//...
    } 
```

而且每次都会崩溃。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-11-07T13:36:00.067

用这个

```
Geocoder geocoder = new Geocoder(this, Locale.getDefault());
List<Address> addresses = geocoder.getFromLocation(lat, lng, 1); 
```

# .net - 为什么单击解决方案资源管理器刷新按钮时 Visual Studio 不刷新文件夹？

> ID：472316
> 
> 赞同：61
> 
> 时间：2009-01-23T09:10:27.447
> 
> 标签：.net, visual-studio, solution-explorer

在 Visual Studio 2008 中，我可以在我的解决方案资源管理器中看到我的所有项目文件，并且这些文件存在于一个实际的目录中。

但是，如果我将文件添加到该目录（比如说，App_Data 文件夹中的 test.sqlite 文件，或者说，由其他程序创建的图像），那么这些文件不会出现在我的解决方案资源管理器中，即使我单击刷新按钮。

如何使其他应用程序创建的文件出现在我的解决方案资源管理器中？

（到目前为止，我必须在其他地方创建它们，然后将它们复制并粘贴到解决方案资源管理器本身中，但必须有更简单的方法）。

* * *

### 编辑：

这种“假解决方案视图”是否有优势，即我可以在我的 App_Data 目录中有一个文件“test.sqlite”，但在我的解决方案中，它可能出现在我的根目录中。来自 Eclipse WYSIWYG 解决方案资源管理器的思维方式，我看不到在目录中拥有有关实际文件的额外虚拟元信息的优势。有没有办法从这个比喻中获得优势？

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2009-01-23T09:25:47.307

解决方案资源管理器的顶部是一个切换按钮“显示所有文件”，这使它包括显示中的所有文件，即使它们未包含在项目中。这些图标将变灰一点。然后只需使用上下文菜单将这些添加到项目中。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-23T09:15:44.503

在解决方案上，单击鼠标右键并选择“添加现有项目”并从解决方案根目录中选择文件。解决方案现在将获得一个包含您的文件的“解决方案项目”目录。这个目录是虚拟的，所以它在磁盘上不存在。

但是，解决方案没有像“显示所有文件”这样的功能，这只适用于项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-03-05T10:35:00.913

我遇到了同样的问题。我添加了新的文件和文件夹，但是下次我从 SVN 获取最新的源代码然后打开项目时，它不会显示添加的文件。

您可以执行以下步骤： 1\. 解决方案资源管理器 -> 显示所有文件 2\. 最近添加的文件将在左侧不显示 [@] 图标。右键单击该文件并选择包含在项目中 3\. 如果您在 Web 文件夹下看到配置文件 Web（Visual C# 项目文件 (.csproj)），您将看到为这些新文件创建的条目。在你的 svn.xml 中签入这个配置文件。4\. 下次你进行 repo checkout 时，它不会成为问题，因为文件详细信息已添加到配置中。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-08-29T06:21:48.947

在**解决方案资源**管理器最**右上方的图标**（显示所有文件）上，按下它，您将看到文件可见，然后右键单击该文件并选择：将其包含到项目中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-06-24T17:40:45.263

如今，您可以使用 TF 命令行来执行此操作。

*   运行开发人员命令提示符（在 VS 中是`tools`, `command line`, `developer command prompt`; 或者您通常可以在开始菜单的`Visual Studio Tools`文件夹下找到快捷方式）。
*   导航到项目的根文件夹（即您希望所有内容同步到源代码管理的文件夹）
*   运行`tf add * /recursive`以选择所有内容/将其全部推送到项目中。[tf 文档](https://docs.microsoft.com/en-us/azure/devops/repos/tfvc/add-command?view=azure-devops)中记录的其他选项。
*   使用`Team Explorer`窗格的`Pending Changes`部分通过 UI 进行您可能希望的任何调整。
*   签入您的更改

# jsp - JSP - 将设计与逻辑分开

> ID：472323
> 
> 赞同：0
> 
> 时间：2009-01-23T09:16:46.030
> 
> 标签：jsp, architecture

我刚开始编写一些 JSP，我发现它与 asp.net 或任何其他“真正的”网络语言/网络网关并没有什么不同。我发现了这个问题；[构造 JSP/Java 代码，其中逻辑不在 JSP 文件](https://stackoverflow.com/questions/299666/structure-jsp-java-code-where-logic-is-not-in-the-jsp-file)中。但是我觉得它没有帮助。

我的日常工作包含 ASP.NET MVC 开发，这确实是我开发网页的最佳方式。所以我想找到一个 JSP MVC，但是我有一些特定的标准，我不想在 Web 服务器上安装一些东西或在系统上安装任何包以使其工作，如果我通过一些就可以了jar 与我的版本一起发布，但是它们必须是免费使用和开源的。

如果没有任何好的 MVC，如果你想将代码与设计分开，你主要怎么做？非常像 C# 中的代码背后？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T10:53:04.713

[在我看来， Spring](http://www.springframework.org)的 web MVC 非常好。还有很多其他很棒的东西，但如果这就是你想要的，我会考虑的。

[Wicket](http://wicket.apache.org/)应该很简单，但我自己没有用过。

一旦你有了这些，我建议你学习 [JSTL][3] 以将 scriptlet 排除在页面之外，使用[CSS](http://www.w3schools.com/css/)将内容与样式分离，以及使用复合和装饰器模式组合页面的[SiteMesh](http://www.opensymphony.com/sitemesh/)。

[3]：[http](https://rads.stackoverflow.com/amzn/click/com/0596005636) ://www.amazon.com/JavaServer-Pages-3rd-Hans-Bergsten/dp/0596005636/ref=sr_1_1?ie=UTF8&s=books&qid=1232708134& sr=8-1 “Hans Bergsten 是最好的”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T09:22:00.997

有很多 MVC 框架，几乎有太多的选择。

检查： [谁能推荐一个简单的 Java web-app 框架？](https://stackoverflow.com/questions/116978/can-anyone-recommend-a-simple-java-web-app-framework)

# c - 计算无符号整数中位转换数的最快方法

> ID：472325
> 
> 赞同：6
> 
> 时间：2009-01-23T09:17:15.093
> 
> 标签：c, bit, counting

我正在寻找计算`unsigned int`.

如果 int 包含： `0b00000000000000000000000000001010`

转换次数为：4

如果 int 包含： `0b00000000000000000000000000001001`

转换次数为：3

语言是C。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-23T09:31:07.250

```
int numTransitions(int a)
{
  int b = a >> 1; // sign-extending shift properly counts bits at the ends
  int c = a ^ b;  // xor marks bits that are not the same as their neighbors on the left
  return CountBits(c); // count number of set bits in c
} 
```

有关[CountBits](http://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetParallel)的有效实现，请参阅[http://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetParallel](http://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetParallel)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T09:29:01.747

最快取决于您的情况：当您将数据类型指定为常量大小（无符号整数）时，可以使用查找表。但是，当您仅在初始化表的恒定开销太大时才需要此操作时，尽管通过 int 进行扫描+计数要快得多。

我想总体上最好的组合是：查找表以查找一个字节或一个字（256 或 64k 个条目不是那么多），然后按字节/字的最后一位/第一位组合字节/字。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T09:56:34.453

在 C/C++ 中，我会执行以下操作：

```
unsigned int Transitions(unsigned int value)
{
    unsigned int result = 0;

    for (unsigned int markers = value ^ (value >> 1); markers; markers = markers >> 1)
    {
        if (markers & 0x01) result++;
    }

    return result;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-24T01:14:31.243

这是使用算术移位 + xor 和 Kernighan 的位计数方法的代码：

```
int count_transitions(int x)
{
    assert((-1 >> 1) < 0); // check for arithmetic shift
    int count = 0;
    for(x ^= (x >> 1); x; x &= x - 1)
        ++count;
    return count;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T09:20:57.143

什么语言？

我会循环 64 次，然后对您的数字进行位移以检查这些位，然后存储前一个位并将其与当前位进行比较。如果它不同，请增加您的计数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T09:24:25.250

好的，对于转换，您的意思是，如果您遍历 0-s 和 1-s 的字符串，您会计算 0 跟随 1 或 1 跟随 0 的每次出现。

这很容易通过移出位并计算变化：

```
transitions(n)
  result = 0
  prev = n mod 2
  n = n div 2
  while n<>0 
    if n mod 2 <> prev then
      result++
      prev = n mod 2
    fi
    n = n div 2
  elihw
  return result 
```

您可以用班次替换 mod 和 div。

# java - 美化 Java XML 输出

> ID：472326
> 
> 赞同：5
> 
> 时间：2009-01-23T09:17:15.700
> 
> 标签：java, xml

我有一个关于 Java 的 XML API 的简单问题，我希望也有一个简单的答案：

可以说，处理后我有以下 XML 输出：

```
<a>
    <b><c>
    <d> <e> some content
        </e>    </d>
    </c>    </b>
</a> 
```

结构是正确的，但空格到处都是。问题是我怎样才能美化输出，使它看起来像这样：

```
<a>
    <b>
        <c> 
            <d>
                <e>some content</e>
            </d>
        </c>
    </b>
</a> 
```

唯一要注意的是，除了 Java 5 自己的 XML API，我什么都不能使用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T09:31:16.640

使用[变压器](http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Transformer.html)。[setOutputProperty](http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Transformer.html#setOutputProperty(java.lang.String,%20java.lang.String))（[OutputKeys](http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/OutputKeys.html) [.INDENT](http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/OutputKeys.html#INDENT)，“是”）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-10T22:49:06.120

试试这个。

```
transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2") 
```

这对我也不起作用。怎么回事？java版本“1.6.0_29”

```
Transformer.setOutputProperty(OutputKeys.INDENT, "yes") 
```

# c++ - 如何同步访问 NAS 上的文件的两个进程？

> ID：472329
> 
> 赞同：6
> 
> 时间：2009-01-23T09:19:36.070
> 
> 标签：c++, concurrency, synchronization, mutex, nas

事情是这样的：我有两个应用程序，用 C++ 编写并在两台具有不同操作系统的机器上运行（一台 Linux 和一台 Windows）。其中一个过程负责更新 NAS（网络附加存储）上的 XML 文件，而另一个则读取该文件。

是否可以同步这两个进程以避免在修改文件的同时读取文件？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-23T09:33:14.703

您可以在执行写入之前创建的服务器上创建一个锁定文件，等待然后写入并在完成时删除。在读取文件之前让读取过程检查令牌。

**编辑**：为了解决评论，您可以实现双重检查锁定类型模式。让读者和作者都有一个锁定文件并在工作之前仔细检查，例如：

Reader：检查写锁定文件，创建读锁定文件，检查写锁定文件，如果存在则删除读文件并中止。

Writer：检查读锁定文件，创建写锁定文件，检查读锁定文件，如果存在则删除写锁定文件并中止。

这将阻止您的进程相互践踏，但可能会发生潜在的竞争条件，因为您可能会同时检查、创建和重新检查两个进程，但这不会导致数据以不一致的状态读取，但会导致两个进程都读取并编写进程以中止您指定的延迟

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T09:03:03.690

谢谢大家的答案。

最后我们设法解决了我们的问题，不是通过使用操作系统的锁定命令（因为我们不确定它们是否会正确传播到 NAS 头的操作系统），而是通过创建锁定目录而不是锁定文件。目录创建是原子操作，如果文件夹已经存在则返回错误值。因此，我们不必在获取锁之前检查它是否存在，这两个操作都是一步完成的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T13:05:56.380

好的，您需要某种形式的锁定机制来控制访问。

大多数 *nix 文件系统都提供此功能。我怀疑它在 Windows 文件系统上也可用（因为 perl 使用了这种机制），但它可能有另一个名称。

看一下flock()。
这是一种文件锁定机制。它是一种建议锁，因此它实际上不会锁定文件并阻止使用，但它提供了一种标记文件的机制。如果两个应用程序都使用该机制，那么您可以控制对文件的访问。

flock() 提供共享锁（或读锁）和排他锁（或写锁）。flock 将阻塞您的线程（以非忙碌方式），直到用户解锁文件（它还提供非阻塞检查，因此您可以在等待时做其他事情）。

查看手册页第 2 节中的羊群。

```
int     flock(int fd, int operation);

Flock() applies or removes an advisory lock on the file associated with the file
descriptor fd.  A lock is applied by specifying an operation parameter that is
one of LOCK_SH or LOCK_EX with the optional addition of LOCK_NB.  To unlock an
existing lock operation should be LOCK_UN. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T09:40:34.670

如果文件驻留在 NFS 共享上，您可以使用[fcntl(2)](http://www.manpagez.com/man/2/fcntl/)锁定文件。检查[Linux NFS FAQ](http://nfs.sourceforge.net/)中的问题*D10*。我对 Windows API 的经验很少，但据我所知，它们具有良好的 POSIX 支持，因此只要它们支持 POSIX.1-2001，您就应该能够使用 fcntl。

如果您使用不同的协议（即 AFS 或 SMB）访问文件，也许您可​​以设置一个简单的同步服务器，通过 IPC 接口管理锁？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T09:53:23.740

是否可以从文件切换到数据库？

DBMS 可以很好地管理这种类型的并发性。它不需要昂贵或难以安装。MySql、Postgress 或 JavaDB 都可以以很少或没有成本优雅地处理这个问题。

如果数据库选项失败，我会让写入过程写入“隐藏”文件名，如“.updateinprogress.xml”，并在更新完成后重命名文件。在大多数系统上，“mv”或“ren”是一个原子操作，因此读取过程要么选择旧文件，要么选择新文件，但从来没有写过一半。

# build - InstallShield 运行时？

> ID：472337
> 
> 赞同：4
> 
> 时间：2009-01-23T09:24:13.410
> 
> 标签：build, runtime, installshield

我们在一个系统上安装了 InstallShield 2009 Premier，用于创建和编译设置（单机许可证）。

但是，我们正在尝试通过使用 Team Foundation Build Server 进行夜间构建来创建一键式构建体验。我们也想集成设置文件的生成。

我知道 CodePlex 上有一个开源包，其中包含一个自定义构建任务，用于自动生成基于 installshield 的设置（通过提交 .ism 文件和其他内容）。

是否有类似 installshield 运行时的东西可以安装在我们的构建服务器上，它什么都不做，然后从没有 UI 或其他任何东西的 ism 文件创建设置，这样我们就不必购买另一个许可证？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T15:19:04.867

InstallShield Premier 包括一个[独立的 Builder](http://helpnet.acresso.com/robo/projects/HelpLibDevStudio9/StandAloneBuild.htm)命令行工具，您可以将其安装在构建服务器上并用作自动化过程的一部分。

我不记得它是否在 CD 上，或者您是否需要通过 InstallShield 更新下载它。

请注意，这不再包含在专业版中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-15T18:48:35.743

对于 TFS 集成，您需要 InstallShield 2011，因为它现在可以与 TFS2010 一起使用，并且只要您用于构建的机器具有 TFS 构建代理和 installshield Standalone 构建或 InstallShield Pro/Premier 版本，它就会正确构建。生成的安装也将被复制到 TFS 放置文件夹。

# c# - 自定义架构验证行为 - XmlReaderSettings

> ID：472346
> 
> 赞同：0
> 
> 时间：2009-01-23T09:26:15.730
> 
> 标签：c#, xml, validation, schema, xmlreader

我正在使用带有事件处理设置的 XMLReaderSettings 对象使用 XMLReader 解析 XML，以在适当的情况下执行架构验证。

但是，似乎每个 XML 级别的错误捕获只发生一次。这意味着该级别的任何后续错误都将被忽略。

有什么方法可以让每次发生错误时触发错误处理事件。

编辑：我也尝试过 XmlSchemaValidator 但这不成功。仅捕获标签正文中的第一个错误。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T09:17:33.737

这对验证器来说并不容易：发生错误后，它不知道上下文，因此无法验证后续节点。看看这个答案：[Validating XML tag by tag](https://stackoverflow.com/questions/476364/validating-xml-tag-by-tag/493095#493095)

# java - 将自动构建从 2-cpu 比萨盒重新扩展到多 cpu 怪物？

> ID：472347
> 
> 赞同：1
> 
> 时间：2009-01-23T09:26:19.520
> 
> 标签：java, build-automation, bamboo

我们当前的自动化构建包括 1 个主盒和 4 个 core-2-duo Pizza 盒装（大约 2.5Ghz），每个都有 3 GB 内存，都运行 Ubuntu Linux。（使用[竹子](http://www.atlassian.com/software/bamboo/)）

我被要求重新校准它以便在一个或多个 Solaris 机器上运行。我们当前的构建包括 java 构建、长时间运行的集成测试构建和自动化 Selenium 测试的混合——一个相当典型的大型项目构建。我们当前的环境有足够的容量，我们可能会毫无问题地失去一个核心左右。

我们正在研究具有“大量”内存（16-32GB？我可以选择）的 8 个 CPU Solaris 机器。或者可能是几台 4 CPU 机器？

我可以期望行为在单个框中以相当线性的方式扩展吗？我在这里寻找实际经验；关于 IO 如何成为问题的“理论”观察并不是很有趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-24T07:18:07.923

实际上，我发现构建大部分时间都在做某种 IO。因此，增加 CPU 的数量并没有您想象的那么大。但是，额外的机器将拥有额外的磁盘和网络带宽。所以他们可能会提供更多帮助。但是，您可以改进单个盒子的配置并可能获得相同的性能。

您通常一次运行多少个构建？如果您现在通常有 2 个构建排队（并且 2 个正在运行），那么同时运行四个构建是一种改进。但除此之外不会有太大的不同。

如今，具有 64 GB 内存的八核机器令人惊讶地成为新服务器的标准配置。在这种配置中，我建议使用 SSD 驱动器来缩短磁盘访问时间并运行四到八个构建器/代理，如果您通常在任何时间或更少时间等待八个构建，这可能就足够了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T11:07:18.153

如果您的测试运行时间很长，您可能会受益于两个构建，一个运行所有快速测试的快速构建，一个可能只在夜间运行的较慢的完整构建。

# com - Debugging COMException

> ID：472348
> 
> 赞同：2
> 
> 时间：2009-01-23T09:26:41.453
> 
> 标签：com, activex, comexception

I am using an ancient Intergraph routing library to do some routing.

I could create several ActiveX and COM objects just fine but there is this one type "Location" and "LocationCtrl" that throws a COMException on creation.

Here's the relevant code

```
_sourceLocation.Streets = _streets;
_sourceLocation.VerifyAutomatic = fa_sourceLocationse;
_sourceLocation.VerifyType = VerifyTypeConstants.VerifyUsingA_sourceLocation_sourceLocation;
_sourceLocation.ReplaceTextAfterParse = true;
_sourceLocation.ReplaceTextAfterVerify = true;
_sourceLocation.Map = _mapOcx; 
```

The COMException was thrown upon setting the Streets property.

Here's the exception:

```
System.Runtime.InteropServices.COMException was unhandled
  Message="Catastrophic failure (Exception from HRESULT: 0x8000FFFF (E_UNEXPECTED))"
  Source="mscorlib"
  ErrorCode=-2147418113
  StackTrace:
       at System.RuntimeType.ForwardCallToInvokeMember(String memberName, BindingFlags flags, Object target, Int32[] aWrapperTypes, MessageData& msgData)
       at Intergraph.LocationCtrlClass.set_Streets(Object )
       at ECNavigator.Routing.<InitializeRouting>b__0(LocationCtrl l) in C:\Users\Chakrit\Projects\NavigatorService\Experimental\Routing.cs:line 92
       at ECNavigator.Util.FrameworkExtensions.ForEach[T](IEnumerable`1 enum, Action`1 action) in C:\Users\Chakrit\Projects\NavigatorService\Experimental\Util\FrameworkExtensions.cs:line 18
       at ECNavigator.Routing.InitializeRouting() in C:\Users\Chakrit\Projects\NavigatorService\Experimental\Routing.cs:line 90
       at ECNavigator.Routing..ctor(String mapFile, LocationCtrl sourceLocation, LocationCtrl destinationLocation) in C:\Users\Chakrit\Projects\NavigatorService\Experimental\Routing.cs:line 62
       at ECNavigator.Program.Main() in C:\Users\Chakrit\Projects\NavigatorService\Experimental\Program.cs:line 23
       at System.AppDomain._nExecuteAssembly(Assembly assembly, String[] args)
       at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)
       at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()
       at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
       at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
       at System.Threading.ThreadHelper.ThreadStart()
  InnerException: 
```

The entire application is extremely simple, it contained only code that initialize some of the supporting objects, however this particular `Location` type would initialize just fine but on first invocation of property getters/setters, it would throw the above exception.

I have been debugging this for a few days already and havn't found a way to instantiate and initialize the `Location` class properly.

Any clue? Some pointers on how to further investigate this?

# c# - WCF 中使用非单向方法的竞争条件

> ID：472351
> 
> 赞同：2
> 
> 时间：2009-01-23T09:28:07.693
> 
> 标签：c#, .net, wcf, race-condition, nettcpbinding

我正在设计一个客户端-服务器聊天应用程序（实际上我不是，但让我们假装我是:)），我对我所经历的一些竞争条件感到有些困惑。

假设我有以下代码：

```
public interface IServer
{
  [OperationContract(IsOneWay = false)]
  [FaultContract(typeof(ChatException))]
  void BroadcastMessage(string msg);
}

public class Server : IServer 
{
  void BroadcastMessage(string msg) // I'm not mentionning the try/catch/throw FaultException here for readability purposes
  {
    foreach (IClientCallback c in callbacks){
      c.ReceiveMessage(msg);
    }

  }
}

public interface IClientCallback
{
  [OperationContract(IsOneWay = true)]
  void ReceiveMessage(string s);
} 
```

这是绑定配置的摘录：

```
<endpoint address="" 
binding="netTcpBinding" 
bindingConfiguration="DuplexBinding" 
contract="IServer" />

 <binding name="DuplexBinding" sendTimeout="00:01:00">
   <reliableSession ordered="true" inactivityTimeout="00:05:00" enabled="true"/>
   <security mode="None">
     <transport clientCredentialType="Windows" protectionLevel="EncryptAndSign" />
     <message clientCredentialType="Windows" />
   </security>
 </binding> 
```

这当然是某种伪 c#，为了清楚起见，我删除了很多不相关的代码。

现在切入正题：此代码不起作用。当我调用 BroadcastMessage 时，该方法永远不会返回，并且我最终在客户端出现超时。如果我在服务器端进行调试，一切似乎都很好（我完全按照预期从 BroadcastMessage 方法返回，并且我不会阻止任何 ReceiveMessage 单向调用）

以下是修复此代码的两种方法：

1.  删除 FaultContract 并将 BroadcastMessage 方法声明为 oneway=true
2.  向所有人广播消息，但最初的发件人

我的第一个猜测是客户端正在等待服务器返回，因此无法处理来自服务器的传入 ReceiveMessage 调用，从而阻塞服务器，但 ReceiveMessage 被声明为单向，并且调试服务器表明它不会阻止对 ReceiveMessage 的任何调用

现在，我的问题：

*   这是怎么回事？

*   还有其他方法可以解决这个问题吗？（也许通过调整绑定配置？）

*   假设我选择了修复 2（即不向发送者广播），如果服务器在我等待自己的 BroadcastMessage 调用完成时调用我的 ReceiveMessage 回调（因为其他人向我发送了消息）会发生什么？

*   我读过 OneWay 调用并不完全是单向的，服务器仍在等待来自另一端的 HTTP 响应。有这方面的详细信息吗？具体来说，当远程呼叫被阻止时，客户端是否能够响应此类 http 响应？

编辑：服务器端的控制台 .net 3.5，客户端的 Winforms .net 3.5

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T09:32:29.617

这听起来像一个死锁，可能是由于同步上下文。什么是客户？温窗体？WPF？WCF 尊重同步上下文，这意味着 winform 和 WPF 的“切换到 UI 线程”。如果您在 UI 线程上**发出**阻塞请求，那么游戏结束。

尝试在后台线程上执行 WCF 请求，以便 UI 线程可用于处理传入请求；这可以像使用一样简单`ThreadPool`，或者也许`BackgroundWorker`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T10:07:36.753

尝试将此属性添加到您的服务的具体实现中：

```
[System.ServiceModel.ServiceBehavior(UseSynchronizationContext=false)]
public class Server : IServer {} 
```

其次，尝试打开 WCF 跟踪，看看你的 WCF 实现的内部是否发生了让你伤心的事情。我遇到了一些非常奇怪的错误，这些错误只有在我进行跟踪并发现正在发生的实际错误消息时才有意义。

[跟踪 WCF 服务](http://msdn.microsoft.com/en-us/library/ms733025.aspx)

# c - How to put values to const char **?

> ID：472362
> 
> 赞同：3
> 
> 时间：2009-01-23T09:31:53.190
> 
> 标签：c, char, constants

If I declare a variable const char ** stringTable, how should I be able to put values to it if it is a const? (It has to be const because a function I am supposed to use takes const char ** as a parameter.)

Edit: No you cannot convert from char ** to const char ** implicitly. Compiler complains: cannot convert parameter 3 from 'char **' to 'const char **'

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-01-15T04:41:14.637

哇，我很惊讶没有人得到这个！也许我可以得到一个死灵法师徽章。隐式 const 转换仅扫描一层深度。所以 a`char*`可以变成 a`const char*`但它不会深入到 a`char**`类型中以找到需要更改的内容以使其成为 a `const char**`。

```
#include <iostream>
using namespace std;

void print3( const char **three ) {
        for ( int x = 0; x < 3; ++ x ) {
                cerr << three[x];
        }
}

int main() {
         // "three" holds pointers to chars that can't be changed
        const char **three = (const char**) malloc( sizeof( char** ) * 3 );
        char a[5], b[5], c[5]; // strings on the stack can be changed
        strcpy( a, "abc" ); // copy const string into non-const string
        strcpy( b, "def" );
        strcpy( c, "efg" );
        three[0] = a; // ok: we won't change a through three
        three[1] = b; // and the (char*) to (const char*) conversion
        three[2] = c; // is just one level deep
        print3( three ); // print3 gets the type it wants
        cerr << endl;
        return 0;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T09:40:57.010

Apart from other mentions that you can pass `char**` into function that takes `const char **`,

`const char**` is a non-const pointer to `const char*`, you can declare it and freely put values of type `const char*` in it.

On the other hand, you would not be able to do it, if you declared it as `const char * const *` or `const char * const * const`.

```
yourfunc(const char **p);
...
const char *array_str[10];
array_str[0] = "foo"; /* OK, literal is a const char[] */
yourfunc(array_str); 
```

Here is what `cdecl` says:

```
cdecl> explain const char **table
declare table as pointer to pointer to const char
cdecl> explain const char * const *table
declare table as pointer to const pointer to const char
cdecl> explain const char * const * const table
declare table as const pointer to const pointer to const char 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T09:35:51.233

That const declaration is a quarantee of the function, you dont have to fullfill it. That means the function will keep your array untouched (it will just read). So you can pass a nonconst variable to a function expecting const.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-23T09:37:37.657

You can pass a `char **` to a function declared as taking a `const char **` -- Might be worth taking a look at the [documentation for const](http://msdn.microsoft.com/en-us/library/888bfst6(VS.80).aspx) on MSDN

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T22:56:33.877

使用我的编译器（cygwin 中的 gcc 版本 3.4.4），我发现我可以传递`char *`给`const char *`，但不能传递`char **`给，`const char **`这与大多数答案所说的不同。

这是一种可以构建有效的方法；也许它会帮助你。

```
void printstring( const char **s ) {
  printf( "%s\n", *s );
}

int main( int argc, char** argv ) {

  char *x = "foo";  // here you have a regular mutable string

  const char *x2 = x;  // you can convert that to a constant string

  const char **y = &x2;  // you can assign the address of the const char *

  printstring(y);

} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T09:38:31.790

`char **` can be converted to `const char **`, so if you want to **call** a function which takes a `const char **` as a parameter, just supply your `char **` and it'll be implicitly converted.

If you want to **write** a function which takes a `const char **` as parameter and then modifies the `char` data it references, you're breaking the contract with your compiler, even if you might get it to work via casts!

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T23:02:40.857

您可以使用强制转换运算符取消 const char*： (char*)

```
void do_something(const char* s)
{
char* p=(char*)s;
p[0]='A';
} 
```

对数组 char** 使用相同的想法

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-15T05:29:24.900

`const char **`表示底层字符是常量。所以，虽然你不能做这样的事情：

```
const char **foo = ...;
**foo = 'a';   // not legal 
```

但是没有什么可以阻止您操纵指针本身：

```
// all the following is legal
const char **foo = 0;

foo = (const char **)calloc(10, sizeof(const char *));

foo[0] = strdup("foo");
foo[1] = strdup("baz"); 
```

也就是说，如果您确实想修改实际的字符数据，您可以使用非常量指针并将其转换：

```
char **foo = ...;
func((const char **)foo); 
```

# ruby - performance testing tool

> ID：472375
> 
> 赞同：1
> 
> 时间：2009-01-23T09:38:16.643
> 
> 标签：ruby, watir, performance-testing

We are using watir and integrated with VS 2008 using ruby in steel and we have automated our web application and it awsome. Is there way to use the same script to do the performance testing or is there any better tool.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T15:15:59.677

很难判断您是想要分析网站性能的东西（即：分析器）还是负载/压力测试工具。鉴于您正在谈论脚本重用，我将假设您需要负载测试工具而不是分析器。

所有负载测试工具，除了一个（免责声明：我的公司就是那个），通过记录 HTTP 流量然后重放它来工作。该脚本与您为 Watir 使用的功能测试脚本**非常不同。**

您可以记录由 Watir 脚本生成的 HTTP 流量，也可以尝试直接运行功能测试。

如果您还使用 FireWatir，则可以使用 Firebug，它是一款[出色的 Web 开发工具](http://getfirebug.com)，可以向您显示每个页面的记录流量。如果您主要使用 IE，请查看 HttpWatch。它是商业的，但为 IE 提供了[很好的网络时序](http://www.httpwatch.com/)，并且可以导出为各种数据格式。或者，许多[负载](http://pylot.org) [测试](http://jakarta.apache.org/jmeter/) [工具](http://grinder.sourceforge.net/)提供了一个代理，可以记录流量并为您生成负载脚本。

获得网络数据后，您可以快速将其转换为 Pylot、Grinder、JMeter 等可以理解的脚本。这种方法的问题是，每当站点的任何部分或测试发生变化时，您都需要重新录制脚本。如果您的应用程序不仅仅是基本的 HTML（即：Ajax、.NET 视图状态等），那么您可能必须使用负载测试工具的一些高级部分。有关更多信息，请参阅我关于[ajax 负载测试的文章。](http://ajaxian.com/archives/why-load-testing-ajax-is-hard)

**无耻插件**：如果你正在使用 Selenium（或者愿意将几个 Watir 脚本转换为 Selenium 脚本），这是另一个开源[功能测试工具](http://seleniumhq.org)，你可以使用 BrowserMob，它提供了使用真实浏览器回放的[负载测试服务](http://browsermob.com)驱动它们的负载和功能测试脚本（Selenium）。它使用更多的资源，但由于云计算，价格点仍然很低。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-11T19:20:07.660

dIf you are truely talking just 'performance' then you could alter the scripts to start capturing and recording the page load tines. Any time you so some action that causes a page to load (like navigating to a link) Watir returns the time to load the page.

You just need to have the scripts implement some kind of simple logging method to be able to record the time to load each page, and then alter the scripts so that it return value is captured ala

```
loadtime = browser.goto(someurl)
perflogger(someurl, loadtime) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T23:00:29.923

您可以在日志文件上运行rawk [。](https://rubyforge.org/projects/rawk-the-logs/)这给出了一个非常全面的总结，说明了需要这么长时间。

或者，[NewRelic](http://www.newrelic.com/)可以为您的 rails 应用程序提供监控，并为您提供每个请求正在执行的详细信息。

最后是[FiveRuns](http://www.fiveruns.com/)，它的功能与 NewRelic 非常相似。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-27T03:58:21.510

看看 LoadWise，您可以重用现有的功能测试脚本进行性能测试。

使用相同的负载测试脚本而无需更改，您可以在 Firefox 中预览它（通过 FireWatir），或者使用 X 个虚拟用户访问您的网站（通过 Celerity）。

[http://testwisely.com/en/loadwise](http://testwisely.com/en/loadwise)

# java - Is there a Java equivalent to Apple's Core Data?

> ID：472377
> 
> 赞同：13
> 
> 时间：2009-01-23T09:38:33.163
> 
> 标签：java, database-design, core-data, persistence

I have recently heard a lot of praise for Apple's Core Data architecture.

Is there something similar in Java land, so that I can play around with Core Data's ideas (in order to evaluate how it stacks up against something like Hibernate) without having to get into Cocoa/Objective-C first?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T19:13:02.353

请记住，正如我所理解的 Hibernate 等人，Core Data 主要不是一个对象持久性框架*。*成为。相反，它是一个对象图管理框架（它维护受模型约束的对象的关系和更改状态），尽管它不是一个依赖注入框架（如 Groovy 或 Springs）。碰巧它可以使用几种后端格式（包括 SQLite）之一将此对象图保存到磁盘。Core Data 也不适合多用户系统，就像最初的[Enterprise Object Framework](http://en.wikipedia.org/wiki/Enterprise_Objects_Framework)一样。它专门用于单用户桌面应用程序，并自动执行为该类型应用程序编写模型层的大部分工作。对于其他任何事情，它可能都不合适。

你考虑 Core Data 是为了什么？如果您给我们一个更具体的用例，也许我们可以提供更具体的答案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T06:35:03.607

如果你有一台 Mac，安装 WebObjects——它包含在 Xcode 中——你就可以访问基于 Java 的 Enterprise Objects Framework。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T20:21:32.663

目前还没有——他们放弃 EOF 的 Java 转换的原因之一是翻译带来的复杂性 ( [http://en.wikipedia.org/wiki/Core_Data](http://en.wikipedia.org/wiki/Core_Data) )。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-24T16:25:22.967

While I only know about Core Data what I have just read, it sounds like the [Eclipse Modeling Framework](http://www.eclipse.org/modeling/emf/) and the [Graphical Modeling Framework](http://www.eclipse.org/modeling/gmf/) would do something similar, as they also provide automatic generation of a GUI from a schema, and take care of persistence of schema instances. To get relational database persistence, they could maybe be combined with [EclipseLink](http://www.eclipse.org/eclipselink/) (which is based on Oracle's [TopLink](http://www.oracle.com/technology/products/ias/toplink/index.html)), or some other ORM framework.

# c# - 将“枚举”数组转换为“int”数组

> ID：472384
> 
> 赞同：48
> 
> 时间：2009-01-23T09:43:23.980
> 
> 标签：c#, .net

我正在尝试将 Enum 数组转换为 int 数组：

```
public enum TestEnum
{
Item1,
Item2
}

int[] result = Array.ConvertAll<TestEnum, int>(enumArray, new Converter<TestEnum, int>(Convert.ToInt32)); 
```

出于某种原因，Convert.ToInt32 在 Array.ConvertAll 中使用时不起作用，所以我不得不进行一些更改：

```
int[] result = Array.ConvertAll<TestEnum, int>(enumArray, new Converter<TestEnum, int>(ConvertTestEnumToInt));

public static int ConvertTestEnumToInt(TestEnum te)
{
return (int)te;
} 
```

只是出于好奇，有没有办法在不使用额外方法的情况下让它工作？

问候

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-01-23T09:47:27.293

只需使用匿名方法进行转换：

```
int[] result = Array.ConvertAll<TestEnum, int>(
    enumArray, delegate(TestEnum value) {return (int) value;}); 
```

或使用 C# 3.0，一个 lambda：

```
int[] result = Array.ConvertAll(enumArray, value => (int) value); 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-02-13T17:43:36.073

幸运的是，C# 3.0 包含一个`Cast`操作：

```
int[] result = enumArray.Cast<int>().ToArray(); 
```

如果你停止使用数组并开始使用`IEnumerable<>`，你甚至可以摆脱`ToArray()`调用。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2014-10-09T13:51:49.233

```
enumArray.Select(x => (int) x)).ToArray() 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2018-05-08T15:58:25.253

这就像一个魅力：

```
var intArray = enumArray.Select(e => (int)e).ToArray(); 
```

就像这样：

```
var intList = enumArray.Select(e => (int)e).ToList(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-01-17T12:32:07.967

仅供参考：在 .Net4ClientProfile 和 VS2010 上测试

实际上，您甚至不需要使用 LINQ。只要将类型降到`object`.

有：

```
 enum One { one0, one1, one2, one3 };
  enum Two { two0, two1, two2, two3 };

  One[] vals = new One[] { One.one0, One.one3 }; 
```

我们可以玩：

```
//Two[] aa = (Two[])vals; // impossible
  Two[] aa = (Two[])(object)vals; // possible!

  Two bb = aa[1]; // == Two.two3 
```

起初，我真的很惊讶第二行没有抛出 InvalidCast。但事实并非如此。

查看类型可以解释一些事情：

```
 bool check2 = bb.GetType().FullName == "Two";   // well, you'd guess that
  bool check3 = aa.GetType().FullName == "One[]"; // what?! 
```

严重地！数组`aa`不是。`Two[]`数组类型在转换为 时已“被变量丢失” ，`object`但两者当然仍然引用同一个对象。然后，在下面的转换之后，它仍然是对象，原始数组，只是隐藏在一个新的变量类型后面。`vals``(object)vals``aa``One[]`

`bb`对象/变量的类型为 ，因为`Two`数组的项被读取为数组的一项`Two[]`（以及变量的类型）。真正的数组 One[] 被`Two[]`类型隐藏，因此索引`Two[]`必须导致`Two`类型的值。

此外，由于实际类型是隐藏的，并且 Enum 类型似乎被轻视，让我们检查另一件事：

```
 var numbers = (int[])(object)vals;
  var cc = numbers[0] + 10; // == 10, from one0's value
  var dd = numbers[1] + 10; // == 13, from one3's value 
```

同样：

```
 bool check4 = numbers.GetType().FullName == "One[]"; // not System.Int32[] 
```

因此，正如您可能已经猜到的那样，反过来也是可能的：

```
 var numbers2 = new int[]{ 0, 2, 99 };
  var enums = (One[])(object)numbers2;
  One ee = enums[0]; // == One.one0
  One ff = enums[1]; // == One.one2
  One gg = enums[2]; // == ((One)99) 
```

并且 int[] 也记住它的真实类型，即使转换为`One[]`：

```
 bool check5 = numbers2.GetType().FullName == "System.Int32[]"; 
```

更进一步，当数组作为 传递时，您不能信任`as`and运算符：`is``object`

```
 bool really_true1 = vals is One[];
  bool really_true2 = vals is Two[];
  bool really_true3 = vals is System.LoaderOptimization[]; 
```

这是一个“哥达”！最近对我来说。

它实际上**重用**了原始数组对象（而不是像使用 LINQ 那样复制它）并将其公开为不同的类型——无论是 Two[] 还是 int[]。这似乎是一个“真正的演员”，没有拳击。与 LINQ 驱动的复制和转换有很大不同。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-11-11T22:55:52.710

`int[] b = Array.ConvertAll((int[])Enum.GetValues(typeof(TestEnum)), Convert.ToInt32);`

# .net - 我需要全文搜索吗？如果需要，如何在 sql2000 上实现全文搜索？

> ID：472386
> 
> 赞同：1
> 
> 时间：2009-01-23T09:44:10.250
> 
> 标签：.net, sql, linq, sql-server-2000, full-text-search

我在我的 asp.net mvc 项目中使用 Linq2Sql，到目前为止效果很好。然而，现在我需要实现一个“关键字搜索”，在大约 20 个字段中搜索 x 关键字，这些字段分布在 10 个连接表中，这些连接表的最大深度为 3 级。linq 函数确实很简单，但是生成的查询太慢了（2 个单词大约需要 25 秒）。我实现了一些缓存，但只是缓存不会削减它。我自己尝试了一个存储过程并稍微改进了它，但优化非常有限。

现在我阅读了全文搜索，如果我做对了，这看起来就像我所需要的。谁能证实这一点？系统需要在SQL2000上运行。如果 FTS 是我需要的，有人可以帮助我如何设置它吗？它是内置在 SQL2000 中的吗？我需要其他图书馆/服务吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T09:52:20.327

请参阅[SQL Server 2000 全文搜索部署白皮书](http://support.microsoft.com/kb/323739)，但我只会在搜索具有大文本块的列时使用全文搜索。

# c# - 如何从 DataGridView 接收“滚动框”类型的滚动事件？

> ID：472389
> 
> 赞同：7
> 
> 时间：2009-01-23T09:45:50.963
> 
> 标签：c#, .net, winforms, datagridview, scroll

我有一个 DataGridView，我正在听它的 Scroll 事件。这给了我一个 ScrollEventArgs 对象，它的 Type 成员应该告诉我已经发生的滚动事件的类型。在[MSDN 文档页面上](http://msdn.microsoft.com/en-us/library/system.windows.forms.scrolleventtype.aspx)，它说我应该能够通过侦听 ThumbPosition、ThumbTrack、First、Last 和 EndScroll 类型的事件来检测滚动框的移动。

但是，当我拖动滚动框时，我只会得到 LargeDecrement 和 LargeIncrement 类型的事件。

如何访问 ThumbPosition、ThumbTrack、First、Last 和 EndScroll 事件？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T09:45:35.443

```
using System.Reflection;
using System.Windows.Forms;

bool addScrollListener(DataGridView dgv)
{
    bool ret = false;

    Type t = dgv.GetType();
    PropertyInfo pi = t.GetProperty("VerticalScrollBar", BindingFlags.Instance | BindingFlags.NonPublic);
    ScrollBar s = null;

    if (pi != null)
        s = pi.GetValue(dgv, null) as ScrollBar;

    if (s != null)
    {
        s.Scroll += new ScrollEventHandler(s_Scroll);
        ret = true;
    }

    return ret;
}

void s_Scroll(object sender, ScrollEventArgs e)
{
    // Hander goes here..
} 
```

如您所料，如果您想收听水平滚动事件，请将“VerticalScrollBar”更改为“Horizo​​ntalScrollBar”

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-02-19T21:32:18.013

通过像这样访问 DataGridView 控件上的水平或垂直滚动​​条，您可以在不使用反射的情况下完成此操作。替换`HScrollBar`为`VScrollBar`以获得垂直滚动条。

```
public MyFormConstructor()
{
    InitializeComponent();
    AddScrollListener(MyGrid, MyScrollEventHandler);
}

private void AddScrollListener(DataGridView dgv, ScrollEventHandler scrollEventHandler)
{
   HScrollBar scrollBar = dgv.Controls.OfType<HScrollBar>().First();
   scrollBar.Scroll += scrollEventHandler;
}

private void MyScrollEventHandler(object sender, ScrollEventArgs e)
{
   // Handler with e.Type set properly
} 
```

# workflow - 高吞吐量和 Windows Workflow Foundation

> ID：472391
> 
> 赞同：3
> 
> 时间：2009-01-23T09:50:36.210
> 
> 标签：workflow, workflow-foundation

WWF 能否处理在任何时候并行处理数十条记录的高吞吐量场景？

我们想建立一个每小时处理几千条记录的工作流程。每条记录最多需要一分钟来处理，因为它会调用外部 Web 服务。

我们正在测试 Windows Workflow Foundation 来执行此操作。但是我们的演示程序显示，当我们使用并行活动在一个工作流实例中一次处理多条记录时，每条记录的处理似乎是按顺序而不是并行运行的。

我们应该使用多个工作流实例还是并行活动？

是否有任何已知的高性能 WWF 处理模式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T22:03:28.890

我认为常见的模式是每条记录使用一个工作流实例。工作流运行时并行运行多个实例。

一个工作流实例一次运行一个线程。并行活动在这个单一线程上按顺序调用每个活动的 Execute 方法。但是，如果活动是异步的并且大部分时间都在等待外部进程完成其工作，那么您仍然可以从并行活动中获得性能改进。例如，如果 Activity 调用了外部 Web 方法，然后等待回复 - 它从 Execute 方法返回并且在等待回复时不占用该线程，因此 Parallel 组中的另一个 Activity 可以开始其工作（例如，也调用网络服务）同时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T00:51:07.370

您绝对应该为每条记录使用一个新的工作流程。每个工作流只有一个线程在其中运行，因此即使使用 ParallelActivity，它们仍将按顺序处理。

我不确定 Windows Workflow 的性能，但从我在 Tech-Ed 上听到的关于 .NET 4 的消息来看，它的 Workflow 组件将比 .NET 3.0 和 3.5 中的组件快得多。所以如果你真的需要很多性能，也许你应该考虑等待.NET 4.0。

另一种选择可能是考虑 BizTalk。但它相当昂贵。

# python - 如何为 Django 模型中的字段元组指定唯一性

> ID：472392
> 
> 赞同：18
> 
> 时间：2009-01-23T09:50:59.470
> 
> 标签：python, django, django-models

有没有办法在 Django 中指定一个模型，以确保表中的一对字段是唯一的，其方式类似于类似字段的“unique=True”属性？

还是我需要在 clean() 方法中检查这个约束？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-01-23T12:16:04.763

有一个 META 选项称为`unique_together`. 例如：

```
class MyModel(models.Model):
    field1 = models.BlahField()
    field2 = models.FooField()
    field3 = models.BazField()

    class Meta:
        unique_together = ("field1", "field2") 
```

[有关 Django文档](http://docs.djangoproject.com/en/dev/ref/models/options/#unique-together)页面的更多信息。

# c++ - 缓存、循环和性能

> ID：472393
> 
> 赞同：2
> 
> 时间：2009-01-23T09:51:12.607
> 
> 标签：c++, performance, memory, caching

前段时间我写了一小段代码在面试中询问，看看人们如何理解缓存和内存的概念：

```
#include "stdafx.h"
#include <stdlib.h>
#include <windows.h>
#include <iostream>

#define TOTAL 0x20000000

using namespace std;

__int64 count(int INNER, int OUTER)
{
    int a = 0;
    int* arr = (int*) HeapAlloc(GetProcessHeap(), 0, INNER * sizeof(int));
    if (!arr) {
        cerr << "HeapAlloc failed\n";
        return 1;
    }
    LARGE_INTEGER freq;
    LARGE_INTEGER startTime, endTime;
    __int64 elapsedTime, elapsedMilliseconds;
    QueryPerformanceFrequency(&freq);
    QueryPerformanceCounter(&startTime);

    /* Начало работы */

    for (int i = 0; i < OUTER; i++) {
        for (int j = 0; j < INNER; j++) {
            a |= i;
            arr[j] = a;
        }
    }

    /* Конец работы */

    QueryPerformanceCounter(&endTime);
    elapsedTime = endTime.QuadPart - startTime.QuadPart;
    elapsedMilliseconds = (1000 * elapsedTime) / freq.QuadPart;
    HeapFree(GetProcessHeap(), 0, arr);
    return elapsedMilliseconds;
}

int _tmain(int argc, _TCHAR* argv[])
{
    __int64 time;
    for (int INNER = 0x10; INNER <= 0x2000000; INNER <<= 1) {
        int OUTER = TOTAL / INNER;
        time = count(INNER, OUTER);
        cout << INNER << "\t" << OUTER << "\t" << time << "\n";
    }
} 
```

这就是它编译成的（循环本身）：

```
00401062  xor         ecx,ecx 
00401064  test        ebp,ebp 
00401066  jle         count+83h (401083h) 
00401068  xor         eax,eax 
0040106A  test        ebx,ebx 
0040106C  jle         count+7Ch (40107Ch) 
0040106E  mov         edi,edi 
00401070  or          esi,ecx 
00401072  mov         dword ptr [edi+eax*4],esi 
00401075  add         eax,1 
00401078  cmp         eax,ebx 
0040107A  jl          count+70h (401070h) 
0040107C  add         ecx,1 
0040107F  cmp         ecx,ebp 
00401081  jl          count+68h (401068h) 
```

这就是程序在我的机器上输出的内容：

* * *

```
LOG2(INNER) LOG2(OUTER)  Time, ms
4           25           523
5           24           569
6           23           441
7           22           400
8           21           367
9           20           358
10          19           349
11          18           364
12          17           378
13          16           384
14          15           357
15          14           377
16          13           379
17          12           390
18          11           386
19          10           419
20          9            995
21          8            1,015
22          7            1,038
23          6            1,071
24          5            1,082
25          4            1,119 
```

* * *

我请人们解释发生了什么。随着内部数组的增长，周期数会随着时间的推移而减少。随着内部阵列的增长超出缓存，缓存未命中开始发生并且时间增加。到目前为止一切都很好。

**但是**：当 INNER 数组大小为 16 时（这给了我们 64 字节的数据） ，尽管代码数量更多，但性能**提升**`jmps`很小。它很小（523 与 569），但可重现。

**问题是**：为什么会有这种提升？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T09:54:27.530

可能是因为 64 是您机器上的缓存行大小，并且您基本上完全在单个缓存行之外运行每个迭代。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T10:41:50.587

我不确定你在问什么。你只是在检查我们所知道的吗？何苦？还是您问我们是因为您自己无法解释 64 字节的提升？还是要找出这是否是一个好的面试问题，或者......？

无论如何，如果目的只是为您的面试问题提供背景，您应该删除所有不必要的代码。HeapAlloc 重要吗？为什么不能在堆栈上声明数组？还是使用 new/malloc？

为什么需要在这个小测试程序中进行错误处理？同样，它只会分散注意力并增加更多噪音。QPC 调用也是如此。我什至不会问你为什么需要一个预编译的头文件。

为了向受访者询问 6 行循环，他必须筛选 16 行不相关的噪音。为什么？

正如评论中提到的，输出表基本上是不可读的。

我完全赞成观察受访者是否可以阅读代码，但我不认为提出有关性能和缓存特性的问题如此难以阅读的意义。

在任何情况下，一个 64 字节的 INNER 数组完全适合大多数 CPU 的高速缓存行。这意味着每次 OUTER 迭代都必须读取一个缓存行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:45:07.670

澄清一下，他表中的一些空格实际上应该是 ,'s。大家可以想办法。

# php - 如何在 Joomla 1.5x 中从前端编辑联系人？

> ID：472410
> 
> 赞同：3
> 
> 时间：2009-01-23T10:02:10.557
> 
> 标签：php, content-management-system, joomla, joomla1.5

我原以为这将是一项本机功能（因为 joomla 允许您将联系人与用户帐户联系起来）但我们找不到任何方法来做到这一点！

有谁知道任何允许这样做的扩展/模块？

我对 PHP 不是很感兴趣，所以我真的很想不必手动编写代码！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-04-08T17:05:20.507

这是一个旧线程，但由于它仍处于打开状态，因此您可能还没有找到解决方案。我自己也遇到过同样的问题，我认为能够从前端管理联系人是 Joomla 的一项基本功能！作为一个简单的 webapp 创建工具变得更加有用。

无论如何，有几个扩展可以帮助你。但是，两者都是商业的，不支持 Joomla！1.6\. 他们来了：

1.  [前台编辑通讯录](http://b-elektro.no/index.php?option=com_content&view=article&id=19%3afront-edit-address-book-for-joomla-15x&catid=6%3aextentions&Itemid=8)：简单的界面。但是请注意，它可能存在安全问题。谷歌“前端编辑地址簿漏洞”，你会发现它（对不起，由于我是新用户，stackoverflow 允许我每个线程最多发布 2 个链接）。我给开发人员发了电子邮件，他向我保证问题已经解决了。

2.  [脾气暴躁的联系人](http://grumpyengineering.com/purchase/grumpycontacts)：在演示站点上（在我指向您的页面上有一个链接），我觉得它看起来有点乱。在 Joomla！扩展目录，但是，它有很好的评论。

我从来没有使用过这些，因为我所有的项目都已经迁移到了 Joomla！1.6.

如果您在此期间找到了另一种选择，或者甚至自己开发了一些东西，请告诉我。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T15:25:39.513

您是否尝试在用户菜单中？另一种选择是安装 Community Builder。祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-26T14:32:43.067

Joomla 中的联系人由内置组件处理，`com_contacts`该组件提供添加联系人的基本功能和**来自后端的**一些基本信息。

[**QContacts**](http://extensions.joomla.org/extensions/contacts-and-feedback/contact-details/4811)是一个很棒的扩展，它可以让您更好地控制您可以提供的数据，但仍然没有前端支持。

不幸的是，我也在解决这个问题，结果发现没有真正的开箱即用选项来支持前端编辑联系方式。

# .net - 托管我的 .NET 应用程序的最佳服务器操作系统

> ID：472412
> 
> 赞同：0
> 
> 时间：2009-01-23T10:03:12.643
> 
> 标签：.net

您推荐哪些 Microsoft 操作系统版本和调整工具来托管针对以下环境的应用程序？

1.  .NET 2.0-
2.  .NET 3.0+

注意：不要担心我的硬件。请告诉我，考虑到上述环境以及对稳定性、安全性和高正常运行时间的需求，什么最适合我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T10:11:39.990

好吧，我会推荐任何版本的服务器，2003 是 ROCK SOLID，而且我只听说过关于服务器 2008 的好消息。请注意，当您离开 XP 时，安全性会变得更加困难。（这不是不可能的，只是有一些通常会咬人的变化）

此外，如果您在服务器中使用 WCF，2k8 具有 WAS（Windows 激活服务），它可以在非 http 绑定上托管您的服务，而不需要一点包装器来创建该死的东西，您只需给它一个编译的服务定义。

# xml - 我能否知道 XSL 转换处理了多少 XML 文档？

> ID：472415
> 
> 赞同：1
> 
> 时间：2009-01-23T10:03:51.893
> 
> 标签：xml, xslt

我有相当大的输入 XML 文件，必须使用 XSL 将其转换为给定格式。这些 XSL 文件是手工制作的，我们要确保考虑到原始文档中的每个非空文本节点，即 value-of'ed、copy-of'ed 或读取并连接别的东西。

这甚至可能吗？即，是否有可能知道 XSL 转换“覆盖”了多少输入文档？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-24T03:47:05.867

**一般的答案是否定的**。

**通常也不可能**实现不那么雄心勃勃的想法**来查找在运行时没有模板匹配的所有文本节点**。之所以如此，是因为即使定义了匹配模板，它们也只能作为`<xsl:apply-templates>`带有“ `select`”属性的结果来选择进行处理，该属性选择特定的文本节点。

这是否在运行时完成通常是不可能分析的。

**通常也不可能分析`select`属性**of`<xsl:value-of/>` 和 of 中使用的每个 XPath 表达式`<xsl:copy-of>`，因为这样的表达式可能包含一个 xsl 变量，我们必须知道该变量的运行时内容才能确定将选择哪些节点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T11:28:12.300

我现在能想到的最好的方法是在 xsl 的末尾添加类似这样的内容：

```
<xsl:template match="text()[normalize-space()]">
  To battle stations!
  This sneaky tag tried to escape: <xsl:value-of select="name(..)"/>
</xsl:template> 
```

但这真的取决于`<xsl:apply-templates/>`在所有正确的地方被调用，并且可能不会为非平凡的样式表这样做......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T10:15:47.410

您可以从原始 Xml 中提取所有文本，然后搜索这些字符串是否在结果文档中。这并不能证明所有内容都已转换，但您可能会发现一些明显缺失的部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T15:39:25.163

过去我这样做的唯一方法是使用[Altova 的 XMLSpy 之](http://www.altova.com/products/xmlspy/xml_editor.html)类的产品逐步完成 XSL 。当然，这对于大型 XSL 和 XML 文档来说是非常乏味的，但有时发现有必要找出转换发生了什么。

# javascript - 为什么 4 不是 Number 的实例？

> ID：472418
> 
> 赞同：70
> 
> 时间：2009-01-23T10:06:09.767
> 
> 标签：javascript

只是好奇：

*   4 实例数 => 假
*   new Number(4) instanceof Number => true?

为什么是这样？与字符串相同：

*   `'some string' instanceof String`返回假
*   `new String('some string') instanceof String`=> 真
*   `String('some string') instanceof String`也返回 false
*   `('some string').toString instanceof String`也返回 false

对于对象、数组或函数类型，instanceof 运算符按预期工作。我只是不知道如何理解这一点。

[**新见解**]

```
Object.prototype.is = function() {
        var test = arguments.length ? [].slice.call(arguments) : null
           ,self = this.constructor;
        return test ? !!(test.filter(function(a){return a === self}).length)
               : (this.constructor.name ||
                  (String(self).match ( /^function\s*([^\s(]+)/im )
                    || [0,'ANONYMOUS_CONSTRUCTOR']) [1] );
}
// usage
var Newclass = function(){};  // anonymous Constructor function
var Some = function Some(){}; // named Constructor function
(5).is();                     //=> Number
'hello world'.is();           //=> String
(new Newclass()).is();        //=> ANONYMOUS_CONSTRUCTOR
(new Some()).is();            //=> Some
/[a-z]/.is();                 //=> RegExp
'5'.is(Number);               //=> false
'5'.is(String);               //=> true 
```

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-01-23T10:10:15.970

`value instanceof Constructor`与`Constructor.prototype.isPrototypeOf(value)`检查 [[Prototype]] 链中`value`的特定对象是否出现相同。

字符串和数字是**原始值**，而不是对象，因此没有 [[Prototype]]，因此只有将它们包装在常规对象中（在 Java 中称为“装箱”），它才会起作用。

此外，正如您所注意到的，`String(value)`并且`new String(value)`做不同的事情：如果您在不使用运算符的情况下调用内置类型的构造函数`new`，它们会尝试将参数转换（'cast'）为特定类型。如果您使用`new`运算符，它们会创建一个包装器对象。

`new String(value)`大致等价于`Object(String(value))`，其行为方式与 相同`new Object(String(value))`。

* * *

更多关于 JavaScript 中的类型：ECMA-262 定义了以下原始类型：*Undefined*、*Null*、*Boolean*、*Number*和*String*。此外，对于具有属性的事物，还有*Object类型。*

例如，函数是*Object*类型（它们只是有一个称为 [[Call]] 的特殊属性），并且`null`是*Null*类型的原始值。这意味着`typeof`运算符的结果并没有真正返回值的类型......

此外，JavaScript 对象还有另一个称为 [[Class]] 的属性。您可以通过`Object.prototype.toString.call(value)`（这将返回）获得它。数组和函数属于*Object*类型，但它们的类是*Array*和*Function*。`'[object`*`Classname`*`]'`

 ***上面给出的对象类的测试在`instanceof`失败时有效（例如，当对象在窗口/框架边界之间传递并且不共享相同的原型时）。

* * *

此外，您可能想查看以下改进版本`typeof`：

```
function typeOf(value) {
    var type = typeof value;

    switch(type) {
        case 'object':
        return value === null ? 'null' : Object.prototype.toString.call(value).
            match(/^\[object (.*)\]$/)[1]

        case 'function':
        return 'Function';

        default:
        return type;
    }
} 
```

对于原语，它将以*小写形式返回它们的***类型**，对于对象，它将以*大写形式返回它们的***类**。

 ******例子：**

*   对于 *Number***类型** 的原语（例如），它将返回，对于*Number***类**的包装对象（例如），它将返回;*`5``'number'` ***`new Number(5)``'Number'`****

*****   对于函数，它将返回`'Function'`.**** 

 ****如果您不想区分原始值和包装对象（无论出于何种原因，可能是不好的原因），请使用`typeOf(...).toLowerCase()`.

已知的错误是 IE 中的一些内置函数，当与某些 COM+ 对象一起使用时，这些函数会被考虑`'Object'`和返回值。`'unknown'`

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-23T10:25:36.267

您可以尝试评估：

```
>>> typeof("a")
"string"
>>> typeof(new String("a"))
"object"
>>> typeof(4)
"number"
>>> typeof(new Number(4))
"object" 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T10:32:43.507

如 Christoph 的回答中所述，字符串和数字文字与字符串和数字对象不同。如果您在文字上使用任何 String 或 Number 方法，请说

```
'a string literal'.length 
```

文字暂时转换为对象，调用方法并丢弃对象。
文字相对于对象有一些明显的优势。

```
//false, two different objects with the same value
alert( new String('string') == new String('string') ); 

//true, identical literals
alert( 'string' == 'string' ); 
```

始终使用文字来避免意外行为！
如果需要，可以使用 Number() 和 String() 进行类型转换：

```
//true
alert( Number('5') === 5 )

//false
alert( '5' === 5 ) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T10:25:57.870

这是我发现的 Javascript 的细微差别。`instanceof`如果 LHS 不是`object`类型， of 运算符将始终导致 false。

请注意，`new String('Hello World')`这不会导致`string`类型，而是`object`. `new`运算符总是产生一个对象。我看到这样的事情：

```
function fnX(value)
{
     if (typeof value == 'string')
     {
          //Do stuff
     }
}
fnX(new String('Hello World')); 
```

期望“ `Do Stuff`”会发生，但它不会因为值的类型是对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-11-27T23:13:11.633

在原始数字的情况下，该`isNaN`方法也可以帮助您。

# .net - 如果您可以使用任何 .NET DAL 技术，您会选择什么？

> ID：472426
> 
> 赞同：8
> 
> 时间：2009-01-23T10:09:40.260
> 
> 标签：.net, linq, data-access-layer

几年后，我重新开始了 .NET 开发，现在看来，尤其是使用 LINQ，访问数据的方式已经改变并且变得更加容易。例如，在 ASP.NET MVC 网站中，我可以：

*   添加项目
*   添加 LINQ-to-SQL 类
*   将数据库表拖到 LINQ-to-SQL 对象关系设计器上，单击保存
*   通过 LINQ 单线访问和操作我的数据（我在这里学到：[http](http://www.asp.net/learn/mvc/tutorial-11-cs.aspx) ://www.asp.net/learn/mvc/tutorial-11-cs.aspx ）

这看起来很棒，但它有多真实？

*   上面的 LINQ-to-SQL 场景是您在实际项目中使用的东西，还是只是一种快速的脚手架技术，即当您开始添加、删除数据库中的字段和表时会发生什么，LINQ-to-SQL 类如何保持同步？

我如何理解这个领域的所有新技术，例如

*   亚音速适合哪里？
*   Astoria（ADO.NET 数据服务）在哪里适合？
*   NHibernate 适合哪里？
*   如何将其他数据库与 LINQ-to-SQL 一起使用（我尝试在对象关系设计器上拖动 SQLite 表并得到“不支持的错误”）或者 LINQ-to-SQL 仅适用于 SQL Server？
*   LINQ-to-XML 是否像 LINQ-to-SQL 一样工作，例如我可以将 XML 文件拖到设计器上，然后使用 LINQ 访问它们，还是我需要为此编写自己的代码？
*   LINQ-to-Entities 是否像 LINQ-to-SQL 一样工作，即自动生成的类，但只有更多选项？

*   既然我们有了 LINQ，ADO.NET 及其 DataTables 和 DataSets 是不是一项旧技术？LINQ-to-ADO.NET 有意义吗？

*   Azure 适合您甚至不再拥有 RDBMS 的地方

*   当您的 UI 只是以 REST 方式与 WCF 对话或与 Web 服务对话时，ESB 适合什么？

**既然我们有这么多的选择，如果你可以为一个项目选择这些技术中的任何一种，你会选择哪一种，为什么？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T10:35:13.610

最初的回应（主要是关于 LINQ 的东西）：

*   LINQ to SQL 是您可以在实际项目中使用的东西；我已经做好了。我们倾向于将所有数据访问代码放在当您右键单击设计图面并选择“查看代码”时生成的部分类中，而不是像单行一样分散在整个代码中。
*   使用 LINQ to SQL，如果您修改数据库，则需要删除并重新添加表 - 这有点限制，使用实体框架，您可以“从数据库更新模型”以自动添加/删除这些列。
*   它可能应该被称为 LINQ to MSSQL Server - 它直接绑定到 SQL Server。如果您想对其他数据源使用类似的工具，您可以查看实体框架 - 但是目前这有其他限制 - LINQ to SQL 就像任何概念证明一样可以工作。
*   ADO.NET 数据服务为您提供了一个基于 REST 的 ADO.NET 对象接口——因此您可以调用简单的 Web 服务来检索数据，而无需编写这些服务。
*   不，LINQ to XML 没有设计界面——我想有人可以用 XSD 做一些事情，那会很有趣；）
*   您可以将 Azure 视为“云中的操作系统”，它有一个用于存储的数据库，尽管正如您所说，它不是关系型的，没有连接，但您仍将查询它以获取结果。

要回答你的最后一个问题，我对 NHibernate 或其他人的了解还不够多，但我很乐意使用 LINQ to SQL 进行基本数据库访问，但我已经开始研究 LINQ to Entities 以获得更复杂的东西而不是其他的——主要是因为我喜欢漂亮的照片。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T10:25:13.740

[对于我们正在启动的一个新项目，在比较了我们决定选择LLBLGen](http://llblgen.com/defaultgeneric.aspx)的替代方案之后，我不得不回答同样的问题，因为：

*   它比实体框架更成熟
*   它支持 Linq 查询
*   它正在由几个专门的开发人员积极开发
*   它不贵
*   支持很棒

附言。我可能应该提到我**不**隶属于 llblgen 和/或解决方案设计。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T20:25:33.377

关于**SQLite**：我已成功使用 dbLinq 构建对 SQLite 数据库的 LINQ 查询。它仍处于起步阶段，因此希望必须在生成的类中修复一些东西，但它满足了我的需求。它会做我猜 LinqToSql 会做的所有事情的 85%。项目中有**很多单元测试**可以告诉你他们知道什么是失败的。

dbLinq 支持许多其他数据库（MySQL、PostgreSQL、Firebird）。除了 SQLite，我没有将它用于其他任何东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T10:45:05.727

我也使用 linq2sql，效果很好。一旦您意识到生成的类是部分的，您就可以将自定义代码、字段等放在那里。我几乎从生成的 linq2sql 类中创建了我的业务类。

一个警告： varchar(1) 默认转换为 char。这给我带来了麻烦，因为 varchar(1) 可以是 "" 而 char 不能...然而，在属性窗口中简单地切换到字符串解决了这个问题。

# c# - 旋转图像数学 (C#)

> ID：472428
> 
> 赞同：11
> 
> 时间：2009-01-23T10:11:06.717
> 
> 标签：c#, math, image, rotation

我有一个带有两个点的图像，对齐如下：

```
|----------------|
|                |
|    .           |
|                |
|          .     |
|                |
|----------------| 
```

我有两个点的 X、Y 坐标，我需要将图像旋转 X 度，所以它看起来像这样：

```
|----------------|
|                |
|                |
|    .     .     |
|                |
|                |
|----------------| 
```

基本上，它们彼此对齐，这是什么数学？（C# 中的代码示例会更好，但不是必需的）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-23T10:30:19.733

这取决于您想将哪个点用作旋转的“中心”。让我们将这个点称为左上点 A 和右下点 B。如果你想围绕 A 点旋转，使 B 点与它对齐，那么以弧度计算旋转角度将如下所示：

```
double angle = Math.Atan2(pointB.Y - pointA.Y, pointB.X - pointA.X); 
```

我不知道您如何处理您的图像，因此仅当您使用 System.Drawing.Graphics 时，以下内容才适用：

```
myImage.TranslateTransform(-pointA.X, -pointA.Y);
myImage.RotateTransform((float) angle, MatrixOrder.Append);
myImage.TranslateTransform(pointA.X, pointA.Y, MatrixOrder.Append); 
```

希望能帮助到你。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-23T10:23:29.670

没有代码，对不起，但一个策略。

您需要能够通过对源图像进行采样来创建结果图像。您知道旋转角度，因此您现在需要创建一个映射器函数，将结果映射回原始值。

该代码将简单地扫描结果图像的每一行，并将像素映射回原始图像。你可以做一个简单的；

```
for (int plotY = 0; plotY < resultHeight; plotY++)
{
   for (int plotX = 0; plotX < resultWidth; plotX++)
   {
         resultImage.PlotPixel(getOriginalPixel(plotX, plotY, angleOfRotation));
   } 
} 
```

所以现在我们只需要神奇的“getOriginalPixel”方法，这就是数学的用武之地。

如果我们将图像旋转 0 度，那么 plotX, plotY 就是原始图像的 X/Y。但这并不好玩。

```
pickX = x * cos(angle) - y * sin(angle)
pickY = y * cos(angle) + x * sin(angle) 
```

我认为将映射到源像素。您需要检查它是否超出范围，然后返回黑色或其他东西:)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-02-16T16:28:03.710

下面的代码有效

```
 Matrix mRotate = new Matrix();
    mRotate.Translate(Convert.ToInt32(Width.Value) / -2, Convert.ToInt32(Height.Value) / -2, MatrixOrder.Append);
    mRotate.RotateAt(theta, new Point(0, 0), MatrixOrder.Append);

    using (GraphicsPath gp = new GraphicsPath())
    {  // transform image points by rotation matrix
        gp.AddPolygon(new Point[] { new Point(0, 0), new Point(Convert.ToInt32(Width.Value), 0), new Point(0, Convert.ToInt32(Height.Value)) });
        gp.Transform(mRotate);
        PointF[] pts = gp.PathPoints;

        // create destination bitmap sized to contain rotated source image
        Rectangle bbox = boundingBox(bmpSrc, mRotate);
        Bitmap bmpDest = new Bitmap(bbox.Width, bbox.Height);

        using (Graphics gDest = Graphics.FromImage(bmpDest))
        {  // draw source into dest

            Matrix mDest = new Matrix();
            mDest.Translate(bmpDest.Width / 2, bmpDest.Height / 2, MatrixOrder.Append);
            gDest.Transform = mDest;
            gDest.DrawImage(bmpSrc, pts);
            gDest.DrawRectangle(Pens.Transparent, bbox);
            //drawAxes(gDest, Color.Red, 0, 0, 1, 100, "");
            return bmpDest;
        }
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T10:22:25.977

您需要查找几何旋转矩阵：[有关详细说明，请参阅此站点](http://mathworld.wolfram.com/RotationMatrix.html)

但是，为了获得最佳结果，您需要从目标转换到源，然后对每个目标像素使用转换：

```
m = rotation matrix

for each point p in destination
  p' = p.m
  get pixel p' from source
  set pixle p in destination 
```

有，在 .net 框架方法来做这一切：`System.Drawing.Graphics.RotateTransform`和`System.Drawing.Graphics.TranslateTransform`. 您将需要设置平移以将图像的旋转点移动到原点，然后应用旋转，然后再应用另一个平移以将其返回到原始位置。您需要对这些函数进行试验以了解它们的行为方式——我目前正在工作，没有时间将一些有效的代码放在一起。:-(

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T10:25:26.483

首先找到中心点：

```
Point p = new Point((x1-x2)/2, (y1-y2)/2) 
```

然后使用三角法求解角度。我将假设我们已经将原点重新定位到我们的中心点，所以我现在有一个新的 x3 和 y3 到其中一个点。

```
hypotenuse = SqrRt(x3^2 + y3^2) 
```

我们正在解决未知的角度`TH`

```
Sin(TH) = opposite / hypotenuse 
```

所以要解决 TH 我们需要：

```
TH = Asin(y3 / hypotenuse) 
```

旋转`TH`。

请参阅[维基百科以获取三角函数参考](http://en.wikipedia.org/wiki/Trigonometric_functions)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-23T11:22:56.807

执行一般的 2D 变换涉及求解一对具有 6 个未知数的方程。

'x = xA + yB + C

'y = xD + yE + D

给定 3 个对应点，您将有 6 个已知值，系统就可以求解。在这种情况下，您只有 4 个点，因为您不关心剪切，但您可以想象将第 3 个点与其他两个点形成的直线呈 90 度角。然后（伪编码）创建一个旋转的图像就像：

```
for ( y = 0; y < height; y++ )
 for ( x = 0; x < width; x++ )
  {
    newx = x*A + y*B + C;
    newy = x*D + y*D + E;
    newimage(x,y ) = oldimage( newx, newy );
  }
} 
```

如果性能很重要，则可以通过注意 y*B 仅在外观上发生变化以及 newx,newy 在内循环中由常数 A 和 D 变化来优化内循环中的乘法。

# c# - 无法在 Silverlight 中终止工作线程

> ID：472431
> 
> 赞同：4
> 
> 时间：2009-01-23T10:11:45.437
> 
> 标签：c#, .net, silverlight, multithreading

我正在开发一个多线程 Silverlight 应用程序。

该应用程序有两个线程：Main/UI 和一个后台工作线程。

UI 线程应该能够杀死后台线程，如下所示：

```
private Thread executionThread;

....

executionThread = new Thread(ExecuteStart);
executionThread.Start();

....

executionThread.Abort(); // when the user clicks "Stop" 
```

最后一行引发了一个异常：

> MethodAccessException：尝试访问该方法失败：System.Threading.Thread.Abort()

任何的想法？为什么我不能中止 Silverlight 中的线程？

谢谢，奈米

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T11:02:56.410

与其为此目的手动创建线程，不如考虑使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker(VS.95).aspx)类。

此类具有在 WorkerSupportsCancellation = true 时取消异步操作的内置功能。

有关如何在 Silverlight 中使用 BackgroundWorker的[完整示例](http://msdn.microsoft.com/en-us/library/cc221403(VS.95).aspx)，请查看 MSDN 上的这篇文章。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T10:26:58.680

它已记录在案，请参阅[Thread.Abort()](http://msdn.microsoft.com/en-us/library/ty8d3wta(VS.95).aspx)

> 此成员具有 SecurityCriticalAttribute 特性，该特性将其限制为供 .NET Framework for Silverlight 类库内部使用。使用此成员的应用程序代码会引发 MethodAccessException。

您可以使用[ManualResetEvent](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent(VS.95).aspx)（一种线程安全的通信方法）来通知后台线程停止。

后台线程中的示例代码：

```
if (!shouldStop.WaitOne(0)) 
// you could also sleep 5 seconds by using 5000, but still be stopped 
// after just 2 seconds by the other thread.
{
    // do thread stuff
}
else
{
    // do cleanup stuff and exit thread.
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T10:32:24.287

正如 Davy 所指出的，由于 Silverlight 代码来自 Internet，因此通常不受信任，并且其执行受到更多限制。相反，在后台线程规范的类中实现布尔退出标志，以便您可以提高此标志并使用 Thread.Join() 代替。

# sql-server - 基于字符的数据的数据库列大小

> ID：472434
> 
> 赞同：3
> 
> 时间：2009-01-23T10:12:52.000
> 
> 标签：sql-server, performance, database-design

我刚刚遇到一个数据库，其中所有基于字符的列的大小都指定为 8 的倍数（例如 Username = varchar(32)、Forename = nvarchar(128) 等）。这会对性能有任何影响吗？数据库还是完全没有意义？

谢谢。

注意 这是在 SQL 2000 数据库中。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T10:21:33.980

由于它们是 VARchars，因此实际使用的空间基于内容。如果它们是 CHAR，我会开始担心。

-Edoode

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T10:29:11.860

这可能只是一些老派开发人员的习惯。正如它所说 - varchar 只要它需要，所以当字符串长度为 22 时，32 或 33 无关紧要。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-24T04:05:17.500

“这会对数据库的性能产生影响还是完全没有意义？”

它对性能几乎没有影响（不是没有，而是很少）。它可能对备用空间分配产生影响，因为使用此方案的“最大”行大小可能非常大。每页几行可能会减慢大型表的检索速度。

然而，与不正确的索引相比，差异通常是微观的。

让尺寸“正确”是不值得的。在过去，老派 DBA 对每个角色都汗流浃背。磁盘过去很昂贵，每个字节对成本都有真正的影响。

既然磁盘如此便宜，DBA 浪费在大小问题上的时间比磁盘成本更高。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-24T15:55:02.060

我从未见过它在表存储、连接或基本操作方面有什么不同。

但我已经看到它在涉及字符串处理的地方有所不同。

在 SQL Server 2005 中，我见过的唯一一种 varchar 大小产生显着差异的情况是，当事物被强制转换为 varchar(MAX) 或 UDF 时。那里似乎有一些差异 - 例如，我有一个系统/进程，我正在移植一些键列，这些键列必须连接在一起进入另一个伪键域（直到我能够重构这个可憎的）和查询在中间 CTE 或嵌套查询中尽快将结果转换为 varchar(45) 执行得更好。

例如，我见过这样的情况，UDF 获取和返回 varchar(MAX) 的性能明显低于获取和返回 varchar(50) 的情况。例如，某人（也许是我！）试图做未来证明的修剪或填充功能。varchar(MAX) 有它的位置，但根据我的经验，它可能对性能造成危险。

我不认为我描述了 varchar(50) 和 varchar(1000) 之间的区别。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T10:16:59.030

对我来说似乎是过早的优化。

我认为这不会对数据库产生任何性能变化。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-24T04:07:49.273

如果它们都是 5 或 10 的倍数，你会不会有同样的担忧，这是正常情况下发生的情况。？

# web-services - flex 3 获取 webserice 调用以等待结果

> ID：472441
> 
> 赞同：2
> 
> 时间：2009-01-23T10:15:25.583
> 
> 标签：web-services, apache-flex

我有一个从 web 服务中检索值的函数，然后遍历返回的值，并为每个返回的值执行另一个 web 服务查找。

但是我有一个问题，当我在 for 循环中进行第二次 web 服务调用时，该函数不会等待 reuslt 而是继续处理，反过来又没有给我任何价值

代码如下所示；

```
 private function getResult(e:ResultEvent):void{

   var lengthOfResult:int = e.result.length;
   var arrayCollResults:ArrayCollection = new ArrayCollection();
   var resultArray:Array = new Array(e.result);

       for(var i:int = 0 ; i < lengthOfResult; i++){
      var currentName:String = e.result[i].toString();
      arrayCollResults.addItem(e.result[i] + ws.getMatches(currentName)); 
   }

   acu.dataProvider = arrayCollResults;
   } 
```

我能做些什么来确保 ws.getMatches(currentName) 的值在移动到下一行之前实际上返回一个值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T12:14:12.397

[此处](http://livedocs.adobe.com/flex/3/html/help.html?content=data_access_3.html)的文档表明您不直接调用 Web 服务，您需要设置事件侦听器并处理完成交付时的响应。

从“在 ActionScript 中调用 Web 服务”部分：

```
<?xml version="1.0"?>
<!-- fds\rpc\WebServiceInAS.mxml --> 
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:Script>
        <![CDATA[
        import mx.rpc.soap.WebService;
        import mx.rpc.events.ResultEvent;
        import mx.rpc.events.FaultEvent;
        private var ws:WebService;
        public function useWebService(intArg:int, strArg:String):void {
            ws = new WebService();
            ws.destination = "echoArgService";
            ws.echoArgs.addEventListener("result", echoResultHandler);
            ws.addEventListener("fault", faultHandler);
            ws.loadWSDL();
            ws.echoArgs(intArg, strArg);
        }

        public function echoResultHandler(event:ResultEvent):void {
            var retStr:String = event.result.echoStr;
            var retInt:int = event.result.echoInt;
         //Do something.
        }

        public function faultHandler(event:FaultEvent):void {
      //deal with event.fault.faultString, etc
        }
        ]]>
    </mx:Script>
</mx:Application> 
```

将“arrayCollResults.addItem(...)”段放入 ws.getMatches() 事件的结果处理程序中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T11:49:06.207

据我所知，flex/as3 不能对结果进行阻塞等待——您必须添加一个侦听器并等待收到通知。

# sql - 单引号的 SQLServer 函数

> ID：472443
> 
> 赞同：5
> 
> 时间：2009-01-23T10:15:51.403
> 
> 标签：sql, tsql

对于存储过程中的动态 TSQL 语句，我需要将几个字符串用单引号括起来。我绝对确定不会传递单引号值（这些字段在应用程序级别不可“编辑”，只能选择），因此我的要求在这方面非常温和。

我想出的解决方案很简单但很好：

声明@SingleQuote nvarchar(1)

选择@SingleQuote = ''''

然后到处使用它:-)

但是，如果有更好的方法，即像 newid() 一样的 SQL 函数来生成新的 GUID，那将会很有帮助。

然后我只需要做类似的事情：

选择.....单引号（MyField）......

有什么建议吗？

感谢您花时间阅读本文，

安德鲁

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-23T10:22:19.300

```
select QUOTENAME(FieldName, CHAR(39)) 
```

# .net - 将 LinqToSql 与 NLog 一起使用

> ID：472448
> 
> 赞同：0
> 
> 时间：2009-01-23T10:17:51.633
> 
> 标签：.net, sql, linq, linq-to-sql, nlog

我正在编写一个 .NET 3.5 Web 应用程序，它使用 LinqToSql 来处理基本的数据库内容。我想使用 nLog 库进行日志记录。这个库可以使用良好的老式存储过程登录到数据库（并不是说这有什么问题..），但我想使用 LingToSql DataContext 登录到数据库

有谁知道如何做到这一点？我知道 nLog 的 2.0 版即将推出，但它还没有在这里......

-Edoode

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T10:21:37.710

[在 NLog 中编写自己的目标](http://www.nlog-project.org/howto_write_target.html)

如果您希望使用 LINQ 来执行此操作，请创建您自己的目标来写入。我不明白为什么如果你有 SProcs，使用 C# 将消息写入数据库（禁止批量加载）的最快方法是通过本机 SQL api 并调用存储过程。另外，如果有人已经为您编写了数据库目标...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-11T08:22:00.353

我认为@edosoft 正在寻找的是这样的：

[http://weblogs.asp.net/grantbarrington/archive/2010/02/08/sending-the-output-from-linq-to-sql-to-a-log-file.aspx](http://weblogs.asp.net/grantbarrington/archive/2010/02/08/sending-the-output-from-linq-to-sql-to-a-log-file.aspx)

您可以分配给 DataContext.Log 属性而不是 Console.Out 的简单 TextWriter 以使用 NLog 注册 LinqToSql 日志记录。

# ruby-on-rails - 如何使用来自 Rails 的 css 和图像创建电子邮件？

> ID：472450
> 
> 赞同：26
> 
> 时间：2009-01-23T10:20:23.000
> 
> 标签：ruby-on-rails, css, email, actionmailer

您如何从 Rails 应用程序创建和发送包含图像和正确格式的电子邮件？喜欢你从 facebook 获得的那些和喜欢的。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-01-23T13:38:11.307

假设您知道如何使用 ActionMailer 从 Rails 发送普通的纯文本电子邮件，为了让`HTML`电子邮件正常工作，您需要为电子邮件设置内容类型。

例如，您的通知程序可能如下所示：

```
class MyMailer < ActionMailer::Base
  def signup_notification(recipient)
    recipients   recipient.email_address_with_name
    subject      "New account information"
    from         "system@example.com"
    body         :user => recipient
    content_type "text/html"
  end
end 
```

注意`content_type "text/html"`线。这告诉 ActionMailer 发送一封内容类型为 的电子邮件，`text/html`而不是默认的`text/plain`。

接下来你必须让你的邮件视图输出`HTML`。例如，您的视图文件`app/views/my_mailer/signup_notification.html.erb`可能如下所示：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style type="text/css" media="screen">
      h3 { color: #f00; }
      ul { list-style: none; }
    </style>
</head>
<body>
  <h3>Your account signup details are below</h3>
  <ul>
    <li>Name: <%= @user.name %></li>
    <li>Login: <%= @user.login %></li>
    <li>E-mail: <%= @user.email_address %></li>
  </ul>
</body>
</html> 
```

如您所见，`HTML`视图可以包含一个`<style>`标签来定义基本样式。并非全部支持`HTML`，`CSS`尤其是在所有邮件客户端中，但您绝对应该对文本样式有足够的格式控制。

如果您打算显示附加的电子邮件，嵌入图像会有点棘手。如果您只是包含来自外部站点的电子邮件，您可以`<img />`像通常在`HTML`. 但是，在用户授权之前，许多邮件客户端会阻止显示这些图像。如果您需要显示附加图像，Rails 插件[Inline Attachments](http://rubyforge.org/frs/?group_id=4569)可能值得一看。

有关 Rails 邮件支持的更多信息，[ActionMailer 文档](http://api.rubyonrails.org/classes/ActionMailer/Base.html)是一个很好的资源

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-17T22:37:44.193

对于图像，您可以在`image_tag`定义后使用普通助手`ActionMailer::Base.asset_host = 'http://www.your-domain.com'`

我使用回形针来存储我的图像，所以在我的情况下，我可以使用它将图像添加到电子邮件中。

```
image_tag result.photo.url(:small) 
```

# svn - 我可以通过网络浏览器访问 SVN 和 ssh://someAddress 吗？

> ID：472456
> 
> 赞同：1
> 
> 时间：2009-01-23T10:22:31.233
> 
> 标签：svn, tortoisesvn

我可以`ssh://someAddress`通过网络浏览器访问 Subversion 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T10:26:09.963

不，该访问方案的“svn”部分意味着要使用的协议是 SVN 自己的，然后包装在 SSH 中以使其安全。由于 SVN 不是大多数 Web 浏览器原生支持的协议，因此您需要一个 SVN 到 Web 的“网关”，即 SVN 主机还必须运行一个 Web 服务器，该服务器又必须访问 SVN 存储库并使其可用通过 HTTP。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T11:05:41.067

使用[SVNProtocolHandler](http://tortoisesvn.net/SVNProtocolHandler)您可以在 Internet Explorer 中访问 svn:// url。它甚至支持 svn+ssh:// 协议，但它需要一个配置好的 ssh 客户端。

**注意：** SVNProtocolHandler 由 TortoiseSVN 的主要开发者创建，但不是 TortoiseSVN 的一部分。

[ **@Stefan**：感谢更新]

# sql-server - SQL 2005：代理作业步骤输出文件命名

> ID：472460
> 
> 赞同：0
> 
> 时间：2009-01-23T10:24:37.470
> 
> 标签：sql-server

请问有谁知道，是否有办法在 SQL Server 喜欢的文件路径中指定“这台机器”？

我有一个代理工作，我想在我的所有服务器上编写脚本。它输出到本地机器上的文件，所以我想将文件名编写为

```
\\localhost\<shared-folder-name>\<file-name> 
```

另一个原因是我计划使用日志传送来进行灾难恢复，并且我希望这些作业在它们运行的​​任何服务器上都能正常工作。该脚本可以很好地设置作业，但是当我运行作业时出现错误“无法打开步骤输出文件”。我想我已经消除了共享和文件夹权限：它适用于`C:\<folder-name>\<file-name>`.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T14:22:53.120

你试过@@SERVERNAME 吗？

```
SELECT @@SERVERNAME 
```

或者您可以使用它，如果您有多个 SQl 服务器实例正在运行，您可以使用第二个

```
SELECT serverproperty('MachineName'),serverproperty('Instancename') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-08T12:23:10.533

将文件夹放在所有机器上的相同位置。

c:\SharedSQLLogFiles.....

如果您不希望它们位于同一位置，请创建一个指向实际位置的 Junction C:\SharedSQLLogFiles。

通过这种方式，您可以简单地将文件位置编写为本地路径，但仍然能够从远程共享访问文件。

干杯，本

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T18:35:29.130

当您编写脚本时，您可以使用该`@output_file_name`参数

```
EXECUTE msdb.dbo.sp_add_jobstep @job_name = @JobName01, @step_name = @JobName01, 
@subsystem = 'CMDEXEC', @command = @JobCommand01, @output_file_name = @OutputFile 
```

要设置输出日志名称，我们可以这样做

```
SET @OutputFile = @LogDirectory + '\SQLAGENT_JOB_$(ESCAPE_SQUOTE(JOBID))_$(ESCAPE_SQUOTE(STEPID))_$(ESCAPE_SQUOTE(STRTDT))_$(ESCAPE_SQUOTE(STRTTM)).txt'

To get the server name
$(ESCAPE_SQUOTE(SRVR)) 
```

# refactoring - 重构一词的由来

> ID：472473
> 
> 赞同：11
> 
> 时间：2009-01-23T10:30:13.947
> 
> 标签：refactoring

代码重构是在不修改其外部行为或现有功能的情况下更改计算机程序内部结构的过程。

重构这个词的起源是什么，为什么选择它来表示上述内容？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-23T10:35:29.897

Factor起源于拉丁语，词根意味着[制造商或制造商](http://www.latin-dictionary.org/JM-Latin-English-Dictionary/factor)（因此工厂，制造等）。因子的数学意义可能被解释为“这个数字是如何产生的”。

所以re-factor仅仅意味着re-make

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-23T12:45:48.743

In [Refactoring](http://en.wikipedia.org/wiki/Refactoring#History), Fowler wrote that he hasn't *"succeded in pinning down the real birth of the term Refactoring"*. [Wikipedia](http://en.wikipedia.org/wiki/Refactoring#History) mentions the term was used by Forth programmers in the 80s, Fowler also spoke about the Smalltalk community.

Math factorization's certainly helped coining this term as you don't change the value of a mathematical expression what you factorize it.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T10:34:22.597

在数学中，分解（[http://en.wikipedia.org/wiki/Factorization](http://en.wikipedia.org/wiki/Factorization)）是将表达式简化为最简单的形式。当然同样适用于这里吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-15T00:33:29.687

Martin Fowler 写了一篇关于[重构的词源学的](http://martinfowler.com/bliki/EtymologyOfRefactoring.html)文章。报价：

> 我们现在所说的重构的基础来自 Smalltalk 社区。然而，分解程序的隐喻也是 Forth 社区的一部分。[Bill Wake 在 1984 年 Leo Brodie 的著作 Thinking Forth 中挖出了](http://laputan.org/catfish/2011/03/post.html)已知的第一个关于“重构”一词的印刷提及。我们很确定这种用法并没有从 Forth 社区传到 Smalltalk 社区，而是独立开发的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-15T00:14:54.630

[According to Brian Foote](http://laputan.org/catfish/2011/03/post.html), the first use of the technical word "refactoring" in print appeared in the book "Thinking Forth" in 1984.

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-01-23T10:39:34.193

最有可能的是，在软件方面，它是由 Martin Fowler [http://www.refactoring.com/创造的](http://www.refactoring.com/)

# winapi - 为什么我的服务在 Vista 上的 DebugBreak() 处崩溃？

> ID：472476
> 
> 赞同：3
> 
> 时间：2009-01-23T10:32:02.930
> 
> 标签：winapi, windows-vista, service, crash, breakpoints

我正在用 C++ 编写一个 Win32 服务。我有一个调用 DebugBreak() 的自定义 Assert 宏（除其他外）。当我在 Vista 下运行我的服务时，服务在到达 DebugBreak() 调用（一个 int 3 汇编器操作码）时崩溃，显示 vista 崩溃对话框。错误代码是 80000003（硬编码断点）。

通常我希望我的服务在没有附加调试器时运行在 DebugBreak() 调用上而不做任何事情。为什么会崩溃？是否有可能更改设置以使其继续运行？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T10:52:50.453

它正在崩溃，因为它是一个断点**异常**。为了安全起见，您需要检查是否附加了调试器：

> if(::IsDebuggerPresent())::DebugBreak();

或使用 try/except 并为过滤器中的断点异常返回 1（带有空处理程序的异常执行处理程序）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T10:49:58.853

> 通常我希望我的服务在没有附加调试器时运行在 DebugBreak() 调用上而不做任何事情。为什么会崩溃？

DebugBreak 函数的[MSDN 帮助](http://msdn.microsoft.com/en-us/library/ms679297(VS.85).aspx)说：“如果进程没有被调试，该函数使用标准异常处理程序的搜索逻辑。在大多数情况下，这会导致调用进程由于未处理的断点异常而终止。”

> 是否有可能更改设置以使其继续运行？

您可以尝试添加结构化异常处理程序。

或者，在调用 DebugBreak 之前检查一些运行时标志。

# asp.net - ASP.NET 页面特定配置

> ID：472478
> 
> 赞同：4
> 
> 时间：2009-01-23T10:32:27.937
> 
> 标签：asp.net, configuration, web-config

有什么方法可以使 web.config 文件的某些部分仅适用于单个文件（或目录，或一组文件等）

基本上我只想将以下内容应用于应用程序中的单个页面，其余的应该使用默认设置：（它将上传大小限制为 32M）

```
<system.web>
  <httpRuntime maxRequestLength="32768" executionTimeout="360"/>
</system.web> 
```

关键是我只希望该特定页面接受大文件。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-23T10:51:46.713

您可以使用：

```
 <location path="UploadPage.aspx">
    <system.web>
      <httpRuntime maxRequestLength="33554432" executionTimeout="360" />
    </system.web>
  </location> 
```

更多信息[在这里](http://msdn.microsoft.com/en-us/library/b6x6shw7.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T10:38:43.587

您可以将 web.config 文件放在 Web 应用程序的任何目录中，您在其中定义的内容仅适用于该目录，并且如下所示

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T10:42:45.733

您也可以使用[`<location>`标签](http://msdn.microsoft.com/en-us/library/ms178692.aspx)尝试它，但是我不确定您是否可以将它与标签一起使用`<httpRuntime>`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T10:53:30.810

是的，使用 <location path="..."> 元素来实现这一点。该路径可能指向一个目录以及一个文件。您将需要设置 allowDefinition="everywhere"。

# css - css图标高度问题

> ID：472485
> 
> 赞同：1
> 
> 时间：2009-01-23T10:38:24.197
> 
> 标签：css, internet-explorer, formatting, icons, html

我想在我的 HTML 页面中使用一种标准的方法来格式化“显示更多”链接。

在 HTML 中，我使用：

```
<span class="showMore">Show more details</span> 
```

然后在css中，我有：

```
.showMore {
    color: #0E4B82;
    padding-left: 18px;
    background: url("images/icons/add.png") no-repeat 0px 0px;
}

.showMore:hover {
    color: #F5891D;
    cursor: pointer;
} 
```

其中[add.png](http://www.peopleperhour.com/images/icons/add.png)是一个 16x16 的 famfamfam 丝绸图标。我使用 JavaScript 使用`onclick`事件来扩展一些内容部分。

这在 Firefox 3.0.5 中运行良好，但在 IE 7 中，图标的最后几个像素被切掉了。我正在寻找一种解决方法。使用 height 不适用于像`<span/>`. 添加透明边框修复了 IE7 中的问题：

```
.showMore {
    border: 1px solid transparent;
    color: #0E4B82;
    padding-left: 18px;
    background: url("images/icons/add.png") no-repeat 0px 0px;
} 
```

但是 IE6 不处理透明度。使文本更大可以解决问题，但我不想要大文本。`line-height`不起作用。任何人都知道有什么可以帮助的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T10:57:25.967

我已经解决了这个问题。我不知道为什么，但使用`no-repeat center left`而不是`no-repeat top left`确保 IE 不会切断图标的底部 2px。为什么使用`center`而不是`top`应该导致图像更高是奇怪的，但那是你的 IE？

```
.showMore {
    color: #0E4B82;
    padding-left: 18px;
    background: url("images/icons/add.png") no-repeat center left;
}

.showMore:hover {
    color: #F5891D;
    cursor: pointer;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T10:54:21.013

做

```
display: block;
height: 16px; 
```

帮助修复跨度的高度？

# c# - IEnumerable 中求和、平均、连接等项目的实现选项

> ID：472488
> 
> 赞同：2
> 
> 时间：2009-01-23T10:38:58.203
> 
> 标签：c#, .net, linq, delegates, anonymous-methods

我正在寻找最短的代码来创建对 IEnumerable 中的项目执行常见操作的方法。

例如：

```
public interface IPupil
{
    string Name { get; set; }
    int Age { get; set; }
} 
```

1.  对属性求和 - 例如 IEnumerable<IPupil> 中的 IPupil.Age
2.  平均一个属性 - 例如 IEnumerable<IPupil> 中的 IPupil.Age
3.  构建 CSV 字符串 - 例如 IEnumerable<IPupil> 中的 IPupil.Name

我对解决这些示例的各种方法感兴趣：foreach（长手）、委托、LINQ、匿名方法等......

抱歉措辞不佳，我无法准确描述我所追求的！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T10:43:52.407

求和和平均：使用 LINQ 很容易：

```
var sum = pupils.Sum(pupil => pupil.Age);
var average = pupils.Average(pupil => pupil.Age); 
```

构建 CSV 字符串 - 这里有多种选择，包括编写您自己的扩展方法。不过，这将起作用：

```
var csv = string.Join(",", pupils.Select(pupil => pupil.Name).ToArray()); 
```

请注意，使用普通 LINQ 一次通过数据计算*多个*事物（例如平均值*和总和）是很棘手的。*如果您对此感兴趣，请查看Marc Gravell 和我编写的[Push LINQ项目。](http://msmvps.com/blogs/jon_skeet/archive/2008/01/04/quot-push-quot-linq-revisited-next-attempt-at-an-explanation.aspx)这是一个非常专业的要求。

# php - PHP正则表达式获取特定跨度元素的内容

> ID：472496
> 
> 赞同：0
> 
> 时间：2009-01-23T10:41:12.473
> 
> 标签：php, regex

我需要一些帮助...当涉及到正则表达式时，我有点（阅读总数）n00b，并且需要一些帮助来编写一个从 PHP 中查找包含在特定 HTML 标记中的特定文本。

源字符串如下所示：

```
<span lang="en">English Content</span><span lang="fr">French content</span> ... etc ... 
```

我想只提取特定语言的元素文本。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T10:47:06.987

有很多可用于 PHP 的 HTML 解析器。我建议您查看其中之一（例如：[PHP Simple HTML DOM Parser](http://sourceforge.net/projects/simplehtmldom/)）。

尝试用正则表达式阅读 HTML 比你想象的要容易得多，而且比你希望的要避免得多（尤其是当你不完全了解正则表达式，并且你的输入不能保证是 100% 时）干净的 HTML）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T10:47:21.730

（坏的，不工作的）例子说明了为什么你不应该使用正则表达式来解析 html。

```
/<span lang="en">(.*)<\/span>/ 
```

将输出：

```
English Content</span><span lang="fr">French content 
```

更多阅读内容：

[解析：超越正则表达式](http://www.codinghorror.com/blog/archives/000253.html)

[第 2,295,485 次不解析 HTML-WITH-REGULAR-EXPRESSIONS](http://blog.mikeseth.com/index.php?/archives/1-For-the-2,295,485th-time-DO-NOT-PARSE-HTML-WITH-REGULAR-EXPRESSIONS.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T18:40:04.567

有一个非常棒的类，可以让您在 HTML 页面上执行类似 SQL 的查询。可能值得一看：

[HTML SQL](http://www.phpclasses.org/browse/package/3086.html)

我已经使用了很多，我喜欢它。

希望有帮助...

# cocoa-touch - 在锁定屏幕上显示警报？

> ID：472497
> 
> 赞同：2
> 
> 时间：2009-01-23T10:41:22.083
> 
> 标签：cocoa-touch

在 iPhone 上，当您的手机被锁定并关闭屏幕时，如果有短信进入，屏幕会打开并显示警报。

目前我正在使用 UIAlertView 创建警报对话框（带有 2 个按钮）。如果手机已关闭/锁定，则在我重新打开并解锁之前什么都不会显示。有没有办法模拟“短信预览”行为，可能是另一个类，并希望仍然允许用户与那里的按钮进行交互？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T13:19:12.233

CFUserNotificationCreate 是你的朋友。

不在官方 iPhone SDK 中？太糟糕了，我记得一年前在尚未推出的 SDK 的大型演示中，一位 Apple 传播者/负责人说 SDK 将包含与 Apple 内部使用的完全相同的 API ... Pfff ...

/约翰

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T14:02:56.047

SDK 目前不支持您想要执行的操作。您应该[向 Apple 提出请求](http://bugreporter.apple.com)。

# javascript - 使用 Javascript 检测放入 textarea

> ID：472498
> 
> 赞同：1
> 
> 时间：2009-01-23T10:41:24.347
> 
> 标签：javascript, drag-and-drop, textarea, detect

我所需要的只是能够检测到文本何时被放入 Textarea。然后我获取该文本并对其进行处理并清除文本区域。可能有很多这样的文本区域和非常高的 UI 期望，所以轮询是最后的手段。

对于 IE，“onfocus”可以解决问题，因为在用户将内容放入 textarea 后会触发此事件。

对于 Firefox，我找不到有效的事件。我已经尝试过 onmouseup 和 onchange .. 不知道还有什么可以尝试的。我不想不得不轮询 textarea 的内容。非常感谢帮助。谢谢。

编辑：为澄清起见，“丢弃”意味着用户（通常）从页面中选择文本，但无论在哪里，将其拖放到文本区域中都没有关系。这与 Ctrl+V 或右键单击粘贴（采用两种不同的检测方法，顺便说一句）或（显然）键入文本区域不同。具体来说，它是拖放的“拖放”方面。我真的不知道该怎么形容它。

我觉得这个问题说得比较准确。为了幽默，假设我的意思是你们都选择共享的文本区域上的任何其他操作。如果我的意思是“粘贴”，你不认为我会在我的问题的标题或内容中提到*一些*关于粘贴的内容吗？*输入*文本区域也是如此。但是，也许，你们都不够了解我，不知道我输入了我的意思，而不是错误地输入了与我的意思有点相关的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T16:51:25.097

对于 Firefox，这对我有用：

```
window.addEventHandler("dragdrop", function(event) {alert("Drop it like it's hot!")}, true) 
```

但是，在 Safari 中不起作用。没试过IE。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:32:05.243

投票似乎是唯一的出路。

当在浏览器中启动拖放操作时，它似乎取消了正在发生的所有其他事情。您可以通过在页面上放置“onmouseover”事件，然后启动 DnD 操作并拖动它来见证这一点。事件不会触发。

浏览器内部处理“拖放”的方式似乎只是巧合，它会导致在 IE 和 Safari 中为 textarea 触发 onfocus()。我怀疑 W3 规范中有很多定义……没关系，W3 是垃圾，而且没有人完全遵守它。

在我的问题中，我说每次使用后清空 textarea 是很奢侈的，所以我觉得轮询： textarea.value.length>0 几乎没有任何成本，也不应该成为性能问题。

但是，唉，它特别与将内容放入文本区域有关。

Down-mod远离以减轻您的痛苦。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-23T12:07:46.323

你说的“掉”是什么意思？您是在谈论粘贴（^V）操作吗？如果是这样，Aron 的答案确实是正确的，您将获得 keydown/keyup （并且该值将在 keyup 中可读）。

对输入的任何更新都会发生的通用回调是“onchange”——你可以试试。请注意，在键入时，直到您完成并取消输入焦点后才会调用它，因此如果您需要即时更新键入和其他形式的输入，您仍然需要'onkeyup'。

编辑重新澄清：当拖放导致将内容添加到文本区域时，应触发 IMO 'onchange'；我认为它不是浏览器错误（至少在 Firefox 中）。在这种情况下，我只能同意轮询就是你所剩下的。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-23T15:43:19.260

如果您希望您的 textarea 对被删除、粘贴或键入的文本做出反应，您唯一的解决方案就是一个按钮。即使是轮询内容的计时器也无济于事。

您提到您希望用户能够在文本区域中键入文本。你提到你想在事件触发时清除文本。浏览器不可能知道用户已经完成输入。您必须依赖特定的操作。

现在对于拖放或粘贴，您可以依靠 mouseup 和 keyup 事件来检测它。

# javascript - Javascript String.replace(/\$/,str) 在jsp文件中的工作很奇怪

> ID：472500
> 
> 赞同：4
> 
> 时间：2009-01-23T10:41:59.633
> 
> 标签：javascript, regex, jsp, tomcat, el

为简单起见，我有以下名为 test.jsp 的文件：

```
<script language="javascript">
    alert("a$b".replace(/\$/g,"k"));
</script> 
```

我将此文件放在本地服务器中，然后使用 firefox 显示它： [http://localhost:8080/myproj/test.jsp](http://localhost:8080/myproj/test.jsp)。它工作正常，结果警报字符串是：

```
 akb 
```

但是当我把这个文件放在远程服务器上并使用相同的 Firefox 显示时，它的输出是： a$bk 这对我来说是不正确的。

然后我将 test.jsp 内容更改为：

```
<script language="javascript">
    alert("a$b".replace(/\\$/g,"k"));
</script> 
```

注意这里我添加了两个斜杠而不是一个。在这种情况下，它可以在远程服务器上工作，但不能在本地服务器上工作。

然后我将文件从test.jsp重命名为test.html，但是内容和我的第一种情况一样，即：

```
<script language="javascript">
    alert("a$b".replace(/\$/g,"k"));
</script> 
```

通过使用相同的 firefox，它在两台服务器上都可以正常工作。

但是我的文件需要将 javascript 嵌入到 jsp 文件中。我的文件不允许使用 .html 后缀。在这种情况下，我应该怎么做才能编写可移植的 javascript？

我的本地服务器使用的是 tomcat-5.5.26；远程服务器使用 tomcat-5.0.28。火狐版本是 3.0.4。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T11:16:11.890

JSP 2.0 Spec 说：“当 EL 评估被禁用时，\$ 将不会被识别为引用，而当 EL 评估被启用时，\$ 将被识别为 $ 的引用。” (JSP.3.3.2)

启用或禁用 EL 评估取决于许多因素：

*   如果应用服务器支持 JSP 2.0（Tomcat 5.0 和更高版本支持）
*   web.xml 描述符文件...如果声明（例如不使用 web-app_2_4.xsd 模式）它使用 Servet 2.3 规范或更早版本，EL 默认禁用。
*   JSP 配置 <el-ignored>
*   页面指​​令 isELIgnored ( `<%@ page isELIgnored=”true|false” %>`)

（有关更多详细信息，请参阅[JSP Spec 2.0](http://jcp.org/aboutJava/communityprocess/final/jsr152/)的 JSP.3.3.2 部分）

检查 EL 是否启用/禁用的简单方法是在您的页面上使用 ${request}。如果您在输出中看到“${request}”，则 EL 被禁用。如果您看到不同的内容，则它已启用。

如果您还在页面上使用 EL，您可能希望将`\$`（一个反斜杠）更改为`\\$`（两个反斜杠）以获取输出。`\$`

如果您看到本地/远程服务器之间的差异，则它们与 EL 相关的设置可能不同。您能做的最好的事情是 1) 使用 JSP 2.0、Servlet 2.4 或更高版本（启用 EL），2) 在机器上运行相同的 Web 服务器。（顺便说一句，我建议您至少将 Tomcat 5.0 升级到 5.5）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T11:37:17.243

也许您可以将 javascript 代码移动到单独的 .js 文件中？这将防止代码被解释为jsp。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T12:12:57.780

彼得明白了，西蒙的建议也是个好主意。

此外，您不需要使用正则表达式来进行简单的静态字符串替换。JS 成语是：

```
alert('a$b'.split('$').join('k')); 
```

# python - TypeError：“元组”对象不可调用

> ID：472503
> 
> 赞同：1
> 
> 时间：2009-01-23T10:42:44.250
> 
> 标签：python, django

我正在做这本书中的教程，在 24 小时内自学 django，在第 1 部分第 4 部分我陷入了这个错误。

```
Traceback (most recent call last):

  File "C:\Python25\lib\site-packages\django\core\servers\basehttp.py", line 278, in run
    self.result = application(self.environ, self.start_response)

  File "C:\Python25\lib\site-packages\django\core\servers\basehttp.py", line 635, in __call__
    return self.application(environ, start_response)

  File "C:\Python25\lib\site-packages\django\core\handlers\wsgi.py", line 239, in __call__
    response = self.get_response(request)

  File "C:\Python25\lib\site-packages\django\core\handlers\base.py", line 67, in get_response
    response = middleware_method(request)

  File "C:\Python25\Lib\site-packages\django\middleware\common.py", line 56, in process_request
    if (not _is_valid_path(request.path_info) and

  File "C:\Python25\Lib\site-packages\django\middleware\common.py", line 142, in _is_valid_path
    urlresolvers.resolve(path)

  File "C:\Python25\Lib\site-packages\django\core\urlresolvers.py", line 254, in resolve
    return get_resolver(urlconf).resolve(path)

  File "C:\Python25\Lib\site-packages\django\core\urlresolvers.py", line 181, in resolve
    for pattern in self.url_patterns:

  File "C:\Python25\Lib\site-packages\django\core\urlresolvers.py", line 205, in _get_url_patterns
    patterns = getattr(self.urlconf_module, "urlpatterns", self.urlconf_module)

  File "C:\Python25\Lib\site-packages\django\core\urlresolvers.py", line 200, in _get_urlconf_module
    self._urlconf_module = __import__(self.urlconf_name, {}, {}, [''])

  File "c:\projects\iFriends\..\iFriends\urls.py", line 17, in <module>
    (r'^admin/', include('django.contribute.admin.urls'))

TypeError: 'tuple' object is not callable 
```

有人能帮助我吗..

网址.py

```
from django.conf.urls.defaults import *

####Uncomment the next two lines to enable the admin:
#### from django.contrib import admin
#### admin.autodiscover()

urlpatterns = patterns('',
    (r'^People/$', 'iFriends.People.views.index') ,
    (r'^admin/', include('django.contrib.admin.urls')), 
    # Example:
    # (r'^iFriends/', include('iFriends.foo.urls')),

    # Uncomment the admin/doc line below and add 'django.contrib.admindocs' 
    # to INSTALLED_APPS to enable admin documentation:
    # (r'^admin/doc/', include('django.contrib.admindocs.urls')),

    # Uncomment the next line to enable the admin:

) 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-23T10:47:45.613

您以某种方式将某些函数设置为元组。请编辑问题并粘贴您的`urls.py`代码，以便我们指出错误。

我可以尝试一个**疯狂的猜测**：

```
File "c:\projects\iFriends\..\iFriends\urls.py", line 17, in <module>
   (r'^admin/', include('django.contribute.admin.urls')) 
```

这不知何故告诉我你错过了第 16 行的逗号，所以：

```
16\. (r'^/', 'some_stuff....')      # <-- missed comma here
17\. (r'^admin/', include('django.contribute.admin.urls')) 
```

只需加上逗号，它就会起作用。如果不是这样，我会把我的水晶球送去维修。粘贴代码。

# 编辑

好像你已经粘贴了`urls.py`作为答案。请编辑**问题**并将 urls.py 粘贴到那里。

无论如何，错误已经改变。你做了什么？在这个新错误中，`urls.py`不再找到，所以也许您已将其重命名？您是否更改了运行应用程序的方式？

您粘贴的文件**不是**正在运行的文件。你在粘贴`url.py`而 django 正在阅读`urls.py`吗？错误中的代码与您粘贴的代码不匹配！请粘贴正确的文件，即出现错误的文件，否则我们无能为力。

# .net - LINQ to SQL：什么让痛苦？

> ID：472509
> 
> 赞同：0
> 
> 时间：2009-01-23T10:46:02.557
> 
> 标签：.net, sql, linq, linq-to-sql

在听了很多货之后，我决定在我的个人项目中使用 LINQ to SQL。在开始使用它之前（在初始设计期间）我需要注意什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T10:54:05.570

请参阅[Linq to SQL 有什么问题？](https://stackoverflow.com/questions/165102/whats-wrong-with-linq-to-sql)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T10:53:43.463

**编辑**完全重写，因为之前的帖子具有误导性 - 道歉。

有很多传言说微软不会进一步采用 Linq2Sql。由[ADO.Net 团队博客文章](http://blogs.msdn.com/adonet/archive/2008/10/29/update-on-linq-to-sql-and-linq-to-entities-roadmap.aspx)推动。

之后，关于微软是否真的停止了 Linq2Sql 的工作，[博客](http://codebetter.com/blogs/david.hayden/archive/2008/10/31/linq-to-sql-is-dead-read-between-the-lines.aspx)和[Stack Overflow上有很多猜测。](https://stackoverflow.com/questions/253263/has-microsoft-really-killed-linq-to-sql)

如果该技术现在适合您并且可以满足您的所有需求，那就太好了。实体框架或其他一些数据访问模型 (nHibernate) 可能会更适合您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T11:30:06.947

在我看来，使用 LINQtoSQL 的最大缺点是，如果您的数据库架构发生更改，您需要重新生成您的类（并丢失您的代码），除非您使用某些第三方工具将您的数据库模型与您的数据库架构同步。

请查看[此问题](https://stackoverflow.com/questions/201443/refreshing-linq2sql-model-in-designer-without-loosing-all-properties)以获取更多详细信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T14:44:35.277

如果要写入数据，则需要主键（用于跨内存对象跟踪行标识）。这些主键最好是单列。

注意十进制精度和字符串长度。

注意任何 varchar(1) 列。这些被映射到一个.Net char，它不能保存空字符串。

# .net - XAML：如何在 Content 属性中混合文本和元素数据绑定变量？

> ID：472516
> 
> 赞同：0
> 
> 时间：2009-01-23T10:49:14.940
> 
> 标签：.net, wpf, data-binding, xaml

当数据将两个元素绑定在一起时，我如何包含绑定信息和文本，如下所示，我希望我的标签显示：

字体大小为 8.5

```
<Grid>
    <StackPanel>
        <Slider Name="theSlider" Margin="5" Minimum="8" Maximum="14"></Slider>
        <Label Content="The font size is: {Binding ElementName=theSlider, Path=Value}" FontSize="{Binding ElementName=theSlider, Path=Value}"></Label>
    </StackPanel>
</Grid> 
```

谢谢，所以这是在 .NET 3.5 中使用 ContentStringFormat 的解决方案：

```
<Grid>
    <StackPanel>
        <Slider Name="theSlider" Margin="5" Minimum="8" Maximum="14"></Slider>
        <Label Content="{Binding ElementName=theSlider, Path=Value}" ContentStringFormat="The font size is {0}."/>
    </StackPanel>
</Grid> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T11:01:03.247

几天前我在stackoverflow上学到的东西:)

如果您使用的是 3.5 SP1，您可以在绑定中使用 StringFormat 属性：http: [//blogs.msdn.com/llobo/archive/2008/05/19/wpf-3-5-sp1-feature-stringformat.aspx](http://blogs.msdn.com/llobo/archive/2008/05/19/wpf-3-5-sp1-feature-stringformat.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T10:59:35.683

对 Font-Size 使用 IValueConverter .. 并使用 2 个标签对象来拆分字符串...

高温高压

# java - JasperReport - 占用太多资源

> ID：472522
> 
> 赞同：1
> 
> 时间：2009-01-23T10:53:04.697
> 
> 标签：java, jasper-reports

所以，问题是当我们在 JasperReport 对话框中向用户显示创建的文档时。用户可以按打印图标并将其发送到打印机。

它似乎在所有三个级别上都占用了客户端计算机上的太多资源：创建报告，在屏幕上显示报告并将其发送到打印机。一个示例 PC 是 AMD Duron 800MHz 和 256MB 内存，所以我们需要看看我们是否可以做一些优化以获得更好的用户体验。

它还在具有 2GHz 处理器和 1GB RAM 的“普通”计算机上占用大量资源，因此我需要查看是否有选项可以调整 JasperReport 以减少对资源的依赖。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T14:09:19.590

过度使用子报表会增加报表的资源需求。每个子报表在填充时间产生自己的线程。此外，如果您使用的是 scriptlet 或 helpers 类，请确保它们创建的所有资源都被正确清理。还要确保您使用的是最新的 JR 包。

一注。JR api 包含一组虚拟器。当报表填充时，整个填充报表被创建为一个对象 (JasperPrint)。根据报表中的页数，此对象可能会变得非常大。可以将虚拟器配置为在达到设置的页面阈值时写入文件系统。

通常，这会减少总体内存使用量，但会增加填充时间。一个包含可能是 gzip 虚拟器，它不是写入文件系统，而是使用 gzip 压缩生成的对象。

这是有关该主题的常见问题解答：http: [//community.jaspersoft.com/wiki/support-large-reports](http://community.jaspersoft.com/wiki/support-large-reports)

它所指的例子可以通过下载JR源码获得。

[http://sourceforge.net/project/showfiles.php?group_id=36382&package_id=28579](http://sourceforge.net/project/showfiles.php?group_id=36382&package_id=28579)

从高层次来看，如果您在应用程序中运行此报告，您可以实例化虚拟器（这里是列出已知实现类的接口）：http: [//jasperreports.sourceforge.net/api/net/sf/jasperreports/引擎/JRVirtualizer.html](http://jasperreports.sourceforge.net/api/net/sf/jasperreports/engine/JRVirtualizer.html)

然后在填充时使用参考：

```
 JRDataSource ds = new JREmptyDataSource(10);
        JRFileVirtualizer virtualizer = new JRFileVirtualizer(2, "tmp");
        JasperPrint jasperPrint = fillReport(fileName, ds, virtualizer); 
```

如果您在 iReport 中，可以在选项 -> 设置中配置虚拟器。

我希望这是有帮助的。

卢克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T10:56:38.310

好吧，Jasper Reports 只是一个 jar，因此您需要更加具体：您是在 Web 应用程序（在 Tomcat、Glassfish、JBoss 等上）中运行 JasperReports，还是在 iReport 中运行它？

如果您在应用服务器中运行它，我能想到的最明显的事情是确保您使用正确的报告编译器，即 JDT 编译器。一定要确保你没有使用 beanshell 编译器。它慢得要命。

# c++ - 如何将数组大小作为模板类型的模板传递？

> ID：472530
> 
> 赞同：15
> 
> 时间：2009-01-23T10:56:19.043
> 
> 标签：c++, arrays, templates, type-inference

当我尝试将固定大小的数组传递给模板函数时，我的编译器行为异常。代码如下所示：

```
#include <algorithm>
#include <iostream>
#include <iterator>

template <typename TSize, TSize N>
void f(TSize (& array)[N]) {
    std::copy(array, array + N, std::ostream_iterator<TSize>(std::cout, " "));
    std::cout << std::endl;
}

int main() {
    int x[] = { 1, 2, 3, 4, 5 };
    unsigned int y[] = { 1, 2, 3, 4, 5 };
    f(x);
    f(y); //line 15 (see the error message)
} 
```

它在 GCC 4.1.2 中产生以下编译错误：

> ```
> test.cpp|15| error: size of array has non-integral type ‘TSize’
> test.cpp|15| error: invalid initialization of reference of type
>   ‘unsigned int (&)[1]’ from expression of type ‘unsigned int [5]’
> test.cpp|6| error: in passing argument 1 of ‘void f(TSize (&)[N])
>   [with TSize = unsigned int, TSize N = ((TSize)5)]’ 
> ```

请注意，第一次调用编译并成功。这似乎意味着虽然`int`是不可或缺的，`unsigned int`但不是。

但是，如果我将上述函数模板的声明更改为

```
template <typename TSize, unsigned int N>
void f(TSize (& array)[N]) 
```

问题就消失了！请注意，这里唯一的变化是 from`TSize N`到`unsigned int N`。

ISO/IEC FDIS 14882:1998 最终草案中的[ `dcl.type.simple`] 部分似乎暗示“整体类型”要么是有符号的，要么是无符号的：

> 说明`signed`符强制`char`对对象和位域进行签名；它与其他整数类型是多余的。

关于固定大小的数组声明，草案说 [ `dcl.array`]：

> 如果*常量表达式*( `expr.const`) 存在，它应该是一个整数常量表达式，并且它的值应该大于零。

那么为什么我的代码使用显式`unsigned`尺寸类型、推断`signed`尺寸类型而不使用推断`unsigned`尺寸类型？

**编辑**Serge 想知道我在哪里需要第一个版本。首先，这个代码示例显然被简化了。我的真实代码要复杂一些。该数组实际上是另一个数组中的索引/偏移量数组。~~因此，从逻辑上讲，数组的类型应该与其大小类型相同，以获得最大的正确性。~~否则，我可能会得到类型不匹配（例如，在`unsigned int`and之间`std::size_t`）。诚然，这在实践中应该不是问题，因为编译器会隐式转换为两种类型中较大的一种。

**编辑 2**我已纠正（谢谢，litb）： size 和 offset 在逻辑上当然是不同的类型，特别是 C 数组的偏移量是 type `std::ptrdiff_t`。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-23T12:46:56.620

嗯，标准中说`14.8.2.4 / 15`：

> 如果在具有非类型模板参数的函数模板的声明中，在函数参数列表中的表达式中使用了非类型模板参数，并且如果推导出相应的模板参数，则模板-参数类型应与模板参数的类型完全匹配，*除了从数组绑定推导出的模板参数可以是任何整数类型。*

提供此示例：

```
template<int i> class A { /* ... */ };
template<short s> void f(A<s>);
void k1() {
    A<1> a;
    f(a);    // error: deduction fails for conversion from int to short
    f<1>(a); // OK
} 
```

这表明无法编译您的代码的编译器（显然是 GCC 和 Digital Mars）做错了。我用 Comeau 测试了代码，它可以很好地编译你的代码。我认为非类型模板参数的类型是否取决于类型参数的类型没有什么不同。`14.8.2.4/2`表示模板参数应该相互独立推导，然后组合成函数参数的类型。结合 /15，它允许维度的类型是不同的整数类型，我认为你的代码都很好。与往常一样，我使用 c++-is-complicated-so-i-may-be-wrong 卡:)

**更新**：我查看了 GCC 中的段落，它吐出错误消息：

```
 ...
  type = TREE_TYPE (size);
  /* The array bound must be an integer type.  */
  if (!dependent_type_p (type) && !INTEGRAL_TYPE_P (type))
    {
      if (name)
    error ("size of array %qD has non-integral type %qT", name, type);
      else
    error ("size of array has non-integral type %qT", type);
      size = integer_one_node;
      type = TREE_TYPE (size);
    }
  ... 
```

在较早的代码块中似乎没有将大小的类型标记为依赖。由于该类型是模板参数，因此它是依赖类型（请参阅 参考资料`14.6.2.1`）。

**更新：** GCC 开发人员修复了它：[错误 #38950](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=38950)

# c# - C＃。如何在记录集上执行查询？

> ID：472535
> 
> 赞同：0
> 
> 时间：2009-01-23T10:58:29.240
> 
> 标签：c#

你好，

我正在尝试将以下 vba 代码转换为 c#，但我遇到了一些错误。希望有人可以帮助我

vba代码

```
 Open "C:\testfile.txt" For Input As #1
        varii = ""
        Do While Not EOF(1)
        Line Input #1, strField
        varii = varii & "," & strField
        Loop
        Close #1
        astrFields = Split(varii, ",")

    For intIx = 1 To UBound(astrFields)
    counter = 0
    i = i + 1

    Dim cn As New ADODB.Connection, cn2 As New ADODB.Connection
    Dim rs As ADODB.Recordset
    Dim connString As String
    Dim SelectFieldName
    Set cn = CurrentProject.Connection
    SelectFieldName = astrFields(intIx)
    Set rs = cn.OpenSchema(adSchemaColumns, _
    Array(Empty, Empty, Empty, SelectFieldName))

        If Left(rs!Table_Name, 4) <> "MSys" And Left(rs!Table_Name, 4) <> "Abfr
    " Then

strSql = "SELECT t.[" & astrFields(intIx) & "], t.fall from [" & rs!Tab
    le_Name & "] t Inner Join 01UMWELT on t.fall = [01UMWELT].fall "
            End If
    Set rs3 = CurrentDb.OpenRecordset(strSql)
    Do While Not rs3.EOF
    With rs3
    feedbackmsg = "Processing " & rs!Table_Name & " Record no : "
    & .Fields(1)
    SysCmd acSysCmdSetStatus, feedbackmsg
    varii = Nz(.Fields(astrFields(intIx)), "NullValue")
    If varii = "NullValue" Then
    Call .Edit
    .Fields(astrFields(intIx)) = 888
    Call .Update 
```

这是到目前为止我编写的 c# 代码

```
FileInfo theSourceFile = new FileInfo("C:\\csharp\\testfile.txt");
            StreamReader reader = theSourceFile.OpenText();
            varii = "";

            do
            {
                text = reader.ReadLine();
                varii = varii + "," + reader.ReadLine();
                //Console.WriteLine(text); 

            } while (text != null);

            string[] split = varii.Split(new Char[] {' '});

            foreach (string s in split)
            {

                if (s.Trim() != "")
                    Console.WriteLine(s);
            }

                    int temp = split.GetUpperBound(1);
                    for (intix = 1; intix <= temp; intix++)
                    {
                        counter = 0;

                        i++;
                        ADODB.Connection cn = new ADODB.Connection();
                        ADODB.Connection cn2 = new ADODB.Connection();
                        ADODB.Recordset rs;
                        object selectfieldname;

                        //ConnectionClass conDatabase = new ADODB.Connection();

                        cn.ConnectionString = "Provider=Microsoft.Jet.OLEDB.4.0;" +
                                              "Data Source='C:\\csharp\\accident_database.mdb';";

                        rs = cn.OpenSchema(ADODB.SchemaEnum.adSchemaTables, Missing.Value, Missing.Value);

                        if (Microsoft.Vbe.Left(rs.Fields("Table_Name").Value, 4) != "MSys" && +
                            Microsoft.Vbe.Left(rs.Fields("Table_Name").Value, 4) != "Abfr")
                        {
                            strsql = "SELECT t.[" + split(intix) + "],t.fall from [" + rs.Fields("Table_Name").Value + "]" +
                                    "t Inner join 01umwelt on t.fall = [01umwelt].fall";

                        }
                        rs3 = CurrentDB.OpenRecordset(strsql);

                        while (!rs3.EOF)
                        {

                            feedbackmsg = "Processing" + rs.Fields("Table_Name").Value + "Record no:" + rs3.Fields(1).Value;
                            SysCmd acSysCmdSetStatus, feecbackmsg;
                            varii = Nz(rs3.Fields(astrfields(intix)).Value, "NullValue");

                            if (varii == "NullValue")
                            {
                                rs3.Edit();
                                rs3.Fields[astrfields(intix)].Value = 888;
                                rs3.Update(); 
```

我在 if 语句中收到错误

```
if (Microsoft.Vbe.Left(rs.Fields("Table_Name").Value, 4) != "MSys" && +
            Microsoft.Vbe.Left(rs.Fields("Table_Name").Value, 4) != "Abfr") 
```

这里 Vbe.left 没有被接受

其次，在此之后的 sql 语句中，我得到一个错误 split is an variable but used like method。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T11:07:02.237

在转换时请记住，VBA 对索引和方法调用使用相同的运算符 ()，而 C# 对索引使用 []，对方法调用使用 ()。

```
split(intix) 
```

应该

```
split[intix] 
```

尝试

```
rs.Fields("Table_Name").Value.ToString().Substring(0,4), but check the length first. 

ie

rs.Fields("Table_Name").Value.ToString().Length >= 4 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T11:13:12.083

如果您`using VB = Microsoft.VisualBasic;`在顶部添加命名空间，您可以使用`VB.Left()`而不是`Microsoft.Vbe.Left()`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T11:25:21.027

另一方面：在 for - 循环中创建和打开连接真的不是一个好主意。这对性能不利。

您可以在 for 循环之外创建和打开与数据库的连接，在处理期间使用相同的连接，并确保在完成工作后关闭连接。就像您现在已经实现它一样，您的连接一直处于打开/关闭状态，在这种情况下这是完全没有必要的。

# c# - 网络服务的接口？

> ID：472540
> 
> 赞同：2
> 
> 时间：2009-01-23T11:01:02.933
> 
> 标签：c#, wcf, web-services, virtual-earth

我有两个 Web 服务，它们具有完全相同的方法和签名，但指向不同的服务器（特别是 Virtual Earth 生产和登台环境）。我希望根据配置设置在使用生产和登台服务之间切换，并且不想重复自己并复制我调用其中一项服务的每个方法。

所以我实际上需要的是创建一个接口，这两个服务都可以实现和编程。但我不知道这是否可取甚至可能。

还是我只需要引用其中一项服务并根据我是要使用生产环境还是暂存环境来切换 url 属性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T11:11:51.273

如果我理解正确，您拥有一个部署在生产和登台环境中的 Web 服务。在这种情况下，您唯一要做的就是通过 Url 属性在它们之间切换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T11:15:58.910

我只是将我的 wcf 服务接口放入一个单独的程序集中，并从客户端和服务器引用这个程序集。
我将这个中央接口用于 wcf 服务、模拟 wcf 服务和所有客户端，并且可以交换连接。

我猜你使用 SvcUtil 来创建你的客户端类？我不。我已经创建了一次接口，并使用它们使用带有此服务合同的 ChannelFactory 创建服务。

也许将您的服务合同放入单独的程序集中并使用 ChannelFactory 创建代理会对您有所帮助？

当然，如果只是服务 URL 发生变化，您可以在配置文件中进行更改。

# language-agnostic - 设计现在是重构的一个子集吗？

> ID：472547
> 
> 赞同：6
> 
> 时间：2009-01-23T11:03:52.913
> 
> 标签：language-agnostic, refactoring

看看软件开发的酷炫新原则：

*   [敏捷](http://en.wikipedia.org/wiki/Agile_Unified_Process)
*   [你不需要它](http://en.wikipedia.org/wiki/You_Ain't_Gonna_Need_It)
*   [少作为竞争优势](http://www.37signals.com/svn/archives2/less_as_a_competitive_advantage_my_10_minutes_at_web_20.php)
*   [行为驱动开发](http://en.wikipedia.org/wiki/Behavior_Driven_Development)
*   [过早优化的弊端](http://www.theregister.co.uk/2007/06/22/premature_optimisation/)

新方法似乎是潜入并编写实现范围目标的第一次迭代所需的内容，并根据需要进行重构以获得优雅的解决方案。您的代码库会逐渐增长，并且永远不会有大的规划/分层设计阶段。对我来说，这表明软件设计（尽管它很有价值）已被纳入重构，因为那是优雅代码的来源，而不是功能的增量添加。

我错了吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T11:16:17.007

重构的麻烦在于，你需要先了解好的设计，然后再开始。BDD/TDD 应该使设计出现，但如果没有其他因素，例如领域知识和技术能力，你最终会遇到麻烦。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-23T11:25:16.363

我会说按照您描述的方式进行操作是灾难的根源，我仍然建议预先进行整体设计。当然，在项目期间您将需要更改设计，它从来都不是一成不变的，灵活性是必须的！（这就是必须进行重构的地方）。我还建议在开始编码之前对模块进行更详细的设计。

但是一个坚实的总体设计是物超所值的：它为所有开发人员提供了一个共同的起点，一个共同的想法或目标愿景。

否则，每个人都会按照他/她认为最好的方式去做，结果每个人都以不同的方式做事。突然之间，您必须进行大量重构，以使每个人都与已出现的应用程序架构保持一致。生成的代码......不是很优雅。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T12:14:02.910

错误的？部分。

“你的代码库逐渐增长，从来没有一个大的规划/分层设计阶段。”

正确的。

“对我来说，这表明软件设计（尽管它很有价值）已被纳入重构......”

不太正确。

Big Design Up Front (BDUF) 和更敏捷的设计方法之间存在巨大的鸿沟。

BDUF 规定在任何编码之前完成所有设计。这仍然很受欢迎（昨天刚刚阅读了一份 RFP，其中绝对要求客户在开始任何编码之前对所有设计进行审查。叹息。）

敏捷表明，也许*所有*的设计都不是一个有用的目标。您需要进行*足够*多的设计以使 TDD 能够正常工作。例如，您不能启动 TDD，除非您有一个工作基础设施，允许某人编写测试并逐步发展解决方案，并且知道不会有奇怪的生产部署问题需要解决。

设计仍然是王道。敏捷设计优于单体设计。

敏捷设计的一个结果是 YAGNI、DRY 和 Less-is-More。这些不会取代设计，它们是您如何优先考虑和进行设计的结果。

BDD 和 TDD 是安排时间的方法，因此您可以专注于人们需要什么、他们做什么以及真正重要的事情。TDD 尤其关注软件的可测试行为。不是零值的细微差别，而是实际的行为。

过早的优化很有趣，但不相关。即使是敏捷团队也可能在追求不增加任何价值的细微差别或优化时陷入低价值的陷阱。过早的优化是一种过度思考（==“绞尽脑汁”）技术选择的习惯，而没有关于实际性能的事实。

敏捷应该可以帮助您专注于大局：**实际的人将实际使用实际软件做什么，**并避免技术漏洞。

它不会取代工程。它重新聚焦它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T11:30:03.997

取决于你在设计什么。如果它是一个复杂的算法，它将成为下一个视频压缩标准，那么您可以迭代和重构，直到奶牛回家并且它不会变得更快。性能源于设计。

同样，如果您正在编写一个非常大的应用程序，它将通过定期发布而增长，您需要建立一个支持增长的架构，这将是设计使然。您可以通过一头扎进代码中走很长的路，只是为了发现死胡同。

> 我错了吗？

恕我直言，差不多。

编辑：我在流程早期而不是流程中做出许多设计决策的原因是这通常是最便宜的时间。例如，如果我们很早就开始使用依赖于平台的技术来编写应用程序，那么扭转它可能是一个非常昂贵的决定。如果我们在开始编码之前花时间考虑我们想要支持的平台，它会便宜得多。我们不能也不会第一次就做好一切，但这并不能免除我们预先探索所有重要设计选择的责任。每个人都尝试将 MS MDI 程序重构为 MVC？我有，并且不会推荐它；）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T11:44:03.220

敏捷宣言中没有任何内容说你在行动之前不允许思考。当然，您可以灵活且仍然提前设计。架构是最好的设计，因此在开始编码/重构之前，您应该对如何构建应用程序有一些想法。

关键是您不必在继续之前完成每一步。开始做尽可能多的设计。

当你有代码时，你可以根据需要进行重构，但是如果你每次都从一个简单的虚拟应用程序开始，通过重构来改变基础架构变得很困难。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-23T12:15:56.417

让我想起了下面的一段话：

> 目标是有效的干净代码。[...] 首先，我们将解决问题的“有效”部分。然后我们将解决“干净的代码”部分。这与架构驱动的开发相反，您首先解决“干净的代码”，然后在解决“可行的”问题时尝试将您学到的东西整合到设计中。（Kent Beck，“示例 TDD”）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-23T12:47:06.777

设计的本质正在发生变化，我想说新的方法是在编码之前思考，而只是在下一次迭代中将实现什么。请参阅“[设计已死](http://martinfowler.com/articles/designDead.html)”。

**为今天设计，为明天编码**。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-23T11:08:50.873

新的？不，十年前我正在阅读有关敏捷的文章。敏捷只是已经存在更长时间的想法的结晶。它并不是什么新鲜事物，只是还没有扩散到任何地方。

至于你对设计的看法，我认为仍然有一个总体想法和一些前期设计的地方。这是瀑布式的概念，即在需求和设计 100% 完成之前你不能采取行动，这在所有地方都受到了质疑，但在仍然坚持它的大公司中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-23T12:43:06.427

让我们看看我们是否可以得到一个定义。我将建议我们可以参考一本书。[Martin Fowler 的那个](http://www.amazon.co.uk/Refactoring-Improving-Design-Existing-Technology/dp/0201485672/ref=sr_1_2?ie=UTF8&s=books&qid=1232714164&sr=8-2)怎么样？

《重构：改进现有代码的设计》

现在让我们以 TDD 口头禅为例：

直到完成

*   红色（我们写了一个测试但它失败了，因为没有什么可以通过它）
*   绿色（我们设计并编写了一些代码，现在测试成功了）
*   重构（我们需要将我们所做的设计与其他所有内容集成）

结尾

我知道敏捷书籍倾向于只说“编写足够的代码以通过测试”，但该声明中隐含着设计。有必要。选择一个变量名是一个设计决定。不是一个大问题，但仍然是一个决定。命名一个函数或方法是一个稍微大一点的，依此类推。

敏捷中没有任何东西可以确保您始终做出*良好的*设计决策。瀑布或任何其他过程中也没有任何内容。敏捷确实断言您无法预先弄清楚并尝试-根据我的经验取得一些成功-为您提供一套工具来帮助您在整个练习中做出更好的决策。

# sql - 如何更改自动增长大小？微软 SQL 服务器 2005

> ID：472550
> 
> 赞同：6
> 
> 时间：2009-01-23T11:05:55.857
> 
> 标签：sql, sql-server-2005

在 MS Sql server 2005 中，默认情况下有 1MB 自动增长，我怎样才能将其更改为我需要的任何内容。？

谢谢，安巴纳

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-23T11:21:07.340

在 SQL Server Management Studio 中，右键单击数据库。
转到属性。
然后转到文件部分。
单击数据或日志自动增长列（单击 ...）
然后将其更改为您想要的任何内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T17:53:44.063

您想设置大小以处理未来几个月的数据需求。你不想依赖自动成长作为一种习惯。您将填满磁盘，并在文件增长时延迟服务器的性能。

# c# - 来自 FxCop 的奇怪警告计数行为？

> ID：472551
> 
> 赞同：0
> 
> 时间：2009-01-23T11:06:36.683
> 
> 标签：c#, .net, fxcop

我的团队正在使用 FxCop 来帮助清理现有的 ASP.NET 应用程序。

我们注意到 FxCop 计算警告的方式有一些奇怪的行为。

似乎在一次通过代码时，FxCop 只查找并计算与每个方法中的特定规则相关的第一个警告。

所以，如果我有：

```
public test3(){
   int a = 0; //DoNotInitializeUnecessarily
   int b = 0; //DoNotInitializeUnecessarily
} 
```

...我的 FxCop 报告只会在方法 test3() 中找到并计算类型为 DoNotInitializeUnecessarily 的第一个警告。有没有办法让 FxCop 在方法 test3() 中找到并计算这个问题的两个实例？

当前的计数方法对我们来说是有问题的，因为 FxCop 没有报告警告的数量。这使得很难估计修复现有 FxCop 警告需要多少时间，因为我们实际上不知道应用程序中有多少警告。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-24T11:35:29.290

您是否尝试更改 *工具->设置->项目默认值->“[1] 例外后禁用规则”* ？

# javascript - 在发送到客户端之前乱码 JavaScript 代码

> ID：472552
> 
> 赞同：0
> 
> 时间：2009-01-23T11:06:55.433
> 
> 标签：javascript, compression, code-generation

如何在将 JavaScript 代码发送到客户端之前对其进行乱码？我不想暴露功能。代码已经使用`jsmin`.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T11:10:09.890

您需要一个混淆器，[请参阅此](http://www.javascriptobfuscator.com/Default.aspx)示例。

任何有足够[决心](http://isc.sans.org/diary.html?storyid=1519)的人总是可以扭转它，而[像这样](https://addons.mozilla.org/en-US/firefox/addon/10345)的工具可以提供帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T11:19:21.930

Javascript 被解释为纯文本。因此，任何混淆充其量只是安慰剂，而且很容易逆转。

更重要的是，如果你编写了足够多的 Javascript 来构成一个足以保护的有价值的作品，那么你就做错了。

这些天我的 Javascript 包括 jQuery、一些插件和一些代码来激活这些插件并做一些样式。

我很难想象用 Javascript 编写任何重要的东西，以至于我会关心保护它，这也很好，因为你无法保护它。并不真地。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T11:09:15.787

您可以尝试一些这样的在线混淆器：

[http://www.javascriptobfuscator.com/Default.aspx](http://www.javascriptobfuscator.com/Default.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T11:10:30.013

在 google 上搜索：Javascript 混淆器

您也可以将您的平台添加到查询中。已经有很多工具可以整合到您的项目中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T12:26:07.380

一句警告：互联网上大多数混淆的 JS 是安全漏洞利用代码。您可能会被误认为是一个sploit，尤其是被更加偏执的反病毒扫描程序。

# c# - 从数据库中创建域对象的快速/正确方法

> ID：472557
> 
> 赞同：0
> 
> 时间：2009-01-23T11:07:56.400
> 
> 标签：c#, database, orm, domain-driven-design

我在数据库中有典型的表，如用户、用户组，它们有关系。

在我的域模型中，我希望如果您请求用户，您将获得用户并且每个用户都拥有属于的属性，这意味着这些是他所属的组。在属性中我想要组列表（作为组的类型安全）

另一方面也应该这样做，这意味着每个组都应该知道哪些用户属于该组。

我有这个类（示例）：

```
public class User
{
    int Id { get; set; }
    string Name { get; set; }
    List<Usergroup> BelongsTo { get; set; }

    User()
    {
        BelongsTo = new List<Usergroup>();
    }
}

public class Usergroup
{
    int Id { get; set; }
    string Name { get; set; }
    List<User> Users { get; set; }

    Usergroup()
    {
        Users = new List<User>();
    }
}

internal class Relation
{
    int userId;
    int groupId;
} 
```

现在，实现它的最佳方法是什么，以及填充所有对象的最快方法是什么。

顺便说一句：我正在使用亚音速来获取所有数据库记录（对于每个表一个选择）。至少有 1500 个用户和 30 个组。

我当前的代码基于组的foreach，组的relationship.where，然后users.singleordefault 来查找用户，然后将用户添加到组，将组添加到用户。但它需要大约 30 秒才能做到这一点。

我的客户端应用程序是一个 web 应用程序，所以我将结果存储在一个缓存的存储库中，这就是我这样做的原因！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T11:57:05.770

> 我当前的代码基于组的foreach，组的relationship.where，然后users.singleordefault 来查找用户，然后将用户添加到组，将组添加到用户。

我不明白你在这里说什么。

> 这需要大约 30 秒

鉴于只有 1500 个用户和 30 个组，无论您在做什么似乎都太慢了。

> 现在，实现它的最佳方法是什么，以及填充所有对象的最快方法是什么。

如果你想...

*   或者，所有用户，每个用户的组
*   或者，所有组，每个组的用户

...那么我可能会建议从数据库中选择加入的记录。

然而，因为...

*   您想要**所有**数据（双向连接）
*   您只有 1500 条记录

...那么我建议您尽可能简单地选择所有内容，并将其加入您的应用程序。

```
//select users
Dictionary<int, User> users = new Dictionary<int, User>();
foreach (User user in selectUsersFromDatabase())
{
  users.Add(user.Id, user);
}
//select groups
Dictionary<int, Group> groups = new Dictionary<int, Group>();
foreach (Group group in selectGroupsFromDatabase())
{
  groups.Add(group.Id, group);
}
//select relations
//and join groups to users
//and join users to groups
foreach (Relation relation in selectRelationsFromDatabase())
{
  //find user in dictionary
  User user = users[relation.userId];
  //find group in dictionary
  Group group = groups[relation.groupId];
  //add group to user and add user to group
  user.BelongsTo.Add(group);
  group.Users.Add(user);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T11:32:30.483

最好的办法是只检索客户端请求的实体，但允许该实体公开一种从数据库中检索其所有相关实体的方法。您不应该尝试一次从数据库中提取所有内容，因为您不确定客户端是否需要这些数据。

做这样的事情：

```
public class User
{
    int Id { get; set; }
    string Name { get; set; }

    public List<Usergroup> GetUserGroups()
    {
        // go and get the user groups
    }
} 
```

如果您愿意，您可以创建一个将该值作为`User`类成员保存的属性，并使用该`GetUserGroups`方法为您延迟加载该值。

# error-handling - 在 ASP Classic 中是否可以进行 try-catch 之类的错误处理？

> ID：472558
> 
> 赞同：43
> 
> 时间：2009-01-23T11:08:15.133
> 
> 标签：error-handling, asp-classic

[ASP Classic](http://en.wikipedia.org/wiki/Active_Server_Pages)中有哪些用于错误处理的选项？

例如：

我正在使用该`Mail.SendMail`功能，但是在打开测试服务器时它不起作用，这是正常的。我想测试是否可以邮寄，如果不能，则继续和/或显示一条消息。

有任何想法吗？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-01-23T11:19:50.180

有两种方法，您可以在具有该结构的 JScript 或 VBScript 中进行编码，或者您可以在您的代码中捏造它。

使用 JScript，您将使用以下类型的构造：

```
<script language="jscript" runat="server">
try  {
    tryStatements
}
catch(exception) {
    catchStatements
}
finally {
    finallyStatements
}
</script> 
```

在您的 ASP 代码中，您可以通过使用 on error resume next 在您尝试并在捕获点检查 err.Number 来伪造它，例如：

```
<%
' Turn off error Handling
On Error Resume Next

'Code here that you want to catch errors from

' Error Handler
If Err.Number <> 0 Then
   ' Error Occurred - Trap it
   On Error Goto 0 ' Turn error handling back on for errors in your handling block
   ' Code to cope with the error here
End If
On Error Goto 0 ' Reset error handling.

%> 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2013-04-04T18:51:39.000

关于 Wolfwyrd 的回答：“On Error Resume Next”实际上关闭了错误处理！不开。On Error Goto 0 将错误处理重新打开，因为至少，如果我们自己没有编写它，我们希望机器能够捕获它。Off = 留给你处理。

如果您使用 On Error Resume Next，您需要注意在它之后包含多少代码：请记住，短语“If Err.Number <> 0 Then”仅指上次触发的错误。

如果您在“On Error Resume Next”之后的代码块有几个地方可能会失败，那么您必须在每一个可能的失败行之后放置“If Err.number <> 0”，以检查执行。

否则，在“on error resume next”之后意味着它所说的 - 您的代码可以在任意多的行上失败，并且执行将继续愉快地进行。这就是为什么它是一个痛苦的屁股。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-09-09T00:21:56.323

一个相当不错的方法来处理丢失的 COM 类：

```
Dim o:Set o = Nothing
On Error Resume Next
Set o = CreateObject("foo.bar")
On Error Goto 0
If o Is Nothing Then
  Response.Write "Oups, foo.bar isn't installed on this server!"
Else
  Response.Write "Foo bar found, yay."
End If 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-10-31T12:41:29.143

1)`On Error Resume Next`在页面顶部添加

2）在页面底部添加以下代码

```
If Err.Number <> 0 Then

  Response.Write (Err.Description)   

  Response.End 

End If

On Error GoTo 0 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-12-06T02:23:49.560

**On Error Resume Next**语句应该放在我们要验证的内容之上。

```
 On Error Resume Next
  'Your code logic is here 
```

然后以如下语句结束：

```
 If Err.Number <> 0 then

  'Your error message goes here'

  End if 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-01-25T14:30:20.503

对于任何使用过 ASP 以及更现代的语言的人来说，这个问题都会引起一阵笑声。根据我的经验，使用自定义错误处理程序（在 IIS 中设置以处理 500;100 错误）是 ASP 错误处理的最佳选择。本文描述了该方法，甚至为您提供了一些示例代码/数据库表定义。

~~[http://www.15seconds.com/issue/020821.htm](http://www.15seconds.com/issue/020821.htm)~~

这是Archive.org 版本的[链接](https://web.archive.org/web/20120314050509/http://www.codeguru.com/csharp/.net/net_general/debugginganderrorhandling/article.php/c19677)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-23T11:15:07.570

自从我进入 ASP 领域以来已经有一段时间了，但是 iirc 有几种方法：

`try catch finally`可以在 VBS 中合理地模拟（~~[这里](http://my.opera.com/Lee_Harvey/blog/2007/04/21/try-catch-finally-in-vbscript-sure)~~ [的好文章](https://web.archive.org/web/20140221063207/http://my.opera.com/Lee_Harvey/blog/2007/04/21/try-catch-finally-in-vbscript-sure)）并且有一个事件叫做`class_terminate`你可以在全局范围内观察和捕获异常。然后有可能改变你的脚本语言......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-09T00:14:49.763

有些场景并不总是允许开发人员切换脚本语言。

我的偏好绝对是 JavaScript（我已经在新项目中使用过它）。但是，维护旧项目仍然是必要的和必要的。不幸的是，这些都是用 VBScript 编写的。

所以即使这个解决方案没有提供真正的“尝试/捕获”功能，结果是一样的，这足以让我完成工作。

# ant - 如何在没有 -lib 或全局安装的情况下将可选任务加载到 ant 中？

> ID：472559
> 
> 赞同：16
> 
> 时间：2009-01-23T11:08:27.693
> 
> 标签：ant, ftp

我想在ant中使用FTP任务，我找到了合适的jar文件，一切正常。我已将 jar 文件与构建中使用的其他文件一起放在“libs”目录中。唯一的问题是用户必须运行“ant -lib commons-net-ftp-2.0.jar”来进行构建；我真的更希望可以在没有参数的情况下运行“ant”。

阅读[ant optional tasks intallation page](http://ant.apache.org/manual/install.html)，我看到有五种方法可以在 ant 中加载额外的库，但它们都不是我真正想要的。我不想强迫用户对其系统进行任何修改以运行此任务；应该可以从我们产品源文件夹内的“libs”目录中加载它。所以这意味着设置全局 CLASSPATH 也被淘汰了（无论如何这都是个坏主意）。

如文档中所述，最后一个选项是首选方法...从构建脚本本身单独加载 jarfile。我过去曾使用 ant-contrib 任务和 JUnit 完成此操作，并且想在这里执行此操作，但我不知道如何完成此操作。FTP 任务不支持嵌套的类路径元素，而且我不知道通过 taskdef 加载该库所需的 XML 资源。如何从 ant 中加载库？

**编辑：**为了回应到目前为止已在此处发布的答案和问题，我使用的是 ant 1.7.1。制作一个 ftp taskdef 肯定是行不通的；引发以下错误：

构建失败/my/path/build.xml:13：找不到taskdef类org.apache.tools.ant.taskdefs.optional.net.FTP

也许这是因为类名错误。如果我只有一个 jarfile，我该如何找到我应该使用的类名？它没有在任何地方记录，我在 jar 本身中找不到任何类似于该路径的东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-25T21:12:39.087

您遇到的问题是由于使用了不同的类加载器。Commons Net 类必须由加载 FTP 任务的同一个类加载器加载。因为 FTP 任务是由 Ant 在启动时加载的，所以您需要将 Commons Net 添加到 Ant 的类路径中，以便它由同一个类加载器加载。这就是为什么文档为您提供了 4 种不同的方法来执行此操作。

我同意它们都不是理想的（CLASSPATH 环境变量是最差的）。解决此问题的一种方法是为您的项目提供一个 shell 脚本，该脚本调用 Ant 并传递适当的 -lib 参数。然后让人们使用它而不是直接调用 Ant。实际上，您可以将其命名为“ant”，以便它运行而不是路径上现有的“ant”（这仅在当前目录位于路径上且位于其他目录之前的情况下才有效）。

文档中的第五个选项在理论上很好。他们最终修复了 1.7.0 中的类加载问题。不幸的是，正如您所提到的，没有人改装 FTP 任务以采用类路径。您可以尝试提交增强请求，但这在短期内无济于事。

还有另一种选择，它并不比其他选择更好。您可以确保 FTP 任务由加载 Commons Net 类的类加载器加载，而不是确保 Commons Net 类由加载 FTP 任务的类加载器加载。为此，您必须从 Ant 安装的“lib”目录中删除 ant-commons-lib.jar 文件。这意味着 FTP 任务不会在启动时加载。这就是为什么可选任务被分解成这么多独立的 JAR 的原因——这样它们就可以被单独删除。将此 JAR 文件与 Commons Net JAR 文件放在一起，以便可以同时加载它。然后你可以做这样的事情（我试过这个并且它有效）：

```
<taskdef name="ftp"
         classname="org.apache.tools.ant.taskdefs.optional.net.FTP">
  <classpath>
    <pathelement location="${basedir}/lib/ant-commons-net.jar"/>
    <pathelement location="${basedir}/lib/commons-net-2.0.jar"/>
  </classpath>
</taskdef>
<ftp server="yourserver.com"
     userid="anonymous"
     password="blah">
  <fileset dir="somedirectory"/>
</ftp> 
```

但这可能是比仅使用 -lib 开关（有或没有包装脚本）更糟糕的选择。我唯一能想到的另一件事是尝试找到要使用的第三方 FTP 任务而不是默认任务。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T15:49:01.593

我有一个解决方案：

[您可以从http://enitsys.sourceforge.net/ant-classloadertask/](http://enitsys.sourceforge.net/ant-classloadertask/)下载一个新的“类加载器”任务并加载它：

```
 <taskdef resource="net/jtools/classloadertask/antlib.xml"
            classpath="XXX/ant-classloadertask.jar"/> 
```

Naw 可以做一些事情，比如使用 ant 用于其任务的相同类加载器加载类：

```
 <classloader loader="system" classpath="XXX/commons-net-2.0.jar"/> 
```

或“装载机=”项目””

然后你定义你的任务：

```
 <taskdef name="ftp" classname="org.apache.tools.ant.taskdefs.optional.net.FTP"/> 
```

去 ：-）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-07-15T18:10:00.923

所以我成功地为你在尝试做销售人员工作时得到的 ant-salesforce.jar 做了这个（有趣......）

检查 jar 中是否有一个看起来像这样的 xml 文件：

```
<antlib>
  <typedef name="compileAndTest" classname="com.salesforce.ant.CompileAndTest"/>
  ....
</antlib> 
```

然后在 ant 中给它一个 taskdev，它从给定的 jar 中读取该文件，如下所示：

```
<taskdef resource="com/salesforce/antlib.xml" classpath="lib/ant-salesforce.jar" /> 
```

希望对一些人有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-11T11:12:12.403

啊，伙计，这太恶心了。我从日食运行蚂蚁。我不想在 eclipse 中为新的工作空间重新配置 ant，所以这就是我决定做的，将运行任务和配置 ant 解耦。我将 ftp 任务提取到单独的构建文件中。接下来，我在命令行中添加了一个本地调用，以在路径上使用所需的库启动一个全新的 ant 进程：

```
<target name="deploy-ftp">
    <exec command="ant">
        <arg line="-buildfile ftp.xml deploy-ftp -lib lib/ant"/>
    </exec>
</target> 
```

现在主构建文件可以在没有任何特殊参数的情况下运行，并且不需要对 ant 安装进行任何修改。但这很讨厌，因为 ftp 任务在完全干净的环境中运行。主构建文件中的任何属性和路径都不可用。幸运的是，无论如何我都将所有这些都放在了一个单独的属性文件中，所以我只需要一个导入。

我要非常感谢 Dan Dyer。如果没有您对幕后发生的事情的广泛解释，我不会找到这个解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T17:02:07.807

您的用户都在他们的机器上安装了 ant，但您不能/不想让他们添加 FTP jar？您可以将 ant 与您的项目捆绑在一起，制作调用您的 ant 捆绑包的任务，并放置 jars，使其按如下方式工作吗？

```
<taskdef name="ftp" classname="org.apache.tools.ant.taskdefs.optional.net.FTP">
  <classpath>
    <pathelement location="\lib\commons-net-1.4.0.jar"/>
  </classpath>
</taskdef>
<target name="testFtp">
  <ftp server="blah" userid="foo" password="bar">
    <fileset file="test.file" />
  </ftp>
</target> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T18:41:01.507

假设 libs 直接在您项目的基本目录下，这项工作是否有效

```
<taskdef name="ftp" classname="org.apache.tools.ant.taskdefs.optional.net.FTP">
  <classpath>
    <pathelement location="${basedir}\libs\commons-net-1.4.0.jar"/>
  </classpath>
</taskdef> 
```

# .net - ScrollBar in DataGridView

> ID：472563
> 
> 赞同：1
> 
> 时间：2009-01-23T11:09:41.060
> 
> 标签：.net, visual-studio, winforms, datagridview, scrollbar

I have a winform in vs2008 that contains a DataGridView. The datagrid contains a list with several columns. These are fixed width, exept one that I have set up to take whatever space is left and fill the width of the view. The winform is resizeable in all directions.

The issue I am trying to solve is that when I increase the vertical size of the window the scrollbar disappears and the columns snap to the right to fill the extra space. What I would like to happen is that the vertical scrollBar never disappears. Setting ScrollBars to vertical in the properties of the DataGridView does not do this.

Is this at all possible to achieve? And, if so, how do I get the vertical scrollbar to always be visible?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T13:10:56.853

尝试继承 DataGridView 并处理 VerticalScrollBar 的 VisibleChanged 事件。您应该能够在其中将 Visible 属性设置为 True，从而覆盖默认行为。

像这样的东西，我想...

```
public class SubclassedDataGridView : DataGridView
    {
        public SubclassedDataGridView (): base()
        {
            VerticalScrollBar.VisibleChanged += new EventHandler(VerticalScrollBar_VisibleChanged);
        }

        void VerticalScrollBar_VisibleChanged(object sender, EventArgs e)
        {
            VerticalScrollBar.Visible = true;
        }
     } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-21T14:19:25.297

就我而言，（重新）对网格进行排序很有帮助。像这样尝试：

```
 if (gridName.SortedColumn == null)
   gridName.Sort(gridNameColumns[columnName],ListSortDirection.Ascending);
 else
 {
    ListSortDirection dir;
    if (gridName.SortOrder == SortOrder.Descending) 
       dir = ListSortDirection.Descending;
    else dir = ListSortDirection.Ascending;

    gridName.Sort(gridName.SortedColumn, dir);
 } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-08-24T13:31:32.870

一种可能性是触发滚动条消失的事件，以便您可以阻止该事件并停止它。

# python - 从集合中选择单个项目：Python

> ID：472575
> 
> 赞同：6
> 
> 时间：2009-01-23T11:16:35.693
> 
> 标签：python, iterator, generator

我创建了一个实用函数来从生成器表达式返回预期的单个项目

```
print one(name for name in ('bob','fred') if name=='bob') 
```

这是一个很好的方法吗？

```
def one(g):
    try:
        val = g.next()
        try:
            g.next()
        except StopIteration:
            return val
        else:
            raise Exception('Too many values')
    except StopIteration:
        raise Exception('No values') 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-23T15:35:10.680

一个更简单的解决方案是使用元组解包。这已经完成了你想要的一切，包括检查它是否包含一个项目。

单品：

```
 >>> name, = (name for name in ('bob','fred') if name=='bob')
 >>> name
 'bob' 
```

过多的物品：

```
>>> name, = (name for name in ('bob','bob') if name=='bob')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ValueError: too many values to unpack 
```

没有相关产品：

```
>>> name, = (name for name in ('fred','joe') if name=='bob')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ValueError: need more than 0 values to unpack 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-10-30T19:41:47.253

对于那些使用或对第三方库感兴趣的人，[`more_itertools`](https://github.com/erikrose/more-itertools)使用本机错误处理实现这样的工具：

```
> pip install more_itertools 
```

**代码**

```
import more_itertools as mit

mit.one(name for name in ("bob", "fred") if name == "bob")
# 'bob'

mit.one(name for name in ("bob", "fred", "bob") if name == "bob")
# ValueError: ...

mit.one(name for name in () if name == "bob")
# ValueError: ... 
```

有关详细信息，请参阅[`more_itertools`文档](https://more-itertools.readthedocs.io/en/latest/api.html#more_itertools.one)。底层[源代码](https://github.com/erikrose/more-itertools/blob/90a27b0e090b52bec0d32b24d631b090aea67847/more_itertools/more.py#L480)类似于接受的答案。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T11:23:12.360

简单的方法：

```
print (name for name in ('bob', 'fred') if name == 'bob').next() 
```

如果你真的想在有多个值时出现错误，那么你需要一个函数。我能想到的最简单的是（**EDITED**也可以使用列表）：

```
def one(iterable):
    it = iter(iterable)
    val = it.next()
    try:
        it.next()
    except StopIteration:
        return val
    else:
        raise Exception('More than one value') 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T11:54:31.063

查看[itertools.islice()](http://docs.python.org/library/itertools.html#itertools.islice)方法。

```
>>> i2=itertools.islice((name for name in ('bob','fred') if name=='bob'),0,1,1)
>>> i2.next()
'bob'
>>> i2.next()
Traceback (most recent call last):
  File "<interactive input>", line 1, in <module>
StopIteration
>>> 
```

> 该模块实现了许多受 Haskell 和 SML 编程语言结构启发的迭代器构建块。每个都以适合 Python 的形式重铸。
> 
> 该模块标准化了一组核心的快速、高效的内存工具，这些工具本身或组合使用。标准化有助于避免当许多不同的人创建自己的略有不同的实现时出现的可读性和可靠性问题，每个人都有自己的怪癖和命名约定。
> 
> 这些工具旨在轻松地相互结合。这使得在纯 Python 中简洁高效地构建更专业的工具变得容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T12:00:45.090

你的意思是？

```
def one( someGenerator ):
    if len(list(someGenerator)) != 1: raise Exception( "Not a Singleton" ) 
```

你想用所有额外的代码来完成什么？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T13:13:41.060

这是我对该功能的尝试`one()`。我会避免显式`.next()`调用，而是使用 for 循环。

```
def one(seq):
    counter = 0
    for elem in seq:
        result = elem
        counter += 1
        if counter > 1:
            break
    if counter == 0:
        raise Exception('No values')
    elif counter > 1:
        raise Exception('Too many values')
    return result 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-23T14:21:15.337

首先，（回答实际问题！）您的解决方案将与其他提议的变体一样正常工作。

我要补充一点，在这种情况下，IMO 生成器过于复杂。如果你希望有一个值，你可能永远不会有足够的内存使用成为一个问题，所以我会使用明显和更清晰的：

```
children = [name for name in ('bob','fred') if name=='bob']
if len(children) == 0:
    raise Exception('No values')
elif len(children) > 1:
    raise Exception('Too many values')
else:
    child = children[0] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-31T12:56:56.453

在带有计数器的语法中使用 Python 的 for .. 怎么样？类似于未知的答案。

```
def one(items):
    count = 0
    value = None

    for item in items:
        if count:
            raise Exception('Too many values')

        count += 1
        value = item

    if not count:
        raise Exception('No values')

    return value 
```

# sql - DBCC CHECKIDENT 将标识设置为 0

> ID：472578
> 
> 赞同：82
> 
> 时间：2009-01-23T11:17:29.797
> 
> 标签：sql, sql-server

我正在使用此代码重置表上的身份：

```
DBCC CHECKIDENT('TableName', RESEED, 0) 
```

这在大多数情况下都可以正常工作，第一次插入时我将 1 插入到 Id 列中。但是，如果我删除数据库并重新创建它（使用我编写的脚本）然后调用 DBCC CHECKIDENT，插入的第一个项目的 ID 将为 0。

有任何想法吗？

**编辑：**经过研究，我发现我没有正确阅读[文档](http://msdn.microsoft.com/en-us/library/aa258817(SQL.80).aspx)- “当前标识值设置为 new_reseed_value。如果自创建以来没有向表中插入任何行，则执行 DBCC CHECKIDENT 后插入的第一行将使用 new_reseed_value 作为标识。否则，插入的下一行将使用 new_reseed_value + 1。"

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2012-11-09T06:50:01.840

您在问题编辑中所写的内容是正确的。

运行后`DBCC CHECKIDENT('TableName', RESEED, 0)`：
- 新创建的表将以标识 0 开始
- 现有表将以标识 1 继续

解决方案在下面的脚本中，它有点像穷人截断:)

```
-- Remove all records from the Table
DELETE FROM TableName

-- Use sys.identity_columns to see if there was a last known identity value
-- for the Table. If there was one, the Table is not new and needs a reset
IF EXISTS (SELECT * FROM sys.identity_columns WHERE OBJECT_NAME(OBJECT_ID) = 'TableName' AND last_value IS NOT NULL) 
    DBCC CHECKIDENT (TableName, RESEED, 0); 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-23T13:15:47.857

正如您在问题中指出的那样，这是一种[记录在案的行为](http://msdn.microsoft.com/en-us/library/aa258817(SQL.80).aspx)。不过我还是觉得很奇怪。我用来重新填充测试数据库，即使我不依赖身份字段的值，在第一次从头开始填充数据库以及删除所有数据并再次填充后，使用不同的值也有点烦人。

一种可能的解决方案是使用**truncate**来清理表而不是删除。但是随后您需要删除所有约束并在之后重新创建它们

这样，它始终表现为新创建的表，无需调用 DBCC CHECKIDENT。第一个标识值将是表定义中指定的值，无论您是第一次插入数据还是第 N 次插入数据，都将是相同的

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-09-13T15:48:10.163

您无法使用单个命令设置/重置标识列以涵盖表是否已插入记录的两种情况，这似乎很荒谬。在我偶然发现这个问题之前，我无法理解我正在经历的行为！

我的解决方案（丑陋但有效）是显式检查`sys.identity_columns.last_value`表（它告诉您表是否已插入记录）并`DBCC CHECKIDENT`在每种情况下调用适当的命令。如下：

```
DECLARE @last_value INT = CONVERT(INT, (SELECT last_value FROM sys.identity_columns WHERE OBJECT_NAME(OBJECT_ID) = 'MyTable'));
IF @last_value IS NULL
    BEGIN
        -- Table newly created and no rows inserted yet; start the IDs off from 1
        DBCC CHECKIDENT ('MyTable', RESEED, 1);
    END
ELSE
    BEGIN
        -- Table has rows; ensure the IDs continue from the last ID used
        DECLARE @lastValUsed INT = (SELECT ISNULL(MAX(ID),0) FROM MyTable);
        DBCC CHECKIDENT ('MyTable', RESEED, @lastValUsed);
    END 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-23T11:32:31.840

将声明更改为

```
 DBCC CHECKIDENT('TableName', RESEED, 1) 
```

这将从 2（或重新创建表时为 1）开始，但永远不会是 0。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-11-08T17:21:33.360

我这样做是为了将值重置为 0，因为我希望我的第一个标识列为 0 并且它正在工作。

```
dbcc CHECKIDENT(MOVIE,RESEED,0)
dbcc CHECKIDENT(MOVIE,RESEED,-1)
DBCC CHECKIDENT(MOVIE,NORESEED) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T14:19:49.397

另请参阅：http: [//sqlblog.com/blogs/alexander_kuznetsov/archive/2008/06/26/fun-with-dbcc-chekident.aspx](http://sqlblog.com/blogs/alexander_kuznetsov/archive/2008/06/26/fun-with-dbcc-chekident.aspx)

这是记录在案的行为，如果您重新创建表，为什么要运行 CHECKIDENT，在这种情况下跳过该步骤或使用 TRUNCATE（如果您没有 FK 关系）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-04-11T13:11:20.127

我在 SQL 中使用它来将 IDENTITY 设置为特定值：-

```
DECLARE @ID int = 42;
DECLARE @TABLENAME  varchar(50) = 'tablename'

DECLARE @SQL nvarchar(1000) = 'IF EXISTS (SELECT * FROM sys.identity_columns WHERE OBJECT_NAME(OBJECT_ID) = '''+@TABLENAME+''' AND last_value IS NOT NULL)
    BEGIN
        DBCC CHECKIDENT('+@TABLENAME+', RESEED,' + CONVERT(VARCHAR(10),@ID-1)+');
    END
    ELSE
    BEGIN
        DBCC CHECKIDENT('+@TABLENAME+', RESEED,' + CONVERT(VARCHAR(10),@ID)+');
    END';
EXEC (@SQL); 
```

这在 C# 中设置一个特定的值：-

```
SetIdentity(context, "tablename", 42);
.
.
private static void SetIdentity(DbContext context, string table,int id)
{
    string str = "IF EXISTS (SELECT * FROM sys.identity_columns WHERE OBJECT_NAME(OBJECT_ID) = '" + table
        + "' AND last_value IS NOT NULL)\nBEGIN\n";
    str += "DBCC CHECKIDENT('" + table + "', RESEED," + (id - 1).ToString() + ");\n";
    str += "END\nELSE\nBEGIN\n";
    str += "DBCC CHECKIDENT('" + table + "', RESEED," + (id).ToString() + ");\n";
    str += "END\n";
    context.Database.ExecuteSqlCommand(str);
} 
```

这建立在上述答案的基础上，并始终确保下一个值是 42（在这种情况下）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-06-04T13:53:07.703

只需这样做：

```
IF EXISTS (SELECT * FROM tablename)
BEGIN
    DELETE from  tablename
    DBCC checkident ('tablename', reseed, 0)
END 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-12-17T17:35:28.457

借用 Zyphrax 的回答...

```
USE DatabaseName

DECLARE @ReseedBit BIT = 
    COALESCE((SELECT SUM(CONVERT(BIGINT, ic.last_value))
                FROM sys.identity_columns ic
                INNER JOIN sys.tables t ON ic.object_id = t.object_id), 0)
DECLARE @Reseed INT = 
CASE 
    WHEN @ReseedBit = 0 THEN 1 
    WHEN @ReseedBit = 1 THEN 0 
END

DBCC CHECKIDENT ('dbo.table_name', RESEED, @Reseed); 
```

注意事项：这适用于使用枚举类型定义表初始化数据库的参考数据填充情况，其中这些表中的 ID 值必须始终从 1 开始。第一次创建数据库时（例如，在 SSDT-数据库发布）@Reseed 必须为 0，但在重置数据时，即删除数据并重新插入时，@Reseed 必须为 1。因此，此代码旨在用于重置数据库数据的存储过程，它可以可以手动调用，但也可以从 SSDT-DB 项目中的部署后脚本调用。这样，参考数据插入仅在一个地方定义，但不限于仅在发布期间的部署后使用，它们也可用于后续使用（以支持开发和自动化测试等）。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2016-11-25T07:12:52.680

```
USE AdventureWorks2012;  
GO  
DBCC CHECKIDENT ('Person.AddressType', RESEED, 0);  
GO 

AdventureWorks2012=Your databasename
Person.AddressType=Your tablename 
```

# bash - 更改邮件目录顺序

> ID：472579
> 
> 赞同：2
> 
> 时间：2009-01-23T11:18:34.537
> 
> 标签：bash, unix, email, scripting, maildir

我最近问[了这个问题](https://stackoverflow.com/questions/468704/maildir-headers-problem#468821)，发现一封电子邮件显示乱序的原因实际上不是因为日期，而是因为消息的顺序。我想修改我的脚本以确保所有消息的顺序正确，但我不确定如何执行此操作。它只是基于文件出现的顺序，还是 maildir 标头的特殊部分指定了这一点？

这是我的意思的一个例子：[例子](http://img19.picoodle.com/img/img19/3/1/23/f_mailsm_c4ee3b6.jpg)

一般来说，我使用的每个 MUA，包括 Thunderbird、Evolution 和 mail2web.com 都可以按日期排序，但默认按“消息编号”排序。我在一个共享主机上，我相信它使用 qmail。消息编号标签信息必须保存在某处。

编辑：我尝试将所有文​​件移动到临时目录并再次返回，这表明它是负责消息编号的文件顺序。然而，我不确定为什么 12 月几天的消息被移动到比这些日期两侧的消息数量低得多的数量。文件名是时间戳，应该是连续的，所以除非 mv 以奇怪的顺序拍摄文件，否则我不明白为什么不会为这些特定文件恢复消息编号。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T11:36:48.383

使用 maildirs，消息没有固有的顺序。显示它们的程序可以按照它希望的顺序显示它们，这可能是随机的，但也可以基于例如 Date 标题。

您的示例没有识别显示它们的程序，任何人都可以猜测它是如何订购邮件的。您需要弄清楚它的作用并修复它以按照您想要的顺序订购邮件。

**编辑：** Maildir[规范](http://www.qmail.org/qmail-manual-html/man5/maildir.html)可能对挖掘有用。如果您的 MTA 确实通过放置可靠的时间戳创建了唯一的文件名，您也许可以通过文件名排序来凑合。即使这样的文件名也不能保证，它可能对您来说已经足够了。

# flash - 是否有适用于 flash cs3/cs4 (AS 3.0) 的免费 BAR GRAPH (2d) 类

> ID：472591
> 
> 赞同：0
> 
> 时间：2009-01-23T11:24:59.953
> 
> 标签：flash, actionscript-3

是否有用于 Flash cs3/cs4 的免费/开源 BAR GRAPH (2d) 组件或示例文件

我为 Actionscript2 找到了一些选项，但我需要使用 actionscript 3.0

（它首选从外部源加载数据，loadvars 或类似的）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T19:28:32.377

[http://teethgrinder.co.uk/open-flash-chart/](http://teethgrinder.co.uk/open-flash-chart/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T22:46:37.037

你也可以试试[Yahoo 的 Flash CS3 Charts](http://developer.yahoo.com/flash/astra-flash/charts/) ……它们真的很容易使用。

# c# - 多平台开发的最佳持续集成设置

> ID：472596
> 
> 赞同：3
> 
> 时间：2009-01-23T11:27:41.210
> 
> 标签：c#, java, continuous-integration

对于在多个环境中编码的开发部门来说，最好的持续集成设置是什么？

在我的公司，我们用 C# 和 Java 编写了一些代码，我以前使用过 CC.Net，但我从来没有用 Java 编写过 CInt。

我知道 Continuum 并且最近被告知有关 Hudson，但我从未使用过。

每个平台使用两个 CInt 服务，还是两者都使用一个更好？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T11:38:10.707

为什么不试试JetBrains 的[Team City ？](http://www.jetbrains.com/teamcity/)它适用于 Java 和 C#，专业版最多可免费提供 20 个用户帐户和 3 个构建代理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T11:47:46.287

您可以简单地使用 Java 版本的 CruiseControl 并进行两种设置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T13:07:08.203

正如您已经知道如何使用 CC.Net 和 CC.NET 可以运行任何输出 XML 的构建任务。为什么不将 CC.NET 与 ant 一起用于您的 java 代码和 C# 代码。

或者您是否需要在非 Windows 机器上构建？CC.NET 可能适用于单声道，我没有检查过。

请记住，编译所有代码并运行单元测试的**任何**持续集成设置都会为您**带来巨大的好处**。在大多数具有完美设置的项目中，与具有有效的持续集成设置相比只会带来较小的改进。所以我会选择你满意的东西**，现在就开始使用它**。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-24T05:11:58.643

恕我直言，为您计划部署到的所有平台使用一个 CI 几乎总是更好 - 以这种方式更容易解决问题。

无耻插件：试试[Bamboo，Atlassian 的](http://www.atlassian.com/bamboo)CI[服务器](http://www.atlassian.com)。它的一键设置，内置对 Ant 和 Maven 的支持，并且适用于所有带有 JVM 的平台。它还可以[在不同平台上进行分布式构建](http://www.atlassian.com/software/bamboo/features/distributed.jsp)。

如果您有这些产品，它还与[Atlassian Jira 问题跟踪器](http://www.atlassian.com/jira)和[鱼眼代码存储库浏览器集成。](http://www.atlassian.com/fisheye)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-25T20:32:25.623

[哈德逊](http://hudson-ci.org/)。我已经将它用于 .NET 和 Java 项目，并且让两个平台都使用相同的持续集成服务器效果很好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T12:04:12.510

请注意，这假设您要在多个平台上构建相同的代码。硬件变得更便宜了，所以使用虚拟机或多台物理服务器我会选择虚拟机并购买一台功能强大的服务器来运行它们，但如果你有很多旧的中档硬件，这可能是一个更便宜的选择。在一台服务器上设置一个主要的源代码控制存储库，并使用您要为其构建的客户端操作系统设置服务器。例如，有一个包含您选择的操作系统的 svn 服务器，一个用于构建 Linux 的 Linux 服务器和一个用于构建 Windows 的 Windows 服务器。然后只需安装最适合给定代码库和操作系统的持续集成软件。

# visual-studio - 为什么我不应该使用 /optimize 开关来编译我的 C# 代码？

> ID：472599
> 
> 赞同：7
> 
> 时间：2009-01-23T11:28:46.327
> 
> 标签：visual-studio, compiler-construction

在 Visual Studio 2008 中，有一个选项“优化代码”可能对应于 /optimize 选项。它永远不会启用，即使在“发布”模式下也是如此。

为什么我不希望始终启用此选项？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-23T11:31:36.320

它在默认情况下用于发布版本（也许您更改了发布版本的设置？）。将其关闭以使调试更容易。对于发布代码，将其打开。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-23T11:48:13.277

代码优化在 C#3 中已经相当不错了——它做了很多巧妙的性能调整，在 IL 中对代码的改变比你想象的要多得多。

一些混淆工具（以及其他一些 IL 工具，如 ILMerge）有时可以通过优化来破坏程序集。您使用的 IL 工具越多，您就越有可能遇到严重的优化问题。

同样正如@Brian Rasmussen 已经说过的（+1）-您希望它关闭以进行调试，打开以进行发布。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T12:10:53.947

为了明确这一点，优化会内联函数并消除一些变量。在调试优化代码时，您不会像往常一样从 IDE 获得那么多帮助，因为某些代码实际上已经不存在了。因此，对于调试，如果关闭则关闭（默认）。

在像 C++ 这样的语言中，优化有时（通常）具有需要考虑的严重副作用。据我所知，C# 不是或几乎不是这种情况，所以从代码的正确性来看，优化与否可能并不重要。

# javascript - 在 Javascript 中使用函数

> ID：472605
> 
> 赞同：0
> 
> 时间：2009-01-23T11:31:39.923
> 
> 标签：javascript

例子：

```
function pcs()
{
    var t1 = document.getElementById("tot1").value
    var pb = document.getElementById("pcbox").value
    var pc = ""

    if (t1==! && pb==!)
    {
        document.getElementId("rbox").innerHTML = ""
    }
} 
```

我的问题是如果`t1`并且`pb`为空，`pcs()`则不调用该函数...为什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T11:37:56.400

线

```
if(t1==! && pb==!)
```

不是合法的语法。如果这正是您编写代码的方式，它将不会解析，因此不会定义函数（另外您将收到 Javascript 错误）。

也许你的意思是

```
if(t1 != null && pb != null)
```

此外，虽然解释器可以推断出行尾的分号，但它们*应该*存在（而不是实际上是可选的）并且添加它们是一种很好的做法。

**编辑**虽然我没有 100% 理解您的最后一个问题，但请记住您编写的代码（假设语法正确）仅*定义*了一个函数。您需要让其他代码在适当的位置调用此函数才能执行它，例如对于某些元素`onblur = pcs();`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T11:37:43.670

这条线`if(t1==! && pb==!)`是胡说八道-您是说`if (!t1 && !pb)`什么？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T11:37:35.573

`if(t1==! && pb==!)`--> 这绝对是错误的......你要检查什么？

也许`if(t1!="" && pb!="")`？

# php - Zend 框架路由：.html 扩展名

> ID：472606
> 
> 赞同：9
> 
> 时间：2009-01-23T11:32:19.983
> 
> 标签：php, zend-framework, url, url-routing

我知道我以前见过这样做，但我在任何地方都找不到信息。我需要能够在 Zend 框架中使用 .html 扩展进行路由。

IE /controller/action.html 应该路由到适当的控制器/动作。

我们有一个想法用 .htaccess 文件丢弃 .html 扩展名，但我认为更改路由配置会是更好的解决方案。

欢迎任何建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-12-12T08:02:38.787

这是我在几个应用程序中使用的插件：

```
/**
 * Removes .html extension from URI, if present.
 */
class Application_Plugin_RemoveHtmlExtension extends Zend_Controller_Plugin_Abstract
{
    public function routeStartup(Zend_Controller_Request_Abstract $request)
    {
        // remove ".html" from the end of the URI
        $url = preg_replace('#\.html$#i', '', $request->getRequestUri());

        $request->setRequestUri($url);
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T16:12:56.017

在谷歌上快速搜索产生了以下教程：

[扩展 Zend Framework Route 和 Router 以实现 Zend Framework 中的自定义路由](http://my.opera.com/zomg/blog/2007/09/19/extending-zend-framework-route-and-router-for-custom-routing)
[Routing 和复杂 URL](http://codeutopia.net/blog/2007/11/16/routing-and-complex-urls-in-zend-framework/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-05-17T12:54:51.290

我试图对旧应用程序做同样的事情。这对我有用。

```
$front = Zend_Controller_Front::getInstance();
$router = $front->getRouter();
$router->addRoute('routeHTML', 
        new Zend_Controller_Router_Route_Regex( '([a-z-]+)/([a-z-]+)/([a-z-]+)\.html', array(),
        array(1 => 'module', 2 => 'controller', '3' => 'action') ,
        '%s/%s/%s.html')
); 
```

## 参考

*   [Zend_Controller_Router_Route_Regex 文档](https://framework.zend.com/manual/1.12/en/zend.controller.router.html#zend.controller.router.routes.regex)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T11:58:20.773

默认路由（不带模块）是：

```
:controller/:action 
```

您可以通过以下方式删除：

```
$router->removeDefaultRoutes(); 
```

然后添加您的版本：

```
:controller/:action.html 
```

# jquery - 什么可能导致 JQuery 的选择器损坏？

> ID：472610
> 
> 赞同：1
> 
> 时间：2009-01-23T11:34:30.150
> 
> 标签：jquery, selector, conflicting-libraries

我正在尝试使用 JQuery 的选择器获取一个元素，但即使该元素实际存在，它也找不到它。此外，我实际上可以使用 getElementById 找到元素。

例如：

$('#outputDiv') 给了我一个空值。但是 document.getElementById("outputDiv") 返回我试图访问的 Div。

任何的想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T11:39:40.500

检查 jQuery 是否实际加载。您是否使用 Firebug 或其他调试器进行了测试？是否报告了 javascript 错误？您是否使用另一个使用 $ 作为别名的库？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T11:45:09.693

您是否使用任何其他可能重载 $ 的库？我知道例如原型就是这样做的。

您可能想尝试发出 jQuery('#outputDiv') 来查看它是否实际上是您正在调用的 jQuery。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T12:06:01.837

如果您使用的是 IE7，那么事情发生的顺序是非常重要的，如果事先声明了 jQuery 脚本，即在 head 元素中，选择器往往不适用于动态生成的内容。

我们解决这个问题的一种方法是将代码放在文档的末尾。尽管这听起来很奇怪，*但*MS 将其记录为存在多年的错误。

# asp.net - 如何使用 JavaScript 从另一个列表框填充一个列表框？

> ID：472621
> 
> 赞同：1
> 
> 时间：2009-01-23T11:38:04.310
> 
> 标签：asp.net, javascript

谁能告诉我如何使用 JavaScript 或 ASP.NET 2.0 从另一个列表框项填充一个列表框？

> ### 复制
> 
> [如何在 JavaScript 中将一个列表框项移动到另一个列表框项？](https://stackoverflow.com/questions/204140/how-to-add-move-one-list-box-items-to-another-listbox-items-in-javascript)

例如——我的第一个列表框是地区，然后根据地区选择显示第二个列表框国家，并根据国家选择状态列表框将显示全部来自数据库，取决于地区 ID 或国家 ID n all

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T14:27:23.673

您可能对 ASP.net AJAX Control Toolkit 中的“Cascading Dropdown”控件感兴趣。 [http://www.asp.net/AJAX/AjaxControlToolkit/Samples/CascadingDropDown/CascadingDropDown.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/CascadingDropDown/CascadingDropDown.aspx)

您也可以在没有工具包的情况下执行此操作，使用来自 ASP.net AJAX 的标准 UpdatePanel 并将第一个下拉列表的“onChange”事件指定为要更新的 UpdatePanel 的“触发器”。确保在下拉列表中设置 AutoPostback="true" 以便正确触发它是你也走这条路线。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T11:48:21.060

您的问题遗漏了很多细节，但基本上您会将一个函数连接到`onchange`第一个列表框的事件，这将填充第二个列表框。如果需要动态加载内容，则需要使用 AJAX（或类似方法）将它们从服务器中拉出并将它们推送到第二个框中；或者，如果您的内容是静态定义的并且不是太重，那么将它们与原始文档一起提供（可能作为键控第一个列表框的值的关联数组）会更敏感，然后根据数组查找更新第二个列表框.

# java - 如何一般比较整个java bean？

> ID：472626
> 
> 赞同：21
> 
> 时间：2009-01-23T11:41:08.967
> 
> 标签：java, javabeans

我一直在尝试探索 org.apache.commons.beanutils 库的方法/习语来评估2 个实例之间的*所有*属性是否相等，即 bean 的通用 equals() 方法。
有没有一种简单的方法来做这个usnig这个库？还是我以错误的方式解决这个问题？谢谢。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-23T12:26:36.910

试试[commons-lang](http://commons.apache.org/lang/)的[EqualsBuilder.reflectionEquals()](https://commons.apache.org/proper/commons-lang/javadocs/api-3.3.2/org/apache/commons/lang3/builder/EqualsBuilder.html#reflectionEquals%28java.lang.Object,%20java.lang.Object,%20boolean%29)。EqualsBuilder 有一组方法来包含所有字段、所有非瞬态字段以及除某些字段之外的所有字段。

如果一切都失败了，代码可以作为一个很好的例子来实现它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-23T11:50:18.200

要直接回答您的问题，您可以使用反射对 bean 进行相等性检查。您需要注意一些障碍。

关于 equals() 和 hashcode() 的行为有一些规则。这些规则讨论了对称性、一致性和自反性，当您的 equals 方法根据您传入的其他对象动态运行时，这可能很难做到。

有趣的阅​​读： [http ://www.geocities.com/technofundo/tech/java/equalhash.html](http://www.geocities.com/technofundo/tech/java/equalhash.html)

一般来说，我认为你最好创建自己的 hashcode 和 equals 方法。有一些很好的插件可以根据类属性自动为您生成该代码。

说了这么多，下面是一些我很久以前写的获取 getter、setter 和属性的（旧式）方法：

```
private Map getPrivateFields(Class clazz, Map getters, Map setters) {
    Field[] fields = clazz.getDeclaredFields();
    Map m = new HashMap();
    for (int i = 0; i < fields.length; i++) {
        int modifiers = fields[i].getModifiers();
        if (Modifier.isPrivate(modifiers) && !Modifier.isStatic(modifiers) && !Modifier.isFinal(modifiers)) {
            String propName = fields[i].getName();
            if (getters.get(propName) != null && setters.get(propName) != null) {
                m.put(fields[i].getName(), fields[i]);
            }
        }
    }
    return m;
} 
```

吸气剂：

```
private Map getGetters(Class clazz) {
    Method[] methods = clazz.getMethods();
    Map m = new HashMap();
    for (int i = 0; i < methods.length; i++) {
        if (methods[i].getName().startsWith("get")) {
            int modifiers = methods[i].getModifiers();
            if (validAccessMethod(modifiers)) {
                m.put(getPropertyName(methods[i].getName()), methods[i]);
            }
        }
    }
    return m;
} 
```

和二传手：

```
private Map getSetters(Class clazz, Map getters) {
    Method[] methods = clazz.getMethods();
    Map m = new HashMap();
    for (int i = 0; i < methods.length; i++) {
        if (methods[i].getName().startsWith("set")) {
            int modifiers = methods[i].getModifiers();
            String propName = getPropertyName(methods[i].getName());
            Method getter = (Method) getters.get(propName);

            if (validAccessMethod(modifiers) && getter != null) {
                Class returnType = getter.getReturnType();
                Class setType = methods[i].getParameterTypes()[0];
                int numTypes = methods[i].getParameterTypes().length;

                if (returnType.equals(setType) && numTypes == 1) {
                    m.put(propName, methods[i]);
                }
            }
        }
    }
    return m;
} 
```

也许你可以用它来滚动你自己的。

**编辑：**当然，[Aaron Digulla 的回答中的](https://stackoverflow.com/questions/472626/how-to-generically-compare-entire-java-beans#472705)[反射](http://commons.apache.org/lang/api/org/apache/commons/lang/builder/EqualsBuilder.html#reflectionEquals(java.lang.Object,%20java.lang.Object))生成器比我的手艺要好得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T13:22:07.283

如上所述，基于反射的实现会做你想做的事。我只是想警告你，反射是相当昂贵的，而且这样的实现可能会比较慢。如果您只需要偶尔进行比较，就可以了。但是，如果您有庞大的数据集和频繁的相等性检查（例如过滤大表），您可能会遇到麻烦。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-01-30T16:45:10.803

或者，虽然不是您问题的直接答案，但它可能是您问题的答案（即在超快的*同时*消除做样板代码的工作）

如果您使用 Eclipse，以下步骤将自动为您生成 hashCode 和 equals：

来源 > 生成 hashCode 和 equals...

然后选择字段，超级有效！:D

干杯，我希望它可以帮助任何来到这里的人，目的是减少一些时间编写样板。

PS：我相信其他流行的 IDE 肯定也有类似的功能。

# c++ - GetGuiResources 的使用

> ID：472630
> 
> 赞同：2
> 
> 时间：2009-01-23T11:47:10.627
> 
> 标签：c++, c, windows, winapi, handle-leak

`GetGuiResources(GetCurrentProcess(), GR_GDIOBJECTS)`在开始时`WinMain`和最后一次返回之前使用来检测 GDI 泄漏或者更具体地说，我忘记释放的对象是一个好主意吗？
另外我目前想知道为什么我的程序中的第一个调用在`4`还没有窗口时返回。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T14:35:31.177

在大多数情况下，使用[process explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)就足够了。保持窗口打开，显示进程的 GDI 句柄（右键单击列，选择“选择列”，然后选中“进程内存”选项卡中的“GDI 对象”复选框）。

在运行您的应用程序时，请注意 GDI 句柄的数量 - 如果它增加并且永远不会返回，您就知道您有泄漏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T12:32:22.687

The code with this [MSDN magazine article](http://msdn.microsoft.com/en-us/magazine/cc301756.aspx) provided a slick way to troubleshoot GDI handle leaks. Unfortunately, the source code no longer seems to be available...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T12:14:54.767

虽然这会告诉您是否泄漏了任何 GDI 对象，但它不会告诉您有关您泄漏了哪些 GDI 对象的任何信息。在一个重要的程序中，我认为这没有多大帮助。

如果要跟踪 GDI 对象，我相信有一些 Performance Counters 可以显示当前在进程中分配的 GDI 对象句柄的数量。您可以随着时间的推移观察它，以更好地了解您的程序泄漏的位置。

# css - 如何使用 Float（在打印样式表中）修复此打印布局？

> ID：472632
> 
> 赞同：9
> 
> 时间：2009-01-23T11:48:10.857
> 
> 标签：css, css-float

我有一个包含多个图表的页面，格式如下：

```
[ ] [ ] [ ] [ ]
[ ] [ ] [ ] [ ]
[ ] [ ] [ ] [ ]
[ ] [ ] [ ] [ ]
[ ] [ ] [ ] [ ] 
```

每个图表都显示在一个包装器中，`float:left`并且图表所在的 div 有`overflow: auto`。这提供了将图表包装到屏幕宽度的所需布局。

我遇到的问题是，在打印模式下，这只打印一页而丢失其余的（第一页也是空白的）。我已经阅读了一点并且理解在大多数情况下解决方案是`float:none`解决上述问题的应用程序......但是我失去了网格格式并且我想要打印页面上的图表不止一列。

我怎样才能解决这个问题？

我正在使用打印样式表，但这里是屏幕样式：

```
.chartSpace  /* surrounds all charts */
{
    padding-top: 20px;
    width: auto;
    overflow: auto;
}

.chartWrapper /* wrapper for each chart */
{
    float: left;
    padding: 0 20px 0 0;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2014-09-25T09:00:19.187

浮点数在打印 css 中效果不佳，因此删除浮点数或使用 float: none 覆盖它们并改用 inline-block：

```
.chartWrapper {
    float: none;
    display: inline-block;
    vertical-align: top;
    padding: 0 20px 0 0;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T00:43:10.873

我不知道你是否真的需要`float: left`其他东西，但你可以尝试：

```
/* wrapper for each chart */
.chartWrapper { display: inline; padding: 0 20px 0 0; } 
```

这也将使`div`s 彼此相邻，并且不会对文档流产生奇怪的影响。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-04-11T14:50:24.193

过去我有同样的问题。自从我一直在寻找解决方案。我最喜欢的方法是使用`<table>`元素。并建立一个不同的页面进行打印。大量的工作，但最终值得。因为我需要它来计费。我的客户真的无法收到丑陋的账单。

例子：

```
<table style="width: 100%;">
  <tr>
    <td>Alek Rasschaert</td>
    <td style="width: 60%"></td>
    <td>Mobile Express</td>
  </tr>
  <tr>
    <td>Diestsesteenweg 93</td>
    <td style="width: 60%"></td>
    <td>Diestsesteenweg 93</td>
  </tr>
  <tr>
    <td>3010 Kessel-Lo</td>
    <td style="width: 60%"></td>
    <td>3010 Kessel-Lo</td>
  </tr>
</table> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-20T08:25:38.437

这是我在一个项目中遇到的一个问题，不幸的是我没有找到直接的答案。Jeroens 的回答对我不起作用，因为我还在每个图像下显示了一些标题文本，因此我需要 display:block 行为。我最终采用的方法如下：

*   首先，我假设用户将以纵向模式在 A4 纸上打印。我将它包含在页面上的一个消息框中（'为了获得最佳效果，请以纵向模式打印......等），它在打印时是隐藏的。
*   其次，您仍然可以浮动图表，但您应该在每行之后插入一个清除 div。（我知道在横向模式下打印时这会弄乱布局，因此我在上面的第一点）。

[][][][]
------- 清除 div
[][][][]
------- 清除 div
[][][][]
等...

*   我还更进一步，在足够多的行之后插入了一个分页 div 以填充 A4 页面（多少取决于您的图像大小）。

为此，我使用了以下样式：

```
div.pageBreak {
    page-break-after: always;
    visibility:hidden;
    height:1px !important;
    margin:0;
} 
```

最后，做大量的跨浏览器测试！我发现我必须使图像非常小，以使相同的网格布局适合跨浏览器的一页。这是由于不同浏览器使用的默认页边距不同造成的。

希望这可以帮助。

# sql-server - 如何将 Excel 电子表格导入 SQL Server？

> ID：472638
> 
> 赞同：13
> 
> 时间：2009-01-23T11:50:28.280
> 
> 标签：sql-server, excel, import

我需要将 Excel 电子表格导入 SQL Server 2005。我需要采取哪些步骤来完成此操作？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-23T11:53:00.380

“数据转换服务”向导是您的朋友。

此处的说明假定 SQL Server 2000

*   打开 SQL Server 企业管理器
*   右键单击相应的服务器
*   选择导入数据
*   运行向导。
    *   在第一个屏幕上单击下一步
    *   选择“Microsoft Excel”作为您的数据源
    *   输入 XLS 文件的路径，然后单击下一步。
    *   输入数据库的连接详细信息，然后单击下一步。

根据您要对数据执行的操作，您有一些新选项。对于一次性工作，我通常发现最简单的方法是导入所有 Excel 数据，然后在 SQL Server 中对其进行编辑，但如果您要对多个文件重复此操作，您可能想要制作一个非常性感的导入脚本。

如果要再次运行它，可以使用向导保存 DTS 包，然后在企业管理器的“数据转换服务”部分进行编辑。这是了解 DTS 工作原理的好方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-23T14:15:15.617

您也可以使用 OPENROWSET

```
INSERT INTO SOMETABLE SELECT * FROM OPENROWSET( 'Microsoft.Jet.OLEDB.4.0',
'Excel 8.0;Database=C:\testing.xls','SELECT * FROM [Sheet1$]') 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-23T12:01:26.370

另一种快速且（非常）肮脏的解决方案是将公式添加到 excel 表中，如下所示：

```
="INSERT INTO table1(col1, col2, col3) SELECT " & A1 & ", '" & B1 & "', '" & C1 & "'" 
```

将其复制下来（CTRL + D），您就可以开始了。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2017-11-12T00:52:18.337

如果您的电子表格没有很好地组织到 SQL 表的一对一导入（例如，格式化为具有子标题、空格、累加器列等的可读性），那么您可以使用现成的工具做这种事情。有关示例，请参阅[Khronos Excel 泵。](http://www.startgroup.com.au/khronosexcelpump.html)免责声明 - 我为销售此产品的公司工作。它非常可配置，因此您可以将电子表格保持在人工布局中，并且仍然可靠地导入结构化 SQL 表，包括用标识字段值替换文本值或将宽网格旋转到窄表等。

# c - 如何在 GMP 发生之前或之后检测尾数精度溢出？

> ID：472652
> 
> 赞同：1
> 
> 时间：2009-01-23T12:00:27.993
> 
> 标签：c, overflow, detection, gmp

我要问的问题*涉及*尾数，而不是[指数](https://stackoverflow.com/questions/472211/how-to-detect-exponent-overflow-in-gmp-before-or-after-it-happens)，并且与我在本周早些时候提出的关于[两个负浮点数之和的“缺失”数字的问题有很大关系。](https://stackoverflow.com/questions/464358/lost-precision-on-gmp-mpfadd-where-have-my-digits-gone)

鉴于尾数具有可变精度，如何判断是否已经溢出尾数的当前精度设置？或者，从主动方面来看，如何判断尾数精度是否可能溢出？

亲切的问候，布鲁斯。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T07:06:36.243

有一些数值方法可以查看您是否会失去精度，但最重要的是您需要更好地理解精度的定义。

-4939600281397002.2812

和

-4939600281397002.2812000000000000

不是同一个数字。

当你添加

-2234.6016114467412141

和

-4939600281397002.2812

一起，*正确*的输出将只有 20 位精度，因为较小数字中的额外 12 位是没有意义的，因为较大数字中的 12 个类似大小的数字是*未知*的。您可以暗示它们为零，但如果是这种情况，那么您必须明确声明它们为零，并使用可以处理它的编号系统 - 计算机不擅长理解隐含意图。

至于检测何时会遇到此问题，您需要做的就是找出它们是否具有相同的指数（假设归一化尾数 +/- 1 或类似的二进制等效项）。如果它们没有被标准化，那么您需要对它们进行标准化以进行比较，或者使用稍微复杂的指数比较。

精度和准确度不是一回事...

-亚当

# shuffle - 改组有偏随机数

> ID：472662
> 
> 赞同：3
> 
> 时间：2009-01-23T12:02:37.443
> 
> 标签：shuffle, random

在思考[这个](https://stackoverflow.com/questions/472013/generate-a-series-of-random-numbers-that-add-up-to-n-in-c#472072)问题并与参与者交谈时，出现了一个想法，即对一组有限的明显有偏差的随机数进行洗牌会使它们随机化，因为你不知道它们被选中的顺序。这是真的吗？如果是这样，有人可以指出一些资源吗？

编辑：我想我可能有点不清楚。假设一个坏的随机数生成器。取 n 个值。这些是有偏见的（rng 不好）。有没有办法通过改组使多次试验的 rng 输出在统计上与已知良好 rng 的输出相匹配？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T12:24:36.620

**错误的。**

有一个简单的测试：假设原始集合创建算法中的偏差是“创建算术平均值显着低于预期平均值的集合”。显然，改组算法的结果不会改变平均值，因此不会消除偏差。

另外，关于您的说明：您将如何洗牌？使用最初创建集合的错误 RNG 的相同错误输出？还是使用更好的RNG？这就提出了为什么你不直接使用它的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T12:22:10.540

这**不是真的**。在[另一个问题](https://stackoverflow.com/questions/472013/generate-a-series-of-random-numbers-that-add-up-to-n-in-c#472072)中，问题是在 [1..9] 中选择 30 个随机数，总和为 200。在平均随机选择大约 20 个后，您会达到无法再选择 9 的程度，因为这会使总和超过 200。在剩下的 10 个数字中，大多数是 1 和 2。所以最后，在选定的数字中，一和二的比例非常高。洗牌不会改变这一点。但目前尚不清楚随机分布到底应该是什么样子，所以可以说这是一个很好的解决方案。

**一般来说**，如果你的“随机”数字会偏向于，比如说，低数字，那么无论排序如何，它们都会以这种方式产生偏差。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T12:11:30.577

**错误的**

集合是有限的，假设由`n`数字组成。如果你选择`n+1`数字会发生什么？让我们还考虑一个在许多语言中实现的基本随机函数，它给你一个随机数`[0,1)`。但是，此数字限制为小数点后三位数字，为您提供一组 1000 个可能的数字 ( `0.000 - 0.999`)。但是，在大多数情况下，您不需要使用所有这 1000 个数字，因此这种*随机性*已经绰绰有余。

但是对于某些用途，您将需要比这更好的随机生成器。所以这一切都归结为你需要多少随机数，以及你需要它们有多随机。

* * *

*阅读原始问题后补充*：如果您有某种限制（例如在原始问题中，每组选择的数字必须相加一定），您*本身*`N`并不是真正选择随机数，而是选择给定集合中**随机顺序**的数字（具体而言，数字的排列总和为）。***`N`

* * *

**添加到编辑：**假设您的错误数字生成器生成了序列`(1,1,1,2,2,2)`。排列是否`(1,2,2,1,1,2)`满足您对**random**的定义？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T12:13:46.297

只是洗牌一组已经随机数的数字当然不会对概率分布产生任何影响。那将意味着错误。也许我误解了你的问题？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T12:17:16.603

我会说假的，但要注意：

我认为有随机，然后有“足够随机”。对于我需要处理的大多数应用程序，“足够随机”已经绰绰有余，即从大约 300 个已付费放置在该网站上的列表中选择一个“随机”广告显示在页面上。

我确信数学家可以证明我非常基本的“随机”选择标准根本不是真正随机的，但实际上是可以预测的——对于我的客户和用户来说，没有人在乎。

另一方面，如果我正在编写一个在拉斯维加斯使用的视频游戏，那里手头有大量资金，我会以不同的方式定义随机（并且可能很难找到真正的随机）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T13:19:00.020

**完全不真实**：洗牌不会消除偏见，它只是将其隐藏在不经意的观察者面前。这就像只是推到沙发底下从地毯上取下你的狗精心准备的礼物 - 你真的没有解决问题，你只是让它变得不那么引人注目。有鼻子的人都知道，还有一个问题需要解决。

随机性必须在整个范围内均匀应用，所以这是一种方法（在我脑海中，有很多假设，yadda yadda。关键是方法，而不是代码 - 从一切开始，然后引入你的随机性一个一致的方式，直到你完成。现在唯一的偏见取决于为“目标”和“数字数量”选择的值，这是问题的一部分。）

```
target = 200
numberofnumbers = 30
numbers = array();
for (i=0; i<numberofnumbers; i++)
  numbers[i] = 9
while (sum(numbers)>target)
  numbers[random(numberofnumbers)]-- 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-07-22T21:30:00.977

**错误的。**考虑一个只产生零的坏随机数生成器（我说它是*坏*的:-) 再多的改组零不会改变该序列的*任何*属性。

# c++ - VS2008 SP1 中的 Lambda 表达式支持

> ID：472667
> 
> 赞同：2
> 
> 时间：2009-01-23T12:06:28.183
> 
> 标签：c++, visual-studio-2008, lambda, c++11

Visual Studio 2008 SP1 中是否支持来自 C++ 0x 的 lambda 表达式？下面的示例向我抛出语法错误。编译器或其他东西是否有任何“-Cpp0x”标志？

```
#include <algorithm>
#include <iostream>
#include <ostream>
#include <vector>

using namespace std;

int main() 
{
  vector<int> v;

  for (int i = 0; i < 10; ++i) 
  {
    v.push_back(i);
  }

  for_each(v.begin(), v.end(), [](int n) { cout << n << " "; });
  cout << endl;
} 
```

先感谢您。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T12:14:12.973

请参阅[Stackoverflow 问题 #146381](https://stackoverflow.com/questions/146381/visual-studio-support-for-new-c-c-standards)

简单地说：没有。Visual Studio 2010 将在一定程度上支持 C++0x，但我不确定这是否包含 lambda 表达式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-06T02:21:15.857

你可以……有点。

Visual C++ 2008*编译器*不支持 lambda，但您当然**可以**使用Visual Studio 2008中的 Visual C++ 2010*编译器！*

只需安装 Visual C++ 2010 Express，然后打开 Visual Studio 2008 并转到：

> 工具`->`选项`->`项目和解决方案`->`VC++ 目录

然后添加以下条目：

*   对于 Win32 平台，`$(ProgramFiles)\Microsoft Visual Studio 10.0\VC\bin`在**开头**插入，`$(ProgramFiles)\Microsoft Visual Studio 10.0\Common7\IDE`在**结尾**插入。

*   对于 x64 平台，`$(ProgramFiles)\Microsoft Visual Studio 10.0\VC\bin\amd64`在**开头**插入.

现在您可以使用 Visual Studio 2008 中的所有 VC++ 2010 功能！:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:24:48.360

Visual Studio 不支持，而是使用 Boost 库。

# flash - 打开另一个程序后调整大小的 Flash 文档中的全屏？

> ID：472668
> 
> 赞同：0
> 
> 时间：2009-01-23T12:06:40.210
> 
> 标签：flash, actionscript-3, fullscreen

我为 CD 创建了一个 Flash 界面，其中包含一些打开一些 Word 文档的按钮。我使用 fscommand 打开文件。

`fscommand("exec", "documnet.doc");`

但是在文档打开后，flash 文档从全屏调整大小。

问题是：如何在聚焦另一个程序或打开另一个程序后使 Flash 文档（swf 或 exe）仍然全屏？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T21:39:53.880

您可以在舞台上添加一个事件监听器。因此，当舞台被激活时，您将重新进入全屏模式。试试这个代码：

```
stage.addEventListener(Event.ACTIVATE, 
  function(event:Event) { 
    trace("Enter full screen");  
  } 
); 
```

[您可以从'stage' 对象调度的事件列表中](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/Stage.html)选择更适合您的项目的其他事件。（不要忘记显示所有继承的事件。

# c# - List 之间自由转换 和 IEnumerable

> ID：472669
> 
> 赞同：104
> 
> 时间：2009-01-23T12:06:43.487
> 
> 标签：c#, linq, list, ienumerable

如何将 a 转换`List<MyObject>`为 an`IEnumerable<MyObject>`然后再返回？

我想这样做是为了在列表上运行一系列 LINQ 语句，例如`Sort()`

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2009-01-23T12:08:20.007

```
List<string> myList = new List<string>();
IEnumerable<string> myEnumerable = myList;
List<string> listAgain = myEnumerable.ToList(); 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-23T13:15:48.480

A`List<T>`是 an `IEnumerable<T>`，所以实际上，没有必要将 a '转换'`List<T>`为 an `IEnumerable<T>`。由于 a`List<T>`是一个`IEnumerable<T>`，您可以简单地将 a 分配给`List<T>`一个类型为 的变量`IEnumerable<T>`。

反过来说，不是每一个`IEnumerable<T>`都是`List<T>`offcourse，所以你必须`ToList()`调用`IEnumerable<T>`.

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-02-17T12:33:38.263

A`List<T>`已经是`IEnumerable<T>`，因此您可以直接在`List<T>`变量上运行 LINQ 语句。

如果您没有看到像`OrderBy()`我猜的那样的 LINQ 扩展方法，那是因为您的源文件中没有`using System.Linq`指令。

但是，您确实需要将 LINQ 表达式结果显式转换回`List<T>`：

```
List<Customer> list = ...
list = list.OrderBy(customer => customer.Name).ToList() 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-23T13:09:06.980

另外：请注意，标准 LINQ 运算符（根据前面的示例）不会更改*现有*列表 -`list.OrderBy(...).ToList()`将根据重新排序的序列创建一个新列表。然而，创建一个允许您使用 lambdas 的扩展方法非常容易`List<T>.Sort`：

```
static void Sort<TSource, TValue>(this List<TSource> list,
    Func<TSource, TValue> selector)
{
    var comparer = Comparer<TValue>.Default;
    list.Sort((x,y) => comparer.Compare(selector(x), selector(y)));
}

static void SortDescending<TSource, TValue>(this List<TSource> list,
    Func<TSource, TValue> selector)
{
    var comparer = Comparer<TValue>.Default;
    list.Sort((x,y) => comparer.Compare(selector(y), selector(x)));
} 
```

然后你可以使用：

```
list.Sort(x=>x.SomeProp); // etc 
```

这会以与通常相同的方式更新*现有列表。*`List<T>.Sort`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-11-07T10:18:40.297

## 转换`List<T>`为`IEnumerable<T>`

`List<T>`实现`IEnumerable<T>`（以及许多其他，例如`IList<T>, ICollection<T>`），因此无需将 List 转换回 IEnumerable，因为它已经是`IEnumerable<T>`.

例子：

```
public class Person
{
    public int Id { get; set; }
    public string Name { get; set; }
}

Person person1 = new Person() { Id = 1, Name = "Person 1" };
Person person2 = new Person() { Id = 2, Name = "Person 2" };
Person person3 = new Person() { Id = 3, Name = "Person 3" };

List<Person> people = new List<Person>() { person1, person2, person3 };

//Converting to an IEnumerable
IEnumerable<Person> IEnumerableList = people; 
```

你也可以使用`Enumerable.AsEnumerable()`方法

```
IEnumerable<Person> iPersonList = people.AsEnumerable(); 
```

* * *

## 转换`IEnumerable<T>`为`List<T>`

```
IEnumerable<Person> OriginallyIEnumerable = new List<Person>() { person1, person2 };
List<Person> convertToList = OriginallyIEnumerable.ToList(); 
```

[这在Entity Framework](https://stackoverflow.com/a/17996264/340046)中很有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-28T10:20:41.330

为了防止内存重复，resharper 建议这样做：

```
List<string> myList = new List<string>();
IEnumerable<string> myEnumerable = myList;
List<string> listAgain = myList as List<string>() ?? myEnumerable.ToList(); 
```

.ToList() 返回一个新的不可变列表。因此，对 listAgain 的更改不会影响@Tamas Czinege 答案中的 myList 。在大多数情况下这是正确的，至少有两个原因：这有助于防止一个区域的更改影响另一个区域（松散耦合），并且它非常可读，因为我们不应该在设计代码时考虑编译器问题。

但是在某些情况下，例如处于紧密循环中或在嵌入式或低内存系统上工作，应该考虑编译器的考虑。

# sql - 配置 Microsoft 速度时出现连接错误

> ID：472672
> 
> 赞同：0
> 
> 时间：2009-01-23T12:08:32.970
> 
> 标签：sql, appfabric

我正在尝试在将使用 sql 数据库作为其配置存储的机器上安装 Microsoft velocity。

我已正确输入连接字符串，但是当我测试连接失败时，以下是日志：

2009-01-23 11:54:30.03 登录错误：18456，严重性：14，状态：11。 2009-01-23 11:54:30.03 用户“NT AUTHORITY\ANONYMOUS LOGON”登录失败。[客户：xxx.xx.xx.xxx]

这意味着登录有效，但连接失败，有人可以帮忙吗？

先感谢您

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:15:58.330

'NT AUTHORITY\ANONYMOUS LOGON' 表示您用于登录的帐户未在 SQL Server 中识别。您需要确保该帐户在安全性中列出并且对您要连接的数据库具有权限。

# vb.net - 从 VS VB 2008 项目中优雅地删除数据源？

> ID：472676
> 
> 赞同：1
> 
> 时间：2009-01-23T12:11:17.317
> 
> 标签：vb.net, visual-studio-2008, datasource

从 VB2008 项目中删除不再需要的数据源的最佳方法是什么？

在解决方案资源管理器中删除数据源会引发大量错误。在数据集设计器的设计视图中删除表会引发错误。删除表单底部的表适配器会引发错误，现在我的工具箱中的`<ProjectName>`组件面板中到处都是旧的数据源组件。

如何优雅地删除数据源？我错过了一些明显的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T14:53:06.350

通过对所有创建的对象进行一些阅读，并进行一些逻辑思考，我发现一个令人满意的顺序是。

1.  删除绑定源
2.  删除表适配器
3.  **如果有任何其他数据源，**请勿删除 TABLE ADAPTER MANAGER 。****
***   删除表单加载事件中的代码行*   从解决方案资源管理器中删除架构**

 **不过，我仍然不知道如何从工具箱中删除多余的位。有人可以帮忙吗？

# php - 制作一个恒定的标题 - CSS问题

> ID：472690
> 
> 赞同：2
> 
> 时间：2009-01-23T12:17:55.900
> 
> 标签：php, javascript, html, css, ajax

我有一个 AJAX 应用程序，它使用 CSS div 在屏幕上创建面板，这些面板根据之前加载的内容分别连续加载。底部的“面板”是一个表格，显示来自数据库的列表或记录。数据库的顶部是表的名称，我想要一种方法让它始终位于记录列表的上方。我不确定如何做到这一点，如果它是使用 Javascript，或 PHP，或 css 和 html。

编辑：我尝试将表头包装在 div 中并为此设置 css，但表头似乎不在其自己的标题中，并且不会与记录分开留在屏幕上。

```
.tableheader {
    position: absolute;
} 
```

和

```
$table = 'AUCTIONS';

$rows = getRowsByArticleSearch($query, $table);

echo '<div id="tableheader" class="tableheader">';

echo "<h1>{$query} Auctions</h1>" . "\n"; 
echo "</div>"; 
```

我在这里错过了一些基本的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T12:39:38.320

我假设您的意思是能够在不移动标题的情况下滚动表格？

我认为您最简单的选择是 CSS[`overflow`属性](http://www.w3schools.com/Css/pr_pos_overflow.asp)。

```
<style type="text/css">
  div#dblist {
    overflow: scroll;
    height: 400px;
  }
</style>

<!-- ... -->

<div>Database Title</div>
<div id="dblist">
  <table>
    <!-- ... -->
  </table>
</div> 
```

* * *

@Joshxtothe4：听起来您将滚动设置为错误的元素：

```
<div> <!-- sounds like you have it set here -->
  <div><h1>Query Archive</h1></div>
  <div> <!-- and want it set here -->
    <table>
      <!-- ... -->
    </table>
  </div>
</div> 
```

为此，您不需要绝对定位。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T12:37:24.113

您是否希望表格名称与表格一起出现在面板内？如果是这样，我认为它应该很简单，但也许我遗漏了一些东西。

如果您希望表格名称位于它所来自的面板之外，也许您可​​以使用 CSS 属性`position: absolute`（连同一个`top`and`left`属性）将其放在页面顶部。

或者，您可能希望使用 javascript 重新设置 div 的父级。例如，如果您在页面顶部创建一个空的 div，您希望标题所在的位置，并给它一个 id`titleParent`并将标题放在 id 的 div 中`parent`，以下 javascript 片段应该将标题 div 从底部面板到顶部 div：

```
var title = document.getElementById('title');
document.getElementById('titleParent').appendChild(title); 
```

只需将该片段放在`<script>`底部面板之后的块中即可。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T10:54:49.857

您将希望使用 tbody（表格主体）来包含您的数据，并在该元素上设置溢出：滚动以获得您正在寻找的效果。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <title>Page Title</title>

        <style type="text/css" media="screen">
        table {

            margin:0;
            padding:0px;
        }

        tbody {
                height:80px;
                overflow-x:hidden;
                overflow-y:scroll;
                margin:0;
                padding:0;
            }
        table td, table th{ padding:2px;}

        </style>
    </head>
    <body>
        <table>
            <thead>
                <tr><th>Header</th><th>Header</th><th>Header</th><th>Header</th></tr>
            </thead>

            <tbody>
                <tr><td>Data</td><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td><td>Data</td></tr>

            </tbody>
        </table>
    </body>
</html> 
```

# windows - 如何复制目录结构但仅包含某些文件（使用 Windows 批处理文件）

> ID：472692
> 
> 赞同：116
> 
> 时间：2009-01-23T12:18:36.723
> 
> 标签：windows, batch-file, cmd, robocopy

正如标题所说，我如何递归地复制目录结构但只包含一些文件。例如，给定以下目录结构：

```
folder1
  folder2
    folder3
      data.zip
      info.txt
      abc.xyz
    folder4
    folder5
      data.zip
      somefile.exe
      someotherfile.dll 
```

文件**data.zip**和**info.txt**可以出现在目录结构中的任何位置。如何复制完整的目录结构，但只包含名为 data.zip 和 info.txt 的文件（应忽略​​所有其他文件）？

生成的目录结构应如下所示：

```
copy_of_folder1
  folder2
    folder3
      data.zip
      info.txt
    folder4
    folder5
      data.zip 
```

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-01-23T12:25:12.560

你没有提到它是否只能是批处理，但如果你可以使用`ROBOCOPY`，试试这个：

```
ROBOCOPY C:\Source C:\Destination data.zip info.txt /E 
```

编辑：将`/S`参数更改`/E`为包括空文件夹。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-07-09T14:48:23.083

一次复制一个文件且不需要 ROBOCOPY 的替代解决方案：

```
@echo off
setlocal enabledelayedexpansion

set "SOURCE_DIR=C:\Source"
set "DEST_DIR=C:\Destination"
set FILENAMES_TO_COPY=data.zip info.txt

for /R "%SOURCE_DIR%" %%F IN (%FILENAMES_TO_COPY%) do (
    if exist "%%F" (
        set FILE_DIR=%%~dpF
        set FILE_INTERMEDIATE_DIR=!FILE_DIR:%SOURCE_DIR%=!
        xcopy /E /I /Y "%%F" "%DEST_DIR%!FILE_INTERMEDIATE_DIR!"
    )
) 
```

外部 for 语句生成子目录 in`SOURCE_DIR`和 name in的任何可能的路径组合`FILENAMES_TO_COPY`。对于每个现有文件，都会调用 xcopy。保存需要`FILE_INTERMEDIATE_DIR`在其中创建的文件的子目录路径。`SOURCE_DIR``DEST_DIR`

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-12-18T20:40:52.267

尝试将 find 的输出（即文件路径）传递到 cpio

```
find . -type f -name '*.jpg' | cpio -p -d -v targetdir/ 
```

cpio 检查目标文件上的时间戳——因此它既安全又快速。

一旦你习惯了它，删除 -v 以获得更快的操作。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-03-16T17:12:50.550

如果 Powershell 是一个选项，您可以这样做：

```
Copy-Item c:\sourcePath d:\destinationPath -filter data.zip -recurse 
```

主要缺点是它会复制所有文件夹，即使它们最终会是空的，因为没有文件与您指定的过滤器匹配。因此，除了包含所需文件的少数文件夹外，您最终可能会得到一棵充满空文件夹的树。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2018-02-28T21:18:55.570

要将所有文本文件复制到 G: 并保留目录结构：

```
xcopy *.txt /s G: 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-11-10T04:26:50.137

感谢以前的答案。:)

此脚本名为“r4k4copy.cmd”：

```
@echo off
for %%p in (SOURCE_DIR DEST_DIR FILENAMES_TO_COPY) do set %%p=
cls
echo :: Copy Files Including Folder Tree
echo :: http://stackoverflow.com
rem     /questions/472692/how-to-copy
rem     -a-directory-structure-but-only
rem     -include-certain-files-using-windows
echo :: ReScripted by r4k4
echo.
if "%1"=="" goto :NoParam
if "%2"=="" goto :NoParam
if "%3"=="" goto :NoParam
setlocal enabledelayedexpansion
set SOURCE_DIR=%1
set DEST_DIR=%2
set FILENAMES_TO_COPY=%3
for /R "%SOURCE_DIR%" %%F IN (%FILENAMES_TO_COPY%) do (
if exist "%%F" (
set FILE_DIR=%%~dpF
set FILE_INTERMEDIATE_DIR=!FILE_DIR:%SOURCE_DIR%=!
xcopy /E /I /Y "%%F" "%DEST_DIR%!FILE_INTERMEDIATE_DIR!"
)
)
goto :eof
:NoParam
echo.
echo Syntax: %0 [Source_DIR] [Dest_DIR] [FileName]
echo Eg.   : %0 D:\Root E:\Root\Lev1\Lev2\Lev3 *.JPG
echo Means : Copy *.JPG from D:\Root to E:\Root\Lev1\Lev2\Lev3 
```

它接受“Source”、“Destination”和“FileName”的变量。它也只能复制指定类型的文件或选择性文件名。

欢迎任何改进。:)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-01-09T15:34:49.247

仅使用 find 和 cp：

```
mkdir /tmp/targetdir
cd sourcedir
find . -type f -name '*.zip' -exec cp -p --parents {} /tmp/targetdir ";"
find . -type f -name '*.txt' -exec cp -p --parents {} /tmp/targetdir ";" 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-23T14:10:38.183

类似于 Paulius 的解决方案，但您不关心的文件不会被复制然后删除：

```
@echo OFF

:: Replace c:\temp with the directory where folder1 resides.
cd c:\temp

:: You can make this more generic by passing in args for the source and destination folders.
for /f "usebackq" %%I in (`dir /b /s /a:-d folder1`) do @echo %%~nxI | find /V "data.zip" | find /v "info.txt" >> exclude_list.txt
xcopy folder1 copy_of_folder1 /EXCLUDE:exclude_list.txt /E /I 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-23T13:33:55.497

这只是两个简单的命令，但我不建议这样做，除非您不需要复制的文件很小。那是因为这将复制所有文件，然后删除副本中不需要的文件。

```
xcopy /E /I folder1 copy_of_folder1
for /F "tokens=1 delims=" %i in ('dir /B /S /A:-D copy_of_files ^| find /V "info.txt" ^| find /V "data.zip"') do del /Q "%i" 
```

当然，第二个命令有点长，但它有效！

此外，这种方法不需要您下载和安装任何第三方工具（Windows 2000+ BATCH 对此有足够的命令）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-04-18T14:56:00.317

在 Linux 和其他 UNIX 系统下，使用该`tar`命令可以轻松完成此操作。

```
$ tar cvf /tmp/full-structure.tar *data.zip *info.txt 
```

然后你会 cwd 到目标，然后：

```
$ tar xvf /tmp/full-structure.tar 
```

当然，您可以将第一个 tar 的输出通过管道传输到第二个，但是看到它逐步工作更容易理解和解释。我在以下命令中缺少必要的 cd /to/new/path/ - 我只是不记得现在该怎么做。其他人可以添加它，希望。

```
$ tar cvf -  *data.zip *info.txt |  tar xvf - 
```

Tar (gnutar) 也可在 Windows 上使用，但我可能会`xcopy`在该平台上自己使用该方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-23T12:32:03.250

```
XCOPY /S folder1\data.zip copy_of_folder1  
XCOPY /S folder1\info.txt copy_of_folder1 
```

**编辑：**如果您想保留空文件夹（在重读您的帖子时，您似乎会这样做）使用 /E 而不是 /S。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-02-14T13:57:56.380

对于那些使用[Altap Salamander](https://www.altap.cz/)（2 个面板文件管理器）的用户：在复制弹出窗口的选项中，只需指定文件名或掩码。简单的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-01-20T16:41:06.450

使用 WinRAR 命令行界面，您可以将文件名和/或文件类型复制到存档。然后，您可以将该存档提取到您喜欢的任何位置。这保留了原始文件结构。

我需要将丢失的专辑图片文件添加到我的手机中，而无需重新复制音乐本身。幸运的是，我的电脑和手机上的目录结构是一样的！

我用了：

```
 rar a -r C:\Downloads\music.rar X:\music\Folder.jpg 
```

*   C:\Downloads\music.rar = 要创建的存档
*   X:\music\ = 包含音乐文件的文件夹
*   Folder.jpg = 我要复制的文件名

这在正确的子目录中创建了一个包含所有 Folder.jpg 文件的存档。

此技术也可用于复制文件类型。如果文件都有不同的名称，您可以选择将所有文件提取到一个目录中。附加的命令行参数可以归档多种文件类型。

此非常有用的链接[http://cects.com/using-the-winrar-command-line-tools-in-windows/中的更多信息](http://cects.com/using-the-winrar-command-line-tools-in-windows/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-02-22T22:58:42.867

我对正则表达式很好，懒惰且不喜欢安装，所以我创建了一个批处理文件，该文件创建目录并使用 vanilla DOS 命令进行复制。对我来说似乎比使用 robocopy 更费力但更快。

1.  在文本文件中创建具有完整路径的源文件列表，包括驱动器号（如果 nec）。
2.  在文本编辑器中打开正则表达式。
3.  在每行有空格的情况下添加双引号 - 搜索字符串`(.*)`替换字符串`"\1"`，然后单击全部替换
4.  每个文件创建两行-一创建目录，一复制文件（qqq将替换为目标路径）-搜索字符串`(.*)`替换字符串`md qqq\1\nxcopy \1 qqq\1\n`并点击全部替换
5.  从目标路径中删除文件名 - 搜索`\\([^\\^"]+)"\n`替换`\\"\n`
6.  在目标路径中替换（在本例中为`A:\src`和`B:\dest`）。关闭正则表达式，搜索`qqq"A:\src\`替换`B:\dest\`并单击全部替换。

md 将创建嵌套目录。在本例中，copy 的行为可能与 xcopy 相同。您可能希望将 /Y 添加到 xcopy 以禁止覆盖确认。你最终得到一个像这样的批处理文件：

```
md "B:\dest\a\b\c\"
xcopy "C:\src\a\b\c\e.xyz" "B:\dest\a\b\c\e.xyz" 
```

对原始列表中的每个文件重复。在Win7上测试。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2011-09-10T11:10:41.040

要做到这一点拖放使用 winzip 有一个 dir 结构保留选项。只需在目录级别创建一个新的 .zip，这将是您的根目录并将文件拖入。

# visual-studio - VS 2008 Designer 不再执行默认构造函数了吗？

> ID：472694
> 
> 赞同：0
> 
> 时间：2009-01-23T12:21:35.470
> 
> 标签：visual-studio, visual-studio-2008, windows-forms-designer

我刚刚测试了 VS 2008 中的 WinForms 设计器执行了哪种类型的代码。似乎设计器不再执行默认构造函数了。我添加了这样一个简单的东西。Text = "foo"; 设计师没有任何改变。

我错过了 VS 2005/2008 之间的变化吗？（或 SP1）

蒂亚

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T13:15:18.013

您是否设置了断点以使其跳过？

如果它是项目中的第一个窗体，而不是从“运行”开始，您可以 F10（Step Over）从第一行代码开始。从那里您可以跟踪执行情况。

.NET 2.0 及更高版本对窗口和 Web 表单使用部分类。是否有可能被击中的构造函数不是默认的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:09:57.800

我在包括 System.Diagnostics.Debugger.Break() 在内的构造函数中放置了几条语句（设置背景、MessageBox.Show、File.WriteAllText，...），但没有任何响应...

不要误解我，这是我想要的行为，但我知道我在 VS 2005 中遇到了关于这个问题的问题，而且我没有找到任何关于 Winforms Designer 发生变化的信息。

使用 .NET 反射器，我看不到任何额外的构造函数，但也许设计者正在按需创建一个，...

# .net - 寻找从 URL 获取 XML 并显示在元素中的 WPF/XAML 示例

> ID：472695
> 
> 赞同：0
> 
> 时间：2009-01-23T12:21:50.073
> 
> 标签：.net, wpf, xaml, rest

我可以想象 WPF 有一种非常简单的方法可以从 RESTful 服务中获取 XML 并将其绑定到元素中，例如 GridView，甚至可能使用 100% XAML。

有没有人有任何示例代码显示这一点？

# c - 如何在 C 中获取目录的大小？

> ID：472697
> 
> 赞同：9
> 
> 时间：2009-01-23T12:23:21.660
> 
> 标签：c, size, posix, directory

是否有一个 POSIX 函数可以给我一个目录（包括所有子文件夹）的大小，大致相当于“ `du -s somepath`”？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-23T12:35:34.910

```
$ man nftw 
```

> **姓名**
> 
> `ftw`, `nftw`- 文件树遍历
> 
> **描述**
> 
> `ftw()`遍历位于目录 dirpath 下的目录树，并`fn()`为树中的每个条目调用一次。默认情况下，目录在它们包含的文件和子目录之前被处理（前序遍历）。
> 
> **符合**
> 
> POSIX.1-2001、SVr4、SUSv1。

## 简单的例子

```
#include <stdio.h>
#include <errno.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>

static unsigned int total = 0;

int sum(const char *fpath, const struct stat *sb, int typeflag) {
    total += sb->st_size;
    return 0;
}

int main(int argc, char **argv) {
    if (!argv[1] || access(argv[1], R_OK)) {
        return 1;
    }
    if (ftw(argv[1], &sum, 1)) {
        perror("ftw");
        return 2;
    }
    printf("%s: %u\n", argv[1], total);
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T12:26:19.330

没有现成的功能，所以你必须自己做。您可以查看 du 的 GNU 实现的源代码作为示例（请参阅[http://www.gnu.org/prep/ftp.html](http://www.gnu.org/prep/ftp.html)以获取下载位置列表）。它在`coreutils`包装中。

关键的 Posix 调用可能是`opendir`、`readdir`、`closedir`和`stat`。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2018-06-12T12:09:11.983

结果以字节为单位：

```
du -sb | grep -oE '^\s*[0-9]+' 
```

# google-app-engine - 谷歌应用引擎接下来最有可能使用哪种编程语言，为什么？

> ID：472698
> 
> 赞同：3
> 
> 时间：2009-01-23T12:23:27.760
> 
> 标签：google-app-engine

他们的路线图说他们的下一个版本将在 2009 年 3 月发布，并且他们将添加一种新的“运行时语言”。我希望它是 Java 或 PHP，但真的不确定，并且想知道哪种语言最有可能，因此我可以相应地计划我计划使用谷歌应用引擎托管的项目。

有任何想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-23T12:41:08.003

我会说 Java，如果仅仅是因为 Android（或者，至少是 SDK）是用 Java 编写的，而且他们费尽心思编写自己的解释器/VM。

如果不是 Java，那么 Ruby 将是我的猜测。不知道为什么，但感觉很合适。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-23T14:35:10.490

Google 内部用于生产代码的语言仅限于 C++、Java、Python 和 JavaScript。

Apps Engine 已经运行 Python，那么下一步是什么？

它很可能是 JavaScript。我记得[Steve Yegge](http://steve-yegge.blogspot.com/)正在为 JavaScript 开发 Rails 等价物。请参阅[Stevey 的博客 Rants：Rhino on Rails](http://steve-yegge.blogspot.com/2007/06/rhino-on-rails.html)。

Java 不太可能，但可能。Java servlet 容器往往是重量级的。

C++ 是可能的（[Native Client](http://code.google.com/p/nativeclient/)和[Chrome](http://www.google.com/chrome)是沙盒 C++ 代码的两个示例），但目前不太可能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-03T19:22:17.550

我会说你必须考虑几个因素：

语言需要：

*   可沙盒化
*   可控
*   可扩展
*   与蟒蛇不同
*   吸引想要编写大规模可扩展应用程序的人
*   可以轻松地在开发人员计算机上运行
*   在 Linux 上运行

## 可沙盒

该语言必须可以安全地在 Google 服务器上运行。language/VM/modules|libraries 的某些部分必须能够被禁用和/或替换。

## 可控

请注意 Google 如何使用不受公司控制的语言？Python 的 BDFL GvR 适用于 Google。不知道关于 Javascript。我想，Java 的开源足以满足他们的口味。所以语言的演变至少必须允许谷歌的输入。

## 可扩展

谷歌需要能够在语言中添加东西，这几乎意味着一种开源语言。我认为他们对现有语言的内部分支不感兴趣。

## 与 Python 不同

Python 成熟、易学且功能强大。新语言必须与 python 有显着差异，否则，为什么不直接使用 Python。也许是一种非常实用的语言？

## 呼吁大规模的可扩展性

执行时间不一定很关键，但该语言必须能够支持轻松启动和停止，轻松配置到其他服务器，并吸引那些编写大规模可扩展应用程序的人。

## 开发人员计算机

该语言需要能够在 Windows、Mac 和 Linux 上易于安装、维护和开发。它必须要么完全可以使用文本编辑器进行管理，要么已经拥有用于在这些平台上进行编辑和管理的可靠工具。

## Linux

谷歌服务器将运行这些程序，因此这些程序必须能够安全地传输到谷歌服务器上并在那里运行，并且必须能够由谷歌应用引擎负载均衡器控制，所以它们必须是统一的。

## 头脑风暴

我不认为它会是 Java（太重，难以修改 VM）、php（太泄漏）、ruby（难以修改 VM）、C++（不能被沙箱化（我知道））。我也不认为它会是 JavaScript，因为它很难模块化，而且它也不是一门容易学习的语言。这也排除了 Lisp——难学的部分。

所以别的东西。

但请记住，他们希望采用该工具，并且他们需要一种可以被很多人和很多企业采用的语言。

所以我倾向于使用单声道的 C#。我认为这是最有意义的。我知道这听起来很可怕，但最近该语言的开发人员正在考虑对 C# 进行相当多的更改，以合并类似 python 的动态类型，诸如此类。

## 结论

所以这就是我的想法。如果他们能做到这一点，他们将能够超越竞争对手。Mono 在 MIT X11 许可下（截至 2008 年 4 月），我猜 Miguel de Icaza 将来可以与关键团队成员一起被谷歌聘用。

所以我的预测是 C#。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T09:27:59.467

我也会说 Java，所以他们可以用 JRuby 支持 Ruby，用 Jython、Groovy 等兼容 Python。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T18:34:22.310

我的猜测是 C# 只是为了坚持微软。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T19:04:50.597

是的，JavaScript。

为什么？

首先，它适合。虽然 Python 和 JavaScript 之间存在明显的架构差异（尤其是 OOP 系统），但它们之间的距离比它们之间的距离更近，因此将 GAE Python API 转换为 A JS API 不应该是设计或实现上的巨大飞跃。最后，JS API 很可能与 Python API 具有相同的风格。

第二，安全。JS 运行时习惯用法与 Python 习惯用法相同，因为您将让 JS 进程有效地为每个请求彼此独立运行。也就是经典的 Apache 分叉模型。

作为托管服务，此模型非常健壮，并且比 Java 之类的模型更容易控制。您通过线程实现在效率上损失的东西，您只需成为拥有大量机器的 Google 即可获得。在 Google 的规模上，管理开销超过了一周中的每一天的性能。越简单、越健壮越好，这就是流程模型。

第三，技术速度。JS 现在进展得非常快。看看更多的商业企业编写 JS 解释器/编译器/运行时，以及语言本身的进步。JS脚本已经火速冲到了最前面。

最后，人气。

虽然在服务器端并不流行，但 JS 仍然可能是世界上部署最多的语言，因此也是世界上最容易访问的语言。这个星球上的每个 hack 网页设计师都在成为一名 JS 程序员，不管他们喜欢与否。

现在，我不知道您遇到了多少网页设计师，但我遇到的大多数人都不是程序员。因此，为他们采用 JS 对他们来说将是一种剪切粘贴和痛苦的经历，但这几乎是现代 Web 的要求。使用该技能以相同的语言在后端进行一些轻量级处理，这对这些人来说将是一个福音。不要低估在通常令人恐惧的环境中熟悉的力量（尽管取得了进步，但计算机对绝大多数人来说仍然是“可怕的”）。

JS，它不再是玩具了，它是一个沉睡的巨人。真的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T12:43:59.777

[JRuby on Rails](http://wiki.jruby.org/wiki/JRuby_on_Rails)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T18:21:57.140

已经使用 Python。有关于 PHP 的传言，考虑到它的受欢迎程度，这是合乎逻辑的选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T18:38:14.333

我也将在 Java 上投入 2 美分。他们有大量已经用 Java 编写的工具（GWT 有人吗？等等）

不过，Javascript 将是最有趣的。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-01-23T12:51:15.830

我曾经听说 Google 最喜欢 Python！

# c# - 使用 nUnit 测试死锁

> ID：472700
> 
> 赞同：6
> 
> 时间：2009-01-23T12:25:01.813
> 
> 标签：c#, unit-testing, nunit, deadlock

我是单元测试和 nUnit (2.48) 的新手。我想写一个测试方法，失败的情况是它死锁。这可能吗？显然，nUnit 默认情况下不知道该方法应该执行多长时间，所以我是否必须编写代码在单独的线程上完成工作，然后如果它花费的时间超过我定义的时间，则中止它并抛出异常？有一个更好的方法吗？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T12:38:11.567

当然可以通过在另一个线程上运行代码并查看它是否及时返回来测试死锁。这是一些（非常基本的）示例代码：

```
[TestFixture]
public class DeadlockTests
{
    [Test]
    public void TestForDeadlock()
    {
        Thread thread = new Thread(ThreadFunction);
        thread.Start();
        if (!thread.Join(5000))
        {
            Assert.Fail("Deadlock detected");
        }
    }

    private void ThreadFunction()
    {
        // do something that causes a deadlock here
        Thread.Sleep(10000);
    }
} 
```

我不想说这是“最好的方法”，但我发现它有时很有用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-23T12:39:44.607

这是可能的，但它可能不是最好的做法。单元测试并不真正适合测试并发行为，不幸的是没有很多适合的测试方法。

NUnit 不对线程做任何事情。您可以编写启动多个线程的测试，然后测试它们的交互。但是这些看起来更像是集成测试而不是单元测试。

另一个问题是死锁行为通常取决于线程调度的顺序。因此很难编写一个结论性的测试来测试某个死锁问题，因为您无法控制线程调度，这是由操作系统。您最终可能会遇到有时在多核处理器上失败但在单核处理器上总是成功的测试。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-23T12:47:42.657

死锁检测相当于[停机问题](http://en.wikipedia.org/wiki/Halting_problem)，因此目前一般情况下无法解决。

如果您有特定的问题需要防范，那么可能会有特定的黑客攻击来获得至少一点安全性。但请注意，这只能是一种黑客行为，而永远不会 100%。例如，这样的测试可能总是在开发机器上通过，但永远不会在生产机器上通过。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-23T12:43:31.043

看看名为“国际象棋”的微软项目。它旨在查找并发错误[http://research.microsoft.com/en-us/projects/chess/](http://research.microsoft.com/en-us/projects/chess/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-23T12:48:18.990

要测试死锁，您必须在单元测试中实现状态图并检查当前状态图中的循环。状态图由作为节点的资源和作为边的依赖关系组成。我不知道这样的事情的实现，但这就是理论。

单元测试测试数据输入和输出的正确性（主要用于后面一点），而不是测试应用程序执行流程的正确性。

Mark Heath 的想法看似合理，但在学术上是错误的。

# coding-style - 由于外部限制，您被迫编写的最丑陋的代码是什么？

> ID：472707
> 
> 赞同：3
> 
> 时间：2009-01-23T12:29:03.770
> 
> 标签：coding-style

你写的最难看的代码是什么——不是因为你不了解，而是因为软件、硬件或公司政策的限制？

由于数据库布局和编程语言的不寻常选择，我曾经构建了一个 C 程序，它读取 SQL 数据库结构并生成另一个 C 程序，该程序读取该数据库并将其备份到文件中，或者将其复制到第二个数据库中共享或多或少相同的列。这是一个怪物笨重的代码生成器。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-23T12:45:48.463

Any regular expression. :)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-23T12:52:26.827

In the late 90s I had to write several web sites in Informix Universal Server web blade (aka Illustra web blade)

For anyone who doesn't know anything about this execrable environment, it forced you to use the most bizarre language I have ever come across. As Joel Spolsky described it

> When it did run, it proved to have the only programming language I've ever seen that wasn't Turing-equivalent, if you can imagine that.

More on it here [http://philip.greenspun.com/wtr/illustra-tips.html](http://philip.greenspun.com/wtr/illustra-tips.html)

And an example of a 'simple' if condition:

```
cond=$(OR,$(NXST,$email),$(NXST,$name),$(NXST,$subject)) 
```

One example of it's dire nature was the fact that it **had no loops**. Of any kind. It was possible to hack looping functionality by creating a query and iterating through its rows, but that is so wrong it makes me feel sick.

edit: I've managed to find a complete code sample. Behold:

```
<HTML>
<HEAD><TITLE>WINSTART bug</TITLE></HEAD>
<BODY>
<!--- Initialization --->
<?MIVAR NAME=WINSIZE DEFAULT=4>$WINSIZE<?/MIVAR>
<?MIVAR NAME=BEGIN DEFAULT=1>$START<?/MIVAR>

<!--- Definition of Ranges ---->
<?MIVAR NAME=BEGIN>$(IF,$(<,$BEGIN,1),1,$BEGIN)<?/MIVAR>
<?MIVAR NAME=END>$(+,$BEGIN,$WINSIZE)<?/MIVAR>
<!--- Execution --->
<TABLE BORDER>
<?MISQL WINSTART=$BEGIN WINSIZE=$WINSIZE
    SQL="select tabname from systables where tabname like 'web%' 
        order by tabname;">
    <TR><TD>$1</TD></TR>
<?/MISQL>
</TABLE>
<BR>
<?MIBLOCK COND="$(>,$BEGIN,1)">
    <?MIVAR>
    <A HREF=$WEB_HOME?MIval=WINWALK&START=$(-,$BEGIN,$WINSIZE)&WINSIZE=$WINSIZE>
    Previous $WINSIZE Rows </A> $(IF,$(<,$MI_ROWCOUNT,$WINSIZE), No More Rows,  )
    <?/MIVAR>
<?/MIBLOCK>
<?MIBLOCK COND="$(AND,$(>,$END,$WINSIZE),$(>=,$MI_ROWCOUNT,$WINSIZE))">
    <?MIVAR>
    <A HREF=$WEB_HOME?MIval=WINWALK&START=$END&WINSIZE=$WINSIZE>
    Next $WINSIZE Rows  </A>
    <?/MIVAR>
<?/MIBLOCK>
</BODY> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T13:02:58.430

Once upon a time, I was working for a small programming house with a client who had a legacy COBOL application that they wanted converted to Visual Basic. I was never a fan of VB, but that's not an unreasonable thing to want.

Except that they wanted the interface to be preserved and to function identically to the existing version.

So we were forced to produce a VB app consisting of a single form with a grid of roughly 100 text entry boxes, all of which were completely passive. Except the one in the bottom right, which had a single event handler that was several thousand lines long and processed all the data in all the entry boxes when you exited the field.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T12:46:28.977

I have my pride and do not write extreme ugly code (although the definition of ugly changes with experience). My boss pays me to write code and he expects it to be good.

Sometimes you have to write hacks. But you always have to claim the right to fix these later on else you will be faced with the concequences later on.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T13:23:25.377

在两个应用程序之间交换信息的程序。不用说，这两个程序之间的数据格式不同，用例不同，甚至从一个应用程序到另一个应用程序的含义也不同。有大量的特殊情况和“不错”的转换：

```
if (InputString == "01")) 
         { Output.ClientID = Input.Address;}
else if ((InputString = "02") && (Input.Address == null) &&(Input.ClientID < 1300))
        { Output.ClientID = Input.ClientID +1;}
else if (Input.ClientID = 0 ) 
        { Input.ClientID = 2084; } 
```

继续，上百行。

这是在一家大型制造厂内部使用的……我在那里工作的大部分时间都在哭。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-05-18T17:41:05.923

我在一家保险管理公司工作。早在 2000 年代初期，我们就处理了在线保险申请，当时在线报价和申请还比较少见。

该系统最丑陋的部分是我们必须将信息发送回承保公司。虽然我们可以收集到很多精彩的数据，但我们不得不根据有人可以手动填写的物理表格将所有这些数据写入 PDF。然后，我们将获取一小部分数据，并将该数据与填写的申请一起传输给承销商。应用程序 PDF 将进入他们的文档成像系统，数据将被放置在他们古老的固定宽度数据库中。就承销商而言，大多数数据仅存在于该 PDF 中。

我们开玩笑说，承保人可能打印了 PDF 表格，以便将它们扫描到文档成像系统中。如果他们这样做，我不会感到惊讶。

# java - 如何在 log4j_config.xml 的 appender 标签中给出动态文件路径？

> ID：472715
> 
> 赞同：1
> 
> 时间：2009-01-23T12:30:52.720
> 
> 标签：java

嗨，我正在使用 log4j api 来记录信息。我使用 log4j_conffig.xml 文件来创建日志文件。我在 param 标记值中给出了每个日志文件的绝对路径。

例如：

```
appender name="GPREPROCESSOR_DEBUG" class="org.apache.log4j.DailyRollingFileAppender"><br>
        param name="DatePattern" value="'_'yyyyMMdd"/><br>
        param name="File" value="D:/logFiles/GPreprocessor_Debug.log"/><br>
        layout class="com.dnb.genericpreprocessor.common.log.AppXMLLayout"/><br>
/appender><br> 
```

我不想直接给出“D:/logFiles/”。实际上，该路径是动态的，基于我的项目位置。那我怎么给

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T18:39:40.700

Any Java System property may be used in a log4j config file. For example, your application at its startup could do something like:

```
String directory = "logfiles"; // relative to "."
try {
  path = new File(directory).getCanonicalPath();
} catch (IOException e) {
  // Cannot use log4j yet, so complain to system out
  System.out.println("Could not get canonical path for " + directory, e);
}

System.setProperty("log.home", path);

// Now that we've configured log.home, start logging
DOMConfigurator.configureAndWatch("log4j_config.xml");

```

and then in your log4j configuration file use this properly like:

```
<param name="File" value="${log.home}/GPreprocessor_Debug.log"/>

```

The only downside of this is that you must define the system property before you initialize log4j logging. Of course, you can also define these parameters on the Java command line via "-Dlog.home=D:/logFiles" if that is more convenient.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T12:55:21.517

You have use ${java.home} or ${user.home} to define a relative path for your file. See [log4help](http://www.vipan.com/htdocs/log4jhelp.html) for more complete examples.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T13:04:43.387

您可以通过从 RollingFileAppender 扩展并添加可以根据您的项目定义的“前缀”属性来创建自己的附加程序。log4j 使用的文件名是[http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/FileAppender.html#setFile(java.lang.String)](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/FileAppender.html#setFile(java.lang.String))，所以在你的 appender 类中应该很容易使用它并设置文件的名称。

另一种选择是使用一些已定义并可用于 log4j.xml 的属性（任何 java 系统属性都可以）并将文件名引用为 ${my.project.location}/logs/Preprocessor_Debug.log

# asp.net - 任何 SQL Server 多记录集存储过程的陷阱？

> ID：472716
> 
> 赞同：7
> 
> 时间：2009-01-23T12:31:03.173
> 
> 标签：asp.net, sql-server, sql-server-2005, performance, ado.net

## 语境

我当前的项目是一个大型的公共站点（每天 200 万次浏览量）站点，它混合了 asp classic 和 asp.net 以及 SQL Server 2005 后端。我们重读，偶尔写，几乎没有更新/删除。我们的页面通常涉及单个“主”对象和一堆相关（详细）对象。

我喜欢在单个过程中返回页面所需的所有数据的想法（绝对没有不必要的数据）。诚然，这需要此类页面的专用 proc，但有些页面在我们的整体网站流量中占两位数百分比，因此值得花时间/维护。我们通常只使用 System.Data.SqlClient.SqlDataReader 及其 NextResult 方法从我们的 .net 代码中使用多个记录集。哦，是的，我也没有在这些过程中进行任何更新/插入（表变量除外）。

## 问题

到目前为止，返回多个记录集的 SQL Server (2005) proc 对我们来说运行良好（在 prod 中），但我有点担心多记录集 proc 是我最喜欢的新锤子，我正在用它来解决每个问题（钉子）。有没有我应该知道的多记录集 sql server proc 陷阱？有什么东西会让我希望我没有使用它们吗？特别是关于它影响连接池、内存利用率等的任何事情。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T15:24:17.443

以下是多记录集存储过程的一些陷阱：

**它们使重用代码变得更加困难。** 如果您正在执行多个查询，那么您很可能能够在另一个页面上重用其中一个查询。

**它们使单元测试变得更加困难。** 每次对其中一个查询进行更改时，都必须测试所有结果。如果发生了变化，您必须深入了解哪个查询未通过单元测试。

**它们使以后调整性能变得更加困难。** 如果另一个 DBA 在你身后帮助你提高性能，他们必须做更多的切片和切块来找出问题的根源。然后，将其与代码重用问题结合起来——如果他们优化了一个查询，那么该查询可能会在几个不同的存储过程中使用，然后他们必须修复所有这些——这使得再次进行更多的单元测试。

**它们使错误处理变得更加困难。** 存储过程中的四个查询可能会成功，而第五个会失败。你必须为此做好计划。

**它们会增加锁定问题并在 TempDB 中产生负载。** 如果您的存储过程的设计方式需要可重复读取，那么您在存储过程中填充的查询越多，运行所需的时间就越长，将这些结果返回到您的应用服务器所需的时间也就越长. 增加的时间意味着更多的锁争用，并且 SQL Server 必须在 TempDB 中存储更多以进行行版本控制。您提到您的阅读量很大，因此这个特定问题对您来说应该不会太糟糕，但您希望在将这个锤子重用于写入密集型应用程序之前了解它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-23T12:41:06.680

我认为多记录集存储过程在某些情况下很棒，听起来你的可能就是其中之一。

您的网站获得的流量越大（流量越多），“额外”的性能就越重要。如果您可以将 2-3-4 次调用（可能还有一个新连接）与数据库合二为一，那么您每天可以将数据库点击次数减少 4-6-8 百万，这是相当可观的。

我很少使用它们，但是当我使用它们时，我从来没有遇到过问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T13:00:46.670

我建议在一个存储过程中调用多个存储过程的内部调用，每个内部调用返回 1 个结果集。

```
create proc foo 
as
execute foobar --returns one result

execute barfoo --returns one result

execute bar  --returns one result 
```

这样，当需求发生变化并且您只需要第 3 和第 5 个结果集时，您可以轻松地调用它们，而无需添加新的存储过程并重新生成数据访问层。如果我想要它们，我当前的应用程序会返回所有参考表（例如美国各州表）。最糟糕的是，当您需要获取参考表并且唯一的访问是通过存储过程时，该存储过程也将昂贵的查询作为其六个结果集之一运行。

# html - Customizing the scroll bar

> ID：472717
> 
> 赞同：1
> 
> 时间：2009-01-23T12:31:14.653
> 
> 标签：html, scrollbar, styling

Can we change the appearance of scroll bar? I mean we want to change the image of the scroll bar, so it can match our web theme. more specifically, i'm pointing at the scroll bar in

```
<div style=overflow:auto> 
```

If it can't be done, then is there some other way to make our own "scroll bar", which use our own image?

Perhaps if we're insane enough, maybe we'll do it like this. We make a bunch of `<div>` which contain an image of up arrow, scroll, down arrow, etc. And then we applied some function to each of them. off course the width of scroll will depend on the amount of the content.

Can somebody help?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T16:47:58.600

看看[这个网站](http://www.hesido.com/web.php?page=customscrollbar)- 我听说过关于实现方法的好消息，虽然我从来没有真正费心创建我自己的自定义滚动条。

通过一些实验，您应该能够根据自己的主题设计样式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-03-14T11:16:47.957

jQuery 插件中有很多可用的自定义滚动条，这里有一些 [http://designhuntr.com/custom-jquery-scrollers/](http://designhuntr.com/custom-jquery-scrollers/)

我建议[http://baijs.com/tinyscrollbar/](http://baijs.com/tinyscrollbar/)

# visual-studio-2008 - MSBuild 2008 stops on first error while building a solution

> ID：472722
> 
> 赞同：1
> 
> 时间：2009-01-23T12:33:26.430
> 
> 标签：visual-studio-2008, msbuild, build-process, solution, build-error

We recently upgraded from MSBuild 2005 to 2008\. Since then MSBuild stops on the first error when building a solution. This wasn't the case in 2005. Is there a way to get the old behavior?

**EDIT**: We call MSBuild form the command line:

```
MSBuild.exe xyz.sln /p:Platform=Win32 /p:Configuration=Debug 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T12:50:02.107

```
<MSBuild Projects="@(Solution)" ContinueOnError="false" StopOnFirstFailure="true"></MSBuild> 
```

You have to change this on the script

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T10:12:50.087

我有一种有点复杂但有效的解决方案：

当使用解决方案文件调用 MSBuild 时，它会在内部从该解决方案生成一个项目文件并构建该项目文件。当将环境变量 msbuildemitsolution 设置为 1 时，它会将该项目文件输出到命名为解决方案文件但后跟 .proj 的硬盘上。此外，它总是会生成一个 .cache 文件，以防止它一直重新生成项目文件。所以我首先要做的是：

```
IF EXIST xyz.sln.proj DEL xyz.sln.proj
IF EXIST xyz.sln.cache DEL xyz.sln.cache
SET msbuildemitsolution=1
MSBuild.exe xyz-sln /t:_xxxxx_ /noconsolelogger 
```

目标*xxxx*不应该存在的地方。MSBuild 然后生成一个 xyz.sln.proj 并由于缺少目标而输出许多错误。我忽略了这些错误，因为我想要的是项目文件。实际上，我在 C# 程序中执行上述操作，但为了更容易理解，我在这里选择了 BAT 语法。

xyz.sln.proj 包含许多目标：“Build”、“Clean”、“Rebuild”和“Publish”以及“”、“:Clean”、“:Rebuild”、“:Publish”、“”...我感兴趣的只是目标“构建”、“重建”和“清洁”。这些目标由几个构建 csproj 文件集的 MSBuild 任务组成。这些集合称为 BuildLevelX（其中 X 是一个数字）。对于 C++ 项目，Build/Rebuild/Clean 目标包含直接调用任务的 CallTarget 任务。我的文件中的一个片段：

```
<Target Name="Build" Condition="'$(CurrentSolutionConfigurationContents)' != ''" Outputs="@(CollectedBuildOutput)">
  <MSBuild Condition="@(BuildLevel0) != ''" Projects="@(BuildLevel0)" Properties="Configuration=%(Configuration); Platform=%(Platform); BuildingSolutionFile=true; CurrentSolutionConfigurationContents=$(CurrentSolutionConfigurationContents); SolutionDir=$(SolutionDir); SolutionExt=$(SolutionExt); SolutionFileName=$(SolutionFileName); SolutionName=$(SolutionName); SolutionPath=$(SolutionPath)" ToolsVersion="$(ProjectToolsVersion)" BuildInParallel="true" UnloadProjectsOnCompletion="$(UnloadProjectsOnCompletion)" UseResultsCache="$(UseResultsCache)" ContinueOnError="true">
    <Output TaskParameter="TargetOutputs" ItemName="CollectedBuildOutput" />
  </MSBuild>
  <Message Text="The project &quot;%(SkipLevel0.Identity)&quot; is not selected for building in solution configuration &quot;$(Configuration)|$(Platform)&quot;." Condition="@(SkipLevel0) != ''" />
  <Warning Text="The project configuration for project &quot;%(MissingConfigLevel0.Identity)&quot; was not specified in the solution file for the solution configuration &quot;$(Configuration)|$(Platform)&quot;." Code="MSB4121" HelpKeyword="MSBuild.SolutionProjectConfigurationMissing" Condition="@(MissingConfigLevel0) != ''" />
  <MSBuild Condition="@(BuildLevel1) != ''" Projects="@(BuildLevel1)" Properties="Configuration=%(Configuration); Platform=%(Platform); BuildingSolutionFile=true; CurrentSolutionConfigurationContents=$(CurrentSolutionConfigurationContents); SolutionDir=$(SolutionDir); SolutionExt=$(SolutionExt); SolutionFileName=$(SolutionFileName); SolutionName=$(SolutionName); SolutionPath=$(SolutionPath)" ToolsVersion="$(ProjectToolsVersion)" BuildInParallel="true" UnloadProjectsOnCompletion="$(UnloadProjectsOnCompletion)" UseResultsCache="$(UseResultsCache)" ContinueOnError="true">
    <Output TaskParameter="TargetOutputs" ItemName="CollectedBuildOutput" />
  </MSBuild>
  <Message Text="The project &quot;%(SkipLevel1.Identity)&quot; is not selected for building in solution configuration &quot;$(Configuration)|$(Platform)&quot;." Condition="@(SkipLevel1) != ''" />
  <Warning Text="The project configuration for project &quot;%(MissingConfigLevel1.Identity)&quot; was not specified in the solution file for the solution configuration &quot;$(Configuration)|$(Platform)&quot;." Code="MSB4121" HelpKeyword="MSBuild.SolutionProjectConfigurationMissing" Condition="@(MissingConfigLevel1) != ''" />
  <CallTarget Targets="SomeLib" RunEachTargetSeparately="true" ContinueOnError="true" />
  <MSBuild Condition="@(BuildLevel2) != ''" Projects="@(BuildLevel2)" Properties="Configuration=%(Configuration); Platform=%(Platform); BuildingSolutionFile=true; CurrentSolutionConfigurationContents=$(CurrentSolutionConfigurationContents); SolutionDir=$(SolutionDir); SolutionExt=$(SolutionExt); SolutionFileName=$(SolutionFileName); SolutionName=$(SolutionName); SolutionPath=$(SolutionPath)" ToolsVersion="$(ProjectToolsVersion)" BuildInParallel="true" UnloadProjectsOnCompletion="$(UnloadProjectsOnCompletion)" UseResultsCache="$(UseResultsCache)" ContinueOnError="true">
    <Output TaskParameter="TargetOutputs" ItemName="CollectedBuildOutput" />
  </MSBuild>
  <Message Text="The project &quot;%(SkipLevel2.Identity)&quot; is not selected for building in solution configuration &quot;$(Configuration)|$(Platform)&quot;." Condition="@(SkipLevel2) != ''" />
  <Warning Text="The project configuration for project &quot;%(MissingConfigLevel2.Identity)&quot; was not specified in the solution file for the solution configuration &quot;$(Configuration)|$(Platform)&quot;." Code="MSB4121" HelpKeyword="MSBuild.SolutionProjectConfigurationMissing" Condition="@(MissingConfigLevel2) != ''" />
  <CallTarget Targets="SomeProgram" RunEachTargetSeparately="true" ContinueOnError="true" />
  <MSBuild Condition="@(BuildLevel3) != ''" Projects="@(BuildLevel3)" Properties="Configuration=%(Configuration); Platform=%(Platform); BuildingSolutionFile=true; CurrentSolutionConfigurationContents=$(CurrentSolutionConfigurationContents); SolutionDir=$(SolutionDir); SolutionExt=$(SolutionExt); SolutionFileName=$(SolutionFileName); SolutionName=$(SolutionName); SolutionPath=$(SolutionPath)" ToolsVersion="$(ProjectToolsVersion)" BuildInParallel="true" UnloadProjectsOnCompletion="$(UnloadProjectsOnCompletion)" UseResultsCache="$(UseResultsCache)" ContinueOnError="true">
    <Output TaskParameter="TargetOutputs" ItemName="CollectedBuildOutput" />
  </MSBuild>
  <Message Text="The project &quot;%(SkipLevel3.Identity)&quot; is not selected for building in solution configuration &quot;$(Configuration)|$(Platform)&quot;." Condition="@(SkipLevel3) != ''" />
  <Warning Text="The project configuration for project &quot;%(MissingConfigLevel3.Identity)&quot; was not specified in the solution file for the solution configuration &quot;$(Configuration)|$(Platform)&quot;." Code="MSB4121" HelpKeyword="MSBuild.SolutionProjectConfigurationMissing" Condition="@(MissingConfigLevel3) != ''" />
  <MSBuild Condition="@(BuildLevel4) != ''" Projects="@(BuildLevel4)" Properties="Configuration=%(Configuration); Platform=%(Platform); BuildingSolutionFile=true; CurrentSolutionConfigurationContents=$(CurrentSolutionConfigurationContents); SolutionDir=$(SolutionDir); SolutionExt=$(SolutionExt); SolutionFileName=$(SolutionFileName); SolutionName=$(SolutionName); SolutionPath=$(SolutionPath)" ToolsVersion="$(ProjectToolsVersion)" BuildInParallel="true" UnloadProjectsOnCompletion="$(UnloadProjectsOnCompletion)" UseResultsCache="$(UseResultsCache)" ContinueOnError="true">
    <Output TaskParameter="TargetOutputs" ItemName="CollectedBuildOutput" />
  </MSBuild>
  <Message Text="The project &quot;%(SkipLevel4.Identity)&quot; is not selected for building in solution configuration &quot;$(Configuration)|$(Platform)&quot;." Condition="@(SkipLevel4) != ''" />
  <Warning Text="The project configuration for project &quot;%(MissingConfigLevel4.Identity)&quot; was not specified in the solution file for the solution configuration &quot;$(Configuration)|$(Platform)&quot;." Code="MSB4121" HelpKeyword="MSBuild.SolutionProjectConfigurationMissing" Condition="@(MissingConfigLevel4) != ''" />
</Target> 
```

我加载 proj 文件并将 ContinueOnError="true" 添加到 Build/Rebuild/Clean 目标中的所有 MSBuild 和 CallTarget 任务中：

```
XmlDocument msBuildProject = new XmlDocument();
msBuildProject.Load(Tools.getFullPath(m_strBaseDir, strSolutionProjFile));
foreach (XmlNode nodeL0 in msBuildProject.ChildNodes)
{
  XmlElement elementL0 = nodeL0 as XmlElement;
  if ((elementL0 != null) && (String.CompareOrdinal(nodeL0.Name, "Project") == 0))
  {
    foreach (XmlNode nodeL1 in elementL0.ChildNodes)
    {
      XmlElement elementL1 = nodeL1 as XmlElement;
      if ((elementL1 != null) && (String.CompareOrdinal(nodeL1.Name, "Target") == 0))
      {
        if ((String.CompareOrdinal(elementL1.Attributes["Name"].Value, "Build") == 0) ||
            (String.CompareOrdinal(elementL1.Attributes["Name"].Value, "Rebuild") == 0) ||
            (String.CompareOrdinal(elementL1.Attributes["Name"].Value, "Clean") == 0) ||
            (String.CompareOrdinal(elementL1.Attributes["Name"].Value, "Publish") == 0))
        {
          foreach (XmlNode nodeL2 in elementL1.ChildNodes)
          {
            XmlElement elementL2 = nodeL2 as XmlElement;
            if ((elementL2 != null) &&
                ((String.CompareOrdinal(nodeL2.Name, "MSBuild") == 0) ||
                 (String.CompareOrdinal(nodeL2.Name, "CallTarget") == 0)))
            {
              elementL2.SetAttribute("ContinueOnError", "true");
            }
          }
        }
      }
    }
  }
}
msBuildProject.Save(Tools.getFullPath(m_strBaseDir, strSolutionProjFile)); 
```

之后，我使用配置调用 MSBuild。

这很好用，但因为它不是很容易我永远不会将此标记为我的问题的答案:-)

# sql-server - SSRS 安全性

> ID：472724
> 
> 赞同：0
> 
> 时间：2009-01-23T12:34:55.130
> 
> 标签：sql-server, security

场景：我有一个 Web 应用程序，它将使用位于我的 DatabaseServer 上的 ReportingServer 上的 SqlServerReport(SSRS)。

webapplication 和 SqlserverReport 服务器之间有防火墙。

现在直接从网络服务器使用报告是多么安全（即访问数据库服务器上的某些东西）。我们使用应用服务器与数据库数据进行交互。所有基本调用都是

UI ==> AppServer ==> DatabaseServer（一般情况）:) 快乐
UI ==> DatabaseServerReports（访问 Sqlserver 报告）:(

所以我关心的是直接从数据库服务器访问报告有多安全。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2017-09-22T02:37:55.777

您需要在防火墙中打开端口 80(http)/443(https) 才能使用 AppServer 中的 SSRS 服务器。

请联系您的网络管理员。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T18:52:07.397

为什么不使用您的应用程序来显示报告？使用 ASP.NET，您可以使用报表查看器控件来显示报表，因此用户不知道报表来自何处，除非它在应用程序中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T19:00:19.957

安全程度取决于用户所在的位置。例如，SQL Server Reporting Services 并不打算向 Internet 开放。就此而言，SQL Server 数据库引擎也不是。您说 Web 服务器和 SQL Server 之间有防火墙，但这在当今内部网络中并不罕见。

可能出现的问题是性能方面的问题，比其他任何问题都多。通过使用 SSRS 查看报表，报表呈现将与您的数据库引擎在同一台服务器上进行。如果硬件不足以胜任这两个角色，您将看到性能问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T21:07:26.983

我们的安全人员让我们在单独的分区上安装 IIS。

# web-applications - 在生产环境中监控 Apache Tomcat 应用程序

> ID：472725
> 
> 赞同：0
> 
> 时间：2009-01-23T12:35:10.560
> 
> 标签：web-applications, tomcat, monitoring

您如何确保生产中的应用程序正常运行？如果出现问题，您如何提醒您的开发团队？

我问这个是因为我正在编写一个 bash 脚本来检查这个问题，我想知道是否有更聪明或更完整的方法来实现这一点。背后的想法是这个命令：`wget -q -O - APPLICATION_URL_HERE | grep 'ERROR 404`，我仍然要检查各种 HTTP 错误，但你可以明白我的意思。如果识别出应用程序未运行，则将邮件发送到其所属团队的列表。

我所有的应用程序都在 Apache Tomcat 上运行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T12:37:48.230

Tomcat 通常可以通过 JMX 进行监控；[从这个文档](http://tomcat.apache.org/tomcat-5.5-doc/monitoring.html)可以看出。这通常是最干净的监控方式，因为这可以集成到许多第三方监控工具中，这些工具可以支持各种通知和铃声。

如果您的网站已启动并且对客户可见，这可能仍然无法为您提供完整的“外部视图”图片，因为还有许多其他事情可能会出错。相当多的管理系统还允许您安装执行此操作的代理并集成到整个监控方案中。有许多[开源 jmx 工具](http://java-source.net/open-source/jmx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T13:51:23.823

[你可以尝试Lambda Probe](http://www.lambdaprobe.org)的社区分支，[Psi Probe](http://code.google.com/p/psi-probe/)

以下是摘自他们主页的简短摘要：

"... 实时监控和管理 Apache Tomcat 实例的终极工具。Lambda Probe 将通过易于使用和友好的 Web 界面帮助您可视化有关 Apache Tomcat 实例的实时信息。有关更多信息，请访问概述部分。 "

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T12:50:46.910

这取决于您对您想要做的事情的详细程度。有许多公司提供的产品和服务将监控 Web 应用程序以确保它们完全运行，如果没有，请解释错误在哪里以及它在做什么。我认为 Empirix 在他们的 web 测试套件中有一个，但我已经有一段时间没有使用它了，所以他们可能已经删除了它。还有很多其他的。我所看到的这样做是真正的自动化测试，它们通过站点并报告发现的任何错误。

如果你真的很认真（比如想花钱确保你的网站正常运行），我会在 Gartner 上搜索网站可用性。我几乎肯定他们将围绕这个主题建立一个魔力象限，它会给你一个很好的起点。

我想说你在做的事情还不错，你只是在重新发明轮子，可能不会像专注于它的公司那样彻底。话虽这么说，你的绝对是更便宜的选择，它可以满足你的需要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T12:59:03.337

我们正在运行几个后台应用程序和服务。它们都包含一个由 TCP/IP 连接触发的小类，用于将状态信息发送到在 ASP 页面上打印出信息的 Web 服务。该页面每 5 分钟由元标记刷新一次。

我只需要在浏览器中打开页面并不时检查是否有任何组件处于脱机状态（很容易发现，因为它们变红了）。

整个系统非常轻巧，易于包含在任何项目中。它是我的一位同事写的，效果很好。如果连接丢失超过 x 分钟，我们还可以增强它以向我们发送电子邮件，但到目前为止还没有必要这样做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T22:55:34.290

Nagios、Zabbix、OpenNMS……有无数的监控工具专为这类工作而构建。

# sql-server - 如何使用 SQL Server 对范围值进行分组

> ID：472732
> 
> 赞同：1
> 
> 时间：2009-01-23T12:38:27.183
> 
> 标签：sql-server, tsql, common-table-expression, gaps-and-islands

我有一个像这样的值表

```
978412, 400
978813, 20
978834, 50
981001, 20 
```

如您所见，第二个数字添加到第一个数字是序列中下一个数字之前的 1 个数字。最后一个数字不在范围内（不遵循直接顺序，如在下一个值中）。我需要的是一个 CTE（是的，理想情况下），它将输出这个

```
978412, 472
981001, 20 
```

第一行包含范围的起始编号，然后是其中节点的总和。下一行是下一个范围，在此示例中与原始数据相同。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T14:58:43.813

从 Josh 发布的文章中，这是我的看法（经过测试和工作）：

```
SELECT
    MAX(t1.gapID) as gapID,
    t2.gapID-MAX(t1.gapID)+t2.gapSize as gapSize
    -- max(t1) is the specific lower bound of t2 because of the group by.
FROM
  ( -- t1 is the lower boundary of an island.
    SELECT gapID
    FROM gaps tbl1 
    WHERE
      NOT EXISTS(
        SELECT *
        FROM gaps tbl2 
        WHERE tbl1.gapID = tbl2.gapID + tbl2.gapSize + 1
      )
  ) t1
  INNER JOIN ( -- t2 is the upper boundary of an island.
    SELECT gapID, gapSize
    FROM gaps tbl1 
    WHERE
      NOT EXISTS(
        SELECT * FROM gaps tbl2 
        WHERE tbl2.gapID = tbl1.gapID + tbl1.gapSize + 1
      )
  ) t2 ON t1.gapID <= t2.gapID -- For all t1, we get all bigger t2 and opposite.
GROUP BY t2.gapID, t2.gapSize 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T13:50:18.863

查看这篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/aa175780(SQL.80).aspx)。它为您的问题提供了一个解决方案，它是否适合您取决于您​​拥有的数据量和您对查询的性能要求。

# 编辑：

很好地使用查询中的示例，并使用他的最后一个解决方案获取岛屿的第二种方法（第一种方法导致 SQL 2005 出现错误）。

```
SELECT MIN(start) AS  startGroup, endGroup, (endgroup-min(start) +1) as NumNodes
FROM (SELECT g1.gapID AS start,
(SELECT min(g2.gapID) FROM #gaps g2 
WHERE g2.gapID >= g1.gapID and NOT EXISTS
(SELECT * FROM #gaps g3 
WHERE g3.gapID - g2.gapID = 1)) as endGroup
FROM #gaps g1) T1 GROUP BY endGroup 
```

我添加的是`(endgroup-min(start) +1) as NumNodes`. 这会给你计数。

# ruby-on-rails - 你将如何整理这个控制器逻辑？

> ID：472733
> 
> 赞同：2
> 
> 时间：2009-01-23T12:39:29.740
> 
> 标签：ruby-on-rails, ruby, refactoring, controller

如果满足某些条件，我在控制器中有一些逻辑可以设置对象的状态：

```
if params[:concept][:consulted_legal] == 0 && params[:concept][:consulted_marketing] == 1
  @concept.attributes = {:status => 'Awaiting Compliance Approval'}
elsif params[:concept][:consulted_marketing] == 0 && params[:concept][:consulted_legal] == 1 
  @concept.attributes = {:status => 'Awaiting Marketing Approval'}
elsif params[:concept][:consulted_marketing] == 0 && params[:concept][:consulted_legal] == 0
  @concept.attributes = {:status => 'Awaiting Marketing & Legal Approval'}
else
  @concept.attributes = {:status => 'Pending Approval'}
end 
```

我在创建和更新操作之间共享。你将如何重构这种肮脏的东西？寻找最佳实践。

编程新手，热衷于清理我的代码。

TIA。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T12:54:49.897

您可以减少代码对这两种条件的依赖，并使其更加灵活。

```
waiting_on = []
waiting_on << 'Compliance' unless params[:concept][:consulted_marketing]
waiting_on << 'Legal' unless params[:concept][:consulted_legal]
status = waiting_on.empty? ? "Awaiting #{waiting_on.join(' & ')} Approval" : 'Pending Approval'
@concept.attributes = {:status => status} 
```

不带过滤器的创建和更新版本：

```
def create
  set_concept_status_attribute
  ...
end

def update
  set_concept_status_attribute
  ...
end

private
  def set_concept_status_attribute
    waiting_on = []
    waiting_on << 'Compliance' unless params[:concept][:consulted_marketing]
    waiting_on << 'Legal' unless params[:concept][:consulted_legal]
    status = waiting_on.empty? ? "Awaiting #{waiting_on.join(' & ')} Approval" : 'Pending Approval'
    @concept.attributes = {:status => status}
  end 
```

或使用 before_filter：

```
before_filter :set_concept_status_attribute, :only => [:create, :update]

def create
  ...
end

def update
  ...
end 
```

如果您可以将其移动到您的视图中，它看起来会更好：

```
module ConceptHelper
  def get_concept_status
    ...
  end
end

<%= get_concept_status %> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T12:48:46.943

这是我的看法。我称之为超级干燥。

```
statuses = 
  [
    ['Awaiting Marketing & Legal Approval','Awaiting Compliance Approval'],
    ['Awaiting Marketing Approval','Pending Approval']
  ]

{:status => statuses[params[:concept][:consulted_legal].to_i][params[:concept][:consulted_marketing].to_i]} 
```

或者，一种更传统的方法——冗长但可读：

```
status = if params[:concept][:consulted_legal] == "0"
  if params[:concept][:consulted_marketing] == "1"
    'Awaiting Compliance Approval'
  else
    'Awaiting Marketing & Legal Approval'
  end
else
  if params[:concept][:consulted_marketing] == "0"
    'Awaiting Marketing Approval'
  else
    'Pending Approval'
  end
end

@concept.attributes = {:status => status} 
```

**注意**：看起来您的原始代码正在检查复选框的值。`params`哈希中的值**总是** `Strings`s ，而不是`Fixnum`s 所以我的代码比较字符串。如果出于某种原因比较`Fixnum`s 是您的情况所需要的，只需去掉数字周围的引号。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T13:50:13.873

这看起来是业务逻辑，所以它真的应该在模型中。

您的模型可能需要几个属性：consulted_legal 和consulted_marketing，以及在其中任何一个发生更改时设置状态的方法，如下所示：

```
before_update :set_status

def set_status
  if consulted_legal && consulted_marketing
    status = "Pending Approval"
  elif consulted_legal && !consulted_marketing
    status = "Awaiting Marketing Approval"
  elif !consulted_legal && consulted_marketing
    status = "Awaiting Legal Approval"
  elif !consulted_legal && !consulted_marketing
    status "Awaiting Marketing & Legal Approval"
  end

  true # Needs to return true for the update to go through
end 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T12:49:06.007

将其分解为嵌套的 if 语句。

```
if params[:concept][:consulted_legal] == '0'
  if params[:concept][:consulted_marketing] == '1'
    @concept.attributes = { :status => 'Awaiting Compliance Approval' } 
  else
    @concept.attributes = { :status => 'Awaiting Marketing & Legal Approval' }
  end
else
  if params[:consulted_marketing] == '1'
    @concept.attributes = { :status => 'Awaiting Marketing Approval' }
  else
    @concept.attributes = { :status => "Pending Approval" }
  end
end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T16:45:37.667

您可能认为咨询的部门列表是一个足够固定的概念，可以证明名为 Consulted_marketing 等变量的合理性。但是对于增长和干燥（在某种程度上），我更喜欢部门列表。

您在这里真正拥有的是工作流或状态机，我认为带有转换的部门列表将产生最干净、最可增长的代码。

代码*就是*数据！为您的数据建模，代码将很简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T12:51:34.567

对我来说，这看起来像是一条商业规则。因此，您可能希望将其包装成一个函数：

```
string GetConceptStatus(bool consulted_legal, bool consulted_marketing)
{ 
    if (consulted_legal && consulted_marketing) {
        return "Pending Approval";
    }
    if (consulted_legal && !consulted_marketing) {
        return "Awaiting Marketing Approval";
    }
    if (!consulted_legal && consulted_marketing) {
        return "Awaiting Legal Approval";
    }
    if (!consulted_legal && !consulted_marketing) {
        return "Awaiting Marketing & Legal Approval";
    }
} 
```

`bool`这也将s 如何在接口中编码的细节与业务规则的实际实现分开。

但是代码的实际结构对我来说看起来不错，因为它可能更好地模拟了业务规则。

# java - Problem with JAAS and DatabaseServerLoginModule

> ID：472739
> 
> 赞同：1
> 
> 时间：2009-01-23T12:42:10.420
> 
> 标签：java, jboss, jaas

I have a problem with jaas and jboss. I try to authenticate users against a database using form based method but jboss tells me the password are wrong (no, the password is correct), but if i use UsersRolesLoginModule with properties files, no problem.

In the pg database in debug mode the query that JBoss does seems ok, The password in database for now are in plain text (without hash)

Here is my login-config.xml file

```
<application-policy name = "AP">
       <authentication>
          <login-module code = "org.jboss.security.auth.spi.DatabaseServerLoginModule" flag = "required">
             <module-option name = "dsJndiName">java:/authDS</module-option>
             <module-option name = "principalsQuery">SELECT password FROM users WHERE login = ?</module-option>
             <module-option name = "rolesQuery">SELECT roles.name AS roles FROM roles WHERE roles.id IN 
                        (SELECT users_roles.roleid FROM users_roles WHERE users_roles.userid IN 
                        (SELECT users.id FROM users WHERE login = ?))</module-option>
             <!-- <module-option name="hashAlgorithm">MD5</module-option> -->
             <!-- <module-option name="hashEncoding">base64</module-option> -->
             <!-- <module-option name="hashEncoding">HEX</module-option> -->
             <!-- <module-option name="hashAlgorithm">SHA-1</module-option> -->
             <!-- <module-option name="digestCallback">com.myclass.MyDigestCallback</module-option>-->
          </login-module>
       </authentication>
    </application-policy> 
```

web.xml file:

```
<security-constraint>
     <web-resource-collection>
       <web-resource-name>Restrict Access</web-resource-name>
       <description></description>
       <url-pattern>/admin/*</url-pattern>
       <http-method>GET</http-method>
       <http-method>POST</http-method>
     </web-resource-collection>
     <auth-constraint>
       <role-name>AdminRole</role-name>
     </auth-constraint>
   </security-constraint>

  <login-config>
    <auth-method>FORM</auth-method>
    <realm-name>ASM AD Authentication</realm-name>
    <form-login-config>
    <form-login-page>/login.jsp</form-login-page>
    <form-error-page>/login.jsp</form-error-page>
       </form-login-config>
    </login-config>

    <security-role>
      <role-name>AdminRole</role-name>
   </security-role> 
```

jboss-web.xml

```
<jboss-web>
      <security-domain>java:/jaas/Admin</security-domain>
</jboss-web> 
```

login.jsp

```
<form method="post" action="j_security_check">
    <fieldset>
        <legend>Login</legend>
        <p>
            <label for="form-username">Username</label>
            <input type="text" name="j_username" id="form-username" />
        </p>
        <p>
            <label for="form-password">Password</label>
            <input type="password" name="j_password" id="form-password" />
        </p>
        <p>
            <input type="submit" value="GO" />
        </p>
    </fieldset>
</form> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-11-14T20:25:31.780

你能做这样的事情吗？

```
 <application-policy name = "AP">
       <authentication>
          <login-module code = "org.jboss.security.auth.spi.DatabaseServerLoginModule" flag = "required">
             <module-option name = "dsJndiName">java:/authDS</module-option>
             <module-option name = "principalsQuery">SELECT password FROM users WHERE login = ? and idcompania=? </module-option>
             <module-option name = "rolesQuery">SELECT roles.name AS roles FROM roles WHERE roles.id IN 
                                        (SELECT users_roles.roleid FROM users_roles WHERE users_roles.userid IN 
                                        (SELECT users.id FROM users WHERE login = ? and idcompania=? ))</module-option>
             <!-- <module-option name="hashAlgorithm">MD5</module-option> -->
             <!-- <module-option name="hashEncoding">base64</module-option> -->
             <!-- <module-option name="hashEncoding">HEX</module-option> -->
             <!-- <module-option name="hashAlgorithm">SHA-1</module-option> -->
             <!-- <module-option name="digestCallback">com.myclass.MyDigestCallback</module-option>-->
          </login-module>
       </authentication>
    </application-policy> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-21T13:44:37.033

```
<application-policy name = "AP"> change to <application-policy name = "Admin"> 
```

或者

```
<security-domain>java:/jaas/Admin</security-domain> change to

<security-domain>java:/jaas/AP</security-domain> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-04T13:07:42.413

从您的示例中，您需要使用 DatabaseServerLoginModule 实现进行身份验证：

*   在 web.xml 中，您不需要使用 REALM 标记。
*   您必须在 jboss-web.xml 中定义您使用的安全域。
*   您不需要使用 [ digestCallback ] 选项模块。
*   注意 web.xml 中定义的角色和 General 中的安全约束。

我希望这对你有帮助。

# c - keystroke generation

> ID：472744
> 
> 赞同：0
> 
> 时间：2009-01-23T12:43:41.667
> 
> 标签：c, algorithm

I have a scenario where i need to generate all possible keystrokes using numbers 2 to 9\. The possible keystrokes should generate 2-git, 3-digit etc upto 32-digit numbers. can anybody tell me what is the best way to solve this problem.

Thanks, Pdit

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T13:10:25.917

从一些简单的分析开始考虑可行性。一位数字有 8 个可能的值。两位数有 8 x 8。等等。现在拿起你的计算器并计算 8 ^ 32。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T12:47:38.600

You're looking at quite a bit of computation towards the higher end of that.

One possible way to do it would be to have an array as a place-holder for your digit sequence, increment either the highest or lowest index, check if it overflows and then "carry" it to the next index and do that until you overflow the poistion "at the other end". Start with the array filled with 2.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T13:13:18.890

我会采用一种简单的递归方法，这里有字符，但你也可以使用其他方式来构建你的数字..

在 C 中：

```
#include <stdio.h>
void keystrokes(int x, int lo, int hi, char array[]) {
  int i;
  if (x > hi)
    return;
  if (x >= lo) {
    array[x] = 0;
    printf ("%s\n", array);
  }
  for (i = 2; i < 10; i++) {
    array[x] = i+'0';
    keystrokes (x+1, lo, hi, array);
  }
}
int main(void)
{
  char array[33];
  keystrokes(0, 2, 32, array);

  return 0;
} 
```

它可以稍微优化一下（例如，对于所有 32 位数字，它仍然会进行 10 次额外的递归调用），但仍然需要永远计算所有可能的组合。

# c# - EIMI 有什么好的用例？

> ID：472782
> 
> 赞同：1
> 
> 时间：2009-01-23T12:53:19.867
> 
> 标签：c#, .net, interface

EIMI 是显式接口成员实现。所以而不是：

```
public int SomeValue{get;} 
```

你有

```
int SomeInterface.SomeValue {get;} 
```

我目前正在考虑使用一个，因为我正在使用内部接口（解耦，但限制）并且我不想让实现对象上的方法出现在其公共 API 中。

这是一个很好的用例吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T13:20:04.697

一个很好的例子是 .Net 通用集合类。

例如，隐式和（非通用接口）显`List<T>`式实现“IList” 。`IList`这意味着当您直接使用该类时，您只会看到专门的方法，而不是使用 Object 的方法。

假设您实例化一个`List<Person>`. 如果 IList 是隐式实现的，那么您将在 Add(Person item) 和 Add(Object item) 类上直接访问两个 add 方法，这将破坏泛型提供的类型安全。调用 list.Add("Foo") 将编译得很好，因为 Add(Object) 重载将被自动选择，并且泛型提供的类型安全性消失了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T13:18:29.973

是的，这是一个很好的用例。根据MSDN 上的[C# 语言规范：](http://msdn.microsoft.com/en-us/library/aa664591(VS.71).aspx)

> 显式接口成员实现有两个主要目的：
> 
> *   因为显式接口成员实现不能通过类或结构实例访问，所以它们允许将接口实现从类或结构的公共接口中排除。当一个类或结构实现一个对该类或结构的使用者不感兴趣的内部接口时，这特别有用。
>     
>     
> *   显式接口成员实现允许消除具有相同签名的接口成员的歧义。如果没有显式的接口成员实现，则类或结构不可能具有具有相同签名和返回类型的接口成员的不同实现，就像类或结构不可能在具有相同的签名但具有不同的返回类型。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-07-01T14:57:53.850

通过 C# 从书中 CLR 你可以找到使用 EIMI 的其他原因：类型安全和拳击避免

例如，您已经实现了 IComparable 接口：

```
struct SomeValueType1 : IComparable
{
    private int _v;

    public SomeValueType1(int v)
    {
        _v = v;
    }

    public int CompareTo(object obj)
    {
        return _v - ((SomeValueType1)obj)._v;
    }
} 
```

查看方法 CompareTo 的实现：不是类型安全的。作为参数它得到对象。如果对象类型不是 SomeValueType1 - 它会在运行时崩溃

使用：

```
SomeValueType1 svt1 = new SomeValueType1(0);
Object o1 = new Object();
Int32 res = svt1.CompareTo(svt1);
res = svt1.CompareTo(o1); 
```

第三行从 svt1 装箱到 Object。第 4 行会产生运行时错误

让我们使用 EIMI：

```
struct SomeValueType2 : IComparable
{
    private int _v;

    public SomeValueType2(int v)
    {
        _v = v;
    }

    public int CompareTo(SomeValueType2 svt2)
    {
        return _v - svt2._v;
    }

    int IComparable.CompareTo(object obj)
    {
        return CompareTo((SomeValueType2)obj);
    }
} 
```

使用：

```
SomeValueType2 svt2 = new SomeValueType2(0);
Object o2 = new Object();
res = svt2.CompareTo(svt2);
res = svt2.CompareTo(o2); 
```

三线不做拳击！第 4 行会产生编译时错误

正如 Jeffrey Richter 通过 C# 第 4 版在 CLR 中所写的那样：“这个讨论清楚地表明，应该非常小心地使用 EIMI。当许多开发人员第一次了解 EIMI 时，他们认为它们很酷，并尽可能地开始使用它们。 . 不要这样做！EIMI 在某些情况下很有用，但您应该尽可能避免使用它们，因为它们会使使用类型变得更加困难。

祝你好运！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-02-17T21:09:59.843

我想通过示例来澄清“界面成员的歧义消除”的含义（Vojislav Stojkovic，第二个示例）：

```
public interface IWindow {
   Object GetMenu();
}

public interface IRestaurant {
    Object GetMenu();
} 
```

两个不同的接口具有相同名称和签名的方法。但是我们要实现这两个接口：

```
public sealed class MarioPizzeria : IWindow, IRestaurant  {
    //Explicit inteface member implementation for IWindow      
    Object IWindow.GetMenu();

    //Explicit inteface member implementation for IRestaurant
    Object IRestaurant.GetMenu();

    //An optional method that has nothing to do with an interface
    public Object GetMenu(); 
} 
```

用法：

```
MarioPizzeria mp = new MarioPizzeria();
mp.GetMenu(); //MarioPizzeria's public method

//IWindow.GetMenu method
IWindow window = mp;
window.GetMenu();

//IRestaurant.GetMenu method
IRestaurant restaurant = mp;
restaurant.GetMenu(); 
```

一个有趣的[事实](https://msdn.microsoft.com/en-us/library/aa664591(VS.71).aspx)：

*   显式接口成员实现不能通过类或结构实例访问。
*   隐式接口成员实现必须始终是公共的。

# sql-server - Only display the values to the right of a Decimal Number

> ID：472784
> 
> 赞同：0
> 
> 时间：2009-01-23T12:54:14.140
> 
> 标签：sql-server, sql-server-2005

I use SQL Server 2005 and need to test whether values in a column that's metadata has been specified as DECIMAL(18.3) actually contains data that has values to the right of the Decimal point, and if so, what these values are.

I've read a few articles that only discuss how to drop off the decimal places or how to round the values, but not how to ONLY display what is stored to the right of the decimal point.

Your help would be greatly appreciated.

Kind Regards,

Ignacio.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T13:00:11.540

Try:

```
SELECT a - FLOOR(a)
FROM ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T13:01:58.603

```
SELECT decimalnumber - FLOOR(decimalnumber) AS decimalpart
FROM mytable
WHERE decimalnumber - FLOOR(decimalnumber) > 0 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T19:43:19.090

这可能并不总是按您期望的方式工作。当您有负数时会出现问题。您可以将 FLOOR 视为一种舍入类型，它总是向下舍入到下一个整数。地板（3.14）= 3，地板（-3.14）= -4。

要获取小数点后数字的值，可以使用 ParseName 函数，该函数适用于正数和负数。

```
Select ParseName(-3.9876, 1)
Select ParseName(-3.1234, 1)
Select ParseName(3.9876, 1)
Select ParseName(3.1234, 1) 
```

# c# - 如何以编程方式查找 Sharepoint 安装的详细信息？

> ID：472787
> 
> 赞同：1
> 
> 时间：2009-01-23T12:54:36.807
> 
> 标签：c#, sharepoint, moss

我需要找出一些关于使用 C# 在本地机器上安装 Sharepoint 的一般背景信息——它是什么 sharepoint 版本/补丁版本等等。有没有人对如何做到这一点有任何指示？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T20:18:14.430

SPFarm.BuildVersion

[http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spfarm.buildversion.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spfarm.buildversion.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T14:57:21.787

事实证明，至少对于 MOSS 来说，找到这个的方法是检查注册表，特别是：

```
SOFTWARE\Microsoft\Shared Tools\Web Server Extensions\12.0 
```

这包括一个 Sharepoint 和一个 Version 密钥，指示 Sharepoint 已安装以及它是什么版本。当然，密钥的存在是 Sharepoint 已安装的一个很好的指标。

# .net - Does IL Merge work with .NET Compact Framework

> ID：472790
> 
> 赞同：1
> 
> 时间：2009-01-23T12:56:18.053
> 
> 标签：.net, compact-framework

Does anyone have experience using IL Merge and the .NET CF? Does IL Merge work with CF? Are there any known problems?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T13:04:43.510

是的，IL 合并确实支持 Compact Framework 平台。默认情况下，它将尝试以桌面 CLR 为目标。但是，您必须将 Compact 框架安装的路径传递给 /targetplatform 参数。

例如

ilmerge /t:winexe /targetplatform:v2,"C:\Program Files\Microsoft.NET\SDK\CompactFramework\v2.0\Debugger\BCL"

这篇博客文章对这个过程进行了很好的细分：

[http://blog.opennetcf.com/ncowburn/2007/01/30/UsingILMergeOnCompactFrameworkApplications.aspx](http://blog.opennetcf.com/ncowburn/2007/01/30/UsingILMergeOnCompactFrameworkApplications.aspx)

# c++ - 如何创建填充箭头 CustomLineCap？

> ID：472791
> 
> 赞同：1
> 
> 时间：2009-01-23T12:58:12.400
> 
> 标签：c++, gdi+

MSDN 文档有几个空心箭头示例，但没有实心箭头示例。

我只想创建一个比默认 LineCapArrowAnchor 更大的箭头。我尝试了几件事，但无法让它工作。应该很简单吧？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T15:42:19.997

找到了。看起来有一个从 CustomLineCap 派生的**AdjustableArrowCap**类，它正是我想要的。

# bug-tracking - 在哪里可以找到 TeX 的错误日志图？

> ID：472793
> 
> 赞同：2
> 
> 时间：2009-01-23T12:59:25.737
> 
> 标签：bug-tracking, tex, knuth, literate-programming

在 Donald Knuth 的[Literate Programming](https://rads.stackoverflow.com/amzn/click/com/0937073806)中，如果我没记错的话，有一张图表显示了 TeX 的错误数量随时间的演变。该图在过去十年左右一直保持平稳，这表明 TeX 现在可能没有错误。

我想用这张图来说明错误跟踪软件的重要性。它可以从某个地方下载吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-25T16:13:09.903

我认为您所指的图表位于*Literate Programming*的第 10 章（Knuth，DE，1992，语言和信息研究中心），这是 Knuth，DE，1989，*TEX 的错误的*重印。软件。实践。专家。19, 7 (1989 年 7 月), 607-685。

除了书本形式之外，我没有看到其他图表，但更新的错误列表位于 PDF 中[http://tug.org/texlive/Contents/live/texmf-doc/doc/english/knuth/errata/errorlog.pdf](http://tug.org/texlive/Contents/live/texmf-doc/doc/english/knuth/errata/errorlog.pdf)。*虽然我的Literate Programming*副本的第 11 章中的列表涵盖 1978 年到 1991 年，但 PDF 将其扩展到 2002 年。如果您安装了 TeX Live，则该文件的另一个版本，直到 1995 年，可能会在您的系统上作为 knuth/errorlog .tex.gz。

列表中注释的 PDF 位于[http://www.tug.org/TUGboat/Articles/tb10-4/tb26knut.pdf](http://www.tug.org/TUGboat/Articles/tb10-4/tb26knut.pdf)，1989 年的 TUG 会议主题演讲。

由于所有错误都已编号，因此可以通过快速手动过程生成粗略的（因为列表不是按严格的数字顺序）图表，例如按月。本章中所有图表的更广泛范围和内容将是一项较长的工作，但可能是一个有趣的编程练习（为此，TeX 源的格式可能比 PDF 容易得多）。

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2009-01-23T13:06:49.763

旁注：代码永远不会“没有错误”。只有“预期的怪癖”和“尚未发现的错误”。

# wpf - 如何在 ListBox 中获得垂直滚动条？

> ID：472796
> 
> 赞同：94
> 
> 时间：2009-01-23T13:00:14.003
> 
> 标签：wpf, xaml, listbox, scrollviewer

在下面的示例中，我有一个 ListBox，其中包含许多字体名称。

我原以为它会自动有一个垂直滚动条，以便您可以选择任何字体，而不仅仅是列表中的第一个字体，但事实并非如此。

所以我添加了一个“ScrollViewer”，并在右侧放置了一个“滚动条区域”，但滚动条区域中没有滚动条，因此您可以滚动（！）。

为什么滚动条不是自动的，我如何强制它有滚动条？

```
<StackPanel Name="stack1">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="2*"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
        </Grid.RowDefinitions>
        <ScrollViewer>
            <ListBox Grid.Row="0" Name="lstFonts" Margin="3"  ItemsSource="{x:Static Fonts.SystemFontFamilies}"/>
        </ScrollViewer>
    </Grid>
</StackPanel> 
```

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2009-01-23T13:10:10.067

您的解决方案的问题是您在 ListBox 周围放置了一个滚动条，您可能希望将其放在 ListBox 中。

如果要在 ListBox 中强制使用滚动条，请使用 ScrollBar.VerticalScrollBarVisibility 附加属性。

```
<ListBox 
    ItemsSource="{Binding}" 
    ScrollViewer.VerticalScrollBarVisibility="Visible">
</ListBox> 
```

将此值设置为 Auto 将根据需要弹出滚动条。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2012-02-02T14:42:54.123

`ListBox`已经包含`ScrollViewer`. 默认情况下`ScrollBar`，当内容多于空间时会显示。但是有些容器会自行调整大小以适应其内容（例如`StackPanel`），因此永远不会有“内容多于空间”。在这种情况下，`ListBox`总是会为内容提供尽可能多的空间。

为了计算内容多于空间的条件，应该知道大小。`ListBox`通过在元素本身上显式设置大小`ListBox`或从主机面板设置大小，确保您的大小受到限制。

如果主机面板是垂直的`StackPanel`并且您希望`VerticalScrollBar`您必须`ListBox`自行设置高度。对于其他类型的容器，例如`Grid`，`ListBox`可以受容器约束。例如，您可以将原始代码更改为如下所示：

```
<Grid Name="grid1">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="2*"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
        </Grid.RowDefinitions>
        <ListBox Grid.Row="0" Name="lstFonts" Margin="3"
                 ItemsSource="{x:Static Fonts.SystemFontFamilies}"/>
    </Grid>
</Grid> 
```

请注意，重要的不仅仅是直接容器。在您的示例中，直接容器是 a `Grid`，但是因为它`Grid`包含在 a`StackPanel`中，所以外部`StackPanel`会扩展以容纳其直接子项`Grid`，以便该子项可以扩展以容纳*其*子项（the `ListBox`）。

如果您在任意点约束高度——通过设置 的高度`ListBox`，设置内部的高度`Grid`，或者简单地通过使外部容器为`Grid`a——那么当列表项太多时，垂直滚动条将自动出现适合控制。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-01-23T13:22:16.627

我在我的 ListBox 中添加了一个“高度”，它很好地添加了滚动条。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-06-14T09:51:53.277

除非将滚动条的可见性设置为隐藏，否则滚动条会自动添加到列表框中。每当List Items的大小超过一个，即可以在列表框内显示垂直或水平的列表框时，可以在运行时看到。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-04-09T18:03:20.923

在我的情况下，ListBox 中的项目数是动态的，所以我不想使用 Height 属性。我改用 MaxHeight 并且效果很好。当滚动条填满我为其分配的空间时，它就会出现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-09T17:39:18.697

我遇到了同样的问题，我在 StackPanel 中有一个 ComboBox，后跟一个 ListBox，而 ListBox 的滚动条没有出现。我通过将两者放在 DockPanel 中解决了这个问题。我设置了 ComboBox DockPanel.Dock="Top" 并让 ListBox 填充剩余空间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-05-08T07:55:45.817

**XAML 列表框滚动器 - Windows 10(UWP)**

```
<Style TargetType="ListBox">
    <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Visible"/>
    <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Visible"/>
</Style> 
```

# openssl - openssl / valgrind

> ID：472809
> 
> 赞同：9
> 
> 时间：2009-01-23T13:07:57.623
> 
> 标签：openssl, valgrind

我有一个必须计算文件 MD5 的应用程序，我使用了 openssl 库，valgrind 抱怨某些块仍然可以访问。

编译以下代码：

```
#include <openssl/bio.h>

int main(int, char**)
{
   BIO * mem = BIO_new(BIO_s_mem());
   BIO_vfree(mem);
   return 0;
} 
```

使用 valgrind 运行它，这就是我得到的：

```
==23597== 220 bytes in 6 blocks are still reachable in loss record 1 of 1
==23597==    at 0x4022D78: malloc (vg_replace_malloc.c:207)
==23597==    by 0x432FD0D: (within /usr/lib/i686/cmov/libcrypto.so.0.9.8)
==23597==    by 0x433036E: CRYPTO_malloc (in /usr/lib/i686/cmov/libcrypto.so.0.9.8)
==23597==    by 0x43989C9: lh_new (in /usr/lib/i686/cmov/libcrypto.so.0.9.8)
==23597==    by 0x4332025: (within /usr/lib/i686/cmov/libcrypto.so.0.9.8)
==23597==    by 0x433249B: (within /usr/lib/i686/cmov/libcrypto.so.0.9.8)
==23597==    by 0x4332B5D: CRYPTO_new_ex_data (in /usr/lib/i686/cmov/libcrypto.so.0.9.8)
==23597==    by 0x438E053: BIO_set (in /usr/lib/i686/cmov/libcrypto.so.0.9.8)
==23597==    by 0x438E0E9: BIO_new (in /usr/lib/i686/cmov/libcrypto.so.0.9.8)
==23597==    by 0x80485E1: main (in /home/kalman/cxx_test/md5test/a.out) 
```

有人有同样的经历吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T13:21:52.977

OpenSSL 在未使用 -DPURIFY 编译时具有混淆 Valgrind 的操作。 [这是您看到的错误吗？](http://www.openssl.org/support/faq.html#PROG14)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-06T05:49:15.940

我相信这些是 openssl 分配的一些静态结构。我运行了您的代码，然后运行了以下代码，并且 valgrind 报告两者具有相同数量的未释放内存：

```
#include <openssl/bio.h>

int main(int, char**)
{
   BIO * mem = BIO_new(BIO_s_mem());
   BIO * mem2 = BIO_new(BIO_s_mem());
   BIO * mem3 = BIO_new(BIO_s_mem());
   BIO * mem4 = BIO_new(BIO_s_mem());
   BIO_vfree(mem);
   BIO_vfree(mem2);
   BIO_vfree(mem3);
   BIO_vfree(mem4);
   return 0;
} 
```

~

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-10-23T08:14:43.033

```
BIO_new() -> BIO_set() -> CRYPTO_new_ex_data() -> int_new_ex_data() -> def_get_class() 
```

int_new_ex_data() 不会释放 def_get_class malloced 的内存。

参见： http: [//openssl.6102.n7.nabble.com/memory-leak-in-engine-cleanup-td30935.html](http://openssl.6102.n7.nabble.com/memory-leak-in-engine-cleanup-td30935.html) [http://rt.openssl.org/Ticket/Display.html?id=2673&user=guest&pass =客人](http://rt.openssl.org/Ticket/Display.html?id=2673&user=guest&pass=guest)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-11T11:01:39.087

OpenSSL 包含许多未初始化的变量、从未释放的变量和内存、从未清除的变量以及无法在范围外访问甚至无法手动释放的变量。Valgrind 发现了很多这样的东西。

PURIFY 标志仅与 rand()_function 有关。因此，为了避免在 Purify Openssl 中检测到，如果设置了该标志，则实际上使用不同的源代码。不错的编码...也许最好首先解决问题？！

# svn - 是否可以获得颠覆客户端日志文件？

> ID：472814
> 
> 赞同：6
> 
> 时间：2009-01-23T13:10:22.220
> 
> 标签：svn, logging, client

目前，我们遇到的问题仅存在于少数 Subversion 客户端。

我们想要得到一个 Subversion 客户端日志文件，其中包含信息发送到服务器的命令，返回的响应等等。是否有可能打开日志记录以在客户端上获取该信息？

我发现了大量关于如何处理颠覆日志的信息，但这在这里没有帮助。

因为要求的注释，这里是问题部分：

1.  我们有一个用于所有身份验证信息的中央 LDAP。这在公司各处都使用，

2.  Subversion 被配置为在那里获取身份验证信息，

3.  有问题的客户告诉我们，由于身份验证错误，他们必须在某些日子甚至两次或三次更改密码。LDAP 允许最多 X 次连续输入错误密码，之后必须更改密码，

4.  有问题的客户端告诉我们他们没有使用任何脚本或自动客户端，

5.  Apache HTTP Server 日志告诉我们客户端尝试在同一秒内登录 15 次。

6.  我们使用 HTTPS 从任何地方访问颠覆服务器。

所以我认为，客户端应该有什么问题，但我不知道原因可能是什么。subversion 客户端日志文件在这里会很有帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T14:02:07.030

[在您的subversion](http://svnbook.red-bean.com/en/1.7/svn.advanced.confarea.html#svn.advanced.confarea.opts.servers)[配置文件](http://svnbook.red-bean.com/en/1.7/svn.advanced.confarea.html#svn.advanced.confarea.opts.servers)`neon-debug-mask`的`[global]`部分中设置为 138 以获得身份验证调试。[`servers`](http://svnbook.red-bean.com/en/1.7/svn.advanced.confarea.html#svn.advanced.confarea.opts.servers)

```
[global]
<snip...>
neon-debug-mask = 138 
```

这可以在 SVN 服务器端和/或客户端完成。一侧通常足以看到发生了什么爆炸。

很可能 LDAP 集成很麻烦。请记住，*根据您的设置，根据您在 svn 权限文件中配置的内容，用户的 LDAP 登录**可能区分大小写***。

[注意：从 SVN 1.3 开始，我实际上不必这样做，我认为它仍然可以类似地工作。]

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-12T10:45:45.713

对于 SVN 客户端日志文件，请根据您的环境尝试 C:\Documents and Settings[user-name]\Application Data\TortoiseSVN\logfile.txt 或类似文件

# sql-server - 选择语句

> ID：472815
> 
> 赞同：-1
> 
> 时间：2009-01-23T13:10:22.250
> 
> 标签：sql-server

我将使用什么选择语句将 excel 电子表格添加到现有表中，因为我在尝试在数据库上创建新表时遇到错误？请你帮帮我。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T14:15:36.380

您也可以使用 OPENROWSET

```
INSERT INTO SOMETABLE SELECT * FROM OPENROWSET( 'Microsoft.Jet.OLEDB.4.0',
'Excel 8.0;Database=C:\testing.xls','SELECT * FROM [Sheet1$]') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T13:13:02.137

菲奥娜——

您可能在这里使用了错误的工具。您可能希望使用名为 SQL Server Integration Services 的工具将数据导入 SQL Server。您可以通过右键单击 SQL Server 企业管理器中的数据库，选择“任务”来执行此操作。然后“导入数据”。你可能需要对你正在做的事情做更多的研究才能完成你想要的。

# ruby-on-rails - Ruby on Rails 中一个共享视图的两个控制器

> ID：472817
> 
> 赞同：27
> 
> 时间：2009-01-23T13:10:46.260
> 
> 标签：ruby-on-rails, ruby, model-view-controller

我有两个控制器分别用于两个模型，例如照片和类别。index 和 show 方法在每个控制器中都非常相似，并且视图是相同的。两个模型共享视图的最佳方法是什么？

我有两个选择：

*   使用助手。在助手中将放置视图的代码，并将从每个视图（照片/视图和类别/视图）中调用助手

*   在每个视图中使用部分。我认为这是一个更干净的解决方案，但在编写此解决方案时，我的脑海中出现了巨大的 DRY。

所以，我有来自两个模型的两个控制器，每个控制器都暴露在 @photo 对象上（照片控制器包含所有照片，类别控制器仅包含所选类别的照片），我需要一个视图来显示两者。

我正在为此寻找一个优雅的解决方案，抱怨 REST 和 DRY 原则。任何的想法？

提前致谢。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-01-23T14:10:58.823

我的一个项目也有类似的情况。大多数控制器的所有删除视图都以相同的方式设置样式，显示相同的确认框，并且简单地呈现正在删除的任何对象的可预测显示。

在我看来，这个解决方案非常简单和优雅。简单地说，我们（开发人员）所做的就是在 call 中创建一个新目录`app/views`并将`shared`共享视图放入其中。这些可以是完整的模板文件或只是部分。

我建议使用共享模板（既不在类别也不在照片视图目录中，而是在共享目录中）并从视图中手动呈现。

例如，在控制器和文件中都有这样的方法`app/views/shared/photo.html.erb`：

```
def show
  @photo = Photo.first # ... or whatever here
  render :template => 'shared/photo'
end 
```

这应该会成功呈现共享模板。这是最干燥的路线，并且在每个控制器的视图目录中使用或多或少的空视图只是为了包含共享部分时，不会有污染的感觉，正如我理解你的问题所暗示的那样。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-31T13:18:56.303

关于第[一个](https://stackoverflow.com/questions/472817/two-controllers-for-one-shared-view-in-ruby-on-rails/473008#473008)答案：

如果必须从视图呈现部分：

```
<%= 渲染 :partial => "共享/照片" %>

```

并且部分必须在 app/views/shared/_photo.html.erb

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T13:15:33.833

我会使用助手，因为它们在视图之间共享。对于 HTML 部分，我会使用部分，所以它会是两种方式的混合。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-11T17:39:49.147

这看起来像是[Cells](https://github.com/apotonick/cells) gem 的一个很好的用例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-18T19:35:25.200

@bjeanes 如果您的所有删除视图都相同，您可以创建 views/default/delete.html.erb 并且所有删除​​操作都将使用它。

这就是我正在做的事情：我的大多数视图都是默认的，我只在需要时创建特定的视图

更新：好的，这篇文章是 2009 年的，无论如何，我会在这里保留我的评论，以防有人像我一样从谷歌那里得到这里。

# java - 在 Linux 上使用 Bundle-NativeCode 不起作用

> ID：472825
> 
> 赞同：5
> 
> 时间：2009-01-23T13:13:40.560
> 
> 标签：java, linux, eclipse-plugin, shared-libraries, bundle

我创建了一个包含以下文件夹结构的插件：

*   源代码
*   本机/so/libsystemcommand.so
*   元信息/清单.MF

清单包括命令

```
Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Commands Plug-in
Bundle-SymbolicName: de.system.commands;singleton:=true
Bundle-Version: 1.0.0
Bundle-Activator: de.system.commands.CommandsPlugin
Bundle-Localization: plugin
Bundle-NativeCode: native/so/libsystemcommand.so; osname = Linux; processor = x86
Require-Bundle: org.eclipse.core.runtime,
 org.apache.commons.logging
Eclipse-AutoStart: true
Export-Package: de.system.commands,
 de.system.commands.jni,
 de.system.commands.utils
Bundle-ClassPath: . 
```

build.properties 看起来像

```
source.. = src/
output.. = bin/
bin.includes = META-INF/,\
               .,\
               native/ 
```

在我`Activator`上课的开始方法中，我打电话

```
System.loadLibrary("systemcommand"); 
```

在运行时找不到库并抛出**UnsatisfiedLinkError 。**

```
java.lang.UnsatisfiedLinkError: no libsystemcommand in java.library.path 
```

我必须在插件中设置更多属性吗？我是否必须在目标平台上解压缩一些信息？

**编辑：**

```
java.library.path=/opt/jdk/j2re1.4.2_16/lib/i386/client:/opt/jdk/j2re1.4.2_16/lib/i386:/opt/jdk/j2re1.4.2_16/../lib/i386::/opt/dsa/lib:/opt/dsa/lib 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T13:44:30.093

我想知道是否需要在没有 lib 前缀的情况下指定库？例如，

```
System.loadLibrary("systemcommand"); 
```

因为这就是在 gcc 链接线上传递库的方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T13:25:17.057

该库必须在您的文件系统中（而不是在存档文件中）。然后您可以使用`LD_LIBRARY_PATH`指向 lib 的 linux 环境变量或定义属性 java.library.path

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T14:47:01.713

在 linux 的插件片段中，我使用：

```
Bundle-NativeCode: librptlc.so; osname = linux; processor=x86 
```

在我使用的主插件中：

```
if (OS.equals(Platform.OS_LINUX)) {
    System.loadLibrary("rptlc");
} 
```

这也应该在一个插件中工作。

我似乎记得 jar 的子文件夹中的库有一些问题，但我不确定为什么会这样。我只是坚持将库放在插件片段的根目录中，这对我有用。

您还可以尝试获取库的文件系统路径（不确定这是否容易）并使用以下方法加载它：

```
libraryPath = "C:\eclipse\bundles\123\librptlc.so";
System.load(libraryPath); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T15:07:41.563

我想我找到了解决方案。

我们只构建不起作用的插件并将其复制到目标平台目录。在此之后，我们启动应用程序作为 wtach 日志文件，无论库是否存在。

我们错过的是**删除配置文件夹**。新插件未解压缩，并且配置目录中不存在该库。

对不起，谢谢你的回答。

**编辑 ：**

配置文件夹位于

```
<installation>/eclipse/configuration/ 
```

至少删除没有文件的所有内容

```
<installation>/eclipse/configuration/config.ini 
```

# python - 从具有运行平衡输出的输入附加列表中减去

> ID：472839
> 
> 赞同：0
> 
> 时间：2009-01-23T13:17:23.640
> 
> 标签：python, loops, running-balance

*小白*

我正在尝试编写一个提供运行平衡的脚本。我搞砸了python的基本声明函数。

我也需要它：

*   通过输入接受余额
*   附加交易列表
*   按照输入的顺序一一取出
*   打印运行总计
*   使用[pyhtmltable](http://www.pasko.net/PyHtmlTable/)以 html 表格的形式输出，以便复制和粘贴

代码：

```
# transaction posting on available balance

import PyHtmlTable 
import twodarr
import string,re
import copy
import sys

posting_trans = [] #creating a list of posting debits here

avail_bal = int(input('What is the balance available to pay transactions?')) #getting the starting balance

while True:  #building up the list of transactions
    ans = input('Please enter the debits in order of posting one at a time.  If there is no more, please enter 0:')
    if int(ans) == 0:
        break
    if ans > 0:    # to get out of loop
        posting_trans.append(ans)

num_trans = int(len(posting_trans))   #counting the number of transactions

print "<b> Beginning available balance of",avail_bal," </b> "  # start of the html table

tabledict = {'width':'400','border':2,'bgcolor':'white'}

t  = PyHtmlTable.PyHtmlTable( 2, 1 , tabledict )

t.setCellcontents(0,0,"Transactions")  #header cells
t.setCellcontents(1,0,"Available Balance")

while True:      #trying to create the rest of a dynamic table
    if countdown == 0:
        break

    for countdown in range(1,num_trans):
        t.add_row(1)

        def newer_bal():
            newer_bal(avail_bal - posting_trans[countdown])

            t.setCellcontents(0, 1, posting_trans[countdown])
            t.setCellcontents(1, 1, newer_bal)       

t.display() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T13:40:12.237

类似的东西？

```
# transaction posting on available balance
import PyHtmlTable 

posting_trans = [] #creating a list of posting debits here

#getting the starting balance
print 'What is the balance available to pay transactions? '
avail_bal = float(raw_input('Value: ')) 

while True:  #building up the list of transactions
    print 'Please enter the debits in order of posting one at a time.'
    print 'If there is no more, please enter 0:'
    ans = float(raw_input('Value: '))
    if ans == 0:
        break # to get out of loop
    posting_trans.append(ans)

# start of the html table
print "<b> Beginning available balance of %.2f</b>" % avail_bal

tabledict = {'width': '400', 'border': 2, 'bgcolor': 'white'}
t  = PyHtmlTable.PyHtmlTable(2, 1, tabledict)

t.setCellcontents(0, 0, "Transaction Value")  #header cells
t.setCellcontents(0, 1, "Available Balance")

for line, trans in enumerate(posting_trans):
    avail_bal -= trans
    t.setCellcontents(line + 1, 0, '%.2f' % trans)
    t.setCellcontents(line + 1, 1, '%.2f' % avail_bal)       

t.display() 
```

提示：

*   不要使用`input()`. 改为使用`raw_input()`。它已`input()`在 python 3.0 中重命名为。
*   您不需要将值存储在列表中。您已经可以将它们存储在表中，这就是使用`PyHtmlTable`. 我出于教学目的离开了名单。
*   阅读教程。阅读文档。写很多代码。

# c# - 我应该避免替代控制语法吗？

> ID：472840
> 
> 赞同：1
> 
> 时间：2009-01-23T13:17:44.717
> 
> 标签：c#, php, syntax, theory

作为一个主要是自学成才的程序员，我从来没有真正让任何人解释为什么应该或不应该使用某些东西。一个例子（我多年前捡到并且经常使用）是另一种控制结构语法：

```
x = (y == true) ? "foo" : "bar"; 
```

我个人觉得这种语法很容易理解，特别是对于简短、简洁的代码，但我没有看到它在“野外”得到很多使用，所以我想知道在更多的情况下使用它是否是不好的做法传统*的 if ... else*结构？

提前致谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-23T13:24:02.613

作为一个自学成才的程序员，我只能给你我的意见，没有任何特殊的权威。

我发现当您将三元条件运算符 (?:) 用于没有副作用的表达式时，它是完全可以接受的。一旦您开始使用它来表示做某事与做其他事情的决定，您（在我看来）就在滥用它。

简而言之，控制结构用于构建代码流，操作符用于表达式。只要保持这种方式，代码就保持可读性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T13:42:44.073

条件运算符（有时称为三元运算符，但这在技术上并不正确，请参阅 Marc 的评论）并不是真正的“替代控制结构”，有一些重要的区别：

*   条件运算符是一个**运算符**并提供一个值，它在表达式中使用。
*   if/else 是一个控制结构，它（当然）自己不返回任何值。
*   条件运算符中的替代项也必须是表达式。
*   if-else 结构中的备选方案可以是任意数量的语句。

当然也有相似之处：

*   每个都评估一个条件表达式。
*   仅根据条件的布尔值评估适当的替代项（表达式或块）。
*   两者都可以与其他同类链接在一起以形成更长的“类似开关”的语句。

一般来说，如果您正在评估副作用的替代表达式（即做工作而不是返回值），那么使用条件运算符可能比使用 if-else 结构更容易使维护者感到困惑。

如果以下所有条件都为真，请使用条件：

*   您的条件语句和替代语句很容易理解。
*   这些表达式都没有任何副作用。
*   将来您将不需要对替代品进行额外的行为（即副作用或额外的陈述）。

您给出的示例很好地使用了三元条件。

如有疑问，请使用 if-else。谨防将条件视为另一种 if-else 并试图将不属于其中的东西塞进其中。这就是（尤其是在遗留代码中发现的）让人们完全拒绝使用条件运算符的那种东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T13:21:26.567

您所指的语法通常称为[三元条件运算符](http://en.wikipedia.org/wiki/%3F:)，它在语义上等于 if/else 子句，并且执行相同。

对过度使用这些结构的主要反对意见是，它可能会创建一些混乱的源代码，可能不像使用 if/else 方式那样可读。对于不了解该特定语法的人来说尤其如此。假设人们理解 if/else 更有可能 100%安全~~。~~

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T13:23:10.900

这被称为三元表达式。如果可以用三元运算符清晰简洁地表达意图，那么我会这样做。我通常画线并有复合表达式（超过1个与&&或||结合）

好的：

```
var x = (someVar > 42 ) ? ThisFunction() : ThisOtherFunction(); 
```

坏的：

```
var x = (someVar > 42 && anotherVariable.IsSafeForConsumption() && IsNotProcessing ) ? ThisFunction() : ThisOTherFunction(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T13:23:05.220

大多数开发人员应该非常熟悉条件运算符。实际上，我会简单地使用：

```
x = y ? "foo" : "bar"; 
```

我觉得很容易理解。/似乎`==true`（`==false`IMO）对布尔值过度杀伤。更常见的“旧世界”用法是：

```
if(12345 == someVar) {...} // etc 
```

这个 "const == variable" 是为了避免 "=" vs "==" 的问题，但是由于 C# 不将数字视为布尔值，因此这是一个问题非常罕见，并且更常见（在C#) 看得更清楚：

```
if(someVar == 12345) {...} // etc 
```

因为如果你错过了额外的 = 它通常不会编译。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T14:13:00.283

对我来说，这个问题是多程序员环境中的可读性和可维护性之一。

如果其他人必须阅读代码，或者如果您稍后要返回它，则需要使其可读。

除非您保持案例简单，否则使用三元运算符的代码很容易变得混淆和不可读。

*   把事情简单化
*   如果它变得有点难以阅读，请重构为 if { } else { }

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T14:32:40.540

除了在最基本的场景中使用它时，我会说避免它。如果将 2 个构造编译为完全相同的 MSIL，为什么要使用难以理解的那个？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T12:27:30.283

此外，由于三级运算符本质上是一个伪装成表达式的[语句](https://stackoverflow.com/questions/226002/whats-the-difference-between-x-x-vs-x)，因此您可以这样：

```
x = (y == true) ? "foo" : "bar";
string instructions = "Please can somebody go and get me a " + x; 
```

并将其转换为：

```
string instructions = "Please can somebody go and get me a " + 
                      ((y == true) ? "foo" : "bar"); 
```

请注意，额外的括号是必需的。如果您不明白为什么，请尝试自己编译！

这是一个非常有用的功能，我一直在使用它。只是要小心，因为其他人已经提到不要编写带有副作用的表达式，或者降低可读性的过于复杂的表达式。

在一个稍微不相关的注释中，看在上帝的份上，请不要写这样的代码（我已经看过很多次了）：

```
if (y == true) {
   weWantAFoo = true;
}
else {
   weWantAFoo = false;
} 
```

相反，您应该这样做：

```
bool weWantAFoo = (y==true); 
```

This is just another example of using a conditional statement somewhere other than in an `if` statement.

# .net - 当用户选项卡退出或字段失去焦点时，在 DataGrid 中实现保存字段的最佳方法

> ID：472841
> 
> 赞同：0
> 
> 时间：2009-01-23T13:18:02.283
> 
> 标签：.net, jquery, ajax, gridview, user-interface

我有一个带有 .Net 网格视图的页面，每行大约 12 个文本字段和大约 250 行。现在在页面底部有一个全部保存按钮，它将所有字段 12x250 发送到服务器，然后将它们逐个输入到 db 1 中。最终会非常缓慢，有时根本无法通过。我没有想出这个，但最终得到了一个人的角色来改进它。我认为在这种情况下最好的方法是在失去焦点时保存该字段。使用 gridview 在 .Net 中实现此功能的最佳方法是什么？

页面上已经加载了 jquery 库。页面上当前没有实现 ajax。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T13:25:19.320

如果你有 JQUERY 你可以调用一个“页面方法”通读这篇[文章](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)，一定要检查评论我不确定他是否更新了他的文章:-)

# 编辑

此外，您可以调用 Web 服务，这是我的代码中的一个示例，显示我调用 WCF 服务：

```
$.ajax({
  type: "POST",
  url: "../Services/Utilities.svc/IsPrintDownloadDone",
  data: "{}", //This should be a JSON representation of yoru inputs that the WCF can serialize into objects
  contentType: "application/json; charset=utf-8",
  dataType: "json",
  success: function(msg) {//msg.d has the response from server
        },  
  error: function (xhr, textStatus, errorThrown) {

}
}); 
```

# c# - 将字符串格式化为英国电话号码

> ID：472879
> 
> 赞同：5
> 
> 时间：2009-01-23T13:31:48.090
> 
> 标签：c#, regex, formatting, user-interface

我正在寻找一个将一串数字格式化为英国电话号码的例程。该例程应考虑需要不同格式的英国区号（即伦敦与爱丁堡与伍斯特相比）以及手机号码。

我的电话号码作为字符串存储在数据库中，仅包含数字字符。

到目前为止，我已经想出了这个，但性能似乎很差。

```
/// <summary>
/// Formats a string as a UK phone number
/// </summary>
/// <remarks>
/// 02012345678 becomes 020 1234 5678
/// 01311234567 becomes 0131 123 4567
/// 01905123456 becomes 01905 123456
/// 07816123456 becomes 07816 123456
/// </remarks>
public static string FormatPhoneNumber(string phoneNumber)
{
    string formattedPhoneNumber = null;

    if (!string.IsNullOrEmpty(phoneNumber))
    {
        System.Text.RegularExpressions.Regex area1 = new System.Text.RegularExpressions.Regex(@"^0[1-9]0");
        System.Text.RegularExpressions.Regex area2 = new System.Text.RegularExpressions.Regex(@"^01[1-9]1");

        string formatString;

        if (area1.Match(phoneNumber).Success)
        {
            formatString = "0{0:00 0000 0000}";
        }
        else if (area2.Match(phoneNumber).Success)
        {
            formatString = "0{0:000 000 0000}";
        }
        else
        {
            formatString = "0{0:0000 000000}";
        }

        formattedPhoneNumber = string.Format(formatString, Int64.Parse(phoneNumber));
    }

    return formattedPhoneNumber;
} 
```

欢迎提出如何改进这一点的想法......

## 编辑

我最初的想法是我应该将电话号码作为数字字段存储在数据库中，然后我可以不用 Int64.Parse 并*知道*它们是真正的数字。

## 编辑 2

电话号码都将是英国地理或英国手机号码，因此不需要考虑 0800 等特殊情况

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-23T13:40:07.433

英国电话号码的长度从 7 位到 10 位不等，不包括前导零。“区域”代码可以在 2 位到通常 4 位（但偶尔为 5 位）之间变化。

显示每个号码前缀的区号和总长度的所有表格都可以从[OFCOM 的网站上](http://www.ofcom.org.uk/static/numbering/)获得。注意：这些表格**很**长。

此外，对于放置空间的确切位置没有标准。有些人可能会将它们放在不同的地方，这取决于它使结果文本的“可读性”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-08T20:30:45.653

** 我正在寻找一个将一串数字格式化为英国电话号码的例程。**

您可以下载 Ofcom 数据库，其中列出了每个号码范围的格式，包括仅限国内拨号的号码，并查找您需要格式化的每个号码。数据库列出了每个范围的 SABCDE 数字和格式：0+10、2+8、3+7、4+6、4+5、5+5 或 5+4。

数据库中存在少量错误（尤其是 01697 和 0169 77 代码），但在超过 100 万个条目中，错误数量不到 10 个。

有四个文件涵盖 01 和 02 号码，以及各种非地理号码范围的单独文件。

0+10 号码是“仅限国内拨号”，并且在区号部分周围不带括号。所有 02 号码的区号为 02x，所有 011x 和 01x1 号码的区号为 01xx，大多数其他 01 号码的区号为 01xxx（一个非常小的数字 - 大约十几个 - 不过是 01xx xx）。

括号将所有其他 01 和 02 号码的区号括起来（即，在本地号码部分不以 0 或 1 开头的 01 和 02 号码上使用括号*）*。括号表示通过省略括号中的数字，可以在同一区域内进行本地拨号。

2+8 命名法显示区号和本地号码长度，条目 2075 : 2+8 表示号码格式为 (020) 75xx xxxx。请记住，在 2+8 确定中不“计算”前导零。

** 英国电话号码的长度从 8 位到 12 位不等 **

没有。自 2000 年以来，大多数在“0”中继线代码后有 10 位数字。少数在“0”中继线代码后仍有 9 位数字。

还有一些特殊号码，例如 0800 1111 和 0845 4647 需要考虑。

**“地区”代码可以在 2 到 4 位之间变化。**

区号可以在 2 到 5 位之间变化（不计算前导零）。需要明确的是，“020”被归类为 2 位区号，因为前导 0 实际上是中继线代码。还有 011x 和 01x1 区号，其他大多数号码都有 01xxx 区号。后者可能具有只有 5 位长的本地号码，而不是更广泛使用的 6 位本地号码。一个非常小的号码有 01xx xx 区号，这些号码有 5 或 4 位本地号码。

** 此外，对于放置空格的确切位置没有标准。**

对于所有 01 和 02 号码，区号部分和本地号码部分之间总是有一个空格。

如图所示，(01xx xx) 区号在区号内有一个空格也是传统的。这代表了该系统仍在使用的旧本地交换组。其他（较短的）区号不拆分。

7 位或 8 位本地号码在倒数第四位之前有一个拆分。不拆分 4、5 或 6 位本地号码。这同样适用于地理和非地理数字。

对于大多数 03、08 和 09 号码，号码写为 0xxx xxx xxxx。

一些 0800 和所有 0500 数字都写为 0xxx xxxxxx。

对于 055、056 和 070 数字，数字写为 0xx xxxx xxxx。

对于手机和寻呼机号码，请使用 07xxx xxxxxx。

** 除了有些人使用 '08000 abc def' 而不是 '0800 0abc def' **

这种用法是不正确的。请注意，有些 0800 号码在 0 中继代码后有 9 位，而其他号码在 0 中继代码后有 10 位。

所以，0800 xxxxxx 和 0800 xxx xxxx 都是正确的。

0500 号码仅使用 0500 xxxxxx。

大多数 03、08 和 09 数字写成 0xxx xxx xxxx。

另见： [http ://en.wikipedia.org/wiki/Local_conventions_for_writing_telephone_numbers#United_Kingdom](http://en.wikipedia.org/wiki/Local_conventions_for_writing_telephone_numbers#United_Kingdom)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-10-27T12:59:42.550

我花了一些时间浏览 OFCOM 的表格并得出以下结论。

```
public static class TelephoneHelper
{

    #region Regex Patterns
    private static readonly Regex[] patterns = 
    {
        new Regex(@"(?<first>013873)(?<second>\d{5})"),
        new Regex(@"(?<first>015242)(?<second>\d{5})"),
        new Regex(@"(?<first>015394)(?<second>\d{5})"),
        new Regex(@"(?<first>015395)(?<second>\d{5})"),
        new Regex(@"(?<first>015396)(?<second>\d{5})"),
        new Regex(@"(?<first>016973)(?<second>\d{5})"),
        new Regex(@"(?<first>016974)(?<second>\d{5})"),
        new Regex(@"(?<first>016977)(?<second>\d{4}\d?)"),
        new Regex(@"(?<first>017683)(?<second>\d{5})"),
        new Regex(@"(?<first>017684)(?<second>\d{5})"),
        new Regex(@"(?<first>017687)(?<second>\d{5})"),
        new Regex(@"(?<first>019467)(?<second>\d{5})"),
        new Regex(@"(?<first>02\d)(?<second>\d{4})(?<third>\d{4})"),
        new Regex(@"(?<first>03\d{2})(?<second>\d{3})(?<third>\d{4})"),
        new Regex(@"(?<first>0500\d{6})"),
        new Regex(@"(?<first>05\d{3})(?<second>\d{6})"),
        new Regex(@"(?<first>07\d{3})(?<second>\d{6})"),
        new Regex(@"(?<first>08\d{2})(?<second>\d{3})(?<third>\d{3}\d?)"),
        new Regex(@"(?<first>09\d{2})(?<second>\d{3})(?<third>\d{4})"),
        new Regex(@"(?<first>01\d1)(?<second>\d{3})(?<third>\d{4})"),
        new Regex(@"(?<first>011\d)(?<second>\d{3})(?<third>\d{4})"),
        new Regex(@"(?<first>01\d{3})(?<second>\d{5}\d?)")
    };
    #endregion

    public static string FormatAsUkTelephone(this string number)
    {
        Regex matchedPattern = null;
        foreach (Regex pattern in patterns)
        {
            if (pattern.IsMatch(number))
            {
                matchedPattern = pattern;
                break;
            }
        }
        if (matchedPattern != null)
        {
            var mc = matchedPattern.Matches(number);
            if (mc[0].Groups.Count == 3)
            {
                return String.Format("{0} {1}", mc[0].Groups["first"], mc[0].Groups["second"]);
            }
            else if (mc[0].Groups.Count == 4)
            {
                return String.Format("{0} {1} {2}", mc[0].Groups["first"], mc[0].Groups["second"], mc[0].Groups["third"]);
            }
        }
        return number;
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T13:42:18.600

我很想使用一套更严格的规则，只检查熊市最小值；因此，假设前导零在数据库中，伪代码将是：

```
if( phoneNumber.substring(1,1) == "2" )
{
    // 000 0000 0000
}
else if( phoneNumber.substring(1,1) == "1" && (phoneNumber.substring(1,1) == "2" || phoneNumber.substring(3,1) = "1") )
{
    // 0000 000 0000
}
else
{
    // 00000 000000
} 
```

注意。你的图案有点错误 023 是一个三位数的代码，而 0800 不是

# c# - 编码标准维基

> ID：472882
> 
> 赞同：8
> 
> 时间：2009-01-23T13:32:33.580
> 
> 标签：c#, wiki-engine

在我的工作地点，我负责创建编码标准文档。通常，我们在一定程度上遵循 FxCop 和 StyleCop 工具报告的内容，但我们真正需要的是解释何时使用约定、为什么甚至是简单示例的文档。

将来也可以将其扩展到其他目的。

我想到的第一件事是拥有一个内部 wiki 站点，我们可以随着时间的推移轻松构建和更改，但我以前从未使用过基于 wiki 的引擎，并且想要一些建议。

如果可能的话，引擎应该在 C# 中，以便我们能够根据需要对其进行调整。

如果您认为 wiki 解决方案是解决此问题的错误方法，请提供替代方案:)

* * *

**更新**

我刚刚被告知，虽然我们确实有一个 php 服务器，但它不会留下来，所以恐怕基于 php 的 wiki 想法已经不在讨论范围内了。

* * *

**更新 2**

您能否（如果可能）让我知道这些解决方案是否适用于 Active Directory？

干杯托尼

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T14:19:21.393

[ScrewTurn Wiki](http://www.screwturn.eu/)是一个用 C# 和 ASP.Net 制作的免费开源 wiki。可以使用不同的数据库后端，例如 MSSQL 和 MySQL，但也可以在没有任何数据库的情况下工作。它有[几个插件](http://www.screwturn.eu/UsersPlugins.ashx#Users_Storage_Providers_32)可以与 Active Directory 一起使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T15:26:53.960

## Mindtouch Deki

很棒的 wiki，它建立在 C# 和 PHP 之上，因此您可以在 Mono 或 .NET 上使用它。它还具有 Active Directory 集成。

下载他们现成的 VMware 映像。它开始在我自己的 PC 上使用它，然后在他们准备好后将它移到公司的 VMware 服务器上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T13:35:47.160

我们在我的商店保留了一个内部 wiki，其中包含我们几乎所有的文档（不仅仅是编码标准）。我们并没有真正看到需要推出自己的产品，所以我们只使用了[MediaWiki](http://www.mediawiki.org/) ...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T13:54:30.463

我们使用 JAMWiki 并喜欢它。

这是一个可靠的应用程序，我们只与应用程序和开发人员进行了良好的交互。

你维护代码的人在回答问题和帮助用户方面做得很好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T15:10:10.543

Brad Abrams 发布了一组在线 C# 编码标准：

[http://blogs.msdn.com/brada/articles/361363.aspx](http://blogs.msdn.com/brada/articles/361363.aspx)

如果您访问 Microsoft ASP.NET 站点的入门工具包部分，您会发现有几个 wiki 可供下载，例如 ScrewTurn 和 Flexwiki。一个 wiki 将非常适合您的需求 :-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T13:45:15.270

我第二个 MediaWiki。它不是 C#，但它可以成为通过后门偷偷进入一些免费软件的好借口。

但是，如果你们是 Microsoft 商店，并且正在使用 Sharepoint，那么它具有一些内置的 wiki 式功能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T13:47:58.120

在我开发的一个项目中，我设置了一个 MediaWiki wiki 用于开发文档，一个用于在线帮助。

我什至直接从源代码和数据库[生成](http://devio.wordpress.com/2009/01/07/automatically-generate-mediawiki-documentation-of-ms-sql-database/)部分开发文档。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T13:50:03.217

在我所在的商店，他们使用了一个非常好的商业包：[Confluence](http://www.atlassian.com/software/confluence/)。特别好的是它与 LDAP/AD 集成，因此您不需要单独的登录，而且它的构建特别考虑了商业用途，并且有很多免费插件。我们不能没有它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-23T15:12:39.837

当您说您没有 php 服务器时，我对您的意思感到困惑。它在人类已知的每个平台上运行。我注意到大多数 Visual Studio 开发人员不知道 PHP 在 IIS 上运行。

我会选择 mediawiki 它拥有最大的功能集和为其开发的大多数附加组件，以防您需要将数据移植到其他地方。如果你需要修改你的维基，那你就做错了。

# excel - 通过 http 从 Excel 2007 连接到 SSAS 2005：如何让它询问用户名和密码？

> ID：472884
> 
> 赞同：0
> 
> 时间：2009-01-23T13:33:30.880
> 
> 标签：excel, iis, authentication, ssas, business-intelligence

我试图让我的用户通过 Internet 使用 Excel 2007 连接到 SSAS 2005 中的 OLAP 多维数据集。

我已经使用多维数据集中的事实表设置了动态安全性。它使用 UserName 函数，因此用户应该使用 windows 帐户对 SSAS 进行身份验证。我在 IIS 上设置了 msmdpump.dll 组件，允许 Windows 身份验证，但不是匿名身份验证。我在 web/SSAS 服务器上为远程用户创建了 windows 帐户。我的用户机器不受我控制，我无法使用 pass-through windows 身份验证。

现在，如果我在 Excel 中创建连接并在其中保存用户名和密码，一切正常。但我希望用户从我的网站下载没有嵌入凭据的 Excel 文件，然后能够输入他们的凭据。最好的选择是他们是否会在打开 Excel 文件时输入密码。

问题是，只要我清除连接属性中的复选框“保存密码”，或从连接字符串中删除“用户 ID”/“密码”属性，Excel 就会出现身份验证错误并且不保存连接属性。所以我无法创建没有嵌入凭据的模板文档或连接文件。

此外，我怀疑 Excel 无论如何都不会要求用户输入登录名/密码。

你知道我的问题的解决方案吗？也许一些解决方法/替代方法？我很感激任何帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T07:05:43.347

真的很难得到你想要的工作，如果有的话。我认为它不会像你想要的那样“通过互联网”工作。他们必须使用 VPN。他们的机器不必在网络上，但他们仍然可以通过 AD 凭据。

[http://blog.stevienova.com/2008/01/14/how-to-connect-to-sql-server-vs-tfs-etc-using-windows-authentication-when-computer-is-not-on-活动目录域 xp 和 vista/](http://blog.stevienova.com/2008/01/14/how-to-connect-to-sql-server-vs-tfs-etc-using-windows-authentication-when-computer-is-not-on-active-directory-domain-xp-and-vista/)

还有其他选项可以通过其他方式（SSRS、Excel Services、通过 Web 的第 3 方 OLAP）公开多维数据集，让您可以做您想做的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-16T16:58:27.877

这里有一些值得尝试的东西——在你的连接字符串中，去掉用户名和密码并添加'prompt=1;'。这将强制 Excel 在尝试对其进行身份验证之前询问用户的凭据，而不是仅使用空凭据进行身份验证。

# javascript - 使用 JQuery 获取自定义工具提示

> ID：472892
> 
> 赞同：4
> 
> 时间：2009-01-23T13:36:08.003
> 
> 标签：javascript, jquery, tooltip

我正在寻找用于在光标悬停在元素上时显示工具提示的 JQuery 代码示例或库。具体来说，我想做的是在悬停时显示我自己的 <div> 元素，而不是自动构建或从主机元素加载的工具提示。我查看了几个 JQuery 工具提示插件，它们似乎都无法做到这一点，但在其他方面非常复杂。这似乎只需要几行 JS/JQuery 就可以完成，但我也找不到任何可用的教程。

一个理想的解决方案还可以处理边框附近的工具提示，具有“粘性工具提示”选项，可以选择使用 AJAX 加载 HTML 以显示为工具提示（与 HTML/JS 中的内联相反），并处理好大量的工具提示（当然一次只显示一个）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-23T14:06:50.687

好吧，我无法为您提供完整的解决方案，但让 div 显示为工具提示非常简单：

```
(function($){

    var $div = $('<div/>').css({
        position: 'absolute',
        background: 'white',
        border: '1px solid black',
        padding: '10px',
        zIndex: 999,
        display: 'none'
    }).appendTo('body');

    $('a.tooltip')
        .mousemove(function(e){
            $div.css({
                top: e.pageY + 10 + 'px',
                left: e.pageX + 10 + 'px'
            });
        })
        .hover(function(){
            $div.show().html('Text to display...');
        }, function(){
            $div.hide();
        });

})(jQuery); 
```

一个例子-> [http://jsbin.com/emoso](http://jsbin.com/emoso)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T17:17:25.827

[jquery tooltip 插件](http://bassistance.de/jquery-plugins/jquery-plugin-tooltip/)似乎可以做所有你想做的事。您可以使用`bodyHandler: function()`来定义工具提示应该是什么。它可以是您定义的 div（甚至可以在即将显示时使用 ajax 填充）参见[此处](http://bassistance.de/jquery-plugins/jquery-plugin-tooltip/)的第二个示例。我不知道粘性工具提示，但这里提供了其他功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-24T09:09:25.980

我真的很喜欢[jTip](http://www.codylindley.com/blogstuff/js/jtip/)，即使在 ajax 模式下也可以很好地工作，并为内容异步加载外部资源。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T07:47:44.833

好的，我*终于*有时间重新审视这个，这就是我决定的。总的来说，我对它很满意；我注意到的唯一问题是，如果您在窗口的右下角有一个带有工具提示的元素，这样工具提示就没有空间在元素和窗口边框之间显示，它会出现在顶部当焦点在元素和弹出窗口之间翻转时，元素开始闪烁。欢迎解决这个问题的提示，或对我的 JS 风格的一般评论（我以前写过很少的 JS 代码）。

JavaScript 函数：

```
function showInfoBox(parent_index, parent) {

var parent_id = $(this).attr('id');
var infobox_id = parent_id+"_ib";
$("body").append("<div class='infobox' id='"+infobox_id+"'><p>This is an infobox for "+parent_id+"</p></div>"); //customize here
var infobox = $("#"+infobox_id);

$(this).mousemove(function(e){
    var pad = 10;
    var x = Math.min(e.pageX + pad, $(window).width() - infobox.width() - pad);
    var y = Math.min(e.pageY + pad, $(window).height() + $(window).scrollTop() - infobox.height() - pad);
    infobox.css({
        top:  y + 'px',
        left: x + 'px'
    });
})
    .hover(function(){
        infobox.show();
    }, function(){
        infobox.hide();
    }); 
```

};

在文档加载时调用的 JQuery：

```
$(".SELECTOR-FOR-STUFF-TO-GET-INFOBOXES").each(showInfoBox); 
```

所需的 CSS：

```
.infobox { display:none; position:absolute; z-index:999; /* more CSS if you like */} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-06-25T04:07:24.930

Jquery 中的简单工具提示[waqzah.wordpress.com](http://waqzah.wordpress.com)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-05-28T22:41:24.587

这是一个很棒的自定义工具提示 [https://z-progrock.com/custom-tooltip-using-jquery/](https://z-progrock.com/custom-tooltip-using-jquery/)

# iphone - iPhone SDK：欢迎视频

> ID：472893
> 
> 赞同：3
> 
> 时间：2009-01-23T13:36:39.173
> 
> 标签：iphone, objective-c, video

是的，我已经准备好在我的 iphone 应用程序启动时播放的视频。我怎样才能将它实现到我的 Xcode 项目中？

我希望它在应用程序加载后立即加载，并且在它播放之后，跟随到正确的视图控制器上，我的主要编程部分是。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-25T20:25:16.903

目前尚不清楚您在哪个部分遇到问题：

1.  播放视频并在完成时收到通知：请参阅[音频/视频编码方法中的“](http://developer.apple.com/iphone/library/codinghowtos/AudioAndVideo)[如何在我的代码中启动视频播放？](http://developer.apple.com/iphone/library/codinghowtos/AudioAndVideo/index.html#VIDEO-INITIATE_VIDEO_PLAYBACK_IN_MY_CODE) ” 。
2.  加载应用程序后立即启动它：[applicationDidFinishLaunching](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIApplicationDelegate_Protocol/Reference/Reference.html#//apple_ref/occ/intfm/UIApplicationDelegate/applicationDidFinishLaunching:)是一个很好的调用位置。

问题是在加载视频之前您会看到窗口的内容，这是一种可能的解决方法：

*   将第一帧的图像添加到窗口，并在视频结束时隐藏该图像
*   您还应该将此第一帧添加为 [Default.png](http://developer.apple.com/iphone/library/codinghowtos/Tools/#GENERAL-CREATE_THE_IMAGE_THAT_APPEARS_IN_MY_APPLICATION_S_WINDOW_ON_LAUNCH)以显示它，直到您的应用程序加载
*   您可能需要在启动时隐藏状态栏（[UIStatusBarHidden](http://developer.apple.com/iphone/library/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/PListKeys.html#//apple_ref/doc/uid/20001431-SW15)）并在电影结束时显示它（[setStatusBarHidden](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIApplication_Class/Reference/Reference.html#//apple_ref/occ/instm/UIApplication/setStatusBarHidden:animated:)）。

# java - 将 MySQL 连接器 JAR 放在我的 WAR 的 WEB-INF/lib 中，而不是放在 $CATALINA_HOME/common/lib 中？

> ID：472896
> 
> 赞同：3
> 
> 时间：2009-01-23T13:38:00.277
> 
> 标签：java, mysql, tomcat, maven-2

我即将在 Tomcat 5.5.x 服务器上使用 MySQL 和 Hibernate。

我**是否**必须放入或者可以将它与其他库依赖项一起放入我的 WAR 文件中`mysql-connector-java-[version]-bin.jar`？`$CATALINA_HOME/common/lib/``WEB-INF/lib`

将它放在我的 WAR 中会更容易`WEB-INF/lib`，因为我可以通过这种方式使用 Maven 存储库来获取它。将它放在那里而不是放在 Tomcat 的公共库目录中是否有什么大的缺点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T20:05:14.490

如果你的 jar 是通用的，那么它会在 tomcat 中全局加载。每个 webapp 都能看到它。如果你把它放在你的 webapp 中，只有你的 webapp 可以看到它。我假设 Boris 指的是如果你的全局 tomcat 配置的某些部分加载了需要 mysql 连接的东西（比如连接池），那么它将需要 jdbc 驱动程序，所以它会共同需要它。否则，没有。

我相信您可以在将其配置存储在数据库中的 tomcat 配置中设置安全配置。如果你使用它，它需要一个驱动程序。

为什么你想要 webapp/WEB-INF/lib 中的东西？好吧，因为它是模块化的，它是您的 webapp 的一部分，如果您将 webapp 移动到其他地方，它不需要额外的部分，这是您的 tomcat 安装的一部分。如果您可以将您的 webapp 直接放在一个股票 tomcat 安装中，那么维护会容易得多。另一个原因——如果你有多个 webapps，它们都会使用共同的 jars，这可能会导致库冲突和版本问题。

一般来说，尽可能少地提出共同点。即使您只有一个应用程序。

# c# - C# 我可以在列表框中显示图像吗？

> ID：472897
> 
> 赞同：19
> 
> 时间：2009-01-23T13:38:00.480
> 
> 标签：c#, winforms, listbox

C# 简而言之，我可以在列表框中显示图像吗？我有一个用户列表，我想在某些名称旁边显示一个绿色勾号，这可能吗？

谢谢

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-23T15:52:55.137

以下代码显示如何在列表框中进行自定义绘图。

```
using System.Windows.Forms;
using System.Drawing;

namespace Toolset.Controls
{
    public class CustomDrawListBox : ListBox
    {
        public CustomDrawListBox()
        {
            this.DrawMode = DrawMode.OwnerDrawVariable; // We're using custom drawing.
            this.ItemHeight = 40; // Set the item height to 40.
        }

        protected override void OnDrawItem(DrawItemEventArgs e)
        {
            // Make sure we're not trying to draw something that isn't there.
            if (e.Index >= this.Items.Count || e.Index <= -1)
                return;

            // Get the item object.
            object item = this.Items[e.Index];
            if (item == null)
                return;

            // Draw the background color depending on 
            // if the item is selected or not.
            if ((e.State & DrawItemState.Selected) == DrawItemState.Selected)
            {
                // The item is selected.
                // We want a blue background color.
                e.Graphics.FillRectangle(new SolidBrush(Color.Blue), e.Bounds);
            }
            else
            {
                // The item is NOT selected.
                // We want a white background color.
                e.Graphics.FillRectangle(new SolidBrush(Color.White), e.Bounds);
            }

            // Draw the item.
            string text = item.ToString();
            SizeF stringSize = e.Graphics.MeasureString(text, this.Font);
            e.Graphics.DrawString(text, this.Font, new SolidBrush(Color.White),
                new PointF(5, e.Bounds.Y + (e.Bounds.Height - stringSize.Height) / 2));
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T15:39:44.837

System.Windows.Forms.ListView 将很容易做到这一点。但是，如果您希望列表处于“详细信息”视图中，则可能需要比 ListBox 更努力地工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T13:51:44.540

在 WPF 中这很简单，但如果您使用的是 winforms，则无法使用 System.Windows.Forms.ListBox 控件来完成。您*可以*使用 ListView 控件或第三方控件来执行此操作。

# svn - Subversion - 异步开发周期......两个主干？

> ID：472902
> 
> 赞同：2
> 
> 时间：2009-01-23T13:39:02.710
> 
> 标签：svn

目前在我们的企业中，我们有一个我认为不是很常见的情况，或者至少我在互联网上没有找到类似的案例。我的问题是，我们的软件可以根据多个需求进行演变，而且两者的发布日期不一定一致。

我们有一个开发周期，所有软件都在“DEV”环境中开发，然后交给SQA，以便在“LAB”环境中进行测试；如果一切正常，则该软件将移至“PROD”环境。我在这里面临的问题是我不能使用单个主干，我也看不到单个分支如何工作。

例如，假设我有需求 A 和 B，一个今天发布，另一个从今天开始发布。两者都已进入 LAB 环境，但今天发布到 PROD 环境时只需要包含 A，因为我们的业务用户还不需要 B（并且它不能提前发布，因为它会给其他系统引入一些错误）。这两个需求都在不同的分支中开发（它们响应不同的需求）。在这种情况下，我的问题是我不能有一个主干，开发人员可以在其中合并以查看“DEV”环境中的两个更改，然后使用同一个主干来提供“LAB”环境，因为它的源代码尚未计划释放。

我想我还应该提到，不可能为每个分支拥有单独的开发环境，因为该软件基于 PL/SQL (Oracle)，而我们当前的测试数据库大小约为 350Mb，因此每个需求都有不同的开发环境会相当昂贵且难以管理。

任何建议或类似经验将不胜感激。

问候

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T13:56:45.183

我建议如下：

*   产品-1/
    *   树干/
    *   分支机构/
        *   特征分支/
            *   请求-A/
            *   请求-B/
        *   预实验/
        *   实验室/
        *   产品/

开发人员开始针对相应功能分支的新需求进行开发。然后，您将已决定包含在环境 LAB/ 中的功能分支重新集成到 pre-lab/，您可以在其中集成新功能的更改和来自 trunk/ 的错误修复。

一旦您知道可行（将需要一些时间，因为任何集成步骤都从多个来源合并），您就可以合并从 pre-lab/ 到 lab/ 的所有更改。当您限制自己仅从 pre-lab/ 到 lab/ 合并时，此合并将始终是干净的，即单击鼠标即可。

在 trunk/ 中，您可以将所有功能分支和错误修复合并在一起，但根据您的项目结构和软件开发流程，这可能需要进一步讨论。

一定要使用 Subversion 1.5，因为这种合并会让你迷失在旧版本的地狱中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T13:55:25.047

根据你的最后一段，你有很多泡菜。我相信最好的做法是对每个功能进行分支，并在需要/发布时将这些功能合并到主干中。我真的不知道是否有第二个最佳实践来改善你的情况（但我没那么聪明）......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T13:45:19.483

在我看来，您可以从使用分布式 VCS（git、mercurial、bazaar 等）中受益

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T13:56:59.863

在大多数情况下，您需要在启用和禁用功能的情况下测试生成的应用程序，以便您可以选择在发布时启用或禁用什么。

关键是，如果您创建一个包含两者的测试版本，然后去完全删除一个部分，无论您的版本控制系统如何，您最终可能会创建一个集成问题，您不会知道并且您已经推送了它到生产服务器。

无论您做什么，您仍然需要测试您将提供给客户的确切产品。

然后发布应该是要测试的，而不是要生产的。将要投入生产的是经过测试的版本。那时，它只是为每个版本或功能创建一个分支并合并所需内容的问题。

合并操作不需要针对所有内容。如果提交做得很好，您应该能够轻松地在分支之间合并您需要的功能（提交和/或文件）。还要注意的是，SVN 从 1.5/ 开始只能保留合并分支的历史记录

# c# - 如何在不手动指定编码的情况下获得 C# 中字符串的一致字节表示？

> ID：472906
> 
> 赞同：2310
> 
> 时间：2009-01-23T13:39:54.407
> 
> 标签：c#, .net, string, character-encoding

如何在不手动指定特定编码的情况下将 a 转换为 .NET (C#) 中的 a `string`？`byte[]`

我要加密字符串。我可以在不转换的情况下对其进行加密，但我仍然想知道为什么编码会在这里发挥作用。

另外，为什么还要考虑编码？我不能简单地获取字符串存储在哪些字节中吗？为什么依赖于字符编码？

* * *

## 回答 #1

> 赞同：1920
> 
> 时间：2012-04-30T07:44:22.893

*****与此处的答案相反，如果***不需要解释字节，则无需担心编码！**

就像您提到的那样，您的目标很简单，就是*“获取字符串存储在哪些字节中”*。
（当然，能够从字节重新构造字符串。）

**对于这些目标，老实说，我*不*明白为什么人们一直告诉你你需要编码。您当然不需要为此担心编码。**

只需这样做：

```
static byte[] GetBytes(string str)
{
    byte[] bytes = new byte[str.Length * sizeof(char)];
    System.Buffer.BlockCopy(str.ToCharArray(), 0, bytes, 0, bytes.Length);
    return bytes;
}

// Do NOT use on arbitrary bytes; only use on GetBytes's output on the SAME system
static string GetString(byte[] bytes)
{
    char[] chars = new char[bytes.Length / sizeof(char)];
    System.Buffer.BlockCopy(bytes, 0, chars, 0, bytes.Length);
    return new string(chars);
} 
```

只要您的程序（或其他程序）不尝试以某种方式*解释*字节，您显然没有提到您打算这样做，那么这种方法就**没有**错！担心编码只会无缘无故地让你的生活变得更加复杂。

**这种方法的额外好处：字符串是否包含无效字符并不重要，因为您仍然可以获取数据并重建原始字符串！**

它将以相同的方式进行编码和解码，因为您*只是在查看 bytes*。

但是，如果您使用特定的编码，它会给您编码/解码无效字符带来麻烦。

* * *

## 回答 #2

> 赞同：1133
> 
> 时间：2009-01-23T13:43:51.653

这取决于您的字符串的编码（[ASCII](http://en.wikipedia.org/wiki/ASCII)，[UTF-8](http://en.wikipedia.org/wiki/UTF-8)，...）。

例如：

```
byte[] b1 = System.Text.Encoding.UTF8.GetBytes (myString);
byte[] b2 = System.Text.Encoding.ASCII.GetBytes (myString); 
```

为什么编码很重要的一个小例子：

```
string pi = "\u03a0";
byte[] ascii = System.Text.Encoding.ASCII.GetBytes (pi);
byte[] utf8 = System.Text.Encoding.UTF8.GetBytes (pi);

Console.WriteLine (ascii.Length); //Will print 1
Console.WriteLine (utf8.Length); //Will print 2
Console.WriteLine (System.Text.Encoding.ASCII.GetString (ascii)); //Will print '?' 
```

ASCII 根本不具备处理特殊字符的能力。

在内部，.NET 框架使用[UTF-16](https://en.wikipedia.org/wiki/UTF-16)来表示字符串，因此如果您只想获取 .NET 使用的确切字节，请使用`System.Text.Encoding.Unicode.GetBytes (...)`.

有关详细信息，请参阅*[.NET Framework](http://msdn.microsoft.com/en-us/library/ms404377.aspx)* (MSDN) 中的字符编码。

* * *

## 回答 #3

> 赞同：299
> 
> 时间：2012-04-30T07:26:07.217

公认的答案非常非常复杂。为此使用包含的 .NET 类：

```
const string data = "A string with international characters: Norwegian: ÆØÅæøå, Chinese: 喂 谢谢";
var bytes = System.Text.Encoding.UTF8.GetBytes(data);
var decoded = System.Text.Encoding.UTF8.GetString(bytes); 
```

如果不需要，就不要重新发明轮子...

* * *

## 回答 #4

> 赞同：120
> 
> 时间：2009-01-23T16:36:07.173

```
BinaryFormatter bf = new BinaryFormatter();
byte[] bytes;
MemoryStream ms = new MemoryStream();

string orig = "喂 Hello 谢谢 Thank You";
bf.Serialize(ms, orig);
ms.Seek(0, 0);
bytes = ms.ToArray();

MessageBox.Show("Original bytes Length: " + bytes.Length.ToString());

MessageBox.Show("Original string Length: " + orig.Length.ToString());

for (int i = 0; i < bytes.Length; ++i) bytes[i] ^= 168; // pseudo encrypt
for (int i = 0; i < bytes.Length; ++i) bytes[i] ^= 168; // pseudo decrypt

BinaryFormatter bfx = new BinaryFormatter();
MemoryStream msx = new MemoryStream();            
msx.Write(bytes, 0, bytes.Length);
msx.Seek(0, 0);
string sx = (string)bfx.Deserialize(msx);

MessageBox.Show("Still intact :" + sx);

MessageBox.Show("Deserialize string Length(still intact): " 
    + sx.Length.ToString());

BinaryFormatter bfy = new BinaryFormatter();
MemoryStream msy = new MemoryStream();
bfy.Serialize(msy, sx);
msy.Seek(0, 0);
byte[] bytesy = msy.ToArray();

MessageBox.Show("Deserialize bytes Length(still intact): " 
   + bytesy.Length.ToString()); 
```

* * *

## 回答 #5

> 赞同：99
> 
> 时间：2009-01-23T14:03:30.180

您需要考虑编码，因为 1 个字符可以由 1个**或更多**字节（最多约 6 个）表示，并且不同的编码会以不同的方式处理这些字节。

乔尔对此有一个帖子：

> [每个软件开发人员绝对、绝对必须了解 Unicode 和字符集的绝对最低要求（没有借口！）](http://www.joelonsoftware.com/articles/Unicode.html)

* * *

## 回答 #6

> 赞同：99
> 
> 时间：2013-12-02T04:43:48.843

这是一个流行的问题。重要的是要了解作者提出的问题，以及它可能与最常见的需求不同。为了阻止在不需要的地方滥用代码，我首先回答了后者。

# 共同需求

每个字符串都有一个字符集和编码。当您将`System.String`对象转换为数组时，`System.Byte`您仍然有字符集和编码。**对于大多数用途，您会知道您需要哪种字符集和编码，而 .NET 使“复制和转换”变得简单。**只需选择合适的`Encoding`班级。

```
// using System.Text;
Encoding.UTF8.GetBytes(".NET String to byte array") 
```

转换可能需要处理目标字符集或编码不支持源中的字符的情况。您有一些选择：异常、替换或跳过。默认策略是替换“？”。

```
// using System.Text;
var text = Encoding.ASCII.GetString(Encoding.ASCII.GetBytes("You win €100")); 
                                                      // -> "You win ?100" 
```

显然，转换不一定是无损的！

注意：对于`System.String`源字符集是 Unicode。

唯一令人困惑的是 .NET 使用字符集的名称作为该字符集的一种特定编码的名称。`Encoding.Unicode`应该叫`Encoding.UTF16`。

*这就是大多数用途。如果这是您需要的，请停止阅读此处。*如果您不了解编码是什么，请参阅有趣的[Joel Spolsky 文章。](http://www.joelonsoftware.com/articles/Unicode.html)

# 特殊需要

现在，问题作者问，“每个字符串都存储为一个字节数组，对吗？为什么我不能简单地拥有这些字节？”

他不想要任何转变。

从[C# 规范](http://www.microsoft.com/en-us/download/confirmation.aspx?id=7029)：

> C# 中的字符和字符串处理使用 Unicode 编码。char 类型代表一个 UTF-16 代码单元，而 string 类型代表一个 UTF-16 代码单元序列。

因此，我们知道如果我们要求进行空转换（即，从 UTF-16 到 UTF-16），我们会得到想要的结果：

```
Encoding.Unicode.GetBytes(".NET String to byte array") 
```

但是为了避免提及编码，我们必须以另一种方式来做。如果中间数据类型是可接受的，则有一个概念上的快捷方式：

```
".NET String to byte array".ToCharArray() 
```

这并没有为我们提供所需的数据类型，但[Mehrdad 的回答](https://stackoverflow.com/a/10380166/2226988)显示了如何使用[BlockCopy](http://msdn.microsoft.com/en-us/library/system.buffer.blockcopy%28v=vs.110%29.aspx)将此 Char 数组转换为 Byte 数组。但是，这会将字符串复制两次！而且，它也明确地使用了特定于编码的代码：数据类型`System.Char`。

获取存储字符串的实际字节的唯一方法是使用指针。该`fixed`语句允许获取值的地址。从 C# 规范：

> [对于] 字符串类型的表达式，...初始化程序计算字符串中第一个字符的地址。

为此，编译器编写代码跳过字符串对象的其他部分，使用`RuntimeHelpers.OffsetToStringData`. 因此，要获取原始字节，只需创建一个指向字符串的指针并复制所需的字节数。

```
// using System.Runtime.InteropServices
unsafe byte[] GetRawBytes(String s)
{
    if (s == null) return null;
    var codeunitCount = s.Length;
    /* We know that String is a sequence of UTF-16 codeunits 
       and such codeunits are 2 bytes */
    var byteCount = codeunitCount * 2; 
    var bytes = new byte[byteCount];
    fixed(void* pRaw = s)
    {
        Marshal.Copy((IntPtr)pRaw, bytes, 0, byteCount);
    }
    return bytes;
} 
```

正如@CodesInChaos 指出的那样，结果取决于机器的字节序。但问题作者并不关心这一点。

* * *

## 回答 #7

> 赞同：48
> 
> 时间：2009-01-23T15:54:28.223

其他人已经回答了您问题的第一部分（如何获取字节）：查看`System.Text.Encoding`命名空间。

我将解决您的后续问题：为什么需要选择编码？为什么你不能从字符串类本身得到它？

答案分为两部分。

首先，字符串类内部使用的字节*无关紧要*，无论何时假设它们确实存在，您都可能会引入错误。

如果您的程序完全在 .Net 世界中，那么您根本不需要担心获取字符串的字节数组，即使您正在通过网络发送数据。相反，使用 .Net 序列化来担心传输数据。您不再担心实际字节数：序列化格式化程序会为您完成。

另一方面，如果您将这些字节发送到您无法保证会从 .Net 序列化流中提取数据的地方怎么办？在这种情况下，您肯定需要担心编码，因为显然这个外部系统很关心。同样，字符串使用的内部字节无关紧要：您需要选择一种编码，以便您可以在接收端明确说明此编码，即使它与 .Net 内部使用的编码相同。

我知道在这种情况下，您可能更喜欢尽可能使用由字符串变量存储在内存中的实际字节，这样可以节省一些创建字节流的工作。但是，我告诉您，与确保您的输出在另一端被理解并保证您*必须*明确编码相比，这并不重要。此外，如果您真的想匹配您的内部字节，您已经可以选择`Unicode`编码，并获得性能节省。

这让我进入了第二部分……选择`Unicode`编码***是***告诉 .Net 使用底层字节。您确实需要选择这种编码，因为当一些新奇的 Unicode-Plus 出现时，.Net 运行时需要在不破坏程序的情况下自由使用这种更新、更好的编码模型。但是，目前（以及可预见的未来），只需选择 Unicode 编码即可满足您的需求。

了解您的字符串必须重新写入线路也很重要，*即使您使用匹配的编码*，这也至少涉及位模式的一些翻译。计算机需要考虑大字节序与小字节序、网络字节顺序、数据包化、会话信息等。

* * *

## 回答 #8

> 赞同：44
> 
> 时间：2012-04-30T12:50:32.997

只是为了证明 Mehrdrad 的正确[答案](https://stackoverflow.com/a/10380166)有效，他的方法甚至可以保留[未配对的代理字符](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.formatters.binary.binaryformatter%28v=VS.100%29.aspx)（其中许多人反对我的答案，但每个人都同样有罪，例如`System.Text.Encoding.UTF8.GetBytes`，`System.Text.Encoding.Unicode.GetBytes`；那些编码方法不能保留高代理例如字符`d800`，那些只是用 value `fffd`) 替换高代理字符：

```
using System;

class Program
{     
    static void Main(string[] args)
    {
        string t = "爱虫";            
        string s = "Test\ud800Test"; 

        byte[] dumpToBytes = GetBytes(s);
        string getItBack = GetString(dumpToBytes);

        foreach (char item in getItBack)
        {
            Console.WriteLine("{0} {1}", item, ((ushort)item).ToString("x"));
        }    
    }

    static byte[] GetBytes(string str)
    {
        byte[] bytes = new byte[str.Length * sizeof(char)];
        System.Buffer.BlockCopy(str.ToCharArray(), 0, bytes, 0, bytes.Length);
        return bytes;
    }

    static string GetString(byte[] bytes)
    {
        char[] chars = new char[bytes.Length / sizeof(char)];
        System.Buffer.BlockCopy(bytes, 0, chars, 0, bytes.Length);
        return new string(chars);
    }        
} 
```

输出：

```
T 54
e 65
s 73
t 74
? d800
T 54
e 65
s 73
t 74 
```

尝试使用**System.Text.Encoding.UTF8.GetBytes**或**System.Text.Encoding.Unicode.GetBytes**，它们只会用值**fffd替换高代理字符**

每次这个问题有动静时，我仍然在考虑一个序列化程序（无论是来自微软还是来自 3rd 方组件），它可以保留字符串，即使它包含不成对的代理字符；我时不时地在谷歌上搜索：**序列化未配对代理字符 .NET**。这不会让我失去任何睡眠，但是当不时有人评论我的答案有缺陷时，这有点烦人，但当涉及到不成对的代理字符时，他们的答案同样有缺陷。

该死，微软应该只是用`System.Buffer.BlockCopy`在它的`BinaryFormatter`ツ</p>

谢谢！</p>

* * *

## 回答 #9

> 赞同：41
> 
> 时间：2011-07-25T22:52:28.293

试试这个，代码少了很多：

```
System.Text.Encoding.UTF8.GetBytes("TEST String"); 
```

* * *

## 回答 #10

> 赞同：25
> 
> 时间：2011-03-10T08:57:30.417

好吧，我已经阅读了所有答案，它们是关于使用编码或关于丢弃未配对代理的序列化的。

例如，当字符串来自[SQL Server](http://en.wikipedia.org/wiki/Microsoft_SQL_Server)时，它是不好的，它是从存储例如密码哈希的字节数组构建的。如果我们从中删除任何内容，它将存储一个无效的散列，如果我们想将它存储在 XML 中，我们希望保持它完整（因为 XML 编写器在它找到的任何未配对的代理项上删除一个异常）。

所以我在这种情况下使用字节数组的[Base64](http://en.wikipedia.org/wiki/Base64)编码，但是，在互联网上，C#中只有一种解决方案，而且它有错误并且只有一种方式，所以我已经修复了错误并写回程序。在这里，未来的谷歌人：

```
public static byte[] StringToBytes(string str)
{
    byte[] data = new byte[str.Length * 2];
    for (int i = 0; i < str.Length; ++i)
    {
        char ch = str[i];
        data[i * 2] = (byte)(ch & 0xFF);
        data[i * 2 + 1] = (byte)((ch & 0xFF00) >> 8);
    }

    return data;
}

public static string StringFromBytes(byte[] arr)
{
    char[] ch = new char[arr.Length / 2];
    for (int i = 0; i < ch.Length; ++i)
    {
        ch[i] = (char)((int)arr[i * 2] + (((int)arr[i * 2 + 1]) << 8));
    }
    return new String(ch);
} 
```

* * *

## 回答 #11

> 赞同：24
> 
> 时间：2009-07-16T11:45:14.780

> 还请解释为什么要考虑编码。我不能简单地获取字符串存储在哪些字节中吗？为什么要依赖编码？！！！

因为没有“字符串的字节”之类的东西。

字符串（或更一般地，文本）由字符组成：字母、数字和其他符号。就这样。然而，计算机对字符一无所知。他们只能处理字节。因此，如果要使用计算机存储或传输文本，则需要将字符转换为字节。你是怎样做的？这就是编码出现的地方。

编码只不过是将逻辑字符转换为物理字节的约定。最简单和最著名的编码是 ASCII，如果你用英语写作，它就是你所需要的。对于其他语言，您将需要更完整的编码，因为任何 Unicode 风格都是当今最安全的选择。

因此，简而言之，尝试“在不使用编码的情况下获取字符串的字节”与“在不使用任何语言的情况下编写文本”一样不可能。

顺便说一句，我强烈建议您（以及任何人，就此而言）阅读这个小智慧：[每个软件开发人员绝对、肯定必须了解 Unicode 和字符集的绝对最低要求（没有借口！）](http://www.joelonsoftware.com/articles/Unicode.html)

* * *

## 回答 #12

> 赞同：22
> 
> 时间：2013-06-05T10:52:33.063

C# 将 a 转换`string`为`byte`数组：

```
public static byte[] StrToByteArray(string str)
{
   System.Text.UTF8Encoding  encoding=new System.Text.UTF8Encoding();
   return encoding.GetBytes(str);
} 
```

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2009-01-23T13:43:18.317

```
byte[] strToByteArray(string str)
{
    System.Text.ASCIIEncoding enc = new System.Text.ASCIIEncoding();
    return enc.GetBytes(str);
} 
```

* * *

## 回答 #14

> 赞同：17
> 
> 时间：2014-09-09T11:30:51.740

您可以使用以下代码在字符串和字节数组之间进行转换。

```
string s = "Hello World";

// String to Byte[]

byte[] byte1 = System.Text.Encoding.Default.GetBytes(s);

// OR

byte[] byte2 = System.Text.ASCIIEncoding.Default.GetBytes(s);

// Byte[] to string

string str = System.Text.Encoding.UTF8.GetString(byte1); 
```

* * *

## 回答 #15

> 赞同：17
> 
> 时间：2018-01-10T20:21:12.383

随着[`Span<T>`](https://github.com/dotnet/corefxlab/blob/master/docs/specs/span.md)C# 7.2 的发布，将字符串的底层内存表示捕获到托管字节数组中的规范技术是：

```
byte[] bytes = "rubbish_\u9999_string".AsSpan().AsBytes().ToArray(); 
```

将其转换回来应该是一个非首发，因为这意味着您实际上是在以某种方式解释数据，但为了完整起见：

```
string s;
unsafe
{
    fixed (char* f = &bytes.AsSpan().NonPortableCast<byte, char>().DangerousGetPinnableReference())
    {
        s = new string(f);
    }
} 
```

名称`NonPortableCast`和`DangerousGetPinnableReference`应该进一步说明您可能不应该这样做。

*请注意，使用`Span<T>`需要安装[System.Memory NuGet 包](https://www.nuget.org/packages/System.Memory)。*

无论如何，*实际*的原始问题和后续评论暗示底层内存没有被“解释”（我认为这意味着没有修改或读取超出按原样编写的需要），表明`Stream`该类的某些实现应该使用而不是将数据作为字符串进行推理。

* * *

## 回答 #16

> 赞同：13
> 
> 时间：2009-01-23T14:34:03.033

我不确定，但我认为字符串将其信息存储为一个字符数组，这对字节来说效率低下。具体来说，Char 的定义是“表示 Unicode 字符”。

以这个示例为例：

```
String str = "asdf éß";
String str2 = "asdf gh";
EncodingInfo[] info =  Encoding.GetEncodings();
foreach (EncodingInfo enc in info)
{
    System.Console.WriteLine(enc.Name + " - " 
      + enc.GetEncoding().GetByteCount(str)
      + enc.GetEncoding().GetByteCount(str2));
} 
```

请注意，Unicode 答案在这两种情况下都是 14 个字节，而 UTF-8 答案对于第一个只有 9 个字节，而对于第二个只有 7 个字节。

因此，如果您只想要字符串使用的字节，只需使用`Encoding.Unicode`，但存储空间效率低下。

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2009-01-23T14:15:26.893

关键问题是字符串中的字形需要 32 位（字符代码为 16 位），但一个字节只有 8 位可用。除非您将自己限制为仅包含 ASCII 字符的字符串，否则不存在一对一映射。System.Text.Encoding 有很多方法可以将字符串映射到 byte[]，您需要选择一种可以避免信息丢失并且在客户需要将 byte[] 映射回字符串时易于使用的方法.

Utf8 是一种流行的编码，它紧凑且无损耗。

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2013-10-22T12:55:59.147

采用：

```
 string text = "string";
    byte[] array = System.Text.Encoding.UTF8.GetBytes(text); 
```

结果是：

```
[0] = 115
[1] = 116
[2] = 114
[3] = 105
[4] = 110
[5] = 103 
```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2010-03-22T08:40:52.830

**最快的方式**

```
public static byte[] GetBytes(string text)
{
    return System.Text.ASCIIEncoding.UTF8.GetBytes(text);
} 
```

***编辑*** Makotosan 评论这是现在最好的方法：

```
Encoding.UTF8.GetBytes(text) 
```

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2015-08-18T17:04:21.073

最接近 OP 问题的方法是 Tom Blodget，它实际上进入对象并提取字节。我说最接近是因为它取决于字符串对象的实现。

```
"Can't I simply get what bytes the string has been stored in?" 
```

当然，但这就是问题的根本错误出现的地方。String 是一个可以具有有趣数据结构的对象。我们已经知道它确实如此，因为它允许存储未配对的代理。它可能会存储长度。它可能会保留一个指向每个“配对”代理的指针，从而允许快速计数。等等。所有这些额外的字节都不是字符数据的一部分。

你想要的是数组中每个字符的字节。这就是“编码”的用武之地。默认情况下，您将获得 UTF-16LE。如果除了往返之外您不关心字节本身，那么您可以选择包括“默认”在内的任何编码，并稍后将其转换回来（假设相同的参数，例如默认编码是什么、代码点、错误修复，允许的事情，例如未配对的代理等。

但是为什么要把“编码”交给魔法呢？为什么不指定编码以便您知道要获得哪些字节？

```
"Why is there a dependency on character encodings?" 
```

编码（在此上下文中）仅表示代表您的字符串的字节。不是字符串对象的字节。您想要存储字符串的字节——这是天真地提出问题的地方。您希望字符串的字节位于表示字符串的连续数组中，而不是字符串对象可能包含的所有其他二进制数据。

这意味着如何存储字符串是无关紧要的。您希望将字符串“编码”成字节数组中的字节。

我喜欢 Tom Bloget 的回答，因为他将您带到了“字符串对象的字节”方向。虽然它依赖于实现，并且因为他正在窥视内部，所以可能很难重建字符串的副本。

Mehrdad 的回答是错误的，因为它在概念层面具有误导性。您仍然有一个经过编码的字节列表。他的特殊解决方案允许保留未配对的代理——这取决于实现。`GetBytes`如果默认情况下以 UTF-8 格式返回字符串，他的特定解决方案将无法准确生成字符串的字节。

* * *

我已经改变了主意（Mehrdad 的解决方案）——这没有得到字符串的字节；而是获取从字符串创建的字符数组的字节。无论编码如何，c# 中的 char 数据类型都是固定大小的。这允许产生一致长度的字节数组，并且允许基于字节数组的大小来再现字符数组。因此，如果编码是 UTF-8，但每个 char 是 6 个字节以容纳最大的 utf8 值，它仍然可以工作。确实如此——字符的编码并不重要。

但是使用了转换——每个字符都被放入一个固定大小的框（c# 的字符类型）。但是，该表示是什么并不重要，这在技术上是 OP 的答案。所以 - 如果你无论如何都要转换......为什么不'编码'？

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2018-07-02T20:51:49.343

> 如何在不手动指定特定编码的情况下将字符串转换为 .NET (C#) 中的 byte[]？

.NET 中的[字符串](https://msdn.microsoft.com/en-us/library/system.string(v=vs.110).aspx)将文本表示为 UTF-16 代码单元序列，因此字节已在内存中以 UTF-16 编码。

**迈赫达德的回答**

您可以使用[Mehrdad 的答案](https://stackoverflow.com/a/10380166/369792)，但它确实使用了编码，因为字符是 UTF-16。它调用 ToCharArray ，它查看[源](https://referencesource.microsoft.com/#mscorlib/system/string.cs,d78d4544220d96be)创建 a`char[]`并将内存直接复制到它。然后它将数据复制到也分配的字节数组中。因此，在后台，它复制了*两次*底层字节并分配了一个在调用后未使用的 char 数组。

**汤姆布洛杰特的回答**

[Tom Blodget 的答案](https://stackoverflow.com/a/20321003/369792)比 Mehrdad 快 20-30%，因为它跳过了分配 char 数组并将字节复制到其中的中间步骤，但它需要您使用该`/unsafe`选项进行编译。如果您绝对不想使用编码，我认为这是要走的路。如果你把你的加密登录放在`fixed`块中，你甚至不需要分配一个单独的字节数组并将字节复制到它。

> 另外，为什么要考虑编码？我不能简单地获取字符串存储在哪些字节中吗？为什么依赖于字符编码？

因为这是正确的做法。 `string`是一个抽象。

如果您有包含无效字符的“字符串”，使用编码可能会给您带来麻烦，但这不应该发生。如果您使用无效字符将数据放入字符串中，那么您做错了。您可能应该使用字节数组或 Base64 编码开始。

如果您使用`System.Text.Encoding.Unicode`，您的代码将更有弹性。您不必担心您的代码将在其上运行的系统的[字节顺序。](https://en.wikipedia.org/wiki/Endianness)如果下一个版本的 CLR 将使用不同的内部字符编码，您不必担心。

我认为问题不是你为什么要担心编码，而是你为什么要忽略它并使用其他东西。编码旨在以字节序列表示字符串的抽象。 `System.Text.Encoding.Unicode`将为您提供一点字节序编码，并将在现在和将来的每个系统上执行相同的操作。

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2013-09-02T11:21:11.793

您可以使用以下代码将 a 转换`string`为`byte array`.NET

```
string s_unicode = "abcéabc";
byte[] utf8Bytes = System.Text.Encoding.UTF8.GetBytes(s_unicode); 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2014-11-25T10:29:12.390

如果你真的想要一个字符串的底层字节的副本，你可以使用一个类似下面的函数。**但是，您不应该**继续阅读以找出原因。

```
[DllImport(
        "msvcrt.dll",
        EntryPoint = "memcpy",
        CallingConvention = CallingConvention.Cdecl,
        SetLastError = false)]
private static extern unsafe void* UnsafeMemoryCopy(
    void* destination,
    void* source,
    uint count);

public static byte[] GetUnderlyingBytes(string source)
{
    var length = source.Length * sizeof(char);
    var result = new byte[length];
    unsafe
    {
        fixed (char* firstSourceChar = source)
        fixed (byte* firstDestination = result)
        {
            var firstSource = (byte*)firstSourceChar;
            UnsafeMemoryCopy(
                firstDestination,
                firstSource,
                (uint)length);
        }
    }

    return result;
} 
```

此函数将很快为您获取字符串底层字节的副本。您将以它们在系统上编码的任何方式获取这些字节。这种编码几乎可以肯定是 UTF-16LE，但这是您不必关心的实现细节。

打电话会**更安全、更简单、更可靠**，

```
System.Text.Encoding.Unicode.GetBytes() 
```

这很可能会给出相同的结果，更容易键入，并且字节将往返，以及 Unicode 中的字节表示可以调用

```
System.Text.Encoding.Unicode.GetString() 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2013-01-15T11:43:42.873

这是我`String`对`Byte[]`转换的不安全实现：

```
public static unsafe Byte[] GetBytes(String s)
{
    Int32 length = s.Length * sizeof(Char);
    Byte[] bytes = new Byte[length];

    fixed (Char* pInput = s)
    fixed (Byte* pBytes = bytes)
    {
        Byte* source = (Byte*)pInput;
        Byte* destination = pBytes;

        if (length >= 16)
        {
            do
            {
                *((Int64*)destination) = *((Int64*)source);
                *((Int64*)(destination + 8)) = *((Int64*)(source + 8));

                source += 16;
                destination += 16;
            }
            while ((length -= 16) >= 16);
        }

        if (length > 0)
        {
            if ((length & 8) != 0)
            {
                *((Int64*)destination) = *((Int64*)source);

                source += 8;
                destination += 8;
            }

            if ((length & 4) != 0)
            {
                *((Int32*)destination) = *((Int32*)source);

                source += 4;
                destination += 4;
            }

            if ((length & 2) != 0)
            {
                *((Int16*)destination) = *((Int16*)source);

                source += 2;
                destination += 2;
            }

            if ((length & 1) != 0)
            {
                ++source;
                ++destination;

                destination[0] = source[0];
            }
        }
    }

    return bytes;
} 
```

它比公认的 anwser 快得多，即使不像它那样优雅。这是我超过 10000000 次迭代的秒表基准测试：

```
[Second String: Length 20]
Buffer.BlockCopy: 746ms
Unsafe: 557ms

[Second String: Length 50]
Buffer.BlockCopy: 861ms
Unsafe: 753ms

[Third String: Length 100]
Buffer.BlockCopy: 1250ms
Unsafe: 1063ms 
```

为了使用它，您必须在项目构建属性中勾选“允许不安全代码”。根据 .NET Framework 3.5，此方法也可以用作字符串扩展：

```
public static unsafe class StringExtensions
{
    public static Byte[] ToByteArray(this String s)
    {
        // Method Code
    }
} 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2019-09-11T04:21:53.510

在被问及您打算如何处理这些字节时，您[回答](https://stackoverflow.com/questions/472906/how-do-i-get-a-consistent-byte-representation-of-strings-in-c-sharp-without-manu?rq=1#comment290510_472906)：

> 我要加密它。我可以在不转换的情况下对其进行加密，但我仍然想知道为什么要在这里使用编码。只要给我字节就是我所说的。

无论您是打算通过网络发送此加密数据，稍后将其加载回内存，还是将其流式传输到另一个进程，您显然都打算在某个时候对其进行*解密。*在这种情况下，答案是您正在定义一个通信协议。不应根据您的编程语言及其相关运行时的实现细节来**定义通信协议。**有几个原因：

*   您可能需要与以不同语言或运行时实现的流程进行通信。（例如，这可能包括在另一台机器上运行的服务器或将字符串发送到 JavaScript 浏览器客户端。）
*   该程序将来可能会以不同的语言或运行时重新实现。
*   .NET 实现可能会更改字符串的内部表示。您可能认为这听起来有些牵强，但这[实际上发生在 Java 9](https://www.vojtechruzicka.com/java-9-compact-strings/)中以减少内存使用。.NET 没有理由不效仿。[Skeet 认为](https://stackoverflow.com/a/14942142/1394393)UTF-16 今天可能不是最优的，因为 emoji 和其他 Unicode 块也需要超过 2 个字节来表示，这增加了内部表示在未来可能发生变化的可能性。

对于通信（与完全不同的进程或将来与相同的程序），您需要**严格**定义您的协议，以尽量减少使用它的难度或意外产生错误。依赖于.NET 的内部表示不是一个严格的、清晰的，甚至是不保证是一致的定义。标准编码*是*一个严格的定义，将来不会让您失望。

**换句话说，如果不指定编码，您将无法满足您对*一致性的要求。***

如果您发现由于 .NET 在内部使用它或出于任何其他原因，您的进程性能明显更好，您*当然可以*选择直接使用 UTF-16，但您需要显式选择该编码并在代码中显式执行这些转换，而不是依赖关于 .NET 的内部实现。

所以选择一种编码并使用它：

```
using System.Text;

// ...

Encoding.Unicode.GetBytes("abc"); # UTF-16 little endian
Encoding.UTF8.GetBytes("abc") 
```

如您所见，与实现您自己的读取器/写入器方法相比，仅使用内置编码对象实际上也需要更少的代码。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2014-06-11T11:29:06.703

由于以下事实，可以通过几种不同的方式将字符串转换为字节数组：.NET 支持 Unicode，并且 Unicode 标准化了几种称为 UTF 的不同编码。它们具有不同长度的字节表示，但在这个意义上是等效的，当一个字符串被编码时，它可以被编码回字符串，但是如果字符串是用一个 UTF 编码并在假设不同的 UTF 的情况下解码，如果可以被搞砸向上。

此外，.NET 支持非 Unicode 编码，但它们在一般情况下无效（仅当在实际字符串（例如 ASCII）中使用有限的 Unicode 代码点子集时才有效）。在内部，.NET 支持 UTF-16，但对于流表示，通常使用 UTF-8。它也是 Internet 的标准事实。

毫不奇怪，将 string 序列化为字节数组和反序列化由 class 支持，该 class`System.Text.Encoding`是一个抽象类；它的派生类支持具体的编码：`ASCIIEncoding`和四个 UTF（`System.Text.UnicodeEncoding`支持 UTF-16）

参考[这个链接。](http://msdn.microsoft.com/en-us/library/system.text.encoding.aspx)

使用 . 序列化为字节数组`System.Text.Encoding.GetBytes`。对于逆运算使用`System.Text.Encoding.GetChars`. 此函数返回一个字符数组，因此要获取字符串，请使用字符串构造函数`System.String(char[])`。
[参考这个页面。](http://unicode.org/,%20http://unicode.org/faq/utf_bom.html)

例子：

```
string myString = //... some string

System.Text.Encoding encoding = System.Text.Encoding.UTF8; //or some other, but prefer some UTF is Unicode is used
byte[] bytes = encoding.GetBytes(myString);

//next lines are written in response to a follow-up questions:

myString = new string(encoding.GetChars(bytes));
byte[] bytes = encoding.GetBytes(myString);
myString = new string(encoding.GetChars(bytes));
byte[] bytes = encoding.GetBytes(myString);

//how many times shall I repeat it to show there is a round-trip? :-) 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2017-11-08T18:21:31.230

# 这取决于你想要的字节 FOR

这是因为，正如泰勒[所说](https://chat.stackoverflow.com/transcript/message/39942929#39942929)的那样，“字符串不是纯粹的数据。它们也有[信息](http://www.diffen.com/difference/Data_vs_Information)。” 在这种情况下，信息是在创建字符串时假定的编码。

### 假设您将二进制数据（而不是文本）存储在字符串中

*这是基于 OP 对他自己的问题的评论，如果我理解 OP 对用例的提示，这是正确的问题。*

由于上面提到的假设编码，将二进制数据存储在字符串中可能是错误的方法！无论将二进制数据存储在 a `string`（而不是`byte[]`更合适的数组）中的任何程序或库都已经在战斗开始之前就输了。如果他们以 REST 请求/响应或任何*必须*传输字符串的方式向您发送字节，那么[Base64](https://stackoverflow.com/q/201479/1739000)将是正确的方法。

### 如果您有一个编码未知的文本字符串

*其他人都错误地回答了这个不正确的问题。*

如果字符串看起来不错，只需选择一种编码（最好是以 UTF 开头的编码），使用相应的`System.Text.Encoding.???.GetBytes()`函数，并告诉谁您将字节提供给您选择的编码。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2020-08-03T20:44:13.290

如果您将**.NET Core**或**System.Memory**用于**.NET Framework**，则可以通过**Span<T>**和**Memory<T>**获得一种非常有效的封送机制，可以有效地将字符串内存重新解释为字节范围。一旦你有了一个字节跨度，你就可以自由地编组回另一种类型，或者将跨度复制到一个数组中进行序列化。

总结一下其他人所说的话：

*   存储这种序列化的表示对系统字节顺序、编译器优化以及对正在执行的 .NET 运行时中字符串的内部表示的更改很敏感。
    *   避免长期存放
    *   避免在其他环境中反序列化或解释字符串
        *   这包括其他机器、处理器架构、.NET 运行时、容器等。
        *   这包括比较、格式化、加密、字符串操作、本地化、字符转换等。
    *   避免对字符编码做出假设
        *   默认编码在实践中往往是**UTF-16LE**，但编译器/运行时可以选择任何内部表示

## 执行

```
public static class MarshalExtensions
{
   public static ReadOnlySpan<byte> AsBytes(this string value) => MemoryMarshal.AsBytes(value.AsSpan());
   public static string AsString(this ReadOnlySpan<byte> value) => new string(MemoryMarshal.Cast<byte, char>(value));
} 
```

## 例子

```
static void Main(string[] args)
{
    string str1 = "你好，世界&quot;;
    ReadOnlySpan<byte> span = str1.AsBytes();
    string str2 = span.AsString();

    byte[] bytes = span.ToArray();

    Debug.Assert(bytes.Length > 0);
    Debug.Assert(str1 == str2);
} 
```

## 进一步的洞察力

在 C++ 中，这大致相当于**reinterpret_cast**，而在 C 中，这大致相当于转换为系统的单词类型（**char**）。

在最新版本的**.NET Core 运行时 (CoreCLR)**中，跨度操作有效地调用编译器内在函数和各种优化，这些优化有时可以消除边界检查，从而在保持内存安全的同时实现卓越的性能，假设您的内存是由 CLR 和跨度不是从非托管内存分配器的指针派生的。

## 注意事项

这使用 CLR 支持的机制，该机制从字符串返回**ReadOnlySpan<char> ；**此外，此跨度不一定包含完整的内部字符串布局。**ReadOnlySpan<T>**意味着如果您需要执行突变，则必须创建一个副本，因为字符串是不可变的。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2012-01-02T11:07:00.510

```
bytes[] buffer = UnicodeEncoding.UTF8.GetBytes(string something); //for converting to UTF then get its bytes

bytes[] buffer = ASCIIEncoding.ASCII.GetBytes(string something); //for converting to ascii then get its bytes 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2015-06-30T14:39:07.413

只需使用这个：

```
byte[] myByte= System.Text.ASCIIEncoding.Default.GetBytes(myString); 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2009-02-19T21:03:34.103

两种方式：

```
public static byte[] StrToByteArray(this string s)
{
    List<byte> value = new List<byte>();
    foreach (char c in s.ToCharArray())
        value.Add(c.ToByte());
    return value.ToArray();
} 
```

和，

```
public static byte[] StrToByteArray(this string s)
{
    s = s.Replace(" ", string.Empty);
    byte[] buffer = new byte[s.Length / 2];
    for (int i = 0; i < s.Length; i += 2)
        buffer[i / 2] = (byte)Convert.ToByte(s.Substring(i, 2), 16);
    return buffer;
} 
```

我倾向于使用底部比顶部更频繁，没有对它们进行速度基准测试。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2012-10-11T09:45:46.400

**使用 LINQ 的简单代码**

```
string s = "abc"
byte[] b = s.Select(e => (byte)e).ToArray(); 
```

编辑：如下所述，这不是一个好方法。

但您仍然可以使用它通过更合适的编码来理解 LINQ：

```
string s = "abc"
byte[] b = s.Cast<byte>().ToArray(); 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2014-08-28T16:14:16.993

字符既是字体表的查找键，又是词汇传统，例如排序、大小写版本等。

因此，字符不是字节（8 位），字节也不是字符。特别是，一个字节的 256 个排列不能容纳某些书面语言中的数千个符号，更不用说所有语言了。因此，已经设计了各种编码字符的方法。一些为特定类别的语言编码（ASCII 编码）；使用代码页的多种语言（扩展 ASCII）；或者，雄心勃勃地，通过根据需要选择性地包括额外的字节，所有语言，Unicode。

在诸如 .NET 框架之类的系统中，字符串意味着特定的字符编码。在 .NET 中，这种编码是 Unicode。由于框架默认读取和写入 Unicode，因此在 .NET 中通常不需要处理字符编码。

但是，一般来说，要将字符串从字节流加载到系统中，您需要知道源编码才能正确解释并随后正确翻译它（否则代码将被视为已经在系统的默认编码中并因此呈现胡言乱语）。同样，当将字符串写入外部源时，它将以特定编码写入。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2016-02-11T19:32:12.550

我编写了一个类似于接受的答案的 Visual Basic 扩展，但直接使用 .NET 内存和编组进行转换，它支持其他方法不支持的字符范围，例如`UnicodeEncoding.UTF8.GetString`或`UnicodeEncoding.UTF32.GetString`什至`MemoryStream and BinaryFormatter`（无效字符，例如：`& `ChrW(55906)`& `ChrW(55655)`）：`

 ````
<Extension> _
Public Function ToBytesMarshal(ByRef str As String) As Byte()
    Dim gch As GCHandle = GCHandle.Alloc(str, GCHandleType.Pinned)
    Dim handle As IntPtr = gch.AddrOfPinnedObject
    ToBytesMarshal = New Byte(str.Length * 2 - 1) {}
    Try
        For i As Integer = 0 To ToBytesMarshal.Length - 1
            ToBytesMarshal.SetValue(Marshal.ReadByte(IntPtr.Add(handle, i)), i)
        Next
    Finally
        gch.Free()
    End Try
End Function

<Extension> _
Public Function ToStringMarshal(ByRef arr As Byte()) As String
    Dim gch As GCHandle = GCHandle.Alloc(arr, GCHandleType.Pinned)
    Try
        ToStringMarshal = Marshal.PtrToStringAuto(gch.AddrOfPinnedObject)
    Finally
        gch.Free()
    End Try
End Function 
```

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2014-04-09T12:39:54.553

要将字符串转换为 byte[]，请使用以下解决方案：

```
string s = "abcdefghijklmnopqrstuvwxyz";
byte[] b = System.Text.UTF32Encoding.GetBytes(s); 
```

我希望它有所帮助。

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2015-01-21T14:05:34.620

从`byte[]`到`string`:

```
 return BitConverter.ToString(bytes); 
```

* * *

## 回答 #37

> 赞同：-2
> 
> 时间：2009-01-23T13:43:58.033

```
// C# to convert a string to a byte array.
public static byte[] StrToByteArray(string str)
{
    System.Text.ASCIIEncoding  encoding=new System.Text.ASCIIEncoding();
    return encoding.GetBytes(str);
}

// C# to convert a byte array to a string.
byte [] dBytes = ...
string str;
System.Text.ASCIIEncoding enc = new System.Text.ASCIIEncoding();
str = enc.GetString(dBytes); 
```

* * *

## 回答 #38

> 赞同：-4
> 
> 时间：2013-01-23T06:21:33.593

这是代码：

```
// Input string.
const string input = "Dot Net Perls";

// Invoke GetBytes method.
// ... You can store this array as a field!
byte[] array = Encoding.ASCII.GetBytes(input);

// Loop through contents of the array.
foreach (byte element in array)
{
    Console.WriteLine("{0} = {1}", element, (char)element);
} 
```

* * *

## 回答 #39

> 赞同：-5
> 
> 时间：2016-01-21T17:19:03.363

对于串行通信项目，我必须将字符串转换为字节数组 - 我必须处理 8 位字符，而且我无法找到使用框架转换器来执行此操作的方法，该方法既不添加两字节条目或错误翻译设置了第八位的字节。所以我做了以下工作：

```
string message = "This is a message.";
byte[] bytes = new byte[message.Length];
for (int i = 0; i < message.Length; i++)
    bytes[i] = (byte)message[i]; 
```

* * *

## 回答 #40

> 赞同：-12
> 
> 时间：2013-09-27T23:26:41.060

OP 的问题：“如何将 a 转换为.NET (C#)`string`中的数组？” `byte`[原文如此]

您可以使用以下代码：

```
static byte[] ConvertString (string s) {
    return new byte[0];
} 
```

作为一个好处，编码无关紧要！哦，等等，这是一个编码......它只是微不足道且高度有损。

# asp.net-mvc - 如何对依赖 Session 对象的库进行单元测试

> ID：472910
> 
> 赞同：1
> 
> 时间：2009-01-23T13:40:24.390
> 
> 标签：asp.net-mvc, unit-testing, session

我有几个使用相同控制器和模型的 asp.net mvc 网站。
这个通用逻辑放在单独的库中。这些库使用 HttpContext.Current.Session。如何使这些单元可测试？我阅读了有关 StateValue 的信息，但无法完全掌握它。我应该从哪里得到这个 StateValue 东西？它是我引用的库吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T13:50:01.110

您可以使用模拟助手，例如在[这里看到的](http://dotnetslackers.com/articles/aspnet/ASPNETMVCFrameworkPart2.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T13:59:02.217

1.  您的代码应该使用 IHttpSessionState 而不是 HttpSessionState。
2.  如果您查找 IHttpSessionState 的 MSDN 文档，您会发现一个示例实现，您可以将其提升到您的单元测试项目中以创建一个模拟会话。
3.  将获取 Session 的代码替换为返回 IHttpSessionState 的静态委托。
4.  使用使用 HttpContext.Current.Session 的函数初始化该静态委托。
5.  在单元测试期间，将委托替换为 IHttpSessionState 的 Mock 实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-09T21:30:27.570

只是为了引导人们走出这个天坑（从 .NET 3.5 开始）——不要为了模拟和测试而触摸 IHttpSessionState：

[http://www.codemerlin.com/2011/07/mocking-httpcontext-httpresponse-httprequest-httpsessionstate-etc-in-asp-net/](http://www.codemerlin.com/2011/07/mocking-httpcontext-httpresponse-httprequest-httpsessionstate-etc-in-asp-net/)

# .net - XmlDocument 和正式的公共标识符

> ID：472914
> 
> 赞同：1
> 
> 时间：2009-01-23T13:42:20.987
> 
> 标签：.net, xml, xmldocument

为什么当我将 xml 文件加载到 XmlDocument中时，我重载的 XmlResolver 中的 GetEntity 函数被传递了[正式公共标识符？](http://en.wikipedia.org/wiki/Formal_Public_Identifier)这是一个错误还是我应该如何处理？

*编辑：*这是一些代码。

例如说我这样做：

```
XmlDocument myXmlDoc = new XmlDocument();
myXmlDoc.XmlResolver = new MyXmlResolver();
myXmlDoc.Load("myxmlfile.xml"); 
```

在`MyXmlResolver`我有以下代码：

```
public override object GetEntity(Uri absUri, string role, Type typeToRet)
{
  if (typeToRet == null || typeToRet == typeof(Stream))
     return GetStream(absUri);
  else
     throw new XmlException("Unsupported class type: " + typeToRet);
} 
```

我通过了“ `file://path/to/xmldoc/-//W3C//DTD XHTML 1.1//EN`”，`absUri`这对我来说没有任何意义。我只是应该忽略它吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T14:30:29.657

你真的需要定制`XmlResolver`吗？你在你的解析器中做了什么来保证自定义实现？

向您传递这样的 URI 的原因是因为您已告知`XmlDocument`您将显式解析文档中的所有外部引用（如 DTD）。如果您不需要手动执行此操作，那么您应该使用现有`XmlResolver`类型或保留它`null`并让默认行为发生。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T14:34:55.793

我正在使用一个本地缓存 dtd、mod 文件等（请参阅[此问题](https://stackoverflow.com/questions/423921/xmldocument-and-slow-schema-processing)）。我的问题在于它传递给我的 FPI 并不是真正的外部参考，我无法将它与真正的外部参考区分开来。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-01T03:53:45.567

我有同样的问题。我所做的是检查传入的值，如果它是一个错误的值，我将它返回一个有效的 uri，用于我创建的虚拟 DTD。当正确的 dtd 在文档旁边时，只需调用 LoadXML 即可。它知道如何只查看 DTD 并忽略正在破坏 GetEntity 方法的 PUBLIC 部分。我希望将 DTD 放在本地公共位置，这样我就不需要让它与不同地方的文档一起使用。因此，我覆盖 GetEntity，为其提供公共路径，然后我可以将一个 DTD 用于遍布整个文件系统的许多文档。

# javascript - 您如何将 jQuery 中的值与固定数字进行比较？

> ID：472917
> 
> 赞同：0
> 
> 时间：2009-01-23T13:43:19.377
> 
> 标签：javascript, jquery

您如何将 jQuery 中的值与固定数字进行比较？

我认为这可能有效，但它没有：

```
if (parseInt($("#days").value) > 7) {
            alert("more than one week");
        } 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-23T13:47:35.157

除了[@redsquare 的](https://stackoverflow.com/questions/472917/how-do-you-compare-a-value-from-jquery-with-a-fixed-number#472923)使用答案`.val()`外，您还应该指定[基数](http://www.w3schools.com/jsref/jsref_parseInt.asp)：

```
if (parseInt($("#days").val(), 10) > 7) {
            alert("more than one week");
        } 
```

这是因为该值可能有一个前导 0，在这种情况下`parseInt`会将值解释为八进制。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T13:44:33.057

如果 #days 是输入，那么您需要 .val() 而不是 value

例如

```
 if (parseInt($("#days").val()) > 7) {
        alert("more than one week");
   } 
```

# jquery - 在 jQuery 中，slideDown() 方法是否也可以向下滚动页面？

> ID：472930
> 
> 赞同：12
> 
> 时间：2009-01-23T13:46:13.647
> 
> 标签：jquery

[`slideDown()`](https://api.jquery.com/slidedown/)应用于元素会`div`向下滑动，但不会向下滚动页面，并且向下`div`滑动`div`仍然隐藏在视图之外。

有没有办法向下滚动页面以便用户查看`div`？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-23T13:54:18.963

快速演示[在这里](http://jsbin.com/agahi)

基本上你只需要

```
 $('html, body').animate({ 
      scrollTop: $('#yourDiv').offset().top 
  }, 3000); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-23T14:11:39.413

```
$.extend($.expr[':'],{
    inView: function(a) {
        var st = (document.documentElement.scrollTop || document.body.scrollTop),
            ot = $(a).offset().top,
            wh = (window.innerHeight && window.innerHeight < $(window).height()) ? window.innerHeight : $(window).height();
        return ot > st && ($(a).height() + ot) < (st + wh);
    }
});

if ($('#whatever').is(':not(:inView)')) {
    $('html,body').animate({ 
         scrollTop: $('#whatever').offset().top 
    }, 3000);
} 
```

# sql - 使用局部变量的 SELECT INTO 问题

> ID：472936
> 
> 赞同：1
> 
> 时间：2009-01-23T13:48:51.533
> 
> 标签：sql, mysql, mysql5

我需要创建一个 SQL 查询，以根据 SELECT 查询的结果将一些数据插入到一个表中到一个局部变量中。我的数据库平台是 MySQL 5.1，但我认为这不会有什么不同。基本上，我想做的是：

```
SELECT id INTO var_name FROM table1 WHERE some_column='something' LIMIT 1;
INSERT INTO table2 (`number`) VALUES (@var_name); 
```

但是，我无法通过第一条语句，因为我收到错误“未声明的变量 var_name”。我也尝试将语句放在 BEGIN/END 块和存储过程中，但后来我遇到了其他错误，这些错误仅表明 SELECT 行上有错误。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T13:51:56.503

您需要声明`@var_name`然后选择进入`@var_name`. 我不太了解 MySQL，但尝试这样的事情：

```
declare @var_name varchar(100);
SELECT id INTO @var_name FROM table1 WHERE some_column='something' LIMIT 1;
INSERT INTO table2 (`number`) VALUES (@var_name); 
```

### 编辑：也许是更好的方法：

```
insert into table2 ('number')
select id 
from table1 
where some_column = 'something' LIMIT 1; 
```

这消除了对变量的需求，并且会更快更容易理解。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T13:53:55.050

尝试

```
INSERT INTO table2 (`number`)
SELECT id FROM table1 WHERE some_column='something' LIMIT 1 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2012-12-10T18:36:28.960

```
CREATE TABLE table_name
AS  
SELECT ...(your select)
```

# ant - ANT & MSBUILD - 如果错误，构建过程不会失败

> ID：472937
> 
> 赞同：0
> 
> 时间：2009-01-23T13:48:51.550
> 
> 标签：ant, msbuild, cruisecontrol

使用 ANT 的 exec 任务运行 msbuild.exe 时，.net 代码中的错误不会导致构建过程失败。

为什么会这样？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T13:53:48.310

我使用 Nant 来运行一些 MSBuild 任务。每次我使用该`failonbuild`任务的属性时，它都会失败。查看 Apache 的 Ant 文档，似乎也存在相同的属性。你在使用这个属性吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T14:01:26.937

我找到了一个解决方案并使用了`Exec`'s `failonerror`，就像一个魅力。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T14:02:46.203

你让 msbuild 任务做什么？

当我之前使用 NAnt 时，我使用该任务来构建一个 VS.NET 解决方案。

现在，我不再使用 NAnt，而是使用 msbuild。:)

# delphi - 单元测试 Delphi 数据模块

> ID：472944
> 
> 赞同：5
> 
> 时间：2009-01-23T13:50:39.067
> 
> 标签：delphi, unit-testing, dunit, datamodule

如果所有业务逻辑都存在于数据模块（TSQLDataSets 和 TDataSetProviders）中，您将如何重构代码以使应用程序更适合单元测试？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T14:29:51.263

在[关于这个的最后一个问题](https://stackoverflow.com/questions/247978/dunit-testing-in-a-midas-datasnap-project)之后，我写[了一篇关于如何做的博客文章](http://blogs.teamb.com/craigstuntz/2009/01/09/37912/ "如何对数据模块进行单元测试")。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T19:57:25.083

一些基本提示：

*   你的 DataModules 不应该有任何对表单或任何其他 UI 组件的引用
*   将 TDataSources 放在表单上，​​而不是放在 DataModules 中。
*   确保没有任何需要用户在 DataModules 代码上输入的确认和操作提示。
*   您不应该使用任何全局变量。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T14:01:12.963

对于 DUnit 测试的自动化构建，您可以使用 OpenCTF，它能够在测试运行时找到所有组件并自动创建测试用例。示例测试包括一些基本的数据访问层测试。

[http://sourceforge.net/projects/openctf/](http://sourceforge.net/projects/openctf/)

和

[http://cc.embarcadero.com/Item/24136](http://cc.embarcadero.com/Item/24136)

[替代文字 http://www.mikejustin.com/images/OpenCTF.gif](http://www.mikejustin.com/images/OpenCTF.gif)

# eclipse - Tomcat 和 Eclipse 集成

> ID：472946
> 
> 赞同：6
> 
> 时间：2009-01-23T13:50:43.730
> 
> 标签：eclipse, tomcat, ubuntu

我正在使用 Eclipse Ganymede 在 Ubuntu 8.04 机器上进行开发。`sudo apt-get install tomcat5.5 tomcat5.5-admin`我使用和使用 Ant 脚本安装了 Tomcat 5.5 ，我通过将 WAR 文件复制到`$CATALINA_HOME/webapps`.

然后，我创建了一个 Eclipse 项目，并在`$PROJECT_ROOT/target/`. 我仍然通过右键单击`build.xml`并选择我的`deploy-war`任务来部署 WAR 文件。

由于 Tomcat 作为守护程序运行，在引导时自动启动，我没有指示它何时启动或退出。

我对这个设置的问题是：

1.  使用这种方法，我没有得到 Eclipse 控制台的任何输出，因为 Tomcat 在用户下运行，并且`tomcat55`我有不同的登录名并且无法访问`Stdout`.`tomcat55`
2.  发生的日志记录也是针对`Stdout`目前的，我在开发过程中发现它非常好。但是看不到的时候就不好看了。:-)
3.  我在`Server`选项卡下没有任何服务器，也没有`Run configurations`. 这使我无法使用`Debug mode`Eclipse 的，否则非常方便。

您认为我应该如何整合它们，从而使我的开发环境变得更好？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T14:21:36.710

我会说忘记预打包的Tomcat。从站点获取 apache-tomcat-xyzzip，将其解压缩到 $HOME 中的某个位置，然后将服务器添加到 eclipse 工作区，指向本地安装的 tomcat。当然，您需要 j2ee/wtp Eclipse 包。在 Windows 上运行良好，看不出它在 Linux 上无法运行的原因。

*编辑*：如果您安装了两个 tomcat，您可能不得不摆弄服务器端口。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T13:55:47.230

将 Tomcat 添加到 Eclipse 服务器列表并在服务器上运行您的 Web 应用程序。如果您需要更多详细信息[，请单击此处](http://www.ibm.com/developerworks/opensource/library/os-eclipse-tomcat/index.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T14:05:38.880

我从不关心 1 和 2，所以我无法真正帮助你。

关于 3：您不需要服务器选项卡下的任何服务器即可进行调试。只需使用这些环境变量启动tomcat

```
export JPDA_ADDRESS=8000
export JPDA_TRANSPORT=dt_socket
```

并相应地配置eclipse：运行-打开调试对话框-选择远程java应用程序并创建一个新配置。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-23T14:01:44.830

你需要eclipse来管理一个tomcat的副本，然后它可以调试它。问题的线索是您必须推送 deploy-war，这意味着文件正在离开您的开发环境并进入外部服务器。在正确配置的开发环境中，您只需要保存您的 java 文件，它将自动编译并且已经在本地 tomcat 安装中，这可能会尝试自动重新加载 web 应用程序，您可以刷新浏览器而无需重新加载任何内容在服务器上。查找更多的 tomcat 插件，有几种不同的方法可以做到这一点。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-23T19:41:21.340

如果你想定期调试和重新启动 Tomcat 应用程序，你可能想看看[MyEclipse——](http://myeclipseide.com)它可以让事情变得更容易。

# javascript - 如何在 Safari/Chrome 中从 javascript 打印 IFrame

> ID：472951
> 
> 赞同：52
> 
> 时间：2009-01-23T13:53:08.733
> 
> 标签：javascript, iframe, webkit, printing

有人可以帮助我通过 Safari/Chrome 中的 javascript 调用打印 IFrame 的内容。

这适用于Firefox：

```
$('#' + id)[0].focus();
$('#' + id)[0].contentWindow.print(); 
```

这在 IE 中有效：

```
window.frames[id].focus();
window.frames[id].print(); 
```

但我无法在 Safari/Chrome 中使用任何东西。

谢谢

安德鲁

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-01-23T15:41:02.370

这是我完整的跨浏览器解决方案：

在 iframe 页面中：

```
function printPage() { print(); } 
```

在主页

```
function printIframe(id)
{
    var iframe = document.frames
        ? document.frames[id]
        : document.getElementById(id);
    var ifWin = iframe.contentWindow || iframe;

    iframe.focus();
    ifWin.printPage();
    return false;
} 
```

**更新**：自从我遇到这个问题以来，许多人似乎在发布的 IE 版本中遇到了这个问题。我现在没有时间重新调查这个问题，但是，如果你被卡住了，我建议你阅读整个线程中的所有评论！

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-01-23T15:18:35.347

在 iframe 中放置一个打印函数并从父级调用它。

框架：

```
function printMe() {
  window.print()
} 
```

家长：

```
document.frame1.printMe() 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2010-05-26T16:10:45.233

我使用了 Andrew 的脚本，但在调用 printPage() 函数之前添加了一段。iframe 需要焦点，否则它仍然会在 IE 中打印父框架。

```
function printIframe(id)
{
    var iframe = document.frames ? document.frames[id] : document.getElementById(id);
    var ifWin = iframe.contentWindow || iframe;
    iframe.focus();
    ifWin.printPage();
    return false;
} 
```

不过不要感谢我，这是安德鲁写的。我刚刚做了一个调整**=P**

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-04-20T15:52:20.817

除了 Andrew 和 Max 的解决方案之外，在 IE8 中使用 iframe.focus() 会导致打印父框架而不是仅打印子 iframe。更改该行修复了它：

```
function printIframe(id)
{
    var iframe = document.frames ? document.frames[id] : document.getElementById(id);
    var ifWin = iframe.contentWindow || iframe;
    ifWin.focus();
    ifWin.printPage();
    return false;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-10-28T15:42:40.780

使用 firefox`window.frames`但也要添加`name`属性，因为它使用了 firefox 中的 iframe

IE：

```
window.frames[id] 
```

火狐：

```
window.frames[name]

<img src="print.gif"  onClick="javascript: window.frames['factura'].focus(); parent['factura'].print();">
<iframe src="factura.html" width="100%" height="400" id="factura" name="factura"></iframe> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-12-07T15:22:11.623

需要注意的一点是，如果您在本地使用 file:/// 进行测试，它将无法在 chrome 上运行，因为 iframe 中的函数将显示为未定义。但是，一旦在 Web 服务器上，它就会工作。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-12-07T21:23:48.513

我必须做一些修改才能在 IE8 中使用（没有用其他 IE 风格测试）

1) document.frames[param] 似乎接受一个数字，而不是 ID

```
printIframe(0, 'print');

function printIframe(num, id)
{
  var iframe = document.frames ? document.frames[num] : document.getElementById(id);
  var ifWin = iframe.contentWindow || iframe;

  ifWin.focus();
  ifWin.printPage();

  return false;
} 
```

2）我在页面加载时显示了一个打印对话框，并且还有一个指向“单击此处开始打印”的链接（如果它没有自动启动）。为了让它工作，我不得不添加 focus() 调用

```
<script type="text/javascript">
  $(function(){
    printPage();
  });

  function printPage()
  {
    focus();
    print();
  }
</script> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-01-21T14:37:23.920

**您可以使用**

```
parent.frames['id'].print(); 
```

**在 Chrome 工作！**

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-02-12T00:08:23.163

你也可以使用

```
top.iframeName.print(); 
```

或者

```
parent.iframeName.print(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-06-22T04:50:55.473

'framePartsList.contentWindow.print();' 在 IE 11 版本 11.0.43 中不起作用

因此我使用了 framePartsList.contentWindow.document.execCommand('print', false, null);

* * *

## 回答 #11

> 赞同：-4
> 
> 时间：2010-11-24T15:35:20.867

用这个：

```
window.onload = setTimeout("window.print()", 1000); 
```

# c# - 释放标记为 COM 互操作的 C# DLL

> ID：472956
> 
> 赞同：3
> 
> 时间：2009-01-23T13:54:58.433
> 
> 标签：c#

我创建了一个香草 C# dll 并将其标记为 COM 互操作。dll 是一个没有任何功能的普通用户表单，因为这是一个实验。

我注册了 DLL 并打开了活动的 x 测试容器并实例化了我的 COM 对象。它显示在测试容器中，我可以查看控件的公开方法——这些是默认方法，不是我创建的。

然后我从活动的 x 测试容器中退出，我注意到测试容器仍然潜伏在任务管理器中，我不得不手动终止该进程。这使我相信测试容器仍然包含对我为 com inter op 公开的 C# dll 的引用。

Designer.cs 中的默认 dispose 方法是

```
 protected override void Dispose(bool disposing)
    {
        if (disposing && (components != null))
        {
            components.Dispose();
        }
        base.Dispose(disposing);

   } 
```

当我使用带有 Quick time 的测试容器时，它按预期调用了 quick time，当我关闭测试容器时，它正确处理并且没有在任务管理器中留下足迹。

问题 - 在我的 dispose 方法中是否有我必须做的特定事情？此外，这可能不相关，但是当我创建一个测试项目并启动我的 c# 控件并单击关闭按钮时，它会关闭我的测试表单，但测试应用程序仍然在调试模式下运行 - 运行按钮被禁用.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T14:04:40.677

你可以试试：

```
public void IDisposable.Dispose()
{     
   System.Runtime.InteropServices.Marshal.ReleaseComObject(this);
} 
```

通常，当您从 .net 中使用 COM 对象时，您会这样做，但不确定其他方式。但试一试也无妨。让我知道结果如何；-)

# 编辑：

您还可以尝试抑制最终确定：

GC.SuppressFinalize(this);

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T14:12:32.937

MSDN 有一篇关于[如何实现 IDisposable](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)的相当全面的文章。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:04:00.430

除了覆盖 Dispose(bool) 之外，您还需要在调用 Dispose(true) 的方法中覆盖 IDisposable.Dispose()，然后调用 GC.SurpressFinalize(this)。您还必须在 Dispose(bool) 的覆盖中实现 IDisposable 的所有成员上调用 Dispose()

# c# - C#：如何访问 Excel 单元格？

> ID：472959
> 
> 赞同：20
> 
> 时间：2009-01-23T13:56:24.670
> 
> 标签：c#, excel

我正在尝试打开一个 Excel 文件并用数据填充其单元格？到目前为止，我已经完成了以下编码。

目前我在这个阶段使用以下代码，但我仍然收到错误：

```
Microsoft.Office.Interop.Excel.ApplicationClass appExcel =
                new Microsoft.Office.Interop.Excel.ApplicationClass();
try
{
    // is there already such a file ?
    if (System.IO.File.Exists("C:\\csharp\\errorreport1.xls"))
    {
        // then go and load this into excel
        Microsoft.Office.Interop.Excel.Workbooks.Open(
            "C:\\csharp\\errorreport1.xls", true, false, 
            Missing.Value, Missing.Value, Missing.Value, Missing.Value,
            Missing.Value, Missing.Value, Missing.Value, Missing.Value, 
            Missing.Value, Missing.Value, Missing.Value, Missing.Value);
    }
    else
    {
        // if not go and create a workbook:
        newWorkbook = appExcel.Workbooks.Add(XlWBATemplate.xlWBATWorksheet);
        Microsoft.Office.Interop.Excel._Worksheet excelWorksheet = 
            (Microsoft.Office.Interop.Excel._Worksheet)
                newWorkBook.Worksheets.get_Item(1);
    } 
i++;
j = 1;

j++;
objsheet.Cells(i, j).Value = "Tabelle: " + rs.Fields["Table_Name"];
j++;
objsheet.Cells(i, j).Value = "kombinationsschluessel:FALL " 
                                + rs3.Fields[1].Value;
j++;
objsheet.Cells(i, j).Value = "Null Value: ";
j++;
objsheet.Cells(i, j).Value = "Updated with 888"; 
```

这些是我得到的前 2 个错误：

```
Error 1 An object reference is required for the nonstatic field, method, or
        property 'Microsoft.Office.Interop.Excel.Workbooks.Open(string, object,
        object, object, object, object, object, object, object, object, object,
        object, object, object, object)'

Error 2 The name 'newWorkbook' does not exist in the current context 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-23T14:03:05.843

~~如果您尝试自动化 Excel，您可能不应该打开 Word 文档并使用 Word 自动化；）~~

看看这个，它应该让你开始，

[http://www.codeproject.com/KB/office/package.aspx](http://www.codeproject.com/KB/office/package.aspx)

这是一些代码。它取自我的一些代码，并删除了很多东西，所以它什么也不做，可能无法编译或完全工作，但它应该能让你继续前进。它面向阅读，但应该为您指明正确的方向。

```
Microsoft.Office.Interop.Excel.Worksheet sheet = newWorkbook.ActiveSheet;

if ( sheet != null )
{
    Microsoft.Office.Interop.Excel.Range range = sheet.UsedRange;
    if ( range != null )
    {
        int nRows = usedRange.Rows.Count;
        int nCols = usedRange.Columns.Count;
        foreach ( Microsoft.Office.Interop.Excel.Range row in usedRange.Rows )
        {
            string value = row.Cells[0].FormattedValue as string;
        }
    }
 } 
```

你也可以做

```
Microsoft.Office.Interop.Excel.Sheets sheets = newWorkbook.ExcelSheets;

if ( sheets != null )
{
     foreach ( Microsoft.Office.Interop.Excel.Worksheet sheet in sheets )
     {
          // Do Stuff
     }
} 
```

如果您需要插入行/列

```
// Inserts a new row at the beginning of the sheet
Microsoft.Office.Interop.Excel.Range a1 = sheet.get_Range( "A1", Type.Missing );
a1.EntireRow.Insert( Microsoft.Office.Interop.Excel.XlInsertShiftDirection.xlShiftDown, Type.Missing ); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T14:03:07.123

我认为，您必须声明相关的工作表！

尝试这样的事情

```
objsheet(1).Cells[i,j].Value; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-29T15:55:10.300

尝试：

```
Excel.Application oXL;
Excel._Workbook oWB;
Excel._Worksheet oSheet;
Excel.Range oRng;

oXL = new Excel.Application();
oXL.Visible = true;
oWB = (Excel._Workbook)(oXL.Workbooks.Add(Missing.Value));

oSheet = (Excel._Worksheet)oWB.Worksheets;
oSheet.Activate();

oSheet.Cells[3, 9] = "Some Text" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-14T12:23:28.177

您可以使用以下代码；它对我来说很好用：

```
newWorkbook = appExcel.Workbooks.Add(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-07T12:56:18.157

这对我来说很好

```
 Excel.Application oXL = null;
        Excel._Workbook oWB = null;
        Excel._Worksheet oSheet = null;

        try
        {
            oXL = new Excel.Application();
            string path = @"C:\Templates\NCRepTemplate.xlt";
            oWB = oXL.Workbooks.Open(path, 0, false, 5, "", "",
                false, Excel.XlPlatform.xlWindows, "", true, false,
                0, true, false, false);

            oSheet = (Excel._Worksheet)oWB.ActiveSheet;
            oSheet.Cells[2, 2] = "Text"; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-31T22:42:23.193

简单的。

打开工作簿。使用 xlapp.workbooks.Open()

您之前已经声明并实例化了 xlapp 的地方...... Excel.Application xlapp = new Excel.Applicaton();

参数正确。

接下来，确保在使用单元格属性或范围对象为单元格分配值时使用属性 Value2。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-28T09:31:33.553

我如何实现 Office / Excel 自动化：

1.  录制一个宏，这将生成一个 VBA 模板
2.  编辑 VBA 模板，使其符合我的需要
3.  转换为 VB.Net（男性的一小步）
4.  把它留在 VB.Net 中，比使用 C# 更容易

# c# - C# 当我在列表框中选择一个项目时，我应该使用哪个事件在文本框中显示数据？

> ID：472961
> 
> 赞同：2
> 
> 时间：2009-01-23T13:56:56.667
> 
> 标签：c#, listbox

C# 当我在列表框中选择一个项目时，我应该使用哪个事件在文本框中显示数据？

我想在列表框（winforms）中选择一个项目，然后在附近的一个文本框中显示与该项目相关的一些数据，但我不知道要使用哪个事件。我需要能够单击列表并在每次单击时观看文本框文本更新。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T14:01:13.973

[SelectedIndexChanged](http://msdn.microsoft.com/en-us/library/system.windows.forms.listbox.selectedindexchanged.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T14:01:58.590

您将需要处理[`SelectedIndexChanged`](http://msdn.microsoft.com/en-us/library/system.windows.forms.listbox.selectedindexchanged.aspx)或[`SelectedValueChanged`](http://msdn.microsoft.com/en-us/library/system.windows.forms.listcontrol.selectedvaluechanged.aspx)。

（请注意，`SelectedValueChanged`MSDN 文章中的示例听起来与您正在做的完全一样。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T14:09:24.940

假设您有一个带有 TextBox 和 ListBox 的表单。

```
 public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();

        this.listBox1.SelectedIndexChanged += new System.EventHandler(this.listBox1_SelectedIndexChanged);
    }

    private void listBox1_SelectedIndexChanged(object sender, EventArgs e)
    {
        textBox1.Text = listBox1.SelectedItem.ToString();
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T13:59:00.063

我想[这](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.bindingcontext.aspx)会帮助你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T13:59:37.207

抱歉，我不知道事件的确切名称，但类似于您正在寻找的**SelectedItemChanged 。**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T14:03:09.227

[SelectedIndexChanged](http://msdn.microsoft.com/en-us/library/system.windows.forms.listbox.selectedindexchanged.aspx)事件对您不起作用吗？

```
private void listBox1_SelectedIndexChanged(object sender, EventArgs e) {
    relatedTextbox.Text = listBox1.SelectedItem.ToString();
} 
```

# asp.net - ASP.NET MVC ViewResult 与 PartialViewResult

> ID：472963
> 
> 赞同：58
> 
> 时间：2009-01-23T13:57:59.503
> 
> 标签：asp.net, asp.net-mvc

`ViewResult`名为和的控制器结果有什么区别`PartialViewResult`？更重要的是，什么时候`PartialViewResult`使用？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-01-23T14:19:59.257

PartialViewResult 用于呈现局部视图（fx。只是一个用户控件）。这对于 AJAX 的东西来说非常漂亮，即

```
<script type="text/javascript">
    $.get(
        "/MyController/MyAction",
        null,
        function (data) { $("#target").html(data) }
     );
</script> 
```

和行动

```
public ActionResult MyAction() 
{
    return PartialView("SomeView");
} 
```

其中 SomeView 是 MVC 用户控件，例如：

```
<div>
   <%= DateTime.Now.ToString() %>
</div> 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-01-23T14:20:50.660

[http://msmvps.com/blogs/luisabreu/archive/2008/09/16/the-mvc-platform-action-result-views.aspx](http://msmvps.com/blogs/luisabreu/archive/2008/09/16/the-mvc-platform-action-result-views.aspx)

> 在实践中，您将使用 PartialViewResult 来输出视图的一小部分。这就是为什么您在处理它们时没有母版页选项。另一方面，您将使用 ViewResult 来获得“完整”视图。正如您所料，Controller 类公开了几个方法，可以让您减少为这些类型的操作结果进行实例化所需的输入量。

一般来说，ViewResult 用于渲染带有可选 master 的页面，PartialViewResult 用于用户控件（可能是响应 AJAX 请求）。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2014-10-14T23:35:38.253

现有的答案都没有真正回答“有什么区别”这个问题。

区别如下：

1）视图引擎将尝试查找视图的位置：

*   对于 ViewResult，它位于 ViewLocationFormats 和 MasterLocationFormats 中
*   对于 PartialViewResult，它位于 PartialViewLocationFormats

2) ViewResult 具有附加属性 MasterName

就这些。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-03-23T01:22:19.883

在某些情况下，您希望将视图分解为几个小组件。我现在正在使用的一个用例是我有一个多语言网站，我想使用 AJAX 原则重新加载内容。

通常，在非多语言站点的情况下，我会做的是创建另一个 ActionResult 以返回随新参数而变化的 ViewModel。我喜欢使用我称之为 JsonpResult 的自定义 ActionResult。问题在于我的标签不在我的数据库中，而是在资源文件中。所以我需要做的是以某种方式将我的资源文件数据水合到 ViewModel 中。

一旦数据通过管道传输，我的 AJAX 回调会使用 Javascript（我使用 jQuery）将 ViewModel 响应连接回 HTML 页面。

这绝对有效，但是它成为可维护性的问题。我现在不仅需要维护我原来的 ASP.NET 视图，还需要维护一组处理 AJAXian 行为的脚本。如果您需要对您的网站进行 SEO，那么您确实需要确保服务器端和客户端的行为都相同。

这就是局部视图对我起作用的地方。我所做的是“拉出”发生大量重新加载的逻辑数据部分。PartialView 的好处是您可以将 ViewData 和 Model 传递给 PartialView。如果您的 PartialView 是针对您的 ViewModel 进行强类型化的，您可以让 Intellisense 帮助您连接 PartialView。

现在，我对 AJAX 调用所需要做的就是将响应写回单个 DIV，而不是单独处理数据点。这确实意味着会有更多的内容流下来。但是，权衡取舍更容易阅读和维护代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-05-14T13:16:52.633

主要区别之一是 PartialViewResult 不使用 _ViewStart.cshtml。_ViewStart.cshtml 文件中的代码在视图中的任何代码之前在渲染开始时执行。

# xpath - XPATH 多元素过滤器

> ID：472966
> 
> 赞同：22
> 
> 时间：2009-01-23T13:58:40.750
> 
> 标签：xpath, multiple-conditions

我有以下示例 XML 结构：

```
<SavingAccounts>
    <SavingAccount>
       <ServiceOnline>yes</ServiceOnline>
       <ServiceViaPhone>no</ServiceViaPhone>
    </SavingAccount>
    <SavingAccount>
       <ServiceOnline>no</ServiceOnline>
       <ServiceViaPhone>yes</ServiceViaPhone>
    </SavingAccount>
</SavingAccounts> 
```

我需要做的是使用 XPATH 过滤“SavingAccount”节点，其中“ServiceOnline”的值为“yes”或“ServiceViaPhone”的值为“yes”。

XPATH 应该返回我两行！我可以过滤两个元素值都是“是”的“SavingAccount”节点，就像下面的 XPATH 示例一样，但我想要做的是或元素值比较？？？

```
/SavingAccounts/SavingAccount/ServiceOnline[text()='yes']/../ServiceViaPhone[text()='yes']/.. 
```

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-01-23T14:27:42.283

**这是一个非常基本的 XPath 特性：用逻辑运算符 、 和函数 组成[`and`](http://www.w3.org/TR/xpath#NT-AndExpr)许多[`or`](http://www.w3.org/TR/xpath#NT-OrExpr)条件[`not()`](http://www.w3.org/TR/xpath#function-not)。**

**`and`**具有比[**关系**](http://www.w3.org/TR/xpath#NT-RelationalExpr)和[**相等**](http://www.w3.org/TR/xpath#NT-EqualityExpr)运算符（、、、和）更高的优先级，并且**`or`**两个运算符的优先级都低于。[](http://www.w3.org/TR/xpath#NT-RelationalExpr)**[](http://www.w3.org/TR/xpath#NT-EqualityExpr)**`=``!=``>``>=``&lt;``&lt;=`****

 ******因此，可以安全地编写**：`A = B and C = D`

**一些最常见的错误**：

1.  人们写`AND`和/或`OR`。**请记住，XPath 区分大小写**。

2.  人们使用`|`（联合）运算符而不是`or`

**最后，这是我的解决方案**：

```
**/SavingAccounts/SavingAccount
           [ServiceOnLine='yes' 或 ServiceViaPhone='yes']** 
```

* * *

 **## 回答 #2

> 赞同：10
> 
> 时间：2009-01-23T14:07:38.890

```
/SavingAccounts/SavingAccount[(ServiceOnLine='yes') or (ServiceViaPhone='yes')] 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T14:07:38.890

将要

```
/SavingAccounts/SavingAccount[ServiceOnline/text()='yes' or ServiceViaPhone/text()='yes'] 
```

做这个把戏？

目前我没有方便的 XPath 求值器。

**编辑：**
如果我没记错的话，你不需要 text()，所以

```
[ServiceOnline='yes' or ServiceViaPhone='yes'] 
```

应该足够了，并且更具可读性。

**编辑：**
是的，当然，谓词表达式的“或”，我的错。

# asp.net - 如何持久化 ViewState 以便以后重用？

> ID：472973
> 
> 赞同：1
> 
> 时间：2009-01-23T14:01:29.183
> 
> 标签：asp.net, viewstate

是否可以保存 ViewState 信息，例如保存到会话中，以便当您离开页面时它会以某种方式持续存在？然后，当您返回该页面时，您可以重新加载视图状态并保留您所做的选择。

## 背景

我有两个页面，一个报告页面，您可以在其中选择数据，进行一些过滤和排序等，还有一个图表页面，您从报告页面中选择的数据可以以不同的方式呈现，有不同的呈现选择。

如果用户测试了不同的演示文稿，那么简单地使用后退按钮可能意味着在用户返回报告页面之前单击很多次。我想要报告页面的直接链接。

*   使用 QueryString 保存控件状态不是一种选择。
*   我无法为整个应用程序自定义 ViewState 存储。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T14:02:47.373

是的，可以将 Viewstate 存储在数据库之类的东西中。您只需要实现其中一个视图状态提供程序。有关使用 SqlViewStateProvider 的示例，请参见[此处。](http://www.codeproject.com/KB/viewstate/ViewStateProvider.aspx)

编辑：刚刚重新阅读您的帖子，并看到您说您无法自定义视图状态如何为整个应用程序存储。如果是这种情况，您可能需要考虑将其存储在会话中。[Scott Hanselman 在这里](http://www.hanselman.com/blog/MovingViewStateToTheSessionObjectAndMoreWrongheadedness.aspx)讨论了这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:50:50.123

您的链接可以使用 JavaScript 自动导航回所需数量的页面。查看window.history，如果您可以计算向前的页面数，您可以向后导航那么多。

ViewState 已经被设计为保持用户控件的状态。如果您的用户进行了选择，并且该选择在服务器端通过整页回发进行处理，则控件的新状态将保存在 ViewState 中（隐藏输入 __VIEWSTATE）。

如果您的报告使用 AJAX 和部分页面回发，那么无论如何您都不会在页面上获得 ViewState。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-04T11:03:58.873

澄清一下，SQLViewstateProvider 不是应用程序范围的实现。您必须创建一个继承自 System.Web.UI.Page 对象并覆盖父页面类的保存和加载视图状态方法的类。对于您希望将视图状态保存在服务器端的每个页面，您必须从新创建的页面模板继承（这反过来又继承并覆盖了 System.WEb.UI.Page 类）。

所以它是在每页的基础上应用的，而不是在应用程序范围的基础上应用的。

HEADS UP: Some controls might contain some client-side javascript code which may reference the viewstate on client-side (duh). If the viewstate is now stored on server-side you will get a null-reference exception (for instance, clicking a commandfield in a gridview). I'm working on a workaround for this problem, but unfortunately I do not have any concrete solution as of yet.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T16:52:43.427

这是一个坏主意，只需使用查询字符串。我很想知道为什么他们不是一个选择。

# python - 带有pyserial（python串口）的二进制数据

> ID：472977
> 
> 赞同：17
> 
> 时间：2009-01-23T14:02:43.317
> 
> 标签：python, binary, serial-port, pyserial

pyserial 中的 serial.write() 方法似乎只发送字符串数据。我有像 [0xc0,0x04,0x00] 这样的数组，并且希望能够通过串口发送/接收它们？原始 I/O 是否有任何单独的方法？

我想我可能需要将数组更改为 ['\xc0','\x04','\x00']，但空字符可能会造成问题。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-08-15T14:19:51.420

另一种方法，不使用`array`模块：

```
def a2s(arr):
    """ Array of integer byte values --> binary string
    """
    return ''.join(chr(b) for b in arr) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-23T14:25:28.137

您需要将数据转换为字符串

```
"\xc0\x04\x00" 
```

空字符在 Python 中不是问题——字符串不是以空字符结尾的，零字节的行为就像另一个字节一样`"\x00"`。

一种方法：

```
>>> import array
>>> array.array('B', [0xc0, 0x04, 0x00]).tostring()
'\xc0\x04\x00' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-11-16T03:36:45.130

我遇到了类似（但可以说更糟）的问题，必须通过 UART 从 python 脚本发送控制位来测试嵌入式设备。我的数据定义是“field1：8 位，field2：3 位，field3 7 位”等。事实证明，您可以使用 BitArray 库为此构建一个强大而干净的接口。这是一个片段（减去串行设置）

```
from bitstring import BitArray

cmdbuf = BitArray(length = 50)     # 50 byte BitArray
cmdbuf.overwrite('0xAA', 0)       # Init the marker byte at the head 
```

这就是它变得灵活的地方。下面的命令用传递的 4 位替换位位置 23 的 4 位。请注意，它采用二进制位值，以字符串形式给出。我可以通过这种方式设置/清除缓冲区中任何位置的任何位，而不必担心踩到相邻字节或位中的值。

```
cmdbuf.overwrite('0b0110', 23)

# To send on the (previously opened) serial port 
ser.write( cmdbuf ) 
```

# java - 带有 Spring 和 OAS/OC4J 的 Java WebServices

> ID：472984
> 
> 赞同：0
> 
> 时间：2009-01-23T14:03:17.510
> 
> 标签：java, web-services, oc4j

我在将简单的 WebServices 应用程序（如“Hello World”简单）部署到 OC4J 时遇到问题。相同的代码在 Jetty 下运行良好，但在 OC4J 中中断，我想知道是否有其他人遇到过同样的问题。我正在使用 Enterprise Manager 部署应用程序，但部署失败并显示以下消息：

```
 [Jan 23, 2009 8:46:20 AM] Binding TestWs web-module for application TestWs to site default-web-site under context root /TestWs 
    [Jan 23, 2009 8:46:22 AM] Operation failed with error: Configuration problem: Unable to locate Spring NamespaceHandler for XML schema namespace [http://cxf.apache.org/jaxws] 
Offending resource: ServletContext resource [/WEB-INF/beans.xml] 
```

查看 beans.xml，有问题的代码似乎是 XML 命名空间声明：

```
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:jaxws="http://cxf.apache.org/jaxws"
    xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd">

    <import resource="classpath:META-INF/cxf/cxf.xml" />
    <import resource="classpath:META-INF/cxf/cxf-extension-soap.xml" />
    <import resource="classpath:META-INF/cxf/cxf-servlet.xml" />

    <jaxws:endpoint
        id="helloService"
        implementor="com.test.endpoint.HelloImpl"
        address="/HelloWorld" />
</beans> 
```

堆栈跟踪并不是非常有启发性：

```
 09/01/23 08:57:28 oracle.oc4j.admin.internal.DeployerException: Configuration problem: Unable to locate Spring NamespaceHandler for XML schema namespace [http://cxf.apache.org/jaxws]
    Offending resource: ServletContext resource [/WEB-INF/beans.xml]

    09/01/23 08:57:28   at org.springframework.beans.factory.parsing.FailFastProblemReporter.error(FailFastProblemReporter.java:68)
    09/01/23 08:57:28   at org.springframework.beans.factory.parsing.ReaderContext.error(ReaderContext.java:85)
    09/01/23 08:57:28   at org.springframework.beans.factory.parsing.ReaderContext.error(ReaderContext.java:80)
    09/01/23 08:57:28   at org.springframework.beans.factory.xml.BeanDefinitionParserDelegate.error(BeanDefinitionParserDelegate.java:261)
    09/01/23 08:57:28   at org.springframework.beans.factory.xml.BeanDefinitionParserDelegate.parseCustomElement(BeanDefinitionParserDelegate.java:1120)
... 
```

有没有其他人遇到过类似的问题？如果是这样，修复它的最佳方法是什么？我的 XML 技能中等，而且我完全是 WebServices 的菜鸟。但这可能是一个 OC4J 问题。

在此先感谢您的帮助！

**编辑**：据我所知，这不是类路径问题，除非 OC4J 对它想在哪里看到的 jar 感到奇怪（我知道 Tomcat 可以）。我的 WEB-INF/lib 文件夹包含 CXF jar、Spring jar（bean、上下文、核心和 Web）、xml-resolver-1.2.jar 和 XmlSchema-1.4.2.jar。如果我需要列出 WEB-INF/lib 文件夹中的所有内容，我会的。但同样，该程序在 Jetty 中运行。

**另一个编辑：**根据我在[这里](http://forum.springframework.org/showthread.php?t=46975)阅读的内容，这似乎是 Spring 和 CXF jar 之间的问题——CXF jar 中有一个 NamespaceHandler 类（`org.apache.cxf.frontend.spring`准确地说），但似乎有一个配置问题阻止看到它就春天。

**最后编辑：**谢谢大家的帮助。我最终没有让 CXF 在 OC4J 中工作，因为我的客户端使用的是 10.1.3.3.0 版本。它不符合 J2EE 5，而且我很确定他们不会为了更改 boot.xml 而解压他们的 oc4j.jar。但如果没有丹尼尔给我指的文件，我永远不会知道这一点。

所以我切换到 XFire 版本 1.2.6，并在一些小问题后让我的测试应用程序正常工作。一路走来，我学到了一些关于 OC4J 的有趣的东西：

*   在 Enterprise Manager 中部署时，请确保您选择首先加载本地类路径。
*   OC4J 使用非标准 XML 文件，因此请确保您的应用程序没有使用任何 OC4J 的原生 XML 文件（在部署设置中，取消选中所有当前选择的导入 - 这样，您可以确保应用程序仅使用您的文件在 WEB-INF/lib 中提供）
*   如果可以，请使用另一个应用服务器。:P

再次感谢大家！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T02:17:52.443

我不想问显而易见的问题，但是您是否从 CXF 网站查看了所有用于同时配置 OS4J 和 CXF 的内容？ [http://cwiki.apache.org/CXF20DOC/appserverguide.html#AppServerGuide-OC4J](http://cwiki.apache.org/CXF20DOC/appserverguide.html#AppServerGuide-OC4J)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T14:11:13.970

我认为这是一个 CLASSPATH 问题。

我对 OC4J 不是很熟悉，但是您如何打包/部署您的 Web 应用程序？

您需要确保 CXF jar 在`WEB-INF/lib`您的 WAR 目录中吗？

更新：您的评论有点困惑 - 如果您的 spring 配置位于`META-INF`您的 EAR 目录中，那么这与您的 web 应用程序使用的类路径不同。所以，事实上，把 CXF 罐子塞进`WEB-INF/lib`去是行不通的。您要么需要将 JAR 粘贴在 EAR 的顶层，要么粘贴在 OC4J 的所有类加载器共享的某个库中。我建议研究 OC4J 的企业应用程序/网络应用程序类加载器层次结构文档，看看这是否可以提供更多建议？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T15:00:53.980

看起来像 Spring 的配置问题：

```
Configuration problem: Unable to locate Spring NamespaceHandler for XML schema namespace [http://cxf.apache.org/jaxws]
Offending resource: ServletContext resource [/WEB-INF/beans.xml] 
```

当应用程序启动时，您的 web.xml 中是否有任何内容可以读取？您是否在代码中的任何位置看到为该名称空间声明的 NamespaceHandler？

# excel - 如何在 Excel 中以 A:B 格式显示比率？

> ID：472989
> 
> 赞同：20
> 
> 时间：2009-01-23T14:04:49.943
> 
> 标签：excel

我有一个 Excel 数据电子表格，例如：

```
ColumnA ColumnB
33        11
25        5
6         4 
```

我想做的是添加第三列，以 A:B 的格式显示 A 列与 B 列的比率。例如：

```
ColumnA ColumnB   Ratio
33        11       3:1
25        5    5:1
6         4    3:2 
```

有谁知道实现这一目标的方法？

提前致谢。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-23T14:10:31.693

试试这个公式：

```
=SUBSTITUTE(TEXT(A1/B1,"?/?"),"/",":") 
```

结果：

```
A   B   C
33  11  3:1
25  5   5:1
6   4   3:2 
```

解释：

*   TEXT(A1/B1,"?/?") 把 A/B 变成假分数
*   SUBSTITUTE(...) 用冒号替换分数​​中的“/”

这不需要任何特殊的工具包或宏。唯一的缺点可能是结果被认为是文本——而不是数字——因此您可以轻松地将其用于进一步计算。

* * *

**注意：**正如@Robin Day 建议的那样，根据需要增加问号 (?) 的数量以减少四舍五入（感谢 Robin！）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-23T14:23:15.287

您正在寻找最大公约数 (GCD)。

您可以在 VBA 中递归地计算它，如下所示：

```
Function GCD(numerator As Integer, denominator As Integer)
  If denominator = 0 Then
    GCD = numerator
  Else
    GCD = GCD(denominator, numerator Mod denominator)
  End If
End Function 
```

并像这样在您的工作表中使用它：

```
 ColumnA   ColumnB   ColumnC
1  33        11        =A1/GCD(A1; B1) & ":" & B1/GCD(A1; B1)
2  25         5        =A2/GCD(A2; B2) & ":" & B2/GCD(A2; B2) 
```

建议将函数调用的结果存储在隐藏列中，并使用此结果来避免每行调用两次函数：

```
 ColumnA   ColumnB   ColumnC        ColumnD
1  33        11        =GCD(A1; B1)   =A1/C1 & ":" & B1/C1
2  25         5        =GCD(A2; B2)   =A2/C2 & ":" & B2/C2 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-23T14:12:14.670

该页面上的第二个公式使用分析工具库的 GCD 功能，您可以从工具 > 加载项中添加它。

=A1/GCD(A1,B1)&":"&B1/GCD(A1,B1)

这是一个更数学的公式，而不是基于文本操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-11T21:41:07.243

下面是我使用的公式。我在使用 GCD 时遇到了问题，因为我使用了相当大的数字来计算比率，并且我发现诸如“209:1024”之类的比率没有简单的四舍五入那么有用，因此它显示“1: *”或“* :1” . 如果可能的话，我也不喜欢使用宏。下面是结果。

```
=IF(A1>B1,((ROUND(A1/B1,0))&":"&(B1/B1)),((A1/A1)&":"&(ROUND(B1/A1,0)))) 
```

某些公式是不必要的（例如，“A1/A1”），但我将其包括在内以显示其背后的逻辑。此外，您可以通过使用每个 ROUND 功能的设置来切换发生多少舍入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-09T12:15:05.747

我发现这是最简单和最短的，但是我四舍五入到零小数位：

`="1" & ":" & ROUND((A1/B1),0)`

注意 前后的空格`&`。

这意味着“1”和“：”被视为整个公式的附加非公式信息。该`ROUND`函数将作为基本公式的 A1/B1 舍入到小数点后 0 位。您可以尝试更改为 1,2,3... 小数位。

我希望我说清楚了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-07-04T11:05:16.903

假设您在 D 和 E 单元格中有数据。这是我的 frnd 'Karthik' 显示 fn 的最简单比率

```
=ROUND(D7/E7, 2) &":" & (E7/E7) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-12T16:20:15.423

在工作中，我们只有 Excel 2003 可用，这两个公式对我来说似乎非常有效：

```
=(ROUND(SUM(B3/C3),0))&":1" 
```

或者

```
=B3/GCD(B3,C3)&":"&C3/GCD(B3,C3) 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2010-07-16T20:59:22.777

谢谢你们。我用这个：

```
=CONCATENATE((number1/GCD(number1,number2)),":",((number2/GCD(number1,number2)))) 
```

如果你有 2007 这很好用。

# vba - 为什么有时 VBA 编辑器会自行打开？

> ID：472993
> 
> 赞同：22
> 
> 时间：2009-01-23T14:05:53.670
> 
> 标签：vba, outlook, vbe

我在 Outlook 2003 VBA 中创建了一个脚本来监视新约会，并在我创建它们时将它们设置为暂定且不提醒。我发现 VBA 编辑器似乎会随机打开。当我使用新脚本时不会发生这种情况，但是今天早上当我解除我的笔记本电脑休眠时它确实发生了，例如。

编辑器不会弹出任何运行时错误或突出显示脚本中的任何行，它就在那里，就好像我按下了 Alt-F11 启动它一样。有时我关闭其他应用程序，发现它已经停在那里一段时间了。

自从我创建了这个新脚本后，这种行为才出现。任何想法为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2013-02-06T18:41:47.020

如[Microsoft 支持中心](http://support.microsoft.com/kb/829059)所述：

> “仅当 Microsoft Visual Basic 编辑器窗口**最大化**时才会出现此问题。”

## *解决方案：*

**取消最大化**Visual Basic 编辑器并**关闭**它。

你完成了！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T14:18:32.240

如果你之前设置了断点，那可能是你还有一个幻像断点。尝试选择“删除所有断点”，看看是否能解决问题。

还要检查您是否没有在选项下选择“中断所有错误”，并且您的错误处理程序运行正常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-21T18:56:02.487

信不信由你，这是一个已知问题。查看此 MS 支持链接：

[http://support.microsoft.com/kb/829059](http://support.microsoft.com/kb/829059)

我有同样的问题，在寻找解决方案时发现了它。由于它没有提供任何建议，我一直在搜索并偶然发现了您的帖子。如果我找到解决方案，我会回来更新。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-11T20:53:53.713

Jaquez 链接的 MS 页面暗示了答案；只要确保您没有最大化运行编辑器，问题就会消失。如果你将它恢复到非最大化状态，然后调整它的大小以占据整个屏幕，它应该记住它的位置。如果您只有一个小屏幕，那会很痛苦，但是在普通的大显示器上它可以正常工作，并且为我解决了这个问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T18:20:51.250

I have the same problem, except that it only occurs when I've gone in and unlocked the VBA project for editing and haven't restarted Outlook. It seems to open up when I get a new email (that's when my VBA runs) so basically I just have to restart Outlook and lock the project back up.

Sorry I don't know what's really causing it, but locking the VBA project should fix the problem...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-24T06:22:13.720

我的解决方案是搜索`.otm`我的 VBA 项目的文件。它存储在`data\microsoft\outlook`. 我关闭了 Outlook 并删除了该`.otm`文件。重新启动outlook，就解决了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-18T16:23:54.847

只是想补充一点，我在 excel 中遇到了 VBA 的幻象断点问题。清除所有断点对我不起作用，但我解决了如下问题：将所有内容从有问题的模块复制到文本文件中。删除模块。重新创建模块。复制回所有文本。节省。幻影断点消失了。

# java - 视频培训计划

> ID：472999
> 
> 赞同：1
> 
> 时间：2009-01-23T14:08:19.780
> 
> 标签：java, apache-flex, flash, video-capture

我正在寻找创建一个视频培训计划来记录视频 - 通过网络摄像头、用户屏幕捕获和捕获声音。现在的主要问题是我需要一个跨平台（mac 和 windows）的解决方案。

我知道它可以使用闪存来录制网络摄像头 + 音频。但它不可能通过闪存记录用户的屏幕。

所以我想知道我是否应该使用Java（我相信它可以在mac和windows上工作）。我不想开发单独的版本，因为开发两个版本涉及成本。

请指导我，因为我是新手。

谢谢你。

**更新**

再次问好，

我查看了以下站点：www.screencast-o-matic.com 或 www.screentoaster.com。我看到他们开发了一个 java 小程序，可以帮助与 Windows/Mac 交互以记录屏幕。

我想知道如何开发类似的东西并将其与 Flash 集成（用于网络摄像头和录音）。

这是一个更好的主意吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T14:29:16.913

这不是您问题的答案，但我强烈建议您不要将视频用于教育计划。我们公司在线提供大学课程，我们很早以前就了解到视频源仅在特定场景下有效。一般来说，一个会说话的脑袋是在浪费带宽。你最好把一个设计良好的PowerPoint演示文稿放在一起，录制一个画外音（并编辑它！），然后将整个东西组装成一个Flash演示文稿。这是一项不平凡的工作，但它为学生提供了一个更有趣的产品。

何时使用视频： 1) 当您展示动态的东西时 - 例如力学或化学。2）当您将场景或案例作为说明时——例如，针对高中教师的威胁降级技术。

当您解决屏幕录制问题时，请认真考虑是否需要全动态或是否可以摆脱静止图像。通常，动作会分散注意力，而带有良好配音的静止图像可能会更有效。（提示：在录制之前用巨大的鼠标指针替换鼠标指针——就像 Fox 用冰球做的那样）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T14:26:20.820

试试[CamStudio](http://sourceforge.net/project/showfiles.php?group_id=131922&package_id=144908&release_id=318532)。我不知道，它是否适用于 Mac，但在 Windows 上，这是我所知道的最佳解决方案。它是开源的，所以你可以使用它的源代码，如果你想:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T18:01:13.927

如果您希望构建一个自行完成所有录制和屏幕捕获的应用程序，那么您可以考虑将[Adob​​e AIR](http://www.adobe.com/products/air/)（本质上是在桌面上运行的 Flash）与[Merapi](http://merapiproject.net/)结合使用。Merapi 本质上是 Adob​​e AIR 和 Java 之间的桥梁。因此，例如，对于您的项目，您可能会使用 Java 来处理您无法在 AIR 中本机执行的较低级别（但仍然是跨平台）的事情，并使用 Merapi 将 Java 应用程序连接到您的 AIR UI。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T14:29:47.397

这绝不是一个简单的项目。让我们说出来吧。每个元素都有开源（和跨平台）选项，但没有（我知道）可以为你做所有事情。

我认为“最干净”的选择是使用 Flash 进行网络摄像头和音频，如您所说，并运行 VNC 服务器来发送屏幕视频......唯一的封闭平台代码将是 VNC 启动代码。这应该很容易维护！

这引发了一个问题，因为现在大多数人都在 NAT 防火墙后面。设置端口转发是一件很痛苦的事情。我之前使用过一个名为 Gitso 的应用程序，它允许人们连接到我并将他们的桌面发送到我的屏幕（以获得技术支持）。它基于 VNC，它真正做的只是在 VNC 连接之上添加另一层，所以不是我连接到它们，而是它们连接到我。这使得端口转发的整个业务不再是问题。

一旦你录制了所有内容，最后一个问题就是将它们重新同步在一起......可能不会那么难。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-03T06:04:05.263

好吧，[**Camtasia**](http://www.softwarecasa.com/camtasia-studio.html)提供了解决您的问题的解决方案。它可以记录屏幕上的活动以及网络摄像头视频，并将它们放在同一个播放器模板中。另一个屏幕录像机**DemoCreator**可以将屏幕录像发布为 Flash 电影，但不能录制网络摄像头。******`******************