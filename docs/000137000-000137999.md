# StackOverflow 问答 000137000-000137999

# windows - 最大化我的应用程序时未出现自动隐藏任务栏

> ID：137005
> 
> 赞同：4
> 
> 时间：2008-09-26T00:00:25.840
> 
> 标签：windows, taskbar

我的应用程序绘制了它自己的所有窗口边框和装饰。它适用于设置为自动隐藏的 Windows 任务栏，除非我的应用程序窗口最大化。任务栏不会“卷起”。如果我没有最大化应用程序，它会正常运行，即使一直调整到屏幕底部也是如此。如果我只是调整窗口大小以占据整个显示器（就好像它已最大化），它甚至可以正常工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T21:30:56.570

我发现了问题。我的应用程序正在处理 WM_GETMINMAXINFO 消息，并覆盖参数 MINMAXINFO 记录中的值。记录中的值按屏幕像素分辨率增加了 7（边框宽度）。这是有道理的，因为当最大化时，它会将窗口的边框推到屏幕的可见部分之外。它还将 ptMaxPosition（最大化时窗口原点设置的点）设置为 -7、-7。我的应用程序将其设置为 0,0，并将最大高度和宽度设置为屏幕分辨率大小（未膨胀）。不知道为什么这样做；是前任写的。如果我注释掉该代码并且不修改 MINMAXINFO 结构，则自动隐藏将起作用。

至于为什么，我不完全确定。弹出“自动隐藏”任务栏的检测可能与处理 WM_MOUSEMOVE 消息的机制挂钩，而不是 WM_NCMOUSEMOVE。由于我的应用程序导致最大化将我的边框停在屏幕底部，我本来会生成 WM_NCMOUSEMOVE 事件；单独使用 MINMAXINFO，我会生成 WM_MOUSEMOVE。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T00:38:09.540

这取决于是否在任务栏属性上选中了“将任务栏保持在其他窗口之上”。如果选中，则会出现任务栏。

但不要试图以编程方式更改最终用户机器上的此设置以满足您的需要，这被认为是粗鲁和不好的做法。您的应用程序应该适合它部署到的任何环境。

# php - 重新定义类方法或类

> ID：137006
> 
> 赞同：55
> 
> 时间：2008-09-26T00:00:45.060
> 
> 标签：php, class, methods, redefine

有没有办法在不使用典型继承的情况下重新定义一个类或它的一些方法？例如：

```
class third_party_library {
    function buggy_function() {
        return 'bad result';
    }
    function other_functions(){
        return 'blah';
    }
} 
```

我能做些什么来代替`buggy_function()`？显然这是我想做的

```
class third_party_library redefines third_party_library{
    function buggy_function() {
        return 'good result';
    }
    function other_functions(){
        return 'blah';
    }
} 
```

这正是我的困境：我更新了一个破坏我的代码的第三方库。我不想直接修改库，因为未来的更新可能会再次破坏代码。我正在寻找一种无缝方式来替换类方法。

我发现这个[图书馆](http://pecl.php.net/package/classkit)说它可以做到，但我很谨慎，因为它已经 4 岁了。

编辑：

我应该澄清一下，由于框架限制，我不能将类从`third_party_library`to`magical_third_party_library`或其他任何东西重命名。

出于我的目的，是否可以只向类添加一个函数？我认为您可以在 C# 中使用称为“部分类”的东西来做到这一点。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-26T00:07:31.737

这叫做[猴子补丁](http://en.wikipedia.org/wiki/Monkey_patch)。但是，PHP 没有对它的原生支持。

不过，正如其他人也指出的那样，[runkit 库](http://docs.php.net/runkit)可用于添加对语言的支持，并且是[classkit](http://docs.php.net/manual/en/book.classkit.php)的继承者。而且，尽管它的创建者似乎已经[放弃](http://pecl.php.net/package/runkit)了它（声称它与 PHP 5.2 及更高版本不兼容），但该项目现在似乎有了一个[新的家和维护者](https://github.com/zenovich/runkit)。

我仍然[不能说我是](https://stackoverflow.com/revisions/137028/3)它的方法的粉丝。在我看来，通过评估代码字符串来进行修改总是有潜在的危险并且难以调试。

尽管如此，[`runkit_method_redefine`](http://us2.php.net/manual/en/function.runkit-method-redefine.php)这似乎是您正在寻找的东西，并且可以[`/tests/runkit_method_redefine.phpt`](https://github.com/zenovich/runkit/blob/master/tests/runkit_method_redefine.phpt)在存储库中找到其使用示例：

```
runkit_method_redefine('third_party_library', 'buggy_function', '',
    'return \'good result\''
); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-06-10T21:20:58.320

runkit 似乎是一个不错的解决方案，但默认情况下未启用，其中部分仍处于试验阶段。所以我拼凑了一个小类，它替换了类文件中的函数定义。示例用法：

```
class Patch {

private $_code;

public function __construct($include_file = null) {
    if ( $include_file ) {
        $this->includeCode($include_file);
    }
}

public function setCode($code) {
    $this->_code = $code;
}

public function includeCode($path) {

    $fp = fopen($path,'r');
    $contents = fread($fp, filesize($path));
    $contents = str_replace('<?php','',$contents);
    $contents = str_replace('?>','',$contents);
    fclose($fp);        

    $this->setCode($contents);
}

function redefineFunction($new_function) {

    preg_match('/function (.+)\(/', $new_function, $aryMatches);
    $func_name = trim($aryMatches[1]);

    if ( preg_match('/((private|protected|public) function '.$func_name.'[\w\W\n]+?)(private|protected|public)/s', $this->_code, $aryMatches) ) {

        $search_code = $aryMatches[1];

        $new_code = str_replace($search_code, $new_function."\n\n", $this->_code);

        $this->setCode($new_code);

        return true;

    } else {

        return false;

    }

}

function getCode() {
    return $this->_code;
}
} 
```

然后包含要修改的类并重新定义其方法：

```
$objPatch = new Patch('path_to_class_file.php');
$objPatch->redefineFunction("
    protected function foo(\$arg1, \$arg2)
    {   
        return \$arg1+\$arg2;
    }"); 
```

然后评估新代码：

```
eval($objPatch->getCode()); 
```

有点粗糙，但它的工作原理！

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2017-07-22T23:29:18.697

对于仍在寻找此答案的人。

您应该将[extends](http://php.net/manual/en/reflection.extending.php)与[namespaces](http://php.net/manual/en/language.namespaces.php)结合使用。

像这样：

```
namespace MyCustomName;

class third_party_library extends \third_party_library {
  function buggy_function() {
      return 'good result';
  }
  function other_functions(){
      return 'blah';
  }
} 
```

然后像这样使用它：

```
use MyCustomName\third_party_library;

$test = new third_party_library();
$test->buggy_function();
//or static.
third_party_library::other_functions(); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-12-07T12:24:05.833

为了完整起见，在 PHP 中可以通过[runkit](http://docs.php.net/runkit)获得猴子补丁。有关详细信息，请参阅`runkit_method_redefine()`。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-12-08T07:40:12.240

如何将它包装在另一个类中

```
class Wrapper {
 private $third_party_library;
 function __construct() { $this->third_party_library = new Third_party_library(); }
 function __call($method, $args) {
  return call_user_func_array(array($this->third_party_library, $method), $args);
 }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T00:08:00.313

是的，它被称为`extend`：

```
<?php
class sd_third_party_library extends third_party_library
{
    function buggy_function() {
        return 'good result';
    }
    function other_functions(){
        return 'blah';
    }
} 
```

我以“sd”为前缀。;-)

请记住，当您扩展类以覆盖方法时，方法的签名必须与原始签名匹配。因此，例如，如果原来说`buggy_function($foo, $bar)`，它必须匹配扩展它的类中的参数。

PHP对此非常冗长。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T00:04:10.497

Zend Studio 和 PDT（基于 eclipse 的 ide）有一些内置的折射工具。但是没有内置的方法可以做到这一点。

此外，您根本不希望系统中有错误的代码。因为它可能会被错误地调用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-04-26T19:44:19.103

我已经从@JPhilly 的答案中修改了代码，并且可以重命名已修补的类以避免错误。

此外，我更改了标识即将被替换的函数的正则表达式，以适应被替换函数在其名称前没有任何类访问修饰符的情况

希望能帮助到你。

```
class Patch {

    private $_code;

    public function __construct($include_file = null) {
        if ( $include_file ) {
            $this->includeCode($include_file);
        }
    }

    public function setCode($code) {
        $this->_code = $code;
    }

    public function includeCode($path) {

        $fp = fopen($path,'r');
        $contents = fread($fp, filesize($path));
        $contents = str_replace('<?php','',$contents);
        $contents = str_replace('?>','',$contents);
        fclose($fp);        

        $this->setCode($contents);
    }

    function redefineFunction($new_function) {

        preg_match('/function ([^\(]*)\(/', $new_function, $aryMatches);
        $func_name = trim($aryMatches[1]);

        // capture the function with its body and replace it with the new function
        if ( preg_match('/((private|protected|public)?\s?function ' . $func_name .'[\w\W\n]+?)(private|protected|public|function|class)/s', $this->_code, $aryMatches) ) {

            $search_code = $aryMatches[1];

            $new_code = str_replace($search_code, $new_function."\n\n", $this->_code);

            $this->setCode($new_code);

            return true;

        } else {

            return false;

        }

    }
    function renameClass($old_name, $new_name) {

        $new_code = str_replace("class $old_name ", "class $new_name ", $this->_code);

        $this->setCode($new_code);

    }

    function getCode() {
        return $this->_code;
    }
} 
```

这就是我使用它来修补 Wordpress 插件的方式：

```
$objPatch = new Patch(ABSPATH . 'wp-content/plugins/a-plugin/code.php');
$objPatch->renameClass("Patched_AClass", "Patched_Patched_AClass"); // just to avoid class redefinition
$objPatch->redefineFunction("
    function default_initialize() {
        echo 'my patched function';
    }");
eval($objPatch->getCode());
$result = new Patched_AClass(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T00:14:59.847

如果库显式地创建了坏类而不使用定位器或依赖系统，那么你就不走运了。除非您子类化，否则无法覆盖另一个类的方法。解决方案可能是创建一个修复库的补丁文件，这样您就可以升级库并重新应用补丁来修复该特定方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T13:08:20.147

你也许可以用 runkit 做到这一点。[http://php.net/runkit](http://php.net/runkit)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-05-24T21:56:08.710

您可以制作库类的副本，除了类名之外的所有内容都相同。然后覆盖该重命名的类。

它并不完美，但它确实提高了扩展类更改的可见性。如果您使用 Composer 之类的工具获取库，则必须将副本提交到源代码管理并在更新库时对其进行更新。

就我而言，它是[https://github.com/bshaffer/oauth2-server-php](https://github.com/bshaffer/oauth2-server-php)的旧版本。我修改了库的自动加载器来获取我的类文件。我的类文件采用了原始名称并扩展了其中一个文件的复制版本。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-10-18T20:47:17.217

由于您始终可以访问 PHP 中的基本代码，因此请重新定义要覆盖的主要类函数，如下所示，这应该使您的接口保持不变：

```
class third_party_library {
    public static $buggy_function;
    public static $ranOnce=false;

    public function __construct(){
        if(!self::$ranOnce){
            self::$buggy_function = function(){ return 'bad result'; };
            self::$ranOnce=true;
        }
        .
        .
        .
    }
    function buggy_function() {
        return self::$buggy_function();
    }        
} 
```

您可能出于某种原因使用私有变量，但您只能通过扩展类或类内的逻辑来访问该函数。同样，您可能希望同一类的不同对象具有不同的功能。如果是这样，请不要使用静态，但通常您希望它是静态的，这样您就不会重复每个对象的内存使用。“ranOnce”代码只是确保您只需要为该类初始化一次，而不是为每个`$myObject = new third_party_library()`

现在，稍后在您的代码或其他类中 - 每当逻辑到达您需要覆盖函数的点时 - 只需执行以下操作：

```
$backup['buggy_function'] = third_party_library::$buggy_function;
third_party_library::$buggy_function = function(){
    //do stuff
    return $great_calculation;
}
.
.
.  //do other stuff that needs the override
.  //when finished, restore the original function
.
third_party_library::$buggy_function=$backup['buggy_function']; 
```

附带说明一下，如果您以这种方式执行所有类函数并使用这样的基于字符串的键/值存储，`public static $functions['function_name'] = function(...){...};`则可能对反射有用。虽然在 PHP 中不像其他语言那样多，因为您已经可以获取类和函数名称，但是您可以节省一些处理，并且您的类的未来用户可以在 PHP 中使用覆盖。然而，它是一个额外的间接级别，所以我会尽可能避免在原始类上使用它。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-26T00:10:12.103

总是用一种新的、正确的方法来扩展这个类，并调用那个类而不是那个有问题的类。

```
class my_better_class Extends some_buggy_class {
    function non_buggy_function() {
        return 'good result';
    }
} 
```

（对不起，糟糕的格式）

# c - 为什么我在使用 MATLAB 编译器时没有看到显着的加速？

> ID：137011
> 
> 赞同：9
> 
> 时间：2008-09-26T00:02:40.030
> 
> 标签：c, performance, matlab, matlab-compiler

我有很多很好的 MATLAB 代码，它们运行得太慢，用 C 重写会很痛苦。C 的 MATLAB 编译器似乎没有多大帮助，如果有的话。是否应该加快执行速度？我搞砸了吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-26T09:56:32.973

如果您使用的是[MATLAB 编译器](http://www.mathworks.com/products/compiler/)（在最新版本的 MATLAB 上），那么您几乎肯定不会看到任何加速。这是因为编译器实际上所做的只是为您提供了一种打包代码的方法，以便可以将其分发给没有 MATLAB 的人。它不会将其转换为更快的东西（例如机器代码或 C） - 它只是将其包装在 C 中，以便您可以调用它。

它通过让您的代码在本质上是 MATLAB 计算内核的 MATLAB Compiler Runtime (MCR) 上运行来实现这一点 - 您的代码仍在被解释。由于必须调用 MCR 所带来的损失，您可能会发现编译后的代码运行速度比在 MATLAB 上运行要慢。

换句话说——你可能会说编译器实际上并没有编译——至少在这个词的传统意义上。

旧版本的编译器工作方式不同，在某些情况下可能会出现加速。对于 Mathwork 的看法，请访问

[http://www.mathworks.com/support/solutions/data/1-1ARNS.html](http://www.mathworks.com/support/solutions/data/1-1ARNS.html)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-26T00:15:04.010

以我的经验，缓慢的 MATLAB 代码通常来自未对代码进行矢量化（即，编写 for 循环而不是仅仅将数组相乘（简单示例））。

如果您正在执行文件 I/O，请注意一次读取一个数据。在帮助文件中查找 fscanf 的矢量化版本。

不要忘记 MATLAB 也包含一个分析器！

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-26T04:16:49.217

我将回应 dwj 所说的话：如果您的 MATLAB 代码很慢，这可能是因为它没有充分矢量化。如果您在可以对整个数组执行操作时执行显式循环，那就是罪魁祸首。

这同样适用于所有面向数组的动态语言：Perl 数据语言、Numeric Python、MATLAB/Octave 等。在编译的 C 和 FORTRAN 编译代码中甚至在某种程度上也是如此：专门设计的向量化库通常使用精心手工编码的内部循环和 SIMD 指令（例如 MMX、SSE、AltiVec）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-10T22:23:44.247

首先，我支持上述所有关于分析和矢量化的评论。

从历史的角度来看...

旧版本的 Matlab 允许用户通过预先解析 m 代码并将其转换为一组 matlab 库调用来将 m 文件转换为 mex 函数。这些调用具有解释器所做的所有错误检查，但旧版本的解释器和/或在线解析器速度很慢，因此编译 m 文件有时会有所帮助。通常当你有循环时它会有所帮助，因为 Matlab 足够聪明，可以在 C 中内联其中的一些。如果你有这些版本的 Matlab 之一，你可以尝试告诉 mex 脚本保存 .c 文件，你可以确切地看到它是什么正在做。

在更新的版本中（可能是 2006a 及更高版本，但我不记得了），Mathworks 开始使用即时编译器作为解释器。实际上，这个 JIT 编译器会自动编译所有的 mex 函数，所以显式地离线执行它根本没有帮助。从那时起，在每个版本中，他们也付出了很多努力来提高解释器的速度。我相信较新版本的 Matlab 甚至不允许您将 m 文件自动编译为 mex 文件，因为它不再有意义。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-21T15:22:43.437

MATLAB 编译器封装您的 m 代码并将其分派到 MATLAB 运行时。因此，您在 MATLAB 中看到的性能应该是您在编译器中看到的性能。

根据其他答案，对代码进行矢量化很有帮助。但是，如今 MATLAB JIT 已经相当不错了，而且很多东西在矢量化方面的表现都大致相同。这并不是说矢量化没有性能优势，只是它不再是曾经的灵丹妙药。真正分辨的唯一方法是使用分析器找出您的代码在哪里遇到瓶颈。很多时候，您可以在某些地方进行本地重构以真正提高代码的性能。

您可以采用其他几种硬件方法来提高性能。首先，大部分线性代数子系统都是多线程的。如果您在多核或多处理器平台上工作，您可能需要确保已在首选项中启用该功能。其次，您可以使用并行计算工具箱来更多地利用多个处理器。最后，如果您是 Simulink 用户，您或许可以使用 emlmex 将 m-code 编译成 c。这对于定点工作特别有效。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-13T05:22:43.400

您是否尝试过分析您的代码？你不需要向量化你的所有代码，只需要控制运行时间的函数。MATLAB 分析器将为您提供一些关于您的代码花费最多时间的提示。

您应该阅读MathWorks 手册中[提高性能的技巧部分的许多其他内容。](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_prog/f8-784135.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-10T22:15:30.940

mcc 根本不会加速你的代码——它不是真正的编译器。

在你放弃之前，你需要运行分析器并弄清楚你所有的时间都花在了哪里（工具->打开分析器）。此外，明智地使用“tic”和“toc”会有所帮助。在你知道时间在哪里之前不要优化你的代码（不要试图猜测）。

请记住，在 matlab 中：

*   位级操作真的很慢
*   文件 I/O 很慢
*   循环通常很慢，但向量化很快（如果你不知道向量语法，学习它）
*   核心操作非常快（例如矩阵乘法，fft）
*   如果你认为你可以在 C/Fortran/etc 中做一些更快的事情，你可以写一个 MEX 文件
*   有将 matlab 转换为 C 的商业解决方案（谷歌“matlab to c”）并且它们有效

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-17T16:12:06.460

您可以将代码移植到“嵌入式 Matlab”，然后使用 Realtime-Workshop 将其翻译成 C。

嵌入式 Matlab 是 Matlab 的一个子集。它不支持元胞数组、图形、动态大小的 Marice 或某些矩阵寻址模式。移植到嵌入式 Matlab 可能需要付出相当大的努力。

Realtime-Workshop 是代码生成产品的核心。它提供通用 C，或者可以针对一系列嵌入式平台进行优化。您最感兴趣的可能是 xPC-Target，它将通用硬件视为嵌入式目标。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-10T17:09:03.730

我会投票支持分析+然后看看瓶颈是什么。

如果瓶颈是矩阵数学，你可能不会做得更好......除了一个大问题是数组分配。例如，如果你有一个循环：

```
s = [];
for i = 1:50000
  s(i) = 3;
end 
```

这必须不断调整数组的大小；预先调整数组的大小（从零或 NaN 开始）并从那里填充它要快得多：

```
s = zeros(50000,1);
for i = 1:50000
  s(i) = 3;
end 
```

如果瓶颈是重复执行大量函数调用，那就很难了。

如果瓶颈是 MATLAB 不能快速完成的事情（某些类型的解析、XML 等），那么我会使用 Java，因为 MATLAB 已经在 J​​VM 上运行并且它非常容易与任意 JAR 文件接口。我查看了与 C/C++ 的接口，它真的很难看。Microsoft COM 还可以（仅在 Windows 上），但在学习了 Java 之后，我认为我不会再回到那个状态了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T09:42:41.900

正如其他人所指出的，缓慢的 Matlab 代码通常是向量化不足的结果。

然而，有时即使是完美的矢量化代码也很慢。然后，您还有更多选择：

1.  看看是否有任何你可以使用的库/工具箱。这些通常写得非常优化。
2.  分析您的代码，找到漏洞并用纯 C 重写那些。将 C 代码（例如 DLL）连接到 Matlab 很容易，并且在文档中进行了介绍。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-26T03:12:37.423

通过 Matlab 编译器，您可能指的是命令 mcc，它通过绕过 Matlab 解释器来稍微加快代码速度。显着加速 MAtlab 代码（50-200 倍）的是使用由 mex 命令编译的实际 C 代码。

# php - 作为 XML 文档的 PHP 对象

> ID：137021
> 
> 赞同：50
> 
> 时间：2008-09-26T00:05:11.973
> 
> 标签：php, xml, xml-serialization

获取给定 PHP 对象并将其序列化为 XML 的最佳方法是什么？我正在查看 simple_xml 并使用它来将 XML 解析为对象，但我不清楚它是如何反过来工作的。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2010-02-03T19:21:25.270

我同意使用 PEAR 的 XML_Serializer，但是如果你想要一些简单的东西来支持具有嵌套属性的对象/数组，你可以使用它。

```
class XMLSerializer {

    // functions adopted from http://www.sean-barton.co.uk/2009/03/turning-an-array-or-object-into-xml-using-php/

    public static function generateValidXmlFromObj(stdClass $obj, $node_block='nodes', $node_name='node') {
        $arr = get_object_vars($obj);
        return self::generateValidXmlFromArray($arr, $node_block, $node_name);
    }

    public static function generateValidXmlFromArray($array, $node_block='nodes', $node_name='node') {
        $xml = '<?xml version="1.0" encoding="UTF-8" ?>';

        $xml .= '<' . $node_block . '>';
        $xml .= self::generateXmlFromArray($array, $node_name);
        $xml .= '</' . $node_block . '>';

        return $xml;
    }

    private static function generateXmlFromArray($array, $node_name) {
        $xml = '';

        if (is_array($array) || is_object($array)) {
            foreach ($array as $key=>$value) {
                if (is_numeric($key)) {
                    $key = $node_name;
                }

                $xml .= '<' . $key . '>' . self::generateXmlFromArray($value, $node_name) . '</' . $key . '>';
            }
        } else {
            $xml = htmlspecialchars($array, ENT_QUOTES);
        }

        return $xml;
    }

} 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-09-26T00:15:11.903

看看 PEAR 的[XML_Serializer](http://pear.php.net/package/XML_Serializer)包。我用它取得了很好的效果。您可以向它提供数组、对象等，它会将它们转换为 XML。它还有很多选项，比如选择根节点的名称等。

应该做的伎俩

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-01-21T09:35:42.453

不是原始问题的答案，但我解决这个问题的方法是将我的对象声明为：

```
$root = '<?xml version="1.0" encoding="UTF-8"?><Activities/>';
$object = new simpleXMLElement($root); 
```

相对于：

```
$object = new stdClass; 
```

在我开始添加任何值之前！

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-26T00:10:20.433

使用 dom 函数来做到这一点： [http ://www.php.net/manual/en/function.dom-import-simplexml.php](http://www.php.net/manual/en/function.dom-import-simplexml.php)

导入 SimpleXML 对象，然后保存。上面的链接包含一个示例。:)

简而言之：

```
<?php
$array = array('hello' => 'world', 'good' => 'morning');

$xml = simplexml_load_string("<?xml version='1.0' encoding='utf-8'?><foo />");
foreach ($array as $k=>$v) {
  $xml->addChild($k, $v);
}
?> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-04-04T13:33:30.940

看看我的版本

```
 class XMLSerializer {

    /**
     * 
     * The most advanced method of serialization.
     * 
     * @param mixed $obj => can be an objectm, an array or string. may contain unlimited number of subobjects and subarrays
     * @param string $wrapper => main wrapper for the xml
     * @param array (key=>value) $replacements => an array with variable and object name replacements
     * @param boolean $add_header => whether to add header to the xml string
     * @param array (key=>value) $header_params => array with additional xml tag params
     * @param string $node_name => tag name in case of numeric array key
     */
    public static function generateValidXmlFromMixiedObj($obj, $wrapper = null, $replacements=array(), $add_header = true, $header_params=array(), $node_name = 'node') 
    {
        $xml = '';
        if($add_header)
            $xml .= self::generateHeader($header_params);
        if($wrapper!=null) $xml .= '<' . $wrapper . '>';
        if(is_object($obj))
        {
            $node_block = strtolower(get_class($obj));
            if(isset($replacements[$node_block])) $node_block = $replacements[$node_block];
            $xml .= '<' . $node_block . '>';
            $vars = get_object_vars($obj);
            if(!empty($vars))
            {
                foreach($vars as $var_id => $var)
                {
                    if(isset($replacements[$var_id])) $var_id = $replacements[$var_id];
                    $xml .= '<' . $var_id . '>';
                    $xml .= self::generateValidXmlFromMixiedObj($var, null, $replacements,  false, null, $node_name);
                    $xml .= '</' . $var_id . '>';
                }
            }
            $xml .= '</' . $node_block . '>';
        }
        else if(is_array($obj))
        {
            foreach($obj as $var_id => $var)
            {
                if(!is_object($var))
                {
                    if (is_numeric($var_id)) 
                        $var_id = $node_name;
                    if(isset($replacements[$var_id])) $var_id = $replacements[$var_id]; 
                    $xml .= '<' . $var_id . '>';    
                }   
                $xml .= self::generateValidXmlFromMixiedObj($var, null, $replacements,  false, null, $node_name);
                if(!is_object($var))
                    $xml .= '</' . $var_id . '>';
            }
        }
        else
        {
            $xml .= htmlspecialchars($obj, ENT_QUOTES);
        }

        if($wrapper!=null) $xml .= '</' . $wrapper . '>';

        return $xml;
    }   

    /**
     * 
     * xml header generator
     * @param array $params
     */
    public static function generateHeader($params = array())
    {
        $basic_params = array('version' => '1.0', 'encoding' => 'UTF-8');
        if(!empty($params))
            $basic_params = array_merge($basic_params,$params);

        $header = '<?xml';
        foreach($basic_params as $k=>$v)
        {
            $header .= ' '.$k.'='.$v;
        }
        $header .= ' ?>';
        return $header;
    }    
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-27T10:01:02.413

使用 WDDX： [http ://uk.php.net/manual/en/wddx.examples.php](http://uk.php.net/manual/en/wddx.examples.php)

（如果安装了这个扩展）

它致力于：

[http://www.openwddx.org/](http://www.openwddx.org/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-11-02T11:30:34.467

这是我的代码，用于将 PHP 对象序列化为 Microsoft .NET XmlSerializer.Deserialize “可理解”的 XML

```
class XMLSerializer {

    /**
     * Get object class name without namespace
     * @param object $object Object to get class name from
     * @return string Class name without namespace
     */
    private static function GetClassNameWithoutNamespace($object) {
        $class_name = get_class($object);
        return end(explode('\\', $class_name));
    }

    /**
     * Converts object to XML compatible with .NET XmlSerializer.Deserialize 
     * @param type $object Object to serialize
     * @param type $root_node Root node name (if null, objects class name is used)
     * @return string XML string
     */
    public static function Serialize($object, $root_node = null) {
        $xml = '<?xml version="1.0" encoding="UTF-8" ?>';
        if (!$root_node) {
            $root_node = self::GetClassNameWithoutNamespace($object);
        }
        $xml .= '<' . $root_node . ' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">';
        $xml .= self::SerializeNode($object);
        $xml .= '</' . $root_node . '>';
        return $xml;
    }

    /**
     * Create XML node from object property
     * @param mixed $node Object property
     * @param string $parent_node_name Parent node name
     * @param bool $is_array_item Is this node an item of an array?
     * @return string XML node as string
     * @throws Exception
     */
    private static function SerializeNode($node, $parent_node_name = false, $is_array_item = false) {
        $xml = '';
        if (is_object($node)) {
            $vars = get_object_vars($node);
        } else if (is_array($node)) {
            $vars = $node;
        } else {
            throw new Exception('Coś poszło nie tak');
        }

        foreach ($vars as $k => $v) {
            if (is_object($v)) {
                $node_name = ($parent_node_name ? $parent_node_name : self::GetClassNameWithoutNamespace($v));
                if (!$is_array_item) {
                    $node_name = $k;
                }
                $xml .= '<' . $node_name . '>';
                $xml .= self::SerializeNode($v);
                $xml .= '</' . $node_name . '>';
            } else if (is_array($v)) {
                $xml .= '<' . $k . '>';
                if (count($v) > 0) {
                    if (is_object(reset($v))) {
                        $xml .= self::SerializeNode($v, self::GetClassNameWithoutNamespace(reset($v)), true);
                    } else {
                        $xml .= self::SerializeNode($v, gettype(reset($v)), true);
                    }
                } else {
                    $xml .= self::SerializeNode($v, false, true);
                }
                $xml .= '</' . $k . '>';
            } else {
                $node_name = ($parent_node_name ? $parent_node_name : $k);
                if ($v === null) {
                    continue;
                } else {
                    $xml .= '<' . $node_name . '>';
                    if (is_bool($v)) {
                        $xml .= $v ? 'true' : 'false';
                    } else {
                        $xml .= htmlspecialchars($v, ENT_QUOTES);
                    }
                    $xml .= '</' . $node_name . '>';
                }
            }
        }
        return $xml;
    }
} 
```

例子：

```
class GetProductsCommandResult {
    public $description;
    public $Errors;
}

class Error {
    public $id;
    public $error;
}

$obj = new GetProductsCommandResult();
$obj->description = "Teścik";
$obj->Errors = array();
$obj->Errors[0] = new Error();
$obj->Errors[0]->id = 666;
$obj->Errors[0]->error = "Sth";
$obj->Errors[1] = new Error();
$obj->Errors[1]->id = 666;
$obj->Errors[1]->error = null;

$xml = XMLSerializer::Serialize($obj); 
```

结果是：

```
<?xml version="1.0" encoding="UTF-8"?>
<GetProductsCommandResult xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
   <description>Teścik</description>
   <Errors>
      <Error>
         <id>666</id>
         <error>Sth</error>
      </Error>
      <Error>
         <id>666</id>
      </Error>
   </Errors>
</GetProductsCommandResult> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-06-30T17:40:28.183

我知道这是一个老问题，但最近我不得不生成复杂的 XML 结构。

我的方法包含高级 OOP 原则。这个想法是序列化包含多个孩子和子孩子的父对象。

节点从类名中获取名称，但您可以在创建用于序列化的对象时使用第一个参数覆盖类名。

您可以创建：一个 Simple 节点，没有子节点，EntityList 和 ArrayList。EntityList 是同一类的对象的列表，但 ArrayList 可能有不同的对象。

每个对象都必须扩展抽象类*SerializeXmlAbstract*以匹配类中的第一个输入参数： Object2xml, method `serialize($object, $name = NULL, $prefix = FALSE)`。

默认情况下，如果您不提供第二个参数，根 XML 节点将具有给定对象的类名。第三个参数表示根节点名称是否有前缀。前缀被硬编码为 Export2xml 类中的私有属性。

```
interface SerializeXml {

    public function hasAttributes();

    public function getAttributes();

    public function setAttributes($attribs = array());

    public function getNameOwerriden();

    public function isNameOwerriden();
}

abstract class SerializeXmlAbstract implements SerializeXml {

    protected $attributes;
    protected $nameOwerriden;

    function __construct($name = NULL) {
        $this->nameOwerriden = $name;
    }

    public function getAttributes() {
        return $this->attributes;
    }

    public function getNameOwerriden() {
        return $this->nameOwerriden;
    }

    public function setAttributes($attribs = array()) {
        $this->attributes = $attribs;
    }

    public function hasAttributes() {
        return (is_array($this->attributes) && count($this->attributes) > 0) ? TRUE : FALSE;
    }

    public function isNameOwerriden() {
        return $this->nameOwerriden != NULL ? TRUE : FALSE;
    }

}

abstract class Entity_list extends SplObjectStorage {

    protected $_listItemType;

    public function __construct($type) {
        $this->setListItemType($type);
    }

    private function setListItemType($param) {
        $this->_listItemType = $param;
    }

    public function detach($object) {
        if ($object instanceOf $this->_listItemType) {
            parent::detach($object);
        }
    }

    public function attach($object, $data = null) {
        if ($object instanceOf $this->_listItemType) {
            parent::attach($object, $data);
        }
    }

}

abstract class Array_list extends SerializeXmlAbstract {

    protected $_listItemType;
    protected $_items;

    public function __construct() {
        //$this->setListItemType($type);
        $this->_items = new SplObjectStorage();
    }

    protected function setListItemType($param) {
        $this->_listItemType = $param;
    }

    public function getArray() {
        $return = array();
        $this->_items->rewind();
        while ($this->_items->valid()) {
            $return[] = $this->_items->current();
            $this->_items->next();
        }
        // print_r($return);
        return $return;
    }

    public function detach($object) {
        if ($object instanceOf $this->_listItemType) {
            if (in_array($this->_items->contains($object))) {
                $this->_items->detach($object);
            }
        }
    }

    public function attachItem($ob) {
        $this->_items->attach($ob);
    }

}

class Object2xml {

    public $rootPrefix = "ernm";
    private $addPrefix;
    public $xml;

    public function serialize($object, $name = NULL, $prefix = FALSE) {
        if ($object instanceof SerializeXml) {
            $this->xml = new DOMDocument('1.0', 'utf-8');
            $this->xml->appendChild($this->object2xml($object, $name, TRUE));
            $this->xml->formatOutput = true;
            echo $this->xml->saveXML();
        } else {
            die("Not implement SerializeXml interface");
        }
    }

    protected function object2xml(SerializeXmlAbstract $object, $nodeName = NULL, $prefix = null) {
        $single = property_exists(get_class($object), "value");
        $nName = $nodeName != NULL ? $nodeName : get_class($object);

        if ($prefix) {
            $nName = $this->rootPrefix . ":" . $nName;
        }
        if ($single) {
            $ref = $this->xml->createElement($nName);
        } elseif (is_object($object)) {
            if ($object->isNameOwerriden()) {
                $nodeName = $object->getNameOwerriden();
            }
            $ref = $this->xml->createElement($nName);
            if ($object->hasAttributes()) {
                foreach ($object->getAttributes() as $key => $value) {
                    $ref->setAttribute($key, $value);
                }
            }
            foreach (get_object_vars($object) as $n => $prop) {
                switch (gettype($prop)) {
                    case "object":
                        if ($prop instanceof SplObjectStorage) {
                            $ref->appendChild($this->handleList($n, $prop));
                        } elseif ($prop instanceof Array_list) {
                            $node = $this->object2xml($prop);
                            foreach ($object->ResourceGroup->getArray() as $key => $value) {
                                $node->appendChild($this->object2xml($value));
                            }
                            $ref->appendChild($node);
                        } else {
                            $ref->appendChild($this->object2xml($prop));
                        }
                        break;
                    default :
                        if ($prop != null) {
                            $ref->appendChild($this->xml->createElement($n, $prop));
                        }
                        break;
                }
            }
        } elseif (is_array($object)) {
            foreach ($object as $value) {
                $ref->appendChild($this->object2xml($value));
            }
        }
        return $ref;
    }

    private function handleList($name, SplObjectStorage $param, $nodeName = NULL) {
        $lst = $this->xml->createElement($nodeName == NULL ? $name : $nodeName);
        $param->rewind();
        while ($param->valid()) {
            if ($param->current() != null) {
                $lst->appendChild($this->object2xml($param->current()));
            }
            $param->next();
        }
        return $lst;
    }
} 
```

这是您需要能够从对象中获取有效 xml 的代码。下一个示例生成此 xml：

```
<InsertMessage priority="high">
  <NodeSimpleValue firstAttrib="first" secondAttrib="second">simple value</NodeSimpleValue>
  <Arrarita>
    <Title>PHP OOP is great</Title>
    <SequenceNumber>1</SequenceNumber>
    <Child>
      <FirstChild>Jimmy</FirstChild>
    </Child>
    <Child2>
      <FirstChild>bird</FirstChild>
    </Child2>
  </Arrarita>
  <ThirdChild>
    <NodeWithChilds>
      <FirstChild>John</FirstChild>
      <ThirdChild>James</ThirdChild>
    </NodeWithChilds>
    <NodeWithChilds>
      <FirstChild>DomDocument</FirstChild>
      <SecondChild>SplObjectStorage</SecondChild>
    </NodeWithChilds>
  </ThirdChild>
</InsertMessage> 
```

此 xml 所需的类是：

```
class NodeWithArrayList extends Array_list {

    public $Title;
    public $SequenceNumber;

    public function __construct($name = NULL) {
        echo $name;
        parent::__construct($name);
    }

}

class EntityListNode extends Entity_list {

    public function __construct($name = NULL) {
        parent::__construct($name);
    }

}

class NodeWithChilds extends SerializeXmlAbstract {

    public $FirstChild;
    public $SecondChild;
    public $ThirdChild;

    public function __construct($name = NULL) {
        parent::__construct($name);
    }

}

class NodeSimpleValue extends SerializeXmlAbstract {

    protected $value;

    public function getValue() {
        return $this->value;
    }

    public function setValue($value) {
        $this->value = $value;
    }

    public function __construct($name = NULL) {
        parent::__construct($name);
    }
} 
```

最后实例化对象的代码是：

```
$firstChild = new NodeSimpleValue("firstChild");
$firstChild->setValue( "simple value" );
$firstChild->setAttributes(array("firstAttrib" => "first", "secondAttrib" => "second"));

$secondChild = new NodeWithArrayList("Arrarita");       
$secondChild->Title = "PHP OOP is great";
$secondChild->SequenceNumber = 1;   

$firstListItem = new NodeWithChilds();
$firstListItem->FirstChild = "John";
$firstListItem->ThirdChild = "James";

$firstArrayItem = new NodeWithChilds("Child");
$firstArrayItem->FirstChild = "Jimmy";

$SecondArrayItem = new NodeWithChilds("Child2");   
$SecondArrayItem->FirstChild = "bird";

$secondListItem = new NodeWithChilds();
$secondListItem->FirstChild = "DomDocument";
$secondListItem->SecondChild = "SplObjectStorage";

$secondChild->attachItem($firstArrayItem);
$secondChild->attachItem($SecondArrayItem);

$list = new EntityListNode("NodeWithChilds");
$list->attach($firstListItem);
$list->attach($secondListItem);

$message = New NodeWithChilds("InsertMessage");
$message->setAttributes(array("priority" => "high"));
$message->FirstChild = $firstChild;
$message->SecondChild = $secondChild;
$message->ThirdChild = $list;

$object2xml = new Object2xml();
$object2xml->serialize($message, "xml", TRUE); 
```

希望它会帮助某人。

干杯，西尼沙

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-09-15T23:04:08.870

使用递归方法，如下所示：

```
private function ReadProperty($xmlElement, $object) {
    foreach ($object as $key => $value) {
        if ($value != null) {
            if (is_object($value)) {
                $element = $this->xml->createElement($key);
                $this->ReadProperty($element, $value);
                $xmlElement->AppendChild($element);
            } elseif (is_array($value)) {
                $this->ReadProperty($xmlElement, $value);
            } else {
                $this->AddAttribute($xmlElement, $key, $value);
            }
        }
    }
} 
```

这里是完整的例子： [http ://www.tyrodeveloper.com/2018/09/convertir-clase-en-xml-con-php.html](http://www.tyrodeveloper.com/2018/09/convertir-clase-en-xml-con-php.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-01-08T15:09:00.413

我最近创建了一个通过 git 可用的类来解决这个问题：

[https://github.com/zappz88/XMLSerializer](https://github.com/zappz88/XMLSerializer)

这是类结构，请记住，您需要正确定义根以格式化正确的 xml：

```
class XMLSerializer {
    private $OpenTag = "<";
    private $CloseTag = ">";
    private $BackSlash = "/";
    public $Root = "root";

    public function __construct() {
    }

    private function Array_To_XML($array, $arrayElementName = "element_", $xmlString = "")
    {
        if($xmlString === "")
        {
            $xmlString = "{$this->OpenTag}{$this->Root}{$this->CloseTag}";
        }
        $startTag = "{$this->OpenTag}{$arrayElementName}{$this->CloseTag}";
        $xmlString .= $startTag;
        foreach($array as $key => $value){
            if(gettype($value) === "string" || gettype($value) === "boolean" || gettype($value) === "integer" || gettype($value) === "double" || gettype($value) === "float")
            {
                $elementStartTag = "{$this->OpenTag}{$arrayElementName}_{$key}{$this->CloseTag}";
                $elementEndTag = "{$this->OpenTag}{$this->BackSlash}{$arrayElementName}_{$key}{$this->CloseTag}";
                $xmlString .= "{$elementStartTag}{$value}{$elementEndTag}";
                continue;
            }
            else if(gettype($value) === "array")
            {
                $xmlString = $this->Array_To_XML($value, $arrayElementName, $xmlString);
                continue;
            }
            else if(gettype($value) === "object")
            {
                $xmlString = $this->Object_To_XML($value, $xmlString);
                continue;
            }
            else
            {                
                continue;
            }
        }
        $endTag = "{$this->OpenTag}{$this->BackSlash}{$arrayElementName}{$this->CloseTag}";
        $xmlString .= $endTag;
        return $xmlString;
    }

    private function Object_To_XML($objElement, $xmlString = "")
    {
        if($xmlString === "")
        {
            $xmlString = "{$this->OpenTag}{$this->Root}{$this->CloseTag}";
        }
        foreach($objElement as $key => $value){
            if(gettype($value) !== "array" && gettype($value) !== "object")
            {
                $startTag = "{$this->OpenTag}{$key}{$this->CloseTag}";
                $endTag = "{$this->OpenTag}{$this->BackSlash}{$key}{$this->CloseTag}";
                $xmlString .= "{$startTag}{$value}{$endTag}";
                continue;
            }
            else if(gettype($value) === "array")
            {
                $xmlString = $this->Array_To_XML($value, $key, $xmlString);
                continue;
            }
            else if(gettype($value) === "object")
            {
                $xmlString = $this->Object_To_XML($value, $xmlString);
                continue;
            }
            else
            { 
                continue;
            }
        }
        return $xmlString;
    }

    public function Serialize_Object($element, $xmlString = "")
    {
        $endTag = "{$this->OpenTag}{$this->BackSlash}{$this->Root}{$this->CloseTag}";
        return "{$this->Object_To_XML($element, $xmlString)}{$endTag}";
    }

    public function Serialize_Array($element, $xmlString = "")
    {
        $endTag = "{$this->OpenTag}{$this->BackSlash}{$this->Root}{$this->CloseTag}";
        return "{$this->Array_To_XML($element, $xmlString)}{$endTag}";
    }
} 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2011-07-26T23:59:32.033

虽然我同意@philfreo 和他的推理，即你不应该依赖 PEAR，但他的解决方案仍然不完全存在。当键可能是包含以下任何字符的字符串时，可能会出现问题：

*   <
*   >
*   \s（空格）
*   "
*   '

任何这些都会抛弃格式，因为 XML 在其语法中使用这些字符。因此，事不宜迟，这里有一个简单的解决方案来解决这种非常可能发生的情况：

```
function xml_encode( $var, $indent = false, $i = 0 ) {
    $version = "1.0";
    if ( !$i ) {
        $data = '<?xml version="1.0"?>' . ( $indent ? "\r\n" : '' )
                . '<root vartype="' . gettype( $var ) . '" xml_encode_version="'. $version . '">' . ( $indent ? "\r\n" : '' );
    }
    else {
        $data = '';
    }

    foreach ( $var as $k => $v ) {
        $data .= ( $indent ? str_repeat( "\t", $i ) : '' ) . '<var vartype="' .gettype( $v ) . '" varname="' . htmlentities( $k ) . '"';

        if($v == "") {
            $data .= ' />';
        }
        else {
            $data .= '>';
            if ( is_array( $v ) ) {
                $data .= ( $indent ? "\r\n" : '' ) . xml_encode( $v, $indent, $verbose, ($i + 1) ) . ( $indent ? str_repeat("\t", $i) : '' );
            }
            else if( is_object( $v ) ) {
                $data .= ( $indent ? "\r\n" : '' ) . xml_encode( json_decode( json_encode( $v ), true ), $indent, $verbose, ($i + 1)) . ($indent ? str_repeat("\t", $i) : '');
            }
            else {
                $data .= htmlentities( $v );
            }

            $data .= '</var>';
        }

        $data .= ($indent ? "\r\n" : '');
    }

    if ( !$i ) {
        $data .= '</root>';
    }

    return $data;
} 
```

这是一个示例用法：

```
// sample object
$tests = Array(
    "stringitem" => "stringvalue",
    "integeritem" => 1,
    "floatitem" => 1.00,
    "arrayitems" =>  Array("arrayvalue1", "arrayvalue2"),
    "hashitems" => Array( "hashkey1" => "hashkey1value", "hashkey2" => "hashkey2value" ),
    "literalnull" => null,
    "literalbool" => json_decode( json_encode( 1 ) )
);
// add an objectified version of itself as a child
$tests['objectitem'] = json_decode( json_encode( $tests ), false);

// convert and output
echo xml_encode( $tests );

/*
// output:

<?xml version="1.0"?>
<root vartype="array" xml_encode_version="1.0">
<var vartype="integer" varname="integeritem">1</var>
<var vartype="string" varname="stringitem">stringvalue</var>
<var vartype="double" varname="floatitem">1</var>
<var vartype="array" varname="arrayitems">
    <var vartype="string" varname="0">arrayvalue1</var>
    <var vartype="string" varname="1">arrayvalue2</var>
</var>
<var vartype="array" varname="hashitems">
    <var vartype="string" varname="hashkey1">hashkey1value</var>
    <var vartype="string" varname="hashkey2">hashkey2value</var>
</var>
<var vartype="NULL" varname="literalnull" />
<var vartype="integer" varname="literalbool">1</var>
<var vartype="object" varname="objectitem">
    <var vartype="string" varname="stringitem">stringvalue</var>
    <var vartype="integer" varname="integeritem">1</var>
    <var vartype="integer" varname="floatitem">1</var>
    <var vartype="array" varname="arrayitems">
        <var vartype="string" varname="0">arrayvalue1</var>
        <var vartype="string" varname="1">arrayvalue2</var>
    </var>
    <var vartype="array" varname="hashitems">
        <var vartype="string" varname="hashkey1">hashkey1value</var>
        <var vartype="string" varname="hashkey2">hashkey2value</var>
    </var>
    <var vartype="NULL" varname="literalnull" />
    <var vartype="integer" varname="literalbool">1</var>
</var>
</root>

*/ 
```

请注意，键名存储在 varname 属性中（html 编码），甚至存储类型，因此可以进行对称反序列化。这只有一个问题：它不会序列化类，只有实例化的对象，它不会包含类方法。这仅适用于来回传递“数据”。

我希望这对某人有所帮助，即使这是很久以前回答的。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-09-26T00:12:48.663

好吧，虽然有点脏，但你总是可以在对象的属性上运行一个循环......

```
$_xml = '';
foreach($obj as $key => $val){
  $_xml .= '<' . $key . '>' . $val . '</' . $key . ">\n";
} 
```

使用 fopen/fwrite/fclose 您可以生成一个以`$_xml`变量为内容的 XML 文档。这很丑陋，但它会起作用。

# c# - 如何以编程方式确定我是否具有在 .Net 中使用 C# 的写入权限？

> ID：137031
> 
> 赞同：5
> 
> 时间：2008-09-26T00:08:45.337
> 
> 标签：c#, .net, networking, file-permissions

如何使用 .Net 中的 C# 确定我是否对 Intranet 中的远程计算机具有写入权限？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T00:28:16.443

简单的答案是试试看。Windows 安全 API 不适合胆小的人，您可能拥有写权限而没有查看权限的权限！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T08:02:28.333

我也去过那里，我发现的最好和最可靠的解决方案是：

```
bool hasWriteAccess = true;
string remoteFileName = "\\server\share\file.name"

try
{
    createRemoteFile(remoteFileName);   
}
catch (SystemSecurityException)
{
     hasWriteAccess = false;   
}

if (File.Exists(remoteFileName))
{
    File.Delete(remoteFileName);
}

return hasWriteAccess; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T00:41:21.310

看看这个论坛帖子。

[http://bytes.com/forum/thread389514.html](http://bytes.com/forum/thread389514.html)

它描述了使用[System.Security.AccessControl](http://msdn.microsoft.com/en-us/library/system.security.accesscontrol(VS.80).aspx)命名空间中的对象来获取文件的 ACL 权限列表。它仅在 .NET 2.0 及更高版本中可用。我认为它还假设您有一个 SMB 网络。如果您使用的是非 Windows 网络，我不确定它会做什么。

如果您使用的不是 .NET 2.0 或更高版本，那就是通常的 pInvoke 和 Win32 API jazz。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T01:14:15.303

ScottKoon 写的是关于检查 Windows ACL 权限的文章。您还可以使用 CAS（代码访问安全）检查托管代码权限。这是限制权限的 .Net 特定方法。请注意，如果用户没有写权限，那么代码将永远不会有写权限（即使 CAS 说有） - 两者之间最严格的权限获胜。

CAS 非常易于使用——您甚至可以在方法的开头添加声明性属性。[您可以在MSDN](http://msdn.microsoft.com/en-us/library/930b76w0(VS.71).aspx)上阅读更多内容

# c++ - 如何从 gcc 中的 C/C++ 源代码获取汇编程序输出？

> ID：137038
> 
> 赞同：467
> 
> 时间：2008-09-26T00:10:21.527
> 
> 标签：c++, c, debugging, gcc, assembly

如何做到这一点？

如果我想分析某些东西是如何编译的，我将如何获得发出的汇编代码？

* * *

## 回答 #1

> 赞同：521
> 
> 时间：2008-09-26T00:19:43.220

使用`-S`gcc（或 g++）的选项。

```
gcc -S helloworld.c 
```

这将在 helloworld.c 上运行预处理器 (cpp)，执行初始编译，然后在运行汇编器之前停止。

默认情况下，这将输出一个文件`helloworld.s`。仍然可以使用该`-o`选项设置输出文件。

```
gcc -S -o my_asm_output.s helloworld.c 
```

当然，这仅在您拥有原始来源时才有效。如果您只有生成的目标文件，另一种方法是使用`objdump`，通过设置`--disassemble`选项（或`-d`缩写形式）。

```
objdump -S --disassemble helloworld > helloworld.dump 
```

如果为目标文件启用了调试选项（`-g`在编译时）并且该文件没有被剥离，则此选项效果最佳。

运行`file helloworld`将为您提供一些关于使用 objdump 将获得的详细程度的指示。

* * *

## 回答 #2

> 赞同：195
> 
> 时间：2008-09-26T02:51:05.243

这将生成 C 代码 + 行号交织的汇编代码，以便更轻松地查看哪些行生成了哪些代码：

```
# create assembler code:
g++ -S -fverbose-asm -g -O2 test.cc -o test.s
# create asm interlaced with source lines:
as -alhnd test.s > test.lst 
```

[可在程序员的算法中](http://www.jjj.de/fxt/fxtbook.pdf)找到，第 3 页（这是 PDF 的第 15 页）。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2013-09-29T22:07:28.830

以下命令行来自[Christian Garbin 的博客](http://christiangarbin.blogspot.com/2013/05/c-generating-assembly-code-with-gccg.html)

```
g++ -g -O -Wa,-aslh horton_ex2_05.cpp >list.txt 
```

我从 Win-XP 上的 DOS 窗口运行 G++，针对包含隐式转换的例程

```
c:\gpp_code>g++ -g -O -Wa,-aslh horton_ex2_05.cpp >list.txt
horton_ex2_05.cpp: In function `int main()':
horton_ex2_05.cpp:92: warning: assignment to `int' from `double' 
```

输出是与原始 C++ 代码交叉的汇编生成代码（C++ 代码在生成的 asm 流中显示为注释）

```
 16:horton_ex2_05.cpp **** using std::setw;
  17:horton_ex2_05.cpp ****
  18:horton_ex2_05.cpp **** void disp_Time_Line (void);
  19:horton_ex2_05.cpp ****
  20:horton_ex2_05.cpp **** int main(void)
  21:horton_ex2_05.cpp **** {
 164                    %ebp
 165                            subl $128,%esp
?GAS LISTING C:\DOCUME~1\CRAIGM~1\LOCALS~1\Temp\ccx52rCc.s
166 0128 55                    call ___main
167 0129 89E5          .stabn 68,0,21,LM2-_main
168 012b 81EC8000      LM2:
168      0000
169 0131 E8000000      LBB2:
169      00
170                    .stabn 68,0,25,LM3-_main
171                    LM3:
172                            movl $0,-16(%ebp) 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-09-26T00:11:06.203

使用 -S 开关

```
g++ -S main.cpp 
```

或者也可以使用 gcc

```
gcc -S main.c 
```

也看到[这个](http://www.delorie.com/djgpp/v2faq/faq8_20.html)

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2019-06-28T06:28:07.303

**`-save-temps`**

在[https://stackoverflow.com/a/17083009/895245](https://stackoverflow.com/a/17083009/895245)中提到了这一点，但让我进一步举例说明。

这个选项的最大优点`-S`是很容易将它添加到任何构建脚本中，而不会过多地干扰构建本身。

当你这样做时：

```
gcc -save-temps -c -o main.o main.c 
```

主程序

```
#define INC 1

int myfunc(int i) {
    return i + INC;
} 
```

现在，除了正常的输出之外`main.o`，当前工作目录还包含以下文件：

*   `main.i`是一个奖励，包含预处理文件：

    ```
    # 1 "main.c"
    # 1 "<built-in>"
    # 1 "<command-line>"
    # 31 "<command-line>"
    # 1 "/usr/include/stdc-predef.h" 1 3 4
    # 32 "<command-line>" 2
    # 1 "main.c"

    int myfunc(int i) {
        return i + 1;
    } 
    ```

*   `main.s`包含所需的生成程序集：

    ```
     .file   "main.c"
        .text
        .globl  myfunc
        .type   myfunc, @function
    myfunc:
    .LFB0:
        .cfi_startproc
        pushq   %rbp
        .cfi_def_cfa_offset 16
        .cfi_offset 6, -16
        movq    %rsp, %rbp
        .cfi_def_cfa_register 6
        movl    %edi, -4(%rbp)
        movl    -4(%rbp), %eax
        addl    $1, %eax
        popq    %rbp
        .cfi_def_cfa 7, 8
        ret
        .cfi_endproc
    .LFE0:
        .size   myfunc, .-myfunc
        .ident  "GCC: (Ubuntu 8.3.0-6ubuntu1) 8.3.0"
        .section    .note.GNU-stack,"",@progbits 
    ```

如果要对大量文件执行此操作，请考虑改用：

```
 -save-temps=obj 
```

它将中间文件保存到与对象输出相同的目录`-o`而不是当前工作目录，从而避免潜在的基本名称冲突。

这个选项的另一个很酷的事情是如果你添加`-v`：

```
gcc -save-temps -c -o main.o -v main.c 
```

它实际上显示了正在使用的显式文件而不是丑陋的临时文件`/tmp`，因此很容易确切地知道发生了什么，其中包括预处理/编译/组装步骤：

```
/usr/lib/gcc/x86_64-linux-gnu/8/cc1 -E -quiet -v -imultiarch x86_64-linux-gnu main.c -mtune=generic -march=x86-64 -fpch-preprocess -fstack-protector-strong -Wformat -Wformat-security -o main.i
/usr/lib/gcc/x86_64-linux-gnu/8/cc1 -fpreprocessed main.i -quiet -dumpbase main.c -mtune=generic -march=x86-64 -auxbase-strip main.o -version -fstack-protector-strong -Wformat -Wformat-security -o main.s
as -v --64 -o main.o main.s 
```

在 Ubuntu 19.04 amd64、GCC 8.3.0 中测试。

**CMake 预定义目标**

CMake 自动为预处理文件提供一个目标：

```
make help 
```

向我们展示了我们可以做到：

```
make main.s 
```

并且该目标运行：

```
Compiling C source to assembly CMakeFiles/main.dir/main.c.s
/usr/bin/cc    -S /home/ciro/hello/main.c -o CMakeFiles/main.dir/main.c.s 
```

所以文件可以在`CMakeFiles/main.dir/main.c.s`

在 cmake 3.16.1 上测试。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-09-26T00:14:23.607

如果您想看到的内容取决于输出的链接，那么除了前面提到的 gcc -S 之外，输出目标文件/可执行文件上的 objdump 也可能有用。这是 Loren Merritt 编写的一个非常有用的脚本，它将默认的 objdump 语法转换为更易读的 nasm 语法：

```
#!/usr/bin/perl -w
$ptr='(BYTE|WORD|DWORD|QWORD|XMMWORD) PTR ';
$reg='(?:[er]?(?:[abcd]x|[sd]i|[sb]p)|[abcd][hl]|r1?[0-589][dwb]?|mm[0-7]|xmm1?[0-9])';
open FH, '-|', '/usr/bin/objdump', '-w', '-M', 'intel', @ARGV or die;
$prev = "";
while(<FH>){
    if(/$ptr/o) {
        s/$ptr(\[[^\[\]]+\],$reg)/$2/o or
        s/($reg,)$ptr(\[[^\[\]]+\])/$1$3/o or
        s/$ptr/lc $1/oe;
    }
    if($prev =~ /\t(repz )?ret / and
       $_ =~ /\tnop |\txchg *ax,ax$/) {
       # drop this line
    } else {
       print $prev;
       $prev = $_;
    }
}
print $prev;
close FH; 
```

我怀疑这也可以用于 gcc -S 的输出。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2013-06-13T08:56:37.457

好吧，正如大家所说，使用 -S 选项。如果使用 -save-temps 选项，还可以获得预处理文件（*.i）、程序集文件（* .s）和目标文件（*.o）。（使用 -E、-S 和 -c 获取它们中的每一个。）

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-09-26T02:06:06.910

正如每个人都指出的那样，使用`-S`GCC 的选项。我还想补充一点，结果可能会有所不同（非常大！），具体取决于您是否添加优化选项（`-O0`对于无，`-O2`对于积极优化）。

特别是在 RISC 架构上，编译器在进行优化时通常会将代码转换得几乎无法识别。看到结果令人印象深刻和迷人！

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-10-11T16:31:10.057

如前所述，查看 -S 标志。

还值得一看 '-fdump-tree' 系列标志，特别是 '-fdump-tree-all'，它可以让您看到 gcc 的一些中间形式。这些通常比汇编程序更具可读性（至少对我而言），并让您了解优化过程的执行情况。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2011-10-24T06:18:37.720

如果您正在寻找 LLVM 程序集：

```
llvm-gcc -emit-llvm -S hello.c 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2018-01-24T15:27:12.290

我在答案中看不到这种可能性，可能是因为这个问题来自 2008 年，但在 2018 年你可以使用 Matt Goldbolt 的在线网站[https://godbolt.org](https://godbolt.org)

你也可以在本地 git clone 并运行他的项目[https://github.com/mattgodbolt/compiler-explorer](https://github.com/mattgodbolt/compiler-explorer)

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-09-26T00:11:32.117

使用 -S 选项：

```
gcc -S program.c 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2011-01-04T12:02:58.243

来自： http: [//www.delorie.com/djgpp/v2faq/faq8_20.html](http://www.delorie.com/djgpp/v2faq/faq8_20.html)

gcc -c -g -Wa,-a,-ad [其他 GCC 选项] foo.c > foo.lst

代替 PhirePhly 的回答或者就像大家说的那样使用 -S 。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2018-12-26T04:28:11.950

这是使用 GCC 的 C 解决方案：

```
gcc -S program.c && gcc program.c -o output 
```

1.  这里的第一部分将程序的汇编输出存储在与 Program 相同的文件名中，但扩展名为**.s**，您可以将其作为任何普通文本文件打开。

2.  这里的第二部分编译您的程序以供实际使用，并为您的程序生成一个具有指定文件名的可执行文件。

上面使用的*program.c*是您的程序的名称，*输出*是您要生成的可执行文件的名称。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2018-02-25T03:03:49.347

[![这些命令的输出](https://i.stack.imgur.com/KOXCa.png)](https://i.stack.imgur.com/KOXCa.png)

以下是在 Windows 上查看/打印任何 C 程序的汇编代码的步骤

控制台/终端/命令提示符：

1.  在 C 代码编辑器（如代码块）中编写 C 程序并使用扩展名 .c 保存它

2.  编译并运行它。

3.  成功运行后，转到您安装 gcc 编译器的文件夹并给出

    以下命令获取“.c”文件的“.s”文件

    C:\gcc> gcc -S C文件的完整路径 ENTER

    一个示例命令（如我的情况）

    C:\gcc> gcc -SD:\Aa_C_Certified\alternate_letters.c

    这将输出原始“.c”文件的“.s”文件

4\. 在此之后，键入以下命令

C;\gcc> cpp 文件名.s ENTER

示例命令（如我的情况）

C;\gcc> cpp 备用字母.s

这将打印/输出 C 程序的整个汇编语言代码。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-12-16T02:18:14.433

使用“-S”作为选项。它在终端中显示程序集输出。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-11-28T06:13:28.127

最近想知道a中各个函数的汇编。我是这样做的：

```
$ gcc main.c                      // main.c source file
$ gdb a.exe                       // gdb a.out in linux
  (gdb) disass main               // note here main is a function
                                  // similary it can be done for other functions 
```

# c# - 通过网络读取和解析大型文本文件的最佳方式是什么？

> ID：137040
> 
> 赞同：10
> 
> 时间：2008-09-26T00:10:35.737
> 
> 标签：c#, .net, multithreading, parsing, networking

我有一个问题，需要我从远程机器上解析几个日志文件。有一些复杂性：1）文件可能正在使用 2）文件可能非常大（100mb+） 3）每个条目可能是多行的

要解决使用中的问题，我需要先复制它。我目前正在将它直接从远程机器复制到本地机器，并在那里解析它。这导致了问题 2。由于文件很大，因此在本地复制它可能需要很长时间。

为了增加解析时间，我想让解析器多线程，但这使得处理多行条目有点棘手。

两个主要问题是：1）我如何加快文件传输（压缩？，是否需要在本地传输？，我可以通过其他方式读取正在使用的文件吗？） 2）我如何处理多行条目在线程之间拆分行时？

更新：我没有对服务器进行明显解析的原因是我希望对 CPU 的影响尽可能小。我不想影响系统即时测试的性能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T00:23:12.523

如果您正在读取一个顺序文件，您希望通过网络逐行读取它。您需要一种能够流式传输的传输方法。您需要查看您的 IO 流技术来解决这个问题。

像这样的大型 IO 操作不会从多线程中获得太多好处，因为您可以尽可能快地处理这些项目，因为您可以通过网络读取它们。

您的另一个不错的选择是将日志解析器放在服务器上，然后下载结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T01:44:24.920

从性能的角度来看，更好的选择是在远程服务器上执行解析。除了特殊情况外，网络速度始终是瓶颈，因此限制通过网络发送的数据量将大大提高性能。

这是许多数据库使用在服务器端运行的存储过程的原因之一。

通过使用多线程来提高解析速度（如果有的话）将被网络传输的相对速度所淹没。

如果您致力于在解析文件之前传输文件，您可以考虑的一个选项是在进行文件传输时使用动态压缩。例如，有可用的 sftp 服务器可以即时执行压缩。在本地端，您可以使用[libcurl](http://curl.haxx.se/libcurl/)之类的东西来执行传输的客户端，它还支持动态解压缩。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T00:26:52.767

考虑到您已经在复制文件，最简单的方法是在复制之前对其进行压缩，并在复制完成后解压缩。压缩文本文件将获得巨大的收益，因为 zip 算法通常在它们上工作得很好。此外，您现有的解析逻辑可以保持不变，而不必将其连接到远程网络文本阅读器。

这种方法的缺点是您将无法非常有效地逐行更新，这对于日志解析器来说是一件好事。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T01:04:41.363

我想这取决于它有多“远程”。100Mb LAN 上的 100MB 大约需要 8 秒……达到千兆位，大约 1 秒就可以了。卡 50 * 2 美元，交换机 100 美元将是您可以进行的非常便宜的升级。

但是，假设它比这更远，您应该能够以只读模式打开它（当您复制它时正在阅读它）。SMB/CIFS 支持文件块读取，因此您应该在此时流式传输文件（当然，您实际上并没有说明您是如何访问文件的 - 我只是假设 SMB）。

多线程无济于事，因为无论如何您都会受到磁盘或网络的限制。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T01:21:10.420

使用压缩传输。

如果你的解析真的让你慢下来，并且你有多个处理器，你可以打破解析工作，你只需要以一种聪明的方式来做——有一个确定性的算法，工作人员负责处理不完整的记录。假设您可以确定一行是记录中间的一部分，例如，您可以将文件分成 N/M 段，每个段负责 M 行；当其中一项作业确定其记录未完成时，它只需要继续阅读，直到到达记录的末尾。当其中一个作业确定它正在读取它没有开始的记录时，它应该跳过该记录。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T07:36:13.700

如果您可以复制文件，则可以阅读它。所以一开始就没有必要复制它。

**编辑**：使用[FileStream 类](http://msdn.microsoft.com/en-us/library/system.io.filestream.filestream.aspx)可以更好地控制访问和共享模式。

```
new FileStream("logfile", FileMode.Open, FileAccess.Read, FileShare.ReadWrite) 
```

应该做的伎俩。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T00:28:09.517

我使用[SharpZipLib](http://www.icsharpcode.net/OpenSource/SharpZipLib)在通过 Internet 传输大文件之前对其进行压缩。所以这是一种选择。

1) 的另一个想法是创建一个在远程机器上运行并在那里进行解析的程序集。您可以使用 .NET 远程处理从本地计算机访问程序集。远程程序集需要是 Windows 服务或托管在 IIS 中。这将允许您将日志文件的副本保存在同一台机器上，理论上处理它们需要更少的时间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T00:29:15.520

我认为使用压缩（deflate/gzip）会有所帮助

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-02-16T12:20:21.683

给定的答案不让我满意，也许我的答案会帮助其他人不要认为它是超级复杂的，或者多线程在这种情况下不会受益。也许它不会使传输更快，但根据解析的复杂性，它可能会使解析数据的解析/或分析更快。

这实际上取决于您的解析细节。您需要从日志文件中获取哪些信息？这些信息是像统计信息还是依赖于多个日志消息？你有几个选择：

*   我想同时解析多个文件是最简单的，您将文件作为上下文，并且可以为每个文件创建一个线程
*   前面提到的另一个选项是对网络通信使用压缩
*   您还可以使用帮助程序将日志文件拆分为作为第一步属于一起的行，然后使用多个线程处理这些行块；这个依赖行的解析应该非常容易和快速。

在这种情况下，非常重要的是衡量您的实际瓶颈是什么。如果您的瓶颈是网络，您将不会从优化解析器中受益。如果您的解析器创建了许多相同类型的对象，您可以使用 ObjectPool 模式并创建具有多个线程的对象。尝试在不分配太多新字符串的情况下处理输入。解析器通常是通过使用大量的 string.Split 等来编写的，这并不像它可能的那么快。您可以通过检查即将出现的值来导航 Stream，而无需读取完整的字符串并再次拆分它，而是在解析完成后直接填充您需要的对象。

优化几乎总是可能的，问题是你有多少输入和你的场景有多重要。

# html - emacs 可以为我重新缩进一大块 HTML 吗？

> ID：137043
> 
> 赞同：72
> 
> 时间：2008-09-26T00:10:55.923
> 
> 标签：html, emacs

在 emacs 中编辑 HTML 时，有没有一种方法可以自动对标记块进行漂亮格式化，改变如下：

```
 <table>
  <tr>
<td>blah</td></tr></table> 
```

...进入这个：

```
<table>
 <tr>
  <td>
   blah
  </td>
 </tr>
</table> 
```

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2011-06-06T03:47:26.250

只要您处于 html 模式或 nxml 模式，您就可以在同一个区域/缓冲区上执行`sgml-pretty-print`然后。`indent-for-tab`

`sgml-pretty-print`在适当的位置添加新行并`indent-for-tab`添加漂亮的缩进。它们共同导致格式正确的 html/xml。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-28T01:22:01.203

默认情况下，当您`.html`在 Emacs（22 或 23）中访问文件时，它会将您置于`html-mode`. 那可能不是你想要的。你可能想要`nxml-mode`，这真是太棒了。`nxml-mode`似乎只随 Emacs 23 一起提供，尽管您可以从[nXML 网站](http://www.thaiopensource.com/nxml-mode/)为早期版本的 emacs 下载它。还有一个名为`nxml-mode`. 您可以输入`nxml-mode`：

```
M-x nxml-mode 
```

您可以通过以下方式查看 nxml 模式文档：

```
C-h i g (nxml-mode) RET 
```

话虽如此，您可能不得不使用[Tidy](http://tidy.sourceforge.net/)之类的东西来重新格式化您的 xhtml 示例。 `nxml-mode`会让你从

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head></head>
<body>
<table>
  <tr>
<td>blah</td></tr></table>
</body> 
```

到

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head></head>
  <body>
    <table>
      <tr>
    <td>blah</td></tr></table>
</body>
</html> 
```

但我没有看到更通用的工具可以根据需要对某些 ​​xml 标签进行换行。请注意，这`C-j`将插入一个带有适当缩进的新行，因此您可以执行快速宏或破解一个`defun`可以完成您的表格的宏。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-26T00:38:48.837

[http://www.delorie.com/gnu/docs/emacs/emacs_277.html](http://www.delorie.com/gnu/docs/emacs/emacs_277.html)

选择要修复的区域后。（要选择整个缓冲区，请使用 Cx h）

> *CMq*
> 
> 重新缩进一个括号分组（indent-sexp）中的所有行。
> 
> *厘米-\*
> 
> 重新缩进区域中的所有行 (indent-region)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-06-06T16:56:07.433

我自己编写了一个函数来为 xml 执行此操作，该函数在 nxml 模式下运行良好。也应该适用于 html：

```
(defun jta-reformat-xml ()
  "Reformats xml to make it readable (respects current selection)."
  (interactive)
  (save-excursion
    (let ((beg (point-min))
          (end (point-max)))
      (if (and mark-active transient-mark-mode)
          (progn
            (setq beg (min (point) (mark)))
            (setq end (max (point) (mark))))
        (widen))
      (setq end (copy-marker end t))
      (goto-char beg)
      (while (re-search-forward ">\\s-*<" end t)
        (replace-match ">\n<" t t))
      (goto-char beg)
      (indent-region beg end nil)))) 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-11-10T15:54:39.873

你可以做一个替换正则表达式

```
 M-x replace-regexp

 \(</[^>]+>\)

 \1C-q-j 
```

缩进整个缓冲区

```
 C-x h
 M-x indent-region 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-11-28T06:21:53.480

这个问题很老了，但我对各种答案并不满意。鉴于您正在运行相对较新版本的 emacs（我正在运行 24.4.1），重新缩进 HTML 文件的一种简单方法是：

*   在emacs中打开文件
*   用标记整个文件`C-x h`（注意：如果您想查看标记的内容，请添加`(setq transient-mark-mode t)`到您的`.emacs`文件中）
*   执行`M-x indent-region`

这种方法的好处是它不需要任何插件（Conway 的建议），不需要替换正则表达式（nevcx 的建议），也不需要切换模式（jfm3 的建议）。Jay 的建议是朝着正确的方向——一般来说，执行`C-M-q`会根据模式的规则进行缩进——例如，`C-M-q`根据我的经验，在其他几种模式中`js-mode`以及在其他几种模式中都有效。但似乎`html-mode`也没有执行。`nxml-mode``C-M-q`

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-09-11T21:22:58.187

在我目前从源代码构建的 emacs 25 中，假设您处于 HTML 模式，请使用
`Ctrl`-`x`
`h`

全选，然后按`Tab`。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-26T03:56:01.560

[Tidy](http://tidy.sourceforge.net/)可以做你想做的事，但似乎只适用于整个缓冲区（结果是 XHTML）

```
M-x tidy-buffer 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-09-15T19:28:23.700

您可以使用以下方法将区域通过管道传输到 xmllint（如果有）：

```
M-|
Shell command on region: xmllint --format - 
```

结果将最终出现在一个新的缓冲区中。

我使用 XML 执行此操作，并且它可以工作，尽管我相信 xmllint 需要某些其他选项来处理 HTML 或其他不完美的 XML。nxml-mode 会告诉您是否有格式正确的文档。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-06-13T17:22:40.850

最简单的方法是通过命令行。

*   确保您已 tidy 安装
*   类型`tidy -i -m <<file_name>>`

请注意，该`-m`选项将新整理的文件替换为旧文件。如果你不想这样，你可以输入`tidy -i -o <<tidied_file_name>> <<untidied_file_name>>`

`-i`用于缩进。或者，您可以创建一个`.tidyrc`具有以下设置的文件

```
indent: auto
indent-spaces: 2
wrap: 72
markup: yes
output-xml: no
input-xml: no
show-warnings: yes
numeric-entities: yes
quote-marks: yes
quote-nbsp: yes
quote-ampersand: no
break-before-br: no
uppercase-tags: no
uppercase-attributes: no 
```

这样，您所要做的就是键入`tidy -o <<tidied_file_name>> <<untidied_file_name>>`.

如需更多信息，只需`man tidy`在命令行中输入。

# c# - 如何验证 ASPNET AJAX 安装

> ID：137054
> 
> 赞同：3
> 
> 时间：2008-09-26T00:14:10.720
> 
> 标签：c#, asp.net, ajax

如何验证我的 ASPNET AJAX 安装是否正确。

我有 Visual Studio 2008，以前从未安装过任何 AJAX 版本。

我的 UpdatePanel 不能在 IIS6 中工作，尽管它在 Visual Studio 的 Web 服务器中工作正常。我得到的行为就像 UpdatePanel 根本不存在一样——即它恢复为“正常”ASPX 类型的行为。

我尝试从[MSDN](http://www.microsoft.com/downloads/details.aspx?FamilyID=ca9d90fa-e8c9-42e3-aa19-08e2c027f5d6&displaylang=en)安装 AJAX，然后安装 IISRESET，但它仍然无法正常工作。

我可以检查什么来诊断问题？

**更新：**在 Visual Studio (Cassini) 中运行时，我收到 Fiddler 中显示的以下 3 个请求：

```
http://localhost:1105/RRStatistics/WebResource.axd?d=k5J0oI4tNNc1xbK-2DAgZg2&t=633564733834698722

http://localhost:1105/RRStatistics/ScriptResource.axd?d=N8BdmNpXVve13PiOuRcss0GMKpoTBFsi7UcScm-WmXE9jw5qOijeLDcIyiOsSQZ4k3shu0R2ly5WhH2vI_IbNVcTbxej1dkbdYFXrN6c7Qw1&t=ffffffff867086f6

http://localhost:1105/RRStatistics/ScriptResource.axd?d=N8BdmNpXVve13PiOuRcss0GMKpoTBFsi7UcScm-WmXE9jw5qOijeLDcIyiOsSQZ4AsqNeJVXGSf6sCcCp1QK0jdKTlbRqIN1LFVP8w6R0lJ_vbk-CfopYINgjYsHpWfP0&t=ffffffff867086f6 
```

但是当我在 IIS 中运行时，我只收到这个请求：

```
http://www.example.com/RRStatistics/ScriptResource.axd?d=f_uL3BYT2usKhP7VtSYNUxxYRLVrX5rhnXUonvvzSEIc1qA5dLOlcdNr9xlkSQcnZKyBHj1nI523o9DjxNr45hRpHF7xxC5WlhImxu9TALw1&t=ffffffff867086f6 
```

现在，Cassini 中的第二个请求包含一个带有“部分渲染”的 javascript 文件作为第一条评论之一。我确定这是问题的根源，但我无法弄清楚为什么在 IIS 中我没有收到其他请求。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-26T01:01:04.930

我自己没有尝试过，但我发现几个论坛帖子推荐以下

> 尝试将以下内容添加到您的 web.config
> 
> 在 <system.webServer><handlers> 内
> 
> <add verb="GET" path="ScriptResource.axd" type="Microsoft.Web.Handlers.ScriptResourceHandler" validate="false" />

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T11:33:37.343

另一种选择是检查您的 web.config。例如，您可以从 Visual Studio 创建一个新的启用 Ajax 的 ASP.NET 网站。这将生成正确的 web.config。复制现有 web.config 中的所有非 ajax 部分并设置好。这对我有用。

-Edoode

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T17:55:15.117

检查任何 JavaScript 错误。有时，UpdatePanel 工作所需的 JavaScript 无法加载。

# java - 太多“模式后缀”——设计气味？

> ID：137060
> 
> 赞同：6
> 
> 时间：2008-09-26T00:15:21.560
> 
> 标签：java, design-patterns, naming-conventions

我刚刚发现自己创建了一个名为“InstructionBuilderFactoryMapFactory”的类。这是一个类的 4 个“模式后缀”。它立刻让我想起了这一点：

[http://www.jroller.com/landers/entry/the_design_pattern_facade_pattern](http://www.jroller.com/landers/entry/the_design_pattern_facade_pattern)

这是设计的味道吗？我应该对这个数字施加限制吗？

我知道一些程序员对其他事情有类似的规则（例如，在 C 中不超过 N 级指针间接。）

所有的课程对我来说都是必要的。我有一个从字符串到工厂的（固定）映射——我一直在做的事情。该列表越来越长，我想将其移出使用构建器的类的构造函数（由从地图获得的工厂创建......）并且像往常一样，我避免使用单例。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T00:26:17.617

一个好的提示是：您的类公共 API（包括它的名称）应该揭示意图，而不是实现。我（作为客户）不在乎您是实现了构建器模式还是工厂模式。

不仅类名看起来很糟糕，而且它也没有说明它的作用。它的名字是基于它的实现和内部结构。

我很少在类中使用模式名称，除了（有时）工厂。

编辑：

在 Coding Horror 上找到一篇关于命名的有趣[文章](http://www.codinghorror.com/blog/archives/000553.html)，请查看！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T00:42:58.047

我将其视为一种设计气味——它会让我思考是否所有这些抽象级别都足够重要。

我不明白你为什么要命名一个类'InstructionBuilderFactoryMapFactory'？是否还有其他类型的工厂——不会创建 InstructionBuilderFactoryMap 的工厂？或者是否需要映射任何其他类型的 InstructionBuildersFactories？

当你开始创建这样的类时，这些是你应该考虑的问题。可以将所有这些不同的工厂工厂聚合成一个，然后提供不同的方法来创建工厂。也可以将这些 factory-factory 放在不同的包中，并给它们一个更简洁的名称。想一想这样做的替代方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T00:21:30.330

类名中的许多模式绝对是一种气味，但气味并不是一个明确的指标。这是一个“停下来重新思考设计”的信号。很多时候，当您坐下来思考更清晰的解决方案时，就会变得显而易见。有时由于手头的限制（技术/时间/人力/等）意味着现在应该忽略气味。

至于具体的例子，如果没有更多的上下文，我认为花生画廊的建议不是一个好主意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-21T16:01:25.977

我一直在想同样的事情。就我而言，工厂的丰富是由“为可测试性而构建”引起的。例如，我有一个这样的构造函数：

```
ParserBuilderFactoryImpl(ParserFactory psF) {
...
} 
```

这里我有一个解析器——我需要的终极类。解析器是通过调用构建器上的方法来构建的。构建器（需要构建的每个解析器的新构建器）是从构建器工厂获得的。

现在，什么 h..l 是 ParserFactory？啊，我很高兴你问！为了测试解析器构建器的实现，我需要调用它的方法，然后查看创建了哪种解析器。在不破坏构建器正在创建的特定解析器类的封装的情况下执行此操作的唯一方法是在创建解析器之前放置一个拦截点，以查看其构造函数中的内容。因此 ParserFactory。这只是我在单元测试中观察传递给解析器构造函数的一种方式。

我不太确定如何解决这个问题，但我有一种感觉，我们最好传递类而不是工厂，如果 Java 可以有适当的类方法而不是静态成员，它会做得更好。

# ms-access - 没有对数据库的独占访问权限，因此无法保存更改

> ID：137082
> 
> 赞同：8
> 
> 时间：2008-09-26T00:23:12.353
> 
> 标签：ms-access

我正在研究 MS Access 数据库。我对其中一个模块进行了一些更改。我想出去吃午饭，但是当我尝试关闭数据库时，我收到以下消息：

“您没有对数据库的独占访问权限。此时无法保存您的设计更改。您要关闭而不保存更改吗？”

我很确定网络上没有其他人打开数据库文件，我也没有打开任何其他 Access 数据库。我可能遗漏了一些明显的东西，但真的很感激一些帮助！

更新：

最后，我复制了所有代码，关闭了数据库而不保存，重新打开它并将代码粘贴回去。然后我就可以保存数据库了。我不确定这是否是一次关闭，但如果再次发生，我会报告。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T03:58:06.713

如果您确定除了您之外没有其他人在数据库中，这是从您自己的 PC 到您的数据库的附加连接。您可以使用 LDB 查看器验证这一点，该查看器可从 Microsoft 下载的免费 JetUtils.exe 下载：

[http://support.microsoft.com/kb/176670](http://support.microsoft.com/kb/176670)

查看您的代码并检查默认工作区中是否有两个单独的数据库对象或单独的工作区中是否有另一个数据库对象。这会导致这个问题。

要修复它，请确保数据库对象在超出范围之前设置为空，如果您在代码中打开数据库对象，则还需要在将数据库对象设置为空之前关闭它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T01:44:15.963

如果您关闭数据库并确定没有其他人打开它，请检查是否存在 .ldb 文件（它将与您的数据库文件同名）。如果文件在那里，那么它很有可能仍在使用中。它是通过服务访问的，比如网站吗？

您可以将数据库复制到另一个子目录并进行更改。如果这不起作用，我将不得不查一下。当然总是有数据库工具，“修复和压缩数据库......”

文件是否位于文件服务器上？如果是这样，请检查是否有任何用户拥有它的文件句柄。

如果它仍然不起作用，请使用您的新信息更新您的帖子，我们会更进一步。

更新（9/26）：当访问包含 vba 代码的数据库出现奇怪问题时，我做的另一件事是反编译。我不知道这是否已记录在案，我已经有好几年没看过了，但它（至少）是一个未记录的到 msaccess 的切换。

从 cmd 行：

将目录更改为 msaccess.exe 所在的位置。
运行以下命令

> msaccess \path 访问文件\databasefile.mdb /decompile

通常运行非常快然后打开数据库。打开任何模块并编译。
并不总是有效，但有时可以消除奇怪的事情。

您是否曾经尝试将数据库复制到另一个目录并进行编辑？这应该有效；然后，您可以重命名原始文件并将文件复制回来。
不管怎样，我很高兴你又开始工作了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-06-15T22:25:25.610

如果即使是文字邮件合并链接到访问数据库，这也算作访问连接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-04-01T08:09:05.690

很简单。关闭所有 MSaccess 文件。打开任务管理器（通过右键单击任务栏）。在其中选择“进程”选项卡。如果列表有一个**msaccess*32**进程，请单击结束进程关闭它。

这对我有用。我认为它会关闭我们没有在代码中关闭或强制关闭的所有记录集。

# c++ - Boost::signal 内存访问错误

> ID：137089
> 
> 赞同：4
> 
> 时间：2008-09-26T00:25:10.600
> 
> 标签：c++, boost-signals

我正在尝试使用 boost::signal 来实现回调机制，并且我在 boost::signal 代码中获得了一个内存访问断言，即使是库的最琐碎的使用。我已将其简化为以下代码：

```
#include <boost/signal.hpp>

typedef boost::signal<void (void)> Event;

int main(int argc, char* argv[])
{

    Event e;

    return 0;
} 
```

谢谢！

编辑：这是使用带有 SP1 的 Visual Studio 2008 编译的 Boost 1.36.0。Boost::filesystem，就像 boost::signal 一样，也有一个必须链接的库，它似乎工作正常。我相信，我使用的所有其他 boost 库都只有标头。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T17:01:09.533

我已经确认这是一个问题 - Microsoft 的 Stephan T Lavavej (STL!)[对此发表了博文](http://blogs.msdn.com/vcblog/archive/2007/02/26/stl-destructor-of-bugs.aspx)。

具体来说，他说：

> 一般的问题是链接器没有诊断出所有的单一定义规则 (ODR) 违规。虽然并非不可能，但这是一个难以解决的问题，这就是为什么该标准特别允许某些 ODR 违规行为未被诊断出来。
> 
> 我当然希望编译器和链接器有一种特殊的模式，可以在构建时捕获所有 ODR 违规，但我认识到这很难实现（并且会消耗可能会被更好地利用的资源，比如更多的一致性）。无论如何，通过适当地构造代码，无需付出极大的努力就可以避免 ODR 违规，因此我们作为程序员可以应对这种缺乏链接器检查的情况。
> 
> 但是，通过打开和关闭来更改代码功能的宏正在危险地与 ODR 调情，具体的问题是 _SECURE_SCL 和 _HAS_ITERATOR_DEBUGGING 都是这样做的。乍一看，这似乎并没有那么糟糕，因为您应该已经可以控制在构建系统中在项目范围内定义了哪些宏。但是，单独编译的库会使事情复杂化——如果您（例如）使用 _SECURE_SCL 构建 Boost，这是默认设置，您的项目不得关闭 _SECURE_SCL。如果您打算在您的项目中关闭 _SECURE_SCL，现在您必须相应地重新构建 Boost。并且根据所讨论的单独编译的库，这可能很困难（根据我的理解，使用 Boost 可以做到，我只是从来没有弄清楚如何）。

他稍后在评论中列出了一些可能的解决方法，但没有一个看起来适合这种情况。**其他人报告说在编译 boost 时可以通过在boost/config/compiler/visualc.hpp**中插入一些定义来关闭这些标志，但这对我**不起作用**。但是，在**tools/build/v2/user-config.jam中****逐字**插入以下行就可以了。请注意，空格对于提高 jam 很重要。

 **```
使用 msvc : 9.0 : : <cxxflags>-D _SECURE_SCL=0 <cxxflags>-D _HAS_ITERATOR_DEBUGGING=0 ；

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T09:17:13.597

当使用不同的堆实现进行编译时，经常会出现这种问题。在 VS 中，可以要求将 CRT 链接到（作为静态库），或者作为动态库保留。

如果您使用的库在其链接堆上分配内存，并且您的程序尝试使用另一个堆释放它，那么您会遇到麻烦：要释放的对象不在已分配的对象列表中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T00:51:16.857

我已经在我的系统上测试了你的代码，它工作正常。我认为您的编译器与构建 Boost.Signals 库的编译器之间存在不匹配。尝试下载 Boost 源代码，并使用与构建代码相同的编译器来编译 Boost.Signals。

仅供参考，您使用的是什么编译器（和版本）？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-27T10:49:53.200

布赖恩，我刚刚遇到了和你一模一样的问题。感谢您对博客文章的回答，我将其追踪到我们禁用`_HAS_ITERATOR_DEBUGGING`and `_SECURE_SCL`。

为了解决这个问题，我手动构建了 boost 库。我不需要弄乱配置文件。这是我使用的两个命令行：

> **x86**
> bjam 调试发布链接=静态线程=多运行时链接=共享定义=_SECURE_SCL=0 定义=_HAS_ITERATOR_DEBUGGING=0 --with-signals 阶段
> 
> **x64**
> bjam 调试发布链接=静态线程=多运行时链接=共享定义=_SECURE_SCL=0 定义=_HAS_ITERATOR_DEBUGGING=0 地址模型=64 --with-signals 阶段

这将构建以下文件：
libboost_signals-vc90-mt-1_43.lib
libboost_signals-vc90-mt-gd-1_43.lib

希望有帮助。

# javascript - 将纪元以来的天数转换为纪元以来的秒数

> ID：137091
> 
> 赞同：0
> 
> 时间：2008-09-26T00:25:36.653
> 
> 标签：javascript, timestamp, time-t

在我的新工作场所，它们将很多日期表示为“自纪元以来的天数”（我将在下文中将其称为 DSE）。我在将 JavaScript 从 DSE 转换为自纪元以来的秒数（UNIX 时间戳）时遇到了问题。这是我进行转换的功能：

```
function daysToTimestamp(days) {
    return Math.round(+days * 86400);
} 
```

例如，当我传入 13878（预计这代表 2008 年 1 月 1 日）时，我得到了 1199059200，而不是我预期的 1199098800。为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T00:32:55.760

1199059200 代表 2007 年 12 月 31 日，UTC。示例 Python 会话：

```
>>> import time
>>> time.gmtime(1199059200)
(2007, 12, 31, 0, 0, 0, 0, 365, 0) 
```

请记住，所有`time_t`值都针对 UTC。:-) 您必须根据您的时区进行相应调整。

编辑：由于您和我都在新西兰，因此您可能如何获得 1199098800 值：

```
>>> time.localtime(1199098800)
(2008, 1, 1, 0, 0, 0, 1, 1, 1) 
```

之所以如此，是因为在新年（新西兰的夏天），这里的时区是 +1300。做数学看看。:-)

对于 UTC 的 2008 年 1 月 1 日，将 86400 添加到 1199059200，得到 1199145600。

```
>>> time.gmtime(1199145600)
(2008, 1, 1, 0, 0, 0, 1, 1, 0) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T00:31:55.110

这是因为它既不是时间的线性表示，也不是 UTC 的真实表示（尽管它经常被误认为两者），因为它表示的时间是 UTC，但它无法表示 UTC 闰秒

[http://en.wikipedia.org/wiki/Unix_time](http://en.wikipedia.org/wiki/Unix_time)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T00:37:05.003

Unix 时间 (time_t) 以 1970 年 1 月 1 日以来的秒数表示，而不是毫秒。

我想你所看到的是时区的差异。您拥有的增量是 11 小时，您如何获得预期值？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-22T13:15:17.447

因为 1199098800/86400 = 13878.4583333333333（3 永远重复），而不是 13878.0。它被四舍五入到 13878.0，因为它被存储为整数。如果你想看看它的不同之处，试试这个：.4583333333333*86400 = 39599.99999999712。即使这样也有点不正确，但这就是差异的来源，如 1199098800-1199059200=35600。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-26T00:40:07.680

你应该乘以 86400000

1 天 = 24 小时 * 60 分钟 * 60 秒 * 1000 毫秒 = 86400000

# ajax - 自动测试 AJAX Web UI 时使用延迟的替代方法

> ID：137092
> 
> 赞同：10
> 
> 时间：2008-09-26T00:25:47.010
> 
> 标签：ajax, testing, functional-programming, callback, browser-automation

我很快将致力于 AJAX 驱动的网页，这些网页具有从 Web 服务 (WCF) 生成的大量内容。

我过去测试过这种东西（并且发现它很容易），但没有这种级别的动态内容。

我正在使用 Visual Studio 2008 在 .NET 3.5 中进行开发。我设想在以下环境中进行此测试：

1.  测试驱动.NET
2.  MBUnit（虽然这不是**单元**测试）
3.  某种控制浏览器的自动化工具（也许是 Selenium，虽然它可能是 SWEA 或 Watin。我在想 IE、Firefox，可能还有 Opera 和 Safari。）

过去我在测试浏览器时使用过延迟。我不是特别喜欢这样做，而且会浪费时间。

**有什么经验和实践可以比使用等待做得更好**。也许引入回调和函数式编程来运行测试？

* * *

**注释 1\. 查看前 3 个回复后的详细信息。**

1) 感谢 Alan、Eran 和 marxidad，您的回复让我走上了获得答案的道路，希望不会花费太多时间。

2) 另一个细节，我使用**jQuery**来运行 Ajax，所以这不是在 Asp.NET AJAX 中构建的。

3）我发现一篇文章很好地**说明了这种情况。**它来自[http://adamesterline.com/2007/04/23/watin-watir-and-selenium-reviewed/](http://adamesterline.com/2007/04/23/watin-watir-and-selenium-reviewed/ "WatiN、Watir、Selenium 评论")

3.1) **Selenium**示例（这个和下一个，WatiN，代码示例没有显示在原始网页中（在 IE 或 Firefox 上），所以我已经提取它们并在此处列出它们。）

```
public void MinAndMaxPriceRestoredWhenOpenedAfterUsingBackButton(){
  OpenBrowserTo("welcome/index.rails");
  bot.Click("priceDT");
  WaitForText("Price Range");
  WaitForText("515 N. County Road");
  bot.Select("MaxDropDownList", "$5,000,000");
  WaitForText("Prewar 8 Off Fifth Avenue");
  bot.Select("MinDropDownList", "$2,000,000");
  WaitForText("of 86");
  bot.Click("link=Prewar 8 Off Fifth Avenue");
  WaitForText("Rarely available triple mint restoration");
  bot.GoBack();
  Thread.Sleep(20000);
  bot.Click("priceDT");
  WaitForText("Price Range");
  Assert.AreEqual("$5,000,000", bot.GetSelectedLabel("MaxDropDownList"));
  Assert.AreEqual("$2,000,000", bot.GetSelectedLabel("MinDropDownList"));} 
```

3.2) **WatiN**样本

```
public void MinAndMaxPriceRestoredWhenOpenAfterUsingBackButton(){
  OpenBrowserTo("welcome/index.rails");
  ClickLink("Price");
  SelectMaxPrice("$5,000,000");
  SelectMinPrice("$2,000,000");
  ClickLink("Prewar 8 Off Fifth Avenue");
  GoBack();
  ClickLink("Price");
  Assert.AreEqual("$5,000,000", SelectedMaxPrice());
  Assert.AreEqual("$2,000,000", SelectedMinPrice());} 
```

3.3) 如果您查看这些显然等效的示例，您会发现 WatiN 示例已经**抽象掉了 waits**。

3.4) 然而，WatiN 可能需要**额外支持**由 Ajax 调用更改的值，如[http://watinandmore.blogspot.com/2008/01/using-watin-to-test-select-lists-in.html](http://watinandmore.blogspot.com/2008/01/using-watin-to-test-select-lists-in.html "将 WatiN 与 Ajax 一起使用")中所述。在那篇文章中，页面被赋予了一个额外的字段，可用于合成更改的事件，如下所示：

```
// Wait until the value of the watintoken attribute is changed
ie.SelectList("countries").WaitUntil(!Find.By("watintoken",watintoken)); 
```

4）现在我所追求的是一种方法，可以**在没有合成事件的情况下执行我们在 WatiN 代码中看到的操作**。这可能是一种直接挂钩事件的方法，例如更改的事件。我也不会遇到回调问题，尽管这可能会改变测试的编码方式。我还认为，随着 C# 3、VB 9 和 F# 中的新功能的影响开始深入（并且不介意对此进行探索），我们将看到编写测试的替代方法。

5) marxidad，我的来源没有来自 WebAii 的样本，所以我对这个看起来很有趣的工具没有任何评论。

* * *

**注释 2\. 2008-09-29。经过一些独立于此页面的反馈。**

5) 我试图为上面的 WatiN 示例代码获取更完整的源代码。不幸的是，它不再可用，链接已失效。这样做时，我注意到 DSL，大概是在网页和自动化工具之间映射的模型。我没有找到这方面的细节。

6) 对于 WebAii，建议使用这样的代码（未经测试）：

```
public void MinAndMaxPriceRestoredWhenOpenAfterUsingBackButton(){
  ActiveBrowser.NavigateTo("welcome/index.rails"); 
  Find.ByContent<HtmlAnchor>("Price").Click();
  HtmlSelect maxPrice = Find.ById<HtmlSelect>("MaxDropDownList"); 
  HtmlSelect minPrice = Find.ById<HtmlSelect>("MinDropDownList");
  maxPrice.SelectByText("$5,000,000"); 
  minPrice.SelectByText("$2,000,000");
  Find.ByContent<HtmlAnchor>("Prewar 8 Off Fifth Avenue").Click(); 
  ActiveBrowser.GoBack();
  Find.ByContent<HtmlAnchor>("Price").Click(); 
  maxPrice.AssertSelect().SelectedText("$5,000,000"); 
  minPrice.AssertSelect().SelectedText("$2,000,000");} 
```

6）从代码中我可以清楚地避免等待和延迟，使用一些框架，但我需要花更多的时间来看看 WatiN 是否适合我。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T03:10:09.720

大多数自动化框架都内置了一些同步功能。Selenium 也不例外，包括 waitForText、waitForElementPresent 等功能。

我刚刚意识到您在上面提到了“等待”，我将其解释为睡眠（在自动化方面不好）。如果我误解了，请告诉我，我可以更多地讨论 wait* 函数或替代方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T03:19:42.770

[WebAii](http://www.artoftest.com/Resources/WebAii/Documentation/topicsindex.aspx?topic=ajaxsupport)有一个**WaitForElement(s)**方法，可让您指定要等待的元素的参数。

# language-agnostic - 开源许可证有什么区别

> ID：137100
> 
> 赞同：10
> 
> 时间：2008-09-26T00:26:42.953
> 
> 标签：language-agnostic

我阅读了所有的许可证，坦率地说，我对可用的许多选择感到困惑。我知道有些人放宽了许可证的限制，以便可以在商业应用程序中使用开源的东西。
但除此之外，为什么有这么多许可证呢？它们之间是否有任何**重大**区别。我该如何选择适合我的？

为了不让这太笼统和复杂，我将在这里提供一些许可证，你们可以告诉我每个许可证的要点是什么

1.  gpl (v2/v3)
2.  阿帕奇许可证
3.  BSD 许可证
4.  麻省理工学院许可证
5.  Mozilla 许可证

编辑：（由 3 个人向我指出，不少于）许可证是否允许用户在商业软件中使用该软件包含[在这个问题](https://stackoverflow.com/questions/137048/how-do-i-tell-if-i-can-re-use-a-free-software-library-in-a-commercial-app)中。但是，如前所述，我也在寻找是否有人可以阐明除此之外的差异。在为我自己的项目选择一个的背景下，而不是在我是否可以在我自己的商业软件中使用该软件的背景下（就像我相信另一个线程是关于的）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2016-09-28T06:03:58.680

是的，可用的不同许可证之间存在重要差异。正如您所问的，在这里解释它们就像重新发明轮子一样。

我建议查看@raphael75 建议的站点：[选择开源许可证](http://choosealicense.com/)

# git - Git 最好的可视化合并工具是什么？

> ID：137102
> 
> 赞同：662
> 
> 时间：2008-09-26T00:27:35.867
> 
> 标签：git, version-control, merge

在 Git 中查看和编辑合并的最佳工具是什么？我想获得一个三向合并视图，在单独的面板中包含“我的”、“他们的”和“祖先”，以及第四个“输出”面板。

此外，调用所述工具的说明会很棒。（我还没有弄清楚如何以不会给我错误的方式启动 kdiff3。）

我的操作系统是 Ubuntu。

* * *

## 回答 #1

> 赞同：384
> 
> 时间：2008-09-26T00:39:54.497

[Meld](http://meldmerge.org/)是一个免费、开源和跨平台（UNIX/Linux、OSX、Windows）的差异/合并工具。

以下是如何安装它：

*   [Ubuntu](http://web.archive.org/web/20200512144500/https://linuxpitstop.com/install-meld-on-ubuntu-and-mint-linux/)
*   [苹果电脑](https://yousseb.github.io/meld/)
*   [Windows](https://wiki.gnome.org/Apps/Meld/Windows)：“推荐的 Meld for Windows 版本是最新版本，可从[https://meldmerge.org](https://meldmerge.org)作为 MSI 获得”

* * *

## 回答 #2

> 赞同：99
> 
> 时间：2010-02-10T09:55:12.797

您可以配置自己的合并工具以与“ `git mergetool`”一起使用。

例子：

```
 git config --global merge.tool p4merge
  git config --global mergetool.p4merge.cmd p4merge '$BASE $LOCAL $REMOTE $MERGED'
  git config --global mergetool.p4merge.trustExitCode false 
```

当您使用它时，您还可以将其设置为“ `git difftool`”的 difftool：

```
 git config --global diff.tool p4merge
  git config --global difftool.p4merge.cmd p4merge '$LOCAL $REMOTE' 
```

请注意，在 Unix/Linux 中，您不希望`$BASE`被您的 shell 解析为变量 - 它实际上应该出现在您的 ~/.gitconfig 文件中以使其正常工作。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2010-10-01T09:22:37.940

[**我最喜欢的Beyond Compare 3**](http://www.scootersoftware.com/index.php)*在Pro 版*中具有[合并](http://www.scootersoftware.com/moreinfo.php?zz=moreinfo_merge)功能。合并的好处是它可以让您看到所有 4 个视图：基本视图、左视图、右视图和合并结果。它的视觉效果不如*P4V，但比WinDiff*多。它[集成了许多源代码控制](http://www.scootersoftware.com/support.php?c=kb_vcs.php)并在 Windows/Linux 上运行。它具有许多功能，例如高级规则、版本、手动对齐...

 **[**Perforce Visual Client** ( *P4V* )](http://www.perforce.com/perforce/downloads/index.html)是一个免费工具，它提供了最明确的合并界面之一（请参阅[一些屏幕截图](http://www.perforce.com/perforce/products/merge.html)）。适用于所有主要平台。我对该工具的主要失望在于它的*“只读”界面*。您无法手动编辑文件，也无法手动对齐。

PS：P4Merge 包含在 P4V 中。Perforce 试图让没有客户的情况下很难获得他们的工具。

[**SourceGear Diff/Merge**](http://www.sourcegear.com/diffmerge/index.html)可能是我的第二个免费工具选择。检查合并[屏幕截图](http://www.sourcegear.com/images/screenshots/diffmerge/mac_file_window_merge.png)，您会看到它至少有 3 个视图。

* * *

**[Meld](http://meldmerge.org/)**是一种较新的免费工具，我更喜欢*SourceGear Diff/Merge*：现在它也可以在大多数平台（Windows/Linux/Mac）上运行，具有原生支持某些源代码控制（如*Git* ）的明显优势。因此，您可以更简单地对所有文件进行一些历史差异。合并视图（见[截图](https://i.stack.imgur.com/QRzUR.png)）只有 3 个窗格，就像*SourceGear Diff/Merge*一样。这使得在复杂情况下合并变得有些困难。

PS：如果有一天一个工具支持**5 个视图合并**，这真的很棒，因为如果你在 Git 中挑选提交，你真的没有一个基础，而是两个。两个基础，两个更改和一个结果合并。

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2008-09-26T01:45:09.613

我听说了关于 kdiff3 的好消息。

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2008-09-26T00:34:31.747

我最喜欢的可视化合并工具是[SourceGear DiffMerge](http://www.sourcegear.com/diffmerge/downloads.php)

*   这是免费的。
*   跨平台（Windows、OS X 和 Linux）。
*   干净的视觉 UI
*   您期望的所有差异功能（差异、合并、文件夹差异）。
*   命令行界面。
*   可用的键盘快捷键。

![用户界面](https://i.stack.imgur.com/rWH3W.png)

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2010-10-01T13:55:48.023

**vimdiff**

一旦你学会了 vim（恕我直言，你应该），vimdiff 只是一个更漂亮的小正交概念来学习。要在 vim 中获得在线帮助：

```
:help vimdiff 
```

这个问题涵盖了如何使用它：[How do I use vimdiff to resolve a conflict？](https://stackoverflow.com/questions/14904644/how-do-i-use-vimdiff-to-resolve-a-conflict)

![在此处输入图像描述](https://i.stack.imgur.com/kxn1g.png)

如果您陷入鼠标使用的黑暗时代，并且您要合并的文件不是很大，我建议您使用 meld。

* * *

## 回答 #7

> 赞同：34
> 
> 时间：2017-05-29T20:49:54.960

**IntelliJ IDEA**有一个复杂的[合并冲突解决工具](https://www.jetbrains.com/help/idea/2017.1/resolving-conflicts.html)，带有 Resolve 魔棒，极大地简化了合并：

[![来源：https://blog.jetbrains.com/dotnet/2017/03/13/rider-eap-update-version-control-database-editor-improvements/](https://i.stack.imgur.com/nkN0e.png)](https://i.stack.imgur.com/nkN0e.png)

* * *

## 回答 #8

> 赞同：28
> 
> 时间：2009-09-01T00:22:40.487

您可以尝试[P4Merge](https://www.perforce.com/products/helix-apps/merge-diff-tool-p4merge)。

> 使用 P4Merge 可视化文件版本之间的差异。通过颜色编码解决并行或并行开发导致的冲突。

功能包括：

*   突出显示和编辑文本文件差异
*   选择包括或忽略行尾或空格
*   识别 Windows (CRLF)、Mac (CR) 和 Unix (LF) 的行尾约定
*   使用命令行参数并从非 Perforce 应用程序启动
*   比较和合并文件时显示行号
*   排除已修改、唯一或未更改的文件
*   按名称或扩展名过滤文件
*   在熟悉的文件/文件夹层次结构中组织修改后的资产
*   比较 JPEG、GIF、TIFF、BMP 和其他文件格式
*   使用 Qt API 进行扩展
*   叠加图像或并排显示
*   突出显示重叠图像上的差异

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2008-12-03T16:20:23.817

[漫反射](http://diffuse.sourceforge.net/)是我最喜欢的，但我当然有偏见。：-） 这是非常容易使用：

```
$ diffuse "mine" "output" "theirs" 
```

> Diffuse 是一个用 Python 编写的小而简单的文本合并工具。使用 Diffuse，您可以轻松合并、编辑和查看对代码的更改。Diffuse 是免费软件。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2010-04-10T01:13:15.123

Araxis Merge [http://www.araxis.com/merge](http://www.araxis.com/merge) 我在 Mac OS X 上使用它，但我在 Windows 上使用过它……它不是免费的……但它有一些[不错的功能](https://www.araxis.com/merge/features.en)……更好窗户虽然。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2008-09-26T01:50:40.957

如果您只是在寻找无法比较的差异工具，那就太好了：[http ://www.scootersoftware.com/moreinfo.php](http://www.scootersoftware.com/moreinfo.php)

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-11-18T16:49:52.013

您可以通过传递`git mergetool -t=<tool>`或来更改 git mergetool 使用的工具`--tool=<tool>`。要更改默认值（来自 vimdiff），请使用`git config merge.tool <tool>`.

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2017-08-18T10:00:39.203

所以对于 git 合并，你可以尝试：

*   [DiffMerge](https://www.sourcegear.com/diffmerge/)在 Windows、OS X 和 Linux 上直观地比较和合并文件。

    [![差异合并](https://i.stack.imgur.com/A5npUm.png)](https://i.stack.imgur.com/A5npUm.png)

*   [Meld](http://meldmerge.org/)是一个视觉差异和合并工具。

    [![Meld 是一个视觉差异和合并工具](https://i.stack.imgur.com/f3AqBm.png)](https://i.stack.imgur.com/f3AqBm.png)

*   [KDiff3](http://kdiff3.sourceforge.net/)，一个差异和合并程序），它比较或合并 2 或 3 个文本输入文件/目录。
*   [`opendiff`](https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/opendiff.1.html)（macOS 上 Xcode 工具的一部分），一个命令行实用程序，它从终端启动 FileMerge 应用程序，以图形方式比较文件或目录，包括[合并](https://stackoverflow.com/q/13719122/55075).

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2017-06-16T13:47:39.127

如果你使用**Visual Studio**，Team Explorer 内置工具是一个非常好的解决 git 合并冲突的工具。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2017-09-30T05:46:35.653

我已经尝试了很多这里提到的工具，但没有一个是我想要的。

就我个人而言，我发现[Atom](https://atom.io/)是一个用于可视化差异和解决冲突/合并的好工具。

至于合并，没有三个视图，但它们都合并为一个，每个版本都有彩色突出显示。您可以直接编辑代码，也可以通过按钮使用您想要的任何版本的代码段。

我什至不再将它用作编辑器或 IDE，只是为了使用 git。干净的用户界面和非常直接的，加上它是高度可定制的。

*   您可以从命令行启动它并传入您要打开的单个文件，或添加您的项目文件夹（git repo）。

    *   我还推荐[project-manager](https://atom.io/packages/project-manager)作为在项目之间导航而不填满树视图的一种非常方便的方式。
*   我遇到的唯一问题是令人耳目一新——当使用大型存储库时，Atom 更新您在它之外所做的更改可能会很慢。我总是在完成后关闭它，然后在我想再次查看我的更改/提交时重新打开。您也可以使用 ctrl+shift+f5 重新加载窗口，只需一秒钟。

它当然是免费的。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2017-12-01T11:11:40.167

我使用不同的工具进行合并和比较：

```
git config --global diff.tool diffuse
git config --global merge.tool kdiff3 
```

首先可以通过以下方式调用：

```
git difftool [BRANCH] -- [FILE or DIR] 
```

使用时调用第二个`git mergetool`。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-09-04T12:36:24.970

您可以在 Linux、Mac 或 Windows 上安装[ECMerge diff/merge 工具。](http://www.elliecomputing.com)它是在 Git 中预先配置的，所以只需使用`git mergetool`就可以完成这项工作。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-09-01T00:18:51.483

gitx [http://gitx.frim.nl/](http://gitx.frim.nl/)

处理大型提交集时的一些错误，但非常适合浏览更改并选择不同的更改以暂存然后提交。

# excel - MS Access 中的舍入

> ID：137114
> 
> 赞同：13
> 
> 时间：2008-09-26T00:30:29.713
> 
> 标签：excel, vba, ms-access, rounding, worksheet-function

在 VBA Access 中进行舍入的最佳方法是什么？

我目前的方法使用 Excel 方法

```
Excel.WorksheetFunction.Round(... 
```

但我正在寻找一种不依赖 Excel 的方法。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-26T00:53:59.860

请注意，VBA Round 函数使用 Banker 的舍入，它将 0.5 舍入为偶数，如下所示：

```
Round (12.55, 1) would return 12.6 (rounds up) 
Round (12.65, 1) would return 12.6 (rounds down) 
Round (12.75, 1) would return 12.8 (rounds up) 
```

而 Excel 工作表函数四舍五入总是向上取整 0.5。

我做了一些测试，看起来 0.5 向上舍入（对称舍入）也用于单元格格式，也用于列宽舍入（使用通用数字格式时）。“显示的精度”标志本身似乎没有进行任何舍入，它只是使用单元格格式的舍入结果。

我尝试在 VBA 中实现 Microsoft 的 SymArith 函数以进行舍入，但发现当您尝试为其提供 58.55 之类的数字时 Fix 出现错误；函数给出的结果是 58.5 而不是 58.6。然后我终于发现您可以使用 Excel Worksheet Round 函数，如下所示：

> **Application.Round(58.55, 1)**

这将允许您在 VBA 中进行正常舍入，尽管它可能不如某些自定义函数快。我意识到这已经从问题中走出来了，但为了完整起见，我想将其包括在内。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-05T21:21:20.980

要扩展已接受的答案：

“Round 函数执行从round to even，这与从round to large 不同。”
- 微软

格式总是向上取整。

```
 Debug.Print Round(19.955, 2)
  'Answer: 19.95

  Debug.Print Format(19.955, "#.00")
  'Answer: 19.96 
```

ACC2000：使用浮点数时的舍入错误：http: [//support.microsoft.com/kb/210423](http://support.microsoft.com/kb/210423)

ACC2000：如何按所需增量向上或向下舍入数字：http: [//support.microsoft.com/kb/209996](http://support.microsoft.com/kb/209996)

圆形函数：http: [//msdn2.microsoft.com/en-us/library/se6f2zfx.aspx](http://msdn2.microsoft.com/en-us/library/se6f2zfx.aspx)

如何实施自定义舍入程序：http: [//support.microsoft.com/kb/196652](http://support.microsoft.com/kb/196652)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T10:46:45.740

在瑞士，特别是在保险业，我们必须使用几个舍入规则，这取决于它是否被淘汰、福利等。

我目前使用该功能

```
Function roundit(value As Double, precision As Double) As Double
    roundit = Int(value / precision + 0.5) * precision
End Function 
```

这似乎工作正常

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T00:37:49.773

Int 和 Fix 都是有用的舍入函数，它们为您提供数字的整数部分。

Int 总是向下舍入 - Int(3.5) = 3, Int(-3.5) = -4

Fix 总是向零舍入 - Fix(3.5) = 3, Fix(-3.5) = -3

还有强制函数，特别是 CInt 和 CLng，它们试图将数字强制转换为整数类型或长类型（整数介于 -32,768 和 32,767 之间，长整数介于 -2,147,483,648 和 2,147,483,647 之间）。这些都将向最接近的整数四舍五入，从 0.5 - CInt(3.5) = 4、Cint(3.49) = 3、CInt(-3.5) = -4 等开始四舍五入。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T00:28:21.913

```
1 place = INT(number x 10 + .5)/10
3 places = INT(number x 1000 + .5)/1000 
```

等等。您经常会发现，像这样明显笨拙的解决方案比使用 Excel 函数要快得多，因为 VBA 似乎在不同的内存空间中运行。

例如`If A > B Then MaxAB = A Else MaxAB = B`，比使用 ExcelWorksheetFunction.Max 快大约 40 倍

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-05-01T11:30:01.617

不幸的是，可以执行舍入的 VBA 的本机函数要么缺失、有限、不准确或有缺陷，而且每个函数只处理一种舍入方法。好处是它们速度很快，在某些情况下这可能很重要。

但是，精度通常是强制性的，并且以当今计算机的速度，几乎不会注意到稍微慢一点的处理，实际上对于单个值的处理来说更是如此。以下链接中的所有功能都以大约 1 µs 的速度运行。

完整的函数集——适用于所有常见的舍入方法、VBA 的所有数据类型、任何值以及不返回意外值——可以在这里找到：

[将值向上、向下、4/5 或有效数字 (EE) 四舍五入](https://rdsrc.us/Mw1Iiy)

或在这里：

[将值向上、向下、4/5 或有效数字四舍五入 (CodePlex)](http://www.codeproject.com/Tips/1022704/Rounding-Values-Up-Down-By-Or-To-Significant-Figur)

仅在 GitHub 上的代码：

[VBA.圆形](https://github.com/GustavBrock/VBA.Round.git)

它们涵盖了正常的舍入方法：

*   向下舍入，可选择将负值向零舍入

*   向上舍入，可选择将负值从零舍入

*   按 4/5 四舍五入，远离零或均匀（银行家四舍五入）

*   四舍五入到有效数字的计数

前三个函数接受所有数字数据类型，而最后一个函数存在三种类型 - 分别用于 Currency、Decimal 和 Double。

它们都接受指定的小数位数 - 包括将舍入到数十、数百等的负数。返回类型为 Variant 的那些将返回 Null 用于难以理解的输入

还包括一个用于测试和验证的测试模块。

这里有一个例子 - 用于常见的 4/5 舍入。请研究内嵌注释以了解细微的细节以及*CDec*用于避免位错误的方式。

```
' Common constants.
'
Public Const Base10     As Double = 10

' Rounds Value by 4/5 with count of decimals as specified with parameter NumDigitsAfterDecimals.
'
' Rounds to integer if NumDigitsAfterDecimals is zero.
'
' Rounds correctly Value until max/min value limited by a Scaling of 10
' raised to the power of (the number of decimals).
'
' Uses CDec() for correcting bit errors of reals.
'
' Execution time is about 1µs.
'
Public Function RoundMid( _
    ByVal Value As Variant, _
    Optional ByVal NumDigitsAfterDecimals As Long, _
    Optional ByVal MidwayRoundingToEven As Boolean) _
    As Variant

    Dim Scaling     As Variant
    Dim Half        As Variant
    Dim ScaledValue As Variant
    Dim ReturnValue As Variant

    ' Only round if Value is numeric and ReturnValue can be different from zero.
    If Not IsNumeric(Value) Then
        ' Nothing to do.
        ReturnValue = Null
    ElseIf Value = 0 Then
        ' Nothing to round.
        ' Return Value as is.
        ReturnValue = Value
    Else
        Scaling = CDec(Base10 ^ NumDigitsAfterDecimals)

        If Scaling = 0 Then
            ' A very large value for Digits has minimized scaling.
            ' Return Value as is.
            ReturnValue = Value
        ElseIf MidwayRoundingToEven Then
            ' Banker's rounding.
            If Scaling = 1 Then
                ReturnValue = Round(Value)
            Else
                ' First try with conversion to Decimal to avoid bit errors for some reals like 32.675.
                ' Very large values for NumDigitsAfterDecimals can cause an out-of-range error 
                ' when dividing.
                On Error Resume Next
                ScaledValue = Round(CDec(Value) * Scaling)
                ReturnValue = ScaledValue / Scaling
                If Err.Number <> 0 Then
                    ' Decimal overflow.
                    ' Round Value without conversion to Decimal.
                    ReturnValue = Round(Value * Scaling) / Scaling
                End If
            End If
        Else
            ' Standard 4/5 rounding.
            ' Very large values for NumDigitsAfterDecimals can cause an out-of-range error 
            ' when dividing.
            On Error Resume Next
            Half = CDec(0.5)
            If Value > 0 Then
                ScaledValue = Int(CDec(Value) * Scaling + Half)
            Else
                ScaledValue = -Int(-CDec(Value) * Scaling + Half)
            End If
            ReturnValue = ScaledValue / Scaling
            If Err.Number <> 0 Then
                ' Decimal overflow.
                ' Round Value without conversion to Decimal.
                Half = CDbl(0.5)
                If Value > 0 Then
                    ScaledValue = Int(Value * Scaling + Half)
                Else
                    ScaledValue = -Int(-Value * Scaling + Half)
                End If
                ReturnValue = ScaledValue / Scaling
            End If
        End If
        If Err.Number <> 0 Then
            ' Rounding failed because values are near one of the boundaries of type Double.
            ' Return value as is.
            ReturnValue = Value
        End If
    End If

    RoundMid = ReturnValue

End Function 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T01:09:37.903

如果您谈论的是四舍五入到整数值（而不是四舍五入到*n*位小数），那么总是有老派的方法：

```
return int(var + 0.5) 
```

（您也可以使这项工作适用于*n*位小数，但它开始变得有点混乱）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-25T16:46:12.373

`bug`Lance 已经在 VBA 的实现中提到了继承舍入。所以我需要一个真正的 VB6 应用程序中的舍入函数。这是我正在使用的一个。它基于我在网上找到的一个，如评论中所示。

```
' -----------------------------------------------------------------------------
' RoundPenny
'
' Description:
'    rounds currency amount to nearest penny
'
' Arguments:
'    strCurrency        - string representation of currency value
'
' Dependencies:
'
' Notes:
' based on RoundNear found here:
' http://advisor.com/doc/08884
'
' History:
' 04/14/2005 - WSR : created
'
Function RoundPenny(ByVal strCurrency As String) As Currency

         Dim mnyDollars    As Variant
         Dim decCents      As Variant
         Dim decRight      As Variant
         Dim lngDecPos     As Long

1        On Error GoTo RoundPenny_Error

         ' find decimal point
2        lngDecPos = InStr(1, strCurrency, ".")

         ' if there is a decimal point
3        If lngDecPos > 0 Then

            ' take everything before decimal as dollars
4           mnyDollars = CCur(Mid(strCurrency, 1, lngDecPos - 1))

            ' get amount after decimal point and multiply by 100 so cents is before decimal point
5           decRight = CDec(CDec(Mid(strCurrency, lngDecPos)) / 0.01)

            ' get cents by getting integer portion
6           decCents = Int(decRight)

            ' get leftover
7           decRight = CDec(decRight - decCents)

            ' if leftover is equal to or above round threshold
8           If decRight >= 0.5 Then

9              RoundPenny = mnyDollars + ((decCents + 1) * 0.01)

            ' if leftover is less than round threshold
10          Else

11             RoundPenny = mnyDollars + (decCents * 0.01)

12          End If

         ' if there is no decimal point
13       Else

            ' return it
14          RoundPenny = CCur(strCurrency)

15       End If

16       Exit Function

RoundPenny_Error:

17       Select Case Err.Number

            Case 6

18             Err.Raise vbObjectError + 334, c_strComponent & ".RoundPenny", "Number '" & strCurrency & "' is too big to represent as a currency value."

19          Case Else

20             DisplayError c_strComponent, "RoundPenny"

21       End Select

End Function
' ----------------------------------------------------------------------------- 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T00:47:39.190

```
VBA.Round(1.23342, 2) // will return 1.23 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-12-30T16:35:06.973

这是在 Access 2003 中始终向上舍入到下一个整数的简单方法：

```
BillWt = IIf([Weight]-Int([Weight])=0,[Weight],Int([Weight])+1) 
```

例如：

*   [重量] = 5.33 ; 诠释（[体重]）= 5；所以 5.33-5 = 0.33 (<>0)，所以答案是 BillWt = 5+1 = 6。
*   [Weight] = 6.000, Int([Weight]) = 6 ，所以 6.000-6 = 0，所以答案是 BillWt = 6。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-03-27T15:35:51.323

为了解决便士拆分不等于最初拆分的数量的问题，我创建了一个用户定义的函数。

```
Function PennySplitR(amount As Double, Optional splitRange As Variant, Optional index As Integer = 0, Optional n As Integer = 0, Optional flip As Boolean = False) As Double
' This Excel function takes either a range or an index to calculate how to "evenly" split up dollar amounts
' when each split amount must be in pennies.  The amounts might vary by a penny but the total of all the
' splits will add up to the input amount.

' Splits a dollar amount up either over a range or by index
' Example for passing a range: set range $I$18:$K$21 to =PennySplitR($E$15,$I$18:$K$21) where $E$15 is the amount and $I$18:$K$21 is the range
'                              it is intended that the element calling this function will be in the range
' or to use an index and total items instead of a range: =PennySplitR($E$15,,index,N)
' The flip argument is to swap rows and columns in calculating the index for the element in the range.

' Thanks to: http://stackoverflow.com/questions/5559279/excel-cell-from-which-a-function-is-called for the application.caller.row hint.
Dim evenSplit As Double, spCols As Integer, spRows As Integer
If (index = 0 Or n = 0) Then
    spRows = splitRange.Rows.count
    spCols = splitRange.Columns.count
    n = spCols * spRows
    If (flip = False) Then
       index = (Application.Caller.Row - splitRange.Cells.Row) * spCols + Application.Caller.Column - splitRange.Cells.Column + 1
     Else
       index = (Application.Caller.Column - splitRange.Cells.Column) * spRows + Application.Caller.Row - splitRange.Cells.Row + 1
    End If
 End If
 If (n < 1) Then
    PennySplitR = 0
    Return
 Else
    evenSplit = amount / n
    If (index = 1) Then
            PennySplitR = Round(evenSplit, 2)
        Else
            PennySplitR = Round(evenSplit * index, 2) - Round(evenSplit * (index - 1), 2)
    End If
End If
End Function 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-05-07T15:26:59.090

我使用以下**简单**的函数来四舍五入我的**货币**，因为在我们公司我们**总是**四舍五入。

```
Function RoundUp(Number As Variant)
   RoundUp = Int(-100 * Number) / -100
   If Round(Number, 2) = Number Then RoundUp = Number
End Function 
```

但这总是会四舍五入到小数点后 2 位，也可能会出错。

即使它是负数，它也会向上取整（-1.011 将是 -1.01，1.011 将是 1.02）

因此，要提供更多*向上舍入*（或向下舍入）的选项，您**可以**使用此函数：

```
Function RoundUp(Number As Variant, Optional RoundDownIfNegative As Boolean = False)
On Error GoTo err
If Number = 0 Then
err:
    RoundUp = 0
ElseIf RoundDownIfNegative And Number < 0 Then
    RoundUp = -1 * Int(-100 * (-1 * Number)) / -100
Else
    RoundUp = Int(-100 * Number) / -100
End If
If Round(Number, 2) = Number Then RoundUp = Number
End Function 
```

（在模块中使用，如果不明显）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-11-08T22:23:08.237

```
Public Function RoundUpDown(value, decimals, updown)
If IsNumeric(value) Then
        rValue = Round(value, decimals)
        rDec = 10 ^ (-(decimals))
        rDif = rValue - value
        If updown = "down" Then 'rounding for "down" explicitly.
            If rDif > 0 Then ' if the difference is more than 0, it rounded up.
                RoundUpDown = rValue - rDec
            ElseIf rDif < 0 Then ' if the difference is less than 0, it rounded down.
                RoundUpDown = rValue
            Else
                RoundUpDown = rValue
            End If
        Else 'rounding for anything thats not "down"
            If rDif > 0 Then ' if the difference is more than 0, it rounded up.
                RoundUpDown = rValue
            ElseIf rDif < 0 Then ' if the difference is less than 0, it rounded down.
                RoundUpDown = rValue + rDec
            Else
                RoundUpDown = rValue
            End If
        End If

End If
'RoundUpDown(value, decimals, updown) 'where updown is "down" if down. else rounds up. put this in your program.
End Function 
```

# c++ - 在条件之外使用比较运算符

> ID：137147
> 
> 赞同：10
> 
> 时间：2008-09-26T00:42:57.780
> 
> 标签：c++, c, comparison-operators

例如

```
int f(int a) {
   ...
   return a > 10;
} 
```

是否被认为是可接受的（不合法，我的意思是它是“好代码”），还是应该总是在条件中，像这样

```
int f(int a) {
   ...
   if (a > 10)
      return 1;
   else
      return 0;
} 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-26T00:56:23.023

这是可以接受的 - 如果您的返回类型是[bool](http://en.wikipedia.org/wiki/Boolean_datatype#C99)。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-09-26T00:45:02.283

这是绝对可以接受的！事实上，Joel 在最新的 stackoverflow 播客中提到了这一点。他说这是他必须向几乎所有从 Fog Creek 开始的程序员展示的一件事。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-26T01:11:14.093

```
return a > 10 ? 1 : 0; 
```

... 更有意义，因为您返回的是 int，而不是 bool。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-26T01:01:16.723

第一种情况非常好，比第二种情况好得多，恕我直言。作为可读性的问题，我个人会做

```
 return  (a > 10); 
```

但这是一个小问题，并不是每个人都会同意。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T00:45:20.303

我看不出有什么问题。如果有的话，它更简洁，我认为大多数经验适中的开发人员会更喜欢它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T00:45:26.713

第一个对我来说更可取，因为它更简洁。（并且它避免了多次退货：）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T00:56:53.863

我宁愿写`bool f(int);`，第一种形式为 bool 是`boolean`C++ 中的类型。如果我真的需要返回一个`int`，我会写类似

```
int f(int) {
    ...
    const int res = (i>42) ? 1 : 0;
    return res;
} 
```

我从来不明白人们为什么写作

```
if (expr == true)
    mybool = true ; 
else 
    mybool = false; 
```

而不是平原

```
mybool = expr; 
```

布尔代数是任何开发人员都应该能够本能地处理的工具

*此外，我宁愿定义一个命名临时，因为一些调试器不能很好地处理函数返回值。*

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T00:50:32.943

我认为它完全可以接受，前提是您确保付出额外的努力来保持可读性。就像我会确保方法名称非常明确并且您使用好的变量名称一样。

我认为您提供的第二种选择几乎更糟，因为它涉及分支语句和多个返回语句，这些东西增加了方法的复杂性，同时降低了它的可读性。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T19:52:42.047

我认为部分原因与语言的风格和文化有关。您编写的第一个示例是经验丰富的 C 程序员所期望的。他们宁愿扼杀自己，也不愿放入不必要的陈述块。

我认为当语言允许并且使用是该语言范式的一部分时，这是完全可以接受的

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T16:03:01.287

不仅语法 100% 可以接受，您还应该随意在 if 语句之外使用布尔表达式，即`int x = i && ( j || k );`（或返回类似的值）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-07-29T04:52:16.890

我刚刚用 GCC 尝试了三种不同的变体：

```
int one(int x) { return (x > 42) ? 1 : 0; }
int two(int x) { return x > 42; }
int thr(int x) { if (x > 42) return 1; else return 0; } 
```

一旦您启用了一些优化，为所有这些生成的代码都是相同的。所以你应该使用最容易阅读的变体。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T00:47:07.350

我通常会做前者而不是后者。

# svn - 有没有办法在 TextMate 的右键菜单中添加 Subversion 部分？

> ID：137150
> 
> 赞同：1
> 
> 时间：2008-09-26T00:43:34.333
> 
> 标签：svn, textmate

我希望能够单击文件以还原它，或签入目录等。从右键菜单中获得这些会更方便。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T17:58:08.007

你见过这个吗？

**项目加**

ProjectPlus 是 TextMate 的插件，它扩展了项目相关特性的功能。

功能列表：* SCM 状态徽章：* 支持 SVN、Git、Mercurial、Bazaar 和 Svk * 显示在项目文件列表和窗口代理图标中

[http://ciaranwal.sh/projectplus](http://ciaranwal.sh/projectplus)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T00:48:01.543

我不这么认为。不过，我会推荐[SVNMate 捆绑包](http://ciaranwal.sh/2008/07/30/svnmate-update-for-subversion-15)。

# java - 是否有类似 ZenTest/Autotest for Java 和 JUnit 的东西

> ID：137158
> 
> 赞同：10
> 
> 时间：2008-09-26T00:45:35.917
> 
> 标签：java, ruby, unit-testing, tdd, autotest

我之前使用 ZenTest 和 autotest 来处理 Ruby 项目，并且我曾经使用它们来进行测试驱动开发，例如[这种配置](http://blog.internautdesign.com/2006/11/12/autotest-growl-goodness)。我有一个我目前正在使用 Java 进行的项目，我想知道 Java 世界中是否有类似的东西可以达到相同的效果。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-09T22:55:59.530

我也可以建议 Infinitest，它正在积极开发中，并且可以与 Java 以外的其他语言一起使用。我相信它在 Scala 上运行良好，但我在 Groovy 上使用它时运气不佳。

它是免费供个人使用的，正在由改进开发。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-23T12:16:48.917

我使用 junit max，它是由 kent beck 编写的 Eclipse 插件

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T03:41:29.257

尽管在 java 中使用类似 autotest 的工具的人并不多，但有一个（虽然不是那么成熟）。

[关于它的博客](http://nilanjan-braincasting.blogspot.com/2008/03/autotest-for-java.html)。

[java的自动测试](http://code.google.com/p/autotest4j/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T07:59:17.433

我使用了这个工具，第一次发布看起来很酷。我会要求他尽快拿出下一个版本...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-18T18:56:29.717

几周前，当我不得不开始做一些 java 时，我正在寻找这样的东西。我在任何地方都找不到任何东西（对java来说是新手）而且我不使用eclipse所以我一起破解了这个，希望将来有时间时让它更有用：

[http://github.com/feydr/crappe](http://github.com/feydr/crappe)

# apache - 查找 apache 构建选项

> ID：137181
> 
> 赞同：12
> 
> 时间：2008-09-26T00:55:27.453
> 
> 标签：apache

我需要重建一个 apache 服务器，但原始源不再可用。有什么方法（命令行切换到 httpd？）来获取最初使用的构建选项？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T01:01:36.380

试试 -V “打印 httpd 的版本和构建参数，然后退出”。

```
httpd -V 
```

此外，您可以通过以下方式查看 httpd 的选项：

```
httpd -h 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-04-29T16:47:13.483

我在 apache root 的构建目录中找到了以前的配置选项。

我是 Centos 5/6 用户。

阿帕奇版本。是 2.2.27。

apachedir/build/config.nice

```
#! /bin/sh
#
# Created by configure

"./configure" \
"--prefix=/usr/local/apache2" \
"--enable-so" \
"--enable-mods-shared=most" \
"--enable-ssl" \
"--with-mpm=worker" \
"--enable-cgi" \
"$@" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-17T10:50:20.110

我最近重新编译了 apache 2.4.3 并将 MPM 从 worker 更改为 prefork，如果您仍然保留原始编译目录而不运行“make distclean”（如果您运行“make clean”它仍然可以），您必须做什么。您可以使用相同的配置选项通过 exec ./config.status 重新配置，或者您可以从 ./config.status 中找到并复制“./configure”（是的，您用于运行配置的所有原始选项仍然存在）。

这是我的 config.status 的一部分...

```
if $ac_cs_silent; then
  exec 6>/dev/null
  ac_configure_extra_args="$ac_configure_extra_args --silent"
fi

if $ac_cs_recheck; then
  set X /bin/sh **'./configure'  '--enable-file-cache' '--enable-cache' '--enable-disk-cache' '--enable-mem-cache' '--enable-deflate' '--enable-expires' '--enable-headers' '--enable-usertrack' '--enable-cgi' '--enable-vhost-alias' '--enable-rewrite' '--enable-so' '--with-apr=/usr/local/apache/' '--with-apr-util=/usr/local/apache/' '--prefix=/usr/local/apache' '--with-mpm=worker' '--with-mysql=/var/lib/mysql' '--with-mysql-sock=/var/run/mysqld/mysqld.sock' '--enable-mods-shared=most' '--enable-ssl' 'CFLAGS=-Wall -O3 -ffast-math -frename-registers -mtune=corei7-avx' '--enable-modules=all' '--enable-proxy' '--enable-proxy-fcgi'** $ac_configure_extra_args --no-create --no-recursion
  shift
  $as_echo "running CONFIG_SHELL=/bin/sh $*" >&6
  CONFIG_SHELL='/bin/sh'
  export CONFIG_SHELL
  exec "$@"
fi 
```

# command-line - 如何使用特定路径启动 Windows 的 RegEdit？

> ID：137182
> 
> 赞同：44
> 
> 时间：2008-09-26T00:55:48.500
> 
> 标签：command-line, regedit

如何启动具有特定路径的 Windows 的[RegEdit](https://en.wikipedia.org/wiki/Windows_Registry#Registry_editors)`HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\8.0` ，例如“ ”，这样我就不必单击？

执行此操作的命令行参数是什么？或者有没有地方可以找到RegEdit的开关的解释？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-26T01:05:31.737

Mark Russinovich有一个名为[RegJump](http://technet.microsoft.com/en-us/sysinternals/bb963880.aspx)的程序，它可以满足您的需求。它将启动 regedit 并将其从命令行移至您想要的键。

RegJump 使用（或至少曾经）在每次调用时使用相同的 regedit 窗口，因此，如果您想要打开多个 regedit 会话，您仍然必须对除 RegJump 采用的一种方法之外的所有方法进行操作。一个小警告，但无论如何都要注意。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2012-09-20T15:33:20.683

使用以下批处理文件（添加到`filename.bat`）：

```
REG ADD HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit /v LastKey /t REG_SZ /d Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Veritas\NetBackup\CurrentVersion\Config /f
START regedit 
```

取代：

```
Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Veritas\NetBackup\CurrentVersion\Config 
```

与您的注册表路径。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T01:10:28.230

从[http://windowsxp.mvps.org/jumpreg.htm](http://windowsxp.mvps.org/jumpreg.htm)（我没有尝试过任何这些）：

当您启动 Regedit 时，它会自动打开查看过的最后一个键。（Windows XP 中的注册表编辑器将上次查看的注册表项保存在单独的位置）。如果您希望直接跳转到特定注册表项而不手动导航路径，您可以使用这些方法/工具中的任何一个。

**选项 1**
使用 VBScript：将这些行复制到记事本文档中，另存为 registry.vbs

```
'Launches Registry Editor with the chosen branch open automatically
'Author  : Ramesh Srinivasan
'Website: http://windowsxp.mvps.org

Set WshShell = CreateObject("WScript.Shell")
Dim MyKey
MyKey = Inputbox("Type the Registry path")
MyKey = "My Computer\" & MyKey
WshShell.RegWrite "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit\Lastkey",MyKey,"REG_SZ"
WshShell.Run "regedit", 1,True
Set WshShell = Nothing 
```

双击 Registry.vbs，然后键入要打开的完整注册表路径。

例子：`HKEY_CLASSES_ROOT\.MP3`

限制：如果 Regedit 已经打开，上述方法将无济于事。

注意：对于 Windows 7，您需要将该行替换为`MyKey = "My Computer\" & MyKey`（`MyKey = "Computer\" & MyKey`删除字符串`My`）。对于德语 Windows XP，字符串`"My Computer\"`必须替换为`"Arbeitsplatz\"`.

**来自 Sysinternals.com 的选项 2**
Regjump

这个小命令行小程序采用注册表路径并使 Regedit 向该路径打开。它接受标准（例如HKEY_LOCAL_MACHINE）和缩写形式（例如HKLM）的根密钥。

用法：regjump [路径]

例子：`C:\Regjump HKEY_CLASSES_ROOT\.mp3`

**选项 3**
来自 12ghosts.com 的 12Ghosts JumpReg

从托盘图标跳转到注册表项！这是一个非常有用的工具。您可以管理并直接跳转到经常访问的注册表项。无限列表大小，跳转到键和值，一键获取当前键，跳转到剪贴板中的键，在 HKCU 或 HKLM 中跳转到相同的键。在易于使用的托盘图标菜单中管理和排序带有注释的键。为注册表项创建快捷方式。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T01:15:44.770

我还想指出，您可以在 PowerShell 中查看和编辑注册表。启动它，然后使用 set-location 打开您选择的注册表位置。HKEY 的短名称用作文件系统中的驱动器号（所以要转到 HKEY_LOCAL_MACHINE\Software，您会说：set-location hklm:\Software）。

在 PowerShell 命令提示符下键入 get-help Registry 可以找到有关在 PowerShell 中管理注册表的更多详细信息。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-03-14T15:56:18.273

与此处发布的其他批处理解决方案相比，这里还有一个具有多项增强功能的批处理文件解决方案。

它还设置`LastKey`由 Regedit 本身在每次退出时更新的字符串值，以在启动与上次退出时相同的键后显示。

```
@echo off
setlocal EnableDelayedExpansion
set "RootName=Computer"

if not "%~1"=="" (
    set "RegKey=%~1"
    goto PrepareKey
)

echo/
echo Please enter the path of the registry key to open.
echo/
set "RegKey="
set /P "RegKey=Key path: "

rem Exit batch file without starting Regedit if nothing entered by user.
if "!RegKey!"=="" goto ExitBatch

:PrepareKey
rem Remove square brackets and double quotes from entered key path.
set "RegKey=!RegKey:"=!"
if "!RegKey!"=="" goto ExitBatch
set "RegKey=!RegKey:[=!"
if "!RegKey!"=="" goto ExitBatch
set "RegKey=!RegKey:]=!"
if "!RegKey!"=="" goto ExitBatch

rem Replace hive name abbreviation by appropriate long name.
set "Abbreviation=%RegKey:~0,4%"
if /I "%Abbreviation%"=="HKCC" (
    set "RegKey=HKEY_CURRENT_CONFIG%RegKey:~4%"
    goto GetRootName
)
if /I "%Abbreviation%"=="HKCR" (
    set "RegKey=HKEY_CLASSES_ROOT%RegKey:~4%"
    goto GetRootName
)
if /I "%Abbreviation%"=="HKCU" (
    set "RegKey=HKEY_CURRENT_USER%RegKey:~4%"
    goto GetRootName
)
if /I "%Abbreviation%"=="HKLM" (
    set "RegKey=HKEY_LOCAL_MACHINE%RegKey:~4%"
    goto GetRootName
)
if /I "%RegKey:~0,3%"=="HKU" (
    set "RegKey=HKEY_USERS%RegKey:~3%"
)

:GetRootName
rem Try to determine automatically name of registry root.
for /F "tokens=1,2*" %%K in ('%SystemRoot%\System32\reg.exe query "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit" /v "LastKey"') do (
    if /I "%%K"=="LastKey" (
        for /F "delims=\" %%N in ("%%M") do set "RootName=%%N"
    )
)

rem Is Regedit already running?
%SystemRoot%\System32\tasklist.exe | %SystemRoot%\System32\findstr.exe /B /I /L regedit.exe >nul
if errorlevel 1 goto SetRegPath

echo/
echo Regedit is already running. Path can be set only when Regedit is not running.
echo/
set "Choice=N"
set /P "Choice=Kill Regedit (y/N): "
if /I "!Choice!"=="y" (
    %SystemRoot%\System32\taskkill.exe /IM regedit.exe >nul 2>nul
    goto SetRegPath
)
echo Switch to running instance of Regedit without setting entered path.
goto StartRegedit

:SetRegPath
rem Add this key as last key to registry for Regedit.
%SystemRoot%\System32\reg.exe add "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit" /v "LastKey" /d "%RootName%\%RegKey%" /f >nul 2>nul

:StartRegedit
start /B regedit.exe

:ExitBatch
endlocal 
```

增强功能是：

1.  注册表路径也可以作为命令行参数传递给批处理脚本。

2.  可以输入或粘贴注册表路径，带或不带双引号。

3.  注册表路径可以输入或粘贴或作为参数传递，带或不带方括号。

4.  注册表路径可以输入或粘贴或作为参数传递，也可以使用缩写的配置单元名称（HKCC、HKCU、HKCR、HKLM、HKU）。

5.  批处理脚本检查是否已运行 Regedit，因为在 Regedit 已运行时启动 Regedit 时未显示注册表项。询问批处理用户是否应该杀死正在运行的实例以重新启动它以显示输入的注册表路径。如果批处理用户选择不杀死 Regedit，则在不设置输入路径的情况下启动 Regedit，导致（通常）只是将 Regedit 窗口置于前台。

6.  批处理文件尝试自动获取在英语 Windows XP **My Computer**上、在德语 Windows XP、**Arbeitsplatz**上和在 Windows 7 上只是**Computer**上的注册表根名称。`LastKey`如果注册表中缺少 Regedit的值或为空，这可能会失败。对于这种情况，请在批处理代码的第三行设置正确的根名称。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-03-27T19:20:58.587

复制以下文本并将其保存为批处理文件并运行

```
@ECHO OFF
SET /P "showkey=Please enter the path of the registry key: "
REG ADD "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit" /v "LastKey" /d "%showkey%" /f
start "" regedit 
```

在批处理文件提示时输入要打开的注册表项的路径，然后按`Enter`。Regedit 打开该值中定义的键。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-01-19T18:47:14.530

我认为这个 C# 解决方案可能会有所帮助：

通过利用较早的建议，我们可以欺骗 RegEdit 打开我们想要的密钥，即使我们不能将密钥作为参数传递。

在此示例中，“注册表设置”的菜单选项将 RegEdit 打开到调用它的程序的节点。

节目形式：

```
 private void registrySettingsToolStripMenuItem_Click(object sender, EventArgs e)
    {
        string path = string.Format(@"Computer\HKEY_CURRENT_USER\Software\{0}\{1}\",
                                    Application.CompanyName, Application.ProductName);

        MyCommonFunctions.Registry.OpenToKey(path);

    } 
```

我的CommonFunctions.Registry

```
 /// <summary>Opens RegEdit to the provided key
    /// <para><example>@"Computer\HKEY_CURRENT_USER\Software\MyCompanyName\MyProgramName\"</example></para>
    /// </summary>
    /// <param name="FullKeyPath"></param>
    public static void OpenToKey(string FullKeyPath)
    {
        RegistryKey rKey = Microsoft.Win32.Registry.CurrentUser.OpenSubKey(@"SOFTWARE\Microsoft\Windows\CurrentVersion\Applets\Regedit", true);
        rKey.SetValue("LastKey",FullKeyPath);

        Process.Start("regedit.exe");
    } 
```

当然，您可以将它们全部放在表单的一种方法中，但我喜欢可重用性。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-04-11T17:35:41.893

这是一个基于以上答案的简单 PowerShell 函数[https://stackoverflow.com/a/12516008/1179573](https://stackoverflow.com/a/12516008/1179573)

```
function jumpReg ($registryPath)
{
    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit" `
                     -Name "LastKey" `
                     -Value $registryPath `
                     -PropertyType String `
                     -Force

    regedit
}

jumpReg ("Computer\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run") | Out-Null 
```

上面的答案实际上并不能很好地解释它的作用。当您关闭 RegEdit 时，它会将您的最后一个已知位置保存在 中`HKCU:\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit`，因此这只是将最后一个已知位置替换为您要跳转的位置，然后将其打开。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-10-03T21:12:19.117

使用 clipboard.exe 和 regjump.exe 创建 BAT 文件以跳转到剪贴板中的键：

```
clipboard.exe > "%~dp0clipdata.txt"
set /p clipdata=input < "%~dp0clipdata.txt"
regjump.exe %clipdata% 
```

（%~dp0 表示“BAT 文件的路径”）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-02-16T00:01:49.197

基于[lionkingrafiki 的回答](https://stackoverflow.com/a/22697203/1683264)，这是一个更强大的解决方案，它将接受 reg 密钥路径作为参数，并根据需要自动将 HKLM 转换为 HKEY_LOCAL_MACHINE 或类似的。[如果没有参数，则脚本使用JScript 混合嵌合体](https://stackoverflow.com/a/15747067/1683264)`htmlfile`调用的 COM 对象检查剪贴板。复制的数据将被分割和标记化，因此它是否没有被修剪甚至在整个复制的污垢段落中都没有关系。最后，在修改之前验证密钥的存在。包含空格的关键路径必须在双引号内。`LastKey`

```
@if (@CodeSection == @Batch) @then
:: regjump.bat
@echo off & setlocal & goto main

:usage
echo Usage:
echo   * %~nx0 regkey
echo   * %~nx0 with no args will search the clipboard for a reg key
goto :EOF

:main
rem // ensure variables are unset
for %%I in (hive query regpath) do set "%%I="

rem // if argument, try navigating to argument.  Else find key in clipboard.
if not "%~1"=="" (set "query=%~1") else (
    for /f "delims=" %%I in ('cscript /nologo /e:JScript "%~f0"') do (
        set "query=%%~I"
    )
)

if not defined query (
    echo No registry key was found in the clipboard.
    goto usage
)

rem // convert HKLM to HKEY_LOCAL_MACHINE, etc. while checking key exists
for /f "delims=\" %%I in ('reg query "%query%" 2^>NUL') do (
    set "hive=%%~I" & goto next
)

:next
if not defined hive (
    echo %query% not found in the registry
    goto usage
)

rem // normalize query, expanding HKLM, HKCU, etc.
for /f "tokens=1* delims=\" %%I in ("%query%") do set "regpath=%hive%\%%~J"
if "%regpath:~-1%"=="\" set "regpath=%regpath:~0,-1%"

rem // https://stackoverflow.com/a/22697203/1683264
>NUL 2>NUL (
    REG ADD "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit"^
        /v "LastKey" /d "%regpath%" /f
)

echo %regpath%

start "" regedit
goto :EOF

@end // begin JScript hybrid chimera
// https://stackoverflow.com/a/15747067/1683264
var clip = WSH.CreateObject('htmlfile').parentWindow.clipboardData.getData('text');

clip.replace(/"[^"]+"|\S+/g, function($0) {
    if (/^\"?(HK[CLU]|HKEY_)/i.test($0)) {
        WSH.Echo($0);
        WSH.Quit(0);
    }
}); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T01:04:30.117

这似乎非常过时，但*[注册信息编辑器（REGEDIT）命令行开关](http://support.microsoft.com/kb/82821)*声称它*不*支持这一点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-03-18T16:48:13.607

您可以通过创建一个批处理文件（根据已经给出的提交）使其看起来像 regedit 执行此行为，但将其命名为 regedit.bat 并将其放在 C:\WINDOWS\system32 文件夹中。（如果没有给出命令行参数，您可能希望它跳过编辑注册表中的最后一个键，因此“regedit”本身就像 regedit 一样工作）然后“regedit HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\8.0”会做什么你要。

这使用了 PATH 中的顺序通常是 C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem; 的事实。ETC

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-09-21T13:58:25.953

如果主要目标只是避免“点击”，那么在 Windows 10 中，您只需将目标路径键入或粘贴到 RegEdit 的地址栏中，然后按 Enter。

[![RegEdit 地址栏](https://i.stack.imgur.com/7pXOf.png)](https://i.stack.imgur.com/7pXOf.png)

这里的`Computer\`前缀是自动添加的。如果您只需键入或粘贴以 eg 开头的路径，它也将起作用`HKEY_CURRENT_USER\...`。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-04-08T07:28:46.793

PowerShell代码：

```
# key you want to open
$regKey = "Computer\HKEY_LOCAL_MACHINE\Software\Microsoft\IntuneManagementExtension\Policies\"
# set starting location for regedit
Set-ItemProperty "HKCU:\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit" "LastKey" $regKey
# open regedit (-m allows multiple regedit windows)
regedit.exe -m 
```

# java - 如何处理缓慢的 SecureRandom 生成器？

> ID：137212
> 
> 赞同：181
> 
> 时间：2008-09-26T01:07:04.243
> 
> 标签：java, performance, security, random, entropy

如果你想在 Java 中使用加密的强随机数，你可以使用`SecureRandom`. 不幸的是，`SecureRandom`可能会很慢。如果它`/dev/random`在 Linux 上使用，它可以阻止等待足够的熵建立。如何避免性能损失？

有没有人用[Uncommon Maths](https://uncommons-maths.dev.java.net/)来解决这个问题？

谁能确认这个性能问题已经在 J​​DK 6 中解决了？

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2010-02-24T10:11:07.813

您应该能够使用以下命令在 Linux 上选择速度更快但安全性稍差的 /dev/urandom：

```
-Djava.security.egd=file:/dev/urandom 
```

但是，这不适用于 Java 5 及更高版本 ( [Java Bug 6202721](https://bugs.openjdk.java.net/browse/JDK-6202721) )。建议的解决方法是使用：

```
-Djava.security.egd=file:/dev/./urandom 
```

（注意额外的`/./`）

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2008-09-26T01:39:13.217

如果您想要真正的随机数据，那么不幸的是您必须等待它。这包括`SecureRandom`PRNG 的种子。Uncommon Maths 无法比 更快地收集真正的随机数据`SecureRandom`，尽管它可以连接到互联网以从特定网站下载种子数据。我的猜测是，这不太可能比`/dev/random`可用的地方更快。

如果您想要 PRNG，请执行以下操作：

```
SecureRandom.getInstance("SHA1PRNG"); 
```

支持哪些字符串取决于SPI 提供程序，但您可以使用和`SecureRandom`枚举它们。`Security.getProviders()``Provider.getService()`

Sun 喜欢 SHA1PRNG，因此它被广泛使用。PRNG 的运行速度并不是特别快，但 PRNG 只会处理数字，而不是阻止熵的物理测量。

例外情况是，如果您在获取数据之前不调用`setSeed()`，那么 PRNG 将在您第一次调用`next()`或时自行播种`nextBytes()`。它通常会使用来自系统的少量真实随机数据来执行此操作。此调用可能会阻塞，但会使您的随机数来源比“将当前时间与 PID 一起散列，加 27，并希望最好”的任何变体更加安全。但是，如果您只需要游戏的随机数，或者如果您希望流在将来可重复使用相同的种子进行测试，那么不安全的种子仍然有用。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-09-26T11:01:22.863

在 Linux 上，默认实现`SecureRandom`是`NativePRNG`(source code [here](http://www.java2s.com/Open-Source/Java/6.0-JDK-Platform/solaris/sun/security/provider/NativePRNG.java.htm) )，这往往很慢。在 Windows 上，默认值为`SHA1PRNG`，正如其他人指出的那样，如果您明确指定它，您也可以在 Linux 上使用它。

`NativePRNG`与`SHA1PRNG`Uncommons Math 的[AESCounterRNG](http://maths.uncommons.org/api/org/uncommons/maths/random/AESCounterRNG.html)不同之处在于它不断地从操作系统接收熵（通过从 读取`/dev/urandom`）。其他 PRNG 在播种后不会获得任何额外的熵。

AESCounterRNG 大约比 IIRC 快 10 倍`SHA1PRNG`，而 IIRC 本身比`NativePRNG`.

如果您需要在初始化后获取熵的更快 PRNG，请查看是否可以找到[Fortuna](http://en.wikipedia.org/wiki/Fortuna_(PRNG))的 Java 实现。Fortuna 实现的核心 PRNG 与 AESCounterRNG 使用的相同，但也有一个复杂的熵池和自动重新播种系统。

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2017-11-03T13:43:03.827

许多 Linux 发行版（主要基于 Debian）配置 OpenJDK 以`/dev/random`用于熵。

`/dev/random`根据定义，速度很慢（甚至可以阻塞）。

从这里你有两个选项来解锁它：

1.  提高熵，或
2.  减少随机性要求。

**选项 1，提高熵**

要获得更多的熵`/dev/random`，请尝试[**haveged**](https://www.digitalocean.com/community/tutorials/how-to-setup-additional-entropy-for-cloud-servers-using-haveged)守护进程。它是一个持续收集 HAVEGE 熵的守护进程，也可以在虚拟化环境中工作，因为它不需要任何特殊硬件，只需要 CPU 本身和时钟。

在 Ubuntu/Debian 上：

```
apt-get install haveged
update-rc.d haveged defaults
service haveged start 
```

在 RHEL/CentOS 上：

```
yum install haveged
systemctl enable haveged
systemctl start haveged 
```

**选项 2\. 减少随机性要求**

如果由于某种原因上述解决方案没有帮助，或者您不关心密码学上的强随机性，您可以改用`/dev/urandom`它，这样可以保证不会阻塞。

要在全局范围内执行此操作`jre/lib/security/java.security`，请在默认 Java 安装中编辑要使用的文件`/dev/urandom`（由于另一个[错误](https://bugs.openjdk.java.net/browse/JDK-6202721)，它需要指定为`/dev/./urandom`）。

像这样：

```
#securerandom.source=file:/dev/random
securerandom.source=file:/dev/./urandom 
```

然后，您将不必在命令行上指定它。

* * *

注意：如果你做密码学，你*需要*好的熵。恰当的例子 - [android PRNG 问题](https://bitcoin.org/en/alert/2013-08-11-android)降低了比特币钱包的安全性。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2015-05-20T19:40:10.840

`SecureRandom`在无头 Debian 服务器上一次调用阻塞大约 25 秒时，我遇到了类似的问题。我安装了`haveged`守护程序以确保`/dev/random`保持充值，在无头服务器上，您需要这样的东西来生成所需的熵。我`SecureRandom`现在的电话可能需要几毫秒。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-26T17:48:14.530

如果您想要真正的“加密强”随机性，那么您需要一个强大的熵源。`/dev/random`速度很慢，因为它必须等待系统事件收集熵（磁盘读取、网络数据包、鼠标移动、按键等）。

更快的解决方案是硬件随机数生成器。您的主板可能已经内置了一个；查看[hw_random 文档](http://www.mjmwired.net/kernel/Documentation/hw_random.txt)以获取有关确定是否拥有它以及如何使用它的说明。rng-tools 包包含一个守护进程，它将硬件生成的熵输入到`/dev/random`.

如果您的系统上没有 HRNG，并且您愿意为性能牺牲熵强度，您将希望使用来自 的数据播种一个好的 PRNG `/dev/random`，并让 PRNG 完成大部分工作。[SP800-90](http://csrc.nist.gov/publications/nistpubs/800-90/SP800-90revised_March2007.pdf)中列出了几个 NIST 批准的 PRNG， 它们易于实施。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2019-10-01T10:06:04.540

根据[文档](https://docs.oracle.com/en/java/javase/11/security/oracle-providers.html#GUID-9DC4ADD5-6D01-4B2E-9E85-B88E3BEE7453 "JDK Providers 文档 – 表 4-3 默认 SecureRandom 实现")，SecureRandom 使用的不同算法按优先顺序排列：

*   在大多数 *NIX 系统上（包括 macOS）
    1.  PKCS11（仅在 Solaris 上）
    2.  本机PRNG
    3.  SHA1PRNG
    4.  NativePRNG阻塞
    5.  NativePRNG非阻塞
*   在 Windows 系统上
    1.  DRBG
    2.  SHA1PRNG
    3.  Windows-PRNG

既然您询问了 Linux，我将忽略 Windows 实现以及仅在 Solaris 上真正可用的 PKCS11，除非您自己安装它 — 如果您安装了它，您可能不会问这个问题。

根据相同的文档，[这些算法使用](https://docs.oracle.com/en/java/javase/11/security/oracle-providers.html#d53600e823 "JDK Providers 文档 – 表 4-4 SUN 提供程序中的算法")的是

##### SHA1PRNG

目前，初始播种是通过系统属性和 java.security 熵收集设备的组合来完成的。

##### 本机PRNG

`nextBytes()`用途`/dev/urandom`
`generateSeed()`用途`/dev/random`

##### NativePRNG阻塞

`nextBytes()`并`generateSeed()`使用`/dev/random`

##### NativePRNG非阻塞

`nextBytes()`并`generateSeed()`使用`/dev/urandom`

* * *

这意味着如果您使用`SecureRandom random = new SecureRandom()`，它会在该列表中向下查找，直到找到一个有效的，这通常是 NativePRNG。这意味着它自己播种`/dev/random`（或使用它，如果你明确地生成一个种子），然后`/dev/urandom`用于获取下一个字节、整数、双精度、布尔值、你有什么。

因为`/dev/random`是阻塞的（它阻塞直到它在熵池中有足够的熵），这可能会阻碍性能。

一种解决方案是使用类似 hasged 的​​东西来生成足够的熵，另一种解决方案是使用`/dev/urandom`。虽然您可以为整个 jvm 设置它，但更好的解决方案是`SecureRandom`通过使用`SecureRandom random = SecureRandom.getInstance("NativePRNGNonBlocking")`. 请注意，如果 NativePRNGNonBlocking 不可用，该方法可能会抛出 NoSuchAlgorithmException，因此请准备好回退到默认值。

```
SecureRandom random;
try {
    random = SecureRandom.getInstance("NativePRNGNonBlocking");
} catch (NoSuchAlgorithmException nsae) {
    random = new SecureRandom();
} 
```

另请注意，在其他 *nix 系统上，[`/dev/urandom`可能会有不同的行为](https://en.wikipedia.org/wiki//dev/random#FreeBSD "维基百科上的 /dev/random，FreeBSD 部分")。

* * *

### 够`/dev/urandom`随机吗？

传统智慧认为只有`/dev/random`足够随机。但是，有些声音不同。在[“使用 SecureRandom 的正确方法”](https://tersesystems.com/blog/2015/12/17/the-right-way-to-use-securerandom/ "简洁系统：“使用 SecureRandom 的正确方法”")和[“关于 /dev/urandom 的神话”](https://www.2uo.de/myths-about-urandom/ "关于 /dev/urandom 的神话 Thomas Hühn")中，有人认为这`/dev/urandom/`同样好。

信息安全堆栈上的用户[同意这一点](https://security.stackexchange.com/a/3939/34215 "来自 /dev/urandom 的 rand 对于登录密钥是否安全？")。基本上，如果你不得不问，`/dev/urandom`这对你的目的来说很好。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-26T01:26:51.390

您提到的问题`/dev/random`不在于`SecureRandom`算法，而在于它使用的随机性来源。两者是正交的。您应该弄清楚两者中的哪一个在减慢您的速度。

您明确链接的罕见数学页面提到他们没有解决随机性的来源。

您可以尝试不同的 JCE 提供程序，例如 BouncyCastle，看看他们的实现`SecureRandom`是否更快。

一个简短的[搜索](http://www.google.com/search?q=fortuna+/dev/random)还发现了用 Fortuna 替换默认实现的 Linux 补丁。我对此了解不多，但欢迎您调查。

我还应该提一下，虽然使用实现不佳的`SecureRandom`算法和/或随机源非常危险，但您可以使用自定义实现来推出自己的 JCE 提供程序`SecureRandomSpi`。您需要通过 Sun 的流程来签署您的提供商，但这实际上非常简单；他们只需要你给他们传真一份表格，说明你知道美国对加密库的出口限制。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2016-11-30T10:20:02.167

使用 Java 8，我发现在 Linux 上调用`SecureRandom.getInstanceStrong()`会给我`NativePRNGBlocking`算法。这通常会阻塞几秒钟以生成几个字节的盐。

我改为明确要求`NativePRNGNonBlocking`，正如名称所预期的那样，它不再被阻止。我不知道这对安全有什么影响。大概非阻塞版本不能保证使用的熵量。

**更新**：好的，我找到[了这个很好的解释](https://tersesystems.com/2015/12/17/the-right-way-to-use-securerandom/)。

简而言之，为避免阻塞，请使用`new SecureRandom()`. 这使用`/dev/urandom`, 它不会阻塞并且基本上与`/dev/random`. 来自帖子：“您唯一想调用 /dev/random 的时间是机器首次启动时，熵尚未累积”。

`SecureRandom.getInstanceStrong()`给你绝对最强的RNG，但只有在一堆阻塞不会影响你的情况下才能安全使用。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-08-28T12:35:10.323

有一个工具（至少在 Ubuntu 上）可以为您的系统提供人工随机性。命令很简单：

```
rngd -r /dev/urandom 
```

你可能需要一个 sudo 在前面。如果您没有 rng-tools 软件包，则需要安装它。我试过这个，它肯定对我有帮助！

资料来源：[马特与世界](http://www.mattvsworld.com/blog/2010/02/speed-up-key-generation-with-artificial-entropy/)

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2016-11-17T05:50:25.363

我面临同样的[问题](https://stackoverflow.com/questions/40383430/tomcat-takes-too-much-time-to-start-java-securerandom)。在使用正确的搜索词进行谷歌搜索后，我在[DigitalOcean](https://www.digitalocean.com/community/tutorials/how-to-setup-additional-entropy-for-cloud-servers-using-haveged)上看到了这篇不错的文章。

## haveged 是一种潜在的解决方案，不会影响安全性。

我只是在这里引用文章中的相关部分。

> 基于 HAVEGE 原则，以及之前基于其关联库，haveged 允许根据处理器上代码执行时间的变化生成随机性。由于一段代码几乎不可能花费相同的确切时间来执行，即使在相同硬件上的相同环境中，运行单个或多个程序的时间应该适合随机源。haveged 实现在重复执行循环后使用处理器时间戳计数器 (TSC) 的差异为系统的随机源（通常是 /dev/random）播种

## 如何安装haveged

按照本文中的步骤操作。[https://www.digitalocean.com/community/tutorials/how-to-setup-additional-entropy-for-cloud-servers-using-haveged](https://www.digitalocean.com/community/tutorials/how-to-setup-additional-entropy-for-cloud-servers-using-haveged)

我已经在[这里发布了](https://stackoverflow.com/a/40603084/6785908)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-26T01:11:19.477

我自己没有遇到过这个问题，但是我会在程序启动时产生一个线程，它会立即尝试生成一个种子，然后死掉。如果它是活动的，你调用随机数的方法将加入该线程，所以第一个调用只有在程序执行的早期发生时才会阻塞。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-26T03:38:03.523

我的经验只是 PRNG 的缓慢初始化，而不是之后随机数据的生成。尝试更急切的初始化策略。由于创建它们的成本很高，因此将其视为单例并重用相同的实例。如果一个实例的线程争用过多，请将它们池化或使它们成为线程本地的。

不要在随机数生成上妥协。那里的弱点会危及您的所有安全。

我没有看到很多基于 COTS 原子衰变的生成器，但如果你真的需要大量随机数据，它们有几个计划。[John Walker 的 Fourmilab](http://www.fourmilab.ch/)是一个总是有有趣事物值得关注的站点，包括HotBits。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-12-23T14:27:50.987

听起来您应该更清楚您的 RNG 要求。最强的加密 RNG 要求（据我了解）是，即使您知道用于生成它们的算法，并且您知道所有先前生成的随机数，您也无法获得任何关于生成的任何随机数的有用信息未来，无需花费不切实际的计算能力。

如果您不需要这种随机性的完全保证，那么可能会有适当的性能权衡。我倾向于同意[Dan Dyer 对](https://stackoverflow.com/questions/137212/how-to-solve-performance-problem-with-java-securerandom#138745)Uncommons-Maths 或 Fortuna 的 AESCounterRNG 的回应（其作者之一是密码学专家 Bruce Schneier）。我从来没有使用过，但乍一看，这些想法似乎很有名。

我*认为*，如果您可以定期生成初始随机种子（例如，每天或每小时一次或其他），您可以使用快速流密码从流的连续块中生成随机数（如果流密码使用 XOR 则只需传入空值流或直接获取 XOR 位）。ECRYPT 的[eStream](http://www.ecrypt.eu.org/stream/)项目有很多很好的信息，包括性能基准。这不会在你补充它的时间点之间保持熵，所以如果有人知道其中一个随机数和你使用的算法，从技术上讲，有可能用大量的计算能力来破解流密码和猜测其内部状态以能够预测未来的随机数。但是你必须决定这种风险及其后果是否足以证明维持熵的成本是合理的。

编辑：这是我在网上找到的一些[关于 RNG 的加密课程笔记](http://www.tml.tkk.fi/Opinnot/T-110.470/2004/20041101.pdf)，看起来与这个主题非常相关。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-26T12:36:19.617

使用安全随机作为循环算法的初始化源；然后，您可以使用 Mersenne twister 进行大量工作，而不是 UncommonMath 中的那个，它已经存在了一段时间并且被证明比其他 prng 更好

[http://en.wikipedia.org/wiki/Mersenne_twister](http://en.wikipedia.org/wiki/Mersenne_twister)

确保不时刷新用于初始化的安全随机，例如，您可以为每个客户端生成一个安全随机，每个客户端使用一个 mersenne twister 伪随机生成器，获得足够高的随机化程度

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2013-09-15T18:38:32.660

如果您的硬件支持它，请尝试使用我是其作者的[Java RdRand Utility 。](https://github.com/hpadmanabhan/rdrand-util)

它基于 Intel 的`RDRAND`指令，比大容量实现快 10 倍，`SecureRandom`并且没有带宽问题。

* * *

请注意，此实现仅适用于提供指令的那些 CPU（即，当设置`rdrand`处理器标志时）。您需要通过`RdRandRandom()`构造函数显式实例化它；没有具体`Provider`实施。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-03T23:42:21.407

其他要查看的是文件 lib/security/java.security 中的属性 securerandom.source

使用 /dev/urandom 而不是 /dev/random 可能会带来性能优势。请记住，如果随机数的质量很重要，请不要做出破坏安全性的妥协。

# scripting - 在引导时自动在 FreeBSD 上挂载 NTFS 分区

> ID：137219
> 
> 赞同：2
> 
> 时间：2008-09-26T01:10:00.273
> 
> 标签：scripting, operating-system, sysadmin

我正在寻找以读/写模式在 FreeBSD 6.2 上挂载 NTFS 硬盘的方法。

搜索谷歌，我发现 NTFS-3G 可以提供帮助。

使用 NTFS-3G，当我尝试手动挂载/卸载 NTFS 时没有问题：

挂载：ntfs-3g /dev/ad1s1 /home/admin/data -o uid=1002，

或者

卸载：卸载/home/admin/data

但是当尝试在启动时自动挂载 ntfs 硬盘时我遇到了问题。

我努力了：

*   添加 fstab：/dev/ad1s1 /home/admin/data ntfs-3g uid=1002 0 0
*   制作一个脚本，在启动时自动挂载 ntfs 分区，在 /usr/local/etc/rc.d/ 目录上。

但它仍然失败。该脚本在手动执行时运行良好。

有谁知道在 FreeBSD 6.2 上具有读/写访问 NTFS 的替代方法/解决方案？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T06:36:23.813

你的脚本运行在什么级别？是S99还是更低？

听起来要么在您挂载时未加载依赖项，要么尝试使用脚本挂载的用户无法成功。

在您的脚本中，我建议添加一个 sudo 以确保安装是由 root 执行的：

```
/sbin/sudo /sbin/mount ntfs-3g /dev/ad1s1 /home/admin/data -o uid=1002, etc 
```

将 sbin 交换为二进制文件所在的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T07:29:04.900

经过我之前尝试过的一些方法。最后，我尝试通过更改 mount.c 上的挂载脚本来添加 ntfs-3g 支持，如下所示：

use_mountprog(const char *vfstype)

{

```
 /* XXX: We need to get away from implementing external mount
     *      programs for every filesystem, and move towards having
     *      each filesystem properly implement the nmount() system call.
     */

    unsigned int i;
    const char *fs[] = {
    "cd9660", "mfs", "msdosfs", "nfs", "nfs4", "ntfs",
    "nwfs", "nullfs", "portalfs", "smbfs", "udf", "unionfs",
    "ntfs-3g"
    NULL
    };

    for (i = 0; fs[i] != NULL; ++i) {
            if (strcmp(vfstype, fs[i]) == 0)
                    return (1);
    }

    return (0); 
```

}

重新编译安装程序，它可以工作了！

谢谢...

# silverlight - 在哪里可以找到 Silverlight 的自动完成文本框代码示例？

> ID：137221
> 
> 赞同：0
> 
> 时间：2008-09-26T01:10:57.793
> 
> 标签：silverlight, textbox

我今天已经搜索了一段时间，但我无法为 Silverlight 2 Beta 2 提供 AutoComplete TextBox 代码示例。最有希望的参考资料是在[nikhilk.net](http://www.nikhilk.net/Silverlight-AutoComplete.aspx/)上找到的，但目前还没有在线演示渲染并下载获取代码以使用 Beta 2 编译后，我也无法获取 Silverlight 插件来渲染它。我认为可以公平地说这是一个兼容性问题，但我不确定。有没有人有任何替代示例代码或实施建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T15:19:04.250

您可能想看看我的博客：[http ://weblogs.manas.com.ar/ary/2008/09/26/autocomplete-in-silverlight/](http://weblogs.manas.com.ar/ary/2008/09/26/autocomplete-in-silverlight/)

您只需在 XAML 中编写：

```
manas:Autocomplete.Suggest="DoSuggest" 
```

然后在类文件中，您需要实现该方法，该方法向委托报告建议。这些选项可以是硬编码的，可以向 Web 服务请求，或者是什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T01:14:44.820

在 worksight 的博客[Silverlight ComboBox中查看组合框（非常接近自动完成文本框）](http://worksightblog.com/?p=72)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-09T03:02:02.090

这里还有另一个很好的例子：

[http://silvermail.com.au](http://silvermail.com.au)

这是一个基于 Silverlight 的邮件客户端，看起来有点像 Outlook。当我去发送邮件并开始在“收件人”文本框中输入时，会弹出一个自动完成并根据列表中的值为我填充控件......我认为它会自动将地址存储在隔离存储中，但是这只是一个猜测。

这是一个非常方便的工具，用于在远离我的家用 PC 时检查邮件......例如在工作中......它具有令人印象深刻的 Silverlight 功能。

S。

# sql - 您如何针对特定查询优化表？

> ID：137226
> 
> 赞同：8
> 
> 时间：2008-09-26T01:13:06.787
> 
> 标签：sql, database-design

1.  您用来确定频繁查询的模式是什么？
2.  如何选择优化因子？
3.  可以进行哪些类型的更改？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T11:48:17.267

这是一个很好的问题，如果相当广泛（并且没有更糟）。
如果我理解你，那么你问的是如何从头开始解决优化问题。

第一个要问的问题是：“*有性能问题吗？* ”
如果没有问题，那么你就完成了。这种情况经常发生。好的。

另一方面...

### 确定频繁查询

**日志记录**将为您提供频繁的查询。
如果您使用某种数据访问层，那么添加代码来记录所有查询可能很简单。
记录查询的执行时间以及每个查询需要多长时间也是一个好主意。这可以让您了解问题所在。
另外，**询问用户**哪些位让他们烦恼。如果缓慢的响应不会惹恼用户，那么没关系。

### 选择优化因素？

（我可能误解了这部分问题）您正在寻找查询/响应时间中的任何模式。
这些通常是对大型表的查询或在单个查询中连接多个表的查询。...但是如果您记录响应时间，则可以按照这些时间进行指导。

### 可以做出哪些改变？

您专门询问优化表。
以下是您可以查找的一些内容：

*   **非规范化**。这将几个表合并到一个更宽的表中，因此您不必将多个表连接在一起，而只需读取一个表即可。这是一种非常常见且功能强大的技术。注意。我建议保留原始规范化表并另外构建非规范化表 - 这样，您就不会丢弃任何东西。如何保持最新是另一个问题。您可以在基础表上使用触发器，或者定期运行刷新过程。
*   **归一化**。这通常不被认为是一个优化过程，但有两种情况：
    *   更新。规范化使更新更快，因为每次更新都是最小的（您正在更新最小的 - 就列和行而言 - 可能的表。这几乎是规范化的定义。
    *   查询非规范化表以获取存在于更小（更少行）表上的信息可能会导致问题。在这种情况下，存储规范化的表以及非规范化的表（见上文）。
*   **水平分区**。这意味着通过将一些行放在另一个相同的表中来使表更小。一个常见的用例是在表 ThisMonthSales 中包含本月的所有行，在表*OldSales中**包含*所有较旧的行，其中两个表具有相同的架构。如果大多数查询是针对最近的数据，则此策略可能意味着 99% 的所有查询只查看 1% 的数据 - 巨大的性能优势。
*   **垂直分区**。这是从表中切出字段并将它们放入一个新表中，该表通过主键连接回主表。这对于非常宽的表（例如，有几十个字段）很有用，并且如果表中填充的内容很少，可能会有所帮助。
*   **下降**。我不确定您的问题是否涵盖这些，但是关于使用 indeces 的 SO 还有很多其他答案。为索引查找案例的一个好方法是：查找慢查询。查看查询计划并找到表扫描。该表上的索引字段，以便删除表扫描。如果需要，我可以写更多关于这个 - 发表评论。

你可能也喜欢[我在这方面的帖子](https://stackoverflow.com/questions/18783/sql-what-are-your-favorite-performance-tricks#103176)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T01:16:23.317

你的问题有点含糊。哪个数据库平台？

如果我们谈论的是 SQL Server：

1.  使用动态管理视图。使用 SQL 事件探查器。安装 SP2 和性能仪表板报告。
2.  在确定最昂贵的查询（即运行次数 x 一次查询成本）之后，检查它们的执行计划，并查看所涉及的表的大小，以及它们主要是读取还是写入，或两者兼而有之。
3.  如果系统在您的完全控制之下（应用程序和数据库），您通常可以重写格式错误的查询（很常见），例如通常可以重写为派生表连接的深度相关子查询稍加思考。否则，您可以选择创建覆盖非聚集索引并确保统计信息保持最新。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T01:17:27.840

如果不知道您在谈论哪个系统，这很难回答。

例如，在 Oracle 中，企业管理器可以让您查看哪些查询占用的时间最多，让您比较不同的执行配置文件，并让您分析一段时间内的查询，这样您就不会添加有用的索引一个查询以您运行的所有其他查询为代价。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T01:20:29.843

1.  对于 MySQL，有一个称为[日志慢查询的功能](http://dev.mysql.com/doc/refman/5.0/en/slow-query-log.html)

其余的取决于您拥有的数据类型及其设置方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T01:48:24.067

在 SQL Server 中，您可以使用跟踪来了解查询的执行情况。使用 ctrl + k 或 l

例如，如果您看到在具有大量记录的表中发生全表扫描，那么它可能不是一个好的查询。

一个更具体的问题肯定会给你更好的答案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T01:50:43.640

如果您的表主要被读取，请在表上放置一个聚集索引。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T01:53:41.043

我的经验主要是早期的 DB2 和少量的 Oracle。

如果您的 DBMS 有任何好处，它将能够收集特定查询的统计信息并解释它用于提取数据的计划。

例如，如果您有一个包含两列（日期和磁盘使用）的表 (x)，并且只有一个日期索引，则查询：

```
select diskusage from x where date = '2008-01-01' 
```

将非常有效，因为它可以使用索引。另一方面，查询

```
select date from x where diskusage > 90 
```

不会那么高效。在前一种情况下，“解释计划”会告诉您它可以使用索引。在后者中，它会说它必须进行表扫描才能获取行（这基本上是查看每一行以查看它是否匹配）。

真正智能的 DBMS 还可以解释您应该如何提高性能（在这种情况下，在磁盘使用情况上添加索引）。

至于如何查看正在运行的查询，您可以从 DBMS 收集（如果允许的话）或强制每个人通过存储过程进行查询，以便 DBA 控制查询是什么 - 这是他们的工作，保持数据库高效运行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T11:57:38.943

PK 和 FK 上的索引以及总是有助于分区的一件事......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-27T05:41:24.300

**1.您使用什么模式来确定频繁查询？**

取决于您处理数据库的级别。如果您是 DBA 或有权使用这些工具，那么像 Oracle 之类的数据库允许您在指定的时间段内运行作业并生成统计信息/报告。如果您是针对数据库编写应用程序的开发人员，您可以在您的应用程序中进行性能分析。

**2.如何选择优化因子？**

我尝试大致了解该表的使用方式及其包含的数据。我会回答以下问题。

它会被大量更新吗？更新发生在哪些领域？它有低基数的列吗？

值得索引吗？（如果通过索引访问非常小的表可能会减慢速度）

让它运行得更快值得多少维护/头痛？

更新/插入与查询的比率？

等等

**3\. 可以进行哪些类型的更改？**

-- 如果使用 Oracle，请保持最新的统计信息！=)

-- Normalization/De-Normalization 中的任何一个都可以根据表的使用情况来提高性能。我几乎总是规范化，然后只有当我无法以其他实际方式使查询更快时才会去规范化。对查询进行非规范化以及在您的情况允许时保持真实表规范化并创建具有物化视图的非规范化“表”的好方法。

——明智地索引。太多可能在许多层面上都不好。只要您不经常更新列并且该列的基数较低，位图索引在 Oracle 中就很棒。

-- 使用索引组织的表格。

-- 分区和子分区表和索引

-- 使用存储过程来减少应用程序的往返行程，提高安全性，并在不影响用户的情况下启用查询优化。

-- 如果合适，将表固定在内存中（访问很多且相当小）

-- 索引和表数据库文件之间的设备分区。

.....名单还在继续。=)

希望这对你有帮助。

# ruby - 列出 Ruby 中模块声明的所有类型

> ID：137227
> 
> 赞同：18
> 
> 时间：2008-09-26T01:13:08.490
> 
> 标签：ruby

如何列出 Ruby 中模块声明的所有类型？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-26T01:48:54.660

使用*Module模块中定义的**常量*方法。来自 Ruby 文档：

 *> Module.constants => 数组
> 
> 返回系统中定义的所有常量名称的数组。此列表包括所有模块和类的名称。
> 
> p Module.constants.sort[1..5]
> 
> 产生：
> 
> [“ARGV”、“ArgumentError”、“数组”、“Bignum”、“绑定”]

您可以在任何您想要的模块或类上调用*常量。*

```
p Class.constants 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T01:55:28.107

不确定这是否是您的意思，但是您可以通过执行获取模块中定义的所有常量和类的名称数组

> > > ModuleName.constants

# msbuild - MSBuild 不获取被引用项目的引用

> ID：137229
> 
> 赞同：14
> 
> 时间：2008-09-26T01:14:28.143
> 
> 标签：msbuild, build-automation, dependencies

我刚才在使用 MSBuild 时遇到了一个奇怪的情况。有一个解决方案包含三个项目：LibX、LibY 和 Exe。Exe 引用了 LibX。LibX 又引用了 LibY，有一些内容文件，还引用了第三方库（安装在 GAC 和本地 lib 文件夹中的几个预构建程序集）。第三方库被标记为“复制本地”（“私有”）并出现在 LibX 项目的输出中，就像 LibY 的输出和 LibX 的内容文件一样。现在，Exe 项目的输出有 LibX 项目输出、LibX 项目的内容文件、LibY 项目输出（来自 LibX），但没有第三方库的程序集。

现在我通过直接在 Exe 项目中引用第三方库来解决这个问题，但我觉得这不是一个“正确”的解决方案。

以前有人遇到过这个问题吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-02-17T12:02:20.310

与使用 Visual Studio 构建相比，使用 MSBuild（即命令行、TFS Build 和其他工具）构建时的行为有所不同。辅助引用不包含在发送到 MSBuild 编译任务的引用变量中。

MSBuild 提供了几个扩展点来更改解析引用的方式。我已经成功地使用 AfterResolveReference 为我的一些项目解决了这个问题 -[我已经在我的博客上发布了有关背景的更多信息](http://www.nsilverbullet.net/2012/02/17/automatically-resolving-secondary-assembly-references-with-msbuild-and-tfs-build/)。

解决方法是将以下代码添加到您的 vbproj 或 csproj 文件中

```
 <Target Name="AfterResolveReferences">
    <!-- Redefine referencepath to add dependencyies-->
    <ItemGroup>
     <ReferencePath Include="@(ReferenceDependencyPaths)">
     </ReferencePath>
    </ItemGroup> 
  </Target> 
```

微软表示，这不会在[Connect上修复](http://connect.microsoft.com/VisualStudio/feedback/details/367782/bug-msbuild-references)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T20:27:57.857

您实际上可以进入 Microsoft.CSharp.targets 或 Microsoft.VisualBasic.targets 文件（位于框架目录中，通常为 C:\Windows\Microsoft.NET\Framework\v3.5）并将 csc 或 vbc 任务参数修改为包括额外的参考依赖。在文件中（VB 目标，第 166 行；C# 目标，第 164 行）更改：\

```
References="@(ReferencePath)" 
```

到

```
References="@(ReferencePath);@(ReferenceDependencyPaths)" 
```

这可能会导致其他问题，具体取决于事情的复杂程度，并且它可能会在 Visual Studio inproc 编译器中发挥作用，但这是我在 MSBuild 中发现的唯一方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-02-01T22:40:57.950

josant的回答几乎对我有用；当我尝试这样做时，我在 Visual Studio 中不断收到错误：

**尝试为 IDE 的进程内编译器设置“References”参数时出现问题。对 COM 组件的调用已返回错误 HRESULT E_FAIL**

我的问题的解决方案是在 ItemGroup 上设置一个条件，如下所示：

```
<Target Name="AfterResolveReferences">
  <!-- Redefine referencepath to add dependencies-->
  <ItemGroup Condition=" '$(BuildingInsideVisualStudio)' != 'true' ">
    <ReferencePath Include="@(ReferenceDependencyPaths)"></ReferencePath>
  </ItemGroup>
</Target> 
```

这导致 Visual Studio 完全忽略引用更改，并且构建在本地和构建服务器上都可以正常工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T15:28:46.923

是的，我也遇到过这个问题。虽然我很想说别的，但我相信您必须在构建文件中包含所有传递依赖项作为引用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-02T06:54:36.213

我已经将 Alex Yakunin 的[解决方案](https://stackoverflow.com/questions/1425359/how-to-make-msbuild-to-automatically-copy-all-indirect-references-to-output-bin/1431527#1431527)与一个也[可以复制本机 dll 的](https://stackoverflow.com/questions/4625129/linkresource-in-visual-studio-2010/5854230#5854230).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-16T18:38:56.913

如果您有一个有向图而不是具有“尝试部署 dll 的不同副本”错误的树，那么 AfterResolveReferences 方法将失败。（参见[如何配置 msbuild/MSVC 部署依赖程序集的依赖文件](https://stackoverflow.com/questions/9742746/how-to-configure-msbuild-msvc-to-deploy-dependent-files-of-dependent-assemblies)）

# lazy-registration - Web 上的延迟注册：最佳实践

> ID：137239
> 
> 赞同：5
> 
> 时间：2008-09-26T01:20:06.523
> 
> 标签：lazy-registration

我首先在[Ajax Patterns网站上遇到了](http://ajaxpatterns.org/Main_Page)[延迟注册](http://ajaxpatterns.org/Lazy_Registration)的概念，他们将其定义为“在用户交互时累积有关用户的信息，稍后再进行正式注册”。我正在考虑为我的网站做类似的事情，但我想在开始实施之前了解更多关于最佳实践的信息。我的网站是关于 Web 开发的，但一般的最佳实践也很棒。您是如何在您的网站或项目上实施延迟注册的？你在哪里见过它？你喜欢或不喜欢它什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T08:45:58.853

看看这个视频，对惰性注册模式的一个很好的概述： [http ://www.90percentofeverything.com/2009/03/16/signup-forms-must-die-heres-how-we-killed-ours /](http://www.90percentofeverything.com/2009/03/16/signup-forms-must-die-heres-how-we-killed-ours/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T01:24:07.433

我说这不是作为以前设计过这样一个网站的人，而是作为一个可能访问该网站的人。:)

话虽如此，我最关心的是知道正在收集哪些关于我的信息。我认为应该有一个选项可以选择不收集信息，而是在正式注册期间全部输入。

但除此之外，如果它使注册网站更容易，我会全力以赴。我留下了 10 个需要我注册才能做事的网站中的 9 个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T01:35:25.160

我正在考虑实现这一点的一种方式是当用户留下博客评论时。一种常见的 Wordpress 格式是允许网站访问者发表评论，只要他们留下姓名和电子邮件地址。如果我遵循类似的模式，然后在他们提交评论后，询问他们是否还想通过在此处输入用户名和密码进行注册，并在电子邮件地址输入中预先填写他们的电子邮件。还会有一条消息说，如果他们当时选择不注册，他们的电子邮件地址将不会被保存（与博客评论相关联的除外）。如果您想到要添加的内容，请发表评论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T18:37:53.813

使用 OpenID。

当我必须一遍又一遍地输入相同的数据并考虑新密码时，我讨厌它，因为您（阅读：网站）可能将它们存储为纯文本。

哦，请不要要求我给你一封假电子邮件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-03T21:36:44.910

喜欢这种方式 www.soup.io/signup 或电子邮件方式 www.posterous.com 或 www.tripit.com

# java - Hudson 运行的代码在命令行上找不到可执行文件

> ID：137243
> 
> 赞同：2
> 
> 时间：2008-09-26T01:22:45.050
> 
> 标签：java, hudson, runtime.exec

我正在哈德逊建立我的第一份工作，我遇到了一些问题。该作业监控两个存储库，一个包含我们的数据库设置文件，另一个包含一些验证和测试数据库设置文件的代码。

运行的部分代码将使用 psql 命令行工具，使用 Runtime.exec() 在 PostgreSQL 中抛出经过验证的设置文件。此代码在我的机器上完美运行，但是当 Hudson 执行它（不同的机器）时，我收到以下错误：

```
java.io.IOException: Cannot run program "psql": CreateProcess error=2, 系统找不到指定的文件
```

psql.exe 在路径上，我可以通过在命令行中键入整个内容来执行它，从 Hudson 执行代码的同一个地方开始。要传递给 psql 的文件存在。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T01:30:07.917

我发现当你启动 hudson 或 slave 时，你需要将程序放在路径中。尽管有能力在哈德森设置路径，但它似乎不起作用。您也可以将完整路径放在命令中，无论如何从安全角度来看，这确实是一个好主意。

# security - 是否可以冒充用户而不登录？

> ID：137254
> 
> 赞同：8
> 
> 时间：2008-09-26T01:28:21.400
> 
> 标签：security, winapi, visual-c++, impersonation

是否可以在不提供用户名/密码的情况下模拟用户？基本上，我想`CSIDL_LOCAL_APPDATA`使用该功能为用户（不是当前用户）获取`ShGetFolderPath()`。我目前拥有的只是该用户的 SID。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-12T01:45:05.693

您可以通过调用 ZwCreateToken 在不提供密码的情况下模拟用户。请参阅本文中的 CreatePureUserToken 函数： [基于 GUI 的 RunAsEx](http://www.codeproject.com/KB/system/RunUser.aspx "基于 GUI 的 RunAsEx") 您必须以管理员（或 LocalSystem）身份运行才能使其工作。

另一种技术是使用 Windows 子身份验证包。这允许您覆盖 Windows 内置身份验证并允许 LogonUser 成功，即使没有提供密码。请参阅此[知识库文章](http://support.microsoft.com/kb/216828 "知识库文章")。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T01:30:39.197

不，您必须调用 Win32 API **LogonUser**函数来获取 Windows 帐户令牌，以便您可以模拟。

# c# - 如何确定远程驱动器是否有足够的空间来使用 C# 写入文件？

> ID：137255
> 
> 赞同：5
> 
> 时间：2008-09-26T01:28:23.553
> 
> 标签：c#, .net, networking, filesystems

如何确定远程驱动器是否有足够的空间让我在 .Net 中使用 C# 上传给定文件？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T02:02:09.993

有两种可能的解决方案。

1.  调用 Win32 函数 GetDiskFreeSpaceEx。这是一个示例程序：

    ```
    internal static class Win32
    {
        [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        internal static extern bool GetDiskFreeSpaceEx(string drive, out long freeBytesForUser, out long totalBytes, out long freeBytes);

    }

    class Program
    {
        static void Main(string[] args)
        {
            long freeBytesForUser;
            long totalBytes;
            long freeBytes;

            if (Win32.GetDiskFreeSpaceEx(@"\\prime\cargohold", out freeBytesForUser, out totalBytes, out freeBytes)) {
                Console.WriteLine(freeBytesForUser);
                Console.WriteLine(totalBytes);
                Console.WriteLine(freeBytes);
            }
        }
    } 
    ```

2.  使用系统管理界面。这篇文章中有另一个答案描述了这一点。此方法实际上是为在 PowerShell 等脚本语言中使用而设计的。为了得到正确的对象，它执行了很多绒毛。最终，我怀疑这种方法归结为调用 GetDiskFreeSpaceEx。

任何使用 C# 进行任何严肃的 Windows 开发的人最终都可能会调用许多 Win32 函数。.NET 框架并没有 100% 覆盖 Win32 API。任何大型程序都会很快发现 .NET 库中的空白，这些空白只能通过 Win32 API 获得。我会得到一个 .NET 的 Win32 包装器，并将其包含在您的项目中。这将使您可以即时访问几乎所有 Win32 API。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T02:06:56.050

使用 WMI

```
using System.Management;

// Get all the network drives (drivetype=4)
SelectQuery query = new SelectQuery("select Name, VolumeName, FreeSpace from win32_logicaldisk where drivetype=4");
ManagementObjectSearcher searcher = new ManagementObjectSearcher(query);
foreach (ManagementObject drive in searcher.Get())
{
    string Name = (string)drive["Name"];
    string VolumeName = (string)drive["VolumeName"];
    UInt64 freeSpace = (UInt64)drive["FreeSpace"];
} 
```

基于（窃取自）[http://www.dreamincode.net/code/snippet1576.htm](http://www.dreamincode.net/code/snippet1576.htm)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T01:42:10.963

您是在谈论将网络共享映射到计算机上的逻辑驱动器吗？

如果是这样，您可以使用 DriveInfo。

```
    DriveInfo info = new DriveInfo("X:");

    info.AvailableFreeSpace;

```

DriveInfo 仅适用于逻辑驱动器，因此如果您仅使用完整共享 (UNC) 名称，我认为上述代码不会起作用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T02:02:27.467

我不确定 GetDiskFreeSpaceEx 是否适用于 UNC 共享，但如果它确实使用它，那么这里是如何将 UNC 共享安装到 logal 驱动器：

**编辑**GetDiskFreeSpaceEx 确实适用于 UNC 共享，使用它......但是，这个代码太费力了，无法删除，如果您想在代码中将 UNC 共享挂载为本地驱动器，它会很方便。

```
public class DriveWrapper
{                    
    [StructLayout(LayoutKind.Sequential)]
    public struct NETRESOURCEA
    {
        public int dwScope;
        public int dwType;
        public int dwDisplayType;
        public int dwUsage;
        [MarshalAs(UnmanagedType.LPStr)]
        public string lpLocalName;
        [MarshalAs(UnmanagedType.LPStr)]
        public string lpRemoteName;
        [MarshalAs(UnmanagedType.LPStr)]
        public string lpComment;
        [MarshalAs(UnmanagedType.LPStr)]
        public string lpProvider;
        public override String ToString()
        {
            String str = "LocalName: " + lpLocalName + " RemoteName: " + lpRemoteName
                  + " Comment: " + lpComment + " lpProvider: " + lpProvider;
            return (str);
        }
    }

    [DllImport("mpr.dll")]
    public static extern int WNetAddConnection2A(
          [MarshalAs(UnmanagedType.LPArray)] NETRESOURCEA[] lpNetResource,
          [MarshalAs(UnmanagedType.LPStr)] string lpPassword,
          [MarshalAs(UnmanagedType.LPStr)] string UserName,
          int dwFlags);       
    [DllImport("mpr.dll", CharSet = System.Runtime.InteropServices.CharSet.Auto)]
    private static extern int WNetCancelConnection2A(
          [MarshalAs(UnmanagedType.LPStr)]
        string lpName,
          int dwFlags,
          int fForce
          );

    public int GetDriveSpace(string shareName, string userName, string password)
    {
        NETRESOURCEA[] n = new NETRESOURCEA[1];
        n[0] = new NETRESOURCEA();

        n[0].dwScope = 0;
        n[0].dwType = 0;
        n[0].dwDisplayType = 0;
        n[0].dwUsage = 0;

        n[0].dwType = 1;

        n[0].lpLocalName = "x:";
        n[0].lpRemoteName = shareName;
        n[0].lpProvider = null;

        int res = WNetAddConnection2A(n, userName, password, 1);

        DriveInfo info = new DriveInfo("x:");
        int space = info.AvailableFreeSpace;

        int err = 0;
        err = WNetCancelConnection2A("x:", 0, 1);

        return space;
    }
} 
```

# c++ - std::map 迭代 - 调试和发布版本之间的顺序差异

> ID：137258
> 
> 赞同：4
> 
> 时间：2008-09-26T01:29:20.540
> 
> 标签：c++, stl

这是我必须使用的常见代码模式：

```
class foo {
public:
    void InitMap();
    void InvokeMethodsInMap();
    static void abcMethod();
    static void defMethod();
private:
    typedef std::map<const char*, pMethod> TMyMap;
    TMyMap m_MyMap;
}

void
foo::InitMap()
{
    m_MyMap["abc"] = &foo::abcMethod;
    m_MyMap["def"] = &foo::defMethod;
}

void
foo::InvokeMethodsInMap()
{
    for (TMyMap::const_iterator it = m_MyMap.begin();
        it != m_MyMap.end(); it++)
    {
        (*it->second)(it->first);
    }
} 
```

但是，我发现处理映射的*顺序*（在 for 循环中）可能会因构建配置是 Release 还是 Debug 而有所不同。似乎发布版本中发生的编译器优化会影响此顺序。

我认为通过`begin()`在上面的循环中使用，并在每次方法调用后递增迭代器，它将按初始化顺序处理映射。但是，我还记得读过地图是作为哈希表实现的，并且无法保证顺序。

这特别烦人，因为大多数单元测试都是在 Debug 构建上运行的，并且通常在外部 QA 团队开始测试之前不会发现奇怪的顺序依赖错误（因为他们使用的是 Release 构建）。

谁能解释这种奇怪的行为？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-26T01:30:41.910

不要`const char*`用作地图的键。这意味着映射是按字符串的地址排序的，而不是字符串的内容。改为使用 a`std::string`作为键类型。

`std::map`不是哈希表，它通常实现为红黑树，并且保证元素按某些标准排序（默认情况下，`<`键之间的比较）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-26T02:49:49.037

map的定义是：
**map<Key, Data, Compare, Alloc>**

最后两个模板参数也是默认的：
比较：less<Key>
Alloc：allocator<value_type>

将新值插入地图时。新值（valueToInsert）按顺序与旧值进行比较（**注意**这不是顺序搜索，标准保证最大插入复杂度为 O(log(N))），直到 Compare(value,ValueToInsert) 返回 true。因为您使用***'const char*'***作为键。比较对象正在使用***less<const char*>***此类只是对两个值执行 <。因此，实际上您是在比较指针值（而不是字符串），因此顺序是随机的（因为您不知道编译器会将字符串放在哪里。

有两种可能的解决方案：

*   更改键的类型，以便它比较字符串值。
*   定义另一个满足您需要的比较类型。

我个人（如 Chris）只会使用 std::string 因为字符串上使用的 < 运算符会返回基于字符串内容的比较。但是为了争论，我们可以只定义一个比较类型。

```
struct StringLess
{
    bool operator()(const char* const& left,const char* const& right) const
    {
        return strcmp(left,right) < 0;
    }
};

///

typedef std::map<const char*, int,StringLess> TMyMap; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T02:56:09.567

如果你想使用 const char * 作为你的地图的键，还要设置一个键比较函数，使用 strcmp （或类似的）来比较键。这样，您的地图将按字符串的内容排序，而不是按字符串的指针值（即内存中的位置）。

# c# - 将方法设为虚拟有什么危险？

> ID：137260
> 
> 赞同：8
> 
> 时间：2008-09-26T01:29:39.027
> 
> 标签：c#, unit-testing, mocking, virtual-functions

我一直在用 RhinoMocks 进行一些模拟，它要求将模拟的方法设为虚拟。这很好，除非我们有一个自定义框架，其中包含我要模拟的方法，这些方法当前未标记为虚拟。

我无法预见将这些方法设为虚拟会有任何问题，但我想知道将方法设为虚拟有哪些潜在危险需要注意？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T01:51:04.123

实际上，如果该方法没有被设计为被覆盖并且有人覆盖它，那么它可能会非常有问题。特别是，永远不要从构造函数中调用虚方法。考虑：

```
class Base {
    public Base() {
       InitializeComponent();
    }
    protected virtual void InitializeComponent() {
        ...
    }
}

class Derived : Base {
    private Button button1;
    public Derived() : base() {
        button1 = new Button();
    }
    protected override void InitializeComponent() {
        button1.Text = "I'm gonna throw a null reference exception"
    }
} 
```

Derived 类可能不知道虚方法调用将导致其 InitializeComponent 方法在其自己的构造函数的单行运行之前被调用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T01:33:09.720

*   如果您的用户覆盖了您的虚拟方法，您将无法在不破坏代码的情况下再次密封它们。
*   您从构造函数调用的任何虚拟方法都可能归结为派生实现，如果它们不调用基方法并且构造函数依赖于它，则对象可能处于无效状态

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T01:35:57.530

Ayende 对虚拟方法的工作方式有很好的处理：

[http://ayende.com/Blog/archive/2007/01/05/HowVirtualMethodsWork.aspx](http://ayende.com/Blog/archive/2007/01/05/HowVirtualMethodsWork.aspx)

# gentoo - 在 Gentoo 中独立运行 Apache Archiva？

> ID：137267
> 
> 赞同：4
> 
> 时间：2008-09-26T01:31:10.800
> 
> 标签：gentoo, archiva, init.d

我有一台运行 Gentoo 2.6.12 r6 的服务器，我想在启动时将 Apache Archiva 作为独立服务器运行。有没有人有一个有效的 init.d 脚本来完成这个？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T02:09:26.670

假设您创建了一个名为的用户帐户`archiva`，并且 Archiva 安装在`/opt/archiva-1.0`.

登录为时，按如下方式`root`创建脚本：`/etc/rc.d/init.d/archiva`

```
\#! /bin/sh

开始（） {
    echo "正在启动 Archiva..."
    su -l archiva -c '/opt/archiva-1.0/bin/archiva 开始 > /dev/null 2> /dev/null &'
}

停止（） {
    echo "停止存档..."
    su -l archiva -c '/opt/archiva-1.0/bin/archiva stop &'
}

重新开始（） {
    停止
    睡觉 60
    su -l archiva -c 'killall java'
    开始
}

案例“$1”在
    开始）
        开始
        ;;
    停止）
        停止
        ;;
    重新开始）
        重新开始
        ;;
    *)
        echo "用法：archiva {start|stop|restart}"
        1号出口

经社理事会

出口 0

```

现在以 root 身份执行以下命令，其中 SXX 和 KXX 指定启动和关闭顺序。例如 S63 和 K37

```
$ chmod 775 /etc/rc.d/init.d/archiva
$ ln -s /etc/rc.d/init.d/archiva /etc/rc3.d/SXXarchiva
$ ln -s /etc/rc.d/init.d/archiva /etc/rc3.d/KXXarchiva

```

# c++ - 使用多重继承时如何避免死亡钻石？

> ID：137282
> 
> 赞同：65
> 
> 时间：2008-09-26T01:36:14.440
> 
> 标签：c++, multiple-inheritance

[http://en.wikipedia.org/wiki/Diamond_problem](http://en.wikipedia.org/wiki/Diamond_problem)

我知道这意味着什么，但我可以采取哪些措施来避免它？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-09-26T12:57:52.653

一个实际的例子：

```
class A {};
class B : public A {};
class C : public A {};
class D : public B, public C {}; 
```

注意 D 类是如何从 B 和 C 继承的。但是 B 和 C 都从 A 继承。这将导致类 A 的 2 个副本包含在 vtable 中。

为了解决这个问题，我们需要虚拟继承。需要虚拟继承的是 A 类。因此，这将解决问题：

```
class A {};
class B : virtual public A {};
class C : virtual public A {};
class D : public B, public C {}; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-26T01:39:24.183

虚拟继承。这就是它的用途。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-26T01:49:50.880

我会坚持只使用接口的多重继承。虽然类的多重继承有时很有吸引力，但如果您经常依赖它，它也会令人困惑和痛苦。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-27T06:09:02.643

传承是一种强大的、强大的武器。仅在您真正需要时才使用它。过去，钻石继承是我在分类方面走得很远的标志，说用户是“员工”，但他们也是“小部件侦听器”，但也是...

在这些情况下，很容易遇到多重继承问题。

我通过使用组合和指向所有者的指针来解决它们：

前：

```
class Employee : public WidgetListener, public LectureAttendee
{
public:
     Employee(int x, int y)
         WidgetListener(x), LectureAttendee(y)
     {}
}; 
```

后：

```
class Employee
{
public:
     Employee(int x, int y)
         : listener(this, x), attendee(this, y)
     {}

     WidgetListener listener;
     LectureAttendee attendee;
}; 
```

是的，访问权限是不同的，但是如果您可以采用这种方法而无需复制代码，那就更好了，因为它的功能不那么强大。（当你别无选择时，你可以节省电力。）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-07-15T19:07:43.273

```
class A {}; 
class B : public A {}; 
class C : public A {}; 
class D : public B, public C {}; 
```

在这种情况下，A 类的属性在 D 类中重复了两次，这会增加内存使用量……因此，为了节省内存，我们为 A 类的所有继承属性创建了一个虚拟属性，这些属性存储在 Vtable 中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T02:01:42.787

好吧，可怕的钻石的伟大之处在于它发生时是一个错误。最好的避免方法是事先弄清楚你的继承结构。例如，我从事的一个项目有查看器和编辑器。Editors 是 Viewer 的逻辑子类，但由于所有 Viewer 都是子类 - TextViewer、ImageViewer 等，Editor 不是从 Viewer 派生的，因此允许最终的 TextEditor、ImageEditor 类避免菱形。

在无法避免菱形的情况下，使用虚拟继承。然而，对于虚拟基，最大的警告是虚拟基的构造函数*必须*由派生最多的类调用，这意味着虚拟派生的类无法控制构造函数参数。此外，虚拟基地的存在往往会在通过链条施放时导致性能/空间损失，尽管我不认为除了第一个之外会有太多的损失。

另外，如果您明确说明要使用哪个底座，则始终可以使用菱形。有时这是唯一的方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T12:50:37.973

我会建议一个更好的类设计。我确信通过多重继承可以最好地解决一些问题，但首先检查是否有其他方法。

如果没有，请使用虚拟功能/接口。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-02-11T23:24:59.943

通过委托使用继承。然后两个类都将指向一个基 A，但必须实现重定向到 A 的方法。它具有将 A 的受保护成员转换为 B、C 和 D 中的“私有”成员的副作用，但现在你不需要需要虚拟，而你没有钻石。

# .net - 阅读 GetResponseStream() 的最佳方法是什么？

> ID：137285
> 
> 赞同：28
> 
> 时间：2008-09-26T01:37:26.730
> 
> 标签：.net, http, stream, getresponsestream

从 GetResponseStream 读取 HTTP 响应的最佳方法是什么？

目前我正在使用以下方法。

```
Using SReader As StreamReader = New StreamReader(HttpRes.GetResponseStream)
   SourceCode = SReader.ReadToEnd()
End Using 
```

我不太确定这是否是读取 http 响应的最有效方式。

我需要将输出作为字符串，我看过[一篇](http://www.informit.com/guides/content.aspx?g=dotnet&seqNum=583)采用不同方法的文章，但我不太确定它是否是一个好文章。在我的测试中，这些代码在不同的网站上存在一些编码问题。

您如何阅读网络回复？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-05-31T17:48:33.317

我对字符串执行此操作的简单方法。注意构造函数的`true`第二个参数`StreamReader`。这告诉它从字节顺序标记中检测编码，并且可能有助于解决您遇到的编码问题。

```
string target = string.Empty;
HttpWebRequest httpWebRequest = (HttpWebRequest)WebRequest.Create("http://www.informit.com/guides/content.aspx?g=dotnet&seqNum=583");

HttpWebResponse response = (HttpWebResponse)httpWebRequest.GetResponse();
try
{
  StreamReader streamReader = new StreamReader(response.GetResponseStream(),true);                
  try
  {
    target = streamReader.ReadToEnd();
  }
  finally
  {
    streamReader.Close();
  }
}
finally
{
  response.Close();
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-26T01:43:45.763

我使用这样的东西从 URL 下载文件：

```
if (!Directory.Exists(localFolder))
{
    Directory.CreateDirectory(localFolder);   
}

try
{
    HttpWebRequest httpRequest = (HttpWebRequest)WebRequest.Create(Path.Combine(uri, filename));
    httpRequest.Method = "GET";

    // if the URI doesn't exist, an exception will be thrown here...
    using (HttpWebResponse httpResponse = (HttpWebResponse)httpRequest.GetResponse())
    {
        using (Stream responseStream = httpResponse.GetResponseStream())
        {
            using (FileStream localFileStream = 
                new FileStream(Path.Combine(localFolder, filename), FileMode.Create))
            {
                var buffer = new byte[4096];
                long totalBytesRead = 0;
                int bytesRead;

                while ((bytesRead = responseStream.Read(buffer, 0, buffer.Length)) > 0)
                {
                    totalBytesRead += bytesRead;
                    localFileStream.Write(buffer, 0, bytesRead);
                }
            }
        }
    }
}
catch (Exception ex)
{
    // You might want to handle some specific errors : Just pass on up for now...
    // Remove this catch if you don't want to handle errors here.
    throw;
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-05-10T21:50:49.600

也许您可以查看[WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient(VS.80).aspx)类。这是一个例子：

```
using System.Net;

namespace WebClientExample
{
    class Program
    {
        static void Main(string[] args)
        {
            var remoteUri = "http://www.contoso.com/library/homepage/images/";
            var fileName = "ms-banner.gif";
            WebClient myWebClient = new WebClient();
            myWebClient.DownloadFile(remoteUri + fileName, fileName);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-05-10T06:52:16.250

在powershell中，我有这个功能：

```
function GetWebPage
{param ($Url, $Outfile)
    $request = [System.Net.HttpWebRequest]::Create($SearchBoxBuilderURL)
    $request.AuthenticationLevel = "None"
    $request.TimeOut = 600000     #10 mins 
    $response = $request.GetResponse() #Appending "|Out-Host" anulls the variable
    Write-Host "Response Status Code: "$response.StatusCode
    Write-Host "Response Status Description: "$response.StatusDescription
    $requestStream = $response.GetResponseStream()
    $readStream = new-object System.IO.StreamReader $requestStream
    new-variable db | Out-Host
    $db = $readStream.ReadToEnd()
    $readStream.Close()
    $response.Close()
    #Create a new file and write the web output to a file
    $sw = new-object system.IO.StreamWriter($Outfile)
    $sw.writeline($db) | Out-Host
    $sw.close() | Out-Host
} 
```

我这样称呼它：

```
$SearchBoxBuilderURL = $SiteUrl + "nin_searchbox/DailySearchBoxBuilder.asp"
$SearchBoxBuilderOutput="D:\ecom\tmp\ss2.txt"
GetWebPage $SearchBoxBuilderURL $SearchBoxBuilderOutput 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-02T10:10:04.037

You forgot to define "buffer" and "totalBytesRead":

```
using ( FileStream localFileStream = ....  
{  
    byte[] buffer = new byte[ 255 ];  
    int bytesRead;  
    double totalBytesRead = 0;  

    while ((bytesRead = .... 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-05-15T14:14:50.257

我遇到了类似的情况：

我试图使用 BasicHTTPBinding 在使用 SOAP 服务的 HTTP 错误的情况下读取原始响应。

但是，当使用 读取响应时`GetResponseStream()`，出现错误：

> 流不可读

所以，这段代码对我有用：

```
try
{
    response = basicHTTPBindingClient.CallOperation(request);
}
catch (ProtocolException exception)
{
    var webException = exception.InnerException as WebException;

    var alreadyClosedStream = webException.Response.GetResponseStream() as MemoryStream;
    using (var brandNewStream = new MemoryStream(alreadyClosedStream.ToArray()))
    using (var reader = new StreamReader(brandNewStream))
        rawResponse = reader.ReadToEnd();
} 
```

# asp.net - 在 ASP.Net 2.0 应用程序中检查用户会话状态的状态和大小的最佳工具是什么

> ID：137305
> 
> 赞同：4
> 
> 时间：2008-09-26T01:45:40.750
> 
> 标签：asp.net, session, asp.net-2.0

我们想在遗留 Web 应用程序的流程中检查用户会话状态和预定义点的状态。我们想查看当前存在哪些对象以及总大小。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T01:46:53.040

您可以监视一些[asp.net 会话性能计数器](http://msdn.microsoft.com/en-us/library/fxk122b4.aspx)

# perl - 如何截断 STDIN 行长度？

> ID：137313
> 
> 赞同：7
> 
> 时间：2008-09-26T01:49:02.317
> 
> 标签：perl, cut, truncate

我一直在解析一些日志文件，发现有些行太长而无法在一行上显示，因此 Terminal.app 将它们包装到下一行。但是，我一直在寻找一种在一定数量的字符后截断一行的方法，这样终端就不会换行，从而更容易发现模式。

为此，我编写了一个小的 Perl 脚本：

```
#!/usr/bin/perl

die("need max length\n") unless $#ARGV == 0;

while (<STDIN>)
{
    $_ = substr($_, 0, $ARGV[0]);
    chomp($_);
    print "$_\n";
} 
```

但我有一种感觉，这个功能可能内置在其他一些工具（sed？）中，我只是不太了解用于这项任务。

所以我的问题是一个相反的问题：如何在不编写程序的情况下截断一行标准输入？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T01:50:59.757

管道输出到：

```
cut -b 1-LIMIT 
```

其中 LIMIT 是所需的线宽。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T01:53:20.887

我用于查看具有很长行的日志文件的另一种策略是将文件通过管道传输到“less -S”。less 的 -S 选项将打印不换行的行，您可以通过按右箭头键查看长行的隐藏部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T03:42:37.427

不完全回答这个问题，但如果你想坚持使用 Perl 并使用单线，一种可能性是：

```
$ perl -pe's/(?<=.{25}).*//' filename 
```

其中 25 是所需的行长。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T07:46:29.790

通常的方法是

```
perl -wlne'print substr($_,0,80)' 
```

打高尔夫球（5.10）：

```
perl -nE'say/(.{0,80})/' 
```

（不要将其视为编程，将其视为使用具有大量选项的命令行工具。）（是的，[python](http://www.serve.com/bonzai/monty/classics/TheKnightsWhoSayNi)参考是故意的。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T18:24:00.637

一个 Korn shell 解决方案（截断为 70 个字符 - 不过易于参数化）：

```
typeset -L70 line
while read line
do
  print $line
done 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T21:29:46.667

您可以使用绑定变量将其内容剪辑为固定长度：

```
#! /usr/bin/perl -w

use strict;
use warnings
use String::FixedLen;

tie my $str, 'String::FixedLen', 4;

while (defined($str = <>)) {
    chomp;
    print "$str\n";
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T21:54:17.810

这并不完全是您所要求的，但是[GNU Screen](http://www.gnu.org/software/screen/)（包括在 OS X 中，如果我没记错的话，并且在其他 *nix 系统上很常见）允许您打开/关闭换行（Ca r 和 Ca Cr）。这样，您可以简单地调整终端的大小，而不是通过脚本来传递内容。

Screen 基本上在一个顶级终端应用程序中为您提供“虚拟”终端。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T14:22:47.183

```
use strict;
use warnings
use String::FixedLen;

tie my $str, 'String::FixedLen', 4;

while (defined($str = <>)) {
    chomp;
    print "$str\n";
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-15T16:17:21.630

除非我忽略了这一点，否则 UNIX 的“折叠”命令就是为了做到这一点而设计的：

```
$ cat file
the quick brown fox jumped over the lazy dog's back

$ fold -w20 file
the quick brown fox
jumped over the lazy
 dog's back

$ fold -w10 file
the quick
brown fox
jumped ove
r the lazy
 dog's bac
k

$ fold -s -w10 file
the quick
brown fox
jumped
over the
lazy
dog's back 
```

# php - CakePHP中的三表模型关系

> ID：137314
> 
> 赞同：0
> 
> 时间：2008-09-26T01:49:08.013
> 
> 标签：php, cakephp, cakephp-1.2

我有一个 CAkePHP 1.2 站点。我有三个相关的模型/表格：一个评论只有一个触摸，一个触摸只有一个触摸类型。

在每个模型中，我都有一个属于，所以我有Comments属于Touch，Touch属于Touchtype。

我正在尝试获取包含有关存储在 touchtype 表中的触摸信息的评论列表。

```
$this->Comment->find(...) 
```

我将字段列表传递给 find()。我可以从 Touch 和 Comment 中获取字段，但不能从 TouchType 中获取。模型连接是否只有 1 级？我尝试调整递归，但这没有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T03:00:51.630

呃。这是一个简单的递归问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T05:56:44.627

对。您可能想尝试将 $this->Comment->recursive 增加到 2

# html - 如何在 HTML 页面中嵌入 SWF 文件？

> ID：137326
> 
> 赞同：178
> 
> 时间：2008-09-26T01:52:11.593
> 
> 标签：html, embed, flash

如何在 HTML 页面中嵌入 SWF 文件？

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2008-09-26T02:03:51.753

将 SWF 嵌入 HTML 页面的最佳方法是使用[SWFObject](https://github.com/swfobject/swfobject/)。

它是一个简单的开源 JavaScript 库，易于使用且符合标准的嵌入 Flash 内容的方法。

它还提供 Flash 播放器版本检测。如果用户没有所需的 Flash 版本或禁用了 JavaScript，他们将看到替代内容。您还可以使用此库来触发 Flash 播放器升级。用户升级后，他们将被重定向回页面。

文档中的一个示例：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>SWFObject dynamic embed - step 3</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <script type="text/javascript" src="swfobject.js"></script>

    <script type="text/javascript">
        swfobject.embedSWF("myContent.swf", "myContent", "300", "120", "9.0.0");
    </script>

  </head>
  <body>
    <div id="myContent">
      <p>Alternative content</p>
    </div>
  </body>
</html> 
```

与此一起使用的一个好工具是 SWFObject HTML 和 JavaScript[生成器](https://github.com/swfobject/swfobject/wiki/SWFObject-Generator)。它基本上生成使用 SWFObject 嵌入 Flash 所需的 HTML 和 JavaScript。带有一个非常简单的用户界面供您输入参数。

强烈推荐它并且使用起来非常简单。

* * *

## 回答 #2

> 赞同：129
> 
> 时间：2008-09-26T01:54:27.187

```
<object width="100" height="100">
    <param name="movie" value="file.swf">
    <embed src="file.swf" width="100" height="100">
    </embed>
</object> 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2015-05-22T22:13:49.210

简单的 HTML5 标签嵌入怎么样？

```
<!DOCTYPE html>
<html>
<body>

<embed src="anim.swf">

</body>
</html> 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-10-11T19:57:38.037

这适合从根环境应用。

```
<object type="application/x-shockwave-flash" data="/dir/application.swf" 
id="applicationID" style="margin:0 10px;width:auto;height:auto;">

<param name="movie" value="/dir/application.swf" />
<param name="wmode" value="transparent" /> <!-- Or opaque, etc. -->

<!-- ↓ Required paramter or not, depends on application -->
<param name="FlashVars" value="" />

<param name="quality" value="high" />
<param name="menu" value="false" />

</object> 
```

应该/可以添加其他参数，这取决于它自己的 .swf。**没有 embed**，只有**对象**和参数，因此，它在任何地方都保持有效、工作和可用，无论 !DOCTYPE 是什么都无关紧要。:)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-26T22:13:45.080

如果您使用其中一个 js 库来插入 Flash，我建议在`<noscript/>`.

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-10-11T19:43:34.560

```
<object type="application/x-shockwave-flash" data="http://www.youtube.com/v/VhtIydTmOVU&amp;hl=en&amp;fs=1&amp;color1=0xe1600f&amp;color2=0xfebd01" 
style="width:640px;height:480px;margin:10px 36px;">

<param name="movie" value="http://www.youtube.com/v/VhtIydTmOVU&amp;hl=en&amp;fs=1&amp;color1=0xe1600f&amp;color2=0xfebd01" />
<param name="allowfullscreen" value="true" />
<param name="allowscriptaccess" value="always" />
<param name="wmode" value="opaque" />
<param name="quality" value="high" />
<param name="menu" value="false" />

</object> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T02:08:24.223

我使用[http://wiltgen.net/objecty/](http://wiltgen.net/objecty/)，它有助于嵌入媒体内容并避免 IE 的“点击激活”问题。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T05:34:40.263

如前所述，SWF 对象很棒。[UFO](http://osflash.org/doku.php?id=ufo)也值得一看

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-07-25T14:16:38.013

我相信这个会起作用的！

```
<embed src="application.swf" quality="high" pluginspage="http://www.macromedia.com/go/getfashplayer" type="application/x-shockwave-flash" width="690" height="430"> 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-12-23T23:54:01.553

什么是最好的方法？“最有效”、“最快渲染”等词更具体。无论如何，我提供了一个在大多数情况下对我有帮助的替代答案（是否“最好”是无关紧要的）。

替代答案：使用 iframe。

也就是说，将 SWF 文件托管在服务器上。如果您将 SWF 文件放在根目录或 public_html 文件夹中，则 SWF 文件将位于`www.YourDomain.com/YourFlashFile.swf`.

然后，在您的 index.html 或其他任何地方，将上述位置链接到您的 iframe，无论您放置 iframe，它都会显示在您的内容周围。如果可以在其中放置 iframe，则可以在其中放置 SWF 文件。使 iframe 尺寸与您的 SWF 文件相同。在下面的示例中，SWF 文件为 500 x 500。

伪代码：

```
<iframe src="//www.YourDomain.com/YourFlashFile.swf" width="500" height="500"></iframe> 
```

上面的 HTML 代码行将嵌入您的 SWF 文件。不需要其他混乱。优点：符合 W3C，页面设计友好，没有速度问题，极简主义的方法。
缺点：在浏览器中启动时，SWF 文件周围有空白区域。

那是一个替代答案。是否是“最佳”答案取决于您的项目。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-02-21T16:15:16.100

我知道这是一个老问题。但是这个答案对目前来说是好的。

```
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>histo2</title>
        <style type="text/css" media="screen">
        html, body { height:100%; background-color: #ffff99;}
        body { margin:0; padding:0; overflow:hidden; }
        #flashContent { width:100%; height:100%; }
        </style>
    </head>
    <body>
        <div id="flashContent">
            <object type="application/x-shockwave-flash" data="histo2.swf" width="822" height="550" id="histo2" style="float: none; vertical-align:middle">
                <param name="movie" value="histo2.swf" />
                <param name="quality" value="high" />
                <param name="bgcolor" value="#ffff99" />
                <param name="play" value="true" />
                <param name="loop" value="true" />
                <param name="wmode" value="window" />
                <param name="scale" value="showall" />
                <param name="menu" value="true" />
                <param name="devicefont" value="false" />
                <param name="salign" value="" />
                <param name="allowScriptAccess" value="sameDomain" />
                <a href="http://www.adobe.com/go/getflash">
                    <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
                </a>
            </object>
        </div>
    </body>
</html> 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-01-11T00:10:13.970

Thi 适用于 IE、Edge、Firefox、Safari 和 Chrome。

```
<object type="application/x-shockwave-flash" data="movie.swf" width="720" height="480">
  <param name="movie" value="movie.swf" />
  <param name="quality" value="high" />
  <param name="bgcolor" value="#000000" />
  <param name="play" value="true" />
  <param name="loop" value="true" />
  <param name="wmode" value="window" />
  <param name="scale" value="showall" />
  <param name="menu" value="true" />
  <param name="devicefont" value="false" />
  <param name="salign" value="" />
  <param name="allowScriptAccess" value="sameDomain" />
  <a href="http://www.adobe.com/go/getflash">
    <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
  </a>
</object> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-09-12T10:00:22.200

这对我有用：

```
 <a target="_blank" href="{{ entity.link }}">
        <object type="application/x-shockwave-flash" data="{{ entity.file.path }}?clickTAG={{ entity.link }}" width="120" height="600" style="visibility: visible;">
            <param name="quality" value="high">
            <param name="play" value="true">
            <param name="LOOP" value="false">
            <param name="wmode" value="transparent">
            <param name="allowScriptAccess" value="true">
        </object>
    </a> 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-04-03T21:26:18.317

使用`<embed>`元素：

```
<embed src="file.swf" width="854" height="480"></embed> 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2014-01-12T01:55:24.077

如果您熟悉 JavaScript，则可以使用 JavaScript，如下所示：

```
swfobject.embedSWF("filename.swf", "Title", "width", "height", "9.0.0"); 
```

--9.0.0是flash版本。

或者你可以使用`<object>`HTML5 的标签。

# php - 如何防止在 PHP 中使用不正确的类型？

> ID：137336
> 
> 赞同：3
> 
> 时间：2008-09-26T01:56:33.533
> 
> 标签：php, oop, type-safety

众所周知，PHP 的类型非常松散。该语言不要求您为函数参数或类变量指定任何类型的类型。这可能是一个强大的功能。

但有时，它会使调试脚本成为一种痛苦的体验。例如，将一种对象传递给需要另一种对象的方法会产生错误消息，抱怨传递的对象不存在某个变量/方法。这些情况大多是烦恼。更麻烦的问题是，当您使用错误类的对象初始化一个对象时，该“错误对象”将在稍后的脚本执行中使用。在这种情况下，您最终得到的错误比传递原始参数时要晚得多。

与其抱怨我传递的内容没有特定的方法或变量，或者等到脚本执行的很久以后才能使用我传递的对象，***我更愿意在我指定对象的确切位置收到一条错误消息类型错误，抱怨对象的类型不正确或不兼容。***

您如何在代码中处理这些情况？你如何检测不兼容的类型？如何在我的脚本中引入一些类型检查，以便获得更容易理解的错误消息？

另外，在考虑到 PHP 中的继承时，你怎么能做到这一切呢？考虑：

```
<?php
class InterfaceClass
{
#...
}

class UsesInterfaceClass
{
   function SetObject(&$obj) 
   {
       // What do I put here to make sure that $obj either
       // is of type InterfaceObject or inherits from it       

   }
}
?> 
```

然后此代码的用户使用他们自己的具体类实现接口：

```
<?php

class ConcreteClass extends InterfaceClass
{
}

?> 
```

我希望 ConcreteClass 实例以及所有未来未知的用户定义对象也能被 SetObject 接受。您如何在检查正确类型时允许这样做？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T02:00:01.077

实际上，对于类，您可以在 PHP (5+) 中提供类型提示。

```
 <?php
 class UsesBaseClass
 {
      function SetObject(InterfaceObject $obj) 
      {
      }
 }
 ?> 
```

正如您所期望的那样，这也将与继承一起正常工作。

顺便说一句，不要在你的类名中加上“对象”这个词......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T02:05:43.743

作为对 Eran Galperin 响应的补充，您还可以使用类型提示来强制参数为数组 - 而不仅仅是某个类的对象。

```
<?php
class MyCoolClass {
   public function passMeAnArray(array $array = array()) {
      // do something with the array  
   }  
 }  
 ?> 
```

如您所见，您可以键入该`::passMeAnArray()`方法需要的提示，`array`并提供一个默认值，以防在没有任何参数的情况下调用该方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T12:16:50.353

对于原始类型，您还可以使用 is_* 函数：

```
public function Add($a, $b)
{
  if (!is_int($a) || !is_int($b))
    throw new InvalidArgumentException();
  return $a + $b;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T02:28:47.510

@Eran [Galperin](https://stackoverflow.com/questions/137336/how-do-i-prevent-using-the-incorrect-type-in-php#137342)的回复是确保您使用的对象类型正确的首选方法。

另外值得注意的是[instanceOf](http://www.php.net/instanceof)运算符 - 当您想要检查对象是否是多种类型之一时，它很有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T07:08:24.203

**你看，关于类型提示**有多个答案。这是技术解决方案。但是你也应该确保整个设计是明智和直观的。这将使类型问题和错误更加罕见。

请记住，即使是这些类型的错误也会**在运行时**抛出。确保您对代码进行了测试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-27T11:48:55.727

即使在您描述的情况下，您的脚本也会崩溃，抱怨对象 Y 上没有方法/属性 X，所以您会知道这是从哪里来的。

无论如何，我认为总是试图防止长大的程序员将错误的对象传递给方法并不是一个好的时间投资：你可以把它花在文档和培训上。

你需要的是鸭式打字和细心的同事，而不是让你的应用程序更加僵化的额外检查。

但这可能是 Pythonista 的观点......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T03:19:28.437

您可以在 php.ini 文件中设置 error_reporting ini 设置或使用 error_reporting 函数在运行时设置它

# algorithm - 是否可以使用 ping 到伪随机选择的 IP 地址来生成真正的随机数？

> ID：137340
> 
> 赞同：56
> 
> 时间：2008-09-26T01:57:39.927
> 
> 标签：algorithm, theory, random

提出的问题是在第二年的 Comp Science 讲座中提出的，当时讨论了在确定性计算设备中生成数字的可能性。

这是唯一不依赖于非商品级硬件的建议。

随后，没有人会为了自己的名誉而明确地支持或反对它。

任何人都关心支持或反对的立场。如果是这样，如何提及可能的实现？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-09-26T02:41:45.623

不。

您网络上的恶意机器可能会使用 ARP 欺骗（或许多其他技术）来拦截您的 ping 并在特定时间后回复它们。然后，他们不仅会知道您的随机数是什么，而且还会控制它们。

当然，您的本地网络的确定性仍然存在问题，因此在实践中可能并不那么容易。但是，由于在互联网上 ping 随机 IP 没有任何好处，因此您不妨从以太网流量中获取熵。

从连接到您的机器的设备中提取熵是一个经过充分研究的原理，各种设备和测量方法的优缺点可以从 /dev/random 的实现中窃取。

[**编辑**：作为一般原则，在从事安全基础工作时（并且对大量真正随机数据的唯一实际需求是与安全相关的），您必须假设一个资源充足、坚定的攻击者会在他们的破坏你的系统的力量。

对于实际的安全性，您可以假设没有人那么想要您的 PGP 密钥，并在安全性与成本之间进行权衡。但是在发明算法和技术时，你需要给他们最强大的安全保证，这是他们可能面临的。因为我可以相信某个地方的某个人可能非常想要别人的私钥来构建这个工具包来击败你的提议，所以我不能接受它作为对当前最佳实践的进步。AFAIK /dev/random 非常接近在廉价家用 PC 上生成真正随机数据的最佳实践]

[**另一个编辑**：它在评论中建议（1）任何TRNG都可能影响物理过程，并且（2）安全问题无论如何都不适用于这里。

(1) 的答案是，在任何真正的硬件上都可能比 ping 响应时间做得更好，并且更快地收集更多的熵，因此这个提议不是解决方案。在 CS 术语中，很明显您无法在确定性机器上生成随机数，这就是引发问题的原因。但是在 CS 术语中，具有外部输入流的机器在定义上是不确定的，所以如果我们谈论 ping，那么我们就不是在谈论确定性机器。因此，有必要查看真实机器的真实输入，并将它们视为随机性的来源。无论您的机器是什么机器，原始 ping 时间在可用资源列表中都不高，因此可以在担心更好的资源有多好之前排除它们。

（2）的答案是哲学的。如果您不介意您的随机数具有可以随心所欲而不是偶然选择的属性，那么这个建议是可以的。但这不是我对“随机”一词的理解。仅仅因为某些事情不一致并不意味着它一定是随机的。

最后，按照要求解决提案的实施细节：假设您接受随机的 ping 时间，您仍然不能使用未处理的 ping 时间作为 RNG 输出。你不知道它们的概率分布，它们肯定不是均匀分布的（这通常是人们希望从 RNG 获得的）。

因此，您需要确定您愿意依赖的每个 ping 的熵位数。熵是随机变量的精确定义的数学属性，可以合理地被认为是衡量它实际上有多“随机”的量度。在实践中，您会找到一个您满意的下限。然后将多个输入散列在一起，并将其转换为小于或等于输入的总依赖熵的输出位数。“总计”并不一定意味着总和：如果输入在统计上是独立的，那么它就是总和，但对于 ping 而言，这不太可能是这种情况，因此您的熵估计的一部分将考虑相关性。这种散列操作的老大哥被称为“熵收集器”，所有好的操作系统都有一个。

但是，如果您使用数据为 PRNG 播种，并且 PRNG 可以使用任意大的种子输入，那么您不必散列，因为它会为您执行此操作。如果你想知道你的种子值有多“随机”，你仍然需要估计熵——你可以使用世界上最好的 PRNG，但它的熵仍然受到种子熵的限制。]

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-26T02:49:22.750

随机数太重要了，不能靠运气。

或外部影响/操纵。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-04T17:06:40.423

## 简短的回答

单独使用 ping 时序数据不会是真正随机的，但它可以用作[熵](http://en.wikipedia.org/wiki/Information_entropy)的来源，然后可以用来生成真正的随机数据。

## 更长的版本

### ping 时间有多随机？

就其本身而言，来自网络操作（例如 ping）的计时数据不会均匀分布。（而且选择随机主机的想法是不切实际的——许多主机根本不会响应，主机之间的差异可能很大，响应时间范围之间存在差距——想想卫星连接）。

然而，虽然时间分布不会很好，但数据中会有一定程度的随机性。或者换句话说，存在一定程度的[信息熵](http://en.wikipedia.org/wiki/Information_entropy)。将时序数据输入随机数生成器来播种是个好主意。那么存在什么级别的熵呢？

对于大约 50 毫秒的网络定时数据，测量到最接近的 0.1 毫秒，值的分布为 2 毫秒，您有大约 20 个值。向下舍入到最接近的 2 次幂（16 = 2^4），每个计时值有 4 位熵。如果它用于任何类型的安全应用程序（例如生成加密密钥），那么我会保守地说每次读取只有 2 或 3 位熵。 *（注意我这里做了一个非常粗略的估计，忽略了被攻击的可能性）。*

### 如何生成真正的随机数据

对于真正的随机数，您需要将数据发送到按照[/dev/random](http://en.wikipedia.org/wiki//dev/random)设计的东西中，它将收集熵，将其分布在数据存储中（使用某种[散列函数](http://en.wikipedia.org/wiki/Hash_function)，通常是[安全的](http://en.wikipedia.org/wiki/Cryptographic_hash_function)）。同时，熵估计增加。因此，对于 128 位 AES 密钥，在熵池有足够的熵之前需要 64 次 ping 时间。

为了更加健壮，您可以添加来自键盘和鼠标使用情况、硬盘响应时间、主板传感器数据（例如温度）等的计时数据。它增加了熵收集的速率，使攻击者难以监控所有熵的来源。事实上，这就是现代系统所做的。MS Windows 熵源的完整列表在[这篇文章的第二条评论中](http://blogs.msdn.com/michael_howard/archive/2005/01/14/353379.aspx#353493)列出。

### 更多阅读

要讨论对随机数生成器的（计算机安全）攻击，以及密码安全随机数生成器的设计，您可能会比阅读[Bruce Schneier](http://www.schneier.com/index.html)和 John Kelsey的[yarrow 论文做得更糟。](http://www.schneier.com/yarrow.html)（BSD 和 Mac OS X 系统使用 Yarrow）。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-03-09T04:41:47.117

不。

拔下网线（或`/etc/init.d/networking stop`），熵基本降为零。

在它正在 ping 的机器上执行拒绝服务攻击，您还可以获得可预测的结果（ping 超时值）

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-26T02:29:43.423

我想你可以。有几点需要注意：

*   即使 ping 随机 IP 地址，前几跳（从您到 ISP 网络中的第一个真正的 L3 路由器）对于每个数据包都是相同的。这为往返时间设置了一个下限，即使您在第一个存在点对数据中心中的某些内容执行 ping 操作。所以你必须小心规范时间，往返有一个下限。
*   您还必须小心网络中的流量整形。路由器中典型的漏桶实现每 M 微秒释放 N 个字节，这有效地将您的时间扰乱到特定的时隙而不是连续的时间范围内。因此，您可能需要丢弃时间戳的低位。

但是，我不同意商品硬件中没有好的熵来源的前提。过去几年的许多 x86 芯片组都包含随机数生成器。我熟悉的那些使用相对敏感的 ADC 来测量芯片上两个不同位置的温度，然后减去它们。这种温差的低位可以显示（通过卡方分析）是强随机的。当您增加系统上的处理负载时，整体温度会上升，但芯片的两个区域之间的差异仍然不相关且不可预测。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-02-11T16:10:03.543

我见过的商品硬件随机性的最佳来源是一个人从他的网络摄像头上取下过滤器或其他东西，在镜头上涂上不透明的胶水，然后能够轻松地从撞击 CCD 的宇宙射线中检测到单个白色像素。它们尽可能接近完全随机，并通过量子效应免受外部窥探。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T02:15:07.653

一个好的随机数生成器的一部分是所有数字的概率相等，如 n -> 无穷大。

因此，如果您计划生成随机字节，那么从良好的 rng 获得足够的数据，每个字节应该有相同的返回概率。此外，返回的某些数字不应该有模式或可预测性（在某些时间段内的概率峰值）。

我不太确定使用 ping 你将测量什么来获取随机变量，它是响应时间吗？如果是这样，您可以非常确定某些响应时间或响应时间范围会比其他响应时间更频繁，因此可能会产生不安全的随机数生成器。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-11-15T10:24:40.633

如果你想要商品硬件，你的声卡应该可以做到。只需调高模拟输入的音量，您就有了便宜的白噪声源。无需网络的廉价随机性。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T02:27:03.443

它不如使用大气噪声好，但它仍然是真正随机的，因为它取决于以随机不可重复行为而臭名昭著的网络特性。

有关随机性的更多信息，请参见[Random.org](http://www.random.org/randomness/)。

这是一个实现的尝试：

```
@ips  : list = getIpAddresses();
@rnd         = PseudorandomNumberGenerator(0 to (ips.count - 1));

@getTrueRandomNumber() { ping(ips[rnd.nextNumber()]).averageTime } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T02:34:39.727

*测量某些东西*以生成随机种子的方法似乎是一种非常好的方法。O'Reilly 的书[Practical Unix and Internet Security](http://books.google.com/books?id=t0IExLP-MPMC&pg=PA524&lpg=PA524)提供了一些类似的附加方法来确定随机种子，例如要求用户键入几个击键，然后测量击键之间的时间。（书中指出，PGP 使用这种技术作为其随机性的来源。）

我想知道**系统 CPU 的当前温度**（测量到许多小数位）是否可能是随机种子的可行组件。这种方法的优点是不需要访问网络（因此当网络连接断开时随机生成器不会变得不可用）。

但是，CPU 的内部传感器可能不太可能将 CPU 温度准确测量到足够多的小数位，以使该值作为随机数种子真正可行；至少，不是问题中提到的“商品级硬件”！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-05T07:28:28.187

在信任往返 ping 作为熵之前，我会更早地使用像[ISAAC这样的东西作为更强的 PRNG。](http://burtleburtle.net/bob/rand/isaacafa.html)就像其他人所说的那样，一个人不仅要猜你的数字，而且还可能在不同程度上控制它们，这太容易了。

存在其他重要的熵来源，其他人已经提到过。没有提到的一个（可能不实用）是从板载音频设备中采样噪声。即使没有连接麦克风，它通常也会有点吵。

我进行了 9 轮尝试为我正在编写的客户端/服务器 RPC 机制提出一个强大（且快速）的 PRNG。双方都有一个相同的密钥，由 1024 行 32 个字符的密码组成。客户端将发送 AUTH xx，服务器将返回 AUTH yy .. 双方都知道使用哪两行密钥来生成河豚秘密（+盐）。然后服务器将发送整个密钥（加密）的 SHA-256 摘要，客户端知道它正在与具有正确密钥的东西交谈..会话继续。是的，对中间人的保护非常弱，但是对于设备的使用方式，公钥是不可能的。

所以，你有一个非阻塞服务器，它必须处理多达 256 个连接.. PRNG 不仅必须强大，而且必须快速。使用较慢的方法在客户端收集熵并没有那么困难，但在服务器中无法提供。

所以，我不得不问一下你的想法......它有多实用？

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-09T05:28:14.090

没有数学计算可以产生随机结果，但在“现实世界”中，计算机不仅仅只是处理数字......只要有一点创造力，就应该有可能产生没有已知方法的那种随机结果再现或预测准确的结果。

我见过的在所有系统上通用的最容易实现的想法之一是使用来自计算机声卡线路输入/麦克风端口的静态。

其他想法包括热噪声和高速缓存行的低级时序。许多带有 TPM 芯片的现代 PC 已经板载了加密质量的硬件随机数生成器。

我对 ping 的下意识反应（尤其是使用 ICMP 时）是您的作弊过于明目张胆。那时，您不妨拿出一个吉格计数器并使用背景辐射作为您的随机源。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-09T16:55:33.220

是的，这是可能的，但是……魔鬼在细节中。

如果要生成 32 位整数，则需要收集 >32 位的熵（并使用足够的混合函数来使熵散布，但这是已知且可行的）。最大的问题是：

**ping时间有多少熵？**

这个问题的答案取决于对网络和您的攻击模型的各种假设，并且在不同的情况下有不同的答案。

如果攻击者能够完全控制 ping 时间，那么每次 ping 获得的熵为 0 位，并且无论混合多少，您都无法获得 32 位的熵。如果他们对 ping 时间的控制不够完美，您将获得一些熵，并且（如果您不高估所收集的熵量）将获得完全随机的 32 位数字。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-04-16T01:08:05.853

YouTube 展示了一个正在运行的设备：[http ://www.youtube.com/watch?v=7n8LNxGbZbs](http://www.youtube.com/watch?v=7n8LNxGbZbs)

随机是，如果没有人可以预测下一个状态。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-26T02:05:44.867

呃，我发现这种问题很快就引发了关于“真正随机”含义的讨论。

我认为测量 ping 会产生质量不错的随机位，但速度不足以发挥很大作用（除非你愿意做一些严重的 DDOS 攻击）。

而且我认为它不会比测量计算机的模拟/机械特性或操作它的肉袋的行为更随机。

（编辑）实际上，这种方法让您了解网络上有人操纵您的“随机”数字生成器的可能性。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-26T02:06:46.393

虽然我不能明确地支持或反对，但这个实现有它的问题。

这些IP地址是从哪里来的，如果它们是随机选择的，当它们不回复或回复迟到时会发生什么，是否意味着随机数出现的速度会更慢。

此外，即使您将制作 100.000 个结果的可视化图表并计算出这些数字之间没有相关性或相关性很少，但这并不意味着它是真正随机的。正如[dilbert](http://www.random.org/analysis/dilbert.jpg)所解释的:)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-26T02:15:33.860

它并没有让我觉得它是随机性的良好来源。

您将使用什么指标——显而易见的指标是响应时间，但您可以合理预期的值范围很小：几十毫秒到几千毫秒。响应时间本身将遵循钟形曲线，并且不会随机分布在任何间隔（您将如何选择间隔？）因此您必须尝试从数字中选择一些“随机”位。

LSB 可能会给你一个随机的比特流，但你必须考虑时钟粒度问题——也许由于中断的工作方式，在某些系统上你总是会得到 2ms 的倍数。

可能有更好的“有趣”方式来获取随机位——也许谷歌搜索一个随机词，抓取第一页并从页面中选择第 N 位。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-30T13:36:48.843

在我看来，真正的随机性是不可言喻的——没有办法知道一个序列是否是随机的，因为根据定义它可以包含*任何东西*，无论多么不可能。保证特定的分布模式*可以减少*随机性。“模式”这个词有点赠品。

```
 I MADE U A RANDOM NUMBER
           BUT I EATED IT 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-07T05:47:46.757

随机性不是二元属性——它是一个介于 0 和 1 之间的值，它描述了预测流中下一个值的难度。

问“如果我基于 ping，我的值会有多随机？” 实际上是在问“ping 有多随机？”。您可以通过收集足够大的数据集（例如 100 万次 ping）并及时绘制它们的分布曲线和行为来估计这一点。如果分布是平坦的并且行为难以预测，则数据似乎更加随机。越颠簸的分布或可预测的行为表明随机性越低。

您还应该考虑样本分辨率。我可以想象结果以某种方式四舍五入到一毫秒，因此使用 ping 你可以有 0 到 500 之间的整数值。这不是很多分辨率。

在实际方面，我建议不要这样做，因为可以预测和操纵 ping，从而进一步降低它们的随机性。

一般来说，我建议不要“滚动你自己的”随机生成器、加密方法和散列算法。尽管看起来很有趣，但它主要是很多非常令人生畏的数学。

至于如何构建一个非常好的熵发生器——我认为这可能必须是一个密封的盒子，它可以输出某种原子或亚原子级别的交互结果。我的意思是，如果您使用敌人也可以轻松读取的熵源，那么他只需要找出您的算法即可。任何形式的连接都是可能的攻击向量，因此您应该将熵源放置在尽可能靠近使用它的服务的位置。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-04-07T22:21:57.010

您可以使用 XKCD 方法：

![随机数发生器](https://imgs.xkcd.com/comics/random_number.png)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-08-02T10:49:55.790

我得到了一些使用 traceroute 创建随机数的代码。我还有一个使用 ping 执行此操作的程序。一年多前，我为一个班级项目做了这件事。它所做的只是在和地址上运行 traceroute，它占用 ms 次中最小的 sig 数字。它在获取随机数方面效果很好，但我真的不知道它与真正的随机数有多接近。

这是我运行它时得到的 8 个数字的列表。

> 455298558263758292242406192
> 
> 506117668905625112192115962
> 
> 805206848215780261837105742
> 
> 095116658289968138760389050
> 
> 465024754117025737211084163
> 
> 995116659108459780006127281
> 
> 814216734206691405380713492
> 
> 124216749135482109975241865

```
#include <iostream>
#include <string>
#include <stdio.h>
#include <cstdio>
#include <stdlib.h>
#include <vector>
#include <fstream>

using namespace std;

int main()
{
system("traceroute -w 5 www.google.com >> trace.txt");

string fname = "trace.txt";
ifstream in;
string temp;

vector<string> tracer;
vector<string> numbers;

in.open(fname.c_str());
while(in>>temp)
tracer.push_back(temp);

system("rm trace.txt");

unsigned index = 0;

string a = "ms";
while(index<tracer.size())
{
if(tracer[index]== a)
numbers.push_back(tracer[index-1]);
++index;
}

std::string rand;

for(unsigned i = 0 ; i < numbers.size() ; ++i)
{
std::string temp = numbers[i];
int index = temp.size();
rand += temp[index - 1];
}

cout<<rand<<endl;

return 0;

} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-11-15T10:15:05.803

很简单，由于网络遵循规定的规则，结果不是随机的。

网络摄像头的想法听起来（有点）合理。Linux 人员通常建议仅使用未连接麦克风的声卡中的随机噪声。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-06-13T20:37:45.233

这是我的建议：

1-选择离您所在位置尽可能远的网站。例如，如果您在美国，请尝试一些其服务器 IP 位于马拉西亚、中国、俄罗斯、印度等的网站。流量大的服务器比较好。

2-在您所在国家/地区的高互联网流量期间（在我的国家/地区，大约是晚上 7 点到 11 点）多次 ping 这些网站，获取每个 ping 结果（仅使用整数值）并计算其模数 2（即从每个 ping 操作中，您会得到一位：0 或 1）。

3-重复这个过程几天，记录结果。

4- 收集从所有 ping 中获得的所有位（可能您将获得数十万位）并从中选择您的位。（也许你想通过使用上面提到的相同方法的一些数据来选择你的位:)）

小心：在你的代码中你应该检查超时..等

# open-source - 基本案例应该是开源的吗？

> ID：137341
> 
> 赞同：5
> 
> 时间：2008-09-26T01:58:44.620
> 
> 标签：open-source

我在一个由拥有闭源软件的大公司主导的专有世界中作为一名软件开发人员孵化——这没有受到质疑。随着我事业的发展，互联网变得越来越重要，我接触到的开源软件也越来越多。

回顾大多数库，我不是在谈论我们为我的雇主编写的应用程序级代码和实用程序，其中很少有直接的竞争优势，更不用说本质上代表你认为的知识产权。越来越多的库、框架和实用程序具有开源等价物。现在，对于我自己和与我一起工作的开发人员来说，在着手实现此类代码之前首先查找现有库是很常见的。

那已经改变了很多。这些库中的许多可能由于缺乏维护而作为开源而枯萎，如果他们这样做了，我的雇主也不会受到影响。如果他们蓬勃发展或至少吸引了提交，那么这些雇主就会受益——这发生在我现在的雇主身上。

现在，看看我们面前的情况，我开始认为，对于我们将编写的大部分库和框架，我们应该在假设它们将成为开源的前提下创建它们。对于库、实用程序和框架来说，这应该是基本情况，而不是假设它们将被关闭，然后您必须努力使它们打开——事实证明，事后往往需要做更多的工作（获得批准，进行审查和清理）。

随着基本案例是开源的，我认为会有好处：

*   开发人员知道代码将被同行和潜在的未来雇主看到，他们可能会在文档、测试和设计方面更加自律，从而使代码本身更好。只要知道世界将能够看到您的代码就可能会改变您愿意削减的角落。这应该有利于赞助开发的组织。
*   个人开发人员将拥有更大的库和可重用代码来在他们的所有项目中使用，尽管这对个人开发人员来说比赞助组织更有利
*   组织将更有效地分散开发成本，这是开源的核心前提，但如果开放是基本案例，它将更加广泛
*   它目前吸引了某种类型的开发人员加入该组织
*   它不能保证，但它为潜在开发人员提供了进入面试过程的能力，他们已经熟悉公司实际使用的工具和源代码

感觉这是一种趋势，至少在库和框架级别 - 在我看来不是在应用程序级别。这是一个多元化的社区，你怎么看？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T02:15:17.717

我认为开源代码总是一件好事（只要它不妨碍利润，如果它是可以/将要获得暴利的代码）。我见过的开源的最大好处之一是，如果用户想要实现某个功能，他们可以自己实现。它也让客户对此感到自豪——如果你帮助制造了一些东西，为什么还要使用其他东西呢？

从商业角度来看，这里有一些技术可以在赚钱的同时从开源中获益：

*   如果您担心竞争对手使用您的代码，请编写一个自定义许可证，允许您但没有其他人可以在专有应用程序中重用代码。例如，您可以在 GPLv3 下获得许可，但附加条款允许您像根据 LGPL 条款一样使用它，并允许代码与其他 GPL 产品集成（以便它们可以混合，一个重要的OSS的一部分）。这使您可以获利但不会让您的竞争对手获利，而社区则可以从中受益。
*   双重许可与第 1 点类似，但它使您难以使用用户提交的代码（因为它将受 OSS 许可和单独的约束）。您也可以混合该方法，如果您打算将图书馆用于商业销售，这将很有用。
*   与其只出售代码，不如出售其他财产。我知道有一款游戏通过开源代码但销售图形和关卡而获得了成功（无论如何，就小众独立游戏而言）。

# excel - Excel CSV - 数字单元格格式

> ID：137359
> 
> 赞同：88
> 
> 时间：2008-09-26T02:07:20.637
> 
> 标签：excel, csv, formatting, number-formatting

我将报告生成为 CSV 文件。当我尝试在 Excel 中打开文件时，它会根据单元格的内容对数据类型进行假设，并相应地重新格式化。

例如，如果 CSV 文件包含

```
...,005,... 
```

然后 Excel 将其显示为 5。有没有办法覆盖它并显示 005？

我更愿意对文件本身做一些事情，这样用户就可以双击 CSV 文件来打开它。

我使用 Excel 2003。

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2008-09-26T21:23:58.880

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-26T02:49:19.490

不要使用 CSV，使用 SYLK。
[http://en.wikipedia.org/wiki/SYmbolic_LinK_(SYLK)](http://en.wikipedia.org/wiki/SYmbolic_LinK_(SYLK))

它提供了对格式的更多控制，并且 Excel 不会尝试通过检查内容来猜测字段的类型。它看起来有点复杂，但你可以使用一个非常小的子集。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-05-15T21:27:15.073

这适用于 Microsoft Office 2010，Excel 版本 14

*我误读了 OP 的偏好“对文件本身做一些事情”。我仍然为那些想要直接格式化导入的解决方案保留这个*

1.  打开一个空白（新）文件（文件 -> 从工作簿新建）

2.  打开导入向导（数据 -> 从文本）

3.  选择您的 .csv 文件并导入

4.  在对话框中，选择“分隔”，然后单击下一步。

5.  选择您的分隔符（取消选中除“逗号”之外的所有内容），选择您的文本限定符（可能是 {None}），单击下一步

6.  在**数据预览**字段中，选择您想要成为文本的列。它应该突出显示。

7.  在**列数据格式**字段中，选择“文本”。

8.  点击完成。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T02:10:23.327

您可以简单地将您的范围格式化为文本。

[这里](http://peltiertech.com/Excel/NumberFormats.html)还有一篇关于数字格式以及如何对其进行编程的好文章。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T04:29:50.717

实际上我发现，至少从 Office 2003 开始​​，您可以将 Excel 电子表格保存为 XML 文件。因此，我可以生成一个 XML 文件，当我双击它时，它将在 Excel 中打开。它提供与 SYLK 相同级别的控制，但 XML 语法更直观。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-10-09T14:01:04.743

在单元格中添加一个不间断的空间可能会有所帮助。例如： `"firstvalue";"secondvalue";"005 ";"othervalue"`

它强制 Excel 将其视为文本，并且空格不可见。在 Windows 上，您可以通过提示 alt+0160 添加不间断空格。有关更多信息，请参见此处：[http ://en.wikipedia.org/wiki/Non-breaking_space](http://en.wikipedia.org/wiki/Non-breaking_space)

在 Excel 2010 上尝试过。希望这可以帮助那些仍在为这个问题寻找一个非常合适的解决方案的人。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-01-24T11:20:38.187

我在从 C# 代码导出 CSV 数据时遇到了这个问题，并通过在前导零数据前加上制表符 \t 解决了这个问题，因此数据在 Excel 中被解释为文本而不是数字（但与附加其他字符不同，它不会看不见）。

我确实喜欢 ="001" 方法，但这不允许在不从导入 CSV 文件中删除所有这些格式的情况下将导出的 CSV 数据重新导入到我的 C# 应用程序（相反，我将只修剪导入数据） .

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T02:10:34.810

我相信当您导入文件时，您可以选择列类型。将其设为文本而不是数字。不过，目前我面前没有副本可供检查。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-12-22T14:05:46.327

[将 csv 加载到 oleDB 并强制所有推断的数据类型为字符串](https://stackoverflow.com/questions/1688497/load-csv-into-oledb-and-force-all-inferred-datatypes-to-string)

我问了同样的问题，然后用代码回答了。

基本上，当加载 csv 文件时，oledb 驱动程序会做出假设，您可以告诉它要做出哪些假设。

我的代码虽然强制所有数据类型为字符串……但更改架构非常容易。出于我的目的，我使用 xslt 以我想要的方式获得 ti - 但我正在解析各种各样的文件。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-01-04T19:28:33.800

我知道这是一个老问题，但我有一个未在此处列出的解决方案。

当您生成 csv 时，在逗号之后但在您的值之前添加一个空格，例如`, 005,`.

无论如何，这可以防止 excel 2007 中的自动日期格式。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-04-06T15:18:24.720

当导入的 CSV 文件在单元格中有换行符时，文本导入向导方法不起作用。此方法处理这种情况（至少使用制表符分隔的数据）：

1.  创建新的 Excel 文件
2.  Ctrl+A 选择所有单元格
3.  在数字格式组合框中，选择文本
4.  在文本编辑器中打开制表符分隔文件
5.  全选，复制粘贴到Excel

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-11-19T11:17:44.660

只需在 CSV 文档中的数字前添加 '。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-05-14T22:42:21.407

这让我整天发疯（因为在打开 CSV 文件之前确实无法控制 Excel 列类型），这对我有用，使用 VB.NET 和 Excel 互操作：

```
 'Convert .csv file to .txt file.
        FileName = ConvertToText(FileName)

        Dim ColumnTypes(,) As Integer = New Integer(,) {{1, xlTextFormat}, _
                                                        {2, xlTextFormat}, _
                                                        {3, xlGeneralFormat}, _
                                                        {4, xlGeneralFormat}, _
                                                        {5, xlGeneralFormat}, _
                                                        {6, xlGeneralFormat}}

        'We are using OpenText() in order to specify the column types.
        mxlApp.Workbooks.OpenText(FileName, , , Excel.XlTextParsingType.xlDelimited, , , True, , True, , , , ColumnTypes)
        mxlWorkBook = mxlApp.ActiveWorkbook
        mxlWorkSheet = CType(mxlApp.ActiveSheet, Excel.Worksheet)

Private Function ConvertToText(ByVal FileName As String) As String
    'Convert the .csv file to a .txt file.
    'If the file is a text file, we can specify the column types.
    'Otherwise, the Codes are first converted to numbers, which loses trailing zeros.

    Try
        Dim MyReader As New StreamReader(FileName)
        Dim NewFileName As String = FileName.Replace(".CSV", ".TXT")
        Dim MyWriter As New StreamWriter(NewFileName, False)
        Dim strLine As String

        Do While Not MyReader.EndOfStream
            strLine = MyReader.ReadLine
            MyWriter.WriteLine(strLine)
        Loop

        MyReader.Close()
        MyReader.Dispose()
        MyWriter.Close()
        MyWriter.Dispose()

        Return NewFileName
    Catch ex As Exception
        MsgBox(ex.Message)
        Return ""
    End Try

End Function 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T02:12:55.630

打开 CSV 时，您将获得文本导入向导。在向导的最后一步，您应该能够将特定列作为文本导入，从而保留“00”前缀。之后，您可以以任何您想要的方式格式化单元格。

我尝试使用 Excel 2007，它似乎可以工作。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-11-30T19:14:18.217

好吧，excel 永远不会弹出 CSV 文件的向导。如果您将其重命名为 .txt，您将在下次执行“文件”>“在 Excel 中打开”时看到该向导。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-07-15T19:32:24.707

在字段前加上单引号。Excel 会将其视为文本，即使它看起来像一个数字。

```
...,`005,... 
```

**编辑：**这是错误的。撇号技巧仅在将数据直接输入 Excel 时才有效。当您在 CSV 文件中使用它时，撇号会出现在您不想要的字段中。

[http://support.microsoft.com/kb/214233](http://support.microsoft.com/kb/214233)

# .net - .NET 中有没有办法以编程方式监听 HTTP 流量？

> ID：137360
> 
> 赞同：3
> 
> 时间：2008-09-26T02:07:29.840
> 
> 标签：.net, unit-testing, http, proxy, automation

我正在使用浏览器自动化来测试网站，但我需要验证来自浏览器的 HTTP 请求（即图像、外部脚本、XmlHttpRequest 对象）。有没有办法以编程方式实例化浏览器使用的代理以查看其发送的内容？

我已经在使用 Fiddler 来查看流量，但我想要一些可以在持续构建集成中使用的无 UI 的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T02:30:53.777

我曾简要研究过同一件事并考虑了两种解决方案（但尚未尝试过）。

我的第一个建议是使用 HttpListener 类（可能还有 Webclient 或其他 System.Net http 相关类将请求重新发布到您的应用程序）作为 WebBrowser 测试调用的代理。我没有使用 HttpListener 的经验，但它看起来是一种将调用代理到您的应用程序的简单且有前途的方法。

我的第二个建议是做 Fiddler 所做的事情：在您的测试机器上接入 WinINET Http 堆栈以充当代理（使用某种过滤器将其范围缩小到您的 WebBrowser 的调用）。不幸的是，我能找到的最好的例子是 Fiddler 本身，而我知道获取代码的唯一方法是 Reflector。可能以另一种方式访问​​ Fiddler 代理代码，但我没有时间完全调查此路径。

HTH！，理查德

# c# - 我应该怎么做才能让一个小型的开源项目保持活跃和可持续？

> ID：137361
> 
> 赞同：3
> 
> 时间：2008-09-26T02:07:56.970
> 
> 标签：c#, .net, open-source

几个月前，我编写了一个小工具，我们在工作中需要它来完成一项特定的任务，我决定在 CodePlex 上分享它。它是用 C# 编写的，老实说，这没什么大不了的，但因为它是我用该语言从头开始构建的第一个项目，并且目标是从一开始就打开它，所以最终对它产生了某种情感上的依恋，我的意思是你希望人们真正参与进来，无论是批评、错误报告还是你有什么。

所以我的问题是，我能做些什么来真正鼓励参与、激发好奇心或只是收到更多关于它的反馈？

顺便说一句，这是我正在谈论的项目：http: [//www.codeplex.com/winxmlcook/](http://www.codeplex.com/winxmlcook/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T02:13:44.210

你应该：

*   在您认为相关的地方推广它（论坛、邮件列表等）。尽量不要发送垃圾邮件——它会引起强烈反对。
*   继续提供更新以创建活动项目的外观，直到更多人选择它。
*   寻找项目负责人，他们是那种鼓励其他人也做出贡献的贡献者。
*   关于它的博客并链接到相关博客（创建 ping-backs）。还可以在相关博客文章中发表评论。

基本上，您的通用网络营销策略；）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T06:56:59.787

您首先必须通过营销该工具来获取用户。一旦有了用户，这自然意味着您将开始获得反馈。

我注意到的一件事是您的项目描述并没有很好地销售该项目。例如，在 Google 中输入“winxmlcook”，显示的是您的项目描述，但不太可能让人点击它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T02:16:06.607

我知道我在不断发布这本书时听起来像是一个破纪录，但是关于运行一个开源项目你可能需要知道的一切都[在这里](http://producingoss.com/en/index.html)。特别要注意这两章：

*   [入门](http://producingoss.com/en/getting-started.html)
*   [管理志愿者](http://producingoss.com/en/managing-volunteers.html)

# process - 从问题传递到代码的过程。你是怎么学的？

> ID：137375
> 
> 赞同：8
> 
> 时间：2008-09-26T02:13:52.803
> 
> 标签：process

我正在教/帮助学生编程。

我记得当我开始时，以下过程总是对我有帮助；它看起来很直观，我想知道其他人是否有类似的方法。

1.  阅读问题并理解它（当然）。
2.  识别可能的“功能”和变量。
3.  写下我将如何一步一步做（算法）
4.  把它翻译成代码，如果有什么你不能做的，创建一个为你做的函数并继续前进。

随着时间的推移和实践，我似乎已经忘记了从问题描述到编码解决方案是多么困难，但是，通过应用这种方法，我设法学习了如何编程。

所以对于像这样的项目描述：

> *系统必须根据以下规则计算商品的价格（规则的描述......客户、折扣、可用性等......等等）*

我的第一步是了解问题所在。

然后识别项目、规则、变量等。

伪代码类似于：

```
function getPrice( itemPrice, quantity , clientAge, hourOfDay ) : int 
   if( hourOfDay > 18 ) then
      discount = 5%

   if( quantity > 10 ) then
      discount = 5%

   if( clientAge > 60 or < 18 ) then
      discount = 5%

        return item_price - discounts...
end 
```

然后将其传递给编程语言..

```
public class Problem1{
    public int getPrice( int itemPrice, int quantity,hourOdDay ) {
        int discount = 0;
        if( hourOfDay > 10 ) {
             // uh uh.. U don't know how to calculate percentage... 
             // create a function and move on.
            discount += percentOf( 5, itemPriece );
            .
            .
            .
            you get the idea..

        }
     }
    public int percentOf( int percent, int i ) {
             // .... 
    }

} 
```

您是否采用了类似的方法？..有人教您类似的方法还是您发现了自己（就像我一样：（）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T02:52:43.553

我通过测试驱动的方法。

### 1\. 我写下（在纸上或纯文本编辑器上）满足问题需要的测试或规范列表。

```
- simple calculations (no discounts and concessions) with:
    - single item
    - two items
    - maximum number of items that doesn't have a discount
- calculate for discounts based on number of items
    - buying 10 items gives you a 5% discount
    - buying 15 items gives you a 7% discount
    - etc.
- calculate based on hourly rates
    - calculate morning rates
    - calculate afternoon rates
    - calculate evening rates
    - calculate midnight rates
- calculate based on buyer's age
    - children
    - adults
    - seniors
- calculate based on combinations
    - buying 10 items in the afternoon 
```

### 2\. 寻找我认为最容易实现的项目并为其编写测试。例如单品看起来很简单

该示例使用 Nunit 和 C#。

```
[Test] public void SingleItems()
{
    Assert.AreEqual(5, GetPrice(5, 1));
} 
```

使用以下方法实现：

```
public decimal GetPrice(decimal amount, int quantity)
{
    return amount * quantity; // easy!
} 
```

然后转到这两个项目。

```
[Test]
public void TwoItemsItems()
{
    Assert.AreEqual(10, GetPrice(5, 2));
} 
```

实现仍然通过了测试，所以继续下一个测试。

### 3\. 时刻注意重复并将其删除。当所有测试都通过并且您不再想任何测试时，您就完成了。

这并不能保证您将创建最有效的算法，但只要您知道要测试什么并且一切都通过，它将保证您得到正确的答案。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T03:29:19.427

老式的 OO 方式：

*   写下对问题及其解决方案的描述
*   圈出名词，这些是候选对象
*   在动词周围画框，这些是候选信息
*   将动词与会“做”动作的名词组合在一起；列出任何其他需要帮助的名词
*   看看你是否可以使用 noun.verb(other nouns) 形式重述解决方案
*   编码

[这种方法先于 CRC 卡，但是已经很久了（超过 20 年），我不记得我在哪里学的了]

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T03:42:00.533

在学习编程时，我认为 TDD 没有帮助。当您对编程的内容有了一些概念后，TDD 会很好，但对于初学者来说，拥有一个可以编写代码并在最快的周转时间内查看结果的环境是最重要的。

我会立即从问题陈述到代码。破解它。帮助学生了解编写软件/结构化算法的不同方式。教学生改变主意并重新编写代码。尝试教授一些关于代码美学的知识。

一旦他们可以破解代码......然后在重构方面引入正式重组的想法。然后介绍 TDD 的想法，作为一种使过程更加健壮的方法。但只有当他们对操纵代码做他们想做的事情感到舒服时。在那个阶段，能够指定测试会更容易一些。原因是 TDD 是关于设计的。在学习时，你并不真正关心设计，而是关心你能做什么，你必须玩什么玩具，它们是如何工作的，你如何将它们组合在一起。一旦您对此有所了解，您就会想考虑设计，而这正是 TDD 真正发挥作用的时候。

从那里我将开始引入微模式导致设计模式

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T02:17:43.093

我做了类似的事情。

*   弄清楚规则/逻辑。
*   弄清楚数学。
*   然后尝试编写代码。

在这样做了几个月后，它就被内化了。直到遇到需要您分解的复杂问题时，您才意识到自己在做这件事。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T03:40:08.150

我从顶部开始，一路向下。基本上，我将从编写一个高级程序开始，勾勒出其中的细节，然后开始填写细节。

说我有这个问题（来自项目欧拉）

> 前十个自然数的平方和为，1^2 + 2^2 + ... + 10^2 = 385
> 
> 前十个自然数之和的平方是，(1 + 2 + ... + 10)^2 = 55^2 = 3025
> 
> 因此，前十个自然数的平方和与和的平方之差为 3025 385 = 2640。
> 
> 求前一百个自然数的平方和与和的平方之间的差。

所以我是这样开始的：

```
(display (- (sum-of-squares (list-to 10))
            (square-of-sums (list-to 10)))) 
```

现在，在 Scheme 中，没有平方和、平方和或 list-to 函数。因此，下一步将是构建其中的每一个。在构建这些功能中的每一个时，我可能会发现我需要更多地抽象出来。我尽量让事情简单化，这样每个函数只做一件事。当我构建一些可测试的功能时，我会为它编写一个单元测试。当我开始注意到某些数据的逻辑分组以及作用于它们的函数时，我可能会将其推入对象中。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-26T23:34:49.480

自从 TDD 被介绍给我以来，我一直都很喜欢它。帮助我计划我的代码，并且每次我修改我的代码时让我的所有测试都返回“成功”，让我放心，让我知道我今天准时回家！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T02:21:20.820

一厢情愿可能是解决复杂问题的最重要工具。如有疑问，请假设存在一个函数来解决您的问题（首先创建一个存根）。稍后您将返回到它以扩展它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T03:04:54.820

一本适合寻找过程的初学者的好书： [测试驱动开发：示例](https://rads.stackoverflow.com/amzn/click/com/0321146530)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-26T03:48:34.027

我父亲有一堆流程图模板，当他第一次教我编程时，他曾经让我使用这些模板。直到今天，我都画正方形和菱形来构建一个如何分析问题的逻辑过程。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-26T23:59:09.990

我认为在编程方面我知道大约有十几种不同的启发式方法，因此我有时会根据我正在尝试做的事情来浏览列表。一开始，重要的是要知道期望的最终结果是什么，然后尝试向后工作以找到它。

我记得一个算法课程涵盖了其中一些方式，例如：

*   将其简化为已知问题或琐碎问题
*   分而治之（MergeSort 是这里的经典示例）
*   使用具有正确功能的数据结构（此处以 HeapSort 为例）
*   递归（知道琐碎的解决方案并能够减少到那些）
*   动态规划

组织解决方案并针对奇怪的情况对其进行测试，例如，如果有人认为 L 应该是一个数字，我通常会在编写之前用伪代码来测试这个想法。

设计模式可以是一组方便的工具，用于特定情况，例如需要适配器或将事物组织到状态或策略解决方案中。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T03:16:09.347

是的.. 好吧，当我开始的时候，TDD 并不存在（或者不那么流行）。TDD 会是从问题描述到代码传递的方式吗？...这不是有点高级吗？我的意思是，当一个“未来的”开发人员几乎不了解编程语言是什么时，会不会适得其反？

hamcrest 怎么样从算法到代码的过渡。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-09-26T02:01:30.080

我认为有更好的方式来说明你的问题。

与其将其定义为“系统”，不如定义用户输入和输出方面的预期。

“在一个窗口上，用户应该从列表中选择一个项目，一个盒子应该告诉他它的成本是多少。”

然后，你可以给他一些决定成本的因素，包括样品项目以及它们最终的成本应该是多少。

（这也是一个非常类似于 TDD 的想法）

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2008-09-26T02:59:57.547

请记住，如果您获得 5% 的折扣，然后再获得 5% 的折扣，那么您不会获得 10% 的折扣。相反，您支付 95% 的 95%，即 90.25% 或 9.75% 的折扣。因此，您不应该添加百分比。

# nlp - NLP：构建（小型）语料库，或“从哪里获得大量不太专业的英语文本文件？”

> ID：137380
> 
> 赞同：5
> 
> 时间：2008-09-26T02:15:49.290
> 
> 标签：nlp, linguistics, corpus

有没有人建议在哪里可以找到用于小型语料库的日常英语文本的档案或集合？我一直在使用 Gutenberg Project 书籍作为工作原型，并希望融入更多现代语言。最近的一个[答案](https://stackoverflow.com/questions/122595/nlp-qualitatively-positive-vs-negative-sentence#126378)间接指向了一个很好[的usenet电影评论档案](http://us.imdb.com/Reviews/)，这是我没有想到的，而且非常好。对于这个特定的程序，技术用户网档案或编程邮件列表会使结果倾斜并且难以分析，但任何类型的一般博客文本、聊天记录或任何可能对其他人有用的东西都会非常有帮助。此外，非常感谢没有太多标记的部分或可下载的研究语料库，或者一些用于查找适当的维基百科文章子集或任何其他想法的启发式方法。

（顺便说一句，我是一个下载的好公民，使用故意缓慢的脚本，对托管此类材料的服务器没有要求，以防你认为将我指向一些巨大的东西存在道德风险。）

**更新**：用户 S0rin 指出维基百科不要求抓取，而是提供[此导出工具。](http://en.wikipedia.org/wiki/Special:Export)Project Gutenberg 在[这里](http://www.gutenberg.org/wiki/Gutenberg:Information_About_Robot_Access_to_our_Pages)指定了一个策略，最重要的是，尽量不要爬行，但如果您需要：“将您的机器人配置为在请求之间至少等待 2 秒。”

**更新 2** 维基百科转储是要走的路，感谢指出它们的回答者。我最终从这里使用了英文版本：http: [//download.wikimedia.org/enwiki/20090306/](http://download.wikimedia.org/enwiki/20090306/)，以及大约一半大小的西班牙转储。它们是一些需要清理的工作，但非常值得，并且它们在链接中包含许多有用的数据。

* * *

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T08:32:24.643

*   使用[维基百科转储](http://en.wikipedia.org/wiki/Wikipedia:Database_download)
    *   需要大量清理
*   查看[nltk-data](http://prdownloads.sourceforge.net/nltk/nltk-data-0.9.5.zip)中的任何内容是否对您有帮助
    *   语料库通常很小
*   [古怪](http://wacky.sslmit.unibo.it/doku.php?id=start)的人有一些免费的语料库
    *   标记
    *   你可以使用他们的工具包爬取你自己的语料库
*   [Europarl](http://www.statmt.org/europarl/)是免费的，是几乎所有学术 MT 系统的基础
    *   口语，翻译
*   [路透社语料库](http://trec.nist.gov/data/reuters/reuters.html)是免费的，但只能以 CD 形式提供

您总是可以拥有自己的，但请注意：HTML 页面通常需要大量清理，因此请限制自己使用 RSS 提要。

如果您在商业上这样做，[LDC](http://www.ldc.upenn.edu/)可能是一个可行的替代方案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T08:07:46.213

维基百科听起来像是要走的路。有一个[实验性的 Wikipedia API](http://en.wikipedia.org/w/api.php)可能有用，但我不知道它是如何工作的。到目前为止，我只用自定义蜘蛛甚至`wget`.

然后，您可以搜索在 RSS 提要中提供完整文章文本的页面。RSS，因为没有 HTML 标签妨碍您。

抓取邮件列表和/或 Usenet 有几个缺点：您将获得 AOLbonics 和 Techspeak，这将使您的语料库严重倾斜。

经典语料库是 Penn Treebank 和 British National Corpus，但它们是付费的。您可以阅读[语料库列表档案](http://www.uib.no/mailman/public/corpora/)，甚至可以向他们询问。也许您会使用[Web 作为语料库](http://webascorpus.org/)工具找到有用的数据。

我实际上有一个正在建设的小项目，它允许对任意网页进行语言处理。它应该可以在接下来的几周内使用，但到目前为止，它并不是真正的刮板。但我可以为它写一个模块，我想，功能已经存在了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T22:32:32.513

如果您愿意付钱，您应该查看语言数据联盟（如 Penn Treebank）提供的数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-16T18:26:28.693

维基百科似乎是最好的方法。是的，您必须解析输出。但是由于维基百科的分类，您可以轻松获得不同类型的文章和单词。例如，通过解析所有科学类别，您可以获得很多科学词汇。有关地点的详细信息将偏向于地理名称等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T04:24:06.907

你已经涵盖了明显的那些。我能想到的唯一其他方面也可以补充：

1) 新闻文章/博客。

2) 杂志在网上发布了大量免费材料，您可以获得很好的主题交叉部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-27T00:37:29.617

查看维基百科的数据，我注意到他们[对电视和电影剧本的主体进行了一些分析](http://en.wiktionary.org/wiki/Wiktionary:Frequency_lists#Most_common_words_.28TV_and_movie_scripts.29)。我认为这可能是有趣的文本，但不是很容易获得——事实证明它无处不在，而且它的结构和可预测性足够强，应该可以清理它。 [该站点](http://www.moviescriptsandscreenplays.com/index.html)的标题很有帮助，标题为“网络上一个位置的一堆电影剧本和剧本”，可能对偶然发现此线程并有类似问题的任何人有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-30T12:29:55.960

您可以在此处获取报价内容（有限形式）：http: [//quotationsbook.com/services/](http://quotationsbook.com/services/)

该内容也恰好在 Freebase 上。

# .net - 如何获取文件夹的大小？

> ID：137387
> 
> 赞同：0
> 
> 时间：2008-09-26T02:20:13.570
> 
> 标签：.net, directory

我正在转换一个每天记录文件夹大小的旧应用程序。旧版应用程序使用 Scripting.FileSystemObject 库：

```
Set fso = CreateObject("Scripting.FileSystemObject")
Set folderObject = fso.GetFolder(folder)
size = folderObject.Size 
```

System.IO.Directory 和 System.IO.DirectoryInfo 类没有等效机制。

为了在 .NET 中获得相同的结果，我实际上是否必须递归地遍历整个文件夹结构以保持文件大小的总运行？

更新：@Jonathon/Ed - 谢谢....正如我所想。我想我只会参考 Scripting.FileSystemObject COM 库。即使破坏了我的应用程序的 .NET 纯度，也能正常工作。这是一个内部报告应用程序，所以没什么大不了的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T02:22:55.513

可悲的是，是的……谁知道为什么。

```
public static long DirSize(DirectoryInfo d) 
{    
    long Size = 0;    
    // Add file sizes.
    FileInfo[] fis = d.GetFiles();
    foreach (FileInfo fi in fis) 
    {      
        Size += fi.Length;    
    }
    // Add subdirectory sizes.
    DirectoryInfo[] dis = d.GetDirectories();
    foreach (DirectoryInfo di in dis) 
    {
        Size += DirSize(di);   
    }
    return(Size);  
} 
```

如所见：

[http://msdn.microsoft.com/en-us/library/system.io.directory.aspx](http://msdn.microsoft.com/en-us/library/system.io.directory.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T02:23:37.837

我想你已经知道答案了；您将需要添加目录中的所有文件（以及它的子目录。）我不知道任何内置函数，但是嘿，我不知道一切（甚至不知道）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T02:34:00.010

Mads Kristensen 不久前[发布了](http://madskristensen.net/post/Calculate-the-total-size-of-a-directory-in-C.aspx)关于此的消息……

```
private double size = 0;

private double GetDirectorySize(string directory)
{
    foreach (string dir in Directory.GetDirectories(directory))
    {
        GetDirectorySize(dir);
    }

    foreach (FileInfo file in new DirectoryInfo(directory).GetFiles())
    {
        size += file.Length;
    }

    return size;
} 
```

# c# - 我可以根据编译器版本进行条件编译吗？

> ID：137391
> 
> 赞同：1
> 
> 时间：2008-09-26T02:22:27.370
> 
> 标签：c#, visual-studio-2008

我同时维护 .net 1.1 和 .net 3.5 c# 代码。为此，我创建了两个 csproject 文件，一个用于 .net 1.1，另一个用于 .net 3.5。

现在，在我的源代码中，我添加了仅在 .net 3.5 版本中可用的新功能，但我还希望代码在 VS 2003 中编译，而不需要新功能。无论如何要根据编译器版本进行条件编译吗？

在 C++[中，我可以通过检查](http://itscommonsensestupid.blogspot.com/2008/08/macro-to-check-microsoft-compiler.html)宏 _MSC _VER 的值来做到这一点，但我正在寻找 C# 等价物。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T02:44:29.550

您可以在每个 CSPROJ 文件中定义不同的符号并参考 C# 源代码中的符号。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T02:50:30.347

如果您可以将 3.5 特定代码保存在单独的文件中，您可以简单地在两个 .csproj 文件之间拆分文件分配（或在 NAnt 中使用 2 个不同的构建目标） - 太糟糕的部分类只出现在 2.0 中，否则会使更容易传播代码......

如果需要在文件级别混合代码，[Conditional()] 属性可以过滤掉整个方法，但我不确定编译器是否还会尝试处理方法中的代码。MSDN 说代码不会被编译成 IL 但参数会被类型检查，但我还没有尝试过。更多信息在这里：[http](http://bartdesmet.net/blogs/bart/archive/2006/08/30/4368.aspx) ://bartdesmet.net/blogs/bart/archive/2006/08/30/4368.aspx和 MSDN 链接在这里：http: [//msdn.microsoft.com/en-us/library/ system.diagnostics.conditionalattribute.aspx](http://msdn.microsoft.com/en-us/library/system.diagnostics.conditionalattribute.aspx)

如果可能的话，因为您已经有 2 个项目文件，您可以在每个文件中指定不同的定义来设置版本 - 当您可以自己制作时，无需寻找宏。

# encryption - 密码组合算法

> ID：137392
> 
> 赞同：1
> 
> 时间：2008-09-26T02:22:30.833
> 
> 标签：encryption, passwords, passphrase

我厌倦了记住不同登录的所有密码。最近我发现了一个有趣的工具[密码编辑](http://www.xs4all.nl/~jlpoutre/BoT/Javascript/PasswordComposer/)器，它可以让你根据**主机名**和秘密**主密码生成密码**。但我不想使用网站或安装软件来生成我的密码。

所以我正在寻找一种简单的单向哈希算法，我可以在没有计算机辅助的情况下执行它来生成我的密码。无需卡片即可实现[单人密码](http://en.wikipedia.org/wiki/Solitaire_(cipher))的精神。

使用 PW 商店不是一种选择。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T02:33:25.597

为什么不使用与密码编写器完全相同的算法？

*   选择一个主密码
*   获取您想要密码的应用程序/机器名称
*   连接两者（或随机播放）
*   应用您可以在脑海中执行的代码，例如[凯撒的密码](http://en.wikipedia.org/wiki/Caesar%27s_cipher)
*   取前 X 个字符（15 通常是安全密码的合适长度）

例子：

```
Master Password: kaboom
Machine Name: hal9000
Shuffle: khaablo9o0m00
Transposition table: shift 5 left
abcdefghijklmnopqrstuvwxyz 1234567890
vwxyzabcdefghijklmnopqrstu 6789012345 

Result: fcvvwgj4j5h55 
```

你可以使用尽可能复杂的替换，因为你的头脑可以可靠地做（有或没有纸）。您还可以为每个密码使用不同的表（例如，从每个机器名称的第一个字母中推断出该表）。只要您的主密码是安全的，就无需担心算法的简单性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T02:36:05.637

我曾经做的事情（在我开始使用*pwgen*生成密码之前）是找到附近的纸质文档并使用每行的第一个和最后一个字符。只要您知道哪个文件与哪个帐户一起使用，如果您丢失/忘记了密码，重新生成密码就很容易，并且不需要计算机这样做。（当然，为此使用书籍或其他纸质文件很重要，因为任何电子产品都可能发生变化，然后您就会迷失方向。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T02:45:39.420

首先选择一个人（名人、亲戚、虚构人物或其他）。这个人的身份就是你的私钥，你应该保密。

要为站点生成密码，请将人与站点名称并列并考虑两者。无论你得到什么样的心理形象，用一个令人难忘的短语来总结它，然后花点时间在你的脑海中修复这个形象和短语。该短语是您访问此站点的密码。

（编辑）这种方法的基本原理是任何基于数学的系统要么不安全，要么太复杂而无法在你的脑海中完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T03:47:10.053

主机名的替代字符与您的主密码中的字符，直到您用完主密码字符。

主机名：stackoverflow.com 主密码：homer

新密码：shtoamcekro

我几乎可以在脑海中做到这一点。不需要纸或铅笔。

不要将此系统用于任何非常重要的事情。但是对于您的半打电子邮件、Facebook 和其他随机帐户来说应该没问题。

# sql - SQL Null 设置为零以添加

> ID：137398
> 
> 赞同：10
> 
> 时间：2008-09-26T02:26:02.743
> 
> 标签：sql, ms-access, database-design

我有一个 SQL 查询（MS Access），我需要添加两列，其中任何一列都可能为空。例如：

```
SELECT Column1, Column2, Column3+Column4 AS [Added Values]
FROM Table 
```

其中 Column3 或 Column4 可能为空。在这种情况下，我希望 null 被视为零（so `4 + null = 4, null + null = 0`）。

关于如何做到这一点的任何建议？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T02:29:58.850

由于 Access 中的 ISNULL 是一个布尔函数（一个参数），因此像这样使用它：

```
SELECT Column1, Column2, IIF(ISNULL(Column3),0,Column3) + IIF(ISNULL(Column4),0,Column4) AS [Added Values]
FROM Table 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-03-28T15:14:04.697

根据[Allen Browne](http://allenbrowne.com/QueryPerfIssue.html)的说法，最快的方法是使用`IIF(Column3 is Null; 0; Column3)`，因为`NZ()`和`ISNULL()`都是 VBA 函数，调用 VBA 函数会减慢 JET 查询的速度。

我还要补充一点，如果您使用链接的 SQL Server 或 Oracle 表，IIF 语法也是要在服务器上执行的查询，如果您使用 VBA 函数则不是这种情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T16:28:07.907

更清洁的是 nz 功能

```
nz (column3, 0) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T02:30:50.377

使用**ISNULL**替换命令：

```
 SELECT Column1, Column2, ISNULL(Column3, 0) + ISNULL(Column4, 0) AS [Added Values]FROM Table 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-27T06:00:45.207

VBA 中的 Nz() 函数可用于您的 MS Access 查询。

此函数将 NULL 替换为给定参数中的值。

```
SELECT Column1, Column2, Nz(Column3, 0) + Nz(Column4, 0) AS [Added Values]
FROM Table 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-10-28T17:59:55.353

在表定义中，将 Column3 和 Column4 的默认值设置为零，因此当在这些列中添加没有值的记录时，列值将为零。因此，您永远不必担心查询中的空值。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-26T12:30:00.333

使用 COALESCE。

```
SELECT 
   Column1, 
   Column2, 
   COALESCE(Column3, 0) + COALESCE(Column4, 0) AS [Added Values]
FROM Table 
```

# unit-testing - 没有断言的单元测试

> ID：137399
> 
> 赞同：31
> 
> 时间：2008-09-26T02:26:24.833
> 
> 标签：unit-testing, assert

偶尔我会遇到一个不断言任何东西的单元测试。我今天早上遇到的特定示例是测试在满足条件时写入日志文件。假设是，如果没有抛出错误，则测试通过。

我个人对此没有任何问题，但是编写一个没有任何相关断言的单元测试似乎有点“代码味道”。

只是想知道人们对此有何看法？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-26T02:32:45.193

这只是一个非常简单的测试，应该这样记录。它只验证它在运行时不会爆炸。像这样的测试最糟糕的部分是它们呈现出一种错误的安全感。你的代码覆盖率会上升，但这是虚幻的。非常难闻的气味。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-26T02:39:07.127

这将是官方的做法：

```
// Act
Exception ex = Record.Exception(() => someCode());

// Assert
Assert.Null(ex); 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-26T03:32:11.493

如果没有断言，则不是测试。

别再偷懒了——可能需要一点时间来弄清楚如何在那里获得断言，但是知道它做了你期望它做的事情是值得的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-26T02:40:44.190

这样的测试有味道。它应该检查文件是否被写入，至少修改时间可能已更新。

我见过很多以这种方式编写的测试，但最终根本没有测试任何东西，即代码不起作用，但它也没有崩溃。

如果您有一些明确的要求，即被测代码不会引发异常，并且您想明确指出这一事实（测试作为需求文档），那么我会做这样的事情：

```
try
{
  unitUnderTest.DoWork()
}
catch
{
  Assert.Fail("code should never throw exceptions but failed with ...")
} 
```

...但这对我来说仍然有点味道，可能是因为它试图证明是负面的。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-26T03:24:36.207

这些被称为**烟雾测试**并且很常见。它们是基本的健全性检查。但它们不应该是你唯一的测试类型。您仍然需要在另一个测试中进行某种验证。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T02:35:35.793

这可能是一个很好的务实解决方案，特别是如果替代方案根本没有测试。

问题是，如果所有调用的函数都是无操作的，那么测试就会通过。但有时验证副作用是否符合您的预期是不可行的。在理想的世界里，有足够的时间为每个测试写检查......但我不住在那里。

我使用此模式的另一个地方是在单元测试中嵌入一些性能测试，因为这是让它们在每次构建时运行的简单方法。测试不断言任何东西，但测量测试花费了多长时间并记录下来。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T02:29:53.843

从某种意义上说，您正在做出隐式断言 - 代码不会引发异常。当然，实际抓取文件并找到合适的行会更有价值，但我认为有总比没有好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T02:30:37.443

一般来说，我在集成测试中看到了这种情况，只是成功完成的事情就足够了。在这种情况下，我很冷静。

*我想如果我在单元测试*中一遍又一遍地看到它，我会很好奇这些测试到底有多有用。

编辑：在 OP 给出的示例中，有一些可测试的结果（日志文件结果），因此假设如果没有抛出错误，那么它的工作是惰性的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T02:48:30.303

我们一直这样做。我们使用 JMock 模拟我们的依赖关系，所以我猜在某种意义上 JMock 框架正在为我们做断言......但它是这样的。我们有一个要测试的控制器：

```
Class Controller {
  private Validator validator;

  public void control(){
    validator.validate;
  }

  public setValidator(Validator validator){ this.validator = validator; }
} 
```

现在，当我们测试 Controller 时，我们不想测试 Validator，因为它有自己的测试。所以我们使用 JMock 进行了测试，以确保我们调用了 validate：

```
public void testControlShouldCallValidate(){
  mockValidator.expects(once()).method("validate");
  controller.control;
} 
```

仅此而已，没有“断言”可看，但是当您调用控制并且未调用“验证”方法时，JMock 框架会向您抛出异常（类似于“未调用预期方法”之类的东西）。

我们到处都有。这有点倒退，因为您基本上设置了断言然后调用测试方法。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T03:22:37.850

我以前见过这样的事情，我认为这样做只是为了支持代码覆盖率。它可能并没有真正测试代码行为。无论如何，为了清楚起见，我同意它（意图）应该记录在测试中。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-01T07:36:38.843

我有时会使用我选择的单元测试框架 (NUnit) 来构建充当我代码特定部分的入口点的方法。这些方法对于分析代码子集的性能、内存消耗和资源消耗非常有用。

这些方法绝对不是单元测试（即使它们被标记为*[Test]*属性），并且在它们被检入源代码控制时总是被标记为被忽略并明确记录。

我也偶尔将这些方法用作 Visual Studio 调试器的入口点。我使用 Resharper 直接进入测试，然后进入我想要调试的代码。这些方法要么不能达到源代码控制，要么它们获得了自己的断言。

我的“真实”单元测试是在正常的 TDD 周期中构建的，它们总是断言一些东西，尽管并不总是直接的——有时断言是模拟框架的一部分，有时我能够将类似的断言重构为一个方法。这些重构方法的名称总是以前缀“Assert”开头，以使其对我来说很明显。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-07-01T19:20:50.023

测试的名称应记录这一点。

```
void TestLogDoesNotThrowException(void) {
    log("blah blah");
} 
```

测试如何验证日志是否在没有断言的情况下写入？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T02:35:43.767

我不得不承认我从来没有写过一个单元测试来验证我的日志记录是正确的。但我确实考虑过，并遇到了[关于](http://www.mail-archive.com/log4j-user@logging.apache.org/msg08646.html)如何使用 JUnit 和 Log4J 完成它的讨论。它不太漂亮，但看起来它会起作用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T02:46:49.793

测试应该总是断言一些东西，否则你要证明什么，你如何能一致地重现你的代码有效的证据？

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-09-08T17:57:42.270

我会说没有断言的测试表明以下两件事之一：

1.  没有测试代码的重要行为的测试，或者
2.  没有任何重要行为的代码，可能会被删除。

# 事情 1

这个线程中的大多数评论都是关于第 1 件事的，我同意如果被测代码有任何重要的行为，那么应该可以编写测试来断言该行为，或者通过

1.  断言函数/方法返回值，
2.  断言对“测试双重”依赖项的调用，或
3.  断言可见状态的变化。

如果被测代码具有重要的行为，但没有断言该行为的正确性，那么测试是有缺陷的。

您的问题似乎属于此类别。被测代码应该在满足条件时记录。所以至少有两个测试：

*   鉴于条件满足，当我们调用该方法时，是否会发生日志记录？
*   假设条件不满足，那么当我们调用该方法时，日志不会发生吗？

测试需要一种方法来安排代码的状态，以便满足或不满足条件，并且需要一种方法来确认是否发生了日志记录，可能有一些日志记录“测试替身”刚刚记录了日志调用（人们经常为此使用模拟框架。）

# 事情 2

那么那些缺少断言的其他测试怎么样，但这是因为被测代码没有做任何重要的事情？我会说需要一个判断电话。在具有高代码速度（每天许多提交）和许多同时贡献者的大型代码库中，有必要在小提交中增量地交付代码。这是这样的：

1.  您的代码审阅者不会被大型复杂的提交所淹没
2.  你避免合并冲突
3.  如果它导致错误，很容易恢复您的提交。

在这些情况下，我添加了“占位符”类，它们没有做任何有趣的事情，但为接下来的实现提供了结构。现在添加这个类，甚至在其他类中使用它，可以帮助向审阅者展示这些部分如何组合在一起，即使新类的重要行为尚未实现。

那么，如果我们假设这些占位符适合添加，我们应该测试它们吗？这取决于。至少，您需要确认该类在语法上是有效的，并且可能它的任何附带行为都不会导致未捕获的异常。

举些例子：

*   Python 是一种解释型语言，因此您的持续构建可能无法确认您的占位符类在语法上是否有效，除非它将代码作为测试的一部分执行。
*   您的占位符可能具有偶然行为，例如日志记录语句。这些行为不够重要，不能断言，因为它们不是类行为的重要组成部分，但它们是异常的潜在来源。大多数测试框架将未捕获的异常视为错误，因此通过在测试中执行此代码，您可以确认偶然行为不会导致未捕获的异常。

我个人认为，这种推理支持在代码库中临时包含无断言测试。也就是说，这种情况应该是暂时的，占位符类应该很快就会收到更完整的实现，或者应该将其删除。

最后一点，我认为仅仅为了满足“所有测试都必须有断言”的形式主义而包含关于偶然行为的断言不是一个好主意。您或其他作者可能会忘记删除这些形式主义的断言，然后它们会用非必要行为的断言使测试变得混乱，从而分散对重要断言的关注。我们中的许多人可能都熟悉当你遇到一个测试的情况，你看到一些看起来不属于它的东西，我们说，“我真的很想删除它.​​.....但这没有任何意义为什么它在那里。所以它可能因为一些潜在的模糊和重要原因而存在，原作者忘记记录。我可能应该留下它，以便我 1）尊重原作者的意图，以及 2）不要[切斯特顿的栅栏](https://fs.blog/2020/03/chestertons-fence/)。）

# asp.net - 工作线程和 I/O 线程有什么区别？

> ID：137400
> 
> 赞同：27
> 
> 时间：2008-09-26T02:27:00.417
> 
> 标签：asp.net, multithreading, web-config, processmodel

查看 Web.Config 中的 processmodel 元素，有两个属性。

```
maxWorkerThreads="25" 
maxIoThreads="25" 
```

工作线程和 I/O 线程有什么区别？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-26T02:35:57.650

基本上不是很多，这都是关于 ASP.NET 和 IIS 如何分配 I/O 等待对象以及管理网络通信和传输数据的争用和延迟。

I/O 线程被搁置一旁，因为它们将执行 I/O（顾名思义）并且可能必须等待“长时间”（数百毫秒）。它们还可以进行优化和以不同方式使用，以利用 Windows 内核中的 I/O 完成端口功能。单个 I/O 线程可能正在管理多个完成端口以维持吞吐量。

Windows 有很多处理 I/O 阻塞的功能，而 ASP.NET/.NET 有一个简单的“线程”概念。ASP.NET 可以通过使用操作系统中更多的非托管线程功能来优化 I/O。您不希望一直对每个线程都这样做，因为您失去了 .NET 为您提供的许多功能，这就是为什么线程的使用方式之间存在区别的原因。

工作线程是发生常规“工作”或仅发生普通代码/处理的线程。工作线程不太可能阻塞很多或等待任何东西，并且运行时间很短，因此需要更积极的调度来最大化处理能力和吞吐量。

[编辑]：我还发现了这个与这个问题特别相关的链接：http: [//blogs.msdn.com/ericeil/archive/2008/06/20/windows-io-threads-vs-managed-io-threads .aspx](http://blogs.msdn.com/ericeil/archive/2008/06/20/windows-i-o-threads-vs-managed-i-o-threads.aspx)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-26T03:07:42.660

只是添加到 chadmyers... 似乎 I/O 线程是 ASP.NET 服务请求的旧方式，

> “IIS 5.0 中的请求通常通过 I/O 线程或执行异步 I/O 的线程提供服务，因为使用对命名管道的异步写入将请求分派到工作进程。”

使用 IIS6.0，这已经改变。

> “因此，所有请求现在都由从 CLR 线程池中提取的工作线程提供服务，而不是在 I/O 线程上。”

来源： http: [//msdn.microsoft.com/hi-in/magazine/cc164128 (en-us).aspx](http://msdn.microsoft.com/hi-in/magazine/cc164128(en-us).aspx)

# .net - .NET 中有没有办法以编程方式监听 HTTP 流量？

> ID：137407
> 
> 赞同：2
> 
> 时间：2008-09-26T02:29:31.143
> 
> 标签：.net, http, proxy, automation, winpcap

我正在使用浏览器自动化来测试网站，但我需要验证来自浏览器的 HTTP 请求（即图像、外部脚本、XmlHttpRequest 对象）。有没有办法以编程方式实例化代理或数据包嗅探器以供浏览器使用，以查看其发送的内容？

我已经在使用 Fiddler 来查看流量，但我想要一些可以在持续构建集成中使用的无 UI 的东西。

我可以轻松地从 WinpCap 获取特定于 HTTP 的信息吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T03:38:23.287

试试 winpcap 。它是一个驱动程序/库组合，可用于监控数据包。根据您要执行的操作（使用 oa UI 观察流量），这可能是比编写自己的代理更简单的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T04:07:50.893

您可能不想代理，这会引入很多不必要的复杂性。

考虑使用**数据包嗅探**，这几乎是一个已解决的问题。[Wireshark](http://wireshark.org)作为一个可以手动使用的独立实用程序非常方便，但也可以使用 Wireshark 所基于的库 WinPcap 以编程方式进行数据包嗅探。这是 .Net 中的几个 WinPcap 示例、[.NetNomad 的示例项目示例](http://geekswithblogs.net/dotnetnomad/archive/2008/01/31/119140.aspx)和[CodeProject 教程](http://www.codeproject.com/KB/IP/dotnetwinpcap.aspx)，也有源代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T03:48:24.480

为此有许多应用程序。我的推荐是[Wireshark](http://www.wireshark.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T02:40:01.057

您是否考虑过实现 Http 模块或 Http 处理程序 (.ashx)？它们将允许您拦截每个 Web 请求并在访问您的页面之前根据需要处理它们。

# sql-server - 使用客户端报告与服务器端报告？

> ID：137422
> 
> 赞同：4
> 
> 时间：2008-09-26T02:33:45.970
> 
> 标签：sql-server, reporting-services, reporting

我们什么时候使用客户端报告，什么时候使用服务器端报告？

哪种报告是最佳实践（客户端/服务器）？

这与 SSRS 报告有关。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T02:41:49.447

好吧...如果您有类似 winforms 客户端的东西，但您不能保证能够持续访问数据源，您将使用客户端报告。它可能在客户端缓存了一组数据，即使与服务器的连接不可用，您也需要报告这些数据。

您将在需要简化报告分发和部署的场景中使用服务器端报告，因为您只需将报告部署到一个地方并且每个人都可以访问它们。这具有始终要求服务器可以使用连接的缺点

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T03:51:14.990

当您的客户从不同的来源收集数据时，客户端报告也很方便。我们有一个内部企业应用程序，它调用内部服务从财务和我们单独的生产数据库中获取数据，并将它们组合成一个数据集，然后传递给 ReportViewer 控件。

从美学的角度来看，将报告集成到应用程序中很好，这样用户就不会觉得他们正在离开应用程序来打印或导出应用程序的数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:17:54.983

**客户现场报告**

如果以下情况之一为真，那么您应该使用客户端站点报告：

*   如果您只有在客户端上而不是在网络或服务器上的数据。这主要适用于桌面应用程序。
*   没有服务器（家庭系统）。

**服务器站点报告**

如果以下情况之一为真，那么您应该使用服务器站点报告：

*   数据位于服务器上或网络中的静态位置。
*   您只有瘦客户端。
*   报告应按计划进行。
*   单个服务器的许可成本低于许多桌面安装。
*   报告模板是共享的，并且可以经常更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-03T00:26:50.173

在这种情况下，这取决于您所说的“服务器”。当您提到 SSRS 时，我假设您将数据库（SQL Server）视为服务器。

这完全取决于应用程序/项目结构和要求。如果您有一个还包含业务逻辑（存储过程）的数据库，并且您只想查询数据并显示/导出它，那么 SSRS 很方便。

但是，如果您有一个带有持久层（数据库）的 Web 应用程序，它只存储信息并确保信息是一致的，但是您的业务逻辑例如在查询/维护的 Web API（即：RESTful API 项目）中数据库数据（CRUD）并添加一些逻辑，然后将请求的结果/信息（即：使用 JSON）响应 HTTP 请求到丰富的前端，然后我将在客户端（前端）添加报告功能 for例如在浏览器中执行的 Javascript 库，它能够以任何方式显示检索到的数据，它能够将其导出到 DOC、Excel、电子邮件等。

典型 Web 应用程序的关注点分离：

*   持久层（数据库）存储信息并保证一致性
*   业务层（后端 RESTful API）对每个 HTTP 请求的资源、计算、身份验证、授权执行所有智能操作。
*   丰富的前端（Javascript + HTML + CSS）与用户交互并向后端请求/显示信息。**作为显示信息的一部分**，这个前端也会生成报告。

# .net - 如何在 .NET 中自动化 Web 代理以进行单元测试（包括设置和拆除）？

> ID：137425
> 
> 赞同：1
> 
> 时间：2008-09-26T02:34:27.637
> 
> 标签：.net, unit-testing, proxy, automation, browser-automation

遵循 Jonathan Holland 在他对我之前的问题的评论中的建议：[.NET 中有没有办法以编程方式监听 HTTP 流量？](https://stackoverflow.com/questions/137360/is-there-any-way-in-net-to-programmatically-listen-to-http-traffic)对于我*真正*想知道的问题，我提出了一个单独的（但不完全是重复的）问题：

**如何在 .NET 中自动化 Web 代理以进行单元测试**（包括设置和拆除），以监视来自浏览器的 HTTP 流量（尤其是请求页面上的图像、脚本和 XmlHttpRequest）？

我更喜欢零设置（所以没有在 Windows 上安装 Fiddler），可以说，所有东西都可以从程序集中解包、部署，然后无痕迹地删除。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T02:41:33.253

滚动您自己的直通代理，然后让您的测试工具在代理的管理端口上发出配置命令。代理将尽职尽责地将任何正常连接路由到指定的 ip:port，并使用最少的“设置”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-06T04:07:07.230

WebAii 2.0 有一个内置的 HTTP 代理：

[http://www.artoftest.com/community/blogs/09-03-25/WebAii_2_0_Beta_Released.aspx](http://www.artoftest.com/community/blogs/09-03-25/WebAii_2_0_Beta_Released.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T02:42:01.893

如果您想控制类似浏览器的请求并查看从受刺激的 Web 浏览器到本地主机的请求和标头，您可以使用[System.Net.WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient(VS.80).aspx)

如果您想要一个使用完整代理检测的 .NET 解决方案，请查看此 MSDN 文章：http: [//msdn.microsoft.com/en-us/magazine/cc300743.aspx](http://msdn.microsoft.com/en-us/magazine/cc300743.aspx)。它解释了如何与[Fiddler等代理集成](http://www.fiddlertool.com/fiddler/)

在使用任何这些解决方案之前，我强烈建议您查看您的单元测试以及您要完成的工作。完整的代理解决方案通常超出单元测试的范围，您可能希望稍微缩小测试规模。

但是，如果您正在编写集成测试，那么这些解决方案应该可以很好地为您服务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T03:03:10.503

我不确定它是否是您正在寻找的东西，但这里有一个使用 selenium 进行 ASP.NET 单元测试的示例。 [http://www.stevetrefethen.com/blog/AutomatedTestingOfASPNETWebApplicationsUsingSelenium.aspx](http://www.stevetrefethen.com/blog/AutomatedTestingOfASPNETWebApplicationsUsingSelenium.aspx)

# language-agnostic - 如何在我的程序中将游戏地图的图像文件转换为边界？

> ID：137443
> 
> 赞同：0
> 
> 时间：2008-09-26T02:41:33.270
> 
> 标签：language-agnostic

我有一张基本游戏地图的图像。将其视为无法跨越的水平和垂直墙壁。如何轻松地从墙壁的 png 图像转换为代码中的东西？

困难的方法非常简单……只是如果我更改图像映射，我想要一种简单的方法将其转换为代码。

谢谢！

编辑：地图不是基于瓷砖的。它是自上而下的 2D。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T02:43:55.587

我需要更多细节。

你的游戏是基于瓷砖的吗？是3d吗？

如果它基于图块，您可以将图像下采样到图块分辨率，然后进行 1:1 转换，每个像素代表一个图块。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T02:55:55.620

我建议编写一个脚本，获取每个单独的像素并确定它是否代表墙壁的一部分（即黑色或白色）。然后，对您的游戏进行编码，以便由像素表示的单个小块构建墙壁。应该不会太难...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T02:59:40.823

我涉足电子游戏，我个人不想在地图上检查图片边界的麻烦。如果这些墙是恰好具有图像属性（或类似属性）的对象，那不是更干净吗？图像会显示，但对象将具有明确定义的坐标，并且函数可以决定每次玩家移动时是否击中对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T02:55:34.157

如果您不需要使用地图信息预先计算任何内容。您可以使用 getPixel(x,y) 之类的函数检查运行时逻辑。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T11:21:33.707

好吧，根据您的图形来自哪里，我可以看到两种不同的“最佳解决方案”：

1.  您的图形是平铺的，因此您可以轻松“识别”一个块，因为它使用与其他块相同的图形，您所要做的就是一个程序，当给出“块块”列表和地图时可以生成通过将每个图块与“阻止列表”中的图块进行比较来生成“碰撞图”。

2.  您的图形只是一些图形（例如，它可能是图片或一些 CG 图形），您不希望一个块的像素与另一个块的像素相同。您仍然可以尝试在您的图片上应用“边缘检测”算法，但我的猜测是您应该将图片拆分为 BG 层和 FG 层，以便 FG 层具有预定义的颜色（或 alpha =0) 并针对该颜色测试像素以定义物体是否阻塞。

3.  您没有太多的阻塞形状，但它们通常很复杂（多边形、椭圆），并且使用世界的位图渲染或打包为“平铺属性”会效率不高。例如，点击式冒险游戏通常就是这种情况。在这种情况下，您可能会使用矢量绘图程序创建与您的边界匹配的路径，并挖掘一个进行多边形相交或贝塞尔碰撞的库。

祝好运并玩得开心点。

# c# - C#中的冗余？

> ID：137448
> 
> 赞同：12
> 
> 时间：2008-09-26T02:43:28.037
> 
> 标签：c#, .net, generics, programming-languages

采取以下代码段：

```
List<int> distances = new List<int>(); 
```

冗余是语言设计者的意图吗？如果是这样，为什么？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-09-26T03:07:56.340

代码看起来冗余的原因是，对于新手程序员来说，它似乎定义了两次相同的东西。但这不是代码正在做的事情。它定义了两个恰好属于同一类型的独立事物。它定义了以下内容：

1.  一个名为 distances 类型的变量`List<int>`。
2.  类型堆上的一个对象`List<int>`。

考虑以下：

```
Person[] coworkers = new Employee[20]; 
```

这里的非冗余更清楚，因为变量和分配的对象是两种不同的类型（如果对象的类型派生自或实现变量的类型，这种情况是合法的）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-26T02:49:47.150

这有什么多余的？

```
List<int> listOfInts = new List<int>(): 
```

翻译成英文：（编辑，为澄清一点）

*   创建一个 List<int> 类型的指针并将其命名为 listofInts。
*   listOfInts 现在已创建，但它只是一个指向无处的引用指针（null）
*   现在，在堆上创建一个 List<int> 类型的对象，并返回指向 listOfInts 的指针。
*   现在 listOfInts 指向堆上的 List<int>。

当您考虑它的作用时，并不是很冗长。

当然还有一个替代方案：

```
var listOfInts = new List<int>(); 
```

这里我们使用的是C#的类型推断，因为你是马上给它赋值的，C#可以通过刚刚在堆中创建的对象来判断你想要创建什么类型。

要完全理解 CLR 如何处理类型，我建议阅读[CLR Via C#](http://www.microsoft.com/MSPress/books/6522.aspx)。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-26T02:44:49.173

你总是可以说：

```
 var distances = new List<int>(); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-26T12:19:49.297

正如其他人所说：`var`消除了冗余，但它具有*潜在*的负面维护后果。我想说它也有潜在*的积极*维护后果。

幸运的是，Eric Lippert 写的比我更有说服力： http://csharpindepth.com/ViewNote.aspx? [NoteID =](http://csharpindepth.com/ViewNote.aspx?NoteID=61) [63 http://cshapindepth.com/ViewNote.aspx?NoteID=61](http://csharpindepth.com/ViewNote.aspx?NoteID=63)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T03:01:10.350

因为声明类型不一定与初始化它有任何关系。

我可以声明

```
List<int> foo; 
```

并留待稍后初始化。那么冗余在哪里？也许它从另一个函数（如 BuildList()）接收值。

正如其他人提到的那样，新的 var 关键字可以让您解决这个问题，但是您*必须*在声明时初始化变量，以便编译器可以判断它是什么类型。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T03:09:36.103

与其认为它是多余的，不如将该构造视为一种功能，以使您可以节省一行。

而不是拥有

列出距离；距离 = 新列表（）；

c# 让您将它们放在一行中。

一行说“我将使用一个名为*distances*的变量，它将是 List 类型。” 另一行说“分配一个新列表并调用无参数构造函数”。

是不是太多余了？也许。这样做会给你一些东西，虽然

**1** . 将变量声明与对象分配分开。允许：

```
IEnumerable<int> distances = new List<int>();
// or more likely...
IEnumerable<int> distances = GetList(); 
```

**2.**它允许编译器进行更强大的静态类型检查 - 当您的声明与分配不匹配时给出编译器错误，而不是运行时错误。

编写软件都需要这两者吗？不，有很多语言不这样做，和/或在许多其他方面有所不同。

*“医生！我这样做的时候很痛！” - “不要再那样做了”*

如果你发现你不需要或不想要 c# 给你的东西，试试其他语言。即使您不使用它们，了解其他人也可以极大地促进您解决问题的方式。如果您确实使用了一个，那就太好了！

无论哪种方式，您都可以找到足够的视角让自己说“我不需要 c# 编译器强制执行的严格静态类型检查。我将使用 python”，而不是抨击 c# 过于多余。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-07T20:25:47.687

还可以这样做：

```
var distances = new List<int>(); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T02:49:47.697

C# 3.0（对应于 .Net 3.5）的编译器改进消除了一些此类事情。所以你的代码现在可以写成：

```
var distances = new List<int>(); 
```

更新后的编译器在根据语句中的附加信息确定类型方面要好得多。这意味着您需要为赋值或作为泛型的一部分指定类型的实例更少。

话虽如此，仍有一些地方可以改进。其中一些是 API，而一些仅仅是由于强类型的限制。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-26T03:10:02.060

冗余本身并不是有意的，而是所有变量和字段都需要具有类型声明这一事实的副作用。当您考虑到所有对象实例化也在*新*表达式中提到类型的名称时，您会得到看起来多余的语句。

现在使用**var**关键字进行类型推断，可以消除冗余。编译器足够聪明，可以弄清楚。下一个 C++ 也有一个**auto**关键字可以做同样的事情。

**不过，他们引入var**的主要原因是针对没有名称的匿名类型：

```
var x = new {Foo = Bar, Number = 1}; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-08T14:22:06.003

如果您将它与动态类型语言进行比较，它只是“冗余”。它对于多态性和在编译时查找错误很有用。此外，它使代码自动完成/智能感知更容易为您的 IDE（如果您使用一个）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T02:45:42.883

添加功能支持后，C# 肯定会变得不那么冗长。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-26T02:46:05.690

静态类型/C语法的历史神器；比较 Ruby 示例：

```
distances = [] 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-29T01:31:40.250

如果读者很清楚类型是什么，请使用 var。

```
//Use var here
var names = new List<string>();

//but not here
List<string> names = GetNames(); 
```

来自微软[C# 编程指南](http://msdn.microsoft.com/en-us/library/bb384061.aspx)

> 当变量的特定类型在键盘上输入繁琐，或者很明显，或者不增加代码的可读性时，var 关键字也很有用

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T02:54:18.107

您的特定示例确实有点冗长，但在大多数方面 C# 相当精简。

我更喜欢这个（C#）

```
int i; 
```

对此（VB.NET）

```
Dim i as Integer 
```

现在，您选择的特定示例通常是关于 .NET 的，这有点偏长，但我认为这不是 C# 的错。也许这个问题应该改写为“为什么 .NET 代码如此冗长？”

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-08T08:50:29.260

我看到使用 var 来解决这样的懒惰的另一个问题

```
var names = new List<string>(); 
```

如果您使用 var，则名为“names”的变量的类型为，`List<string>,`但您最终只会使用继承的接口之一`List<T>.`

```
IList<string> = new List<string>();
ICollection<string> = new List<string>();
IEnumerable<string> = new List<string>(); 
```

您可以自动使用所有这些，但是您是否可以考虑在编写代码时想要使用什么接口？

在此示例中， var 关键字不会提高可读性。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-05-04T17:53:22.923

在这个问题的许多答案中，作者都​​像编译器或辩护者一样思考。良好编程的一个重要规则是**不要重复自己！**

避免这种不必要的重复是 Go 的[明确设计目标](http://golang.org/doc/go_lang_faq.html#principles)，例如：

> 使用declare-and-initialize 构造`foo.Foo* myFoo = new(foo.Foo)`的简单类型派生可以减少口吃 ( )。`:=`

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-09-26T02:45:32.417

因为我们沉迷于编译器和编译器错误。

# html - 包含所有子元素的悬停 CSS

> ID：137449
> 
> 赞同：29
> 
> 时间：2008-09-26T02:43:33.687
> 
> 标签：html, css

我有一个带有悬停样式的可拖动 div 元素。这很好用，但 div 包含一些表单元素（标签、输入）。问题是当鼠标悬停在这些子元素上时，悬停被禁用。

```
<div class="app_setting">
  <label">Name</label>
  <input type="text" name="name"/>
</div>

.app_setting:hover {
  cursor:move;
} 
```

任何想法如何让悬停也适用于子元素？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-26T02:47:32.613

```
.app_setting *:hover { cursor:move } 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-26T02:55:35.340

至少有两种方法：

*   `*`根据 garrow 的建议，为每个子项显式或使用选择器悬停状态`.class *:hover`
*   级联悬停状态给孩子`.class:hover *`

应该还有其他

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T03:31:19.407

这不是一个 CSS 答案，但它可能对您仍然有用。

其他人已经建议您可能不得不求助于 javascript 以实现浏览器兼容性。如果您确实使用 javascript，则可以使用 jquery 库来简化它。

`$(".appsetting").hover(hoverInFunc,hoverOutFunc);`

`$()`这设置了一个事件处理程序，用于在调用中与 css 样式选择器匹配的选定元素中悬停进出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T03:15:11.050

您可能不得不求助于 JS 来实现 IE6。

# sql-server - 如何将 SQL Server 2005 更改为区分大小写？

> ID：137452
> 
> 赞同：7
> 
> 时间：2008-09-26T02:43:55.837
> 
> 标签：sql-server

我讨厌数据库中区分大小写，但我正在为使用它的客户开发。如何在我的 SQL Server 上打开此选项，以便确保我在所有查询中都得到了正确的案例？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T02:51:30.903

如果在需要区分大小写的表或列上声明排序规则，则实际上不需要更改整个数据库的排序规则。事实上，您实际上可以根据需要将其附加到各个操作中。

```
SELECT name WHERE 'greg' = name COLLATE Latin1_GENERAL_CS_AS

```

我知道，您说过您希望将其应用于整个数据库。但是我提到这一点是因为在某些托管环境中，您无法控制此属性，该属性是在创建数据库时设置的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-26T02:58:37.300

怎么样：

```
ALTER DATABASE database_name COLLATE collation_name 
```

请参阅 BOL 以获取[整理选项列表](http://msdn.microsoft.com/en-us/library/ms144250(SQL.90).aspx)并选择最适合您需要的区分大小写的选项（即您的客户正在使用的选项）。
显然，在尝试之前对数据库进行完整备份可能是个好主意。我从来没有亲自尝试使用与服务器默认排序规则不同的排序规则的数据库，所以我不知道任何“陷阱”。但是，如果您有良好的备份并在将其部署到您的客户端之前在您的环境中对其进行测试，我无法想象这会涉及多少风险。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T11:33:49.003

如果您的数据库与实例默认的排序规则不同，则在尝试将表与临时表连接时可能会遇到问题。临时表必须对实例进行排序（因为它们是系统对象），因此您需要在联接中使用**COLLATE database_default**子句。

```
select temp.A, table.B
from #TEMPORARY_TABLE temp inner join table
on temp.X COLLATE database_default = table.Y 
```

这会强制将 temp.X（在此示例中）的排序规则转换为当前 DB 的排序规则。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T02:46:16.440

您必须更改数据库排序规则。您还需要更改表和列级别的排序规则。我相信如果你用谷歌搜索，你可以找到一个脚本。

# c# - “私人”修饰符有什么作用？

> ID：137454
> 
> 赞同：29
> 
> 时间：2008-09-26T02:44:44.667
> 
> 标签：c#, .net, private, access-modifiers, private-members

考虑到“private”是类成员的默认访问修饰符，为什么甚至需要关键字？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-09-26T12:11:29.083

这里有一定数量的错误信息：

> “默认访问修饰符不是私有的而是内部的”

嗯，这取决于你在说什么。对于一个类型的成员，它是私有的。对于顶级类型本身，它是内部的。

> “私有只是类型上*方法*的默认值”

*不，它是类型的所有成员*的默认值——属性、事件、字段、运算符、构造函数、方法、嵌套类型以及我忘记的任何其他内容。

> “实际上，如果未使用访问修饰符声明类或结构，则默认为内部”

仅适用于顶级类型。对于嵌套类型，它是私有的。

除了限制一个部分而不是另一部分的属性访问之外，默认值基本上总是“尽可能限制”。

就个人而言，我在是否明确的问题上犹豫不决。使用默认值的“优点”是它突出显示您正在制作的东西比最严格的级别更明显的任何地方。明确指定它的“优点”是对于不了解上述规则的人来说更明显，并且表明您已经考虑了一点。

Eric Lippert 采用显式形式，我也开始采用这种方式。

请参阅[http://cshapindepth.com/viewnote.aspx?noteid=54](http://web.archive.org/web/20160307023117/http://csharpindepth.com/viewnote.aspx?noteid=54)了解更多信息。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-26T02:46:27.983

它是给你（和未来的维护者）的，而不是编译器。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-26T02:47:07.623

明确性。我从不使用默认值，总是显式添加修饰符。

这可能是因为我的 Java 背景默认是“包”（大致相当于 C# 中的“内部”），所以这种差异一直困扰着我。我发现明确性更可取。

我现在也使用 ReSharper，它默认是显式的，所以它只会确认和加强我的偏见:)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-26T02:53:33.880

private 修饰符解释意图。

私有成员变量不适用于类外的直接操作。可能会或可能不会为变量创建 get/set 访问器。

私有方法不打算在类外使用。这可能仅适用于内部功能。或者您可以将默认构造函数设为私有，以防止在不传入值的情况下构造类。

private 修饰符（和其他类似的修饰符）可能是编写自文档代码的有用方式。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-26T05:53:04.260

*正如 Jon Skeet 在他的《 C# In Depth*》一书中所指出的， C#中有一个地方需要 private 关键字才能达到效果。

如果我没记错的话，private 关键字是创建私有作用域的属性 getter 或 setter 的唯一方法，当它的对立面具有大于私有可访问性时。例子：

```
public bool CanAccessTheMissileCodes
{
    get { return canAccessTheMissileCodes; }
    private set { canAccessTheMissileCodes = value; }
} 
```

*需要*private 关键字来实现这一点，因为附加的属性可访问性修饰符只能缩小范围，不能扩大范围。（否则，可能已经能够创建一个私有（默认）属性，然后添加一个公共修饰符。）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-26T03:14:26.450

Private 只是类型上*方法*的默认值，但 private 修饰符在其他地方使用。

来自[C# 语言规范 3.0 (msdn)](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)第 3.5.1 节

> 根据成员声明发生的上下文，仅允许某些类型的声明可访问性。此外，当成员声明不包含任何访问修饰符时，发生声明的上下文决定了默认声明的可访问性。
> 
> *   命名空间隐含地具有公开声明的可访问性。命名空间声明中不允许使用访问修饰符。
> *   在编译单元或命名空间中声明的类型可以具有公共或内部声明的可访问性，并且默认为内部声明的可访问性。
> *   **类成员**可以具有五种声明的可访问性中的任何一种，并且默认为私有声明的可访问性。（请注意，声明为类成员的类型可以具有五种声明的可访问性中的任何一种，而声明为命名空间成员的类型只能具有公共或内部声明的可访问性。）
> *   结构成员可以具有公共、内部或私有声明的可访问性，并且默认为私有声明的可访问性，因为结构是隐式密封的。在结构中引入的结构成员（即不被该结构继承）不能具有受保护或受保护的内部声明的可访问性。（请注意，声明为结构成员的类型可以具有公共、内部或私有声明的可访问性，而声明为命名空间成员的类型只能具有公共或内部声明的可访问性。）
> *   接口成员隐式地具有公开声明的可访问性。接口成员声明中不允许使用访问修饰符。
> *   枚举成员隐含地具有公开声明的可访问性。枚举成员声明中不允许使用访问修饰符。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T02:52:03.837

为了完整性。有些人实际上更喜欢在他们的代码中明确说明他们方法上的访问修饰符。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T02:47:27.530

为了对称并符合喜欢一切都是明确的编码风格（我个人喜欢它......）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T02:49:00.067

一些编码风格建议您首先放置所有“公共”项目，然后是“私人”项目。如果没有“private”关键字，你就不能那样做。

更新：我没有注意到上面的“c#”标签，所以我的回答更多地适用于 C++ 而不是 C#。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T02:56:20.893

使用 private 明确表明您的意图，并为支持您的代码的其他人留下线索；）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T03:52:51.943

我通常将 private 排除在外，但我发现它对排列代码很有用：

```
private   int    x;
public    string y;
protected float  z; 
```

对比：

```
int x;

public    string y;
protected float  z; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-26T06:11:09.553

正如[罗伯特保尔森](https://stackoverflow.com/questions/137454/what-does-the-private-modifier-do#137561)在回答中所说，`private`修饰符不仅用于成员，还用于**类型**。`internal`这变得很重要，因为如果您使用[InternalsVisibleToAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)，类型的默认值可能会意外泄漏。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-26T02:52:12.963

实际上，如果未使用访问修饰符声明类或结构，则默认为内部。

因此，如果您想将其设为私有，请使用私有。

# php - PHP 中的 Null vs. False vs. 0

> ID：137487
> 
> 赞同：153
> 
> 时间：2008-09-26T02:53:10.620
> 
> 标签：php, null

有人告诉我，优秀的开发人员可以发现/利用所有其他优秀的“无”实体`Null`之间`False`的区别。 有什么*区别*，特别是在 PHP 中？有关系吗？`0`
*`===`*

 ** * *

## 回答 #1

> 赞同：233
> 
> 时间：2008-09-26T11:50:05.920

## 它是特定于语言的，但在 PHP 中：

**`Null`**意思是“**什么都没有**”。var 尚未初始化。

**`False`**表示“**在布尔上下文中不正确**”。用于明确表明您正在处理逻辑问题。

**`0`**是一个**`int`**。与上面的其余部分无关，用于数学。

现在，棘手的是，在像 PHP 这样的动态语言*中，它们都在布尔上下文中具有一个值*，（在 PHP 中）是`False`.

如果你用 测试它`==`，它正在测试布尔值，所以你会得到平等。如果你用 测试它`===`，它会测试类型，你会得到不等式。

## 那么它们为什么有用呢？

好吧，看看`strrpos()`功能。如果它没有找到任何东西，它返回 False，但如果它在字符串的开头找到了东西，它返回 0 ！

```
<?php
// pitfall :
if (strrpos("Hello World", "Hello")) { 
    // never exectuted
}

// smart move :
if (strrpos("Hello World", "Hello") !== False) {
    // that works !
}
?> 
```

当然，如果你处理状态：

您想在`DebugMode = False`（设置为关闭）、`DebugMode = True`（设置为打开）和`DebugMode = Null`（根本没有设置，将导致硬调试;-)）之间有所不同。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2011-04-18T09:21:17.210

`null`是`null`。`false`是`false`。悲伤但真实。

PHP 没有太多的一致性（尽管它在最新版本上有所改进，但向后兼容性太多了）。尽管设计希望具有一定的一致性（在此处选择的答案中进行了概述），但当您考虑以不太容易推理的方式使用`false`/的方法返回时，一切都会变得混乱。`null`

当他们已经对某些东西使用 false 时，您经常会看到使用 null 。例如 filter_input()。如果变量未通过过滤器，则返回 false，如果变量不存在则返回 null（不存在意味着它也未通过过滤器？）

当作者关心失败的类型时，可互换地返回 false/null/string/etc 的方法是一种技巧，例如，`filter_input()`您可以检查`===false`或`===null`是否关心验证失败的原因。但是如果你不这样做，这可能是一个陷阱，因为`===null`如果他们只记得为`===false`. 而且大多数 php 单元测试/覆盖工具不会因为缺少的、未经测试的代码路径而引起您的注意！

最后，这里有一些类型杂耍的乐趣。甚至不包括数组或对象。

```
var_dump( 0<0 );        #bool(false)
var_dump( 1<0 );        #bool(false)
var_dump( -1<0 );       #bool(true)
var_dump( false<0 );    #bool(false)
var_dump( null<0 );     #bool(false)
var_dump( ''<0 );       #bool(false)
var_dump( 'a'<0 );      #bool(false)
echo "\n";
var_dump( !0 );        #bool(true)
var_dump( !1 );        #bool(false)
var_dump( !-1 );       #bool(false)
var_dump( !false );    #bool(true)
var_dump( !null );     #bool(true)
var_dump( !'' );       #bool(true)
var_dump( !'a' );      #bool(false)
echo "\n";
var_dump( false == 0 );        #bool(true)
var_dump( false == 1 );        #bool(false)
var_dump( false == -1 );       #bool(false)
var_dump( false == false );    #bool(true)
var_dump( false == null );     #bool(true)
var_dump( false == '' );       #bool(true)
var_dump( false == 'a' );      #bool(false)
echo "\n";
var_dump( null == 0 );        #bool(true)
var_dump( null == 1 );        #bool(false)
var_dump( null == -1 );       #bool(false)
var_dump( null == false );    #bool(true)
var_dump( null == null );     #bool(true)
var_dump( null == '' );       #bool(true)
var_dump( null == 'a' );      #bool(false)
echo "\n";
$a=0; var_dump( empty($a) );        #bool(true)
$a=1; var_dump( empty($a) );        #bool(false)
$a=-1; var_dump( empty($a) );       #bool(false)
$a=false; var_dump( empty($a) );    #bool(true)
$a=null; var_dump( empty($a) );     #bool(true)
$a=''; var_dump( empty($a) );       #bool(true)
$a='a'; var_dump( empty($a));      # bool(false)
echo "\n"; #new block suggested by @thehpi
var_dump( null < -1 ); #bool(true)
var_dump( null < 0 ); #bool(false)
var_dump( null < 1 ); #bool(true)
var_dump( -1 > true ); #bool(false)
var_dump( 0 > true ); #bool(false)
var_dump( 1 > true ); #bool(true)
var_dump( -1 > false ); #bool(true)
var_dump( 0 > false ); #bool(false)
var_dump( 1 > true ); #bool(true) 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2015-10-23T00:44:28.080

下面是一个例子：

```
 Comparisons of $x with PHP functions

Expression          gettype()   empty()     is_null()   isset() boolean : if($x)
$x = "";            string      TRUE        FALSE       TRUE    FALSE
$x = null;          NULL        TRUE        TRUE        FALSE   FALSE
var $x;             NULL        TRUE        TRUE        FALSE   FALSE
$x is undefined     NULL        TRUE        TRUE        FALSE   FALSE
$x = array();       array       TRUE        FALSE       TRUE    FALSE
$x = false;         boolean     TRUE        FALSE       TRUE    FALSE
$x = true;          boolean     FALSE       FALSE       TRUE    TRUE
$x = 1;             integer     FALSE       FALSE       TRUE    TRUE
$x = 42;            integer     FALSE       FALSE       TRUE    TRUE
$x = 0;             integer     TRUE        FALSE       TRUE    FALSE
$x = -1;            integer     FALSE       FALSE       TRUE    TRUE
$x = "1";           string      FALSE       FALSE       TRUE    TRUE
$x = "0";           string      TRUE        FALSE       TRUE    FALSE
$x = "-1";          string      FALSE       FALSE       TRUE    TRUE
$x = "php";         string      FALSE       FALSE       TRUE    TRUE
$x = "true";        string      FALSE       FALSE       TRUE    TRUE
$x = "false";       string      FALSE       FALSE       TRUE    TRUE 
```

有关PHP中[类型比较](http://php.net/manual/en/types.comparisons.php)的更多参考，请参阅此内容。它应该给你一个清晰的理解。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T03:08:26.183

**False、Null、Nothing、0、Undefined**等，等等。

其中每一个都有与实际概念相关的特定含义。有时，多个含义会被重载为单个关键字或值。

在**C**和**C++**中`NULL`，`False`和`0`被重载为相同的值。在**C#**中，它们是 3 个不同的概念。

`null`或`NULL`通常表示缺乏价值，但通常不说明原因。 `0`表示自然数 0 并且与**1、2、3**等具有类型等价性，并且在支持单独概念的语言中`NULL`应该只处理数字。

**False**表示不真实。它用于**二进制值**。这并不意味着未设置，也不意味着`0`. 它只是表示两个二进制值之一。

没有什么可以表明该值被明确设置为空，这表明与 null 相同，但有意图。

在某些语言中未定义表示该值尚未设置，因为没有代码指定实际值。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-26T06:20:08.533

在 PHP 中，您可以使用 === 和 !== 运算符来检查值是否相等，以及它们的类型是否匹配。例如：`0 == false`is `true`，但是`0 === false`is `false`。`!=`vs也是如此`!==`。此外，如果您`null`使用上述运算符与其他两个进行比较，请期待类似的结果。

现在在 PHP 中，通常在返回一个有时可能是`0`（零）的值时使用这种值质量，但有时可能是函数失败。在 PHP 中的这种情况下，您返回`false`并且必须使用身份运算符检查这些情况`===`。例如，如果您正在搜索一个字符串在另一个字符串中的位置并且您使用`strpos()`的是all, then`strpos()`将返回`false`，您在处理结果时必须考虑到这一点。

如果您将在您的函数中使用相同的技术，任何熟悉标准 PHP 库的人都会了解发生了什么以及如何检查返回的值是否是所需的值，或者在处理时是否发生了一些错误。函数参数实际上也是如此，您可以根据它们是数组还是字符串或不是什么来对它们进行不同的处理，并且这种技术在整个 PHP 中也大量使用，因此每个人都会很容易地掌握它。所以我想这就是力量。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-12-22T16:28:21.927

我刚刚浪费了一天 1/2 的时间来尝试从`0`, `null`,`false`中返回`strops`!

这就是我试图做的所有事情，在我发现逻辑没有朝着正确的方向流动之前，似乎 php 编码中有一个黑洞：

概念采用托管在服务器上的域名，并确保它不是根级别，可以使用几种不同的方法来执行此操作，但由于我已经完成了其他 php 函数/构造，我选择了不同的方法。

无论如何，这是cosing的基础：

```
if (strpos($_SERVER ['SERVER_NAME'], dirBaseNAME ()) 
{ 
    do this 
} else {
    or that
}

{
echo strpos(mydomain.co.uk, mydomain);  

if ( strpos(mydomain, xmas) == null ) 
    {
        echo "\n1 is null"; 
    }

if ( (strpos(mydomain.co.uk, mydomain)) == 0 ) 
    {
        echo "\n2 is 0"; 
    } else {
        echo "\n2 Something is WRONG"; 
    }

if ( (mydomain.co.uk, mydomain)) != 0 ) 
    {
        echo "\n3 is 0"; 
    } else {
        echo "\n3 it is not 0"; 
    }

if ( (mydomain.co.uk, mydomain)) == null ) 
    {
        echo "\n4 is null"; 
    } else {
        echo "\n4 Something is WRONG"; 
    }
} 
```

终于在阅读了这个主题后，我发现这有效！

```
{
if ((mydomain.co.uk, mydomain)) !== false ) 
    {
        echo "\n5 is True"; 
    } else {
        echo "\n5 is False"; 
    }
} 
```

感谢这篇文章，我现在明白了，即使是圣诞节，也可能不是圣诞节`false`，因为它也可以是`NULL`一天！

在浪费了一天的时间调试一些简单的代码之后，我希望我之前就知道这一点，因为我本来能够识别问题，而不是到处去试图让它工作。它没有工作，因为`False`，`NULL`并且`0`不都一样`True or False or NULL`？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T03:56:32.667

来自[PHP 在线文档](http://ar2.php.net/manual/en/language.types.boolean.php)：

> 要将值显式转换为布尔值，请使用 (bool) 或 (boolean) 强制转换。
> 但是，在大多数情况下，强制转换是不必要的，因为如果运算符、函数或控制结构需要布尔参数，则值将自动转换。
> 转换为布尔值时，以下值被视为 FALSE：

*   布尔值`FALSE`本身
*   整数``0（零）
*   浮点数`0.0`（零）
*   空字符串和字符串`"0"`
*   一个元素为零的数组
*   具有零成员变量的对象（仅限 PHP 4）
*   特殊类型`NULL`（包括未设置的变量）
*   从空标签创建的 SimpleXML 对象
    考虑所有其他值`TRUE`（包括任何资源）。

因此，在大多数情况下，它是相同的。

另一方面， the`===`和 the`==`不是一回事。通常，您只需要“等于”运算符。澄清：

```
$a == $b    //Equal. TRUE if $a is equal to $b.
$a === $b   //Identical. TRUE if $a is equal to $b, and they are of the same type. 
```

有关更多信息，请查看 PHP 在线文档中的“[比较运算符](http://ar2.php.net/manual/en/language.operators.comparison.php)”页面。

希望这可以帮助。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T02:56:03.703

这些值之间的差异总是归结为详细的语言特定规则。你从 PHP 中学到的东西不一定适用于 Python、Perl 或 C 等。虽然学习你正在使用的语言的规则很有价值，但过度依赖它们是自找麻烦. 当下一个程序员需要维护您的代码并且您使用了一些结构来利用 Null 与 False 的一些小细节（例如）时，麻烦就来了。您的代码应该看起来是正确的（相反，[错误的代码应该看起来是错误](http://www.joelonsoftware.com/articles/Wrong.html)的）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T03:11:01.933

Null 在数据库中用于表示“无记录”或“无信息”。因此，您可能有一个描述“此用户是否希望我们向其发送电子邮件”的位字段，其中 True 表示他们愿意，False 表示他们不想发送任何内容，但 Null 表示您不想不知道。它们可以通过外部连接等来实现。

Null 的逻辑含义通常是不同的——在某些语言中，NULL 不等于任何东西，因此 if(a == NULL) 将始终为 false。

所以就我个人而言，我总是将一个布尔值初始化为 FALSE，而将一个布尔值初始化为 NULL 看起来有点恶心（即使在 C 中两者都只是 0 ......只是一种风格）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T03:12:10.170

在 PHP 中，这取决于您是否正在验证类型：

```
( 
 ( false !== 0 ) && ( false !== -1 ) && ( false == 0 ) && ( false == -1 ) &&
 ( false !== null ) && ( false == null ) 
) 
```

技术上 null 是`0x00`但在 PHP 中`( null == 0x00 ) && ( null !== 0x00 )`。

`0`是一个整数值。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T03:18:56.940

我认为糟糕的开发人员会在代码中找到 null/0/false 的所有不同用途。

例如，开发人员最常犯的错误之一是以函数的数据形式返回错误代码。

```
// On error GetChar returns -1
int GetChar() 
```

这是一个糖接口的例子。这在“调试软件开发过程”一书中以及另一本书“编写正确的代码”中都有说明。

这个问题是对 char 类型的暗示或假设。在某些编译器上，char 类型可以是无符号的。因此，即使您返回 -1，编译器也可以返回 1。很难发现 C++ 或 C 中的这种编译器假设。

相反，最好的方法是不要将错误代码与您的数据混合。所以下面的函数。

```
char GetChar() 
```

现在变成

```
// On success return 1
// on failure return 0
bool GetChar(int &char) 
```

这意味着无论开发人员在您的开发商店中多么年轻，他或她都不会出错。虽然这不是在谈论代码中的冗余或依赖。

所以总的来说，将 bool 作为语言中的第一类类型是可以的，我认为 joel 在他最近的 postcast 中谈到了它。但是尽量不要在你的例程中使用混合和匹配布尔与你的数据，你应该完全没问题。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-26T04:01:59.533

关于 PHP 的一个有趣事实`NULL`：如果你设置一个 var 等于`NULL`，它就像你调用`unset()`它一样。

`NULL`本质上意味着一个变量没有赋值；`false`是一个有效的布尔值，`0`是一个有效的整数值，PHP 在`0`、`"0"`、`""`和`false`.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T02:56:10.783

Null 什么都不是，False 有点，0 是（可能）32 位。

不是 PHP 专家，但在一些更现代的语言中，它们是不可互换的。我有点想念 0 和 false 可以互换，但是 boolean 是一种实际类型，你可以拥有与之关联的方法和对象，所以这只是一个权衡。虽然 Null 是 null，但本质上没有任何东西。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T03:11:58.173

好吧，我从我的 PHP 时代记不起足够的答案来回答“===”部分，但是对于大多数 C 风格的语言，NULL 应该在指针值的上下文中使用，false 作为布尔值，零作为数值，例如 int。'\0' 是字符上下文的惯用值。我通常也更喜欢将 0.0 用于浮点数和双精度数。

所以.. 快速回答是：上下文。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-26T03:19:24.690

在几乎所有现代语言中，null*逻辑上*指的是没有值的指针（或引用），或者没有初始化的变量。0 是零的整数值，而 false 是布尔值，好吧，假。为了使事情变得复杂，例如，在 C 中，null、0 和 false 都以完全相同的方式表示。我不知道它在 PHP 中是如何工作的。

然后，更复杂的是，数据库有一个 null 的概念，这意味着缺失或不适用，并且大多数语言没有直接的方法将 DBNull 映射到它们的 null。例如，直到最近，int 为 null 和为零之间没有区别，但是用可为 null 的 int 改变了这一点。

抱歉让这听起来很复杂。只是这多年来一直是语言中的一个难题，直到最近，它还没有任何明确的解决方案。人们过去常常只是将事物拼凑在一起，或者将数据库中的空白或 0 表示为空值，这并不总是能很好地工作。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-26T04:28:32.917

False 和 0 在概念上相似，即它们是同构的。0 是自然数代数的初始值，False 是布尔代数的初始值。

换句话说，0 可以定义为一个数，当它与某个自然数相加时，会产生相同的数：

```
x + 0 = x 
```

类似地，False 是一个值，它与任何其他值的析取是相同的值：

```
x || False = x 
```

Null 在概念上是完全不同的东西。根据语言的不同，它有不同的语义，但没有一个将“初始值”描述为 False 和 0。Null 没有代数。它与变量有关，通常表示该变量在当前上下文中没有特定值。在大多数语言中，没有对 Null 定义操作，将 Null 用作操作数是错误的。在某些语言中，有一个称为“bottom”而不是“null”的特殊值，它是不终止计算值的占位符。

[我在其他地方写过更多关于 NULL 的含义的文章。](http://apocalisp.wordpress.com/2008/05/03/null-vs-pure-reason/)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-02-01T02:29:03.953

有人可以向我解释为什么 'NULL' 不仅仅是比较实例中的字符串？

```
$x = 0;
var_dump($x == 'NULL');  # TRUE   !!!WTF!!! 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2018-11-04T12:02:53.400

虚假性的问题来自 PHP 的历史。该问题针对未明确定义的标量类型。

```
'*' == true -> true (string match)
'*' === true -> false (numberic match)

(int)'*' == true -> false
(string)'*' == true -> true 
```

PHP7 的严格性是一个进步，但可能还不够。[https://web-techno.net/typing-with-php-7-what-you-shouldnt-do/](https://web-techno.net/typing-with-php-7-what-you-shouldnt-do/)

# oracle - 完全展开视图

> ID：137497
> 
> 赞同：4
> 
> 时间：2008-09-26T02:55:53.547
> 
> 标签：oracle, views

在 Oracle 中，是否有一种简单的方法可以完全展开视图？例如：如果我有一个由更多视图上的选择组成的视图，是否有某种方法可以将其展开以直接在真实表上进行选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T04:15:53.947

1.  获取视图的查询文本。

    ```
    SELECT text FROM dba_views
    WHERE owner = 'the-owner' AND view_name = 'the-view-name'; 
    ```

2.  解析。在查询文本中搜索视图名称。

3.  获取找到的每个视图名称的查询文本。（见第 1 项。）

4.  将查询中的每个视图名称替换为相关的查询文本。

5.  递归执行此操作，直到找不到更多视图。

简单的？

**编辑：** 上述说明并没有做所有需要的事情。再想一想，它会变得多毛，长出腿，也许还有另一条胳膊。查找列名，以及可能是复杂函数和子查询的列名。将它们与连接和子句重新组合在一起。结果查询可能看起来很丑陋。

在 Oracle 的某个地方，可能有一些东西实际上是在展开视图。我不知道。我很高兴我在 Oracle 中没有过多地使用视图。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T11:02:06.827

[内嵌视图](http://www.psoug.org/reference/inline_view.html)的概念可用于执行此操作。假设您有以下 2 个视图：

```
create or replace view london_dept as
select * from dept
where loc = 'LONDON'; 
```

和

```
create or replace view london_mgr as
select * from emp 
where job='MANAGER'
and deptno in (select deptno from london_dept); 
```

在第二个视图的 SQL 中，对视图 london_dept 的引用可以使用 london_dept 视图定义中的 SQL 替换为内联视图，如下所示：

```
select * from emp 
where job='MANAGER'
and deptno in (select deptno from (select * from dept
where loc = 'LONDON')); 
```

当然，您现在可以看到它过于冗长，可以简化为：

```
select * from emp 
where job='MANAGER'
and deptno in (select deptno from dept where loc = 'LONDON'); 
```

[最后，来自 Tom Kyte 的一些关于创建视图视图的](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:9087996409290)优缺点的建议

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-01-24T13:03:29.810

在 Oracle 12.1 之前，正确答案是否定的，没有简单的方法。现在，在 12.1 中有 DBMS_UTILITY.EXPAND_SQL_TEXT ：在 Oracle 数据库 12c 第 1 版 (12.1) 中扩展对视图的 SQL 引用就是这样做的。请参阅[dbms_utility 的文档](http://docs.oracle.com/database/121/ARPLS/d_util.htm#ARPLS73973)

# windows - 如何以编程方式显示或隐藏 Outlook 信封图标？

> ID：137519
> 
> 赞同：6
> 
> 时间：2008-09-26T03:03:06.400
> 
> 标签：windows, outlook

例如，如何在 Outlook 规则中显示或隐藏 Outlook 信封图标？

信封图标选项通过以下步骤设置：

*   工具 -> 选项...
*   电子邮件选项
*   高级电子邮件选项
*   在通知区域显示信封图标

我之所以以编程方式说是因为没有任何标准规则操作适用。（“清除消息标志”操作似乎不起作用。此外，没有“设置消息标志”操作。）

这意味着解决方案可能采用 VBA 脚本、加载项或自定义操作的形式。作为最后的手段，我将编写自己的任务栏通知。

在文档中，我找到了 IMsoEnvelope，但这仅用于从其他 Office 应用程序发送电子邮件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T03:11:22.980

动作是“清除消息标志”

# ruby-on-rails - 如何保护 Rails 模型属性？

> ID：137521
> 
> 赞同：12
> 
> 时间：2008-09-26T03:03:22.437
> 
> 标签：ruby-on-rails, ruby, model

我的 Invoice 模型有一个 address_id 属性，我不希望这个 address_id 永远改变。所以我不希望这发生在课外：

```
invoice.address_id = 1
invoice.address = some_address 
```

Rails 会自动将此 address_id 属性从发票表添加到模型中，那么我如何声明此属性为私有/受保护的呢？打电话

```
attr_protected :address_id 
```

很可能不是解决方案，因为根据文档它只能防止批量分配。

谢谢！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-26T03:11:43.680

你想要[`attr_readonly`](http://api.rubyonrails.org/classes/ActiveRecord/Base.html#M001317)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T03:08:11.677

不像一个衬里那么漂亮，但下面的代码应该可以工作（你总是可以做一些元编程来编写一个“不可变”的方法）

```
def address_id=(id)
  if new_record?
    write_attribute(:address_id, id)
  else
    raise 'address is immutable!'
  end
end 
```

# macos - Where can I find tools for learning assembler on OS X?

> ID：137523
> 
> 赞同：22
> 
> 时间：2008-09-26T03:03:32.577
> 
> 标签：macos, assembly

I'd like to learn assembler. However, there are very few resources for doing assembler with OS X.

Is there anyone out there who has programmed in assembly on a Mac? Where did you learn?

And, is there any reason I shouldn't be doing assembly? Do I risk (significantly) crashing my computer irreparably?

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T03:09:29.973

If you're using a PowerPC Mac, look into gcc inline assembler. Otherwise, look into nasm. I can't give any decent references to PPC ASM (they're few and far between), but I suggest the following things to learn x86 asm:

*   The book [Reversing by Eldad Eilam](https://rads.stackoverflow.com/amzn/click/com/0764574817)
*   Compile simple C source with gcc -S and read the assembly generated
*   Use [Sandpile](http://sandpile.org/)
*   Join #openrce on irc.freenode.net and use [OpenRCE](http://openrce.org/)

Also, if you're not in kernel mode then there's no chance of screwing anything up, really, and even if you are in kernel mode it's hard to really destroy anything.

Edit: Also, get gcc and such from XCode not Macports or somesuch. You're in for a world of malformed Mach-O files if you don't. Not fun to diagnose file format issues when you're just starting asm hacking.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T03:18:53.257

The assembler language is determined by the hardware platform, not the operating system. Given that OS X runs on Intel platform and is 64-bit, you should look for information on x64 (also called AMD64) assembler. Check the Wikipedia article ([http://en.wikipedia.org/wiki/X86-64](http://en.wikipedia.org/wiki/X86-64)) for a lot of links to documentation about x64.

Also, the OS X tools documentation might contains a lot of information about x64 assembler. In particular, the Netwide Assembler (NASM - [http://developer.apple.com/documentation/DeveloperTools/nasm/nasmdoc0.html](http://developer.apple.com/documentation/DeveloperTools/nasm/nasmdoc0.html)) might have documentation on how to build OS X applications using assembler.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T03:50:45.410

To start learning assembly, you might want to start with simple C programs and ask GCC to generate the assembler code for it using the -S option:

```
gcc -S hello.c -o hello.asm 
```

You will then be able to understand how to call functions, pass arguments, etc.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T03:12:58.577

Nasm/yasm are your best bet; gcc inline syntax is quite crippling and can be very painful to use at times, plus there are literally some things it *cannot* do. Nasm's macro syntax is also much much more useful, a godsend in a language like assembly that has no built-in templating features.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T03:08:54.093

XCode (ie. GCC) has great support for writing assembler. It's a fun thing to learn (although you're unlikely to need it much), and the worst you can do is crash the program you're writing, same as in C. Just Google for 'gcc inline asm x86 tutorial' and you should find plenty of starting points. Don't worry that some will seem to be Linux specific, they'll generally work just as well in XCode.

(edit) ...assuming you have an Intel Mac of course; if not then replace 'x86' with 'ppc'.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T03:21:52.267

[here](http://developer.apple.com/documentation/DeveloperTools/Reference/Assembler/Assembler.pdf)

I programmed assembly on a Mac. It was Motorola 680x0 assembler using MPW. I've touched on the PowerPC assembler a few times in CodeWarrior and ProjectBuilder. Now ProjectBuilder is called XCode, and there is Intel. The assembler is one of the many tools within XCode.

I originally learned assembler on the Apple II: the 6502 machine language monitor built in ROM, the Sweet16 mini-assembler, and others. Later, I used Intel 80186 assembler to speed up slow bits of C code, and work paid for a one day course on Intel 80186 assembler at a university. Later, I had to maintain some 680x0 assembly for the Mac. That was a long time ago.

I don't think there is any reason not to do assembly. Learning is great. Learn all you can. Drop into a low enough level debugger and look at the disassembled code.

My advice is:

> Don't be scared.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T03:07:45.843

There's no reason why you shouldn't; there is nothing you can do in assembly language that you can't do in a higher level language like C.

As far as tools go, you might want to install [MacPorts](http://macports.org) and get the GNU assembler. That may or may not be the easiest way, but it's free and you can probably find tutorial documentation for writing Unix programs in GNU assembler somewhere on the net.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-27T12:48:19.390

There are two three things you to know need for writing assembly language on a system with an operating system (as opposed to 'bare metal' assembly which is a world of its own):

1.  How the instruction set works - loads of resources for Intel X86 if you have an Intel Mac, still reasonable set for PPC for example [Mac OS X Internals](http://www.osxbook.com/).

2.  How to assemble link your programmes - if you have the Developer tools installed you have GCC and associated tools

3.  How to talk to the OS - here is where Mac assembly is a *lot* less well documented than Windows or Linux. It may be you have to write equivalent C programs and use 'gcc -S' to see what calling/stack restoration conventions are appropriate. It depends what you want to do but at a miniumum you need OS system calls for IO and memory allocation.

A good starting point is [here](http://zathras.de/angelweb/blog-intel-assembler-on-mac-os-x.htm).

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T20:39:58.450

If you've got *Developer Tools* installed, you can simply open *Terminal* and type **as** (*[GNU Assembler](http://en.wikipedia.org/wiki/GNU_Assembler)* - part of *Binutils*).

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-16T01:58:58.770

For PPC try Lightsoft

# php - 如何设置站点必须使用的编码？

> ID：137526
> 
> 赞同：0
> 
> 时间：2008-09-26T03:04:02.637
> 
> 标签：php, encoding

在某些系统上是 UTF-8，在其他系统上是 latin-1。你怎么设置这个？它是 php.ini 中的东西吗？

（我知道您可以通过设置 HTTP 标头为给定页面设置编码/字符集，但这不是我想要的。）

亚历克斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-26T03:20:40.273

php.ini 中有一个 default_charset 设置

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T04:24:53.737

如果您需要更改非 php 文件的字符集，您可以告诉 apache 使用什么。添加默认字符集 utf-8

# sql-server - 为什么我的存储过程接收到一个空参数？

> ID：137530
> 
> 赞同：2
> 
> 时间：2008-09-26T03:05:03.430
> 
> 标签：sql-server, delphi, stored-procedures

好的，这是一个卷发。我正在编写一些我没有编写的 Delphi 代码，我遇到了一个非常奇怪的问题。我的存储过程的参数之一是通过 as `null`，即使它肯定是被发送的`1`。

Delphi 代码使用 TADOQuery 来执行存储过程（匿名）：

```
 ADOQuery1.SQL.Text := "exec MyStoredProcedure :Foo,:Bar,:Baz,:Qux,:Smang,:Jimmy";
 ADOQuery1.Parameters.ParamByName("Foo").Value := Integer(someFunction()); 
 // other parameters all set similarly
 ADOQuery1.ExecSQL; 
```

`Integer(SomeFunction())`目前总是返回 1 - 我用调试器检查过。

但是，在我的存储过程中（出于调试目的而更改）：

```
create procedure MyStoredProcedure (
    @Foo int, @Bar int, @Baz int,
    @Qux int, @Smang int, @Jimmy varchar(20) 
) as begin
    -- temp debug
    if ( @Foo is null ) begin
        insert into TempLog values ( "oh crap" )
    end
    -- do the rest of the stuff here..
end 
```

`TempLog`确实以“哦，废话”结尾（附带问题：必须有更好的方法来调试存储的过程：它是什么？）。

以下是分析器的示例跟踪：

```
exec [MYDB]..sp_procedure_params_rowset N'MyStoredProcedure',1,NULL,NULL

declare @p3 int
set @p3=NULL
exec sp_executesql 
    N'exec MyStoredProcedure @P1,@P2,@P3,@P4,@P5,@P6',
    N'@P1 int OUTPUT,@P2 int,@P3 int,@P4 int,@P5 int,@P6 int',
    @p3 output,1,1,1,0,200
select @p3 
```

这对我来说有点奇怪。请注意，它正在使用 @p3*和*@P3 - 这会导致我的问题吗？

另一个奇怪的事情是，它似乎取决于我使用的 TADOConnection。

该项目是一个 dll，它从另一个应用程序传递了一个 TADOConnection。它使用此连接调用所有存储过程。

如果不使用此连接，我首先这样做：

```
ConnectionNew := TADOQuery.Create(ConnectionOld.Owner);
ConnectionNew.ConnectionString := ConnectionOld.ConnectionString;
TADOQuery1.Connection := ConnectionNew; 
```

那么问题就不会出现了！这种情况的痕迹是这样的：

```
exec [MYDB]..sp_procedure_params_rowset N'MyStoredProcedure',1,NULL,NULL

declare @p1 int
set @p1=64
exec sp_prepare @p1 output,
    N'@P1 int,@P2 int,@P3 int,@P4 int,@P5 int,@P6 varchar(20)',
    N'exec MyStoredProcedure @P1,@P2,@P3,@P4,@P5,@P6',
    1
select @p1

SET FMTONLY ON exec sp_execute 64,0,0,0,0,0,' ' SET FMTONLY OFF

exec sp_unprepare 64

SET NO_BROWSETABLE OFF

exec sp_executesql 
    N'exec MyStoredProcedure @P1,@P2,@P3,@P4,@P5,@P6',
    N'@P1 int,@P2 int,@P3 int,@P4 int,@P5 int,@P6 varchar(20)',
    1,1,1,3,0,'400.00' 
```

不幸的是，这对 lil ol' 我来说有点过分了。什么样的 TADOConnection 选项可能会影响这一点？

有没有人有任何想法？

**编辑：** [下面更新](https://stackoverflow.com/questions/137530/why-is-my-stored-procedure-receiving-a-null-parameter#177214)（不想再提出这个问题了：P）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T05:24:36.543

在我的程序中，我有**很多**与您的第一个片段非常相似的代码，我还没有遇到过这个问题。

这**实际上是**您的代码，还是您如何表达问题以供我们理解？SQL 的文本是存储在 DFM 中还是动态填充？

我想知道查询的 Params 属性是否已经在 IDE 中获得了定义/缓存的参数列表，这可以解释为什么 P1 被视为输出（这几乎肯定会导致您的 NULL 问题）。

就在您设置 ParamByName.Value 之前，请尝试

```
ParamByName("Foo").ParamType=ptInput;

```

我不确定为什么您更改连接字符串也会解决此问题，除非它正在重置该查询参数的内部含义。

在 TSQLQuery 下，每当 SQL.Text 值更改时，查询的 Params 属性就会被重置/重新创建（我不确定 TADOQuery 是否属实），所以你的第一个片段应该导致任何现有的 Params信息已被删除。

如果上面的“ParamByname.ParamType”建议确实为您解决了问题，那么肯定在其他地方（在创建时？在表单上？）查询发生了一些事情，导致它认为 Foo 是一个输出参数......

这些帮助有用？:-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T03:55:13.310

警告：我不知道德尔福，但这个问题敲响了一个微弱的钟声，所以我对它感兴趣

如果您使用 TADOStoredProc 而不是 TADOQuery，您会得到相同的结果吗？[请参阅 delphi 5 开发人员指南](http://www.podgoretsky.com/ftp/Docs/Delphi/D5/dg/ado_comp.html)

此外，看起来第一个跟踪没有准备调用并且认为@P1 是执行中的输出参数，而第二个跟踪使用@P1 作为输出进行了准备调用，但在执行中没有将@P1 显示为输出步骤 - 这很重要吗？它确实看起来很奇怪，因此可能是一个线索

您也可以尝试用常量 1 替换函数调用

祝你好运，请告诉我们你的发现！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T08:37:56.677

我怀疑您之前使用 ADOQuery 时遗留了一些参数不匹配。

您是否尝试在更改 SQL.Text 后重置参数：

```
 ADOQuery1.Parameters.Refresh; 
```

您也可以尝试清除参数并显式重新创建它们：

```
 ADOQuery1.Parameters.Clear;
  ADOQuery1.Parameters.CreateParameter('Foo', ftInteger, pdInput, 0, 1);
  [...] 
```

我认为更改连接实际上会强制参数的 InternalRefresh。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T08:43:40.157

```
 ADOQuery1.Parameters.ParamByName("Foo").Value = Integer(someFunction()); 
```

他们不使用`:=`Object Pascal 中的赋值吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T14:32:34.887

@康斯坦丁

它必须是问题作者的错字。

@Blorgbeard

嗯...当您更改 TADOQuery 的 SQL 时，最好使用清除参数并重新创建然后使用 CreateParameter。我不会在运行时依赖 ParamCheck - 因为它使参数的属性大多未定义。在依赖 ParamCheck 自动填充参数时，我遇到了此类问题 - 很少见，但会发生。啊，如果您使用 CreateParameter 路线，请创建 @RETURN_VALUE 作为第一个参数，因为它会捕获 MSSQL SP 的返回值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T14:42:45.770

我唯一遇到过这样的问题是当数据库提供程序无法区分输出（始终将其设置为空）和输入输出（使用您提供的）参数时。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T04:08:43.707

好的，取得了进展……有点。

@Robsoft 是正确的，设置参数方向来`pdInput`解决问题。

我追踪到 VCL 代码，它归结为`TParameters.InternalRefresh.RefreshFromOleDB`. 这个函数在我设置 SQL.Text 时被调用。这是（删节的）代码：

```
function TParameters.InternalRefresh: Boolean;
  procedure RefreshFromOleDB;
    // ..
        if OLEDBParameters.GetParameterInfo(ParamCount, PDBPARAMINFO(ParamInfo), @NamesBuffer) = S_OK then
          for I := 0 to ParamCount - 1 do
            with ParamInfo[I] do
            begin
              // ..
              Direction := dwFlags and $F;       // here's where the wrong value comes from
              // ..
            end;
     // ..
  end;
  // ..
end; 
```

因此，[`OLEDBParameters.GetParameterInfo`](http://msdn.microsoft.com/en-us/library/ms714917(VS.85).aspx)由于某种原因返回了错误的标志。

我已经验证了原始连接`(dwFlags and $F)`是`2`( `DBPARAMFLAGS_ISOUTPUT`)，而新连接是`1`( `DBPARAMFLAGS_ISINPUT`)。

我不确定我是否想深入挖掘，至少现在是这样。

在我有更多时间和意愿之前，我会确保`pdInput`在打开查询之前将所有参数设置为。
除非现在有人有更聪明的想法..？

无论如何，感谢大家迄今为止的建议。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-12-03T17:12:59.007

我在使用 TADOQuery 检索一些 LDAP 信息时遇到了非常相似的问题，即使您的查询没有参数，TParameter.InternalRefresh 函数中也存在一个错误，该错误会导致访问冲突。

要解决这个问题，只需将 TADOQuery.ParamCheck 设置为 false。

# javascript - 是什么使它成为在 Web 浏览器中打印 1 到 1,000,000（以空格分隔）的最快 JavaScript？

> ID：137534
> 
> 赞同：10
> 
> 时间：2008-09-26T03:07:30.883
> 
> 标签：javascript, optimization, buffer

**[我在这里](http://www.webreference.com/programming/javascript/jkm3/4.html)**阅读有关 JavaScript 中的输出缓冲的信息**，**并试图了解作者所说的在网页上打印 1 到 1,000,000 的速度最快的脚本。（向下滚动到标题“中奖百万数字脚本”。）研究了一下，我有几个问题：

*   与其他方法相比，是什么让这个脚本如此高效？
*   为什么缓冲会加快速度？
*   您如何确定要使用的正确缓冲区大小？
*   这里有没有人有任何技巧可以进一步优化这个脚本？

（我意识到这可能是 CS101，但我是那些该死的、自学成才的黑客之一，我希望能从集体的智慧中受益。谢谢！）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T04:07:06.620

## 与其他方法相比，是什么让这个脚本如此高效？

作者对该算法进行了多项优化。其中每一个都需要对如何使用底层机制（例如，Javascript、CPU、寄存器、缓存、视频卡等）有相当深入的了解。我认为他正在进行 2 个关键优化（其余的只是锦上添花）：

*   缓冲输出
*   使用整数数学而不是字符串操作

既然您明确询问缓冲，我将很快讨论缓冲。他使用的整数数学有两个性能优势：整数加法比字符串操作更便宜，并且它使用更少的内存。

我不知道 JavaScript 和 Web 浏览器如何处理将整数转换为浏览器中的显示字形，因此与字符串相比，将整数传递给 document.write 可能会受到惩罚。但是，他正在执行 (1,000,000 / 1000) 次 document.write 调用，而不是 1,000,000 - 1,000 次整数加法。这意味着他要执行大约 3 个数量级的操作来形成消息，而不是他将消息发送到显示器。因此，将整数与字符串发送到 document.write 的惩罚必须超过 3 个数量级，从而抵消了操作整数的性能优势。

## 为什么缓冲会加快速度？

它工作的具体原因取决于您使用的平台、硬件和实现。无论如何，这一切都是为了平衡你的算法和你的瓶颈诱导资源。

例如，在文件 I/O 的情况下，缓冲区很有用，因为它利用了旋转磁盘一次只能写入一定数量的事实。给它的工作太少，它不会使用随着磁盘旋转而通过主轴头部下方的所有可用位。给它太多，您的应用程序将不得不等待（或进入睡眠状态）而磁盘完成您的写入 - 可以花费时间来准备下一条记录以进行写入！确定文件 I/O 的理想缓冲区大小的一些关键因素包括：扇区大小、文件系统块大小、交错、磁头数、旋转速度和面密度等。

在 CPU 的情况下，一切都是为了保持管道满载。如果你给 CPU 的工作太少，它会在等待你执行任务时花时间旋转 NO OP。如果你给 CPU 太多，你可能无法将请求分派给其他可以并行执行的资源，例如磁盘或显卡。这意味着稍后 CPU 将不得不等待这些返回而无事可做。在 CPU 中进行缓冲的主要因素是使您需要的一切（对于 CPU）尽可能靠近 FPU/ALU。在典型的架构中，这是（按接近度递减的顺序）：寄存器、L1 高速缓存、L2 高速缓存、L3 高速缓存、RAM。

在将一百万个数字写入屏幕的情况下，它是关于使用视频卡在屏幕上绘制多边形。像这样想。假设对于添加的每个新数字，显卡必须执行 100,000,000 次操作才能在屏幕上绘制多边形。在一个极端情况下，如果一次在页面上输入 1 个数字，然后让您的显卡将其写出来，然后您为 1,000,000 个数字执行此操作，则显卡将必须执行 10^14 次操作 - 100 万亿次操作！在另一个极端，如果你把全部 100 万个数字一次性全部发送到显卡上，只需要 100,000,000 次操作。最佳点是在中间的某个地方。如果您一次执行一次，CPU 会执行一个工作单元，并在 GPU 更新显示时等待很长时间。

## 您如何确定要使用的缓冲区大小？

除非您针对具有特定算法的非常特定且定义明确的平台（例如，为互联网路由编写数据包路由），否则您通常无法通过数学方式确定这一点。通常，您会凭经验找到它。猜一个值，试一试，记录结果，然后选择另一个。您可以根据您正在管理的瓶颈对从哪里开始以及要调查的范围做出一些有根据的猜测。

## 这里有没有人有任何技巧可以进一步优化这个脚本？

我不知道这是否可行，但我还没有测试过，缓冲区大小通常是 2 的倍数，因为计算机的底层固定是二进制的，字长*通常是*是 2 的倍数（但并非总是如此！）。例如，64 字节比 60 字节更可能是最佳的，而 1024 比 1000 字节更可能是最佳的。此问题特有的瓶颈之一是迄今为止的大多数浏览器（Google Chrome 是我第一个例外）知道）让javascript在与其他网页渲染机制相同的线程中连续运行。这意味着 javascript 做了一些填充缓冲区的工作，然后等待很长时间，直到 document.write 调用返回。如果 javascript 作为单独的进程异步运行，就像在 chrome 中一样，您可能会获得显着的加速。这当然是攻击瓶颈的来源而不是使用它的算法，但有时这是最好的选择。

没有我想要的那么简洁，但希望这是一个很好的起点。缓冲是计算中各种性能问题的重要概念。充分了解代码使用的底层机制（硬件和软件）对于避免或解决性能问题非常有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T03:15:23.890

我敢打赌，打印 1m 数字最慢的事情是浏览器重绘页面，所以调用 document.write() 的次数越少越好。当然，这需要与大字符串连接进行平衡（因为它们涉及分配和复制）。

通过实验发现确定正确的缓冲区大小。

在其他示例中，缓冲有助于沿自然边界对齐。这里有些例子

*   32 位 CPU 可以更有效地传输 32 位。
*   TCP/IP 数据包具有最大大小。
*   文件 I/O 类具有内部缓冲区。
*   图像，如 TIFF，可以与它们的数据一起存储在条带中。

与其他系统的自然边界对齐通常可以带来性能优势。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T03:23:04.247

考虑它的一种方法是考虑一次对 document.write() 的调用非常昂贵。但是，构建一个数组并将该数组加入一个字符串不是。因此，减少对 document.write() 的调用次数有效地减少了写入数字所需的总体计算时间。

缓冲区是一种尝试将两个不同成本的工作结合在一起的方法。

计算和填充数组对于小数组来说成本小，而对于大数组来说，bug 成本大。无论写入的大小如何，document.write 的固定成本都很大，但对于较大的输入，其缩放比例小于 o(n)。

因此，将较大的字符串排队写入或缓冲它们可以提高整体性能。

顺便说一句，在文章中找到了不错的发现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T05:24:08.447

所以这个一直让我发疯，因为我不认为它真的是最快的。所以这是我的实验，任何人都可以玩。也许我写错了或其他什么，但看起来一次完成所有操作而不是使用缓冲区实际上是一种更快的操作。或者至少在我的实验中。

```
<html>
<head>
<script type="text/javascript">
    function printAllNumberBuffered(n, bufferSize)
    {
        var startTime = new Date();

        var oRuntime = document.getElementById("divRuntime");
        var oNumbers = document.getElementById("divNumbers");

        var i = 0;
        var currentNumber;
        var pass = 0;
        var numArray = new Array(bufferSize);

        for(currentNumber = 1; currentNumber <= n; currentNumber++)
        {
            numArray[i] = currentNumber;

            if(currentNumber % bufferSize == 0 && currentNumber > 0)
            {
                oNumbers.textContent += numArray.join(' ');
                i = 0;
            }
            else
            {
                i++;
            }
        }

        if(i > 0)
        {
            numArray.splice(i - 1, bufferSize - 1);
            oNumbers.textContent += numArray.join(' ');
        }

        var endTime = new Date();

        oRuntime.innerHTML += "<div>Number: " + n + " Buffer Size: " + bufferSize + " Runtime: " + (endTime - startTime) + "</div>";
    }

    function PrintNumbers()
    {
        var oNumbers = document.getElementById("divNumbers");
        var tbNumber = document.getElementById("tbNumber");
        var tbBufferSize = document.getElementById("tbBufferSize");

        var n = parseInt(tbNumber.value);
        var bufferSize = parseInt(tbBufferSize.value);

        oNumbers.textContent = "";

        printAllNumberBuffered(n, bufferSize);
    }
</script>
</head>
<body>
<table  border="1">
    <tr>
        <td colspan="2">
            <div>Number:&nbsp;<input id="tbNumber" type="text" />Buffer Size:&nbsp;<input id="tbBufferSize" type="text" /><input type="button" value="Run" onclick="PrintNumbers();" /></div>
        </td>
    </tr>
    <tr>
        <td style="vertical-align:top" width="30%">
            <div  id="divRuntime"></div>
        </td>
        <td width="90%">
            <div id="divNumbers"></div>
        </td>
    </tr>
</table>
</body>
</html> 
```

# c# - .NET 的汇编程序库，将运行时变量字符串组装成机器代码以进行注入

> ID：137544
> 
> 赞同：19
> 
> 时间：2008-09-26T03:09:51.733
> 
> 标签：c#, assembly, x86

有没有可以通过 C# 调用的 x86 汇编器之类的东西？我希望能够将 x86 指令作为字符串传递并返回一个字节数组。如果一个不存在，我如何制作自己的？

明确一点——我不想从 C#*调用*汇编代码——我只想能够从指令中汇编代码并在字节数组中获取机器代码。

我将注入此代码（将即时生成）以完全注入另一个进程。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T08:28:46.897

作为我在个人项目中所做的一些早期原型设计的一部分，我编写了相当多的代码来做这样的事情。它不需要字符串——x86 操作码是 X86Writer 类上的方法。它根本没有记录，也远没有完全覆盖，但如果有兴趣，我愿意在新 BSD 许可下开源它。

**更新：** 好的，我已经创建了那个项目[——Managed.X86](http://code.google.com/p/managed-x86/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-10-31T03:45:50.213

看到这个项目：

[https://github.com/ZenLulz/MemorySharp](https://github.com/ZenLulz/MemorySharp)

该项目包装了 FASM 汇编器，它是用汇编语言编写的，并作为 Microsoft coff 对象编译，由 C++ 项目包装，然后再次用 C# 包装。这可以完全满足您的要求：给定一串 x86/x64 程序集，这将产生所需的字节。

如果你需要相反的，这里有一个 Udis86 反汇编程序的端口，完全移植到 C#，这里：

[https://github.com/spazzarama/SharpDisasm](https://github.com/spazzarama/SharpDisasm)

这会将字节数组转换为 x86/x64 的指令字符串

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-16T03:26:18.020

看看微软研究院的[Phoenix](http://research.microsoft.com/phoenix "凤凰")。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T03:44:10.747

不是直接来自 C#，你不能。但是，您可能会编写自己的包装类，该类使用外部汇编程序来编译代码。因此，您可能会将程序集写入文件，使用 .NET Framework 启动执行汇编程序的新进程，然后使用 System.IO 打开汇编程序生成的文件以提取字节溪流。

但是，即使您做了所有这些，如果您没有遇到安全问题，我也会感到非常惊讶。每个新操作系统都越来越不可能将可执行代码注入到完全不同的进程中。有了Vista，我相信你肯定会被拒绝。即使在 XP 中，我认为您在尝试写入另一个进程的内存时也会收到拒绝访问异常。

当然，这提出了为什么你需要这样做的问题。当然必须有更好的方法:)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T07:20:52.337

Cosmos 还为生成 x86 代码提供了一些有趣的支持：

[http://www.gocosmos.org/blog/20080428.en.aspx](http://www.gocosmos.org/blog/20080428.en.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T03:12:46.283

看看这个：[CodeProject：在 C# 中使用非托管代码和程序集](http://www.codeproject.com/KB/cs/unmanage.aspx)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T01:31:04.323

我认为您最好编写本机 Win32 dll。然后，您可以在汇编程序中编写一个从 dll 导出的函数。然后，您可以使用 C# 动态链接到 dll。

这与传入一个字符串并返回一个字节数组并不完全相同。为此，您需要一个 x86 汇编器组件，或 masm.exe 的包装器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T04:42:24.027

我不知道这是否是它的工作原理，但您可以只执行一个外部编译器，然后加载在您的字节数组中生成的对象。

# math - 编程是数学的一个子集吗？

> ID：137550
> 
> 赞同：67
> 
> 时间：2008-09-26T03:11:29.610
> 
> 标签：math

我多次听说所有编程实际上都是数学的一个子集。[一些人认为](http://c2.com/cgi-bin/wiki?ProgrammingIsMath)OO 从根本上讲是基于数学的，但除了一些明显的例子外，我不明白其中的联系：

*   使用归纳法证明递归算法，
*   形式正确性证明，
*   函数式语言，
*   λ演算，
*   渐近复杂度，
*   DFA、NFA、图灵机和一般的理论计算，
*   而且盒子上的所有东西都是二进制的。

我知道数学对编程非常重要，但我在这个“子集”视图中挣扎。以什么方式编程数学的子集？

我正在寻找一个可能与企业/OO 开发相关的解释，如果有足够强的连接，那就是。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-09-26T03:14:08.587

从某种意义上说，它是数学，它需要对算法等进行抽象思考。
当它涉及计划时间表、可交付成果、测试时，它是工程。
当你不知道最终结果如何时，这就是艺术。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-09-26T03:27:24.187

> *编程是应用数学中最难的分支之一；贫穷的数学家最好还是纯粹的数学家。*
> 
> ——EW 迪克斯特拉

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2008-09-26T03:26:40.570

总的来说，请记住数学是逻辑的正式编码，这也是我们在软件中所做的。

您问题中的主题列表充满了数学问题。我们能够在相当**高的抽象水平**上进行编程，因此原始数学可能不会让您眼前一亮。例如，您提到了 DFA。您可以在不知道任何数学知识的情况下在程序中使用正则表达式，但是当您想要设计一个好的正则表达式引擎时，您会发现对数学的需求更大。

我认为你找到了一个有趣的观点。编程是一门艺术，也是一门科学。有很多“交易工具”，你不一定要坐下来做很多高级数学才能简单地编写程序。事实上，当你在编程时，很多人并没有真正做太多的数学*或*计算机科学。

当我们开始解决计算机科学中的难题时，数学就出现了。你走得越深，它就会越充实……通常是在较低的抽象层次上。

还有一些编程领域你不一定要工作，但它们涉及更多的数学。例如，虽然您当然可以在没有任何形式数学的情况下学习一门语言并编写一些应用程序，但如果没有一些应用数学，您在**算法分析方面**不会走得太远。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-12-08T18:07:26.400

![](https://imgs.xkcd.com/comics/purity.png)

没有提到编程，但想法仍然是相关的。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2008-09-26T03:27:35.623

好的，我在大学时是数学和CS专业的。我会说如果集合 A 是 Math 而集合 B 是 CS，那么 A 与 B 相交。它不是一个子集。

毫无疑问，计算机科学的许多父亲和母亲都是像图灵和戴克斯特拉这样的数学家。互联网的大多数创始人都是数学、物理或工程学博士。计算机科学的大多数核心概念都来自数学，但编程行为并不是真正的数学。数学在我们的日常生活中帮助我们，但两者并不相同。

但毫无疑问，计算机背后的最初原因是很好地计算事物。在这么短的时间内，我们已经从那里走了很长一段路。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-09-26T03:33:48.307

爱因斯坦在 1917 年被称为著名的数学家。直到广岛，公众才终于意识到物理学不仅仅是应用数学。

当人们不理解某事时，他们会尝试将其理解为他们确实理解的某种事物。他们以类比的方式思考。编程被描述为一个数学、工程、科学、艺术、工艺、建筑的领域……这些都不是完全错误的；它借鉴了所有这些。真正的问题是编程领域只有大约 50 年的历史。人们还没有将它整合到他们的心理分类中。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2008-09-26T06:50:38.553

这里有很多混乱。

首先，“编程”（目前）不等于“计算机科学”。当 Dijkstra 称自己为“程序员”（或多或少发明了这个头衔）时，他并不是在开发 CRUD 应用程序，而是实际上在做应用计算机科学。让我们不要让这让我们感到困惑——今天，大多数程序员在商业环境中所做的事情与计算机科学之间存在巨大差异。

现在，可以说计算机科学是数学的一个分支。但是，正如 Knuth 指出的（在他的论文“计算机科学及其与数学的关系”中，收集在他*的计算机科学论文选集中*），也可以说数学是计算机科学的一个分支。

事实上，我强烈推荐这篇论文给任何思考数学和计算机科学之间关系的人，因为 Knuth 很好地展示了这个领域。

但是，回到您最初的问题：对于从业者来说，“企业/OO 开发”与数学相去甚远——但这主要是因为在较低级别的操作中涉及的大部分严肃数学已被抽象掉（由编译器、操作系统、指令集等）。同样，驾驶汽车也不需要具备内燃机物理学的高级知识。当然，如果你想设计一辆更高效的汽车......

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-09-26T03:23:35.960

如果您对数学的定义包括所有形式的形式逻辑，并且编程仅由代码中现有的逻辑和计算定义，那么编程是数学 QED 的子集；-)

但这就像说绘画只是将彩色颜料放在表面上——它完全忽略了艺术、洞察力、直觉和整个创作过程

有人可能会争辩说，音乐是数学的一个子集，同样的推理

所以我不得不说不，编程不是数学的一个子集。编程*使用*数学的一个子集，但也需要非数学技能/才能[很像音乐创作]

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-26T08:18:55.393

免责声明：我是一名 IT 顾问，主要开发门户和架构的东西。我有心理学学位。我在大学里从来没有学过数学。我完成了我的工作。而且通常很好。为什么？因为我认为您不需要了解数学（如“重”数学知识）来编写代码。你需要分析思维、解决问题的能力和高水平的抽象。但数学不会给你那个。这只是另一个需要类似技能的学科。在处理可用性问题和数据存储时，我在心理学方面的研究也适用于我的日常工作。语言学和符号学也发挥了作用。

但是等等，只是不要让我发火。我并不是说计算机根本不需要数学——显然，在设计加密算法和硬件等时你需要真正的数学技能——但是，作为许多程序员，如果你只是使用中/低级语言（像 C）或更高级别的东西（如 C# 或 java），主要使用预先构建的框架和 API，您并不需要了解傅立叶变换或霍夫曼树或莫比乌斯带背后的数学原理......让其他人处理那，让我在它之上建立价值。我不傻。我知道线性和指数算法以及数据结构等之间的区别。我只是没有兴趣重写快速排序或漂亮的新视频压缩技术。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-26T03:15:10.067

好吧，***除此之外***……！

数学用于编程的许多方面，例如

*   创建高效智能的算法
*   理解大 O 符号
*   安全性（例如 RSA）
*   还有更多……我认为编程需要数学才能生存。但我不会称它为子集。就像吹玻璃一样使用物理特性，但那些艺术家不称自己为物理学家。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-26T03:35:35.713

我们所做的一切的基础是数学。

幸运的是，我们不需要擅长数学本身就可以做到这一点。就像你不需要了解物理学来驾驶汽车甚至驾驶飞机一样。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-19T13:21:37.233

> 编程和纯数学的区别在于状态的概念。

看看[http://en.wikipedia.org/wiki/Dynamic_logic_(modal_logic)](http://en.wikipedia.org/wiki/Dynamic_logic_(modal_logic))。这是一种对随时间变化的事物进行数学分析的方法。此外，Hoare 三元组是一种形式化程序输入输出行为的方法。通过一些公理处理程序的顺序组合以及分配的工作原理，您可以完美地以数学上严格的方式处理状态随时间的变化。

如果你知道的数学不​​够，“发明”一些新的数学来处理你想要分析的东西。牛顿和莱布尼茨这样做是为了分析（我认为也就是微积分）。没有理由不为计算和编程而这样做。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-26T03:31:54.443

我不相信我听说过编程是数学的一个子集。即使您提供的链接也只是一种建议的编程方法（不声称它是数学的一个子集），并且 wiki 页面也有很多分歧。

编程需要（至少一些）应用数学。数学可以用来帮助描述和分析程序和程序片段。编程与数学有着非常密切的关系，并大量使用它和其中的概念。但是子集？不。

我很想看到有人真正声称这是一个有明确理由的人。我想我从来没有

> 仅仅因为你可以用数学来推理某事并不意味着它是，事实上，一个数学对象。数学用于推理内燃机、放射性衰变和杂耍模式。使用数学不是在做数学。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-26T03:58:13.287

我会说...

部分是数学，尤其是在理论层面。想象一下设计高效的搜索/排序/聚类/分配/fooifying算法，这就是数学......从数论到统计学的各个领域。

这部分是工程。复杂系统很少能达到理想的性能和可靠性水平，软件也不例外。许多软件开发都是为了在面对不可靠的硬件和（咳咳）人类时实现稳健性。

它部分是艺术。创造性和独特的软件设计经常会产生伟大的新想法……比如汇编语言、多任务操作系统、图形用户界面、动态语言和网络。

只是我的2美分...

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-26T04:16:33.807

数学+艺术+逻辑

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-26T06:07:09.937

你实际上可以争辩说，逻辑证明形式的数学类似于编程——

查看[库里-霍华德的对应关系](http://en.wikipedia.org/wiki/Curry-Howard_correspondence)。这可能更像是数学家看待事物的方式，但我认为这正中了众所周知的钉子。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-06-06T16:38:19.023

编程可能最初是作为数学的一个准子集开始的，但随着时间的推移，该领域日益复杂，导致编程成为为信息处理和计算创建良好抽象的艺术和科学。

编程确实涉及数学、工程和良好设计和实现的审美意识。算法是数学的延伸，系统工程方面在一定程度上与其他工程学科重叠。然而，无论是数学还是其他工程领域都对复杂、灵活且易于理解的抽象具有同等程度的需求，这些抽象可以在许多不同的层次上使用和调整，以解决新的和不断发展的问题。

对有用、灵活和动态抽象的需求首先导致了函数库的创建，然后是类/组件库，以及最近几年的设计模式和面向服务的架构。尽管后者更多地关注设计，但它们是对在编程问题和解决方案之间建立高级抽象桥梁的日益增长的需求的反应。

由于所有这些原因，编程既不是数学的子集，也不是数学的超集。它只是另一个使用数学的领域，其根源比其他领域更深。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2011-06-20T16:08:18.623

您列出的主题是理论计算机科学中的主题，这是纯数学的一个分支。编程是一门使用理论计算机科学的应用科学。编程本身不是数学的一个分支，而是编程语言所基于的 Lambda 微积分/计算理论/形式逻辑/集合论等。

我也完全不同意 Dijkstra。它要么是自我祝贺，要么是 Dijkstra 被错误引用/断章取义。纯数学是一个非常非常非常困难的领域。它是如此的抽象，以至于应用数学的任何一个分支在难度上都没有可比性。这是一个需要巨大想象力飞跃的领域。我获得了计算机科学的第一个学位，主要关注理论 CS 和编程、操作系统、编译器等应用领域。我还获得了电气工程学位——可以说是工程中最困难的分支——并研究了应用数学的困难领域，如麦克斯韦方程、控制理论和一般的偏微分方程。我还研究过应用数学和纯数学，直到今天我发现应用要容易得多。至于纯粹的数学家，

现在有人倾向于学习一两年的微积分而不受应用程序的影响，并得出结论认为纯数学很容易。他们不知道他们在说什么。研究微积分甚至是与应用无关的拓扑学并不能让您对纯数学家所做的事情有所了解。实际证明这些定理的任务非常困难，我将听从计算机科学家的意见来指出其中的区别：“如果 P = NP，那么世界将与我们通常假设的完全不同。有在“创造性的飞跃”中没有特别的价值，在解决问题和一旦找到解决方案之间没有根本的差距。每个能够欣赏交响乐的人都是莫扎特；每个能够循序渐进的论证的人都是高斯。 ..”

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2012-11-19T14:59:27.530

I think mathematics provides a set of tools for programmers which they use at abstract level to solve real world problems.

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-26T03:22:11.703

我想说的是，当我们升级到第四代语言时，编程不再像以前那样关注数学了。汇编非常关注数学，C#，而不是那么多。想法？

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-26T04:52:02.643

如果你只是想要你老板给你的设计规范，那么它的数学并不多，但这样的工作一点也不好玩......但是，想出如何做事确实需要数学思想，至少是东西像抽象，图表，有时是数论的东西，取决于问题，微积分。就个人而言，我参与编程的越多，我就越能看到它的数学方面。但是，在大多数情况下，IMO，您可以从图书馆中拿起这本书并查找您需要做的事情的基础知识，但这需要预先掌握一些数学知识。

如果不了解其背后的数学原理，您真的无法设计“好的”算法。在 google 中搜索只能带您到此为止。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-26T05:52:38.113

编程是一个太宽泛的主题。好的软件不仅基于数学（逻辑），还基于心理学、语言学等。算法是数学的一部分，但除了算法之外，还有许多其他与编程相关的东西。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-26T06:02:15.563

作为一名数学家，我很清楚数学不等于编程，但用于解决任一学科问题的过程都非常相似。

解决更高层次的数学问题需要分析性思维、解决问题的可能方法的工具箱、该领域的经验以及一些形式化的构建答案的方法，以便其他数学家同意。如果你找到了一种特别聪明、抽象或优雅的解决问题的方法，你会得到你的数学家同事的赞誉。对于特别困难的数学问题，您可以分阶段解决问题，并使用称为猜想和证明的东西编写您的阶段论据。

我认为编程涉及相同的技能集。在编程中，同样的一套原则适用于解决和提出问题的解决方案。当您对编程困境有部分解决方案时，您可以将其作为个人库的一部分，并在以后将其用作另一个更大问题的一部分。这些技能似乎与数学中使用的技能非常相似。

数学和编程之间的主要区别在于，与数学相比，后者在不同的编程学科之间有更多的共同点。数学的两个领域在表现形式和用于交流领域的内容上可能非常非常不同。相比之下，至少对我而言，编程结构在许多不同的语言中看起来非常相似。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-09-26T18:40:00.803

编程和纯数学的区别在于状态的概念。程序是使用逻辑（数学）在状态之间转换的状态机。用于在状态之间转换的实际逻辑通常非常简单，这就是为什么作为一名数学天才并不一定对程序员有那么大的帮助。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-02-19T13:55:08.870

我成为程序员的部分原因是我*不*喜欢数学。我对数学本身没有问题，从概念上讲我很好，我只是不喜欢手工计算。当我发现我可以告诉计算机数学问题是什么并让它为我计算时，我一生的激情和事业就诞生了。

为了回答这个问题，根据我的母校，数学 == 编程，因为他们允许我参加 C++ 简介来满足我的数学要求。

*编辑：* 我应该提到我的学位是电信专业，当时只有一学期的标准文科数学要求。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2010-10-16T05:42:38.197

数学是真理的最纯粹形式。一切都继承自数学。

阿门。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2010-03-13T01:35:13.327

将编程与音乐进行比较也很有趣。无论如何，在英国，有基于计算的本科大学课程将根据所涉及的逻辑，模式等原因，以音乐资格为基础接受申请者。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2011-02-26T17:11:09.477

数学很强大，编程很强大，如果数学是编程的一个子集，那么同样可以说编程是数学的一个子集。

数学是用语言描述的，通常是写下来的。因此，数学也是写作的一个子集吗？

从历史上看，数学先于计算机编程，但列表和过程可能先于数学，这两者都可以同样被认为是数学或与编程有关。

当然，编程可以用数学来表示，所以有一些基础可以证明编程是数学的一个子集。然而，计算机程序也可以实现数学，象征性地表示信息，就像数学通常在纸上完成时所做的那样，包括从基本公理出发的无限且仅在一定程度上定义的，以及允许定义相互使用的更高层次的结构和组合之外的其他类型的关系，支持图表的绘制并允许系统扩展。数学同样是编程的一个子集。

虽然数学可以表示诸如单词之类的结构，但数学是关于数字的设计。例如，字符串比数学更具编程性。

* * *

## 回答 #29

> 赞同：-5
> 
> 时间：2008-09-26T03:32:31.353

一半是数学，一半是人说话，呵呵。

# python - 如何使用 mechanize 库执行 HEAD 请求？

> ID：137580
> 
> 赞同：3
> 
> 时间：2008-09-26T03:20:19.027
> 
> 标签：python, http-headers, mechanize

我知道如何使用 httplib 进行 HEAD 请求，但我必须为该站点使用 mechanize。

本质上，我需要做的是从标头（文件名）中获取一个值，而无需实际下载文件。

有什么建议我可以如何做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T03:37:33.103

Mechanize 本身只发送 GET 和 POST，但您可以轻松扩展 Request 类以发送 HEAD。例子：

```
import mechanize

class HeadRequest(mechanize.Request):
    def get_method(self):
        return "HEAD"

request = HeadRequest("http://www.example.com/")
response = mechanize.urlopen(request)

print response.info() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-10-01T20:11:08.570

在机械化中，不需要做 HeadRequest 类等。

简单地

```
 import mechanize

br = mechanize.Browser()

r = br.open("http://www.example.com/")

print r.info() 
```

就这样。

# automation - 如何在 MS Word 中嵌入自定义用户控件？

> ID：137586
> 
> 赞同：2
> 
> 时间：2008-09-26T03:23:08.083
> 
> 标签：automation, ms-word

背景：环境是.Net 3.0 + WPF土地，数据库被抽象到远处，我猜该解决方案需要适用于Office 2000及更高版本..

需要获得用户希望在 Word 中显示某些应用程序窗口/框（例如趋势图）的定制报告。该窗口可以显示为静态图像，用户可以双击并编辑它（这将打开一个编辑器......类似于嵌入式电子表格的行为）并确定更新对象。在框周围键入一些文本并将其保存或打印。

还要考虑到，我需要一些机制来传递数据和**“数据绑定”**这些特定于应用程序的框。例如，图形可能必须绑定到它需要的特定时间范围的数据。

现在作为 Word 自动化的相对初学者，我需要为此使用的技术/子技术的名称是什么？还将任何建议发布到书籍/帖子中，以帮助您**理解并**尽快达到运行速度.. *（因为企业始终认为程序员足够聪明，可以弄清楚..我们可以给予他们完全的信任..但没有时间。）*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T03:35:49.863

我认为您将不得不考虑编写一个[OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding)可嵌入/兼容的应用程序。听起来这可能是一项非常庞大而复杂的任务。

Excel 是否有任何原因无法生成您嵌入的图表？

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-26T03:30:49.033

我强烈建议让它依赖于 Office 2007 及更高版本。如果这样做，您可以使用功能区并通过 VSTO 进行 .Net 编程。

# html - 在 Ruby 中解析网页的最佳方法是什么？

> ID：137605
> 
> 赞同：14
> 
> 时间：2008-09-26T03:31:55.237
> 
> 标签：html, xml, ruby, screen-scraping

我一直在 ruby​​forge 上查看 XML 和 HTML 库，以寻找一种从网页中提取数据的简单方法。例如，如果我想在 stackoverflow 上解析用户页面，如何将数据转换为可用格式？

假设我想解析我自己的用户页面以获取我当前的声誉分数和徽章列表。我试图将从我的用户页面检索到的源转换为 xml，但由于缺少 div，转换失败。我知道我可以进行字符串比较并找到我正在寻找的文本，但必须有更好的方法来做到这一点。

我想将其合并到一个简单的脚本中，该脚本在命令行中输出我的用户数据，并可能将其扩展为 GUI 应用程序。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-26T03:41:45.013

不幸的是，stackoverflow 声称是 XML，但实际上不是。 [然而， Hpricot](http://hpricot.com/)可以为您将此标签汤解析为元素树。

```
require 'hpricot'
require 'open-uri'

doc = Hpricot(open("http://stackoverflow.com/users/19990/armin-ronacher"))
reputation = (doc / "td.summaryinfo div.summarycount").text.gsub(/[^\d]+/, "").to_i 
```

等等。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T03:35:19.817

试试[hpricot](http://hpricot.com/)，它很好……太棒了

我已经多次使用它进行屏幕抓取。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-01-30T14:32:45.497

[**Hpricot结束了！**](https://github.com/hpricot/hpricot#hpricot-is-over)

现在使用**[Nokogiri](http://nokogiri.org/)**。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-27T17:33:29.813

我一直很喜欢 Ilya Grigorik 写的东西，他[写了一篇](http://www.igvita.com/2007/02/04/ruby-screen-scraper-in-60-seconds/)关于使用 hpricot 的好文章。

不久前我也[读过这篇文章](http://www.rubyrailways.com/data-extraction-for-web-20-screen-scraping-in-rubyrails)，看起来它对你很有用。

我自己也没做过，所以 YMMV 但这些看起来非常有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-27T19:59:44.613

我之前尝试这样做时遇到的问题是很少有网页是格式良好的 XML 文档。Hpricot 可能能够处理这个问题（我没有使用过），但是当我过去做一个类似的项目时（使用 Python 及其库的内置解析函数），它有助于有一个预处理器来清理HTML。[我为此使用了HTML Tidy](http://tidy.sourceforge.net/)的 python 绑定，它使生活变得更加轻松。Ruby 绑定在[这里，](http://tidy.rubyforge.org/)但我还没有尝试过。

祝你好运！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-16T15:17:08.797

这似乎是一个老话题，但这是一个新话题。获得声誉的示例：

```
#!/usr/bin/env ruby

require 'rubygems'
require 'hpricot'
require 'open-uri'

user = "619673/100kg"
html = "http://stackoverflow.com/users/%s?tab=reputation"

page = html % user
puts page

doc = Hpricot(open(page))
pars = Array.new
doc.search("div[@class='subheader user-full-tab-header']/h1/span[@class='count']").text.each do |p|
  pars << p
end

puts "reputation " + pars[0] 
```

# .net - 可以从 Dispose 或析构函数调用虚拟方法吗？

> ID：137621
> 
> 赞同：2
> 
> 时间：2008-09-26T03:36:24.073
> 
> 标签：.net, principles

我找不到对它的引用，但我记得读过在析构函数或 IDisposable 的 Dispose() 方法中调用虚拟（多态）方法不是一个好主意。

这是真的吗，如果是这样，有人可以解释为什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T05:46:42.420

从 finalizer/ 调用虚方法`Dispose`是不安全的，出于同样的原因[，在构造函数中这样做是不安全的](https://stackoverflow.com/questions/119506/virtual-member-call-in-a-constructor)。无法确定派生类尚未清除虚方法正确执行所需的某些状态。

有些人对标准的 Disposable 模式及其对虚拟方法的使用感到困惑`virtual Dispose(bool disposing)`，并认为这使得在 dispose期间使用*任何虚拟方法都可以。*考虑以下代码：

```
class C : IDisposable {
    private IDisposable.Dispose() {
        this.Dispose(true);
    }
    protected virtual Dispose(bool disposing) {
        this.DoSomething();
    }

    protected virtual void DoSomething() {  }
}
class D : C {
    IDisposable X;

    protected override Dispose(bool disposing) {
        X.Dispose();
        base.Dispose(disposing);
    }

    protected override void DoSomething() {
        X.Whatever();
    }
} 
```

这是当您 Dispose 和 type 的对象时发生的情况`D`，称为`d`：

1.  一些代码调用`((IDisposable)d).Dispose()`
2.  `C.IDisposable.Dispose()`调用虚方法`D.Dispose(bool)`
3.  `D.Dispose(bool)`处置`D.X`
4.  `D.Dispose(bool)``C.Dispose(bool)` **静态**调用（调用的目标*在编译时*已知）
5.  `C.Dispose(bool)`调用虚方法`D.DoSomething()`
6.  `D.DoSomething`调用`D.X.Whatever()`已经释放的方法`D.X`
7.  ?

现在，大多数运行此代码的人都会做一件事来修复它——他们`base.Dispose(dispose)`在清理自己的对象之前将调用移至。而且，是的，这确实有效。但是，您真的相信 Programmer X，来自您开发的公司的 Ultra-Junior Developer `C`，被分配到 write `D`，以一种检测到错误或`base.Dispose(disposing)`在正确位置调用的方式编写它？

我并不是说您永远不应该**编写**从 Dispose 调用虚拟方法的代码，只是您需要**记录**该虚拟方法的*要求*，即它永远不会使用在下面派生的任何类中定义的任何状态`C`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T03:41:01.287

在构造函数和析构函数中都不鼓励使用虚方法。

*原因比任何事情都更实际：可以以覆盖器选择的任何方式覆盖虚拟方法，并且必须确保*在构造过程中初始化对象等事情，以免最终得到一个具有随机空值和无效的对象状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T05:20:17.037

我不相信有任何反对调用虚拟方法的建议。您要记住的禁令可能是禁止在终结器中引用托管对象的规则。

.Net 文档中有一个标准模式定义了如何实现 Dispose()。该模式设计得非常好，应该密切关注。

要点是：Dispose() 是调用虚拟方法 Dispose(bool) 的非虚拟方法。布尔参数指示该方法是从 Dispose() (true) 还是对象的析构函数 (false) 调用的。在每个继承级别，都应该实现 Dispose(bool) 方法来处理任何清理工作。

当 Dispose(bool) 被传递值 false 时，这表明终结器已经调用了 dispose 方法。在这种情况下，只应尝试清理非托管对象（在某些极少数情况下除外）。原因是垃圾收集器刚刚调用了 finalize 方法，因此当前对象必须已标记为准备完成。因此，它引用的任何对象也可能已被标记为 read-for-finalization，并且由于序列是非确定性的，因此最终化可能已经发生。

我强烈建议您在 .Net 文档中查找 Dispose() 模式并准确地遵循它，因为它可能会保护您免受奇怪和困难的错误的影响！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T03:53:49.757

为了扩展 Jon 的答案，如果您需要处理该级别的资源，您应该覆盖子类上的 dispose 或析构函数，而不是调用虚拟方法。

虽然，我不相信这里的行为有“规则”。但一般的想法是，您希望将资源清理仅隔离到该实施级别的该实例。

# tdd - 测试驱动开发适合初学者吗？

> ID：137623
> 
> 赞同：10
> 
> 时间：2008-09-26T03:37:21.573
> 
> 标签：tdd

扩展这个关于我如何学会从[问题描述到代码](https://stackoverflow.com/questions/137375/)的问题 两个人提到了 TDD。

对于初学者来说，进入 TDD 会更好（并避免将来的坏习惯？）或者对于了解什么是编程语言的阶段来说太复杂了？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T03:39:49.057

TDD 意味着比“传统”方法（直到最后才测试它）更简单——因为测试阐明了您对问题的理解。如果您实际上并不清楚问题所在，那么编写测试非常困难。

因此，对于初学者来说，编写测试能让思维朝着正确的方向发展，这是合同行为，而不是实施行为。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T03:40:48.837

我希望 TDD 在我第一次学习编程时就在身边，并且我在变得如此根深蒂固的“旧方式”之前就已经学会了它，以至于我很难学习 TDD...

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T05:06:53.777

## 体验 TDD 规则 全部

我还认为，理想情况下，TDD 在学习的早期阶段会非常有帮助。事后看来，我知道它会帮助我以完全不同的方式解决问题。

我感到困惑的是，当一个人在学习时，会吸收很多新概念，以至于很早就开始出现混乱。因此，虽然我确实认为 TDD 会非常有帮助，但我不认为它可以是一个人自己成功学习的东西。

就像生活中的任何其他事情一样，当*有人亲自教*我们时，我们往往学得最好。向我们展示他们如何以 TDD 方式解决问题比在书本或网络上阅读更多。我的意思是，这不会有什么坏处，但它不能替代可以真正向您展示绳索的导师。

***体验 TDD 就是一切***，所以如果你能在早期阶段有人教你如何进行 TDD，我认为整个学习的速度将超出任何人的预期。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T03:48:21.970

```
def self.learn_tdd_and_programming_together?
  if you_have_tdd_mentor_sitting_next_to_you?
    "go for it"
  else
    if language.ruby?
      "it's possible, there is quite a bit of good stuff out 
      there that could give you a chance of learning programming 
      with TDD from the start. It's sort of in the ruby culture"
    elsif language.dot_net?
      "learn TDD after you learn the basics of .NET"  
    end
  end
end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T03:41:31.767

这肯定有很多东西要吸收，但是我已经说过我希望我开始编写单元测试。实际上，如果我在工作场所有一位可以指导我的 TDD 进展的导师，那将是一件好事。我已经断断续续地自学 TDD 大约一年了，有很多东西要涵盖，你做的越多，它就越投入，但现在它真的开始为我带来回报。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T03:42:01.453

我认为这条[评论](https://stackoverflow.com/questions/137375/process-to-pass-from-problem-to-code-how-did-you-learn#137485)说明了初学者直接学习可能是一件非常好的事情。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T03:58:58.230

我的编程座右铭是：

1.  让它运行——程序解决了问题
2.  做对——程序设计简洁，有少量重复
3.  让它快速——优化（如果需要）

测试驱动开发处理前两个。

我认为应该教初学者 TDD，以便他知道如何使程序运行。恕我直言，只有这样才能教授好的设计技巧。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T07:03:42.950

我想是的。研究甚至发现，**对初学者的好处是最大的**。它为您编写代码提供了更多指导。您知道结果和行为应该是什么，并编写测试。然后你写代码。**测试通过。你完成了。**你知道你已经完成了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T03:39:03.443

是的！确实。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T03:40:08.197

我认为这对于刚学习编程的人来说并不好。那个人怎么知道要断言什么？:P TDD 用于设计，而不是用于测试。一旦一个人知道如何编程，开始研究 TDD 方法将是一件好事。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T03:40:46.700

首先，您需要了解如何编写好代码。阅读、学习并实践它，直到你能很好地掌握它。一旦你有了它，看看测试驱动设计——它非常强大。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T03:45:08.733

TDD 的一个重要好处是定义完成度。在简单的算法编程中，如果您想出几个很容易断言正确性的场景，那么很容易在单元测试中枚举它们并继续编码直到它们都起作用。

有时单元测试对于初学者来说可能很难，如果有很多依赖项并且您开始遇到需要模拟对象的场景。

但是，如果您可以对正确性进行简单的陈述，并且易于输入，那么绝对可以将其写在代码中。

您可能还注意到，如果一个简单的正确性陈述不容易描述，您可能无法完全理解您的问题。

祝你好运...

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T03:50:54.880

这实际上取决于您对“启动器”的定义。如果“初学者”是指完全没有编程背景的人，那么不，我不认为 TDD 是一个很好的开始方式。在担心重构和测试驱动开发之前，程序员需要学习基础知识（避免无限循环、内存分配等）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T04:49:12.243

代码就是代码，无论它是你想要输出的东西，还是一个测试。

一开始就学习 TDD 有很大的价值。这是应该成为习惯的技能之一。我们当中有很多人理解并喜欢 tdd 的价值，但多年的编程已经养成了一些以后很难改掉的习惯。

就用于合同设计/代码实现/测试的 TDD 而言，这就是所有这些事情。TDD 会为您带来完美的代码吗？不，经验和学习工艺将帮助您成熟您的编码方法。但是对于每个开发人员来说，TDD 都是一个非常重要的工具。

TDD 的使用有望帮助您获得可测试的设计。可测试的设计在理论上封装得很好，应该遵循开放封闭原则。

在我看来，只要人们将 TDD 视为一种利基工具，或者在编写代码时以某种方式是可选的，那么这些人显然不会获得 TDD 的价值。

# opengl - 如何在 OpenGL 中将基元渲染为线框？

> ID：137629
> 
> 赞同：238
> 
> 时间：2008-09-26T03:39:30.273
> 
> 标签：opengl

如何在 OpenGL 中将基元渲染为线框？

* * *

## 回答 #1

> 赞同：392
> 
> 时间：2008-09-26T03:44:11.840

```
glPolygonMode( GL_FRONT_AND_BACK, GL_LINE ); 
```

打开，

```
glPolygonMode( GL_FRONT_AND_BACK, GL_FILL ); 
```

恢复正常。

请注意，如果启用了纹理映射和照明等内容，它们仍将应用于线框线，这看起来很奇怪。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-09-26T03:43:37.893

来自[http://cone3d.gamedev.net/cgi-bin/index.pl?page=tutorials/ogladv/tut5](https://web.archive.org/web/20090119194513/http://cone3d.gamedev.net/cgi-bin/index.pl?page=tutorials/ogladv/tut5)

```
// Turn on wireframe mode
glPolygonMode(GL_FRONT, GL_LINE);
glPolygonMode(GL_BACK, GL_LINE);

// Draw the box
DrawBox();

// Turn off wireframe mode
glPolygonMode(GL_FRONT, GL_FILL);
glPolygonMode(GL_BACK, GL_FILL); 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2015-10-07T23:45:48.803

假设在 OpenGL 3 及更高版本中具有向前兼容的上下文，您可以`glPolygonMode`按照前面提到的方式使用，但请注意，现在不推荐使用粗细超过 1px 的线条。因此，虽然您可以将三角形绘制为线框，但它们需要非常薄。在 OpenGL ES 中，您可以使用`GL_LINES`相同的限制。

在 OpenGL 中，可以使用几何着色器来获取传入的三角形，分解它们并将它们发送为光栅化，作为模拟粗线的四边形（实际上是三角形对）。真的很简单，只是几何着色器因性能缩放而臭名昭著。

您可以做的，以及在 OpenGL ES 中也可以使用的方法是使用*片段*着色器。考虑将线框三角形的纹理应用于三角形。除了不需要纹理外，它可以通过程序生成。但是说够了，让我们来编码吧。片段着色器：

```
in vec3 v_barycentric; // barycentric coordinate inside the triangle
uniform float f_thickness; // thickness of the rendered lines

void main()
{
    float f_closest_edge = min(v_barycentric.x,
        min(v_barycentric.y, v_barycentric.z)); // see to which edge this pixel is the closest
    float f_width = fwidth(f_closest_edge); // calculate derivative (divide f_thickness by this to have the line width constant in screen-space)
    float f_alpha = smoothstep(f_thickness, f_thickness + f_width, f_closest_edge); // calculate alpha
    gl_FragColor = vec4(vec3(.0), f_alpha);
} 
```

和顶点着色器：

```
in vec4 v_pos; // position of the vertices
in vec3 v_bc; // barycentric coordinate inside the triangle

out vec3 v_barycentric; // barycentric coordinate inside the triangle

uniform mat4 t_mvp; // modeview-projection matrix

void main()
{
    gl_Position = t_mvp * v_pos;
    v_barycentric = v_bc; // just pass it on
} 
```

在这里，重心坐标很简单`(1, 0, 0)`，对于三个三角形顶点（顺序并不重要，这使得打包成三角形条带可能更容易）。`(0, 1, 0)``(0, 0, 1)`

这种方法的明显缺点是它会吃掉一些纹理坐标并且你需要修改你的顶点数组。可以用一个非常简单的几何着色器来解决，但我仍然怀疑它会比仅仅向 GPU 提供更多数据要慢。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-11-01T22:09:48.337

如果您使用的是固定管道 (OpenGL < 3.3) 或兼容性配置文件，您可以使用

```
//Turn on wireframe mode
glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);

//Draw the scene with polygons as lines (wireframe)
renderScene();

//Turn off wireframe mode
glPolygonMode(GL_FRONT_AND_BACK, GL_FILL); 
```

在这种情况下，您可以通过调用[glLineWidth来更改线宽](https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glLineWidth.xhtml)

否则，您需要在您的绘图方法（glDrawElements、glDrawArrays 等）中更改多边形模式，并且您可能会得到一些粗略的结果，因为您的顶点数据用于三角形并且您正在输出线。为获得最佳结果，请考虑使用[几何着色器](https://www.khronos.org/opengl/wiki/Geometry_Shader)或为线框创建新数据。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-10-31T14:08:28.673

在现代 OpenGL（OpenGL 3.2 及更高版本）中，您可以为此使用几何着色器：

```
#version 330

layout (triangles) in;
layout (line_strip /*for lines, use "points" for points*/, max_vertices=3) out;

in vec2 texcoords_pass[]; //Texcoords from Vertex Shader
in vec3 normals_pass[]; //Normals from Vertex Shader

out vec3 normals; //Normals for Fragment Shader
out vec2 texcoords; //Texcoords for Fragment Shader

void main(void)
{
    int i;
    for (i = 0; i < gl_in.length(); i++)
    {
        texcoords=texcoords_pass[i]; //Pass through
        normals=normals_pass[i]; //Pass through
        gl_Position = gl_in[i].gl_Position; //Pass through
        EmitVertex();
    }
    EndPrimitive();
} 
```

注意事项：

*   对于点，更改`layout (line_strip, max_vertices=3) out;`为`layout (points, max_vertices=3) out;`
*   [阅读有关几何着色器的更多信息](https://open.gl/geometry)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-03-19T06:24:14.223

最简单的方法是将基元绘制为`GL_LINE_STRIP`.

```
glBegin(GL_LINE_STRIP);
/* Draw vertices here */
glEnd(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-12-24T22:16:34.157

使用这个函数： void glPolygonMode( GLenum face, GLenum mode);

face ：指定该模式适用的多边形。可以是多边形正面的 GL_FRONT 和背面的 GL_BACK 和两者的 GL_FRONT_AND_BACK 。

mode ：定义了三种模式，可以在 mode 中指定：

GL_POINT ：标记为边界边缘起点的多边形顶点被绘制为点。

GL_LINE ：多边形的边界边缘被绘制为线段。（你的目标）

GL_FILL ：填充多边形的内部。

PS：glPolygonMode 控制图形管道中用于光栅化的多边形的解释。

有关更多信息，请查看 khronos 组中的 OpenGL 参考页面： [https ://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glPolygonMode.xhtml](https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glPolygonMode.xhtml)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-04-14T11:13:01.453

您可以像这样使用 glut 库：

1.  对于一个球体：

    ```
    glutWireSphere(radius,20,20); 
    ```

2.  对于气缸：

    ```
    GLUquadric *quadratic = gluNewQuadric();
    gluQuadricDrawStyle(quadratic,GLU_LINE);
    gluCylinder(quadratic,1,1,1,12,1); 
    ```

3.  对于多维数据集：

    ```
    glutWireCube(1.5); 
    ```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-10-13T14:17:37.077

在非抗锯齿渲染目标上绘制抗锯齿线的一种简单而简单的方法是使用 1x4 纹理绘制 4 像素宽度的矩形，Alpha 通道值为 {0.,1.,1.,0.} , 并使用关闭 mip-mapping 的线性过滤。这将使线条厚 2 个像素，但您可以更改不同厚度的纹理。这比气压计算更快更容易。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2017-11-01T11:40:43.937

如果您正在处理的是**OpenGL ES 2.0**，您可以从

`GL_LINE_STRIP, GL_LINE_LOOP, GL_LINES,`画线，

`GL_POINTS`（如果您只需要绘制顶点），或者

`GL_TRIANGLE_STRIP`, `GL_TRIANGLE_FAN`, 和`GL_TRIANGLES`绘制实心三角形

作为你的第一个论点

```
glDrawElements(GLenum mode, GLsizei count, GLenum type, const GLvoid * indices) 
```

或者

`glDrawArrays(GLenum mode, GLint first, GLsizei count)`来电。

# sql - 在 named_scope 中封装 SQL

> ID：137630
> 
> 赞同：9
> 
> 时间：2008-09-26T03:39:31.820
> 
> 标签：sql, ruby-on-rails, named-scope

我想知道是否有办法在 named_scope 中使用“find_by_sql”。我想将自定义 sql 视为 named_scope，以便我可以将其链接到我现有的 named_scopes。这对于优化我经常使用的 sql 片段也很有用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-07T21:09:35.627

虽然您可以将任何您喜欢的 SQL 放在命名范围的条件中，但如果您随后调用，`find_by_sql`那么“范围”将被丢弃。

鉴于：

```
class Item
  # Anything you can put in an sql WHERE you can put here
  named_scope :mine, :conditions=>'user_id = 12345 and IS_A_NINJA() = 1'
end 
```

这行得通（它只是将 SQL 字符串粘贴在那里 - 如果你有多个它们与 AND 连接）

```
Item.mine.find :all
=> SELECT * FROM items WHERE ('user_id' = 887 and IS_A_NINJA() = 1) 
```

然而，这并不

```
Items.mine.find_by_sql 'select * from items limit 1'
=> select * from items limit 1 
```

所以答案是“不”。如果您考虑幕后必须发生的事情，那么这很有意义。为了构建 SQL rails 必须知道它是如何组合在一起的。
当您创建普通查询时，`select`, `joins`,`conditions`等都被分解成不同的部分。Rails 知道它可以在不影响其他所有内容的情况下向条件添加内容（这就是工作方式`with_scope`和`named_scope`工作方式）。

但是，您只需`find_by_sql`给 rails 一个大字符串。它不知道什么在哪里，所以它进入并添加它需要添加的东西以使范围工作是不安全的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T17:15:28.357

这并不能完全解决您所问的问题，但您可能会调查“construct_finder_sql”。它使您可以获取命名范围的 SQL。

```
named_scope :mine, :conditions=>'user_id = 12345 and IS_A_NINJA() = 1'
named_scope :additional {
  :condtions => mine.send(:construct_finder_sql,{}) + " additional = 'foo'"
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T03:43:11.513

确定为什么不

:named_scope :conditions => [你的 sql ]

# java - 在使用 Java 读入时，如何将输入流通过管道传输到压缩文件？

> ID：137645
> 
> 赞同：7
> 
> 时间：2008-09-26T03:43:38.190
> 
> 标签：java, zip, inputstream

我想执行一个程序，并在它运行时读取它的输出并将输出输出到一个压缩文件中。程序的输出可能非常大，所以我们的想法是不要在内存中保存太多 - 只是在我得到它时将它发送到 zip。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T03:51:49.667

```
ZipOutputStream targetStream = new ZipOutputStream(fileToSaveTo);
ZipEntry entry = new ZipEntry(nameOfFileInZipFile);
targetStream.putNextEntry(entry);

byte[] dataBlock = new byte[1024];
int count = inputStream.read(dataBlock, 0, 1024);
while (count != -1) {
    targetStream.write(dataBlock, 0, count);
    count = inputStream.read(dataBlock, 0, 1024);
} 
```

换句话说：

1.  您创建一个`ZipOutputStream`，给它您要写入的文件。
2.  您创建一个`ZipEntry`，它构成该 zip 文件中的一个文件。即当您打开 myFile.zip 时，其中有 3 个文件，每个文件都是一个`ZipEntry`.

3.  你把它`ZipEntry`放进你的`ZipOutputStream`

4.  创建一个字节缓冲区来读取您的数据。
5.  从您的字节缓冲区中读取`inputStream`，并记住计数。
6.  虽然`count`不是`-1`，但将该字节 byffer 写入您的`zipStream`.
7.  阅读下一行。

完成后关闭您的流。用你认为合适的方法包装它。

# .net - IoC 容器 - 哪个最好？（。网）

> ID：137647
> 
> 赞同：2
> 
> 时间：2008-09-26T03:44:07.877
> 
> 标签：.net, inversion-of-control, containers

我想了解人们对 IoC 容器的使用情况。我读过一些关于温莎城堡的好东西，但我知道很多人使用 StructureMap、Unity、Ninject 等。

提到的那些（以及我忽略的）之间有什么区别。强项？弱点？更合适（比如 StructureMap 对 ABC 很好，但对 XYZ 不太好）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-12T20:26:58.497

我非常喜欢 Ninject... 简单、易用，它具有这种流畅的符号来声明类和接口之间的绑定，并支持上下文绑定。惊人的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T03:45:20.837

“最佳”永远是主观的。

也就是说，我喜欢 Castle Windsor，因为它的 XML 更简单。顺便说一句，我只尝试过 Windsor 和 Spring.NET，所以我不能对其他人说太多。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T03:46:30.180

我喜欢结构图。最新版本也允许您声明内联，而无需求助于 XML 配置文件。

# deployment - 免费安装向导软件

> ID：137657
> 
> 赞同：65
> 
> 时间：2008-09-26T03:47:07.010
> 
> 标签：deployment, installation, release-management

[有没有可以免费使用的InstallShield](http://en.wikipedia.org/wiki/InstallShield)之类的东西？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-09-26T04:09:51.870

**[维克斯](http://wix.sourceforge.net/)**

*   **非常强大和灵活**。
*   可以生成 MSI 包（选择的 Microsoft 部署格式）
*   **几乎没有文档**
*   **非常陡峭的学习曲线。**
*   基于 XML。
*   推荐用于非常复杂的安装人员。

**[创新设置](http://www.innosetup.com/isinfo.php)**

*   无法生成 MSI 包。
*   **它的脚本部分看起来像 INI 文件结构。**
*   使用基于 Pascal 脚本的语言以获得额外的灵活性。

**[国家安全情报局](http://nsis.sourceforge.net/Main_Page)**

*   无法生成 MSI 包。
*   完全脚本化，非常强大，但以高学习曲线为代价。
*   **如果 WiX 太多而 Inno Setup 不够，建议使用。**

**[高级安装程序](http://www.advancedinstaller.com)**

*   基本版是免费的。
*   可以生产MSI包。
*   **非常好的用户界面，几乎没有学习曲线来完成任务。**
*   基于 XML（但模式不是非常用户友好，并不重要，因为无论如何您都会使用 GUI 编辑器）
*   如果您只有基本的安装要求并且没有时间学习新东西，这是最好的选择。

**[伊兹包](http://izpack.org/)**

*   **跨平台**
*   Maven 集成
*   可定制的动作
*   有据可查
*   开源

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-26T03:55:40.487

我已经使用[Inno Setup](http://www.innosetup.com/isinfo.php)好几年了。它已经足够成熟了，它有很多插件。我发现论坛/新闻组非常擅长回答我迄今为止遇到的所有问题。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-26T03:49:20.983

NullSoft NSIS [http://nsis.sourceforge.net/Main_Page](http://nsis.sourceforge.net/Main_Page)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-26T03:48:28.490

[WiX](http://wix.sourceforge.net/) (Windows Installer XML) 是免费的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-26T06:25:03.730

[Inno Setup](http://www.innosetup.com/isinfo.php)多年来一直作为[Zeus](http://www.zeusedit.com)安装程序运行良好。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T03:49:11.657

我搜索了“免费安装程序”并找到了[Advanced Installer](http://www.advancedinstaller.com/)，我记得我过去曾成功使用过它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-30T10:47:09.917

我也会考虑[dotNetInstaller](http://dotnetinstaller.codeplex.com/)。

使用先决条件设置安装非常容易，有一个很好的向导和一个编辑器，可以从表单管理 xml 脚本。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-06T18:36:20.977

+1 为 Inno。我不是 NSIS/Nullsoft 的粉丝。

编辑

我不喜欢 NSIS 的原因是为了获得安装程序标题/脚本中的版本信息，我不得不跳槽。基本上你必须预处理脚本或运行安装生成器两次。也许他们修好了，也许没有。但真是麻烦。

我还发现插件的版本和主要组件的版本都很脆弱。例如，当混合和匹配/升级时，事情并不顺利。

我们必须保留特定版本的 NSIS 和我们在存储库中使用的插件，以确保我们拥有它们。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T03:50:29.220

[Nullsoft Installer](http://nsis.sourceforge.net/Main_Page)是要走的路。它有一个陡峭的学习曲线，但是一旦你完成了脚本，你很快就会有一个像样的安装程序。也请查看 Eclipse 插件，这是一个很好的补充。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-19T20:59:09.210

我正在寻找一个类似的解决方案，并发现该街区的新孩子是[InstallJammer](http://www.installjammer.com/)。开源，非常友好和强大的外观（我说外观是因为我从未在项目中真正使用过它），能够为多个平台生成安装程序。

Actions in particular seemed very easy to set up.

If it were to live up to it's goals, it would easily give the other install solutions a run for their money.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T03:49:31.577

如果我没记错的话，有一个以 WinAmp 开头的开源[Nullsoft Installer 。](http://nsis.sourceforge.net/Main_Page)

对于 .NET 开发，您可能想看看微软也开源的[WiX 。](http://wix.sourceforge.net/)IT 非常适合那些具有持续集成设置的人。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T03:49:44.417

NSIS（nullsoft 可编写脚本的安装程序系统）将完成这项工作。它是开源的。

[http://nsis.sourceforge.net/Main_Page](http://nsis.sourceforge.net/Main_Page)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T03:49:51.450

[Nullsoft 安装程序](http://nsis.sourceforge.net/Main_Page)免费、功能强大且非常非常好。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T03:49:51.733

nullsoft[脚本安装系统](http://nsis.sourceforge.net/Main_Page)是一个开源解决方案，提供了一个非常强大和专业的安装系统。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-26T04:06:54.063

我们在这里使用[MakeMSI](http://dennisbareis.com/makemsi.htm)来构建 Windows 安装程序。非常陡峭的学习曲线，但保证可以在任何 Windows 系统上工作。

过去我们在使用 Nullsoft 安装程序时遇到过问题，因为默认情况下不支持静默、自动安装（一直在托管环境中完成的那种安装）。

# c++ - C++ 中 std::map 的持久性

> ID：137659
> 
> 赞同：10
> 
> 时间：2008-09-26T03:47:18.883
> 
> 标签：c++, map, persistence

您是否知道任何简单或简单的方法可以使映射对象（来自 STL 库）持久化（即将其写入文件），以便稍后在程序运行时恢复其状态？

谢谢你的帮助

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T03:51:14.803

我相信[Boost 序列化](http://www.boost.org/doc/libs/1_36_0/libs/serialization/doc/index.html)库能够序列化 std::map，但标准库本身没有提供任何方法。序列化是一个很棒的库，具有很多特性，并且易于使用并可以扩展到您自己的类型。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-26T03:55:55.040

如果您想手动执行此操作，与保留任何其他容器结构的方式相同，请将各个部分写入磁盘：

```
outputFile.Write(thisMap.size());
for (map<...>::const_iterator i = thisMap.begin(); i != thisMap.end(); ++iMap)
{
    outputFile.Write(i->first);
    outputFile.Write(i->second);
} 
```

然后将它们读回：

```
size_t mapSize = inputFile.Read();
for (size_t i = 0; i < mapSize; ++i)
{
    keyType key = inputFile.Read();
    valueType value = inputFile.Read();
    thisMap[key] = value;
} 
```

显然，您需要根据您的地图类型和文件 i/o 库来进行工作。

否则尝试[boost 序列化](http://www.boost.org/doc/libs/1_36_0/libs/serialization/doc/index.html)，或[谷歌的新序列化库](http://code.google.com/apis/protocolbuffers/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T03:54:05.527

答案是序列化。具体取决于您的需求和环境。对于初学者，请查看 Boost 序列化库： http: [//www.boost.org/doc/libs/1_36_0/libs/serialization/doc/index.html](http://www.boost.org/doc/libs/1_36_0/libs/serialization/doc/index.html)

# asp.net - Console.WriteLine 在 ASP.NET 中的位置在哪里？

> ID：137660
> 
> 赞同：347
> 
> 时间：2008-09-26T03:47:41.097
> 
> 标签：asp.net, iis, console.writeline

在一个 J2EE 应用程序（比如在 WebSphere 中运行的应用程序）中，当我使用 时`System.out.println()`，我的文本会转到标准输出，它由 WebSphere 管理控制台映射到一个文件。

在 ASP.NET 应用程序（如在 IIS 中运行的应用程序）中，输出`Console.WriteLine()`到哪里去？IIS进程必须有stdin、stdout和stderr；但是 stdout 是否映射到 /dev/null 的 Windows 版本，还是我在这里遗漏了一个关键概念？

我**不是在问**我是否应该在那里登录（我使用 log4net），但输出到哪里去了？我最好的信息来自这个[讨论](http://www.velocityreviews.com/forums/t91075-where-does-consolewriteline-goto.html)，他们说`Console.SetOut()`可以更改`TextWriter`，但它仍然没有回答关于控制台的初始值是什么的问题，或者如何在运行时代码的配置/外部设置它。

* * *

## 回答 #1

> 赞同：799
> 
> 时间：2009-05-18T21:24:46.363

如果使用`System.Diagnostics.Debug.WriteLine(...)`代替`Console.WriteLine()`，则可以在 Visual Studio 的**输出**窗口中看到结果。

* * *

## 回答 #2

> 赞同：210
> 
> 时间：2009-09-16T10:05:01.097

如果您查看[.NET Reflector](http://en.wikipedia.org/wiki/.NET_Reflector)`Console`中的类，您会发现如果一个进程没有关联的控制台，并且由（包装在 a中）支持，这是一个基本忽略所有输入的虚拟实现，并且没有输出。`Console.Out``Console.Error``Stream.Null``TextWriter``Stream`

所以它在概念上等同于`/dev/null`，但实现更加精简：没有实际的 I/O 发生在 null 设备上。

此外，除了调用之外`SetOut`，没有办法配置默认值。

**2020-11-02 更新**：由于这个答案在 2020 年仍在收集投票，​​可能应该注意的是，在 ASP.NET Core 下，通常*会*附加一个控制台。您可以配置[ASP.NET Core IIS 模块](https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/aspnet-core-module)`stdoutLogEnabled`以通过和设置将所有 stdout 和 stderr 输出重定向到日志文件`stdoutLogFile`：

```
<system.webServer>
  <aspNetCore processPath="dotnet"
              arguments=".\MyApp.dll"
              hostingModel="inprocess"
              stdoutLogEnabled="true"
              stdoutLogFile=".\logs\stdout" />
<system.webServer> 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2010-10-09T15:32:41.000

我通过尝试将 DataContext 的 Log 输出更改为输出窗口发现了这个问题。所以对于其他试图做同样事情的人来说，我所做的就是创建这个：

```
class DebugTextWriter : System.IO.TextWriter {
   public override void Write(char[] buffer, int index, int count) {
       System.Diagnostics.Debug.Write(new String(buffer, index, count));
   }

   public override void Write(string value) {
       System.Diagnostics.Debug.Write(value);
   }

   public override Encoding Encoding {
       get { return System.Text.Encoding.Default; }
   }
} 
```

之后：dc.Log = new DebugTextWriter() 我可以在输出窗口中看到所有查询（dc 是 DataContext）。

看看这个以获取更多信息：[http ://damieng.com/blog/2008/07/30/linq-to-sql-log-to-debug-window-file-memory-or-multiple-writers](http://damieng.com/blog/2008/07/30/linq-to-sql-log-to-debug-window-file-memory-or-multiple-writers)

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2013-10-22T16:38:11.737

如果您使用 IIS Express 并通过命令提示符启动它，它将使[DOS](http://en.wikipedia.org/wiki/DOS)窗口保持打开状态，您将`Console.Write`在那里看到语句。

例如，打开一个命令窗口并输入：

```
"C:\Program Files (x86)\IIS Express\iisexpress" /path:C:\Projects\Website1 /port:1655 
```

这假设您在 C:\Projects\Website1 有一个网站目录。它将启动 IIS Express 并为您的网站目录中的页面提供服务。它将打开命令窗口，您将在那里看到输出信息。假设您在那里有一个文件 default.aspx，其中包含以下代码：

```
<%@ Page Language="C#" %>
<html>
<body>
    <form id="form1" runat="server">
    Hello!

    <% for(int i = 0; i < 6; i++) %>
       <% { Console.WriteLine(i.ToString()); }%>

    </form>
</body>
</html> 
```

安排浏览器和命令窗口，以便您可以在屏幕上看到它们。现在在浏览器中输入：`http://localhost:1655/`. 你会看到你好！在网页上，但在命令窗口中，您会看到类似

```
Request started: "GET" http://localhost:1655/
0
1
2
3
4
5
Request ended: http://localhost:1655/default.aspx with HTTP status 200.0 
```

我通过将代码放在标记中的代码块中使其变得简单，但是[代码隐藏](http://en.wiktionary.org/wiki/code-behind)或代码中其他任何地方的任何控制台语句也将在这里显示。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-09-19T06:34:53.767

`System.Diagnostics.Debug.WriteLine(...);`将其放入Visual Studio 2008 中的*即时窗口。*

转到菜单*Debug* -> *Windows* -> *Immediate*：

![在此处输入图像描述](https://i.stack.imgur.com/yq68G.png)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-26T14:32:23.643

默认情况下根本没有控制台监听。在调试模式下运行时附加了一个控制台，但在生产环境中，正如您所怀疑的那样，消息不会去任何地方，因为没有人在听。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-26T04:10:10.857

除非您在严格的控制台应用程序中，否则我不会使用它，因为您无法真正看到它。我会使用 Trace.WriteLine() 来获取可以在生产中打开和关闭的调试类型信息。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-03-02T22:09:15.743

ASP.NET 中的`TraceContext`对象写入到`DefaultTraceListener`哪个输出到主机进程的[标准输出](https://en.wikipedia.org/wiki/Standard_streams#Standard_output_.28stdout.29)。而不是 using `Console.Write()`，如果您使用`Trace.Write`，输出将转到进程的标准输出。

您可以使用该`System.Diagnostics.Process`对象为您的站点获取 ASP.NET 进程并使用该`OutputDataRecieved`事件监视标准输出。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-12-28T02:45:03.307

如果你碰巧在你的 ASP.net 项目中使用了 NLog，你可以添加一个[Debugger 目标](https://github.com/NLog/NLog/wiki/Debugger-target)：

```
<targets>
    <target name="debugger" xsi:type="Debugger"
            layout="${date:format=HH\:mm\:ss}|${pad:padding=5:inner=${level:uppercase=true}}|${message} "/> 
```

并将日志写入此目标以获得所需的级别：

```
<rules>
    <logger name="*" minlevel="Trace" writeTo="debugger" /> 
```

现在你有控制台输出，就像 VS 的“输出”窗口中的 Jetty 一样，并确保你在调试模式（F5）下运行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-08-04T23:48:54.430

当涉及到 IISExpress 时，这让每个人都感到困惑。没有什么可以读取控制台消息的。因此，例如，在 ASPCORE MVC 应用程序中，它使用 appsettings.json 进行配置，如果您使用的是 IISExpress，它什么也不做。

现在你可以添加 loggerFactory.AddDebug(LogLevel.Debug); 在您的配置部分，它至少会在调试输出窗口中显示您的日志。

好消息 CORE 2.0 这一切都将改变：[https ://github.com/aspnet/Announcements/issues/255](https://github.com/aspnet/Announcements/issues/255)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-03-05T09:37:35.227

Mac，在调试模式下，有一个用于输出的选项卡。 [![在此处输入图像描述](https://i.stack.imgur.com/ZFU1Q.png)](https://i.stack.imgur.com/ZFU1Q.png)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-11-26T09:02:54.790

使用 console.Writeline 对我不起作用。

有什么帮助是放置一个断点，然后在调试时运行测试。当它到达断点时，您可以观察返回的内容。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-12-12T14:46:53.193

尝试以我们在节点控制台中执行的方式附加有点“后端调试器”以将您的消息或数据记录到控制台或输出窗口。

`System.Diagnostics.Debug.WriteLine("Message" + variable)`代替`Console.WriteLine()`

通过这种方式，您可以在 Visual Studio 的输出窗口（即控制台）中看到结果。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2008-09-26T03:57:38.437

在 ASP.NET 应用程序中，我认为它会转到在调试期间可见的输出或控制台窗口。

# c# - 如何在 Ruby 中实现多态性？

> ID：137661
> 
> 赞同：14
> 
> 时间：2008-09-26T03:47:45.667
> 
> 标签：c#, ruby, polymorphism

在 C# 中，我可以这样做：

```
class Program
{
    static void Main(string[] args)
    {
        List<Animal> animals = new List<Animal>();

        animals.Add(new Dog());
        animals.Add(new Cat());

        foreach (Animal a in animals)
        {
            Console.WriteLine(a.MakeNoise());
            a.Sleep();
        }
    }
}

public class Animal
{
    public virtual string MakeNoise() { return String.Empty; }
    public void Sleep()
    {
        Console.Writeline(this.GetType().ToString() + " is sleeping.");
    }
}

public class Dog : Animal
{
    public override string MakeNoise()
    {
        return "Woof!";
    }
}

public class Cat : Animal
{
    public override string MakeNoise()
    {
        return "Meow!";
    }
} 
```

显然，输出是（稍微解释一下）：

*   纬
*   狗在睡觉
*   喵
*   猫在睡觉

由于 C# 经常因其冗长的类型语法而受到嘲笑，您如何处理诸如 Ruby 之类的鸭子类型语言中的多态性/虚拟方法？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-26T19:34:48.190

到目前为止，所有答案对我来说都很好。我想我只是提到整个继承的事情并不是完全必要的。暂时排除“睡眠”行为，我们可以使用鸭子类型来实现整个期望的结果，并且根本不需要创建一个 Animal 基类。谷歌搜索“duck-typing”应该会产生任何数量的解释，所以在这里我们只说“如果它像鸭子一样走路并且像鸭子一样嘎嘎......”

“睡眠”行为可以通过使用 mixin 模块来提供，例如 Array、Hash 和其他 Ruby 内置类，包括 Enumerable。我并不是说它一定更好，只是一种不同的，也许是更惯用的 Ruby 方式。

```
module Animal
  def sleep
    puts self.class.name + " sleeps"
  end
end

class Dog
  include Animal
  def make_noise
    puts "Woof"
  end
end

class Cat
  include Animal
  def make_noise
    puts "Meow"
  end
end 
```

你知道剩下的...

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-26T03:49:52.310

编辑：为您更新的问题添加了更多代码

免责声明：我一年左右没有使用 Ruby，也没有在这台机器上安装它，所以语法可能完全错误。但概念是正确的。

* * *

完全相同的方式，使用类和重写方法：

```
class Animal
    def MakeNoise
        return ""
    end
    def Sleep
        print self.class.name + " is sleeping.\n"
    end
end

class Dog < Animal
    def MakeNoise
        return "Woof!"
    end
end

class Cat < Animal
    def MakeNoise
        return "Meow!"
    end
end

animals = [Dog.new, Cat.new]
animals.each {|a|
    print a.MakeNoise + "\n"
    a.Sleep
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-26T05:31:50.253

使用惯用的 Ruby

```
class Animal
  def sleep
    puts "#{self.class} is sleeping"
  end
end

class Dog < Animal
  def make_noise
    "Woof!"
  end
end

class Cat < Animal
  def make_noise
    "Meow!"
  end
end

[Dog, Cat].each do |clazz|
  animal = clazz.new
  puts animal.make_noise
  animal.sleep
end 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T04:02:06.290

基于先前的答案，您可以这样做吗？

* * *

澄清后的第二次切割：

```
class Animal
    def MakeNoise
        raise NotImplementedError # I don't remember the exact error class
    end
    def Sleep
        puts self.class.to_s + " is sleeping."
    end
end

class Dog < Animal
    def MakeNoise
        return "Woof!"
    end
end

class Cat < Animal
    def MakeNoise
        return "Meow!"
    end
end

animals = [Dog.new, Cat.new]
animals.each {|a|
    puts a.MakeNoise
    a.Sleep
} 
```

（我将保持原样，但“self.class.name”胜过“.to_s”）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-27T18:21:31.570

鸭子类型的原理只是对象必须响应被调用的方法。所以类似的东西也可以解决问题：

```
module Sleeping
  def sleep; puts "#{self} sleeps"
end

dog = "Dog"
dog.extend Sleeping
class << dog
  def make_noise; puts "Woof!" end
end

class Cat
  include Sleeping
  def to_s; "Cat" end
  def make_noise; puts "Meow!" end
end

[dog, Cat.new].each do |a|
  a.sleep
  a.make_noise
end 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-25T21:00:54.783

manveru 解决方案的一个小变种，它基于类类型的数组动态创建不同类型的对象。没有什么不同，只是更清晰一点。

```
Species = [Dog, Cat]

Species.each do |specie|
  animal = specie.new   # this will create a different specie on each call of new
  print animal.MakeNoise + "\n"
  animal.Sleep
end 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T07:23:05.043

我会这样写：

```
class Animal
  def make_noise; '' end
  def sleep; puts "#{self.class.name} is sleeping." end
end

class Dog < Animal; def make_noise; 'Woof!' end end
class Cat < Animal; def make_noise; 'Meow!' end end

[Dog.new, Cat.new].each do |animal|
  puts animal.make_noise
  animal.sleep
end 
```

它与其他解决方案并没有*真正*的不同，但这是我更喜欢的风格。

这是 12 行与原始 C# 示例中的 41 行（实际上，您可以使用集合初始化程序减少 3 行）。不错！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-05-10T11:44:15.807

有一种`becomes`实现多态性的方法（通过将所有实例变量从给定类复制到新类）

```
class Animal
  attr_reader :name

  def initialize(name = nil)
    @name = name
  end

  def make_noise
    ''
  end

  def becomes(klass)
    became = klass.new
    became.instance_variables.each do |instance_variable|
      value = self.instance_variable_get(instance_variable)
      became.instance_variable_set(instance_variable, value)
    end

    became
  end
end

class Dog < Animal
  def make_noise
    'Woof'
  end
end

class Cat < Animal
  def make_noise
    'Meow'
  end
end

animals = [Dog.new('Spot'), Cat.new('Tom')]

animals.each do |animal|
  new_animal = animal.becomes(Cat)
  puts "#{animal.class} with name #{animal.name} becomes #{new_animal.class}"
  puts "and makes a noise: #{new_animal.make_noise}"
  puts '----'
end 
```

结果是：

```
Dog with name Spot becomes Cat
and makes a noise: Meow
----
Cat with name Tom becomes Cat
and makes a noise: Meow
---- 
```

*   多态性可能有助于避免`if`声明（[antiifcampaign.com](http://antiifcampaign.com/)）

*   如果您使用`RubyOnRails` `becomes`的方法已经实现：[`becomes`](http://edgeapi.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-becomes)

*   快速提示：如果您将多态性与[STI](http://api.rubyonrails.org/classes/ActiveRecord/Inheritance.html)混合使用，它将为您带来重构代码的最有效组合

我希望它对你有帮助

# apache - Apache 仅在输入密码时重定向

> ID：137679
> 
> 赞同：2
> 
> 时间：2008-09-26T03:50:38.673
> 
> 标签：apache, mod-rewrite, phpmyid

我在我的一台机器上设置了 phpMyID，并且我试图让 apache 仅在提交密码时才重定向到 HTTPS。我这样做是因为我重定向所有 openid 流量的原始设置不起作用 stackoverflow 不喜欢我的自签名证书。这是我写的新规则，但它不起作用：

```
RewriteRule http://%{SERVER_NAME}/openid/index.php(\?.+)$ https://%{SERVER_NAME}/openid/index.php$1 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T03:54:07.167

您需要使用 Cond 来测试端口（http 或 httpd）和查询字符串：

```
RewriteCond %{SERVER_PORT} 80
RewriteCond %{QUERY_STRING} (.+)
RewriteRule /openid/index.php https://%{SERVER_NAME}/openid/index.php?%1 
```

如果在 .htaccess 上，您必须改用

```
RewriteCond %{SERVER_PORT} 80
RewriteCond %{QUERY_STRING} (.+)
RewriteRule openid/index.php https://%{SERVER_NAME}/openid/index.php?%1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T13:39:22.303

更好的解决方案是：

```
    RewriteCond %{SERVER_PORT} !^443$
    重写规则 ^openid/index\.php$ https://%{SERVER_NAME}/openid/index.php

```

说明：`RewriteCond %{SERVER_PORT} 80`也匹配仅包含`80`. 这同样适用于模式`openid/index.php`（其中“<code>.”也可以是任何字符）。并且不需要附加查询，因为 mod_rewrite 会自动将最初请求的查询附加到替代项，除非给出了替代项的查询。

# c# - C# 3 个新功能帖子（与 .Net 3.5 功能无关）

> ID：137688
> 
> 赞同：10
> 
> 时间：2008-09-26T03:53:07.857
> 
> 标签：c#, .net, .net-3.5, c#-3.0

.Net Framework 3.5 附带了许多新功能。主题列表中的大多数帖子和信息都同时包含有关 3.5 新功能和 C# 3 更改的内容。但是 C# 3 可以在没有 .Net 3.5 的情况下使用。有谁知道描述语言变化的好帖子？（除了[MSDN](http://msdn.microsoft.com/en-us/library/bb308966.aspx)上无聊的、明确的官方规范之外。）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T03:56:35.053

更新：我当然可以理解。Eric Lippert 有一些更深入的帖子。[查看它们](http://blogs.msdn.com/ericlippert/archive/tags/C_2300_/Lambda+Expressions/default.aspx)。

* * *

我喜欢[scottgu](http://weblogs.asp.net/scottgu/archive/2007/03/08/new-c-orcas-language-features-automatic-properties-object-initializers-and-collection-initializers.aspx)关于新语言功能的系列文章。这里还有一些更多信息[http://www.danielmoth.com/Blog/2007/11/top-10-things-to-know-about-visual .html](http://www.danielmoth.com/Blog/2007/11/top-10-things-to-know-about-visual.html)尤其是关于语言特性的部分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T12:25:14.790

在我的 C# in Depth 网站上有一个[“快速而肮脏”的列表](http://csharpindepth.com/Articles/General/BluffersGuide3.aspx)（这也有点讽刺）：

为了对 Charles Graham 的帖子做出一些回应，我有一篇[文章](http://csharpindepth.com/Articles/Chapter1/Versions.aspx)介绍了面向 .NET 2.0 时语言功能的适用性：

就像一个公然的插件一样，如果您对语言而不是框架感兴趣，[C# in Depth](http://www.manning.com/affiliate/idevaffiliate.php?id=876_230)与我所见过的“仅语言”书一样接近。它也分为两部分（在介绍之后）：C# 2 中的新特性和 C# 3 中的新特性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T03:59:27.730

Scott Guthrie 有一系列[很好的博客文章](http://weblogs.asp.net/scottgu/archive/2007/11/19/visual-studio-2008-and-net-3-5-released.aspx)，描述了很多改进。向下滚动到“语言改进和 LINQ”。

[Lambda 表达式](http://weblogs.asp.net/scottgu/archive/2007/04/08/new-orcas-language-feature-lambda-expressions.aspx)
[匿名类型](http://weblogs.asp.net/scottgu/archive/2007/05/15/new-orcas-language-feature-anonymous-types.aspx?CommentPosted=true)
[自动属性和对象/列表初始化器](http://weblogs.asp.net/scottgu/archive/2007/03/08/new-c-orcas-language-features-automatic-properties-object-initializers-and-collection-initializers.aspx)
[扩展方法](http://weblogs.asp.net/scottgu/archive/2007/03/13/new-orcas-language-feature-extension-methods.aspx)
[查询语法](http://weblogs.asp.net/scottgu/archive/2007/04/21/new-orcas-language-feature-query-syntax.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T04:04:45.987

查看 Eric White 的C# 3.0 函数式编程[教程](http://blogs.msdn.com/ericwhite/pages/FP-Tutorial.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T03:56:55.070

这是我特别想了解自己的一件事。我可以告诉您的一件事是，如果您在 VS 2008 中执行多目标，C# 3.0 中的许多新功能实际上将在纯 2.0 应用程序中工作。我知道扩展方法就是这样的一件事。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-24T08:18:41.663

这是帮助我快速了解新功能的一系列文章

[http://blah.winsmarts.com/2006/05/19/demystifying-c-30--part-4-lambda-expressions.aspx](http://blah.winsmarts.com/2006/05/19/demystifying-c-30--part-4-lambda-expressions.aspx)

# soa - WebMethods ESB 是否可扩展？

> ID：137699
> 
> 赞同：1
> 
> 时间：2008-09-26T03:56:13.230
> 
> 标签：soa, esb, webmethods

我正在寻找具有将 WebMethods ESB 扩展到大流量（消息大小和消息数量）的经验的人。怎么样了？是否有任何问题，您是如何解决的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-09T10:23:48.330

从我处理过的环境（从 4 到 1000 个服务器）来看，它的扩展性非常好。

这在很大程度上取决于您管理的信息传输技术的类型。

最快**的是**专有的 webMethods Broker，它在配置良好的服务器上每天可以轻松处理数百万条 >100kb 的消息。

如果您直接在代理上使用 JMS 传输（在本机代理格式上没有转换/重新推送），额外的消息处理步骤会稍微减慢它（但新的 7.1.2 版本已经大大改进）。

其他类型的传输（无状态 Web 服务和其他）通常不涉及 ESB，但您的物流架构可能会有所不同，因此没有明确的答案。

*大多数时候*，克隆集群或非集群系统中的组件就足够了（该过程主要受 IO 限制，因此您*可能*会在虚拟化 [或半虚拟、容器、系统] 上获得良好的结果；有时您确实需要更多金属。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T11:50:28.600

AFAIK，人们使用 webMethods 得到了一些不错的数字（但他们不使用 webMethods 聚类）。webMethods 流程可以扩展，但缺点是它们不会在每个阶段持续存在。如果您不使用流程，则应该可以进行缩放。

# automated-tests - 你用 WaTiR 吗？

> ID：137711
> 
> 赞同：2
> 
> 时间：2008-09-26T03:59:57.357
> 
> 标签：automated-tests, integration-testing, watir, functional-testing, web-testing

有没有比[WaTiR](http://wtr.rubyforge.org/)更好的单元测试工具来进行 Ruby Web 测试？还是事实上的标准？你使用什么单元测试工具？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T04:07:28.070

我们将它用于我们所有的 Web 应用程序测试，而不仅仅是基于 ruby​​ 的 Web 应用程序。我们确实研究了许多产品，但认为 WaTiR 是最好的。另外它是用 Ruby 编写的，所以我们可以拍拍自己的后背，并互相告诉对方我们使用 Ruby 有多酷。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T01:31:14.490

在仔细研究了服务员之后，我的团队决定使用 Selenium。

众多原因包括：

*   Steven 提到的 Selenium 具有更好的浏览器和跨平台支持。我们目前有运行 mac、linux 和 windows 的机器，带有 safari、firefox 和 ie。

*   Selenium 测试似乎比 waitr 运行得更快，特别是如果您利用 selenium 网格。

*   Selenium 测试可以用比 Ruby 更广泛的语言编写。

*   Selenium 有一个易于使用的 IDE。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T05:11:02.800

用作网络爬取工具。正如我所听说的，WaTiR 也非常适合测试。请注意，每个浏览器都有自己的 WaTir 版本：WaTiR(IE)、FireWaTir(Firefox) 和 SafariWatiR(Safari)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T00:24:48.147

我觉得我不能将其中任何一个标记为答案。

根据我从回复中看到的情况，如果您坚持使用 Ruby 作为测试语言，WaTiR 是最好的语言之一。

由于跨浏览器支持和与语言无关的方法，我个人同意 Ryan Guest 关于 Selenium 的看法。另一方面，它使用自己的语言，所以要学习更多的东西。

Scott Hanselman 有一个名为“[功能测试工具综述](http://www.hanselminutes.com/default.aspx?showID=11)”的播客，其中谈到了这个问题。

归根结底，我认为答案是，如果 WaTiR 适合您的情况，它是一个很好的测试工具。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-05T13:04:51.677

自 2007 年以来，我一直在使用 Watir，但更多的是作为脚本工具而不是单元测试工具。

作为手动测试人员，它对于一些重复性任务非常有用，但我从来没有真正“正确”地使用它（创建测试用例来查看哪些功能失败了等等）。

另外，我已经向我的一些程序员朋友展示了 Watir，他们在开发用 Java、PHP 甚至 ASP 编写的系统时使用它来帮助他们，所以仅仅因为 Watir 是一个 Ruby 项目，这并不意味着你应该只在其他 Ruby 项目中使用它:)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-17T18:36:04.237

我使用 Watir 进行功能测试。

对于单元测试，如果可能的话，恕我直言，最好使用诸如 webrat 或 capybara 之类的“无头浏览器”解决方案，因为它们速度更快，并且不会因需要调用浏览器实例等而使事情复杂化。

您希望单元测试快速，以便它们可以在每个 CI 构建中运行。然后创建一个通宵构建，并让它运行你的功能测试，这样如果它们需要几个小时才能运行，这没什么大不了的。（一旦您获得了包含数千个功能/验收/回归测试的大型套件，即使使用更快的浏览器（例如新的 IE9、Firefox 或 Chrome）也需要数小时才能运行。

我还应该指出，通过新的 Watir-Webdrive 项目，您可以获得两全其美的效果。易于编码、非常“Rubyesque”的 Watir API，以及 selenium Webdriver 后端的广泛浏览器支持（IE、FF、Chrome、Opera、Headless）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-17T19:08:25.743

值得注意的是，FireWatir 项目已被纳入 Watir 核心，并于[上周 1.6.2 版本](http://www.io.com/~wazmo/blog/archives/2008_11.html#000288)中集成了代码库。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T04:15:15.430

几年前我们看过 WaTiR 并出于各种原因决定反对它，主要是因为与 selenium 相比更易于使用（如编写代码与可视化工具）。

值得一提的是，进行测试构建的人不是开发人员，更不用说 Ruby 开发人员了。

这也不适用于 ruby​​ 应用程序，但由于它是 web 并且 web 服务于 HTML，它应该不关心它是用什么构建的。

# macos - Aquamacs Emacs 中的拼写检查不起作用：“错误的字节序顺序。”

> ID：137717
> 
> 赞同：1
> 
> 时间：2008-09-26T04:02:28.067
> 
> 标签：macos, emacs, spell-checking, aquamacs

这是 macbook 上的 aquamacs 1.5。我尝试拼写检查时的确切错误：

错误：文件“/Library/Application Support/cocoAspell/aspell6-en-6.0-0//en-common.rws”的格式不正确。错误的字节顺序。

补充：我确实有错误版本的 cocoAspell。但是，直到我真正擦除（或重命名）/Library/Application Support/cocoAspell 并从头开始重新安装，安装正确的版本才起作用。这就是让我陷入困境的原因。感谢您的快速回答！Stackoverflow 摇滚！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T04:36:30.777

我相信你的 Mac 的 Aspell 的 coco 接口版本错误。

检查此站点并下载适当的版本（PowerPC/Intel）： http: [//people.ict.usc.edu/~leuski/cocoaspell/](http://people.ict.usc.edu/~leuski/cocoaspell/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T04:37:59.213

我不确定，但这个页面看起来很相似： [http://www.emacswiki.org/cgi-bin/wiki/AquamacsFAQ](http://www.emacswiki.org/cgi-bin/wiki/AquamacsFAQ) （在该页面上搜索“格式”以找到相关部分）

您是否一直在使用 fink 安装旧版本的 aspell，就像这篇文章中一样？

# java - 哪个 Linux 发行版最适合 Java Web 应用程序？

> ID：137720
> 
> 赞同：10
> 
> 时间：2008-09-26T04:04:09.047
> 
> 标签：java, mysql, linux, hosting, alfresco

有很多 Linux 发行版可供选择！对于主要运行的 Web 托管环境，什么是“最佳”Linux 风格：Apache HTTP、Tomcat 或 JBoss、MySQL 和 Alfresco（不一定都在同一个实例中）。

在管理和配置的便利性、此类应用程序的性能和稳定性等方面是否存在显着差异？

你会推荐什么？

谢谢！麦克风

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T04:11:20.713

他们都使用类似的工具来管理 webmin 和 sshd 之类的东西。

你更熟悉什么。基于 Red Hat 的系统（fedora、mandriva）或基于 Debian 的系统（Ubuntu）。这种家庭分裂将决定一些事情。第一个 rpm 打包 vs deb 打包。

您还想查看项目的活动水平。Mandriva 和 Ubuntu 是活跃发行版的两个例子。这试图跟上当前的软件版本。

除此之外，大多数东西的表现几乎没有什么区别。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T06:28:59.057

您可能还想考虑[OpenSolaris](http://opensolaris.org/)，因为它来自最初开发 Java 的同一家公司，而且我听说过它比 Linux 更好地支持线程，并且在 Java 中线程非常重要。

更新：由于 Oracle 将 OpenSolaris 的分发模型更改为更商业化的模型，您可能需要查看开源分支[OpenIndiana](http://openindiana.org/)（感谢 sed 引起我的注意）。Oracle 似乎仍在提供非开放的 Solaris，并且还拥有 Java，因此请自行决定。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T04:10:06.177

不，不是。

这实际上更多取决于您安装的软件包而不是您运行的发行版。

为了稳定，人们总是推荐 Cent OS，因为它是穷人 RHE（因为它基本上是 RHE，但像啤酒一样免费）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T20:11:38.803

这完全取决于您使用的工具（尤其是商业工具）。大多数 Linux 的东西都是为 RHEL（Redhat Enterprise Linux）提供的，所以你通常最好使用它。Centos 是基于 RHEL 的免费发行版（实际上它几乎相同），因此给定供应商的东西通常在那里工作相同。

It also depends on hardware support. If you're using (for example) Dell servers, they support RHEL, but probably not e.g. Ubuntu so you really want to use a distro which is supported by your hardware vendor or their tools may not work.

It's not a case of "best" for hosting web applications, but for use in a commercial hosted environment. We use Centos so we can use RHEL stuff.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T04:45:26.857

我通常对普通的旧 Debian 很好（Ubuntu 有它的警告，有时会在错误的时间打你）。当然，它需要预先进行一些配置，但一旦配置好，它就会像任何东西一样稳定。我通常不使用存储库，除非它们是非常通用的东西，而是自己从 deb 包中编译东西。它可以更好地控制您真正想要对系统执行的操作，并且您可以在一定程度上进行优化。目前，我在 Debian 上运行 Tomcat 6 几个月，没有任何大问题。

然而，我认为 debian 家族更友好地实现即使你真的不太了解的东西，或者如果你想快速实现一些东西，或者如果你正在网站上尝试一些东西。在一个理想的世界里，我会在不同的机器或 chroot 中进行测试，但是嘿，我有时只是一个懒惰的系统管理员 :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T13:18:19.640

我一直在玩一个完整的 Sun 堆栈，到目前为止它似乎运行良好。

*   开放式Solaris
*   玻璃鱼
*   MySQL

我使用 Grails 部署在 Groovy 中开发的 .war 文件，但是部署 PHP 和 Ruby 解决方案的选项越来越多。如果成本很重要，Sun 将非常积极地与托管公司合作，以提供为期一年的免费托管。我没有遇到太多障碍，但有时我必须查找命令语法，因为我以前没有使用过 Solaris。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-11-21T17:18:02.767

You mentioned running Alfresco. You should look at the [Supported Platforms page](https://www.alfresco.com/services/subscription/supported-platforms) for the version you are planning on installing (even if you are installed Community Edition).

Most people running Alfresco use either Ubuntu Server or CentOS/Red Hat Enterprise Linux.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T05:51:07.277

您提到了 Linux 和 Java。您没有*提到*Appserver、LDAP 服务器、数据库服务器等其他东西。

考虑到这些因素，最好使用 Redhat、Fedora、CentOS 和 SUSE/OpenSUSE。Ubuntu 不会受到伤害，因为它们与 Sun 有关系，但由于 JBoss 已成为 REdhat 的一部分，我认为基于 Redhat 的发行版应该相当不错。

我使用 Redhat/Fedora 和 OpenSUSE 来运行银行生产应用程序，它们非常好。戴尔为 Redhat + JAVA + ORACLE 提供了良好的支持。

# xml - 将 csv/excel 转换为 xml 的工具

> ID：137721
> 
> 赞同：2
> 
> 时间：2008-09-26T04:04:25.753
> 
> 标签：xml, excel

作为标题，但希望灵活地指定输出 xml 文件的外观。我可以使用 Windows 平台上的任何免费工具来实现这一目标吗？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T19:12:38.147

使用 XSLT 获得所需的输出格式。

CSV -> CSV2XML -> XSLT -> XML

XSLT 是“指定输出 xml 文件的外观”的真正而直接的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T04:13:57.710

您可以将其读入数据集并使用数据集的 WriteXML 方法输出到 XML。

看起来[这个人](http://ajwelch.blogspot.com/2007/02/csv-to-xml-converter-in-xslt-20.html)使用了 XSLT。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T19:17:33.033

您可以使用[DBUnit](http://dbunit.sourceforge.net/)和 Java：

```
import java.io.ByteArrayOutputStream;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.OutputStream;
import org.dbunit.dataset.DataSetException;
import org.dbunit.dataset.IDataSet;
import org.dbunit.dataset.excel.XlsDataSet;
import org.dbunit.dataset.xml.FlatXmlDataSet;

public class XlsToXml {
    public static void main(String[] args) {    
        try {
            FileInputStream stream = new FileInputStream(args[0]);
            IDataSet dataset = new XlsDataSet(stream);
            OutputStream out = new ByteArrayOutputStream();
            FlatXmlDataSet.write(dataset, out);
            System.out.println(out);
        } catch (Exception e) { 
            e.printStackTrace();
        }
    }        
} 
```

这将为您提供单元格作为属性。如果您希望 XML 格式不同，请使用 XmlDataSet 而不是 FlatXmlDataSet。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-17T15:27:28.033

我需要将 CSV 文件转换为相应的 XML 表示，如下所示：

CSV

```
header1;header2;header3
data1;data2;data3
data4;data5;data6 
```

XML

```
<?xml version="1.0" encoding="UTF-8"?>
<root>
    <row>
        <header1>data1</header1>
        <header2>data2</header2>
        <header3>data3</header3>
    </row>
    <row>
        <header1>data4</header1>
        <header2>data5</header2>
        <header3>data6</header3>
    </row>
</root> 
```

我发现这个工具正是我所需要的（虽然它是德语的）：[CSV2XML](http://www.oio.de/public/konverter/csv2xml.htm)

它是用 Java 编写的，带有一个带有一点 Swing UI 的 .jar 文件。它在输入和输出格式方面也是可配置的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-10T19:46:55.110

最简单的方法是使用[http://xmlgrid.net](http://xmlgrid.net)在线工具将 csv 或 Excel xls/xlsx 转换为 XML。转换后的 XML 将显示在 XML 网格编辑器中，允许您更改元素/属性名称、删除或添加行/列。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T04:14:39.363

由于它是开源的，您应该会找到所需的灵活性。[http://csv2xml.sourceforge.net/](http://csv2xml.sourceforge.net/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T04:15:44.713

我认为您正在寻找的是[Microsoft LogParser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)。杰夫不久前发表了一篇[关于](http://www.codinghorror.com/blog/archives/000369.html)它的文章。如果您需要，这里是[论坛](http://forums.iis.net/default.aspx?GroupID=51)，但它非常简单。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T16:16:18.807

我还没有尝试过[，](http://www.thescarms.com/dotnet/XSLT.aspx)但看起来它可以解决您的问题。

祝你好运！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-10-30T20:05:41.893

您可以使用 Elev.at ( [http://elev.at](http://elev.at) ) 从 XLS 转换为 XML。它是一个免费的网络 API。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-12-01T12:43:32.487

我有一个需要从 CSV 转换为 XML 的示例数据。这里有两个在线工具可以满足这一需求：

1.  [将 CSV 转换为 XML](https://tableconvert.com/csv-to-xml)

2.  [将 Excel 转换为 XML](https://tableconvert.com/excel-to-xml)

**CSV**

```
id,name
1,Roberta
2,Oliver
3,Shayna 
```

**输出 XML：**

```
<?xml version="1.0" encoding="UTF-8" ?>
<root>
    <row><id>1</id><name>Roberta</name></row>
    <row><id>2</id><name>Oliver</name></row>
    <row><id>3</id><name>Shayna</name></row>
</root> 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-26T04:19:35.420

嗯..我正在寻找更多现成的工具，而不是真正用于编程目的，我在发布之前检查了这个[http://csv2xml.sourceforge.net/](http://csv2xml.sourceforge.net/)但它缺乏我配置输出格式的灵活性，

# installation - 免费的多平台安装程序

> ID：137723
> 
> 赞同：10
> 
> 时间：2008-09-26T04:05:25.330
> 
> 标签：installation, cross-platform, izpack

扩展[免费安装向导软件](https://stackoverflow.com/questions/137657/free-insaller)我正在寻找一个跨平台安装程序。我们支持 27 种平台变体，其他问题中提到的大多数安装程序仅适用于 Windows。我们正在寻找可移植的东西，可能是基于 java 的，但我想任何脚本语言也可以。建议？

编辑：按每个操作系统下的平台数量顺序：linux、solaris、windows、hpux、aix、zlinux、bsd、OSX、OS/360（我不关心这个）。因此，在没有 VMS 或大型机的情况下，您可以获得尽可能多的变化。许多 linux 平台都是相似的，只是 libc 的版本不同。但是我们在运行操作系统的每个处理器上都支持 32 位和 64 位。例如，我们支持 4 个 solaris 平台：

*   太阳能sparc 32
*   太阳能sparc 64
*   Solaris x86 32 位
*   Solaris x86 64 位

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T04:07:35.840

[伊兹包](http://izpack.org/)？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T04:20:41.080

我不知道任何免费的跨平台的，抱歉。我确实知道我认识的几家商业公司都对[BitRock](http://bitrock.com/)发誓。有很多用它构建的 Linux 堆栈。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T18:10:57.743

如果您的项目是开源的，您可以免费使用[BitRock 的 Install Builder](http://bitrock.com/products_installbuilder_opensource.html)。[wxWidgets 网站上的这个页面](http://www.wxwidgets.org/docs/technote/install.htm)列出了许多不同的平台安装程序，并描述了每个安装程序的各种问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-29T21:07:59.930

你应该看看[InstallJammer](http://www.installjammer.com/)。免费、开源且非常易于使用，同时功能强大，几乎可以满足您的任何需求。开箱即用支持大多数平台。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T08:57:15.897

我也建议

[http://packjacket.sourceforge.net/](http://packjacket.sourceforge.net/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T05:07:35.010

以下是一些列表：[Java 中的开源安装程序生成器](http://java-source.net/open-source/installer-generators)。

# php - 如何上传带有用户名、密码、多个文件上传的 HTML 表单，然后使用 PHP 处理它？

> ID：137730
> 
> 赞同：-3
> 
> 时间：2008-09-26T04:08:55.103
> 
> 标签：php, html, forms, upload

如何从单个 html 表单发布用户名、密码和多个二进制文件并使用 php 处理？我不允许使用ajax。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T05:28:00.000

首先在 PHP.net 上查看这些页面

1.  [文件上传信息](http://us3.php.net/features.file-upload)
2.  [`move_uploaded_file`](http://us3.php.net/manual/en/function.move-uploaded-file.php)

但是为了让你开始，这里有几个存根文件。

**上传表单.html**

```
<html>
<body>
    <form action="processStuff.php" enctype="multipart/form-data" method="POST">
        username: <input type="text" name="username" />
        password: <input type="password" name="password" />

        <p>
            <input type="file" name="uploadFile[]" /><br />
            <input type="file" name="uploadFile[]" /><br />
            <input type="file" name="uploadFile[]" /><br />
            <!-- Add as many of these as you want -->
        </p>

        <p>
            <input type="submit" />
        </p>
    </form>
</body>
</html> 
```

**processStuff.php**

```
<pre>
<?php

    echo '<h2>Username & password</h2>'
    echo "Username: {$_POST['username']}\nPassword: {$_POST['password']}";
    echo '<hr />';

    echo '<h2>Uploaded files</h2>'  
    foreach($_FILES['uploadFile']['tmp_name'] as $i => $tempUploadPath) {
        if (empty($tempUploadPath)) {
            // this <input type="file" /> was "blank"... no file selected
        } else {
            // a file was uploaded
            echo '<strong>A file named "', $_FILES['uploadFile']['name'][$i], "\" was uploaded</strong>\n";
            echo "\ttemporarily stored at: ", $tempUploadPath, "\n";            
            echo "\tmime type: ", $_FILES['uploadFile']['type'][$i], "\n";
            echo "\tsize: ", $_FILES['uploadFile']['size'][$i], " bytes\n";         
            echo "\terror code", 
            ((empty($_FILES['uploadFile']['size'][$i]) 
                    ? '<em>no errror</em>' 
                    : $_FILES['uploadFile']['size'][$i])), 
            "\n\n";

    // do something useful with the uploaded file 
        // access it via $tempUploadPath and use move_uploaded_file() to move 
        //     it out of the temp path before you manipulate it in any way!!!!!
        // see http://us3.php.net/features.file-upload
        // and http://us3.php.net/manual/en/function.move-uploaded-file.php
        }       
    }

?>
</pre> 
```

HTML 文件展示了如何设置`enctype`第二`<form>`个表单，展示如何访问提交的用户名和密码，最后如何循环遍历每个上传的文件。

如前所述，您必须尽快移动文件。它们被上传到临时位置，除非您处理它们，否则系统将删除它们。所以先把它们移到某个地方，然后用它们做任何你需要的事情。

希望这有帮助

阿林

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T04:16:07.177

您应该使用`$_FILES`超全局和`move_uploaded_file()`函数来查看哪些文件已成功上传，并将它们移动到最终位置，以防万一。

超`$_POST`全局将包含提交的用户名和密码。

# c - 如何在 C 中通过 SSL 使用 POP3

> ID：137741
> 
> 赞同：1
> 
> 时间：2008-09-26T04:13:48.227
> 
> 标签：c, ssl, pop3

我想知道并理解使用纯 c 语言从 pop3 服务器获取邮件所涉及的步骤

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T04:33:45.293

脚步：

1.  [使用OpenSSL](http://www.openssl.org/docs/ssl/ssl.html)连接到服务器的端口（通常为 995）
2.  验证证书
3.  通过您刚刚打开的 SSL 套接字发送常规 pop3 命令。（LIST、RETR 等）
4.  检索响应
5.  关闭插座

或者使用为您完成上述所有操作的库

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T04:32:30.600

使用已经存在的数千个库之一，例如[libspopc](http://brouits.free.fr/libspopc/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T04:41:34.057

使用诸如[tinymail](http://tinymail.org/trac/tinymail/wiki)之类的库，它使用 OpenSSL 库。

# .net - MDIParent 平铺儿童

> ID：137743
> 
> 赞同：6
> 
> 时间：2008-09-26T04:14:29.833
> 
> 标签：.net, winforms, parent, mdi, mdiparent

有什么方法可以轻松地平铺 mdi 父级的所有表单子级？我正在寻找 Windows 提供的大部分功能，即 tile cascade。有谁知道一个简单的方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T04:19:57.433

试试这些...

```
// Tile all child forms horizontally.
this.LayoutMdi( MdiLayout.TileHorizontal );

// Tile all child forms vertically.
this.LayoutMdi( MdiLayout.TileVertical );

// Cascade all MDI child windows.
this.LayoutMdi( MdiLayout.Cascade ); 
```

# ant - 我可以使用 ANT 任务更新签名的 jar 吗？

> ID：137745
> 
> 赞同：1
> 
> 时间：2008-09-26T04:14:46.040
> 
> 标签：ant, jar, java-web-start, signing

您好我正在尝试使用 webstart 部署应用程序。我需要更新一个在我实际部署之前签名的 jar（基本上是为了更新 IP/端口信息）。我正在尝试使用 ANT 来更新 jar。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T04:21:13.310

我不能专门谈论 ANT 或 JAR 文件。但一般来说，签名的目的之一是防止篡改代码。修改代码后，签名将不再有效，这是设计使然。进行更新后，您必须重新签署 JAR 文件。

# .net - .NET 中通过字符串键或数字索引查找的最佳数据结构是什么？

> ID：137753
> 
> 赞同：6
> 
> 时间：2008-09-26T04:16:46.037
> 
> 标签：.net, data-structures, collections, ordereddictionary

我正在寻找最理想的数据结构（为了性能和易用性），可以通过字符串键或索引从中检索值。字典不起作用，因为您无法真正按索引检索。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T05:15:02.573

你想要[OrderedDictionary](http://msdn.microsoft.com/en-us/library/system.collections.specialized.ordereddictionary.aspx)类。您将需要包含 System.Collections.Specialized 命名空间：

```
 OrderedDictionary od = new OrderedDictionary(); 
    od.Add("abc", 1); 
    od.Add("def", 2); 
    od.Add("ghi", 3); 
    od.Add("jkl", 4); 

    // Can access via index or key value:      
    Console.WriteLine(od[1]);       
    Console.WriteLine(od["def"]); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T04:25:23.877

有 System.Collections.ObjectModel。**KeyedCollection< string,TItem>**，派生自 Collection< TItem>。**检索是 O(1)**。

```
class IndexableDictionary<TItem> : KeyedCollection<string, TItem>
 { Dictionary<TItem, string> keys = new Dictionary<TItem, string>();

   protected override string GetKeyForItem(TItem item) { return keys[item];}

   public void Add(string key, TItem item) 
    { keys[item] = key;
      this.Add(item);
    }
 } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T08:15:52.497

一句话警告。除了插入和查找之外，大多数操作的**性能**`OrderedDictionary`都非常差：删除和修改值都可能需要对整个列表进行线性搜索，从而导致运行时*O* ( *n* )。（对于修改，这取决于是按索引还是按键进行访问。）

 ****对于大多数具有合理数据量的操作，这是完全不能接受的。此外，数据结构将元素存储在线性向量和哈希表中，导致一些内存开销。

如果按索引检索不经常发生，a **`SortedList`**or**`SortedDictionary`**将具有更好的性能特征（可以通过`ElementAt`扩展方法实现按索引访问）。

另一方面，如果按索引访问是常态，那么请停止使用字典数据结构，只需将值存储在**`List<KeyValuePair<TKey, TValue>>`**. 尽管这意味着通过密钥进行线性搜索，但所有其他操作都非常便宜，并且在实践中整体性能难以超越。

/EDIT：当然，后者也是理论上意义上的字典数据结构。您甚至可以将其封装在实现适当接口的类中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T04:20:13.423

基于哈希的集合（字典、哈希表、哈希集）已经过时了，因为你没有索引，因为你想要一个索引，我会使用嵌套的泛型：

```
List<KeyValuePair<K,V>> 
```

当然，您会丢失使用散列获得的 O(1) 密钥查找。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T08:17:13.337

字典可以与 linq 一起使用。虽然我不知道可能的性能问题。Dictionary.ElementAt(index);

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T13:23:18.677

我建议使用 SortedDictionary<string, TValue> 或 SortedList<string, TValue>。两者都有 O(log n) 的搜索性能。

[正如MSDN 库](http://msdn.microsoft.com/en-us/library/f7fta44c.aspx)所引用的，区别在于：

> SortedList<(Of <(TKey, TValue>)>) 使用的内存比 SortedDictionary<(Of <(TKey, TValue>)>) 少。
> 
> SortedDictionary<(Of <(TKey, TValue>)>) 对未排序的数据具有更快的插入和删除操作：O(log n) 相对于 SortedList<(Of <(TKey, TValue>)>) 的 O(n)。
> 
> 如果列表是从排序数据中一次性填充的，SortedList<(Of <(TKey, TValue>)>) 比 SortedDictionary<(Of <(TKey, TValue>)>) 快。

根据我的经验，SortedDictionary 更适合大多数典型的业务场景，因为在使用这样的结构时数据通常最初是未排序的，而且 SortedDictionary 的内存开销很少是关键的。但是，如果性能对您来说很关键，我建议您同时实施并进行测量。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-26T05:04:42.130

您正在寻找类似[SortedList 类](http://msdn.microsoft.com/en-us/library/system.collections.sortedlist(VS.71).aspx)的东西（这里也是[通用版本](http://msdn.microsoft.com/en-us/library/ms132319.aspx)）。

# multithreading - 真实世界的模拟是如何设计的？

> ID：137755
> 
> 赞同：12
> 
> 时间：2008-09-26T04:17:15.583
> 
> 标签：multithreading, oop

我对“过山车大亨”和“模拟人生”等应用程序的性能以及 FPS 游戏着迷。我想了解更多有关基本应用程序架构的信息。（不太关心 UI - 我假设 MVC/MVP 原则适用于此。此时我也不关心数学和物理。）

我的主要问题涉及模拟中的数十或数百个单独的对象（人、车辆、物品等），它们都在移动、做出决定、引发和响应事件——看起来都是同时的，以及它们是如何发生的专为如此出色的性能而设计。

**问：首先，这些对象是在一个巨大的循环中处理的，一次一个 - 还是每个对象都在它自己的线程中处理**？在这样的模拟中有多少线程是实用的？（当然是棒球场图，10、100、1000）

我不想写游戏，我只想要设计理论，因为我想知道这样的设计是否可以应用于其他看似同时做出多个决策的应用程序。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T10:14:40.137

有两种基本方法可以进行这种[基于 Agent](http://en.wikipedia.org/wiki/Agent_based_model)和[System Dynamics](http://en.wikipedia.org/wiki/System_dynamics)的模拟。在基于代理的模拟中，游戏中的每个实体都将由具有属性和行为的类的实例表示，实体之间的所有交互都必须明确定义，当您希望这些实体交互时，一个函数被称为属性的交互实体发生变化。

系统动力学完全不同，它只处理总和和总计，系统中没有单个实体的表示。最简单的例子是 Predator and Prey 模型。

这两者都有优点和缺点，系统动力学方法可以更好地扩展到大量实体，同时保持运行时间短。虽然您必须计算多个公式，但计算时间与公式中的值无关。但是在这种方法中无法查看单个实体。基于代理的方法允许您将实体放置在特定位置，并允许您在模拟中与特定实体进行交互。

FSM 和[Celular 自动机](http://en.wikipedia.org/wiki/Category:Cellular_automata)是在游戏中模拟系统的其他方法。例如，在基于代理的方法中，您可以使用 FSM 对一个代理的行为进行建模。[Simcity](http://www.donhopkins.com/drupal/node/141)使用 Celular 自动机来完成一些模拟工作。

一般来说，您可能不会有一个可以做所有事情的大型模型，但会有多个系统执行特定任务，其中一些不需要经常更新，例如决定天气的东西，其他可能需要不断更新。即使您将它们放在单独的线程中，您也会希望在需要时暂停或启动它们。您可能希望将工作拆分为多个帧，例如仅计算特定数量代理的更新。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-31T21:38:59.417

[原始 Simcity 的源代码已作为Micropolis](http://www.donhopkins.com/home/micropolis/)开源。这可能是一项有趣的研究。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T04:19:37.870

直到最近，游戏的逻辑和管理都在一个大型有限状态机的单个线程中。不过，现在您倾向于看到游戏的不同部分（音频、图形、物理、“模拟”逻辑等）在线程中被拆分为它们自己的 FSM。

编辑：顺便说一句，线程是让模拟中的事情“同时”发生的一种非常糟糕的方式——它会导致竞争条件。通常，当您希望让事情“同时”进行时，您只需弄清楚在迭代数据并单独存储时需要发生什么，然后在处理完所有数据后应用它。林斯，重复。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T04:34:55.680

@Cody Brocious

此[CodeProject](http://www.codeproject.com/KB/linq/linq-to-life.aspx)使用 Linq 来演示这种做法。(Linq to Life)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T13:40:42.893

除了发布的建议之外，我还建议您浏览 sourceforge 上的模拟标签。有各种复杂程度不同的模拟项目。

[源锻造](http://www.sourceforge.net/)

我还推荐以下书籍作为基本概述，虽然它专注于物理，但它处理模拟问题。

[游戏开发者的物理学](https://rads.stackoverflow.com/amzn/click/com/0596000065)

# linux - linux动态链接器的“没有可用的版本信息”错误是什么意思？

> ID：137773
> 
> 赞同：101
> 
> 时间：2008-09-26T04:25:40.787
> 
> 标签：linux, linker

在我们的产品中，我们发布了一些动态链接到“libpam”等系统库的 linux 二进制文件。在某些客户系统上，当程序运行时，我们在 stderr 上收到以下错误：

```
./authpam: /lib/libpam.so.0: no version information available (required by authpam) 
```

应用程序运行良好并执行动态库中的代码。所以这不是一个致命的错误，它实际上只是一个警告。

我认为当系统安装的库缺少我们的可执行文件期望的东西时，这是来自动态链接器的错误。我对动态链接过程的内部了解不多......并且谷歌搜索该主题并没有多大帮助。:(

有谁知道是什么导致了这个错误？...我如何诊断原因？...以及我们如何更改可执行文件以避免此问题？

更新：客户升级到最新版本的debian“测试”，出现同样的错误。所以它不是一个过时的 libpam 库。我想我想了解链接器在抱怨什么？我如何调查根本原因等？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-10-01T05:57:23.387

“没有可用的版本信息”意味着共享对象上的库版本号较低。例如，如果您构建二进制文件的机器上的 major.minor.patch 编号是 7.15.5，而安装机器上的 major.minor.patch 编号是 7.12.1，则 ld 将打印警告。

您可以通过使用与目标操作系统随附的共享对象版本相匹配的库（标头和共享对象）进行编译来解决此问题。例如，如果您要安装到 RedHat 3.4.6-9，您不想在 Debian 4.1.1-21 上编译。这是大多数发行版针对特定 linux 发行版编号的原因之一。

否则，您可以静态链接。但是，您不想使用 PAM 之类的东西来执行此操作，因此您希望实际安装与客户的生产环境匹配的开发环境（或至少安装并链接到正确的库版本。）

重命名 .so 文件（用版本号填充它们）的建议源于共享对象库不使用版本化符号的时代。所以不要指望使用 .so.nnn 命名方案会有所帮助（很多 - 如果您的系统已被破坏，它可能会有所帮助。）

您的最后一个选项将使用自定义链接脚本使用具有不同次要版本号的库进行编译： [http://www.redhat.com/docs/manuals/enterprise/RHEL-4-Manual/gnu-linker/scripts。 html](http://www.redhat.com/docs/manuals/enterprise/RHEL-4-Manual/gnu-linker/scripts.html)

为此，您需要编写一个自定义脚本，并且您需要一个自定义安装程序，该安装程序使用自定义脚本针对您的客户端的共享对象运行 ld。这要求您的客户在其生产系统上具有 gcc 或 ld。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2016-08-09T12:42:01.593

来自 glibc 动态链接器的这条消息实际上意味着提到的库（`/lib/libpam.so.0`在您的情况下）没有`VERDEF`ELF 部分，而二进制文件（`authpam`在您的情况下）在该库的部分中有一些版本定义`VERNEED`（大概是`libpam.so.0`）。您可以使用 轻松查看它`readelf`，只需查看`.gnu.version_d`和`.gnu.version_r`部分（或缺少部分）。

所以这不是符号版本不匹配，因为如果二进制文件想要通过某些特定版本获取`VERNEED`并且库没有在其实际中提供它`VERDEF`，那将是一个硬链接器错误并且二进制文件根本不会运行（像[这样](https://stackoverflow.com/questions/37802196/libcrypto-so-1-0-0-version-openssl-1-0-1-not-found-during-shell-exec)与[这个](https://stackoverflow.com/questions/33564563/how-to-solve-ssh-usr-lib64-libcrypto-so-10-no-version-information-available)或[那个](https://stackoverflow.com/questions/18390833/no-version-information-available)相比）。这是二进制文件需要一些版本，但库不提供有关其版本的任何信息。

在实践中意味着什么？通常，正是在这个例子中看到的——什么都没有，事情只是忽略了版本控制。事情会破裂吗？当然，是的，所以其他答案是正确的，因为应该在运行时使用与二进制文件在构建时链接到的库相同的库。

更多信息可以在 Ulrich Dreppers ["ELF Symbol Versioning"](https://www.akkadia.org/drepper/symbol-versioning)中找到。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-08-02T12:33:20.487

Fwiw，我在安装了 zenoss 监控系统的系统上运行 check_nrpe 时遇到了这个问题。更令人困惑的是，它作为 root 用户运行良好，但作为 zenoss 用户运行良好。

我发现 zenoss 用户有一个 LD_LIBRARY_PATH 导致它使用 zenoss 库，这些库发出这些警告。IE：

```
root@monitoring:$ echo $LD_LIBRARY_PATH

su - zenoss
zenoss@monitoring:/root$ echo $LD_LIBRARY_PATH
/usr/local/zenoss/python/lib:/usr/local/zenoss/mysql/lib:/usr/local/zenoss/zenoss/lib:/usr/local/zenoss/common/lib::
zenoss@monitoring:/root$ /usr/lib/nagios/plugins/check_nrpe -H 192.168.61.61 -p 6969 -c check_mq
/usr/lib/nagios/plugins/check_nrpe: /usr/local/zenoss/common/lib/libcrypto.so.0.9.8: no version information available (required by /usr/lib/libssl.so.0.9.8)
(...)
zenoss@monitoring:/root$ LD_LIBRARY_PATH= /usr/lib/nagios/plugins/check_nrpe -H 192.168.61.61 -p 6969 -c check_mq
(...) 
```

所以无论如何，我想说的是：检查你的变量，如 LD_LIBRARY_PATH、LD_PRELOAD 等。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-01T06:26:56.747

你是如何编译你的应用程序的？什么编译器标志？

以我的经验，当针对 Linux 系统的广阔领域时，在你愿意支持的最旧版本上构建你的包，因为更多的系统倾向于向后兼容，你的应用程序将继续工作。实际上，这是库版本控制的全部原因 - 确保向后兼容性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T04:42:33.040

你已经看到[了](http://answers.google.com/answers/threadview/id/786136.html)吗？原因似乎是其中一方的一个非常旧的 libpam，可能是那个客户。

或者版本的链接可能会丢失：[http ://www.linux.org/docs/ldp/howto/Program-Library-HOWTO/shared-libraries.html](http://www.linux.org/docs/ldp/howto/Program-Library-HOWTO/shared-libraries.html)

# c# - 扩展属性是否应该添加到 C# 4.0？

> ID：137775
> 
> 赞同：17
> 
> 时间：2008-09-26T04:28:28.270
> 
> 标签：c#

我想要这个用于流畅的界面。例如，参见[这个](http://channel9.msdn.com/forums/Coffeehouse/257556-C-Extension-Properties/)Channel9 讨论。可能还[需要](http://ayende.com/Blog/archive/2007/12/02/Why-C-doesnt-have-extension-properties.aspx)添加索引属性。

你怎么认为？优势会超过“语言混乱”吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-26T04:34:09.723

由于属性只是方法的语法糖，我不明白为什么 C# 应该有没有扩展属性的扩展方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-06T14:48:27.230

这是关于数据绑定的，假设我有一个用于绑定到我的 UI 的对象，我想根据对象的其他属性隐藏它。我可以为 IsVisible 或 Visibility 添加扩展属性并将该属性绑定到 UI。

您无法绑定扩展方法，但能够将数据绑定属性添加到您无法扩展的现有类型可能非常有用。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-12-10T22:58:47.823

在我的书中，扩展属性的#1 最重要的原因是围绕无主代码实现流畅的接口模式。我围绕 NHibernate 会话构建了一个包装器，以使其使用起来更加直观，因此我可以执行类似于

```
public bool IsInTransaction
{
    get { return _session.Is().Not.Null && _session.Is().InTransaction; }
} 
```

这看起来很愚蠢， Is 必须是一种方法，因为除非我直接修改会话对象上的源，否则我无法将 Is 作为属性插入。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T04:34:10.533

我不知道为什么不。属性只是具有不同语法的 getter/setter 方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T05:14:43.633

我不认为扩展属性几乎同样有用。我发现自己主要使用属性来封装字段（经典的 get; set;）或提供只读优点（只是对私有、只读、constructor-set 字段的获取）。由于扩展不能访问私有成员，我真的不明白这一点，特别是对于“set;”。做任何事情，“设置；” 无论如何都只需要调用其他方法。然后你会遇到属性抛出异常的问题。
由于扩展仅限于使用公共属性和方法，我发现使用实用程序类的代码更简洁、更容易阅读。归根结底，我们正在使用扩展方法使 LINQ 看起来更漂亮。为了防止开发人员做错事，我可以在我的 LINQ 中到处处理一个额外的 () 并坚持使用扩展方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T04:34:41.610

我想这会很棒，只要在使用它们时没有或最小的性能损失。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T05:47:28.423

似乎它很容易被滥用。正如其他人所提到的，C# 属性只是方法的语法糖。但是，将它们实现为属性具有一定的含义：访问不会有副作用，并且修改属性应该非常便宜。后一点至关重要，因为扩展属性似乎总是​​比传统属性更昂贵。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-11T16:25:19.080

拥有它会是一件好事，但我看到很多人说他们想要它用于数据绑定，这是不可能的，因为它使用反射。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T04:37:58.200

肯定会增加我们可以使用的工具库。

现在就我的观点而言，是的，他们应该这样做，但就像任何事情一样，开发人员需要在需要时正确使用它。像大多数新功能一样，许多开发人员在没有完全理解它们以及何时/如何/在哪里/如何最好地使用它们的情况下使用它们。我知道我有时也会被卷入其中。

但是你，当然，带上它。我可以看到自己在某些情况下使用它

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T04:46:58.693

我猜索引属性将只是我们将在 4.0 中看到的一大袋重大改进中的一个库存填充物。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-01-05T18:59:51.077

开发人员应该使用属性来组织名称的层次结构，并避免使用驼峰式或下划线连接名称。例如，他们应该扩展字符串类而不是 HttpUtility.UrlDecode 以使用类似“some str”.decode.url 目前在 C# 中这样做的唯一方法是：“some str”.decode().url

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-07-12T16:04:33.067

是的，请。

并且还添加索引属性和静态扩展的东西，因为我非常希望 System.Console（这不是开玩笑！）。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2008-09-26T05:18:39.583

不，属性只是隐藏为代码真正生成的内容的一种方式。如果您查看反映的代码或 IL，您可以确定您真正得到的内容如下：

```
public string MyProperty { get; set; } 
```

变成

```
public string get_MyProperty(){ return <some generated variable>; }
public string set_MyProperty(string value) { <some generated variable> = value; } 
```

这只是2种方法。

# algorithm - 将随机范围从 1-5 扩展到 1-7

> ID：137783
> 
> 赞同：710
> 
> 时间：2008-09-26T04:33:32.907
> 
> 标签：algorithm, random, puzzle

给定一个生成 1 到 5 范围内的随机整数的函数，编写一个生成 1 到 7 范围内的随机整数的函数。

1.  什么是简单的解决方案？
2.  什么是减少内存使用或在较慢 CPU 上运行的有效解决方案？

* * *

## 回答 #1

> 赞同：592
> 
> 时间：2009-05-08T22:59:54.800

这相当于 Adam Rosenfield 的解决方案，但对某些读者来说可能更清楚一些。它假设 rand5() 是一个函数，它返回一个统计随机整数，范围在 1 到 5 之间（包括 1 到 5）。

```
int rand7()
{
    int vals[5][5] = {
        { 1, 2, 3, 4, 5 },
        { 6, 7, 1, 2, 3 },
        { 4, 5, 6, 7, 1 },
        { 2, 3, 4, 5, 6 },
        { 7, 0, 0, 0, 0 }
    };

    int result = 0;
    while (result == 0)
    {
        int i = rand5();
        int j = rand5();
        result = vals[i-1][j-1];
    }
    return result;
} 
```

它是如何工作的？可以这样想：想象在纸上打印出这个二维阵列，将其钉在飞镖板上，然后随机向其投掷飞镖。如果您遇到一个非零值，它是一个介于 1 和 7 之间的统计随机值，因为可供选择的非零值的数量是相等的。如果您击中零，请继续投掷飞镖，直到击中非零为止。这就是这段代码所做的：i 和 j 索引随机选择飞镖板上的一个位置，如果我们没有得到好的结果，我们会继续投掷飞镖。

就像亚当说的那样，这在最坏的情况下可以永远运行，但从统计学上讲，最坏的情况永远不会发生。:)

* * *

## 回答 #2

> 赞同：365
> 
> 时间：2008-09-26T04:41:59.767

没有（完全正确的）解决方案可以在恒定时间内运行，因为 1/7 是以 5 为底的无限小数。一个简单的解决方案是使用拒绝采样，例如：

```
 int i;
do
{
  i = 5 * (rand5() - 1) + rand5();  // i is now uniformly random between 1 and 25
} while(i > 21);
// i is now uniformly random between 1 and 21
return i % 7 + 1;  // result is now uniformly random between 1 and 7 
```

这具有 25/21 = 1.19 次循环迭代的预期运行时间，但永远循环的可能性非常小。

* * *

## 回答 #3

> 赞同：153
> 
> 时间：2009-05-21T03:38:42.107

[除了我的第一个答案](https://stackoverflow.com/questions/137783/given-a-function-which-produces-a-random-integer-in-the-range-1-to-5-write-a-fun/137809#137809)之外，我还想添加另一个答案。这个答案试图最小化`rand5()`每次调用的调用次数`rand7()`，以最大化随机性的使用。也就是说，如果您认为随机性是一种宝贵的资源，我们希望尽可能多地使用它，而不会丢弃任何随机位。这个答案也与[伊万的答案](https://stackoverflow.com/questions/137783/given-a-function-which-produces-a-random-integer-in-the-range-1-to-5-write-a-fun/842343#842343)中提出的逻辑有一些相似之处。

[随机变量](http://en.wikipedia.org/wiki/Entropy_(information_theory))的熵是一个定义明确的量。对于具有相等概率（均匀分布）的 N 个状态的随机变量，熵为 log [2] N。因此，`rand5()`具有大约 2.32193 位的熵，并且`rand7()`具有大约 2.80735 位的熵。如果我们希望最大限度地利用随机性，我们需要使用每次调用的所有 2.32193 位熵`rand5()`，并将它们应用于生成每次调用所需的 2.80735 位熵`rand7()`。那么，基本的限制是，我们不能比每次调用 log(7)/log(5) = 1.20906`rand5()`次调用更好`rand7()`。

*旁注：除非另有说明，否则此答案中的所有对数都将以 2 为底。 `rand5()`将假定返回范围 [0, 4] 内的数字，`rand7()`并将假定返回范围 [0, 6] 内的数字。将范围分别调整为 [1, 5] 和 [1, 7] 很简单。*

那么我们该怎么做呢？我们生成一个介于 0 和 1 之间的*无限精确*随机实数（假设我们实际上可以计算和存储这样一个无限精确的数字——我们稍后会解决这个问题）。我们可以通过生成以 5 为底的数字来生成这样的数字：我们选择随机数 0\. `a`[1] `a`[2] `a`[3] ...，其中每个数字 a[`i`]都是通过调用来选择的`rand5()`。例如，如果我们的 RNG[`i`]为 all 选择 a = 1 `i`，那么忽略这不是非常随机的事实，这将对应于实数 1/5 + 1/5 ² + 1/5 ³ + ... = 1/4（几何级数之和）。

好的，所以我们选择了一个介于 0 和 1 之间的随机实数。我现在声称这样的随机数是均匀分布的。直观地说，这很容易理解，因为每个数字都是统一挑选的，而且数字是无限精确的。然而，对此的正式证明有点复杂，因为现在我们处理的是连续分布而不是离散分布，所以我们需要证明我们的数字位于区间 [ `a`, `b`] 中的概率等于那个区间，`b - a`。证明留给读者练习=）。

现在我们已经从 [0, 1] 范围内均匀选择了一个随机实数，我们需要将其转换为范围 [0, 6] 内的一系列均匀随机数，以生成 的输出`rand7()`。我们如何做到这一点？与我们刚才所做的相反——我们将其转换为以 7 为底的无限精确小数，然后每个以 7 为底的数字将对应于`rand7()`.

以前面的例子为例，如果我们`rand5()`产生一个无限的 1 流，那么我们的随机实数将是 1/4。将 1/4 转换为以 7 为底，我们得到无限小数 0.15151515...，因此我们将产生输出 1、5、1、5、1、5 等。

好的，所以我们有了主要的想法，但是我们还有两个问题：我们实际上不能计算或存储一个无限精确的实数，那么我们如何只处理它的有限部分呢？其次，我们如何实际将其转换为 base 7？

我们可以将 0 到 1 之间的数字转换为基数 7 的一种方法如下：

1.  乘以 7
2.  结果的整数部分是下一个以 7 为基数的数字
3.  减去整数部分，只留下小数部分
4.  转到第 1 步

为了处理无限精度的问题，我们计算了一个部分结果，并且我们还存储了结果可能是什么的上限。也就是说，假设我们调用`rand5()`了两次，两次都返回 1。到目前为止，我们生成的数字是 0.11（以 5 为底）。无论产生的无限系列调用的其余部分如何，`rand5()`我们生成的随机实数永远不会大于 0.12：0.11 ≤ 0.11xyz... < 0.12 总是正确的。

所以，跟踪目前的数字，以及它可以取的最大值，我们将*两个*数字都转换为以 7 为底。如果它们在第一个`k`数字上一致，那么我们可以安全地输出下一个`k`数字——不管是什么以 5 为基数的无限流是，它们永远不会影响以`k`7 为基数的表示的下一个数字！

这就是算法——为了生成 的下一个输出`rand7()`，我们只生成`rand5()`所需的数字，以确保我们确定地知道在随机实数到基数 7 的转换中下一个数字的值。这里是一个 Python 实现，带有一个测试工具：

```
import random

rand5_calls = 0
def rand5():
    global rand5_calls
    rand5_calls += 1
    return random.randint(0, 4)

def rand7_gen():
    state = 0
    pow5 = 1
    pow7 = 7
    while True:
        if state / pow5 == (state + pow7) / pow5:
            result = state / pow5
            state = (state - result * pow5) * 7
            pow7 *= 7
            yield result
        else:
            state = 5 * state + pow7 * rand5()
            pow5 *= 5

if __name__ == '__main__':
    r7 = rand7_gen()
    N = 10000
    x = list(next(r7) for i in range(N))
    distr = [x.count(i) for i in range(7)]
    expmean = N / 7.0
    expstddev = math.sqrt(N * (1.0/7.0) * (6.0/7.0))

    print '%d TRIALS' % N
    print 'Expected mean: %.1f' % expmean
    print 'Expected standard deviation: %.1f' % expstddev
    print
    print 'DISTRIBUTION:'
    for i in range(7):
        print '%d: %d   (%+.3f stddevs)' % (i, distr[i], (distr[i] - expmean) / expstddev)
    print
    print 'Calls to rand5: %d (average of %f per call to rand7)' % (rand5_calls, float(rand5_calls) / N) 
```

请注意，它`rand7_gen()`返回一个生成器，因为它具有将数字转换为基数 7 的内部状态。测试工具调用`next(r7)`10000 次以生成 10000 个随机数，然后测量它们的分布。仅使用整数数学，因此结果完全正确。

另请注意，这里的数字变得*非常*大，*非常*快。5 和 7 的幂迅速增长。因此，由于 bignum 算法，在生成大量随机数后，性能将开始显着下降。但请记住，我的目标是最大化随机位的使用，而不是最大化性能（尽管这是次要目标）。

`rand5()`在其中的一次运行中，我对 10000 次调用进行了 12091 次调用`rand7()`，实现了 log(7)/log(5) 调用的最小值，平均到 4 个有效数字，并且结果输出是一致的。

为了将此代码移植到没有内置任意大整数的语言，您必须限制本机整数类型的值`pow5`和`pow7`最大值 - 如果它们太大，则重置一切重新开始。这将略微增加`rand5()`每次调用的平均调用次数`rand7()`，但希望即使对于 32 位或 64 位整数也不应该增加太多。

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2009-04-30T13:56:02.747

（我偷了[Adam Rosenfeld 的答案](https://stackoverflow.com/questions/137783/given-a-function-which-produces-a-random-integer-in-the-range-1-to-5-write-a-fun/137809#137809)，让它运行快了大约 7%。）

假设 rand5() 返回 {0,1,2,3,4} 中的一个且分​​布均等，目标是返回 {0,1,2,3,4,5,6} 且分布均等。

```
int rand7() {
  i = 5 * rand5() + rand5();
  max = 25;
  //i is uniform among {0 ... max-1}
  while(i < max%7) {
    //i is uniform among {0 ... (max%7 - 1)}
    i *= 5;
    i += rand5(); //i is uniform {0 ... (((max%7)*5) - 1)}
    max %= 7;
    max *= 5; //once again, i is uniform among {0 ... max-1}
  }
  return(i%7);
} 
```

我们正在跟踪循环可以在变量中产生的最大值`max`。如果到目前为止的结果在 max%7 和 max-1 之间，那么结果将在该范围内均匀分布。如果不是，我们使用余数，它在 0 和 max%7-1 之间是随机的，并再次调用 rand() 来生成一个新数字和一个新的最大值。然后我们重新开始。

编辑：期望调用 rand5() 的次数是 x 在这个等式中：

```
x =  2     * 21/25
   + 3     *  4/25 * 14/20
   + 4     *  4/25 *  6/20 * 28/30
   + 5     *  4/25 *  6/20 *  2/30 * 7/10
   + 6     *  4/25 *  6/20 *  2/30 * 3/10 * 14/15
   + (6+x) *  4/25 *  6/20 *  2/30 * 3/10 *  1/15
x = about 2.21 calls to rand5() 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2010-11-14T21:23:08.463

**算法：**

7可以用3位的序列表示

使用 rand(5) 随机用 0 或 1 填充每个位。
例如：调用 rand(5) 和

如果结果是 1 或 2，则用 0 填充该位
如果结果是 4 或 5，
如果结果是 3 则用 1 填充该位，然后忽略并再次执行（拒绝）

这样我们可以用 0/1 随机填充 3 位，从而得到一个 1-7 的数字。

**编辑：** 这似乎是最简单和最有效的答案，所以这里有一些代码：

```
public static int random_7() {
    int returnValue = 0;
    while (returnValue == 0) {
        for (int i = 1; i <= 3; i++) {
            returnValue = (returnValue << 1) + random_5_output_2();
        }
    }
    return returnValue;
}

private static int random_5_output_2() {
    while (true) {
        int flip = random_5();

        if (flip < 3) {
            return 0;
        }
        else if (flip > 3) {
            return 1;
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2008-09-26T05:03:20.293

```
int randbit( void )
{
    while( 1 )
    {
        int r = rand5();
        if( r <= 4 ) return(r & 1);
    }
}

int randint( int nbits )
{
    int result = 0;
    while( nbits-- )
    {
        result = (result<<1) | randbit();
    }
    return( result );
}

int rand7( void )
{
    while( 1 )
    {
        int r = randint( 3 ) + 1;
        if( r <= 7 ) return( r );
    }
} 
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2008-09-26T04:51:38.853

```
rand7() = (rand5()+rand5()+rand5()+rand5()+rand5()+rand5()+rand5())%7+1 
```

编辑：那不太管用。它大约相差 1000 分之二（假设一个完美的 rand5）。桶得到：

```
value   Count  Error%
1       11158  -0.0035
2       11144  -0.0214
3       11144  -0.0214
4       11158  -0.0035
5       11172  +0.0144
6       11177  +0.0208
7       11172  +0.0144 
```

通过切换到总和

```
n   Error%
10  +/- 1e-3,
12  +/- 1e-4,
14  +/- 1e-5,
16  +/- 1e-6,
...
28  +/- 3e-11 
```

似乎每增加 2 个数量级就会增加一个数量级

顺便说一句：上面的错误表不是通过抽样生成的，而是通过以下递归关系生成的：

> `p[x,n]`是`output=x`调用. `n`_`rand5`

```
 p[1,1] ... p[5,1] = 1
  p[6,1] ... p[7,1] = 0

  p[1,n] = p[7,n-1] + p[6,n-1] + p[5,n-1] + p[4,n-1] + p[3,n-1]
  p[2,n] = p[1,n-1] + p[7,n-1] + p[6,n-1] + p[5,n-1] + p[4,n-1]
  p[3,n] = p[2,n-1] + p[1,n-1] + p[7,n-1] + p[6,n-1] + p[5,n-1]
  p[4,n] = p[3,n-1] + p[2,n-1] + p[1,n-1] + p[7,n-1] + p[6,n-1]
  p[5,n] = p[4,n-1] + p[3,n-1] + p[2,n-1] + p[1,n-1] + p[7,n-1]
  p[6,n] = p[5,n-1] + p[4,n-1] + p[3,n-1] + p[2,n-1] + p[1,n-1]
  p[7,n] = p[6,n-1] + p[5,n-1] + p[4,n-1] + p[3,n-1] + p[2,n-1] 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-09-26T04:48:00.720

```
int ans = 0;
while (ans == 0) 
{
     for (int i=0; i<3; i++) 
     {
          while ((r = rand5()) == 3){};
          ans += (r < 3) >> i
     }
} 
```

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2009-01-15T04:18:34.913

下面使用随机数生成器在 {1, 2, 3, 4, 5, 6, 7} 上产生均匀分布，在 {1, 2, 3, 4, 5} 上产生均匀分布。代码乱七八糟，但逻辑清晰。

```
public static int random_7(Random rg) {
    int returnValue = 0;
    while (returnValue == 0) {
        for (int i = 1; i <= 3; i++) {
            returnValue = (returnValue << 1) + SimulateFairCoin(rg);
        }
    }
    return returnValue;
}

private static int SimulateFairCoin(Random rg) {
    while (true) {
        int flipOne = random_5_mod_2(rg);
        int flipTwo = random_5_mod_2(rg);

        if (flipOne == 0 && flipTwo == 1) {
            return 0;
        }
        else if (flipOne == 1 && flipTwo == 0) {
            return 1;
        }
    }
}

private static int random_5_mod_2(Random rg) {
    return random_5(rg) % 2;
}

private static int random_5(Random rg) {
    return rg.Next(5) + 1;
} 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2015-11-19T05:16:30.047

```
int rand7() {
    int value = rand5()
              + rand5() * 2
              + rand5() * 3
              + rand5() * 4
              + rand5() * 5
              + rand5() * 6;
    return value%7;
} 
```

与选择的解决方案不同，该算法将在恒定时间内运行。然而，它对 rand5 的调用确实比所选解决方案的平均运行时间多 2 次。

请注意，这个生成器并不完美（数字 0 比任何其他数字多 0.0064% 的机会），但对于大多数实际目的而言，恒定时间的保证可能会超过这种不准确性。

**解释**

该解决方案源于数字 15,624 可被 7 整除的事实，因此如果我们可以随机且均匀地生成从 0 到 15,624 的数字，然后取 mod 7，我们可以得到一个近乎均匀的 rand7 生成器。从 0 到 15,624 的数字可以通过将 rand5 滚动 6 次并使用它们形成基数为 5 的数字的数字来统一生成，如下所示：

```
rand5 * 5^5 + rand5 * 5^4 + rand5 * 5^3 + rand5 * 5^2 + rand5 * 5 + rand5 
```

然而，mod 7 的属性允许我们稍微简化等式：

```
5^5 = 3 mod 7
5^4 = 2 mod 7
5^3 = 6 mod 7
5^2 = 4 mod 7
5^1 = 5 mod 7 
```

所以

```
rand5 * 5^5 + rand5 * 5^4 + rand5 * 5^3 + rand5 * 5^2 + rand5 * 5 + rand5 
```

变成

```
rand5 * 3 + rand5 * 2 + rand5 * 6 + rand5 * 4 + rand5 * 5 + rand5 
```

**理论**

数字 15,624 不是随机选择的，而是可以使用费马小定理发现的，该定理指出如果 p 是素数，则

```
a^(p-1) = 1 mod p 
```

所以这给了我们，

```
(5^6)-1 = 0 mod 7 
```

(5^6)-1 等于

```
4 * 5^5 + 4 * 5^4 + 4 * 5^3 + 4 * 5^2 + 4 * 5 + 4 
```

这是一个以 5 为底的数字，因此我们可以看到此方法可用于从任何随机数生成器到任何其他随机数生成器。尽管在使用指数 p-1 时总是会引入对 0 的小偏差。

为了推广这种方法并更准确，我们可以使用如下函数：

```
def getRandomconverted(frm, to):
    s = 0
    for i in range(to):
        s += getRandomUniform(frm)*frm**i
    mx = 0
    for i in range(to):
        mx = (to-1)*frm**i 
    mx = int(mx/to)*to # maximum value till which we can take mod
    if s < mx:
        return s%to
    else:
        return getRandomconverted(frm, to) 
```

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2008-09-26T04:41:39.377

这里允许作业问题吗？

此函数执行粗略的“以 5 为底”的数学运算以生成 0 到 6 之间的数字。

```
function rnd7() {
    do {
        r1 = rnd5() - 1;
        do {
            r2=rnd5() - 1;
        } while (r2 > 1);
        result = r2 * 5 + r1;
    } while (result > 6);
    return result + 1;
} 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2009-05-09T00:11:35.297

如果我们考虑尝试给出最有效答案的附加约束，即给出一个输入流 ，`I`长度`m`为 1-5 的均匀分布整数输出一个流`O`，长度为 1-7 的均匀分布整数相对到`m`，说`L(m)`。

分析这一点的最简单方法是将流 I 和流`O`分别视为 5 进制数和 7 进制数。这是通过主要答案的采用流的想法实现的，`a1, a2, a3,... -> a1+5*a2+5^2*a3+..`对于流也是如此`O`。

那么如果我们取一段输入流的长度为`m choose n s.t. 5^m-7^n=c`where`c>0`和尽可能小。然后有一个从长度为 m 的输入流到整数 from `1`to 的`5^m`统一映射，以及从整数从 1 到`7^n`长度为 n 的输出流的另一个统一映射，当映射整数时，我们可能不得不从输入流中丢失一些情况超过`7^n`。

所以这给出了 的 值`L(m)`大约`m (log5/log7)`是`.82m`。

上述分析的难点在于方程`5^m-7^n=c`不容易精确求解，以及均匀值 from`1`超过`5^m`而`7^n`失去效率的情况。

问题是可以达到多接近 m (log5/log7) 的最佳值。例如，当这个数字接近整数时，我们能否找到一种方法来实现输出值的精确整数？

如果`5^m-7^n=c`然后从输入流中，我们有效地从`0`to生成一个统一的随机数，`(5^m)-1`并且不使用任何高于`7^n`. 然而，这些值可以被拯救并再次使用。它们有效地生成从 1 到 的统一数字序列`5^m-7^n`。因此，我们可以尝试使用这些并将它们转换为 7 进制数，以便我们可以创建更多的输出值。

如果我们让是从大小的统一输入派生的整数`T7(X)`输出序列的平均长度，并假设.`random(1-7)``X``5^m=7^n0+7^n1+7^n2+...+7^nr+s, s<7`

然后`T7(5^m)=n0x7^n0/5^m + ((5^m-7^n0)/5^m) T7(5^m-7^n0)`因为我们有一个长度没有序列，概率为 7^n0/5^m，残差长度`5^m-7^n0`为概率`(5^m-7^n0)/5^m)`。

如果我们继续替换，我们会得到：

```
T7(5^m) = n0x7^n0/5^m + n1x7^n1/5^m + ... + nrx7^nr/5^m  = (n0x7^n0 + n1x7^n1 + ... + nrx7^nr)/5^m 
```

因此

```
L(m)=T7(5^m)=(n0x7^n0 + n1x7^n1 + ... + nrx7^nr)/(7^n0+7^n1+7^n2+...+7^nr+s) 
```

另一种说法是：

```
If 5^m has 7-ary representation `a0+a1*7 + a2*7^2 + a3*7^3+...+ar*7^r
Then L(m) = (a1*7 + 2a2*7^2 + 3a3*7^3+...+rar*7^r)/(a0+a1*7 + a2*7^2 + a3*7^3+...+ar*7^r) 
```

最好的情况是我原来的上面 where `5^m=7^n+s`, where `s<7`。

然后`T7(5^m) = nx(7^n)/(7^n+s) = n+o(1) = m (Log5/Log7)+o(1)`和以前一样。

最坏的情况是我们只能找到 k 和 st 5^m = kx7+s。

```
Then T7(5^m) = 1x(k.7)/(k.7+s) = 1+o(1) 
```

其他情况介于两者之间。看看我们对于非常大的 m 能做多好会很有趣，即我们能得到多好的误差项：

```
T7(5^m) = m (Log5/Log7)+e(m) 
```

一般来说，这似乎不可能实现`e(m) = o(1)`，但希望我们可以证明`e(m)=o(m)`。

然后整个事情取决于 7 进制数字的分布`5^m`对于 的各种值`m`。

我敢肯定有很多理论可以涵盖这一点，我可能会在某个时候查看并报告。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2009-05-04T04:57:24.180

这是[Adam's answer](https://stackoverflow.com/questions/137783/given-a-function-which-produces-a-random-integer-in-the-range-1-to-5-write-a-fun/137809#137809)的工作 Python 实现。

```
import random

def rand5():
    return random.randint(1, 5)

def rand7():
    while True:
        r = 5 * (rand5() - 1) + rand5()
        #r is now uniformly random between 1 and 25
        if (r <= 21):
            break
    #result is now uniformly random between 1 and 7
    return r % 7 + 1 
```

我喜欢把我正在研究的算法扔到 Python 中，这样我就可以玩弄它们了，我想我会把它贴在这里，希望它对那里的人有用，而不是花很长时间才能放在一起。

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2009-11-09T12:11:16.173

为什么不简单呢？

```
int random7() {
  return random5() + (random5() % 3);
} 
```

由于模数，在此解决方案中获得 1 和 7 的机会较低，但是，如果您只想要一个快速且易读的解决方案，这就是要走的路。

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2009-06-23T14:17:22.637

亚当罗森菲尔德正确答案背后的前提是：

*   **x** = 5^n（在他的情况下：**n** =2）
*   操纵 n rand5 调用以获取范围 [1, x] 内的数字**y**
*   **z** = ((int)(x / 7)) * 7
*   如果 y > z，再试一次。否则返回 y % 7 + 1

当 n 等于 2 时，您有 4 种丢弃的可能性：y = {22, 23, 24, 25}。如果使用 n 等于 6，则只有 1 个丢弃：y = {15625}。

5^6 =
15625 7 * 2232 = 15624

你再调用 rand5 次。但是，您获得丢弃值（或无限循环）的机会要低得多。如果有办法让 y 没有可能的一次性价值，我还没有找到。

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2009-04-30T09:39:47.903

假设这里的**rand(n)表示“从****0**到**n-1** 均匀分布的随机整数”，这是一个使用 Python 的 randint 的代码示例，它具有这种效果。它仅使用**randint(5)**和常量来产生**randint(7)**的效果。有点傻其实

```
from random import randint
sum = 7
while sum >= 7:
    first = randint(0,5)   
    toadd = 9999
    while toadd>1:
        toadd = randint(0,5)
    if toadd:
        sum = first+5
    else:
        sum = first

assert 7>sum>=0 
print sum 
```

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2009-09-09T03:44:47.317

这是我的答案：

```
static struct rand_buffer {
  unsigned v, count;
} buf2, buf3;

void push (struct rand_buffer *buf, unsigned n, unsigned v)
{
  buf->v = buf->v * n + v;
  ++buf->count;
}

#define PUSH(n, v)  push (&buf##n, n, v)

int rand16 (void)
{
  int v = buf2.v & 0xf;
  buf2.v >>= 4;
  buf2.count -= 4;
  return v;
}

int rand9 (void)
{
  int v = buf3.v % 9;
  buf3.v /= 9;
  buf3.count -= 2;
  return v;
}

int rand7 (void)
{
  if (buf3.count >= 2) {
    int v = rand9 ();

    if (v < 7)
      return v % 7 + 1;

    PUSH (2, v - 7);
  }

  for (;;) {
    if (buf2.count >= 4) {
      int v = rand16 ();

      if (v < 14) {
        PUSH (2, v / 7);
        return v % 7 + 1;
      }

      PUSH (2, v - 14);
    }

    // Get a number between 0 & 25
    int v = 5 * (rand5 () - 1) + rand5 () - 1;

    if (v < 21) {
      PUSH (3, v / 7);
      return v % 7 + 1;
    }

    v -= 21;
    PUSH (2, v & 1);
    PUSH (2, v >> 1);
  }
} 
```

它比其他的要复杂一些，但我相信它可以最大限度地减少对 rand5 的调用。与其他解决方案一样，它很可能会循环很长时间。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2010-08-23T13:14:19.940

Simple and efficient:

```
int rand7 ( void )
{
    return 4; // this number has been calculated using
              // rand5() and is in the range 1..7
} 
```

(Inspired by [What's your favorite "programmer" cartoon?](https://stackoverflow.com/questions/84556/whats-your-favorite-programmer-cartoon/84747#84747)).

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2009-12-04T23:45:01.020

只要没有七种可能性可供选择，就再画一个随机数，将可能性的数量乘以五。在 Perl 中：

```
$num = 0;
$possibilities = 1;

sub rand7
{
  while( $possibilities < 7 )
  {
    $num = $num * 5 + int(rand(5));
    $possibilities *= 5;
  }
  my $result = $num % 7;
  $num = int( $num / 7 );
  $possibilities /= 7;
  return $result;
} 
```

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2010-09-21T15:45:00.130

我不喜欢从 1 开始的范围，所以我将从 0 开始 :-)

```
unsigned rand5()
{
    return rand() % 5;
}

unsigned rand7()
{
    int r;

    do
    {
        r =         rand5();
        r = r * 5 + rand5();
        r = r * 5 + rand5();
        r = r * 5 + rand5();
        r = r * 5 + rand5();
        r = r * 5 + rand5();
    } while (r > 15623);

    return r / 2232;
} 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2009-12-29T01:46:23.933

你去了，均匀分布和零 rand5 调用。

```
def rand7:
    seed += 1
    if seed >= 7:
        seed = 0
    yield seed 
```

需要提前播种。

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2010-04-19T12:14:52.647

我知道它已被回答，但这似乎可以正常工作，但我不能告诉你它是否有偏见。我的“测试”表明它至少是合理的。

*也许亚当·罗森菲尔德会好心发表评论？*

我的（天真？）想法是这样的：

累加 rand5，直到有足够的随机位组成 rand7。这最多需要 2 个 rand5。要获得 rand7 数，我使用累积值 mod 7。

为了避免累加器溢出，并且由于累加器是 mod 7，所以我采用累加器的 mod 7：

```
(5a + rand5) % 7 = (k*7 + (5a%7) + rand5) % 7 = ( (5a%7) + rand5) % 7 
```

rand7() 函数如下：

（我让rand5的范围是0-4，rand7也是0-6。）

```
int rand7(){
  static int    a=0;
  static int    e=0;
  int       r;
  a = a * 5 + rand5();
  e = e + 5;        // added 5/7ths of a rand7 number
  if ( e<7 ){
    a = a * 5 + rand5();
    e = e + 5;  // another 5/7ths
  }
  r = a % 7;
  e = e - 7;        // removed a rand7 number
  a = a % 7;
  return r;
} 
```

编辑：添加了 1 亿次试验的结果。

'Real' rand 函数 mod 5 或 7

rand5 : avg=1.999802 0:20003944 1:19999889 2:20003690 3:19996938 4:19995539 ​​rand7 : avg=3.000111 0:14282851 1:14282879 2:14284554 3:14288546 4:14292388 5:14288736 6:14280046

我的兰德7

平均看起来不错，数字分布看起来也不错。

兰特：平均=3.000080 0:14288793 1:14280135 2:14287848 3:14285277 4:14286341 5:14278663 6:14292943

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2009-09-17T23:20:37.377

上面引用了一些优雅的算法，但这是一种接近它的方法，尽管它可能是迂回的。我假设从 0 生成的值。

R2 = 给出小于 2 的值的随机数生成器（样本空间 = {0, 1}）
R8 = 给出小于 8 的值的随机数生成器（样本空间 = {0, 1, 2, 3, 4, 5, 6, 7 })

为了从 R2 生成 R8，您将运行 R2 三次，并将所有 3 次运行的组合结果用作具有 3 位数字的二进制数。以下是 R2 运行三次时的值范围：

0 0 0 --> 0
。
.
1 1 1 --> 7

现在要从 R8 生成 R7，如果返回 7，我们只需再次运行 R7：

```
int R7() {
  do {
    x = R8();
  } while (x > 6)
  return x;
} 
```

迂回的解决方案是从 R5 生成 R2（就像我们从 R8 生成 R7），然后从 R2 生成 R8，然后从 R8 生成 R7。

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2010-03-10T21:25:58.103

这是一个完全适合整数的解决方案，并且在最佳值的大约 4% 范围内（即在 {0..4} 中使用 1.26 个随机数来对 {0..6} 中的每个随机数）。代码在 Scala 中，但任何语言的数学运算都应该相当清楚：您可以利用 7^9 + 7^8 非常接近 5^11 的事实。所以你选择一个以 5 为底的 11 位数字，然后如果它在范围内（给出 9 个以 7 为底的数字），则将其解释为以 7 为底的 9 位数字，或者如果它超过 9 位数字，则将其解释为 8 位数字等.:

```
abstract class RNG {
  def apply(): Int
}

class Random5 extends RNG {
  val rng = new scala.util.Random
  var count = 0
  def apply() = { count += 1 ; rng.nextInt(5) }
}

class FiveSevener(five: RNG) {
  val sevens = new Array[Int](9)
  var nsevens = 0
  val to9 = 40353607;
  val to8 = 5764801;
  val to7 = 823543;
  def loadSevens(value: Int, count: Int) {
    nsevens = 0;
    var remaining = value;
    while (nsevens < count) {
      sevens(nsevens) = remaining % 7
      remaining /= 7
      nsevens += 1
    }
  }
  def loadSevens {
    var fivepow11 = 0;
    var i=0
    while (i<11) { i+=1 ; fivepow11 = five() + fivepow11*5 }
    if (fivepow11 < to9) { loadSevens(fivepow11 , 9) ; return }
    fivepow11 -= to9
    if (fivepow11 < to8) { loadSevens(fivepow11 , 8) ; return }
    fivepow11 -= to8
    if (fivepow11 < 3*to7) loadSevens(fivepow11 % to7 , 7)
    else loadSevens
  }
  def apply() = {
    if (nsevens==0) loadSevens
    nsevens -= 1
    sevens(nsevens)
  }
} 
```

如果您将测试粘贴到解释器（实际上是 REPL）中，您会得到：

```
scala> val five = new Random5
five: Random5 = Random5@e9c592

scala> val seven = new FiveSevener(five)
seven: FiveSevener = FiveSevener@143c423

scala> val counts = new Array[Int](7)
counts: Array[Int] = Array(0, 0, 0, 0, 0, 0, 0)

scala> var i=0 ; while (i < 100000000) { counts( seven() ) += 1 ; i += 1 }
i: Int = 100000000

scala> counts
res0: Array[Int] = Array(14280662, 14293012, 14281286, 14284836, 14287188,
14289332, 14283684)

scala> five.count
res1: Int = 125902876 
```

分布很好且平坦（在每个 bin 中 10^8 的 1/7 的大约 10k 范围内，正如近似高斯分布所预期的那样）。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2009-05-07T03:43:40.400

通过使用*滚动总计*，您可以同时

*   保持平均分配；和
*   不必牺牲随机序列中的任何元素。

这两个问题都是简单`rand(5)+rand(5)...`型解决方案的问题。以下 Python 代码显示了如何实现它（其中大部分是证明分布）。

```
import random
x = []
for i in range (0,7):
    x.append (0)
t = 0
tt = 0
for i in range (0,700000):
    ########################################
    #####            qq.py             #####
    r = int (random.random () * 5)
    t = (t + r) % 7
    ########################################
    #####       qq_notsogood.py        #####
    #r = 20
    #while r > 6:
        #r =     int (random.random () * 5)
        #r = r + int (random.random () * 5)
    #t = r
    ########################################
    x[t] = x[t] + 1
    tt = tt + 1
high = x[0]
low = x[0]
for i in range (0,7):
    print "%d: %7d %.5f" % (i, x[i], 100.0 * x[i] / tt)
    if x[i] < low:
        low = x[i]
    if x[i] > high:
        high = x[i]
diff = high - low
print "Variation = %d (%.5f%%)" % (diff, 100.0 * diff / tt) 
```

这个输出显示了结果：

```
pax$ python qq.py
0:   99908 14.27257
1:  100029 14.28986
2:  100327 14.33243
3:  100395 14.34214
4:   99104 14.15771
5:   99829 14.26129
6:  100408 14.34400
Variation = 1304 (0.18629%)

pax$ python qq.py
0:   99547 14.22100
1:  100229 14.31843
2:  100078 14.29686
3:   99451 14.20729
4:  100284 14.32629
5:  100038 14.29114
6:  100373 14.33900
Variation = 922 (0.13171%)

pax$ python qq.py
0:  100481 14.35443
1:   99188 14.16971
2:  100284 14.32629
3:  100222 14.31743
4:   99960 14.28000
5:   99426 14.20371
6:  100439 14.34843
Variation = 1293 (0.18471%) 
```

一个简单的`rand(5)+rand(5)`，忽略返回超过 6 的那些情况，其典型变化为 18%，是上面显示的方法的*100 倍*：

```
pax$ python qq_notsogood.py
0:   31756 4.53657
1:   63304 9.04343
2:   95507 13.64386
3:  127825 18.26071
4:  158851 22.69300
5:  127567 18.22386
6:   95190 13.59857
Variation = 127095 (18.15643%)

pax$ python qq_notsogood.py
0:   31792 4.54171
1:   63637 9.09100
2:   95641 13.66300
3:  127627 18.23243
4:  158751 22.67871
5:  126782 18.11171
6:   95770 13.68143
Variation = 126959 (18.13700%)

pax$ python qq_notsogood.py
0:   31955 4.56500
1:   63485 9.06929
2:   94849 13.54986
3:  127737 18.24814
4:  159687 22.81243
5:  127391 18.19871
6:   94896 13.55657
Variation = 127732 (18.24743%) 
```

而且，根据 Nixuz 的建议，我已经清理了脚本，以便您可以提取和使用这些`rand7...`内容：

```
import random

# rand5() returns 0 through 4 inclusive.

def rand5():
    return int (random.random () * 5)

# rand7() generator returns 0 through 6 inclusive (using rand5()).

def rand7():
    rand7ret = 0
    while True:
        rand7ret = (rand7ret + rand5()) % 7
        yield rand7ret

# Number of test runs.

count = 700000

# Work out distribution.

distrib = [0,0,0,0,0,0,0]
rgen =rand7()
for i in range (0,count):
    r = rgen.next()
    distrib[r] = distrib[r] + 1

# Print distributions and calculate variation.

high = distrib[0]
low = distrib[0]
for i in range (0,7):
    print "%d: %7d %.5f" % (i, distrib[i], 100.0 * distrib[i] / count)
    if distrib[i] < low:
        low = distrib[i]
    if distrib[i] > high:
        high = distrib[i]
diff = high - low
print "Variation = %d (%.5f%%)" % (diff, 100.0 * diff / count) 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2009-05-13T17:38:16.923

这个答案更像是一个从 Rand5 函数中获得最大熵的实验。因此，t 有点不清楚，几乎可以肯定比其他实现慢很多。

假设从 0-4 均匀分布并从 0-6 得到均匀分布：

```
public class SevenFromFive
{
  public SevenFromFive()
  {
    // this outputs a uniform ditribution but for some reason including it 
    // screws up the output distribution
    // open question Why?
    this.fifth = new ProbabilityCondensor(5, b => {});
    this.eigth = new ProbabilityCondensor(8, AddEntropy);
  } 

  private static Random r = new Random();
  private static uint Rand5()
  {
    return (uint)r.Next(0,5);
  }

  private class ProbabilityCondensor
  {
    private readonly int samples;
    private int counter;
    private int store;
    private readonly Action<bool> output;

    public ProbabilityCondensor(int chanceOfTrueReciprocal,
      Action<bool> output)
    {
      this.output = output;
      this.samples = chanceOfTrueReciprocal - 1;  
    }

    public void Add(bool bit)
    {
      this.counter++;
      if (bit)
        this.store++;   
      if (counter == samples)
      {
        bool? e;
        if (store == 0)
          e = false;
        else if (store == 1)
          e = true;
        else
          e = null;// discard for now       
        counter = 0;
        store = 0;
        if (e.HasValue)
          output(e.Value);
      }
    }
  }

  ulong buffer = 0;
  const ulong Mask = 7UL;
  int bitsAvail = 0;
  private readonly ProbabilityCondensor fifth;
  private readonly ProbabilityCondensor eigth;

  private void AddEntropy(bool bit)
  {
    buffer <<= 1;
    if (bit)
      buffer |= 1;      
    bitsAvail++;
  }

  private void AddTwoBitsEntropy(uint u)
  {
    buffer <<= 2;
    buffer |= (u & 3UL);    
    bitsAvail += 2;
  }

  public uint Rand7()
  {
    uint selection;   
    do
    {
      while (bitsAvail < 3)
      {
        var x = Rand5();
        if (x < 4)
        {
          // put the two low order bits straight in
          AddTwoBitsEntropy(x);
          fifth.Add(false);
        }
        else
        { 
          fifth.Add(true);
        }
      }
      // read 3 bits
      selection = (uint)((buffer & Mask));
      bitsAvail -= 3;     
      buffer >>= 3;
      if (selection == 7)
        eigth.Add(true);
      else
        eigth.Add(false);
    }
    while (selection == 7);   
    return selection;
  }
} 
```

每次调用 Rand5 添加到缓冲区的位数目前是 4/5 * 2 所以 1.6。如果包含 1/5 概率值，则增加 0.05 所以 1.65 但请参阅代码中的注释，我不得不禁用它。

调用 Rand7 消耗的位 = 3 + 1/8 * (3 + 1/8 * (3 + 1/8 * (...
这是 3 + 3/8 + 3/64 + 3/512 ... 所以约 3.42

通过从七人组中提取信息，我每次调用回收 1/8*1/7 位，因此大约 0.018

这使得每次调用的净消耗为 3.4 位，这意味着每个 Rand7 的比率为 2.125 次调用 Rand5。最佳值应为 2.1。

我想这种方法比这里的许多其他方法*要*慢得多，除非调用 Rand5 的成本非常昂贵（比如调用一些外部熵源）。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2010-05-27T08:20:17.473

只需从您的第一个功能扩展您的输出

```
0) you have a number in range 1-5
1) subtract 1 to make it in range 0-4
2) multiply by (7-1)/(5-1) to make it in range 0-6
3) add 1 to increment the range: Now your result is in between 1-7 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2011-04-01T04:06:43.740

在php中

```
function rand1to7() {
    do {
        $output_value = 0;
        for ($i = 0; $i < 28; $i++) {
            $output_value += rand1to5();
        }
    while ($output_value != 140);
    $output_value -= 12;
    return floor($output_value / 16);
} 
```

循环产生 16 到 127 之间的随机数，除以 16 以创建 1 到 7.9375 之间的浮点数，然后向下舍入以得到 1 到 7 之间的 int。如果我没记错的话，有 16/112 的机会得到7 个结果中的任何一个。

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2010-12-03T01:31:46.060

```
extern int r5();

int r7() {
    return ((r5() & 0x01) << 2 ) | ((r5() & 0x01) << 1 ) | (r5() & 0x01);
} 
```

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2017-12-02T00:29:46.990

我想我有四个答案，其中两个给出[了与@Adam Rosenfield 类似的](https://stackoverflow.com/a/137809/3547167)精确解决方案，但没有无限循环问题，另外两个给出了几乎完美的解决方案，但比第一个解决方案更快。

最好的精确解决方案需要 7 次调用`rand5`，但让我们继续了解。

# 方法 1 - 精确

亚当的答案的优势在于它给出了一个完美的均匀分布，并且很有可能（21/25）只需要两次调用 rand5() 。然而，最坏的情况是无限循环。

下面的第一个解决方案也提供了完美的均匀分布，但总共需要 42 次调用`rand5`. 没有无限循环。

这是一个 R 实现：

```
rand5 <- function() sample(1:5,1)

rand7 <- function()  (sum(sapply(0:6, function(i) i + rand5() + rand5()*2 + rand5()*3 + rand5()*4 + rand5()*5 + rand5()*6)) %% 7) + 1 
```

对于不熟悉 R 的人，这里有一个简化的版本：

```
rand7 = function(){
  r = 0 
  for(i in 0:6){
    r = r + i + rand5() + rand5()*2 + rand5()*3 + rand5()*4 + rand5()*5 + rand5()*6
  }
  return r %% 7 + 1
} 
```

的分布`rand5`将被保留。如果我们进行数学计算，循环的 7 次迭代中的每一次都有 5^6 种可能的组合，因此可能的组合总数为`(7 * 5^6) %% 7 = 0`. 因此，我们可以将生成的随机数分成 7 个相等的组。有关此问题的更多讨论，请参见方法二。

以下是所有可能的组合：

```
table(apply(expand.grid(c(outer(1:5,0:6,"+")),(1:5)*2,(1:5)*3,(1:5)*4,(1:5)*5,(1:5)*6),1,sum) %% 7 + 1)

    1     2     3     4     5     6     7 
15625 15625 15625 15625 15625 15625 15625 
```

我认为直接表明亚当的方法会运行得更快。在 Adam 的解决方案中有 42 次或更多调用的概率`rand5`非常小 ( `(4/25)^21 ~ 10^(-17)`)。

# 方法 2 - 不准确

现在第二种方法几乎是统一的，但需要 6 次调用`rand5`：

```
rand7 <- function() (sum(sapply(1:6,function(i) i*rand5())) %% 7) + 1 
```

这是一个简化版本：

```
rand7 = function(){
  r = 0 
  for(i in 1:6){
    r = r + i*rand5()
  }
  return r %% 7 + 1
} 
```

这本质上是方法 1 的一次迭代。如果我们生成所有可能的组合，则结果计数如下：

```
table(apply(expand.grid(1:5,(1:5)*2,(1:5)*3,(1:5)*4,(1:5)*5,(1:5)*6),1,sum) %% 7 + 1)

   1    2    3    4    5    6    7 
2233 2232 2232 2232 2232 2232 2232 
```

`5^6 = 15625`一个数字将在试验中再次出现。

现在，在方法 1 中，通过将 1 加到 6，我们将数字 2233 移动到每个连续点。因此，组合的总数将匹配。这是因为 5^6 %% 7 = 1，然后我们做了 7 个适当的变化，所以 (7 * 5^6 %% 7 = 0)。

# 方法 3 - 精确

如果理解方法 1 和 2 的参数，则方法 3 随之而来，并且只需要 7 次调用`rand5`. 在这一点上，我觉得这是精确解决方案所需的最少调用次数。

这是一个 R 实现：

```
rand5 <- function() sample(1:5,1)

rand7 <- function()  (sum(sapply(1:7, function(i) i * rand5())) %% 7) + 1 
```

对于不熟悉 R 的人，这里有一个简化的版本：

```
rand7 = function(){
  r = 0 
  for(i in 1:7){
    r = r + i * rand5()
  }
  return r %% 7 + 1
} 
```

的分布`rand5`将被保留。如果我们进行数学计算，循环的 7 次迭代中的每一次都有 5 种可能的结果，因此可能的组合总数为`(7 * 5) %% 7 = 0`. 因此，我们可以将生成的随机数分成 7 个相等的组。有关此问题的更多讨论，请参见方法一和方法二。

以下是所有可能的组合：

```
table(apply(expand.grid(0:6,(1:5)),1,sum) %% 7 + 1)

1 2 3 4 5 6 7  
5 5 5 5 5 5 5 
```

我认为直接表明亚当的方法仍然会运行得更快。在 Adam 的解决方案中有 7 个或更多调用的概率`rand5`仍然很小 ( `(4/25)^3 ~ 0.004`)。

# 方法 4 - 不准确

这是第二种方法的微小变化。它几乎是统一的，但需要 7 次调用`rand5`，这是方法 2 的额外调用：

```
rand7 <- function() (rand5() + sum(sapply(1:6,function(i) i*rand5())) %% 7) + 1 
```

这是一个简化版本：

```
rand7 = function(){
  r = 0 
  for(i in 1:6){
    r = r + i*rand5()
  }
  return (r+rand5()) %% 7 + 1
} 
```

如果我们生成所有可能的组合，则结果计数如下：

```
table(apply(expand.grid(1:5,(1:5)*2,(1:5)*3,(1:5)*4,(1:5)*5,(1:5)*6,1:5),1,sum) %% 7 + 1)

    1     2     3     4     5     6     7 
11160 11161 11161 11161 11161 11161 11160 
```

`5^7 = 78125`两个数字将在试验中少出现一次。对于大多数目的，我可以忍受。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2009-12-05T07:27:01.963

您需要的函数是*rand1_7()*，我编写了 rand1_5() 以便您可以对其进行测试并绘制它。

```
import numpy
def rand1_5():
    return numpy.random.randint(5)+1

def rand1_7():
    q = 0
    for i in xrange(7):  q+= rand1_5()
    return q%7 + 1 
```

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2013-01-31T16:17:33.790

*我们在`rand(n) -> [0, n - 1]`这里使用约定*

从我阅读的许多答案中，它们提供了一致性或停止保证，但不能同时提供（亚当·罗森菲尔德的第二个答案可能）。

但是，可以这样做。我们基本上有这个分布：

![rand5_proba.png](https://i.imgur.com/Ww0qPTP.png)

这给我们的分布留下了一个漏洞`[0-6]`： 5 和 6 没有发生的概率。想象一下，现在我们试图通过改变概率分布和求和来填补它的漏洞。

实际上，我们可以将初始分布本身移动一，然后通过将获得的分布与初始一移动二，然后三，依此类推，直到 7，不包括在内（我们覆盖了整个范围）。如下图所示。颜色的顺序，对应于步骤，是蓝色 -> 绿色 -> 青色 -> 白色 -> 品红色 -> 黄色 -> 红色。

![fig_moving_average_proba.png](https://i.imgur.com/EIfJCYr.png)

因为每个槽被 7 个移位分布中的 5 个覆盖（移位从 0 到 6 不等），并且因为我们假设随机数独立于 `ran5()`对另一个调用的调用，所以我们得到

```
p(x) = 5 / 35 = 1 / 7       for all x in [0, 6] 
```

这意味着，给定来自 的 7 个独立随机数，我们可以计算出在该范围内`ran5()`具有均匀概率的随机数。`[0-6]`事实上，ran5() 概率分布甚至不需要是均匀的，只要样本是独立的（所以分布在每次试验中保持不变）。此外，这对 5 和 7 以外的其他数字有效。

这给了我们以下python函数：

```
def rand_range_transform(rands):
    """
    returns a uniform random number in [0, len(rands) - 1]
    if all r in rands are independent random numbers from the same uniform distribution
    """
    return sum((x + i) for i, x in enumerate(rands)) % len(rands) # a single modulo outside the sum is enough in modulo arithmetic 
```

这可以像这样使用：

```
rand5 = lambda : random.randrange(5)

def rand7():
    return rand_range_transform([rand5() for _ in range(7)]) 
```

如果我们调用`rand7()`70000 次，我们可以得到：

```
max: 6 min: 0 mean: 2.99711428571 std: 2.00194697049
0:  10019
1:  10016
2:  10071
3:  10044
4:  9775
5:  10042
6:  10033 
```

这很好，虽然远非完美。事实是，在这个实现中，我们的一个假设很可能是错误的：我们使用 PRNG，因此，下一次调用的结果取决于最后一个结果。

也就是说，使用真正随机的数字源，输出也应该是真正随机的。这个算法在任何情况下都会终止。

但这是有代价的：一次调用需要 7`rand5()`次`rand7()` 调用。

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2011-03-16T17:07:56.140

对于值 0-7，您有以下内容：

```
0 000
1 001
2 010
3 011
4 100
5 101
6 110
7 111 
```

从左到右按位 Rand5() 有 p(1) = {2/5, 2/5, 3/5}。因此，如果我们补充这些概率分布（~Rand5()），我们应该能够使用它来产生我们的数字。我稍后会尝试用解决方案报告。有人有什么想法吗？

R

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2014-01-21T07:56:04.340

该解决方案不会浪费任何熵，并给出范围内第一个可用的真正随机数。**随着每次迭代，没有得到答案的概率被证明是降低了。**在 N 次迭代中得到答案的概率是介于 0 和 max (5^N) 之间的随机数将小于该范围内最大的 7 倍数 (max-max%7) 的概率。必须至少迭代两次。但这对于所有解决方案都是如此。

```
int random7() {
  range = 1;
  remainder = 0;

  while (1) {
    remainder = remainder * 5 + random5() - 1;
    range = range * 5;

    limit = range - (range % 7);
    if (remainder < limit) return (remainder % 7) + 1;

    remainder = remainder % 7;
    range = range % 7;
  }
} 
```

数值等价于：

```
r5=5;
num=random5()-1;
while (1) {
   num=num*5+random5()-1;
   r5=r5*5;
   r7=r5-r5%7;
   if (num<r7) return num%7+1;
} 
```

第一个代码以模数形式计算它。第二个代码只是简单的数学。或者我在某个地方犯了一个错误。:-)

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2011-08-26T19:10:18.783

这是我发现的：

1.  Random5 产生一个 1~5 的范围，随机分布
2.  如果我们运行 3 次并将它们相加，我们将得到 3~15 的范围，随机分布
3.  对 3~15 范围进行算术运算
    1.  (3~15) - 1 = (2~14)
    2.  (2~14)/2 = (1~7)

然后我们得到一个1~7的范围，也就是我们要找的Random7。

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2010-12-01T18:46:59.147

这是我在查看其他人的答案后可以创建的最简单的答案：

```
def r5tor7():
    while True:
        cand = (5 * r5()) + r5()
        if cand < 27:
            return cand 
```

`cand`在 [6, 27] 范围内，如果 r5() 的可能结果是均匀分布的，则可能的结果是均匀分布的。您可以使用以下代码测试我的答案：

```
from collections import defaultdict

def r5_outcome(n):
    if not n:
        yield []
    else:
        for i in range(1, 6):
            for j in r5_outcome(n-1):
                yield [i] + j

def test_r7():
    d = defaultdict(int)
    for x in r5_outcome(2):
        s = sum([x[i] * 5**i for i in range(len(x))])
        if s < 27:
            d[s] += 1
    print len(d), d 
```

`r5_outcome(2)`生成 r5() 结果的所有可能组合。我使用与我的解决方案代码相同的过滤器进行测试。您可以看到所有结果的可能性相同，因为它们具有相同的值。

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2011-03-18T15:32:40.590

```
rand25() =5*(rand5()-1) + rand5()

rand7() { 
   while(true) {
       int r = rand25();
       if (r < 21) return r%3;         
   }
} 
```

为什么会这样：循环将永远运行的概率为 0。

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2011-01-27T07:29:38.087

为什么这行不通？除了对 rand5() 的一次额外调用之外？

```
i = rand5() + rand5() + (rand5() - 1) //Random number between 1 and 14

i = i % 7 + 1; 
```

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2010-10-09T06:47:34.853

```
function Rand7
   put 200 into x
   repeat while x > 118
      put ((random(5)-1) * 25) + ((random(5)-1) * 5) + (random(5)-1) into x
   end repeat
   return (x mod 7) + 1
end Rand7 
```

对 Rand5 的 3 次调用，平均 125 次中仅重复 6 次。

把它想象成一个 3D 数组，5x5x5，一遍又一遍地填充 1 到 7 个，以及 6 个空白。在空白处重新滚动。rand5 调用在该数组中创建了一个三位数的 base-5 索引。

4D 或更高的 N 维数组的重复次数会更少，但这意味着对 rand5 函数的更多调用成为标准。您将开始在更高维度上获得递减的效率回报。在我看来，三个是一个很好的折衷方案，但我还没有对它们进行过测试以确定。这将是特定于 rand5 实现的。

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2010-11-30T17:22:18.657

```
int getOneToSeven(){
    int added = 0;
    for(int i = 1; i<=7; i++){
        added += getOneToFive();
    }
    return (added)%7+1;
} 
```

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2011-04-04T10:24:33.740

假设`rand`对所有位赋予相同的权重，然后使用上限进行掩码。

```
int i = rand(5) ^ (rand(5) & 2); 
```

`rand(5)`只能返回：`1b`, `10b`, `11b`, `100b`, `101b`. 您只需要关心有时设置 2 位。

* * *

## 回答 #42

> 赞同：2
> 
> 时间：2011-01-18T02:42:02.927

```
package CareerCup;

public class RangeTransform {
 static int counter = (int)(Math.random() * 5 + 1);

 private int func() {
  return (int) (Math.random() * 5 + 1);
 }

 private int getMultiplier() {
  return counter % 5 + 1;
 }

 public int rangeTransform() {
  counter++;
  int count = getMultiplier();
  int mult = func() + 5 * count;
  System.out.println("Mult is : " + 5 * count);
  return (mult) % 7 + 1;
 }

 /**
  * @param args
  */
 public static void main(String[] args) {
  // TODO Auto-generated method stub
  RangeTransform rangeTransform = new RangeTransform();
  for (int i = 0; i < 35; i++)
   System.out.println("Val is : " + rangeTransform.rangeTransform());
 }
} 
```

* * *

## 回答 #43

> 赞同：2
> 
> 时间：2015-06-01T08:53:49.413

此处似乎未涵盖的另一个答案：

```
int rand7() {
  int r = 7 / 2;
  for (int i = 0; i < 28; i++)
    r = ((rand5() - 1) * 7 + r) / 5;
  return r + 1;
} 
```

每次迭代`r`都有一个介于 0 和 6 之间的随机值（包括 0 和 6）。将其附加（以 7 为基数）到 0 到 4（含）之间的随机值，结果除以 5，给出 0 到 6（含）范围内的新随机值。 `r`从一个很大的偏差开始（`r = 3`非常有偏差！），但每次迭代都会将该偏差除以 5。

这种方法*并不*完全统一；但是，偏差非常小。大约 1/(2**64) 的东西。这种方法的重要之处在于它具有恒定的执行时间（假设`rand5()`也具有恒定的执行时间）。没有理论上的担忧，即不幸的调用可能会永远迭代选择错误的值。

* * *

此外，一个很好的措施的讽刺答案（有意或无意，它已被涵盖）：

1-5 已经在 1-7 范围内，因此以下是有效的实现：

```
int rand7() {
  return rand5();
} 
```

问题没有要求均匀分布。

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2014-05-25T10:53:14.580

给定一个生成 1 到 5 范围内随机整数`rand5()`的函数，编写一个生成 1 到 7 范围内随机整数的函数`rand7()`

在我提出的解决方案中，我只调用`rand5`一次

**真正的解决方案**

```
float rand7()
{
    return (rand5() * 7.0) / 5.0 ;
} 
```

这里的分布是按比例缩放的，所以它直接取决于`rand5`

**整数解**

```
int rand7()
{
    static int prev = 1;

    int cur = rand5();

    int r = cur * prev; // 1-25

    float f = r / 4.0; // 0.25-6.25

    f = f - 0.25; // 0-6

    f = f + 1.0; // 1-7

    prev = cur;

    return (int)f;
} 
```

这里的分布取决于系列`rand7(i) ~ rand5(i) * rand5(i-1)`

和`rand7(0) ~ rand5(0) * 1`

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2014-03-17T23:50:29.523

此解决方案的灵感来自 Rob McAfee。
但是它不需要循环，结果是均匀分布：

```
// Returns 1-5
var rnd5 = function(){
   return parseInt(Math.random() * 5, 10) + 1;
}
// Helper
var lastEdge = 0;
// Returns 1-7
var rnd7 = function () {
  var map = [
     [ 1, 2, 3, 4, 5 ],
     [ 6, 7, 1, 2, 3 ],
     [ 4, 5, 6, 7, 1 ],
     [ 2, 3, 4, 5, 6 ],
     [ 7, 0, 0, 0, 0 ]
  ];
  var result = map[rnd5() - 1][rnd5() - 1];
  if (result > 0) {
    return result;
  }
  lastEdge++;
  if (lastEdge > 7 ) {
    lastEdge = 1;
  }
  return lastEdge;
};

// Test the a uniform distribution
results = {}; for(i=0; i < 700000;i++) { var rand = rnd7(); results[rand] = results[rand] ? results[rand] + 1 : 1;} 
console.log(results) 
```

结果：`[1: 99560, 2: 99932, 3: 100355, 4: 100262, 5: 99603, 6: 100062, 7: 100226]`

`[jsFiddle](http://jsfiddle.net/ZkTbq/)`

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2014-01-06T19:26:12.117

这与@RobMcAfee 类似，只是我使用幻数而不是二维数组。

```
int rand7() {
    int m = 1203068;
    int r = (m >> (rand5() - 1) * 5 + rand5() - 1) & 7;

    return (r > 0) ? r : rand7();
} 
```

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2014-03-28T20:23:59.663

我想你们都想多了。这个简单的解决方案不起作用吗？

```
int rand7(void)
{
    static int startpos = 0;
    startpos = (startpos+5) % (5*7);
    return (((startpos + rand5()-1)%7)+1);
} 
```

* * *

## 回答 #48

> 赞同：1
> 
> 时间：2011-02-18T02:43:45.130

这个怎么样

rand5()%2+rand5()%2+rand5()%2+rand5()%2+rand5()%2+rand5()%2

不确定这是均匀分布的。有什么建议么？

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2013-12-18T21:17:55.523

```
function rand7() {
    while (true) { //lowest base 5 random number > 7 reduces memory
        int num = (rand5()-1)*5 + rand5()-1;
    if (num < 21)  // improves performance
        return 1 + num%7;
    }
} 
```

Python代码：

```
from random import randint
def rand7():
    while(True):
        num = (randint(1, 5)-1)*5 + randint(1, 5)-1
        if num < 21:
                return 1 + num%7 
```

100000 次运行的测试分布：

```
>>> rnums = []
>>> for _ in range(100000):
    rnums.append(rand7())
>>> {n:rnums.count(n) for n in set(rnums)}
{1: 15648, 2: 15741, 3: 15681, 4: 15847, 5: 15642, 6: 15806, 7: 15635} 
```

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2012-04-30T04:33:37.397

我首先想到的是这个。但我不知道它是否均匀分布。在python中实现

> 随机导入
> 
> def rand5():
> 
> > 返回随机数.randint(1,5)
> 
> def rand7():
> 
> > 返回 ( ( (rand5() -1) * rand5() ) %7 )+1

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2011-04-01T02:58:42.147

我想到了一个有趣的解决方案来解决这个问题，并想分享它。

```
function rand7() {

    var returnVal = 4;

    for (var n=0; n<3; n++) {
        var rand = rand5();

        if (rand==1||rand==2){
            returnVal+=1;
        }
        else if (rand==3||rand==4) {
            returnVal-=1;
        }
    }

    return returnVal;
} 
```

我构建了一个测试函数，它循环 rand7() 10,000 次，将所有返回值相加，然后除以 10,000。如果 rand7() 工作正常，我们计算的平均值应该是 4 - 例如，(1+2+3+4+5+6+7 / 7) = 4。经过多次测试，平均值确实是 4 :)

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2013-03-01T00:58:16.053

这里有很多解决方案不会产生均匀分布，许多评论指出了这一点，但*问题并未将其作为要求*。最简单的解决方案是：

```
int rand_7() { return rand_5(); } 
```

1 - 5 范围内的随机整数显然在 1 - 7 范围内。嗯，从技术上讲，最简单的解决方案是返回一个常数，但这太微不足道了。

但是，我认为 rand_5 函数的存在是一个红鲱鱼。假设问题被问为“产生一个均匀分布的伪随机数生成器，其整数输出范围为 1 - 7”。这是一个简单的问题（技术上不简单，但已经解决了，所以你可以查一下。）

另一方面，如果问题被解释为意味着您实际上有一个真正的随机数生成器，用于 1 - 5 范围内的整数（不是伪随机），那么解决方案是：

```
1) examine the rand_5 function
2) understand how it works
3) profit 
```

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2012-09-25T15:11:48.920

```
int rand7()
{
    return ( rand5() + (rand5()%3) );
} 
```

1.  rand5() - 返回 1-5 的值
2.  rand5()%3 - 返回 0-2 的值
3.  所以，当总结总价值将在 1-7 之间

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2013-01-25T18:54:25.440

这是我的一般实现，在给定 [0,B-1] 范围内的统一生成器的情况下生成 [0,N-1] 范围内的统一。

```
public class RandomUnif {

    public static final int BASE_NUMBER = 5;

    private static Random rand = new Random();

    /** given generator, returns uniform integer in the range 0.. BASE_NUMBER-1
    public static int randomBASE() {
        return rand.nextInt(BASE_NUMBER);
    }

    /** returns uniform integer in the range 0..n-1 using randomBASE() */
    public static int randomUnif(int n) {
        int rand, factor;
        if( n <= 1 ) return 0;
        else if( n == BASE_NUMBER ) return randomBASE();
        if( n < BASE_NUMBER ) {
            factor = BASE_NUMBER / n;
            do
                rand = randomBASE() / factor;
            while(rand >= n);
            return rand;
        } else {
            factor = (n - 1) / BASE_NUMBER + 1;
            do {
                rand = factor * randomBASE() + randomUnif(factor);
            } while(rand >= n);
            return rand;
        }
    }
} 
```

效率不高，但通用且紧凑。对基本生成器的平均调用：

```
 n  calls
 2  1.250 
 3  1.644 
 4  1.252 
 5  1.000 
 6  3.763 
 7  3.185 
 8  2.821 
 9  2.495 
10  2.250 
11  3.646 
12  3.316 
13  3.060 
14  2.853 
15  2.650 
16  2.814 
17  2.644 
18  2.502 
19  2.361 
20  2.248 
21  2.382 
22  2.277 
23  2.175 
24  2.082 
25  2.000 
26  5.472 
27  5.280 
28  5.119 
29  4.899 
```

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2014-09-06T18:16:58.003

这是利用 C++ 11 中的功能的答案

```
#include <functional>
#include <iostream>
#include <ostream>
#include <random>

int main()
{
    std::random_device rd;
    unsigned long seed = rd();
    std::cout << "seed = " << seed << std::endl;

    std::mt19937 engine(seed);

    std::uniform_int_distribution<> dist(1, 5);
    auto rand5 = std::bind(dist, engine);

    const int n = 20;
    for (int i = 0; i != n; ++i)
    {
        std::cout << rand5() << " ";
    }
    std::cout << std::endl;

    // Use a lambda expression to define rand7
    auto rand7 = [&rand5]()->int
    {
        for (int result = 0; ; result = 0)
        {
            // Take advantage of the fact that
            // 5**6 = 15625 = 15624 + 1 = 7 * (2232) + 1.
            // So we only have to discard one out of every 15625 numbers generated.

            // Generate a 6-digit number in base 5
            for (int i = 0; i != 6; ++i)
            {
                result = 5 * result + (rand5() - 1);
            }

            // result is in the range [0, 15625)
            if (result == 15625 - 1)
            {
                // Discard this number
                continue;
            }

            // We now know that result is in the range [0, 15624), a range that can
            // be divided evenly into 7 buckets guaranteeing uniformity
            result /= 2232;
            return 1 + result;
        }
    };

    for (int i = 0; i != n; ++i)
    {
        std::cout << rand7() << " ";
    }
    std::cout << std::endl;

    return 0;
} 
```

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2015-06-01T06:49:04.900

与[Martin 的回答](https://stackoverflow.com/a/21252243/2417578)类似，但不太频繁地使用熵：

```
int rand7(void) {
  static int m = 1;
  static int r = 0;

  for (;;) {
    while (m <= INT_MAX / 5) {
      r = r + m * (rand5() - 1);
      m = m * 5;
    }
    int q = m / 7;
    if (r < q * 7) {
      int i = r % 7;
      r = r / 7;
      m = q;
      return i + 1;
    }
    r = r - q * 7;
    m = m - q * 7;
  }
} 
```

`0`在这里，我们在和之间建立一个随机值`m-1`，并尝试`m`通过添加尽可能多的状态来最大化而不会溢出（`INT_MAX`这是适合`int`在 C 中的最大值，或者您可以用任何有意义的大值替换它你的语言和架构）。

然后; 如果`r`落在可被 7 整除的最大可能区间内，则它包含一个可行的结果，我们可以将该区间除以 7，并将余数作为我们的结果，并将剩余的值返回到我们的熵池。否则`r`在另一个不均匀划分的区间中，我们必须从那个不合适的区间丢弃并重新启动我们的熵池。

与这里的流行答案相比，它的调用`rand5()`频率平均约为一半。

可以将这些划分分解为琐碎的位旋转和 LUT 以提高性能。

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2018-09-10T08:07:30.660

来自扩大浮动范围的链接。这个更好玩。我没有得出结论，而是想到对于给定的`f`具有“基数” *b*的随机整数生成函数（在这种情况下为 4，我将说明原因），它可以扩展如下：

```
(b^0 * f() + b^1 * f() + b^2 * f() .... b^p * f()) / (b^(p+1) - 1) * (b-1) 
```

这会将随机生成器转换为 FLOAT 生成器。我将在这里定义 2 个参数`b`和`p`. 虽然这里的“基数”是 4，但 b 实际上可以是任何东西，也可以是无理数等`p`，我称精度是您希望浮点生成器的粒度程度。将此视为`rand5`每次调用`rand7`.

但我意识到如果你将 b 设置为 base+1（在这种情况下为 4+1 = 5），这是一个最佳点，你会得到一个均匀的分布。首先摆脱这个 1-5 生成器，实际上是 rand4() + 1：

```
function rand4(){
    return Math.random() * 5 | 0;
} 
```

要到达那里，你可以`rand4`用`rand5()-1`

接下来是将rand4从整数生成器转换为浮点生成器

```
function toFloat(f,b,p){
    b = b || 2;
    p = p || 3;
    return (Array.apply(null,Array(p))
    .map(function(d,i){return f()})
    .map(function(d,i){return Math.pow(b,i)*d})
    .reduce(function(ac,d,i){return ac += d;}))
    /
    (
        (Math.pow(b,p) - 1)
        /(b-1)
    )
} 
```

这会将我编写的第一个函数应用于给定的 rand 函数。试试看：

```
toFloat(rand4) //1.4285714285714286 base = 2, precision = 3
toFloat(rand4,3,4) //0.75 base = 3, precision = 4
toFloat(rand4,4,5) //3.7507331378299122 base = 4, precision = 5
toFloat(rand4,5,6) //0.2012288786482335 base = 5, precision =6
... 
```

现在您可以将此浮点范围（0-4 INCLUSIVE）转换为任何其他浮点范围，然后将其降级为整数。这里我们的基础是`4`因为我们正在处理`rand4`，因此一个值`b=5`会给你一个均匀的分布。随着 b 增长超过 4，您将开​​始在分布中引入周期性间隙。我测试了从 2 到 8 的 b 值，每个值 3000 分，并与 JavaScript 的原生 Math.random 进行比较，在我看来甚至比原生的更好：

[http://jsfiddle.net/ibowankenobi/r57v432t/](http://jsfiddle.net/ibowankenobi/r57v432t/)

对于上面的链接，单击分布顶部的“bin”按钮以减小分箱大小。最后一张图是原生 Math.random，第 4 个 d=5 是统一的。

得到浮点范围后，要么乘以 7 并抛出小数部分，要么乘以 7，减去 0.5 并四舍五入：

```
((toFloat(rand4,5,6)/4 * 7) | 0) + 1   ---> occasionally you'll get 8 with 1/4^6 probability.
Math.round((toFloat(rand4,5,6)/4 * 7) - 0.5) + 1 --> between 1 and 7 
```

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2017-04-01T19:30:02.260

1.  什么是简单的解决方案？`(rand5() + rand5()) % 7 + 1`

2.  什么是减少内存使用或在较慢 CPU 上运行的有效解决方案？`Yes, this is effective as it calls rand5() only twice and have O(1) space complexity`

考虑`rand5()`给出从 1 到 5（含）的随机数。
(1 + 1) % 7 + 1 = 3
(1 + 2) % 7 + 1 = 4
(1 + 3) % 7 + 1 = 5
(1 + 4) % 7 + 1 = 6
(1 + 5) % 7 + 1 = 7

(2 + 1) % 7 + 1 = 4
(2 + 2) % 7 + 1 = 5
(2 + 3) % 7 + 1 = 6
(2 + 4) % 7 + 1 = 7
(2 + 5) % 7 + 1 = 1
...

(5 + 1) % 7 + 1 = 7
(5 + 2) % 7 + 1 = 1
(5 + 3) % 7 + 1 = 2
(5 + 4) % 7 + 1 = 3
(5 + 5) % 7 + 1 = 4
...

等等

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2015-04-27T02:38:19.193

这个问题的主要概念是关于正态分布，这里为这个问题提供了一个简单的递归解决方案

假设我们已经`rand5()`在我们的范围内：

```
def rand7():
    # twoway = 0 or 1 in the same probability
    twoway = None
    while not twoway in (1, 2):
        twoway = rand5()
    twoway -= 1

    ans = rand5() + twoway * 5

    return ans if ans in range(1,8) else rand7() 
```

# 解释

我们可以把这个程序分成两部分：

1.  循环 rand5() 直到我们找到 1 或 2，这意味着我们有 1/2 的概率在变量中有 1 或 2`twoway`
2.  `ans`由合成`rand5() + twoway * 5`，这正是 的结果`rand10()`，如果这不符合我们的需要（1~7），那么我们再次运行 rand7。

PS 我们**不能**在第二部分直接运行一个while循环，因为每个概率都`twoway`需要是单独的。

但是有一个权衡，因为第一节的while循环和return语句中的递归，这个函数不保证执行时间，实际上是无效的。

# 结果

我做了一个简单的测试来观察我的答案的分布。

```
result = [ rand7() for x in xrange(777777) ]

ans = {
    1: 0,
    2: 0,
    3: 0,
    4: 0,
    5: 0,
    6: 0,
    7: 0,
}

for i in result:
    ans[i] += 1

print ans 
```

它给了

```
{1: 111170, 2: 110693, 3: 110651, 4: 111260, 5: 111197, 6: 111502, 7: 111304} 
```

因此我们可以知道这个答案是正态分布的。

# 简化答案

如果您不关心此函数的执行时间，这里有一个基于我给出的上述答案的简化答案：

```
def rand7():
    ans = rand5() + (rand5()-1) * 5
    return ans if ans < 8 else rand7() 
```

这增加了大于 8 的值的概率，但可能是这个问题的最短答案。

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2014-10-23T23:16:39.163

这是我的，它试图`Math.random()`从多个`rand5()`函数调用中重新创建，通过用“加权分数”（？）重建单位间隔（的输出范围`Math.random()`）来重建它。然后使用这个随机单位区间产生一个 1 到 7 之间的随机整数：

```
function rand5(){
  return Math.floor(Math.random()*5)+1;
}
function rand7(){
  var uiRandom=0;
  var div=1;
  for(var i=0; i<7; i++){
    div*=5;
    var term=(rand5()-1)/div;
    uiRandom+=term;
  }
  //return uiRandom;
  return Math.floor(uiRandom*7)+1; 
} 
```

解释一下：我们取一个 0-4 之间的随机整数（只是`rand5()-1`），然后将每个结果乘以 1/5、1/25、1/125……，然后将它们相加。它类似于二进制加权分数的工作方式。我想相反，我们将其称为五进制（以 5 为底）加权分数：从 0 到 0.999999 产生一个数字作为一系列 (1/5)^n 项。

修改函数以采用任何输入/输出随机整数范围应该是微不足道的。并且上面的代码可以在重写为闭包时进行优化。

* * *

或者，我们也可以这样做：

```
function rand5(){
  return Math.floor(Math.random()*5)+1;
}
function rand7(){
  var buffer=[];
  var div=1;
  for (var i=0; i<7; i++){
    buffer.push((rand5()-1).toString(5));
    div*=5;
  }
  var n=parseInt(buffer.join(""),5);
  var uiRandom=n/div;
  //return uiRandom;
  return Math.floor(uiRandom*7)+1; 
} 
```

我们实际上将创建一个五进制数并将其转换为分数（0--0.9999... 和以前一样），而不是摆弄构造一个五进制（以 5 为底）加权分数，然后计算我们的随机 1--7 位从那里。

上述结果（代码片段 #2：3 次运行，每次调用 100,000 次）：

> 1：14263；2：14414；3：14249；4：14109；5：14217；6：14361；7: 14387
> 
> 1：14205；2：14394；3：14238；4：14187；5：14384；6：14224；7: 14368
> 
> 1：14425；2：14236；3：14334；4：14232；5：14160；6：14320；7: 14293

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2013-09-02T12:34:23.560

这个表达式足以得到 1 - 7 之间的随机整数

```
int j = ( rand5()*2 + 4 ) % 7 + 1; 
```

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2014-10-16T13:14:28.070

如果有人能给我关于这个的反馈会很酷，我使用了没有断言模式的 JUNIT，因为在 Eclipse 中运行它既容易又快速，我也可以定义一个 main 方法。顺便说一句，我假设 rand5 给出的值是 0-4，加 1 会使它变成 1-5，与 rand7 相同......所以讨论应该是关于解决方案，它的分布，而不是它是否从 0-4或 1-5...

```
package random;

import java.util.Random;

import org.junit.Test;

public class RandomTest {

    @Test
    public void testName() throws Exception {
        long times = 100000000;
        int indexes[] = new int[7];
        for(int i = 0; i < times; i++) {
            int rand7 = rand7();
            indexes[rand7]++;
        }

        for(int i = 0; i < 7; i++)
            System.out.println("Value " + i + ": " + indexes[i]);
    }

    public int rand7() {
        return (rand5() + rand5() + rand5() + rand5() + rand5() + rand5() + rand5()) % 7;
    }

    public int rand5() {
        return new Random().nextInt(5);
    }

} 
```

当我运行它时，我得到了这个结果：

```
Value 0: 14308087
Value 1: 14298303
Value 2: 14279731
Value 3: 14262533
Value 4: 14269749
Value 5: 14277560
Value 6: 14304037 
```

这似乎是一个非常公平的分配，不是吗？

如果我添加 rand5() 更少或更多次（其中次数不能被 7 整除），则分布清楚地显示偏移量。例如，添加`rand5()`3 次：

```
Value 0: 15199685
Value 1: 14402429
Value 2: 12795649
Value 3: 12796957
Value 4: 14402252
Value 5: 15202778
Value 6: 15200250 
```

因此，这将导致以下情况：

```
public int rand(int range) {
    int randomValue = 0;
    for(int i = 0; i < range; i++) {
        randomValue += rand5();
    }
    return randomValue % range;

} 
```

然后，我可以更进一步：

```
public static final int ORIGN_RANGE = 5;
public static final int DEST_RANGE  = 7;

@Test
public void testName() throws Exception {
    long times = 100000000;
    int indexes[] = new int[DEST_RANGE];
    for(int i = 0; i < times; i++) {
        int rand7 = convertRand(DEST_RANGE, ORIGN_RANGE);
        indexes[rand7]++;
    }

    for(int i = 0; i < DEST_RANGE; i++)
        System.out.println("Value " + i + ": " + indexes[i]);
}

public int convertRand(int destRange, int originRange) {
    int randomValue = 0;
    for(int i = 0; i < destRange; i++) {
        randomValue += rand(originRange);
    }
    return randomValue % destRange;

}

public int rand(int range) {
    return new Random().nextInt(range);
} 
```

我尝试将 destRange 和 originRange 替换为各种值（对于 ORIGIN 甚至是 7，对于 DEST 是 13），我得到了这个分布：

```
Value 0: 7713763
Value 1: 7706552
Value 2: 7694697
Value 3: 7695319
Value 4: 7688617
Value 5: 7681691
Value 6: 7674798
Value 7: 7680348
Value 8: 7685286
Value 9: 7683943
Value 10: 7690283
Value 11: 7699142
Value 12: 7705561 
```

我可以从这里得出的结论是，您可以通过将原始随机“目的地”时间相加来将任何随机更改为任何其他。这将得到一种高斯分布（中间值更有可能，边缘值更不常见）。然而，目的地的模数似乎在这个高斯分布中均匀分布......从数学家那里得到反馈会很棒......

很酷的是成本是 100% 可预测和恒定的，而其他解决方案导致无限循环的概率很小......

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2012-04-05T20:27:38.047

为什么不直接除以 5 再乘以 7，然后四舍五入？（当然，您必须使用浮点数）

它比其他解决方案更容易和更可靠（真的吗？）。例如在 Python 中：

```
def ranndomNo7():
    import random
    rand5 = random.randint(4)    # Produces range: [0, 4]
    rand7 = int(rand5 / 5 * 7)   # /5, *7, +0.5 and floor()
    return rand7 
```

那不是很容易吗？

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2014-10-23T22:27:50.013

首先，我在 1 点上移动 ramdom5() 6 次，得到 7 个随机数。其次，我将 7 个数字相加以获得共同的和。第三，我在 7 处得到除法的余数。最后，我加 1 得到从 1 到 7 的结果。这种方法给出了得到 1 到 7 范围内数字的相等概率，但 1 除外。1 有一个概率略高。

```
public int random7(){
    Random random = new Random();
    //function (1 + random.nextInt(5)) is given
    int random1_5 = 1 + random.nextInt(5); // 1,2,3,4,5
    int random2_6 = 2 + random.nextInt(5); // 2,3,4,5,6
    int random3_7 = 3 + random.nextInt(5); // 3,4,5,6,7
    int random4_8 = 4 + random.nextInt(5); // 4,5,6,7,8
    int random5_9 = 5 + random.nextInt(5); // 5,6,7,8,9
    int random6_10 = 6 + random.nextInt(5); //6,7,8,9,10
    int random7_11 = 7 + random.nextInt(5); //7,8,9,10,11

    //sumOfRandoms is between 28 and 56
    int sumOfRandoms = random1_5 + random2_6 + random3_7 + 
                       random4_8 + random5_9 + random6_10 + random7_11;
    //result is number between 0 and 6, and
    //equals 0 if sumOfRandoms = 28 or 35 or 42 or 49 or 56 , 5 options
    //equals 1 if sumOfRandoms = 29 or 36 or 43 or 50, 4 options
    //equals 2 if sumOfRandoms = 30 or 37 or 44 or 51, 4 options
    //equals 3 if sumOfRandoms = 31 or 38 or 45 or 52, 4 options
    //equals 4 if sumOfRandoms = 32 or 39 or 46 or 53, 4 options
    //equals 5 if sumOfRandoms = 33 or 40 or 47 or 54, 4 options
    //equals 6 if sumOfRandoms = 34 or 41 or 48 or 55, 4 options
    //It means that the probabilities of getting numbers between 0 and 6 are almost equal.
    int result = sumOfRandoms % 7;
    //we should add 1 to move the interval [0,6] to the interval [1,7]
    return 1 + result;
} 
```

* * *

## 回答 #65

> 赞同：0
> 
> 时间：2014-10-15T02:53:52.627

简单的解决方案已经很好地涵盖了：`random5`为一个结果取两个样本，`random7`如果结果超出生成均匀分布的范围，则重新进行。如果您的目标是减少调用次数，`random5`这是非常浪费的 -由于丢弃样本的数量，`random5`每个输出的平均调用次数为 2.38 而不是 2。`random7`

`random5`您可以通过使用更多输入一次生成多个输出来做得更好`random7`。对于使用 31 位整数计算的结果，最佳值出现在使用 12 次调用`random5`生成 9 个`random7`输出时，每个输出平均调用 1.34 次。这是有效的，因为在 244140625 个结果中只有 2018983 个需要报废，或者不到 1%。

Python中的演示：

```
def random5():
    return random.randint(1, 5)

def random7gen(n):
    count = 0
    while n > 0:
        samples = 6 * 7**9
        while samples >= 6 * 7**9:
            samples = 0
            for i in range(12):
                samples = samples * 5 + random5() - 1
                count += 1
        samples //= 6
        for outputs in range(9):
            yield samples % 7 + 1, count
            samples //= 7
            count = 0
            n -= 1
            if n == 0: break

>>> from collections import Counter
>>> Counter(x for x,i in random7gen(10000000))
Counter({2: 1430293, 4: 1429298, 1: 1428832, 7: 1428571, 3: 1428204, 5: 1428134, 6: 1426668})
>>> sum(i for x,i in random7gen(10000000)) / 10000000.0
1.344606 
```

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2020-08-31T23:24:44.173

对于 [1, 5] 到 [1, 7] 的范围，这相当于用 5 面骰子滚动 7 面骰子。

但是，如果不“浪费”随机性（或者在最坏的情况下永远运行），这是无法做到的，因为 7 的所有质因数（即 7）不整除 5。因此，可以做到的最好的就是使用拒绝抽样来任意接近没有“浪费”的随机性（例如通过批量处理多卷 5 面模具，直到 5^ *n* “足够接近”到 7 的幂）。这个问题的解决方案已经在其他答案中给出。

*更一般地说，用p*面骰子掷*k*面骰子的算法将不可避免地“浪费”随机性（并且在最坏的情况下永远运行），除非“每个除*k*的素数也除*p* ”，根据引理 3 在B. Kloeckner 的“用骰子[模拟骰子”。](https://perso.math.u-pem.fr/kloeckner.benoit/papiers/DiceSimulation.pdf)例如，采用更实际的情况，即*p*是 2 的幂，*k*是任意的。在这种情况下，这种“浪费”和不确定的运行时间是不可避免的，除非*k*也是 2 的幂。

 **** * *

## 回答 #67

> 赞同：0
> 
> 时间：2019-08-27T15:01:55.207

这是一个解决方案，它试图最小化对 rand5() 的调用次数，同时保持实现简单高效；特别是，它不像 Adam Rosenfield 的第二个答案那样需要任意大整数。它利用了 23/19 = 1.21052... 是 log(7)/log(5) = 1.20906... 的良好有理逼近这一事实，因此我们可以生成 {1,...,7 的 19 个随机元素} 在 {1,...,5} 的 23 个随机元素中，通过仅以很小的拒绝概率进行拒绝采样。平均而言，对于 rand7() 的每次调用，下面的算法大约需要 1.266 次对 rand5() 的调用。如果 rand5() 的分布是均匀的，那么 rand7() 也是均匀的。

```
uint_fast64_t pool;

int capacity = 0;

void new_batch (void)
{
  uint_fast64_t r;
  int i;

  do {
    r = 0;
    for (i = 0; i < 23; i++)
      r = 5 * r + (rand5() - 1);
  } while (r >= 11398895185373143ULL);  /* 7**19, a bit less than 5**23 */

  pool = r;
  capacity = 19;
}

int rand7 (void)
{
  int r;

  if (capacity == 0)
    new_batch();

  r = pool % 7;
  pool /= 7;
  capacity--;

  return r + 1;
} 
```

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2015-08-11T18:38:48.330

该算法将 rand5 的调用次数减少到理论最小值的 7/5。通过产生接下来的 5 个 rand7 数字来调用它 7 次。

没有拒绝任何随机位，也不可能一直等待结果。

```
#!/usr/bin/env ruby

# random integer from 1 to 5
def rand5
    STDERR.putc '.'
    1 + rand( 5 )
end

@bucket = 0
@bucket_size = 0

# random integer from 1 to 7
def rand7
    if @bucket_size == 0
        @bucket = 7.times.collect{ |d| rand5 * 5**d }.reduce( &:+ )
        @bucket_size = 5
    end

    next_rand7 = @bucket%7 + 1

    @bucket      /= 7
    @bucket_size -= 1

    return next_rand7
end

35.times.each{ putc rand7.to_s } 
```

* * *

## 回答 #69

> 赞同：-1
> 
> 时间：2009-04-30T17:46:33.007

在所有这些复杂的答案面前，我感到很愚蠢。

为什么不能：

```
int random1_to_7()
{
  return (random1_to_5() * 7) / 5;  
} 
```

?

* * *

## 回答 #70

> 赞同：-2
> 
> 时间：2009-04-30T15:14:08.333

产生近似均匀分布的恒定时间解。~~诀窍是 625 恰好可以被 7 整除，并且当您建立到该范围时，您可以获得均匀分布。~~

**编辑：**我的错，我算错了，但我不会把它拉出来，以防有人觉得它有用/有趣。毕竟它*确实有效...... :)*

```
int rand5()
{
    return (rand() % 5) + 1;
}

int rand25()
{ 
    return (5 * (rand5() - 1) + rand5());
}

int rand625()
{
    return (25 * (rand25() - 1) + rand25());
}

int rand7()
{
    return ((625 * (rand625() - 1) + rand625()) - 1) % 7 + 1;
} 
```

* * *

## 回答 #71

> 赞同：-2
> 
> 时间：2015-05-12T11:17:59.930

```
def rand5():
    return random.randint(1,5)    #return random integers from 1 to 5

def rand7():
    rand = rand5()+rand5()-1
    if rand > 7:                  #if numbers > 7, call rand7() again
        return rand7()
    print rand%7 + 1 
```

我想这将是最简单的解决方案，但是人们`5*rand5() + rand5() - 5`在[http://www.geeksforgeeks.org/generate-integer-from-1-to-7-with-equal-probability/](http://www.geeksforgeeks.org/generate-integer-from-1-to-7-with-equal-probability/)中提出的建议。有人可以解释有什么问题吗`rand5()+rand5()-1`

* * *

## 回答 #72

> 赞同：-2
> 
> 时间：2019-05-17T10:49:45.047

```
// returns random number between 0-5 with equal probability
function rand5() {
  return Math.floor(Math.random() * 6);
}

// returns random number between 0-7 with equal probability
function rand7() {
  if(rand5() % 2 == 0 && rand5() % 2 == 0) { 
    return 6 + rand5() % 2;
  } else {
    return rand5();
  }
}

console.log(rand7());
```

* * *

## 回答 #73

> 赞同：-3
> 
> 时间：2009-04-30T17:59:51.837

```
#!/usr/bin/env ruby
class Integer
  def rand7
    rand(6)+1
  end
end

def rand5
  rand(4)+1
end

x = rand5() # x => int between 1 and 5

y = x.rand7() # y => int between 1 and 7 
```

..although that may possibly be considered cheating..

* * *

## 回答 #74

> 赞同：-3
> 
> 时间：2009-04-30T17:43:03.920

```
int rand7()
{
    int zero_one_or_two = ( rand5() + rand5() - 1 ) % 3 ;
    return rand5() + zero_one_or_two ;
} 
```

* * *

## 回答 #75

> 赞同：-4
> 
> 时间：2008-11-27T20:21:43.657

php中的解决方案

```
<?php
function random_5(){
    return rand(1,5);
}

function random_7(){
 $total = 0;

    for($i=0;$i<7;$i++){
        $total += random_5();
    }

    return ($total%7)+1; 
}

echo random_7();
?> 
```

* * *

## 回答 #76

> 赞同：-4
> 
> 时间：2009-05-03T10:22:05.903

我玩过，我为这个 Rand(7) 算法编写了[“测试环境” 。](http://gist.github.com/105929)例如，如果您想尝试什么分布给您的算法或生成所有不同的随机值需要多少次迭代（对于 Rand(7) 1-7），您[可以使用它](http://gist.github.com/105929)。

我的核心算法是这样的：

```
return (Rand5() + Rand5()) % 7 + 1; 
```

Well 的均匀分布不亚于 Adam Rosenfield 的分布。（[我包含在我的代码段中](http://gist.github.com/105929)）

```
private static int Rand7WithRand5()
{
    //PUT YOU FAVOURITE ALGORITHM HERE//

    //1\. Stackoverflow winner
    int i;
    do
    {
        i = 5 * (Rand5() - 1) + Rand5(); // i is now uniformly random between 1 and 25
    } while (i > 21);
    // i is now uniformly random between 1 and 21
    return i % 7 + 1;

    //My 2 cents
    //return (Rand5() + Rand5()) % 7 + 1;
} 
```

这种“测试环境”可以采用任何 Rand(n) 算法并对其进行测试和评估（分布和速度）。只需将您的代码放入“Rand7WithRand5”方法并运行代码段即可。

几点观察：

*   Adam Rosenfield 的算法的分布并不比我的算法好。无论如何，这两种算法的分布都很糟糕。
*   Native Rand7 ( `random.Next(1, 8)`) 在大约 200 多次迭代中生成给定间隔内的所有成员时完成，Rand7WithRand5 算法需要 10k（大约 30-70k）
*   真正的挑战不是编写从 Rand(5) 生成 Rand(7) 的方法，而是生成或多或少均匀分布的值。

* * *

## 回答 #77

> 赞同：-4
> 
> 时间：2018-08-24T01:43:12.287

这是我想出的答案，但这些复杂的答案让我觉得这完全不对/:))

```
import random

def rand5():
    return float(random.randint(0,5))

def rand7():
    random_val = rand5()
    return float(random.randint((random_val-random_val),7))

print rand7() 
```

# sql-server - SSRS：动态更改 SQL 语句

> ID：137784
> 
> 赞同：5
> 
> 时间：2008-09-26T04:33:41.643
> 
> 标签：sql-server, tsql, reporting-services, reportingservices-2005

我在 SSRS 2005 中有一份基于与此类似的查询的报告：

```
SELECT * FROM MyTable (NOLOCK) 
WHERE col1 = 'ABC'
AND col2 LIKE '%XYZ%' 
```

我需要能够根据用户是否选中复选框，在查询中动态包含 WHERE 子句的 AND 部分。基本上，这是一个动态 SQL 语句，这就是问题所在。我尝试了几种方法都无济于事。这可能吗？SSRS 2005 是否支持动态 SQL？谢谢！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T07:46:50.383

查尔斯几乎得到了正确的答案。

它应该是：

```
SELECT * FROM MyTable (NOLOCK) 
WHERE col1 = 'ABC'
   AND (@checked = 0 OR col2 LIKE '%XYZ%') 
```

这是 SQL 中用于条件谓词的经典“模式”。如果`@checked = 0`，那么它将返回与谓词 ( `col1 = 'ABC'`) 其余部分匹配的所有行。SQL Server 甚至不会处理`OR`.

如果`@checked = 1`那么它将评估第二部分`OR`并返回匹配的行`col1 = 'ABC' AND col2 LIKE '%XYZ%'`

如果您有多个条件谓词，则可以使用此方法将它们链接在一起（而 IF 和 CASE 方法将很快变得难以管理）。

例如：

```
SELECT * FROM MyTable (NOLOCK) 
WHERE col1 = 'ABC'
    AND (@checked1 = 0 OR col2 LIKE '%XYZ%')
    AND (@checked2 = 0 OR col3 LIKE '%MNO%') 
```

不要使用动态 SQL，不要使用 IF 或 CASE。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T05:35:00.997

这个怎么样。@checked 是您的位变量。

```
SELECT * FROM MyTable (NOLOCK) 
WHERE col1 = 'ABC'
AND (@checked <> 0 and col2 LIKE '%XYZ%') 
```

**编辑：** 另外，如果您不使用存储过程，请使用一个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T05:00:54.900

也许这对你有用：

```
if @checked = 1
    select * from mytable (nolock) where col = 'ABC'
else
    select * from mytable (nolock) where col = 'ABC' AND colw Like '%XYZ%' 
```

对不起，我不怎么使用 SSRS，但是如果你可以将复选框的值放入 @checked 参数中，这应该可以工作。

或者，您可以使用 CASE WHEN 语句。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T05:56:52.143

```
SELECT * FROM MyTable (NOLOCK) 
WHERE col1 = 'ABC'
AND col2 LIKE CASE @checked WHEN 1 THEN '%XYZ%' ELSE col2 END 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T06:12:55.943

这将在 SSRS 2000 中工作，但用作最后的手段。

（坏）伪代码

```
="SELECT * FROM MyTable (NOLOCK)
WHERE col1 = 'ABC'"+
iff(condition,true,"AND col2 LIKE '%XYZ%'","") 
```

查看[执行“动态”SQL 查询](http://books.google.com/books?id=EII8FmTumX0C&pg=PA298&lpg=PA298&dq=SSRS+dynamic+sql&source=web&ots=0hZJH_gXja&sig=sKy-537AmHki69qpIyTgBO1KM0g&hl=en&sa=X&oi=book_result&resnum=4&ct=result#PPA299,M1)。从 Hitchhiker's Guide to SQL Server 2000 Reporting Services

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T07:38:20.043

一种方法是将 SSRS 查询生成为表达式。在 BIDS 报表设计器中，像这样设置您的查询：

```
="SELECT * FROM MyTable WITH (NOLOCK) WHERE col1 = 'ABC'" +
 Iif(Parameters!Checked.Value = true," AND col2 LIKE '%XYZ%'","") 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T05:29:59.370

您还可以采取另一种方法并使用 Exec 函数：

```
DECLARE @CommonSelectText varchar(2000)  
DECLARE @CompleteSelectText varchar(2000)  
SELECT @CommonSelectText = 'SELECT * FROM MyTable (nolock) Where Col = ''ABC'' '  

IF @checked = 1   
    SELECT @CompleteSelectText = @CommonSelectText + ' AND ColW LIKE ''%XYZ%'' '  
ELSE  
    SELECT @CompleteSelectText = @CommonSelectText  

EXEC (@CompleteSelectText)  

GO 
```

请注意使用两个撇号`'`来标记引用的文本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T16:35:40.617

如果您可以使用存储过程，那么在那里执行它可能更容易。传入你的参数。根据您的条件创建一个 SQL 字符串并对 sql 字符串执行 EXEC，您的存储过程将返回您需要的结果。

# apache-flex - 关于将 Flex 与 WCF 和 Linq to Entities 一起使用的建议

> ID：137793
> 
> 赞同：3
> 
> 时间：2008-09-26T04:37:18.077
> 
> 标签：apache-flex, wcf, actionscript-3, actionscript

因此，我正在开发一个使用 ASP.NET 服务器的项目，并且我们通过 WCF 从 LINQ 到实体查询传递了实体。我已经克服了 WCF 的循环引用问题。现在我正在寻找下一步，即 Flex UI，我想知道人们在处理来自 Flex 的 WCF 或使用带有 Flex 的实体（来自实体框架的实体）时已经面临哪些问题？Flex 建议、库、模式和技巧会有所帮助。谢谢。

有帮助的事情：

*   如何在 UI 端“持久化”或欺骗实体。
*   安全性，如何保护从 UI 到服务的通信。
*   如何从 UI 生成/传递新实体到服务，然后解释为 .NET 实体

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T07:14:14.373

我会检查 Fluorine FX。它是一个非常成熟和稳定的 .NET AMF 实现，并且确实提供了 WCF 集成。我的一个同事在这里发布了一些信息：

[http://jimdonaghy.com/?p=11](http://jimdonaghy.com/?p=11)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T06:53:18.157

在 Flex 应用程序和 WCF 服务之间进行通信有多种选择。Flex 支持 SOAP Web 服务和类似 REST 的 Web 服务，因此您可以选择最适合您的方法。当您在客户端收到数据时，您需要从响应中提取实体并相应地构建 UI。与更新或创建新实体类似 - 您需要从用户界面控件构建 Web 服务请求并通过网络发送它。

还要研究 AMF，它是一种用于 Flex/Flash 和服务器之间通信的二进制格式。那里有 .NET 实现（例如 AMF.NET），因此有可能以某种方式使其与 WCF 一起工作 - 您需要自己探索这个领域，我在这里没有直接经验。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T19:57:20.167

[http://jimdonaghy.com?p=11](http://jimdonaghy.com?p=11)似乎坏了，但如果你懒得谷歌的话，这里有一个 FluorineFX 的链接。

[http://www.fluorinefx.com/](http://www.fluorinefx.com/)

我推荐 AMF 而不是 REST 或 SOAP，因为 AMF 是一种二进制协议，具有很大的性能提升。

另一方面，如果您确实计划向其他类型的 ui 客户端开放您的服务，那么请务必使用 REST。

# sql-server - SQL SERVER，带有自动生成行 ID 的 SELECT 语句

> ID：137803
> 
> 赞同：16
> 
> 时间：2008-09-26T04:40:43.887
> 
> 标签：sql-server

有谁碰巧记得 SQL Server 2000 内置的用于生成顺序行号的函数名称。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-26T04:46:58.460

如果您正在使用 GUID，这应该很容易，如果您正在寻找整数 ID，则必须等待另一个答案。

```
SELECT newId() AS ColId, Col1, Col2, Col3 FROM table1 
```

newId() 将为您生成一个新的 GUID，您可以将其用作自动生成的 id 列。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-08-01T09:11:41.753

这是一个简单的方法，可以在行排序之后对行进行排名，即插入到表中。在您的 SELECT 语句中，只需添加该字段

```
ROW_NUMBER() OVER (ORDER BY CAST(GETDATE() AS TIMESTAMP)) AS RowNumber. 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2012-03-20T03:34:34.923

这将适用于 SQL Server 2008。

```
select  top 100 ROW_NUMBER() OVER (ORDER BY tmp.FirstName) ,* from tmp 
```

干杯

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-26T04:48:53.430

如果您正在进行选择，则 IDENTITY(int, 1, 1) 应该这样做。在 SQL 2000 中，我过去只是将结果放在临时表中并查询该结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T09:53:24.057

您想要一个与您的记录集一起返回的递增整数列吗？如果是这样的话： -

```
--Check for existance  
if  exists (select * from dbo.sysobjects where [id] = object_id(N'dbo.t') AND objectproperty(id, N'IsUserTable') = 1)  
drop table dbo.t
go

--create dummy table and insert data  
create table dbo.t(x char(1) not null primary key, y char(1) not null)  
go  
set nocount on  
insert dbo.t (x,y) values ('A','B')  
insert dbo.t (x,y) values ('C','D')  
insert dbo.t (x,y) values ('E','F')

--create temp table to add an identity column  
create table dbo.#TempWithIdentity(i int not null identity(1,1) primary key,x char(1) not null unique,y char(1) not null)  

--populate the temporary table  
insert into dbo.#TempWithIdentity(x,y) select x,y from dbo.t

--return the data  
select i,x,y from dbo.#TempWithIdentity

--clean up  
drop table dbo.#TempWithIdentity 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T04:48:00.673

这可能是您正在寻找的吗？

> 从表中选择 NEWID() *

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T16:53:54.397

您可以根据 Microsoft 的页面直接在 SQL2000 中执行此操作：http: [//support.microsoft.com/default.aspx ?scid=kb;en-us;186133](http://support.microsoft.com/default.aspx?scid=kb;en-us;186133)

```
 select rank=count(*), a1.au_lname, a1.au_fname
   from authors a1, authors a2
   where a1.au_lname + a1.au_fname >= a2.au_lname + a2.au_fname
   group by a1.au_lname, a1.au_fname
   order by rank 
```

这种方法的唯一问题是（正如 Jeff 在 SQL Server Central 上所说）它是一个三角连接。所以，如果你有 10 条记录，这会很快，如果你有 1000 条记录，它会很慢，如果有 100 万条记录，它可能永远不会完成！

有关三角形连接的更好解释，请参见此处：[http ://www.sqlservercentral.com/articles/T-SQL/61539/](http://www.sqlservercentral.com/articles/T-SQL/61539/)

* * *

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-19T12:16:43.610

```
Select (Select count(y.au_lname) from dbo.authors y
where y.au_lname + y.au_fname <= x.au_lname + y.au_fname) as Counterid,
x.au_lname,x.au_fname from authors x group by au_lname,au_fname
order by Counterid --Alternatively that can be done which is equivalent as above.. 
```

# c++ - 你最喜欢的 C++0x 特性是什么？

> ID：137812
> 
> 赞同：41
> 
> 时间：2008-09-26T04:43:18.547
> 
> 标签：c++, c++11

正如我们许多人所知（还有很多人不知道），C++ 目前正在为国际标准的下一次修订进行最终起草，预计将在大约 2 年内发布。草案和文件目前可从[委员会网站](http://open-std.org/JTC1/SC22/WG21/)获得。正在添加各种新功能，其中最大的是概念和 lambda。有一篇非常全面的[Wikipedia 文章](http://en.wikipedia.org/wiki/C++0x)，其中包含许多新功能。GCC 4.3 及更高版本实现[了一些 C++0x 特性](http://gcc.gnu.org/projects/cxx0x.html)。

就新功能而言，我真的很喜欢类型特征（和适当的概念），但我的明确领导者是可变参数模板。在 0x 之前，长模板列表通常都涉及到 Boost Preprocessor，而且写起来很不爽。这使事情变得更容易，并允许将 C++0x 模板视为使用可变参数模板的完美功能语言。我已经用它们编写了一些非常酷的代码，我迫不及待地想更频繁地使用它们！

那么您最期待的功能是什么？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-09-26T04:47:13.653

**变量类型推断的**auto关键字****

 *** * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-09-26T05:00:30.937

Lambda 和初始化列表。

此外，使最终将 C++ 带入垃圾收集模型变得更容易的更改，这些看起来很有趣。也许 C++1x 实际上会带来垃圾收集，但 0x/10 只是为可能发生的情况做好准备。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-26T05:04:52.347

我想要 Rvalues 参考。

所有其他新功能都是我们可以轻松生活的东西（唉功能）。然而，到目前为止，C++ 中缺乏 Rvalues 导致数百名模板库作者不得不“破解”损坏的 Rvalue ref 问题。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-09-26T06:00:44.867

可变参数模板！（结合 r 值引用为我们提供了完美的转发！）

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-09-26T04:52:10.473

线程和原子。

现在使用多核处理器，标准 C++0x 应该是 C++07。

G。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-10-29T21:24:52.413

[强类型枚举](http://en.wikipedia.org/wiki/C++0x#Strongly_typed_enumerations)得到我的投票。帕斯卡只有大约 40 年的时间，所以很高兴看到 C++ 终于赶上了。

但是，该标准的发布确实是小菜一碟。更重要的是，当您想要使用的功能实际上得到真实世界工具链的完全可靠支持时。[有些人似乎实际上喜欢编写无法在任何已知编译器上编译的符合标准的代码。](http://www.ddj.com/cpp/184403774)祝他们好运。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-09-26T05:16:53.880

1.  它必须是一些 Boost 库的合并（shared_ptr<> 并绑定在列表顶部）

2.  对模板实例化的控制应该最终解决巨大的编译时间问题，并使在大型项目中使用现代模板代码实际上可行。

3.  模板类型定义

许多其他小而重要的事情，但它们在生产代码中确实很重要。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-09-26T05:08:09.530

为我传递概念。但初始化列表、lambda 和可变参数模板紧随其后。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-09-26T05:25:33.343

我无法在[Null Pointer Type](http://en.wikipedia.org/wiki/C%2B%2B0x#Null_pointer)、[Tuple Types](http://en.wikipedia.org/wiki/C%2B%2B0x#Tuple_types)或[Regex](http://en.wikipedia.org/wiki/C%2B%2B0x#Regular_expressions)之间做出决定。“Foreach”也在上面。“智能指针”不言而喻...... :-)

基本上，我真的很期待更新。

我个人认为大量使用空指针类型会捕获很多错误。元组非常适合处理关系数据。很多很酷的东西。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-09-29T06:30:55.053

它并不大，但我喜欢真正的**nullptr**的想法。应该是 git-go 中的一个关键字。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-26T05:01:27.830

为我关闭。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2008-09-26T05:01:42.480

自动关键字

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-26T05:18:23.063

**Lambda**和**概念**

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2010-11-16T08:42:26.330

我认为迭代语法很酷......它实际上将`for (auto x : collection)`许多循环头的大小减少了 4 倍或更多（迭代器类型通常......冗长）！

这也意味着你不必在循环体中取消引用迭代器（对于传统的迭代器循环，你总是必须使用`*i`or`i->...`来获取元素的值，但在这里你可以只使用`x`），在某些情况下案例使代码看起来更好。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-09-26T05:03:00.527

unicode、多线程、hash_tables、智能指针和正则表达式。

ps：想知道为什么他们不能进行 gr8 代码审查并接受所有的 boost 和 tr1 库到标准中，让每个人的生活更轻松。然后，他们需要解决的只是就一个可行的可选垃圾收集模型达成一致。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-06-25T10:47:07.543

**嵌套模板声明中的尖括号**。

所以我将能够写

```
std::vector<std::vector<int>> a; 
```

而不是可怕的

```
std::vector<std::vector<int> > a; 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-09-26T16:38:28.550

语法越来越差。

可变参数模板和 lambdas 都很好，但不幸的是，两者的语法都令人反感。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-09-26T20:41:08.217

智能指针。不必显式地管理堆分配的对象，这确实使世界变得与众不同。

显然，您仍然需要“知道自己在做什么”，但根据我的经验，它至少将我使用过的软件中与内存相关的错误数量减少了一个数量级。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-10-26T10:09:20.440

我`constexpr`特别喜欢结合可变参数模板和用户定义的文字，我们最终可以拥有二进制文字和许多其他好东西。

```
obj.bitmask |= 00001010B; 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2010-09-18T05:26:05.383

[**decltype**](http://www2.research.att.com/~bs/C++0xFAQ.html#decltype) :-) 和[**lambdas**](http://www2.research.att.com/~bs/C++0xFAQ.html#lambda)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-05-29T02:12:04.513

正则表达式！！和并行编程库，虽然我还不知道它们的全部功能。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-06-25T10:30:48.727

**原始字符串文字**！我认为类似 python 的字符串块很棒，但我错了！在 C++0x 中，原始字符串文字对于文本格式化非常有用。标记语言可以直接在您的源代码中编写！

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-10-29T12:24:41.317

目前我很喜欢我玩过的 C++0x：

*   空指针
*   静态断言
*   拉姆达斯
*   shared_ptr 和 weak_ptr
*   unique_ptr
*   decltype 和 auto

我没有尝试过`<regexp>`……我认为这是一个伟大的想法……但我什至没有花时间看它。

# .net - Windows PE 2.0 可以支持 .NET 框架吗？

> ID：137817
> 
> 赞同：0
> 
> 时间：2008-09-26T04:46:14.437
> 
> 标签：.net, winpe

我有兴趣为可以从 USB 闪存驱动器启动的汽车制造 PC。我计划使用[Windows PE](http://en.wikipedia.org/wiki/Windows_Preinstallation_Environment) 2.0 和用 C# 或 VB.NET 编写的 GUI。

显然，要使其正常工作，我需要安装[.NET](http://en.wikipedia.org/wiki/.NET_Framework) 2.0 或更高版本。了解默认情况下不包含 .NET，有没有办法将 .NET 2.0 与 Windows PE 2.0 打包以允许我的[GUI](http://en.wikipedia.org/wiki/Graphical_user_interface)应用程序工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T04:47:54.603

> Windows PE 不支持 Microsoft .NET Framework 或公共语言运行时 (CLR)。

资料来源：*[什么是 Windows PE？](http://technet.microsoft.com/en-us/library/cc766093.aspx)*(MSDN)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T05:31:19.320

不确定这是否会对您有所帮助，但这里有一个[.NET 2.0 插件，](http://www.colinfinck.de/en/peplugs/dotnetfx20pe/)它需要“PE Builder 3.x 或 Microsoft Windows PE 2004 或 2005”。

# text - 换行符

> ID：137837
> 
> 赞同：3
> 
> 时间：2008-09-26T04:52:18.073
> 
> 标签：text, encoding, newline

您的软件是否处理来自其他系统的换行符？

```
Linux/BSD    linefeed         ^J    10     x0A
Windows/IBM  return linefeed  ^M^J  13 10  x0D x0A
old Macs     return           ^M    13     x0D
others? 
```

出于精神错乱的原因，我将在我的文本文件中使用 Linux 版本的换行符。但是，当我把我的文本文件带到 Windows 时，有些程序不能很好地处理我的文本中的换行符。你会如何处理这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T04:56:38.450

正如他们所说，对你所写的内容要严格，对你所读的内容要自由。

您的应用程序应该能够正常读取两个行尾。如果您想使用换行符，并可能让 Windows 用户感到不安，那很好。

但是除了记事本之外，我玩过的大多数程序似乎都对这两种方法都很满意。

（我在 Windows 上使用 Cygwin，这让一切变得有趣）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T04:57:47.013

标准 Python 发行版带有两个命令行脚本（在工具/脚本中），称为 crlf.py 和 lfcr.py，可以在 Windows 和 Unix/Linux 行结尾之间进行转换。

[[来源]](http://code.activestate.com/recipes/66434/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T04:59:11.160

在 .NET 中，新行由 表示`Environment.NewLine`，因此该框架的设计方式是在运行时使用系统的新行（CR+LF 或仅 CR 或仅 LF）来使用。当然，这最终在 Mono 中很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T04:54:47.113

我怀疑您会发现大多数现代 Windows 程序（除了记事本之外）都可以很好地处理仅换行符的文件。但是，使用 windows 程序生成的文件仍然倾向于以 crlf 结尾。

大多数情况下，行尾将由运行时库以特定于平台的方式自动处理。例如，打开文件的 C 程序将`fopen(..., "r")`在任何平台上以一致的方式（仅换行）查看行，而不管实际的行结尾如何。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T05:00:39.377

据我所知，只有记事本存在行分隔符问题。世界上几乎所有其他软件都接受这三种类型的分隔符中的任何一种，也可能接受其他类型的分隔符。不幸的是，记事本是当今大多数计算机用户的首选编辑器。我认为微软让这种情况继续下去是极其不负责任的。我从来没有玩过Vista，但我相信问题仍然存在，就像在XP中一样。有人知道下一个版本吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T05:28:19.920

正如其他人所说，如果需要，周围有很多（非常微不足道的）转换器。请注意，如果您在 Ascii 模式下使用 FTP 进行传输，它将自动进行转换...

事实上，记事本是最突出的程序，有 LF 结尾的问题......

我看到的最烦人的是带有混合行结尾的文本文件，基本上是由人们在 Unix 上编辑 Windows 文件完成的，或者是实用程序在不检查正确格式的情况下添加内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-01T19:09:31.683

要开心，只需遵循标准的建议即可。

[http://unicode.org/standard/reports/tr13/tr13-5.html](http://unicode.org/standard/reports/tr13/tr13-5.html)

并为旧 MacOS 等特殊情况提供选项。或者如果您能可靠地检测到它们，则自动处理此案。

我建议以 Unix 风格格式化你的文本。忘记 Windows 用户。因为没有 Windows 用户对文档或数据使用纯文本。如果您传递纯文本，他们会感到不安。他们总是期望 Word 或 Excel 文档。即使他们使用纯文本文件，他们会遇到的唯一问题就是奇怪地显示文本。

但是 Unix 用户会体验到他们的所有工具都无法正常工作。尤其是Unix，要严格遵守标准。

PS。哦，如果您的 Windows 用户是开发人员，只需在 Unix 中格式化文本，并告诉他们这是来自 Unix 的文件。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-26T04:55:24.913

不知道你说“处理”是什么意思，但基本上你可以这样说：

```
string convertLineBreaks(String line, String lineBreakYouWant) {
  replace all ^M^J or ^M or ^J in line with lineBreakYouWant

  return line
} 
```

* * *

**编辑：**我怀疑在重新阅读您的问题后，您的意思是如何处理无法处理不正确（对于目标系统）换行符的其他人的程序。

我建议 1) 使用可以处理的程序或 2) 通过脚本运行文件，该脚本可以找到任何类型的换行符，然后将它们转换为适合您系统的任何类型。

# wcf - 将 WCF 服务从 IIS 移动到 Windows 服务

> ID：137840
> 
> 赞同：3
> 
> 时间：2008-09-26T04:54:29.237
> 
> 标签：wcf, iis, windows-services

我们有一个现有的 WCF 服务，它使用 wsDualHttpBinding 来启用对客户端的回调。我正在考虑将其移至 netTcpBinding 以获得更好的性能，但我对从 IIS 托管服务（我们目前喜欢的“舒适区”）迁移到拥有自己的 Windows 服务来托管它持谨慎态度。我希望我们仍然可以在 IIS 7 上托管它，但 Win2K8 在一段时间内不会成为现实。

在创建我们自己的 Windows 服务来托管我们的 WCF 服务时，我应该注意什么？诸如生命周期管理和请求限制之类的功能是 IIS 托管免费提供的，所以我还想知道我们如何能够有效地自行托管我们的服务，而无需 IIS 为我们完成繁重的工作。谢谢！:)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T05:28:09.483

因此，由于您无法使用 WAS 进行托管，因此需要实现几件事。

*   如果服务崩溃，默认情况下它不会重新启动（尽管您可以在服务属性中更改它）
*   如果应用程序池挂起或变得太大，IIS 将回收应用程序池；如果你想要同样的可靠性，你必须自己做。
*   您必须为要运行的服务创建一个帐户，或使用其中一种默认服务。抵制以 SYSTEM 或管理员帐户运行服务的诱惑；如果您想使用内置帐户，请使用 NETWORK SERVICE。
*   现场调试变得更加困难。
*   考虑使用错误记录器，例如 log4net

话虽如此，我在 9 个月前为客户部署了 WCF/Windows 服务组合；它被大量使用并且没有死过一次。

您可以在 Windows 服务中[请求限制](http://www.iserviceoriented.com/blog/post/Configuring+Performance+Options+-+WCF+Gotcha+3.aspx)，它是 WCF 配置的一部分。请注意，默认值非常低，您可能必须增加这些值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T05:05:23.547

在 Windows 服务应用程序 ( [http://msdn.microsoft.com/en-us/library/ms734781.aspx](http://msdn.microsoft.com/en-us/library/ms734781.aspx) ) 中托管是一个好的开始。

如果您可以在 Vista 上托管您的服务，您还可以从 Windows Process Activation Service (WAS) 中受益。WAS 是 IIS 进程激活的概括，可用于通过非 HTTP 端点（TCP、命名管道、MSMQ）激活进程。要了解有关 WAS 中托管的 WCF 的更多信息，请阅读[http://msdn.microsoft.com/en-us/library/ms733109.aspx](http://msdn.microsoft.com/en-us/library/ms733109.aspx)。要了解如何安装和配置 WAS，请阅读[http://msdn.microsoft.com/en-us/library/ms731053.aspx](http://msdn.microsoft.com/en-us/library/ms731053.aspx)。

# vba - 确定对象是否是 VBA 中集合的成员

> ID：137845
> 
> 赞同：67
> 
> 时间：2008-09-26T04:57:09.887
> 
> 标签：vba, object, ms-access, collections

如何确定一个对象是否是 VBA 中集合的成员？

具体来说，我需要找出表定义是否是`TableDefs`集合的成员。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-06-14T01:10:54.260

还不够好吗？

```
Public Function Contains(col As Collection, key As Variant) As Boolean
Dim obj As Variant
On Error GoTo err
    Contains = True
    obj = col(key)
    Exit Function
err:

    Contains = False
End Function 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-10-20T14:56:34.660

不完全优雅，但我能找到的最好（也是最快）的解决方案是使用 OnError。对于任何大中型集合，这将比迭代快得多。

```
Public Function InCollection(col As Collection, key As String) As Boolean
  Dim var As Variant
  Dim errNumber As Long

  InCollection = False
  Set var = Nothing

  Err.Clear
  On Error Resume Next
    var = col.Item(key)
    errNumber = CLng(Err.Number)
  On Error GoTo 0

  '5 is not in, 0 and 438 represent incollection
  If errNumber = 5 Then ' it is 5 if not in collection
    InCollection = False
  Else
    InCollection = True
  End If

End Function 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-09-26T05:00:26.883

你最好的选择是遍历集合的成员，看看是否有任何匹配你正在寻找的东西。相信我，我不得不这样做很多次。

第二种解决方案（更糟）是捕获“Item not in collection”错误，然后设置一个标志来表示该项目不存在。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2018-01-22T05:41:43.643

这是一个老问题。我仔细查看了所有答案和评论，测试了解决方案的性能。

我为我的环境提出了最快的选项，当集合既有对象又有原语时，它不会失败。

```
Public Function ExistsInCollection(col As Collection, key As Variant) As Boolean
    On Error GoTo err
    ExistsInCollection = True
    IsObject(col.item(key))
    Exit Function
err:
    ExistsInCollection = False
End Function 
```

此外，该解决方案不依赖于硬编码的错误值。所以参数`col As Collection`可以被其他一些集合类型变量替换，并且函数必须仍然有效。例如，在我当前的项目中，我将它作为`col As ListColumns`.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-06-04T15:46:49.503

您可以为此缩短建议的代码，并针对意外错误进行概括。干得好：

```
Public Function InCollection(col As Collection, key As String) As Boolean

  On Error GoTo incol
  col.Item key

incol:
  InCollection = (Err.Number = 0)

End Function 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T17:50:28.237

在您的特定情况下（TableDefs），遍历集合并检查名称是一种好方法。这没关系，因为集合的键（名称）是集合中类的属性。

但在 VBA 集合的一般情况下，键不一定是集合中对象的一部分（例如，您可以将集合用作字典，键与集合中的对象无关）。在这种情况下，您别无选择，只能尝试访问该项目并捕获错误。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-11-23T16:36:51.617

我从上述建议中创建了这个解决方案，并结合了微软用于迭代集合的解决方案。

```
Public Function InCollection(col As Collection, Optional vItem, Optional vKey) As Boolean
On Error Resume Next

Dim vColItem As Variant

InCollection = False

If Not IsMissing(vKey) Then
    col.item vKey

    '5 if not in collection, it is 91 if no collection exists
    If Err.Number <> 5 And Err.Number <> 91 Then
        InCollection = True
    End If
ElseIf Not IsMissing(vItem) Then
    For Each vColItem In col
        If vColItem = vItem Then
            InCollection = True
            GoTo Exit_Proc
        End If
    Next vColItem
End If

Exit_Proc:
Exit Function
Err_Handle:
Resume Exit_Proc
End Function 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-01-03T20:55:23.420

我有一些编辑，最适合收藏：

```
Public Function Contains(col As collection, key As Variant) As Boolean
    Dim obj As Object
    On Error GoTo err
    Contains = True
    Set obj = col.Item(key)
    Exit Function

err:
    Contains = False
End Function
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-02-29T10:34:32.210

如果集合中的项目不是对象，而是数组，则需要进行一些额外的调整。除此之外，它对我来说很好。

```
Public Function CheckExists(vntIndexKey As Variant) As Boolean
    On Error Resume Next
    Dim cObj As Object

    ' just get the object
    Set cObj = mCol(vntIndexKey)

    ' here's the key! Trap the Error Code
    ' when the error code is 5 then the Object is Not Exists
    CheckExists = (Err <> 5)

    ' just to clear the error
    If Err <> 0 Then Call Err.Clear
    Set cObj = Nothing
End Function 
```

[来源：[http ://coderstalk.blogspot.com/2007/09/visual-basic-programming-how-to-check.html](http://coderstalk.blogspot.com/2007/09/visual-basic-programming-how-to-check.html)]

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-02-06T10:03:56.600

此版本适用于原始类型和类（包括简短的测试方法）

```
' TODO: change this to the name of your module
Private Const sMODULE As String = "MVbaUtils"

Public Function ExistsInCollection(oCollection As Collection, sKey As String) As Boolean
    Const scSOURCE As String = "ExistsInCollection"

    Dim lErrNumber As Long
    Dim sErrDescription As String

    lErrNumber = 0
    sErrDescription = "unknown error occurred"
    Err.Clear
    On Error Resume Next
        ' note: just access the item - no need to assign it to a dummy value
        ' and this would not be so easy, because we would need different
        ' code depending on the type of object
        ' e.g.
        '   Dim vItem as Variant
        '   If VarType(oCollection.Item(sKey)) = vbObject Then
        '       Set vItem = oCollection.Item(sKey)
        '   Else
        '       vItem = oCollection.Item(sKey)
        '   End If
        oCollection.Item sKey
        lErrNumber = CLng(Err.Number)
        sErrDescription = Err.Description
    On Error GoTo 0

    If lErrNumber = 5 Then ' 5 = not in collection
        ExistsInCollection = False
    ElseIf (lErrNumber = 0) Then
        ExistsInCollection = True
    Else
        ' Re-raise error
        Err.Raise lErrNumber, mscMODULE & ":" & scSOURCE, sErrDescription
    End If
End Function

Private Sub Test_ExistsInCollection()
    Dim asTest As New Collection

    Debug.Assert Not ExistsInCollection(asTest, "")
    Debug.Assert Not ExistsInCollection(asTest, "xx")

    asTest.Add "item1", "key1"
    asTest.Add "item2", "key2"
    asTest.Add New Collection, "key3"
    asTest.Add Nothing, "key4"
    Debug.Assert ExistsInCollection(asTest, "key1")
    Debug.Assert ExistsInCollection(asTest, "key2")
    Debug.Assert ExistsInCollection(asTest, "key3")
    Debug.Assert ExistsInCollection(asTest, "key4")
    Debug.Assert Not ExistsInCollection(asTest, "abcx")

    Debug.Print "ExistsInCollection is okay"
End Sub 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-09-13T07:51:52.330

对于未使用密钥进行收集的情况：

```
Public Function Contains(col As Collection, thisItem As Variant) As   Boolean

  Dim item As Variant

  Contains = False
  For Each item In col
    If item = thisItem Then
      Contains = True
      Exit Function
    End If
  Next
End Function 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-02-09T10:25:58.283

不是我的代码，但我认为它写得很好。它允许通过键和 Object 元素本身进行检查，并处理 On Error 方法和遍历所有 Collection 元素。

[https://danwagner.co/how-to-check-if-a-collection-contains-an-object/](https://danwagner.co/how-to-check-if-a-collection-contains-an-object/)

我不会复制完整的解释，因为它在链接页面上可用。复制解决方案本身以防页面最终在将来变得不可用。

我对代码的怀疑是 GoTo 在第一个 If 块中的过度使用，但这对任何人来说都很容易解决，所以我将原始代码保留原样。

```
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'INPUT       : Kollection, the collection we would like to examine
'            : (Optional) Key, the Key we want to find in the collection
'            : (Optional) Item, the Item we want to find in the collection
'OUTPUT      : True if Key or Item is found, False if not
'SPECIAL CASE: If both Key and Item are missing, return False
Option Explicit
Public Function CollectionContains(Kollection As Collection, Optional Key As Variant, Optional Item As Variant) As Boolean
    Dim strKey As String
    Dim var As Variant

    'First, investigate assuming a Key was provided
    If Not IsMissing(Key) Then

        strKey = CStr(Key)

        'Handling errors is the strategy here
        On Error Resume Next
            CollectionContains = True
            var = Kollection(strKey) '<~ this is where our (potential) error will occur
            If Err.Number = 91 Then GoTo CheckForObject
            If Err.Number = 5 Then GoTo NotFound
        On Error GoTo 0
        Exit Function

CheckForObject:
        If IsObject(Kollection(strKey)) Then
            CollectionContains = True
            On Error GoTo 0
            Exit Function
        End If

NotFound:
        CollectionContains = False
        On Error GoTo 0
        Exit Function

    'If the Item was provided but the Key was not, then...
    ElseIf Not IsMissing(Item) Then

        CollectionContains = False '<~ assume that we will not find the item

        'We have to loop through the collection and check each item against the passed-in Item
        For Each var In Kollection
            If var = Item Then
                CollectionContains = True
                Exit Function
            End If
        Next var

    'Otherwise, no Key OR Item was provided, so we default to False
    Else
        CollectionContains = False
    End If

End Function 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-06-09T11:09:19.360

我使用此代码将数组转换为集合并返回数组以删除重复项，这些重复项是从此处的各种帖子中组装而成的（对不起，没有给予适当的信任）。

```
Function ArrayRemoveDups(MyArray As Variant) As Variant
Dim nFirst As Long, nLast As Long, i As Long
Dim item As Variant, outputArray() As Variant
Dim Coll As New Collection

'Get First and Last Array Positions
nFirst = LBound(MyArray)
nLast = UBound(MyArray)
ReDim arrTemp(nFirst To nLast)
i = nFirst
'convert to collection
For Each item In MyArray
    skipitem = False
    For Each key In Coll
        If key = item Then skipitem = True
    Next
    If skipitem = False Then Coll.Add (item)
Next item
'convert back to array
ReDim outputArray(0 To Coll.Count - 1)
For i = 1 To Coll.Count
    outputArray(i - 1) = Coll.item(i)
Next
ArrayRemoveDups = outputArray
End Function 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2015-07-16T14:52:31.063

我这样做了，Vadims 代码的一个变体，但对我来说更具可读性：

```
' Returns TRUE if item is already contained in collection, otherwise FALSE

Public Function Contains(col As Collection, item As String) As Boolean

    Dim i As Integer

    For i = 1 To col.Count

    If col.item(i) = item Then
        Contains = True
        Exit Function
    End If

    Next i

    Contains = False

End Function 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2015-08-05T14:09:10.893

我写了这段代码。我想它可以帮助某人...

```
Public Function VerifyCollection()
    For i = 1 To 10 Step 1
       MyKey = "A"
       On Error GoTo KillError:
       Dispersao.Add 1, MyKey
       GoTo KeepInForLoop
KillError: 'If My collection already has the key A Then...
        count = Dispersao(MyKey)
        Dispersao.Remove (MyKey)
        Dispersao.Add count + 1, MyKey 'Increase the amount in relationship with my Key
        count = Dispersao(MyKey) 'count = new amount
        On Error GoTo -1
KeepInForLoop:
    Next
End Function 
```

# ruby - 运行 Apache 而不显式声明监听端口，例如 :3000 或 :6600

> ID：137849
> 
> 赞同：0
> 
> 时间：2008-09-26T04:59:13.610
> 
> 标签：ruby, apache2

将 Ruby 和 Thin 用作 Web 服务。Apache 也已加载。无法访问 Web 服务，因为不允许在 GET url 中列出端口，例如`:3000`或。`:6600`如何删除端口要求？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T05:23:36.950

使用 Apache ProxyPass。

cd /etc/apache2/sites-enabled/ sudo vi 000-default

编辑行： ServerAdmin webmaster@localhost ProxyPass /breakfast [http://localhost:4567/breakfast](http://localhost:4567/breakfast) DocumentRoot /var/www

须藤 /etc/init.d/apache2 重启

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T05:27:35.617

如果您正在谈论 Apache HTTPD，请不要使用该端口，或者为该端口指定“80”。

如果您在谈论 Apache Tomcat，您需要设置一个端口 = 80 的 HTTP 连接器，但 Tomcat 需要以 root 身份启动。

# java - 在 Java 中适用时使用“final”修饰符

> ID：137868
> 
> 赞同：206
> 
> 时间：2008-09-26T05:05:59.070
> 
> 标签：java, oop

在 Java 中，有一种做法是声明每个变量（本地或类），如果它们确实是参数 final。

虽然这使代码更加冗长，但这有助于轻松阅读/掌握代码，并且还可以防止错误，因为意图被清楚地标记。

你对此有什么想法，你遵循什么？

* * *

## 回答 #1

> 赞同：197
> 
> 时间：2008-09-26T11:59:35.647

沉迷于：

*   最终字段 - 将字段标记为最终字段会强制它们在构造结束时设置，从而使该字段引用不可变。这允许安全地发布字段，并且可以避免在以后读取时需要同步。（请注意，对于对象引用，只有字段引用是不可变的 - 对象引用所引用的内容仍然可以更改并且影响不可变性。）
*   最终静态字段 - 虽然我现在在许多我曾经使用静态最终字段的情况下使用枚举。

考虑但明智地使用：

*   最终类 - 框架/API 设计是我考虑的唯一情况。
*   最终方法 - 与最终类基本相同。如果您正在使用模板方法模式（例如疯狂并将内容标记为 final），那么您可能过于依赖继承而没有足够的委托。

除非感觉肛门，否则忽略：

*   方法参数和局部变量——我很少这样做，主要是因为我很懒，而且我发现它会使代码混乱。我完全承认我不会修改的标记参数和局部变量是“更正确的”。我希望它是默认值。但事实并非如此，而且我发现随着决赛的结束，代码更难理解。如果我在别人的代码中，我不会把它们拉出来，但如果我正在编写新代码，我不会把它们放进去。一个例外是你必须标记一些最终的东西以便你可以访问它来自匿名内部类。

* * *

## 回答 #2

> 赞同：196
> 
> 时间：2008-09-26T05:45:57.833

我认为这一切都与良好的编码风格有关。当然，您可以编写好的、健壮的程序，而无需在`final`任何地方使用大量修饰符，但是当您考虑它时...

添加`final`所有*不应*更改的内容只会缩小您（或下一个程序员，正在处理您的代码）误解或滥用导致您的代码的思维过程的可能性。至少当他们现在想要改变你以前不可变的东西时，它应该响起一些钟声。

起初，`final`在你的代码中看到很多关键字看起来有点尴尬，但很快你就会不再注意到这个词本身，而只会认为，*那件事永远不会改变——从这一点开始——开*（你可以从我这里拿走；-）

我认为这是一个很好的做法。我并不是一直都在使用它，但是当我可以并且标记某件事是有意义的时候，`final`我会这样做。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2008-09-26T05:18:13.173

在使用它之前，您确实需要了解 final 关键字的完整用法。它可以应用于变量、字段、方法和类，并对变量、字段、方法和类产生不同的影响

我建议查看下面链接的文章以获取更多详细信息。

[最后一个词在最后一个关键字上](http://archive.today/ZIwdk)

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2008-09-26T07:25:39.920

修饰符，尤其是对于`final`变量，是一种让编译器强制执行通常合理的约定的方法：确保（局部或实例）变量只分配一次（不多不少）。通过确保在使用变量之前明确分配它，您可以避免 a 的常见情况`NullPointerException`：

```
final FileInputStream in;
if(test)
  in = new FileInputStream("foo.txt");
else
  System.out.println("test failed");
in.read(); // Compiler error because variable 'in' might be unassigned 
```

通过防止一个变量被多次分配，您可以阻止过于宽泛的范围。而不是这个：

```
 String msg = null;
 for(int i = 0; i < 10; i++) {
     msg = "We are at position " + i;
     System.out.println(msg);
 }
 msg = null; 
```

鼓励你使用这个：

```
 for(int i = 0; i < 10; i++) {
     final String msg = "We are at position " + i;
     System.out.println(msg);
 } 
```

一些链接：

*   [最后的故事](http://oreilly.com/catalog/hardcorejv/chapter/ch02.pdf)（《Hardcore Java》一书的免费章节）
*   [一些最终模式](http://enfranchisedmind.com/blog/2007/12/16/some-final-patterns/)
*   [确定的任务](http://java.sun.com/docs/books/jls/third_edition/html/defAssign.html)

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2008-09-28T02:05:25.840

我非常教条地声明每个可能的变量`final`。这包括方法参数、局部变量和很少见的值对象字段。我有三个主要原因在各处声明最终变量：

1.  声明意图：通过声明一个最终变量，我声明这个变量只能被写入一次。这对其他开发人员来说是一个微妙的提示，对编译器来说是一个很大的提示。
2.  强制使用一次性变量：我相信每个变量在生活中应该只有一个目的。通过只给每个变量一个目的，您可以减少在调试时了解该特定变量的目的所需的时间。
3.  允许优化：我知道编译器曾经有性能增强技巧，这些技巧专门依赖于变量引用的不变性。我喜欢认为编译器将使用其中一些旧的性能技巧（或新的技巧）。

但是，我确实认为 final 类和方法不如 final 变量引用有用。关键字与这些声明一起使用`final`时，只会为自动化测试和以您从未预料到的方式使用代码提供障碍。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2008-09-26T05:31:56.667

有效的 Java 有一个项目，上面写着“支持不可变对象”。将字段声明为 final 可以帮助您朝着这一目标迈出一小步，但真正不可变的对象当然远不止这些。

如果您知道对象是不可变的，则可以在许多线程/客户端之间共享它们以供读取，而无需担心同步问题，并且更容易推断程序的运行方式。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-09-26T05:09:40.307

我从来没有遇到过在变量上使用 final 关键字阻止我犯错误的情况，所以目前我认为这是在浪费时间。

除非有真正的理由这样做（比如你想明确指出该变量是最终的），否则我宁愿不这样做，因为我发现它会使代码的可读性降低。

但是，如果您没有发现它使代码更难阅读或编写更长的时间，那么请务必使用它。

**编辑：**作为澄清（并试图赢得投票），我并不是说不要将常量标记为最终的，我是说不要做类似的事情：

```
public String doSomething() {
  final String first = someReallyComplicatedExpressionToGetTheString();
  final String second = anotherReallyComplicatedExpressionToGetAnother();

  return first+second;
} 
```

它只是使代码（在我看来）更难阅读。

还值得记住的是，**所有**final 所做的只是阻止您重新分配变量，它不会使其成为不可变的或类似的东西。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-26T21:34:07.000

Final 应始终用于常量。当定义变量的规则很复杂时，它甚至对短期变量（在单个方法中）很有用。

例如：

```
final int foo;
if (a)
    foo = 1;
else if (b)
    foo = 2;
else if (c)
    foo = 3;
if (d)        // Compile error:  forgot the 'else'
    foo = 4;
else
    foo = -1; 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-01-06T06:36:36.537

听起来*反对*使用 final 关键字的最大论据之一是“它是不必要的”，它“浪费空间”。

如果我们承认“final”的许多好处，正如这里许多伟大的帖子所指出的那样，同时承认它需要更多的打字和空间，我认为Java应该默认将变量设置为“final”，并要求将事物标记为“可变的”，如果编码人员想要的话。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-26T09:20:05.213

我一直使用`final`对象属性。

`final`关键字在对象属性上使用时具有可见性语义。基本上，设置最终对象属性的值发生在构造函数返回之前。这意味着，只要您不让`this`引用转义构造函数并且将其`final`用于*所有*属性，就可以（在 Java 5 语义下）保证正确构造对象，并且由于它也是不可变的，因此可以安全地发布到其他线程。

不可变对象不仅仅是线程安全。它们还使推理程序中的状态转换变得更加容易，因为*可以*更改的空间是故意的，如果始终如一地使用，则完全仅限于*应该*更改的内容。

我有时也会使方法最终化，但不那么频繁。我很少将课程定为最终课程。我通常这样做是因为我几乎不需要这样做。我一般不怎么使用继承。我更喜欢使用接口和对象组合来代替——这也适用于我发现通常更容易测试的设计。当您对接口而不是具体类进行编码时，您*不需要*在测试时使用继承，因为使用 jMock 等框架，使用接口创建模拟对象比使用具体类容易得多。

我想我应该让我的大部分课程最终完成，但我还没有养成这个习惯。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-26T10:59:34.897

我必须为我的工作阅读大量代码。缺少实例变量的 final 是最让我烦恼的事情之一，并且使理解代码变得不必要地困难。对我来说，局部变量的 final 会导致混乱而不是清晰。该语言应该被设计为默认设置，但我们必须忍受这个错误。有时它对循环和使用 if-else 树的明确赋值特别有用，但大多数情况下它往往表明您的方法过于复杂。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-26T15:16:14.943

**final**显然应该用于常量，并强制执行不变性，但方法还有另一个重要用途。

*Effective Java*对此有一个完整的条目（条目 15），指出了无意继承的缺陷。实际上，如果您没有为继承设计和记录您的类，那么从它继承可能会带来意想不到的问题（该项目提供了一个很好的例子）。因此，建议您在不打算继承的任何类和/或方法上使用**final 。**

这可能看起来很严厉，但它是有道理的。如果您正在编写一个供其他人使用的类库，那么您不希望他们继承不是为它设计的东西 - 您将自己锁定在该类的特定实现中以实现向后兼容性。如果你在一个团队中编码，那么没有什么可以阻止团队中的其他成员在必要时移除**final**。但是关键字让他们思考他们在做什么，并警告他们继承的类不是为它设计的，所以他们应该格外小心。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-27T22:09:44.283

另一个需要注意的是，许多人将 final 混淆为实例变量的内容不能改变，而不是引用不能改变。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-03T23:33:23.420

即使对于局部变量，知道它被声明为 final 意味着我不需要担心稍后会更改引用。这意味着在调试时，我稍后会看到该变量，我确信它指的是同一个对象。这是我在寻找错误时需要担心的一件事。一个好处是，如果 99% 的变量被声明为 final，那么少数真正是变量的变量会更好。此外，final 让编译器可以发现一些更可能被忽视的愚蠢错误。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-08-31T00:35:05.803

选择`final`在每种方法中为每个参数键入都会对编码人员和代码阅读者产生极大的刺激。

一旦恼怒超出了合理的范围，就切换到 Scala，默认情况下参数是最终的。

或者，您始终可以使用会自动为您执行此操作的代码样式工具。所有 IDE 都将它们实现或作为插件。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-26T05:51:44.870

在 Java 中与变量一起使用时，Final 提供了 C++ 中常量的替代品。因此，当 final 和 static 用于变量时，它变得不可变。同时让迁移的 C++ 程序员非常高兴 ;-)

当与引用变量一起使用时，它不允许您重新引用对象，尽管可以操作对象。

当 final 与方法一起使用时，它不允许该方法被子类覆盖。

一旦用法非常清楚，就应该小心使用。它主要取决于设计，因为在方法上使用 final 无助于多态性。

只有当您确定变量的值将/不应该被更改时，才应该将其用于变量。还要确保遵循 SUN.for 鼓励的编码约定，例如：final int COLOR_RED = 1; （大写，下划线分隔）

使用引用变量，仅当我们需要对特定对象的不可变引用时才使用它。

关于可读性部分，请确保注释在使用 final 修饰符时起着非常重要的作用。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-26T14:38:34.580

我从不在局部变量上使用它们，增加冗长没有意义。即使您认为不应该重新分配变量，这对于下一个更改该代码的人来说几乎没有什么不同，并且由于代码正在更改，因此使其成为最终的任何原始目的都可能不再有效。如果只是为了清楚起见，我相信它会因为冗长的负面影响而失败。

几乎同样的情况也适用于成员变量，因为它们几乎没有什么好处，除了常量的情况。

它也与不可变性无关，因为不可变事物的最佳指标是它被记录为这样和/或没有可以改变对象的方法（这以及使类最终是保证的唯一方法它是不可变的）。

但是，嘿，这只是我的意见:-)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-26T15:13:18.240

我设置 Eclipse 以在所有未修改的字段和属性上添加 final。使用 Eclipse 的“保存操作”非常有用，它在保存文件时添加了这些最终修饰符（除其他外）。

强烈推荐。

查看我关于 Eclipse 保存操作的[博文。](http://blog.zvikico.com/problog/2007/08/eclipse-europa-.html)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-05T14:29:01.800

对于论点，我认为不需要它们。Mostley 他们只是损害了可读性。重新分配参数变量非常愚蠢，以至于我应该非常确信它们无论如何都可以被视为常量。

Eclipse 将最终的红色着色的事实使得在代码中发现变量声明更容易，我认为这在大多数情况下提高了可读性。

我试图强制执行任何和所有变量都应该是最终的规则，因为没有极端的正当理由不这样做。回答“这个变量是什么？”要容易得多。质疑您是否只需要找到初始化并确信就是这样。

实际上，我现在对非最终变量感到相当紧张。这就像把刀挂在头上的线里，或者只是把它放在厨房抽屉里……

final 变量只是标记值的好方法。

非最终变量绑定到某些容易出错的算法的一部分。

一个不错的功能是，当大多数情况下无法为算法使用变量时，解决方案是改为编写方法，这通常会显着改善代码。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-06-10T19:29:58.087

我已经编码了一段时间，并尽可能使用 final 。这样做一段时间后（对于变量、方法参数和类属性），我可以说我的变量中有 90%（或更多）实际上是最终的。我认为当你不想修改变量时不修改变量的好处（我以前看到过，有时会很痛苦）为代码中的额外输入和额外的“final”关键字付出了代价。

话虽如此，如果我要设计一种语言，除非被其他关键字修改，否则我会将每个变量设为最终变量。

我不经常使用 final 作为类和方法，我想。这是一个或多或少复杂的设计选择，除非您的类是实用程序类（在这种情况下，您应该只有一个私有构造函数）。

我还使用 Collections.unmodifiable... 在需要时创建不可修改的列表。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-26T05:21:33.993

我很少在方法或类上使用 final，因为我喜欢允许人们覆盖它们。

否则，我只使用 finally 如果它是`public/private static final type SOME_CONSTANT;`

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-26T05:53:39.313

使用匿名本地类作为事件监听器等是 Java 中的常见模式。final 关键字最常见的用途是确保偶数侦听器可以访问范围内的变量。

但是，如果您发现自己需要在代码中添加大量最终语句。这可能是一个很好的暗示，你做错了什么。

上面发布的文章给出了这个例子：

```
public void doSomething(int i, int j) {
    final int n = i + j; // must be declared final

    Comparator comp = new Comparator() {
        public int compare(Object left, Object right) {
            return n; // return copy of a local variable
        }
    };
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-26T06:02:44.160

我将它用于方法内部和外部的常量。

我有时只将它用于方法，因为我不知道子类是否不想覆盖给定的方法（无论出于何种原因）。

至于类，仅对于某些基础设施类，我使用了最终类。

如果函数参数被写入函数内部，IntelliJ IDEA 会发出警告。所以，我已经停止使用 final 作为函数参数。我也没有在 java Runtime 库中看到它们。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-26T22:48:33.827

将类标记为 final 还可以使某些方法绑定发生在编译时而不是运行时。考虑下面的“v2.foo()”——编译器知道 B 不能有子类，所以 foo() 不能被覆盖，所以要调用的实现在编译时是已知的。如果 B 类没有标记为 final，那么 v2 的实际类型可能是某个扩展 B 并覆盖 foo() 的类。

```
class A {
    void foo() {
        //do something
    }
}
final class B extends A {
    void foo() {
    }
}
class Test {
    public void t(A v1, B v2) {
        v1.foo();
        v2.foo();
    }
} 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2008-09-26T06:54:40.540

强烈建议使用 final**作为常量。**但是，我不会将它用于方法或类（或者至少考虑一下），因为它使**测试**变得更加困难，如果不是不可能的话。如果您绝对必须使一个类或方法成为最终的，请确保该类实现了某个接口，这样您就可以拥有一个实现相同接口的**模拟。**

# installation - 如何使用 InstallShield 更改目录安全属性？

> ID：137870
> 
> 赞同：2
> 
> 时间：2008-09-26T05:07:21.297
> 
> 标签：installation, installshield

我想更改 InstallShield 在下面创建的目录的安全属性`CSIDL_COMMON_APPDATA`- 有人可以建议在安装过程中如何做到这一点吗？

这是一个脚本定义的文件夹。

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T00:47:32.133

在 InstallShield 2008 下它是

```
Installation Designer > Components > [somecomponent] > Destination Permissions 
```

请注意，目录属性附加到组件，而单个文件权限在“文件”节点下设置

这假设您让 InstallShield / Windows Installer 处理目录创建。如果您在脚本中创建目录，那么如果您需要确保完全卸载，事情就会变得棘手。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T04:04:21.147

我想我找到了答案 - 在这个页面上：http: [//www.installsite.org/pages/en/isp_os.htm](http://www.installsite.org/pages/en/isp_os.htm)有一个 ntperm.zip 存档，其中包含一个似乎可以满足我需要的脚本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T05:27:02.670

我不知道是否存在 Installshield 内置函数。简单的解决方案是创建一个 DLL，该 DLL 执行操作安全属性的实际工作，并在创建目录后调用它。

通常，人们可能想要更改访问权限，以便每个人都能够读取/写入其中的整个目录或文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T11:06:54.580

您也可以轻松调用 Windows 命令“CACLS.EXE”或“ICACLS.EXE” - 两者都是简单的命令行工具，例如

icacls file /grant Administrator:(D,WDAC) - 将授予用户管理员对文件的删除和写入 DAC 权限

# javascript - JQuery.Validate 插件可以阻止提交 Ajax 表单吗

> ID：137872
> 
> 赞同：16
> 
> 时间：2008-09-26T05:07:38.097
> 
> 标签：javascript, jquery, ajax, validation

我正在使用 JQuery 表单插件 ( [http://malsup.com/jquery/form/](http://malsup.com/jquery/form/) ) 来处理表单的 ajax 提交。我还插入了 JQuery.Validate ( [http://docs.jquery.com/Plugins/Validation](http://docs.jquery.com/Plugins/Validation) ) 以进行客户端验证。

我所看到的是，当我期望验证失败时，它不会阻止表单提交。当我使用传统表单（即非ajax）时，验证失败完全阻止了表单提交......这是我想要的行为。

我知道验证已正确连接，因为在 ajax 提交发生后仍会出现验证消息。

那么我错过了什么阻止了我想要的行为？下面的示例代码......

```
<form id="searchForm" method="post" action="/User/GetDetails">
        <input id="username" name="username" type="text" value="user.name" />  
        <input id="submit" name="submit" type="submit" value="Search" />   
</form>
<div id="detailsView">
</div>  

<script type="text/javascript">
    var options = {
        target: '#detailsView'
    };
    $('#searchForm').ajaxForm(options);

    $('#searchForm').validate({
    rules: {
    username: {required:true}},
    messages: {
    username: {required:"Username is a required field."}}
    });
</script> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-10T02:51:17.710

在初始化 ajaxForm() 时，您需要添加一个回调函数以与 beforeSubmit 事件一起使用：

```
var options = {
        beforeSubmit: function() {
            return $('#searchForm').validate().form();
        },
        target: '#detailsView'
    }; 
```

现在它知道在提交页面之前检查验证结果。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-15T07:05:46.633

...好吧，已经有一段时间了，所以我的情况发生了一些变化。目前我有一个 submitHandler 选项传递给 Validate() 插件。在那个处理程序中，我手动使用 ajaxSubmit。比我猜的答案更多的解决方法。希望有帮助。

[http://jquery.bassistance.de/validate/demo/ajaxSubmit-intergration-demo.html](http://jquery.bassistance.de/validate/demo/ajaxSubmit-intergration-demo.html)

```
var v = jQuery("#form").validate({
    submitHandler: function(form) {
        jQuery(form).ajaxSubmit({target: "#result"});
    }
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-01T13:25:13.870

```
$('#contactform').ajaxForm({
  success : FormSendResponse, 
  beforeSubmit:  function(){
    return $("#contactform").valid();
  }
});

$("#contactform").validate(); 
```

上面的代码对我来说很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T05:14:28.267

就像第一次通过，我想知道为什么这条线

```
$("form").validate({ 
```

没有引用 $("searchform")。我没有查过这个，也没有试过，但这似乎是不匹配的。您不想在适当的表单上调用 validate 吗？

无论如何，如果这是完全错误的，那么错误不会立即明显。:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-16T01:25:48.420

还要确保所有输入字段都具有“名称”属性和“id”属性。我注意到如果没有这些，jquery 验证插件就无法正常工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-15T17:42:25.597

好的，这是一个老问题，但我会将我们的解决方案放在这里以供后代使用。我个人将此归类为 hack-trocity，但至少它不是 hack-tacu-manjaro

```
<script type="text/javascript">
    var options = {
        target: '#detailsView'
    };

// -- "solution" --
$('#searchForm').submit(function(event) {
  this.preventDefault(event); // our env actually monkey patches preventDefault
                              // impl your own prevent default here
                              // basically the idea is to bind a prevent default
                              // stopper on the form's submit event
});
// -- end --

    $('#searchForm').ajaxForm(options);

    $('#searchForm').validate({
      rules: {
      username: {required:true}},
      messages: {
      username: {required:"Username is a required field."}}
    });
</script> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T12:58:54.350

可能是return false；对表格有帮助吗？：） 我是说：

```
<form id="searchForm" method="post" action="/User/GetDetails" onSubmit="return false;"> 
```

# c# - 如何从 C# 应用程序自动化 Firefox？

> ID：137880
> 
> 赞同：10
> 
> 时间：2008-09-26T05:13:37.083
> 
> 标签：c#, firefox, automation

从最简单的任务开始，即从 C# 应用程序捕获 Firefox 中的 URL。使用 user32.dll Windows API 函数似乎无法像在 IE 中捕获 URL 的方法一样工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T06:35:45.170

[WatiN](http://watin.sourceforge.net/)支持 Firefox。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T05:20:57.927

如果我需要使用 AutoHotkey 捕获 URL，例如，我会发送 Ctrl+L（将焦点放在地址栏中并突出显示内容）和 Ctrl+C（将选择复制到剪贴板）。然后，您只需阅读剪贴板即可获取信息。

对于更复杂的任务，我会使用 Greasemonkey 或 iMacros 扩展，可能由类似的键盘快捷键触发。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T05:15:36.207

[WebAii](http://www.artoftest.com/webaiifxproduct.aspx)可以自动化 FireFox，包括设置和检索 URL

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T09:24:19.010

尝试 Selenium（Google 测试引擎 - [http://seleniumhq.org/](http://seleniumhq.org/)）您可以记录在 Firefox 中完成的任务（与网页 UI 相关）并将记录转换为 C# 源:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T05:28:15.363

它似乎非常 beta-ey，但有人为[mozrepl构建了一个](http://hyperstruct.net/projects/mozlab)[.net 连接器](http://www.codeplex.com/mozReplConnector/Release/ProjectReleases.aspx?ReleaseId=17398)。实际上，mozrepl 代码库刚刚移至[github](http://github.com/bard/mozrepl/wikis)。但是 mozrepl 允许您向 Firefox 的 XUL 环境发出命令。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-01-28T23:34:35.700

您可以将 Selenium WebDriver 用于 C#。

这是一个跨平台 API，允许您使用 Java、C# 等 API 控制各种浏览器。

附上一段 C# 用 Selenium WebDriver 测试的代码。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using OpenQA.Selenium.Firefox;
using OpenQA.Selenium;
using OpenQA.Selenium.Interactions;
using OpenQA.Selenium.Interactions.Internal;
using OpenQA.Selenium.Support.UI;
using OpenQA.Selenium.IE;
using NUnit.Framework;
using System.Text.RegularExpressions;

namespace sae_test
{   class Program
    {   private static string baseURL;
        private static StringBuilder verificationErrors;

    static void Main(string[] args)
    {   // test with firefox
        IWebDriver driver = new OpenQA.Selenium.Firefox.FirefoxDriver();
        // test with IE
        //InternetExplorerOptions options = new InternetExplorerOptions();
        //options.IntroduceInstabilityByIgnoringProtectedModeSettings = true;
        //IWebDriver driver = new OpenQA.Selenium.IE.InternetExplorerDriver(options);
        SetupTest();
        driver.Navigate().GoToUrl(baseURL + "Account/Login.aspx");
        IWebElement inputTextUser = driver.FindElement(By.Id("MainContent_LoginUser_UserName"));
        inputTextUser.Clear();
        driver.FindElement(By.Id("MainContent_LoginUser_UserName")).Clear();
        driver.FindElement(By.Id("MainContent_LoginUser_UserName")).SendKeys("usuario");
        driver.FindElement(By.Id("MainContent_LoginUser_Password")).Clear();
        driver.FindElement(By.Id("MainContent_LoginUser_Password")).SendKeys("123");
        driver.FindElement(By.Id("MainContent_LoginUser_LoginButton")).Click();
        driver.Navigate().GoToUrl(baseURL + "finanzas/consulta.aspx");
        // view combo element
        IWebElement comboBoxSistema = driver.FindElement(By.Id("MainContent_rcbSistema_Arrow"));
        //Then click when menu option is visible 
        comboBoxSistema.Click();
        System.Threading.Thread.Sleep(500);
        // container of elements systems combo
        IWebElement listaDesplegableComboSistemas = driver.FindElement(By.Id("MainContent_rcbSistema_DropDown"));
        listaDesplegableComboSistemas.FindElement(By.XPath("//li[text()='BOMBEO MECANICO']")).Click();
        System.Threading.Thread.Sleep(500);
        IWebElement comboBoxEquipo = driver.FindElement(By.Id("MainContent_rcbEquipo_Arrow"));
        //Then click when menu option is visible 
        comboBoxEquipo.Click();
        System.Threading.Thread.Sleep(500);
        // container of elements equipment combo
        IWebElement listaDesplegableComboEquipos = driver.FindElement(By.Id("MainContent_rcbEquipo_DropDown"));

        listaDesplegableComboEquipos.FindElement(By.XPath("//li[text()='MINI-V']")).Click();
        System.Threading.Thread.Sleep(500);

        driver.FindElement(By.Id("MainContent_Button1")).Click();            
        try
        {   Assert.AreEqual("BOMBEO MECANICO_22", driver.FindElement(By.XPath("//*[@id=\"MainContent_RejillaRegistroFinanciero_ctl00_ctl04_LabelSistema\"]")).Text);
        }
        catch (AssertionException e)
        {   verificationErrors.Append(e.Message);
        }
        // verify coin format $1,234,567.89 usd
        try
        {   Assert.IsTrue(Regex.IsMatch(driver.FindElement(By.XPath("//*[@id=\"MainContent_RejillaRegistroFinanciero_ctl00_ctl04_labelInversionInicial\"]")).Text, "\\$((,)*[0-9]*[0-9]*[0-9]+)+(\\.[0-9]{2})? usd"));
        }
        catch (AssertionException e)
        {   verificationErrors.Append(e.Message);
        }
        try
        {   Assert.IsTrue(Regex.IsMatch(driver.FindElement(By.XPath("//*[@id=\"MainContent_RejillaRegistroFinanciero_ctl00_ctl04_labelCostoOpMantto\"]")).Text, "\\$((,)*[0-9]*[0-9]*[0-9]+)+(\\.[0-9]{2})? usd"));
        }
        catch (AssertionException e)
        {   verificationErrors.Append(e.Message);
        }
        try
        {   Assert.IsTrue(Regex.IsMatch(driver.FindElement(By.XPath("//*[@id=\"MainContent_RejillaRegistroFinanciero_ctl00_ctl04_labelCostoEnergia\"]")).Text, "\\$((,)*[0-9]*[0-9]*[0-9]+)+(\\.[0-9]{2})? usd"));
        }
        catch (AssertionException e)
        {   verificationErrors.Append(e.Message);
        }
        try
        {   Assert.IsTrue(Regex.IsMatch(driver.FindElement(By.XPath("//*[@id=\"MainContent_RejillaRegistroFinanciero_ctl00_ctl04_labelcostoUnitarioEnergia\"]")).Text, "\\$((,)*[0-9]*[0-9]*[0-9]+)+(\\.[0-9]{2})? usd"));
        }
        catch (AssertionException e)
        {   verificationErrors.Append(e.Message);
        }
        // verify number format 1,234,567.89
        try
        {   Assert.IsTrue(Regex.IsMatch(driver.FindElement(By.XPath("//*[@id=\"MainContent_RejillaRegistroFinanciero_ctl00_ctl04_labelConsumo\"]")).Text, "((,)*[0-9]*[0-9]*[0-9]+)+(\\.[0-9]{2})?"));
        }
        catch (AssertionException e)
        {   verificationErrors.Append(e.Message);
        }
        System.Console.WriteLine("errores: " + verificationErrors);
        System.Threading.Thread.Sleep(20000);
        driver.Quit();
    }

    public static void SetupTest()
    {   baseURL = "http://127.0.0.1:8081/ver.rel.1.2/";
        verificationErrors = new StringBuilder();
    }

    protected static void mouseOver(IWebDriver driver, IWebElement element)
    {   Actions builder = new Actions(driver);
        builder.MoveToElement(element);
        builder.Perform();
    }

    public static void highlightElement(IWebDriver driver, IWebElement element)
    {   for (int i = 0; i < 2; i++)
        {   IJavaScriptExecutor js = (IJavaScriptExecutor)driver;
            js.ExecuteScript("arguments[0].setAttribute('style', arguments[1]);",
                    element, "color: yellow; border: 2px solid yellow;");
            js.ExecuteScript("arguments[0].setAttribute('style', arguments[1]);",
                    element, "");
        }
    }
}
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T05:23:22.333

我遇到的一个 Microsoft 工具：

UI 自动化，作为 .NET 3.5 的一部分 [http://msdn.microsoft.com/en-us/library/aa348551.aspx](http://msdn.microsoft.com/en-us/library/aa348551.aspx)

这是一个示例：http: [//msdn.microsoft.com/en-us/library/ms771286.aspx](http://msdn.microsoft.com/en-us/library/ms771286.aspx)

我的电脑上没有 UI Spy 来询问 Firefox，所以我不知道这是否有助于解决您的 user32.dll 问题。

# c# - C# Mono - 低级键盘钩子

> ID：137893
> 
> 赞同：4
> 
> 时间：2008-09-26T05:20:24.900
> 
> 标签：c#, mono, keyboard-hook

我正在使用在[CodeProject.com 上找到的代码作为低级键盘挂钩](http://www.codeproject.com/KB/cs/CSLLKeyboardHook.aspx)。唯一的问题是它使用了在单声道中不起作用的外部 DLL 调用。我想知道是否有人知道一种方法可以完成与该代码相同的事情，但可以在使用 .net 的 Windows 和使用 mono 的 Linux 中运行？

编辑：澄清我正在尝试做的事情：我正在制作一个[Dashboard like application](http://joel-llamaduck.blogspot.com/)。该程序位于系统托盘中，当用户按下热键时，它将弹出所有小工具。所以程序没有焦点，所以通常它不会捕捉到任何击键，所以我使用低级键盘钩子并钩住用户定义为热键的两个键。但我正在为此使用 Windows DLL 调用，这在使用单声道的 Linux 中不起作用。所以我想知道是否有办法做同样的事情，但会使用单声道在 Linux 中运行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T14:32:59.290

在不知道您要捕捉什么的情况下，很难确定什么对您有用。您可能想看看使用 Application.AddMessageFilter。

一个例子在这里：http: [//dn.codegear.com/article/30129](http://dn.codegear.com/article/30129)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T18:41:31.157

仅使用 .Net 是不可能获得这种行为的。您必须为您运行的每个平台（Windows、Linux、Mac OS）使用二进制驱动程序。可能只使用 P/Invoke（检测您正在运行的操作系统，调用适当的系统库），这样您就不必分发任何“额外”的 dll/so/dylib。

# openid - 在 Plone 中向头部添加标签的最佳方法是什么？

> ID：137911
> 
> 赞同：3
> 
> 时间：2008-09-26T05:28:53.960
> 
> 标签：openid, plone

我想添加链接标签以将我的网站重定向到我的 OpenID 提供商。这些标签应该放在 head 元素中。在 Plone 中添加它们的最佳方法是什么？

我知道填充 head_slot 是一种方法，但这只能在您向页面添加模板并且正在呈现该模板时发生。就我而言，我没有添加任何模板。我应该修改哪个模板（不是 main_template.pt，这是我目前的解决方案，它有很大的缺点）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T07:28:02.607

您需要填写`head_slot`定义的`main_template.pt`

在您的基本克隆模板中，添加以下内容：

```
<head>
    <metal:block metal:fill-slot="head_slot">
        <link rel="openid.server" href="http://your.provider">
        <link rel="openid.delegate" href="http://your.url">
    </metal:block>
</head> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T14:31:10.597

最后，您必须将它们直接放在 main_template 中，或者必须将它们插入到 mail_template 中的插槽之一中。

我将它们放在样式槽中，紧挨着其余的 css/javascript 链接：

```
 <metal:myopenid fill-slot="style_slot">
    <link rel="openid.server" href="http://www.myopenid.com/server" />
    <link rel="openid.delegate" href="http://reinout.myopenid.com/" />
  </metal:myopenid> 
```

您必须将其放在某个模板中。我把它放在一个单独的 homepage.pt 中，因为我正在自定义主页。这会将 openid 标头放在主页上。如果您不想要自定义模板，您可以自定义 document_view 模板（假设您的主页是一个文档）并将上面的代码片段输入其中。

如果 plone 本身有一个选项，那将是最好的，类似于“在此处添加用于统计的 javascript”选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T07:56:17.347

我无法理解如何在没有产品或任何东西的情况下填补空缺。我知道您可以从模板中填充插槽，但如果 Plone 没有选择该模板，则*填充代码*将永远不会运行。我最终修改了 main_template 并将我的代码直接放在 . 这很糟糕，因为不同的皮肤会有不同的 main_templates 并且确实它咬了我，因为当我使用另一个模板时，我已经为一个模板修改了它。这不是一种无害的体验，而是一个令人讨厌的问题，因为 main_template 在自定义中并且它被拾取，所以你有一个皮肤与另一个皮肤的 main_template 一起工作。最终结果：用户界面因难以发现的问题而损坏。

这是我添加的代码：

```
<head>
   ...
   <link rel="openid.server" href="http://www.myopenid.com/server" />
   <link rel="openid.delegate" href="http://pupeno.myopenid.com/" />
   <link rel="openid2.local_id" href="http://pupeno.myopenid.com" />
   <link rel="openid2.provider" href="http://www.myopenid.com/server" />
   <meta http-equiv="X-XRDS-Location" content="http://www.myopenid.com/xrds?username=pupeno.myopenid.com" />
</head> 
```

我可能会将此答案标记为已接受，因为这是我目前正在使用的（这是我的政策，我将最终使用的解决方案标记为已接受，没有其他问题被标记为已接受），但如果任何其他问题在如何注入这个新模板，我将使用它并恢复接受（如果 StackOverflow 允许的话）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-26T14:42:08.690

可以在此处找到有关支持 OpenID 的 Plone 文档。

[http://plone.org/documentation/how-to/openid-support/view?searchterm=openid](http://plone.org/documentation/how-to/openid-support/view?searchterm=openid)

希望这可以帮助。

# firebug - Firefox 3 上的 Firebug 稳定了吗？

> ID：137926
> 
> 赞同：1
> 
> 时间：2008-09-26T05:36:06.577
> 
> 标签：firebug, firefox-3

我真的应该升级到 Firefox 3，但我非常依赖 Firebug 正常工作。

我知道有一个版本的 Firebug 应该可以与 Firefox 3 一起使用，但上次我查看时，它似乎有问题。

那么，对于那些已经跃跃欲试的人，Firefox 3 上的 Firebug 准备好迎接黄金时段了吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T05:38:33.407

是的，我一直在大量使用 Firebug，而且它非常稳定。你特别遇到了什么问题？我们可以测试并报告结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T05:47:49.250

Firebug 在 Firefox 3 上是稳定的，但你必须升级到版本 1.2.1，因为以前的版本不再工作。

出于某种原因，我不得不手动进行此更新：卸载以前的版本并安装新版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T05:39:08.413

我们在 Firebug 1.2.1 中使用 FF3 已经有一段时间了，没有遇到任何问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T05:42:59.853

你不必“跳”到FF3。将它与 Firefox 2 一起安装并自己尝试一下。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T05:44:44.250

网络监控仍然会破坏 HTTP 标头，从而导致缓存。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T06:03:09.510

我现在正在使用 Firefox，它非常用户友好且易于使用，但问题是它消耗了更多内存

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T06:15:29.557

Firebug 1.2.x（唯一适用于 Firefox 3 的版本）似乎不再具有仅对某些网页和站点禁用 Firebug 的选项。如果您使用此功能，您可能更愿意继续使用 FF 2。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-26T14:27:17.563

它不仅运行良好，而且比 FF2 版本有了很大的改进，比如允许禁用控制台、脚本、网络和 Cookie（如果你有 Firecookies）以使用更少的资源（如果你没有太多资源，这是 FF2 中的一个大问题内存并有很多标签），并允许/禁止每个站点的它们。在其他改进中...

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-17T14:28:34.380

在 jQuery 对象上执行“console.log”调用时，在 Firefox 3 中您会得到“对象”，您必须展开它们以查看它们是什么。在 Firefox 2 中，您会得到一个很好的列表，其中包含链接到 DOM 节点的名称，这样更容易查看。

据我所知，当您在 Firefox 3 上的 Firebug 中监视 XHR 调用时，您必须单击一个按钮才能查看 POST 调用的服务器响应。Firebug 的人说这是 Firefox 3 中的一个错误的解决方法，上次我检查他们仍在等待它被解决。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-27T00:12:38.180

仅供参考，firefox 3.0.9 上的 firebug 1.3.3 中存在一个错误，导致它不发送 If-modified-since 标头，因此它总是从服务器获取副本，而不是使用缓存的本地副本。

[http://code.google.com/p/fbug/issues/detail?id=1274&q=etag&colspec=ID%20Type%20Status%20Owner%20Test%20Summary](http://code.google.com/p/fbug/issues/detail?id=1274&q=etag&colspec=ID%20Type%20Status%20Owner%20Test%20Summary)

# c# - 嵌入 C# 桌面应用程序的最佳脚本语言是什么？

> ID：137933
> 
> 赞同：98
> 
> 时间：2008-09-26T05:40:01.797
> 
> 标签：c#, scripting

我们正在编写一个复杂的富桌面应用程序，并且需要在报告格式方面提供灵活性，因此我们认为我们只需将我们的对象模型暴露给脚本语言即可。时间是这意味着 VBA（这仍然是一个选项），但托管代码衍生 VSTA（我认为）似乎已经枯萎了。

现在，在 Windows .NET 上嵌入脚本语言的最佳选择是什么？

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2009-02-27T18:52:19.357

就个人而言，我会使用 C# 作为脚本语言。.NET 框架（和 Mono，感谢 Matthew Scharley）实际上在框架本身中包含了每种 .NET 语言的编译器。

基本上，这个系统的实施有两个部分。

1.  允许用户编译代码 这相对容易，只需几行代码就可以完成（尽管您可能想添加一个错误对话框，这可能需要几十行代码，具体取决于可用性你想要它）。

2.  创建和使用包含在已编译程序集中的类 这比上一步要困难一些（需要一点点反思）。基本上，您应该将已编译的程序集视为程序的“插件”。有很多教程介绍了使用 C# 创建插件系统的各种方法（Google 是您的朋友）。

我已经实现了一个“快速”应用程序来演示如何实现这个系统（包括 2 个工作脚本！）。这是应用程序的完整代码，只需新建一个并将代码粘贴到“program.cs”文件中。在这一点上，我必须为我要粘贴的大量代码道歉（我不打算让它这么大，但我的评论有点忘乎所以）

```
 using System;
using System.Windows.Forms;
using System.Reflection;
using System.CodeDom.Compiler;

namespace ScriptingInterface
{
    public interface IScriptType1
    {
        string RunScript(int value);
    }
}

namespace ScriptingExample
{
    static class Program
    {
        /// 
        /// The main entry point for the application.
        /// 
        [STAThread]
        static void Main()
        {

            // Lets compile some code (I'm lazy, so I'll just hardcode it all, i'm sure you can work out how to read from a file/text box instead
            Assembly compiledScript = CompileCode(
                "namespace SimpleScripts" +
                "{" +
                "    public class MyScriptMul5 : ScriptingInterface.IScriptType1" +
                "    {" +
                "        public string RunScript(int value)" +
                "        {" +
                "            return this.ToString() + \" just ran! Result: \" + (value*5).ToString();" +
                "        }" +
                "    }" +
                "    public class MyScriptNegate : ScriptingInterface.IScriptType1" +
                "    {" +
                "        public string RunScript(int value)" +
                "        {" +
                "            return this.ToString() + \" just ran! Result: \" + (-value).ToString();" +
                "        }" +
                "    }" +
                "}");

            if (compiledScript != null)
            {
                RunScript(compiledScript);
            }
        }

        static Assembly CompileCode(string code)
        {
            // Create a code provider
            // This class implements the 'CodeDomProvider' class as its base. All of the current .Net languages (at least Microsoft ones)
            // come with thier own implemtation, thus you can allow the user to use the language of thier choice (though i recommend that
            // you don't allow the use of c++, which is too volatile for scripting use - memory leaks anyone?)
            Microsoft.CSharp.CSharpCodeProvider csProvider = new Microsoft.CSharp.CSharpCodeProvider();

            // Setup our options
            CompilerParameters options = new CompilerParameters();
            options.GenerateExecutable = false; // we want a Dll (or "Class Library" as its called in .Net)
            options.GenerateInMemory = true; // Saves us from deleting the Dll when we are done with it, though you could set this to false and save start-up time by next time by not having to re-compile
            // And set any others you want, there a quite a few, take some time to look through them all and decide which fit your application best!

            // Add any references you want the users to be able to access, be warned that giving them access to some classes can allow
            // harmful code to be written and executed. I recommend that you write your own Class library that is the only reference it allows
            // thus they can only do the things you want them to.
            // (though things like "System.Xml.dll" can be useful, just need to provide a way users can read a file to pass in to it)
            // Just to avoid bloatin this example to much, we will just add THIS program to its references, that way we don't need another
            // project to store the interfaces that both this class and the other uses. Just remember, this will expose ALL public classes to
            // the "script"
            options.ReferencedAssemblies.Add(Assembly.GetExecutingAssembly().Location);

            // Compile our code
            CompilerResults result;
            result = csProvider.CompileAssemblyFromSource(options, code);

            if (result.Errors.HasErrors)
            {
                // TODO: report back to the user that the script has errored
                return null;
            }

            if (result.Errors.HasWarnings)
            {
                // TODO: tell the user about the warnings, might want to prompt them if they want to continue
                // runnning the "script"
            }

            return result.CompiledAssembly;
        }

        static void RunScript(Assembly script)
        {
            // Now that we have a compiled script, lets run them
            foreach (Type type in script.GetExportedTypes())
            {
                foreach (Type iface in type.GetInterfaces())
                {
                    if (iface == typeof(ScriptingInterface.IScriptType1))
                    {
                        // yay, we found a script interface, lets create it and run it!

                        // Get the constructor for the current type
                        // you can also specify what creation parameter types you want to pass to it,
                        // so you could possibly pass in data it might need, or a class that it can use to query the host application
                        ConstructorInfo constructor = type.GetConstructor(System.Type.EmptyTypes);
                        if (constructor != null && constructor.IsPublic)
                        {
                            // lets be friendly and only do things legitimitely by only using valid constructors

                            // we specified that we wanted a constructor that doesn't take parameters, so don't pass parameters
                            ScriptingInterface.IScriptType1 scriptObject = constructor.Invoke(null) as ScriptingInterface.IScriptType1;
                            if (scriptObject != null)
                            {
                                //Lets run our script and display its results
                                MessageBox.Show(scriptObject.RunScript(50));
                            }
                            else
                            {
                                // hmmm, for some reason it didn't create the object
                                // this shouldn't happen, as we have been doing checks all along, but we should
                                // inform the user something bad has happened, and possibly request them to send
                                // you the script so you can debug this problem
                            }
                        }
                        else
                        {
                            // and even more friendly and explain that there was no valid constructor
                            // found and thats why this script object wasn't run
                        }
                    }
                }
            }
        }
    }
} 

```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-26T05:41:28.423

[铁蟒](http://www.codeplex.com/IronPython)。[以下是如何嵌入它](http://www.voidspace.org.uk/ironpython/embedding.shtml)的概述。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-26T20:41:35.580

我使用[CSScript 取得](http://www.csscript.net/)了惊人的效果。它确实减少了在我的可编写脚本的应用程序中进行绑定和其他低级别的工作。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-09-26T05:52:35.790

PowerShell 引擎旨在轻松嵌入到应用程序中，使其可编写脚本。事实上，PowerShell CLI 只是引擎的一个基于文本的界面。

编辑：见[https://devblogs.microsoft.com/powershell/making-applications-scriptable-via-powershell/](https://devblogs.microsoft.com/powershell/making-applications-scriptable-via-powershell/)

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-26T05:53:00.187

[嘘](http://boo.codehaus.org/Interactive+Interpreter)语言。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-26T07:59:29.900

这些天我选择的脚本语言是[Lua 。](http://www.lua.org)它体积小、速度快、干净、文档齐全、支持良好、有一个很棒的[社区](http://lua-users.org/)，它被[业内](http://lua-users.org/wiki/LuaUses)许多大公司（Adobe、暴雪、EA Games）使用，绝对值得一试。

要将它与 .NET 语言一起使用，[LuaInterface](http://luaforge.net/projects/luainterface/)项目将提供您所需要的一切。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T08:10:41.933

为什么不试试 C#？Mono 有一个很棒的新项目，特别是用于动态评估 C#：

[http://tirania.org/blog/archive/2008/Sep-10.html](http://tirania.org/blog/archive/2008/Sep-10.html)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T05:52:58.440

IronRuby 如上所述。作为一名 C# 程序员，对我来说一个有趣的项目是[Mono 中的 C# Eval 支持](http://tirania.org/blog/archive/2008/Sep-10.html)。但它还不可用（将成为 Mono 2.2 的一部分）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-26T20:37:40.240

IronPython 的另一票。嵌入它很简单，与 .Net 类的互操作也很简单，而且，它是 Python。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-10-30T15:04:55.847

我可能会建议我目前维护的[S# 。](https://github.com/PetroProtsyk/SSharp)它是一个开源项目，用 C# 编写，专为 .NET 应用程序设计。

最初（2007-2009 年）它托管在[http://www.codeplex.com/scriptdotnet](http://www.codeplex.com/scriptdotnet)，但最近它被移到了 github。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-11-23T13:04:43.097

试试[埃拉](http://elalang.net/)。这是一种类似于 Haskell 的函数式语言，可以[嵌入](http://elalang.net/docs/Article.aspx?p=embedding.htm)到任何 .Net 应用程序中。即使它具有简单但可用的 IDE。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T06:03:17.713

我还没有尝试过，但它看起来很酷：

[http://www.codeplex.com/scriptdotnet](http://www.codeplex.com/scriptdotnet)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T06:06:03.183

我刚刚为客户端创建了一个插件，允许他们在模块中编写 C# 代码，就像 VBA 为 Office 所做的那样。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-04-05T10:49:46.273

我以前用过[Lua](http://www.lua.org/)；在 Delphi 应用程序中，但它可以嵌入到很多东西中。它用于[Adob​​e 的 Photoshop Lightroom](http://since1968.com/article/190/mark-hamburg-interview-adobe-photoshop-lightroom-part-2-of-2)中。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-06-06T18:42:58.200

**我喜欢用 C# 本身编写脚本**。现在，在 2013 年，对 C# 脚本的支持非常好，越来越多的库可供使用。

[Mono 对脚本 C# 代码](http://tirania.org/blog/archive/2011/Feb-24.html)有很好的支持，您只需`Mono.CSharp.dll`在应用程序中包含 .NET 即可使用它。对于我制作的 C# 脚本应用程序，请查看[CShell](http://cshell.net/)

还可以查看来自 Microsoft 的[Roslyn](http://msdn.microsoft.com/en-us/vstudio/roslyn.aspx)中的“ScriptEngine”，但这只是 CTP。

正如一些人已经提到的，[CS-Script](http://www.csscript.net/)也已经存在了很长一段时间。

# search - 如何从 Vim 搜索列表跳转到某个事件

> ID：137935
> 
> 赞同：6
> 
> 时间：2008-09-26T05:40:17.240
> 
> 标签：search, vim, ctags

在 Vim 编辑器中，我选择`]I`了一个函数（在 C++ 代码中）。这显示了一个列表，上面写着*'Press ENTER or type command to continue'*。

现在要跳转到一个事件，比如 6，我输入`6`- 但这不起作用。

在这种情况下我可以输入什么命令，我如何从这个列表中跳转到第 N 次出现？

**更新：**

实际上我试过[:N](https://stackoverflow.com/questions/137935/how-to-jump-to-an-occurrence-from-vim-search-list#137942)（例如 :6）——但是当我输入`:`Vim 的那一刻进入了插入模式，冒号被插入到代码中。

**更新**

假设[:N](https://stackoverflow.com/questions/137935/how-to-jump-to-an-occurrence-from-vim-search-list#137942)方法是正确的，仍然完全卸载和安装 Vim，没有任何配置，也没有帮助 - 尽管现在输入`:`不会将 Vim 切换到插入模式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T05:44:02.037

它应该为您提供一个列表，例如：

```
1:   345 my_func (int var)
2:  4523 my_func (int var)
3: 10032 my_func (3); 
```

第二列是行号。输入 :345 跳转到第 345 行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T06:10:40.910

在 vim 上执行 :h tselect 以查看完整的定义

> 如果您已经看到要使用的标签，您可以输入“q”并输入数字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T22:26:17.780

如果您按下跳跃按钮，并获得可能的目标列表，请选择数字，然后再次按下跳跃。

所以给定

```
1:   345 my_func (int var)
2:  4523 my_func (int var)
3: 10032 my_func (3); 
```

如果你点击'2]|'，它应该直接跳到那行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-30T08:54:07.940

我遇到了同样的问题，将以前的答案拼凑在一起并进行试验，我想出了这个解决方案：

```
[I  // gives list of matches for word under cursor, potentially some matches are in headers. remember the number of the match you're interested in, eg. the 3rd
q  // quits the list of matches
3[Ctrl-i  // (with cursor in same position) jumps to third match 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T05:52:31.890

当我使用 vim 时，我会跳转到一个标签，例如：

```
 :tag getfirst 
```

我得到的东西看起来像：

```
 # pri kind tag               file
  1 F   m    getfirst          /home/sthorne/work/.../FormData.py
               class:FakeFieldStorage
               def getfirst(self, k, default):
    ....
  8 F   m    getfirst          /home/sthorne/work/.../CGIForm.py
               class:CGIForm
               def getfirst(self, name):
Choice number (<Enter> cancels): 
```

我键入“5”以转到第 5 次出现。

如果你不能让你的 vim 有这种行为（我的 vim 默认情况下它似乎是打开的），你可以使用**g]**而不是**ctrl-]**，这**类似于 :tselect**而不是**:tag**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-03T08:11:10.280

`[I`只列出搜索结果。要*跳转*到结果，请使用 sequence `[ CTRL+I`。

您可以在以下位置查看相关跳转的完整列表：

[http://www.vim.org/htmldoc/tagsrch.html#include-search](http://www.vim.org/htmldoc/tagsrch.html#include-search)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-26T06:12:09.690

尝试使用`123G`转到第 123 行（请参阅 参考资料`:h G`）。

# django - Cherrypy 如何处理用户线程？

> ID：137950
> 
> 赞同：4
> 
> 时间：2008-09-26T05:47:57.610
> 
> 标签：django, multithreading, concurrency, cherrypy

我正在开发一个 django 应用程序，我正在使用cherrypy 作为服务器。Cherrypy 为每个页面视图创建一个新线程。我希望能够从它们中的任何一个中访问所有这些线程（负责与 django 对话的线程）。更具体地说，我希望能够从其中任何一个线程中访问每个线程的 thread_data。这可能吗？如果是这样，我该怎么做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T06:52:22.780

CherryPy 的 wsgiserver 不会为每个请求创建一个新线程——它使用一个池。这些工作线程中的每一个都是 threading.Thread 的子类，因此它们都应该可以通过 threading.enumerate() 访问。

但是，如果您专门讨论的是cherrypy.thread_data，那就是另一回事了：threading.local。如果您使用的是最新版本的 Python，那么所有这些都是用 C 编码的，而您（可能是正确的）没有从 Python 对它的跨线程访问。如果你*真的*需要它并且**真的**知道你在做什么，最好的技术通常是在将这些东西插入到 thread_data 结构中的同时，在全局容器中附加对这些东西的引用。我推荐带有weakrefs的dicts作为这些全局容器的键——有足够多的Python ORM将它们用于连接池（例如，参见我自己的Geniusql），你应该能够相当容易地学习如何实现它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T02:52:26.583

我对这样一个问题的第一反应不是告诉你如何去做，而是强调你真的应该在继续之前重新考虑。我通常会避开线程化的 Web 服务器，而倾向于多进程或异步解决方案。在混合中添加显式的线程间通信只会增加这些恐惧。

当提出这样的问题时，就有了更深层次的目标。我怀疑您认为线程间通信可以解决的问题实际上可以通过其他更安全的方式解决。

# asp.net - 使用 javascript 从 ASP.NET 数据网格中读取所有值

> ID：137951
> 
> 赞同：0
> 
> 时间：2008-09-26T05:49:09.760
> 
> 标签：asp.net, javascript

我有一个 ASP.NET Datagrid，里面有几个文本框和下拉框。我想使用 JavaScript 函数读取网格中的所有值。我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T06:07:38.577

使用 jQuery 轻松完成。我不记得 Datagrid 创建了什么样的标记，但基本上这样的东西可以在 Jquery 中使用

```
 $('#client_id_of_datagrid input, #client_id_of_datagrid select')
.each(function() {val = this.value; /* Do Stuff */}) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T07:05:36.037

下面是一个使用 Microsoft AJAX 框架的示例：

```
var txts = $get('client_id_of_datagrid').getElementsByTagName('input');
var ddls = $get('client_id_of_datagrid').getElementsByTagName('select');

for(var i=0;i<txts.length;i++){
  if(txts[i].type==='text'){
    /* do stuff */
  }
}

for(var i=0;i<ddls.length;i++){
  /* do stuff */
} 
```

对于没有框架的情况，将 $get 替换为 document.getElementById。真的，jQuery 是最好的主意。

# regex - Vim Markdown 高亮（列表项和代码块冲突）

> ID：137952
> 
> 赞同：11
> 
> 时间：2008-09-26T05:50:16.653
> 
> 标签：regex, vim, syntax, markdown, highlight

我决定进一步了解 vim 及其语法高亮。使用其他人的示例，我正在为 Markdown 创建自己的语法文件。我见过[mkd.vim](http://www.vim.org/scripts/script.php?script_id=1242)也有这个问题。我的问题是在列表项和代码块突出显示之间。

代码块[定义](http://daringfireball.net/projects/markdown/syntax#precode)：

*   第一行为空白
*   第二行以至少 4 个空格或 1 个制表符开头
*   块以空行结束

例子：

```
Regular text

    this is code, monospaced and left untouched by markdown
    another line of code

Regular Text 
```

我的代码块的 Vim 语法：

```
syn match mkdCodeBlock   /\(\s\{4,}\|\t\{1,}\).*\n/ contained nextgroup=mkdCodeBlock  

hi link mkdCodeBlock  comment 
```

无序列表项[定义](http://daringfireball.net/projects/markdown/syntax#list)：

*   第一行为空白
*   第二行以 [-+*] 开头，后跟一个空格
*   列表以空行结束，然后是正常（非列表）行
*   在行项目之间可以添加任意数量的空行
*   通过缩进指定子列表（4 个空格或 1 个制表符）
*   列表项后的一行普通文本作为该列表项的延续包含在内

例子：

```
Regular text

- item 1

    - sub item 1
    - sub item 2
- item 2
this is part of item 2
so is this

- item 3, still in the same list
    - sub item 1
    - sub item 2

Regular text, list ends above 
```

我的无序列表项定义的 Vim 语法（我只突出显示`[-+*]`）：

```
syn region  mkdListItem start=/\s*[-*+]\s\+/ matchgroup=pdcListText end=".*" contained nextgroup=mkdListItem,mkdListSkipNL contains=@Spell skipnl 
syn match mkdListSkipNL /\s*\n/ contained nextgroup=mkdListItem,mkdListSkipNL skipnl

hi link mkdListItem  operator 
```

我无法使用列表的最后两条规则和代码块来突出显示。

这是一个打破我的语法高亮的例子：

```
Regular text

- Item 1
- Item 2
part of item 2

    - these 2 line should be highlighted as a list item
    - but they are highlighted as a code block 
```

我目前无法弄清楚如何让突出显示以我想要的方式工作

* * *

忘记添加下面列出的两个规则中使用的“全局”语法规则。这是为了确保它们以空行开头。

```
syn match mkdBlankLine   /^\s*\n/    nextgroup=mkdCodeBlock,mkdListItem transparent 
```

* * *

另注：我应该更清楚。在我的语法文件中，列表规则出现在块引用规则之前

* * *

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T07:43:12.497

只需确保 mkdListItem 的定义在 mkdCodeBlock 的定义之后，如下所示：

```
syn match mkdCodeBlock   /\(\s\{4,}\|\t\{1,}\).*\n/ contained nextgroup=mkdCodeBlock  
hi link mkdCodeBlock  comment

syn region  mkdListItem start=/\s*[-*+]\s\+/ matchgroup=pdcListText end=".*" contained nextgroup=mkdListItem,mkdListSkipNL contains=@Spell skipnl 
syn match mkdListSkipNL /\s*\n/ contained nextgroup=mkdListItem,mkdListSkipNL skipnl
hi link mkdListItem  operator

syn match mkdBlankLine   /^\s*\n/    nextgroup=mkdCodeBlock,mkdListItem transparent 
```

Vim 文档中说`:help :syn-define`：

“如果多个项目在同一位置匹配，则定义为 LAST 的项目获胜。因此，您可以使用与相同文本匹配的项目覆盖先前定义的语法项目。但关键字始终位于匹配项或区域之前。并且大小写匹配的关键字总是在忽略大小写的关键字之前。”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T22:09:31.173

hcs42 是正确的。我确实记得现在读过那部分，但我忘记了，直到 hcs24 提醒我。

这是我更新的语法（其他一些调整）有效：

```
"""""""""""""""""""""""""""""""""""""""""
" 代码块：

" 缩进至少 4 个空格或 1 个制表符
" 这个规则必须出现在 mkdListItem 中，否则突出显示会搞砸
同步匹配 mkdCodeBlock /\(\s\{4,}\|\t\{1,}\).*\n/ 包含 nextgroup=mkdCodeBlock  

"""""""""""""""""""""""""""""""""""""""""
" 列表：

" 前两条规则必须放在首位，否则突出显示将是
“不正确

" 继续当前行或下一行的列表
syn match mkdListCont /\s*[^-+*].*/ contains nextgroup=mkdListCont,mkdListItem,mkdListSkipNL contains=@Spell skipnl transparent

" 跳过空行
同步匹配 mkdListSkipNL /\s*\n/ 包含 nextgroup=mkdListItem,mkdListSkipNL

" 无序列表
syn match mkdListItem /\s*[-*+]\s\+/ 包含 nextgroup=mkdListSkipNL,mkdListCont skipnl

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-03-23T17:00:38.490

Tao Zhyn，这可能涵盖了您的用例，但不涵盖 Markdown 语法。在 Markdown 中，列表项**可以**包含代码块。你可以看看我的解决方案[here](https://github.com/gabrielelana/vim-markdown)

TL;博士; 问题是 vim 不允许你说这样的话：*一个与其容器具有相同缩进的块 + 4 个空格*。我找到的唯一解决方案是为每种类型的块生成规则，这些块可以包含在每个缩进级别的列表项中（实际上我支持 42 级缩进，但它是一个任意数字）

所以我有 markdownCodeBlockInListItemAtLevel1**必须**包含在 markdownListItemAtLevel1 中，它需要至少有 8 个前导空格，然后 markdownCodeBlockInListItemAtLevel2**必须**包含在 markdownListItemAtLevel2 中，必须包含在 markdownListItemAtLevel1 蚂蚁需要至少 10 个前导空格，ecc ...

我知道几年过去了，但也许有人会认为这个答案很有帮助，因为所有基于缩进的语法都存在同样的问题

# java - 哈德逊作业挂在 Runtime.exec

> ID：137972
> 
> 赞同：2
> 
> 时间：2008-09-26T05:58:48.863
> 
> 标签：java, hudson, runtime.exec

我通过 Tomcat 将 Hudson 作为 Windows 服务运行，不涉及任何从站。作业中的最后一个构建步骤是调用一些 Java 代码的批处理文件。该代码使用 PostgreSQL 的命令行工具 psql（通过 Runtime.exec()）在本地机器上创建一个数据库，并最终针对它运行一些测试。

该作业将进行到这一点，然后无限期地挂起而不开始创建数据库。如果我从命令行运行批处理文件，它会完美运行。我认为[http://hudson.gotdns.com/wiki/display/HUDSON/Spawning+processes+from+build](http://hudson.gotdns.com/wiki/display/HUDSON/Spawning+processes+from+build)不适用，因为生成的进程似乎还没有开始执行，但我对此并不陌生所以如果我错了，请告诉我。

编辑@anjanb：批处理文件的唯一目的是调用 Java 代码，唯一的用户输入作为命令行参数传入，我可以看到它直接通过构建的控制台输出进入。

Process Explorer 显示 psql 正在启动，但它显然没有被执行，因为给出的第一个命令 psql 是创建一个新数据库，但这并没有发生。

编辑 2：我从 Hudson 用户邮件列表中获得了一些提示，我将在周一试用并报告。

编辑 3：Java 代码已经在使用输出流，我在开发代码时使用了那篇文章。我不知道发生了什么，所以我正在重新开发代码以使用 JDBC 来创建数据库，而不是依赖 psql 和 Runtime.exec()

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T22:04:15.147

你读过这个过程的输出吗？如果它产生的输出比操作系统缓冲区可以处理的多，则需要阅读它...

此外，一些进程会等到输入完成。启动进程后尝试调用 process.getInputStream().close()。

也许这篇文章也很有趣。它被称为“当 Runtime.exec() 不会”： [http ://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html?page=2](http://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html?page=2)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T06:06:17.317

程序可能正在等待某些用户输入。如果该服务未配置为接受用户输入，它将显示为挂起。

您可以尝试通过将服务配置为允许 USER INPUT(GUI) - 这可能会有所帮助。

此外，您可以运行 Sysinternals ProcessExplorer 和 ProcessMonitor——它们将能够找出 .BAT 作业停止的位置。

# design-patterns - 单例模式的缺点或缺点是什么？

> ID：137975
> 
> 赞同：2089
> 
> 时间：2008-09-26T06:02:00.727
> 
> 标签：design-patterns, singleton

单[例模式](https://en.wikipedia.org/wiki/Singleton_pattern)是[GoF](https://en.wikipedia.org/wiki/Design_Patterns)[模式手册](https://rads.stackoverflow.com/amzn/click/com/0201633612)中完全付费的成员，但它最近似乎被开发人员世界孤立了。我仍然使用相当多的单例，特别是对于[工厂类](https://en.wikipedia.org/wiki/Factory_method_pattern)，虽然你必须对多线程问题（实际上就像任何类）有点小心，但我不明白为什么它们如此糟糕。

Stack Overflow 似乎特别假设每个人都同意单身人士是邪恶的。为什么？

*请用“事实、参考资料或特定专业知识*”来支持您的回答

* * *

## 回答 #1

> 赞同：1381
> 
> 时间：2008-09-26T06:13:44.630

来自布赖恩·巴顿的解释：

1.  它们通常用作全局实例，为什么这么糟糕？因为您在代码中隐藏了应用程序的依赖项，而不是通过接口公开它们。使某些东西全局化以避免传递它是一种[代码异味](https://en.wikipedia.org/wiki/Code_smell)。

2.  它们违反了[单一责任原则](https://en.wikipedia.org/wiki/Single_responsibility_principle)：因为它们控制着自己的创建和生命周期。

3.  它们固有地导致代码紧密[耦合](https://en.wikipedia.org/wiki/Coupling_%28computer_programming%29)。在许多情况下，这使得在测试中伪造它们相当困难。

4.  它们在应用程序的生命周期内携带状态。测试的另一个打击，因为您最终可能会遇到需要订购测试的情况，这对于单元测试来说是一个很大的禁忌。为什么？因为每个单元测试都应该相互独立。

* * *

## 回答 #2

> 赞同：484
> 
> 时间：2008-09-26T23:11:19.387

单身人士解决了一个（也是唯一一个）问题。

**资源争用。**

如果你有一些资源

( **1** ) 只能有一个实例，并且

( **2** ) 你需要管理那个单一的实例，

你需要一个**单身人士**。

例子不多。日志文件很大。您不想仅仅放弃一个日志文件。您想正确刷新、同步和关闭它。这是必须管理的单个共享资源的示例。

很少需要单身人士。他们不好的原因是他们感觉像一个[全球性](https://en.wikipedia.org/wiki/Global_variable)的，并且他们是 GoF*[设计模式](https://en.wikipedia.org/wiki/Design_Patterns)*书的全额付费会员。

当你认为你需要一个全局变量时，你可能犯了一个严重的设计错误。

* * *

## 回答 #3

> 赞同：376
> 
> 时间：2008-09-26T06:13:11.090

一些编码势利小人看不起他们，认为他们只是一个美化了的全球。就像许多人讨厌*goto*语句一样，还有其他人讨厌使用*global*的想法。我见过一些开发人员不遗余力地避免使用*全局*变量，因为他们认为使用全局变量是对失败的承认。奇怪但真实。

在实践中，*单例*模式只是一种编程技术，它是您的概念工具包中有用的一部分。有时您可能会发现它是理想的解决方案，因此请使用它。但是仅仅为了你可以吹嘘使用*设计模式*而使用它就像拒绝使用它一样愚蠢，因为它只是一个*全局*.

* * *

## 回答 #4

> 赞同：231
> 
> 时间：2008-09-26T06:08:43.490

来自 Google 的 Misko Hevery 有一些关于这个主题的有趣文章……

[Singletons are Pathological Liars](https://testing.googleblog.com/2008/08/by-miko-hevery-so-you-join-new-project.html)有一个单元测试示例，说明了单例如何使找出依赖链以及启动或测试应用程序变得困难。这是一个相当极端的滥用例子，但他提出的观点仍然有效：

> 单例只不过是全局状态。全局状态使您的对象可以秘密地获取未在其 API 中声明的内容，结果，单例使您的 API 成为病态的骗子。

[所有的 Singletons Gone 都去哪儿了](https://testing.googleblog.com/2008/08/where-have-all-singletons-gone.html)，这表明依赖注入使得将实例获取到需要它们的构造函数变得容易，这减轻了第一篇文章中所谴责的糟糕的全局 Singletons 背后的潜在需求。

* * *

## 回答 #5

> 赞同：138
> 
> 时间：2008-09-26T18:03:07.553

我认为这种混乱是由于人们不知道单例模式的真正应用造成的。我怎么强调都不过分。单例**不是**包装全局变量的模式。单例模式应该只用于保证**给定类的一个且只有一个实例**在运行时存在。

人们认为 Singleton 是邪恶的，因为他们将它用于全局变量。正是因为这种混乱，Singleton 才被看不起。请不要混淆单例和全局。如果将其用于预期目的，您将从单例模式中获得极大的好处。

* * *

## 回答 #6

> 赞同：75
> 
> 时间：2008-09-26T06:17:12.377

关于单例的一件相当糟糕的事情是你不能很容易地扩展它们。如果你想改变它们的行为，你基本上必须构建某种[装饰器模式或类似的东西。](https://en.wikipedia.org/wiki/Decorator_pattern)此外，如果有一天你想用多种方法来做一件事，那么改变可能会很痛苦，这取决于你如何布置代码。

需要注意的一件事是，如果您确实使用单例，请尝试将它们传递给需要它们的人，而不是让他们直接访问它......否则，如果您选择有多种方式来做单例所做的事情，那将是如果每个类直接访问单例，则很难更改，因为每个类都嵌入了依赖项。

所以基本上：

```
public MyConstructor(Singleton singleton) {
    this.singleton = singleton;
} 
```

而不是：

```
public MyConstructor() {
    this.singleton = Singleton.getInstance();
} 
```

我相信这种模式被称为[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)，通常被认为是一件好事。

就像任何模式一样......想想它并考虑它在给定情况下的使用是否不合适......规则通常被打破，并且不应该随意应用[模式](https://en.wikipedia.org/wiki/Software_design_pattern)而不加考虑。

* * *

## 回答 #7

> 赞同：70
> 
> 时间：2008-09-26T06:37:29.147

单例模式本身不是问题。问题在于，这种模式经常被使用面向对象工具开发软件的人使用，而没有扎实掌握 OO 概念。当在这种情况下引入单例时，它们往往会发展成难以管理的类，其中包含用于每个小用途的辅助方法。

从测试的角度来看，单例也是一个问题。它们倾向于使孤立的单元测试难以编写。**[控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)**(IoC) 和**[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)**是旨在以适合于单元测试的面向对象方式克服此问题的模式。

在[垃圾收集](https://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29)环境中，单例很快就会成为内存管理方面的问题。

在多线程场景中，单例可能会成为瓶颈和同步问题。

* * *

## 回答 #8

> 赞同：56
> 
> 时间：2008-09-26T06:11:11.813

单例使用静态方法实现。进行单元测试的人会避免使用静态方法，因为它们不能被模拟或存根。这个网站上的大多数人都是单元测试的大力支持者。避免它们的普遍接受的约定是使用[控制](http://en.wikipedia.org/wiki/Inversion_of_control)模式的反转。

* * *

## 回答 #9

> 赞同：46
> 
> 时间：2013-02-22T14:34:10.683

**单例在集群**方面也很糟糕。因为那时，您的应用程序中不再有“完全一个单例”。

考虑以下情况： 作为开发人员，您必须创建一个访问数据库的 Web 应用程序。为确保并发数据库调用不会相互冲突，请创建一个 thread-save `SingletonDao`：

```
public class SingletonDao {
    // songleton's static variable and getInstance() method etc. omitted
    public void writeXYZ(...){
        synchronized(...){
            // some database writing operations...
        }
    }
} 
```

因此，您确定您的应用程序中只有一个单例，并且所有数据库都通过这个单例`SingletonDao`。您的生产环境现在如下所示： ![单身单身人士](https://i.stack.imgur.com/ySPwz.png)

到目前为止一切都很好。

现在，考虑您想在集群中设置 Web 应用程序的多个实例。现在，你突然有这样的事情：

![许多单身人士](https://i.stack.imgur.com/Cg1V3.png)

这听起来很奇怪，但**现在您的应用程序中有很多单例**。这正是单例不应该的：拥有很多对象。如果您（如本例所示）想要对数据库进行同步调用，这尤其糟糕。

当然，这是单例使用不当的一个例子。但是这个例子的信息是：你不能相信你的应用程序中只有一个单例实例——尤其是在集群方面。

* * *

## 回答 #10

> 赞同：45
> 
> 时间：2008-09-26T06:06:42.417

1.  它很容易（ab）用作全局变量。
2.  依赖单例的类相对难以单独进行单元测试。

* * *

## 回答 #11

> 赞同：35
> 
> 时间：2010-06-25T00:33:49.120

**垄断是魔鬼，具有非只读/可变状态的单身人士是“真正的”问题......**

在阅读[杰森的回答](https://stackoverflow.com/a/137996/632951)中建议的[单身人士是病态的骗子](http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/)之后，我遇到了这个小花絮，它提供了单身人士经常被滥用的最佳**例子**。

 **> 全球不好，因为：
> 
> *   一种。它会导致命名空间冲突
> *   湾。它以毫无根据的方式暴露了国家
> 
> 说到单身人士
> 
> *   一种。调用它们的显式 OO 方式可以防止冲突，所以点 a。不是问题
> *   湾。没有状态的单身人士（如工厂）不是问题。有状态的单例又可以分为两类，一类是不可变的或一次写入多次读取（配置/属性文件）。这些都不错。可变单例，它们是一种引用持有者，就是您所说的那些。

在最后的声明中，他指的是博客的“单身人士是骗子”的概念。

**这如何适用于垄断？**

要开始垄断游戏，首先：

*   我们首先制定规则，以便每个人都在同一页面上
*   每个人在游戏开始时都有平等的开始
*   仅提供一组规则以避免混淆
*   在整个游戏过程中不允许更改规则

现在，对于没有**真正**玩过垄断的人来说，这些标准充其量是理想的。垄断的失败是难以下咽的，因为垄断就是为了钱，如果你输了，你就必须苦苦地看着其他玩家完成游戏，而损失通常是迅速而毁灭性的。因此，规则通常会在某些时候被扭曲，以牺牲其他人的利益来满足一些玩家的自身利益。

所以你正在和朋友 Bob、Joe 和 Ed 玩垄断游戏。你正在迅速建立你的帝国并以指数级的速度消耗市场份额。你的对手正在变弱，你开始闻到血腥味（象征性地）。你的好友鲍勃把他所有的钱都投入到了尽可能多的低价值房产上，但他并没有像他预期的那样获得高投资回报。不幸的是，鲍勃落在了您的木板路上并被从游戏中剔除。

现在游戏从友好的掷骰子变成了严肃的生意。Bob 已经成为失败的榜样，而 Joe 和 Ed 不想像“那个人”那样结束。所以，作为主角的你，突然之间，变成了敌人。Joe 和 Ed 开始练习暗中交易、背后注资、被低估的房屋交换以及通常会削弱你作为玩家的任何东西，直到其中一个上升到顶峰。

然后，不是其中一个获胜，而是整个过程重新开始。突然之间，一组有限的规则变成了一个移动的目标，游戏退化为社交互动类型，这将构成自幸存者以来每一个高收视率的真人秀节目的基础。为什么，因为规则正在发生变化，对于它们应该如何/为什么/代表什么没有达成共识，更重要的是，没有一个人做出决定。那时，游戏中的每个玩家都在制定他/她自己的规则，混乱接踵而至，直到两个玩家太累而无法继续游戏并慢慢放弃。

因此，如果游戏的规则手册准确地代表了一个单身人士，那么垄断规则手册就是滥用的一个例子。

**这如何适用于编程？**

除了可变单例存在的所有明显的线程安全和同步问题......如果你有一组数据，它能够被多个不同的源同时读取/操作并且存在于应用程序执行的生命周期中，现在可能是退后一步并询问“我在这里使用正确类型的数据结构”的好时机。

就我个人而言，我曾见过一个程序员滥用单例，将其用作应用程序中某种扭曲的跨线程数据库存储。直接处理代码后，我可以证明它很慢（因为需要所有线程锁才能使其成为线程安全）并且是一场噩梦（因为同步错误的不可预测/间歇性），并且几乎不可能在“生产”条件下进行测试。当然，可以使用轮询/信令开发一个系统来克服一些性能问题，但这并不能解决测试问题，而且，当一个“真正的”数据库已经可以以更强大的方式完成相同的功能时，为什么还要麻烦呢？ /可扩展的方式。

**如果您需要单例提供的功能，单例只是一种选择*。*对象的只写只读实例。同样的规则也应该级联到对象的属性/成员。**

* * *

## 回答 #12

> 赞同：34
> 
> 时间：2015-11-08T14:54:16.197

## 单例不是关于单实例！

与其他答案不同，我不想谈论单例有什么问题，而是要向您展示它们在正确使用时是多么强大和真棒！

*   **问题**：单例在多线程环境中可能是一个挑战
    **解决方案**：使用单线程引导进程来初始化单例的所有依赖项。
*   **问题**：很难模拟单例。
    **解决方案**：使用方法[工厂](https://github.com/gazman-sdk/android_life_cycle/wiki)模式进行模拟

您可以映射`MyModel`到`TestMyModel`继承它的类，无论何时`MyModel`注入您都会得到`TestMyModel`instread。-**问题**：单例可能会导致内存泄漏，因为它们从未处理过。
**解决方案**：好吧，处理它们！在您的应用程序中实现回调以正确处理单例，您应该删除链接到它们的所有数据，最后：将它们从工厂中删除。

正如我在标题中所说的，单例与单例无关。

*   **单例提高了可读性**：您可以查看您的类并查看它注入的单例以找出它的依赖项。
*   **单例改进了维护**：一旦你从一个类中删除了一个依赖项，你就删除了一些单例注入，你不需要去编辑其他类的大链接，这些类只是移动了你的依赖项（这对我来说是臭代码[@Jim Burger](https://stackoverflow.com/a/138012/1129332) )
*   **单例提高内存和性能**：当您的应用程序中发生某些事情时，需要一长串的回调来传递，您正在浪费内存和性能，使用单例您正在削减中间人，并提高您的性能和内存使用（通过避免不必要的局部变量分配）。

* * *

## 回答 #13

> 赞同：24
> 
> 时间：2008-09-26T06:07:32.820

[参见维基百科 Singleton_pattern](http://en.wikipedia.org/wiki/Singleton_pattern)

> 它也被一些人认为是一种反模式，他们认为它被过度使用，在实际上不需要类的唯一实例的情况下引入了不必要的限制。[1][2][3][4]

参考资料（仅来自文章的相关参考资料）

1.  ^ 亚历克斯·米勒。[我讨厌的模式 #1：Singleton](http://tech.puredanger.com/2007/07/03/pattern-hate-singleton/)，2007 年 7 月
2.  ^ 斯科特登斯莫尔。[为什么单身人士是邪恶的](http://blogs.msdn.com/scottdensmore/archive/2004/05/25/140827.aspx)，2004 年 5 月
3.  ^ 史蒂夫·耶格。[单身人士被认为是愚蠢](http://steve.yegge.googlepages.com/singleton-considered-stupid)的，2004 年 9 月
4.  ^ JB Rainsberger，IBM。[明智地使用你的单身人士](http://www-128.ibm.com/developerworks/webservices/library/co-single.html)，2001 年 7 月

* * *

## 回答 #14

> 赞同：23
> 
> 时间：2013-05-29T02:35:49.680

我对单身人士有多糟糕的回答总是“他们很难做对”。语言的许多基础组件都是单例（类、函数、命名空间甚至运算符），计算的其他方面（本地主机、默认路由、虚拟文件系统等）中的组件也是如此，这并非偶然。虽然它们不时造成麻烦和沮丧，但它们也可以使很多事情变得更好。

我看到的两个最大的错误是：将其视为全局和未能定义 Singleton 闭包。

每个人都将 Singleton 称为全局变量，因为它们基本上是。然而，全局中的许多（可悲的是，不是全部）坏处本质上不是来自全局，而是你如何使用它。单身人士也是如此。实际上，“单实例”实际上并不一定意味着“全局可访问”。它更像是一种自然的副产品，鉴于我们所知道的所有坏事都来自于它，我们不应该这么急于利用全球可访问性。一旦程序员看到一个单例，他们似乎总是直接通过它的实例方法访问它。相反，您应该像导航任何其他对象一样导航到它。大多数代码甚至不应该知道它正在处理单例（松散耦合，对吗？）。如果只有一小部分代码像访问全局对象一样访问该对象，则可以消除很多危害。

Singleton 上下文也非常重要。单例的定义特征是“只有一个”，但事实是它在某种上下文/命名空间中“只有一个”。它们通常是以下之一：每个线程、进程、IP 地址或集群一个，但也可以是每个处理器、机器、语言命名空间/类加载器/无论、子网、Internet 等一个。

另一个不太常见的错误是忽略了单身人士的生活方式。仅仅因为只有一个并不意味着 Singleton 是某种无所不能的“一直是并且将永远是”，也不是通常可取的（没有开始和结束的对象违反了代码中的各种有用假设，并且应该只使用在最绝望的情况下。

如果你避免了这些错误，Singletons 仍然可以成为一个 PITA，它已经准备好看到许多最糟糕的问题得到显着缓解。想象一个 Java Singleton，它被明确定义为每个类加载器一次（这意味着它需要一个线程安全策略），具有定义的创建和销毁方法以及一个指示它们何时以及如何被调用的生命周期，并且其“实例”方法具有包保护，因此通常通过其他非全局对象访问它。仍然是潜在的麻烦来源，但麻烦肯定少得多。

可悲的是，而不是教如何做单例的好例子。我们教坏例子，让程序员暂时使用它们，然后告诉他们它们是一个糟糕的设计模式。

* * *

## 回答 #15

> 赞同：17
> 
> 时间：2009-11-23T09:58:11.857

[文斯休斯顿](http://www.vincehuston.org/dp/singleton.html)有这些标准，在我看来是合理的：

> 仅当满足以下所有三个条件时才应考虑单例：
> 
> *   无法合理分配单个实例的所有权
> *   延迟初始化是可取的
> *   未另外提供全球访问权限
> 
> 如果单个实例的所有权、初始化发生的时间和方式以及全局访问都不是问题，那么 Singleton 就不够有趣。

* * *

## 回答 #16

> 赞同：17
> 
> 时间：2012-08-06T01:46:05.137

并不是单例本身不好，而是 GoF 设计模式不好。唯一真正有效的论点是 GoF 设计模式不适用于测试，尤其是在并行运行测试时。

只要您在代码中应用以下方法，使用类的单个实例就是有效的构造：

1.  确保将用作单例的类实现了一个接口。这允许使用相同的接口实现存根或模拟

2.  确保 Singleton 是线程安全的。这是给定的。

3.  单例在本质上应该是简单的，而不是过于复杂。

4.  在应用程序运行时，需要将单例传递给给定对象，请使用构建该对象的类工厂，并让类工厂将单例实例传递给需要它的类。

5.  在测试期间并确保确定性行为，将单例类创建为单独的实例，作为实际类本身或实现其行为的存根/模拟并将其按原样传递给需要它的类。不要使用在测试期间创建需要单例的被测对象的类因子，因为它将传递它的单个全局实例，这违背了目的。

我们在我们的解决方案中使用了单例，并取得了很大成功，这些可测试确保并行测试运行流中的确定性行为。

* * *

## 回答 #17

> 赞同：16
> 
> 时间：2010-04-07T13:31:48.510

我想解决已接受答案中的 4 点，希望有人能解释我为什么错了。

1.  为什么在代码中隐藏依赖项不好？已经有几十个隐藏依赖（C 运行时调用、OS API 调用、全局函数调用），单例依赖很容易找到（搜索 instance()）。

    “使某些东西全局化以避免传递它是一种代码味道。” 为什么不传递一些东西以避免使其成为单例代码气味？

    如果您通过调用堆栈中的 10 个函数传递一个对象只是为了避免单例，那是不是很棒？

2.  单一职责原则：我认为这有点模糊，取决于您对职责的定义。一个相关的问题是，为什么将这种*特定*的“责任”添加到班级很重要？

3.  为什么将对象传递给类比在类中使用该对象作为单例更紧密耦合？

4.  为什么它会改变状态持续的时间？可以手动创建或销毁单例，因此控件仍然存在，并且您可以使生命周期与非单例对象的生命周期相同。

关于单元测试：

*   并非所有类都需要进行单元测试
*   并非所有需要进行单元测试的类都需要更改单例的实现
*   如果它们*确实*需要进行单元测试并且确实需要更改实现，则可以很容易地将类从使用单例更改为通过依赖注入将单例传递给它。

* * *

## 回答 #18

> 赞同：14
> 
> 时间：2011-03-06T18:02:27.880

从纯粹主义者的角度来看，单身人士是不好的。

从实用的角度来看，**单例是开发时间与复杂性的权衡**。

如果您知道您的应用程序不会发生太大变化，那么可以使用它们。只要知道如果您的需求以意想不到的方式发生变化（在大多数情况下这很好），您可能需要重构一些东西。

单例有时也会使[单元测试](https://en.wikipedia.org/wiki/Unit_testing)复杂化。

* * *

## 回答 #19

> 赞同：13
> 
> 时间：2008-09-26T06:07:41.870

假设该模式被用于模型的某些方面，它是真正单一的，那么该模式本身并没有错。

我相信这种强烈反对是由于它的过度使用，而这反过来又是因为它是最容易理解和实施的模式。

* * *

## 回答 #20

> 赞同：13
> 
> 时间：2008-09-26T06:46:29.577

我不打算评论好/坏的论点，但自从[Spring](http://en.wikipedia.org/wiki/Spring_Framework)出现以来我就没有使用过它们。使用[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)几乎消除了我对单例、服务定位器和工厂的要求。我发现这是一个更高效、更干净的环境，至少对于我所做的工作类型（基于 Java 的 Web 应用程序）而言。

* * *

## 回答 #21

> 赞同：11
> 
> 时间：2008-09-26T17:24:45.053

Singleton 是一种模式，可以像任何其他工具一样使用或滥用。

单例的坏部分通常是用户（或者我应该说不恰当地使用单例来完成它不适合做的事情）。最大的违规者是使用单例作为虚假的全局变量。

* * *

## 回答 #22

> 赞同：9
> 
> 时间：2008-09-26T06:20:10.263

当您使用单例编写代码时，例如记录器或数据库连接，然后您发现您需要多个日志或多个数据库，您就有麻烦了。

单例很难从它们转移到常规对象。

此外，编写非线程安全的单例也太容易了。

您应该将所有需要的实用程序对象从一个函数传递到另一个函数，而不是使用单例。如果将它们全部包装到一个辅助对象中，这可以简化，如下所示：

```
void some_class::some_function(parameters, service_provider& srv)
{
    srv.get<error_logger>().log("Hi there!");
    this->another_function(some_other_parameters, srv);
} 
```

* * *

## 回答 #23

> 赞同：8
> 
> 时间：2008-10-09T08:18:15.497

Chris Reath 最近在[Coding without Comments](http://www.codingwithoutcomments.com/)上发表了关于这个主题的文章。

注意：没有注释的编码不再有效。但是，链接到的文章已被其他用户克隆。

[http://geekswithblogs.net/AngelEyes/archive/2013/09/08/singleton-i-love-you-but-youre-bringing-me-down-re-uploaded.aspx](http://geekswithblogs.net/AngelEyes/archive/2013/09/08/singleton-i-love-you-but-youre-bringing-me-down-re-uploaded.aspx)

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2009-04-28T00:20:32.397

单例的问题是范围增加和[耦合](https://en.wikipedia.org/wiki/Coupling_%28computer_programming%29)问题。不可否认，在某些情况下您确实需要访问单个实例，并且可以通过其他方式完成。

我现在更喜欢围绕[控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)(IoC) 容器进行设计，并允许容器控制生命周期。这使您受益于依赖于实例的类不知道存在单个实例的事实。将来可以更改单例的生命周期。我最近遇到的一个这样的例子是从单线程到多线程的简单调整。

FWIW，如果当您尝试对其进行单元测试时它是 PIA，那么当您尝试调试、错误修复或增强它时，它就会进入 PIA。

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2008-09-26T06:55:50.490

太多人将非线程安全的对象放在单例模式中。我已经看到了以单例模式完成的 DataContext ( [LINQ to SQL](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL_.28formerly_called_DLINQ.29) ) 的示例，尽管 DataContext 不是线程安全的并且纯粹是一个工作单元对象。

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2010-06-05T10:42:47.853

单身人士还不错。只有当您制作并非全球唯一的全球独一无二的东西时，这才是糟糕的。

但是，有“应用程序范围服务”（考虑一个使组件交互的消息传递系统）——这个 CALLS 用于单例，一个“MessageQueue”——具有方法“SendMessage(...)”的类。

然后，您可以从各地执行以下操作：

MessageQueue.Current.SendMessage(new MailArrivedMessage(...));

而且，当然，做：

MessageQueue.Current.RegisterReceiver(this);

在实现 IMessageReceiver 的类中。

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2010-06-01T21:29:40.870

这是关于单身人士的另一件事，还没有人说。

在大多数情况下，“单一性”是某个类的实现细节，而不是其接口的特征。控制容器的反转可能会向类用户隐藏此特性；您只需要将您的类标记为单例（`@Singleton`例如在 Java 中使用注释），仅此而已；IoCC 将完成剩下的工作。您无需提供对单例实例的全局访问权限，因为该访问权限已由 IoCC 管理。因此，IoC Singletons 没有任何问题。

与 IoC 单例相反的 GoF 单例应该通过 getInstance() 方法在接口中暴露“单例”，因此它们会遭受上述所有内容的影响。

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2008-09-26T06:05:36.397

因为它们基本上是面向对象的全局变量，所以您通常可以以不需要它们的方式设计您的类。

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2009-04-28T01:14:39.850

首先，一个班级及其合作者应该首先完成他们的预期目的，而不是专注于依赖者。生命周期管理（当实例被创建和超出范围时）不应该是类责任的一部分。公认的最佳实践是制作或配置一个新组件以使用依赖注入来管理依赖关系。

通常，软件会变得更加复杂，因此拥有多个具有不同状态的 Singleton 类的独立实例是有意义的。在这种情况下，提交代码以简单地获取单例是错误的。对于小型简单系统，使用`Singleton.getInstance()`可能没问题，但当一个人可能需要同一类的不同实例时，它就不起作用/扩展。

不应将任何类视为单例，而应将其视为其用法的应用程序或如何使用它来配置依赖项。对于快速和讨厌的这无关紧要 - 只是卢克硬编码说文件路径无关紧要，但对于更大的应用程序，需要使用 DI 以更合适的方式分解和管理此类依赖关系。

单例在测试中引起的问题是他们硬编码的单一用例/环境的症状。测试套件和许多测试都是单独的，并且将与硬编码单例不兼容的东西分开。

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2013-11-10T12:11:47.113

单身*人士不是*邪恶的，如果你*正确地*和*最低限度地*使用它。还有很多其他好的设计模式在某些时候取代了单例的需求（并且也给出了最好的结果）。但是一些程序员没有意识到这些好的模式并且在所有情况下都使用单例，这使得单例对他们来说是邪恶的。

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2008-09-26T06:14:25.020

当几个人（或团队）得出相似或相同的解决方案时，就会出现一种模式。很多人仍然使用原始形式的单例或使用工厂模板（Alexandrescu 的 Modern C++ Design 中有很好的讨论）。并发性和管理对象生命周期的困难是主要障碍，正如您所建议的那样，前者很容易管理。

像所有选择一样，Singleton 也有其相当的起伏。我认为它们可以适度使用，特别是对于在应用程序生命周期中存活的对象。它们类似于（并且可能是）全局变量的事实大概已经引起了纯粹主义者的注意。

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2008-09-26T06:21:02.883

Singleton –[反模式！](http://accu.org/index.php/journals/337)Mark Radford (Overload Journal #57 – Oct 2003) 是一本很好的读物，解释了为什么 Singleton 被认为是一种反模式。本文还讨论了替代 Singleton 的两种替代设计方法。

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2008-10-25T06:12:59.397

作者的一些反驳：

**如果您将来需要使该类不再是单一的，那么您将被卡住**一点也不 - 我在这种情况下有一个单一的数据库连接单例，我想将它变成一个连接池。请记住，每个单例都是通过标准方法访问的：

MyClass.instance

这类似于工厂方法的签名。我所做的只是更新实例方法以从池中返回下一个连接——不需要其他更改。如果我们没有使用单例，那将更加困难。

**单例只是花哨的全局变量** 无法反驳，但所有静态字段和方法也是如此 - 从类而不是实例访问的任何内容本质上都是全局的，我没有看到对使用静态字段的太多反对？

并不是说单身人士很好，只是在这里反驳一些“传统智慧”。

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2009-07-12T07:47:55.840

这是我认为到目前为止的答案中缺少的内容：

如果每个进程地址空间都需要这个对象的一个​​实例（并且你确信这个要求不会改变），你应该让它成为一个单例。

否则，它不是单例。

这是一个非常奇怪的要求，用户几乎不会感兴趣。进程和地址空间隔离是一个实现细节。它们仅在用户想要停止使用您的应用程序`kill`或任务管理器时才会影响用户。

除了构建一个缓存系统之外，没有太多理由可以让您如此确定每个进程应该只有一个实例。日志系统怎么样？对于每个线程或更细粒度的处理可能会更好，这样您就可以更自动地跟踪消息的来源。应用程序的主窗口怎么样？这取决于; 也许您出于某种原因希望所有用户的文档都由同一进程管理，在这种情况下，该进程中将有多个“主窗口”。

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2008-09-26T06:10:34.140

它模糊了[关注点的分离](https://en.wikipedia.org/wiki/Separation_of_concerns)。

假设您有一个单例，您可以从类中的任何位置调用此实例。你的班级不再像它应该的那样纯粹。您的类现在将不再对其成员及其明确接收的成员进行操作。这会造成混乱，因为类的用户不知道类需要什么足够的信息。[封装](https://en.wikipedia.org/wiki/Encapsulation_%28object-oriented_programming%29)的整个想法是向用户隐藏方法的运行方式，但是如果在方法内部使用单例，则必须知道单例的状态才能正确使用该方法。这是反[OOP](http://en.wikipedia.org/wiki/Object-oriented_programming)的。

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2008-09-26T06:33:47.877

在我的头顶上：

1.  他们强制执行紧耦合。如果您的单例与它的用户驻留在不同的程序集上，那么如果没有包含单例的程序集，则使用程序集将无法运行。
2.  它们允许循环依赖，例如，程序集 A 可以有一个依赖于程序集 B 的单例，而程序集 B 可以使用程序集 A 的单例。所有这些都不会破坏编译器。

# postgresql - pgsql 上的 Q

> ID：137998
> 
> 赞同：0
> 
> 时间：2008-09-26T06:09:10.040
> 
> 标签：postgresql

我是 pgsql 的新手。我有几个问题：

1）我知道可以通过 访问列`<schema>.<table_name>`，但是当我尝试访问这样的列时，`<db_name>.<schema>.<table_name>`会抛出类似的错误

```
Cross-database references are not implemented 
```

我该如何实施？

2）我们有 10 多个表，其中 6 个有 2000 多行。将它们全部保存在一个数据库中是否可以？或者我应该创建数据库来维护它们？

3）从上面有超过 2000 行的问题表中，对于一个特定的过程，我需要几行数据。我创建了视图来获取这些行。例如：一张表包含员工的详细信息，它们分为 3 种类型；经理、建筑师和工程师。很明显，这张表没有得到每个进程......进程用于从中读取数据......我认为有两种获取数据的方法`SELECT * FROM emp WHERE type='manager'`，或者我可以为经理、架构师和工程师创建视图并获取数据`SELECT * FROM view_manager`

你能建议任何更好的方法来做到这一点吗？

4）视图是否也需要存储空间，就像表一样？

提前谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T05:25:39.297

1.  跨数据库在 PostGreSQL 中已经存在多年了。您必须在数据库名称前加上数据库名称（当然，有权查询它）。你会得到这样的东西：

    SELECT alias_1.col1, alias_2.col3 FROM table_1 as alias_1, database_b.table_2 as alias_2 WHERE ...

    如果您的数据库在另一个实例上，那么您将需要使用 dblink contrib。

2.  这个问题没有意义。请细化。
3.  通常，视图用于简化重复使用它们的其他查询的编写。在您的情况下，正如您所描述的那样，存储过程可能更适合您的需求。
4.  不，期待视图定义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T06:20:29.607

1：解决方法是打开与另一个数据库的连接，并且（如果使用 psql(1)）将其设置为当前连接。但是，这仅在您不尝试连接两个数据库中的表时才有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T05:19:48.750

1）这意味着它不是 Postgres 支持的功能。我不知道有什么方法可以创建在多个数据库上运行的查询。

2）这对一个数据库来说很好。单个数据库可以包含数十亿行。

3）不要费心创建视图，无论如何查询都很简单。

4）视图不需要数据库中的空间，除了它们的查询定义。*****************