# StackOverflow 问答 000288000-000288999

# sql - Oracle SQL 优化：SQL 查询耗时很长

> ID：288007
> 
> 赞同：1
> 
> 时间：2008-11-13T19:46:45.793
> 
> 标签：sql, oracle, optimization

```
SELECT DISTINCT 
    'LRS-TECH  1' || rpad(code,7) || rpad('APPTYPE',30) || 
     rpad(licensing_no,30) || rpad(' ',300) AS RECORD 
FROM APPS
WHERE L_code = '1000' AND licensing_no IS NOT NULL 
```

这似乎是我无法将这些记录导出到开发环境中的文本文件的主要原因。有什么办法可以让这个查询运行得更快。它返回大约 2000 多行文本。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T20:50:55.367

解决方案很简单。

在 (code, license_no) 上创建索引并在 (l_code, license_no) 上创建索引以更快地获取记录。稍后在应用程序中或简单地在外部包装器中执行“美化”部分，如下所示：

```
SELECT    'LRS-TECH  1'
       || RPAD (code, 7)
       || RPAD ('APPTYPE', 30)
       || RPAD (licensing_no, 30)
       || RPAD (' ', 300) AS RECORD
  FROM (SELECT DISTINCT code, licensing_no
                   FROM apps
                  WHERE l_code = '1000' AND licensing_no IS NOT NULL) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T02:27:29.543

除非您知道如何优化查询，否则您无法诊断此问题。

尝试这个：

```
explain plan for SELECT DISTINCT 
'LRS-TECH  1' || rpad(code,7) || rpad('APPTYPE',30) || 
 rpad(licensing_no,30) || rpad(' ',300) AS RECORD 
FROM APPS
WHERE L_code = '1000' AND licensing_no IS NOT NULL
/

select * from table(dbms_xplan.display)
/ 
```

现在，也试试这个……它将帮助您检测统计问题：

```
explain plan for SELECT /*+ dynamic_sampling(4) */ DISTINCT 
'LRS-TECH  1' || rpad(code,7) || rpad('APPTYPE',30) || 
 rpad(licensing_no,30) || rpad(' ',300) AS RECORD 
FROM APPS
WHERE L_code = '1000' AND licensing_no IS NOT NULL
/

select * from table(dbms_xplan.display)
/ 
```

请用这些结果更新您的原始帖子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T19:52:04.520

如果您还没有 L_code 和 license_no 列的索引，我会尝试这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T20:02:45.153

如果有许多 L_code = '1000' 的记录并且唯一的附加测试是针对 NOT NULL，那么您可能遇到了基数问题。索引很难选择是否为 NULL。

返回的行数并不重要——问题在于检查的行数。

有哪些指标？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T20:13:24.227

嗯...摆脱 DISTINCT 可能有助于考虑到代码是主键。我不认为这是导致主要处理问题的原因。如果认为 RPAD 等导致大部分查询延迟。

索引主要是 ASCEND CODE 字段。这是表上唯一相关的索引。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T10:31:13.653

我想知道这是否是因为 oracle 对来自 aspx 页面的查询使用了不同的索引（或根本不使用）。
我建议更新表格上的统计信息，看看是否有任何不同。
请参阅[此问题](https://stackoverflow.com/questions/120504/optimising-a-select-query-that-runs-slow-on-oracle-which-runs-quickly-on-sql-se#121161)以了解如何执行此操作（以及“计算统计信息”的注释已过时，取而代之的是包）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T21:07:09.813

您可以使用触发器和查询在辅助表、视图或列中预构建 RECORD 派生值，而不是在频繁查询表时即时构建它。

了解表格的大小可能会有所帮助。如果你有一个很大的列，或者有很多记录，它可能与 IO 或缓存相关。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T21:19:59.850

对于所有查看此 SQL 的人，我很抱歉，但这是一个令人难以置信的服务器问题或其他问题。这种情况似乎已经出现了，我相信这是一个关于数据库所在位置的数据可用性问题，但有人可能会给我一些见解。

在我的本地主机上，我运行代码，立即运行。我在不到一秒钟的时间内将它给我的数据从数据表导出到文本文件……完成。

在我们的开发环境中，相同的页面在旧的 ASP 中。当我们转换为 .NET 时，我们的网站有一半是在经典的 ASP 中。问题似乎在于，在 DEV 站点上，经典的 ASP 页面运行完美，速度很快，不到一秒钟就完成了。当我上传新转换的 ASPX 文件时，它在该查询上挂起大约 30 秒。

在 Localhost 上，旧的经典 ASP 挂起大约 30 秒。

所以，我有一个反之亦然的问题，因为经典的 ASP 没有挂在 DEV 站点上，而是在我的机器上，而我自己的 ASPX 页面挂在 DEV 站点上，但不在我的机器上。不同之处在于，我相信数据是从 DEV 站点上我自己的代码中提取的，而 ASP 页面是从驻留在旧 DEV 站点服务器上的代码中提取数据的，该服务器将结果移植到 DEV 站点。因此，从技术上讲，代码不是在同一台服务器上运行的。经典的 ASP 代码在我们的旧站点服务器上。

我假设两个站点之间存在某种速度问题或服务器问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-14T04:23:28.560

正如这里的大多数答案所表明的那样，您的问题听起来像是一个优化问题。您后来的回答显着改变了问题的性质。我建议将其作为新问题发布或修改原始问题以询问您真正想知道的内容。

我无法帮助您解决 ASP/ASPX 问题，但如果这是一个优化问题，我建议为新的 WHERE 子句创建一个基于函数的索引，如下所示：

```
SELECT DISTINCT 
    'LRS-TECH  1' || rpad(code,7) || rpad('APPTYPE',30) || 
     rpad(licensing_no,30) || rpad(' ',300) AS RECORD 
FROM APPS
WHERE DECODE(L_code,'1000',licensing_no,NULL) IS NOT NULL; 
```

基于函数的 DECODE(L_code,'1000',licensing_no,NULL) 索引将包括您要返回的所有记录。如果您需要更快的速度，您可以在查询结果上创建一个物化视图，但这更像是最后的努力。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-11-13T20:02:49.913

摆脱 DISTINCT。

# powerpoint - 为办公室制作时事通讯幻灯片亭的最佳方式？

> ID：288009
> 
> 赞同：2
> 
> 时间：2008-11-13T19:46:51.177
> 
> 标签：powerpoint, slideshow, kiosk

因此，我的任务是为办公室制作一个信息亭，用于显示有关我们的 SCRUM 进度、构建服务器状态、可出租性等的统计信息。理想情况下，它应该运行带有一堆不同页面的幻灯片，其中一些显示文本，一些显示图形等等。

最好的方法是什么？我首先想到了 powerpoint，但它应该能够从网络服务器获取图像，这样我就可以自动化图形生成过程。在显示“谁破坏了构建”或类似的页面时，我还想从外部来源获取文本。

我毫不怀疑现成的系统存在，但我真的不知道在哪里寻找它们。

这在PowerPoint中容易/难吗？还是有一个除了我以外的所有人都知道的无处不在的应用程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T04:08:22.147

我建议将其创建为一系列网页，它使用 Javascript 或元刷新标签来循环浏览不同的页面。只需在备用机器上全屏浏览浏览器，然后将其连接到投影仪/显示器/大电视。

这有很多好处：

*   显示来自外部服务器（标签）的图像很*简单*`<img>`
*   它无需任何设置成本（它可以在基本上任何正常运行的机器上运行），并在浏览器中运行
*   做起来很快（您不必担心跨浏览器兼容性或不同的屏幕分辨率，因为您知道您正在开发的确切机器
*   它是可扩展的——虽然您所描述的内容可能在 Powerpoint 中是可能的，但如果您将其作为网页进行，您可以使用 Javascript（或 jQuery 等 JS 框架），并且通过网络服务器提供页面非常容易，那么您可以使用任何服务器端脚本语言。

基本上，您将拥有一系列文件，`slide001.htm`例如`slide002.htm`和`slide003.htm`. 幻灯片 1 将在 30 秒后重定向到幻灯片 002，幻灯片 002 将重定向到幻灯片 003，幻灯片 003 将重定向到幻灯片 001。

您提到的具体内容：图形生成和“谁破坏了构建”文本：

不确定您使用哪种 CI 工具，但其中许多工具还是会生成图表，因此需要一张“幻灯片”，其中包含类似`<img src="http://hudson.abc/job/proj042/buildTimeGraph">`

对于谁破坏了构建文本，您最容易使用[XAMMP](http://www.apachefriends.org/en/xampp.html)`.php`将幻灯片作为通过网络服务器提供的文件运行。

然后，您将拥有一个功能，该功能可以为破坏上次构建的人刮取您的 CI 服务器，在其中一张幻灯片中，您将拥有`<?PHP echo(who_broke_build()); ?>`

（显然，如果您更了解其他语言/系统，请使用它！）

我能想到的最后一个好处是，如果你通过网络服务器提供文件，你可以允许人们在本地显示它，比如他们的浏览器主页。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T08:43:49.063

谢谢。我发现 jqS5 完成了你提到的大部分工作。

它需要 1 个文档，其中每个 h2 都成为一张新幻灯片。然后我可以使用元刷新每 10 秒重新加载到下一页。当我到达幻灯片的末尾时，我从所有不同系统的聚合 RSS 提要中提取数据，以便提取信息。

[http://staticfree.info/projects/jqs5/](http://staticfree.info/projects/jqs5/)

# excel - 如何使用 Excel 进行项目管理？

> ID：288011
> 
> 赞同：5
> 
> 时间：2008-11-13T19:47:21.910
> 
> 标签：excel, project-management, scheduling

Joel 经常谈到使用 MS Excel 进行轻量级项目管理，但我很好奇这个想法的实际实现。我见过一些模板似乎通过宏克隆 MS Project，这对于轻量级项目来说太过分了。谁有有用的模板？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T20:12:29.173

尝试

```
    功能任务估计小时数实际小时数当前百分比
    ---------- ---------- --------------- ------------ --- ------
```

如果估计小时数乘以当前百分比大于实际小时数，则您落后于计划

每天更新实际小时数和当前百分比

另请参阅[joel 的旧 excel 模板](http://www.joelonsoftware.com/articles/fog0000000245.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T20:23:03.397

可能有点离题，但您可能需要考虑测试**[Google Docs](http://docs.google.com)**。**Viewpath**在*“Insert->Widget...”*菜单选项中提供了一个甘特图小部件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T19:52:32.180

[Pipetalk Scheduler](http://pipetalk.stores.yahoo.net/frdopiexgasc.html)有一些非常先进的模板

[替代文字 http://ep.yimg.com/ip/I/pipetalk_2055_216386](http://ep.yimg.com/ip/I/pipetalk_2055_216386)

然而，因为它似乎*有点太多了*，我只是把它转移到**[最糟糕的 UI 线程](https://stackoverflow.com/questions/238177#289284)**；）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T20:00:00.183

这不是 excel，但我看到了[scrumy](https://scrumy.com/)并喜欢它的[demo](https://scrumy.com/demo)。对于最近的一个小项目，我刚刚使用“业务流程”下的“跨功能流程图”生成了一个项目计划，其中包含 Visio 中的一些流程/流程内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T05:20:13.267

爱德华·塔夫特（Edward Tufte）——在数据表示方面又名“男人”，在甘特图（[http://en.wikipedia.org/wiki/Gantt_chart](http://en.wikipedia.org/wiki/Gantt_chart)）上做了很多工作，在这个主题上有一些很好的信息，但基本上它沸腾了使用 Excel 作为甘特图创建者，优点是它简单且不会妨碍您：

[http://www.edwardtufte.com/bboard/q-and-a-fetch-msg?msg_id=000076](http://www.edwardtufte.com/bboard/q-and-a-fetch-msg?msg_id=000076)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T14:09:57.783

您可以考虑使用[Sprint Backlog](http://agilesoftwaredevelopment.com/scrum/simple-sprint-backlog)。您估计项目每项任务的时间，并每天左右更新估计的**剩余**时间。然后你有一个燃尽图，显示完成项目的剩余工作量。

如果您的项目太大而无法进行每日跟踪，您可以每周进行跟踪，或者将项目中要完成的事情的[产品积压](http://agilesoftwaredevelopment.com/scrum/simple-product-backlog)管理为粗粒度级别的计划，然后选择优先级最高的一个更细粒度的计划级别。

您可能想查看 Scrum(1) 或任何其他用于轻量级开发方法的[敏捷方法以了解更多详细信息。](http://en.wikipedia.org/wiki/Agile_software_development)

(1) [http://en.wikipedia.org/wiki/Scrum_(开发)](http://en.wikipedia.org/wiki/Scrum_(development))

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-23T16:26:07.830

如果您喜欢使用电子表格而不使用太多花哨的工具，请查看[The One Page Project Manager](http://www.onepageprojectmanager.com/) - 它与描述的完全一样，是一种在单个工作表上跟踪所有重要项目信息的好方法，轻量级。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-14T04:56:56.993

简单**得多：** [Excel 中](http://www.hyperthot.com/pm_excel_gantt.htm)的一些[**甘特图**](http://www.hyperthot.com/pm_excel_gantt.htm)，如此**[处所示](http://fr.youtube.com/watch?v=CW_wGSFavTc)**。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-11T23:02:54.607

我使用的列是

1) 任务名称 2) 预算小时数 3) 总小时数 4) 剩余小时数

关键是第 (4) 列。而不是让人们估计完成百分比；让他们从现在开始重新估计。这是一个微妙的变化，但心态却大不相同。否则，您几乎总是会卡在 90% 的完成度上。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-01-20T08:58:43.030

[这个](http://www.exinfm.com/free_spreadsheets.html)页面有很多有用的模板。此外，您可以在我们的[项目管理软件](http://xprojectmanagement.com)博客中阅读更多内容。

希望能帮助到你 ：）

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-12-27T19:04:01.520

我使用 EasyProjectPlan，这是一个与**Outlook**和**MSProject同步的****Excel 项目计划**。

 ******[www.EasyProjectPlan.com](http://www.easyprojectplan.com)**

我使用 Outlook 和日历同步功能向我的团队成员分发和收集任务信息。

我通过电子邮件将 EPP Excel 文件分发给所有团队成员，或者将其发布到共享文件夹中。

我的团队成员可以编辑 EPP excel 文件并将更改发回给我。

我工作的大多数公司都没有 PM 任务管理系统，因此 EPP 允许我进入任何项目并立即向所有团队成员分发和收集任务信息。考虑到大多数公司都使用 Excel 和 Outlook，因此无需在任何计算机上安装任何内容。

根据我的经验，团队成员更喜欢在 Excel 和 Outlook 中查看任务信息。

# ruby - 没有继承的人如何覆盖类方法并从新方法中调用原始方法？

> ID：288020
> 
> 赞同：10
> 
> 时间：2008-11-13T19:50:45.803
> 
> 标签：ruby, class, time, overriding, alias

我找到了一个像这样成功覆盖的来源`Time.strftime`：

```
class Time
  alias :old_strftime :strftime
  def strftime
    #do something
    old_strftime
  end
end 
```

麻烦的是，`strftime`是一个实例方法。我需要重写`Time.now`- 一个类方法 - 这样任何调用者都可以获得我的新方法，而新方法仍然调用原始`.now`方法。我看过`alias_method`并没有成功。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-13T20:05:03.760

有时这有点难以理解，但您需要打开“eigenclass”，它是与特定类对象关联的单例。其语法是 class << self do...end。

```
class Time
  alias :old_strftime :strftime

  def strftime
    puts "got here"
    old_strftime
  end
end

class Time
  class << self
    alias :old_now :now
    def now
      puts "got here too"
      old_now
    end
  end
end

t = Time.now
puts t.strftime 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T20:03:38.710

类方法只是方法。我强烈建议不要这样做，但是您有两个等效的选择：

```
class Time
  class << self
    alias_method :old_time_now, :now

    def now
      my_now = old_time_now
      # new code
      my_now
    end
  end
end

class << Time
  alias_method :old_time_now, :now

  def now
    my_now = old_time_now
    # new code
    my_now
  end
end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T20:10:00.863

如果您出于测试目的需要覆盖它（我通常想要覆盖 Time.now 的原因），Ruby 模拟/存根框架将为您轻松完成此操作。例如，使用 RSpec（使用 flexmock）：

```
Time.stub!(:now).and_return(Time.mktime(1970,1,1)) 
```

顺便说一句，我强烈建议通过给你的类一个可覆盖的时钟来避免存根 Time.now 的需要：

```
class Foo
  def initialize(clock=Time)
    @clock = clock
  end

  def do_something
    time = @clock.now
    # ...
  end
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-03T04:16:18.060

我一直在试图弄清楚如何使用模块覆盖实例方法。

```
module Mo
  def self.included(base)
    base.instance_eval do
      alias :old_time_now :now
      def now
        my_now = old_time_now
        puts 'overrided now'
        # new code
        my_now
      end
    end
  end
end
Time.send(:include, Mo) unless Time.include?(Mo)

> Time.now
overrided now
=> Mon Aug 02 23:12:31 -0500 2010 
```

# functional-programming - 有没有类似功能模型的东西？

> ID：288027
> 
> 赞同：5
> 
> 时间：2008-11-13T19:52:20.947
> 
> 标签：functional-programming, modeling

在面向对象的范式中，我会在开始使用 OO 语言实现它之前创建一个对象/概念模型。

函数式编程中是否有任何与对象模型平行的东西。它被称为功能模型吗？或者我们在两种范式中创建相同的概念模型，然后用其中一种语言实现它。

如果存在功能模型，是否有文章/书籍可以阅读？

或者换一种说法……即使我们使用的是函数式编程语言，我们会从对象模型开始吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-02T05:40:32.673

事实上有。有一种基于抽象数据类型的函数式语言规范，称为代数规范。它们的行为在某些方面与对象的行为非常相似，但是构造是逻辑和数学的，并且像函数构造一样是不可变的。

布宜诺斯艾利斯大学的算法和数据结构课程中使用的一种特定功能规范语言具有生成器、观察器和其他操作。生成器是一个表达式，它既是数据类型的实例又是可能的组合。例如，对于二叉树 (ADT bt)，我们有空节点和二叉节点。所以我们会有生成器：

```
-nil
-bin(left:bt, root: a, right:bt) 
```

其中left是一个bt的实例，root是一个通用值，而right是另一个bt。所以，nil 是 a bt 的有效形式，但是 bin(bin(nil,1,nil),2,nil) 也是有效的，表示一棵二叉树，根节点的值为 2，左子节点的值为值为 1，且右子节点为空。

因此，对于一个计算树中节点数的函数，您定义了 ADT 的观察者，并定义了一组映射到每个生成器的公理。因此，例如：

```
numberOfNodes(nil) == 0
numberOfNodes(bin(left,x,right))== 1 + numberOfNodes(left) + numberOfNodes(right) 
```

这具有使用操作的递归定义的优点，并且具有更正式有趣的属性，您可以使用称为结构归纳的东西来证明您的规范是正确的（是的，您证明您的算法将产生正确的结果）。

这是一个在学术界之外很少见的相当学术的话题，但值得深入了解可能会改变您对算法和数据结构的看法的程序设计。正确的参考书目包括：

> Bernot, G.、Bidoit, M. 和 Knapik, T. 1995。观测规范和不可区分性假设。理论。计算。科学。139，1-2（1995 年 3 月），275-314。DOI= [http://dx.doi.org/10.1016/0304-3975(94)00017-D](http://dx.doi.org/10.1016/0304-3975(94)00017-D)
> 
> Guttag, JV 和 Horning, JJ 1993。落叶松：正式规范的语言和工具。Springer-Verlag New York, Inc. 软件开发中的抽象和规范，Barbara Liskov 和 John Guttag，麻省理工学院出版社，1986 年。
> 
> 代数规范的基础 1\. 方程和初始语义。H. Ehrig y B. Mahr Springer-Verlag，柏林，海德堡，纽约，东京，德国，1985。

带有相应链接： [http ://www.cs.st-andrews.ac.uk/~ifs/Resources/Notes/FormalSpec/AlgebraicSpec.pdf](http://www.cs.st-andrews.ac.uk/~ifs/Resources/Notes/FormalSpec/AlgebraicSpec.pdf) [http://nms.lcs.mit.edu/larch/pub/larchBook。 ps](http://nms.lcs.mit.edu/larch/pub/larchBook.ps)

这是一个有趣的话题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T03:14:26.913

在 OO 和 FP 范式中，您形成域模型（您正在解决的问题），然后在程序中创建对象以镜像域对象。存在一些差异，因为程序对象如何反映域对象受您使用的范例和语言的影响。一些例子（在 Haskell 中）：

*   来自金融：[撰写合同](http://contracts.scheming.org/)
*   来自文字处理：[弥合算法差距](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.47.3229)
*   一个简单的网络服务器： http: [//lstephen.wordpress.com/2008/02/14/a-simple-haskell-web-server/](http://lstephen.wordpress.com/2008/02/14/a-simple-haskell-web-server/)
*   音乐：[http ://www.haskell.org/haskore/](http://www.haskell.org/haskore/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T20:03:56.120

流程图和/或过程模型/图表可以用作非 OO 程序的功能模型。但它仍然没有给出类似于 OO 模型的边界感。

[http://en.wikipedia.org/wiki/Functional_model](http://en.wikipedia.org/wiki/Functional_model)

# c++ - 随机算法

> ID：288034
> 
> 赞同：1
> 
> 时间：2008-11-13T19:53:23.300
> 
> 标签：c++, random, events

我需要一些关于随机性算法的帮助。所以问题是。

在 8 小时内将发生 50 个事件。事件可以随机发生。现在这意味着每秒发生事件的机会是 50/(8*60*60)= .001736。如何使用随机生成算法做到这一点？

我可以得到随机数

```
int r = rand();
double chance = r/RAND_MAX;
if(chance < 0.001736)
    then event happens
else
    no event 
```

但大多数时候 rand() 返回 0 和 0<0.001736 并且我得到的事件比需要的多。

有什么建议么？

* * *

抱歉，我忘了提到我计算的机会是双重机会 = (static_cast)(r) / (static_cast)(RAND_MAX);

* * *

它从 static_cast 中删除了 double

双倍机会 = (double)r/(double)(RAND_MAX);

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T19:57:04.417

`r`和都是`RAND_MAX`整数，所以表达式

```
double chance = r / RAND_MAX; 
```

用整数算术计算。尝试：

```
double chance = 1.0 * r / RAND_MAX; 
```

这将导致除法是浮点除法。

但是，更好的解决方案是使用一个随机函数，它首先返回一个浮点值。如果您使用整数随机数生成器，您的概率计算中会出现一些偏差错误。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T19:58:17.533

如果您选择是否每秒发生一个事件，您将有 0 个事件发生或 8*60*60 个事件发生的变化。如果 50 个事件是一个约束，请在 8 小时内选择 50 个随机时间并将它们存储起来。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T19:58:40.513

*   创建一个包含 50 个数字的列表。
*   用 1 到 8 * 60 * 60 之间的随机数填充它们。
*   对它们进行排序

你有50秒。

请注意，您可以有重复项。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T20:17:23.657

正好 50 个，还是平均 50 个？

您可能想查看[指数分布](http://en.wikipedia.org/wiki/Exponential_distribution)并为您的语言找到支持它的库。

指数分布将为您提供以指定平均速率随机发生的事件之间的间隔。

您可以使用统一的 RNG “伪造”它，如下所示：

```
 double u;
    do
    {
        // Get a uniformally-distributed random double between
        // zero (inclusive) and 1 (exclusive)
        u = rng.nextDouble();
    } while (u == 0d); // Reject zero, u must be +ve for this to work.
    return (-Math.log(u)) / rate; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T19:58:50.497

为什么不创建一个包含 28,800 个元素的列表并从中提取 50 个元素来确定事件发生的时间？这确实假设 2 个事件不能同时发生，并且每个事件需要 1 秒的时间。您可以使用随机数生成器生成介于 0 和 x 之间的整数值，以便可以在限制范围内进行选择。

# flash - Flash 中的 NetStream 发布者可以暂停他们的流吗？

> ID：288036
> 
> 赞同：0
> 
> 时间：2008-11-13T19:54:21.677
> 
> 标签：flash, actionscript, actionscript-2, netstream

我正在开发一个使用 Flash 8 (AS2) 和 Flash Media Server 3 的网络摄像头视频流应用程序。实时流式传输视频相当简单，但我想让发布者能够暂停他们的流，从而有效地让人们观看快照而不是实时视频。

NetStream 有一个 pause() 方法，但文档说它只适用于订阅者。有什么方法可以暂停流的发布吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T08:43:28.893

暂停：

```
 ns.attachCamera(null); 
```

恢复：

```
 ns.attachCamera(Camera.getCamera()); 
```

# c++ - 如何安全地从 C++ 中转义字符串

> ID：288038
> 
> 赞同：8
> 
> 时间：2008-11-13T19:54:38.227
> 
> 标签：c++, c, linux, shell

我正在编写一个简单的程序来浏览本地网络并使用“系统”将文件名传递给 mplayer。但是，有时文件名包含空格或引号。显然我可以编写自己的函数来转义这些，但我不确定哪些字符需要转义或不需要转义。

CRT 或 linux 头文件中是否有可用的函数来安全地转义字符串以传递给命令行？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T20:39:24.033

其他答案包括这个 fork and exec 解决方案，但我声称这是唯一正确的方法。

转义 shell 参数很容易出现错误和浪费时间，就像在存在更安全和更有效的参数绑定 API 时试图转义 SQL 参数是一个愚蠢的想法一样。

这是一个示例函数：

```
void play(const char *path)
{
    /* Fork, then exec */
    pid = fork();

    if( pid < 0 ) { 
        /* This is an error! */
        return;
    }   

    if( pid == 0 ) { 
        /* This is the child */
        freopen( "/dev/null", "r", stdin );
        freopen( "/dev/null", "w", stdout );
        freopen( "/dev/null", "w", stderr );

        execlp( "mplayer", "mplayer", path, (char *)0 );
        /* This is also an error! */
        return;
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T20:02:44.250

没有一个单一的解决方案适用于任何地方，因为不同的 shell 对特殊字符是什么以及如何解释它们有不同的想法。对于 bash，在将文件名中的每个单引号替换为`'"'"'`（第一个单引号停止序列，`"'"`将文字单引号附加到字符串，最后一个单引号开始再次引用的序列）。更好的解决方案是找到一种在不使用系统的情况下调用程序的方法，例如将 fork 与其中一个 exec 函数一起使用，这样就没有 shell 插值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T20:01:42.973

虽然我不知道执行此操作的函数，但您可以用 将每个参数括起来`'...'`，并用 替换`'`原始参数中的任何参数`'"'"'`。like `system("mplayer 'foo'\"'\"' bar'");`会给 mplayer 一个参数，它是`foo`'`bar`并且允许包含奇怪的东西，比如`"`or `\n`。`"`请注意，上面 ( )之前的转义`\"`只是为了使其有效 C++。

您应该考虑使用一个单独接受参数的函数，从而避免此类问题。Wikipedia 上有一篇关于著名的 fork-and-exec 模式的好文章。[http://en.wikipedia.org/wiki/Fork-exec](http://en.wikipedia.org/wiki/Fork-exec)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-23T21:10:53.930

现在这里是shell逃逸问题的完整解决方案。尽管这并不能回答为 shell 转义字符串的确切问题。它解决了将参数传递给程序的问题。此解决方案是一种 POSIX 可移植方式，可以使用正确传递给命令的参数来执行命令，而无需担心需要转义它们。

```
#include <cstdio>
#include <cstdlib>
#include <iostream>
#include <sstream>
#include <string>
#include <sys/stat.h>
#include <vector>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <string.h>

std::vector<std::string> split(std::string delimiter, std::string str){
    std::size_t nextPos = 0;
    std::size_t delimiterSize = delimiter.size();
    std::vector<std::string> list;
    while(true){
        std::size_t pos = str.find(delimiter, nextPos);
        std::string subStr;

        if(pos == std::string::npos){
            list.push_back(str.substr(nextPos));
            break;
        }
        subStr = str.substr(nextPos, pos - nextPos);
        list.push_back(subStr);

        nextPos = pos + delimiterSize;
    }
    return list;
}

bool isFileExecutable(const std::string &file)
{
    struct stat  st;

    if (stat(file.c_str(), &st) < 0)
        return false;
    if ((st.st_mode & S_IEXEC) != 0)
        return true;
    return false;
}

std::string ensureEndsWithSlash(std::string path){
    if(path[path.length()-1] != '/'){
        path += "/";
    }
    return path;
}
std::string findProgram(std::string name){
    // check if it's relative
    if(name.size() > 2){
        if(name[0] == '.' && name[1] == '/'){
            if(isFileExecutable(name)){
                return name;
            }
            return std::string();
        }
    }
    std::vector<std::string> pathEnv = split(":", getenv("PATH"));
    for(std::string path : pathEnv){
        path = ensureEndsWithSlash(path);
        path += name;
        if(isFileExecutable(path)){
            return path;
        }
    }
    return std::string();
}

// terminal condition
void toVector(std::vector<std::string> &vector, const std::string &str){
    vector.push_back(str);
}
template<typename ...Args>
void toVector(std::vector<std::string> &vector, const std::string &str, Args ...args){
    vector.push_back(str);
    toVector(vector, args...);
}

int waitForProcess(pid_t processId){
    if(processId == 0){
        return 0;
    }
    int status = 0;
    int exitCode = -1;
    while(waitpid(processId, &status, 0) != processId){
        // wait for it
    }
    if (WIFEXITED(status)) {
        exitCode = WEXITSTATUS(status);
    }
    return exitCode;
}

/**
    Runs the process and returns the exit code.

    You should change it so you can detect process failure
    vs this function actually failing as a process can return -1 too

    @return -1 on failure, or exit code of process.
*/
template<typename ...Args>
int mySystem(Args ...args){
    std::vector<std::string> command;
    toVector(command, args...);
    command[0] = findProgram(command[0]);
    if(command[0].empty()){
        // handle this case by returning error or something
        // maybe std::abort() with error message
        return -1;
    }
    pid_t pid = fork();
    if(pid) {
        // parent wait for child
        return waitForProcess(pid);
    }

    // we are child make a C friendly array
    // this process will be replaced so we don't care about memory
    // leaks at this point.
    std::vector<char*> c_command;
    for(int i = 0; i < command.size(); ++i){
        c_command.push_back(strdup(command[i].c_str()));
    }
    // null terminate the sequence
    c_command.push_back(nullptr);
    execvp(c_command[0], &c_command[0]);
    // just incase
    std::abort();
    return 0;
}

int main(int argc, char**argv){

    // example usage
    mySystem("echo", "hello", "world");

} 
```

# browser - Tapestry 4：资产缓存控制？

> ID：288041
> 
> 赞同：3
> 
> 时间：2008-11-13T19:55:19.163
> 
> 标签：browser, caching, tapestry

我使用 Tapestry 4，每当我们推送一个更改任何资产（图像、样式表、JS 库）的版本时，我们都会遇到问题，因为用户的浏览器缓存中仍然有旧版本的资产。我想设置一些简单的方法来允许缓存，但在我们更新应用程序时强制下载新的资产。简单地完全禁止对资产进行缓存不是一个可接受的解决方案。

我看不到执行此操作的任何现有机制，但我认为可能有某种方法可以告诉 Tapestry 将内部版本号添加到 URL，如下所示：

[http://www.test.com/path/to/the/asset/asset.jpg?12345](http://www.test.com/path/to/the/asset/asset.jpg?12345)

这样，每一个新的构建都会使它看起来像最终用户的不同资产。

Tapestry 是否提供了一种简单的方法来解决我不知道的缓存问题？如果不是，如何修改 Tapestry 生成的 URL？负责执行此操作的代码将如何获得内部版本号？（例如，我可以将内部版本号放入 Spring bean 中，但是新的 URL 构建机制将如何获取它？）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-25T05:39:02.650

这个问题纠结了很久，最终还是自己解决了。此解决方案假定您的项目中有[Tapestry-spring 库](http://howardlewisship.com/tapestry-javaforge/tapestry-spring/)。

就我而言，我有一个 Spring bean，其中包含我的应用程序的一些全局属性：

```
package myapp;

public class AppProperties {
    private String build;

    public String getBuild() {
        return build;
    }

    public void setBuild(String build) {
        this.build = build;
    }

    // other properties
} 
```

在你的 Spring 配置中声明这个 bean：

```
<bean id="appProperties" class="myapp.AppProperties">
    <property name="build" value="@BUILD_NUMBER@"/>
</bean> 
```

您可以设置您的 Ant 构建脚本以替换`@BUILD_NUMBER@`为实际数字（有关详细信息，请参阅 Ant 手册中的[Copy任务）。](http://ant.apache.org/manual/Tasks/copy.html)

现在创建一个将包装`IAsset`s 并将内部版本号附加到 URL 的类：

```
package myapp;

import java.io.InputStream;

import org.apache.hivemind.Location;
import org.apache.hivemind.Resource;
import org.apache.tapestry.IAsset;

public class BuildAwareAssetWrapper implements IAsset {
    private IAsset wrapped;
    private String build;

    public BuildAwareAssetWrapper(IAsset wrapped, String build) {
        this.wrapped = wrapped;
        this.build = build;
    }

    public String buildURL() {
        return addParam(wrapped.buildURL(), "build", build);
    }

    public InputStream getResourceAsStream() {
        return wrapped.getResourceAsStream();
    }

    public Resource getResourceLocation() {
        return wrapped.getResourceLocation();
    }

    public Location getLocation() {
        return wrapped.getLocation();
    }

    private static String addParam(String url, String name, String value) {
        if (url == null) url = "";
        char sep = url.contains("?") ? '&' : '?';
        return url + sep + name + '=' + value;
    }
} 
```

接下来，我们需要让 Tapestry 用我们的包装器包装所有资产。该类`AssetSourceImpl`负责为`IAsset`Tapestry 提供实例。我们将扩展这个类并覆盖该`findAsset()`方法，以便我们可以用包装类包装创建的资产：

```
package myapp;

import java.util.Locale;

import org.apache.hivemind.Location;
import org.apache.hivemind.Resource;
import org.apache.tapestry.IAsset;
import org.apache.tapestry.asset.AssetSourceImpl;

public class BuildAwareAssetSourceImpl extends AssetSourceImpl {
    private AppProperties props;

    @Override
    public IAsset findAsset(Resource base, String path, Locale locale, Location location) {
        IAsset asset = super.findAsset(base, path, locale, location);
        return new BuildAwareAssetWrapper(asset, props.getBuild());
    }

    public void setAppProperties(AppProperties props) {
        this.props = props;
    }
} 
```

请注意，实现有一个可以接受我们的 Spring bean 的 setter。最后一步是让 Tapestry 用于`BuildAwareAssetSourceImpl`创建资产，而不是`AssetSourceImpl`. 我们通过覆盖相应的服务点来做到这一点`hivemodule.xml`：

```
<!-- Custom asset source -->
<implementation service-id="tapestry.asset.AssetSource">
    <invoke-factory service-id="hivemind.BuilderFactory" model="singleton">
        <construct class="myapp.BuildAwareAssetSourceImpl">
            <set-object property="appProperties" value="spring:appProperties"/>
            <set-configuration property="contributions" configuration-id="tapestry.asset.AssetFactories"/>
            <set-service property="lookupAssetFactory" service-id="tapestry.asset.LookupAssetFactory"/>
            <set-service property="defaultAssetFactory" service-id="tapestry.asset.DefaultAssetFactory"/>
        </construct>
    </invoke-factory>
</implementation> 
```

就是这样。如果您运行应用程序并查看使用资产的任何页面的源代码，您将看到 URL 上将包含新`build`参数。

# android - 如何在 Android 的 ListView 中为菜单项创建图标？

> ID：288044
> 
> 赞同：25
> 
> 时间：2008-11-13T19:56:11.720
> 
> 标签：android, listview, menu, icons

我正在使用 a`ListView`来显示我的应用程序的主屏幕。
主屏幕本质上是`menu`进入应用程序的不同部分。目前，我`ListView`在方法中以编程方式添加了其内容`onCreate`。

这是执行此操作的代码片段：

```
String[] mainItems = {
    "Inbox", "Projects", "Contexts", "Next Actions"
}

@Override
public void onCreate(Bundle icicle) {
    super.onCreate(icicle);
    setContentView(R.layout.main);

    setListAdapter(new ArrayAdapter<String>(
            this, android.R.layout.simple_list_item_1, mainItems));
    registerForContextMenu(getListView());
} 
```

所以菜单本质上只是一堆节点，其中包含在 mainItems 数组中的文本。我知道我可以创建一个`R.layout.mainMenu_item`包含 ImageView 和 TextView 的 XML 布局（即），但我不确定如何设置 ImageView 的图标。我已经看到有一个 setImageResouce(int resId) 方法，但是在使用 ArrayAdapter 生成时使用它的方法让我望而却步。有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-03T22:46:12.073

我通常为 ListView 做的是通过扩展方便的 BaseAdapter 类来实现我自己的适配器。您将实现的抽象方法之一将是 getView() ，正如之前的海报所提到的。从那里您可以扩展包含 ImageView 的布局，使用 findViewById 获取对它的引用，并将图像设置为您添加到资源中的任何可绘制对象。

```
public View getView(int position, View convertView, ViewGroup parent) {

    View row = inflater.inflate(R.layout.menu_row, null);

     ImageView icon = (ImageView) row.findViewById(R.id.icon);
     icon.setImageResource(..your drawable's id...);

     return view;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T23:43:43.347

来自 ArrayAdapter 的谷歌文档。

> 要使用除 TextViews 之外的其他内容来显示数组，例如 ImageViews，或者要让 toString() 结果之外的一些数据填充视图，请覆盖 getView(int, View, ViewGroup) 以返回所需的视图类型。

# com - 获取 COM 对象的版本

> ID：288045
> 
> 赞同：1
> 
> 时间：2008-11-13T19:56:32.873
> 
> 标签：com

我正在从 C++ 访问一个 .NET COM 对象。我想知道这个 COM 对象的版本信息。当我在 OLEVIEW.exe 中打开 TLB 时，我可以看到与 coclass 关联的版本信息。如何从 C++ 访问这些信息？这是我得到的信息：

```
[
  uuid(XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX),
  version(1.0),
  custom(XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX, XXXX)
]
coclass XXXXXXXX{
    [default] interface XXXXXXXX;
    interface _Object;
    interface XXXXXXXX;
}; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T20:00:16.767

[代码项目](http://www.codeproject.com/KB/DLL/dllversion.aspx)有一个类将在运行时执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-15T21:02:08.357

基本上最后我发现我需要使用 ITypeLib 接口获取信息。所以这里是解决方案：

```
 BSTR bstrTLBNameWithPath = ""; //set this to whatever you want

  if( bstrTLBNameWithPath )
  {
    ITypeLib * pTlib = 0;
    HRESULT hr = LoadTypeLib( bstrTLBNameWithPath,&pTlib );
    if( SUCCEEDED( hr ) && pTlib )
    {
      TLIBATTR * pTlibattr = 0;
      hr = pTlib->GetLibAttr( &pTlibattr );
      if( SUCCEEDED(hr) && pTlibattr )
      { 
        //do something with the info

        //release the information
        pTlib->ReleaseTLibAttr(pTlibattr);
        pTlib->Release();
      }
    }
  } 
```

# visual-studio-2008 - 用户控件未显示在工具箱中

> ID：288047
> 
> 赞同：73
> 
> 时间：2008-11-13T19:58:12.900
> 
> 标签：visual-studio-2008, user-controls, toolbox

我有一些在 ProjectA 中创建的用户控件。我有 ProjectB，它有一个我想放置控件的 Windows 窗体。这两个项目都在一个解决方案中。ProjectB 中有对 ProjectA 的引用，因此它可以“看到”用户控件。

但是，UserControls 没有显示在工具箱中让我拖动到 Windows 窗体。

我试过重建。我还删除了“bin”目录以强制全部重建。

如何让 VS2008 用我的 UserControls 填充工具箱？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-11-13T20:12:28.177

检查此设置：

工具 > 选项 > Windows 窗体设计器 > 常规：AutoToolboxPopulate

它应该设置为 True 才能正常工作。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-11-24T20:14:17.823

1.  构建您的项目以确保它可以编译。

2.  使用您希望用户控制的表单，打开工具箱，右键单击并选择“选择项目”

3.  浏览到您在步骤 1 中编译的 .exe 或 dll。

4.  确保您的用户控件旁边有一个勾号，然后按 OK。

5.  您的用户控件应该出现在工具箱中，因此将其拖到您的表单上。

这是改编自[Calanus 对类似问题的回答](https://stackoverflow.com/questions/1116311/c-how-to-put-extended-winforms-control-on-toolbox/1116335#1116335)。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2010-07-22T03:06:46.107

在我的例子中，AutoToolboxPopulate 已经设置好了（Visual C# 2010 Express）。

但是，我必须从工具箱的属性中激活“全部显示”（右键单击）才能真正看到我的新用户控件。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-12-05T08:31:40.637

到目前为止，我没有在工具箱中显示用户控件的问题。构建项目，它就出现了。然后今天不上班了。经过搜索，我经历了以下但仍然没有快乐。

*   工具 > 选项 > Windows 窗体设计器 > 常规：AutoToolboxPopulate
*   工具 > 选项 > 文本编辑器 > XMAL > 杂项：AutoToolboxPopulate
*   将 VS 设置重置为默认值

因此，经过几个小时试图让它工作但没有成功，我创建了一个新的 WPF windows 项目，接受默认名称并添加了一个用户控件。构建项目，用户控件像往常一样出现。

然后我认为我的项目或 wpf 窗口文件可能有问题。删除了项目，创建了一个新项目并添加了一个新控件。建立了项目，但它没有工作。

我唯一不同的是为项目选择了一个名称，我在名称“WPF Application”中包含了一个空格。

再次删除该项目并再次创建一个名为“WPFApplication”的新项目，没有空格并添加了一个用户控件。构建它并显示用户控件。

**如果您希望用户控件在构建时自动显示在工具箱中，请不要在项目名称中使用空格。希望这篇文章可以节省其他人大量浪费的时间。**

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-04-03T10:36:30.777

用户控件可能不会出现在工具箱中的另一个原因是它们没有默认构造函数。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-23T08:44:07.557

还要仔细检查您的用户控件是否具有有效的命名空间。

我刚刚发现没有命名空间的控件没有放在工具箱中。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-13T20:00:36.517

通常您需要构建解决方案。这几乎总是对我有用。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-11-21T08:18:03.703

我有同样的问题。经过大量谷歌搜索后，我没有找到任何东西，但偶然我发现，如果您在创建用户控件的同一个项目中单击工具箱，然后选中“**全部显示**”，然后是一个组与您的项目同名的将出现在工具箱的顶部，您可以在其中找到您的用户控件。现在您可以在所需的表单上添加控件！

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-11-23T00:12:55.543

对于可能与之合作的人`ToolStripItems`（例如`ToolStripStatusLabel`），要真正让您的派生控件显示在下拉菜单中（例如来自 的那个`StatusStrip`），**您需要设置类`public`**然后构建解决方案。

也不要忘记你的类的设计器属性，如下所示：

```
using System.Windows.Forms.Design;

[ToolStripItemDesignerAvailability(ToolStripItemDesignerAvailability.StatusStrip)]
public class MyStatusLabel : ToolStripStatusLabel
{
} 
```

我花了一段时间才把它弄好。希望这可以节省别人的时间。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-01-10T20:36:39.853

我的控件是公开的，在“选择工具箱项”对话框中进行了检查，但仍然没有显示。

这最终对我有用：

右键单击工具箱中的某处，然后单击“选择项目”。当我找到我的物品时，它已经被检查过了。然后我取消选中该项目并单击确定。接下来我再次右键单击工具箱并搜索我的项目...它不见了，所以我单击浏览，导航到 obj/x86/debug 文件夹并选择我的 exe。然后将该项目正确添加到工具箱中。

我认为这是一个VS错误。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-02-20T07:35:24.300

除了已经给出的所有说明（工具>选项> Windows窗体设计器>常规：AutoToolboxPopulate）+您需要构建解决方案（这对我来说很明显）您可能需要注意类访问修饰符：它必须是上市。我刚刚创建了一个控件并没有出现在工具箱列表中，我不知道为什么。所以设置后

```
public class  yourClass:control {} 
```

比它出现在列表中。;) 希望这对其他人有所帮助。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-11-21T21:21:34.930

检查您的构建输出目录。如果出于某种原因，您在项目 bin\ 目录以外的地方构建输出，则您的控件将不会显示在您的工具箱中。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-07-09T16:23:33.437

这是我的问题：我为我的控件添加了一个新的构造函数，它接受了一些参数，但我没有明确地重新声明空构造函数！工具箱只能包含具有空构造函数的控件。一般来说，当你在 vb 中设计一个类时，它有一个隐式定义的空构造函数（意味着你不需要声明一个）。但是，一旦您开始设计自己的构造函数，这个空的构造函数就会消失，因此您需要在代码中明确地重新定义它！无论如何，我意识到最有经验的 vb 编码器已经知道这一切，但希望这可以帮助像我这样的新手:)。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-11-04T09:01:47.463

我通常做的是创建一个新选项卡并将 exe/dll 添加到该选项卡...由于加载时间和一般麻烦，对该解决方案不太满意。

一位朋友向我展示了一种加快速度的方法。对于您创建的每个新控件，您不必在工具箱等中单击“选择项目...” - 您可以创建一个名为的文件`MyCustomControls`，然后您可以在其中创建自定义控件。

现在您只需执行“选择项目...”并添加此文件一次。如果您稍后决定添加新控件，请在其中创建它，`MyCustomControls`然后重新构建。
然后您的工具箱将拥有您的新控件。`AutoToolboxPopulate`（如果你有我认为它会在常规编译时自动显示）

这是不幸的，因为您经常希望将类分成“每个文件一个类”。仅仅因为 VS 不想按照你的方式去做，你就不得不毁掉你的代码架构，这太可怕了。:)

我对这个解决方案也不太满意，但如果你需要快速做一些事情并且你不关心文件中的多个用户控件或者只是懒惰，这可能很适合你。:)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-05-25T21:58:12.493

以上所有方法都可能失败。

我通过创建一个新的用户控件 (TestControl) 来修复它，它触发 Visual Studio 神奇地将我的项目的控件选项卡 + 控件添加回工具箱。然后我只是删除了测试控件。

顺便说一句，这发生在我最近安装了 VS 2008 自动 Windows 更新之后。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-06-08T14:13:46.173

好吧，除了这个有用之外，没有什么对我有用...

1.  我在我的解决方案中创建了一个新项目，并且对于这个项目它有效，所以我将开始使用这个
2.  边玩边玩，我开始调整 csproj 文件的 xml，以找出我在同一解决方案中的其他项目有什么问题，然后我重置它，因为它似乎没有工作
3.  它现在又在我的项目中神奇地工作了

不是一个很好的解决方案，但您应该尝试这些步骤

1.  看看它是否适用于全新的解决方案/项目。
2.  看看它是否适用于同一解决方案中的全新项目
3.  如果 #2 工作，也许比较 .csproj 文件......不知何故我的工作在我这样做的时候又开始工作了（这非常令人沮丧）。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-06-09T19:31:23.997

如果您已经尝试过修补：

*   工具 > 选项 > Windows 窗体设计器 > 常规：AutoToolboxPopulate
*   工具 > 选项 > 文本编辑器 > XMAL > 杂项：AutoToolboxPopulate
*   创建了一个默认构造函数
*   构建您的项目/重置工具箱并手动添加您的选项卡

然而你仍然看到它是灰色的..

检查您的**路径长度**并检查**绝对路径中使用的**字符。

我有一个位于“C:\Users\myName\myCompany\R&D\Projects”的项目
，几个小时后发现**“R&D”**是问题所在。
' **&** '不允许我的用户控件项目在我的工具箱。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2012-07-03T14:56:13.450

就在几个小时前，我陷入了这个陷阱。
我有一个带有一些自定义用户控件的 .NET 2.0 Windows 应用程序项目；它工作得很好。所以我决定把我的文件放在子文件夹中，让我的项目更干净一些。
之后，Visual Studio 2010 设计器停止加载我的表单，并且 ToolBox 不再显示我的控件。
我吓坏了，将源文件移回项目根目录，重置工具箱，但似乎没有任何效果。在那之后，我记得我使用了 ReSharper “删除未使用的引用”，所以我试图**放回未使用的引用**，特别是**System.Data**：问题解决了！:O 我不能说你为什么，但这对我有用。
希望我的经验可以帮助别人。:)
再见，南多

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-03-22T07:56:33.913

如果您仍然找不到为什么您的 vstudio 工具箱没有填充您的用户控件。然后你可以用另一个 Visual Studio 调试 vstudio。[在这里你可以找到如何](http://stivodotnet.blogspot.ch/2013/03/how-to-know-why-your-visual-studio.html)。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-08-09T17:09:52.110

如果您已尝试遵循所有其他答案，但它**仍然**无法正常工作，以下为我修复了它：

*   右键单击包含控件的项目。
*   选择`Properties`。
*   在`Build`设置类别中，确保`Register for COM interop`选中。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-10-22T09:47:08.253

在我的情况下，错误的原因是我的控件的 .dll 路径的长度过长。我把它缩小了一点，一切都变得正常了。

我还发现路径中的特殊符号（例如我使用了#）会影响控件显示。

希望它能解决问题。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2016-07-14T19:16:26.513

我试图构建一个仅限 x64 的应用程序，所以我的平台目标`x64`当然设置为。

但是，即使在 2016 年，Visual Studio ( `devenv.exe`) 仍然是 32 位进程，无法加载 64 位程序集。要检查 Visual Studio 的位数，请打开任务管理器并检查`*32`进程名称。

在工具箱中查看控件的解决方法：`Any CPU`在项目设置中将平台目标设置为。如有必要，对调试和发布版本执行此操作。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-12-18T07:46:52.170

[正如这里](https://stackoverflow.com/questions/1116311/how-to-put-an-extended-winforms-control-on-toolbox/1116335#1116335)提到的，你应该告诉视觉工作室在工具箱中加载你的用户控件。

```
[ToolboxItem(true)]
public class PanelTitle : LabelControl  {
// Whatever code to override LabelControl here...
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-01-29T01:18:14.873

当我尝试将我的 UserControl 添加到工具箱（右键单击工具箱，选择项目，选择我的 DLL）时，它会显示一条消息，说明我的 DLL 中没有控件。

无论如何，通过尝试在 VS 中的 DLL 中创建一个表单并添加 UserControl，问题得到了解决。显示一条错误消息，指出没有默认构造函数

```
public UserControl() {
...
} 
```

设计者需要这个，因为它不知道什么是有效参数。一旦我向 UserControl 添加了一个空白构造函数，它就会毫无问题地添加到工具箱中。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-02-27T08:35:36.110

在您的 UserControl 中，确保将 New 声明为**Public**。如果它只是声明为 Sub New（默认为 Friend），它不会显示。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-04-01T16:57:57.017

症状 1：Form、UserControl 和 Component的**设计视图失败！**

*   我的表单设计视图因消息“找不到‘用户控件’而失败。”
*   如果我能让表单设计视图正常工作，它会非常不稳定，并且会因任何更改而彻底损坏。

**症状 2：工具箱**中的用户控件和组件

 ***   在工具箱中显示为灰色并显示乱码
*   工具箱上下文菜单中的“选择项目”显示乱码名称且没有命名空间

解决方案：在UserControl和Component后面的vb中设置范围为**Public**

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2014-05-07T10:58:01.137

检查项目路径，避免**&**，**#**等。

我已经将我的解决方案从`drive:\work\c#\folder\`to移到了`drive:\work\folder`，它解决了这个问题。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2017-01-26T18:52:22.013

在尝试添加自定义控件之前，请确保它与当前项目的 .Net 版本兼容。

我试图为 VS2008 上的 Windows CE 5.0 和 .Net Compact v3.5 项目的工具箱添加自定义控件。我做了所有以前的建议，但没有任何效果。当“显示全部”被选中时，控件显示出来，但它是灰色的，即使在“选择项目”菜单中也被选中。

我用 .Net v2.0 创建了一个新项目，它运行良好。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2013-06-12T10:03:10.063

你好，它的答案 Ctrl+Alt+X 拿这个，然后你有工具箱:)

# excel - 隐藏/显示行码速度

> ID：288054
> 
> 赞同：1
> 
> 时间：2008-11-13T19:59:31.120
> 
> 标签：excel, vba

目标：根据行中的数据有效地显示/隐藏行。

1.  创建一个帮助列来确定是否应隐藏行。
2.  让帮助列中的公式返回错误或数字。
3.  隐藏帮助列并编写代码来执行隐藏/显示。

问题：您希望以下哪种方法更快？B 列是辅助列，并且始终是连续的。

```
 Sub SetRowVisibility1()

  Dim rowsToCheck As Range
  With ActiveSheet
    Set rowsToCheck = .Range(Range("B7"), Range("B7").End(xlDown))
  End With

  Dim needToShow As Range, needToShow_Showing As Range
  Dim needToHide As Range, needToHide_Showing As Range

  Set needToShow = rowsToCheck.SpecialCells(xlCellTypeFormulas, xlNumbers)
  Set needToHide = rowsToCheck.SpecialCells(xlCellTypeFormulas, xlErrors)

  On Error Resume Next
  Set needToShow_Showing = needToShow.Offset(0, 1).SpecialCells(xlCellTypeVisible)
  Set needToHide_Showing = needToHide.Offset(0, 1).SpecialCells(xlCellTypeVisible)
  On Error GoTo 0

  If Not needToHide_Showing Is Nothing Then
    needToHide_Showing.EntireRow.Hidden = True
  End If
  If Not needToShow Is Nothing Then
    If needToShow.Count <> needToShow_Showing.Count Then
      needToShow.EntireRow.Hidden = False
    End If
  End If

End Sub

Sub SetRowVisibility2()

  Dim rowsToCheck As Range
  With ActiveSheet
    Set rowsToCheck = .Range(Range("B7"), Range("B7").End(xlDown))
  End With

  Dim needToShow As Range, needToHide As Range
  Dim cell As Range
  For Each cell In rowsToCheck

    If IsError(cell.Value) And (cell.EntireRow.Hidden = False) Then
      If needToHide Is Nothing Then
        Set needToHide = cell
      Else
        Set needToHide = Union(needToHide, cell)
      End If
    End If

    If Not IsError(cell.Value) And (cell.EntireRow.Hidden = True) Then
      If needToShow Is Nothing Then
        Set needToShow = cell
      Else
        Set needToShow = Union(needToShow, cell)
      End If
    End If

  Next cell

  If Not needToHide Is Nothing Then needToHide.EntireRow.Hidden = True
  If Not needToShow Is Nothing Then needToShow.EntireRow.Hidden = False

End Sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T01:28:46.523

还有一种不同的方法，那就是使用自动过滤器功能 - 毕竟 VBA 中有一个 A - 尽可能使用应用程序的功能，所以这段代码非常简短和甜蜜 - 假设数据是连续的在 a 和 b 列中阻塞，并假设没有其他错误处理在起作用。resume 下一行允许过滤器已经打开。

```
子显示HideRange()
昏暗的测试范围
    testrange = Range("A1").CurrentRegion.Address
    出错时继续下一步
    testrange.AutoFilter
    ActiveSheet.Range(testrange).AutoFilter Field:=2, Criteria1:="show"
结束子

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-03T15:53:22.080

如果您不希望向用户显示正在发生的事情，在 VBA 本身而不是在隐藏列中执行计算不是更好吗？当然，这似乎将您锁定在选项 2 中，我怀疑这是较慢的选项......我的大部分 VBA 经验都是在旧版本的 Excel 中，所以我没有使用一些新功能的乐趣，我所做的涉及处理数据行的任务是逐行完成的。

我想第一个 sub 的一个可能问题是，如果工作表或您用于确定隐藏/显示的值有问题，则该过程将失败。如果您逐行检查并且有一行导致问题，您可以跳过该行并正确处理其他行。

# asp.net - 在 asp.net 中为 GridView SqlDataSource 动态构建 SelectCommand

> ID：288057
> 
> 赞同：3
> 
> 时间：2008-11-13T19:59:44.270
> 
> 标签：asp.net, sql, gridview, select, sqldatasource

我正在使用一个 GridView，它使用如下所示的 SqlDataSource 元素：

```
 <asp:SqlDataSource ID="InventoryDB" runat="server" ConnectionString="<%$ ConnectionStrings:InventoryConnectionString %>"
            SelectCommand="SELECT [Server], [Customer] FROM [Website] WHERE [Owner] = 'someOwner'">
        </asp:SqlDataSource> 
```

我想用动态的东西替换 where 子句的 'someOwner' 部分，如下所示：

```
SelectCommand="SELECT [Server], [Customer] FROM [Website] WHERE [Owner] = '<%# UserManager.getCurrentUser(Request) %>'" 
```

但是当我这样做时，它似乎使用 WHERE 子句的文字而不是评估我的函数调用，这当然不起作用。这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T20:24:24.423

处理这个问题的正确方法是使用参数。关于它的[MSDN 文档](http://msdn.microsoft.com/en-us/library/z72eefad(VS.80).aspx)非常详尽地展示了如何使用它们。

[具有数据源控件的用户参数](http://msdn.microsoft.com/en-us/library/xt50s8kz.aspx)有一些关于使用参数的更详细和易于访问的信息。

# asp.net - ASP.net 表单/DropDownList 帮助

> ID：288059
> 
> 赞同：0
> 
> 时间：2008-11-13T19:59:55.223
> 
> 标签：asp.net

我创建了 2 个绑定到 SQL DB 的下拉列表，然后拉起 GridView。但是，更具体地说，有没有办法让 3 个用户选择框，然后显示 Gridview？我想有一种快速有效的方法来做到这一点而不会出现问题。我使用自动回发创建了前 2 个 DDL，但无法正常工作。有什么建议么？

```
 <asp:Label ID="CustomerNumberLabel" runat="server" Text="Customer Number " Width="125px"></asp:Label>
    <asp:DropDownList ID="CustomerNumber" runat="server" AutoPostBack="True" 
        DataSourceID="ADDRDataSource" DataTextField="SACSNO" 
        DataValueField="SACSNO" AppendDataBoundItems="True">
        <asp:ListItem Text="Select a Customer" Value="" Selected="True" />
    </asp:DropDownList><br />
    <asp:SqlDataSource ID="ADDRDataSource" runat="server" 
        ConnectionString="<%$ ConnectionStrings:iSeriesHistoryConnectionString %>" 
        SelectCommand="SELECT [SACSNO] FROM [ADDR] WHERE ([SARP#1] = @column1)">
        <SelectParameters>
            <asp:SessionParameter Name="column1" SessionField="userName" Type="Decimal" />
        </SelectParameters>
    </asp:SqlDataSource>
     <asp:Label ID="ShipToNumberLabel" runat="server" Text="Ship-to Location " Width="125px"></asp:Label>   
    <asp:DropDownList ID="ShipToNumber" runat="server" 
        DataSourceID="ADDRShipToNumberDataSource" DataTextField="SASHNM" 
        DataValueField="SASHNM" AutoPostBack="True">
        <asp:ListItem Text="Select Ship-To Location" Value="" Selected="True" />
    </asp:DropDownList>
    <asp:SqlDataSource ID="ADDRShipToNumberDataSource" runat="server" 
        ConnectionString="<%$ ConnectionStrings:iSeriesHistoryConnectionString %>" 
        SelectCommand="SELECT [SASHNM], [SASAD1], [SASAD2], [SASCTY], [SACSNO], [SASHST], [SASZIP] FROM [ADDR] WHERE ([SACSNO] = @SACSNO)">
        <SelectParameters>
            <asp:ControlParameter ControlID="CustomerNumber" Name="SACSNO" 
                PropertyName="SelectedValue" Type="Decimal" />
        </SelectParameters>
    </asp:SqlDataSource>
   <br /><br />
    <asp:FormView ID="FormView1" runat="server" 
        DataSourceID="ADDRShippingDataSource" Width="400px">
        <EditItemTemplate>
            SACSNO:
            <asp:TextBox ID="SACSNOTextBox" runat="server" Text='<%# Bind("SACSNO") %>' />
            <br />
            SASHNM:
            <asp:TextBox ID="SASHNMTextBox" runat="server" Text='<%# Bind("SASHNM") %>' />
            <br />
            SASAD1:
            <asp:TextBox ID="SASAD1TextBox" runat="server" Text='<%# Bind("SASAD1") %>' />
            <br />
            SASAD2:
            <asp:TextBox ID="SASAD2TextBox" runat="server" Text='<%# Bind("SASAD2") %>' />
            <br />
            SASCTY:
            <asp:TextBox ID="SASCTYTextBox" runat="server" Text='<%# Bind("SASCTY") %>' />
            <br />
            SASHST:
            <asp:TextBox ID="SASHSTTextBox" runat="server" Text='<%# Bind("SASHST") %>' />
            <br />
            SASZIP:
            <asp:TextBox ID="SASZIPTextBox" runat="server" Text='<%# Bind("SASZIP") %>' />
            <br />
            <asp:LinkButton ID="UpdateButton" runat="server" CausesValidation="True" 
                CommandName="Update" Text="Update" />
            &nbsp;<asp:LinkButton ID="UpdateCancelButton" runat="server" 
                CausesValidation="False" CommandName="Cancel" Text="Cancel" />
        </EditItemTemplate>
        <InsertItemTemplate>
            SACSNO:
            <asp:TextBox ID="SACSNOTextBox" runat="server" Text='<%# Bind("SACSNO") %>' />
            <br />
            SASHNM:
            <asp:TextBox ID="SASHNMTextBox" runat="server" Text='<%# Bind("SASHNM") %>' />
            <br />
            SASAD1:
            <asp:TextBox ID="SASAD1TextBox" runat="server" Text='<%# Bind("SASAD1") %>' />
            <br />
            SASAD2:
            <asp:TextBox ID="SASAD2TextBox" runat="server" Text='<%# Bind("SASAD2") %>' />
            <br />
            SASCTY:
            <asp:TextBox ID="SASCTYTextBox" runat="server" Text='<%# Bind("SASCTY") %>' />
            <br />
            SASHST:
            <asp:TextBox ID="SASHSTTextBox" runat="server" Text='<%# Bind("SASHST") %>' />
            <br />
            SASZIP:
            <asp:TextBox ID="SASZIPTextBox" runat="server" Text='<%# Bind("SASZIP") %>' />
            <br />
            <asp:LinkButton ID="InsertButton" runat="server" CausesValidation="True" 
                CommandName="Insert" Text="Insert" />
            &nbsp;<asp:LinkButton ID="InsertCancelButton" runat="server" 
                CausesValidation="False" CommandName="Cancel" Text="Cancel" />
        </InsertItemTemplate>
        <ItemTemplate>
            Customer Detail<br />
            <br />
            <table class="style1" width="35px">
                <tr>
                    <td class="style2" align="center" >
                        Address Line 1</td>
                    <td class="style3" align="center" >
                        <asp:Label ID="SASAD1Label" runat="server" Text='<%# Bind("SASAD1") %>' />
                    </td>
                </tr>
                <tr>
                    <td class="style2" align="center" >
                        Address Line 2</td>
                    <td class="style3" align="center" >
                        <asp:Label ID="SASAD2Label" runat="server" Text='<%# Bind("SASAD2") %>' />
                    </td>
                </tr>
                <tr>
                    <td class="style2" align="center">
                        City</td>
                    <td class="style3" align="center" >
                        <asp:Label ID="SASCTYLabel" runat="server" Text='<%# Bind("SASCTY") %>' />
                    </td>
                </tr>
                <tr>
                    <td align="center" class="style2">
                        State</td>
                    <td class="style3" align="center" >
                        <asp:Label ID="SASHSTLabel" runat="server" Text='<%# Bind("SASHST") %>' />
                    </td>
                </tr>
                <tr>
                    <td align="center" class="style2">
                        Zip</td>
                    <td class="style3" align="center" >
                        <asp:Label ID="SASZIPLabel" runat="server" Text='<%# Bind("SASZIP") %>' />
                    </td>
                </tr>
            </table>
            <br />
        </ItemTemplate>
    </asp:FormView>
    <asp:SqlDataSource ID="ADDRShippingDataSource" runat="server" 
        ConnectionString="<%$ ConnectionStrings:iSeriesHistoryConnectionString %>" 
        SelectCommand="SELECT [SACSNO], [SASHNM], [SASAD1], [SASAD2], [SASCTY], [SASHST], [SASZIP] FROM [ADDR] WHERE ([SASHNM] = @SASHNM)">
        <SelectParameters>
            <asp:ControlParameter ControlID="ShipToNumber" Name="SASHNM" 
                PropertyName="SelectedValue" Type="String" />
        </SelectParameters>
    </asp:SqlDataSource> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T20:16:25.970

您可以为所有 DropDownLists 关闭 AutoPostBack，并在 Lookup Button_Click 事件中添加一个名为 Lookup 的按钮，如下所示：

```
ADDRShippingDataSource.SelectParameters.Clear()

If ShipToNumber.SelectedValue <> "" Then
    ADDRShippingDataSource.SelectParameters.Add("SASHNM", ShipToNumber.SelectedValue)
End If

If CustomerNumber.SelectedValue <> "" Then
    ADDRShippingDataSource.SelectParameters.Add("SACSNO", CustomerNumber.SelectedValue)
End If

ADDRShippingDataSource.DataBind() 
```

您的选择命令需要更新以在您的数据源中包含其他条件：

```
SELECT [SACSNO], [SASHNM], [SASAD1], [SASAD2], [SASCTY], [SASHST], [SASZIP] FROM [ADDR] WHERE (@SASHNM IS NULL OR [SASHNM] = @SASHNM) OR (@SACSNO IS NULL OR [SACSNO] = @SACSNO) 
```

# compiler-construction - 是否存在任何具有本地化编程语言版本的编译器？

> ID：288061
> 
> 赞同：5
> 
> 时间：2008-11-13T20:00:11.993
> 
> 标签：compiler-construction, programming-languages

我经常想知道为什么非英语程序员在编程时被迫使用不同的语言，而提供一个可以用本地化版本替换关键字的 IDE 似乎很容易。为什么德国人不能使用“während..macht”循环？

日本、德国、法国、西班牙、博茨瓦纳的程序员是否只是广泛使用宏/定义语句来让生活更容易忍受，还是他们只是习惯了 print 的功能意义，if, then, while, do, begin, end , var, double, 函数等？

也许越来越多地使用框架（J2EE/.NET）使这变得更加复杂，但似乎仍然值得。另一方面，如果克林贡语成为美国事实上的编程语言，我可能会后悔提出这个建议。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-13T20:06:04.600

在大多数编程语言中，关键字是保留的，因此它们不能用于变量名等。

现在假设每次更改文化时关键字都会更改 - 以一种文化编写的代码无法在不更改标识符的情况下移植到另一种文化。伊克。此外，当任何人将他们的代码复制到这样的问题论坛上时，我们将不再使用同一种语言。

在编程语言本身中只有一种文化有明显的优势......

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-13T20:11:47.180

这种事情并不是计算机语言所独有的。音乐的所有控制词都是意大利语（andante、allegro、crescendo 等）。这在很长一段时间内运作良好。

此外，它允许更轻松地共享程序。假设您试图将芬兰程序员的功能集成到法语模块中，并希望将其发送给您的澳大利亚同事以进一步集成。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T20:58:06.853

Office 的法语（以及 IIRC、德语和其他一些语言）版本曾经具有 VBA 的本地化版本。

他们成功了，因为这是一个非常糟糕的主意！对于普通用户来说，偶尔使用宏是可以的，但是一旦你开始在互联网上搜索信息，想要分享你的代码等，那就是一场噩梦。更不用说在西班牙语 Excel 中打开法语工作表......（虽然我想他们保存的是字节码，而不是文字 - 所以说运行在法语 Excel 上某处复制的德语宏）。

VB（以及其他一些语言，如 Lua）允许使用带有重音符号等的标识符。我记得我很久以前就大量使用过。现在看起来很奇怪，而且再一次地，共享代码变得非常困难。
同样，当我看到带有西班牙语或中文注释的代码时，我会感到不安……

根据记录，在 8 位计算机时代，一台法国计算机 (TO8) 有一个法语版本的 Basic：我们有 FAIRE ... JUSQUA（或类似的东西）而不是 WHILE ... WEND。

无论如何，这种本地化的计算机语言现在相当稀缺……无论好坏，英语都是计算机科学的*通用语*。至少它不是最难学的语言。而且大多数语言的词汇量（至少是关键字集）非常有限。

唯一的问题是当我们试图向不懂英语的年轻人教授编程时，他们学得很快。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T20:09:20.133

不！永远不要为您的来源使用“本地化”。英语是编程的事实标准，它有很大帮助，让这个世界变得更好一点。

代码应该对每个人都是可移植和可理解的（如果可能的话），本地化会消除这种可能性。

我会说俄语、意大利语和一点点英语，但我在工作中使用过除英语以外的其他任何东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-13T20:12:09.253

法国有一种开发语言叫做[WinDev](http://www.windev.com/)，其中所有的代码都是完全法语本地化的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T20:17:38.133

在旧的（非常旧的）Word 版本中，您将在 WordBasic 中编写宏。WordBasic 已本地化。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-18T22:04:24.577

本身不是一种编程语言，但 Microsoft Excel 以其函数名称本地化而闻名。幸运的是，打开不同语言版本的 Excel 工作表不会破坏您的公式，因为它们已被翻译。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-19T21:07:24.850

在某些情况下，关键字甚至不是英文的（尽管它们可能有点像英文单词）：来自 Lisp 的**car**、**cdr**和**cons ；****Perl 中的elsif**；**printf**、**fgets**、**sscanf**以及来自 C 的更多内容。我认为大多数语言至少有一些关键字没有本地化，即使对于说英语的人也是如此。

关键字属于编程语言，而不是程序员的（口语）语言。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-19T21:19:47.023

当我第一次做本地化的 Applescript 时，不知道它是否仍然正确。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-02-01T10:59:02.363

还有 Citrine ( [https://citrine-lang.org/](https://citrine-lang.org/) ) 支持多种语言，包括荷兰语和印地语。该项目旨在支持地球上的每种语言，以获得完整的本地化编程体验。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-13T20:13:39.233

这与空中交通管制相同。它在英语中已经非常标准化了。虽然如果您的母语不是英语，这可能会使飞行稍微困难一些，但学习完成工作所需的特定英语子集并不太难……但是您能想象如果飞行员可以尝试并尝试会发生什么对控制器说他们最熟悉的任何语言......控制器可以用他们最喜欢的任何语言做出回应？我当然不会再飞国际了:)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-14T02:17:25.507

不，而且真的不可能。例如，如果您使用 C 编译器并将关键字本地化为另一种语言，您将拥有一种完全可行的编程语言，但根据定义，它不再是 C 编译器。

C 中可能有类似`if`and的关键字`for`，它们显然是从英文衍生而来的，但它们不是英文关键字，它们是 C 关键字。

话虽如此，我经常想知道为什么我们没有看到基于其他人类语言的编程语言。他们只是不那么出名吗？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-18T22:08:42.573

如果没有几种语言的开放版本的中文本地化克隆，我会感到惊讶。特别是 gcc/g++。它们足够大，周围有自己的生态系统，如果中文和英文标识符之间有任何冲突，你真的不会有太多。

考虑到中文书面语言与西方语言有如此根本的不同，如果没有一种纯中文没有西方语言可以利用这些差异，我会更加惊讶。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-18T22:18:58.637

创建 Lua 的巴西人使用 if 和 while 等英文关键字。从事 ML 工作的法国人也使用英语关键字。Stroustrup、Guido 和 Linus 都来自非英语国家（尽管我相信他们都在年轻时学习过英语）。你不能忘记 Matz 在 Ruby 上的工作。

我不想变得势利，但英语是程序员最接近通用语的东西。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-20T18:40:54.427

当我还是个孩子的时候，有一个希伯来语版本的 Logo 编程语言（解释）。我隐约记得使用相同语言的仿 BASIC。

但是这些使用起来很糟糕，因为字母是 RTL 写的，数字和符号是 LTR 写的，而基于 ASCII 的旧 PC/Apple 无法真正处理这种殴打。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-21T14:31:50.357

我祈祷我见过用 MS Visual Basic 5 或 6 编写的带有俄语关键字的程序！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-22T05:41:06.153

在韩国，

c 编译器变体，使用韩语“Hangul”。

[http://book.daum.net/detail/book.do?bookid=KOR2003872000039](http://book.daum.net/detail/book.do?bookid=KOR2003872000039)

视觉基本风格工具

[http://cugz.sjworks.net//ver2/about_create.html](http://cugz.sjworks.net//ver2/about_create.html)

[![http://cugz.sjworks.net//ver2/images/create_intro.jpg](https://i.stack.imgur.com/q73jk.jpg)](https://i.stack.imgur.com/q73jk.jpg)
[（来源：[sjworks.net](http://cugz.sjworks.net//ver2/images/create_intro.jpg)）]

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-04-18T22:51:15.397

我找到了一个！

[Lexico.NET：Lexico](http://en.wikipedia.org/wiki/Lexico)是一种基于 .NET Framework 的西班牙语面向对象的教育编程语言。

此外，维基百科有一整页[列出更多](https://en.wikipedia.org/wiki/Non-English-based_programming_languages)。

# c - 标准输入上的 close/fclose 是否保证正确？

> ID：288062
> 
> 赞同：10
> 
> 时间：2008-11-13T20:00:13.443
> 
> 标签：c, stdio

似乎以下调用符合您的预期（关闭流并且不允许任何进一步的输入 - 任何等待流上输入的内容都会返回错误），但它是否保证在所有编译器/平台上都是正确的？

```
close(fileno(stdin));
fclose(stdin); 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2011-05-08T04:23:22.390

`fclose(stdin)`导致任何进一步使用`stdin`（隐式或显式）调用未定义的行为，这是一件**非常糟糕的事情**。它不会“禁止输入”。

`close(fileno(stdin))``stdin`在当前缓冲区耗尽后，导致任何进一步尝试从 输入失败`EBADF`，但仅在您打开另一个文件之前，在这种情况下，该文件将变为 fd #0 并且**会发生坏事**。

更稳健的方法可能是：

```
int fd = open("/dev/null", O_WRONLY);
dup2(fd, 0);
close(fd); 
```

增加了一些错误检查。这将确保所有读取（在当前缓冲区耗尽后）都会导致错误。如果您只是希望它们导致 EOF，而不是错误，请使用`O_RDONLY`而不是`O_WRONLY`.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-13T20:05:23.247

不要关闭 fileno(FILE*)。FILE 是一个缓冲对象。调查其实施并干预其状态会带来所有其他软件模块上类似不当行为的警告和危险。

不要这样做。

啊。严重地。讨厌。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T20:08:25.703

在所有可能的操作系统中，没有任何东西可以保证正确。但是，调用 fclose(stdin) 将适用于任何符合 POSIX 的操作系统以及 Windows 操作系统，因此您现在应该使用几乎所有通用的东西。

正如前面的答案以及我的评论所述，无需在文件句柄上调用 close 。fclose() 将为您正确关闭所有内容。

# .net - 本地化异常的建议

> ID：288068
> 
> 赞同：0
> 
> 时间：2008-11-13T20:01:44.843
> 
> 标签：.net, vb.net, exception, localization

我需要为我的应用程序抛出的异常添加本地化，​​因为很多都是 ApplicationExceptions 并处理并记录到错误报告中。理想情况下，我想创建一个新的异常，继承自 ApplicationException，我可以将资源键和参数传递给它，以便可以从资源信息中构建异常消息。不幸的是（我认为）在异常中设置消息的唯一方法是在 New()...

我想要类似的东西：

```
public class LocalizedException
    Inherits ApplicationException  

public Sub New(ResourceKey as string, arg0 as Object)
    MyBase.New()
    ' get the localized text'  
    Dim ResMan as New Global.System.Resources.ResourceManager("AppName.ExceptionResources", _
    System.Reflection.Assembly.GetExecutingAssembly)
    Dim LocalText as string = ResMan.GetString(ResourceKey)
    Dim ErrorText as String = ""
    Try
        Dim ErrorText = String.Format(LocalText, arg0)
    Catch
        ErrorText = LocalText + arg0.ToString() ' in case String.Format fails'
    End Try
    ' cannot now set the exception message!'
End Sub
End Class 
```

但是我只能将 MyBase.New() 作为第一行 Message 是 ReadOnly

有人对如何将本地化字符串放入异常处理程序有任何建议吗？我将在一些不同的异常中需要它，尽管可以采用获取本地化字符串并创建异常的异常创建函数的方式，尽管堆栈信息将是错误的。我也不希望在 Throw 之前的主体内容过多，因为它显然开始影响流程的可读性。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T20:17:05.343

这是我所做的一个示例。EmillException 继承自 ApplicationException。

```
 namespace eMill.Model.Exceptions
{
    public sealed class AccountNotFoundException : EmillException
    {
        private readonly string _accountName;

        public AccountNotFoundException(string accountName)
        {
            _accountName = accountName;
        }

        public override string Message
        {
            get { return string.Format(Resource.GetString("ErrAccountNotFoundFmt"), _accountName); }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T14:26:25.453

看看这个：

[http://visualstudiomagazine.com/features/article.aspx?editorialsid=2562](http://visualstudiomagazine.com/features/article.aspx?editorialsid=2562)

我不必处理本地化问题，但这很有意义。

# wcf - 在带有 WCF 的 App.config 中使用 Windows 角色身份验证

> ID：288070
> 
> 赞同：7
> 
> 时间：2008-11-13T20:02:14.547
> 
> 标签：wcf, app-config, windows-authentication

我正在使用 WCF 服务和 net.tcp 端点，并将 serviceAuthentication 的主体 PermissionMode 设置为 UseWindowsGroups。

目前在服务的实现中，我使用 PrincipalPermission 属性来设置每个方法的角色要求。

```
 [PrincipalPermission(SecurityAction.Demand, Role = "Administrators")]
        [OperationBehavior(Impersonation = ImpersonationOption.Required)]
        public string method1() 
```

我正在尝试做几乎完全相同的事情，除了在 app.config 中设置角色的配置。有什么方法可以做到这一点并且仍然使用 Windows 组身份验证？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-14T10:21:12.723

如果您在 IIS 中托管 WCF 服务，它将在 ASP.NET 工作进程中运行，这意味着您可以像使用 ASMX Web 服务一样配置身份验证和授权：

```
<system.Web>
    <authentication mode="Windows"/>
    <authorization>
        <allow roles=".\Administrators"/>
        <deny users="*"/>
    </authorization>
</system.Web> 
```

然后，您必须在 IIS 中禁用对端点的匿名访问，而是启用 **Windows 集成身份验证**。
在 IIS 管理控制台中，您可以通过为您的虚拟目录打开“*属性”对话框来执行此操作。*然后，您将在“*目录安全*”选项卡中找到安全设置。

当然，唯一可用的通信通道是 HTTP。客户端必须使用以下设置在*传输级别*的请求中提供其 Windows 身份：

```
<system.serviceModel>
    <bindings>
        <wsHttpBinding>
            <binding name="WindowsSecurity">
                <security mode="Transport">
                    <transport clientCredentialType="Windows" />
                </security>
            </binding>
        </wsHttpBinding>
    </bindings>
    <client>
        <endpoint address="https://localhost/myservice"
                  binding="wsHttpBinding"
                  bindingConfiguration="WindowsSecurity"
                  contract="IMyService" />
     </client>
</system.serviceModel> 
```

请注意，如果您的服务端点使用**wsHttpBinding**，那么您还必须将 SSL 添加到您的端点，因为这是 WCF 在您使用传输级安全性时强制执行的要求。
如果改为使用**basicHttpBinding**，则可以使用 WCF 中一种*安全性较低*的身份验证模式，称为**TransportCredentialOnly**，不再需要 SSL。

有关更多详细信息，[这里](http://www.code-magazine.com/articleprint.aspx?quickid=0611051)是 WCF 中安全基础结构的一个很好的概述。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-15T07:50:01.123

Lars Wilhelmsen 发布了解决此问题的方法。看看 [http://www.larswilhelmsen.com/2008/12/17/configurable-principalpermission-attribute/](http://www.larswilhelmsen.com/2008/12/17/configurable-principalpermission-attribute/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T23:32:56.197

如果我理解得很好，您想在运行时选择角色。这可以通过WCF 操作中的[权限要求来完成。](http://msdn.microsoft.com/en-us/library/system.security.permissions.principalpermission.aspx)例如

```
public string method1()
{
    PrincipalPermission p = new PrincipalPermission(null, "Administrators");
    p.Demand();
    ... 
```

# groovy - Groovy 相对于 Jython 或 Jruby 的优势？

> ID：288074
> 
> 赞同：34
> 
> 时间：2008-11-13T20:02:54.280
> 
> 标签：groovy, jruby, jython, jvm-languages, language-comparisons

当我可以使用 Jython 或 Jruby 时，为什么还要选择使用 Groovy？该语言是否提供任何固有优势来弥补 Jython 和 Jruby 技能适用于 JVM 之外的母语这一事实？

请记住，我故意让这个问题保持通用性，但如果在特定领域存在任何优势，请毫不犹豫地描述它们。

**编辑**
澄清一下，如果我在 Jruby 中编写一些代码，我现在可以在某些情况下，如果需要，将代码移到 JVM 之外，或者至少我对 Ruby 有了更好的理解。而 Groovy 技能仅在使用仅存在于 JVM 中的语言时才适用。Jython 和 Jruby 有这个内置的优势，Groovy 必须用什么来弥补这个劣势？

如果 Groovy 没有您发现的任何优势，并且您建议只使用 Jython 或 Jruby，请告诉我。

**编辑 2**
感谢大家的所有答案，他们中的大多数人都提出了相同的观点，Groovy 与 Java 的集成略好于 Jython 或 Jruby。

**跟进**
使用 Netbeans 6.5 作为我的 IDE 我发现 Groovy 与 Java 项目的集成比 Jruby 更好。我不确定缺乏集成是否是 Jruby 或 Netbeans 的失败。但是在将它用于一点 Groovy 之后，肯定似乎有了优势。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-14T04:45:49.437

我在 Ruby 和 Groovy 中进行了相当广泛的开发（以及使用 Grinder 作为负载测试工具的小 Jython）。

在这 3 个中，我最喜欢 Groovy。我最喜欢闭包语法，并且我认为它与 JVM 上的其他 java 类的工作方式具有最紧密的集成。自从我上次使用 JRuby 已经有一段时间了，但是在 JRuby 中导入 Java 类和使用类加载器对我来说并没有那么干净。

Groovy 本质上也是 Java 的超集这一事实意味着，大量的 Java 程序员将有更快的时间来选择 Groovy，而不是 Ruby/JRuby。他们可以像 Java 一样开始对其进行编程，并在他们拿起它时慢慢开始插入 idomatic groovy。

更重要的是，我认为 Groovy 的另一个优点是，当您想要优化某些东西时，您使用的语言几乎是完全相同的语法，它是 Java。如果您在 Ruby 或 Python 世界中工作，您将不得不使用 C（这是一个巨大的转变）或 Java（这也与这些语言完全不同）。使用 Groovy 进行编程也有助于保持您的 Java 技能有些敏锐。

如果您对 Ruby 或 Python 基础架构有特定的访问权限，或者您的团队熟悉此类环境，那么我可以选择其中一种其他语言。

确实，这 3 种语言都是非常好的语言，您选择的语言应该更多地取决于您要解决的问题以及您可以使用的资源。一旦你精通一种动态语言，再学一门或三门就容易多了。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-17T12:34:14.137

我想说，如果您需要将 Java 与 Jruby/Groovy 混合使用，请使用 Groovy。正如大家所说，Groovy 具有更紧密的 Java 集成。

但就语言***实现***而言，我更喜欢 Ruby 语言而不是 Groovy，该语言围绕自身旋转，在 Groovy 中存在一些实现本身固有的技巧（只需观看 Grails 堆栈跟踪与 Rails 堆栈跟踪，你就知道了）会明白我的意思）。

我 **强烈**推荐看看 Neal Ford[对 Groovy 和 JRuby 的比较](http://nealford.com/downloads/conferences/Comparing_Groovy_and_JRuby(Neal_Ford).pdf)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T14:35:30.120

我认为 Dick Wall 在 Java Posse 播客（#213，大约 34:20 in）上对这三者之间的区别做了一个很好的总结……“JRuby 旨在让程序员开心……它是编程语言开发人员的选择; Python 在简单性和教育方面有着非常深厚的根基；Groovy 的目标是成为 Java 开发人员的选择……它是 Java 非常熟悉的环境……支持注解”。

在将语言移出 JVM 方面，我认为 Java 运行时不会带来太多开销——它是一个简单的安装，并且您需要设置一些环境变量——但它确实提供了许多好处，包括一个经过高度优化的成熟运行时，以及大量的库。JRuby 团队现在报告了比原生 MRI 更好的性能。[http://blog.headius.com/2008/08/twas-brillig.html](http://blog.headius.com/2008/08/twas-brillig.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T20:27:01.813

我只使用过 Jython 和 Groovy。目前，Jython 的最大缺点是推荐用于生产的最新版本 (2.2.1) 具有“大致对应于 Python-2.2”的功能集 ( [Jython FAQ](http://www.jython.org/Project/userfaq.html#what-is-the-current-status-of-jython) )。有一个测试版实现了我认为是 Python 2.5，现在是一个落后的版本。不知道 JRuby 是否也可以这样说。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T21:08:11.497

我不知道你为什么*要*选择 Groovy，因为我不知道你的背景。如果您是 Java 开发人员，Groovy 感觉与您当前的语言更相似，那么 JRuby 或 Jython。Groovy 结合了 Java 语言、Java 平台和 Ruby 语言的优点。

# php - CodeIgniter - 通过表单上传图像，将图像的位置存储在数据库中

> ID：288076
> 
> 赞同：6
> 
> 时间：2008-11-13T20:03:34.950
> 
> 标签：php, mysql, file, codeigniter, upload

我正在尝试通过表单将图像上传到我的站点，但是将图像的位置存储在数据库中（而不是使数据库陷入困境）效率更高。

我的表格有问题，真的不知道去哪里：

```
<?=form_open('bro/submit_new');?>
 //other form data
 Image: <input type="file" name="image" size="20" /> <br>
 <input type="submit" value="Submit" />
</form> 
```

现在表单本身工作正常，问题是它试图将图像存储到数据库字段“图像”（文本类型）中。告诉它只存储文件并将文件位置存储在“图像”字段中的最简单方法是什么？（我告诉它通过控制器上传文件的位置）。

谢谢

编辑：控制器代码（对于这部分）：

```
function submit_new(){
    $config['upload_path'] = './images/';
    $config['allowed_types'] = 'gif|jpg|png';
    $config['max_size'] = '2000';
    $config['max_width']  = '1024';
    $config['max_height']  = '768';     
    $this->load->library('upload', $config);

    $this->db->insert('post', $_POST);

    redirect('bro');
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T20:09:39.523

CodeIgniter 的文件上传类会为你做这件事。[他们的用户指南中](http://codeigniter.com/user_guide/libraries/file_uploading.html)的条目尽我所能解释，所以我将向您指出。

本质上，您只需要修改他们在那里的控制器，以包含一些您将文件 URL 放入数据库的位置，您可以通过使用 $this->upload->data() 并提取 [full_path] 轻松完成从结果数组中，然后将其发送到处理数据库输入的模型。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-07-20T15:42:05.443

使用 form_open_multipart() 而不是 form_open()

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2013-04-25T08:22:15.820

使用模型页面将数据上传到数据库

# sql-server - SQL Server xp_cmdshell

> ID：288084
> 
> 赞同：0
> 
> 时间：2008-11-13T20:04:24.153
> 
> 标签：sql-server, tsql

`T-SQL`有没有其他方法可以通过其他方式获取文件名列表

```
INSERT INTO @backups(filename)
EXEC master.sys.xp_cmdshell 'DIR /b c:\some folder with sql backups in it 
```

`xp_cmdshell`我正在尝试从要还原的文件夹中获取 SQL 备份文件列表，但出于明显的安全原因，我不想使用它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T21:46:24.180

如果您有权访问*备份文件的服务器，则*可以使用系统表查找您喜欢的备份文件。

[http://msdn.microsoft.com/en-us/library/ms188062.aspx](http://msdn.microsoft.com/en-us/library/ms188062.aspx)

您将对备份表感兴趣。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T23:33:14.370

三个选项，具体取决于您的环境和需求：

1.  如果您使用的是 SQL2005 或 2008，您几乎可以肯定编写一个 CLR 存储过程来完成这项工作。如果您以前没有做过，这可能比您想要做的工作要多，但由于我已经有一个可以添加它的项目，如果我真的需要 SQL 能够阅读，我可能会这样做从一个目录。
2.  正如 Sam 建议的那样，如果您有权访问备份源，则可以查询 MSDB 数据库中的表。我的建议可能是查询 msdb.dbo.backupmediafamily.physical_device_name 以获取您*可能*可用的文件列表，然后使用以下命令测试它们是否存在： `RESTORE FILELISTONLY disk='FULL_PATH_TO_YOUR_FILE'`。如果文件不存在，这将引发非致命错误。您可以通过测试 @@error 是否为非零来检查 T-SQL 中的错误。
3.  如果您的环境允许，在 SQL Server 之外的 Windows 中运行的快速脚本可能是您最好的选择。如果需要，您可以将其设置为计划任务。例如，您可以让它每 15 分钟运行一次，检查自上次运行脚本以来是否出现过文件，然后将任何文件插入 SQL Server 中的表中。我已经在 Perl、Ruby 和 VBScript 中完成了类似的任务。也可以使用批处理文件来完成。同样，我不知道您的确切需求或技能组合，但如果我只是需要完成这项工作，并且不是 100% 需要它从 SQL Server 中运行，我可能只需要编写一个脚本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-05T00:31:19.657

我确实意识到这个线程已有 5 年历史，但我想我会发布另一个非 xpCmdShell、非 CLR 替代方案。详细信息在以下代码中，它非常简单。

```
--===== Define the path and populate it.
     -- This could be a parameter in a proc
DECLARE @pPath VARCHAR(512);
 SELECT @pPath = 'C:\Temp';

--===== Create a table to store the directory information in
 CREATE TABLE #DIR
        (
        RowNum     INT IDENTITY(1,1),
        ObjectName VARCHAR(512),
        Depth      TINYINT,
        IsFile     BIT,
        Extension AS RIGHT(ObjectName,CHARINDEX('.',REVERSE(ObjectName))) PERSISTED
        )
;
--===== Get the directory information and remember it
 INSERT INTO #DIR
        (ObjectName,Depth,IsFile)
   EXEC xp_DirTree 'C:\Temp',1,1
;
--===== Now do whatever it is you need to do with it
 SELECT * FROM #DIR; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T00:19:41.000

我想出的 xp_cmdshell 的替代方案如下：

我的情况有点独特，因为我正在尝试一个穷人的日志运输。我有一个文件夹（不是默认的 SQL 备份位置），其中事务日志是从远程服务器存储的。我正在编写 ac# 应用程序，它循环遍历该目录并创建带有路径的文件名的逗号分隔字符串（例如 FooA.txn、FooB.txn、FooC.txn）。然后，我将此字符串输入到我编写的存储过程中，该过程解析字符串并将文件名插入临时表中。然后我循环遍历临时表，按顺序恢复每个事务日志。

基本上，C# 应用程序替换了 xp_cmdshell，并且我可以从应用程序调用存储过程。

# html - 寻求一种紧凑格式的 HTML 电子书，以便在 Linux 下离线阅读

> ID：288087
> 
> 赞同：0
> 
> 时间：2008-11-13T20:04:41.437
> 
> 标签：html, linux, compression

我有一台运行 Linux 的上网本和大量计算机书籍和 HTML 参考资料。我想要一些紧凑的方式来存储这些书，无需先打开包装即可浏览。这将节省空间并减少我的小型 SSD 的磨损。

如果有某种方法可以说服 Firefox 浏览 ZIP 文件中包含的文件，这将是理想的。（我知道 iCab (Mac) 有一个这样工作的网络存档格式。）也许是 Firefox 插件？可以直接从 ZIP 文件提供服务的小型 Web 服务器？一些神奇的 FUSE 模块？有没有人有任何想法？

在我的 PDA 上（上网本已在很大程度上取代它），我为此使用了 iSilo，但它不适用于 Linux，它的转换是有损的，而且要花钱。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T22:36:03.847

There is the FUSE zip thing here : [http://code.google.com/p/fuse-zip/](http://code.google.com/p/fuse-zip/)

Gvfs should also support zip files.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T23:05:00.060

[Calibre](http://calibre.kovidgoyal.net)可能会有所帮助（转换为压缩格式、管理、查看电子书）。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-13T20:17:17.653

您可以使用[OpenOffice.org](http://www.openoffice.org/)打开 html 页面，然后将它们保存为 OO 文档。OO 文档本质上是一个 zip 文件。

另一种选择是使用 OO 保存为 pdf。

[您甚至可以使用此OO 宏](http://www.oooforum.org/forum/viewtopic.phtml?p=62219#62219)从命令行执行此操作。

与[AbiWord](http://www.abisource.com/)相同- 您可以在[命令行上使用它来转换](http://opensource.weblogsinc.com/2005/06/29/use-abiword-to-convert-filetypes-on-the-command-line/).

在 AbiWord 示例中，展示了如何将目录中的所有文件转换为所需的格式 (pdf)。然后您可以使用[pdftools](http://www.sheelapps.com/index.php?p=PDFTools.HomePage)将所有页面合并到一个文档中。

另外，我不知道您的笔记本电脑有什么 Windows 管理器，但如果它是 KDE，konqueror（KDE 的文件和 Web 浏览器）从 zip 文件中打开网页，没有任何问题。

很可能 Gnome 的 Nautilus 也可以做到这一点（我这里没有 Gnome 可以测试）。

您是否曾尝试使用您拥有的任何文件管理器打开一个 zip 文件，然后单击其中的网页？

# c++ - 使用 MS VS2003 计算纪元前日期/时间的最新秒数

> ID：288102
> 
> 赞同：0
> 
> 时间：2008-11-13T20:09:43.987
> 
> 标签：c++, visual-studio, algorithm, datetime

我有这个例程计算`struct tm`. 在 Linux 上，我使用 mktime 的实现工作正常，但 [在 windows VS2003/.NET](http://msdn.microsoft.com/en-us/library/d1y53h2a(VS.71).aspx) 1.1 上的 mktime 为前纪元日期时间返回 -1。

如何计算有意义的 time_t 值（即

> 值 + secondsToEpoch == secondsToDatetime

) 来自前纪元日期，仅使用 ANSI C++（也没有提升，Qt）？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T20:53:32.570

看看网上的几个 mktime 资源，它们看起来都非常便携，所以你应该能够抓住一个并将其放入你的源中，当然要注意法律要求。

也就是说，我认为您必须寻找合适的人。你在哪些日期工作？如果您使用的是 1970 年之前的日期，则很有可能需要 64 位 time_t。

很早就有一些奇怪的日历更改可能会引起关注，例如，切换到公历。

# c# - 从 File.ReadAllBytes (byte[]) 中删除字节顺序标记

> ID：288111
> 
> 赞同：14
> 
> 时间：2008-11-13T20:12:23.077
> 
> 标签：c#, byte-order-mark

我有一个 HTTPHandler，它正在读取一组 CSS 文件并将它们组合起来，然后对它们进行 GZipping。但是，一些 CSS 文件包含字节顺序标记（由于 TFS 2005 自动合并中的错误），并且在 FireFox 中，BOM 被作为实际内容的一部分读取，因此它搞砸了我的类名等。我该如何剥离出 BOM 字符？有没有一种简单的方法可以做到这一点，而无需手动通过字节数组寻找“ï»¿”？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-14T02:54:00.940

用示例扩展[Jon 的评论。](https://stackoverflow.com/questions/288111/remove-byte-order-mark-from-a-file-readallbytes-byte#comment21871755_288111)

```
var name = GetFileName();
var bytes = System.IO.File.ReadAllBytes(name);
System.IO.File.WriteAllBytes(name, bytes.Skip(3).ToArray()); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-05-19T08:23:39.300

扩展 JaredPar 示例以递归子目录：

```
using System.Linq;
using System.IO;
namespace BomRemover
{
    /// <summary>
    /// Remove UTF-8 BOM (EF BB BF) of all *.php files in current & sub-directories.
    /// </summary>
    class Program
    {
        private static void removeBoms(string filePattern, string directory)
        {
            foreach (string filename in Directory.GetFiles(directory, file  Pattern))
            {
                var bytes = System.IO.File.ReadAllBytes(filename);
                if(bytes.Length > 2 && bytes[0] == 0xEF && bytes[1] == 0xBB && bytes[2] == 0xBF)
                {
                    System.IO.File.WriteAllBytes(filename, bytes.Skip(3).ToArray()); 
                }
            }
            foreach (string subDirectory in Directory.GetDirectories(directory))
            {
                removeBoms(filePattern, subDirectory);
            }
        }
        static void Main(string[] args)
        {
            string filePattern = "*.php";
            string startDirectory = Directory.GetCurrentDirectory();
            removeBoms(filePattern, startDirectory);            
        }       
    }
} 
```

当您尝试执行基本的 PHP 下载文件时，我发现 UTF-8 BOM 损坏文件后，我需要那段 C# 代码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-16T09:50:02.080

```
var text = File.ReadAllText(args.SourceFileName);
var streamWriter = new StreamWriter(args.DestFileName, args.Append, new UTF8Encoding(false));
streamWriter.Write(text);
streamWriter.Close(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T08:32:32.830

另一种方式，假设 UTF-8 为 ASCII。

```
File.WriteAllText(filename, File.ReadAllText(filename, Encoding.UTF8), Encoding.ASCII); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-03-14T13:37:59.517

For larger file, use the following code; memory efficient!

```
StreamReader sr = new StreamReader(path: @"<Input_file_full_path_with_byte_order_mark>", 
                    detectEncodingFromByteOrderMarks: true);

StreamWriter sw = new StreamWriter(path: @"<Output_file_without_byte_order_mark>", 
                    append: false, 
                    encoding: new UnicodeEncoding(bigEndian: false, byteOrderMark: false));

var lineNumber = 0;
while (!sr.EndOfStream)
{
    sw.WriteLine(sr.ReadLine());
    lineNumber += 1;
    if (lineNumber % 100000 == 0)
        Console.Write("\rLine# " + lineNumber.ToString("000000000000"));
}

sw.Flush();
sw.Close(); 
```

# silverlight - Silverlight 的 DataTemplate 中缺少 FindName 方法是否有解决方法？

> ID：288115
> 
> 赞同：4
> 
> 时间：2008-11-13T20:12:57.317
> 
> 标签：silverlight, datatemplate, findname

根据 C# 编译器和 Silverlight 2 文档，Silverlight 没有为 DataTemplate 类提供 FindName 方法。我想在 ContentPresenter 中找到一个边框。SilverLight 2 中最好的方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T20:37:44.600

如果边框在 DataTemplate 内，而不是 ControlTemplate 内，那么我过去能够做到这一点的唯一方法是使用 VisualTreeHelper 来定位我需要的元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T20:21:49.903

不完全确定我理解这种情况，但既然你提到了 DataTemplate 我假设你正在使用模板。

如果您使用的是模板，那么您所做的就是为您的边框命名 (x:Name="border")，然后覆盖 OnApplyTemplate 方法。在该方法中，您使用 GetTemplateChild 并传递您使用的名称。这将返回对您的边界的引用。

如果您不使用模板并且引用了 ContentPresenter，那么您可以编写一个递归函数来查看子项的 Content 属性，如果它不是边框，则在其内容上调用相同的函数。

# svn - Subversion：只提交修改过的文件

> ID：288121
> 
> 赞同：2
> 
> 时间：2008-11-13T20:15:21.930
> 
> 标签：svn, version-control, command-line

我想提交大量已修改的 XML 文件。但是，在我要递归搜索的目录中，有许多文件夹/文件已在本地添加，这些我不想提交。

有没有办法在命令行上做到这一点？

更新：我应该包含 SVN 版本信息：svn，版本 1.4.6 (r28521)，编译于 2008 年 3 月 11 日，08:26:35

PS我会对包括如何强制提交的答案感兴趣，例如即使文件已被锁定。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T20:20:46.490

您是否尝试过在本地文件/文件夹上使用 svn:ignore 属性？但是除非你 svn 添加它们，否则它们不会被提交......

通常 --force 将允许您窃取文件锁。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T09:25:38.153

您没有指定哪个命令行，所以假设是 UNIX 或 cygwin。

几个选项：

1.  `find . -name '*.xml' -print0 | xargs -0 svn ci`
2.  `svn status | egrep '^M.*\.xml$' | sed -e 's/^. *//' > tmp.txt && svn ci --targets tmp.txt`
3.  `svn status > tmp.txt && $EDITOR tmp.txt && sed -e 's/^. *//' < tmp.txt > tmp2.txt && svn ci --targets tmp2.txt`

注意：我没有测试过这些命令。

第一个将提交所有 XML 文件（包括您最近添加的那些 - 如果您没有添加新的 xml 文件，这不是问题）。

第二个提交所有修改的 xml 文件。

第三个将允许您在提交之前修改文件列表。只需删除您不想提交的所有行。您可能会更自在地单独执行每个命令，而不是像我那样将它们全部链接在一起（在 && 上拆分）。

至于锁定，还有一条评论似乎涵盖了大部分内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T20:26:46.807

*编辑*：我正在根据您在问题中更新的一些信息重写此答案。

首先，要强制解锁文件，仅仅 --force 提交是不够的。您将 --force 与 unlock 命令一起使用，并且必须在要解锁的确切 URL 上使用它。不幸的是，除非您有权访问存储库，否则这是唯一的方法。如果您可以直接访问存储库，则可以使用 svnadmin 命令，如下所示：

```
svnadmin lslocks /path/to/repository 
```

这将显示锁定的文件。开锁：

```
svnadmin rmlocks /path/to/repository /project/path/to/locked/file 
```

如果您没有直接访问存储库的权限，则一次移除一个锁，如下所示：

```
svn --force unlock svn://url.to.repository/project/path/to/locked/file 
```

准备好签入后，您可以直接列出要签入的文件，而不仅仅是执行默认目录。这将允许您仅签入已修改的 XML 文件，而忽略目录结构更改、添加或您不想签入的任何其他内容（也添加了解锁示例）：

```
svn --force unlock svn;//url.to.repository/project/janes_subdir/jane.xml
svn ci -m "Whatever Log" foo.xml junk.xml my_subdir/*.xml janes_subdir/jane.xml 
```

# .net - 在哪里可以找到内置或第 3 方组件中的 Visual Studio 样式选项卡？

> ID：288126
> 
> 赞同：1
> 
> 时间：2008-11-13T20:16:11.647
> 
> 标签：.net, visual-studio, controls

我想获得 Visual Studio 风格的选项卡（你知道，你可以通过当前打开的文件进行选项卡）。

是否有第三方组件可以做到这一点？

做自己有多难？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T20:48:37.993

试试[http://devexpress.com/free](http://devexpress.com/free) - 他们有一堆很酷的高质量 WinForm 控件。您可能最感兴趣的是[XtraTabControl](http://www.devexpress.com/Products/NET/Controls/WinForms/Editors/editors/XtraTabControl.xml)。

它们是免费的，这是最好的部分 =)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T20:58:24.870

Divelements [SandDock](http://divelements.co.uk/net/controls/sanddock/)是我的最佳选择。这些控件非常有针对性，易于使用并且有据可查。

# build-process - 对 Eclipse RCP 的自动代码覆盖率的建议？

> ID：288127
> 
> 赞同：3
> 
> 时间：2008-11-13T20:16:22.600
> 
> 标签：build-process, eclipse-rcp, eclipse-pde

我想在我们的夜间构建过程中包含一些代码覆盖率。我们正在使用 CruiseControl、Ant 和 Buckminster。Buckminster 推动从多个存储库中结帐，以及产品的 PDE 构建和包装。

**有没有人将代码覆盖率集成到 RCP 无头构建中？**

我一直在关注 Cobertura、EMMA/EclEMMA、DbUnit，但我很想听到使用这些工具或任何其他工具的任何经验。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T19:02:24.570

Cobertura 似乎能够为我们完成这项工作。

一旦单元测试开始运行（这本身就是一个问题），我能够：

*   将捆绑包作为独立的罐子进行检测。
*   在父类加载器类路径上使用 cobertura 重新运行单元测试。

这里的技巧是`osgi.parentClassloader=app`在用于运行单元测试的 config.ini 文件中使用。

*   `ext`== Java 扩展
*   `boot`== 引导类加载器（默认）
*   `fwk`== 框架？
*   `app`== 应用程序，即与普通应用程序一样，在命令行中指定了类路径。

检测代码需要对 cobertura jar 的运行时访问，因此这最后一步势在必行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T11:50:32.200

EclEmma 现在有一个名为“EclEmma Equinox Runtime”的附加组件，它为任何 OSGi/Equinox 应用程序提供无头代码覆盖分析：

[http://www.eclemma.org/devdoc/headless.html](http://www.eclemma.org/devdoc/headless.html)

# process - 如何在保持版本灵活性的同时鼓励代码共享并限制错误跟踪开销？

> ID：288132
> 
> 赞同：0
> 
> 时间：2008-11-13T20:17:19.727
> 
> 标签：process, bug-tracking, jira, release-cycle

## 您如何跟踪更改、测试影响单独发布的多个工件的错误？

代码共享是好的，因为它减少了通过代码的路径总数，这意味着对更少的更改和更少的错误（或通过更少的更改解决更多错误）产生更大的影响。例如，我们可以构建使用相同文件处理包或模型包的搜索工具和索引器。

我们需要能够确保更改在所有正确的组件中得到测试，并跟踪哪些更改包含在哪些发布的工具中。我们也不希望被迫同时在所有应用程序中发布更改。

**目标：**一个要测试的错误，计划针对每个已发布的应用程序独立跟踪。借助了解架构的自动化系统，指导我们做出正确的选择。

* * *

**漏洞拆分发布场景：**

我们可能会发布一个搜索工具补丁，其中包含 util 库中的性能修复。对于搜索工具至关重要，修复在索引器中不太明显，因此它可以等到下一个维护版本。我们希望通过搜索补丁计划跟踪发布一个错误，并将其推迟到索引器的下一个维护版本。

* * *

因此，当我在我们的跟踪系统 (JIRA) 中创建错误时，我希望它神奇地变成多个对象。

*   描述问题和跟踪开发工作的主要问题
*   一组任务允许我跟踪测试工作，并让我跟踪这个问题是如何针对它影响的每个应用程序发布的。

我们如何才能使代码共享的用户体验变得更轻松，以鼓励更多的代码共享，而不会对哪些更改影响了哪些版本或迫使人们输入许多重复的错误视而不见？

我敢肯定，从 Eclipse 到 linux 发行版的大型项目都面临过这种问题，并且想知道他们是如何解决的（接下来我将讨论它们）。

你们有没有人遇到过这种情况，你们是如何处理的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T23:23:45.013

在 Jira 中，您可以允许子任务，以便您可以将子任务分配给主任务。您还可以允许对问题进行时间跟踪，以便了解每项任务花费的时间以及估计和实际之间的差异。

您还可以启用版本控制，这样您就可以通过更改日志获得下一个版本中正在完成的工作的路线图。路线图的问题在于它仅适用于一个项目，因此您无法拥有涵盖所有项目的路线图。

最后，您可以创建自己的自定义工作流程来执行几乎任何您想做的事情。我从来没有尝试过，因为我们必须学习一门新语言才能做到这一点，而我们使用 Jira 的原因是为了减少开发开销，而不是通过定制我们的错误跟踪器来增加它——但这是可能的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T23:08:22.377

对于 jira，使用影响版本并在版本中修复（另外您可以添加多个自定义字段，如版本中的 QA 验证）

# sql - SQL 表中 1 个字符代码列的最佳数据类型是什么？

> ID：288138
> 
> 赞同：2
> 
> 时间：2008-11-13T20:18:30.253
> 
> 标签：sql, database-design

这不是主键，而仅用作现有系统中的标记，用 1 个字母代码标记这些项目，即“N”表示新的，“R”表示返回等。我打算使用 varchar(50 ) 作为数据类型，但想知道说 varchar(2) 是否有任何问题，而不是为了提高效率。谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-13T20:24:52.537

最好的数据类型是 char(1)。

varchar 表示[可变宽度](http://msdn.microsoft.com/en-us/library/aa258242(SQL.80).aspx)，也就是说，如果在 varchar(50) 上只存储 3 个字符，则不会浪费 47 个字节。但是访问它时会产生（小）性能影响，因为它必须检查每行字段的实际长度。

如果以后需求发生变化，您可以轻松更改表并修改数据类型。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T20:19:29.737

我认为 char(1) 会是理想的

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T20:19:36.977

我只会使用 Char(1)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T20:20:24.727

char(1) 如果它总是 1 个字符。

除非您有充分的理由认为它应该在未来扩展 - 即使那样，您可能想要查看设计并使用您的 varchar(50) 或任何其他方式使用查找表的代理键。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T20:33:06.793

我同意@Cade Roux - 如果您考虑超过 26 种记录状态的可能性，请考虑将其转换为 FK 到状态表。还让您有机会将其转换为数据驱动的应用程序，例如通过将标签添加到状态表而不是将它们硬编码到应用程序中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T02:25:38.050

而且，只是为了混合另一种观点：根据情况，另一种方法是创建一个类型表（“product_status”或类似的东西），其形式为：

```
CREATE TABLE Product_Status (
    status_id INT NOT NULL PRIMARY KEY, 
    description VARCHAR(50) NOT NULL
)
INSERT INTO Product_Status (status_id, description) 
    VALUES (1, 'New')
INSERT INTO Product_Status (status_id, description) 
    VALUES (2, 'Return')
--etc. 
```

然后您可以使用原始表中的 int 列通过外键连接到该表。

```
ALTER TABLE OriginalTable 
  ADD status_id INT NOT NULL REFERENCES Product_Status(status_id) 
```

这两种方法都有优点。char(1) 更小，在这种情况下，可能更具可读性，但专门的表可以让您更直观，甚至更易于管理（如果您想稍后添加和删除该字段的可能值）。在这种情况下，我个人会按照人们的建议使用 CHAR(1) ，但如果它不太明显，这是一条需要考虑的路线。

无论如何，如果您确实使用了 CHAR(1)，最好在其中放置一个列约束以确保非法值不会进入：

```
ALTER TABLE OriginalTable ALTER status 
  ADD CONSTRAINT [Check_Valid_Values] 
    CHECK status in ('N', 'R' /* etc ... */) 
```

现在一点点运行时损失可能会在以后避免巨大的数据损坏问题。

# vb6 - 如何在没有断点的情况下强制 VB6 从程序执行进入调试器？

> ID：288142
> 
> 赞同：2
> 
> 时间：2008-11-13T20:19:09.350
> 
> 标签：vb6, debugging

我正在尝试查看 VB6 应用程序的执行，但我遇到了一个问题，因为一旦我进入调试器然后点击`Continue`，它不再让我单步执行代码，直到我遇到另一个断点。我希望能够在不单步执行某个程序的情况下执行程序，直到达到我想要观看它执行的地步。理想情况下，这将是在我按下按钮以“进入”该功能时按住一个键的效果。

提前致谢！

**[编辑]**：我知道我可以使用断点来停止执行。说得更清楚一点，问题是我不知道执行到哪里去，所以不能在那里设置断点（因为不知道在哪里）。这就是为什么我基本上希望能够说，'在我做的下一件事之后，无论如何都要打破'。听起来这个功能不存在，但我仍然保持手指交叉。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T08:23:43.833

代码运行时，按 ctrl+break（或 IDE 中的“VCR 暂停”按钮），然后按 F8（或从 IDE 的“调试”菜单中选择“步入”）继续运行应用程序。下一个动作将导致执行中断。

请注意，导致中断的原因并不总是您希望的那样。特别烦人的是 _MouseOver 事件，它阻止您执行鼠标按下或计时器触发比您执行操作更快。在运行您的应用程序时，一些中断甚至可能是致命的，例如，Windows 消息已被挂钩（子类化）。还要考虑代码中可能没有事件处理程序（尚未）用于您的操作可能会中断。但通常这种技术会确定您应该在哪里设置断点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T20:44:12.903

在 VB6 中有一个可用的 Stop 语句，当从通过 IDE 运行的代码执行该语句时，该语句将被放到调试器中。（只需确保在编译发布版本时从代码中删除所有 Stop 语句。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T16:59:08.253

您可以使用多种技术。

这两个已经提到

使用 F8 和 Shift-F8 单步执行程序

添加止损点（然后删除）

其他

使用全局变量创建集合。将其用作堆栈并拥有您对推送和弹出字符串感兴趣的子例程。相反，不要弹出任何东西，你会得到一个踪迹。

使用 Watches 在选择条件下进行监控和中断。您可以设置几乎任何要中断的条件。

制作一个全局字符串并在输入时设置您的程序。通过手表监控它。

在您的代码中使用 Debug.Print。与 Stop 不同的是，您可以将这些保留在不影响生产代码的情况下。

使用文件系统对象创建一个文本文件作为日志。

有时问题只出现在 Complied 版本中，然后您需要使用 MsgBox 或登录到文本文件。MsgBox 可以改变复杂的用户与表单交互的行为。

这些都是我在调试应用程序时使用的技术。如果我必须监视应用程序，我会使用 Debug.Print。如果那不做技巧编译然后登录到一个文本文件。

如果您有一些非常复杂的事情发生，那么我建议您将所有代码从事件中移出到实现命令模式的类中。您的命令类应该通过和接口与表单交互。

在命令类的 Execute 方法中，您将类似于

```
<save the current state>
<Do your original code>
<save the modified state>
<push the command onto a stack> 
```

将会发生的事情是，您最终会得到一个列表，其中列出了您已执行的所有命令（甚至是鼠标悬停之类的命令）以及它们遇到的状态和修改后的状态。然后，您可以依次检查每个对象以查看发生了什么。这几乎相当于创建撤消/重做

但是请注意，诸如 MouseOver 之类的东西可以在命令堆栈上推送许多类，因此您必须仔细构建测试，否则信息会过载。请记住，您始终可以跳过将命令推入堆栈。

使用命令的缺点是您超出了调试范围而进入了重新设计。你将决定这个问题是否值得这样做。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T20:22:59.590

您可以按 F8 键逐行浏览代码。或者，您可以按 SHIFT-F8 逐行浏览。

F8 将带您进入一个功能，其中 SHIFT-F8 将带您跳过该功能。如果您单击 VB IDE 中的 DEBUG 菜单，您还将看到其他选项。

编辑：

您还可以使用以下方法在代码中放置永久断点：

```
Debug.Assert False 
```

通过这种方式，“断点”将保存在您的代码中。编译应用程序时，调试代码将被忽略。

# frame-rate - 如何制作FPS游戏？

> ID：288153
> 
> 赞同：3
> 
> 时间：2008-11-13T20:20:59.440
> 
> 标签：frame-rate

我想知道如何使用 SDL lib 创建 fps 游戏？

有没有用例子解释的书？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-13T21:23:47.783

这赢得了大多数开放式问题。你可以从字面上写一本书。但让我们满足于指向正确的方向......

第一步，对于这样的项目，您将需要良好的调试技能。拿起史蒂夫麦康奈尔的代码完成。阅读全文。投入的时间将比您可以阅读/实验的任何其他东西更能收回成本。

获取一些游戏的源代码。任何游戏。确保在看到大而复杂的东西之前先看到简单的东西，并记住，当您查看任何游戏代码时，他们可能有一个联合团队投入的时间比您以往任何时候都多。这里的重点是查看代码结构。

获取 3D 数学的参考资料，不一定要那么深入，但您需要了解诸如前后点积之类的知识，能够弄清楚如何为世界上的相机创建矩阵等。（即使你写了 0% 的渲染代码）

*（编辑）*这是一本关于[3D 游戏编程和计算机图形学的 3D 数学数学的好书，第二版（游戏开发系列）](https://rads.stackoverflow.com/amzn/click/com/1584502770)这不是你在大学里学习的那种，它更像是三角和更高级实用概念的交叉：如何为自己创建一个简单物理、高效碰撞检测等的工具箱。

您将需要了解有关渲染和管道的知识。SDL 助您一臂之力，但请确保您了解其工作的概念。

阅读有关实用系统设计的信息。您的各种系统必须互锁。好好想想吧。您的系统可能只是 C 或 C++ 中的一个好系统，重要的是您的数据/控制将如何流动的想法，而不是您模拟设计模式的完美程度（尽管这些非常有用以及粗略）

人工智能的基础，不是“真正的”人工智能，而是功能性人工智能；有一个很大的不同。状态机一开始就很好，对于简单的 FPS 来说已经足够了。

了解一些关于估算和规划的知识。你将没有时间去做你想做的所有事情来正确地制作一个 FPS。您将必须进行分类并学习如何分类；它们是两件不同的事情，后者很难。经验是这里粗略的最好老师。（虽然传奇的麦康奈尔也有这方面的书）

有一个系统可以将您的游戏玩法插入您的关卡。如果只是您作为程序员，那么您最好的选择是为现有的编辑程序（例如 3DS Max）编写插件。对于程序员，我强烈推荐 Max 而不是 Maya。Maya 脚本很好，但它更适合聪明的非程序员。我发现 3DS Max 更多地考虑了程序员如何创建和编辑你的世界。

您可以花费数年时间制作工具来让您正确地做到这一点，因此您希望以一种可以快速准确地编辑的方式来做事。如果您制作自己的编辑器，请将其整合到您的游戏世界中。如果您的世界不是真正的 3D，并且您想快速制作大量关卡，您可以将关卡数据保存为类似这样的内容，这将为您节省大量时间 X 是墙，其他字母是游戏对象简单的解析器可以翻译成游戏对象和世界坐标

```
 xxxxxxxxxxxxxxxxxxxxxxxx
 xx..........P..........x
 xxxxxxx...........I....x
 xR....xxx...........E..x
 xx.................0xxxx
 xxxxxxxxxxxxxxxxxxxxxxxx 
```

但这一切都取决于你的游戏。我的观点是，您将需要诉诸“贫民窟编码”，如何将游戏数据带入您的世界非常重要，您需要考虑一些既能快速实施又能快速与您合作的东西。

归根结底，您的目标是什么？如果要学习以绝对正确的方式编写代码，请期望将大部分时间花在一个月前看起来不错的代码上，但现在您意识到自己的需求是什么，它真的可以使用另一遍。不要害怕重写，这样做你会学到很多东西，但如果你的目标是功能，你可能需要弄清楚在哪里破解一些东西（比如将游戏数据和坐标嵌入到代码文件*中*）只要你知道你在哪里被黑客入侵，并且小心地将它与你的好代码分开，这样你就可以在有机会时返回并正确编写代码。

底线是，您需要确定您的目标是什么，学习或功能，并找到两者之间的快乐媒介。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T20:55:11.100

[在fileshack](http://www.fileshack.com/file.x?fid=7547)下载 quake 3 源并从中学习。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-18T01:16:13.163

尽管从长远来看，很长的帖子很有价值，但我觉得它并不能提供适当的即时动力，让他们在屏幕上显示内容。以下是一些事实，以及我的观点

-SDL 是一个 2D 图形库，您不能在 2D 中编写 FPS，因此您必须使用 3D 库，无论是 DirectX 还是 openGL

-SDL 能够与 openGL“同步”，将其用于图形，但该主题的在线帮助并不多

我建议你去 Lazyfoo.net，这是一个绝对令人惊叹的 SDL 游戏编程初学者资源，它向你展示了如何在屏幕上绘图，还教你如何将其应用于编程游戏。完成此操作后，您将能够制作俄罗斯方块克隆或大多数其他 2D 类型游戏

在此之后，您将为 3D 做好准备（它要复杂得多，需要更好地掌握数学，并且需要更多代码来做更简单的事情）如果您使用 openGL，请查看 NeHe 的教程，他们目前使用 SDL 和 openGL 开发新的集合，因为较旧的教程虽然很有价值，但编码相当糟糕并且使用 windows(win32) API

请记住，游戏开发是您会遇到的最苛刻、最有价值的编程之一，祝您好运

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-16T06:30:04.420

虽然不特定于 SDL，但[NeHe](http://nehe.gamedev.net/) OpenGL 教程是学习如何进行 3D 的绝佳起点。

如果这是您的第一款游戏，您可能希望瞄准低于 FPS 的目标。使用 SDL 编写一个简单的 2D 俄罗斯方块游戏将教会您需要了解的有关该库的所有信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T20:24:34.283

几乎所有在标题中提到的“游戏编程大师的技巧”都会向您展示如何制作 FPS 游戏。LeMothe 爱他们。

编辑：忘记了那些标题。

# algorithm - 函数式语言的快速元素查找（Haskell）

> ID：288157
> 
> 赞同：10
> 
> 时间：2008-11-13T20:22:14.770
> 
> 标签：algorithm, haskell, functional-programming, graph-theory

假设我们正在遍历一个图，并且想要快速确定一个节点之前是否出现过。我们有一些设定的先决条件。

1.  节点已用整数值 1..N 标记
2.  图是用具有邻接列表的节点实现的
3.  1..N 中的每个整数值都出现在图中，其大小为 N

以纯功能方式执行此操作的任何想法？（不允许哈希表或数组）。

我想要一个有两个函数的数据结构；add（添加遇到的整数）和查找（检查是否添加了整数）。两者都应该优选地花费 O(n) 时间来分摊 N 次重复。

这可能吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T20:56:25.357

您可以使用[Data.Set](http://cvs.haskell.org/Hugs/pages/libraries/base/Data-Set.html)。您可以通过使用旧集合创建新集合`insert`并传递新集合来添加元素。您使用 查找元素是否是集合的成员`member`。这两个操作都是 O(log n)。

也许，您可以考虑使用 state monad 来线程化集合的传递。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-17T08:45:25.683

函数式语言中的高效元素查找非常困难。`Data.Set`（如上所示）是使用二叉树实现的，该二叉树可以以纯功能方式构建，提供 O(log n) 中的查找操作。HashTables（不是纯粹的功能）将有 O(1)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-22T07:55:03.937

如果您不介意将代码包装在 IO monad 中，请查看[judy hashtables 。](http://hackage.haskell.org/package/judy)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-27T07:04:04.173

我相信 Data.BitSet 可能是 O(n)。

# rss - 是否有可以获取饲料并从中生成每日摘要的服务？

> ID：288167
> 
> 赞同：2
> 
> 时间：2008-11-13T20:24:58.743
> 
> 标签：rss, digest, atom-feed, aggregators

我运行一个提要聚合器（[http://planetdb2.com/](http://planetdb2.com/)），我需要聚合多产（一天很多帖子）和不太多产（最多一天一个帖子）的提要。

创建每日摘要——当天帖子的一篇帖子摘要——似乎是最好的解决方案。

有一种方法可以通过 Yahoo Pipes 为 Twitter 提要创建每日摘要，但它既不通用也不简单。

Feedburner 会通过电子邮件向您发送每日摘要，但不会创建每日摘要提要。

是否有现有的服务可以获取任何饲料并每天生产？我该如何使用它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-07T23:54:26.657

也许[小报](http://www.tabbloid.com/)会做你需要的。该服务读取给定的 RSS 提要，将新项目组合成 PDF 并按时将 pdf 通过电子邮件发送到给定地址。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-13T20:31:17.687

试试雅虎管道。

[http://pipes.yahoo.com/pipes/](http://pipes.yahoo.com/pipes/)

# syslog - Linux syslogd 可以记录非英语消息吗？

> ID：288175
> 
> 赞同：4
> 
> 时间：2008-11-13T20:28:54.803
> 
> 标签：syslog

我正在我的 Linux 服务器上使用 syslog 守护程序设置日志记录基础设施。我计划配置将日志作为系统日志转发到我的 Linux 服务器的 Windows 和非 Windows 客户端很少。我的一些客户端机器使用外语登录。因此，如何将 syslogs 等非英文日志转发到我的 Linux 服务器？我需要在服务器和客户端上设置任何特殊编码吗？这是正确的方法还是有其他更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T20:33:54.203

当前的 syslogd 是 8 位干净的，因此编码为 UTF-8 就可以了。只需确保控制台或使用实际日志的任何东西都知道数据是 UTF-8 编码的，以便以后可以正确显示。

# c# - Lambda 表达式练习

> ID：288178
> 
> 赞同：4
> 
> 时间：2008-11-13T20:30:45.863
> 
> 标签：c#, c++, math, lambda, integrate

我最近一直在尝试更多地了解 lambda 表达式，并想到了一个有趣的练习......

有没有办法像这样简化 c++ 集成函数：

```
// Integral Function
double integrate(double a, double b, double (*f)(double))
{
    double sum = 0.0;

    // Evaluate integral{a,b} f(x) dx
    for(int n = 0 ; n <= 100; ++n)
    {
        double x = a + n*(b-a)/100.0;
        sum += (*f)(x) * (b-a)/101.0;
    }
    return sum;
} 
```

通过使用 c# 和 lambda 表达式？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T21:08:12.137

那这个呢：

```
public double Integrate(double a,double b, Func<double, double> f)
{
    double sum = 0.0;

    for (int n = 0; n <= 100; ++n)
    {
        double x = a + n * (b - a) / 100.0;
        sum += f(x) * (b - a) / 101.0;
    }
    return sum;
} 
```

测试：

```
 Func<double, double> fun = x => Math.Pow(x,2);        
    double result = Integrate(0, 10, fun); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T21:15:40.920

拉姆达波瓦！不确定这是否正确（没有 C# 程序员！只是喜欢它的 lambda 东西）

```
(a, b, c) => {
    double sum = 0.0;
    Func<double, double> dox = (x) => a + x*(b-a)/100.0;

    // Evaluate integral{a,b} f(x) dx
    for(int n = 0 ; n <= 100; ++n)
        sum += c(dox(n)) * (b-a)/101.0;

    return sum;
} 
```

好的，所以我认为虽然代码是 C++，但为什么不保留它 C++ 并获取 lambda？这是它对 c++0x 的看法，希望很快作为标准发布：

```
static double Integrate(double a, double b, function<double(double)> f)
{
    double sum = 0.0;

    // Evaluate integral{a,b} f(x) dx
    for(int n = 0; n < 100; ++n) {
        double x = a + n * (b - a) / 100.0;
        sum += f(x) * (b - a) / 101.0;
    }
    return sum;
}  

int main() {
    Integrate(0, 1, [](double a) { return a * a; });
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T21:09:53.193

如前所述，真正的力量来自于调用它。例如，在 C#

```
 static double Integrate(double a, double b, Func<double, double> func)
    {
        double sum = 0.0;

        // Evaluate integral{a,b} f(x) dx
        for(int n = 0 ; n <= 100; ++n)
        {
            double x = a + n*(b-a)/100.0;
            sum += func(x) * (b - a) / 101.0;
        }
        return sum;
    } 
```

然后：

```
 double value = Integrate(1,2,x=>x*x); // yields 2.335
    // expect C+(x^3)/3, i.e. 8/3-1/3=7/3=2.33... 
```

# visual-studio - Visual Studio：MyMacros 不会出现在工具 > 选项 > 环境中。> 键盘

> ID：288179
> 
> 赞同：0
> 
> 时间：2008-11-13T20:30:52.057
> 
> 标签：visual-studio, visual-studio-2005, macros

我写了一个宏来帮助我进行单元测试（它是从其他宏派生的，这些宏只是在您编写方法的名称时添加下划线，），当我转到工具 > 选项 > 环境 >然后键盘为其分配一个快捷方式，它在任何地方都找不到，没有“MyMacros”默认部分。有任何想法吗？

另外，宏浏览器选项不在工具菜单下，我需要按 ALT+F8 才能找到它，也许它们是相关的？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T21:28:14.793

您可能会遇到当前配置文件设置隐藏宏浏览器的问题。尝试转到工具 -> 导入/导出设置并选择重置所有设置。选择“常规配置文件”。如果是设置问题，这将导致菜单重新出现。

# exception - 记录位置

> ID：288182
> 
> 赞同：1
> 
> 时间：2008-11-13T20:31:29.450
> 
> 标签：exception, logging

我应该在哪里记录异常？在数据服务层（ExecuteDataSet 等）和/或在数据访问层和/或在业务层？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T20:40:58.960

在物理层边界。

也在客户端的顶级异常处理程序中。

即，如果您的业务层在服务器上运行，请在传播到客户端之前记录异常。如果您将业务层公开为 WCF Web 服务，这很容易，您可以实现一个错误处理程序，在将 SOAP 错误传播到客户端之前执行日志记录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T20:39:15.207

如果您抛出异常，您应该在它发生时将其记录下来，然后将其冒泡。否则只有最终用户应该记录一个异常（当然你可能有很多跟踪，在这种情况下它可能会被记录很多）。

最终用户可能是 UI 组件或服务或其他东西......

如果您在某处的代码中处理异常 - 那么那是最终用户，您应该将其记录在那里。在大多数应用程序中，在大多数情况下，当 UI 向用户显示错误消息时，它应该被记录下来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T20:42:55.587

我通常允许异常向上传播并在它们达到最高级别时记录它们。例如

```
main {
    try {
        application code
    } catch {
        preform logging
    }
} 
```

但这仅对致命异常有意义。其他异常我通常将它们记录在处理从所述异常恢复的块中。

# svn - TortoiseSVN - 忽略存储库中已有文件夹中的文件

> ID：288190
> 
> 赞同：30
> 
> 时间：2008-11-13T20:34:30.333
> 
> 标签：svn, tortoisesvn, svnignore

如何忽略源代码控制下文件夹中的所有文件？

`/project/published/`是我要保留的文件夹

`/project/published/some_file(s)`是我不想要的文件/文件夹

更多详细信息：目前，当我为我的项目提交更改时，我会看到很多我不想要的文件。它们是发布到文件夹的文件，我不需要它们在源代码管理下。我永远不会知道这些文件的名称，因为它们是由用户选择的。

我尝试使用`svn:ignore`具有价值的属性，`published/*`但没有奏效。有任何想法吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2010-09-09T03:24:24.897

您只需右键单击该`published/`文件夹，选择 TortoiseSVN -> 属性，单击新建 -> 高级，如下所示：

*   物业名称：`svn:ignore`
*   适当的价值：`*`

然后它会工作得很好。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-13T23:30:24.127

I've found a solution. If I set the svn:ignore property directly on the folder I want to keep (published) and set it's value to * then it does what I want. I would have liked to add this property to the project root but this works too.

prop - svn:ignore

value - *

Thanks for the suggestions.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T20:37:10.653

也许这可以帮助你：在提交对话框中有一个复选框来“显示未版本控制的文件”。这与告诉 Tortoise/SVN 忽略它们不同，但可能只是解决问题。高温高压

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T20:42:33.717

我猜你试过：

```
svn propset svn:ignore published/* 
```

`svn propset`需要将值和目标分开：

```
svn propset svn:ignore [value] [target] 
```

...所以尝试：

```
svn propset svn:ignore "*" published 
```

（不要忘记引号。）

# .net - 如何在 .NET 的 app.config 中进行分层配置

> ID：288191
> 
> 赞同：6
> 
> 时间：2008-11-13T20:35:39.737
> 
> 标签：.net, configuration, settings, app-config

app.config 配置部分很好，但我经常需要多个配置集，但差异很小。我想要的是：

1.  有一个部分具有默认配置（这个部分是由设计器创建的，因此在 Settings 类中具有自动生成的强类型访问器
2.  另一个只有“新”项目的部分，所有其他项目都从原始部分获取它们的值。

（注意 - 将“其他部分”放在单独的文件中也很好，但这是一个不同的问题。）

**编辑**：应用程序是普通的可执行文件（或服务）——它不是网络服务。另外，我知道有一个“machine.config”可以继承，但它太全球化了：它适用于所有应用程序

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T20:54:34.817

我认为您必须使用自定义处理程序来管理它。

第二部分很简单，因为您可以在原始配置文件中使用 configSource 属性来指向包含 xml 源的文件。

```
<system.serviceModel>
    <diagnostics>
      <messageLogging logMalformedMessages="true" logMessagesAtServiceLevel="true"
        logMessagesAtTransportLevel="true" />
    </diagnostics>
    <bindings configSource="web.shared.bindings.config" ></bindings>
    <client configSource="web.shared.client.config" ></client>    
</system.serviceModel> 
```

下面是我们如何将部分 Service.ServiceModel XML 链接到我们的 Web Config 中，这样我们就可以将它们分开并轻松编辑。

# c# - 来自 DLL 的 C# 回调

> ID：288192
> 
> 赞同：9
> 
> 时间：2008-11-13T20:35:56.663
> 
> 标签：c#, dll, delegates, callback

我正在用 C#.NET 编写应用程序 A 和 DLL B。如何执行以下操作：

1.  A调用B中的函数
2.  希望 B 使用委托/回调来更新 A 的 UI 中的状态

这与 BackgroundWorker*无关*……那部分在 A 中工作正常。我看不到的是如何让 B 知道在 A 中调用什么函数。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-13T20:51:51.013

要扩展 Rob Prouse 的答案，您需要声明一个委托，然后将匹配的方法传递给它。

在 B 中：

```
public delegate void CallbackDelegate(string status);

public void DoWork(string param, CallbackDelegate callback)
{
    callback("status");
} 
```

在一个：

```
public void MyCallback(string status)
{
    // Update your UI.
} 
```

当您调用该方法时：

```
B.DoWork("my params", MyCallback); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-13T20:42:30.223

你有两个选择。最常见的是在 B 中有一个事件，并让 A 中的 UI 订阅该事件。B 然后触发该事件。

第二种选择是将来自 A 的委托作为参数传递给 B 中的方法调用。然后 B 可以调用该委托。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T20:43:00.673

在对 B 的调用 A 中传入回调对象。使用接口（或紧密绑定的库）。确保回调对象是线程感知和线程安全的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T20:55:37.497

如果您控制 B，那么 Rob Prouse 或 Brody 的答案将正常工作。

但是，如果您根本无法更改 B 怎么办？在这种情况下，您始终可以将方法包装在您自己制作的委托中，只要它的签名与目标方法的签名匹配即可。

因此，假设您有一个名为 B 的类实例，并带有一个名为 b() 的公共方法（当然来自 B dll 程序集）。A 应用程序中的 A 类可以像这样异步调用它：

```
public class A
{
    delegate void BDelegate();

    public void BegineBMethod()
    {
        BDelegate b_method = new BDelegate(B.b);
        b_method.BeginInvoke(BCallback, null);
    }

    void BCallback(IAsyncResult ar)
    {
       // cleanup/get return value/check exceptions here
    }
} 
```

# java - 素数计算乐趣

> ID：288200
> 
> 赞同：16
> 
> 时间：2008-11-13T20:38:52.663
> 
> 标签：java, primes

我们在这里工作很开心。这一切都始于其中一个人设置了 Hackintosh，我们想知道它是否比我们拥有的（几乎）相同规格的 Windows Box 更快。所以我们决定为它写一个小测试。只是一个简单的素数计算器。它是用 Java 编写的，告诉我们计算前 n 个素数所需的时间。

下面的优化版本 - 现在需要约 6.6 秒

```
public class Primes {

    public static void main(String[] args) {
        int topPrime = 150000;
        int current = 2;
        int count = 0;
        int lastPrime = 2;

        long start = System.currentTimeMillis();

        while (count < topPrime) {

            boolean prime = true;

            int top = (int)Math.sqrt(current) + 1;

            for (int i = 2; i < top; i++) {
                if (current % i == 0) {
                    prime = false;
                    break;
                }
            }

            if (prime) {
                count++;
                lastPrime = current;
            }
            if (current == 2) {
             current++;
            } else {
                current = current + 2;
            }
        }

        System.out.println("Last prime = " + lastPrime);
        System.out.println("Total time = " + (double)(System.currentTimeMillis() - start) / 1000);
    } 
} 
```

我们几乎失去了整个 Hackintosh 与 PC 的情节，只是在优化它时获得了一些乐趣。没有优化的第一次尝试（上面的代码有几个）运行了大约 52.6 分钟，以找到前 150000 个素数。此优化运行大约 47.2 分钟。

如果您想试一试并发布您的结果，请坚持下去。

我运行它的 PC 的规格是 Pentium D 2.8GHz，2GB RAM，运行 Ubuntu 8.04。

**迄今为止，最佳优化一直是电流的平方根，由 Jason Z 首次提到。**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-13T20:58:45.197

这比我的筛子在 1986 年左右在涡轮帕斯卡的 8 Mhz 8088 上做的要差一些。但那是在优化之后:)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-13T21:08:11.123

由于您是按升序搜索它们，因此您可以保留已找到的素数列表，并仅检查它们的可分性，因为所有非素数都可以简化为较小素数的列表。将它与前面关于不检查当前数字平方根的因子的技巧结合起来，您将拥有一个非常高效的实现。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-13T20:58:04.793

好吧，我看到了一些可以完成的快速优化。首先，您不必尝试每个数字最多为当前数字的一半。

相反，您只需要尝试当前数字的平方根。

另一个优化是 BP 说的一个转折点：而不是

```
int count = 0;
...
for (int i = 2; i < top; i++)
...
if (current == 2)
  current++;
else
  current += 2; 
```

采用

```
int count = 1;
...
for (int i = 3; i < top; i += 2)
...
current += 2; 
```

这应该会大大加快速度。

**编辑：**
Joe Pineda 提供的更多优化：
删除变量“top”。

```
int count = 1;
...
for (int i = 3; i*i <= current; i += 2)
...
current += 2; 
```

如果这种优化确实提高了速度，就看java了。
与将两个数字相乘相比，计算平方根需要很多时间。但是，由于我们将乘法移动到 for 循环中，因此每个循环都执行此操作。因此，这可能会减慢速度，具体取决于 java 中平方根算法的速度。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-10-25T19:58:02.253

这是一个快速简单的解决方案：

*   找到小于 100000 的素数；在 5 毫秒内找到 9592
*   找到小于 1000000 的素数；在 20 毫秒内找到了 78498 个
*   找到小于 10000000 的素数；在 143 毫秒内找到 664579
*   找到小于 100000000 的素数；5761455 在 2024 毫秒内被发现
*   找到小于 1000000000 的素数；在 23839 毫秒内发现 50847534

    ```
    //returns number of primes less than n
    private static int getNumberOfPrimes(final int n)
    {
        if(n < 2) 
            return 0;
        BitSet candidates = new BitSet(n - 1);
        candidates.set(0, false);
        candidates.set(1, false);
        candidates.set(2, n);
        for(int i = 2; i < n; i++)
            if(candidates.get(i))
                for(int j = i + i; j < n; j += i)
                    if(candidates.get(j) && j % i == 0)
                        candidates.set(j, false);            
        return candidates.cardinality();
    } 
    ```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-24T21:57:41.267

使用埃拉托色尼筛法在 Python 中生成前 150000 个素数需要我们不到一秒钟（2.4GHz）的时间：

```
#!/usr/bin/env python
def iprimes_upto(limit):
    """Generate all prime numbers less then limit.

    http://stackoverflow.com/questions/188425/project-euler-problem#193605
    """
    is_prime = [True] * limit
    for n in range(2, limit):
        if is_prime[n]:
           yield n
           for i in range(n*n, limit, n): # start at ``n`` squared
               is_prime[i] = False

def sup_prime(n):
    """Return an integer upper bound for p(n).

       p(n) < n (log n + log log n - 1 + 1.8 log log n / log n)

       where p(n) is the n-th prime. 
       http://primes.utm.edu/howmany.shtml#2
    """
    from math import ceil, log
    assert n >= 13
    pn = n * (log(n) + log(log(n)) - 1 + 1.8 * log(log(n)) / log(n))
    return int(ceil(pn))

if __name__ == '__main__':
    import sys
    max_number_of_primes = int(sys.argv[1]) if len(sys.argv) == 2 else 150000
    primes = list(iprimes_upto(sup_prime(max_number_of_primes)))
    print("Generated %d primes" % len(primes))
    n = 100
    print("The first %d primes are %s" % (n, primes[:n])) 
```

例子：

```
$ python primes.py

Generated 153465 primes
The first 100 primes are [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 
43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 
127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197,
199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281,
283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379,
383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463,
467, 479, 487, 491, 499, 503, 509, 521, 523, 541] 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-13T21:13:39.037

在 C# 中：

```
class Program
{
    static void Main(string[] args)
    {
        int count = 0;
        int max = 150000;
        int i = 2;

        DateTime start = DateTime.Now;
        while (count < max)
        {
            if (IsPrime(i))
            {
                count++;
            }

            i++;

        }
        DateTime end = DateTime.Now;

        Console.WriteLine("Total time taken: " + (end - start).TotalSeconds.ToString() + " seconds");
        Console.ReadLine();
    }

    static bool IsPrime(int n)
    {
        if (n < 4)
            return true;
        if (n % 2 == 0)
            return false;

        int s = (int)Math.Sqrt(n);
        for (int i = 2; i <= s; i++)
            if (n % i == 0)
                return false;

        return true;
    }
} 
```

输出：

总耗时：2.087 秒

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-13T20:56:00.023

请记住，有更好的方法来寻找素数......

我认为你可以采取这个循环：

> `for (int i = 2; i < top; i++)`

并使其计数器变量 i 从 3 开始，并且只尝试对奇数进行 mod，因为除 2 之外的所有素数都不能被任何偶数整除。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-13T21:57:15.627

是否重新声明变量素数

```
 while (count < topPrime) {

            boolean prime = true; 
```

在循环内使其效率低下？（我认为这无关紧要，因为我认为 Java 会对此进行优化）

```
boolean prime;        
while (count < topPrime) {

            prime = true; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T21:40:50.573

C＃

对[Aistina 代码的](https://stackoverflow.com/questions/288200/prime-number-calculation-fun#288339)增强：

这利用了一个事实，即所有大于 3 的素数都是 6n + 1 或 6n - 1 的形式。

这比每次通过循环时增加 1 的速度增加了大约 4-5%。

```
class Program
{       
    static void Main(string[] args)
    {
        DateTime start = DateTime.Now;

        int count = 2; //once 2 and 3

        int i = 5;
        while (count < 150000)
        {
            if (IsPrime(i))
            {
                count++;
            }

            i += 2;

            if (IsPrime(i))
            {
                count++;
            }

            i += 4;
        }

        DateTime end = DateTime.Now;

        Console.WriteLine("Total time taken: " + (end - start).TotalSeconds.ToString() + " seconds");
        Console.ReadLine();
    }

    static bool IsPrime(int n)
    {
        //if (n < 4)
        //return true;
        //if (n % 2 == 0)
        //return false;

        int s = (int)Math.Sqrt(n);
        for (int i = 2; i <= s; i++)
            if (n % i == 0)
                return false;

        return true;
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-13T22:56:16.257

我对优化的看法，避免太神秘的技巧。我使用 I-GIVE-TERRIBLE-ADVICE 给出的技巧，我知道并忘记了...... :-)

```
public class Primes
{
  // Original code
  public static void first()
  {
    int topPrime = 150003;
    int current = 2;
    int count = 0;
    int lastPrime = 2;

    long start = System.currentTimeMillis();

    while (count < topPrime) {

      boolean prime = true;

      int top = (int)Math.sqrt(current) + 1;

      for (int i = 2; i < top; i++) {
        if (current % i == 0) {
          prime = false;
          break;
        }
      }

      if (prime) {
        count++;
        lastPrime = current;
//      System.out.print(lastPrime + " "); // Checking algo is correct...
      }
      if (current == 2) {
        current++;
      } else {
        current = current + 2;
      }
    }

    System.out.println("\n-- First");
    System.out.println("Last prime = " + lastPrime);
    System.out.println("Total time = " + (double)(System.currentTimeMillis() - start) / 1000);
  }

  // My attempt
  public static void second()
  {
    final int wantedPrimeNb = 150000;
    int count = 0;

    int currentNumber = 1;
    int increment = 4;
    int lastPrime = 0;

    long start = System.currentTimeMillis();

NEXT_TESTING_NUMBER:
    while (count < wantedPrimeNb)
    {
      currentNumber += increment;
      increment = 6 - increment;
      if (currentNumber % 2 == 0) // Even number
        continue;
      if (currentNumber % 3 == 0) // Multiple of three
        continue;

      int top = (int) Math.sqrt(currentNumber) + 1;
      int testingNumber = 5;
      int testIncrement = 2;
      do
      {
        if (currentNumber % testingNumber == 0)
        {
          continue NEXT_TESTING_NUMBER;
        }
        testingNumber += testIncrement;
        testIncrement = 6 - testIncrement;
      } while (testingNumber < top);
      // If we got there, we have a prime
      count++;
      lastPrime = currentNumber;
//      System.out.print(lastPrime + " "); // Checking algo is correct...
    }

    System.out.println("\n-- Second");
    System.out.println("Last prime = " + lastPrime);
    System.out.println("Total time = " + (double) (System.currentTimeMillis() - start) / 1000);
  }

  public static void main(String[] args)
  {
    first();
    second();
  }
} 
```

是的，我第一次在 Java 中尝试使用带标签的 continue ......
我知道我跳过了前几个素数的计算，但它们是众所周知的，没有必要重新计算它们。:-) 如果需要，我可以对他们的输出进行硬编码！此外，它无论如何都没有决定性的优势。

结果：

-- First
Last prime = 2015201
总时间 = 4.281

-- 倒数第二个
素数 = 2015201
总时间 = 0.953

不错。我想可能会有所改进，但过多的优化会扼杀好的代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-13T23:12:07.113

您应该能够通过仅评估奇数来使内部循环快两倍。不确定这是否是有效的 Java，我习惯于 C++，但我确信它可以适应。

```
 if (current != 2 && current % 2 == 0)
                    prime = false;
            else {
                    for (int i = 3; i < top; i+=2) {
                            if (current % i == 0) {
                                    prime = false;
                                    break;
                            }
                    }
            } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-17T17:13:25.213

我决定在 F# 中尝试这个，这是我第一次体面的尝试。在我的 2.2Ghz Core 2 Duo 上使用 Eratosthenes 筛，它在大约 200 毫秒内通过 2..150,000。每次它调用它自己时，它都会从列表中消除当前的倍数，所以它会随着它的进行而变得更快。这是我在 F# 中的第一次尝试，因此我们将不胜感激任何建设性的意见。

```
let max = 150000
let numbers = [2..max]
let rec getPrimes sieve max =
    match sieve with
    | [] -> sieve
    | _ when sqrt(float(max)) < float sieve.[0] -> sieve
    | _ -> let prime = sieve.[0]
           let filtered = List.filter(fun x -> x % prime <> 0) sieve // Removes the prime as well so the recursion works correctly.
           let result = getPrimes filtered max
           prime::result        // The filter removes the prime so add it back to the primes result.

let timer = System.Diagnostics.Stopwatch()
timer.Start()
let r = getPrimes numbers max
timer.Stop()
printfn "Primes: %A" r
printfn "Elapsed: %d.%d" timer.Elapsed.Seconds timer.Elapsed.Milliseconds 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-17T17:37:55.817

我敢打赌米勒-拉宾会更快。如果您测试足够多的连续数字，它就会变得确定性，但我什至不会打扰。一旦随机算法达到其失败率等于 CPU 打嗝导致错误结果的可能性的程度，它就不再重要了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-08T05:23:01.927

这是我的解决方案......它相当快......它在我的机器（核心 i7 @ 2.93Ghz）上的 Vista64 上在 3 秒内计算出 1 到 10,000,000 之间的素数。

我的解决方案是 C，但我不是专业的 C 程序员。随意批评算法和代码本身:)

```
#include<stdio.h>
#include<math.h>
#include<stdlib.h>
#include<time.h>

//5MB... allocate a lot of memory at once each time we need it
#define ARRAYMULT 5242880 

//list of calculated primes
__int64* primes; 
//number of primes calculated
__int64 primeCount;
//the current size of the array
__int64 arraySize;

//Prints all of the calculated primes
void PrintPrimes()
{
    __int64 i;
    for(i=0; i<primeCount; i++)
    {
        printf("%d ", primes[i]);
    }

}

//Calculates all prime numbers to max
void CalcPrime(__int64 max)
{
    register __int64 i;
    double square;
    primes = (__int64*)malloc(sizeof(__int64) * ARRAYMULT);
    primeCount = 0;
    arraySize = ARRAYMULT;

    //we provide the first prime because its even, and it would be convenient to start
    //at an odd number so we can skip evens.
    primes[0] = 2;
    primeCount++;

    for(i=3; i<max; i+=2)
    {
        int j;
        square = sqrt((double)i);

        //only test the current candidate against other primes.
        for(j=0; j<primeCount; j++)
        {
            //prime divides evenly into candidate, so we have a non-prime
            if(i%primes[j]==0)
                break;
            else
            {
                //if we've reached the point where the next prime is > than the square of the
                //candidate, the candidate is a prime... so we can add it to the list
                if(primes[j] > square)
                {
                    //our array has run out of room, so we need to expand it
                    if(primeCount >= arraySize)
                    {
                        int k;
                        __int64* newArray = (__int64*)malloc(sizeof(__int64) * (ARRAYMULT + arraySize));

                        for(k=0; k<primeCount; k++)
                        {
                            newArray[k] = primes[k];
                        }

                        arraySize += ARRAYMULT;
                        free(primes);
                        primes = newArray;
                    }
                    //add the prime to the list
                    primes[primeCount] = i;
                    primeCount++;
                    break;

                }
            }

        }

    }

}
int main()
{
    int max;
    time_t t1,t2;
    double elapsedTime;

    printf("Enter the max number to calculate primes for:\n");
    scanf_s("%d",&max);
    t1 = time(0);
    CalcPrime(max);
    t2 = time(0);
    elapsedTime = difftime(t2, t1);
    printf("%d Primes found.\n", primeCount);
    printf("%f seconds elapsed.\n\n",elapsedTime);
    //PrintPrimes();
    scanf("%d");
    return 1;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-09-28T01:00:19.357

@Mark Ransom -*不确定这是否是 java 代码*

他们*可能*会抱怨，但我希望使用我已经学会信任 Java 的范式重写，他们说要玩得开心，请确保他们理解规范没有说明对返回的结果集进行排序，你也会转换结果集点值（）到我在记事本中一次性完成的列表类型，然后再做一个小差事

=============== 开始未经测试的代码 ===============

```
package demo;

import java.util.List;
import java.util.HashSet;

class Primality
{
  int current = 0;
  int minValue;
  private static final HashSet<Integer> resultSet = new HashSet<Integer>();
  final int increment = 2;
  // An obvious optimization is to use some already known work as an internal
  // constant table of some kind, reducing approaches to boundary conditions.
  int[] alreadyKown = 
  {
     2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 
     43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 
     127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197,
     199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281,
     283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379,
     383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463,
     467, 479, 487, 491, 499, 503, 509, 521, 523, 541
  };
  // Trivial constructor.

  public Primality(int minValue)
   {
      this.minValue = minValue;
  }
  List calcPrimes( int startValue )
  {
      // eliminate several hundred already known primes 
      // by hardcoding the first few dozen - implemented 
      // from prior work by J.F. Sebastian
      if( startValue > this.minValue )
      {
          // Duh.
          current = Math.abs( start );
           do
           {
               boolean prime = true;
               int index = current;
               do
               {
                  if(current % index == 0)
                  {
                      // here, current cannot be prime so break.
                      prime = false;
                      break;
                   }
               while( --index > 0x00000000 );

               // Unreachable if not prime
               // Here for clarity

               if ( prime )
               {     
                   resultSet dot add ( or put or whatever it is )
                           new Integer ( current ) ;
               }
           }
           while( ( current - increment ) > this.minValue );
           // Sanity check
           if resultSet dot size is greater that zero
           {
              for ( int anInt : alreadyKown ) { resultSet.add( new Integer ( anInt ) );}
             return resultSet;
           }
           else throw an exception ....
      } 
```

=============== 结束未测试的代码 ===============

使用散列集允许将结果搜索为 B 树，因此可以将结果堆叠起来，直到机器开始出现故障，然后该起点可以用于另一块测试 == 一次运行的结束用作另一次运行的构造函数值，坚持已经完成的磁盘工作并允许增量前馈设计。现在烧坏了，循环逻辑需要分析。

补丁（加上添加 sqrt）：

```
 if(current % 5 == 0 )
  if(current % 7 == 0 )
  if( ( ( ( current % 12 ) +1 ) == 0) || ( ( ( current % 12 ) -1 ) == 0) ){break;}
  if( ( ( ( current % 18 ) +1 ) == 0) || ( ( ( current % 18 ) -1 ) == 0) ){break;}
  if( ( ( ( current % 24 ) +1 ) == 0) || ( ( ( current % 24 ) -1 ) == 0) ){break;}
  if( ( ( ( current % 36 ) +1 ) == 0) || ( ( ( current % 36 ) -1 ) == 0) ){break;}
  if( ( ( ( current % 24 ) +1 ) == 0) || ( ( ( current % 42 ) -1 ) == 0) ){break;}

// and - new work this morning:

package demo;

/**
 *
 * Buncha stuff deleted for posting .... duh.
 *
 * @author  Author
 * @version 0.2.1
 *
 * Note strings are base36
 */
public final class Alice extends java.util.HashSet<java.lang.String>
{
    // prints 14551 so it's 14 ½ seconds to get 40,000 likely primes
    // using Java built-in on amd sempron 1.8 ghz / 1600 mhz front side bus 256 k L-2
    public static void main(java.lang.String[] args)
    {
        try
        {
            final long start=System.currentTimeMillis();
            // VM exhibits spurious 16-bit pointer behaviour somewhere after 40,000
            final java.lang.Integer upperBound=new java.lang.Integer(40000);
            int index = upperBound.intValue();

            final java.util.HashSet<java.lang.String>hashSet
            = new java.util.HashSet<java.lang.String>(upperBound.intValue());//
            // Arbitraily chosen value, based on no idea where to start.
            java.math.BigInteger probablePrime
            = new java.math.BigInteger(16,java.security.SecureRandom.getInstance("SHA1PRNG"));
            do
            {
                java.math.BigInteger nextProbablePrime = probablePrime.nextProbablePrime();
                if(hashSet.add(new java.lang.String(nextProbablePrime.toString(Character.MAX_RADIX))))
                {
                    probablePrime = nextProbablePrime;
                    if( ( index % 100 ) == 0x00000000 )
                    {
                        // System.out.println(nextProbablePrime.toString(Character.MAX_RADIX));//
                        continue;
                    }
                    else
                    {
                        continue;
                    }
                }
                else
                {
                    throw new StackOverflowError(new String("hashSet.add(string) failed on iteration: "+
                    Integer.toString(upperBound.intValue() - index)));
                }
            }
            while(--index > 0x00000000);
            System.err.println(Long.toString( System.currentTimeMillis() - start));
        }
        catch(java.security.NoSuchAlgorithmException nsae)
        {
            // Never happen
            return;
        }
        catch(java.lang.StackOverflowError soe)
        {
            // Might happen
            System.out.println(soe.getMessage());//
            return;
        }
    }
}// end class Alice 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-09-28T03:41:26.787

这是我的看法。该程序是用 C 编写的，在我的笔记本电脑（Core 2 Duo，1 GB Ram）上需要 50 毫秒。我将所有计算出的素数保存在一个数组中，并且只尝试除数直到数的 sqrt。当然，当我们需要非常多的素数（尝试使用 100000000）时，这不起作用，因为数组变得太大并给出 seg 错误。

```
/*Calculate the primes till TOTALPRIMES*/
#include <stdio.h>
#define TOTALPRIMES 15000

main(){
int primes[TOTALPRIMES];
int count;
int i, j, cpr;
char isPrime;

primes[0] = 2;
count = 1;

for(i = 3; count < TOTALPRIMES; i+= 2){
    isPrime = 1;

    //check divisiblity only with previous primes
    for(j = 0; j < count; j++){
        cpr = primes[j];
        if(i % cpr == 0){
            isPrime = 0;
            break;
        }
        if(cpr*cpr > i){
            break;
        }
    }
    if(isPrime == 1){
        //printf("Prime: %d\n", i);
        primes[count] = i;
        count++;
    }

}

printf("Last prime = %d\n", primes[TOTALPRIMES - 1]);
} 
```

```
$时间./a.out
最后一个素数 = 163841
实际0m0.045s
用户 0m0.040s
系统 0m0.004s

```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-02-19T18:22:43.007

当我开始阅读这篇关于素数的博客文章时，我在机器的某个地方发现了这段代码。代码在 C# 中，我使用的算法来自我的脑海，尽管它可能在 Wikipedia 上的某个地方。;) 无论如何，它可以在大约 300 毫秒内获取前 150000 个素数。我发现n个第一个奇数之和等于n^2。同样，在维基百科的某个地方可能有一个证明。所以知道了这一点，我可以编写一个永远不必计算平方根但我必须增量计算才能找到素数的算法。所以如果你想要第 N 个素数，这个算法必须先找到 (N-1) 个前面的素数！就这样。享受！

```
 //
// Finds the n first prime numbers.
//
//count: Number of prime numbers to find.
//listPrimes: A reference to a list that will contain all n first prime if getLast is set to false.
//getLast: If true, the list will only contain the nth prime number.
//
static ulong GetPrimes(ulong count, ref IList listPrimes, bool getLast)
{
    if (count == 0)
        return 0;
    if (count == 1)
    {
        if (listPrimes != null)
        {
            if (!getLast || (count == 1))
                listPrimes.Add(2);
        }

        return count;
    }

    ulong currentSquare = 1;
    ulong nextSquare = 9;
    ulong nextSquareIndex = 3;
    ulong primesCount = 1;

    List dividers = new List();

    //Only check for odd numbers starting with 3.
    for (ulong curNumber = 3; (curNumber  (nextSquareIndex % div) == 0) == false)
                dividers.Add(nextSquareIndex);

            //Move to next square number
            currentSquare = nextSquare;

            //Skip the even dividers so take the next odd square number.
            nextSquare += (4 * (nextSquareIndex + 1));
            nextSquareIndex += 2;

            //We may continue as a square number is never a prime number for obvious reasons :).
            continue;
        }

        //Check if there is at least one divider for the current number.
        //If so, this is not a prime number.
        if (dividers.Exists(div => (curNumber % div) == 0) == false)
        {
            if (listPrimes != null)
            {
                //Unless we requested only the last prime, add it to the list of found prime numbers.
                if (!getLast || (primesCount + 1 == count))
                    listPrimes.Add(curNumber);
            }
            primesCount++;
        }
    }

    return primesCount;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-02-20T23:13:03.603

这是我的贡献：

机器：2.4GHz 四核 i7 w/8GB RAM @ 1600MHz

编译器：`clang++ main.cpp -O3`

基准：

```
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 100

Calculated 25 prime numbers up to 100 in 2 clocks (0.000002 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 1000

Calculated 168 prime numbers up to 1000 in 4 clocks (0.000004 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 10000

Calculated 1229 prime numbers up to 10000 in 18 clocks (0.000018 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 100000

Calculated 9592 prime numbers up to 100000 in 237 clocks (0.000237 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 1000000

Calculated 78498 prime numbers up to 1000000 in 3232 clocks (0.003232 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 10000000

Calculated 664579 prime numbers up to 10000000 in 51620 clocks (0.051620 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 100000000

Calculated 5761455 prime numbers up to 100000000 in 918373 clocks (0.918373 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 1000000000

Calculated 50847534 prime numbers up to 1000000000 in 10978897 clocks (10.978897 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ ./a.out 4000000000

Calculated 189961812 prime numbers up to 4000000000 in 53709395 clocks (53.709396 seconds).
Caelans-MacBook-Pro:Primer3 Caelan$ 
```

来源：

```
#include <iostream> // cout
#include <cmath> // sqrt
#include <ctime> // clock/CLOCKS_PER_SEC
#include <cstdlib> // malloc/free

using namespace std;

int main(int argc, const char * argv[]) {
    if(argc == 1) {
        cout << "Please enter a number." << "\n";
        return 1;
    }
    long n = atol(argv[1]);
    long i;
    long j;
    long k;
    long c;
    long sr;
    bool * a = (bool*)malloc((size_t)n * sizeof(bool));

    for(i = 2; i < n; i++) {
        a[i] = true;
    }

    clock_t t = clock();

    sr = sqrt(n);
    for(i = 2; i <= sr; i++) {
        if(a[i]) {
            for(k = 0, j = 0; j <= n; j = (i * i) + (k * i), k++) {
                a[j] = false;
            }
        }
    }

    t = clock() - t;

    c = 0;
    for(i = 2; i < n; i++) {
        if(a[i]) {
            //cout << i << " ";
            c++;
        }
    }

    cout << fixed << "\nCalculated " << c << " prime numbers up to " << n << " in " << t << " clocks (" << ((float)t) / CLOCKS_PER_SEC << " seconds).\n";

    free(a);

    return 0;
} 
```

这使用了 Erastothenes 筛法，我已经根据我的知识尽可能地优化了它。欢迎改进。

# php - 有没有一个网站可以简单地输出php和mysql的最新稳定版本号？

> ID：288206
> 
> 赞同：0
> 
> 时间：2008-11-13T20:40:04.110
> 
> 标签：php, mysql, versions

我想为自己编写一个小应用程序，它会通知我是否有新版本的 php 或 mysql，但我需要一个提要或一个 xml 文件来读取它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T20:55:45.000

PHP.net 提供了一个 [http://www.php.net/releases/index.php?serialize=1](http://www.php.net/releases/index.php?serialize=1)

稍后可能允许您添加其他软件的另一种方法是查看freshmeat提供的提要：http: [//freshmeat.net/projects/mysql/](http://freshmeat.net/projects/mysql/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T20:56:23.937

您可能会订阅 www.freshmeat.net 的 rss 提要，并且仅在出现偶数版本时才做出反应。

# mysql - 为什么 MySQL 不为此子查询使用索引？

> ID：288210
> 
> 赞同：0
> 
> 时间：2008-11-13T20:41:30.770
> 
> 标签：mysql, optimization, indexing, subquery

我曾经这样做：

```
SELECT layerID
FROM layers
WHERE ownerID = ?
AND collectionID = ? 
```

这会给我一个 layerID 的数组，然后我会循环并为每一个执行此操作：

```
SELECT DATA
FROM drawings
WHERE layerID = ? 
```

这一切都很好。所以现在我正尝试一步完成，所以我试试这个：

```
SELECT DATA , layerID
FROM drawings
WHERE layerID = ANY (
  SELECT layerID
  FROM layers
  WHERE ownerID = ?
  AND collectionID = ?
) 
```

但由于某种原因，它不使用索引，用于主查询，`SELECT DATA etc`！因此，与我之前执行的单独查询相比，这个组合查询需要更长的时间才能完成。（顺便说一句，子查询`SELECT layerID etc`仍然使用索引）。

我已经通过使用'EXPLAIN'语句确定它是否使用查询。

我在表中的`ownerID`和`collectionID`列以及表中的列上有单独的索引。`layers``layerID``drawings`

我的查询做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T20:52:01.950

尝试加入。ANY 最终看起来很像查询优化器的不可优化的 UNION。

```
SELECT d.DATA, d.layerID  
FROM drawings AS d  
INNER JOIN layers AS l ON d.layerID = l.layerID  
WHERE l.ownerID = ? AND l.collectionID = ? 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T21:24:39.200

我以前从未见过 ANY 关键字，但如果你尝试

```
选择数据，层ID
从图纸
层 ID 在哪里（
  选择层ID
  从层
  WHERE ownerID = ?
  AND collectionID = ?
)

```

那会有同样的问题吗？我相信不应该。但是，INNER JOIN 可能要好一些。

# c++ - 强制在 C++ 中最后销毁某些东西

> ID：288217
> 
> 赞同：6
> 
> 时间：2008-11-13T20:43:48.283
> 
> 标签：c++, destructor

我正在开发一个 C++ 应用程序，该应用程序内部有一些定期创建和销毁的控制器对象（使用新的）。这些控制器必须将自己注册到另一个对象（我们称之为controllerSupervisor），并在它们被破坏时取消注册。

我现在面临的问题是在我退出应用程序时发生的：由于破坏顺序不是确定性的，因此单个 controllerSupervisor 实例在（某些）控制器本身之前被破坏，并且当它们调用 unregister 方法时他们的析构函数，他们这样做是在一个已经被破坏的对象上。

到目前为止，我提出的唯一想法（感冒了，所以这可能并不意味着什么）不是将 controllerSupervisor 作为堆栈上的全局变量，而是在堆上（即使用 new）。但是在那种情况下，我没有删除它的地方（这都在第 3 方类型的库中）。

任何关于可能选项的提示/建议将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T20:47:39.977

自动变量（包括您在函数中使用的“正常”局部变量）的销毁顺序与它们的创建顺序相反。所以把controllerSupervisor放在最上面。

全局变量的销毁顺序也与它们的创建顺序相反，这又取决于它们的定义顺序：后来定义的对象稍后创建。但请注意：在不同的 .cpp 文件（翻译单元）中定义的对象不能保证以任何定义的顺序创建。

我认为您应该考虑按照 Mike 推荐的方式使用它：

1.  通过在第一次使用时使用单例模式（因为未定义不同翻译单元中对象的初始化顺序），通过返回指向函数静态主管对象的指针来完成创建。
2.  监督者通常被破坏（使用关于函数中静态的破坏的规则）。控制器使用监督者的静态功能取消注册。那个检查主管是否已经被破坏（检查指针`!= 0`）。如果是，那么什么都不做。否则通知主管。

因为我想可能有一个没有连接控制器的主管（如果只是临时的），智能指针不能用于自动破坏主管。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T21:36:37.117

在 Alexandrescu 的 Modern C++ Design（第 6 章，Singletons）中基本上有一整章关于这个主题。他定义了一个可以管理依赖关系的单例类，甚至在单例本身之间。

顺便说一句，整本书也强烈推荐。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T20:51:16.133

您可以使用观察者模式。控制器向其主管传达它正在被销毁。主管在销毁时会向其孩子传达同样的信息。

看看[http://en.wikipedia.org/wiki/Observer_pattern](http://en.wikipedia.org/wiki/Observer_pattern)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T21:04:45.030

几个建议：

*   使 controllerSupervisor 成为单例（或将其包装在您为此目的创建的单例对象中），通过返回指针的静态方法访问它，然后注册对象的 dtor 可以调用静态访问器（在应用程序的情况下shutdown 并且 controllerSupervisor 已被销毁将返回 NULL) 并且这些对象可以避免在这种情况下调用 de-register 方法。

*   使用 new 在堆上创建 controllerSupervisor 并使用类似的东西`boost::shared_ptr<>`来管理它的生命周期。在单`shared_ptr<>`例的静态访问器方法中分发。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T22:26:03.523

GNU gcc/g++ 为非常有用的类型提供了不可移植的属性。其中一个属性是**init_priority**，它定义了全局对象的构造顺序，因此，它们被破坏的相反顺序。来自男人：

> init_priority (优先级)
> 
> ```
>  In Standard C++, objects defined at namespace scope are guaranteed
>  to be initialized in an order in strict accordance with that of
>  their definitions _in a given translation unit_.  No guarantee is
>  made for initializations across translation units.  However, GNU
>  C++ allows users to control the order of initialization of objects
>  defined at namespace scope with the init_priority attribute by
>  specifying a relative PRIORITY, a constant integral expression
>  currently bounded between 101 and 65535 inclusive.  Lower numbers
>  indicate a higher priority.
> 
>  In the following example, `A' would normally be created before
>  `B', but the `init_priority' attribute has reversed that order:
> 
>       Some_Class  A  __attribute__ ((init_priority (2000)));
>       Some_Class  B  __attribute__ ((init_priority (543)));
> 
>  Note that the particular values of PRIORITY do not matter; only
>  their relative ordering. 
> ```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T20:58:44.293

您可以根据情况进行以下任何操作。

1.  使用 gurin 建议的观察者模式。基本上，主管通知控制器它正在下降......
2.  让主管“拥有”控制器，并在控制器出现故障时对它们的销毁负责。
3.  将控制器保存在 shared_pointers 中，这样最后倒下的人将进行真正的破坏。
4.  管理堆栈上的（指向的智能指针）控制器和主管，这将允许您确定销毁顺序
5.  其他 ...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T20:59:14.027

您可以查看使用已注册控制器的数量作为实际删除的标记。

然后删除调用只是一个请求，您必须等到控制器注销。

如前所述，这是观察者模式的一种用途。

```
class Supervisor {
public:
    Supervisor() : inDeleteMode_(false) {}

    void deleteWhenDone() {
        inDeleteMode_ = true;
        if( controllers_.empty()){
            delete this;
        }
    }

    void deregister(Controller* controller) {
        controllers_.erase(
            remove(controllers_.begin(), 
                        controllers_.end(), 
                        controller));
        if( inDeleteMode_ && controllers_.empty()){
            delete this;
        }
    }

private:

    ~Supervisor() {}
    bool inDeleteMode_;
    vector<Controllers*> controllers_;
};

Supervisor* supervisor = Supervisor();
...
supervisor->deleteWhenDone(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T21:02:18.997

它不是很优雅，但你可以这样做：

```
struct ControllerCoordinator {
    Supervisor supervisor;
    set<Controller *> controllers;

    ~ControllerDeallocator() {
        set<Controller *>::iterator i;
        for (i = controllers.begin(); i != controllers.end(); ++i) {
            delete *i;
        }
    }
} 
```

新的全球：

```
ControllerCoordinator control; 
```

在您构建控制器的任何地方，添加`control.supervisor.insert(controller)`. 在你摧毁一个的地方，添加`control.erase(controller)`. 您可以`control.`通过添加对 control.supervisor 的全局引用来避免使用前缀。

协调器的主管成员直到析构函数运行后才会被销毁，因此您可以保证主管的寿命比控制器长。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T21:20:16.793

使控制主管成为一个单身人士。确保控制构造函数在构造过程中（而不是后记）获得监督者。这保证了控制监督器在控制之前完全构建。因此，析构函数将在控制监督析构函数之前被调用。

```
class CS
{
    public:
        static CS& getInstance()
        {
            static CS  instance;
            return instance;
        }
        void doregister(C const&);
        void unregister(C const&);
    private:
        CS()
        {  // initialised
        }
        CS(CS const&);              // DO NOT IMPLEMENT
        void operator=(CS const&);  // DO NOT IMPLEMENT
 };

 class C
 {
      public:
          C()
          {
              CS::getInstance().doregister(*this);
          }
          ~C()
          {
              CS::getInstance().unregister(*this);
          }
 }; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-13T21:52:23.873

让主管负责销毁控制器怎么样？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-13T22:06:14.373

好的，正如其他地方所建议的那样，使主管成为单例（或类似的受控对象，即范围为会话）。

如果需要，在单例周围使用适当的防护装置（头顶等）。

```
// -- client code --
class ControllerClient {
public:
    ControllerClient() : 
        controller_(NULL)
        {
            controller_ = Controller::create();
        }

    ~ControllerClient() {
        delete controller_;
    }
    Controller* controller_;
};

// -- library code --
class Supervisor {
public: 
    static Supervisor& getIt() {        
        if (!theSupervisor ) {
            theSupervisor = Supervisor();
        }
        return *theSupervisor;
    } 

    void deregister(Controller& controller) {
        remove( controller );
        if( controllers_.empty() ) {
            theSupervisor = NULL;
            delete this;
        }       
    }

private:    
    Supervisor() {} 

    vector<Controller*> controllers_;

    static Supervisor* theSupervisor;
};

class Controller {
public: 
    static Controller* create() {
        return new Controller(Supervisor::getIt()); 
    } 

    ~Controller() {
        supervisor_->deregister(*this);
        supervisor_ = NULL;
    }
private:    
    Controller(Supervisor& supervisor) : 
        supervisor_(&supervisor)
        {}
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-13T22:12:47.637

虽然丑陋，但这可能是最简单的方法：

只需在取消注册调用周围尝试一下。您不必更改大量代码，而且由于应用程序已经关闭，这没什么大不了的。（或者还有其他关于关闭命令的批准吗？）

其他人指出了更好的设计，但这个很简单。（而且丑陋）

在这种情况下，我也更喜欢观察者模式。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-13T22:51:25.407

您可以使用事件来表示控制器的销毁

在 Supervisor 的析构函数中添加 WaitForMultipleObjects，它将等待所有控制器被销毁。

在控制器的析构函数中，您可以引发控制器退出事件。

您需要为每个控制器维护退出事件句柄的全局数组。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-13T23:07:33.580

当所讨论的变量都适合一个文件（“翻译单元”）时，C++ 标准指定了初始化/销毁的顺序。跨越多个文件的任何内容都变得不可移植。

我会支持让主管销毁每个控制器的建议。这是线程安全的，因为只有主管告诉任何人销毁自己（没有人自己销毁自己），所以没有竞争条件。您还必须避免任何死锁的可能性（提示：确保控制器可以在被告知后自行销毁而无需主管提供*任何其他内容）。*

* * *

即使控制器需要在程序结束之前被销毁（也就是说，如果控制器可能是短暂的）那么它们（或其他人）也可以使这个线程安全。

首先，如果我决定摧毁自己并且在几微秒后主管决定摧毁我并告诉我，这可能不是一个需要担心的竞争条件。

其次，如果您担心这种竞争条件，您可以通过要求所有销毁请求通过 Supervisor 来解决它。我想摧毁自己我要么告诉主管告诉我，要么我向主管登记这个意图。如果其他人——包括主管——想要我被摧毁，他们会通过主管来做到这一点。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-19T15:11:22.680

当我读到这个问题的标题时，我立即问自己“如果有一种方法可以确保任何对象最后被销毁（销毁？），那么如果两个对象采用该方法会发生什么？”

# spring - 如何使用 Spring Webflow 重定向到 ftp:// url？

> ID：288219
> 
> 赞同：1
> 
> 时间：2008-11-13T20:44:34.570
> 
> 标签：spring, redirect, spring-webflow

我正在尝试使用 Spring WebFlow 将计算的 url 重定向到 ftp 服务器，但在 ExternalRedirect 代码中有以下几行：

```
} else if (location.startsWith("http://") || location.startsWith("https://")) {
    sendRedirect(location, request, response);
} else {
    sendServletRelativeRedirect(location, request, response);
} 
```

有什么方法可以让 Spring WebFlow 重定向到[ftp://example.com/](ftp://example.com/)？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-06-25T23:15:48.963

你应该考虑使用这个： [http ://www.tukey.org/urlrewrite/](http://www.tuckey.org/urlrewrite/)

我在我从事的每个春季项目中都设置了它。

# sql-server - 如何将标识属性添加到 SQL Server 中的现有列

> ID：288222
> 
> 赞同：36
> 
> 时间：2008-11-13T20:47:11.397
> 
> 标签：sql-server, tsql, identity

在 SQL Server（在我的例子中，2005）中，如何使用 T-SQL 将标识属性添加到现有表列？

就像是：

```
alter table tblFoo 
    alter column bar identity(1,1) 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-13T20:59:46.443

我不相信你能做到。您最好的选择是创建一个新的标识列并使用标识插入命令复制数据（如果您确实想保留旧值）。

这是一篇体面的文章，详细描述了该过程： [http ://www.mssqltips.com/tip.asp?tip=1397](http://www.mssqltips.com/tip.asp?tip=1397)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-26T21:14:21.773

Vikash 发布的解决方案不起作用；它在 SQL Management Studio（2005 年，如 OP 指定）中产生“语法错误”错误。SQL Server的“精简版”支持这种操作只是一个捷径，因为真正的过程更像是Robert & JohnFX所说的——创建重复表，填充数据，重命名原始表和新表适当地。

如果您想保留需要成为身份的字段中已经存在的值，您可以执行以下操作：

```
CREATE TABLE tname2 (etc.)
INSERT INTO tname2 FROM tname1

DROP TABLE tname1
CREATE TABLE tname1 (with IDENTITY specified)

SET IDENTITY_INSERT tname1 ON
INSERT INTO tname1 FROM tname2
SET IDENTITY_INSERT tname1 OFF

DROP tname2 
```

当然，不建议删除并重新创建*实时代码*使用的表（tname1） ！:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T12:08:36.623

表格是否已填充？如果不删除并重新创建表。

如果填充了列中已经存在哪些值？如果它们是您不想保留的值。

根据需要创建一个新表，将旧表中的记录加载到新表中，并让数据库正常填充标识列。重命名您的原始表并将新表重命名为正确的名称:)。

最后，如果您希望标识的列当前包含主键值并且已被其他表引用，那么您将需要完全重新考虑，如果您确定这是您想要做的:)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-01-25T19:50:45.973

没有直接的方法可以做到这一点，除了：

**A) 通过 SQL**即：

```
-- make sure you have the correct CREATE TABLE script ready with IDENTITY

SELECT * INTO abcTable_copy FROM abcTable

DROP TABLE abcTable

CREATE TABLE abcTable -- this time with the IDENTITY column

SET IDENTITY_INSERT abcTable ON

INSERT INTO abcTable (..specify all columns!) FROM (..specify all columns!) abcTable_copy

SET INDENTITY_INSERT abcTable OFF

DROP TABLE abcTable_copy 

-- I would suggest to verify the contents of both tables 
-- before dropping the copy table 
```

**B）通过MSSMS**，它在后台会做同样的事情，但会减少胖手指。

*   在 MSSMS 对象资源管理器中右键单击您需要修改的表
*   选择“设计” 选择您要添加 IDENTITY 的列
*   将身份设置从 NO -> YES（可能是种子）更改
*   Ctr+S 表格

[![在此处输入图像描述](https://i.stack.imgur.com/bHbp7.png)](https://i.stack.imgur.com/bHbp7.png)

这将删除并重新创建包含所有原始数据的表。如果您收到警告：

[![在此处输入图像描述](https://i.stack.imgur.com/6ccsz.png)](https://i.stack.imgur.com/6ccsz.png)

转到 MSSMS**工具 -> 选项 -> 设计器 -> 表和数据库设计器** ，然后取消选中***“防止保存需要重新创建表的更改”选项***

**需要注意的事项：**

1.  在您执行此操作之前，您的数据库有足够的磁盘空间
2.  数据库未使用（尤其是您正在更改的表）
3.  确保在执行之前备份您的数据库
4.  如果表有很多数据（超过 1G），请先在其他地方尝试，然后再在实际数据库中使用

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-07-04T10:16:05.190

1.  创建一个新表

    ```
    SELECT * INTO Table_New FROM Table_Current WHERE 1 = 0; 
    ```

2.  从新表中删除列

    ```
    Alter table Table_New drop column id; 
    ```

3.  添加具有标识的列

    ```
    Alter table Table_New add id int primary key identity; 
    ```

4.  获取新表中的所有数据

    ```
    SET IDENTITY_INSERT Table_New ON;
    INSERT INTO Table_New (id, Name,CreatedDate,Modified) 
    SELECT id, Name,CreatedDate,Modified FROM Table_Current;
    SET IDENTITY_INSERT Table_New OFF; 
    ```

5.  删除旧表

    ```
    drop table Table_Current; 
    ```

6.  将新表重命名为旧表

    ```
    EXEC sp_rename 'Table_New', 'Table_Current'; 
    ```

* * *

## 回答 #6

> 赞同：-5
> 
> 时间：2009-02-26T15:06:57.457

```
alter table tablename 
alter column columnname 
add Identity(100,1) 
```

# xml - XSD 代码生成器

> ID：288236
> 
> 赞同：16
> 
> 时间：2008-11-13T20:51:58.020
> 
> 标签：xml, xsd, code-generation

是否有任何代码生成器可以采用格式良好的 XML 文档，并根据 XML 文档的结构写出 XSD 模式？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-19T02:49:36.623

**最佳答案，没有之一：**

[http://xsd2code.codeplex.com](http://xsd2code.codeplex.com)

我花了整整 8 小时的工作日，在所有糟糕的解决方案（XSD、CodeXS、XSDObjectGen 和其他）中一无所获，并且没有兴趣为愚蠢的商业工具支付 400 美元来做这件事。

然后我遇到了这个 codeplex 项目......哇！我这辈子在哪里？

最好的部分……它正在积极地工作，现在（2009 年），而不是 2004 年的废弃地壳堆或一些蹩脚的东西。

享受！

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-13T20:59:01.297

XSD.exe 实用程序（随 Visual Studio 一起安装）能够从 XML 文件创建 XSD 文件。

这是[MSDN上的链接](http://msdn.microsoft.com/en-us/library/x6c1kb0s(VS.71).aspx)

我相信它也可能是 .NET SDK 的一部分，这意味着您不需要完整的 Visual Studio 安装。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-13T21:52:23.747

Visual Studio 也做得很好……打开 XML 文件……从 XML 菜单中选择“生成架构”命令

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T20:20:23.827

我有点晚了，但我发现[Businessware Architects CodeXS](http://www.bware.biz/default.htm?http://www.bware.biz/DotNet/Tools/CodeXS/WebClient/GenerateInput.aspx)非常好。我发现它处理复杂的模式要好得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T11:11:44.277

我注意到它很有用。毕竟，它不能推断一切：如果一个元素存在于 XML 文档中，如何知道它是否是强制性的？

[Examplotron](http://examplotron.org/)为了实现类似的目标，至少部分依赖注释。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-30T19:02:01.207

试试 XXSd2Code。它的代码从 xsds 生成 C#、C++、Java 和 C++/CLI 绑定。 [XXSd2代码](http://xxsd2code.sourceforge.net/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-08-08T11:13:39.507

我知道的老问题，但这可能对某人有帮助：[http](http://www.freeformatter.com/xsd-generator.html) ://www.freeformatter.com/xsd-generator.html 。简单的在线工具，轻松完成工作。非常适合快速生成 XML 模式。

# algorithm - 什么是图中的最小路径？

> ID：288244
> 
> 赞同：2
> 
> 时间：2008-11-13T20:54:38.590
> 
> 标签：algorithm, language-agnostic, graph-theory, shortest-path

在图论中，最小距离（Dijkstra 算法发现）和最小路径（我不确定它是什么）之间的区别是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T21:26:45.280

最小路径是遍历时覆盖两条边之间距离最小的边的集合。最小距离是最小路径的边缘之间的距离之和。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T21:29:08.710

距离是标量；一个号码。path 是顶点/边对的列表？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T21:18:13.147

最小距离 = 边缘权重的最小总和。最小路径 = 最少边。

即// 从温哥华飞往多伦多，然后飞往温尼伯的路径更短，尽管从温哥华飞往卡尔加里，再到里贾纳，然后到温尼伯的距离更短。

编辑：我想把它翻过来。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-04-03T10:00:41.023

让我在具有源和接收器的网络范围内回答这个问题。我想区分最短路径和最小路径，其中路径由一组边定义。

最短路径是从源到汇的具有最短对应距离的路径。最小路径可以是任何将源连接到接收器的路径，只要

i) 它不包含循环；和

ii) 从路径中移除任何边缘意味着源和接收器之间不再存在连接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T20:57:50.987

我不是 100% 确定，但听起来最小路径将是遍历从顶点 A 到顶点 B 的最小距离路径时访问的顶点列表。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-11-13T20:57:51.453

最小距离与最小路径相同。

# windows - 控制台应用程序的 Windows 默认大小

> ID：288255
> 
> 赞同：15
> 
> 时间：2008-11-13T20:56:33.923
> 
> 标签：windows, command-line, console, cmd

在测试控制台应用程序时，我将控制台窗口的属性设置为只有 3 行高。

这种变化不知何故卡住了，这意味着新的控制台窗口默认为 3 行高。如果我在桌面上创建一个新的快捷方式，并将其指向 cmd.exe，打开的窗口是 3 行高。

当然，我可以使用属性面板更改此值，这最终会导致“仅当前窗口”/“具有相同标题的未来窗口”/“启动此窗口的快捷方式”对话框来更改设置的粘性。这些选择都不会导致更改默认值。如果随后我为 cmd.exe 创建了一个新的快捷方式，它仍然是 3 行高。

主要问题是，对于我编写的任何新控制台应用程序，第一次调试时，我必须更改大小设置，而当我运行发布版本时，情况也是如此。

有谁知道新（即新标题或来自新快捷方式）控制台应用程序的默认设置存储在哪里/如何更改它们？

[而且，是的，我感觉自己像个布偶，但我在任何地方都找不到这个信息！]

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-13T21:04:26.700

而不是使用属性菜单项 - 使用默认菜单项。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-13T21:02:42.613

它们存储在注册表中：

```
HKEY_CURRENT_USER\Console 
```

# java - 使用 IBATIS 进行 INSERTS 的最快方法

> ID：288256
> 
> 赞同：4
> 
> 时间：2008-11-13T20:56:46.543
> 
> 标签：java, ibatis, bulkinsert

我需要使用 iBatis 在单个表 (SQL Server 2005) 中插入 20,000 行。最快的方法是什么？我已经在使用批处理模式，但它并没有太大帮助：

```
try {
  sqlMap.startTransaction();
  sqlMap.startBatch();
  // ... execute statements in between
  sqlMap.commitTransaction();
} finally {
  sqlMap.endTransaction();
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T21:51:22.500

除了其他人提到的批量加载程序，让我们考虑如何通过 SQL 最好地做到这一点。（如果您将混合数据发送到不同的表，则批量加载程序无法正常工作。）

首先，您不应该使用您正在使用的任何抽象层，在本例中为 iBatis，因为它实际上不会为您提供很少的价值，但该抽象层将有一些（不一定很多，但一些）CPU 成本。您真的应该简单地使用原始数据库连接。

接下来，您将发送一堆 INSERT 语句。问题是您是否应该对语句使用简单的字符串（即 INSERT INTO TABLE1 VALUES('x','y', 12)）与准备好的语句（INSERT INTO TABLE1 VALUES(?, ?, ?)）。

这将取决于您的数据库和数据库驱动程序。

使用简单字符串的问题基本上是从内部格式（假设您正在插入 Java 数据）到字符串的转换成本。将数字或日期转换为字符串实际上是相当昂贵的 CPU 操作。一些数据库和驱动程序将直接处理二进制数据，而不是简单的字符串数据。因此，在这种情况下，PreparedStatement 可以节省一些 CPU，因为可能不必转换数据。

缺点是这个因素会因 DB 供应商而异，甚至可能因 JDBC 供应商而异。例如，Postgres（我相信）只适用于 SQL 字符串，而不是二进制，所以使用 PreparedStatement 比简单地自己构建字符串是一种浪费。

接下来，一旦你有了你的语句类型，你就想使用 JDBC Statement 类的[addBatch](http://java.sun.com/j2se/1.5.0/docs/api/java/sql/Statement.html#addBatch(java.lang.String)) () 方法。addBatch 所做的是将 SQL 语句分组到一个批处理中。好处是，您无需向数据库发送多个请求，而是发送一个 LARGE 请求。这减少了网络流量，并将显着提高吞吐量。

细节是不是所有的驱动程序/数据库都支持 addBatch （至少不是很好），而且你的批处理的大小是有限的。您很可能无法为所有 20,000 行添加批处理并期望它能够正常工作，尽管那将是最好的选择。此限制也可能因数据库而异。

对于 Oracle，过去，我使用 64K 的缓冲区。基本上，我编写了一个包装函数，该函数将采用文字 INSERT 语句，并将它们累积成 64K 批次。

因此，如果您想通过 JDBC 通过 SQL 批量插入数据，这些方法就是这样做的。最大的改进是批处理模式，Statement 与 PreparedStatement 更可能节省一些 CPU，如果您的驱动程序支持二进制协议，可能还会节省网络流量。

测试、冲洗并重复，直到您满意为止。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T21:21:54.510

虽然这不是特定于您的数据库服务器，但我之前已经成功地将行以 csv 格式写入本地文件，然后让数据库导入文件。这比插入语句甚至批量插入要快得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T21:23:58.780

在 SQL Server 中，批量插入记录的最快方法是使用[BULK INSERT](http://msdn.microsoft.com/en-us/library/ms188365.aspx)。但是，此方法从文本文件而不是直接从您的应用程序加载记录。

它也没有考虑创建文件所花费的时间。如果这抵消了实际插入的任何速度增益，您可能需要权衡。请记住，即使这总体上慢一点，您最终会占用更少的数据库服务器时间。

您可能会尝试的唯一另一件事是将批处理插入（暂存）到一个完全不同的表中（没有索引或任何东西）。然后将记录从该临时表移动到您的目标表并删除临时表。这将首先将数据移动到服务器，以便最终插入都可能发生在 sql server 本身。但同样：这是一个两步的过程，所以你必须计算这两个步骤的时间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T21:02:02.570

批量插入最好使用数据库自​​己的批量加载工具来完成。例如，对于 Oracle，它是 SQL*Loader。通常这些比你写的任何东西都要快。

# c# - 有没有办法从 System.Windows.Forms.HtmlElement 转换为 mshtml.IHTMLElemenet3？

> ID：288258
> 
> 赞同：2
> 
> 时间：2008-11-13T20:57:06.963
> 
> 标签：c#, .net, html, vb.net

有没有办法从 System.Windows.Forms.HtmlElement 转换为 mshtml.IHTMLElemenet3？

--edit after answer接受 -- 这就是代码的样子。

```
HtmlElement myElement = getElementByID(id);
IHTMLElement3 h3 = (IHTMLElement3) myElement.DomElement; 
```

谢谢@korchev

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T22:23:10.033

只需将 DomElement 属性转换为 mshtml.IHTMLElement3

# sql-server - SQL Server 2005 和 iTunes 库

> ID：288270
> 
> 赞同：1
> 
> 时间：2008-11-13T20:58:52.467
> 
> 标签：sql-server, itunes

将 iTunes 库 xml 批量加载到现有 SQL Server 数据库中的最简单方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T21:53:20.283

带有 xml 标志的 bcp。

[http://msdn.microsoft.com/en-us/library/ms162802.aspx](http://msdn.microsoft.com/en-us/library/ms162802.aspx)

这真的取决于你想要它在那里的方式以及你的目的是什么，你还没有解释过。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:03:44.250

我建议查看 iTunes COM 接口。有一个简单易用的 C# SDK，文档也很好。你可以在这里下载它：[SDK](http://developer.apple.com/sdk/itunescomsdk.html)

# asp.net - 我是否对 GridView 使用 RowDataBound 或 DataBound

> ID：288274
> 
> 赞同：13
> 
> 时间：2008-11-13T21:00:39.703
> 
> 标签：asp.net, data-binding

根据 GridView 的 VS 2008 属性：

*   DataBound 在控件被数据绑定后触发。
*   RowDataBound 在行数据绑定后触发。

如果我想操作标题列中的文本，使用 DataBound 或 RowDataBound 是否重要，因为我总是可以只检查 e.Row.RowType。除了明显的区别之外，还有实际的区别吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-13T21:16:32.883

DataBound 在所有 RowDataBound 事件完成触发后发生，因此控件只触发一次。如果你只有一件事要做，把它放在 DataBound 方法中。如果它需要在任意行上发生，请在 RowDataBound 中执行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T21:19:09.663

您希望在单行中自定义某些**内容**。我会使用 RowDataBound。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-09-25T07:21:15.540

**RowDataBound**事件在后端表中的行与 gridview 中的数据行绑定的数据字段之后触发。

现在我们在网格（前端）中拥有所有可用数据。我们可以根据**RowDataBound**事件中的数据来操作或自定义我们的网格。

意味着，我们需要为自定义编写的代码（例如颜色更改等）可以在**RowDataBound**事件中编写。

# javascript - 用于 div 标签的 JavaScript RegEx

> ID：288277
> 
> 赞同：7
> 
> 时间：2008-11-13T21:01:00.903
> 
> 标签：javascript, regex

我有一个保存 HTML 页面的 JavaScript 变量，由于设置的原因，我需要使用 JavaScript 从该变量`<div id="LiveArea">`之间提取所有内容。`</div>`

任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-03-19T08:01:24.797

```
var html = "<stuff><div id=\"LiveArea\">hello stackoverflow!</div></stuff>";

var matches = html.match(/<div\s+id="LiveArea">[\S\s]*?<\/div>/gi);
var matches = matches[0].replace(/(<\/?[^>]+>)/gi, ''); // Strip HTML tags?

alert(matches); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T21:17:47.140

*除非*该 div 中的 HTML 不包含其他 div，否则仅使用正则表达式是不可能的。因为像 Jeremy 这样的模式会发生什么，它将匹配第一个结束 div 标记，这不一定是 div#LiveArea 元素的结束标记。

如果您可以控制源 HTML，则可以插入一条注释，用于匹配正确的“关闭”位置。

还有其他仅限 javascript 的选项，但它们都非常笨拙或 hacky

1.  将隐藏元素的 innerHTML 设置为等于此内容字符串，然后使用 mmattax 的解决方案拉取您需要的 innerHTML。但是您可能必须在这里执行第二步并设置一个超时时间，以便让浏览器有时间评估这个新的 HTML 并将其公开给 DOM。
2.  实际解析内容，在遇到它们时跟踪打开/关闭 div，这样您就会知道何时处于正确的`</div>`标签。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T21:11:32.970

这应该这样做：

```
pattern = /<div id="LiveArea">(.*?)<\/div>/;
matches = your_html_var.match(pattern);
the_string = matches[0];

document.write(the_string); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T21:23:20.453

```
var temp = document.createElement('DIV');
temp.innerHTML = YourVariable;
var liveArea;
for (var i = 0; i < temp.childNodes.length; i++)
{
   if (temp.childNodes[i].id == 'LiveArea')
   {
       liveArea = temp.childNodes[i];
       break;
   }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T21:04:39.757

当您说“包含 html 页面的 Javascript 变量”时，我不确定我是否跟随您，但是如果您需要在这样的 div 之间提取 HTML，您可以使用元素的 innerHTML 属性。

```
 var e = document.getElementById('LiveArea');
if(e) alert(e.innerHTML); 

```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T22:15:12.797

我发现这篇[文章](http://www.codeproject.com/KB/aspnet/PrintPreview.aspx)在网上冲浪，它采用 DIV id 并将其显示在新页面上以打印它；

```
function getPrint(print_area)
{
//Creating new page
var pp = window.open();
//Adding HTML opening tag with <HEAD> … </HEAD> portion 
pp.document.writeln('<HTML><HEAD><title>Print Preview</title>')
pp.document.writeln('<LINK href=Styles.css type="text/css" rel="stylesheet">')
pp.document.writeln('<LINK href=PrintStyle.css ' + 
                    'type="text/css" rel="stylesheet" media="print">')
pp.document.writeln('<base target="_self"></HEAD>')

//Adding Body Tag
pp.document.writeln('<body MS_POSITIONING="GridLayout" bottomMargin="0"');
pp.document.writeln(' leftMargin="0" topMargin="0" rightMargin="0">');
//Adding form Tag
pp.document.writeln('<form method="post">');

//Creating two buttons Print and Close within a HTML table
pp.document.writeln('<TABLE width=100%><TR><TD></TD></TR><TR><TD align=right>');
pp.document.writeln('<INPUT ID="PRINT" type="button" value="Print" ');
pp.document.writeln('onclick="javascript:location.reload(true);window.print();">');
pp.document.writeln('<INPUT ID="CLOSE" type="button" ' + 
                    'value="Close" onclick="window.close();">');
pp.document.writeln('</TD></TR><TR><TD></TD></TR></TABLE>');

//Writing print area of the calling page
pp.document.writeln(document.getElementById(print_area).innerHTML);
//Ending Tag of </form>, </body> and </HTML>
pp.document.writeln('</form></body></HTML>'); 
```

}

您将调用此脚本发送您想要获取的 DIV id；

```
btnGet.Attributes.Add("Onclick", "getPrint('YOURDIV');") 
```

它完全按照我的意愿工作。希望能帮助到你

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-12-02T12:31:03.960

使用以下正则表达式：

```
<div id="[^"]*">(.*?)</div> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-09T20:56:07.333

似乎javascript不支持非常令人失望的lookbehinds，这将使这个问题更容易解决。

`(?<=<div id="LiveArea">).*(?=<\/div>)`

这里有一些可能会有所帮助的链接。

*   [匹配html标签](http://www.pagecolumn.com/tool/all_about_html_tags.htm)
*   [模仿javascript中的lookbehinds](http://blog.stevenlevithan.com/archives/mimic-lookbehind-javascript)

虽然在讨论嵌套标签的问题时......这超出了正则表达式的能力范围，所以杰里米的解决方案是你可以用正则表达式做的最好的。更重要的是，它们必须在一行中......如果 div 的内容在单独的行上，它甚至都不匹配，因为 javascript 没有“s”标志。我认为彼得已经给出了这个答案。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-03-20T07:33:09.447

让 jQuery 为你做解析：

```
$(page_html).find("#LiveArea").html(); 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2010-03-20T07:28:02.930

很抱歉回复晚了，如果其他人偶然发现这个问题，这是我的建议，假设您可以访问您正在从源代码阅读的页面。

添加这样的 HTML 注释

```
<div id="LiveArea">
<!--LiveArea-->
Content here
<!--EndLiveArea-->
</div> 
```

然后将其与

```
htmlVal.match(/<\!\-\-LiveArea"\-\->(.*?)<\!\-\-EndLiveArea"\-\->/); 
```

# c++ - VC++ 如何处理局部静态变量名？

> ID：288282
> 
> 赞同：6
> 
> 时间：2008-11-13T21:02:17.827
> 
> 标签：c++, scope

这是我的一些代码：

```
MyClass* MyClass::getInstance()
{
   static MyClass instance;
   return &instance;
} 
```

我想看看这个单身人士的当前值。但我目前在执行过程中暂停了三个小时，我暂停的原因是我内存不足。所以我不能在这个方法中放一个断点来查看值是什么。

那么我的问题是如何`instance`从全局范围内引用这个变量。我试过把它称为，`MyClass::getInstance::instance`但这不起作用。我猜`getInstance`必须以某种方式装饰。有谁知道怎么做？

这是在 Visual Studio 2008 中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-15T19:41:44.243

好吧，函数范围的静态`instance`变量不会出现在由`.map`生成的文件中`cl.exe /Fm`，并且在我在 WinDbg 中使用时也不会出现`x programname!*MyClass*`，因此损坏的名称似乎根本不包含`MyClass`。

**选项 1：拆卸`MyClass::getInstance`**

这种方法似乎更容易：

```
0:000> uf 程序名！MyClass::getInstance
程序名！MyClass::getInstance [程序名.cpp @ 14]：
   14 00401050 55 推 ebp
   14 00401051 8bec 移动 ebp,esp
   15 00401053 a160b34200 mov eax,dword ptr [程序名！$S1 (0042b360)]
   15 00401058 83e001 和 eax,1
   15 0040105b 7526 jne funcstat!MyClass::getInstance+0x33 (00401083)

程序名！MyClass::getInstance+0xd [程序名.cpp @ 15]：
   15 0040105d 8b0d60b34200 mov ecx,dword ptr [程序名！$S1 (0042b360)]
   15 00401063 83c901 或 ecx,1
   15 00401066 890d60b34200 mov dword ptr [程序名！$S1 (0042b360)],ecx
   15 0040106c b9b0be4200 mov ecx，偏移程序名！实例（0042beb0）
   15 00401071 e88fffffff 调用程序名！ILT+0(??0MyClassQAEXZ) (00401005)
   15 00401076 68e03e4200 推送偏移程序名！`MyClass::getInstance'::`2'::`'instance' (00423ee0) 的动态 atexit 析构函数
   15 0040107b e8f3010000 调用程序名！atexit (00401273)
   15 00401080 83c404 添加 esp,4

程序名！MyClass::getInstance+0x33 [程序名.cpp @ 16]：
   16 00401083 b8b0be4200 mov eax，偏移程序名！实例（0042beb0）
   17 00401088 5d 弹出 ebp
   17 00401089 C3 RET

```

由此我们可以看出编译器调用了对象`$S1`。当然，这个名称将取决于您的程序有多少函数范围的静态变量。

**选项 2：在内存中搜索对象**

为了扩展@gbjbaanb 的建议，如果`MyClass`有虚函数，您可能会很难找到它的位置：

*   对进程进行完整的内存转储。
*   将完整的内存转储加载到 WinDbg。
*   使用`x`命令查找 MyClass 的 vtable 的地址：

```
    0:000> x 程序名！MyClass::`vftable'
    00425c64 程序名！MyClass::`vftable' =

```

*   使用`s`命令搜索进程的虚拟地址空间（在本例中为 0-2GB）以查找指向 MyClass 的 vtable 的指针：

```
    0:000> s -d 0 L?7fffffff 00425c64
    004010dc 00425c64 c35de58b cccccccc cccccccc d\B...].........
    0040113c 00425c64 8bfc458b ccc35de5 cccccccc d\B..E...]......
    0042b360 00425c64 00000000 00000000 00000000 分贝......

```

*   使用该`dt`命令查找类的 vtable 偏移量，并从搜索返回的地址中减去该偏移量。这些是对象的可能地址。

```
    0:000> dt 程序名！MyClass
       +0x000 __VFN_table : Ptr32
       +0x008 x : Int4B
       +0x010 y : 浮动

```

*   用于`dt programname!MyClass 0042b360`检查对象的成员变量，检验对象位于 0042b360（或其他地址）的假设。正如我在上面所做的那样，您可能会得到一些误报，但是通过检查成员变量，您可能能够找出哪个是您的单例。

这是一种查找 C++ 对象的通用技术，当您可以反汇编时，这有点矫枉过正`MyClass::getInstance`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T21:11:55.217

在 gdb 中，您可以将观察点放在变量的损坏名称上。

例如，使用此功能：

```
int f() {
    static int xyz = 0;
    ++xyz;

    return xyz;
} 
```

我可以观看 _ZZ1fvE3xyz（被 gcc 3.2.3 或 gcc 4.0.1 破坏）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T02:53:54.810

该代码看起来很危险...... :-)

但无论如何，你的名字将取决于你的[调用约定](http://www.codeproject.com/KB/cpp/calling_conventions_demystified.aspx) 所以在你找到你的名字之前，你需要知道你的构建环境使用什么作为调用约定。MSDN 有更多关于调用约定的信息。

除此之外，找出关于你的类的所有这些信息的一种方法是检查你的 VTable，它位于对象的前 4 个字节中。逆向器使用的一个绝妙技巧是隐藏的 VC++ 标志[reportSingleClassLayout](http://blogs.msdn.com/vcblog/archive/2007/05/17/diagnosing-hidden-odr-violations-in-visual-c-and-fixing-lnk2022.aspx)，它以 ASCII 艺术方式打印类结构。

# c# - 如何使用 HTTPHandler 记录跨域 Intranet 流量（包括用户名）？

> ID：288287
> 
> 赞同：0
> 
> 时间：2008-11-13T21:02:43.443
> 
> 标签：c#, asp.net, javascript, security, iis

我正在尝试记录几个**内部**网站以及我们的 SharePoint 网站的用户活动。我使用 JavaScript 对返回 1x1 不可见 GIF 的 ashx 页面 (HTTPHandler) 进行调用 (GET)。HTTPHandler 获取引用 URL、浏览器信息、IP 地址、操作（作为 QueryString 发送）和（我正在努力的部分）用户名。用户名是使用 HTTPHandler 中的 context.User.Identity 收集的，并且在 IIS 6 中启用了“集成 Windows 身份验证”。这是 js 的日志记录部分：

```
 logAction: function(action) {
    try {
        var i = new Image(1, 1);
        i.src = "http://intranet/tracker/urchin.ashx?action=" + action;
    } catch (e) {
        //alert(e);
    } 
```

*使用 jQuery，我向按钮单击、链接单击和“卸载”添加了处理程序，它们调用 ashx 文件并传递执行的操作。（它也被称为页面加载）。*

所有这一切都工作得很好，或者我想......结果我错过了用户第一次打开其中一个页面时的初始页面加载事件，如果它与 HTTPHandler 不在同一个域中。使用[Fiddler](http://www.fiddler2.com/fiddler2/)，我可以看到页面的 NTLM 循环（401.2、401.1、200），但 ashx 只能看到 401.2。**当对 HTTPHandler 的调用是跨域的时，浏览器**似乎不会发送用户凭据。用户访问的下一页被正确记录，但第一页没有被记录。

以下是我们的域名：

*   [http://内联网](http://intranet)
*   [http://sharepoint](http://sharepoint)
*   [http://dev](http://dev) <-- 用于追踪生命的 HTTPHandler 在这里

我的设计有问题吗，或者这仅仅是网络浏览器的安全性？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T22:43:42.973

您可能希望看到这个：http: [//developer.yahoo.com/javascript/howto-proxy.html](http://developer.yahoo.com/javascript/howto-proxy.html)

它可能无法解决您遇到的问题（我现在无法为您提供准确的技术答案），但上面的链接会警告您必须注意的问题/设计决策/安全注意事项与您要实现的目标。你是对的，存在浏览器安全问题，我知道的就这么多。

还可以在谷歌上搜索跨域 ajax 代理。那里给你一些好读物！

祝你好运！

# java - 在使用 LdapContext 的 Websphere 6.x LDAP 查询中，凭据的传输是否加密？

> ID：288289
> 
> 赞同：2
> 
> 时间：2008-11-13T21:02:51.977
> 
> 标签：java, authentication, ldap, jndi

在 Websphere 中，当您使用 LdapContext 进行 LDAP 查询时，凭据的传输是否加密？

```
LdapContext ctx = new InitialLdapContext (env, null); 
```

假设我为 Web 应用程序创建了一个 LdapContext 来执行一些自定义 LDAP 调用。

我如何知道我的通话是否安全/加密？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T16:32:52.387

为了保护/加密您的 LDAP 调用，您需要发出“开始 TLS”操作。

否则我认为传输是纯文本。

更多：

[http://java.sun.com/products/jndi/tutorial/ldap/ext/starttls.html](http://java.sun.com/products/jndi/tutorial/ldap/ext/starttls.html)

显然，Java API 是基于 LDAP 本身的。因此，您可以了解有关协议本身如何处理它的更多信息......即：

[http://en.wikipedia.org/wiki/Ldap#StartTLS](http://en.wikipedia.org/wiki/Ldap#StartTLS)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-04T20:30:15.010

使用 ethereal 或 wireshark 并窥探您的 LDAP 连接以检查它是否已加密。如果它已加密，那就太好了，如果没有，请尝试 Michael Sharek 的建议。

如果您发现绝对无法使用代码设置加密，那么您可以使用 stunnel。使用 stunnel，您将与 localhost 上的端口建立不安全的连接，stunnel 正在侦听该端口，使用 SSL 加密所有内容，然后将信息发送到 LDAP 服务器。在使用没有网络安全概念的 3rd 方应用程序时非常有用。

# linux - Bash Shell 脚本：我缺少什么简单的逻辑

> ID：288294
> 
> 赞同：6
> 
> 时间：2008-11-13T21:04:04.500
> 
> 标签：linux, bash, shell, pid

这可能是一个太笼统的问题，但是......我试图从 shell 脚本中移动目录而感到难过。我不是 *nix 高级用户，但我很乐意通过命令行完成大多数任务。我想调用一个可以将“我”移动到目录的脚本，而不仅仅是类似于以下的脚本过程：

```
prompt:> goto lit 
```

where `goto`是别名 ->`goto='./goscript'`
并且
`goscript`有一些简单的代码，例如：

```
cd /path to work dirs/lit/user dir 
```

（假设每个用户在 /lit 中都有一个目录）

我自己通过设置我的个人别名'移动到所需的目录，运行脚本，然后返回到原始目录来避免这个问题。这个问题是由一位使用类似方法的同事向我提出的，但他想让这个过程更通用，这样我们就不需要创建我们需要的每一个别名。我认为这将是一个容易解决的问题，但我很难过，因为我还没有大量的 shell 脚本编写经验……到目前为止。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T21:20:18.507

甚至比使用其他人描述的别名更好，检查`CDPATH`变量！它基本上等同于`PATH`功能，但适用于*cd*命令。

例如，如果我定义我`CDPATH`的 as `$CDPATH:${HOME}/subdir`，并`~/subdir`包含另一个目录，`subsubdir`，那么我可以简单地执行：

```
cd subsubdir 
```

从任何目录，并按预期导航路径。

这里有一些更具体的：

[http://www.caliban.org/bash/#bashtips](http://www.caliban.org/bash/#bashtips)

要设置`CDPATH`变量，请在您的 中添加一行`.bashrc`，例如

```
export CDPATH=$CDPATH:${HOME}/subdir 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T21:11:09.650

您可以创建一个名为 goto （或其他）的函数，并确保它在您的 .bashrc 中定义（或者您可以从当前的 shell 中“获取”它）：

```
function goto {
    #  the "$USER" part will expand to the current username
    # the "$1" will expand to the first argument to the function ("goto xyz" => $1 is "xyz")
    cd /some-path/lit/$USER/$1
} 
```

将其放入 ~/.bashrc 或单独的文件中，然后从提示符中调用“source the-file”，然后您可以像任何其他程序一样调用该函数：

```
prompt> goto folder
 cd /some-path/lit/your-user/folder 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T21:11:12.380

要在提示的同一环境中执行脚本，您必须使用 .

假设您已命名脚本：

```
cd .. 
```

如果你用 . 你得到：

```
$> pwd
$> /home/users/rd/proj
$> . up
$> pwd
$> /home/users/rd 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T21:06:20.860

你不能。该脚本有自己的环境副本，因此它不能更改登录 shell 的环境。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T03:49:49.893

当我问这个问题时，我不是会员（具有讽刺意味的是，我的匿名登录问题比我的官方登录问题的总和更高），所以我现在无法关闭它 - 但是 - The Remo D. et al. 答案将是导致我们需要的有效解决方案的答案。如果任何具有 mod 权力的人都可以关闭它并选择它作为接受的答案，我会认可它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T21:07:36.600

您不能在 bash 脚本中使用 cd 。不过，您可以为 cd 和路径取别名。

```
alias goto='cd /path_to_work/usr/dir' 
```

更新：您可以将该行放入 .bashrc 文件中，然后执行

```
source ~/.bashrc 
```

创建别名。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T21:08:58.670

您可以使用别名来完成一些简单的事情。例如，我有一些别名将我放入工作空间环境并为我们的 Makefile 系统配置变量。这是我用作示例的真实别名。'&&' 将继续执行命令，直到其中一个失败 - 在这样的简单场景中，不需要清理，因为不太可能失败。

```
alias main1='cd ~/code/main1 && export TOP=`pwd` && export DEBUG=1' 
```

如果您想在您的同事之间开发一个共享别名库，您可以通过 NFS 共享它们并获取要包含的文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T21:09:57.653

每个脚本对当前工作目录都有自己的想法。“cd”不是一个进程，而是一个 shell 内置。

做你想做的事情的方法是创建一个别名。在 csh 中，它将类似于：

```
alias goto 'cd /path_to_work/\!*/user_dir' 
```

sh/bash 有类似的别名功能

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T21:13:25.620

我的 .rc 中往往有几十个别名，如下所示：

```
alias work='cd /home/foo/work'
alias rails='cd /home/foo/rails'
alias assets='cd /home/foo/rails/assets' 
```

等等

如果这对您不起作用，您可以使用 bash 中的调试挂钩在执行之前就地替换命令行 - 如果“goto”关键字是该行的第一件事。这将涉及在 bash 中搜索“陷阱”，但请注意，此类咒语在所有系统上的行为都不相同。几个月前我写了一篇这样的经历，欢迎你来看看[结果](http://foodini.org/permalink.cgi?link=20080816)。

# visio - 链接图像

> ID：288296
> 
> 赞同：1
> 
> 时间：2008-11-13T21:04:33.080
> 
> 标签：visio

我已经做到了，当我在 Visio 中双击某些图像时，它会将您带到另一个页面。有没有办法可以将图像识别为链接，这样如果我将它发送给某人，他们就会知道点击它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T23:17:15.153

首先形状的外观可以很多暗示形状是一个链接。请参阅“页外连接符”形状

还要看看“页外参考”形状是如何实现的。除了双击事件之外，它还使用超链接。当您将鼠标悬停在形状上时，这会导致指针发生变化。

不幸的是，这两种方法都建议形状链接某处，但不告诉您必须**双击**才能访问该链接。

# .net - 代码文档：多少算太多？

> ID：288298
> 
> 赞同：8
> 
> 时间：2008-11-13T21:04:41.237
> 
> 标签：.net, sandcastle, xml-comments, code-documentation, ndoc

您的 .NET 源代码中有多少代码文档太多了？

一些背景：我继承了我在 SO 上发布的其他一些问题中谈到的大型代码库。该代码库的“特性”之一是 God Class，它是一个具有超过 3000 行代码的单个静态类，包含几十个静态方法。这是从`Utilities.CalculateFYBasedOnMonth()`到`Utilities.GetSharePointUserInfo()`到的一切`Utilities.IsUserIE6()`。这都是[不需要重写](http://www.joelonsoftware.com/printerFriendly/articles/fog0000000069.html)的好代码，只需重构为一组适当的库。我已经计划好了。

由于这些方法正在进入一个新的业务层，而我在这个项目中的角色是准备系统以供其他开发人员维护，我正在考虑可靠的代码文档。尽管这些方法都具有良好的内联注释，但它们并不都具有 XML 注释形式的良好（或任何）代码文档。使用 GhostDoc 和 Sandcastle（或 Document X）的组合，我可以创建一些非常漂亮的 HTML 文档并将其发布到 SharePoint，这将使开发人员无需浏览代码本身就可以更多地了解代码的作用。

随着代码中文档数量的增加，导航代码变得越困难。我开始怀疑 XML 注释是否会使代码更难维护，比方说，`//comment`每个方法都更简单。

这些示例[来自 Document X 示例](http://www.innovasys.com/products/dx2008/overview.aspx)：

```
 /// <summary>
        /// Adds a new %Customer:CustomersLibrary.Customer% to the collection.
        /// </summary>
        /// <returns>A new Customer instance that represents the new customer.</returns>
        /// <example>
        ///     The following example demonstrates adding a new customer to the customers
        ///     collection. 
        ///     <code lang="CS" title="Example">
        /// CustomersLibrary.Customer newCustomer = myCustomers.Add(CustomersLibrary.Title.Mr, "John", "J", "Smith");
        ///     </code>
        ///     <code lang="VB" title="Example">
        /// Dim newCustomer As CustomersLibrary.Customer = myCustomers.Add(CustomersLibrary.Title.Mr, "John", "J", "Smith")
        ///     </code>
        /// </example>
        /// <seealso cref="Remove">Remove Method</seealso>
        /// <param name="Title">The customers title.</param>
        /// <param name="FirstName">The customers first name.</param>
        /// <param name="MiddleInitial">The customers middle initial.</param>
        /// <param name="LastName">The customers last name.</param>
        public Customer Add(Title Title, string FirstName, string MiddleInitial, string LastName)
        {
            // create new customer instance
            Customer newCust = new Customer(Title, FirstName, MiddleInitial, LastName);

            // add to internal collection
            mItems.Add(newCust);

            // return ref to new customer instance
            return newCust;
        } 
```

和：

```
 /// <summary>
    /// Returns the number of %Customer:CustomersLibrary.Customer% instances in the collection.
    /// </summary>
    /// <value>
    /// An Int value that specifies the number of Customer instances within the
    /// collection.
    /// </value>
    public int Count
    {
        get 
        {
            return mItems.Count;
        }
    } 
```

所以我想问您：您是否使用 XML 注释来记录您的**所有**代码，目的是使用 NDoc (RIP) 或 Sandcastle 之类的东西？如果没有，您如何决定哪些获取文档，哪些不获取？像 API 之类的东西显然会有 doco，但是你要交给另一个团队来维护的代码库呢？

你觉得我应该怎么做？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T10:35:38.123

没有人提到您的代码不需要臃肿，XML 文档可以在另一个文件中：

```
/// <include file="Documentation/XML/YourClass.xml" path="//documentation/members[@name='YourClass']/*"/> 
```

然后，您的 Add 方法不能在其上方包含任何额外的 XML/注释，或者如果您只喜欢摘要（因为它与单独的文件合并）。

它比您在 PHP/Javascript 中找到的 Javadoc 及其衍生格式的垃圾格式强大得多（尽管 Javadoc 为 XML 语法铺平了道路）。此外，可用的工具要好得多，帮助文档的默认外观更具可读性和更易于定制（我可以说，通过编写 doclet 并将该过程与 Sandcastle/DocProject/NDoc 进行比较）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T21:22:42.497

我认为这里问题的很大一部分是 MS 强加给我们的冗长而粗暴的 XML 文档语法（JavaDoc 也好不了多少）。如何格式化的问题在很大程度上与合适的程度无关。

对注释使用 XML 格式是可选的。您可以使用 DOxygen 或其他识别不同格式的工具。或者编写自己的文档提取器——做一份合理的工作并不像你想象的那么难，而且是一次很好的学习经历。

多少的问题更困难。如果您正在深入研究维护一些代码，我认为自我记录代码的想法很好。如果您只是客户，则无需阅读代码即可了解给定功能的工作原理。当然，很多信息都隐含在数据类型和名称中，但也有很多不是。例如，传入对对象的引用会告诉您预期的内容，但不会告诉您如何处理空引用。或者在 OP 的代码中，如何处理参数开头或结尾的任何空格。我相信应该记录的这类信息比通常公认的要多得多*。*

对我来说，它需要自然语言文档来描述函数的用途以及函数的任何前置条件和后置条件、它的参数和返回值*，这些是无法通过编程语言语法表达的*。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T22:37:42.207

您在这里遇到了将维护新库的人和将使用新库的人之间的关键鸿沟。

如果我正在编写一个新的应用程序并将使用这些标准库，我应该得到一个稳定的库二进制文件并将它们简单地导入我的应用程序，而不是从某个位置复制源代码，如果代码可能会导致问题被修改。在这种情况下，除了方法名称和输入/输出参数之外，我将无法访问任何“自我记录”功能，如果我使用某种 IDE，即使这些功能也不会暴露没有打开自动完成功能。

所以在你上面的示例代码中，我认为它看起来很好。代码本身的内容并不太冗长，并且名称是自我记录的。另一方面，所有必要的摘要/参数数据都在那里，因此可以构建一个可靠的文档片段，让那些使用该库的人可以轻松获得所有关键信息。遗憾的是，XML 相当臃肿，但总的来说，我认为大多数开发人员可以轻松浏览所有摘要内容并查看方法中的实际代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T21:08:26.457

杰夫在这里有一篇关于评论（或者我应该说，不是评论）的非常好的文章......

[http://www.codinghorror.com/blog/archives/001150.html](http://www.codinghorror.com/blog/archives/001150.html)

我知道我似乎没有回答这个问题，但我认为代码应该尽可能自我记录是一个有效的观点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T21:12:20.350

我倾向于在自己的代码中记录所有公共方法；使用 GhostDoc 使这变得微不足道。为了减少编辑源代码时的混乱，我通常只是通过首先进入“大纲模式”来折叠注释（即使用 Visual Studio 的大纲 > 折叠到定义命令）。

我从未尝试过 Sandcastle，但我非常感谢 Intellisense 为我用 XML 注释的方法提供的舒适感。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T21:13:18.490

我总是选择 XML / Javadoc 格式的注释，因为我喜欢能够以合理的格式（通常是 HTML）浏览 API 文档。

浏览实际源代码确实会成为一个问题，但我发现这通常是一个小问题，因为 Visual Studio 通常非常聪明地根据需要折叠 XML 注释。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-13T21:26:25.657

不要重复自己。

*   第一个示例应该有一个更好的方法名称并且根本没有注释。
*   第二个例子不应该有评论。

第一个方法的名称应该反映分配了一个新对象。

如果该行为是整个框架中每个添加的标准行为，则应在更高级别记录，而不是在此方法 API 文档中。否则，请更改名称。

评论应该添加信息，而不是隐藏在噪音中。并且应该有注释，必要时在 XML 中。以及他们增加价值的地方。

我不想看到：名为 count 的方法的“返回计数”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-13T22:40:07.473

所有公共函数都必须让熟悉您的代码库的人清楚地理解，但不是在您的特定部分中，而不必深入研究代码。

如果您需要写一个简短的行来解释一个函数的作用，那么您很可能将您的函数/类命名得很差。在这种情况下，名称应该是不言自明的

如果它需要超过 1 个简短的句子来解释，那可能是一个很好的评论

如果它需要一个段落，那么除了可能不清楚的名称之外，您的函数可能做得太多了。

*如果您确保它们是准确*的，通常最好在评论方面犯错。不准确和/或无法维护的评论比没有评论更糟糕

所以应用这些规则：

在您的第一个示例中：“// 创建新客户实例”是多余的。代码非常清晰。其他评论很完美。他们阐明了代码的操作/结果是什么

在您的第二个示例中，评论是浪费精力并且难以阅读。您需要做的就是给函数一个正确的名称。不是那个模糊的“计数”。那是不好的命名。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-13T22:41:21.497

我最近进行的一项研究表明，如果您在许多规范中都有重要的“指令”，例如，调用者必须执行 X（例如，“此方法执行 X，这意味着 Y 和 Z”），那么存在非常高的风险你的读者会错过指令。事实上，当他们看到一个长文档时，他们会跳过所有的阅读。

所以至少，分离重要的东西或使用标记（问我是否使用 Java）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-14T00:43:24.540

这完全取决于您的公司使用的标准，但对于我的工作人员，我们会在每个函数的顶部记录，就像在您的第二个示例中一样（顺便说一下，您可以在 Visual Studio 2008 中通过点击“/”键 3 次来执行此操作在任何子或函数顶部的一行中！！）。

第一个例子是矫枉过正，尤其是在每行注释的底部几行。但是，我认为函数头部的内容可能很有用，因为我们在这里经常使用它。从我从许多其他程序员那里可以看出，它似乎有点标准。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-13T21:16:04.087

我已经看到建议不要评论自注释代码和方法重载的编码标准。虽然 YMMV，但这听起来像是摆脱“字段 _numberOfCars 是一个代表汽车数量的整数”类型的评论的好方法，这会导致过度杀伤。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-13T21:24:21.183

用于生成文档的标题中的注释是一件好事。在代码中添加注释来解释你为什么要做你正在做的事情通常也是一件好事。加入多余的评论来解释你所做的并不是一件好事

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-13T21:30:43.883

你所展示的太多了。帮自己一个忙，删除它！

代码首先应该通过有意义的方法和参数名称进行自我记录。在您展示的示例中；

public Customer Add(Title Title, string FirstName, string MiddleInitial, string LastName) 对于正在发生的事情的意图是完全可以理解的，“计数”也是如此。

正如您所指出的，诸如此类的评论纯粹是围绕原本易于阅读的代码的**噪音。**大多数开发人员会更早地打开检查和使用代码，而不是堆积晦涩的自动生成的 API 文档。每次！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-13T22:57:53.960

顺便说一句，根据“清洁代码”（一本好书，顺便说一句），应该避免在嵌入源代码的注释中使用 HTML/XML 标记。即使您的 IDE 可以在您悬停时创建漂亮的文档，但当您浏览源代码时，它会被认为太分散注意力且难以阅读。

# wcf - 从 WCF 服务返回接口

> ID：288304
> 
> 赞同：6
> 
> 时间：2008-11-13T21:07:11.187
> 
> 标签：wcf, user-interface, remoting, return

我有一些 .NET 远程处理代码，其中在某些服务器端类中实现的工厂方法返回具体对象的接口，也在同一台服务器上执行。.NET 远程自动创建代理并允许我将接口传递给客户端，然后客户端可以直接调用它们。

示例接口：

```
public interface IFactory
{
    IFoo GetFoo();
}

public interface IFoo
{
    void DoSomething();
} 
```

示例客户端代码：

```
...
IFactory factory = (IFactory) System.Activator.GetObject (typeof (IFactory), url);
...
IFoo foo = factory.GetFoo ();  // the server returns an interface; we get a proxy to it
foo.DoSomething ();
... 
```

这一切都很好。但是，现在我正在尝试将我的代码迁移到 WCF。我想知道是否有一种方法可以传递接口并让 WCF 在客户端动态生成代理，就像原始的 .NET 远程处理一样。

而且我不想返回类实例，因为我不想公开真实的类。并且序列化完整实例并在服务器和客户端之间来回发送它也不是一种选择。我真的只是希望客户端通过接口指针/代理与服务器对象交谈。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T21:20:52.687

[使用会话而不是客户端激活对象 (MSDN)](http://msdn.microsoft.com/en-us/library/aa730857%28VS.80%29.aspx#netremotewcf_topic6)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T21:36:55.463

对不起，杰泽尔，我不明白。

是的，我可以`ChannelFactory`在客户端上使用它来创建一个代理`IFactory`，因为该单例对象已由服务器通过`ServiceHost`.

但是我`IFoo`在服务器上的实例没有与任何关联`ServiceHost`；我只想通过`IFactory`在客户端调用我的代理来取回它们，并让 WCF 调用服务器`IFactory`，这将提供一些`IFoo`，然后将其编组回客户端并包装到动态生成的代理中。我真的只想能够`factory.GetFoo ();`在我的客户上写...

与此同时，Brian 向我指出了我在 MSDN 上忽略的一个非常有趣的文档，该文档解释了如何通过使用会话来模仿 .NET Remoting 接口编组，`EndPointAddress10`并且......正如您所写的那样，`ChannelFactory`以获取客户端代理。

所以，现在我知道如何复制我的 .NET 远程处理代码，但为此付出了相对较高的成本。WCF 涉及的代码复杂性比普通的旧 .NET 远程解决方案要高很多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T21:10:39.447

ChannelFactory 类正是这样做的，在给定接口的运行时动态生成代理。

# ruby-on-rails - Ruby on Rails：是否可以从 SQL 服务器请求当前时间？

> ID：288305
> 
> 赞同：0
> 
> 时间：2008-11-13T21:07:14.180
> 
> 标签：ruby-on-rails, ruby, datetime

在上一个关于覆盖[Time.now](https://stackoverflow.com/questions/288020/how-does-one-without-inheritance-override-a-class-method-and-call-the-original)的问题中，我正在努力解决在连接到给定数据库的所有机器上伪造时钟同步的解决方案。覆盖 Time.now 似乎是我采用的方法的最佳方式，但是：

似乎我可以通过更简单的线路得到我想要的结果。如果我能得到 SQL 服务器的当前时间，我的生活会简单得多。

在每台机器上，我可以做类似的事情；记录创建，检查记录中的creation_time，记录删除，但如果有更简单的东西，我会接受。

我见过 SELECT GETDATE() (oracle) 和 SELECT NOW() (mysql) 等形式。审查我的代码的人不太可能喜欢直接到 sql 的调用。我真的需要一些东西通过rails - 如果它存在的话。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T21:11:14.190

SELECT GetDate() 将产生 SQL Server 的当前时间

# visual-studio - Visual Studio：即时窗口中的 IntelliSense 在哪里？

> ID：288317
> 
> 赞同：24
> 
> 时间：2008-11-13T21:09:59.090
> 
> 标签：visual-studio, visual-studio-2005

看起来即时窗口需要一些令人兴奋的 ala IntelliSense？

有人同意/不同意吗？这是在 VS2008/2010 中出现的吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-13T21:20:10.990

如果您没有自动启动智能感知，请立即按 Ctrl + Space。和 Joel 一样，智能感知似乎是在嵌入式窗口中进来的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T21:23:58.330

在 Visual Studio 2008 中调试时，您可以通过按 ctrl+space 来弹出智能感知。此外，它将以相同的击键在快速监视窗口中弹出。非常便利。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T21:44:37.600

我在使用 C# 的 VS2005 中，我终于用 Ctrl-Space 完成了它，但奇怪的是，当我第一次点击那里时，我不得不尝试几次。只要我呆在那个窗口里，它就会在一段时间内正常工作。

但是如果我点击问题或查找窗口，然后返回它：然后它不会再次出现，直到我评估一行然后点击 Ctrl-Space。

# visual-studio - 将图形绘制到用户控件时出现问题

> ID：288318
> 
> 赞同：2
> 
> 时间：2008-11-13T21:10:08.747
> 
> 标签：visual-studio, graphics, user-controls, release-mode

我的应用程序弹出一个表单作为主表单的子表单。表单上是
用户控件，其中包含呈现图形的面板。当在调试模式下从 Visual Studio 执行时，绘图通常按预期呈现，想象一个简单的 XY 图形。如果面板的图形没有被绘制，那么在绘图例程中添加两个或三个断点通常可以解决问题。

当在 Visual Studio 中以发布模式执行时，或在任何模式下从 .exe 执行时，图形永远不会呈现，尽管调用了用户控件的 Paint 方法。当然，调整表单大小会导致重新调用重新绘制，并且现在可以正确渲染图像。

谁能给我一些见解，为什么调试和发布模式之间的行为存在差异，从 VS 内部和外部 VS 执行，为什么断点有时会修复问题？以及如何使图形始终可见。

谢谢，

瑞克

[替代文字 http://img160.imageshack.us/my.php?image=profilebeforeresizeti4.png](http://img160.imageshack.us/my.php?image=profilebeforeresizeti4.png)[替代文字 http://img512.imageshack.us/my.php?image=profileafterresizenw2.png](http://img512.imageshack.us/my.php?image=profileafterresizenw2.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T06:49:57.890

如果没有更多信息，我无法确定您看到行为差异的原因（我建议您看到同样的问题，因为您承认调试版本也不总是有效），但您可能会发现断点会通常“修复”绘画问题，因为切换回 Visual Studio 最终会使整个绘画表面无效，而不仅仅是一小部分。因此，您启动了应用程序并且它没有正确绘制，您在 Visual Studio 中打了一个断点，切换查看一些变量，返回到应用程序并正确绘制，因为使用正确的剪切矩形调用 OnPaint 以重新绘制整个表面（通常也调用 OnPaintBackground，见下文）。

如果是这种情况，您应该能够通过最小化和恢复您的应用程序在发布版本中复制它。如果这“修复”了您的控件的显示，那么它可能是由您的绘制方法的问题引起的，假设它可能不是绘制整个控件。

您还可以查看 PaintBackground 以确保正确擦除控件的表面。您可能要离开旧显示器，然后在其上重新绘制，而不是从“新”画布开始。

根据您对正在发生的事情的描述以及重绘的方式，这些是我最好的建议。我需要一些更具体的细节（绘制代码、所发生情况的具体描述 - 控件是未绘制还是仅显示部分等）以提供更准确的帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-25T06:03:47.650

我只是试了一下，它在发布模式下达到了我的预期。. . 它用蓝色和一个大黄色椭圆填充面板。请发布重现问题所需的最少示例代码。. . 也许在下面的 MyPanel 基础上构建。

计时器的作用是确保我们不会过于频繁地重绘。这是一个自动终止计时器，它强制重新绘制整个控件。这是必需的，因为自定义绘制的内容大小与控件有关。

```
 public class MyPanel : Panel
    {
        Timer _resizeRedrawDelayTimer = new Timer();
        public MyPanel()
        {
            _resizeRedrawDelayTimer.Interval=50;
            _resizeRedrawDelayTimer.Tick += new EventHandler(_resizeRedrawDelayTimer_Tick);
        }

        void _resizeRedrawDelayTimer_Tick(object sender, EventArgs e)
        {
            Invalidate();
            _resizeRedrawDelayTimer.Stop();
        }
        protected override void OnPaint(PaintEventArgs e)
        {
            // don't redraw if still resizing.
            if (!_resizeRedrawDelayTimer.Enabled)
            {
                e.Graphics.FillRectangle(Brushes.Blue, this.ClientRectangle);
                e.Graphics.FillEllipse(Brushes.Yellow, this.ClientRectangle);
            }
            base.OnPaint(e);
        }

        protected override void OnResize(EventArgs eventargs)
        {
            if (_resizeRedrawDelayTimer.Enabled)
                _resizeRedrawDelayTimer.Stop();
            // restart the timer.
            _resizeRedrawDelayTimer.Start();
            base.OnResize(eventargs);
        }
    } 
```

# jquery - jQuery Toggle 功能在第一次单击时不起作用

> ID：288319
> 
> 赞同：4
> 
> 时间：2008-11-13T21:10:25.407
> 
> 标签：jquery

我在创建文档以询问这个问题时意识到了这个问题的解决方案......所以如果没有其他原因，我会发布答案，而不是让我在未来浪费时间

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T21:11:45.140

如果在呈现页面时显示（可见）要切换的内容，则功能将按以下顺序排列，如果内容最初是隐藏的，则反转功能

```
<html>
<head>
<style>
 #upperDiv {width:200px; height:20px; text-align:center; cursor:pointer; }
 #lowerDiv {width:200px; height:20px; background-color:red; border:#206ba4 1px solid;}
</style>

<script language="Javascript" src="javascript/jquery-1.2.6.min.js"></script>
<script type="text/JavaScript">

$(function(){
$('#upperDiv').toggle (
    function(){ 
        $("#lowerDiv").hide() ; 
        },
    function(){ 
        $("#lowerDiv").show() ; 
        }
); // End toggle
 }); // End eventlistener

</script>
</head>
<body>
<div id="upperDiv" >Upper div</div>
<div id="lowerDiv" >Lover Div</div>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T21:15:46.007

`toggle()`有时很麻烦，我让它对复选标记（取消选中它们）和其他各种问题做了奇怪的事情。我建议只使用点击事件来处理它，更不用说小麻烦了。这样一来，您就不必担心`#lowerDiv`首先处于什么状态：

```
$('#upperDiv').click(function() {
    $('#lowerDiv').animate({
        'opacity' : 'toggle',
    });
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-12-08T14:24:09.467

我知道这是一个非常古老的问题，但对于那些正在寻找快速解决方案的人来说，这对我有用：

一种。在 PHP/HTML 文件中：

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/.../jquery.min.js"></script>
    <script>
    $(document).ready(function(){
        $("#pClick").click(function(){          
            $("#pText").toggle();
            $("#pText").text("...");
        });
    });
    </script> 
```

湾。在 CSS 文件中：

```
#pText {display: none;} 
```

它现在甚至在第一次点击时也能正常工作。这是一个简单，快速的答案，我希望会有用。

# .net - ASP.NET 中的可配置列

> ID：288327
> 
> 赞同：1
> 
> 时间：2008-11-13T21:11:37.357
> 
> 标签：.net, asp.net, vb.net

有没有人对允许用户选择哪些列出现在数据网格中的最佳方式提出建议？我希望他们能够进行设置。它将与用户一起存储在配置文件中，并在用户每次加载网格时加载。我正在考虑一些与 ASP.NET 个性化有关的事情。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T01:12:38.397

这里有几个选项供您选择。

1.  将“X”图像添加到每列的标题，并使用 javascript onclick 事件执行 Web 方法调用以从用户的要加载哪些列的配置文件中删除该列。

2.  有一个自定义弹出页面，其中将有一个所有列的复选框列表，用户可以从网格中添加或删除哪些列。

还有一些，但它们更少 AJAX 和更多页面重新加载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T17:04:05.300

我倾向于为此设置一个弹出 div 或窗口，仅显示未选择的字段，每个标题上都有一个删除工具。抱歉，如果这对 Avitus 的想法没有多大帮助，但我建议混合使用 2 个建议的想法，即弹出列表仅包含未选择的列（如 Outlook 中所说）。该列表必须建立在每个弹出窗口或每个删除/添加上。

此外，我建议用户仅根据请求存储他们的选择，以便在提交下一次获得该布局之前允许实验性列选择，并最大限度地减少存储访问。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T04:35:37.070

您需要将此信息存储在数据库中。在管理页面上，您可以指定列名并使用“显示？[]”复选框。当他们检查时，显示，如果没有，不显示。在 ASPX 页面上，当您绑定网格时，将列从数据库中拉出并遍历 DataTable 类中的 columns 属性并检查列的名称。如果好，就展示它，如果不好，那就不要。

有一百零一种方法可以实现，真的，选择取决于你。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T21:11:11.783

我的建议是将此信息存储在每个用户的数据库中。如果他们没有偏好，则显示所有列，如果他们选择列，则存储该信息，以便每次访问他们只能看到他们想看到的内容。

为此，请遍历可用列（字段名称）并将它们动态添加到数据网格中。您将希望在列表框控件或类似控件中执行相同的操作，以便用户可以指定他们想要查看的内容。当他们添加他们想要的列时，您可以通过仅显示这些列来重建网格。每次他们在列表框中添加或删除列时，您都将他们的首选项保存到数据库中。

# linux - 替代cron？

> ID：288349
> 
> 赞同：12
> 
> 时间：2008-11-13T21:16:31.027
> 
> 标签：linux, timezone, cron, crontab

有谁知道cron的好替代品？我想要可以在不同时区运行的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T21:29:04.077

您可以考虑[Quartz](http://www.opensymphony.com/quartz/wikidocs/Features.html)（一种基于 java 的解决方案），它可以利用[`Date`适当的 TimeZone 构建](http://jira.opensymphony.com/browse/QUART%5A-540)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-09-09T11:26:58.307

对于未来的读者，请考虑由 AirBnB 开发和开源的 Chronos。查看[http://nerds.airbnb.com/introducing-chronos/](http://nerds.airbnb.com/introducing-chronos/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-11-10T11:50:47.107

只是为了完整起见，[cronie](https://fedorahosted.org/cronie/)支持该`CRON_TZ`变量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-05T09:34:19.533

MacOS X 已将`cron`、`at`、`xinet`和替换`watchdog`为开源`launchd`（[维基百科](http://en.wikipedia.org/wiki/Launchd)）。流程属性在 XML 文件中描述，该文件允许传递参数。切换时区应该是微不足道的。

# asp.net - Application_End global.asax

> ID：288350
> 
> 赞同：45
> 
> 时间：2008-11-13T21:16:31.057
> 
> 标签：asp.net, iis, global-asax, lifecycle, application-end

谁能告诉我在应用程序的生命周期中何时触发 Application_End ？当所有会话结束时，Application_End 会自动触发吗？+ 是否还有其他原因可以触发 Application_End？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-13T21:32:37.767

该`application_end`事件主要在 IIS 池被回收或应用程序本身被卸载时触发。需要注意的另一件事是，对依赖文件（例如 web.config）的更改将导致应用程序重新加载自身，这将导致 application_end 事件在它关闭时触发。

需要注意的是，我在最后一个用户会话超时时发现的应用程序结束事件触发的唯一实例是在一些日期为 2001 年的旧文档中。我不确定该标准是否仍然适用。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-13T21:37:18.693

Application_End 在 ASP.NET 工作进程终止时触发。这通常发生在一段可配置的不活动期之后或 IIS（或相关的应用程序池）关闭或重新启动时。

在 IIS 6.0 中运行时，可通过 Internet 服务管理器中的应用程序池设置来配置不活动超时（性能选项卡上的空闲超时）。在早期版本的 IIS 下，它可以在 machine.config 中设置（processModel 下的 idleTimeout）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-06-27T00:31:22.210

在我的情况下，Aapplication Pool 正在被回收，因为属性**Idle Time-Out (minutes)**

此属性的默认值为 20（分钟）

[![在此处输入图像描述](https://i.stack.imgur.com/A6wJr.png)](https://i.stack.imgur.com/A6wJr.png)

# c# - 反射如何告诉我属性何时使用“new”关键字隐藏继承的成员？

> ID：288357
> 
> 赞同：21
> 
> 时间：2008-11-13T21:18:57.420
> 
> 标签：c#, vb.net, reflection, inheritance, overriding

所以如果我有：

```
public class ChildClass : BaseClass
{
    public new virtual string TempProperty { get; set; }
}

public class BaseClass
{
    public virtual string TempProperty { get; set; }
} 
```

如何使用反射来查看 ChildClass 隐藏了 TempProperty 的 Base 实现？

我希望答案在 c# 和 vb.net 之间是不可知的

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-14T00:57:54.467

我们必须在这里处理属性的方法而不是属性本身，因为实际上被覆盖的是属性的 get/set 方法而不是属性本身。我将使用 get 方法，因为您永远不应该拥有一个没有属性的属性，尽管完整的解决方案应该检查是否缺少属性。

查看在许多情况下发出的 IL，基本属性的“get”方法将具有元数据标记（这是来自 C# 编译器；其他人可能不会发出`hidebysig`取决于他们的方法隐藏语义，在这种情况下方法将按名称隐藏）：

```
non-virtual : .method public hidebysig specialname instance
virtual     : .method public hidebysig specialname newslot virtual instance 
```

派生的将具有以下标记：

```
override    : .method public hidebysig specialname virtual instance 
new         : .method public hidebysig specialname instance
new virtual : .method public hidebysig specialname newslot virtual instance 
```

所以由此我们可以看出，单纯从方法的元数据token中是无法判断是不是`new`因为non-virtual base方法和non-virtual方法有相同token `new`，而virtual base方法有相同token作为`new virtual`方法。

我们*可以*说的是，如果方法有`virtual`令牌但没有`newslot`令牌，那么它会覆盖一个基本方法而不是隐藏它，即

```
var prop = typeof(ChildClass).GetProperty("TempProperty");
var getMethod = prop.GetGetMethod();
if ((getMethod.Attributes & MethodAttributes.Virtual) != 0 &&
    (getMethod.Attributes & MethodAttributes.NewSlot) == 0)
{
    // the property's 'get' method is an override
} 
```

那么，假设我们发现 'get' 方法不是覆盖，我们想知道基类中是否存在它正在遮蔽的属性。问题在于，由于该方法位于不同的方法表槽中，因此它实际上与它所映射的方法没有任何直接关系。所以我们实际上要说的是“基础类型是否有任何满足遮蔽标准的方法”，这取决于方法是`hidebysig`按名称隐藏还是按名称隐藏。

对于前者，我们需要检查基类是否有任何与签名完全匹配的方法，而对于后者，我们需要检查它是否有任何同名的方法，所以继续上面的代码：

```
else 
{
    if (getMethod.IsHideBySig)
    {
        var flags = getMethod.IsPublic ? BindingFlags.Public : BindingFlags.NonPublic;
        flags |= getMethod.IsStatic ? BindingFlags.Static : BindingFlags.Instance;
        var paramTypes = getMethod.GetParameters().Select(p => p.ParameterType).ToArray();
        if (getMethod.DeclaringType.BaseType.GetMethod(getMethod.Name, flags, null, paramTypes, null) != null)
        {
            // the property's 'get' method shadows by signature
        }
    }
    else
    {
        var flags = BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Static | BindingFlags.Instance;
        if (getMethod.DeclaringType.BaseType.GetMethods(flags).Any(m => m.Name == getMethod.Name))
        {
            // the property's 'get' method shadows by name
        }
    }
} 
```

我认为这是大部分的方式，但我仍然不认为这是完全正确的。首先，我并不完全熟悉按名称隐藏，因为 C# 不支持它，而这几乎就是我使用的全部内容，所以我在这里的代码中可能是错误的，表明实例方法可能会影响静态方法。我也不知道区分大小写的问题（例如，在 VB 中，如果它们都具有相同的签名并且两者都具有相同的签名，则可以调用一个名为`Foo`shadow 的方法- 在 C# 中答案是否定的，但如果在 VB 中答案是肯定的，那么它意味着这个问题的答案实际上是不确定的）。`foo``hidebysig`

好吧，我不确定这一切有多大帮助，除了说明它实际上是一个比我想象的要困难得多的问题（或者我错过了一些非常明显的事情，在这种情况下我想知道！ ）。但希望它有足够的内容来帮助你实现你想要做的事情。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-13T23:13:47.233

看起来反射不会默认给你这个，所以你必须自己动手：

```
public static bool IsHidingMember( this PropertyInfo self )
{
    Type baseType = self.DeclaringType.BaseType;
    PropertyInfo baseProperty = baseType.GetProperty( self.Name, self.PropertyType );

    if ( baseProperty == null )
    {
        return false;
    }

    if ( baseProperty.DeclaringType == self.DeclaringType )
    {
        return false;
    }

    var baseMethodDefinition = baseProperty.GetGetMethod().GetBaseDefinition();
    var thisMethodDefinition = self.GetGetMethod().GetBaseDefinition();

    return baseMethodDefinition.DeclaringType != thisMethodDefinition.DeclaringType;
} 
```

但是，不确定这将如何与索引属性一起使用！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T22:32:15.867

我从来没有做过你想做的事，但 MethodInfo.GetBaseDefinition() 方法似乎是你要找的。

它返回此方法覆盖的 MethodInfo。

来自 MSDN：

> 如果使用 new 关键字指定给定方法（如在类型成员中描述的新闻槽中），则返回给定方法。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-13T21:22:58.550

更正，如果您使用的是 VB，您正在寻找的属性是“IsHideBySig”。如果使用“new”关键字定义方法/属性，这将是错误的。

在 C# 的情况下，两个实例都输出为“hidebysig”。感谢您指出格雷格。我没有意识到我只在 VB 中测试过这个。这是将重现此行为的示例 VB 代码。

```
Module Module1

    Class Foo
        Public Function SomeFunc() As Integer
            Return 42
        End Function
    End Class

    Class Bar
        Inherits Foo
        Public Shadows Function SomeFunc() As Integer
            Return 36
        End Function
    End Class

    Sub Main()
        Dim type = GetType(Bar)
        Dim func = type.GetMethod("SomeFunc")
        Stop
    End Sub

End Module 
```

# winapi - Win32：代码块的原子执行

> ID：288364
> 
> 赞同：1
> 
> 时间：2008-11-13T21:20:47.603
> 
> 标签：winapi, atomic, context-switch

我有两个系统调用 GetSystemTime() 和 GetThreadTimes() 我需要计算给定 Win32 线程的 CPU 利用率。

为了准确起见，我需要确保 GetSystemTime() 和 GetThreadTimes() 都是原子执行的；即在调用GetSystemTime() 和GetThreadTimes() 之间不应有上下文切换。

原因是偶尔我会得到超过 100% 的百分比（约 500 分之一）。

如何确保 2 个函数调用的原子执行？

谢谢，萨钦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T21:29:30.113

我不太确定你能做到。除非您知道每个函数中的底层操作是什么，并且因为它们恰好是 Windows API 调用......祝你好运。

难道不能只调整超过 100 的百分比吗？

```
perc = ( perc > 100.0f ) ? 100.0f : perc; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T21:59:47.400

您最好的选择是为计算线程分配实时优先级。实时线程只会被其他实时线程（或提升到实时优先级的线程）抢占。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T21:30:22.840

可惜没有办法。在 Win32 中的两个系统调用之间，没有办法阻止您的进程/线程被上下文切换。否则，如果有人通过拒绝每次关机来实现锁定系统的进程，那将是微不足道的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T21:45:14.073

以相反的顺序调用函数会有所帮助吗？（99% 比 101% 好……）

此外，如果您在执行此操作之前强制进行上下文切换（例如通过调用 Sleep()），您可能会减少被切换出去的机会。我不知道这会有多好。

# javascript - JavaScript 非正则表达式替换

> ID：288368
> 
> 赞同：17
> 
> 时间：2008-11-13T21:22:21.750
> 
> 标签：javascript

是否有任何现有的 JavaScript 框架具有非正则表达式`replace()`功能，或者是否已经将其作为一次性功能发布在网络上的某个地方？

例如，我想替换`"@!#$123=%"`并且不想担心要转义哪些字符。大多数语言似乎都有两种替换方法。我希望看到添加这个简单的东西。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-13T21:25:34.223

我可能误解了你的问题，但 javascript 确实有[`replace()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace)

```
var string = '@!#$123=%';
var newstring = string.replace('@!#$123=%', 'hi'); 
```

**编辑**：（见评论）第 5 版似乎确实有这个信息，虽然当我[直接链接](http://safari.informit.com/0596101996/jscript5-CHP-11-SECT-2)到它时它没有显示出来。这是相关部分：

> replace() 方法执行搜索和替换操作。它将正则表达式作为第一个参数，将替换字符串作为第二个参数。它在调用它的字符串上搜索与指定模式匹配的字符串。如果正则表达式设置了 g 标志，则 replace() 方法将字符串中的所有匹配项替换为替换字符串；否则，它只替换它找到的第一个匹配项。**如果 replace() 的第一个参数是字符串而不是正则表达式，则该方法会按字面意思搜索该字符串，而不是像 search() 那样使用 RegExp() 构造函数将其转换为正则表达式。**

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2011-07-17T15:47:57.120

我在搜索非正则表达式 javascript 字符串 replace() 方法时遇到了完全相同的问题。我的解决方案是使用 split() 和 join() 的组合：

```
"some text containing regex interpreted characters: $1.00".split("$").join("£"); 
```

这使：

> “一些包含正则表达式解释字符的文本：1.00 英镑”

与替换（）比较：

```
"some text containing regex interpreted characters: $1.00".replace(new RegExp("$"),"£") 
```

奇怪的是：

> “一些包含正则表达式解释字符的文本：$1.00£”

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-09-07T16:59:08.177

试试这个：

```
function replaceAllTemp(str,find, replace) { 
var ignoreCase=true;
var _token;
var token=find;
var newToken=replace;
var i = -1;

if ( typeof token === "string" ) {

    if ( ignoreCase ) {

        _token = token.toLowerCase();

        while( (
            i = str.toLowerCase().indexOf(
                token, i >= 0 ? i + newToken.length : 0
            ) ) !== -1
        ) {
            str = str.substring( 0, i ) +
                newToken +
                str.substring( i + token.length );
        }

    } else {
        return this.split( token ).join( newToken );
    }

}
return str;
}; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-07-11T12:50:17.883

您可以忽略或不忽略区分大小写。
可悲的是，JavaScript 的 indexOf 不接受 locale vs. invariant 作为参数，所以如果你想保留文化特异性，你必须`toLowerCase`替换为。`toLocaleLowerCase`

```
function replaceAll(str, find, newToken, ignoreCase)
{
    var i = -1;

    if (!str)
    {
        // Instead of throwing, act as COALESCE if find == null/empty and str == null
        if ((str == null) && (find == null))
            return newToken;

        return str;
    }

    if (!find) // sanity check 
        return str;

    ignoreCase = ignoreCase || false;
    find = ignoreCase ? find.toLowerCase() : find;

    while ((
        i = (ignoreCase ? str.toLowerCase() : str).indexOf(
            find, i >= 0 ? i + newToken.length : 0
        )) !== -1
    )
    {
        str = str.substring(0, i) +
            newToken +
            str.substring(i + find.length);
    } // Whend 

    return str;
} 
```

或作为原型：

```
if (!String.prototype.replaceAll ) {  
String.prototype.replaceAll = function (find, replace) {
    var str = this, i = -1;

    if (!str)
    {
        // Instead of throwing, act as COALESCE if find == null/empty and str == null
        if ((str == null) && (find == null))
            return newToken;

        return str;
    }

    if (!find) // sanity check 
        return str;

    ignoreCase = ignoreCase || false;
    find = ignoreCase ? find.toLowerCase() : find;

    while ((
        i = (ignoreCase ? str.toLowerCase() : str).indexOf(
            find, i >= 0 ? i + newToken.length : 0
        )) !== -1
    )
    {
        str = str.substring(0, i) +
            newToken +
            str.substring(i + find.length);
    } // Whend 

    return str;
};
} 
```

# visual-studio - 使用断点条件进行调试时，Visual Studio 行为异常

> ID：288374
> 
> 赞同：3
> 
> 时间：2008-11-13T21:23:42.480
> 
> 标签：visual-studio, debugging

我使用的一种被称为数万次的方法最近开始抛出异常。在大多数调试情况下，我会在此方法的顶部设置一个断点并一直运行，直到到达我感兴趣的调用，并使用触发异常的参数值。在这种情况下，这是不切实际的，所以我尝试设置一个断点，其条件只有在该参数值出现时才会中断。我在下面指示的位置创建了一个断点并给它一个条件`str == "OffendingValue"`。

```
class Foo
{
    // Bar() is called many, many times
    void Bar(string str)
    {
        try
        {
            // Breakpoint inserted here
            ...
        }
        catch (Exception ex)
        {
            ...
        }
    }
} 
```

令我惊讶的是，这样做会导致 Visual Studio 和我的应用程序在调试模式下停止运行。我的应用程序启动并输出了一些简单的日志消息，但随后完全停止响应。考虑到 Visual Studio 的执行速度可能会慢一些，因为它必须做额外的工作来监视断点条件，所以我离开了我的办公桌 15 分钟，让它有一些时间运行。当我回来时，没有任何变化。我可以通过删除断点并使用相同的条件重新创建它来重现该条件。最奇怪的是，Break All 调试命令通常会中断当前正在执行的语句上的程序执行，无论它是否是断点，但当我启用了这个有问题的断点时，它什么也没做。

有没有人在 Visual Studio 断点条件下遇到过类似的行为？我可以毫无问题地使用命中计数条件。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T22:07:40.753

每当我尝试在 Visual Studio 中使用条件断点时，我都会遇到同样的问题。调试器运行如此缓慢以至于它变得毫无用处。相反，我最终暂时在代码中添加了一个 if 语句，并在其中添加了我的断点。这不太方便，但代码以正常速度执行，并且确实完成了工作。

```
class Foo
{
    // Bar() is called many, many times
    void Bar(string str)
    {
        try
        {

            if(str == "condition")
            {
                int i = 0;   // Breakpoint inserted here
            }
            ...
        }
        catch (Exception ex)
        {
                ...
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T21:53:55.913

如果您知道有问题的值是什么，您是否可以不只是为该方法编写一个单元测试并以这种方式进行调试？

如果没有，如果你知道异常，你可以设置你的调试器在抛出异常时中断。转到调试 | 异常并检查引发的异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T21:31:08.033

我想知道您是否遇到堆栈溢出。VS 是否跟踪 str 的所有值或与 Bar 的每个状态有关的任何内容？如果是这样，数千份可能会加起来。

我想知道您是否可以通过全局变量而不是函数内的变量来消除监视值的问题。

# windows - Oracle：TNS-12532：TNS：无效参数

> ID：288381
> 
> 赞同：1
> 
> 时间：2008-11-13T21:25:01.760
> 
> 标签：windows, oracle, connection

试图在我的 windows box（2003 服务器）和 oracle（11g）数据库之间建立连接。

我能够从 Windows 框中成功 ping 到 oracle 主机。但是 tnsping 命令失败并出现错误 tns-12532 错误。

有什么想法可以解决这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T13:22:01.233

从[Oracle 错误消息文档](http://download.oracle.com/docs/cd/B28359_01/server.111/b28278/net12500.htm#sthref3514)：

> **ORA-12532: TNS: 无效参数**
> 
> **原因：**内部函数接收到无效参数。
> 
> **行动：**用户通常不可见。有关详细信息，请打开跟踪并重新执行操作。如果错误仍然存​​在，请联系 Oracle 客户支持。

你有没有走那条路？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T19:00:21.333

很抱歉这个明显的问题，但你确认你可以从另一台电脑连接到数据库吗？

# xml - 如何使用 VB 的内联 XML 显示不间断的空格

> ID：288382
> 
> 赞同：1
> 
> 时间：2008-11-13T21:25:05.567
> 
> 标签：xml, vb.net

我正在使用 VB9 的内联 XML，我需要指定一个不间断的空格。通常`&nbsp;`在 html 中使用“”的地方，在内联 XML 中使用它会产生“不支持 XML 实体引用”错误。你如何指定一个不间断的空间？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T21:36:43.030

大多数命名实体在 XML 中不受支持，除非您在 DTD 中显式声明它们。但是，您可以使用 unicode 实体 & #160; （当然，没有空间）。

[这](http://www.fileformat.info/info/unicode/char/search.htm)是一个查找 unicode 字符的好网站。

# asp.net - 为 ASP.NET 应用程序实现后台服务的最佳方式是什么？

> ID：288392
> 
> 赞同：6
> 
> 时间：2008-11-13T21:27:12.987
> 
> 标签：asp.net, architecture, deployment

我的 ASP.NET 应用程序需要许多支持服务才能在后台定期运行。例如：

*   我需要每 1-5 分钟查询一次数据库（或缓存），识别过期工作项并通过电子邮件通知用户
*   我需要生成夜间报告，然后通过电子邮件发送给订阅者
*   加上其他系统/非用户管理任务

实施这些服务的最佳方式是什么？我是否应该将它们包含在 Web 应用程序中，在 Application_Start() 中启动每个“服务”的实例？或者将它们创建为实际的独立服务？如果它们是 Web 应用程序的一部分，我可以潜在地利用我的缓存数据存储，但是这种方法有什么缺点吗？

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T21:39:06.177

今年我需要实现一个任务来缓存数据库中的一些数据，它必须每 n 分钟验证一次更改的代码，我发现这篇文章非常好；

[使用 ASP.NET 模拟 Windows 服务以运行计划作业](http://www.codeproject.com/KB/aspnet/ASPNETService.aspx)

我就是这样做的，它确实有效，但正如我告诉你的那样，它只是一个任务，但如果你看到上面的例子，你会发现它执行了几个任务。

如您所见，在缓存中，您可以随时按时间间隔执行任务，夜间任务可以在午夜完成，其他任务每 n 分钟或几小时执行一次。

希望能帮助到你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T21:35:24.843

-- 对于每晚报告的生成，我会考虑 SQL Reporting Services，因为他们有一些本机订阅服务，允许您通过电子邮件将报告发送给几乎没有自定义代码的用户。

-- 对于过期工作项通知，您可以使用 SSRS（如上所述）向他们发送包含过期项的报告，或者，如果您正在运行 SQL 2k5，则使用通知服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T21:35:55.527

我在我的 ASP.NET 应用程序中分拆工作线程和定期做事的线程，我没有遇到任何问题。

我不只是在内部运行该应用程序 - 其他人下载它并在他们的网站上运行它，或者在托管公司运行它，因此无需安装服务就可以使部署更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T22:16:36.023

计时器与后台工作人员相结合对我来说效果很好：

```
Timer timer = new Timer(intervalSeconds * 1000)
timer.Elapsed += delegate
{
    // do the meat
};
timer.Start(); 
```

请记住，您将无权访问 HttpContext，并且该站点可能会由于不活动而关闭。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-16T04:27:37.333

老实说，我从来都不喜欢尝试在 ASP.net 进程中模拟 Windows 服务，尤其是当您考虑到创建 Windows 服务是多么容易时。我看到的大多数这样做的尝试都充满了问题。

# sql-server-2000 - SQL 2000 和 SQL 2008 Express 并排？

> ID：288393
> 
> 赞同：1
> 
> 时间：2008-11-13T21:27:17.683
> 
> 标签：sql-server-2000, sql-server-2008-express

这个问题是针对 2005 提出的，但没有看到 2000 的任何内容。我们有一个需要在 2005 或更高版本上运行的新应用程序，但我们拥有的所有其他应用程序都面向 2000。我们可以升级，但这不在范围内此时的预算。

我们认为我们可以在升级之前的一段时间内在与 2000 相同的服务器上运行 SQL Server 2008 Express。

有人这样做吗？有什么问题吗？可以继续吗？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T22:04:03.070

在我们的开发服务器上，我们安装了很多版本，例如：2000、2005 Express、2005 standard、2008 express 我们没有遇到任何重大问题。

完成安装过程时，您需要将它们安装为命名实例，例如：

MyServer\SQL2000 MyServer\SQL2005Express MyServer\SQL2005 等

我不建议在生产机器上运行这么多版本或实例，但在您将其他应用程序升级到 2005 之前运行 2 个实例应该没问题。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-13T21:36:43.310

我有一台同时运行 sql2000 和 2005 的服务器，我没有任何问题 - sql2005 正在运行一个单独的实例。

我认为继续进行没有问题。我遇到的唯一问题是 2005 express 没有 DTS/SSIS，因此获取数据很麻烦，但这与运行两者无关:-)

# caching - 缓存/池/缓存池的指南/区别

> ID：288400
> 
> 赞同：2
> 
> 时间：2008-11-13T21:29:06.977
> 
> 标签：caching, pool

我正在做一些设计（最初是为 Java 设计的）（但将来可能会扩展到 .NET？），我对“缓存”和“池”这两个术语感到困惑。

据我所知，主要区别在于它们包含什么？

关于什么时候应该使用的任何指导方针？

那么，许多文章中提到的“缓存池”是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T21:53:53.370

尽管它们都指保持物体在身边，但它们完全不同，我不会说它们是可以互换的。

**缓存**- 存储经常使用的值，通常是因为查找和/或创建非常重要。例如，如果经常使用数据库中的查找表，或者从磁盘上的文件中读取值，则将其保存在内存中并定期刷新会更有效。

缓存仅管理缓存中的对象生命周期，但不对缓存中保存的内容施加语义。缓存也不会创建项目，而只是存储对象。

**池**- 描述由池本身管理的一组资源的术语。例如（数据库）连接池 - 当需要连接时，它从池中获取，完成后返回到池中。

池本身处理池对象的创建和销毁，并管理任何时候可以创建多少个对象。

**缓存池**- 似乎主要描述了存在的（独立？）缓存的数量。例如，一个 asp.net 应用程序的每个应用程序域有 1 个缓存（缓存不在 asp.net 应用程序之间共享）。字面意思是缓存池，尽管这个术语似乎很少使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T21:34:25.000

*缓存*通常用于保存昂贵操作的结果或优化这些结果的检索。

*池*用于描述可供一个或多个应用程序使用但允许控制这些资源的数量的资源集合。

我没有遇到过“缓存池”这个术语——但根据快速回顾，它似乎用于*缓存**池*，或由池管理的缓存集合。

 ** * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T21:46:06.787

我同意 Ken 的观点，并补充一点——如果在任何时候从其中删除部分或全部资源，缓存不会影响您的系统——数据都很容易重现/可重新获取，并且重现通常是自动的（您向缓存请求某些东西，如果它在缓存中不存在，缓存会生成一个，保存并返回给您）。

“池”可以是任何东西，但您不只是删除池对象，因为它们是旧的——通常池包含某些资源的唯一、可能无法重现的实例。

# oracle - 描述的数据类型列中的“标准”是什么意思

> ID：288402
> 
> 赞同：0
> 
> 时间：2008-11-13T21:29:16.757
> 
> 标签：oracle, types, describe

如果你

```
Describe dbms_transform

PROCEDURE COMPUTE_TRANSFORMATION
 Argument Name                  Type                    In/Out
 ------------------------------ ----------------------- ------
 MESSAGE                        STANDARD                IN    
 TRANSFORMATION_SCHEMA          VARCHAR2                IN    
 TRANSFORMATION_NAME            VARCHAR2                IN    
 TRANSFORMED_MESSAGE            STANDARD                OUT 
```

标准在那里意味着什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T16:43:25.737

类型是包*标准*中定义的“<ADT_1>” 。

根据[参考](http://www.psoug.org/reference/standard.html)这些

> 数据类型是泛型，专门用于包 STANDARD 和其他一些 Oracle 包中。它们受到保护以防其他用途；对不起。真正的泛型类型还不是语言的一部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T21:50:49.633

抽象数据类型？

[http://www.psoug.org/reference/dbms_transform.html](http://www.psoug.org/reference/dbms_transform.html)

# c# - 如何在 .NET (C#) 中获取 UserControl 的 HTML 输出？

> ID：288409
> 
> 赞同：51
> 
> 时间：2008-11-13T21:31:30.590
> 
> 标签：c#, html, .net, user-controls

如果我创建一个 UserControl 并向其中添加一些对象，我如何获取它会呈现的 HTML？

前任。

```
UserControl myControl = new UserControl();
myControl.Controls.Add(new TextBox());

// ...something happens

return strHTMLofControl; 
```

我只想将新建的 UserControl 转换为 HTML 字符串。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-11-13T21:35:53.327

您可以使用`Control.RenderControl(HtmlTextWriter)`.

喂给. `StringWriter`_`HtmlTextWriter`

喂给. `StringBuilder`_`StringWriter`

您生成的字符串将在`StringBuilder`对象内。

这是此解决方案的代码示例：

```
string html = String.Empty;
using (TextWriter myTextWriter = new StringWriter(new StringBuilder()))
{
    using (HtmlTextWriter myWriter = new HtmlTextWriter(myTextWriter))
    {
        myControl.RenderControl(myWriter);
        html = myTextWriter.ToString();
    }
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-05-07T02:58:43.783

```
//render control to string
StringBuilder b = new StringBuilder();
HtmlTextWriter h = new HtmlTextWriter(new StringWriter(b));
this.LoadControl("~/path_to_control.ascx").RenderControl(h);
string controlAsString = b.ToString(); 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-01-23T23:10:34.417

```
UserControl uc = new UserControl();
MyCustomUserControl mu = (MyCustomUserControl)uc.LoadControl("~/Controls/MyCustomUserControl.ascx");

TextWriter tw = new StringWriter();
HtmlTextWriter hw = new HtmlTextWriter(tw);

mu.RenderControl(hw);

return tw.ToString(); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-07-24T21:03:51.643

晚了七年，但这值得分享。

普遍接受的解决方案 - `StringBuilder`into `StringWriter`into `HtmlWriter`into `RenderControl`- 是好的。但是有一些陷阱，不幸的是我在尝试做同样的事情时遇到了这些陷阱。一些控件如果不在 a 内就会抛出错误，而有些控件如果不在with`Page`内就会抛出错误。ScriptManager 控件展示了这两种行为。`<form>``runat="server"`

[我最终在这里找到了解决方法。](http://harouny.com/2012/10/15/render-asp-net-controls-user-controls-to-html-by-code/)它的要点基本上只是在编写工作之前实例化一个新的页面和表单：

```
Page page = new Page();
page.EnableEventValidation = false;

HtmlForm form = new HtmlForm();
form.Name = "form1";
page.Controls.Add(form1);

MyControl mc = new MyControl();
form.Controls.Add(mc);

StringBuilder sb = new StringBuilder();
StringWriter sw = new StringWriter(sb);
HtmlTextWriter writer = new HtmlTextWriter(sw);

page.RenderControl(writer);

return sb.ToString(); 
```

不幸的是，这为您提供了比实际需要更多的标记（因为它包括虚拟表单）。并且 ScriptManager 仍然会因为一些我还没有弄明白的神秘原因而失败。老实说，这很麻烦，不值得做；毕竟，在代码隐藏中生成控件的全部目的是让您不必摆弄标记。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-13T21:36:59.630

覆盖 RenderControl 方法

```
protected override void Render(HtmlTextWriter output)
{       
   output.Write("<br>Message from Control : " + Message);       
   output.Write("Showing Custom controls created in reverse" +
                                                    "order");         
   // Render Controls.
   RenderChildren(output);
} 
```

这将使您可以访问将写入 HTML 的编写器。

您可能还想研究 asp.net 的 [自适应控制体系结构 asp.net 的自适应控制体系结构](http://msdn.microsoft.com/en-us/library/67276kc5.aspx)，您可以在其中“塑造”控件的默认 html 输出。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T21:34:19.633

调用它的`.RenderControl()`方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-02-01T14:22:55.257

您可以使用该`HttpServerUtility.Execute`方法，可通过以下方式获得`HttpContext.Current.Server.Execute`：

```
var page = new Page();
var myControl = (MyControl)page.LoadControl("mycontrol.ascx");
myControl.SetSomeProperty = true;
page.Controls.Add(myControl);
var sw = new StringWriter();
HttpContext.Current.Server.Execute(page, sw, preserveForm: false); 
```

好处是您还可以触发用户控件的 Page_Load 事件。

MSDN 文档可以在这里找到：[https](https://msdn.microsoft.com/en-us/library/fb04e8f7(v=vs.110).aspx) ://msdn.microsoft.com/en-us/library/fb04e8f7(v=vs.110).aspx 。

# iphone - 使用 TouchJSON 反序列化复杂的 JSON 结果（字典数组）

> ID：288412
> 
> 赞同：18
> 
> 时间：2008-11-13T21:32:59.560
> 
> 标签：iphone, json, touchjson

昨晚我用 TouchJSON 做了一些测试，对于简单的情况，它通常工作得很好。我正在使用以下代码从文件中读取一些 JSON 内容，并对其进行反序列化：

```
NSString *jsonString = [[NSString alloc] initWithContentsOfFile:@"data.json"];
NSData *jsonData = [jsonString dataUsingEncoding:NSUTF32BigEndianStringEncoding];
NSError *error = nil;
NSDictionary *items = [[CJSONDeserializer deserializer] deserializeAsDictionary:jsonData error:&error];
NSLog(@"total items: %d", [items count]);
NSLog(@"error: %@", [error localizedDescription]); 
```

如果我在文件中有一个非常简单的 JSON 对象（即字典），那效果很好：

```
{"id": "54354", "name": "boohoo"} 
```

通过这种方式，我能够访问值数组，因为我想根据其在列表中的索引来获取该项目：

```
NSArray *items_list = [items allValues];
NSString *name = [items_list objectAtIndex:1]; 
```

*（我知道我可以使用字典 API 获取名称）*

现在我想反序列化一个半复杂的 JSON 字符串，它代表一个字典数组。下面是这样一个 JSON 字符串的示例：

```
[{"id": "123456", "name": "touchjson"}, {"id": "3456", "name": "bleh"}] 
```

当我尝试对 data.json 文件中的这个新内容运行上面的相同代码时，我没有得到任何结果。我的 NSLog() 调用显示“项目总数：0”，并且 NSError 对象中没有返回错误。

关于发生了什么的任何线索？我完全不知道该怎么做，因为没有太多可用于 TouchJSON 的文档，而且使用示例也更少。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-14T03:50:43.710

我是 TouchJSON 的作者。

您最外层的对象应该是字典而不是数组。字典以外的任何东西都是不合法的。如果您必须将数组作为最外层的对象，请使用该方法（在技术上已弃用，但不会很快出现）

```
- (id)deserialize:(NSData *)inData error:(NSError **)outError; 
```

请参阅： http: [//www.json.com/json-schema-proposal/](http://www.json.com/json-schema-proposal/)了解有关什么是合法 JSON 和不合法 JSON 的更多信息。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-14T00:15:36.720

这不是答案，而是指向不同框架的指针：

[http://code.google.com/p/json-framework/](http://code.google.com/p/json-framework/)

我最近一直在使用它，序列化和反序列化来自第三方服务（如 Google Local）的复杂数据结构，以及我自己的 Objective-C 和 Perl 代码之间的复杂数据结构，绝对没有问题。更不用说 API 非常容易处理。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T03:40:56.803

JSON 处理对象的核心，您的反序列化代码应如下所示

```
{
  "objects": [{
    "id": "123456",
    "name": "touchjson"
  }, {
    "id": "3456",
    "name": "bleh"
  }]
} 
```

这确实适用于最新的结帐。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-05T07:53:30.603

@Mathieu - 我认为这就是你要找的东西（我知道晚了 6 个月 :)，但我遇到了同样的问题）

从这里复制并粘贴：[http ://groups.google.com/group/touchcode-dev/browse_thread/thread/ada885832019f45b](http://groups.google.com/group/touchcode-dev/browse_thread/thread/ada885832019f45b)

```
NSArray *tweetsArray = [resultsDictionary objectForKey:@"results"]; 
for (NSDictionary *tweetDictionary in tweetsArray) { 
  NSString *tweetText = [tweetDictionary objectForKey:@"text"]; 
  [tweets addObject:tweetText]; 
} 
```

为了提供更多上下文，我正在解析的 JSON 采用以下一般形式
：

```
{"results": 
   [ 
     {"text":"tweet1"}, 
     {"text":"tweet2"}, 
     {"text":"tweet3"} 
   ] 
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-09T23:41:04.020

不确定它是否对您有帮助，但请查看 [http://tempered.mobi/%20](http://tempered.mobi/%20)

# unit-testing - 最小起订量期望 IRepository 传递表达式

> ID：288413
> 
> 赞同：9
> 
> 时间：2008-11-13T21:34:00.353
> 
> 标签：unit-testing, moq

我正在使用此代码来验证我正在测试的方法的行为：

```
 _repository.Expect(f => f.FindAll(t => t.STATUS_CD == "A"))
    .Returns(new List<JSOFile>())
    .AtMostOnce()
    .Verifiable(); 
```

_repository 定义为：

```
private Mock<IRepository<JSOFile>> _repository; 
```

当我的测试运行时，我得到这个异常：

**不支持表达式 t => (t.STATUS_CD = "A")。**

如果我不能将表达式传递给 Expect 方法，有人可以告诉我如何测试这种行为吗？

谢谢！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-13T17:11:41.033

这是一种有点作弊的方式。我对表达式执行 .ToString() 并比较它们。这意味着您必须在被测类中以相同的方式编写 lambda。如果你愿意，你可以在这一点上做一些解析

```
 [Test]
    public void MoqTests()
    {
        var mockedRepo = new Mock<IRepository<Meeting>>();
        mockedRepo.Setup(r => r.FindWhere(MatchLambda<Meeting>(m => m.ID == 500))).Returns(new List<Meeting>());
        Assert.IsNull(mockedRepo.Object.FindWhere(m => m.ID == 400));
        Assert.AreEqual(0, mockedRepo.Object.FindWhere(m => m.ID == 500).Count);
    }

    //I broke this out into a helper as its a bit ugly
    Expression<Func<Meeting, bool>> MatchLambda<T>(Expression<Func<Meeting, bool>> exp)
    {
        return It.Is<Expression<Func<Meeting, bool>>>(e => e.ToString() == exp.ToString());
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T13:48:20.963

浏览起订量讨论列表，我想我找到了答案：

[起订量讨论](http://groups.google.com/group/moqdisc/browse_thread/thread/20f5a2ceefcba0e/8f477c1f5c4b5321?lnk=gst&q=func#8f477c1f5c4b5321)

看来我遇到了 Moq 框架的限制。

编辑，我找到了另一种测试表达式的方法：

[http://blog.stevehorn.cc/2008/11/testing-expressions-with-moq.html](https://web.archive.org/web/20100105203531/http://blog.stevehorn.cc/2008/11/testing-expressions-with-moq.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T22:53:25.183

尝试这个

```
 _repository.Expect(f => f.FindAll(It.Is<SomeType>(t => t.STATUS_CD == "A"))) 
```

检查错误的一种简单方法是确保在期望调用结束时始终有三个')'。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T22:04:26.657

在 Rhino Mocks 中，你会做这样的事情......

不要使用 Expect，而是使用 Stub 并忽略参数。然后有——

```
Func<JSOFile, bool> _myDelegate;

_repository.Stub(f => FindAll(null)).IgnoreArguments()
   .Do( (Func<Func<JSOFile, bool>, IEnumerable<JSOFile>>) (del => { _myDelegate = del; return new List<JSOFile>();}); 
```

*调用真实代码*

*设置一个假的 JSOFile 对象，将 STATUS_CD 设置为“A” *

```
Assert.IsTrue(_myDelegate.Invoke(fakeJSO)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T05:08:56.660

如果你想测试是否传递了正确的参数，你总是可以“滥用”返回语句：

> 布尔正确参数=真；
> 
> _repository.Expect(f => f.FindAll(It.IsAny>()))
> 
> .Returns((Func func) => {correctParamters = func(fakeJSOFile); return new List-JSOFile-(); })
> 
> .AtMostOnce()
> 
> .Verifiable();
> 
> Assert.IsTrue(正确参数);

这将使用您想要的参数调用传入的函数。

# md5 - 计算文件的 MD5 以保证完整性

> ID：288418
> 
> 赞同：4
> 
> 时间：2008-11-13T21:35:52.750
> 
> 标签：md5

我试图保证下载后文件的完整性。我将文件的 MD5 存储在数据库中，并在下载后将该 MD5 与文件进行比较。但是，当我在下载文件后对文件进行哈希处理时，我总是得到不同的 MD5 结果。我想知道正在散列的字节数组是否包含上次修改的元数据并且正在丢弃散列。如果其他人以前这样做过，您的帮助将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T01:47:41.977

MD5 哈希是根据文件内容计算的，不受文档元数据的影响。这是一个确定性的过程，如果您从相同的内容开始，总是会产生相同的结果（尽管有一些方法可以因碰撞而伪造 MD5 签名）。

您如何为文件创建 MD5 哈希？您是否尝试过使用[其他工具](http://www.md5summer.org/)来重现问题？

如果有不同的 MD5 签名，那么您的文件**会**有所不同。

之前关于 EOL 字符的建议，或以 ASCII 模式传输二进制文件很可能是文件可能被更改的原因。使用[差异工具](http://winmerge.org/)可以帮助确定文件的不同之处/方式。如果您的文件是二进制格式，请尝试使用[二进制差异工具](http://www.cjmweb.net/vbindiff/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T01:21:49.893

一种简单的查找方法：针对两个不同的下载运行差异（我假设是二进制但可能不是）。这应该可以快速查明问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T21:51:52.250

如果我在这里没有完全错，那么 md5 哈希仅适用于实际数据，而不是时间戳和其他元数据。也许您正在使用 ftp 传输文本文件，在这种情况下，ftpclient 可能会重写换行符以适合您的系统，然后散列将不同

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T21:53:31.890

如果您使用 FTP 下载，问题可能是：

*   二进制下载选项而不是 ASCII（反之亦然）。

*   跨平台传输，例如 Windows 到 Unix，其中 EOL 的处理方式不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T21:57:04.720

您可以仅通过对文件的特定部分进行散列来测试您的理论...比如说，中间的 50％...如果这不同，那么您知道它不仅仅是时间戳或其他东西...也就是说，您确实需要给我们更多信息以获得更好的答案...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-19T23:59:29.477

确保您实际上是根据文件的字节计算 MD5，而不是文件名或其他字符串。

# iphone - iPhone 开发者的 IRC 频道？

> ID：288424
> 
> 赞同：23
> 
> 时间：2008-11-13T21:36:44.247
> 
> 标签：iphone, irc

我想知道某个地方是否有一个好的 IRC 频道可以让 iPhone 开发人员聚在一起讨论代码等。

人们正在使用的任何渠道？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-15T14:52:03.970

这是 irc.freenode.net 上的#iphonedev。没有破折号。

还有#cocoa-init。这是一个新频道，专注于为 iOS/OSX 上的初学者提问和回答问题。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-09-19T21:00:04.683

#iphonedev 上的人不是很友好。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-13T21:44:09.410

我发现 irc.osx86.hu 上的各种 iphone 频道很有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T03:41:44.870

`#iphonedev`在`irc.freenode.net`

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T21:38:40.560

据我所知，苹果强迫 iPhone 开发者签署的 NDA 会阻止他们参与这样的讨论。

编辑：请参阅我的回答的评论。显然 NDA 已于 2008 年 10 月 1 日解除。因此，如果您正在寻找的资源现在不存在，希望它很快就会存在。

# java - 如何将信息放入 Tapestry5 的输出流中？

> ID：288430
> 
> 赞同：2
> 
> 时间：2008-11-13T21:38:36.613
> 
> 标签：java, servlets, tapestry

如何将信息放入 Tapestry5 的输出流中？

当用户进入它时我需要一个页面打开一个对话框以保存或打开带有输出流信息的文件。

我写下一段代码：

公共类索引{

```
@Inject
private RequestGlobals requestGlobals;

@OnEvent("activate")
public void onActivate() {
    try {
        HttpServletResponse response = requestGlobals.getHTTPServletResponse();
        response.setContentType("text/txt");
        PrintWriter out = response.getWriter();
        out.println("hellooooooo");
        out.flush();
    } catch (IOException ex) {
        Logger.getLogger(Index.class.getName()).log(Level.SEVERE, null, ex);
    }
} 
```

}

我希望结果只是“helloooooooo”但是（“helloooooooo”+我的html原始页面）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T19:56:32.653

您的方法应该具有 StreamResponse 的返回类型。您返回接口 StreamResponse 的实现，该接口简单地返回您想要的数据以及您想要的内容类型。

在这里查看：

[http://tapestry.apache.org/tapestry5/apidocs/](http://tapestry.apache.org/tapestry5/apidocs/)

更多信息在这里：

[http://tapestry.formos.com/nightly/tapestry5/tapestry-core/guide/pagenav.html](http://tapestry.formos.com/nightly/tapestry5/tapestry-core/guide/pagenav.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-30T20:49:48.657

如果您正在处理大型响应流，则使用[StreamResponse](http://tapestry.apache.org/tapestry5/apidocs/org/apache/tapestry5/StreamResponse.html)可能会有些不便且效率低下（因为您必须返回[InputStream](http://download.oracle.com/javase/6/docs/api/java/io/InputStream.html)）。最好将响应直接写入[OutputStream](http://download.oracle.com/javase/6/docs/api/java/io/OutputStream.html)。

幸运的是，在 Tapestry Wiki 中有一个页面可以解决这个问题：[Tapestry5: How To Create A Component Event Result Processor](http://wiki.apache.org/tapestry/Tapestry5HowToCreateAComponentEventResultProcessor)。

# c - C 中的变量声明位置

> ID：288441
> 
> 赞同：140
> 
> 时间：2008-11-13T21:43:36.900
> 
> 标签：c, declaration, c89

我一直认为在 C 中，所有变量都必须在函数的开头声明。我知道在 C99 中，规则与 C++ 中相同，但 C89/ANSI C 的变量声明放置规则是什么？

以下代码使用`gcc -std=c89`and成功编译`gcc -ansi`：

```
#include <stdio.h>
int main() {
    int i;
    for (i = 0; i < 10; i++) {
        char c = (i % 95) + 32;
        printf("%i: %c\n", i, c);
        char *s;
        s = "some string";
        puts(s);
    }
    return 0;
} 
```

不应该在 C89/ANSI 模式下声明`c`并`s`导致错误吗？

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2008-11-13T21:47:29.513

它编译成功是因为 GCC 允许将 声明`s`为 GNU 扩展，即使它不是 C89 或 ANSI 标准的一部分。如果你想严格遵守这些标准，你必须通过`-pedantic`标志。

`c`块开头的声明`{ }`是 C89 标准的一部分；该块不必是一个函数。

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2008-11-13T21:53:01.127

*对于 C89，您必须在作用域块*的开头声明所有变量。

因此，您的`char c`声明是有效的，因为它位于 for 循环范围块的顶部。但是，`char *s`声明应该是一个错误。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2010-11-05T11:11:33.847

由于旧的原始 C 编译器的限制，在块的顶部对变量声明进行分组是一种遗留问题。所有现代语言都建议，有时甚至强制在最晚点声明局部变量：它们首先被初始化的地方。因为这消除了错误使用随机值的风险。分离声明和初始化还可以防止您尽可能使用“const”（或“final”）。

不幸的是，C++ 一直接受旧的、顶级的声明方式来向后兼容 C（一个 C 兼容性拖累了许多其他的......）但 C++ 试图摆脱它：

*   C++ 引用的设计甚至不允许这样的块顶部分组。
*   *如果您将 C++ 本地对象*的声明和初始化分开，那么您就无需支付额外构造函数的成本。如果无参数构造函数不存在，那么您甚至不允许将两者分开！

C99 开始向同一方向移动 C。

如果您担心找不到声明局部变量的位置，那么这意味着您有一个更大的问题：封闭块太长，应该拆分。

[https://wiki.sei.cmu.edu/confluence/display/c/DCL19-C.+Minimize+the+scope+of+variables+and+functions](https://wiki.sei.cmu.edu/confluence/display/c/DCL19-C.+Minimize+the+scope+of+variables+and+functions)

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-11-13T22:05:49.820

从可维护性而非句法的角度来看，至少有三种思路：

1.  在函数的开头声明所有变量，这样它们就在一个地方，你就能一眼看到完整的列表。

2.  将所有变量声明为尽可能靠近它们首次使用的位置，这样您就会知道*为什么*需要每个变量。

3.  在最内层范围块的开头声明所有变量，以便它们尽快超出范围并允许编译器优化内存并告诉您是否不小心在不打算使用的地方使用了它们。

我通常更喜欢第一个选项，因为我发现其他选项经常迫使我在代码中寻找声明。预先定义所有变量还可以更容易地从调试器初始化和观察它们。

我有时会在较小的范围块内声明变量，但只是出于一个很好的理由，其中我很少。一个例子可能是在`fork()`, 之后声明只有子进程需要的变量。对我来说，这个视觉指示器有助于提醒他们的目的。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-05-16T11:10:15.710

正如其他人所指出的，即使在“C89”模式下，GCC 在这方面也是允许的（可能还有其他编译器，取决于它们被调用的参数），除非您使用“pedantic”检查。老实说，没有太多好理由不迂腐；高质量的现代代码应该总是在没有警告的情况下编译（或者很少有人知道你正在做一些对编译器来说可能是可疑的特定错误），所以如果你不能用迂腐的设置来编译你的代码，它可能需要一些注意。

C89 要求在每个范围内的任何其他语句之前声明变量，后来的标准允许声明更接近使用（这可以更直观和更有效），特别是在“for”循环中同时声明和初始化循环控制变量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-06-12T17:16:03.270

如前所述，对此有两种思想流派。

1）在函数顶部声明所有内容，因为年份是 1987 年。

2) 声明最接近首次使用并尽可能在最小范围内。

我对此的回答是两者都做！让我解释：

对于长函数，1) 使重构非常困难。如果您在开发人员反对子例程概念的代码库中工作，那么您将在函数开头有 50 个变量声明，其中一些可能只是 for 循环的“i”函数的底部。

因此，我由此开发了最顶层的 PTSD 声明，并尝试虔诚地执行选项 2）。

我回到选项一是因为一件事：短函数。如果你的函数足够短，那么你的局部变量就会很少，而且由于函数很短，如果你把它们放在函数的顶部，它们仍然接近第一次使用。

此外，当您想在顶部声明但尚未进行初始化所需的一些计算时，“声明并设置为 NULL”的反模式已解决，因为您需要初始化的内容可能会作为参数接收。

所以现在我的想法是你应该在函数的顶部声明并尽可能接近第一次使用。所以两者都有！做到这一点的方法是使用划分良好的子程序。

但是如果你正在处理一个长函数，那么把最接近第一次使用的东西放在最接近的地方，因为这样会更容易提取方法。

我的食谱是这样的。对于所有局部变量，获取变量并将其声明移至底部，编译，然后将声明移至编译错误之前。这是第一次使用。对所有局部变量执行此操作。

```
int foo = 0;
<code that uses foo>

int bar = 1;
<code that uses bar>

<code that uses foo> 
```

现在，定义一个在声明之前开始的范围块并移动结束直到程序编译

```
{
    int foo = 0;
    <code that uses foo>
}

int bar = 1;
<code that uses bar>

>>> First compilation error here
<code that uses foo> 
```

这不会编译，因为还有一些使用 foo 的代码。我们可以注意到编译器能够通过使用 bar 的代码，因为它不使用 foo。此时，有两种选择。机械的一种是向下移动“}”直到它编译，另一种选择是检查代码并确定是否可以将顺序更改为：

```
{
    int foo = 0;
    <code that uses foo>
}

<code that uses foo>

int bar = 1;
<code that uses bar> 
```

如果可以切换顺序，那可能就是您想要的，因为它会缩短临时值的寿命。

需要注意的另一件事是，是否需要在使用它的代码块之间保留 foo 的值，或者它可能只是两者中的不同 foo 。例如

```
int i;

for(i = 0; i < 8; ++i){
    ...
}

<some stuff>

for(i = 3; i < 32; ++i){
    ...
} 
```

这些情况需要的不仅仅是我的程序。开发人员必须分析代码以确定要做什么。

但第一步是找到第一个用途。您可以直观地做到这一点，但有时，删除声明更容易，尝试编译并将其放回第一次使用之上。如果第一次使用在 if 语句中，请将其放在那里并检查它是否编译。然后编译器将识别其他用途。尝试制作一个包含两种用途的范围块。

完成这个机械部分后，分析数据的位置就变得更容易了。如果在大范围块中使用变量，请分析情况并查看您是否只是将相同的变量用于两个不同的事物（例如用于两个 for 循环的“i”）。如果用途不相关，则为这些不相关的用途中的每一个创建新变量。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-08-12T06:51:23.383

我将引用 gcc 4.7.0 版手册中的一些陈述以进行清晰的解释。

“编译器可以接受几个基本标准，例如'c90'或'c++98'，以及这些标准的GNU方言，例如'gnu90'或'gnu++98'。通过指定一个基本标准，编译器将接受所有遵循该标准的程序以及那些使用与该标准不冲突的 GNU 扩展的程序。例如，'-std=c90' 会关闭与 ISO C90 不兼容的 GCC 的某些功能，例如 asm 和 typeof 关键字，但不其他在 ISO C90 中没有意义的 GNU 扩展，例如省略 ?: 表达式的中间项。”

我认为您问题的关键是即使使用了选项“-std=c89”，为什么 gcc 也不符合 C89。我不知道你的 gcc 的版本，但我认为不会有太大的不同。gcc 的开发者告诉我们，选项“-std=c89”只是意味着与 C89 相矛盾的扩展被关闭。因此，它与一些在 C89 中没有意义的扩展无关。并且不限制变量声明放置的扩展属于与C89不冲突的扩展。

老实说，大家第一眼看到“-std=c89”这个选项就会认为它应该完全符合C89。但事实并非如此。至于一开始就声明所有变量的问题是好是坏只是习惯问题。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2020-01-20T07:52:23.200

您应该在函数的顶部或“本地”声明所有变量。答案是：

**这取决于**您使用的系统类型：

1/ 嵌入式系统（特别是与飞机或汽车等生活相关的）：它确实允许您使用动态内存（例如：calloc、malloc、new...）。想象一下，你在一个非常大的项目中工作，有 1000 名工程师。如果他们分配新的动态内存并忘记删除它（当它不再使用时）怎么办？如果嵌入式系统运行时间过长，会导致堆栈溢出，软件会损坏。不容易保证质量（最好的办法是禁止动态内存）。

如果一架飞机在 30 天内运行并且没有关闭，如果软件损坏（当飞机仍在空中）会发生什么？

2/其他系统如web、PC（有大内存空间）：

您应该“本地”声明变量以优化内存使用。如果这些系统运行了很长时间并且发生堆栈溢出（因为有人忘记删除动态内存）。只需做简单的事情来重置电脑：P 它对生活没有影响

# html - 如何使用 swf 中的按钮删除嵌入在 html 中的 swf 文件？

> ID：288445
> 
> 赞同：0
> 
> 时间：2008-11-13T21:44:13.123
> 
> 标签：html, flash, embed

我有一个嵌入在 html 页面中的 swf 文件，并且我在 swf 页面中有一个关闭按钮，我希望当我单击按钮时 swf 消失，最好的方法是什么？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-24T09:12:40.357

如果您使用 swfobject 2.1 来嵌入 swf，您可以使用这个内置的 javascript swfobject.removeSWF() 函数：

```
function removeFlashFromHTML() 
{
 swfobject.removeSWF("id_of_your_html_object");
} 
```

现在您使用 ExternalInterface 从 flash 调用 javascript 函数：

```
function buttonClicked(evt:MouseEvent) 
{
 if (ExternalInterface.available) {
  ExternalInterface.call("removeFlashFromHTML()");
 }
} 
```

有关 SWFObject 的更多信息，请查看[此](http://code.google.com/p/swfobject/)网站

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T21:50:13.283

编写一个隐藏 swf 或其包含元素的 JavaScript 函数，并通过 swf 本身中的“关闭按钮”调用该函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T22:19:43.990

[下面](http://www.communitymx.com/content/article.cfm?cid=0922A)是一篇关于如何让 flash 在你的页面上调用一些 JS 的文章。如果您永远不希望它回来（隐藏后），我建议您[将其从 DOM](http://www.dustindiaz.com/add-and-remove-html-elements-dynamically-with-javascript/)中删除以释放资源，因为闪存在客户端环境中很昂贵。

# java - 如何开始在 Eclipse 中设计 portlet？

> ID：288449
> 
> 赞同：3
> 
> 时间：2008-11-13T21:45:25.133
> 
> 标签：java, eclipse, plugins, portlet

是否有任何用于 Portlet 设计和部署的 Eclipse 插件？我从来没有设计过portlet，那么网上也有什么好的教程吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T21:47:23.243

您确实有关于 portlet 开发的[教程](http://struts.apache.org/2.x/docs/developing-a-portlet-using-eclipse.html)（不是 portlet 部署，而是通过适当的[eclipse-maven 配置](http://wiki.oss-watch.ac.uk/PlutoNotes)）

[Portal eclipse](http://portlet-eclipse.sourceforge.net/)还可以帮助在 eclipse 中开发 portlet。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-12T22:46:56.930

你可以试试[http://sourceforge.net/projects/portlet-eclipse/](http://sourceforge.net/projects/portlet-eclipse/)

此外，您可以尝试 IBM Rational Application Developer，它是 IBM 的基于 Eclipse 的 IDE。它的 Portlet 和门户向导很好……但 RAD 不是开源的。

# c# - WCF 和 MSMQ 故障处理

> ID：288457
> 
> 赞同：7
> 
> 时间：2008-11-13T21:47:54.707
> 
> 标签：c#, .net, wcf, queue, msmq

有人可以向我解释这三种处理传递失败消息的方法之间的区别吗？

*   中毒队列服务
*   死信队列服务
*   使用响应服务来处理故障

我有“Programming WCF”，但我真的不明白什么时候你会使用其中一个而不是另一个，或者什么时候使用多个它们是有意义的。谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T08:15:20.207

死和毒是两个不同的概念。有毒消息是可以从队列中读取的消息，但您的代码不知道如何处理它，因此您的代码会给出异常。如果这种情况持续一段时间，您希望将此消息放在不同的队列中，以便处理您的其他消息。[MSDN](http://msdn.microsoft.com/en-us/library/ms751472.aspx)上描述了一个很好的方法。

死信是队列甚至不处理的消息。网络中断或接收 MSMQ 计算机已关闭。类似的东西。一段时间后，Windows 会自动将消息放入死队列。所以建议编写一个监控死队列的服务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T16:35:19.550

有毒消息/死信消息队列用于将已确定为无法投递的消息放置在不再尝试投递的队列中。如果您可能想要手动查看失败的消息并在稍后处理它们，您可以这样做。当您希望通过一遍又一遍地重试来防止坏消息降低系统性能时，您可以使用这些类型的队列。

另一方面，响应服务将用于通知发送者处理消息时出错。通常在这种情况下，您不打算手动处理错误消息，并且需要让发送消息的系统认为请求已被拒绝。

请注意，这些不是排他性的。如果您使用队列，则消息序列化总是有可能发生足够的变化以破坏队列中的消息，在这种情况下，即使您使用响应服务，您仍可能希望拥有一个死信队列。

# timeout - .NET 取消流 BeginRead

> ID：288463
> 
> 赞同：3
> 
> 时间：2008-11-13T21:48:55.253
> 
> 标签：timeout, beginread

在成功 HttpWebRequest 后，我​​无法找到取消/终止异步读取操作的方法。无法设置超时，ThreadPool.RegisterWaitForSingleObject 也不起作用。并且关闭底层套接字也不是一种选择，因为 HttpWebRequest/Reponse 都没有提供对它的访问。

编辑：

遗憾的是，Sunny 建议的这种方法仅适用于 HttpWebRequest.BeginGetResponse。对于您在 GetResponseStream() 之后获得的流，由于某种原因 RegisterWaitForSingleObject 不起作用 - 永远不会调用回调。

情况如下： 我有一个使用 HttpGetRequest 的应用程序。它是使用异步 httpwebrequest 的默认 MSDN 示例构建的。获得响应就像一种魅力。但在极少数情况下，我的 httpwebrequest 连接的服务器会忘记关闭套接字。所以我挂在 BeginRead 的无限阅读上。

在极少数情况下，其他服务器会忘记

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T22:00:10.550

为什么不注册WaitForSingleObject？您可以将其用于超时，并且在处理程序中您可以调用 request.Abort()。

这是一个[例子](http://www.developerfusion.com/code/4654/asynchronous-httpwebrequest/)。顺便说一句，在我过去找到这篇文章之前，我已经使用了 simial 方法，它就像一个魅力。

注意：操作的真正结束将发生在下一个 Stream.Read （只有请求/响应是异步的）或 Stream.EndRead （如果读取也是异步的）。您仍然需要捕获 EndXXXX 处理程序中引发的异常。

编辑：如果 RegisterWaitForSingleObject 从未被调用，那么您还有另一个问题，这很可能是 ThreadPool 没有足够的空闲线程。RegisterWaitForSingle 对象的回调在 ThreadPool 线程上调用，如果池中没有空闲线程，则永远不会调用它。你有一些解决方案：

1.  使您的页面异步。[为什么](http://davidjberman.com/blogs/csharp/archive/2007/08/13/how-to-create-asynchronous-asp-net-pages-using-c.aspx)？[怎么样](http://msdn.microsoft.com/en-us/magazine/cc163725.aspx)。
2.  更改[池中的最大线程数](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.setmaxthreads.aspx)。

无论如何，增加池大小不会对您有太大帮助。您必须检查您的代码是否存在资源（流）泄漏，并确保您不仅调用了 request.Abort()，而且还关闭了响应。确保在您的回调中使用正确的 EndXXX 方法等。

我纳兹德拉夫 :)

# c++ - 如何从 IXMLDOMNode 访问元素属性？

> ID：288465
> 
> 赞同：3
> 
> 时间：2008-11-13T21:49:20.133
> 
> 标签：c++, dom, msxml, ixmldomelement, ixmldomnode

我正在用 C++ 构建一个 XML DOM 文档。我的问题是：我从文档中的一个元素执行 XPATH 查询，我知道它会返回另一个元素。elementPtr->selectSingleNode 调用返回一个 IXMLDOMNode。如何访问该节点的属性？

我的一部分想要将节点向下转换为元素，但我无法让演员工作。

我试过

```
MSXML2::IXMLDOMElementPtr pParentElement;
pParentNode->QueryInterface(__uuidof(MSXML2::IXMLDOMElement), 
                            (void**) &pParentElement); 
```

这会导致以下运行时错误：

```
0x0057cc58 _com_error::`scalar deleting destructor'(unsigned int) 
```

我尝试的另一条路线是只使用节点：

```
MSXML2::IXMLDOMNodePtr pParentNode = 
    pParameterElement->selectSingleNode("parent");
MSXML2::IXMLDOMNamedNodeMap* pParentAttributes;
pParentNode->get_attributes(&pParentAttributes);

MSXML2::IXMLDOMNodePtr pCategoryNameNode = 
    pParentAttributes->getNamedItem("Category");
VARIANT value;
pCategoryNameNode->get_nodeValue(&value);
CString categoryName = value; 
```

这在“parentNode->get_attributes()”处失败。

好像我错过了什么；API 不应该这么难使用。

- 编辑 -

我缺少的是 selectSingleNode 调用失败，给我留下了一个 NULL 指针。你不能调用 QueryInterface ，也不能调用 get_attributes ：P

我选择了适合我提出的问题的答案，而不是帮助我意识到我问错问题的答案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-14T03:58:47.923

我看不出你写的有什么问题。

如果可以的话，智能 com 指针将帮助您进行转换，您不必自己编写查询接口。

```
MSXML2::IXMLDOMNodePtr pParentNode = pParameterElement->selectSingleNode("parent");
MSXML2::IXMLDOMElementPtr pParentElement( pParentNode ); 
```

在我看来，使用 Ptr 类型有点痛苦，尽管 MSXML 接口有利于它们。这是一个使用 ATL 的等价示例

```
CComPtr<IXMLDOMNode> node = ...;
CComQIPtr<IXMLDOMElement> elementNode( node );

if( elementNode ) { 
// it was an element!
} else { 
// it's something else try again? 
} 
```

另一种尝试看起来像......

```
CComPtr<IXMLDOMNamedNodeMap> attributes;
node->get_attributes( &attributes );
if( attributes ) {
  _bstr_t name( L"category" );
  attributes->getNamedItem(name);
} 
```

而且它是 COM，在 C++ 中总是很难使用 :(

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T22:06:22.220

您是如何尝试从 IXMLDOMNode 向下转换为 IXMLDOMElement 的？你不能只使用 C++ 强制转换，因为它是一个 COM 对象：你必须使用 QueryInterface()。

* * *

查看您的 QueryInterface() 代码，一些想法：

*   pParentNode 绝对不为空吗？考虑到您所得到的，我认为这不是问题所在，但值得检查。
*   我认为 QueryInterface() 调用不太正确：您必须在返回的接口上以一种或另一种方式调用 AddRef() ，而您的代码不会。正如另一张海报指出的那样，您可以让 _com_ptr_t<> 为您执行此操作：

    ```
    MSXML2::IXMLDOMElementPtr pParentElement(pParentNode); 
    ```

我希望这样做会阻止可能由 AddRef()/Release() 不匹配引起的“标量删除析构函数”错误。

不管怎样，试试上面的方法，看看 pParentElement 是否为空。如果是，我建议的下一件事是在 pParentNode 上调用 get_nodeType() 以查看它到底是什么类型的节点。这可能会提供关于 XPath 是否没有返回您期望的内容的线索。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-05-20T11:31:45.527

`CComPtr`是必要的`IXMLDOMNamedNodeMap`，否则会有一个例外：

`IXMLDOMNamedNodeMap`不允许抽象类类型的对象

# apache-flex - 链接 SWC 文件时出现问题

> ID：288467
> 
> 赞同：1
> 
> 时间：2008-11-13T21:49:51.490
> 
> 标签：apache-flex, actionscript, swc

我正在尝试链接 as3corelib 库以按照[本教程](http://www.mikechambers.com/blog/2006/03/28/tutorial-using-json-with-flex-2-and-actionscript-3/)使用其 JSON 功能。但是我在编译它时遇到了麻烦。我的命令看起来像：

```
mxmlc --strict=true -library-path+=as3corelib.swc --file-specs myapp.mxml

```

但我收到此错误：

```
_divided_mx_managers_SystemManager.as（13）：col：14错误：命名空间mx.managers中的接口方法getVisibleApplicationRect：ISystemManager未实现
_divided_mx_managers_SystemManager 类。

公共类_divided_mx_managers_SystemManager

```

问题是什么？

*更新：这是因为我使用的是 Flex 3 吗？该教程似乎适用于 Flex 2。如果是这样，我需要为 Flex 3 做什么？*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T23:34:44.850

I found an older version of the library bundled with some tutorial which worked. Submitted a bug report to as3corelib, of course I am not entirely sure how valid the bug is.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T20:30:26.237

如果您使用的是 Flex Builder 3，您实际上可以只获取 swc 文件并将其放在 libs 目录中。这将自动将其添加到您的类路径中，您应该可以从那时起使用它。您可能需要随后对项目进行清理以确保它接受它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-14T05:18:10.210

我在 Flex builder 4 中遇到了类似的问题。我必须将 as3corelib 源代码放入我的源代码中才能正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T22:31:23.420

你在使用 flex Gubmo sdk 吗？看起来它抱怨的方法是在 Gumbo 的接口中。如果是这样，那么 as3corelib 可能无法使用它。

# sql-server - SQL Server 2008 Reporting Services 能否在 ASP.NET 应用程序中使用对象列表作为数据源

> ID：288472
> 
> 赞同：0
> 
> 时间：2008-11-13T21:51:19.117
> 
> 标签：sql-server, reporting-services

我正在开发一个 ASP.NET (3/5) Web 应用程序。在应用程序中，我们组合了来自各种数据源的类列表。我想在 SQL Server SSRS 中创建一个报告，从其中一个列表的内容中呈现报告，而不将列表推送到数据库（事实上，如果我们这样做，这将违反一堆规则） . 现在我们正在使用 SQL Server 2005，但我们正在考虑迁移到 2008。我想做的事情是否可行，如果可以，我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T22:41:12.167

报告服务提供称为 DataSet 扩展的东西。您可以使用它从您的自定义数据源呈现报告。您不需要将它们加载回数据库。但是，某些 SQL 版本（如 SQL Express 报告服务）不支持数据集扩展。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T21:09:22.467

您可能希望使用 Visual Studio 2005 和 Visual Studio 2008 附带的 ReportViewer 控件。

它可以在“本地模式”下运行，不需要报表服务器后端。您只需将其从 VS 工具箱拖放到 ASPX 表单上，然后在代码中将其连接到任何 IEnumerable 集合作为其数据源，然后为其提供本地模式 (RDLC) 的报告定义文件。

RDLC 文件与原始的 RDL（报告定义语言）基本相同，但它省略了一些内容，例如由您的应用程序提供的数据源。ReportViewer 控件包含一个较小版本的报表处理引擎，因此在运行时，它将您提供的 RDLC 与数据集或可绑定集合“耦合”，然后它会完成其余的工作。

有关此控件的更多详细信息，请查看以下站点： [www.gotreportviewer.com](http://www.gotreportviewer.com)

高温高压

# enterprise-library - Enterprise Library 4：日志记录块平面文件

> ID：288496
> 
> 赞同：0
> 
> 时间：2008-11-13T21:59:07.697
> 
> 标签：enterprise-library, enterprise

我在为文本文件创建日志条目时遇到问题。这是我的 ASP.net 应用程序中的日志记录配置。

这是我的 vb.net 代码

尝试 db.ExecuteNonQuery(cmd, tr) tr.Commit() result = True Catch ex As Exception Dim entry As New LogEntry() entry.EventId = 11 entry.Message = ex.Message entry.Categories.Add("General") Logger.Write(入口)

```
 tr.Rollback()
                End Try 
```

到目前为止，我发现的所有教程和示例都是基于旧版本的 Enterprise Library。我正在使用 Enterprise Library 4。有谁知道我做错了什么？是我的代码还是配置？我在哪里可以找到有关 Enterprise Library 版本 4 的更多教程。我尝试按照它附带的快速入门进行操作，但我无法做出正面或反面。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T07:13:57.063

它是关于使用企业库 4.1 的基本教程

[http://blog.accentient.com/EnterpriseLibraryLogging101.aspx](http://blog.accentient.com/EnterpriseLibraryLogging101.aspx)

顺便说一句，为了让我的工作，我必须将所有 PublicKeyToken 更改为 = null 否则 web.config 没有验证，gl

# macos - SSH 在 Mac Book Pro 上挂起；AFS 和网络首选项？

> ID：288500
> 
> 赞同：3
> 
> 时间：2008-11-13T22:00:58.050
> 
> 标签：macos, ssh, kerberos

我的 Mac Book Pro 上挂起 SSH 时遇到问题。这只有在我在工作时使用 SSH 后下班回家后才会发生。我将问题缩小到的三个因素是 SSH、我们的工作 AFS 网络驱动器和网络连接方法。

在工作中，我们使用带有 Kerberos 身份验证的 AFS 驱动器来完成我们所有的软件开发工作。我使用 Kerberos 进行身份验证，以便访问我所有源代码所在的 AFS 驱动器，但我打开了一个本地编辑器 (Eclipse)，它引用了 AFS 驱动器上的文件。每当我需要编译我的代码时，我都会通过 SSH 连接到我的开发服务器（它也通过了 AFS 驱动器的身份验证）并从那里编译。（理智提示：我知道这是一个超级古怪的设置，但我保证我与它没有任何关系。我只是利用我所拥有的。）

对于我的网络首选项，我一直使用自动位置。对于该配置，我将内置以太网 en1 配置为在工作时使用 DHCP 和我们公司的 DNS 服务器（没有可用的无线网络）。当我回家时，我通过无线连接到我的家庭网络，再次使用 DHCP。

我有一种预感，AFS 连接/以太网配置是这里的罪魁祸首。重新启动 SSH 守护程序并不能解决问题。我发现解决此问题的唯一方法是每次我想使用 SSH 时重新启动计算机。请记住，当我在工作中使用笔记本电脑后，在家时我没有其他（已知的）网络问题。

我有一位同事在他的 MBP 上向我报告了同样的问题。

我真的被这个难住了。请提供一些指导。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T06:47:22.960

您能否更具体地了解“SSH 挂起”？

听起来您的 ssh**客户端**在失去连接后挂起，您无法在终端中执行任何操作。为了解决这个问题，您可以使用 ssh 转义字符（默认值：'~'）开始转义序列，并使用 '.' 终止连接。

您可以使用 ~? 获取其他 ssh 转义序列的列表，这是 OpenSSH SSH 客户端的列表：

```
Supported escape sequences:
~.  - terminate connection
~B  - send a BREAK to the remote system
~C  - open a command line
~R  - Request rekey (SSH protocol 2 only)
~^Z - suspend ssh
~#  - list forwarded connections
~&  - background ssh (when waiting for connections to terminate)
~?  - this message
~~  - send the escape character by typing it twice
(Note that escapes are only recognized immediately after newline.) 
```

如果键入〜。不起作用，可能是您禁用了转义字符，在这种情况下您可以输入

```
EscapeChar ~ 
```

在*~/.ssh/config*或*/etc/ssh_config内*

即使转义字符被禁用，您也可以简单地拉出另一个终端窗口并键入

```
killall ssh 
```

结束所有正在运行的 ssh 进程，允许您再次连接。

重新启动 SSH 守护程序不会解决此问题，因为 sshd 允许其他客户端连接到您的机器，并且不会影响您的 ssh 客户端连接到其他机器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T20:08:07.560

看来我的问题的解决方法是删除我在工作时有效但在家时无效的 Kerberos 令牌。希望这可以帮助任何有类似问题的人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T08:09:24.027

只是在黑暗中拍摄：我最近在安装 Rogue Amoeba Audio Hijack Pro 后使用 ssh 时遇到了问题。我只能将 ssh 用作超级用户（sudo）。对 2.8.1 的更新解决了该问题...

有关该问题，另请参见[http://www.macobserver.com/article/2008/03/19.8.shtml](http://www.macobserver.com/article/2008/03/19.8.shtml)。

# objective-c - Xcode 是否支持区域？

> ID：288508
> 
> 赞同：41
> 
> 时间：2008-11-13T22:04:06.687
> 
> 标签：objective-c, xcode, code-folding

Xcode 是否支持任何类似于 Visual Studio 样式`#region`指令的任意代码折叠？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-11-13T22:12:05.063

不，您只能在 Xcode 中定义的各种范围级别上折叠代码。

不过，您可以使用一些小技巧来更轻松地通过功能菜单进行导航。

```
#pragma mark 
```

允许您创建一个分组，其中标记后面的标签将显示在功能菜单中。如果标签是连字符，则在功能菜单中插入分隔符。

此外，注释中的以下标签将显示在功能菜单中：

```
// MARK:
// TODO:
// FIXME:
// !!!:
// ???: 
```

显然，由于#pragma 标记并不是真正可移植的，如果您正在构建一个可移植应用程序并且需要它与一个编译器一起工作，而该编译器不只是忽略它不理解的#pragma 指令，那么注释样式标记是一个不错的选择选择。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-04T08:13:09.773

我会为此而下地狱，但这里有：

在给定文件的顶部，放

```
#define FOLD 1 
```

无论你想在哪里折叠东西，把它包裹在一个 if 块中，如下所示：

```
if(FOLD) {
 // your code to hide
 // more code
} 
```

这会让你把它折叠起来看不见。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-04T17:02:38.317

这在您最想要的地方不起作用，即围绕函数或方法组。

它在没有内部条件或循环的长线性方法中可能很有用，但这种方法在一般 Mac OS X UI 代码中并不常见，但如果您正在编写一些大型数字或图形处理代码，它可以帮助分组事物。

而 if(fold) 完全是多余的。只需在方法或函数中使用大括号，Xcode 就会折叠它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-04-24T04:11:16.277

试试这种方式：

```
//region title1
{
    //region Subtitl1
    {

    }
    //region Subtitl2
    {

    }
} 
```

它可以这样做：

![它可以这样做：](https://i.stack.imgur.com/xqlWN.png)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-09-09T16:20:33.190

在不支持 .Net 样式区域的情况下，能够同时折叠所有功能是下一个最好的选择。

`command`- `option`- `shift`-`left arrow` 全部崩溃。

`command`- `option`- `shift`-`right arrow` 展开全部。

Xcode 会记住折叠函数的最后状态。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-11-17T22:13:02.150

XCode 12（可能之前）中的一个有用选项是首选项“代码折叠功能区”中的一个选项

[![代码折叠丝带](https://i.stack.imgur.com/i842c.jpg)](https://i.stack.imgur.com/i842c.jpg)

当你检查它时，源代码看起来像这样

[![代码中的功能区](https://i.stack.imgur.com/745Hw.jpg)](https://i.stack.imgur.com/745Hw.jpg)

当您将鼠标悬停在此功能区上时，您将获得基于括号的可折叠区域，如下所示

[![可折叠丝带](https://i.stack.imgur.com/0qX71.jpg)](https://i.stack.imgur.com/0qX71.jpg)

当您单击功能区时，它会折叠括号区域，如下所示

[![折叠丝带](https://i.stack.imgur.com/IirfE.jpg)](https://i.stack.imgur.com/IirfE.jpg)

它不像 Visual Studio 中的区域，您可以将它们放置在任何您想要的位置，但它们足以整理您的代码文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-31T07:37:30.720

把你想要的代码放在括号 { } 里面，它就会变成一个折叠区。

但是您必须记住，括号也定义了变量范围，因此此代码不应包含将在这些括号之外使用的变量声明。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2012-06-20T09:09:34.563

我刚刚发现的一个不错的解决方案：

将您的项目放入一个大命名空间中。为源文件的各个部分关闭并重新打开此命名空间：

```
namespace myproj { // members of class MyClassA

void MyClassA::dosomething()
{
}

void MyClassA::dosomethingelse()
{
}

} // members of class MyClassA
namespace myproj { // members of MyClassB

void MyClassB::dosomething()
{
}

void MyClassB::dosomethingelse()
{
}

} // members of MyClassB 
```

# artificial-intelligence - 滑动瓷砖问题的启发式

> ID：288511
> 
> 赞同：0
> 
> 时间：2008-11-13T22:04:41.070
> 
> 标签：artificial-intelligence, heuristics

这个想法是将所有右侧元素移动到左侧，将左侧移动到右侧，中间有一个空白空间。元素可以跳过一个或两个部分进入一个空白空间。

```
LLL[ ]RRR 
```

我正在尝试为这项任务考虑启发式方法。启发式是为了帮助找到可能的解决方案，还是实际上返回一些移动作为解决方案？我将如何表达这样的启发式？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T22:21:56.247

听起来你对什么是启发式有点困惑。

粗略的定义是“一个简化的假设”或“一个体面的猜测”

例如，假设您必须组建一支篮球队，并且您有关于想参加比赛的人的情况说明书，其中列出了他们的联系信息、出生日期和身高。您可以举行选拔赛，测试每个候选人的特定技能；不过，这需要引入所有候选人，而且可能需要很长时间。您使用启发式方法来缩小搜索范围——只调用至少 6 英尺 2 英寸高的人。这可能会忽略一些伟大的篮球运动员，但这是一个相当不错的猜测。

另一个启发式示例：您尝试使用最少数量的硬币来支付账单。启发式（一种简化的方法）是首先挑选价值最大的硬币（小于剩余的钞票），然后从钞票中减去价值，然后重复。这不能保证每次都有效，但它会在大多数情况下将您带到正确的社区。

您的问题的启发式方法可能是“永远不要将 Ls 向右移动，也永远不要将 Rs 向左移动”——它通过从一开始就消除一些可能性来缩小所有可能移动的“搜索空间”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T22:07:57.787

您在寻找启发式还是算法？启发式可能会也可能不会解决给定的问题。它实际上只是为了向您指出解决方案可能所在的方向。算法确实应该解决给定的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T15:27:17.810

启发式通常是一种“提示”，通常（但不总是）会引导您的程序朝着正确的方向前进。使用启发式方法可以加速你的程序（你的算法），**通常**，但并非总是如此。这就像对算法的“建议”，通常是正确的。

我不确定您在寻找什么，因为描述有点模糊。如果您想要该算法，您将需要研究特定移动对当前情况的影响以及每次向前推进所有可能移动的方法，实际上是遍历状态树（即，如果你做了一个特定的动作序列）。

您还可以看到，当前位置与您想要达到的目标（您想要的最终位置）的**接近程度**可能很重要。因此，与其计算从初始状态到找到最终状态的所有可能路径，您可以指导您的基于启发式“当前状态与所需状态的接近程度”的算法，并且只遍历树的一部分。

# linux - 在 Linux 中将窗口大小调整为设定的大小

> ID：288512
> 
> 赞同：31
> 
> 时间：2008-11-13T22:04:46.687
> 
> 标签：linux

任何人都知道将任何窗口调整为例如 640x480 的好方法吗？

原因当然是截屏。

在 windows 下，我使用了来自donationcoder 的 ZoneSize。（顺便说一句：对于 Firefox，这很简单，只需使用 Web 开发人员工具栏。）

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-11-13T22:15:32.220

使用[wmctrl](http://www.sweb.cz/tripie/utils/wmctrl/)命令：

列出窗口：

```
$ wmctrl -l
0x00c00003 -1 rgamble-desktop Bottom Expanded Edge Panel
0x00c00031 -1 rgamble-desktop Top Expanded Edge Panel
0x00e00022 -1 rgamble-desktop Desktop
0x0260007c  0 rgamble-desktop Google - Mozilla Firefox 
```

根据标题调整窗口大小：

```
wmctrl -r Firefox -e 0,0,0,640,480 
```

resize 选项的参数是`gravity,X,Y,width,height`这样的，这会将窗口放在屏幕的左上角并将其大小调整为 640X480。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-12-08T09:57:08.223

使用 wmctrl，还有一些预定义的状态：

如果窗口当前处于 state `maximized`，它不会响应使用`-e`参数 ^ 调整像素大小。这是`-b`参数有用的地方。

> -b 选项需要逗号分隔的参数列表：“(remove|add|toggle),PROP1,PROP2]”

例子：

```
wmctrl -r Firefox -b toggle,maximized_horz 
```

可用状态：

```
wmctrl -r Firefox -b toggle,maximized_vert
                     -----  ---------------
                     remove  modal
                     add     sticky
                     toggle  maximized_vert
                             maximized_horz
                             shaded
                             skip_taskbar
                             skip_pager
                             hidden
                             fullscreen
                             above
                             below 
```

* * *

关于精确的问题， -e 参数允许按如下值调整大小：

重力、X位置、Y位置、窗宽、窗高

```
// gravity,x,y,w,h
wmctrl -r "Resizing" -e 0,0,0,640,480 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-07-24T14:23:04.613

使用 wmctrl 调整窗口大小的 sh 脚本：

```
#!/usr/bin/sh
wmctrl -l
echo ""
read -p "window id -> " wid
read -p "width -> " ww
read -p "height -> " wh
wmctrl -i -r $wid -e  0,0,0,$ww,$wh
echo "Done!" 
```

# c# - 如何确定给定日期是否是该月的第 N 个工作日？

> ID：288513
> 
> 赞同：18
> 
> 时间：2008-11-13T22:05:05.283
> 
> 标签：c#, .net, date, calendar

这是我想做的事情：给定一个日期，一周中的一天和一个整数`n`，确定日期是否是`n`一个月的第几天。

例如：

*   的输入`1/1/2009,Monday,2` 将是错误的，因为`1/1/2009`不是第二个星期一

*   input of `11/13/2008,Thursday,2` 将返回 true，因为它是第二个星期四

我怎样才能改进这个实现？

```
private bool NthDayOfMonth(DateTime date, DayOfWeek dow, int n)
{
    int d = date.Day;
    return date.DayOfWeek == dow && (d/ 7 == n || (d/ 7 == (n - 1) && d % 7 > 0));
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-13T22:12:03.723

您可以更改一周的检查，以便函数显示为：

```
private bool NthDayOfMonth(DateTime date, DayOfWeek dow, int n){
  int d = date.Day;
  return date.DayOfWeek == dow && (d-1)/7 == (n-1);
} 
```

除此之外，它看起来非常好且高效。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-13T22:17:39.640

答案来自[这个网站](http://blog.lab49.com/archives/206)。复制/粘贴在这里，以防该网站丢失。

```
public static DateTime FindTheNthSpecificWeekday(int year, int month,int nth, System.DayOfWeek day_of_the_week)
{
    // validate month value
    if(month < 1 || month > 12)
    {
        throw new ArgumentOutOfRangeException("Invalid month value.");
    }

    // validate the nth value
    if(nth < 0 || nth > 5)
    {
        throw new ArgumentOutOfRangeException("Invalid nth value.");
    }

    // start from the first day of the month
    DateTime dt = new DateTime(year, month, 1);

    // loop until we find our first match day of the week
    while(dt.DayOfWeek != day_of_the_week)
    {
        dt = dt.AddDays(1);
    }

    if(dt.Month != month)
    {
        // we skip to the next month, we throw an exception
        throw new ArgumentOutOfRangeException(string.Format("The given month has less than {0} {1}s", nth, day_of_the_week));
    }

    // Complete the gap to the nth week
    dt = dt.AddDays((nth - 1) * 7);

    return dt;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T22:15:17.010

[这](http://msdn.microsoft.com/en-us/library/aa227532(VS.60).aspx)是 MSDN 不得不说的。它的VB，但它很容易翻译。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T23:44:53.550

看起来语言为给定日期提供日期/日期方法。如果有人感兴趣，您可以阅读[Zeller 的一致性](http://en.wikipedia.org/wiki/Zeller%27s_congruence "日历算法")。

我不认为这是他们想要你做的，但你可以从中找到一个月的第一天的星期几。现在我考虑了一下，您可以找到给定日期的星期几`N`并得到模 7。

哦等等，是一周中的第 N 天（如星期天）还是一个月中的第 N 个**工作日**！好的，我看到了例子。

如果您可以构造一个日期，例如一个月的 1 日，也许会有所不同。

鉴于这是*一周中某一天的第 N 次出现*，并且您不能摆弄任何日期时间数据类型，并且您可以访问获取星期几和获取月份日期功能。星期天会是零吗？

1) 首先，星期几必须与给定的星期几匹配。
2) N 必须至少为 1 且最多为 4。
3) 对于相同的 n，一个月中的日期范围在 n*7*dayOfWeek + 1 和 n*7*dayOfWeek + 6 之间。
- 让我考虑一下。如果星期日是第一个.. 0*7*0+1 = 1，星期六第 6 个将是 0*7*0+6。

认为上面的 1 和 3 就足够了，因为 get day of month 函数不应该违反 2。

```
(* first try, this code sucks *)

function isNthGivenDayInMonth(date : dateTime;
                              dow : dayOfWeek;
                              N : integer) : boolean;
    var B, A : integer (* on or before and after day of month *)
    var Day : integer (* day of month *)
    begin
    B := (N-1)*7 + 1; A := (N-1)*7 + 6;
    D := getDayOfMonth(date);
    if (dow <> getDayOfWeek(date) 
        then return(false)
        else return( (B <= Day) and (A >= Day) );
    end; (* function *) 
```

希望这个大声笑没有错误！
**[编辑：星期六将是第 7 天，上限在上面`(N-1)*7 + 7`。]**
您的解决方案看起来会匹配 2 个不同的星期？看起来周日它总是会返回零？应该在 C# 中完成伪代码.. 短路 && 就像我的 if.. 嘿不应该是周日开始的几个月内 N = 1 的第一场比赛？

```
 d/ 7 == n 
```

那会导致`(either 0 or 1)/7 == 1`，那是不对的！你`||`的`(n-1)`也有，罗伯特也有。跟着罗伯特瓦格纳的回答走！就2行，短就好！拥有`(Day-1) mod 7`
**[edit: `(Day-1) div 7`]** 消除了我不必要的变量和 2 行设置。

作为记录，这应该检查边界情况等等，例如如果 8 月 31 日是星期日或星期六。
**[编辑：也应该检查周末案例。对不起！]**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-23T11:18:08.927

您可以找到一个函数，该函数返回任何一个月中特定工作日第 n 次出现的日期。

见[http://chiragrdarji.wordpress.com/2010/08/23/find-second-saturday-and-fourth-saturday-of-month/](http://chiragrdarji.wordpress.com/2010/08/23/find-second-saturday-and-fourth-saturday-of-month/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T15:33:20.223

在[这个答案](https://stackoverflow.com/questions/288513/how-do-i-determine-if-a-given-date-is-nth-weekday-of-the-month/288542#288542)中，需要翻转以下代码：

```
// Complete the gap to the nth week
dt = dt.AddDays((nth - 1) * 7);

if(dt.Month != month)
{
// we skip to the next month, we throw an exception
throw new ArgumentOutOfRangeException(”The given month has less than ” nth.ToString() ” ”
day_of_the_week.ToString() “s”);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-10-15T21:45:02.623

上面的大多数答案都是部分准确或不必要的复杂。您可以尝试这个更简单的函数，它还会检查给定日期是否是该月的最后一天，但也是第 N 天。

```
 public static bool IsNthDayofMonth(this DateTime date, DayOfWeek weekday, int N)
    {
        if (N > 0)
        {
            var first = new DateTime(date.Year, date.Month, 1);
            return (date.Day - first.Day)/ 7 == N - 1 && date.DayOfWeek == weekday;
        }
        else
        {

            var last = new DateTime(date.Year, date.Month, 1).AddMonths(1).AddDays(-1);
            return (last.Day - date.Day) / 7 == (Math.Abs(N) - 1) && date.DayOfWeek == weekday;
        } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-02-23T17:33:27.813

如果您想要一个月的第 N 天的日期列表（不仅仅是一个），您可以使用这个：

```
internal static List<DateTime> GetDatesForNthDOWOfMonth(int weekNum, DayOfWeek DOW, DateTime beginDate, DateTime endDate)
{
    List<DateTime> datesForNthDOWOfMonth = new List<DateTime>();
    int earliestDayOfMonth = 1;
    int latestDayOfMonth = 7;
    DateTime currentDate = beginDate;

    switch (weekNum)
    {
        case 1:
            earliestDayOfMonth = 1;
            latestDayOfMonth = 7;
            break;
        case 2:
            earliestDayOfMonth = 8;
            latestDayOfMonth = 14;
            break;
        case 3:
            earliestDayOfMonth = 15;
            latestDayOfMonth = 21;
            break;
        case 4:
            earliestDayOfMonth = 22;
            latestDayOfMonth = 28;
            break;
    }

    while (currentDate < endDate)
    {
        DateTime dateToInc = currentDate;
        DateTime endOfMonth = new DateTime(dateToInc.Year, dateToInc.Month, DateTime.DaysInMonth(dateToInc.Year, dateToInc.Month));
        bool dateFound = false;
        while (!dateFound)
        {
            dateFound = dateToInc.DayOfWeek.Equals(DOW);
            if (dateFound)
            {
                if ((dateToInc.Day >= earliestDayOfMonth) && 
                    (dateToInc.Day <= latestDayOfMonth))
                {
                    datesForNthDOWOfMonth.Add(dateToInc);
                }
            }
            if (dateToInc.Date.Equals(endOfMonth.Date)) continue;
            dateToInc = dateToInc.AddDays(1);
        }
        currentDate = new DateTime(currentDate.Year, currentDate.Month, 1);
        currentDate = currentDate.AddMonths(1);
    }
    return datesForNthDOWOfMonth;
} 
```

...并这样称呼它：

```
// This is to get the 1st Monday in each month from today through one year from today
DateTime beg = DateTime.Now;
DateTime end = DateTime.Now.AddYears(1);
List<DateTime> dates = GetDatesForNthDOWOfMonth(1, DayOfWeek.Monday, beg, end);
// To see the list of dateTimes, for verification
foreach (DateTime d in dates)
{
    MessageBox.Show(string.Format("Found {0}", d.ToString()));
} 
```

你可以像这样得到每个月的第二个星期五：

```
List<DateTime> dates = GetDatesForNthDOWOfMonth(2, DayOfWeek.Friday, beg, end); 
```

...ETC。

# c# - C#：如何判断 ListView 中选择了哪个项目索引？

> ID：288540
> 
> 赞同：2
> 
> 时间：2008-11-13T22:16:44.930
> 
> 标签：c#

C#：如何判断 ListView 中选择了哪个项目索引？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T22:22:10.100

```
ListView mylistv = new ListView();
var index = mylistv.SelectedIndices(); 
```

那应该这样做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T22:20:54.610

您是否尝试过 SelectedIndices？

```
myListView.SelectedIndices 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T22:19:35.970

使用类的 SelectedIndex 属性。

# python - 使用 Python 连接到 Exchange 邮箱

> ID：288546
> 
> 赞同：26
> 
> 时间：2008-11-13T22:19:01.137
> 
> 标签：python, email, connection, exchange-server, pywin32

我需要在 Python 脚本中连接到 Exchange 邮箱，而不使用本地计算机上的任何配置文件设置（包括使用 Outlook）。如果我使用 win32com 创建 MAPI.Session，我可以使用现有配置文件登录（使用 Logon() 方法），但我只想提供用户名和密码。

这可能吗？如果是这样，有人可以提供示例代码吗？如果它只使用标准库和 pywin32 包，我会更喜欢。不幸的是，无法为 Exchange 服务器启用 IMAP 访问（然后使用 imaplib）。

万一有必要：所有脚本将做的就是连接到邮箱，并运行收件箱中的邮件，检索内容。如果我能首先获得连接，我可以处理为此编写代码！

澄清有关 Outlook： Outlook 将安装在本地计算机上，但它没有任何帐户设置（即所有适当的库都将可用，但我需要独立于 Outlook 内部的任何设置进行操作）。

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2010-06-18T19:21:29.223

我知道这是一个旧线程，但是...

如果您使用的是 Exchange 2007 或更新版本，或者 Office365，请查看 Exchange Web 服务。它是一个非常全面的基于 SOAP 的 Exchange 界面，您几乎可以做任何 Outlook 能够做的事情，包括对其他用户帐户的委托或模拟访问。

[https://docs.microsoft.com/en-us/exchange/client-developer/web-service-reference/ews-reference-for-exchange](https://docs.microsoft.com/en-us/exchange/client-developer/web-service-reference/ews-reference-for-exchange)

更新：我在 PyPI 上发布了一个[Python EWS 客户端，它支持自动发现、日历、收件箱、任务、联系人等：](https://pypi.python.org/pypi/exchangelib/)

```
from exchangelib import DELEGATE, Account, Credentials

credentials = Credentials(
    username='MYWINDOMAIN\\myusername',  # Or myusername@example.com for O365
    password='topsecret'
)
a = Account(
    primary_smtp_address='john@example.com', 
    credentials=credentials, 
    autodiscover=True, 
    access_type=DELEGATE
)
# Print first 100 inbox messages in reverse order
for item in a.inbox.all().only('subject').order_by('-datetime_received')[:100]:
    print(item.subject) 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2014-06-03T16:48:07.493

我知道了，要连接到出站交换，您需要像这样连接：

```
import smtplib

url = YOUR_EXCHANGE_SERVER
conn = smtplib.SMTP(url,587)
conn.starttls()
user,password = (EXCHANGE_USER,EXCHANGE_PASSWORD)
conn.login(user,password) 
```

现在您可以像正常连接一样发送

```
message = 'From: FROMADDR\nTo: TOADDRLIST\nSubject: Your subject\n\n{}'
from, to = fromaddr,toaddrs
txt = 'This is my message'
conn.sendmail(fromaddr,toaddrs,msg.format(txt)) 
```

从收件箱中获取邮件有点不同

```
import imaplib

url = YOUR_EXCHANGE_URL
conn = imaplib.IMAP4_SSL(url,993)
user,password = (EXCHANGE_USER,EXCHANGE_PASSWORD)
conn.login(user,password)
conn.select('INBOX')
results,data = conn.search(None,'ALL')
msg_ids = data[0]
msg_id_list = msg_ids.split() 
```

这会为您提供可用于获取电子邮件的消息 ID 列表

```
latest_email_id = msg_id_list[-1]
result,data = conn.fetch(latest_email_id,"(RFC822)")
raw_email = data[0][1] 
```

现在 raw_email 是您的电子邮件消息，但它不是很漂亮，如果您想解析它，请执行以下操作

```
from email.parser import Parser

p = Parser()
msg = p.parsestr(raw_email) 
```

现在你可以做

```
msg.get('From')
msg.get('Subject') 
```

或内容

```
msg.get_payload() 
```

但如果它是多部分消息，您需要进行更多处理，幸运的是递归解决方案非常适合这种情况

```
def process_multipart_message(message):
    rtn = ''
    if message.is_multipart():
        for m in message.get_payload():
            rtn += process_multipart_message(m)
    else:
        rtn += message.get_payload()
    return rtn 
```

现在

```
msg_contant = process_multipart_message(msg) 
```

每次都会给你完整的信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T22:28:28.667

我很确定如果不使用 Outlook 和 MAPI 配置文件，这将是不可能的。如果您可以与您的邮件管理员甜言蜜语，让您在 Exchange 服务器上启用 IMAP，那么您的生活会轻松很多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T22:03:54.473

您必须找到一种方法以该特定用户身份运行该过程。

[看到这个。](http://blogs.msdn.com/mstehle/archive/2007/01/03/myth-cdo-1-21-s-session-logon-parameter-profilepassword-actually-does-something.aspx)

我认为[pywin32.CreateProcessAsUser](http://docs.activestate.com/activepython/2.5/pywin32/win32process__CreateProcessAsUser_meth.html)是您需要走的路径的开始。最后一次编辑。登录用户句柄是通过使用[win32security.LogonUser](http://docs.activestate.com/activepython/2.5/pywin32/win32security__LogonUser_meth.html)方法获得的

# delphi - 侧边栏形式

> ID：288550
> 
> 赞同：3
> 
> 时间：2008-11-13T22:19:56.250
> 
> 标签：delphi

delphi 如何创建侧边栏表单。

我尝试了 ScreenSnap 和 Align 属性，但即使用户最大化其他表单，我也需要表单保持可见，而不是在顶部。就像windows侧边栏一样。

**从评论中更新**：如果窗口最大化，它也会在窗口旁边最大化，而不是在前面或后面。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-14T01:34:44.343

您正在寻找的东西称为*AppBar*。[`ShAppBarMessage`](http://msdn.microsoft.com/en-us/library/bb762108.aspx)使用API 函数开始您的研究。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T22:35:48.073

您可以调用 Windows API 函数来强制您的应用程序保持领先：

```
SetWindowPos(Handle, HWND_TOPMOST, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE); 
```

# asp.net - 如何为 IIS6 正确设置应用程序池

> ID：288552
> 
> 赞同：2
> 
> 时间：2008-11-13T22:20:57.230
> 
> 标签：asp.net, application-pool

我真的被这个解析器错误消息所困扰，告诉我“ `Could not load the assembly 'App_Web_amlohswi'. Make sure that it is compiled before accessing the page.`”我已经环顾了几个小时，在这里查看不同的帖子并在谷歌上搜索信息。我发现我需要设置一个新的应用程序池来运行`.NET 2.x`.

（附带说明，我的应用程序正在开发中`.NET 3.5`，有没有办法将其设置为使用`3.5`而不是`2.x`？）

有人可以向我提供有关如何正确设置以及（可选）为什么有必要的很好的解释吗？

我更习惯用PHP开发所以我习惯于编辑src>>上传>>成功！

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T22:27:29.137

只要系统上安装了 .NET 版本，ASP.NET 3.5 站点就会在 2.0 应用程序池中运行。

您可能必须正确设置 web.config。Visual Studio 应该在您创建新项目时为您执行此操作。

您还应该确保不要将 1.1 和 2.0 应用程序组合在同一个应用程序池中。尝试将其放入单独的应用程序池中，看看是否有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T22:31:45.727

由于@Trull 为您提供了“如何”的链接，我将附上原因。

.Net 3.5 只是基于 .Net 2.0 库构建，因此您无需为 3.5 进行设置。.Net 2.0 和 .Net 1.1/1.0 共享一些相同的名称空间和类，因此您需要选择要与应用程序一起使用的库集。由于您的应用程序使用 .Net 2.0 中的库，因此您需要设置应用程序池来为您的应用程序加载这些库，而不是 .Net 1.1 库。您还需要在 Web 服务器上安装 .Net 3.5，即使您仅将应用程序配置为使用（基本）.Net 2.0 库。

这基本上相当于不同版本的 PHP。您会期望使用 PHP 5 编写的应用程序（并利用 PHP 5 中的结构）与 PHP4 解释器一起工作。您需要升级到最新的解释器（或者至少选择较新的解释器，如果两者都安装了），您的应用程序才能运行。.Net 也是如此——您需要选择正确的版本，即您的代码在运行之前希望引用的版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T22:27:41.943

[这](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)是在 IIS 中使用 3.5 的方法。万岁汉斯尔曼！

# php - 如何关闭 mysql 错误在 CodeIgniter 中显示到屏幕

> ID：288559
> 
> 赞同：24
> 
> 时间：2008-11-13T22:23:17.133
> 
> 标签：php, mysql, codeigniter, error-reporting

即使 error_reporting 设置为 0，数据库错误仍会打印到屏幕上。我可以更改某个设置以禁用数据库错误报告吗？这是针对 CodeIgniter v1.6.x

**编辑**：回复：修复错误-嗯，是的。我想修复错误。我从我的错误日志中收到错误通知，而不是从我的访问者看到的打印到他们屏幕上的内容。这对任何人都没有帮助，并且损害了我系统的安全性。

**编辑 2**：将 error_reporting 设置为 0 不会影响 CodeIgniter 的内置错误日志记录类写入错误日志。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-11-13T23:30:48.120

Found the answer:

In `config/database.php:`

```
// ['db_debug'] TRUE/FALSE - Whether database errors should be displayed. 
```

so:

```
$db['default']['db_debug'] = FALSE; 
```

... should disable.

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2013-03-08T11:03:17.290

除了伊恩的回答，暂时禁用错误消息：

```
$db_debug = $this->db->db_debug;
$this->db->db_debug = false;

// Do your sketchy stuff here

$this->db->db_debug = $db_debug; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-13T22:51:58.307

*   您不想将 error_reporting 更改为 0，因为这也会抑制记录错误。

*   相反，您应该将 display_errors 更改为 0

这并不能解释为什么您会显示错误，假设 error_reporting 实际上是 0。也许框架会处理这些错误

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T22:54:39.393

您可以编辑应用程序目录下的 /errors/db_error.php 文件 - 这是包含数据库错误的模板。

但是，您实际上应该只修复错误。

# .net - 在 vb.net 中解包 _WTS_CLIENT_ADDRESS.Address（从终端服务客户端检索 IP 地址）

> ID：288560
> 
> 赞同：1
> 
> 时间：2008-11-13T22:25:15.817
> 
> 标签：.net, vb.net, client, ip-address, terminal-services

我有以下结构：

```
 <StructLayout(LayoutKind.Sequential)> _
    Public Structure _WTS_CLIENT_ADDRESS
        Public AddressFamily As Integer
        <MarshalAs(UnmanagedType.ByValArray, SizeConst:=20)> _
        Public Address() As Byte
    End Structure 
```

由以下调用填充：

```
 Dim _ClientIPAddress As New _WTS_CLIENT_ADDRESS
        Dim rtnPtr As IntPtr
        Dim rtncount As Int32

        NativeMethods.WTSQuerySessionInformation(CInt(NativeMethods.WTS_CURRENT_SERVER_HANDLE), NativeMethods.WTS_CURRENT_SESSION, NativeMethods.WTS_INFO_CLASS.WTSClientAddress, rtnPtr, rtncount)
        '_ClientIPAddress()
        _ClientIPAddress = _
            CType(System.Runtime.InteropServices.Marshal.PtrToStructure(rtnPtr, GetType(_WTS_CLIENT_ADDRESS)), _WTS_CLIENT_ADDRESS) 
```

正在填充地址字节数组，但我不知道如何将其转换为有用的字符串或整数值。MDSN 文档很少：http: [//msdn.microsoft.com/en-us/library/aa383857 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa383857(VS.85).aspx)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T00:03:19.017

你的代码就快到了。我同意你的观点，MSDN 对字节数组里面的内容不是很明确，但你可以这样做：

```
IPAddress address = new IPAddress(_ClientIPAddress.Address.Skip(2).Take(4).ToArray()); 
```

前两个字节似乎没有使用，但在 AF_INET（即 IPv4 或 2）的情况下，接下来的四个字节是客户端的 IPv4 地址。

您可能还想确保您的代码能够正确处理 IPv6 (AF_INET6)，或者处理 AF_INET6 是一个可能值的事实。对于此协议，您可能需要读取 16 个字节而不是 4 个字节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-15T22:33:41.070

真正的答案可以在这里找到。[http://www.tech-archive.net/Archive/Windows/microsoft.public.windows.terminal_services/2007-03/msg00474.html](http://www.tech-archive.net/Archive/Windows/microsoft.public.windows.terminal_services/2007-03/msg00474.html)

# tfsbuild - webtest、Web 应用程序项目和 tfsbuild

> ID：288564
> 
> 赞同：0
> 
> 时间：2008-11-13T22:26:53.227
> 
> 标签：tfsbuild, wap

我有一个 Web 应用程序项目 (wap)，它已由我们的 tfsbuild 服务器成功部署到开发服务器。

我希望构建服务器在部署后运行我们的 webtests 集合。

这样做的最佳做法（或任何做法）是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T22:30:09.413

我使用 NAnt 来执行此操作，尽管使用 Cruise Control 而不是 tfs。tfs 支持 nant 吗？如果是这样，我真的很容易编写目标来构建和测试所有内容，其中失败的测试 => 失败的构建

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T03:56:15.317

我的解决方案涉及在测试前目标期间将网站复制到开发服务器。

完成后，我运行了针对该服务器记录的 webtests。

我想答案是，构建它，部署，记录你的测试，然后将测试添加到构建过程中。

# asp.net - 如果未设置，如何找到服务器的机器密钥

> ID：288572
> 
> 赞同：2
> 
> 时间：2008-11-13T22:29:55.590
> 
> 标签：asp.net, web-config, machinekey

尝试传输服务器，但连接字符串已加密，并且 web.config 中没有设置机器密钥。无论如何要找出旧服务器上的机器密钥是什么，以便我们可以在新服务器上设置它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T00:29:57.877

为什么不直接使用原始服务器上的 -pd 开关进行解密？- 例如：

```
aspnet_regiis.exe -pdf "connectionStrings" "C:\Inetpub\wwwroot\MySite" 
```

# ruby - Ruby 中的 $1 和 \1

> ID：288573
> 
> 赞同：51
> 
> 时间：2008-11-13T22:30:03.517
> 
> 标签：ruby, regex

在 Ruby 中使用正则表达式时，$1 和 \1 有什么区别？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-11-13T22:37:04.843

\1 是一个反向引用，它只能在相同的`sub`或`gsub`方法调用中工作，例如：

```
"foobar".sub(/foo(.*)/, '\1\1') # => "barbar" 
```

$1 是一个全局变量，可以在后面的代码中使用：

```
if "foobar" =~ /foo(.*)/ then 
  puts "The matching word was #{$1}"
end 
```

输出：

```
"The matching word was bar"
# => nil 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-11-13T23:01:17.243

请记住，还有第三种选择，即`sub`. 有时你需要它。假设您想用该文本的反面替换某些文本。您不能使用 $1 ，因为它的绑定速度不够快：

```
"foobar".sub(/(.*)/, $1.reverse)  # WRONG: either uses a PREVIOUS value of $1, 
                                  # or gives an error if $1 is unbound 
```

您也不能使用`\1`，因为该`sub`方法只是`\1`用适当的捕获文本进行简单的文本替换，这里没有魔法发生：

```
"foobar".sub(/(.*)/, '\1'.reverse) # WRONG: returns '1\' 
```

所以如果你想做任何花哨的事情，你应该使用块形式`sub`（$1、$2、$`、$'等将可用）：

```
"foobar".sub(/.*/){|m| m.reverse} # => returns 'raboof'
"foobar".sub(/(...)(...)/){$1.reverse + $2.reverse} # => returns 'oofrab' 
```

# database - 是否有充分的理由将小于 1 的百分比存储为大于 1 的数字？

> ID：288575
> 
> 赞同：2
> 
> 时间：2008-11-13T22:30:19.490
> 
> 标签：database, numbers

我继承了一个使用 SQL Server 200x 的项目，其中存储在问题域中始终被视为百分比的值的列存储为其大于 1 的十进制等效值。例如，*70%*（0.7，字面意思）存储为*70*，*100%*存储为*100*等。除了需要记住 * 0.01 检索值和 * 100 持久值之前，这似乎不是问题在其本身。~~虽然它确实让我的头爆炸~~......所以我错过了它有充分的理由吗？考虑到已经编写了大量代码来处理伪百分比，是否有令人信服的理由来修复它？

在少数情况下会发生大于 100% 的情况，但我不明白为什么在这些情况下该值不会仅存储为 1.05。

编辑：头部感觉更好，并且稍微聪明一些。感谢所有的见解。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T22:32:15.273

如果它是一个字节字段，那么它在数据库中占用的空间比浮点数要少，但除非你有数百万条记录，否则你几乎看不出有什么区别。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T23:22:32.600

实际上有四个很好的理由我能想到你可能想要存储和计算整数百分比值而不是浮点等价物：

1.  根据选择的数据类型，整数值可能占用更少的空间。
2.  根据数据类型，浮点值可能会丢失精度（请记住，并非所有语言都具有与 SQL Server 类型等效的数据`decimal`类型）。
3.  如果该值将非常频繁地从用户输入或输出给用户，则将其保持为更用户友好的格式可能更方便（在显示时转换和计算时转换之间的决定......但请参阅下一点）。
4.  如果主值也是整数，那么

    ```
    principle * integerPercentage / 100 
    ```

    它使用所有整数算术通常比它的等效浮点更快（在浮点类型等效于 T-SQL 类型的情况下可能*快得多*）`decimal`。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T22:52:07.917

由于无法比较浮点值是否相等，因此可能已使用整数来使 SQL 更简单。

例如

```
(0.3==3*.1) 
```

通常是假的。

然而

```
abs( 0.3 - 3*.1 ) 
```

是一个很小的数字（5.55e-17）。`(column-SomeValue) BETWEEN -0.0001 AND 0.0001`但是必须用or做所有事情是很痛苦的`ABS(column-SomeValue) < 0.0001`。你宁愿`column = SomeValue`在你的 WHERE 子句中做。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T22:36:46.327

浮点数容易出现舍入错误，因此在比较中可能表现得“有趣”。如果您总是想将其作为固定十进制处理，您可以选择十进制类型，例如十进制（5,2），或者执行转换并存储为您的数据库所做的 int 操作。我可能会走小数路线，即使 int 会占用更少的空间。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-13T22:34:17.343

一个很好的猜测是因为你对整数所做的任何事情（存储、计算、填充到用户的编辑中等）都比对浮点数做同样的事情更容易和更有效。当您查看数据时，舍入问题并不那么明显。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T22:54:34.667

如果这些是最终用户可能会看到并与之交互的数字，那么百分比比小数更容易理解。

这是符号辅助可以提供帮助的情况之一；在程序中，在使用前缀（匈牙利语）或后缀来指定百分比值与十进制值时保持一致。如果您可以将命名约定扩展到数据库字段本身，那就更好了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T23:05:47.467

并且添加到数据存储问题，如果您可以使用整数算术进行任何处理，则性能比进行浮点算术时要好得多......因此将百分比存储为整数值可能允许处理逻辑整数算术

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T23:06:43.380

如果您实际上将它们用作系数（或期望数据库的用户在报告中执行此类操作），则可以将它们存储为系数 - 特别是如果有理由进行涉及多个计算的计算。

但是，如果您这样做，您应该保持一致 - 所有百分比或所有系数。

# ftp - 如何在不尝试加载的情况下验证 Sybase 转储文件的完整性？

> ID：288582
> 
> 赞同：2
> 
> 时间：2008-11-13T22:33:37.783
> 
> 标签：ftp, sybase, integrity, wan

这是场景 - 客户端将 Sybase 转储文件上传到（gzip 压缩）到我们的本地 FTP 服务器。我们有一个自动化流程，它会挑选这些数据，然后将它们移动到数据库服务器所在的网络中的不同服务器。不幸的是，这种传输是通过 WAN 进行的，对于大文件需要很长时间，有时我们的客户忘记以二进制模式进行 FTP，这导致通过我们的 WAN 进行 10GB 的传输，因为无法加载转储文件。在另一端。我想做的是在通过 WAN 发送之前验证本地服务器上的转储文件的完整性，但我不能只是尝试“加载”转储文件，因为我们没有 Sybase已安装（并且无法安装）。我可以使用任何工具或代码来执行此操作吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T05:04:31.767

您可以从命令行执行一些操作。首先，在发送端，生成文件的 md5sum。

```
$ md5sum *.dmp
2bddf3cd8b04010183dd3295ce7594ff  pubs_1.dmp
7510e0250c8d68bae3e0e794c211e60b  pubs_2.dmp
091fe54fa5fd81d8c109cc7835d37f4a  pubs_3.dmp 
```

在客户端，它们可以运行相同。其次，通常 Sybase 转储是使用 compress 选项完成的。如果使用此选项，您还可以通过命令行解压缩文件来测试文件完整性。这并不完整，但它将验证 8 字节 CRC-32 校验和，这是压缩算法的一部分。

```
$ gunzip --test *.dmp
gunzip: pubs_3.dmp: unexpected end of file 
```

这两种方法都不能验证 Sybase 是否能够加载文件，但它确实有助于确保文件没有损坏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T19:30:14.130

如果不通过备份服务器以某种方式加载转储文件，就无法真正验证转储文件的完整性。客户端应该通过备份日志或转储过程中的输出知道转储是否成功。

但是要解决您的问题，您应该使用 SFTP 或 SCP，所有传输都以二进制形式完成，从而缓解您的问题。

确保他们也在转储中使用压缩，值 1-3 绰绰有余，这也应该减少您的网络流量。

# php - 为 Google 带注释的时间线动态生成的数据表

> ID：288584
> 
> 赞同：1
> 
> 时间：2008-11-13T22:34:10.917
> 
> 标签：php, asp.net, sql, datatable, google-visualization

我想使用[Google 的 Annotated Time Line Visualization](http://code.google.com/apis/visualization/documentation/gallery/annotatedtimeline.html)。通过手动添加列和行数据的行来完成这项工作非常容易。这一切都是通过 google.visualization.DataTable() 的属性完成的。我想动态更新这个数据表，但我不知道怎么做。数据位于运行 MS SQL Server 2005 的服务器上。

我找到了一篇使用 PHP 和 MySQL 完成此任务的[帖子](http://groups.google.com/group/google-visualization-api/browse_thread/thread/4dc84221fbd3ade5/d57109c9b45fd741?lnk=raot&pli=1)，但我不知道如何将其转换为 VB .NET 或 C#（两者都可以）。

有谁知道如何使用 .NET 中的 MS SQL Server 数据或更好的方法来动态生成代码，这样新数据就不必每天手动添加行？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-17T11:33:54.483

我知道这是一篇旧帖子，但请查看[http://www.panterlo.com/2010/10/17/google-visualization-api-gets-easy-with-net-mvc/](http://www.panterlo.com/2010/10/17/google-visualization-api-gets-easy-with-net-mvc/)指出我发布了在 github (GPL v3) 上提供一个类库，您可以将其用于此目的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T18:16:38.693

您可以使用您提到的帖子来帮助您在 PHP 中编写此代码，但使用 PHP 的 ODBC 函数 ( [http://us3.php.net/odbc](http://us3.php.net/odbc) ) 来访问 MSSQL Server 中的数据，而不是访问 MySQL 数据库中显示的示例.

```
$connectionstring = odbc_connect($db, $user, $pass) or die("Connection Failed");
$query = "...";
$result = odbc_do($connectionstring, $query) or die("Query Failed"); 
```

抱歉，这对 .NET 或 C# 没有帮助。

# continuous-integration - 如何在我的 ccnet 配置文件中指定如何进行每日构建？

> ID：288600
> 
> 赞同：5
> 
> 时间：2008-11-13T22:37:42.423
> 
> 标签：continuous-integration, cruisecontrol.net

如何在我的 ccnet 配置文件中指定如何进行每日构建？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T22:44:14.797

您设置了一个 scheduleTrigger：

```
<triggers>
    <scheduleTrigger time="23:30" />
</triggers> 
```

每天晚上 11:30 运行该项目

# php - Mysql抛出查询错误但完成查询就好了-为什么？

> ID：288603
> 
> 赞同：0
> 
> 时间：2008-11-13T22:39:05.243
> 
> 标签：php, mysql

我正进入（状态

```
Warning: mysql_fetch_assoc(): supplied argument is not a valid MySQL result 
resource in *filename* on line 81 
```

在运行查询以构建图表时。该查询从 mysql db 获取数据并使用它来构建图表。

通常，我收到此错误并转到代码并找到我搞砸的地方，修复它，然后继续。这个问题的棘手部分是查询实际上正在运行，并且图表正在构建和准确显示。为什么我的服务器（xampp 上的 localhost）告诉我查询结果不好，但它可以很好地利用资源？

这是完整的查询：

```
$chart=array();
    $roll=array();
    //select used terms
    $rosh=mysql_query("select distinct term from search_terms");

    while($roshrow=mysql_fetch_assoc($rosh)){
        extract($roshrow);
            $roll[]=$term;
        }

        //select term_number for each term
        foreach($roll as $sterm){
            $termarray=array();
                  **//following is line 81**
            $bashq="select term_number from search_terms where term ='$sterm'";
            $bash=mysql_query($bashq);
            while($brow=mysql_fetch_assoc($bash)){
                extract($brow);
                //put results into array to sum
                $termarray[]=$term_number;
            }
            $termsum=array_sum($termarray);

        //put term=>number array for chart script
            $chart[$sterm]=$termsum;

        }
        //sort array so high numbers at beginning
        arsort($chart);

        //slice top 10 terms
        $chart=array_slice($chart,0,10); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T22:42:23.817

做这个：

```
$rosh=mysql_query("select distinct term from search_terms")
  or die("Error with query: " . mysql_error()); 
```

还有这个：

```
$bash=mysql_query($bashq)
  or die("Error with query: " . mysql_error(); 
```

当它失败时，它会告诉你。不过，您是对的，您收到该消息是因为 mysql_query 返回“false”并且不是有效的结果资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T22:55:51.153

因为您在循环中进行查询，所以未处理其中一个术语（可能是因为 search_terms 缺少该特定转弯的行。这很奇怪，因为您正在查询同一个表。

但是，由于它是一个警告，而不是一个致命错误，它仍然会继续。

无论哪种方式，提取数据的方式似乎都是错误的，您可以直接在 SQL 服务器中使用一个查询、适当的排序 (ORDER BY)、GROUP BY 和 SUM() 来获取您的条款的总和。

您应该改为阅读您的 SQL :)

```
选择术语，SUM(term_number) 作为 term_sum
FROM search_terms
GROUP BY 条款
ORDER BY term_sum DESC
限制 10

```

然后只需将其复制到您的哈希表中，它应该已经排序，并且限制为 10 个条目。

# asp.net-mvc - ASP.Net MVC 输出缓存：指令或配置设置配置文件必须指定“varyByParam”属性

> ID：288608
> 
> 赞同：14
> 
> 时间：2008-11-13T22:41:28.157
> 
> 标签：asp.net-mvc, outputcache

在没有输入参数的 ActionResult 方法上应用 OutputCache 属性后，我遇到了上述错误消息 - 为什么在这种情况下使用 VaryByParams？这是 ASP.Net MVC 中的错误，还是有办法在不设置此属性的情况下使用 OutputCache？

我的大问题是，如果我必须使用 VaryByParams，如果我没有要缓存的参数，我应该输入什么值？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-18T00:31:29.073

我从来没有找到一个令人满意的答案 - 基本上，您只需要添加 VaryByParams 属性，如果您没有任何参数，请将其设置为魔术字符串“none”。

[http://msdn.microsoft.com/en-us/library/system.web.ui.outputcacheparameters.varybyparam.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.outputcacheparameters.varybyparam.aspx)

# linux - 设置快速启动 Linux 的最佳/简单方法

> ID：288609
> 
> 赞同：5
> 
> 时间：2008-11-13T22:41:44.367
> 
> 标签：linux, boot, distro

希望这仍然属于 StackOverflow 的保护范围！

我正在为我的妻子创建一个快速启动的 linux 笔记本电脑。它真正需要的只是能够浏览互联网（使用 Flash 和视频等）。

是否有为此而制作的发行版，或者那里有任何指南可以显示加快速度的好方法？我读过我应该“从内核中删除我不使用的东西”，但这有点超出我的技能范围。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T22:55:13.417

如果您使用的是 Ubuntu（或变体，如 xubuntu 或 kubuntu），则有一个名为 BootUp-Manager 的包。Lifehacker上有[一篇关于它的文章。](http://lifehacker.com/software/linux-tip/speed-up-ubuntu-boot-and-shutdown-process-267588.php)它使您可以检查和取消检查启动和关闭脚本中的内容以优化事物（例如关闭检查新硬件等）

[您还可以通过进入 System->Administration->Services](http://www.linuxine.com/2008/06/speed-up-ubuntu-boot-speed.html)并禁用任何您不需要的服务来获得简单的加速。

如果您想查看每个部分花费了多少时间，请安装包 Bootchart，它应该为您提供启动期间发生的所有事情的详细配置文件，并让您专注于最耗时的部分，并在调整系统时衡量您的进度。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T22:52:02.363

我相信[Xubuntu](http://www.xubuntu.org/)是专为低内存占用/快速启动等而设计的，同时仍然具有相当数量的功能。不是 Linux 用户，但它似乎在我脑海中浮现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T22:53:34.293

有些人可以在 5 秒内启动 EEE PC 上网本，并运行修改版的 Fedora。可能是一个很好的起点： http: [//lwn.net/Articles/299483/](http://lwn.net/Articles/299483/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T22:52:55.793

试试看：[Damn Small Linux](http://www.damnsmalllinux.org/)是一个非常通用的 50MB 面向迷你桌面的 Linux 发行版。

[或者，购买带有expressgate](http://www.amdzone.com/index.php/reviews/66/10072-expressgate-pre-boot-os)的华硕主板- 它有一个板载 Linux (spashtop)，可在 3 秒内启动。它专为快速网上冲浪、即时通讯、音乐等而设计，同时仍可让您启动主操作系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T22:56:00.343

如果您真的希望它快速启动，我建议您创建一个 initrd，其中包含执行您想要它执行的操作所需的软件。initrd 将作为一个大文件从磁盘读取一次，然后一切都将耗尽内存。

这不是一个简单的解决方案，最简单的解决方案是 jishi 使用 Live CD 的解决方案，但是，这不会是最快的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-08-05T19:38:36.570

我一直在双启动的戴尔笔记本电脑上使用 Kubuntu 14.04.4/5。目前对它并不满意。您对 liveCD 的缓慢性都是正确的。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-13T22:46:59.597

有带有浏览器和安装 flash、java 的工作 linux-distros 的 LiveCD 版本。

查看 LiveCD

[http://en.wikipedia.org/wiki/Live_CD](http://en.wikipedia.org/wiki/Live_CD)

你会发现不同风格的下载链接。

还有 USB 驱动器版本。

# c# - 如何增加 ASP.NET 中的最大上传文件大小？

> ID：288612
> 
> 赞同：260
> 
> 时间：2008-11-13T22:44:03.503
> 
> 标签：c#, .net, asp.net, file-upload

我有一个表单，除了 ASP.NET 中的文件上传。我需要将最大上传大小增加到默认的 4 MB 以上。

我发现在某些地方引用了[msdn](http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.maxrequestlength.aspx)上的以下代码。

```
[ConfigurationPropertyAttribute("maxRequestLength", DefaultValue = )] 
```

没有任何参考资料真正描述了如何使用它，我已经尝试了几件事但没有成功。我只想为某些要求上传文件的页面修改此属性。

这是正确的路线吗？我该如何使用它？

* * *

## 回答 #1

> 赞同：437
> 
> 时间：2008-11-13T22:56:56.283

此设置位于您的 web.config 文件中。但是，它会影响整个应用程序……我认为您不能在每页上设置它。

```
<configuration>
  <system.web>
    <httpRuntime maxRequestLength="xxx" />
  </system.web>
</configuration> 
```

“xxx”以 KB 为单位。默认值为 4096 (= 4 MB)。

* * *

## 回答 #2

> 赞同：199
> 
> 时间：2013-08-30T10:46:43.870

对于 IIS 7+，以及添加 httpRuntime maxRequestLength 设置，您还需要添加：

```
 <system.webServer>
    <security>
      <requestFiltering>
        <requestLimits maxAllowedContentLength="52428800" /> <!--50MB-->
      </requestFiltering>
    </security>
  </system.webServer> 
```

或在 IIS (7) 中：

> *   选择要启用以接受大文件上传的网站。
> *   在主窗口中双击“请求过滤”
> *   选择“编辑功能设置”
> *   修改“最大允许内容长度（字节）”

* * *

## 回答 #3

> 赞同：85
> 
> 时间：2016-05-27T05:47:01.547

为了增加上传文件的大小限制，我们有两种方法

**1\. IIS6或更低**

> 默认情况下，在 ASP.Net 中，要上传到服务器的文件的最大大小约为**4MB**。可以通过修改 *web.config中的***maxRequestLength**属性来增加此值。
> 
>  ***请记住：maxRequestLenght 以 KB 为单位***

 ***示例**：如果要将上传限制为 15MB，请将 maxRequestLength 设置为“15360”（15 x 1024）。

```
<system.web>
   <!-- maxRequestLength for asp.net, in KB --> 
   <httpRuntime maxRequestLength="15360" ></httpRuntime> 
</system.web> 
```

**2\. IIS7或更高版本**

> 此处用于上传文件的方式略有不同。IIS7 引入了**请求过滤模块**。在 ASP.Net 之前执行。意味着管道的工作方式是首先检查 IIS 值（**maxAllowedContentLength**），然后检查 ASP.NET 值（**maxRequestLength**）。 maxAllowedContentLength 属性默认为**28.61 MB**。可以通过修改同一*web.config*中的两个属性来增加此值。
> 
> **请记住：maxAllowedContentLength 以字节为单位**

**示例**：如果要将上传限制为 15MB，请将 maxRequestLength 设置为“15360”，将 maxAllowedContentLength 设置为“15728640”（15 x 1024 x 1024）。

```
<system.web>
   <!-- maxRequestLength for asp.net, in KB --> 
   <httpRuntime maxRequestLength="15360" ></httpRuntime> 
</system.web>

<system.webServer>              
   <security> 
      <requestFiltering> 
         <!-- maxAllowedContentLength, for IIS, in bytes --> 
         <requestLimits maxAllowedContentLength="15728640" ></requestLimits>
      </requestFiltering> 
   </security>
</system.webServer> 
```

**MSDN 参考链接**：[https ://msdn.microsoft.com/en-us/library/e1f13641(VS.80).aspx](https://msdn.microsoft.com/en-us/library/e1f13641(VS.80).aspx)

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-11-13T22:56:07.520

我相信这行将`Web.config`设置最大上传大小：

```
<system.web>

        <httpRuntime maxRequestLength="600000"/>
</system.web> 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2015-09-11T09:14:39.813

对于 2 GB 的最大限制，在您的应用程序 web.config 上：

```
<system.web>
  <compilation debug="true" targetFramework="4.5" />
  <httpRuntime targetFramework="4.5" maxRequestLength="2147483647" executionTimeout="1600" requestLengthDiskThreshold="2147483647" />
</system.web>

<system.webServer>
  <security>
    <requestFiltering>
      <requestLimits maxAllowedContentLength="2147483647" />
    </requestFiltering>
  </security>
</system.webServer> 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-13T22:52:17.247

如果它的 windows 2003 / IIS 6.0 然后检查位于文件夹 C:\windows\system32\inetsrv\的文件**metabase.xml中的 AspMaxRequestEntityAllowed = "204800"**

在我看来，“204800”（~205Kb）的默认值对于大多数用户来说太低了。只需将值更改为您认为应该最大的值。

如果在编辑后无法保存文件，则必须停止 ISS 服务器或启用服务器以允许编辑文件：

[![替代文字](https://i.stack.imgur.com/V8Udl.png)](https://i.stack.imgur.com/V8Udl.png)
[（来源：[itmaskinen.se](http://blogs.itmaskinen.se/image.axd?picture=WindowsLiveWriter/Request.BinaryReadFailedwindows2003IIS.0_BC5A/image_2.png)）]

编辑：我没有正确阅读问题（如何在 webconfig 中设置 maxrequest）。但是这个信息可能对其他人感兴趣，许多将他们的网站从win2000服务器移动到win2003并且有一个工作上传功能并且突然得到**Request.BinaryRead Failed**错误的人都会使用它。所以我把答案留在这里。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-03-28T10:47:52.577

我在 win 2008 IIS 服务器中遇到了同样的问题，我已经解决了在 web.config 中添加此配置的问题：

```
<system.web>
    <httpRuntime executionTimeout="3600" maxRequestLength="102400" 
     appRequestQueueLimit="100" requestValidationMode="2.0"
     requestLengthDiskThreshold="10024000"/>
</system.web> 
```

requestLengthDiskThreshold默认为 80000 字节，因此对于我的应用程序来说太小了**。**requestLengthDiskThreshold 以字节为单位，maxRequestLength 以千字节为单位。

如果应用程序正在使用`System.Web.UI.HtmlControls.HtmlInputFile`服务器组件，则会出现问题。需要增加 requestLengthDiskThreshold 来解决它。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-07-20T12:19:08.237

我知道这是一个老问题。

所以这就是你必须做的：

在您的 web.config 文件中，将其添加到`<system.web>`：

```
<!-- 3GB Files / in kilobyte (3072*1024) -->
<httpRuntime targetFramework="4.5" maxRequestLength="3145728"/> 
```

这在`<system.webServer>`：

```
<security>
    <requestFiltering>

      <!-- 3GB Files / in byte (3072*1024*1024) -->
      <requestLimits maxAllowedContentLength="3221225472" />

    </requestFiltering>
</security> 
```

您在评论中看到这是如何工作的。在一个中，您需要以字节为单位，在另一个中以千字节为单位。希望有帮助。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-10-05T18:03:45.333

最大文件大小可以限制为单个 MVC 控制器甚至是一个动作。
web.config <location> 标签可用于：

```
<location path="YourAreaName/YourControllerName>/YourActionName>">
  <system.web>
    <!-- 15MB maxRequestLength for asp.net, in KB 15360 -->
    <httpRuntime maxRequestLength="15360" />
  </system.web>
  <system.webServer>
    <security>
      <requestFiltering>
        <!-- 15MB maxAllowedContentLength, for IIS, in bytes 15728640 -->
        <requestLimits maxAllowedContentLength="15728640" />
      </requestFiltering>
    </security>
  </system.webServer>
</location> 
```

或者您可以在区域自己的 web.config 中添加这些条目。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2017-09-27T14:37:54.800

如果您使用的是框架 4.6

```
<httpRuntime targetFramework="4.6.1" requestValidationMode="2.0" maxRequestLength="10485760"  /> 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-05-28T11:19:19.710

您可以在应用程序 web.config 文件中编写该代码块。

```
<httpRuntime maxRequestLength="2048576000" />
<sessionState timeout="3600"  /> 
```

通过编写该代码，您可以上传比现在更大的文件

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-01-17T10:42:49.390

如果您使用 sharepoint，您也应该使用管理工具配置最大大小： [kb925083](http://support.microsoft.com/kb/925083)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-04-03T01:31:39.583

我有一篇关于如何[增加 asp 上传控制的文件大小](http://www.aspnetify.com/2010/11/aspnet-fileupload-control-use-and.html)的博文。

从帖子：

> 默认情况下，FileUpload 控件允许上传最大 4MB 的文件，执行超时为 110 秒。可以从 web.config 文件的 httpRuntime 部分更改这些属性。maxRequestLength 属性确定可以上传的最大文件大小。executionTimeout 属性确定执行的最长时间。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-03-19T10:20:40.147

如果它在您的本地机器上工作并且在 IIS 中部署后不起作用（我使用 Windows Server 2008 R2），我有一个解决方案。

打开 IIS (inetmgr) 转到您的网站 在右侧转到内容（请求过滤） 转到编辑功能设置 将最大内容大小更改为（您需要的字节数）这将起作用。您还可以从以下线程 [http://www.iis.net/configreference/system.webserver/security/requestfiltering/requestlimits获得帮助](http://www.iis.net/configreference/system.webserver/security/requestfiltering/requestlimits)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-05-08T06:45:25.280

如果您使用 ssl 证书，您的 ssl 管道 F5 设置配置。重要。

# php - 如何使用 OOP 动态构建 PHP 表单？

> ID：288614
> 
> 赞同：5
> 
> 时间：2008-11-13T22:44:19.040
> 
> 标签：php, oop, class, forms

我将如何创建一个真实世界的表单创建类，我可以使用它来显示具有不同类型字段的新表单，我想要多少个字段，我可以使用下拉菜单，我可以通过使用 OOP 来完成所有这些工作？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T23:49:41.030

老实说，考虑到有一些成熟的 PHP 表单包，我不会自己动手。

我将 PEAR 的 HTML_QuickForm 包 ( [http://pear.php.net/manual/en/package.html.html-quickform.php](http://pear.php.net/manual/en/package.html.html-quickform.php) ) 用于 PHP4 站点。

对于 PHP5，我会查看 Zend_Form ( [http://framework.zend.com/manual/en/zend.form.html](http://framework.zend.com/manual/en/zend.form.html) )。

对于我的快速表单代码，我使用了一个帮助类，它允许我使用配置数组定义表单。例如：

```
echo QuickFormHelper::renderFromConfig(array(
  'name' => 'area_edit',
  'elements' => array(
    'area_id'           => array('type' => 'hidden'),
    'active'            => array('type' => 'toggle'),
    'site_name'         => array('type' => 'text'),
    'base_url'          => array('type' => 'text'),
    'email'             => array('type' => 'text'),
    'email_admin'       => array('type' => 'text'),
    'email_financial'   => array('type' => 'text'),
    'cron_enabled'      => array('type' => 'toggle'),
    'address'           => array('type' => 'address'),
  ),
  'groups' => array(
    'Basic Details'   => array('site_name', 'base_url'),
    'Address Details' => array('address'),
    'Misc Details'    => array(), // SM: Display the rest with this heading.
  ),
  'defaults' => $site,
  'callback_on_success' => array(
    'object' => $module,
    'function' => 'saveSite',
   ),
)); 
```

请注意，上述元素类型“地址”和“切换”实际上是多个表单字段（基本上是元类型）。这就是我喜欢这个助手类的地方——我可以用它们的规则（例如地址、信用卡等）定义一组标准的字段，并且它们可以以一致的方式在许多页面上使用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T23:09:42.703

你绝对可以。考虑一个 Form 类，它存储有关表单本身的信息：`method`, `action`,`enctype`属性。还可以在顶部添加可选标题和/或描述文本等内容。当然，您还需要一个输入元素数组。这些可能会被放入它们自己的类中（尽管为 InputText、InputCheckbox、InputRadio 子类化它们可能有点过分）。这是一个模糊的骨架设计：

```
class Form {
    var $attributes,    // array, with keys ['method' => 'post', 'action' => 'mypage.php'...]
        $heading,
        $description,
        $inputs        // array of FormInput elements
    ;

    function render() {
        $output = "<form " . /* insert attributes here */ ">"
              . "<h1>" . $this->heading . "</h1>"
              . "<p>" . $this->description . "</p>"
        ;
        // wrap your inputs in whatever output style you prefer:
        // ordered list, table, etc.
        foreach ($this->inputs as $input) {
            $output .= $input->render();
        }
        $output .= "</form>";
        return $output;
    }
} 
```

FormInput 类只需要存储基本信息，例如类型、名称、值、标签。如果您想变得棘手，那么您可以应用验证规则，然后在渲染时将其转换为 Javascript。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-10-22T09:26:28.033

我将在这里反对其他建议，并建议您构建自己的库来生成表单。如果你失败了，你仍然会在这个过程中学到很多东西。

设计过程在这里是最重要的。您从顶部开始，并问自己表格上的内容。在抽象层面上，一个表格充满了元素。有些是可见的，有些是不可见的，有些可以由用户输入，但有些不能，有些元素可以触发其他元素......并且列表还在继续......

最终你会得到“装饰性”元素（文本、标题、分隔符、字段集、链接、图像）、交互元素（输入、下拉菜单、复选框、单选按钮、提交按钮），最后是既不装饰也不装饰的元素交互式（隐藏输入、锚点和充当容器以对其他元素进行分组的元素。）

一旦组织好不同的类别，您就可以开始研究所有元素都具有的特性，并且可以将其放入基本元素类中。然后你沿着链条上去，让你的类做更多的事情，从其他更简单的元素类继承。在我的库中，基本元素类称为 form_element ，每个 form_element 都有一个唯一的名称，同一表单中的其他元素都不能拥有。form_element 也有一组属性。它有一个所有元素都调用的函数render()。在基类中 render() 什么都不做（所以基元素总是不可见的），但在派生类中它开始生成 HTML。顺便说一句，我从来没有让我的任何课程创建 HTML。相反，我有一个名为 html 的静态类，它为所有需要其服务的类编写 HTML。

在表单元素链的早期，你应该有一个，一个将其他元素分组的容器。它应该有一个 add() 函数，它的 render() 函数应该包括调用它所有子元素的 render() 函数。表单类将从这个容器类派生。

花大量时间在设计上。注意与库的其余部分的兼容性。

如果您希望表单中的数据来自数据库并保存到一个数据库中，则需要添加此功能并将表单元素类链接到表和列。在这里，我也有一个单独的数据库类，可以检索/保存数据。我有一个创建查询的查询类。表单元素应该与创建 HTML、创建查询或访问数据库无关。我的静态类 DB 和我的查询类负责处理繁琐的工作。表单类应该只涉及表单内容。表单类将需要保存的字段的所有表和列收集到一个数组中，并将其传递给创建查询的查询类，然后将查询传递给执行它的 DB 类。

一旦你正确设置，看起来非常复杂的事情突然变得非常简单，使用正确设计的类。

因为您有一个可以编写 HTML 的类，所以您的表单类只需要 html::init() 并在其后使用 render() 并且表单的整个 HTML 代码都在 html 缓冲区中可用。html::output() 刷新所有内容。

验证也使用静态验证类在外部处理。可以验证的表单元素以可以直接传递给验证类的格式在数组中保存验证指令。每个需要验证的元素都绑定到一个错误元素，如果元素未验证，则显示错误，或者如果一切顺利，则保持不可见。

这是为了向您展示，当您设计表单环境（或其他任何东西）时，您确实需要在开始之前绝对考虑所有事情。您投入其中的工作可能不会立即转化为可以为您的应用程序提供动力的代码，但它肯定会让您成为更好的开发人员，从而使您未来的项目更容易处理。

form 类创建表单，html 类创建 HTML，query 类进行查询，DB 类处理数据库。如果你的类开始做应该由单独的类完成的工作，那么你就有了设计问题。

这是一个代码示例，展示了我的表单库是如何工作的：

```
$fm = new form('myform');
$fm->binding(FORM_DATABASE);
$fm->state(FORM_RETRIEVE); 
$fm->set_recno(1);
$fm->add(new form_heading("My form"));
$fm->add($el=new form_input("name",40));
$el->bind_data('mytable','mycolumn');
$el->set_attribute('size', 25);
$el->set_default('Name');
$fm->add($el=new form_submit("submit_btn","Submit"));
if($fm->manage())
 {
 redirect or do something else here. The interaction with the form is done. The initial state for the form was FORM_RETRIEVE. If it had been FORM_NEW it would have displayed default values instead of the retrieved record and saved the form as a new record in the table. 
 } 
```

请注意，表单的 manage() 函数会处理所有事情，从数据库中检索数据，将表单呈现到视图中，验证数据并将其保存回数据库。

以编程方式创建表单（如上所述）的优点之一是可以选择编写自己的基于表单的代码生成器来创建代码来制作表单。

我希望这可以帮助你或其他人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-04T17:26:42.430

仅供参考， Khurram Khan 的[Object Oriented Forms](http://php.xivix.net/php_7_24_Object_Oriented_Forms_Introduction)是一个优秀的 PHP OO 表单实现。

以下是代码的示例：

```
$form = new Form("Register", "form.php"); 

$personal = new Block("Personal Information"); 

$name = new Text("name", "Your name"); 
$name->setDescription("this is my description"); 
$name->addValidator(new MaxLengthValidator("The name you have entered is too long", 30)); 

... 
```

另一个更流行的实现是[PHPlib](http://www.sanisoft.com/phplib/manual/oohforms.php)。但是，我觉得这有点笨拙。似乎它只是包装在一个类中的一些标准函数式编程。

另一种选择是为内置的[DOM](http://www.php.net/manual/en/book.dom.php)库编写抽象。这将允许您使用 OO 表示法手动创建任何类型的表单和表单元素，另外还有一个好处是您将返回一个 OO DOM 实例，该实例可以在程序的其他地方使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-02-21T19:27:05.833

您绝对应该使用 OO PHP 来制作表单，以及您的所有其他 HTML 输出。我找不到任何 PHP 库（这些答案中的许多链接都死了）来做我想做的事，所以我写了[PHPFUI](https://packagist.org/packages/phpfui/phpfui)。它不是一个通用的 HMTL 输出库，而是为[Foundation CSS Framework](https://get.foundation/sites/docs/)输出页面。您可以轻松地使用相同的技术来输出更普通的页面、Bootstrap 或其他任何内容。我不想编写一个通用的 HTML OO PHP 库，因为出于性能原因，我想要一些精益求精的东西。另外我不喜欢过度设计东西，所以它被硬编码到 Foundation 中。但同样的原则也适用于任何想要输出干净的 HTML 且没有验证问题的 PHP 库，您经常会在手写 HTML 中找到这些问题。

# .net - .NET 通信组件

> ID：288618
> 
> 赞同：1
> 
> 时间：2008-11-13T22:45:18.850
> 
> 标签：.net, networking, network-programming, components

我正在寻找 C#.NET 2008 Professional 的组件，它能够完成我们的应用程序所需的大部分网络通信工作，因此我们的程序员不必这样做。

[该组件的功能应该与RealThinClient](http://www.realthinclient.org/) (RTC)的功能类似。组件必须能够优雅地丢失和重新获得连接。它必须具有内置加密功能。它必须内置压缩。RTC 也能够进行连接池，这也是我们想要的。

关于我们的一点背景：我们以前是一家 Delphi 7 商店，现在正在转向使用 Visual Studio .NET 2008。在我们决定转向 .NET 之前，我们刚刚找到了 RTC，并希望有一些东西可以复制可用的功能. :-)

感谢您的帮助，非常感谢您的链接。

迈克尔·贝克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T00:16:48.370

您应该从 www.NSoftware.com 查看 IPWorks，它们不仅有一个 Dot Net 库，而且还有一个 Delphi 组件。这可能会帮助您转换。如果您购买他们的 Red Carpet 订阅，您将获得所有图书馆。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T02:22:17.883

周转基金，

Windows Communication Foundation 是 .net framework 3.0 中的一组库，可从您的代码中抽象出应用程序通信。

您的所有通信都是抽象的，因此您可以像没有实际通信一样使用您的业务对象。

它还允许您完全配置要使用的通信协议类型、安全性等，而无需更改代码。

这可能不是您正在寻找的，但在 .net 系统中进行应用程序通信时应始终考虑 WCF。

从这里开始 [http://social.msdn.microsoft.com/content/en-us/msft/netframework/wcf/GettingStarted](http://social.msdn.microsoft.com/content/en-us/msft/netframework/wcf/GettingStarted)

# c# - Select on collection - C#

> ID：288619
> 
> 赞同：0
> 
> 时间：2008-11-13T22:45:25.107
> 
> 标签：c#, asp.net

Say I have a sql query

```
SELECT fname, lname, dob, ssn, address1, address2, zip, phone,state from users 
```

Now say the records are now either in dictionary base or a strongly typed collection.

I have a grid view control and i want to bind it to my collection but I only want to display fname, lname, dob and ssn and not the other columns.

Is there an easy way to extract the columns and then bind to the extracted item? Not sure if LINQ would be helpful here.

This is a test project as I am getting familiar with the web world wqith VS-2008

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T22:50:31.680

也许 LINQ 和匿名类可以为您解决问题。

```
from user in UserCollection
select new { FirstName=user.fname, LastName=user.lname, Dob=user.dob, SSN=user.ssn } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T22:51:25.500

您可以指定要在网格视图中显示的列。只需在 aspx 页面中指定所需的列：

```
<asp:GridView ID="gvwExample" runat="server" AutoGenerateColumns="False" >
<columns>
<asp:BoundField DataField="firstname" HeaderText="First Name" />
<asp:BoundField DataField="lastname" HeaderText="Last Name" />
<asp:BoundField DataField="hiredate" HeaderText="Date Hired" />
</columns>
</asp:GridView> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T22:51:01.397

您可以使用 linq 返回匿名类型（AKA 元组）。该元组将仅包含您正在寻找的属性。然后您可以将您的网格绑定到该集合。谷歌 C# 中的匿名类型或元组以了解我的意思。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T22:51:06.780

假设您的数据是某种形式的 IENumerable<T>：

```
var filteredUser = from U in Users
    select new { U.fname, U.lname, U.dob, U.SSN }; 
```

FilteredUser 现在是一个只有这些属性的集合。

这是 LINQ To Objects 很酷的一部分。您不需要使用 LINQ-To-SQL 来获取数据，您可以使用任何您想要填充初始问题的内容，然后使用 Linq-To-Objects 将其修剪到内存中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T22:52:57.727

你可以使用 linq 来满足你的需要。如果您为数据创建了 dbml，那么您可以使用 LINQ 直接从 db 中提取记录（或者如果您的集合是 IEnumerable），如下所示：

```
Dim _records = From user in users _
               Select New With {.FirstName = user.fname,_
               .Lastname = user.lname,.dob = user.dob,.ssn = user.ssn}

{gridcontrol}.datasource = _records 
```

# sql - What GOOD tools are available for generating ERD from a SQL Server Database?

> ID：288620
> 
> 赞同：29
> 
> 时间：2008-11-13T22:45:53.437
> 
> 标签：sql, sql-server, erd

I am trying to generate an Entity Relationship Diagram from an existing MS SQLServer 2005 database. What tools are available? Specifically,I am not only interested in ERD's more directly I am looking for a tool to help quickly learning and analysing a medium size (schema wise not really row wise) database structure.

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2013-07-23T20:54:36.710

我可以看到这篇文章已经很老了，**MS SQL Server Management Studio**当时可能还没有这个功能！尽管据我所知，使用**SQL Server 2012**，您可以通过以下几个简单步骤生成 ER 图：

1.  MS SQL Server 管理 Studio > 文件菜单 > “连接对象资源管理器”
2.  选择您的数据库节点并展开它。在此节点下，您会找到一个名为“Database Diagrams”的子节点
3.  右键单击“**数据库图**”>“**新数据库图**”>**添加**您希望查看其列、关系、...的表

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T22:48:55.740

The database reverse engineering feature of microsoft Visio are excellent for pulling the schema out of a database and developing from there. I'd investigate that avenue if you haven't already.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T22:51:54.937

我使用过 Visio 并取得了一些不错的效果。我也做的一件事是使用 SQL Server GUI 中内置的可视化设计器（数据库图）。当您将表放在那里时，它会自动包含外键。您可以只包括此时您想要关注的表格。

尽管所有这些工具都预测了预先存在的外键。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T23:12:09.657

我对[DBDesigner4](http://sourceforge.net/projects/dbdesigner-fork)很满意。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-31T11:32:27.153

您还可以从 Microsoft Visual Studio 2005 生成 ERD。

# computer-science - Level of Indirection solves every Problem

> ID：288623
> 
> 赞同：46
> 
> 时间：2008-11-13T22:47:43.807
> 
> 标签：computer-science, abstraction, indirection

What does the quote "Level of Indirection solves every Problem" mean in Computer Science?

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-11-13T22:54:23.607

通常，这意味着通过提高抽象级别可以使问题更容易理解/解决。

不过要小心你的抽象，至少我听到的完整引用是，“你可以用另一个间接级别解决每个问题，除了太多间接级别的问题”。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-07-07T12:57:43.957

来自[美丽的代码](http://www.dmst.aueb.gr/dds/pubs/inbook/beautiful_code/html/Spi07g.html)一书：

> 计算机科学中的所有问题都可以通过另一个层次的间接来解决，”这是 1972 年设想现代个人计算机的科学家 Butler Lampson 的一句名言。

尽管这[与维基百科相矛盾，维基百科](http://en.wikipedia.org/wiki/David_Wheeler_(computer_scientist))将这句话归因于大卫惠勒。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-03-19T09:41:46.180

Kevlin Henney 的推论是，“……除了间接层太多的问题”。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-14T01:38:56.957

这基本上意味着您应该将问题分解为较小的问题，直到问题易于解决。

您将问题分为几层：

*   解决问题的例程
*   他们称之为：理解问题空间的例程
*   他们调用： 执行小步骤的例程（加载文件，旋转一些位，写入输出）。

顶部的例程（解决问题的例程）是从解决问题的实际方法中间接/抽象出来的，使它们在以后以稍微不同的方式解决相同问题时更加灵活。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-10-30T23:43:09.817

如此重要的概念，这里的答案却很少。通常，提出的每个问题不一定通过直接代码调整来解决，而是以某种形式应用一些代理（忘记模式定义）。拦截&| 事件检测被严重低估。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-04-20T16:21:06.617

首先，我们必须了解*添加间接级别*意味着什么。

通常，*添加间接级别*意味着我们能够提供解决问题的替代方法，理想情况下还有一些额外的好处。其他时候，当当前没有任何工作时，间接可能是我们唯一的解决方案。

例如，如果业务需求是“我们需要决定采购多大的 IP 块，以便为我们的所有站点提供 IP 地址。”

问题是，如果我们选择一个太小的块，那么我们将需要一个更大的块。我们的管理员不仅必须获得另一个块，而且现在必须在我们的路由表中注入额外的前缀才能访问我的站点。这是额外的时间、成本和复杂性。有没有更好的办法？

今天，IP 地址意味着您登录时的身份和所在位置。

[LISP](https://en.wikipedia.org/wiki/Locator/Identifier_Separation_Protocol)使用一定程度的间接来解决上述路由问题。

这样做需要付出一些代价：

*   现在必须存在新的支持 LISP 的服务器才能将地址​​映射到站点

*   需要两个命名空间（一个用于位置，另一个用于 ID）

还有一些额外的好处：

*   添加新块时消除站点重新编号

*   减少路由表的大小

*   ISP 可以进行更改（将站点从一台主机移动到另一台主机）

*   节省 IPV4 地址空间（未分配给主机的定位器地址空间）

*   使用 LISP，ISP 可以为每个站点分配更少的地址

下图显示了新的间接层：

[![在此处输入图像描述](https://i.stack.imgur.com/qLKE1.png)](https://i.stack.imgur.com/qLKE1.png)

**LISP 通过添加一个新**的*间接*层解决了这个问题并简化了一些事情，但并不是完全简单。它是不同的，并且在许多方面更好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-01-31T19:01:07.510

它起源于*布尔特兰普森*：

> *“计算机科学中的所有问题都可以通过另一个层次的间接来解决”*

这显然是*一句格言*，并不打算按字面意思理解。这当然不是一个可证明的定理。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-12-14T13:33:34.847

这句话的含义非常广泛。理解的关键是关注“问题”这个词。问题可以是编程问题/错误，将世界实体转换为其等效的计算组件，与计算解决方案相关的成本。假设您正在尝试通过自己开发某些东西的成本来解决问题，您可能需要考虑让其他专家在时间和金钱上更便宜地为您完成这项工作。这是间接的另一种用法

# reporting-services - 从 SQL Server Reporting Services 报告的第一页删除多余的空格

> ID：288628
> 
> 赞同：1
> 
> 时间：2008-11-13T22:50:55.767
> 
> 标签：reporting-services

我正在使用 SQL Server Reporting Services 2008（尽管这在 2005 年对我来说似乎也是一个问题）。我有一份报告，每个客户有一页（即在 customerId 上分页）。我看到的奇怪的事情是第一个报告（即报告的第一页）在顶部比其他页面有一些额外的空白。通常，当您有报告和分页的标题时，这似乎会发生（因此第一页有标题，但每个后续页面都没有）。我正在处理的报告没有这样的标题，但仍然有这个额外的空白。

我想知道的是如何防止报告第一页上出现额外的空白。如何使报告的每一页都相同？

我也没有对报告应用页眉或页脚。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T13:01:58.697

I've just found the problem i had with extra space on first page.

In my case, the report has a header (with a textbox inside) and in the body a table. The problem was that on first page (printed from the app) appeared a little space between the header and the table on the body. Well, apart from that the result was perfect. But when exporting to Excel, first page only showed header, the rest of the pages looked perfect.

The solution: when you add a table (at least in the body), this table has automatically header and footer. I wasn't using header nor footer so i've removed them (first file and last file of the table) and voilá =-D

that's all.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T20:05:45.643

在任何版本的 Reporting Services 中，页面的 HTML 呈现顶部的额外空间有几个不同的原因。根据问题的原因，有几个技巧可以解决这个问题：

1.  将标题从标题移动到报告的正文。如果标题是标签，这并不总是有帮助。

2.  如果您使用的是表格，则将单独的行添加到表格的标题中。这似乎工作得很好，尤其是当您渲染到 Excel 时。但是，并非所有报告要求都可以支持此作为解决方案。

3.  在 SSRS 2000/2005 中，如果您使用矩形或组等容器，则出现间距问题的可能性会增加。如果您可以将标题移出容器，那么这有助于降低出现问题的可能性。我没有尝试在 SSRS 2008 中使用 Tablix 分组控件，所以我不知道这是否适用于 SSRS 2008。

4.  如果您保持页眉和页脚对象，即使您没有向区域添加任何标签，那么这些可能会导致第一页上的额外空间。

如果不重现您的确切问题，很难给您更好的建议。如果您想临时发布示例 RDL 文件的代码，那么我可以尝试在我的机器上重现 SSRS 2008 中的问题，看看我是否可以为您提供针对您的问题的自定义解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-13T15:27:51.197

I'm using Reporting Services / SSRS 2008\. I have a table (tablix) with column headers and a subreport in the last row. How do I get rid of the extra space on the first page? It looks ugly when exported to Excel. I've tried moving the table immediately below the report header and it does not work. It seems to enforce a tiny space between the two.

# sql - SQL：获取所有带有任何评论的帖子

> ID：288637
> 
> 赞同：1
> 
> 时间：2008-11-13T22:51:29.773
> 
> 标签：sql, mysql

我想我需要构建一些相当简单的 SQL，但是由于这些天我很少使用 DB，所以我无法弄清楚细节。

我有一个包含以下列的“帖子”表：

> ID，标题，文本

以及一个包含以下列的“评论”表：

> id、名称、文本、post_id

（单个）SQL 语句会是什么样子，它通过“post_id”键检索与一个或多个评论相关联的所有帖子的标题？如果 DBMS 与 SQL 查询有任何相关性，那么它就是 MySQL。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T22:56:07.923

```
选择 p.caption, count(c.id)
从帖子 p 加入评论 c 在 p.id = c.post_id
按 p.caption 分组
计数（c.id）> 0
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T22:57:46.563

```
SELECT DISTINCT p.caption, p.id
    FROM posts p, 
         comments c 
    WHERE c.post_ID = p.ID 
```

我认为使用连接会比使用 IN 子句或子查询快得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T23:07:43.300

```
SELECT caption FROM posts 
INNER JOIN comments ON comments.post_id = posts.id 
GROUP BY posts.id; 
```

不需要`having`子句或`count()`.

编辑：当然应该是一个`inner join`（如果评论是孤立的，以避免空值），感谢 jishi。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T23:43:46.893

```
SELECT DISTINCT caption
FROM posts
    INNER JOIN comments ON posts.id = comments.post_id 
```

忘记计数和子查询。

内连接会选取所有有效帖子的评论，并排除所有评论为 0 的帖子。DISTINCT 将合并具有超过 1 条评论的帖子的重复标题条目。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T02:06:01.350

我发现这种语法在这种情况下是最易读的：

```
SELECT * FROM posts P 
  WHERE EXISTS (SELECT * FROM Comments WHERE post_id = P.id) 
```

它比该线程中的大多数其他人更好地表达了您的意图-“给我所有帖子...”（从帖子中选择*）“...有任何评论”（如果存在（从评论中选择* ... ））。它与上面的连接基本相同，但是因为您实际上并没有进行连接，所以您不必担心在 Posts 中获取重复记录，因此每个帖子只需获得一条记录。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-13T22:54:47.367

只是在这里离开我的头顶，但可能是这样的：

```
SELECT caption FROM posts WHERE id IN (SELECT post_id FROM comments HAVING count(*) > 0) 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-11-13T22:53:59.147

您基本上是在查看执行子查询-

`SELECT p.caption FROM posts p WHERE (SELECT COUNT(*) FROM comments c WHERE c.post_id=p.id) > 1;`

这具有`SELECT COUNT(*)`为帖子表中的每一行运行子查询的效果。根据表的大小，您可能会考虑在表中添加一个额外的列 ,`comment_count`以`posts`存储相应的数量`comments`，这样您就可以简单地做

`SELECT p.caption FROM posts p WHERE comment_count > 1`

# sql-server - SQL Server 2008 搜索问题是否会影响 SharePoint 搜索？

> ID：288663
> 
> 赞同：2
> 
> 时间：2008-11-13T22:55:19.360
> 
> 标签：sql-server, sharepoint, sql-server-2008, search, moss

有谁知道在 SQL Server 2008 全文搜索性能方面影响 Stack Overflow 的问题是否对 SharePoint 中的搜索有影响？据我了解，SharePoint 搜索使用 SQL Server 全文搜索。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T07:26:55.007

SharePoint 2007 有自己的搜索数据库，用于存储搜索范围和其他内容等项目。实际的搜索索引不使用全文搜索，而是将其信息存储在基于文件的索引中。

因此，在 SharePoint 上运行的任何搜索查询都不会导致问题。

网站的搜索爬网是另一回事，我不完全确定它的实施。但是，大多数 SharePoint 网站的事务吞吐量与 StackOverflow 等网站不同。此外，如果使用 SharePoint 站点来托管像 StackOverflow 这样的事务性数据，则可能会导致非常严重的性能问题。

因此，SharePoint 2007 中的搜索不会出现与 StackOverflow 相同的问题。在使用 SQL 2008 后端运行搜索爬网时，我不会完全排除一些性能损失，但是由于调度和低于 100gig 的数据库，用户不应该注意到问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T06:50:55.657

我不知道 2008 下的 SQL Server 有任何问题，但**我确信它不会影响 SharePoint 2007**。
自 2007 年以来，SharePoint 搜索不再使用 SQL 搜索。

如果您运行的是 SharePoint 2003，我不确定是否支持 SQL 2008。

# apache-flex - 如何连接在 ActionScript 3 的 PureMVC 框架中动态加载的模块

> ID：288673
> 
> 赞同：0
> 
> 时间：2008-11-13T22:56:37.033
> 
> 标签：apache-flex, actionscript-3, puremvc

我在 FlexBuilder 3 项目中使用 PureMVC 框架。我已经连接了 ApplicationFacade 并成功执行了简单的命令。

我的入口点 Application.mxml 中有一个 ModuleLoader，当用户从 ApplicationMdiator 登录时，我设置了 ModuleLoader 的 url。

我在哪里注册我的模块调解器，因为我没有来自 ApplicationMediator 的可用实例，所以在设置 url 时动态加载该模块调解器？

我需要为模块创建另一个外观吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T19:41:32.480

PureMVC 有两种版本，分别用于 ActionScript 3 PureMVC Standard 和 PureMVC Multicore。

如果您想在 flex 应用程序中使用模块，您将需要使用 PureMVC 多核版本。

可以在[此处找到带有链接演示的良好参考解释](http://puremvc.org/content/view/75/181/)

# objective-c - How to fade an NSSound object

> ID：288687
> 
> 赞同：5
> 
> 时间：2008-11-13T23:01:50.080
> 
> 标签：objective-c, nssound

I've written a cheap & cheerful sound board in for my Mac, and I play the various sounds with NSSound like this:

```
-(void)play:(NSSound *)soundEffect:(BOOL)stopIfPlaying {
    BOOL wasPlaying = FALSE;

    if([nowPlaying isPlaying])  {
        [nowPlaying stop];
        wasPlaying = TRUE;
    }   

    if(soundEffect != nowPlaying)
    {
        [soundEffect play];
        nowPlaying = soundEffect;
    } else if(soundEffect == nowPlaying && ![nowPlaying isPlaying] && !wasPlaying) {
        [nowPlaying play];
    }
} 
```

Rather than just stop it dead, I'd like it to fade out over a couple of seconds or so.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-16T21:06:12.090

This is the final version of the method:

```
-(void)play:(NSSound *)soundEffect:(BOOL)stopIfPlaying {
    BOOL wasPlaying = FALSE;

    if([nowPlaying isPlaying])  {
        struct timespec ts;
        ts.tv_sec = 0;
        ts.tv_nsec = 25000000;

        // If the sound effect is the same, fade it out.
        if(soundEffect == nowPlaying)
        {
            for(int i = 1; i < 30; ++i)
            {
                [nowPlaying setVolume: (1.0 / i )];
                nanosleep(&ts, &ts);
            }           
        }

        [nowPlaying stop];
        [nowPlaying setVolume:1];
        wasPlaying = TRUE;
    }   

    if(soundEffect != nowPlaying)
    {
        [soundEffect play];
        nowPlaying = soundEffect;
    } else if(soundEffect == nowPlaying && ![nowPlaying isPlaying] && !wasPlaying) {
        [nowPlaying play];
    }
} 
```

So it only fades out if I pass the same sound in (ie, click the same button), also, I went for nanosleep rather than sleep, as that on has a granularity of 1 second.

I struggled for a while trying to work out why my 200 millisecond delay didn't seem to have any effect, but then 200 NANOseconds isn't really that long is it :-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-19T17:06:49.997

I would use NSTimer to avoid blocking the main thread.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T06:50:26.673

Something like this perhaps? You probably want a more linear dropoff, but the basic idea is make a loop and sleep the period of time till the next update.

```
if([nowPlaying isPlaying])  {
    for(int i = 1; i < 100; ++i)
    {
        [nowPlaying setVolume: (1.0 / i)];
        Sleep(20);
    }
    [nowPlaying stop];
    wasPlaying = TRUE;
} 
```

# c++ - 链接时间代码生成的优缺点是什么？（对比 2005 年）

> ID：288691
> 
> 赞同：20
> 
> 时间：2008-11-13T23:03:52.963
> 
> 标签：c++, visual-c++

我听说启用链接时间代码生成（/LTCG 开关）对于具有大量要链接在一起的库的大型项目来说可能是一项重大优化。我的团队在我们解决方案的发布配置中使用它，但是长编译时间是一个真正的拖累。对没有其他文件依赖的一个文件的一次更改会触发另外 45 秒的“正在生成代码...”。Release 肯定比 Debug 快得多，但我们可以通过禁用 LTCG 并仅打开 /O2 来实现相同的加速。

启用 /LTCG 是否值得？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-14T00:41:35.293

很难说，因为这主要取决于你的项目——当然还有 VS2005 提供的 LTCG 的质量（我没有足够的经验来判断）。最后，你必须测量。

但是，我想知道为什么您对发布版本的额外持续时间有这么多问题。您应该只分发具有可重现或存档源的可重现、稳定、版本化的二进制文件。我很少看到频繁的增量发布构建的原因。

团队的推荐设置是这样的：开发人员通常只在他们的机器上创建增量调试版本。构建版本应该是从源代码控制到可再分发（二进制文件甚至设置）的完整构建，具有新的版本号并标记/归档源。只有这些应该提供给内部测试人员/客户。

理想情况下，您会将完整的构建移动到单独的机器上，或者可能是一台好的 PC 上的虚拟机。这为您的构建提供了一个稳定的环境（包括第 3 方库、环境变量等）。

理想情况下，这些构建应该是自动化的（“从源代码管理到设置的一键式”），并且应该每天运行。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-14T08:46:26.390

它允许链接器进行代码的实际编译，因此它可以进行更多优化，例如内联。

如果您不使用 LTCG，编译器是构建过程中唯一可以内联函数的组件，例如用函数的内容替换对函数的“调用”，这通常会快很多。无论如何，编译器只会对产生改进的函数这样做。

因此，它只能使用它拥有的函数来执行此操作。这意味着如果 cpp 文件中的一个函数调用另一个未在同一个 cpp 文件（或包含的头文件）中实现的函数，则它没有函数的实际主体，因此不能内联它.

但是，如果您使用 LTCG，它是执行内联的链接器，并且它具有整个项目的所有 cpp 文件中的所有功能，减去未使用 LTCG 构建的引用的 lib 文件。这为链接器（成为编译器）提供了更多的工作空间。

但这也会使您的构建花费更长的时间，尤其是在进行增量更改时。您可能希望在发布构建配置中打开 LTCG。

请注意，LTCG 与配置文件引导优化不同。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-14T05:50:10.070

我知道 Bungie 的人将它用于 Halo3，他们提到的唯一缺点是它有时会弄乱他们的确定性回放数据。

您是否分析了您的代码并确定了对此的需求？我们实际上几乎完全在调试模式下运行我们的服务器，但在特殊情况下，一些文件被描述为性能关键。效果很好，并且在出现问题时可以调试。

不确定您正在制作什么样的应用程序，但分解数据结构以对应于它们在代码中的处理方式（以获得更好的缓存一致性）对我们来说是一个更大的胜利。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-02T13:28:54.973

我发现缺点是编译时间更长，并且在该模式下（LTCG 打开）生成的 .obj 文件可能非常庞大。例如，可能为 200-500k 的 .obj 文件大约为 2-3mb。我碰巧在我的链中编译一堆项目导致了一个 2 GB 的文件夹，其中大部分是 .obj 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T02:17:59.360

我也没有看到在发布版本中使用链接时代码生成额外编译时间的问题。我每天只构建一次发布版本（隔夜），并在白天使用单元测试和调试构建。

# python - 从内置类继承是否正确？

> ID：288695
> 
> 赞同：6
> 
> 时间：2008-11-13T23:06:05.987
> 
> 标签：python, inheritance, oop

我想以某种方式用 python 程序解析一个 Apache **access.log**文件，虽然我对面向对象编程完全陌生，但我想现在就开始做。

我将创建一个类**ApacheAccessLog**，而我现在唯一能想象到的，它会做的是“ **readline** ”方法。**在这种情况下从内置文件**类继承传统上是否正确，因此该类的行为就像**文件**类本身的实例一样，或者不是？最好的方法是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-13T23:53:29.103

在这种情况下，我会使用*委托*而不是*继承*。这意味着您的类应该包含文件对象作为属性并`readline`在其上调用方法。您可以在记录器类的构造函数中传递一个文件对象。

这至少有两个原因：

1.  委托减少了耦合，例如，您可以使用任何其他实现`readline`方法的对象代替文件对象（*鸭子类型*在这里很方便）。
2.  从文件继承时，类的公共接口变得不必要的宽泛。它包括文件中定义的所有方法，即使这些方法在 Apache 日志的情况下没有意义。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-21T03:48:15.007

我来自 Java 背景，但我相当有信心相同的原则将适用于 Python。根据经验，您**永远不**应该从您不理解和控制其实现的类继承，除非该类是专门为继承而设计的。如果它是以这种方式设计的，它应该在其文档中清楚地描述这一点。

这样做的原因是继承可能会将您绑定到您所继承的类的实现细节。

使用 Josh Bloch 的《Effective Java》一书中的示例

如果我们要扩展类`ArrayList`类以便能够计算在其生命周期内添加到它的项目的数量（不一定是它当前包含的数量），我们可能会想写这样的东西。

```
public class CountingList extends ArrayList {
    int counter = 0;

    public void add(Object o) {
        counter++;
        super.add(0);
    }

    public void addAll(Collection c) {
        count += c.size();
        super.addAll(c);
    }

    // Etc.
} 
```

现在这个扩展看起来可以准确地计算添加到列表中的元素数量，但实际上它可能不会。如果`ArrayList`已经`addAll`通过迭代`Collection`提供并为每个元素调用其接口方法`addAll`来实现，那么我们将对通过该方法添加的每个元素计数`addAll`两次。现在我们类的行为依赖于`ArrayList`.

这当然是除了不能在`List`我们的`CountingList`类中使用其他实现的缺点之外。加上从上面讨论的具体类继承的缺点。

据我了解，Python 使用与 Java 类似（如果不相同）的方法分派机制，因此会受到相同的限制。如果有人可以提供 Python 中的示例，我相信它会更加有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T23:40:09.600

从内置类继承是完全可以接受的。在这种情况下，我会说你是对的。
日志“是一个”文件，以便告诉您继承没问题..

一般规则。
狗“是”动物，因此继承自动物。
所有者“拥有”动物，因此不从动物继承。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T23:42:55.163

尽管在某些情况下从内置函数继承很有用，但这里真正的问题是您想对输出做什么以及您的总体设计是什么。我通常会编写一个阅读器（使用文件对象）并吐出我需要保存我刚刚阅读的信息的任何数据类。然后很容易设计该数据类以适应我的其余设计。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T00:31:59.963

从“内置”类继承应该是相当安全的，因为以后对这些类的修改通常会与当前版本兼容。

但是，您应该认真考虑您是否真的希望将您的类与内置类提供的附加功能联系起来。正如另一个答案中提到的，您应该考虑（甚至可能更喜欢）使用*委托*。

作为一个为什么在不需要继承时避免继承的示例，您可以查看*java.util.Stack*类。当它扩展 Vector 时，它继承了 Vector 上的**所有**方法。这些方法中的大多数都违反了 Stack 隐含的合同，例如 LIFO。在内部使用 Vector 实现 Stack 会好得多，只将 Stack 方法公开为 API。之后很容易将实现更改为 ArrayList 或其他东西，但由于继承，现在这些都不可能了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T21:26:35.620

您似乎已经找到了答案，即在这种情况下，委托是更好的策略。尽管如此，我想补充一点，除了委派之外，扩展内置类并没有错，特别是如果您的替代方案（取决于语言）是“猴子补丁”（参见[http://en.wikipedia.org /wiki/Monkey_patch](http://en.wikipedia.org/wiki/Monkey_patch) )

# javascript - 获取 div/span 标签的位置

> ID：288699
> 
> 赞同：112
> 
> 时间：2008-11-13T23:07:16.403
> 
> 标签：javascript, html

有人可以告诉我如何在未指定时获取or元素的`top`&`left`位置吗？`div``span`

IE：

```
<span id='11a' style='top:55px;' onmouseover="GetPos(this);">stuff</span>
<span id='12a' onmouseover="GetPos(this);">stuff</span> 
```

在上面，如果我这样做：

```
document.getElementById('11a').style.top 
```

的值`55px`被返回。但是，如果我尝试对`span`“12a”进行此操作，则不会返回任何内容。

我在一个页面上有一堆`div`/ `span`s，我无法为其指定`top`/`left`属性，但我需要`div`在该元素下直接显示一个。

* * *

## 回答 #1

> 赞同：209
> 
> 时间：2008-11-13T23:23:54.110

`getBoundingClientRect()`您可以在对元素的引用上调用该方法。然后您可以检查`top`、`left`和`right`/或`bottom`属性...

```
var offsets = document.getElementById('11a').getBoundingClientRect();
var top = offsets.top;
var left = offsets.left; 
```

如果使用jQuery，您可以使用更简洁的代码...

```
var offsets = $('#11a').offset();
var top = offsets.top;
var left = offsets.left; 
```

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2008-11-13T23:11:51.090

这个函数会告诉你元素相对于页面的 x,y 位置。基本上你必须循环遍历所有元素的父元素并将它们的偏移量相加。

```
function getPos(el) {
    // yay readability
    for (var lx=0, ly=0;
         el != null;
         lx += el.offsetLeft, ly += el.offsetTop, el = el.offsetParent);
    return {x: lx,y: ly};
} 
```

但是，如果您只想要元素相对于其容器的 x,y 位置，那么您只需要：

```
var x = el.offsetLeft, y = el.offsetTop; 
```

要将元素直接放在该元素的下方，您还需要知道它的高度。这存储在 offsetHeight/offsetWidth 属性中。

```
var yPositionOfNewElement = el.offsetTop + el.offsetHeight + someMargin; 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2015-06-20T01:31:35.853

虽然@nickf 的回答有效。如果您不关心旧浏览器，您可以使用这个纯 Javascript 版本。适用于 IE9+ 等

```
var rect = el.getBoundingClientRect();

var position = {
  top: rect.top + window.pageYOffset,
  left: rect.left + window.pageXOffset
}; 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-08-26T16:45:09.287

正如 Alex 所指出的，您可以使用 jQuery offset() 来获取相对于文档流的位置。使用 position() 作为其相对于父级的 x,y 坐标。

编辑：切换`document.ready`，`window.load`因为`load`等待所有元素，所以你得到它们的大小，而不是简单地准备 DOM。以我的经验，`load`导致 Javascript 定位错误的元素更少。

```
$(window).load(function(){ 
  // Log the position with jQuery
  var position = $('#myDivInQuestion').position();
  console.log('X: ' + position.left + ", Y: " + position.top );
}); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2012-10-22T20:09:01.820

对于只需要顶部或左侧位置的任何人，对@Nickf 的可读代码稍作修改就可以了。

```
function getTopPos(el) {
    for (var topPos = 0;
        el != null;
        topPos += el.offsetTop, el = el.offsetParent);
    return topPos;
} 
```

和

```
function getLeftPos(el) {
    for (var leftPos = 0;
        el != null;
        leftPos += el.offsetLeft, el = el.offsetParent);
    return leftPos;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-01-06T23:34:37.890

我意识到这是一个旧线程，但需要将 @alex 的答案标记为正确答案

`element.getBoundingClientRect()`与 jQuery 完全匹配`$(element).offset()`

它与 IE4+ 兼容... [https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect](https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect)

# stack - 如何将中缀和堆栈优先级扩展到其他运算符？

> ID：288704
> 
> 赞同：-1
> 
> 时间：2008-11-13T23:08:40.987
> 
> 标签：stack, infix-notation, operations

如何扩展中缀和堆栈优先级以包括运算符`<`, `>`, `<=`, `>=`, `==`, `!=`, `!`, `&&`, 和`||`?

在解析中缀表达式时，例如：`P + (Q – F) / Y#`，每个符号都有一个与其操作顺序相关的优先级。`/`并且`*`具有比`+`和更高的优先级`-`。

以下是我拥有/理解的优先事项：

```
Priority * / + - ( )   #

Infix    2 2 1 1 3 0   0 

Stack    2 2 1 1 0 n/a 0 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-08T21:23:54.857

这取决于你想要什么优先级，对吧？除非您以特定语言询问优先级（如果是，请详细说明）。

无论如何，<、>、<= 和 >= 不适用于布尔值，== 和 != 适用于任何东西，而 !、&& 和 || 仅适用于布尔值。但是它们都返回布尔值，所以你想先应用那些不适用于布尔值的，然后应用那些可能适用于布尔值的，最后是那些只适用于布尔值的。至于最后一个，！优先于 && 和 ||。虽然没有必要，但我会让 && 优先于 ||，因为某些逻辑符号就是这样工作的。

所以优先级最终会是：

```
(
* /
+ -
< > <= >=
== !=
!
&&
||
) # 
```

# math - Lua 的标准（或最受支持的）大数（任意精度）库是什么？

> ID：288707
> 
> 赞同：25
> 
> 时间：2008-11-13T23:10:22.700
> 
> 标签：math, lua, precision, bignum

我正在处理无法四舍五入的大量数字。使用 Lua 的标准数学库，似乎没有方便的方法来保持超出某些内部限制的精度。我还看到有几个库可以加载以处理大数字：

1.  [http://oss.digirati.com.br/luabignum/](http://oss.digirati.com.br/luabignum/)
2.  [http://www.tc.umn.edu/~ringx004/mapm-main.html](http://www.tc.umn.edu/~ringx004/mapm-main.html)
3.  [http://lua-users.org/lists/lua-l/2002-02/msg00312.html](http://lua-users.org/lists/lua-l/2002-02/msg00312.html)（可能与#2相同）
4.  [http://www.gammon.com.au/scripts/doc.php?general=lua_bc](http://www.gammon.com.au/scripts/doc.php?general=lua_bc)（但我找不到任何来源）

此外，如果建立了绑定，可以从 Lua 调用 C中的[许多库。](http://en.wikipedia.org/wiki/Arbitrary-precision_arithmetic#Arbitrary-precision_software)

您对这些库中的一个或多个有任何经验吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-14T14:10:17.390

使用[lbc](http://www.tecgraf.puc-rio.br/%7Elhf/ftp/lua/#lbc "磅")代替 lmapm 会更容易，因为 lbc 是独立的。

```
local bc = require"bc"
s=bc.pow(2,1000):tostring()
z=0
for i=1,#s do
        z=z+s:byte(i)-("0"):byte(1)
end
print(z) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-06T22:58:16.553

我使用 Norman Ramsey 的建议来解决 Project Euler 问题[#16](http://projecteuler.net/index.php?section=problems&id=16)。我不认为说问题的症结在于准确计算 303 位整数是剧透。

以下是我安装和使用该库所需的步骤：

1.  Lua 需要在启用动态加载的情况下构建。我使用 Cygwin ，但我改成`PLAT`了`src/Makefile`. `linux`默认值 ,`none`不启用动态加载。

2.  [MAMP](http://www.tc.umn.edu/~ringx004/mapm-main.html)需要在C 编译器可以找到的地方构建和安装。我放进`libmapm.a`去了`/usr/local/lib/`。接下来又去`m_apm.h`了。`m_apm_lc.h``/usr/local/include/`

3.  [lmamp](http://www.tecgraf.puc-rio.br/~lhf/ftp/lua/#lmapm)的 makefile需要更改为 Lua 和 MAMP 库的正确位置。对我来说，这意味着取消注释 , , 和的第二个声明，`LUA`并 编辑. `LUAINC``LUALIB``LUABIN``MAMP`

4.  最后，`mapm.so`需要放置在 Lua 可以找到的地方。我把它放在`/usr/local/lib/lua/5.1/`.

谢谢大家的建议！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-28T21:09:30.053

Lua 语言的作者之一 Luiz Figueiredo的[lmapm 库。](http://www.tecgraf.puc-rio.br/~lhf/ftp/lua/#lmapm)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-13T23:16:02.330

我无法真正回答，但我会添加[LGMP](http://lua-users.org/lists/lua-l/2007-07/msg00560.html "LGMP")，一个 GMP 绑定。不曾用过。

不是我的专业领域，但我希望 GNU 多精度算术库在这里成为一个标准，不是吗？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-15T05:51:33.467

尽管不是*任意*精度，但[Lua decNumber](http://luaforge.net/projects/ldecnumber/)是 IBM decNumber 的 Lua 5.1 包装器，它实现了提议的通用十进制算术标准 IEEE 754r。它具有 Lua 5.1 算术运算符等，完全控制舍入模式，工作精度高达 69 位十进制数字。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-07-09T22:23:11.670

这个问题有几个库，每个库都有你的优点和缺点，最好的选择取决于你的要求。[如果lbc](http://webserver2.tecgraf.puc-rio.br/%7Elhf/ftp/lua/#lbc)满足您的要求或 Luiz Figueiredo 的任何其他要求，我会说它 是一个不错的首选。对于最有效的方法，我猜想是使用 GMP 绑定，因为 GMP 是一个用于处理大整数的标准 C 库，并且经过了很好的优化。

尽管如此，如果你正在寻找一个纯 Lua 库，[lua-bint](https://github.com/edubart/lua-bint) 库可能是处理大整数的一个选项，我不会说它是最好的，因为上面提到的那些更有效和更完整，但通常它们需要编译 C 代码，或者设置起来很麻烦。但是，在比较纯 Lua 大整数库时，根据您的用例，它可能是一个有效的选择。该库已记录在案，代码完全被测试覆盖，并且有许多示例。但是因为我是图书馆的作者，所以请接受这个建议。

如果你的计算机中已经有 luarocks 安装，你可以使用它，或者只需在项目中下载 [bint.lua](https://github.com/edubart/lua-bint/blob/master/bint.lua) 文件，因为它除了需要 Lua 5.3+ 之外没有其他依赖项。

这是一个使用它来解决 Project Euler 中的问题 #16 的小示例（在之前的答案中提到）：

```
local bint = require 'bint'(1024)
local n = bint(1) << 1000
local digits = tostring(n)
local sum = 0
for i=1,#digits do
  sum = sum + tonumber(digits:sub(i,i))
end
print(sum) -- should output 1366 
```

# ruby - 检查是否定义了变量？

> ID：288715
> 
> 赞同：597
> 
> 时间：2008-11-13T23:14:05.657
> 
> 标签：ruby, reflection

如何检查变量是否在 Ruby 中定义？有`isset`可用的 -type 方法吗？

* * *

## 回答 #1

> 赞同：804
> 
> 时间：2008-11-13T23:22:27.870

使用`defined?`关键字（[文档](http://ruby-doc.org/docs/keywords/1.9/Object.html#method-i-defined-3F)）。它将返回一个带有项目类型的字符串，或者`nil`如果它不存在。

```
>> a = 1
 => 1
>> defined? a
 => "local-variable"
>> defined? b
 => nil
>> defined? nil
 => "nil"
>> defined? String
 => "constant"
>> defined? 1
 => "expression" 
```

正如 skalee 评论的那样：“值得注意的是，设置为 nil 的变量已被初始化。”

```
>> n = nil  
>> defined? n
 => "local-variable" 
```

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2008-11-13T23:23:32.003

如果您想在它确实存在时不做任何事情但如果它不存在则创建它，这很有用。

```
def get_var
  @var ||= SomeClass.new()
end 
```

这只会创建一次新实例。之后，它只是不断返回 var。

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2011-05-27T12:54:07.750

上述语句的正确语法是：

```
if (defined?(var)).nil? # will now return true or false
 print "var is not defined\n".color(:red)
else
 print "var is defined\n".color(:green)
end 
```

`var`用您的变量替换 ( )。此语法将返回真/假值以在 if 语句中进行评估。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-11-13T23:18:45.243

`defined?(your_var)`将工作。根据你在做什么，你也可以做类似的事情`your_var.nil?`

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2012-04-06T20:42:16.850

尝试“除非”而不是“如果”

```
a = "apple"
# Note that b is not declared
c = nil

unless defined? a
    puts "a is not defined"
end

unless defined? b
    puts "b is not defined"
end

unless defined? c
    puts "c is not defined"
end 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2013-04-26T14:30:15.807

使用`defined? YourVariable`
***保持简单愚蠢***.. ;)

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2017-07-08T03:31:29.790

### 警告回复：常见的 Ruby 模式

这是关键的答案：`defined?`方法。上面接受的答案完美地说明了这一点。

***但是有一条鲨鱼，潜伏在海浪之下……***

考虑这种常见的 ruby​​ 模式：

```
 def method1
    @x ||= method2
 end

 def method2
    nil
 end 
```

`method2`总是返回`nil`。第一次调用`method1`时，`@x`变量未设置 - 因此`method2`将运行。并将`method2`设置`@x`为`nil`. 那很好，一切都很好。但是你第二次打电话会发生什么`method1`？

记住 @x 已经被设置为 nil。`But method2`仍将再次运行！如果方法 2 是一项昂贵的工作，那么这可能不是您想要的。

让`defined?`方法来救援 - 使用此解决方案，处理特定情况 - 使用以下内容：

```
 def method1
    return @x if defined? @x
    @x = method2
  end 
```

魔鬼在细节中：但你可以用这种`defined?`方法避开潜伏的鲨鱼。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-09-16T07:52:27.853

这是一些代码，没有什么火箭科学，但效果很好

```
require 'rubygems'
require 'rainbow'
if defined?(var).nil?  # .nil? is optional but might make for clearer intent.
 print "var is not defined\n".color(:red)
else
 print "car is defined\n".color(:green)
end 
```

显然，着色代码不是必需的，在这个玩具示例中只是一个很好的可视化。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-03-15T22:00:25.863

你可以试试：

```
unless defined?(var)
  #ruby code goes here
end
=> true 
```

因为它返回一个布尔值。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-01-08T12:07:38.203

正如许多其他示例所示，您实际上并不需要方法中的布尔值来在 ruby​​ 中进行逻辑选择。除非您确实需要布尔值，否则将所有内容强制为布尔值将是一种糟糕的形式。

但是如果你绝对需要一个布尔值。采用 ！！（砰砰）或“假假揭示真相”。

```
› irb
>> a = nil
=> nil
>> defined?(a)
=> "local-variable"
>> defined?(b)
=> nil
>> !!defined?(a)
=> true
>> !!defined?(b)
=> false 
```

为什么强迫通常不值得：

```
>> (!!defined?(a) ? "var is defined".colorize(:green) : "var is not defined".colorize(:red)) == (defined?(a) ? "var is defined".colorize(:green) : "var is not defined".colorize(:red))
=> true 
```

这是一个重要的示例，因为它依赖于布尔值对其字符串表示的隐式强制。

```
>> puts "var is defined? #{!!defined?(a)} vs #{defined?(a)}"
var is defined? true vs local-variable
=> nil 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2017-08-15T10:28:12.923

应该提到的是，`defined`用于检查是否在哈希中设置了特定字段可能会出现意外行为：

```
var = {}
if defined? var['unknown']
  puts 'this is unexpected'
end
# will output "this is unexpected" 
```

此处的语法是正确的，但`defined? var['unknown']`会被评估为 string `"method"`，因此`if`将执行该块

编辑：检查哈希中是否存在密钥的正确表示法是：

```
if var.key?('unknown') 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-12-12T14:30:07.937

请注意“已定义”和“已分配”之间的区别。

```
$ ruby -e 'def f; if 1>2; x=99; end;p x, defined? x; end;f'
nil
"local-variable" 
```

x 被定义，即使它从未被分配！

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-05-17T15:52:41.817

`defined?`很棒，但是如果您在 Rails 环境中，您也可以使用`try`，尤其是在您想要检查动态变量名称的情况下：

```
foo = 1
my_foo = "foo"
my_bar = "bar"
try(:foo)        # => 1
try(:bar)        # => nil
try(my_foo)      # => 1
try(my_bar)      # => nil 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-10-23T16:45:04.080

此外，您可以通过插值检查它是否在字符串中定义，如果您编写代码：

```
puts "Is array1 defined and what type is it? #{defined?(@array1)}" 
```

如果定义了类型，系统会告诉您类型。如果它没有被定义，它只会返回一个警告说变量没有被初始化。

希望这可以帮助！:)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-02-04T15:38:54.973

留下一个非常简单的例子，以防万一。

当变量**不存在**时：

```
if defined? a then "hi" end
# => nil 
```

当变量**确实存在**时：

```
a = 2
if defined? a then "hi" end
# => "hi" 
```

# c# - 更快的 MD5 替代方案？

> ID：288732
> 
> 赞同：14
> 
> 时间：2008-11-13T23:24:06.120
> 
> 标签：c#, md5, hash

我正在开发一个在整个驱动器中搜索给定文件的程序。目前，我计算已知文件的 MD5 哈希值，然后递归扫描所有文件，寻找匹配项。

唯一的问题是 MD5 在处理大文件时速度非常慢。是否有更快的替代方案可以使用，同时保留非常小的误报概率？

所有代码都在 C# 中。

谢谢你。

**更新**

我读过甚至 MD5 也可以很快，磁盘 I/O 应该是限制因素。这让我相信我的代码可能不是最优的。这种方法有什么问题吗？

```
 MD5 md5 = MD5.Create();
        StringBuilder sb = new StringBuilder();
        try
        {
            using (FileStream fs = File.Open(fileName, FileMode.Open, FileAccess.Read))
            {
                foreach (byte b in md5.ComputeHash(fs))
                    sb.Append(b.ToString("X2"));
            }
            return sb.ToString();
        }
        catch (Exception)
        {
            return "";
        } 
```

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-11-13T23:32:47.447

我希望您仅在文件大小已经匹配时才检查 MD5 匹配。

另一个优化是对前 1K（或其他任意但相当小的数字）进行快速校验和，并在处理整个文件之前确保它们匹配。

当然，所有这些都假设您只是在寻找特定文件的匹配/不匹配决定。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-07-22T22:58:08.577

无论加密要求如何，都存在哈希冲突的可能性，因此无法使用哈希函数来*保证*两个文件相同。

不久前我写了类似的代码，通过首先索引所有文件，然后丢弃任何不同大小的文件，我运行得非常快。然后对剩余的条目执行快速哈希比较（在每个文件的一部分上）（在此步骤中比较字节被证明不太有用 - 许多文件类型具有在文件开头具有相同字节的公共标头）。然后使用 MD5 检查在此阶段之后留下的所有文件，最后如果 MD5 匹配，则对整个文件进行字节比较，以确保内容相同。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-13T23:31:04.687

只是线性读取文件？读取整个文件，计算 md5 哈希，然后比较哈希似乎毫无意义。

按顺序读取文件，一次几个字节，可以让您在读取 ​​4 个字节后丢弃绝大多数文件。而且您将节省计算散列函数的所有处理开销，这在您的情况下不会给您任何东西。

如果您已经拥有驱动器中所有文件的哈希值，那么比较它们是有意义的，但如果您必须即时计算它们，那么哈希值似乎没有任何优势。

我在这里错过了什么吗？在这种情况下，哈希会给你带来什么？

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-13T23:32:22.860

首先考虑一下真正的瓶颈是什么：哈希函数本身还是磁盘访问速度？如果您受到磁盘的限制，那么更改散列算法不会给您带来太多好处。根据您的描述，我暗示您总是在扫描整个磁盘以找到匹配项 - 考虑先构建索引，然后仅将给定的哈希与索引匹配，这会快得多。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-13T23:44:57.967

使用 MD5 比较文件有一个小问题：已知有一对*不同*但具有*相同*MD5 的文件。

这意味着您可以使用 MD5 来判断文件是否*不同*（如果 MD5 不同，则文件必须不同），但不能使用 MD5 来判断文件是否*相等*（如果文件相等，则 MD5 必须是相同，但如果 MD5 相等，则文件可能相等也可能不相等）。

您应该使用尚未破坏的哈希函数（如 SHA-1），或者（如@SoapBox 提到的）仅使用 MD5 作为查找候选者进行更深入比较的快速方法。

参考：

*   [http://www.win.tue.nl/hashclash/SoftIntCodeSign/](http://www.win.tue.nl/hashclash/SoftIntCodeSign/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-19T10:30:22.777

使用 MD5CryptoServiceProvider 和 BufferedStream

```
 using (FileStream stream = File.OpenRead(filePath))
        {
            using (var bufferedStream = new BufferedStream(stream, 1024 * 32))
            {
                var sha = new MD5CryptoServiceProvider();
                byte[] checksum = sha.ComputeHash(bufferedStream);
                return BitConverter.ToString(checksum).Replace("-", String.Empty);
            }
        } 
```

# c# - Post build visual studio step not being called at all

> ID：288735
> 
> 赞同：0
> 
> 时间：2008-11-13T23:26:53.697
> 
> 标签：c#, visual-studio

The long of it is I built an installer in visual studio that gave me this cheery error when I tried to use the program:

> Retrieving the COM class factory for component with CLSID {EC10E7E8-797E-4495-A86D-3E9EADA6D5BB} failed due to the following error: 80040154.

From that it seems I need to embed the manifest in the executable and to do that I should add as a post build event the following:

> "$(DevEnvDir)....\VC\bin\mt.exe" -manifest "$(ProjectDir)$(TargetName).exe.manifest" –outputresource:"$(TargetDir)$(TargetFileName)";#1

Well, when I do that and build the solution the event is not being called at all. In fact, I can put any old random text in the pre and post events and no error is ever given nor do I see anything being called.

Is there something that I should be doing differently to make this work?

Additional information:

I'm building from the IDE. And when I toggle the build types to debug and release I still the correct command in the post build events.

Is there a way to see a log of what it's doing?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T02:25:38.143

Tool + Options，Project and Solutions，Build and Run，将“MSBuild project build output verbosity”设置为Detailed。您将在“输出”窗口中获得大量诊断信息。

FWIW，您收到的错误消息是一个简单的“类未注册”错误。使用 Regsvr32.exe 修复

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T17:55:03.210

这是有效的。您显然不需要将清单烘焙到程序中。将清单包含到 msi 包中就足够了，还包含依赖检查器遗漏的 DLL。

就像大多数事情一样，一旦你知道就这么简单:-)

为什么不调用后期构建步骤我不知道，但真正的问题已经解决。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T23:30:35.373

two guesses:

*   build is not succeeding
*   your post/pre build events are defined in a project config that is not being built, like you define your events in the "debug" build but are building the "release" build.

are you building the solution from the command line or anything like that?

# c++ - 在整个范围内均匀生成随机数

> ID：288739
> 
> 赞同：108
> 
> 时间：2008-11-13T23:27:48.673
> 
> 标签：c++, random

我需要在指定的时间间隔内生成随机数，[max;min]。

此外，随机数应均匀分布在区间上，而不是位于特定点。

目前我正在生成：

```
for(int i=0; i<6; i++)
{
    DWORD random = rand()%(max-min+1) + min;
} 
```

根据我的测试，随机数仅在一点附近生成。

```
Example
min = 3604607;
max = 7654607; 
```

生成的随机数：

```
3631594
3609293
3630000
3628441
3636376
3621404 
```

从下面的答案：好的，RAND_MAX 是 32767。我在 C++ Windows 平台上。有没有其他方法可以生成均匀分布的随机数？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2013-11-22T03:04:49.137

## 为什么`rand`是个坏主意

您在这里得到的大多数答案都使用了`rand`函数和模运算符。该方法[可能无法统一生成数字](http://channel9.msdn.com/Events/GoingNative/2013/rand-Considered-Harmful)（它取决于 的范围和值`RAND_MAX`），因此不鼓励使用。

## C++11 和生成范围内

在 C++11 中，出现了多种其他选择。其中一个符合您的要求，可以很好地生成一个范围内的随机数：[`std::uniform_int_distribution`](http://en.cppreference.com/w/cpp/numeric/random/uniform_int_distribution). 这是一个例子：

```
const int range_from  = 0;
const int range_to    = 10;
std::random_device                  rand_dev;
std::mt19937                        generator(rand_dev());
std::uniform_int_distribution<int>  distr(range_from, range_to);

std::cout << distr(generator) << '\n'; 
```

这是正在运行[的](http://coliru.stacked-crooked.com/a/c5b94870fdcd13f2)示例。

模板功能可能会有所帮助：

```
template<typename T>
T random(T range_from, T range_to) {
    std::random_device                  rand_dev;
    std::mt19937                        generator(rand_dev());
    std::uniform_int_distribution<T>    distr(range_from, range_to);
    return distr(generator);
} 
```

### 其他随机发生器

标[`<random>`头](http://en.cppreference.com/w/cpp/numeric/random)提供了无数其他具有不同分布类型的随机数生成器，包括伯努利、泊松和正态分布。

### 我怎样才能洗牌一个容器？

该标准提供了[`std::shuffle`](http://en.cppreference.com/w/cpp/algorithm/random_shuffle)，可按如下方式使用：

```
std::vector<int> vec = {4, 8, 15, 16, 23, 42};

std::random_device random_dev;
std::mt19937       generator(random_dev());

std::shuffle(vec.begin(), vec.end(), generator); 
```

该算法将随机重新排序元素，具有线性复杂度。

## Boost.Random

如果您无法访问 C++11+ 编译器，另一种选择是使用[Boost.Random](http://www.boost.org/doc/libs/1_55_0/doc/html/boost_random.html)。它的界面与 C++11 非常相似。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-11-14T00:24:00.697

**[编辑]** **警告：不要`rand()`用于统计、模拟、密码学或任何严重的事情。**

对于一个匆忙的典型人来说，让数字*看起来是*随机的就足够了，仅此而已。

有关更好的选择，请参阅[@Jefffrey 的回复，或有关加密安全随机数的](https://stackoverflow.com/a/20136256/4513656)[此答案](https://stackoverflow.com/a/2572373/59087)。

* * *

通常，高位比低位显示出更好的分布，因此为简单目的生成范围随机数的推荐方法是：

```
((double) rand() / (RAND_MAX+1)) * (max-min+1) + min 
```

**注意**：确保 RAND_MAX+1 不​​会溢出（感谢 Demi）！

除法产生区间[0, 1)中的随机数；将其“拉伸”到所需范围。只有当 max-min+1 接近 RAND_MAX 时，您才需要 Mark Ransom 发布的“BigRand()”函数。

这也避免了由于模数导致的一些切片问题，这可能会使您的数字更加恶化。

* * *

不保证内置随机数生成器具有统计模拟所需的质量。数字在人类看来是“随机的”是可以的，但对于严肃的应用程序，您应该采取更好的方法 - 或者至少检查它的属性（均匀分布通常很好，但值往往相关，并且序列是确定性的）。Knuth 有一篇关于随机数生成器的优秀（如果难以阅读）论文，我最近发现[LFSR](http://en.wikipedia.org/wiki/Linear_feedback_shift_register)非常出色，而且实现起来非常简单，因为它的属性对你来说还可以。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2015-12-16T16:13:15.453

我想通过简要概述 2015 年的最新技术来补充 Angry Shoe 和 peterchen 的出色回答：

# 一些不错的选择

## `randutils`

该`randutils`库[（演示文稿）](http://www.pcg-random.org/posts/ease-of-use-without-loss-of-power.html)是一个有趣的新奇事物，提供了一个简单的界面和（声明的）强大的随机功能。它的缺点是它增加了对您的项目的依赖，而且它是新的，还没有经过广泛的测试。无论如何，免费（MIT 许可）和仅标题，我认为值得一试。

最小样本：模具辊

```
#include <iostream>
#include "randutils.hpp"
int main() {
    randutils::mt19937_rng rng;
    std::cout << rng.uniform(1,6) << "\n";
} 
```

即使对库不感兴趣，网站 ( [http://www.pcg-random.org/](http://www.pcg-random.org/) ) 也提供了许多关于随机数生成主题的有趣文章，特别是 C++ 库。

## Boost.Random

`Boost.Random` [(documentation)](http://www.boost.org/doc/libs/1_59_0/doc/html/boost_random.html)是启发`C++11`'s的库`<random>`，与他共享大部分界面。虽然理论上也是一个外部依赖，`Boost`但目前已经处于“准标准”库的状态，其`Random`模块可以被视为高质量随机数生成的经典选择。就解决方案而言，它具有两个优点`C++11`：

*   它更便携，只需要对 C++03 的编译器支持
*   它`random_device`使用系统特定的方法来提供高质量的播种

唯一的小缺陷是提供的模块`random_device`不是仅标头，必须编译和链接`boost_random`。

最小样本：模具辊

```
#include <iostream>
#include <boost/random.hpp>
#include <boost/nondet_random.hpp>

int main() {
    boost::random::random_device                  rand_dev;
    boost::random::mt19937                        generator(rand_dev());
    boost::random::uniform_int_distribution<>     distr(1, 6);

    std::cout << distr(generator) << '\n';
} 
```

虽然最小样本可以很好地工作，但实际程序应该使用一对改进：

*   make `mt19937`a `thread_local`：生成器非常丰满（> 2 KB），最好不要分配在堆栈上
*   `mt19937`具有多个整数的种子：Mersenne Twister 的状态很大，可以在初始化期间利用更多的熵

# 一些不太好的选择

## C++11 库

虽然是最惯用的解决方案，但该`<random>`库并没有提供太多以换取其接口的复杂性，即使是基本需求也是如此。缺陷在于`std::random_device`：标准不要求其输出的任何最低质量（只要`entropy()`返回`0`），并且截至 2015 年，MinGW（不是最常用的编译器，但几乎不是一个深奥的选择）将始终打印`4`在最低限度的样本上。

最小样本：模具辊

```
#include <iostream>
#include <random>
int main() {
    std::random_device                  rand_dev;
    std::mt19937                        generator(rand_dev());
    std::uniform_int_distribution<int>  distr(1, 6);

    std::cout << distr(generator) << '\n';
} 
```

如果实现不烂，则此解决方案应等效于 Boost 解决方案，并且适用相同的建议。

## 戈多的解决方案

最小样本：模具辊

```
#include <iostream>
#include <random>

int main() {
    std::cout << std::randint(1,6);
} 
```

这是一个简单、有效和简洁的解决方案。唯一的缺陷，编译需要一段时间——大约两年，前提是C++17按时发布，实验`randint`功能通过新标准。也许到那个时候，对播种质量的保证也会有所改善。

## [越差越好的](https://en.wikipedia.org/wiki/Worse_is_better)解决方案

最小样本：模具辊

```
#include <cstdlib>
#include <ctime>
#include <iostream>

int main() {
    std::srand(std::time(nullptr));
    std::cout << (std::rand() % 6 + 1);
} 
```

旧的 C 解决方案被认为是有害的，并且有充分的理由（请参阅此处的其他答案或[此详细分析](http://cpp.indi.frih.net/blog/2014/12/the-bell-has-tolled-for-rand/)）。尽管如此，它还是有它的优点：简单、便携、快速和诚实，从某种意义上说，众所周知，一个人得到的随机数并不像样，因此人们不会试图将它们用于严肃的目的。

## 会计巨魔解决方案

最小样本：模具辊

```
#include <iostream>

int main() {
    std::cout << 9;   // http://dilbert.com/strip/2001-10-25
} 
```

虽然 9 对于普通掷骰子来说有点不寻常，但人们不得不佩服这个解决方案中优良品质的完美结合，它设法成为最快、最简单、最易于缓存和最便携的解决方案。通过用 4 代替 9，可以得到任何类型的龙与地下城死亡的完美生成器，同时仍然避免包含符号的值 1、2 和 3。唯一的小缺陷是，由于呆伯特会计巨魔的坏脾气，该程序实际上会产生未定义的行为。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-13T23:44:16.533

如果`RAND_MAX`是 32767，您可以轻松地将位数加倍。

```
int BigRand()
{
    assert(INT_MAX/(RAND_MAX+1) > RAND_MAX);
    return rand() * (RAND_MAX+1) + rand();
} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-14T00:58:25.277

如果可以，请使用[Boost](http://en.wikipedia.org/wiki/Boost_C++_Libraries)。我对他们的[随机图书馆](http://www.boost.org/doc/libs/1_37_0/libs/random/index.html)很幸运。

`uniform_int`应该做你想做的。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-13T23:33:53.387

如果您关心的是随机性而不是速度，您应该使用安全的随机数生成方法。有几种方法可以做到这一点……最简单的方法是使用[OpenSSL 的](http://www.openssl.org/) [Random Number Generator](http://www.openssl.org/docs/crypto/rand.html#)。

[您还可以使用加密算法（如AES](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) ）编写自己的。通过选择一个种子和一个[IV](http://en.wikipedia.org/wiki/Initialization_vector)，然后不断地重新加密加密函数的输出。使用 OpenSSL 更容易，但不那么有男子气概。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-13T23:36:47.063

您应该查看`RAND_MAX`您的特定编译器/环境。`rand()`如果生成一个随机的 16 位数字，我想你会看到这些结果。（您似乎假设它将是一个 32 位数字）。

我不能保证这就是答案，但请发布您的价值`RAND_MAX`，并在您的环境中提供更多详细信息。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-13T23:33:16.650

检查`RAND_MAX`你的系统上有什么——我猜它只有 16 位，而且你的范围太大了。

除此之外，请参阅以下讨论：[在所需范围内生成随机整数](http://members.cox.net/srice1/random/genrange.html)以及使用（或不使用）[C rand() 函数](http://members.cox.net/srice1/random/crandom.html)的说明。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-13T23:32:03.703

如果您希望数字在该范围内均匀分布，您应该将您的范围分成多个相等的部分，这些部分代表您需要的点数。然后为每个部分获取一个具有最小值/最大值的随机数。

另请注意，您可能不应该使用`rand()`它，因为它实际上并不擅长生成随机数。我不知道您在哪个平台上运行，但可能有一个更好的函数可以调用，例如`random()`.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-07-08T09:56:32.347

这不是代码，但这个逻辑可能会对您有所帮助。

```
static double rnd(void)
{
   return (1.0 / (RAND_MAX + 1.0) * ((double)(rand())) );
}

static void InitBetterRnd(unsigned int seed)
{
    register int i;
    srand( seed );
    for( i = 0; i < POOLSIZE; i++){
        pool[i] = rnd();
    }
}

 // This function returns a number between 0 and 1
 static double rnd0_1(void)
 {
    static int i = POOLSIZE-1;
    double r;

    i = (int)(POOLSIZE*pool[i]);
    r = pool[i];
    pool[i] = rnd();
    return (r);
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-06-09T16:58:28.510

`[low, high)`只要整个范围小于 RAND_MAX，这应该在不使用浮点数的情况下提供范围内的均匀分布。

```
uint32_t rand_range_low(uint32_t low, uint32_t high)
{
    uint32_t val;
    // only for 0 < range <= RAND_MAX
    assert(low < high);
    assert(high - low <= RAND_MAX);

    uint32_t range = high-low;
    uint32_t scale = RAND_MAX/range;
    do {
        val = rand();
    } while (val >= scale * range); // since scale is truncated, pick a new val until it's lower than scale*range
    return val/scale + low;
} 
```

对于大于 RAND_MAX 的值，您需要类似

```
uint32_t rand_range(uint32_t low, uint32_t high)
{
    assert(high>low);
    uint32_t val;
    uint32_t range = high-low;
    if (range < RAND_MAX)
        return rand_range_low(low, high);
    uint32_t scale = range/RAND_MAX;
    do {
        val = rand() + rand_range(0, scale) * RAND_MAX; // scale the initial range in RAND_MAX steps, then add an offset to get a uniform interval
    } while (val >= range);
    return val + low;
} 
```

这大致就是 std::uniform_int_distribution 做事的方式。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-13T23:38:48.993

就其性质而言，随机数的小样本不必均匀分布。毕竟，它们是随机的。我同意，如果随机数生成器生成的数字始终似乎是分组的，那么它可能有问题。

但请记住，随机性不一定是统一的。

编辑：我添加了“小样本”来澄清。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-14T00:08:13.613

[man 3 rand](http://linux.die.net/man/3/rand)针对 1 到 10 之间的数字给出的解决方案是：

```
j = 1 + (int) (10.0 * (rand() / (RAND_MAX + 1.0))); 
```

在您的情况下，它将是：

```
j = min + (int) ((max-min+1) * (rand() / (RAND_MAX + 1.0))); 
```

当然，这并不像其他一些消息所指出的那样完美的随机性或一致性，但这对于大多数情况来说已经足够了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-01-31T11:11:06.643

**@解决方案** `((double) rand() / (RAND_MAX+1)) * (max-min+1) + min`

**警告**：不要忘记由于拉伸和可能的精度错误（即使 RAND_MAX 足够大），您将只能生成均匀分布的“bin”，而不是 [min,max] 中的所有数字。

* * *

**@解决方案：比格朗**

**警告**：请注意，这会使位加倍，但通常仍无法生成您范围内的所有数字，即 BigRand() 不一定会生成其范围内的所有数字。

* * *

**信息**：只要 rand() 的范围超出您的区间范围并且 rand() 是“统一的”，您的方法（模数）就“很好”。最多第一个 max - min 数字的误差为 1/(RAND_MAX +1)。

另外，我建议也切换到 C++11 中的新[随机包](http://www.cplusplus.com/reference/random/)e，它提供了比 rand() 更好、更多种类的实现。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-04-21T18:28:11.047

这是我想出的解决方案：

```
#include "<stdlib.h>"

int32_t RandomRange(int32_t min, int32_t max) {
    return (rand() * (max - min + 1) / (RAND_MAX + 1)) + min;
} 
```

这是一个桶解决方案，在概念上类似于用于`rand() / RAND_MAX`获取 0-1 之间的浮点范围然后将其四舍五入到桶中的解决方案。但是，它使用纯整数数学，并利用整数除法地板将值四舍五入到最近的桶。

它做了一些假设。首先，它假设`RAND_MAX * (max - min + 1)`总是适合`int32_t`. 如果`RAND_MAX`是 32767 并使用 32 位 int 计算，则您可以拥有的最大范围是 32767。如果您的实现具有更大的 RAND_MAX，您可以通过使用更大的整数（如`int64_t`）进行计算来克服这个问题。其次，如果`int64_t`使用了但`RAND_MAX`仍然是 32767，则在大于`RAND_MAX`您的范围内，您将开始在可能的输出数字中出现“漏洞”。这可能是任何源自缩放的解决方案的最大问题`rand()`。

尽管如此，对大量迭代的测试表明，这种方法对于小范围非常统一。但是，从数学上讲，这有可能（并且很可能）有一些小的偏差，并且当范围接近时可能会产生问题`RAND_MAX`。自己测试并确定它是否满足您的需求。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2022-01-08T06:45:47.620

使用 mersenne twister 引擎 (C++11)：

```
#include <random>    

// Returns a random integer within the range [min, max]
int generateRandomInt(const int min, const int max) {
  static bool is_seeded = false;
  static std::mt19937 generator;

  // Seed once
  if (!is_seeded) {
    std::random_device rd;
    generator.seed(rd());
    is_seeded = true;
  }

  // Use mersenne twister engine to pick a random number
  // within the given range
  std::uniform_int_distribution<int> distribution(min, max);
  return distribution(generator);
} 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2019-06-13T18:16:00.507

当然，下面的代码不会给你随机数，而是伪随机数。使用以下代码

```
#define QUICK_RAND(m,n) m + ( std::rand() % ( (n) - (m) + 1 ) ) 
```

例如：

```
int myRand = QUICK_RAND(10, 20); 
```

你必须打电话

```
srand(time(0));  // Initialize random number generator. 
```

否则数字不会接近随机。

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2008-11-13T23:56:53.060

我刚刚在互联网上找到了这个。这应该有效：

```
DWORD random = ((min) + rand()/(RAND_MAX + 1.0) * ((max) - (min) + 1)); 
```

# jquery - 奇怪的 jQuery AJAX Firefox 问题——页面随机无法完成下载

> ID：288752
> 
> 赞同：3
> 
> 时间：2008-11-13T23:31:55.590
> 
> 标签：jquery, ajax, firefox

我的网络应用程序有这个奇怪的问题。你看，我使用 jQuery 和 Forms API 并执行 $('#MyForm').ajaxSubmit(api parms 和回调函数在这里)。

但是，当我随机执行此操作时，并且仅在 Firefox 上，页面加载图标开始旋转，页面加载进度条在状态栏中运行，并且停止按钮变为红色 - 但它已经发布了表单并带回了结果。如果我刷新页面并继续尝试这样做，它会随机出现问题，但并非始终如一。

此问题发生在 Windows 2008 Server 上的 FF2 和 Ubuntu 8.04 上的 FF3 上。IE6、IE7、Opera（最新稳定版，2008 年 11 月）或 Safari（最新稳定版，2008 年 11 月）没有出现此问题。

这只是带有 AJAX 的 FF 中的一个已知错误，还是我可以用 jQuery 做些什么来阻止页面加载问题？

编辑：这*可能*与 TinyMCE 有关。我无法确认 100%，但是当我使用 jQuery 带回带有 TinyMCE 控件的表单时，问题似乎更频繁地出现。我尝试使用一个没有 TinyMCE 控件的表单来执行此操作，但没有出现问题。同样，这不是决定性的，但可能是一个因素。

编辑：好的，我刚刚注释掉了 TinyMCE 的东西，我可以确认问题消失了。如果我把 TinyMCE 控件带回来，问题就会随机出现。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-14T01:49:38.777

尝试查看服务器响应，使用 firebug 查看是否有问题，或者是否有任何 javascript 异常引发。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T11:05:40.480

当我在一个大量使用 iframe 的网站上工作时，我曾经遇到过这个问题。如果我没记错的话，一种简单的解决方法是在首页创建另一个具有最小高度/宽度的 iframe，并将其称为 frameFix 或类似名称。

然后从 iframe 内容页面使用正文加载事件写入一个空字符串，然后关闭 frameFix iframe。这会强制状态栏完全加载。

例如

iframe 内容页面

```
<body onload="javascript:progressBarHack()">

function progressBarHack(){
   top.frameFix.document.write("");
   top.frameFix.close();
   return;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T13:00:39.577

您可能不想升级这个答案——我只是在推断 redsquare 的答案，这解决了我的问题。

我正在使用 AJAX（确切地说是 jQuery 表单插件 API 和 .ajaxSubmit()）来拉回表单。当我在该表单上点击保存或取消时，它在 Firefox 中显示红色停止按钮并且不会停止。

因此，要解决此问题，我需要获取调用页面并在其中添加一个隐藏的 IFRAME，如下所示：

```
<iframe frameborder="0" src="http://mysite.com/fixdoc.html" id="frameFix" height="1" width="1" style="position: relative; left: -500px"></iframe> 
```

然后，我需要创建一个 fixdoc.html，它只是一个普通的空 HTML 页面，其中包含标准标签内容。

然后，在我的逻辑中完全完成保存或取消之后，我需要执行以下操作：

```
var ifr = document.getElementById('frameFix');
var doc = ifr.contentDocument;
if (doc == undefined || doc == null)
doc = testFrame.contentWindow.document;
doc.open();
doc.write(' ');
doc.close(); 
```

不知何故，这告诉 Firefox 摆脱它的无限加载循环。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-02T20:11:16.560

我在运行以在空的可见 iframe 上设置值的代码时遇到了这个问题：

```
function loadIframeContent() {
    $.post(
        '/my/content/url',
        $('#my-form').serialize(),
        function (data) {
            $('#my-preview-div-with-iframe').dialog('open');
            $('#id-on-my-iframe-tag')[0]
                .contentWindow
                .document
                .write(data);

            resizeIframeToContent();
        },
        'html'
    );
} 
```

解决方案原来是：

```
 var $document = $('#id-on-my-iframe-tag')[0]
                .contentWindow
                .document;    
            $document.open();
            $document.write(data);
            $document.close(); 
```

所以最后，`document.write(data)`调用被取消链接，以便首先打开文档，然后写入，最后关闭。不要命名文档变量`document`（至少不是在 Firefox 3 中），因为它会发生冲突——使用`$document`或类似名称。

我也在使用 TinyMCE，但这似乎无关紧要。

# windows - Print from a windows App - data from an Oracle DB on Linux

> ID：288755
> 
> 赞同：0
> 
> 时间：2008-11-13T23:32:27.790
> 
> 标签：windows, linux, oracle, printing

We have an Oracle DB running on Linux.

When data is ready to report, a value is placed in a table in the DB.

Presently an app is scheduled to run every 10 seconds to check for the value and if it's there it prints out the report. NOT prety.

How can I make this pretty?

I sort of envision the Oracle DB somehow triggering the windows server to print (TCP/IP? Small service listening on windows box) so that the windows app only fires up when it's time to do work.

How would you get the Linux/Oracle system to "signal" the Windows box?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T01:30:35.100

实际上，轮询是一种快速、廉价、有弹性且最重要的实现目标的方法。

远程 db 启动的触发器非常性感，它可以像在 Samba 中使用 Cups 并直接从 Linux 机器打印一样简单。或者它可能像带有错误检查的完整双向 RPC 一样复杂。

无论哪种方式，不要修复没有损坏的东西。

# pattern-matching - 如何识别电子邮件属于现有线程或对话

> ID：288757
> 
> 赞同：17
> 
> 时间：2008-11-13T23:32:53.623
> 
> 标签：pattern-matching, email

我们有一个内部 .NET 案例管理应用程序，可以自动从电子邮件创建一个新案例。我希望能够识别与原始电子邮件相关的其他电子邮件，以便我们可以防止创建重复案例。

我观察到许多（但不是全部）电子邮件都有一个看起来很有用的线程索引标题。

有人知道我们可以使用的简单算法或包吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-13T23:46:48.353

据我所知，不会有 100% 万无一失的解决方案，因为并非所有电子邮件客户端或网关都保留或尊重所有标头。

但是，您将通过以下方式获得相当高的命中率：

*   每封电子邮件都应该有一个唯一的“Message-ID”字段。找到这个，并将其作为案例的一部分记录下来。（见[RFC-822](https://www.rfc-editor.org/rfc/rfc822)）

*   如果您收到两条消息 ID 相同的消息，请丢弃第二条消息，因为它是重复的。

*   检查“In-Reply-To”字段，如果显示的 ID 与已知的 Message-ID 匹配，则您知道该电子邮件是相关的。

*   “References”和“Original-Message-ID”标头具有相似的含义。

如果您的系统曾经生成电子邮件，请在主题行中包含 CaseID#，以便您在收到电子邮件时搜索它（例如：[Case#20081114-01]）；大多数人在回复时不会编辑主题行。

互联网标准[RFC-822](https://www.rfc-editor.org/rfc/rfc822)、[RFC-2076](https://www.rfc-editor.org/rfc/rfc2076)和[RFC-4021](https://www.rfc-editor.org/rfc/rfc4021)可能有助于进一步阅读。

鉴于总会有遗漏的消息（无论出于何种原因），您可能还需要案例管理系统中的相关功能 - 例如，“作为重复案例关闭”或“与重复案例合并”，以及用于使查找重复项更容易。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-13T23:50:41.183

使用[JWZ 线程算法](http://www.jwz.org/doc/threading.html)。

# hibernate - Java/JSP web app中的丰富交互

> ID：288761
> 
> 赞同：1
> 
> 时间：2008-11-13T23:33:18.537
> 
> 标签：hibernate, jsp, user-interface, struts, user-experience

我正在使用 Struts 和 Hibernate 在 JSP 中编写一个网站。我正在寻找一种实现丰富 UI 的方法，在其中您可以拥有的不仅仅是按钮。例如，拖放、下拉列表会在您输入更多字母时实时更新等。有没有办法将 Swing 与 Struts 和 Hibernate 一起使用？或者是否有任何其他选项可用于制作丰富的 UI？（如果有更好的选择，我愿意放弃 Struts 和/或 Hibernate）

**基本问题：**我工作的组织对我们可以使用或不可以使用哪些开发工具和开源库有严格的规定，并且在更新他们的批准列表方面非常缓慢。AJAX 的所有东西（例如 GWT、dojo）都没有在列表中。

*感谢您花时间阅读这篇文章！*

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T23:37:02.337

您始终可以将 Adob​​e Flex 之类的东西用于您的 UI 部分，并为其提供基于 Java 的后端......

新的 JavaFX 技术怎么样？IceFaces 还是 RichFaces (JSF)？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T23:38:22.737

首先，Struts 和 Hibernate 的使用对 UI 的交互性没有影响，因为它们都是服务器端技术。

除非您可以使用 GWT、OpenLaszlo 或 Flex 之类的技术，否则您能够实现丰富的用户界面的唯一方法是自己用原始 JavaScript 编写它。如果您可以说服您的组织允许您使用 JavaScript 库，例如 JQuery 或 Prototype，这将容易得多。

# c++ - STL::Map - Walk through list or use find?

> ID：288775
> 
> 赞同：2
> 
> 时间：2008-11-13T23:38:02.443
> 
> 标签：c++, performance, stl, iterator, find

Say I have a method that needs to pull 8 values from a map with 100 elements in it. Which do you think would be preferable:

Walk in a for loop from begin to end once, pulling the elements out by switching on the key?

Or using find 8 times to get those values?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T23:44:23.863

Walking the list will take you O(n) time to find a random element.

Map is a balanced binary tree, so doing a find is O(log n).

Thus doing 8 finds results in 8*log2(n) and walking the list is (n). The larger the list, the larger the gains, but in all *random* cases doing finds will be faster than doing iterations.

In non-random cases if there is reason to thing the items you want are near each other in the tree, or near the "begining" (left side) then walking/iterating would be faster. But that seems unlikey.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T00:26:04.653

虽然我会选择这个`find`选项，但人们对渐近性能施加了太多压力。

事实是，渐近性能对于可以接收相当大的输入的算法来说是一个方便的指南，但即便如此它也不是万无一失的。对于任何合理的输入，渐近性能比另一个算法更差的算法很有可能更快。

然后有时您的输入大小会相当小（甚至是固定的）。在这种情况下，渐近性能几乎没有意义。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T23:44:11.883

I would use find 8 times. It will be less (and more obvious) code.

You should try not make performance judgements based on small numbers since (a) it isn't likely to be a performance bottleneck either way at this size and (b) the numbers may change in the future -- choose the algorithm with the best asymptotic performance.

Note: you mention 'switching' on the key ... that may apply in your case, but in general you can't switch on the key value in a map. Allowing for this would make the code to searching for M items in a map by iteration even more complex.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T03:51:27.050

正如其他人所指出的，我可能只会在地图上使用 find() 八次并完成它。但是根据您的需要，可以考虑另一种选择。如果地图中的项目在地图构建后不会发生太大变化，或者您不需要将插入与查找交错，您可以尝试将键/值对保留在排序向量中。如果这样做，则可以使用 lower_bound() 函数在对数时间内进行二进制搜索。这样做的好处是，如果您要查找的键可以排序（并且您知道它们将始终存在），那么您可以使用从前一个查找返回的迭代器作为下一个查找的下限。例如，

```
矢量::迭代器 a = my_map.lower_bound(my_map.begin(), my_map.end(), "a");
矢量::迭代器 b = my_map.lower_bound(a + 1, my_map.end(), "b");
向量::迭代器 c = my_map.lower_bound( b + 1, my_map.end(), "c" );
// ...

```

两种方法都有对数查找，但这有助于在一定程度上减少常数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T00:51:05.663

8个finds最好，因为代码更简单明了。

不过，考虑性能更有趣，所以我也会这样做。

正如 Artelius 在我写这个答案时所说，忽略复杂性。这无关紧要，因为您知道 n=100。例如，插入排序的算法复杂度比快速排序更差（至少在平均情况下），但在几乎所有实现中，对于小的 n，插入排序都比快速排序快，因此快速排序在接近尾声时突破为插入排序。您的 n 也很小，因此 n -> infinity 的限制并不重要。

由于这两个选项的代码都很容易编写，我建议对其进行分析。这将 (a) 告诉你哪个更快，并且 (b) 证明两者都非常快，以至于你做什么都没有关系（除非它是你的程序唯一做的事情，而且它做了很多事情）。尤其是当您谈论打开密钥时-如果密钥是整数类型，则限制因素更有可能是内存缓存问题，而不是任何实际处理。

然而，如果做不到这一点，通常比较搜索算法的方法是计算比较，假设它们比遍历结构要慢得多。如果不出意外，每次比较都会访问内存并且是一个不可预测的分支，这是 CPU 通常最不擅长的两件事。

如果您在开始之前对 8 个元素进行排序（大约需要 24 次比较）而不是您建议的开关，那么由于地图也已排序，您只需在遍历的每个节点上进行一次比较，以及每个项目进行一次比较您正在搜索（比较每个“边”的一个节点。如果它们匹配，则两边都增加。如果它们不匹配，则用较小的元素增加边）。所以在最坏的情况下是 8+100，或者如果你在结束之前找到所有 8 个，则更少。但是 8 个中最后一个的平均位置，如果它们随机位于地图中，仍然是大约 8/9 的位置。所以称它为 8+88+24 = 120 次比较，最坏的情况是 132 次。最好的情况是 8（如果您要搜索的东西都在开头）+24（用于初始排序）= 32 次比较，

红黑树（通常是映射）中节点的平均深度略高于 log2(n)。在这种情况下称它为 7，因为 2^7 是 128。所以找到 8 个元素应该进行 56 次比较。IIRC 红黑树的平衡特性是最深节点不超过最浅节点深度的两倍。所以最坏的情况深度是 floor(2*log2(n))，称之为 15，总共 120，最好的是 ceil(1/2 log2(n))，即 4。这又是 32 次比较。

因此，假设比较是唯一影响速度的因素，那么 8 次发现的速度将是线性遍历的 4 倍和 4 倍之间，平均要好 2 倍。

但是，线性遍历可能会触及更多内存，因此可能会更慢。但最终对于 n=100 你说的是毫秒时间，所以只要做最简单的代码（可能是 8 个发现）。我有没有提到如果你真的想知道你无法预测的速度，你只需要分析它吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T03:39:15.543

如果这很关键，我会同时实施并基准测试性能。

理论上是不是

8 * lg(100) >?< 100

其他考虑因素是这些数字中的任何一个是否会改变——它是否会超过 100 个元素？你会做超过 8 次搜索吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T23:44:29.107

下面是对它们的时间复杂度的分析（n 是地图中的项目数），它保证以对数或更好的时间复杂度对 find 进行查找：

```
8 * log2 n 8 次查找
n 用于遍历所有
```

对于较小的数字，第一个较大（例如，n=2 时为 8），但在 43 左右，第一个将变得比第二个更好并保持不变。所以，你会想要使用第一种方法，因为它也更方便编码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T23:44:59.323

您应该使用 find 8 次。

将切换方法视为获取每个节点并将其比较 8 次。那是 800 次比较，你完全失去了被键控的地图的所有好处，它也可能是一个列表。

通过 find 方法，您可以利用地图的优势遍历列表。我相信 std::maps 是作为二叉树实现的，这意味着搜索键只需将您的键与树的深度进行比较，对于 100 个元素的二叉树，深度为 8~。现在，您只需 8*8 次比较或 64 次比较即可找到所有 8 个元素。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-14T19:31:03.983

让我们假设当它找到密钥时“find”保释。

让我们进一步假设您对“开关”进行了明智的编码，并且在找到匹配项后退出检查。一旦找到所有 8 个，我们还将假设您*不必*费心编写代码以在整个过程中保释（编写代码可能会很痛苦）。

“8 find”方法可以预期（iow：平均而言）执行 50 * 8 = 400 次比较。

“切换”方法可以预期（iow：平均而言）执行 (8 * 100) - 28 = 772 次比较。

因此，在比较方面，8 finds 方法更好。但是，比较的数量足够少，您最好选择更容易理解的选项。不过，这也可能是 8 find 方法。

# asp.net-mvc - MVC actions, should I create 2 actions for logging in?

> ID：288779
> 
> 赞同：1
> 
> 时间：2008-11-13T23:40:46.057
> 
> 标签：asp.net-mvc, model-view-controller

In asp.net mvc, I want to create a action for login.

So this is how I am doing it:

1.  create a action/view named login that simply displays the view.

2.  create another action, named login2 that will be the page that handles the form post and checks the database if the username/password are correct. If it is, redirect to somepage, if not, redirect back to the login page with the appropriate error message.

Is this the best way to do this?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T23:45:22.163

您可以创建两个登录操作，一个用于查看，一个用于表单发布。然后用 AcceptVerbs 属性装饰它们以描述它们将接受哪种方法。有关示例，请参见此处[http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx](http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T20:46:42.780

这是我使用的模式：

```
 /// <summary>
    /// Displays the Login screen the first time
    /// to anyone who wishes to view it.
    /// </summary>
    /// <returns></returns>
    [AcceptVerbs(HttpVerbs.Get)]
    public ActionResult Login()
    {
        return View();
    }

    /// <summary>
    /// Handles the form postback
    /// </summary>
    /// <returns></returns>
    [AcceptVerbs(HttpVerbs.Post)]
    [ValidateAntiForgeryToken]
    public ActionResult Login(string name, 
                              string password, 
                              string ReturnUrl)
    {
        // perform authentication here

        if (string.IsNullOrEmpty(ReturnUrl))
            return RedirectToAction("Index", "Main");

        return Redirect(ReturnUrl);
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T02:21:14.563

我同意克雷格的观点；但是，如果您想以其他方式进行操作，您应该提出一些命名约定来区分您的 ActionMethods 并坚持使用它们。

在预览 5 之前我使用

登录 => 验证创建 => 插入编辑 => 更新

等等

# c# - C# 是否优化字符串文字的连接？

> ID：288794
> 
> 赞同：56
> 
> 时间：2008-11-13T23:46:40.037
> 
> 标签：c#, .net, performance, optimization

例如，编译器是否知道翻译

```
string s = "test " + "this " + "function"; 
```

到

```
string s = "test this function"; 
```

从而避免字符串连接对性能的影响？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-11-13T23:51:41.823

是的。这是由 C# 规范保证的。它在第 7.18 节（C# 3.0 规范）中：

> 只要表达式满足上面列出的要求，就会在编译时评估该表达式。即使表达式是包含非常量结构的较大表达式的子表达式也是如此。

（“上面列出的要求”包括应用于两个常量表达式的 + 运算符。）

另请参阅[此问题](https://stackoverflow.com/questions/242695/long-strings)。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-14T00:47:11.680

只是一个相关主题的旁注 - C# 编译器还将使用“ `+`”运算符“优化”涉及非文字的多个连接，以对 String.Concat() 方法的多参数重载进行一次调用。

所以

```
string result = x + y + z; 
```

编译成相当于

```
string result = String.Concat( x, y, z); 
```

而不是更天真的可能性：

```
string result = String.Concat( String.Concat( x, y), z); 
```

没有什么惊天动地的，只是想在关于字符串字面连接优化的讨论中添加这一点。我不知道这种行为是否是语言标准规定的。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-13T23:58:45.660

是的。

C# 不仅优化了字符串字面量的串联，它还将等效的字符串字面量折叠成常量，并使用指针来引用对同一常量的所有引用。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-01-14T19:50:47.330

是的 - 您可以使用 ILDASM 明确地看到这一点。

例子：

这是一个类似于您的示例的程序，后跟已编译的 CIL 代码：

注意：我使用 String.Concat() 函数只是为了查看编译器如何处理这两种不同的连接方法。

**程序**

```
class Program
{
    static void Main(string[] args)
    {
        string s = "test " + "this " + "function";
        string ss = String.Concat("test", "this", "function");
    }
} 
```

**伊尔达斯姆**

```
.method private hidebysig static void  Main(string[] args) cil managed
{
  .entrypoint
  // Code size       29 (0x1d)
  .maxstack  3
  .locals init (string V_0,
           string V_1)
  IL_0000:  nop
  IL_0001:  ldstr      "test this function"
  IL_0006:  stloc.0
  IL_0007:  ldstr      "test"
  IL_000c:  ldstr      "this"
  IL_0011:  ldstr      "function"
  IL_0016:  call       string [mscorlib]System.String::Concat(string,
                                                              string,
                                                              string)
  IL_001b:  stloc.1
  IL_001c:  ret
} // end of method Program::Main 
```

请注意编译器在 IL_0001 处如何创建常量“测试此函数”，而不是编译器如何处理 String.Concat() 函数 - 它为每个 .Concat() 参数创建一个常量，然后调用 .Concat()功能。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-13T23:59:48.420

从马口中：

> 连接是将一个字符串附加到另一个字符串末尾的过程。当您使用 + 运算符连接字符串文字或字符串常量时，编译器会创建一个字符串。不会发生运行时连接。但是，字符串变量只能在运行时连接。在这种情况下，您应该了解各种方法的性能影响。

[http://msdn.microsoft.com/en-us/library/ms228504.aspx](http://msdn.microsoft.com/en-us/library/ms228504.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-13T23:52:13.647

我相信答案是肯定的，但是您必须查看编译器吐出的内容...只需编译并在其上使用反射器 :-)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-02-11T11:38:02.487

我有一个类似的问题，但关于 VB.NET 而不是 C#。验证这一点的最简单方法是在 Reflector 下查看已编译的程序集。

答案是 C# 和 VB.NET 编译器都优化了字符串文字的连接。

# c# - 如何以编程方式使用终端服务

> ID：288796
> 
> 赞同：1
> 
> 时间：2008-11-13T23:47:39.117
> 
> 标签：c#, .net, remote-desktop, terminal-services

我想使用我的程序（C# .NET）访问远程服务器并在连接用户的上下文中执行一个程序，就像使用远程桌面一样。

我不想只使用某些用户帐户（如 RunAs）运行程序，而是希望有一个单独的执行会话，如远程桌面

我想应该以某种方式使用终端服务，但我不确切知道。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T01:49:52.490

你应该看看这个开源项目： http: [//www.codeplex.com/Terminals](http://www.codeplex.com/Terminals)
它使用终端服务 ActiveX 客户端 (mstscax.dll) 做了很多有趣的事情。

只需下载项目并查看源代码，我相信它会为您提供执行所需的所有信息。

# java - 为什么这个正则表达式会杀死 Java 正则表达式引擎？

> ID：288800
> 
> 赞同：16
> 
> 时间：2008-11-13T23:49:45.897
> 
> 标签：java, regex

我有这个天真的正则表达式 "<([\s]|[^<])+?>" （不包括引号）。它看起来很简单，但是当它与下面的 HTML 文本一起工作时，它确实是邪恶的。它将 Java 正则表达式引擎发送到无限循环。

我有另一个正则表达式（“<.+?>”），它做的事情有些相同，但它不会杀死任何东西。你知道为什么会这样吗？

```
<script language="JavaScript" type="text/javascript">
        var numDivs, layerName;
        layerName = "lnavLayer";
        catLinkName = "category";
        numDivs = 2;
        function toggleLayer(layerID){
            if (!(navigator.appName == "Netscape" && navigator.appVersion.substr(0, 1) < 5)){
                thisLayer = document.getElementById(layerName + layerID);
                categoryLink = document.getElementById(catLinkName + layerID);
                closeThem();
                if (thisLayer.className == 'subnavDefault'){
                    thisLayer.className = 'subnavToggled';
                    categoryLink.className = 'leftnavLinkSelectedSection';
                }
            }
        }
        function closeThem(){
            for(x = 0; x < numDivs; x++){
                theLayer = document.getElementById(layerName + (x
+ 1));
                thecategoryLink = document.getElementById(catLinkName + (x + 1));
                theLayer.className = 'subnavDefault';
                thecategoryLink.className = 'leftnavLink';
            }
        } var flag = 0; var lastClicked = 0
    //-->
    </script> 
```

它甚至使用在线 Java 正则表达式工具（例如[www.fileformat.info/tool/regex.htm](http://www.fileformat.info/tool/regex.htm)）或[RegexBuddy](http://www.regexbuddy.com/)之类的实用程序不断循环。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-11-14T10:04:22.287

Java 正则表达式引擎崩溃的原因是正则表达式的这一部分导致堆栈溢出（确实！）：

```
[\s]|[^<] 
```

这里发生的是每个被 \s 匹配的字符也可以被 [^<] 匹配。这意味着有两种方法可以匹配每个空白字符。如果我们用 A 和 B 表示两个字符类：

```
A|B 
```

那么一个由三个空格组成的字符串可以匹配为 AAA、AAB、ABA、ABB、BAA、BAB、BBA 或 BBB。换句话说，这部分正则表达式的复杂度是 2^N。[这将杀死任何对我所说的灾难性回溯](http://www.regular-expressions.info/catastrophic.html "灾难性的回溯")没有任何保护措施的正则表达式引擎。

在正则表达式中使用交替（竖线）时，请始终确保备选方案是互斥的。也就是说，最多可以允许备选方案之一匹配任何给定的文本位。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T00:08:09.107

简单的正则表达式`([\s]|[^<])`表示任何单个字符是空格或不是`<`字符，这是多余的，因为空格字符不是`<`字符。在我看来，你真正的意思是：

```
`"<([^<])+?>"` 
```

我不确定这是否会解决无限循环，但我想我会指出这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T21:17:29.013

另一个问题（除了 Jan 所说的）是你在括号内一次匹配一个字符，相当于这个简化的例子：

```
(.)+ 
```

每次执行这部分正则表达式时，正则表达式引擎必须保存括号内的子表达式匹配的任何内容的开始和结束位置，以防它需要回溯。即使它是非捕获组也是如此，即

```
(?:.)+ 
```

...但是因为它是一个捕获组，所以必须保存更多信息。一次为一个角色经历所有这些变得非常昂贵。将带括号的组内的单个字符与组上的量词`*`或`+`量词相匹配几乎是不正确的。此外，您应该仅在需要捕获某些内容时使用捕获组；否则，使用非捕获品种。

# visual-studio-2008 - MSTEST/Visual Studio 2008 Team Test 如何决定测试方法的执行顺序？

> ID：288805
> 
> 赞同：12
> 
> 时间：2008-11-13T23:52:28.777
> 
> 标签：visual-studio-2008, mstest

我的印象是单元测试类中的测试方法[将按照它们在类文件中出现的顺序执行。](http://www.eggheadcafe.com/articles/visual_studio_2005_unit_test_order_methods.asp)显然这不是真的。它似乎也不完全基于字母顺序。MSTEST 如何决定执行顺序？

编辑：经过一番挖掘，我能够找到答案。见下文。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-14T17:16:54.893

我能够找到答案。

[根据微软员工吉列尔莫·塞拉托的说法](http://social.msdn.microsoft.com/Forums/en-US/vststest/thread/867b3896-5862-4ef0-bf26-ddbd835a02ee/)：

> MSTest 同步执行所有测试，顺序不确定

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-14T06:55:50.350

在测试视图或测试列表编辑器中排序会使它们看起来像是您可以控制的——这只是实现的副产品。我们没有尝试以特定顺序实际执行它们（我们在“允许顺序”和“随机顺序”上来回切换）。

如果你真的需要订单，那就是有序测试的用途。这些在单元测试可用的所有版本中都可用 - 使用“测试/新建测试”菜单，或右键单击测试项目并创建“有序测试”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T11:33:05.420

这很简单。我正在使用这个

C:>mstest /testcontainer:C:\MyTest.dll /resultsfile:C:\MyTestresults.xml

这里的逻辑是默认情况下 mstest 会为您提供一个 .trx 文件。因此，在针对 [/resultfile:] 选项的命令中，通过提供 .xml 扩展名来写入文件名。所以我使用 /resultsfile:C:\MyTestresults.xml 而不是 /resultsfile:C:\MyTestresults.trx

这对我来说很好。请让我知道这对你有没有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-05T14:46:31.383

在我的经验中（我有点辛苦）我尝试了很多关于MStest项目中方法执行顺序的更改顺序的思考。我将尝试描述这些步骤。

1.  您应该确保删除默认的 .testrunco​​nfig 和 .vsmdi 文件。这些文件由 Visual Studio 在创建测试项目时创建。

2.  关闭 Visual Studio 实例并重新打开它。

3.  当 Visual Studio 打开时，您应该打开测试列表编辑器，然后在测试列表部分下创建您自己的列表。创建新的测试列表后，它应该是空的。

4.  转到所有加载的测试部分，然后使用您选择的顺序将任何测试拖到新创建的测试部分。

然后确保检查了您最后创建的测试部分，您可以按运行测试并按您定义的顺序运行它。

我不知道这可能会出错或类似的东西，但它神奇地工作。我们和我的同事对这种方法进行了几次测试。

好锁

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-12-08T20:43:11.300

问题：我想要做的是只运行包含在我的有序测试中的网络测试。我为此目的使用了一个有序的测试，所以我可以按照我需要它们运行的​​特定顺序运行我的 web 测试。我有很多 web 测试，但是我的有序测试包含这些 web 测试的一个子集，我想运行。解决方案：有序测试用于按一定顺序运行一组测试。在 Visual Studio/test 项目中创建 Orderer 测试列表。从测试视图窗口（测试 | Windows | 测试视图）中，选择 OrderedTest 并从那里运行它（您可以右键单击它并选择“运行选择”）。orderedtest 将自动运行包含在其中的所有 webtests。

您将在测试结果窗口 (Test | Windows | Test Results) 中查看结果；双击 OrderedTest，您将在那里看到每个 Web 测试的详细结果。您可以双击每个 webtest，您将能够看到每个 webtest 的详细结果。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T08:21:13.493

有很多方法可以在 VS 中对测试进行排序。使用测试视图和添加额外的列和顺序。我使用 VSMDI 文件，它会按照其中指定的顺序运行它们。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-13T23:53:52.643

它们运行的​​顺序无关紧要......如果您的测试依赖于首先运行的另一个测试，那么您的测试就有缺陷:-)

# c# - 收益回报 == IEnumerable & IEnumerator 吗？

> ID：288808
> 
> 赞同：33
> 
> 时间：2008-11-13T23:53:45.610
> 
> 标签：c#, ienumerable, yield, iterator, ienumerator

是`yield return`实现`IEnumerable`和的捷径`IEnumerator`吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-14T00:01:16.967

是的。

你可以在我的书 C# in Depth 的第 6 章中找到更多相关信息。幸运的是，第 6 章可从[Manning 的网站](http://manning.com/skeet/)[免费](http://www.manning-source.com/books/skeet/Chapter6sample.pdf)获得。

我在这本书的网站上还有[另外](http://csharpindepth.com/Articles/Chapter6/IteratorBlockImplementation.aspx) [两篇文章。](http://csharpindepth.com/Articles/Chapter11/StreamingAndIterators.aspx)

欢迎反馈。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T00:35:56.710

为了加入链接盛会，Raymond Chen 几个月前做了一个关于 C# 迭代器的不错的小系列：

*   [http://blogs.msdn.com/oldnewthing/archive/2008/08/12/8849519.aspx](http://blogs.msdn.com/oldnewthing/archive/2008/08/12/8849519.aspx)
*   [http://blogs.msdn.com/oldnewthing/archive/2008/08/13/8854601.aspx](http://blogs.msdn.com/oldnewthing/archive/2008/08/13/8854601.aspx)
*   [http://blogs.msdn.com/oldnewthing/archive/2008/08/14/8862242.aspx](http://blogs.msdn.com/oldnewthing/archive/2008/08/14/8862242.aspx)
*   [http://blogs.msdn.com/oldnewthing/archive/2008/08/15/8868267.aspx](http://blogs.msdn.com/oldnewthing/archive/2008/08/15/8868267.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T23:57:40.047

是的。请参阅以下内容作为入门

[http://msdn.microsoft.com/en-us/library/dscyy5s0.aspx](http://msdn.microsoft.com/en-us/library/dscyy5s0.aspx)

# url - 从 URL 获取子域

> ID：288810
> 
> 赞同：109
> 
> 时间：2008-11-13T23:54:05.653
> 
> 标签：url, parsing, dns, subdomain

从 URL 获取子域一开始听起来很容易。

```
http://www.domain.example 
```

扫描第一个句点，然后返回“http://”之后的任何内容......

然后你记得

```
http://super.duper.domain.example 
```

哦。所以你想，好吧，找到最后一个句号，回过头来得到之前的一切！

然后你记得

```
http://super.duper.domain.co.uk 
```

你又回到了原点。除了存储所有 TLD 的列表之外，任何人都有什么好主意吗？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-11-14T00:21:58.517

> 除了存储所有 TLD 的列表之外，任何人都有什么好主意吗？

不，因为每个 TLD 在子域、二级域等方面都不同。

请记住，有顶级域、二级域和子域。从技术上讲，除了 TLD 之外的所有内容都是子域。

在 domain.com.uk 示例中，“domain”是子域，“com”是二级域，“uk”是 TLD。

所以这个问题仍然比乍看起来更复杂，这取决于每个 TLD 的管理方式。您需要一个包含所有 TLD 的数据库，其中包括它们的特定分区，以及什么是二级域和子域。不过，没有太多 TLD，因此该列表是可以合理管理的，但收集所有这些信息并非易事。可能已经有这样的列表可用。

看起来[http://publicsuffix.org/](http://publicsuffix.org/)就是这样一个列表 - 适合搜索的列表中的所有常见后缀（.com、.co.uk 等）。解析它仍然不容易，但至少您不必维护列表。

> “公共后缀”是互联网用户可以直接注册姓名的后缀。公共后缀的一些示例是“.com”、“.co.uk”和“pvt.k12.wy.us”。公共后缀列表是所有已知公共后缀的列表。
> 
> 公共后缀列表是 Mozilla 基金会的一项倡议。它可用于任何软件，但最初是为了满足浏览器制造商的需求而创建的。它允许浏览器，例如：
> 
> *   避免为高级域名后缀设置损害隐私的“超级cookies”
> *   在用户界面中突出显示域名最重要的部分
> *   按站点准确排序历史条目

[翻看列表](http://mxr.mozilla.org/mozilla-central/source/netwerk/dns/effective_tld_names.dat?raw=1)，你会发现这不是一个小问题。我认为列表是完成此任务的唯一正确方法...

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-14T00:32:12.503

正如亚当所说，这并不容易，目前唯一实用的方法是使用列表。

即使这样也有例外 - 例如，`.uk`有少数域在该级别立即有效但不在 中`.co.uk`，因此必须将它们添加为例外。

目前主流浏览器都是这样做的——有必要确保`example.co.uk`不能设置 Cookie，`.co.uk`然后将其发送到`.co.uk`.

[好消息是http://publicsuffix.org/](http://publicsuffix.org/)已经有一个列表。

[IETF](https://datatracker.ietf.org/doc/html/draft-pettersen-subtld-structure)还开展了一些工作来创建某种标准，以允许 TLD 声明其域结构的外观。尽管 . 之类的操作有点复杂`.uk.com`，但它的操作就像它是一个公共后缀一样，但不是由`.com`注册表出售的。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-06-06T23:24:55.030

Publicsuffix.org 似乎是这样做的。有很多实现可以轻松解析 publicsuffix 数据文件的内容：

*   Perl:[域::PublicSuffix](https://metacpan.org/pod/Domain::PublicSuffix)
*   Java：http: [//sourceforge.net/projects/publicsuffix/](http://sourceforge.net/projects/publicsuffix/)
*   PHP: [php 域解析器](https://github.com/jeremykendall/php-domain-parser)
*   C#/.NET：[https ://github.com/danesparza/domainname-parser](https://github.com/danesparza/domainname-parser)
*   Python： http: [//pypi.python.org/pypi/publicsuffix](http://pypi.python.org/pypi/publicsuffix)
*   红宝石：[domainatrix](https://github.com/pauldix/domainatrix)，[public_suffix](https://simonecarletti.com/code/publicsuffix-ruby/)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-02-04T14:33:26.550

正如亚当和约翰已经说过的那样，[publicsuffix.org](http://publicsuffix.org/)是正确的方法。但是，如果由于某种原因您不能使用这种方法，这里有一个基于适用于所有领域 99% 的假设的启发式方法：

有一个属性可以区分（不是全部，而是几乎全部）“真实”域与子域和 TLD，这就是 DNS 的 MX 记录。您可以创建一个算法来搜索这个：逐个删除主机名的部分并查询 DNS，直到找到 MX 记录。例子：

```
super.duper.domain.co.uk => no MX record, proceed
duper.domain.co.uk       => no MX record, proceed
domain.co.uk             => MX record found! assume that's the domain 
```

这是php中的一个示例：

```
function getDomainWithMX($url) {
    //parse hostname from URL 
    //http://www.example.co.uk/index.php => www.example.co.uk
    $urlParts = parse_url($url);
    if ($urlParts === false || empty($urlParts["host"])) 
        throw new InvalidArgumentException("Malformed URL");

    //find first partial name with MX record
    $hostnameParts = explode(".", $urlParts["host"]);
    do {
        $hostname = implode(".", $hostnameParts);
        if (checkdnsrr($hostname, "MX")) return $hostname;
    } while (array_shift($hostnameParts) !== null);

    throw new DomainException("No MX record found");
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-12-06T18:43:25.377

对于 C 库（在 Python 中生成数据表），我编写了[http://code.google.com/p/domain-registry-provider/](http://code.google.com/p/domain-registry-provider/)，它既快速又节省空间。

该库使用约 30kB 的数据表和约 10kB 的 C 代码。由于表是在编译时构建的，因此没有启动开销。有关详细信息，请参阅[http://code.google.com/p/domain-registry-provider/wiki/DesignDoc 。](http://code.google.com/p/domain-registry-provider/wiki/DesignDoc)

为了更好地理解表生成代码（Python），从这里开始：[http ://code.google.com/p/domain-registry-provider/source/browse/trunk/src/registry_tables_generator/registry_tables_generator.py](http://code.google.com/p/domain-registry-provider/source/browse/trunk/src/registry_tables_generator/registry_tables_generator.py)

要更好地理解 C API，请参阅：[http ://code.google.com/p/domain-registry-provider/source/browse/trunk/src/domain_registry/domain_registry.h](http://code.google.com/p/domain-registry-provider/source/browse/trunk/src/domain_registry/domain_registry.h)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-06-23T14:53:16.073

如前所述，[公共后缀列表](https://publicsuffix.org/)只是正确解析域的一种方法。对于 PHP，您可以尝试[TLDExtract](https://github.com/layershifter/TLDExtract)。这是示例代码：

```
$extract = new LayerShifter\TLDExtract\Extract();

$result = $extract->parse('super.duper.domain.co.uk');
$result->getSubdomain(); // will return (string) 'super.duper'
$result->getSubdomains(); // will return (array) ['super', 'duper']
$result->getHostname(); // will return (string) 'domain'
$result->getSuffix(); // will return (string) 'co.uk' 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-20T15:54:39.083

刚刚根据 publicsuffix.org 的信息在 clojure 中为此编写了一个程序：

[https://github.com/isaksky/url_dom](https://github.com/isaksky/url_dom)

例如：

```
(parse "sub1.sub2.domain.co.uk") 
;=> {:public-suffix "co.uk", :domain "domain.co.uk", :rule-used "*.uk"} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-09-06T07:24:07.957

# [shell](/questions/tagged/shell "显示标记为“外壳”的问题")和[bash](/questions/tagged/bash "显示标记为“bash”的问题")版本

除了[亚当戴维斯的正确答案](https://stackoverflow.com/a/288864/1765658)，我想发布我自己的这个操作的解决方案。

由于列表很大，因此有许多不同的测试解决方案中的三种......

## 首先以这种方式准备您的 TLD 列表：

```
wget -O - https://publicsuffix.org/list/public_suffix_list.dat |
    grep '^[^/]' |
    tac > tld-list.txt 
```

注意：`tac`将反转列表以确保测试`.co.uk` **之前** `.uk`。

## [posix](/questions/tagged/posix "显示标记为“posix”的问题")外壳版本

```
splitDom() {
    local tld
    while read tld;do
        [ -z "${1##*.$tld}" ] &&
            printf "%s : %s\n" $tld ${1%.$tld} && return
    done <tld-list.txt
} 
```

测试：

```
splitDom super.duper.domain.co.uk
co.uk : super.duper.domain

splitDom super.duper.domain.com
com : super.duper.domain 
```

## [重击](/questions/tagged/bash "显示标记为“bash”的问题")版本

为了减少分叉（避免`myvar=$(function..)`语法），我更喜欢在 bash 函数中设置变量而不是将输出转储到标准输出：

```
tlds=($(<tld-list.txt))
splitDom() {
    local tld
    local -n result=${2:-domsplit}
    for tld in ${tlds[@]};do
        [ -z "${1##*.$tld}" ] &&
            result=($tld ${1%.$tld}) && return
    done
} 
```

然后：

```
splitDom super.duper.domain.co.uk myvar
declare -p myvar
declare -a myvar=([0]="co.uk" [1]="super.duper.domain")

splitDom super.duper.domain.com
declare -p domsplit
declare -a domsplit=([0]="com" [1]="super.duper.domain") 
```

## 更快的[bash](/questions/tagged/bash "显示标记为“bash”的问题")版本：

用同样的准备，然后：

```
declare -A TLDS='()'
while read tld ;do
    if [ "${tld##*.}" = "$tld" ];then
        TLDS[${tld##*.}]+="$tld"
      else
        TLDS[${tld##*.}]+="$tld|"
    fi
done <tld-list.txt 
```

这一步要慢得多，但`splitDom`函数会变得更快：

```
shopt -s extglob 
splitDom() {
    local domsub=${1%%.*(${TLDS[${1##*.}]%\|})}
    local -n result=${2:-domsplit}
    result=(${1#$domsub.} $domsub)
} 
```

## 在我的树莓派上进行测试：

两个[bash](/questions/tagged/bash "显示标记为“bash”的问题")脚本都经过了以下测试：

```
for dom in dom.sub.example.{,{co,adm,com}.}{com,ac,de,uk};do
    splitDom $dom myvar
    printf "%-40s %-12s %s\n" $dom ${myvar[@]}
done 
```

[posix](/questions/tagged/posix "显示标记为“posix”的问题")版本已经过*详细* `for`的循环测试，但是

所有测试脚本产生相同的输出：

```
dom.sub.example.com                      com          dom.sub.example
dom.sub.example.ac                       ac           dom.sub.example
dom.sub.example.de                       de           dom.sub.example
dom.sub.example.uk                       uk           dom.sub.example
dom.sub.example.co.com                   co.com       dom.sub.example
dom.sub.example.co.ac                    ac           dom.sub.example.co
dom.sub.example.co.de                    de           dom.sub.example.co
dom.sub.example.co.uk                    co.uk        dom.sub.example
dom.sub.example.adm.com                  com          dom.sub.example.adm
dom.sub.example.adm.ac                   ac           dom.sub.example.adm
dom.sub.example.adm.de                   de           dom.sub.example.adm
dom.sub.example.adm.uk                   uk           dom.sub.example.adm
dom.sub.example.com.com                  com          dom.sub.example.com
dom.sub.example.com.ac                   com.ac       dom.sub.example
dom.sub.example.com.de                   com.de       dom.sub.example
dom.sub.example.com.uk                   uk           dom.sub.example.com 
```

包含文件读取和`splitDom`循环的完整脚本使用 posix 版本大约需要 2m，使用基于`$tlds`数组的第一个 bash 脚本大约需要 1m29s，但`~22s`使用基于`$TLDS` ***关联数组***的最后一个 bash 脚本。

```
 Posix version     $tldS (array)      $TLDS (associative array)
File read   :       0.04164          0.55507           18.65262
Split loop  :     114.34360         88.33438            3.38366
Total       :     114.34360         88.88945           22.03628 
```

因此，如果填充*关联数组*是一项更艰巨的工作，那么`splitDom`函数会变得更快！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-14T00:54:20.243

它并没有完全解决，但是您可以通过尝试逐个获取域并检查响应来获得有用的答案，即获取“ [http://uk](http://uk) ”，然后获取“ [http://co.uk](http://co.uk) ” ，然后是“ [http://domain.co.uk](http://domain.co.uk) ”。当您收到非错误响应时，您已经获得了域，其余的是子域。

*有时你只需要尝试一下*:)

编辑：

Tom Leys 在评论中指出，某些域仅设置在 www 子域上，这将在上述测试中给我们一个不正确的答案。好点子！也许最好的方法是使用“ [http://www](http://www) ”和“http://”来检查每个部分，然后将其中任何一个的命中都算作域名该部分的命中？我们仍然会错过一些“替代”安排，例如“web.domain.com”，但我已经有一段时间没有遇到其中的一个了 :)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-02-02T00:35:37.617

使用 URIBuilder 然后获取 URIBUilder.host 属性将其拆分为“。”上的数组。你现在有一个域拆分出来的数组。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-03-29T01:09:07.307

```
echo tld('http://www.example.co.uk/test?123'); // co.uk

/**
 * http://publicsuffix.org/
 * http://www.alandix.com/blog/code/public-suffix/
 * http://tobyinkster.co.uk/blog/2007/07/19/php-domain-class/
 */
function tld($url_or_domain = null)
{
    $domain = $url_or_domain ?: $_SERVER['HTTP_HOST'];
    preg_match('/^[a-z]+:\/\//i', $domain) and 
        $domain = parse_url($domain, PHP_URL_HOST);
    $domain = mb_strtolower($domain, 'UTF-8');
    if (strpos($domain, '.') === false) return null;

    $url = 'http://mxr.mozilla.org/mozilla-central/source/netwerk/dns/effective_tld_names.dat?raw=1';

    if (($rules = file($url)) !== false)
    {
        $rules = array_filter(array_map('trim', $rules));
        array_walk($rules, function($v, $k) use(&$rules) { 
            if (strpos($v, '//') !== false) unset($rules[$k]);
        });

        $segments = '';
        foreach (array_reverse(explode('.', $domain)) as $s)
        {
            $wildcard = rtrim('*.'.$segments, '.');
            $segments = rtrim($s.'.'.$segments, '.');

            if (in_array('!'.$segments, $rules))
            {
                $tld = substr($wildcard, 2);
                break;
            }
            elseif (in_array($wildcard, $rules) or 
                    in_array($segments, $rules))
            {
                $tld = $segments;
            }
        }

        if (isset($tld)) return $tld;
    }

    return false;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-05-09T07:54:11.007

您可以使用这个 lib [tld.js: JavaScript API 来处理复杂的域名、子域和 URI。](https://github.com/oncletom/tld.js)

```
tldjs.getDomain('mail.google.co.uk');
// -> 'google.co.uk' 
```

如果您在浏览器中获取根域。您可以使用这个 lib [AngusFu/browser-root-domain](https://github.com/AngusFu/browser-root-domain)。

```
var KEY = '__rT_dM__' + (+new Date());
var R = new RegExp('(^|;)\\s*' + KEY + '=1');
var Y1970 = (new Date(0)).toUTCString();

module.exports = function getRootDomain() {
  var domain = document.domain || location.hostname;
  var list = domain.split('.');
  var len = list.length;
  var temp = '';
  var temp2 = '';

  while (len--) {
    temp = list.slice(len).join('.');
    temp2 = KEY + '=1;domain=.' + temp;

    // try to set cookie
    document.cookie = temp2;

    if (R.test(document.cookie)) {
      // clear
      document.cookie = temp2 + ';expires=' + Y1970;
      return temp;
    }
  }
}; 
```

使用 cookie 很棘手。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-11-28T22:29:40.773

如果您希望从任意 URL 列表中提取子域和/或域，此 python 脚本可能会有所帮助。不过要小心，它并不完美。一般来说，这是一个很难解决的问题，如果您有一个您期望的域白名单，这将非常有帮助。

1.  **从 publicsuffix.org 获取顶级域名**

```
导入请求

url = 'https://publicsuffix.org/list/public_suffix_list.dat'
page = requests.get(url)

域 = []
对于 page.text.splitlines() 中的行：
    如果 line.startswith('//'):
        继续
    别的：
        域 = line.strip()
        如果域：
            域.附加（域）

domain = [d[2:] if d.startswith('*.') else d for d in domain]
print('找到 {} 个域'.format(len(domains)))

```

2.  **构建正则表达式**

```
重新进口

_正则表达式 = ''
对于域中的域：
    _regex += r'{}|'.format(domain.replace('.', '\.'))

subdomain_regex = r'/([^/]*)\.[^/.]+\.({})/.*$'.format(_regex)
domain_regex = r'([^/.]+\.({}))/.*$'.format(_regex)

```

3.  **在 URL 列表上使用正则表达式**

```
FILE_NAME = '' # 将 CSV 文件名放在这里
URL_COLNAME = '' # 把 URL 列名放在这里

将熊猫导入为 pd

df = pd.read_csv(FILE_NAME)
urls = df[URL_COLNAME].astype(str) + '/' # 注意：添加 / 作为帮助正则表达式的技巧

df['sub_domain_extracted'] = urls.str.extract(pat=subdomain_regex, expand=True)[0]
df['domain_extracted'] = urls.str.extract(pat=domain_regex, expand=True)[0]

df.to_csv('extracted_domains.csv', index=False)

```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-09-13T08:03:01.010

为此，我编写了一个 bash 函数，它依赖于[publicsuffix.org](https://publicsuffix.org)数据和一个简单的正则表达式。

在 Ubuntu 18 上安装 publicsuffix.org 客户端：

```
sudo apt install psl 
```

获取域后缀（最长后缀）：

```
domain=example.com.tr
output=$(psl --print-unreg-domain $domain) 
```

`output`是：

```
example.com.tr: com.tr 
```

剩下的就是简单的 bash。从 中提取后缀 (com.tr)`domain`并测试它是否仍然有多个点。

```
# split output by colon
arr=(${output//:/ })
# remove the suffix from the domain
name=${1/${arr[1]}/}
# test
if [[ $name =~ \..*\. ]]; then
  echo "Yes, it is subdomain."
fi 
```

bash 函数中的所有内容：

```
is_subdomain() {
  local output=$(psl --print-unreg-domain $1)
  local arr=(${output//:/ })
  local name=${1/${arr[1]}/}
  [[ $name =~ \..*\. ]]
} 
```

用法：

```
d=example.com.tr
if is_subdomain $d; then
  echo "Yes, it is."
fi 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-12-15T13:37:54.143

```
private String getSubDomain(Uri url) throws Exception{
                        String subDomain =url.getHost();
                        String fial=subDomain.replace(".","/");
                        String[] arr_subDomain =fial.split("/");
                        return arr_subDomain[0];
                    } 
```

第一个索引将始终是 subDomain

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-09-16T08:21:08.477

此代码段返回正确的域名。

InternetDomainName foo = InternetDomainName.from("foo.item.shopatdoor.co.uk").topPrivateDomain(); System.out.println(foo.topPrivateDomain());

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-11-14T01:00:17.283

要与 http:// 一起删除的常见后缀（.co.uk、.com 等）列表，然后您将只有“sub.domain”可以使用，而不是“ [http://sub”。 domain.suffix](http://sub.domain.suffix) "，或者至少我可能会这样做。

最大的问题是可能的后缀列表。[毕竟有很多。](http://publicsuffix.org/)

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2008-11-14T18:25:18.453

快速查看 publicsuffix.org 列表后，您似乎可以通过从最后一个段为两个字符长的域中删除最后三个段（“段”在这里表示两个点之间的部分）来做出合理的近似，假设它是一个国家代码并将进一步细分。如果最后一段是“us”并且倒数第二段也是两个字符，则删除最后四个段。在所有其他情况下，删除最后两个段。例如：

*   [http://www.domain.example](http://www.domain.example)

“example”不是两个字符，所以去掉“domain.example”，留下“www”

*   [http://super.duper.domain.example](http://super.duper.domain.example)

“example”不是两个字符，所以去掉“domain.example”，留下“super.duper”

*   [http://super.duper.domain.co.uk](http://super.duper.domain.co.uk)

“uk”是两个字符（但不是“us”），所以删除“domain.co.uk”，留下“super.duper”

*   [http://foo.pvt.k12.wy.us](http://foo.pvt.k12.wy.us)

“us”是两个字符，就是“us”，加上“wy”也是两个字符，所以去掉“pvt.k12.wy.us”，留下“foo”。

请注意，尽管这适用于迄今为止我在回复中看到的所有示例，但它仍然只是一个合理的近似值。这并不完全正确，尽管我怀疑它与您在没有制作/获取实际列表以供参考的情况下可能得到的一样接近。

# java - RMI 服务器获取旧 IP 地址

> ID：288811
> 
> 赞同：3
> 
> 时间：2008-11-13T23:54:16.840
> 
> 标签：java, spring, rmi

我看到一个奇怪的问题：

我有一台linux机器，在那台机器上安装了JDK1.6，有些业务进行了，几天后不得不更改机器的IP地址。现在几个月后......我正在尝试让一些spring应用程序工作......而且RMI服务器似乎从我的旧IP地址开始......

```
 21:12:45,412 DEBUG [org.springframework.remoting.rmi.RmiServiceExporter] RMI registry access threw exception
java.rmi.ConnectIOException: Exception creating connection to: 192.168.13.55; nested exception is:
        java.net.SocketException: Network is unreachable
        at sun.rmi.transport.tcp.TCPEndpoint.newSocket(TCPEndpoint.java:614)
        at sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:198)
        at sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:184)
        at sun.rmi.server.UnicastRef.newCall(UnicastRef.java:322)
        at sun.rmi.registry.RegistryImpl_Stub.list(Unknown Source)
        at org.springframework.remoting.rmi.RmiServiceExporter.testRegistry(RmiServiceExporter.java:411)
        at org.springframework.remoting.rmi.RmiServiceExporter.getRegistry(RmiServiceExporter.java:391) 
```

有人可以解释这个过程或阐明这里正在发生的事情，或者可能正在发生的事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-16T10:59:30.070

好的，感谢您的回复...我真的很感激...但是我可能喝得太醉了，没有注意到我的 /etc/hosts 文件中的条目将我的主机名绑定到旧 IP 地址...所以只要我删除了...事情就像一个魅力。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T06:07:48.817

您是否检查过您的弹簧配置以确保您在某处没有旧参考？

# delphi - 如何在模态表单处于活动状态时重新绘制父表单？

> ID：288813
> 
> 赞同：2
> 
> 时间：2008-11-13T23:55:03.797
> 
> 标签：delphi

在 Delphi 2006 中，我展示了一个模态表单。该表单中的用户输入可以更改当前可能显示在作为主表单的父表单上的数据。为了反映这些变化，我需要在主窗体上强制重新绘制一些自绘组件。我试图从模态表单中这样做：

```
MainForm := Application.MainForm;
MainForm.Invalidate;
MainForm.Update; 
```

这一点也没有改变。我一直认为表单上的“更新”总是会立即重新绘制 - 显然不是这样。绘画代码本身应该没问题，因为我可以将模态表单移动到那些 ownerdraw 组件上以强制手动重绘。

但是当数据发生变化时，如何以编程方式强制重绘？

**编辑：**我将在下周尝试 Application.ProcessMessages 和 Refresh，感谢您的建议。

很抱歉花了这么长时间来回答，并感谢所有回复的人。调用 Refresh() 是解决方案的一部分，但必须在自定义绘图组件上完成，而不是在它们所在的表单上完成......现在我想接受多个答案 ;-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T10:49:57.563

也许值得一提的是，如果您使用的蒙皮库也会影响事物。我发现我必须刷新皮肤库，而不是表单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T00:12:31.123

更新发送 WM_PAINT 消息。刷新通过执行绘制消息来强制重新绘制控件。尝试 .Refresh 代替。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T01:23:02.230

模态表单上的编辑是否直接写入父表单上的控件？如果是这样，那么它们应该自动更新。

当您将模态表单移到父表单上时，父表单是否“变白”（即停止全部绘制）？如果是这样，那么您调用模态表单的方式还有其他问题，或者正如[Kluge](https://stackoverflow.com/questions/288813/how-to-repaint-a-parent-form-while-a-modal-form-is-active#288819)建议的那样，您正在阻止发送消息（甚至可能是线程问题。）

我对此进行了测试，默认情况下它可以工作。您需要两种形式，一种带有编辑框，另一种带有按钮。然后分配这些事件处理程序：

```
procedure TForm1.Button1Click(Sender: TObject);
begin
  Form2.ShowModal;
end; 
```

和

```
procedure TForm2.Edit1Change(Sender: TObject);
begin
  Form1.Button1.Caption := Edit1.Text;
end; 
```

当您在第二个表单上更改 Edit1 时，它将更改 Form1 上按钮的标题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-08T20:22:16.720

试试下面的代码。只需将此片段插入您自己的代码中，然后随时随地从任何地方调用它（但可能不是从线程，如果不同步可能会变得混乱）。它绘制应用程序中的所有窗口，而不依赖于消息循环来完成。

```
procedure UpdateApplication;
// Updates (repaints where nesc) all windows of the app
  function UpdateWindow(hWnd: HWND; LParam: longint): bool; stdcall;
  begin
    Result := True;
    Windows.UpdateWindow(hWnd);
  end;
begin
  EnumWindows(@UpdateWindow, 0);
end; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T23:57:54.867

您是否有可能在子表单中执行某些操作来阻止消息？是否添加：

```
Application.ProcessMessages; 
```

对你的代码有什么影响？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T08:55:36.297

我猜您的模态表单可能会阻止消息。如果您处于某种循环中，则进行某种处理以尝试使用进度更新主窗体。Application.ProcessMessages 是处理这些消息的一种方式，但恕我直言不是很优雅。当我之前遇到过这类问题时，我已经在 Application.OnIdle 事件中实现了处理。基本上，您需要做的是将您的处理分成小块。因此，假设您正在处理一些循环。将循环的一次迭代作为任务的一部分。将该代码放入具有以下签名的方法中：

```
procedure DoIdle(Sender: TObject; var Done: Boolean); 
```

确保完成设置为 False。如果您的代码以前是：

```
for i := 1 to ProcessCount do
  DoProcess(i); 
```

然后变成：

```
procedure MyDoIdle(Sender: TObject; var Done: Boolean);
begin
  Inc(TaskCount);
  If TaskCount <= ProcessCount then
    DoProcess(TaskCount);
end; 
```

并设置如下：

```
TaskCount := 0;
Application.Idle := MyDoIdle; 
```

每当应用程序空闲时，代码就会运行，并且消息循环正常处理。完成后记得将 Application.OnIdle 设置为 nil。

如果 DoProcess 有点太快，您可以选择每次调用 onidle 进行 5 或 10 次迭代。

# c# - 页面加载时打印 pdf

> ID：288814
> 
> 赞同：0
> 
> 时间：2008-11-13T23:55:08.540
> 
> 标签：c#, asp.net, javascript

我的aspx页面中有这段代码；

```
<a href="javascript:void(0);" onclick=<% Print(); %> title="Print listings">Print</a> 
```

当用户单击它时，它会显示一个链接以将列表打印到 pdf；如您所见，脚本从后面的代码中调用了一个函数。

问题是，当我对此进行编码时，当我转到此页面时，它会在加载时打印为 pdf，我认为它会等待点击，而是执行打印。

问题是什么？提前致谢。

PD。我正在使用 VS2005，并且我使用 iTextSharp 创建 pdf。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T00:10:52.080

您想使用 HyperlinkControl 并将 OnClick 事件处理程序连接到 Print 方法后面的代码。当用户然后单击链接时，页面将返回并引发 OnClick 事件。从那里您可以打印您的 PDF。

在您的示例中，页面加载时正在评估 Print() 函数。任何带有 <% %> 和 <%= %> 括号的东西都会在渲染时进行评估。

做你想做的最好的方法是在你的页面上有一个链接，重定向到一个 ASHX 页面，然后将 PDF 直接输出到响应流中。应该有很多关于如何在这个地方完成的例子（谷歌ashx）。该链接如下所示：

```
<a href="PrintMyPdf.ashx?PageID=<%= CurrentPageId %>">Print</a> 
```

这会将参数“PageID”传递给 ashx，您可以从中确定要打印的页面。<%= %> 语法计算表达式（在这种情况下是代码中的属性，但它可以是方法或论坛）并将结果插入页面的该部分。

因此，如果您的财产是：

```
protected int CurrentPageId { get { return 4; } } 
```

它会将以下内容写入您的页面：

```
<a href="PrintMyPdf.ashx?PageID=4">Print</a> 
```

抢

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T00:30:45.987

```
<a href="javascript:void(0);" onclick=<% Print(); %> title="Print listings">Print</a> 
```

你不能这样做。我知道你在想什么，但这是不可能的，而且（对不起）太天真了。

> **纳米兰达写道：**
> 
> 问题是，当我对此进行编码时，当我转到此页面时，它会在加载时打印为 pdf，我认为它会等待点击，而是执行打印。

这是绝对有道理的。您需要做的是将 Print() 函数的调用放入**不同的**网页，然后在**onclick 事件中****通过 AJAX**调用该网页。

 *** * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T00:07:21.760

从您的代码片段中准确说出发生了什么有点困难，但我假设您将 pdf 文件作为 print() 函数的一部分输出到响应流。这将在加载时显示 pdf，因为后面的代码是在渲染时评估的（就在它将代码发送到浏览器之前），而不是在客户端上评估。

要获得您想要的行为，最好的方法是创建一个 http 处理程序文件 (ashx)，该文件将接受任何所需的参数作为 url 上的请求变量，然后将 pdf 输出到流。

然后，您可以使用正确的参数为 ashx 文件创建一个 href 以显示文档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T01:30:40.717

您只需要有另一个页面来打印 PDF 文档。假设该页面是 printPDF.aspx

您只需将链接更改为

```
<a href="printPDF.aspx" title="Print listings">Print</a> 
```

如果您必须将参数传递给它，那么我会将链接更改为

```
<a href="javascript:void(0);" onlick="javascript:GoToPrint();" title="Print listings">Print</a> 
```

脚本：

```
<script>
    function GoToPrint()
    {
        window.location = 'printPDF.aspx?var1=x&var2=y';
    }
</script> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T23:32:43.577

最后我做到了，我必须明确，首先我使用另一个网页制作了所有报告，根据我收到的回复，我意识到我使用 href 在同一页面内调用报告的方法是不正确的。

所以，我分析了罗伯特瓦格纳的建议，并尝试了这种方法；

```
protected void btnPrint_Click(object sender, EventArgs e)
{
    ...
    string url = GetUrlWithParameters();

    string reportscript = "<script language='JavaScript'>" +
        "window.open('" + url + "', 'CustomPopUp', " +
        "'width=400, height=400, resizable=yes, scrollbars=yes')" +
        "</script>";

    Page.RegisterStartupScript("reportscript", reportscript);
    ... 
```

在 GetUrlWithParameters() 中，我构造并调用 ashx 并在其中生成报告，ashx 根据某些问题接收不同的参数，并且效果非常好。

它执行脚本并完全按照我的需要在另一个窗口中显示 pdf。

谢谢。

# java - 如何从任意位置使用 JDBC 驱动程序

> ID：288828
> 
> 赞同：19
> 
> 时间：2008-11-14T00:02:13.533
> 
> 标签：java, jdbc, driver

我需要测试与数据库的 JDBC 连接。执行此操作的 java 代码应该很简单：

```
DriverManager.getConnection("jdbc connection URL", "username", "password"); 
```

驱动程序管理器将为给定的连接 URL 查找适当的驱动程序。但是我需要能够在运行时加载 JDBC 驱动程序（jar）。即我在运行上述代码片段的java 应用程序的类路径上没有JDBC 驱动程序。

所以我可以使用此代码加载驱动程序，例如：

```
URLClassLoader classLoader = new URLClassLoader(new URL[]{"jar URL"}, this.getClass().getClassLoader());
Driver driver = (Driver) Class.forName("jdbc driver class name", true, classLoader).newInstance(); 
```

但是驱动程序管理器仍然不会接受它，因为我无法告诉它使用哪个类加载器。我尝试设置当前线程的上下文类加载器，但它仍然不起作用。

有人对实现这一目标的最佳方法有任何想法吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-14T01:06:37.660

来自文章[在运行时选择您的 JDBC 驱动程序](http://www.kfu.com/~nsayer/Java/dyn-jdbc.html)；我只是在这里发布代码以供参考。

这个想法是诱使驱动程序管理器认为驱动程序是从系统类加载器加载的。为此，我们使用这个类：

```
public class DelegatingDriver implements Driver
{
    private final Driver driver;

    public DelegatingDriver(Driver driver)
    {
        if (driver == null)
        {
            throw new IllegalArgumentException("Driver must not be null.");
        }
        this.driver = driver;
    }

    public Connection connect(String url, Properties info) throws SQLException
    {
       return driver.connect(url, info);
    }

    public boolean acceptsURL(String url) throws SQLException
    {
       return driver.acceptsURL(url);
    }

    public DriverPropertyInfo[] getPropertyInfo(String url, Properties info) throws SQLException
    {
        return driver.getPropertyInfo(url, info);
    }

    public int getMajorVersion()
    {
        return driver.getMajorVersion();
    }

    public int getMinorVersion()
    {
        return driver.getMinorVersion();
    }

    public boolean jdbcCompliant()
    { 
        return driver.jdbcCompliant();
    }
} 
```

这样，您注册的驱动程序`DelegatingDriver`就是使用系统类加载器加载的类型。您现在只需使用您想要的任何类加载器加载您真正想要使用的驱动程序。例如：

```
URLClassLoader classLoader = new URLClassLoader(new URL[]{"path to my jdbc driver jar"}, this.getClass().getClassLoader());
Driver driver = (Driver) Class.forName("org.postgresql.Driver", true, classLoader).newInstance();
DriverManager.registerDriver(new DelegatingDriver(driver)); // register using the Delegating Driver

DriverManager.getDriver("jdbc:postgresql://host/db"); // checks that the driver is found 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T11:33:05.480

问题是`DriverManager`执行“使用直接调用者的类加载器实例的任务”。[请参阅Java 编程语言的安全编码指南 2.0 版的](http://java.sun.com/security/seccodeguide.html)指南 6-3 。在这种情况下，系统类加载器绝不是特殊的。

只是为了好玩，不久前我写了一篇关于这个主题的博客文章（编辑：现已失效）。[我的解决方案虽然比Nick Sayer 的解决方案](http://www.kfu.com/%7Ensayer/Java/dyn-jdbc.html)更复杂，但更完整，甚至可以使用不受信任的代码工作（编辑：不推荐使用不受信任代码的概念，以便在 Java 17 中删除）。另外 note`URLClassLoader.newInstance`优先于`new URLClassLoader`.

# jquery - 如何从 2.0 asmx Web 服务返回 JSON

> ID：288850
> 
> 赞同：27
> 
> 时间：2008-11-14T00:12:09.347
> 
> 标签：jquery, .net, asp.net, ajax, web-services

我正在使用 .Net framework 2.0 / jQuery 对 2.0 Web 服务进行 Ajax 调用。无论我在 ajax 调用中将 contentType 设置为什么，服务总是返回 XML。我希望它返回 Json！

这是电话：

```
 $(document).ready(function() {
         $.ajax({
            type: "POST",
            url: "DonationsService.asmx/GetDate",
            data: "{}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(msg) {
              // Hide the fake progress indicator graphic.
              $('#RSSContent').removeClass('loading');

              // Insert the returned HTML into the <div>.
              $('#RSSContent').html(msg.d);
            }
          });
        }); 
```

以下是 Fiddler 中的请求标头：

```
POST /DonationsService.asmx/GetDate HTTP/1.1
x-requested-with: XMLHttpRequest
Accept-Language: en-us
Referer: http://localhost:1238/text.htm
Accept: application/json, text/javascript, */*
Content-Type: application/json; charset=utf-8
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; eMusic DLM/4; .NET CLR 2.0.50727)
Host: localhost:1238
Content-Length: 2
Connection: Keep-Alive
Pragma: no-cache 
```

我尝试将 contentType 设置为 'text/json' 并得到相同的结果。

这是网络服务方法：

```
<WebMethod()> _
Public Function GetDate() As String

    'just playing around with Newtonsoft.Json
    Dim sb As New StringBuilder
    Dim sw As New IO.StringWriter(sb)
    Dim strOut As String = String.Empty

    Using jw As New JsonTextWriter(sw)
        With jw
            .WriteStartObject()
            .WritePropertyName("DateTime")
            .WriteValue(DateTime.Now.ToString)
            .WriteEndObject()
        End With
        strOut = sw.ToString
    End Using

    Return strOut

End Function 
```

这是它返回的内容：

```
<?xml version="1.0" encoding="utf-8"?>
<string xmlns="http://DMS.Webservices.org/">{"DateTime":"11/13/2008 6:04:22 PM"}</string> 
```

当我要求 Json 时，有谁知道如何强制 Web 服务返回 Json？

请不要告诉我升级到 .Net Framework 3.5 或类似的东西（我没那么愚蠢）。我需要一个 2.0 解决方案。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-14T05:50:42.860

[在 ASP.NET 2.0 中从 ASMX 服务返回 JSON](http://encosia.com/2010/03/08/asmx-scriptservice-mistakes-installation-and-configuration/)是没有问题的。您只需要安装 ASP.NET AJAX Extensions。

请务必将 [ScriptService] 装饰添加到您的 Web 服务中。这就是指示 ASP.NET AJAX 框架的服务器端部分为格式正确的请求返回 JSON 的原因。

此外，如果您将其与 2.0 一起使用，则在我的示例中，您需要从“msg.d”中删除“.d”。 [“.d”是 3.5 附带的安全功能](http://encosia.com/2009/02/10/a-breaking-change-between-versions-of-aspnet-ajax/)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-03-22T14:37:04.433

响应包含在一个元素中，因为您的方法说它将返回一个字符串。您可以使用它来发送纯 json，但您的 wsdl 会被愚弄（该函数无效但会响应数据）。

```
[WebMethod(Description="return pure JSON")]
public void retrieveByIdToPureJSON( int id )
{
  Context.Response.Write( JsonConvert.SerializeObject( mydbtable.getById(id) );
} 
```

祝你好运，汤姆

顺便说一句：请参阅 Newtonsoft.Json 的 JsonConvert

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-14T01:03:40.320

您需要使用以下内容装饰您的 web 方法：

```
[ScriptMethod(ResponseFormat = ResponseFormat.Json)] 
```

剩下的你都做对了 :) [Encosia](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)和[Andrew Roland 的博客](http://www.andrewrowland.com/article/display/consume-dot-net-web-service-with-jquery)

上的 更多信息

编辑：如下所述，这仅是 .NET 3.5（我不知道这一点，我的错）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T00:20:12.047

您可能无法在 .NET 2.0 中执行 XML 或二进制序列化之外的任何操作。如果您不使用自动生成的 Web 参考，那么不要打扰 ASMX。只需使用 ASPX 或 ASHX 代替。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T02:29:21.520

您可以使用[Jayrock 库](http://jayrock.berlios.de/) [快速入门 asp.net](http://jayrock.berlios.de/#quick-start)

这允许您编写一个 http 处理程序来返回您的 json。

```
<%@ WebHandler Class="JayrockWeb.HelloWorld" %>

namespace JayrockWeb
{
    using System;
    using System.Web;
    using Jayrock.Json;
    using Jayrock.JsonRpc;
    using Jayrock.JsonRpc.Web;

    public class HelloWorld : JsonRpcHandler
    {
        [ JsonRpcMethod("greetings") ]
        public string Greetings()
        {
            return "Welcome to Jayrock!";
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-28T20:01:50.010

也可以使用 Refelction 编写自己的快速 JSON 转换器。

```
Dim sb As New StringBuilder("{")
For Each p As PropertyInfo In myObject.GetType().GetProperties()
    sb.Append(String.Format("""{0}"":""{1}"",", p.Name, p.GetValue(myObject,  
              Nothing).ToString()))
Next p

//remove the last "," because it's uneeded.
sb.Remove(sb.Length - 1, 1)

sb.Append("}") 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T00:23:18.857

我对此可能不是 100% 正确，但我确信 .net 网络服务是基于 XML/SOAP 的。

您需要覆盖 web 服务的默认行为。我不完全确定这是否可能。

我知道这不是最有用的答案，但可能会让你朝着正确的方向前进。

# java - Eclipse 优化导入以包括静态导入

> ID：288861
> 
> 赞同：419
> 
> 时间：2008-11-14T00:19:55.120
> 
> 标签：java, eclipse, keyboard-shortcuts

反正有没有让 Eclipse 自动查找静态导入？例如，现在我终于升级到 Junit 4，我希望能够编写：

```
assertEquals(expectedValue, actualValue); 
```

点击`Ctrl`++并让 Eclipse 添加`Shift`：`O`

```
import static org.junit.Assert.assertEquals; 
```

也许我要求太多了。

* * *

## 回答 #1

> 赞同：586
> 
> 时间：2008-11-14T17:13:18.473

我正在使用 Eclipse Europa，它也有收藏首选项部分：

> 窗口 > 首选项 > Java > 编辑器 > 内容辅助 > 收藏夹

在我的中，我有以下条目（添加时，使用“新类型”并省略`.*`）：

```
org.hamcrest.Matchers.*
org.hamcrest.CoreMatchers.*
org.junit.*
org.junit.Assert.*
org.junit.Assume.*
org.junit.matchers.JUnitMatchers.* 
```

除了第三个之外，所有这些都是静态导入。通过将它们作为收藏夹，如果我键入 " `assertT`" 并点击**`Ctrl`+`Space`**，Eclipse 会提供`assertThat`建议，如果我选择它，它将向文件添加正确的静态导入。

* * *

## 回答 #2

> 赞同：244
> 
> 时间：2008-11-14T05:02:18.747

如果突出显示该方法`Assert.assertEquals(val1, val2)`并点击`Ctrl`++ （添加导入`Shift`）`M`，它会将其添加为静态导入，至少在 Eclipse 3.4 中是这样。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-11-14T09:25:36.297

Eclipse 3.4 在 Window->Preferences->Java->Editor->Content Assist 下有一个收藏夹部分

如果您使用`org.junit.Assert`很多，您可能会发现将其添加到那里有一些价值。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-11-14T00:54:29.107

不完全是我想要的，但我找到了解决方法。在 Eclipse 3.4 (Ganymede) 中，转到

> 窗口->首选项->Java->编辑器->内容辅助

**并选中Use static imports (only 1.5 or higher)**复选框。

这不会在优化导入中引入导入，但如果您在线上执行快速修复 ( `CTRL`+ `1`)，它将为您提供添加静态导入的选项，这已经足够好了。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-03-26T11:09:45.640

来自[静态导入​​的内容辅助](http://help.eclipse.org/indigo/index.jsp?topic=%2Forg.eclipse.jdt.doc.user%2Ftips%2Fjdt_tips.html)

> 要获取静态成员的内容辅助建议，请在“打开收藏夹”首选项页面`Java > Editor > Content Assist > Favorites`首选项页面上配置您的收藏静态成员列表。
> 例如，如果您已将`java.util.Arrays.*`或添加`org.junit.Assert.*`到此列表中，则与完成前缀匹配的此类型的所有静态方法都将添加到提案列表中。

打开`Window » Preferences » Java » Editor » Content Assist » Favorites`

![在此处输入图像描述](https://i.stack.imgur.com/maZT4.png)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-08-23T18:56:55.887

对于 SpringFramework 测试，我建议也添加以下内容

```
org.springframework.test.web.servlet.request.MockMvcRequestBuilders
org.springframework.test.web.servlet.request.MockMvcResponseBuilders
org.springframework.test.web.servlet.result.MockMvcResultHandlers
org.springframework.test.web.servlet.result.MockMvcResultMatchers
org.springframework.test.web.servlet.setup.MockMvcBuilders
org.mockito.Mockito 
```

当您将上面添加为新类型时，它会自动将 .* 添加到包中。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2019-03-09T12:02:43.813

静态导入快捷键：CTRL + SHIFT + M

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-10-12T15:28:44.923

选择常数，输入

```
Ctrl + 1  (quick fix) 
```

选择“转换为静态导入”。从下拉。

“快速修复”有选项，即使它不是错误。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-08-31T00:35:00.187

在 Eclipse 4.9 中，您可以使用快速修复静态导入现有调用。

> 已实施新的快速修复，允许用户将静态字段访问和静态方法转换为使用静态导入。也可以同时替换所有事件。

[更多细节在这里](https://www.eclipse.org/eclipse/news/4.9/jdt.php#convert-to-static-import)

# javascript - 如何编写 JavaScript 模式弹出窗口（替换 Ajax）？

> ID：288867
> 
> 赞同：9
> 
> 时间：2008-11-14T00:22:46.470
> 
> 标签：javascript, modalpopups

我需要用等效的 JavaScript 替换我们的[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29) Modal Popup 控件。我们将其用作简单的上下文相关帮助类型弹出窗口。我快速浏览了一下，但没有看到我要找的东西。我只需要一些文本和一个简单的关闭按钮/链接，但我希望页面在弹出窗口下方变暗，就像使用 Ajax 模态控件一样。

谁能推荐一个你用过的不错的 JavaScript 弹出/帮助类型解决方案？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-14T02:00:32.530

我可以给你代码。根据需要进行修改，好吗？

页面 JavaScript：

```
function myPop() { 
    this.square = null;
    this.overdiv = null;

    this.popOut = function(msgtxt) {
        //filter:alpha(opacity=25);-moz-opacity:.25;opacity:.25;
        this.overdiv = document.createElement("div");
        this.overdiv.className = "overdiv";

        this.square = document.createElement("div");
        this.square.className = "square";
        this.square.Code = this;
        var msg = document.createElement("div");
        msg.className = "msg";
        msg.innerHTML = msgtxt;
        this.square.appendChild(msg);
        var closebtn = document.createElement("button");
        closebtn.onclick = function() {
            this.parentNode.Code.popIn();
        }
        closebtn.innerHTML = "Close";
        this.square.appendChild(closebtn);

        document.body.appendChild(this.overdiv);
        document.body.appendChild(this.square);
    }
    this.popIn = function() {
        if (this.square != null) {
            document.body.removeChild(this.square);
            this.square = null;
        }
        if (this.overdiv != null) {
        document.body.removeChild(this.overdiv);
        this.overdiv = null;
        }

    }
} 
```

现在是 HTML 页面，使用 JavaScript 文件：

```
<html> 
  <head>
    <script type="text/javascript" src="NAME OF THE PAGE!.js"></script>
    <style>
        div.overdiv { filter: alpha(opacity=75);
                      -moz-opacity: .75;
                      opacity: .75;
                      background-color: #c0c0c0;
                      position: absolute;
                      top: 0px;
                      left: 0px;
                      width: 100%; height: 100%; }

        div.square { position: absolute;
                     top: 200px;
                     left: 200px;
                     background-color: Menu;
                     border: #f9f9f9;
                     height: 200px;
                     width: 300px; }
        div.square div.msg { color: #3e6bc2;
                             font-size: 15px;
                             padding: 15px; }
    </style>
  </head>
  <body>
    <div style="background-color: red; width: 200px; height: 300px;
                padding: 20px; margin: 20px;"></div>

    <script type="text/javascript">
        var pop = new myPop();
        pop.popOut("Jose leal");
    </script>
  </body>
</html> 
```

希望这能有所帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-14T01:44:50.487

我使用了 simplemodal jQuery 插件，我对它非常满意。你可以在[这里查看](http://www.ericmmartin.com/projects/simplemodal/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T01:42:45.077

也许你正在寻找这样的[东西](http://ui.jquery.com/repository/latest/demos/functional/#ui.dialog)？[ui.jquery.com]

这是最简单的一种，可以与许多其他眼睛糖果捆绑在一起。当然，您也可以查看[jQuery 插件页面](http://plugins.jquery.com/)的其余部分，特别是[Windows 和 Overlays 部分](http://plugins.jquery.com/project/Plugins/category/43)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-07-28T01:52:13.853

我开发了一个名为[Msg](https://madprops.github.io/Msg/)的 javascript 库。它允许轻松创建模态窗口/弹出窗口。它在其后面创建一个叠加层，使背景变暗。它没有关闭按钮，但可以通过单击背景覆盖来关闭。

# typing - 增加 WPM - 高端

> ID：288874
> 
> 赞同：1
> 
> 时间：2008-11-14T00:27:30.597
> 
> 标签：typing, wpm

我们已经有[这个问题](https://stackoverflow.com/questions/94101/how-to-type-faster)了，但我想把它缩小到已经高速打字的人。

最初的海报已经达到了 75 WPM 的障碍，并想提高他的速度。我处于一个障碍，我可以可靠地输入 130 左右，有时我可以达到 150，这可能取决于文本中单词的分布。

我觉得将速度从这个高端提高到更高的方法可能与从 30 到 60，甚至从 75 到 100 不同。有人有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T00:32:50.757

您需要开始查看硬件...尝试不同的键盘，以获得最适合您的打字方法的反动键盘。我发现自己在某些键盘上打字的速度要快得多，即使它们大小相同但功能相同……按键响应时间略有不同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T01:15:03.807

如果你想学习如何更快地输入你喜欢的语言，我可以建议你学习一门更好的语言吗？

当我一生前打字听写时，我可以在录音机上打字超过 120wpm。当我输入 CI 时很少超过 90wpm，但是当我写 lisp 时，我什至没有达到 50wpm。

你花在打字上的时间并没有花在思考上。

如果您想学习如何更快地打字，学习更快地阅读会有所帮助。[我在使用快速串行视觉呈现](http://en.wikipedia.org/wiki/Rapid_Serial_Visual_Presentation)来提高阅读速度方面取得了巨大成功。

# c# - C#：如何使用下一个和上一个按钮在列表视图中循环浏览项目？

> ID：288875
> 
> 赞同：0
> 
> 时间：2008-11-14T00:28:00.843
> 
> 标签：c#

C#：如何使用下一个和上一个按钮在列表视图中循环浏览项目？

背景：

假设您在列表视图中有 10 个项目。

在列表视图旁边有两个按钮，标题为 previos 和 next。

问题：

单击“下一个”和“上一个”按钮后，您将如何循环浏览这些列表视图项？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T00:43:17.380

如果您只想选择下一个项目（因此对于项目 a、b、c，从 b 选择到 c 选择），您可以这样做：

```
 if (listView.SelectedIndices.Count > 0)
        {
            int oldSelection = listView.SelectedIndices[0];
            listView.SelectedIndices.Clear();

            if (oldSelection + 1 >= listView.Items.Count)
                listView.SelectedIndices.Add(0);
            else
                listView.SelectedIndices.Add(oldSelection + 1);
        } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T01:04:38.523

我想你是说你想实现分页？

如果是这样，只需在索引中记录您当前的页码，当单击下一个按钮时，增加页码，检索该页的记录价值并将其绑定到列表。

如果您实现数据提供者等，则有一种自动执行此操作的方法。查看 ListView 上的文档以了解这是如何完成的。您需要为按钮提供一个特殊的“操作”才能使其工作。

欲了解更多信息：http: [//msdn.microsoft.com/en-us/library/bb515102.aspx](http://msdn.microsoft.com/en-us/library/bb515102.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-13T14:58:07.820

```
int oldSelection = ListView1.SelectedIndices[0];

if(*NextOptionSelected* && oldSelection + 1 < ListView1.Items.Count)
{
     ListView1.Items[oldSelection + 1].Selected = true;
     ListView1.Items[oldSelection + 1].Focused = true;
     ListView1.Items[oldSelection].Selected = false;
     ListView1.Items[oldSelection].Focused = false;
}
else if(*LastOptionSelected* && oldSelection > 0)
{
     ListView1.Items[oldSelection - 1].Selected = true;
     ListView1.Items[oldSelection - 1].Focused = true;
     ListView1.Items[oldSelection].Selected = false;
     ListView1.Items[oldSelection].Focused = false;
}

ListView1.EnsureVisible(ListView1.SelectedIndices[0]); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-13T15:09:09.600

```
//UpOrDown is a +1 or -1
void Page(int UpOrDown){
    //Determine if something is selected
    if (listView.SelectedIndices.Count > 0)
        {
            int oldIndex = listView.SelectedIndices(0);
            listView.SelectedIndices.Clear();

            //Use mod!
            int numberOfItems = listView.Items.Count();
            listView.SelectedIndices.Add((oldIndex + UpOrDown) % numberOfItems)
        }
} 
```

使用`modulus`除法，我觉得人们已经忘记了这个人

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-05-15T09:41:54.307

**将 +1 用于下一个数据，将 -1 用于上一个数据** 这里是代码：-

```
Dim CurrentRow As Integer
CurrentRow = Form2.ListView1.Items.IndexOf(Form2.ListView1.FocusedItem)
CurrentRow =CurrentRow + 1
Form2.ListView1.Items(CurrentRow).Selected = True
Form2.ListView1.Items(CurrentRow).Focused = True 
```

这是在listview中移动到下一行的vb代码1.将listview控件添加到表单2.添加一个按钮到表单3.双击该按钮并右键上面的代码

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-09-29T21:24:01.287

使用 Page 方法测试的方法，null/out of index range-proof：

```
private void Page(int UpOrDown, ListView list)
        {
            //Determine if something is selected
            list.Focus();
            if (list.SelectedIndices.Count == 0)
            {
                if (list.Items.Count > 0)
                {
                    list.Items[0].Selected = true;
                    list.SelectedIndices.Add(0);
                    list.Items[0].Focused = true;
                    list.EnsureVisible(list.Items[0].Index);
                    list.TopItem = list.Items[0];
                }
            }
            if (list.SelectedIndices.Count > 0)
            {
                if (list.SelectedIndices[0] == null)
                {
                    list.SelectedIndices.Add(0);
                }
                int oldIndex = list.SelectedIndices[0];
                list.SelectedIndices.Clear();

                //Use mod!
                int numberOfItems = list.Items.Count;
                if (oldIndex + UpOrDown >= 0 && oldIndex + UpOrDown <= list.Items.Count-1)
                {
                    list.SelectedIndices.Add((oldIndex + UpOrDown)%numberOfItems);
                    list.SelectedItems[0].Selected = true;
                    list.SelectedItems[0].Focused = true;
                    list.EnsureVisible(list.SelectedItems[0].Index);
                    //list.TopItem = list.SelectedItems[0];
                }
            }
        } 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-14T00:35:43.090

如果不对其进行测试，我猜这会起作用：

```
 for(int i=0;i<listView.Items.Count;i++)
      listView.Items[i] 
```

# php - PHP：类方法的进入/退出回调？

> ID：288877
> 
> 赞同：1
> 
> 时间：2008-11-14T00:29:18.050
> 
> 标签：php, logging, methods, callback, stack-trace

有没有一种方法可以设置回调（或自动记录）方法参数、条目和退出，而无需在每个方法中进行显式调用？我基本上想将此信息记录到我的记录器类（它是静态的）中，而不必为每个方法手动执行。

现在我必须在每个方法中调用 Logger::logEntry() 和 Logger::logExit() 来完成此操作。我很想不必这样做：

```
class TestClass {
    public function tester($arg) {
        Logger::logEntry();
        Logger::info('Parameter $arg => ' . $arg);

        // Do some stuff...

        Logger::logExit();
    }
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-14T01:18:54.580

使用包装类。这种方法有以下好处：

*   无需更改您的底层类结构/方法签名
*   更改日志记录？只是更新这个类
*   更新对象调用与将代码插入您要记录的每个类

.

```
class LogWatch {
    function __construct($class)    {
        $this->obj  =   $class;
    }

    function __call($method, $args) {
        if (in_array($method, get_class_methods($this->obj) ) ) {
            Logger::logEntry();
            Logger::info('Parameter '.implode(', ', $args) );

            call_user_func_array(array($this->obj, $method), $args);

            Logger::logExit();

        } else {
            throw new BadMethodCallException();
        }
    }
}

$test = new LogWatch(new TestClass() );
$test->tester();

// you can use instances of `LogWatch()` just like your watched class
// including passing appropriate params:
$test->tester($param1, $param2); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T01:16:23.680

如果你想为了调试而做函数日志记录，你可能需要查看 Xdebug 扩展。在运行时没有很好的方法来拦截函数调用，任何自动拦截都会增加很大的运行时开销。

使用 XDebug，您可以根据需要打开它，以及获得许多其他东西

（因此 XDebug 与 PHPUnit 一起用于进行单元测试和覆盖分析。）

*   [Xdebug](http://www.xdebug.org/docs/execution_trace)
*   [PHPUnit](http://www.phpunit.de/wiki/Documentation)

### __call 的问题

__call 可能看起来是一个有趣的问题解决方案，但这有*3 个*问题，即

*   显着的执行开销。你在做 __call --> call_user_func_array ，这实际上会为每次执行添加不是一个，而是**两个**函数调用。

*   回溯变得难以辨认：您尝试调用的实际函数在 __call 和 call_user_func_array 的海洋中迷失了，这使得回溯变得异常困难，尤其是当您的回溯包含它们的争论列表时。

*   愚蠢的隐藏函数：你将回到 PHP4 风格的函数“隐藏”，通过在函数前面加上 _ 来阻止用户直接调用或看到它，因为如果函数名称恰好被命名为他们不想要的名称，则 __call不会触发，所以你已经有了一个充满了非常可怕的函数名的整个类，开发人员会很想在各个地方直接调用它们。（如果你想稍后摆脱 __call，你将不得不重命名所有这些函数，以免破坏代码！）

因此，如果您使用 php 代码来实现这将导致极其可怕的代码，您的代码库的任何未来用户都*不想*使用。你最好得到一些可以在需要时透明地添加的东西（比如 Xdebug ），并大大减少对代码的污染。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-14T00:33:44.920

你可以使用魔法功能`__call`。当没有函数匹配该名称时，它会被调用。将您的方法重命名为以某些东西为前缀（例如：下划线），并可选择将它们设置为私有/受保护。

```
class TestClass {
    public function __call($function, $args) {
        Logger::logEntry();
        Logger::info('Parameters: ' . implode(", ", $args);

        $localFunc = "_" . $function;
        $return = $this->$localFunc($args);

        Logger::logExit();

        return $return;
    }

    private function _tester() {
        // do stuff...
        return "tester called";
    }
}

 $t = new TestClass();
 echo $t->tester();
 // "tester called" 
```

# c# - 如何防止在 PropertyGrid 中刷新时滚动？

> ID：288893
> 
> 赞同：3
> 
> 时间：2008-11-14T00:35:10.813
> 
> 标签：c#, propertygrid

我在工具应用程序中使用 PropertyGrid 来显示一个窗口来监视远程应用程序中的对象。每隔一秒左右，我就会从应用程序中获取任何已更改成员状态的更新，然后我会更新网格。我调用 Refresh() 进行更改。除了一件事，这一切都很好。

假设对象太高而无法放入网格中，因此有一个滚动条。用户选择了一个网格项目，但也向上滚动到它上方，以便所选项目位于控件底部的下方。

问题是在 Refresh() 控件会自动将网格项目滚动到视图中（奇怪的是，当项目高于控件顶部时它不会这样做）。

我正在寻找一种方法来防止这种情况或保存状态，执行 Refresh()，然后将其设置回来。我尝试在 PropertyGrid 内的 PropertyGridView 中获取底层 VScrollBar，并弄乱“值”，但它不会永久设置。总是弹出，所以项目在视图中。

在滚动期间取消选择该项目是我的后备（自动滚动到视图不会发生没有选择的网格项目）但它有点损害可用性所以我正在寻找另一种方式。

有人遇到类似的事情吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T19:24:36.740

这在 MS PropertyGrid 中是不可能的。该组件有太多无法访问的内部结构，无法为您提供所需的灵活性，并且当您意识到它并不一致时（您在网格下方遇到属性问题，但在网格上方时不会出现问题）。这就是我创建[Smart PropertyGrid.Net](http://www.visualhint.com)的原因。如果您可以选择商业产品，则此网格可以选择存储属性状态并在您对网格执行操作（如 Refresh()）后恢复它们而不会闪烁。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-17T11:23:11.180

我发现了一个有趣的 hack：

您可以手动选择您更改的网格项目，它们将刷新:)

```
var panProp = categ.GridItems[3];
var tiltProp = categ.GridItems[4];
panProp.Select();
tiltProp.Select(); 
```

所以我选择我需要的项目，然后将选择移回

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-18T20:08:50.950

对我来说，以下有所不同：

不要分配新对象。

只需使用新数据更新旧对象的字段。

现在，在刷新时，我的 PropertyGrid 不再滚动，并且还显示更新的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-06-26T12:23:45.197

```
public void SoftRefreshPropertyGrid()
{
     var peMain = propertyGrid.GetType().GetField("peMain", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(propertyGrid)as  System.Windows.Forms.GridItem;
     if (peMain != null)
     {
           var refreshMethod = peMain.GetType().GetMethod("Refresh");
           if (refreshMethod != null)
           {
                  refreshMethod.Invoke(peMain, null);
                  propertyGrid.Invalidate(true);
           }
     }
} 
```

# sql - 在单个语句中更新多个值

> ID：288894
> 
> 赞同：31
> 
> 时间：2008-11-14T00:35:27.880
> 
> 标签：sql, advantage-database-server

我有一个主/明细表，并想根据明细表更新主表中的一些汇总值。我知道我可以像这样更新它们：

```
update MasterTbl set TotalX = (select sum(X) from DetailTbl where DetailTbl.MasterID = MasterTbl.ID)
update MasterTbl set TotalY = (select sum(Y) from DetailTbl where DetailTbl.MasterID = MasterTbl.ID)
update MasterTbl set TotalZ = (select sum(Z) from DetailTbl where DetailTbl.MasterID = MasterTbl.ID) 
```

但是，我想在一个声明中做到这一点，如下所示：

```
update MasterTbl set TotalX = sum(DetailTbl.X), TotalY = sum(DetailTbl.Y), TotalZ = sum(DetailTbl.Z)
from DetailTbl
where DetailTbl.MasterID = MasterTbl.ID group by MasterID 
```

但这不起作用。我也尝试过省略“group by”子句的版本。我不确定我是否遇到了我的特定数据库 (Advantage) 的限制，或者我的 SQL 的限制。大概是后者。任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-14T02:55:47.817

尝试这个：

```
 Update MasterTbl Set
    TotalX = Sum(D.X),    
    TotalY = Sum(D.Y),    
    TotalZ = Sum(D.Z)
 From MasterTbl M Join DetailTbl D
    On D.MasterID = M.MasterID 
```

根据您使用的数据库，如果这不起作用，那么试试这个（这是非标准 SQL，但在 SQL Server 中是合法的）：

```
 Update M Set
    TotalX = Sum(D.X),    
    TotalY = Sum(D.Y),    
    TotalZ = Sum(D.Z)
 From MasterTbl M Join DetailTbl D
     On D.MasterID = M.MasterID 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-14T00:46:17.313

你为什么要在更新语句上进行分组？您确定这不是导致查询失败的部分吗？尝试这个：

```
update 
    MasterTbl
set
    TotalX = Sum(DetailTbl.X),
    TotalY = Sum(DetailTbl.Y),
    TotalZ = Sum(DetailTbl.Z)
from
    DetailTbl
where
    DetailTbl.MasterID = MasterID 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-14T13:06:56.490

在 Oracle 中，解决方案是：

```
UPDATE
    MasterTbl
SET
    (TotalX,TotalY,TotalZ) =
      (SELECT SUM(X),SUM(Y),SUM(Z)
         from DetailTbl where DetailTbl.MasterID = MasterTbl.ID) 
```

不知道你的系统是否允许。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-14T01:56:09.590

您是否尝试过对每个字段进行子查询：

```
UPDATE
    MasterTbl
SET
    TotalX = (SELECT SUM(X) from DetailTbl where DetailTbl.MasterID = MasterTbl.ID),
    TotalY = (SELECT SUM(Y) from DetailTbl where DetailTbl.MasterID = MasterTbl.ID),
    TotalZ = (SELECT SUM(Z) from DetailTbl where DetailTbl.MasterID = MasterTbl.ID)
WHERE
    .... 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T03:13:08.530

尝试这个：

```
update MasterTbl M,
       (select sum(X) as sX,
               sum(Y) as sY,
               sum(Z) as sZ,
               MasterID
        from   DetailTbl
        group by MasterID) A
set
  M.TotalX=A.sX,
  M.TotalY=A.sY,
  M.TotalZ=A.sZ
where
  M.ID=A.MasterID 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-04T21:13:32.537

如果您的数据库支持它，如果通过 LAN 查询，将所有 3 个更新连接到一个 sql 字符串将节省服务器往返行程。因此，如果没有其他工作，这可能会给您带来轻微的改善。典型的 'multi-statement delimiter 是分号，例如：

```
'update x....;update y...;update...z' 
```

# xml - Ruby 中来自/内部（XML）源文件的变量扩展

> ID：288898
> 
> 赞同：1
> 
> 时间：2008-11-14T00:36:18.363
> 
> 标签：xml, ruby

我想要一些稍微“动态”的 XML 源文件。我希望某些元素值是动态的或“可扩展的”。

我从其他来源为这个变量提供了一个值。

```
@Name = 'freezingkiwis' 
```

我想在 XML 文件中提供类似这样的内容：

```
<?xml version="1.0" encoding="UTF-8"?>
<Contact>
    <Name>#{@Name}</Name>
    <Addresses />
    <Phones />
</Contact> 
```

打开/读取文件（可能是 File.new 或 File.read）时，我想“扩展”之前设置的 @Name 变量。

有什么东西可以立即为我做这件事，还是我必须解析这个 XML（现在可能是一个 REXML::Document）并自己手动做这个？

（即可能用这个替换元素值......）

Ĵ

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T00:41:06.870

考虑使用[ERB](http://ruby-doc.org/stdlib/libdoc/erb/rdoc/classes/ERB.html)，一个 Ruby 模板引擎，例如在 Rails 中使用。然后，您可以在标签之间编写任何 Ruby 代码，包括变量替换`<% %>`。另一方面，如果 XML 模板本身可由用户编辑，则不要使用此解决方案 - 这将导致严重的安全漏洞。

# string - 如何在 Perl 中将字符串转换为数字？

> ID：288900
> 
> 赞同：94
> 
> 时间：2008-11-14T00:39:16.140
> 
> 标签：string, perl, floating-point

我有一个包含十进制值的字符串，我需要将该字符串转换为浮点变量。所以我拥有的字符串的一个例子是“5.45”，我想要一个等效的浮点数，所以我可以添加 .1 到它。我在互联网上搜索过，但我只看到如何将字符串转换为整数。

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2008-11-14T00:43:28.770

您根本不需要转换它：

```
% perl -e 'print "5.45" + 0.1;'
5.55 
```

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2011-12-16T19:18:03.463

这是一个简单的解决方案：

示例 1

```
my $var1 = "123abc";
print $var1 + 0; 
```

结果

```
123 
```

示例 2

```
my $var2 = "abc123";
print $var2 + 0; 
```

结果

```
0 
```

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2008-11-14T03:06:57.810

Perl 是一种基于上下文的语言。它不会根据你提供的数据来完成它的工作。相反，它会根据您使用的运算符和使用它们的上下文来确定如何处理数据。如果你做数字之类的事情，你会得到数字：

```
# numeric addition with strings:
my $sum = '5.45' + '0.01'; # 5.46 
```

如果你做字符串之类的事情，你会得到字符串：

```
# string replication with numbers:
my $string = ( 45/2 ) x 4; # "22.522.522.522.5" 
```

Perl 主要弄清楚要做什么，而且大部分是正确的。另一种说法是 Perl 更关心动词而不是名词。

您是否正在尝试做某事但它不起作用？

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-05-14T16:27:42.280

谷歌在搜索 phill 提出的同一个问题（排序浮点数）时将我带到这里，所以我认为尽管线程有点旧，但还是值得发布答案。我是 perl 的新手，并且仍然对它感到困惑，但是 brian d foy 的声明“Perl 更关心动词而不是名词。” 上面真的击中了头上的钉子。在应用排序之前，您不需要将字符串转换为浮点数。您需要告诉 sort 将值排序为数字而不是字符串。IE

```
my @foo = ('1.2', '3.4', '2.1', '4.6');
my @foo_sort = sort {$a <=> $b} @foo; 
```

有关排序的更多详细信息，请参见[http://perldoc.perl.org/functions/sort.html](http://perldoc.perl.org/functions/sort.html)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-08-25T17:22:26.997

据我了解，[int()](http://perldoc.perl.org/functions/int.html)并不是用于指定数据类型的“强制转换”函数，它只是在这里（ab）用于将上下文定义为算术类型。我过去（ab）使用过 (0+$val) 来确保 $val 被视为数字。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-07-14T07:58:59.113

```
$var += 0 
```

可能是你想要的。但是请注意，如果 $var 是字符串，则无法将其转换为数字，您将收到错误消息，并且 $var**将被重置为 0**：

```
my $var = 'abc123';
print "var = $var\n";
$var += 0;
print "var = $var\n"; 
```

日志

```
var = abc123
Argument "abc123" isn't numeric in addition (+) at test.pl line 7.
var = 0 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-14T01:25:45.063

Perl 实际上只有三种类型：标量、数组和散列。甚至这种区别也是有争议的。;) 每个变量的处理方式取决于您对它的处理方式：

```
% perl -e "print 5.4 . 3.4;"
5.43.4

% perl -e "print '5.4' + '3.4';"
8.8 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-08-27T13:58:13.040

在比较中，如果标量是字符串的数字，则会有所不同。而且它并不总是可以确定的。我可以报告一个案例，其中 perl 以“科学”表示法检索了一个浮点数，并在下面使用了相同的几行进行比较：

```
use strict;
....
next unless $line =~ /and your result is:\s*(.*)/;
my $val = $1;
if ($val < 0.001) {
   print "this is small\n";
} 
```

并且这里`$val`没有被解释为数字，例如`"2e-77"`从`$line`. 添加 0（或 0.0 对于优秀的 ole C 程序员）有所帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-30T15:47:38.300

Perl 是弱类型和基于上下文的。许多标量可以被视为字符串和数字，具体取决于您使用的运算符。 `$a = 7*6; $b = 7x6; print "$a $b\n";`
你得到`42 777777`.

然而，有一个微妙的区别。当您将文本文件中的数字数据读入数据结构中，然后使用 进行查看时`Data::Dumper`，您会注意到您的数字被引用了。Perl 在内部将它们视为字符串。
阅读：`$my_hash{$1} = $2 if /(.+)=(.+)\n/;`。
倾倒：`'foo' => '42'`

如果您想要转储中未引用的数字：
阅读：`$my_hash{$1} = $2+0 if /(.+)=(.+)\n/;`。
倾倒：`'foo' => 42`

在`$2+0`Perl 注意到您将 $2 视为数字之后，因为您使用了数字运算符。

我在尝试将两个哈希与`Data::Dumper`.

# optimization - 如何将数字的最后3位转换为0

> ID：288942
> 
> 赞同：4
> 
> 时间：2008-11-14T01:06:48.800
> 
> 标签：optimization, math

如何将数字的最后3位转换为0

示例 3444678 至 3444000

我可以这样做

(int)(3444678/1000) * 1000= 3444000

但是除法和乘法可能代价高昂......

还有什么解决办法？？？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-14T01:10:21.587

你可以试试

```
n - (n % 1000) 
```

但是模运算符可能与除法一样昂贵。无论如何，这听起来很像微优化。这真的是你的瓶颈吗？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T02:03:59.277

换档技巧，然后：

```
n >>= 3;
n -= n % (5 * 5 * 5);
n <<= 3; 
```

它更快吗？疑。

但这是一个有趣的事实：gcc 不为此使用除法/模数：

```
n -= n % 1000; 
```

它乘以一些疯狂的数字（274877907）并做一些其他可能更快的事情。

这个故事的寓意：你的代码对编译器的目的越明显，编译器就越有可能以你从未想过的方式优化它。如果代码更容易被人类理解，那是另一个好处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T01:56:46.327

顺便说一下（你已经在这里得到了很好的输入）。

位操作从不处理十进制数。问题是位的值根本不映射到十进制。使用 BCD 效果很好，但没有人使用它（也许 BigDecimal 会这样做？？？我对此表示怀疑）。

无论如何，您可以使用的一个以 10 为底的技巧是乘以 10 倍，但除非您在 1970 年代的 CPU 上编写程序集，否则它永远不值得；但只是因为它污染了我的记忆库，我会把它贴出来供你娱乐：

```
int mult10(int val) {
    int tmp_2val = val << 1; // double val
    int tmp_8val = val << 3; // 8x val
    return( tmp_2val + tmp_8val ); // 2x + 8x = 10x
} 
```

但是数学协处理器可以做得比这快得多，只是永远不要优化！您甚至考虑执行速度这一事实是一个问题，并且您的“优化”通常可能会减慢系统速度而不是加快系统速度。

我相信您可以使用类似的方法除以 10，但我不会试图弄清楚 - 现在已经晚了 - 如果我没记错的话，它与检查移出的位并添加回值有关在基于他们的价值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T02:21:11.287

如果您正在使用八进制，您可以简单地：

```
x &= ~0777; 
```

如果您正在使用十六进制，您可以简单地：

```
x &= ~0xfff; 
```

但是对于十进制，您可能应该按照 Jesse Beder 建议的方式进行操作：

```
x -= (x % 1000); 
```

大多数系统都有快速整数除法；如果您正在使用的系统不支持此功能，则可以使用[双涉](http://cbfalconer.home.att.net/download/dubldabl.txt)算法快速转换为 bcd。查看关于除以十的部分。

根据您尝试执行的其他操作，在将数字转换为 Avitus 建议的可打印（字符串）格式时，截断可能更容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T01:19:04.750

```
int takeAway(int num)
{
    for (int i = 1; i =< 3; i++)
    {
        num = num/10;
    }

    return num;
}

int addZeroes(int num)
{
    for (int i = 1; i =< 3; i++)
    {
        num = num*10;
    }

    return num;
} 
```

然后你只需调用 takeAway 然后 addZeroes。再简单不过了！

我很想添加一个**int temp = num**然后使用它，但我认为这太多了，即使对于这段代码也是如此。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T01:38:29.907

如果您想四舍五入到任意精度并且您的舍入方法缺乏精度控制，这应该有效：

## 至少在 Perl 中，mod 应该仍然更快

原因如下： ( 10 ** 7 ) * 3 个随机浮点数的样本产生了这个基准：

```
Dividing
Time taken was  7 wallclock secs ( 6.83 usr  0.00 sys +  0.00 cusr  0.00 csys =  6.83 CPU) seconds

Multiplying
Time taken was  7 wallclock secs ( 6.67 usr  0.00 sys +  0.00 cusr  0.00 csys =  6.67 CPU) seconds

Modding
Time taken was  8 wallclock secs ( 7.87 usr  0.00 sys +  0.00 cusr  0.00 csys =  7.87 CPU) seconds

Multiply + Dividing
Time taken was 10 wallclock secs (10.18 usr  0.01 sys +  0.00 cusr  0.00 csys = 10.19 CPU) seconds 
```

但是请注意，这`10 ** 7 * 3`是一个**非常**多的浮点数。我不能使用`10**8`浮点数，因为为了进行公平测试，我必须对所有测试使用相同的浮点数序列，而且许多浮点数**耗尽了我的 4G 内存**

**好的，有点偏题：/**

（仅使用 Int 的 Perl 实现，通常截断而不是舍入）

```
use strict;
use warnings;
use version;
our $VERSION = qv('0.1');

sub xround { 
    my ( $number, $precision ) = @_ ;
    if ( $precision eq 0 )
    {
        return int( $number + .5 ); 
    }
    my $scale = 10 ** abs( $precision ) ;

    $number = $number / $scale if $precision > 0; 
    $number = $number * $scale if $precision < 0; 

    $number = int( $number + .5 );

    $number = $number * $scale if $precision > 0; 
    $number = $number / $scale if $precision < 0; 
    return $number;
}

my $fmt = "%s : %s  ( %s )\n";
my $n = 55555.55555;
for my $i ( -4 .. 4 )
{

    printf $fmt, $n, xround($n, $i), $i; 
} 
```

.

```
55555.55555 : 55555.5556  ( -4 )
55555.55555 : 55555.556  ( -3 )
55555.55555 : 55555.56  ( -2 )
55555.55555 : 55555.6  ( -1 )
55555.55555 : 55556  ( 0 )
55555.55555 : 55560  ( 1 )
55555.55555 : 55600  ( 2 )
55555.55555 : 56000  ( 3 )
55555.55555 : 60000  ( 4 ) 
```

### 使用模数方法

这与上面一样工作，（除了没有舍入）使用整数的模数方法，但仍然适用于舍入到浮点精度（小数点右边的精度有点慢。

```
use strict;
use warnings;
use version;
our $VERSION = qv('0.1');

sub xround {
    my ( $number, $precision ) = @_;
    my $ino = int( $number );
    if ( $precision eq 0 ) {
        return $ino; 
    }
    my $power = 10**$precision;

    if ( $precision > 0 ) {
        return int( $number - ( $number % $power ) );
    }
    return $ino + int( ( $number - $ino ) / $power ) * $power;
}

my $fmt = "%s : %s  ( %s )\n";
my $n = 55555.55555;
for my $i ( -4 .. 4 )
{
    printf $fmt, $n, xround($n, $i), $i; 
} 
```

.

```
55555.55555 : 55555.5555  ( -4 )
55555.55555 : 55555.555  ( -3 )
55555.55555 : 55555.55  ( -2 )
55555.55555 : 55555.5  ( -1 )
55555.55555 : 55555  ( 0 )
55555.55555 : 55550  ( 1 )
55555.55555 : 55500  ( 2 )
55555.55555 : 55000  ( 3 )
55555.55555 : 50000  ( 4 ) 
```

# c# - 如何在 WPF 中保持可缩放、可滚动内容的纵横比？

> ID：288954
> 
> 赞同：39
> 
> 时间：2008-11-14T01:15:23.947
> 
> 标签：c#, .net, wpf, xaml

我对 WPF 相当陌生，并且遇到了一个似乎很难解决的问题。基本上我想要一个可扩展但保持正方形（或任何其他任意）纵横比的 4x4 网格。这实际上看起来很棘手，这让我感到惊讶，因为我认为这是一个相当普遍的要求。

我从这样的网格定义开始：

```
<Grid>
  <Grid.RowDefinitions>
    <Grid.RowDefinition Height="*"/>
    <Grid.RowDefinition Height="*"/>
    <Grid.RowDefinition Height="*"/>
    <Grid.RowDefinition Height="*"/>
  </Grid.RowDefinitions>
  <Grid.ColumnDefinitions>
    <Grid.ColumnDefinition Width="*"/>
    <Grid.ColumnDefinition Width="*"/>
    <Grid.ColumnDefinition Width="*"/>
    <Grid.ColumnDefinition Width="*"/>
  </Grid.ColumnDefinition>
  ...
</Grid> 
```

现在，如果您将其设置为拉伸，它可以填充 Window 或您放入的任何容器。行和列是统一的，但纵横比不固定。

然后我尝试将其放入 StackPanel 以使用可用空间。没有帮助。当我想起 Viewboxes 时，最让我感动的是什么。

```
<StackPanel Orientation="Horizontal">
  <Viewbox>
    <Grid Height="1000" Width="1000"> <!-- this locks aspect ratio -->
      <Grid.RowDefinitions>
        <Grid.RowDefinition Height="*"/>
        <Grid.RowDefinition Height="*"/>
        <Grid.RowDefinition Height="*"/>
        <Grid.RowDefinition Height="*"/>
      </Grid.RowDefinitions>
      <Grid.ColumnDefinitions>
        <Grid.ColumnDefinition Width="*"/>
        <Grid.ColumnDefinition Width="*"/>
        <Grid.ColumnDefinition Width="*"/>
        <Grid.ColumnDefinition Width="*"/>
      </Grid.ColumnDefinition>
      ...
    </Grid>
  </viewbox>
  <Label HorizontalAlignment="Stretch">Extra Space</Label>
</StackPanel> 
```

现在我的内容缩放并保持纵横比。问题是，如果窗口不够宽，我的一些网格就会脱离屏幕。如果是这样的话，我希望能够滚动到它。同样，我可能需要一个最小尺寸，这也可能导致垂直滚动。

现在我尝试将我的 StackPanel 和 Grid （分别）放在适当的 ScrollViewer 容器中，但随后内容不再缩放以适应窗口。它变成全尺寸，这不好。

那么我该怎么做呢？我在吠叫错误的树吗？有没有更好/更简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-11-14T14:31:11.610

您需要将内容（网格）放入[Viewbox](http://msdn.microsoft.com/en-us/library/system.windows.controls.viewbox.aspx)并将[Viewbox.Stretch 属性](http://msdn.microsoft.com/en-us/library/system.windows.controls.viewbox.stretch.aspx)设置为[Stretch.Uniform](http://msdn.microsoft.com/en-us/library/system.windows.media.stretch.aspx)

Viewbox 控件用于拉伸或缩放子元素，并允许您控制子元素的拉伸方式。在此处查看[示例](http://msdn.microsoft.com/en-us/library/system.windows.media.stretch.aspx)。

[![替代文字](https://i.stack.imgur.com/5sBYY.jpg)](https://i.stack.imgur.com/5sBYY.jpg)
[（来源：[microsoft.com](http://i.msdn.microsoft.com/ms635549.img_mmgraphics_stretchenum(en-us,VS.90).jpg)）]

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T14:43:39.213

在这种情况下，最好的选择是[UniformGrid](http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.uniformgrid.aspx)。这仅在您需要 NxN 网格时才有用。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-14T07:16:38.023

您需要`SizeToContent="WidthAndHeight"`在窗口上进行设置以提供您所追求的行为。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2008-11-14T04:54:51.833

为每个 Column 和 RowWidth 放置 0.25* 而不是 *

# winapi - 发送二进制到串口

> ID：288955
> 
> 赞同：0
> 
> 时间：2008-11-14T01:15:32.450
> 
> 标签：winapi, binary, serial-port, hex

将串行字符串字符发送到串行端口。我需要调用 WriteFile(handle, "A", strlen("A"), ...)

但是，如果我想指定并发送一个十六进制或二进制数怎么办？例如，我想发送 WriteFile(handle, 0x41, sizeOf(0x41), ...) ？

有没有允许我这样做的功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T01:19:15.873

如果你只想写一个字节，它仍然需要在一个数组中。

所以你需要：

```
int buffer[1024];
buffer[0] = 42;

WriteFile(handle, buffer, 1); 
```

看到这个： http: [//msdn.microsoft.com/en-us/library/aa365747 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa365747(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T01:20:31.563

有很多方法。

对您来说最直接的方法是 WriteFile(handle, "\x41", 1 ... );

strlen() 是多余的，因为您知道长度。

# algorithm - 随机排序的运行时间

> ID：288966
> 
> 赞同：3
> 
> 时间：2008-11-14T01:24:55.690
> 
> 标签：algorithm, language-agnostic, random, list, sorting

`sorted`给定一个函数，如果在 O(n) 中运行的列表已排序，则返回 True的函数，你将如何描述这种排序的运行时间：

```
def sort(l):
    while not sorted(l): random.shuffle(l) 
```

假设洗牌是完全随机的。

这会用大 O 表示法写吗？还是有其他方法可以对具有随机分量的算法进行分类？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-14T01:56:17.170

该算法称为[Bogosort](http://Wikipedia.Org/wiki/Bogosort "博格排序")。[它是称为拉斯维加斯算法](http://Wikipedia.Org/wiki/Las_Vegas_algorithm "拉斯维加斯算法")的一类算法的一个实例。拉斯维加斯算法是[随机算法](http://Wikipedia.Org/wiki/Randomized_algorithm "随机算法")，它始终保证正确的结果，但不保证计算资源。

Bogosort 的时间复杂度不能直接用[Bachmann-Landau Notation 表示](http://Wikipedia.Org/wiki/Big_O_notation "巴赫曼朗道记法")，因为它具有概率性质。但是，我们*可以*对其[预期](http://Wikipedia.Org/wiki/Expected_value "期望值")的时间复杂度进行说明。Bogosort 的预期时间复杂度为`O(n·n!)`.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-14T01:29:20.813

信不信由你，这里有一个 wiki 条目： [http ://en.wikipedia.org/wiki/Bogosort](http://en.wikipedia.org/wiki/Bogosort)

平均情况：O(N*N!)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T01:57:19.213

平均情况确实是 O(NN!)：

观察正好有 N! N个元素的排列。选择正确的概率正好是 1/N!。因此，根据大数的强定律，洗牌的预期数量是 N!。

另一个因素 N 来自哪里？您必须在每一步检查您选择的排列。这可以通过比较相邻元素来线性完成。因此有一个额外的因子 N。

上面的评论表明 O(g(n)) 表示法是“最坏情况”：

1) 那不是真的。O(g(n)) 的定义是：如果存在一些 c,d 使得 f(n) < c * g(n) + d 对于足够大的 n，f(n) 是 O(g(n)) . 没有什么关于“最坏情况”的。碰巧 g(n) 是一个比 f(n) 更大的函数，但纯数学定义没有说明“case”。

2）对于随机算法，无论如何做“最坏情况”分析是没有意义的。你可以想出一些非常糟糕的执行。

3) 真正糟糕的执行发生在一组度量 0 上（概率论者会说它们“几乎肯定”不会发生）。他们实际上是不可能观察到的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T01:31:37.050

Big-O 表示法假设最坏的情况。在最坏的情况下，这个算法永远不会终止。

# python - 我可以在 Perl 正则表达式中使用命名组来获取哈希结果吗？

> ID：288968
> 
> 赞同：24
> 
> 时间：2008-11-14T01:28:40.050
> 
> 标签：python, regex, perl

是否可以像使用 Python 一样在 Perl 的正则表达式语法中执行命名组匹配？我总是在匹配后将值绑定`$n`到专有名称，因此如果可能的话，我会发现在正则表达式本身中执行此操作更方便。

Python 是这样做的：

```
>>> import re
>>> regex = re.compile(r'(?P<count>\d+)')
>>> match = regex.match('42')
>>> print match.groupdict()
{'count': '42'} 
```

我知道这`?P`表明它是一个特定于 Python 的正则表达式功能，但我希望它以不同的方式在 Perl 中或稍后添加。有没有办法在 Perl 中以类似的方式获取结果哈希？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-11-14T01:40:02.790

Perl 用于`(?<NAME>pattern)`指定名称捕获。您必须使用`%+`哈希来检索它们。

```
$variable =~ /(?<count>\d+)/;
print "Count is $+{count}"; 
```

不过，这仅在 Perl 5.10 及更高版本上受支持。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-14T03:14:48.043

从 Perl 5.10 开始，Perl 正则表达式支持[一些 Python 特性](http://perldoc.perl.org/perlre.html#PCRE%2fPython-Support)，我猜它们是*Python*兼容的正则表达式。Python 版本中有“P”，但所有这些都在 Perl 5.10 中工作。有关详细信息，请参阅[perlre](http://perldoc.perl.org/perlre.html)文档：

定义一个命名的捕获缓冲区。相当于`(?<NAME>pattern)`。

```
(?P<NAME>pattern) 
```

反向引用命名的捕获缓冲区。相当于`\g{NAME}`。

```
(?P=NAME) 
```

对命名捕获缓冲区的子例程调用。相当于`(?&NAME)`。

```
(?P>NAME) 
```

尽管我没有将 Python 兼容性添加到最新版本的[Learning Perl](http://oreilly.com/catalog/9780596520106/)中，但我们确实涵盖了新的 Perl 5.10 功能，包括命名捕获。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-07-07T10:44:31.773

正如几个人所说，perl 5.10 已经命名了组。

但是在以前的 perls 中，您可以做一些事情，虽然不那么方便，但相对来说还不错：

```
my %hash;
@hash{"count", "something_else"} = $string =~ /(\d+)\s*,\s*(\S+)/; 
```

然后你可以使用：

$hash{"count"} 和 $hash{"something_else"}。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-14T01:38:01.310

AFIK [PCRE](http://en.wikipedia.org/wiki/PCRE)将组捕获命名为：

```
(?'NAME'pattern)
(?<NAME>pattern) 
```

你可以在[这里](http://perldoc.perl.org/perlre.html#Extended-Patterns)找到信息。

# c# - 在 LINQ2DataSet 中指定返回行

> ID：288972
> 
> 赞同：1
> 
> 时间：2008-11-14T01:30:25.303
> 
> 标签：c#, .net, linq, linq-to-dataset

我需要从 DataTable 中提取不同的行子集，并且认为 LINQ2DataSets 可能是一种有用且干净的方法，但是似乎无法简单地从 LINQ2DS 查询中识别返回行，如下所示

```
var result = from r in fips.AsEnumerable() select
r.Field<string>("FACILITY_PROCESS_SUB_GROUP_CODE"),
r.Field<string>("PROCESS_SUB_GROUP_NAME"),
r.Field<string>("... 
```

当我在第一个逗号后开始出现错误时。

这是一个正确的假设吗？我将如何绕过它从数据集中返回可以应用 Distinct() 方法的列子集？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T01:39:56.067

您忘记了新的语句和字段名称：

```
var result = from r 
    in fips.AsEnumerable() 
    select new
    {
        FacProcess = r.Field<string>("FACILITY_PROCESS_SUB_GROUP_CODE"),
        GroupName = r.Field<string>("PROCESS_SUB_GROUP_NAME"),
        Item3 = r.Field<string>("Item3")
    }; 
```

您还可以显式声明您将使用一个类型：

```
var result = from r 
    in fips.AsEnumerable() 
    select new MyType("InitClassParams") 
    {
        FacProcess = r.Field<string>("FACILITY_PROCESS_SUB_GROUP_CODE"),
        GroupName = r.Field<string>("PROCESS_SUB_GROUP_NAME"),
        Item3 = r.Field<string>("Item3")
    }; 
```

[Scott Guthrie](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)（微软开发部副总裁）有一些关于 LINQ 的好信息（他谈到了 LINQ to SQL，但其中大部分都适用）。

然后应用 distinct 子句：

```
var result = from r 
    in fips.AsEnumerable() 
    select new
    {
        FacProcess = r.Field<string>("FACILITY_PROCESS_SUB_GROUP_CODE"),
        GroupName = r.Field<string>("PROCESS_SUB_GROUP_NAME"),
        Item3 = r.Field<string>("Item3")
    }
    distinct; 
```

然后将其放入列表或对其进行迭代。在运行以下类似操作之前，不会选择/区分/等：

```
var list = result.ToList()
foreach(var item in result) {} 
```

# mysql - MySQL中日期之间的月差

> ID：288984
> 
> 赞同：98
> 
> 时间：2008-11-14T01:38:08.737
> 
> 标签：mysql, date, datediff, date-arithmetic

我正在寻找计算 2 个日期时间字段之间的月数。

有没有比获取 unix 时间戳和除以 2 592 000（秒）并在 MySQL 中四舍五入更好的方法？

* * *

## 回答 #1

> 赞同：244
> 
> 时间：2012-07-30T07:14:21.773

# 任何给定两个日期之间的月差：

我很惊讶这还没有被提及：

看看 MySQL 中的[***TIMESTAMPDIFF()***](http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html#function_timestampdiff)函数。

这允许您做的是传递两个`TIMESTAMP`或`DATETIME`值（甚至`DATE`MySQL 将自动转换）以及您想要基于差异的时间单位。

您可以`MONTH`在第一个参数中指定为单位：

```
SELECT TIMESTAMPDIFF(MONTH, '2012-05-05', '2012-06-04')
-- Outputs: 0 
```

* * *

```
SELECT TIMESTAMPDIFF(MONTH, '2012-05-05', '2012-06-05')
-- Outputs: 1 
```

* * *

```
SELECT TIMESTAMPDIFF(MONTH, '2012-05-05', '2012-06-15')
-- Outputs: 1 
```

* * *

```
SELECT TIMESTAMPDIFF(MONTH, '2012-05-05', '2012-12-16')
-- Outputs: 7 
```

它基本上获取从参数列表中的第一个日期开始经过的月数。该解决方案会自动补偿每个月 (28,30,31) 的不同天数，并考虑闰年——您不必担心任何这些事情。

* * *

# 精确的月差：

如果您想在经过的月数中引入小数精度，这会稍微复杂一些，但您可以这样做：

```
SELECT 
  TIMESTAMPDIFF(MONTH, startdate, enddate) +
  DATEDIFF(
    enddate,
    startdate + INTERVAL
      TIMESTAMPDIFF(MONTH, startdate, enddate)
    MONTH
  ) /
  DATEDIFF(
    startdate + INTERVAL
      TIMESTAMPDIFF(MONTH, startdate, enddate) + 1
    MONTH,
    startdate + INTERVAL
      TIMESTAMPDIFF(MONTH, startdate, enddate)
    MONTH
  ) 
```

您的日期参数在哪里`startdate`以及`enddate`是来自表中的两个日期列还是来自脚本的输入参数：

例子：

```
With startdate = '2012-05-05' AND enddate = '2012-05-27':
-- Outputs: 0.7097 
```

* * *

```
With startdate = '2012-05-05' AND enddate = '2012-06-13':
-- Outputs: 1.2667 
```

* * *

```
With startdate = '2012-02-27' AND enddate = '2012-06-02':
-- Outputs: 3.1935 
```

* * *

## 回答 #2

> 赞同：108
> 
> 时间：2009-02-18T19:27:37.457

[PERIOD_DIFF](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_period-diff)计算两个日期之间的月份。

例如，要计算 now() 和 your_table 中时间列之间的差异：

```
select period_diff(date_format(now(), '%Y%m'), date_format(time, '%Y%m')) as months from your_table; 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2011-03-01T20:02:05.700

我也使用[PERIOD_DIFF](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_period-diff)。要获取日期的年份和月份，我使用函数 [EXTRACT](http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html#function_extract)：

```
 SELECT PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM NOW()), EXTRACT(YEAR_MONTH FROM time)) AS months FROM your_table; 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-14T01:41:52.567

[DATEDIFF](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_datediff)函数可以为您提供两个日期之间的天数。哪个更准确，因为...你如何定义一个月？（28、29、30 还是 31 天？）

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2018-02-22T10:04:22.397

正如这里的许多答案所示，“正确”答案取决于您的需求。就我而言，我需要*四舍五入到最接近的整数*。

考虑以下示例： 1 月 1 日 -> 1 月 31 日：整整 0 个月，将近 1 个月。1 月 1 日 -> 2 月 1 日？整整1个月，正好1个月。

要获取**整个（完整）**月数，请使用：

```
SELECT TIMESTAMPDIFF(MONTH, '2018-01-01', '2018-01-31');  => 0
SELECT TIMESTAMPDIFF(MONTH, '2018-01-01', '2018-02-01');  => 1 
```

要获得以月为单位的**四舍五入**持续时间，您可以使用：

```
SELECT ROUND(TIMESTAMPDIFF(DAY, '2018-01-01', '2018-01-31')*12/365.24); => 1
SELECT ROUND(TIMESTAMPDIFF(DAY, '2018-01-01', '2018-01-31')*12/365.24); => 1 
```

这精确到 +/- 5 天，范围超过 1000 年。Zane 的回答显然更准确，但对我来说太冗长了。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-08-20T09:27:21.400

我更喜欢这种方式，因为每个人第一眼都会清楚地理解它：

```
SELECT
    12 * (YEAR(to) - YEAR(from)) + (MONTH(to) - MONTH(from)) AS months
FROM
    tab; 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-11-14T02:03:26.173

来自 MySQL 手册：

> PERIOD_DIFF(P1,P2)
> 
> 返回周期 P1 和 P2 之间的月数。P1 和 P2 的格式应为 YYMM 或 YYYYMM。请注意，句点参数 P1 和 P2 不是日期值。
> 
> mysql> SELECT PERIOD_DIFF(200802,200703); -> 11

所以有可能做这样的事情：

```
Select period_diff(concat(year(d1),if(month(d1)<10,'0',''),month(d1)), concat(year(d2),if(month(d2)<10,'0',''),month(d2))) as months from your_table; 
```

其中 d1 和 d2 是日期表达式。

我必须使用 if() 语句来确保月份是一个两位数，例如 02 而不是 2。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-01-27T08:53:00.247

有没有更好的办法？是的。不要使用 MySQL 时间戳。除了它们占用 36 个字节之外，它们使用起来一点也不方便。对于所有日期/时间值，我建议使用 Julian Date 和 Seconds from 午夜。这些可以组合形成一个 UnixDateTime。如果将其存储在 DWORD（无符号 4 字节整数）中，则可以将一直到 2106 的日期存储为自 epoc 以来的秒数，01/01/1970 DWORD max val = 4,294,967,295 - DWORD 可以保存 136 年的秒数

朱利安日期在进行日期计算时非常好用 UNIXDateTime 值在进行日期/时间计算时很好用有，但我想要一目了然的指示。

用一门好的语言可以很快地转换为 Julian 并返回。使用指针我将它降低到大约 900 个 Clks（这当然也是从 STRING 到 INTEGER 的转换）

当您进入使用日期/时间信息的严肃应用程序（例如金融市场）时，朱利安日期是事实上的。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-09-08T21:48:00.147

查询将类似于：

```
select period_diff(date_format(now(),"%Y%m"),date_format(created,"%Y%m")) from customers where.. 
```

给出自在客户记录上创建日期戳以来的日历月数，让 MySQL 在内部进行月份选择。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-11-04T01:18:30.070

```
DROP FUNCTION IF EXISTS `calcula_edad` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `calcula_edad`(pFecha1 date, pFecha2 date, pTipo char(1)) RETURNS int(11)
Begin

  Declare vMeses int;
  Declare vEdad int;

  Set vMeses = period_diff( date_format( pFecha1, '%Y%m' ), date_format( pFecha2, '%Y%m' ) ) ;

  /* Si el dia de la fecha1 es menor al dia de fecha2, restar 1 mes */
  if day(pFecha1) < day(pFecha2) then
    Set vMeses = VMeses - 1;
  end if;

  if pTipo='A' then
    Set vEdad = vMeses div 12 ;
  else
    Set vEdad = vMeses ;
  end if ;
  Return vEdad;
End

select calcula_edad(curdate(),born_date,'M') --  for number of months between 2 dates 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-07-25T15:32:06.370

执行此代码，它将创建一个函数 datedeifference，它将为您提供日期格式 yyyy-mm-dd 的差异。

```
DELIMITER $$

CREATE FUNCTION datedifference(date1 DATE, date2 DATE) RETURNS DATE
NO SQL

BEGIN
    DECLARE dif DATE;
    IF DATEDIFF(date1, DATE(CONCAT(YEAR(date1),'-', MONTH(date1), '-', DAY(date2)))) < 0    THEN
                SET dif=DATE_FORMAT(
                                        CONCAT(
                                            PERIOD_DIFF(date_format(date1, '%y%m'),date_format(date2, '%y%m'))DIV 12 , 
                                            '-',
                                            PERIOD_DIFF(date_format(date1, '%y%m'),date_format(date2, '%y%m'))% 12 , 
                                            '-',
                                            DATEDIFF(date1, DATE(CONCAT(YEAR(date1),'-', MONTH(DATE_SUB(date1, INTERVAL 1 MONTH)), '-', DAY(date2))))),
                                        '%Y-%m-%d');
    ELSEIF DATEDIFF(date1, DATE(CONCAT(YEAR(date1),'-', MONTH(date1), '-', DAY(date2)))) < DAY(LAST_DAY(DATE_SUB(date1, INTERVAL 1 MONTH))) THEN
                SET dif=DATE_FORMAT(
                                        CONCAT(
                                            PERIOD_DIFF(date_format(date1, '%y%m'),date_format(date2, '%y%m'))DIV 12 , 
                                            '-',
                                            PERIOD_DIFF(date_format(date1, '%y%m'),date_format(date2, '%y%m'))% 12 , 
                                            '-',
                                            DATEDIFF(date1, DATE(CONCAT(YEAR(date1),'-', MONTH(date1), '-', DAY(date2))))),
                                        '%Y-%m-%d');
    ELSE
                SET dif=DATE_FORMAT(
                                        CONCAT(
                                            PERIOD_DIFF(date_format(date1, '%y%m'),date_format(date2, '%y%m'))DIV 12 , 
                                            '-',
                                            PERIOD_DIFF(date_format(date1, '%y%m'),date_format(date2, '%y%m'))% 12 , 
                                            '-',
                                            DATEDIFF(date1, DATE(CONCAT(YEAR(date1),'-', MONTH(date1), '-', DAY(date2))))),
                                        '%Y-%m-%d');
    END IF;

RETURN dif;
END $$
DELIMITER; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-14T01:53:05.697

这取决于您希望如何定义月数。回答这个问题：“月份有什么不同：2008 年 2 月 15 日 - 2009 年 3 月 12 日”。它是由明确的 # 天数定义的，这取决于闰年 - 它是什么月份，或者上个月的同一天 = 1 个月。

**天数的计算**：

2 月 15 日 -> 29 日（闰年）= 2008 年 3 月 1 日 + 365 = 2009 年 3 月 1 日。3 月 1 日 -> 3 月 12 日 = 12 天。14 + 365 + 12 = 391 天。总计 = 391 天 /（每月平均天数 = 30）= 13.03333

**月份的计算**：

2008 年 2 月 15 日 - 2009 年 2 月 15 日 = 2 月 12 日 -> 3 月 12 日 = 不到 1 个月 总计 = 12 个月，如果 2 月 15 日 - 3 月 12 日被视为“过去一个月”，则为 13

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-27T07:43:08.063

```
SELECT * 
FROM emp_salaryrevise_view 
WHERE curr_year Between '2008' AND '2009' 
    AND MNTH Between '12' AND '1' 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-05-25T01:41:54.277

我需要精确的月差。尽管 Zane Bien 的解决方案方向正确，但他的第二个和第三个示例给出了不准确的结果。二月的一天除以二月的天数不等于五月的一天除以五月的天数。所以第二个例子应该输出 ((31-5+1)/31 + 13/30 = ) 1.3043 和第三个例子 ((29-27+1)/29 + 2/30 + 3 = ) 3.1701。

我结束了以下查询：

```
SELECT
    '2012-02-27' AS startdate,
    '2012-06-02' AS enddate,
    TIMESTAMPDIFF(DAY, (SELECT startdate), (SELECT enddate)) AS days,
    IF(MONTH((SELECT startdate)) = MONTH((SELECT enddate)), 0, (TIMESTAMPDIFF(DAY, (SELECT startdate), LAST_DAY((SELECT startdate)) + INTERVAL 1 DAY)) / DAY(LAST_DAY((SELECT startdate)))) AS period1,     
    TIMESTAMPDIFF(MONTH, LAST_DAY((SELECT startdate)) + INTERVAL 1 DAY, LAST_DAY((SELECT enddate))) AS period2,
    IF(MONTH((SELECT startdate)) = MONTH((SELECT enddate)), (SELECT days), DAY((SELECT enddate))) / DAY(LAST_DAY((SELECT enddate))) AS period3,
    (SELECT period1) + (SELECT period2) + (SELECT period3) AS months 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-08-31T09:43:32.667

**PERIOD_DIFF() 函数**

一种方法是 MySQL PERIOD_DIFF() 返回两个时期之间的差异。期间应采用相同的格式，即 YYYYMM 或 YYMM。请注意，期间不是日期值。

**代码：**

```
SELECT PERIOD_DIFF(200905,200811); 
```

[![在此处输入图像描述](https://i.stack.imgur.com/MGvQq.png)](https://i.stack.imgur.com/MGvQq.png)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-06-06T12:44:32.530

您可以通过这种方式获得年、月和日：

```
SELECT 
username
,date_of_birth
,DATE_FORMAT(CURDATE(), '%Y') - DATE_FORMAT(date_of_birth, '%Y') - (DATE_FORMAT(CURDATE(), '00-%m-%d') < DATE_FORMAT(date_of_birth, '00-%m-%d')) AS years
,PERIOD_DIFF( DATE_FORMAT(CURDATE(), '%Y%m') , DATE_FORMAT(date_of_birth, '%Y%m') ) AS months
,DATEDIFF(CURDATE(),date_of_birth) AS days
FROM users 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-12-14T09:54:42.430

你也可以试试这个：

```
select MONTH(NOW())-MONTH(table_date) as 'Total Month Difference' from table_name; 
```

或者

```
select MONTH(Newer_date)-MONTH(Older_date) as 'Total Month Difference' from table_Name; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-02-12T13:52:49.773

给出开始日期为 ins_frm 和结束日期为 ins_to 的简单答案

```
SELECT convert(TIMESTAMPDIFF(year, ins_frm, ins_to),UNSIGNED) as yrs,
       mod(TIMESTAMPDIFF(MONTH, ins_frm, ins_to),12) mnths
FROM table_name 
```

享受 ：）））

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-04-25T01:54:45.160

试试这个

```
SELECT YEAR(end_date)*12 + MONTH(end_date) - (YEAR(start_date)*12 + MONTH(start_date)) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-12-05T20:21:23.160

虽然这是一个老话题，但它显示在谷歌的顶部，我没有看到与 Mysql 相关的新问题来计算几个月的差异。我需要一个非常精确的计算，包括月份的分数。

这是为了计算订阅费，例如每月 8 欧元。然后 2 月的 1 天与其他月份相比确实有不同的价格。所以需要计算月份的分数，**这里分数的精度是基于秒的。**

它的作用是在 @from 和 @to 日期之间计算时将计算分成 3 个部分：

1.  @from 和 @from 日历月结束之间的日历月的分数
2.  @from 和 @to 之间的整个日历月数
3.  日历月开始和@to 之间的日历月的分数

例如从 '2021-09-29 12:00:00' 到 '2021-11-07 00:00:00'：

1.  2021 年 9 月末的 1.5 天。9 月确实有 30 天，因此分数为 0.05 个月 (1.5/30)。
2.  2021 年 10 月整整一个月，所以整整一个月
3.  2021 年 11 月开始的 6 天。11 月确实有 30 天，所以派系是 0.2 个月（6/30）。

所以结果是1.25个月。

```
set @from  = '2021-09-29 12:00:00';
set @to    = '2021-11-07 00:00:00';
select 
/* part 1 */ (unix_timestamp(last_day(@from)) + 86400 - unix_timestamp(@from)) / 86400 / day(last_day(@from))
/* part 2 */ + PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM @to), EXTRACT(YEAR_MONTH FROM @from)) - 1 +
/* part 3 */ 1 - (unix_timestamp(last_day(@to)) + 86400 - unix_timestamp(@to)) / 86400 / day(last_day(@to)) 
month_fraction; 
```

完全相同的计算，但现在基于不使用 mysql 变量的人的字段，并且更容易接管您自己的字段：

```
select 
/* part 1 */ (unix_timestamp(last_day(periodStart)) + 86400 - unix_timestamp(periodStart)) / 86400 / day(last_day(periodStart))
/* part 2 */ + PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM periodTill), EXTRACT(YEAR_MONTH FROM periodStart)) - 1 +
/* part 3 */ 1 - (unix_timestamp(last_day(periodTill)) + 86400 - unix_timestamp(periodTill)) / 86400 / day(last_day(periodTill))
month_fraction
from (select '2021-09-29 12:00:00' periodStart, '2021-11-07 00:00:00' periodTill) period 
```

对于我使用的速度优化`unix_timestamp`，它应该执行得很快，因为它能够使用数学计算。以`unix_timestamp`秒为单位返回一个数字。86400 是一天中的秒数。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2010-05-09T09:57:36.820

这个查询对我有用:)

```
SELECT * FROM tbl_purchase_receipt
WHERE purchase_date BETWEEN '2008-09-09' AND '2009-09-09' 
```

它只需要两个日期并检索它们之间的值。

# oracle - SQLDeveloper 是否支持执行脚本？

> ID：288988
> 
> 赞同：27
> 
> 时间：2008-11-14T01:40:00.667
> 
> 标签：oracle, sqlplus, oracle-sqldeveloper

我今天试图遵循一些指示，它从评论开始

```
 REM  In SQLPlus I manually copy in each line and execute it. 
```

很好，我没有 SQLPlus，我有 SQLDeveloper。粘贴的行属于以下类型：

```
 @\\server\dir\dir\dir\commandfile1.txt;
COMMIT; 
```

...ETC。

当我在 SQL 窗口中尝试时，它不喜欢它。我手动打开并粘贴命令，它也不满意。（我有没有提到我对这个应用程序和 Oracle 不太擅长，但是今天其他人都出去了？）那里的文件以如下代码开头：

```
 rem
set echo on
rem
execute procedure_name ('parameter1', 'parameter2'); 
```

一位同事确实有 SQLPlus，我们一起解决了它。但是，有没有办法让我用 SQLDeveloper 做到这一点，所以如果他也出去了，我不会被困住吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2010-09-07T22:20:22.330

在 SQL Developer 中运行脚本：

```
@"\Path\Scriptname.sql" 
```

（如果有空格，你只需要引号）

您可以设置默认路径：工具菜单 > 首选项 > 数据库 > 工作表 > 选择默认路径以查找脚本

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-16T20:52:45.523

我正在查看帮助文件，并在 SQL Developer Concepts and Usage->Using the SQL Worksheet->Script Runner 中找到了如何执行此操作。

基本上，您必须在文件名前加上@。例如@C:\MyScript\Script.sql。

然后，您可以通过这种方式运行一批。请注意，该命令似乎不喜欢文件路径中的空格。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T04:35:50.733

对于您需要运行的每个文件，找到它并将其放入 SQLDeveloper。运行脚本 (F5)，然后提交 (F11)。这适用于某些脚本，但不是全部。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-11-11T13:51:43.530

如今，SQL Developer 附带了另一个名为[sqlcl](http://www.oracle.com/technetwork/developer-tools/sqlcl/overview/index.html)的工具。这有点像 SQLPlus，但实际上是使用 SQL Developer 中的一些位来提供兼容的命令行/脚本类型接口。

您将能够使用它来执行 sqlplus 风格的命令，而无需与 SQL Developer 风格的 GUI 的额外内容作斗争，这可能会让人感到困惑。

在 SQL Developer 所在的位置下查找它。如果您没有它，您可以下载它并将其部署到您的 sqldeveloper 文件夹中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-01-16T20:35:11.673

您可以使用 sqlcl 执行此操作，其方式与使用 SQL PLUS 执行此操作的方式相同，从命令行：

```
sqlcl user/password@host:port:sid @file.sql 
```

文件应该在 sqlcl 所在的同一目录中。

如果您尝试在 sql 文件上执行大量指令，此解决方案是最佳选择。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-11-14T02:33:34.070

这会做到：

```
begin
    procedure_name ('parameter1', 'parameter2');
end;
/ 
```

# c# - VS2008 和 IIS6 之间的 C# 强制转换不同

> ID：288997
> 
> 赞同：2
> 
> 时间：2008-11-14T01:44:16.977
> 
> 标签：c#, visual-studio-2008, iis-6, casting, extension-methods

我有一段 C# 代码将枚举的值按类型添加到下拉列表中。它要求调用它时 T1 是枚举类型，尽管我不能将其指定为类型约束，因为枚举是不可能的特殊情况。这不是主要问题，因为这仅在内部使用并记录在案。

Description 是 System.Enum 的扩展，它返回枚举值的 DescriptionAttribute 的值，如果未指定，则返回值的 ToString。

因此，我必须在 LINQ 语句的 Cast 部分转换为 System.Enum，而不是转换为 T1，否则 Description 扩展不可用。

```
public static void AddEnum<T1>(this System.Web.UI.WebControls.DropDownList me)
{
    Type t = Enum.GetUnderlyingType(typeof(T1));
    var l = Enum.GetValues(typeof(T1))
                .Cast<System.Enum>()
                .Select(x => new ListItem(x.Description(),
                                          Convert.ChangeType(x, t)
                                                 .ToString()));
    me.Items.AddRange(l.ToArray());
} 
```

这很好，在 Visual Studio 2008 的 Web 开发服务器中工作，但在 IIS 6 上运行时失败并出现强制转换异常。它使用不变的硬编码枚举作为填充 ASP 页面的类型参数运行。

> System.InvalidCastException：从 '%namespace.class+nameofenum%' 到 'System.Enum' 的无效转换。在 System.Convert.DefaultToType(IConvertible value, Type targetType, IFormatProvider provider) at System.Convert.ChangeType(Object value, Type conversionType, IFormatProvider provider) at System.Linq.Enumerable.d__b0 `1.MoveNext() at System.Linq.Enumerable.<SelectIterator>d__d`2.MoveNext() 在 System.Linq。 Buffer `1..ctor(IEnumerable`1 source) at System.Linq.Enumerable.ToArray[TSource](IEnumerable`1 source) at AddEnum[T1](DropDownList me)

（命名空间/类名被我掩盖了）

我无法在其他版本的 IIS 上对其进行测试，但开发版本与生产系统不匹配似乎很奇怪。有人知道为什么是这样吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T02:49:50.247

在黑暗中拍摄。其中一个平台运行 3.5 RTM，另一个运行 3.5 SP1。如果是这样，您很可能会遇到 3.5SP1 中引入的破坏性更改，该更改改变了 .Cast() 的操作方式。有关更多详细信息，请参阅这些帖子

*   [http://blogs.msdn.com/ed_maurer/archive/2008/02/16/break-change-in-linq-queries-using-explicitly-typed-range-variables.aspx](http://blogs.msdn.com/ed_maurer/archive/2008/02/16/breaking-change-in-linq-queries-using-explicitly-typed-range-variables.aspx)
*   [http://blogs.msdn.com/dinesh.kulkarni/archive/2008/08/10/net-fx-3-5-sp1-two-perf-improvements-linq-to-objects-and-linq-to- sql.aspx](http://blogs.msdn.com/dinesh.kulkarni/archive/2008/08/10/net-fx-3-5-sp1-two-perf-improvements-linq-to-objects-and-linq-to-sql.aspx)

# flash - Sandy 3D：使用物理创建房间

> ID：288998
> 
> 赞同：1
> 
> 时间：2008-11-14T01:44:30.923
> 
> 标签：flash, actionscript-3, physics, sandy3d

我想知道是否有人可以帮助我开始在 Sandy 3D 中创建房间。我知道我可以生成平面，但我不确定如何实现简单的物理（即玩家不能穿过墙壁）。有没有一种简单的方法可以做到这一点，或者我应该研究一下 WOW（Flash 的 3D 物理引擎）之类的东西？

谢谢，卡梅伦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T11:09:39.003

如果您只想阻止玩家穿过墙壁，您可以考虑使用 2D Maths 进行碰撞检测。

我用这种方法制作了一些[PaperVision 游戏，在我的博客上进行了解释](http://blog.iainlobb.com/2008/08/meta4orce-creating-3d-flash-games-with.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T02:27:27.673

如果它是第一人称系统，即您是相机，那么只需检查相机到墙壁的距离，如果距离小于您预定的人的“脂肪”，请不要朝那个方向移动（即'd normaly be forward ）。如果您使用某种化身（第二/第三人称系统），Shape3d 对象有一个边界框，可用于碰撞测试。**********