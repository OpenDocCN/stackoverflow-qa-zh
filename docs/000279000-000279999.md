# StackOverflow 问答 000279000-000279999

# wcf - 从 Silverlight 应用程序实例化和关闭启用 Silverlight 的 WCF 服务的最佳位置在哪里？

> ID：279001
> 
> 赞同：3
> 
> 时间：2008-11-10T20:07:35.667
> 
> 标签：wcf, silverlight, web-services

使用启用 Silverlight 的 WCF 服务时，实例化服务和调用 CloseAsync() 方法的最佳位置在哪里？

您应该说，每次需要调用服务时都实例化一个实例，还是将实例实例化为将要进行调用的 UserControl 的变量更好？

那么，在哪里调用 CloseAsync 方法更好呢？您是否应该在每个“someServiceCall_completed”事件方法中调用它？或者，如果创建为 UserControl 类的变量，是否有一个地方可以调用它？像 Dispose 方法，或 UserControl 类的等效方法。

谢谢，

杰夫

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T02:14:29.933

你最好只为服务提供一个实例变量。为每个调用创建和销毁服务会产生很多不必要的开销。只需创建变量并调用方法，无需打开它，因为这将在beta 2 中[自动完成](http://blogs.msdn.com/silverlight_sdk/archive/2008/06/04/breaking-changes-for-silverlight-2-beta-2-corrections-and-additions.aspx)（参见第 5 节）。

至于关闭，您是否尝试关闭它以进行清理可能取决于您的应用程序的结构。如果当 UserControl 关闭时整个应用程序正在关闭（用户关闭了浏览器），那么您可能不需要显式关闭它，因为当 Silverlight 主机关闭时一切都会被清理。但是，如果您要创建大量此类用户控件并在保持应用打开的同时关闭它们，那么您可能希望在控件上创建某种关闭方法，该方法将通过调用 CloseAsync 进行清理。

如果所有用户控件都使用相同的服务，那么您可以只创建一个服务包装类，供所有处理调用服务的控件使用。这将使您不必在控件卸载时关闭服务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-15T12:51:33.857

如果您的 SL 客户端中有 2 个并行事件处理程序，您可以执行以下方法来确保只有一个被调用：假设，我们有一个全局客户端变量 App.Client，应用程序中的所有内容都在使用它。现在，控件 1 需要对 MyOperationCompleted 做出反应，控件 2 也是如此。每个控件都使用如下事件处理程序：

```
...
{
    App.Client.MyOperationCompleted += Client_MyOperationCompleted;
    App.Client.MyOperationAsync(...);
}

void Client_MyOperationCompleted(object sender, MyOperationCompletedEventArgs e)
{
    App.Client.MyOperationCompleted -= Client_MyOperationCompleted;
} 
```

因此，如果您在一种情况下订阅了该事件，一旦它返回，您就会删除对该事件的订阅。如果您始终坚持这一点，则其他控件不太可能（但并非不可能）对事件做出反应。请注意，这种方法不是 100% 并发安全的。我仍在尝试提出一种非常安全的方法来做到这一点。但这肯定有帮助。

# php - 为什么我需要使用流行的框架？

> ID：279003
> 
> 赞同：18
> 
> 时间：2008-11-10T20:09:37.020
> 
> 标签：php, frameworks

多年来，我一直是一名 PHP 开发人员，掌握了许多工具；我自己开发的工具，或者我学会信任的免费使用的解决方案。

我最近研究了 CodeIgniter，发现它们有许多类和辅助例程来帮助开发，但在示例中没有看到我无法使用自己的工具轻松完成的任何事情。简单的东西，例如 DB 抽象、电子邮件助手等。有一些与路由相关的有趣代码 - 将 url 映射到正确的控制器；但是，如果您曾经编写过带有漂亮 url 的 MVC 风格的 Web 应用程序，那么自己编写代码也不是特别困难。

即使在浏览了其他一些流行的框架之后，我仍然没有看到任何可以**节省**时间的东西。即使查看论坛，我也看到人们在努力获得为他们工作的工具。我确实理解它们如何对初级开发人员更有用，因为完整的系统设计技能需要一段时间才能完全理解和欣赏。

然而，我经常被告知我应该使用现成的框架来生成我的解决方案，但我仍然不相信。对像我这样的人真正的好处是什么？我只是精英主义者，还是这是一个普遍的看法？

编辑：看看这里的一些答案，我是否应该考虑将我的工具集打包为自己的框架，编写一些文档并发布教程？如果我对采用其他框架犹豫不决，那么打开它并让更多人关注它是否有助于提高我自己的技能/工具？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-10T20:14:04.920

框架有几个优点：

*   你不必写所有的东西。就您而言，这没什么帮助，因为您拥有自己多年来积累的框架。

*   框架提供标准化和经过测试的做事方式。给定框架的用户越多，遇到和编码的边缘情况就越多。您自己的代码可能会，也可能不会，以同样的方式强化战斗。

*   其他人可以被招募到具有标准框架的项目中，并可以访问该框架的文档、示例和经验。您自己的片段可能会或可能不会被完整记录或有使用示例......但其他人最初对它们感到满意的可能性不大。

编辑：

关于打包自己的框架的想法，清理它以供公众使用的好处可能大于让其他人使用它的好处。

原因很简单：您将不得不重新评估您对每个组件的假设、它们如何组合在一起以及每个部分的理解程度。一旦你发布了你的框架，你的成功将在很大程度上取决于它是多么容易启动和运行。

不费吹灰之力就大获成功对于采用来说是必不可少的（这些胜利将鼓励人们进一步深入研究框架）。Ruby on Rails 是一个框架示例，它毫不费力就取得了如此大的成功，然后隐藏了一些功能，这些功能会让刚入门的人不知所措。（RoR 应用程序的质量问题不是重点，重点是采用速度）。

人们采用了一个框架之后，就是关于持续使用的难易程度。像一致的参数使用模式这样的小​​细节在这里起到了重要作用。如果一个类在每个方法上都有很多参数，而另一个类有在调用方法之前需要调用的 setter，那么您将失去用户，因为如果不诉诸文件。

如果易于采用和易于生活的问题都得到了妥善解决，那么您只需要幸运地让人们采用您的框架。如果这些问题没有得到妥善解决，即使是最初对该框架的兴趣也会迅速减弱。原因是有*许多*框架：您需要脱颖而出以获得让其他人使用您的工具包的优势（因为他们理所当然地像您对其他人一样警惕*您的*框架）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-10T21:13:58.950

*这是不*创建自己的框架 的另一个原因。[莱纳斯定律](http://en.wikipedia.org/wiki/Linus%27s_Law)——“只要有足够的眼球，所有的虫子都是浅的”。换句话说，使用给定框架的人越多，它可能就越可靠和无错误。

你见过有多少 Java 的 Web 框架吗？过去，对于任何一个半体面的开发人员/架构师来说，编写自己的自定义 Web 框架是一种时尚。归根结底，其中 95% 看起来像是 Struts（当时最流行的 Java Web 框架）的自定义实现。所以他们基本上创建了一个 Struts 克隆，它是：1）专有的；2）没有很好的记录和测试。

让我们面对现实吧——编写我们自己的客户框架很有趣，但接下来会发生什么呢？自己（或取代你的可怜的灵魂）跟上框架的步伐成为维护负担。维护软件的成本要高得多，尤其是在定制框架方面。公司的业务是解决领域问题还是维护框架？

我忘记是谁说的了，但我曾经听过一句很棒的名言——“创建自己的框架的第一条规则是：不要”。其他人可能已经为此付出了努力，并且可能完成了与您相同的工作。为自己节省时间、精力和测试。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-10T21:09:03.920

这里有很多关于使用框架的优点的评论，当然我认为在很多情况下它们是完全正确的。

然而

所有框架都有一个缺点，即它们有一个可以适应它们的问题域。如果您的问题完全在域范围内，那么使用框架就不是问题，而且大多数情况下，如果您的问题在域之外很明显，所以您不必考虑它。当你试图将一个问题强加到一个不太适合或具有一些不寻常的非标准功能的框架中时，就会出现问题——在这种情况下，你会非常快地完成 90% 的代码，然后花费你所有的时间节省了弄清楚如何弯曲或扩展框架，以便它可以完成一些晦涩的要求。因为在这些情况下，您的解决方案/扩展必须插入到框架中，所以通常比您独立编写它更难编码。

在错误的情况下，这实际上可能是灾难性的。例如，如果客户要求一个您认为适合框架解决方案的项目并且您相应地引用，那么在完成 90% 后您会发现问题，那么您就可以真正上岸了，特别是如果它是客户的某些功能坚持（而且总是如此）。之所以会出现这些问题，是因为从“去”这个词中可能会发现问题所在的地方并不总是很明显，特别是如果您使用的是您不太熟悉的框架（并且您必须不时地这样做）。

这实际上与在项目中部署任何第三方软件时出现的问题相同。根据我自己的经验，我对使用框架或类似工具没有任何疑虑，但如果可以选择，我将始终选择我能找到的最轻、最薄的包装器，它可以满足我的需求。这样我就获得了优势，同时知道如果确实出现问题（并且通常不太可能使用更薄的包装器），那么弄清楚如何解决它们可能比学习广泛的代码库更简单我可以安全地修改它。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-10T20:14:14.827

框架代码可能经过良好测试并且相对没有错误。通过使用它，您可以节省时间测试/维护自己的代码来做同样的事情。

节省的任何时间都是好的。懒惰在编程中得到回报。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-10T20:13:39.523

您将错过的一件事是进入流行框架的所有验证。

您的例程根本没有流行图书馆所拥有的曝光率。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-10T20:12:50.990

你可能有一点....但是我不会低估许多人的力量，例如 phpBB 是就我所关心*的*bb 解决方案使用而言。为什么？因为在他们的支持板上有许多成千上万的帖子，并且许多使用它的人知识渊博并且可以帮助人们解决问题。

因此，在您的情况下，使用流行框架的唯一原因是许多其他人使用它，报告错误，修复并支持它。在您自己的库上获得相同的覆盖率会很棘手。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-10T21:36:05.520

我会在这里反其道而行之，说你应该使用你自己的自定义框架，如果你正在构建的软件是你业务的核心。正如乔尔所说，“[找到依赖关系 - 并消除它们](http://www.joelonsoftware.com/articles/fog0000000007.html)”。如果您只是为您的公司建立一个小网站，而您的企业没有维护网站，那么请继续使用框架。但是，当该网站是您的业务时，您不应该依赖其他人的框架来完成工作。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-10T20:14:09.897

我认为主要原因是当你使用一个通用的框架时，有很多人会立即熟悉你的产品。

除此之外，我认为最重要的是你使用的任何工具都能真正完成工作。如果它碰巧其他人很熟悉，那么这是一个奖励。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-10T20:20:58.307

我同意您应该使用自己的自定义框架。不仅让您更容易理解，而且提供了极致的工作保障！

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-10T20:22:20.880

我能立即想到的三个原因：

*   其他可能需要处理您的项目的开发人员将熟悉一个知名框架
*   一个著名的框架将包含书籍、讨论板和其他专家等资源，可用于查找更多信息
*   经理们通常会有“不要重新发明轮子”的理念。事实上，现有的解决方案可能已经解决了您在创建自己的解决方案时会发现的相同问题。

综上所述，您自己的解决方案可能仍有一席之地。如果没有人开始新事物，我们就没有那么多框架（或脚本语言）可供选择。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-10T20:33:22.837

你本质上拥有的是你自己的框架。因此，这对您来说不是一个节省时间的方法，因为您已经花费了时间来开发框架。如果您没有构建它，那么使用现有框架肯定比使用您自己的框架更容易和更快。

您需要查看的是您的框架是否比其他选项更好，以及您对自己的代码的熟悉程度是否超过让其他人看到它，以及其他人以足够不同的方式使用它的可能性发现和纠正的问题要高得多。

此外，如果您的框架比其他人的框架好得多，您可能会考虑向社区开放您的框架；）

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-10T20:41:16.083

任何有经验的开发人员都可以构建一个框架——具有挑战性的部分是**让其他人相信它是值得使用的**。您需要为计划使用或维护它的人创建文档和教程。您可能需要创建一个演示站点来证明它的有用性，并且实际上可以像预期的那样工作。

仅此一项就可能是一笔可观的投资，不包括可能在两者之间出现的错误。当一切都说完成时，花时间学习另一个框架而不是自己制作框架可能是值得的。

您提到了 CodeIgniter——我个人觉得这是一个非常漂亮的框架——没有比这更多的准系统了。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-10T20:29:54.607

您可能知道：“时间就是金钱”。因此，通过使用带有大量助手的流行框架、网络上的大量代码示例和大型社区，您可以在更短的时间内完成更多工作。

有时使用框架是可以的，因为你变得更有效率，但在一些高级和困难的项目中，它可能会发生，这样框架就会挡住你的路，你必须找到解决方法。

我认为没有明确的答案。您应该权衡利弊，并为您的项目做出正确的决定。

通常我会很快采用流行的框架，但不会在项目的关键部分使用，并且我会及时扩展它们的使用。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-11-10T20:31:53.730

我认为，如果您认为不需要使用框架，那就不要。

我使用框架的原因，例如 Django 用于 python 或 Rails 用于 Ruby 或 Webforms 和 MVC 用于 ASP.net 是因为它们使为它们编写应用程序变得更容易和更快。在 Ruby 和 Python 的情况下，不使用框架会让我发疯。

如果你有一些可行的东西并且认为不需要使用框架，我会说坚持你认为最好的东西。但是，我仍然会跟上框架的更新。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-11-10T20:49:48.607

如果您从头开始并且没有时间编写自己的，我认为它们会更有用。如果您已经拥有多年来开发的代码库，它们的用处可能要小得多，但看看它们做了什么可能仍然有用。

例如，我确信主要的游戏开发商店没有使用第三方工具、引擎和框架，不是因为它们不够用，而是因为它们自 80 年代或其他什么时候就已经构建了自己的。

另外，如果您使用的是现成的组件，则无法在其特定区域内超越它。如果您需要成为某个特定维度的市场领导者，您应该在该维度构建自己的解决方案，这样您才能成为领导者。如果您不需要此功能，则使用与您的一样好的第三方组件可能是一个很好的解决方案，只要它是一个简单的过渡。是时候训练新工具并接受它的特性可能值得也可能不值得。

要考虑的另一件事是，如果您可以构建某些东西，那么您就会真正理解它。否则，你不会。现在，你不需要完全理解使用它们的东西，只要它们“正常工作”，但我们都知道这是怎么回事...... :)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-10T21:40:07.367

你能比公共框架更快、更可靠地解决你遇到的代码问题吗？

如果是，请继续使用您自己的。

如果不是，则找到工作更好的框架并为该项目运行它。

这一切都归结为哪个代码库可以更好地完成工作（对于客户给出的更好的价值。;)）

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-10T23:54:05.537

优点是它已经由多人编写和测试，因此不太可能出现错误。

缺点是它不是专门为您的应用程序构建的，因此很可能性能更差。

总而言之，考虑到您已经拥有自己的，我真的看不出有太多理由使用它……尽管发布该开源代码可能值得，以便其他人能够进行错误检查并提出改进建议。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-11-11T01:29:01.523

缺点。

大多数框架作品不是面向对象的。（代码点火器确实显示出一些承诺）

大多数代码是通过包含完成的。试图追查问题就像在毛衣上拉线，并且必须解开整件衣服才能完全理解创作。

大多数框架作品的文档都写得不好。

大多数框架作品都试图做很多很多事情。

根据我使用框架作品开发的经验，我发现需要 3-6 个月的时间才能掌握代码库。并且只有在那段时间之后，您才会发现您正在尝试将方形钉安装到圆孔中的天气。鉴于大多数 php 项目都希望在这段时间过去之前完成，雇主将花费更多的成本来让任何使用大型“框架”的项目取得成果。

许多 php Frame 作品都是为 php 4 编写的，并且是在不同的环境中编写的。它们已经大大扩展，但正在显示它们的起源。全局约束的使用尤其普遍。我希望 php 6 让他们中的大多数人死亡。代码点火器避开了大部分，但它是新的，并且具有面向对象的部分。

一些框架作品编写了不需要的代码，并导致问题.. 例如：CAKE 有一个最优秀的模型视图控制器，但它的会话处理是一场灾难。不幸的是，框架作品不是以模块化的方式编写的。通常它是全有或全无的选择。

大多数程序员“破解”框架工作以使其做他们想做的事。这让未来的程序员摸不着头脑。这也使得“升级”框架成为不可能。

我还没有看到实现单元测试的框架。（你怎么知道你没有打破它）。

随时给我一个写得很好的对象。至少他们你马上就知道范围。

# c++ - C++ 多线程教程

> ID：279009
> 
> 赞同：22
> 
> 时间：2008-11-10T20:11:43.457
> 
> 标签：c++, multithreading

是否有关于在 Visual Studio 2005 中使用（编程）线程的好教程？[与MFC](http://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library)无关，只是本机 C++（无 .NET）。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-10T20:39:56.380

我不会直接使用 Win32 线程，而是考虑使用线程包装器，例如[Boost threads](http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html)。这些是跨平台的，因此以后移植您的应用程序会更容易。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T20:59:59.897

您可以查看*[以下 OpenMP 教程](https://computing.llnl.gov/tutorials/openMP/)*。这并不涉及 VC++ 中的所有多线程概念，而只涉及 VC++ 支持的 OpenMP。OpenMP 在一些简单的多线程情况下很容易使用，例如循环中的独立迭代、可以并发执行的独立代码块。尽管与其他方法相比，OpenMP 没有那么灵活，但它非常易于使用。

要启用 OpenMP，您需要在项目属性“C/C++/Language/OpenMP Support”中将其打开。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-10T20:13:30.770

[Win32 多线程编程](https://rads.stackoverflow.com/amzn/click/com/1565922964)

还可以尝试一些关于操作系统的免费本科播客。你可以找到关于锁定、多线程等的理论讨论（[我知道的一个来自伯克利](http://webcast.berkeley.edu/course_feeds.php?semesterid=18)，基于 Java，但它仍然是相关的）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-10T20:19:36.577

[在The Code Project](http://en.wikipedia.org/wiki/The_Code_Project)上尝试以下文章之一：

*   *[创建 C++ 线程类](http://www.codeproject.com/KB/threads/threadobject.aspx)*

*   *[如何使用 WIN32 事件内核对象](http://www.codeproject.com/KB/winsdk/Win32_Event_Handling.aspx)*

# database-design - 在数据库中存储“已保存的搜索”的最佳做法是什么

> ID：279019
> 
> 赞同：16
> 
> 时间：2008-11-10T20:14:57.743
> 
> 标签：database-design

我正在开发一个允许用户搜索待售房屋的搜索页面。典型的搜索条件包括价格/邮政编码/#卧室/等。

我想允许用户将此标准保存在数据库中并每天通过电子邮件发送新家。

我可以：

1）将“SavedSearch”对象序列化为字符串并将其保存到数据库中，然后根据需要进行反序列化。

2) 在 tblSavedSearch 中有一个与搜索条件相对应的列列表 - 价格/zip/#卧室/等。

我担心如果我选择选项 1，我保存的搜索条件会发生变化，并使数据库中的序列化对象无效，但选项 2 也不是最佳解决方案。

其他人是如何解决这个问题的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T20:35:58.307

我假设您需要每天重新运行搜索才能找到结果中的新内容。也许可以确保您的搜索表单指定了一个 get 方法，以便将搜索条件作为查询字符串附加到 url，然后将整个查询字符串保存在数据库中。

因此，如果您有一个名为 search.action 的搜索程序，您将请求这样的搜索：

```
search.action?price=20000&rooms=3 
```

您可以将**price=20000&rooms=3**部分保存到数据库中。要检索此搜索，只需将查询字符串附加到 url 并再次请求搜索页面。

唯一需要注意的是，当搜索操作发生变化时，您必须设置智能默认值以避免破坏旧搜索。例如，假设您开始按颜色搜索，旧的搜索都没有颜色标准，因此您的搜索操作必须满足这一点，并确保使用像 ALL 颜色这样合理的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T20:23:10.517

表用户

表条件（= 提供的搜索条件列表）

表 SavedSearch（用户详细信息）

表 SavedSearchCriteria，SavedSearch 的详细信息，引用 Criteria，列 SearchValue 保存用户为输入的每个条件输入的值

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T20:24:40.530

我会选择#1。如果您真的担心标准的变化，您可以将其与“搜索版本”属性一起存储，并在必要时调整序列化表示。

#2 不会扩展到任何用途。例如，如果您想要对搜索条件进行任何类型的布尔分组，您的 DB 模式将会着火并尖叫着跑到树林里。

我通常通过从数据库中提取索引/搜索来解决搜索问题。对于您所说的而言，这可能有点矫枉过正，但是 RDBMS 对于搜索并不是那么好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T20:42:09.247

您可以将动态 SQL 本身作为文本字符串保存在数据库中。然后，您就不必从保存的键值对中重新创建 WHERE 和 IN 以及其他 SQL 的所有诡计了。

您可以使用保存的 SQL 并在生成电子邮件时运行它。

如果您的数据库设计不够稳定，无法保存查询信息，您可能需要推迟搜索设计，直到您的数据库设计更加成熟。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-15T18:45:33.530

我认为这两种方法都有意义，并且都取决于需求（当前和未来）。

例如，如果搜索次数很高，并且您需要对其进行分析（例如，回答诸如*“人们搜索每个卧室数量的频率如何？”之*类的问题），则以关系形式存储搜索及其标准（您的选择#2) 会更合适。

但是，如果您没有任何迫在眉睫的要求要求使用选项＃2，那么序列化没有任何问题，恕我直言。只要确保您不会破坏与现有数据的兼容性，因为您的搜索条件的结构会随着时间的推移而发生变化。（顺便说一句，向后兼容性问题并非特定于选项 #1 - 即使在使用选项 #2 时也可能发生。）关键是：您始终可以从选项 #1 切换到选项 #2，并且您可以拖延此类切换只要认为可行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-25T11:56:11.977

我还将向解决方案添加数据可见性......以及表用户 - 包含用户表角色 - 包含数据库中的角色表 UserRoles - 一个用户可能在会话中拥有一个或多个角色表 MetaColumns - 包含元信息对于 db Table ControllerMetaColumns 中的所有列/视图 - 每个 UserRole 每个 MetaColumns 的可见性，用户总是必须通过这个（INNER JOIN）表 TableViewToSearch 访问实际数据 - 在表 SavedSearch 上执行搜索的表或视图 -有属性 ControllerMetaColumnsId ， TableViewToSearchId ， SavedSearchString - 如果角色没有访问属性，它将被赋予空的结果集

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-18T15:53:47.630

完成此操作的最佳方法是将搜索条件存储为 XML。这将使您能够轻松引用您的搜索条件，并为用户提供在需要时更改它的能力。

XML 应该是最具可扩展性的解决方案，我将避免将 URL 参数传递给操作。这可能是一个简单的解决方案，但会遇到以下问题。

1.  如果用户想要编辑新的搜索条件，那么我们必须进行大规模的字符串操作。

2.  存储复杂的搜索条件将是一个问题。如果我想保存一个复杂的和或条件怎么办。（在 XML 中，由于它已经分层，我可以只存储我需要的所有信息）。

3.  该解决方案可以是可扩展的，并且还将使您的应用程序免受 Sql 注入攻击。

4.  由于 XML 是一项成熟的技术，您甚至可以在将其传递到后端之前使用它来执行验证。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-11-10T20:17:42.947

如果我可以建议，有一个带有搜索结果的 html 页面（如果它包含中等数量的记录）。并且，将路径与搜索条件一起存储在数据库中

这将避免查询数据库。

编辑：我假设记录不会经常更改。如果是这样，最好将搜索条件存储在数据库中，并在用户询问时进行查询。

# tsql - 从 SQL Server 函数返回多个值

> ID：279024
> 
> 赞同：52
> 
> 时间：2008-11-10T20:17:09.437
> 
> 标签：tsql, user-defined-functions

如何从 SQL Server 中的用户定义函数返回多个值（例如，一个数字和一个字符串）？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-11-10T20:19:12.040

将其更改为表值函数

例如，请参考以下[链接](http://technet.microsoft.com/en-us/library/ms191165.aspx)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-10T20:22:01.283

另一种选择是使用带有输出参数的过程 -[使用带有输出参数的存储过程](http://msdn.microsoft.com/en-us/library/ms378108(SQL.90).aspx)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-10T20:32:03.933

这是内联函数的查询分析器模板 - 它默认返回 2 个值：

```
-- =============================================  
-- Create inline function (IF)  
-- =============================================  
IF EXISTS (SELECT *   
   FROM   sysobjects   
   WHERE  name = N'<inline_function_name, sysname, test_function>')  
DROP FUNCTION <inline_function_name, sysname, test_function>  
GO  

CREATE FUNCTION <inline_function_name, sysname, test_function>   
(<@param1, sysname, @p1> <data_type_for_param1, , int>,   
 <@param2, sysname, @p2> <data_type_for_param2, , char>)  
RETURNS TABLE   
AS  
RETURN SELECT   @p1 AS c1,   
        @p2 AS c2  
GO  

-- =============================================  
-- Example to execute function  
-- =============================================  
SELECT *   
FROM <owner, , dbo>.<inline_function_name, sysname, test_function>   
    (<value_for_@param1, , 1>,   
     <value_for_@param2, , 'a'>)  
GO 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-01-27T00:25:51.320

Erland Sommarskog 有一篇关于在 SQL Server 中传递数据的详尽文章，位于此处：

[http://www.sommarskog.se/share_data.html](http://www.sommarskog.se/share_data.html)

他介绍了 SQL Server 2000、2005 和 2008，可能应该详细阅读它，因为对每种方法的优缺点都有充分的介绍。但是，为了提供可用于查看更多详细信息的搜索词，这里是文章的重点（截至 2015 年 7 月冻结）：

> 本文解决了两个相关问题：
> 
> *   如何在另一个存储过程中使用结果集，也表示为如何
>     在 SELECT 语句中使用存储过程中的结果集？
> *   如何将参数中的表数据从一个存储过程传递到另一个存储过程？
> 
> **输出参数**
> 
> *   不普遍适用，但有时被忽视。
> 
> **表值函数**
> 
> *   通常是仅输出的最佳选择，但有几个限制。
> *   例子：
>     *   内联函数：使用它来重用单个 SELECT。
>     *   多语句函数：当您需要封装更复杂的逻辑时。
> 
> **使用表格**
> 
> *   最通用的解决方案。我最喜欢的输入/输出方案。
> *   例子：
>     *   共享一个临时表：主要用于一对调用者/被调用者。
>     *   Process-keyed Table：同一被调用者的多个调用者的最佳选择。
>     *   全局温度表：过程键控的变体。
> 
> **表值参数**
> 
> *   请求。版本：SQL 2008
> *   主要在从客户端传递数据时有用。
> 
> **插入执行**
> 
> *   具有欺骗性的吸引力，但应谨慎使用。
> 
> **使用 CLR**
> 
> *   请求。版本：SQL 2005
> *   复杂，但在 INSERT-EXEC 不起作用时作为最后的手段很有用。
> 
> **公开查询**
> 
> *   很棘手，有很多陷阱。灰心。
> 
> **使用 XML**
> 
> *   请求。版本：SQL 2005
> *   有点杂乱无章，但并非没有优势。
> 
> **使用光标变量**
> 
> *   不推荐。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-02T18:09:07.517

### 使用具有多个输出参数的存储过程的示例

正如用户`Mr. Brownstone`建议的那样，您可以使用[存储过程](http://msdn.microsoft.com/en-us/library/ms345415.aspx)；为了方便所有人，我创建了一个极简主义示例。首先[创建一个存储过程](http://msdn.microsoft.com/en-us/library/ms187926.aspx)：

```
Create PROCEDURE MultipleOutParameter
    @Input int,
    @Out1 int OUTPUT, 
    @Out2 int OUTPUT 
AS
BEGIN
    Select @Out1 = @Input + 1
    Select @Out2 = @Input + 2   
    Select 'this returns your normal Select-Statement' as Foo
          , 'amazing is it not?' as Bar

    -- Return can be used to get even more (afaik only int) values 
    Return(@Out1+@Out2+@Input)
END 
```

### 调用存储过程

要[执行存储过程](http://msdn.microsoft.com/en-us/library/ms189915.aspx)，需要一些[局部变量](http://msdn.microsoft.com/en-us/library/ms188927.aspx)来接收值：

```
DECLARE @GetReturnResult int, @GetOut1 int, @GetOut2 int 
EXEC @GetReturnResult = MultipleOutParameter  
    @Input = 1,
    @Out1 = @GetOut1 OUTPUT,
    @Out2 = @GetOut2 OUTPUT 
```

要查看值内容，您可以执行以下操作

```
Select @GetReturnResult as ReturnResult, @GetOut1 as Out_1, @GetOut2 as Out_2 
```

这将是结果：

![具有多个输出参数的存储过程调用的结果](https://i.stack.imgur.com/fjX9E.png)

# c# - 在 .NET 中处理令人难以置信的大量数字

> ID：279038
> 
> 赞同：35
> 
> 时间：2008-11-10T20:22:27.180
> 
> 标签：c#, .net, biginteger, largenumber

我正在尝试解决[projecteuler.net](http://projecteuler.net)上的问题，但我一直遇到一些问题。

第一个是在 a 中存储大量元素的问题`List<t>`。在列表中存储大量数据时，我不断收到 OutOfMemoryException。

现在我承认我可能没有以最好的方式做这些事情，但是有没有办法定义应用程序可以消耗多少内存？

当我得到大约 100,000,000 个元素时，它通常会崩溃：S

其次，有些问题需要大量的数字相加。我使用 ulong 数据类型，我认为数字会变得非常大，但我仍然设法绕过最大支持的 int 并进入负数。

你对处理非常大的数字有什么建议吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-10T20:28:41.070

考虑[System.Numerics.BigInteger](http://msdn.microsoft.com/en-us/library/system.numerics.biginteger.aspx)。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-11-10T20:26:16.080

您需要使用一个使用一些基本数学原理的大数类来拆分这些操作。[CodePoject 上的 C# BigInteger 库的](http://www.codeproject.com/KB/cs/biginteger.aspx)这种实现似乎是最有希望的。这篇文章也很好地解释了海量运算的工作原理。

另请参阅： [C# 中的大整数](https://stackoverflow.com/questions/176775/big-integers-in-c)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-10T20:39:25.383

就 Project Euler 而言，如果遇到 OutOfMemory 异常，您可能会找错树。从他们的网站：

> 每个问题都是按照“一分钟规则”设计的，这意味着尽管设计一个解决更困难问题的成功算法可能需要几个小时，但有效的实现将允许在功率适中的计算机上获得解决方案不到一分钟。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-16T17:25:27.317

正如用户 Jakers 所说，如果您使用的是 Big Numbers，那么您可能做错了。

在我完成的 ProjectEuler 问题中，到目前为止没有一个需要大数数学。它更多地是关于找到合适的算法来避免大数字。

想要提示？在这里发布，我们可能会启动一个有趣的欧拉线程。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-10T20:28:44.813

我假设这是 C#？F# 内置了处理这两个问题的方法（BigInt 类型和惰性序列）。

如果您愿意，可以使用 C# 中的两种 F# 技术。如果添加对核心 F# 程序集的引用，则 BigInt 类型可以从其他语言中合理使用。

惰性序列基本上只是语法友好的枚举器。将 100,000,000 个元素放在一个列表中并不是一个好计划，因此您应该重新考虑解决方案来解决这个问题。如果您不需要保留信息，请将其丢弃！如果重新计算它比存储它更便宜，那就扔掉它！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T20:26:54.833

请参阅此[线程](https://stackoverflow.com/questions/262025/how-do-you-do-maths-or-math-with-numbers-bigger-than-maxvalue-in-c)中的答案。您可能需要使用可用的第三方大整数库/类之一，或者等待包含本机 BigInteger 数据类型的 C# 4.0。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T08:55:33.243

至于定义应用程序将使用多少内存，您可以使用[MemoryFailPoint](http://msdn.microsoft.com/en-us/library/system.runtime.memoryfailpoint.aspx)类在执行操作之前检查可用内存。

这允许您在执行操作之前预先分配内存，因此您可以在运行之前检查操作是否会失败。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-08-27T13:52:10.267

您不需要使用 BigInteger 您可以使用数字字符串数组来执行此事件。

```
class Solution
{

    static void Main(String[] args)
    {
        int n = 5;
        string[] unsorted = new string[6] { "3141592653589793238","1", "3", "5737362592653589793238", "3", "5" };

        string[] result = SortStrings(n, unsorted);

        foreach (string s in result)
            Console.WriteLine(s);
        Console.ReadLine();
    }
    static string[] SortStrings(int size, string[] arr)
    {

        Array.Sort(arr, (left, right) =>
        {

            if (left.Length != right.Length)
                return left.Length - right.Length;
            return left.CompareTo(right);
        });

        return arr;
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-05-20T16:15:51.423

```
string Add(string s1, string s2)
{
        bool carry = false;
        string result = string.Empty;

        if (s1.Length < s2.Length)
            s1 = s1.PadLeft(s2.Length, '0');
        if(s2.Length < s1.Length)
            s2 = s2.PadLeft(s1.Length, '0');

        for(int i = s1.Length-1; i >= 0; i--)
        {
            var augend = Convert.ToInt64(s1.Substring(i,1));
            var addend = Convert.ToInt64(s2.Substring(i,1));
            var sum = augend + addend;
            sum += (carry ? 1 : 0);
            carry = false;
            if(sum > 9)
            {
                carry = true;
                sum -= 10;
            }
            result = sum.ToString() + result;
        }
        if(carry)
        {
            result = "1" + result;
        }

    return result;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-12-14T13:38:16.783

我不确定这是否是处理它的好方法，但我在我的项目中使用了以下内容。

对于每个项目，我有一个“double theRelevantNumber”变量和一个“int PowerOfTen”，在我的相关类中，我有一个“int relatedDecimals”变量。

所以......当遇到大量时，它们的处理方式如下：

首先将它们更改为 x,yyy 形式。因此，如果输入数字 123456,789 并且“powerOfTen”为 10，它将像这样开始：

theRelevantNumber = 123456,789 PowerOfTen = 10 当时的数字是：123456,789*10^10

然后改为：1,23456789*10^15

然后按相关小数位数（例如 5）四舍五入为 1,23456，然后与“PowerOfTen = 15”一起保存

将数字相加或相减时，相关小数之外的任何数字都将被忽略。意思是如果你采取：

1*10^15 + 1*10^10 如果“relevantDecimals”为 5，它将变为 1,00001，但如果“relevantDecimals”为 4，则根本不会改变。

这种方法使您能够毫无问题地处理 doubleLimit*10^intLimit 上的数字，并且至少对于 OOP 而言，跟踪起来并不难。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2022-03-03T16:34:49.553

如果你想处理非常大的数字，请看这里......

[三木计算器](https://github.com/Arduan77/Miki-Calculator/tree/Update20220303)

我不是为自己编写的专业程序员，有时，很抱歉不专业地使用 c#，但程序可以工作。我将不胜感激任何建议和纠正。我使用这个计算器从大约 58 位长的数字中生成 32 个字符的密码。由于程序以字符串格式添加数字，因此您可以对字符串变量的最大长度的数字进行计算。该程序使用长列表进行计算，因此可以计算更大的数字，可能是列表最大容量的 18 倍。

# asp.net - 在 ASP.net 中实现友好 URL 的最佳方法是什么？

> ID：279040
> 
> 赞同：3
> 
> 时间：2008-11-10T20:24:31.107
> 
> 标签：asp.net

在 ASP.net 中实现友好 URL 的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T20:30:52.467

.NET 3.5 SP1 中提供的[ASP.NET Routing Framework](http://weblogs.asp.net/scottgu/archive/2007/12/03/asp-net-mvc-framework-part-2-url-routing.aspx)是一个不错的选择。

虽然它很新，但它可以很好地处理许多与 URL 相关的任务和最常用的 URL 友好方案。

它也可以在 MVC 之外使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T20:35:26.780

*最好*的方法是查看微软的新 MVC 工具包（[http://www.asp.net/mvc/](http://www.asp.net/mvc/)）

有关示例，请参见[http://weblogs.asp.net/scottgu/archive/2007/11/13/asp-net-mvc-framework-part-1.aspx 。](http://weblogs.asp.net/scottgu/archive/2007/11/13/asp-net-mvc-framework-part-1.aspx)

当然，它目前唯一的测试版，但它的核心是路由系统，它可以根据实际内容制作智能 url。

即编辑 id 为 5 的产品，您将拥有一个看起来像 /Product/Edit/5 的 url

如果我正确阅读了规范，您可以将此路由系统用于任何事情（即，您不必重新编码整个站点即可使用它），并且它可以默认允许对现有文件的直接引用优先于其自己的规则（即 /myfile.aspx 仍将使用文件，而不是路由）。这样，您可以混合和匹配技术和 url，同时您可以超越基于路由的新系统。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T20:40:45.537

我使用了[UrlRewriter.Net](http://urlrewriter.net/)库。它体积小但功能强大且易于配置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T20:48:21.497

如果您希望在早期版本的 .Net Framework 中执行此操作，您可以使用[IIS 6.0 Resource Kit](http://support.microsoft.com/kb/840671)中的 RemapURL 工具。我们使用它，只需要安装 dll，使用友好的 url 及其关联的端点创建一个非常简单的 ini 文件，并在 Web Service Extensions 中启用 dll 非常简单的操作方法在[这里](http://etutorials.org/Server+Administration/Microsoft+IIS+6+delta+guide/Appendix+B.+IIS+6+Resource+Kits+Guide/RemapUrl+Version+1/)。

# wpf - 有没有办法将 xaml.cs 中的公共方法的结果绑定到 xaml 中的控件？

> ID：279043
> 
> 赞同：2
> 
> 时间：2008-11-10T20:26:02.930
> 
> 标签：wpf, data-binding, xaml, binding

让我们举一个非常简单的例子：

*   在我的 window1.xaml 中，我有一个名为“lblProduct”的标签控件。
*   在我的 window1.xaml.cs 中，我有一个名为 CalculateProduct(Int Var1, Int Var2) 的公共方法。正如您可能已经猜到的那样，CalculateProduct 将计算传入变量的乘积。

我想简单地将“CalculateProduct”的结果绑定到我的标签。我的实际用例比这要复杂一些。但是，如果我能够启动并运行它，我不仅会很高兴，而且还能弄清楚其余的事情。

我已经看到使用 ObjectDataProvider 绑定到新类的静态方法的有趣示例。虽然这很好，但是当我已经为我的窗口实例化了一个新类时，我觉得没有必要创建一个新类。此外，我可能想在 Window1 类中利用其他全局变量。

感谢您的时间和帮助，

亚伯。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T21:26:54.180

它又快又脏，但我可能只是让CalculateProduct 设置一个属性及其结果并将数据绑定到该属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T21:32:26.027

是的，有办法。这不漂亮。您必须将 xmlns:Commands 属性添加到 window1.xaml 标记。我最终将我在[这篇代码项目文章](http://www.codeproject.com/KB/WPF/CentralizingWPFCommands.aspx)中找到的一些代码混为一谈。

您想在标签中显示的产品是在加载时生成的，还是从另一个控制事件生成的？

我不确定这会对您有所帮助，但我在尝试使用 XSLT 动态生成 XAML 时遇到了类似的情况。我的解决方案奏效了，有点……嗯，不是我想要做的。但也许它会帮助你。

正如我所说，您必须在页面标签中声明 xmlns，如下所示：

```
<Page x:Class="WpfBrowserApplication1.Page1" 
  blah blah blah 
  xmlns:Commands="clr-namespace:WpfBrowserApplication1"> 
```

然后，在您的应用程序中定义一个具有相同命名空间的静态类，与代码项目文章中的示例几乎相同，并带有 RoutedUICommand 的处理程序：

```
namespace WpfBrowserApplication1
{
    public static class CommandHandlers
    {
        private static System.Windows.Input.RoutedUICommand _submitCommand;

        static CommandHandlers()
        {
            _submitCommand = new System.Windows.Input.RoutedUICommand("Submit", "SubmitCommand", typeof(CommandHandlers));
        }

        public static void BindCommandsToPage(System.Windows.Controls.Page caller)
        {
            caller.CommandBindings.Add(new System.Windows.Input.CommandBinding(SubmitCommand, SubmitContact_Executed, SubmitContact_CanExecute));
        }

        public static System.Windows.Input.RoutedUICommand SubmitCommand
        {
            get { return _submitCommand; }
        }

        public static void SubmitContact_Executed(object sender, System.Windows.Input.ExecutedRoutedEventArgs e)
        {
            ...do stuff...
        }

        public static void SubmitContact_CanExecute(object sender, System.Windows.Input.CanExecuteRoutedEventArgs e)
        {
            if (e.Source is System.Windows.Controls.Button)
                e.CanExecute = true;
            else
                e.CanExecute = false;
        }
    }
} 
```

令人讨厌的是，据我所知，将事物映射回 Page1.xaml 的唯一方法是强制转换 sender 对象并挖掘 Page 的 UI 元素，类似于挖掘 DOM在网页上。我在这方面取得了一些成功，但当然不要假装自己是专家。

您要做的最后一件事是在 Page1.xaml.cs 中连接您的控件。在 XAML 中，您可以这样做：

```
<Button Name="btnSubmit" Command="Commands:CommandHandlers.SubmitCommand" etc... /> 
```

在代码隐藏中，如下所示：

```
private void Page_Loaded(object sender, RoutedEventArgs e)
{
    CommandHandlers.BindCommandsToPage(this);
} 
```

我希望这会有所帮助，祝你好运。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T20:57:05.003

`ObjectDataProvider`有一个`ObjectInstance`属性，您可以将 Window 实例分配给该属性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T17:57:38.487

为什么不只是在从方法返回之前在 CalculateProduct 方法中设置标签值。基本上你在这里需要数据绑定吗？无论如何，这是一种方式，因为您要绑定到标签。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T18:06:40.170

aogan：这里的想法是利用 WPF 数据绑定的灵活性。我可以在后面的代码中设置整个 UI，但是 MS 已经开发了这个绑定系统，我想轻松地利用它。此外，这是一个更复杂问题的简单示例。

对于其他所有相关人员，我已经采用了 PITAdev 的解决方案。谢谢您的帮助。

# c# - int 数组的反向方法

> ID：279065
> 
> 赞同：2
> 
> 时间：2008-11-10T20:34:19.857
> 
> 标签：c#, arrays

我有这个作为主要

```
int[] M ={ 10, 2, 30, 4, 50, 6, 7, 80 };

MyMath.Reverse(M);

for (int i = 0; i < M.Length; i++)

    Console.WriteLine(M[i].ToString() + ", "); 
```

* * *

创建类 MyMath 后，我创建了 Reverse 方法

```
public int Reverse(Array M)
 {
     int len = M.Length;
       for (int i = 0; i < len / 2; i++) 
       {
           int temp = M[i]; M[i] = M[len - i - 1]; M[len - i - 1] = temp;

       }           
 } 
```

但我确定这是错误的，因为它不起作用:-)所以你有不同的代码要以相反的方法编写吗？

注意：我不想在 Array 类中使​​用内置的 Reverse

* * *

是的，伙计们，当我使用内置的反向方法时，我得到了这个错误

进程因 StackOverflowException 而终止。

那是在我把方法写成之后

```
public static int Reverse(Array M)
{
    return Reverse(M);
} 
```

所以然后我尝试创建自己的反向方法，但我被卡住了

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T21:03:27.240

从你的工作

```
public static int Reverse(Array M)
{
    return Reverse(M);
} 
```

你有2个问题。

1.  Reverse(M) 看起来与您所在的函数相同，因此您正在调用新函数，该函数调用自身，调用自身等，从而导致堆栈溢出。改成`return Array.Reverse(M);`
2.  `Array.Reverse`返回一个 void，所以如果你需要返回一个`int`（不确定它应该在这里是什么）你需要提供你自己的。或将*您的* `Reverse`功能更改为`void`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T21:03:21.763

要解决您的问题，请将您的方法更改为：

```
// the built-in returns void, so that needed to be changed...
public static void Reverse(Array M)
{
    Array.Reverse(M); // you forgot to reference the Array class in yours
} 
```

在那里，没有堆栈溢出问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T20:45:11.347

不使用 Array.Reverse 几乎没有意义。但是，如果您真的想这样做，一个选项可能是将数组复制到堆栈中，尽管我不认为这非常快（但我也没有对其进行分析）：

```
private void Whatever()
{
    int[] M = { 10, 2, 30, 4, 50, 6, 7, 80 };
    ReverseArray(ref M);

}

private void ReverseArray(ref int[] input)
{
    Stack<int> tmp = new Stack<int>();
    foreach (int i in input)
    {
        tmp.Push(i);
    }
    input = tmp.ToArray();
} 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-11-10T20:43:37.717

您需要将数组作为参考传递。在 C# 中，您可以在声明参数时使用关键字 'ref' 来做到这一点。

您当前所做的基本上是反转您的数组的副本，该副本永远不会传回给调用者。

# asp-classic - 寻找一种技巧以防止在不使用会话变量的情况下重写应用程序

> ID：279066
> 
> 赞同：3
> 
> 时间：2008-11-10T20:34:35.567
> 
> 标签：asp-classic, session-variables

我们公司使用的应用程序最初是 ColdFusion + Access，后来转换为经典的 ASP + MS Sql，用于任务/时间跟踪，称为请求系统。它是按部门划分的，所以有一个用于管理信息系统、市场营销、物流等。当（主要是经理）一次使用多个浏览器窗口时，问题就出现了，并且打开了 2 个浏览器窗口。请求系统使用会话变量，会话变量很多，“会话”在应用程序中被引用了2300次。正如您可以想象的那样，当 2 一次打开时，这会导致变量混淆的各种异常情况。

系统中有一个 3 年前的 MIS 请求来“修复”这个问题，并且已经由 3 个开发人员进行了工作，现在轮到我来尝试一下了。我想知道是否有其他人必须从事这样的项目，以及是否有某种黑客来尝试缓解一些问题。我在想也许在 global.asa 中调用一些东西来加载杂项。来自查询字符串的会话变量。问题是，发生了各种各样的事情：

```
If (Session("Application") <> Request("App")) and Request("App") <> "" THEN
  Session("Application") = Request("App")
End If 
```

查看包含文件中的函数，您将拥有一个带有 4 个参数的函数，它引用了 6 个不同的会话变量。所以你明白了，这将是痛苦的。

过去有没有人必须做这样的事情？您发现任何有用的技巧？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T20:45:49.943

从直接 Session("whatever") 接口中重构代码：

1.  创建一个用于会话访问的 API 并用它替换所有现有的 Session 使用（它可以是会话“类/对象”或只是一个包含文件）
2.  使用可以根据您的需要（部门或其他）使它们在每个域中唯一的东西来修改会话变量的传入名称
3.  仔细测试

然后用现代网络语言重写整个事情，和/或在他们要求你创造*另一个*奇迹之前找到另一份工作;-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T20:49:44.083

我的经理（他是业务人员，而不是代码人员）对这个系统非常着迷。他并不急于重写它。如果我确实重写了这个，唯一使用的会话变量将与登录相关。不幸的是，我更关心快而不是正确:(

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T15:17:19.187

多少次“会话”被引用并不像你想象的那么重要。此外，除非出现编码错误，否则打开两个浏览器应该启动两个单独的会话，并且这些会话的值不应该有任何“混合”。

我怀疑这可能与其他一些事情有关，例如从同一个 cookie 读取的两个会话或 App 变量的一些问题。没有看到整个来源，很难说。如果有更熟悉代码的人来帮助您，可能值得一试。

是的，在代码中挖掘会很痛苦，但至少下次你必须修复某些东西时你会知道更多。;)

此外，重写并不总是最好的选择。你永远不知道在重写中丢失了哪些有趣的业务逻辑/错误修复。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T15:27:36.640

我同意 AnonJr

> 打开两个浏览器的 Blockquote 应该启动两个单独的会话 Blockquote

也许使用静态全局变量会导致您的数据丢失

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-03T05:15:21.193

在您的会话类中（如果您将使用一个），当您引用每个变量时，请使用前缀或常见的东西，以便您可以识别所有变量......然后您可以遍历所有会话变量，也许找到其他正在被引用/创建...

```
Private Const PREFIX As String = "MyPrefix_"
Public Shared Property MyVariable() As String
    Get
        Return HttpContext.Current.Session(String.Concat(PREFIX, "MyVariable"))
    End Get
    Set(ByVal value As String)
        HttpContext.Current.Session(String.Concat(PREFIX, "MyVariable")) = value
    End Set
End Property 
```

循环查找不在您的课程中的会话变量

```
For Each Item As Object In HttpContext.Current.Session.Contents
    If Not Item.ToString.StartsWith(PREFIX) Then

    End If
Next 
```

# c# - ASP.NET：如何将文件从数据库发送到打印机？

> ID：279071
> 
> 赞同：2
> 
> 时间：2008-11-10T20:36:13.597
> 
> 标签：c#, asp.net

我有一个 ASP.NET 2.0 (C#) 网页，其链接从 MS SQL 数据库中提取一个 blob 并以适当的文件格式输出，即 Word、WordPerfect、PDF。

我的用户想一键打印这些文件。现在他们必须点击链接打开文件，然后点击他们打开的应用程序中的“打印”按钮。

此外，如果可能的话，我想一键将多个文档发送到打印机。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T20:41:14.757

您要打印到连接到服务器或连接到客户端的打印机吗？

如果您想在客户端上打印，您将没有多少机会。对于 HTML 内容，也许一些 JavaScript 或 Flash 可能会触发打印对话框（不确定），但如果它是一个必须在第三方应用程序中打开的文件（即 PDF、DOC、XLS 等），你就完了运气。

如果它是一个内部网络，您可能会创建一个桌面应用程序，该应用程序安装在每个客户端的 PC 上，然后触发打印。

如果它是连接到服务器的打印机，您可以使用标准的 .net 工具进行打印，尽管您可能不得不再次解决尝试打印 PDF/DOC/XLS 等的情况，因为那时您需要使用自动化（COM 或类似 SendKeys 的东西），这会让你在服务器上头疼。

简而言之：只有 ASP.net 可供您使用，您无能为力。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T20:44:53.330

我最接近这个的是使用Javascript：

```
<body onload="window.print()">
...
</body> 
```

这将在页面加载时弹出打印对话框（有关更多信息，请参阅[此帖子](https://stackoverflow.com/questions/242182/how-can-i-pop-up-a-print-dialog-box-using-javascript)）。如果您考虑一下，除非您在内部网络上，否则您可能无法做很多其他事情。您希望您的计算机如何“自动”开始打印弹出窗口？

# sql-server - 如何在 SQL 2005 探查器中查找超时语句

> ID：279073
> 
> 赞同：8
> 
> 时间：2008-11-10T20:36:58.273
> 
> 标签：sql-server, sql-server-profiler

我正在尝试使用 SQL 2005 探查器查找超时的 SQL 语句。有没有办法设置这样的过滤器？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T20:51:47.637

在 Profiler 中，您可以在“错误和警告”下添加事件“注意”。它的定义是

> 收集所有注意事件，例如客户端中断请求或客户端连接断开时。

至于其他错误（死锁、约束等），请尝试“执行警告”（报告在执行 SQL 语句或过程期间发生的警告）或“用户错误消息”（在错误或异常）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T04:47:11.950

是的。

*   检查“所有事件”
*   转到锁定部分
*   指定“锁定：超时”事件

[在线图书中的锁定事件](http://msdn.microsoft.com/en-us/library/ms189107(SQL.90).aspx)

现在，这适用于服务器端锁 (@@LOCK_TIMEOUT <> 0)。我不知道是否会捕获客户端超时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T00:35:10.960

一个选项，如果您知道客户端配置的超时设置为（即默认为 30 秒），您可以在跟踪上设置一个过滤器以仅收集持续时间大于或等于您的超时（减去一秒或二）。

# python - 如何使用 Python 编写 OLE 组件脚本

> ID：279094
> 
> 赞同：9
> 
> 时间：2008-11-10T20:41:41.043
> 
> 标签：python, windows, scripting, activex, ole

我想使用 Python 编写一个应用程序脚本，该应用程序自称提供 OLE 组件。我应该如何开始？

我还不知道我需要在要访问的组件上调用哪些方法。我应该使用 win32com 加载这些组件，然后开始在 IPython 中按“tab”吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T20:51:43.033

“ [Python and COM](http://www.boddie.org.uk/python/COM.html) ”包含一个例子。OLE 与 COM 和 ActiveX 有关，因此您应该查找这些术语。

《[Python Programming on Win32](http://oreilly.com/catalog/9781565926219/)》是一本很有用的书。还有一个“ [Python Win32](http://mail.python.org/pipermail/python-win32/) ”邮件列表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T20:50:47.497

您需要[win32com](http://python.net/crew/mhammond/win32/Downloads.html)软件包。一些例子：

```
from win32com.client.dynamic import Dispatch

# Excel
excel = Dispatch('Excel.Application')

# Vim
vim = Dispatch('Vim.Application') 
```

然后在他们身上调用任何你喜欢的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-12T19:33:01.103

如果你想使用 IDispatch 接口来控制你的对象，win32com 是一个很好的包，但是它很慢。

comtypes 是一个更好的原生 Python 包，它使用原始 COM 方法与您的控件对话。

WxPython 使用 comtypes 为您提供来自 Python 的 ActiveX 容器窗口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T20:52:07.980

请查看[python-win32](http://sourceforge.net/projects/pywin32/)包，特别是其 win32com API。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T13:57:17.073

PythonWin ( [http://sourceforge.net/projects/pywin32/](http://sourceforge.net/projects/pywin32/) ) 与 python-win32 捆绑在一起，带有自己的 COM 浏览器，作为其 shell 和调试环境的一部分。

# vsto - 适用于 Office 的 Microsoft Visual Studio 工具。值得使用吗？

> ID：279097
> 
> 赞同：6
> 
> 时间：2008-11-10T20:44:14.797
> 
> 标签：vsto, officedev

似乎`VSTO`代码的部署非常麻烦。

我的用例是我需要在 word 中强制执行某种内容结构。我最好在 VBA 中做这一切吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T20:57:23.617

这真的取决于什么对您的项目最有意义。如果它只适用于某些文件和几个用户，我会推荐 VBA。

如果它更复杂并且需要为所有用户处理所有文件，我认为 VSTO 插件将是可行的方法。这实际上取决于您要强制执行的情况和复杂性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T20:06:48.400

在 VSTO 3.0 之前，我会同意 Ryan Lanciaux，但现在不再同意。这些天来，我在 VSTO 变得如此高效，我什至在 VSTO 做了一些零工。随着插件在公司中变得非常流行，这在某些情况下节省了我的精力，我所要做的就是将路径添加到 Click-once 包:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T21:05:41.697

请记住，令人沮丧的不仅是 VBA 作为一种语言的局限性，而且还缺乏诸如单元测试框架和源代码控制之类的工业级工具。如果您坚持使用 VBA，您可能会因此而权衡开发速度和长期的挫败感。

你可以两者都做，编写 VBA 代码来直接支持你的 UI 和 .NET 中的其余部分。

# vsto - 如何将文档级模板放入 Visual Studio Tools for Office (VSTO)

> ID：279105
> 
> 赞同：1
> 
> 时间：2008-11-10T20:45:50.910
> 
> 标签：vsto

“总而言之：如果您在干净的 VS 2005 Professional 之上安装 VSTO 2005 SE，您将没有文档级模板。如果您想拥有它们，您需要 VS 2005 Team Suite/Team Edition 或者您需要安装以前版本的 VSTO：VSTO 2005。所以 VS 2005 Professional + VSTO 2005 + VSTO 2005 SE 将为您提供文档级模板！

所以我的问题是，是否有人有 VSTO 2005 下载的链接（Microsoft 不再提供该链接）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T16:16:05.447

[http://social.msdn.microsoft.com/Forums/en-US/vsto/thread/f2909f92-3517-49bc-9e86-c136299956bc/](http://social.msdn.microsoft.com/Forums/en-US/vsto/thread/f2909f92-3517-49bc-9e86-c136299956bc/)

> 正如 Richard 在本线程前面所说的，“文档级”项目模板（Excel 工作簿、Excel 模板、Word 文档和 Word 模板）不包含在 VSTO 2005 SE 或 Visual Studio 2005 Professional 中。要在 Visual Studio 2005 版本中获取“文档级”项目模板，您必须具有以下 Visual Studio 版本之一：
> 
> > 适用于 Office 的 Visual Studio 2005 工具（这是一个完全独立的 Visual Studio 版本，可供购买；它不是免费下载的）。
> > 
> > Visual Studio 2005 的“团队系统”版本之一。
> 
> Visual Studio 2008 中的 VSTO 开发故事稍微简单一些。在此版本中，所有 VSTO 项目（加载项和文档级项目）现在都可以在 Visual Studio 2008 Professional 以及“团队系统”版本中使用. 这包括适用于 Office 2003 和 2007 Microsoft Office 系统的加载项和文档级项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T08:31:48.410

也许这个会帮助[Microsoft Visual Studio 2005 Tools for Office 2005 Runtime (VSTO 2005 RTM)](http://www.microsoft.com/downloads/details.aspx?FamilyID=5D3FECE9-74E0-4E19-AF98-AEDE2DF94F87&displaylang=en&displaylang=en)

> VSTO 2005 可再发行包安装 Visual Studio Tools for Office 运行时，这是运行使用 VSTO 2005 构建的解决方案所必需的。此运行时支持 Microsoft Office Excel 2003 和 Microsoft Office Word 2003 的文档级自定义，以及应用程序级加载项适用于 Microsoft Office Outlook 2003。

# vb.net - 如何从 XSL 转换中获取 filtererd 数据表

> ID：279106
> 
> 赞同：0
> 
> 时间：2008-11-10T20:46:00.627
> 
> 标签：vb.net, xslt, stream

我正在尝试通过 XSL 转换运行 DataTable，然后将结果放回 DataTable。我的 DataTable 是空的。任何帮助都会很棒。

```
Dim finalExelList As New DataTable
Dim xlsMyList = New XPath.XPathDocument(New StringReader(myList.DataSet.GetXml()))
Dim trans As Xsl.XslCompiledTransform = New Xsl.XslCompiledTransform

trans.Load(RequestHandlerBase.ServerLocation & "xsl\dataisland2DotNet.xsl")
Using ms As MemoryStream = New MemoryStream
  trans.Transform(xlsMyList, Nothing, ms)
  ms.Position = 0
  finalExelList.ReadXml(ms)
End Using 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T21:02:18.410

您的 VB 代码看起来很合理，这意味着 XSL 很可能不正确，您需要先对其进行调试。如果你有 XMLSpy——使用它（它有相当不错的 XSL 调试器）。如果您手边没有 XSL 调试器——我建议创建一个**非常**简单的 XSL 转换，它确实会返回一些东西，然后逐步添加功能，直到它满足您的需要。

# sql-server-2005 - SQL Server Management Studio 2005 的外部工具开发

> ID：279110
> 
> 赞同：1
> 
> 时间：2008-11-10T20:48:18.907
> 
> 标签：sql-server-2005, ssms

有没有人有为 SSMS 2005 开发外部工具的经验。

理想情况下，我希望能够直接与查询窗口进行交互，例如，从窗口中获取查询文本以对其执行一些处理。

任何朝着正确方向的指针都会很棒。

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T21:02:56.380

你看过 Sql Server 管理对象 (SMO) 吗？

[http://msdn.microsoft.com/en-us/library/ms162557.aspx](http://msdn.microsoft.com/en-us/library/ms162557.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T03:23:12.743

我在 SSMS 中看到的最好的例子是[Red Gate 的 SQL Prompt](http://www.red-gate.com/products/SQL_Prompt/index.htm)

SQL Prompt 运行一个单独的 .NET 应用程序，该应用程序位于您的系统托盘中，并且在某种程度上是集成魔法的一部分。

要加载加载项，您需要在以下位置创建一个密钥：

HKLM\SOFTWARE\Microsoft\Microsoft SQL Server\90\Tools\Shell\AddIns\

...为了让 SSMS 加载您的加载项。

希望这可以帮助

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-04T18:46:29.617

很晚进入...

[如何在此处执行此操作的示例](http://jcooney.net/archive/2007/11/26/55358.aspx)

[这里也是](http://blogs.microsoft.co.il/blogs/shair/archive/2008/07/28/how-to-create-sql-server-management-studio-addin.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-30T12:25:10.443

此链接解释了如何通过屏幕截图向 ssms 添加外部工具。它还具有将它们添加为按钮的过程。 [http://sqlserverlearner.com/2011/sql-server-external-tools](http://sqlserverlearner.com/2011/sql-server-external-tools)

# .net - 由于以下错误，检索具有 CLSID {XXXX} 的组件的 COM 类工厂失败：80080005

> ID：279112
> 
> 赞同：11
> 
> 时间：2008-11-10T20:48:38.127
> 
> 标签：.net, com, interop

.Net 中的“检索 CLSID {XXXX} 组件的 COM 类工厂失败，原因是以下错误：80080005”错误的故障排除过程是什么？澄清一下：我在运行时得到这个，在我的 XP 机器上，客户端是在管理员帐户下运行的 .net 代码。{XXXX} 是指我们内部的 COM 组件之一。

据我了解， 0x80080005 是指“权限被拒绝”，但我该去哪里检查/更改权限？还是我在这里完全错了，错误来自组件本身，而不是来自 Windows COM 子系统？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-10T21:55:09.130

似乎是与启动 COM 服务器有关的一个相当普遍的错误。可能的问题包括[超时](http://blogs.msdn.com/adioltean/archive/2005/06/24/432519.aspx)、[登录失败](http://alt.pluralsight.com/wiki/default.aspx/Keith/ComSecurityFaqEx2.html)（检查 Q about `CO_E_SERVER_EXEC_FAILURE`）或[安全权限](http://www.devguy.com/fp/Tips/COM/)，或（显然）[VS2008 ATL 错误](http://blogs.msdn.com/jigarme/archive/2008/05/08/cocreateinstance-returns-0x80080005-for-visual-studio-2008-based-atl-service.aspx)。我认为，在 CreateInstance 中遇到错误也可以解决问题。

我会首先检查事件日志中是否有任何有趣的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T21:12:18.873

根据 ERRLOOK.EXE，0x80080005 是“服务器执行失败”。WinError.h 将此列为`CO_E_SERVER_EXEC_FAILURE`. 不是“拒绝访问”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-06T18:59:19.173

您可以查看的一件事是 DCOM 安全配置。它由 dcomcnfg 实用程序控制。网络上有[有用的教程视频](http://www.opcactivex.com/Support/Tutorials/DCOM_Tutorial_-_Configuring_th/DCOM_Videos/dcom_videos.html)来解释如何使用它。[ASP.NET 论坛上](http://forums.asp.net/t/1093228.aspx)还有一个讨论如何使用 dcomcnfg 的主题。

# c# - 如何在 C# 中使用 StreamReader（新手）

> ID：279114
> 
> 赞同：8
> 
> 时间：2008-11-10T20:49:47.937
> 
> 标签：c#, .net, stream

我正在尝试读取文本文件的内容，在本例中为计算机名称列表（Computer1、computer2 等），我认为 StreamReader 将是您将使用的，但是当我执行以下操作时：

```
StreamReader arrComputer = new StreamReader(FileDialog.filename)(); 
```

我得到了这个例外：

```
The type or namespace name 'StreamReader' could not be found (are you missing a using directive or an assembly reference?) 
```

我对 C# 很陌生，所以我确定我犯了一个新手错误。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-10T20:51:59.977

您需要导入`System.IO`命名空间。将其放在 .cs 文件的顶部：

```
using System.IO; 
```

要么，要么明确限定类型名称：

```
System.IO.StreamReader arrComputer = new System.IO.StreamReader(FileDialog.filename); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-10T20:53:34.340

你需要：

```
using System.IO; 
```

在 .cs 文件的顶部。如果您正在阅读文本内容，我建议您使用 TextReader，它奇怪地是 StreamReader 的基类。

尝试：

```
using(TextReader reader = new StreamReader(/* your args */))
{
} 
```

using 块只是确保它被正确处理。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T20:51:12.910

尝试

```
using System.IO;

StreamReader arrComputer = new StreamReader(FileDialog.filename); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-10T20:52:44.967

确保您在项目的引用中有系统程序集，并将其添加到使用部分：

```
using System.IO; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T20:52:34.797

确保包含`using System.IO`在使用声明中

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-10T20:52:40.740

确保你有“使用 System.IO;” 在模块的顶部。此外，您不需要在“new StreamReader(FileDialog.filename)”末尾添加额外的括号。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-10T20:52:54.297

StreamReader 在 System.IO 中定义。您要么需要添加

`using System.IO;`

到文件或将代码更改为：

```
System.IO.StreamReader arrComputer = new System.IO.StreamReader(FileDialog.filename); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T20:54:12.530

您需要添加对 System.IO 程序集的引用。您可以通过“参考”选项卡下的“我的项目”属性页面执行此操作。

# python - 如何在 IPython 调试 shell 中搜索未发布的 Plone 内容？

> ID：279119
> 
> 赞同：2
> 
> 时间：2008-11-10T20:51:35.670
> 
> 标签：python, plone

我喜欢使用 IPython 的 zope 配置文件来检查我的 Plone 实例，但是与插入断点并使用管理员用户点击它相比，会出现一些令人讨厌的权限差异。

例如，我想遍历未发布的测试文件夹中的内容对象。此查询不会在 shell 中返回任何结果，但会从断点开始工作。

```
$ bin/instance shell
$ ipython --profile=zope

from Products.CMFPlone.utils import getToolByName
catalog = getToolByName(context, 'portal_catalog')
catalog({'path':'Plone/testing'}) 
```

我可以以管理员身份进行身份验证或以其他方式重新调整权限以从 ipython 完全操纵我的网站吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T12:37:52.897

这是我用来从调试外壳管理我的克隆应用程序的（**非常脏的）代码。**根据您的 Zope 和 Plone 版本，它可能需要一些更新。

```
from sys import stdin, stdout, exit
import base64
from thread import get_ident
from ZPublisher.HTTPRequest import HTTPRequest
from ZPublisher.HTTPResponse import HTTPResponse
from ZPublisher.BaseRequest import RequestContainer
from ZPublisher import Publish

from AccessControl import ClassSecurityInfo, getSecurityManager
from AccessControl.SecurityManagement import newSecurityManager
from AccessControl.User import UnrestrictedUser

def loginAsUnrestrictedUser():
    """Exemple of use :
        old_user = loginAsUnrestrictedUser()
        # Manager stuff
        loginAsUser(old_user)
    """
    current_user = getSecurityManager().getUser()
    newSecurityManager(None, UnrestrictedUser('manager', '', ['Manager'], []))
    return current_user

def loginAsUser(user):
    newSecurityManager(None, user)

def makerequest(app, stdout=stdout, query_string=None, user_pass=None):
    """Make a request suitable for CMF sites & Plone
      - user_pass = "user:pass"
    """
    # copy from Testing.makerequest
    resp = HTTPResponse(stdout=stdout)
    env = {}
    env['SERVER_NAME'] = 'lxtools.makerequest.fr'
    env['SERVER_PORT'] = '80'
    env['REQUEST_METHOD'] = 'GET'
    env['REMOTE_HOST'] = 'a.distant.host'
    env['REMOTE_ADDR'] = '77.77.77.77'
    env['HTTP_HOST']   = '127.0.0.1'
    env['HTTP_USER_AGENT'] = 'LxToolsUserAgent/1.0'
    env['HTTP_ACCEPT']='image/gif, image/x-xbitmap, image/jpeg, */* '
    if user_pass:
        env['HTTP_AUTHORIZATION']="Basic %s" % base64.encodestring(user_pass)
    if query_string:
        p_q = query_string.split('?')
        if   len(p_q) == 1: 
            env['PATH_INFO'] = p_q[0]
        elif len(p_q) == 2: 
            (env['PATH_INFO'], env['QUERY_STRING'])=p_q
        else: 
            raise TypeError, ''
    req = HTTPRequest(stdin, env, resp)
    req['URL1']=req['URL'] # fix for CMFQuickInstaller
    #
    # copy/hacked from Localizer __init__ patches
    # first put the needed values in the request
    req['HTTP_ACCEPT_CHARSET'] = 'latin-9'
    #req.other['AcceptCharset'] = AcceptCharset(req['HTTP_ACCEPT_CHARSET'])
    #
    req['HTTP_ACCEPT_LANGUAGE'] = 'fr'
    #accept_language = AcceptLanguage(req['HTTP_ACCEPT_LANGUAGE'])
    #req.other['AcceptLanguage'] = accept_language 
    # XXX For backwards compatibility
    #req.other['USER_PREF_LANGUAGES'] = accept_language
    #req.other['AcceptLanguage'] = accept_language 
    #
    # Plone stuff
    #req['plone_skin'] = 'Plone Default'
    #
    # then store the request in Publish._requests
    # with the thread id
    id = get_ident()
    if hasattr(Publish, '_requests'):
        # we do not have _requests inside ZopeTestCase
        Publish._requests[id] = req
    # add a brainless session container
    req['SESSION'] = {}
    #
    # ok, let's wrap
    return app.__of__(RequestContainer(REQUEST = req))

def debug_init(app):
    loginAsUnrestrictedUser()
    app = makerequest(app)
    return app 
```

这存在于 wshelpers Zope 产品中。一旦调试外壳启动，这只是一个问题；

```
>> from Products.wshelpers import wsdebug
>> app = wsdebug.debug_init(app)
>> # now you're logged in as admin 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T16:29:54.583

只需使用 catalog.search({'path':'Plone/testing'})。它执行与 catalog() 相同的查询，但不根据当前用户的权限过滤结果。

IPython 的 zope 配置文件确实提供了一个方法 utils.su('username') 来更改当前用户，但它不识别管理员用户（在 /acl_users 而不是 /Plone/acl_users 中定义）并且在调用它之后对目录的后续调用（ ) 出现 AttributeError 失败：“模块”对象没有属性“checkPermission”。

# python - 任何人都可以为 Python 推荐一个像样的 FOSS PDF 生成器吗？

> ID：279129
> 
> 赞同：5
> 
> 时间：2008-11-10T20:53:34.653
> 
> 标签：python, pdf-generation

我需要一个基本的 pdf 生成器，它可以让我将一些图像和文本折腾成 pdf 文件。拥有一些基本绘图命令（线条等）的能力也将是一个加号。

我确实通读了[这个问题](https://stackoverflow.com/questions/177799/what-is-a-good-pdf-report-generator-tool-for-python)，但我真的不需要报告生成器，而且那里的大多数回复似乎对我正在尝试做的事情来说真的是矫枉过正。（我不需要模板或 LaTeX 级布局控件。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T21:04:17.550

对于我的一个项目，在过去的六个月中，我已经测试和/或实施了大概六七种不同的从图像到 PDF 的方法。最终，我最终回到了[ReportLab](http://www.reportlab.org/downloads.html)（我最初出于与您描述的类似原因而避免使用它），因为所有其他人都有明显的限制或完全遗漏（例如无法设置文档元数据）。

ReportLab 并不像乍一看那样难以处理，而且它可以为您省去很多日后令人头疼的重构。我强烈建议您继续使用它，因此知道如果您想要做更多事情，您也将拥有这种能力，而不是像我所做的那样在许多不同的实用程序、库、和格式。

**编辑：**

还值得一提的是，如果您只想在页面上放置一点文本和图像，您可以绕过 ReportLab 附带的鸭嘴兽布局系统。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T20:59:04.173

我认为通过 Latex 是最简单的方法，而且一点也不矫枉过正。生成工作 PDF 文件是一项相当困难的活动，而生成 Tex 源文件要容易得多。任何其他排版更改也可能会起作用，例如通过 reStructuredText 或 troff。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T21:04:48.843

报告实验室代码不行吗？使用 LaTeX 可能不会过大的原因是因为 pdf 是一种非常低级的格式。在 pdf 中，您不会自动获得换行符，您必须自己计算线宽。

# silverlight - Silverlight/Flash 网络广播软件，类似于 Channel 9 PDC 2008

> ID：279131
> 
> 赞同：2
> 
> 时间：2008-11-10T20:54:14.060
> 
> 标签：silverlight, flash

任何人都对网络广播软件有建议，类似于此处的 Silverlight 应用程序：http: [//channel9.msdn.com/pdc2008/TL57/](http://channel9.msdn.com/pdc2008/TL57/)

我查看了此处发布的其他几个问题，但我不想要托管解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T22:28:38.283

PDC 频道 9 站点正在使用来自[http://codeplex.com/SL2VideoPlayer](http://codeplex.com/SL2VideoPlayer)的播放器基础，并对其进行了一些修改（我们计划将其引入该项目）。他们有一个 Windows Media Streaming 服务器后端来提供媒体。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T20:56:02.543

对于 Flash，有[JW FLV Player](http://www.jeroenwijering.com/?item=JW_FLV_Player)。只需将文件放在您自己的 Web 服务器上即可。在 CodePlex 上，您可以找到[Silverlight 2.0 媒体播放器](http://www.codeplex.com/sl2videoplayer)。

# windows - Windows Server 2008 是否支持 MSDE？

> ID：279132
> 
> 赞同：2
> 
> 时间：2008-11-10T20:54:50.283
> 
> 标签：windows, windows-server-2008, msde

我知道 Vista 不再支持 MSDE，Windows Server 2008 也是这样吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T22:20:11.513

只是为了参考这个问题......

MSDE 已被 SQL Server Express（同样的想法）取代，后者在 Vista/2008 上运行。链接是：

*   [维基百科](http://en.wikipedia.org/wiki/SQL_Server_Express)
*   [2005 速成版 (MS)](http://www.microsoft.com/Sqlserver/2005/en/us/express.aspx)
*   [2008 速成版 (MS)](http://www.microsoft.com/express/sql/default.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T16:58:54.843

应该知道，SQL Express 和 MSDE 之间存在一些显着差异。虽然其中一些差异有利于 SQL Express，但我们发现对我们来说关键项目是能够作为只有 MSDE 支持的发布者运行，以及 Express 中缺少 SQL 代理。

有关出色的并排比较，请参阅：

[http://www.microsoft.com/technet/prodtechnol/sql/2005/msde2sqlexpress.mspx#EKE](http://www.microsoft.com/technet/prodtechnol/sql/2005/msde2sqlexpress.mspx#EKE)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T20:56:52.867

Vista 和 Vista 之后的所有操作系统（包括 Windows 2008 和 Windows 7）的状态相同。

我不知道你是否能以某种方式“让它工作”，但你不会得到微软的任何支持。

编辑：来源在[这里](http://blogs.msdn.com/sqlexpress/archive/2006/08/09/693650.aspx)，两个重要的位：

> MSDE 2000 将于 2008 年 4 月 8 日退出主流支持，并且在 2007 年 6 月 30 日之后不再允许新的部署协议。

和

> 是的，MSDE 将在其当前设计运行的操作系统上在其生命周期结束时得到支持。

（这取决于 Windows XP 和 2003 Server）

# asp.net - IIS7：URL 将 http://web1.com/web1/def.aspx 重写为 http://web1.com/def.aspx

> ID：279141
> 
> 赞同：3
> 
> 时间：2008-11-10T20:57:27.407
> 
> 标签：asp.net, iis-7, url-rewriting

我必须将我的网站存储在我的域根目录的子文件夹中。有没有办法重写 URL，使其看起来不存储在子文件夹中？如果这是在 IIS 级别或在 web.config 中完成，对我来说并不重要。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T18:00:22.257

我在我的博客上使用了[ManagedFusion Url Rewriter 。](http://www.managedfusion.com/products/url-rewriter/)我喜欢它，因为它不需要在服务器级别安装。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T04:58:22.693

您是否查看过源自 MVC 项目但现在是 .NET Framework 的独立功能的路由引擎？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T07:03:10.570

使用 IIS7，要走的路可能是微软自己推出的模块：http: [//blogs.iis.net/ruslany/archive/2008/11/10/url-rewrite-module-release-to-web.aspx](http://blogs.iis.net/ruslany/archive/2008/11/10/url-rewrite-module-release-to-web.aspx)

在以前的版本中，有各种不同的缺点/成本的解决方法： [http ://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx](http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T12:15:46.930

如果您决定使用 ISAPI 过滤器，我们在[Ionic 的 Isapi Rewrite](http://www.codeplex.com/IIRF)方面有很好的经验。而且它是免费的（啤酒和演讲）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T23:30:33.493

您大概可以通过使用 ISAPI 过滤器获得您想要的行为。

谷歌：重写 ISAPI 过滤器，你会发现一些预建的例子来尝试看看什么最适合你。

# git - 使用 git-svn 克隆多个 SVN 项目

> ID：279144
> 
> 赞同：7
> 
> 时间：2008-11-10T20:58:19.543
> 
> 标签：git, git-svn

我有一个大型 Java 应用程序，它被分成多个项目。每个项目在 Subversion 存储库中都有自己的文件夹，如下所示：

会计核心

*   树干
*   分支机构
*   标签

常见的

*   树干
*   分支机构
*   标签

网络通用

*   树干
*   分支机构
*   标签

ETC...

我想在本地开始使用**git-svn**而不是颠覆。

这可能是一个愚蠢的问题，但是有没有办法一次检查存储库中的*所有项目*（包括分支和所有项目）而不是单独检查每个项目？

谢谢，托尼

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T14:24:42.910

如果你有一个外壳，你可以输入

`for DIR in AccountingCore Common WebCommon; do mkdir $DIR; cd $DIR; git init; git svn init -s svn://host/path/$DIR; git svn fetch; cd ..; done`

也就是说，如果我没有犯错的话。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-03-21T07:10:06.643

只是为了改进早期的答案，而不是

```
for DIR in AccountingCore Common WebCommon; do ... 
```

做

```
DIRS=`svn ls svn://host/path`; for DIR in $DIRS; do ... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T14:36:26.600

是的。只需在根路径处结帐。如果您的存储库托管在这里：

svn://host/path/AccountingCore svn://host/path/Common svn://host/path/WebCommon

然后`git svn`在`svn://host/path`.

# algorithm - F# 中最优雅的冒泡排序方式是什么？

> ID：279145
> 
> 赞同：12
> 
> 时间：2008-11-10T20:58:22.537
> 
> 标签：algorithm, sorting, f#

F# 中最优雅的冒泡排序方式是什么？

**更新**

正如其中一个答案所指出的，冒泡排序在函数式语言中一开始效率不高。一位幽默而愤世嫉俗的评论者还指出，冒泡排序仅适用于列表很小且几乎已排序的情况。

但是，我很想知道如何用 F# 编写聪明的冒泡排序，因为我过去在 C#、C++ 和 Java EE 中做过冒泡排序，而且我是 F# 新手。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-10T23:46:18.063

在函数式语言中使用冒泡排序不是很有效，因为实现必须多次反转列表（对于不可变列表，这不能真正有效地实现）。

无论如何，来自 Erlang 的示例可以像这样重写为 F#：

```
let sort l = 
  let rec sortUtil acc rev l =
    match l, rev with
    | [], true -> acc |> List.rev
    | [], false -> acc |> List.rev |> sortUtil [] true
    | x::y::tl, _ when x > y -> sortUtil (y::acc) false (x::tl)
    | hd::tl, _ -> sortUtil (hd::acc) rev tl
  sortUtil [] true l 
```

另一方面，您可以使用可变数组实现相同的算法。这将更有效率，并且在 F# 中，如果需要，您也可以使用数组。以下函数创建数组的副本并对其进行排序。

```
let sort (arr:'a[]) = 
  let arr = arr |> Array.copy
  let swap i j = let tmp = arr.[i] in arr.[i] <- arr.[j]; arr.[j] <- tmp
  for i = arr.Length - 1 downto 0 do
    for j = 1 to i do
      if (arr.[j - 1] > arr.[j]) then swap (j-1) j
  arr 
```

托马斯

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-06-12T22:11:05.667

F# 是一种不纯的语言。不要拘泥于纯洁。这是 F# 中更简单、更优雅的不纯冒泡排序：

```
let rec sort (a: int []) =
  let mutable fin = true
  for i in 0..a.Length-2 do
    if a.[i] > a.[i+1] then
      let t = a.[i]
      a.[i] <- a.[i+1]
      a.[i+1] <- t
      fin <- false
  if not fin then sort a 
```

# ms-access - 从包含 155K 记录的表中获取仅在组合框中列出的 65K 记录

> ID：279148
> 
> 赞同：1
> 
> 时间：2008-11-10T20:59:33.657
> 
> 标签：ms-access

我有一个包含 155K 记录的表。我只能在具有带有查询或 sql 的记录源的表单的组合框中滚动 65K 记录，从该表中选择三个字段。为什么它没有列出所有 155K 记录，甚至我用作记录源的查询也显示了表单之外的所有记录。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-10T21:00:34.670

也许项目索引是一个 16 位整数

一个更好的问题是，您真的希望用户在组合框中滚动浏览 155,000 个项目吗？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-14T04:45:45.660

最简单的方法是仅在您在其中键入一些字符后分配组合框的 Rowsource。您可以在组合框的 OnChange 事件中执行此操作：

```
 Dim strRowSource As String

  strRowSource = "SELECT MyID, MyField FROM MyTable"
  If Len(Me!cmbMyCombo.Text)=3 Then
     strRowSource = strRowSource & " WHERE MyField Like '" 
     strRowSource = strRowSource & Me!cmbMyCombo.Text
     strRowSource = strRowSource & "*'"
     Me!cmbMyCombo.RowSource = strRowSource
     Me!cmbMyCombo.DropDown
  End If 
```

当您在组合框中输入内容时，在您输入 3 个字符（或 2 个或 4 个或任何适合将下拉列表过滤为人类可用记录数的任何内容）之前，什么都不会发生，此时行源已分配（并且，如果您愿意，您可以在此时下拉列表，使其更加用户友好）。从那时起，它将像任何普通的组合框一样工作。

如果您需要使用相同的组合框来显示未输入的记录中的数据，那么您可以将组合框的默认 Rowsource 设置为：

```
 PARAMETERS [Forms]![MyForm]![MyField] Text ( 255 );
  SELECT MyID, MyField FROM MyTable WHERE MyField = [Forms]![MyForm]![MyField];" 
```

然后在您的 OnChange 事件中，您将执行以下操作：

```
 Dim strRowSource As String

  strRowSource = "PARAMETERS [Forms]![MyForm]![MyField] Long; "
  strRowSource = strRowSource & "SELECT MyID, MyField FROM MyTable "
  strRowSource = strRowSource & "WHERE MyField = [Forms]![MyForm]![MyID]"
  strRowSource = strRowSource & "UNION SELECT MyID, MyField FROM MyTable"
  If Len(Me!cmbMyCombo.Text)=3 Then
     strRowSource = strRowSource & " WHERE MyField Like '" 
     strRowSource = strRowSource & Me!cmbMyCombo.Text
     strRowSource = strRowSource & "*'"
     Me!cmbMyCombo.RowSource = strRowSource
     Me!cmbMyCombo.DropDown
  End If 
```

然后在表单的 OnCurrent 事件中，您将执行以下操作：

```
 Dim strRowSource As String

  strRowSource = "PARAMETERS [Forms]![MyForm]![MyField] Text ( 255 ); "
  strRowSource = strRowSource & "SELECT MyID, MyField FROM MyTable "
  strRowSource = strRowSource & "WHERE MyField = [Forms]![MyForm]![MyField]"
  Me!cmbMyCombo.RowSource = strRowSource 
```

这样做的目的是确保已分配给组合框绑定到的字段的任何值仍将显示。如果您有一个空白的 RowSource，那将不起作用，因此对该字段的表单当前值的引用并将其与过滤列表联合起来。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T21:06:00.667

另一个人同意这将是一种让用户访问这些数据的疯狂方式。没有人会想要一次解析 100k + 条记录。我会提供一种预先过滤记录的方法，以便只显示当时感兴趣的记录。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T13:44:27.273

尝试诸如增量填充组合框之类的东西。例如，标签搜索在 Stack Overflow 中的工作方式，或 Google Suggest 的工作方式。65k 对于组合框来说已经足够了。普通用户甚至会发现很难从 65 种事物中进行选择

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T21:13:00.650

所以你真正想要的是更多的“自动完成”功能，就像在互联网浏览器中看到的那样？当您说组合框时，每个人都会在下拉菜单中选择用户选择一个项目 - 您可能想澄清您的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T15:41:36.450

作为一般规则，当您在通用且广泛使用的组件（如组合框）上遇到硬编码限制时，是时候重新考虑您的方法了。组合框不是为您的用例设计的，也不足以满足您的用例。从您的项目中退后几步，重新评估您的 UI。也许 ListView 或过滤的数据网格会更合适。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T12:58:10.940

创建一个文本框和列表框组合并不太难，其中列表框在文本框的更改事件中被请求，逐渐缩小选择的项目。这意味着您的用户仍然可以看到一个名称列表，而不是猜测，而是一个更短且更相关的列表。

以下是此类列表框的 RowSource 的示例 SQL：

```
SELECT tp.PersonKey, 
   tp.Surname & ", " & tp.Forename AS PersonName
FROM tblPersons tp
WHERE tp.Surname 
LIKE Forms!MyForm!txtSurname.Text
ORDER BY  tp.Surname, tp.Forename 
```

注意使用文本框的Text属性，这样可以确保使用文本框的当前内容，但这也意味着文本框不能被重新查询，除非txtSurname有焦点，这很好，因为重新查询应该只做在 txtSurname 的更改事件中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T13:16:05.413

在现实世界中很难使用，组合框存储 155k 记录我认为如果将其更改为 [...] 浏览按钮或其他控件，我比这种方式更易于使用

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T21:06:27.000

65536 确实是组合框项目数量的限制。

我建议使用带有搜索按钮的文本框从列表中查找某人，而不是在这种情况下使用组合框。

作为替代方案，您可以根据插入的文本动态加载项目。

您还可以尝试通过表单上先前输入的值“预过滤”您的组合框，以使返回的记录数低于允许的最大值。例如，如果您的表有 100,000 个名称和地址，您将让用户输入（在使用组合框之前）一个邮政编码或用于过滤组合框查询 RecordSource 返回的记录数的状态。

* * *

@Steven A. Lowe and amdfan：你知道[combobox](http://en.wikipedia.org/wiki/Combo_box)是什么，为什么叫combo-box吗？它是一个与列表框相结合的文本框。您键入一个文本，列表框会显示与您的文本匹配的第一个条目。

所以，我想这是一个合理的问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-12-01T18:25:07.987

如果您有一个庞大的列表框，那么我会将其替换为子表单对象内的表（或表单）。组合框和列表框有 65,536 个对象的限制，与子表单中的表、查询或表单相比，它们的加载速度较慢。我在一张表中有 100,000 条记录，它会在瞬间加载。它也很容易滚动，比列表框快得多，这意味着您不需要缩小选择范围。我通常在子表单下方也有一个简单的搜索框。

这有点棘手，因为您必须从父表单引用子表单，反之亦然，但是将所有组合/列表框代码转换为子表单代码非常容易。例如，如果您想在单击子表单中的条目时在主表单中找到匹配的记录：-

```
Private Sub POLICY_NO_Click()
    Set Me.Parent.Recordset = CurrentDb.OpenRecordset("qryHPolicy")
    Me.Parent.Recordset.FindFirst "[POLICY_NO]=" & Me.POLICY_NO & ""
End Sub 
```

或将子表单设置为与主表单相同的记录源：-

```
Forms(Me_FormTo).Form.RecordSource = Me_RecSource
Forms(Me_FormTo).Combo6.Form.RecordSource = Me_RecSource 
```

您可以使您的新子表单外观和工作方式与列表框完全一样，因此当您拥有超过 64k 条记录时，绝对值得一试。

# java - 如何使用 Java DOM 克隆整个文档？

> ID：279154
> 
> 赞同：6
> 
> 时间：2008-11-10T21:01:50.800
> 
> 标签：java, xml, dom

我正在寻找一种可靠的、独立于实现的方法来克隆整个文档。Javadocs 特别指出在 Document 上调用 cloneNode 是特定于实现的。我尝试通过无操作转换器传递文档，但生成的节点没有所有者文档。

我可以创建一个新文档并从旧文档导入节点，但我担心文档元数据可能会丢失。将 Document 写入字符串并将其解析回来也是如此。

有任何想法吗？

顺便说一句，由于我无法控制的原因，我被困在 Java 1.4.2 上。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-01-21T12:31:14.837

正如一些评论指出的那样，序列化和重新解析文档存在问题。除了内存使用、性能考虑和规范化之外，还有 prolog（DTD 或模式）的丢失、注释的潜在丢失（不需要捕获）以及可能是重要空白的丢失。应避免序列化。

如果真正的目标是复制现有的 DOM Document 对象，那么它应该在内存中以编程方式处理。值得庆幸的是，有一种相对简单的方法可以使用 Java 5 中提供的功能或使用外部 XSLT 库（如 Xalan）来执行此操作，即传递转换。

下面显示了 Java 5 解决方案：

```
TransformerFactory tfactory = TransformerFactory.newInstance();
Transformer tx   = tfactory.newTransformer();
DOMSource source = new DOMSource(doc);
DOMResult result = new DOMResult();
tx.transform(source,result);
return (Document)result.getNode(); 
```

基本上就是这样。您需要处理异常并可能希望配置转换器，但我将其留给读者作为练习。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T00:58:56.360

仍然，快速'n'dirty 方法怎么样：将整个文档序列化为 XML 字符串，然后使用 DOM Parser 将其解析回来？

我看不出序列化版本缺少任何东西的原因。介意提供一个例子吗？

内存消耗会很大，但是另一方面，如果您要复制整个 DOM，它无论如何都不会小...

# oop - 如何将组合与继承结合使用？

> ID：279158
> 
> 赞同：7
> 
> 时间：2008-11-10T21:02:23.077
> 
> 标签：oop, inheritance, composition, ooad, car-analogy

我将尝试在一个简单的例子中提出我的问题......

假设我有一个抽象基类 Car。汽车有一个基本的引擎对象。我在抽象 Car 类中有一个方法 StartEngine() ，它将引擎的启动委托给 Engine 对象。

如何允许 Car 的子类（例如 Ferrari）将 Engine 对象声明为特定类型的引擎（例如 TurboEngine）？我需要另一个汽车类（TurboCar）吗？

我继承了一个普通的旧 Engine 对象，我无法在我的 Car 子类中将它重新声明（或覆盖）为 TurboEngine。

**编辑：** 我知道我可以将 Engine 的任何子类插入到我的 Ferrari 类中的 myEngine 引用中......但是我怎样才能调用只有 TurboEngine 公开的方法？因为 myEngine 是作为基础引擎继承的，所以不包括任何涡轮增压的东西。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-10T21:07:02.630

抽象工厂模式正是针对这个问题。Google GoF Abstract Factory {您的首选语言}

在下文中，请注意如何使用具体工厂来生成“完整”对象（enzo、civic），或者您可以使用它们来生成相关对象的“族”（CarbonFrame + TurboEngine、WeakFrame + WeakEngine）。最终，您总是会得到一个 Car 对象，该对象以特定类型的行为响应Accelerator()。

* * *

```
 using System;

    abstract class CarFactory
    {
        public static CarFactory FactoryFor(string manufacturer){
            switch(manufacturer){
                case "Ferrari" : return new FerrariFactory();
                case "Honda" : return new HondaFactory();
                default:
                    throw new ArgumentException("Unknown car manufacturer. Please bailout industry.");
            }
        }

        public abstract Car createCar();
        public abstract Engine createEngine();
        public abstract Frame createFrame();

    }

    class FerrariFactory : CarFactory
    {
        public override Car createCar()
        {
            return new Ferrari(createEngine(), createFrame());
        }

        public override Engine createEngine()
        {
            return new TurboEngine();
        }

        public override Frame createFrame()
        {
            return new CarbonFrame();
        }
    }

    class HondaFactory : CarFactory
    {
        public override Car createCar()
        {
            return new Honda(createEngine(), createFrame());
        }

        public override Engine createEngine()
        {
            return new WeakEngine();
        }

        public override Frame createFrame()
        {
            return new WeakFrame();
        }
    }

    abstract class Car
    {
        private Engine engine;
        private Frame frame;

        public Car(Engine engine, Frame frame)
        {
            this.engine = engine;
            this.frame = frame;
        }

        public void accelerate()
        {
            engine.setThrottle(1.0f);
            frame.respondToSpeed();
        }

    }

    class Ferrari : Car
    {
        public Ferrari(Engine engine, Frame frame) : base(engine, frame)
        {
            Console.WriteLine("Setting sticker price to $250K");
        }
    }

    class Honda : Car
    {
        public Honda(Engine engine, Frame frame) : base(engine, frame)
        {
            Console.WriteLine("Setting sticker price to $25K");
        }
    }

    class KitCar : Car
    {
        public KitCar(String name, Engine engine, Frame frame)
            : base(engine, frame)
        {
            Console.WriteLine("Going out in the garage and building myself a " + name);
        }
    }

    abstract class Engine
    {
        public void setThrottle(float percent)
        {
            Console.WriteLine("Stomping on accelerator!");
            typeSpecificAcceleration();
        }

        protected abstract void typeSpecificAcceleration();
    }

    class TurboEngine : Engine
    {
        protected override void typeSpecificAcceleration()
        {
            Console.WriteLine("Activating turbo");
            Console.WriteLine("Making noise like Barry White gargling wasps");
        }
    }

    class WeakEngine : Engine
    {
        protected override void typeSpecificAcceleration()
        {
            Console.WriteLine("Provoking hamster to run faster");
            Console.WriteLine("Whining like a dentist's drill");
        }
    }

    abstract class Frame
    {
        public abstract void respondToSpeed();
    }

    class CarbonFrame : Frame
    {
        public override void respondToSpeed()
        {
            Console.WriteLine("Activating active suspension and extending spoilers");
        }
    }

    class WeakFrame : Frame
    {
        public override void respondToSpeed()
        {
            Console.WriteLine("Loosening bolts and vibrating");
        }
    }

    class TestClass
    {
        public static void Main()
        {
            CarFactory ferrariFactory = CarFactory.FactoryFor("Ferrari");
            Car enzo = ferrariFactory.createCar();
            enzo.accelerate();

            Console.WriteLine("---");
            CarFactory hondaFactory = CarFactory.FactoryFor("Honda");
            Car civic = hondaFactory.createCar();
            civic.accelerate();

            Console.WriteLine("---");
            Frame frame = hondaFactory.createFrame();
            Engine engine = ferrariFactory.createEngine();
            Car kitCar = new KitCar("Shaker", engine, frame);
            kitCar.accelerate();

            Console.WriteLine("---");
            Car kitCar2 = new KitCar("LooksGreatGoesSlow", hondaFactory.createEngine(), ferrariFactory.createFrame());
            kitCar2.accelerate();
        }
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T21:16:07.073

只要 TurboEngine 是 Engine 的子类，就不需要指定 Car 的子类来拥有 TurboEngine。您可以指定一个 TurboEngine 实例作为您的法拉利引擎。您甚至可以在您的法拉利中安装柴油发动机。他们都只是引擎。

汽车有引擎。TurboEngine 是一个引擎。汽车可以有涡轮发动机或柴油发动机或燧石发动机。他们都是引擎。

如果您想在 Car 子类中限制 Engine 的类型（SportsCar 中没有 LawnMowerEngine），您可以将其声明为 Engine 并在 setter 方法中对其进行限制。

Car 具有 Engine 关系并不限制 Engine 的适用子类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T21:21:44.347

您始终可以使用受保护的摘要。公共“开始”将调用受保护的（这将在抽象类中被 ovveride）。这样调用者只能看到 Start() 而不是 StartEngine()。

```
abstract class Car {
    private Engine engine;

    public Car() {
        this.engine = new Engine();
    }

    protected Car(Engine engine) {
        this.engine = engine;
    }

    public void Start()
    {
        this.StartEngine();
    }
    protected abstract void StartEngine();
}

public class Ferrari : Car
{
    public Ferrari() {

    }
    protected override void StartEngine()
    {
        Console.WriteLine("TURBO ENABLE!!!");
    }

} 
```

- 使用方法：

```
Car c = new Ferrari();
c.Start(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T21:12:08.110

根据您的特定语言语义，有几种方法可以做到这一点。我最初的想法是提供一个受保护的构造函数：

```
public class Car {
    private Engine engine;

    public Car() {
        this(new Engine());
    }

    protected Car(Engine engine) {
        this.engine = engine;
    }

    public void start() {
        this.engine.start();
    }
}

public class Ferrari {
    public Ferrari() {
        super(new TurboEngine());
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T21:28:08.373

我认为这会奏效。

```
public class Car
{
    private Engine engine;
    public virtual Engine CarEngine
    {
        get { return engine;}
    }

    public StartEngine()
    {
         CarEngine.Start();
    }
}

public class Engine
{
     public virtual void Start()
     {
         Console.Writeline("Vroom");
     }
} 

public class TurboEngine : Engine
{
    public override void Start()
    {
        Console.Writeline("Vroom pSHHHHHHH");
    }    

    // TurboEngine Only method
    public double BoostPressure()
    {
    }
}

public class Ferrari : Car
{
    private TurboEngine engine;
    public override Engine CarEngine
    {
         return engine;
    }
}

Ferrari = car new Ferrari();
// Will call Start on TurboEngine()
car.StartEngine();
// Upcast to get TurboEngine stuff
Console.WriteLine(car.CarEngine as TurboEngine).BoostPressure(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T22:05:57.660

你的语言有泛型吗？在Java中我可以这样做：

```
class Engine {}

abstract class Car<E extends Engine> 
{
    private E engine;
    public E getEngine() { return engine; } 
}

class TurboEngine extends Engine {}

class Ferrari extends Car<TurboEngine> 
{
    // Ferrari now has a method with this signature:
    // public TurboEngine getEngine() {} 
} 
```

我确信 C# 中也有类似的东西。然后，您可以将 Ferrari 的实例视为 Ferrari 子类的实例（getEngine 返回 TurboEngine）或 Car 超类的实例（此时 getEngine 将返回 Engine）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T22:07:21.633

您可以在此处使用 C# 泛型来获取所需的内容。

使用泛型的区别在于你`Ferrari`“知道”它的`Engine`is-a `TurboEngine`，而`Car`类不必知道任何新的东西——只有`EngineType`is-an `Engine`。

```
class Program
{
    static void Main(string[] args)
    {
        Ferrari ferarri = new Ferrari();
        ferarri.Start();
        ferarri.Boost();
    }
}
public class Car<EngineType> where EngineType : Engine, new()
{
    protected EngineType engine;

    public Car()
    {
        this.CreateEngine();
    }
    protected void CreateEngine()
    {
        this.engine = new EngineType();
    }
    public void Start()
    {
        engine.Start();
    }
}

public class Ferrari : Car<TurboEngine>
{
    public void Boost()
    {
        engine.Boost();
    }
}

public class Engine
{
    public virtual void Start()
    {
        Console.WriteLine("Vroom!");
    }
}
public class TurboEngine : Engine
{
    public void Boost()
    {
        Console.WriteLine("Hang on to your teeth...");
    }
    public override void Start()
    {
        Console.WriteLine("VROOOOM! VROOOOM!");
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T22:10:00.803

`TurboEngine`据我了解你的（更新的）问题，如果你想调用它的方法，你将不得不将汽车的引擎转换为类型`TurboEngine`。这会导致在调用这些方法之前进行大量检查以查看您拥有的汽车是否具有`TurboEngine`，但这就是您得到的。不知道这辆车实际上代表什么，我想不出任何理由你不能让发动机和涡轮发动机共享相同的界面 - 涡轮增压器是否真的支持新方法，或者它只是做同样的事情不同 - 但我想这个比喻迟早会分崩离析。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T21:06:32.850

有很多方法可以做到。

我希望有一个`setEngine()`方法 on `Car`，然后`Ferrari`调用构造函数`setEngine()`并传入一个`TurboEngine`.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-10T21:07:11.070

不要在接口中暴露你的类的内部——换句话说，Car 的公共方法应该是 Start，而不是 StartEngine

如果你想强加一个内部结构（即只有一个引擎），那么你需要另一个可以专门化的抽象/基类引擎。

然后您可以通过将 m_engine 成员设置为 Engine 的运动子类等来用零件构造一辆跑车

编辑：请注意，在现实世界中，涡轮增压器不是发动机的一部分，它是发动机的附加组件，具有自己的控制界面......但如果你想在你的法拉利发动机中包含这样的东西，没关系，只需在 SportsCar 子类中向上转换，以使您的基础引擎成为 TurboEngine

但将组件分开会更好的建模 - 这样您就可以升级您的涡轮增压器（例如双进气口与单进气口），而无需更换整个发动机！

# .net - 有人知道关于 Crystal Reports for Visual Studio 工作原理的好教程吗？

> ID：279159
> 
> 赞同：2
> 
> 时间：2008-11-10T21:02:36.040
> 
> 标签：.net, crystal-reports, visual-studio-2003

我被困在使用 Visual Studio 2003 附带的 Crystal Reports 9.1.5 的自定义应用程序生成的报告中。除了编辑器是我曾经使用过的最令人恼火的东西之一之外，我也是不断受到与代码生成引擎有关的各种问题的困扰。

有谁知道某种教程的存在，它将向我解释这一切是如何工作的，所以感觉不像我在黑暗中摸索？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T15:20:08.560

不知道为什么你坚持使用那个版本的 CR。如果您至少可以升级到 CR XI 开发者版，那您的处境会更好。将它们集成到你的 VS 项目中有点笨拙，但你可以试试这个博客作为初学者： [http ://weblogs.asp.net/jgaylord/archive/2007/01/24/crystal-reports-merge-modules.aspx](http://weblogs.asp.net/jgaylord/archive/2007/01/24/crystal-reports-merge-modules.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T21:23:55.310

我知道没有教程，对不起

但我绝对可以推荐使用数据集作为数据源，而不是直接连接

并期望一遍又一遍地写同样愚蠢的小格式化表达式......

# git - 使用 Git 推送部署项目

> ID：279169
> 
> 赞同：417
> 
> 时间：2008-11-10T21:04:51.480
> 
> 标签：git, deployment, webserver, githooks

是否可以使用 部署网站`git push`？我有一种预感，它与使用[git hooks](http://www.git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)在服务器端执行 a`git reset --hard`有关，但我将如何实现这一点？

* * *

## 回答 #1

> 赞同：289
> 
> 时间：2008-11-29T07:37:25.777

我在[这个网站上找到](http://git.or.cz/gitwiki/GitFaq#head-b96f48bc9c925074be9f95c0fce69bcece5f6e73)[了这个脚本](https://stackoverflow.com/questions/279169/deploy-php-using-git/3387030#3387030)，它似乎工作得很好。

1.  将您的 .git 目录复制到您的 Web 服务器
2.  在您的本地副本上，修改您的 .git/config 文件并将您的 Web 服务器添加为远程：

    ```
    [remote "production"]
        url = username@webserver:/path/to/htdocs/.git 
    ```

3.  在服务器上，用[这个文件](https://stackoverflow.com/questions/279169/deploy-php-using-git/3387030#3387030)替换 .git/hooks/post-update （在下面的答案中）

4.  添加对文件的执行访问权限（同样，在服务器上）：

    ```
    chmod +x .git/hooks/post-update 
    ```

5.  现在，只需在本地推送到您的 Web 服务器，它就会自动更新工作副本：

    ```
    git push production 
    ```

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2010-08-02T10:53:18.337

使用下面**的更新后**文件：

1.  将您的 .git 目录复制到您的 Web 服务器
2.  在您的本地副本上，修改您的 .git/config 文件并将您的 Web 服务器添加为远程：

    ```
    [remote "production"]
        url = username@webserver:/path/to/htdocs/.git 
    ```

3.  在服务器上，将 .git/hooks/post-update 替换为以下文件

4.  添加对文件的执行访问权限（同样，在服务器上）：

    ```
    chmod +x .git/hooks/post-update 
    ```

5.  现在，只需在本地推送到您的 Web 服务器，它就会自动更新工作副本：

    ```
    git push production 
    ```

```
#!/bin/sh
#
# This hook does two things:
#
#  1\. update the "info" files that allow the list of references to be
#     queries over dumb transports such as http
#
#  2\. if this repository looks like it is a non-bare repository, and
#     the checked-out branch is pushed to, then update the working copy.
#     This makes "push" function somewhat similarly to darcs and bzr.
#
# To enable this hook, make this file executable by "chmod +x post-update". 
git-update-server-info 
is_bare=$(git-config --get --bool core.bare) 
if [ -z "$is_bare" ]
then
      # for compatibility's sake, guess
      git_dir_full=$(cd $GIT_DIR; pwd)
      case $git_dir_full in */.git) is_bare=false;; *) is_bare=true;; esac
fi 
update_wc() {
      ref=$1
      echo "Push to checked out branch $ref" >&2
      if [ ! -f $GIT_DIR/logs/HEAD ]
      then
             echo "E:push to non-bare repository requires a HEAD reflog" >&2
             exit 1
      fi
      if (cd $GIT_WORK_TREE; git-diff-files -q --exit-code >/dev/null)
      then
             wc_dirty=0
      else
             echo "W:unstaged changes found in working copy" >&2
             wc_dirty=1
             desc="working copy"
      fi
      if git diff-index --cached HEAD@{1} >/dev/null
      then
             index_dirty=0
      else
             echo "W:uncommitted, staged changes found" >&2
             index_dirty=1
             if [ -n "$desc" ]
             then
                   desc="$desc and index"
             else
                   desc="index"
             fi
      fi
      if [ "$wc_dirty" -ne 0 -o "$index_dirty" -ne 0 ]
      then
             new=$(git rev-parse HEAD)
             echo "W:stashing dirty $desc - see git-stash(1)" >&2
             ( trap 'echo trapped $$; git symbolic-ref HEAD "'"$ref"'"' 2 3 13 15 ERR EXIT
             git-update-ref --no-deref HEAD HEAD@{1}
             cd $GIT_WORK_TREE
             git stash save "dirty $desc before update to $new";
             git-symbolic-ref HEAD "$ref"
             )
      fi 
      # eye candy - show the WC updates :)
      echo "Updating working copy" >&2
      (cd $GIT_WORK_TREE
      git-diff-index -R --name-status HEAD >&2
      git-reset --hard HEAD)
} 
if [ "$is_bare" = "false" ]
then
      active_branch=`git-symbolic-ref HEAD`
      export GIT_DIR=$(cd $GIT_DIR; pwd)
      GIT_WORK_TREE=${GIT_WORK_TREE-..}
      for ref
      do
             if [ "$ref" = "$active_branch" ]
             then
                   update_wc $ref
             fi
      done
fi 
```

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2011-03-03T06:31:02.370

经过许多错误的开始和死胡同，感谢[这篇文章，我终于能够使用“git push](http://toroid.org/ams/git-website-howto) *remote* ”部署网站代码。

作者的更新后脚本只有一行，他的解决方案不需要 .htaccess 配置来像其他人那样隐藏 Git 存储库。

如果您将其部署在 Amazon EC2 实例上，则会遇到一些障碍；

1) 如果使用 sudo 创建裸目标存储库，则必须将存储库的所有者更改为 ec2-user 否则推送将失败。（尝试“chown ec2-user:ec2-user *repo*。”）

2) 如果您没有在 /etc/ssh/ *ssh_config*作为 IdentityFile 参数或在 ~/.ssh/config 中使用“[ Host] - HostName - IdentityFile - User"[此处](http://perlbuzz.com/mechanix/2010/05/handling-multiple-ssh-keys-in.html)描述的布局...

...但是，如果 Host 在 ~/.ssh/config 中配置并且与 HostName 不同，则 Git 推送将失败。（这可能是一个 Git 错误）

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2011-08-24T06:54:09.413

不要在服务器上安装 git 或复制 .git 文件夹。要从 git clone 更新服务器，您可以使用以下命令：

```
git ls-files -z | rsync --files-from - --copy-links -av0 . user@server.com:/var/www/project 
```

您可能必须删除从项目中删除的文件。

这会复制所有签入的文件。rsync 使用无论如何都安装在服务器上的 ssh。

您在服务器上安装的软件越少，他就越安全，并且越容易管理其配置和记录它。也不需要在服务器上保留完整的 git clone。它只会使正确保护一切变得更加复杂。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2010-05-10T21:33:23.407

本质上，您需要做的就是以下几点：

```
server = $1
branch = $2
git push $server $branch
ssh <username>@$server "cd /path/to/www; git pull" 
```

我在我的应用程序中将这些行作为一个名为`deploy`.

所以当我想进行部署时，我输入`./deploy myserver mybranch`.

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2015-02-07T10:51:05.653

**`git config --local receive.denyCurrentBranch updateInstead`**

在 Git 2.3 中添加，这可能是一个很好的可能性：[https ://github.com/git/git/blob/v2.3.0/Documentation/config.txt#L2155](https://github.com/git/git/blob/v2.3.0/Documentation/config.txt#L2155)

您在服务器存储库上设置它，如果它是干净的，它还会更新工作树。

[`push-to-checkout`2.4对未出生分支](https://github.com/blog/1994-git-2-4-atomic-pushes-push-to-deploy-and-more)的钩子和处理进行了进一步的改进。

示例用法：

```
git init server
cd server
touch a
git add .
git commit -m 0
git config --local receive.denyCurrentBranch updateInstead

cd ..
git clone server local
cd local
touch b
git add .
git commit -m 1
git push origin master:master

cd ../server
ls 
```

输出：

```
a
b 
```

这确实有以下[GitHub公告中提到的](https://github.com/blog/1957-git-2-3-has-been-released)缺点：

*   您的服务器将包含一个 .git 目录，其中包含您项目的整个历史记录。您可能需要额外确保它不能提供给用户！
*   在部署过程中，用户可能会瞬间遇到站点状态不一致的情况，有的文件在旧版本，有的在新版本，甚至是写了一半的文件。如果这对您的项目来说是个问题，那么推送部署可能不适合您。
*   如果您的项目需要“构建”步骤，那么您必须明确设置它，也许通过 githooks。

但所有这些都超出了 Git 的范围，必须由外部代码处理。所以从这个意义上说，这与 Git 挂钩是最终的解决方案。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-11-10T21:16:41.143

我这样做的方式是在我的部署服务器上有一个裸 Git 存储库，用于推送更改。然后我登录到部署服务器，切换到实际的 Web 服务器 docs 目录，然后执行 git pull。我不使用任何钩子来尝试自动执行此操作，这似乎比它的价值更麻烦。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-11-26T16:21:00.500

更新：我现在将**Lloyd Moore**解决方案与 key agent 一起使用`ssh -A ...`。推送到主存储库，然后从所有机器并行提取它会更快一些，并且需要在这些机器上进行更少的设置。

* * *

在这里没有看到这个解决方案。如果服务器上安装了 git，只需通过 ssh 推送。

您需要在本地 .git/config 中添加以下条目

```
[remote "amazon"]
    url = amazon:/path/to/project.git
    fetch = +refs/heads/*:refs/remotes/amazon/* 
```

但是，嘿，那是什么`amazon:`？在您的本地 ~/.ssh/config 中，您需要添加以下条目：

```
Host amazon
    Hostname <YOUR_IP>
    User <USER>
    IdentityFile ~/.ssh/amazon-private-key 
```

现在你可以打电话了

```
git push amazon master
ssh <USER>@<YOUR_IP> 'cd /path/to/project && git pull' 
```

（顺便说一句：/path/to/project.git 与实际工作目录/path/to/project 不同）

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-11-29T18:16:38.977

我们使用[capistrano](https://github.com/capistrano/capistrano)来管理部署。我们构建 capistrano 以部署在临时服务器上，然后与我们所有的服务器运行 rsync。

```
cap deploy
cap deploy:start_rsync (when the staging is ok) 
```

使用 capistrano，我们可以在出现错误时轻松回滚

```
cap deploy:rollback
cap deploy:start_rsync 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2015-10-17T09:45:01.577

## 对于部署场景

在我们的场景中，我们将代码存储在 github/bitbucket 上，并希望部署到实时服务器。在这种情况下，以下组合对我们*有用（这是此处高度赞成的答案的混合）*：

1.  将您的目录复制`.git`到您的网络服务器
2.  在您的本地副本上`git remote add live ssh://user@host:port/folder`
3.  在远程：`git config receive.denyCurrentBranch ignore`
4.  在远程：`nano .git/hooks/post-receive`并添加此内容：

    `#!/bin/sh GIT_WORK_TREE=/var/www/vhosts/example.org git checkout -f`

5.  在远程：`chmod +x .git/hooks/post-receive`

6.  现在你可以用`git push live`

### 笔记

*   此解决方案适用于较旧的 git 版本（使用 1.7 和 1.9 测试）
*   你需要确保先推送到 github/bitbucket，这样你就可以在 live 上有一个一致的 repo
*   如果您的`.git`文件夹位于文档根目录中，请确保通过添加`.htaccess`（[源](https://github.com/phanan/htaccess#deny-access-to-hidden-files-and-directories)）将其从外部隐藏：

    `RedirectMatch 404 /\..*$`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-10-11T14:15:01.407

[Giddyup](https://github.com/mpalmer/giddyup)是与语言无关的*just-add-water* git 挂钩，可通过 git push 自动部署。它还允许您使用自定义启动/停止挂钩来重新启动 Web 服务器、预热缓存等。

[https://github.com/mpalmer/giddyup](https://github.com/mpalmer/giddyup)

查看[示例](https://github.com/mpalmer/giddyup/tree/master/examples)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-18T19:43:59.977

听起来您的服务器上应该有两个副本。一个裸副本，您可以从中推送/拉取，完成后您将推送您的更改，然后您将其克隆到您的 Web 目录并设置一个 cronjob 以每天从您的 Web 目录更新 git pull 或所以。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-18T20:28:04.740

您可以想象设置一个 git 钩子，当说提交说“稳定”分支时，它会提取更改并将它们应用到 PHP 站点。最大的缺点是，如果出现问题，您将无法进行太多控制，并且会增加测试时间 - 但是您可以了解当您将主干分支合并到稳定分支时将涉及多少工作以了解你*可能会*遇到多少冲突。密切关注任何特定于站点的文件（例如配置文件）非常重要，除非您只打算只运行一个站点。

或者，您是否考虑过将更改推送到网站？

有关 git 挂钩的信息，请参阅[githooks](http://www.kernel.org/pub/software/scm/git/docs/v1.6.0.4/githooks.html)文档。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-09-06T22:01:36.917

我对[基督徒](https://stackoverflow.com/questions/279169/deploy-a-project-using-git-push#answer-7171562)解决方案的看法。

```
git archive --prefix=deploy/  master | tar -x -C $TMPDIR | rsync $TMPDIR/deploy/ --copy-links -av username@server.com:/home/user/my_app && rm -rf $TMPDIR/deploy 
```

*   将 master 分支归档到 tar
*   将 tar 存档提取到系统临时文件夹中的部署目录中。
*   rsync 更改为服务器
*   从临时文件夹中删除部署目录。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-03-21T11:43:43.870

我正在使用[toroid.org](http://toroid.org/ams/git-website-howto)的以下解决方案，它有一个更简单的钩子脚本。

在服务器上：

```
$ mkdir website.git && cd website.git
$ git init --bare
Initialized empty Git repository in /home/ams/website.git/ 
```

并在服务器上安装钩子：

```
$ mkdir /var/www/www.example.org
$ cat > hooks/post-receive
#!/bin/sh
GIT_WORK_TREE=/var/www/www.example.org git checkout -f
GIT_WORK_TREE=/var/www/www git clean -f -d # clean directory from removed files

$ chmod +x hooks/post-receive 
```

在您的客户上：

```
$ mkdir website && cd website
$ git init
Initialized empty Git repository in /home/ams/website/.git/
$ echo 'Hello, world!' > index.html
$ git add index.html
$ git commit -q -m "The humble beginnings of my web site."

$ git remote add web ssh://server.example.org/home/ams/website.git
$ git push web +master:refs/heads/master 
```

然后发布，只需键入

```
$ git push web 
```

网站上有完整的描述：http: [//toroid.org/ams/git-website-howto](http://toroid.org/ams/git-website-howto)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-05-04T11:55:41.030

作为补充答案，我想提供一个替代方案。我正在使用 git-ftp，它工作正常。

[https://github.com/git-ftp/git-ftp](https://github.com/git-ftp/git-ftp)

易于使用，只需键入：

```
git ftp push 
```

git会自动上传项目文件。

问候

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-09-16T11:04:30.637

鉴于您有多个开发人员访问同一存储库的环境，以下指南可能会有所帮助。

确保您有一个所有开发人员都属于的 unix 组，并将 .git 存储库的所有权授予该组。

1.  在服务器存储库的 .git/config 中设置 sharedrepository = true。（这告诉 git 允许提交和部署所需的多个用户。

2.  将每个用户的 bashrc 文件中的 umask 设置为相同 - 002 是一个好的开始

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-05-07T20:50:18.473

我最终创建了自己的基本部署工具，该工具会自动从 repo 中提取新更新 - [https://github.com/jesalg/SlimJim](https://github.com/jesalg/SlimJim) - 基本上它会监听 github post-receive-hook 并使用代理来触发更新脚本。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-02-15T10:42:27.420

我对 post-receive hook 使用了两种解决方案：

**部署解决方案 1**

```
#!/bin/bash 
#  /git-repo/hooks/post-receive - file content on server (chmod as 755 to be executed)
# DEPLOY SOLUTION 1 

    export GIT_DIR=/git/repo-bare.git
    export GIT_BRANCH1=master
    export GIT_TARGET1=/var/www/html
    export GIT_BRANCH2=dev
    export GIT_TARGET2=/var/www/dev
    echo "GIT DIR:  $GIT_DIR/"
    echo "GIT TARGET1:  $GIT_TARGET1/"
    echo "GIT BRANCH1:  $GIT_BRANCH1/"
    echo "GIT TARGET2:  $GIT_TARGET2/"
    echo "GIT BRANCH2:  $GIT_BRANCH2/"
    echo ""

    cd $GIT_DIR/

while read oldrev newrev refname
do
    branch=$(git rev-parse --abbrev-ref $refname)
    BRANCH_REGEX='^${GIT_BRANCH1}.*$'
    if [[ $branch =~ $BRANCH_REGEX ]] ; then
        export GIT_WORK_TREE=$GIT_TARGET1/.
        echo "Checking out branch: $branch";
        echo "Checking out to workdir: $GIT_WORK_TREE"; 

        git checkout -f $branch
    fi

    BRANCH_REGEX='^${GIT_BRANCH2}.*$'
    if [[ $branch =~ $BRANCH_REGEX ]] ; then
        export GIT_WORK_TREE=$GIT_TARGET2/.
        echo "Checking out branch: $branch";
        echo "Checking out to workdir: $GIT_WORK_TREE"; 

        git checkout -f $branch
    fi
done 
```

**部署解决方案 2**

```
#!/bin/bash 
#  /git-repo/hooks/post-receive - file content on server (chmod as 755 to be executed)
# DEPLOY SOLUTION 2

    export GIT_DIR=/git/repo-bare.git
    export GIT_BRANCH1=master
    export GIT_TARGET1=/var/www/html
    export GIT_BRANCH2=dev
    export GIT_TARGET2=/var/www/dev
    export GIT_TEMP_DIR1=/tmp/deploy1
    export GIT_TEMP_DIR2=/tmp/deploy2
    echo "GIT DIR:  $GIT_DIR/"
    echo "GIT TARGET1:  $GIT_TARGET1/"
    echo "GIT BRANCH1:  $GIT_BRANCH1/"
    echo "GIT TARGET2:  $GIT_TARGET2/"
    echo "GIT BRANCH2:  $GIT_BRANCH2/"
    echo "GIT TEMP DIR1:  $GIT_TEMP_DIR1/"
    echo "GIT TEMP DIR2:  $GIT_TEMP_DIR2/"
    echo ""

    cd $GIT_DIR/

while read oldrev newrev refname
do
    branch=$(git rev-parse --abbrev-ref $refname)
    BRANCH_REGEX='^${GIT_BRANCH1}.*$'
    if [[ $branch =~ $BRANCH_REGEX ]] ; then
        export GIT_WORK_TREE=$GIT_TARGET1/.
        echo "Checking out branch: $branch";
        echo "Checking out to workdir: $GIT_WORK_TREE"; 

        # DEPLOY SOLUTION 2: 
        cd $GIT_DIR/; mkdir -p $GIT_TEMP_DIR1; 
        export GIT_WORK_TREE=$GIT_TEMP_DIR1/.
        git checkout -f $branch
        export GIT_WORK_TREE=$GIT_TARGET1/.
        rsync $GIT_TEMP_DIR1/. -v -q --delete --delete-after -av $GIT_TARGET1/.
        rm -rf $GIT_TEMP_DIR1
    fi

    BRANCH_REGEX='^${GIT_BRANCH2}.*$'
    if [[ $branch =~ $BRANCH_REGEX ]] ; then
        export GIT_WORK_TREE=$GIT_TARGET2/.
        echo "Checking out branch: $branch";
        echo "Checking out to workdir: $GIT_WORK_TREE"; 

        # DEPLOY SOLUTION 2: 
        cd $GIT_DIR/; mkdir -p $GIT_TEMP_DIR2; 
        export GIT_WORK_TREE=$GIT_TEMP_DIR2/.
        git checkout -f $branch
        export GIT_WORK_TREE=$GIT_TARGET2/.
        rsync $GIT_TEMP_DIR2/. -v -q --delete --delete-after -av $GIT_TARGET2/.
        rm -rf $GIT_TEMP_DIR2
    fi
done 
```

这两种解决方案都基于此线程中可用的早期解决方案。

注意，BRANCH_REGEX='^${GIT_BRANCH1}。*$' 过滤与“master”或“dev*”字符串匹配的分支名称*，如果推送的分支匹配，则部署工作树。这使得将开发版本和主版本部署到不同的地方成为可能。

DEPLOY SOLUTION 1 仅删除作为 repo 一部分的文件，并被提交删除。它比部署解决方案 2 更快。

DEPLOY SOLUTION 2 的优点是，它将从生产目录中删除任何新文件，这些文件是在服务器端添加的，无论它是否添加到 repo 中。它将永远是回购的干净骗局。它比部署解决方案 1 慢。

# php - 一直到UTF-8

> ID：279170
> 
> 赞同：1298
> 
> 时间：2008-11-10T21:04:56.767
> 
> 标签：php, mysql, linux, apache, utf-8

我正在设置一个新服务器并希望在我的 Web 应用程序中完全支持 UTF-8。我过去曾在现有服务器上尝试过此方法，但似乎总是不得不退回到 ISO-8859-1。

我到底需要在哪里设置编码/字符集？我知道我需要配置 Apache、MySQL 和 PHP 来执行此操作 — 是否有一些我可以遵循的标准清单，或者可能解决不匹配的位置？

这是一个新的 Linux 服务器，运行 MySQL 5、PHP、5 和 Apache 2。

* * *

## 回答 #1

> 赞同：1093
> 
> 时间：2008-11-10T21:43:05.257

**数据存储**：

*   指定`utf8mb4`数据库中所有表和文本列的字符集。这使得 MySQL 在物理上存储和检索以 UTF-8 原生编码的值。请注意，如果指定了排序规则（没有任何显式字符集） ，MySQL 将隐式使用`utf8mb4`编码。`utf8mb4_*`

*   在旧版本的 MySQL (< 5.5.3) 中，不幸的是，您将被迫使用 simple `utf8`，它仅支持 Unicode 字符的子集。我希望我在开玩笑。

**数据访问**：

*   在您的应用程序代码（例如 PHP）中，无论您使用何种 DB 访问方法，您都需要将连接字符集设置为`utf8mb4`. 这样，当 MySQL 将数据传递给您的应用程序时，它不会从其本机 UTF-8 进行转换，反之亦然。

*   一些驱动程序提供了自己的机制来配置连接字符集，它既可以更新自己的内部状态，又可以通知 MySQL 要在连接上使用的编码——这通常是首选方法。在 PHP 中：

    *   如果您使用 PHP ≥ 5.3.6 的[PDO](http://www.php.net/manual/en/book.pdo.php)抽象层，您可以`charset`在[DSN](http://php.net/manual/en/ref.pdo-mysql.connection.php)中指定：

        ```
         $dbh = new PDO('mysql:charset=utf8mb4'); 
        ```

    *   如果您使用的是[mysqli](http://www.php.net/manual/en/book.mysqli.php)，您可以致电[`set_charset()`](http://php.net/manual/en/mysqli.set-charset.php)：

        ```
         $mysqli->set_charset('utf8mb4');       // object oriented style
          mysqli_set_charset($link, 'utf8mb4');  // procedural style 
        ```

    *   如果你坚持使用普通的[mysql](http://php.net/manual/en/book.mysql.php)但碰巧运行的是 PHP ≥ 5.2.3，你可以调用[`mysql_set_charset`](http://php.net/manual/en/function.mysql-set-charset.php).

*   如果驱动程序没有提供自己的设置连接字符集的机制，您可能必须发出一个查询来告诉 MySQL 您的应用程序希望如何对连接上的数据进行编码：[`SET NAMES 'utf8mb4'`](http://dev.mysql.com/doc/en/charset-connection.html).

*   关于`utf8mb4`/的考虑与`utf8`上述相同。

**输出**：

*   UTF-8 应设置在 HTTP 标头中，例如`Content-Type: text/html; charset=utf-8`. 您可以通过[`default_charset`](http://www.php.net/manual/en/ini.core.php#ini.default-charset)在 php.ini 中设置（首选）或手动使用`header()`函数来实现。
*   如果您的应用程序将文本传输到其他系统，则还需要告知它们字符编码。对于 Web 应用程序，必须通知浏览器发送数据的编码（通过 HTTP 响应标头或[HTML 元数据](https://stackoverflow.com/q/4696499)）。
*   使用 对输出进行编码时`json_encode()`，添加`JSON_UNESCAPED_UNICODE`为第二个参数。

**输入**：

*   浏览器将以为文档指定的字符集提交数据，因此无需对输入进行任何特殊处理。
*   如果您对请求编码有疑问（以防它可能被篡改），您可以在尝试存储或在任何地方使用它之前验证每个接收到的字符串是否为有效的 UTF-8。PHP[`mb_check_encoding()`](http://php.net/manual/en/function.mb-check-encoding.php)可以解决问题，但您必须虔诚地使用它。确实没有办法解决这个问题，因为恶意客户端可以以他们想要的任何编码提交数据，而我还没有找到让 PHP 可靠地为您执行此操作的技巧。

**其他代码注意事项**：

*   显然，您将提供的所有文件（PHP、HTML、JavaScript 等）都应该以有效的 UTF-8 编码。

*   您需要确保每次处理 UTF-8 字符串时都是安全的。不幸的是，这是困难的部分。您可能希望广泛使用 PHP 的[`mbstring`](http://www.php.net/manual/en/book.mbstring.php)扩展。

*   **默认情况下，PHP 的内置字符串操作*不是*UTF-8 安全的。** 有些事情你可以安全地使用普通的 PHP 字符串操作（如连接），但对于大多数事情，你应该使用等效的`mbstring`函数。

*   要知道你在做什么（阅读：不要搞砸了），你真的需要知道 UTF-8 以及它是如何在尽可能低的级别上工作的。查看来自[utf8.com](http://www.utf8.com/)的任何链接，以获得一些很好的资源来学习您需要知道的一切。

* * *

## 回答 #2

> 赞同：160
> 
> 时间：2008-11-12T19:27:00.723

我想为[chazomaticus 的出色回答](https://stackoverflow.com/questions/279170/utf-8-all-the-way-through#279279)添加一件事：

不要忘记 META 标签（像这样，或者[它的 HTML4 或 XHTML 版本](http://www.w3.org/International/questions/qa-html-encoding-declarations#quicklookup)）：

```
<meta charset="utf-8"> 
```

这似乎微不足道，但 IE7 之前给我带来了问题。

我做的一切都是正确的；数据库、数据库连接和 Content-Type HTTP 标头都设置为 UTF-8，在所有其他浏览器中运行良好，但 Internet Explorer 仍然坚持使用“西欧”编码。

结果发现该页面缺少 META 标记。添加解决了这个问题。

**编辑：**

W3C 实际上有一个相当大的[部分专门用于 I18N](http://www.w3.org/International/)。他们有许多与这个问题相关的文章——描述了 HTTP、(X)HTML 和 CSS 方面的内容：

*   [常见问题解答：将 (X)HTML 页面编码更改为 UTF-8](http://www.w3.org/International/questions/qa-changing-encoding)
*   [在 HTML 中声明字符编码](http://www.w3.org/International/questions/qa-html-encoding-declarations)
*   [教程：XHTML、HTML 和 CSS 中的字符集和编码](http://www.w3.org/International/tutorials/tutorial-char-enc/)
*   [设置 HTTP 字符集参数](http://www.w3.org/International/O-HTTP-charset)

他们建议同时使用 HTTP 标头和 HTML 元标记（或在 XHTML 作为 XML 的情况下使用 XML 声明）。

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2008-11-10T21:30:36.420

除了`default_charset`在 php.ini 中设置之外，您还可以`header()`在任何输出之前使用代码中的发送正确的字符集：

```
header('Content-Type: text/html; charset=utf-8'); 
```

在 PHP 中使用 Unicode 很容易，只要您意识到大多数**字符串函数不能使用 Unicode，而且有些可能会完全破坏字符串**。PHP 认为“字符”的长度为 1 个字节。有时这是可以的（例如，`explode()`仅查找字节序列并将其用作分隔符——因此您查找的实际字符并不重要）。但其他时候，当函数实际上设计用于处理*characters*时，PHP 并不知道您的文本包含 Unicode 中的多字节字符。

一个很好的库是[phputf8](http://phputf8.sourceforge.net/)。这会重写所有“坏”函数，因此您可以安全地处理 UTF8 字符串。也有像 mbstring 扩展这样的扩展尝试为您执行此操作，但我更喜欢使用该库，因为它更便携（但我编写大众市场产品，所以这对我很重要）。但是phputf8可以在后台使用mbstring，无论如何，以提高性能。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2012-09-11T15:40:11.507

> **警告：**此答案适用于 PHP 5.3.5 及更低版本。不要将它用于 PHP 版本 5.3.6（2011 年 3 月发布）或更高版本。
> 
> 与[Palec 对*PDO + MySQL 和损坏的 UTF-8 encoding*](https://stackoverflow.com/a/21373793/367456)的回答进行比较。

* * *

我发现有人使用 PDO 存在问题，答案是将其用于 PDO 连接字符串：

```
$pdo = new PDO(
    'mysql:host=mysql.example.com;dbname=example_db',
    "username",
    "password",
    array(PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8")); 
```

我从中获取的站点已关闭，但幸运的是，我能够使用 Google 缓存获取它。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2012-02-23T22:20:22.950

就我而言，我正在使用`mb_split`，它使用正则表达式。因此，我还必须手动确保正则表达式编码是 utf-8`mb_regex_encoding('UTF-8');`

作为旁注，我还通过运行发现`mb_internal_encoding()`内部编码不是 utf-8，我通过运行`mb_internal_encoding("UTF-8");`.

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2014-01-27T09:16:00.587

首先，如果您使用的是 < 5.3PHP，那么没有。你有很多问题要解决。

我很惊讶没有人提到[**intl**](http://php.net/intl)**库，它对****Unicode**、字素、**字符串操作**、**本地化**等等有很好的支持，见下文。

 ********我将引用Elizabeth Smith** 在**PHPBenelux'14上的**[幻灯片](http://www.slideshare.net/auroraeosrose/using-unicode-with-php)中有关 PHP 中 Unicode 支持的一些信息

 **## **国际**

好的：

*   ICU 图书馆的包装
*   标准化语言环境，为每个脚本设置语言环境
*   数字格式
*   货币格式
*   消息格式（替换 gettext）
*   日历、日期、时区和时间
*   音译
*   恶搞检查器
*   资源包
*   转换器
*   国际化域名支持
*   字形
*   整理
*   迭代器

坏的：

*   不支持 zend_multibyte
*   不支持HTTP输入输出转换
*   不支持函数重载

## **mb_string**

*   启用 zend_multibyte 支持
*   支持透明的 HTTP 输入/输出编码
*   为 strtoupper 等功能提供一些包装器

## **图标**

*   主要用于字符集转换
*   输出缓冲区处理程序
*   mime 编码功能
*   转换
*   一些字符串助手（len、substr、strpos、strrpos）
*   流过滤器`stream_filter_append($fp, 'convert.iconv.ISO-2022-JP/EUC-JP')`

## **数据库**

*   MySQL：表和连接上的字符集和排序规则（不是排序规则）。另外，不要使用 mysql - mysqli 或 PDO
*   postgresql：pg_set_client_encoding
*   sqlite(3)：确保它是用 Unicode 和 intl 支持编译的

## **其他一些问题**

*   除非您使用第三部分扩展名，否则您不能在 PHP 和 windows 中使用 Unicode 文件名。
*   如果您使用 exec、proc_open 和其他命令行调用，则以 ASCII 格式发送所有内容
*   纯文本不是纯文本，文件有编码
*   您可以使用 iconv 过滤器即时转换文件

如果事情改变添加的功能等等，我会更新这个答案。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2014-09-10T03:39:22.387

我要添加到这些惊人的答案中的唯一一件事是强调以 utf8 编码保存文件，我注意到浏览器接受此属性而不是将 utf8 设置为您的代码编码。任何体面的文本编辑器都会向您显示这一点，例如 Notepad++ 有一个用于文件编码的菜单选项，它向您显示当前编码并允许您更改它。对于我所有的 php 文件，我使用没有 BOM 的 utf8。

前段时间有人让我为别人设计的 php/mysql 应用程序添加 utf8 支持，我注意到所有文件都是用 ANSI 编码的，所以我不得不使用 ICONV 来转换所有文件，更改数据库表以使用utf8 charset 和 utf8_general_ci 整理，在连接后将 'SET NAMES utf8' 添加到数据库抽象层（如果使用 5.3.6 或更早版本，则必须在连接字符串中使用 charset=utf8）并更改字符串函数以使用 php 多字节字符串函数等效。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2014-01-13T09:37:02.187

我最近发现使用`strtolower()`可能会导致数据在特殊字符后被截断的问题。

解决方案是使用

```
mb_strtolower($string, 'UTF-8'); 
```

> mb_ 使用多字节。它支持更多字符，但通常速度较慢。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-11-10T21:29:21.867

在 PHP 中，您需要使用[多字节函数](http://us2.php.net/manual/en/ref.mbstring.php)，或者打开[mbstring.func_overload](http://us2.php.net/manual/en/mbstring.configuration.php)。如果你的字符超过一个字节，那么像 strlen 这样的东西就会起作用。

您还需要确定响应的字符集。您可以使用 AddDefaultCharset，如上所述，也可以编写返回标头的 PHP 代码。（或者，您可以在 HTML 文档中添加 META 标记。）

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2015-05-05T21:36:17.983

我刚刚经历了同样的问题，并在 PHP 手册中找到了一个很好的解决方案。

我将所有文件编码更改为 UTF8，然后更改为连接上的默认编码。这解决了所有问题。

```
if (!$mysqli->set_charset("utf8")) {
    printf("Error loading character set utf8: %s\n", $mysqli->error);
} else {
   printf("Current character set: %s\n", $mysqli->character_set_name());
} 
```

[查看源代码](http://php.net/manual/en/mysqli.set-charset.php)

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-11-10T21:48:07.320

PHP 中的 Unicode 支持仍然是一团糟。虽然它能够将 ISO8859 字符串（它在内部使用）转换为 utf8，但它缺乏原生处理 unicode 字符串的能力，这意味着所有字符串处理函数都会破坏和破坏您的字符串。因此，您必须使用单独的库来获得正确的 utf8 支持，或者自己重写所有字符串处理函数。

简单的部分只是在 HTTP 标头和数据库等中指定字符集，但如果您的 PHP 代码没有输出有效的 UTF8，那么这些都不重要。那是困难的部分，PHP 几乎没有给你任何帮助。（我认为 PHP6 应该解决这个最糟糕的问题，但这还有一段时间）

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2015-02-11T23:52:55.773

如果您希望 MySQL 服务器决定字符集，而不是 PHP 作为客户端（旧行为；在我看来是首选），请尝试添加`skip-character-set-client-handshake`到您的`my.cnf`、 under`[mysqld]`和 restart `mysql`。

如果您使用 UTF8 以外的任何内容，这可能会导致麻烦。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2011-01-14T16:13:18.160

最佳答案非常好。这是我在常规 debian/php/mysql 设置中必须要做的：

```
// storage
// debian. apparently already utf-8

// retrieval
// the mysql database was stored in utf-8, 
// but apparently php was requesting iso. this worked: 
// ***notice "utf8", without dash, this is a mysql encoding***
mysql_set_charset('utf8');

// delivery
// php.ini did not have a default charset, 
// (it was commented out, shared host) and
// no http encoding was specified in the apache headers.
// this made apache send out a utf-8 header
// (and perhaps made php actually send out utf-8)
// ***notice "utf-8", with dash, this is a php encoding***
ini_set('default_charset','utf-8');

// submission
// this worked in all major browsers once apache
// was sending out the utf-8 header. i didnt add
// the accept-charset attribute.

// processing
// changed a few commands in php, like substr,
// to mb_substr 
```

这就是全部了 ！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-03-24T19:27:24.360

如果你想要一个 mysql 解决方案，在服务器迁移之后，我的 2 个项目遇到了类似的问题。在搜索并尝试了很多解决方案之后，我遇到了这个/在这个工作之前什么都没有）：

```
mysqli_set_charset($con,"utf8"); 
```

将此行添加到我的配置文件后，一切正常！

当我想从 html 查询中解决插入问题时，我发现了这个解决方案[https://www.w3schools.com/PHP/func_mysqli_set_charset.asp](https://www.w3schools.com/PHP/func_mysqli_set_charset.asp)

祝你好运！

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-08-23T19:10:26.897

只是一个说明：

您面临的问题是您的非拉丁字符显示为`?????????`，您提出了一个问题，并且参考了这个规范问题而关闭了它，您尝试了一切，无论您做什么，您仍然可以`??????????`从中得到`MySQL`。

这主要是因为您正在测试已使用错误字符集插入数据库并被转换并存储为实际问号字符**的旧数据**`?`。这意味着您永远丢失了原始文本，无论您尝试什么，您都会得到`???????`。

将您从该问题的答案中学到的知识重新应用于新数据可以解决您的问题。

# visual-studio - Visual Studio 有类似 Borland 的 CodeGuard 的东西吗？

> ID：279173
> 
> 赞同：2
> 
> 时间：2008-11-10T21:05:32.600
> 
> 标签：visual-studio, memory-leaks, codeguard

Visual Studio 中是否有任何东西会报告像 Codeguard 这样的内存泄漏？

例如：

```
Error 00001\. 0x300010 (Thread 0x0FA4):
Resource leak: The object (0xC65D84) was never deleted

The object (0x00C65D84) [size: 4 bytes] was created with new
| element2.cpp line 3:
| #include "element2.h"
| 
|>CS225::Element2::Element2(int _val) : p_val(new int(_val)) { }
| 
| CS225::Element2::Element2(const Element2& rhs) 
Call Tree:
   0x0040E3A7(=bcc_cg.exe:0x01:00D3A7) element2.cpp#3
   0x00409116(=bcc_cg.exe:0x01:008116) element-factory.h#19
   0x0040D964(=bcc_cg.exe:0x01:00C964) array.cpp#87
   0x00405308(=bcc_cg.exe:0x01:004308) driver.cpp#394
   0x004054B5(=bcc_cg.exe:0x01:0044B5) driver.cpp#415
   0x00405522(=bcc_cg.exe:0x01:004522) driver.cpp#420

------------------------------------------
Error 00002\. 0x300010 (Thread 0x0FA4):
Resource leak: The object (0xC65D58) was never deleted

The object (0x00C65D58) [size: 4 bytes] was created with new
| element2.cpp line 6:
| 
| CS225::Element2::Element2(const Element2& rhs) 
|>  : AbstractElement(), p_val(new int(*rhs.p_val)) 
| { }
| 
Call Tree:
   0x0040E4B7(=bcc_cg.exe:0x01:00D4B7) element2.cpp#6
   0x0040E652(=bcc_cg.exe:0x01:00D652) element2.cpp#26
   0x0040D8CD(=bcc_cg.exe:0x01:00C8CD) array.cpp#81
   0x00405308(=bcc_cg.exe:0x01:004308) driver.cpp#394
   0x004054B5(=bcc_cg.exe:0x01:0044B5) driver.cpp#415
   0x00405522(=bcc_cg.exe:0x01:004522) driver.cpp#420 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T21:08:47.523

内置，没有。它有`<crtdbg.h`>，但它并不像您的示例所暗示的那样全面。有各种附加组件可提供此功能。Boundschecker 是一个众所周知且流行的工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-22T17:12:09.443

[Visual Leak Detector](http://vld.codeplex.com/)听起来不错。不过我自己没试过。

# visual-studio-2008 - 在 MSBuild 中共享代码分析规则

> ID：279174
> 
> 赞同：2
> 
> 时间：2008-11-10T21:05:34.037
> 
> 标签：visual-studio-2008, msbuild, code-analysis

我正在尽最大努力定义在 MSBuild 执行我的 TFSBuild.proj 文件时应该从代码分析工具中省略的 CodeAnalysisRules 列表。

但是每次我测试它时，我的要排除的代码分析规则列表都会被忽略，Team Build 只是简单地尊重每个项目的代码分析规则设置。

任何人都有一个 TFSBuild.proj 文件的示例，该文件共享一个代码分析规则例外列表，适用于团队中构建的所有项目？我正在使用团队系统 2008。

感谢您的帮助？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T20:07:36.903

我们通过代码分析签入政策来做到这一点。您可以通过 Team System 进行配置。要实施，只需选择您的规则，然后右键单击解决方案 -> 将代码分析设置替换为签入策略。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-27T19:12:44.440

我认为尝试用不同的集合覆盖 csproj 设置没有多大意义——您肯定想随时随地使用相同的 CA 设置（或完全禁用 CA）吗？

正如 foosnazzy 所说，在 MSBuild 中（通常）不需要这样做。您可以使用 CA 签入策略来设置您希望应用的规则。然后，在解决方案资源管理器中右键单击您的解决方案，在上下文菜单的中间大约有一个选项子菜单，用于将 TFSProjects 的 CA 策略应用于解决方案中的所有项目。您可以用服务器的设置覆盖项目设置，或将它们合并。

它可能只复制当前配置的设置，因此如果要将相同的 CA 设置应用于调试和发布，则可能需要执行两次。（我隐约记得发生了这种情况，但我们没有在我们的发布版本上运行 CA，所以这不是我最近尝试过的东西）

（这在 VSTS2005 中可用，但它不起作用 - 这些值与项目中的值“合并”，因此任何现有 CA 规则的严重性都会增加（警告或错误），但您不能禁用 CA 规则（降级错误 -> 警告 -> 禁用）。此外，每次打开解决方案时，CA 设置都会“漂移”，因此您必须每隔几天重新应用它们以使其正常工作）

另一种方法是在单个项目中设置所需的 CA 规则，找到包含列表的 XML 元素，然后使用文本编辑器（或几行 C# 代码）对 CA 元素进行全局搜索和替换在项目中的所有 csproj 文件中。在 VSTS2008 出现之前我就是这样做的——一旦你掌握了这项技术，只需几秒钟就可以通过所有 csprojs 迁移你的设置。这样做的好处是您可以更有选择性地选择应用 CA 规则的项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T23:34:59.070

好吧，我花了一段时间才找到这个，但这是我能找到的最佳答案

[http://bloggingabout.net/blogs/rick/archive/2007/09/04/howto-disable-specific-code-analysis-rules-for-a-team-build.aspx](http://bloggingabout.net/blogs/rick/archive/2007/09/04/howto-disable-specific-code-analysis-rules-for-a-team-build.aspx)

它有效，它确实让我在我的所有解决方案中强制执行一组一致的规则，而无需访问每个项目的文件，这对我来说是巨大的，因为我们调整了我们的规则集并且不希望每次都手动更新每个项目

**其他人知道任何有效的方法吗？**- 这是一个 VS2005 解决方案/解决方法，所以我希望在 VS2008 团队系统中它会更容易，但到目前为止还没有找到其他任何东西

# java - 有没有比“宠物商店”更好的方法来比较电子商务环境中 .Net 和 Java 的一般性能？

> ID：279187
> 
> 赞同：3
> 
> 时间：2008-11-10T21:08:34.153
> 
> 标签：java, .net, performance, jakarta-ee

[多年来](http://www.onjava.com/pub/a/onjava/2001/11/28/catfight.html)，在比较电子商务类型设置中的 Java EE 和 .Net 性能时，我一直在使用[Java Pet Store](http://java.sun.com/developer/releases/petstore/)和[.Net Pet Store](http://blogs.vertigosoftware.com/petshop/default.aspx)示例。有没有更好的方法来比较 Java EE 和 .Net 对于此类应用程序的性能？

**更新：**

正如一些人在下面指出的那样，与使用 .Net 和 Java 相比，实现、框架版本、架构和硬件对性能的影响要大得多。我完全同意这一点。但是，记住这一点，我仍然想知道哪种一般比较最好。由于宠物店是一个相当成熟和通用的电子商务测试用例，我倾向于认为它对于基线非常有用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T21:29:21.960

从来没有真正确定的衡量平台性能的衡量标准。例如，*同一*J2EE 平台的比较可能会受到较小的配置更改的影响。看起来，该平台在今天的性能因素已不如从前，而设计和架构将产生更大的影响。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T21:15:15.047

您链接中的宠物商店项目是 .Net 2.0，它于三年前于 2005 年 11 月发布。从那时起，又发布了两个附加版本（3.0 和 3.5），其中包含许多可以提高性能的增强功能。

我想这取决于你是想比较“成熟”的网络应用程序，还是用最新版本的技术编写的应用程序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T21:18:41.593

从来没有。它唯一表明的是，使用不同的架构会给你带来不同的结果。走捷径可能会在单台机器上给你更好的性能，但更差的可扩展性。有关更多快捷方式，请参阅宠物商店的 prevayler 版本。现代java（和.net）也不会以同样的方式构建应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T21:31:01.147

不，没有“确定的”方法来比较两个平台之间的性能。您可以比较相同功能的两个实现的性能，但这只会告诉您哪个实现更高效，与底层平台无关。

查看哪个对您的应用程序更快的*唯一*有效方法是让您的应用程序在 Java 和 .NET 上运行，并对结果进行基准测试。

性能不是单一的线性比例。这取决于。

但对于大多数实际目的，不会有显着的性能差异。如今，这两个平台都非常成熟和高效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T23:42:44.913

也许[TPC 基准测试](http://www.tpc.org/tpcc/results/tpcc_perf_results.asp)会是更好的选择。我不确定 PetStore，但我记得 MS 尽其所能证明 Windows PC 集群可以击败单个 Sun 大型机的日子。

自从 .NET 出现以来，他们在这方面一直保持沉默，我认为他们太忙了 :)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-05-13T15:13:39.880

当有这么多因素在起作用时，

对其进行基准测试的唯一合理方法是使用相同的编码工作/资金创建功能等效的应用程序，

并在现实世界场景中的相同硬件上运行它。

所以我认为宠物店是一个很好的平台对比测试案例。

如果查看不是电子商务的应用程序，请检查这样的[链接](http://www.codeproject.com/KB/dotnet/RuntimePerformance.aspx)

# .net - 如何获取 System.Drawing.Color 中所有颜色的集合？

> ID：279190
> 
> 赞同：9
> 
> 时间：2008-11-10T21:10:06.587
> 
> 标签：.net, graphics

如何将 System.Drawing.Color 结构中的颜色列表提取到集合或数组中？

有没有比使用这个结构作为基础更有效的方法来获取颜色集合？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-10T21:15:23.283

所以你会这样做：

```
string[] colors = Enum.GetNames(typeof(System.Drawing.KnownColor)); 
```

...获取所有颜色的数组。

或者...您可以使用反射来获取颜色。KnownColors 包括“菜单”、系统菜单的颜色等项目。这可能不是您想要的。因此，要获取 System.Drawing.Color 中颜色的名称，您可以使用反射：

```
Type colorType = typeof(System.Drawing.Color);

PropertyInfo[] propInfoList = colorType.GetProperties(BindingFlags.Static | BindingFlags.DeclaredOnly | BindingFlags.Public);

foreach (System.Reflection.PropertyInfo c in propInfoList) {
  Console.WriteLine(c.Name);
} 
```

这会写出所有颜色，但您可以轻松定制它以将颜色名称添加到列表中。

查看有关[构建颜色图表的](http://www.codeproject.com/KB/cs/reflectioncolorchart.aspx)代码项目项目。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-10T21:18:49.703

试试这个：

```
foreach (KnownColor knownColor in Enum.GetValues(typeof(KnownColor)))
{
   Trace.WriteLine(string.Format("{0}", knownColor));
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-10T21:20:40.510

除了 jons911 所说的之外，如果您只想要“命名”颜色而不是像“ActiveBorder”这样的系统颜色，则`Color`该类有一个 IsSystemColor 属性，您可以使用它来过滤掉这些颜色。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-01-20T15:49:52.223

这里的大多数答案都会导致颜色名称（字符串）的集合，而不是 System.Drawing.Color 对象。如果您需要一组实际的系统颜色，请使用：

```
using System.Collections.Generic;
using System.Drawing;
using System.Linq;
...
static IEnumerable<Color> GetSystemColors() {
    Type type = typeof(Color);
    return type.GetProperties().Where(info => info.PropertyType == type).Select(info => (Color)info.GetValue(null, null));
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T21:39:14.297

[这](http://www.pardesiservices.com/Softomatix/ColorChart.asp "这里")是一个在线页面，其中显示了每种颜色的方便样本及其名称。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T21:47:34.793

您必须使用反射从 System.Drawing.Color 结构中获取颜色。

```
System.Collections.Generic.List<string> colors = 
        new System.Collections.Generic.List<string>();
Type t = typeof(System.Drawing.Color);
System.Reflection.PropertyInfo[] infos = t.GetProperties();
foreach (System.Reflection.PropertyInfo info in infos)
    if (info.PropertyType == typeof(System.Drawing.Color))
        colors.Add(info.Name); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T21:12:38.313

在 System.Drawing 中有一个 Enum KnownColor，它指定了已知的系统颜色。

List<>: List allColors = new List(Enum.GetNames(typeof(KnownColor)));

Array[] string[] allColors = Enum.GetNames(typeof(KnownColor));

# apache-flex - Flex 中的 JSON。“未定义属性 JSON 的访问”

> ID：279195
> 
> 赞同：7
> 
> 时间：2008-11-10T21:12:18.530
> 
> 标签：apache-flex, flash, json

我正在尝试在 Adob​​e Flex 应用程序中解析 JSON，使用 http://www.mikechambers.com/blog/2006/03/28/tutorial-using-json-with-flex-2-and-actionscript-3/' >本教程

不幸的是，Flex Builder 3 在线上标记了“访问未定义属性 JSON”错误

`var arr:Array = (JSON.decode(rawData) as Array);`

我不知道它想要什么，因为我包含了导入行。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T21:50:43.447

您需要下载、安装和引用包含 JSON 例程的实用程序库。请参阅[http://labs.macromedia.com/wiki/index.php/ActionScript_3:resources:apis:libraries#corelib](http://labs.macromedia.com/wiki/index.php/ActionScript_3:resources:apis:libraries#corelib)

您是否这样做了，并将其包含在您的项目中？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-07T18:27:04.717

这是 corelib 的新位置：[https](https://github.com/mikechambers/as3corelib) ://github.com/mikechambers/as3corelib （截至 2011 年 2 月，当我写这篇文章时）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-21T07:06:39.577

使用下面的代码

```
var arr:Array = (com.adobe.serialization.json.JSON.decode(rawData) as Array); 
```

代替

```
 var arr:Array = (JSON.decode(rawData) as Array); 
```

不要忘记在 package import com.adobe.serialization.json.JSON 下导入；

它对我有好处！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-11T09:12:35.323

使用 Flash Player 11 支持的原生 JSON-api！

[http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/JSON.html#methodSummary](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/JSON.html#methodSummary)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-10T21:44:32.337

检查您的输入文件的有效性。GI=GO。

我会尝试使用 Firefox + Firebug 将其包含在 HTML 页面中，并查看是否出现类似的错误。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-01-27T22:07:28.600

您必须使用 AIR 3 才能获得原生 JSON 支持。 [http://blogs.adobe.com/cantrell/archives/2011/08/native-json-support-in-air-3.html](http://blogs.adobe.com/cantrell/archives/2011/08/native-json-support-in-air-3.html)

在使用 Flex SDK 4.6.0 和“Flash Player”作为平台的 FlashDevelop 4.0.1 中，本机 JSON 不可用。我收到“未定义属性 JSON 的访问”错误。

我不得不在项目设置下将平台从“Flash Player”切换到“AIR”。

# vb.net - 是否有 C# 的 VB.net 等价物！操作员？

> ID：279208
> 
> 赞同：4
> 
> 时间：2008-11-10T21:16:05.200
> 
> 标签：vb.net

经过两年的 C#，由于我目前的工作，我现在回到了 VB.net。在 C# 中，我可以对字符串变量的 null 或 false 值进行速记测试，如下所示：

```
if(!String.IsNullOrEmpty(blah))
{
   ...code goes here
} 
```

但是我对如何在 VB.net 中执行此操作有点困惑。

```
if Not String.IsNullOrEmpty(blah) then
   ...code goes here
end if 
```

上述语句是否意味着字符串不为空或不为空？`Not`关键字是否像 C# 的运算符一样`!`操作？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-10T21:53:14.970

在您显示的上下文中，VB`Not`关键字确实等同于 C#`!`运算符。但请注意，VB`Not`关键字实际上被重载以表示两个 C# 等效项：

*   逻辑否定：`!`
*   按位补码：`~`

例如，以下两行是等价的：

*   C＃：`useThis &= ~doNotUse;`
*   VB：`useThis = useThis And (Not doNotUse)`

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-10T21:16:59.333

是的，它们是一样的

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-10T21:20:11.167

`Not`完全一样`!`（在 . 的上下文中`Boolean`。参见 RoadWarrior 的评论，了解它在位算术中作为一个补码的语义）。结合`Is`运算符来测试引用相等性有一个特殊情况：

```
If Not x Is Nothing Then ' … '
' is the same as '
If x IsNot Nothing Then ' … ' 
```

相当于 C# 的

```
if (x != null) // or, rather, to be precise:
if (object.ReferenceEquals(x, null)) 
```

`IsNot`在此，首选使用 of 。不幸的是，它不适用于`TypeOf`测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-07-10T20:21:39.227

在您引用 C 或 C++ 代码之前，它们的工作方式相同。

例如，对 Win32 API 函数的结果执行 NOT 可能会导致不正确的结果，因为在 C == 1 中为 true，并且在 1 上的按位 NOT 不等于 false。

```
因为 1 是 00000000001
按位非 11111111110
虽然 false 是 00000000000

```

但是在 VB 中它工作得很好，就像在 VB 中一样 true == -1

```
因为 -1 是 11111111111
按位非 00000000000

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-02T13:15:33.243

c# : 布尔示例 1 = false;

```
 boolean example2 = !example1; 
```

vb.net: 将 example1 作为 boolean = False

```
 dim example2 as boolean = Not example1 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-10T21:19:22.213

借调。它们的工作方式相同。两者都反转了 !/not 运算符后面的表达式的逻辑含义。

# c# - 判断用户是否登录

> ID：279215
> 
> 赞同：4
> 
> 时间：2008-11-10T21:18:03.513
> 
> 标签：c#, .net, authentication

无论我的 .NET Web 应用程序的用户当前是否登录，最好/最有效的方式是什么。

我目前正在使用`Membership.GetUser() != null`，但现在我意识到这涉及到数据库往返，我想知道是否有更好的方法。也许`HttpContext.Current.User.Identity.IsAuthenticated`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T21:21:16.860

你已经回答了你自己的问题。物业`IsAuthenticated`是做到这一点的最佳方式。

# c# - 如何通过 PHP 调用 C# Web 服务？

> ID：279220
> 
> 赞同：3
> 
> 时间：2008-11-10T21:19:13.760
> 
> 标签：c#, php, web-services, nusoap

我已经使用 ASP.NET（在 C# 中）编写了一个 Web 服务，并且我正在尝试使用 NuSOAP 编写一个示例 PHP 客户端。我被绊倒的地方是如何做到这一点的例子；一些显示`soapval`正在使用（而且我不太了解参数 - 例如`false`作为`string`类型传递等），而另一些只是使用直接`array`s。假设我报告的 Web 服务的 WSDL`http://localhost:3333/Service.asmx?wsdl`如下所示：

```
POST /Service.asmx HTTP/1.1
Host: localhost
Content-Type: text/xml; charset=utf-8
Content-Length: length
SOAPAction: "http://tempuri.org/webservices/DoSomething"

<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
    <DoSomething xmlns="http://tempuri.org/webservices">
      <anId>int</anId>
      <action>string</action>
      <parameters>
        <Param>
          <Value>string</Value>
          <Name>string</Name>
        </Param>
        <Param>
          <Value>string</Value>
          <Name>string</Name>
        </Param>
      </parameters>
    </DoSomething>
  </soap:Body>
</soap:Envelope> 
```

我的第一次 PHP 尝试如下所示：

```
<?php
require_once('lib/nusoap.php');
$client = new nusoap_client('http://localhost:3333/Service.asmx?wsdl');

$params = array(
    'anId' => 3, //new soapval('anId', 'int', 3),
    'action' => 'OMNOMNOMNOM',
    'parameters' => array(
        'firstName' => 'Scott',
        'lastName' => 'Smith'
    )
);
$result = $client->call('DoSomething', $params, 'http://tempuri.org/webservices/DoSomething', 'http://tempuri.org/webservices/DoSomething');
print_r($result);
?> 
```

现在除了 Param 类型是一种复杂类型，我很确定我的简单`$array`尝试不会自动使用，我在我的 Web 服务中设置断点并看到我标记为的方法`WebMethod`（不重命名它，它的字面意思`DoSomething`）并且看到参数都是默认值（`int`is `0`，`string`is`null`等）。

我的 PHP 语法应该是什么样的，我必须做什么才能`Param`正确传递类型？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T22:30:36.970

您必须将内容包装在大量嵌套数组中。

```
<?php
require_once('lib/nusoap.php');
$client = new nusoap_client('http://localhost:3333/Service.asmx?wsdl');

$params = array(
      'anId' => 3,
      'action' => 'OMNOMNOMNOM',
      'parameters' => array(
              'Param' => array(
                  array('Name' => 'firstName', 'Value' => 'Scott'),
                  array('Name' => 'lastName', 'Value' => 'Smith')
                       )
      )
);
$result = $client->call('DoSomething', array($params), 
                'http://tempuri.org/webservices/DoSomething', 
                'http://tempuri.org/webservices/DoSomething');
print_r($result);
?> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T22:34:51.483

有点不相关，但从 PHP5 开始，您对 SOAP 有本机支持。

```
$client = new SoapClient("some.wsdl");
$client->DoSomething($params);

```

那可能会方便一点。

[http://se.php.net/soap](http://se.php.net/soap)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-28T10:42:30.137

这里是具有本机 SOAP 支持的示例：

```
 // Create a new soap client based on the service's metadata (WSDL)
    $client = new SoapClient("http://some.wsdl",
        array('location' => 'http://127.0.0.100:80/IntegrationService/php'));

    $params = array();
    $params['lead']['Firstname']    = $user->firstname;
    $params['lead']['Lastname']     = $user->lastname;
    $params['lead']['Product']      = $product;
    $params['lead']['JobTitle']     = $user->job_title;
    $params['lead']['Email']        = $user->mail;
    $params['lead']['Phone']        = $user->phone;
    $params['lead']['CompanyName']  = $user->company_name;
    $params['lead']['City']         = $user->city;
    $params['lead']['Industry']     = $user->industry;

    $client->SubmitLead($params); 
```

SoapClient 描述中的“.../IntegrationService/php”是 WCF 中的端点：

```
<endpoint
            address="php"
            binding="basicHttpBinding"
            contract="Integration.Service.IDrupalIntegrationService" /> 
```

# arrays - 在VB6中将图片框图像像素转换为字节数组

> ID：279221
> 
> 赞同：4
> 
> 时间：2008-11-10T21:19:20.653
> 
> 标签：arrays, vb6

我有一个从视频捕获设备获取图像的 VB6 图片框。

我试图弄清楚如何将图片框转换为字节数组。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T20:02:40.370

```
Private Type BITMAP
    bmType As Long
    bmWidth As Long
    bmHeight As Long
    bmWidthBytes As Long
    bmPlanes As Integer
    bmBitsPixel As Integer
    bmBits As Long
End Type

Private Declare Function GetObject Lib "gdi32" Alias "GetObjectA" (ByVal hObject As Long, ByVal nCount As Long, lpObject As Any) As Long
Private Declare Function GetBitmapBits Lib "gdi32" (ByVal hBitmap As Long, ByVal dwCount As Long, lpBits As Any) As Long

Private Sub GetPictureBytes()
  Dim PicBits() As Byte, PicInfo As BITMAP

  GetObject Picture1.Picture, Len(PicInfo), PicInfo

  ReDim PicBits((PicInfo.bmWidth * PicInfo.bmHeight * 3) - 1) As Byte

  GetBitmapBits Picture1.Picture, UBound(PicBits), PicBits(0)
End Sub 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T21:23:18.260

自从我使用 VB6 以来已经有很长时间了，但据我所知，您可以将图像序列化为 a`PropertyBag`并将内容作为字节数组获取。

我知道的唯一选择需要大量使用 WinAPI 来完成同样的任务。

# php - 如何在 PHP 中调整具有透明度的 png 大小？

> ID：279236
> 
> 赞同：45
> 
> 时间：2008-11-10T21:28:35.627
> 
> 标签：php, png, gd, resize

我正在尝试在 PHP 中调整具有透明背景的 png 大小，而我在网上找到的代码示例对我不起作用。这是我正在使用的代码，非常感谢您的建议！

```
$this->image = imagecreatefrompng($filename);

imagesavealpha($this->image, true);
$newImage = imagecreatetruecolor($width, $height);

// Make a new transparent image and turn off alpha blending to keep the alpha channel
$background = imagecolorallocatealpha($newImage, 255, 255, 255, 127);
imagecolortransparent($newImage, $background);
imagealphablending($newImage, false);
imagesavealpha($newImage, true);

imagecopyresampled($newImage, $this->image, 0, 0, 0, 0, $width, $height,  $this->getWidth(), $this->getHeight());
$this->image = $newImage;  
imagepng($this->image,$filename); 
```

**更新** “不工作”我的意思是说当我调整 png 大小时背景颜色变为黑色。

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-11-10T21:53:17.573

据我所知，在执行 imagecolorallocatealpha()**之前**`false`，您需要将混合模式设置为，并将保存 alpha 通道标志设置为`true`

 **```
<?php
/**
 * https://stackoverflow.com/a/279310/470749
 * 
 * @param resource $image
 * @param int $newWidth
 * @param int $newHeight
 * @return resource
 */
public function getImageResized($image, int $newWidth, int $newHeight) {
    $newImg = imagecreatetruecolor($newWidth, $newHeight);
    imagealphablending($newImg, false);
    imagesavealpha($newImg, true);
    $transparent = imagecolorallocatealpha($newImg, 255, 255, 255, 127);
    imagefilledrectangle($newImg, 0, 0, $newWidth, $newHeight, $transparent);
    $src_w = imagesx($image);
    $src_h = imagesy($image);
    imagecopyresampled($newImg, $image, 0, 0, 0, 0, $newWidth, $newHeight, $src_w, $src_h);
    return $newImg;
}
?> 
```

**更新**：此代码仅适用于不透明度 = 0 的透明背景。如果您的图像具有 0 < 不透明度 < 100，它将是黑色背景。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-08-07T18:04:32.537

这是一个对我来说很好的最终解决方案。

```
function resizePng($im, $dst_width, $dst_height) {
    $width = imagesx($im);
    $height = imagesy($im);

    $newImg = imagecreatetruecolor($dst_width, $dst_height);

    imagealphablending($newImg, false);
    imagesavealpha($newImg, true);
    $transparent = imagecolorallocatealpha($newImg, 255, 255, 255, 127);
    imagefilledrectangle($newImg, 0, 0, $width, $height, $transparent);
    imagecopyresampled($newImg, $im, 0, 0, 0, 0, $dst_width, $dst_height, $width, $height);

    return $newImg;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T23:26:35.407

还需要用透明颜色填充新图像（如 Dycey 编码但我猜忘了提及:)），而不仅仅是“战略”保存本身。

IIRC，您还需要确保 PNG 是 24 位的，即真彩色，而不是 8 位以避免错误行为。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-10-31T20:44:02.947

旧线程，但以防万一 - 如果您正确命名，Dycey 的示例应该可以工作。这是我的图像大小调整类中使用的修改版本。请注意检查以确保已定义 imagecolorallocatealpha()，如果您使用的是 GD <2.0.8，则不会这样

```
 /**
     * usually when people use PNGs, it's because they need alpha channel 
     * support (that means transparency kids). So here we jump through some 
     * hoops to create a big transparent rectangle which the resampled image 
     * will be copied on top of. This will prevent GD from using its default 
     * background, which is black, and almost never correct. Why GD doesn't do 
     * this automatically, is a good question.
     *
     * @param $w int width of target image
     * @param $h int height of target image
     * @return void
     * @private
     */
    function _preallocate_transparency($w, $h) {
        if (!empty($this->filetype) && !empty($this->new_img) && $this->filetype == 'image/png')) {
            if (function_exists('imagecolorallocatealpha')) {
                imagealphablending($this->new_img, false);
                imagesavealpha($this->new_img, true);
                $transparent = imagecolorallocatealpha($this->new_img, 255, 255, 255, 127);
                imagefilledrectangle($this->new_img, 0, 0, $tw, $th, $transparent);
            }
        }
    } 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-05-01T04:06:56.527

它可能与较新版本的 PHP（我使用 PHP 5.6 测试）有关，但现在无需使用透明背景填充图像即可：

```
$image_p = imagecreatetruecolor(480, 270);
imageAlphaBlending($image_p, false);
imageSaveAlpha($image_p, true);
$image = imagecreatefrompng('image_with_some_transaprency.png');
imagecopyresampled($image_p, $image, 0, 0, 0, 0, 480, 270, 1920, 1080);
imagepng($image_p, 'resized.png', 0); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-03-25T16:33:09.380

与 imagecopyresampled 相比，使用 imagescale 更好。调整大小的图像不需要空图像资源，与 imagecopyresampled 所需的十个参数相比，只需要两个参数。还可以以较小的尺寸产生更好的质量。如果使用 PHP 5.5.18 或更早版本，或者 PHP 5.6.2 或更早版本，您应该提供作为第三个参数的高度，因为纵横比计算不正确。

```
$this->image =   imagecreatefrompng($filename);
$scaled = imagescale($this->image, $width);
imagealphablending($scaled, false);
imagesavealpha($scaled, true);
imagepng($scaled, $filename); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-04-24T14:43:35.097

这对我也不起作用:(这是我的解决方案..但我也得到黑色背景并且图像不透明

```
 <?php
$img_id = 153;

$source = "images/".$img_id.".png";
$source = imagecreatefrompng($source);
$o_w = imagesx($source);
$o_h = imagesy($source);

$w = 200;
$h = 200;

$newImg = imagecreatetruecolor($w, $h);
imagealphablending($newImg, false);
imagesavealpha($newImg,true);
$transparent = imagecolorallocatealpha($newImg, 255, 255, 255, 127);
imagefilledrectangle($newImg, 0, 0, $w, $h, $transparent);
imagecopyresampled($newImg, $source, 0, 0, 0, 0, $w, $h, $o_w, $o_h);

imagepng($newImg, $img_id.".png");

?>
<img src="<?php echo $img_id.".png" ?>" /> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-09-01T10:01:29.853

这是适用于 png 文件并保留其图像透明度的完整代码..

```
list($width, $height) = getimagesize($filepath);
$new_width = "300";
$new_height = "100";

if($width>$new_width && $height>$new_height)
{
    $image_p = imagecreatetruecolor($new_width, $new_height);
    imagealphablending($image_p, false);
    imagesavealpha($image_p, true);
    $image = imagecreatefrompng($filepath);
    imagecopyresampled($image_p, $image, 0, 0, 0, 0, $new_width, $new_height, $width, $height);
    imagepng($image_p,$filepath,5);
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-07-02T13:33:00.603

完整的例子。请注意，对于在互联网上找到的一些 png 图像，它工作不正确，但对于我自己用 Photoshop 创建的它工作正常。

```
 header('Content-Type: image/png');

$filename = "url to some image";

$newWidth = 300;
$newHeight = 300;

$imageInfo = getimagesize($filename);

$image = imagecreatefrompng($filename); //create source image resource
imagesavealpha($image, true); //saving transparency

$newImg = imagecreatetruecolor($newWidth, $newHeight); //creating conteiner for new image
imagealphablending($newImg, false);
imagesavealpha($newImg,true);
$transparent = imagecolorallocatealpha($newImg, 255, 255, 255, 127); //seting transparent background
imagefilledrectangle($newImg, 0, 0, $newWidth, $newHeight, $transparent);
imagecopyresampled($newImg, $image, 0, 0, 0, 0, $newWidth, $newHeight,  $imageInfo[0], $imageInfo[1]);

imagepng($newImg); //printout image string 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-09-02T05:43:56.907

上述解决方案也不适合我。这就是我发现解决问题的方法。

```
// upload directory
$upload_dir = "../uploads/";
// valid image formats
$valid_formats = array("jpg", "jpeg", "png");
// maximum image size 1 mb
$max_size = 1048576;
// crop image width, height
$nw = $nh = 800;
$nw1 = $nh1 = 400;
$nw3 = $nh3 = 200;
$nw2 = $nh2 = 100;
// checks that if upload_dir a directory/not
if (is_dir($upload_dir) && is_writeable($upload_dir)) {
    // not empty file
    if (!empty($_FILES['image'])) {
        // assign file name 
        $name = $_FILES['image']['name'];
        // $_FILES to execute all files within a loop
        if ($_FILES['image']['error'] == 4) {
            $message = "Empty FIle";
        }
        if ($_FILES['image']['error'] == 0) {
            if ($_FILES['image']['size'] > $max_size) {
                echo "E-Image is too large!<br>";
                $_SESSION['alert'] = "Image is too large!!";
            } else if (!in_array(pathinfo($name, PATHINFO_EXTENSION), $valid_formats)) {
                $_SESSION['alert'] = "This image is not a valid image format!!";
                echo "E-This image is not a valid image format<br>";
            } else if (file_exists($upload_dir . $name)) {
                $_SESSION['alert'] = "Image already exists!!";
                echo "E-Image already exists<br>";
            } else { // No error found! Move uploaded files 
                $size = getimagesize($_FILES['image']['tmp_name']);
                $x = (int) $_POST['x'];
                $y = (int) $_POST['y'];
                $w = (int) $_POST['w'] ? $_POST['w'] : $size[0];
                $h = (int) $_POST['h'] ? $_POST['h'] : $size[1];
                // path for big image
                $big_image_path = $upload_dir . "big/" . $name;
                // medium image path
                $medium_image_path = $upload_dir . "medium/" . $name;
                // small image path
                $small_image_path = $upload_dir . "small/" . $name;
                // check permission
                if (!is_dir($upload_dir . "big/") && !is_writeable($upload_dir . "big/")) {
                    mkdir($upload_dir . "big/", 0777, false);
                }
                if (!is_dir($upload_dir . "medium/") && !is_writeable($upload_dir . "medium/")) {
                    mkdir($upload_dir . "medium/", 0777, false);
                }
                if (!is_dir($upload_dir . "small/") && !is_writeable($upload_dir . "small/")) {
                    mkdir($upload_dir . "small/", 0777, false);
                }
                // image raw data from form
                $data = file_get_contents($_FILES["image"]["tmp_name"]);
                // create image
                $vImg = imagecreatefromstring($data);
                //create big image
                $dstImg = imagecreatetruecolor($nw, $nh);
                imagealphablending($dstImg, false);
                $trans_colour = imagecolorallocatealpha($dstImg, 0, 0, 0, 127);
                imagefilledrectangle($dstImg, 0, 0, $w, $h, $trans_colour);
                imagesavealpha($dstImg, true);
                imagecopyresampled($dstImg, $vImg, 0, 0, $x, $y, $nw, $nh, $w, $h);
                imagepng($dstImg, $big_image_path);
                //create medium thumb
                $dstImg1 = imagecreatetruecolor($nw1, $nh1);
                imagealphablending($dstImg1, false);
                $trans_colour1 = imagecolorallocatealpha($dstImg1, 0, 0, 0, 127);
                imagefilledrectangle($dstImg1, 0, 0, $w, $h, $trans_colour1);
                imagesavealpha($dstImg1, true);
                imagecopyresampled($dstImg1, $vImg, 0, 0, $x, $y, $nw1, $nh1, $w, $h);
                imagepng($dstImg1, $medium_image_path);
                // create smallest thumb
                $dstImg2 = imagecreatetruecolor($nw2, $nh2);
                imagealphablending($dstImg2, false);
                $trans_colour2 = imagecolorallocatealpha($dstImg2, 0, 0, 0, 127);
                imagefilledrectangle($dstImg2, 0, 0, $w, $h, $trans_colour2);
                imagesavealpha($dstImg2, true);
                imagecopyresampled($dstImg2, $vImg, 0, 0, $x, $y, $nw2, $nh2, $w, $h);
                imagepng($dstImg2, $small_image_path);
                /*
                 * Database insertion
                 */
                $sql = "INSERT INTO tbl_inksand_product_gallery ("
                        . "Product_Id,Gallery_Image_Big,Gallery_Image_Medium,Gallery_Image_Thumb,"
                        . "Gallery_Status,Created_By,Created_Datetime"
                        . ") VALUES ("
                        . "'{$Product_Id}','{$big_image_path}','{$medium_image_path}','{$small_image_path}',"
                        . "'A','$Created_By','{$time}'"
                        . ")";
                db_query($sql);
                if (db_affected_rows() == 1) {
                    if (imagedestroy($dstImg)) {
                        $_SESSION['success'] = "Image uploaded successfully.";
                        echo "S-Image uploaded successfully<br>";
                    } else {
                        $_SESSION['alert'] = "Image not uploaded!!";
                        echo "S-Image not uploaded";
                    }
                } else {
                    $_SESSION['alert'] = "Error in uploading image!!";
                    echo "E-Error in uploading image!!";
                }
            }
        }
    }
} else {
    mkdir($upload_dir, 0777);
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-09-21T13:42:44.247

您可以简单地使用*imagescale()*
调整图像大小 此代码对我来说很好：

```
$image = imagescale($image, 720, -1, IMG_BICUBIC);
imagepng($image); 
```

# python - 从相对路径导入模块

> ID：279237
> 
> 赞同：787
> 
> 时间：2008-11-10T21:28:48.060
> 
> 标签：python, relative-path, python-import

如何在给定相对路径的情况下导入 Python 模块？

例如，如果`dirFoo`contains `Foo.py`and`dirBar`和`dirBar`contains `Bar.py`，我该如何`Bar.py`导入`Foo.py`？

这是一个视觉表示：

```
dirFoo\
    Foo.py
    dirBar\
        Bar.py 
```

`Foo`希望包括`Bar`，但重组文件夹层次结构不是一种选择。

* * *

## 回答 #1

> 赞同：348
> 
> 时间：2011-05-23T14:00:43.530

假设您的两个目录都是真正的 Python 包（`__init__.py`其中确实有文件），这里是一个安全的解决方案，用于包含相对于脚本位置的模块。

我假设您想要这样做，因为您需要在脚本中包含一组模块。我在多个产品的生产中使用它，并在许多特殊场景中工作，例如：从另一个目录调用的脚本或使用 python 执行的脚本，而不是打开一个新的解释器。

```
 import os, sys, inspect
 # realpath() will make your script run, even if you symlink it :)
 cmd_folder = os.path.realpath(os.path.abspath(os.path.split(inspect.getfile( inspect.currentframe() ))[0]))
 if cmd_folder not in sys.path:
     sys.path.insert(0, cmd_folder)

 # Use this if you want to include modules from a subfolder
 cmd_subfolder = os.path.realpath(os.path.abspath(os.path.join(os.path.split(inspect.getfile( inspect.currentframe() ))[0],"subfolder")))
 if cmd_subfolder not in sys.path:
     sys.path.insert(0, cmd_subfolder)

 # Info:
 # cmd_folder = os.path.dirname(os.path.abspath(__file__)) # DO NOT USE __file__ !!!
 # __file__ fails if the script is called in different ways on Windows.
 # __file__ fails if someone does os.chdir() before.
 # sys.argv[0] also fails, because it doesn't not always contains the path. 
```

作为奖励，这种方法确实让您可以强制 Python 使用您的模块，而不是安装在系统上的模块。

警告！我真的不知道当前模块在`egg`文件中时会发生什么。它可能也失败了。

* * *

## 回答 #2

> 赞同：331
> 
> 时间：2008-11-10T21:33:33.887

确保 dirBar 有`__init__.py`文件——这会将一个目录变成一个 Python 包。

* * *

## 回答 #3

> 赞同：264
> 
> 时间：2008-11-10T22:04:27.223

您还可以将子目录添加到 Python 路径中，以便将其作为普通脚本导入。

```
import sys
sys.path.insert(0, <path to dirFoo>)
import Bar 
```

* * *

## 回答 #4

> 赞同：117
> 
> 时间：2010-11-26T10:21:28.800

```
import os
import sys
lib_path = os.path.abspath(os.path.join(__file__, '..', '..', '..', 'lib'))
sys.path.append(lib_path)

import mymodule 
```

* * *

## 回答 #5

> 赞同：109
> 
> 时间：2010-12-09T10:40:09.677

只需做一些简单的事情即可从不同的文件夹导入 .py 文件。

假设您有一个目录，例如：

```
lib/abc.py 
```

然后只需在 lib 文件夹中保留一个名为的空文件

```
__init__.py 
```

然后使用

```
from lib.abc import <Your Module name> 
```

将文件保存`__init__.py`在导入模块层次结构的每个文件夹中。

* * *

## 回答 #6

> 赞同：77
> 
> 时间：2008-11-10T21:46:04.953

如果您以这种方式构建项目：

```
src\
  __init__.py
  main.py
  dirFoo\
    __init__.py
    Foo.py
  dirBar\
    __init__.py
    Bar.py 
```

然后从 Foo.py 你应该能够做到：

```
import dirFoo.Foo 
```

或者：

```
from dirFoo.Foo import FooObject 
```

根据汤姆的评论，这确实要求该`src`文件夹可以通过`site_packages`或您的搜索路径访问。此外，正如他所提到的，`__init__.py`当您第一次在该包/目录中导入模块时，它会隐式导入。通常`__init__.py`只是一个空文件。

* * *

## 回答 #7

> 赞同：45
> 
> 时间：2008-11-12T01:56:51.203

最简单的方法是使用 sys.path.append()。

但是，您可能也对[imp](http://docs.python.org/library/imp.html?highlight=imp#module-imp)模块感兴趣。它提供对内部导入功能的访问。

```
# mod_name is the filename without the .py/.pyc extention
py_mod = imp.load_source(mod_name,filename_path) # Loads .py file
py_mod = imp.load_compiled(mod_name,filename_path) # Loads .pyc file 
```

当您不知道模块的名称时，这可用于动态加载模块。

我过去曾使用它来创建应用程序的插件类型接口，用户可以在其中编写具有应用程序特定功能的脚本，然后将脚本放在特定目录中。

此外，这些功能可能很有用：

```
imp.find_module(name[, path])
imp.load_module(name, file, pathname, description) 
```

* * *

## 回答 #8

> 赞同：43
> 
> 时间：2008-11-10T22:22:47.093

这是相关的 PEP：

[http://www.python.org/dev/peps/pep-0328/](http://www.python.org/dev/peps/pep-0328/)

特别是，假设 dirFoo 是从 dirBar 向上的目录...

在目录 Foo\Foo.py 中：

```
from ..dirBar import Bar 
```

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2013-02-10T23:21:51.977

无需修改脚本的最简单方法是设置 PYTHONPATH 环境变量。因为 sys.path 是从这些位置初始化的：

1.  包含输入脚本的目录（或当前目录）。
2.  PYTHONPATH（目录名称列表，与 shell 变量 PATH 具有相同的语法）。
3.  安装相关的默认值。

赶紧跑：

```
export PYTHONPATH=/absolute/path/to/your/module 
```

您的 sys.path 将包含上述路径，如下所示：

```
print sys.path

['', '/absolute/path/to/your/module', '/usr/lib/python2.7', '/usr/lib/python2.7/plat-linux2', '/usr/lib/python2.7/lib-tk', '/usr/lib/python2.7/lib-old', '/usr/lib/python2.7/lib-dynload', '/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages/PIL', '/usr/lib/python2.7/dist-packages/gst-0.10', '/usr/lib/python2.7/dist-packages/gtk-2.0', '/usr/lib/pymodules/python2.7', '/usr/lib/python2.7/dist-packages/ubuntu-sso-client', '/usr/lib/python2.7/dist-packages/ubuntuone-client', '/usr/lib/python2.7/dist-packages/ubuntuone-control-panel', '/usr/lib/python2.7/dist-packages/ubuntuone-couch', '/usr/lib/python2.7/dist-packages/ubuntuone-installer', '/usr/lib/python2.7/dist-packages/ubuntuone-storage-protocol'] 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2010-09-15T05:02:52.807

在我看来，最好的选择是将**__ init __.py**放在文件夹中并使用

```
from dirBar.Bar import * 
```

不建议使用 sys.path.append() ，因为如果使用与现有 python 包相同的文件名，可能会出现问题。我没有对此进行测试，但这将是模棱两可的。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2012-12-20T01:07:43.913

## Linux用户的快速而肮脏的方式

如果您只是在修补并且不关心部署问题，则可以使用符号链接（假设您的文件系统支持它）使模块或包在请求模块的文件夹中直接可见。

```
ln -s (path)/module_name.py 
```

或者

```
ln -s (path)/package_name 
```

* * *

*注意：“模块”是扩展名为 .py 的任何文件，“包”是包含该文件的任何文件夹`__init__.py`（可以是空文件）。从使用的角度来看，模块和包是相同的——都按照命令的要求公开了它们包含的“定义和语句” `import`。*

请参阅：[http ://docs.python.org/2/tutorial/modules.html](http://docs.python.org/2/tutorial/modules.html)

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2011-08-31T20:02:15.783

```
from .dirBar import Bar 
```

代替：

```
from dirBar import Bar 
```

以防万一可能安装了另一个 dirBar 并混淆了 foo.py 阅读器。

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2014-10-29T19:49:53.793

对于这种将 Bar.py 导入 Foo.py 的情况，首先我会将这些文件夹转换为 Python 包，如下所示：

```
dirFoo\
    __init__.py
    Foo.py
    dirBar\
        __init__.py
        Bar.py 
```

然后我会在 Foo.py 中这样做：

```
from .dirBar import Bar 
```

如果我希望命名空间看起来像 Bar. *随便*，或者

```
from . import dirBar 
```

如果我想要命名空间 dirBar.Bar。*无论如何*。如果 dirBar 包下有更多模块，则第二种情况很有用。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2010-02-28T20:34:59.760

添加一个**__init__.py**文件：

```
dirFoo\
    Foo.py
    dirBar\
        __init__.py
        Bar.py 
```

然后将此代码添加到 Foo.py 的开头：

```
import sys
sys.path.append('dirBar')
import Bar 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2014-07-29T07:27:39.437

相对 sys.path 示例：

```
# /lib/my_module.py
# /src/test.py

if __name__ == '__main__' and __package__ is None:
    sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '../lib')))
import my_module 
```

基于[这个](https://stackoverflow.com/a/19190695/991267)答案。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2015-04-01T22:29:39.357

好吧，正如您所提到的，通常您希望访问与您的主脚本运行位置相关的包含模块的文件夹，因此您只需导入它们。

解决方案：

我有脚本`D:/Books/MyBooks.py`和一些模块（如 oldies.py）。我需要从子目录导入`D:/Books/includes`：

```
import sys,site
site.addsitedir(sys.path[0] + '\\includes')
print (sys.path)  # Just verify it is there
import oldies 
```

放置一个`print('done')`in `oldies.py`，这样您就可以验证一切正常。这种方式总是有效的，因为`sys.path`根据程序启动时初始化的 Python 定义，该列表的第一项`path[0]`是包含用于调用 Python 解释器的脚本的目录。

如果脚本目录不可用（例如，如果以交互方式调用解释器或从标准输入读取脚本），`path[0]`则为空字符串，它指示 Python 首先搜索当前目录中的模块。请注意，脚本目录是在插入的条目之前插入的`PYTHONPATH`。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2016-08-06T21:26:58.767

另一种解决方案是安装[py-require](https://pypi.python.org/pypi/py-require)包，然后在`Foo.py`

```
import require
Bar = require('./dirBar/Bar') 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2018-01-26T19:30:49.757

您可以简单地使用：`from Desktop.filename import something`

例子：

> 鉴于该文件是`test.py`目录 中的名称`Users/user/Desktop`，并且将导入所有内容。

编码：

```
from Desktop.test import * 
```

但请确保`__init__.py`在该目录中创建一个名为“”的空文件

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-01-27T17:43:59.530

这是一种使用相对路径从上一层导入文件的方法。

基本上，只需将工作目录向上移动一个级别（或任何相对位置），将其添加到您的路径中，然后将工作目录移回它开始的位置。

```
#to import from one level above:
cwd = os.getcwd()
os.chdir("..")
below_path =  os.getcwd()
sys.path.append(below_path)
os.chdir(cwd) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-11-09T14:38:21.210

我对python没有经验，所以如果我的话有任何错误，请告诉我。如果您的文件层次结构是这样排列的：

```
project\
    module_1.py 
    module_2.py 
```

`module_1.py`定义了一个名为**module_2.py**`func_1()`的函数：

 **```
from module_1 import func_1

def func_2():
    func_1()

if __name__ == '__main__':
    func_2() 
```

你`python module_2.py`在 cmd 中运行，它会运行`func_1()`定义的内容。这通常是我们导入相同层次结构文件的方式。但是当你写`from .module_1 import func_1`进去的时候`module_2.py`，python解释器会说`No module named '__main__.module_1'; '__main__' is not a package`。因此，为了解决这个问题，我们只需保留我们刚刚所做的更改，并将两个模块都移动到一个包中，并将第三个模块作为调用者来运行`module_2.py`。

```
project\
    package_1\
        module_1.py
        module_2.py
    main.py 
```

**主.py**：

```
from package_1.module_2 import func_2

def func_3():
    func_2()

if __name__ == '__main__':
    func_3() 
```

但是我们添加`.`before `module_1`in的原因`module_2.py`是，如果我们不这样做并运行`main.py`，python 解释器会说`No module named 'module_1'`，这有点棘手，`module_1.py`就在旁边`module_2.py`。现在我让`func_1()`做`module_1.py`一些事情：

```
def func_1():
    print(__name__) 
```

记录`__name__`谁调用了 func_1。现在我们保留`.`之前的`module_1`，运行`main.py`，它会打印`package_1.module_1`，不会`module_1`。它表示呼叫者与`func_1()`处于同一层次`main.py`，`.`暗示`module_1`与自身处于同一层次`module_2.py`。因此，如果没有点，`main.py`将识别`module_1`与自身相同的层次结构，它可以识别`package_1`，但不能识别它“下”的内容。

现在让我们让它变得有点复杂。你有一个`config.ini`和一个模块定义了一个函数来在与'main.py'相同的层次结构中读取它。

```
project\
    package_1\
        module_1.py
        module_2.py
    config.py
    config.ini
    main.py 
```

并且由于某些不可避免的原因，您必须使用 调用它`module_2.py`，因此它必须从上层结构中导入。**模块_2.py**：

```
 import ..config
 pass 
```

两个点表示从上层导入（三个点访问上层，等等）。现在我们运行`main.py`，解释器会说：`ValueError:attempted relative import beyond top-level package`。这里的“顶级包”是`main.py`. 正因为`config.py`是beside `main.py`，它们处于同一层次，`config.py`不是“under” `main.py`，或者不是“leaded” `main.py`，所以它是beyond `main.py`。要解决此问题，最简单的方法是：

```
project\
    package_1\
        module_1.py
        module_2.py
    config.py
    config.ini
main.py 
```

我认为这与排列项目文件层次结构的原则不谋而合，您应该将具有不同功能的模块排列在不同的文件夹中，并在外面留下一个顶级调用者，您可以随心所欲地导入。

* * *

## 回答 #21

> 赞同：-4
> 
> 时间：2018-07-25T20:23:39.240

这也有效，并且比模块中的任何内容都简单得多`sys`：

```
with open("C:/yourpath/foobar.py") as f:
    eval(f.read()) 
```

* * *

## 回答 #22

> 赞同：-15
> 
> 时间：2011-09-22T19:33:39.083

称我过于谨慎，但我喜欢让我的更便携，因为假设文件总是在每台计算机上的同一个位置是不安全的。我个人让代码首先查找文件路径。我使用 Linux，所以我的看起来像这样：

```
import os, sys
from subprocess import Popen, PIPE
try:
    path = Popen("find / -name 'file' -type f", shell=True, stdout=PIPE).stdout.read().splitlines()[0]
    if not sys.path.__contains__(path):
        sys.path.append(path)
except IndexError:
    raise RuntimeError("You must have FILE to run this program!") 
```

当然，除非您打算将这些打包在一起。但如果是这种情况，您实际上并不需要两个单独的文件。

# css - 如何在不首先转换为 (X)HTML 的情况下使用 CSS 设置 XML 样式以便在浏览器中查看？

> ID：279240
> 
> 赞同：3
> 
> 时间：2008-11-10T21:29:25.470
> 
> 标签：css, xml

我知道 CSS 可用于控制 (X)HTML 在现代浏览器中的呈现。我的印象是这对于任意 XML 也是可能的。（我错了吗？）

**一个具体的例子**：给定以下 XML

```
<log>
  <entry revision="1">
    <author>J Random Hacker</author>
    <message>Some pithy explanation</message>
  </entry>
</log> 
```

我想将 CSS 与此 XML 相关联，这样当在现代（WebKit、FireFox）浏览器中查看时，我会看到如下内容：

```
+----------------------------------+
| revision | 1                     |
+----------------------------------+
| author   | J Random Hacker       |
+----------------------------------+
| message  | Some pithy explanation|
+----------------------------------+ 
```

我的 oh-so-beautiful ascii-art 是为了表示一些类似表格的布局。

即：XML+CSS --> "pixels for user" 而不是 XML+XSLT --> XHTML+CSS --> "pixels for user"。

我希望这种方法可以更简单的方式（对我而言）来呈现在其结构中已经类似于文档的 XML 文档。我也只是好奇。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T21:33:54.277

确实可以使用 CSS 来格式化 XML 文档。

[W3 学校示例](http://www.w3schools.com/Xml/xml_display.asp)

（W3C 确实建议使用 xslt 代替 CSS 来做这种事情）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T21:39:45.013

根据[规范](http://www.w3.org/TR/CSS21/intro.html#xml-tutorial)，CSS 应该与 XML 文档以及 HTML 文档一起使用。您可以在 CSS 文件中选择自己的元素，而不是在 CSS 代码中选择常见的 HTML 元素，例如：

```
entry {
    display: block;
}
author {
    display: inline;
    font-weight: bold;
}
... 
```

您可以通过在 XML 文件中插入类似的代码行来将 CSS 文件与 XML 文件相关联：

```
<?xml-stylesheet href="common.css" type="text/css"?> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T21:36:08.593

是的，有可能。您只需为每个元素编写一个规则：

```
author{
   display:block;
   color:#888888;
} 
```

等等

# wxwidgets - wxGrid中的隐藏信息

> ID：279241
> 
> 赞同：1
> 
> 时间：2008-11-10T21:29:55.297
> 
> 标签：wxwidgets

我有一个动态填充的 wxGrid。我想在每一行中存储一些不应该向用户显示的信息。将数据与行关联的最佳方法是什么？我应该只创建一个隐藏列还是有更好的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T20:57:36.220

创建隐藏列是最快的，但确实是一种非常丑陋的方法。如果您可以证明努力的合理性，那么您应该更好地创建自己的网格表基类。您自己的*wxGridTableBase*派生类可以保存您需要的任何信息，而无需在网格中显示它。不幸的是，该类的文档很少或几乎不存在。

有关示例，请参见 wxWidgets 示例目录中的网格演示，特别是*BugsGridTable*类。您会注意到，您不必存储网格将显示的字符串，但您可以在*GetValue()*方法中格式化数据。这可能会好很多，无论是在内存消耗方面，还是因为您可以即时更改显示数据的格式。

切换到自定义网格表基类对 Firebird 关系数据库的管理工具[FlameRobin](http://www.flamerobin.org)的结果集数据网格的速度、内存消耗和功能产生了很大影响。您可以随时查看它的源代码，了解我们如何使用 wxGrid。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-08T12:23:06.293

使用 SetRowLabelValue 将值存储在行标签中并隐藏行标签。

# frameworks - 程序文件（X86）下框架 3.5 上的 WSE 3.0

> ID：279252
> 
> 赞同：1
> 
> 时间：2008-11-10T21:33:33.387
> 
> 标签：frameworks, web-services-enhancements

我正在将 Web 应用程序部署到 Windows Server 2003 机器上。
该应用程序使用 WSE 3.0，并以框架 3.5 为目标。
WSE 安装在服务器上的 C:\Program Files(X86)\Microsoft WSE\v3.0 下。WSE 也安装在服务器上的 GAC 中。

当我运行应用程序时，我收到以下错误：

System.IO.FileNotFoundException：无法加载文件或程序集“Microsoft.Web.Services3，Version=3.0.0.0，Culture=neutral，PublicKeyToken=31bf3856ad364e35”或其依赖项之一。该系统找不到指定的文件。

有人遇到过这个问题吗？

谢谢，卡特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T21:37:01.103

将其放入您网站的 Bin 文件夹中。如果它在那里并且仍然存在问题，请使用[依赖遍历器](http://www.dependencywalker.com/)查找任何可能丢失的相关文件。

# sql-server - 折叠 T-SQL？

> ID：279269
> 
> 赞同：5
> 
> 时间：2008-11-10T21:40:09.940
> 
> 标签：sql-server, tsql

如果我有以下格式的数据

```
 id    subid      text
 1     1          Hello
 1     2          World
 1     3          !
 2     1          B
 2     2          B
 2     3          Q 
```

并希望采用这种格式：

```
 id  fold
 1   HelloWorld!
 2   BBQ 
```

我如何在 T-SQL 中完成它？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-10T21:41:37.770

我强烈反对这样做。这就是应该在您的应用程序层中处理的事情。

但是...如果必须：
[在 Transact-SQL 中连接行值](https://www.simple-talk.com/sql/t-sql-programming/concatenating-row-values-in-transact-sql/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T21:41:16.117

一个临时表和一个光标跃入脑海......

亲爱的投票者：临时表和游标必须至少与上面接受的递归查询和自定义函数解决方案一样有效。克服对游标的恐惧，有时它们是最有效的解决方案。有时它们是唯一的解决方案。处理它。

编辑：下面基于光标的解决方案。请注意，它没有其他地方提出的非光标（和更复杂）解决方案的限制，并且性能可能大致相同（当然很难从六行表中分辨出来）。

请不要仅仅因为某些博主说“这很糟糕”而放弃了 sql 的主要 for-each 构造；使用你自己的判断和一些常识。我尽可能避免使用游标，但不会到解决方案不可靠的地步。

```
--initial data table
create table #tmp (
    id int,
    subid int,
    txt varchar(256)
)

--populate with sample data from original question
insert into #tmp (id,subid,txt) values (1, 1, 'Hello')
insert into #tmp (id,subid,txt) values (1, 2, 'World')
insert into #tmp (id,subid,txt) values (1, 3, '!')
insert into #tmp (id,subid,txt) values (2, 1, 'B')
insert into #tmp (id,subid,txt) values (2, 2, 'B')
insert into #tmp (id,subid,txt) values (2, 3, 'Q')

--temp table for grouping results
create table #tmpgrp (
    id int,
    txt varchar(4000)
)

--cursor for looping through data
declare cur cursor local for
    select id, subid, txt from #tmp order by id, subid

declare @id int
declare @subid int
declare @txt varchar(256)

declare @curid int
declare @curtxt varchar(4000)

open cur

fetch next from cur into @id, @subid, @txt

set @curid = @id
set @curtxt = ''

while @@FETCH_STATUS = 0 begin
    if @curid <> @id begin
        insert into #tmpgrp (id,txt) values (@curid,@curtxt)
        set @curid = @id
        set @curtxt = ''
    end
    set @curtxt = @curtxt + isnull(@txt,'')
    fetch next from cur into @id, @subid, @txt
end

insert into #tmpgrp (id,txt) values (@curid,@curtxt)

close cur

deallocate cur

--show output
select * from #tmpgrp

--drop temp tables
drop table #tmp
drop table #tmpgrp 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-04T03:46:06.663

```
declare  @tmp table (id int, subid int,txt varchar(256) )  
--populate with sample data from original question 
insert into @tmp (id,subid,txt) values (1, 1, 'Hello') 
insert into @tmp (id,subid,txt) values (1, 2, 'World') 
insert into @tmp (id,subid,txt) values (1, 3, '!') 
insert into @tmp (id,subid,txt) values (2, 1, 'B') 
insert into @tmp (id,subid,txt) values (2, 2, 'B') 
insert into @tmp (id,subid,txt) values (2, 3, 'Q') 
```

**解决方案**

```
Select id, fold = (Select cast(txt as varchar(100)) from @tmp t2 where t1.id = t2.id for xml path(''))
from @tmp t1
group by t1.id 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T21:53:19.697

将其包装在一个函数中以进行单次执行...

```
DECLARE @returnValue varchar(4000)

SELECT @returnValue = ISNULL(@returnValue + ', ' +  myTable.text, myTable.text)
FROM myTable 

RETURN @returnValue 
```

对于少量记录，这将起作用……对于 SQL 函数来说，超过 5 或 10 条记录太多了，需要按照其他人的建议将其移至应用层。

# ruby - 你喜欢哪种风格的 Ruby 字符串引用？

> ID：279270
> 
> 赞同：46
> 
> 时间：2008-11-10T21:40:40.393
> 
> 标签：ruby, string

你喜欢哪种风格的 Ruby 字符串引用？直到现在我一直使用`'single quotes'`，除非字符串包含某些转义序列或插值，在这种情况下我显然必须使用`"double quotes"`.

但是，真的有任何理由不到处使用双引号字符串吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-11-10T22:44:07.630

如果必须转义，请不要使用双引号。并且不要陷入“单引号对双引号”的陷阱。Ruby 对字符串文字的任意分隔符有很好的支持：

网站镜像 - [https://web.archive.org/web/20160310224440/http://rors.org/2008/10/26/dont-escape-in​​-strings](https://web.archive.org/web/20160310224440/http://rors.org/2008/10/26/dont-escape-in-strings)

原始网站 - [http://rors.org/2008/10/26/dont-escape-in​​-strings](http://rors.org/2008/10/26/dont-escape-in-strings)

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-11-10T21:46:06.730

除非我需要插值，否则我总是使用单引号。

为什么？它看起来更好。当屏幕上有大量内容时，与大量双引号相比，大量单引号会给您带来更少的“视觉混乱”。

我想指出，这不是我故意决定做的事情，只是我随着时间的推移“进化”以试图获得更好看的代码的事情。

如果需要内联引号，有时我会使用 %q 或 %Q。我只使用过 heredocs 一次或两次。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-11-11T23:55:45.363

像许多程序员一样，我尽量做到具体。这意味着我试图通过让我的代码尽可能简单来让编译器做尽可能少的工作。所以对于字符串，我使用最简单的方法来满足我对该字符串的需求。

```
<<END
For strings containing multiple newlines, 
particularly when the string is going to
be output to the screen (and thus formatting
matters), I use heredocs.
END

%q[Because I strongly dislike backslash quoting when unnecessary, I use %Q or %q
for strings containing ' or " characters (usually with square braces, because they
happen to be the easiest to type and least likely to appear in the text inside).]

"For strings needing interpretation, I use %s."%['double quotes']

'For the most common case, needing none of the above, I use single quotes.' 
```

我对程序提供的语法高亮质量的第一个简单测试是查看它处理所有引用方法的能力。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-11T23:19:13.033

除非我需要插值，否则我使用单引号。当您需要插值时，稍后更改会很麻烦的论点也在另一个方向摆动：当您发现字符串中有 # 或 \ 导致您没有转义时，您必须从 double 更改为 single ' t 打算。

默认使用单引号的优点是，在采用此约定的代码库中，引号类型充当了是否需要插值表达式的视觉提示。当您的编辑器或 IDE 以不同方式突出显示两种字符串类型时，这一点会更加明显。

我对多行字符串使用 %{.....} 语法。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-10T21:42:19.813

我通常使用双引号，除非我特别需要禁用转义/插值。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-07-17T01:08:58.267

我看到了两者的论点：

对于主要使用双引号：

*   [github ruby​​ 风格指南](https://github.com/styleguide/ruby)主张始终使用双引号：

![在此处输入图像描述](https://i.stack.imgur.com/qxTTV.png)

*   如果您与引用一致，则通过搜索“foobar”来搜索字符串 foobar 会更容易。然而，我不是。所以我搜索 ['"]foobar['"] 打开正则表达式。

对于使用单双引号的某种组合：

*   知道您是否需要寻找字符串插值。
*   可能会稍微快一些（尽管如此轻微，不足以影响 github 风格指南）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-11T05:41:15.180

我曾经使用单引号，直到我知道我需要插值。然后我发现当我回去必须将一些单引号更改为双引号时，我浪费了很多时间。性能测试显示使用双引号对速度没有可测量的影响，因此我主张始终使用双引号。

唯一的例外是在替换字符串中使用带有反向引用的 sub/gsub。然后你应该使用单引号，因为它更简单。

```
mystring.gsub( /(fo+)bar/, '\1baz' )
mystring.gsub( /(fo+)bar/, "\\1baz" )
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T22:49:19.647

我使用单引号，除非我需要插值，或者字符串包含单引号。

但是，我刚刚从 Dejan 的回答中学到了任意分隔符技巧，我认为这很棒。=)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-10-08T11:46:33.283

单引号保留其中的字符。但是双引号会评估和解析它们。请参见以下示例：

```
"Welcome #{@user.name} to App!" 
```

结果：

> 欢迎 Bhojendra 使用 App！

但，

```
'Welcome #{@user.name} to App!' 
```

结果：

> 欢迎 #{@user.name} 使用 App！

# java - Handling a timed out FutureTask

> ID：279282
> 
> 赞同：2
> 
> 时间：2008-11-10T21:43:53.820
> 
> 标签：java, concurrency

Let's say I do something in Java like:

```
 RemoteResponse response = null;
try {
   FutureTask task new FutureTask(....);
   executor.execute(task);
   response = task.get(1000, TimeUnits.MILLISECONDS);
}
catch( TimeoutException te ) {
   **.. should I do something special here? ...
   .. what happens to the return value of the task if task.get() throws an exception? ...
   .. is it ever garbage collected? ..** 
} 

```

My question is does something hold onto RemoteResponse in the case where TimeoutException is thrown? Will it get garbage collected? Do I have to call the cancel() method on the task for that to happen?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T21:56:49.533

Edit after the question was revised:

`response` is a reference to a `RemoteResponse` that `task` is responsible for allocating. The assignment of the return value from a method won't happen if the method threw an exception, so there is no need for special handling of `response`.

`task` will be unreferenced when it goes out of scope, either through normal execution or if an exception is thrown.

If the resources allocated by `task` are well encapsulated, ie there are no externally held references, and are released (`close`, `release`, whatever), then there should be no resource leakage.

There's no need to call cancel unless there is some shared resource the `task` has exclusively or some other consumable resource that the rest of the application needs.

I'd at least log the fact that the task didn't complete in the time allotted. What else you do depends on the requirements of your application.

Note that `task` will continue executing until completion, regardless of the `get` call.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-16T14:10:51.080

I think the way to look at the problem is that you need to claim the resource outside of the FutureTask, so that when you do decide to cancel it you can force the reclamation of resources.

so:

```
Resource res = null;
try {
 resource = ResourceAquirer.claim()

 FutureTask<?> task = new FutureTask<?>(resource);
 executor.execute(task);   
 response = task.get(1000, TimeUnits.MILLISECONDS);
} catch (Exception e) {
  // logging
} finally {
 if (resource != null) {
   resource.release();
 }
} 
```

This way you can be sure that the resource will be freed. It is really frustrating that all of that cannot be encapuslated inside the future task, but I cannot find proof that calling cancel on a futuretask will ensure that a finally block is invoked inside the FutureTask. (Maybe I'll ask that as another question)

# linq - 使用 Linq to Sql，如何从查询中获取特定结果？

> ID：279286
> 
> 赞同：1
> 
> 时间：2008-11-10T21:46:02.987
> 
> 标签：linq, linq-to-sql

我想得到这个查询返回的最后一个结果。我该怎么做呢？Linq to Sql 不支持 Last 和 LastOrDefault。

```
 var docs = (from d in db.Documents                      
                    where d.Version > 1
                    orderby d.DocumentID
                    select new   
                               {                                     
                                   d.DocumentID,
                                   d.DocTypeID,
                                   d.Name,
                                   d.Version
                               }); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T21:48:37.227

反转您的排序标准（添加`descending`）并使用`First`（或`FirstOrDefault`根据需要）。

# websphere - 如何在 WebSphere Application Server 6.0.2.23 中重命名应用程序服务器

> ID：279293
> 
> 赞同：5
> 
> 时间：2008-11-10T21:47:16.760
> 
> 标签：websphere

我们正在重新调整运行 WebSphere 6.0.2.23 的应用程序服务器的用途。我想重命名各种应用服务器以更好地体现其新角色。

如何重命名应用服务器？

似乎 wsadmin 可以做到，但我正在努力处理对象层次结构。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-04-21T07:57:31.527

[IBM 示例脚本](http://www.ibm.com/developerworks/websphere/library/samples/SampleScripts.html)

下载：

> 配置脚本.zip

从命令行执行：

```
/usr/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/ws_ant.sh \
-profileName AppSrv01 \
-buildfile exportImport.xml \
-logfile rename.log \
-DoldServerName=server1 \
-DnewServerName=server2 \
-DnodeName=yourNode01 changeServerName 
```

[资源](http://biounix.blogspot.com/2009/01/how-to-change-websphere-app-server-name.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-05T00:15:14.333

如果您正在运行集群设置，一个更简单的选择是创建一个具有所需名称的新集群成员。

删除旧服务器并记下原始服务器的所有端口并将它们声明为新服务器的端口号（如果您需要相同的端口号）

如果您使用的是非集群环境，则在现有服务器之外创建一个模板。根据该模板创建新服务器，以便您拥有所有必需的配置。现在像之前一样将端口号更改回原来的端口号。

**如果端口号的更改对您来说不是问题，那么您不需要执行该步骤。**

高温高压

芒鲁

# c# - 将日期添加到日期但不包括周末

> ID：279296
> 
> 赞同：31
> 
> 时间：2008-11-10T21:48:21.750
> 
> 标签：c#, f#, date

给定一个日期，我如何添加天数，但不包括周末。例如，给定 2008 年 11 月 12 日（星期三）并添加 5 将导致 2008 年 11 月 19 日（星期三）而不是 2008 年 11 月 17 日（星期一）。

我可以想到一个简单的解决方案，例如循环遍历每一天以添加并检查是否是周末，但我想看看是否有更优雅的东西。我也会对任何 F# 解决方案感兴趣。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-09-04T12:40:55.590

使用流利的日期时间[https://github.com/FluentDateTime/FluentDateTime](https://github.com/FluentDateTime/FluentDateTime)

```
var dateTime = DateTime.Now.AddBusinessDays(4); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T22:10:17.853

```
public DateTime AddBusinessDays(DateTime dt, int nDays)
{
    int weeks = nDays / 5;
    nDays %= 5;
    while(dt.DayOfWeek == DayOfWeek.Saturday || dt.DayOfWeek == DayOfWeek.Sunday)
        dt = dt.AddDays(1);

    while (nDays-- > 0)
    {
        dt = dt.AddDays(1);
        if (dt.DayOfWeek == DayOfWeek.Saturday)
            dt = dt.AddDays(2);
    }
    return dt.AddDays(weeks*7);
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-06-10T12:13:45.610

在不使算法过于复杂的情况下，您可以像这样创建一个扩展方法：

```
public static DateTime AddWorkingDays(this DateTime date, int daysToAdd)
{
    while (daysToAdd > 0)
    {
        date = date.AddDays(1);

        if (date.DayOfWeek != DayOfWeek.Saturday && date.DayOfWeek != DayOfWeek.Sunday)
        {
            daysToAdd -= 1;
        }
    }

    return date;
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2016-06-14T11:53:04.487

我会使用此扩展，请记住，因为它是一种将其放入静态类的扩展方法。

用法：

```
var dateTime = DateTime.Now.AddBusinessDays(5); 
```

代码：

```
namespace ExtensionMethods
{
    public static class MyExtensionMethods
    {
        public static DateTime AddBusinessDays(this DateTime current, int days)
        {
            var sign = Math.Sign(days);
            var unsignedDays = Math.Abs(days);
            for (var i = 0; i < unsignedDays; i++)
            {
                do
                {
                    current = current.AddDays(sign);
                } while (current.DayOfWeek == DayOfWeek.Saturday ||
                         current.DayOfWeek == DayOfWeek.Sunday);
            }
            return current;
        }
    }
} 
```

来源：

[https://github.com/FluentDateTime/FluentDateTime/blob/master/src/FluentDateTime/DateTime/DateTimeExtensions.cs](https://github.com/FluentDateTime/FluentDateTime/blob/master/src/FluentDateTime/DateTime/DateTimeExtensions.cs)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-10T22:14:45.097

```
int daysToAdd = weekDaysToAdd + ((weekDaysToAdd / 5) * 2) + (((origDate.DOW + (weekDaysToAdd % 5)) >= 5) ? 2 : 0); 
```

以机智; 要添加的“实际”天数是您指定的工作日数，加上该总数中的完整周数（因此是 weekDaysToAdd / 5）乘以两次（周末两天）；如果一周中的原始日期加上要在一周内添加的工作日数（因此 weekDaysToAdd mod 5）大于或等于 5（即是周末），则加上两天的潜在偏移量。

注意：这是假设 0 = 星期一，2 = 星期二，... 6 = 星期日。还; 这不适用于负工作日间隔。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-08-06T12:49:03.553

我创建了一个扩展程序，允许您增加或减少工作日。使用负数 businessDays 减去。它似乎在所有情况下都有效。

```
namespace Extensions.DateTime
{
    public static class BusinessDays
    {
        public static System.DateTime AddBusinessDays(this System.DateTime source, int businessDays)
        {
            var dayOfWeek = businessDays < 0
                                ? ((int)source.DayOfWeek - 12) % 7
                                : ((int)source.DayOfWeek + 6) % 7;

            switch (dayOfWeek)
            {
                case 6:
                    businessDays--;
                    break;
                case -6:
                    businessDays++;
                    break;
            }

            return source.AddDays(businessDays + ((businessDays + dayOfWeek) / 5) * 2);
        }
    }
} 
```

例子：

```
using System;
using System.Windows.Forms;
using Extensions.DateTime;

namespace AddBusinessDaysTest
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            label1.Text = DateTime.Now.AddBusinessDays(5).ToString();
            label2.Text = DateTime.Now.AddBusinessDays(-36).ToString();
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-05-20T20:56:00.857

[http://stackoverflow.com/questions/1044688](http://stackoverflow.com/questions/1044688)的F# 风格的回答：

```
namespace FSharpBasics

module BusinessDays =

    open System;

    let private weekLength = 5

    (*operation*)
    let addBusinessDays (numberOfBusinessDays: int) (startDate: DateTime) =
        let startWeekDay = startDate.DayOfWeek
        let sign = Math.Sign(numberOfBusinessDays) 
        let weekendSlide, businessDaysSlide = 
            match startWeekDay with
            | DayOfWeek.Saturday when sign > 0 -> (2, -1)
            | DayOfWeek.Saturday when sign < 0 -> (-1, 1)   
            | DayOfWeek.Sunday when sign > 0 -> (1, -1)
            | DayOfWeek.Sunday when sign < 0 -> (-2, 1)
            | _ -> (0, 0)
        let baseStartDate = startDate.AddDays (float weekendSlide)        
        let days = Math.Abs (numberOfBusinessDays + businessDaysSlide) % weekLength
        let weeks = Math.Abs (numberOfBusinessDays + businessDaysSlide) / weekLength
        let baseWeekDay = int baseStartDate.DayOfWeek
        let oneMoreWeekend =
            if sign = 1 && days + baseWeekDay > 5 || sign = -1 && days >= baseWeekDay then 2
            else 0
        let totalDays = (weeks * 7) + days + oneMoreWeekend
        baseStartDate.AddDays (float totalDays)

    [<EntryPoint>]
    let main argv =
        let now = DateTime.Now 
        printfn "Now is %A" now
        printfn "13 business days from now would be %A" (addBusinessDays 13 now)
        System.Console.ReadLine() |> ignore
        0 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-02-13T14:10:35.007

如果有人正在寻找`TSQL`解决方案，这会更好。一行代码和底片一起工作。

```
CREATE FUNCTION[dbo].[AddBusinessDays](@Date date,@n INT)RETURNS DATE AS BEGIN 
DECLARE @d INT;SET @d=4-SIGN(@n)*(4-DATEPART(DW,@Date));
RETURN DATEADD(D,@n+((ABS(@n)+@d-2)/5)*2*SIGN(@n)-@d/7,@Date)END 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-07-22T10:59:29.573

这是我的做法。

我必须根据开始日期和天数计算 SLA（服务水平协议）到期日，并考虑周末和公共假期：

```
 public DateTime? CalculateSLADueDate(DateTime slaStartDateUTC, double slaDays)
    {
        if (slaDays < 0)
        {
            return null;
        }

        var dayCount = slaDays;
        var dueDate = slaStartDateUTC;

        var blPublicHoliday = new PublicHoliday();
        IList<BusObj.PublicHoliday> publicHolidays = blPublicHoliday.SelectAll();

        do
        {
            dueDate = dueDate.AddDays(1);

            if ((dueDate.DayOfWeek != DayOfWeek.Saturday)
            && (dueDate.DayOfWeek != DayOfWeek.Sunday)
            && !publicHolidays.Any(x => x.HolidayDate == dueDate.Date))
            {
                dayCount--;
            }
        }
        while (dayCount > 0);

        return dueDate;
    } 
```

blPublicHoliday.SelectAll() 是公共假期的缓存内存列表。

（注意：这是公开分享的精简版，它不是扩展方法是有原因的）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-02-22T23:34:40.627

```
enter code public static DateTime AddWorkDays(DateTime dt,int daysToAdd)
    {
        int temp = daysToAdd;
        DateTime endDateOri = dt.AddDays(daysToAdd);
        while (temp !=0)
        {
            if ((dt.AddDays(temp).DayOfWeek == DayOfWeek.Saturday)|| (dt.AddDays(temp).DayOfWeek == DayOfWeek.Sunday))
            {
                daysToAdd++;
                temp--;
            }
            else
            {
                temp--;
            }
        }
        while (endDateOri.AddDays(temp) != dt.AddDays(daysToAdd))
        {
            if ((dt.AddDays(temp).DayOfWeek == DayOfWeek.Saturday) || (dt.AddDays(temp).DayOfWeek == DayOfWeek.Sunday))
            {
                daysToAdd++;
            }
            temp++;
        }
        // final enddate check
        if (dt.AddDays(daysToAdd).DayOfWeek == DayOfWeek.Saturday)
        {
            daysToAdd = daysToAdd + 2;
        }
        else if (dt.AddDays(daysToAdd).DayOfWeek == DayOfWeek.Sunday)
        {
            daysToAdd++;
        }
        return dt.AddDays(daysToAdd);
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-08-05T06:12:27.673

```
DateTime oDate2 = DateTime.Now;

int days = 8;

for(int i = 1; i <= days; i++)
{
  if (oDate.DayOfWeek == DayOfWeek.Saturday) 
  {
    oDate = oDate.AddDays(2);
  }
  if (oDate.DayOfWeek == DayOfWeek.Sunday) 
  {
    oDate = oDate.AddDays(1);
  }
  oDate = oDate.AddDays(1);
} 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-11-10T21:55:03.080

给定 D 年的原始日数和 W 周的原始日数以及要添加 N 的工作日数，下一个工作日数为

```
W + N % 5. 
```

一年中的第二天（没有环绕检查）是

```
D + ((N / 5) * 7) + N % 5). 
```

这是假设您有整数除法。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-09-24T17:51:13.130

公式为：Workday(date,no.of days,(weekday(1)))

试试这个。这会有所帮助。

# c# - 非静态字段、方法或属性需要对象引用

> ID：279306
> 
> 赞同：0
> 
> 时间：2008-11-10T21:51:12.463
> 
> 标签：c#, .net, visual-studio-2008

行。我对以下代码有疑问：

```
StreamReader arrComputer = new StreamReader(FileDialog.FileName); 
```

我的第一个问题已经得到回答，现在我的第二个问题集中在这段代码的尾部。

我正在阅读`StreamReader`用户使用按钮事件选择的文本文件`OpenFileDialog`

```
private void button1_Click(object sender, EventArgs e)

        {
            OpenFileDialog fileDialog = new OpenFileDialog();
            fileDialog.InitialDirectory = @"C:\";
            fileDialog.Filter = "Text|*.txt|All|*.*";
            if (fileDialog.ShowDialog() == DialogResult.OK) ;
            textBox1.Text = fileDialog.FileName;
            buttonRun.Enabled = true;
        } 
```

在代码的后面，用户将单击“运行”按钮以针对列表中的每个项目执行一些代码。

我在使用 StreamReader 使用以下代码解析列表时遇到问题：

```
private void buttonRun_Click(object sender, EventArgs e)
        {
            StreamReader arrComputer = new StreamReader(FileDialog.FileName);

        } 
```

这是我从编码中收到的错误：

```
"An object reference is required for the non-static field, method, or property 'System.Windows.Forms.FileDialog.FileName.get' " 
```

我想我理解这个问题，但我很难解决它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T22:00:40.883

在我看来，您正在 button1_Click 方法中创建一个新的 OpenFileDialog 对象，并将对该对象的唯一引用存储在局部变量 fileDialog 中。

然后，在您的 buttonRun_Click 方法中，您似乎想从您在前一个方法中创建的对话框中获取文件名。不过，这不是你正在做的。编译器将您的代码解释为尝试读取 FileDialog 类的 FileName 属性，就好像它是静态成员一样。您的代码中还有其他问题，但导致您引用的编译器错误的问题可能是 FileDialog.FileName 问题。

您的意思是从您在第一个方法中创建的 OpenFileDialog 实例中读取 FileName 属性，但该对象仅存储在局部变量中。在第一种方法之外，您无法访问它。但由于您还在文本框中存储了文件名，因此您可以从该文本框中读取文件名，因此您不需要访问 OpenFileDialog 对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T21:57:34.087

你不认为你需要使用 textBox1.Text 吗？

```
 StreamReader arrComputer = new StreamReader(textBox1.Text); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T22:00:44.113

`FileDialog`是一个类名，您需要使用一个对象来访问该`FileName`属性，因此会出现错误。我建议使用，但是当方法退出时`fileDialog.FileName`，您已经丢弃了`fileDialog`（注意小写“f”） 。`button1_Click`

但是，您在该方法退出之前保存了文件名`textBox1.Text`，它应该仍然可用。尝试使用它：

```
StreamReader arrComputer = new StreamReader(textBox1.Text); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T21:59:39.573

尝试这样做：

```
private void buttonRun_Click(object sender, EventArgs e) {
    StreamReader arrComputer = new StreamReader(textBox1.Text);
} 
```

当你确定你的 FileOpen 对话框时，你将选择的文件名存储在你的表单上（通过设置 textBox1.Text），所以你最好使用这个存储的值而不是参考原始的 FileOpen 对话框。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T21:53:51.193

是`FileDialog`控件的名称，还是控件的类型？我猜是那种类型。当您将文件对话框拖到窗口中时，您会得到一个名为 FileDialog1 的 FileDialog。试试看，让我知道。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T22:02:29.240

在`button1_Click`您定义的局部`fileDialog`变量中，该变量在事件处理程序结束时消失。

在`buttonRun_Click`您使用类上的类方法时`FileDialog`。

似乎您需要在表单级别（在 button1_Click 之外）声明一个 fileDialog 变量，并在两个事件处理程序中使用相同的变量。

当做这个手表的`fileDialog`和`FileDialog`拼写。

# asp.net - 在 ASP.NET Web 应用程序中使用自定义生成提供程序

> ID：279307
> 
> 赞同：2
> 
> 时间：2008-11-10T21:51:56.157
> 
> 标签：asp.net

我试图找到一种从数据库中的查找表动态生成枚举类的方法，并且仍然具有普通类的便利（即智能感知）。

在过去的几个小时里，我一直在试图弄清楚如何让自定义 BuildProvider 在 ASP.NET Web 应用程序中工作。该代码在网站中完美运行。[然后我在MSDN](http://msdn.microsoft.com/en-us/library/system.web.compilation.buildprovider.aspx)上找到了一篇文章说

> 将自定义的 BuildProvider 类添加到 Web.config 文件在 ASP.NET 网站中有效，但在 ASP.NET Web 应用程序项目中无效。在 Web 应用程序项目中，BuildProvider 类生成的代码不能包含在应用程序中。有关详细信息，请参阅编译 Web 应用程序项目。

有谁知道是否可以动态生成代码并且仍然能够在设计时“使用”它？使用网站不是一种选择。我需要使用一个网络项目。

谢谢！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T03:12:01.753

动态查找表的枚举类有什么意义？无论如何，您的代码引用将始终是静态的...

如果查找表的初始填充是静态的，则为其创建一个枚举，并且不要在代码中引用任何其他值

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T22:18:10.193

如果 MSDN 说你不能这样做，我会采取另一种方法。也许编写一个小型控制台应用程序来编写您的 Enums.cs 文件并通过“预构建事件命令行”运行它。然后，每次构建 Web 应用程序时，都会重新创建 Enums 类，并且应该可以通过 Intellisense 访问该类。

我自己没有这样做过。希望能帮助到你。

# c# - 异常后重新发送到 MSMQ

> ID：279313
> 
> 赞同：3
> 
> 时间：2008-11-10T21:53:50.710
> 
> 标签：c#, .net, msmq

当抛出异常时，我试图将消息放回 MSMQ。以下代码似乎可以工作，但消息没有放回队列中？

```
Message msg = null;
try
{
    MessageQueue MQueue = new MessageQueue(txtMsgQPath.Text);
    msg = MQueue.ReceiveById(txtQItemToRead.Text);
    lblMsgRead.Text = msg.Body.ToString(); // This line throws exception
}
catch (Exception ex)
{
    lblMsgRead.Text = ex.Message;
    if (msg != null)
    {
        MessageQueue MQ = new MessageQueue(txtMsgQPath.Text);
        MQ.Send(msg);
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T19:41:15.780

几点：最好的方法是使用跨越两个队列的事务；这样你就会知道你不会丢失消息。

第二部分是要注意如何创建队列以及如何将消息提交到第二个队列。特别是，MSMQ 在发送消息时有时会出现“静默失败”（尽管实际上错误消息记录在死信队列的其他位置），特别是如果发送的事务选项与目标的事务性质不匹配队列。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T22:09:26.903

您真的打算将该消息发回给发起者吗？把它寄回给自己是非常危险的，你只会一遍又一遍地再次轰炸。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T22:04:30.003

我相信您正在寻找“偷看”消息。使用：MessageQueue.Peek，如果成功，则使用该消息。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-10T23:01:17.377

我设法通过创建一个新队列并将代码指向新队列来使上面的代码工作。

然后我比较了 2 个队列并注意到新队列是多播的（第一个队列不是），并且新队列有一个标签，而第一个没有。否则，队列似乎是相同的。

# c# - 使用 Ajax 加载用户控件

> ID：279324
> 
> 赞同：3
> 
> 时间：2008-11-10T21:58:42.947
> 
> 标签：c#, asp.net, ajax

我试图找到使用 Ajax 加载用户控件的最佳实践。

我的第一种方法是简单地使用 UpdatePanel 并在 ajax 回发上使用 LoadControl() 填充它，但这会在同一个 UpdatePanel 中重新呈现其他加载的用户控件。此外，我不能有一组预定义的 UpdatePanel，因为我需要加载的 UserControl 的数量会有所不同。

这种情况有什么最佳实践吗？

如果需要，我可以实现一个框架或某种类型的自定义控件，如果这将是一个解决方案，但如果可能的话，我希望使用 ASP.NET 3.5 和 AjaxControlToolkit 来实现这一点。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T22:56:50.723

可能有几十个不这样做的高级理由，而只是初始化一个页面，添加用户控件，然后执行并转储生成的 HTML，无论它可能是你应该的，（在我头脑简单的观点中）如此令人麻木的快速 &有趣的是我不得不提它......

跳过 UpdatePanels，只使用一个标签，一个普通的旧跨度，或者一个首字母缩略词......

在客户端使用 JQuery：

```
$('#SomeContainer').Load("default.aspx?What=GimmeSomeSweetAjax"); 
```

服务器端：

```
if(Request.QueryString["What"]==GimmeSomeSweetAjax)
{
   Page page = new Page();
   Control control = (Control)LoadControl("~/.../someUC.ascx");
   StringWriter sw = new StringWriter();
   page.Controls.Add(control);
   Server.Execute(page, sw, false);
   Response.Write(sw.ToString());
   Response.Flush();
   Response.Close();
} 
```

没有其他东西执行，页面的生命周期有一个真正的 Kevorkian 时刻；-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T22:11:05.230

我不确定，但也许[Scott Guthrie 的这个教程](http://weblogs.asp.net/scottgu/archive/2006/10/22/Tip_2F00_Trick_3A00_-Cool-UI-Templating-Technique-to-use-with-ASP.NET-AJAX-for-non_2D00_UpdatePanel-scenarios.aspx)可能有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-29T23:26:12.867

必须使用它才能使属性正常工作！

```
 var page = new Page();
        var sw = new StringWriter();
        var control = (UserControl)page.LoadControl("~/.../someUC.ascx");

        var type = control.GetType();
        type.GetProperty("Prop1").SetValue(control, value, null);
        page.Controls.Add(control);

        context.Server.Execute(page, sw, false);
        context.Response.ContentType = "text/html";
        context.Response.Write(sw.ToString());
        context.Response.Flush();
        context.Response.Close(); 
```

# c - 什么会导致 InternetQueryOption 出现 ERROR_INTERNET_INCORRECT_HANDLE_TYPE (12018)？

> ID：279326
> 
> 赞同：3
> 
> 时间：2008-11-10T22:00:14.877
> 
> 标签：c, wininet

我正在开发一个简单的小功能，使用 WinInet 功能从启用 SSL 的网站下载文件，即 InternetOpen 和 InternetOpenURL。我最初使用 `ERROR_INTERNET_INVALID_CA`(12045) 调用 InternetOpenURL 失败，因为我在测试服务器上使用自签名证书，并发现 ( [http://support.microsoft.com/kb/q182888/](http://support.microsoft.com/kb/q182888/) ) 修复似乎是使用 InternetQueryOption/InternetSetOption 组合将各种标志传递给`INTERNET_OPTION_SECURITY_FLAGS`选项。然而，现在 InternetQueryOption 失败，`ERROR_INTERNET_INCORRECT_HANDLE`GetLastError() 发出 (12018) 响应。任何想法为什么会这样？我正在使用直接来自 InternetOpen 的句柄，该句柄以前与非 SSL InternetOpenURL 一起工作得很好。这不应该是正确的句柄吗？

我没有实际代码（不同的计算机），但它与以下非常相似，并且在 InternetGetOption 上失败`ERROR_INTERNET_INCORRECT_HANDLE`：

```
 HINTERNET hReq = InternetOpen(...)
  if (!hReq) { printf("InternetOpen Error: %d", GetLastError()); }

  DWORD dwFlags = 0;
  DWORD dwBuffLen = sizeof(dwFlags);
  BOOL ret = false;

  ret = InternetQueryOption(hReq, INTERNET_OPTION_SECURITY_FLAGS,
                            (LPVOID)&dwFlags, &dwBuffLen);
  if (!ret) { printf("InternetQueryOption Error: %d", GetLastError()); }

  dwFlags |= SECURITY_FLAG_IGNORE_UNKNOWN_CA;
  ret = InternetSetOption(hReq, INTERNET_OPTION_SECURITY_FLAGS,
                          &dwFlags, sizeof (dwFlags) );
  if (!ret) { printf("InternetSetOption Error: %d", GetLastError()); }

  InternetOpenURL(hReq, ...) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T10:55:57.787

我曾经收到类似的错误。然后我将 HttpOpenRequest(...) 返回的句柄传递给 InternetQueryOption，它工作得很好。试试看。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T11:25:40.270

来自 INTERNET_OPTION_SECURITY_FLAGS 的 MSDN 文档：

> 请注意，以这种方式检索的数据与已发生的事务相关，其安全级别无法再更改。

您的句柄上尚未发生任何交易。InternetOpen 为您提供根 HINTERNET 句柄。这可能适用于 HTTP、FTP 或 Gopher 连接——而安全选项相当特定于 HTTPS，并且很大程度上还取决于远程服务器支持的内容。因此，您正在向 Wininet 询问它无法提供给您的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T22:35:34.150

我看到你没有检查`hReq`你从`InternetOpen`. 也许这就是你问题的根源。如果您在调用后立即添加它，看看这会告诉您什么`InternetOpen`：

```
if (hReq == NULL) {
    printf("InternetOpen Error: %d", GetLastError());
} 
```

# command-line - 如何从命令行更改日期格式？

> ID：279329
> 
> 赞同：4
> 
> 时间：2008-11-10T22:01:27.887
> 
> 标签：command-line, date, format

说，将日期转换为一种格式的最快方法是什么

> 2008-06-01

到另一种格式的日期，比如说

> 2008 年 6 月 1 日星期日

重要的一点实际上是“太阳”，因为根据日期名称，我可能需要摆弄其他东西——以一种不确定的方式。我正在运行 GNU bash，版本`3.2.17(1)-release (i386-apple-darwin9.0)`.

[背景：我想从命令行执行它的原因是我真正想要的是将其写入TextMate命令......这是我必须在textMate中一直做的一项烦人的任务。]

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T22:09:25.763

```
$ date -d '2005-06-30' +'%a %F'
Thu 2005-06-30 
```

有关`man date`其他格式选项，请参阅。

此选项在 Linux 上可用，但在 Darwin 上不可用。在 Darwin 中，您可以改用以下语法：

```
date -j -f "%Y-%m-%d" 2006-06-30 +"%a %F" 
```

-f 参数指定输入格式，+ 参数指定输出格式。

正如下面另一张海报所指出的，您最好使用 %u （星期几）而不是 %a 来避免本地化问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T22:24:57.963

阅读*date(1)*手册页会发现：

```
-j   不要尝试设置日期。这允许您使用 -f 标志
     除了*将一种日期格式转换为另一种日期格式*的 + 选项。
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T22:36:00.470

谢谢那个sgm。因此，我可以回来参考它-

```
date -j -f "%Y-%m-%d" "2008-01-03" +"%a%e %b %Y"
            ^               ^        ^
            parse using     |        output using
            this format     |        this format
                            |
                       date expressed in
                       parsing format

Thu 3 Jan 2008 
```

谢谢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T22:04:30.860

```
date -d yyyy-mm-dd 
```

如果你想更多地控制格式，你也可以像这样添加它：

```
date -d yyyy-mm-dd +%a 
```

只是得到你说你想要的太阳部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T22:13:03.447

```
date -d ... 
```

似乎没有削减它，因为我收到一个使用错误：

```
usage: date [-jnu] [-d dst] [-r seconds] [-t west] [-v[+|-]val[ymwdHMS]] ... 
            [-f fmt date | [[[mm]dd]HH]MM[[cc]yy][.ss]] [+format] 
```

我正在运行 GNU bash，版本 3.2.17(1)-release (i386-apple-darwin9.0)，据此人所知， date -d 仅适用于

```
-d dst  Set the kernel's value for daylight saving time.  If dst is non-
         zero, future calls to gettimeofday(2) will return a non-zero for
         tz_dsttime. 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T22:47:23.567

如果您只是想获得星期几，请不要尝试匹配字符串。当语言环境更改时，它会中断。`%u`格式为您提供日期编号：

```
 $ date -j -f "%Y-%m-%d" "2008-01-03" +"%u"
 4 
```

事实上，那是一个星期四。您可以使用该数字来索引程序中的数组，或者仅使用该数字本身。

有关详细信息，请参阅日期和 strftime 手册页。但是，OS X 上的日期手册页是错误的，因为它没有列出这些有效的选项。

# drupal - CCK 可以为 drupal 中以编程方式定义的节点类型处理我的字段吗？

> ID：279330
> 
> 赞同：1
> 
> 时间：2008-11-10T22:02:04.640
> 
> 标签：drupal, drupal-6, cck

CCK api 是否允许我从自定义模块创建一个节点类型，其中包含一堆使用 CCK 来存储其状态的字段？如果是这样，是否可以锁定这些字段，以便用户不能更改它们，但仍允许用户向节点类型添加更多字段？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T00:23:08.380

我*认为*您的第一个问题的答案是“是”（至少对于 Drupal 6，它已将 CCK 的元素集成到 Drupal Core 中）。我相信[亚马逊模块](http://drupal.org/project/amazon "亚马逊模块")会做这种事情，尽管它只有一个字段。

不过，我认为您的第二个请求中的想法是无法实现的。这似乎需要字段级权限控制，而 Drupal 仅支持模块级权限控制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-12T01:19:43.793

您可以在 GUI 中添加验证代码，以限制 CCK 字段在您的内容类型上受到干扰。不过，这不会阻止另一个模块用斧头进入那里。

您可以添加检查，以在检测到一些不需要的更改时恢复您首选的 CCK 设置。

# sql - SQL备忘单？

> ID：279333
> 
> 赞同：16
> 
> 时间：2008-11-10T22:02:51.300
> 
> 标签：sql

只是想知道是否有人在创建新查询时有任何他们最喜欢的 SQL 引用可供使用。可能是显示语法或可用功能的东西？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-10T22:11:02.610

如果您正在寻找具有非常基本功能的产品，您可以尝试一下，看看它是否符合您的需要。

[http://www.sql.su/](http://www.sql.su/)

您可能需要将您想要的部分粘贴到更好的打印格式中，因为页面顶部有谷歌广告 =(

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T22:10:14.890

[http://blog.sqlauthority.com/2008/10/02/sql-server-2008-cheat-sheet-one-page-pdf-download/](http://blog.sqlauthority.com/2008/10/02/sql-server-2008-cheat-sheet-one-page-pdf-download/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T22:11:27.197

我是[O'Reilly SQL 袖珍指南](http://shop.oreilly.com/product/0636920013471.do)的粉丝。它涵盖了大多数主要的数据库系统类型，并解释了某些特定系统独有的一些功能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-05-13T18:42:23.360

我发现这是一个方便的小参考表，用于*基本*语法和函数/语句：[SQL Cheat Sheet](http://www.zentut.com/wp-content/uploads/2012/10/sqlcheatsheet.jpg)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T22:20:34.073

还可以快速浏览 O'Reilly SQL 袖珍指南。涵盖 Oracle、DB2、SQL Server 和 MySQL。有关更详细的问题，请参阅 Date/Darwen：SQL 标准指南，MySQL 参考手册 ( [http://dev.mysql.com/doc/refman/5.0/en/](http://dev.mysql.com/doc/refman/5.0/en/) )。或者只是谷歌。

# wpf - 如何在 WPF 中向 Treeview 添加图标？

> ID：279335
> 
> 赞同：0
> 
> 时间：2008-11-10T22:03:43.607
> 
> 标签：wpf, xaml, treeview

我想在我的树视图中添加一些图标。有没有办法在 XAML 中做到这一点？

```
 <TreeView Height="200" Name="treeView1" Width="120">
        <TreeViewItem Header="Topic1" IsExpanded="True">
            <TreeViewItem Header="Subtopic2" />
            <TreeViewItem Header="Subtopic3" />
        </TreeViewItem>
    </TreeView> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T22:09:54.110

好吧，我的错。在通过类似标签发布后在[这里](https://stackoverflow.com/questions/250597/how-do-i-add-icons-next-to-the-nodes-in-a-wpf-treeview)发现了同样的问题。

# namespaces - 如何在 Windows 资源管理器中托管根命名空间扩展

> ID：279336
> 
> 赞同：1
> 
> 时间：2008-11-10T22:03:45.777
> 
> 标签：namespaces, windows-explorer

有一种方法可以创建以特定文件夹为根的命名空间扩展。

它涉及创建名称如下的文件夹：

```
My Custom NSE.{785EE551-DEE1-4F57-A8C9-0EF76F346A29} 
```

Windows 资源管理器将自动在该位置托管该 clsid 的 NSE。

但是对于我的生活，我再也找不到语法了。它曾经在 MSDN 上的命名空间扩展文档中，它列出了将命名空间放入 Windows 资源管理器的 3 种方法——这是其中之一。

语法是什么 - 它让我发疯！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T18:41:23.833

我找到了。有 3 种方法可以让您的命名空间扩展进入“我的电脑”

[指定命名空间扩展的位置](http://msdn.microsoft.com/en-us/library/cc144096(VS.85).aspx)

a) 向注册表添加条目

```
\Software
   \Microsoft
      \Windows
         \CurrentVersion
            \Explorer
               \(Virtual Folder Name)
                  \Namespace
                     \{785EE551-DEE1-4F57-A8C9-0EF76F346A29} 
```

其中“*虚拟文件夹名称*”可以是其中之一

*   我的电脑
*   桌面
*   控制面板
*   网络邻居
*   网络邻居\整个网络
*   远程计算机

b) 创建一个文件夹，命名为

```
My Custom NSE.{785EE551-DEE1-4F57-A8C9-0EF76F346A29} 
```

c) 创建一个只读系统文件夹，创建一个 desktop.ini 文件，并在其中添加：

```
[.ShellClassInfo]
CLSID={785EE551-DEE1-4F57-A8C9-0EF76F346A29} 
```

* * *

您还可以在资源管理器的单独副本中托管 shell 命名空间扩展：

```
%SystemRoot%\Explorer.exe /e,::{785EE551-DEE1-4F57-A8C9-0EF76F346A29} 
```

# sql-server - 从 SqlDataAdapter 后台填充 DataGridView

> ID：279349
> 
> 赞同：3
> 
> 时间：2008-11-10T22:08:37.030
> 
> 标签：sql-server, datagridview, background, backgroundworker

我有一个大型数据集（超过 100,000 条记录），我希望将其加载到 DataGridView 中。执行此操作的存储过程可能需要 10 秒或更长时间才能完成。

到目前为止，我有一个 BackgroundWorker 可以防止 UI 锁定，并实现了一个基本的“请稍候”对话框。

我想做的是以某种方式在 DataGridView 中填充结果，因为它们以某种方式从数据库返回。描述它的最佳方式是 SQL Server Management Studio 是如何做到的——当查询运行时，即使查询仍在执行，行也会立即返回。还有一个按钮可以停止查询并保留已返回的行。

我怎样才能在我自己的代码中做到这一点？

DataGridView 仅用于显示数据行，然后用户单击其中一个执行其他操作。没有任何东西被写回数据库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T22:27:09.427

似乎最好的选择是使用某种分页机制，因此您一次只向用户显示一定数量的数据。这将加快提取数据和加载页面的速度。您可以使用 GridView 的内置分页（我建议在这种方法中使用 .NET 缓存，因为它每次都会提取整个数据集，即使它只显示一页记录）。您还可以使用 LINQ to SQL 实现分页，一次只能抓取一个页面。下面是我最近发现的一篇好文章的链接，它解释了如何做到这一点。

[http://www.dbtutorials.com/display/linq-to-sql-paging-cs.aspx](http://www.dbtutorials.com/display/linq-to-sql-paging-cs.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T03:09:50.417

数据网格视图中有 100,000 行？拒绝吧”！

1.  用户一次看不到 100,000 行
2.  传输 100,000 行的网络流量并非微不足道
3.  100,000 个 datagridview 行的内存开销并非微不足道
4.  用户只需要选择一行并继续
5.  如果这个应用程序一次被多个用户使用，DBA 会追捕你

听从奥斯汀的建议，一次只显示一页

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T07:17:46.547

正如其他人所建议的那样，在网格中显示 100K 记录听起来是个坏主意，但如果你真的必须......

您的 backgroundworker 线程走在正确的轨道上，但您必须使用数据读取器并在返回行时按顺序读取它们。然后，您的后台工作线程需要为从数据读取器读取的每一行编组一个网格行添加到 UI 线程。

请注意，使用单独的线程来保持 UI 响应的任何好处都将被否定，因为无论如何它都会忙于不断地添加行。我建议您实现某种批处理方法，并让 UI 每秒左右添加一次新行。您需要在这里非常小心，并牢记可能的竞争条件。可能会出现一种情况，您的后台工作人员正在将数据读取器中的行添加到某种集合中，而您的 UI 可能希望同时读取该集合 - 这几乎肯定会导致问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T22:14:51.697

我怀疑您是否可以像 Management Studio 一样在 DataGridView 中执行此操作。我想说的是，当存储过程调用完成时，您会立即获得应用程序中的所有行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T23:04:05.997

您也可以研究一些后端调整。在这种情况下添加索引已经帮助了我们很多次。尝试在启用“执行计划”选项的情况下从 SQL Server Management Studio 运行存储过程。寻找存储过程可能陷入困境的地方（即高执行百分比）。当您将鼠标悬停在项目上时，您将看到执行详细信息列表。在列表的底部，查看是否正在比较任何字段。这些对于索引候选人来说是无用的赠品。

# c++ - OpenSceneGraph 应用程序中的无效锁定序列错误

> ID：279358
> 
> 赞同：0
> 
> 时间：2008-11-10T22:10:24.357
> 
> 标签：c++, opengl, openscenegraph

我有一个针对 OpenSceneGraph (2.6.1) 构建的应用程序，因此间接针对 OpenGL。应用程序初始化并开始运行，但随后在 OpenGL32.dll 中出现以下异常“尝试执行无效的锁定序列”。当我重新运行它时，有时会收到此异常，有时还会收到有关“特权指令”的异常。调用堆栈看起来已损坏，因此我无法准确判断异常是从哪里引发的。几天前我运行了该应用程序，但从未见过这种行为。从那时起，我在几个 if 中添加了 else 子句，仅此而已。我的应用程序是一个控制台应用程序，使用 Visual Studio 2008 构建，并将 OpenScenGraph 设置为 SingleThreaded 模式。有人见过这个吗？有什么调试技巧吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T22:44:41.277

你能用其中一个标准例子重现它吗？
你能创建一个导致这种情况的最小应用程序吗？
您是否有一台带有不同品牌视频卡的机器，您可以在上面测试它（例如 Nvidia 与 ATI），openscenegraph 和坏的 OpenGL 驱动程序存在一些问题。

您是否尝试过发布到 osg-users@lists.openscenegraph.org

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-24T21:22:28.233

问题原来是我们的应用程序选择了不正确的 OpenGL DLL 版本，而不是安装在 System32 中的那个。

# c# - 数组中出现频率最高的数字

> ID：279359
> 
> 赞同：11
> 
> 时间：2008-11-10T22:10:38.990
> 
> 标签：c#, algorithm

我有这个数组我写了一个函数MostFreq，它接受一个整数数组并返回2个值：数组中更频繁的数字及其频率检查这个代码我写了什么你怎么看？有更好的方法吗？

```
static void Main()
{ 
    int [] M={4,5,6,4,4,3,5,3};
    int x;
    int f=MyMath.MostFreq(M,out x );
    console.WriteLine("the most Frequent Item = {0} with frequency = {1}",x,f);
} 
```

=====

在类 Mymath

```
public static int MostFreq(int[] _M, out int x)
{
    //First I need to sort the array in ascending order
    int Max_Freq, No_Freq, i, k;
    Array.Sort(_M);                         
    k = _M[0];
    Max_Freq = 0; i = 0; x = 0;
    while (i < _M.Length)
    {
        //No_Freq= the frequency of the current number
        No_Freq = 0;
        //X here is the number which is appear in the array Frequently 
        while (k == _M[i])
        {
            No_Freq++;
            i++;
            if (i == _M.Length) 
                break;
        }
        if (No_Freq > Max_Freq)
        {
            //so it will be printed the same
            Max_Freq = No_Freq;
            x = k;
        }
        if (i < _M.Length) k = _M[i];
    }
    return (Max_Freq);
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-10T22:25:24.220

LINQ 起来。我知道这是在 VB 中，但您应该能够将其转换为 C#：

```
Dim i = From Numbers In ints _
            Group Numbers By Numbers Into Group _
            Aggregate feq In Group Into Count() _
            Select New With {.Number = Numbers, .Count = Count} 
```

编辑：现在也在 C# 中：

```
var i = from numbers in M
                group numbers by numbers into grouped
                select new { Number = grouped.Key, Freq = grouped.Count()}; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-10T22:32:00.820

假设你不能使用 LINQ，我可能会这样处理算法：

*   创建键/值字典
*   迭代您的数组，为每个唯一元素添加一个字典键，每次重复该元素时递增该值。
*   遍历字典键，并返回具有最高值的元素。

这不是一个很好的解决方案，但它很简单， ContainsKey 是一个 O(1) 查找，因此您最多将迭代您的数组两次。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T22:26:58.443

从软件工程的角度来看，我希望一个名为 MostFreq 的函数返回频率最高的元素，而不是频率本身。我会切换你的输出并返回值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T22:46:16.750

您可以通过迭代整个数组一次来消除一开始所做的排序，记录您在临时数组中遇到每个值的次数，然后迭代临时数组以获得最高数字。您也可以始终保留最高频率计数和最频繁的项目。

当然，不同类型对不同类型的数据有不同的效率，但这将是仅两次迭代的最坏情况。

*编辑：为重复道歉......'当我开始时不在那里:)*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-03-04T03:54:26.030

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MostFrequentElement
{
    class Program
    {
        static void Main(string[] args)
        {
            int[] array = new int[] { 4, 1, 1, 4, 2, 3, 4, 4, 1, 2, 4, 9, 3, 1, 1, 7, 7, 7, 7, 7 };
            Array.Sort(array, (a, b) => a.CompareTo(b));
            int counter = 1;
            int temp=0 ;

            List<int> LOCE = new List<int>();
            foreach (int i in array)
            {
                counter = 1;
                foreach (int j in array)

{
                    if (array[j] == array[i])
                    {
                        counter++;
                    }
                    else {
                    counter=1;
                    }
                    if (counter == temp)
                    {
                        LOCE.Add(array[i]);
                    }
                    if (counter > temp)
                    {
                        LOCE.Clear();
                        LOCE.Add(array[i]);
                        temp = counter;

                    }
                }

            }
            foreach (var element in LOCE)
            {
                Console.Write(element + ",");
            }
            Console.WriteLine();
            Console.WriteLine("(" + temp + " times)");
            Console.Read();
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-05-10T08:30:38.683

这是一个示例，您如何在没有 LINQ 且没有字典和列表的情况下做到这一点，只需两个简单的嵌套循环：

```
public class MostFrequentNumber
{
    public static void Main()
    {
        int[] numbers = Console.ReadLine().Split(' ').Select(int.Parse).ToArray();

        int counter = 0;
        int longestOccurance = 0;
        int mostFrequentNumber = 0;

        for (int i = 0; i < numbers.Length; i++)
        {
            counter = 0;

            for (int j = 0; j < numbers.Length; j++)
            {
                if (numbers[j] == numbers[i])
                {
                    counter++;
                }
            }

            if (counter > longestOccurance)
            {
                longestOccurance = counter;
                mostFrequentNumber = numbers[i];
            }
        }

        Console.WriteLine(mostFrequentNumber);
        //Console.WriteLine($"occured {longestOccurance} times");
    }
} 
```

您可以获得最频繁出现的数字的值，并且（评论）您还可以获得出现次数。我知道我有一个“使用 Linq；”，这只是将初始输入字符串转换为一个 int 数组并节省几行和一个解析循环。即使没有它，算法也很好，如果你以“长”的方式填充数组......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-05-29T13:45:23.747

1遍完成....

```
public class PopularNumber
    {
        private Int32[] numbers = {5, 4, 3, 32, 6, 6, 3, 3, 2, 2, 31, 1, 32, 4, 3, 4, 5, 6};

        public PopularNumber()
        {
            Dictionary<Int32,Int32> bucket = new Dictionary<Int32,Int32>();
            Int32 maxInt = Int32.MinValue;
            Int32 maxCount = 0;
            Int32 count;

            foreach (var i in numbers)
            {
                if (bucket.TryGetValue(i, out count))
                {
                    count++;
                    bucket[i] = count;
                }
                else
                {
                    count = 1;
                    bucket.Add(i,count);
                }

                if (count >= maxCount)
                {
                    maxInt = i;
                    maxCount = count;
                }

            }

            Console.WriteLine("{0},{1}",maxCount, maxInt);

        }
    } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-07-05T14:01:00.890

让我们假设数组如下：

```
int arr[] = {10, 20, 10, 20, 30, 20, 20,40,40,50,15,15,15};

int max = 0;
int result = 0;
Map<Integer,Integer> map = new HashMap<>();

for (int i = 0; i < arr.length; i++) {
    if (map.containsKey(arr[i])) 
        map.put(arr[i], map.get(arr[i]) + 1);
    else
        map.put(arr[i], 1);
    int key = map.keySet().iterator().next();
    if (map.get(key) > max) {
        max = map.get(key) ;
        result = key;
    }
}
System.out.println(result); 
```

解释：

在上面的代码中，我使用 HashMap 将元素存储在键中，并将元素的重复存储为值。我们已经初始化了变量 max = 0 （ max 是重复元素的最大计数）在迭代元素时，我们还获得了键的最大计数。

结果变量返回重复次数最多的键。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-20T16:39:02.113

```
int[] arr = { 4, 5, 6, 4, 4, 3, 5, 3 };
var gr = arr.GroupBy(x => x).OrderBy(x => x.Count()).Last();
Console.WriteLine($"The most Frequent Item = {gr.Key} with frequency = {gr.Count()}"); // The most Frequent Item = 4 with frequency = 3 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2012-07-14T10:45:43.263

```
int count = 1;
int currentIndex = 0;
for (int i = 1; i < A.Length; i++)
{
    if (A[i] == A[currentIndex])
        count++;
    else
        count--;
    if (count == 0)
    {
        currentIndex = i;
        count = 1;
    }
}

int mostFreq = A[currentIndex]; 
```

# .net-2.0 - 为什么 Log4Net 在我的 Windows 服务中运行如此缓慢？

> ID：279360
> 
> 赞同：3
> 
> 时间：2008-11-10T22:10:41.503
> 
> 标签：.net-2.0, service, log4net, c#-2.0, performance

我有一个使用 log4net 的 Windows 服务。我们注意到有问题的服务运行缓慢，因此我们在其上附加了一个调试器并单步执行。似乎每次它尝试通过 log4net 将条目写入日志时，都需要 10 到 30 秒才能执行下一行代码。显然这加起来...

该服务是 2.0 .net 我们使用的是 log4Net 1.2.0.30714。我们已经在运行 vista 的机器和运行 win sever 2003 的机器上对此进行了测试，并看到了相同或相似的结果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T22:05:29.057

事实证明，有人在配置文件中添加了一个 SMPTAppender，它覆盖了我们应用程序中的那个。结果，错误的 SMPT 服务器地址无法访问。log4net 试图为每个请求记录错误一分钟，然后放弃并继续下一行代码。更正 smtp 地址可解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T22:15:49.370

[Jeff 在Podcast 20](https://blog.stackoverflow.com/2008/09/podcast-20/)中提到了 Log4Net 的性能问题。您可能会看到类似的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T23:06:16.897

检查您的配置文件中的 Log4Net 设置。Log4Net 可以配置为登录到远程机器，如果连接速度很慢，那么您的记录速度也会变慢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T15:52:18.753

好吧，我不是在远程处理...这是写入正在运行的机器上的日志文件。这是我的附加程序设置：

```
<appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender,log4net">
      <file value="D:\\ROPLogFiles\\FileProcessor.txt" />
      <appendToFile value="true" />
      <datePattern value="yyyyMMdd" />
      <rollingStyle value="Date" />
      <layout type="log4net.Layout.PatternLayout,log4net">
        <param name="ConversionPattern" value="%d [%t] %-5p %c [%x] - %m%n" />
      </layout>
      <threshold value="INFO" />
    </appender> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T22:16:10.510

我有带有 adonet appender 的 log4net，并且没有看到我的 Windows 服务的任何性能下降。你用的是什么附加程序？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T16:31:31.670

默认的最大文件大小为 10mb 。如果您的文件大约是这个大小并且您的文件系统非常完整并且可能非常分散，那么问题可能就在那里。你的日志文件有多大？我在千兆字节大小的日志文件中遇到了类似的问题。

# visual-studio - 在 Visual Studio 中自定义可停靠窗口

> ID：279366
> 
> 赞同：0
> 
> 时间：2008-11-10T22:12:38.253
> 
> 标签：visual-studio

在具有双显示器的系统上进行开发时，我喜欢通过在两个显示器上拉伸 Visual Studio 来充分利用额外的空间。能够同时查看输出、断点、错误列表、对象浏览器和 ReSharper 窗口真是太棒了，而不必将它们缩小并将它们停靠在主窗口中，这样可以减少代码空间。

我将主 VS 窗口放在带有选项卡式文档和解决方案资源管理器窗口的监视器上。我想显示的任何其他窗口都放在第二台显示器上并停靠在一起。我使用这种方法遇到的唯一问题是带有 VS 菜单栏的主选项卡式文档窗口是唯一可以最大化的窗口。解决方案资源管理器、断点和错误列表等附加窗口只能拉伸、停靠或关闭。我经常经历选择和布置辅助窗口的繁琐工作，只是在我关闭 VS 时才删除该布局。

有谁知道一个 VS 插件，它为您提供了一个 (1) 可最大化的窗口，并且 (2) 其他窗口可以停靠（ReSharper 仅做 2）？除此之外，有没有人知道学习如何开发 VS 插件的好资源？如有必要，我很乐意自己这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T22:19:54.743

我不知道您的任何建议，尽管我也希望在 VS 中看到更好的多显示器支持。不过，我所做的是保存了各种窗口布局（工具 > 导入和导出设置，并仅检查窗口布局），以便我可以在需要时轻松切换。

# c# - 如何使用 .Net 反射按名称搜索属性，忽略大小写？

> ID：279374
> 
> 赞同：6
> 
> 时间：2008-11-10T22:15:57.250
> 
> 标签：c#, .net, reflection

我有以下代码行片段，它按名称搜索实例的属性：

```
var prop = Backend.GetType().GetProperty(fieldName); 
```

现在我想忽略fieldName的大小写，所以我尝试了以下方法：

```
var prop = Backend.GetType().GetProperty(fieldName, BindingFlags.IgnoreCase); 
```

... 没有骰子。现在 prop 不会找到具有确切大小写的字段名称。

因此.....我如何使用.Net反射来按名称搜索属性而忽略大小写？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-10T22:25:43.873

您还需要指定`BindingFlags.Public | BindingFlags.Instance`：

```
using System;
using System.Reflection;

public class Test
{
    private int foo;

    public int Foo { get { return foo; } }

    static void Main()
    {
        var prop = typeof(Test).GetProperty("foo",
                                            BindingFlags.Public
                                            | BindingFlags.Instance 
                                            | BindingFlags.IgnoreCase);
        Console.WriteLine(prop);
    }
} 
```

（当您不指定任何标志时，默认提供公共、实例和静态。如果您明确指定它，我建议您只指定实例或静态之一，如果您知道您需要什么。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T22:28:19.767

尝试像这样添加范围 BindingFlags：

```
var prop = Backend.GetType().GetProperty(fieldName, BindingFlags.Instance | BindingFlags.Public | BindingFlags.IgnoreCase); 
```

这对我有用。

# c# - 代码片段存储库

> ID：279379
> 
> 赞同：3
> 
> 时间：2008-11-10T22:18:26.090
> 
> 标签：c#, visual-studio-express, code-snippets

我刚刚开始使用 C#，并且经常发现自己回到其他项目并在新项目中重用一些代码片段。

有没有一个很好的工具可以存储他们一次又一次地重复使用的所有小代码片段并与 Visual Studio Express 集成？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T22:22:55.067

Visual Studio 有代码片段的概念，在工具菜单下有一个代码片段管理器。

差点忘了，要在代码中调出代码截图菜单，请按 CRTL+K+S。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T03:59:01.533

[Visual Studio Express 在法律上是不可扩展](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio_Express#Extensibility)的，所以我怀疑是否有可以购买或下载的工具可以集成。但是，[snippy](http://www.codeplex.com/snippy)将帮助您管理和创建标准的 .snippet 文件，无需集成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T03:59:09.350

听起来您可能想开发自己的小框架，可以被各种项目引用。

# iphone - UIWebView - 如何获取访问的链接以显示为已访问？

> ID：279384
> 
> 赞同：2
> 
> 时间：2008-11-10T22:20:48.517
> 
> 标签：iphone, cocoa-touch

我的 iPhone 应用程序中有一个 UIWebView，它可以愉快地显示 Web 内容，但它不会呈现访问过的链接与未访问过的链接有任何不同。通常我希望它为访问的链接使用不同的颜色，但可惜没有。

另一方面，Safari 会正确处理其链接。我假设 UIWebView 缺少关于它访问过哪些 URL 的信息存储。期望委托人提供这些信息是合理的，但委托人或我能看到的任何其他地方都没有这样的 API。

那么，如何让 UIWebView 显示访问过的链接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T22:11:10.020

我得出的结论是，获得此功能的唯一方法是伪造它。

我通过向所有页面添加一个 JavaScript 函数以将“已访问”类应用于目标位于我从 Objective-C 传入的列表中的所有链接（使用 UIWebView 的 stringByEvaluatingJavaScriptFromString: 方法）成功地完成了这项工作。然后我只需要在 Objective-C 世界中维护该列表，并始终在 Web 视图委托的 webViewDidFinishLoad: 方法中触发该 JS 函数。最难的是 JavaScript。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T01:52:50.603

除了通过调用 stringByEvaluatingJavaScriptFromString 更改 javascript 中的 CSS 属性：官方 SDK 中可能不支持这样做的方法。与桌面上的 WebView 相比，UIWebView 非常有限。

# asp.net - 如何选择网页是否应为网页用户控件？

> ID：279388
> 
> 赞同：2
> 
> 时间：2008-11-10T22:22:46.127
> 
> 标签：asp.net, user-controls

我们团队中的一些人认为应用程序中的每个网页都应该是 Web 用户控件。因此，例如，您将在 Customer.ascx 中处理所有 html + 事件，并且将有一个包含 Customer.ascx 控件的相应 Customer.aspx 页面。

这些是他们的论点：

1.  这种做法促进了多功能性、可移植性和可重用性。
2.  即使该页面现在没有被重新使用，它也可能在将来被重新使用。
3.  客户页面将来可能需要移动到不同的位置或重新命名，并且移动用户控件更容易。
4.  这是 MS 对新开发的建议。

这真的是对新开发的建议吗？这种策略有什么缺点吗？我同意如果需要的话，手头有一个用户控件很好，但是对整个应用程序这样做似乎有点过头了，“以防我们以后需要它”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T01:23:41.333

1、2 和 3：因为“你以后可能需要它”而做*任何事情是一种可怕的策略。*

[http://c2.com/xp/YouArentGonnaNeedIt.html](http://c2.com/xp/YouArentGonnaNeedIt.html)

4：我从未读过这篇文章，并且严重怀疑 MS 曾经说过这样的话。可能是某个拥有 MS 标签或 MVP 或其他人的随机文章，而一个容易上当的初级开发人员将其视为福音真理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T02:45:36.003

我曾经在 .NET 1.1 中遇到过这样编写的应用程序。一定有人听说过同样被误导的“最佳实践”，并将其视为绝对真理。

我同意它增加了大部分不需要的复杂性。我通常发现用户控件对于在多个页面上重复的页面部分更有用。如果您认为您会重复使用整个页面...为什么不直接使用原始页面？

我也不明白移动/重命名的论点。重命名/移动页面并不难。如果您按照同事的建议进行操作，您最终会得到一个只包含一个 orders.ascx 文件的 customers.aspx 页面吗？与仅重命名/移动文件相比，我看到这种方法更多潜在的混淆/错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T22:43:52.013

1.  严重地使客户端脚本复杂化，因为 NamingContainer jiggery 有时会将 _ctl0 等添加到所有内容中。
2.  我认为MS从未推荐过它。请求 MSDN 文档的链接。
3.  通常，当您完成实现某些东西并且它已经足够复杂时，当您尝试“重用”它时，您会发现很多“陷阱”。一个很好的例子是用户控件中的相对链接不再在其路径之外工作**。**
4.  用户不需要在每个页面上添加/编辑/删除客户的能力。事实上，如果您在每个页面上都有这些类型的控件，您就会开始陷入缓存问题。例如，如果在发票页面上添加了客户，发票控件是否会更新为新客户？各种控件间的可操作性问题都会表现出来。这些问题都很难争辩，因为当然，每个人的用户控制都是*完美*的，所以这永远不会发生。哈哈对。
5.  看看他们是否能想出一个例子，移动/重命名用户控件实际上节省了时间，而不是让它变得更复杂。绘制一个实际示例并展示每个示例的优缺点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T22:49:24.373

我个人不是粉丝，我认为它给应用程序增加了一层复杂性，这在早期阶段并不是绝对必要的。如果您需要重用一个您以前认为不会重用的组件，那么此时将其重构为用户控件应该不会很困难。

# javascript - 如何在不需要以特定顺序包含文件的情况下利用原型继承？

> ID：279391
> 
> 赞同：2
> 
> 时间：2008-11-10T22:24:51.350
> 
> 标签：javascript, prototypal-inheritance

在开发 JavaScript 时，我倾向于将 JavaScript 代码分离到不同的文件中，然后运行脚本来连接文件并压缩或打包生成的文件。最后，我有一个文件需要包含在我的生产站点中。

这种方法通常有效，但我开始遇到原型继承问题。具体来说，如果一个类继承自另一个类，则需要已经包含父类的文件才能使继承工作。如果我使用的连接脚本只是连接一个充满文件的目录，则子类可能出现在父类之前的代码中。像这样：

*parent_class.js*

```
var Namespace = Namespace || {};    

Namespace.Parent = function () { };
Namespace.Parent.prototype.doStuff = function () { ... }; 
```

*child_class.js*

```
var NameSpace = Namespace || {};

Namespace.Child = function () { ... };
Namespace.Child.prototype = new Namespace.Parent(); 
```

唯一可行的方法是在 child_class.js 之前包含 parent_class.js，如果连接脚本将子代码放在父代码之前，则可能不会发生这种情况。

有没有办法编写此代码以使功能相同，但编写代码的顺序不再重要？

编辑：我忘记了我也在使用命名空间，所以我也将它添加到代码中，这可能会改变一些事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-04-05T01:27:14.800

当我处理大型应用程序时，我使用[requireJS](http://requirejs.org)将我的代码划分为模块，并确保以正确的顺序加载这些模块。然后我只是将我的派生类标记为依赖于父类。

RequireJS 附带了一个工具，可以组合和缩小所有模块以进行生产部署。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T22:52:07.737

> 如果我使用的连接脚本只是连接一个充满文件的目录，则子类可能出现在父类之前的代码中。

为每个文件名添加排序顺序值并在执行操作之前按名称排序是不是太简单了？

例如：

```
01_parent.js
02_child.js 
```

否则，可能会在单独的文件中维护预先排序的文件列表。甚至可能更进一步，并在 xml 中提供分层依赖结构来解析？这可能有点过度设计解决方案:-D

如果您无法确定 javascript 文件的编写方式，则可以选择一些解决问题的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T23:00:07.767

我想你可以做一些像这样非常骇人听闻的事情：

```
setTimeout(function() { 
  if(typeof(Parent) != "undefined" && typeof(Child) != "undefined") { 
    Child.prototype = new Parent(); 
  } else {
    setTimeout(arguments.callee, 50);
  }
}, 50); 
```

该代码也可以在任何地方，并且会持续运行直到加载`Parent`和`Child`加载......但我不会那样做。

就个人而言，我只是确保您的文件以正确的顺序组合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T23:18:16.047

如果对象是“命名空间的”，那么您要么必须切换到包含按顺序连接的构建解决方案，要么使用类似[dojo.require](http://dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/modules-and-namespaces/what-does-dojo-require-)的东西（但显然不是特定于 dojo 的）。基本上，您需要一个框架，它可以让您检查给定标识符是否可用，如果不可用，则暂停执行并包含它（通过评估的 ajax 或插入的脚本标签）。

# nhibernate - 如何使用 Castle ActiveRecord 预加载带有父子自引用的记录？

> ID：279392
> 
> 赞同：0
> 
> 时间：2008-11-10T22:24:53.487
> 
> 标签：nhibernate, tree, castle-activerecord

我的 SQL 表如下所示：

```
CREATE TABLE Page (
    Id int primary key,
    ParentId int, -- refers to Page.Id
    Title varchar(255),
    Content ntext
) 
```

并映射到我的 ActiveRecord 模型中的以下类：

```
[ActiveRecord]
public class Page {

    [PrimaryKey]
    public int Id { get; set; }

    [BelongsTo("Parent")]
    public virtual Page Parent { get; set; }

    [Property]
    public string Title { get; set; }

    [Property]
    public string Content { get; set; }

    [HasMany(typeof(Page), "Parent", "Page")]
    public IList<Page> Children { get; set; }
} 
```

我正在使用 ActiveRecord 使用以下代码检索树根：

```
var rootPages = new SimpleQuery<Page>(@"from Page p where p.Parent is null");
return(rootPages.Execute()); 
```

这为我提供了正确的对象图，但 SQL Profiler 跟踪显示，子页面正在由树中每个非叶节点的单独查询加载。

如何让 ActiveRecord 预先加载全部内容`("SELECT * FROM Page")`，然后对内存中的对象进行排序以提供所需的父子关系？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-07-28T02:35:38.247

最简单的方法是获取整个表，然后过滤结果。如果您使用的是 linq，这很容易。

```
var AllPages = ActiveRecordMediator<Page>.FindAll();
var rootPages = AllPages.Where(p => p.Parent == null); 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-14T18:00:21.483

试试这个：

```
var rootPages = new SimpleQuery<Page>(@"from Page p left join fetch p.Children where p.Parent is null");
return(rootPages.Execute()); 
```

这将导致在初始查询期间填充结果集中每个页面的 Children 集合，这应该会将您的整体查询负载减少到单个查询。

# visual-studio - TFS SourceControl 从主干分支合并

> ID：279396
> 
> 赞同：6
> 
> 时间：2008-11-10T22:26:42.140
> 
> 标签：visual-studio, tfs, branch

我在 Visual Studio TFS 中进行分支时遇到问题。这可能是由于我正在开发的方法，但如果是这种情况，请让我知道分支的最佳实践是什么，我将更改我们的程序。

大约一个月前，我分支了一个项目，以便我可以开始开发新版本的 Web 应用程序，但我不希望应用程序的主干受到我的更改的影响，因为我测试并试图将事情搞定生产水平状态。

因此，就在几天前，我们发现了在生产中运行的当前版本的应用程序存在一些错误。我在主分支上修复了这些错误，重新部署了 Web 应用程序，并将错误修复签入到主应用程序主干。这就是问题所在。现在主干有错误修复，但我的新版本分支没有。

这是我的问题：我如何进行版本比较或类似的事情以将错误修复到分支项目中？

我可能会做一些不寻常的事情。这是由于我缺乏对分支和开发生命周期的了解。请让我知道是否有更好的方法可以在您的开发商店中练习。

干杯，

C

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T09:34:30.123

听起来你对我做的事情是正确的，你只需要将你的更改合并到你的开发分支中。

要合并更改，您需要在源代码管理资源管理器中。右键单击“源”分支（在您的情况下是主分支），然后选择“合并”。然后，您将进入合并向导，您可以在其中选择要合并到的分支（您的开发分支）。就个人而言，我总是在该页面上选择“选定的变更集”选项，因为它会为您提供变更集列表，您可以选择要引入开发分支的变更集范围的开始和结束。

希望有帮助。

马丁。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T07:54:36.363

您只需要将这些更改合并到新版本分支。

一个好的起点是[分支和合并指导](http://www.codeplex.com/BranchingGuidance)。阅读它以了解如何组织您的分支机构。

# asp.net - 引用的 WCF 服务的运行时错误

> ID：279398
> 
> 赞同：1
> 
> 时间：2008-11-10T22:26:43.170
> 
> 标签：asp.net, visual-studio-2008, wcf, reference

我通过 Visual Studio 2008 中的“添加服务引用”选项在本地工作站上的 ASP.NET 网站项目中创建了对 IIS 托管 WCF 服务的引用。我能够从本地工作站执行该服务。

当我使用 Visual Studio 2008 中的“复制网站”功能将 ASP.NET 网站移动到开发服务器并浏览到使用该服务的页面时，我收到以下错误：

> Reference.svcmap：指定的参数超出了有效值的范围。

有没有人遇到过同样的错误并知道如何解决？

**编辑：**我的开发服务器是带有 IIS 6 的 Win2k3

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T23:03:39.883

问题可能是由于解决方案/项目文件夹结构和 IIS 网站文件夹结构不匹配。不久前我遇到了类似的问题，最终改变了我部署 Web 服务的方式。[这里](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/861e66fe-41cd-483c-8418-599d8d5415a8/)和[这里](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/861e66fe-41cd-483c-8418-599d8d5415a8/)有一些与您类似的问题的讨论，他们最终没有使用添加服务生成的客户端并滚动了他们自己的客户端。此外，我可以保证使用“发布网站”方法来部署我的服务。[这](http://msdn.microsoft.com/en-us/magazine/cc163448.aspx)是一篇关于 Web 服务部署模型的好文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T16:33:03.710

@Sixto Saez：我能够使用类似于您提供的以下资源来使用 ServiceModel 元数据实用工具 (svcutil.exe) 生成代理类。

这是确切的命令行：

```
svcutil /t:code http://<service_url> /out:<file_name>.cs /config:<file_name>.config 
```

[这](http://chakkaradeep.wordpress.com/2008/08/07/generating-wcf-proxy-using-svcutilexe/)是我发现建议使用该方法的参考。

此外，我还可以通过使用 Visual Studio 2008“添加 Web 引用”命令创建引用来使用该服务。它基于 .NET Framework 2.0 Web 服务技术生成代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T23:32:07.157

不幸的是，WCF 服务网站和我不能使用 svcutil 解决方案（除非你知道如何...）。您是否使用 Visual Studio 2008 发布网站功能使用服务参考部署您的服务或网站？

# sql-server - SQL 连接池和审计登录/注销

> ID：279401
> 
> 赞同：29
> 
> 时间：2008-11-10T22:27:13.280
> 
> 标签：sql-server

当我使用 SQL Server Profiler 分析我的应用程序时，我看到大量用于连接到同一数据库的*审核登录*和*审核注销消息。*我想知道，这是否表明我的连接池有问题？我问的原因是因为我在 MSDN 文档中发现了有关连接池的内容：

> 当从连接池中获取或返回连接时，不会在服务器上引发登录和注销事件。这是因为连接返回连接池时并没有真正关闭。有关详细信息，请参阅 SQL Server 联机丛书中的审核登录事件类和审核注销事件类。

[http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)

此外，是否有人有任何提示来确定连接池对于给定 SQL 服务器的有效性？我在一台服务器上有很多数据库，我知道这会产生巨大的影响，但我想知道是否有一种简单的方法可以获取关于我的连接池有效性的指标。提前致谢！

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-22T06:33:07.390

虽然 MSDN 文章说该事件只会针对非重用连接引发，但 SQL Server 文档与此声明相矛盾：

> “审核登录事件类表明用户已成功登录到 Microsoft SQL Server。此类中的事件由新连接或从连接池中重用的连接触发。”

衡量池化有效性的最佳方法是收集连接和不连接池所花费的时间。使用池化，您应该看到第一个连接很慢，而随后的连接非常快。如果没有池化，每个连接都会花费大量时间。

如果要跟踪 Audit Logon 事件，可以使用 EventSubClass 数据列来确定登录是使用重用连接还是新连接。该值为 1 表示真实连接，2 表示来自 pool.application 的重用连接。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-10T23:26:38.073

请记住，连接是按连接字符串池化的。如果您有许多数据库并使用许多连接字符串进行连接，则您的应用程序将在不存在具有正确连接字符串的情况下创建一个新连接。然后它将池化该连接，如果池已满，则碰撞现有连接。默认的[最大池大小](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectionstring.aspx)是 100 个连接，因此如果您经常在 100 多个数据库中跳转，您将一直关闭和打开连接。

这并不理想，但您可以通过始终连接到单个数据库（一个连接字符串）然后切换 db context 'USE [DBName]' 来解决问题。有以下缺点：

*   您失去了为每个连接字符串指定用户/通行证的能力（您的应用用户需要对所有数据库的权限）。
*   您的 SQL 变得更加复杂（特别是如果您使用的是开箱即​​用的 ORM 或存储过程）。

如果您的数据库数量不大，您可以尝试增加 Max Pool Size。否则，如果某些数据库经常使用而其他数据库不经常使用，您可以关闭不经常使用的数据库上的池。这两个项目都是通过[connectionstring](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectionstring.aspx)配置的。

就指标而言，监视 SQL Server 上的登录和注销事件是一个好的开始。如果你的应用程序池很好，你不应该看到很多。

# c++ - C++0x 标准中 export 关键字的最佳解释是什么？

> ID：279404
> 
> 赞同：27
> 
> 时间：2008-11-10T22:28:56.520
> 
> 标签：c++

我知道在最初的 C++0x 标准中有一个名为`export`.

但我找不到此功能的描述或解释。它应该做什么？另外：哪个编译器支持它？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-08-04T05:27:45.617

尽管标准 C++ 没有这样的要求，但一些编译器要求所有函数模板都需要在使用它的每个翻译单元中可用。实际上，对于那些编译器，模板函数的主体必须在头文件中可用. 重复一遍：这意味着那些编译器不允许在非头文件（如 .cpp 文件）中定义它们。澄清一下，在 C++ese 中，这意味着：

```
// ORIGINAL version of xyz.h
template <typename T>
struct xyz
 {
    xyz();
    ~xyz();
 }; 
```

不会对 ctor 和 dtors 的这些定义感到满意：

```
// ORIGINAL version of xyz.cpp
#include "xyz.h"

template <typename T>
xyz<T>::xyz() {}

template <typename T>
xyz<T>::~xyz() {} 
```

因为使用它：

```
// main.cpp
#include "xyz.h"

int main()
 {
    xyz<int> xyzint;

    return 0;
 } 
```

会产生错误。例如，使用 Comeau C++，您将获得：

> ```
> C:\export>como xyz.cpp main.cpp
> C++'ing xyz.cpp...
> Comeau C/C++ 4.3.4.1 (May 29 2004 23:08:11) for MS_WINDOWS_x86
> Copyright 1988-2004 Comeau Computing.  All rights reserved.
> MODE:non-strict warnings microsoft C++
> 
> C++'ing main.cpp...
> Comeau C/C++ 4.3.4.1 (May 29 2004 23:08:11) for MS_WINDOWS_x86
> Copyright 1988-2004 Comeau Computing.  All rights reserved.
> MODE:non-strict warnings microsoft C++
> 
> main.obj : error LNK2001: unresolved external symbol xyz<T1>::~xyz<int>() [with T1=int]
> main.obj : error LNK2019: unresolved external symbol xyz<T1>::xyz<int>() [with T1=int] referenced in function _main
> aout.exe : fatal error LNK1120: 2 unresolved externals 
> ```

因为在 xyz.cpp 中没有使用 ctor 或 dtor，因此不需要从那里进行实例化。无论好坏，这就是模板的工作方式。

解决此问题的一种方法是显式请求 的实例化`xyz`，在此示例中`xyz<int>`。在蛮力的努力中，可以通过在其末尾添加以下行将其添加到 xyz.cpp：

```
template xyz<int>; 
```

它要求（全部）`xyz<int>`被实例化。不过这有点不对，因为这意味着每次产生新的 xyz 类型时，都必须修改实现文件 xyz.cpp。避免该文件的一种侵入性较小的方法是创建另一个：

```
// xyztir.cpp
#include "xyz.cpp" // .cpp file!!!, not .h file!!

template xyz<int>; 
```

这仍然有些痛苦，因为每次产生新的 xyz 时仍然需要手动干预。在一个重要的程序中，这可能是一个不合理的维护需求。

因此，另一种解决方法是`#include "xyz.cpp"`进入 xyz.h 的末尾：

```
// xyz.h

// ... previous content of xyz.h ...

#include "xyz.cpp" 
```

你当然可以将 xyz.cpp 的内容直接带到（剪切和粘贴）到 xyz.h 的末尾，从而摆脱 xyz.cpp；这是文件组织的问题，最终预处理的结果将是相同的，因为 ctor 和 dtor 主体将位于标头中，因此会被带入任何编译请求，因为那将使用各自的标头。无论哪种方式，这都会产生副作用，即现在每个模板都在您的头文件中。它可能会减慢编译速度，并可能导致代码膨胀。处理后者的一种方法是将有问题的函数（在本例中为 ctor 和 dtor）声明为内联函数，因此这需要您在运行示例中修改 xyz.cpp。

顺便说一句，一些编译器还要求在类内内联定义一些函数，而不是在类外定义，因此对于这些编译器，上述设置需要进一步调整。请注意，这是编译器问题，而不是标准 C++ 问题之一，因此并非所有编译器都需要此问题。例如，Comeau C++ 没有，也不应该。查看[http://www.comeaucomputing.com/4.0/docs/userman/ati.html](http://www.comeaucomputing.com/4.0/docs/userman/ati.html)了解我们当前设置的详细信息。简而言之，Comeau C++ 支持许多模型，包括一个接近于 export 关键字意图的模型（作为扩展），甚至支持导出本身。

最后，请注意 C++ 导出关键字旨在缓解原始问题。然而，目前 Comeau C++ 是唯一被公开支持导出的编译器。有关详细信息，请参阅[http://www.comeaucomputing.com/4.0/docs/userman/export.html](http://www.comeaucomputing.com/4.0/docs/userman/export.html)和[http://www.comeaucomputing.com/4.3.0/minor/win95+/43stuff.txt](http://www.comeaucomputing.com/4.3.0/minor/win95+/43stuff.txt)。希望随着其他编译器符合标准 C++，这种情况将会改变。在上面的示例中，使用 export 意味着返回产生链接器错误的原始代码，并进行更改：在 xyz.h 中使用 export 关键字声明模板：

```
// xyz.h

export
// ... ORIGINAL contents of xyz.h ... 
```

xyz.cpp 中的 ctor 和 dtor 将通过#includeing xyz.h 简单地导出，它已经这样做了。因此，在这种情况下，您不需要 xyztir.cpp，也不需要 xyz.cpp 末尾的实例化请求，也不需要手动将 ctor 或 dtor 带入 xyz.h。使用前面显示的命令行，编译器可能会自动为您完成所有工作。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-10T22:32:05.483

有关其用途，请参阅[此说明](https://isocpp.org/wiki/faq/templates#separate-template-fn-defn-from-decl-export-keyword)

相当多的编译器不支持它，因为它太新或在 gcc 的情况下 - 因为他们不赞成。

这篇文章描述了对许多编译器的标准支持。 [Visual Studio 是否支持新的 C/C++ 标准？](https://stackoverflow.com/questions/146381/visual-studio-support-for-new-c-c-standards)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-11T00:00:34.837

有关 Herb Sutter 对该主题的处理，请参见[此处](http://www.ddj.com/cpp/184401563)和[此处](http://www.ddj.com/showArticle.jhtml?articleID=184401584)。

基本上：导出仅在[一个](http://www.comeaucomputing.com/)编译器中实现 - 在该实现中，导出实际上增加了模板定义和声明之间的耦合，而引入导出的唯一点是减少这种耦合。

这就是为什么大多数编译器不打扰的原因。我原以为他们会从 C++0x 语言中删除导出，但我认为他们没有这样做。也许有一天会有一种好方法来实现具有预期用途的导出。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-10T23:38:28.830

简而言之：

`export`允许您在编写模板类时将声明（即标题）与定义（即代码）分开。如果`export`您的编译器不支持，那么您需要将声明和定义放在一个地方。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-11T13:51:23.693

导出是在链接器和编译器之间引入循环依赖的功能。正如其他人所指出的，它允许一个翻译单元包含在另一个翻译单元中使用的模板的定义。链接器将首先检测到这一点，但它需要编译器来实例化模板。这涉及真正的艰苦工作，例如名称查找。

Comeau 大约在 5 年前 IIRC 首次介绍了它。它在我获得的第一个 beta 版本中运行良好。如果模板 A 和 B 来自不同的 TU，即使像 A<2> 使用 B<2> 使用 A<1> 使用 B<1> 使用 A<0> 之类的测试用例也可以工作。当然，链接器反复调用编译器，但所有名称查找工作正常。实例化 A<1> 从 A.cpp 中找到在 B.cpp 中不可见的名称。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-10T22:39:43.817

[VC++ 7.1 中缺少的标准功能。第二部分：出口](http://www.codeproject.com/KB/mcpp/stdexport.aspx)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-10T23:01:49.230

目前唯一支持导出模板的编译器（据我所知）是 Comeau，它是 Borland C++ Builder X 附带的，但不是当前的 C++ Builder 和英特尔（至少是非官方的，如果不是官方的，不确定） .

# exception - Windows Workflow Foundation，异常和重试？

> ID：279406
> 
> 赞同：3
> 
> 时间：2008-11-10T22:30:19.433
> 
> 标签：exception, workflow-foundation

我有一个包含许多活动的顺序工作流。其中一项活动需要访问我的付费 S3 帐户。它工作正常，但要小心，我想确保它可以处理意外情况，例如“找不到主机”或超时等。

所以..我通常会将代码放在 TRY / CATCH 中。很好..但我不确定我应该如何处理工作流..因为如果代码无法正确完成，则不应发生工作流的其余部分（基于此工作流的逻辑）。

所以，我想重试几次连接......如果最终失败，请调用电子邮件活动并终止工作流程。

任何人都可以提出任何建议，指向视频或屏幕的链接，以帮助展示最佳实践吗？

干杯！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T16:32:00.903

您可能还想看看这篇关于自定义重试活动的博客文章： [http ://www.pluralsight.com/community/blogs/matt/archive/2007/11/28/49315.aspx](http://www.pluralsight.com/community/blogs/matt/archive/2007/11/28/49315.aspx)

看起来这正是您可能需要的！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T23:58:59.507

看一下[`FaultHandlerActivity`](http://msdn.microsoft.com/en-us/library/system.workflow.componentmodel.faulthandleractivity.aspx)，它用于处理由`FaultType`属性指定的类型的异常。关于 WF 中的错误处理的一些链接：

*   [工作流中的故障处理](http://msdn.microsoft.com/en-us/library/ms734771.aspx)
*   [使用 FaultHandlerActivity 活动](http://msdn.microsoft.com/en-us/library/ms734709.aspx)
*   [异常和错误处理](http://books.google.com/books?id=s5eVXpNmQxgC&pg=PA447&source=gbs_toc_r&cad=0_0)（部分书籍章节）

另一种方法是使用该[`Activity.HandleFault`](http://msdn.microsoft.com/en-us/library/system.workflow.componentmodel.activity.handlefault.aspx)方法，当在您的活动执行的上下文中引发异常时调用该方法。

# image-processing - OpenCV 对象检测 - 中心点

> ID：279410
> 
> 赞同：36
> 
> 时间：2008-11-10T22:32:04.877
> 
> 标签：image-processing, opencv, object-detection

给定一个纯白色背景上的对象，有人知道 OpenCV 是否提供了从捕获的帧中轻松检测对象的功能吗？

我正在尝试定位对象（矩形）的角/中心点。我目前正在这样做的方式是通过蛮力（扫描图像以查找对象）并且不准确。我想知道引擎盖下是否有我不知道的功能。

**编辑细节**：大小和一个小汽水罐差不多。相机位于对象上方，以赋予其 2D/矩形的感觉。来自相机的方向/角度是随机的，它是根据角点计算的。

它只是一个白色背景，上面有对象（黑色）。拍摄的质量与您期望从罗技网络摄像头看到的一样。

一旦我得到角点，我就会计算中心。然后将中心点转换为厘米。

它正在完善我如何获得这 4 个角，这是我想要关注的。你可以用这张图片看到我的蛮力方法：[图片](https://i.stack.imgur.com/jUV9H.png)

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-26T18:30:23.570

已经有一个如何在 OpenCV 中进行矩形检测的示例（查看 samples/squares.c），实际上它非常简单。

这是他们使用的粗略算法：

```
0\. rectangles <- {}
1\. image <- load image
2\. for every channel:
2.1  image_canny <- apply canny edge detector to this channel
2.2  for threshold in bunch_of_increasing_thresholds:
2.2.1   image_thresholds[threshold] <- apply threshold to this channel
2.3  for each contour found in {image_canny} U image_thresholds:
2.3.1   Approximate contour with polygons
2.3.2   if the approximation has four corners and the angles are close to 90 degrees.
2.3.2.1    rectangles <- rectangles U {contour} 
```

不是他们正在做什么的确切音译，但它应该对您有所帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-09-26T19:25:17.560

希望这会有所帮助，使用矩方法来获取黑白图像的质心。

```
cv::Point getCentroid(cv::Mat img)
{
    cv::Point Coord;
    cv::Moments mm = cv::moments(img,false);
    double moment10 = mm.m10;
    double moment01 = mm.m01;
    double moment00 = mm.m00;
    Coord.x = int(moment10 / moment00);
    Coord.y = int(moment01 / moment00);
    return Coord;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T13:43:01.463

OpenCV 有很多功能可以帮助您实现这一目标。如果您使用该语言进行编程，请下载 Emgu.CV 以获取包装到库中的 C#.NET。

获得你想要的东西的一些方法：

1.  像以前一样找到角落 - 例如“CornerHarris”OpenCV函数

2.  阈值图像并计算重心 - 请参阅[http://www.roborealm.com/help/Center%20of%20Gravity.php](http://www.roborealm.com/help/Center%20of%20Gravity.php) ...这是我将使用的方法。您甚至可以在 COG 例程中执行阈值处理。即 cog_x += *imagePtr < 128 ？255：0；

3.  找到图像的时刻以提供旋转、重心等 - 例如“时刻”OpenCV 功能。（这个我没用过）

4.  （编辑）AForge.NET 库具有角点检测功能以及示例项目（MotionDetector）和连接到网络摄像头的库。我认为这将是最简单的方法，假设您使用的是 Windows 和 .NET。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-01-29T02:05:09.867

由于没有人发布完整的 OpenCV 解决方案，这里有一个简单的方法：

1.  **获取二值图像。**我们加载图像，转换为灰度，然后使用[Otsu的阈值得到二值图像](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_thresholding/py_thresholding.html#otsus-binarization)

2.  **寻找外轮廓。**我们使用找到轮廓`findContours`，然后使用提取边界框坐标`boundingRect`

3.  **找到中心坐标。**由于我们有轮廓，我们可以使用[矩](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_contours/py_contour_features/py_contour_features.html#moments)找到中心坐标来提取轮廓的质心

* * *

这是一个边界框和中心点以绿色突出显示的示例

输入图像`->`输出

![](https://i.stack.imgur.com/IvbZF.png) ![](https://i.stack.imgur.com/DAHSi.png)

```
Center: (100, 100) 
```

![](https://i.stack.imgur.com/arvpU.png) ![](https://i.stack.imgur.com/T7UnW.png)

```
Center: (200, 200) 
```

![](https://i.stack.imgur.com/KVDzN.png) ![](https://i.stack.imgur.com/crrDY.png)

```
Center: (300, 300) 
```

* * *

回顾一下：

> 给定一个纯白色背景上的对象，有人知道 OpenCV 是否提供了从捕获的帧中轻松检测对象的功能吗？

首先获得二值图像（[Canny 边缘检测](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_canny/py_canny.html)、[简单阈值](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_thresholding/py_thresholding.html#simple-thresholding)、[Otsu 阈值](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_thresholding/py_thresholding.html#otsus-binarization)或[自适应阈值](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_thresholding/py_thresholding.html#adaptive-thresholding)），然后使用[`findContours`](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_contours/py_contours_begin/py_contours_begin.html). 要获取边界矩形坐标，您可以使用[`boundingRect`](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_contours/py_contour_properties/py_contour_properties.html)which 将为您提供`x,y,w,h`. 要绘制矩形，您可以使用 绘制它[`rectangle`](https://docs.opencv.org/2.4/modules/core/doc/drawing_functions.html#rectangle)。这将为您提供轮廓的 4 个角点。如果要获取中心点，请使用 [`moments`](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_contours/py_contour_features/py_contour_features.html#moments)提取轮廓的质心

代码

```
import cv2
import numpy as np

# Load image, convert to grayscale, and Otsu's threshold 
image = cv2.imread('1.png')
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
thresh = cv2.threshold(gray, 0, 255, cv2.THRESH_BINARY_INV + cv2.THRESH_OTSU)[1]

# Find contours and extract the bounding rectangle coordintes
# then find moments to obtain the centroid
cnts = cv2.findContours(thresh, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_NONE)
cnts = cnts[0] if len(cnts) == 2 else cnts[1]
for c in cnts:
    # Obtain bounding box coordinates and draw rectangle
    x,y,w,h = cv2.boundingRect(c)
    cv2.rectangle(image, (x, y), (x + w, y + h), (36,255,12), 2)

    # Find center coordinate and draw center point
    M = cv2.moments(c)
    cx = int(M['m10']/M['m00'])
    cy = int(M['m01']/M['m00'])
    cv2.circle(image, (cx, cy), 2, (36,255,12), -1)
    print('Center: ({}, {})'.format(cx,cy))

cv2.imshow('image', image)
cv2.waitKey() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T22:56:51.643

在其他机器视觉库中通常称为blob分析。我还没用过opencv。

# messaging - 了解 Microsoft 的 CDO.Message 脱机行为

> ID：279412
> 
> 赞同：1
> 
> 时间：2008-11-10T22:32:28.713
> 
> 标签：messaging, email

我正在使用[CDO.Message](http://msdn.microsoft.com/en-us/library/aa488364.aspx)类从 Visual FoxPro 应用程序创建和发送电子邮件。我已经测试过它在用户连接到互联网*时可以工作，甚至在我与网络断开连接时发送它似乎也可以工作*，它只是在客户端重新连接时发送。我`.Send()`对 CDO.Message 类的方法的一个问题是它不返回任何成功/失败值（尽管如果对象无法发送，它将引发异常）。电子邮件似乎永远不会在用户的 Outlook“发件箱”或任何类似的东西中等待，但它似乎在某个地方等待它发送时的 Web 连接。

我的问题是：当**应用程序离线时，****我调用的 CDO.Message 电子邮件在哪里？`.Send()`**它是否有最终的超时/失败条件？

我试图避免“[巧合编程](http://www.pragmaticprogrammer.com/the-pragmatic-programmer/extracts/coincidence)”，任何有关 CDO.Message 如何工作的线索都会有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-20T19:14:12.333

除非您另外明确指定，否则您使用的是本地计算机上的 SMTP 服务器。如果是这样，应用程序会将消息放入本地 SMTP 服务器的出站队列中，并且您的应用程序对 Send() 的调用将始终成功（如果您的 SMTP 服务器正在运行并且您的消息格式正确）。您可以在 SMTP 服务中设置 Outbound Expiration 超时属性，以指定消息在从出站队列中删除之前可以保留多长时间。

LSoft 有一个[很好的指南](http://www.lsoft.com/resources/wp-iis-smtp.pdf)，用于在 IIS 6 中配置 SMTP 服务，以便与他们的 LISTSERV 包一起使用。

# linux - 如何为 Debian 下载/安装预编译的 Subversion 二进制文件

> ID：279414
> 
> 赞同：1
> 
> 时间：2008-11-10T22:33:25.340
> 
> 标签：linux, svn, unix, debian

一直在尝试升级我的 subversion 安装，但由于（我认为）权限有限（我正在使用托管的 Linux 帐户），我无法正确“./configure”并编译源代码（参见帖子[Post1](https://stackoverflow.com/questions/189906/upgrade-subversion-143-to-152-on-debian-hosted-account)和[Post2](https://stackoverflow.com/questions/274656/building-subversion-154-on-debian-could-not-find-library-containing-rsanew)如果非常感兴趣）

所以，我在想如果我可以下载**预编译的二进制文件**，就可以解决我的问题。如果您有更好的想法 - 我也很想听听！

注意：我无法按照subversion.tigris.com的建议调用**aptitude**或**apt-get install** [subversion](http://subversion.tigris.org/getting.html#debian)

**我也有兴趣知道如何安装那些预编译的二进制文件:)**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T22:37:52.790

您可以使用[.](http://packages.debian.org/search?keywords=subversion&exact=1)`dpkg-deb -x`

因此，例如，如果您在 i386 上，您可以这样做：

```
wget ftp://ftp.debian.org/debian/pool/main/s/subversion/subversion_1.5.4dfsg1-1_i386.deb
dpkg -x subversion_1.5.4dfsg1-1_i386.deb 颠覆

```

当然，您可能需要进行一些调整才能使其正常工作。提取软件包与安装软件包不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T22:42:05.353

查看 Debian [SVN 软件包](http://packages.debian.org/search?keywords=subversion&exact=1)列表，我认为[etch（稳定版）](http://packages.debian.org/etch/subversion)是您需要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T22:45:54.723

另请参阅有关同一主题的[此线程。](https://stackoverflow.com/questions/189906/upgrade-subversion-143-to-152-on-debian-hosted-account#194115)

# ruby-on-rails - 为 Web 应用程序实现细粒度授权的最佳方式？

> ID：279415
> 
> 赞同：5
> 
> 时间：2008-11-10T22:33:38.727
> 
> 标签：ruby-on-rails, web-applications, authorization

我正在开发一个 Rails Web 应用程序，目前有大约 20 个用户正在使用它。

应用程序的某些部分只能由某些用户访问，因此我们已经有了一个基本的授权框架，我使用acts_as_authenticated 插件实现了它。

用户的权限取决于他们在哪个部门工作，例如管理可以访问应用程序的所有部分，而会计只能访问与会计相关的部分，而销售只能访问与销售相关的部分等。

另一方面，用户会看到指向他们没有足够权限的操作的链接。例如，销售部门的人员在主菜单中看到一个指向财务记录的链接，但当他们单击它时，什么也没有发生。之所以如此，是因为 AFAIK 没有使用acts_as_authenticated 查询用户权限的有效方法。

我想通过两种方式改变它：

1.  我想引入更细粒度的授权。目前，授权是在控制器级别完成的。我想在动作或模型级别执行此操作。例如，我希望销售部门的人员能够创建和更新付款，但不能删除它们。

2.  我希望能够有效地查询用户权限，这样我就可以从界面中删除不必要的（和令人困惑的）链接。

你认为最优雅的实现方式是什么？

不需要特定于 Rails 的答案，我只想知道如何在数据驱动的应用程序中实现这一点。

最后，这是它目前的实现方式：

```
def authorized?
  current_user.role.foo? or current_user.role.bar?
end 
```

这是我最初的想法，我认为这不是解决这个问题的最佳方法：

```
+------------+------------+---------+
| 部门 | 控制器 | 行动 |
+------------+------------+---------+
| 会计| 付款 | 索引 |
| 会计| 付款 | 新 |
| 会计| 付款 | 创建 |
| 会计| 付款 | 编辑 |
| 会计| 付款 | 更新 |
| 会计| 付款 | 销毁|
| 销售 | 付款 | 新 |
| 销售 | 付款 | 创建 |
| 销售 | 付款 | 编辑 |
| 销售 | 付款 | 更新 |
+------------+------------+---------+

```

或者

```
+------------+----------+--------+--------+------+- --------+--------+
| 部门 | 型号 | 列表 | 创建 | 阅读 | 更新 | 删除 |
+------------+----------+--------+--------+------+- --------+--------+
| 会计| 付款 | 真的 | 真的 | 真的 | 真的 | 真的 |
| 销售 | 付款 | 错误 | 真的 | 真的 | 真的 | 错误 |
+------------+----------+--------+--------+------+- --------+--------+

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T14:57:58.583

据我了解，授权的基本概念是一个角色。角色可以表达各种东西：

1.  用户与整个系统的关系（例如，成为系统的管理员）
2.  用户与某种实体的关系（例如，成为评论的主持人）
3.  用户与某个特定实体的关系（例如，成为某个资源的所有者）
4.  其他一些复杂的关系（例如，成为某个资源所有者的用户的朋友）
5.  该用户具有某些属性或以某种特定方式响应某些消息（例如，成为青少年）

一个真正细粒度的授权系统应该允许您根据上述任何标准为用户定义角色。此外，它应该允许您为用户设置多个角色。（Rails 最简单的授权插件形式通常只允许您定义第一种角色并为用户设置一个角色。）

授权的另一部分是一种机制，它根据用户是否适合某个角色（角色集）这一事实来决定运行（或不运行）代码的哪一部分。要应用这种机制，我们必须找到应该进行授权的点，并选择应该或不应该运行代码的角色。

在 Rails 中对我有用的方法是在模型级别定义角色并保留授权机制（为我想要授权的代码部分设置允许的角色，并询问当前用户是否具有允许运行该部分的角色) 完全用于控制器/视图。

为此，我使用了经过调整的 rails-authorization-plugin，它具有我刚才提到的所有可能性（各种角色、一个用户的多个角色、控制器和视图级别的授权）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T02:53:12.290

您可能需要在模型中引入“功能点”或“特征”的概念作为访问控制点；一个“特征”可能有一个可选的“父特征”来形成一个层次结构。您可以决定什么是功能，什么不是功能，并以编程方式检查权限。这还应该允许您在绘制菜单之前检查功能级别的访问权限，以便用户永远不会看到指向他们不允许访问的页面的链接。

[此处](https://stackoverflow.com/questions/176338/customer-configurable-aspnet-web-site-security-for-fine-grained-control-of-page)描述了类似的情况/解决方案

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T07:46:58.860

在您的两个提案中，第一个选项看起来更好一些，因为它允许您添加可能不是模型级操作的操作。我猜您会遇到第二种模型做得不够的情况，您需要更改架构或开始在整个应用程序中添加权限逻辑（例如“没有“创建”访问权限的用户也无法运行方法 xxx")

我认为解决方案看起来不太干燥的原因是存在重复：

1.  在部门名称中，以及
2.  在部门能力

关于#1，创建一个部门表并给每个部门一个 ID 是有意义的。

关于#2，我同意第一条评论。您可能可以将各种控制器和操作聚集到功能组中，然后在用户和功能之间设置多对多关系（映射表）。然后，函数将与它们允许的操作/控制器具有一对多的关系。这将让您以最少的重复，说出诸如“会计和销售应该能够阅读所有财务表格”之类的内容。

# security - 生成 64 位签名的某种安全方法是什么？

> ID：279418
> 
> 赞同：3
> 
> 时间：2008-11-10T22:35:33.480
> 
> 标签：security, language-agnostic, signature

我想[签署](http://en.wikipedia.org/wiki/Digital_signature)一个设备，我有 64 位来存储我的签名在设备中。该设备有一个 MAC 地址和一些其他详细信息（大约 30 个字节），我可以修改它来创建我的签名。

如果可能的话，我希望该方法是单向的，这样我就可以在不知道如何创建有效签名的情况下验证签名是否有效。大多数公钥-私钥都具有此功能，但它们生成的签名长度为 48 个字节（我只有 8 个字节）。

在 Python 中实现是一个加号。

谢谢

**编辑**：感谢大家的建议。听起来没有*安全*的方法可以做到这一点，只有一种对攻击者来说不太方便的方法。我可能会使用加密哈希和秘密比特洗牌。这将与我的（非常弱的）“安全性”中的任何其他链接一样安全。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T23:25:41.150

哈希函数和数字签名是**非常**不同的东西。

数字签名的大小取决于底层散列函数和密钥长度。所以理论上，您可以创建一个生成 64 位签名的 RSA 实现，但这将是一个非常弱的签名。

对于较小的密钥长度，您可能需要查看椭圆曲线密码学。

**编辑：**是的，我是密码学家。

**编辑 2：**但是，如果您只需要一个哈希函数，您可以按照 Fernando Miguélez 的建议查看 elf64 或 RIPEMD-64。

**编辑 3：**做数学，你需要在 ECC 中使用 16 位密钥来生成 64 位签名，这是非常弱的。对于 ECC，任何小于 128 位的都可以被认为是弱的。对于 RSA，这是 1024 位。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T22:45:07.860

基本上你需要的是一个 64 位[加密散列函数](http://en.wikipedia.org/wiki/List_of_hash_functions)，例如 Ripemd-64 或 elf-64。然后你用加密方法加密散列，你得到一个 64 位的签名。唯一的问题是，从非密码分析师的角度来看，64 位提供的签名比典型的超过 128 位散列要弱得多。尽管如此，它仍然可能适合您的应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T22:37:50.980

您可以只使用标准散列函数 (MD5 SHA1)，并且只使用前 30 个字节或后 30 个字节。
散列函数生成的字节数是相当随意的——这显然是空间和唯一性之间的权衡。他们使用的签名长度没有什么特别之处。

编辑 - 抱歉，我认为 MD5 返回 32 字节 - 它实际返回 16 字节，但通常写为 32 十六进制数字。

# html - 您可以将 html 单选按钮设置为看起来像复选框吗？

> ID：279421
> 
> 赞同：61
> 
> 时间：2008-11-10T22:36:19.580
> 
> 标签：html, css, radio-button

我有一个用户将填写并打印的 html 表单。打印后，这些表格将被传真或邮寄给政府机构，并且需要看起来与该机构发布的原始表格足够接近，以使政府官员不会发现这是复制品。在表单中输入的数据不会保存在任何地方，甚至不会提交回 Web 服务器。重要的是我们的用户可以在我们的 Intranet 站点上轻松找到这些表格，并使用他们的普通键盘输入表格进行打印。

在屏幕上，我想保留单选按钮，以强制和传达单选按钮的使用（仅选择一个选项）。但是，当它打印出来时，我需要它以方形复选框样式而不是圆形单选按钮样式打印。我知道如何使用媒体选择器来设置仅用于打印的样式，所以这不是问题。只是我不知道我是否可以像我想要的那样设置单选按钮的样式。

如果我不能让这个工作，我将不得不创建一个复选框来隐藏每个单选按钮，使用 javascript 来保持复选框和单选按钮同步，并使用 css 在适当的媒体中显示我关心的那个。显然，如果我可以为它们设计样式，它将节省大量工作。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2011-11-10T12:25:13.720

在发布此问题三年后，这几乎触手可及。事实上，在 Firefox 1+、Chrome 1+、Safari 3+ 和 Opera 15+ 中使用[~~CSS3~~](http://wiki.csswg.org/spec/css4-ui#dropped-css3-features) `appearance`财产。

结果是看起来像复选框的单选元素：

```
input[type="radio"] {
  -webkit-appearance: checkbox; /* Chrome, Safari, Opera */
  -moz-appearance: checkbox;    /* Firefox */
  -ms-appearance: checkbox;     /* not currently supported */
}
```

```
<label><input type="radio" name="radio"> Checkbox 1</label>
<label><input type="radio" name="radio"> Checkbox 2</label>
```

*jsfiddle：http: [//jsfiddle.net/mq8Zq/](http://jsfiddle.net/mq8Zq/)*

**注意：**由于缺乏供应商的支持和一致性，这最终从 CSS3 规范中删除。我建议不要实现它，除非您只需要支持基于 Webkit 或 Gecko 的浏览器。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2013-10-09T13:47:56.820

这是我仅使用 CSS 的解决方案（Jsfiddle：http: [//jsfiddle.net/xykPT/](http://jsfiddle.net/xykPT/)）。

![在此处输入图像描述](https://i.stack.imgur.com/jX6gz.png)

```
div.options > label > input {
	visibility: hidden;
}

div.options > label {
	display: block;
	margin: 0 0 0 -10px;
	padding: 0 0 20px 0;  
	height: 20px;
	width: 150px;
}

div.options > label > img {
	display: inline-block;
	padding: 0px;
	height:30px;
	width:30px;
	background: none;
}

div.options > label > input:checked +img {  
	background: url(http://cdn1.iconfinder.com/data/icons/onebit/PNG/onebit_34.png);
	background-repeat: no-repeat;
	background-position:center center;
	background-size:30px 30px;
}
```

```
<div class="options">
	<label title="item1">
		<input type="radio" name="foo" value="0" /> 
		Item 1
		<img />
	</label>
	<label title="item2">
		<input type="radio" name="foo" value="1" />
		Item 2
		<img />
	</label>   
	<label title="item3">
		<input type="radio" name="foo" value="2" />
		Item 3
		<img />
	</label>
</div>
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-11-10T23:06:34.713

在 CSS3 中：

```
input[type=radio] {content:url(mycheckbox.png)}
input[type=radio]:checked {content:url(mycheckbox-checked.png)} 
```

事实上：

```
<span class=fakecheckbox><input type=radio><img src="checkbox.png" alt=""></span>

@media screen {.fakecheckbox img {display:none}}
@media print {.fakecheckbox input {display:none;}} 
```

并且您将需要 Javascript 来保持`<img>`和无线电同步（理想情况下首先将它们插入那里）。

我用过`<img>`，因为浏览器通常配置为不打印`background-image`。使用图像比使用其他控件更好，因为图像是非交互式的，不太可能导致问题。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2021-02-14T23:19:31.570

2021 年的纯香草 CSS / HTML 解决方案。它使用 CSS`appearance: none;`属性。

目前似乎兼容所有主流浏览器：

[https://caniuse.com/?search=appearance%3A%20none](https://caniuse.com/?search=appearance%3A%20none)

```
input[type="radio"]{
   appearance: none;
   border: 1px solid #d3d3d3;
   width: 30px;
   height: 30px;
   content: none;
   outline: none;
   margin: 0;
   box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
}

input[type="radio"]:checked {
  appearance: none;
  outline: none;
  padding: 0;
  content: none;
  border: none;
}

input[type="radio"]:checked::before{
  position: absolute;
  color: green !important;
  content: "\00A0\2713\00A0" !important;
  border: 1px solid #d3d3d3;
  font-weight: bolder;
  font-size: 21px;
}
```

```
<input type="radio" name="radio" checked>
<input type="radio" name="radio">
<input type="radio" name="radio">
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2020-08-20T07:47:04.130

*是的，它可以使用这个 css 来完成，我隐藏了默认单选按钮并制作了一个看起来像复选框的自定义单选按钮。2022 年工作完美。*

```
.css-prp
{
  color: #17CBF2;
  font-family: arial;
}

.con1 {
  display: block;
  position: relative;
  padding-left: 25px;
  margin-bottom: 12px;
  cursor: pointer;
  font-size: 15px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default radio button */
.con1 input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

/* Create a custom radio button */
.checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 18px;
  width: 18px;
  background-color: lightgrey;
  border-radius: 10%;
}

/* When the radio button is checked, add a blue background */
.con1 input:checked ~ .checkmark {
  background-color: #17CBF2;
}
```

```
<label class="con1"><span>Yes</span>
  <input type="radio" name="radio1" checked>
  <span class="checkmark"></span>
</label>
<label class="con1"><span>No</span>
  <input type="radio" name="radio1">
  <span class="checkmark"></span>
</label>
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-09-26T22:48:37.837

我调整了 user2314737 的答案以使用[font awesome](http://fortawesome.github.io/Font-Awesome/examples/)作为图标。对于那些不熟悉 fa 的人来说，img 的一个显着优势是字体固有的基于矢量的渲染。即在任何缩放级别都没有图像锯齿。

## **[jsFiddle](http://jsfiddle.net/xykPT/215/)**

## 结果

![在此处输入图像描述](https://i.stack.imgur.com/nMx1J.png)

```
div.checkRadioContainer > label > input {
	visibility: hidden;
}

div.checkRadioContainer {
	max-width: 10em;
}
div.checkRadioContainer > label {
	display: block;
	border: 2px solid grey;
	margin-bottom: -2px;
	cursor: pointer;
}

div.checkRadioContainer > label:hover {
	background-color: AliceBlue;
}

div.checkRadioContainer > label > span {
	display: inline-block;
	vertical-align: top;
	line-height: 2em;
}

div.checkRadioContainer > label > input + i {
	visibility: hidden;
	color: green;
	margin-left: -0.5em;
	margin-right: 0.2em;
}

div.checkRadioContainer > label > input:checked + i {
	visibility: visible;
}
```

```
<div class="checkRadioContainer">
	<label>
		<input type="radio" name="radioGroup" />
		<i class="fa fa-check fa-2x"></i>
		<span>Item 1</span>
	</label>
	<label>
		<input type="radio" name="radioGroup" />
		<i class="fa fa-check fa-2x"></i>
		<span>Item 2</span>
	</label>
	<label>
		<input type="radio" name="radioGroup" />
		<i class="fa fa-check fa-2x"></i>
		<span>Item 3</span>
	</label>
</div>
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-04-24T06:38:55.903

简单整洁的字体真棒

```
input[type=radio] {
    -moz-appearance: none;
    -webkit-appearance: none;
    -o-appearance: none;
    outline: none;
    content: none;
    margin-left: 5px;
}

input[type=radio]:before {
    font-family: "FontAwesome";
    content: "\f00c";
    font-size: 25px;
    color: transparent !important;
    background: #fff;
    width: 25px;
    height: 25px;
    border: 2px solid black;
    margin-right: 5px;
}

input[type=radio]:checked:before {
    color: black !important;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-06-19T15:52:13.100

**外观**属性不适用于所有浏览器。您可以执行以下操作 -

```
input[type="radio"]{
  display: none;
}
label:before{
  content:url(http://strawberrycambodia.com/book/admin/templates/default/images/icons/16x16/checkbox.gif);
}
input[type="radio"]:checked+label:before{
  content:url(http://www.treatment-abroad.ru/img/admin/icons/16x16/checkbox.gif);
}
```

```
 <input type="radio" name="gender" id="test1" value="male">
  <label for="test1"> check 1</label>
  <input type="radio" name="gender" value="female" id="test2">
  <label for="test2"> check 2</label>
  <input type="radio" name="gender" value="other" id="test3">
  <label for="test3"> check 3</label> 
```

它适用于 IE 8+ 和其他浏览器

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T22:48:08.993

我不认为您可以使控件看起来像使用 CSS 的控件以外的任何东西。

最好的办法是让 PRINT 按钮转到一个新页面，并用图形代替所选单选按钮，然后从那里执行 window.print() 。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-22T02:15:04.147

是的，CSS 可以做到这一点：

```
input[type=checkbox] {
  display: none;
}
input[type=checkbox] + *:before {
  content: "";
  display: inline-block;
  margin: 0 0.4em;
  /* Make some horizontal space. */
  width: .6em;
  height: .6em;
  border-radius: 0.6em;
  box-shadow: 0px 0px 0px .5px #888
  /* An outer circle. */
  ;
  /* No inner circle. */
  background-color: #ddd;
  /* Inner color. */
}
input[type=checkbox]:checked + *:before {
  box-shadow: 0px 0px 0px .5px #888
  /* An outer circle. */
  , inset 0px 0px 0px .14em #ddd;
  /* An inner circle with above inner color.*/
  background-color: #444;
  /* The dot color */
}
```

```
<div>
  <input id="check1" type="checkbox" name="check" value="check1" checked>
  <label for="check1">Fake Checkbox1</label>
</div>
<div>
  <input id="check2" type="checkbox" name="check" value="check2">
  <label for="check2">Fake Checkbox2</label>
</div>
<div>
  <input id="check2" type="radio" name="check" value="radio1" checked>
  <label for="check2">Real Checkbox1</label>
</div>
<div>
  <input id="check2" type="radio" name="check" value="radio2">
  <label for="check2">Real Checkbox2</label>
</div>
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2020-03-28T22:36:16.170

所以我一直潜伏在堆栈上这么多年。这实际上是我第一次在这里发帖。

无论如何，这可能看起来很疯狂，但我在为同样的问题苦苦挣扎时遇到了这篇文章，并想出了一个肮脏的解决方案。我知道有更优雅的方法可以将其设置为属性值，但是：

如果您查看 tcpdf.php 中的第 12880-12883 行：

```
$fx = ((($w - $this->getAbsFontMeasure($tmpfont['cw'][`110`])) / 2) * $this->k);
$fy = (($w - ((($tmpfont['desc']['Ascent'] - $tmpfont['desc']['Descent']) * $this->FontSizePt / 1000) / $this->k)) * $this->k);
$popt['ap']['n'][$onvalue] = sprintf('q %s BT /F%d %F Tf %F %F Td ('.chr(`110`).') Tj ET Q', $this->TextColor, $tmpfont['i'], $this->FontSizePt, $fx, $fy);
$popt['ap']['n']['Off'] = sprintf('q %s BT /F%d %F Tf %F %F Td ('.chr(`111`).') Tj ET Q', $this->TextColor, $tmpfont['i'], $this->FontSizePt, $fx, $fy); 
```

和第 13135-13138 行：

```
$fx = ((($w - $this->getAbsFontMeasure($tmpfont['cw'][`108`])) / 2) * $this->k);
$fy = (($w - ((($tmpfont['desc']['Ascent'] - $tmpfont['desc']['Descent']) * $this->FontSizePt / 1000) / $this->k)) * $this->k);
$popt['ap']['n']['Yes'] = sprintf('q %s BT /F%d %F Tf %F %F Td ('.chr(`108`).') Tj ET Q', $this->TextColor, $tmpfont['i'], $this->FontSizePt, $fx, $fy);
$popt['ap']['n']['Off'] = sprintf('q %s BT /F%d %F Tf %F %F Td ('.chr(`109`).') Tj ET Q', $this->TextColor, $tmpfont['i'], $this->FontSizePt, $fx, $fy); 
```

这些小部件是从 zapfdingbats 字体集呈现的……只需交换字符代码，瞧……检查是收音机和/或反之亦然。这也开启了制作自定义字体集以在此处使用并为您的表单元素添加一些漂亮样式的想法。

无论如何，只是想我会提供我的两分钱......这对我来说太棒了。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2012-05-10T12:10:29.227

使用表格而不使用 Javascript 的非常简单的想法。我是不是太简单了？

```
<style type="text/css" media="screen">
#ageBox {display: none;}
</style>

<style type="text/css" media="print">
#ageButton {display: none;}
</style>

<tr><td>Age:</td>

<td id="ageButton">
<input type="radio" name="userAge" value="18-24">18-24
<input type="radio" name="userAge" value="25-34">25-34

<td id="ageBox">
<input type="checkbox">18-24
<input type="checkbox">25-34

</td></tr> 
```

# c++ - 什么都没有的 ASCII 值

> ID：279425
> 
> 赞同：2
> 
> 时间：2008-11-10T22:39:17.810
> 
> 标签：c++, ascii

有没有我可以在 C++ 中放入一个字符的 ascii 值，它什么都不代表？我试过 0 但它最终搞砸了我的文件，所以我无法阅读它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T22:45:40.510

ASCII 0 为空。除此之外，传统 ASCII 中没有“无”字符。如果合适，您可以使用控制字符，如 SOH（标题开头）、STX（文本开头）或 ETX（文本结尾）。它们的 ASCII 值分别为 1、2 和 3。

有关我用于此说明的 ASCII 代码的完整列表，请参阅[此站点](http://www.jimprice.com/jim-asc.shtml)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T22:43:25.507

当然。使用不会出现在常规数据中的任何字符值。这通常称为分隔文本文件。常用的分隔符选择包括空格、制表符、逗号、分号、竖线字符和波浪号。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T22:47:20.727

在 C++ 源文件中，'\0' 表示 0 字节。但是，C++ 字符串通常以 null 结尾，这意味着 '\0' 表示字符串的结尾——这可能是你的文件混乱的原因。

如果你真的想在数据文件中存储一个 0 字节，你需要使用一些其他的编码。一个简单的字符会使用一些其他字符 - 例如，0xFF - 它不会出现在您的数据中，或者一些长度/数据格式或类似的东西。

无论您选择使用哪种编码，写入文件的应用程序和读取文件的应用程序都需要就编码的内容达成一致。这是一个全新的噩梦。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T22:41:50.863

空字符 '\0' 仍然占用一个字节。

您的软件是否将空字符识别为文件结尾字符？

如果您的软件正在读取此文件，您可以定义一个占位符字符（与数据不同的字符），但您还需要处理该字符。如，说'*'是你的占位符。您将读取字符，但不会将其添加到存储数据的结构中。它仍然会占用文件中的空间，但不会占用数据结构中的空间。

我是在回答你的问题还是错过了它？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T22:41:53.827

你的意思是你可以写一个实际上不会改变文件的值吗？答案是**否定**的。

也许发布更多关于你想要完成的事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T22:42:06.820

这取决于它是什么类型的文件以及谁在解析它。

# asp.net - Sharepoint API - 如何从 ASP.NET Web 应用程序将文件上传到 Sharepoint 文档库

> ID：279429
> 
> 赞同：9
> 
> 时间：2008-11-10T22:40:46.760
> 
> 标签：asp.net, sharepoint, sharepoint-2007

我是 Sharepoint Server 的新手，我们是否有任何实用程序可以从 ASP.NET 应用程序上传文件。

能否请您提供宝贵的答案？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T23:03:11.617

您可以编写一些自定义代码来执行此操作。如果您在同一台服务器上或使用 WebServices，则可以使用 SharePoint API

这是示例代码，假设您知道文档库的 url，并且您正在将文档上传到根文件夹。您必须添加 Microsoft.SharePoint.dll 作为对 ASP.NET 项目的引用

```
 using (SPSite siteCollection = new SPSite(url))
        {
            using (SPWeb spWeb = siteCollection.OpenWeb())
            {
                SPList spList = spWeb.GetList(url);

                string fileName = "XXXX";
                FileStream fileStream = null;
                Byte[] fileContent = null;

                try
                {
                    string docPath = XXXX; //physical location of the file
                    fileStream = File.OpenRead(docPath + fileName);
                    fileContent = new byte[Convert.ToInt32(fileStream.Length)];
                    fileStream.Read(fileContent, 0, Convert.ToInt32(fileStream.Length));

                    spList.RootFolder.Files.Add(spList.RootFolder.Url + "/" + fileName, fileContent, true);
                    spList.Update();
                }
                catch(Exception ex)
                {

                }
                finally
                {
                    if (fileStream != null)
                    {
                        fileStream.Close();
                    }
                }
            }
        } 
```

# sql - 使用 SQL 确定子网掩码的 cidr 值

> ID：279431
> 
> 赞同：11
> 
> 时间：2008-11-10T22:40:52.720
> 
> 标签：sql, subnet, bitmask, cidr

我想找到一种方法来执行 SQL 查询，该查询将计算存储在数据库中的子网掩码的 cidr（位表示）。例如，我将 255.255.255.0 或其十进制值 (4294967040) 存储在数据库中。我想做一个选择并通过查询取回 /24 表示。

我已经完成了以下操作来确定子网的最后一个 IP，所以我希望做类似的事情来确定掩码的 cidr 表示。

```
select concat(inet_ntoa(ip_addr),'-',
    inet_ntoa(ip_addr+(POWER(2,32)-ip_mask-1))) range 
from subnets 
order by ip_addr 
```

最好这是一个可以在 mysql、postgres、oracle 等下工作的 SQL 语句。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T20:00:28.330

我想我已经找到了解决问题的方法。这是我所做的：

```
select CONCAT(INET_NTOA(ip_addr),'/',32-log2((4294967296-ip_mask))) net 
from subnets 
order by ip_addr 
```

基本上我把我的十进制掩码从最大十进制值中减去。然后我对该值进行 log2 以获得对数值。然后简单地从 32（可用的最大位）中减去它。

希望对其他人有所帮助。

谢谢

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T23:36:43.480

SQL 查询没有过程循环结构（尽管有过程语言），但您可以将一组行与另一组行进行比较，这有点像循环。

您只有 32 个可能的子网掩码。在这种情况下，创建一个存储这 32 个掩码和相关 CIDR 编号的小表是有意义的。

```
CREATE TABLE cidr (
  bits INT UNSIGNED PRIMARY KEY,
  mask INT UNSIGNED NOT NULL
);

INSERT INTO cidr (bits) VALUES
  ( 1), ( 2), ( 3), ( 4), ( 5), ( 6), ( 7), ( 8), ( 9), (10),
  (11), (12), (13), (14), (15), (16), (17), (18), (19), (20),
  (21), (22), (23), (24), (25), (26), (27), (28), (29), (30),
  (31), (32);

UPDATE cidr SET mask = ((POWER(2,32)-1)<<(32-bits)) & (POWER(2,32)-1);

SELECT CONCAT(s.ip_addr, '/', c.bits)
FROM cidr c JOIN subnets s ON (c.mask = inet_aton(s.ip_mask)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-02-16T12:49:48.673

例如，您需要将`255.255.255.252`网络掩码转换为位掩码。

我总是使用这个简单的查询（PostgreSQL）：

```
SELECT 32-length(trim(((split_part('255.255.255.252','.',1)::bigint*(256^3)::bigint +
                        split_part('255.255.255.252','.',2)::bigint*(256^2)::bigint +
                        split_part('255.255.255.252','.',3)::bigint*256 +
                        split_part('255.255.255.252','.',4)::bigint)::bit(32))::text,'1')); 
```

没有想象的那么好，但它很短而且像魅力一样工作..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-30T18:05:47.150

```
--
-- Dumping routines for database
--
/*!50003 DROP FUNCTION IF EXISTS `INET_ATOC` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ALLOW_INVALID_DATES' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `INET_ATOC`(`paramNETMASK` varchar(15)) RETURNS int(2) unsigned
    DETERMINISTIC
    COMMENT 'Converts an IPv4 netmask in dotted decimal notation to a CIDR integer between 0 and 32'
BEGIN
    DECLARE `netmask` int unsigned;
    DECLARE `cidr` int unsigned;
    SET `netmask` = INET_ATON(`paramNETMASK`);
    IF (`netmask` IS NULL)
    THEN
        RETURN NULL;
    ELSE
        SET `cidr` = 0;
        countNetBits: WHILE (`cidr` < 32)
        DO
            IF ( (0x80000000 & `netmask`) = 0x80000000 )
            THEN
                SET `netmask` = 0xFFFFFFFF & (`netmask` << 1);
                SET `cidr` = `cidr` + 1;
            ELSE
                LEAVE countNetBits;
            END IF;
        END WHILE;
        IF (`netmask` != 0)
        THEN
            RETURN NULL;
        END IF;
        RETURN `cidr`;
    END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `INET_CTOA` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ALLOW_INVALID_DATES' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `INET_CTOA`(`paramCIDR` int) RETURNS varchar(15) CHARSET utf8
    DETERMINISTIC
    COMMENT 'Converts a CIDR suffix (integer between 0 and 32) to an IPv4 netmask in dotted decimal notation'
BEGIN
    DECLARE `netmask` int unsigned;
    IF  ( (`paramCIDR` < 0) OR (`paramCIDR` > 32) )
    THEN
        RETURN NULL;
    ELSE
        SET `netmask` = 0xFFFFFFFF - (pow( 2, (32-`paramCIDR`) ) - 1);
        RETURN INET_NTOA(`netmask`);
    END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `getSubnet` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `getSubnet`(INOUT `paramADDR` VARCHAR(15), INOUT `paramCIDR` INT, OUT `paramMASK` VARCHAR(15), OUT `paramNETWORK` VARCHAR(15), OUT `paramBROADCAST` VARCHAR(15), OUT `paramNUMHOSTS` INT) CHARSET utf8
    DETERMINISTIC
BEGIN
    DECLARE `numaddrs`  int unsigned;
    DECLARE `ipaddr`    int unsigned;
    DECLARE `netmask`   int unsigned;
    DECLARE `wildcard`  int unsigned;
    DECLARE `network`   int unsigned;
    DECLARE `broadcast` int unsigned;
    DECLARE `numhosts`  int unsigned;

    SET `ipaddr` = INET_ATON(`paramADDR`);

    IF (`ipaddr` IS NULL) OR (`paramCIDR` < 1) OR (`paramCIDR` > 30)
    THEN
        SELECT
            NULL, NULL, NULL, NULL, NULL, NULL
        INTO
            `paramADDR`, `paramCIDR`, `paramMASK`, `paramNETWORK`, `paramBROADCAST`, `paramNUMHOSTS`;
    ELSE
        SET `numaddrs`  = pow( 2, (32-`paramCIDR`) );
        SET `numhosts`  = `numaddrs` - 2;
        SET `netmask`   = 0xFFFFFFFF - (`numaddrs` - 1);
        SET `wildcard`  = 0xFFFFFFFF & (~`netmask`);
        SET `network`   = `ipaddr` & `netmask`;
        SET `broadcast` = `ipaddr` | `wildcard`;

        SELECT
            INET_NTOA(`ipaddr`), `paramCIDR`, INET_NTOA(`netmask`), INET_NTOA(`network`), INET_NTOA(`broadcast`), `numhosts`
        INTO
            `paramADDR`, `paramCIDR`, `paramMASK`, `paramNETWORK`, `paramBROADCAST`, `paramNUMHOSTS`;
    END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */; 
```

# python - Python：如何生成按键？

> ID：279434
> 
> 赞同：1
> 
> 时间：2008-11-10T22:41:30.597
> 
> 标签：python, keypress, popen

我正在打开一个进程（使用 os.popen() ），对于某些命令，它会检测某些按键（例如 ESC - 不是字符，键）。有没有办法将按键事件发送到进程？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T22:52:35.460

您可能想要类似[`Pexpect`](http://www.noah.org/wiki/Pexpect). 已经有一段时间了，现在可能有更好的选择，但它会让你做你想做的事。

据我所知，使用 os.popen 或模块中的命令没有简单的方法来做这种事情`subprocess`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T00:04:58.120

这是在什么平台上的？

如果它在 Win32 上运行，您可能必须实际将事件馈送到事件循环中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T22:46:59.883

显而易见的方法是在它自己的外壳中启动该过程。
类似 os.popen("sh command")

# sql - 为什么这个 SQL 脚本会这样工作？

> ID：279444
> 
> 赞同：6
> 
> 时间：2008-11-10T22:42:50.940
> 
> 标签：sql, sql-server, tsql

我正在从 SQL Server 2005 中的表中提取电子邮件地址记录，并希望构建一个字符串以用作`@recipients`带有`sp_send_dbmail`. 该表有一个名为 EmailAddress 的字段，表中有 10 条记录。

我正在这样做：

```
DECLARE @email VARCHAR(MAX)
SELECT
    @email = ISNULL(@email + '; ', '') + EmailAddress
FROM
    accounts 
```

现在@email 有一个来自帐户表的 10 个电子邮件地址的半分隔列表。

我的问题是为什么/如何工作？为什么@email 不只有表格中的最后一个电子邮件地址？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T22:49:31.253

因为对于每一行，您将 的当前值`@email`与 中的下一个结果连接起来`EmailAddress`。字符串连接就像调用函数一样，它必须按顺序计算每一行的结果。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T22:58:17.960

假设您有 3 个地址：

```
a@b.c
b@b.c
c@b.c 
```

对于第一行，`@email`是`NULL`，所以它变成了`"" + "a@b.c"`，所以`"a@b.c"`。

对于第二行，`@email`变成`"a@b.c" + "; " + "b@b.c"`，所以`"a@b.c; b@b.c"`。

对于最后一行，`@email`变为`"a@b.c; b@b.c" + "; " + "c@b.c"`，所以`"a@b.c; b@b.c; c@b.c"`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T22:54:25.173

因为连接表达式每行计算一次。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T23:06:29.953

您的 SELECT 没有选择行 - 用于显示 - 它重复地将表达式连接到同一个变量。所以最后，你只剩下要展示的变量了。

大概您会在批处理文件中的另一行中找到它，例如“SELECT @email”

思考：

结果 = "" + name1
结果 = 结果 + name2
结果 = 结果 + name3
等等。

可能您认为 SELECT variable = expression 是一个组合赋值和 SELECT; 但这实际上只是一个任务。在任何情况下，@email 都不会为每一行重新初始化。

# c# - 如何使用 .net 2.0 中的 WebBrowser 控件检查 ajax 更新？

> ID：279450
> 
> 赞同：4
> 
> 时间：2008-11-10T22:44:10.547
> 
> 标签：c#, .net, ajax, winforms

我有一个使用 WebBrowser 控件在 winform 应用程序中显示的网页。当网页中的 HTML 发生变化时，我需要执行一个事件；但是，我找不到在通过 Ajax 更新页面时触发的事件。DocumentComplete、FileDownloaded 和 ProgressChanged 事件并不总是由 Ajax 请求触发。我能想到的解决问题的唯一其他方法是轮询文档对象并查找更改；但是，我认为这不是一个很好的解决方案。

是否有另一个我错过的事件将在 ajax 更新或其他解决问题的方式上触发？

我正在使用 C# 和 .net 2.0

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T14:47:43.897

我一直在使用计时器，只是观察特定元素内容的变化。

```
Private AJAXTimer As New Timer

Private Sub WaitHandler1(ByVal sender As Object, ByVal e As System.EventArgs)
    'Confirm that your AJAX operation has completed.
    Dim ProgressBar = Browser1.Document.All("progressBar")
    If ProgressBar Is Nothing Then Exit Sub

    If ProgressBar.Style.ToLower.Contains("display: none") Then
        'Stop listening for ticks
        AJAXTimer.Stop()

        'Clear the handler for the tick event so you can reuse the timer.
        RemoveHandler AJAXTimer.Tick, AddressOf CoveragesWait

        'Do what you need to do to the page here...

        'If you will wait for another AJAX event, then set a
        'new handler for your Timer. If you are navigating the
        'page, add a handler to WebBrowser.DocumentComplete
    End If
Exit Sub

Private Function InvokeMember(ByVal FieldName As String, ByVal methodName As String) As Boolean
        Dim Field = Browser1.Document.GetElementById(FieldName)
        If Field Is Nothing Then Return False

        Field.InvokeMember(methodName)

        Return True
    End Function 
```

我有 2 个获取事件处理程序的对象，即 WebBrowser 和 Timer。我主要依赖 WebBrowser 上的 DocumentComplete 事件和 Timer 上的 Tick 事件。

我为每个所需的操作编写 DocumentComplete 或 Tick 处理程序，并且每个处理程序通常都会自己删除处理程序，因此成功的事件只会被处理一次。我还有一个名为 RemoveHandlers 的过程，它将从浏览器和计时器中删除所有处理程序。

我的 AJAX 命令通常如下所示：

```
AddHandler AJAXTimer.Tick, AddressOf WaitHandler1
InvokeMember("ContinueButton", "click")
AJAXTimer.Start 
```

我的导航命令如下：

```
AddHandler Browser1.DocumentComplete, AddressOf AddSocialDocComp
Browser1.Navigate(NextURL) 'or InvokeMember("ControlName", "click") if working on a form. 
```

# visual-studio - Visual Studio 网站参考路径

> ID：279451
> 
> 赞同：13
> 
> 时间：2008-11-10T22:44:41.170
> 
> 标签：visual-studio, version-control

在 Visual Studio 网站项目中（在 Visual Studio 2005 或更高版本中，而不是仍然存在 .csproj 文件的 Web 应用程序项目中）参考信息是如何存储的，是否可以对其进行源代码管理而不将编译的二进制文件存储在源代码管理中？

如果您右键单击网站项目并选择属性页，第一个屏幕（参考）列出了所有项目参考。

System.* 引用被列为 GAC 类型，其他 DLL 文件可以列为 BIN 或 Project。

当您将某些内容作为项目引用包含在内时，就会出现问题，然后将其提交到源代码控制（对于我们来说，Subversion，忽略 .dll 和 .pdb 文件。）

另一个开发人员从存储库中获取更新的代码，并且必须手动设置所有这些项目引用，但我什至无法确定这些信息的存储位置，除非它在那个不适合源代码控制的 .suo 中。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-10T22:50:11.517

如果您通过浏览选项卡按文件名引用 .dll，则应该创建一个 .refresh 文件（嵌套在 BIN 中的 dll 下）。我们将它们放在 SVN 中，效果很好（您可能必须手动编辑它们以使用相对路径）。

从 .NET 选项卡添加的引用将添加到 web.config

项目引用存储在解决方案 (.sln) 文件中。打开 .sln 文件，你会看到它们被列出来：

```
Project("{xxxxxxx-7377-xxxx-xxxx-BC803B73C61A}") = "XXXXXXX.Web", "XXXXXXX.Web", "{xxxxxxxx-BB14-xxxx-B3B6-8BF6D8BC5AFF}"
    ProjectSection(WebsiteProperties) = preProject
        TargetFramework = "3.5"
        ProjectReferences = "{xxxxxxxx-C3AB-xxxx-BBED-2055287036E5}|XXXXXX.Data.dll;
            ... 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-06-04T19:02:02.740

Visual Studio 中的“网站”项目是一个奇怪的东西。它们似乎是为了迎合传统的 Web 开发人员，其中“站点”只是目录中的一组文件。同样，当您在 Visual Studio 中创建“网站”项目时，没有真正的“项目”文件，就像 C# 项目有一个 .csproj 文件一样。但是，仍然有一个解决方案文件 (.sln)。通常，程序集 .dll 引用保存在项目文件中。既然一个网站没有，他们去哪里？

**参考其他项目**

如果您添加对另一个项目的引用，则会在解决方案 .sln 文件中创建一个条目。它最终看起来像这样：

```
Project("{E24C65DC-7377-472B-9ABA-BC803B73C61A}") = "WebSite1", "..\..\WebSites\WebSite1\", "{F25DB9D6-810D-4C18-ACBB-BFC420D33B20}"
ProjectSection(WebsiteProperties) = preProject
TargetFramework = "3.5"
ProjectReferences = "{11666201-E9E8-4F5A-A7AB-93D90F3AD9DC}|ClassLibrary1.dll;" 
```

**文件系统参考**

如果您浏览文件系统并添加一个 .dll 文件，那么 Visual Studio 将在 \Bin 文件夹中创建一个同名的“.refresh”文件。该文件只是一个 1 行文本文件，指示文件加载的路径。例如，如果我从 ....\libs 添加“MyAssem.dll”，然后在 Web Site \Bin 文件夹中，我最终会复制 2 个文件：MyAssem.dll 和 MyAssem.dll.refresh。.refresh 文件将包含文本：“....\libs”。在每次构建时，Visual Studio 都会检查 .refresh 文件中的路径，如果那里存在更新的 .dll，它将覆盖 Bin 目录中的那个。

警告：如果 .refresh 文件告诉它查找的文件不存在，Visual Studio 不会抛出错误。它只会继续使用 \Bin 文件夹中已有的 .dll。然而，它会输出一个警告。

**GAC 参考资料**

如果从全局程序集缓存中添加程序集，Visual Studio 会将其输入到 Web.config 文件中，如下所示：

> ```
> <compilation debug="false">
>  <assemblies>
>   <add assembly="System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/> 
> ```

在这里您必须再次注意的是，Visual Studio 假定如果程序集在您的开发计算机上的 GAC 中，那么它将在运行时位于同一个位置！如果您可能已经在您的开发机器上安装了这可能会给您带来麻烦`Oracle.DataAccess`，这会将它放在 GAC 中，但是当您部署时，您只需将 .dll 复制到生产机器上的适当位置。它仍然会尝试在 GAC 中找到它，并且可能会在运行时失败。

我希望这有助于清除网站上的怪异之处以及引用的工作原理！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T13:02:53.883

我使用 copyprojectDll.ps1 powershell。

我的文件夹结构如下

*   ClassLibraries 第三方 网站/Bin
    CopyprojectDll.ps1 Website.sln

ClassLibraries 是我的项目 DAL 的代码类。网站项目仅包含 web 文件、aspx、aspx.cs .. 第三方是必需的库、AjaxToolkit 等。

我编译 ClassLibraries.sln 我运行 CopyprojectDll.ps1 在此之后我使用 Website.sln。

示例 powershell 文件如下。

$文件夹 = @(); $folders +="IB.Security" $folders +="ClassLibraries/Core.Classes"

函数 CopyDllsToWebBin($dll_files) { if ($dll_files -eq $null) { return; } $targetfolder = "./Kod/bin/"

```
foreach($dll in $dll_files)
{

    copy-item $dll.FullName -destination "$targetfolder" -force #-Verbose
} 
```

}

函数 CopyDllsToThirdParty($dll_files) {

$targetfolder = "./ThirdParty/"

```
foreach($dll in $dll_files)
{
    copy-item $dll.FullName -destination "$targetfolder" -force #-Verbose
} 
```

}

$dll_output_folder = "/bin/debug";

foreach($folder 中的$folder) { $dll_files = Get-ChildItem -Path $folder$dll_output_folder -include *.dll -Recurse | 排序对象名称 CopyDllsToWebBin($dll_files) $dll_files = Get-ChildItem -Path $folder$dll_output_folder -include *.pdb -Recurse | 排序对象名称 CopyDllsToWebBin($dll_files) $dll_files = Get-ChildItem -Path $folder$dll_output_folder -include *.xml -Recurse | 排序对象名称 CopyDllsToWebBin($dll_files) "复制的 $folder$dll_output_folder"

}

$dll_files = Get-ChildItem -Path "ThirdParty" -include *.dll -Recurse | 排序对象名称 CopyDllsToWebBin($dll_files) $dll_files = Get-ChildItem -Path "ThirdParty" -include *.pdb -Recurse | 排序对象名称 CopyDllsToWebBin($dll_files) $dll_files = Get-ChildItem -Path $folder$dll_output_folder -include *.xml -Recurse | 排序对象名称 CopyDllsToWebBin($dll_files)

“复制第三方”

日期

# c# - GridView RowDataBound 在回发时不会触发

> ID：279455
> 
> 赞同：8
> 
> 时间：2008-11-10T22:45:31.027
> 
> 标签：c#, asp.net, vb.net, gridview, postback

在 ASP.NET 页面上，我有一个填充了 LINQ 查询结果的 GridView。我在代码中设置 DataSource，然后在其上调用 DataBind。在 GridView 的 RowDataBound 事件中，我根据查询结果有选择地隐藏了某些 GridView 字段中的链接。（例如，我隐藏了相关行的“显示父级”链接没有父行。）

这最初工作正常。但是在回发时（当我*不*调用 DataBind，但 GridView 仍然通过 ViewState 填充时），数据会显示，但 RowDataBound 事件（显然）不会触发，并且我的链接不会被隐藏。

回发后隐藏链接的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-10-25T21:55:46.987

RowDataBound 事件仅在回发期间 GridView 的数据发生更改时触发。该事件是为了速度而短路的，因此它不会不必要地重新生成完全相同的数据。改用 RowCreated 事件来操作 HTML - 无论数据是否已更改，它都会在每次回发时触发。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T21:33:15.103

以下是我最终解决此问题的方法：

1.  我创建了一个具有只读属性的可序列化类：一行的 PK，以及每个链接的布尔值，指示它是否已启用。我们会调用它`LinkVisibility`。
2.  我创建了一个继承自 KeyedCollection 的可序列化类来保存上述类的实例。
3.  我创建了一个 ViewState 支持的属性，其中包含该集合的一个实例。
4.  在我的搜索过程（填充 GridView）中，我清除了集合。
5.  在最初显示/隐藏链接的 RowDataBound 中，我`LinkVisibility`为每一行添加一个实例到集合中。
6.  在 Page.Load 中，当 IsPostBack 为 true 时，我会遍历 GridView 行。我`LinkVisibility`在集合中通过 PK 查找每个（DataKeyNames 在 GridView 中设置），并相应地设置链接。

我不知道这是做到这一点的最佳方式，但它确实有效，这比我尝试过的其他任何事情都多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T18:31:56.093

**1)**你可以有一个方法 - ProcessDataRows()，它会在 grid_DataBound(...) 上被调用一次。然后在 PostBack 之后需要它时。

这样您就可以在需要时处理所有行。

**2)**你可以有 ShowParentLink() 之类的方法。然后将其绑定到网格中的 LinkBut​​ton（如果您使用的是 ItemTemplate）并且链接将具有

```
Visible='<%#ShowParentLink()%>' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T15:31:17.173

我本来希望视图状态也反映您已删除某些链接的事实（假设它们在保存视图状态之前已被删除）。

也许这就是您需要问的问题“为什么删除的链接仍然出现在视图状态中？”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T19:24:06.707

页面无法处理回发事件，除非它*完全*按照以前的方式重建（回发）。如果您在页面初始化期间重新隐藏您的链接，那么您的点击事件等应该会触发。不幸的是，没有看到一些示例代码，我无法获得更具体的信息。

此外，数据 RowDataBound 不会触发，因为您不是数据绑定。由于缺少更好的词，您正在从视图状态-“视图状态绑定”重建页面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T02:23:52.740

另一种解决方案是将逻辑放在 LINQ 查询中，以便最终得到一个布尔 LINQ 字段，如“ShowParentLink”。然后，您可以将 HyperLink 字段的 Visible 属性绑定到该值 - 不需要 RowDataBound。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T13:01:26.117

```
void Process Rows()
{
    ... do something
    ... process complete
    datagrid.DataBind();
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-30T10:31:11.303

```
protected void btnHazardRating_Click(object sender, EventArgs e)
{
    gvPanelRole.RowDataBound += new GridViewRowEventHandler(gvPanelRole_RowDataBound);

    gvPanelRole.DataSource = dtGo;
    gvPanelRole.DataBind();
    ModalPopup.Show();

} 
```

# wcf - 调用 WCF Web 服务时为空 HttpContext

> ID：279469
> 
> 赞同：6
> 
> 时间：2008-11-10T22:50:09.050
> 
> 标签：wcf, silverlight, web-services

我最近编写了一个与 Silverlight 一起使用的 Web 服务，它使用 ASP.net 成员资格和角色。

为了验证服务中的客户端，我查看了 HTTPContext.Current.User（从 Silverlight 调用服务时有效）

但是，我一直在尝试从 asp.net 回发中调用相同的服务。但是当我逐步进入服务时，HTTPContext.Current 有一个用户名的空字符串。

我猜我在 web.config 文件中没有做一些事情，导致 httpContext 不能通过代理发送到我的服务？

任何想法，将不胜感激。我需要能够以某种方式使用 asp.net 成员资格和角色来验证客户端，并让它在 asp.net 客户端和 silverlight 客户端上工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T03:11:11.630

我已经解决了！

看起来默认情况下，Silverlight 应用程序将所有浏览器 cookie 发送到服务。这些 cookie 之一是“.ASPXAUTH”cookie，用于对成员资格和角色进行身份验证。

然而，asp.net 应用程序并未将 cookie 发送到服务。为了发送授权 cookie，我在调用我的 webservice 方法之前使用了以下代码。

```
 using (OperationContextScope scope = new OperationContextScope(ws.InnerChannel))
    {
HttpRequestMessageProperty httpRequest = new HttpRequestMessageProperty();
OperationContext.Current.OutgoingMessageProperties.Add(HttpRequestMessageProperty.Name, httpRequest);

            HttpCookieCollection cc = Page.Request.Cookies;
            if (Request.Cookies[".ASPXAUTH"] != null)
            {
                HttpCookie aCookie = Request.Cookies[".ASPXAUTH"];
                String authcookieValue = Server.HtmlEncode(aCookie.Value);
                httpRequest.Headers.Add("Cookie: " + ".ASPXAUTH=" + authcookieValue);

            }
// Webservice call goes here
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T17:37:42.240

而不是 HTTPContext 尝试 ServiceSecurityContext.Current.PrimaryIdentity

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T01:41:07.537

更新：

好的，我查看了使用 Fiddler 的 HTTP Post 请求

看起来 Silverlight 应用程序正在发送带有授权 cookie 的“状态”，而我的 asp.net 应用程序不是。

看起来我需要在调用服务时发送状态 + 我的授权 cookie。我可能需要尽快提出一个新问题......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T02:57:53.437

我想可能是因为我的 wcf 服务在我的 silverlight.web 项目中，也许他们在分享方面更友好。

我可能需要阅读更多关于 wcf 的内容，并通过建立一个单独的 web 服务项目来创建更大的关注点分离？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T02:19:12.610

不知道它是如何从 Silverlight 但不是 ASP.Net 工作的，但对于初学者来说，这里有[一篇关于如何设置 WCF 以与 ASP.Net 会员提供程序一起工作的好博客文章](http://nayyeri.net/blog/use-asp-net-membership-and-role-providers-in-windows-communication-foundation/)。有很多步骤，因此很容易错过设置。

一旦你让它正常工作，我想两者都应该正常工作。

# delphi - TStringList 与 TList

> ID：279471
> 
> 赞同：31
> 
> 时间：2008-11-10T22:50:25.137
> 
> 标签：delphi, generics, tstringlist

使用标准有什么区别

```
type 
  sl: TStringList 
```

与使用通用 TList 相比

```
type 
  sl: TList<string> 
```

?

据我所知，两者的行为完全相同。

它只是做同样事情的另一种方式吗？

有没有一种情况会比另一种更好？

谢谢！

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-11-10T22:58:02.170

*   TStringList 是 TStrings 的后代。
*   TStringList 知道如何按字母顺序对自己进行排序。
*   TStringList 有一个 Objects 属性。
*   TStringList 不会使您的代码与所有先前版本的 Delphi 不兼容。
*   TStringList 可以用作发布的属性。（一个错误阻止了泛型类的发布，目前。）

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-11T01:54:10.303

在泛型出现之前，TStringList 在 Delphi 中已经存在了很长时间。因此，它构建了一些通用字符串列表所没有的有用功能。

泛型版本只是创建一个与 TList 相同的新类型，该类型适用于 String 类型。（.Add()、.Insert()、.Remove()、.Clear() 等）

TStringList 具有基本的 TList 类型方法和自定义处理字符串的其他方法，例如 .SaveToFile() 和 .LoadFromFile()

如果您想要向后兼容，那么 TStringList 绝对是您的最佳选择。
如果您想要增强处理字符串列表的功能，那么 TStringList 是您的最佳选择。如果您有一些基本的编码基础知识想要处理任何类型的列表，那么您可能需要远离 TStringList。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T01:11:05.617

*   由于 TStringList 是 TStrings 的后代，因此它与 TMemo 的 Lines 属性、TListbox 和 TComboBox 的 Items 以及其他 VCL 组件兼容。所以可以使用 cbList.Items := StringList; // 内部调用 TStrings.Assign

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T08:34:03.693

我可能会说如果你想向后兼容使用 TStringList，如果你想向前兼容（也许将来可以选择将字符串列表更改为 Int64 列表）然后选择 TList。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-12T17:15:50.940

TStringlist 是一个非常通用的 Delphi 类。我多次使用（并滥用 ;-)）它的 Objects 属性。将分隔字符串快速转换为 TMemo 和类似控件（TListBox、TComboBox 等）之类的控件非常有趣。

~~我只是不太喜欢 TList，因为 TStringList 满足了我的需求而不需要处理指针（因为 Tlist 是指针值的列表）。~~

编辑：我将 TList（指针列表）与 TList（通用字符串列表）混淆了。对此感到抱歉。我的观点是：TStringList 不仅仅是一个简单的字符串列表。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-10-17T13:40:54.013

从内存的角度来看，TStringList 内存使用量随着添加到每个项目的 TObject 指针的大小而增加。TList 内存使用量随着添加到每个项目的指针大小而增加。如果只需要一个字符串数组而不需要搜索、替换、排序或关联操作，那么一个动态数组（字符串数组）应该就足够了。这缺乏对 TStringList 或 TList 的良好内存管理，但理论上应该使用较少的内存。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-27T11:16:53.560

对于过去滥用 TStringList 的大多数目的，TObjectDictionary 更好 - 它更快并且不需要排序。

如果您需要一个 TStrings 对象（通常用于 UI 的东西，因为即使对于 XE5，VCL 也不使用泛型太多）使用 TStringList - TObject 所需的转换很烦人，但不是一个炫耀。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-07-25T11:00:42.940

TStringList 已经使用了太久，并且有很多优点，Rob Kennedy 都提到了。

将它用作一对字符串和一个对象的唯一真正缺点是必须将对象转换为预期并存储在此列表中的实际类型（读取时），据我所知，Embarcadero 没有提供 Delphi 2009 及更高版本具有 TStringList 通用版本的 VCL 库。

为了克服这个限制，我实现了这样的列表供内部使用，并且近 3 年来它一直服务于它的目的，所以我决定今天分享它：[https ://github.com/t00/deltoo#tgenericstringlist](https://github.com/t00/deltoo#tgenericstringlist)

一个重要的注意事项 - 它将默认属性从字符串更改为对象，因为在大多数情况下，当对象存储在列表中时，它也是它最常访问的属性。

# winforms - 如何检测鼠标何时离开表单？

> ID：279472
> 
> 赞同：5
> 
> 时间：2008-11-10T22:50:34.620
> 
> 标签：winforms, visual-studio-2008

我有一个带有很多控件的表单。如何检测鼠标何时离开表单？我已经尝试为每个控件和表单连接一个 MouseLeave 事件，但这不起作用，因为当鼠标经过控件时这些事件一直触发。有没有真正有效的方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T20:11:22.680

我知道的唯一可靠的方法是计时器。这是调整翻转时不透明度的示例代码：

```
 public partial class Form1 : Form {
    Timer timer1 = new Timer();
    public Form1() {
      InitializeComponent();
      this.Opacity = 0.10;
      timer1.Tick += new EventHandler(timer1_Tick);
      timer1.Interval = 200;
      timer1.Enabled = true;
    }

    void timer1_Tick(object sender, EventArgs e) {
      Point pos = Control.MousePosition;
      bool inForm = pos.X >= Left && pos.Y >= Top && pos.X < Right && pos.Y < Bottom;
      this.Opacity = inForm ? 0.99 : 0.10;
    }
  } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T01:16:55.963

你应该听：

*   表单所有控件的 MouseLeave 事件
*   表单的 MouseLeave 事件

只需将您的侦听器链接到一个函数，该函数检查光标是否在客户端的表单中。

试试这个：

```
 protected override void OnControlAdded(ControlEventArgs e)
    {
        SubscribeEvents(e.Control);
        base.OnControlAdded(e);
    }

    protected override void OnControlRemoved(ControlEventArgs e)
    {
        UnsubscribeEvents(e.Control);
        base.OnControlRemoved(e);
    }

    private void SubscribeEvents(Control control)
    {
        control.MouseLeave += new EventHandler(control_MouseLeave);
        control.ControlAdded += new ControlEventHandler(control_ControlAdded);
        control.ControlRemoved += new ControlEventHandler(control_ControlRemoved);

        foreach (Control innerControl in control.Controls)
        {
            SubscribeEvents(innerControl);
        }
    }

    private void UnsubscribeEvents(Control control)
    {
        control.MouseLeave -= new EventHandler(control_MouseLeave);
        control.ControlAdded -= new ControlEventHandler(control_ControlAdded);
        control.ControlRemoved -= new ControlEventHandler(control_ControlRemoved);

        foreach (Control innerControl in control.Controls)
        {
            UnsubscribeEvents(innerControl);
        }
    }

    private void control_ControlAdded(object sender, ControlEventArgs e)
    {
        SubscribeEvents(e.Control);
    }

    private void control_ControlRemoved(object sender, ControlEventArgs e)
    {
        UnsubscribeEvents(e.Control);
    }

    protected override void OnMouseLeave(EventArgs e)
    {
        CheckMouseLeave();
        base.OnMouseLeave(e);
    }

    private void control_MouseLeave(object sender, EventArgs e)
    {
        CheckMouseLeave();
    }

    private void CheckMouseLeave()
    {
        Point pt = PointToClient(Cursor.Position);

        if (ClientRectangle.Contains(pt) == false)
        {
            OnMouseLeftFrom();
        }
    }

    private void OnMouseLeftFrom()
    {
        Console.WriteLine("Mouse left the form");
    } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T02:40:07.667

通过查看 aygunes.myopenid.com 的答案，我在 Vb.Net 中制作了这个版本，递归地将 MouseLeaveHandlers 添加到表单上的所有控件，然后使用漂亮的 Clientrectangle.Contains(pt) 检查鼠标光标是打开还是关闭。像魅力一样工作。Cred 访问 aygunes.myopenid.com。

```
Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
    AddMouseLeaveHandlers()
End Sub
Sub AddMouseLeaveHandlers()
    For Each c As Control In Me.Controls
        HookItUp(c)
    Next
    AddHandler Me.MouseLeave, AddressOf CheckMouseLeave
End Sub
Sub HookItUp(ByVal c As Control)        
    AddHandler c.MouseLeave, AddressOf CheckMouseLeave
    If c.HasChildren Then
        For Each f As Control In c.Controls
            HookItUp(f)
        Next
    End If
End Sub
Private Sub CheckMouseLeave(ByVal sender As Object, ByVal e As System.EventArgs)
    Dim pt As Point = PointToClient(Cursor.Position)
    If ClientRectangle.Contains(pt) = False Then
        MsgBox("Mouse left form")
    End If
End Sub 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-01T07:07:16.943

把它放在计时器中：

```
If PointToClient(MousePosition).X < Me.Size.Width AndAlso PointToClient(MousePosition).X > -1 AndAlso PointToClient(MousePosition).Y < Me.Size.Height AndAlso PointToClient(MousePosition).Y > -1 Then
    'Mouse is inside the form
Else
    'Mouse is outside of form
End If 
```

# java - java正则表达式将属性列表从sql查询拆分为attrs的String []

> ID：279473
> 
> 赞同：1
> 
> 时间：2008-11-10T22:51:04.557
> 
> 标签：java, regex

目前我有以下代码：

```
String select = qry.substring("select ".length(),qry2.indexOf(" from "));
String[] attrs = select.split(","); 
```

它适用于大多数部分，但如果出现以下情况则失败：

```
qry = "select a,b,c,DATETOSTRING(date_attr_name,'mm/dd/yyyy') from tbl_a"; 
```

我正在寻找的是提供给 String.split() 的正则表达式，它将处理这种情况，就此而言，您可能会想到我遗漏的任何其他特殊情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T23:38:15.007

您以报价的形式回答：

> 有些人在遇到问题时会想“我知道，我会使用正则表达式”。现在他们有两个问题。— 杰米·扎温斯基

您的正则表达式必须考虑所有可能的函数、嵌套函数、嵌套字符串等。您的解决方案可能不是正则表达式，而是词法分析器+解析器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T23:02:59.993

```
[^,]+\([^\)]+\)|[^,]+, 
```

如果你总是在你的选择字符串中添加一个最终的“，”，应该做得很好：

```
a,b,c,DATETOSTRING(date_attr_name,'mm/dd/yyyy'),f,gg,dr(tt,t,),fff 
```

将无法拆分最后一个 'fff' 属性，但是：

```
a,b,c,DATETOSTRING(date_attr_name,'mm/dd/yyyy'),f,gg,dr(tt,t,),fff, 
```

会捕捉到它。因此，一些预处理将使事情变得顺利。

**警告**：这不考虑表达式中的表达式

```
EXP(arg1, EXP2(ARG11,ARG22), ARG2) 
```

告诉我这是否会发生在您必须处理的查询中。

**注意事项之二**：由于这需要一个真正的正则表达式，而不是 split() 所期望的简单分隔符，因此您必须使用基于模式的 Matcher，`[^,]+\([^\)]+\)|[^,]),`并在 Matcher.find() 上进行迭代以填充属性数组`attrs`。

简而言之，使用 split() 函数，没有一个简单的分隔符可以解决问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T18:35:08.550

[使用SQL 解析器](http://www.gibello.com/code/zql/)可能会更好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T05:52:32.767

正如其他人所提到的，这实际上是一个词法分析器和解析器问题，它比字符串拆分或正则表达式复杂得多。您还会发现，这取决于您使用的 SQL 版本以及将各种齿轮放入解析器的数据库，因为您最终可能会在 SQL 中产生无数变化。您要做的最后一件事是在您发现其他可能出现问题的边缘情况时将这段代码作为您的全职工作来维护。

我会问自己以下问题

1.  您想通过这种标记化来完成什么？你想解决什么问题？可能有一个不需要解析语句的简单解决方案。

2.  您需要所有 SQL 还是只需要目标列/投影列表？

# javascript - 如何让数字键盘出现在 iPhone 网络应用程序中？

> ID：279475
> 
> 赞同：13
> 
> 时间：2008-11-10T22:52:06.957
> 
> 标签：javascript, iphone, mobile-safari, qwerty

在要在 iPhone 上显示的网页上，有没有办法让用户在字段中点击时出现数字键盘，而不是 qwerty 键盘？

[这家伙说这里是怎么做的](http://www.bennadel.com/blog/1197-Defaulting-To-The-Numeric-Keyboard-On-The-iPhone.htm)，但是从 2.0 开始，这个“功能”被禁用了。

我猜有一些花哨的 javascript 可以用来解决这个限制？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-08-05T05:43:58.497

如果您使用 HTML5`number`输入类型，则键盘将默认显示数字。它不是纯数字键盘，但比`text`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T14:46:53.807

是的，这曾经可以通过在文本字段的名称属性中包含单词“zip”来实现。不幸的是，Apple 似乎在 2.0 及更高版本中已将其删除。我建议你提交一个错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-06T23:26:02.613

你可以从 JavaScript 调用 Objective-C，然后显示你想要的。如果您想要一个框架来帮助您，您可以查看 QuickConnectiPhone。它可在[https://sourceforge.net/projects/quickconnect/](https://sourceforge.net/projects/quickconnect/)获得。

您还可以查看[http://tetontech.wordpress.com](http://tetontech.wordpress.com)。这是 QuickConnect 的开发博客。除了 sourceforge 下载中包含的代码之外，它还有一些示例代码。

# ruby-on-rails - 如何在 Rails STI 派生模型中禁用验证和回调？

> ID：279478
> 
> 赞同：20
> 
> 时间：2008-11-10T22:52:54.787
> 
> 标签：ruby-on-rails, validation, callback, single-table-inheritance

给定一个模型

```
class BaseModel < ActiveRecord::Base
  validates_presence_of :parent_id
  before_save :frobnicate_widgets
end 
```

和一个派生模型（底层数据库表有一个`type`字段 - 这是简单的 rails STI）

```
class DerivedModel < BaseModel
end 
```

`DerivedModel`将以良好的 OO 方式继承所有行为`BaseModel`，包括`validates_presence_of :parent_id`. 我想关闭验证`DerivedModel`，并防止触发回调方法，最好不要修改或以其他方式破坏`BaseModel`

最简单、最可靠的方法是什么？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-03-28T08:27:11.643

我喜欢使用以下模式：

```
class Parent < ActiveRecord::Base
  validate_uniqueness_of :column_name, :if => :validate_uniqueness_of_column_name?
  def validate_uniqueness_of_column_name?
    true
  end
end

class Child < Parent
  def validate_uniqueness_of_column_name?
    false
  end
end 
```

如果 rails 提供了一个 skip_validation 方法来解决这个问题，那就太好了，但是这种模式可以很好地处理复杂的交互。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-04-18T11:06:20.417

作为@Jacob Rothstein 答案的变体，您可以在父级中创建一个方法：

```
class Parent < ActiveRecord::Base
  validate_uniqueness_of :column_name, :unless => :child?
  def child?
    is_a? Child
  end
end

class Child < Parent
end 
```

这种方法的好处是您不需要为需要在 Child 类中禁用验证的每个列名创建多个方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T23:45:46.630

通过在源代码中四处寻找（我目前在 rails 1.2.6 上），回调相对简单。

事实证明，如果不使用任何参数调用`before_validation_on_create`, `before_save`etc 方法，将返回包含分配给该“回调站点”的所有当前回调的数组

要清除 before_save 的，你可以简单地做

```
before_save.clear 
```

它似乎工作

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-02-25T20:40:19.887

一种更清洁的方法是：

```
class Parent < ActiveRecord::Base
  validate :column_name, uniqueness: true, if: 'self.class == Parent'
end

class Child < Parent
end 
```

或者你也可以这样使用它：

```
class Parent < ActiveRecord::Base
  validate :column_name, uniqueness: true, if: :check_base

  private

  def check_base
    self.class == Parent
  end
end

class Child < Parent
end 
```

因此，如果模型的实例类是 ，则完成唯一性验证`Parent`。

1.  的实例类`Child` 是`Child` 并且不同于`Parent`。
2.  的实例类`Parent`is`Parent`和 相同`Parent`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-09-14T07:41:07.010

从 Rails 3.0 开始，您还可以访问`validators` [类方法](https://apidock.com/rails/v3.0.0/ActiveModel/Validations/ClassMethods/validators)来操作获取所有验证的列表。但是，您不能通过此 Array 操作验证集。

至少从 rails 5.0 开始，您似乎能够操纵`_validators`（未记录的）方法。

使用此方法，您可以修改子类中的验证，例如：

```
class Child < Parent
  # add additional conditions if necessary
  _validators.reject! { |attribute, _| attribute == :parent_id } 
end 
```

虽然这使用了一个未记录的方法，但它的好处是不需要超类知道任何关于孩子的实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T23:47:38.547

再次在源代码中四处寻找，似乎可以在每次保存时运行验证，或者仅在更新/创建时运行。这映射到

`:validate`=> 所有保存
`:validate_on_create`=> 仅创建
`:validate_on_update`=> 仅更新

要清除它们，您可以使用`write_inheritable_attribute`，如下所示：

```
write_inheritable_attribute :validate, nil 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-30T07:29:08.393

这是我在[mongoid 3](http://mongoid.org/en/mongoid/docs/validation.html)中使用的 RubyDev 的一个细微变化。

```
class Parent
  include Mongoid::Document
  validates :column_name , uniqueness: true, unless: Proc.new {|r| r._type == "Child"}
end

class Child < Parent
end 
```

到目前为止，它对我来说一直很好。

# css - mac上的CSS/表格问题

> ID：279491
> 
> 赞同：1
> 
> 时间：2008-11-10T22:59:16.367
> 
> 标签：css, macos, compatibility, css-tables

我在重新设计的[网站](http://www.artinthepicture.com)上遇到了一些 CSS 和/或表格问题。由于众所周知的“100% div 高度”问题，我使用表格作为网站的结构元素。所以它看起来像这样：

HTML 标记：

```
<div id="header">...</div>
  <table>
  <tr>
    <td><div id="main">...</div></td>
    <td class="crighttd"><div id="cright">...</div></td>
   </tr>
</table>
<div id="footer">...</div> 
```

和相应的 CSS

```
table {
  border-top: 1px solid #6A6A6A;
  padding: 0;
  margin-top: 20px;
  border-spacing: 0
}

td {
  vertical-align: top;
  padding:0;
  margin:0
}

.crighttd {
  background: #4F4F4F;
  vertical-align:top;
  margin: 0
}

#cright {
  width: 185px;
  float: right;
  background: #4F4F4F;
  height: 100%;
  line-height: 1.2em;
  margin: 0;
  padding: 25px 0 25px 20px;
} 
```

这里的问题是，显然右侧的 td 在某些浏览器中根本不会显示（在 Mac 以及旧的 IE 实例上都看到过）。这是 CSS 问题还是表格的问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T23:08:44.163

> 由于众所周知的“100% div 高度”问题……</p>

那会是哪一个？[在这里](http://www.xs4all.nl/~peterned/examples/csslayout1.html)解决的？基本上，重要的部分是

```
html, body {
    height: 100%;
} 
```

作为一种解决方法的表格在这里是不行的，因为据我所知，它们在高度方面有类似的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T09:06:04.737

我敢肯定，仅通过 CSS 定位和布局就可以完全实现您想要实现的目标，而无需借助表格进行布局。

听起来好像这些表格无论如何都不起作用，所以选择纯 CSS 布局，不仅您可能会找到解决方案，而且您还将拥有一个更符合标准、符合标准的网站，这将更容易实现在未来保持和改变。

据我所知，您的目标是一个相当简单的固定宽度、居中、两列布局。在 Google 上快速搜索“2 列 css 布局”将为您提供大量示例和教程，说明您可以用来实现此目的的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T23:08:36.737

对于故障排除，我通常给我的 div 和其他元素一个边框，以便我可以直观地看到它们在页面上的位置。

```
border: 1px solid red; 
```

我怀疑不是您的 td 没有显示，而是您在其中的 div 。您可以尝试在 css 中设置它的显示属性。

```
position: relative; 
```

您还可以尝试从 #cright 样式中删除 float 属性。

*这些不一定能解决您的问题，而只是有关如何排除故障的建议。如果不查看页面的完整布局，很难实际解决问题。*

# php - phpunit 避免模拟的构造函数参数

> ID：279493
> 
> 赞同：90
> 
> 时间：2008-11-10T23:00:46.690
> 
> 标签：php, unit-testing, phpunit

避免 phpunit 必须调用模拟对象的构造函数的方法是什么？否则我需要一个模拟对象作为构造函数参数，另一个用于那个等等。api似乎是这样的：

```
getMock($className, $methods = array(), array $arguments = array(),
        $mockClassName = '', $callOriginalConstructor = TRUE,
        $callOriginalClone = TRUE, $callAutoload = TRUE) 
```

我不让它工作。`$callOriginalConstructor`即使设置为 false ，它仍然会抱怨构造函数参数。

我在构造函数中只有一个对象，它是一个依赖注入。所以我认为我在那里没有设计问题。

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2011-06-08T10:11:39.187

您可以使用`getMockBuilder`，而不仅仅是`getMock`：

```
$mock = $this->getMockBuilder('class_name')
    ->disableOriginalConstructor()
    ->getMock(); 
```

有关详细信息，请参阅[PHPUnit 文档中的](http://phpunit.de/manual)“[测试替身”](http://phpunit.de/manual/current/en/test-doubles.html)部分。

虽然你可以这样做，但最好不要这样做。您可以重构您的代码，而不是需要注入一个具体的类（带有构造函数），您只依赖于一个接口。这意味着您可以模拟或存根接口，而无需告诉 PHPUnit 修改构造函数行为。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-03-09T22:38:29.930

干得好：

```
 // Get a Mock Soap Client object to work with.
    $classToMock = 'SoapClient';
    $methodsToMock = array('__getFunctions');
    $mockConstructorParams = array('fake wsdl url', array());
    $mockClassName = 'MyMockSoapClient';
    $callMockConstructor = false;
    $mockSoapClient = $this->getMock($classToMock,
                                     $methodsToMock,
                                     $mockConstructorParams,
                                     $mockClassName,
                                     $callMockConstructor); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2020-05-04T15:32:59.487

这个问题有点老了，但是对于新访问者，你可以使用`createMock`方法（之前`createTestDouble`在v5.4.0中调用和引入）来完成。

```
$mock = $this->createMock($className); 
```

正如您在下面从`PHPUnit\Framework\TestCase`类中提取的代码（in `phpunit/src/framework/TestCase.php`）中看到的那样，**它基本上会创建一个模拟对象而不调用原始构造函数**。

```
/** PHPUnit\Framework\TestCase::createMock method */
protected function createMock(string $originalClassName): MockObject
{
    return $this->getMockBuilder($originalClassName)
                ->disableOriginalConstructor()
                ->disableOriginalClone()
                ->disableArgumentCloning()
                ->disallowMockingUnknownTypes()
                ->getMock();
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-03-08T02:21:53.233

作为附录，我想将`expects()`调用附加到我的模拟对象，然后调用构造函数。在 PHPUnit 3.7.14 中，调用时返回`disableOriginalConstructor()`的对象实际上是一个对象。

```
// Use a trick to create a new object of a class
// without invoking its constructor.
$object = unserialize(
sprintf('O:%d:"%s":0:{}', strlen($className), $className) 
```

不幸的是，在 PHP 5.4 中有一个他们没有使用的新选项：

[ReflectionClass::newInstanceWithoutConstructor](http://php.net/manual/en/reflectionclass.newinstancewithoutconstructor.php)

由于这不可用，我不得不手动反映该类，然后调用构造函数。

```
$mock = $this->getMockBuilder('class_name')
    ->disableOriginalConstructor()
    ->getMock();

$mock->expect($this->once())
    ->method('functionCallFromConstructor')
    ->with($this->equalTo('someValue'));

$reflectedClass = new ReflectionClass('class_name');
$constructor = $reflectedClass->getConstructor();
$constructor->invoke($mock); 
```

请注意， if `functionCallFromConstruct`is `protected`，您必须特别使用才能`setMethods()`模拟受保护的方法。例子：

```
 $mock->setMethods(array('functionCallFromConstructor')); 
```

`setMethods()`必须在调用之前`expect()`调用。就个人而言，我在之后`disableOriginalConstructor()`但之前将其链接起来`getMock()`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-07-21T07:37:09.843

或者，您可以向[getMock](https://damienflament.github.io/phpunit-mock-objects-api-docs/4.0.0/PHPUnit_Framework_MockObject_Generator.html#method_getMock)添加一个参数以防止调用默认构造函数。

```
$mock = $this->getMock(class_name, methods = array(), args = array(), 
        mockClassName = '', callOriginalConstructor = FALSE); 
```

不过，我认为 dave1010 的答案看起来更好，这只是为了完整性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-01T22:30:16.410

也许您需要创建一个存根作为构造函数参数传入。然后你可以打破这个模拟对象链。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T21:08:18.367

PHPUnit 旨在调用模拟对象的构造函数；为防止这种情况，您应该：

1.  将模拟对象作为依赖项注入到您无法模拟的对象中
2.  创建一个测试类，扩展您尝试调用的不调用父构造函数的类

# c# - .Net - 在函数中引用时需要 15 秒才能加载互操作程序集

> ID：279495
> 
> 赞同：1
> 
> 时间：2008-11-10T23:01:00.777
> 
> 标签：c#, .net, com-interop

这是一个 C# 控制台应用程序。我有一个功能可以做这样的事情：

```
static void foo()
{
       Application powerpointApp;
       Presentation presentation = null;

       powerpointApp = new Microsoft.Office.Interop.PowerPoint.ApplicationClass();
} 
```

这就是它所做的一切。当它被调用时，在函数被命中之前有 15 秒的延迟。我添加了这样的内容：

```
static void MyAssemblyLoadEventHandler(object sender, AssemblyLoadEventArgs args)
{
       Console.WriteLine(DateTime.Now.ToString() + " ASSEMBLY LOADED: " + args.LoadedAssembly.FullName);
       Console.WriteLine();
} 
```

这被触发告诉我我的互操作程序集在我的 foo 函数被命中之前大约 10 毫秒已加载。我能做些什么呢？该程序需要调用此函数（并最终执行其他操作）一次然后退出，因此我需要缓存这些程序集或其他东西。想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T09:58:03.743

它可能是证书吊销列表 - 超时为 15 秒。事件日志中有任何内容吗？您能否检查超时期间是否有任何网络连接发生？

不久前，[我在博客上写了一些有关证书吊销延迟的详细信息。](http://blogs.conchango.com/anthonysteele/archive/2007/02/07/Delay-when-starting-up-a-web-service.aspx)点开链接，这里我就不剪贴了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T09:51:41.710

15 秒对我来说听起来像是超时。你在签署你的程序集吗？我们遇到了一个问题，框架想要在加载时检查证书吊销列表，但在 15 秒后失败。

高温高压

蒂姆

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-24T04:40:20.253

```
<runtime>

   <generatePublisherEvidence enabled="false"/>

</runtime> 
```

详情见这里

[http://msdn.microsoft.com/en-us/library/bb629393.aspx](http://msdn.microsoft.com/en-us/library/bb629393.aspx)

“我们建议服务使用该元素来提高启动性能。使用该元素还可以帮助避免可能导致超时和取消服务启动的延迟。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T23:04:59.413

只是猜测，但可能是在加载互操作程序集后启动 PowerPoint 的时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T22:46:31.273

如果在应用程序启动时没有调用方法 foo() 并且在调用它之前您还有一些其他任务要做，您可以在开始时启动一个单独的线程来加载程序集。

# windows - 文件路径可移植性

> ID：279500
> 
> 赞同：1
> 
> 时间：2008-11-10T23:03:01.537
> 
> 标签：windows, unix, portability, filepath

我有一个需要在 *nix 和 windows 下运行的程序。因为程序从文件中获取文件路径，所以问题是如何处理`\`vs`/`问题。

我目前的想法是放入一个正则表达式，根据我使用的系统将错误的转换为正确的。这将具有让任一类型在任一系统上工作的效果。除了[现在我有两个问题](http://fishbowl.pastiche.org/2003/08/18/beware_regular_expressions/)之外，还有人看到其他问题吗？

（非常欢迎其他更好的解决方案）

编辑：主要问题是让 Windows 路径在 unix 上工作，而不是相反。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T23:04:14.407

/ 在 win32 中也完全支持。

另请参阅此[相关问题](https://stackoverflow.com/questions/122455/handling-file-paths-cross-platform)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T23:04:56.900

Windows 通常会接受 \ 或 /，因此只要您完全控制文件名，对 / 进行标准化可能会使您的问题更简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T23:06:37.583

您是否考虑过创建一个“文件管理器”类来为您处理所有文件路径问题？这样，在您的邮件应用程序中，当您加载数据文件时，您可以调用类似这样的内容。

```
LoadApplicationData(FileManager.GetDataFilePath) 
```

然后您的文件管理器将检测它所在的环境并返回正确的文件路径选项。这样，您也可以适应 Win32 与 Unix 位置标准（如 Program Files 与 /usr 或其他）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T23:45:04.743

请注意，当您考虑驱动器号（在 Unix 上没有模拟）和特殊的“分叉”（MacOS pre-X 术语 - 通常在 Unix 上也没有模拟，尽管 MacOS X 有它们 - 惊喜，惊喜）时，Win32 路径是复杂的提供。当心。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T23:58:54.310

为您的输入创建一个解析器，以创建表示目录的节点的树结构。然后，您可以通过遍历树并编写您想要的任何分隔符或可选地执行不同的操作来“保存”，例如检查目录是否存在或编写元文件。这实际上是我现在认为对我自己的应用程序有用的东西:-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T00:23:24.667

你没有说你使用的是什么语言，所以我会自私地假设 c/c++。 [boost](http://www.boost.org)，如果你愿意使用它，有一个[文件系统库](http://www.boost.org/doc/libs/1_37_0/libs/filesystem/doc/index.htm)。当然，如果您使用的是动态语言，FS 抽象库可能也已经存在（例如在 perl 中，File::Spec 是相当标准的）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-12-06T17:37:19.260

您还没有告诉我们您正在从中读取路径的文件类型。我将假设它们是配置文件。在这种情况下，有很多方法，恕我直言，正确的答案是设计您的程序以避免操纵路径，如果可能的话。我在这里发布了一个答案：[https](https://stackoverflow.com/a/40980510/2345997) ://stackoverflow.com/a/40980510/2345997这是相关的。

**方法：**

1.  添加一个命令行选项，允许用户指定有问题的路径，而不是从配置文件中读取它。
2.  添加命令行选项，以便用户可以指定基本路径。配置文件中的路径将被解释为位于此基本路径下。
3.  将您的配置文件分成三个。一个文件将具有跨平台配置，另一个文件将具有仅 Windows 配置，最终文件将具有仅 Linux 配置。然后用户可以为 Windows 和 Linux 指定正确的路径。在 Windows 上，您的程序将读取跨平台配置文件和仅限 Windows 的配置文件。在 Linux 上，它将读取跨平台文件和仅限 Linux 的配​​置文件。
4.  将预处理添加到您的配置文件解析中。这将允许您拥有一个配置文件，用户可以在其中使您的程序忽略文件中的某些行，具体取决于程序在哪个操作系统上运行。因此，用户将能够两次指定文件的路径。一次用于 Linux，一次用于 Windows。
5.  更改设计，使文件始终与可执行文件位于同一目录中 - 然后用户仅在配置文件中指定文件名而不是文件路径。
6.  使用将“/”切换为“\”的简单函数。然后向用户记录他们必须将路径指定为 Linux 路径，并且此转换将应用于 Windows。
7.  为此创建您自己的路径迷你语言并将其记录给用户。例如：“/” - 指定目录分隔符，{root} - 展开到文件系统的根目录，{cwd} - 展开到当前目录，{app} - 展开到您的应用程序的路径等...然后用户可以在两个平台上指定文件路径，例如：{root}/myfiles/bob.txt。
8.  一些路径将在两个平台上都有效。例如：相对路径，如 ../my files/bill.txt。限制您的应用程序仅使用这些路径。记录此限制以及您的应用程序如何处理用户的路径。

# java - 不可变是什么意思？

> ID：279507
> 
> 赞同：416
> 
> 时间：2008-11-10T23:05:26.150
> 
> 标签：java, string, immutability

这可能是有史以来最愚蠢的问题，但我认为这对于 Java 新手来说是相当混乱的。

1.  有人可以澄清什么是*不可变*的吗？
2.  为什么是`String`不可变的？
3.  不可变对象的优点/缺点是什么？
4.  为什么像 String 这样的可变对象`StringBuilder`应该优先于 String ，反之亦然？

一个很好的例子（在Java中）将不胜感激。

* * *

## 回答 #1

> 赞同：276
> 
> 时间：2008-11-10T23:11:48.477

不可变意味着一旦对象的构造函数完成执行，该实例就无法更改。

这很有用，因为它意味着您可以传递对对象的引用，而不必担心其他人会更改其内容。*特别是在处理并发时，永远不会改变的对象不存在锁定问题*

例如

```
class Foo
{
     private final String myvar;

     public Foo(final String initialValue)
     {
         this.myvar = initialValue;
     }

     public String getValue()
     {
         return this.myvar;
     }
} 
```

`Foo`不必担心调用者`getValue()`可能会更改字符串中的文本。

如果您想象一个与 类似的类`Foo`，但使用 a`StringBuilder`而不是 a`String`作为成员，您可以看到调用者 to`getValue()`将能够更改实例的`StringBuilder`属性。`Foo`

还要注意您可能会发现的不同类型的不变性：Eric Lippert 写了一篇关于此的[博客文章](https://docs.microsoft.com/archive/blogs/ericlippert/immutability-in-c-part-one-kinds-of-immutability)。基本上，您可以拥有其接口不可变但在幕后实际可变私有状态的对象（因此不能在线程之间安全共享）。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2009-08-10T07:22:20.413

不可变对象是内部字段（或至少影响其外部行为的所有内部字段）无法更改的对象。

不可变字符串有很多优点：

**性能：**进行如下操作：

```
String substring = fullstring.substring(x,y); 
```

substring() 方法的底层 C 可能是这样的：

```
// Assume string is stored like this:
struct String { char* characters; unsigned int length; };

// Passing pointers because Java is pass-by-reference
struct String* substring(struct String* in, unsigned int begin, unsigned int end)
{
    struct String* out = malloc(sizeof(struct String));
    out->characters = in->characters + begin;
    out->length = end - begin;
    return out;
} 
```

请注意，*无需复制任何字符！* 如果 String 对象是可变的（字符可以稍后更改），那么您必须复制所有字符，否则对子字符串中字符的更改将在稍后反映在另一个字符串中。

**并发性：**如果一个不可变对象的内部结构是有效的，那么它将永远是有效的。不同的线程不可能在该对象中创建无效状态。因此，不可变对象是*线程安全*的。

**垃圾收集：**垃圾收集器对不可变对象做出逻辑决策要容易得多。

但是，不变性也有缺点：

**性能：**等等，我以为你说性能是不变性的一个优点！嗯，有时是，但并非总是如此。采取以下代码：

```
foo = foo.substring(0,4) + "a" + foo.substring(5);  // foo is a String
bar.replace(4,5,"a"); // bar is a StringBuilder 
```

这两行都用字母“a”替换了第四个字符。第二段代码不仅更具可读性，而且速度更快。看看你将如何为 foo 做底层代码。子字符串很简单，但是现在因为在空格 5 处已经有一个字符并且其他东西可能正在引用 foo，所以你不能只更改它；您必须复制整个字符串（当然，其中一些功能被抽象为真正的底层 C 中的函数，但这里的重点是显示在一个地方执行的代码）。

```
struct String* concatenate(struct String* first, struct String* second)
{
    struct String* new = malloc(sizeof(struct String));
    new->length = first->length + second->length;

    new->characters = malloc(new->length);

    int i;

    for(i = 0; i < first->length; i++)
        new->characters[i] = first->characters[i];

    for(; i - first->length < second->length; i++)
        new->characters[i] = second->characters[i - first->length];

    return new;
}

// The code that executes
struct String* astring;
char a = 'a';
astring->characters = &a;
astring->length = 1;
foo = concatenate(concatenate(slice(foo,0,4),astring),slice(foo,5,foo->length)); 
```

请注意， concatenate 被调用**了两次**，这意味着必须循环遍历整个字符串！将此与`bar`操作的 C 代码进行比较：

```
bar->characters[4] = 'a'; 
```

可变字符串操作显然要快得多。

**结论：**在大多数情况下，您需要一个不可变的字符串。但是，如果您需要对字符串进行大量附加和插入操作，则需要可变性以提高速度。如果你想要并发安全和垃圾收集的好处，关键是让你的可变对象保持在方法的本地：

```
// This will have awful performance if you don't use mutable strings
String join(String[] strings, String separator)
{
    StringBuilder mutable;
    boolean first = true;

    for(int i = 0; i < strings.length; i++)
    {
        if(!first) first = false;
        else mutable.append(separator);

        mutable.append(strings[i]);
    }

    return mutable.toString();
} 
```

由于该`mutable`对象是本地引用，因此您不必担心并发安全性（只有一个线程接触过它）。而且由于它没有在其他任何地方引用，它只在堆栈上分配，所以一旦函数调用完成它就会被释放（你不必担心垃圾收集）。您可以获得可变性和不变性的所有性能优势。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-02-04T17:34:30.590

如果您使用上面建议的维基百科定义，实际上 String 不是不可变的。

字符串的状态确实会改变构建后的状态。看一下 hashcode() 方法。String 将 hashcode 值缓存在本地字段中，但直到第一次调用 hashcode() 时才计算它。这种对哈希码的惰性求值将 String 作为一个状态发生变化的不可变对象置于一个有趣的位置，但如果不使用反射就无法观察到它发生了变化。

所以也许不可变的定义应该是一个不能被观察到已经改变的对象。

如果一个不可变对象在创建后状态发生变化，但没有人可以看到它（没有反射），那么该对象仍然是不可变的吗？

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-11-10T23:20:11.940

不可变对象是不能以编程方式更改的对象。它们特别适用于多线程环境或其他多个进程能够更改（变异）对象中的值的环境。

然而，澄清一下，StringBuilder 实际上是一个可变对象，而不是不可变对象。常规的 java String 是不可变的（这意味着一旦创建它，​​您就不能在不更改对象的情况下更改底层字符串）。

例如，假设我有一个名为 ColoredString 的类，它有一个字符串值和一个字符串颜色：

```
public class ColoredString {

    private String color;
    private String string;

    public ColoredString(String color, String string) {
        this.color  = color;
        this.string = string;
    }

    public String getColor()  { return this.color;  }
    public String getString() { return this.string; }

    public void setColor(String newColor) {
        this.color = newColor;
    }

} 
```

在此示例中，ColoredString 被称为是可变的，因为您可以更改（变异）其关键属性之一，而无需创建新的 ColoredString 类。这可能不好的原因是，例如，假设您有一个具有多个线程的 GUI 应用程序，并且您正在使用 ColoredStrings 将数据打印到窗口。如果您有一个创建为 ColoredString 的实例

```
new ColoredString("Blue", "This is a blue string!"); 
```

然后你会期望字符串总是“蓝色”。然而，如果另一个线程得到了这个实例并调用了

```
blueString.setColor("Red"); 
```

当您想要一个“蓝色”字符串时，您会突然（并且可能出乎意料地）现在有一个“红色”字符串。因此，在传递对象实例时，几乎总是首选不可变对象。当您遇到真正需要可变对象的情况时，您通常会通过仅从您的特定控制领域传递副本来保护对象。

回顾一下，在 Java 中，java.lang.String 是一个不可变对象（一旦创建*就不能*更改），而 java.lang.StringBuilder 是一个可变对象，因为它可以在不创建新实例的情况下更改。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2015-07-18T17:03:45.083

1.  在大型应用程序中，字符串文字通常会占用大量内存。因此，为了有效地处理内存，JVM 分配了一个称为“字符串常量池”的区域。（[请注意，在内存中，即使是未引用的字符串也带有一个 char[]，一个 int 表示它的长度，另一个表示它的 hashCode。对于一个数字，相比之下，最多需要八个立即字节](https://stackoverflow.com/questions/20394116/java-why-is-constant-pool-maintained-only-for-string-values)）
2.  当编译器遇到字符串文字时，它会检查池以查看是否已经存在相同的文字。如果找到一个，则对新文字的引用将定向到现有字符串，并且不会创建新的“字符串文字对象”（现有字符串只是获得额外的引用）。
3.  因此：**字符串可变性节省了内存......**
4.  但是，当任何变量的值发生变化时，实际上 - 只是它们的引用发生了变化，而不是内存中的值（因此它不会影响引用它的其他变量），如下所示......

* * *

字符串 s1 = "旧字符串";

```
//s1 variable, refers to string in memory
        reference                 |     MEMORY       |
        variables                 |                  |

           [s1]   --------------->|   "Old String"   | 
```

字符串 s2 = s1;

```
//s2 refers to same string as s1
                                  |                  |
           [s1]   --------------->|   "Old String"   |
           [s2]   ------------------------^ 
```

s1 = "新字符串";

```
//s1 deletes reference to old string and points to the newly created one
           [s1]   -----|--------->|   "New String"   |
                       |          |                  |
                       |~~~~~~~~~X|   "Old String"   |
           [s2]   ------------------------^ 
```

> 原始字符串'in memory'没有改变，但是引用变量被改变了，所以它引用了新的字符串。如果我们没有 s2，“旧字符串”仍会在内存中，但我们将无法访问它......

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-11-10T23:08:36.317

“不可变”意味着你不能改变价值。如果您有一个 String 类的实例，那么您调用的任何似乎修改值的方法实际上都会创建另一个 String。

```
String foo = "Hello";
foo.substring(3);
<-- foo here still has the same value "Hello" 
```

要保留更改，您应该执行以下操作 foo = foo.sustring(3);

当您使用集合时，不可变与可变可能会很有趣。想想如果你使用可变对象作为 map 的键然后改变值会发生什么（提示：想想`equals`and `hashCode`）。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2016-06-12T15:44:09.123

# java.time

可能有点晚了，但为了理解什么是不可变对象，请考虑以下来自新 Java 8 日期和时间 API ( [java.time](http://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html) ) 的示例。您可能知道 Java 8 中的所有日期对象都是**不可变**的，因此在以下示例中

```
LocalDate date = LocalDate.of(2014, 3, 18); 
date.plusYears(2);
System.out.println(date); 
```

输出：

> 2014-03-18

这将打印与初始日期相同的年份，因为它`plusYears(2)`返回一个新对象，因此旧日期仍然不变，因为它是一个不可变对象。一旦创建，您将无法进一步修改它，并且日期变量仍然指向它。

因此，该代码示例应捕获并使用该调用实例化并返回的新对象`plusYears`。

```
LocalDate date = LocalDate.of(2014, 3, 18); 
LocalDate dateAfterTwoYears = date.plusYears(2); 
```

> date.toString()…2014-03-18
> 
> dateAfterTwoYears.toString()…2016-03-18

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-11-11T00:33:23.663

我真的很喜欢[SCJP Sun Certified Programmer for Java 5 Study Guide](https://rads.stackoverflow.com/amzn/click/com/0072253606)的解释。

> 为了提高 Java 的内存效率，JVM 预留了一个特殊的内存区域，称为“字符串常量池”。当编译器遇到字符串字面量时，它会检查池以查看是否已经存在相同的字符串。如果找到匹配项，则对新文字的引用将定向到现有字符串，并且不会创建新的字符串文字对象。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-11-11T11:05:32.843

不可变对象在创建后不能更改其状态。

尽可能使用不可变对象有三个主要原因，所有这些都将有助于减少您在代码中引入的错误数量：

*   当你知道一个对象的状态不能被另一个方法改变时，你的程序是如何工作的就更容易推理了
*   不可变对象是自动线程安全的（假设它们是安全发布的），因此永远不会成为那些难以确定的多线程错误的原因
*   不可变对象将始终具有相同的 Hash 代码，因此它们可以用作 HashMap（或类似）中的键。如果哈希表中某个元素的哈希码发生变化，那么表项实际上会丢失，因为在表中查找它的尝试最终会在错误的位置查找。这是 String 对象不可变的主要原因——它们经常用作 HashMap 键。

当您知道对象的状态是不可变的时，您还可以在代码中进行其他一些优化——例如缓存计算的哈希值——但这些都是优化，因此几乎没有那么有趣。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-11-10T23:11:34.953

一个含义与值如何存储在计算机中有关，例如.Net字符串，这意味着内存中的字符串无法更改，当您认为要更改它时，实际上是在创建一个新的内存中的字符串并将现有变量（它只是指向其他地方的实际字符集合的指针）指向新字符串。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2017-04-25T07:45:46.943

```
String s1="Hi";
String s2=s1;
s1="Bye";

System.out.println(s2); //Hi  (if String was mutable output would be: Bye)
System.out.println(s1); //Bye 
```

`s1="Hi"`：`s1`创建了一个带有“Hi”值的对象。

`s2=s1` :`s2`参照 s1 对象创建对象。

`s1="Bye"`: 前一个`s1`对象的值不会改变，因为`s1`它具有 String 类型并且 String 类型是不可变类型，而是编译器创建一个具有“Bye”值的新 String 对象并`s1`引用它。在这里，当我们打印`s2`值时，结果将是“Hi”而不是“Bye”，因为`s2`引用了`s1`具有“Hi”值的先前对象。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-10T23:07:53.400

不可变意味着一旦对象被创建，它的所有成员都不会改变。`String`是不可变的，因为您无法更改其内容。例如：

```
String s1 = "  abc  ";
String s2 = s1.trim(); 
```

在上面的代码中，字符串 s1 没有改变，另一个对象 ( `s2`) 是使用`s1`.

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2018-07-17T07:55:41.113

不可变只是意味着不可更改或不可修改。一旦创建了字符串对象，它的数据或状态就不能改变

考虑下面的例子，

```
class Testimmutablestring{  
  public static void main(String args[]){  
    String s="Future";  
    s.concat(" World");//concat() method appends the string at the end  
    System.out.println(s);//will print Future because strings are immutable objects  
  }  
 } 
```

让我们考虑一下下面的图表，

[![在此处输入图像描述](https://i.stack.imgur.com/8uIrk.png)](https://i.stack.imgur.com/8uIrk.png)

在此图中，您可以看到创建为“未来世界”的新对象。但不能改变“未来”。`Because String is immutable`. `s`，仍指“未来”。如果你需要调用“未来世界”，

```
String s="Future";  
s=s.concat(" World");  
System.out.println(s);//print Future World 
```

**为什么字符串对象在java中是不可变的？**

> 因为Java使用了字符串字面量的概念。假设有5个引用变量，都指向一个对象“Future”。如果一个引用变量改变了对象的值，就会影响到所有的引用变量。这就是为什么字符串对象在 java 中是不可变的。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-10T23:07:04.743

一经实例化，不可更改。考虑一个类，它的实例可能用作哈希表或类似的键。查看 Java 最佳实践。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-05-07T02:24:42.953

由于接受的答案并不能回答所有问题。11年零6个月后，我不得不给出答案。

> 有人可以澄清不可变的含义吗？

希望您的意思是*不可变对象*（因为我们可以考虑*不可变引用*）。

一个对象是*不可变*的：如果一旦创建，它们总是代表相同的值（没有任何改变值的方法）。

> 为什么是`String`不可变的？

尊重上面的定义，可以通过查看[Sting.java](http://hg.openjdk.java.net/jdk7u/jdk7u6/jdk/file/8c2c5d63a17e/src/share/classes/java/lang/String.java)源代码来检查。

> 不可变对象的优点/缺点是什么？不可变类型是：

*   远离错误更安全。

*   更容易理解。

*   并且为改变做好准备。

> 为什么像 StringBuilder 这样的可变对象比 String 更受欢迎，反之亦然？

缩小问题范围*为什么我们在编程中需要可变的 StringBuilder？* 它的一个常见用途是将大量字符串连接在一起，如下所示：

```
String s = "";
for (int i = 0; i < n; ++i) {
    s = s + n;
} 
```

使用不可变字符串，这会产生很多临时副本——字符串的第一个数字（“0”）实际上在构建最终字符串的过程中被复制了 n 次，第二个数字被复制了 n-1 次，所以在。尽管我们只连接了 n 个元素，但实际上只做所有的复制就需要 O(n2) 时间。

StringBuilder 旨在最大限度地减少这种复制。它使用一个简单但巧妙的内部数据结构来避免进行任何复制，直到最后，当您通过 toString() 调用请求最终 String 时：

```
StringBuilder sb = new StringBuilder();
for (int i = 0; i < n; ++i) {
  sb.append(String.valueOf(n));
}
String s = sb.toString(); 
```

获得良好的性能是我们使用可变对象的原因之一。另一个是方便的共享：通过共享一个通用的可变数据结构，您的程序的两个部分可以更方便地进行通信。

更多可以在这里找到：[https ://web.mit.edu/6.005/www/fa15/classes/09-immutability/#useful_immutable_types](https://web.mit.edu/6.005/www/fa15/classes/09-immutability/#useful_immutable_types)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-07-05T09:08:39.777

**不可变对象**

如果一个对象在构造后它的状态不能改变，那么它就被认为是不可变的。最大限度地依赖不可变对象被广泛认为是创建简单、可靠代码的合理策略。

不可变对象在并发应用程序中特别有用。由于它们无法更改状态，因此它们不会被线程干扰破坏或观察到不一致的状态。

程序员通常不愿意使用不可变对象，因为他们担心创建新对象而不是就地更新对象的成本。对象创建的影响通常被高估，并且可以被与不可变对象相关的一些效率所抵消。这些包括由于垃圾收集而减少的开销，以及消除保护可变对象免受损坏所需的代码。

以下小节采用实例可变的类，并从中派生具有不可变实例的类。通过这样做，他们给出了这种转换的一般规则，并展示了不可变对象的一些优点。

[来源](https://docs.oracle.com/javase/tutorial/essential/concurrency/immutable.html)

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-11-11T00:39:05.557

不可变对象是在创建后无法修改的对象。一个典型的例子是字符串文字。

越来越流行的AD编程语言通过“invariant”关键字具有“不变性”的概念。查看 Dr.Dobb 的这篇文章 - [http://dobbscodetalk.com/index.php?option=com_myblog&show=Invariant-Strings.html&Itemid=29](http://dobbscodetalk.com/index.php?option=com_myblog&show=Invariant-Strings.html&Itemid=29)。它完美地解释了这个问题。

# java - 我可以使用 jmock 替换工厂返回的实现吗？

> ID：279514
> 
> 赞同：1
> 
> 时间：2008-11-10T23:07:48.690
> 
> 标签：java, unit-testing, interface, mocking

我有一个返回接口的工厂`FormatService`：

```
public class FormatServiceFactory {
    public FormatService getService() {
        ...
    }
} 
```

是否可以模拟这个工厂，以便它在我们的单元测试中 始终返回`FormatService`-的存根实现？`FormatServiceStub`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T23:50:04.063

依靠。被测代码如何获取/使用工厂？

如果它在您正在测试的方法中显式实例化，或者它是一个静态工厂，您将无法模拟它。

如果它被注入到被测对象中，您可以在执行测试之前创建并注入模拟工厂。

使用 JMock 模拟工厂应该很容易。从您的示例代码中，它看起来像是一个类，而不是一个接口，因此您需要使用 JMock 的 cglib 版本和JMock 1 的 cglib 包中的[MockObjectTestCase类，或者 JMock 2 的](http://www.jmock.org/jmock1-cglib.html)[ClassImposteriser](http://www.jmock.org/mocking-classes.html)。

一旦被模拟，当您定义 getService() 方法的期望时，您可以让它返回您的存根实现（甚至是模拟 FormatService）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-21T08:43:54.780

嘲讽嘲讽 = new JUnit4Mockery() {{setImposteriser(ClassImposteriser.INSTANCE);}};

final FormatServiceFactory factory = mockery.mock(FormatServiceFactory .class);

context.checking(new Expectations() {{ oneOf (factory).getService(); will(returnValue(new FormatServiceMock())); }});

# c# - 调试 C# 自定义安装程序类

> ID：279523
> 
> 赞同：28
> 
> 时间：2008-11-10T23:12:54.950
> 
> 标签：c#, .net, installation

我编写了一个扩展安装程序并覆盖 afterInstall 的安装类，但我得到一个空指针异常。我该如何调试我的课程？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-11-11T06:29:45.787

Something that is handy for hard to debug sections of code is

```
System.Diagnostics.Debugger.Break() 
```

Will throw a breakpoint caught by any installed debugger (VStudio, WinDbg, Remote debugger etc...).

Use it to debug really tricky areas where regular F5+Go or "Attach to Process" is difficult or impossible to perform, some examples include:

*   short-lived processes
*   time-sensitive processes
*   breaking into spawned sub-processes
*   installers
*   service stop/start
*   distributed systems

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-02-04T01:53:49.477

很惊讶没有人真正回答。将 MessageBox.Show("hello") 放入自定义操作的 Install() 成员中。在调试配置中构建部署。安装。当 MessageBox 出现时，进入 VS IDE、Debug、Attach Process 并查找标记为“Managed”的 msiexec 实例。将调试器附加到该 msiexec 实例。现在回到自定义操作的源并在调用 MessageBox.Show() 之后放置一个断点。关闭 MessageBox，您的断点将被命中，您正在 IDE 中进行调试！

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-04-23T23:45:59.037

我发现最好的方法是编写一个单元测试，然后从你的单元测试中新建和初始化你的安装程序类：

```
[TestClass] public class InstallerTest {
[TestMethod]
public void InstallTest() {
  // substitute with your installer component here
  DataWarehouseInstall installer = new DataWarehouseInstall();

  string assemblyDirectory = Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location);

  string installLogFilePath = Path.Combine(assemblyDirectory, "install.log");
  installer.Context = new System.Configuration.Install.InstallContext(installLogFilePath, null);      

  // Refactor to set any parameters for your installer here
  installer.Context.Parameters.Add("Server", ".");
  //installer.Context.Parameters.Add("User", "");
  //installer.Context.Parameters.Add("Password", "");
  installer.Context.Parameters.Add("DatabaseName", "MyDatabaseInstallMsiTest");
  //installer.Context.Parameters.Add("DatabasePath", "");

  // Our test isn't injecting any save state so we give a default instance for the stateSaver
  installer.Install(new Hashtable());
} } 
```

至少这样它可以更好地利用 IDE 工具。这对于具有大量组件的大型安装程序特别有用。然后，您还可以创建有序的单元测试并按顺序运行它们，以在调试或自动构建期间模仿您的安装程序。

另一个技巧是通用的 SOLID/GRASS 软件原则......在整洁/薄层中开发，保持您实际的“自定义操作”安装程序逻辑非常简单，而是调用您拥有的任何可重用的 API 内容，这些内容特定于您的安装程序，就像我们习惯于 UI 开发一样。（无论如何，安装程序只是另一个 UI。）如果您的目标是在产品的所有安装程序之间共享某种 UI 体验，这一点尤其重要。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-11T06:21:00.280

attach the installer process to Visual studio in Debug->Processes->Attach or CTRL + ALT + P set the breakpoint and you should be able to go

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-02-27T11:27:11.763

在您的安装程序方法中添加 Debugger.Launch() 语句，它将启动“Visual Studio 即时调试器”，您可以在其中附加一个 Visual Studio 实例并调试您的安装程序类 (MSI)。这也应该在 Visual Studio 2010 中工作。但是您需要具有管理权限才能执行此操作。如果您没有管理权限，您可能会遇到问题。因此，请以管理员身份登录以调试 MSI。例如：

```
public override void Install(System.Collections.IDictionary stateSaver)
{
    Debugger.Launch();
    base.Install(stateSaver);

} 
```

在 Visual Studio 2005 中，即使 Debugger.Break() 也可以正常工作，但不知何故这不适用于 Visual Studio 2010。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-08-01T12:57:51.517

这实际上对我有用。

```
System.Diagnostics.Debugger.Launch(); 
```

然后右键单击安装程序项目并按“安装”

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-07-27T10:49:29.840

以上都不适合我。这才是真正起作用的。请注意，您需要插入“两行”。

```
using System.Diagnostics;

MessageBox.Show("Test is about to begin");
Debugger.Launch(); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-23T11:38:40.497

我使用 EventLog.WriteEntry("source", "message")，并在安装时检查 EventLog。也许不是最佳的，但对我有用:)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-03-24T12:54:42.313

在要调试的方法的开头编写以下代码

```
#if DEBUG
MessageBox.Show(Process.GetCurrentProcess().Id.ToString());
#endif 
```

因此，当您的方法被调用时，上面的代码将被命中，然后您可以使用上面的进程 ID 将调试器附加到进程（ctrl+alt+p）。您可能必须以提升的权限启动 VS。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-18T20:46:06.603

我使用以下类将一个简单的日志写入目标目录。在我看来，这比尝试使用 Visual Studio 调试器更容易。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;

namespace MyCompany.Deployment
{
    /// <summary>
    /// Enables a quick and easy method of debugging custom actions.
    /// </summary>
    class LogFile
    {
        const string FileName = "MyCompany.Deployment.log";
        readonly string _filePath;

        public LogFile(string primaryOutputPath)
        {
            var dir = Path.GetDirectoryName(primaryOutputPath);
            _filePath = Path.Combine(dir, FileName);
        }

        public void Print(Exception ex)
        {
            File.AppendAllText(_filePath, "Error: " + ex.Message + Environment.NewLine +
                    "Stack Trace: " + Environment.NewLine + ex.StackTrace + Environment.NewLine);
        }

        public void Print(string format, params object[] args)
        {
            var text = String.Format(format, args) + Environment.NewLine;

            File.AppendAllText(_filePath, text);
        }

        public void PrintLine() { Print(""); }
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-03-07T07:26:58.490

出于记录目的（在 3.5 中）如何使用：

```
Context.LogMessage("My message"); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-10T23:17:23.723

构建一个 VM，安装 Visual Studio，制作它的副本（或创建差异虚拟 HDD）并在 VM 下的调试器下运行安装程序。

这就是我会做的（但我不是专家）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-12-30T10:56:33.113

您可以通过将以下部分添加到 .csproj 或 .csproj.user 文件来自动调试安装程序项目：

```
<PropertyGroup Condition="'$(Configuration)' == 'Debug'">
  <StartAction>Program</StartAction>
  <StartProgram>$(MSBuildBinPath)\installutil.exe</StartProgram>
  <StartArguments>$(AssemblyName).dll</StartArguments>
</PropertyGroup> 
```

如果您希望其他开发人员从此更改中受益，请使用项目文件；如果您想自己使用，请使用 .user 文件。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-06-29T09:57:24.833

您还可以使用 installUtil.exe 实用程序来测试您的安装程序组件。

如果您使用 Installer 类创建了 ac# 类程序集，请更改调试设置以启动外部程序“C:\Windows\Microsoft.NET\Framework\v2.0.50727\InstallUtil.exe”并相应地输入命令行参数（例如/Args=myargument "程序集的路径")

与上次设置断点一样，按 f5 即可调试代码。--视差

# c# - Hashtable.OnDeserialization

> ID：279524
> 
> 赞同：10
> 
> 时间：2008-11-10T23:13:05.980
> 
> 标签：c#, serialization, hashtable, ideserializationcallback

我有一个类维护对哈希表的引用并序列化/反序列化该哈希表。调用 SerializationInfo.GetValue 后，Hashtable 未完全反序列化，因为反序列化发生在 IDeserialization 回调期间。

```
Hashtable hashtable = (Hashtable) info.GetValue("hash", typeof(Hashtable)); 
```

我还在父类中实现了 IDeserialization 回调，但是 Hashtable 还没有完全反序列化。我预计反序列化是从内到外发生的。

我的问题是，从我的父类的 OnDeserialization 方法中显式调用 Hashtable.OnDeserialization 是否安全，以便我可以在那时枚举它？

```
public virtual void OnDeserialization(object sender)
{
    hashtable.OnDeserialization(sender);
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-19T10:13:33.623

这真是一个有趣的问题。使用 Reflector 检查序列化代码后，我认为如果引用的类使用 IDeserializationCallback，则没有普遍好的解决方案。

可能您已经看到，在反序列化期间还有两种其他方法可以运行某些代码，即 [OnDeserializing] 和 [OnDeserialized] 属性。不幸的是，两者都在 IDeserializationCallback.OnDeserialization() 之前运行。如果您有引用 class2 的 class1，则这是方法的运行顺序：

```
Class1: [OnDeserializing]
Class2: [OnDeserializing]
Class2: [OnDeserialized]
Class1: [OnDeserialized]
Class1: IDeserializationCallback.OnDeserialization
Class2: IDeserializationCallback.OnDeserialization 
```

如您所见，[OnDeserializing] 和 [OnDeserialized] 属性工作一致，但 IDeserializationCallback 方法并不真正...... :(

我还检查了 Hashtable 和 Dictionary 的 OnDeserialization 实现，两者似乎都可以安全地多次调用 OnDeserialization（只有第一次调用会执行必要的操作，后续调用什么也不做）。

所以最后你应该调用 Hashtable 的 OnDeserialization()，正如[Sean](http://clevercoder.wordpress.com/2006/11/30/hashtable-serialization-and-the-ideserializationcallback-interface/)和 Brian 建议的那样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T19:02:51.000

我怀疑你已经用谷歌搜索过了，但我昨天 碰巧遇到了[这种模式。](http://clevercoder.wordpress.com/2006/11/30/hashtable-serialization-and-the-ideserializationcallback-interface/)

```
public BoringClass(SerializationInfo info, StreamingContext context)
{
    Hashtable hashtable = (Hashtable) info.GetValue("hash", typeof(Hashtable));
    hashtable.OnDeserialization(this);

    Console.WriteLine("Value is: " + hashtable["testItem"]);

} 
```

# httpmodule - 确定 HttpModule 主/调用请求

> ID：279526
> 
> 赞同：2
> 
> 时间：2008-11-10T23:14:10.970
> 
> 标签：httpmodule

有没有办法知道 httpmodule 中的主/调用请求？我只希望我的模块代码在主 aspx 页面上运行，而不是图像和脚本。我可以检查“.aspx”的路径，但似乎应该有更好的方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T02:31:36.733

从您的模块中，您可以调用 HttpContext.Current.Handler 并查看它是否是 Page。您可能必须在 PostMapRequestHandler 事件或生命周期中的稍后事件中执行此操作。

或者，也许您可​​以检查哪个 HttpHandlerFactory 正在用于请求。如果是PageHandlerFactory，你可以运行你的逻辑，否则你可以跳过它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T03:12:41.847

IIS 不会在图像和脚本上调用 ASP.NET 处理程序*，因此 HTTPModule 无论如何都应该只在 ASPX 请求上运行。

*   除非您的意思是作为嵌入式资源提供的脚本，即 webresource.axd。

# unix - csh脚本中调用父进程如何查看子进程的STDOUT

> ID：279527
> 
> 赞同：0
> 
> 时间：2008-11-10T23:14:11.857
> 
> 标签：unix, scripting, ssh, csh

我正在调用一个 csh 脚本，它所做的第一件事就是启动一个新组。

我需要能够看到分叉后执行的子进程的标准输出。我还希望父进程“挂起”子进程完成。

这是脚本（`razor_from_cgwin.sh`）。

（有点）

```
newgrp name
source /stuff/morestuff/stuffiwant
razor -c thread -f Keil1403 -g lib . -o
chmod +x *
./rz_build*
> server{me}:./razor_from_cgwin.sh
> server{me}: 
```

我想要的是这样的：

```
>server{me}:./razor_from_cgwin
>(hang)
>any output from child forked process
>server{me}: 
```

Razor 是我正在从事的项目中使用的 CM。除了我需要启动一个新组来调用它之外，这个问题并不重要。我`./razor_from_cgwin.sh`从 CYGWIN 的 ssh 会话中调用脚本 () :)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T23:19:13.440

这看起来很奇怪——如果这是一个 Unix 系统，我没有理由想到为什么你不会自动看到子进程的输出。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T14:54:07.013

问题解决了。最初的问题是我在脚本中分叉了一个子进程。

现在我使用“这里的文档”。我在调用控制台中看到了输出。所以Alnitak是正确的。

# c# - 实现 IXmlSerializable 的正确方法？

> ID：279534
> 
> 赞同：159
> 
> 时间：2008-11-10T23:19:09.820
> 
> 标签：c#, xml, xml-serialization

一旦程序员决定实现`IXmlSerializable`，实现它的规则和最佳实践是什么？我听说`GetSchema()`应该返回`null`并且`ReadXml`应该在返回之前移动到下一个元素。这是真的？那么`WriteXml`- 它应该为对象编写一个根元素还是假设根已经被写入？应该如何对待和编写子对象？

这是我现在拥有的样本。当我得到好的回应时，我会更新它。

```
public class MyCalendar : IXmlSerializable
{
    private string _name;
    private bool _enabled;
    private Color _color;
    private List<MyEvent> _events = new List<MyEvent>();

    public XmlSchema GetSchema() { return null; }

    public void ReadXml(XmlReader reader)
    {
        if (reader.MoveToContent() == XmlNodeType.Element && reader.LocalName == "MyCalendar")
        {
            _name    = reader["Name"];
            _enabled = Boolean.Parse(reader["Enabled"]);
            _color   = Color.FromArgb(Int32.Parse(reader["Color"]));

            if (reader.ReadToDescendant("MyEvent"))
            {
                while (reader.MoveToContent() == XmlNodeType.Element && reader.LocalName == "MyEvent")
                {
                    MyEvent evt = new MyEvent();
                    evt.ReadXml(reader);
                    _events.Add(evt);
                }
            }
            reader.Read();
        }
    }

    public void WriteXml(XmlWriter writer)
    {
        writer.WriteAttributeString("Name",    _name);
        writer.WriteAttributeString("Enabled", _enabled.ToString());
        writer.WriteAttributeString("Color",   _color.ToArgb().ToString());

        foreach (MyEvent evt in _events)
        {
            writer.WriteStartElement("MyEvent");
            evt.WriteXml(writer);
            writer.WriteEndElement();
        }
    }
}

public class MyEvent : IXmlSerializable
{
    private string _title;
    private DateTime _start;
    private DateTime _stop;

    public XmlSchema GetSchema() { return null; }

    public void ReadXml(XmlReader reader)
    {
        if (reader.MoveToContent() == XmlNodeType.Element && reader.LocalName == "MyEvent")
        {
            _title = reader["Title"];
            _start = DateTime.FromBinary(Int64.Parse(reader["Start"]));
            _stop  = DateTime.FromBinary(Int64.Parse(reader["Stop"]));
            reader.Read();
        }
    }

    public void WriteXml(XmlWriter writer)
    {
        writer.WriteAttributeString("Title", _title);
        writer.WriteAttributeString("Start", _start.ToBinary().ToString());
        writer.WriteAttributeString("Stop",  _stop.ToBinary().ToString());
    }
} 
```

对应的示例 XML

```
<MyCalendar Name="Master Plan" Enabled="True" Color="-14069085">
    <MyEvent Title="Write Code" Start="-8589241828854775808" Stop="-8589241756854775808" />
    <MyEvent Title="???" Start="-8589241828854775808" Stop="-8589241756854775808" />
    <MyEvent Title="Profit!" Start="-8589247048854775808" Stop="-8589246976854775808" />
</MyCalendar> 
```

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2008-11-11T05:14:50.880

是的，GetSchema()[应该返回 null](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.getschema.aspx)。

> IXmlSerializable.GetSchema 方法 此方法是保留的，不应使用。实现 IXmlSerializable 接口时，应从此方法返回空引用（在 Visual Basic 中为 Nothing），如果需要指定自定义架构，则将 XmlSchemaProviderAttribute 应用于类。

对于读取和写入，对象元素已经被写入，因此您不需要在写入中添加外部元素。例如，您可以在两者中开始读取/写入属性。

对于[写](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.writexml.aspx)：

> 您提供的 WriteXml 实现应该写出对象的 XML 表示。框架编写一个包装器元素并在 XML 编写器启动后定位它。您的实现可能会编写其内容，包括子元素。然后框架关闭包装元素。

并[阅读](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.readxml.aspx)：

> ReadXml 方法必须使用由 WriteXml 方法写入的信息来重构您的对象。
> 
> 调用此方法时，读取器位于包装您的类型信息的元素的开头。也就是说，就在表示序列化对象开始的开始标记之前。当此方法返回时，它必须从头到尾读取整个元素，包括其所有内容。与 WriteXml 方法不同，框架不会自动处理包装元素。您的实施必须这样做。未能遵守这些定位规则可能会导致代码生成意外的运行时异常或损坏的数据。

我同意这有点不清楚，但归结为“`Read()`包装器的结束元素标签是你的工作”。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-10-27T09:36:57.087

我写了一篇关于该主题的文章，其中包含示例，因为 MSDN 文档现在还很不清楚，而且您可以在 Web 上找到的示例大部分时间都没有正确实现。

除了 Marc Gravell 已经提到的之外，陷阱是处理语言环境和空元素。

[http://www.codeproject.com/KB/XML/ImplementIXmlSerializable.aspx](http://www.codeproject.com/KB/XML/ImplementIXmlSerializable.aspx)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-04-19T03:48:18.823

是的，整个事情有点雷区，不是吗？**Marc Gravell**的回答几乎涵盖了它，但我想补充一点，在我从事的一个项目中，我们发现必须手动编写外部 XML 元素非常尴尬。它还导致相同类型的对象的 XML 元素名称不一致。

我们的解决方案是定义我们自己的`IXmlSerializable`接口，从系统接口派生，它添加了一个名为`WriteOuterXml()`. 你可以猜到，这个方法会简单地写外层元素，然后调用`WriteXml()`，然后写元素的结尾。当然，系统 XML 序列化程序不会调用此方法，因此它仅在我们自己进行序列化时才有用，因此这可能对您的情况有帮助，也可能没有帮助。同样，我们添加了一个`ReadContentXml()`方法，它不读取外部元素，只读取其内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-04-02T08:56:43.393

如果您已经有您的类的 XmlDocument 表示或更喜欢使用 XML 结构的 XmlDocument 方式，那么实现 IXmlSerializable 的一种快速而肮脏的方式就是将此 xmldoc 传递给各种函数。

警告：XmlDocument（和/或 XDocument）比 xmlreader/writer 慢一个数量级，所以如果性能是绝对要求，这个解决方案不适合你！

```
class ExampleBaseClass : IXmlSerializable { 
    public XmlDocument xmlDocument { get; set; }
    public XmlSchema GetSchema()
    {
        return null;
    }
    public void ReadXml(XmlReader reader)
    {
        xmlDocument.Load(reader);
    }

    public void WriteXml(XmlWriter writer)
    {
        xmlDocument.WriteTo(writer);
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-05-18T15:05:12.033

其他答案涵盖了接口实现，但我想为根元素投入 2 美分。

我过去学会了更喜欢将根元素作为元数据。这有几个好处：

*   如果有空对象，仍然可以序列化
*   从代码可读性的角度来看，这是有道理的

下面是一个可序列化字典的示例，其中字典根元素以这种方式定义：

```
using System.Collections.Generic;

[System.Xml.Serialization.XmlRoot("dictionary")]
public partial class SerializableDictionary<TKey, TValue> : Dictionary<TKey, TValue>, System.Xml.Serialization.IXmlSerializable
{
            public virtual System.Xml.Schema.XmlSchema GetSchema()
    {
        return null;
    }

    public virtual void ReadXml(System.Xml.XmlReader reader)
    {
        var keySerializer = new System.Xml.Serialization.XmlSerializer(typeof(TKey));
        var valueSerializer = new System.Xml.Serialization.XmlSerializer(typeof(TValue));
        bool wasEmpty = reader.IsEmptyElement;
        reader.Read();
        if (wasEmpty)
            return;
        while (reader.NodeType != System.Xml.XmlNodeType.EndElement)
        {
            reader.ReadStartElement("item");
            reader.ReadStartElement("key");
            TKey key = (TKey)keySerializer.Deserialize(reader);
            reader.ReadEndElement();
            reader.ReadStartElement("value");
            TValue value = (TValue)valueSerializer.Deserialize(reader);
            reader.ReadEndElement();
            Add(key, value);
            reader.ReadEndElement();
            reader.MoveToContent();
        }

        reader.ReadEndElement();
    }

    public virtual void WriteXml(System.Xml.XmlWriter writer)
    {
        var keySerializer = new System.Xml.Serialization.XmlSerializer(typeof(TKey));
        var valueSerializer = new System.Xml.Serialization.XmlSerializer(typeof(TValue));
        foreach (TKey key in Keys)
        {
            writer.WriteStartElement("item");
            writer.WriteStartElement("key");
            keySerializer.Serialize(writer, key);
            writer.WriteEndElement();
            writer.WriteStartElement("value");
            var value = this[key];
            valueSerializer.Serialize(writer, value);
            writer.WriteEndElement();
            writer.WriteEndElement();
        }
    }

    public SerializableDictionary() : base()
    {
    }

    public SerializableDictionary(IDictionary<TKey, TValue> dictionary) : base(dictionary)
    {
    }

    public SerializableDictionary(IDictionary<TKey, TValue> dictionary, IEqualityComparer<TKey> comparer) : base(dictionary, comparer)
    {
    }

    public SerializableDictionary(IEqualityComparer<TKey> comparer) : base(comparer)
    {
    }

    public SerializableDictionary(int capacity) : base(capacity)
    {
    }

    public SerializableDictionary(int capacity, IEqualityComparer<TKey> comparer) : base(capacity, comparer)
    {
    }

} 
```

# data-structures - 从哈希表中删除条目的最佳方法

> ID：279539
> 
> 赞同：27
> 
> 时间：2008-11-10T23:21:13.420
> 
> 标签：data-structures, hashtable

从使用线性探测的哈希表中删除条目的最佳方法是什么？一种方法是使用标志来指示已删除的元素？还有比这更好的方法吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2010-12-09T08:18:28.167

一个简单的技术是：

1.  查找并删除所需的元素
2.  转到下一个存储桶
3.  如果桶是空的，退出
4.  如果存储桶已满，则删除该存储桶中的元素并使用正常方式将其重新添加到哈希表中。在重新添加之前必须删除该项目，因为该项目很可能会被添加回其原始位置。
5.  重复步骤 2。

这种技术以稍慢的删除速度为代价使您的表保持整洁。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-11T02:06:53.693

这取决于您如何处理溢出以及（1）被删除的项目是否在溢出槽中，以及（2）如果在被删除的项目之外还有溢出项目，它们是否具有被删除项目的哈希键或者可能是其他一些哈希键。[忽略双重条件是删除实现中错误的常见来源。]

如果冲突溢出到链表中，这很容易。您要么弹出列表（可能已为空），要么从链接列表的中间或末尾删除成员。这些很有趣，而且不是特别困难。可以进行其他优化来避免过多的内存分配和释放，从而提高效率。

对于线性探测，Knuth 建议一种简单的方法是使用一种方法将插槽标记为空、已删除或已占用。将已删除的占用槽标记为已删除，以便线性探测溢出将跳过它，但如果需要插入，您可以填充您传递的第一个已删除槽 [计算机编程艺术，第 3 卷：排序和搜索，第 6.4 节散列，p。533 (ed.2)]。这假设删除是相当罕见的。

Knuth 对算法 R6.4 进行了很好的改进 [pp. 533-534]，而是将单元格标记为空而不是删除，然后通过移动刚刚制作的孔直到它最终靠近另一个孔，找到将表格条目移回更靠近其初始探测位置的方法。

Knuth 警告说，这将移动现有的仍被占用的插槽条目，如果指向插槽的指针被保留在哈希表之外，这不是一个好主意。[如果您在插槽中有垃圾收集或其他托管引用，则可以移动插槽，因为它是在表外使用的引用，并且引用的插槽在哪里都没有关系同一个对象在表中。]

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-11T00:00:26.367

Python 哈希表实现（可以说非常快）使用虚拟元素来标记删除。随着您的增长或缩小或表格（假设您没有做一个固定大小的表格），您可以同时删除假人。

如果您可以访问副本，请查看[Beautiful Code](http://books.google.ca/books?id=gJrmszNHQV4C&pg=RA3-PA297&lpg=RA3-PA297&dq=python+hash+table+beautiful+code&source=bl&ots=rKQ-uzQ8th&sig=OMSl1cL_89CwxgmWoJZUIKuh81c&hl=en&sa=X&oi=book_result&resnum=5&ct=result)中有关实现的文章。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-11T00:22:46.963

我能想到的最佳通用解决方案包括：

*   如果您可以使用非常量迭代器（ala C++ STL 或 Java），您应该能够在遇到它们时将其删除。但是，据推测，除非您使用 const 迭代器或枚举器，否则您不会问这个问题，如果基础集合被修改，它们将失效。
*   正如您所说，您可以在包含的对象中标记已删除的标志。但是，这不会释放任何内存或减少键上的冲突，因此它不是最佳解决方案。还需要在类上添加一个可能并不真正属于那里的属性。如果这让您和我一样困扰，或者如果您根本无法向存储的对象添加标志（也许您不控制类），您可以将这些标志存储在单独的哈希表中。这需要最长时间的记忆使用。
*   在遍历哈希表的同时，将要删除的项的键压入向量或数组列表中。释放枚举器后，循环遍历此二级列表并从哈希表中删除键。如果您有很多要删除的项目和/或密钥很大（它们不应该如此），这可能不是最佳解决方案。
*   如果您最终要从哈希表中删除的项目比您留在那里的项目多，那么创建一个新的哈希表可能会更好，并且当您遍历原始哈希表时，只添加到新的哈希表中你要保留的物品。然后将您对旧哈希表的引用替换为新哈希表。这节省了二次列表迭代，但它可能只有在新哈希表的项目比原始哈希表少得多的情况下才有效，当然，它肯定只有在您可以更改对原始哈希表的所有引用时才有效。
*   如果您的哈希表允许您访问其键集合，则您可以遍历这些键并一次性从哈希表中删除项目。
*   如果您的哈希表或库中的某个助手为您提供了基于谓词的集合修饰符，您可能有一个 Remove() 函数，您可以将 lambda 表达式或函数指针传递给该函数以识别要删除的项目。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T14:52:01.190

当时间是一个因素时，一种常见的技术是拥有第二个已删除项目的表，并在您有时间时清理主表。常用于搜索引擎。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-09-22T22:29:23.287

如何增强哈希表以包含像链表这样的指针？插入时，如果存储桶已满，则创建一个从该存储桶指向存储新字段的存储桶的指针。

从哈希表中删除某些内容时，解决方案将等同于您编写函数以从链表中删除节点的方式。

# c# - 电子邮件通知服务

> ID：279540
> 
> 赞同：5
> 
> 时间：2008-11-10T23:21:31.437
> 
> 标签：c#, .net, sql, email

实现发送电子邮件的服务有哪些想法（使用 .NET 和 SQL 2005）？电子邮件将是数据驱动的。发送电子邮件的日期和时间是表中的一个字段。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T00:04:16.640

过去，我已经建立了几个用于发送数据驱动电子邮件的大容量电子邮件通知服务。一些建议：

*   考虑使用专门管理退回、退订、isp 和黑名单管理等的高质量电子邮件服务提供商。如果发送电子邮件对您的业务至关重要，但不是您的主要业务，那么这将是值得的。大多数将有一个用于发送模板消息、点击跟踪、打开率的 api，并将提供触发器等。
*   查看 SQL Server Service Broker 以对实际消息进行排队，否则您可以考虑使用 Microsoft 消息队列服务。无需构建自己的排队服务。当这个问题已经解决时，我们花了太多时间处理排队基础设施代码。
*   在您的业务层上开发一组灵活的事件，以允许触发此类消息并将它们异步放入您的队列中，从长远来看，这将为您节省很多痛苦，而不是轮询数据库或使用数据库入侵它触发器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T23:37:20.063

您可以使用触发器在 UPDATE/DELETE/INSERT 上发送电子邮件。触发器可以用 .Net 实现，只需使用[System.Net.Mail](http://msdn.microsoft.com/en-us/library/system.net.mail.aspx)命名空间中的类从那里发送邮件。

这是一篇很好的[文章](http://aspalliance.com/1273_CLR_Triggers_for_SQL_Server_2005.all)，如何在 .Net 中实现 CLR (.Net) 触发器。

对于轻量级 SMPT 服务器，为了最大限度地减少延迟，您可以使用[Kenny's answer](https://stackoverflow.com/questions/279540/email-notification-service#279545)中推荐的那个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T14:48:28.983

感谢大家的反馈。为简单起见，我从一个 SP 开始，它查找要发送的提醒并使用 sp_send_dbmail（SQL 数据库邮件）发送电子邮件。这每分钟都在执行一项工作。我更新了记录以表明提醒是使用从 sp_send_dbmail 发回的 MailItemId 发送的。预计的提醒量是每天 10^2 范围内的最坏情况。

我很想听听人们认为此解决方案可能存在的任何缺点的反馈。

顺便说一句，我不敢相信 Vista 没有配备本地 SMTP 服务器！幸好谷歌比较大方，我使用了 Gmail 的服务器进行测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T23:24:36.487

通常，我只是启动一个进程，例如[http://caspian.dotconf.net/menu/Software/SendEmail/](http://caspian.dotconf.net/menu/Software/SendEmail/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T23:27:19.460

我打算推荐 SQL Server Notification Services，它可以很好地处理这项工作。但我看到它已从 SQL Server 2008 中删除，因此您可能不想去那里。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T03:17:49.307

[数据驱动的 SSRS 订阅](http://technet.microsoft.com/en-us/library/ms169673(SQL.90).aspx)？只是一个想法。

# c# - 计算在.Net中以X行显示文本所需的最小宽度？

> ID：279546
> 
> 赞同：0
> 
> 时间：2008-11-10T23:24:49.963
> 
> 标签：c#, .net, string, graphics

考虑到文本应该在空白处中断，您如何计算在 X 行中显示字符串所需的最小宽度？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T23:25:09.433

可能的提示：也许是某种使用 Graphics.MeasureString() 的二分搜索？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T00:21:54.327

**编辑：**没有意识到您想尝试将文本调整到固定数量的行。这是一个很难尝试解决的问题。这是我能想到的最好的，可能不是最优雅的，但它似乎有效：

```
public SizeF CalculateWidth(Font font, Graphics graphics, int numOfLines,
                            string text)
{
    SizeF sizeFull = graphics.MeasureString(text, font,
                                            new SizeF(
                                                float.PositiveInfinity,
                                                float.PositiveInfinity),
                                            StringFormat.
                                                GenericTypographic);

    float width = sizeFull.Width/numOfLines;
    float averageWidth = sizeFull.Width/text.Length;
    int charsFitted;
    int linesFilled;

    SizeF needed = graphics.MeasureString(text, font,
                                          new SizeF(width,
                                                    float.
                                                        PositiveInfinity),
                                          StringFormat.
                                              GenericTypographic,
                                          out charsFitted,
                                          out linesFilled);

    while (linesFilled > numOfLines)
    {
        width += averageWidth;
        needed = graphics.MeasureString(text, font,
                                        new SizeF(width,
                                                  float.PositiveInfinity),
                                        StringFormat.GenericTypographic,
                                        out charsFitted, out linesFilled);
    }

    return needed;
} 
```

示例用法：

```
Font font = new Font("Arial", 12, FontStyle.Regular,
                     GraphicsUnit.Pixel);
Graphics g = Graphics.FromImage(new Bitmap(1, 1));
string text = "Some random text with words in it.";

SizeF size = CalculateWidth(font, g, 3, text); 
```

# asp.net - ASP Ajax 日历扩展器和显示时间

> ID：279552
> 
> 赞同：3
> 
> 时间：2008-11-10T23:26:41.053
> 
> 标签：asp.net, ajax, calendarextender

我正在使用 Ajax Control Toolkit Calendar Extender 控件。尽管我想在某些字段中显示时间和日期。我尝试将格式设置为“dd/MM/yyyy hh:mm:ss”，但时间部分被擦除了。如果用户想要更改时间部分，他们可以手动进行，日历下拉菜单仅用于更改日期部分。

是否有任何解决方法或替代方法可以使其正常工作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T00:35:16.233

我有一个类似的问题，我打算使用日期字段和相关的时间下拉列表（以 1/2 小时为增量）。用户在日期字段中设置日期，可选择使用日历控件，并下拉到有效时间。我计划在时间下拉列表中有一个选择是“不在乎”，以防它是“全天”事件。

[编辑] 我发现这个我可能最终会使用的jquery[插件。](http://plugins.jquery.com/project/DateTimepicker)[我还在这篇文章](https://stackoverflow.com/questions/279766/datetimepicker-control)的答案中找到了[Gaia DateTimePicker](http://samples.gaiaware.net/Extensions/DateTimePicker/Overview/)的链接（现在看起来已被删除，可能是因为 OP 要求的是 WPF 控件，而不是 Web 控件）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T01:02:52.220

[Ra-Ajax 日历](http://ra-ajax.org/samples/Ajax-Calendar.aspx)将在即将到来的星期五（2008 年 11 月 28 日）推出 TIME 支持，并且它已获得 LGPL 许可...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-22T04:58:53.753

基于 CalendarExtender，您可以将格式设置为“MM/dd/yyyy”。用户在日历中选择日期后，它将返回例如 04/28/2009。在日期选择事件中，您可以在返回的日期之后附加当前时间。

OnClientDateSelectionChanged="日期选择"

```
 function dateselect(ev)
    {
        var calendarBehavior1 = $find("Calendar1");
        var d = calendarBehavior1._selectedDate;
        var now = new Date();
        calendarBehavior1.get_element().value = d.format("MM/dd/yyyy") + " "+now.format("HH:mm:ss")
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-04-01T10:11:25.110

将时间组件添加到 AjaxControlToolKit CalendarExtender 的唯一方法是使用 OnClientDateSelectionChanged 和 JavaScript 附加它。

```
<ajaxToolkit:CalendarExtender ID="ce1" runat="server" PopupButtonID="calImg" Enabled="true" Format="dd/MM/yyyy" TargetControlID="txtLeft" PopupPosition="TopRight" OnClientDateSelectionChanged="AppendTime"></ajaxToolkit:CalendarExtender> 
```

和

```
<script language="javascript" type="text/javascript">
    //this script will get the date selected from the given calendarextender (ie: "sender") and append the
    //current time to it.
    function AppendTime(sender, args) {
        var selectedDate = new Date();
        selectedDate = sender.get_selectedDate();
        var now = new Date();
        sender.get_element().value = selectedDate.format("dd/MM/yyyy") + " " + now.format("hh:mm tt");
    }
    </script> 
```

# sql - SQL Server 触发器相互触发问题

> ID：279555
> 
> 赞同：3
> 
> 时间：2008-11-10T23:28:50.143
> 
> 标签：sql, triggers

我有一个审计触发器，它会自动放置更新时间以及在我所有表中的字段中更新的用户。我有另一组触发器，它们将事件信息从更新写入事件表。问题是当有人更新某些东西时，由于第一次触发，事件信息会被触发两次。如何抑制重复条目？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T23:33:33.537

我猜你有两个选择：

1.  要么将两组触发器合并为一个。

2.  或者，每个数据库设置允许禁用触发器的递归触发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T23:47:19.483

查看 TRIGGER_NESTLEVEL 函数。它返回触发器嵌套的当前级别。您可以检查以防止重复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T02:12:33.807

如果您有足够的权限，您也可以一起关闭嵌套触发器（某些虚拟主机不允许您这样做）。有一个名为 sp_configure 的存储过程 (Sql 2005) 允许您修改服务器的配置。下面的语句禁用嵌套触发器，这将阻止触发器触发另一个触发器。

exec sp_configure '嵌套触发器', 0

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-17T19:35:44.603

也可以在 SS2005 中禁用 trigger-fires-trigger 行为，方法是进入 SS Mgt Studio 并选择相关服务器的图标，右键单击，然后选择“Properties”。然后从左侧列表中选择“高级”，并将“允许触发器触发其他”的值设置为“假”。

# .net - 如何防止 WPF GridSplitter 改变网格的大小？

> ID：279557
> 
> 赞同：6
> 
> 时间：2008-11-10T23:31:12.557
> 
> 标签：.net, wpf, xaml, grid

WPF GridSplitter 使我的 Grid 比我的 Window 更宽！

我有一个带有 GridSplitter 的 WPF 网格。如果我调整列的大小，那么我可以使我的网格比我的窗口更宽并且不可见。

它是这样开始的：

[WPF 网格 http://img201.imageshack.us/img201/9505/onehg6.jpg](http://img201.imageshack.us/img201/9505/onehg6.jpg)

但是加宽左栏后，我再也看不到右栏（绿色）：

[WPF GridSplitter http://img201.imageshack.us/img201/1804/twomy6.jpg](http://img201.imageshack.us/img201/1804/twomy6.jpg)

我究竟做错了什么？如何防止 GridSplitter 改变我的 Grid 的大小？

* * *

更新：

我仍在为此苦苦挣扎。我现在尝试在网格中嵌套网格。那没有帮助。这是我的 XAML ColumnDefinitions、RowDefinitions 和 GridSplitters...

```
<Window ... >
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="150" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" MinWidth="400" />
        </Grid.ColumnDefinitions>
        <GridSplitter 
            ResizeDirection="Columns"
            ResizeBehavior="BasedOnAlignment"
            Grid.Column="1"
            HorizontalAlignment="Center"
            VerticalAlignment="Stretch"
            Width="2"
            Margin="0,5,0,5"
            Panel.ZIndex="1"/>
        <Grid Grid.Column="0">
            ...
        </Grid>
        <Grid Grid.Column="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="150" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" MinWidth="200" />
            </Grid.ColumnDefinitions>
            <GridSplitter 
                ResizeDirection="Columns"
                ResizeBehavior="PreviousAndNext"
                Grid.Column="1"
                HorizontalAlignment="Center"
                VerticalAlignment="Stretch"
                Width="2"
                Margin="0,5,0,5"
                Panel.ZIndex="1"/>
            <Grid Grid.Column="0">
                ...
            </Grid>
            <Grid Grid.Column="2">
                ...
            </Grid>
        </Grid>
    </Grid>
</Window> 
```

* * *

更新：

我认为问题出在 WebBrowser 控件上。查看新问题：

[WPF GridSplitter 不适用于 WebBrowser 控件？](https://stackoverflow.com/questions/375841/wpf-gridsplitter-doesnt-work-with-webbrowser-control)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T16:05:49.820

尝试将宽度更改为星号。这将导致拆分器仅调整其所在列的大小，因此不确定这是否是您想要的行为。但是，对于星形大小，内容不会超出窗口的范围。

```
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*" MinWidth="100" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" MinWidth="50" />
        <ColumnDefinition Width="2*" MinWidth="100" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="3*" MinWidth="150" />
    </Grid.ColumnDefinitions>
    <GridSplitter 
        ResizeDirection="Columns"
        Grid.Column="1"
        Grid.RowSpan="8"
        HorizontalAlignment="Center"
        VerticalAlignment="Stretch"
        Width="2"
        Margin="0,5,0,5"
        Panel.ZIndex="1"/>
    ...
</Grid> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T19:36:32.777

如果您的 Window 调整大小，使其宽度小于列的 MinWidths 的总和，您会看到列被截断，但否则我无法重现您的问题：

```
<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="150" Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition MinWidth="400" Width="*"/>
        </Grid.ColumnDefinitions>
        <GridSplitter
            Width="2"
            Grid.Column="1"
            HorizontalAlignment="Center"
            Margin="0,5,0,5"
            Panel.ZIndex="1"
            VerticalAlignment="Stretch"
            ResizeBehavior="BasedOnAlignment"
            ResizeDirection="Columns"/>
        <Grid Grid.Column="0">
            <Border Background="Red" Margin="5"/>
        </Grid>
        <Grid Grid.Column="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="150" Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition MinWidth="200" Width="*"/>
            </Grid.ColumnDefinitions>
            <GridSplitter
                Width="2"
                Grid.Column="1"
                HorizontalAlignment="Center"
                Margin="0,5,0,5"
                Panel.ZIndex="1"
                VerticalAlignment="Stretch"
                ResizeBehavior="PreviousAndNext"
                ResizeDirection="Columns"/>
            <Grid Grid.Column="0">
                <Border Background="Green" Margin="5"/>
            </Grid>
            <Grid Grid.Column="2">
                <Border Background="Blue" Margin="5"/>
            </Grid>
        </Grid>
    </Grid>
</Window> 
```

扩展红色列，它只会扩展直到右列达到其 MinWidth 400，它不会将其引导出页面。

您可能正在设置会导致此行为的 Window 或最外层 Grid 的其他属性...

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-27T08:28:50.470

当拆分器之间没有具有自动宽度的列时，它无需任何额外代码即可为我工作，即：

```
<Grid >
<Grid.ColumnDefinitions>
    <ColumnDefinition Width="20*" MinWidth="50" MaxWidth="500" />
    <ColumnDefinition Width="Auto"/> <!-- Remove such columns /-->
    <ColumnDefinition Width="100*" MinWidth="850"/>
    <ColumnDefinition Width="30*" MinWidth="50" MaxWidth="800" />
</Grid.ColumnDefinitions>
...
<GridSplitter HorizontalAlignment="Right" Width="3"/>
...
<GridSplitter Grid.Column="3" HorizontalAlignment="Left" Width="3" />
<!-- Assign Grid.Column to 2 if you remove the auto width column /-->
...
</Grid> 
```

否则网格将可调整大小。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-11-19T13:32:09.260

捕获 DragDelta 事件是另一种方法：

```
 private void VerticalGridSplitter_DragDelta(object sender, System.Windows.Controls.Primitives.DragDeltaEventArgs e)
    {
        if (GridName.ColumnDefinitions[2].Width.Value < 400)
        {
            GridName.ColumnDefinitions[2].Width = new GridLength(400);
        }
    } 
```

但是在 * ColumnDefinition 上使用 MinWidth 应该可以正常工作。请注意，具有 MinWidth 的 ColumnDefinition 需要位于顶层。如果它嵌套在列内的某个网格中，则它不起作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-11-15T12:30:44.337

我也遇到了这个问题，`Grid`没有特殊控件的正常情况，以及`*`两列/行的大小。

问题原来是我在加载窗口后以编程方式设置网格中列/行的宽度和高度，因为我保存了拆分器位置以在下一次程序运行时恢复它。

我将其更改为计算`*`大小以解决问题。

# python - 函数中静态变量的 Python 等价物是什么？

> ID：279561
> 
> 赞同：747
> 
> 时间：2008-11-10T23:33:36.373
> 
> 标签：python, static

这个 C/C++ 代码的惯用 Python 等价物是什么？

```
void foo()
{
    static int counter = 0;
    counter++;
    printf("counter is %d\n", counter);
} 
```

具体来说，与类级别相比，如何在函数级别实现静态成员？将函数放入类中会改变什么吗？

* * *

## 回答 #1

> 赞同：796
> 
> 时间：2008-11-10T23:46:00.920

有点颠倒，但这应该有效：

```
def foo():
    foo.counter += 1
    print "Counter is %d" % foo.counter
foo.counter = 0 
```

如果您希望计数器初始化代码在顶部而不是底部，您可以创建一个装饰器：

```
def static_vars(**kwargs):
    def decorate(func):
        for k in kwargs:
            setattr(func, k, kwargs[k])
        return func
    return decorate 
```

然后使用这样的代码：

```
@static_vars(counter=0)
def foo():
    foo.counter += 1
    print "Counter is %d" % foo.counter 
```

不幸的是，它仍然需要您使用`foo.`前缀。

^(（信用：[@ony](https://stackoverflow.com/questions/279561/what-is-the-python-equivalent-of-static-variables-inside-a-function/279586#comment41067162_279586)）)

* * *

## 回答 #2

> 赞同：260
> 
> 时间：2008-11-10T23:53:00.797

您可以向函数添加属性，并将其用作静态变量。

```
def myfunc():
  myfunc.counter += 1
  print myfunc.counter

# attribute must be initialized
myfunc.counter = 0 
```

或者，如果您不想在函数外部设置变量，可以使用`hasattr()`来避免`AttributeError`异常：

```
def myfunc():
  if not hasattr(myfunc, "counter"):
     myfunc.counter = 0  # it doesn't exist yet, so initialize it
  myfunc.counter += 1 
```

无论如何，静态变量相当少见，你应该为这个变量找到一个更好的地方，很可能是在一个类中。

* * *

## 回答 #3

> 赞同：243
> 
> 时间：2013-04-25T12:16:31.450

还可以考虑：

```
def foo():
    try:
        foo.counter += 1
    except AttributeError:
        foo.counter = 1 
```

推理：

*   很多pythonic（“请求原谅而不是许可”）
*   使用异常（只抛出一次）而不是`if`分支（想想[StopIteration](https://docs.python.org/2/library/exceptions.html#exceptions.StopIteration)异常）

* * *

## 回答 #4

> 赞同：67
> 
> 时间：2015-01-05T16:24:14.347

许多人已经建议测试“hasattr”，但有一个更简单的答案：

```
def func():
    func.counter = getattr(func, 'counter', 0) + 1 
```

没有 try/except，没有测试 hasattr，只是 getattr 具有默认值。

* * *

## 回答 #5

> 赞同：59
> 
> 时间：2008-11-10T23:47:53.770

其他答案已经展示了您应该这样做的方式。这是一种你不应该的方式：

```
>>> def foo(counter=[0]):
...   counter[0] += 1
...   print("Counter is %i." % counter[0]);
... 
>>> foo()
Counter is 1.
>>> foo()
Counter is 2.
>>> 
```

默认值仅在第一次评估函数时初始化，而不是每次执行时初始化，因此您可以使用列表或任何其他可变对象来存储静态值。

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2012-09-04T19:51:35.113

这是一个完全封装的版本，不需要外部初始化调用：

```
def fn():
    fn.counter=vars(fn).setdefault('counter',-1)
    fn.counter+=1
    print (fn.counter) 
```

在 Python 中，函数是对象，我们可以简单地通过特殊属性向它们添加或修改成员变量`__dict__`。内置`vars()`返回特殊属性`__dict__`。

编辑：注意，与替代`try:except AttributeError`答案不同，使用这种方法，变量将始终为初始化后的代码逻辑做好准备。我认为以下`try:except AttributeError`替代方案将不那么干燥和/或有尴尬的流动：

```
def Fibonacci(n):
   if n<2: return n
   Fibonacci.memo=vars(Fibonacci).setdefault('memo',{}) # use static variable to hold a results cache
   return Fibonacci.memo.setdefault(n,Fibonacci(n-1)+Fibonacci(n-2)) # lookup result in cache, if not available then calculate and store it 
```

EDIT2：我只在从多个位置调用函数时才推荐上述方法。如果相反，该函数仅在一个地方调用，则最好使用`nonlocal`：

```
def TheOnlyPlaceStaticFunctionIsCalled():
    memo={}
    def Fibonacci(n):
       nonlocal memo  # required in Python3\. Python2 can see memo
       if n<2: return n
       return memo.setdefault(n,Fibonacci(n-1)+Fibonacci(n-2))
    ...
    print (Fibonacci(200))
    ... 
```

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2008-11-10T23:53:12.480

Python 没有静态变量，但您可以通过定义一个可调用的类对象然后将其用作函数来伪造它。[另请参阅此答案](https://stackoverflow.com/a/593046/4561887)。

```
class Foo(object):
  # Class variable, shared by all instances of this class
  counter = 0

  def __call__(self):
    Foo.counter += 1
    print Foo.counter

# Create an object instance of class "Foo," called "foo"
foo = Foo()

# Make calls to the "__call__" method, via the object's name itself
foo() #prints 1
foo() #prints 2
foo() #prints 3 
```

请注意，这`__call__`使得类（对象）的实例可以通过其自己的名称调用。这就是为什么`foo()`上面调用调用类的`__call__`方法。[从文档中](https://docs.python.org/3/reference/datamodel.html)：

> 任意类的实例可以通过`__call__()`在其类中定义方法来调用。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-11-10T23:37:00.440

使用生成器函数生成迭代器。

```
def foo_gen():
    n = 0
    while True:
        n+=1
        yield n 
```

然后像这样使用它

```
foo = foo_gen().next
for i in range(0,10):
    print foo() 
```

如果你想要一个上限：

```
def foo_gen(limit=100000):
    n = 0
    while n < limit:
       n+=1
       yield n 
```

如果迭代器终止（如上面的示例），您也可以直接循环它，如

```
for i in foo_gen(20):
    print i 
```

当然，在这些简单的情况下，最好使用 xrange :)

这是关于[yield 声明](http://docs.python.org/reference/simple_stmts.html#the-yield-statement)的文档。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2018-04-08T15:36:57.270

其他解决方案将计数器属性附加到函数，通常使用复杂的逻辑来处理初始化。这不适合新代码。

在 Python 3 中，正确的方法是使用`nonlocal`语句：

```
counter = 0
def foo():
    nonlocal counter
    counter += 1
    print(f'counter is {counter}') 
```

有关语句的规范，请参见[PEP 3104 。](https://www.python.org/dev/peps/pep-3104/)`nonlocal`

如果计数器打算对模块私有，则应`_counter`改为命名。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2015-08-03T09:50:37.460

使用函数的属性作为静态变量有一些潜在的缺点：

*   每次要访问变量时，都必须写出函数的全名。
*   外部代码可以轻松访问变量并弄乱该值。

第二个问题的惯用 python 可能会使用前导下划线来命名变量，以表明它不应该被访问，同时在事后保持它可访问。

## 使用闭包

另一种方法是使用词法闭包的模式，`nonlocal`python 3 中的关键字支持这种模式。

```
def make_counter():
    i = 0
    def counter():
        nonlocal i
        i = i + 1
        return i
    return counter
counter = make_counter() 
```

可悲的是，我不知道如何将此解决方案封装到装饰器中。

## 使用内部状态参数

另一种选择可能是用作可变值容器的未记录参数。

```
def counter(*, _i=[0]):
    _i[0] += 1
    return _i[0] 
```

这是可行的，因为默认参数是在定义函数时评估的，而不是在调用它时。

清洁工可能有一个容器类型而不是列表，例如

```
def counter(*, _i = Mutable(0)):
    _i.value += 1
    return _i.value 
```

但我不知道明确传达目的的内置类型。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2016-08-02T06:02:26.520

更易读，但更冗长（Python 之禅：显式优于隐式）：

```
>>> def func(_static={'counter': 0}):
...     _static['counter'] += 1
...     print _static['counter']
...
>>> func()
1
>>> func()
2
>>> 
```

有关其工作原理的说明，请参见[此处。](https://stackoverflow.com/a/1145781/248296)

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2008-11-10T23:50:14.670

```
_counter = 0
定义 foo():
   全局计数器
   _counter += 1
   print 'counter is', _counter

```

Python 通常使用下划线来表示私有变量。在 C 中，在函数内部声明静态变量的唯一原因是将其隐藏在函数外部，这并不是真正的 Python 惯用语。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2015-02-09T02:27:39.613

```
def staticvariables(**variables):
    def decorate(function):
        for variable in variables:
            setattr(function, variable, variables[variable])
        return function
    return decorate

@staticvariables(counter=0, bar=1)
def foo():
    print(foo.counter)
    print(foo.bar) 
```

很像上面 vincent 的代码，这将用作函数装饰器，并且必须使用函数名称作为前缀来访问静态变量。这段代码的优点（尽管无可否认，任何人都可能足够聪明地弄清楚它）是您可以拥有多个静态变量并以更传统的方式初始化它们。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2018-07-20T08:02:10.763

在尝试了几种方法后，我最终使用了@warvariuc 答案的改进版本：

```
import types

def func(_static=types.SimpleNamespace(counter=0)):
    _static.counter += 1
    print(_static.counter) 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-05-16T07:36:30.363

*惯用*的方法是使用可以具有属性的*类。*如果您需要实例不分开，请使用单例。

有多种方法可以将“静态”变量伪造或混入 Python 中（目前尚未提及的一种方法是具有可变的默认参数），但这不是**Pythonic 的惯用**方法。只需使用一个类。

如果您的使用模式适合，也可能是生成器。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2015-01-13T03:58:38.627

Python 方法中的静态变量

```
class Count:
    def foo(self):
        try: 
            self.foo.__func__.counter += 1
        except AttributeError: 
            self.foo.__func__.counter = 1

        print self.foo.__func__.counter

m = Count()
m.foo()       # 1
m.foo()       # 2
m.foo()       # 3 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2015-12-01T14:47:24.163

另一个（不推荐！）像[https://stackoverflow.com/a/279598/916373](https://stackoverflow.com/a/279598/916373)这样的可调用对象的扭曲，如果您不介意使用时髦的调用签名，可以这样做

```
class foo(object):
    counter = 0;
    @staticmethod
    def __call__():
        foo.counter += 1
        print "counter is %i" % foo.counter 
```

* * *

```
>>> foo()()
counter is 1
>>> foo()()
counter is 2 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2018-03-26T22:34:36.530

解决方案 n +=1

```
def foo():
  foo.__dict__.setdefault('count', 0)
  foo.count += 1
  return foo.count 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2018-09-20T17:46:15.247

全局声明提供了此功能。在下面的示例中（python 3.5 或更高版本使用“f”），*计数器*变量在函数外部定义。在函数中将其定义为全局意味着函数外部的“全局”版本应该对函数可用。所以每次函数运行时，它都会修改函数外部的值，将其保留在函数之外。

```
counter = 0

def foo():
    global counter
    counter += 1
    print("counter is {}".format(counter))

foo() #output: "counter is 1"
foo() #output: "counter is 2"
foo() #output: "counter is 3" 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-10-01T21:09:43.700

[在这个问题](https://stackoverflow.com/questions/19125515/function-instance-variables-inside-a-class/19125964)的提示下，我可以提出另一种替代方案，它可能使用起来更好一些，并且对于方法和函数来说看起来都一样：

```
@static_var2('seed',0)
def funccounter(statics, add=1):
    statics.seed += add
    return statics.seed

print funccounter()       #1
print funccounter(add=2)  #3
print funccounter()       #4

class ACircle(object):
    @static_var2('seed',0)
    def counter(statics, self, add=1):
        statics.seed += add
        return statics.seed

c = ACircle()
print c.counter()      #1
print c.counter(add=2) #3
print c.counter()      #4
d = ACircle()
print d.counter()      #5
print d.counter(add=2) #7
print d.counter()      #8 
```

如果你喜欢这种用法，这里是实现：

```
class StaticMan(object):
    def __init__(self):
        self.__dict__['_d'] = {}

    def __getattr__(self, name):
        return self.__dict__['_d'][name]
    def __getitem__(self, name):
        return self.__dict__['_d'][name]
    def __setattr__(self, name, val):
        self.__dict__['_d'][name] = val
    def __setitem__(self, name, val):
        self.__dict__['_d'][name] = val

def static_var2(name, val):
    def decorator(original):
        if not hasattr(original, ':staticman'):    
            def wrapped(*args, **kwargs):
                return original(getattr(wrapped, ':staticman'), *args, **kwargs)
            setattr(wrapped, ':staticman', StaticMan())
            f = wrapped
        else:
            f = original #already wrapped

        getattr(f, ':staticman')[name] = val
        return f
    return decorator 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2017-10-25T22:22:25.003

您始终可以创建所谓的“函数对象”并为其提供标准（非静态）成员变量，而不是创建具有静态局部变量的函数。

既然您给出了一个用 C++ 编写的示例，我将首先解释 C++ 中的“函数对象”是什么。“函数对象”只是任何具有重载的类`operator()`。类的实例将表现得像函数。例如，您可以编写`int x = square(5);`if`square`是一个对象（带有重载`operator()`），而不是技术上不是“函数”。你可以给一个函数对象你可以给一个类对象的任何特性。

```
# C++ function object
class Foo_class {
    private:
        int counter;     
    public:
        Foo_class() {
             counter = 0;
        }
        void operator() () {  
            counter++;
            printf("counter is %d\n", counter);
        }     
   };
   Foo_class foo; 
```

在 Python 中，我们也可以重载`operator()`，只是方法被命名为`__call__`：

这是一个类定义：

```
class Foo_class:
    def __init__(self): # __init__ is similair to a C++ class constructor
        self.counter = 0
        # self.counter is like a static member
        # variable of a function named "foo"
    def __call__(self): # overload operator()
        self.counter += 1
        print("counter is %d" % self.counter);
foo = Foo_class() # call the constructor 
```

这是正在使用的类的示例：

```
from foo import foo

for i in range(0, 5):
    foo() # function call 
```

打印到控制台的输出是：

```
counter is 1
counter is 2
counter is 3
counter is 4
counter is 5 
```

如果您希望您的函数接受输入参数，您也可以将它们添加到`__call__`：

```
# FILE: foo.py - - - - - - - - - - - - - - - - - - - - - - - - -

class Foo_class:
    def __init__(self):
        self.counter = 0
    def __call__(self, x, y, z): # overload operator()
        self.counter += 1
        print("counter is %d" % self.counter);
        print("x, y, z, are %d, %d, %d" % (x, y, z));
foo = Foo_class() # call the constructor

# FILE: main.py - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

from foo import foo

for i in range(0, 5):
    foo(7, 8, 9) # function call

# Console Output - - - - - - - - - - - - - - - - - - - - - - - - - - 

counter is 1
x, y, z, are 7, 8, 9
counter is 2
x, y, z, are 7, 8, 9
counter is 3
x, y, z, are 7, 8, 9
counter is 4
x, y, z, are 7, 8, 9
counter is 5
x, y, z, are 7, 8, 9 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2018-03-18T11:06:41.603

这个答案建立在@claudiu 的答案之上。

我发现每当我打算访问静态变量时，我总是必须在函数名前加上函数名，我的代码变得不那么清晰了。

即，在我的函数代码中，我更愿意编写：

```
print(statics.foo) 
```

代替

```
print(my_function_name.foo) 
```

所以，我的解决方案是：

1.  为函数添加`statics`属性
2.  在函数范围内，添加一个局部变量`statics`作为别名`my_function.statics`

```
from bunch import *

def static_vars(**kwargs):
    def decorate(func):
        statics = Bunch(**kwargs)
        setattr(func, "statics", statics)
        return func
    return decorate

@static_vars(name = "Martin")
def my_function():
    statics = my_function.statics
    print("Hello, {0}".format(statics.name)) 
```

* * *

*评论*

我的方法使用了一个名为 的类`Bunch`，它是一个支持属性样式访问的字典，类似于 JavaScript（请参阅关于它的[原始文章](http://code.activestate.com/recipes/52308-the-simple-but-handy-collector-of-a-bunch-of-named/?in=user-97991)，大约 2000 年）

它可以通过安装`pip install bunch`

它也可以像这样手写：

```
class Bunch(dict):
    def __init__(self, **kw):
        dict.__init__(self,kw)
        self.__dict__ = self 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-06-08T01:15:58.377

我个人更喜欢以下装饰器。各有各的。

```
def staticize(name, factory):
    """Makes a pseudo-static variable in calling function.

    If name `name` exists in calling function, return it. 
    Otherwise, saves return value of `factory()` in 
    name `name` of calling function and return it.

    :param name: name to use to store static object 
    in calling function
    :type name: String
    :param factory: used to initialize name `name` 
    in calling function
    :type factory: function
    :rtype: `type(factory())`

    >>> def steveholt(z):
    ...     a = staticize('a', list)
    ...     a.append(z)
    >>> steveholt.a
    Traceback (most recent call last):
    ...
    AttributeError: 'function' object has no attribute 'a'
    >>> steveholt(1)
    >>> steveholt.a
    [1]
    >>> steveholt('a')
    >>> steveholt.a
    [1, 'a']
    >>> steveholt.a = []
    >>> steveholt.a
    []
    >>> steveholt('zzz')
    >>> steveholt.a
    ['zzz']

    """
    from inspect import stack
    # get scope enclosing calling function
    calling_fn_scope = stack()[2][0]
    # get calling function
    calling_fn_name = stack()[1][3]
    calling_fn = calling_fn_scope.f_locals[calling_fn_name]
    if not hasattr(calling_fn, name):
        setattr(calling_fn, name, factory())
    return getattr(calling_fn, name) 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2021-07-08T18:36:48.127

# 使用装饰器和闭包

以下装饰器可用于创建静态函数变量。它将声明的函数替换为自身的返回值。这意味着装饰函数必须返回一个函数。

```
def static_inner_self(func):
    return func() 
```

然后在一个函数上使用装饰器，该函数返回另一个带有捕获变量的函数：

```
@static_inner_self
def foo():
    counter = 0
    def foo():
        nonlocal counter
        counter += 1
        print(f"counter is {counter}")
    return foo 
```

`nonlocal`是必需的，否则 Python 认为该`counter`变量是局部变量而不是捕获的变量。由于变量 assignment ，Python 的行为如此`counter += 1`。函数中的任何赋值都会使 Python 认为该变量是局部变量。

如果你没有给内部函数中的变量赋值，那么你可以忽略该`nonlocal`语句，例如，在这个函数中我用来缩进一个字符串的行，其中 Python 可以推断出变量是`nonlocal`：

```
@static_inner_self
def indent_lines():
    import re
    re_start_line = re.compile(r'^', flags=re.MULTILINE)
    def indent_lines(text, indent=2):
        return re_start_line.sub(" "*indent, text)
    return indent_lines 
```

PS有一个已删除的答案提出了相同的建议。不知道作者为什么删了。 [https://stackoverflow.com/a/23366737/195417](https://stackoverflow.com/a/23366737/195417)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-08-20T13:27:47.957

基于丹尼尔的回答（补充）：

```
class Foo(object): 
    counter = 0  

def __call__(self, inc_value=0):
    Foo.counter += inc_value
    return Foo.counter

foo = Foo()

def use_foo(x,y):
    if(x==5):
        foo(2)
    elif(y==7):
        foo(3)
    if(foo() == 10):
        print("yello")

use_foo(5,1)
use_foo(5,1)
use_foo(1,7)
use_foo(1,7)
use_foo(1,1) 
```

我想添加这部分的原因是，静态变量不仅用于增加某个值，还用于检查静态变量是否等于某个值，作为一个现实生活中的例子。

静态变量仍然受到保护，仅在函数 use_foo() 的范围内使用

在这个例子中，对 foo() 函数的调用与（相对于相应的 c++ 等价物）完全一样：

```
stat_c +=9; // in c++
foo(9)  #python equiv

if(stat_c==10){ //do something}  // c++

if(foo() == 10):      # python equiv
  #add code here      # python equiv       

Output :
yello
yello 
```

如果类 Foo 被限制性地定义为单例类，那将是理想的。这将使它更加pythonic。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-07-28T09:38:44.480

我编写了一个简单的函数来使用静态变量：

```
def Static():
    ### get the func object by which Static() is called.
    from inspect import currentframe, getframeinfo
    caller = currentframe().f_back
    func_name = getframeinfo(caller)[2]
    # print(func_name)
    caller = caller.f_back
    func = caller.f_locals.get(
        func_name, caller.f_globals.get(
            func_name
        )
    )

    class StaticVars:
        def has(self, varName):
            return hasattr(self, varName)
        def declare(self, varName, value):
            if not self.has(varName):
                setattr(self, varName, value)

    if hasattr(func, "staticVars"):
        return func.staticVars
    else:
        # add an attribute to func
        func.staticVars = StaticVars()
        return func.staticVars 
```

如何使用：

```
def myfunc(arg):
    if Static().has('test1'):
        Static().test += 1
    else:
        Static().test = 1
    print(Static().test)

    # declare() only takes effect in the first time for each static variable.
    Static().declare('test2', 1)
    print(Static().test2)
    Static().test2 += 1 
```

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2016-01-26T17:40:11.607

当然这是一个老问题，但我想我可能会提供一些更新。

看来性能论点已经过时了。对于 siInt_try 和 isInt_re2，相同的测试套件似乎给出了相似的结果。当然结果会有所不同，但这是在我的计算机上使用 python 3.4.4 在内核 4.3.01 上使用 Xeon W3550 进行的一次会话。我已经运行了几次，结果似乎相似。我将全局正则表达式移到函数静态中，但性能差异可以忽略不计。

```
isInt_try: 0.3690
isInt_str: 0.3981
isInt_re: 0.5870
isInt_re2: 0.3632 
```

解决了性能问题，try/catch 似乎会产生最面向未来和最极端的代码，所以也许只是将它包装在函数中

# php - 哪个 PHP 单元测试框架：simpletest、phpunit 还是？

> ID：279564
> 
> 赞同：14
> 
> 时间：2008-11-10T23:35:11.037
> 
> 标签：php, unit-testing, phpunit, simpletest

我是[simpletest](http://www.simpletest.org/)的忠实粉丝，因为这是我所知道的。它对模拟和网络测试有很好的支持。

但我总是害怕停滞不前，所以任何令人信服的转换论点都会受到赞赏。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T13:33:33.370

我认为两者都不会很快消失。Simpletest 由一小群人维护。

PHPUnit 似乎拥有更大的用户群，这可以算作切换的参数。不过，我对 Simpletest 很满意。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T10:49:10.537

我自己没有使用过 SimpleTest，所以我不能说太多比较。只是通过观察，PHPUnit 语法似乎更加冗长。

[PHPUnit 手册](http://www.phpunit.de/pocket_guide/3.3/en/index.html)是一个很好的文档来源，涵盖了框架的大部分领域。我对手册的唯一抱怨是某些区域缺乏细节。

我使用 PHPUnit 而不是 SimpleTest 的主要原因是它具有出色的[Phing](http://phing.info/trac/)集成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T01:25:49.673

我刚刚回答[了一个类似的问题](https://stackoverflow.com/questions/282150/how-do-i-write-unit-tests-in-php)，并补充说有[phpt](http://qa.php.net/write-test.php)。phpt 也集成到 PHPUnit 中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-26T09:47:55.043

我会推荐 behat (+mink) [http://behat.org/](http://behat.org/)

它是功能/集成测试，但它在更短的时间内涵盖了更多的代码......

PS 实际上，您可以使用它来编写单元/测试，但这有点矫枉过正......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-04T06:52:39.410

我不知道你是否想切换本身，但我喜欢*phpt*用于测试小型代码库或尽早而不是稍后进行测试，如果现有库中没有需要测试的库.

*phpt*的扩展性不如 Simpletest，但同样是适合工作的正确工具。看看[这篇文章](http://quickshiftin.com/blog/2013/10/practical-phpt/)，进行深入讨论，让你更上一层楼。

# sql - sql中的索引表达式

> ID：279572
> 
> 赞同：1
> 
> 时间：2008-11-10T23:40:14.567
> 
> 标签：sql, indexing

我有一个数据库，其中一个常见查询是“blobCol 为空”，我认为这会导致性能下降（如在全表扫描中）。我不需要索引 blobCol 的内容。

哪些指标可以改善这一点？是否可以在表达式（blobCol 不为空）而不只是列上构建索引？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T23:44:06.150

是的，大多数 DBMS 都支持它，例如在[PostgreSQL](http://www.postgresql.org/docs/8.2/static/sql-createindex.html)中

```
CREATE INDEX notNullblob ON myTable (blobCol is not NULL); 
```

似乎您可以在 SQL Server 上做的最好的事情是创建一个[计算列](http://msdn.microsoft.com/en-us/library/ms189292.aspx)，例如，如果 blob 为空，则包含 1，否则为 0，并在其上创建索引。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T23:43:02.313

一些数据库允许对表达式进行索引，但普通索引应该会显着减少查询的运行时间。

# javascript - JavaScript：动态字段名称

> ID：279575
> 
> 赞同：2
> 
> 时间：2008-11-10T23:42:41.067
> 
> 标签：javascript, parsing

大家好，

我有一段 javaScript 从提供的字符串中删除逗号（在我的情况下是货币值）

这是：

```
 function replaceCommaInCurrency(myField, val)
    {
        var re = /,/g;

        document.net1003Form.myField.value=val.replace(re, '');
    } 
```

“MyField”是我尝试在我传入的任何字段上动态进行这项工作，但它不起作用，我收到错误消息说“MyField”无效。我有点明白，但我认为这是有效的。

我通过以下方式调用：onBlur="replaceCommaInCurrency(this.name, this.value);return false;"

this.name 和 this.value 传入正确的值...字段名称及其值。

我如何动态地做到这一点？

-杰森

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T23:56:25.860

您可以使用 eval 使您的代码段工作：

```
eval("document.net1003Form." + myField + ".value=val.replace(re, '');"); 
```

如下所述，方括号有效（并且不像 eval 那样糟糕），我忘记了这些是愚蠢的：

```
document.net1003Form[myField].value=val.replace(re, ''); 
```

或者，尝试这样的事情：

```
function replaceCommaInCurrency(field){
    var re = /,/g;
    field.value = field.value.replace(re, '');
} 
```

像这样调用它：

```
onBlur="replaceCommaInCurrency(this); return false"; 
```

您应该考虑使用 javascript 工具包来处理此类事情。您可以在每个输入上设置一个类似于“货币”的类，然后使用这个基于 jQuery 的 Javascript 片段来处理所有内容：

```
$(function(){
    $("input.currency").bind('blur', function(){
        this.value = $(this).val().replace(',', '');
    })
}); 
```

此代码将在文档准备就绪时触发，将事件处理程序附加到每个输入，并将货币作为其类，然后进行替换。请注意，您也不需要正则表达式来替换。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T23:55:18.763

如果您像这样将其直接编码到标记中，例如 onblur="replaceCommaInCurrency(this)"，则发起事件的控件将作为参数传递。然后你应该能够做类似的事情：

```
myField.value = myField.value.replace(re, ''); 
```

使用 jQuery：

```
var jqField = $(myField);
jqField.val(jqField.val().replace(re, '')); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T00:01:49.110

通常，您应该使用可以处理此类低级功能的框架，但您的问题的具体答案是对字段名称使用括号表示法：

```
function replaceCommaInCurrency( myField, val)
{
  var re = /,/g;

  document.net1003Form[myField].value=val.replace(re, '');
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T23:59:49.380

```
 function removeCommaInCurrency(myField)
    {
            var re = /,/g;

            myField.value=myField.value.replace(re, '');
    } 
```

-- 然后这样称呼它：

```
<input type="text" name="..." onchange="removeCommaInCurrency(this);"> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T01:26:24.010

flatline 和 roenving 的 'this' 解决方案是更简洁的方法，它也避免了 'document.formname.fieldname' 的问题。

（使用 'document.forms.formname' 访问表单，不会在与文档对象成员具有相同名称的表单上发生冲突，并且使用 'forms.elements.fieldname' 对字段执行相同操作。像所有 JavaScript 对象一样，对象[namevariable] 也可以使用。或者，更好的是，添加 ID 并使用明确的 document.getElementById 方法。）

通过将绑定移动到脚本中，您还可以删除 onclick 属性的内联 JavaScript，从而使标记更清晰：

```
<input type="text" class="number" name="something" />
...
<script type="text/javascript"> // external script is best, linked after all forms
    function numberfield_bind() {
        var inputs= document.getElementsByTagName('input');
        for (var inputi= inputs.length; inputi-->0;)
            if (inputs[inputi].className=='number')
                inputs[inputi].onchange= numberfield_change;
    }
    function numberfield_change() {
        this.value= this.value.split(',').join('');
    }
    numberfield_bind();
</script> 
```

# html - 将 Paypal 集成到 HTML 页面中

> ID：279577
> 
> 赞同：0
> 
> 时间：2008-11-10T23:42:50.850
> 
> 标签：html, paypal

我有一个卖衬衫的客户。她希望潜在买家能够选择尺寸和颜色，并为每种尺寸和颜色提供数量选项。

我发现一些代码可以计算订单总额，但没有数量选项。

我附上了下面的代码。任何人都可以引导我朝着正确的方向前进吗？我对 PayPal 进行定制还很陌生，但我是一名网页设计师，所以我不是解决问题的初学者。我还附上了她通过电子邮件发送的客户表格的屏幕截图，以显示她想要的样子。

任何帮助将不胜感激。谢谢。

[替代文字 http://www.inauguraldayt-shirts.com/shirt.jpg](http://www.inauguraldayt-shirts.com/shirt.jpg)

```
<!-- Start of Script -->  
<SCRIPT type=text/javascript>
<!--
function Dollar (val) {  // force to valid dollar amount
var str,pos,rnd=0;
  if (val < .995) rnd = 1;  // for old Netscape browsers
  str = escape (val*1.0 + 0.005001 + rnd);  // float, round, escape
  pos = str.indexOf (".");
  if (pos > 0) str = str.substring (rnd, pos + 3);
  return str;
}function ReadForm (obj1, tst) { // process radio and checkbox
var i,j,amt=0,des="",obj,pos,val,tok,tag,
  op1a="",op1b="",op2a="",op2b="",itmn="";
var ary = new Array ();
  if (obj1.baseamt) amt  = obj1.baseamt.value*1.0;  // base amount
  if (obj1.basedes) des  = obj1.basedes.value;  // base description
  if (obj1.baseon0) op1a = obj1.baseon0.value;  // base options
  if (obj1.baseos0) op1b = obj1.baseos0.value;
  if (obj1.baseon1) op2a = obj1.baseon1.value;
  if (obj1.baseos1) op2b = obj1.baseos1.value;
  if (obj1.baseitn) itmn = obj1.baseitn.value;
  for (i=0; i<obj1.length; i++) {  // run entire form
    obj = obj1.elements[i];        // a form element
    if (obj.type == "checkbox" ||  // checkboxes
        obj.type == "radio") {     //  and radios
      if (obj.checked) {           // did user check it?
        val = obj.value;           // the value of the selection
        ary = val.split (" ");          // break apart
        for (j=0; j<ary.length; j++) {  // look at all items
// first we do single character tokens...
          if (ary[j].length < 2) continue;
          tok = ary[j].substring (0,1); // first character
          val = ary[j].substring (1);   // get data
          if (tok == "@") amt = val * 1.0;
          if (tok == "+") amt = amt + val*1.0;
          if (tok == "%") amt = amt + (amt * val/100.0);
          if (tok == "#") {             // record item number
            if (obj1.item_number) obj1.item_number.value = val;
          ary[j] = "";                // zap this array element
          }
// Now we do 3-character tokens...
          if (ary[j].length < 4) continue;
          tok = ary[j].substring (0,3); // first 3 chars
          val = ary[j].substring (3);   // get data
          if (tok == "s1=") {           // value for shipping
            if (obj1.shipping)  obj1.shipping.value  = val;
            ary[j] = "";                // clear it out
          }
          if (tok == "s2=") {           // value for shipping2
            if (obj1.shipping2) obj1.shipping2.value = val;
            ary[j] = "";                // clear it out
          }
        }
        val = ary.join (" ");           // rebuild val with what's left        tag = obj.name.substring (obj.name.length-2);  // get flag
        if      (tag == "1a") op1a = op1a + " " + val;
        else if (tag == "1b") op1b = op1b + " " + val;
        else if (tag == "2a") op2a = op2a + " " + val;
        else if (tag == "2b") op2b = op2b + " " + val;
        else if (tag == "3i") itmn = itmn + " " + val;
        else if (des.length == 0) des = val;
        else des = des + ", " + val;
      }
    }
  }
// Now summarize stuff we just processed, above
  if (op1a.length > 0) obj1.on0.value = op1a;
  if (op1b.length > 0) obj1.os0.value = op1b;
  if (op2a.length > 0) obj1.on1.value = op2a;
  if (op2b.length > 0) obj1.os1.value = op2b;
  if (itmn.length > 0) obj1.item_number.value = itmn;
  obj1.item_name.value = des;
  obj1.amount.value = Dollar (amt);
  if (obj1.tot) obj1.tot.value = "$" + Dollar (amt);
}
//-->
</SCRIPT>
<!-- End of Script --> 

    <div id="button">
    <!-- Another method for the View Cart Form - add this code anywhere within the web page -->

<!-- This is the FORM to view the cart contents -->
<!-- Note: target="paypal" was replaced with the variable target="_self" -->
<!-- Note: shopping_url also added to code -->
<!-- These two changes allow better functionality with IE and Firefox -->
<form target="_self" action="https://www.paypal.com/cgi-bin/webscr" method="post" id="viewcart" name="viewcart">
<p>
<input type="hidden" name="cmd" value="_cart">
<input type="hidden" name="display" value="1">
<input type="hidden" name="business" value="you@you.com">
<input type="hidden" name="shopping_url" value="http://www.yourwebsite.com/your_page.html">
</p>
</form>
<!-- End of the viewcart FORM -->

<!-- Start of Form -->
<!-- Note: target="paypal" was replaced with the variable target="_self" -->
<!-- Note: shopping_url also added to code -->
<!-- These two changes allow better functionality with IE and Firefox -->
<FORM onsubmit="this.target='_self';&#10; return ReadForm(this, true);" action=https://www.paypal.com/cgi-bin/webscr method=post>
<input type="hidden" name="cmd" value="_cart">
<input type="hidden" name="add" value="1">
<input type="hidden" name="business" value="you@you.com">
<input type="hidden" name="item_name" value="">
<input type="hidden" name="amount" value="">
<input type="hidden" name="currency_code" value="USD">
<input type="hidden" name="lc" value="US">
<input type="hidden" name="bn" value="PP-ShopCartBF">
<input type="hidden" name="shopping_url" value="http://www.yourwebsite.com/your_page.html">
<input type="hidden" name="cancel_return" value="http://www.yourwebsite.com/Cancel.html">
<input type="hidden" name="return" value="http://www.yourwebsite.com/Success.html">

<input type="hidden" value="0.00" name="baseamt">
<input type="hidden" value="Inaugural Day T-Shirt - @17.99" name="basedes">

Inaugural Day T-Shirt - $17.99
<br><br>

Colors
<br><br>  
<input onclick="ReadForm (this.form, false);" type=checkbox value="White +17.99"> White - $17.99
Select Quantity:&nbsp;&nbsp;
<select name="quantity">
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
</select>
<br>
<input onclick="ReadForm (this.form, false);" type=checkbox value="Blue +17.99"> Blue - $17.99
<br>
<input onclick="ReadForm (this.form, false);" type=checkbox value="Black +17.99"> Black - $17.99

<br><br><br>

Sizes
<br><br>
<input onclick="ReadForm (this.form, false);" type=checkbox value="Small +17.99"> Small - $17.99
<br>
<input onclick="ReadForm (this.form, false);" type=checkbox value="Medium +17.99"> Medium - $17.99
<br>
<input onclick="ReadForm (this.form, false);" type=checkbox value="Large +17.99"> Large - $17.99
<br>
<input onclick="ReadForm (this.form, false);" type=checkbox value="XL +19.99"> XL - $19.99
<br>
<input onclick="ReadForm (this.form, false);" type=checkbox value="XXL +19.99"> XXL - $19.99
<br>
<input onclick="ReadForm (this.form, false);" type=checkbox value="XXXL +19.99"> XXXL - $19.99

<br><br><br>

<input onclick="this.form.reset ();" type=button value="Reset Form">&nbsp; Item Total &gt;
<input class=nbor size=6 value=$0.00 name=tot> &nbsp;

<br><br>
<input type=image alt="cart add" src="https://www.paypal.com/en_US/i/btn/btn_cart_LG.gif" name=submit>

<br><br>
<input onclick="document.forms.viewcart.target = '_self';&#10; document.forms.viewcart.submit ();&#10; return false;" type=image alt="cart view" src="https://www.paypal.com/en_US/i/btn/btn_viewcart_LG.gif""> 
</FORM>
<!-- End of Form --> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T23:53:42.887

对于基本的 HTML 页面，使用 PayPal 自己的按钮向导。只需转到商家服务 -> 添加到购物车按钮。它将允许您自定义按钮以通过下拉列表指定不同的尺寸，甚至在将商品添加到购物车时选择数量。您还可以添加“查看购物车”按钮，一切都会为您处理好。我在最近的一个网站上使用了这个。

允许添加商品和查看购物车会将用户带到 PayPal 页面，但除非他们正在寻找一个完全集成的网站，否则此选项快速、简单且强大。此外，PayPal 在跟踪订单页面的来源方面做得很好，因此用户可以轻松导航回来。

# .net - 关闭 .net JIT 编译器优化

> ID：279582
> 
> 赞同：7
> 
> 时间：2008-11-10T23:45:16.757
> 
> 标签：.net, clr, remoting, jit

当我们远程一个方法（即使用泛型）时，远程接收器似乎无法从其他相同命名的方法中发现我们的方法。使用附加的.net 源代码进行调试我已经把它带到了有`MethodInfo.MakeGenericMethod`调用的地方。但是，我无法查看任何周围的数据，因为它已经过 jit 优化。

几周前，我遇到了一个注册表设置，它会禁用此设置（它特别提到它有助于使用源代码进行调试）。然而，作为一个沃利，我已经失去了我对它所做的事情，并且很难再次找到它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T23:49:08.917

我不知道注册表解决方案，但您可以使用 INI 文件来禁用 JIT 优化。

简短的版本是创建一个包含以下内容的 .ini 文件（即 myapp.ini）。

```
[.NET Framework Debugging Control]
GenerateTrackingInfo=1
AllowOptimize=0 
```

[完整的解释在这里](http://blogs.msdn.com/jaredpar/archive/2008/08/29/disabling-jit-optimizations-while-debugging.aspx)

# javafx - JavaFX 中的图像宽度绑定

> ID：279583
> 
> 赞同：0
> 
> 时间：2008-11-10T23:45:31.607
> 
> 标签：javafx

我有一个非常基本的应用程序，我认为它应该改变图像的宽度，但它什么也没做......谁能告诉我为什么，当我点击图像时，图像没有任何反应？

*（注意，图像本身并不重要，我只是想弄清楚如何在 JavaFX 中缩小和增长和图像）*

```
import javafx.application.Frame;
import javafx.application.Stage;
import javafx.scene.image.ImageView;
import javafx.scene.image.Image;
import javafx.input.MouseEvent;

var w:Number = 250;

Frame {
    title: "Image View Sample"
    width: 500
    height: 500
    closeAction: function() { 
        java.lang.System.exit( 0 ); 
    }
    visible: true

    stage: Stage {
        content: [
            ImageView {
                x: 200;
                y: 200;
                image: Image {
                    url: "{__DIR__}/c1.png"
                    width: bind w;
                }

                onMouseClicked: function( e: MouseEvent ):Void {
                    w = 100;
                }
            }
        ]
    }
} 
```

多谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T09:32:39.260

感谢您的回复，很抱歉延迟回复您，但事实证明您需要做的就是绑定图像本身：

```
image: bind Image {
    url: "{__DIR__}/time.png"
    width: w;
} 
```

这似乎起到了作用，我个人觉得这有点误导，但是嘿，它有效

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T22:58:54.603

尝试绑定比例属性：

```
import java.lang.System;
import javafx.application.Frame;
import javafx.application.Stage;
import javafx.scene.image.ImageView;
import javafx.scene.image.Image;
import javafx.input.MouseEvent;

var w:Number = 1;

Frame {
    title: "Image View Sample"
    width: 500
    height: 500
    closeAction: function() { 
        java.lang.System.exit( 0 ); 
    }
    visible: true

    stage: Stage {
        content: [
            ImageView {
                x: 200
                y: 200
                anchorX:200 
                anchorY:200
                scaleX:bind w
                scaleY:bind w
                image: Image {
                    url: "{__DIR__}/time.png"                    
                }

                onMouseClicked: function( e: MouseEvent ):Void {
                    w += 0.1;                    
                }
            }
        ]
    }
} 
```

# c++ - Boost.Lambda：插入不同的数据结构

> ID：279601
> 
> 赞同：2
> 
> 时间：2008-11-10T23:53:51.857
> 
> 标签：c++, boost-lambda

我有一个`vector`我想插入到`set`. 这是三个不同的调用之一（另外两个更复杂，涉及`boost::lambda::if_()`），但解决这个简单的案例将帮助我解决其他问题。

```
std::vector<std::string> s_vector;
std::set<std::string> s_set;
std::for_each(s_vector.begin(), s_vector.end(), s_set.insert(boost::lambda::_1)); 
```

不幸的是，这会失败并显示转换错误消息（尝试转换`boost::lambda::placeholder1_type`为`std::string`）。

所以……这有什么问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T00:39:31.250

> 该错误非常糟糕，但归结为它无法确定要使用哪个 set::insert ，因为存在三个重载。

您可以通过指定一个指向您希望使用的函数的指针来帮助 bind 帮助解决歧义：

```
typedef std::set<std::string> s_type;
typedef std::pair<s_type::iterator, bool>(s_type::*insert_fp)(const s_type::value_type&);
std::for_each(s_vector.begin(), s_vector.end(), boost::bind(static_cast<insert_fp>(&s_type::insert), &s_set, _1)); 
```

它不漂亮，但它应该工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T01:00:24.623

我会使用一个for循环:-D

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T02:38:57.467

要将向量复制到集合中，可以使用 std::copy 和插入迭代器。就像是：

```
std::copy(s_vector.begin(), s_vector.end(), std::inserter(s_set, s_set.end())); 
```

当然，这根本不使用 boost::lambda，因此它可能无法帮助您将其概括为做您想做的事情。最好更多地了解您在这里尝试做的事情。根据您对 lambda::_if 的提及，我将假设您的 lambda 将在插入集合之前对输入向量进行某种过滤。

以下（完整的，经过测试的）示例显示了如何仅将 <= 4 个字符的字符串从向量复制到集合中：

```
#include <boost/assign/list_of.hpp>
#include <boost/lambda/lambda.hpp>
#include <boost/lambda/bind.hpp>
#include <boost/test/minimal.hpp>

#include <set>
#include <vector>
#include <algorithm>

using namespace std;
using namespace boost::lambda;
using namespace boost::assign;

int test_main(int argc, char* argv[])
{
    vector<string> s_vector = list_of("red")("orange")("yellow")("blue")("indigo")("violet");
    set<string> s_set;

    // Copy only strings length<=4 into set:

    std::remove_copy_if(s_vector.begin(), s_vector.end(), std::inserter(s_set, s_set.end()),
                        bind(&string::length, _1) > 4u);

    BOOST_CHECK(s_set.size() == 2);
    BOOST_CHECK(s_set.count("red"));
    BOOST_CHECK(s_set.count("blue"));

    return 0;
} 
```

希望这能给你一些东西吗？

还要让我重申上面的观点， boost::bind 和 boost::lambda::bind 是两种不同的野兽。从概念上讲，它们是相似的，但它们产生不同类型的输出。只有后者可以与其他 lambda 运算符结合使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T00:20:09.480

我认为问题的一部分`for_each()`是期待一个仿函数，而您将函数调用的结果传递给它。因此，您的代码将`vector<string>::insert()`首先调用，然后将该调用的结果传递给`for_each()`. 我不确定确切的语法，但我认为您想在这里结合使用 bind 和 lambda 。例如

```
for_each(s_vector.begin(), s_vector.end(),
         boost::bind(set<string>::insert, s_set, boost::lambda::_1)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T00:34:17.047

不幸的是，这：

```
std::for_each(s_vector.begin(), s_vector.end(),
        lambda::bind(&std::set<std::string>::insert, s_set, lambda::_1)); 
```

不起作用。（请注意，我使用了 set::insert，因为这就是 s_set 的含义。）该错误非常糟糕，但归结为它无法确定要使用哪个 set::insert，因为存在三个重载。我尝试使用的是返回 pair::iterator, bool> （插入值）的集合。显然，这是行不通的。

我注意到你使用了 boost::bind，而不是 boost::lambda::bind——这是故意的吗？（它们的工作方式似乎有些不同。）

我认为您期望函子而不是函数调用结果是正确的；我确信这可以变成函子，但我的大脑现在没有看到答案。

谢谢。

# ruby-on-rails - ruby/mysql mysql_adapter.rb:505:in 'real_connect': 无法将字符串转换为整数

> ID：279603
> 
> 赞同：2
> 
> 时间：2008-11-10T23:54:43.943
> 
> 标签：ruby-on-rails, ruby, typeerror

我今天早上进来，像往常一样启动了我的应用程序，然后开始出现这个错误。从那时起，我一直在走我能想到的每一条路——直到在我的机器上删除和重新安装每一个 ruby​​/rails 软件，包括 mysql。我已将我的应用程序简化为以下内容。

```
require 'rubygems'
require 'active_record'

class Job < ActiveRecord::Base

end

ActiveRecord::Base.establish_connection(
    :adapter     => "mysql",
    :host        => "192.168.254.22",  (I've also tried 127.0.0.1)
    :port        => "3306",
    :database    => "databasethingie",
    :username    => "root",
    :password    => "rootpassword"
) 
```

job = Job.find(:first) 这是在运行 Instant Rails 2.0 的 Windows 盒子上。

我仍然收到错误：

```
c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/mysql_adapter.rb:505:in `real_connect': can't convert String into Integer (TypeError)
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/mysql_adapter.rb:505:in `connect'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/mysql_adapter.rb:183:in `initialize'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/mysql_adapter.rb:88:in `new'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/mysql_adapter.rb:88:in `mysql_connection'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/abstract/connection_specification.rb:292:in `send'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/abstract/connection_specification.rb:292:in `connection='
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/abstract/connection_specification.rb:260:in `retrieve_connection'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/abstract/connection_specification.rb:78:in `connection'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/base.rb:2693:in `quoted_table_name'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/base.rb:1469:in `construct_finder_sql'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/base.rb:1341:in `find_every'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/base.rb:1303:in `find_initial'
        from c:/InstantRails/ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/base.rb:534:in `find'
        from tmp.rb:17 
```

我已经看到有关此的帖子提到了在 1.5.2 天内修复的错误，但我是最新的。2.1.2等这里发生了什么？我想知道这是否与最近对数据库配置的更改（授予 root 权限）有关，但重新安装似乎证明并非如此。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T23:59:03.453

你试过了吗：

```
:port => 3306 
```

# sql - 创建 DB2 历史表触发器

> ID：279610
> 
> 赞同：4
> 
> 时间：2008-11-10T23:58:34.577
> 
> 标签：sql, database, db2, history, triggers

我想创建一个历史表来跟踪 DB2 中多个表的字段更改。

我知道历史通常是通过复制整个表的结构并给它一个后缀名来完成的（例如 user --> user_history）。然后，您可以使用一个非常简单的触发器将旧记录复制到 UPDATE 的历史记录表中。

但是，对于我的应用程序，这会占用太多空间。每次字段更改时将整个记录复制到另一个表似乎不是一个好主意（至少对我而言）。所以我想我可以有一个通用的“历史”表来跟踪各个字段的变化：

```
CREATE TABLE history
(
    history_id LONG GENERATED ALWAYS AS IDENTITY,
    record_id INTEGER NOT NULL,
    table_name VARCHAR(32) NOT NULL,
    field_name VARCHAR(64) NOT NULL,
    field_value VARCHAR(1024),
    change_time TIMESTAMP,
    PRIMARY KEY (history_id)
); 
```

好的，所以我要跟踪的每个表都有一个自动生成的 id 字段作为主键，它将被放入“record_id”字段中。并且表中的最大 VARCHAR 大小为 1024。显然，如果非 VARCHAR 字段发生更改，则必须在将记录插入历史表之前将其转换为 VARCHAR。

现在，这可能是一种完全迟钝的做事方式（嘿，如果是这样，请告诉我为什么），但我认为这是一种跟踪更改的好方法，这些更改需要很少被拉起并且需要存储一段时间多少时间。

无论如何，我需要帮助编写触发器以在更新时将记录添加到历史表中。让我们以一个假设的用户表为例：

```
CREATE TABLE user
(
   user_id INTEGER GENERATED ALWAYS AS IDENTITY,
   username VARCHAR(32) NOT NULL,
   first_name VARCHAR(64) NOT NULL,
   last_name VARCHAR(64) NOT NULL,
   email_address VARCHAR(256) NOT NULL
   PRIMARY KEY(user_id)
); 
```

那么，任何人都可以帮助我触发更新用户表以将更改插入历史表吗？我的猜测是需要使用一些过程 SQL 来遍历旧记录中的字段，将它们与新记录中的字段进行比较，如果它们不匹配，则在历史表中添加一个新条目。

如果可能的话，最好对每个表使用相同的触发器操作 SQL，而不管其字段如何。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T07:42:16.717

我认为这不是一个好主意，因为在一个不止一个值发生变化的大表中，每个值都会产生更多开销。但这取决于您的应用程序。

此外，您应该考虑这种历史表的实用价值。您必须将很多行放在一起才能了解更改的值的上下文，并且它要求您编写另一个应用程序，该应用程序只为最终用户执行这种复杂的历史逻辑。对于数据库管理员来说，从历史中恢复值会很麻烦。

听起来可能有点刺耳，但这不是本意。我们店里一位经验丰富的程序员通过表格日志有一个类似的想法。他启动并运行它，但它吞噬了磁盘空间，就像没有明天一样。

想想你的历史表应该真正完成什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T01:40:39.060

```
CREATE TABLE HIST.TB_HISTORY ( 
    HIST_ID     BIGINT GENERATED ALWAYS AS IDENTITY (START WITH 0, INCREMENT BY 1, NO CACHE) NOT NULL,
    HIST_COLUMNNAME     VARCHAR(128) NOT NULL,
    HIST_OLDVALUE       VARCHAR(255),
    HIST_NEWVALUE       VARCHAR(255),
    HIST_CHANGEDDATE    TIMESTAMP NOT NULL
    PRIMARY KEY(HIST_SAFTYNO)
)
GO

CREATE TRIGGER COMMON.TG_BANKCODE AFTER
UPDATE OF FRD_BANKCODE ON COMMON.TB_MAINTENANCE
REFERENCING OLD AS oldcol NEW AS newcol FOR EACH ROW MODE DB2SQL
WHEN(COALESCE(newcol.FRD_BANKCODE,'#null#') <> COALESCE(oldcol.FRD_BANKCODE,'#null#'))
BEGIN ATOMIC

    CALL FB_CHECKING.SP_FRAUDHISTORY_ON_DATACHANGED(
                newcol.FRD_FRAUDID,
                'FRD_BANKCODE',
                oldcol.FRD_BANKCODE,
                newcol.FRD_BANKCODE,
                newcol.FRD_UPDATEDBY
    );--

    INSERT INTO FB_CHECKING.TB_FRAUDMAINHISTORY(        
        HIST_COLUMNNAME, 
        HIST_OLDVALUE, 
        HIST_NEWVALUE, 
        HIST_CHANGEDDATE 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T16:42:34.737

您是否考虑过将此作为一个两步过程？实现一个简单的触发器，记录整行的原始版本和更改版本。然后编写一个单独的程序，该程序每天运行一次，以提取上述更改的字段。

这使触发器更简单、更安全、更快，并且您可以有更多选择来实施后处理步骤。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T19:08:27.517

我们在我们的 SQL Server 数据库上做了类似的事情，但是审计表是针对每个被审计的单独的表（一个中央表会很大，因为我们的数据库有很多千兆字节）

您需要做的一件事是确保您还记录了谁进行了更改。您还应该将旧值和新值一起记录（如果需要，可以更轻松地放回数据）和更改类型（插入、更新、删除）。您没有提到从表中记录删除，但我们发现这些是我们最常使用该表的一些事情。

我们使用动态 SQl 生成代码来创建审计表（通过使用存储系统信息的表）并且所有审计表具有完全相同的结构（使得更容易获取数据）。

当您创建代码以将数据存储在历史记录表中时，如果需要，还可以创建代码以恢复数据。当需要恢复某些东西并且您面临来自高级管理层的压力要求现在完成它时，这将节省大量时间。

现在我不知道您是否打算从历史记录表中恢复数据，但是一旦您拥有了一次，我可以保证管理层会希望以这种方式使用它。

# cocoa - 是否可以使用 KVO 访问代理对象的先前/当前值？

> ID：279615
> 
> 赞同：1
> 
> 时间：2008-11-11T00:00:22.000
> 
> 标签：cocoa, key-value-observing

我有一个 NSArrayController，我正在使用 KVO 来观察它的选择方法的旧/新值。

这完美地工作（在选择更改时触发，通常情况下），除了更改字典中的项目全部为空而不是旧/新选定对象。[arrayController selection] 仍然返回正确的对象，但如果可能的话，我希望能够访问先前选择的对象（我的解决方法可能是观察选定的索引，看看它是否有效）。

我想出的唯一可能的原因可能是因为 NSArrayController 是一个代理对象。

那么这是预期的行为，还是发生了一些奇怪的事情？

编辑：我尝试只观察索引，但这也不起作用。旧键和新键仍然显示为空。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-10-27T00:33:13.990

[mmalc 的 Cocoa 绑定页面](http://homepage.mac.com/mmalc/CocoaExamples/controllers.html)说：

> 更改字典不包含旧值和新值。这不是你的错，这是由于控制器中的错误。在可预见的将来不会修复此错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T01:48:09.380

对于普通的 KVO（与绑定相反），请尝试观察 selectedObjects 属性而不是 selection 属性。这将为您提供一个简单的对象数组，而不是 Cocoa 绑定系统使用的代理对象。我相信旧/新键应该以这种方式准确反映选择的变化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-03T06:36:56.777

您是否使用`NSKeyValueObservingOptionNew`, 和`NSKeyValueObservingOptionOld`的选项`addObserver:forKeyPath:options:context:`？

如果您可以向我们展示一些代码，那将会很有帮助。

# flash - Flash 加载器和拖动

> ID：279631
> 
> 赞同：0
> 
> 时间：2008-11-11T00:06:47.197
> 
> 标签：flash

我正在尝试加载一个外部 swf 电影，然后添加在舞台上拖动它的能力，但是每当我尝试这样做时，我都会遇到死胡同。您可以设置可拖动或可点击的内容是否有任何限制？我正在做的一个例子如下：

```
public function loadSwf(url:String, swfUniqueName:String)
        {
            var ldr:Loader = new Loader();

            var url:String = "Swfs/Label.swf";
            var urlReq:URLRequest = new URLRequest(url);
            ldr.load(urlReq);

            ldr.contentLoaderInfo.addEventListener("complete", loadCompleteHandler);
        }

        private function loadCompleteHandler(event):void{
            var ldr = event.currentTarget;          

                    // These are only here because I can't seem to get the drag to work
            ldr.content.doubleClickEnabled = true;
            ldr.content.buttonMode = true;
            ldr.content.useHandCursor = true;
            ldr.content.mouseEnabled = true;
            ldr.content.txtLabel.mouseEnabled = true;           

            this.addChild(ldr.content);

            ldr.content.addEventListener(MouseEvent.MOUSE_DOWN, mouse_down);

        }

            mouse_down = function(event) {
        trace(event.target);
    } 
```

使用上面的代码，如果点击文本字段，我只能让它识别对电影本身的点击，但这确实需要在电影的任何部分上工作。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T20:30:38.303

如果您的内容中有空白空间，Flash 会将其视为您已单击通过剪辑进入下面的阶段。尝试在您正在加载的内容的底层添加一个透明方块。

也尝试设置：

`ldr.content.mouseChildren = false;`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T18:26:01.673

有点像在黑暗中拍摄，但你能在加载的电影顶部制作一个透明的电影剪辑，然后拖动它，将 swf 移动到下面吗？

# javascript - Javascript：var 为空

> ID：279634
> 
> 赞同：1
> 
> 时间：2008-11-11T00:08:12.670
> 
> 标签：javascript, html, null

我有这段 Javascript，但它不起作用。我已经检查过 JSlint，但说一切正常。还是不行。javascript 不在 HTML 中，而是在`<head>`

注意：我正在使用本地服务器，因此可以立即进行页面加载。

```
function changeVisibility() {
    var a = document.getElementById('invisible');
    a.style.display = 'block';
}

var changed = document.getElementById('click1');
changed.onchange = changeVisibility; 
```

这是对应的HTML

```
<input type="file" name="click[]" size="35" id="click1" />
<div id="invisible" style="display: none;">
  <a href="javascript:addFileInput();">Attach another File</a>
</div> 
```

所以会发生什么是我点击输入，选择一个文件并批准。然后 onchange 事件触发，我的不可见 div 的样式设置为阻止。

问题是，我不断收到此错误：

“更改为空：changed.onchange = changeVisibility;”

我不明白，我真的不明白我在这里俯瞰的东西。

* * *

编辑：问题已回答，感谢 Mercutio 的帮助，当然也感谢其他所有人。最终代码：

```
function loadEvents() {
    var changed = document.getElementById('click1');
    var a = document.getElementById('invisible');
    document.getElementById('addField').onclick = addFileInput;

    changed.onchange = function() {
        a.style.display = 'block';
    }
}
if (document.getElementById) window.onload = loadEvents; 
```

这是相应的 HTML：

```
<input type="file" name="click[]" size="35" id="click1" />
<div id="invisible" style="display: none;">
  <a href="#">Attach another File</a>
</div> 
```

另外，感谢[JSbin](http://www.jsbin.com)的链接，不知道，看起来很漂亮。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T00:12:39.820

这听起来好像 DOM 对象在引用它时不存在。可能在文档完全加载后更改您的代码以执行（或将 javascript 放在页面底部）

> 注意：我正在使用本地服务器，因此可以立即进行页面加载。

这不是问题 - 文档的组成部分是按顺序加载的。不管加载速度有多快，有些事情会先于其他事情发生：D

> 我现在唯一想做的就是从...中删除 Javascript 链接

在那里放置一个 id，然后在你的函数中执行以下操作：

```
document.getElementById('addField').onclick = addFileInput; 
```

或者，因为您已经将 div 作为变量“a”：

```
a.firstChild.onclick = addFileInput; 
```

但这显然会给您留下无效的锚标记。最佳实践建议您应该提供一种不使用 javascript 的方法，并在可用的情况下使用您的 javascript-method 覆盖该功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T00:25:31.217

mercutio 是正确的。如果该代码在 HEAD 中执行，则对“document.getElementById('click1')”的调用将始终返回 null，因为尚未解析主体。也许您应该将该逻辑放在 onload 事件处理程序中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T00:20:21.990

您需要将代码包装在 window.onload 事件处理程序、domReady 事件处理程序（在大多数现代 js 框架和库中可用）或放置在页面底部。

[如您在此处](http://jsbin.com/azoke/edit)看到的，放置在页面底部效果很好。

“Unobtrusive JavaScript”主题涵盖了将事件响应程序与您的标记分离，并且可以通过多种方式进行处理。通常，您希望在 window.onload 或 document.ready 事件中声明事件响应者。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T00:20:56.327

我认为这是因为您正在尝试修改文件元素。

浏览器通常不允许您这样做。如果要显示或隐藏它们，请将它们放在 div 中并显示或隐藏。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T00:33:46.877

对，我已经根据你的集体建议修改了一些东西，现在可以了。唯一困扰我的是锚内直接引用 Javascript

# wpf - Silverlight 中不支持 XmlNode：重新实现或使用字符串解析？

> ID：279639
> 
> 赞同：3
> 
> 时间：2008-11-11T00:14:28.383
> 
> 标签：wpf, xml, silverlight

我已经编写了一个想要移植到 Silverlight 2 的 WPF 应用程序。

我的业务逻辑和模型（用于 MV-VM 设计模式）被打包到一个单独的程序集中，我试图将其重铸为 Silverlight 类库。

不幸的是，Silverlight 2 不支持我用来解析带有模型数据的 XML 文件的 XmlNode 类。指导是改用 LING to XML ( [http://silverlight.net/forums/t/14577.aspx](http://silverlight.net/forums/t/14577.aspx) )。对于我的任务，使用 LINQ 对我来说似乎有些矫枉过正。我正在考虑将使用 XML DOM 的 XML 解析代码替换为基于正则表达式的方案（用于解析属性）。或者，我正在考虑编写我自己的 XmlNode 实现，以防项目是为 Sliverlight 2 编译的。

有没有人遇到过类似的情况？有没有人对如何进行（RegEx 或重写）有任何建议（可能是第三个选项）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T01:57:17.583

不确定 Linq to Xml 是如何过大的。一旦掌握了窍门，使用 Linq2xml 进行 Xml 解析实际上要容易得多。我会说正则表达式或编写自己的 XmlNode 将是矫枉过正。

如果你发布一些你正在做的 XmlNode 工作，我相信你会得到一些很好的翻译。同时，这里[很好地介绍](http://blog.paranoidferret.com/index.php/2008/03/04/introduction-to-linq-simple-xml-parsing/)了使用 Linq to Xml 解析文档是多么容易。

**更新：**针对性能问题，我所能找到的只是linq [to xml](http://www.nearinfinity.com/blogs/page/jferner?entry=performance_linq_to_sql_vs)比[XmlDocument](http://msdn.microsoft.com/en-us/library/cc716762.aspx)[快](http://visualsoftware.net/Blog/post/Linq-to-XML-doesnacute3bt-exist.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T13:42:16.513

System.Xml.Linq 类包含 XDocument、XElement、XNode 和 XAttribute 等 XML DOM 类，这些类对于它们的 XmlDocument、XmlElemnt 等对应部分来说性能更高、更轻量级。您可以在不使用 Linq 的情况下使用这些类，但是使用 Linq to Xml 您可以做一些非常有趣的事情。这绝对是要走的路！

# login - 如何将用户从我的站点登录到 phpBB？

> ID：279655
> 
> 赞同：16
> 
> 时间：2008-11-11T00:22:09.957
> 
> 标签：login, phpbb

在修改 phpBB 方面，我需要一些帮助，这可能是一个新手问题。

我有一个用 PHP 开发的整个系统，我想集成 phpBB 以便人们可以导航到论坛并无缝发布，而无需再次登录。

现在，不幸的是，使用 phpBB users 表作为我的系统的用户表（并且让人们在 phpBB 而不是在我的网站中注册）是不可能的（重做我们的系统比建立我们自己的基本论坛需要更多的工作） .
我假设我可以破解我的方式让 phpBB 相信某个用户 ID 已经登录，但是，该用户不会存在于 phpBB 的用户表中（我假设这会导致它几乎到处出错） .

我能找到的所有教程和论坛帖子都暗示以 phpBB 为主要内容。我找不到任何可以反过来做的事情。

我猜想解决这个问题的唯一可能方法是让两个表相对同步。

现在，如果我可以同步两个用户表，那么集成两个站点的最佳方法是什么，将我的站点的登录和用户表保持为“主要”表？
另外，在 phpBB 的用户表中创建记录时，有什么特别要记住的吗？还是比较容易弄清楚？如果有多个表，我应该写哪些表？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-02-01T17:13:34.733

这是一个老问题，所以我相信您现在已经解决了一些问题，但是如果您将来需要重构一些东西，这完全可以使用 phpBB3 中的身份验证插件：

[http://wiki.phpbb.com/Authentication_plugins](http://wiki.phpbb.com/Authentication_plugins)

我现在正在研究一个 phpBB 是“辅助”系统，并且进展顺利。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-17T15:44:55.370

我今天刚刚完成了这项任务，经过一些调查实施了一个[身份验证插件](http://wiki.phpbb.com/Authentication_plugins)这是一个很好的例子[让 phpBB 接受 Django 会话](http://www.gilesthomas.com/?p=63)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-11T21:23:22.847

我之前已经将 phpBB 与一个站点集成，但是如您所说，我使用 phpBB 的登录系统/用户表作为主要表。由于 phpBB 是一个相当先进的论坛软件，完全改变它的用户和登录系统将是一个相当耗时的项目。

当我不得不使用该站点的登录作为主要登录时，我使用了[PunBB](http://punbb.informer.com/)。修改PunBB要简单得多。

如果您绝对必须使用自己的登录名和 phpBB，那么我同意您的观点，最简单的方法是保持表同步，并在有人登录时调用两个登录脚本。

当您将数据插入 phpBB 时，用户表非常简单。每个条目都有用户的基本信息，如果您有用户配置文件的自定义字段，它们会进入`profile_fields`和`profile_fields_data`表。

一件棘手的事情是 phpBB 如何加密用户密码。我认为你必须使用调用 phpBB 的函数`phpbb_hash($password)`来做到这一点。它在文件中声明 `phpbb/includes/functions.php`

phpBB登录代码见文件中的功能login_box`phpbb/includes/functions.php`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-08T08:44:15.217

您可以使用以下方式登录phpBB：

```
$result=$auth->login($username, $password);

if ($result['status'] == LOGIN_SUCCESS) {

  echo "You're logged in";

} else {

  echo $user->lang[$result['error_msg']];

} 
```

# c# - 如何使用 RedirectToAction 维护 ModelState？

> ID：279665
> 
> 赞同：75
> 
> 时间：2008-11-11T00:26:44.863
> 
> 标签：c#, asp.net-mvc

如果我的信息有错误，我如何返回不同操作的结果或将用户移动到不同的操作`ModelState`而不丢失我的`ModelState`信息？

场景是；`Delete`action 接受来自我的`Index`Action/View 呈现的 DELETE 表单的 POST。如果出现错误，`Delete`我想将用户移回`Index`操作/视图并显示操作存储`Delete`在`ViewData.ModelState`. 这如何在 ASP.NET MVC 中完成？

```
[AcceptVerbs(HttpVerbs.Post | HttpVerbs.Delete)]
public ActionResult Delete([ModelBinder(typeof(RdfUriBinder))] RdfUri graphUri)
{
    if (!ModelState.IsValid)
        return Index(); //this needs to be replaced with something that works :)

    return RedirectToAction("Index");
} 
```

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-11-11T01:16:33.513

将您的视图数据存储在`TempData`其中并在您的操作中从那里检索它`Index`（如果存在）。

```
 ...
   if (!ModelState.IsValid)
       TempData["ViewData"] = ViewData;

   RedirectToAction( "Index" );
}

 public ActionResult Index()
 {
     if (TempData["ViewData"] != null)
     {
         ViewData = (ViewDataDictionary)TempData["ViewData"];
     }

     ...
 } 
```

[编辑] 我检查了 MVC 的在线源代码，并且控制器中的 似乎`ViewData`是可设置的，因此将`ViewData`包括 在内的所有 转移`ModelState`到 Index 操作可能是最简单的。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-04-22T08:03:23.080

使用动作过滤器（PRG 模式）（就像使用属性一样简单）

[这里](https://stackoverflow.com/questions/658747/how-do-i-maintain-modelstate-errors-when-using-redirecttoaction)和[这里都](https://web.archive.org/web/20130702160308/http://weblogs.asp.net/rashid/archive/2009/04/01/asp-net-mvc-best-practices-part-1.aspx)提到了。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-11T19:42:36.573

请注意，tvanfosson 的解决方案并不总是有效，但在大多数情况下应该没问题。

该特定解决方案的问题在于，如果您已经拥有任何 ViewData 或 ModelState，您最终会用先前请求的状态覆盖它。例如，新请求可能有一些与传递给操作的无效参数相关的模型状态错误，但这些错误最终会因为被覆盖而被隐藏。

另一种可能无法按预期工作的情况是，如果您有一个操作过滤器，它初始化了一些 ViewData 或 ModelState 错误。同样，它们将被该代码覆盖。

我们正在寻找一些针对 ASP.NET MVC 的解决方案，它们可以让您更轻松地合并来自两个请求的状态，因此请继续关注。

谢谢，艾隆

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-08-19T21:25:10.860

如果这对我使用 @bob 推荐的 PRG 解决方案的任何人有用：

> 见第 13 项 ->[链接](http://weblogs.asp.net/rashid/archive/2009/04/01/asp-net-mvc-best-practices-part-1.aspx#prg)。

在执行`RedirectToAction("Action")`. 为了简化（并使其可维护），我稍微扩展了这种方法来检查和存储/加载其他数据。我的操作方法看起来像：

```
 [AcceptVerbs(HttpVerbs.Post)]
 [ExportModelStateToTempData]
 public ActionResult ChangePassword(ProfileViewModel pVM) {
      bool result = MyChangePasswordCode(pVM.ChangePasswordViewModel);
      if (result) {
           ViewBag.Message = "Password change success";
      else {
           ModelState.AddModelError("ChangePassword", "Some password error");
      }
      return RedirectToAction("Index");
    } 
```

我的索引操作：

```
[ImportModelStateFromTempData]
public ActionResult Index() {
    ProfileViewModel pVM = new ProfileViewModel { //setup }
    return View(pVM);
} 
```

动作过滤器中的代码：

```
// Following best practices as listed here for storing / restoring model data:
// http://weblogs.asp.net/rashid/archive/2009/04/01/asp-net-mvc-best-practices-part-1.aspx#prg
public abstract class ModelStateTempDataTransfer : ActionFilterAttribute {
    protected static readonly string Key = typeof(ModelStateTempDataTransfer).FullName;
} 
```

：

```
public class ExportModelStateToTempData : ModelStateTempDataTransfer {
    public override void OnActionExecuted(ActionExecutedContext filterContext) {
        //Only export when ModelState is not valid
        if (!filterContext.Controller.ViewData.ModelState.IsValid) {
            //Export if we are redirecting
            if ((filterContext.Result is RedirectResult) || (filterContext.Result is RedirectToRouteResult)) {
                filterContext.Controller.TempData[Key] = filterContext.Controller.ViewData.ModelState;
            }
        }
        // Added to pull message from ViewBag
        if (!string.IsNullOrEmpty(filterContext.Controller.ViewBag.Message)) {
            filterContext.Controller.TempData["Message"] = filterContext.Controller.ViewBag.Message;
        }

        base.OnActionExecuted(filterContext);
    }
} 
```

：

```
public class ImportModelStateFromTempData : ModelStateTempDataTransfer {
    public override void OnActionExecuted(ActionExecutedContext filterContext) {
        ModelStateDictionary modelState = filterContext.Controller.TempData[Key] as ModelStateDictionary;

        if (modelState != null) {
            //Only Import if we are viewing
            if (filterContext.Result is ViewResult) {
                filterContext.Controller.ViewData.ModelState.Merge(modelState);
            } else {
                //Otherwise remove it.
                filterContext.Controller.TempData.Remove(Key);
            }
        }
        // Restore Viewbag message
        if (!string.IsNullOrEmpty((string)filterContext.Controller.TempData["Message"])) {
            filterContext.Controller.ViewBag.Message = filterContext.Controller.TempData["Message"];
        }

        base.OnActionExecuted(filterContext);
    }
} 
```

我意识到我在这里的更改是代码@@bob 提供的链接对 ModelState 已经完成的操作的一个非常明显的扩展——但在我什至想到以这种方式处理它之前，我不得不偶然发现这个线程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-03-20T13:25:06.467

请不要因为这个答案而歪曲我。这是一个合理的建议。

**使用 AJAX**

管理 ModelState 的代码很复杂，并且（可能？）表明您的代码中存在其他问题。

你可以很容易地滚动你自己的 AJAX javascript 代码。这是我使用的脚本：

[https://gist.github.com/jesslilly/5f646ef29367ad2b0228e1fa76d6bdcc#file-ajaxform](https://gist.github.com/jesslilly/5f646ef29367ad2b0228e1fa76d6bdcc#file-ajaxform)

```
(function ($) {

    $(function () {

        // For forms marked with data-ajax="#container",
        // on submit,
        // post the form data via AJAX
        // and if #container is specified, replace the #container with the response.
        var postAjaxForm = function (event) {

            event.preventDefault(); // Prevent the actual submit of the form.

            var $this = $(this);
            var containerId = $this.attr("data-ajax");
            var $container = $(containerId);
            var url = $this.attr('action');

            console.log("Post ajax form to " + url + " and replace html in " + containerId);

            $.ajax({
                type: "POST",
                url: url,
                data: $this.serialize()
            })
                .done(function (result) {
                    if ($container) {
                        $container.html(result);
                        // re-apply this event since it would have been lost by the form getting recreated above.
                        var $newForm = $container.find("[data-ajax]");
                        $newForm.submit(postAjaxForm);
                        $newForm.trigger("data-ajax-done");
                    }
                })
                .fail(function (error) {
                    alert(error);
                });
        };
        $("[data-ajax]").submit(postAjaxForm);
    });

})(jQuery); 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-11-11T00:35:16.080

也许试试

```
return View("Index"); 
```

代替

```
return Index(); 
```

# visual-studio - 将 Visual Studio 项目中的所有文件保存为 UTF-8

> ID：279673
> 
> 赞同：90
> 
> 时间：2008-11-11T00:31:57.303
> 
> 标签：visual-studio, utf-8, character-encoding

我想知道是否可以将 Visual Studio 2008 项目中的所有文件保存为特定的字符编码。我得到了一个混合编码的解决方案，我想让它们都一样（带有签名的 UTF-8）。

我知道如何保存单个文件，但是项目中的所有文件呢？

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-05-12T01:26:04.087

既然您已经在 Visual Studio 中，为什么不直接编写代码呢？

```
foreach (var f in new DirectoryInfo(@"...").GetFiles("*.cs", SearchOption.AllDirectories)) {
  string s = File.ReadAllText(f.FullName);
  File.WriteAllText (f.FullName, s, Encoding.UTF8);
} 
```

只有三行代码！我相信你可以在不到一分钟的时间内写完这个:-)

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2010-04-13T21:21:52.620

这可能会有所帮助。

> 由于原始参考被垃圾邮件站点破坏，链接被删除。

短版：编辑一个文件，选择文件 -> 高级保存选项。不要将 UTF-8 更改为 Ascii，而是将其更改为 UTF-8。*编辑：确保选择没有字节顺序标记（BOM）的选项*

设置代码页并点击确定。它似乎在当前文件之后仍然存在。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-08-25T05:07:26.927

如果您需要在 PowerShell 中执行此操作，这是我的小举措：

```
Function Write-Utf8([string] $path, [string] $filter='*.*')
{
    [IO.SearchOption] $option = [IO.SearchOption]::AllDirectories;
    [String[]] $files = [IO.Directory]::GetFiles((Get-Item $path).FullName, $filter, $option);
    foreach($file in $files)
    {
        "Writing $file...";
        [String]$s = [IO.File]::ReadAllText($file);
        [IO.File]::WriteAllText($file, $s, [Text.Encoding]::UTF8);
    }
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-11T08:24:03.370

我会以编程方式（在 VS 之外）转换文件，例如使用 Python 脚本：

```
import glob, codecs

for f in glob.glob("*.py"):
    data = open("f", "rb").read()
    if data.startswith(codecs.BOM_UTF8):
        # Already UTF-8
        continue
    # else assume ANSI code page
    data = data.decode("mbcs")
    data = codecs.BOM_UTF8 + data.encode("utf-8")
    open("f", "wb").write(data) 
```

这假设所有不在“带有签名的 UTF-8”中的文件都在 ANSI 代码页中——这与 VS 2008 显然也假设的相同。如果您知道某些文件还有不同的编码，则必须指定这些编码是什么。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-03-19T07:07:07.067

使用 C#：
1) 创建一个新的 ConsoleApplication，然后安装[Mozilla Universal Charset Detector](https://nuget.org/packages/UDE.CSharp)
2) 运行代码：

```
static void Main(string[] args)
{
    const string targetEncoding = "utf-8";
    foreach (var f in new DirectoryInfo(@"<your project's path>").GetFiles("*.cs", SearchOption.AllDirectories))
    {
        var fileEnc = GetEncoding(f.FullName);
        if (fileEnc != null && !string.Equals(fileEnc, targetEncoding, StringComparison.OrdinalIgnoreCase))
        {
            var str = File.ReadAllText(f.FullName, Encoding.GetEncoding(fileEnc));
            File.WriteAllText(f.FullName, str, Encoding.GetEncoding(targetEncoding));
        }
    }
    Console.WriteLine("Done.");
    Console.ReadKey();
}

private static string GetEncoding(string filename)
{
    using (var fs = File.OpenRead(filename))
    {
        var cdet = new Ude.CharsetDetector();
        cdet.Feed(fs);
        cdet.DataEnd();
        if (cdet.Charset != null)
            Console.WriteLine("Charset: {0}, confidence: {1} : " + filename, cdet.Charset, cdet.Confidence);
        else
            Console.WriteLine("Detection failed: " + filename);
        return cdet.Charset;
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-22T18:38:21.310

感谢您的解决方案，此代码对我有用：

```
Dim s As String = ""
Dim direc As DirectoryInfo = New DirectoryInfo("Your Directory path")

For Each fi As FileInfo In direc.GetFiles("*.vb", SearchOption.AllDirectories)
    s = File.ReadAllText(fi.FullName, System.Text.Encoding.Default)
    File.WriteAllText(fi.FullName, s, System.Text.Encoding.Unicode)
Next 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-01-10T07:07:50.040

我创建了一个函数来更改用 asp.net 编写的编码文件。我搜索了很多。我还使用了这个页面的一些想法和代码。谢谢你。

这是功能。

```
 Function ChangeFileEncoding(pPathFolder As String, pExtension As String, pDirOption As IO.SearchOption) As Integer

    Dim Counter As Integer
    Dim s As String
    Dim reader As IO.StreamReader
    Dim gEnc As Text.Encoding
    Dim direc As IO.DirectoryInfo = New IO.DirectoryInfo(pPathFolder)
    For Each fi As IO.FileInfo In direc.GetFiles(pExtension, pDirOption)
        s = ""
        reader = New IO.StreamReader(fi.FullName, Text.Encoding.Default, True)
        s = reader.ReadToEnd
        gEnc = reader.CurrentEncoding
        reader.Close()

        If (gEnc.EncodingName <> Text.Encoding.UTF8.EncodingName) Then
            s = IO.File.ReadAllText(fi.FullName, gEnc)
            IO.File.WriteAllText(fi.FullName, s, System.Text.Encoding.UTF8)
            Counter += 1
            Response.Write("<br>Saved #" & Counter & ": " & fi.FullName & " - <i>Encoding was: " & gEnc.EncodingName & "</i>")
        End If
    Next

    Return Counter
End Function 
```

它可以放在 .aspx 文件中，然后调用如下：

```
ChangeFileEncoding("C:\temp\test", "*.ascx", IO.SearchOption.TopDirectoryOnly) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-08-13T10:31:50.727

如果您将 TFS 与 VS 一起使用：http: [//msdn.microsoft.com/en-us/library/1yft8zkw](http://msdn.microsoft.com/en-us/library/1yft8zkw(v=vs.100).aspx) (v=vs.100).aspx 示例：

```
tf checkout -r -type:utf-8 src/*.aspx 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-02-09T17:32:18.223

如果你想避免这种类型的错误：

[![在此处输入图像描述](https://i.stack.imgur.com/NQmtD.png)](https://i.stack.imgur.com/NQmtD.png)

使用以下代码：

```
foreach (var f in new DirectoryInfo(@"....").GetFiles("*.cs", SearchOption.AllDirectories))
            {
                string s = File.ReadAllText(f.FullName, Encoding.GetEncoding(1252));
                File.WriteAllText(f.FullName, s, Encoding.UTF8);
            } 
```

编码编号 1252 是 Visual Studio 用于保存文件的默认 Windows 编码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-10-08T13:11:08.970

# 从 UTF-8-BOM 转换为 UTF-8

基于[rasx 的回答](https://stackoverflow.com/a/1326157/5185376)，这里是一个 PowerShell 函数，它假定您当前的文件已经以 UTF-8 编码（但可能带有 BOM）并将它们转换为没有 BOM 的 UTF-8，因此保留现有的 Unicode 字符。

```
Function Write-Utf8([string] $path, [string] $filter='*')
{
    [IO.SearchOption] $option = [IO.SearchOption]::AllDirectories;
    [String[]] $files = [IO.Directory]::GetFiles((Get-Item $path).FullName, $filter, $option);
    foreach($file in $files)
    {
        "Writing $file...";
        [String]$s = [IO.File]::ReadAllText($file, [Text.Encoding]::UTF8);
        [Text.Encoding]$e = New-Object -TypeName Text.UTF8Encoding -ArgumentList ($false);
        [IO.File]::WriteAllText($file, $s, $e);
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-08-28T07:05:28.620

将解决方案从 VS2008 转换为 VS2015 后遇到编码问题。转换后，所有项目文件都以 ANSI 编码，但它们包含 UTF8 内容，并在 VS2015 中被识别为 ANSI 文件。尝试了许多转换策略，但只使用了这个解决方案。

```
 Encoding encoding = Encoding.Default;
 String original = String.Empty;
 foreach (var f in new DirectoryInfo(path).GetFiles("*.cs", SearchOption.AllDirectories))
 {
    using (StreamReader sr = new StreamReader(f.FullName, Encoding.Default))
    {
       original = sr.ReadToEnd();
       encoding = sr.CurrentEncoding;
       sr.Close();
    }
    if (encoding == Encoding.UTF8)
       continue;
    byte[] encBytes = encoding.GetBytes(original);
    byte[] utf8Bytes = Encoding.Convert(encoding, Encoding.UTF8, encBytes);
    var utf8Text = Encoding.UTF8.GetString(utf8Bytes);

    File.WriteAllText(f.FullName, utf8Text, Encoding.UTF8);
 } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-12-13T20:56:03.940

该项目已从 Visual Studio 2017 的菜单中删除您仍然可以通过文件->另存为->然后单击“保存”按钮上的向下箭头并单击“使用编码保存...”来访问该功能。

如果需要，您也可以通过工具->自定义->命令将其添加回文件菜单。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-11-11T00:55:57.800

# security - Tomcat：阻止来自某些接口的请求对某些路径的请求

> ID：279682
> 
> 赞同：0
> 
> 时间：2008-11-11T00:35:33.097
> 
> 标签：security, tomcat, filter

当请求来自给定接口时，是否可以在 Tomcat 上使用开源过滤器来防止访问某些路径（例如 /a/b/*）？

用例：我在 Tomcat 上部署了 REST 服务，这些服务只能由应用程序本身访问，但出于安全原因，不应从外部访问这些服务。如果将 Apache 用作前端，我可以在 Apache 中执行此操作，但在这种情况下不是。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T00:51:34.673

不确定是否有可以使用的开源软件，但[编写一个](http://tomcat.apache.org/tomcat-4.1-doc/servletapi/javax/servlet/Filter.html)检查请求来自何处的软件非常容易。

请参阅[getPathTranslated()](http://tomcat.apache.org/tomcat-4.1-doc/servletapi/javax/servlet/http/HttpServletRequest.html#getPathTranslated())、[getRemoteAddr](http://tomcat.apache.org/tomcat-4.1-doc/servletapi/javax/servlet/ServletRequest.html#getRemoteAddr())等。

yc

# java - 有使用 Terracotta 开源的经验吗？

> ID：279685
> 
> 赞同：9
> 
> 时间：2008-11-11T00:37:00.083
> 
> 标签：java, load-balancing, terracotta

有没有人有使用 Terracotta 的开源产品而不是他们的企业产品的经验？具体来说，我很感兴趣在没有企业工具的情况下使用 terracotta 来管理集群是否值得？

过度简化的使用总结：我们是一家预算有限的小型初创公司，需要处理数百万条记录并扩展为每天数十万的页面浏览量。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T21:01:10.043

我正在将 Terracotta 与我的项目（传感器节点网络模拟器）集成在一起。大约三周前，我从我的一位同事那里得知了 Terracotta。现在我的应用程序利用了使用 Terracotta 的网格计算。下面我总结了我使用 Terracotta 的经验的一些要点。

*   Terracotta 网站包含非常详细的文档。[本文可能是开发人员概念和架构指南](http://www.terracotta.org/web/display/docs/Concept+and+Architecture+Guide "概念和架构指南")的一个很好的起点
*   当您遇到问题并且在文档中找不到答案时，[Terracotta 社区论坛](http://forums.terracotta.org/forums/forums/list.page)是提问的好地方。似乎 Terracotta 开发人员会定期检查它并且反应灵敏。
*   即使 Terracotta 在 JVM 下运行，并且宣传说让您的应用程序在集群中运行只是配置问题，您应该做好准备，可能需要在您的应用程序中引入一些重大更改以使其运行得相当好. 例如，我必须完全重写我的应用程序的同步逻辑。
*   与 Eclipse 的良好集成。
*   Admin Console 是一个很棒的工具，它在调整我的应用程序以在 Terracotta 下表现得体方面帮助了我很多。它从您只能想到的服务器和客户端收集所有性能指标。它当然有一些与 GUI 相关的问题，但谁没有:-)
*   首选标准 Java 同步原语（同步/等待/通知）而不是 java.util.concurrent.* 公民。我发现标准原语提供了更高的灵活性（可以配置为读或写集群锁，甚至根本不是锁），更容易在管理控制台中跟踪（你会看到对象的类名被锁定而不是然后例如一些ReentrantLock）。

希望有帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T20:18:46.983

目前，Terracotta 企业工具只提供了一些超越开源版本的功能，比如可视化和管理（比如将客户端踢出集群的能力）。这种情况将继续分化，企业工具可能会在管理和监控等方面拥有更多操作员级别的功能，但即使使用开源工具，您当然也可以管理和调整应用程序。

企业许可证还为您提供支持、赔偿等内容，这些对您而言可能与工具一样重要，也可能不重要。

我会敦促你自己尝试一下。如果您想查看使用 Terracotta 的真实应用程序示例，您应该查看刚刚发布的这个参考网络应用程序：

[考官](http://reference.terracotta.org)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T02:58:25.277

你可能想看看 JBossCache/PojoCache 这是一个内存分布式缓存解决方案。不同之处在于它使用一个简单的 API 在您的缓存“集群”中传播对象，而 Terracotta 在类加载/jvm 级别上工作。

（它们实际上并没有自己的 JVM，但它们在加载类时会修改类以使它们成为“可集群的”）

我们公司对 JBossCache 非常满意，我建议您检查一下。

* * *

## 回答 #4

> 赞同：-8
> 
> 时间：2008-11-11T01:06:46.483

**更新**

我在 OP 消息中看到的是“好吧，我真的不知道我们需要什么（因此缺乏详细的要求），但可能是一些企业工具会神奇地解决我们所有已知和不可预见的问题？那*太棒*了！”

使用这样的架构方法，它不会飞。没有任何 Teracotta 的成功案例可以改变这一点。

当 OSS 周围的社区可以取代商业支持时，OSS 是有益的。假设这家伙在生产中遇到问题。社区无能为力——对于像这样不起眼的产品来说，它太小了。服务器停机，业务处于危险之中。你看？您需要预先获得商业许可证。没钱？好吧，那么您**不是一家企业**，而且可能不会成为一家（如果没有人愿意投资的话）。

很抱歉打扰你做白日梦。

**恕我直言：**

Terracotta 是一种集群解决方案。大型企业级应用程序需要集群。大型应用程序意味着大量预算。大预算意味着您可以负担得起 Terracotta 的商业许可。

换句话说：如果你没有预算购买它，它可能对你的项目没有好处。

# cryptography - 模运算

> ID：279693
> 
> 赞同：0
> 
> 时间：2008-11-11T00:42:04.037
> 
> 标签：cryptography, math, modular

我是密码学和模算术的新手。所以，我敢肯定这是一个愚蠢的问题，但我无能为力。

如何从      pow( *a* , **q** ) = 1 (mod **p** )计算*a* ， 其中**p**和**q**是已知的？我没有得到“1 (mod **p** )”部分，它等于 1，不是吗？如果是这样，那么“mod **p** ”是关于什么的？ 这是否与      pow( *a* , **-q** ) (mod **p** ) = 1 相同？

 ********* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-11T00:51:12.567

(mod p) 部分不是指右手边，而是指等号：它表示*模 p、pow(a,q) 和 1 相等*。例如，“模 10、246126 和 7868726 相等”（它们也都等于 6 模 10）：**如果两个数 x 和 y 在除以 p 时具有相同的余数，则它们模 p 相等，或者等效地，如果p 除以 xy。**

由于您似乎是从编程的角度来看，另一种说法是 pow(a,q)%p=1，其中“%”是用多种语言实现的“余数”运算符（假设 p>1 ）。

您应该阅读有关[模块化算术](http://en.wikipedia.org/wiki/Modular_arithmetic)的维基百科文章，或任何基本数论书籍（甚至是密码学书籍，因为它可能会介绍模块化算术）。

To answer your other question: there is no general formula for finding such an *a* (to the best of my knowledge) in general. Assuming that p is prime, and using [Fermat's little theorem](http://en.wikipedia.org/wiki/Fermat%27s_little_theorem) to reduce q modulo p-1, and assuming that q divides p-1 (or else no such *a* exists), you can produce such an *a* by taking a [primitive root](http://en.wikipedia.org/wiki/Primitive_root_modulo_n) of p and raising it to the power (p-1)/q. [And more generally, when p is not prime, you can reduce q modulo φ(p), then assuming it divides φ(p) and you know a primitive root (say r) mod p, you can take r to the power of φ(p)/q, where φ is [the totient function](http://en.wikipedia.org/wiki/Euler%27s_totient_function) -- this comes from [Euler's theorem](http://en.wikipedia.org/wiki/Euler%27s_theorem).]

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T00:49:04.443

一点也不傻，因为**这是公钥加密的基础。**您可以在[http://home.scarlet.be/~ping1339/congr.htm#The-equation-a%3Csup%3Ex 找到一个很好的讨论。](http://home.scarlet.be/~ping1339/congr.htm#The-equation-a%3Csup%3Ex.)

PKI 通过选择`p`和`q`较大且[*相对优质*](http://en.wikipedia.org/wiki/Coprime)的方式工作。一个（比如`p`）成为您的私钥，另一个（`q`）是您的公钥。如果攻击者猜测`p`，给定`a`^(`q`)（加密的消息）和`q`（您的公钥），则加密被“破坏”。

所以，回答你的问题：

> `a`^(`q`)= 1 个模组`p`

这意味着`a`^(`q`)是一个除以 时余数为 1 的数字`p`。我们不关心商的整数部分，所以我们可以这样写：

> `a`^(`q`)/ `p`= `n`+ 1/`p`

对于 的*任何整数值`n`*。如果我们将等式两边都乘以`p`，我们有：

> `a`^(`q`)= `np`+ 1

解决`a`我们有：

> `a`= ( `np`+1) ^(1/`q`)

最后一步是找到 的值，`n`该值生成 的原始值 `a`。除了反复试验之外，我不知道有任何方法可以做到这一点——这等同于“蛮力”尝试破解加密。

# macros - Common Lisp 初学者：动态定义包的宏观问题

> ID：279696
> 
> 赞同：5
> 
> 时间：2008-11-11T00:47:43.573
> 
> 标签：macros, lisp, common-lisp

仍在努力了解有关宏的最佳实践。我正在尝试编写一个动态定义包的宏。

```
(defmacro def-dynamic-package (name)
  `(defpackage ,(intern (string-upcase name) "KEYWORD")
     (:use :common-lisp))) 
```

这仅适用于以下表达式：

```
(def-dynamic-package "helloworld") 
```

但是因为这样的事情而惨遭失败：

```
(defun make-package-from-path (path)
  (def-dynamic-package (pathname-name path))) 
```

或者

```
(defun make-package-from-path (path)
  (let ((filename (pathname-path)))
     (def-dynamic-package filename))) 
```

我了解大多数基本宏是如何工作的，但是如何实现这个让我无法理解。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T08:03:54.473

**defpackage**是一个宏。因此，它在编译时扩展，而不是运行时。您想要的是在运行时调用以制作新包的东西。因此，**defpackage**不能为您做任何事情。

幸运的是，还有**[make-package](http://www.lispworks.com/documentation/HyperSpec/Body/f_mk_pkg.htm#make-package)**，它提供了**defpackage**的功能作为一个函数。使用它而不是**defpackage**。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T01:08:46.823

这里会出现失败，因为在不应评估其参数时使用了宏。

在您的第一个 make-package-from-path 中，def-dynamic-package 将接收一个列表作为参数，该列表等于以下表达式的值：

```
(list 'pathname-name 'path) 
```

在您的情况下，您只需要一个功能：

```
(defun def-dynamic-package (name)
  (defpackage (string-upcase name)
    (:use :common-lisp))) 
```

顺便说一句，如果您检查[CLHS](http://www.lispworks.com/documentation/HyperSpec/Front/index.htm)，您会发现[defpackage](http://www.lispworks.com/documentation/HyperSpec/Body/m_defpkg.htm)的第一个参数不必是符号，而是任何[字符串指示符](http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_s.htm#string_designator)。

# c# - 扩展方法语法与查询语法

> ID：279701
> 
> 赞同：67
> 
> 时间：2008-11-11T00:50:49.963
> 
> 标签：c#, .net, linq, extension-methods, linq-query-syntax

我正在尝试了解是否有时间使用标准 linq 关键字或带有 lambda 表达式的 linq 扩展方法。他们似乎做同样的事情，只是写法不同。纯粹是风格问题吗？

```
var query = from p in Products
    where p.Name.Contains("foo")
    orderby c.Name
    select p;

// or with extension methods:
var query = Products
    .Where(p => p.Name.Contains("foo"))
    .OrderBy(p => p.Name); 
```

它们与第二个示例非常相似，更简洁一些，但如果您不知道 => 正在做什么，则表达能力可能会降低。

**除了编写简洁的代码之外，与 LINQ 语法相比，使用扩展方法还有其他优点吗？**

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-12T15:32:47.717

老实说，一旦你开始使用 Funcs 和 Actions，有时它可能是情境性的。假设您正在使用这三个函数：

```
 Func<DataClasses.User, String> userName = user => user.UserName;
  Func<DataClasses.User, Boolean> userIDOverTen = user => user.UserID < 10;
  Func<DataClasses.User, Boolean> userIDUnderTen = user => user.UserID > 10; 
```

如您所见，第一个替换了 lamdba 表达式以获取用户名，第二个替换了用于检查 ID 是否低于 10 的 lamdba 表达式，让我们面对现实吧，第三个现在应该很容易理解了。

注意：这是一个愚蠢的例子，但它有效。

```
 var userList = 
    from user in userList
    where userIDOverTen(user)
    select userName; 
```

相对

```
 var otherList =
    userList
    .Where(IDIsBelowNumber)
    .Select(userName) 
```

在这个例子中，第二个稍微不那么冗长，因为扩展方法可以充分利用 Func，但 Linq 表达式不能，因为它只查找布尔值而不是返回布尔值的 Func。但是，这可能是使用表达式语言更好的地方。假设您已经有了一个方法，它不仅可以接收用户：

```
 private Boolean IDIsBelowNumber(DataClasses.User user, 
          Int32 someNumber, Boolean doSomething)
  {
    return user.UserID < someNumber;
  } 
```

注意： doSomething 之所以存在，是因为 where 扩展方法可以接受用户和整数并返回布尔值的方法。这个例子有点烦人。

现在，如果您查看 Linq 查询：

```
 var completeList =
     from user in userList
     where IDIsBelowNumber(user, 10, true)
     select userName; 
```

你很适合它。现在扩展方法：

```
 var otherList =
    userList
    .Where(IDIsBelowNumber????)
    .Select(userName) 
```

如果没有 lambda 表达式，我真的无法调用该方法。所以现在我要做的是创建一个基于原始方法调用创建 Func 的方法。

```
 private Func<DataClasses.User, Boolean> IDIsBelowNumberFunc(Int32 number)
   {
      return user => IDIsBelowNumber(user, number, true);
   } 
```

然后将其插入：

```
 var otherList =
     userList
     .Where(IDIsBelowNumberFunc(10))
     .Select(userName) 
```

所以你可以看到，有时使用查询方法可能更容易。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-11T01:16:14.577

使用 LINQ 扩展方法（*基于方法的查询*）的一个优点是您可以定义自定义扩展方法并且它仍然可以正常读取。

另一方面，当使用 LINQ*查询表达式*时，自定义扩展方法不在关键字列表中。与其他关键字混合起来看起来有点奇怪。

# 例子

我正在使用一个名为的自定义扩展方法`Into`，它只需要一个字符串：

## 查询示例

```
var query = (from p in Products
    where p.Name.Contains("foo")
    orderby c.Name
    select p).Into("MyTable"); 
```

## 扩展方法示例

```
var query = Products
                   .Where(p => p.Name.Contains("foo"))
                   .OrderBy(p => p.Name)
                   .Into("MyTable"); 
```

在我看来，后者，使用基于*方法的查询*，当你有自定义扩展方法时，读起来会更好。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-12-01T07:09:13.587

我认为最好不要一起使用它们并选择一个并坚持下去。

主要是个人喜好，但在查询语法（理解方法）中，并非所有运算符都像之前所说的那样可用。

我发现扩展方法语法更符合我的代码的其余部分。我在 SQL 中执行我的 SQL。只需使用扩展方法将所有内容相互叠加，即可轻松构建您的表达式。

只是我的两分钱。

由于我还不能发表评论，所以我想在这里对编程工具的答案发表评论：为什么要为最后一个示例制作一个全新的方法？你不能只使用：

`.Where(user => IDIsBelowNumber(user, 10, true))`

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-11T01:04:10.467

它们编译相同，并且是等效的。就个人而言，对于大多数事情，我更喜欢 lambda（扩展）方法，仅当我正在执行 LINQ to SQL 或以其他方式尝试模拟 SQL 时才使用语句（标准）。我发现 lambda 方法在代码中的流动性更好，而语句在视觉上会分散注意力。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-12T14:30:19.760

当我使用没有等效查询语法的 Linq 方法时，我更喜欢扩展方法语法，例如 FirstOrDefault() 或其他类似方法。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2014-03-06T17:22:33.783

我喜欢在它真正是查询时使用查询语法，即按需评估的惰性表达式。

看起来像常规方法调用（方法语法或 lambda 语法）的方法看起来不够懒惰，所以我将其用作约定。例如，

```
var query = from p in Products
            where p.Name.Contains("foo")
            orderby p.Name
            select p;

var result = query.ToList(); //extension method syntax 
```

如果不是查询，我喜欢流畅的风格，在我看来与其他急切执行的调用一致。

```
var nonQuery = Products.Where(p => p.Name.Contains("foo"))
                       .OrderBy(p => p.Name)
                       .ToList(); 
```

它帮助我更好地区分这两种调用方式。当然，在某些情况下，无论如何您都将被迫使用方法语法，因此我的约定不够引人注目。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2018-01-09T16:35:12.663

扩展方法/lynda 表达式的一个优点是提供了额外的运算符，例如 Skip 和 Take。例如，如果您正在创建分页方法，那么能够跳过前 10 条记录并获取接下来的 10 条记录很容易实现。

# ruby-on-rails - 当远程 git 在非标准路径上时使用 capistrano

> ID：279705
> 
> 赞同：6
> 
> 时间：2008-11-11T00:53:17.510
> 
> 标签：ruby-on-rails, shell, path, capistrano, deployment

我的共享主机没有提供 git，所以我将它构建并安装到 ~/bin 中。当我运行它时，大多数命令都出现以下错误，尽管它们是成功的。

> `stdin: is not a tty`

我可以通过添加来解决这个问题：

> `default_run_options[:pty] = true`

到我的 deploy.rb，但随后我收到此错误，这会阻止部署：

> `sh: git: command not found`

如何解决这两个错误？

我尝试添加一个 ~/.ssh/environment 文件`"PATH=$PATH:$HOME/bin"`（并更改 sshd_config 以使用它），但它什么也没做。

似乎 capistrano 使用的任何 shell 都没有使用远程服务器上的 ~/.bashrc 或 ~/.bash_profile 。

任何想法如何在远程机器上设置路径？

其他信息：我在本地使用 OS X，共享服务器是 Site5 上的 linux。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-11T19:20:12.580

谢谢，楚 - 你让我走上了正确的道路。

只是 using:`set :scm_command, "~/bin/git"`
仍然给了我错误，因为我的本地 git 不在那个地方。

但是，以下似乎可行，并解决了我的问题：
`set :scm_command, "~/bin/git"
set :local_scm_command, "/usr/local/bin/git"`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-01-03T04:24:16.237

问题是你已经设置

```
default_run_options[:pty] = true 
```

这意味着您的 .bash_profile 或您通常的 shell 初始化文件将不会运行，当您将其设置为 false 时情况并非如此——但是当它想要询问您密码时您会遇到问题。

要解决此问题，您可以在部署文件中手动设置 PATH 环境变量：

```
default_environment['PATH'] = "/your/path/to/git:/and/any/other/path/you/need" 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T15:01:47.950

您应该能够像这样指定 git 的完整路径：

`set :scm_command, "/home/your_cap_runner_user/bin/git"`

我自己没有尝试过 - 在 Capistrano 本身的 git.rb 源代码的文档中找到它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-28T22:41:05.220

```
stdin: is not a tty 
```

这可能是因为您的共享主机上安装了 CPanel。它在包含在您的 ~/.bashrc 文件中的全局 /etc/.bashrc 文件中执行“mesg y”。所以你可以注释掉包含。

这是来源：[http ://webhostingneeds.com/Git_stdin_is_not_a_tty](http://webhostingneeds.com/Git_stdin_is_not_a_tty)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T01:18:29.843

一个快速的解决方法是在 deploy.rb 文件中设置以下内容：

```
set :deploy_via, :copy 
```

这将导致检出发生在您自己的机器上，然后被复制到部署服务器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-29T22:30:52.130

这是一个很大的帮助，因为我遇到了与原始海报相同的问题。

“之前”的症状：

*   运行 cap deploy:setup (成功)
*   运行 cap deploy:check（失败，'git command not found'）

我现在将 set :scm_command, "~/bin/git" 添加到我的 deploy.rb 文件中。

*   运行 cap deploy:setup （成功）
*   跑帽部署：检查（成功）
*   运行 cap deploy:cold （失败，出现以下错误）

    :97:in ``': 没有这样的文件或目录 - ~/bin/git info git@github.com:quintar/eu reka.git -rHEAD (Errno::ENOENT)

所以看起来“git”被识别了，但是我在 deploy.rb 中包含的存储库被绕过了？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-11-01T07:38:07.033

~/.ssh/environment 文件不是由 shell 执行的。这是一个硬编码的环境文件。如果您想以这种方式设置路径，则需要对其进行硬编码，而不是附加到 $PATH。其他答案可能更正确，但如果一切都失败了，正确设置 ~/.ssh/environment 是一个可靠的后备。

# python - 制作一个python GUI

> ID：279707
> 
> 赞同：2
> 
> 时间：2008-11-11T00:56:38.110
> 
> 标签：python, user-interface

我如何为我的 python 程序制作 GUI，因为现在它只在空闲和命令行中运行，我可以使用哪些软件包以及在哪里可以获得它们？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T00:58:00.510

Python wiki 中的[GuiProgramming](http://wiki.python.org/moin/GuiProgramming)页面很好地概述了您拥有的不同选项。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T00:58:27.887

与 python 一起使用的两个最有趣的工具包可能是[PyQt4](http://www.riverbankcomputing.co.uk/static/Docs/PyQt4/pyqt4ref.html)或[wxPython](http://www.wxpython.org)。

它们都是开源的、跨平台的和有据可查的，并且它们都有可用的 gui 构建器（[Qt Designer](http://trolltech.com/products/appdev/developer-tools/developer-tools?currentflipperobject=73543fa58dda72c632a376b97104ff78)和[wxGlade](http://wxglade.sourceforge.net/)。请记住，使用 QT 开发封闭源代码软件需要许可证，包括 QT 和 python 绑定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T01:21:27.030

几年前，我们开始了 wxPython 的道路，发现它对于简单、快速和肮脏的应用程序来说很容易做到。但是，您不会得到可以放在现代桌面上的东西。所以我们切换到 WinForms 和 Python.Net 并且从那时起就没有回头。它相当容易上手，并且您可以使用 .NET 获得丰富的 Windows UI 的所有功能和支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T01:49:54.150

还没有提到的一件事是[Tkinter](http://docs.python.org/library/tkinter.html?highlight=tkinter#module-Tkinter)包含在标准库中。在大多数情况下，所有其他 gui 工具包都需要额外安装。

Tkinter 并不漂亮，但它为您提供了基础知识。如果您不想担心额外的设置，这是您的最佳选择。

我个人的偏好是[wxpython](http://www.wxpython.org/)。它具有许多您期望从 gui 工具包和原生外观中获得的标准小部件。

# c++ - 如何等待 fork() 调用的所有子进程完成？

> ID：279729
> 
> 赞同：19
> 
> 时间：2008-11-11T01:11:39.530
> 
> 标签：c++, linux, gcc, parallel-processing

我正在分叉许多进程，我想测量完成整个任务需要多长时间，即完成所有分叉的进程。请告知如何使父进程等到所有子进程终止？我想确保在正确的时刻停止计时器。

这是我使用的代码：

```
#include <iostream>
#include <string>
#include <fstream>
#include <sys/time.h>
#include <sys/wait.h>

using namespace std;

struct timeval first,  second,  lapsed;
struct timezone tzp; 

int main(int argc, char* argv[])// query, file, num. of processes.
{

    int pCount = 5; // process count

    gettimeofday (&first, &tzp); //start time

    pid_t* pID = new pid_t[pCount];

    for(int indexOfProcess=0; indexOfProcess<pCount; indexOfProcess++)
    {
        pID[indexOfProcess]= fork();

        if (pID[indexOfProcess] == 0)                // child
        {
            // code only executed by child process

            // magic here

            // The End
            exit(0);
        }
        else if (pID[indexOfProcess] < 0)    // failed to fork
        {
            cerr << "Failed to fork" << endl;
            exit(1);
        }
        else                         // parent
        {
            // if(indexOfProcess==pCount-1) and a loop with waitpid??

            gettimeofday (&second, &tzp); //stop time
            if (first.tv_usec > second.tv_usec)
            {
                second.tv_usec += 1000000;
                second.tv_sec--;
            }

            lapsed.tv_usec = second.tv_usec - first.tv_usec;
            lapsed.tv_sec = second.tv_sec - first.tv_sec; 

            cout << "Job performed in " <<lapsed.tv_sec << " sec and " << lapsed.tv_usec    << " usec"<< endl << endl;

        }

    }//for

}//main 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-11T01:27:10.607

我会将“else //parent”行之后的所有内容移到for循环之外。在 fork 循环之后，使用 waitpid 执行另一个 for 循环，然后停止时钟并执行其余操作：

```
for (int i = 0; i < pidCount; ++i) {
    int status;
    while (-1 == waitpid(pids[i], &status, 0));
    if (!WIFEXITED(status) || WEXITSTATUS(status) != 0) {
        cerr << "Process " << i << " (pid " << pids[i] << ") failed" << endl;
        exit(1);
    }
}

gettimeofday (&second, &tzp); //stop time 
```

我假设如果子进程无法正常退出，状态为 0，那么它没有完成它的工作，因此测试未能产生有效的计时数据。显然，如果子进程*应该*被信号杀死，或者退出非 0 返回状态，那么您必须相应地更改错误检查。

使用等待的替代方法：

```
while (true) {
    int status;
    pid_t done = wait(&status);
    if (done == -1) {
        if (errno == ECHILD) break; // no more child processes
    } else {
        if (!WIFEXITED(status) || WEXITSTATUS(status) != 0) {
            cerr << "pid " << done << " failed" << endl;
            exit(1);
        }
    }
} 
```

这不会告诉您哪个进程依次失败，但是如果您关心，那么您可以添加代码以在 pids 数组中查找它并取回索引。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-11T01:17:28.443

最简单的方法是做

```
while(wait() > 0) { /* no-op */ ; } 
```

`wait()`如果由于没有孩子剩下的事实之外的某种原因而失败，这将不起作用。所以通过一些错误检查，这变成了

```
int status;
[...]
do {
    status = wait();
    if(status == -1 && errno != ECHILD) {
        perror("Error during wait()");
        abort();
    }
} while (status > 0); 
```

另请参阅手册页`wait(2)`。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T01:16:20.410

在一个循环中调用 wait（或 waitpid），直到所有的孩子都被考虑在内。

在这种情况下，无论如何，所有进程都在同步，但通常当可以完成更多工作时（例如工作进程池），等待是首选，因为它会在第一个可用进程状态更改时返回。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-11T01:16:02.703

我相信[等待系统调用](http://linux.die.net/man/2/wait)会完成你正在寻找的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T01:17:31.453

```
for (int i = 0; i < pidCount; i++) {
    while (waitpid(pids[i], NULL, 0) > 0);
} 
```

它不会按正确的顺序等待，但会在最后一个孩子死后不久停止。

# javascript - 有没有办法在页面上返回或转发时触发任意 Javascript？

> ID：279734
> 
> 赞同：2
> 
> 时间：2008-11-11T01:14:35.500
> 
> 标签：javascript, ajax, back-button

具体来说，我希望使用 AJAX 模仿后退按钮的行为，并且我不想将#uglyhashes 附加到每个 URL，这似乎是我见过的大多数解决方案的标准做法。

（对于它的价值，我完全可以接受在 IE 中根本不起作用的解决方案。：P）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T01:23:07.417

您可以将侦听器附加到文档的“DOMContentLoaded”事件以在页面加载时触发 javascript。这应该在向后和向前以及页面最初加载时触发。您如何使用该 javascript 来实现您想要的行为取决于您——大多数人处理的方式是使用“#uglyhashes”。

编辑为 Mozilla 添加示例代码（并更新事件名称）：

```
document.addEventListener("DOMContentLoaded", function() {
   // Do watchya like
},false); 
```

# c# - 在声明 ASP.NET 之前不能使用局部变量

> ID：279748
> 
> 赞同：3
> 
> 时间：2008-11-11T01:19:27.127
> 
> 标签：c#, asp.net-mvc

我有一些这样的代码：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Save([Bind(Prefix="")]Person person)
{
    String s = person.property;
    /* ... */
} 
```

但它抛出错误：“在声明之前不能使用局部变量'person'”。

我错过了什么简单的事情？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-13T13:38:02.523

您很可能收到此错误，因为稍后在同一代码块中声明了同一变量。

根据编译器规则，变量引用将通过具有相同块的匹配声明引用默认值，即使在逻辑范围流中的块之外存在相同的声明。

所以简而言之，检查变量是否稍后在同一个应用程序块中声明（几行）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T02:21:33.757

好吧，这只是一些非常奇怪的错误——如果变量被命名为一个特定的名字它不起作用，对于任何其他的名字它都起作用......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-08-15T13:05:41.467

我对名为endingYear 的声明变量有同样的问题。

在这里声明：

```
 public ChartData(MetricInfo metricInfo, MetricItem[] metricItems) : this()
        {
            int endingYear = 0; 
```

在该方法中，这不是问题：

```
 endingYear = endingDate.Year; 
```

但是，当我在 Case 语句中引用相同的变量时，我得到了“在声明之前不能使用局部变量”错误，即使变量是 intelesense 的：

```
 case "QRTR_LAST_FULL_QRTR":
                    if (metricInfo.CalendarType == "CALENDAR")
                    {
                        switch (endingDate.Month)
                        {
                            case 1:
                            case 2:
                            case 3:
                                loopControl = 4;
                                endingYear = endingDate.Year - 1; 
```

根据马特的结果，我尝试将变量名称更改为 endYear，问题就消失了。很奇怪，浪费了半个小时左右。如果不是因为这个帖子，可能会损失更大的时间。

# javascript - 从 JS/CSS 检测系统 DPI/PPI？

> ID：279749
> 
> 赞同：55
> 
> 时间：2008-11-11T01:19:34.787
> 
> 标签：javascript, css, mobile, dpi, ppi

我正在开发一种独特的应用程序，它需要根据显示的设备生成特定分辨率的图像。因此，在常规 Windows 浏览器 (96ppi)、iPhone (163ppi)、Android G1 (180ppi) 和其他设备上，输出是不同的。我想知道是否有办法自动检测到这一点。

我最初的研究似乎说不。我看到的唯一建议是在 CSS 中创建一个宽度指定为“1in”的元素，然后检查它的 offsetWidth（另请参阅[如何通过 javascript 访问屏幕显示的 DPI 设置？](https://stackoverflow.com/q/476815/698168)）。有道理，但 iPhone 用这种技术骗了我，说它是 96ppi。

另一种方法可能是以英寸为单位获取显示器的尺寸，然后除以以像素为单位的宽度，但我也不知道该怎么做。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2014-09-23T21:17:24.927

```
<div id='testdiv' style='height: 1in; left: -100%; position: absolute; top: -100%; width: 1in;'></div>
<script type='text/javascript'>
  var devicePixelRatio = window.devicePixelRatio || 1;
  dpi_x = document.getElementById('testdiv').offsetWidth * devicePixelRatio;
  dpi_y = document.getElementById('testdiv').offsetHeight * devicePixelRatio;

  console.log(dpi_x, dpi_y);
</script>
```

从这里[获取 http://www.infobyip.com/detectmonitordpi.php](http://www.infobyip.com/detectmonitordpi.php)。适用于移动设备！(android 4.2.2 测试)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-03-11T13:37:35.357

我想出了一种不需要 DOM 的方法......根本

`width: x !important`DOM 可能很混乱，要求您在不知道样式表中发生了什么的情况下将内容附加到正文中。您还必须等待 DOM 准备好使用...

```
/**
 * Binary search for a max value without knowing the exact value, only that it can be under or over
 * It dose not test every number but instead looks for 1,2,4,8,16,32,64,128,96,95 to figure out that
 * you thought about #96 from 0-infinity
 *
 * @example findFirstPositive(x => matchMedia(`(max-resolution: ${x}dpi)`).matches)
 * @author Jimmy Wärting
 * @see {@link https://stackoverflow.com/a/35941703/1008999}
 * @param {function} fn       The function to run the test on (should return truthy or falsy values)
 * @param {number}   start=1  Where to start looking from
 * @param {function} _        (private)
 * @returns {number}          Intenger
 */
function findFirstPositive (f,b=1,d=(e,g,c)=>g<e?-1:0<f(c=e+g>>>1)?c==e||0>=f(c-1)?c:d(e,c-1):d(c+1,g)) {
  for (;0>=f(b);b<<=1);return d(b>>>1,b)|0
}

var dpi = findFirstPositive(x => matchMedia(`(max-resolution: ${x}dpi)`).matches)

console.log(dpi)
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-11-21T14:01:33.127

有`resolution`CSS 媒体查询——它允许您将 CSS 样式限制为特定分辨率：

*   [http://www.w3.org/TR/css3-mediaqueries/#resolution](http://www.w3.org/TR/css3-mediaqueries/#resolution)

但是，[它只支持 Firefox 3.5 及更高版本、Opera 9 及更高版本和 IE 9](http://www.browsersupport.net/CSS/%40media_%28resolution%29)。其他浏览器根本不会应用您的特定于分辨率的样式（尽管我没有检查过非桌面浏览器）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-12-17T15:33:34.507

这对我有用（但没有在手机上测试过）：

```
<body><div id="ppitest" style="width:1in;visible:hidden;padding:0px"></div></body> 
```

然后我放入.js：`screenPPI = document.getElementById('ppitest').offsetWidth;`

这让我得到了 96，这对应于我系统的 ppi。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-09-30T15:50:27.837

@Endless 的回复非常好，但根本不可读，这是一个类似的方法，具有固定的最小值/最大值（应该是好的）

```
var dpi = (function () {
    for (var i = 56; i < 2000; i++) {
        if (matchMedia("(max-resolution: " + i + "dpi)").matches === true) {
            return i;
        }
    }
    return i;
})(); 
```

matchMedia 现在得到了很好的支持，应该会给出很好的结果，请参阅[http://caniuse.com/#feat=matchmedia](http://caniuse.com/#feat=matchmedia)

请注意，浏览器不会为您提供确切的屏幕 dpi，而只是一个近似值

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-02-05T12:20:42.203

```
function getPPI(){
  // create an empty element
  var div = document.createElement("div");
  // give it an absolute size of one inch
  div.style.width="1in";
  // append it to the body
  var body = document.getElementsByTagName("body")[0];
  body.appendChild(div);
  // read the computed width
  var ppi = document.defaultView.getComputedStyle(div, null).getPropertyValue('width');
  // remove it again
  body.removeChild(div);
  // and return the value
  return parseFloat(ppi);
} 
```

（来自沃达丰）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-11-27T18:06:26.920

我还需要在不同的屏幕 dpi 下以相同的尺寸显示相同的图像，但仅适用于 Windows IE。我用了：

```
<img src="image.jpg" style="
    高度：表达式（比例（438、192））；
    宽度：表达式（比例（270，192））“ />

函数比例（x，dpi）{

    // dpi 用于图像的原始尺寸
    返回 x * screen.deviceXDPI/dpi；
}

```

在这种情况下，原始图像的宽度/高度为 270 和 438，并且图像是在 192dpi 屏幕上显影的。screen.deviceXDPI 未在 Chrome 中定义，需要更新缩放功能以支持 IE 以外的浏览器

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-23T00:31:16.293

根据定义，DPI 与显示器的物理尺寸相关。因此，如果不确切了解背后的硬件，您将无法获得真正的 DPI。

现代操作系统同意一个共同的价值，以便拥有兼容的显示器：96 dpi。这是一个耻辱，但这是事实。

您将不得不依靠嗅探来猜测计算分辨率所需的实际屏幕尺寸（DPI = PixelSize / ScreenSize）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-11T01:49:04.807

我认为您最好的方法是将“嗅探器”图像的建议与设备的已知 DPI 矩阵（通过用户代理和其他方法）结合起来。这不会是准确的，并且维护起来会很痛苦，但是如果不了解您正在尝试制作的应用程序的更多信息，这是我能提供的最佳建议。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-07-27T20:07:29.430

我刚刚找到了这个链接：[http](http://dpi.lv/) ://dpi.lv/ 。基本上，它是一个用于发现客户端设备分辨率、dpi 和屏幕尺寸的网络工具。

我在我的电脑和手机上访问过，它为我提供了正确的分辨率和 DPI。它有一个 github repo，所以你可以看到它是如何工作的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-25T21:20:25.820

你不能做点别的吗？例如，如果您正在生成要被相机识别的图像（即您运行程序，在相机上滑动手机，奇迹发生了），您不能使用与大小无关的东西吗？

如果这是要在受控环境中部署的应用程序，您能否提供校准实用程序？（你可以做一些简单的事情，比如打印带有小尺子的名片，在校准过程中使用它）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-03-21T18:08:56.307

来自@Endless 回复的可读代码：

```
const dpi = (function () {
    let i = 1;
    while ( !hasMatch(i) ) i *= 2;

    function getValue(start, end) {
        if (start > end) return -1;
        let average = (start + end) / 2;
        if ( hasMatch(average) ) {
            if ( start == average || !hasMatch(average - 1) ) {
                return average;
            } else {
                return getValue(start, average - 1);
            }
        } else {
            return getValue(average + 1, end);
        }
    }

    function hasMatch(x) {
        return matchMedia(`(max-resolution: ${x}dpi)`).matches;
    }

    return getValue(i / 2, i) | 0;
})(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-05-11T03:03:58.860

生成已知 DPI 列表： [https ://stackoverflow.com/a/6793227](https://stackoverflow.com/a/6793227)

检测确切的设备。使用类似的东西：

```
navigator.userAgent.toLowerCase(); 
```

例如检测手机时：

```
window.isMobile=/iphone|ipod|ipad|android|blackberry|opera mini|opera mobi|skyfire|maemo|windows phone|palm|iemobile|symbian|symbianos|fennec/i.test(navigator.userAgent.toLowerCase()); 
```

和利润！

# html - 如何使 DIV 表现得像 IMG 一样用作 CSS 精灵？

> ID：279753
> 
> 赞同：12
> 
> 时间：2008-11-11T01:20:48.593
> 
> 标签：html, css, css-sprites

我已经编写了代码，该代码根据页面中的 IMG 标签自动创建 CSS 精灵，并用 DIV 替换它们（我认为是）适当的 CSS 将精灵图像定位为背景，让适当的部分显示出来——问题是我不能让 DIV 充当 IMG 的替代品。

如果我将默认的“显示”值设置为“块”，那么如果原始 IMG 位于某些文本的末尾，则替换 DIV 将跳到文本之后的下一行（这当然是我所期望的带显示：块做）。

如果我将“显示”更改为内联，则 DIV 与文本保持在同一行，但它会忽略我设置的“宽度”和“高度”并折叠。我尝试将 ' 放在 DIV 中，但它只占用足够的宽度来包含 nbsp。

我尝试过将显示设置为所有可能的值（包括“晦涩”的值，如“table-row”、“run-in”、“compact”等），但都没有运气。甚至可以创建与 IMG 具有相同布局行为的 DIV 吗？

我愿意拥有比单个 DIV 更复杂的东西，但是我已经尝试了那里明显的东西（一个 DIV 在另一个内部 DIV 设置为显示：块与外部设置为显示：内联）但我没有也没有找到有效的组合。

在替换的 IMG/DIV 之外，我总是可以做一些特定的事情来获得我想要的布局，但我的目标是拥有一个通用的 auto-CSS-sprite 机制，无论 HTML 的其余部分如何，它都能正常工作。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-11T01:38:53.173

你试过了`display: inline-block;`吗？

您可能还必须`display: -moz-inline-block;`用于 firefox2

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T01:36:36.080

图像相当于“显示：内联块”。这最初并未包含在 CSS 中，但部分是为了解决图像以这种方式运行的事实。

问题是所有浏览器现在都支持它。如果您甚至想支持一年前的浏览器，那您就被卡住了。

另一个但不是很好的解决方案是浮动 div（“float：left”）。

> **inline-block**：在 CSS 2.1 中引入。这会导致元素生成一个块元素框，该框将与周围的内容一起流动，就好像它是一个单一的内联框（**行为很像被替换的元素 [意思是图像] 会**。）。

[来源 Mozilla 开发者中心](https://developer.mozilla.org/En/CSS:display)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T01:33:58.317

Display: inline-block 应该在这种情况下工作。你试过了吗？

# perl - 如何使用 Perl 通过 Gmail 发送邮件？

> ID：279757
> 
> 赞同：9
> 
> 时间：2008-11-11T01:25:55.977
> 
> 标签：perl, email, gmail

如何通过我的 Gmail 帐户使用 Perl 发送电子邮件？我尝试过的一个 CPAN 库（Mail::Webmail::Gmail）不起作用，我看不到它有太多的活动。

目前我真的只需要发送一条消息。但是，获取我的联系人、在收到带有特定标签的新电子邮件时采取行动等高级功能显然在另一天看起来很有吸引力。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T01:31:14.937

您是否尝试过[Email::Send::Gmail](http://search.cpan.org/dist/Email-Send-Gmail)？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-11T01:33:07.647

您总是可以使用 SMTP 发送。服务器是 smtp.gmail.com，它需要 TLS 并使用身份验证。您可能还必须在您的帐户中启用 POP/IMAP。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-11T01:52:24.097

我在使用 Mail::Webmail::Gmail 时遇到了同样的问题，我最终使用[Net::IMAP::Simple::SSL](http://search.cpan.org/dist/Net-IMAP-Simple-SSL/)从 gmail 获取邮件。我猜如果我必须尝试用它发送邮件，我会首先尝试[Net::SMTP::Server](http://search.cpan.org/~macgyver/SMTP-Server-1.1/Server.pm)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-13T23:03:08.527

我扩展了 WWW::Contact::GoogleContactsAPI 以获取所有联系人字段。看：

[是否有一个 Perl 模块来连接 Google Contacts API？](https://stackoverflow.com/questions/831535/is-there-a-perl-module-to-interface-to-google-contacts-api)

# c - 使用 dlsym 并将 -ldl 添加到标志

> ID：279763
> 
> 赞同：3
> 
> 时间：2008-11-11T01:28:10.357
> 
> 标签：c, unix, dynamic-linking

我正在尝试编写一个使用 的 C 程序`dlysm`，并且我不断收到对 dlysm 的未定义引用。我想我需要设置我的`-ldl`标志，但我不知道该怎么做。

我对 linux 和设置变量非常陌生。如果这是我需要做的，有人可以帮助我使用命令吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T01:31:44.670

`-l`库选项在链接时使用。

如果您只编译一个源文件 ( `gcc -o program program.c`)，那么您可以同时编译和链接。只需添加`-ldl`.

如果您编译多个对象 ( `*.o`) 文件，然后将它们链接在一起，请指定`-ldl`链接器 ( `ld`) 的选项。

另见`man ld`和`man cc`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T01:30:57.933

`-ldl`作为参数传递给编译器。

例子：

```
gcc myprog.c -o app -ldl 
```

# wpf - WPF 中的 DateTimePicker 控件

> ID：279766
> 
> 赞同：4
> 
> 时间：2008-11-11T01:29:28.137
> 
> 标签：wpf, datetimepicker

我正在寻找一个可以用作文本框的 DateTimePicker 控件，以便用户可以随意输入日期/时间数据（即，输入字符串**“11/09/2008 12:30:00”）**或可以选择日期/时间从包含日历/时间框的下拉列表中（我的意思是该控件可以提供上述两个选项）。如果您发现了如此灵活的控件（而且也是免费的），请给我所需的信息以获取它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T01:52:46.843

WPF 团队有[DatePicker 和 Calendar 控件](http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-calendar-datepicker-walkthrough.aspx)，但我不相信它们处理时间（如您的示例中所示） - 只是日期。不过值得一看。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T14:44:46.560

[Telerik](http://www.telerik.com/)有一个不错的 DateTimePicker 控件，但它不是免费的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T10:47:25.920

看看这个[WPF 日期选择器](https://stackoverflow.com/questions/50327/wpf-datepicker-what-is-the-best)问题。

干杯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-10T16:36:02.420

老问题，但对于任何感兴趣的人... Extended WPF Toolkit™ Community Edition 是免费的（也有一个高级选项），并且包含一个[DateTimePicker](https://wpftoolkit.codeplex.com/wikipage?title=DateTimePicker)，我发现它在 WPF 中非常有用！

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-13T14:32:26.210

我不确定您是否不想使用 JQuery 或不知道它。但这是来自 JQuery 的免费/开源[日期时间选择器](http://docs.jquery.com/UI/Datepicker)，它完全符合您的要求，还有更多。

# ruby - 在 Ruby 中转换为日期时间和时间

> ID：279769
> 
> 赞同：137
> 
> 时间：2008-11-11T01:31:15.780
> 
> 标签：ruby, datetime, time

如何在 Ruby 中的 DateTime 和 Time 对象之间进行转换？

* * *

## 回答 #1

> 赞同：192
> 
> 时间：2008-11-11T09:49:50.810

```
require 'time'
require 'date'

t = Time.now
d = DateTime.now

dd = DateTime.parse(t.to_s)
tt = Time.parse(d.to_s) 
```

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2011-12-14T21:11:15.663

作为对 Ruby 生态系统状态的更新，`Date`现在`DateTime`有了`Time`在各种类之间进行转换的方法。使用 Ruby 1.9.2+：

```
pry
[1] pry(main)> ts = 'Jan 1, 2000 12:01:01'
=> "Jan 1, 2000 12:01:01"
[2] pry(main)> require 'time'
=> true
[3] pry(main)> require 'date'
=> true
[4] pry(main)> ds = Date.parse(ts)
=> #<Date: 2000-01-01 (4903089/2,0,2299161)>
[5] pry(main)> ds.to_date
=> #<Date: 2000-01-01 (4903089/2,0,2299161)>
[6] pry(main)> ds.to_datetime
=> #<DateTime: 2000-01-01T00:00:00+00:00 (4903089/2,0,2299161)>
[7] pry(main)> ds.to_time
=> 2000-01-01 00:00:00 -0700
[8] pry(main)> ds.to_time.class
=> Time
[9] pry(main)> ds.to_datetime.class
=> DateTime
[10] pry(main)> ts = Time.parse(ts)
=> 2000-01-01 12:01:01 -0700
[11] pry(main)> ts.class
=> Time
[12] pry(main)> ts.to_date
=> #<Date: 2000-01-01 (4903089/2,0,2299161)>
[13] pry(main)> ts.to_date.class
=> Date
[14] pry(main)> ts.to_datetime
=> #<DateTime: 2000-01-01T12:01:01-07:00 (211813513261/86400,-7/24,2299161)>
[15] pry(main)> ts.to_datetime.class
=> DateTime 
```

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-11-11T01:43:39.763

您将需要两次略有不同的转换。

要从转换 `Time` 为 `DateTime`您可以修改 Time 类，如下所示：

```
require 'date'
class Time
  def to_datetime
    # Convert seconds + microseconds into a fractional number of seconds
    seconds = sec + Rational(usec, 10**6)

    # Convert a UTC offset measured in minutes to one measured in a
    # fraction of a day.
    offset = Rational(utc_offset, 60 * 60 * 24)
    DateTime.new(year, month, day, hour, min, seconds, offset)
  end
end 
```

对 Date 的类似调整将让您转换 `DateTime` 为 `Time` .

```
class Date
  def to_gm_time
    to_time(new_offset, :gm)
  end

  def to_local_time
    to_time(new_offset(DateTime.now.offset-offset), :local)
  end

  private
  def to_time(dest, method)
    #Convert a fraction of a day to a number of microseconds
    usec = (dest.sec_fraction * 60 * 60 * 24 * (10**6)).to_i
    Time.send(method, dest.year, dest.month, dest.day, dest.hour, dest.min,
              dest.sec, usec)
  end
end 
```

请注意，您必须在本地时间和 GM/UTC 时间之间进行选择。

上述两个代码片段均取自 O'Reilly 的[Ruby Cookbook](http://safari.oreilly.com/0596523696)。他们的代码重用[政策](http://oreilly.com/pub/a/oreilly/ask_tim/2001/codepolicy.html)允许这样做。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-08-18T14:39:15.723

不幸的是，`DateTime.to_time, Time.to_datetime`and`Time.parse`函数不保留时区信息。转换期间所有内容都转换为本地时区。日期算术仍然有效，但您将无法显示带有原始时区的日期。上下文信息通常很重要。例如，如果我想查看在纽约的营业时间内执行的交易，我可能更愿意看到它们显示在原来的时区，而不是我在澳大利亚的本地时区（比纽约早 12 小时）。

下面的转换方法确实保留了该 tz 信息。

对于 Ruby 1.8，请查看[Gordon Wilson 的回答](https://stackoverflow.com/questions/279769/convert-to-from-datetime-and-time-in-ruby/279785#279785)。它来自可靠的 Ruby Cookbook。

对于 Ruby 1.9，它稍微容易一些。

```
require 'date'

# Create a date in some foreign time zone (middle of the Atlantic)
d = DateTime.new(2010,01,01, 10,00,00, Rational(-2, 24))
puts d

# Convert DateTime to Time, keeping the original timezone
t = Time.new(d.year, d.month, d.day, d.hour, d.min, d.sec, d.zone)
puts t

# Convert Time to DateTime, keeping the original timezone
d = DateTime.new(t.year, t.month, t.day, t.hour, t.min, t.sec, Rational(t.gmt_offset / 3600, 24))
puts d 
```

这将打印以下内容

```
2010-01-01T10:00:00-02:00
2010-01-01 10:00:00 -0200
2010-01-01T10:00:00-02:00 
```

保留完整的原始日期时间信息，包括时区。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-21T12:39:23.717

改进 Gordon Wilson 解决方案，这是我的尝试：

```
def to_time
  #Convert a fraction of a day to a number of microseconds
  usec = (sec_fraction * 60 * 60 * 24 * (10**6)).to_i
  t = Time.gm(year, month, day, hour, min, sec, usec)
  t - offset.abs.div(SECONDS_IN_DAY)
end 
```

您将在 UTC 中获得相同的时间，失去时区（不幸的是）

另外，如果你有 ruby​​ 1.9，试试这个`to_time`方法

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-06-28T13:54:47.923

在进行此类转换时，应考虑从一个对象转换到另一个对象时的时区行为。[我在这个 stackoverflow帖子](https://stackoverflow.com/a/21075654)中找到了一些很好的注释和示例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-05T15:55:22.297

您可以使用`to_date`，例如

```
> Event.last.starts_at
=> Wed, 13 Jan 2021 16:49:36.292979000 CET +01:00
> Event.last.starts_at.to_date
=> Wed, 13 Jan 2021 
```

# c# - 在 Web 表单中使用 URL 路由生成 URL

> ID：279779
> 
> 赞同：6
> 
> 时间：2008-11-11T01:39:10.537
> 
> 标签：c#, url, routing, url-routing

我知道在 MVC 框架中，你有 Html 类来创建 URL：

```
Html.ActionLink("About us", "about", "home"); 
```

但是如果你想在 Webforms 中生成 Urls 怎么办？

关于使用 Webforms 生成 URL 的详细信息，我还没有找到一个非常好的资源。

例如，如果我生成这样的路线：

```
Route r = new Route("{country}/{lang}/articles/{id}/{title}",
                  new ArticleRouteHandler("~/Forms/Article.aspx"));
Route r2 = new Route("{country}/{lang}/articles/",
                  new ArticleRouteHandler("~/Forms/ArticlesList.aspx"));

Routes.Add(r);
Routes.Add(r2); 
```

我将如何使用路由表数据生成 URL。

## 如何根据我的路由生成 URL？

例如。/ca/en/articles/123/Article-Title 没有

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T00:02:49.170

感谢您的回答。除此之外，这是我所做的：

## 在 Global.asax

```
RouteValueDictionary rvdSiteDefaults 
    = new RouteValueDictionary { { "country", "ca" }, { "lang", "en" } };

Route oneArticle 
    = new Route("{country}/{lang}/articles/a{id}/{title}",
        rvdSiteDefaults,
        rvdConstrainID,
        new ArticleRouteHandler("~/Articles/Details.aspx"));

Routes.Add( "Article", oneArticle); 
```

## 从文章对象创建 URL

```
public static string CreateUrl(Article a) {
    // Note, Article comes from Database, has properties of ArticleID, Title, etc.
    RouteValueDictionary parameters;

    string routeName = "Article"; // Set in Global.asax

    parameters 
      = new RouteValueDictionary { 
         { "id", a.ArticleID }, 
         { "title", a.Title.CleanUrl() } 
        }; 
```

CleanUrl()[返回一个 URL 友好名称](https://stackoverflow.com/questions/266719/url-routing-handling-spaces-and-illegal-characters-when-creating-friendly-urls#271568)。

```
 VirtualPathData vpd = RouteTable.Routes.GetVirtualPath(null, routeName, parameters);

    string url = vpd.VirtualPath; 
    return url; // eg. /ca/en/1/The-Article-Title
} 
```

达达！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T16:14:27.383

正如您所说，ASP.NET MVC 为您提供了一组帮助方法来“反向查找”RouteTable 并为您生成 URL。我还没有玩过这么多，但据我所知，您需要在 RouteCollection（很可能是 RouteTable.Routes）上调用 GetVirtualPath 方法。所以像：

```
Dim routedurl = RouteTable.Routes.GetVirtualPath(context, rvd).VirtualPath 
```

您需要传递 RequestContext 和 RouteValueDictionary。RouteValueDictionary 包含路由参数（因此在您的情况下，类似于county="UK"、lang="EN-GB" 等。棘手的部分是RequestContext，因为这不是普通HttpContext 的一部分。您可以将其推送到IRouteHandler 中的 HttpContext：

```
requestContext.HttpContext.Items("RequestContext") = requestContext 
```

然后在需要时在您的 IHttpHandler（aspx 页面）中再次恢复它：

```
Dim rvd = 
  New RouteValueDictionary(New With {.country = "UK", .lang = "EN-GB"})
Dim routedurl = 
  RouteTable.Routes.GetVirtualPath(context.Items("RequestContext"), rvd).VirtualPath 
```

很抱歉在 VB 中回答了一个 C# 问题，只是我必须提供的 ASP.NET 路由站点是在 VB.NET 中的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-11T04:12:07.000

超链接 hl = new Hyperlink(); hl.Text = "点击这里"; hl.NavigateUrl="~/Forms/Article.aspx"; 主要是AnyControl.Controls.Add(hl);

至于把它放在一个列表中......要么（1）循环/迭代，要么（2）Linq to XML。

# java - 在 Java Swing 库中使用带有面板的图形的问题

> ID：279781
> 
> 赞同：0
> 
> 时间：2008-11-11T01:42:22.900
> 
> 标签：java, swing, graphics, nullpointerexception, panels

大家好，我正在尝试运行以下程序，但收到 NullPointerException。我是 Java swing 库的新手，所以我可能会做一些非常愚蠢的事情。无论哪种方式，这里都是我的两个班级，我现在只是在玩，我想做的就是画一个该死的圆圈（我想画一个绞刑架，最后有一个刽子手）。

```
package hangman2;

import java.awt.*;
import javax.swing.*;

public class Hangman2 extends JFrame{
    private GridLayout alphabetLayout = new GridLayout(2,2,5,5);
    private Gallow gallow = new Gallow();

    public Hangman2() {

        setLayout(alphabetLayout);

        setSize(1000,500);
        setVisible( true );

    }

    public static void main( String args[] ) {   
     Hangman2 application = new Hangman2();
     application.setDefaultCloseOperation( JFrame.EXIT_ON_CLOSE );
    }
}

package hangman2;

import java.awt.*;
import javax.swing.*;

public class Gallow extends JPanel {
    private Graphics g;

    public Gallow(){
        g.fillOval(10, 20, 40, 25);       
    }
} 
```

NullPointerException 出现在 g.fillOval 行。

提前致谢，

托梅克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T01:49:27.847

你得到 NPE 因为`g`没有设置，因此，它是`null`. 此外，您不应该在构造函数中进行绘图。[`paintComponent(Graphics g)`](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JComponent.html#paintComponent(java.awt.Graphics))而是重载。

```
public class Gallow extends JPanel {
    public paintComponent(Graphics g){
        g.fillOval(10, 20, 40, 25);       
    }
} 
```

我也会研究[BufferedImage](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/image/BufferedImage.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T02:39:36.797

有几件事：不要忘记将面板添加到`JFrame`. 并覆盖为您的自定义绘画的`paint()`方法。`JPanel`您不需要声明 Graphics 对象，因为`JPanel`在任何情况下 ' 的 paint 方法都会引用一个对象。

```
package hangman2;

import java.awt.*;
import javax.swing.*;

public class Hangman2 extends JFrame{
    private GridLayout alphabetLayout = new GridLayout(2,2,5,5);
    private Gallow gallow = new Gallow();

    public Hangman2() {

        setLayout(alphabetLayout);
        add(gallow, BorderLayout.CENTER);//here
        setSize(1000,500);
        setVisible( true );

    }

    public static void main( String args[] ) {   
        Hangman2 application = new Hangman2();
        application.setDefaultCloseOperation( JFrame.EXIT_ON_CLOSE );
    }
}

package hangman2;

import java.awt.*;
import javax.swing.*;

public class Gallow extends JPanel {

    public Gallow(){
        super();
    }

    public void paint(Graphics g){
        g.fillOval(10, 20, 40, 25);       
    }
} 
```

# python - 如何在 Django 中为模型获取具有反向关系的所有类的集合？

> ID：279782
> 
> 赞同：4
> 
> 时间：2008-11-11T01:42:39.547
> 
> 标签：python, django, django-models, django-orm

鉴于：

```
from django.db import models

class Food(models.Model):
     """Food, by name."""
     name = models.CharField(max_length=25)

class Cat(models.Model):
     """A cat eats one type of food"""
     food = models.ForeignKey(Food)

class Cow(models.Model):
     """A cow eats one type of food"""
     food = models.ForeignKey(Food)

class Human(models.Model):
     """A human may eat lots of types of food"""
     food = models.ManyToManyField(Food) 
```

仅给定 Food 类，如何获得与它具有“反向关系”的所有类的集合。即给定类**Food**，如何获得**Cat**、**Cow**和**Human**类。

我认为这是可能的，因为 Food 具有三个“反向关系”：*Food.cat_set*、*Food.cow_set*和*Food.human_set*。

感谢您的帮助，谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-11T02:00:20.570

对源代码的一些挖掘揭示了：

django/db/models/options.py：

```
def get_all_related_objects(self, local_only=False):

def get_all_related_many_to_many_objects(self, local_only=False) 
```

并且，在上面的模型上使用这些函数，您假设得到：

```
>>> Food._meta.get_all_related_objects()
[<RelatedObject: app_label:cow related to food>,
    <RelatedObject: app_label:cat related to food>,]

>>> Food._meta.get_all_related_many_to_many_objects()
[<RelatedObject: app_label:human related to food>,]

# and, per django/db/models/related.py
# you can retrieve the model with
>>> Food._meta.get_all_related_objects()[0].model
<class 'app_label.models.Cow'> 
```

*注意*：我听说 Model._meta 是“不稳定的”，在 Django-1.0 之后的世界中可能不应该依赖它。

谢谢阅读。:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-11T03:48:52.053

任何一个

A) 使用[多表继承](http://docs.djangoproject.com/en/dev/topics/db/models/#multi-table-inheritance)并创建一个 Cat、Cow 和 Human 继承自的“Eater”基类。

B）使用[通用关系](http://docs.djangoproject.com/en/dev/ref/contrib/contenttypes/#id1)，其中食物可以链接到任何其他模型。

这些都是有据可查且官方支持的功能，您最好坚持使用它们以保持自己的代码干净，避免变通方法，并确保将来仍会支持它。

-- 编辑（又名“如何成为名声妓女”）

因此，这是针对该特定情况的秘诀。

假设您绝对想要 Cat、Cow 和 Human 的单独模型。在现实世界的应用程序中，您想问自己为什么“类别”字段不能胜任这项工作。

通过泛型关系更容易到达“真实”类，所以这里是 B 的实现。我们不能在 Person、Cat 或 Cow 中拥有那个“食物”字段，否则我们会遇到同样的问题。所以我们将创建一个中介“FoodConsumer”模型。如果我们不想要一个实例以上的食物，我们将不得不编写额外的验证测试。

```
from django.db import models
from django.contrib.contenttypes.models import ContentType
from django.contrib.contenttypes import generic

class Food(models.Model):
     """Food, by name."""
     name = models.CharField(max_length=25)

# ConsumedFood has a foreign key to Food, and a "eaten_by" generic relation
class ConsumedFood(models.Model):
    food = models.ForeignKey(Food, related_name="eaters")
    content_type = models.ForeignKey(ContentType, null=True)
    object_id = models.PositiveIntegerField(null=True)
    eaten_by = generic.GenericForeignKey('content_type', 'object_id')

class Person(models.Model):
    first_name = models.CharField(max_length=50)
    last_name = models.CharField(max_length=50)
    birth_date = models.DateField()
    address = models.CharField(max_length=100)
    city = models.CharField(max_length=50)
    foods = generic.GenericRelation(ConsumedFood)

class Cat(models.Model):
    name = models.CharField(max_length=50)
    foods = generic.GenericRelation(ConsumedFood)    

class Cow(models.Model):
    farmer = models.ForeignKey(Person)
    foods = generic.GenericRelation(ConsumedFood) 
```

现在，为了演示它，让我们编写这个工作[doctest](http://docs.djangoproject.com/en/dev/topics/testing/#writing-doctests)：

```
"""
>>> from models import *

Create some food records

>>> weed = Food(name="weed")
>>> weed.save()

>>> burger = Food(name="burger")
>>> burger.save()

>>> pet_food = Food(name="Pet food")
>>> pet_food.save()

John the farmer likes burgers

>>> john = Person(first_name="John", last_name="Farmer", birth_date="1960-10-12")
>>> john.save()
>>> john.foods.create(food=burger)
<ConsumedFood: ConsumedFood object>

Wilma the cow eats weed

>>> wilma = Cow(farmer=john)
>>> wilma.save()
>>> wilma.foods.create(food=weed)
<ConsumedFood: ConsumedFood object>

Felix the cat likes pet food

>>> felix = Cat(name="felix")
>>> felix.save()
>>> pet_food.eaters.create(eaten_by=felix)
<ConsumedFood: ConsumedFood object>

What food john likes again ?
>>> john.foods.all()[0].food.name
u'burger'

Who's getting pet food ?
>>> living_thing = pet_food.eaters.all()[0].eaten_by
>>> isinstance(living_thing,Cow)
False
>>> isinstance(living_thing,Cat)
True

John's farm is in fire ! He looses his cow.
>>> wilma.delete()

John is a lot poorer right now
>>> john.foods.clear()
>>> john.foods.create(food=pet_food)
<ConsumedFood: ConsumedFood object>

Who's eating pet food now ?
>>> for consumed_food in pet_food.eaters.all():
...    consumed_food.eaten_by
<Cat: Cat object>
<Person: Person object>

Get the second pet food eater
>>> living_thing = pet_food.eaters.all()[1].eaten_by

Try to find if it's a person and reveal his name
>>> if isinstance(living_thing,Person): living_thing.first_name
u'John'

""" 
```

# sql-server - MSSQL 2000 升级到 MSSQL 2005 的兼容性

> ID：279783
> 
> 赞同：1
> 
> 时间：2008-11-11T01:42:40.763
> 
> 标签：sql-server, sql-server-2005, sql-server-2000, compatibility

其实我得搞清楚MSSQL 2000升级到MSSQL 2005的兼容性。MSSQL 2000是安装在Citrix box里面的。我通过备份数据库并在本地计算机中恢复来进行并行升级。现在我必须弄清楚这些应用程序是否可以在 MSSQL 2005 中运行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T01:47:17.103

您可能需要提供有关这些应用程序是什么的更多信息，但大概最简单的方法是将它们重定向到 SQL 2005 数据库并运行您的测试套件以查看它们是否仍按预期运行。

请记住，在安装 SQL 2005 时要选择适用于您的应用程序的排序规则（使用与 SQL 2000 兼容的排序规则可能是这里的最佳选择）。

# c# - 并行扩展：帮助我理解 LazyInit

> ID：279787
> 
> 赞同：3
> 
> 时间：2008-11-11T01:44:24.770
> 
> 标签：c#, parallel-extensions

**面向未来读者的更新：**当 .NET 4 发布时，`LazyInit<T>`CTP 将被重命名为`Lazy<T>`并将从结构更改为类，因此几乎不会适用，除非作为可变结构可能存在问题的说明如果你不小心。

我一直在 Parallel Extensions June CTP 中尝试使用 LazyInit，我希望下面的代码会打印一千次相同的 Guid，但它会打印出一千个不同的 Guid。显然，我在这里遗漏了一些关于 LazyInit 应该如何工作的明显内容，如果有人能指出它是什么，我将不胜感激。

```
using System;
using System.Diagnostics;
using System.Threading;

namespace TestApp
{
    class Program
    {
        static void Main(string[] args)
        {
            for (int i=0; i < 1000; i++)
            {
                Console.WriteLine(TestClass.Instance.Id);
            }

            Console.Write("Press any key to continue:");
            Console.ReadKey();
        }

        private class TestClass
        {
            private static readonly LazyInit<TestClass> _instance = new LazyInit<TestClass>(() => new TestClass(), LazyInitMode.EnsureSingleExecution);

            public static TestClass Instance
            {
                get { return _instance.Value; }
            }

            private TestClass()
            {
                Debug.WriteLine("TestClass Constructor");
                Id = Guid.NewGuid();
            }

            public Guid Id { get; private set; }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-11T02:34:01.283

短版：使静态非只读，它将修复您遇到的错误。

长版：这是 C# 中一个非常被误解的部分。当您访问一个结构时，您正在访问该结构的副本。LazyInit.Value 的底层调用是一个变异操作。通常会执行回写，但在只读字段的情况下，无法执行回写，因此您仍然会留下未初始化的值。

极其详细的解释：[http ://ericlippert.com/2008/05/14/mutating-readonly-structs/](http://ericlippert.com/2008/05/14/mutating-readonly-structs/)

# ruby-on-rails - 是否可以在rails中有一个复合外键？

> ID：279791
> 
> 赞同：5
> 
> 时间：2008-11-11T01:47:47.680
> 
> 标签：ruby-on-rails, database-design, has-many

假设以下数据模式：

```
Usage
======
client_id
resource
type
amount

Billing
======
client_id
usage_resource
usage_type
rate 
```

在此示例中，假设我有多个资源，每个资源都可以以多种方式使用。例如，一个资源是`widget`. `Widgets`可以`foo`编辑，他们可以`bar`编辑。 `Gizmo`s 也可以`foo`ed 和`bar`ed。这些使用类型按不同的费率计费，甚至可能针对不同的客户使用不同的费率。每次使用（资源）的出现都记录在使用表中。每个计费费率（针对客户端、资源和类型组合）都存储在计费表中。

*（顺便说一句，如果这个数据模式不是解决这个问题的正确方法，请提出建议。）*

是否可以使用 Ruby on Rails 和 ActiveRecord 创建`has_many`从 Billings 到 Usages 的关系，以便我可以获得给定计费率的使用实例列表？有没有`has_many, :through`我不知道的语法？

再一次，我可能从错误的角度来处理这个问题，所以如果你能想到更好的方法，请说出来！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T02:31:17.920

sourceforge 显然有一个项目来扩展 Rails 的 ActiveRecord 并支持[Composite Primary Keys](http://compositekeys.rubyforge.org/)。我没有使用过这个扩展，但它可能会对你有所帮助。它也是 ruby​​forge 的瑰宝。

从 2.0 版开始，Plain Ruby on Rails 不支持复合主键（参见[HowToUseLegacySchemas](http://wiki.rubyonrails.org/rails/pages/howtouselegacyschemas)）。每个表都必须有一个名为“”的单列自增键`id`。

我看到的解释是：“如果你想使用遗留数据库，你只需要复合主键。” 这当然是对数据建模的一种荒谬无知的看法。

我看到的解决方案是：

*   Usage.client_id -> Client.id
*   Usage.type_id -> Usagetype.id
*   Usage.resource_id -> Resource.id
*   Billing.usage_id -> Usage.id
*   Billing.client_id -> Client.id
*   Billing.type_id -> Usagetype.id
*   Billing.resource_id -> Resource.id

显然是多余的外键，`Billing`试图强制执行部分引用完整性。但它并没有完全到达那里——它不会阻止您在`Billing`引用行中创建行，`Usage`其中包含错误的客户端/资源/使用类型组合，与计费表中引用行中的行不匹配。

**编辑：** @Yarik：是的，你是对的。`Usage`参考更有意义`Billing`。

*   Usage.billing_id -> Billing.id

唔。我制作了 ER 图，但无法将其作为图像插入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-03T23:03:08.830

您可以在迁移中使用“执行”命令创建任何您想要的约束。

您可能希望向 .save 添加一些错误处理，以处理约束引发错误的情况。

您不能使用 AR 的内置方法生成器从计费中生成使用情况，但您仍然可以使用以下方法：

```
class Billing
  def usages
    Usage.find(:all, :conditions => ["x = ? and y = ?", self.x, self.y])
  end
end 
```

# delphi - 有人可以为 Delphi 推荐一个颜色选择器组件吗？

> ID：279822
> 
> 赞同：6
> 
> 时间：2008-11-11T02:13:28.690
> 
> 标签：delphi, colors, components, picker

我正在为 Delphi 寻找一个（最好是免费的）组件，以便用户轻松选择大约 100 种不同的颜色。

我目前有一个作为 DevExpress 编辑器的一部分，但它只有大约 20 种合适的颜色可供选择，还有一堆其他的“Windows”颜色，如 clHighlight、clBtnFace 等。

它适用于普通用户，因此希望避免要求他们手动选择 RGB 值。

类似于 MS Paint 中的颜色选择器的东西可能会起作用，或者列出 X11/web 颜色的东西：

[http://en.wikipedia.org/wiki/Web_Colors](http://en.wikipedia.org/wiki/Web_Colors)

所以，如果你有任何建议，请告诉我。

**谢谢大家的建议**

所有的建议都很好，我没有意识到可以调用 MS Paint 颜色对话框，这就是我所需要的，并且是最简单的解决方案。谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-11T02:48:35.780

德尔福宝石的颜色选择器控制，也许？

[http://www.soft-gems.net/index.php/controls/color-picker-control](http://www.soft-gems.net/index.php/controls/color-picker-control)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-11T05:28:46.313

TColorDialog 有什么问题？
它为您提供标准的 Windows 颜色对话框，与 MSPaint 中的完全相同...
添加这些选项以直接展开并显示所有可用颜色。

```
object ColorDialog1: TColorDialog
  Options = [cdFullOpen, cdAnyColor]
end 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-11T02:56:24.827

试试 MXS 的 mbColor Lib。可能是 Delphi 最全面的颜色选择组件集。[MXS 组件](http://mxs.bergsoft.net/index.php?p=3)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T12:44:05.997

在 blaise pascal 杂志的第 3 期中有一篇关于创建自定义颜色选择组件的文章。

[http://www.blaisepascal.eu/blaisepascal_3/color_selection_component_david_dirkse.php](http://www.blaisepascal.eu/blaisepascal_3/color_selection_component_david_dirkse.php)

# project-management - Basecamp 中用于软件开发管理和协作的最大缺失功能

> ID：279825
> 
> 赞同：7
> 
> 时间：2008-11-11T02:18:41.423
> 
> 标签：project-management, collaboration, basecamp

如果我们采用[Basecamp](http://basecamphq.com)进行错误跟踪、任务跟踪、外部文档、协作和项目管理，我们的团队可能会发现哪些功能不足？

我以前使用过免费版本，并认为 37Signals 制作了出色的产品 - 但我想听听你的缺点可能是什么。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T14:33:24.903

我已经使用 BaseCamp 2 年了，发现它是一个出色的通用项目信息门户。使用实时项目视图存储文档、待办任务和里程碑的能力令人印象深刻。

不幸的是，他们“保持简单”的口号在功能方面也有很多缺点：

1.  除了最基本的里程碑任务之外，日历实际上无法用于任何事情......为了跟踪我们的开发团队，我们实际上整合了一个自定义 Google 日历实现并将其用于所有开发人员及其任务
2.  BaseCamp 很难用于错误跟踪，一旦你在其中获得了分配给不同人的公平数字 - 缺乏排序能力（不仅仅是打开和关闭人员） - 使用完整的错误跟踪解决方案你会更开心比如 FogBugz。
3.  对于一般项目管理 Base Camp 很好，但我们还发现我们有外部文档，其中保存了所有“真实”信息 - 基本上是多页规格，只是每隔一段时间将它们上传到 Base Camp。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T02:24:42.877

上次评估 Basecamp 时，我发现缺少的一项功能是查看多个项目的工作量或其他信息的能力。例如，如果我想知道 Developer X 是否有太多事情要做，或者在几个项目中分散得太少，我不知道该怎么做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T02:33:18.430

对我来说，缺少的功能是以适合我的方式存储我的开发故事的能力。我想要一个单一的模板，我可以用它来生成每个故事以及将故事链接在一起的能力。最终，我最终为此使用了 Wiki。我真的不需要待办事项列表或时间跟踪的东西（这由公司范围的应用程序单独处理）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-11T12:21:40.467

很难管理自己的文档。写板并没有为您提供一种格式化代码的好方法，并且变得难以管理，您在项目中拥有超过 10 个。如果你有很多，消息/文件会变得混乱。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T16:35:47.513

任务估计值与实际值是我注意到的一个大问题。还能够将 tiem 标记为已收费将是它目前缺乏的一个很好的功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-24T13:59:12.643

你不能导出你的文件，他们甚至不提供文件 api。

所以如果你出去，你会得到一些工作来拿你的文件。

最近，我正在帮助一个客户将 50 个项目从 Basecamp 转移到 Assembla。他们说 Assembla 更适合项目管理，而且它有[更多的功能](http://www.assembla.com/features)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-30T11:00:07.173

对我来说，缺少的功能是以适合我的方式存储我的开发故事的能力。我想要一个单一的模板，我可以用它来生成每个故事以及将故事链接在一起的能力。最终，我最终为此使用了 Wiki。我真的不需要待办事项列表或时间跟踪的东西（这由公司范围的应用程序单独处理）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-03-13T10:52:33.450

使用 Basecamp，我们无法跟踪我们在任务上花费的时间，一项任务无法分配给多个人，无法对重要事项保密，无法将消息保密，在校对设计时遇到困难，无法自由聊天我们团队的成员。所以我们选择了 ProofHub。它有时间表、待办事项、casper 模式、私人消息、校对工具和内置浏览器聊天。我们很好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-09-11T05:27:34.863

我发现 Basecamp 在用户角色方面存在很大差距。项目中的人（“客户”除外）不可能只看到某些待办事项列表。我希望能够为自由职业者分配角色，以便他们只能访问项目中的某些任务列表。

# function - 在设计哈希函数时您会考虑哪些问题？

> ID：279833
> 
> 赞同：1
> 
> 时间：2008-11-11T02:24:05.967
> 
> 标签：function, hash

我不是在寻找有关散列信息的链接。

我不是在寻找世界上最大的哈希函数。

我对描述的小故事很感兴趣

*   你工作的问题领域
*   您正在使用的数据的性质
*   在为数据设计哈希函数时，您的思考过程是什么。
*   你对你的结果有多满意。
*   您从可能对其他人有价值的经验中学到的东西。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T02:56:02.223

我考虑的第一个问题是已建立的算法是否适合我的要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T03:03:41.600

从事数据仓库开发。我们有一个包含大约 9,000 行的维度。正在开发的查询包括一些非常丑陋的查询。

所以，我开始分析维度行。维度行基于列的各种组合进行聚类。聚类是从某个键到共享该键的维度行列表的映射。因此，哈希键是列值的元组。

Python 中的中间结果如下所示

```
{ 
    ( (col1, col2), (col3, col4) ) : [ aRow, anotherRow, row3, ... ],
    ( (col1, col2), (col3, col4) ) : [ row1, row2, row3\. row4, ... ],
} 
```

从技术上讲，这是一个倒排索引。

哈希键在构建列值元组时需要小心，部分原因是 Python 不会使用可变集合（即列表）。更重要的是，元组不是列值的简单平面列表。它们通常是二元组，试图根据键组合将维度行划分为不相交的子集

深入的哈希算法是内置的 Python 哈希。然而，选择键并不明显或容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T02:58:59.657

我会支持亚当所说的：不要重新发明哈希轮

我唯一一次需要自定义散列函数是比较有向图的相等性；哈希函数让我可以非常有效地判断两个图何时*不*相等（当哈希值匹配时，我仍然必须进行逐节点比较才能确定）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T04:52:15.123

我首先想到的是`steal`散列算法及其代码的最佳位置。当且仅当我发现没有合适的算法时，我才会使用它们作为起点来创建自己的算法。平心而论，我在这个行业已经7年了，*从来没有*从大学开始就创建了我自己的哈希算法。但是，如果我确实创建了自己的算法，那么最大程度地减少碰撞应该是最需要考虑的事情。你可能的价值观是什么？这个函数是否准确地分散了这些值，以便希望结果值和原始值之间存在一对一的关系。结果值是否真的分散得很好。意思是说，他们不都有共同的因素？当您执行模运算以使值更小并适合您的索引集合时，这可能会导致冲突。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T05:18:30.080

发明散列算法很容易。发明一种*有效*的、*有效*的、*有效*的散列算法并非如此。

你应该问自己：

1.  我需要一个哈希吗？
2.  假设我确实实现了一个标准的食谱食谱（例如 Effective Java），包括*所有*相关要求（例如，如果 a.equals(b) 则 a.hashCode() == b.hashCode()）

如果您有两个需要比较是否相等的对象实例，那么您可能需要提供 equals() 的实现。

如果您有多个需要排序的对象实例，那么您可能需要提供 compareTo() 的实现。

如果您有一个自定义对象用作 Map 的键，那么您可能需要提供 hashCode() 的实现。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-12-27T10:29:35.487

不完全是我的经验，但您必须考虑的一些条件：

1.  最重要的是哈希函数应该类似于相等检查。两个相等的对象应该总是返回相同的散列（两个不相等的对象可以返回相同的散列，但这应该很少见）。

2.  最好选择现有的散列函数，因为它们很可能在速度和分布之间有更好的平衡。

3.  散列函数应该很快。如果生成的哈希不会产生更好的值分布，请不要让它变得更慢/更复杂。*所以数字类型的哈希总是更好*（同意大多数框架都有整数类型的哈希，只是说）。

4.  哈希应该具有良好的分布，碰撞的机会必须非常少。因此，XOR 是一个糟糕的选择。*换句话说，在速度和分布之间找到一个良好的平衡是关键*。如果分布更好，哈希值可能会变慢。

5.  编写函数，了解您的输出大小。如果是，`int32`则确保不会发生溢出。

6.  散列函数永远不应该给出错误（除了有效的空引用）。罪魁祸首将是整数溢出。处理它。

7.  如果您在运行时本身之前就知道您可能的输入是什么，那么就有一个函数来定位它以加快速度。

8.  很可能散列不需要是可逆的，但如果你需要它（比如从给定的散列中取回两个数字），请相应地编写它。在一般情况下（哈希冲突），这可能不是必需的。

9.  如果您的散列仅用于快速比较两个对象，请不要将其用于安全目的。*[加密哈希](http://en.wikipedia.org/wiki/Cryptographic_hash_function)是完全不同的野兽。*

10.  如果您手头有多个散列函数，请运行快速测试以找出哪个更适合您的输入。测试总是比理论上的分析要好。

这些都是我想不到的。另请参阅[Eric 的博客](http://blogs.msdn.com/b/ericlippert/archive/2011/02/28/guidelines-and-rules-for-gethashcode.aspx)。

# c - 这个程序的输出是什么，它返回给操作系统的是什么？

> ID：279837
> 
> 赞同：2
> 
> 时间：2008-11-11T02:29:42.430
> 
> 标签：c, puzzle

这是一个 C 谜题。你必须知道程序是否完成了它的执行，如果是，运行需要多少时间以及它返回给操作系统的内容。

```
static unsigned char buffer[256];

int main(void)
{
  unsigned char *p, *q;
  q = (p = buffer) + sizeof(buffer);
  while (q - p)
  {     
      p = buffer;
      while (!++*p++);
  }
  return p - q;
} 
```

[编辑] 我删除了 interview-questions 标签，因为这似乎是人们反对的主要内容。这是一个很好的小难题，但正如每个人都已经指出的那样，这不是一个很好的面试问题。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-11T03:50:16.433

尽管这是一个可怕的面试问题，但实际上很有趣：

```
static unsigned char buffer[256];

int main(void)
{
  unsigned char *p, *q;
  q = (p = buffer) + sizeof(buffer);
  /* This statement will set p to point to the beginning of buffer and will
     set q to point to one past the last element of buffer (this is legal) */
  while (q - p)
  /* q - p will start out being 256 and will decrease at an inversely 
     exponential rate: */
  {     
      p = buffer;
      while (!++*p++);
      /* This is where the interesting part comes in; the prefix increment,
         dereference, and logical negation operators all have the same
         precedence and are evaluated **right-to-left**.  The postfix
         operator has a higher precedence.  *p starts out at zero, is
         incremented to 1 by the prefix, and is negated by !.
         p is incremented by the postfix operator, the condition
         evaluates to false and the loop terminates with buffer[0] = 1.

         p is then set to point to buffer[0] again and the loop continues 
         until buffer[0] = 255\.  This time, the loop succeeds when *p is
         incremented, becomes 0 and is negated.  This causes the loop to
         run again immediately after p is incremented to point to buffer[1],
         which is increased to 1\.  The value 1 is of course negated,
         p is incremented which doesn't matter because the loop terminates
         and p is reset to point to buffer[0] again.

         This process will continue to increment buffer[0] every time,
         increasing buffer[1] every 256 runs.  After 256*255 runs,
         buffer[0] and buffer[1] will both be 255, the loop will succeed
         *twice* and buffer[2] will be incremented once, etc.

         The loop will terminate after about 256^256 runs when all the values
         in the buffer array are 255 allowing p to be incremented to the end
         of the array.  This will happen sometime after the universe ends,
         maybe a little sooner on the new Intels ;)
      */
  }
  return p - q;
  /* Returns 0 as p == q now */
} 
```

本质上，这是一个 256 位的 base-256（假设为 8 位字节）计数器，当整个计数器“翻转”时，程序将退出。

这很有趣的原因是因为代码实际上是完全合法的 C（没有您通常在这些类型的问题中发现的未定义或实现定义的行为）并且实际上存在合法的算法问题，尽管有点隐藏，在混合中。这是一个可怕的面试问题的原因是因为我不希望任何人记住 while 语句中涉及的运算符的优先级和关联性。但它确实是一个有趣和有见地的小练习。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-11T02:41:32.127

此代码是垃圾，请参阅评论

```
static unsigned char buffer[256];
int main(void)
{
  unsigned char *p, *q;
  q = (p = buffer) + sizeof(buffer);    //p=buffer, q=buffer+256
  while (q - p)    //q-p = 256 on first iteration
  {     
      p = buffer;        //p=buffer again
      while (!++*p++);   //increment the value pointed at by p+1 and check for !0
  }
  return p - q;    //will return zero if loop ever terminates
} 
```

它可能会终止，也可能不会；while 循环本质上是在扫描未初始化的缓冲区，因此它可能会引发访问冲突；我不记得 ++*p++ 的绑定优先级，我也不太在意去查找它

如果这真的是一个面试问题，我的回答是“如果这是你希望我使用的那种代码，我不想要这份工作”

编辑：感谢 Robert Gamble 提醒我静态数组会自动初始化为零，因此代码不是完全垃圾 - 但我仍然不想维护它或使用编写它的 nutjob ;-)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T03:50:41.270

这个问题的正确答案是：

> 此代码不可维护、不可测试、无用，应删除或重​​写。

其他任何事情都意味着受访者没有像软件工程师一样思考。

再说一次，你可能不是在面试工程职位。

* * *

## 回答 #4

> 赞同：-6
> 
> 时间：2008-11-11T04:44:00.227

```
unsigned char *p, *q; 
```

这不是在很多层面上都磨损了吗？首先，有没有 unsigned char 这样的东西？其次，我在这里可能错了，所以不要引用我的话，但是 char *p, *q 不会产生时髦的结果吗？要么就是这样，要么它可以很容易地做 char* p, q，这将是不好的形式。

以下要好得多：

```
char* p;
char* q; 
```

# c++ - 如何根据对的第二个元素对对的向量进行排序？

> ID：279854
> 
> 赞同：143
> 
> 时间：2008-11-11T02:41:23.187
> 
> 标签：c++, stl, stdvector

如果我有一对向量：

```
std::vector<std::pair<int, int> > vec; 
```

有没有简单的方法根据对的第二个元素按**升序对列表进行排序？**

我知道我可以编写一个小函数对象来完成这项工作，但是有没有办法使用*STL*的现有部分并`std::less`直接完成这项工作？

编辑：我知道我可以编写一个单独的函数或类来传递给第三个参数进行排序。问题是我是否可以用标准的东西来构建它。我真的会看起来像：

```
std::sort(vec.begin(), vec.end(), std::something_magic<int, int, std::less>()); 
```

* * *

## 回答 #1

> 赞同：236
> 
> 时间：2008-11-11T02:56:21.957

**编辑**：使用 c++14，最好的解决方案很容易编写，这要归功于现在可以具有 type 参数的 lambdas `auto`。**这是我目前最喜欢的解决方案**

```
std::sort(v.begin(), v.end(), [](auto &left, auto &right) {
    return left.second < right.second;
}); 
```

* * *

**原始答案**：

只需使用自定义比较器（它是可选的第三个参数`std::sort`）

```
struct sort_pred {
    bool operator()(const std::pair<int,int> &left, const std::pair<int,int> &right) {
        return left.second < right.second;
    }
};

std::sort(v.begin(), v.end(), sort_pred()); 
```

如果您使用的是 C++11 编译器，则可以使用 lambdas 编写相同的代码：

```
std::sort(v.begin(), v.end(), [](const std::pair<int,int> &left, const std::pair<int,int> &right) {
    return left.second < right.second;
}); 
```

**编辑**：针对您对问题的编辑，这里有一些想法......如果您**真的**想有创意并且能够大量重用这个概念，只需制作一个模板：

```
template <class T1, class T2, class Pred = std::less<T2> >
struct sort_pair_second {
    bool operator()(const std::pair<T1,T2>&left, const std::pair<T1,T2>&right) {
        Pred p;
        return p(left.second, right.second);
    }
}; 
```

那么你也可以这样做：

```
std::sort(v.begin(), v.end(), sort_pair_second<int, int>()); 
```

甚至

```
std::sort(v.begin(), v.end(), sort_pair_second<int, int, std::greater<int> >()); 
```

虽然说实话，这有点矫枉过正，只需编写 3 行函数并完成它：-P

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-11-11T06:02:04.313

您可以像这样使用提升：

```
std::sort(a.begin(), a.end(), 
          boost::bind(&std::pair<int, int>::second, _1) <
          boost::bind(&std::pair<int, int>::second, _2)); 
```

我不知道一个标准的方法来做到这一点同样简短，但你可以抓住`boost::bind`它全部由标题组成。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2015-11-11T11:20:26.710

它非常简单，您可以使用算法中的排序功能并添加您自己的比较功能

```
vector< pair<int,int > > v;
sort(v.begin(),v.end(),myComparison); 
```

现在您必须根据第二个选择进行比较，因此将“myComparison”声明为

```
bool myComparison(const pair<int,int> &a,const pair<int,int> &b)
{
       return a.second<b.second;
} 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2011-11-03T21:42:56.200

使用 C++0x，我们可以使用 lambda 函数：

```
using namespace std;
vector<pair<int, int>> v;
        .
        .
sort(v.begin(), v.end(),
     [](const pair<int, int>& lhs, const pair<int, int>& rhs) {
             return lhs.second < rhs.second; } ); 
```

在此示例中，返回类型`bool`是隐式推导的。

**Lambda 返回类型**

当 lambda 函数只有一条语句并且这是一个返回语句时，编译器可以推断返回类型。从 C++11，§5.1.2/4：

> ...
> 
> *   如果复合语句是`{ return expression ; }`左值到右值转换（4.1）、数组到指针转换（4.2）和函数到指针转换（4.3）后返回表达式的类型；
> *   否则，`void`。

要显式指定返回类型，请使用表单`[]() -> Type { }`，例如：

```
sort(v.begin(), v.end(),
     [](const pair<int, int>& lhs, const pair<int, int>& rhs) -> bool {
             if (lhs.second == 0)
                 return true;
             return lhs.second < rhs.second; } ); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-11T11:33:34.783

对于可重用的东西：

```
template<template <typename> class P = std::less >
struct compare_pair_second {
    template<class T1, class T2> bool operator()(const std::pair<T1, T2>& left, const std::pair<T1, T2>& right) {
        return P<T2>()(left.second, right.second);
    }
}; 
```

您可以将其用作

```
std::sort(foo.begin(), foo.end(), compare_pair_second<>()); 
```

或者

```
std::sort(foo.begin(), foo.end(), compare_pair_second<std::less>()); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T02:48:19.943

您必须依赖非标准的[select2nd](http://www.sgi.com/tech/stl/select2nd.html)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2017-01-12T07:58:48.250

尝试交换对的元素，以便您可以`std::sort()`正常使用。

# c++ - 如何让项目将其构建输出与 Scons 放在同一目录中？

> ID：279860
> 
> 赞同：15
> 
> 时间：2008-11-11T02:47:13.503
> 
> 标签：c++, build, scons

## 背景

我正在通过设置一个包含两个子项目的基本 C++ 示例项目来尝试 Scons：

*   Prj1 是一个依赖于 Prj2 的 EXE
*   Prj2 是一个导出一些函数的DLL

我遇到的问题是该库将其 .obj、.pdb、.lib、.dll 等文件构建在与其 SConscript 文件相同的目录中，而 EXE 将其文件构建在与其 SConscript 相同的目录中。应用程序成功地构建了 Prj2 依赖项和自身。但是，您无法运行生成的 EXE，因为它找不到所需的库，因为它位于其他目录中。

## 问题

如何让多个项目具有依赖关系，将其二进制文件和调试信息输出到一个公共目录中，以便它们可以被执行和调试？

## 潜在的解决方案

这是我到目前为止所想到的：

*   我尝试使用 VariantDir（以前称为 BuildDir），但这似乎不起作用。也许我在这里搞砸了。
*   我可能会明确地告诉编译器和链接器（例如通过 Fo/Fd）将文件放在哪里（这是最好的还是唯一的解决方案？？？）
*   对生成的二进制文件执行复制命令（这似乎是一种 hack，管理/维护相当痛苦）

## 更新

我更新了下面的文件结构和文件内容，以完整地反映工作解决方案。感谢悲伤的洞察力。

## 命令

使用此配置，不幸的是，您必须通过 cd'ing 到构建目录然后运行以下命令来执行构建。我需要获得一个正常工作的别名设置来解决这个问题。

```
 build> scons ../bin/project1.exe 
```

## 文件结构

```
 /scons-sample
       /bin
          /release
          /debug
       /build
           SConstruct
           scons_helper.py
       /prj1
           SConscript
           /include
           /src
              main.cpp
       /prj2
          SConscript
          /include
             functions.h
          /src
             functions.cpp 
```

## SConstruct

```
 import os.path

BIN_DIR = '../bin'
OBJ_DIR = './obj'

#--------------------------------------
#            CxxTest Options
#--------------------------------------
CXXTEST_DIR = '../extern/CxxTest/CxxTest-latest'
PERL = 'perl -w'
TESTS = '*.h'
TESTGEN = PERL + CXXTEST_DIR + '/cxxtestgen.pl'
CXXTESTGEN_FLAGS = '--runner=ParenPrinter \
                    --abort-on-fail \
                    --have-eh'

#--------------------------------------
#            Options
#--------------------------------------
SetOption( 'implicit_cache', 1 )

# command line options
opts = Options()
opts.AddOptions(
EnumOption(
            'debug',
            'Debug version (useful for developers only)',
            'no',
            allowed_values = ('yes', 'no'),
            map = { },
            ignorecase = 1
        )
)

#--------------------------------------
#           Environment
#--------------------------------------
env = Environment( 

    options = opts,

    #--------------------------------------
    #           Linker Options
    #--------------------------------------
    LIBPATH = [
                '../extern/wxWidgets/wxWidgets-latest/lib/vc_dll'
              ],

    LIBS =  [
               # 'wxmsw28d_core.lib',
               # 'wxbase28d.lib',
               # 'wxbase28d_odbc.lib',
               # 'wxbase28d_net.lib',
                'kernel32.lib',
                'user32.lib',
                'gdi32.lib',
                'winspool.lib',
                'comdlg32.lib',
                'advapi32.lib',
                'shell32.lib',
                'ole32.lib',
                'oleaut32.lib',
                'uuid.lib',
                'odbc32.lib',
                'odbccp32.lib'
            ],

    LINKFLAGS = '/nologo /subsystem:console /incremental:yes /debug /machine:I386',

    #--------------------------------------
    #           Compiler Options
    #--------------------------------------
    CPPPATH = [
                './include/', 
                '../extern/wxWidgets/wxWidgets-latest/include',
                '../extern/wxWidgets/wxWidgets-latest/vc_dll/mswd'
               ],

    CPPDEFINES = [ 
                    'WIN32',
                    '_DEBUG',
                    '_CONSOLE',
                    '_MBCS',
                    'WXUSINGDLL',
                    '__WXDEBUG__'
                 ],

    CCFLAGS = '/W4 /EHsc /RTC1 /MDd /nologo /Zi /TP /errorReport:prompt'
)

env.Decider( 'MD5-timestamp' )        # For speed, use timestamps for change, followed by MD5
Export( 'env', 'BIN_DIR' )          # Export this environment for use by the SConscript files

#--------------------------------------
#           Builders
#--------------------------------------
SConscript( '../prj1/SConscript' )
SConscript( '../prj2/SConscript' )
Default( 'prj1' ) 
```

## scons_helper.py

```
 import os.path

#--------------------------------------
#            Functions
#--------------------------------------

# Prepends the full path information to the output directory so that the build
# files are dropped into the directory specified by trgt rather than in the 
# same directory as the SConscript file.
# 
# Parameters:
#   env     - The environment to assign the Program value for
#   outdir  - The relative path to the location you want the Program binary to be placed
#   trgt    - The target application name (without extension)
#   srcs    - The list of source files
# Ref:
#   Credit grieve and his local SCons guru for this: 
#   http://stackoverflow.com/questions/279860/how-do-i-get-projects-to-place-their-build-output-into-the-same-directory-with
def PrefixProgram(env, outdir, trgt, srcs):
    env.Program(target = os.path.join(outdir, trgt), source = srcs)

# Similar to PrefixProgram above, except for SharedLibrary
def PrefixSharedLibrary(env, outdir, trgt, srcs):
    env.SharedLibrary(target = os.path.join(outdir, trgt), source = srcs)

def PrefixFilename(filename, extensions):
    return [(filename + ext) for ext in extensions]

# Prefix the source files names with the source directory
def PrefixSources(srcdir, srcs):
    return  [os.path.join(srcdir, x) for x in srcs] 
```

## Prj1 征兵

```
 import os.path
import sys
sys.path.append( '../build' )
from scons_helper import *

Import( 'env', 'BIN_DIR' )        # Import the common environment

prj1_env = env.Clone()          # Clone it so we don't make changes to the global one

#--------------------------------------
#           Project Options
#--------------------------------------
PROG = 'project1'

#--------------------------------------
#            Header Files
#--------------------------------------
INC_DIR = [
            '../prj2/include'
          ]

HEADERS = [
            ''
          ]

#--------------------------------------
#            Source Files
#--------------------------------------
SRC_DIR = './src'
SOURCES = [
            'main.cpp'
          ]
# Prefix the source files names with the source directory
SOURCES = PrefixSources( SRC_DIR, SOURCES )

#--------------------------------------
#      Compiler and Linker Overrides
#--------------------------------------
prj1_env.Append(
    CPPPATH = INC_DIR,
    LIBS = 'project2',
    LIBPATH = BIN_DIR,

    # Microsoft Visual Studio Specific
    PDB = os.path.join( BIN_DIR, PROG + '.pdb' )
)

#--------------------------------------
#            Builders
#--------------------------------------
PrefixProgram( prj1_env, BIN_DIR, PROG, SOURCES ) 
```

## SConscript Prj2

```
 import os.path   
import sys
sys.path.append( '../build' )
from scons_helper import *

Import( 'env', 'BIN_DIR' )        # Import the common environment

prj2_env = env.Clone()          # Clone it so we don't make changes to the global one

#--------------------------------------
#           Project Options
#--------------------------------------
PROG = 'project2'

#--------------------------------------
#            Header Files
#--------------------------------------
INC_DIR = [
             ''
          ]
HEADERS = [
            'functions.h'
          ]

#--------------------------------------
#            Source Files
#--------------------------------------
SRC_DIR = './src/'
SOURCES = [
            'functions.cpp'
          ]
# Prefix the source files names with the source directory
SOURCES = PrefixSources( SRC_DIR, SOURCES )

#--------------------------------------
#      Compiler and Linker Overrides
#--------------------------------------
# Update the environment with the project specific information
prj2_env.Append(
    CPPPATH = INC_DIR,

    # Microsoft Visual Studio Specific
    PDB = os.path.join( BIN_DIR, PROG + '.pdb' )
)

#--------------------------------------
#               Builders
#--------------------------------------
PrefixSharedLibrary( prj2_env, BIN_DIR, PROG, SOURCES ) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T14:54:45.797

好的第三次尝试是一种魅力。我只是把它放在一个新的答案中，以保持它更干净。我和我当地的 scons 大师谈过，他说安装方法应该可以工作，但是有一个更简单的方法。

只需定义您希望可执行文件（或 dll）所在的完整路径。所以：

```
prj2_env.Program(target = os.path.join(BIN_DIR,PROG), source = SOURCES ) 
```

如果您不想在所有地方都这样做，您可以创建一个全局函数：

```
def PrefixProgram(env, trgt, srcs):
    env.Program(target = os.path.join(env.["MY_OUTPUT_DIR"], trgt), source = srcs) 
```

然后在你的 SConscript 中，类似：

```
import ('PrefixProgram')
# stuff ...
PrefixProgram(prj2_env, PROG, SOURCES) 
```

请注意，您可以将自己的属性添加到环境中，这是

```
env["MY_OUTPUT_DIR"] 
```

来自。我即兴写了这个，所以期待一些小的语法错误，什么不是。显然，您可以对共享库和静态库应用相同的技巧。

为了全面披露，我让我当地的 scons 大师有机会亲自回答这个问题，但他害怕自己会沉迷于该网站并拒绝了。:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T02:58:19.097

VariantDir 是执行此操作的方法。您的 Sconstruct 如何调用您的 Sconscript 文件？您是否还阅读了文档的这一部分：[http](http://www.scons.org/doc/1.1.0/HTML/scons-user/c3271.html) ://www.scons.org/doc/1.1.0/HTML/scons-user/c3271.html （我假设您有）。

* * *

我想得越多，我就越想使用[Default](http://www.scons.org/doc/1.1.0/HTML/scons-user/x2720.html#AEN2739)和[Install的组合](http://www.scons.org/doc/1.1.0/HTML/scons-user/c2848.html)

在您的 SConscripts 通话中

```
env.Install("../bin", <your target exe or dll>) 
```

然后在你的 Sconstruct 电话中

```
env.Alias('install', "../bin")
Default('install') 
```

这应该可以解决问题，我认为这些链接清楚地表明了它们是如何协同工作的。

# visual-studio - 在 Visual Studio 中查看多个文件

> ID：279861
> 
> 赞同：26
> 
> 时间：2008-11-11T02:47:22.270
> 
> 标签：visual-studio, interface

我刚刚意识到 Office 2007 现在默认显示多个页面。我终于可以利用我买的那台巨大的显示器了。

Visual Studio 是否有类似的功能？

类似“查看->两页”的东西

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-11-11T02:50:00.847

您可以使用“选项卡组”。Visual Studio 支持水平和垂直窗格（我相信至少从 Visual Studio .NET 2002 开始，我已经很久没有使用过 VS 5 或 6 了..）

有几种方法可以创建选项卡组。一种方法是：

*   打开两个文件。
*   抓住其中一个文件的标签并将其向下拉并稍微拉到一边
*   如果要将其放在新的水平或垂直窗格中，您将获得一个提示您的菜单。
*   您可以在窗格之间移动文件，方法是抓住打开文件的选项卡并将其拉到您想要的窗格中的选项卡旁边。

另一种方法是：

*   点击窗口
*   单击新建垂直选项卡组

[这](http://www.kevinwilliampang.com/post/Visual-Studio-Split-Views.aspx)是一个用图片展示这一点的网站，它甚至包括向您展示如何使用**同一**文件拆分窗格。重构时很方便！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T02:51:56.990

试试这个：
单击窗口-> 新建垂直选项卡组

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T02:53:35.083

使用 Window->New Vertical Tab Group (Visual Studio 2005)

# css - 您是否正在为 iPhone 网络应用程序编写自定义页面？

> ID：279895
> 
> 赞同：1
> 
> 时间：2008-11-11T03:04:18.430
> 
> 标签：css, web-applications, mobile, iphone, mobile-safari

我阅读了 Web 应用程序的教程以及可以放入样式表的特殊规则。人们是否发现他们可以调整样式表以向 iPhone 提供内容，或者他们是否提供定制的 iPhone 特定页面？如果您要为移动用户创建一个特定页面，您会为此烦恼吗？（即使仅针对 iPhone/智能手机用户）

任何意见，将不胜感激

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T11:40:31.307

您确实可以捕获传入的请求，找出它是 iPhone/SmartPhone/Mobile 设备，并相应地提供其他 CSS 文件。

我不会在 CSS 文件中定义额外的移动特定规则/选择器，而是提供另一个，修剪并准备好的 CSS 文件。

但这只会改变您的 HTML 外观，而不是您为客户端提供的内容，在本例中是移动设备。

大多数情况下，我们也提供其他 HTML，因为您必须考虑带宽。我们向移动设备提供“更少”的 HTML，即原始页面的精简版。

看看 Twitter 为移动设备做了什么：http: [//m.twitter.com/login](http://m.twitter.com/login) 它们不仅提供另一种外观，它们还提供其他 HTML 和较少的功能（或一个页面上的较少功能）。

# arrays - 当数组不超过 50 个元素时，在 PostgreSql 中使用表而不是数组字段类型会更好吗？

> ID：279902
> 
> 赞同：31
> 
> 时间：2008-11-11T03:09:33.647
> 
> 标签：arrays, postgresql

或者更好的说法是：何时使用数组作为表中的字段数据类型？

哪种解决方案提供更好的搜索结果？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-11T10:53:15.957

我避免使用数组有两个原因：

*   通过在一个单元格中存储多个属性值，您违反了第一范式（理论上）；
*   每次您需要处理数组的单个元素时，您都必须执行一些额外的、非 SQL 相关的处理（实际操作，但这是理论操作的直接结果）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-11T04:00:33.467

我也考虑过这个问题，我得出的结论是，当你想消除表连接时使用数组。每个数组中包含的元素数量并不像所涉及的表的大小那么重要。如果每个表只有几千行，那么加入得到 50 个子行应该不是什么大问题。如果您进入 10 或 100 的数千或行，您可能会开始咀嚼大量的处理器时间和磁盘 i/o。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2019-12-29T00:57:14.173

不知道这些链接会持续多久，所以我将结果粘贴在下面： [http ://sqlfiddle.com/#!17/55761/2](http://sqlfiddle.com/#!17/55761/2)

TLDR；搜索表索引然后加入很快，但是将 GIN 索引（使用 gin__int_ops）添加到具有数组列的单个表中会更快。此外，能够匹配“一些”或少量数组值的灵活性可能是更好的选择，例如标记系统。

```
create table data (
    id serial primary key,
    tags int[],
    data jsonb
);

create table tags (
    id serial primary key,
    data_id int references data(id)
);

CREATE INDEX gin_tags ON data USING GIN(tags gin__int_ops); 

SET enable_seqscan to off;

with rand as (SELECT generate_series(1,100000) AS id)
insert into data (tags) select '{5}' from rand;

update data set tags = '{1}' where id = 47300;

with rand as (SELECT generate_series(1,100000) AS id)
INSERT INTO tags(data_id) select id from rand; 
```

跑步：

```
 select data.id, data.data, data.tags
  from data, tags where tags.data_id = data.id and tags.id = 47300; 
```

和

```
 select data.id, data.data, data.tags
  from data where data.tags && '{1}'; 
```

产量：

```
Record Count: 1; Execution Time: 3ms
QUERY PLAN
Nested Loop (cost=0.58..16.63 rows=1 width=61)
-> Index Scan using tags_pkey on tags (cost=0.29..8.31 rows=1 width=4)
Index Cond: (id = 47300)
-> Index Scan using data_pkey on data (cost=0.29..8.31 rows=1 width=61)
Index Cond: (id = tags.data_id) 
```

和

```
Record Count: 1; Execution Time: 1ms
QUERY PLAN
Bitmap Heap Scan on data (cost=15.88..718.31 rows=500 width=61)
Recheck Cond: (tags && '{1}'::integer[])
-> Bitmap Index Scan on gin_tags (cost=0.00..15.75 rows=500 width=0)
Index Cond: (tags && '{1}'::integer[]) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-05-13T09:08:22.943

我认为数组必须用于一些自定义数据。但是对于外键 - 最好使用链接表（或除每个键列之外的其他东西）。通过这种方式，您可以在数据库级别进行数据控制并轻松查询连接 - 即使您将它们放在数组中（对于完整数据集），您也需要连接 - 但数组比“标准”SQL 复杂得多。PS对不起英语不好

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T04:00:51.310

假设您在实际数组中查询某些内容，这些表将始终提供更好的搜索结果。使用子表，您可以轻松地索引内容，而使用数组，您必须创建 50 个索引（一个用于数组中的每个潜在元素）。

# crystal-reports - Crystal 报表中的复选框

> ID：279907
> 
> 赞同：0
> 
> 时间：2008-11-11T03:13:04.950
> 
> 标签：crystal-reports

在 Crystal Report 中显示复选框的最佳方式是什么？

示例：我的报告有一个“男性”和“女性”框，应该选中一个。

我目前的解决方法是绘制一个小的图形方块，然后将其与如下公式对齐：

```
if {table.gender} = "M" then "X" else "  " 
```

这是一个糟糕的解决方案，因为更改字体会使我的“X”和它周围的框不对齐，并且斜视屏幕并为每个框（有几十个）获得像素完美对齐是荒谬的乏味。

有没有人有更好的解决方案？我曾考虑过使用旧式终端字符，但我不确定它们是否在 Crystal 中正确显示。

*编辑：我正在使用 Crystal XI。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-05-23T08:06:33.580

```
If {Table.Field} = True Then

'Display the checkbox of your choice here

Formula = Chr(254)

Else

'Display empty checkbox

Formula = Chr(168)

End If 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T16:03:02.993

图像的替代方法是使用 Wingdings 字体；字符`0xFE`（选中）和 `0xA8`（未选中）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-01-30T06:19:58.850

我需要在这里提到哪个字体需要在这里选择“Wingdings”

```
If {Table.Field} = True Then

'Display the checkbox of your choice here

Formula = Chr(254)

Else

'Display empty checkbox

Formula = Chr(168)

End If 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T03:29:14.463

尝试一对带有条件公式的图像以获得可见性

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-26T21:59:09.423

我从不使用框...我总是使用带有完整边框、居中对齐和粗体的文本字段对象。在里面输入一个 X 来调整它的大小。擦除“X”。根据需要复制/粘贴。

然后我创建所有返回“X”或“”的公式（空格很重要，否则边框将不会显示在文本对象上）。然后只需将公式字段放入正确的框中。

此外，如果要对齐这些带边框的文本对象，则需要在对齐之前移除边框。那个bug真的让我很烦！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T03:29:57.410

2 张图片
1 - 空框
2 - 选中框

用公式显示正确的图片

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-10-13T18:56:42.927

1.  创建一个公式字段并使用以下公式

if {Your Field} = true then Chr(254) else Chr(168)

2.  将公式字段添加到您希望复选框出现的报告中。

3.  现在将公式字段的字体更改为 Wingdings。

# python - PyOpenGl 还是 pyglet？

> ID：279912
> 
> 赞同：25
> 
> 时间：2008-11-11T03:17:03.117
> 
> 标签：python, pyglet, pyopengl

我希望对 openGL 和 Python 进行一些修改，但找不到使用 PyOpenGl 与 pyglet 的充分理由

你会推荐哪个，为什么？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-11T04:03:04.397

正如托尼所说，这真的取决于你的目标。如果您正在“修补”以尝试学习 OpenGL 或一般的 3D 渲染，那么我将免除所有的寒暄并开始使用 PyOpenGL，这与您将使用 Python 进行“原始”3D 编程一样接近.

另一方面，如果您通过模拟游戏或多媒体应用程序来“修补”，或者尝试学习一般的编程实践，那么 Pyglet 将通过为输入事件提供挂钩来为您节省大量前期开发时间，声音，文字/广告牌等。通常，这种前期投资会阻止人们完成他们的项目，因此为您完成它是不容忽视的事情。（避免重新发明轮子也是非常 Pythonic 的。）

如果您正在寻找进行任何类型的重型提升（通常不属于我对“修补”的定义，但如果您正在修补 3D 引擎设计，则可能不会）那么您可能想看看 Python-Ogre ，它封装了功能*非常*全面且强大的[OGRE 3D](http://www.ogre3d.org/)图形引擎。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2010-11-22T14:21:04.330

从 pyglet 开始。它包含最好的高级 API，它包含您开始使用的所有内容，从打开窗口到使用其友好且强大的 Sprite 和 Batch 类绘制精灵和 OpenGL 基元。

稍后，您可能还想编写自己的低级代码，直接调用 OpenGL 函数，例如 glDrawArrays 等。您可以使用 pyglet 的 OpenGL 绑定或使用 PyOpenGL 的来完成此操作。好消息是，无论您使用哪种方法，您都可以将此类调用直接插入现有 pyglet 应用程序的中间，它们将“正常工作”。将您的代码从 Pyglet 转换到 PyOpenGL 相当容易，所以这不是您需要预先担心太多的决定。两者之间的权衡是：

PyOpenGL 的绑定使 OpenGL 界面更加友好和 Pythonic。例如，您可以传递许多不同形式的顶点数组、ctypes 数组、numpy 数组、普通列表等，PyOpenGL 会将它们转换为 OpenGL 可以使用的东西。像这样的事情使 PyOpenGL 变得非常简单和方便。

pyglet 的 OpenGL 绑定是自动生成的，使用起来不如 PyOpenGL 友好。例如，有时您必须手动创建 ctypes 对象，以便将“C 指针”类型的参数传递给 OpenGL。这可能很繁琐。不过，好的一面是 pyglet 的绑定往往要快得多。

这意味着有一个最佳的中间地带：使用 pyglet 进行窗口、鼠标事件、声音等。然后在您想要直接调用 OpenGL 函数时使用 PyOpenGL 的友好 API。然后在优化时，仅用 pyglet 等效项替换位于内部渲染循环中的一小部分性能关键的 PyOpenGL 调用。对我来说，这使我的帧速率提高了 2 到 4 倍，而 PyOpenGL 对我 90% 的代码都很方便。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2016-07-06T18:31:05.610

试试[ModernGL](https://github.com/cprogrammer1994/ModernGL)。

```
pip install ModernGL 
```

*   **PyOpenGL**是原始 OpenGL API（使用 SWIG 生成）的自动生成版本。原始的 OpenGL API 对 python 不友好。生成的 python 绑定很难使用。

*   **pyglet**主要用于窗口创建和事件处理，但是您可以使用 PyOpenGL 之类的 API（例如`pyglet.gl.glClearColor`）

*   **pygame**提供了一个窗口，您可以在其中使用 PyOpenGL 进行渲染。

*   **ModernGL**是 PyOpenGL 的绝佳替代品，您可以使用现代 OpenGL API 编写更少的代码。ModernGL 不会自己创建窗口，但您可以将其集成到[pyglet](https://github.com/cprogrammer1994/ModernGL/blob/master/examples/pyglet/01_hello_world.py)、[pygame](https://github.com/cprogrammer1994/ModernGL/blob/master/examples/pygame/01_hello_world.py)、[PyQt5](https://github.com/cprogrammer1994/ModernGL/blob/master/examples/PyQt5/01_hello_world.py)甚至[GLUT](https://github.com/cprogrammer1994/ModernGL/blob/master/examples/PyOpenGL/01_hello_world.py)中。**编辑**您现在可以使用moderngl-window 独立创建窗口。 `pip install moderngl-window`

在 ModernGL 中，您可以通过一次调用创建一个简单的着色器程序：

```
prog = ctx.program(
    vertex_shader='''
        #version 330
        in vec2 in_vert;
        void main() {
            gl_Position = vec4(in_vert, 0.0, 1.0);
        }
    ''',
    fragment_shader='''
        #version 330
        out vec4 f_color;
        void main() {
            f_color = vec4(0.3, 0.5, 1.0, 1.0);
        }
    ''',
) 
```

使用 ModernGL，您可以完全控制 OpenGL API。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-03T12:25:09.487

我会说 Pyglet 实际上比 PyOpenGL 更进化。它有一个很好的自己的 API，它有一个完整的 OpenGL 包装器，可以通过 pyglet.gl 模块访问！PyOpenGL 甚至没有包装 OpenGL 的所有功能。Pyglet 还有一个很棒的库，用于通过 OpenGL 进行硬件加速来渲染 2D，而且它的制作非常好。

如果你想要一个强大的现成 3D 引擎，你有[Ogre](http://www.ogre3d.org/)之类的

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-11T03:38:00.093

pyglet 包含许多不错的附加功能（例如图像加载和声音）。如果您刚开始，我会先尝试 pyglet，然后如果您想更接近金属，则切换到 PyOpenGL。

但真正重要的问题是：你想要完成什么？

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-11T16:30:11.843

我推广 pyglet 是因为它有我在类似的东西上见过的最好的 API。

Pyglet 也有 opengl API。但是使用最近添加的顶点列表支持通常会更好。

pyglet.gl

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-03-07T11:17:49.600

pyglet 的 GL API 远不如 PyOpenGL 的好——pyglet 位于原始 ctypes 层，这意味着您还需要学习 ctypes。如果你打算做一堆 OpenGL 编程，你会想要使用 PyOpenGL。

好的是你可以把两者混合得很好。使用 pyglet 提供 GL 上下文、声音、事件、图像加载和纹理管理、文本渲染等。使用 PyOpenGL 进行实际的 OpenGL 编程。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-12-08T20:30:29.070

嗯，我建议使用 pyglet，它确实提供了游戏或应用程序所需的一切。

请注意，你可以用 PyOpenGL 做很多 pyglet 所做的事情，例如创建一个窗口，你需要做的就是：
glutInitWindow(title)

虽然我认为 glutInitDisplayMode 必须在此之前调用。

简单总结：如果你哭到不想写代码，就选pyglet，但如果你想当高手，就选PyOpenGL。转到[http://pyopengl.sourceforge.net](http://pyopengl.sourceforge.net)阅读 PyOpenGL 上的文档，并转到[http://pyglet.org](http://pyglet.org)阅读 pyglet 上的文档。希望这有帮助！

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-29T02:52:47.673

我会推荐 Pyglet，因为它很容易上手并运行一些基本的东西，然后你可以按照自己的节奏添加更高级的技术。

# php - 通过 PHP 格式化 Excel 文件中的文本

> ID：279917
> 
> 赞同：5
> 
> 时间：2008-11-11T03:20:45.713
> 
> 标签：php, export-to-excel

我正在从我的数据库中加载数据，并通过我在此站点上找到的方法导出到 Excel 文件：http: [//www.appservnetwork.com/modules.php?name= News&file=article&sid=8](http://www.appservnetwork.com/modules.php?name=News&file=article&sid=8)

它可以工作，但我现在要做的是在导出之前格式化文本 - 更改字体和文本大小。有人对如何做到这一点有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T03:26:29.853

我使用这些[`PEAR :: Package :: Spreadsheet_Excel_Writer`](http://pear.php.net/package/Spreadsheet_Excel_Writer/)类从 PHP 5 编写了 Excel 电子表格。你可以用这个包做很多事情。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T19:28:47.973

根据您希望部署解决方案的速度，一种方法是仅使用 HTML 表格标记，使用样式标记将所有数据存储在表格中，然后使用 PHP 标头的选项强制浏览器将其保存为 . xls 文件。

为了概念验证，将此代码复制到记事本中，另存为 .xls，然后使用 Excel 打开：

```
<table>
<tr><th>Column 1</th><th>Column 2</th></tr>
<tr><td style="font-size:200%">Answer 1</td><td style="color:#f00">Answer 2</td></tr>
<tr><td colspan="2" style="font-weight:bold">Answer 3 with 2 columns</td></tr>
</table> 
```

它不是最优雅的解决方案，但绝对适合您的需求。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T19:42:29.553

[PHPExcel](https://github.com/PHPOffice/PHPExcel)为您提供了执行此操作以及更多功能的工具。

编辑：此项目现已弃用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T13:44:38.620

我用过[几次 php_writeexcel](http://www.bettina-attack.de/jonny/view.php/projects/php_writeexcel/)，非常喜欢它！:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-23T12:38:06.470

```
<?php
    include '../include/config.php';
    $sql                        =   "SELECT SQL_CALC_FOUND_ROWS
                                    ".DB_TBL_TUTORS_RECAPS.".id,
                                    ".DB_TBL_TUTORS_RECAPS.".date_of_tutoring_session,
                                    ".DB_TBL_TUTORS_RECAPS.".created,
                                    ".DB_TBL_TUTORS_RECAPS.".hours_tutored,
                                    ".DB_TBL_TUTORS_RECAPS.".billable_travel,
                                    ".DB_TBL_TUTORS_RECAPS.".billable_additional,
                                    ".DB_TBL_TUTORS_RECAPS.".type_of_tutoring,
                                    ".DB_TBL_TUTORS_RECAPS.".additional_comments,
                                    ".DB_TBL_TUTORS_RECAPS.".total_billable,
                                    ".DB_TBL_TUTORS_RECAPS.".materials_covered_during_session,
                                    ".DB_TBL_TUTORS_RECAPS.".next_scheduled_session_location,
                                    ".DB_TBL_TUTORS_RECAPS.".rate,
                                    ".DB_TBL_TUTORS_RECAPS.".tutor_pay_rate,
                                    ".DB_TBL_APPLICANTS.".first_name as tutor_first_name,
                                    ".DB_TBL_APPLICANTS.".last_name as tutor_last_name,
                                    ".DB_TBL_PIPELINE.".tutor_match_notes,
                                    ".DB_TBL_PIPELINE.".date_of_submission,
                                    ".DB_TBL_PIPELINE.".tutor_name,
                                    ".DB_TBL_PIPELINE.".tutor_id,
                                    ".DB_TBL_CLIENTS.".id as client_id,
                                    ".DB_TBL_CLIENTS.".first_name,
                                    ".DB_TBL_CLIENTS.".last_name,
                                    ".DB_TBL_CLIENTS.".location_name,
                                    ".DB_TBL_CLIENTS.".last_name,
                                    ".DB_TBL_CHILDREN.".id as child_id,
                                    ".DB_TBL_CHILDREN.".last_name as last,
                                    ".DB_TBL_CHILDREN.".first_name as first
                                FROM 
                                    ".DB_TBL_TUTORS_RECAPS."
                                LEFT JOIN ".DB_TBL_PIPELINE." ON ".DB_TBL_PIPELINE.".id= ".DB_TBL_TUTORS_RECAPS.".pipeline_id
                                LEFT JOIN ".DB_TBL_CHILDREN." ON ".DB_TBL_CHILDREN.".id= ".DB_TBL_TUTORS_RECAPS.".child_id  
                                LEFT JOIN ".DB_TBL_CLIENTS." ON ".DB_TBL_CLIENTS.".id= ".DB_TBL_TUTORS_RECAPS.".client_id   
                                LEFT JOIN ".DB_TBL_TUTORS." ON ".DB_TBL_TUTORS_RECAPS.".tutor_id= ".DB_TBL_TUTORS.".id  
                                LEFT JOIN ".DB_TBL_APPLICANTS." ON ".DB_TBL_APPLICANTS.".id= ".DB_TBL_TUTORS.".applicant_id 
                            WHERE 

                            " . DB_TBL_CLIENTS . ".status = 'Existing' AND

                            " . DB_TBL_APPLICANTS . ".status = 'Existing' AND

                            " . DB_TBL_PIPELINE . ".status = 'Existing' AND                             
                            " . DB_TBL_TUTORS_RECAPS . ".is_deleted = '0'                               
                                GROUP BY " . DB_TBL_TUTORS_RECAPS . ".id
                                ORDER BY " . DB_TBL_TUTORS_RECAPS . ".created DESC ";

    $totallogs      =   $db->query($sql);
    $filename       =   "Tutoring_Log.xls";
    $contents       =   "Recap# \t Tutor Name \t Client Name \t Child Name \t Type of tutoring \t Date of Tutoring session \t Hours tutored \t Billable Travel \t Billable Additional \t Total Billable \t Client Rate \t Tutor Pay Rate \t  \n";
    $contents       .=  "  \n";

    while($tutorRecords = $db->fetchNextObject($totallogs)){

        $contents .= "".$tutorRecords->id." \t ".$tutorRecords->tutor_first_name.' '.$tutorRecords->tutor_last_name." \t ".$tutorRecords->first_name.' '.$tutorRecords->last_name." \t ".$tutorRecords->first.' '.$tutorRecords->last." \t ".$globalsConstant['type_of_tutoring'][$tutorRecords->type_of_tutoring]." \t ".date(MDY,$tutorRecords->date_of_tutoring_session)." \t ".str_replace('.',':',$tutorRecords->hours_tutored)." \t ".str_replace('.',':',$tutorRecords->billable_travel)." \t ".str_replace('.',':',$tutorRecords->billable_additional)." \t ".str_replace('.',':',$tutorRecords->total_billable)." \t ".CURRENCY.$tutorRecords->rate." \t  ".CURRENCY.$tutorRecords->tutor_pay_rate."  \t \n";

    }

    header('Content-type: application/ms-excel');
    header('Content-Disposition: attachment; filename='.$filename);
    echo $contents;
      ?> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T19:32:55.843

TinyButStrong 模板系统 (www.tinybutstrong.com) 有一个可选插件，可让您写入 excel 模板。

我用过这个很多。它特别简洁，您可以根据标志将页面设置为写入 HTML 或 Excel - 所以通常我的报告提供“在页面上显示”和“写入 excel”选项。

# windows - 如何使用 C 更改 Windows 中文件的最后修改日期？

> ID：279919
> 
> 赞同：1
> 
> 时间：2008-11-11T03:22:41.637
> 
> 标签：windows, winapi, file

是否有可以更改 Windows 中文件或目录的最后修改日期的 C 函数调用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T03:38:07.550

您可以使用[SetFileTime](http://msdn.microsoft.com/en-us/library/ms724933(VS.85).aspx)函数，对于目录，您必须使用带有 FILE_FLAG_BACKUP_SEMANTICS 标志的[CreateFile](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx)函数来获取目录句柄并将其用作 SetFileTime 的文件句柄参数，如下所示：

```
hFolder = CreateFile(path, GENERIC_WRITE, FILE_SHARE_READ, NULL, OPEN_EXISTING,
FILE_ATTRIBUTE_DIRECTORY | FILE_FLAG_BACKUP_SEMANTICS, NULL); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T03:29:45.993

使用 SetFileTime：

```
BOOL WINAPI SetFileTime(
  __in      HANDLE hFile,
  __in_opt  const FILETIME *lpCreationTime,
  __in_opt  const FILETIME *lpLastAccessTime,
  __in_opt  const FILETIME *lpLastWriteTime
); 
```

它在 winbase.h 中，所以你只需要包含 windows.h

编辑：我粘贴了错误的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T03:29:15.773

是的。您可以使用[SetFileTime](http://msdn.microsoft.com/en-us/library/ms724933.aspx) API 函数。

# python - 在python中设置压缩文件的权限

> ID：279945
> 
> 赞同：8
> 
> 时间：2008-11-11T03:40:17.593
> 
> 标签：python, zip, zipfile

我有一个`test.txt`位于 zip 存档中的文件`test.zip`。压缩后的权限`test.txt`不在我的控制范围内，但现在我希望它们是组可写的。我正在使用 Python 提取文件，并且不想逃到 shell 中。

**编辑：** 这是我到目前为止所得到的：

```
import zipfile

z = zipfile.ZipFile('test.zip', 'w')
zi = zipfile.ZipInfo('test.txt')
zi.external_attr = 0777 << 16L
z.writestr(zi, 'FOO')
z.close()

z = zipfile.ZipFile('test.zip', 'r')
for name in z.namelist():
    newFile = open(name, "wb")
    newFile.write(z.read(name))

    newFile.close()
z.close() 
```

这在使用 2.5.1 的 OS X 上完美运行，但不适用于我的 home box（Debian、Python 2.4 和 2.5）或使用 Python 2.4 的 RHEL 5。除了 OS X 之外，它不会出错，但也不会更改权限。任何想法为什么？另外，如何`writestr()`工作？我知道我在这里使用不正确。

有没有办法做到这一点`os.chmod`（提取文件的用户在提取文件后没有使用权限`os.chmod`）？我对 zip 文件具有完全写入权限。

更多信息：

```
> ls -l test.zip
-rwxrwxrwx 1 myuser mygroup 2008-11-11 13:24 test.zip
> unzip test.zip
Archive:  test.zip
  inflating: test.txt 
> ls -l test.txt
-rw-r--r-- 1 myuser mygroup 2008-11-11 13:34 test.txt 
```

提取的用户不是`myuser`，而是在`mygroup`。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T20:12:53.857

我遇到了类似的问题，所以这是我的东西中的代码spinet，我相信这在这里应该有所帮助。

```
# extract all of the zip
for file in zf.filelist:
    name = file.filename
    perm = ((file.external_attr >> 16L) & 0777)
    if name.endswith('/'):
        outfile = os.path.join(dir, name)
        os.mkdir(outfile, perm)
    else:
        outfile = os.path.join(dir, name)
        fh = os.open(outfile, os.O_CREAT | os.O_WRONLY , perm)
        os.write(fh, zf.read(name))
        os.close(fh)
    print "Extracting: " + outfile 
```

您可能会做类似的事情，但插入您自己的逻辑来计算您的烫发值。我应该注意，我在这里使用的是 Python 2.5，我知道与 Python 的 zipfile 支持的某些版本存在一些不兼容性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T04:10:07.080

根据文档， unzip 将权限设置为在 unix 下存储的权限。此外，不使用外壳 umask。最好的办法是确保在压缩文件之前设置 perms。

既然你不能这样做，你将不得不尝试做你想做的事情（并让它在 Debian 下工作。）

Python 的 zipfile 库存在许多问题，包括将 writestr 的模式设置为某些系统上正在写入的文件的模式，或者将 zip 系统设置为 windows 而不是 unix。所以你不一致的结果可能意味着什么都没有改变。

所以你可能完全不走运。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-03-31T01:44:25.800

@Petriborg 的答案仍然是相关的，但要使用 Python 3，这里有一个包含必要修复的版本：

```
import os
import zipfile

zip_file = "/path/to/archive.zip"
out_dir = "/path/to/output"

os.makedirs(out_dir, exist_ok=True)

with zipfile.ZipFile(zip_file, "r") as zf:
    for file in zf.filelist:
        name = file.filename
        perm = ((file.external_attr >> 16) & 0o777)
        print("Extracting: " + name)
        if name.endswith("/"):
            os.mkdir(os.path.join(out_dir, name), perm)
        else:
            outfile = os.path.join(out_dir, name)
            fh = os.open(outfile, os.O_CREAT | os.O_WRONLY, perm)
            os.write(fh, zf.read(name))
            os.close(fh) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T04:16:56.257

提取到标准输出（unzip -p）并重定向到文件？如果 zip 中有多个文件，您可以列出 zip 内容，然后一次提取一个。

```
for n in `unzip -l test.zip | awk 'NR > 3 && NF == 4 { print $4 }'`; do unzip -p test.zip $n > $n; done 
```

（是的，我知道你标记了这个'python' :-)）

# html - 将 HTML 硬编码为 VB6 代码

> ID：279947
> 
> 赞同：1
> 
> 时间：2008-11-11T03:41:24.393
> 
> 标签：html, vb6, vbscript, hardcode

**背景：**我们有一个从 HTML 生成报告的应用程序（可能有也可能没有内联脚本）。HTML 源代码通常以 blob 形式存储在数据库中。

现在需要将特定报告硬编码到应用程序中（即，使其不依赖于数据库）。我首先尝试了蛮力方式（将整个报告剪切并粘贴到一个 const 字符串中，并在其中附加了很多`& vbNewLine & _`内容；这不起作用，因为似乎可以使用的数量有限制`& _`。我考虑将所有内容（或多或少）压缩成一行，但这不仅会损害可读性，而且对于内联脚本也不起作用。

写这篇文章时我突然想到了一些事情：我可以以编程方式打开文件（包含我想要硬编码的 HTML）并将文件的内容写入字符串。我现在就试一试...

任何人都可以提出更好/更优雅的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T04:25:45.677

您可以阅读文件的每一行并随时追加。或者，您可以使用 StringBuilder 类。您需要编写此类或从[类似这样](http://www.vbaccelerator.com/home/Vb/Code/Techniques/StringBuilder/article.asp)的地方复制它。以这种方式做事也有可能提高性能。

```
将 oSB 调暗为 CStringBuilder
将 sHtml 调暗为字符串

设置 oSB = new CStringBuilder
带 oSB
  调用 .Append("这里有一些 HTML")
  调用 .Append("这里还有一些 HTML")
  ' ETC...
  sHtml = .ToString()
结束于

设置 oSB = 无

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T04:01:50.937

如果这是您必须采用的方式，那么请考虑使用 html 字符串作为模板，并在字符串中使用 @@var1@@ 等占位符，然后您可以将其替换为实际的动态值，而不是尝试生成最终的内联输出，应该更容易调试问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T07:51:59.333

我最终将 HTML 文件嵌入到资源 (res) 文件中，并使用 LoadResData 从那里加载它。我问了另一个[关于](https://stackoverflow.com/questions/280211/loading-html-from-a-res-file)从 res 文件中加载 HTML 文件的问题（也得到了一个很好的答案）。请注意，另一个选项可能是将 HTML（或任何其他文本文件）嵌入为自定义资源；这样，在使用 LoadResData 而不是数字时，您将能够按名称（即自定义资源的名称）引用资源（这对于出现并试图理解您的代码的人来说可能意义不大）。另请注意，如果您想将 HTML 加载到字符串中（就像我一样），您需要对 LoadResData 返回的结果调用 StrConv（LoadResData 返回一个字节数组）。

# .net - 将 Visual Studio 报表设计器与 Linq to SQL 数据源一起使用时出现问题

> ID：279948
> 
> 赞同：1
> 
> 时间：2008-11-11T03:43:52.563
> 
> 标签：.net, visual-studio, reporting-services

我不希望得到很好的回应，所以如果你有这方面的经验，任何贡献都将不胜感激。

我正在尝试将 Visual Studio 报表设计器与 Linq to SQL 数据源一起使用，我没有使用 Visual Studio 报表设计器的经验。

如果我通过向导并使用对象数据源，我可以很容易地获得列出单个实体类型（即 sql 表）的简单报告。我的问题是如何让报告接受具有匿名返回类型的连接、总和等复杂的 Linq 查询。如果我此时尝试此操作，则在尝试使用点表示法或别名来访问我需要在查询结果中引用的字段时，我会从报表设计器那里得到一个编译时错误。我认为这是因为设计师期望与向导中指定的类型相同......

错误是：-

> 报表项表达式只能引用当前数据集范围内的字段，或者如果在聚合内，则只能引用指定数据集范围内的字段。

也许我最好使用数据集？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T11:44:56.430

编写一个简单的类，其中包含您的报告所需的所有属性（称之为 MyData）。为每个属性使用简单的 .NET 类型：字符串、整数等

使用 GetXxx 方法编写另一个类，该方法返回`IEnumerable<MyData>`. 此 Get 方法应返回 Linq 查询的结果。您可以在返回之前执行 .ToList() 以获取内存列表，从而允许您在返回之前关闭连接。

编译。

现在打开您的报表设计器（在相同的解决方案中），您应该会在“数据源”窗口中看到 MyData 以及您编写的 Get 方法。

如果将此数据源中的字段拖到报表设计器上，然后从新的 ReportViewer 控件中引用此报表，则会自动创建 ObjectDatasource 并将其链接起来。

希望有帮助！

# asp.net - ASP.NET 登录页面样式

> ID：279951
> 
> 赞同：0
> 
> 时间：2008-11-11T03:48:32.833
> 
> 标签：asp.net, forms, forms-authentication

我创建了一个用户登录页面并正在使用表单身份验证。用户需要登录系统才能使用它，没有匿名页面。但是，当进入系统并自动重定向到登录页面时，它们会丢失页面上的所有样式。好像所有css文件的路径都不正确。对于所有其他页面都可以，只是在自动定向到 login.aspx 时出现问题。有没有其他人看到并解决了这个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T04:12:36.593

问题可能来自您的所有应用程序（login.aspx 除外）都受到保护。因此，当用户被重定向到 login.aspx 时，还有其他以匿名方式检索的 url。例如，如果用户尝试获取“~/StyleSheets/default.css”，那么 Web 服务器将返回一个不可见的未经授权的响应。

您应该在 web.config 文件中尝试类似的操作：

```
<location path="StyleSheets" >
  <system.web>
    <authorization>
      <allow users="*" />
    </authorization>
  </system.web>
</location> 
```

# .net - 如何使用 SmtpClient.SendAsync 发送带有附件的电子邮件？

> ID：279953
> 
> 赞同：32
> 
> 时间：2008-11-11T03:49:50.850
> 
> 标签：.net, asp.net, asp.net-mvc, email

我正在通过 ASP.NET MVC 使用服务组件。我想以异步方式发送电子邮件，让用户无需等待发送就可以做其他事情。

当我发送没有附件的消息时，它工作正常。当我发送带有至少一个内存附件的消息时，它会失败。

所以，我想知道是否可以使用带有内存附件的异步方法。

这是发送方法

```
 public static void Send() {

        MailMessage message = new MailMessage("from@foo.com", "too@foo.com");
        using (MemoryStream stream = new MemoryStream(new byte[64000])) {
            Attachment attachment = new Attachment(stream, "my attachment");
            message.Attachments.Add(attachment);
            message.Body = "This is an async test.";

            SmtpClient smtp = new SmtpClient("localhost");
            smtp.Credentials = new NetworkCredential("foo", "bar");
            smtp.SendAsync(message, null);
        }
    } 
```

这是我当前的错误

```
 System.Net.Mail.SmtpException: Failure sending mail.
 ---> System.NotSupportedException: Stream does not support reading.
   at System.Net.Mime.MimeBasePart.EndSend(IAsyncResult asyncResult)
   at System.Net.Mail.Message.EndSend(IAsyncResult asyncResult)
   at System.Net.Mail.SmtpClient.SendMessageCallback(IAsyncResult result)
   --- End of inner exception stack trace --- 
```

* * *

解决方案

```
 public static void Send()
    {

            MailMessage message = new MailMessage("from@foo.com", "to@foo.com");
            MemoryStream stream = new MemoryStream(new byte[64000]);
            Attachment attachment = new Attachment(stream, "my attachment");
            message.Attachments.Add(attachment);
            message.Body = "This is an async test.";
            SmtpClient smtp = new SmtpClient("localhost");
            //smtp.Credentials = new NetworkCredential("login", "password");

            smtp.SendCompleted += delegate(object sender, System.ComponentModel.AsyncCompletedEventArgs e)
            {
                    if (e.Error != null)
                    {
                            System.Diagnostics.Trace.TraceError(e.Error.ToString());

                    }
                    MailMessage userMessage = e.UserState as MailMessage;
                    if (userMessage != null)
                    {
                            userMessage.Dispose();
                    }
            };

            smtp.SendAsync(message, message);
    } 
```

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-11-12T08:48:38.687

不要在这里使用“使用”。您在调用 SendAsync 后立即销毁内存流，例如可能在 SMTP 读取它之前（因为它是异步的）。在回调中销毁您的流。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T08:19:12.023

我已经尝试过您的功能，它甚至适用于带有内存附件的电子邮件。但这里有一些说明：

*   您尝试发送什么类型的附件？可执行程序 ？
*   发件人和收件人都在同一个电子邮件服务器上吗？
*   你应该“捕捉”异常，而不是仅仅吞下它，这样你会得到更多关于你的问题的信息。
*   异常说明了什么？

*   当您使用 Send 而不是 SendAsync 时，它是否有效？您正在使用“使用”子句并在发送电子邮件之前关闭 Stream。

这是关于这个主题的好文字：

[在 .NET 2.0 中发送邮件](http://blogs.claritycon.com/blog/2006/01/sending-mail-in-net-2-0/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-12-10T01:41:43.180

对原始问题中提供的解决方案的扩展也可以正确清理可能也需要处理的附件。

```
 public event EventHandler EmailSendCancelled = delegate { };

    public event EventHandler EmailSendFailure = delegate { };

    public event EventHandler EmailSendSuccess = delegate { };
    ...

        MemoryStream mem = new MemoryStream();
        try
        {
            thisReport.ExportToPdf(mem);

            // Create a new attachment and put the PDF report into it.
            mem.Seek(0, System.IO.SeekOrigin.Begin);
            //Attachment att = new Attachment(mem, "MyOutputFileName.pdf", "application/pdf");
            Attachment messageAttachment = new Attachment(mem, thisReportName, "application/pdf");

            // Create a new message and attach the PDF report to it.
            MailMessage message = new MailMessage();
            message.Attachments.Add(messageAttachment);

            // Specify sender and recipient options for the e-mail message.
            message.From = new MailAddress(NOES.Properties.Settings.Default.FromEmailAddress, NOES.Properties.Settings.Default.FromEmailName);
            message.To.Add(new MailAddress(toEmailAddress, NOES.Properties.Settings.Default.ToEmailName));

            // Specify other e-mail options.
            //mail.Subject = thisReport.ExportOptions.Email.Subject;
            message.Subject = subject;
            message.Body = body;

            // Send the e-mail message via the specified SMTP server.
            SmtpClient smtp = new SmtpClient();
            smtp.SendCompleted += SmtpSendCompleted;
            smtp.SendAsync(message, message);
        }
        catch (Exception)
        {
            if (mem != null)
            {
                mem.Dispose();
                mem.Close();
            }
            throw;
        }
    }

    private void SmtpSendCompleted(object sender, AsyncCompletedEventArgs e)
    {
        var message = e.UserState as MailMessage;
        if (message != null)
        {
            foreach (var attachment in message.Attachments)
            {
                if (attachment != null)
                {
                    attachment.Dispose();
                }
            }
            message.Dispose();
        }
        if (e.Cancelled)
            EmailSendCancelled?.Invoke(this, EventArgs.Empty);
        else if (e.Error != null)
        {
            EmailSendFailure?.Invoke(this, EventArgs.Empty);
            throw e.Error;
        }
        else
            EmailSendSuccess?.Invoke(this, EventArgs.Empty);
    } 
```

# c++ - 有什么方法可以在 XP 中以编程方式设置文件的注释属性？

> ID：279956
> 
> 赞同：1
> 
> 时间：2008-11-11T03:50:48.943
> 
> 标签：c++, windows-xp

指向正确方向的链接或示例代码将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-11T04:15:55.853

您可以使用一些非托管调用来执行此操作，请查看 MSDN 上的 OLE32 函数 StgOpenPropStg() 和 StgOpenStorageEx() 函数：

[http://msdn.microsoft.com/en-us/library/aa380342(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa380342(VS.85).aspx)

这有很多，但函数名应该能让你继续前进。

# asp.net - 当用户通过表单身份验证自动登录时，如何设置会话变量？

> ID：279957
> 
> 赞同：3
> 
> 时间：2008-11-11T03:51:03.063
> 
> 标签：asp.net

我正在使用表单身份验证（以及内置的登录控件）并让用户在登录时单击“记住我”复选框。当他们返回站点时，他们会按预期自动登录。发生这种情况时，我可以捕捉到一个事件吗？我一直在研究 FormsAuthenticationModule.Authenticate 事件，但我不确定这是正确的方法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T04:22:54.620

查看 Global.asax 中的 Application_AuthenticateRequest 事件。

[http://msdn.microsoft.com/en-us/library/system.web.httpapplication.aspx](http://msdn.microsoft.com/en-us/library/system.web.httpapplication.aspx)

此事件在用户通过身份验证后触发（通过手动登录或使用 cookie）。从那里，你可以做你需要的。您可以查询 Page.User 对象以获取有关登录用户的信息，

[http://msdn.microsoft.com/en-us/library/system.web.ui.page.user.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.page.user.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T04:11:21.633

您可能会查看 global.asax 中的 Session_Start ，看看您是否可以检测到用户是否已通过身份验证，如果是，请从那里设置您的变量。您可能需要从 HttpContext.Current.Session 引用会话（与 User 类似）。您可能还想查看为 OnAuthenticate 注册事件处理程序的 HttpHandler 并在那里检查/设置您的变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T04:09:14.243

首先，考虑使用 2.0+ 中可用的 Login 控件（我记得）。您可以在该控件上处理一个 Authenticate 事件，您可以在其中设置会话变量。

此外，让我们假设在验证用户身份后被带到某个“主页”页面。因此，您可以在“主页”页面的 Load 事件处理程序中设置会话变量。

# php - Eclipse PDT 测试服务器问题上的 XDebug 服务器

> ID：279958
> 
> 赞同：0
> 
> 时间：2008-11-11T03:53:11.000
> 
> 标签：php, eclipse, subclipse, eclipse-pdt

我安装了带有 Subclipse 的 Eclipse PDT，并且目前从我的生产服务器上的存储库中绘制了一个 PHP 项目。我在 Linux 上安装了 VMWare Workstation，并希望将其用作使用 XDebug 的调试服务器。问题是当我更新文件时，它们只提交到我的生产服务器上的存储库。如何在 VM linux 上测试设置？是否可以将更改提交到两个存储库？有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T22:42:36.420

如果您的工作副本位于主机上而不是来宾 (VM) 中，最简单的方法是使用 VM 中的**共享文件夹**... 将共享文件夹设置为指向主机上的项目文件夹或子文件夹你有你的工作副本的地方。在虚拟机内部，您可以链接您的 www-root 例如。到 /var/www/myproject.com 以具有与生产服务器上相同的路径。因此，您只有**1 个**工作副本与 VM 内的测试服务器共享。

您还可以使用 SSH（或 FTP）并使用 SFTP（或 FTP）在主机上访问您的 Web。为此，您必须在主机上安装 SSH-/FTP 服务器。在您的虚拟机中，您可以使用 fuse 和 SSH/FTP 将连接挂载到本地路径，以便通过网络服务器轻松访问。

您还可以使用 2 个工作副本（一个在您的主机上，一个在您的 VM 内）。但这需要更多的工作，因为您必须同步两者。

您还可以更改方向并在 VM 中拥有一份工作副本。为此，最简单的方法是使用 SSH (SFTP) 访问您的 VM，并在您的主机上使用可以将 SFTP 安装为驱动器的工具（例如 Webdrive）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T18:11:38.910

我认为您可能会混淆存储库和工作副本的概念。一个项目应该只有一个存储库。存储库基本上只是代码库的中央副本。您将代码从存储库签出到调试服务器。当您对源代码进行更改时，您将提交它们并将它们转到存储库。然后，您在调试服务器工作副本上运行 svn update 以获取最新更改以进行测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T13:29:45.343

您可以在存储库机器上创建一个提交后挂钩，它告诉开发机器更新其修订版。

# vim - 如何在 Vim 中使 shift+空格键向上翻页？

> ID：279959
> 
> 赞同：47
> 
> 时间：2008-11-11T03:54:25.397
> 
> 标签：vim, paging, configuration-files

我的 .vimrc 中有一个条目，当我按下空格键时，它会在视口中向下翻页。它看起来像这样：

```
map <Space> <PageDown> 
```

我想创建另一个键映射，当按住 shift 并按下空格键时，它会将视口向上翻页。我尝试了以下条目：

```
map <Shift><Space> <PageUp>
map <S-Space> <PageUp> 
```

都不工作。有人知道如何实现这个功能吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-11T16:59:48.417

你不能。CMS 的解决方案适用于 gVim，但不适用于 vim，因为终端无法区分 <Space> 和 <S-Space>，因为 curses 认为它​​们相同。如果 vim 获得 libtermkey 支持并且您的终端支持正确的 <CSI> 序列（如果配置正确，xterm 会支持；其他没有），将来可能会实现。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2013-08-14T06:31:13.020

如果您在 iTerm2 中使用 vim，您可以通过发送十六进制键 15 将 shift-space 映射到 ctrl+U。这是一个屏幕截图：

![在此处输入图像描述](https://i.stack.imgur.com/2GfWy.png)

要查找 ctrl+字母组合的十六进制代码，例如 ctrl+u，您可以执行以下操作：

*   在 vim 中进入插入模式
*   按 ctrl+v 然后 ctrl+u 然后 ctrl+c 然后 ga
*   各种数字表示将打印在底部

您可以将此想法应用于支持键映射的其他终端仿真器。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-11T04:09:26.693

用这个：

```
map <Space> ^D   " Pagedown when press Space
map <S-Space> ^U " Page Up when press Shift Space 
```

要正确获取 ^D 和 ^U 符号，只需按 Control-V Control-D 和 Control-V Control-U

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-10-09T06:14:15.947

对于 OSX：

```
nnoremap <Space> <C-d>
nnoremap <S-Space> <C-u> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-07-25T06:09:20.580

受[这个答案](https://unix.stackexchange.com/a/320750/124200)的启发，我通过以下方式完成了映射：

*   使用支持键映射的终端
*   `Shift`将+映射`Space`到 Vim 可以区分的字符序列`Space`，但在输入文本时仍然具有写入空格的净效果。

### 如何：

1.  **选择能够进行键映射的终端之一。**
    例如，Alacritty、xterm、urxvt 或 Kitty。

2.  **选择`Shift`+`Space`将映射到的字符序列。**
    `SOME_KEY`, `Backspace`,`Space`应该可以解决问题，其中`SOME_KEY`：

    *   写入在输入文本时可以被 a 取消的字符`Backspace`，例如可打印字符或制表符。
    *   也是您在 Vim 普通模式和/或可视模式下很少使用的键（取决于您要在哪种模式下使用`Shift`+ `Space`）。如果它已经绑定到某个频繁使用的命令，那么`:h timeout`每次使用该命令时，您可能会遇到一些延迟（详情请参阅）。

    我正在使用`\`as `SOME_KEY`(```也可能是一个不错的选择)。

3.  **在终端中映射**
    我使用的是[Alacritty](https://github.com/alacritty/alacritty)，所以这里是一个将`Shift`+映射`Space`到 Alacritty 中的字符序列的示例。在配置文件中的“key_bindings”项下添加以下行：`- { key: Space, mods: Shift, chars: "\x5c\x08 " }`.

    要确认映射工作，`showkey -a`请在终端中运行并按`Shift`+ `Space`，然后应该输出字符序列。对于上面的示例，输出为：

    ```
     \^H      92 0134 0x5c  
               8 0010 0x08  
              32 0040 0x20 
    ```

4.  **Vim 中**
    的映射 将字符序列映射到 Vim 配置中的上一页。在我的情况下（`\`用作第一个键），它将是`no <Bslash><C-h><Space> <C-b>`. 如果您也需要可视模式下的映射，还可以添加`vno <Bslash><C-h><Space> <C-b>`.

我已经使用这个设置有一段时间了，它还没有破坏 Vim 的插入模式和替换模式，以及我系统上接受文本输入的大多数程序。但这不是解决方案，而是一种解决方法，确实存在一些缺陷，例如：

*   在 Vim 中，如果你尝试用+替换光标下的字符（`r`默认情况下），你不会得到空格。`Shift``Space`
*   一些像 Vim 一样将字符序列解释为命令的程序可能会受到影响。

# asp.net - 如何使用 C# 将 Gridview 的数据导出到 Excel？

> ID：279962
> 
> 赞同：2
> 
> 时间：2008-11-11T03:58:25.997
> 
> 标签：asp.net

如何将 GridView 的数据导出到 Microsoft Excel 2007 文件？

另外，Microsoft Excel 2007 是否支持 html 元素和标签？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T04:26:42.773

如果您的用户使用的是 IE，只需让他们右键单击 GridView（将呈现为 HTML 表格），右键单击，然后选择“导出到 Excel”。这不是一个了不起的功能——而且它需要 IE——但如果你需要快速而肮脏的 HTML 表格导出到 Excel 就可以了——你可以告诉他们你整晚都在写很多代码来实现它工作！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T04:34:19.387

您可以在普通旧表中创建具有相同信息的页面，然后将页面的内容类型更改为 Excel。这可能也适用于 GridView，但您应该最小化任何其他控件或 HTML，因为它们会尝试在 Excel 中呈现它们。也许有一个按钮可以转到只有网格或等效表格的页面。excel 文件可能是 HTML 的时髦原因，但它可以工作。

这是更改内容类型的代码。

```
Response.ContentType = "application/vnd.ms-excel"; 
```

如果您想强制下载弹出窗口以便他们可以保存文件，代码如下：

```
Response.AppendHeader("Content-disposition", "attachment; filename=my.xls"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T04:05:17.107

我已经使用[Aspose.Cells](http://www.aspose.com)来做到这一点。该组件具有一种机制，可以通过 GridView 以编程方式创建 Excel 文档。我通常有一个 LinkBut​​ton，其单击事件处理程序构造文档并将数据写入响应。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T04:36:28.697

您可以将 HTML 元素导出到它。

[http://www.c-sharpcorner.com/UploadFile/DipalChoksi/exportxl_asp2_dc11032006003657AM/exportxl_asp2_dc.aspx?ArticleID=000c64fb-8a22-414a-8247-984335aaa0eb](http://www.c-sharpcorner.com/UploadFile/DipalChoksi/exportxl_asp2_dc11032006003657AM/exportxl_asp2_dc.aspx?ArticleID=000c64fb-8a22-414a-8247-984335aaa0eb)

# http - PHP_SELF vs PATH_INFO vs SCRIPT_NAME vs REQUEST_URI

> ID：279966
> 
> 赞同：113
> 
> 时间：2008-11-11T04:00:16.663
> 
> 标签：http, php, codeigniter

我正在 CodeIgniter 中构建一个 PHP 应用程序。CodeIgniter 将所有请求发送到主控制器：`index.php`. 但是，我不喜欢`index.php`在 URI 中看到。例如，`http://www.example.com/faq/whatever`将路由到`http://www.example.com/index.php/faq/whatever`. 我需要一种可靠的方法让脚本知道它的地址是什么，这样它就会知道如何处理导航。`mod_rewrite`根据 CodeIgniter 文档，我使用过 。

规则如下：

```
RewriteEngine on
RewriteCond $1 !^(images|inc|favicon\.ico|index\.php|robots\.txt)
RewriteRule ^(.*)$ /index.php/$1 [L] 
```

通常，我会检查`php_self`，但在这种情况下，它总是`index.php`。我可以从 、 等处获得它`REQUEST_URI`，`PATH_INFO`但我正在尝试确定哪个最可靠。有谁知道（或知道在哪里可以找到） 、 、 和 之间`PHP_SELF`的`PATH_INFO`真正`SCRIPT_NAME`区别`REQUEST_URI`？谢谢你的帮助！

**注意**：我必须添加空格，因为 SO 看到下划线，并且出于某种原因将其设为斜体。

**更新**：修复了空格。

* * *

## 回答 #1

> 赞同：246
> 
> 时间：2008-11-28T17:59:46.520

这些变量之间差异的一些实际示例：
示例 1\. PHP_SELF 与 SCRIPT_NAME*仅*在请求的 url 格式为：
[http ://example.com/test.php/foo/bar 时不同](http://example.com/test.php/foo/bar)

```
[PHP_SELF] => /test.php/foo/bar
[SCRIPT_NAME] => /test.php 
```

（这似乎是 PATH_INFO 包含敏感信息的唯一情况 [PATH_INFO] => /foo/bar） 注意：这在一些较旧的 PHP 版本（<= 5.0 ？）中曾经是不同的。

示例 2\. 当输入非空查询字符串时，REQUEST_URI 与 SCRIPT_NAME 不同：
[http ://example.com/test.php?foo=bar](http://example.com/test.php?foo=bar)

```
[SCRIPT_NAME] => /test.php
[REQUEST_URI] => /test.php?foo=bar 
```

示例 3\. 当服务器端重定向生效时，REQUEST_URI 与 SCRIPT_NAME 不同（例如 apache 上的 mod_rewrite）：

[http://example.com/test.php](http://example.com/test.php)

```
[REQUEST_URI] => /test.php
[SCRIPT_NAME] => /test2.php 
```

示例 4\. 在使用脚本处理 HTTP 错误时，REQUEST_URI 与 SCRIPT_NAME 不同。
使用 apache 指令 ErrorDocument 404 /404error.php
[http://example.com/test.php](http://example.com/test.php)

```
[REQUEST_URI] => /test.php
[SCRIPT_NAME] => /404error.php 
```

在 IIS 服务器上使用自定义错误页面
[http://example.com/test.php](http://example.com/test.php)

```
[SCRIPT_NAME] => /404error.php
[REQUEST_URI] => /404error.php?404;http://example.com/test.php 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-11-11T05:14:31.693

[PHP 文档](http://ca.php.net/manual/en/reserved.variables.server.php)可以告诉您区别：

> *'PHP_SELF'*
> 
> > 当前执行脚本的文件名，相对于文档根目录。例如，地址*[http://example.com/test.php/foo.bar](http://example.com/test.php/foo.bar)**的脚本中的$_SERVER['PHP_SELF']*将是*/test.php/foo.bar*。[__FILE__](http://ca.php.net/manual/en/language.constants.predefined.php)常量包含当前（即包含的）文件的完整路径和文件名。如果 PHP 作为命令行处理器运行，则此变量包含自 PHP 4.3.0 以来的脚本名称。以前它不可用。
> 
>  **'SCRIPT_NAME'*
> 
> > 包含当前脚本的路径。这对于需要指向自身的页面很有用。[__FILE__](http://ca.php.net/manual/en/language.constants.predefined.php)常量包含当前（即包含的）文件的完整路径和文件名。
> 
> *'REQUEST_URI'*
> 
> > 为访问此页面而提供的 URI；例如，*'/index.html'*。*

 *PATH_INFO 似乎没有记录...

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2012-03-07T11:22:58.917

`PATH_INFO`仅在像这样使用 htaccess 时可用：

## 示例 1

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^(favicon\.ico|robots\.txt)
RewriteRule ^(.*)$ index.php/$1 [L] 
```

### 保持原样

```
[SCRIPT_NAME] => /index.php 
```

### 根

[http://domain.com/](http://domain.com/)

```
[PHP_SELF]     => /index.php
[PATH_INFO] IS NOT AVAILABLE (fallback to REQUEST_URI in your script)
[REQUEST_URI]  => /
[QUERY_STRING] => 
```

### 小路

[http://domain.com/test](http://domain.com/test)

```
[PHP_SELF]     => /index.php/test
[PATH_INFO]    => /test
[REQUEST_URI]  => /test
[QUERY_STRING] => 
```

### 请求参数

[http://domain.com/test?123](http://domain.com/test?123)

```
[PHP_SELF]     => /index.php/test
[PATH_INFO]    => /test
[REQUEST_URI]  => /test?123
[QUERY_STRING] => 123 
```

## 示例 2

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^(favicon\.ico|robots\.txt)
RewriteRule ^(.*)$ index.php?url=$1 [L,QSA] 
```

### 保持原样

```
[SCRIPT_NAME]  => /index.php
[PHP_SELF]     => /index.php
[PATH_INFO] IS NOT AVAILABLE (fallback to REQUEST_URI in your script) 
```

### 根

[http://domain.com/](http://domain.com/)

```
[REQUEST_URI]  => /
[QUERY_STRING] => 
```

### 小路

[http://domain.com/test](http://domain.com/test)

```
[REQUEST_URI]  => /test
[QUERY_STRING] => url=test 
```

### 请求参数

[http://domain.com/test?123](http://domain.com/test?123)

```
[REQUEST_URI]  => /test?123
[QUERY_STRING] => url=test&123 
```

## 示例 3

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^(favicon\.ico|robots\.txt)
RewriteRule ^(([a-z]{2})|(([a-z]{2})/)?(.*))$ index.php/$5 [NC,L,E=LANGUAGE:$2$4] 
```

或者

```
RewriteRule ^([a-z]{2})(/(.*))?$ $3 [NC,L,E=LANGUAGE:$1]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^(favicon\.ico|robots\.txt)
RewriteRule ^(.*)$ index.php/$1 [L] 
```

### 保持原样

```
[SCRIPT_NAME] => /index.php 
```

### 根

[http://domain.com/](http://domain.com/)

```
[PHP_SELF]          => /index.php
[PATH_INFO] IS NOT AVAILABLE (fallback to REQUEST_URI in your script)
[REQUEST_URI]       => /
[QUERY_STRING]      => 
[REDIRECT_LANGUAGE] IS NOT AVAILABLE 
```

### 小路

[http://domain.com/test](http://domain.com/test)

```
[PHP_SELF]          => /index.php/test
[PATH_INFO]         => /test
[REQUEST_URI]       => /test
[QUERY_STRING]      => 
[REDIRECT_LANGUAGE] => 
```

### 语言

[http://domain.com/en](http://domain.com/en)

```
[PHP_SELF]          => /index.php/
[PATH_INFO]         => /
[REQUEST_URI]       => /en
[QUERY_STRING]      => 
[REDIRECT_LANGUAGE] => en 
```

### 语言路径

[http://domain.com/en/test](http://domain.com/en/test)

```
[PHP_SELF]          => /index.php/test
[PATH_INFO]         => /test
[REQUEST_URI]       => /en/test
[REDIRECT_LANGUAGE] => en 
```

### 语言查询字符串

[http://domain.com/en/test?123](http://domain.com/en/test?123)

```
[PHP_SELF]          => /index.php/test
[PATH_INFO]         => /test
[REQUEST_URI]       => /en/test?123
[QUERY_STRING]      => 123
[REDIRECT_LANGUAGE] => en 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2015-04-10T05:12:47.867

### PHP 路径

  <code> $_SERVER['REQUEST_URI'] </code> = Web 路径，请求的 URI
  <code> $_SERVER['PHP_SELF'] </code> = Web 路径，请求的文件 + 路径信息
  <code> $_SERVER[' SCRIPT_NAME'] </code> = Web 路径，请求的文件
  <code> $_SERVER['SCRIPT_FILENAME'] </code> = 文件路径，请求的文件
  <code> __FILE__ </code> = 文件路径，当前文件
 </p >

### 在哪里

*   **文件路径**是*系统文件路径*，如`/var/www/index.php`别名解析后
*   **Web 路径**是类似于from 的*服务器文档路径*，甚至可能不匹配任何文件`/index.php``http://foo.com/index.php`
*   **当前文件**是指*包含的脚本文件*，而不是包含它的任何脚本
*   **请求的文件**是指包含*脚本文件*，而不是包含的文件
*   **URI**是在任何 URL 重写之前的*HTTP 请求*`/index.php?foo=bar`
*   **路径信息**是位于脚本名称之后但查询字符串之前的任何额外的 Apache 数据

### 操作顺序

1.  客户端向服务器发送*HTTP 请求* `REQUEST_URI`
2.  服务器从 .htaccess 文件等执行任何*URL 重写以获取*`PHP_SELF`
3.  服务器`PHP_SELF`分为`SCRIPT_FILENAME`+`PATH_INFO`
4.  服务端进行*别名解析*，将整个*url路径*转换为*系统文件路径*获取`SCRIPT_FILENAME`
5.  生成的脚本文件可能包含其他文件，其中`__FILE__`指的是当前文件的路径

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-11T05:09:02.250

您可能想查看[URI 类](http://codeigniter.com/user_guide/libraries/uri.html)并使用 $this->uri->uri_string()

返回具有完整 URI 的字符串。

例如，如果这是您的完整 URL：

```
http://example.com/index.php/news/local/345 
```

该函数将返回：

```
/news/local/345 
```

或者您可以利用这些段来深入了解特定区域，而无需提出解析/正则表达式值

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-11T04:17:09.733

我个人使用它，`$REQUEST_URI`因为它引用输入的 URI，而不是服务器磁盘上的位置。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-12-16T04:34:11.947

奥丁的答案几乎没有什么可补充的。我只是觉得提供一个从HTTP请求到文件系统上实际文件的完整示例来说明URL重写和别名的影响。在文件系统上，脚本`/var/www/test/php/script.php`是

```
<?php
include ("script_included.php")
?> 
```

`/var/www/test/php/script_included.php`在哪里

```
<?php
echo "REQUEST_URI: " .  $_SERVER['REQUEST_URI'] . "<br>"; 
echo "PHP_SELF: " .  $_SERVER['PHP_SELF'] . "<br>";
echo "QUERY_STRING: " .  $_SERVER['QUERY_STRING'] . "<br>";
echo "SCRIPT_NAME: " .  $_SERVER['SCRIPT_NAME'] . "<br>";
echo "PATH_INFO: " .  $_SERVER['PATH_INFO'] . "<br>";
echo "SCRIPT_FILENAME: " . $_SERVER['SCRIPT_FILENAME'] . "<br>";
echo "__FILE__ : " . __FILE__ . "<br>";  
?> 
```

并且 `/var/www/test/.htaccess` 是

```
RewriteEngine On
RewriteRule before_rewrite/script.php/path/(.*) after_rewrite/script.php/path/$1 
```

并且 Apache 配置文件包含别名

```
Alias /test/after_rewrite/ /var/www/test/php/ 
```

http请求是

```
www.example.com/test/before_rewrite/script.php/path/info?q=helloword 
```

输出将是

```
REQUEST_URI: /test/before_rewrite/script.php/path/info?q=helloword
PHP_SELF: /test/after_rewrite/script.php/path/info
QUERY_STRING: q=helloword
SCRIPT_NAME: /test/after_rewrite/script.php
PATH_INFO: /path/info
SCRIPT_FILENAME: /var/www/test/php/script.php
__FILE__ : /var/www/test/php/script_included.php 
```

以下始终成立

```
PHP_SELF = SCRIPT_NAME + PATH_INFO = full url path between domain and query string. 
```

如果没有 mod_rewrite、mod_dir、ErrorDocument 重写或任何形式的 URL 重写，我们也有

```
REQUEST_URI = PHP_SELF + ? + QUERY_STRING 
```

别名影响系统文件路径`SCRIPT_FILENAME`，`__FILE__`而不是之前定义的 URL 路径 - 请参阅下面的例外情况。别名可能使用整个 URL 路径，包括`PATH_INFO`. `SCRIPT_NAME`和之间根本没有联系`SCRIPT_FILENAME`。

在定义URL 路径时不解析别名并不完全准确`[PHP_SELF] = [SCRIPT_NAME] + [PATH_INFO]` ，因为别名被认为是搜索文件系统，我们从 Odin 回答中的示例 4 中知道，搜索文件系统以确定文件是否存在，但这仅在找不到文件时才有意义。类似地，mod_dir 调用 mod_alias 来搜索文件系统，但这仅在您有别名`Alias \index.php \var\www\index.php`且请求 uri 是目录时才相关。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-07-23T14:46:16.993

如果您忘记了哪些变量做了什么，您可以编写一个使用[phpinfo()](http://php.net/manual/en/function.phpinfo.php)的小脚本，并从带有查询字符串的 URL 调用它。由于服务器软件安装会显示 PHP 返回的变量，因此最好检查机器的输出，以防服务器配置文件的重写导致与预期不同的结果。将其另存为`_inf0.php`：

```
<?php
    $my_ip = '0.0.0.0';

   if($_SERVER['REMOTE_ADDR']==$my_ip){
     phpinfo();
   } else {
     //something
   } 
```

然后你会打电话`/_inf0.php?q=500`

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-28T02:00:57.560

备份一秒钟，您一开始就采取了错误的方法。为什么不这样做

```
RewriteEngine on
RewriteCond $1 !^(images|inc|favicon\.ico|index\.php|robots\.txt)
RewriteRule ^(.*)$ /index.php?url=$1 [L] 
```

反而？然后抓住它`$_GET['url'];`

# powershell - 在 powershell 中导入“库”

> ID：279974
> 
> 赞同：13
> 
> 时间：2008-11-11T04:09:49.157
> 
> 标签：powershell, import

我发现自己正在编写一堆相关的函数来处理不同的名词（集群、sql 服务器、一般的服务器、文件等），并将这些函数组中的每一个放在单独的文件中（例如 cluster_utils.ps1） . 如果需要，我希望能够在我的个人资料中“导入”其中一些库，在我的 powershell 会话中“导入”其他库。我已经编写了 2 个似乎可以解决问题的函数，但是由于我只使用了一个月的 powershell，我想我会问是否有任何现有的“最佳实践”类型的脚本可以用来代替。

为了使用这些功能，我将它们点源化（在我的个人资料或会话中）......例如，

```
# to load c:\powershellscripts\cluster_utils.ps1 if it isn't already loaded
. require cluster_utils 
```

以下是功能：

```
$global:loaded_scripts=@{}
function require([string]$filename){
      if (!$loaded_scripts[$filename]){
           . c:\powershellscripts\$filename.ps1
           $loaded_scripts[$filename]=get-date
     }
}

function reload($filename){
     . c:\powershellscripts\$filename.ps1
     $loaded_scripts[$filename]=get-date
} 
```

任何反馈都会有所帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-16T15:01:20.517

基于[Steven 的回答](https://stackoverflow.com/questions/279974/importing-libraries-in-powershell#282098)，另一个改进可能是允许一次加载多个文件：

```
$global:scriptdirectory = 'C:\powershellscripts'
$global:loaded_scripts = @{}

function require {
  param(
    [string[]]$filenames=$(throw 'Please specify scripts to load'),
    [string]$path=$scriptdirectory
  )

  $unloadedFilenames = $filenames | where { -not $loaded_scripts[$_] }
  reload $unloadedFilenames $path
}

function reload {
  param(
    [string[]]$filenames=$(throw 'Please specify scripts to reload'),
    [string]$path=$scriptdirectory
  )

  foreach( $filename in $filenames ) {
    . (Join-Path $path $filename)
    $loaded_scripts[$filename] = Get-Date
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T20:52:41.050

迈克，我认为这些脚本很棒。将函数打包到库中非常有用，但我认为加载脚本的函数非常方便。

我要做的一项更改是将文件位置也设为参数。您可以设置默认值，甚至为此使用全局变量。您不需要添加“.ps1”

```
$global:scriptdirectory= 'c:\powershellscripts'
$global:loaded_scripts=@{}
function require(){
      param ([string]$filename, [string]$path=$scriptdirectory)
      if (!$loaded_scripts[$filename]){
           . (Join-Path $path $filename)
           $loaded_scripts[$filename]=get-date
     }
}

function reload(){
     param ([string]$filename, [string]$path=$scriptdirectory)
     . (Join-Path $path $filename)
     $loaded_scripts[$filename]=get-date
} 
```

不错的功能！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-24T21:48:35.980

我想您会发现 PowerShell v2 的“模块”功能非常令人满意。基本上会为您解决这个问题。

# sql-server - 如何在 MS SQL Server 2008 中将几何数据转换为地理数据？

> ID：279983
> 
> 赞同：11
> 
> 时间：2008-11-11T04:15:50.610
> 
> 标签：sql-server, sql-server-2008, geometry, geography

如何在 MS SQL Server 2008 中将一些几何数据转换为地理数据？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T04:26:09.030

是的，您可以，但以我的经验，几何数据类型比地理数据类型更宽容。因此，您可能在几何中拥有一些无法转换的数据。

[Spatial Ed 的这篇文章](http://blogs.msdn.com/edkatibah/archive/2008/08/19/working-with-invalid-data-and-the-sql-server-2008-geography-data-type-part-1b.aspx)非常有助于解释如何解决数据问题，并且还有一些示例查询可以从 Geom 转换为 Geog。

# ms-word - 在word 2007中粘贴源代码

> ID：279988
> 
> 赞同：5
> 
> 时间：2008-11-11T04:19:30.743
> 
> 标签：ms-word, code-formatting, word-2007

如果我尝试在 word 2007 中粘贴源代码，则行之间的间距似乎会变得混乱，因为与编程文本编辑器相比，所有新行的间距都很大。

有人可以告诉我如何在 word 2007 中粘贴源代码，保留格式和行间距吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T06:48:40.397

试试你的 IDE（或编辑器）的“以 HTML 格式导出到剪贴板”或“以 RTF 格式导出到剪贴板”功能。然后粘贴到Word中。猜猜它应该工作。它适用于 Outlook（它甚至保留了语法着色）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T04:33:09.360

问题是每一行都是一个段落，而且往往在Word中，段落前都有一定的空格。如果您选择的样式前有 0 个空格，后有 0 个空格，它应该看起来不错。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T05:08:27.510

如前所述，这是因为段落间距。要么选择没有间距的样式，要么选择文本和格式段落并将前后间距设置为 0。这在早期版本中很容易，但现在我们有功能区控件可能会很复杂。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-16T08:49:43.917

如上所述，在将代码直接剪切并粘贴到 Word 2007 中时，每行代码都被视为一个段落。使用段落属性将前后空格设置为 0 的问题是，您必须在代码之前或之后添加一个虚假的空段落，以便代码与前面或后面的段落之间存在间隙。不出现此问题的另一种解决方案是使 Word 2007 将一段代码视为单个段落，方法是将每个段落分隔符替换为手动换行符（shift + enter）。这样，空间之前和之后的空间属性适用于整个代码块，并且可以与正常的正文保持一致。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T08:59:00.980

如果您使用的是 VIM，则可以使用`2html.vim`与 VIM 捆绑在一起的：

```
source $VIM/syntax/2html.vim 
```

这将打开一个新缓冲区，其中包含 HTML 格式的文件，您可以以任何您希望的方式保存或复制和粘贴该文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-13T10:25:12.537

（对于 MS Word）我使用 Lucida 控制台，颜色为黑色，
高 10 点（在换行前获得大约 80 个字符）
行间距设置为 0 之前和 12 之后（使用 0 之后也看起来不错）
将边框设置为“框”在你的段落周围得到一个矩形。不幸的是，除非从 html 或 rtf 粘贴，否则您不会得到彩色文本。
这是我的样式规范：字体：（默认）Lucida Console，10 pt，字体颜色：文本 1，行距：至少 12 pt，之后的空间：12 pt，样式：链接，快速样式，基于：控制台

# java - 在哪里可以找到关于 OpenGL 中鼠标移动和多边形旋转的示例代码？

> ID：279990
> 
> 赞同：0
> 
> 时间：2008-11-11T04:20:42.753
> 
> 标签：java, opengl

在哪里可以找到关于 OpenGL 中鼠标移动和多边形旋转的示例代码？我正在使用 Java，因此首选 Java 中的示例代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T04:45:33.593

您可能会发现这很有用：

[http://pepijn.fab4.be/software/nehe-java-ports/](http://pepijn.fab4.be/software/nehe-java-ports/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T05:04:57.470

如果您想使用 JOGL java 库，可以在[这里](http://www.cs.umd.edu/~meesh/kmconroy/JOGLTutorial/)找到非常有用的示例代码。

JOGL 是相当直截了当的前言，易于掌握。请注意，面向对象的性质可能会使 C/C++ 中的 OpenGL 未来/更高级的工作更难掌握。

**下面 .zip 中的MainWindow.java**是您正在寻找的示例。代码来自上面的链接。 [代码.zip](http://www.cs.umd.edu/~meesh/kmconroy/JOGLTutorial/code.zip)

# c# - ASP.NET-将特殊字符保存到数据库

> ID：279991
> 
> 赞同：0
> 
> 时间：2008-11-11T04:22:15.513
> 
> 标签：c#, asp.net, ado.net, special-characters

请告诉我如何将带有特殊字符的字符串保存到 DB.Special characters may contatin single `quotes/double quotes` etc..我正在使用带有 C# 的 ASP.NET

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T04:28:14.643

使用参数化查询。

[http://aspnet101.com/aspnet101/tutorials.aspx?id=1](http://aspnet101.com/aspnet101/tutorials.aspx?id=1)

渲染到客户端时，您还应该使用 Server.HtmlEncode() 将 HTML 中具有特殊含义的字符转换为数字字符引用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T10:03:45.083

(Server.HtmlEncode(value)) 工作！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T04:28:41.473

没有太多细节很难回答。但通常最好的选择是参数化查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T04:33:19.937

好的。即使我保存在数据库中。我需要将它显示回文本框。然后页面被打破。例如: 我已将学生姓名保存为 Ani"s 并且当我显示 gthis

如何摆脱这个问题？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T04:38:23.623

写出值时是否对值进行编码？(Server.HtmlEncode(值))

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T04:42:08.263

```
Using (SqlConnection conn = new SqlConnection(connstr))
{
    Using (SqlCommand command = new SqlCommand("INSERT INTO FOO (col) VALUES (@arg)"))
    {
        command.Connection = conn;
        command.Parameters.AddWithValue("@arg",SpecialCharsString);
        command.ExecuteNonQuery();
    }
} 
```

读出来根本不应该破坏你的输出，如果是的话，它不是数据库代码在做它。*********************