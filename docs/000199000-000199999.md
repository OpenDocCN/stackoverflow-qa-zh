# StackOverflow 问答 000199000-000199999

# .net - 使用 ObservableCollection 带后台线程

> ID：199006
> 
> 赞同：6
> 
> 时间：2008-10-13T20:55:31.240
> 
> 标签：.net, design-patterns, observablecollection

微软似乎对 ObservableCollection 有一个好主意。它们非常适合绑定，并且在 UI 上非常快。

然而，每次你想要调整它时都需要一个上下文切换到 Dispatcher Thread 似乎有点多。有谁知道使用它们的最佳实践？是不是简单的在业务层填充一个ICollection作为消息对象，然后在UI层创建ObservableCollection？然后如何处理 UI 上的集合更新？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T21:00:19.950

更新 UI 线程上的 ObservableCollection 真的会给您的应用程序造成这么大的瓶颈吗？如果没有，请坚持在 UI 线程上更新它。请记住，当您使用 Dispatcher 运行某些东西时，这并不是真正发生的上下文切换 - 相反，您只是将作业提交给 UI 线程，这是一个已经在运行的线程，操作系统无论如何都会在某个时候切换到该线程. UI 线程将您提交的作业从内部队列中拉出并执行。您不会自己强迫上下文切换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T21:15:59.827

您也可以在 WPF 中使用旧的[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)（如在 Windows 窗体中）。它将采用 WPF 的线程模型，并提供一个很好的抽象。

# .net - .NET 运行时事件 ID 5000

> ID：199013
> 
> 赞同：1
> 
> 时间：2008-10-13T20:57:10.580
> 
> 标签：.net, exception

有谁知道如何破译 .NET 运行时[事件 ID 5000](http://eventid.net/display.asp?eventid=5000&eventno=7334&source=.NET%20Runtime%202.0%20Error%20Reporting&phase=1)错误？我已经运行记录为：

```
P1:  <assembly name>,exe
P2:  2.1.4.1 (assembly version)
P3:  48b2b154
P4:  System
P5:  2.0.0.0
P6:  471ebf0d
P7:  575
P8:  1d
P9:  n3ctrye2kn3c34sgl4zqyrbfte4m13nb
P10: NIL 
```

我假设这些要么是 CLR VM 的寄存器值，要么是对函数的参数调用？我遇到的谷歌点击似乎在某处有一个异常类型 - 提供了某种线索。从这个，我可以识别出我的一个程序集名称和版本（P1 和 P2），也许还有一个 FX 程序集和版本（P4 和 P5）。其余的，我很难弄清楚。

奇怪的是，看似随机的“n3ctry...”字符串实际上确实[在 Google 上得到了点击](http://www.google.com/search?hl=en&q=n3ctrye2kn3c34sgl4zqyrbfte4m13nb&btnG=Search)，但不足以让我理解它可能是什么。临时文件可能吗？ClickOnce 隔离存储路径？算法是否足够可预测以预期大量冲突？

欢迎提出想法 - 因为这个特定的应用程序处于使生产调试非常困难的环境中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-25T15:06:18.367

这只是您的应用程序内部发生的一个未处理的异常。检测应用程序以记录比 .NET 所做的更多的信息 - 即使您可以获得所有 Px 行的信息，也可能不足以让您对其进行调试。

这个[在荒野中游荡的](http://www.julmar.com/blog/mark/PermaLink,guid,f733e261-5d39-4ca1-be1a-c422f3cf1f1b.aspx)博客条目对如何解决这个问题有很好的建议。简而言之，你需要 hook [appdomain 的 unhandled exception event](http://msdn.microsoft.com/en-us/library/system.appdomain.unhandledexception(VS.80).aspx)。

```
 AppDomain.CurrentDomain.UnhandledException += new UnhandledException... 
```

然后在事件日志之类的地方记录更多信息。关于 ASP.NET 的此事件的[知识库文章 911816](http://support.microsoft.com/?id=911816)包含用于将异常信息转储到可能有帮助的事件日志的示例代码。

# visual-studio - 在 WCF 中设置 ClientCredentials 时出现“对象为只读”错误

> ID：199014
> 
> 赞同：21
> 
> 时间：2008-10-13T20:57:31.110
> 
> 标签：visual-studio, wcf

我有一个名为 ServerClient 的由 Visual Studio（客户端）生成的代理对象。我正在尝试在使用以下代码打开新连接之前设置 ClientCredentials.UserName.UserName/Password：

```
InstanceContext context = new InstanceContext(this);

m_client = new ServerClient(context);
m_client.ClientCredentials.UserName.UserName = "Sample"; 
```

一旦代码到达 UserName 行，它就会失败，并出现“对象是只读的”错误。我知道如果连接已经打开或出现故障，可能会发生这种情况，但此时我还没有调用 context.Open()。

我已将绑定（使用 netTcpBinding）配置为使用 Message 作为其安全模式，并且 MessageClientCredentialType 设置为 UserName。

有任何想法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-11-02T22:56:58.960

我注意到，在为服务创建代理类的实例后，我可以设置一次用户名和密码而不会出错，并成功调用我的 web 服务。然后，当我尝试在现有实例上再次设置用户名和密码时（当然没有必要），我收到您提到的“对象为只读”错误。每个实例生命周期设置一次值对我有用。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-14T13:43:11.517

看来您只能在实例化周期的早期访问这些属性。如果我覆盖代理类 (ServerClient) 中的构造函数，我可以设置这些属性：

```
base.ClientCredentials.UserName.UserName = "Sample"; 
```

我开始感谢那些建议不要使用 VS 提供的自动构建代理的人。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-06-29T14:19:28.233

这是解决方案：

```
using SysSvcmod = System.ServiceModel.Description;

SysSvcmod.ClientCredentials clientCredentials = new SysSvcmod.ClientCredentials();
clientCredentials.UserName.UserName = "user_name";
clientCredentials.UserName.Password = "pass_word";

m_client.ChannelFactory.Endpoint.Behaviors.RemoveAt(1);
m_client.ChannelFactory.Endpoint.Behaviors.Add(clientCredentials); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-28T23:15:20.503

我有类似的代码可以通过`UserName`：

```
 FooServiceClient client = new FooServiceClient("BasicHttpBinding_IFooService");
  client.ClientCredentials.UserName.UserName = "user";
  client.ClientCredentials.UserName.Password = "password"; 
```

尝试在 app.config 中使用绑定名称创建代理。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-10-24T11:21:59.063

正确的语法是：

```
// Remove the ClientCredentials behavior.
client.ChannelFactory.Endpoint.Behaviors.Remove<ClientCredentials>();

// Add a custom client credentials instance to the behaviors collection.
client.ChannelFactory.Endpoint.Behaviors.Add(new MyClientCredentials()); 
```

[http://msdn.microsoft.com/en-us/library/ms730868.aspx](http://msdn.microsoft.com/en-us/library/ms730868.aspx)

它对我有用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-02-03T05:33:29.173

我遇到了同样的问题，当我更改代码时，我的代码开始工作，即在初始化客户端对象后立即为客户端凭据分配值。

这是解决方案，

```
ProductClient Manager = new  ProductClient();    
Manager.ClientCredentials.UserName.UserName = txtUserName.Text;
Manager.ClientCredentials.UserName.Password = txtPassword.Text; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-04-04T14:57:13.697

如果通过->添加服务引用->高级->添加Web引用->Url/wsdl（本地磁盘文件）添加服务引用，则不会出现这种情况。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-10-11T19:57:40.330

我正面临这个问题，我试图创建一个通用方法来为不同的端点创建客户端。

这是我如何实现这一目标的。

```
 public static T CreateClient<T>(string url) where T : class
    {
        EndpointAddress endPoint = new EndpointAddress(url);
        CustomBinding binding = CreateCustomBinding();

        T client = (T)Activator.CreateInstance(typeof(T), new object[] { binding, endPoint });
        SetClientCredentials(client);

        return client;
    }

    public static void SetClientCredentials(dynamic obj)
    {
        obj.ChannelFactory.Endpoint.Behaviors.Remove<ClientCredentials>();
        obj.ChannelFactory.Endpoint.Behaviors.Add(new CustomCredentials());

        obj.ClientCredentials.UserName.UserName = "UserId";
        obj.ClientCredentials.UserName.Password = "Password";
    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-14T10:53:11.767

我认为您的问题可能与 InstanceContext 的使用有关。我认为这只需要来自服务器端的双工通信通道。

我承认我对此不确定，但我认为在这种情况下，您是在告诉客户端使用现有的实例上下文，因此它认为已经有一个正在运行的服务并且不允许更改。

是什么推动了 InstanceContext 的使用？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-12-30T21:11:27.087

如果使用双工客户端，当您实例化它时，您的客户端所派生的 DuplexClientBase 中的 DuplexChannelFactory 将使用现有凭据进行初始化，以便它可以打开回调通道，这就是凭据为只读的原因。

我第二个 Mike 的问题，还问如果您不打算使用 NetTcpBinding 固有的传输级别安全性，为什么还要使用它？也许基于 HTTP 的绑定会更合适？这将允许您使用基于证书的安全性，我相信可以在实例化后对其进行修改（[http://msdn.microsoft.com/en-us/library/ms576164.aspx](http://msdn.microsoft.com/en-us/library/ms576164.aspx)）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-04-12T14:58:55.343

在黑暗中开枪，但 netTcpBinding 是否允许用户名和密码验证？尝试使用 http 绑定使用应用程序层 (SOAP) 安全性

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-10-25T08:43:03.250

或者您可以简单地检查凭据

```
 if (client.ClientCredentials.ClientCertificate.Certificate == null || string.IsNullOrEmpty(client.ClientCredentials.ClientCertificate.Certificate.Thumbprint))
    {
        client.ClientCredentials.ClientCertificate.SetCertificate(
            StoreLocation.LocalMachine,
            StoreName.My,
            X509FindType.FindByThumbprint, ConfigurationManager.AppSettings.Get("CertificateThumbprint"));
    } 
```

# c# - C# 中的 wglCreateContext 失败但在托管 C++ 中没有

> ID：199016
> 
> 赞同：5
> 
> 时间：2008-10-13T20:59:16.567
> 
> 标签：c#, c++, opengl

我正在尝试在 C# 中使用 opengl。我有以下代码失败并出现错误 2000 ERROR_INVALID_PIXEL_FORMAT
第一个定义：

```
[DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true, ExactSpelling = true)]
public static extern IntPtr GetDC(IntPtr hWnd);

[StructLayout(LayoutKind.Sequential)]
    public struct PIXELFORMATDESCRIPTOR
    {
        public void Init()
        {
            nSize = (ushort) Marshal.SizeOf(typeof (PIXELFORMATDESCRIPTOR));
            nVersion = 1;
            dwFlags = PFD_FLAGS.PFD_DRAW_TO_WINDOW | PFD_FLAGS.PFD_SUPPORT_OPENGL | PFD_FLAGS.PFD_DOUBLEBUFFER | PFD_FLAGS.PFD_SUPPORT_COMPOSITION;
            iPixelType = PFD_PIXEL_TYPE.PFD_TYPE_RGBA;
            cColorBits = 24;
            cRedBits = cRedShift = cGreenBits = cGreenShift = cBlueBits = cBlueShift = 0;
            cAlphaBits = cAlphaShift = 0;
            cAccumBits = cAccumRedBits = cAccumGreenBits = cAccumBlueBits = cAccumAlphaBits = 0;
            cDepthBits = 32;
            cStencilBits = cAuxBuffers = 0;
            iLayerType = PFD_LAYER_TYPES.PFD_MAIN_PLANE;
            bReserved = 0;
            dwLayerMask = dwVisibleMask = dwDamageMask = 0;
        }
        ushort nSize;
        ushort nVersion;
        PFD_FLAGS dwFlags;
        PFD_PIXEL_TYPE iPixelType;
        byte cColorBits;
        byte cRedBits;
        byte cRedShift;
        byte cGreenBits;
        byte cGreenShift;
        byte cBlueBits;
        byte cBlueShift;
        byte cAlphaBits;
        byte cAlphaShift;
        byte cAccumBits;
        byte cAccumRedBits;
        byte cAccumGreenBits;
        byte cAccumBlueBits;
        byte cAccumAlphaBits;
        byte cDepthBits;
        byte cStencilBits;
        byte cAuxBuffers;
        PFD_LAYER_TYPES iLayerType;
        byte bReserved;
        uint dwLayerMask;
        uint dwVisibleMask;
        uint dwDamageMask;
    }

    [Flags]
    public enum PFD_FLAGS : uint 
    {
        PFD_DOUBLEBUFFER = 0x00000001,
        PFD_STEREO = 0x00000002,
        PFD_DRAW_TO_WINDOW = 0x00000004,
        PFD_DRAW_TO_BITMAP = 0x00000008,
        PFD_SUPPORT_GDI = 0x00000010,
        PFD_SUPPORT_OPENGL = 0x00000020,
        PFD_GENERIC_FORMAT = 0x00000040,
        PFD_NEED_PALETTE = 0x00000080,
        PFD_NEED_SYSTEM_PALETTE = 0x00000100,
        PFD_SWAP_EXCHANGE = 0x00000200,
        PFD_SWAP_COPY = 0x00000400,
        PFD_SWAP_LAYER_BUFFERS = 0x00000800,
        PFD_GENERIC_ACCELERATED = 0x00001000,
        PFD_SUPPORT_DIRECTDRAW = 0x00002000,
        PFD_DIRECT3D_ACCELERATED = 0x00004000,
        PFD_SUPPORT_COMPOSITION = 0x00008000,
        PFD_DEPTH_DONTCARE = 0x20000000,
        PFD_DOUBLEBUFFER_DONTCARE = 0x40000000,
        PFD_STEREO_DONTCARE = 0x80000000
    }

    public enum PFD_LAYER_TYPES : byte
    {
        PFD_MAIN_PLANE = 0,
        PFD_OVERLAY_PLANE = 1,
        PFD_UNDERLAY_PLANE = 255
    }

    public enum PFD_PIXEL_TYPE : byte
    {
        PFD_TYPE_RGBA = 0,
        PFD_TYPE_COLORINDEX = 1
    }

    [DllImport("gdi32.dll", CharSet = CharSet.Auto, SetLastError = true, ExactSpelling = true)]
    public static extern int ChoosePixelFormat(IntPtr hdc, [In] ref PIXELFORMATDESCRIPTOR ppfd);

    [DllImport("gdi32.dll", CharSet = CharSet.Auto, SetLastError = true, ExactSpelling = true)]
    public static extern bool SetPixelFormat(IntPtr hdc, int iPixelFormat, ref PIXELFORMATDESCRIPTOR ppfd);
[DllImport("opengl32.dll", CharSet = CharSet.Auto, SetLastError = true, ExactSpelling = true)]
    public static extern IntPtr wglCreateContext(IntPtr hDC); 
```

现在失败的代码：

```
IntPtr dc = Win.GetDC(hwnd);

var pixelformatdescriptor = new GL.PIXELFORMATDESCRIPTOR();
pixelformatdescriptor.Init();

var pixelFormat = GL.ChoosePixelFormat(dc, ref pixelformatdescriptor);
if(!GL.SetPixelFormat(dc, pixelFormat, ref pixelformatdescriptor))
    throw new Win32Exception(Marshal.GetLastWin32Error());
IntPtr hglrc;
if((hglrc = GL.wglCreateContext(dc)) == IntPtr.Zero)
    throw new Win32Exception(Marshal.GetLastWin32Error()); //<----- here I have exception 
```

托管 C++ 中的相同代码正在运行

```
HDC dc = GetDC(hWnd);

PIXELFORMATDESCRIPTOR pf;
pf.nSize = sizeof(PIXELFORMATDESCRIPTOR);
pf.nVersion = 1;
pf.dwFlags = PFD_DRAW_TO_WINDOW | PFD_SUPPORT_OPENGL | PFD_DOUBLEBUFFER | PFD_SUPPORT_COMPOSITION;
pf.cColorBits = 24;
pf.cRedBits = pf.cRedShift = pf.cGreenBits = pf.cGreenShift = pf.cBlueBits = pf.cBlueShift = 0;
pf.cAlphaBits = pf.cAlphaShift = 0;
pf.cAccumBits = pf.cAccumRedBits = pf.cAccumGreenBits = pf.cAccumBlueBits = pf.cAccumAlphaBits = 0;
pf.cDepthBits = 32;
pf.cStencilBits = pf.cAuxBuffers = 0;
pf.iLayerType = PFD_MAIN_PLANE;
pf.bReserved = 0;
pf.dwLayerMask = pf.dwVisibleMask = pf.dwDamageMask = 0;

int ipf = ChoosePixelFormat(dc, &pf);
SetPixelFormat(dc, ipf, &pf);

HGLRC hglrc = wglCreateContext(dc); 
```

我已经在带有 ATI 显卡的 VIsta 64 位和带有 Nvidia 的 Windows XP 32 位上进行了尝试，两种情况下的结果都相同。
另外我想提一下，我不想使用任何已经编写好的框架。

谁能告诉我导致异常的 C# 代码中的错误在哪里？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-15T23:48:01.327

找到解决方案。
问题非常奇怪丑陋，真的很难找到。在互联网上的某个地方，我发现当您在编译 c++ 应用程序时链接 opengl32.lib 时，它必须放在 gdi32.lib 之前。其原因是（据说）opengl32.dll 正在覆盖 ChoosePixelFormat 和 SetPixelFormat 函数（可能还有更多:-)。正如我在我的 c++ 版本中发现的那样，不小心出现了这种情况。
嘿，但是如何在 C# 中做到这一点
经过几天的搜索，我发现在[tao 框架](http://www.taoframework.com/)中，他们使用 kernel32.dll LoadLibrary() 函数解决了它，并在调用 SetPixelFormat 之前加载了 opengl32.dll

```
public static bool SetPixelFormat(IntPtr deviceContext, int pixelFormat, ref PIXELFORMATDESCRIPTOR pixelFormatDescriptor) {
        Kernel.LoadLibrary("opengl32.dll");
        return _SetPixelFormat(deviceContext, pixelFormat, ref pixelFormatDescriptor);
    } 
```

所以我们知道opengl32.dll必须在gdi32.dll之前加载，有没有其他方法可以做到这一点。过了一会儿，我想我们可以从 opengl32.dll 调用一些 NOP 函数来加载它。例如：

```
[DllImport("opengl32.dll", EntryPoint = "glGetString", CharSet = CharSet.Auto, SetLastError = true, ExactSpelling = true)]
static extern IntPtr _glGetString(StringName name);
public static string glGetString(StringName name)
{
    return Marshal.PtrToStringAnsi(_glGetString(name));
}
public enum StringName : uint
{
    GL_VENDOR = 0x1F00,
    GL_RENDERER = 0x1F01,
    GL_VERSION = 0x1F02,
    GL_EXTENSIONS = 0x1F03
} 
```

在应用程序开始时，在调用 gdi32.dll 之前，我使用这个：

```
GL.glGetString(0); 
```

两种方式都可以解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T17:37:04.137

我现在无法对此进行测试，但我的第一个怀疑是结构包装。您是否尝试在 StructLayout 属性中将包装设置为 1？例如：

```
[StructLayout(LayoutKind.Sequential, Pack=1)] 
```

干杯，布赖恩

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-16T20:12:27.060

调用 wglCreateContext 两次也有帮助。

```
if (SetPixelFormat(DC, iPixelformat, ref pfd) == false)
    throw new Win32Exception(Marshal.GetLastWin32Error());

RC = wglCreateContext(DC);
if (RC == HGLRC.Zero)
{   
    if (SetPixelFormat(DC, iPixelformat, ref pfd) == false)
        throw new Win32Exception(Marshal.GetLastWin32Error());
    RC = wglCreateContext(DC);
    if (RC == HGLRC.Zero)
        throw new Win32Exception(Marshal.GetLastWin32Error());
} 
```

# php - PHP 中严格的 HTML 验证和过滤

> ID：199017
> 
> 赞同：17
> 
> 时间：2008-10-13T21:00:04.523
> 
> 标签：php, html, security, validation, xss

我正在寻找对用户提交的 HTML 执行严格（白名单）验证/过滤的最佳实践。

主要目的是过滤掉可能通过 Web 表单输入的 XSS 和类似的恶意软件。次要目的是限制非技术用户输入的 HTML 内容的破坏，例如通过具有 HTML 视图的 WYSIWYG 编辑器。

我正在考虑使用[HTML Purifier](http://htmlpurifier.org)，或者通过使用 HTML DOM 解析器来完成我自己的流程，例如 HTML(dirty)->DOM(dirty)->filter->DOM(clean)->HTML(clean)。

你能描述这些或任何更简单有效的策略的成功吗？有什么需要注意的陷阱吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-13T21:39:12.040

我已经在 HTML Purifier 上测试了我所知道的所有漏洞，它做得很好。它不仅过滤 HTML，还过滤 CSS 和 URL。

一旦你将元素和属性缩小到无害的元素和属性，缺陷就在于属性内容——`javascript:`伪 URL（IE 允许协议名称中的制表符——`java&#09;script:`仍然有效）和触发 JS 的 CSS 属性。

URL 的解析可能很棘手，例如这些是有效的：`http://spoof.com:xxx@evil.com`或`//evil.com`. 国际化域 (IDN) 可以用两种方式编写——Unicode 和 punycode。

使用[HTML Purifier——](http://htmlpurifier.org)它已经解决了大部分问题。如果您只想修复损坏的 HTML，请使用 HTML Tidy（可作为 PHP 扩展使用）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-13T21:19:54.060

用户提交的 HTML 并不总是有效的，或者确实是完整的。浏览器会解释大量无效的 HTML，你应该确保你能捕捉到它。

还要注意有效的外观：

```
<img src="http://www.mysite.com/logout" /> 
```

和

```
<a href="javascript:alert('xss hole');">click</a> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T22:08:31.310

我成功使用了 HTML Purifier，并且没有通过任何 xss 或其他不需要的输入过滤器。我还通过 Tidy 扩展运行净化 HTML 以确保它也可以验证。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-13T21:35:25.293

W3C 有一个用于验证 HTML 的大型开源包，可在此处获取：

[http://validator.w3.org/](http://validator.w3.org/)

您可以自己下载该软件包，并可能实现他们正在做的任何事情。不幸的是，似乎很多 DOM 解析器似乎愿意改变规则来“在野外”分配 HTML 代码，所以最好让大师告诉你哪里出了问题，而不是让其自行处理。一个更实用的工具——有很多网站*并不*完美，不兼容 HTML，但我们仍然每天都在使用。

# php - PHP PEAR Spreadsheet_Excel_Writer 发送一个空文件

> ID：199035
> 
> 赞同：2
> 
> 时间：2008-10-13T21:07:16.303
> 
> 标签：php, export-to-excel, pear

有人用过[Pear: Spreadsheet_Excel_Writer](http://pear.php.net/package/Spreadsheet_Excel_Writer/)吗？

[格式化教程](http://pear.php.net/manual/en/package.fileformats.spreadsheet-excel-writer.intro-format.php)列出了一个类似于我正在使用的脚本：（修剪）

```
<?php
require_once 'Spreadsheet/Excel/Writer.php';
$workbook = new Spreadsheet_Excel_Writer();

$worksheet =& $workbook->addWorksheet();
$worksheet->write(0, 0, "Quarterly Profits for Dotcom.Com");

$workbook->send('test.xls');
$workbook->close();
?> 
```

到目前为止，我认为我对此的了解...
`$workbook->send('test.xls');`设置了 Excel 文件传输的标题。现在，似乎没有出现错误，但下载的文件完全是空的（即使在十六进制编辑器中）。

所以......应该
在哪里（在什么类/方法中）`$workbook`编写二进制文件？或者，我误解了这一切？

**注意**：老实说，我不知道使用的是什么版本的 Spreadsheet_Excel_Writer；来源不包括这些有用的信息。
我可以告诉你版权是***2002-2003***；所以，从 0.1 到 0.6 的任何地方。

[**编辑**] 抱歉，我以为我在某处提到过这个。这是别人的脚本，我被分配修复。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T22:01:54.070

这是一些示例代码：

```
<?php
require_once 'Spreadsheet/Excel/Writer.php';
$workbook = new Spreadsheet_Excel_Writer('test.xls');
$worksheet =& $workbook->addWorksheet('My first worksheet');
if (PEAR::isError($worksheet)) {
    die($worksheet->getMessage());
}
$workbook->close();
?> 
```

我认为对于初学者来说，给你的工作表一个名字并尝试直接写一个文件（不带`send()`）。

此外，请确保使用您调用的所有方法，使用`PEAR::isError()`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-20T03:16:51.403

不是很清楚，但我认为发送命令只创建具有正确内容类型和文件名的标题。之后您必须发送数据，例如

```
$tmpDocument = '/path/to/tmp/file.xls';
$workbook = new Spreadsheet_Excel_Writer($tmpDocument); 
```

/* 生成 XLS 文件的代码 */

```
$workbook->close();
$workbook->send('Report.xls');
readfile($tmpDocument); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T22:21:31.707

send() 发送缓存控制标头和内容类型标头，但不发送内容。正如我从代码中理解的那样，当调用 $workbook->close() 时，内容是发送的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-24T18:13:50.260

使用它在浏览器中下载工作表

```
$workbook = new Spreadsheet_Excel_Writer(); // <-- leave parantheses empty
$workbook->send($DownloadFileName);
// Your fancy spreadsheet generating code
$workbook->close(); 
```

并将其写入文件。

```
$workbook = new Spreadsheet_Excel_Writer($SaveFileName);
// Your fancy spreadsheet generating code
$workbook->close(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-15T19:48:31.043

您需要将工作表命名为`$worksheet =& $workbook->addWorksheet();`。
检查下面的代码：

```
require_once 'Spreadsheet/Excel/Writer.php';

//Create a workbook
$workbook = new Spreadsheet_Excel_Writer(); //() must be empty or your downloaded file will be corrupt.

// Create a worksheet 
$worksheet =& $workbook->addWorksheet('test'); <-- You forgot to name your worksheet in your code, yours is "addWorksheet()"

// The actual data 
$worksheet->write(0, 0, 'Name'); 
$worksheet->write(0, 1, 'Age'); 
$worksheet->write(1, 0, 'John Smith'); 
$worksheet->write(1, 1, 30);
$worksheet->write(2, 0, 'Johann Schmidt');
$worksheet->write(2, 1, 31); $worksheet->write(3, 0, 'Juan Herrera');
$worksheet->write(3, 1, 32);

// send HTTP headers 
$workbook->send('prueba.xls');

// Let's send the file
$workbook->close(); 
```

# ruby-on-rails - 如何更新通过 git 但在 svn repo 中安装的 rails 插件？

> ID：199044
> 
> 赞同：3
> 
> 时间：2008-10-13T21:12:09.617
> 
> 标签：ruby-on-rails, svn, git, plugins

我的 rails 应用程序位于 svn 存储库中，但其中一些插件是通过 git 安装的，后来添加到 svn 存储库中。如何更新这些插件？我似乎无法让脚本/插件更新来做任何事情。我真的很想更新 activemerchant 以摆脱 Inflector 警告。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-10T19:45:15.057

如果你已经有一个插件的静态副本签入到 Subversion，通过 更新它可能会很痛苦`script/plugin`，所以这就是我最终要做的，以便在一个 Subversion 提交中将它从静态安装切换到 Git 签出：

```
git clone git://github.com/foo/bar.git ~/foobar
mv ~/foobar/.git rails_app/vendor/plugins/foobar/.git
rm -rf ~/foobar
cd rails_app/vendor/plugins
git reset --hard 
```

然后确保将`.git`所有其他已更改的内容添加到 Subversion 项目中，您将是最新的。您可以使用其他 git 命令来拉取更新、移动到不同的分支等。然后在它们处于您想要的状态时再次签入。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-18T18:25:16.547

如果您没有对插件进行任何本地更改，并且您不需要跟踪更新将带来的更改，您可以再次运行，如果需要`script/plugin install`，可以传入。`--force`例如：

```
script/plugin install --force git://github.com/dchelimsky/rspec.git 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-17T17:44:57.363

在这种情况下我会做一件事，我删除插件目录然后我提交给 SVN，这将删除 repo 中的旧插件。（我通常将它移动到 tmp 目录中，以防万一，等新的工作正常后将其延迟）然后我重新安装插件的新版本，并再次提交。简单的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T18:41:57.517

为了让 Git 能够将存储库识别为 Git 存储库，您需要将`.git`子目录及其下的所有内容也添加到 Subversion。否则，插件看起来就像另一堆源代码，Git 会说它“不是 Git 存储库”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T08:11:55.633

您应该能够导航到插件的目录并点击： `git pull` 。我很确定`script/install plugin`只是从 git repo 中检查代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-25T08:59:53.287

遇到同样的情况并使用了这个解决方案：将回形针作为插件安装在 svn repo 中，作为我应用程序的一部分。现在我想改用最新版本，并且没有更改任何回形针插件，因此我可以轻松地将其从 app/svn 中删除，并将其安装为 gem。完毕。

# php - 是否有与 Perl 的 WWW::Mechanize 等效的 PHP？

> ID：199045
> 
> 赞同：25
> 
> 时间：2008-10-13T21:12:14.310
> 
> 标签：php, automation, screen-scraping, mechanize, www-mechanize

我正在寻找一个功能类似于 Perl 的[WWW::Mechanize](http://search.cpan.org/dist/WWW-Mechanize/lib/WWW/Mechanize.pm#SYNOPSIS)的库，但适用于 PHP。基本上，它应该允许我使用简单的语法提交 HTTP GET 和 POST 请求，然后解析结果页面并以简单的格式返回所有表单及其字段，以及页面上的所有链接。

我知道 CURL，但它有点太简单了，而且语法很丑（大量的`curl_foo($curl_handle, ...)`语句

**澄清：**

我想要比目前的答案更高级的东西。例如，在 Perl 中，您可以执行以下操作：

```
# navigate to the main page
$mech->get( 'http://www.somesite.com/' ); 

# follow a link that contains the text 'download this'
$mech->follow_link( text_regex => qr/download this/i );

# submit a POST form, to log into the site
$mech->submit_form(
    with_fields      => {
        username    => 'mungo',
        password    => 'lost-and-alone',
    }
);

# save the results as a file
$mech->save_content('somefile.zip'); 
```

要使用 HTTP_Client 或 wget 或 CURL 做同样的事情会做很多工作，我必须手动解析页面以查找链接、查找表单 URL、提取所有隐藏字段等等。我要求使用 PHP 解决方案的原因是我没有使用 Perl 的经验，我可能会通过大量工作来构建我需要的东西，但如果我能在 PHP 中完成上述操作会快得多。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-13T23:11:50.980

SimpleTest 的[ScriptableBrowser](http://simpletest.sourceforge.net/en/browser_documentation.html)可以独立于测试框架使用。我已经将它用于许多自动化工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-07-04T09:40:50.707

我觉得有必要回答这个问题，即使它是一个旧帖子......我一直在使用 PHP curl 并且它在任何地方都不如我正在切换到的 WWW:Mechanize 之类的东西好（我认为我将使用 Ruby 语言实现）.. Curl 已经过时了，因为它需要太多“繁重的工作”来自动化任何东西，最简单的可脚本化浏览器对我来说看起来很有希望，但在测试它时，它不会在大多数网络上工作我尝试过的表格......老实说，我认为 PHP 在这类抓取、网络自动化方面缺乏，所以最好看看另一种语言，只是想发布这个，因为我在这个主题上花费了无数小时，也许它将来会为别人节省一些时间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-07-08T08:38:34.083

现在是 2016 年，还有[Mink](http://mink.behat.org/en/latest/at-a-glance.html)。它甚至支持不同的引擎，从无头纯 PHP“浏览器”（没有 JavaScript）、Selenium（需要像 Firefox 或 Chrome 这样的浏览器）到 NPM 中的无头“browser.js”，它确实支持 JavaScript。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T21:14:55.880

尝试查看 PEAR 库。如果一切都失败了，请为 curl 创建一个对象包装器。

你可以像这样简单：

```
class curl {
    private $resource;

    public function __construct($url) {
        $this->resource = curl_init($url);
    }

    public function __call($function, array $params) {
        array_unshift($params, $this->resource);
        return call_user_func_array("curl_$function", $params);
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T21:57:30.100

尝试以下方法之一：

*   PEAR 的[HTTP_Request](http://pear.php.net/package/HTTP_Request)
*   [Zend_Http_Client](http://framework.zend.com/manual/en/zend.http.html#zend.http.client)

（是的，它是 ZendFramework 代码，但它不会让你的类使用它变慢，因为它只是加载所需的库。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-13T23:03:01.280

查看史努比：http: [//sourceforge.net/projects/snoopy/](http://sourceforge.net/projects/snoopy/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-13T23:12:29.763

Curl 是处理简单请求的方式。它跨平台运行，具有 PHP 扩展，并被广泛采用和测试。

我创建了一个不错的类，它可以通过调用 CurlHandler::Get($url, $data) || 获取和发布数据数组（包括文件！）到 url CurlHandler::Post($url, $data)。还有一个可选的 HTTP 用户身份验证选项 :)

```
/**
 * CURLHandler handles simple HTTP GETs and POSTs via Curl 
 * 
 * @package Pork
 * @author SchizoDuckie
 * @copyright SchizoDuckie 2008
 * @version 1.0
 * @access public
 */
class CURLHandler
{

    /**
     * CURLHandler::Get()
     * 
     * Executes a standard GET request via Curl.
     * Static function, so that you can use: CurlHandler::Get('http://www.google.com');
     * 
     * @param string $url url to get
     * @return string HTML output
     */
    public static function Get($url)
    {
       return self::doRequest('GET', $url);
    }

    /**
     * CURLHandler::Post()
     * 
     * Executes a standard POST request via Curl.
     * Static function, so you can use CurlHandler::Post('http://www.google.com', array('q'=>'StackOverFlow'));
     * If you want to send a File via post (to e.g. PHP's $_FILES), prefix the value of an item with an @ ! 
     * @param string $url url to post data to
     * @param Array $vars Array with key=>value pairs to post.
     * @return string HTML output
     */
    public static function Post($url, $vars, $auth = false) 
    {
       return self::doRequest('POST', $url, $vars, $auth);
    }

    /**
     * CURLHandler::doRequest()
     * This is what actually does the request
     * <pre>
     * - Create Curl handle with curl_init
     * - Set options like CURLOPT_URL, CURLOPT_RETURNTRANSFER and CURLOPT_HEADER
     * - Set eventual optional options (like CURLOPT_POST and CURLOPT_POSTFIELDS)
     * - Call curl_exec on the interface
     * - Close the connection
     * - Return the result or throw an exception.
     * </pre>
     * @param mixed $method Request Method (Get/ Post)
     * @param mixed $url URI to get or post to
     * @param mixed $vars Array of variables (only mandatory in POST requests)
     * @return string HTML output
     */
    public static function doRequest($method, $url, $vars=array(), $auth = false)
    {
        $curlInterface = curl_init();

        curl_setopt_array ($curlInterface, array( 
            CURLOPT_URL => $url,
            CURLOPT_RETURNTRANSFER => 1,
            CURLOPT_FOLLOWLOCATION =>1,
            CURLOPT_HEADER => 0));
        if (strtoupper($method) == 'POST')
        {
            curl_setopt_array($curlInterface, array(
                CURLOPT_POST => 1,
                CURLOPT_POSTFIELDS => http_build_query($vars))
            );  
        }
        if($auth !== false)
        {
              curl_setopt($curlInterface, CURLOPT_USERPWD, $auth['username'] . ":" . $auth['password']);
        }
        $result = curl_exec ($curlInterface);
        curl_close ($curlInterface);

        if($result === NULL)
        {
            throw new Exception('Curl Request Error: '.curl_errno($curlInterface) . " - " . curl_error($curlInterface));
        }
        else
        {
            return($result);
        }
    }

}

?> 
```

[编辑] 现在才阅读说明......您可能想要使用上面提到的自动化工具之一。您还可以决定使用像[ChickenFoot](http://groups.csail.mit.edu/uid/chickenfoot/examples.html)这样的客户端 Firefox 扩展，以获得更大的灵活性。我将把上面的示例类留在这里以供将来搜索。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-03-02T14:44:14.593

如果您在项目中使用 CakePHP，或者如果您倾向于提取相关库，您可以使用他们的 curl 包装器 HttpSocket。它具有您描述的简单页面获取语法，例如，

```
# This is the sugar for importing the library within CakePHP       
App::import('Core', 'HttpSocket');
$HttpSocket = new HttpSocket();

$result = $HttpSocket->post($login_url,
array(
  "username" => "username",
  "password" => "password"
)
); 
```

...虽然它没有办法解析响应页面。为此，我将使用 simplehtmldom：[http](http://net.tutsplus.com/tutorials/php/html-parsing-and-screen-scraping-with-the-simple-html-dom-library/) ://net.tutsplus.com/tutorials/php/html-parsing-and-screen-scraping-with-the-simple-html-dom-library/它将自己描述为具有类似 jQuery 的语法。

我倾向于同意，底线是 PHP 没有 Perl/Ruby 所拥有的出色的抓取/自动化库。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-13T22:10:35.537

如果您在 *nix 系统上，您可以将 shell_exec() 与 wget 一起使用，它有很多不错的选项。

# javascript - 如何使用 JQuery 选择鼠标悬停的对象？

> ID：199046
> 
> 赞同：3
> 
> 时间：2008-10-13T21:12:58.367
> 
> 标签：javascript, jquery

我有一个动态生成的具有类属性但没有 id 的 div 标签列表。

如何选择鼠标光标悬停的那个？在 CSS 中它会是这样的： div.classname:hover

哦，我不想使用任何额外的 Jquery 插件。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-13T21:15:55.303

```
$('div.classname').hover(
    function mouseover() { /* do something */}, 
    function mouseout()  { /* do other thing */}
); 
```

编辑：谢谢，弥迦！

# artificial-intelligence - 机器学习、人工智能和软计算

> ID：199056
> 
> 赞同：6
> 
> 时间：2008-10-13T21:15:45.083
> 
> 标签：artificial-intelligence, machine-learning

这三个高度相关的领域之间有什么区别？是否有一个特定的整体，它们都是（除了 CS）的一部分？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-05T00:58:46.237

人工智能是试图在计算机中捕捉人类智能的所有方面的智力项目。一个不同的项目，也称为人工智能，试图使用受人类启发的算法来近似传统上难以解决的问题。可以说人工智能涵盖了机器人、规划、推理、学习和自然语言理解等领域。

机器学习是一门尝试在给定示例的情况下提高机器执行任务性能的学科。它可以被认为是在人工智能的兴趣范围内，但机器学习的研究人员不需要在人工智能的整体成功中拥有智力利益。机器学习与统计物理学和某些信号处理主题有密切的重叠，某些公式与规划、控制理论和动态规划有很强的重叠。

软计算涉及涉及间接、近似解决方案而不是二进制算法的过程，被广泛认为包括模糊逻辑、神经网络和遗传算法等技术。这些技术与人工智能、控制理论、复杂系统理论等的特定规划和学习子集之间存在广泛的重叠。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-13T21:46:08.703

机器学习*可以*被认为是人工智能的一部分，但是我将机器学习归类为对创建语义模型和自适应行为的研究，而人工智能是具有智能行为的系统的整体科学。

大多数被称为“人工智能”的东西都相当简单，但非常有效，例如启发式等。

软计算并没有像它有许多 ML 和 AI 组件那样下降，因为它更多地是关于复杂系统的分析。不过我可能是错的。与计算机科学中的大多数事情一样，你挖掘得越深，你就越会发现这一切都是相关的。

# python - 在大写字母前插入空格的pythonic方法

> ID：199059
> 
> 赞同：25
> 
> 时间：2008-10-13T21:16:40.043
> 
> 标签：python, regex, text-files

我有一个文件，我正在通过 python 脚本更改其格式。我在这个文件中有几个驼峰式字符串，我只想在大写字母之前插入一个空格 - 所以“WordWordWord”变成了“Word Word Word”。

我有限的正则表达式经验让我停滞不前 - 有人能想出一个像样的正则表达式来做到这一点，或者（更好）有没有一种我缺少的更 Pythonic 的方式来做到这一点？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-13T21:20:55.540

你可以试试：

```
>>> re.sub(r"(\w)([A-Z])", r"\1 \2", "WordWordWord")
'Word Word Word' 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-10-13T21:37:39.550

如果有连续的大写字母，则 Gregs 结果可能不是您要查找的结果，因为 \w 消耗了要替换的大写字母前面的字符。

```
>>> re.sub(r"(\w)([A-Z])", r"\1 \2", "WordWordWWWWWWWord")
'Word Word WW WW WW Word' 
```

回头看可以解决这个问题：

```
>>> re.sub(r"(?<=\w)([A-Z])", r" \1", "WordWordWWWWWWWord")
'Word Word W W W W W W Word' 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-13T21:41:49.087

看看我在*[.NET 上的回答 - 如何将“大写”分隔的字符串拆分为数组？](https://stackoverflow.com/questions/155303/net-how-can-you-split-a-caps-delimited-string-into-an-array#155487)*

**编辑：**也许最好把它包括在这里。

```
re.sub(r'([a-z](?=[A-Z])|[A-Z](?=[A-Z][a-z]))', r'\1 ', text) 
```

例如：

```
"SimpleHTTPServer" => ["Simple", "HTTP", "Server"] 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-13T22:17:14.430

也许更短：

```
>>> re.sub(r"\B([A-Z])", r" \1", "DoIThinkThisIsABetterAnswer?") 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-08-20T05:02:51.473

也许您会对不使用正则表达式的单行实现感兴趣：

```
''.join(' ' + char if char.isupper() else char.strip() for char in text).strip() 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-13T21:25:17.297

使用正则表达式，您可以这样做：

```
re.sub('([A-Z])', r' \1', str) 
```

当然，这只适用于 ASCII 字符，如果你想做 Unicode，那是一个全新的蠕虫罐头 :-)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-10-15T21:14:16.267

如果您有首字母缩写词，您可能不希望它们之间有空格。这个两阶段的正则表达式将保持首字母缩写词的完整性（并且还将标点符号和其他非大写字母视为添加空格的内容）：

```
re_outer = re.compile(r'([^A-Z ])([A-Z])')
re_inner = re.compile(r'(?<!^)([A-Z])([^A-Z])')
re_outer.sub(r'\1 \2', re_inner.sub(r' \1\2', 'DaveIsAFKRightNow!Cool')) 
```

输出将是：`'Dave Is AFK Right Now! Cool'`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T05:51:10.473

我同意正则表达式解决方案是最简单的，但我不会说它是最 Pythonic 的。

怎么样：

```
text = 'WordWordWord'
new_text = ''

for i, letter in enumerate(text):
    if i and letter.isupper():
        new_text += ' '

    new_text += letter 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-14T09:06:22.747

我认为正则表达式是这里的方法，但只是为了提供一个纯 python 版本，没有（希望）ΤZΩΤZΙΟΥ 指出的任何问题：

```
def splitCaps(s):
    result = []
    for ch, next in window(s+" ", 2):
        result.append(ch)
        if next.isupper() and not ch.isspace():
            result.append(' ')
    return ''.join(result) 
```

window() 是我用来对项目的滑动窗口进行操作的实用函数，定义为：

```
import collections, itertools

def window(it, winsize, step=1):
    it=iter(it)  # Ensure we have an iterator
    l=collections.deque(itertools.islice(it, winsize))
    while 1:  # Continue till StopIteration gets raised.
        yield tuple(l)
        for i in range(step):
            l.append(it.next())
            l.popleft() 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-15T18:59:10.647

对于旧线程 - 想为我的一个要求尝试一个选项。当然这`re.sub()`是一个很酷的解决方案，但如果没有（或不应该）导入 re 模块，也会得到一个 1 班轮。

```
st = 'ThisIsTextStringToSplitWithSpace'
print(''.join([' '+ s if s.isupper()  else s for s in st]).lstrip()) 
```

# javascript - JavaScript 假字典

> ID：199065
> 
> 赞同：1
> 
> 时间：2008-10-13T21:18:23.970
> 
> 标签：javascript, arrays, dictionary, associative-array

我已经以这样一种方式声明了 Javascript 数组，然后我可以通过一个键访问它们，但那是很久以前的事了，我已经忘记了我是如何做到的。

基本上，我有两个要存储的字段，一个唯一键和它的值。我知道有办法做到这一点..像：

```
var jsArray = new {key: 'test test', value: 'value value'},
              new {key: 'test 2', value: 'value 2'}; 
```

并访问如下：

```
value = jsArray[key] 
```

有人可以提醒我吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-13T21:22:52.853

您可以通过不同的方式进行操作：

```
var a = {'a':0, 'b':1, 'c':2};

var b = new Array();
b['a'] = 0;
b['b'] = 1;
b['c'] = 2;

var c = new Object();
c.a = 0;
c.b = 1;
c.c = 2; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T21:25:11.477

```
var myFancyDictionary = {
  key: 'value',
  anotherKey: 'anotherValue',
  youGet: 'the idea'
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T21:27:37.790

如果您已经在使用 Prototype，请尝试使用它的 Hash。如果使用 jQuery，请尝试使用 Map。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-10-13T21:34:16.887

这是一个提供简单字典的 JavaScript 类。

```
if( typeof( rp ) == "undefined" ) rp = {};

rp.clientState = new function()
{
    this.items = new Object();
    this.length = 0;

    this.set = function( key, value )
    {
        if ( ! this.keyExists( key ) )
        {
            this.length++;
        }
        this.items[ key ] = value;    
    }

    this.get = function( key )
    {
        if ( this.keyExists( key ) )
        {
            return this.items[ key ];
        } 
    }

    this.keyExists = function( key )
    {
        return typeof( this.items[ key ] ) != "undefined"; 
    }

    this.remove = function( key )
    {
        if ( this.keyExists( key ) )
        {
            delete this.items[ key ];
            this.length--;   
            return true;
        }
        return false;
    }

    this.removeAll = function()
    {
        this.items = null;
        this.items = new Object();
        this.length = 0;
    }
} 
```

示例使用：

```
// Add a value pair.
rp.clientState.set( key, value );

// Fetch a value.
var x = rp.clientState.Get( key );

// Check to see if a key exists.
if ( rp.clientState.keyExists( key ) 
{
    // Do something.
}

// Remove a key.
rp.clientState.remove( key );

// Remove all keys.
rp.clientState.removeAll(); 
```

# flash - 在 swf 文件中嵌入二进制视频数据

> ID：199068
> 
> 赞同：3
> 
> 时间：2008-10-13T21:19:02.487
> 
> 标签：flash, actionscript-3, air, flv, embedding

是否可以在编译时（使用元标记）从嵌入 swf 的数据中播放视频`[Embed]`？

Flash CS3 等提供的“导入视频->嵌入”功能是不可接受的，因为它有许多严重的限制（包括声音同步问题、最大帧数和其他警告）

我对能够将 flv 视频数据捆绑到 swf（以及其他资产）中感兴趣，这将由 AIR 应用程序播放。

我不认为它可以做到。有人不同意吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-03-27T09:47:45.710

只要您的视频是 FLV，那么答案是肯定的 - 您可以使用`NetStream.appendBytes()`嵌入式播放`ByteArray`：

```
public class Main extends MovieClip
{
    [Embed(source="sample.flv", mimeType="application/octet-stream")]
    private var SampleVideo:Class;

    public function Main():void 
    {
        var video:Video = new Video(320, 240);
        addChild(video);

        var netConnection:NetConnection = new NetConnection();
        netConnection.connect(null);
        var netStream:NetStream = new NetStream(netConnection);
        netStream.client = {};
        video.attachNetStream(netStream);

        var byteArray:ByteArray = new SampleVideo();
        netStream.play(null);
        netStream.appendBytes(byteArray);
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T21:41:29.493

您可以使用 Flash IDE 将 flv 导入 swf 文件——我以前做过。您可以像声音一样将它放到 MovieClip 的时间轴上，然后将该movieclip 放到舞台上播放。在 Flash CS3 中执行 File>Import>Import Video 并选择 flv。选择视频，然后在向导的下一站选择“嵌入.....”，这是[Adob​​e 开发人员中心关于将 flvs 嵌入 swfs 的文章](http://www.adobe.com/devnet/flash/articles/video_guide_02.html#embedding)的链接。

我自己没有这样做，但我看不出为什么你可以从加载的 swf 的库中访问 flv。

仅供参考：看起来这是一个被推迟的错误。Adobe 目前似乎不允许使用 Embed 元标记进行嵌入。这是有关该问题的[论坛帖子和](http://www.kirupa.com/forum/showthread.php?t=274183)[错误跟踪器](https://bugs.adobe.com/jira/browse/SDK-259)的链接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T15:45:05.733

可以使用 Flash IDE 将视频嵌入到 SWF 中，但这不是一个很好的选择：

> *“播放仅限于简单的播放和停止命令，并且视频帧速率必须与宿主电影的帧速率相匹配，这是一个重要的考虑因素，需要创作最低公分母的下载速度。”*
> 
> *“嵌入视频的最大限制是电影的最大帧数为 16,000 帧，并且音频同步无法保持超过大约两分钟。”*

这些引文来自[这篇文章](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_14571)。它有点旧，但据我所知，那里关于嵌入视频的说法仍然适用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-25T20:39:45.397

哦，是的，显然您可以使用`Embed`元标记将二进制数据嵌入到 swf 中。

```
[Embed(
    source="local_data_file.flv",
    mimeType="application/octet-stream") ]
private static var __FlvClass123:Class;
protected static var flvData:ByteArray = new __FlvClass123(); 
```

您是否可以从 ByteArray 播放嵌入的视频并不是我现阶段无法以一种或另一种方式回答的问题......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-05-31T04:45:43.033

刚刚遇到同样的问题并寻找更“灵活”的解决方案。似乎这些 Days 动态嵌入非常简单：

```
public function loadSWF(){

 var _assetLdr:Loader;
_assetLdr = new Loader();
_assetLdr.load(new URLRequest("1.swf"));
_assetLdr.contentLoaderInfo.addEventListener(Event.COMPLETE, this.handleComplete);
addChild(_assetLdr); 
}

public function handleComplete(event:Event):void {

    trace("complete");
    var loaderInfo:LoaderInfo=event.target as LoaderInfo;
    var content:MovieClip = loaderInfo.loader.content as MovieClip;
    addChild(content);

} 
```

注意：检查`library.swf`. 就我而言，他们搞砸了，所以它只是显示在屏幕外。（ThankGodForCoffee）祝您有美好的一天！

# java - 什么是开发黑莓应用程序的好工具包？

> ID：199077
> 
> 赞同：6
> 
> 时间：2008-10-13T21:21:35.523
> 
> 标签：java, blackberry, java-me, mobile

寻找用于一般黑莓开发或应用程序工具包的工具包/SDK。像 MVC 框架这样的东西吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T22:43:44.640

我的理解是，黑莓的操作系统是基于 Java ME 的，并且有适合他们的开发工具包。我想您已经[在这里查看了所有内容](http://na.blackberry.com/eng/developers/)……您可以找到很多信息，包括开发工具包下载链接。
关于模型-视图-控制器，据我所知没有特定的框架，但我不明白为什么您不能将 MVC 作为一种范式意义上的方法。Google 有关于使用 MVC 的 Java 开发人员的资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T17:36:04.137

我不确定您在寻找标准 SDK 之外的确切内容，但您可以查看 Plazmic 的内容开发工具包：

[http://www.plazmic.com/en/index.shtml](http://www.plazmic.com/en/index.shtml)

# asp.net-mvc - 我们是否正在使用 .Net 3.5 中的 MVC 框架转向经典 ASP？

> ID：199078
> 
> 赞同：7
> 
> 时间：2008-10-13T21:21:56.727
> 
> 标签：asp.net-mvc, asp-classic, .net-3.5, tags

查看 MVC 框架，似乎我们需要更多的经典 ASP 知识，然后是 ASP.NET 回发和视图状态。我们是否在实际的前端 HTML 标记中向后移动到复杂的 UI + 代码逻辑？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-13T21:37:09.503

我们正在回到不试图抽象出 HTML 和 HTTP 请求等基本概念。在 UI 端，这意味着视图与输出更紧密地集成在一起，这不是一件坏事。经典的 ASP 模型转化为将所有内容与输出紧密集成，这*是*一件坏事。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T21:50:26.823

如果你认为 ASP.NET 范式向前迈进了一步，我猜，有人可能会争辩说 MVC 范式是一种倒退。就我个人而言，我一直认为在经典的 ASP 中编写干净分离的代码要容易得多，而不是在 .NET 中，显示输出文本通常被混入代码块中，无法使用标准的 HTML 编辑器进行访问。我一直认为 ASP.NET 架构更多的是推动 .NET，而不是改进我们应用程序的整体结构，所以从这个意义上说，MVC 是向前迈出的一步。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T21:32:20.293

你提到这个很有趣......我今天和一位同事进行了同样的谈话。

是不是倒退了一步？我不这么认为......虽然在经典的 asp 中，您在 UI 中有一些复杂的逻辑，但从我在 MVC 中可以看到，复杂的逻辑应该仍然存在于您的业务对象中，并且与对象的任何复杂交互都应该通过控制器完成。

同样，据我所见，目标是在涉及实际业务逻辑时保持 UI 整洁和适合。使用 AJAX 和 JQuery 等使 UI 更加用户友好会导致任何额外的膨胀。

这只是我对 MVC 的初步观察。这是一项非常酷的技术，尤其是它位于 REST 之上的方式，使其非常容易与其他技术一起使用。

我期待在未来的几个项目中尝试它！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T22:41:13.540

如果您在视图中看到相对于模型和控制器的复杂代码逻辑，那么您可能以错误的方式接近它。

从纯粹意义上讲，您应该能够以最少的工作切换视图（比方说是 XML，而不是 HTML）。只有当数据逻辑包含在模型中并且业务逻辑包含在控制器中时，才会发生这种情况。

因此，如果您正在显示购物车，则视图可能只有写出产品数量和总数的代码。模型类将保存产品数据，控制器将执行所有处理，例如添加产品和签出。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T21:33:31.147

MVC 的全部意义在于代码的分离。模型应该包含你所有的业务逻辑，视图应该只处理用户的输出，控制器应该将这两部分粘合在一起。

# .net - 如何检测安装了哪些 .NET Framework 版本和服务包？

> ID：199080
> 
> 赞同：294
> 
> 时间：2008-10-13T21:22:21.357
> 
> 标签：.net, installation, version-detection

[此处](https://stackoverflow.com/questions/198931/how-do-i-tell-if-net-35-sp1-is-installed)提出了类似的问题，但它特定于 .NET 3.5。具体来说，我正在寻找以下内容：

1.  确定安装了哪些 .NET Framework 版本和服务包的正确方法是什么？
2.  是否有可以使用的注册表项列表？
3.  框架版本之间是否存在依赖关系？

* * *

## 回答 #1

> 赞同：370
> 
> 时间：2008-10-14T02:04:20.587

注册表是检测是否安装了特定版本的框架[的官方方法。](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)

![在此处输入图像描述](https://i.stack.imgur.com/hiLch.png)

根据您正在寻找的框架版本，需要更改哪些注册表项：

```
框架版本注册表项
-------------------------------------------------- --------------------------------------
1.0 HKLM\Software\Microsoft\.NETFramework\Policy\v1.0\3705
1.1 HKLM\Software\Microsoft\NET Framework Setup\NDP\v1.1.4322\Install
2.0 HKLM\Software\Microsoft\NET Framework Setup\NDP\v2.0.50727\Install
3.0 HKLM\Software\Microsoft\NET Framework Setup\NDP\v3.0\Setup\InstallSuccess
3.5 HKLM\Software\Microsoft\NET Framework Setup\NDP\v3.5\Install
4.0 客户端配置文件 HKLM\Software\Microsoft\NET Framework Setup\NDP\v4\Client\Install
4.0 完整配置文件 HKLM\Software\Microsoft\NET Framework Setup\NDP\v4\Full\Install

```

一般来说，您正在寻找：

```
"Install"=dword:00000001 
```

.NET 1.0 除外，其中值是字符串 ( `REG_SZ`) 而不是数字 ( `REG_DWORD`)。

确定服务包级别遵循类似的模式：

```
框架版本注册表项
-------------------------------------------------- --------------------------------------
1.0 HKLM\Software\Microsoft\Active Setup\Installed Components\{78705f0d-e8db-4b2d-8193-982bdda15ecd}\Version
1.0[1] HKLM\Software\Microsoft\Active Setup\Installed Components\{FDC11A6F-17D1-48f9-9EA3-9051954BAA24}\Version
1.1 HKLM\Software\Microsoft\NET 框架设置\NDP\v1.1.4322\SP
2.0 HKLM\Software\Microsoft\NET 框架设置\NDP\v2.0.50727\SP
3.0 HKLM\Software\Microsoft\NET 框架设置\NDP\v3.0\SP
3.5 HKLM\Software\Microsoft\NET 框架设置\NDP\v3.5\SP
4.0 客户端配置文件 HKLM\Software\Microsoft\NET Framework Setup\NDP\v4\Client\Servicing
4.0 完整配置文件 HKLM\Software\Microsoft\NET Framework Setup\NDP\v4\Full\Servicing

[1] Windows Media Center 或 Windows XP 平板电脑版

```

如您所见，如果您在 Windows Media Center 或 Windows XP Tablet Edition 上运行，确定 .NET 1.0 的 SP 级别会发生变化。同样，.NET 1.0 使用字符串值，而所有其他都使用 DWORD。

对于 .NET 1.0，这些键中的任何一个的字符串值的格式为 #,#,####,#。最后一个# 是Service Pack 级别。

虽然我没有明确要求这样做，但如果您想知道框架的确切版本号，您可以使用以下注册表项：

```
框架版本注册表项
-------------------------------------------------- --------------------------------------
1.0 HKLM\Software\Microsoft\Active Setup\Installed Components\{78705f0d-e8db-4b2d-8193-982bdda15ecd}\Version
1.0[1] HKLM\Software\Microsoft\Active Setup\Installed Components\{FDC11A6F-17D1-48f9-9EA3-9051954BAA24}\Version
1.1 HKLM\Software\Microsoft\NET 框架设置\NDP\v1.1.4322
2.0[2] HKLM\Software\Microsoft\NET Framework Setup\NDP\v2.0.50727\Version
2.0[3] HKLM\Software\Microsoft\NET Framework Setup\NDP\v2.0.50727\Increment
3.0 HKLM\Software\Microsoft\NET Framework Setup\NDP\v3.0\Version
3.5 HKLM\Software\Microsoft\NET Framework Setup\NDP\v3.5\Version
4.0 客户端配置文件 HKLM\Software\Microsoft\NET Framework Setup\NDP\v4\Version
4.0 完整配置文件 HKLM\Software\Microsoft\NET Framework Setup\NDP\v4\Version

[1] Windows Media Center 或 Windows XP 平板电脑版
[2] .NET 2.0 SP1
[3] .NET 2.0 原始版本 (RTM)

```

同样，.NET 1.0 使用字符串值，而所有其他都使用 DWORD。

## 补充笔记

*   对于 .NET 1.0，这些键中任一键的字符串值的格式为`#,#,####,#`. 字符串的`#,#,####`一部分是框架版本。

*   对于 .NET 1.1，我们使用注册表项本身的名称，它代表版本号。

*   最后，如果您查看依赖关系，.NET 3.0 为 .NET 2.0 添加了额外的功能，因此 .NET 2.0 和 .NET 3.0 都必须在已安装时都进行评估才能正确说明已安装 .NET 3.0。同样，.NET 3.5 为 .NET 2.0 和 .NET 3.0 添加了附加功能，因此 .NET 2.0、.NET 3.0 和 .NET 3\. 都应评估为已安装以正确表示已安装 .NET 3.5。

*   .NET 4.0 安装了新版本的 CLR（CLR 4.0 版），它可以与 CLR 2.0 并行运行。

## .NET 4.5 更新

`v4.5`如果安装了 .NET 4.5，注册表中将没有键。相反，您必须检查`HKLM\Software\Microsoft\NET Framework Setup\NDP\v4\Full`键是否包含名为`Release`. 如果存在此值，则安装 .NET 4.5，否则不安装。更多细节可以在[这里](https://stackoverflow.com/a/15227828/270591)和[这里](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)找到。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2010-06-21T17:57:44.140

在以下知识库文章中，微软官方对此问题的回答：

[文章 ID：318785 - 上次审核：2008 年 11 月 7 日 - 修订：20.1 如何确定安装了哪些版本的 .NET Framework 以及是否已应用服务包](http://support.microsoft.com/kb/318785/en-us)

不幸的是，它似乎不起作用，因为 2.0 目录中的 mscorlib.dll 版本有 2.0 版本，并且即使安装了 3.5 SP1，3.0 或 3.5 目录中也没有 mscorlib.dll 版本......为什么微软的官方答案会如此误导吗？

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2010-03-16T00:28:13.690

Framework 4 beta 安装到不同的注册表项。

```
using System;
using System.Collections.ObjectModel;
using Microsoft.Win32;

class Program
{
    static void Main(string[] args)
    {
        foreach(Version ver in InstalledDotNetVersions())
            Console.WriteLine(ver);

        Console.ReadKey();
    }

    public static Collection<Version> InstalledDotNetVersions()
    {
        Collection<Version> versions = new Collection<Version>();
        RegistryKey NDPKey = Registry.LocalMachine.OpenSubKey(@"SOFTWARE\Microsoft\NET Framework Setup\NDP");
        if (NDPKey != null)
        {
            string[] subkeys = NDPKey.GetSubKeyNames();
            foreach (string subkey in subkeys)
            {
                GetDotNetVersion(NDPKey.OpenSubKey(subkey), subkey, versions);
                GetDotNetVersion(NDPKey.OpenSubKey(subkey).OpenSubKey("Client"), subkey, versions);
                GetDotNetVersion(NDPKey.OpenSubKey(subkey).OpenSubKey("Full"), subkey, versions);
            }
        }
        return versions;
    }

    private static void GetDotNetVersion(RegistryKey parentKey, string subVersionName, Collection<Version> versions)
    {
        if (parentKey != null)
        {
            string installed = Convert.ToString(parentKey.GetValue("Install"));
            if (installed == "1")
            {
                string version = Convert.ToString(parentKey.GetValue("Version"));
                if (string.IsNullOrEmpty(version))
                {
                    if (subVersionName.StartsWith("v"))
                        version = subVersionName.Substring(1);
                    else
                        version = subVersionName;
                }

                Version ver = new Version(version);

                if (!versions.Contains(ver))
                    versions.Add(ver);
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-04-27T09:12:50.143

我想检测我的系统上是否安装了 .NET 版本 4.5.2，但我发现没有比*[ASoft .NET Version Detector](http://www.asoft.be/prod_netver.html)*更好的解决方案。

此工具的快照显示了不同的 .NET 版本：

![此工具的快照显示不同的 .NET 版本](https://i.stack.imgur.com/GomST.png)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-13T21:37:41.170

枚举`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP`. 每个子项都是一个[.NET](http://en.wikipedia.org/wiki/.NET_Framework)版本。如果它存在于机器上，它应该具有`Install=1`价值，一个显示服务包的 SP 值和一个`MSI=1`值，如果它是使用 MSI 安装的。（例如，Windows Vista 上的 .NET 2.0 没有最后一个，因为它是操作系统的一部分。）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-05-11T13:04:14.583

对于 64 位操作系统，路径为：

```
HKEY_LOCAL_MACHINE\SOFTWARE\wow6432Node\Microsoft\NET Framework Setup\NDP\ 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-12-12T09:44:37.660

## .NET 4.5.1 更新

现在 .NET 4.5.1 可用，需要检查注册表中名为 Release 的键的实际值，而不仅仅是它的存在。值 378758 表示已安装 .NET Framework 4.5.1。但是，如此处所述[，此](http://blogs.msdn.com/b/astebner/archive/2013/11/11/10466402.aspx)值在 Windows 8.1 上为 378675。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-12-12T21:12:48.553

有一个 GUI 工具可用，*[ASoft .NET 版本检测器](http://www.asoft.be/prod_netver.html)*，它一直被证明是高度可靠的。它可以通过在命令行上指定 XML 输出的文件名来创建 XML 文件。

您可以将其用于自动化。它是一个小程序，用不依赖于 .NET 的语言编写，不需要安装。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-04-20T07:44:13.237

我需要找出我的计算机上的 .NET 框架版本，我所做的只是转到控制面板并选择“卸载程序”选项。之后，我按名称对程序进行了排序，并找到了 Microsoft .NET Framework 4 Client Profile。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-01-13T18:00:02.910

这是一个 PowerShell 脚本，用于获取已安装的 .NET 框架版本

```
function Get-KeyPropertyValue($key, $property)
{
    if($key.Property -contains $property)
    {
        Get-ItemProperty $key.PSPath -name $property | select -expand $property
    }
}

function Get-VersionName($key)
{
   $name = Get-KeyPropertyValue $key Version
   $sp = Get-KeyPropertyValue $key SP
   $install = Get-KeyPropertyValue $key Install
   if($sp)
   {
        "$($_.PSChildName) $name SP $sp"
   }
   else{
    "$($_.PSChildName) $name"
   }
}

function Get-FrameworkVersion{
   dir "hklm:\SOFTWARE\Microsoft\NET Framework Setup\NDP\" |? {$_.PSChildName -like "v*"} |%{
    if( $_.Property -contains "Version")
    {
        Get-VersionName $_
    }
    else{
        $parent = $_
        Get-ChildItem $_.PSPath |%{
            $versionName = Get-VersionName $_
            "$($parent.PSChildName) $versionName"
            }
        }
    }
}

$v4Directory = "hklm:\SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Full"
if(Test-Path $v4Directory)
{
    $v4 = Get-Item $v4Directory
    $version = Get-KeyPropertyValue $v4 Release
    switch($version){
        378389 {".NET Framework 4.5"; break;}
        378675 {".NET Framework 4.5.1 installed with Windows 8.1 or Windows Server 2012 R2"; break;}
        378758 {".NET Framework 4.5.1 installed on Windows 8, Windows 7 SP1, or Windows Vista SP2"; break;}
        379893 {".NET Framework 4.5.2"; break;}
        { 393295, 393297 -contains $_} {".NET Framework 4.6"; break;}
        { 394254, 394271 -contains $_} {".NET Framework 4.6.1"; break;}
        { 394802, 394806 -contains $_} {".NET Framework 4.6.2"; break; }
    }
} 
```

它是根据*[如何：确定安装了哪些 .NET Framework 版本](https://msdn.microsoft.com/en-us/library/hh925568.aspx)*编写的。请使用 Get-FrameworkVersion() 函数来获取有关已安装的 .NET 框架版本的信息。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-13T19:31:12.457

使用 SignumFramework 中的[Signum.Utilities](http://www.signumframework.com)[库](http://www.signumframework.com/Default.aspx?Page=Others&AspxAutoDetectCookieSupport=1#AboutTools)（您可以单独使用），您可以很好地获得它，而无需自己处理注册表：

```
AboutTools.FrameworkVersions().ToConsole();
//Writes in my machine:
//v2.0.50727 SP2
//v3.0 SP2
//v3.5 SP1 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-10-24T08:10:37.347

请参阅*[如何：确定安装了哪些 .NET Framework 版本](http://msdn.microsoft.com/en-us/library/hh925568.aspx)*(MSDN)。

MSDN 提出了一个似乎适用于版本 1-4 的功能示例。根据文章，方法输出为：

```
v2.0.50727  2.0.50727.4016  SP2
v3.0  3.0.30729.4037  SP2
v3.5  3.5.30729.01  SP1
v4
  Client  4.0.30319
  Full  4.0.30319 
```

请注意，对于“4.5 及更高版本”，还有另一个功能。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-04-28T19:48:00.747

在 Windows 7 中（它也应该适用于 Windows 8，但我还没有测试过）：

转到命令提示符

进入命令提示符的步骤：

1.  点击开始菜单
2.  在搜索框中，输入“cmd”（不带引号）
3.  打开 cmd.exe

在 cmd 中，键入此命令

```
wmic /namespace:\\root\cimv2 path win32_product where "name like '%%.NET%%'" get version 
```

这样就安装了最新版本的 NET Framework。

也可以尝试[Raymond.cc Utilties](https://www.raymond.cc/blog/how-to-check-what-version-of-microsoft-net-framework-is-installed-in-computer/)。

# c++ - 在 Windows XP 中使用 MinGW 的 g++ 编译 Qt 程序

> ID：199092
> 
> 赞同：3
> 
> 时间：2008-10-13T21:25:04.533
> 
> 标签：c++, qt, mingw

我有一个存根 Qt 应用程序，并且不断收到编译器错误

```
#include <QApplication>

int main(int argc, char *argv[])
 {
     return 0;
 } 
```

我使用`qmake -project`和`qmake`命令，据我所知，他们正确地完成了他们的工作。当我随后`make`在命令行调用时，我收到以下错误：

> ```
> g++ -c -O2 -frtti -fexceptions -mthreads -Wall -DUNICODE -DQT_LARGEFILE_SUPPORT
> -DQT_NO_DEBUG -DQT_GUI_LIB -DQT_CORE_LIB -DQT_THREAD_SUPPORT -DQT_NEEDS_QMAIN -I
> '../../../../qt/include/QtCore' -I'../../../../qt/include/QtCore' -I'../../../..
> /qt/include/QtGui' -I'../../../../qt/include/QtGui' -I'../../../../qt/include' -
> I'.' -I'c:/qt/include/ActiveQt' -I'release' -I'.' -I'../../../../qt/mkspecs/defa
> ult' -o release/Main.o Main.cpp
> cc1plus.exe: Invalid option 'threads'
> make[1]: *** [release/Main.o] Error 1
> make: *** [release] Error 2 
> ```

我在谷歌上的搜索告诉我线程很重要，但不是如何解决这个错误。任何帮助将不胜感激。

**编辑**（从OP留下的答案复制）：

我现在得到：

```
g++ -enable-stdcall-fixup -Wl,-enable-auto-import -Wl,-enable-runtime-pseudo-rel oc 
-Wl,-s -pthread -Wl -Wl,-subsystem,windows -o release/raytrace.exe 
object_scr ipt.raytrace.Release  -L'c:/qt/lib' -lmingw32 -lqtmain -lQtGui -lgdi32 
-lcomdlg3 2 -loleaut32 -limm32 -lwinmm -lwinspool -lmsimg32 -lQtCore -lkernel32 
-luser32 - lshell32 -luuid -lole32 -ladvapi32 -lws2_32 
g++: unrecognized option `-pthread' 
/cygnus/cygwin-b20/H-i586-cygwin32/i586-cygwin32/bin/ld: cannot open -lmsimg32: 
No such file or directory collect2: 
ld returned 1 exit status make[1]: *** 
[release/raytrace.exe] Error 1 make: *** [release] Error 2 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T18:57:45.893

++米洛特

我只使用 MinGW 在 Windows 上编译 Qt，这是确保您拥有所需一切的最简单方法。

这是开源 Qt 版本的链接：http: [//trolltech.com/downloads/opensource/appdev/windows-cpp](http://trolltech.com/downloads/opensource/appdev/windows-cpp)

使用“或下载包含 MinGW 编译器的 Qt：大小：149,3 Mb”链接。

使用 MinGW 的另一种方法是使用 MinGW 编译 Qt，然后编译您的应用程序，但这取决于您是在 MSYS 中编译还是仅使用 MinGW。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T00:28:26.943

好吧，我之前在安装从网上下载的 MingW 时遇到了类似的问题，但另一方面，在安装 Qt 时，它会要求您下载与 Qt 兼容的 MingW 版本。那么，当 Qt 安装程序询问您时，您是否尝试过安装它？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-09T11:50:57.030

Qt 4.5 具有易于开发应用程序的 Qt Creator 1.1。

设计和编码结合在 Qt Creator 中，mucy 更易于使用。

您可以像使用 VB IDE（或者更确切地说像 eclipse、netbeans 等）一样体验它

运行应用程序时。该项目在调试或发布模式下编译。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T00:22:51.447

基于提问者后来的回答，而不是最初的问题。

在 MSYS 提示符下运行“ls /mingw/lib/libmsimg32.a”并查看是否有该文件。我的安装是（MinGW GCC 3.4.5）。如果你有那个文件，你可能需要添加 -L/mingw/lib。如果您没有该文件，您可能错过了安装 MinGW 的 windows api 部分。

无论哪种方式删除-pthread。您正在使用 Win32 api。

如果这不起作用，您需要指定您使用的是哪个版本的 MinGW，如果您使用的是 MSYS，则需要指定哪个版本的 MSYS。

# javascript - 如何在 jQuery Ajax 调用后管理重定向请求

> ID：199099
> 
> 赞同：1483
> 
> 时间：2008-10-13T21:29:50.063
> 
> 标签：javascript, jquery, ajax, redirect

我`$.post()`使用 Ajax 调用 servlet，然后使用生成的 HTML 片段替换`div`用户当前页面中的元素。但是，如果会话超时，服务器会发送重定向指令将用户发送到登录页面。在这种情况下，jQuery 正在将`div`元素替换为登录页面的内容，迫使用户的眼睛见证了一个难得的场景。

如何使用 jQuery 1.2.6 管理来自 Ajax 调用的重定向指令？

* * *

## 回答 #1

> 赞同：742
> 
> 时间：2009-10-07T22:54:26.677

我阅读了这个问题并实施了关于将响应*HTTP 状态代码*设置为 278 的方法，以避免浏览器透明地处理重定向。即使这有效，我还是有点不满意，因为它有点像黑客。

经过更多的挖掘，我放弃了这种方法并使用了[JSON](http://en.wikipedia.org/wiki/JSON)。在这种情况下，对 AJAX 请求的所有响应都具有*状态代码*200，并且响应的主体包含在服务器上构造的 JSON 对象。然后客户端上的 JavaScript 可以使用 JSON 对象来决定它需要做什么。

我遇到了和你类似的问题。我执行了一个 AJAX 请求，它有 2 个可能的响应：一个将浏览器*重定向*到新页面，另一个将当前页面上的现有 HTML 表单*替换为新的表单。*执行此操作的 jQuery 代码如下所示：

```
$.ajax({
    type: "POST",
    url: reqUrl,
    data: reqBody,
    dataType: "json",
    success: function(data, textStatus) {
        if (data.redirect) {
            // data.redirect contains the string URL to redirect to
            window.location.href = data.redirect;
        } else {
            // data.form contains the HTML for the replacement form
            $("#myform").replaceWith(data.form);
        }
    }
}); 
```

JSON 对象“数据”在服务器上构造为具有 2 个成员：`data.redirect`和`data.form`. 我发现这种方法要好得多。

* * *

## 回答 #2

> 赞同：265
> 
> 时间：2009-02-23T23:49:11.453

我通过以下方式解决了这个问题：

1.  向响应中添加自定义标头：

    ```
    public ActionResult Index(){
        if (!HttpContext.User.Identity.IsAuthenticated)
        {
            HttpContext.Response.AddHeader("REQUIRES_AUTH","1");
        }
        return View();
    } 
    ```

2.  将 JavaScript 函数绑定到[`ajaxSuccess`](http://api.jquery.com/ajaxsuccess/)事件并检查标头是否存在：

    ```
    $(document).ajaxSuccess(function(event, request, settings) {
        if (request.getResponseHeader('REQUIRES_AUTH') === '1') {
           window.location = '/';
        }
    }); 
    ```

* * *

## 回答 #3

> 赞同：123
> 
> 时间：2008-11-20T08:39:42.330

没有浏览器正确处理 301 和 302 响应。事实上，该标准甚至说他们应该“透明地”处理它们，这对于 Ajax 库供应商来说是一个非常头疼的问题。在[Ra-Ajax](http://code.google.com/p/ra-ajax/)中，我们被迫使用 HTTP 响应状态代码 278（只是一些“未使用”的成功代码）来透明地处理来自服务器的重定向......

这真的让我很恼火，如果这里有人对 W3C 有一些“吸引力”，我会很感激你可以让 W3C*知道*我们确实需要自己处理 301 和 302 代码......！;)

* * *

## 回答 #4

> 赞同：103
> 
> 时间：2009-01-27T18:10:32.743

最终实现的解决方案是对 Ajax 调用的回调函数使用包装器，并在此包装器中检查返回的 HTML 块上是否存在特定元素。如果找到该元素，则包装器执行重定向。如果不是，包装器将调用转发给实际的回调函数。

例如，我们的包装函数类似于：

```
function cbWrapper(data, funct){
    if($("#myForm", data).length > 0)
        top.location.href="login.htm";//redirection
    else
        funct(data);
} 
```

然后，在进行 Ajax 调用时，我们使用了类似的东西：

```
$.post("myAjaxHandler", 
       {
        param1: foo,
        param2: bar
       },
       function(data){
           cbWrapper(data, myActualCB);
       }, 
       "html"
); 
```

这对我们有用，因为所有 Ajax 调用总是在 DIV 元素中返回 HTML，我们用它来替换页面的一部分。此外，我们只需要重定向到登录页面。

* * *

## 回答 #5

> 赞同：74
> 
> 时间：2011-08-23T19:21:35.470

我喜欢蒂默兹的方法，稍微加一点柠檬。如果您在期待**JSON时收到****text/html的返回****contentType**，那么您很可能会被重定向。就我而言，我只是简单地重新加载页面，然后将其重定向到登录页面。哦，检查一下 jqXHR 的状态是 200，这看起来很傻，因为你在错误函数中，对吧？否则，合法的错误情况将强制迭代重新加载（oops）

 ****```
$.ajax(
   error:  function (jqXHR, timeout, message) {
    var contentType = jqXHR.getResponseHeader("Content-Type");
    if (jqXHR.status === 200 && contentType.toLowerCase().indexOf("text/html") >= 0) {
        // assume that our login has expired - reload our current page
        window.location.reload();
    }

}); 
```

* * *

## 回答 #6

> 赞同：58
> 
> 时间：2008-10-13T21:54:53.057

使用低级`$.ajax()`调用：

```
$.ajax({
  url: "/yourservlet",
  data: { },
  complete: function(xmlHttp) {
    // xmlHttp is a XMLHttpRquest object
    alert(xmlHttp.status);
  }
}); 
```

试试这个重定向：

```
if (xmlHttp.code != 200) {
  top.location.href = '/some/other/page';
} 
```

* * *

## 回答 #7

> 赞同：34
> 
> 时间：2012-05-23T10:02:27.233

我只是想分享我的方法，因为这可能会对某人有所帮助：

我基本上包含了一个 JavaScript 模块，它处理身份验证内容，例如显示用户名，并且在这种情况下处理**重定向到登录页面**。

我的场景：我们基本上有一个 ISA 服务器，在它之间侦听所有请求，并**以 302 和位置标头响应**我们的登录页面。

在我的 JavaScript 模块中，我**最初的方法**类似于

```
$(document).ajaxComplete(function(e, xhr, settings){
    if(xhr.status === 302){
        //check for location header and redirect...
    }
}); 
```

问题（正如这里已经提到的许多问题）是浏览器自己处理重定向，因此我的`ajaxComplete`回调从未被调用，而是我得到了**已经重定向的登录页面的响应，**这显然是一个`status 200`. 问题：您如何检测成功的 200 响应是您的实际登录页面还是其他任意页面？

## 解决方案

由于我无法捕获 302 重定向响应，因此我`LoginPage`在登录页面上添加了一个标题，其中包含登录页面本身的 url。在模块中，我现在监听标头并进行重定向：

```
if(xhr.status === 200){
    var loginPageRedirectHeader = xhr.getResponseHeader("LoginPage");
    if(loginPageRedirectHeader && loginPageRedirectHeader !== ""){
        window.location.replace(loginPageRedirectHeader);
    }
} 
```

...这就像魅力:)。您可能想知道为什么我将 url 包含在`LoginPage`标题中......基本上是因为我发现无法确定`GET`来自`xhr`对象的自动位置重定向所产生的 url......

* * *

## 回答 #8

> 赞同：30
> 
> 时间：2013-05-06T23:55:06.340

我知道这个话题已经过时了，但我会给出另一种我发现并[在此处](https://stackoverflow.com/questions/11049690/session-cookies-expiration-handling-in-asp-net-mvc-3-while-using-wif-and-jquery)之前描述过的方法。基本上我将 ASP.MVC 与 WIF 一起使用*（但这对于本主题的上下文并不重要 - 无论使用哪种框架，答案都足够了。线索保持不变 - 在执行 ajax 请求时处理与身份验证失败相关的问题)* .

下面显示的方法可以应用于所有开箱即用的 ajax 请求（如果它们没有明显地重新定义 beforeSend 事件）。

```
$.ajaxSetup({
    beforeSend: checkPulse,
    error: function (XMLHttpRequest, textStatus, errorThrown) {
        document.open();
        document.write(XMLHttpRequest.responseText);
        document.close();
    }
}); 
```

在执行任何 ajax 请求之前`CheckPulse`调用方法（可以是最简单的控制器方法）：

```
[Authorize]
public virtual void CheckPulse() {} 
```

如果用户未通过身份验证（令牌已过期），则无法访问此类方法（受`Authorize`属性保护）。因为框架处理身份验证，当令牌过期时，它会将 http 状态 302 放入响应中。如果您不希望浏览器透明地处理 302 响应，请在 Global.asax 中捕获它并更改响应状态 - 例如更改为 200 OK。此外，添加标头，指示您以特殊方式处理此类响应（稍后在客户端）：

```
protected void Application_EndRequest()
{
    if (Context.Response.StatusCode == 302
        && (new HttpContextWrapper(Context)).Request.IsAjaxRequest())
    {                
        Context.Response.StatusCode = 200;
        Context.Response.AddHeader("REQUIRES_AUTH", "1");
    }
} 
```

最后在客户端检查此类自定义标头。如果存在 - 应该完全重定向到登录页面（在我的情况下`window.location`，由我的框架自动处理的请求中的 url 替换）。

```
function checkPulse(XMLHttpRequest) {
    var location = window.location.href;
    $.ajax({
        url: "/Controller/CheckPulse",
        type: 'GET',
        async: false,
        beforeSend: null,
        success:
            function (result, textStatus, xhr) {
                if (xhr.getResponseHeader('REQUIRES_AUTH') === '1') {
                    XMLHttpRequest.abort(); // terminate further ajax execution
                    window.location = location;
                }
            }
    });
} 
```

* * *

## 回答 #9

> 赞同：29
> 
> 时间：2012-10-23T16:27:56.917

我认为更好的处理方法是利用现有的 HTTP 协议响应代码，特别是`401 Unauthorized`.

这是我解决它的方法：

1.  服务器端：如果会话过期，并且请求是 ajax。发送 401 响应码头
2.  客户端：绑定到 ajax 事件

    ```
    $('body').bind('ajaxSuccess',function(event,request,settings){
    if (401 == request.status){
        window.location = '/users/login';
    }
    }).bind('ajaxError',function(event,request,settings){
    if (401 == request.status){
        window.location = '/users/login';
    }
    }); 
    ```

IMO 这更通用，您不会编写一些新的自定义规范/标题。您也不必修改任何现有的 ajax 调用。

**编辑：**根据@Rob 下面的评论，401（身份验证错误的 HTTP 状态代码）应该是指示符。有关更多详细信息，请参阅[403 Forbidden 与 401 Unauthorized HTTP 响应](https://stackoverflow.com/questions/3297048/403-forbidden-vs-401-unauthorized-http-responses)。话虽如此，一些 Web 框架使用 403 来进行身份验证和授权错误 - 所以相应地进行调整。谢谢罗布。

* * *

## 回答 #10

> 赞同：25
> 
> 时间：2012-01-06T01:33:08.997

我这样解决了这个问题：

添加中间件来处理响应，如果是ajax请求的重定向，将响应更改为带有重定向url的正常响应。

```
class AjaxRedirect(object):
  def process_response(self, request, response):
    if request.is_ajax():
      if type(response) == HttpResponseRedirect:
        r = HttpResponse(json.dumps({'redirect': response['Location']}))
        return r
    return response 
```

那么在ajaxComplete中，如果响应中包含redirect，那肯定是redirect，所以改变浏览器的位置。

```
$('body').ajaxComplete(function (e, xhr, settings) {
   if (xhr.status == 200) {
       var redirect = null;
       try {
           redirect = $.parseJSON(xhr.responseText).redirect;
           if (redirect) {
               window.location.href = redirect.replace(/\?.*$/, "?next=" + window.location.pathname);
           }
       } catch (e) {
           return;
       }
   }
} 
```

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2014-05-01T21:42:08.647

我发现的另一个解决方案（如果您想设置全局行为特别有用）是将[`$.ajaxsetup()`方法](https://api.jquery.com/jQuery.ajax/)与[`statusCode`property](https://api.jquery.com/jquery.ajaxsetup/)一起使用。就像其他人指出的那样，不要使用重定向状态码（`3xx`），而是使用`4xx`状态码并处理重定向客户端。

```
$.ajaxSetup({ 
  statusCode : {
    400 : function () {
      window.location = "/";
    }
  }
}); 
```

替换`400`为您要处理的状态码。就像已经提到`401 Unauthorized`的那样可能是个好主意。我使用 是`400`因为它非常不具体，我可以将`401`用于更具体的情况（例如错误的登录凭据）。`4xx`因此，当会话超时并且您处理重定向客户端时，您的后端应该返回一个错误代码，而不是直接重定向。即使使用像backbone.js这样的框架也非常适合我

* * *

## 回答 #12

> 赞同：20
> 
> 时间：2010-08-17T18:07:11.643

我有一个适合我的简单解决方案，无需更改服务器代码……只需添加一茶匙肉豆蔻……

```
$(document).ready(function ()
{
    $(document).ajaxSend(
    function(event,request,settings)
    {
        var intercepted_success = settings.success;
        settings.success = function( a, b, c ) 
        {  
            if( request.responseText.indexOf( "<html>" ) > -1 )
                window.location = window.location;
            else
                intercepted_success( a, b, c );
        };
    });
}); 
```

我检查了 html 标记的存在，但您可以更改 indexOf 以搜索登录页面中存在的任何唯一字符串...

* * *

## 回答 #13

> 赞同：20
> 
> 时间：2014-02-14T13:56:55.993

大多数给定的解决方案都使用了一种变通方法，即使用额外的标头或不合适的 HTTP 代码。这些解决方案很可能会奏效，但感觉有点“笨拙”。我想出了另一个解决方案。

我们正在使用配置为在 401 响应上重定向 (passiveRedirectEnabled="true") 的 WIF。重定向在处理普通请求时很有用，但不适用于 AJAX 请求（因为浏览器不会执行 302/重定向）。

在 global.asax 中使用以下代码，您可以禁用 AJAX 请求的重定向：

```
 void WSFederationAuthenticationModule_AuthorizationFailed(object sender, AuthorizationFailedEventArgs e)
    {
        string requestedWithHeader = HttpContext.Current.Request.Headers["X-Requested-With"];

        if (!string.IsNullOrEmpty(requestedWithHeader) && requestedWithHeader.Equals("XMLHttpRequest", StringComparison.OrdinalIgnoreCase))
        {
            e.RedirectToIdentityProvider = false;
        }
    } 
```

这允许您为 AJAX 请求返回 401 响应，然后您的 javascript 可以通过重新加载页面来处理这些响应。重新加载页面将引发 401，这将由 WIF 处理（WIF 会将用户重定向到登录页面）。

处理 401 错误的示例 javascript：

```
$(document).ajaxError(function (event, jqxhr, settings, exception) {

    if (jqxhr.status == 401) { //Forbidden, go to login
        //Use a reload, WIF will redirect to Login
        location.reload(true);
    }
}); 
```

* * *

## 回答 #14

> 赞同：19
> 
> 时间：2016-10-27T13:31:05.290

然后使用 ASP.NET MVC RedirectToAction 方法可能会出现此问题。**为了防止表单在 div 中显示响应，您可以简单地使用$.ajaxSetup**对传入响应执行某种 ajax 响应过滤器。如果响应包含 MVC 重定向，您可以在 JS 端评估此表达式。JS的示例代码如下：

```
$.ajaxSetup({
    dataFilter: function (data, type) {
        if (data && typeof data == "string") {
            if (data.indexOf('window.location') > -1) {
                eval(data);
            }
        }
        return data;
    }
}); 
```

如果数据是：*"window.location = '/Acount/Login'"*上面的过滤器将捕获并评估以进行重定向，而不是让数据显示。

* * *

## 回答 #15

> 赞同：17
> 
> 时间：2009-08-06T20:17:07.117

将 Vladimir Prudnikov 和 Thomas Hansen 所说的话放在一起：

*   更改您的服务器端代码以检测它是否是 XHR。如果是，则将重定向的响应代码设置为 278。在 django 中：

> ```
>  if request.is_ajax():
>       response.status_code = 278 
> ```

这使得浏览器将响应视为成功，并将其交给您的 Javascript。

*   在您的 JS 中，确保表单提交是通过 Ajax，检查响应代码并在需要时重定向：

> ```
> $('#my-form').submit(function(event){ 
> 
>   event.preventDefault();   
>   var options = {
>     url: $(this).attr('action'),
>     type: 'POST',
>     complete: function(response, textStatus) {    
>       if (response.status == 278) { 
>         window.location = response.getResponseHeader('Location')
>       }
>       else { ... your code here ... } 
>     },
>     data: $(this).serialize(),   
>   };   
>   $.ajax(options); 
> }); 
> ```

* * *

## 回答 #16

> 赞同：13
> 
> 时间：2011-09-10T16:44:42.153

```
 <script>
    function showValues() {
        var str = $("form").serialize();
        $.post('loginUser.html', 
        str,
        function(responseText, responseStatus, responseXML){
            if(responseStatus=="success"){
                window.location= "adminIndex.html";
            }
        });     
    }
</script> 
```

* * *

## 回答 #17

> 赞同：12
> 
> 时间：2010-10-05T06:53:07.080

尝试

```
 $(document).ready(function () {
        if ($("#site").length > 0) {
            window.location = "<%= Url.Content("~") %>" + "Login/LogOn";
        }
    }); 
```

把它放在登录页面上。如果它是在主页上的 div 中加载的，它将重定向到登录页面。“#site”是一个 div 的 id，它位于除登录页面之外的所有页面上。

* * *

## 回答 #18

> 赞同：12
> 
> 时间：2013-09-17T16:07:15.763

虽然如果您使用 Spring Security，答案似乎对人们有用，但我发现扩展 LoginUrlAuthenticationEntryPoint 并添加特定代码以更健壮地处理 AJAX。大多数示例拦截*所有*重定向，而不仅仅是身份验证失败。这对我从事的项目来说是不可取的。如果您不希望缓存失败的 AJAX 请求，您可能会发现还需要扩展 ExceptionTranslationFilter 并覆盖“sendStartAuthentication”方法以删除缓存步骤。

示例 AjaxAwareAuthenticationEntryPoint：

```
public class AjaxAwareAuthenticationEntryPoint extends
    LoginUrlAuthenticationEntryPoint {

    public AjaxAwareAuthenticationEntryPoint(String loginUrl) {
        super(loginUrl);
    }

    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {
        if (isAjax(request)) {
            response.sendError(HttpStatus.UNAUTHORIZED.value(), "Please re-authenticate yourself");
        } else {
        super.commence(request, response, authException);
        }
    }

    public static boolean isAjax(HttpServletRequest request) {
        return request != null && "XMLHttpRequest".equals(request.getHeader("X-Requested-With"));
    }
} 
```

来源 [：](http://yoyar.com/blog/2012/06/dealing-with-the-spring-security-ajax-session-timeout-problem/)[1、2](https://stackoverflow.com/questions/11242174/handle-session-expired-event-in-spring-based-web-application) _

* * *

## 回答 #19

> 赞同：11
> 
> 时间：2011-12-05T19:59:00.783

我通过将以下内容放在我的 login.php 页面中解决了这个问题。

```
<script type="text/javascript">
    if (top.location.href.indexOf('login.php') == -1) {
        top.location.href = '/login.php';
    }
</script> 
```

* * *

## 回答 #20

> 赞同：11
> 
> 时间：2018-07-12T21:45:43.617

让我再次引用@Steg 描述的问题

> 我遇到了和你类似的问题。我执行一个 ajax 请求，它有 2 个可能的响应：一个将浏览器重定向到新页面，另一个将当前页面上的现有 HTML 表单替换为新的。

恕我直言，这是一个真正的挑战，必须正式扩展到当前的 HTTP 标准。

我相信新的 Http 标准将使用新的状态码。含义：当前`301/302`告诉浏览器去获取*这个*请求的内容到一个新的`location`.

在扩展标准中，它会说如果响应`status: 308`（只是一个例子），那么浏览器应该将主页重定向到`location`提供的。

话虽如此; 我倾向于已经模仿这种*未来的*行为，因此当需要 document.redirect 时，我让服务器响应为：

```
status: 204 No Content
x-status: 308 Document Redirect
x-location: /login.html 
```

当 JS 获取到 " `status: 204`" 时，它会检查`x-status: 308`header 是否存在，并执行 document.redirect 到`location`header 中提供的页面。

这对你有意义吗？

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2016-04-08T23:26:17.640

有些人可能会发现以下有用：

我希望客户端被重定向到登录页面，以便在没有授权令牌的情况下发送任何休息操作。因为我所有的休息动作都是基于 Ajax 的，所以我需要一种很好的通用方法来重定向到登录页面，而不是处理 Ajax 成功函数。

这就是我所做的：

在任何 Ajax 请求上，我的服务器都会返回 Json 200 响应“需要验证”（如果客户端需要验证）。

Java中的简单示例（服务器端）：

```
@Secured
@Provider
@Priority(Priorities.AUTHENTICATION)
public class AuthenticationFilter implements ContainerRequestFilter {

    private final Logger m_logger = LoggerFactory.getLogger(AuthenticationFilter.class);

    public static final String COOKIE_NAME = "token_cookie"; 

    @Override
    public void filter(ContainerRequestContext context) throws IOException {        
        // Check if it has a cookie.
        try {
            Map<String, Cookie> cookies = context.getCookies();

            if (!cookies.containsKey(COOKIE_NAME)) {
                m_logger.debug("No cookie set - redirect to login page");
                throw new AuthenticationException();
            }
        }
        catch (AuthenticationException e) {
            context.abortWith(Response.ok("\"NEED TO AUTHENTICATE\"").type("json/application").build());
        }
    }
} 
```

在我的 Javascript 中，我添加了以下代码：

```
$.ajaxPrefilter(function(options, originalOptions, jqXHR) {
    var originalSuccess = options.success;

    options.success = function(data) {
        if (data == "NEED TO AUTHENTICATE") {
            window.location.replace("/login.html");
        }
        else {
            originalSuccess(data);
        }
    };      
}); 
```

就是这样。

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2008-11-14T20:56:26.217

在 servlet 中，您应该 `response.setStatus(response.SC_MOVED_PERMANENTLY);` 发送重定向所需的“301”xmlHttp 状态...

并且在 $.ajax 函数中你不应该使用`.toString()`函数...，只是

`if (xmlHttp.status == 301) { top.location.href = 'xxxx.jsp'; }`

问题是它不是很灵活，您无法决定要重定向的位置..

通过 servlet 重定向应该是最好的方法。但我仍然找不到正确的方法。

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2010-08-04T18:47:29.627

我只是想锁定整个页面的任何 ajax 请求。@SuperG 让我开始了。这是我最终得到的结果：

```
// redirect ajax requests that are redirected, not found (404), or forbidden (403.)
$('body').bind('ajaxComplete', function(event,request,settings){
        switch(request.status) {
            case 301: case 404: case 403:                    
                window.location.replace("http://mysite.tld/login");
                break;
        }
}); 
```

我想专门检查某些 http 状态代码以作为我决定的依据。但是，您可以绑定到 ajaxError 以获得成功以外的任何内容（也许只有 200 个？）我本来可以写：

```
$('body').bind('ajaxError', function(event,request,settings){
    window.location.replace("http://mysite.tld/login");
} 
```

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2013-01-07T06:35:28.543

如果您还想传递值，那么您还可以设置会话变量并访问例如：在您的 jsp 中，您可以编写

```
<% HttpSession ses = request.getSession(true);
   String temp=request.getAttribute("what_you_defined"); %> 
```

然后你可以将这个临时值存储在你的 javascript 变量中并玩转

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2013-02-06T13:45:02.990

我的标头解决方案没有任何成功——它们从未在我的 ajaxSuccess / ajaxComplete 方法中被发现。我将 Steg 的答案与自定义响应一起使用，但我修改了 JS 方面的一些内容。我设置了一个在每个函数中调用的方法，这样我就可以使用标准`$.get`和`$.post`方法。

```
function handleAjaxResponse(data, callback) {
    //Try to convert and parse object
    try {
        if (jQuery.type(data) === "string") {
            data = jQuery.parseJSON(data);
        }
        if (data.error) {
            if (data.error == 'login') {
                window.location.reload();
                return;
            }
            else if (data.error.length > 0) {
                alert(data.error);
                return;
            }
        }
    }
    catch(ex) { }

    if (callback) {
        callback(data);
    }
} 
```

使用中的例子...

```
function submitAjaxForm(form, url, action) {
    //Lock form
    form.find('.ajax-submit').hide();
    form.find('.loader').show();

    $.post(url, form.serialize(), function (d) {
        //Unlock form
        form.find('.ajax-submit').show();
        form.find('.loader').hide();

        handleAjaxResponse(d, function (data) {
            // ... more code for if auth passes ...
        });
    });
    return false;
} 
```

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2015-07-30T06:02:24.823

最后，我通过添加自定义来解决问题`HTTP Header`。在响应服务器端的每个请求之前，我将当前请求的 url 添加到响应的标题中。

我在服务器上的应用程序类型是`Asp.Net MVC`，它有一个很好的地方来做。在`Global.asax`我实施了这个`Application_EndRequest`事件，所以：

```
 public class MvcApplication : System.Web.HttpApplication
    {

    //  ...
    //  ...

        protected void Application_EndRequest(object sender, EventArgs e)
        {
            var app = (HttpApplication)sender;
            app.Context.Response.Headers.Add("CurrentUrl",app.Context. Request.CurrentExecutionFilePath);
        }

    } 
```

它非常适合我！现在，在我的每个响应中，`JQuery` `$.post`我都有请求的`url`以及其他响应标头，这些标头是`POST`由 status `302`, `303`,... 的方法产生的。

另一个重要的事情是无需在服务器端或客户端修改代码。

接下来是能够以这种方式访问​​发布操作的其他信息，例如错误、消息和……。

我发布了这个，也许可以帮助某人:)

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2011-08-28T10:18:14.097

我在我正在修补的 django 应用程序上遇到了这个问题（免责声明：我正在修补学习，绝不是专家）。我想做的是使用 jQuery ajax 向资源发送 DELETE 请求，在服务器端将其删除，然后将重定向发送回（基本上）主页。当我`HttpResponseRedirect('/the-redirect/')`从 python 脚本发送时，jQuery 的 ajax 方法收到 200 而不是 302。所以，我所做的是发送 300 的响应：

```
response = HttpResponse(status='300')
response['Location'] = '/the-redirect/' 
return  response 
```

然后我使用 jQuery.ajax 在客户端发送/处理请求，如下所示：

```
<button onclick="*the-jquery*">Delete</button>

where *the-jquery* =
$.ajax({ 
  type: 'DELETE', 
  url: '/resource-url/', 
  complete: function(jqxhr){ 
    window.location = jqxhr.getResponseHeader('Location'); 
  } 
}); 
```

也许使用 300 并不“正确”，但至少它就像我想要的那样工作。

PS：在 SO 的移动版本上编辑这是一个巨大的痛苦。当我完成我的回答时，愚蠢的 ISP 将我的服务取消请求通过了！

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2012-04-10T19:38:59.417

您还可以挂钩 XMLHttpRequest 发送原型。这将适用于使用一个处理程序的所有发送（jQuery/dojo/etc）。

我编写了这段代码来处理 500 页过期错误，但它应该同样可以捕获 200 重定向。准备好 wikipedia entry on [XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest) onreadystatechange 关于readyState 的含义。

```
// Hook XMLHttpRequest
var oldXMLHttpRequestSend = XMLHttpRequest.prototype.send;

XMLHttpRequest.prototype.send = function() {
  //console.dir( this );

  this.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 500 && this.responseText.indexOf("Expired") != -1) {
      try {
        document.documentElement.innerHTML = this.responseText;
      } catch(error) {
        // IE makes document.documentElement read only
        document.body.innerHTML = this.responseText;
      }
    }
  };

  oldXMLHttpRequestSend.apply(this, arguments);
} 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2018-03-21T21:17:45.383

我使用来自@John 和@Arpad [链接](https://stackoverflow.com/a/8426947/4505142)和@RobWinch[链接的答案得到了一个可行的解决方案](https://stackoverflow.com/a/34366885/4505142)

我使用 Spring Security 3.2.9 和 jQuery 1.10.2。

扩展 Spring 的类以仅从 AJAX 请求引起 4XX 响应：

```
public class CustomLoginUrlAuthenticationEntryPoint extends LoginUrlAuthenticationEntryPoint {

    public CustomLoginUrlAuthenticationEntryPoint(final String loginFormUrl) {
        super(loginFormUrl);
    }

    // For AJAX requests for user that isn't logged in, need to return 403 status.
    // For normal requests, Spring does a (302) redirect to login.jsp which the browser handles normally.
    @Override
    public void commence(final HttpServletRequest request,
                         final HttpServletResponse response,
                         final AuthenticationException authException)
            throws IOException, ServletException {
        if ("XMLHttpRequest".equals(request.getHeader("X-Requested-With"))) {
            response.sendError(HttpServletResponse.SC_FORBIDDEN, "Access Denied");
        } else {
            super.commence(request, response, authException);
        }
    }
} 
```

applicationContext-security.xml

```
 <security:http auto-config="false" use-expressions="true" entry-point-ref="customAuthEntryPoint" >
    <security:form-login login-page='/login.jsp' default-target-url='/index.jsp'                             
                         authentication-failure-url="/login.jsp?error=true"
                         />    
    <security:access-denied-handler error-page="/errorPage.jsp"/> 
    <security:logout logout-success-url="/login.jsp?logout" />
...
    <bean id="customAuthEntryPoint" class="com.myapp.utils.CustomLoginUrlAuthenticationEntryPoint" scope="singleton">
        <constructor-arg value="/login.jsp" />
    </bean>
...
<bean id="requestCache" class="org.springframework.security.web.savedrequest.HttpSessionRequestCache">
    <property name="requestMatcher">
      <bean class="org.springframework.security.web.util.matcher.NegatedRequestMatcher">
        <constructor-arg>
          <bean class="org.springframework.security.web.util.matcher.MediaTypeRequestMatcher">
            <constructor-arg>
              <bean class="org.springframework.web.accept.HeaderContentNegotiationStrategy"/>
            </constructor-arg>
            <constructor-arg value="#{T(org.springframework.http.MediaType).APPLICATION_JSON}"/>
            <property name="useEquals" value="true"/>
          </bean>
        </constructor-arg>
      </bean>
    </property>
</bean> 
```

在我的 JSP 中，添加一个全局 AJAX 错误处理程序，如下[所示](https://stackoverflow.com/a/17990019/4505142)

```
 $( document ).ajaxError(function( event, jqxhr, settings, thrownError ) {
      if ( jqxhr.status === 403 ) {
          window.location = "login.jsp";
      } else {
          if(thrownError != null) {
              alert(thrownError);
          } else {
              alert("error");
          }
      }
  }); 
```

此外，从 JSP 页面中的 AJAX 调用中删除现有的错误处理程序：

```
 var str = $("#viewForm").serialize();
        $.ajax({
            url: "get_mongoDB_doc_versions.do",
            type: "post",
            data: str,
            cache: false,
            async: false,
            dataType: "json",
            success: function(data) { ... },
//            error: function (jqXHR, textStatus, errorStr) {
//                 if(textStatus != null)
//                     alert(textStatus);
//                 else if(errorStr != null)
//                     alert(errorStr);
//                 else
//                     alert("error");
//            }
        }); 
```

我希望它可以帮助其他人。

**Update1** 我发现我需要将选项 (always-use-default-target="true") 添加到表单登录配置中。这是必需的，因为在 AJAX 请求被重定向到登录页面后（由于会话过期），Spring 会记住先前的 AJAX 请求并在登录后自动重定向到它。这会导致返回的 JSON 显示在浏览器页面上。当然，不是我想要的。

**Update2** 不使用`always-use-default-target="true"`，而是使用 @RobWinch 阻止来自 requstCache 的 AJAX 请求的示例。这允许在登录后将普通链接重定向到其原始目标，但 AJAX 会在登录后转到主页。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2021-09-29T14:07:43.313

作为 ajax 的替代方案，正在开发一个新的[**Fetch API**](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)，它允许手动重定向处理。[您需要检查](https://caniuse.com/?search=fetch)当前的浏览器支持是否足以满足您的需求。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2019-12-27T13:12:49.310

在以下情况下使用 statusCode 选项，重定向通常是 301、302 重定向状态代码。

```
$.ajax({
    type: <HTTP_METHOD>,
    url:  {server.url},
    data: {someData: true},
    statusCode: {
        301: function(responseObject, textStatus, errorThrown) {
            //yor code goes here
        },
        302: function(responseObject, textStatus, errorThrown) {
            //yor code goes here
        }           
    }
})
.done(function(data){
    alert(data);
})
.fail(function(jqXHR, textStatus){
    alert('Something went wrong: ' + textStatus);
})
.always(function(jqXHR, textStatus) {
   alert('Ajax request was finished')
}); 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2021-05-25T09:11:44.697

后端弹簧`@ExceptionHandler`。

*   400 和业务相关异常的错误字符串（在弹出窗口中显示）
*   302 和 Location 标头到错误/登录页面，用于浏览器请求的应用程序异常（由浏览器自动重定向）
*   500/400 和 Location 标头到错误/登录页面，用于通过 ajax 回调重定向 ajax 请求

通过用户会话传递到错误页面的异常详细信息

```
@Order(HIGHEST_PRECEDENCE)
public class ExceptionHandlerAdvise {

    private static Logger logger = LoggerFactory.getLogger(ExceptionHandlerAdvise.class);

    @Autowired
    private UserInfo userInfo;

    @ExceptionHandler(value = Exception.class)
    protected ResponseEntity<Object> handleException(Exception ex, WebRequest request) {
        HttpHeaders headers = new HttpHeaders();
        if (isBusinessException(ex)) {
            logger.warn(getRequestURL(request), ex);
            return new ResponseEntity<>(getUserFriendlyErrorMessage(ex), headers, BAD_REQUEST);
        } else {
            logger.error(getRequestURL(request), ex);
            userInfo.setLastError(ex);
            headers.add("Location", "/euc-portal/fault");
            return new ResponseEntity<>(null, headers, isAjaxRequest(request) ? INTERNAL_SERVER_ERROR : FOUND);
        }
    }
}

private boolean isAjaxRequest(WebRequest request) {
    return request.getHeader("x-requested-with") != null;
}

private String getRequestURL(WebRequest request) {
    if (request instanceof ServletWebRequest) {
        HttpServletRequest servletRequest = ((ServletWebRequest) request).getRequest();
        StringBuilder uri = new StringBuilder(servletRequest.getRequestURI());
        if (servletRequest.getQueryString() != null) {
            uri.append("?");
            uri.append(servletRequest.getQueryString());
        }
        return uri.toString();
    }
    return request.getContextPath();
} 
```

登录处理程序拦截器

```
@Service
public class LoginHandlerInterceptor implements HandlerInterceptor {

    @Autowired
    private UserInfo userInfo;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        if (userInfo.getPrincipal() == null && !(request.getRequestURI().contains(LOGIN_URL) || request.getRequestURI().contains(FAULT_URL) || request.getRequestURI().startsWith("/app/css"))) {
            response.addHeader("Location", LOGIN_URL);
            response.setStatus(isAjaxRequest(request) ? BAD_REQUEST.value() : FOUND.value());
            return false;
        }
        return true;
    }
} 
```

客户端代码

```
$.post('/app/request', params).done(function(response) {
    ...
}).fail(function(response) {
    if (response.getResponseHeader('Location')) {
        window.top.location.href = response.getResponseHeader('Location');
        return;
    }
    alert(response);
}); 
```

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2008-10-19T10:14:46.440

此外，您可能希望将用户重定向到给定的标头 URL。所以最后它看起来像这样：

```
$.ajax({
    //.... other definition
    complete:function(xmlHttp){
        if(xmlHttp.status.toString()[0]=='3'){
        top.location.href = xmlHttp.getResponseHeader('Location');
    }
}); 
```

UPD：哎呀。有同样的任务，但它不起作用。做这种事。当我找到它时，我会告诉你解决方案。

* * *

## 回答 #34

> 赞同：-3
> 
> 时间：2014-03-15T15:49:40.200

这对我有用：

```
success: function(data, textStatus, xhr) {

        console.log(xhr.status);
} 
```

成功后，ajax 将获得与浏览器从服务器获取的相同状态码并执行它。

# vb.net - ClickOnce 应用程序未打开

> ID：199103
> 
> 赞同：2
> 
> 时间：2008-10-13T21:31:35.893
> 
> 标签：vb.net, clickonce

我有一个试图在我的计算机上安装的 VB.NET ClickOnce 应用程序。以前，我能够毫无问题地安装和运行这些应用程序。现在，当我安装应用程序时，我可以看到一个窗口打开的闪光，然后什么也没有。（使用任务管理器查看时，也没有任何进程挂起或任何东西。）

经过一番挖掘后，我注意到我的 Internet 临时文件中有一些文件，其名称类似于“FusionBindError”，然后是我的应用程序名称和不同的 DLL 名称。

我已经完成了我在网上可以找到的所有事情，重新安装应用程序，重新安装 .NET Framework，删除我的本地设置文件夹并重新登录。

有没有人有任何其他想法让我尝试？

我尝试了 Mage.exe 建议，但没有帮助。与其他安装位置建议相同。应用程序在屏幕底部闪烁，但未打开。我尝试使用 FUSLOGVW 来检查绑定，但那里没有任何显示。（好或坏，没有绑定条目。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T12:46:31.430

您是否尝试过使用 mage.exe？这是 .NET 框架附带的命令行工具。启动 VS 命令提示符，然后尝试 mage -cc。这将清除您的应用程序缓存并强制进行新的单击一次下载。这是当我的 click-once 应用程序失败时我做的第一件事，它在 99% 的时间内都能正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T02:22:30.623

几个建议：

FusLogVW 不适合您，因为您必须在注册表中启用程序集绑定失败日志记录。此[MSDN 文章描述](http://msdn.microsoft.com/en-us/library/e74a18c4(VS.71).aspx)了如何执行此操作。

想到的另一件事是，可能是 ClickOnce 应用程序安装，或者整个 ClickOnce 商店已损坏。尝试删除 ClickOnce 应用商店，然后重新安装该应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T21:46:51.293

可能添加了您手头没有的新先决条件。如果您使用的 URL 直接指向“my.application”或任何您的等价物，则不会处理先决条件。

因此，请尝试指向与 .application 文件在同一目录中创建的 setup.exe。

除此之外，听起来你在做所有正确的事情......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-28T11:08:03.997

此外，在应用程序实际运行的机器上运行 fuslogvw 实用程序可能很有用。或反光板。

然后看看是否确实加载了它的任何依赖项让你感到惊讶。

此外，对于这些类型的错误，请务必检查禁用防病毒驻留保护是否有帮助。有时它会导致访问程序集的清单等问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-12T14:20:47.813

我卸载了我的 Kensington Mouse 软件，这解决了我的安装错误。

谁知道我从来没有使用过的鼠标软件会造成这么大的麻烦？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-11-18T09:24:18.733

有时，如果您的机器工作了好几天，这个问题就会出现。尝试重新启动您的机器。同样的问题发生在我身上，当我重新启动机器时它就消失了。

# asp.net-2.0 - 如何从 Page.Master 转换到 ASP.NET 中的特定母版页

> ID：199113
> 
> 赞同：3
> 
> 时间：2008-10-13T21:34:05.453
> 
> 标签：asp.net-2.0

我有一个`BasePage`which 继承自`System.Web.UI.Page`，并且每个继承 的页面都`BasePage`将具有相同的母版页。

如何将`Page.Master`的`BasePage`转换为特定母版页，以便可以访问其上的属性？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-13T21:39:30.513

更好的方法是将 MasterType 属性添加到使用该母版的页面。然后，您可以通过页面对象简单地访问母版页属性。

```
<%@ MasterType VirtualPath="~/site.master" %> 
```

您只需在代码中使用它：

```
this.Master.propertyName 
```

访问当前页面的母版页属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T21:38:20.857

无法完成覆盖的 Master（它不是 Virtual），并且用 new 掩盖它会导致页面类无法获取其 master 的问题，因此最好的办法是第二个属性。

就像是：

```
public CustomMasterPage MasterPage
{
    get { return this.Master as CustomMasterPage; }
} 
```

在您的 BasePage 类中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T21:36:01.907

在 VB.Net

```
MasterPageVariable = Ctype(page.MasterPage, MasterPageClass) 
```

# asp.net - 子窗口上的隐藏字段是否无法从父窗口访问

> ID：199127
> 
> 赞同：1
> 
> 时间：2008-10-13T21:41:55.717
> 
> 标签：asp.net, javascript, telerik

我有包含字段的 asp.net 表单。当我访问此窗口时，我的 javascript 函数可以使用 getElementById() 方法通过 DOM 访问字段，当我将 postpack 打包到服务器时，我会收到客户端所做的更新。

但是，当我使用 Telerik 的 RadWindow 控件将表单作为子窗口启动时，javascript 无法访问子表单上的隐藏字段。相反，我得到空值。

我的问题是：

1.  从父 asp.net 窗体启动窗口时，子窗口上的隐藏字段是否不可访问？
2.  有没有人尝试过使用 Telerik 控件并遇到问题？

**编辑** 克雷格指出，id 可能不同。那么另外两个问题：

1.  你能确保你在服务器上分配的 id 被实际使用了吗？
2.  使用 getElementByName() 是访问 DOM 元素的更好机制吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T22:10:51.260

元素的 ID 很可能不是您认为的那样。检查呈现的页面并查看 ID 是否存在。我猜该页面被赋予了不同的 ID，因为它是在另一个控件中呈现的。

如果是这种情况，您可以让表单呈现一些通过访问控件客户端 ID 返回元素 ID 的脚本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T00:12:12.670

要获取您的 asp.net 控件的 ID，请执行以下操作：

```
<%= theControl.ClientID %> 
```

getElementByName 不如 getElementById 常用。ID 属性应该对于页面上的每个元素都是唯一的，而 name 属性可以重复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T20:40:45.073

大卫，我给你这个答案是因为我在我的代码中看到了同样的问题，而我发现的唯一真正的解决方案是我必须在两个地方支持“OnClick”功能......在我的情况下，我正在使用PetersDatePackage，但它位于 Telerik RAD Strip 上。

就我而言，控件位于.ascx页面上，JS代码如下：

```
function OnIncidentDateChange(ctrl, dtDate, bErr)
{
    var weekday = new Array(7);
    weekday[0] = "Sunday";
    weekday[1] = "Monday";
    weekday[2] = "Tuesday";
    weekday[3] = "Wednesday";
    weekday[4] = "Thursday";
    weekday[5] = "Friday";
    weekday[6] = "Saturday";

    <%=LabelDayOfWeek.ClientID %>.innerText = weekday[dtDate.getDay()];
} 
```

但是，这本身还不够。我必须将此代码添加到我的父页面。包含 Telerik 条带控件的页面。

```
// Dummy function?
function OnIncidentDateChange()
{
} 
```

一旦我这样做了，它就起作用了......

我不确定为什么，说实话，这对我来说毫无意义，可能只是 PDP 包的问题......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T20:52:32.773

我将 getElementsByName 用于同一组中的复选框。

至于控件的 ID，TonyB 有正确的想法，但请确保您在 PreRender 事件处理程序中引用 ClientID 属性，因为如果您在页面生命周期中过早地这样做，它还不会可用）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-16T20:56:32.283

在 RadWindow 加载它之前，javascript 是否有可能试图获取对隐藏字段的引用？我相信我之前遇到过这个问题，不得不使用 setTimeout 来解决这个问题。

# linux - 如何增加 /proc/pid/cmdline 4096 字节限制？

> ID：199130
> 
> 赞同：40
> 
> 时间：2008-10-13T21:43:53.607
> 
> 标签：linux, process, classpath, pid, limits

对于类路径很长的 Java 应用程序，在使用 ps 时，我看不到 arg 列表末尾附近指定的主类。我认为这源于我的 Ubuntu 系统对 /proc/pid/cmdline 的大小限制。我怎样才能增加这个限制？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2010-09-08T15:08:10.067

对于查看 Java 进程，[jps](http://download.oracle.com/javase/6/docs/technotes/tools/share/jps.html)非常有用。

这将为您提供主类和 jvm 参数：

```
jps -vl | grep <pid> 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-13T22:13:50.847

您不能动态更改它，限制在内核中硬编码为 fs/proc/base.c 中的 PAGE_SIZE：

```
 274        int res = 0;
 275        unsigned int len;
 276        struct mm_struct *mm = get_task_mm(task);
 277        if (!mm)
 278                goto out;
 279        if (!mm->arg_end)
 280                goto out_mm;    /* Shh! No looking before we're done */
 281
 282        len = mm->arg_end - mm->arg_start;
 283 
 284        if (len > PAGE_SIZE)
 285                len = PAGE_SIZE;
 286 
 287        res = access_process_vm(task, mm->arg_start, buffer, len, 0); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-08-17T05:34:27.433

我暂时绕过 ps（或者更确切地说 /proc/PID/cmdline）的 4096 个字符的命令行参数限制是通过使用一个小脚本来替换 java 命令。

在开发过程中，我总是使用 SUN 的未打包 JDK 版本，并且从不使用已安装的 JRE 或操作系统的 JDK，无论是 Linux 还是 Windows（例如，下载 bin 与 rpm.bin）。我不建议为您的默认 Java 安装更改脚本（例如，因为它可能会中断更新或被覆盖或产生问题或......）

所以假设java命令在/x/jdks/jdk1.6.0_16_x32/bin/java

首先将实际的二进制文件移开：

```
mv /x/jdks/jdk1.6.0_16_x32/bin/java /x/jdks/jdk1.6.0_16_x32/bin/java.orig 
```

然后创建一个脚本 /x/jdks/jdk1.6.0_16_x32/bin/java ，例如：

```
 #!/bin/bash

    echo "$@" > /tmp/java.$$.cmdline
   /x/jdks/jdk1.6.0_16_x32/bin/java.orig $@ 
```

然后使脚本可运行

```
chmod a+x /x/jdks/jdk1.6.0_16_x32/bin/java 
```

如果复制和粘贴上述内容，您应该确保 /x/jdks/jdk1.6.0_16_x32/bin/java 中没有多余的空格，并且 #!/bin/bash 是第一行

完整的命令行以 /tmp/java.26835.cmdline 结尾，其中 26835 是 shell 脚本的 PID。我认为命令行参数的数量也有一些 shell 限制，不记得但可能是 64K 字符。

您可以更改脚本以在末尾从 /tmp/java.PROCESS_ID.cmdline 中删除命令行文本

获得命令行后，我总是将脚本移动到类似“java.script”的位置，然后将实际的二进制 java.orig 复制 (cp -a) 回 java。我只在达到 4K 限制时才使用脚本。

转义字符可能存在问题，甚至路径中的空格等可能存在问题，但对我来说效果很好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-08-05T19:00:12.760

您可以使用`jconsole`不受所有长度限制来访问原始命令行。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-03-13T10:04:30.870

可以使用更新的 linux 发行版，其中删除了此限制，例如 RHEL 6.8 或更高版本

*“ps 命令的 /proc/pid/cmdline 文件长度限制以前在内核中硬编码为 4096 个字符。这次更新确保 /proc/pid/cmdline 的长度不受限制，这对于列出进程特别有用带有长的命令行参数。(BZ#1100069)"*

[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/6.8_Release_Notes/new_features_kernel.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/6.8_Release_Notes/new_features_kernel.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-05-26T07:58:36.350

对于只对检查主类获得的命令行参数感兴趣的基于 Java 的程序，您可以运行：

```
jps -m 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-10-13T22:13:21.427

我很确定，如果您实际上看到 /proc/$pid/cmdline 中的参数被截断，那么您实际上超出了操作系统支持的最大参数长度。据我所知，在 Linux 中，大小仅限于内存页面大小。请参阅[“ps ww”长度限制](http://www.linuxquestions.org/questions/linux-general-1/ps-ww-length-restriction-665255/)以供参考。

解决这个问题的唯一方法是重新编译内核。如果您有兴趣解决这个问题，那么您可能会发现这篇文章很有用：[“参数列表太长”：超越参数和限制](http://www.linuxjournal.com/article/6060)

附加参考：
[ARG_MAX，新进程的最大参数长度](http://www.in-ulm.de/~mascheck/various/argmax/)

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-10-13T21:47:34.800

也许 ps 的 'w' 参数是你想要的。添加两个“w”以获得更大的输出。它告诉 ps 忽略终端的线宽。

# asp.net-mvc - 如何使用 linq2sql 存储库在我的 Asp.net Mvc 中实现缓存策略？

> ID：199138
> 
> 赞同：6
> 
> 时间：2008-10-13T21:47:18.267
> 
> 标签：asp.net-mvc, linq-to-sql, caching, datacontext

我不知道我应该使用 httpcontext 缓存还是企业库缓存应用程序块。此外，在删除或更新属于缓存列表的实体时，缓存策略的最佳模式是什么？

我应该从缓存中删除所有列表还是只从缓存列表中删除该项目？如果我更新它，我将从缓存中删除列表或更新其中的实体。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-13T22:29:52.097

在对两者进行了一些测试后，我在我们的代码上下文中对缓存应用程序块进行了全面审查，并在博客中记录了我的经验。它使用起来非常简单，功能强大，足以满足我们的需求。我会推荐它，[我的结果被记录在这里](http://oddiandeveloper.blogspot.com/2008/10/microsoft-enterprise-library-4-cache.html)。

在您的位置上，我将使用存储库模式来维护我的缓存，它适用于数据库数据集，并且应该同样适用于您自己的缓存。如果您不熟悉存储库模式，[请查看 Steven Walther 的这篇文章。](http://www.asp.net/learn/mvc/tutorial-10-vb.aspx). 但是，我倾向于不同意先前的答案，只取出您需要修改的项目，其余的保持不变。如果您愿意，这将允许您独立于整个列表使缓存中的项目过期。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T22:27:04.237

有几种实现缓存的方法，httpcontext 是最简单的一种，但不一定是最差的。看看[memcached](http://www.danga.com/memcached/)或[MS Velocity](http://blogs.msdn.com/velocity/)，它们都可以用作 ASP.NET 缓存的后端。尤其是 memcached 以做得非常好而闻名。

至于缓存策略：你必须决定什么最适合你。我个人会在更新/删除时从缓存中删除完整列表，而不是试图找出实体是否在列表中，因为它需要一个不平凡的您需要考虑并发问题（锁定列表，因为有人可能会更新/删除另一个实体）。有时在适当的位置更新实体确实有意义（如果您有一个包含所有需要的数据的完整对象），有时这是浪费时间，因为由于某些状态更改，实体应该移动到其他地方（例如，当您排序时LastChangedDate 等）

不要忘记优化您的数据库代码，以便刷新刷新列表不会花费太多时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-29T06:55:56.750

只需在要缓存的每个操作甚至控制器上使用 [OutputCache(Duration=10, VaryByParam="none")] 即可。

来自[http://www.asp.net/mvc/tutorials/older-versions/controllers-and-routing/improving-performance-with-output-caching-cs](http://www.asp.net/mvc/tutorials/older-versions/controllers-and-routing/improving-performance-with-output-caching-cs)

# sql - ASP.NET：将外部变量传递给 标记 ASP.NET 2.0

> ID：199142
> 
> 赞同：0
> 
> 时间：2008-10-13T21:48:51.197
> 
> 标签：sql, vb.net, asp.net-2.0, selectcommand

我正在设计一些基于 VB 的 ASP.NET 2.0，并且我试图更多地利用 Visual Studio 提供的各种 ASP 标签，而不是在代码隐藏中手工编写所有内容。我想从 Session 中传递一个外部变量来识别查询的用户是谁。

```
<asp:sqldatasource id="DataStores" runat="server" connectionstring="<%$ ConnectionStrings:MY_CONNECTION %>"
          providername="<%$ ConnectionStrings:MY_CONNECTION.ProviderName %>"
          selectcommand="SELECT THING1, THING2 FROM DATA_TABLE WHERE (THING2 IN (SELECT THING2 FROM RELATED_DATA_TABLE WHERE (USERNAME = @user)))"
          onselecting="Data_Stores_Selecting">

          <SelectParameters>
          <asp:parameter name="user" defaultvalue ="" />
          </SelectParameters>

          </asp:sqldatasource> 
```

在我背后的代码中，我有：

```
Protected Sub Data_Stores_Selecting(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.SqlDataSourceSelectingEventArgs) Handles Data_Stores.Selecting

    e.Command.Parameters("user").Value = Session("userid")
End Sub 
```

Oracle 用 ORA-01036（非法变量名）对我大喊大叫。我在查询中声明变量错误吗？

我认为外部变量与 @ 前缀共享相同的名称。据我了解，这应该是在执行选择时将我想要的值放入查询中。

编辑：好的，感谢到目前为止的建议，第一个错误已得到纠正，我需要使用 : 而不是 @ 用于查询中的变量声明。现在它生成一个 ORA-01745 无效的主机/绑定变量名。

再次编辑：好的，看起来 user 是一个保留字。现在可以了！感谢您对此的其他观点。我没有想到这种方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T21:51:20.113

我相信 Oracle 使用冒号“：”，而不是符号“@”。

* * *

“用户”可能是一个保留字。将其更改为“userID”或类似名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T00:31:02.990

您可能需要考虑使用[SessionParameter](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.sessionparameter(VS.80).aspx)而不是仅使用 Parameter 并让 SqlDataSource 直接从会话中提取用户 ID，而无需您进行任何干预。此外，上面链接页面上的示例似乎暗示您应该使用 ? 而不是 @user 用于 ODBC 连接的参数替换。我认为参数替换将由 SqlDataSource 完成，而不是传递给 Oracle，也就是说，它会在将查询发送到数据库之前用用户 ID 的实际值代替参数（当然是正确引用）。

```
<SelectParameters>
  <SessionParameter Name="userID" SessionField="user" DefaultValue="" />
</SelectParameters> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T00:57:05.937

使用 ASP.NET 的 SessionParameter 绝对是最好的选择——这就是我们拥有它的原因 :)

使用 ASP.NET 参数，您可以轻松地将来自静态源、会话状态、查询字符串、控件属性值、表单发布数据、cookie 和用户配置文件的查询值包含在查询中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T07:11:53.867

```
<asp:sqldatasource id="DataStores" runat="server" connectionstring="<%$ ConnectionStrings:MY_CONNECTION %>"
      providername="<%$ ConnectionStrings:MY_CONNECTION.ProviderName %>"
      selectcommand="SELECT THING1, THING2 FROM DATA_TABLE WHERE (THING2 IN (SELECT THING2 FROM RELATED_DATA_TABLE WHERE (USERNAME = @user)))"
      onselecting="NAME_OF_SUB_Selecting">
      <SelectParameters>
      <asp:parameter name="@user1" defaultvalue ="" />
      </SelectParameters>
      </asp:sqldatasource>

Protected Sub NAME_OF_SUB_Selecting(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.SqlDataSourceSelectingEventArgs) Handles Data_Stores.Selecting
   e.Command.Parameters("@user1").Value = Membership.GetUser.ProviderUserKey.ToString()
End Sub 
```

# java - 您如何使用带有 apache 的 commons httpclient 的 NTLM 身份验证以编程方式对 Web 服务器进行身份验证？

> ID：199145
> 
> 赞同：2
> 
> 时间：2008-10-13T21:50:02.457
> 
> 标签：java, httpclient

我正在使用这段代码，我得到了下面列出的堆栈跟踪。我只使用 https 和基本身份验证，但不是 ntlm。

```
HttpClient client = null;
HttpMethod get = null;
try
{
  Protocol myhttps = new Protocol("https", ((ProtocolSocketFactory) new EasySSLProtocolSocketFactory()), 443);
  Protocol.registerProtocol("https", myhttps);
  client = new HttpClient();
  get = new GetMethod("https://tt.dummycorp.com/tmtrack/");
  Credentials creds = new NTCredentials("dummy", "dummy123", "host", "DUMMYDOMAIN");
  client.getState().setCredentials(AuthScope.ANY, creds);
  get.setDoAuthentication(true);
  int resultCode = client.executeMethod(get);
  System.out.println(get.getResponseBodyAsString());
}

javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path validation failed: java.security.cert.CertPathValidatorException: signature check failed
    at com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Alerts.java:174)
    at com.sun.net.ssl.internal.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1591)
    at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:187)
    at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:181)
    at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:975)
    at com.sun.net.ssl.internal.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:123)
    at com.sun.net.ssl.internal.ssl.Handshaker.processLoop(Handshaker.java:516)
    at com.sun.net.ssl.internal.ssl.Handshaker.process_record(Handshaker.java:454)
    at com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:884)
    at com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1096)
    at com.sun.net.ssl.internal.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:623)
    at com.sun.net.ssl.internal.ssl.AppOutputStream.write(AppOutputStream.java:59)
    at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
    at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
    at org.apache.commons.httpclient.HttpConnection.flushRequestOutputStream(HttpConnection.java:828)
    at org.apache.commons.httpclient.HttpMethodBase.writeRequest(HttpMethodBase.java:2116)
    at org.apache.commons.httpclient.HttpMethodBase.execute(HttpMethodBase.java:1096)
    at org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:398)
    at org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:171)
    at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:397)
    at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:323)
    at com.dummycorp.teamtrack.TeamTrackHack.main(TeamTrackHack.java:38)
Caused by: sun.security.validator.ValidatorException: PKIX path validation failed: java.security.cert.CertPathValidatorException: signature check failed
    at sun.security.validator.PKIXValidator.doValidate(PKIXValidator.java:251)
    at sun.security.validator.PKIXValidator.doValidate(PKIXValidator.java:234)
    at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:158)
    at sun.security.validator.Validator.validate(Validator.java:218)
    at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:126)
    at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:209)
    at org.apache.commons.httpclient.contrib.ssl.EasyX509TrustManager.checkServerTrusted(EasyX509TrustManager.java:104)
    at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:967)
    ... 17 more
Caused by: java.security.cert.CertPathValidatorException: signature check failed
    at sun.security.provider.certpath.PKIXMasterCertPathValidator.validate(PKIXMasterCertPathValidator.java:139)
    at sun.security.provider.certpath.PKIXCertPathValidator.doValidate(PKIXCertPathValidator.java:316)
    at sun.security.provider.certpath.PKIXCertPathValidator.engineValidate(PKIXCertPathValidator.java:178)
    at java.security.cert.CertPathValidator.validate(CertPathValidator.java:250)
    at sun.security.validator.PKIXValidator.doValidate(PKIXValidator.java:246)
    ... 24 more
Caused by: java.security.SignatureException: Signature does not match.
    at sun.security.x509.X509CertImpl.verify(X509CertImpl.java:446)
    at sun.security.provider.certpath.BasicChecker.verifySignature(BasicChecker.java:133)
    at sun.security.provider.certpath.BasicChecker.check(BasicChecker.java:112)
    at sun.security.provider.certpath.PKIXMasterCertPathValidator.validate(PKIXMasterCertPathValidator.java:117)
    ... 28 more 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T11:00:11.873

HttpClient 不完全支持 NTLM。请查看[已知限制和问题](http://hc.apache.org/httpclient-3.x/authentication.html#Known_limitations_and_problems)。关于 NTLM 的 HttpClient 文档有点混乱，但底线是它们不支持 NTLMv2，这使得它在这方面几乎不可用。

NTLM 由标准的 java HttpURLConnection ( [link](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4626557) ) 支持，但是 HttpClient 比 jdk 的 HttpURLConnection 有一些优势。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T09:15:09.203

看看[这里](http://nodsw.com/blog/leeland/2006/12/06-no-more-unable-find-valid-certification-path-requested-target)发布的实用程序。

它解决了不同的问题，即缺少证书，而您安装了无效的证书，但它关于已安装证书的详细输出可能会有所帮助。

# qt - Qt 应用程序严重失败

> ID：199151
> 
> 赞同：6
> 
> 时间：2008-10-13T21:53:14.620
> 
> 标签：qt, reference, g++, mingw, undefined

我正在尝试将 Qt 应用程序与其库链接，并且链接器 (MinGW) 会发出数百行如下所示的内容，我不确定如何继续。

```
cpp: 未定义对 `_Unwind_SjLj_Register' 的引用
 c:/qt/lib/libQtCore.a(qcoreapplication_win.o)(.text+0x29d):qcoreapplication_win。
 cpp: 未定义对 `_Unwind_SjLj_Unregister' 的引用
 c:/qt/lib/libQtCore.a(qcoreapplication_win.o)(.text+0x38c):qcoreapplication_win。
 cpp：未定义的对 `_Unwind_SjLj_Resume' 的引用
 c:/qt/lib/libQtCore.a(qcoreapplication_win.o)(.text+0x4ce):qcoreapplication_win。
 cpp: 未定义对 `_Unwind_SjLj_Register' 的引用
 c:/qt/lib/libQtCore.a(qcoreapplication_win.o)(.text+0x53e):qcoreapplication_win。
 cpp: 未定义对 `_Unwind_SjLj_Unregister' 的引用
 c:/qt/lib/libQtCore.a(qcoreapplication_win.o)(.text+0x635):qcoreapplication_win。
 cpp：未定义的对 `_Unwind_SjLj_Resume' 的引用

```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-13T23:04:40.793

我不知道...但对我来说，关于 Unwind 的大量信息表明您在库是否使用异常编译和您的应用程序是否使用异常编译之间存在不匹配。

如果您需要例外，请确保您已通过在 qmake 文件中添加以下行来启用它们：

```
CONFIG += exceptions 
```

或者，如果您不想要异常，请使用相反的

```
CONFIG -= exceptions 
```

无论您做什么，都不要使用 C++ 编译器选项自行设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T22:51:15.890

自从我进行任何 Qt 开发以来已经有一段时间了，但我记得只有几个实例会喷出大量这样的消息。

*   Qt 的包含文件与共享库的版本不同……这发生在我升级时，由于某种原因，您必须手动升级包含文件。
*   Qt 库完全丢失了……我隐约记得编译器工作正常，但链接器在我第一次启动时失败了。

我正在针对 ARM 处理器进行 Qt 开发，因此在交叉编译时我遇到了额外的奇怪问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-16T01:38:18.267

我知道的 2 个可能的原因：

1.  如果您尝试使用 gcc3 链接器链接 gcc4 库。
2.  您需要`-lstdc++`标志到编译命令的末尾

# java - 强制完整的 Java 小程序刷新 (AWT)

> ID：199152
> 
> 赞同：1
> 
> 时间：2008-10-13T21:53:51.247
> 
> 标签：java, macos, applet, refresh, awt

我有一个使用 AWT 的 Java Applet。在某些（罕见）情况下，平台无法正确刷新屏幕。我可以移动或最小化/最大化窗口并查看我的小程序是否正确刷新。我正在寻找能够给我最完整的小程序屏幕重绘的代码，模拟最小化/最大化的行为。

我尝试在父容器上调用paint()/repaint()/invalidate()/update() 的各种组合并在各种子容器上递归。但是，没有任何组合（我发现）可以清除我遇到的框架错误。我正在寻找完全刷新小程序的技术，即使它们可能会导致一些轻微的闪烁，因为我只会在有问题的平台上调用此代码。

在我的测试中，迁移到 Swing 并没有帮助解决我的问题。

顺便说一下，这是我之前（更复杂的）帖子的简化：[Java Applet, AWT Refresh problem Mac OS X 10.4](https://stackoverflow.com/questions/184491/java-applet-awt-refresh-problem-mac-os-x-104)

编辑：线程调查并没有解决这个问题。将最佳答案标记为好答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T22:30:23.513

如果您没有在 AWT/Swing 中仔细编程，这种情况总是会发生。

首先，您应该在事件线程上完成所有工作。这意味着您不能在主语句（或它直接调用的任何内容）中执行任何操作。我知道曾经发明的每一个 Java GUI 应用程序都违反了这条规则，但这就是规则。

在大多数情况下，他们过去常说您可以使用非 awt 线程，直到窗口“实现”（pack/setVisible），但 Sun 发现这并不总是有效。

其次，当你在 AWT 线程上得到一个事件时，一定要快速返回它。切勿休眠或执行长时间操作。

第三，（这是“First”的扩展，如果你得到一个尚未在 AWT 工作线程上的回调，请确保在对 GUI 执行任何操作之前将它放在 AWT 线程上。

通常，由 AWT 组件生成的任何事件都将在正确的线程上。由计时器、手动创建的线程或传递给 main() 的事件生成的事件不是。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T22:10:40.777

正如您所提到的，用于此类问题的方法是重新绘制。您可能会看到正在使用的 JVM 存在问题。我建议使用不同版本的 Sun JVM 甚至是用于 IE 的 MS VM，以查看这是否是与 VM 相关的问题——它实际上可能与您的代码无关。

我之前实际上没有尝试过这个，但是一个创造性的方法（即讨厌的黑客）可能是从小程序执行 javascript 来调用 DOM 方法来模拟调整窗口的大小，或者可能调用焦点在身体上试图导致画布的外部重新绘制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-06T16:46:52.650

不确定这是否与您所看到的有关，但是如果您遇到 AWT 事件队列的性能，java 2d + 3d 世界（图形管道人员）将指向线程策略，然后您将进入处置问题。

这个讨论一直在关注使用 AWT 事件队列的图形设计，如使用“重绘”。

在线程化方法中，存在关闭问题。

java/awt/SequencedEvent 中“dispose”的注释将我们指向“AWT 线程问题”和“Autoshutdown”。

我认为这一点信息至少可以解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T13:03:02.677

通过切换到 Swing，我能够修复 99% 的 AWT Applet 重绘问题。Swing 在刷新时似乎更可靠。

早些时候，我的 applet 代码中有很多手动 repaints()，但是在 Swing 中，这些都被删除了，applet 现在更快了，尤其是在终端服务器/LTSP 下。

我在其中放置了关键的东西：

```
public class VeryFastPanel extends JPanel {

    /**
         *
         */
        private static final long serialVersionUID = 1L;

        public void update(Graphics g) {

      paint(g);
    }

} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-23T17:30:11.617

我发现了一个与您遇到的问题相同的问题。经过一些测试，我发现这可能与 Aero 和 Intel 图形适配器有关。就我而言，该应用程序仅在使用电池供电且没有交流适配器的笔记本电脑时才停止重新绘制。如果您在 Intel 驱动程序配置中禁用某些节能功能（尤其是旧驱动程序版本中的 Intel 2D 显示技术），Java 将再次正常重新绘制。

就我而言，我还找到了通过注册表禁用此选项的方法。它没有记录，但它有效。

# asp.net - ASP .Net 错误“试图读取或写入受保护的内存。这通常表明其他内存已损坏。”

> ID：199154
> 
> 赞同：2
> 
> 时间：2008-10-13T21:53:58.407
> 
> 标签：asp.net, vb.net

尝试加载 RSS 提要时出现以下错误：

> 尝试读取或写入受保护的内存。这通常表明其他内存已损坏。

我的代码在我的本地主机上运行良好，只有当我将它上传到我的专用服务器时才会出现错误！

这是代码：

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load

    Dim signJ As String = DropDownList1.SelectedValue

    If signJ <> "" Then
        Try
            Dim xmlDoc As XmlDocument = New XmlDocument
            Dim xdsData As XmlDataSource = New XmlDataSource
            Dim xpath_path As String = String.Empty
            Dim RSS_Feed As String = String.Empty

            xpath_path = "rss/channel/item[title='" & signJ & "']"
            RSS_Feed = "http://feedurl.."

            xmlDoc.Load(RSS_Feed)
            xdsData.Data = xmlDoc.OuterXml
            xdsData.XPath = xpath_path
            rptData.DataSource = xdsData
            rptData.DataBind()
        Catch ex As Exception
            Response.Write(ex.Message)
        End Try
    End If

End Sub 
```

此行发生错误：`xmlDoc.Load(RSS_Feed)`

真的卡在这个上了！干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-02T11:43:35.687

我们的行为与 Todd Smith 提到的相同。升级到 .Net 3.5 SP1 后，我们收到此错误。

在我们的案例中，原因是使用 Remotesoft Protector**保护/混淆了我们的 DLL。**

这很可能只是我们的问题，而不是其他任何人的解决方案。尽管如此，我想我会在这里提到它，因为它确实花了我们几个小时才能找到。

如果您保护，请混淆您的 DLL：禁用它可能值得一试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T22:02:43.413

我不熟悉此错误，但您是否验证了您的安全/权限在专用服务器上设置正确？

此外，您可能需要确认您可以直接从专用服务器上的浏览器访问源。

[此链接](http://forums.asp.net/p/675515/675515.aspx)可能会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T17:03:17.263

我明白了

> 尝试读取或写入受保护的内存

安装 .NET 3.5 **SP1**时出错（因此我可以开发 asp.net mvc 应用程序）。

在没有服务包的情况下降级到 .NET 3.5 可以修复错误，但当然会阻止我进行 mvc 开发。是时候清理虚拟机了。

# php - 加入查询，我该怎么做才能正确显示数据？

> ID：199158
> 
> 赞同：0
> 
> 时间：2008-10-13T21:56:02.180
> 
> 标签：php, mysql

我有一张桌子，里面存放着所有的志愿者，每个志愿者都会被分配到一个合适的场地来工作。有一张桌子可以存放所有场地。

它将志愿者的适当场地分配存储到列`venue_id`中。

```
table: venues
columns: id, venue_name

table: volunteers_2009
columns: id, lname, fname, etc.., venue_id 
```

这是显示志愿者列表的功能，我遇到的问题是显示他们的场地分配。我从来没有过多地使用 MySQL 连接，因为这是我第一次将两个表连接在一起以获取我需要的适当信息。

所以我希望它去志愿者_2009 表，获取场地_id，去场地表，匹配`volunteers_2009.venue_id to venues.id`，显示`venues.venue_name`，所以在列表中它将显示志愿者的场地分配。

![替代文字](https://i.stack.imgur.com/83QdA.jpg)

```
<?php
// -----------------------------------------------------
//it displays appropriate columns based on what table you are viewing
function displayTable($table, $order, $sort) {
    $query = "select * from $table ORDER by $order $sort";
    $result = mysql_query($query);

    // volunteer's venue query
    $query_venues = "SELECT volunteers_2009.venue_id, venues.venue_name FROM volunteers_2009 JOIN venues ON volunteers_2009.venue_id = venues.id";
    $result_venues = mysql_query($query_venues);

    if($_POST) { ?>
        <table id="box-table-a">
        <tr>
            <th>Name</th>
            <?php if($table == 'maillist') { ?>
                <th>Email</th>
            <?php } ?>
            <?php if($table == 'volunteers_2008' || $table == 'volunteers_2009') { ?>
                <th>Comments</th>
            <?php } ?>
            <?php if($table == 'volunteers_2009') { ?>
                <th>Interests</th>
                <th>Venue</th>
            <?php } ?>
            <th>Edit</th>
        </tr>
        <tr>
        <?php
        while($row = mysql_fetch_array($result))
        {
            $i = 0;
            while($i <=0)
            {
                print '<td>'.$row['fname'].' '.$row['lname'].'</td>';
                if($table == 'maillist') {
                    print '<td><a href="mailto:'.strtolower($row['email']).'">'.strtolower($row['email']).'</a></td>';
                }
                if($table == 'volunteers_2008' || $table == 'volunteers_2009') {
                    print '<td><small>'.substr($row['comments'], 0, 32).'</small></td>';
                }
                if($table == 'volunteers_2009') {
                    print '<td><small>1) '.$row['choice1'].'<br>2) '.$row['choice2'].'<br>3) '.$row['choice3'].'</small></td>'; ?>
                    <td> <?php
                            if($row_venues['venue_name'] != '') {
                                // print venue assigned
                                print $row_venues['venue_id'].' '.$row_venues['venue_name'].' ';
                            } else { print 'No Venue Assigned'; } ?>
                    </td> <?php
                } ?>
                <td><a href="?mode=upd&id=<?= $row[id] ?>&table=<?= $table ?>">Upd</a> / <a href="?mode=del&id=<?= $row[id] ?>&table=<?= $table ?>" onclick="return confirm('Are you sure you want to delete?')">Del</a></td> <?php
                $i++;
            }
        print '</tr>';
        }
        print '</table>';
    }
}
// -----------------------------------------------------
?> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-13T22:14:00.847

从场地、志愿者_2009 中选择 field1、field2、field3，其中志愿者_2009.venue_id =venues.id

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T22:22:06.447

通用 SQL 左外连接语法。

从 Volunteers_2009 选择志愿者.id、志愿者.lname、志愿者.fname、志愿者.venue_id、场地.venue_name 作为志愿者左外加入场地 (Volunteers.venue_id = Venues.id)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T22:24:31.233

我无法添加任何评论，但语法 select field1, field2, field3 from avenues, luckys_2009 where志愿者_2009.venue_id =venues.id 只会给你一个场地的志愿者；不是那些没有场地的人。

# c# - 带有链接的winforms 地图。

> ID：199165
> 
> 赞同：-1
> 
> 时间：2008-10-13T22:01:33.323
> 
> 标签：c#, winforms

我们在世界每个地区都有用户。我想创建一个环境选择器，在表单上显示地图并为每个区域提供链接。因此，如果我在纽约，我会单击 NY 并获得 NY 环境。在winforms中动态执行此操作的任何想法，而不是拥有静态地图图像。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T18:55:02.030

我可能误读了这个问题，但听起来您想要类似于老式[Windows 时区选择器](http://blogs.msdn.com/oldnewthing/archive/2006/10/27/880411.aspx)的工作方式。其余的都是基于这个假设，所以如果我错了，请随意忽略。

实际上，您正在处理带有可点击“热点”的世界（或国家或地区等）地图的图像。鉴于此，您需要某种形式的图像开始。:)

现在您有两个选择：您可以在应用程序中嵌入地图的位图图像，或者您可以使用 GDI+ 原语自己绘制它。无论哪种方式，您都可以在表单上显示它，并为各种热点连接 MouseUp 事件。（我相信，MouseUp 事件包括用户点击位置的 X、Y 坐标。）

如果你想变得更花哨，如果用户在定义的热点中，你可以在 MouseOver 事件上更改鼠标指针。

无论哪种方式，它都是一个很棒的用户界面——非常直观，非常符合人们的想法——但是正确编码会很费时间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T10:34:48.963

您是否尝试过使用 MapPoint 及其 API？您可能想使用他们的网络服务。只需谷歌“mappoint api”获取一些示例和文档。

# wix - .NET 中的 Environment.SpecialFolder.ApplicationData 的 WiX 等价物是什么？

> ID：199173
> 
> 赞同：27
> 
> 时间：2008-10-13T22:06:07.290
> 
> 标签：wix, installation, special-folders

我需要在文件`Environment.SpecialFolder.ApplicationData`夹中安装一个文件，这在 XP 和 Vista 之间有所不同。是否有内置方法可以在 WiX 中引用正确的文件夹，或者我是否必须对操作系统使用条件检查并手动执行？

如果我必须做后者，我如何在 Vista 中引用当前 windows 用户的目录？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-10-13T22:15:56.587

使用 ID 设置为[AppDataFolder](http://msdn.microsoft.com/en-us/library/aa367565(VS.85).aspx)的 Directory 元素：

```
<Directory Id="AppDataFolder">
  <Directory Id="MyAppFolder" Name="My">
    <Component Id="MyComponent">
      <File Source="Files\test1.txt" />
    </Component>
  </Directory>
</Directory> 
```

这将导致 test1.txt 安装到 Windows 7 上的 C:\Users\ *username* \AppData\Roaming\My 和 Windows XP 上的 C:\Documents and Settings\ *username* \Application Data\My。

MSDN 具有可用于引用特殊文件夹[的属性列表。](http://msdn.microsoft.com/en-us/library/aa370905%28VS.85%29.aspx#system_folder_properties)

# .net - 是否有一个 .NET 命名空间，我可以在其中找到与 WIN32 API 消息相关的#defines，例如 WM_COMMAND 等

> ID：199178
> 
> 赞同：2
> 
> 时间：2008-10-13T22:07:58.817
> 
> 标签：.net, winapi, wndproc

我正在覆盖 WndProc，所以我想编写类似的代码

```
if (m.Msg == WM_COMMAND)
    my special stuff
else
    base.WndProc(ref m) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T22:11:23.723

AFAIK .NET 不附带这些常量。该[站点](http://www.pinvoke.net/default.aspx/Constants/WM.html)具有所有值，因此只需复制粘贴即可。

```
private const UInt32 WM_ACTIVATE           = 0x0006;
private const UInt32 WM_ACTIVATEAPP        = 0x001C;
private const UInt32 WM_AFXFIRST           = 0x0360;
private const UInt32 WM_AFXLAST        = 0x037F;
private const UInt32 WM_APP            = 0x8000;
private const UInt32 WM_ASKCBFORMATNAME    = 0x030C;
private const UInt32 WM_CANCELJOURNAL      = 0x004B;
private const UInt32 WM_CANCELMODE         = 0x001F;
private const UInt32 WM_CAPTURECHANGED     = 0x0215;
private const UInt32 WM_CHANGECBCHAIN      = 0x030D;
private const UInt32 WM_CHANGEUISTATE      = 0x0127;
private const UInt32 WM_CHAR           = 0x0102;
private const UInt32 WM_CHARTOITEM         = 0x002F;
private const UInt32 WM_CHILDACTIVATE      = 0x0022;
private const UInt32 WM_CLEAR          = 0x0303;
private const UInt32 WM_CLOSE          = 0x0010;
private const UInt32 WM_COMMAND        = 0x0111;
private const UInt32 WM_COMPACTING         = 0x0041;
private const UInt32 WM_COMPAREITEM        = 0x0039;
private const UInt32 WM_CONTEXTMENU        = 0x007B;
private const UInt32 WM_COPY           = 0x0301;
private const UInt32 WM_COPYDATA           = 0x004A;
private const UInt32 WM_CREATE         = 0x0001;
private const UInt32 WM_CTLCOLORBTN        = 0x0135;
private const UInt32 WM_CTLCOLORDLG        = 0x0136;
private const UInt32 WM_CTLCOLOREDIT       = 0x0133;
private const UInt32 WM_CTLCOLORLISTBOX    = 0x0134;
private const UInt32 WM_CTLCOLORMSGBOX     = 0x0132;
private const UInt32 WM_CTLCOLORSCROLLBAR      = 0x0137;
private const UInt32 WM_CTLCOLORSTATIC     = 0x0138;
private const UInt32 WM_CUT            = 0x0300;
private const UInt32 WM_DEADCHAR           = 0x0103;
private const UInt32 WM_DELETEITEM         = 0x002D;
private const UInt32 WM_DESTROY        = 0x0002;
private const UInt32 WM_DESTROYCLIPBOARD       = 0x0307;
private const UInt32 WM_DEVICECHANGE       = 0x0219;
private const UInt32 WM_DEVMODECHANGE      = 0x001B;
private const UInt32 WM_DISPLAYCHANGE      = 0x007E;
private const UInt32 WM_DRAWCLIPBOARD      = 0x0308;
private const UInt32 WM_DRAWITEM           = 0x002B;
private const UInt32 WM_DROPFILES          = 0x0233;
private const UInt32 WM_ENABLE         = 0x000A;
private const UInt32 WM_ENDSESSION         = 0x0016;
private const UInt32 WM_ENTERIDLE          = 0x0121;
private const UInt32 WM_ENTERMENULOOP      = 0x0211;
private const UInt32 WM_ENTERSIZEMOVE      = 0x0231;
private const UInt32 WM_ERASEBKGND         = 0x0014;
private const UInt32 WM_EXITMENULOOP       = 0x0212;
private const UInt32 WM_EXITSIZEMOVE       = 0x0232;
private const UInt32 WM_FONTCHANGE         = 0x001D;
private const UInt32 WM_GETDLGCODE         = 0x0087;
private const UInt32 WM_GETFONT        = 0x0031;
private const UInt32 WM_GETHOTKEY          = 0x0033;
private const UInt32 WM_GETICON        = 0x007F;
private const UInt32 WM_GETMINMAXINFO      = 0x0024;
private const UInt32 WM_GETOBJECT          = 0x003D;
private const UInt32 WM_GETTEXT        = 0x000D;
private const UInt32 WM_GETTEXTLENGTH      = 0x000E;
private const UInt32 WM_HANDHELDFIRST      = 0x0358;
private const UInt32 WM_HANDHELDLAST       = 0x035F;
private const UInt32 WM_HELP           = 0x0053;
private const UInt32 WM_HOTKEY         = 0x0312;
private const UInt32 WM_HSCROLL        = 0x0114;
private const UInt32 WM_HSCROLLCLIPBOARD       = 0x030E;
private const UInt32 WM_ICONERASEBKGND     = 0x0027;
private const UInt32 WM_IME_CHAR           = 0x0286;
private const UInt32 WM_IME_COMPOSITION    = 0x010F;
private const UInt32 WM_IME_COMPOSITIONFULL    = 0x0284;
private const UInt32 WM_IME_CONTROL        = 0x0283;
private const UInt32 WM_IME_ENDCOMPOSITION     = 0x010E;
private const UInt32 WM_IME_KEYDOWN        = 0x0290;
private const UInt32 WM_IME_KEYLAST        = 0x010F;
private const UInt32 WM_IME_KEYUP          = 0x0291;
private const UInt32 WM_IME_NOTIFY         = 0x0282;
private const UInt32 WM_IME_REQUEST        = 0x0288;
private const UInt32 WM_IME_SELECT         = 0x0285;
private const UInt32 WM_IME_SETCONTEXT     = 0x0281;
private const UInt32 WM_IME_STARTCOMPOSITION   = 0x010D;
private const UInt32 WM_INITDIALOG         = 0x0110;
private const UInt32 WM_INITMENU           = 0x0116;
private const UInt32 WM_INITMENUPOPUP      = 0x0117;
private const UInt32 WM_INPUTLANGCHANGE    = 0x0051;
private const UInt32 WM_INPUTLANGCHANGEREQUEST = 0x0050;
private const UInt32 WM_KEYDOWN        = 0x0100;
private const UInt32 WM_KEYFIRST           = 0x0100;
private const UInt32 WM_KEYLAST        = 0x0108;
private const UInt32 WM_KEYUP          = 0x0101;
private const UInt32 WM_KILLFOCUS          = 0x0008;
private const UInt32 WM_LBUTTONDBLCLK      = 0x0203;
private const UInt32 WM_LBUTTONDOWN        = 0x0201;
private const UInt32 WM_LBUTTONUP          = 0x0202;
private const UInt32 WM_MBUTTONDBLCLK      = 0x0209;
private const UInt32 WM_MBUTTONDOWN        = 0x0207;
private const UInt32 WM_MBUTTONUP          = 0x0208;
private const UInt32 WM_MDIACTIVATE        = 0x0222;
private const UInt32 WM_MDICASCADE         = 0x0227;
private const UInt32 WM_MDICREATE          = 0x0220;
private const UInt32 WM_MDIDESTROY         = 0x0221;
private const UInt32 WM_MDIGETACTIVE       = 0x0229;
private const UInt32 WM_MDIICONARRANGE     = 0x0228;
private const UInt32 WM_MDIMAXIMIZE        = 0x0225;
private const UInt32 WM_MDINEXT        = 0x0224;
private const UInt32 WM_MDIREFRESHMENU     = 0x0234;
private const UInt32 WM_MDIRESTORE         = 0x0223;
private const UInt32 WM_MDISETMENU         = 0x0230;
private const UInt32 WM_MDITILE        = 0x0226;
private const UInt32 WM_MEASUREITEM        = 0x002C;
private const UInt32 WM_MENUCHAR           = 0x0120;
private const UInt32 WM_MENUCOMMAND        = 0x0126;
private const UInt32 WM_MENUDRAG           = 0x0123;
private const UInt32 WM_MENUGETOBJECT      = 0x0124;
private const UInt32 WM_MENURBUTTONUP      = 0x0122;
private const UInt32 WM_MENUSELECT         = 0x011F;
private const UInt32 WM_MOUSEACTIVATE      = 0x0021;
private const UInt32 WM_MOUSEFIRST         = 0x0200;
private const UInt32 WM_MOUSEHOVER         = 0x02A1;
private const UInt32 WM_MOUSELAST          = 0x020D;
private const UInt32 WM_MOUSELEAVE         = 0x02A3;
private const UInt32 WM_MOUSEMOVE          = 0x0200;
private const UInt32 WM_MOUSEWHEEL         = 0x020A;
private const UInt32 WM_MOUSEHWHEEL        = 0x020E;
private const UInt32 WM_MOVE           = 0x0003;
private const UInt32 WM_MOVING         = 0x0216;
private const UInt32 WM_NCACTIVATE         = 0x0086;
private const UInt32 WM_NCCALCSIZE         = 0x0083;
private const UInt32 WM_NCCREATE           = 0x0081;
private const UInt32 WM_NCDESTROY          = 0x0082;
private const UInt32 WM_NCHITTEST          = 0x0084;
private const UInt32 WM_NCLBUTTONDBLCLK    = 0x00A3;
private const UInt32 WM_NCLBUTTONDOWN      = 0x00A1;
private const UInt32 WM_NCLBUTTONUP        = 0x00A2;
private const UInt32 WM_NCMBUTTONDBLCLK    = 0x00A9;
private const UInt32 WM_NCMBUTTONDOWN      = 0x00A7;
private const UInt32 WM_NCMBUTTONUP        = 0x00A8;
private const UInt32 WM_NCMOUSEMOVE        = 0x00A0;
private const UInt32 WM_NCPAINT        = 0x0085;
private const UInt32 WM_NCRBUTTONDBLCLK    = 0x00A6;
private const UInt32 WM_NCRBUTTONDOWN      = 0x00A4;
private const UInt32 WM_NCRBUTTONUP        = 0x00A5;
private const UInt32 WM_NEXTDLGCTL         = 0x0028;
private const UInt32 WM_NEXTMENU           = 0x0213;
private const UInt32 WM_NOTIFY         = 0x004E;
private const UInt32 WM_NOTIFYFORMAT       = 0x0055;
private const UInt32 WM_NULL           = 0x0000;
private const UInt32 WM_PAINT          = 0x000F;
private const UInt32 WM_PAINTCLIPBOARD     = 0x0309;
private const UInt32 WM_PAINTICON          = 0x0026;
private const UInt32 WM_PALETTECHANGED     = 0x0311;
private const UInt32 WM_PALETTEISCHANGING      = 0x0310;
private const UInt32 WM_PARENTNOTIFY       = 0x0210;
private const UInt32 WM_PASTE          = 0x0302;
private const UInt32 WM_PENWINFIRST        = 0x0380;
private const UInt32 WM_PENWINLAST         = 0x038F;
private const UInt32 WM_POWER          = 0x0048;
private const UInt32 WM_POWERBROADCAST     = 0x0218;
private const UInt32 WM_PRINT          = 0x0317;
private const UInt32 WM_PRINTCLIENT        = 0x0318;
private const UInt32 WM_QUERYDRAGICON      = 0x0037;
private const UInt32 WM_QUERYENDSESSION    = 0x0011;
private const UInt32 WM_QUERYNEWPALETTE    = 0x030F;
private const UInt32 WM_QUERYOPEN          = 0x0013;
private const UInt32 WM_QUEUESYNC          = 0x0023;
private const UInt32 WM_QUIT           = 0x0012;
private const UInt32 WM_RBUTTONDBLCLK      = 0x0206;
private const UInt32 WM_RBUTTONDOWN        = 0x0204;
private const UInt32 WM_RBUTTONUP          = 0x0205;
private const UInt32 WM_RENDERALLFORMATS       = 0x0306;
private const UInt32 WM_RENDERFORMAT       = 0x0305;
private const UInt32 WM_SETCURSOR          = 0x0020;
private const UInt32 WM_SETFOCUS           = 0x0007;
private const UInt32 WM_SETFONT        = 0x0030;
private const UInt32 WM_SETHOTKEY          = 0x0032;
private const UInt32 WM_SETICON        = 0x0080;
private const UInt32 WM_SETREDRAW          = 0x000B;
private const UInt32 WM_SETTEXT        = 0x000C;
private const UInt32 WM_SETTINGCHANGE      = 0x001A;
private const UInt32 WM_SHOWWINDOW         = 0x0018;
private const UInt32 WM_SIZE           = 0x0005;
private const UInt32 WM_SIZECLIPBOARD      = 0x030B;
private const UInt32 WM_SIZING         = 0x0214;
private const UInt32 WM_SPOOLERSTATUS      = 0x002A;
private const UInt32 WM_STYLECHANGED       = 0x007D;
private const UInt32 WM_STYLECHANGING      = 0x007C;
private const UInt32 WM_SYNCPAINT          = 0x0088;
private const UInt32 WM_SYSCHAR        = 0x0106;
private const UInt32 WM_SYSCOLORCHANGE     = 0x0015;
private const UInt32 WM_SYSCOMMAND         = 0x0112;
private const UInt32 WM_SYSDEADCHAR        = 0x0107;
private const UInt32 WM_SYSKEYDOWN         = 0x0104;
private const UInt32 WM_SYSKEYUP           = 0x0105;
private const UInt32 WM_TCARD          = 0x0052;
private const UInt32 WM_TIMECHANGE         = 0x001E;
private const UInt32 WM_TIMER          = 0x0113;
private const UInt32 WM_UNDO           = 0x0304;
private const UInt32 WM_UNINITMENUPOPUP    = 0x0125;
private const UInt32 WM_USER           = 0x0400;
private const UInt32 WM_USERCHANGED        = 0x0054;
private const UInt32 WM_VKEYTOITEM         = 0x002E;
private const UInt32 WM_VSCROLL        = 0x0115;
private const UInt32 WM_VSCROLLCLIPBOARD       = 0x030A;
private const UInt32 WM_WINDOWPOSCHANGED       = 0x0047;
private const UInt32 WM_WINDOWPOSCHANGING      = 0x0046;
private const UInt32 WM_WININICHANGE       = 0x001A;
private const UInt32 WM_XBUTTONDBLCLK      = 0x020D;
private const UInt32 WM_XBUTTONDOWN        = 0x020B;
private const UInt32 WM_XBUTTONUP          = 0x020C; 
```

# python - 有没有办法让 python omnicomplete 与 vim 中的非系统模块一起工作？

> ID：199180
> 
> 赞同：9
> 
> 时间：2008-10-13T22:08:26.913
> 
> 标签：python, vim, omnicomplete

我唯一可以使用 python omnicomplete 的是系统模块。对于我当前正在处理的站点包或模块中的模块，我没有得到任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-17T18:19:55.060

一旦我为我的一个站点包生成了 ctags，它就开始为那个包工作——所以我猜测，omnicomplete 函数依赖于非 sys 模块的 ctags。

编辑：根本不是真的。

这就是问题所在——我的测试很差——全能 WAS 为我的项目的一部分工作，而不是大部分。

问题是我正在开发一个 django 项目，为了导入 django.db，您需要设置一个环境变量。由于我无法导入 django.db，因此从 django.db 继承的任何类或导入从 django.db 继承的类的任何模块都不会完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T00:55:19.743

今晚刚刚在 Python reddit 上遇到了这个问题：[PySmell](http://orestis.gr/blog/2008/10/13/pysmell-v06-released/)。看起来像你在找什么。

> PySmell 是一个 python IDE 完成助手。
> 
> 它尝试静态分析 Python 源代码，而不执行它，并生成有关 IDE 工具可以使用的项目结构的信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T14:35:18.747

我在我的 PYTHONPATH 或站点包中完成了我自己的模块。我不确定您使用的是什么版本的 pythoncomplete.vim 脚本，但您可能需要确保它是最新的。

编辑：这是我在系统上看到的一些示例......

这个文件（mymodule.py），我把它放在 PYTHONPATH 的一个目录中，然后放在 site-packages 中。两次我都能得到下面的截图。

```
myvar = 'test'

def myfunction(foo='test'):
    pass

class MyClass(object):
    pass 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-12T05:26:38.110

虽然重要的是要注意您必须正确设置`PYTHONPATH`环境变量，但根据前面的答案，[Vim 中有一个值得注意的错误，它会在导入失败时阻止omnicompletion 工作](http://groups.google.com/group/vim_dev/browse_thread/thread/58191d176ebd9722/d9cd31cee304b7df)。从 Vim 7.2.79 开始，这个错误还没有被修复。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-09T15:19:58.820

故障排除提示：验证您尝试全方位完成的模块是否可以通过 VIM 导入。我有一些 VIM 不喜欢的语法正确的 Python：

```
:python import {module-name}
 Traceback (most recent call last):
   File "<string>", line 1, in ?
   File "modulename/__init__.py", line 9
     class empty_paranthesis():
                            ^
 SyntaxError: invalid syntax 
```

例如，从我的类定义中删除括号允许 VIM 导入模块，随后该模块上的 OmniComplete 开始工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T07:12:40.747

我认为你在[pydiction](http://www.vim.org/scripts/script.php?script_id=850)脚本之后。它使您可以将自己的东西和站点包添加到omni complete。

当您使用它时，将以下内容添加到您的 python.vim 文件中...

```
 set iskeyword+=. 
```

这将让您自动完成包功能，例如，如果您输入...

```
 os.path. 
```

然后 [CTRL][N]，您将获得 os.path 的函数列表。

# c# - 从命令行运行表单程序时C#隐藏表单

> ID：199182
> 
> 赞同：1
> 
> 时间：2008-10-13T22:09:06.770
> 
> 标签：c#, command-line

我正在开发一个基于表单的程序，但我被要求添加一些命令行支持，除了从命令行运行时表单会闪烁和关闭之外，它工作正常。无论如何在命令行运行时隐藏表单？某些代码确实引用了控件，因此 gui 需要可访问但不可见，这可行吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-13T22:13:40.787

在您的 Main 方法中，您可以创建以下表单：

```
main = new MainForm(); 
```

然后进行所需的任何命令行处理。

当不在命令行模式时，只需调用：

```
Application.Run(main); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T23:42:56.363

我运行过的一些应用程序在表单类的构造函数中具有这种行为。基本上，当命令行参数的过程成功完成时，它们的构造函数处理命令行参数并调用 Environment.Exit(0)。在表单类的构造函数完成之前调用 Environment.Exit 可以有效地防止表单出现。

话虽如此，它很容易出错，我会说它一直没有作为应用程序启动的表单类。改用另一个类，它可以根据需要实例化和显示表单，或者改为处理命令行参数。

# algorithm - 如何检查一个数字是否是回文？

> ID：199184
> 
> 赞同：133
> 
> 时间：2008-10-13T22:10:39.153
> 
> 标签：algorithm, language-agnostic

如何检查一个数字是否是回文？

任何语言。任何算法。（除了将数字变成字符串然后反转字符串的算法）。

* * *

## 回答 #1

> 赞同：276
> 
> 时间：2008-10-13T22:18:20.107

对于任何给定的数字：

```
n = num;
rev = 0;
while (num > 0)
{
    dig = num % 10;
    rev = rev * 10 + dig;
    num = num / 10;
} 
```

如果`n == rev`then`num`是回文：

```
cout << "Number " << (n == rev ? "IS" : "IS NOT") << " a palindrome" << endl; 
```

* * *

## 回答 #2

> 赞同：135
> 
> 时间：2008-10-13T22:14:30.643

这是[Project Euler 问题之一](http://projecteuler.net/index.php?section=problems&id=4)。当我在 Haskell 中解决它时，我完全按照您的建议进行操作，将数字转换为字符串。然后检查字符串是否是回文就很简单了。如果它表现得足够好，那为什么还要让它变得更复杂呢？回文是一种词汇属性，而不是数学属性。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-10-13T22:26:13.803

```
def ReverseNumber(n, partial=0):
    if n == 0:
        return partial
    return ReverseNumber(n // 10, partial * 10 + n % 10)

trial = 123454321
if ReverseNumber(trial) == trial:
    print("It's a Palindrome!") 
```

仅适用于整数。从问题陈述中不清楚是否需要考虑浮点数或前导零。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2013-08-28T05:47:03.030

上面大多数有一个小问题的答案是 int 变量可能会溢出。

参考[http://articles.leetcode.com/palindrome-number/](https://web.archive.org/web/20180222083908/http://articles.leetcode.com/palindrome-number/)

```
boolean isPalindrome(int x) {
    if (x < 0)
        return false;
    int div = 1;
    while (x / div >= 10) {
        div *= 10;
    }
    while (x != 0) {
        int l = x / div;
        int r = x % 10;
        if (l != r)
            return false;
        x = (x % div) / 10;
        div /= 100;
    }
    return true;
} 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-13T22:27:19.167

```
int is_palindrome(unsigned long orig)
{
    unsigned long reversed = 0, n = orig;

    while (n > 0)
    {
        reversed = reversed * 10 + n % 10;
        n /= 10;
    }

    return orig == reversed;
} 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-13T22:15:10.317

将每个单独的数字压入堆栈，然后将它们弹出。如果前后方向相同，则为回文。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2015-10-20T06:40:35.770

我知道的最快方法：

```
bool is_pal(int n) {
    if (n % 10 == 0) return 0;
    int r = 0;
    while (r < n) {
        r = 10 * r + n % 10;
        n /= 10;
    }
    return n == r || n == r / 10;
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2016-03-23T21:42:56.740

我没有注意到任何不使用额外空间即可解决此问题的答案，即我看到的所有解决方案要么使用字符串，要么使用另一个整数来反转数字，或者使用其他一些数据结构。

尽管像 Java 这样的语言在整数溢出时会回绕，但这种行为在像 C 这样的语言中是未定义的。（*尝试在 Java 中反转 2147483647 (Integer.MAX_VALUE)*）
解决方法可能是使用 long 或其他东西，但从风格上讲，我不太喜欢这种方法。

现在，回文数的概念是数字应该向前和向后读取相同。伟大的。使用此信息，我们可以比较第一个数字和最后一个数字。诀窍是，对于第一个数字，我们需要数字的顺序。比如说，12321。将其除以 10000 将使我们得到前导 1。尾随 1 可以通过将 mod 与 10 一起检索。现在，将其减少到 232 `(12321 % 10000)/10 = (2321)/10 = 232`。现在，10000 需要减少 2 倍。所以，现在开始 Java 代码......

```
private static boolean isPalindrome(int n) {
    if (n < 0)
        return false;

    int div = 1;
    // find the divisor
    while (n / div >= 10)
        div *= 10;

    // any number less than 10 is a palindrome
    while (n != 0) {
        int leading = n / div;
        int trailing = n % 10;
        if (leading != trailing)
            return false;

        // % with div gets rid of leading digit
        // dividing result by 10 gets rid of trailing digit
        n = (n % div) / 10;

        // got rid of 2 numbers, update div accordingly
        div /= 100;
    }
    return true;
} 
```

根据[Hardik](/users/3060101/hardik)的建议进行编辑，以涵盖数字为零的情况。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-10-01T19:11:22.470

在 Python 中，有一种快速、迭代的方式。

```
def reverse(n):
    newnum=0
    while n>0:
        newnum = newnum*10 + n % 10
        n//=10
    return newnum

def palindrome(n):
    return n == reverse(n) 
```

这也可以防止递归的内存问题（如 Java 中的 StackOverflow 错误）

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-14T06:46:27.693

只是为了好玩，这个也可以。

```
a = num;
b = 0;
if (a % 10 == 0)
  return a == 0;
do {
  b = 10 * b + a % 10;
  if (a == b)
    return true;
  a = a / 10;
} while (a > b);
return a == b; 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-11-11T18:00:36.530

> 除了将数字变为字符串然后反转字符串。

为什么要拒​​绝该解决方案？**它易于实现和阅读**。如果你在没有电脑的情况下被问到是否`2**10-23`是十进制回文，你肯定会用十进制写出来来测试它。

至少在 Python 中，口号“字符串操作比算术慢”实际上是错误的。我将 Smink 的算术算法与简单的字符串反转进行了比较`int(str(i)[::-1])`。速度没有显着差异 - 它发生字符串反转稍微快一点。

在编译型语言 (C/C++) 中，口号可能成立，但存在大量溢出错误的风险。

```
def reverse(n):
    rev = 0
    while n > 0:
        rev = rev * 10 + n % 10
        n = n // 10
    return rev

upper = 10**6

def strung():
    for i in range(upper):
        int(str(i)[::-1])

def arithmetic():
    for i in range(upper):
        reverse(i)

import timeit
print "strung", timeit.timeit("strung()", setup="from __main__ import strung", number=1)
print "arithmetic", timeit.timeit("arithmetic()", setup="from __main__ import arithmetic", number=1) 
```

以秒为单位的结果（越低越好）：

> 串起来 1.50960231881 算术 1.69729960569

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-13T22:49:10.667

我用非常暴力的方式回答了欧拉问题。自然，当我进入新解锁的相关论坛帖子时，展示了一个更智能的算法。也就是说，一位使用 Begoner 的成员有一种新颖的方法，我决定使用他的算法重新实现我的解决方案。他的版本是用 Python 编写的（使用嵌套循环），我在 Clojure 中重新实现了它（使用单个循环/递归）。

这里供您娱乐：

```
(defn palindrome? [n]
  (let [len (count n)]
    (and
      (= (first n) (last n))
      (or (>= 1 (count n))
        (palindrome? (. n (substring 1 (dec len))))))))

(defn begoners-palindrome []
  (loop [mx 0
         mxI 0
         mxJ 0
         i 999
         j 990]
    (if (> i 100)
      (let [product (* i j)]
        (if (and (> product mx) (palindrome? (str product)))
          (recur product i j
            (if (> j 100) i (dec i))
            (if (> j 100) (- j 11) 990))
          (recur mx mxI mxJ
            (if (> j 100) i (dec i))
            (if (> j 100) (- j 11) 990))))
      mx)))

(time (prn (begoners-palindrome))) 
```

也有 Common Lisp 的答案，但它们对我来说是不可理解的。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-06-30T17:49:57.310

这是一个 Scheme 版本，它构造了一个适用于任何基础的函数。它有一个冗余检查：如果数字是基数的倍数（以 0 结尾），则快速返回 false。
而且它不会重建整个反转的数字，只有一半。
这就是我们所需要的。

```
(define make-palindrome-tester
   (lambda (base)
     (lambda (n)
       (cond
         ((= 0 (modulo n base)) #f)
         (else
          (letrec
              ((Q (lambda (h t)
                    (cond
                      ((< h t) #f)
                      ((= h t) #t)
                      (else
                       (let*
                           ((h2 (quotient h base))
                            (m  (- h (* h2 base))))
                         (cond
                           ((= h2 t) #t)
                           (else
                            (Q h2 (+ (* base t) m))))))))))
            (Q n 0))))))) 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-03-01T23:42:04.080

ruby 中的递归解决方案，无需将数字转换为字符串。

```
def palindrome?(x, a=x, b=0)
  return x==b if a<1
  palindrome?(x, a/10, b*10 + a%10)
end

palindrome?(55655) 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2015-08-12T08:02:24.320

Golang 版本：

```
package main

import "fmt"

func main() {
    n := 123454321
    r := reverse(n)
    fmt.Println(r == n)
}

func reverse(n int) int {
    r := 0
    for {
        if n > 0 {
            r = r*10 + n%10
            n = n / 10
        } else {
            break
        }
    }
    return r
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-10-13T22:30:20.690

弹出第一个和最后一个数字并比较它们，直到用完为止。可能有一个数字，也可能没有，但无论哪种方式，如果所有弹出的数字都匹配，它就是一个回文。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2014-07-13T10:19:50.200

这是在 c++ 中使用模板的另一种解决方案。此解决方案适用于不区分大小写的回文字符串比较。

```
template <typename bidirection_iter>
bool palindrome(bidirection_iter first, bidirection_iter last)
{
    while(first != last && first != --last)
    {
        if(::toupper(*first) != ::toupper(*last))
            return false;
        else
            first++;
    }
    return true;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-08-02T05:24:10.867

一种比@sminks 方法具有更好的常数因子的方法：

```
num=n
lastDigit=0;
rev=0;
while (num>rev) {
    lastDigit=num%10;
    rev=rev*10+lastDigit;
    num /=2;
}
if (num==rev) print PALINDROME; exit(0);
num=num*10+lastDigit; // This line is required as a number with odd number of bits will necessary end up being smaller even if it is a palindrome
if (num==rev) print PALINDROME 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-05-04T15:24:14.537

这是 af# 版本：

```
let reverseNumber n =
    let rec loop acc = function
    |0 -> acc
    |x -> loop (acc * 10 + x % 10) (x/10)    
    loop 0 n

let isPalindrome = function
    | x  when x = reverseNumber x -> true
    | _ -> false 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-07-06T17:59:26.360

如果一个数字的字符串表示是回文的，那么它就是回文的：

```
def is_palindrome(s):
    return all(s[i] == s[-(i + 1)] for i in range(len(s)//2))

def number_palindrome(n):
    return is_palindrome(str(n)) 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-02-01T04:55:27.333

```
def palindrome(n):
    d = []
    while (n > 0):
        d.append(n % 10)
        n //= 10
    for i in range(len(d)/2):
        if (d[i] != d[-(i+1)]):
            return "Fail."
    return "Pass." 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-06-03T14:14:19.540

检查给定的数字是否是回文（Java代码）

```
class CheckPalindrome{
public static void main(String str[]){
        int a=242, n=a, b=a, rev=0;
        while(n>0){
                    a=n%10;  n=n/10;rev=rev*10+a;
                    System.out.println(a+"  "+n+"  "+rev);  // to see the logic
               }
        if(rev==b)  System.out.println("Palindrome");
        else        System.out.println("Not Palindrome");
    }
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-03-05T21:57:50.673

此处发布的许多解决方案都将整数反转并将其存储在一个使用额外空间的变量中`O(n)`，但这里是一个带有`O(1)`空间的解决方案。

```
def isPalindrome(num):
    if num < 0:
        return False
    if num == 0:
        return True
    from math import log10
    length = int(log10(num))
    while length > 0:
        right = num % 10
        left = num / 10**length
        if right != left:
            return False
        num %= 10**length
        num /= 10
        length -= 2
    return True 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2015-03-18T14:52:35.940

由于它的紧凑性，我总是使用这个 python 解决方案。

```
def isPalindrome(number):
    return int(str(number)[::-1])==number 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-02-13T04:10:18.350

试试这个：

```
reverse = 0;
    remainder = 0;
    count = 0;
    while (number > reverse)
    {
        remainder = number % 10;
        reverse = reverse * 10 + remainder;
        number = number / 10;
        count++;
    }
    Console.WriteLine(count);
    if (reverse == number)
    {
        Console.WriteLine("Your number is a palindrome");
    }
    else
    {
        number = number * 10 + remainder;
        if (reverse == number)
            Console.WriteLine("your number is a palindrome");
        else
            Console.WriteLine("your number is not a palindrome");
    }
    Console.ReadLine();
}
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2013-06-29T19:54:13.513

这是在 python 中使用列表作为堆栈的解决方案：

```
def isPalindromicNum(n):
    """
        is 'n' a palindromic number?
    """
    ns = list(str(n))
    for n in ns:
        if n != ns.pop():
            return False
    return True 
```

弹出堆栈仅考虑数字的最右侧进行比较，并且无法快速减少检查

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-07-21T05:53:12.880

```
 public class Numbers
 {
   public static void main(int givenNum)
   { 
       int n= givenNum
       int rev=0;

       while(n>0)
       {
          //To extract the last digit
          int digit=n%10;

          //To store it in reverse
          rev=(rev*10)+digit;

          //To throw the last digit
          n=n/10;
      }

      //To check if a number is palindrome or not
      if(rev==givenNum)
      { 
         System.out.println(givenNum+"is a palindrome ");
      }
      else
      {
         System.out.pritnln(givenNum+"is not a palindrome");
      }
  }
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-09-17T19:24:32.213

```
let isPalindrome (n:int) =
   let l1 = n.ToString() |> List.ofSeq |> List.rev
   let rec isPalindromeInt l1 l2 =
       match (l1,l2) with
       | (h1::rest1,h2::rest2) -> if (h1 = h2) then isPalindromeInt rest1 rest2 else false
       | _ -> true
   isPalindromeInt l1 (n.ToString() |> List.ofSeq) 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2013-10-02T09:02:50.793

```
checkPalindrome(int number)
{
    int lsd, msd,len;
    len = log10(number);
    while(number)
    {
        msd = (number/pow(10,len)); // "most significant digit"
        lsd = number%10; // "least significant digit"
        if(lsd==msd)
        {
            number/=10; // change of LSD
            number-=msd*pow(10,--len); // change of MSD, due to change of MSD
            len-=1; // due to change in LSD
            } else {return 1;}
    }
    return 0;
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2013-11-21T23:58:01.357

递归的方式，效率不是很高，只是提供一个选项

（Python代码）

```
def isPalindrome(num):
    size = len(str(num))
    demoninator = 10**(size-1)
    return isPalindromeHelper(num, size, demoninator)

def isPalindromeHelper(num, size, demoninator):
    """wrapper function, used in recursive"""
    if size <=1:
        return True
    else:       
        if num/demoninator != num%10:
            return False
        # shrink the size, num and denominator
        num %= demoninator
        num /= 10
        size -= 2
        demoninator /=100
        return isPalindromeHelper(num, size, demoninator) 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2013-12-23T12:11:21.257

似乎最简单的事情就是找到相反的数字并比较两者：

```
int max =(int)(Math.random()*100001);

    int i;
    int num = max; //a var used in the tests
    int size; //the number of digits in the original number
    int opos = 0; // the oposite number
    int nsize = 1;

    System.out.println(max);

    for(i = 1; num>10; i++)
    {
        num = num/10;
    }

    System.out.println("this number has "+i+" digits");

    size = i; //setting the digit number to a var for later use

    num = max;

    for(i=1;i<size;i++)
    {
        nsize *=10;
    }

    while(num>1)
    {
        opos += (num%10)*nsize;
        num/=10;
        nsize/=10;
    }

    System.out.println("and the number backwards is "+opos);

    if (opos == max )
    {
        System.out.println("palindrome!!");
    }
    else
    {
        System.out.println("aint no palindrome!");
    } 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2014-05-08T09:11:14.177

试试这个：

```
print('!* To Find Palindrome Number') 

def Palindrome_Number():

            n = input('Enter Number to check for palindromee')  
            m=n 
            a = 0  

    while(m!=0):  
        a = m % 10 + a * 10    
        m = m / 10    

    if( n == a):    
        print('%d is a palindrome number' %n)
    else:
        print('%d is not a palindrome number' %n) 
```

只需回调函数

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2014-09-26T11:26:39.850

这是一种方法。

```
class Palindrome_Number{
    void display(int a){
        int count=0;
        int n=a;
        int n1=a;
        while(a>0){
            count++;
            a=a/10;
        }
        double b=0.0d;
        while(n>0){
            b+=(n%10)*(Math.pow(10,count-1));
            count--;
            n=n/10;
        }
        if(b==(double)n1){
            System.out.println("Palindrome number");
        }
        else{
            System.out.println("Not a palindrome number");            
        }
    }
} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2015-01-14T20:47:30.000

我采用常规方法，将数字转换为字符串，然后进一步将字符串转换为 charArray。
遍历 charArray 并查找位置处的数字是否相等。
注意-：不反转字符串。

```
public bool IsPalindrome(int num)
{
    string st = num.ToString();
    char[] arr = st.ToCharArray();
    int len = arr.Length;
    if (len <= 1)
    {
        return false;
    }
    for (int i = 0; i < arr.Length; i++)
    {
        if (arr[i] == arr[len - 1])
        {
            if (i >= len)
            {
                return true;
            }
            len--;
        }
        else
        {
            break;
        }
    }
    return false;
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2015-05-16T20:49:20.270

```
int reverse(int num)
{
    assert(num >= 0);   // for non-negative integers only.
    int rev = 0;
    while (num != 0)
    {
        rev = rev * 10 + num % 10;
        num /= 10;
    }
    return rev;
} 
```

这似乎也有效，但是您是否考虑过反转数字可能会溢出的可能性？如果溢出，则行为是特定于语言的（对于 Java，数字在溢出时环绕，但在 C/C++ 中，其行为未定义）。呸。

事实证明，从两端进行比较更容易。首先，比较第一个和最后一个数字。如果它们不相同，则它一定不是回文。如果它们相同，则从两端切掉一个数字并继续，直到没有剩余数字为止，您可以得出结论，它一定是回文。

现在，获取和砍掉最后一位数字很容易。但是，以通用方式获取和砍掉第一个数字需要一些思考。下面的解决方案可以解决它。

```
int isIntPalindrome(int x)
{
    if (x < 0)
    return 0;
    int div = 1;
    while (x / div >= 10)
    {
        div *= 10;
    }

    while (x != 0)
    {
        int l = x / div;
        int r = x % 10;
        if (l != r)
            return 0;
        x = (x % div) / 10;
        div /= 100;
    }
    return 1;
} 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2015-11-21T21:39:49.827

```
num = int(raw_input())
list_num = list(str(num))
if list_num[::-1] == list_num:
    print "Its a palindrome"
else:
    print "Its not a palindrom" 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2016-01-06T21:36:08.213

不确定这是否是最佳答案，而且我是编程新手。（它在java中）

```
import java.util.*;

public class Palin {

    public static void main(String[] args) {
        Random randInt = new Random();

        Scanner kbd = new Scanner(System.in);
        int t = kbd.nextInt(); //# of test cases;
        String[] arrPalin = new String[t]; //array of inputs;
        String[] nextPalin = new String[t];
        for (int i = 0; i < t; i++) {
            arrPalin[i] = String.valueOf(randInt.nextInt(2147483646) + 1);
            System.out.println(arrPalin[i]);
        }

        final long startTime = System.nanoTime();

        for (int i = 0; i < t; i++) {
            nextPalin[i] = (unmatcher(incrementer(switcher(match(arrPalin[i])))));
        }

        final long duration = System.nanoTime() - startTime;

        for (int i = 0; i < t; i++) {
            System.out.println(nextPalin[i]);
        }

        System.out.println(duration);

    }

    public static String match(String N) {
        int length = N.length();

        //Initialize a string with length of N
        char[] chars = new char[length];
        Arrays.fill(chars, '0');

        int count = 1;

        for (int i = 0; i < length; i++) {
            if ((i%2) == 0) { //at i = even.
                if (i == 0) {
                    chars[i] = N.charAt(i);
                } else
                    chars[i] = N.charAt(i/2);
            } else //at i = odd
                chars[i] = N.charAt(length - count);
                count++;
        }

        return String.valueOf(chars);
    }

    public static String switcher(String N) {
        int length = N.length();
        char[] chars = new char[length];
        Arrays.fill(chars, '0');

        for (int i = 0; i < length; i++) {
            if (i != 0) {
                if ((i % 2) == 0) {
                    chars[i] = N.charAt(i);
                } else if ((i % 2) != 0) {
                    chars[i] = N.charAt(i - 1);
                }
            }
            if (i == 0) {
                chars[0] = N.charAt(0);
            }
        }
        return String.valueOf(chars);
    }

    public static String incrementer(String N) {
        int length = N.length();
        char[] chars = new char[length];
        Arrays.fill(chars, '0');

        char[] newN = N.toCharArray();

        String returnVal;

        int numOne, numTwo;

        if ((length % 2) == 0) {
            numOne = N.charAt(length-1);
            numTwo = N.charAt(length-2);
            newN[length-1] = (char)(numOne+1);
            newN[length-2] = (char)(numTwo+1);
            returnVal = String.valueOf(newN);
        } else {
            numOne = N.charAt(length-1);
            newN[length-1] = (char)(numOne+1);
            returnVal = String.valueOf(newN);
        }
        return returnVal;
    }

    public static String unmatcher(String N) {
        int length = N.length();
        char[] chars = new char[length];
        Arrays.fill(chars, '0');
        char[] newN = N.toCharArray();

        for (int i = 0; i < length; i++) {
                if (((i % 2) == 0) && (i != 0)) { // for i > 0, even
                    newN[i / 2] = N.charAt(i);
                } else if ((i % 2) == 0 && (i == 0)) { // for i = 0
                    newN[0] = N.charAt(0);
                }
            }
        for (int i = (length/2); i < length; i++) {
            newN[i] = newN[Math.abs(i - (length - 1))];
        }

        return String.valueOf(newN);
    }

} 
```

所以对于这段代码，输入一个数字（我做了我想要多少的随机数），它会转换，例如输入是172345到157423。然后它会变成117722，如果偶数变成117733，如果奇数对唯一的最后一位数字执行相同的操作。然后将其设为 173371。它不是专门寻找回文数，而是寻找下一个最高的回文数。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2016-01-08T04:26:36.810

```
public class PalindromePrime   {
     private static int g ,n =0,i,m ; 

     private javax.swing.JTextField jTextField;

     static String b ="";
    private static Scanner scanner = new Scanner( System.in );  
    public static void main(String [] args) throws IOException {
        System.out.print(" Please Inter Data : "); 
        g = scanner.nextInt();

        System.out.print(" Please Inter Data 2  : "); 
        m = scanner.nextInt();  

        count(g,m);     
    }   

    public static    int count(int L, int R) {
        int resultNum = 0;

        for( i= L ; i<= R ;i++){
            int count= 0 ;
            for( n = i ; n >=1 ;n -- ){
                if(i%n==0){             
                    count = count + 1 ;
                //  System.out.println("  Data : \n "  +count );    
                }       
            }
            if(count == 2)
            {   
                //b = b +i + "" ;

            String ss=  String .valueOf(i);
            //  System.out.print("\n" +i );
                if(isPalindrome(i))
                {
                //0 System.out.println("Number : " + i + " is   a palindrome");

                        //number2[b] = Integer.parseInt(number_ayy[b]);

                    //String s = String .valueOf(i);
                    //System.out.printf("123456", s);
                    resultNum++;
                }
                else{
                    //*System.out.println("Number : " + i + " is Not  a palindrome");
                }
                //System.out.println("  Data : \n " +ss.length()  );    
            }
        //  palindrome(i);
        }

    //  System.out.print("  Data  : "); 
    //  System.out.println("  Data : \n "  +b ); 
        return resultNum;
    }

    @SuppressWarnings("unused")
    public static boolean isPalindrome(int number  ) {
        int p = number; // ประกาศ  p เป็น int ให้เท่ากับ number ของ ตัวที่ มาจาก method 
        int r = 0; //ประกาศ r เป็น int โดยให้มีค่าเรื่องต้นเท่ากับ 0 
        int w = 0 ;
        while (p != 0) {  // เงื่อนไข While ถ้า p ไม่เท่ากับ 0  เช่น  2!= 0 จริง  เข้า  
             w = p % 10; // ประกาศตัว แปร W ให้ เท่ากับค่า p ที่มาจาก parramiter ให้ & mod กับ  10 คือ เช่น  2 % 10 = 2 ; w= 2 ; 3% 10 ; w =3
           r = r * 10 + w;  // (ให้  R ที่มาจาก การประกาศค่ตัวแปร แล้ว * 10) + w  จะมาจากค่า w = p % 10; ที่ mod ไว้  เช่น 0*10 + 2 = 2 
           p = p / 10;  //แล้วใช้ p ที่จมาจากตัว paramiter แล้วมาหาร  10  เพราะถ้าไม่มี ก็จะสามารถพิมพ์ค่าออกมาได้  || ทำไงก็ได้ให้เป็น 0  และเอามาแทนค่ตัวต่อไป 
        }

        // 1 วนวูปเช็คว่า   (p != 0) หรือไม่   โดย  p มาจาก p = number ที่รับมา 
        // 2 r = (r * 10) + (p%10) ;  

        //3   p = p /10 ; เพื่อเช็ค  ว่าให้มันเป็น 0 เพื่อหลุด Loop 
        if (number == r) {
            // for(int count = 0 ; count <i ;count ++){
        String s1 = String.valueOf(i);     

            //countLines(s1);
            System.out.println("Number : " + "'"+s1 +"'"+"  is   a palindrome");

            return true; //เรียก return ไป 
        }
        return false;
    }

    public static int countLines(String str)
    {
        if (str == null || str.length() == 0)
            return 0;
        int lines = 1;
        int len = str.length();
        for( int pos = 0; pos < len; pos++) {
            char c = str.charAt(pos);
            if( c == '\r' ) {
                System.out.println("Line 0 : " + "'"+str );

                lines++;
                if ( pos+1 < len && str.charAt(pos+1) == '\n' )

                    System.out.println("Line : " + "'"+str );

                  pos++;
            } else if( c == '\n' ) {
                lines++;

                System.out.println("Line 2 : " + "'"+str );
            }
        }
        return lines;
    }

    public static int countLines1(String sd) throws IOException {
        LineNumberReader lineNumberReader = new LineNumberReader(new StringReader(sd));
        int count = 0 ;
        System.out.printf("Line  : " , count = count + 1 );
        lineNumberReader.skip(Long.MAX_VALUE);
        return lineNumberReader.getLineNumber();
    }
} 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2016-02-09T14:17:42.397

```
public static void main(String args[])
{
    System.out.print("Enter a number: ");
    Scanner input = new Scanner(System.in);
    int num = input.nextInt();
    int number = num;
    int reversenum = 0;
    while (num != 0)
    {
        reversenum = reversenum * 10;
        reversenum = reversenum + num % 10;
        num = num / 10;
    }

    if (number == reversenum)
        System.out.println("The reverse number is " + reversenum + "\nThen the number is palindrome.");
    else
        System.out.println("The reverse number is " + reversenum + "\nThen the number is not palindrome.");

} 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2016-03-14T14:03:06.850

此代码将 int 转换为 String，然后检查字符串是否为 pallindrome。优点是速度快，缺点是它将 int 转换为 String，从而影响了问题的完美解决方案。

```
static int pallindrome=41012;
static String pallindromer=(Integer.toString(pallindrome));
static int length=pallindromer.length();

public static void main(String[] args) {
    pallindrome(0);
    System.out.println("It's a pallindrome");
}

static void pallindrome(int index){
    if(pallindromer.charAt(index)==pallindromer.charAt(length-(index+1))){
        if(index<length-1){
            pallindrome(++index);
        }
    }
    else{
        System.out.println("Not a pallindrome");
        System.exit(0);
    }
} 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2016-10-01T04:32:49.250

假设前导零被忽略。以下是一个实现：

```
#include<bits/stdc++.h>
using namespace std;
vector<int>digits;
stack<int>digitsRev;
int d,number;
bool isPal=1;//initially assuming the number is palindrome
int main()
{
    cin>>number;
    if(number<10)//if it is a single digit number than it is palindrome
    {
        cout<<"PALINDROME"<<endl;
        return 0;
    }
    //if the number is greater than or equal to 10
    while(1)
    {
        d=number%10;//taking each digit
        number=number/10;
        //vector and stack will pick the digits
        //in reverse order to each other
        digits.push_back(d);
        digitsRev.push(d);
        if(number==0)break;
    }
    int index=0;
    while(!digitsRev.empty())
    {
        //Checking each element of the vector and the stack
        //to see if there is any inequality.
        //And which is equivalent to check each digit of the main
        //number from both sides
        if(digitsRev.top()!=digits[index++])
        {
            cout<<"NOT PALINDROME"<<endl;
            isPal=0;
            break;
        }
        digitsRev.pop();
    }
    //If the digits are equal from both sides than the number is palindrome
    if(isPal==1)cout<<"PALINDROME"<<endl;
} 
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2016-10-16T22:58:30.440

在 java 中检查这个解决方案：

```
private static boolean ispalidrome(long n) {
        return getrev(n, 0L) == n;
    }

    private static long getrev(long n, long initvalue) {
        if (n <= 0) {
            return initvalue;
        }
        initvalue = (initvalue * 10) + (n % 10);
        return getrev(n / 10, initvalue);
    } 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2017-01-17T07:55:32.430

只需通过数学函数获取数字的位数，然后使用 '/' 和 '%' 操作进行迭代，如下所示。在 x = (x % 除数) / 10 之后，我们应该将除数除以 100，因为我们进行了 2 次零操作。

```
public static boolean isPalindrome(int x) {
            if (x < 0) return false;
            if (x < 10) return true;

            int numDigits = (int)(Math.log10(x)+1);
            int divider = (int) (Math.pow(10, numDigits - 1));
            for (int i = 0; i < numDigits / 2; i++) {
                if (x / divider != x % 10)
                    return false;
                x = (x % divider) / 10;
                divider /= 100;
            }
            return true;
        } 
```

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2018-10-17T22:04:23.990

以下是快速的答案。它从左侧和右侧读取数字并比较它们是否相同。这样做我们将永远不会遇到整数溢出的问题***（这可能发生在反转数字方法中）***，因为我们没有创建另一个数字。

**脚步：**

1.  获取数字的长度
2.  从长度+ 1（第一个）循环-> 0
3.  获取第 i 个数字并获取最后一个数字
4.  如果两个数字不相等，则返回 false，因为数字不是回文
5.  一世 -
6.  从 num 中丢弃最后一个数字 (num = num / 10)
7.  厕所结束返回真

    ```
    func isPalindrom(_ input: Int) -> Bool {
           if input < 0 {
                return false
            }

            if input < 10 {
                return true
            }

            var num = input
            let length = Int(log10(Float(input))) + 1
            var i = length

            while i > 0 && num > 0 {

                let ithDigit = (input / Int(pow(10.0, Double(i) - 1.0)) ) % 10
                let r = Int(num % 10)

                if ithDigit != r {
                    return false
                }

                num = num / 10
                i -= 1
            }

            return true
        } 
    ```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2019-03-17T03:14:40.583

```
public static boolean isPalindrome(int x) {
        int newX = x;
        int newNum = 0;
        boolean result = false;
        if (x >= 0) {
            while (newX >= 10) {
                newNum = newNum+newX % 10;
                newNum = newNum * 10;
                newX = newX / 10;
            }
            newNum += newX;

            if(newNum==x) {
            result = true;
            }
            else {
                result=false;
            }
        }

        else {

            result = false;
        }
        return result;
    } 
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2021-02-04T08:03:16.303

```
public boolean isPalindrome(int x) {
        if (isNegative(x))
            return false;

        boolean isPalindrome = reverseNumber(x) == x ? true : false;
        return isPalindrome;
    }

    private boolean isNegative(int x) {
        if (x < 0)
            return true;
        return false;
    }

    public int reverseNumber(int x) {

        int reverseNumber = 0;

        while (x > 0) {
            int remainder = x % 10;
            reverseNumber = reverseNumber * 10 + remainder;
            x = x / 10;
        }

        return reverseNumber;
    } 
```

* * *

## 回答 #47

> 赞同：-1
> 
> 时间：2016-07-25T06:54:49.147

一行python代码：

```
def isPalindrome(number):
    return True if str(number) == ''.join(reversed(str(number))) else False 
```

* * *

## 回答 #48

> 赞同：-1
> 
> 时间：2017-01-18T21:43:04.713

我个人是这样做的，没有重叠；无论字符串的长度是偶数还是奇数，代码都会停止在正确的位置检查匹配的字符。上面发布的其他一些方法将在不需要时尝试匹配一个额外的时间。

如果我们使用长度/2，它仍然可以工作，但它会做一项不需要做的额外检查。例如，“pop”的长度为 3。3/2 = 1.5，所以它会在 i = 2 时停止检查（因为 1<1.5 它也会在 i = 1 时检查）但我们需要它停止在 0，而不是 1。第一个“p”在位置 0，它会根据 length-1-0（当前位置）检查自己，它是位置 2 中的最后一个“p”，然后剩下不需要检查的中心字母。当我们执行长度/2 时，我们在 1 处停止，所以会发生一个额外的检查，其中 i 位于 1 位置（“o”）并将其与自身进行比较（长度-1-i）。

```
// Checks if our string is palindromic.
var ourString = "A Man, /.,.()^&*A Plan, A Canal__-Panama!";
isPalin(ourString);

function isPalin(string) {
// Make all lower case for case insensitivity and replace all spaces, underscores and non-words.
string = string.toLowerCase().replace(/\s+/g, "").replace(/\W/g,"").replace(/_/g,"");
for(i=0; i<=Math.floor(string.length/2-1); i++) {
      if(string[i] !== string[string.length-1-i]) {
        console.log("Your string is not palindromic!");
        break;
      } else if(i === Math.floor(string.length/2-1)) {
        console.log("Your string is palindromic!");
      }
    }
} 
```

[https://repl.it/FNVZ/1](https://repl.it/FNVZ/1)

* * *

## 回答 #49

> 赞同：-1
> 
> 时间：2017-01-27T21:24:16.773

这是我的 Java 代码。基本上比较字符串的第一个和最后一个值以及下一个内部值对等等。

```
 /*Palindrome number*/
    String sNumber = "12321";
    int l = sNumber.length(); // getting the length of sNumber. In this case its 5
    boolean flag = true;
    for (int i = 0; i <= l; ++i) {
        if (sNumber.charAt(i) != sNumber.charAt((l--) -1)) { //comparing the first and the last values of the string
            System.out.println(sNumber +" is not a palindrome number");
            flag = false;
            break;
        }
        //l--; // to reducing the length value by 1 
    }
    if (flag) {
        System.out.println(sNumber +" is a palindrome number");
    } 
```

* * *

## 回答 #50

> 赞同：-1
> 
> 时间：2017-01-28T11:31:14.300

妈的，我疯了！ [http://www.palindromelist.net/palindromes-d/](http://www.palindromelist.net/palindromes-d/)
单步示例：332 是回文数吗？

```
n = 332
q = n / 10 = 33
r = n - 10 * q = 2
r > 0
r != q
n = q = 33
n > r
q = n / 10 = 3
r -= q = 4294967295
r *= 10 = 4294967286
r += n = 23
r != n
r != q
n = q = 3
n > r ? No, so 332 isn't a palindromic number. 
```

溢出也不是问题。两个除法是必要的，在代码 (C#) 中，它们通过乘法完成。一个 n 位数字：~n/2 个分区！

```
const ulong c0 = 0xcccccccdUL;
static bool isPal(uint n)
{
    if (n < 10) return true;
    uint q = (uint)(c0 * n >> 35);
    uint r = n - 10 * q;
    if (r == 0) return false;
    if (r == q) return true;
    n = q;
    while (n > r)
    {
        q = (uint)(c0 * n >> 35);
        r -= q;
        r *= 10;
        r += n;
        if (r == n || r == q) return true;
        n = q;
    }
    return false;
} 
```

< 2^32 的回文数有 142948 个，它们的和是 137275874705916。

```
using System;
class Program
{
    static void Main()  // take a break
    {
        uint n, c; var sw = System.Diagnostics.Stopwatch.StartNew();
        n = ~0u; c = 0; sw.Restart(); while (n > 0) if (isPal0(n--)) c++;
        Console.WriteLine(sw.Elapsed + " " + c);                  // 76 s
        n = ~0u; c = 0; sw.Restart(); while (n > 0) if (isPal1(n--)) c++;
        Console.WriteLine(sw.Elapsed + " " + c);                  // 42 s
        n = ~0u; c = 0; sw.Restart(); while (n > 0) if (isPal2(n--)) c++;
        Console.WriteLine(sw.Elapsed + " " + c);                  // 31 s
        Console.Read();
    }

    static bool isPal0(uint u)
    {
        uint n = u, rev = 0;
        while (n > 0) { uint dig = n % 10; rev = rev * 10 + dig; n /= 10; }
        return u == rev;
    }

    static bool isPal1(uint u)
    {
        uint n = u, r = 0;
        while (n >= 10) r = n + (r - (n /= 10)) * 10;
        return u == 10 * r + n;
    }

    static bool isPal2(uint n)
    {
        if (n < 10) return true;
        uint q = n / 10, r = n - 10 * q;
        if (r == 0 || r == q) return r > 0;
        while ((n = q) > r)
        {
            q /= 10; r -= q; r *= 10; r += n;
            if (r == n || r == q) return true;
        }
        return false;
    }
} 
```

这个好像比较快。

```
using System;
class Program
{
    static void Main()
    {
        uint n, c; var sw = System.Diagnostics.Stopwatch.StartNew();
        n = ~0u; c = 0; sw.Restart(); while (n > 0) if (isPal(n--)) c++;
        Console.WriteLine(sw.Elapsed + " " + c);                 // 21 s
        Console.Read();
    }

    static bool isPal(uint n)
    {
        return n < 100 ? n < 10 || n % 11 == 0 :
              n < 1000 ? /*          */ n / 100 == n % 10 :
             n < 10000 ? n % 11 == 0 && n / 1000 == n % 10 && isP(n) :
            n < 100000 ? /*          */ n / 10000 == n % 10 && isP(n) :
           n < 1000000 ? n % 11 == 0 && n / 100000 == n % 10 && isP(n) :
          n < 10000000 ? /*          */ n / 1000000 == n % 10 && isP(n) :
         n < 100000000 ? n % 11 == 0 && n / 10000000 == n % 10 && isP(n) :
        n < 1000000000 ? /*          */ n / 100000000 == n % 10 && isP(n) :
                         n % 11 == 0 && n / 1000000000 == n % 10 && isP(n);
    }

    static bool isP(uint n)
    {
        uint q = n / 10, r = n - 10 * q;
        do { n = q; q /= 10; r -= q; r *= 10; r += n; } while (r < q);
        return r == q || r == n;
    }
} 
```

使用几乎平衡的二叉搜索意大利面条树。

```
using System;
class Program
{
    static void Main()
    {
        uint n, c; var sw = System.Diagnostics.Stopwatch.StartNew();
        n = c = 0; sw.Restart(); while (n < ~0u) if (isPal(n++)) c++;
        Console.WriteLine(sw.Elapsed + " " + c);              // 17 s
        Console.Read();
    }

    static bool isPal(uint n)
    {
        return n < 1000000 ? n < 10000 ? n < 1000 ? n < 100 ?
        n < 10 || n % 11 == 0 : n / 100 == n % 10 :
        n / 1000 == n % 10 && isP(n) : n < 100000 ?
        n / 10000 == n % 10 && isP(n) :
        n / 100000 == n % 10 && isP(n) :
        n < 100000000 ? n < 10000000 ?
        n / 1000000 == n % 10 && isP(n) :
        n % 11 == 0 && n / 10000000 == n % 10 && isP(n) :
        n < 1000000000 ? n / 100000000 == n % 10 && isP(n) :
        n % 11 == 0 && n / 1000000000 == n % 10 && isP(n);
    }

    static bool isP(uint n)
    {
        uint q = n / 10, r = n - 10 * q;
        do { n = q; q /= 10; r -= q; r *= 10; r += n; } while (r < q);
        return r == q || r == n;
    }
} 
```

颠倒不平衡。

```
using System;
class Program
{
    static void Main()
    {
        uint n, c; var sw = System.Diagnostics.Stopwatch.StartNew();
        n = c = 0; sw.Restart(); while (n < ~0u) if (isPal(n++)) c++;
        Console.WriteLine(sw.Elapsed + " " + c);              // 16 s
        Console.Read();
    }

    static bool isPal(uint n)
    {
        return
        n > 999999999 ? n % 11 == 0 && n / 1000000000 == n % 10 && isP(n) :
        n > 99999999 ? n / 100000000 == n % 10 && isP(n) :
        n > 9999999 ? n % 11 == 0 && n / 10000000 == n % 10 && isP(n) :
        n > 999999 ? n / 1000000 == n % 10 && isP(n) :
        n > 99999 ? n % 11 == 0 && n / 100000 == n % 10 && isP(n) :
        n > 9999 ? n / 10000 == n % 10 && isP(n) :
        n > 999 ? n % 11 == 0 && n / 1000 == n % 10 && isP(n) :
        n > 99 ? n / 100 == n % 10 :
        n < 10 || n % 11 == 0;
    }

    static bool isP(uint n)
    {
        uint q = n / 10, r = n - 10 * q;
        do { n = q; q /= 10; r -= q; r *= 10; r += n; } while (r < q);
        return r == q || r == n;
    }
} 
```

* * *

## 回答 #51

> 赞同：-1
> 
> 时间：2019-04-03T17:55:55.460

这个解决方案非常有效，因为我使用的是 StringBuilder，这意味着 StringBuilder 类被实现为一个可变的字符序列。这意味着您将新的字符串或字符附加到 StringBuilder 上。

```
 public static boolean isPal(String ss){
   StringBuilder stringBuilder = new StringBuilder(ss);
   stringBuilder.reverse();
   return ss.equals(stringBuilder.toString());
 } 
```

* * *

## 回答 #52

> 赞同：-1
> 
> 时间：2021-11-07T15:24:37.423

我认为这里提供的最佳解决方案[https://stackoverflow.com/a/199203/5704551](https://stackoverflow.com/a/199203/5704551)

此解决方案的编码实现可能类似于：

```
var palindromCheck(nums) = () => {
    let str = x.toString()
    // + before str is quick syntax to cast String To Number.
    return nums === +str.split("").reverse().join("")  
} 
```

# ide - 你区分文本编辑器和 IDE 吗？

> ID：199207
> 
> 赞同：6
> 
> 时间：2008-10-13T22:15:28.880
> 
> 标签：ide, text-editor

我已经看到了一些关于 IDE 的问题的回复，其中建议使用文本编辑器，反之亦然。这让我认为人们将它们视为同一事物，我在其中做出了明确的区分。

1.  你如何定义“文本编辑器”和“IDE”？
2.  您看到这两种工具之间的区别了吗？

请注意，我接受了一个我认为最能解决“文本编辑器”和“IDE”概念的答案。但是，这只是我个人对最能解决这个问题的看法，我会不时继续检查这个问题，看看是否有更好的答案，我会接受那个答案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-13T22:18:04.163

混淆源于文本编辑器是每个 IDE 的核心组件这一事实。但是，IDE 不仅仅是一个文本编辑器。它还具有编译器、调试器、分析器、参考资料等的接口。

许多文本编辑器都有插件或其他灵活的扩展机制，通常包括像我上面提到的那样“包装”外部工具的能力。恕我直言，关键区别在于 IDE 中的“I” - 集成。IDE（同样，恕我直言）是专门设计用于支持一组特定工具的东西，其中一个是文本编辑器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T22:21:15.717

我有，但更多的是你使用它们的方式，而不是软件本身的差异。某些软件被某些人用作 IDE，而其他人则仅用作文本编辑器。有的软件只能是文本编辑器，有的软件很难单独作为文本编辑器使用，有的软件两者兼有。

我会说像 Vi(m) 和 Emacs 这样的中坚分子被一些用作文本编辑器和一些用作 IDE。像 Eclipse、Visual Studio 等只有在 IDE 中才真正有意义，而像记事本这样的东西只能是文本编辑器。

我想说，如果你留在文本编辑器中做其他事情——编译、调试等——那么你使用它更像是一个 IDE。我不确定在哪里画线。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-13T22:50:22.397

我两者都用，我建议你也用。有时 IDE 可以加快开发速度——例如代码完成和重构支持。快速查找项目中的文件和符号、函数、类，更不用说项目管理功能了。有时他们会为您管理构建。也许它有一个内置的调试器（一个好的内置调试器是值得的）。代码片段和文件模板怎么样。有时 IDE 会帮助您构建 GUI 界面和数据存储。我见过一些可以帮助您构建正则表达式和运行 SQL 查询的方法。

这些（IMO）都是糖。我还使用纯文本编辑器（尽管我现在非常喜欢代码语法着色）并自己滚动大部分其他内容。一些较新的文本编辑器正逐渐进入 IDE 领域（例如 TextMate），因为它们的可扩展性足以支持上述大部分段落的细节。

在 90% 的情况下，我使用给定的或大多数团队使用的（我是承包商）。如果您决定自己动手，这可以减少可能出现的构建冲突。通过学习使用 IDE、文本编辑器以及介于两者之间的一切，您将保持灵活性并能够应对任何向您抛出的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-13T22:19:22.787

明显的区别是 IDE 中的“I”。IDE 是一个集成平台，它不仅允许编辑，还允许调试、项目文件管理以及通常很酷的功能，如语法突出显示和代码完成。哦，是的，还有工具和编译器的集成，以及源代码控制。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T22:24:53.040

对我来说，文本编辑器是用于编辑基于文本的文档的轻量级工具。除了为编辑器定义“系统”字体外，没有任何标记或文本格式。有用的工具仍然可以是文本编辑器的一部分，例如文件夹树、语法高亮，甚至是编译器的命令行执行。最后，它所做的一切都允许您编辑文档中的文本。它不会以不同的方式向您显示它。即：查看 XML 文档时它不会显示网格

IDE 更加健壮，并且通常特定于语言或框架。

你知道，在我开始写这个答案之前，我在文本编辑器和 IDE 之间有明确的界限。但现在，我认为他们是同一个。我的意思是真的，像 VS 这样的 IDE 只是一个美化的文本编辑器。像 Textpad 这样的文本编辑器是一种 IDE，用于开发功能的预算要少得多。

我想真正的答案是，一个 IDE 是由一家大公司或集团支持的，它在许多不同的方向上扩展它的功能。但是文本编辑器是由一小群人构建的，只有足够的功能才能使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T23:02:02.857

如果您查看[Kate](http://kate-editor.org/)、文本编辑器和[Kdevelop](http://www.kdevelop.org)，IDE 的主要区别在于 Kdevelop 支持项目管理（CVS/Subversion）和构建脚本，而 Kate 不支持。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T23:42:43.073

就我个人而言，我认为 IDE 和文本编辑器之间的“界线”是对最终程序的了解，而不仅仅是对源代码的了解。

例如：

*   它可以将您的代码编译成二进制文件吗？这是一个IDE
*   它有集成调试器吗？这是一个IDE
    *   为了拥有一个集成的调试器，它需要了解二进制编译程序，或者在脚本语言的情况下，程序运行时的内存解释。

注意：像智能感知这样的东西不依赖于你的代码被编译成任何东西，所以我不会说智能感知意味着 IDE

注意 2：许多文本编辑器（如 textmate）都有插件系统，可以扩展以构建您的项目。这并不能使它们成为 IDE，因为它们只是简单地使用插件，它们对构建本身一无所知。

# c# - Ping 总是成功，无法在 url 上使用 ping 轻松检查正常运行时间

> ID：199219
> 
> 赞同：1
> 
> 时间：2008-10-13T22:18:48.343
> 
> 标签：c#, .net, ping, system.net

我因为 OpenDNS 和其他服务（即：roadrunner）而感到沮丧，即使您输入任何无效的 url，现在总是返回 ping，即：lkjsdaflkjdsjf.com --- 我已经创建了供我自己使用的软件，可以 ping 一个 url 来验证该网站是否已启动。这不再有效。有人对此有任何想法吗？

要求：

1.  它应该适用于任何有效的网站，即使是我无法控制的网站
2.  它应该能够从任何可以访问 Internet 的网络运行

我将不胜感激听到其他人现在如何处理这个问题。我想补充一下，我试图在 c# 中使用 System.Net 来做到这一点

非常感谢你:-)

新增功能：寻找一个我可以购买并在我的 Windows 机器上运行的解决方案，或者在 c# 中编程。:-)

**更新：**

非常感谢大家的回答。最终我最终通过这样做创建了一个解决方案：

1.  创建一个从 url 下载指定页面的简单网络客户端（可能更改为仅标题或使用它来通知页面更改）
2.  读取 xml 文件，该文件仅列出要检查的站点/页面的完整 url
3.  创建了一个 Windows 服务来托管解决方案，以便它可以恢复服务器重新启动。
4.  出错时，将向定义的收件人列表发送电子邮件和短信
5.  大多数值（interval、smtp、to、from 等）都在 .config 中定义，以便于更改

稍后我将采纳您的一些建议来添加“功能”，其中包括：

*   用于实时监控的 AJAX 页面。我将使用 WCF 从 asp.net 页面连接到现有的 windows 服务
*   仅下载标题（带有页面更改比较选项）
*   更可配置（即：在通知之前重试失败）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-13T22:22:36.993

[Wget](http://www.gnu.org/software/wget/)是一个不错的选择。它不仅会检查机器是否处于活动状态，还会检查 HTTP 服务器是否正在接受连接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T22:24:20.717

要查看服务是否启动，您不仅应该 ping，而且最好拥有能够访问服务（例如网站）并获得有效响应的脚本。我过去使用过 What's Up Gold，而不是自己编写。我喜欢这样的产品的所有功能。例如在服务关闭时向我发送一个页面。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T22:27:40.400

您可以创建一个简单的网页，其中包含网站的地址栏和一些使用 AJAX 访问网站的 javascript。如果您在异步回调中收到除 200 以外的任何 HTTP 响应，则该站点无法正常工作。

```
<html>
  <head>
     <script language="javascript" type="text/javascript">
     <!--
        var ajax = new XMLHttpRequest();

        function pingSite() {
           ajax.onreadystatechange = stateChanged;
           ajax.open('GET', document.getElementById('siteToCheck').value, true);
           ajax.send(null);
        }

        function stateChanged() {
           if (ajax.readyState == 4) {
              if (ajax.status == 200) {
                 document.getElementById('statusLabel').innerHTML = "Success!";
              }
              else {
                 document.getElementById('statusLabel').innerHTML = "Failure!";
              }
           }
        }
     -->
     </script>
  </head>

  <body>
     Site To Check:<br />
     <input type="text" id="siteToCheck" /><input type="button" onclick="javascript:pingSite()" />

     <p>
        <span id="statusLabel"></span>
     </p>
  </body> 
```

这段代码取决于浏览器不是 IE，我还没有测试过，但它应该给你一个非常好的主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T22:44:35.263

作为记录，lkjsdaflkjdsjf.com 是一个主机名（目前尚未向任何人注册）。ping 不适用于 URL，ping 可用于主机名。[使用域名系统](http://en.wikipedia.org/wiki/Domain_name_system)查找主机名。当主机名未注册时，DNS 应该会失败。

问题是某些服务（显然是您的 ISP，肯定是 OpenDNS）不会使未注册主机名的 DNS 请求失败。相反，它们会返回其网络上的主机的 IP 地址，该地址会为任何 http 请求提供搜索页面。

您似乎想知道两件事：这个名字是真实的（也就是说，是否有一个使用这个名字的主机注册到某个实际的机器上）？那台机器运转正常吗？

如果您已经知道有问题的名称是真实的（例如，您想知道 www.google.com 是否已启动），那么您可以使用 ping，因为您知道该名称将解析为真实地址（ISP 可以'不要返回他们的 IP 以获得注册名称），你只会测量那台机器是否在运行。

如果您不知道该名称是否真实，那么问题就更难了，因为您的 ISP 正在向您的 DNS 请求返回虚假数据。这里唯一的解决方案是找到一个不会对未解析名称撒谎的 DNS 服务器。

我能想到区分您的 ISP 的虚假记录和真实记录的唯一方法是对您返回的 IP 进行[反向查找](http://en.wikipedia.org/wiki/Reverse_DNS_lookup)，看看该 IP 是否在您的 ISP 网络中。这个技巧的问题在于，如果 ISP 没有该 IP 的反向 DNS 信息，您将不知道是 ISP 还是只是一些没有正确配置他的 DNS 的笨蛋（我犯了很多错误过去的时间）。

我确信还有其他技术，但 DNS 位于一切之下的事实使得处理这个问题变得困难。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T23:42:21.607

不要直接知道 c# 中的任何现成选项，但如果没有几个可用的选项，我会非常惊讶。

几年前我写过类似的东西，不再有代码了，因为它属于其他人，但基本思想是使用 WebClient 访问域默认页面，并检查 http 状态代码 200。

然后，您可以围绕此操作的成功或失败连接任何通知逻辑。

如果带宽是一个问题，您可以将其修剪为仅使用 HEAD 请求。

对于您控制的更复杂的站点，您可以连接一个运行状况监控页面，该页面在发送响应之前进行一些更深入的测试，例如数据库连接是否正常等。

通常，在端口 80 上死机的机器仍会响应 ping，因此测试端口 80（或您感兴趣的任何其他端口）将是一种更可靠的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T22:24:40.733

我发现 ping 非常不可靠，因为您必须跳过所有跃点，而介于两者之间的东西总是会干扰。

尝试打开与 Web 服务器的 http 连接可能是最好的方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T22:31:11.157

如果您有 cygwin 可用，您可以尝试运行“httping”或

[http://freshmeat.net/projects/httping/](http://freshmeat.net/projects/httping/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T23:00:54.670

据我所见，这里的问题是 OpenDNS 将无效域解析回它们自己以将您转发到接近您所追求的东西（因此，如果您输入错误 ggooggllee.com，您最终会通过从OpenDNS 服务器）。（如我错了请纠正我）

如果是这种情况，您应该能够检查您解析的IP是否== OpenDNS的任何IP？没有更多的 ping - 没有协议 (HTTP) 级别的东西 - 只是检查例外情况？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-13T23:08:26.090

如果您倾向于 sys-admin 解决方案而不是编程解决方案，您可以安装一个本地名称服务器，并告诉它除了 NS 记录之外不接受任何内容用于仅授权区域。这是我（我假设互联网上的其他人）在网络解决方案/威瑞信上次破坏时使用的修复程序。我在几台本地机器上安装了 BIND，告诉我的 DHCP 服务器将这些地址作为本地名称服务器分发，并为我关心的每个仅委托区域设置如下内容：

```
zone "com" { type delegation-only; };
zone "net" { type delegation-only; }; 
```

想到这一点，我认为这可能会在以后的 BIND 版本中默认打开。作为一个额外的好处，您往往会获得比大多数 ISP 提供的更稳定的 DNS 解析，您可以控制自己的缓存、一些补丁，并且您不必依赖您的 ISP 来修复最新的 DNS 攻击等。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-14T01:02:20.213

我喜欢[CALM](http://www.nov8r.com/calm.aspx)这类东西，因为它记录到数据库并提供电子邮件通知以及状态仪表板

您可以在网站上设置一个测试页面并定期在其上执行 GET 以接收“真实”结果（一切正常）或通过电子邮件发送给您的错误消息结果

警告：我是 CALM 的作者

# single-sign-on - BizTalk 解决 SSO 错误“无法兑换票证，消息中不存在票证”

> ID：199235
> 
> 赞同：2
> 
> 时间：2008-10-13T22:22:43.343
> 
> 标签：single-sign-on, biztalk, biztalk2006r2

我正在使用 BizTalk 适配器包中的 Oracle 适配器（基于 WCF 用于 BTS 2006 R2）。在“solicit-response”发送端口的配置中，我使用了Oracle的用户名和密码来连接数据库。

现在我想改变它并使用 SSO。到目前为止，我已经创建了 Affiliate 应用程序并将 BTS 主机实例“用户 ID”映射到 Oracle 数据库用户详细信息。

当我运行应用程序时，我不断收到错误消息：“无法兑换票，消息中不存在票”。

阅读 BTS 文档后，我在“ms-help://MS.BTS.2006/BTS06CoreDocs/html/c7bf755c-c37d-4b19-9817-a7f42e1e9656.htm”中找到了以下内容：在编排调用发送适配器的场景中， BizTalk 消息引擎将消息发送到 MessageBox 数据库。业务流程应确保维护包含票证的消息的**SSOTicket**上下文属性和**Microsoft.BizTalk.XLANGs.BTXEngine.OriginatorSID上下文属性。**当适配器从 MessageBox 数据库接收到此消息时，适配器会使用加密票证调用 RedeemTicket 方法，以从 SSO 存储区检索后端凭据。设计编排的用户应专门将此属性复制到消息中。

但是我通过 SQL 集成连接收到一条没有 SSO 票证的消息。

请帮忙解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-03-05T02:33:33.467

您可以在发送端口上的自定义管道组件中添加 SSO 票证。以下代码适用于我：

```
 public IBaseMessage Execute(IPipelineContext pContext, IBaseMessage pInMsg)
    {
        ISSOTicket ssoTicket = new ISSOTicket();
        pInMsg.Context.Write("SSOTicket", "http://schemas.microsoft.com/BizTalk/2003/system-properties", ssoTicket.IssueTicket(0));
        return pInMsg;
    } 
```

这将为 Biztalk 主机实例服务帐户生成票证，因此您的 Oracle 附属应用程序映射应该可以按预期工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-04-14T07:05:51.697

您可能需要“允许票证”到 SSO 管理员中的系统属性。否则，即使您允许会员申请的门票，它也不会起作用。

# c# - 如何找到字符串格式错误的 XML（在 C# 中）的位置？

> ID：199238
> 
> 赞同：1
> 
> 时间：2008-10-13T22:23:39.953
> 
> 标签：c#, xml, algorithm

我正在编写一个轻量级的 XML 编辑器，如果用户的输入格式不正确，我想向用户指出问题出在哪里，或者至少是第一个问题出在哪里。有谁知道这方面的现有算法？如果查看代码有帮助，如果我可以填写 FindIndexOfInvalidXml 方法（或类似方法），这将回答我的问题。

```
using System;

namespace TempConsoleApp
{
    class Program
    {
        static void Main(string[] args)
        {
            string text = "<?xml version=\"1.0\"?><tag1><tag2>Some text.</taagg2></tag1>";
            int index = FindIndexOfInvalidXml(text);
            Console.WriteLine(index);
        }

        private static int FindIndexOfInvalidXml(string theString)
        {
            int index = -1;

            //Some logic

            return index;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T22:53:06.197

我可能只是作弊。:) 这将为您提供行号和位置：

```
string s = "<?xml version=\"1.0\"?><tag1><tag2>Some text.</taagg2></tag1>";
System.Xml.XmlDocument doc = new System.Xml.XmlDocument();

try
{
    doc.LoadXml(s);
}
catch(System.Xml.XmlException ex)
{
    MessageBox.Show(ex.LineNumber.ToString());
    MessageBox.Show(ex.LinePosition.ToString());
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T22:50:59.930

除非这是一项学术练习，否则我认为编写自己的 XML 解析器可能不是解决此问题的最佳方式。我可能会检查System.Xml 命名空间中的[XmlDocument 类，并尝试/捕获 Load() 或 LoadXml() 方法的](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx)[异常](http://msdn.microsoft.com/en-us/library/system.xml.xmlexception.aspx)。异常的消息属性应该包含错误发生位置的信息（行/列号），我怀疑使用正则表达式来提取这些错误消息和相关的位置信息会更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T22:54:02.123

您应该能够简单地将字符串加载到 XmlDocument 或 XmlReader 中并捕获 XmlException。XmlException 类具有 LineNumber 属性和 LinePosition 属性。

如果除了检查文档是否格式正确之外，还想针对架构进行验证，还可以使用 XmlValidatingReader。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T22:55:28.707

您希望通过 load 方法将字符串加载到 XmlDocument 对象中，然后捕获任何异常。

```
public bool isValidXml(string xml)
{
    System.Xml.XmlDocument xDoc = null;
    bool valid = false;
    try
    {
        xDoc = new System.Xml.XmlDocument();
        xDoc.loadXml(xmlString);
        valid = true;
    }
    catch
    {
        // trap for errors
    }
    return valid;
} 
```

# java - java内存编译

> ID：199241
> 
> 赞同：10
> 
> 时间：2008-10-13T22:24:20.750
> 
> 标签：java, runtime, compilation

如何在运行时从字符串生成字节码（Byte []），而不使用“javac”进程或类似的东西？有没有像这样调用编译器的简单方法？

后期补充：

我选择[接受最适合**我**情况](https://stackoverflow.com/questions/200833/when-should-i-accept-an-answer)的解决方案。我的应用程序是一个仍处于设计草图阶段的爱好项目，现在是考虑插入新技术的正确时机。此外，由于应该在 BL 方面帮助我的人是 JavaScript 开发人员，因此在这种情况下，使用 JavaScript 解释器而不是存根编译器 + 类加载器的想法似乎对我更有吸引力。这个问题的其他（不被接受的）答案提供了丰富的信息，据我所知，很好地回答了我的问题，所以谢谢，但我要试试[Rhino](http://www.mozilla.org/rhino/) :)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-13T22:45:51.907

JDK6 有一个[Java 编译器 API](http://www.java2s.com/Code/Java/JDK-6/CompilingfromMemory.htm)。但是，它不一定很容易使用。

一个快速的谷歌提取了[这个示例用法](http://www.java2s.com/Code/Java/JDK-6/CompilingfromMemory.htm)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-13T23:02:50.080

我认为你最好的投篮将是[Janino](http://www.janino.net/)。这将让您在运行时编译代码并从程序的其余部分调用它。我们在一些系统中使用它来让我们动态更新一些类。

它不是免费的。它运行良好，但是每次加载新类（或类的版本）时它都会使用 permgen 空间，因此如果您有一个（真正）长时间运行的进程（或加载大量新类的东西），您最终会耗尽内存) 但是如果这是一个问题，您可以更改 JVM 中的 permgen 空间量以将障碍移出相当大的距离。

Janino 实际上是一个编译器，但是如果您需要在该级别进行操作，您可以看到它是如何注入字节码的。您可能最终需要制作一个类加载器或按照 Tom Hawtin 的建议使用 Java 编译器 API。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-13T22:27:04.580

您可能会发现 rhino 或 groovy 之类的东西在实践中更有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T22:44:35.513

只要 JDK 中的 tools.jar 文件位于类路径中，您就可以访问编译器。它的文档在[这里](http://java.sun.com/javase/6/docs/api/javax/tools/JavaCompiler.html)。API 不像`eval()`某些解释语言那样简单，但它就在那里。

您可能还必须进入一些奇怪的 ClassLoader 代码才能实际运行该代码，我对此并不完全确定。

# database-design - 管理 Web 应用程序权限的最佳方法是位掩码还是数据库表？

> ID：199252
> 
> 赞同：61
> 
> 时间：2008-10-13T22:27:09.637
> 
> 标签：database-design, web-applications, permissions

我正在考虑为“管理员”Web 应用程序设计权限系统的最佳方式。应用程序可能有很多用户，每个用户都可以分配一个特定的角色；其中一些用户可能被允许执行角色之外的特定任务。

我可以想到两种设计方法：一种是“权限”表，每个用户都有一行，一个布尔列，每个任务一个，为他们分配执行这些任务的权限。像这样：

```
用户 ID 管理用户 管理产品 管理促销 管理订单
1 真的 真的 真的 真的
2 假 真 真 真
3假假假真假

```

我想到的另一种方法是使用位掩码来存储这些用户权限。对于 32 位有符号整数，这会将可以管理的任务数量限制为 31 个，但实际上我们不太可能拥有超过 31 个用户可以执行的特定任务。这样，数据库模式会更简单，而且每次我们添加需要访问控制的新任务时都不必更改表结构。像这样：

```
用户 ID 权限（8 位掩码），将是表中的整数
1 00001111
2 00000111
3 00000001

```

这里的人们通常使用什么机制，为什么？

谢谢！

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-10-13T22:42:00.667

我认为远离编码宇宙意义的神秘比特串是一般的经验法则。

虽然可能更笨重，但拥有一个可能的权限表、一个用户表以及它们之间的链接表是组织它的最佳和最清晰的方式。它还使您的查询和维护（尤其是对于新人）更容易。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-10-13T22:32:02.637

如何创建一个 Permission 表，然后创建一个 UserPermission 表来存储关系？

您永远不必再次修改结构，并且可以添加任意数量的权限。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-10-13T22:38:16.353

我已经做到了两种方式。但我不再使用位掩码了。给定用户 ID 或组 ID 作为外键，可以使用单独的表作为交叉引用。

```
UserID | Permission
===================
1      | 1              1 representing manage users
1      | 2              2 being manger products
2      | 3 
```

这种方式将更容易维护并在以后添加。

我还会使用单独的表来管理权限。

```
PermissionID | Description
==========================
1            | Manage Users
2            | Manager Products 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-13T23:43:35.707

通常我有一个用户表、一个角色表和一个用户角色表。这样，您可以拥有无​​限数量的角色，而无需更改数据库结构，并且用户可以拥有多个角色。

我强制应用程序只授权角色（从不用户）。请注意角色表中的“id”列不是身份列。这是因为您可能需要控制放入此表中的 ID，因为您的应用程序将不得不查找特定的 ID。

结构如下所示：

```
create table Users (
 id int identity not null,
 loginId varchar(30) not null,
 firstName varchar(50) not null,
 etc...
)

create table Roles (
 id int not null,
 name varchar(50) not null
)

create table UserRoles (
 userId int not null,
 roleId int not null
) 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-10T23:10:02.413

如果您在托管环境中，则可以使用 Active Directory 或其他 LDAP 实现。这样，确定权限的安全组可以由一线支持人员使用他们很可能已经熟悉的技术进行管理。

如果您的应用是收缩包装的，那么对于 Levi Rosol 对数据库进行规范化的建议 +1，以便您可以在应用中拥有可扩展的数据模型。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-13T22:44:32.720

我建议使用角色提供者的概念来抽象您的 Web 应用程序权限。[从 2.0 版开始，它在 .NET 中作为System.Web.Security.RoleProvider](http://msdn.microsoft.com/en-us/library/system.web.security.roleprovider.aspx)为您提供。

基本思想是通过针对框架而不是特定存储机制编写权限检查来利用现有框架。然后，您可以插入任何可用的存储机制，无论是 XML 文件、数据库，甚至是使用 Windows 软件授权管理器的[授权存储](http://technet.microsoft.com/en-us/library/cc737065.aspx)（例如，它可以让您将自定义权限无缝绑定到 LDAP - 否配置所需的代码）。

如果您决定使用数据库作为存储机制，则支持多个数据库来自动创建框架所需的基础表。这包括在 Mono 上运行 .NET 和在 MySQL 之上使用角色提供者模型。

有关更多信息，请参阅[实现角色提供程序](http://msdn.microsoft.com/en-us/library/8fw7xh74.aspx)。完全有可能其他语言/环境也有可以用来实现这个概念的库——这值得研究。

**编辑**：我还应该指出您的 Web 应用程序如何与存储机制关联的配置是通过 web.config 文件完成的，并且不需要更改代码。我发现这对于在我的本地机器上测试代码库的生产版本非常有用，使用 XML 文件来模拟权限而不是普通的数据库提供程序——所有这些都通过修改 web.config 中的两行来实现。

我忘了提到的另一件事是，您可以通过扩展基类来插入您自己的自定义提供程序，允许您利用权限模型但仍然使用专有存储系统（例如位掩码，如果您真的想要） .

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-13T22:41:05.753

我已经看到了一些类似于您所建议的有限权限系统 - 以及一些真正糟糕的系统。在一些简单的情况下，只要应用程序不变得更复杂，它们是可以接受的。然而，在很多情况下，它们确实变得更加复杂，并且必须重写系统以适应所需的功能。

如果您认为有一天您可能需要表达能力，我会使用带有用户和组（或角色）的完整 ACL（访问控制列表）系统。也就是说，每个受权限控制的事物（例如“管理用户”、“管理产品”）都有一个 ACL，它是所有有权访问它的用户和组的列表。然后，用户要么被直接添加到相关的 ACL，要么被添加到已经是 ACL 成员的组中。

尽管 ACL 建议使用列表实现，但最好使用表格；[这个答案](https://stackoverflow.com/questions/199252/what-is-the-best-way-to-manage-permissions-for-a-web-application-bitmask-or-dat#199287)是一个好方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-07-19T04:37:16.457

无法发表评论，因为我是 SO 新手，但关于公认的答案 - 此解决方案带来的一个巨大优势是能够普遍处理权限，而不仅仅是代码中各处的 if 语句，以及特殊能力例如允许临时权限（有过期日期的权限）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-13T22:32:55.957

权限通常是带有 1、0 或 null（表示继承）的关键字。使用位系统，您可能无法在用户 id 和权限关键字上创建索引；相反，您必须扫描每条记录以获取权限值。

我会说选择第一个选项。在我看来，更好的解决方案：

```
create table permissions (
    user_id INT NOT Null,
    permission VARCHAR(255) NOT NULL,
    value TINYINT(1) NULL
)
alter table `permissions` ADD PRIMARY KEY ( `user_id` , `permission` ) 
```

# utf-8 - 如何将 UTF-8 字符串反转到位？

> ID：199260
> 
> 赞同：14
> 
> 时间：2008-10-13T22:30:19.973
> 
> 标签：utf-8, string, algorithm, performance

最近，有人询问了一种[在 C 中反转字符串的算法](https://stackoverflow.com/questions/198199/how-do-you-reverse-a-string-in-place-in-c-or-c)。大多数提出的解决方案在处理非单字节字符串时都会遇到麻烦。所以，我想知道什么是专门处理 utf-8 字符串的好算法。

我想出了一些代码，我将其作为答案发布，但我很高兴看到其他人的想法或建议。我更喜欢使用实际代码，所以我选择了 C#，因为它似乎是这个网站上最流行的语言之一，但我不介意你的代码是另一种语言，只要它可以合理任何熟悉命令式语言的人都能理解。而且，因为这是为了了解如何在低级别实现这样的算法（低级别我只是指处理字节），所以这个想法是避免将库用于核心代码。

**笔记：**

我对算法本身、它的性能以及如何优化它感兴趣（我的意思是算法级优化，不是用 ++i 替换 i++ 等；我对实际的基准测试也不感兴趣）。

我并不是要在生产代码中实际使用它或“重新发明轮子”。这只是出于好奇和练习。

我正在使用 C# 字节数组，所以我假设您可以在不运行字符串的情况下获取字符串的长度，直到找到 NUL。也就是说，我没有考虑找到字符串长度的复杂性。但是，如果您使用的是 C，例如，您可以在调用核心代码之前使用 strlen() 将其排除在外。

**编辑：**

正如 Mike F 所指出的，我的代码（以及此处发布的其他人的代码）没有处理复合字符。[关于这里](http://www.unicode.org/faq/char_combmark.html)的一些信息。我不熟悉这个概念，但如果这意味着存在“组合字符”，即仅与其他“基本”字符/代码点组合有效的字符/代码点，则此类查找表字符可用于在反转时保留“全局”字符（“基”+“组合”字符）的顺序。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-13T22:34:52.180

我会进行一次反转字节，然后第二次将任何多字节字符（在 UTF8 中很容易检测到）中的字节反转回正确的顺序。

您绝对可以一次性处理此问题，但除非例程成为瓶颈，否则我不会打扰。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-13T23:44:36.220

此代码假定输入的 UTF-8 字符串有效且格式正确（即每个多字节字符最多 4 个字节）：

```
#include "string.h"

void utf8rev(char *str)
{
    /* this assumes that str is valid UTF-8 */
    char    *scanl, *scanr, *scanr2, c;

    /* first reverse the string */
    for (scanl= str, scanr= str + strlen(str); scanl < scanr;)
        c= *scanl, *scanl++= *--scanr, *scanr= c;

    /* then scan all bytes and reverse each multibyte character */
    for (scanl= scanr= str; c= *scanr++;) {
        if ( (c & 0x80) == 0) // ASCII char
            scanl= scanr;
        else if ( (c & 0xc0) == 0xc0 ) { // start of multibyte
            scanr2= scanr;
            switch (scanr - scanl) {
                case 4: c= *scanl, *scanl++= *--scanr, *scanr= c; // fallthrough
                case 3: // fallthrough
                case 2: c= *scanl, *scanl++= *--scanr, *scanr= c;
            }
            scanr= scanl= scanr2;
        }
    }
}

// quick and dirty main for testing purposes
#include "stdio.h"

int main(int argc, char* argv[])
{
    char buffer[256];
    buffer[sizeof(buffer)-1]= '\0';

    while (--argc > 0) {
        strncpy(buffer, argv[argc], sizeof(buffer)-1); // don't overwrite final null
        printf("%s → ", buffer);
        utf8rev(buffer);
        printf("%s\n", buffer);
    }
    return 0;
} 
```

如果您编译此程序（示例名称`so199260.c`：）并在 UTF-8 环境（本例中为 Linux 安装）上运行它：

```
$ so199260 γεια και χαρά français АДЖИ a♠♡♢♣b
a♠♡♢♣b → b♣♢♡♠a
АДЖИ → ИЖДА
français → siaçnarf
χαρά → άραχ
και → ιακ
γεια → αιεγ 
```

如果代码太神秘，我会很乐意澄清。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-13T23:14:00.930

同意您的方法是就地执行此操作的唯一合理方法。

就个人而言，我不喜欢在处理它的每个函数中重新验证 UTF8，并且通常只做避免崩溃所需的事情；它加起来的代码要少得多。不知道多少 C#，所以这里是 C：

（*编辑以消除 strlen*）

```
void reverse( char *start, char *end )
{
    while( start < end )
    {
        char c = *start;
        *start++ = *end;
        *end-- = c;
    }
}

char *reverse_char( char *start )
{
    char *end = start;
    while( (end[1] & 0xC0) == 0x80 ) end++;
    reverse( start, end );
    return( end+1 );
}

void reverse_string( char *string )
{
    char *end = string;
    while( *end ) end = reverse_char( end );
    reverse( string, end-1 );
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-13T22:35:08.497

我最初的方法可以这样总结：

1) 天真地反转字节

2) 向后运行字符串并随时修复 utf8 序列。

非法序列在第二步中处理，在第一步中，我们检查字符串是否处于“同步”状态（即，它是否以合法的前导字节开头）。

编辑：改进了 Reverse() 中前导字节的验证

```
class UTF8Utils {

    public static void Reverse(byte[] str) {
        int len = str.Length;
        int i   = 0;
        int j   = len - 1;

        //  first, check if the string is "synced", i.e., it starts
        //  with a valid leading character. Will check for illegal 
        //  sequences thru the whole string later.
        byte leadChar = str[0];

        //  if it starts with 10xx xxx, it's a trailing char...
        //  if it starts with 1111 10xx or 1111 110x 
        //  it's out of the 4 bytes range.
    //  EDIT: added validation for 7 bytes seq and 0xff
        if( (leadChar & 0xc0) == 0x80 ||
            (leadChar & 0xfc) == 0xf8 ||
            (leadChar & 0xfe) == 0xfc ||
        (leadChar & 0xff) == 0xfe ||
        leadChar == 0xff) {

            throw new Exception("Illegal UTF-8 sequence");

        }

        //  reverse bytes in-place naïvely
        while(i < j) {
            byte tmp = str[i];
            str[i]  = str[j];
            str[j]  = tmp;
            i++;
            j--;
        }
        //  now, run the string again to fix the multibyte sequences
        UTF8Utils.ReverseMbSequences(str);

    }

    private static void ReverseMbSequences(byte[] str) {
        int i = str.Length - 1;
        byte leadChar = 0;
        int nBytes  = 0;

        //  loop backwards thru the reversed buffer
        while(i >= 0) {
            //  since the first byte in the unreversed buffer is assumed to be
            //  the leading char of that byte, it seems safe to assume that the  
            //  last byte is now the leading char. (Given that the string is
            //  not out of sync -- we checked that out already)
            leadChar = str[i];

            //  check how many bytes this sequence takes and validate against
            //  illegal sequences
            if(leadChar < 0x80) {
                nBytes = 1;
            } else if((leadChar & 0xe0) == 0xc0) {
                if((str[i-1] & 0xc0) != 0x80) {
                    throw new Exception("Illegal UTF-8 sequence");
                }
                nBytes = 2;
            } else if ((leadChar & 0xf0) == 0xe0) {
                if((str[i-1] & 0xc0) != 0x80 ||
                    (str[i-2] & 0xc0) != 0x80 ) {
                    throw new Exception("Illegal UTF-8 sequence");
                }
                nBytes = 3;
            } else if ((leadChar & 0xf8) == 0xf0) {
                if((str[i-1] & 0xc0) != 0x80 ||
                    (str[i-2] & 0xc0) != 0x80 ||
                    (str[i-3] & 0xc0) != 0x80  ) {
                    throw new Exception("Illegal UTF-8 sequence");
                }
                nBytes = 4;
            } else {
                throw new Exception("Illegal UTF-8 sequence");
            }

            //  now, reverse the current sequence and then continue
            //  whith the next one
            int back    = i;
            int front   = back - nBytes + 1;

            while(front < back) {
                byte tmp = str[front];
                str[front] = str[back];
                str[back] = tmp;
                front++;
                back--;
            }
            i -= nBytes;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-10-13T22:36:16.013

最佳解决方案：

1.  转换为宽字符字符串
2.  反转新字符串

从不，从不，从不，从不将单个字节视为字符。

# validation - 在函数中使用参数之前，我应该确保参数不为空吗？

> ID：199263
> 
> 赞同：6
> 
> 时间：2008-10-13T22:30:58.303
> 
> 标签：validation, function, exception, arguments

标题可能无法真正解释我真正想表达的意思，也想不出一种方法来描述我的意思。

我想知道在使用函数之前检查函数接受的参数是否为空值或空值是否是一种好习惯。我有这个函数，它只是像这样包装一些哈希创建。

```
Public Shared Function GenerateHash(ByVal FilePath As IO.FileInfo) As String
        If (FilePath Is Nothing) Then
            Throw New ArgumentNullException("FilePath")
        End If

        Dim _sha As New Security.Cryptography.MD5CryptoServiceProvider
        Dim _Hash = Convert.ToBase64String(_sha.ComputeHash(New IO.FileStream(FilePath.FullName, IO.FileMode.Open, IO.FileAccess.Read)))
        Return _Hash
    End Function 
```

如您所见，我只是将 IO.Fileinfo 作为参数，在函数开始时我正在检查以确保它不是什么都不是。

我想知道这是一种好的做法，还是应该让它到达实际的哈希器，然后抛出异常，因为它是空的。？

谢谢。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-13T22:39:00.627

一般来说，我建议在使用公共函数/方法之前验证所有参数是一种很好的做法，并且尽早失败而不是在执行一半函数之后失败。在这种情况下，抛出异常是正确的。

根据您的方法正在做什么，早期失败可能很重要。如果您的方法正在更改您的类上的实例数据，您不希望它更改一半的数据，然后遇到 null 并引发异常，因为您的对象的数据可能处于中间且可能无效的状态。

如果您使用的是 OO 语言，那么我建议验证公共方法的参数是必不可少的，但对于私有和受保护的方法则不太重要。我的理由是你不知道公共方法的输入是什么——任何其他代码都可以创建你的类的一个实例并调用它的公共方法，并传入意外/无效的数据。但是，私有方法是从类内部调用的，并且该类应该已经验证了内部传递的任何数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T22:40:38.737

我最喜欢的 C++ 技术之一是对 NULL 指针进行 DEBUG_ASSERT。这是高级程序员（以及 const 正确性）向我灌输的，这是我在代码审查期间最严格的事情之一。我们*从来没有*在没有首先断言它不为空的情况下取消引用一个指针。

调试断言仅对调试目标有效（它在发布中被剥离），因此您在生产中没有额外的开销来测试数千个 if。通常它会抛出异常或触发硬件断点。我们甚至有系统会抛出一个带有文件/行信息的调试控制台和一个忽略断言的选项（一次或无限期地用于会话）。这是一个非常棒的调试和 QA 工具（我们会在测试人员屏幕上获得带有断言的屏幕截图以及如果忽略程序是否继续的信息）。

我建议在代码中声明所有不变量，包括意外的空值。如果 if 的性能成为问题，请找到一种方法来有条件地编译并使它们在调试目标中保持活动状态。就像源代码控制一样，这种技术救了我的命比它给我带来的痛苦更多（这是任何开发技术中最重要的试金石）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T22:40:27.877

是的，最好在方法的开头验证所有参数并引发适当的异常，例如 ArgumentException、ArgumentNullException 或 ArgumentOutOfRangeException。

如果方法是私有的，只有你程序员可以传递无效的参数，那么你可以选择断言每个参数是有效的（Debug.Assert）而不是抛出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T22:33:21.167

如果 NULL 是不可接受的输入，则抛出异常。你自己，就像你在你的样本中所做的那样，所以这个信息是有帮助的。

处理 NULL 输入的另一种方法是依次响应 NULL。取决于函数的类型——在上面的例子中，我会保留异常。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T22:36:53.390

如果它用于面向外部的 API，那么我会说您要检查每个参数，因为输入不可信。

但是，如果它只是在内部使用，那么输入应该能够被信任，并且您可以为自己节省一堆不会为软件增加价值的代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-13T22:42:50.807

您应该根据您在该函数中对它们的值所做的一组假设检查所有参数。

就像在您的示例中一样，如果您的函数的 null 参数没有任何意义，并且您假设使用您的函数的任何人都会知道这一点，那么传递一个 null 参数会显示某种错误并采取某种措施（例如. 抛出异常）。而且，如果您使用断言（正如 James Fassett 进来并在我面前说的 ;-)），它们在发布版本中不会花费您任何费用。（它们在调试版本中也几乎没有花费你）

同样的事情适用于任何其他假设。

如果生成错误，跟踪错误会比将其留给某些标准库例程抛出异常更容易。您将能够提供更多有用的上下文信息。

它超出了这个问题的范围，但您确实需要公开您的函数所做的假设 - 例如，通过您的函数的注释标题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-14T00:15:46.187

根据*实用程序员*由 Andrew Hunt 和 David Thomas 撰写，调用者有责任确保它提供有效的输入。因此，您现在必须选择是否将空输入视为有效。除非将 null 视为有效输入具有特定意义（例如，如果您正在测试相等性，将 null 视为合法输入可能是个好主意），我会认为它无效。这样，您的程序在遇到错误输入时会更快失败。如果您的程序将遇到错误情况，您希望它尽快发生。如果您的函数无意中传递了一个空值，您应该将其视为一个错误，并做出相应的反应（即，您应该考虑使用杀死程序的断言，而不是抛出异常，直到您释放程序）。

经典契约设计：输入正确，输出正确。如果输入错误，则存在错误。（如果输入正确但输出错误，则存在错误。这是给我的。）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-14T02:31:47.113

我将根据布赖恩早些时候提供的合同建议为出色的设计添加一些详细说明（**粗体）......**

“按合同设计”的原则要求您定义调用者可以传入的内容（输入值的有效域），然后对于任何有效输入，方法/提供者将做什么。

对于内部方法，您可以将 NULL 定义为有效输入参数的域之外。在这种情况下，您将立即断言输入参数值不是 NULL。 **此合约规范的关键见解是，任何传入 NULL 值的调用都是*CALLER'S BUG*，断言语句抛出的错误是正确的行为。**

现在，虽然定义非常明确且简洁，但如果您将方法公开给外部/公共调用者，您应该问自己，这是我/我们真正想要的合同吗？可能不是。在公共接口中，您可能会接受 NULL（从技术上讲，在该方法接受的输入域中），但随后拒绝优雅地处理带有返回消息。（更多的工作来满足自然更复杂的面向客户的需求。）

在任何一种情况下，**您所追求的是一个从调用者和提供者的角度处理所有情况的协议，而不是大量的分散测试，这些测试会使评估合同的完整性或缺乏完整性变得困难条件覆盖。**

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-13T22:39:16.350

大多数时候，只要你确定异常不会被忽略，让它抛出异常是非常合理的。

但是，如果您可以向其中添加一些内容，那么将异常包装为更准确的异常并重新抛出它并没有什么坏处。解码“NullPointerException”将比“IllegalArgumentException（“必须提供文件路径”）”（或其他）花费更长的时间。

最近我一直在一个平台上工作，在这个平台上你必须在测试之前运行一个混淆器。每个堆栈跟踪看起来都像猴子在随机输入废话，所以我养成了一直检查我的参数的习惯。

我希望在变量和参数上看到“可为空”或“非空”修饰符，以便编译器可以为您检查。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-13T22:41:26.660

如果您正在编写公共 API，请帮助调用者帮助他们快速找到错误并检查有效输入。

如果您正在编写调用者（或调用者的调用者）可能不受信任的 API，请检查有效输入，因为它具有良好的安全性。

如果您的 API 只能由受信任的调用者访问，例如 C# 中的“内部”，那么不要觉得您必须编写所有额外的代码。它不会对任何人有用。

# xargs - 让 xargs 对每一行输入执行一次命令

> ID：199266
> 
> 赞同：421
> 
> 时间：2008-10-13T22:31:24.527
> 
> 标签：xargs

如何让 xargs 对给定的每一行输入只执行一次命令？它的默认行为是将行分块并执行一次命令，将多行传递给每个实例。

> 来自[http://en.wikipedia.org/wiki/Xargs](http://en.wikipedia.org/wiki/Xargs)：
> 
> 查找 /path -type f -print0 | xargs -0 rm
> 
> 在此示例中，find 为 xargs 的输入提供一长串文件名。然后 xargs 将此列表拆分为子列表，并为每个子列表调用一次 rm。这比这个功能等效的版本更有效：
> 
> 查找 /path -type f -exec rm '{}' \;

我知道 find 有“exec”标志。我只是从另一个资源中引用一个说明性的例子。

* * *

## 回答 #1

> 赞同：459
> 
> 时间：2008-10-13T22:32:42.510

仅当您的输入中没有空格时，以下内容才有效：

```
xargs -L 1
xargs --max-lines=1 # synonym for the -L option 
```

从手册页：

```
-L max-lines
          Use at most max-lines nonblank input lines per command line.
          Trailing blanks cause an input line to be logically continued  on
          the next input line.  Implies -x. 
```

* * *

## 回答 #2

> 赞同：275
> 
> 时间：2015-03-02T10:03:01.697

在我看来，此页面上的所有现有答案都是错误的，包括标记为正确的答案。这是因为问题措辞含糊不清。

**总结：**   如果你想*“每行输入只执行一次”命令，*将整行（不带换行符）作为*单个参数传递给命令，*那么这是最好的 UNIX 兼容方式：

```
... | tr '\n' '\0' | xargs -0 -n1 ... 
```

如果您使用 GNU`xargs`并且不需要与所有其他 UNIX（FreeBSD、Mac OS X 等）兼容，那么您可以使用 GNU-specific 选项`-d`：

```
... | xargs -d\\n -n1 ... 
```

现在进行冗长的解释……</p>

* * *

使用 xargs 时需要考虑两个问题：

1.  它如何将输入拆分为“参数”；和
2.  一次传递子命令的参数数量。

为了测试 xargs 的行为，我们需要一个实用程序来显示它被执行了多少次以及有多少个参数。我不知道是否有一个标准的实用程序可以做到这一点，但我们可以很容易地在 bash 中对其进行编码：

```
#!/bin/bash
echo -n "-> "; for a in "$@"; do echo -n "\"$a\" "; done; echo 
```

假设您将其保存为`show`当前目录并使其可执行，它的工作原理如下：

```
$ ./show one two 'three and four'
-> "one" "two" "three and four" 
```

现在，如果最初的问题真的是关于上面的第 2 点（我认为是这样，在阅读了几次之后）并且应该像这样阅读（更改为粗体）：

> *如何让 xargs 对给定的每个输入**参数**只执行一次命令？它的默认行为是将**输入分成参数并****尽可能少地**执行命令，将多个**参数**传递给每个实例。*

那么答案是`-n 1`。

让我们比较一下 xargs 的默认行为，它将输入拆分为空格并尽可能少地调用命令：

```
$ echo one two 'three and four' | xargs ./show 
-> "one" "two" "three" "and" "four" 
```

及其行为`-n 1`：

```
$ echo one two 'three and four' | xargs -n 1 ./show 
-> "one" 
-> "two" 
-> "three" 
-> "and" 
-> "four" 
```

另一方面，如果最初的问题是关于第 1 点的输入拆分，并且应该像这样阅读（许多来到这里的人似乎认为是这种情况，或者混淆了这两个问题）：

> *我怎样才能让 xargs为给定的每一行输入只**使用****一个参数来执行命令？**它的默认行为是将**空格周围**的行分块。*

那么答案就更微妙了。

有人会认为这`-L 1`可能会有所帮助，但事实证明它不会改变参数解析。它只为每个输入行执行一次命令，参数与该输入行上的参数一样多：

```
$ echo $'one\ntwo\nthree and four' | xargs -L 1 ./show 
-> "one" 
-> "two" 
-> "three" "and" "four" 
```

不仅如此，如果一行以空格结尾，它会附加到下一行：

```
$ echo $'one \ntwo\nthree and four' | xargs -L 1 ./show 
-> "one" "two" 
-> "three" "and" "four" 
```

显然，`-L`这不是要改变 xargs 将输入拆分为参数的方式。

以跨平台方式（不包括 GNU 扩展）这样做的唯一参数是`-0`，它将输入拆分为 NUL 字节。

然后，只需借助以下方法将换行符转换为 NUL 即可`tr`：

```
$ echo $'one \ntwo\nthree and four' | tr '\n' '\0' | xargs -0 ./show 
-> "one " "two" "three and four" 
```

现在参数解析看起来没问题，包括尾随空格。

最后，如果您将此技术与 结合使用，则`-n 1`无论您有什么输入，每个输入行都会执行一个命令，这可能是查看原始问题的另一种方式（可能是最直观的，给定标题）：

```
$ echo $'one \ntwo\nthree and four' | tr '\n' '\0' | xargs -0 -n1 ./show 
-> "one " 
-> "two" 
-> "three and four" 
```

如上所述，如果您使用的是 GNU ，则`xargs`可以将 替换`tr`为 GNU 特定的选项`-d`：

```
$ echo $'one \ntwo\nthree and four' | xargs -d\\n -n1 ./show 
-> "one " 
-> "two" 
-> "three and four" 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-13T22:50:22.007

如果您想为来自的*每一*行（即结果）运行命令`find`，那么您需要什么`xargs`？

尝试：

`find` *路径* `-type f -exec` *你的命令* `{} \;`

其中文字`{}`被文件名替换，并且`\;`需要文字`find`才能知道自定义命令在那里结束。

# 编辑：

（在编辑您的问题后澄清您所知道的`-exec`）

来自`man xargs`：

> **-L** *max-* lines 每个命令行最多
> 使用*max-lines 个非空白输入行。*尾随空白导致输入行在下一个输入行逻辑上继续。暗示-x。

请注意，如果您使用以空格结尾的文件名，则会给您带来麻烦`xargs`：

```
$ mkdir /tmp/bax; cd /tmp/bax
$ touch a\  b c\  c
$ find . -type f -print | xargs -L1 wc -l
0 ./c
0 ./c
0 total
0 ./b
wc: ./a: No such file or directory 
```

因此，如果您不关心该`-exec`选项，则最好使用`-print0`and `-0`：

```
$ find . -type f -print0 | xargs -0L1 wc -l
0 ./c
0 ./c
0 ./b
0 ./a 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2015-05-07T14:37:47.473

> 如何让 xargs 对给定的每一行输入只执行一次命令？

`-L 1`是一个简单的解决方案，但如果任何文件中包含空格，它就不起作用。这是 find`-print0`参数的一个关键功能——用 '\0' 字符而不是空格分隔参数。这是一个例子：

```
echo "file with space.txt" | xargs -L 1 ls
ls: file: No such file or directory
ls: with: No such file or directory
ls: space.txt: No such file or directory 
```

更好的解决方案是使用`tr`将换行符转换为 null ( `\0`) 字符，然后使用`xargs -0`参数。这是一个例子：

```
echo "file with space.txt" | tr '\n' '\0' | xargs -0 ls
file with space.txt 
```

如果您随后需要限制调用次数，您可以使用`-n 1`参数为每个输入调用一次程序：

```
echo "file with space.txt" | tr '\n' '\0' | xargs -0 -n 1 ls 
```

这还允许您在将中断转换为空值*之前过滤 find 的输出。*

```
find . -name \*.xml | grep -v /target/ | tr '\n' '\0' | xargs -0 tar -cf xml.tar 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2014-08-15T00:49:07.017

这两种方法也有效，并且适用于不使用 find 的其他命令！

```
xargs -I '{}' rm '{}'
xargs -i rm '{}' 
```

示例用例：

```
find . -name "*.pyc" | xargs -i rm '{}' 
```

即使 pyc 文件包含空格，也会删除该目录下的所有 pyc 文件。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-12-18T09:58:38.677

另一种选择...

```
find /path -type f | while read ln; do echo "processing $ln"; done 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-10-13T23:14:31.193

```
find path -type f | xargs -L1 command 
```

是你所需要的全部。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-06-04T05:23:25.623

以下命令将在其中找到所有文件（-type f）`/path`，然后将它们复制`cp`到当前文件夹。请注意使用 if`-I %`在命令行中指定占位符字符，`cp`以便可以将参数放在文件名之后。

`find /path -type f -print0 | xargs -0 -I % cp % .`

用 xargs (GNU findutils) 4.4.0 测试

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-13T22:40:29.687

您可以分别使用 --max-lines 或 --max-args 标志来限制行数或参数（如果每个参数之间有空格）。

> ```
>  -L max-lines
>          Use at most max-lines nonblank input lines per command line.  Trailing blanks cause an input line to be logically continued on the next  input
>          line.  Implies -x.
> 
>   --max-lines[=max-lines], -l[max-lines]
>          Synonym  for  the -L option.  Unlike -L, the max-lines argument is optional.  If max-args is not specified, it defaults to one.  The -l option
>          is deprecated since the POSIX standard specifies -L instead.
> 
>   --max-args=max-args, -n max-args
>          Use at most max-args arguments per command line.  Fewer than max-args arguments will be used if the size (see  the  -s  option)  is  exceeded,
>          unless the -x option is given, in which case xargs will exit. 
> ```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-12-13T04:25:16.727

@Draemon 的答案似乎与“-0”是正确的，即使文件中有空格也是如此。

我正在尝试 xargs 命令，我发现“-0”与“-L”完美配合。甚至空格也被处理（如果输入为空终止）。以下是一个例子：

```
#touch "file with space"
#touch "file1"
#touch "file2" 
```

以下将拆分空值并对列表中的每个参数执行命令：

```
 #find . -name 'file*' -print0 | xargs -0 -L1
./file with space
./file1
./file2 
```

如果与“-0”一起使用， so`-L1`将对每个以空字符结尾的字符执行参数。要查看差异，请尝试：

```
 #find . -name 'file*' -print0 | xargs -0 | xargs -L1
 ./file with space ./file1 ./file2 
```

即使这将执行一次：

```
 #find . -name 'file*' -print0  | xargs -0  | xargs -0 -L1
./file with space ./file1 ./file2 
```

该命令将执行一次，因为“-L”现在不会在空字节上拆分。您需要同时提供“-0”和“-L”才能工作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-03-05T21:42:09.850

似乎我没有足够的声誉来为[上面的 Tobia 的答案](https://stackoverflow.com/a/28806991/5844631)添加评论，所以我添加了这个“答案”来帮助我们这些想要`xargs`在 Windows 平台上尝试相同方式的人。

这是一个 Windows 批处理文件，它与 Tobia 的快速编码的“显示”脚本执行相同的操作：

```
@echo off
REM
REM  cool trick of using "set" to echo without new line
REM  (from:  http://www.psteiner.com/2012/05/windows-batch-echo-without-new-line.html)
REM
if "%~1" == "" (
    exit /b
)

<nul set /p=Args:  "%~1"
shift

:start
if not "%~1" == "" (
    <nul set /p=, "%~1"
    shift
    goto start
)
echo. 
```

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-10-13T22:49:16.563

在您的示例中，将 find 的输出通过管道传输到 xargs 的目的是 find 的 -exec 选项的标准行为是为每个找到的文件执行一次命令。如果您正在使用 find，并且您想要它的标准行为，那么答案很简单 - 不要使用 xargs 开始。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2010-04-15T14:38:59.160

在当前或子文件夹的每个 build.xml 上执行 ant task clean-all。

```
find . -name 'build.xml' -exec ant -f {} clean-all \; 
```

# deployment - 将工具和脚本部署到生产环境的最佳实践？

> ID：199277
> 
> 赞同：17
> 
> 时间：2008-10-13T22:33:42.603
> 
> 标签：deployment, release, lamp, release-management

我有许多在 Linux/PHP 网站的幕后运行的批处理过程。它们的数量和复杂性开始增长，所以我想对它们进行少量处理。

我的源代码树有一堆 cpp 文件和脚本，以开发而非部署为目的进行组织。编译完所有可执行文件后，我需要将各种脚本和二进制文件放在一组机器上。不同的机器的批处理需要不同的可执行文件、脚本和配置文件。我还编写了一些属于每台机器的工具。目前，此部署过程是手动的且容易出错。

我猜我最终会得到一个脚本，该脚本在源代码树的根部运行，并为任何机器所需的一切构建一个较小的树。然后，我将把它同步到适当的机器上。但我很好奇其他人是如何处理这类问题的。有任何想法吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-30T11:17:10.620

这里有几类工具。有些人使用这些类别的工具组合。例如，我有时会同时使用 Puppet 和 Capistrano。请参阅[Puppet 或 Capistrano - 为工作使用正确的工具进行](http://www.agileweboperations.com/puppet-or-capistrano-use-the-right-tool-for-the-job/)讨论。

**旨在部署应用程序的脚本工具：**

此类工具的一般模式是您创建一个脚本和/或配置文件，通常使用类似于 Makefile 的命令集，该工具将 ssh 到您的生产框，检查您的源代码，然后运行任何其他必要的步骤。

这方面的工具通常具有回滚到以前版本的功能。所以他们会检查你的源到releases/目录，如果一切顺利的话，创建一个从“current”到“releases/”的符号链接。如果有问题，您可以通过运行将删除“当前”并将其链接到以前的版本/目录的命令来恢复到以前的版本。

*   [Capistrano](http://capistranorb.com)来自 Rails 社区，但它是通用的。Capistrano 的用户可能对[deprec](http://deprec.org)感兴趣，这是一组 Capistrano 的部署方法。
*   [Vlad the Deployer](http://rubyhitsquad.com/Vlad_the_Deployer.html)是 Capistrano 的替代品，同样来自 Rails 社区。
*   编写自己的 shell 脚本或 Makefile。

将文件获取到生产箱的选项：

*   从源头直接结帐。如果您的产品缺少开发工具，特别是源代码管理工具，这并不总是可行的。
*   在本地签出源代码，然后将其 tar/zip 压缩。使用 scp 或 rsync 复制压缩包。这有时是 Amazon EC2 部署之类的首选，其中压缩的 tarball 可以节省时间/带宽。
*   在本地签出源，然后将其同步到生产箱。

**包装工具**

使用操作系统的打包系统生成包含应用程序文件的包。创建一个主包，该包具有您需要的其他包作为依赖项。RubyWorks系统就是一个[例子](http://studios.thoughtworks.com/rubyworks)，用于部署 Rails 堆栈和示例应用程序。然后是使用 apt、yum/rpm、Windows msi 或其他任何工具来部署给定版本的问题。回滚涉及卸载和重新安装旧版本。

**旨在安装应用程序/配置和维护一组系统的通用工具**

这些工具并不专门针对部署 Web 应用程序的问题，而是针对一组服务器或整个公司的工作站部署/维护应用程序/配置的更普遍的问题。它们更多地针对系统管理员而不是 Web 开发人员，尽管两者都可以发现它们很有用。

*   [Cfengine](http://www.cfengine.org/)就是这个类别中的一个工具。
*   [Puppet](http://puppetlabs.com/puppet/what-is-puppet)旨在改进 Cfengine。它有一个学习曲线，但许多人发现值得花时间弄清楚如何进行配置。一旦你开始工作，每个盒子都会定期检查中央服务器并确保一切都是最新的。如果有人编辑文件或更改权限，则会检测到并更正。因此，与上面的部署工具不同，Puppet 不仅将文件放在适合您的位置，而且确保它们保持原样。
*   [Chef](https://www.chef.io/chef/)比 Puppet 小一些，采用了类似的方法。
*   [Smartfrog](http://smartfrog.org/)是该类别中的另一个工具。
*   [Ansible](http://www.ansible.com/home)使用纯 YAML 文件，不需要在它管理的服务器上运行代理

有关此类工具和更多工具的比较，请参阅 Wikipedia 文章，[开源配置管理软件的比较](http://en.wikipedia.org/wiki/Comparison_of_open_source_configuration_management_software)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-15T16:45:25.813

查看[cfengine 教程](http://www.cfengine.org/docs/cfengine-Tutorial.html)，看看 cfengine 是否适合您的情况。对于一个小型网站来说，这可能有点过于复杂，但如果将来它涉及更多的计算机和更多的配置，那么在某些时候你最终会使用 cfengine 或类似的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T22:51:31.070

以您的发行版使用的格式创建您自己的软件包，例如 Debian 软件包 (.deb)。这些可以复制到每台机器并手动安装，或者您可以设置自己的存储库，并将其添加到源列表中。

你的包应该被设置，以便它们包含的脚本参考配置文件，该配置文件在每个主机上都不同，具体取决于每个主机上需要运行的脚本。

要将它们结合在一起，您可以创建一个仅依赖于您创建的其他每个包的元包。这样，当您设置新服务器时，您安装了一个元包，而其他包作为依赖项引入。

虽然这个过程听起来有点复杂，但如果你有很多脚本和很多主机要部署它们，从长远来看，它真的可以得到回报。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T13:22:12.340

[Puppet](http://reductivelabs.com/trac/puppet)是可以在这种情况下使用的另一种工具。它类似于 cfengine - 您创建所需部署的模型，然后 Puppet 计算如何使环境进入此状态。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T23:13:03.990

我必须经常向几个客户推出 PHP 脚本和 Apache 配置。由于他们都运行 Debian Linux，我已经在我的服务器上建立了一个 Debian 软件包存储库，客户所要做的就是输入**apt-get upgrade**并获得最新版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T18:31:13.700

要做的第一件事是将所有这些脚本放入源代码控制存储库（svn 或 git 都很好），以便您可以跟踪这些脚本随时间的变化。

如果您对 ruby​​ 感兴趣，请查看[Capistrano](http://www.capify.org/)，它非常适合将东西部署到集群中的多台机器上，而且设置起来相当容易。它可以直接从您的版本控制系统中读取文件。

# .net - .NET 中的高级控制台 IO

> ID：199321
> 
> 赞同：19
> 
> 时间：2008-10-13T22:47:54.227
> 
> 标签：.net, console

在屏幕上的任意位置并使用自定义前/背景颜色将数据写入文本控制台的最佳方法是什么？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-13T22:58:27.780

Console.SetCursorPosition、Console.BackgroundColor、Console.ForegroundColor 和 Console.ResetColor。

请注意，这些是在 2.0 版中添加到 .NET Framework 中的。在此之前，您需要 PInvoke。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-13T23:04:28.937

在用 C#编写基于[TUI](https://en.wikipedia.org/wiki/Text-based_user_interface)的应用程序时，有几个库会很有帮助：

*   [Gui.cs](https://github.com/migueldeicaza/gui.cs)是 Miguel de Icaza 的 .NET 终端 UI 工具包。这是一个用于 .NET、.NET Core 和 Mono 的简单 UI 工具包，适用于 Windows 和 Linux/Unix。
*   [MonoCurses](https://github.com/mono/mono-curses/)是一个 MIT-X11 许可的 curses 绑定，它包括用于创建基于控制台的应用程序的简约 gui.cs GUI 工具包。
*   [ConsoleGUI](https://github.com/TomaszRewak/C-sharp-console-gui-framework)是一个简单的布局驱动库，用于创建基于控制台的 GUI 应用程序。它提供了最重要的布局管理实用程序以及一组基本控件。
*   [CursesSharp](https://github.com/sushihangover/CursesSharp)是 curses 库的 C# 包装器。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-13T23:39:07.477

[这篇文章](http://www.nullify.net/ViewArticle.aspx?article=269)展示了如何使用控制台类方法在控制台上创建一个进度条——它可能是一个很好的例子，可以参考......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-02-27T10:07:13.670

最有效的功能是`WriteConsoleOutput`。它是本机 win32 API，但可以使用 p/invoke 在 .NET 应用程序中使用：

```
[DllImport("kernel32.dll", SetLastError = true, EntryPoint = "WriteConsoleOutputW")]
public static extern bool WriteConsoleOutput(IntPtr hConsoleOutput, CHAR_INFO[,] lpBuffer, COORD dwBufferSize,
                                                 COORD dwBufferCoord, ref SMALL_RECT lpWriteRegion); 
```

其中 CHAR_INFO 是一个结构：

```
/// <summary>
/// CharSet.Unicode is required for proper marshaling.
/// </summary>
[StructLayout(LayoutKind.Explicit, CharSet = CharSet.Unicode)]
public struct CHAR_INFO
{
    [FieldOffset(0)]
    public char UnicodeChar;
    [FieldOffset(0)]
    public char AsciiChar;
    [FieldOffset(2)] //2 bytes seems to work properly
    public Attr Attributes;

    public override string ToString() {
        return string.Format("CHAR_INFO : '{0}' ({1})", AsciiChar, Attributes);
    }
} 
```

属性结构：

```
/// <summary>
/// CHAR_ATTRIBUTES native structure.
/// </summary>
[Flags]
public enum Attr : ushort {
    NO_ATTRIBUTES = 0x0000,
    /// <summary>
    /// Text color contains blue.
    /// </summary>
    FOREGROUND_BLUE = 0x0001,
    /// <summary>
    /// Text color contains green.
    /// </summary>
    FOREGROUND_GREEN = 0x0002,
    /// <summary>
    /// Text color contains red.
    /// </summary>
    FOREGROUND_RED = 0x0004,
    /// <summary>
    /// Text color is intensified.
    /// </summary>
    FOREGROUND_INTENSITY = 0x0008,
    /// <summary>
    /// Background color contains blue.
    /// </summary>
    BACKGROUND_BLUE = 0x0010,
    /// <summary>
    /// Background color contains green.
    /// </summary>
    BACKGROUND_GREEN = 0x0020,
    /// <summary>
    /// Background color contains red.
    /// </summary>
    BACKGROUND_RED = 0x0040,
    /// <summary>
    /// Background color is intensified.
    /// </summary>
    BACKGROUND_INTENSITY = 0x0080,
    /// <summary>
    /// Leading byte.
    /// </summary>
    COMMON_LVB_LEADING_BYTE = 0x0100,
    /// <summary>
    /// Trailing byte.
    /// </summary>
    COMMON_LVB_TRAILING_BYTE = 0x0200,
    /// <summary>
    /// Top horizontal
    /// </summary>
    COMMON_LVB_GRID_HORIZONTAL = 0x0400,
    /// <summary>
    /// Left vertical.
    /// </summary>
    COMMON_LVB_GRID_LVERTICAL = 0x0800,
    /// <summary>
    /// Right vertical.
    /// </summary>
    COMMON_LVB_GRID_RVERTICAL = 0x1000,
    /// <summary>
    /// Reverse foreground and background attribute.
    /// </summary>
    COMMON_LVB_REVERSE_VIDEO = 0x4000,
    /// <summary>
    /// Underscore.
    /// </summary>
    COMMON_LVB_UNDERSCORE = 0x8000
} 
```

COORD 和 SMALL_RECT：

```
[StructLayout(LayoutKind.Sequential)]
public struct COORD
{
    public short X;
    public short Y;

    public COORD(short X, short Y)
    {
        this.X = X;
        this.Y = Y;
    }
};

[StructLayout(LayoutKind.Sequential)]
public struct SMALL_RECT
{
    public short Left;
    public short Top;
    public short Right;
    public short Bottom;

    public SMALL_RECT(short left, short top, short right, short bottom) {
        Left = left;
        Top = top;
        Right = right;
        Bottom = bottom;
    }
} 
```

# c++ - 如何检测无符号整数乘法溢出？

> ID：199333
> 
> 赞同：696
> 
> 时间：2008-10-13T22:53:21.407
> 
> 标签：c++, c, integer-overflow

我正在用 C++ 编写一个程序来查找*a* ^(*b*) = *c*的所有解决方案，其中*a*、*b*和*c*一起使用所有数字 0-9 一次。该程序循环遍历*a*和*b*的值，并且每次在*a*、*b*和*a ^b*上运行一个数字计数例程，以检查是否满足数字条件。

*但是，当a* ^(*b*)超出整数限制时，可能会生成虚假解。我最终使用以下代码检查了这一点：

```
unsigned long b, c, c_test;
...
c_test=c*b;         // Possible overflow
if (c_test/b != c) {/* There has been an overflow*/}
else c=c_test;      // No overflow 
```

有没有更好的方法来测试溢出？我知道有些芯片有一个在发生溢出时设置的内部标志，但我从未见过通过 C 或 C++ 访问它。

* * *

请注意，***签名* `int`溢出是 C 和 C++ 中未定义的行为**，因此您必须检测它而不实际导致它。对于加法前的有符号整数溢出，请参阅*[在 C/C++ 中检测有符号溢出](https://stackoverflow.com/questions/3944505/detecting-signed-overflow-in-c-c)*。

* * *

## 回答 #1

> 赞同：275
> 
> 时间：2009-10-03T17:15:16.160

我看到您使用的是无符号整数。根据定义，**在 C 中**（我不了解 C++），无符号算术不会溢出......所以，至少对于 C，你的观点没有实际意义：）

对于有符号整数，一旦发生溢出，就会发生[未定义行为](http://en.wikipedia.org/wiki/Undefined_behavior)(UB)，您的程序可以做任何事情（例如：渲染测试不确定）。 

```
#include <limits.h>

int a = <something>;
int x = <something>;
a += x;              /* UB */
if (a < 0) {         /* Unreliable test */
  /* ... */
} 
```

要创建符合标准的程序，您需要在生成所述溢出**之前测试溢出。**该方法也可以用于无符号整数：

```
// For addition
#include <limits.h>

int a = <something>;
int x = <something>;
if ((x > 0) && (a > INT_MAX - x)) /* `a + x` would overflow */;
if ((x < 0) && (a < INT_MIN - x)) /* `a + x` would underflow */; 
```

* * *

```
// For subtraction
#include <limits.h>
int a = <something>;
int x = <something>;
if ((x < 0) && (a > INT_MAX + x)) /* `a - x` would overflow */;
if ((x > 0) && (a < INT_MIN + x)) /* `a - x` would underflow */; 
```

* * *

```
// For multiplication
#include <limits.h>

int a = <something>;
int x = <something>;
// There may be a need to check for -1 for two's complement machines.
// If one number is -1 and another is INT_MIN, multiplying them we get abs(INT_MIN) which is 1 higher than INT_MAX
if ((a == -1) && (x == INT_MIN)) /* `a * x` can overflow */
if ((x == -1) && (a == INT_MIN)) /* `a * x` (or `a / x`) can overflow */
// general case
if (a > INT_MAX / x) /* `a * x` would overflow */;
if ((a < INT_MIN / x)) /* `a * x` would underflow */; 
```

* * *

对于除法（除了`INT_MIN`和`-1`特殊情况），没有任何可能超过`INT_MIN`or `INT_MAX`。

* * *

## 回答 #2

> 赞同：193
> 
> 时间：2014-01-06T18:28:39.687

Starting with C23, the standard header `<stdckdint.h>` provides the following three function-like macros:

```
bool ckd_add(type1 *result, type2 a, type3 b);
bool ckd_sub(type1 *result, type2 a, type3 b);
bool ckd_mul(type1 *result, type2 a, type3 b); 
```

where `type1`, `type2` and `type3` are any integer type. These functions respectively add, subtract or multiply a and b with arbitrary precision and store the result in `*result`. If the result cannot be represented exactly by `type1`, the function returns `true` ("calculation has overflowed"). (Arbitrary precision is an illusion; the calculations are very fast and almost all hardware available since the early 1990s can do it in just one or two instructions.)

Rewriting OP's example:

```
unsigned long b, c, c_test;
// ...
if (ckd_mul(&c_test, c, b))
{
    // returned non-zero: there has been an overflow
}
else
{
    c = c_test; // returned 0: no overflow
} 
```

c_test contains the potentially-overflowed result of the multiplication in all cases.

Long before C23, [GCC 5+](https://gcc.gnu.org/gcc-5/changes.html#c-family) and Clang 3.8+ offer built-ins that work the same way, except that the result pointer is passed last instead of first: `__builtin_add_overflow`, `__builtin_sub_overflow` and `__builtin_mul_overflow`. These also work on types smaller than `int`.

```
unsigned long b, c, c_test;
// ...
if (__builtin_mul_overflow(c, b, &c_test))
{
    // returned non-zero: there has been an overflow
}
else
{
    c = c_test; // returned 0: no overflow
} 
```

[Clang 3.4+](http://clang.llvm.org/docs/LanguageExtensions.html#checked-arithmetic-builtins) introduced arithmetic-overflow builtins with fixed types, but they are much less flexible and Clang 3.8 has been available for a long time now. Look for `__builtin_umull_overflow` if you need to use this despite the more convenient newer alternative.

[Visual Studio](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio)'s cl.exe doesn't have direct equivalents. For unsigned additions and subtractions, including `<intrin.h>` will allow you to use `addcarry_uNN` and `subborrow_uNN` (where NN is the number of bits, like `addcarry_u8` or `subborrow_u64`). Their signature is a bit obtuse:

```
unsigned char _addcarry_u32(unsigned char c_in, unsigned int src1, unsigned int src2, unsigned int *sum);
unsigned char _subborrow_u32(unsigned char b_in, unsigned int src1, unsigned int src2, unsigned int *diff); 
```

`c_in`/`b_in` is the carry/borrow flag on input, and the return value is the carry/borrow on output. It does not appear to have equivalents for signed operations or multiplications.

Otherwise, Clang for Windows is now production-ready (good enough for Chrome), so that could be an option, too.

* * *

## 回答 #3

> 赞同：167
> 
> 时间：2008-10-13T23:44:49.590

有*一种*方法可以确定操作是否可能溢出，使用操作数中最高有效位的位置和一些基本的二进制数学知识。

此外，任何两个操作数将导致（最多）比最大操作数的最高一位多一位。例如：

```
bool addition_is_safe(uint32_t a, uint32_t b) {
    size_t a_bits=highestOneBitPosition(a), b_bits=highestOneBitPosition(b);
    return (a_bits<32 && b_bits<32);
} 
```

对于乘法，任何两个操作数将导致（最多）操作数位的总和。例如：

```
bool multiplication_is_safe(uint32_t a, uint32_t b) {
    size_t a_bits=highestOneBitPosition(a), b_bits=highestOneBitPosition(b);
    return (a_bits+b_bits<=32);
} 
```

同样，您可以估计结果的最大大小，`a`如下`b`所示：

```
bool exponentiation_is_safe(uint32_t a, uint32_t b) {
    size_t a_bits=highestOneBitPosition(a);
    return (a_bits*b<=32);
} 
```

（当然，用位数替换您的目标整数。）

我不确定确定数字中最高一位位置的最快方法，这是一种蛮力方法：

```
size_t highestOneBitPosition(uint32_t a) {
    size_t bits=0;
    while (a!=0) {
        ++bits;
        a>>=1;
    };
    return bits;
} 
```

这并不完美，但这会让您很好地了解在您执行操作之前是否有任何两个数字可能溢出。由于函数中的循环，我不知道它是否比简单地按照您建议的方式检查结果更快`highestOneBitPosition`，但它可能（特别是如果您事先知道操作数中有多少位）。

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2008-10-13T23:02:46.117

一些编译器提供对 CPU 中整数溢出标志的访问，然后您可以对其进行测试，但这不是标准的。

您还可以在执行乘法之前测试溢出的可能性：

```
if ( b > ULONG_MAX / a ) // a * b would overflow 
```

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2011-07-25T21:40:17.537

警告：GCC 可以在使用`-O2`. 在某些情况下，该选项`-Wall`会给您一个警告，例如

```
if (a + b < a) { /* Deal with overflow */ } 
```

但不是在这个例子中：

```
b = abs(a);
if (b < 0) { /* Deal with overflow */ } 
```

唯一安全的方法是在溢出发生之前检查溢出，如[CERT 论文](https://www.securecoding.cert.org/confluence/display/seccode/INT32-C.+Ensure+that+operations+on+signed+integers+do+not+result+in+overflow?showComments=false)中所述，系统地使用这将非常乏味。

编译`-fwrapv`解决了这个问题，但禁用了一些优化。

我们迫切需要一个更好的解决方案。我认为编译器在进行不依赖于溢出的优化时应该默认发出警告。目前的情况允许编译器优化溢出检查，这在我看来是不可接受的。

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2013-01-28T17:51:30.800

Clang 现在支持有符号和无符号整数的动态溢出检查。请参阅[-fsanitize=integer](http://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html#availablle-checks)开关。目前，它是唯一一个完全支持用于调试目的的动态溢出检查的 C++ 编译器。

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2013-03-11T01:57:31.330

我看到很多人回答了关于溢出的问题，但我想解决他原来的问题。他说问题是要找到 a ^b =c 使得所有数字都被使用而不重复。好吧，这不是他在这篇文章中问的，但我仍然认为有必要研究问题的上限并得出结论，他永远不需要计算或检测溢出（注意：我不精通在数学中，所以我一步一步地做了这个，但最终的结果是如此简单，以至于这可能有一个简单的公式）。

要点是问题要求 a、b 或 c 的上限是 98.765.432。无论如何，首先将问题分为琐碎和非琐碎部分：

*   x ⁰ == 1（9、8、7、6、5、4、3、2的所有排列都是解）
*   x ¹ == x（没有解决办法）
*   0 ^b == 0（不可能有解决方案）
*   1 ^b == 1（无解）
*   a ^b , a > 1, b > 1 （非平凡的）

现在我们只需要证明没有其他解决方案是可能的，只有排列是有效的（然后打印它们的代码很简单）。我们回到上限。实际上上限是 c ≤ 98.765.432。它是上限，因为它是 8 位数字中的最大数字（a 和 b 共 10 位数字减 1）。这个上限仅适用于 c，因为 a 和 b 的边界必须低得多，因为我们可以计算出指数增长，将 b 从 2 变为上限：

```
 9938.08^2 == 98765432
    462.241^3 == 98765432
    99.6899^4 == 98765432
    39.7119^5 == 98765432
    21.4998^6 == 98765432
    13.8703^7 == 98765432
    9.98448^8 == 98765432
    7.73196^9 == 98765432
    6.30174^10 == 98765432
    5.33068^11 == 98765432
    4.63679^12 == 98765432
    4.12069^13 == 98765432
    3.72429^14 == 98765432
    3.41172^15 == 98765432
    3.15982^16 == 98765432
    2.95305^17 == 98765432
    2.78064^18 == 98765432
    2.63493^19 == 98765432
    2.51033^20 == 98765432
    2.40268^21 == 98765432
    2.30883^22 == 98765432
    2.22634^23 == 98765432
    2.15332^24 == 98765432
    2.08826^25 == 98765432
    2.02995^26 == 98765432
    1.97741^27 == 98765432 
```

请注意，例如最后一行：它表示 1.97^27 ~98M。因此，例如， 1^27 == 1 和 2^27 == 134.217.728 这不是一个解决方案，因为它有 9 位数字（2 > 1.97 所以它实际上比应该测试的要大）。可以看出，可用于测试 a 和 b 的组合非常小。对于 b == 14，我们需要尝试 2 和 3。对于 b == 3，我们从 2 开始，在 462 停止。所有结果都被授予小于 ~98M。

现在只需测试上面的所有组合并寻找不重复任何数字的组合：

```
 ['0', '2', '4', '5', '6', '7', '8'] 84^2 = 7056
    ['1', '2', '3', '4', '5', '8', '9'] 59^2 = 3481
    ['0', '1', '2', '3', '4', '5', '8', '9'] 59^2 = 3481 (+leading zero)
    ['1', '2', '3', '5', '8'] 8^3 = 512
    ['0', '1', '2', '3', '5', '8'] 8^3 = 512 (+leading zero)
    ['1', '2', '4', '6'] 4^2 = 16
    ['0', '1', '2', '4', '6'] 4^2 = 16 (+leading zero)
    ['1', '2', '4', '6'] 2^4 = 16
    ['0', '1', '2', '4', '6'] 2^4 = 16 (+leading zero)
    ['1', '2', '8', '9'] 9^2 = 81
    ['0', '1', '2', '8', '9'] 9^2 = 81 (+leading zero)
    ['1', '3', '4', '8'] 3^4 = 81
    ['0', '1', '3', '4', '8'] 3^4 = 81 (+leading zero)
    ['2', '3', '6', '7', '9'] 3^6 = 729
    ['0', '2', '3', '6', '7', '9'] 3^6 = 729 (+leading zero)
    ['2', '3', '8'] 2^3 = 8
    ['0', '2', '3', '8'] 2^3 = 8 (+leading zero)
    ['2', '3', '9'] 3^2 = 9
    ['0', '2', '3', '9'] 3^2 = 9 (+leading zero)
    ['2', '4', '6', '8'] 8^2 = 64
    ['0', '2', '4', '6', '8'] 8^2 = 64 (+leading zero)
    ['2', '4', '7', '9'] 7^2 = 49
    ['0', '2', '4', '7', '9'] 7^2 = 49 (+leading zero) 
```

它们都不符合问题（也可以通过缺少'0'，'1'，...，'9'来看出）。

解决它的示例代码如下。另请注意，它是用 Python 编写的，不是因为它需要任意精度的整数（代码不会计算大于 9800 万的任何东西），而是因为我们发现测试的数量太少了，我们应该使用高级语言来利用其内置的容器和库（另请注意：代码有 28 行）。

```
 import math

    m = 98765432
    l = []
    for i in xrange(2, 98765432):
        inv = 1.0/i
        r = m**inv
        if (r < 2.0): break
        top = int(math.floor(r))
        assert(top <= m)

        for j in xrange(2, top+1):
            s = str(i) + str(j) + str(j**i)
            l.append((sorted(s), i, j, j**i))
            assert(j**i <= m)

    l.sort()
    for s, i, j, ji in l:
        assert(ji <= m)
        ss = sorted(set(s))
        if s == ss:
            print '%s %d^%d = %d' % (s, i, j, ji)

        # Try with non significant zero somewhere
        s = ['0'] + s
        ss = sorted(set(s))
        if s == ss:
            print '%s %d^%d = %d (+leading zero)' % (s, i, j, ji) 
```

* * *

## 回答 #8

> 赞同：25
> 
> 时间：2011-06-24T19:44:22.500

这是一种非常快速的方法来检测至少加法的溢出，这可能会导致乘法、除法和幂运算。

这个想法正是因为处理器只会让值回零，并且 C/C++ 是从任何特定处理器抽象出来的，所以您可以：

```
uint32_t x, y;
uint32_t value = x + y;
bool overflow = value < (x | y); 
```

这既确保了如果一个操作数为零而一个不是，则不会错误地检测到溢出，并且比之前建议的许多 NOT/XOR/AND/test 操作要快得多。

正如所指出的，这种方法虽然比其他更复杂的方法更好，但仍然是可优化的。以下是包含优化的原始代码的修订版：

```
uint32_t x, y;
uint32_t value = x + y;
const bool overflow = value < x; // Alternatively "value < y" should also work 
```

检测乘法溢出的一种更有效、更便宜的方法是：

```
uint32_t x, y;
const uint32_t a = (x >> 16U) * (y & 0xFFFFU);
const uint32_t b = (x & 0xFFFFU) * (y >> 16U);
const bool overflow = ((x >> 16U) * (y >> 16U)) +
    (a >> 16U) + (b >> 16U);
uint32_t value = overflow ? UINT32_MAX : x * y; 
```

这会导致 UINT32_MAX 溢出或乘法结果。*在这种情况下，允许对有符号整数进行乘法运算是严格未定义的行为。*

值得注意的是，这使用部分 Karatsuba 方法乘法分解来计算 64 位乘法的高 32 位，以检查是否应设置其中任何一个以了解 32 位乘法是否溢出。

如果使用 C++，你可以把它变成一个简洁的小 lambda 来计算溢出，这样检测器的内部工作就被隐藏了：

```
uint32_t x, y;
const bool overflow
{
    [](const uint32_t x, const uint32_t y) noexcept -> bool
    {
        const uint32_t a{(x >> 16U) * uint16_t(y)};
        const uint32_t b{uint16_t(x) * (y >> 16U)};
        return ((x >> 16U) * (y >> 16U)) + (a >> 16U) + (b >> 16U);
    }(x, y)
};
uint32_t value{overflow ? UINT32_MAX : x * y}; 
```

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2012-12-07T13:48:39.527

这是该问题的“非便携式”解决方案。Intel x86 和 x64 CPU 具有所谓的[EFLAGS-register](http://en.wikipedia.org/wiki/EFLAGS)，在每次整数算术运算后由处理器填充。我将在这里跳过详细描述。相关标志是“溢出”标志（掩码 0x800）和“进位”标志（掩码 0x1）。为了正确解释它们，应该考虑操作数是有符号还是无符号类型。

这是从 C/C++ 检查标志的实用方法。以下代码适用于[Visual Studio 2005](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2005)或更新版本（32 位和 64 位）以及 GNU C/C++ 64 位。

```
#include <cstddef>
#if defined( _MSC_VER )
#include <intrin.h>
#endif

inline size_t query_intel_x86_eflags(const size_t query_bit_mask)
{
    #if defined( _MSC_VER )

        return __readeflags() & query_bit_mask;

    #elif defined( __GNUC__ )
        // This code will work only on 64-bit GNU-C machines.
        // Tested and does NOT work with Intel C++ 10.1!
        size_t eflags;
        __asm__ __volatile__(
            "pushfq \n\t"
            "pop %%rax\n\t"
            "movq %%rax, %0\n\t"
            :"=r"(eflags)
            :
            :"%rax"
            );
        return eflags & query_bit_mask;

    #else

        #pragma message("No inline assembly will work with this compiler!")
            return 0;
    #endif
}

int main(int argc, char **argv)
{
    int x = 1000000000;
    int y = 20000;
    int z = x * y;
    int f = query_intel_x86_eflags(0x801);
    printf("%X\n", f);
} 
```

如果操作数相乘而没有溢出，您将得到 0 的返回值`query_intel_eflags(0x801)`，即既没有设置进位也没有设置溢出标志。在提供的 main() 示例代码中，发生了溢出并且两个标志都设置为 1。这个检查并不意味着任何进一步的计算，所以它应该很快。

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2008-10-14T01:05:15.293

如果您的数据类型大于您要测试的数据类型（假设您执行 32 位加法并且您有 64 位类型），那么这将检测是否发生溢出。我的示例是 8 位加法。但它可以按比例放大。

```
uint8_t x, y;    /* Give these values */
const uint16_t data16    = x + y;
const bool carry        = (data16 > 0xFF);
const bool overflow     = ((~(x ^ y)) & (x ^ data16) & 0x80); 
```

它基于此页面上解释的概念：[http ://www.cs.umd.edu/class/spring2003/cmsc311/Notes/Comb/overflow.html](http://www.cs.umd.edu/class/spring2003/cmsc311/Notes/Comb/overflow.html)

对于 32 位示例，`0xFF`变为`0xFFFFFFFF`并`0x80`变为`0x80000000`并最终`uint16_t`变为`uint64_t`.

**注意**：这会捕获整数加法/减法溢出，我意识到您的问题涉及乘法。在这种情况下，分工可能是最好的方法。这通常是`calloc`实现确保参数在乘以得到最终大小时不会溢出的一种方式。

* * *

## 回答 #11

> 赞同：18
> 
> 时间：2008-10-13T22:59:20.337

最简单的方法是将您`unsigned long`的 s转换为`unsigned long long`s，进行乘法运算，并将结果与​​ 0x100000000LL 进行比较。

您可能会发现这比您在示例中所做的除法更有效。

哦，它可以在 C 和 C++ 中工作（因为你已经用两者标记了这个问题）。

* * *

刚刚看了一下[glibc手册](http://www.gnu.org/software/libc/manual/html_node/Program-Error-Signals.html#Program%20Error%20Signals)。提到了整数溢出陷阱 ( `FPE_INTOVF_TRAP`) 作为`SIGFPE`. 这将是理想的，除了手册中令人讨厌的部分：

> `FPE_INTOVF_TRAP` 整数溢出（在 C 程序中不可能，除非您以特定于硬件的方式启用溢出捕获）。

真的有点可惜。

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2008-10-13T22:59:37.947

您无法从 C/C++ 访问溢出标志。

一些编译器允许您在代码中插入陷阱指令。在 GCC 上，选项是`-ftrapv`.

您可以做的唯一可移植且独立于编译器的事情是自己检查溢出。就像您在示例中所做的那样。

但是，`-ftrapv`使用最新的 GCC 在 x86 上似乎什么也没做。我想这是旧版本的遗留物或特定于其他架构的。我曾期望编译器在每次添加后插入一个 INTO 操作码。不幸的是，它没有这样做。

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2009-02-09T14:06:39.337

对于无符号整数，只需检查结果是否小于参数之一：

```
unsigned int r, a, b;
r = a + b;
if (r < a)
{
    // Overflow
} 
```

对于有符号整数，您可以检查参数和结果的符号。

不同符号的整数不能溢出，只有当结果是不同符号时，相同符号的整数才会溢出：

```
signed int r, a, b, s;
r = a + b;
s = a>=0;
if (s == (b>=0) && s != (r>=0))
{
    // Overflow
} 
```

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2012-05-21T14:53:50.043

我需要为浮点数回答同样的问题，其中位掩码和移位看起来没有希望。我选择的方法适用于有符号和无符号、整数和浮点数。即使没有更大的数据类型可用于中间计算，它也可以工作。对于所有这些类型，它并不是最有效的，但因为它对所有类型都有效，所以值得使用。

有符号溢出测试，加法和减法：

1.  获取表示类型 MAXVALUE 和 MINVALUE 的最大和最小可能值的常量。

2.  计算并比较操作数的符号。

    一个。如果任一值为零，则加法和减法都不会溢出。跳过剩余的测试。

    湾。如果符号相反，则加法不会溢出。跳过剩余的测试。

    C。如果符号相同，则减法不会溢出。跳过剩余的测试。

3.  测试 MAXVALUE 的正溢出。

    一个。如果两个符号均为正且 MAXVALUE - A < B，则加法将溢出。

    湾。如果 B 的符号为负且 MAXVALUE - A < -B，则减法将溢出。

4.  测试 MINVALUE 的负溢出。

    一个。如果两个符号都是负数且 MINVALUE - A > B，则加法将溢出。

    湾。如果 A 的符号为负且 MINVALUE - A > B，则减法将溢出。

5.  否则，不会溢出。

有符号溢出测试，乘法和除法：

1.  获取表示类型 MAXVALUE 和 MINVALUE 的最大和最小可能值的常量。

2.  计算操作数的大小（绝对值）并将其与 1 进行比较。（下面，假设 A 和 B 是这些量级，而不是签名的原件。）

    一个。如果任一值为零，则乘法不会溢出，除法将产生零或无穷大。

    湾。如果任一值为 1，则乘法和除法不会溢出。

    C。如果一个操作数的大小小于 1，而另一个操作数大于 1，则乘法不会溢出。

    d。如果幅度都小于 1，则除法不会溢出。

3.  测试 MAXVALUE 的正溢出。

    一个。如果两个操作数都大于 1 并且 MAXVALUE / A < B，则乘法将溢出。

    湾。如果 B 小于 1 并且 MAXVALUE * B < A，则除法将溢出。

4.  否则，不会溢出。

注意：MINVALUE 的最小溢出由 3 处理，因为我们取的是绝对值。但是，如果 ABS(MINVALUE) > MAXVALUE，那么我们会遇到一些罕见的误报。

下溢测试类似，但涉及 EPSILON（大于零的最小正数）。

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2012-10-04T12:08:10.140

另一个有趣的工具是*[IOC: An Integer Overflow Checker for C/C++](http://embed.cs.utah.edu/ioc/)*。

这是一个修补的[Clang](http://en.wikipedia.org/wiki/Clang)编译器，它在编译时对代码添加检查。

您会得到如下所示的输出：

```
CLANG ARITHMETIC UNDEFINED at <add.c, (9:11)> :
Op: +, Reason : Signed Addition Overflow,
BINARY OPERATION: left (int32): 2147483647 right (int32): 1 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2009-10-03T16:46:47.840

CERT 开发了一种使用“as-if”无限范围 (AIR) 整数模型检测和报告有符号整数溢出、无符号整数换行和整数截断的新方法。CERT 发布了一份描述该模型的[技术报告](http://www.sei.cmu.edu/library/abstracts/reports/09tn023.cfm)，并制作了基于 GCC 4.4.0 和 GCC 4.5.0 的工作原型。

AIR 整数模型要么生成一个与使用无限范围整数获得的值相等的值，要么导致违反运行时约束。与以前的整数模型不同，AIR 整数不需要精确的陷阱，因此不会破坏或抑制大多数现有优化。

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2014-01-10T17:15:46.977

使用汇编语言的解决方案的另一种变体是外部过程。此示例用于在 Linux x64 下使用 g++ 和 fasm 进行无符号整数乘法。

此过程将两个无符号整数参数（32 位）相乘（根据 amd64 的[规范](http://www.x86-64.org/documentation/)（第*3.2.3 节参数传递*）。

> 如果类是 INTEGER，则使用序列 %rdi、%rsi、%rdx、%rcx、%r8 和 %r9 的下一个可用寄存器

（我的代码中的 edi 和 esi 寄存器））并返回结果，如果发生溢出则返回 0。

```
format ELF64

section '.text' executable

public u_mul

u_mul:
  MOV eax, edi
  mul esi
  jnc u_mul_ret
  xor eax, eax
u_mul_ret:
ret 
```

测试：

```
extern "C" unsigned int u_mul(const unsigned int a, const unsigned int b);

int main() {
    printf("%u\n", u_mul(4000000000,2)); // 0
    printf("%u\n", u_mul(UINT_MAX/2,2)); // OK
    return 0;
} 
```

将程序与 asm 目标文件链接。就我而言，在[Qt Creator](http://en.wikipedia.org/wiki/Qt_Creator)中，将其添加到`LIBS`.pro 文件中。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2008-10-14T07:30:00.787

用双打计算结果。它们有 15 位有效数字。*您的要求在c*上有一个10 ⁸的硬上限 ——它最多可以有 8 位数字。因此，如果它在范围内，结果将是精确的，否则它不会溢出。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2013-08-05T15:47:25.007

试试这个宏测试32位机器的溢出位（改编了Angel Sinigersky的解决方案）

```
#define overflowflag(isOverflow){   \
size_t eflags;                      \
asm ("pushfl ;"                     \
     "pop %%eax"                    \
    : "=a" (eflags));               \
isOverflow = (eflags >> 11) & 1;} 
```

我将其定义为宏，否则溢出位将被覆盖。

随后是一个带有上述代码段的小应用程序：

```
#include <cstddef>
#include <stdio.h>
#include <iostream>
#include <conio.h>
#if defined( _MSC_VER )
#include <intrin.h>
#include <oskit/x86>
#endif

using namespace std;

#define detectOverflow(isOverflow){     \
size_t eflags;                      \
asm ("pushfl ;"                     \
    "pop %%eax"                     \
    : "=a" (eflags));               \
isOverflow = (eflags >> 11) & 1;}

int main(int argc, char **argv) {

    bool endTest = false;
    bool isOverflow;

    do {
        cout << "Enter two intergers" << endl;
        int x = 0;
        int y = 0;
        cin.clear();
        cin >> x >> y;
        int z = x * y;
        detectOverflow(isOverflow)
        printf("\nThe result is: %d", z);
        if (!isOverflow) {
            std::cout << ": no overflow occured\n" << std::endl;
        } else {
            std::cout << ": overflow occured\n" << std::endl;
        }

        z = x * x * y;
        detectOverflow(isOverflow)
        printf("\nThe result is: %d", z);
        if (!isOverflow) {
            std::cout << ": no overflow ocurred\n" << std::endl;
        } else {
            std::cout << ": overflow occured\n" << std::endl;
        }

        cout << "Do you want to stop? (Enter \"y\" or \"Y)" << endl;

        char c = 0;

        do {
            c = getchar();
        } while ((c == '\n') && (c != EOF));

        if (c == 'y' || c == 'Y') {
            endTest = true;
        }

        do {
            c = getchar();
        } while ((c != '\n') && (c != EOF));

    } while (!endTest);
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-10-13T23:25:45.290

> 您无法从 C/C++ 访问溢出标志。

我不同意这一点。`jo`假设您在 x86 上，您可以编写一些内联汇编语言并使用（跳转溢出）指令来捕获溢出。当然，您的代码将不再可移植到其他架构。

看`info as`和`info gcc`。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2010-05-01T18:36:57.523

[在 C 中捕获整数溢出](http://www.fefe.de/intof.html)指出了一种比 CERT 讨论的解决方案更通用的解决方案（它在处理类型方面更通用），即使它需要一些 GCC 扩展（我不知道它们的支持范围有多广）。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-03-15T15:55:58.330

[`mozilla::CheckedInt<T>`](https://searchfox.org/mozilla-central/source/mfbt/CheckedInt.h)为整数类型提供溢出检查的整数数学`T`（使用 clang 和 gcc 上的编译器内在函数）。该代码在 MPL 2.0 下，并且依赖于三个 ([`IntegerTypeTraits.h`](https://searchfox.org/mozilla-central/source/mfbt/IntegerTypeTraits.h)和[`Attributes.h`](https://searchfox.org/mozilla-central/source/mfbt/Attributes.h))[`Compiler.h`](https://searchfox.org/mozilla-central/source/mfbt/Compiler.h)其他仅标头的非标准库标头以及 Mozilla 特定的[断言机制](https://searchfox.org/mozilla-central/source/mfbt/Assertions.h)。如果您导入代码，您可能想要替换断言机制。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-02-13T17:34:18.263

为了扩展 Head Geek 的答案，有一种更快的方法来做`addition_is_safe`;

```
bool addition_is_safe(unsigned int a, unsigned int b)
{
    unsigned int L_Mask = std::numeric_limits<unsigned int>::max();
    L_Mask >>= 1;
    L_Mask = ~L_Mask;

    a &= L_Mask;
    b &= L_Mask;

    return ( a == 0 || b == 0 );
} 
```

这使用机器架构安全，因为 64 位和 32 位无符号整数仍然可以正常工作。基本上，我创建了一个掩码，它将屏蔽除最重要的位之外的所有内容。然后，我屏蔽两个整数，如果其中任何一个都没有设置该位，那么加法是安全的。

如果您在某些构造函数中预先初始化掩码，这会更快，因为它永远不会改变。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-11-18T19:29:54.390

x86 指令集包括一个无符号乘法指令，将结果存储到两个寄存器中。要使用 C 中的该指令，可以在 64 位程序 (GCC) 中编写以下代码：

```
unsigned long checked_imul(unsigned long a, unsigned long b) {
  unsigned __int128 res = (unsigned __int128)a * b;
  if ((unsigned long)(res >> 64))
    printf("overflow in integer multiply");
  return (unsigned long)res;
} 
```

对于 32 位程序，需要将结果设为 64 位，将参数设为 32 位。

另一种方法是使用编译器相关的内在函数来检查标志寄存器。可以从*[6.56 Built-in Functions to Perform Arithmetic with Overflow Checking](https://gcc.gnu.org/onlinedocs/gcc/Integer-Overflow-Builtins.html)*找到有关溢出内在函数的 GCC 文档。

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2008-10-14T18:43:06.670

[MSalter 的回答](https://stackoverflow.com/questions/199333/how-do-i-detect-unsigned-integer-multiply-overflow/200258#200258)是个好主意。

如果需要整数计算（为了精度），但浮点可用，您可以执行以下操作：

```
uint64_t foo(uint64_t a, uint64_t b) {
    double dc;

    dc = pow(a, b);

    if (dc < UINT_MAX) {
       return (powu64(a, b));
    }
    else {
      // Overflow
    }
} 
```

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2008-10-13T23:07:19.960

一个干净的方法是覆盖所有运算符（特别是 + 和 *）并在执行操作之前检查溢出。

* * *

## 回答 #27

> 赞同：-3
> 
> 时间：2013-10-03T23:43:50.720

这取决于你用它做什么。执行无符号长 (DWORD) 加法或乘法，最好的解决方案是使用 ULARGE_INTEGER。

ULARGE_INTEGER 是两个 DWORD 的结构。完整值可以作为“QuadPart”访问，而高 DWORD 可以作为“HighPart”访问，低 DWORD 可以作为“LowPart”访问。

例如：

```
DWORD
My Addition(DWORD Value_A, DWORD Value_B)
{
    ULARGE_INTEGER a, b;

    b.LowPart = Value_A;  // A 32 bit value(up to 32 bit)
    b.HighPart = 0;
    a.LowPart = Value_B;  // A 32 bit value(up to 32 bit)
    a.HighPart = 0;

    a.QuadPart += b.QuadPart;

    // If  a.HighPart
    // Then a.HighPart contains the overflow (carry)

    return (a.LowPart + a.HighPart)

    // Any overflow is stored in a.HighPart (up to 32 bits) 
```

* * *

## 回答 #28

> 赞同：-3
> 
> 时间：2014-06-20T19:22:43.877

```
#include <stdio.h>
#include <stdlib.h>

#define MAX 100 

int mltovf(int a, int b)
{
    if (a && b) return abs(a) > MAX/abs(b);
    else return 0;
}

main()
{
    int a, b;

    for (a = 0; a <= MAX; a++)
        for (b = 0; b < MAX; b++) {

        if (mltovf(a, b) != (a*b > MAX)) 
            printf("Bad calculation: a: %d b: %d\n", a, b);

    }
} 
```

* * *

## 回答 #29

> 赞同：-3
> 
> 时间：2015-01-21T21:28:11.173

要以可移植的方式执行无符号乘法而不溢出，可以使用以下方法：

```
... /* begin multiplication */
unsigned multiplicand, multiplier, product, productHalf;
int zeroesMultiplicand, zeroesMultiplier;
zeroesMultiplicand = number_of_leading_zeroes( multiplicand );
zeroesMultiplier   = number_of_leading_zeroes( multiplier );
if( zeroesMultiplicand + zeroesMultiplier <= 30 ) goto overflow;
productHalf = multiplicand * ( c >> 1 );
if( (int)productHalf < 0 ) goto overflow;
product = productHalf * 2;
if( multiplier & 1 ){
   product += multiplicand;
   if( product < multiplicand ) goto overflow;
}
..../* continue code here where "product" is the correct product */
....
overflow: /* put overflow handling code here */

int number_of_leading_zeroes( unsigned value ){
   int ctZeroes;
   if( value == 0 ) return 32;
   ctZeroes = 1;
   if( ( value >> 16 ) == 0 ){ ctZeroes += 16; value = value << 16; }
   if( ( value >> 24 ) == 0 ){ ctZeroes +=  8; value = value <<  8; }
   if( ( value >> 28 ) == 0 ){ ctZeroes +=  4; value = value <<  4; }
   if( ( value >> 30 ) == 0 ){ ctZeroes +=  2; value = value <<  2; }
   ctZeroes -= x >> 31;
   return ctZeroes;
} 
```

* * *

## 回答 #30

> 赞同：-4
> 
> 时间：2010-05-01T19:01:54.123

测试溢出的简单方法是通过检查当前值是否小于先前值来进行验证。例如，假设您有一个循环来打印 2 的幂：

```
long lng;
int n;
for (n = 0; n < 34; ++n)
{
   lng = pow (2, n);
   printf ("%li\n", lng);
} 
```

以我描述的方式添加溢出检查会导致：

```
long signed lng, lng_prev = 0;
int n;
for (n = 0; n < 34; ++n)
{
    lng = pow (2, n);
    if (lng <= lng_prev)
    {
        printf ("Overflow: %i\n", n);
        /* Do whatever you do in the event of overflow.  */
    }
    printf ("%li\n", lng);
    lng_prev = lng;
} 
```

它适用于无符号值以及正负符号​​值。

当然，如果你想对减少值而不是增加值做类似的事情，你可以翻转`<=`符号来 make 它`>=`，假设下溢的行为与溢出的行为相同。老实说，这与您在不访问 CPU 的溢出标志的情况下所获得的可移植性差不多（这将需要内联汇编代码，从而使您的代码无论如何都不可移植）。

* * *

## 回答 #31

> 赞同：-6
> 
> 时间：2008-10-13T22:59:11.817

内联汇编让您可以直接检查溢出位。如果你打算使用 C++，你真的应该学习汇编。

# c - 使用 C 在终端运行应用程序中打印旋转光标

> ID：199336
> 
> 赞同：16
> 
> 时间：2008-10-13T22:54:11.377
> 
> 标签：c, printf

如何在使用标准 C 在终端中运行的实用程序中打印旋转光标？

我正在寻找可以打印的东西：\ | / - 在屏幕上的同一位置一遍又一遍？

谢谢

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-13T22:57:14.863

您可以像这样使用退格字符 ( `\b`)：

```
printf("processing... |");
fflush(stdout);
// do something
printf("\b/");
fflush(stdout);
// do some more
printf("\b-");
fflush(stdout); 
```

等你需要，`fflush(stdout)`因为通常 stdout 被缓冲，直到你输出一个换行符。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-13T23:17:29.707

这是一些示例代码。在任务完成时每隔一段时间调用一次 advance_cursor()。

```
#include <stdio.h>

void advance_cursor() {
  static int pos=0;
  char cursor[4]={'/','-','\\','|'};
  printf("%c\b", cursor[pos]);
  fflush(stdout);
  pos = (pos+1) % 4;
}

int main(int argc, char **argv) {
  int i;
  for (i=0; i<100; i++) {
    advance_cursor();
    usleep(100000);
  }
  printf("\n");
  return 0;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-20T23:39:39.627

您也可以使用*\r*：

```
#include <stdio.h>
#include <unistd.h>

void
advance_spinner() {
    static char bars[] = { '/', '-', '\\', '|' };
    static int nbars = sizeof(bars) / sizeof(char);
    static int pos = 0;

    printf("%c\r", bars[pos]);
    fflush(stdout);
    pos = (pos + 1) % nbars;
}

int
main() {
    while (1) {
        advance_spinner();
        usleep(300);
    }

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-13T22:58:14.283

我已经这样做了，很久以前。有两种方法。

1.  使用像 ncurses 这样的库来控制终端。如果你想做很多这样的事情，这很有效。如果你只是把这个放在一个小地方，那显然是矫枉过正的。

2.  打印一个控制字符。

首先打印“/”，然后是 0x08（退格），然后是“-”，然后是 0x08，然后是“\”....

退格字符将光标位置向后移动一个空格，但将当前字符保留在那里，直到您覆盖它。把握好时机（这样它就不会旋转得快或慢），你就是金子。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T23:09:04.340

没有真正的“标准”方法可以做到这一点，因为 C 标准库 ( [http://members.aol.com/wantondeb/](http://members.aol.com/wantondeb/) ) 不提供执行原始终端/控制台输出的功能。

在 DOS/Windows 控制台中，执行此操作的标准方式是 with [`conio.h`](http://en.wikipedia.org/wiki/Conio.h)，而在 Unix/Linux 下，为此目的接受的库是[`ncurses`](http://en.wikipedia.org/wiki/Ncurses)（`ncurses`基本上以独立于终端的方式封装了 MBCook 描述的控制字符行为）。

# clickonce - 如何回滚 ClickOnce 应用程序？

> ID：199348
> 
> 赞同：55
> 
> 时间：2008-10-13T22:57:53.397
> 
> 标签：clickonce

有没有办法（hacky 会做）允许用户返回到[ClickOnce](http://en.wikipedia.org/wiki/ClickOnce)网络部署应用程序的先前版本？

我查看了文档和 API，似乎没有办法。您**可以**选择性地选择是否要更新，但一旦更新，似乎就没有回头路了。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-11-02T22:24:14.417

您可以通过更改服务器清单文件在服务器端恢复到旧版本。当客户端重新启动应用程序时，它会看到它的版本与服务器所说的“当前”版本不同，它将下载新版本。此服务器清单文件通常始终指向最新版本，但并非必须如此。

以下是如何更改它（我使用 Visual Studio 2008 发布。其他版本可能具有不同的发布文件夹结构）。

在与 publish.htm 相同的文件夹中有一个[XML](http://en.wikipedia.org/wiki/XML)文档，名为`[appName].application`. 这是客户端用来比较其当前版本的服务器端清单文件。本文档中包含客户端应该运行的“当前”版本以及可以在服务器上找到部署文件的位置。

在与它相同的位置`publish.htm`还有一个名为“应用程序文件”的文件夹。此文件夹包含每个先前发布的子文件夹。在这些子文件夹中的每一个中都有另一个我上面提到的同名的 XML 文档，称为`[appName].application`. 复制此文件（从包含您要恢复到的版本的任何文件夹中）并将其粘贴到与`publish.htm`（几个级别）相同的文件夹中。当客户端应用程序重新启动时，它看起来就像一个新版本可用，下载并运行它。客户端现在将运行以前的版本。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-13T23:20:21.277

ClickOnce 将使用您发送给他们的任何版本。如果您向他们发送旧版本，他们将回滚到该旧版本。

早在 5 月，我的好友 David 写了一篇文章，介绍如何在每个用户的基础上执行此操作。我们实际上可以让每个用户使用不同的版本。应用程序甚至告诉数据库用户想要哪个版本，所以理论上他们可以更改他们的版本，然后简单地重新启动应用程序。

[使用 ClickOnce 进行细粒度版本控制](http://www.infoq.com/articles/ClickOnce-Versioning)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-13T22:59:43.300

您可以进入添加/删除应用程序并选择您的应用程序并选择获取最后一次安装。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-11-29T08:58:44.783

只是用它来回滚在 Visual Studio 2017 中开发的 clickonce 应用程序。在我的例子中，在根文件夹中，只有两个文件；一个名为 [applicationName].manifest，另一个名为 setup.exe。

[applicationName].manifest 包含对当前版本号的数字引用，但每个都链接到 publicKeyToken 值，所以我不愿意手动编辑它。

因此，在 Application Files 文件夹中，在包含我想要回滚到的版本的子文件夹下，我找到了另一个 [applicationName].manifest，我将其复制到了根文件夹（已备份原始文件）。

就是这样。它对我有用，是一个非常简单的解决方案。但是我没有使用最低要求的版本，所以不能说这是否会影响它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-13T23:29:01.273

您可以使用[MAGEUI](http://msdn.microsoft.com/en-us/library/axe07zaa(VS.80).aspx)回滚到服务器上以前的清单版本。[看看这个](http://www.code-magazine.com/Article.aspx?quickid=0611041)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-13T23:16:03.813

如果您查看您的部署位置，您会在一个单独的文件夹中看到每个以前的版本，其中附加了版本号，以及部署清单，也附加了版本号。

您可以将其中任何一个重命名为当前部署，并且下次更新该应用程序时，它将拉入您回滚到的版本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-24T15:55:23.213

我理解 ClickOnce 版本检查算法如下：

1.  如果客户端上安装的版本 = 部署到服务器的版本 - 什么也不做
2.  如果客户端版本 < 服务器版本 - 升级
3.  如果客户端版本 > 服务器版本：
    1.  如果客户端上指定的 minimumVersion >= 服务器版本 - 显示错误，因为我们有
    2.  如果客户端上指定的 minimumVersion < 服务器版本 - 降级
    3.  如果未在客户端上指定 minimumVersion - 降级

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-02-22T17:37:58.200

我只需要在我的实时生产服务器上做其中一个，很高兴有所有这些笔记。我的解决方案有点不同，我也想将其添加为修复程序。在进行生产部署之前，我总是事先备份整个包含文件夹。我能够将整个文件夹结构复制回其原始状态，并且一切正常。

此方法的注意事项：

*   如果应用程序很大，或者应用程序文件夹中已经发布了很多版本，您的备份将很大。确保你有足够的空间（对我来说存储不是对象）。
*   权限有一种以这种方式咬你的讨厌趋势。如果您的部署位置是为外部访问托管的，请确保您在还原前后验证所有权限。
*   在[IIS](http://en.wikipedia.org/wiki/Internet_Information_Services)中回收我的应用程序池对我很有帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-28T05:32:14.497

[如果您知道发布者URI](http://en.wikipedia.org/wiki/Uniform_resource_identifier)以及部署和应用程序的名称、版本语言公钥令牌和处理器架构，这可以通过反射来完成。

下面的代码将尝试回滚“coolapp.app” [ClickOnce](http://en.wikipedia.org/wiki/ClickOnce)应用程序。如果无法回滚，它会尝试卸载它。

```
using System;
using System.Deployment.Application;
using System.Reflection;

namespace ClickOnceAppRollback
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        static void Main()
        {
            string appId = string.Format("{0}#{1}, Version={2}, Culture={3}, PublicKeyToken={4}, processorArchitecture={5}/{6}, Version={7}, Culture={8}, PublicKeyToken={9}, processorArchitecture={10}, type={11}",
                /*The URI location of the app*/@"http://www.microsoft.com/coolapp.exe.application",
                /*The application's assemblyIdentity name*/"coolapp.app",
                /*The application's assemblyIdentity version*/"10.8.62.17109",
                /*The application's assemblyIdentity language*/"neutral",
                /*The application's assemblyIdentity public Key Token*/"0000000000000000",
                /*The application's assemblyIdentity processor architecture*/"msil",
                /*The deployment's dependentAssembly name*/"coolapp.exe",
                /*The deployment's dependentAssembly version*/"10.8.62.17109",
                /*The deployment's dependentAssembly language*/"neutral",
                /*The deployment's dependentAssembly public Key Token*/"0000000000000000",
                /*The deployment's dependentAssembly processor architecture*/"msil",
                /*The deployment's dependentAssembly type*/"win32");

            var ctor = typeof(ApplicationDeployment).GetConstructor(BindingFlags.Instance | BindingFlags.NonPublic, null, new Type[] { typeof(string) }, null);
            var appDeployment = ctor.Invoke(new object[] { appId });

            var subState = appDeployment.GetType().GetField("_subState", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(appDeployment);
            var subStore = appDeployment.GetType().GetField("_subStore", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(appDeployment);
            try
            {
                subStore.GetType().GetMethod("RollbackSubscription").Invoke(subStore, new object[] { subState });
            }
            catch
            {
                subStore.GetType().GetMethod("UninstallSubscription").Invoke(subStore, new object[] { subState });
            }
        }
    }
} 
```

# css - Best CSS color wheel sites

> ID：199378
> 
> 赞同：61
> 
> 时间：2008-10-13T23:08:42.437
> 
> 标签：css, colors, styling, color-scheme

What site(s) do you recommend for looking at complimentary colors for site design? It would also be beneficial to enter a hex or RGB value and have the color wheel spit back complimentary colors.

Most popular:

*   [Kuler](http://kuler.adobe.com/)

Others in alphabetical order:

*   [4096 Color Wheel](http://www.ficml.org/jemimap/style/color/wheel.html)
*   [Allprofitallfree - color-wheel2](http://allprofitallfree.com/color-wheel2.html)
*   [Color Wheel v1.2 Javascript color scheme generator](http://design.geckotribe.com/colorwheel/)
*   [Colorblender](http://colorblender.com)
*   [Colorotate](http://colorotate.org/)
*   [Colorsontheweb - colorwheel](http://colorsontheweb.com/colorwheel.asp)
*   [Colorschemedesigner](http://colorschemedesigner.com/)
*   [Colorschemer](http://colorschemer.com/)
*   [Colourlovers](http://colourlovers.com/)
*   [Colr](http://colr.org/)
*   [hslpicker](http://hslpicker.com)
*   [Visibone - colorlab](http://visibone.com/colorlab/)

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-13T23:12:32.290

Adobe's Kuler - [http://kuler.adobe.com/](http://kuler.adobe.com/)

is widely considered to be the best color palette selector out there, as it also lets you share color palettes other users have created. Sign in, click create, and you'll have options including "complementary" that give you a good starting point if you have one color in mind.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-13T23:22:04.893

[http://www.colorschemer.com](http://www.colorschemer.com) has an online color scheme gallery.

They also have a free desktop app called [ColorPix](http://www.colorschemer.com/colorpix_info.php):

                                          [![colorpix](https://i.stack.imgur.com/UHPKx.jpg)](https://i.stack.imgur.com/UHPKx.jpg)
[(source: [colorschemer.com](http://www.colorschemer.com/images/colorpix_screen.jpg))]

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-13T23:36:40.103

I love [colourlovers.com](http://colourlovers.com). It's a great community and a great idea, though it doesn't really "spit back" colors as you were looking for. The community that contributes to it provides ample complementary colors though.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-03-30T01:00:00.877

I'm a huge fan of Color Scheme Designer...

[http://colorschemedesigner.com/](http://colorschemedesigner.com/)

From the [Lifehacker article](http://lifehacker.com/#!5342903/color-scheme-designer-is-a-diverse-palette-creator)...

> You can generate single monochromatic, complimentary, triad, tetrad, analogic, and accented analogic color palettes. You can simulate color-based vision disorders to see how your design colors will look—they even list the percentage of people suffering from the disorders. A preview function populates a dummy web page with your color scheme, which is a handy tool for seeing how your selected colors look together off the palette.
> 
> While the page-simulator is a really great trick, the best feature of Color Scheme Designer is the ability to export your palette not just as a Photoshop palette—a common limitation of many web-based generators—but as HTML+CSS, XML, TXT, and GPL (the palette format for GIMP).

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-13T23:12:32.243

My favorite: [http://www.colorsontheweb.com/colorwheel.asp](http://www.colorsontheweb.com/colorwheel.asp)

[http://www.visibone.com/colorlab/](http://www.visibone.com/colorlab/)

[http://www.wellstyled.com/tools/colorscheme2/index-en.html](http://www.wellstyled.com/tools/colorscheme2/index-en.html)

[http://www.allprofitallfree.com/color-wheel2.html](http://www.allprofitallfree.com/color-wheel2.html)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-13T23:45:48.353

[ColorBlender](http://colorblender.com) or [Kuler](http://kuler.adobe.com)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-13T23:26:35.927

Agreed with davebug, Kuler (kuler.adobe.com) all the way!

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-13T23:13:34.503

I love Adobe's www.kuler.com ... if you sign up, you can download the palettes as Adobe Swatch files and use them in Creative Suite products.

Though, it's really just a search tool for user-submitted palettes... maybe not exactly what you're looking for.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-14T00:02:22.330

I think this one is very good: [http://www.gpeters.com/color/color-schemes.php](http://www.gpeters.com/color/color-schemes.php).

All you have to do is to write a keyword and let Yahoo! to pick your color scheme.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-14T01:53:47.223

I like [Colr.org](http://www.colr.org/) a lot. It doesn't have a color wheel, but it has some really interesting features. You can choose a color scheme from an image, tag colors--and color schemes and even search on the tags. It's good for inspiration.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-23T14:32:21.477

I've used [ColorPic](http://www.iconico.com/colorpic/) for quite a while. It's been excellent for my needs.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-15T15:23:27.770

[Colorotate](http://www.colorotate.org/) seems good too.

# blackberry - 直接从 USB 接口从黑莓（珍珠）获取 gps 数据

> ID：199384
> 
> 赞同：3
> 
> 时间：2008-10-13T23:11:02.387
> 
> 标签：blackberry, java-me, usb, gps, rim-4.5

有没有人研究过如何通过 USB 访问黑莓手机上的 gps 芯片组，这样就不必通过手机运营商的数据网络传输这些数据？

是否可以访问 GPS 芯片组，将信息存储在缓冲区中，并打开接口连接（通过 USB 充电端口）进行访问？不确定 J2ME 是否允许这样做...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T00:07:53.940

查看黑莓 JDE 中包含的“UsbDemo”项目和“GPSDemo”。

GPSDemo 监听 GPS 并将位置信息存储到通过网络发送的缓冲区中。

USB 演示展示了如何通过 USB 与桌面客户端交互。

您应该能够从 GPS Demo 中提取网络代码并输入代码以通过 USB 通话。

# c# - 在我的 C# 应用程序中嵌入 IronPython 的最佳方式是什么？

> ID：199390
> 
> 赞同：2
> 
> 时间：2008-10-13T23:13:02.850
> 
> 标签：c#, .net, ironpython, dynamic-language-runtime

我有一个非常精通技术的人使用的应用程序，他们想要小岛的可编程性，所以我使用了嵌入式 Iron Python。

但是，由于 IronPython 2.0 Eval() 不再起作用。具体来说，我不能既加载模块又注入局部变量。

有一种解决方法，我仍然可以调用 Execute()，打印出我的答案并收听 StandardOut，但随后它以字符串形式出现，我丢失了类型。

不是长久的灾难，而是更复杂的对象的巨大痛苦。

有谁知道如何让 Eval() 像在 1.x 中一样在 2.0 中再次工作？

干杯，简

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T23:24:30.893

您能否对问题更具体一点，并提供一个代码示例？“eval”风格的功能肯定仍然存在，尽管您已经注意到，自 1.0 以来托管界面发生了很大变化。

这适用于 beta 5：

```
ScriptEngine engine = Python.CreateEngine();
ScriptSource source = engine.CreateScriptSourceFromString("2 + 5", SourceCodeKind.Expression);
int result = source.Execute<int>(); 
```

顺便说一句，在`SourceCodeKind`这里使用权利是至关重要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T23:26:18.893

这个例子可以帮助你：[http ://www.voidspace.org.uk/ironpython/dlr_hosting.shtml](http://www.voidspace.org.uk/ironpython/dlr_hosting.shtml)

# visual-studio - Visual Studio 2008 -- 我可以更改默认选择的“添加引用”选项卡吗？

> ID：199397
> 
> 赞同：13
> 
> 时间：2008-10-13T23:14:52.067
> 
> 标签：visual-studio, configuration

每次启动 Visual Studio 时，第一次单击“添加引用”以将 DLL 引用添加到项目时，默认情况下会选择该对话框上的 .NET 选项卡。大多数阅读本文的人可能已经注意到，要填写完整的 .NET 组件列表可能需要很长时间（通常超过 30 秒）。

但是，由于我们设计解决方案的方式，大约 80% 的时间，我想从“项目”选项卡或“浏览”选项卡中进行选择。

Visual Studio 中是否有任何设置可以让我将“项目”设置为第一个加载的选项卡？有谁知道任何其他隐藏的技巧来达到同样的效果？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-13T23:44:11.057

我使用这个[技巧](http://blogs.msdn.com/saraford/archive/2008/05/07/did-you-know-you-can-add-references-to-your-solution-directly-from-the-object-browser-210.aspx)以不同的方式做到这一点。打开您的对象浏览器（Cntrl + Alt + J）。将浏览下拉菜单更改为“我的解决方案”。选择你想要的项目。在工具栏上，单击“在解决方案资源管理器中添加到选定项目中的引用”。

一项整洁的工作为我节省了很多时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-09T20:50:40.907

如果您安装了Visual Studio 2008 的[PowerCommands](http://code.msdn.microsoft.com/PowerCommands)，则可以在项目之间复制粘贴引用，以及复制粘贴单个项目作为引用，所有这些都无需打开引用对话框。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T23:36:38.077

我从未找到任何允许您更改默认选项卡的地方。是的，加载该窗口需要多长时间很烦人。我认为这是我们必须忍受的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-01T21:38:14.300

Tuna Toksoz 为 Visual Studio 创建了一个快速添加引用对话框插件。

[http://devlicio.us/blogs/tuna_toksoz/archive/2009/06/18/vs-addin-fast-add-reference-dialog-no-more-coffee-break.aspx](http://devlicio.us/blogs/tuna_toksoz/archive/2009/06/18/vs-addin-fast-add-reference-dialog-no-more-coffee-break.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T23:47:57.367

您可能会考虑的另一个提示是，如果您在另一个项目中引用了一个类型，[ReSharper](http://jetbrains.com/resharper)会注意到它并提供为您将其添加到您的引用中。

有了这个，除非我有要添加的文件 dll 引用，否则我永远不会访问该选项卡。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T23:43:25.800

据我所知，恐怕答案是否定的。我什至浏览了注册表以确定是否有办法重新排序选项卡。您可能可以使用十六进制编辑器来完成此操作，但我建议您不要这样做。

# c++ - C++：在 Windows 上使用 C++ 读写 BMP 文件的最简单方法是什么？

> ID：199403
> 
> 赞同：11
> 
> 时间：2008-10-13T23:21:08.233
> 
> 标签：c++, windows, winapi, image-manipulation, bmp

我想加载一个 BMP 文件，在内存中对其进行一些操作，并在 Windows 上使用 C++（Win32 本机）输出一个新的 BMP 文件。我知道[ImageMagick](http://www.imagemagick.org/)并且它是 C++ 绑定[Magick++](http://www.imagemagick.org/Magick%2B%2B/)，但我认为这对这个项目来说有点过头了，因为我目前对其他文件格式或平台不感兴趣。

就读取和写入 BMP 文件的代码设置而言，最简单的方法是什么？答案可能是“只使用 Magick++，它是最简单的”。

相关问题：[最好的图像处理库是什么？](https://stackoverflow.com/questions/158756/what-is-the-best-image-manipulation-library)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-13T23:31:32.440

当只为 Windows 开发时，我通常只使用 ATL [CImage](http://msdn.microsoft.com/en-us/library/bwea7by5(VS.80).aspx)类

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-08-16T12:29:25.117

[EasyBMP](http://easybmp.sourceforge.net/)如果您只想要 bmp 支持。我很简单，可以在几分钟内开始使用，如果你需要的话，它是多平台的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T07:30:01.287

一个 BMP 文件由 3 个结构组成。一个 BITMAPFILEHEADER 后跟一个 BITMAPINFO 后跟一个字节数组。

使用 Win32 加载 BMP 文件的最简单方法是调用 CreateFile、GetFileSize、ReadFile 和 CloseHandle 将文件图像加载到内存中，然后将指向缓冲区的指针投射到 BITMAPFILEHEADER 并从那里开始。

我撒谎，更简单的方法是调用LoadImage。确保传递 LR_DIBSECTION 标志以确保 GDI 不会将加载的图像转换为您的主显示器配置的任何位深度。这样做的好处是可以为您提供一个 HBITMAP，您可以将其选择到 DC 中，从而使用 GDI 进行绘制。

但是，要保存它，没有捷径可走。你需要准备一个 BITMAPFILEHEADER，写出来，填写一个 BITMAPINFO 结构，写出来，然后是实际的像素数据。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-08-14T22:36:39.687

我按照上面的方法进行了尝试`CImage`，但是我有一个 C 数组，其中包含我只是想将其转储为 BMP（或任何其他格式）的像素值。 `CImage`没有构造函数，我不想链接 MFC (for `CBitmap`) 也不想理解 IWIC。

简单的是[CImg](https://sourceforge.net/projects/cimg/)：

```
#include <cimg/cimg.h>
using namespace cimg_library;
//...
void SaveMyData(uint8_t *pxarray, int width, int height)
{
    CImg<uint8_t> img(pxarray, width, height);
    img.save_bmp("sav.bmp");
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-13T23:28:26.597

[CBitmap](http://msdn.microsoft.com/en-us/library/6t1yfd35(VS.80).aspx)类执行BMP I/O。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-14T05:47:47.827

```
#include <windows.h> 
```

[加载图像](http://msdn.microsoft.com/en-us/library/ms648045.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-13T23:25:57.693

我没有使用 Magick++，但 Windows 有一个名为 Windows Imaging Component 的库，它可能会满足您的需求。

# eclipse - Eclipse POJO 生成器插件

> ID：199405
> 
> 赞同：3
> 
> 时间：2008-10-13T23:23:59.053
> 
> 标签：eclipse, plugins, pojo

有谁知道一个好的 Eclipse POJO 生成器？从字段函数生成 getter\setter 和构造函数都非常好，但是将它们绑定到新的 class\POJO 对话框中会很有用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-12T08:23:34.587

这不是 Eclipse 插件，而是生成 Java bean 的一种方法。使用[Relax NG Compact 语法](http://www.relaxng.org/compact-tutorial-20030326.html)定义模式，将其转换为 XML 模式（xsd 文件），并使用 JAXB ( [xjc](http://java.sun.com/webservices/docs/1.6/jaxb/xjc.html) ) 生成 Java 代码。

# c++ - 在 C 代码中使用 C++ 库

> ID：199418
> 
> 赞同：114
> 
> 时间：2008-10-13T23:30:20.663
> 
> 标签：c++, c, gcc, glibc

我有一个 C++ 库，它提供了各种用于管理数据的类。我有图书馆的源代码。

我想扩展 C++ API 以支持 C 函数调用，以便该库可以同时与 C 代码和 C++ 代码一起使用。

我正在使用 GNU 工具链（gcc、glibc 等），因此语言和架构支持不是问题。

有什么理由说明这在**技术上**是不可能的吗？

有什么我需要注意的问题吗**？**

是否有与此相关的资源、示例代码和/或文档？

* * *

我发现的其他一些事情：

1.  使用以下内容来包装 C 代码需要使用的 C++ 标头。

```
#ifdef __cplusplus
extern "C" {  
#endif  
//  
// Code goes here ...  
//  
#ifdef __cplusplus  
} // extern "C"  
#endif 
```

2.  将“真正的”C++ 接口保存在 C 不包含的单独头文件中。在这里考虑[PIMPL 原则](http://en.wikipedia.org/wiki/Private_class_data_pattern)。在这里使用`#ifndef __cplusplus #error`东西有助于检测任何疯狂。
3.  小心 C++ 标识符作为 C 代码中的名称
4.  C 和 C++ 编译器之间大小不同的枚举。如果您使用 GNU 工具链，这可能不是问题，但仍然要小心。
5.  对于结构，请遵循以下形式，以免 C 混淆。

    ```
    typedef struct X { ... } X 
    ```

6.  然后使用指针来传递 C++ 对象，它们只需在 C 中声明为 struct X，其中 X 是 C++ 对象。

所有这一切都是由一位 C++ 天才朋友提供的。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-10-13T23:33:49.063

是的，这当然是可能的。您需要在 C++ 中编写一个接口层，该接口层使用以下命令声明函数`extern "C"`：

```
extern "C" int foo(char *bar)
{
    return realFoo(std::string(bar));
} 
```

然后，您将从`foo()`C 模块调用，该模块会将调用传递给`realFoo()`用 C++ 实现的函数。

如果您需要使用数据成员和方法公开一个完整的 C++ 类，那么您可能需要做的工作比这个简单的函数示例更多。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-13T23:46:19.710

C++ FAQ Lite：[“如何混合 C 和 C++ 代码”](https://isocpp.org/wiki/faq/mixing-c-and-cpp)。

这些问题的答案中描述了一些陷阱：

*   [32.8] 如何将 C++ 类的对象传递给/从 C 函数传递？
*   [32.9] 我的 C 函数可以直接访问 C++ 类的对象中的数据吗？

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-13T23:45:31.630

主要问题：不能在 C 中捕获异常。如果 C++ 代码中可能出现异常，请非常小心地编写 C 代码或 C++ 包装器。相反，C 代码（如在各种脚本语言中发现的）中的异常类机制（即，longjump）不需要为堆栈上的 C++ 对象调用析构函数。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-13T23:40:34.060

您可以混合使用 C/C++ 代码。如果您的 main() 函数在 C++ 中，那么您只需要确保您的 c 函数已声明

```
extern "C" 
```

如果你的 main 是 C，那么除了静态变量之外你可能没问题。任何带有静态变量的构造函数都应该在 main() 开始之前被调用。如果 C 是您的主要内容，则不会发生这种情况。我你有很多静态变量，最好的办法是用单例替换静态变量。

# java - 使用 Eclipse 打开命令提示符

> ID：199426
> 
> 赞同：5
> 
> 时间：2008-10-13T23:35:01.840
> 
> 标签：java, eclipse

我是 Java 新手，正在尝试使用 Eclipse 运行程序。但我不知道如何让命令提示符在 Eclipse 中运行...

我做了一些在线研究，但没有得到任何巩固！

### 更新：

我没有使用小程序。这是一个普通的 Java 程序，它试图从命令提示符读取一行。我正在尝试进行系统编程。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-13T23:55:27.023

查看有关如何开始使用 Eclipse 程序的课程计划：

[课](http://www.ics.uci.edu/~thornton/ics22/LabManual/Lab0/)

具体来说，看这张图：

![带有标准输入的 Eclipse 控制台图片](https://www.ics.uci.edu/~thornton/ics22/LabManual/Lab0/Eclipse-ConsoleTab-Stopped.png)

如果控制台选项卡在 Eclipse 中不可见，请转到菜单栏中的窗口 -> 显示视图 -> 控制台。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T23:39:54.373

如果你下载了 Eclipse/Java 包，并且你在一个项目中用 Eclipse 编写了一个 Java 程序，只需点击编译运行，它就会在 Eclipse 的输出窗口中运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T23:42:26.457

```
Try this:

import java.util.Scanner;

    public class ReadFromPrompt{

       public static void main(String[] args) {

           Scanner in = new Scanner(System.in);

           String line = in.nextLine();     

        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-11T05:06:44.913

```
Right Click on your project--->Run As--->Run Configurations...--->Select Arguments-->Enter the values---->Run 
```

# java - 休眠删除级联

> ID：199428
> 
> 赞同：10
> 
> 时间：2008-10-13T23:36:30.260
> 
> 标签：java, hibernate, cascade

我有一个实体 [项目]，其中包含一组其他实体 [问题]。

我已经用“all-delete-orphan”的级联属性映射了关系。

在我的数据库中，关系映射到问题表上的 project_id (FK) 字段。此字段不能为空，因为我不想要没有项目的问题。

当我这样做时`session.delete(project)`，它会抛出一个异常，说`project_id`cant be `null`，但是如果我删除`not-null`对该字段的约束，则删除效果很好。

任何人都知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-14T01:13:20.847

直接来自[文档](http://www.hibernate.org/hib_docs/nhibernate/html/example-parentchild.html#example-parentchild-cascades)。这完全解释了你的问题，我相信：

然而，这段代码

```
Parent p = (Parent) session.Load(typeof(Parent), pid);
// Get one child out of the set
IEnumerator childEnumerator = p.Children.GetEnumerator();
childEnumerator.MoveNext();
Child c = (Child) childEnumerator.Current;

p.Children.Remove(c);
c.Parent = null;
session.Flush(); 
```

不会从数据库中删除 c；它只会删除到 p 的链接（在这种情况下会导致 NOT NULL 约束违规）。您需要显式删除（）孩子。

```
Parent p = (Parent) session.Load(typeof(Parent), pid);
// Get one child out of the set
IEnumerator childEnumerator = p.Children.GetEnumerator();
childEnumerator.MoveNext();
Child c = (Child) childEnumerator.Current;

p.Children.Remove(c);
session.Delete(c);
session.Flush(); 
```

现在，在我们的例子中，没有父级，子级就无法真正存在。因此，如果我们从集合中删除一个 Child，我们确实希望将其删除。为此，我们必须使用 cascade="all-delete-orphan"。

```
<set name="Children" inverse="true" cascade="all-delete-orphan">
    <key column="parent_id"/>
    <one-to-many class="Child"/>
</set> 
```

编辑：

关于逆向的东西，我相信这仅决定了 sql 的生成方式，有关更多信息，请参阅此[文档](http://simoes.org/docs/hibernate-2.1/155.html)。

需要注意的一件事是，你有没有

```
not-null="true" 
```

关于休眠配置中的多对一关系？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T00:20:56.957

一种策略是用 on-delete-cascade 标记数据库中的外键，这样一旦 NHibernate 告诉数据库删除一个项目，数据库本身就会级联删除。然后你必须告诉 NHibernate 数据库本身会进行级联删除。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-13T23:49:39.767

删除首先发生在项目上并级联到问题，但项目删除包括问题中 project_id 的置空（为了参照完整性。您在删除问题对象时没有遇到异常，但是因为cascade 正在尝试使问题中的 FK 为空。

查看“ [Java Persistence with Hibernate](http://www.manning.com/bauer2/) ”，我认为您真正想要的是级联类型的删除或删除，而不是删除孤儿。

# c# - Visual Studio 2008 严重崩溃

> ID：199439
> 
> 赞同：5
> 
> 时间：2008-10-13T23:40:45.430
> 
> 标签：c#, sql-server, visual-studio, visual-studio-2008, ide

这已经发生在我身上3次了，我想知道是否有人遇到同样的问题。我正在运行 Visual Studio 2008 SP1，并点击 SQL Server 2005 开发人员版。

为了测试，我使用服务器资源管理器浏览我已经创建的数据库。为了进行测试，我将手动插入数据（右键单击表格 -> 显示表格数据）。

我可以毫无问题地这样做一个星期，但有时我的电脑会在星星对齐时崩溃。它不会挂起，也不会蓝屏，在我在尚未保存的新行中输入一些值后 0.2 秒，我看到了 bios 启动屏幕。我从未见过像这样的崩溃，它会立即重新启动。我认为当我输入违反数据库约束的内容时可能会发生这种情况，但我还不确定（需要更多崩溃来查明它）。

有人有同样的问题吗？知道解决方案吗？太糟糕了 VS 不是用托管代码编写的，是吗？:)

更新：我可以通过插入重复的主键，单击行，单击数据库错误通知上的确定，然后再次尝试更新主键来重现它。我同意 - 这听起来肯定是硬件或驱动程序问题，但我不确定如何解决这个问题，因为这仅在 VS 中执行此 1 个特定操作时发生。我也没有超频——我运行的是普通（单核）3 Ghz 戴尔。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-14T16:50:59.597

正如您所知，当您的计算机直接回到 BIOS 启动屏幕而没有蓝屏或其他崩溃数据时，这称为“[三重故障](http://en.wikipedia.org/wiki/Triple_fault)”基本上，有一个异常（在硬件级别）触发了异常处理程序异常处理程序触发异常的异常。这几乎总是一个硬件问题，因为操作系统在双重故障处理程序中往往非常小心，不会触发异常。

不用说，这可能是软件问题，但我会检查您的 RAM、CPU 和主板是否存在潜在问题。我有一个使用 Vista 随机执行此操作的戴尔，而戴尔的新主板/CPU 完美地解决了这个问题。

编辑：请注意，很难说服戴尔这确实是一个硬件问题，但坚持下去，最终他们会为你解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T00:25:45.420

[测试您的记忆力](http://www.memtest.org/)，这是您重新启动的最可能原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T23:43:01.793

Visual Studio 2008 只是一个应用程序，任何应用程序都不应该导致您的机器像那样重启。

可能导致您的机器重新启动的原因是驱动程序和硬件......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T00:29:56.860

不仅要赶上潮流，而且在过去的 15 年中，我遇到的这种情况的每一个实例都是由硬件故障引起的。

好消息是至少通常更容易修复。

你能把整个盒子换掉吗，即使只有几个星期？通常我真的不在乎*哪*一块失败了——我只是把整个事情拉下来，然后再把它整理出来。

乔

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T23:46:45.543

你在超频机器吗？像这样的重新启动表明您的超频状况不佳，即。太高，电压设置错误，内存时序错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T23:48:40.283

我在我的机器上（在 Vists32 上）运行了相同的应用程序，并且没有遇到这个问题。

对我来说听起来像是 RAM 的问题，虽然我在测试服务器中的硬盘坏了也会导致类似的问题，它甚至烧毁了主板，但这种事情最常见的是 RAM。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-14T20:36:23.697

我本身并没有崩溃，但是当我尝试在水晶报告中运行组专家时，VS2008 挂起并且只能通过使用任务管理器来关闭。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-16T17:02:05.257

我有足够的经验（阅读：老）知道这应该是一个硬件问题。但...

我目前工作的公司的另一位开发人员和我上周安装了 VS2008，现在我们都看到了这个问题。每隔一段时间，大约每天一次，当使用 IDE 时，机器会重置，就好像有人按下了重置开关一样。（这些机器上没有显示重置按钮。）

我们拥有与这里其他约 20 名开发人员相同的硬件（Dell Optiplex GX620、2GB RAM、WinXPsp2）。其他工作人员使用VS2005。我们是唯一有问题的人。这些机器是库存的（这是一个陈旧的公司环境）并且维护良好。

因此，虽然这不应该与 VS 有关，但它是大量间接证据。

对于它的价值，我在家里运行 VS2008 没有任何问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-16T17:37:08.103

是否使用赛门铁克防病毒软件？我有一台新机器的情况，只需按下 ALT-TAB 组合键就会导致我的机器在大约 50% 的时间里自发重启。当 Windows 重新启动时，它说我遇到了与驱动程序相关的问题。

我向我们的 IT 人员提到了它，他说是赛门铁克，他有一个可以修复它的更新。不用说这对我来说真的是一个硬件问题，所以我很怀疑。但他更新了我的赛门铁克安装，问题就消失了！

尝试禁用您的防病毒软件，看看它是否会消失一段时间。如果是这样，请查看您的防病毒供应商是否有更新

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-23T13:13:46.910

要检查 RAM 或硬盘驱动器的状态，请使用 UBCD（[链接](http://www.ultimatebootcd.com/)）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-02T07:08:21.883

[http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=329016](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=329016) [http://social.msdn.microsoft.com/forums/en-US/winforms/thread/879ab314-07b2-484e-989c -5661e5bc234a/](http://social.msdn.microsoft.com/forums/en-US/winforms/thread/879ab314-07b2-484e-989c-5661e5bc234a/) [https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=331888](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=331888)

我在 2008 年初遇到了同样的问题。我相信这是一个视频驱动程序问题。窗口中的数据表可能会以这种方式使窗口崩溃，这真是太神奇了。有很多关于这方面的报道，我认为这与硬件无关。微软不会接受它作为一个错误，因为他们无法重现它。虽然仍然是一个错误。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-19T15:01:40.613

内部 Visual Studio 2008 调试器崩溃。赛门铁克是罪魁祸首。删除 Symantec 服务解决了该系统的问题。认为这可能有助于其他在 VS2008 中看到奇怪崩溃的开发人员尝试禁用 Symantec AV 并在启动时停止服务。

# security - 用于安全文件传输的跨平台加密/解密应用程序

> ID：199459
> 
> 赞同：3
> 
> 时间：2008-10-13T23:46:08.540
> 
> 标签：security, encryption

我有一个客户需要在 Linux / Windows 2003 Server 之间使用基于文件的加密/解密应用程序。目标是在 linux 平台上每晚压缩单个文件，并使用脚本保护，通过 FTP 传输，在 Windows 2003 服务器上解密，并可用于其他导入例程，如 SSIS 等。

传输后文件在每一端都可以保持未加密，主要是为了在传输过程中保持文件的安全。防火墙规则和 IIS6 不支持 SFTP 的事实消除了 SFTP 作为一个选项。简单是这里的主要焦点，因此不能使用复杂的安全选项或重量级库。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T00:09:23.767

您可以尝试[GnuPG](http://gnupg.org/)，它是跨平台的，并且由于您只是在内部发送文件，因此您实际上并不需要由知名证书颁发机构签名的证书。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T09:12:57.427

当您需要将受保护的数据加载到SSIS 中时，您也可以使用我们的[OpenPGP 任务进行SSIS。](http://www.eldos.com/sbbsrv/ssis-pgp-task.php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T00:10:56.760

你可以看看 PGP：

[http://www.pgpi.org/doc/overview/](http://www.pgpi.org/doc/overview/)
[http://www.pgpi.org/products/pgp/versions/freeware/](http://www.pgpi.org/products/pgp/versions/freeware/)
[http://www.pgpi.org/doc/](http://www.pgpi.org/doc/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T14:23:32.683

对于 GnuPG，我会为电子邮件添加[Thawte](http://thawte.com)（或类似的）s/mime 密钥。

GnuPG 具有适用于每个主要平台的可执行文件，并且大多数电子邮件客户端都支持 s/mime 密钥进行加密。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-06T19:42:37.533

试试 R10Cipher。跨平台，384 位，处理文本和文件， *非常*易于使用且价格低廉 [http://www.r10cipher.com](http://www.r10cipher.com)

免责声明：它是由我的公司 Arten Science 生产的。

# .net - Silverlight 2.0 为业务线应用做好准备

> ID：199461
> 
> 赞同：4
> 
> 时间：2008-10-13T23:46:32.707
> 
> 标签：.net, asp.net, silverlight

现在 Silverlight 2.0 已经正式发布，我想知道是否有人将它用于任何业务应用程序，例如 POS、Vertical Market 应用程序等。如果是这样，与旧的 WinForms 应用程序或 Web 应用程序相比，您的体验如何？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-14T01:20:42.080

我认为 Silverlight 对于商业应用程序来说将是巨大的。这是一些要点，突出了 Silverlight 作为浏览器内的 LOB 平台的优势。这是我为帮助一位正在比较 ASP.NET 与 Silverlight 的同事而写的，但希望它包含一些提示。

**额外的 Silverlight 功能**

*   您现在可以使用独立存储对静态数据进行离线缓存 - 只需将您的数据序列化为 JSON 或 XML 并将其保存在本地。
*   对 UX 的更强大工具支持 - 使用 jQuery，您将手动编写所有额外的 UX。不知道这是否有什么大不了的，因为 jQuery 真的很时尚。
*   C# over JavaScript - 更好的调试和开发人员体验。
*   支持多线程、跨域网络和套接字。
*   支持本地文件访问 - 假设您想要导入 CSV 文件而无需往返服务器。在 Silverlight 中，您可以使用 FileOpenDialog 并在本地读取文件内容。
*   易于移植到 WPF

**额外的 Silverlight 控件**

*   第一批带外 Silverlight 控件将在 PDC 上提供，包括以下控件：DockPanel、WrapPanel、ViewBox、Label、HeaderedContentControl、Expander、TreeView、NumericUpDown、AutoComplete、Accordion。
*   Scott Gu 暗示，如果算上 CodePlex 上发布的带外控件，Silverlight 可能会随着时间的推移获得 100 多个控件。
*   [在http://blogs.msdn.com/sburke/archive/2008/09/17/control-freak.aspx](http://blogs.msdn.com/sburke/archive/2008/09/17/control-freak.aspx)阅读更多内容

**WPF 可移植性**

*   有一些主要区别。将非 UI 代码移植到 WPF 应该相当简单。
*   如果您的样式不太有创意，也可以直接使用大多数控件端口。主要区别之一是 Silverlight 使用 VisualStateManager 而不是 Trigger 来设置控件样式。有一个社区项目可用于向 WPF 添加 VSM 支持，以便更轻松地移植应用程序。VSM 将被添加到未来的 WPF 版本中，以使两者更加成对。
*   您将能够重用大量知识、设计资产和代码。
*   我写了一篇关于将我的 Dive Log 应用程序（一个很小，但突出了一些问题）移植到 WPF 的博客文章：http: [//jonas.follesoe.no/PortingTheSilverlightDiveLogApplicationToWPF.aspx](http://jonas.follesoe.no/PortingTheSilverlightDiveLogApplicationToWPF.aspx)（在几个小时内完成了）。

**数据输入用户体验**

*   Silverlight 将使实施更复杂的客户端验证规则变得更加容易，从而使您的数据输入表单响应速度更快，而返回服务器的次数更少。您可以使用 AJAX 来做到这一点，但需要更多的努力。
*   使用 Silverlight，您可以发挥创意并增强您的数据输入表单，并在根据表单前面的选择启用/禁用表单的某些部分时添加漂亮的效果。
*   您可以为您的数据输入创建很酷的小部件。参考。您在潜水日志应用程序中设置 Air-In/Air-Out 的方式是通过更改气罐中的空气水平，而不仅仅是在文本框中键入一个值。

**可视化**

*   您可以使用 jQuery 动画 API 做很多很酷的事情 - 但 Silverlight 让使用动画、漂亮的可缩放矢量图形等制作丰富的 UI 变得更加容易。对于普通的 ASP.NET，您可能有更多的第三方控件/组件可供选择从，但对于简单的图表，Visifire 图表很棒。

**复制/粘贴/选择文本**

*   我不喜欢很难使文本可选择/可复制。
*   Silverlight 中的开箱即用打印体验也受到限制。它只会打印屏幕上的内容。我正在写一篇博文，展示如何在 Silverlight 组件后面生成 HTML 并使用 CSS 进行打印。

**搜索引擎优化**

*   猜猜这取决于您的客户要求。如果您的数据应该是可搜索的，您可以通过使用 ASPX 页面来绕过它，该页面在第一次加载时将数据呈现为 Silverlight 页面后面的 HTML。因此，您的站点将类似于 ShowCustomer.aspx?CustomerID=10 - Silverlight 将在表单中显示客户 10，并且在 Silverlight 组件后面有表示相同信息的 HTML。然后，您还需要提供一个站点地图文件，以便 Google 知道如何索引/查找您的页面内容。但这将是可行的。

    如果您的应用程序非常“类似于应用程序”，则可能没有意义，因为很难为应用程序的不同状态创建 URL。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T20:32:23.650

Have a look at this [series of articles](http://www.silverlightshow.net/news/Welcome-Chris.aspx) by Chris Anderson - I know the fella and he's very into this at the moment. He is developing his own business platform on Silverlight.

Edit: Have a look at this MSDN article too: [Create Data-Centric Web Applications With Silverlight 2](http://msdn.microsoft.com/en-us/magazine/cc794279.aspx)

# c# - C# Image.Clone 内存不足异常

> ID：199468
> 
> 赞同：54
> 
> 时间：2008-10-13T23:48:05.353
> 
> 标签：c#, image, exception

为什么我会出现内存不足异常？

所以这在 C# 中第一次通过：

**splitBitmaps.Add(neededImage.Clone(rectDimensions, requiredImage.PixelFormat));**

其中 splitBitmaps 是 List<BitMap> 但它在 VB 中至少可以迭代 4 次：

**arlSplitBitmaps.Add(Image.Clone(rectDimensions, Image.PixelFormat))**

其中 arlSplitBitmaps 是一个简单的数组列表。（是的，我在 C# 中尝试过 arraylist）

这是全文：

```
for (Int32 splitIndex = 0; splitIndex <= numberOfResultingImages - 1; splitIndex++)
{ 
  Rectangle rectDimensions;

  if (splitIndex < numberOfResultingImages - 1) 
  {
    rectDimensions = new Rectangle(splitImageWidth * splitIndex, 0, 
      splitImageWidth, splitImageHeight); 
  } 
  else 
  {
    rectDimensions = new Rectangle(splitImageWidth * splitIndex, 0, 
     sourceImageWidth - (splitImageWidth * splitIndex), splitImageHeight); 
  } 

  splitBitmaps.Add(neededImage.Clone(rectDimensions, neededImage.PixelFormat)); 
```

}

顺便说一下，needImage 是一个位图。

我在 intarweb 上找不到任何有用的答案，尤其是为什么它在 VB 中工作得很好。

**更新：**

我实际上找到了这个工作的原因（某种），但忘了发布它。如果我记得的话，它与将图像转换为位图有关，而不是仅仅尝试克隆原始图像。

* * *

## 回答 #1

> 赞同：172
> 
> 时间：2009-03-17T15:54:46.853

当 Rectangle 中指定的坐标超出位图边界时，Clone() 也可能引发内存不足异常。它不会自动为您剪辑它们。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2014-02-07T09:43:18.407

我发现我正在使用 Image.Clone 裁剪位图，并且宽度使裁剪超出了原始图像的范围。这会导致内存不足错误。似乎有点奇怪，但值得了解。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-01-22T10:37:26.097

当我尝试使用 Clone() 方法更改位图的像素格式时，我也得到了这个。如果没记错的话，我试图将 24 bpp 位图转换为 8 位索引格式，天真地希望 Bitmap 类能够神奇地处理调色板的创建等等。明显不是 ：-/

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-14T00:38:29.387

这是一个范围，但我经常发现，如果直接从磁盘中提取图像，最好将它们复制到新的位图并处理磁盘绑定的图像。这样做时，我已经看到内存消耗有了很大的改善。

Dave M. 也在赚钱……完成后一定要处理掉。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-03-13T04:10:20.880

我最近很难弄清楚这一点 - 上面的答案是正确的。解决这个问题的关键是确保矩形实际上在图像的边界内。请参阅我如何解决此问题的示例。

简而言之，检查被克隆的区域是否在图像区域之外。

```
int totalWidth = rect.Left + rect.Width; //think -the same as Right property

int allowableWidth = localImage.Width - rect.Left;
int finalWidth = 0;

if (totalWidth > allowableWidth){
   finalWidth = allowableWidth;
} else {
   finalWidth = totalWidth;
}

rect.Width = finalWidth;

int totalHeight = rect.Top + rect.Height; //think same as Bottom property
int allowableHeight = localImage.Height - rect.Top;
int finalHeight = 0;

if (totalHeight > allowableHeight){
   finalHeight = allowableHeight;
} else {
   finalHeight = totalHeight;
}

rect.Height = finalHeight;
cropped = ((Bitmap)localImage).Clone(rect,    System.Drawing.Imaging.PixelFormat.DontCare); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-13T23:59:13.133

确保您在图像上正确调用 .Dispose() ，否则不会释放非托管资源。我想知道您实际上在这里创建了多少张图片——数百张？数千？

# svn - 使用 'svn mv' 在 bash 中将目录中的每个文件大写

> ID：199469
> 
> 赞同：6
> 
> 时间：2008-10-13T23:48:31.907
> 
> 标签：svn, shell, file, batch-file, rename

我需要更改颠覆工作副本中一组文件的大小写，如下所示：

```
svn mv test.txt 测试.txt
svn mv test2.txt Test2.txt
svn mv testn.txt Testn.txt
...
svn commit -m "大写"

```

我怎样才能自动化这个过程？提供标准的 linux 安装工具。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-14T00:08:57.777

ls | awk '{system("svn mv " $0 " " toupper(substr($0,1,1)) substr($0,2))}'

显然，其他脚本语言也可以正常工作。awk 的优势在于它无处不在。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T00:05:07.333

如果你有一个不错的安装，你应该有 python，试试这个：

```
#!/usr/bin/python
from os import rename, listdir
path = "/path/to/folder"
try:
    dirList = listdir(path)
except:
    print 'There was an error while trying to access the directory: '+path
for name in dirList:
    try:
        rename(path+'\\'+name, path+'\\'+name.upper())
    except:
        print 'Process failed for file: '+name 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T00:09:47.697

我认为使用 bash/sed/tr/find 没有简单的方法来做到这一点。

我会制作一个 Ruby/Perl 脚本来进行重命名。

```
 #!/usr/bin/ruby 
 #  Upcase.rb 
 ARGV.each{ |i|
  newname = i.gsub(/(^.|\s.)/{ |x| x.upcase }
  `svn mv "#{i}" "#{newname}" `
 } 
```

然后就做

```
 ./Upcase.rb foo.txt test.txt test2.txt foo/bar/test.txt 
```

或者如果你想做一个完整的目录

```
 find ./ -exec ./Upcase.rb {} + 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T00:41:26.693

请注意，此更改会破坏 Windows 和 Mac 系统上的现有工作副本，因为它们无法处理仅大小写重命名。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T23:53:14.393

我通常通过将“ls”输出重定向到一个文件来做到这一点，使用 vim 宏将每个文件名按摩到我想要的命令行中，然后将文件作为 shell 脚本执行。它很粗糙但很有效。

# c# - int.Parse() 和 Convert.ToInt32 之间的主要区别是什么

> ID：199470
> 
> 赞同：550
> 
> 时间：2008-10-13T23:48:33.857
> 
> 标签：c#

*   `int.Parse()`和之间的主要区别是什么`Convert.ToInt32()`？
*   哪个是首选

* * *

## 回答 #1

> 赞同：489
> 
> 时间：2008-10-13T23:53:09.133

*   如果您有一个字符串，并且您希望它始终是一个整数（例如，如果某个 Web 服务正在向您提供字符串格式的整数），您将使用[**`Int32.Parse()`**](http://msdn.microsoft.com/en-us/library/system.int32.parse.aspx).

*   如果您从用户那里收集输入，您通常会使用[**`Int32.TryParse()`**](http://msdn.microsoft.com/en-us/library/system.int32.tryparse.aspx)，因为它允许您更细粒度地控制用户输入无效输入时的情况。

*   [**`Convert.ToInt32()`**](http://msdn.microsoft.com/en-us/library/System.Convert.ToInt32.aspx)接受一个对象作为它的参数。（有关其工作原理，请参见 Chris S 的回答）

    `Convert.ToInt32()``ArgumentNullException`当它的参数为 null 时也不会抛出`Int32.Parse()`。这也意味着这`Convert.ToInt32()`可能比 慢一点`Int32.Parse()`，尽管在实践中，除非您在循环中进行大量迭代，否则您永远不会注意到它。

* * *

## 回答 #2

> 赞同：212
> 
> 时间：2008-10-14T14:32:23.667

看看反光板：

**int.Parse("32"):**

```
public static int Parse(string s)
{
    return System.Number.ParseInt32(s, NumberStyles.Integer, NumberFormatInfo.CurrentInfo);
} 
```

这是一个呼吁：

```
internal static unsafe int ParseInt32(string s, NumberStyles style, NumberFormatInfo info)
{
    byte* stackBuffer = stackalloc byte[1 * 0x72];
    NumberBuffer number = new NumberBuffer(stackBuffer);
    int num = 0;
    StringToNumber(s, style, ref number, info, false);
    if ((style & NumberStyles.AllowHexSpecifier) != NumberStyles.None)
    {
        if (!HexNumberToInt32(ref number, ref num))
        {
            throw new OverflowException(Environment.GetResourceString("Overflow_Int32"));
        }
        return num;
    }
    if (!NumberToInt32(ref number, ref num))
    {
        throw new OverflowException(Environment.GetResourceString("Overflow_Int32"));
    }
    return num;
} 
```

**转换.ToInt32("32"):**

```
public static int ToInt32(string value)
{
    if (value == null)
    {
        return 0;
    }
    return int.Parse(value, CultureInfo.CurrentCulture);
} 
```

正如第一个（戴夫 M 的）评论所说。

* * *

## 回答 #3

> 赞同：90
> 
> 时间：2008-10-13T23:52:39.027

没有区别。内部
`Convert.ToInt32()`调用`int.Parse()`

当参数为时`Convert.ToInt32()`返回一件事`0``null`

否则两者的工作方式相同

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2016-03-07T07:13:17.380

# int.Parse(string s)

*   RANGE 中的整数 > 返回整数值
*   空值 > ArguementNullException
*   不在格式中 > FormatException
*   值不在范围内 > OverflowException

# Convert.ToInt32(string s)

*   RANGE 中的整数 > 返回整数值
*   空值 > 返回“0”
*   不在格式中 > FormatException
*   值不在范围内 > OverflowException

# bool isParsed = int.TryParse(string s,out res)

*   Integer in RANGE > 返回整数值，isParsed = true
*   空值 > 返回“0”，isParsed = false
*   不是格式 > 返回“0”，isParsed = false
*   不在 RANGE 中的值 > 返回“0”，isParsed = false

试试下面的代码.....

```
class Program
{
    static void Main(string[] args)
    {
        string strInt = "24532";
        string strNull = null;
        string strWrongFrmt = "5.87";
        string strAboveRange = "98765432123456";
        int res;
        try
        {
            // int.Parse() - TEST
            res = int.Parse(strInt); // res = 24532
            res = int.Parse(strNull); // System.ArgumentNullException
            res = int.Parse(strWrongFrmt); // System.FormatException
            res = int.Parse(strAboveRange); // System.OverflowException

            // Convert.ToInt32(string s) - TEST
            res = Convert.ToInt32(strInt); // res = 24532
            res = Convert.ToInt32(strNull); // res = 0
            res = Convert.ToInt32(strWrongFrmt); // System.FormatException
            res = Convert.ToInt32(strAboveRange); //System.OverflowException

            // int.TryParse(string s, out res) - Test
            bool isParsed;
            isParsed = int.TryParse(strInt, out res); // isParsed = true, res = 24532
            isParsed = int.TryParse(strNull, out res); // isParsed = false, res = 0
            isParsed = int.TryParse(strWrongFrmt, out res); // isParsed = false, res = 0
            isParsed = int.TryParse(strAboveRange, out res); // isParsed = false, res = 0 
        }
        catch(Exception e)
        {
            Console.WriteLine("Check this.\n" + e.Message);
        }
    } 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2008-10-14T00:21:14.117

区别在于：

`Int32.Parse()`并且`Int32.TryParse()`只能转换字符串。`Convert.ToInt32()`可以采用任何实现`IConvertible`. 如果您将字符串传递给它，那么它们是等效的，除了您会在类型比较等方面获得额外的开销。如果您正在转换字符串，那么`TryParse()`可能是更好的选择。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-10-13T23:56:43.573

TryParse 更快...

> 第一个函数 Parse 是任何 .Net 开发人员都应该熟悉的。此函数将获取一个字符串并尝试从中提取一个整数，然后返回该整数。如果遇到无法解析的问题，则会引发 FormatException，或者如果数字太大，则会引发 OverflowException。此外，如果您将 null 值传递给它，它可能会抛出 ArgumentException。
> 
> TryParse 是新的 .Net 2.0 框架的新增功能，它解决了原始 Parse 函数的一些问题。主要区别在于异常处理非常慢，因此如果 TryParse 无法解析字符串，它不会像 Parse 那样抛出异常。相反，它返回一个布尔值，指示它是否能够成功解析一个数字。因此，您必须将要解析的字符串和要填充的 Int32 输出参数都传递给 TryParse。我们将使用分析器检查 TryParse 和 Parse 之间的速度差异，在字符串可以正确解析的情况下以及在以下情况下无法正确解析字符串。
> 
> Convert 类包含一系列将一个基类转换为另一个基类的函数。我相信 Convert.ToInt32(string) 只是检查空字符串（如果字符串为空，它返回零，不像 Parse）然后只调用 Int32.Parse(string)。我将使用分析器来确认这一点，并查看使用 Convert 而不是 Parse 是否对性能有任何实际影响。

[带有示例的来源](http://blogs.msdn.com/ianhu/archive/2005/12/19/505702.aspx)

希望这可以帮助。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2015-05-11T10:03:16.773

**Int32.parse(string)--->**

Int32.Parse (string s) 方法将数字的字符串表示形式转换为其等效的 32 位有符号整数。当 s 为空引用时，会抛出 ArgumentNullException。如果 s 不是整数值，则会抛出 FormatException。当 s 表示小于 MinValue 或大于 MaxValue 的数字时，会抛出 OverflowException。***例如***：

```
string s1 = "1234"; 
string s2 = "1234.65"; 
string s3 = null; 
string s4 = "123456789123456789123456789123456789123456789"; 

result = Int32.Parse(s1);    //1234
result = Int32.Parse(s2);    //FormatException
result = Int32.Parse(s3);    //ArgumentNullException 
result = Int32.Parse(s4);    //OverflowException 
```

**Convert.ToInt32(string) -->** Convert.ToInt32(string s) 方法将指定的字符串表示形式转换为等效的 32 位有符号整数。这又调用了 Int32.Parse() 方法。当 s 为空引用时，它将返回 0 而不是抛出 ArgumentNullException。如果 s 不是整数值，则会抛出 FormatException。当 s 表示小于 MinValue 或大于 MaxValue 的数字时，会抛出 OverflowException。

***例如：***

```
 result = Convert.ToInt32(s1);    // 1234 
 result = Convert.ToInt32(s2);    // FormatException
 result = Convert.ToInt32(s3);    // 0
 result = Convert.ToInt32(s4);    // OverflowException 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-05-10T05:54:14.263

```
Convert.ToInt32 
```

有 19 种重载或 19 种不同的调用方式。2010 版本中可能会更多。

它将尝试从以下类型转换；

> > 对象、布尔值、字符、SByte、字节、Int16、UInt16、Int32、UInt32、Int64、UInt64、单、双精度、十进制、字符串、日期

它还有许多其他方法；一种与数基有关，两种方法涉及`System.IFormatProvider`

另一方面，Parse 只有 4 个重载或 4 种不同的调用方法。

```
Integer.Parse( s As String)

Integer.Parse( s As String,  style As System.Globalization.NumberStyles )

Integer.Parse( s As String, provider As System.IFormatProvider )

Integer.Parse( s As String,  style As System.Globalization.NumberStyles, provider As System.IFormatProvider ) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-11-14T10:08:09.703

Convert.ToInt32 允许空值，它不会引发任何错误 Int.parse 不允许空值，它会引发 ArgumentNullException 错误。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-10-21T21:03:54.960

这取决于参数类型。例如，我今天刚刚发现它会使用它的 ASCII 值将 char 直接转换为 int。不完全是我想要的功能......

你被警告了！

```
public static int ToInt32(char value)
{
    return (int)value;
} 

Convert.ToInt32('1'); // Returns 49
int.Parse('1'); // Returns 1 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-02-15T05:38:17.057

这是`int.Parse`and的详细信息`Convert.ToInt32`：假设您有一个 char 数组，`char[] a=['1','2','3','4']`并且想要将每个元素转换为整数。`Convert.ToInt32(a[0])`会给你一个数字 49。它把它当作 ASCII 码会给`int.Parse(a[0])`你正确的输出是 1

如果你有一个字符串数组`string[] b=['1','2','3','4']`，那么`Convert.ToInt32`和`int.Parse`输出将没有区别。两者都返回正确的整数。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-08-03T05:16:37.037

为了澄清打开控制台应用程序，只需复制下面的代码并将其粘贴到 `static void Main(string[] args)`方法中，希望您能理解

```
public  class Program
    {
        static void Main(string[] args)
        { 
            int result;
            bool status;
            string s1 = "12345";
            Console.WriteLine("input1:12345");
            string s2 = "1234.45";
            Console.WriteLine("input2:1234.45");
            string s3 = null;
            Console.WriteLine("input3:null");
            string s4 = "1234567899012345677890123456789012345667890";
            Console.WriteLine("input4:1234567899012345677890123456789012345667890");
            string s5 = string.Empty;
            Console.WriteLine("input5:String.Empty");
            Console.WriteLine();
            Console.WriteLine("--------Int.Parse Methods Outputs-------------");
            try
            {
               result = int.Parse(s1);

               Console.WriteLine("OutPut1:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut1:"+ee.Message);
            }
            try
            {
              result = int.Parse(s2);

              Console.WriteLine("OutPut2:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut2:" + ee.Message);
            }
            try
            {
               result = int.Parse(s3);

               Console.WriteLine("OutPut3:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut3:" + ee.Message);
            }
            try
            {
                result = int.Parse(s4);

                Console.WriteLine("OutPut4:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut4:" + ee.Message);
            }

            try
            {
                 result = int.Parse(s5);

                 Console.WriteLine("OutPut5:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut5:" + ee.Message);
            }
            Console.WriteLine();
            Console.WriteLine("--------Convert.To.Int32 Method Outputs-------------");
            try
            {

                result=  Convert.ToInt32(s1);

                Console.WriteLine("OutPut1:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut1:" + ee.Message);
            }
            try
            {

                result = Convert.ToInt32(s2);

                Console.WriteLine("OutPut2:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut2:" + ee.Message);
            }
            try
            {

         result = Convert.ToInt32(s3);

         Console.WriteLine("OutPut3:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut3:" + ee.Message);
            }
            try
            {

                  result = Convert.ToInt32(s4);

                  Console.WriteLine("OutPut4:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut4:" + ee.Message);
            }

            try
            {

                 result = Convert.ToInt32(s5);

                 Console.WriteLine("OutPut5:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut5:" + ee.Message);
            }

            Console.WriteLine();
            Console.WriteLine("--------TryParse Methods Outputs-------------");
            try
            {

                status = int.TryParse(s1, out result);
                Console.WriteLine("OutPut1:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut1:" + ee.Message);
            }
            try
            {

                status = int.TryParse(s2, out result);
                Console.WriteLine("OutPut2:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut2:" + ee.Message);
            }
            try
            {

                status = int.TryParse(s3, out result);
                Console.WriteLine("OutPut3:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut3:" + ee.Message);
            }
            try
            {

                status = int.TryParse(s4, out result);
                Console.WriteLine("OutPut4:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut4:" + ee.Message);
            }

            try
            {

                status = int.TryParse(s5, out result);
                Console.WriteLine("OutPut5:" + result);
            }
            catch (Exception ee)
            {
                Console.WriteLine("OutPut5:" + ee.Message);
            }

            Console.Read();
        }
    } 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-03-27T15:06:43.867

Parse() 方法提供了不能用于​​ Convert() 的数字样式。例如：

```
int i;
bool b = int.TryParse( "123-",
           System.Globalization.NumberStyles.AllowTrailingSign,
           System.Globalization.CultureInfo.InvariantCulture,
           out i); 
```

would parse the numbers with trailing sign so that i == -123
The trailing sign is popular in ERP systems.

# database - SQL Server 命令 LIKE [0-9] 不会匹配 0 到 9 之间的任何数字

> ID：199483
> 
> 赞同：1
> 
> 时间：2008-10-13T23:53:02.910
> 
> 标签：database, sql-server-2005, debugging

这是我对客户表的约束。

```
ALTER TABLE Customers
    ADD CONSTRAINT CN_CustomerPhone
    CHECK (Phone LIKE '([0-9][0-9][0-9]) [0-9][0-9][0-9]-[0-9][0-9][0-9][0-9]') 
```

为什么会失败？

```
INSERT INTO Customers
(CustomerName, Address, City, State, Zip, Phone)
VALUES
('Some Name','An Address', 'City goes here', 'WI', 12345, '(800) 555-1212') 
```

带有此错误消息。

> 消息 547，级别 16，状态 0，第 1 行 INSERT 语句与 CHECK 约束“CN_CustomerPhoneNo”冲突。冲突发生在数据库“会计”、表“dbo.Customers”、“电话”列中。该语句已终止。

我确定我错过了一些非常简单的东西，但我找不到它。

我尝试将约束简化为仅 'Phone LIKE '[0-9]'' 并插入一个数字，但它仍然失败。怎么回事？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T00:00:17.980

检查电话字段的长度。
是 15 个或更多字符吗？

在此处将您的代码与临时表一起使用

```
 create table #temp
(phone varchar(15))

ALTER TABLE #temp
    ADD CONSTRAINT CN_CustomerPhone
    CHECK (Phone LIKE '([0-9][0-9][0-9]) [0-9][0-9][0-9]-[0-9][0-9][0-9][0-9]')

INSERT INTO #temp
(Phone)
VALUES
('(800) 555-1212')

select * from #temp

drop table #temp 

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T00:00:38.200

我是个白痴，该字段被声明为 nchar，我没有考虑填充空间。

# perl - 为什么回滚方法不能用于 DBI 句柄？

> ID：199488
> 
> 赞同：4
> 
> 时间：2008-10-13T23:54:13.080
> 
> 标签：perl, module, dbi, rollback

出于某种原因，我在使用 DBI 句柄时遇到了麻烦。基本上发生的事情是我在 perl 模块中创建了一个特殊的连接函数并从执行以下操作切换：

```
do 'foo.pl' 
```

到

```
use Foo; 
```

然后我做

```
$dbh = Foo->connect; 
```

现在由于某种原因，我不断收到错误消息：

> 无法通过 ../Foo.pm 第 171 行的包“Foo”找到对象方法“回滚”。

所以奇怪的是 $dbh 绝对不是 Foo，它只是在 foo 中定义的。无论如何，到目前为止，我还没有遇到任何麻烦。有什么想法吗？

**编辑**：@Axeman：`connect`原版中不存在。在我们刚刚使用这样的字符串之前：

```
do 'foo.pl';
$dbh = DBI->connect($DBConnectString); 
```

`connect`像这样的东西

```
sub connect {
    my $dbh = DBI->connect('blah');
    return $dbh;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T11:08:55.527

We need to see the actual code in Foo to be able to answer this. You probably want to read [Subclassing the DBI](http://search.cpan.org/dist/DBI/DBI.pm#Subclassing_the_DBI) from the documentation to see how to do this properly.

Basically, you either need Foo to subclass DBI properly (again, you'll need to read the docs), or you need to declare a connect function to properly delegate to the DBI::connect method. Be careful about writing a producedural wrapper for OO code, though. It gets awfully hard to maintain state that way.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T00:55:17.933

从[perlfunc](http://perldoc.perl.org/perlfunc.html#do-EXPR)：

> ```
>         做'stat.pl'；
> 
>     就像
> 
>         评估`cat stat.pl`;
> 
> ```

因此，当您 时`do 'foo.pl'`，您在当前上下文中执行代码。因为我不知道`foo.pl`or中发生了什么`Foo.pm`，所以我无法告诉你发生了什么变化。但是，我可以告诉你，它总是在当前上下文中执行，现在在`Foo::`命名空间中执行。

你调用它的方式，你`'Foo'`作为第一个参数传递给`Foo::connect`或返回的子从`Foo->can('connect')`。似乎以某种方式将其传递给一些认为它是数据库句柄的代码，并且告诉该对象`rollback`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-14T04:30:57.077

我同意斧头人。您可能应该使用调用您的函数

```
use Foo;
...
$dbh = Foo::connect(); 
```

而不是 Foo->connect();

# php - 使用php将mysql数据导出到ODF

> ID：199489
> 
> 赞同：1
> 
> 时间：2008-10-13T23:54:29.147
> 
> 标签：php, mysql, openoffice.org, odf, opendocument

我想知道是否有人尝试将数据从 MySQL 导出为 ODF 格式？

任何信息/文件将不胜感激。

如果可能，我将尝试将 MySQL 结果集导出到 ODF 电子表格。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T20:10:38.087

你可以试试看这个：[http ://www.phpclasses.org/browse/package/4398.html](http://www.phpclasses.org/browse/package/4398.html)

但是查看源代码看起来并不好，并且有很多硬编码的 xml 字符串

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-11T00:15:19.603

使用 PHP 创建 OOo 文件的另一个选项是[tbsOOo](http://www.tinybutstrong.com/tbsooo.php)；但是，它主要是一个模板引擎。

> 此类允许通过将显示格式与逻辑和数据分开来动态创建 OpenOffice 文档。实际上，您使用带有 TinyButStrong 标签的 OpenOffice 创建模板。然后创建一个 PHP 脚本，将模板与数据源合并以获取新的 OpenOffice 文档。

还有：[OpenDocument PHP](http://sourceforge.net/projects/opendocumentphp/)，它更复杂，可以动态创建文件。

# database - Foreign Key naming scheme

> ID：199498
> 
> 赞同：176
> 
> 时间：2008-10-13T23:59:32.257
> 
> 标签：database, naming-conventions, foreign-keys

I'm just getting started working with foreign keys for the first time and I'm wondering if there's a standard naming scheme to use for them?

Given these tables:

```
task (id, userid, title)
note (id, taskid, userid, note);
user (id, name) 
```

Where Tasks have Notes, Tasks are owned by Users, and Users author Notes.

How would the three foreign keys be named in this situation? Or alternatively, *does it even matter at all*?

*Update*: This question is about foreign key names, not field names!

* * *

## 回答 #1

> 赞同：202
> 
> 时间：2008-10-14T00:21:37.487

The standard convention in SQL Server is:

```
FK_ForeignKeyTable_PrimaryKeyTable 
```

So, for example, the key between notes and tasks would be:

```
FK_note_task 
```

And the key between tasks and users would be:

```
FK_task_user 
```

This gives you an 'at a glance' view of which tables are involved in the key, so it makes it easy to see which tables a particular one (the first one named) depends on (the second one named). In this scenario the complete set of keys would be:

```
FK_task_user
FK_note_task
FK_note_user 
```

So you can see that tasks depend on users, and notes depend on both tasks and users.

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-10-14T07:28:14.503

I use two underscore characters as delimiter i.e.

```
fk__ForeignKeyTable__PrimaryKeyTable 
```

This is because table names will occasionally contain underscore characters themselves. This follows the naming convention for constraints generally because data elements' names will frequently contain underscore characters e.g.

```
CREATE TABLE NaturalPersons (
   ...
   person_death_date DATETIME, 
   person_death_reason VARCHAR(30) 
      CONSTRAINT person_death_reason__not_zero_length
         CHECK (DATALENGTH(person_death_reason) > 0), 
   CONSTRAINT person_death_date__person_death_reason__interaction
      CHECK ((person_death_date IS NULL AND person_death_reason IS NULL)
              OR (person_death_date IS NOT NULL AND person_death_reason IS NOT NULL))
        ... 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-14T00:02:48.087

How about `FK_TABLENAME_COLUMNNAME`?

**K**eep **I**t **S**imple **S**tupid whenever possible.

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2014-07-14T05:22:11.633

A note from Microsoft concerning SQL Server:

> A FOREIGN KEY constraint does not have to be linked only to a PRIMARY KEY constraint in another table; it can also be defined to reference the columns of a UNIQUE constraint in another table.

so, I'll use terms describing dependency instead of the conventional primary/foreign relationship terms.

When referencing the PRIMARY KEY of the *independent (parent)* table by the similarly named column(s) in the *dependent (child)* table, I omit the column name(s):

```
FK_ChildTable_ParentTable 
```

When referencing other columns, or the column names vary between the two tables, or just to be explicit:

```
FK_ChildTable_childColumn_ParentTable_parentColumn 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-14T00:03:56.600

I usually just leave my PK named id, and then concatenate my table name and key column name when naming FKs in other tables. I never bother with camel-casing, because some databases discard case-sensitivity and simply return all upper or lower case names anyway. In any case, here's what my version of your tables would look like:

```
task (id, userid, title);
note (id, taskid, userid, note);
user (id, name); 
```

Note that I also name my tables in the singular, because a row represents one of the objects I'm persisting. Many of these conventions are personal preference. I'd suggest that it's more important to choose a convention and always use it, than it is to adopt someone else's convention.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2016-02-17T23:49:46.627

This is probably over-kill, but it works for me. It helps me a great deal when I am dealing with VLDBs especially. I use the following:

```
CONSTRAINT [FK_ChildTableName_ChildColName_ParentTableName_PrimaryKeyColName] 
```

Of course if for some reason you are not referencing a primary key you must be referencing a column contained in a unique constraint, in this case:

```
CONSTRAINT [FK_ChildTableName_ChildColumnName_ParentTableName_ColumnInUniqueConstaintName] 
```

Can it be long, yes. Has it helped keep info clear for reports, or gotten me a quick jump on that the potential issue is during a prod-alert 100% would love to know peoples thoughts on this naming convention.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-01-28T01:30:20.023

My usual approach is

```
FK_ColumnNameOfForeignKey_TableNameOfReference_ColumnNameOfReference 
```

Or in other terms

```
FK_ChildColumnName_ParentTableName_ParentColumnName 
```

This way I can name two foreign keys that reference the same table like a `history_info table` with `column actionBy and actionTo` from `users_info` table

It will be like

```
FK_actionBy_usersInfo_name - For actionBy
FK_actionTo_usersInfo_name - For actionTo 
```

**Note that:**

I didn't include the child table name because it seems common sense to me, I am in the table of the child so I can easily assume the child's table name. **The total character of it is 26 and fits well to the 30 character limit of oracle** which was stated by Charles Burns on a comment [here](https://stackoverflow.com/q/199498/2947415)

> Note for readers: Many of the best practices listed below do not work in Oracle because of its 30 character name limit. A table name or column name may already be close to 30 characters, so a convention combining the two into a single name requires a truncation standard or other tricks. – Charles Burns

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-03-26T21:13:30.567

Based on the answers and comments here, a naming convention which includes the FK table, FK field, and PK table (FK_FKTbl_FKCol_PKTbl) should avoid FK constraint name collisions.

So, for the given tables here:

```
fk_task_userid_user
fk_note_userid_user 
```

So, if you add a column to track who last modified a task or a note...

```
fk_task_modifiedby_user
fk_note_modifiedby_user 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2014-08-16T04:51:23.793

If you aren't referencing your FK's that often and using MySQL (and InnoDB) then you can just let MySQL name the FK for you.

At a later time you can [find the FK name you need by running a query](https://stackoverflow.com/a/25336979/1048805).

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2018-06-05T23:26:41.787

Try using upper-cased Version 4 UUID with first octet replaced by FK and '_' (underscore) instead of '-' (dash).

E.g.

*   `FK_4VPO_K4S2_A6M1_RQLEYLT1VQYV`
*   `FK_1786_45A6_A17C_F158C0FB343E`
*   `FK_45A5_4CFA_84B0_E18906927B53`

Rationale is the following

*   Strict generation algorithm => **uniform names**;
*   **Key length is less than 30 characters**, which is naming length limitation in Oracle (before 12c);
*   If your entity name changes you **don't need to rename your FK** like in entity-name based approach (if DB supports table rename operator);
*   One would seldom use foreign key constraint's name. E.g. DB tool usually shows what the constraint applies to. No need to be afraid of cryptic look, because you can avoid using it for "decryption".

# java - 我可以在这里使用什么描述性变量名称？

> ID：199499
> 
> 赞同：3
> 
> 时间：2008-10-13T23:59:45.080
> 
> 标签：java, variables, struts, html-select

我正在创建一个自定义 Java Struts 标记，用于以标准化方式构建和格式化 html 选择框（我们的可用性指南的一部分）。

每个选择框都有一个附加/初始值，它描述了选择元素返回值的要求，即：

*   *强制性*- 带有“请选择”标签
*   *可选*- “未选择”
*   *全选*- “全选”

自定义标记将具有一个属性，该属性控制要使用哪些。

所以问题是，我需要想出一个可以充分解释的变量名，它持有这三个值之一！
无论如何我都会评论代码，但我希望同事不必查找源代码来记住标记变量的用途。

**编辑：**为了解决这个问题，我在这里实施的可用性策略是，如果可以选择的项目超过 5 个，则选项应显示为选择框。5 个或更少的项目将显示为单选按钮。
使用单选按钮时，不会显示强制标签（如果没有选择任何值，表单验证会报错）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T00:30:35.033

**注意：请参阅下面的编辑以获取与此处给出的方法不同的方法**

怎么样`requirementConstraint`？

```
<my:customSelect requirementConstraint="Mandatory">
   <option value="1">A</option>
   <option value="2">B</option>
   <option value="3">C</option>
</my:customSelect> 
```

另一种可能性是首先不要对价值进行三态化。例如，您可以改为提供两个单独的属性：( `required`)`"yes" | "no"`和`selectAll`( `"yes" | "no"`) 以使意图更清晰。

* * *

**编辑**：实际上，如果我正确理解您的要求，我可以看到三态仍然有用。另一种可能性是调用属性`mustSelect`并设置允许的值`one`（强制）、`any`（可选）和`all`（全选）。此外，由于“全选”是可能的，我假设您的`customSelect`标签将每个选项呈现为一个复选框。如何使用的示例`mustSelect`：

**强制性（至少一项）**

```
<my:customSelect mustSelect="one">
   <option value="1">A</option>
   <option value="2">B</option>
   <option value="3">C</option>
</my:customSelect> 
```

**可选（零个或多个）**

```
<my:customSelect mustSelect="any">
   <option value="1">A</option>
   <option value="2">B</option>
   <option value="3">C</option>
</my:customSelect> 
```

**全选**

```
<my:customSelect mustSelect="all">
   <option value="1">A</option>
   <option value="2">B</option>
   <option value="3">C</option>
</my:customSelect> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T00:04:50.687

“多重性”似乎是正确的名称。

看起来您正在描述以下值：

必填：1 可选：0+ 全选：n

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T00:35:58.423

这是一个有趣的问题。我以前一定遇到过很多次这种情况，但从来没有这样想过。

您的问题是您的编程语言支持双向选项（例如零或一）比三向选项（零一或多）好得多。“自然”出现的速记一般是编程语言出现的速记，所以三向选项没有“自然”的速记。

本着 KISS* 的精神，我建议您将“ZeroOneOrMany”附加到属性名称中。

* * *

[*] 保持简单，愚蠢！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T00:14:48.450

**选择性**

Mandatory/Optional 似乎是一个布尔值，这是否是一个可选字段。

Select All 几乎看起来不相关，可能是它自己的属性。

# oracle - How do I show running processes in Oracle DB?

> ID：199508
> 
> 赞同：66
> 
> 时间：2008-10-14T00:04:52.810
> 
> 标签：oracle, process

Is it possible to show other processes in progress on an Oracle database? Something like Sybases `sp_who`

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-10-14T00:28:27.473

I suspect you would just want to grab a few columns from V$SESSION and the SQL statement from V$SQL. Assuming you want to exclude the background processes that Oracle itself is running

```
SELECT sess.process, sess.status, sess.username, sess.schemaname, sql.sql_text
  FROM v$session sess,
       v$sql     sql
 WHERE sql.sql_id(+) = sess.sql_id
   AND sess.type     = 'USER' 
```

The outer join is to handle those sessions that aren't currently active, assuming you want those. You could also get the sql_fulltext column from V$SQL which will have the full SQL statement rather than the first 1000 characters, but that is a CLOB and so likely a bit more complicated to deal with.

Realistically, you probably want to look at everything that is available in V$SESSION because it's likely that you can get a lot more information than SP_WHO provides.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-14T00:11:40.253

After looking at sp_who, Oracle does not have that ability per se. Oracle has at least 8 processes running which run the db. Like RMON etc.

You can ask the DB which queries are running as that just a table query. Look at the V$ tables.

Quick Example:

```
SELECT sid,
       opname,
       sofar,
       totalwork,
       units,
       elapsed_seconds,
       time_remaining
FROM v$session_longops
WHERE sofar != totalwork; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-07-25T01:03:28.753

This one shows SQL that is currently "ACTIVE":-

```
select S.USERNAME, s.sid, s.osuser, t.sql_id, sql_text
from v$sqltext_with_newlines t,V$SESSION s
where t.address =s.sql_address
and t.hash_value = s.sql_hash_value
and s.status = 'ACTIVE'
and s.username <> 'SYSTEM'
order by s.sid,t.piece
/ 
```

This shows locks. Sometimes things are going slow, but it's because it is blocked waiting for a lock:

```
select
  object_name, 
  object_type, 
  session_id, 
  type,         -- Type or system/user lock
  lmode,        -- lock mode in which session holds lock
  request, 
  block, 
  ctime         -- Time since current mode was granted
from
  v$locked_object, all_objects, v$lock
where
  v$locked_object.object_id = all_objects.object_id AND
  v$lock.id1 = all_objects.object_id AND
  v$lock.sid = v$locked_object.session_id
order by
  session_id, ctime desc, object_name
/ 
```

This is a good one for finding long operations (e.g. full table scans). If it is because of lots of short operations, nothing will show up.

```
COLUMN percent FORMAT 999.99 

SELECT sid, to_char(start_time,'hh24:mi:ss') stime, 
message,( sofar/totalwork)* 100 percent 
FROM v$session_longops
WHERE sofar/totalwork < 1
/ 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-07-30T16:47:15.703

Keep in mind that there are processes on the database which may not currently support a session.

If you're interested in all processes you'll want to look to v$process (or gv$process on RAC)

# windows-xp - 如何以编程方式添加映射网络密码（WinXP）？

> ID：199518
> 
> 赞同：2
> 
> 时间：2008-10-14T00:09:15.500
> 
> 标签：windows-xp

在 WinXP (SP2) 中，您可以存储映射的网络密码...

开始->控制面板->用户帐户->选择一个然后从相关任务中选择“管理我的网络密码”。

我通常有大约 25-30 台服务器以这种方式映射到几个不同的帐户/域。问题是在我们的政策更新过程中的某个时候，它们会被清除掉，而将它们全部重新添加回来是一个真正的 PITA。

有谁知道如何使用某种脚本以编程方式添加它们？

澄清一下，最终目标不是映射驱动器，而是实际创建该部分中的条目。这允许我们使用 Windows 身份验证连接到我们的服务器（通过 Dameware、SSMS 等）。

**附录：**

Mark 的 CredWrite 提示将我带到了这里……

[pinvoke.net -- CredWrite (advapi32)](http://www.pinvoke.net/default.aspx/advapi32/CredWrite.html)

这反过来又把我带到了这里……

[Peer Channel Blog -- 应用程序密码安全](http://blogs.msdn.com/peerchan/pages/487834.aspx)

两者都被证明非常有帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T01:57:39.820

*   [cmdkey.exe](http://technet.microsoft.com/en-us/library/cc754243.aspx)是该工具的 CLI 版本 - 但我相信它只包含在 Win2003+ 中。我怀疑 XP 的副本会起作用 - 但可能会违反您的 EULA。
*   [net use](http://technet.microsoft.com/en-us/library/bb490717.aspx)也有一个 savecred 选项，如果你正在映射驱动器
*   根据这个[相当详细的信息](http://www.oxid.it/ca_um/topics/credential_manager_password_decoder.htm)，CredMgr 将其数据库存储在 2 个位置。只需备份这些文件就足够了：
    *   %APPDATA%\Microsoft\Credentials\%UserSID%\Credentials
    *   %USERPROFILE%\Local Settings\Application Data\Microsoft\Credentials\%UserSID%\Credentials
*   有一个 API 可以读取凭据，[CredEnumerate](http://msdn.microsoft.com/en-us/library/aa374794(VS.85).aspx) - 但没有直接明显的方法来添加您自己的。几个候选人：
    *   [CredWrite](http://msdn.microsoft.com/en-us/library/aa375187(VS.85).aspx)采用正常的[CREDENTIAL](http://msdn.microsoft.com/en-us/library/aa374788(VS.85).aspx)，但没有任何内容表明存储超过当前会话。
    *   [CredUIStoreSSOCredW](http://msdn.microsoft.com/en-us/library/aa375181(VS.85).aspx)采用 bPersist 参数 - 但指定“领域”而不是服务器或网络位置。

Edit: D'oh. I missed the PERSIST member of [CREDENTIAL](http://msdn.microsoft.com/en-us/library/aa374788(VS.85).aspx). It can be one of the following values:

*   `CRED_PERSIST_SESSION`: The credential persists for the life of the logon session. It will not be visible to other logon sessions of this same user. It will not exist after this user logs off and back on.
*   `CRED_PERSIST_LOCAL_MACHINE`: The credential persists for all subsequent logon sessions on this same computer. It is visible to other logon sessions of this same user on this same computer and not visible to logon sessions for this user on other computers. (This is what's stored into the Local Settings file)
*   `CRED_PERSIST_ENTERPRISE`: The credential persists for all subsequent logon sessions on this same computer. It is visible to other logon sessions of this same user on this same computer and to logon sessions for this user on other computers. This option can be implemented as locally persisted credential if the administrator or user configures the user account to not have roam-able state. For instance, if the user has no roaming profile, the credential will only persist locally. (This is what's stored into AppData)

It looks like [CredWrite](http://msdn.microsoft.com/en-us/library/aa375187(VS.85).aspx) is the API you want.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T00:17:55.573

[NET USE](http://www.ss64.com/nt/net_use.html)（命令）和[WshNetwork.MapNetworkDrive](http://www.ss64.com/wsh/drivemap.html)（windows 脚本主机）是两种常用的网络驱动器映射脚本方法，都允许您指定用户和密码。
正如您所说，我不知道这将如何与存储的密码一起工作/不工作，除了知道如果您将用户选项留空，它将尝试使用当前用户的凭据。

# vb.net - VB.NET - 遍历容器对象中的控件

> ID：199521
> 
> 赞同：22
> 
> 时间：2008-10-14T00:10:13.407
> 
> 标签：vb.net

我有一个带有“清除”按钮的表单。

当用户单击“清除”时，我想清除表单上所有可见元素的值。对于日期控件，我想将它们重置为当前日期。

我所有的控件都包含在一个面板上。

现在，我正在使用以下代码执行此操作。有没有比手动检查每种控件类型更简单的方法？这种方法似乎过于笨拙。

更糟糕的是，为了递归地清除子容器内的控件（即面板中的组框），我必须使用重载的“GroupBox”版本重复整个怪物。

*编辑：感谢您的建议，以下代码已大大简化。*

```
Private Sub btnClear_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnClear.Click
    'User clicks Clear, so clear all the controls within this panel
    ClearAllControls(panMid, True) 'True indicates that yes, i want to recurse through sub-containers
End Sub

ClearAllControls(ByRef container As Panel, Optional Recurse As Boolean = True)   
  'Clear all of the controls within the container object
  'If "Recurse" is true, then also clear controls within any sub-containers
  Dim ctrl As Control
  For Each ctrl In container.Controls
      If (ctrl.GetType() Is GetType(TextBox)) Then
          Dim txt As TextBox = CType(ctrl, TextBox)
          txt.Text = ""
      End If
      If (ctrl.GetType() Is GetType(CheckBox)) Then
          Dim chkbx As CheckBox = CType(ctrl, CheckBox)
          chkbx.Checked = False
      End If
      If (ctrl.GetType() Is GetType(ComboBox)) Then
          Dim cbobx As ComboBox = CType(ctrl, ComboBox)
          cbobx.SelectedIndex = -1
      End If
      If (ctrl.GetType() Is GetType(DateTimePicker)) Then
          Dim dtp As DateTimePicker = CType(ctrl, DateTimePicker)
          dtp.Value = Now()
      End If

      If Recurse Then
          If (ctrl.GetType() Is GetType(Panel)) Then
              Dim pnl As Panel = CType(ctrl, Panel)
              ClearAllControls(pnl, Recurse)
          End If
          If ctrl.GetType() Is GetType(GroupBox) Then
              Dim grbx As GroupBox = CType(ctrl, GroupBox)
              ClearAllControls(grbx, Recurse)
          End If
      End If
  Next
End Sub 
```

@Theraccoonbear：我喜欢你的建议，但是当我将声明更改为：

```
Private Sub ClearAllControls(ByRef controls As ControlCollection, Optional ByVal Recurse As Boolean = True) 
```

然后这一行给了我“无法将'ControlCollection'类型的对象转换为'ControlCollection'类型。”：

```
 ClearAllControls(panMid.Controls) 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-14T00:23:01.383

[您可以使用TryCast](http://msdn.microsoft.com/en-us/library/zyy863x8(VS.80).aspx)跳过 GetType 和 CType 舞蹈：

```
Dim dtp as DateTimePicker = TryCast(ctrl, DateTimePicker)
If dtp IsNot Nothing then dtp.Value = Now() 
```

这将为您节省大约 10 行代码。

Control 类的[扩展方法](http://msdn.microsoft.com/en-us/library/bb384936.aspx)应该让它保持整洁：

```
<Extension()> _
Public Shared Sub ClearValue(c as Control, recursive as Boolean)
   Dim dtp as DateTimePicker = TryCast(c, DateTimePicker)
   If dtp IsNot Nothing Then dtp.Value = Now()
   ' Blah, Blah, Blah
End Sub 
```

编辑：如果想到忽略 NullReferenceExceptions 的 Evil 扩展方法不会让你畏缩：

```
<Extension()> _
Public Shared Sub ClearValue(c as CheckBox)
   If c IsNot Nothing Then c.Checked = False
End Sub

TryCast(ctrl, CheckBox).ClearValue() 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-10-20T05:11:59.463

这是获取表单所有 GroupControls 的所有控制权的代码，您可以在 GroupBox 控件中执行某些操作

```
Private Sub GetControls()
    For Each GroupBoxCntrol As Control In Me.Controls
        If TypeOf GroupBoxCntrol Is GroupBox Then
            For Each cntrl As Control In GroupBoxCntrol.Controls
                'do somethin here

            Next
        End If

    Next
End Sub 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T00:23:55.140

为什么不只有一个例程

```
ClearAllControls(ByRef container As Control, Optional ByVal Recurse As Boolean = True) 
```

无论您开始调用的层次结构中的哪个级别，您都可以递归到它，从表单级别到单个容器。

此外，在 TextBox 控件上，我使用`Textbox.Text = String.Empty`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T00:17:57.370

我做过类似的事情，这基本上就是我做这件事的方式。我可能建议的唯一更改是不要重载该方法，只需将传入的类型设为 Control，您就可以对 GroupBox、Panel 或任何其他提供 .Controls 属性的容器控件使用相同的版本。除此之外，我认为“清除”控件的定义可能有些模棱两可，因此没有属于 Control 类的 Clear() 方法，因此您需要为每种控件类型实现其含义。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-25T18:08:40.330

```
For Each c In CONTAINER.Controls
    If TypeOf c Is TextBox Then
        c.Text = ""
    End If
Next 
```

将 (CONTAINER) 替换为您的名称（可能是 FORM、PANEL、GROUPBOX）
注意您在其中包含了控件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-09-22T07:06:34.280

在这里它适用于所有内部控件。
如果您需要清除任何其他控件，请添加。

```
Private Sub ClearAll()
    Try
        For Each ctrl As Control In Me.Controls
            If ctrl.[GetType]().Name = "Panel" Then
                ClearControls(ctrl)
            End If

            If ctrl.[GetType]().Name = "GroupBox" Then
                ClearControls(ctrl)
            End If
            If ctrl.[GetType]().Name = "ComboBox" Then
                Dim tb As ComboBox = TryCast(ctrl, ComboBox)
                tb.SelectedText = ""
            End If

            If ctrl.[GetType]().Name = "TabControl" Then
                ClearControls(ctrl)
            End If

            If ctrl.[GetType]().Name = "TextBox" Then
                Dim tb As TextBox = TryCast(ctrl, TextBox)
                tb.Clear()
            End If

            If ctrl.[GetType]().Name = "RadioButton" Then
                Dim tb As RadioButton = TryCast(ctrl, RadioButton)
                tb.Checked = False
            End If

            If ctrl.[GetType]().Name = "CheckBox" Then
                Dim tb As CheckBox = TryCast(ctrl, CheckBox)
                tb.Checked = False
            End If

            If ctrl.[GetType]().Name = "ComboBox" Then
                Dim tb As ComboBox = TryCast(ctrl, ComboBox)
                tb.SelectedIndex = 0
            End If

            If ctrl.[GetType]().Name = "RichTextBox" Then
                Dim tb As RichTextBox = TryCast(ctrl, RichTextBox)
                tb.Clear()

            End If
        Next
    Catch ex As Exception
        MessageBox.Show(ex.Message, "Error Message", MessageBoxButtons.OK, MessageBoxIcon.Error)
    End Try
End Sub

Private Sub ClearControls(ByVal Type As Control)

    Try
        For Each ctrl As Control In Type.Controls

            If ctrl.[GetType]().Name = "TextBox" Then
                Dim tb As TextBox = TryCast(ctrl, TextBox)
                tb.Clear()
            End If

            If ctrl.[GetType]().Name = "Panel" Then
                ClearControls(ctrl)
            End If

            If ctrl.[GetType]().Name = "GroupBox" Then
                ClearControls(ctrl)
            End If

            If ctrl.[GetType]().Name = "TabPage" Then
                ClearControls(ctrl)
            End If

            If ctrl.[GetType]().Name = "ComboBox" Then
                Dim tb As ComboBox = TryCast(ctrl, ComboBox)
                tb.SelectedText = ""
            End If

            If ctrl.[GetType]().Name = "RadioButton" Then
                Dim tb As RadioButton = TryCast(ctrl, RadioButton)
                tb.Checked = False
            End If

            If ctrl.[GetType]().Name = "CheckBox" Then
                Dim tb As CheckBox = TryCast(ctrl, CheckBox)
                tb.Checked = False
            End If

            If ctrl.[GetType]().Name = "RichTextBox" Then
                Dim tb As RichTextBox = TryCast(ctrl, RichTextBox)
                tb.Clear()

            End If
        Next
    Catch ex As Exception
        MessageBox.Show(ex.Message, "Error Message", MessageBoxButtons.OK, MessageBoxIcon.Error)
    End Try
End Sub 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-07T16:55:25.023

这直接来自[一篇](http://msdn.microsoft.com/en-us/library/aa289142%28v=vs.71%29.aspx)讨论使用的技术的文章，现在控制数组已经被取消，从 VB6 到 VB.NET。

```
Private Sub ClearForm(ByVal ctrlParent As Control)
    Dim ctrl As Control
    For Each ctrl In ctrlParent.Controls
        If TypeOf ctrl Is TextBox Then
           ctrl.Text = ""
        End If
        ' If the control has children, 
        ' recursively call this function
        If ctrl.HasChildren Then
            ClearForm(ctrl)
        End If
    Next
End Sub 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-04-13T17:52:06.820

```
Public Sub raz(lst As Control.ControlCollection, Optional recursive As Boolean = True)
    For Each ctrl As Control In lst
        If TypeOf ctrl Is TextBox Then
            CType(ctrl, TextBox).Clear()
        End If

        If TypeOf ctrl Is MaskedTextBox Then
            CType(ctrl, MaskedTextBox).Clear()
        End If

        If TypeOf ctrl Is ComboBox Then
            CType(ctrl, ComboBox).SelectedIndex = -1
        End If

        If TypeOf ctrl Is DateTimePicker Then
            Dim dtp As DateTimePicker = CType(ctrl, DateTimePicker)
            dtp.CustomFormat = " "
        End If

        If TypeOf ctrl Is CheckedListBox Then
            Dim clbox As CheckedListBox = CType(ctrl, CheckedListBox)
            For i As Integer = 0 To clbox.Items.Count - 1
                clbox.SetItemChecked(i, False)
            Next
        End If

        If TypeOf ctrl Is RadioButton Then
            CType(ctrl, RadioButton).Checked = False

        End If

        If recursive Then
            If TypeOf ctrl Is GroupBox Then
                raz(CType(ctrl, GroupBox).Controls)
            End If
        End If
    Next
End Sub 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-02-21T12:40:51.320

我向你介绍我的`ControlIterator`班级

来源： http: [//pastebin.com/dubt4nPG](http://pastebin.com/dubt4nPG)

一些使用示例：

```
 ControlIterator.Disable(CheckBox1)

 ControlIterator.Enable({CheckBox1, CheckBox2})

 ControlIterator.Check(Of CheckBox)(Me)

 ControlIterator.Uncheck(Of CheckBox)(Me.GroupBox1)

 ControlIterator.Hide(Of CheckBox)("1")

 ControlIterator.PerformAction(Of CheckBox)(Sub(ctrl As CheckBox) ctrl.Visible = True)

 ControlIterator.AsyncPerformAction(RichTextBox1,
                                    Sub(rb As RichTextBox)
                                        For n As Integer = 0 To 9
                                            rb.AppendText(CStr(n))
                                        Next
                                    End Sub)

 ControlIterator.PerformAction(Me.Controls, Sub(c As Control)
                                                c.BackColor = Color.Green
                                            End Sub) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-07T23:12:09.317

这可能有助于未来的发展......

```
GetAllButtons(Me)

Public Sub GetAllButtons(ByRef forms As Object)
    Dim list As New List(Of Button)
    Dim iIndx As Integer
    For Each c In forms.Controls
        For iIndx = 0 To forms.Controls.Count - 1
            If (TypeOf forms.Controls(iIndx) Is Button) Then
                list.Add(forms.Controls(iIndx))
            End If
            If (TypeOf forms.controls(iIndx) Is Panel) Then
                For Each cntrl As Control In forms.controls(iIndx).Controls
                    If TypeOf cntrl Is Button Then
                        list.Add(cntrl)
                    End If
                Next
            End If
        Next
    Next

Button(list.ToArray)

End Sub

Public Sub Button(btn() As Button)
    For Each bt In btn
       Do Something with Buttons
    next
End Sub 
```

# web-services - SSRS 2008 速成版中是否提供 SOAP Web 服务 API？

> ID：199525
> 
> 赞同：1
> 
> 时间：2008-10-14T00:12:23.933
> 
> 标签：web-services, reporting-services

换句话说，如果我设置了 SSRS Express 版本，我可以通过 web 服务消费和拨打电话吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T00:33:25.327

**更新**：检查此链接以了解支持的功能。[带有高级服务的 SQL Server Express 中的 Reporting Services](http://msdn.microsoft.com/en-us/library/ms365166.aspx)。

您最好的是带有高级服务的 Express 版本。

[具有高级服务的 SQL Server 2008 Express 具有 SQL Server 2008 Express](http://www.microsoft.com/Downloads/details.aspx?familyid=B5D1B8C3-FDA5-4508-B0D0-1311D670E336&displaylang=en)中的所有功能，此外，您还可以：

对本地关系数据运行 SQL Server Reporting Services 报告。

# ruby - 获取当前执行方法的名称

> ID：199527
> 
> 赞同：216
> 
> 时间：2008-10-14T00:14:06.580
> 
> 标签：ruby, reflection, metaprogramming

`$0`是顶级 Ruby 程序的变量，但当前方法是否存在变量？

* * *

## 回答 #1

> 赞同：369
> 
> 时间：2008-10-14T00:24:59.727

甚至比我的第一个答案更好，您可以使用__method__：

```
class Foo
  def test_method
    __method__
  end
end 
```

这将返回一个符号 - 例如，`:test_method`。要将方法名称作为字符串返回，请`__method__.to_s`改为调用。

**注意：**这需要 Ruby 1.8.7。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2016-02-25T18:05:49.077

根据您的实际需要，您可以使用`__method__`或`__callee__`，它将当前正在执行的方法的名称作为符号返回。

在 ruby​​ 1.9 上，它们的行为相同（就[文档](http://ruby-doc.org/core-1.9.3/Kernel.html#method-i-__callee__)和我的测试而言）。

`__callee__`如果您调用已定义方法的别名，则在 ruby​​ 2.1 和 2.2 上的行为会有所不同。两者的[文档](http://ruby-doc.org/core-2.1.2/Kernel.html#method-i-__callee__)不同：

*   `__method__`：“当前方法定义的名称”（即定义的名称）
*   `__callee__`：“当前方法的被调用名称”（即被调用（调用）的名称）

测试脚本：

```
require 'pp'
puts RUBY_VERSION
class Foo
  def orig
    {callee: __callee__, method: __method__}
  end
  alias_method :myalias, :orig
end
pp( {call_orig: Foo.new.orig, call_alias: Foo.new.myalias} ) 
```

1.9.3 输出：

```
1.9.3
{:call_orig=>{:callee=>:orig, :method=>:orig},
 :call_alias=>{:callee=>:orig, :method=>:orig}} 
```

2.1.2 输出（`__callee__`返回别名，但`__method__`返回定义方法时的名称）：

```
2.1.2
{:call_orig=>{:callee=>:orig, :method=>:orig},
 :call_alias=>{:callee=>:myalias, :method=>:orig}} 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-10-14T00:21:38.967

来自[http://snippets.dzone.com/posts/show/2785](http://snippets.dzone.com/posts/show/2785)：

```
module Kernel
private
    def this_method_name
      caller[0] =~ /`([^']*)'/ and $1
    end
end

class Foo
  def test_method
    this_method_name
  end
end

puts Foo.new.test_method    # => test_method 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2013-12-04T02:46:56.000

对于 Ruby 1.9+，我建议使用`__callee__`

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2014-11-12T12:59:11.883

我在视图文件中检索方法名称时遇到了同样的问题。我得到了解决方案

```
params[:action] # it will return method's name 
```

如果你想得到控制器的名字然后

```
params[:controller] # it will return you controller's name 
```

# c# - C# 控制台使用管道接收输入

> ID：199528
> 
> 赞同：45
> 
> 时间：2008-10-14T00:14:07.097
> 
> 标签：c#, pipe

我知道如何使用参数对控制台应用程序进行编程，例如：myProgram.exe param1 param2。

我的问题是，如何使我的程序与 | 一起使用，例如：echo "word" | 我的程序.exe？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-10-14T00:16:50.100

您需要使用`Console.Read()`and `Console.ReadLine()`，就好像您正在阅读用户输入一样。管道透明地替换用户输入。你不能轻易地使用两者（尽管我确信这很有可能......）。

**编辑：**

一个简单的`cat`样式程序：

```
class Program
{
    static void Main(string[] args)
    {
        string s;
        while ((s = Console.ReadLine()) != null)
        {
            Console.WriteLine(s);
        }

    }
} 
```

运行时，如预期的那样，输出：

```
C:\...\ConsoleApplication1\bin\Debug>echo "Foo bar baz" | ConsoleApplication1.exe
“Foo bar baz”

C:\...\ConsoleApplication1\bin\Debug>

```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-11-02T00:45:03.340

以下内容不会暂停应用程序的输入并在数据通过*或*不通过管道传输时工作。有点小技巧；并且由于错误捕获，当进行大量管道调用时，性能可能会有所下降，但是......很容易。

```
public static void Main(String[] args)
{

    String pipedText = "";
    bool isKeyAvailable;

    try
    {
        isKeyAvailable = System.Console.KeyAvailable;
    }
    catch (InvalidOperationException expected)
    {
        pipedText = System.Console.In.ReadToEnd();
    }

    //do something with pipedText or the args
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2015-03-14T10:09:03.723

在 .NET 4.5 中是

```
if (Console.IsInputRedirected)
{
    using(stream s = Console.OpenStandardInput())
    {
        ... 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-01-20T17:17:28.463

这是这样做的方法：

```
static void Main(string[] args)
{
    Console.SetIn(new StreamReader(Console.OpenStandardInput(8192))); // This will allow input >256 chars
    while (Console.In.Peek() != -1)
    {
        string input = Console.In.ReadLine();
        Console.WriteLine("Data read was " + input);
    }
} 
```

这允许两种使用方法。**从标准输入**读取：

```
C:\test>myProgram.exe
hello
Data read was hello 
```

或从**管道输入**中读取：

```
C:\test>echo hello | myProgram.exe
Data read was hello 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-03-15T00:30:25.213

这是从其他解决方案加上 peek() 组合而成的另一个替代解决方案。

如果没有 Peek()，我在执行“type t.txt | prog.exe”（其中 t.txt 是一个多行文件）时，如果没有 ctrl-c，应用程序将无法返回。但只是“prog.exe”或“echo hi | prog.exe”工作正常。

此代码仅用于处理管道输入。

```
static int Main(string[] args)
{
    // if nothing is being piped in, then exit
    if (!IsPipedInput())
        return 0;

    while (Console.In.Peek() != -1)
    {
        string input = Console.In.ReadLine();
        Console.WriteLine(input);
    }

    return 0;
}

private static bool IsPipedInput()
{
    try
    {
        bool isKey = Console.KeyAvailable;
        return false;
    }
    catch
    {
        return true;
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-10-26T22:25:17.123

这也适用于

> c:\MyApp.exe < input.txt

我不得不使用 StringBuilder 来操作从 Stdin 捕获的输入：

```
public static void Main()
{
    List<string> salesLines = new List<string>();
    Console.InputEncoding = Encoding.UTF8;
    using (StreamReader reader = new StreamReader(Console.OpenStandardInput(), Console.InputEncoding))
    {
        string stdin;
        do
        {
            StringBuilder stdinBuilder = new StringBuilder();
            stdin = reader.ReadLine();
            stdinBuilder.Append(stdin);
            var lineIn = stdin;
            if (stdinBuilder.ToString().Trim() != "")
            {
                salesLines.Add(stdinBuilder.ToString().Trim());
            }

        } while (stdin != null);

    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-14T01:00:02.683

Console.In 是对围绕标准输入流的 TextReader 的引用。当将大量数据传输到您的程序时，使用这种方式可能会更容易。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-28T00:52:13.753

提供的示例存在问题。

> ```
>  while ((s = Console.ReadLine()) != null) 
> ```

如果程序在没有管道数据的情况下启动，将等待输入。所以用户必须手动按任意键退出程序。

# sql - Oracle SQL技术避免填充trans log

> ID：199537
> 
> 赞同：2
> 
> 时间：2008-10-14T00:17:46.120
> 
> 标签：sql, oracle, optimization

Oracle 编程新手（来自 Sybase 和 MS SQL Server）。避免用大量更新填充跨日志的“Oracle 方式”是什么？

在我的具体情况下，我正在更新可能非常多的行。这是我的方法：

```
UPDATE my_table
SET a_col = null
WHERE my_table_id IN 
(SELECT my_table_id FROM my_table WHERE some_col < some_val and rownum < 1000) 
```

...我在循环中执行此操作，直到更新的行数为零，

这是最好的方法吗？

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T00:34:38.507

如果您将 UPDATE 分解为多次运行（例如 1000 条记录），则重做和撤消日志的更新量根本不会减少。最重要的是，与运行单个大型 SQL 相比，总查询时间很可能会更长。

没有真正的方法可以解决 UPDATE 中的 UNDO/REDO 日志问题。使用 INSERTs 和 CREATE TABLEs，您可以使用 DIRECT aka APPEND 选项，但我想这对您来说并不容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T19:40:18.553

取决于行的百分比几乎与数量一样多。它还取决于更新是否使行比以前更长。即每行从空到200字节。这可能会影响您的性能 - 链式行。

不管怎样，你可能想试试这个。

构建一个新表，将列纠正为选择而不是更新的一部分。您可以通过 CTAS（将表创建为选择）构建该新表，这可以避免记录。

删除原始表。

重命名新表。

重新索引、重新指向约束、重建触发器、重新编译包等。

您可以通过这种方式避免大量记录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T00:32:13.317

任何 UPDATE 都会产生重做。实际上，更新所有行的单个 UPDATE 将生成最少的重做总量并运行最短的时间。

假设您正在更新表中的绝大多数行，如果有任何索引使用 A_COL，您最好在更新之前禁用这些索引，然后在大量 UPDATE 语句之后使用指定的 NOLOGGING 重建这些索引. 此外，如果由于更新而需要触发/验证任何触发器或外键，暂时摆脱这些可能会有所帮助。

# c++ - 您将如何实施黑白棋游戏？（奥赛罗）

> ID：199555
> 
> 赞同：6
> 
> 时间：2008-10-14T00:23:05.377
> 
> 标签：c++, graphics

我一直在考虑在家里开始一个业余项目来锻炼我的大脑。 [黑白棋](http://en.wikipedia.org/wiki/Reversi)看起来像一个简单的游戏，其机动性对游戏玩法有着深远的影响。它至少比井字游戏更上一层楼。这将是一个单一的玩家对抗某种人工智能。

我想在 PC 上用 C++ 试试这个。

我可能会遇到什么问题？

你会推荐什么图形库？

我不够聪明地问自己什么问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T00:28:56.317

问题...

好吧，在编写游戏的策略部分时一定要确定，而不是简单地做出让你获得最多棋子的动作。您还必须重视董事会位置。例如，如果有机会将棋子放在棋盘角落，则应优先于任何其他动作（除了赢得比赛），因为该棋子永远无法翻回。而且，将一块棋子放在角落点附近几乎是你能做出的最糟糕的举动（如果角落空间是开放的）。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T00:35:11.140

正如其他人所提到的，我将从深入了解游戏玩法和策略以及所涉及的算法开始。此链接可能对您有用，它描述了基本的黑白棋策略和算法：

[http://www.site-constructor.com/othello/Present/Basic_Strategy.html](http://www.site-constructor.com/othello/Present/Basic_Strategy.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T00:42:30.393

正如这些人建议我告诉你首先考虑算法和游戏逻辑的想法。对我来说，下一个答案是图形库，它取决于您的目标平台、编程语言、框架等。但正如我建议的那样，将 C# 与 Cairo 2D 图形库一起使用，您可以使用 Mono 框架来实现这一点（然后您可以针对所有三个让您的游戏运行的主要操作系统）-> www.mono-project.org。同时我发现我认为这种资源会帮助你：[http](http://home.datacomm.ch/t_wolf/tw/misc/reversi/html/index.html) ://home.datacomm.ch/t_wolf/tw/misc/reversi/html/index.html 。但是如果你完成了这个，你可以尝试实现数独。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T01:04:35.730

如果你写一个 AI 来对抗，你会想用 alpha-beta 剪枝来研究 minimax。您最喜欢的搜索引擎将对这个话题有很多话要说。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-14T01:12:34.997

在您自己掌握了游戏逻辑之后，请阅读 Peter Norvig 的杰出著作[Paradigms of AI Programming](http://norvig.com/paip.html)的第 18 章。（源代码[在这里](http://norvig.com/paip/)。）它有一个相当短且可读性极强的程序，几乎可以踢任何人的屁股；你应该通过比较你的解决方案来学到很多东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-14T13:50:16.870

总的来说，你最终会遇到的问题将取决于你和你的方法。朋友倾向于从不同的角度说复杂的简单。

图形库的选择取决于你要写什么样的游戏？OpenGL 是此类项目中的常见选择，但您也可以使用一些 GUI 库或直接使用 windows 或 xorg 自己的库。如果你想做点花哨的，只需使用 OpenGL。

你应该问的问题：

C++ 是这个项目的明智选择吗？也考虑 C 和/或 python。我对此的回答是，如果你只想写黑白棋，那就去 python。但是如果你想学习一门低级语言，先学C。C++ 是对 C 的**扩展**，因此在 C++ 中要学习的东西比在 C 中的要多。在我看来，你必须在 C++ 上学习的越多不值得付出努力。

你如何使用图形库？如果您要制作精美的效果，请转到场景图。相反，您可以只渲染带有按钮的黑白棋网格。

你应该如何实现 UI，你应该使用常见的 UI 概念吗？通常的 UI 概念（窗口、框架、按钮、菜单栏、对话框）并不像人们想象的那么好，要正确实现它们还有很多工作要做。应用场景图来解释输入，并尝试不同的巧妙方法来控制游戏。避免使用介绍菜单（它们是愚蠢且无用的工作），对大多数配置使用命令行参数。

我还给你一些想法让你开始：

奥赛罗棋盘为 8x8，总共 64 个单元。您可以为每个单元分配一个字节，这使得每个板状态为 64 个字节。它是 8 个长整数，一点也不长！您可以存储游戏的整个进度，玩家甚至不会注意到它。因此，建议将黑白棋板实现为一个不可变结构，当您更改状态时始终复制该结构。它还将在以后帮助您使用 AI 并实现“撤消”功能。

因为一个字节可以存储比三个状态（EMPTY、BLACK、WHITE）更多的信息，我建议您还要提供两个额外的状态（BLACK_ALLOWED、WHITE_ALLOWED、BOTH_ALLOWED）。您可以在复制新状态时计算这些值。

检查可以放置块的位置的算法，可以一个一个地通过板，然后从空单元格跟踪到正则表达式模式的每个方向：B+W => W^，W+B => B^ 这样您可以将游戏规则封装在一个简单的界面中，该界面可以处理所有事情。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-11-17T05:21:57.053

那里有大量的库，但据我所知，您的游戏将需要事件和图形库......以及一个声音库，以获得更多乐趣！Allegro 5 是一个最佳选择……它是一个多合一的库。 [http://liballeg.org/](http://liballeg.org/) 虽然它是用 C 语言编写的，但您可以创建面向对象的程序。

和一个教程...

[http://fixbyproximity.com/2d-game-development-course/](http://fixbyproximity.com/2d-game-development-course/)

或者您可以使用低级 API，例如 OpenGL 用于图形。用于声音的 OpenAL。glfw 用于活动。

但是 OpenGL 很重要，因为您必须创建自己的精灵表处理程序和所有 2d 的东西。

使用 allegro...完成您的游戏，然后使用 OpenGL！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T14:01:18.580

黑白棋应该是一个非常容易实现的游戏。在 AI 的实现过程中学习一些基本的博弈论算法（特别是 min-max）是完美的。

关于人工智能需要注意的一件事是，完全有可能为黑白棋制作一个完美的人工智能（无论对手的动作如何，它总是会获胜）。所以在战略方面，如果你的 AI 输了，你还有工作要做:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-14T14:08:32.357

很多年前，我还在上学的时候写过一个黑白棋游戏。它的策略非常简单，它只追求最大数量的棋子，但加权所以它更喜欢边缘，尤其是角落，不喜欢冒险放弃角落的正方形。

这对那些还没有弄清楚它在做什么的人来说效果很好，但是一旦你有了它，就很容易使用它的策略来对付它。然而，我并不自豪地说，尽管我已经写了它，但它最初几次击败了我！

具有一些前瞻动作的适当 AI 要复杂得多。应该是一个有趣的问题，但当时我对用户界面更感兴趣。

# java - 如何将旧版 Java/J2EE 网站移植到现代脚本语言（PHP、Python/Django 等）？

> ID：199556
> 
> 赞同：4
> 
> 时间：2008-10-14T00:23:28.310
> 
> 标签：java, php, python, django, jakarta-ee

我想将遗留的 Java Web 应用程序 (J2EE) 迁移到脚本语言 - 任何脚本语言 - 以提高编程效率。

最简单的方法是什么？是否有任何自动化工具可以转换大部分业务逻辑？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-14T01:43:21.440

这是你必须做的。

首先，确保你可以在跑步之前步行。构建一些简单的东西，可能与您的主要项目相关。

**不要**构建最终项目的一部分，并希望它会“演变”成最终项目。这永远不会奏效。为什么？你会犯愚蠢的错误。但是你不能删除或重做它们，因为你应该把这个错误演变成最终的项目。

接下来，选择一个框架。什么？第二？是的。第二。在您真正使用某些脚本语言和框架做某事之前，您对正在做的事情没有真正有用的概念。一旦你建立了一些东西，你现在就有了一个明智的意见。

“等等，”你说。“要执行第 1 步，我必须选择一个框架。” 真的。但是，第 1 步包含您可以撤销的决定。为第 1 步选择错误的框架不会产生长期的不良影响。这只是学习。

第三，利用您的战略框架和一些经验，将您现有的网站分解为可以使用新框架构建的部分。从最重要到最不重要对这些部分进行优先级排序。

**不要**将整个转换计划为一个大型项目。它永远不会起作用。它使一项大工作变得比必要的复杂。

我们将使用 Django 作为示例框架。您将拥有模板、视图函数、模型定义、URL 映射和其他详细信息。

对于每个构建，请执行以下操作：

1.  将现有模型转换为 Django 模型。这永远不适合您的旧 SQL。您将不得不重新考虑您的模型，修复旧错误，纠正您一直想纠正的旧错误。

2.  编写单元测试。

3.  构建转换实用程序以导出旧数据并导入新模型。

4.  构建 Django 管理页面来触摸和感受新数据。

5.  选择有代表性的页面并将它们重新加工成适当的模板。您可能会使用一些遗留的 JSP 页面。但是，不要为此浪费太多时间。使用 HTML 创建 Django 模板。

6.  规划您的 URL 和视图功能。有时，这些视图函数将利用旧的操作类。不要“转换”。从头重写。使用您的新语言和框架。

唯一值得保留的是数据和操作概念。不要试图保留或转换代码。这是误导。您可以将单元测试从 JUnit 转换为 Python 单元测试。

* * *

几个月前我给出了这个建议。在处理过程中，我必须做一些指导和审查。修改后的站点已启动并正在运行。没有旧技术的转换；他们从头开始进行了建议的重写。开发商高兴。网站运作良好。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-14T00:45:59.060

如果您已经在 J​​ava 中实现了大量业务逻辑，那么我为您看到了两种可能性。

第一种是使用在 JVM 中运行并具有 Web 框架的高级语言，例如[Groovy](http://groovy.codehaus.org/) / [Grails](http://grails.org/)或[JRuby](http://jruby.codehaus.org/)和[Rails](https://rads.stackoverflow.com/amzn/click/com/1590598814)。这允许您直接利用您在 Java 中实现的所有业务逻辑，而无需重新构建整个站点。您应该能够利用该框架在 Web 开发方面提高的生产力，并仍然利用您现有的业务逻辑。

另一种方法是将您的业务逻辑层转换为一组可通过标准 RPC 机制使用的服务 - REST、SOAP、XML-RPC 或其他一些基于 HTTP 协议的简单 XML（YAML 或 JSON）（另请参阅[DWR](https://dwr.dev.java.net/)），以便前端可以对您的业务逻辑进行这些 RPC 调用。

第一种方法在 JVM 上使用高级语言可能比第二种方法更少重新架构。

如果您的目标是从 Java 完全迁移，那么这两种方法中的任何一种都允许您以更小的步骤进行迁移 - 您可能会发现这种混合方式比完全弃用更好 - JVM 有很多库并且集成得很好进入许多其他系统。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-14T00:36:30.233

使用自动化工具“移植”Web 应用程序几乎可以肯定地保证未来的编程效率将被最小化——而不是提高。

当了解该语言良好编码实践的优秀程序员使用时，良好的脚本语言可以提高编程效率。自动化工具通常不是为输出优雅或编写良好的代码而设计的，只输出有效的代码。

只有在您努力重新实现 Web 应用程序之后，您才能获得编程效率的提高——由于重新实现所需的时间，这可能会或可能不会导致整体改进。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T18:05:01.643

这里给出的许多建议都假设您——而且只有你自己——正在对应用程序进行全面重写。这可能不是这种情况，它改变了很多答案

如果您已经开始使用 J2EE，那么正确的答案是 Grails。很简单：您可能已经有了 Hibernate 和 Spring，并且您希望能够以最小的痛苦在旧代码和新代码之间来回切换。这正是 Groovy 的强项，在这方面它甚至比 JRuby 更流畅。

此外，如果您已经有了一个 J2EE 应用程序，那么您已经有 Java 开发人员在工作。在这种情况下，学习 Groovy 就像从梯子上掉下来——字面意思。除了匿名内部类之外，Groovy 是 Java 的纯超集，这意味着您可以编写 Java 代码，将其称为 Groovy，然后就可以使用它了。随着您对 Groovy 的优点越来越熟悉，您可以将它们集成到您的 Java 式 Groovy 代码中。不久之后，您将编写非常 Groovy 的代码，甚至还没有真正意识到这种转变。

# java - 用于计时我的程序的 shell 脚本在 0 秒时测量它

> ID：199564
> 
> 赞同：1
> 
> 时间：2008-10-14T00:26:48.007
> 
> 标签：java, shell, time, nice

我的教授编写了这个 shell 脚本来计时我的程序，并显示结果。出于某种原因，它只是在我的程序中输出 0。他提供了以下文件：

```
timeit.csh
sequence
ecoli2500.txt   
ecoli3000.txt    
ecoli5000.txt    
ecoli7000.txt    
ecoli8000.txt    
ecoli9000.txt    
ecoli10000.txt 
```

以下是序列的内容

```
java EditDistance 
```

timeit.csh 的内容如下。

java EditDistance < ecoli2500.txt 按预期工作

事实上，除了序列之外，上述每个文件都可以完美地执行该程序。

我不明白为什么

```
./timeit.csh sequence 
```

产生全零

这是timeit.csh ...（下面是EditDistance.java）：

```
#!/bin/csh
# 
# A Unix script to time programs.
#
# Command line: timeit sequence

# the array of programs from the commandline
set program = $argv[1]

# adjust as needed
set CPULIMIT = 120
limit cpu $CPULIMIT seconds
limit core 0

# input files
set input = ( stx1230.txt      \
    ecoli2500.txt    \
    ecoli3000.txt    \
    ecoli5000.txt    \
    ecoli7000.txt    \
    ecoli8000.txt    \
    ecoli9000.txt    \
    ecoli10000.txt)

# adjust as needed
set inputpath = `pwd`

# print header
printf "CPU limit = %d seconds\n\n" $CPULIMIT
printf "%-25s" "Data File"
foreach program ($argv)
printf "%16s" $program
end
printf "\n"

# print right number of = for table
@ i = 25 + 16 * $#argv 
while ($i > 0)
printf "="
@ i = $i - 1
end
printf "\n"

# time it and print out row for each data file and  column for each program
foreach datafile ($input)
printf "%-25s" $datafile
if (-f $inputpath/$datafile) then
    foreach program ($argv)
    # printing running time of program on datafile
    # -p flag with time to ensure its output is measured in seconds and not minutes
    nice /usr/bin/time -p $program <                    \
        $inputpath/$datafile |&                        \
        egrep '^user[ ]*[0-9]' |                       \
        awk '{ if ($2 >= '$CPULIMIT') printf "       CPU limit"; else printf("%16.2f", $2) }'
    # egrep, awk commands extract second column of row corresponding to user time

    end
else printf "could not open" $datafile
endif
printf "\n"

end 
```

这是 EditDistance.java

```
import java.util.*;

class EditDistance {
    public static int min(int a, int b, int c) {
        return Math.min(a,Math.min(b,c));
    }
    public static int distance(String one, String two) {
        if (one.length()>two.length()) {
            String temp1 = one;
            String temp2 = two;
            one = temp2;
            two = temp1;
        }
        int[][] d = new int[one.length()+1][two.length()+1];
        d[0][0] = 0;
        int top, left, topleft, cost;
        for (int i = 1; i <= one.length(); i++) {
            d[0][i] = 2*i;
            d[i][0] = 2*i;
        }
        for (int i = 1; i <= one.length(); i++) {
            for (int j = 1; j <= two.length(); j++) {

                if (one.charAt(i-1) == two.charAt(j-1))
                    cost = 0;
                else
                    cost = 1;

                top = d[i][j-1];
                left = d[i-1][j];
                topleft = d[i-1][j-1];
                d[i][j] = min(top+2,left+2,topleft+cost);
            }
        }
        return d[one.length()][two.length()];
    }
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        String one = scanner.next();
        String two = scanner.next();
        System.out.println(distance(one,two));
    }
} 
```

任何想法为什么事情不工作？我对shell脚本了解不多，但是shell脚本的这一部分：

```
nice /usr/bin/time -p $program <                    \
    $inputpath/$datafile |&                        \
    egrep '^user[ ]*[0-9]' |                       \
    awk '{ if ($2 >= '$CPULIMIT') printf "       CPU limit"; else printf("%16.2f", $2) }' 
```

在我心中确认我的程序应该期待这个命令：

```
java EditDistance < ecoli2500.txt
java EditDistance...etc. etc. 
```

但该程序适用于这些命令。我需要设置我的程序以正确响应 shell 脚本。也许你们中的一些人可以提供帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T20:17:30.583

固定的。问题出在这里：

```
 nice /usr/bin/time -p $program < 
```

在脚本中。我的计算机不会在命令前没有“./”的情况下执行 shell 脚本。我教授的电脑一定不一样。将脚本更改为

```
nice /usr/bin/time -p ./$program < 
```

完美运行程序。

我确定我的教授和我都在使用 Fedora 8。让我只需输入他们的名字就可以在终端中运行程序有什么区别？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T00:36:15.337

我不确定环境的状态（例如：PATH）或文件和权限的状态是什么，但它可能就像序列 shell 脚本的权限问题一样简单（我想你说的是包含'java EditDistance'）。如果你'chmod +x 序列'，它有效吗？另一个问题是它可能不在您的路径中，您可以通过键入：'./sequence < ecoli2500.txt' 来运行序列吗？

# java - 如何使 Java Canvas 看起来从其容器中升起

> ID：199575
> 
> 赞同：0
> 
> 时间：2008-10-14T00:31:16.530
> 
> 标签：java, user-interface, canvas, awt

我有一个用 Java 编写的简单 GUI 组件。该类在 java.awt.canvas 中绘制一个模拟时钟。
然后这个画布被包含在一个 JFrame 中——我想做的是给画布一个 3D“凸起”效果——就像给照片添加阴影一样。有没有一种简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T00:46:02.070

如果您使用的是 JFrame，那么您有两种选择：

1.  首先将您自己的组件添加到 JPanel，然后将其添加到 JFrame。

2.  您可以从 JComponent 继承，而不是从 java.awt.Canvas 继承。然后，您必须在 paintComponent() 方法中完成所有绘画，而不仅仅是 paint()（您可以重命名当前的绘画方法）。

在这两种情况下，您现在都可以使用从 BorderFactory 获得的 setBorder() 方法（在 JPanel 或您的组件上）设置边框。

另请参阅：[如何使用边框](http://java.sun.com/docs/books/tutorial/uiswing/components/border.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T00:44:41.090

如果您使用的是 Swing 元素，您将使用 BorderFactory 的 createRaisedBevelBorder() 方法并将画布的边框设置为结果边框。Canvas 是一个 AWT 组件，因此您需要将它包装在一个可以设置边框的 Swing 组件中。

# linux - vmWare Server 可以安装在 X-less 主机上吗？

> ID：199576
> 
> 赞同：2
> 
> 时间：2008-10-14T00:31:34.487
> 
> 标签：linux, ubuntu, virtualization, vmware-server

我计划将我的 vmWare 虚拟机从 Windows 主机移动到 Linux 主机（Ubuntu）。是否可以在没有图形环境（没有 X）的 Linux 主机上运行 vmWare Server？

我只是想知道 Windows/Linux 客户机的图形设置在这种情况下是如何工作的。

在此先感谢您的时间。

维克多·马尔克斯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T00:37:23.773

只需将其安装在 Ubuntu Server 上并通过 apt-get 安装即可。这是一个很好的演练

[http://users.piuha.net/martti/comp/ubuntu/en/server.html](http://users.piuha.net/martti/comp/ubuntu/en/server.html)

我在我的开发服务器上执行此操作，并使用我的 Windows 机器上的图形客户端连接到它。我没有安装gui。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T00:33:04.890

在 Linux 上编译和安装 VMware Server 时需要 X 库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T00:51:50.093

[virtualbox](http://www.virtualbox.org/)有一些你可以使用的命令行工具，我认为它不需要 x 安装。您应该比较这些功能并确保这是您想要的。

# php - 从数据库表中填充选择下拉列表

> ID：199597
> 
> 赞同：5
> 
> 时间：2008-10-14T00:39:45.610
> 
> 标签：php, mysql

我有一张桌子（“场所”），其中存储了志愿者可以工作的所有可能场所，每个志愿者被分配到每个场所工作。

我想从场地表中创建一个选择下拉列表。

现在我可以显示每个志愿者分配的地点，但我希望它显示下拉框，地点已经在列表中选择。

```
<form action="upd.php?id=7">
<select name="venue_id">
<?php //some sort of loop goes here
print '<option value="'.$row['venue_id'].'">'.$row['venue_name'].'</option>';
//end loop here ?>
</select>
<input type="submit" value="submit" name="submit">
</form> 
```

例如id为7的志愿者，分配给venue_id 4

```
<form action="upd.php?id=7">
<select name="venue_id">
    <option value="1">Bagpipe Competition</option>
    <option value="2">Band Assistance</option>
    <option value="3">Beer/Wine Pouring</option>
    <option value="4" selected>Brochure Distribution</option>
    <option value="5">Childrens Area</option>
    <option value="6">Cleanup</option>
    <option value="7">Cultural Center Display</option>
    <option value="8">Festival Merch</option>
</select>
<input type="submit" value="submit" name="submit">
</form>

Brochure Distribution option will already be selected when it displays the drop down list, because in the volunteers_2009 table, column venue_id is 4. 
```

我知道从场地表中提取场地列表将采用 for 或 while 循环的形式

我的查询是：

```
$query = "SELECT volunteers_2009.id, volunteers_2009.comments, volunteers_2009.choice1, volunteers_2009.choice2, volunteers_2009.choice3, volunteers_2009.lname, volunteers_2009.fname, volunteers_2009.venue_id, venues.venue_name FROM volunteers_2009 AS volunteers_2009 LEFT OUTER JOIN venues ON (volunteers_2009.venue_id = venues.id) ORDER by $order $sort"; 
```

如何使用场所表中的场所（**志愿者****_2009.venue_id**、场所.id ）填充选择下拉框并让它在列表中预先选择场所？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-14T00:48:48.477

```
$query = "SELECT volunteers_2009.id, volunteers_2009.comments, volunteers_2009.choice1, volunteers_2009.choice2, volunteers_2009.choice3, volunteers_2009.lname, volunteers_2009.fname, volunteers_2009.venue_id, venues.venue_name FROM volunteers_2009 AS volunteers_2009 LEFT OUTER JOIN venues ON (volunteers_2009.venue_id = venues.id) ORDER by $order $sort";

$res = mysql_query($query);
echo "<select name = 'venue'>";
while (($row = mysql_fetch_row($res)) != null)
{
    echo "<option value = '{$row['venue_id']}'";
    if ($selected_venue_id == $row['venue_id'])
        echo "selected = 'selected'";
    echo ">{$row['venue_name']}</option>";
}
echo "</select>"; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T01:45:44.197

假设您有一系列场地......我个人不喜欢将 sql 与其他魔法混合。

```
function displayDropDown($items, $name, $label, $default='') {
  if (count($items)) {
    echo '<select name="' . $name . '">';
    echo '<option value="">' . $label . '</option>';
    echo '<option value="">----------</option>';
    foreach($items as $item) {
      $selected = ($item['id'] == $default) ? ' selected="selected" : '';
      echo <option value="' . $item['id'] . '"' . $selected . '>' . $item['name'] . '</option>';
    }
    echo '</select>';
  } else {
    echo 'There are no venues';
  }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-04-10T13:01:41.003

```
 <?php 
        $query = "SELECT * from blogcategory";
        //$res = mysql_query($query);
        $rows = $db->query($query);
        echo "<select name = 'venue'>";
        // while (($row = mysql_fetch_row($res)) != null)
        while ($record = $db->fetch_array($rows)) 
        {
            echo "<option value = '{$record['CategoryId']}'";
            if ($CategoryId == $record['CategoryId'])
                echo "selected = 'selected'";
            echo ">{$record['CategoryName']}</option>";
        }
        echo "</select>";
        ?> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-09-21T07:57:49.680

```
<!DOCTYPE html>
<html>
<head>
    <title>table binding</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>
<body>
    <div id="mydiv" style="width:100px;height:100px;background-color:yellow">

        <select id="myselect"></select>
    </div>

</body>
</html>

<?php
include('dbconnection.php');

$sql = "SHOW TABLES FROM $dbname";
$result = mysqli_query($conn,$sql);

if (!$result) {
    echo "DB Error, could not list tables\n";
    echo 'MySQL Error: ' . mysqli_error();
    exit;
}

while ($row = mysqli_fetch_row($result)) {
    echo "<script>
    var z = document.createElement('option');
    z.setAttribute('value', '".$row[0]."');
    var t = document.createTextNode('".$row[0]."');
    z.appendChild(t);
    document.getElementById('myselect').appendChild(z);</script>";

}

?> 
```

# logging - 100% 内存 HSQL 数据库

> ID：199598
> 
> 赞同：6
> 
> 时间：2008-10-14T00:41:34.140
> 
> 标签：logging, hsqldb, in-memory-tables

我有一个 Java 应用程序设置为服务，每隔几个小时对约 3GB 的数据进行数据挖掘。我希望这在内存中 100% 发生。理想情况下，我希望应用程序与一切隔离；我希望它构建数据库，进行我需要的挖掘，并在完成后拆除数据库。

然而，对于 HSQLDB，即使我使用“创建内存表....”命令，也会写入所有语句的日志，并在下次应用程序运行时重新创建表。

我做了很多插入，~150k+，所以这个文件的大小会很快增长。我也不关心在下次运行时重建数据库，所以日志记录对我来说毫无用处。

完成后我可以删除文件，但如果可能的话，我想避免将那么多内容写入磁盘。

有没有办法关闭这个功能？

提前致谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T00:51:07.660

没问题，只需打开数据库连接：

```
 Connection c = DriverManager.getConnection("jdbc:hsqldb:mem:aname", "sa", ""); 
```

有关详细信息，请参阅[HSQL 文档](http://hsqldb.org/web/hsqlDocsFrame.html)。

# ruby - 你如何对 Ruby 代码进行字符串化/序列化？

> ID：199603
> 
> 赞同：16
> 
> 时间：2008-10-14T00:44:41.917
> 
> 标签：ruby, serialization, lambda, proc-object

我希望能够在我的 Ruby 代码中编写 lambda/Proc，对其进行序列化以便我可以将其写入磁盘，然后稍后执行 lambda。有点像...

```
x = 40
f = lambda { |y| x + y }
save_for_later(f) 
```

后来，在单独运行 Ruby 解释器时，我想说...

```
f = load_from_before
z = f.call(2)
z.should == 42 
```

Marshal.dump 不适用于 Procs。我知道 Perl 有[Data::Dump::Streamer](http://search.cpan.org/~yves/Data-Dump-Streamer-2.08-40/lib/Data/Dump/Streamer.pm)，而在 Lisp 中这是微不足道的。但是有没有办法在 Ruby 中做到这一点？换句话说， 的实施将是什么？`save`_`for`_`later`

**编辑**：[我下面的答案](https://stackoverflow.com/questions/199603/how-do-you-stringize-serialize-ruby-code/199803#199803)很好，但它不会关闭自由变量（如`x`）并将它们与 lambda 一起序列化。所以在我的例子中......

```
x = 40
s = save_for_later { |y| x + y }
# => "lambda { |y|\n  (x + y)\n}" 
```

...字符串输出不包含`x`. 是否有考虑到这一点的解决方案，也许是通过序列化符号表？你可以在 Ruby 中访问它吗？

**编辑 2**：我更新了我的答案以包含序列化局部变量。这似乎可以接受。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-14T02:16:44.040

**使用 Ruby2Ruby**

```
def save_for_later(&block)
  return nil unless block_given?

  c = Class.new
  c.class_eval do
    define_method :serializable, &block
  end
  s = Ruby2Ruby.translate(c, :serializable)
  s.sub(/^def \S+\(([^\)]*)\)/, 'lambda { |\1|').sub(/end$/, '}')
end

x = 40
s = save_for_later { |y| x + y }
# => "lambda { |y|\n  (x + y)\n}"
g = eval(s)
# => #<Proc:0x4037bb2c@(eval):1>
g.call(2) 
# => 42 
```

这很棒，但它不会关闭自由变量（如`x`）并将它们与 lambda 一起序列化。

要[序列化变量](https://stackoverflow.com/questions/503583/how-do-you-access-the-symbol-table-in-ruby)，您也可以迭代`local_variables`并序列化它们。但是，问题在于仅在`local_variables`内部`save_for_later`访问`c`和`s`在上面的代码中——即序列化代码的本地变量，而不是调用者。所以不幸的是，我们必须将局部变量及其值的获取推送给调用者。

不过，这也许是件好事，因为一般来说，在一段 Ruby 代码中找到所有自由变量是[不可判定](http://en.wikipedia.org/wiki/Undecidable)的。另外，理想情况下，我们还将保存`global_variables`任何已加载的类及其覆盖的方法。这似乎不切实际。

使用这种简单的方法，您将获得以下信息：

```
def save_for_later(local_vars, &block)
  return nil unless block_given?

  c = Class.new
  c.class_eval do
    define_method :serializable, &block
  end
  s = Ruby2Ruby.translate(c, :serializable)
  locals = local_vars.map { |var,val| "#{var} = #{val.inspect}; " }.join
  s.sub(/^def \S+\(([^\)]*)\)/, 'lambda { |\1| ' + locals).sub(/end$/, '}')
end

x = 40
s = save_for_later(local_variables.map{ |v| [v,eval(v)] }) { |y| x + y }
# => "lambda { |y| _ = 40; x = 40;\n  (x + y)\n}"

# In a separate run of Ruby, where x is not defined...
g = eval("lambda { |y| _ = 40; x = 40;\n  (x + y)\n}")
# => #<Proc:0xb7cfe9c0@(eval):1>
g.call(2)
# => 42

# Changing x does not affect it.
x = 7
g.call(3)
# => 43 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-05-20T13:30:14.927

**使用[源化](https://github.com/ngty/sourcify)**

这将适用于 Ruby 1.8 或 1.9。

```
def save_for_later(&block)
  block.to_source
end

x = 40
s = save_for_later {|y| x + y }
# => "proc { |y| (x + y) }"
g = eval(s)
# => #<Proc:0x00000100e88450@(eval):1>
g.call(2) 
# => 42 
```

有关捕获自由变量，请参阅[我的其他答案](https://stackoverflow.com/questions/199603/how-do-you-stringize-serialize-ruby-code/199803#199803)。

**更新**：现在您还可以使用[serializable_proc](https://github.com/ngty/serializable_proc) gem，它使用了 sourcify，并捕获本地、实例、类和全局变量。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T01:40:31.633

查看[这个问题](https://stackoverflow.com/questions/23970/how-do-i-marshall-a-lambda-proc-in-ruby)的答案。

* * *

## 回答 #4

> 赞同：-9
> 
> 时间：2008-10-14T00:49:11.190

Ruby 的 Marshal 类有一个可以调用的转储方法。

看看这里：

[http://rubylearning.com/satishtalim/object_serialization.html](http://rubylearning.com/satishtalim/object_serialization.html)

# qt - Windows 下的 GTK+ 或 Qt

> ID：199604
> 
> 赞同：23
> 
> 时间：2008-10-14T00:44:46.223
> 
> 标签：qt, gtk

我想知道如果我需要在 WIN 和 Linux 这两个平台上使用该软件，我应该考虑哪一个，为什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-14T15:07:47.480

打包 GTK 及其在 Windows 上的依赖项本身就是一个全职项目。Qt 更容易分发，因为它没有 Windows 不附带的依赖项。

Qt 从一开始就是跨平台的。GTK 并不总是跨平台的。这样的基本决定塑造了整体设计，在我看来应该在编写任何代码之前做出。

我会发表更多评论，但我会陷入猜测，以上两件事我肯定知道。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-14T01:27:36.853

两者都是很好的工具包，各有优缺点。

一个区别是实现语言。Qt 在 C++ 中，而 GTK+ 在 C 中。但是 GTK+ 具有许多其他语言（perl、python、C++、.NET 等）的绑定，所以这不是一个大问题。

Qt 的一个优点是它提供了更广泛的内置功能（xml、数据库访问、网络编程、openGL 等）。GTK+ 基本上所有这些东西都在它的轨道内（例如 libxml2、librsvg、libsoup、libgda 等），但它们不像 Qt 那样是一个单一的连贯包。

我个人的建议是使用[gtkmm](http://gtkmm.org/)，这是 GTK+ 的 C++ 绑定。它提供了一种更舒适的面向对象的编程语言，并且提供了与使用 C 语言的 GTK+ 几乎相同的本机性能。（免责声明：我为 gtkmm 做出了贡献）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T00:55:06.420

GTK+ 您几乎可以在所有编程语言中使用，包括 C++（使用 gtkmm）、C（gtk+）、C#（使用 Gtk#）、Python（PyGtk）。在 GTK 背后，您拥有 Mono Framework，它是用于跨平台目的的 .NET Framework 的出色实现。如果你想使用 Gtk#，你有一个很棒的 IDE (MonoDevelop) 和一个非常强大的 gui 设计器。您可以查看 www.mono-project.org。但仍然取决于您要构建什么，您只是在寻找 gui 工具包，还是整个框架？信号/插槽背后的逻辑在 Gtk+ 和 Qt 中是相同的，但是如果您使用 Gtk#，它们会在委托/事件范式中进行转换。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-14T01:00:23.697

我的 0.02 美元：

在过去的 4 年里，我断断续续地使用 Qt，它是我尝试过的任何工具（Win32、MFC、Borland、Java、GTK）中最喜欢的工具包。我用了几个星期的 GTK 来试用它，但并不喜欢它。主要是因为我认为在 PC 上的 GUI 应用程序中使用 C 而不是 C++ 很尴尬……我也做嵌入式工作，而且我永远不会在 8051 上使用 C++，但对于大型 GUI 应用程序我更喜欢它. 如果您要尝试 GTK，我建议您查看[GTKmm](http://en.wikipedia.org/wiki/Gtkmm)，尽管我自己从未使用过它。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-14T01:03:37.743

你也可以考虑 wxWidgets。我从来没有使用过它们中的任何一个，但是当我查看跨平台工具包时，它是我决定尝试的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-14T00:46:13.787

它们都是很好的工具包。我会根据许可做出决定。如果您在商业产品中使用 Qt，而 GTK 不需要，您需要为许可证付费。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-15T00:40:07.683

支持 Qt 的另外三点：

1.  您的项目不必*是*GPL；[Qt GPL Exception](http://doc.trolltech.com/4.4/license-gpl-exceptions.html)中还有许多其他开源许可证，包括 BSD 和 LGPL。
2.  Qt 在 Windows 上的默认主题在融入方面比 GTK 的 Wimp 主题要好得多。
3.  如果您以后想支持 Mac，那么使用 Qt 会更轻松。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-04-27T00:10:14.327

我更喜欢Qt。与今天一样，Qt 在更宽松的 LGPL 许可下是开源和免费的。Qt 更好地移植到 Windows 上，并且看起来比 GTK 更原生。例如，Windows 上的 Gimp 看起来很奇怪，因为它的大多数对话框都不是 Windows 对话框。Qt 可以使用像 Open/Save 这样的原生 Window 对话框，这使它作为一个框架感觉更好。是的，Qt 是一个框架，而不仅仅是一个 GUI Widget。不，我不是在这里宣传 Qt，因为从开发的角度来看，Qt 对于 Windows 用户来说有些陌生，例如，Qt 是基于布局的，而 MFC / .NET 是基于锚的，Qt 的布局管理器有时很奇怪。但是如果我必须在 GTK 和 Qt 之间进行选择，我会选择 Qt。另外，现在，Qt 带有非常好的 IDE，Qt Creator，它是我现在所有类型项目的默认 C/C++ IDE（因为 Qt Creator 可以这样使用）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-01-25T23:06:02.703

Qt 5.0 赢得了这场战争。我不是 C++ 的忠实粉丝（我更喜欢普通的旧 C），但我必须承认 Qt 框架很棒。尝试使用 GTK 编写一个在 OSX、Linux、Windows（以及很快的 iOS 和 Android）上运行的具有原生外观和感觉的 GUI 程序......祝你好运！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-01-21T16:51:40.253

我推荐使用 Qt，因为：

*   它是跨平台的，并且涵盖了广泛的操作系统（包括移动）
*   它是开源的，并且在变得更好时速度很快
*   它有一个不错的 GUI 设计器和一个非常强大的 IDE（Qt Creator）
*   API设计优秀且易于使用
*   它有一个很好的文档，易于阅读
*   它具有 Qt 翻译系统，使您能够拥有多语言应用程序
*   小部件根据布局调整自身大小的 GUI 布局系统使一切变得更加容易
*   QML 使您能够创建具有出色图形和动画的出色 GUI
*   它对网络和连接（socket，SSL，www，IPC，...）有很好的支持
*   它有用于测试代码的 QTestLib
*   如果您不想使用 C++，它有很多语言绑定

# visual-studio - 我可以使用 Visual Studio 2008 编译旧版 MFC 应用程序吗？

> ID：199605
> 
> 赞同：2
> 
> 时间：2008-10-14T00:44:52.480
> 
> 标签：visual-studio, mfc

我使用 Visual Studio 7 维护了几个旧的 MFC 应用程序，我正在考虑升级到 Visual Studio 2008。在阅读[了这个问题](https://stackoverflow.com/questions/86562/what-is-missing-in-the-visual-studio-express-editions#86614)之后，我意识到 Express 版将无法做到这一点。

有谁知道我是否可以用 VS2008 标准版编译旧的 MFC 应用程序，还是需要更昂贵的专业版？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T00:49:05.277

是的，标准版包括对 MFC/ATL 的支持。

仅供参考，您可以[比较功能](http://msdn.microsoft.com/en-us/vs2008/products/cc149003.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T11:35:55.597

您将拥有使用标准版构建 MFC 应用程序所需的一切。但是请注意，如果它是任何规模或复杂性的应用程序，则不仅仅是升级项目/解决方案文件并按 F5 的问题。VS7 和 2008 之间有很多重大变化，大部分是在 V8 编译器中引入的。卷起你的袖子。

# c++ - 应该如何将 C 位标志枚举转换为 C++？

> ID：199606
> 
> 赞同：3
> 
> 时间：2008-10-14T00:45:35.473
> 
> 标签：c++, c, enums, flags

C++ 主要是 C 的超集，但并非总是如此。特别是，虽然 C 和 C++ 中的枚举值都隐式转换为 int，但反之则不然：只有在 C 中，int 才转换回枚举值。因此，通过枚举声明定义的位标志不能正常工作。因此，这在 C 中是可以的，但在 C++ 中则不行：

```
typedef enum Foo
{
    Foo_First = 1<<0,
    Foo_Second = 1<<1,
} Foo;

int main(void)
{
    Foo x = Foo_First | Foo_Second; // error in C++
    return 0;
} 
```

应该如何有效和正确地处理这个问题，理想情况下不损害使用 Foo 作为变量类型的调试器友好性质（它分解为手表中的组件位标志等）？

还要考虑可能有数百个这样的标志枚举，以及数千个使用点。理想情况下，某种有效的运算符重载可以解决问题，但它确实应该是有效的；我想到的应用程序是受计算限制的，并且以速度快着称。

澄清：我正在将一个大型（>300K）C 程序翻译成 C++，所以我正在寻找运行时和开发时的有效翻译。简单地在所有适当的位置插入石膏可能需要数周时间。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-14T00:49:43.483

为什么不直接将结果转换回 Foo？

```
Foo x = Foo(Foo_First | Foo_Second); 
```

编辑：当我第一次回答这个问题时，我不明白你的问题的范围。以上将用于进行一些现场修复。对于您想要做的事情，您需要定义一个 | 接受 2 个 Foo 参数并返回 Foo 的运算符：

```
Foo operator|(Foo a, Foo b)
{
    return Foo(int(a) | int(b));
} 
```

int 强制转换是为了防止不需要的递归。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T00:50:46.147

这听起来像是一个理想的演员表应用程序——由你来告诉编译器是的，你的意思是用一个随机整数实例化一个 Foo 。

当然，从技术上讲，Foo_First | Foo_Second 不是 Foo 的有效值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T00:49:51.283

将结果保留为 int 或 static_cast：

```
Foo x = static_cast<Foo>(Foo_First | Foo_Second); // not an error in C++ 
```

# iphone - 核心动画围绕任意点旋转图层

> ID：199608
> 
> 赞同：3
> 
> 时间：2008-10-14T00:46:00.260
> 
> 标签：iphone, cocoa, core-animation

如何使用 Core Animation 围绕任意点旋转图层？（在我的情况下，一个点不在我要旋转的图层内）

我更喜欢在不更改锚点的情况下执行此操作，因为除非每次更改锚点时都出错，否则它也会更改图层的位置。

我尝试了类似的方法，但没有奏效：

```
[UIImageView beginAnimations:nil context:nil];
CATransform3D rotationTransform = CATransform3DIdentity;
rotationTransform = CATransform3DTranslate(rotationTransform, 0.0, -100.0, 0.0);
rotationTransform = CATransform3DRotate(rotationTransform, DegreesToRadians(180),
                        0.0, 0.0, 1.0);
rotationTransform = CATransform3DTranslate(rotationTransform, 0.0, 100.0, 0.0)
shape1.layer.transform = rotationTransform;
[UIImageView commitAnimations]; 
```

看起来旋转轴在旋转过程中正在移动。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T19:35:07.863

您的解决方案很好，但“预期的方式”是使用锚点。

当您设置锚点时它正在移动，因为位置附加到锚点，即设置位置集锚点在超层坐标系中的位置。

可能不值得改变，因为你有一些工作，但只是下次添加到灰质的东西。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T03:00:07.290

您可以通过附加多个转换来做到这一点：

1.  通过 (-rotCenterX, rotCenterY) 平移图层
2.  旋转图层
3.  通过 (rotCenterX, rotCenterY) 平移图层

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T20:07:39.873

您的初始解决方案并不好，因为翻译就像旋转一样具有动画效果。因此，您的旋转的“自定义中心”在旋转期间正在移动。您真正想要的是没有动画的翻译以及基于该非动画翻译的动画旋转。问题是，我目前有完全相同的问题，但还没有提出解决方案。我现在正在看 CATransaction，希望这可能是关键......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T16:17:50.750

我最终通过创建一个新的更大的层来实现它，它的中心位于我的旋转轴上，并将我想要旋转的层设置为它的子层。

然后我旋转较大的层而不是子层

# variant - 如何使用 EuCOM 在 Euphoria 中创建 BSTR 的变体数组？

> ID：199612
> 
> 赞同：1
> 
> 时间：2008-10-14T00:47:02.070
> 
> 标签：variant, typelib, safearray

到目前为止，我已经弄清楚了如何使用 Typelib 将 Unicode 字符串 bSTR 传入和传出 Euphoria DLL。到目前为止，我无法弄清楚的是如何创建和传回 BSTR 数组。

到目前为止我拥有的代码（以及`include`用于 EuCOM 本身和部分 Win32lib 的 s）：

```
global function REALARR()
  sequence seq
  atom psa
  atom var
  seq = { "cat","cow","wolverine" }
  psa = create_safearray( seq, VT_BSTR )
  make_variant( var, VT_ARRAY + VT_BSTR, psa )
  return var
end function 
```

类型库的一部分是：

```
 [
     helpstring("get an array of strings"), 
     entry("REALARR")
  ] 
  void __stdcall REALARR( [out,retval] VARIANT* res ); 
```

VB6中的测试代码是：

```
...
Dim v() as String
V = REALARR()
... 
```

到目前为止，我设法得到的只是来自 DLL 的错误“0”。有任何想法吗？任何人？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-04T18:43:49.587

您应该使用该`create_safearray()`功能。它在实用程序下记录（隐藏？）。基本上，将您的 BSTR 指针放入一个序列并将其传递给`create_safearray()`：

```
sequence s, bstrs
s = {"A", "B"}
bstrs = {}
for i = 1 to length(s) do
    bstrs &= alloc_bstr( s[i] )
end for

atom array
array = create_safearray( bstrs, VT_BSTR )

...

destroy_safearray( array ) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T07:15:11.317

我已经通过他们的[论坛](http://openeuphoria.org/EUforum/index.cgi?module=forum&action=flat&id=102589#unread)与 Euphoria 人取得了联系，并且已经走到了这一步。该例程在 make_variant 行上失败。除此之外，我还没有弄清楚，他们也没有。

```
global function REALARR() 
  atom psa 
  atom var 
  atom bounds_ptr 
  atom dim 
  atom bstr 
  object void 

  dim = 1 
  bounds_ptr = allocate( 8 * dim ) -- now figure out which part is Extent and which is LBound 
  poke4( bounds_ptr, { 3, 0 } ) -- assuming Extent and LBound in that order 

  psa = c_func( SafeArrayCreate, { VT_BSTR, 1, bounds_ptr } ) 

  bstr = alloc_bstr( "cat" ) 
  poke4( bounds_ptr, 0 ) 
  void = c_func( SafeArrayPutElement, {psa, bounds_ptr, bstr}) 
  free_bstr( bstr ) 

  bstr = alloc_bstr( "cow" ) 
  poke4( bounds_ptr, 1 ) 
  void = c_func( SafeArrayPutElement, {psa, bounds_ptr, bstr}) 
  free_bstr( bstr ) 

  bstr = alloc_bstr( "wolverine" ) 
  poke4( bounds_ptr, 2 ) 
  void = c_func( SafeArrayPutElement, {psa, bounds_ptr, bstr}) 
  free_bstr( bstr ) 

  make_variant( var, VT_ARRAY + VT_BSTR, psa )  
  return var 
end function 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T15:42:03.973

好的，`var`还没有初始化。这并不重要，因为例程仍然崩溃。尽管如此，还是需要一个

```
var = allocate( 16 ) 
```

就在 make_variant 之前

# sql-server-2008 - 在 SQL Server 2008 中，如何以除非连接到网络才能解密数据的方式保护数据？

> ID：199613
> 
> 赞同：0
> 
> 时间：2008-10-14T00:47:18.293
> 
> 标签：sql-server-2008, encryption, cryptography, tde

我们最近在 SQL Server 2008 中为我们开发人员笔记本电脑上的本地数据库实施了透明数据加密，以在笔记本电脑被盗或丢失的情况下保护它们。这工作正常。

现在我们正试图找出一种让证书每天过期的方法，强制一个自动化进程（可能是登录时的脚本）进入网络路径并获取一个过期一天后的新证书。这将确保如果发生意外情况，第二天数据将无法使用。

我还研究了使用 Cryptographic 提供程序，但那里似乎没有任何“提供程序”。也许我错了。

我愿意接受建议。如果有更好的方法请告诉我。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T01:17:03.817

简短的回答：没有

长答案：一旦消息（一段数据）被加密，相同的密钥将解密相同的加密消息，无论何时应用解密算法。如果每天更换密钥，则必须用旧密钥解密数据并用新密钥重新加密。如果这个过程没有发生（即有人停止了执行重新加密的代码段的运行），旧密钥仍然可以工作。即使您确实创建了一个加密提供程序来检查日期，其他人也可以创建一个新的提供程序来执行解密，而无需先检查日期。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-17T12:59:14.583

T 解决问题而不是动机。如果您使用派生模板设置 Microsoft CA（设置为过期一天）并且还允许在该证书模板上自动注册。然后，您可以将您的 SQL 机器设置为目录中使用自动注册的 OU 的一部分（Technet 将为您提供这方面的资源，需要使用 goup 策略）。这样，当证书过期时，机器会自动请求一个新的。

[http://windowsitpro.com/article/articleid/40948/windows-server-2003-pki-certificate-autoenrollment.html](http://windowsitpro.com/article/articleid/40948/windows-server-2003-pki-certificate-autoenrollment.html)

标记

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-31T16:11:16.947

Not true! There are options available for SQL Server 2008 encryption. Check out the database encryption solutions [here](http://townsendsecurity.com/solutions/data-protection/database-solutions) at TownsendSecurity.com. Townsend's Alliance AES Encryption is a NIST-certified solution that would put you into compliance with the regulations around health care, credit cards, and banking. Also see the [white paper](http://townsendsecurity.com/sites/default/files/AES_Introduction.pdf) on Alliance AES Encryption.

> *Businesses with sensitive data in database applications want to encrypt the data in order to secure it from loss. Protecting sensitive data increases customer trust and loyalty, reduces legal liability, and helps meet regulatory requirements for data security. Examples of databases that might contain sensitive information are Oracle Database, IBM DB2, Microsoft SQL Server, MySQL, and Microsoft Access. Regardless of the disk or folder encryption technology that might be used, the actual data should be encrypted to prevent loss*

Full disclosure: I'm an intern at Townsend Security.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T19:11:50.123

如果没有其他详细信息，我无法理解您的 TDE 设置将如何保护数据以防数据丢失或被盗。

如果您没有使用全盘加密（通过 Bitlocker、Truecrypt 等），那么我作为物理拥有您硬件的攻击者可以轻松重置本地管理员密码、启动笔记本电脑并使用本地管理员凭据访问 SQL Server 实例. 那时我是数据库服务器上的系统管理员，能够提取我想要的任何数据或关闭 TDE。

此外，由于所有加密密钥和证书都存储在本地，因此物理拥有设备的攻击者相对容易获得对它们的访问权限。只有当您将数据库加密密钥保护器（存储在主数据库中）与加密数据库物理分离时，TDE 才对数据保护有意义。

如果您使用全盘加密，那么使用 TDE 不会对攻击者提供任何额外的威慑，只会对开发人员笔记本电脑的系统性能产生不利影响。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T01:03:41.857

你是对的——你想要的是一个加密提供者，你是对的，那里还没有。

如果您要参加 11 月的 PASS 峰会，请与 Microsoft 的 JC Cannon 交谈。他正在做一个关于合规性的会议，他是 SQL Server 合规性小组的负责人。他与目前致力于构建加密提供程序的供应商有联系，他也许可以与您讨论供应商名称。目前他们还没有公开宣布谁在做这件事。

# unit-testing - 脆弱的单元测试总是一件坏事吗？

> ID：199615
> 
> 赞同：14
> 
> 时间：2008-10-14T00:49:04.903
> 
> 标签：unit-testing

有时我发现一个非常[脆弱的测试](http://www.thedeveloperday.com/avoiding-brittle-tests-testing-output/)是一件好事，因为当我改变被测代码的意图时，我想确保我的单元测试中断，以便我被迫重构......构建大量的回归测试？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-14T01:00:06.347

单元测试**必须**是脆弱的——它**必须**很容易破坏它们。如果它们没有中断，那么它们根本就不是单元测试；它们是代码注释。

...

还是我错过了问题的重点？

* * *

**编辑：**我应该澄清我之前的答案。

我对语言有点迂腐。“脆”只是意味着“容易折断”。单元测试*应该*很容易破解。术语“脆性测试”实际上应该是“*过度*脆性测试”；不应该中断的测试。即便如此，修复一个过脆的测试比修复一个通过欠脆测试的错误要容易得多，所以继续编写你的脆弱测试吧！

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-14T00:59:09.580

告诫脆弱单元测试的一般声明主要适用于尚未完全接受单元测试的商店。例如，当试图从没有测试转换为拥有一整套单元测试时，或者当您的项目是单元测试试点项目时。在这些情况下，开发人员习惯于单元测试的误报并开始忽略它们。然后单元测试落后于生产代码，要么被抛在后面，要么需要付出很大的努力来更新。

我会说您应该始终针对最不脆弱的测试来全面测试您的功能/模块，但是如果您有 1 或 2 个脆弱的测试，那么在大多数情况下您应该没问题。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-14T00:51:32.370

IMO，只要您的测试确保您的应用程序代码执行它应该做的事情，并且如果更改，测试失败，那么您的测试就可以了。你能定义一下你所说的“脆弱”是什么意思吗？

只需确保您的测试真正涵盖应用程序代码的各个方面。（在合理范围内）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-14T05:13:55.337

正如dysfunctor指出的那样，单元测试应该很脆弱，因为它们很容易被破坏。但是，我要补充一点，它们不应该因为它们随机通过或失败而变得脆弱。

这在涉及线程和套接字的测试中经常发生。测试应使用互斥锁和其他“等待”设备，以避免测试在无法控制的情况下失败，例如高处理器负载。

随机脆弱测试的明确“气味”是在测试中使用 sleep() 函数。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-04-07T23:10:11.960

是的，测试的脆弱性总是一件坏事。但这似乎是我们为了全面测试我们的课程而必须忍受的事情之一。许多类不能像接受一些输入并返回一些输出的黑盒那样进行测试，就像您在 Math.cos() 中看到的那样。它们中的大多数对系统中的其他类或实体都有副作用，您必须测试这些实体是否被类正确操作。这意味着测试必须知道关于被测试类的实现细节，这会创建脆弱的类。

脆性测试就像直肠科检查。它们绝对是不好的、不愉快的事情，但我们必须忍受它们，因为我们没有更好的选择。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-10-19T05:02:41.967

当对类“内部”的代码更改（即不更改 API）导致测试失败时，有两种可能性：

1.  代码有一个新错误，或者
2.  代码正确，测试需要修复

尝试减少#2。这些是“脆弱”测试。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-05-15T15:16:23.103

单元测试根据定义是脆弱的。当相关代码（被测系统）更改时，它们会中断。这是设计使然。这就是单元测试提供价值的方式。

我们要避免的是在代码更改但逻辑没有更改时中断的测试。例如，不希望在添加新需求时中断大多数现有测试。

不幸的是，避免这种脆性并不容易。除了最简单的情况外，单元测试将对被测系统的实现有一些了解（例如，模拟对象）。只要这是真的，测试就会很脆弱。

避免该问题的最佳方法是避免编写需要更改的类。在坚持 SOLID 原则时，这实际上比听起来容易。

# java - scp 通过 java

> ID：199624
> 
> 赞同：84
> 
> 时间：2008-10-14T00:50:49.953
> 
> 标签：java, scp, bouncycastle, jsse, jsch

通过 Java 编程语言执行 scp 传输的最佳方法是什么？看来我可以通过 JSSE、JSch 或 bouncy castle java 库来执行此操作。这些解决方案似乎都没有一个简单的答案。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-14T01:22:37.130

我最终使用了[Jsch——](http://www.jcraft.com/jsch/)它非常简单，而且似乎可以很好地扩展（我每隔几分钟就抓取几千个文件）。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2010-03-08T21:15:11.277

插头：sshj 是唯一明智的选择！请参阅以下示例以开始使用：[下载](https://github.com/hierynomus/sshj/blob/master/examples/src/main/java/net/schmizz/sshj/examples/SCPDownload.java)、[上传](https://github.com/hierynomus/sshj/blob/master/examples/src/main/java/net/schmizz/sshj/examples/SCPUpload.java)。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-14T00:57:37.163

看看[这里](http://kickjava.com/src/org/apache/tools/ant/taskdefs/optional/ssh/Scp.java.htm)

那是 Ants 的 SCP 任务的源代码。“执行”方法中的代码是它的具体细节。这应该让您对所需的内容有一个公平的了解。我相信它使用JSch。

或者，您也可以直接从您的 java 代码中执行此 Ant 任务。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-12-25T22:25:28.950

我用一些实用方法包装了 Jsch 以使其更友好并调用它

# jscp

可在此处获得：[https ://github.com/willwarren/jscp](https://github.com/willwarren/jscp)

SCP 实用程序 tar 一个文件夹，将其压缩，并将其 scp 到某个位置，然后解压缩。

用法：

```
// create secure context
SecureContext context = new SecureContext("userName", "localhost");

// set optional security configurations.
context.setTrustAllHosts(true);
context.setPrivateKeyFile(new File("private/key"));

// Console requires JDK 1.7
// System.out.println("enter password:");
// context.setPassword(System.console().readPassword());

Jscp.exec(context, 
           "src/dir",
           "destination/path",
           // regex ignore list 
           Arrays.asList("logs/log[0-9]*.txt",
           "backups") 
           ); 
```

还包括有用的类 - Scp 和 Exec，以及 TarAndGzip，它们的工作方式几乎相同。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-04-05T14:39:10.497

这是**高级解决方案**，无需重新发明。又快又脏！

**1)**首先，访问[http://ant.apache.org/bindownload.cgi](http://ant.apache.org/bindownload.cgi)并下载最新的 Apache Ant 二进制文件。（现在，apache-ant-1.9.4-bin.zip）。

**2）**解压下载的文件，找到JAR **ant-jsch.jar**（“apache-ant-1.9.4/lib/ant-jsch.jar”）。**在您的项目中添加这个 JAR**。还有 ant-launcher.jar 和 ant.jar。

**3)**转到[Jcraft jsch SouceForge 项目](http://sourceforge.net/projects/jsch/files/jsch.jar/)并下载 jar。如今，[jsch-0.1.52.jar](http://sourceforge.net/projects/jsch/files/jsch.jar/0.1.52/jsch-0.1.52.jar/download)。还要**将此 JAR 添加到您的项目**中。

现在，您可以轻松地将 Ant Classes **Scp**用于通过网络复制文件或**SSHExec**用于 SSH 服务器中的命令的 java 代码。

**4)**代码示例 Scp：

```
// This make scp copy of 
// one local file to remote dir

org.apache.tools.ant.taskdefs.optional.ssh.Scp scp = new Scp();
int portSSH = 22;
String srvrSSH = "ssh.your.domain";
String userSSH = "anyuser"; 
String pswdSSH = new String ( jPasswordField1.getPassword() );
String localFile = "C:\\localfile.txt";
String remoteDir = "/uploads/";

scp.setPort( portSSH );
scp.setLocalFile( localFile );
scp.setTodir( userSSH + ":" + pswdSSH + "@" + srvrSSH + ":" + remoteDir );
scp.setProject( new Project() );
scp.setTrust( true );
scp.execute(); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-14T00:56:51.597

[openssh 项目](http://www.openssh.com/java.html)列出了几个 Java 替代方案，[Trilead SSH for Java](http://www.trilead.com/Products/Trilead_SSH_for_Java/)似乎符合您的要求。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-18T08:26:10.257

我使用这个 SFTP API，它有一个叫做 Zehon 的 SCP，它很棒，很容易使用，有很多示例代码。这是网站[http://www.zehon.com](http://www.zehon.com)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-10-24T16:58:33.847

我查看了很多这样的解决方案，但其中很多都不喜欢。主要是因为必须识别已知主机的烦人步骤。相对于 scp 命令，这和 JSCH 处于可笑的低水平。

我找到了一个不需要这个但它被捆绑并用作命令行工具的库。 [https://code.google.com/p/scp-java-client/](https://code.google.com/p/scp-java-client/)

我查看了源代码，发现了如何在没有命令行的情况下使用它。下面是一个上传示例：

```
 uk.co.marcoratto.scp.SCP scp = new uk.co.marcoratto.scp.SCP(new uk.co.marcoratto.scp.listeners.SCPListenerPrintStream());
    scp.setUsername("root");
    scp.setPassword("blah");
    scp.setTrust(true);
    scp.setFromUri(file.getAbsolutePath());
    scp.setToUri("root@host:/path/on/remote");
    scp.execute(); 
```

最大的缺点是它不在 maven repo 中（我可以找到）。但是，易用性对我来说是值得的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-07-21T12:25:04.573

这是使用[JSch](http://www.jcraft.com/jsch)上传文件的示例：

`ScpUploader.java`：

```
import com.jcraft.jsch.ChannelSftp;
import com.jcraft.jsch.JSch;
import com.jcraft.jsch.JSchException;
import com.jcraft.jsch.Session;
import com.jcraft.jsch.SftpException;

import java.io.ByteArrayInputStream;
import java.util.Properties;

public final class ScpUploader
{
    public static ScpUploader newInstance()
    {
        return new ScpUploader();
    }

    private volatile Session session;
    private volatile ChannelSftp channel;

    private ScpUploader(){}

    public synchronized void connect(String host, int port, String username, String password) throws JSchException
    {
        JSch jsch = new JSch();

        Properties config = new Properties();
        config.put("StrictHostKeyChecking", "no");

        session = jsch.getSession(username, host, port);
        session.setPassword(password);
        session.setConfig(config);
        session.setInputStream(System.in);
        session.connect();

        channel = (ChannelSftp) session.openChannel("sftp");
        channel.connect();
    }

    public synchronized void uploadFile(String directoryPath, String fileName, byte[] fileBytes, boolean overwrite) throws SftpException
    {
        if(session == null || channel == null)
        {
            System.err.println("No open session!");
            return;
        }

        // a workaround to check if the directory exists. Otherwise, create it
        channel.cd("/");
        String[] directories = directoryPath.split("/");
        for(String directory : directories)
        {
            if(directory.length() > 0)
            {
                try
                {
                    channel.cd(directory);
                }
                catch(SftpException e)
                {
                    // swallowed exception

                    System.out.println("The directory (" + directory + ") seems to be not exist. We will try to create it.");

                    try
                    {
                        channel.mkdir(directory);
                        channel.cd(directory);
                        System.out.println("The directory (" + directory + ") is created successfully!");
                    }
                    catch(SftpException e1)
                    {
                        System.err.println("The directory (" + directory + ") is failed to be created!");
                        e1.printStackTrace();
                        return;
                    }

                }
            }
        }

        channel.put(new ByteArrayInputStream(fileBytes), directoryPath + "/" + fileName, overwrite ? ChannelSftp.OVERWRITE : ChannelSftp.RESUME);
    }

    public synchronized void disconnect()
    {
        if(session == null || channel == null)
        {
            System.err.println("No open session!");
            return;
        }

        channel.exit();
        channel.disconnect();
        session.disconnect();

        channel = null;
        session = null;
    }
} 
```

`AppEntryPoint.java`：

```
import com.jcraft.jsch.JSchException;
import com.jcraft.jsch.SftpException;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;

public final class AppEntryPoint
{
    private static final String HOST = "192.168.1.1";
    private static final int PORT = 22;
    private static final String USERNAME = "root";
    private static final String PASSWORD = "root";

    public static void main(String[] args) throws IOException
    {
        ScpUploader scpUploader = ScpUploader.newInstance();

        try
        {
            scpUploader.connect(HOST, PORT, USERNAME, PASSWORD);
        }
        catch(JSchException e)
        {
            System.err.println("Failed to connect the server!");
            e.printStackTrace();
            return;
        }

        System.out.println("Successfully connected to the server!");

        byte[] fileBytes = Files.readAllBytes(Paths.get("C:/file.zip"));

        try
        {
            scpUploader.uploadFile("/test/files", "file.zip", fileBytes, true); // if overwrite == false, it won't throw exception if the file exists
            System.out.println("Successfully uploaded the file!");
        }
        catch(SftpException e)
        {
            System.err.println("Failed to upload the file!");
            e.printStackTrace();
        }

        scpUploader.disconnect();
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-09-08T12:35:42.257

JSch 是一个很好的库。对于您的问题，它有一个非常简单的答案。

```
JSch jsch=new JSch();
  Session session=jsch.getSession(user, host, 22);
  session.setPassword("password");

  Properties config = new Properties();
  config.put("StrictHostKeyChecking","no");
  session.setConfig(config);
  session.connect();

  boolean ptimestamp = true;

  // exec 'scp -t rfile' remotely
  String command="scp " + (ptimestamp ? "-p" :"") +" -t "+rfile;
  Channel channel=session.openChannel("exec");
  ((ChannelExec)channel).setCommand(command);

  // get I/O streams for remote scp
  OutputStream out=channel.getOutputStream();
  InputStream in=channel.getInputStream();

  channel.connect();

  if(checkAck(in)!=0){
    System.exit(0);
  }

  File _lfile = new File(lfile);

  if(ptimestamp){
    command="T "+(_lfile.lastModified()/1000)+" 0";
    // The access time should be sent here,
    // but it is not accessible with JavaAPI ;-<
    command+=(" "+(_lfile.lastModified()/1000)+" 0\n");
    out.write(command.getBytes()); out.flush();
    if(checkAck(in)!=0){
      System.exit(0);
    }
  } 
```

您可以在以下位置找到完整代码

[http://faisalbhagat.blogspot.com/2013/09/java-uploading-file-remotely-via-scp.html](http://faisalbhagat.blogspot.com/2013/09/java-uploading-file-remotely-via-scp.html)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-10-24T20:44:25.210

jsCH 对我来说非常有用。下面是连接到 sftp 服务器并将文件下载到指定目录的方法示例。建议不要禁用 StrictHostKeyChecking。虽然设置起来有点困难，但出于安全原因，指定已知主机应该是规范。

**jsch.setKnownHosts("C:\Users\test\known_hosts");** 受到推崇的

**JSch.setConfig("StrictHostKeyChecking", "no");** - 不建议

```
import com.jcraft.jsch.*;
 public void downloadFtp(String userName, String password, String host, int port, String path) {

        Session session = null;
        Channel channel = null;
        try {
            JSch ssh = new JSch();
            JSch.setConfig("StrictHostKeyChecking", "no");
            session = ssh.getSession(userName, host, port);
            session.setPassword(password);
            session.connect();
            channel = session.openChannel("sftp");
            channel.connect();
            ChannelSftp sftp = (ChannelSftp) channel;
            sftp.get(path, "specify path to where you want the files to be output");
        } catch (JSchException e) {
            System.out.println(userName);
            e.printStackTrace();

        } catch (SftpException e) {
            System.out.println(userName);
            e.printStackTrace();
        } finally {
            if (channel != null) {
                channel.disconnect();
            }
            if (session != null) {
                session.disconnect();
            }
        }

    } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-01-08T15:46:36.700

像这里的一些人一样，我最终为 JSch 库编写了一个包装器。

它被称为 way-secshell，它托管在 GitHub 上：

[https://github.com/objectos/way-secshell](https://github.com/objectos/way-secshell)

```
// scp myfile.txt localhost:/tmp
File file = new File("myfile.txt");
Scp res = WaySSH.scp()
  .file(file)
  .toHost("localhost")
  .at("/tmp")
  .send(); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-11-05T05:42:13.170

*- ：如果您使用 Maven 进行依赖管理，请稍微完善费尔南多的答案：-*

**pom.xml**：

```
<dependency>
  <groupId>org.apache.ant</groupId>
  <artifactId>ant-jsch</artifactId>
  <version>${ant-jsch.version}</version>
</dependency> 
```

在您的项目中添加此依赖项。最新版本可以在[这里](https://mvnrepository.com/artifact/org.apache.ant/ant-jsch)找到。

**Java代码**：

```
public void scpUpload(String source, String destination) {
    Scp scp = new Scp();
    scp.setPort(port);
    scp.setLocalFile(source);
    scp.setTodir(username + ":" + password + "@" + host + ":" + destination);
    scp.setProject(new Project());
    scp.setTrust(true);
    scp.execute();
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-07-14T19:28:27.457

我写了一个 scp 服务器，它比其他的要容易得多。我使用 Apache MINA 项目（Apache SSHD）来开发它。您可以在这里查看：[https](https://github.com/boomz/JSCP) ://github.com/boomz/JSCP 您也可以从`/jar`目录下载 jar 文件。如何使用？看看：[https ://github.com/boomz/JSCP/blob/master/src/Main.java](https://github.com/boomz/JSCP/blob/master/src/Main.java)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-01-19T03:41:32.527

我需要递归复制文件夹，尝试不同的解决方案后，最终由 ProcessBuilder + expect/spawn

```
scpFile("192.168.1.1", "root","password","/tmp/1","/tmp");

public void scpFile(String host, String username, String password, String src, String dest) throws Exception {

    String[] scpCmd = new String[]{"expect", "-c", String.format("spawn scp -r %s %s@%s:%s\n", src, username, host, dest)  +
            "expect \"?assword:\"\n" +
            String.format("send \"%s\\r\"\n", password) +
            "expect eof"};

    ProcessBuilder pb = new ProcessBuilder(scpCmd);
    System.out.println("Run shell command: " + Arrays.toString(scpCmd));
    Process process = pb.start();
    int errCode = process.waitFor();
    System.out.println("Echo command executed, any errors? " + (errCode == 0 ? "No" : "Yes"));
    System.out.println("Echo Output:\n" + output(process.getInputStream()));
    if(errCode != 0) throw new Exception();
} 
```

# c++ - 将 C 源代码转换为 C++

> ID：199627
> 
> 赞同：41
> 
> 时间：2008-10-14T00:51:43.650
> 
> 标签：c++, c, refactoring, legacy, program-transformation

您将如何将相当大（>300K）、相当成熟的 C 代码库转换为 C++？

考虑到的 CI 被拆分为大致对应于模块的文件（即比典型的基于 OO 类的分解更细化），使用内部链接代替私有函数和数据，以及公共函数和数据的外部链接。全局变量广泛用于模块之间的通信。有一个非常广泛的集成测试套件可用，但没有单元（即模块）级别的测试。

我想到了一个总体策略：

1.  编译 C++ 的 C 子集中的所有内容并使其正常工作。
2.  将模块转换为巨大的类，以便所有交叉引用都由类名限定，但将所有函数和数据保留为静态成员，并使其正常工作。
3.  使用适当的构造函数和初始化的交叉引用将大类转换为实例；酌情用间接访问替换静态成员访问；并让它工作。
4.  现在，将项目作为一个错误因素的 OO 应用程序来处理，并在依赖项易于处理的情况下编写单元测试，并在它们不易于处理的情况下分解为单独的类；这里的目标是在每次转换时从一个工作程序转移到另一个工作程序。

显然，这将是相当多的工作。有没有关于这种翻译的案例研究/战争故事？替代策略？其他有用的建议？

注 1：该程序是一个编译器，可能有数百万其他程序依赖于它的行为不变，因此大规模重写几乎不是一种选择。

注意 2：源代码已有近 20 年的历史，每年可能有 30% 的代码流失（修改的行数 + 添加的行数/之前的总行数）。换句话说，它被大量维护和扩展。因此，目标之一是提高可维护性。

[为了这个问题，假设翻译成**C++**是强制性的，并且不能将其留在 C**中**。添加此条件的目的是清除“将其保留在 C 中”的答案。]

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-14T03:19:28.517

几个月前刚刚开始做几乎相同的事情（在一个有十年历史的商业项目上，最初是用“C++ 只不过是 C 和 smart `struct`s”哲学编写的），我建议使用与你相同的策略' d 习惯吃大象：一次吃一口。:-)

尽可能将其分成几个阶段，这些阶段可以在对其他部分的影响最小的情况下完成。[正如Federico Ramponi](https://stackoverflow.com/questions/199627/converting-c-source-to-c#199644)所建议的那样，构建外观系统是一个好的开始——一旦所有东西都具有 C++ 外观并通过它进行通信，您就可以相当肯定地更改模块的内部结构，确保它们不会影响外部的任何东西。

我们已经有了一个部分 C++ 接口系统（由于之前的重构工作较小），所以这种方法在我们的案例中并不困难。一旦我们将所有东西都作为 C++ 对象进行通信（这花了几周时间，在一个完全独立的源代码分支上工作，并在获得批准后将所有更改集成到主分支），我们很少能编译出一个完全在我们离开之前的工作版本。

转换还没有完成——我们已经暂停了两次临时发布（我们的目标是每隔几周发布一次），但它正在顺利进行，没有客户抱怨任何问题。我们的 QA 人员也只发现了一个我记得的问题。:-)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-14T00:57:39.847

关于什么：

1.  编译 C++ 的 C 子集中的所有内容并使其正常工作，并且
2.  实现一组[外观](http://en.wikipedia.org/wiki/Facade_pattern)保持 C 代码不变？

为什么“必须翻译成 C++”？您可以包装 C 代码，而无需将其转换为巨大的类等。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-14T04:32:57.020

您的应用程序有很多人在处理它，并且需要不被破坏。如果您对大规模转换为 OO 风格很认真，那么您需要大量的转换工具来自动化工作。

基本思想是将数据组指定为类，然后使用工具重构代码以将该数据移动到类中，将仅针对该数据的函数移动到这些类中，并将对该数据的所有访问修改为对类的调用.

您可以进行自动预分析以形成统计集群以获得一些想法，但您仍然需要一位具有应用意识的工程师来决定应该对哪些数据元素进行分组。

能够完成这项任务的工具是我们的[DMS Software Reengineering Toolkit](http://www.semdesigns.com/Products/DMS/DMSToolkit.html)。DMS 具有强大的 C 解析器来读取您的代码，将 C 代码捕获为编译器抽象语法树，（与传统编译器不同）可以计算整个 300K SLOC 的流分析。DMS 有一个可以用作“后端”的 C++ 前端；一个人编写将 C 语法映射到 C++ 语法的转换。

大型航空电子系统上的一项主要 C++ 重新设计任务提供了一些关于将 DMS 用于此类活动的概念。请参阅 www.semdesigns.com/Products/DMS/DMSToolkit.html 上的技术论文，特别是通过自动程序转换重新设计 C++ 组件模型

这个过程不适合胆小的人。但是，任何考虑手动重构大型应用程序的人已经不怕辛苦了。

是的，我是公司的首席架构师。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-14T00:54:57.233

我会在 C 接口上编写 C++ 类。不接触 C 代码将减少搞砸的机会并显着加快进程。

一旦你的 C++ 接口启动；那么将代码复制+粘贴到您的类中是一项微不足道的任务。正如您所提到的 - 在此步骤中，进行单元测试至关重要。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-08-29T15:06:47.610

GCC 目前正处于从 C 向 C++ 的过渡阶段。显然，他们首先将所有内容都移入了 C 和 C++ 的公共子集。当他们这样做时，他们向 GCC 添加了针对他们发现的所有内容的警告，在`-Wc++-compat`. 这应该让您踏上旅程的第一部分。

对于后面的部分，一旦你真的用 C++ 编译器编译了所有东西，我将专注于替换具有惯用 C++ 对应物的东西。例如，如果您正在使用使用 C 宏定义的列表、映射、集合、位向量、哈希表等，那么通过将它们迁移到 C++ 可能会收获很多。与 OO 类似，您可能会在已经使用 C OO 习惯用法（如结构继承）的地方找到好处，并且 C++ 将在您的代码上提供更高的清晰度和更好的类型检查。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-14T01:19:39.087

您的列表看起来不错，但我建议先查看测试套件并在进行任何编码之前尝试使其尽可能紧凑。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-14T02:03:52.820

让我们抛出另一个愚蠢的想法：

1.  编译 C++ 的 C 子集中的所有内容并使其正常工作。
2.  从一个模块开始，将其转换为一个巨大的类，然后在一个实例中，并从该实例中构建一个 C 接口（与您开始时的接口相同）。让剩余的 C 代码与该 C 接口一起工作。
3.  根据需要进行重构，一次将 OO 子系统从 C 代码中扩展一个模块，并在 C 接口变得无用时删除部分 C 接口。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-14T07:42:42.230

除了你想如何开始之外，可能还有两件事要考虑，那就是你想**关注**什么，以及你想在哪里**停止**。

你说有一个大的代码流失，这可能是你*集中精力*的关键。我建议你选择代码中需要大量维护的部分，成熟/稳定的部分显然工作得很好，所以最好保持原样，除了一些带有外墙的门面装饰等。

您要停止的位置取决于要转换为 C++ 的原因。这本身很难成为一个目标。如果是由于某些第 3 方依赖，请将精力集中在该组件的接口上。

我工作的软件是一个庞大的旧代码库，多年前已经从 C 语言“转换”为 C++。我认为这是因为 GUI 被转换为 Qt。即使是现在，它仍然看起来像一个带有类的 C 程序。打破公共数据成员造成的依赖关系，将具有过程怪物方法的巨大类重构为更小的方法和类从未真正起飞，我认为原因如下：

1.  无需更改正在运行且无需增强的代码。这样做会引入新的错误而没有添加功能，最终用户不会欣赏这一点；
2.  可靠地进行重构非常非常困难。许多代码是如此之大，也如此重要，以至于人们几乎不敢碰它。我们有一套相当广泛的功能测试，但很难获得足够的代码覆盖率信息。因此，很难确定是否已经有足够的测试来检测重构期间的问题；
3.  投资回报率很难确定。最终用户不会从重构中受益，因此它必须降低维护成本，最初会增加，因为重构会在成熟的代码中引入新的错误，即相当无错误的代码。重构本身也将是昂贵的......

注意。我想您知道“有效地使用旧代码”一书吗？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-08-29T15:12:36.320

您提到您的工具是一个编译器，并且：“实际上，模式匹配，而不仅仅是类型匹配，在多重调度中会更好”。

You might want to take a look at [maketea](http://code.google.com/p/maketea/). It provides pattern matching for ASTs, as well as the AST definition from an abstract grammar, and visitors, tranformers, etc.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-14T01:01:18.700

如果您有一个小型或学术项目（例如，少于 10,000 行），那么重写可能是您的最佳选择。您可以根据需要考虑它，并且不会花费太多时间。

如果您有一个真实世界的应用程序，我建议将其编译为 C++（这通常意味着主要修复函数原型等），然后进行重构和 OO 包装。当然，我不赞同代码必须是面向对象的结构才能成为可接受的 C++ 代码的理念。我会根据需要进行逐个转换、重写和重构（用于功能或合并单元测试）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-14T16:41:55.760

这是我要做的：

*   由于代码已有 20 年的历史，因此废弃解析器/语法分析器并将其替换为较新的基于 lex/yacc/bison（或任何类似的）等 C++ 代码，更易于维护和理解。如果您手边有 BNF，开发速度也会更快。
*   一旦对旧代码进行了改造，就开始将模块包装到类中。用接口替换全局/共享变量。
*   现在你所拥有的将是一个 C++ 编译器（虽然不完全）。
*   画出系统中所有类的类图，看看它们是如何通信的。
*   使用相同的类绘制另一个，看看它们应该如何通信。
*   重构代码以将第一个图表转换为第二个图表。（这可能是混乱和棘手的）
*   请记住对添加的所有新代码使用 C++ 代码。
*   如果您还有一些时间，请尝试将数据结构一一替换以使用更标准化的 STL 或 Boost。

# c# - 用于从 C# 获取 C 样式数组的函数的 IDL 声明（在 C++ 中）

> ID：199629
> 
> 赞同：0
> 
> 时间：2008-10-14T00:51:58.673
> 
> 标签：c#, c++, com, idl

我正在使用由一些用 C++ 编写的带有 C# 前端的 COM 接口组成的现有代码库。有一些新功能需要添加，所以我不得不修改 COM 部分。在一种特殊情况下，我需要将一个数组（从 C# 分配）传递给要填充的组件。

我想做的是能够将一个 int 数组从 C# 传递给该方法，例如：

```
// desired C# signature
void GetFoo(int bufferSize, int[] buffer);

// desired usage
int[] blah = ...;
GetFoo(blah.Length, blah); 
```

几个扳手在工作：

*   不能使用 C++/CLI 或托管 C++（在这种情况下可以取消 COM）。
*   C# 端不能用 /unsafe 编译（允许使用 Marshal）。

COM 接口仅由 C# 部分使用（将永远使用），因此我不太关心与其他 COM 使用者的互操作性。32 位和 64 位之间的可移植性也不是问题（一切都在 32 位机器上编译和运行，因此代码生成器正在将指针转换为整数）。最终，它将被 C++/CLI 取代，但这还有很长的路要走。

* * *

## 我最初的尝试

类似于：

```
HRESULT GetFoo([in] int bufferSize, [in, size_is(bufferSize)] int buffer[]); 
```

并且输出 TLB 定义是（似乎合理）：

```
HRESULT _stdcall GetFoo([in] int bufferSize, [in] int* buffer); 
```

这是由 C# 导入的（不太合理）：

```
void GetFoo(int bufferSize, ref int buffer); 
```

我*可以*用它

```
int[] b = ...;
fixed(int *bp = &b[0])
{
    GetFoo(b.Length, ref *bp);
} 
```

...除了我不能用 /unsafe 编译。

* * *

## 在这一刻

我在用：

```
HRESULT GetFoo([in] int bufferSize, [in] INT_PTR buffer); 
```

其中导入为：

```
void GetFoo(int bufferSize, int buffer); 
```

我需要像这样使用它：

```
int[] b = ...;
GCHandle bPin = GCHandle.Alloc(b, GCHandleType.Pinned);
try
{
    GetFoo(b.Length, (int)Marshal.UnsafeAddrOfPinnedArrayElement(b, 0));
}
finally
{
    bPin.Free();
} 
```

哪个有效...，但我想找到一种更清洁的方法。

* * *

## 所以，问题是

对于这种情况，是否存在对从 TLB 生成器导入 C# 友好的 IDL 定义？如果没有，在 C# 端可以做些什么来让它更安全一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T15:52:12.210

因此，您要求的 IDL 数据类型在 32 位机器上为 32 位，在 64 位机器上为 64 位。但是您不希望编组代码将其视为指针，就像 int 一样。那么当您从 64 位进程调用到 32 位进程时，您期望额外的 32 位会发生什么？

对我来说听起来像是违反物理学。

如果它只是 inproc，请参阅此讨论的底部：[http](http://www.techtalkz.com/vc-net/125190-how-interop-net-client-com-dll.html) ://www.techtalkz.com/vc-net/125190-how-interop-net-client-com-dll.html 。

建议似乎是使用 void * 而不是 intptr 并使用 [local] 标记，这样编组器就不会参与其中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T01:24:28.857

我不太了解 C# COM 可操作性，但是您是否尝试过使用 SAFEARRAY(INT_PTR) 或类似的东西？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T01:57:40.583

嗯...我找到了一些让我更接近的信息...

[编组更改 - 符合 C 样式的数组](http://msdn.microsoft.com/en-us/library/ek1fb3c6.aspx#cpconeditingmicrosoftintermediatelanguagemsilanchor1)

此 IDL 声明 (C++)

```
HRESULT GetFoo([in] int bufferSize, [in, size_is(bufferSize)] int buffer[]); 
```

导入为 (MSIL)

```
method public hidebysig newslot virtual instance void GetFoo([in] int32 bufferSize, [in] int32& buffer) runtime managed internalcall 
```

如果更改为 (MSIL)

```
method public hidebysig newslot virtual instance void GetFoo([in] int32 bufferSize, [in] int32[] marshal([]) buffer) runtime managed internalcall 
```

可以像 (C#) 一样使用

```
int[] b = ...;
GetFoo(b.Length, b); 
```

正是我想要的！

## 但是，是否有任何其他解决方案不需要修复由 tlbimport 生成的运行时可调用包装器的 MSIL？

# css - Web开发中如何选择颜色

> ID：199631
> 
> 赞同：4
> 
> 时间：2008-10-14T00:54:36.983
> 
> 标签：css, colors, styling, duplication

当我建立一个网站时，我倾向于在 Paint.NET 中进行一些图形设计（开发人员风格），但是我怎么知道颜色会在不同机器上的所有浏览器上正确显示呢？您通常编码的颜色深度是多少？16位256色等

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T01:04:13.767

我不担心颜色是否会在任何地方完美显示，因为即使是最基本的手机也支持 16 位颜色。

在我看来，**不必**担心“网络安全”颜色的日子已经过去了。

只要您不使用彼此非常相似的颜色，就应该很好。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-14T02:12:42.927

另一个需要考虑的项目是：

## 色盲

仅供参考，在选择颜色时，您可能需要考虑色盲，大约 5% 的男性是色盲。

本页描述了一个 Firefox 扩展，它允许用户（更重要的是开发人员）模拟[网页](http://live.gnome.org/GAP/ColorBlind)可能如何寻找色盲人群。

这里有更多关于[色盲的信息](http://en.wikipedia.org/wiki/Color_blindness)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T14:22:04.777

在相关说明中：注意使用 png 的。

不同的图像编辑器（不确定 Paint.NET）在 png 中嵌入了所谓的伽马校正信息。某些浏览器使用此伽玛校正信息，使 png 看起来与您期望的 rgb 颜色不同。

我个人在几个项目中遇到过这个问题，在这些项目中，将 png 转换为背景颜色在 Firefox 中是完美匹配，但在 IE 中却不是。

最佳做法是使用 pngcrush 删除伽马校正。无论如何这是一个好主意，因为它减少了整体文件大小，即使伽玛校正不是手头的问题。

如果您喜欢阅读，这里有更多信息：http: [//hsivonen.iki.fi/png-gamma](http://hsivonen.iki.fi/png-gamma)

抱歉，如果这听起来有点离题，但我只是想在使用颜色和 Paint.NET 在网络上使用时向您提及它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T00:57:49.130

[我无耻地从这里](http://www.colourlovers.com/palettes/top)偷了很多颜色样式。我对大多数人的计算机上的配色方案没有太多麻烦。

我这么说是因为我不是网页设计师，而是一个偶尔被迫设计网页的程序员，所以把它当作它的价值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T13:27:15.357

根据[w3schools](http://www.w3schools.com/browsers/browsers_display.asp)的数据，只有 2% 的访客仍然拥有 256 色显示器。如果您不使用网络颜色，他们只会看到与您想要的颜色有些不同的颜色，因此没有任何理由坚持使用[网络安全颜色](http://www.lynda.com/hex.asp)，这确实限制了您的选择。

# c# - 如何在 Windows 窗体上显示必填字段

> ID：199633
> 
> 赞同：8
> 
> 时间：2008-10-14T00:55:04.597
> 
> 标签：c#, .net, windows, winforms

我应该如何向用户显示 Windows 窗体应用程序中哪些字段是强制性的。

我考虑过更改标签颜色或文本框的背景颜色。

我使用错误提供程序在字段旁边显示一个红色感叹号，但这只有在他们单击保存按钮后才可见。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-14T01:00:17.657

*   控制侧的星号或图标
*   所需验证失败时的红色边框（当用户尝试保存时）
*   粗体标签
*   所需控件的不同背景颜色（可能仅在用户尝试保存时）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T01:14:23.543

使用 errorprovider 扩展控件。

这会在带有工具提示消息的控件旁边放置一个红十字。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T01:01:02.837

黄色背景将使其类似于许多 Web 表单。不知道 Windows 本身是否有任何标准，但如果有我怀疑它们是否被广泛使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T11:48:51.857

我会使用 ErrorProvider 控件，可能使用不同的图标来表示“必需”而不是“错误”。我还将确保字段以显示在它们旁边的错误图标开头，并且该图标仅在为该字段提供数据后才会消失。

仅在用户尝试保存时才对丢失的数据进行验证/通知似乎为时已晚。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T21:11:20.160

需要考虑的是用户习惯于在必填字段中看到的内容。虽然在图形上并不引人注目，但在必填字段旁边放置一个简单的星号是一种非常普遍的解决方案。

# .net - 有 Ruby .NET 编译器吗？

> ID：199638
> 
> 赞同：5
> 
> 时间：2008-10-14T00:55:52.473
> 
> 标签：.net, ruby, compiler-construction

是否有适用于 Ruby 语言的 .NET Framework 编译器？我听说过 DLR（动态语言运行时），这是否可以让 Ruby 用于 .NET 开发？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-14T00:57:46.273

[IronRuby](http://www.ironruby.net/)是 Microsoft 支持的一个项目，建立在 Dynamic Language Runtime 之上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T00:57:45.510

[是的，Ruby.NET 项目](http://rubydotnet.googlegroups.com/web/Home.htm?gda=8ES3fzoAAACraJYLasopJnHm_A4zSrefscDsHtcsS-deqHbu90w8mzCLtOtCUOXSAV3CbWid_sX97daDQaep90o7AOpSKHW0)。请注意，它自 2007 年 11 月以来一直没有更新，所以我不确定现在的支持情况如何。

编辑：正如其他人所指出的，IronRuby 得到了微软的支持，所以这可能是一个更好的主意

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T00:59:45.770

另一种选择是[Iron Ruby](http://www.ironruby.net/)，我认为它是微软官方认可的。

# c# - 如何在绑定到 DataTable 的 ComboBox 中插入“空”字段

> ID：199642
> 
> 赞同：19
> 
> 时间：2008-10-14T00:57:33.920
> 
> 标签：c#, combobox

我在 WinForms 应用程序上有一个组合框，可以在其中选择一个项目，但这不是强制性的。因此，我需要一个“空”的第一项来表示没有设置任何值。

组合框绑定到从存储过程返回的 DataTable（我不为我的 UI 控件上的匈牙利表示法道歉：p）：

```
 DataTable hierarchies = _database.GetAvailableHierarchies(cmbDataDefinition.SelectedValue.ToString()).Copy();//Calls SP
 cmbHierarchies.DataSource = hierarchies;
 cmbHierarchies.ValueMember = "guid";
 cmbHierarchies.DisplayMember = "ObjectLogicalName"; 
```

我怎样才能插入这样一个空项目？

我确实有权更改 SP，但我真的不希望用 UI 逻辑“污染”它。

**更新：**这是我空白的 DataTable.NewRow()，谢谢。我已经升级了你们所有人（到目前为止所有 3 个答案）。在决定“答案”之前，我试图让迭代器模式工作

**更新：**我认为这次编辑让我进入了社区 Wiki 领域，我决定不指定一个答案，因为它们在其领域的背景下都有优点。感谢您的集体投入。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-14T01:29:25.260

你可以做两件事：

1.  将一个空行添加到`DataTable`从存储过程返回的那个。

    ```
    DataRow emptyRow = hierarchies.NewRow();
    emptyRow["guid"] = "";
    emptyRow["ObjectLogicalName"] = "";
    hierarchies.Rows.Add(emptyRow); 
    ```

    创建一个 DataView 并使用 ObjectLogicalName 列对其进行排序。这将使新添加的行成为 DataView 中的第一行。

    ```
    DataView newView =           
         new DataView(hierarchies,       // source table
         "",                             // filter
         "ObjectLogicalName",            // sort by column
         DataViewRowState.CurrentRows);  // rows with state to display 
    ```

    然后将数据视图设置`DataSource`为`ComboBox`.

2.  如果您真的不想像上面提到的那样添加新行。您可以允许用户`ComboBox`通过简单地处理“删除”按键事件将值设置为空。当用户按下 Delete 键时，将其设置`SelectedIndex`为 -1。您还应该设置`ComboBox.DropDownStyle` 为`DropDownList`. 因为这将阻止用户编辑`ComboBox`.

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-28T07:52:22.453

```
cmbHierarchies.SelectedIndex = -1; 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-14T01:17:06.470

我通常为这种类型的东西创建一个迭代器。它可以避免污染您的数据，并且可以很好地与数据绑定配合使用：

```
DataTable hierarchies = _database.GetAvailableHierarchies(cmbDataDefinition.SelectedValue.ToString()).Copy();//Calls SP
cmbHierarchies.DataSource = GetDisplayTable(hierarchies);
cmbHierarchies.ValueMember = "guid";
cmbHierarchies.DisplayMember = "ObjectLogicalName";

...

private IEnumerable GetDisplayTable(DataTable tbl)
{
    yield return new { ObjectLogicalName = string.Empty, guid = Guid.Empty };

    foreach (DataRow row in tbl.Rows)
        yield return new { ObjectLogicalName = row["ObjectLogicalName"].ToString(), guid = (Guid)row["guid"] };
} 
```

免责声明：我没有编译此代码，但已多次使用此模式。

**注意：**过去几年我一直在 WPF 和 ASP.Net 领域工作。显然 Winforms 组合框需要一个 IList，而不是一个 IEnumerable。一个成本更高的操作是创建一个列表。这段代码真的很简洁，我真的真的没有编译它：

```
DataTable hierarchies = _database.GetAvailableHierarchies(cmbDataDefinition.SelectedValue.ToString()).Copy();
List<KeyValuePair<string, Guid>> list = new List<KeyValuePair<string, Guid>>(hierarchies.Rows.Cast<DataRow>().Select(row => new KeyValuePair<string, Guid>(row["Name"].ToString(), (Guid)row["Guid"])));
list.Insert(0, new KeyValuePair<string,Guid>(string.Empty, Guid.Empty));
cmbHierarchies.DataSource = list;
cmbHierarchies.ValueMember = "Value";
cmbHierarchies.DisplayMember = "Key"; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-14T01:05:35.977

在您的数据表中插入一个空白行，并在验证/更新/创建中检查它

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-14T01:05:19.380

不能在将新的 DataRow 绑定到 DataSource 之前将它添加到 DataTable 吗？

您可以使用 DataTable 的 NewRow 函数来实现：

[http://msdn.microsoft.com/en-us/library/system.data.datatable.newrow.aspx](http://msdn.microsoft.com/en-us/library/system.data.datatable.newrow.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-06-09T11:38:43.090

我找到了另一个解决方案：

在创建数据表之后（在使用填充之前），添加新行并使用 AcceptChanges 方法到表中。新记录将获得 RowState = Unchanged，并且不会添加到数据库中，但会在您的数据表和组合框中可见。

```
 DataTable dt = new DataTable();
    dt.Rows.Add();
    dt.AcceptChanges();
    ...
    dt.Fill("your query"); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-21T10:57:03.720

我根据 Jason Jackson 的建议编写了这个方法：

```
private IEnumerable<KeyValuePair<object,object>> GetDisplayTable(DataTable dataTable,  DataColumn ValueMember, string sep,params DataColumn[] DisplayMembers)
{
    yield return new KeyValuePair<object,object>("<ALL>",null);

    if (DisplayMembers.Length < 1)
        throw new ArgumentException("At least 1 DisplayMember column is required");

    foreach (DataRow r in dataTable.Rows)
    {
        StringBuilder sbDisplayMember = new StringBuilder();
        foreach(DataColumn col in DisplayMembers)
        {
            if (sbDisplayMember.Length > 0) sbDisplayMember.Append(sep);
            sbDisplayMember.Append(r[col]);
        }
        yield return new KeyValuePair<object, object>(sbDisplayMember.ToString(), r[ValueMember]);
    }
} 
```

用法：

```
bindingSource1.DataSource = GetDisplayTable(
            /*DataTable*/typedDataTable, 
            /*ValueMember*/typedDataTable.IDColumn, 
            /*DisplayColumn Seperator*/" - ",
            /*List of Display Columns*/
            typedDataTable.DB_CODEColumn,
            typedDataTable.DB_NAMEColumn);

comboBox1.DataSource = bindingSource1;
comboBox1.DisplayMember = "Key";
comboBox1.ValueMember = "Value";

//another example without multiple display data columns:
bindingSource2.DataSource = GetDisplayTable(
            /*DataTable*/typedDataTable, 
            /*ValueMember*/typedDataTable.IDColumn, 
            /*DisplayColumn Seperator*/null,
            /*List of Display Columns*/
                typedDataTable.DESCColumn ); 
```

再往下，使用 Selected Value 的地方：

```
if (comboBox1.SelectedValue != null)
     // Do Something with SelectedValue   
else 
     // All was selected (all is my 'empty') 
```

这将允许在 ComboBox 中显示连接的多个列，同时将 Value 成员保持为单个标识符 + 它使用带有 BindingSource 的迭代器块，对于您的情况，BindingSource 可能会过大。

欢迎评论和建议。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T01:41:13.380

呃，数据绑定后不能给ComboBox添加一个默认项吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-14T08:56:07.493

我将绑定数据，然后使用 ComboxBox.Items.Insert 方法在位置 0 处插入一个空白项。类似于 Flipdoubt 的建议，但它将项目添加到顶部。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-06-28T03:36:14.497

我也有类似的挑战。作为表单加载事件的一部分，我将控件的 SelectedIndex 设置为 -1

IE

```
private void Form1_Load(object sender, EventArgs e)
{         
    this.TableAdapter.Fill(this.dsListOfCampaigns.EvolveCampaignTargetListMasterInfo);
    this.comboCampaignID.SelectedIndex = -1;
} 
```

实际上，组合框被填充并且第一个项目被选中。然后该项目被取消选择。可能不是适用于所有情况的可行解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-04-04T13:54:04.343

`this.recieptDateTimePicker.SelectedIndex = -1;` this.dateCompoBox.SelectedIndex = -1;

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-08-08T13:32:11.387

我发现了这种方式：

```
 DataTable hierarchies = new DataTable(); 

    cmbHierarchies.BeginUpdate();
    cmbHierarchies.ValueMember = this.Value;
    cmbHierarchies.DisplayMember = this.Display;
    hierarchies = DataView.ToTable();
    cmbHierarchies.DataSource = table;
    cmbHierarchies.EndUpdate();

    //Add empty row
    DataRow row = table.NewRow();
    table.Rows.InsertAt(row, 0);
    cmbHierarchies.SelectedIndex = 0; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-10-19T22:09:32.010

无需向数据表添加新行，只需将数据绑定到组合框并在加载时将 SelectedIndex 设置为 -1。这将导致选择为空，直到用户选择一个项目。

我从我当前的一个项目中剪辑了这个。

```
 Attorney_List_CB.DataSource = DA_Attorney_List.BS.DataSource;
        Attorney_List_CB.DisplayMember = "Attorney Name";
        Attorney_List_CB.SelectedIndex = -1; 
```

为了清除选择，我通常插入一个将 SelectedIndex 设置回 -1 的按钮。

```
 private void Clear_Selection_BTN_Click(object sender, EventArgs e)
    {
        Attorney_List_CB.SelectedIndex = -1;  // Clears user selection
    } 
```

最后，一旦我验证了表单上的数据，如果任何组合框的 SelectedIndex 为 -1，那么它会被跳过，或者我将生成某种类型的默认值，例如“N/A”或在这种情况下我需要的任何值。

# jquery - JQuery“任何行”选择器

> ID：199651
> 
> 赞同：2
> 
> 时间：2008-10-14T00:59:08.813
> 
> 标签：jquery, picker

我正在为 JQuery 寻找一个通用的“行选择器”。

我们都见过很酷的“选择器”工具，例如日期选择器、颜色选择器、时间选择器等，您可以在其中单击文本框，然后会出现一个小日历或色板或时钟或其他东西。您选择一些东西（如日期），然后用一个值填充文本框。

我真的需要一个通用的“行选择器”，您可以在其中使用一些数据行（例如时区列表）填充某些内容（表格、div 等）。这将链接到一个文本字段，并在用户单击该字段时弹出。

他们会点击一行（比如一个时区），然后时区 ID 将被传回该字段。

有人知道这样做的吗？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T01:26:00.117

尽管您当然可以在 jQuery 中相当容易地实现行选择器，但我并不完全了解通用性。

```
<script type="text/javascript"> $(function() {
        $('table#data_table tr').click(function() {
              alert($(this).find('td.id').html());
          }); }); 
</script>

<table border="0" id="data_table">
<tr>
<td class="id">45</td><td>GMT</td>
</tr>
<tr>
<td class="id">47</td><td>CST</td>
</tr>
</table> 
```

这会为每一行添加一个点击，在该行中找到标记的 id，然后您可以使用它做一些事情。显然，您需要将其定位到您的数据表并根据内容进行过滤。然后可以使用 JQuery 将单击的结果填充到目标字段中。然后，您可以提出一些约定，使您的所有数据表都工作相同，这将允许您将其概括为您的应用程序的通用选择器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T08:21:06.787

在这种情况下，最好使用事件委托。因此，将事件处理程序放在表本身上，这样可以避免必须为每一行绑定一个处理程序，如果你有几行的话，这会非常昂贵。然后，您可以使用 event.target 来查询哪个元素负责该事件并从那里开始。

更多信息[在这里](http://www.danwebb.net/2008/2/8/event-delegation-made-easy-in-jquery)

例如

```
$('#someTable').click(function(e) {
  var target = $(e.target);

}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-24T14:03:53.857

这不是您所**要求**的，但它可能是您正在**寻找**的：[Any+Time(TM) Datepicker/Timepicker AJAX Widget with Time Zone Support](http://www.ama3.com/anytime/)可以在时间选择器中显示时区列表，使用户可以轻松选择合适的时区。它也很容易定制，并且比大多数其他使用下拉或滑块的时间选择器允许更快的选择。我希望这有帮助！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-24T14:10:31.170

我知道我迟到了一年，而且我可能在这里遗漏了一些东西，但是带有属性的`select`元素有什么问题？`size`

```
<select name="test" size="5">
  <option value="1">One</option>
  <option value="2">Two</option>
  <option value="3">Three</option>
  <option value="4">Four</option>
  <option value="5">Five</option>
</select> 
```

这将显示所有 5 个选项，并允许用户选择一个。如果只是以标准形式使用，它也绝对没有 Javascript 依赖，而且可以很好地处理典型的 Javascript 事件，并且似乎还可以产生您想要的确切外观 - 更不用说，一如既往，您可以使用 CSS 来设置样式随你喜欢。

当标准 HTML 可以工作时，我会说：使用标准 HTML。

# linux - 我应该使用什么 Linux shell？

> ID：199661
> 
> 赞同：59
> 
> 时间：2008-10-14T01:02:18.013
> 
> 标签：linux, shell

我使用过 bash、csh 和 tcsh。但是我问[了这个问题](http://web.archive.org/web/20151121164806/http://stackoverflow.com/questions/198723/whats-in-your-cshrc)，乔纳森告诉我 csh 不值得信任。那么什么样的 Linux shell 对开发有好处。为什么？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-10-14T01:06:59.937

到目前为止，Linux 上最常见的 shell 是 bash。除非您有充分的理由使用替代方案，否则我建议您坚持使用 bash，或者您的项目团队最常用的 shell（或者您必须使用的大部分 shell 脚本）使用。

另一个非常常见的竞争者是 dash，它正被 Ubuntu 项目更广泛地使用。

这确实是个人喜好，除了[csh](http://www.grymoire.com/unix/CshTop10.txt)。

[csh 的维基百科链接](https://en.wikipedia.org/wiki/C_shell)

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-10-14T01:47:07.470

我更喜欢zsh。

单独的制表符完成是值得的：

*   如果需要，它会扩展通配符（当您想删除目录中除一个文件之外的所有文件时很方便）
*   指定程序后会给你一个开关列表
*   在您正在处理的行下方提供选项卡完成选项，这非常方便。

[http://zsh.sourceforge.net/](http://zsh.sourceforge.net/)

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-10-14T02:53:10.550

对于交互性，使用 Zsh。有一段时间我是 Bash 选项卡完成脚本的 FreeBSD 端口的维护者，但在我第一次尝试 Zsh 时就放弃了它。它可以做 Bash 可以做的所有事情，但更轻松、更优雅。它还具有非常类似于 Bash 的击键的好特性，因此如果您在没有 Zsh 的系统上，您将能够做到（即使它不会“感觉”那么好）。

对于脚本，使用 Bourne Shell (sh)。它是 POSIX 标准脚本语言，您的脚本几乎可以在任何地方工作。Bash 和 Zsh 以及其他 shell 具有不错的扩展，您会错过这些扩展，但它们会将您绑定到特定的设置。忽略关于您确定永远不会在其他地方运行的仅供个人使用的脚本的建议，但请记住，这是您需要考虑的真正权衡。

但总而言之，Zsh。我不知道任何尝试过的人没有立即永久切换。它真的那么好。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-10-22T20:22:49.023

[Fish](http://fishshell.com/) (Friendly Interactive Shell) 是大多数其他 shell 的不错替代品。它具有一致的语法、良好的制表符补全和语法高亮，易于拾取和使用（尤其是如果您没有其他 shell 的习惯），并且具有出色的运行时帮助。

缺点是它的开发不规律，用户群很小（但很有帮助），并且与其他 shell 非常不同。与 shell 习惯用法的向后兼容性不是优先事项。

在许多情况下，这很好……很多标准的 shell 都有非常愚蠢的做事方式，只是因为它一直都是这样做的。“做/完成”、“案例/esac”、“如果/fi”？这是鱼会消除的精神错乱。

值得一看。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-10-14T02:36:07.137

既然我相信我是建议你应该使用 C Shell 以外的东西的人，也许我应该稍微修饰一下我的言论，然后支持那些说“Linux 上的 bash，其他平台上的 Korn shell（除非安装了 bash那里也有）'。

就像编辑器（你更喜欢`vim`or `emacs`），shell 的选择部分是熟悉的问题，部分是偏好的问题。有很多人喜欢 C shell，尽管我确实相信它不如 Bourne shell 和衍生工具那么容易编程。我在 .cshrc 中的内容确实等同于`exec /bin/ksh`（这并不完全相同，因为我想执行一个登录 shell - 一个读取配置文件的 shell 等等），但我不会谴责任何人使用 C shell或衍生品，如果它是一个知情的决定。

如果你决定要使用 C shell 以外的东西，那么你基本上属于 Bourne shell 阵营，POSIX 标准或多或少地指定了预期的行为，然后是不同的 shell——即 Bourne、Korn或 Born Again 贝壳——添加（或者，在经典的 Bourne 贝壳的情况下，减去）一些功能。如果您的代码可能需要从 Linux 迁移到 HP-UX、Solaris 或 AIX（经典的 AT&T 派生的 Unix 变体中幸存的三重奏），那么您应该考虑确保使用经典的 Bourne shell 编写 shell 脚本，尽管 Korn shell 也很安全。但请注意，在 Linux 上，您可以编写`#!/bin/sh`并获得 Bash，在其他平台上，您将获得 Bourne shell。

我在 Korn shell 和 Bash 之间切换没有大问题 - 很少有小问题。我倾向于避开这两种语言中没有明确定义的那些角落——这往往意味着“在两者中都有定义”。对于那些使用 Linux 的人来说，另一个问题是 GNU 工具比经典的 Unix 版本有更多的选项，你可能会失去可移植性，这不是因为你使用的 shell 编程结构，而是因为你使用的命令选项。经验和随时可以访问其他系统的手册页有很大帮助。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-14T01:06:35.867

我通常坚持使用 bash，因为它比直接 sh 更友好，而且它是我半定期使用的每个发行版（SuSE、RHEL、Ubuntu、Slackware）的默认设置。

但是，如果您打算编写可移植的 shell 脚本，请确保它们都在*真正的*sh 中运行。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-14T01:15:18.300

重击。这是标准的。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-14T14:31:29.407

csh 的问题在于它对于脚本来说是垃圾，正如[这里](http://faqs.cs.uu.nl/na-dir/unix-faq/shell/csh-whynot.html)所解释的那样。没有真正的理由不应该将它用作交互式 shell，但是大多数人发现学习两个不同的 shell 并且不能在命令行上尝试他们的脚本部分会让人感到困惑，所以使用它是最简单的一切都一样。

交互式 shell 的明显候选者是 bash、dash、zsh 和 {pd,}ksh。所有这些都实现了 posix shell 标准，并带有一些小的扩展。选择任何你喜欢的交互式使用，我倾向于使用 bash，因为它是 linux 上的标准，但它们都有其优点，特别是 zsh 似乎很受欢迎。

如果您正在编写一个打算移植的脚本，请使用#!/bin/sh，并确保您使用标准的 posix shell 语法。如果它适用于 bash 和 ksh，它可能是标准的。有一些旧版本的 unix 有一个非标准的 /bin/sh ，但除非你知道你必须这样做，否则我不会为此烦恼。更多的可移植性问题是您从脚本中调用的所有命令行工具。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-07-03T17:36:32.070

没有人提到基于 Debian 的标准`sh`，它是 Debian Almquist shell `dash`。它完全符合 POSIX 标准并且启动速度非常快，这就是 Debian/Ubuntu 将它用于`/bin/sh`.

所以我使用`bash`我的交互式外壳，但只`dash`用于脚本。这样我就知道我的脚本至少符合 POSIX，并且可以在任何其他 POSIX shell 上运行。...我知道可移植性不仅仅是外壳，而是我划清界限的地方。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-22T13:54:24.377

我不是 Ruby 大用户，但[http://rush.heroku.com/](http://rush.heroku.com/)看起来很有趣

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-04T17:51:19.280

最好坚持使用 bash，因为它是最广泛使用的 shell，并且您可能从某人那里获得的任何教程或帮助很可能会使用 bash。但是，我已经开始在我的所有脚本中使用 zsh，并且我发现它在脚本方面远远优于 bash。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-14T01:37:20.093

只是不要使用 Korn Shell (ksh)。

除非你有完美的打字并且永远不需要使用退格键。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-14T01:45:43.010

我其实很喜欢ksh。它比 bash 更一致，因为它不尝试支持任何 csh 构造。根据我的经验，tcsh 与其他 shell 的兼容性最低，因此我避免使用它。我尝试为 sh 编写脚本，但 ksh 确实具有一些不错的功能，例如在一行上导出和设置变量。我也尝试保持与 bash 的兼容性，因为它功能齐全且很常见。要编写可移植的 shell 脚本，这比选择“最好的”shell 更重要，你可以参考这本书。

便携式 Shell 编程：Bruce Blinn 的 Bourne Shell 示例广泛集合（HP 专业系列）（平装本 - 1995 年 10 月 29 日） [amazon.com](https://rads.stackoverflow.com/amzn/click/com/0134514947)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-14T01:53:00.220

我一直使用 pdksh，没有任何接近完美的打字（也许你需要修复你的 termcap？）。

ksh 是标准，csh 是标准，bash 是“标准”，但仅在 linux 上。最好以 ksh 为目标。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-27T21:50:04.233

对于编写实际脚本，我更喜欢`ksh`，它有几个对编程有用的扩展，并解决[了我最讨厌的一个问题](https://stackoverflow.com/questions/2732/shell-scripting-input-redirection-oddities)。

`bash`是我对交互式会话的偏好，但这更多的是个人喜好问题。只要确保它是一个 Bourne 类型的 shell。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-04-07T17:44:37.053

对于脚本，请尝试使用 dash 一段时间以更好地了解可移植性。如果您曾经使用 bash 编写过 shell 脚本，请在脚本 shebang 中显式声明 bash。

对于您的个人控制台使用，请尝试那里的内容。找到你觉得舒服的东西。通过选择一个必须从源代码编译的 shell，为你关心的每台机器使用它，变得古怪并惹恼你所有的系统管理员朋友。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-01-25T21:46:38.417

我也来自 csh，tcsh 到 bash。它有所不同，但经过一段时间后，至少和 c-shell 一样好。

对于脚本，我建议使用 ksh，因为它在大多数 Unix 上都可用（Solaris、HP-UX、OSF/1（有史以来最好的 UNIX ；）——现在是时候了））并且它具有很好的特性。使用 Korn，您可以对大多数脚本进行编程。偶尔你想得到比一个数字更多的值，作为函数的返回值，或者你有一些你不能放在一个简单数组中的数据，或者你需要一些在正则表达式的情况下具有更好功能的东西，或者其他什么，那么我会建议perl。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-02-13T12:31:25.713

我认为 FISH 是最好的，它有语法高亮（对于不存在的命令）并且它可以自动填充。而且很容易学习。

* * *

## 回答 #19

> 赞同：-4
> 
> 时间：2014-12-10T03:33:14.013

选择一项：tcsh b. ksh c. zsh d. 登录 e. 重击

我会使用登录。只是在说。

# ruby - Ruby SOAP SSL 问题

> ID：199665
> 
> 赞同：1
> 
> 时间：2008-10-14T01:04:21.737
> 
> 标签：ruby, soap, ssl

我在 Ruby 中有一个 SOAP 客户端，我正在尝试使用 Ruby SOAP 服务器，但无济于事。客户端可以在 SSL 上使用 Python SOAP 服务器正常工作，但不能使用 Ruby 版本。这是服务器的样子：

```
require 'soap/rpc/standaloneServer'
require 'soap/rpc/driver'
require 'rubygems'
require 'httpclient'

def cert(filename)
  OpenSSL::X509::Certificate.new(File.open("path to cert.cert") { |f|
    f.read
  })
end

def key(filename)
  OpenSSL::PKey::RSA.new(File.open("path to rsaprivate.key") { |f|
    f.read
  })
end

class Server < SOAP::RPC::HTTPServer
 ~code snipped for readability~
end

server = Server.new(:BindAddress => HelperFunctions.local_ip, :Port => 1234, :SSLCertificate => cert("path to cert"), :SSLPrivateKey => key("path to rsa private key"))
new_thread = Thread.new { server.start } 
```

为了便于阅读，我已经删减了一些代码（例如，我在其中公开了一些方法），并且在关闭 SSL 的情况下它可以正常工作。但是当客户端尝试连接时，它会看到：

```
warning: peer certificate won't be verified in this SSL session
/usr/lib/ruby/1.8/net/http.rb:567: warning: using default DH parameters.
/usr/lib/ruby/1.8/net/http.rb:586:in `connect': unknown protocol (OpenSSL::SSL::SSLError) 
```

我尝试从[这篇文章](https://stackoverflow.com/questions/128660/how-can-i-make-rubys-soaprpcdriver-work-with-self-signed-certificates)中获得一些建议，现在我看到了这条消息：

```
/usr/lib/ruby/1.8/soap/httpconfigloader.rb:64:in `set_ssl_config': SSL not supported (NotImplementedError) 
```

任何有关如何解决此问题的想法将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T02:26:46.203

精氨酸。我试图按照[这个链接](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/108292)进行操作，结果发现我错过了一个简单的包含语句：

```
require 'webrick/https' 
```

结合原始问题中链接的帮助可以解决问题。希望这可以为其他人节省一个小时的悲伤:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T01:43:30.180

“不支持 SSL”可能是由于没有安装 httpclient 造成的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-19T12:06:42.723

我也是..别忘了把 :SSLEnable => true 花几个小时弄清楚...

```
server = Server.new(:BindAddress => HelperFunctions.local_ip, :Port => 1234, :SSLEnable => true, :SSLCertificate => cert("path to cert"), :SSLPrivateKey => key("path to rsa private key")) 
```

# algorithm - 分组算法

> ID：199677
> 
> 赞同：4
> 
> 时间：2008-10-14T01:08:05.007
> 
> 标签：algorithm, grouping, graph-theory, combinatorics

我正在尝试帮助某人编写一个我认为很容易的程序，但当然它从来都不是:)

我正在尝试制定班级名册（通常在 10 到 20 名学生之间），并有效地将每个同学与另一个同学配对，以组成独特的小组。因此，在一个 10 人的班级中，您可以有 9 个小组。

它也需要能够处理奇数个学生，这增加了我的困惑。

我正在考虑在 Java 中执行此操作，但这很灵活。关于算法方式的任何想法，以保证 a) 不是无限循环（以 2 个已经成为合作伙伴的人结束）和 b) 我的目标是时间比空间更有效，因为班级规模会很小！

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T01:11:49.147

您想创建一个以每个学生为节点的完整图，然后随机选择边并将它们插入到唯一的集合中。

在下一次“拉动”时，你想做同样的事情，除了现在如果边缘已经被选中，丢弃并重新选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T01:29:38.910

这对我来说是一个不寻常的答案 - 说“下载应用程序” - 但你去：

您所描述的可能与国际象棋锦标赛配对非常相似。

看看这个：[http ://home.swipnet.se/rullchef/chessp/](http://home.swipnet.se/rullchef/chessp/)

这是对 Monrad 系统的解释，这可能是您所追求的：

> [蒙拉德系统](http://www.phys.utk.edu/sorensen/ranking/Documentation/rankingofsportsteamsv01.html)
> 
> Monrad 系统是杯子系统的一个非常有趣的变体，据我所知，它仅在国际象棋锦标赛中定期使用。在第一轮中，所有队伍随机配对。胜者得 1 分，较松者得 0 分。在随后的每一轮中，所有得分相同的球队随机配对（除了之前交手过的球队，如果有其他配对的可能性，则不能配对）。与杯赛系统相比，该系统的优势在于所有球队都在继续比赛，并且随着赛季（或锦标赛）的推进，实力相同的球队将相互交锋。可以玩的回合数没有限制，但如果球队的分数相似但不一定相同，最终必须配对。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T03:11:15.927

这是上面 Vlion 答案的伪代码。这不是最快的方法，但它是这个概念的一个例证（感谢 Vlion！）

```
// create all the edges
for i := 1 to number_of_students - 1
  for j := i + 1 to number_of_students
    edges.add(new Edge(i,j))

// select all groups from the edges
for x := 1 to number_of_students - 1
  used_nodes.clear
  group.clear

  for y := 1 to number_of_students div 2
    do
      current_edge = edges.get_next
    while (current_edge.n1 not in used_nodes) and
          (current_edge.n2 not in used_nodes)

    used_nodes.add(current_edge.n1)
    used_nodes.add(current_edge.n2)

    group.add(current_edge)

    edges.remove(current_edge)

  groups.add(group) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T07:39:03.640

这是解决问题的C#代码。

我假设您真正关心的是最大化学生配对的独特性，而不是一组可能的独特学生配对组。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.IO;

namespace Pairing
{
    class Program
    {
        static void Main(string[] args)
        {
            //switch these lines if you'd prefer a command line interface to a text file.
            var rgs = File.ReadAllLines("Roster.txt");
            //var rgs = args;

            var setPairs = new HashSet<HashSet<string>>();
            for (var ixrgs = 0; ixrgs < rgs.Length - 1; ixrgs++)
                for (var ixrgsSubset = ixrgs + 1; ixrgsSubset < rgs.Length; ixrgsSubset++)
                    setPairs.Add(new HashSet<string>(new string[] { rgs[ixrgs], rgs[ixrgsSubset] }));

            var setGroups = new HashSet<HashSet<HashSet<string>>>();
            var setUsedPairs = new HashSet<HashSet<string>>();
            while (setPairs.Count > 0)
            {
                var setPairsTmp = new HashSet<HashSet<string>>(setPairs);
                var setTmp = new HashSet<HashSet<string>>();
                var setUsedVariables = new HashSet<string>();

                while (setPairsTmp.Count > 0)
                {
                    //give me the first element
                    var pair = setPairsTmp.First<HashSet<string>>();
                    //store it
                    setTmp.Add(pair);
                    //add it to our set of used variables
                    setUsedVariables.UnionWith(pair);
                    //remove it from our set of available pairs.
                    setPairsTmp.RemoveWhere(set => set.Intersect<string>    (setUsedVariables).Count<string>() != 0);

                    //remove its implicated deadlocks from our set of available pairs
                    //(this step is both gross, and key. Without it, failure potential arises.)
                        var s1 = new HashSet<string>();
                        var s2 = new HashSet<string>();
                        //get the set of variables paired with the first:
                        var rgPair = pair.ToArray<string>();
                        foreach (var set in setUsedPairs)
                        {
                            if (set.Contains(rgPair[0]))
                                s1.UnionWith(set);
                            if(set.Contains(rgPair[1]))
                                s2.UnionWith(set);
                        }
                        s1.IntersectWith(s2);
                        //enumerate the pairs created by the deadlocking pairs, remove them from our available selections.
                        var rgsTmp = s1.ToArray<string>();
                        for (var ixrgs = 0; ixrgs < rgsTmp.Length - 1; ixrgs++)
                            for (var ixrgsSubset = ixrgs + 1; ixrgsSubset < rgsTmp.Length; ixrgsSubset++)
                                setPairsTmp.RemoveWhere(set => set.Contains(rgsTmp[ixrgs]) && set.Contains(rgsTmp[ixrgsSubset]));
                }
                setPairs.ExceptWith(setTmp);
                setGroups.Add(setTmp);
                setUsedPairs.UnionWith(setTmp);
            }
            //at this point, setGroups contains the set of unique group combinations.
            //the non-maximally sized groups indicate unique sets that could form provided that
            //all other students are in redundant sets.

            var enumerableGroups = setGroups.OrderByDescending<HashSet<HashSet<string>>, int>(set => set.Count);
            //Sanity Check:
            foreach (var group in enumerableGroups)
            {
                Console.Write("{");
                foreach (var pair in group)
                    Console.Write(string.Format(@"[{0},{1}]", pair.ToArray<string>()));
                Console.WriteLine("}");
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T14:35:53.503

您要求的算法似乎或多或少与为循环锦标赛准备时间表的算法相同。详细信息可在[此 Wikipedia 文章](http://en.wikipedia.org/wiki/Round-robin_tournament#Scheduling_algorithm)中找到。您还可以使用网络上的生成器进行快速试用。其中之一可以在[这里](http://bluebones.net/fixtures.php)找到。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-03-25T11:39:50.117

我不知道这是否正是你所要求的，但在这里我用简单的 python 来处理它。它会为（在我的示例中）10 个学生提供每个独特的分组。

我猜这不是最快的事情，但它很容易实现和遵循。

```
from itertools import permutations

def my_sort(x):
    assert type(x) in (tuple, list)
    assert len(x)==10
    groups = x[0:2],x[2:4],x[4:6],x[6:8],x[8:10]
    groups = sorted([sorted(g) for g in groups], key=lambda k:k[0])
    return tuple(x  for g in groups for x in g )

S = set(my_sort(p) for p in permutations(list(range(10))))

"""
len(S) == 945
list(sorted(S))[-3:] == [(0, 9, 1, 8, 2, 7, 3, 4, 5, 6), (0, 9, 1, 8, 2, 7, 3, 5, 4, 6), (0, 9, 1, 8, 2, 7, 3, 6, 4, 5)]
""" 
```

一个元组表示一行中的所有组：(0, 9, 1, 8, 2, 7, 3, 4, 5, 6) 表示 0 与 9 分组，1 与 8 分组，依此类推。

# windows - 如何在不触发 LLMHF_INJECTED 标志的情况下发送鼠标/键盘输入？

> ID：199687
> 
> 赞同：1
> 
> 时间：2008-10-14T01:14:21.110
> 
> 标签：windows, input, mouse

目前我使用该[`SendInput()`](http://msdn.microsoft.com/en-us/library/ms646310.aspx)功能，但如果您安装低级鼠标钩子，`LLMHF_INJECTED`则设置表示输入已注入流中。有没有办法发送鼠标和键盘输入，所以`LLMHF_INJECTED`没有设置？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T12:33:59.593

Raymond Chen 将这类问题描述为军备竞赛。假设 S 是欺骗此类注入的技术。然后会看到这里的问题，我如何检测 S 是否用于注入鼠标/键盘输入？这个标志的意义在于，微软认为欺骗是可能的，但可以检测到。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-09-16T19:54:09.683

一种方法是安装您自己的低级挂钩处理程序并清除其中的 LLMHF_INJECTED。这种变化似乎会传播到链条上的所有其他钩子。

# database - 构建 Web 数据库的最佳 VISUAL RAD 环境是什么？

> ID：199691
> 
> 赞同：2
> 
> 时间：2008-10-14T01:15:29.577
> 
> 标签：database, ide, rad

我指的是真正的可视化环境，而不是声称是可视化但需要大量手动编码脚本的东西，或者是一个生成网站并让您开始在 Visual Studio 中编辑的代码生成器。有没有真正的可视化 Web 开发平台？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T02:07:09.053

您可能会尝试使用 FrontPage 或其他东西，但您可能会更好地适应代码，或者聘请 Web 开发人员为您做这件事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T02:29:05.793

Softvelocity 的 Clarion 产品是出色的往返代码生成器。他们有用于 ASP、PHP 和 ASP.NET 的工具。我只使用了他们的 win32 工具，效果很好。他们的工具有点贵，但从长远来看非常值得。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T04:21:35.293

正如上面所说的（还不能投票或评论），但还有更多信息。

Clarion 6 + [Nettalk](http://capesoft.com/accessories/netsp.htm)提供模板驱动的快速应用程序开发。您可以非常快速地创建浏览/表单网络系统。

*   我是 Clarion Evangelist ( [Clarion Folk](http://clarionfolk.com) )，所以请谨慎对待。
*   刚刚意识到没有像样的视频显示 Clarion 6 + Nettalk。很快就会解决这个问题。

干杯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T02:13:02.863

您可以尝试在线表单构建服务，例如[Wufoo](http://wufoo.com/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T02:37:09.303

您可能想尝试像[Microsoft Expression Studio](http://www.microsoft.com/expression/)这样的东西，它的功能似乎也有点轻巧。我安装了 Web 2 版本，它运行良好。

# css - 继承 css 属性

> ID：199692
> 
> 赞同：7
> 
> 时间：2008-10-14T01:16:07.563
> 
> 标签：css, styling

我只有 css 的基本知识，是否可以将属性从一种样式继承到另一种样式。因此，例如，我可以将默认段落标记设置中指定的字体大小继承到我的超链接标记中。

我想这样做的原因是为了更容易维护多种样式。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T01:29:07.477

您可以一次为两个元素定义通用样式，如下所示：

```
p, a {
    font-size: 1em;
} 
```

然后根据需要使用各自的属性扩展每一个：

```
p {
   color: red;
}

a {
   font-weight: bold;
} 
```

**请记住：**稍后在样式表中定义的样式通常会覆盖之前定义的属性。

**额外：**如果您还没有，我建议您获取[Firebug](http://walmart.ca/wps-portal/storelocator/Canada-HealthAndBeauty.jsp?selection=listingDetails&page=hb&lang=null&assetId=11727&imageId=39727&suggestedItem=&priceType=1&page=null&departmentId=14&categoryId=193#) Firefox 扩展，这样您就可以查看页面上的元素正在接收哪些样式以及它们是从哪里继承的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T01:31:08.063

没有 CSS 没有任何方法可以继承样式。但是有几种方法可以共享样式。这里有一些例子：

**使用多个类**

```
<p class="first all">Some text</p>
<p class="all">More text</p>
<p class="last all">Yet more text</p>

p.all { font-weight: bold }
p.first { color: red; }
p.last { color: blue; } 
```

**在您的样式中使用逗号运算符**

```
<p class="first">Some text</p>
<p class="middle">More text</p>
<p class="last">Yet more text</p>

p.first, p.middle, p.last { font-weight: bold }
p.first { color: red; }
p.last { color: blue; } 
```

**使用容器元素**

```
<div class="container">
  <p class="first">Some text</p>
  <p class="middle">More text</p>
  <p class="last">Yet more text</p>
</div>

div p { font-weight: bold }
p.first { color: red; }
p.last { color: blue; } 
```

这些都不是您正在寻找的，但使用这些技术将帮助您将 CSS 重复降至最低。

如果您愿意使用服务器端代码来预处理您的 CSS，您可以获得您正在寻找的 CSS 继承类型。

*   [http://wiki.framwurk.org/documents:csspp/](http://wiki.framwurk.org/documents:csspp/)
*   [http://mail.python.org/pipermail/python-list/2006-August/397266.html](http://mail.python.org/pipermail/python-list/2006-August/397266.html)
*   [http://www.shauninman.com/archive/2008/05/30/check_out_css_cacheer](http://www.shauninman.com/archive/2008/05/30/check_out_css_cacheer)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T01:31:25.503

是的。

您应该了解 CSS 中的级联是如何工作的，还应该了解继承是如何工作的。有些样式会继承（如字体），有些样式不会继承（如边框）​​。但是，您也可以告诉样式从 DOM 中的父元素继承。

这里的一些帮助是有关如何指定样式规则的知识。 [这个关于 CSS Specifity Wars 的网站](http://www.stuffandnonsense.co.uk/archives/css_specificity_wars.html "CSS 特殊性战争")可能会有所帮助（注意：这个网站目前已关闭，但希望它会很快恢复）。

此外，我发现它有时有助于重载这样的样式：

```
h1, h2, h3, h4, h5 h6 { font-weight: normal; border: 1px solid #ff0; }
h1 { font-size: 300%; }
... etc ... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T01:34:43.097

CSS 会自动继承父样式。例如，如果您在正文中说所有文本都应该是`#EEE`，而您的背景应该是`#000`所有文本，那么无论是在 div 还是 span 中，都将始终是`#EEE`.

已经有很多关于以您在 CSS3 中描述的方式添加继承的讨论，但该规范还没有发布，所以现在我们被困在重复自己很多次。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T15:12:50.307

“......是否可以将属性从一种样式继承到另一种样式。例如，我可以将默认段落标记设置中指定的字体大小继承到我的超链接标记中。”

当且仅当它们**在**段落中时，链接标签将自动使用段落中的字体。如果它们在段落之外（例如在列表中），它们将不会使用相同的字体等。

例如这个CSS：

```
* {
margin: 0 10px;
padding:0;
font-size: 1 em;
}
p, a { font-size: 75%; } 
```

将生成大小为 0.75em 的链接和段落。**但**它会在大约 0.56em (.75 * .75) 处显示段落内的链接。

除了 Jonathan Arkell 引用的具体参考，我推荐 W3Schools 的[CSS 教程](http://www.w3schools.com/css/default.asp)。

# .net - Microsoft 单元测试失败，无法加载 DLL 进行测试

> ID：199702
> 
> 赞同：7
> 
> 时间：2008-10-14T01:21:31.717
> 
> 标签：.net, unit-testing

我有一个 .NET 3.5 类库，我正在尝试为其编写一些自动化测试，但是在解决方案中运行任何测试时出现以下错误：

> 测试方法 Common.Tests.CommonTests.TestMethod1 抛出异常：System.IO.FileNotFoundException: 无法加载文件或程序集 'Library.Common, Version=0.0.1.22004, Culture=en-AU, PublicKeyToken=null' 或其依赖项之一. 系统找不到指定的文件。警告：程序集绑定日志记录已关闭。
> 
> 要启用程序集绑定失败日志记录，请将注册表值 [HKLM\Software\Microsoft\Fusion!EnableLog] (DWORD) 设置为 1。
> 
> 注意：有一些与程序集绑定失败日志相关的性能损失。
> 
> 要关闭此功能，请删除注册表值 [HKLM\Software\Microsoft\Fusion!EnableLog]。

我对单元测试相当陌生，所以我很难过。

我已经比较了 lib 和测试项目之间的引用，唯一的区别是测试项目引用了 MS 单元测试 DLL。

**编辑以澄清**

我在“Library.Common”项目中使用了测试创建向导，因此测试项目具有对 Library.Common 项目的引用。我也已经清理并构建了解决方案，这不是问题。

Library.Common.dll 也在我的测试项目输出的 bin\Debug 文件夹中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-14T03:10:58.283

发现问题，我在 Library.Common 项目的 AssemblyInfo.cs 文件中设置了*AssemblyCultureAttribute*。一旦删除它，测试就会运行。

现在来实际学习如何使用该属性！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T01:23:36.457

你能重建解决方案吗？你引用那个Library.Common吗？

您可能需要提供更多详细信息（例如什么是 Library.Common）。

# c# - 您可以在 .NET 中从 JSON 实例化对象实例吗？

> ID：199718
> 
> 赞同：9
> 
> 时间：2008-10-14T01:30:52.743
> 
> 标签：c#, javascript, json, anonymous-types, object-initializers

由于 Object Initializers 与 JSON 非常相似，现在 .NET 中有匿名类型。能够获取一个字符串（例如 JSON）并创建一个表示 JSON 字符串的匿名对象会很酷。

使用 Object Initializers 创建匿名类型：

```
var person = new {
    FirstName = "Chris",
    LastName = "Johnson"
}; 
```

如果您可以传入对象初始化程序代码的字符串表示形式（最好是 JSON 之类的）以使用该数据创建匿名类型的实例，那就太棒了。

我不知道这是否可能，因为 C# 不是动态的，编译器实际上将 Object Initializer 和[d Anonymous Type 转换为可以运行的强类型代码。本文对此进行了解释](http://www.developer.com/net/csharp/article.php/3589916)。

也许采用 JSON 并使用它创建键/值字典的功能效果最好。

我知道您可以在 .NET 中将对象序列化/反序列化为 JSON，但我正在寻找一种创建本质上松散类型的对象的方法，类似于 JavaScript 的工作方式。

有谁知道在 .NET 中执行此操作的最佳解决方案？

更新：太澄清了我为什么要问这个的上下文......我在考虑 C# 如何在语言级别（可能）更好地支持 JSON，并且我试图考虑今天可以完成的方法，用于概念原因。所以，我想我会把它贴在这里开始讨论。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-14T02:13:29.757

.NET 的某些语言具有鸭子类型，但使用 Dot.Notation 的 C# 是不可能的，因为 C# 要求在编译时解析所有成员引用。如果您想使用 Dot.Notation，您仍然必须在某个地方定义一个具有所需属性的类，并使用您想要从 JSON 数据实例化该类的任何方法。预定义类*确实*具有强类型化、包括智能感知在内的 IDE 支持以及不必担心拼写错误等好处。您仍然可以使用匿名类型：

```
 T deserialize<T>(string jsonStr, T obj) { /* ... */}

 var jsonString = "{FirstName='Chris', LastName='Johnson, Other='unused'}";
 var person     = deserialize(jsonString, new {FirstName="",LastName=""});
 var x          = person.FirstName; //strongly-typed 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-14T02:26:12.977

您应该查看**JSON.net**项目：

[http://james.newtonking.com/pages/json-net.aspx](http://james.newtonking.com/pages/json-net.aspx)

您基本上是在谈论从 JSON 中水合对象的能力，这将做到。它不会做匿名类型，但也许它会让你足够接近。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-14T03:24:51.283

我编写了一个相对较短的方法，它将解析 JSON 并返回一个名称/值字典，该字典可以类似于 JavaScript 中的实际对象进行访问。

这是以下方法的示例用法：

```
var obj = ParseJsonToDictionary("{FirstName: \"Chris\", \"Address\":{Street:\"My Street\",Number:123}}");

// Access the Address.Number value
object streetNumber = ((Dictionary<string, object>)obj["Address"])["Number"]; 
```

而且，这是 ParseJsonToDictionary 方法的代码：

```
public static Dictionary<string, object> ParseJsonToDictionary(string json)
{
    var d = new Dictionary<string, object>();

    if (json.StartsWith("{"))
    {
        json = json.Remove(0, 1);
        if (json.EndsWith("}"))
            json = json.Substring(0, json.Length - 1);
    }
    json.Trim();

    // Parse out Object Properties from JSON
    while (json.Length > 0)
    {
        var beginProp = json.Substring(0, json.IndexOf(':'));
        json = json.Substring(beginProp.Length);

        var indexOfComma = json.IndexOf(',');
        string endProp;
        if (indexOfComma > -1)
        {
            endProp = json.Substring(0, indexOfComma);
            json = json.Substring(endProp.Length);
        }
        else
        {
            endProp = json;
            json = string.Empty;
        }

        var curlyIndex = endProp.IndexOf('{');
        if (curlyIndex > -1)
        {
            var curlyCount = 1;
            while (endProp.Substring(curlyIndex + 1).IndexOf("{") > -1)
            {
                curlyCount++;
                curlyIndex = endProp.Substring(curlyIndex + 1).IndexOf("{");
            }
            while (curlyCount > 0)
            {
                endProp += json.Substring(0, json.IndexOf('}') + 1);
                json = json.Remove(0, json.IndexOf('}') + 1);
                curlyCount--;
            }
        }

        json = json.Trim();
        if (json.StartsWith(","))
            json = json.Remove(0, 1);
        json.Trim();

        // Individual Property (Name/Value Pair) Is Isolated
        var s = (beginProp + endProp).Trim();

        // Now parse the name/value pair out and put into Dictionary
        var name = s.Substring(0, s.IndexOf(":")).Trim();
        var value = s.Substring(name.Length + 1).Trim();

        if (name.StartsWith("\"") && name.EndsWith("\""))
        {
            name = name.Substring(1, name.Length - 2);
        }

        double valueNumberCheck;
        if (value.StartsWith("\"") && value.StartsWith("\""))
        {
            // String Value
            d.Add(name, value.Substring(1, value.Length - 2));
        }
        else if (value.StartsWith("{") && value.EndsWith("}"))
        {
            // JSON Value
            d.Add(name, ParseJsonToDictionary(value));
        }
        else if (double.TryParse(value, out valueNumberCheck))
        {
            // Numeric Value
            d.Add(name, valueNumberCheck);
        }
        else
            d.Add(name, value);
    }

    return d;
} 
```

我知道这个方法可能有点粗糙，可能会优化很多，但它是初稿，它只是工作。

另外，在你抱怨它没有使用正则表达式之前，请记住，并不是每个人都真正理解正则表达式，如果需要，以这种方式编写它会使其他人更难修复。另外，我目前对正则表达式不太了解，字符串解析更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T03:24:13.593

您不能从方法中返回匿名类型**，因此“重新水化”匿名类型的存在将仅限于重新水化的方法。有点无意义。

** 您可以将其作为对象返回（这需要反射才能访问其属性--yeech），或者您可以“通过示例进行转换”，这也是没有意义的，因为它需要额外的步骤，这意味着您已经知道对象的类型应该是这样的，那么为什么不首先创建一个对象并填充它呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T01:49:41.910

这是什么申请？

出于几个原因，我不会走这条路。

*   第一的; 它可能需要大量使用反射的支持代码来创建您正在谈论的透明方法。

*   其次，正如您所说，C# 是一种强类型语言，出于某种原因，诸如此类的东西被排除在语言规范之外。

*   第三，这样做的开销是不值得的。请记住，网页（尤其是 AJAX 查询）应该非常快，否则就达不到目的。如果你继续花费 50% 在 C# 和 Javascript 之间序列化你的对象，那么你就有问题了。

我的解决方案是创建一个仅封装字典并将 JSON 字符串作为 ctor 参数的类。然后只需为您要处理的每种类型的 JSON 查询扩展该类。这将是一个强类型和更快的解决方案，但仍保持可扩展性和易用性。缺点是每种类型的 JSON 请求需要编写更多代码。

:)

# c# - .NET 相当于 Java 的 MemoryImageSource

> ID：199723
> 
> 赞同：1
> 
> 时间：2008-10-14T01:34:28.243
> 
> 标签：c#, java, .net, graphics, memoryimagesource

我发现了一个很棒的开源 Java 程序，我正在将其翻译成 C#。Visual Studio 中的内置翻译器让我开始了，我现在已经花了大约一个月的时间手动逐行翻译其余部分。我已经完成了超过 15,000 行的翻译，唯一剩下的就是试图弄清楚如何将他们的 MemoryImageSource 内容转换为 C#/.NET。

实现这些东西的 .NET 等效方式是什么？是否已经有本地 .NET 库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T01:50:38.413

程序集中的标准 .NET[`System.Drawing.`**`Bitmap`**](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx)类`System.Drawing.dll`接近于我所知道的`MemoryImageSource`（即，表示为可以操作的像素数组的图像）。

为了获得更好的性能，您可以使用[`ImageTraverser`](http://www.codeproject.com/KB/GDI-plus/ImageTraverser.aspx?display=Print)CodeProject 中的类，它通过非托管指针访问数组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T02:03:01.370

查看 System.Drawing 命名空间。这包装了标准的 windows GDI+ 本机代码。

System.Drawing.BitMap 可能是您想要的。

# git - 设置 gc.refLogExpire

> ID：199728
> 
> 赞同：8
> 
> 时间：2008-10-14T01:37:52.560
> 
> 标签：git

如何设置 gc.reflogExpire 以使项目永不过期？
它还接受哪些其他时间间隔格式？

手册页说您可以将其设置为“90 天或 3 个月”，但没有指定它期望的格式。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-14T21:38:14.600

将 gc.refLogExpire 设置为“从不”应该可以解决问题。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-14T03:30:16.980

我不确定格式记录在哪里，如果有的话，但`git reflog`使用`approxidate`函数 from[`date.c`](http://git.kernel.org/?p=git/git.git;a=blob;f=date.c)来解析到期时间。可能的值之一是“从不”。</p>

# web - 最佳实践：如何跟踪出站链接？

> ID：199731
> 
> 赞同：8
> 
> 时间：2008-10-14T01:40:29.387
> 
> 标签：web, statistics, hyperlink, analytics

您如何跟踪网站的出站链接，因为请求记录在目标服务器上，而不是您的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T02:02:58.967

您可以将快速 JQuery 脚本添加到将跟踪外部链接的页面，并且可以将它们重定向到服务器上将跟踪链接然后转发到它的文件，或者添加将在单击外部链接时提交的 ajax 请求，并以这种方式跟踪它们。

看：

*   [http://www.prodevtips.com/2008/08/19/tracking-clicks-with-jquery-and-google-analytics/](http://www.prodevtips.com/2008/08/19/tracking-clicks-with-jquery-and-google-analytics/)
*   [https://web.archive.org/web/20090214024330/http://www.justskins.com/development/how-to-track-clicks-on-outgoing-links/132](https://web.archive.org/web/20090214024330/http://www.justskins.com/development/how-to-track-clicks-on-outgoing-links/132)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-10-27T00:14:32.457

### 方法 #1:`target="_blank"`和`onclick`Google Analytics 事件

使用以下属性格式化您的传出链接：

`<a href="http://www.example.com" target="_blank" onclick="trackOutgoing(this);">outgoing</a>`

定义一个 javascript 跟踪函数（需要已经加载了谷歌分析）：

```
function trackOutgoing(el) {
  ga('send', 'event', {eventCategory: 'outbound',
                       eventAction: 'send',
                       eventLabel: el.getAttribute('href'),
                       eventValue: 1});
}; 
```

**优点：**

1.  不**干扰**正常的链接行为
2.  不需要**重定向**到另一个 url

**缺点：**

1.  `onclick`不保证执行（用户或浏览器可以终止主窗口）

### 方法 #2：使用 Javascript 和 Google Analytics 回调重定向

使用以下属性格式化您的传出链接：

`<a href="http://www.example.com" onclick="trackOutgoingAndRedirect(this); return false;">outgoing</a>`

定义一个 javascript 跟踪函数（需要已经加载了谷歌分析）：

```
function trackOutgoingAndRedirect(el) {
  var url = el.getAttribute('href');
  ga('send', 'event', {eventCategory: 'outbound',
                       eventAction: 'send',
                       eventLabel: url,
                       eventValue: 1,
                       hitCallback: function() { document.location = url; }});
} 
```

**优点：**

1.  不需要`target="_blank"`
2.  您的活动被 Google Analytics 注册的机会更高（与方法 #1 相比）

**缺点：**

1.  覆盖链接的默认行为`return false;`
2.  无法在新窗口中打开传出链接

### 方法 #3：使用重定向 URL

使用以下属性格式化您的传出链接：

`<a href="/redirect?url=http://www.example.com">outgoing</a>`

在您的网站上，您将需要实现一个超出此答案范围的重定向脚本。

您的重定向脚本很可能会跟踪传出链接，然后重定向到提供的 url。

**优点：**

1.  无需 Javascript
2.  不需要**谷**歌分析
3.  不**干扰**正常的链接行为

**缺点：**

1.  更难触发 Google Analytics 事件
2.  链接不链接到其原始 URL。这可能会对 SEO 产生负面影响。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T01:42:55.090

将 onclick 或 onmousedown 处理程序添加到锚标记。您可以看到许多网站都在这样做，例如 Google。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T06:21:17.777

我不喜欢 Eric Tuttleman 所描述的重定向，因为您不幸失去了链接的“搜索引擎友好性”。

我在我拥有的网站上通过向我的传出链接添加一个 onClick 来处理此问题，该链接会触发一个将链接 URL 和时间戳发送到我的数据库的函数。然后我编写了一个后端来检索数据，并让我按“最多点击/24 小时”、“最多点击/1w”等类别查看它。

我希望这有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T01:45:06.600

在我工作过的一个系统上，我们最终将重定向存储在数据库表中，并创建了一个将 id 作为输入的重定向页面。在我们的内容页面上，我们使用此表中的唯一 ID 链接到重定向页面。一旦重定向页面通过表中的 id 查找 url，它就会向客户端发送重定向响应，将它们发送到结束页面。

这确实为我们提供了外部链接的日志记录，并且作为额外的奖励，在某些情况下，它使对外部 URL 的大规模更改更容易一些。

# javascript - 是否有一个习惯用法让一个元素随着页面滚动，直到它到达浏览器的顶部？

> ID：199733
> 
> 赞同：2
> 
> 时间：2008-10-14T01:40:43.287
> 
> 标签：javascript, html, css

基本上，我希望完成类似于[yelp](http://www.yelp.com/)用来让地图在他们的搜索结果页面上跟随你的影响的效果，但我宁愿让它是即时的，而不是让它在你滚动几秒钟后赶上。我也不想将位置设置为“固定”，因为我希望它滚动直到它滚动离开页面，然后才变成“固定”（同样，如果用户稍后向上滚动，我想要地图变得“不卡住”并向下滚动页面）。

我想这可以通过一些复杂的javascript（使用“watch”等）来完成，这些javascript检测地图何时靠近页面顶部并适当地更改CSS值，但我希望结合相对/绝对/固定定位的 div 完全消除了对 Javascript 的需求。

当然，我*真正*想要的是一个插入式库（或 jQuery 插件等），如果存在这样的东西，它就可以满足我的需求。如果没有现成的脚本可以做到这一点，我很想听听有第一手经验的人做或尝试做同样的事情。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T05:28:15.387

好吧，我放弃了，并以 yelp 的方式做到了。

# http - 当资源被禁止但有备用资源时，HTTP 响应应该是什么？

> ID：199737
> 
> 赞同：2
> 
> 时间：2008-10-14T01:43:43.687
> 
> 标签：http, rest, http-headers

如果我有一个请求客户端无权访问的资源，但我想通知他们他们有权访问的备用资源*，***`403 Forbidden`**我应该在标题或内容中向他们发送备用资源的 URI 吗？还是我应该只向**`303 See Other`**他们有权访问的资源发送重定向？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T02:25:29.547

没有“禁止但看看这个”的 HTTP 代码。

但是，您可以自定义 403 错误页面，以便显示指向替代内容的链接。如果您有多个替代链接，您可能会发现此解决方案更好。

如果通知用户访问被拒绝不是那么重要，您可能希望使用 302（临时重定向），或者，如果用户永远无法访问被禁止的内容，则使用 301（永久重定向）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T04:46:45.110

如果有人看到错误页面，那么您选择什么代码并不重要。如果有人类可读的错误信息；人们会忽略代码。

问题是你想让机器做什么？您是否希望机器在任何情况下都自动重定向到替代内容？如果某人有正当理由以编程方式从您的网站获取页面，在这种情况下他们是否应该获得替代内容？或者，如果有人使用缓存代理服务器，您是否希望它自动重定向？

如果您不希望它在这些情况下自动重定向，那么 403 是正确的答案。如果您希望人们获得正确的内容，并且只有真正好奇的用户才会关心原始内容是否被禁止，那么 301 或 302 会更有意义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T01:46:49.763

[http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)

我想你正在寻找 300 家族的东西。自动重定向似乎比 403 友好得多。

另外，403 使对象看起来很有趣，并且可能会引起更多的探测。

# apache-flex - 从本地文件系统加载视频

> ID：199746
> 
> 赞同：0
> 
> 时间：2008-10-14T01:48:00.650
> 
> 标签：apache-flex, actionscript-3, flash

我有一个从浏览器中的 C:/ 运行的 swf，而不是服务器（长故事），并且该 swf 加载了与该 swf 相关的位于 ../../videos/video 的视频。

问题是，当我在 Flex 中运行它时，一切都很酷。在本地运行，它找不到文件（不是安全错误）并抛出连接错误。

有任何想法吗？

注意：这似乎是一个特定于 Windows 的问题，它在我的 Mac 上运行，具有相同的安全设置。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T15:30:13.127

Flex Builder 有一个文件，它将所有 bin 目录添加到其中，以允许调试播放器绕过本地安全限制。

这是[有关该主题的博客文章](http://viconflex.blogspot.com/2008/08/why-no-sandbox-violation-running-from.html)。

> 本质上，Flexbuilder 告诉 Flash 它应该信任 bin 文件夹……如果您在开发机器上搜索文件 flexbuilder_plugin.cfg，您应该在名为 FlashPlayerTrust 的文件夹中找到它，该文件夹与您通常找到 SharedObject 文件的区域大致相同。如果您在文本编辑器中打开此文件，您应该会看到您曾经从事过的每个 flex 项目的每个 bin 文件夹的几乎所有路径。突然间，一切都变得清晰了。

您可以按照 fenomas 的建议进行操作，并将任何目录添加到您的受信任列表中。您也可以按照上述博客文章中的建议进行操作。

> 因此，我创建了一个新文件并将其放在此 flexbuilder_plugin.cfg 文件旁边，并将其命名为 MyProggy.cfg。Flash 配置为读取此文件夹中的所有文件并解析其中的所有路径，并且从这些路径运行的任何应用程序都将被视为“localTrusted”，并将像从 Flexbuilder 运行时一样运行。在这个文本文件中，我放了一行：“c:\program files\my proggy”并保存了它。然后我必须重新启动 Firefox 才能使更改生效。我还在我的应用程序中添加了一个文本标签，并将文本属性绑定到 {Security.sandboxType}。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T01:43:13.343

我建议为 Firefox 获取 HTTPFOX，它是一个嗅探器。然后你可以看到什么是失败的。在我自己的搜索中，我发现 FLV 始终与 SWF 相关，即使在 WEB 上加载时也是如此。我加载的每个资产都与 index.html 文件相关，但 FLV 始终与 SWF 相关。能够观察数据流动或试图流入您的站点是非常宝贵的。

这也解释了为什么有些人在本地加载东西没有问题，但在网络上遇到问题。如果他们正在加载 swf 的 html 文件与 swf 位于不同的位置，则除 FLV 之外的每个资产在在线查看时都有不同的相对路径，然后在本地查看时也会如此。

# c++ - 如何检测 ac/c++ 程序中可能/潜在的堆栈溢出问题？

> ID：199747
> 
> 赞同：43
> 
> 时间：2008-10-14T01:48:53.130
> 
> 标签：c++, c, memory, stack, overflow

是否有一种标准方法可以查看您的应用程序有多少堆栈空间以及在运行期间堆栈使用的最高水印是多少？

同样在实际溢出的可怕情况下会发生什么？

它会崩溃、触发异常或信号吗？所有系统和编译器都有标准还是不同？

我正在专门寻找 Windows、Linux 和 Macintosh。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-14T02:21:29.303

在**Windows**上会产生堆栈溢出**异常。**

下面的 windows 代码说明了这一点：

```
#include <stdio.h>
#include <windows.h>

void StackOverFlow()
{
  CONTEXT context;

  // we are interested control registers
  context.ContextFlags = CONTEXT_CONTROL;

  // get the details
  GetThreadContext(GetCurrentThread(), &context);

  // print the stack pointer
  printf("Esp: %X\n", context.Esp);

  // this will eventually overflow the stack
  StackOverFlow();
}

DWORD ExceptionFilter(EXCEPTION_POINTERS *pointers, DWORD dwException)
{
  return EXCEPTION_EXECUTE_HANDLER;
}

void main()
{
  CONTEXT context;

  // we are interested control registers
  context.ContextFlags = CONTEXT_CONTROL;

  // get the details
  GetThreadContext(GetCurrentThread(), &context);

  // print the stack pointer
  printf("Esp: %X\n", context.Esp);

  __try
  {
    // cause a stack overflow
    StackOverFlow();
  }
  __except(ExceptionFilter(GetExceptionInformation(), GetExceptionCode()))
  {
    printf("\n****** ExceptionFilter fired ******\n");
  }
} 
```

运行此 exe 时，将生成以下输出：

```
Esp: 12FC4C
Esp: 12F96C
Esp: 12F68C
.....
Esp: 33D8C
Esp: 33AAC
Esp: 337CC

****** ExceptionFilter fired ****** 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-14T14:22:26.900

在 Linux 上，如果您的代码尝试写入堆栈，则会出现分段错误。

堆栈的大小是进程之间继承的属性。`ulimit -s`如果您可以使用(in `sh`, `ksh`, `zsh`) 或`limit stacksize`( `tcsh`, )等命令在 shell 中读取或修改它`zsh`。

从程序中，可以使用以下命令读取堆栈的大小

```
#include <sys/resource.h>
#include <stdio.h>

int main() {
    struct rlimit l;
    getrlimit(RLIMIT_STACK, &l);
    printf("stack_size = %ld\n", l.rlim_cur);
    return 0;
} 
```

我不知道获取可用堆栈大小的标准方法。

堆栈以环境`argc`的内容`argv`和副本开头，然后是您的变量。但是，由于内核可以随机化堆栈开始的位置，并且上面可能有一些虚拟值`argc`，因此假设您在`l.rlim_cur`下面有可用的字节是错误的`&argc`。

检索堆栈的确切位置的一种方法是查看文件`/proc/1234/maps` （`1234`程序的进程 ID 在哪里）。一旦你知道了这些界限，你就可以通过查看最新的局部变量的地址来计算你的堆栈使用了多少。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-14T02:23:38.363

gcc 在“不安全”函数调用中在返回地址和普通变量之间放置了一个额外的内存块，例如（在此示例中，函数是 void test() {char a[10]; b[20]}：

```
call stack:
-----------
return address
dummy
char b[10]
char a[20] 
```

如果函数在指针“a”中写入 36 个字节，则溢出将“破坏”返回地址（可能存在安全漏洞）。但它也会改变 'dummy' 的值，即指针和返回地址之间的值，因此程序将崩溃并发出警告（您可以使用 -fno-stack-protector 禁用它）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-10-17T04:02:59.040

在 Linux 上，Gnu [**libsigsegv**库](http://savannah.gnu.org/projects/libsigsegv/)包含函数`stackoverflow_install_handler`，它可以检测（并且在某些情况下帮助您从中恢复）堆栈溢出。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-19T08:46:13.073

On windows, the stack (for specific thread) grows on-demand until the stack size specified for this thread prior to its creation has been reached.

On-demand growing is impelmented using guard pages, in that there's a only a fragment of stack available initially, followed by a guard page, which, when hit, will trigger an exception - this exception is special, and is handled by the system for you - the handling increases the available stack space (also checked if a limit has been reached!) and the read operation is retried.

Once the limit is reached, there's no more growing which results in stack overflow exception. The current stack base and limit are stored in thread environment block, in a struct called `_NT_TIB` (thread information block). If you have a debugger handy, this is what you see:

```
0:000> dt ntdll!_teb @$teb nttib.
   +0x000 NtTib  : 
      +0x000 ExceptionList : 0x0012e030 _EXCEPTION_REGISTRATION_RECORD
      +0x004 StackBase : 0x00130000 
      +0x008 StackLimit : 0x0011e000 
      +0x00c SubSystemTib : (null) 
      +0x010 FiberData : 0x00001e00 
      +0x010 Version : 0x1e00
      +0x014 ArbitraryUserPointer : (null) 
      +0x018 Self   : 0x7ffdf000 _NT_TIB 
```

The StackLimit attribute will get updated on-demand. If you check the attributes on this memory block, you'll see something similar to that:

```
0:000> !address 0x0011e000 
    00030000 : 0011e000 - 00012000
                    Type     00020000 MEM_PRIVATE
                    Protect  00000004 PAGE_READWRITE
                    State    00001000 MEM_COMMIT
                    Usage    RegionUsageStack
                    Pid.Tid  abc.560 
```

And checking a page next to it reveals the guard attribute:

```
0:000> !address 0x0011e000-1000
    00030000 : 0011d000 - 00001000
                    Type     00020000 MEM_PRIVATE
                    Protect  00000104 PAGE_READWRITE | PAGE_GUARD
                    State    00001000 MEM_COMMIT
                    Usage    RegionUsageStack
                    Pid.Tid  abc.560 
```

Hope it helps.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-14T02:36:57.823

堆栈溢出可能是最难处理的异常类型——因为您的异常处理程序必须处理最少量的堆栈（通常为此目的只保留一个页面）。

有关处理此类异常的困难的有趣讨论，请参阅以下博客文章： Chris Brumme 的[1](http://blogs.msdn.com/cbrumme/archive/2003/06/23/51482.aspx)和[2](http://blogs.msdn.com/cbrumme/archive/2003/10/01/51524.aspx)，它们从 .NET 角度关注该问题，特别是托管 CLR。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-19T07:35:54.057

如果您在 linux 上，我建议您使用备用信号堆栈。

1.  在这种情况下，所有信号都将通过备用堆栈进行处理。
2.  如果发生堆栈溢出，系统会生成一个 SEGV 信号，这可以通过备用堆栈进行处理。
3.  如果您不使用它......那么您可能无法处理信号，并且您的程序可能会在没有任何处理/错误报告的情况下崩溃。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-14T08:21:21.683

一些编译器支持 stackavail() 函数，它返回堆栈的剩余可用空间量。您可以在调用程序中需要大量堆栈空间的函数之前使用此函数，以确定调用它们是否安全

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-08-11T10:26:27.827

可以在 Visual Studio 中使用 editbin 来更改堆栈大小。该信息可在[msdn.microsoft.com/en-us/library/35yc2tc3.aspx](http://msdn.microsoft.com/en-us/library/35yc2tc3.aspx)中找到。

# c# - 如何在 C# 中使用可选参数？

> ID：199761
> 
> 赞同：554
> 
> 时间：2008-10-14T01:55:23.053
> 
> 标签：c#, optional-parameters

^(**注意：**这个问题是在 C# 还不支持可选参数的时候提出的（即在 C# 4 之前）。)

我们正在构建一个从 C# 类以编程方式生成的 Web API。该类具有方法`GetFooBar(int a, int b)`，API 具有`GetFooBar`采用查询参数的方法，例如`&a=foo &b=bar`.

这些类需要支持可选参数，这在 C# 语言中不受支持。最好的方法是什么？

* * *

## 回答 #1

> 赞同：1203
> 
> 时间：2010-07-27T12:51:10.473

没有人提到像这样工作的 C# 4.0 可选参数感到惊讶：

```
public void SomeMethod(int a, int b = 0)
{
   //some code
} 
```

**编辑：**我知道在提出问题时，C# 4.0 并不存在。但是这个问题在“C# 可选参数”中仍然在谷歌中排名第一，所以我想——这个答案值得在这里。对不起。

* * *

## 回答 #2

> 赞同：137
> 
> 时间：2008-10-14T02:03:22.913

另一种选择是使用 params 关键字

```
public void DoSomething(params object[] theObjects)
{
  foreach(object o in theObjects)
  {
    // Something with the Objects…
  }
} 
```

被称为...

```
DoSomething(this, that, theOther); 
```

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2008-10-14T02:00:02.077

在 C# 中，我通常会使用多种形式的方法：

```
void GetFooBar(int a) { int defaultBValue;  GetFooBar(a, defaultBValue); }
void GetFooBar(int a, int b)
{
 // whatever here
} 
```

**更新：** 上面提到的这就是我使用 C# 2.0 执行默认值的方式。我现在正在处理的项目使用的是现在直接支持可选参数的 C# 4.0。这是我刚刚在自己的代码中使用的示例：

```
public EDIDocument ApplyEDIEnvelop(EDIVanInfo sender, 
                                   EDIVanInfo receiver, 
                                   EDIDocumentInfo info,
                                   EDIDocumentType type 
                                     = new EDIDocumentType(EDIDocTypes.X12_814),
                                   bool Production = false)
{
   // My code is here
} 
```

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2008-10-14T01:57:23.423

从这个网站：

[http://www.tek-tips.com/viewthread.cfm?qid=1500861&page=1](http://www.tek-tips.com/viewthread.cfm?qid=1500861&page=1)

C# 确实允许使用 [Optional] 属性（来自 VB，但在 C# 中不起作用）。所以你可以有这样的方法：

```
using System.Runtime.InteropServices;
public void Foo(int a, int b, [Optional] int c)
{
  ...
} 
```

在我们的 API 包装器中，我们检测可选参数 (ParameterInfo p.IsOptional) 并设置默认值。目标是将参数标记为可选，而无需在参数名称中使用“可选”之类的杂乱无章的东西。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2008-10-14T02:03:13.320

您可以使用方法重载...

```
获取FooBar()
GetFooBar(int a)
GetFooBar（int a，int b）

```

这取决于方法签名，我给出的示例缺少“int b”唯一方法，因为它与“int a”方法具有相同的签名。

你可以使用 Nullable 类型...

```
GetFooBar(int?a,int?b)

```

然后，您可以使用 a.HasValue 检查是否已设置参数。

另一种选择是使用“params”参数。

```
GetFooBar（参数对象 [] 参数）

```

如果您想使用命名参数，则需要创建一种类型来处理它们，尽管我认为 Web 应用程序已经有了类似的东西。

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2011-02-22T09:52:50.387

您可以毫无顾虑地使用 C# 4.0 中的可选参数。如果我们有这样的方法：

```
int MyMetod(int param1, int param2, int param3=10, int param4=20){....} 
```

当您调用该方法时，您可以跳过这样的参数：

```
int variab = MyMethod(param3:50; param1:10); 
```

C# 4.0 实现了一个名为“命名参数”的功能，您实际上可以通过参数名称传递参数，当然您可以按照您想要的任何顺序传递参数 :)

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2015-04-23T10:10:38.640

一种允许您在**任何位置省略****任何参数**的简单方法是利用[可空类型](https://msdn.microsoft.com/en-us/library/1t3y8s4s.aspx)，如下所示：

 **```
public void PrintValues(int? a = null, int? b = null, float? c = null, string s = "")
{
    if(a.HasValue)
        Console.Write(a);
    else
        Console.Write("-");

    if(b.HasValue)
        Console.Write(b);
    else
        Console.Write("-");

    if(c.HasValue)
        Console.Write(c);
    else
        Console.Write("-");

    if(string.IsNullOrEmpty(s)) // Different check for strings
        Console.Write(s);
    else
        Console.Write("-");
} 
```

字符串已经是可为空的类型，因此它们不需要**?** .

一旦你有了这个方法，下面的调用都是**有效**的：

```
PrintValues (1, 2, 2.2f);
PrintValues (1, c: 1.2f);
PrintValues(b:100);
PrintValues (c: 1.2f, s: "hello");
PrintValues(); 
```

当您以这种方式定义方法时，您可以通过**命名**来自由设置所需的参数。有关命名参数和可选参数的更多信息，请参见以下链接：

[命名和可选参数（C# 编程指南）@ MSDN](https://msdn.microsoft.com/en-us/library/dd264739.aspx)

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2008-10-14T10:58:22.803

## 你好可选世界

如果您希望运行时提供默认参数值，则必须使用反射来进行调用。不如这个问题的其他建议好，但与 VB.NET 兼容。

```
using System;
using System.Runtime.InteropServices;
using System.Reflection;

namespace ConsoleApplication1
{
    class Class1
    {
        public static void sayHelloTo(
            [Optional,
            DefaultParameterValue("world")] string whom)
        {
            Console.WriteLine("Hello " + whom);
        }

        [STAThread]
        static void Main(string[] args)
        {
            MethodInfo mi = typeof(Class1).GetMethod("sayHelloTo");
            mi.Invoke(null, new Object[] { Missing.Value });
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-10-14T02:09:14.710

我同意斯蒂芬拜尔的观点。但由于它是一种 Web 服务，最终用户只使用一种形式的 Web 方法比使用同一方法的多个版本更容易。我认为在这种情况下，可空类型非常适合可选参数。

```
public void Foo(int a, int b, int? c)
{
  if(c.HasValue)
  {
    // do something with a,b and c
  }
  else
  {
    // do something with a and b only
  }  
} 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2011-05-23T17:16:32.473

可选参数用于方法。如果您需要一个类的可选参数并且您是：

*   使用 c# 4.0：在类的构造函数中使用可选参数，这是我更喜欢的解决方案，因为它更接近于方法所做的事情，因此更容易记住。这是一个例子：

    ```
    class myClass
    {
        public myClass(int myInt = 1, string myString =
                               "wow, this is cool: i can have a default string")
        {
            // do something here if needed
        }
    } 
    ```

*   使用 c#4.0 之前的 c# 版本：您应该使用构造函数链接（使用 :this 关键字），其中更简单的构造函数会导致“主构造函数”。例子：

    ```
    class myClass
    {
        public myClass()
        {
        // this is the default constructor
        }

        public myClass(int myInt)
            : this(myInt, "whatever")
        {
            // do something here if needed
        }
        public myClass(string myString)
            : this(0, myString)
        {
            // do something here if needed
        }
        public myClass(int myInt, string myString)
        {
            // do something here if needed - this is the master constructor
        }
    } 
    ```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-14T02:03:53.193

如 stephen 所述，在 C# 中处理此问题的典型方法是重载该方法。通过创建具有不同参数的方法的多个版本，您可以有效地创建可选参数。在具有较少参数的表单中，您通常会调用该方法的表单，其中所有参数设置您在调用该方法时的默认值。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-12-09T08:48:07.747

你可以重载你的方法。一种方法包含一个参数`GetFooBar(int a)`，另一种包含两个参数，`GetFooBar(int a, int b)`

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-09-12T09:07:06.170

使用重载或使用 C# 4.0 或更高版本

```
 private void GetVal(string sName, int sRoll)
 {
   if (sRoll > 0)
   {
    // do some work
   }
 }

 private void GetVal(string sName)
 {
    GetVal("testing", 0);
 } 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-04-22T18:04:39.950

`Dictionary<string,Object>`对于较大数量的可选参数，该方法可以使用单个参数 of `ContainsKey`。我喜欢这种方法，因为它允许我单独传递 a`List<T>`或 a`T`而无需创建一个完整的其他方法（例如，如果将参数用作过滤器，那就太好了）。

示例（`new Dictionary<string,Object>()`如果不需要可选参数，将被传递）：

```
public bool Method(string ParamA, Dictionary<string,Object> AddlParams) {
    if(ParamA == "Alpha" && (AddlParams.ContainsKey("foo") || AddlParams.ContainsKey("bar"))) {
        return true;
    } else {
        return false;
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-14T02:09:07.347

而不是默认参数，为什么不从传递的查询字符串构造一个字典类.. 一个几乎与 asp.net 表单处理查询字符串的方式相同的实现。

即 Request.QueryString["a"]

这将使叶子类与工厂/样板代码分离。

* * *

您可能还想查看[带有 ASP.NET 的 Web 服务](http://msdn.microsoft.com/en-us/library/ms972326.aspx)。Web 服务是通过 C# 类的属性自动生成的 Web api。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-11-17T01:50:33.137

聚会有点晚了，但我一直在寻找这个问题的答案，最终想出了另一种方法来做到这一点。将 Web 方法的可选参数的数据类型声明为 XmlNode 类型。如果可选的 arg 被省略，这将被设置为 null，如果它存在，您可以通过调用 arg.Value 获得字符串值，即

```
[WebMethod]
public string Foo(string arg1, XmlNode optarg2)
{
    string arg2 = "";
    if (optarg2 != null)
    {
        arg2 = optarg2.Value;
    }
    ... etc
} 
```

这种方法的另一个优点是 .NET 生成的 ws 主页仍然显示参数列表（尽管您确实丢失了方便的文本输入框进行测试）。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-12-22T00:40:52.117

我要编写一个需要 7 个参数的 Web 服务。每个都是此 Web 服务包装的 sql 语句的可选查询属性。因此，我想到了两种非可选参数的解决方法......都很差：

方法1（参数1，参数2，参数3，参数4，参数5，参数6，参数7）方法1（参数1，参数2，参数3，参数4，参数5，参数6）方法1（参数1，参数2，参数3，参数4，参数5，参数7） )...开始看图。这种方式是疯狂的。组合太多了。

现在寻找一种看起来很尴尬但应该可以使用的更简单的方法：method1(param1, bool useParam1, param2, bool useParam2, etc...)

这是一个方法调用，所有参数的值都是必需的，它将处理其中的每种情况。从界面上如何使用它也很清楚。

这是一个黑客，但它会工作。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-01-03T20:21:22.123

我必须在 VB.Net 2.0 Web 服务中执行此操作。我最终将参数指定为字符串，然后将它们转换为我需要的任何内容。使用空字符串指定了一个可选参数。不是最干净的解决方案，但它有效。请注意捕获所有可能发生的异常。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-06-17T13:46:48.633

为了以防万一有人想将回调（或`delegate`）作为可选参数传递，可以这样做。

**可选回调参数：**

```
public static bool IsOnlyOneElement(this IList lst, Action callbackOnTrue = (Action)((null)), Action callbackOnFalse = (Action)((null)))
{
    var isOnlyOne = lst.Count == 1;
    if (isOnlyOne && callbackOnTrue != null) callbackOnTrue();
    if (!isOnlyOne && callbackOnFalse != null) callbackOnFalse();
    return isOnlyOne;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-08-02T19:54:35.047

可选参数不过是默认参数！我建议你给他们两个默认参数。GetFooBar(int a=0, int b=0) 如果你没有任何重载方法，将导致a=0，如果你不传递任何值，b=0，如果你传递1个值，将导致, 为 a 传递值，0，如果传递 2 个值，第一个将分配给 a，第二个分配给 b。

希望这能回答你的问题。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-09-23T10:06:04.697

在默认值不可用的情况下，添加可选参数的方法是使用 .NET OptionalAttribute 类 - [https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.optionalattribute ?view=网络框架-4.8](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.optionalattribute?view=netframework-4.8)

代码示例如下：

```
namespace OptionalParameterWithOptionalAttribute
{
    class Program
    {
        static void Main(string[] args)
        {
            //Calling the helper method Hello only with required parameters
            Hello("Vardenis", "Pavardenis");
            //Calling the helper method Hello with required and optional parameters
            Hello("Vardenis", "Pavardenis", "Palanga");
        }
        public static void Hello(string firstName, string secondName, 
            [System.Runtime.InteropServices.OptionalAttribute] string  fromCity)
        {
            string result = firstName + " " + secondName;
            if (fromCity != null)
            {
                result += " from " + fromCity;
            }
            Console.WriteLine("Hello " + result);
        }

    }
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-07-28T15:47:05.593

您可以使用默认值。

```
public void OptionalParameters(int requerid, int optinal = default){} 
```

* * *

## 回答 #23

> 赞同：-4
> 
> 时间：2018-03-23T04:30:48.807

你也可以试试
Type 1
`public void YourMethod(int a=0, int b = 0) { //some code }`

类型 2
`public void YourMethod(int? a, int? b) { //some code }`

# vim - 如何让 GVim 中的终端对鼠标滚动做出反应？

> ID：199769
> 
> 赞同：2
> 
> 时间：2008-10-14T01:59:52.063
> 
> 标签：vim

顺便说一句，我正在使用 Hardy Heron Ubuntu 构建。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T12:59:39.687

尝试：

：设置鼠标=a

“：帮助鼠标”说

```
Enable the use of the mouse.  Only works for certain terminals
(xterm, MS-DOS, Win32 |win32-mouse|, qnx pterm, and Linux console
with gpm).  For using the mouse in the GUI, see |gui-mouse|.
The mouse can be enabled for different modes:
    n   Normal mode
    v   Visual mode
    i   Insert mode
    c   Command-line mode
    h   all previous modes when editing a help file
    a   all previous modes
    r   for |hit-enter| and |more-prompt| prompt
    A   auto-select in Visual mode
Normally you would enable the mouse in all four modes with: >
    :set mouse=a
When the mouse is not enabled, the GUI will still use the mouse for
modeless selection.  This doesn't move the text cursor. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T02:21:45.013

讨厌给出这个答案，因为它不是很有帮助，但对我来说效果很好（ubuntu hardy 上的 gvim 中的滚轮）。

但也许我可以提出一些有助于调试问题的建议：

1.  确认您正在运行“gvim”并尝试滚动出现的新窗口（即您没有在 xterm 中运行 vim 并尝试用鼠标滚动它）
2.  确认滚轮在其他应用程序中有效。如果您不确定，请使用“xev”确保 X 服务器看到滚动事件。

希望有帮助。

# visual-studio - Visual Studio 2005 中安装程序类的目的是什么

> ID：199773
> 
> 赞同：2
> 
> 时间：2008-10-14T02:01:58.220
> 
> 标签：visual-studio

我来看看 Visual Studio 中的安装程序类项目。为什么他们为安装程序维护一个单独的项目。他们是否创建任何自定义安装程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T02:11:41.633

Installer 类可用于配置性能计数器和消息队列等项目，作为代码安装的一部分。它们可以包含在任何程序集中，安装与程序集相关的组件的最基本方法是使用包含您的代码和自定义安装程序的 InstallUtil yourassembly.dll。为以这种方式添加的任何内容提供卸载选项是一种很好的做法。

请参阅此处了解更多信息[http://msdn.microsoft.com/en-us/library/z3xc61bs(VS.80).aspx](http://msdn.microsoft.com/en-us/library/z3xc61bs(VS.80).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T02:14:03.483

我还使用它们来覆盖基本安装程序类中的行为，以便我可以根据 MSI 向导中的输入运行验证、创建文件和文件夹等。

对于 Windows 服务，我认为它们是必需的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T02:39:52.777

我使用安装程序类的一件事是用于加速启动的 NGEN（本机图像）。安装程序类调用 NGEN.exe 将其放入本机映像中。

[http://dotnetperls.com/Content/NGEN-Installer-Class.aspx](http://dotnetperls.com/Content/NGEN-Installer-Class.aspx)

# java - Eclipse 帮助中的 Postgres JDBC 连接

> ID：199774
> 
> 赞同：10
> 
> 时间：2008-10-14T02:02:14.350
> 
> 标签：java, postgresql, jdbc

我正在尝试使 postgres jdbc 连接在 Eclipse 中工作。使用 Data Source Explorer 会很好，但现在我只是想建立一个基本的连接。到目前为止我所做的是下载 postgres JDBC 连接器。然后我尝试了两种不同的方法。首先，Preferences-> Data Management，我尝试添加 postgres 连接器。其次，我将 jar 添加到我的项目中并尝试使用 Class.forName("org.postgresql.Driver"); 加载驱动程序；但都没有奏效。有没有人有任何想法？

谢谢，查理

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-18T08:25:06.447

这就是我建立联系的方式：（我不知道这是否是“最佳实践”，但它有效。）

导入驱动：

1.  右键单击您的项目
2.  选择物业
3.  选择`Java build path`
4.  选择`Add external JARS..`并选择 JDBC 驱动程序的位置。

这是我的代码：

```
try{
    Class.forName("org.postgresql.Driver");
    } catch (ClassNotFoundException cnfe){
      System.out.println("Could not find the JDBC driver!");
      System.exit(1);
    }
Connection conn = null;
try {
    conn = DriverManager.getConnection
                   (String url, String user, String password);
     } catch (SQLException sqle) {
       System.out.println("Could not connect");
       System.exit(1);
     } 
```

url 可以是以下格式之一：

```
jdbc:postgresql:database
jdbc:postgresql://host/database
jdbc:postgresql://host:port/database 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-23T00:35:31.827

我也遇到了这个问题，Vjeux 的回答帮助我指出了正确的方向。

我有一个已安装并由 Eclipse 管理的 Tomcat6 的本地副本。它被安装到“$HOME/bin/tomcat6”中。为了让 PostgreSQL JDBC 驱动程序正常工作，我只需将我的 postgresql.jar 文件复制到“$HOME/bin/tomcat6/lib”目录中。

另外，如果您一开始不知道从哪里获得驱动程序，请试试这个。我正在运行 Ubuntu，所以我运行了“sudo apt-get install libpg-java”，它将驱动程序安装到“/usr/share/java/postgresql.jar”中，所以我只是从那里复制了它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-15T13:40:37.530

我在使用 GWT 时遇到了同样的问题。

我通过将 jar 文件复制到“lib”文件夹中来修复它：(Project\war\WEB-INF\lib)。当您将 jar 添加到构建路径时，它似乎静态地进行链接，但是我们希望 lib 在运行时！

希望它能解决你的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-23T19:10:19.393

您可以在 persistence.xml 中编写此代码

> ```
>  <property name="javax.persistence.jdbc.driver" value="org.postgresql.Driver"/>
>         <property name="javax.persistence.jdbc.url" value="jdbc:postgresql://localhost:5432/yourDataBaseName"/>
>         <property name="javax.persistence.jdbc.user" value="postgres"/>
>         <property name="javax.persistence.jdbc.password" value="yourPassword"/> 
> ```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-17T09:08:08.170

这是使 PostgreSQL 连接到您的应用程序的一种方法：

1.  获取一个实例`org.postgresql.ds.PGSimpleDataSource`
2.  使用与您的数据库匹配的值进行设置（参见下面的方法）
3.  继续使用 DataSource ，就像使用其他任何方法一样，我假设此时您会对该`DataSource.getConnection()`方法感兴趣。

用于配置此特定 DataSource的专有方法是`setServerName()`、`setDatabaseName()`和。`setUser()``setPassword()`

除了测试之外，我不建议您这样做，而且您的问题可能在于您尝试使用获取对象实例的`Class.forName()`方式 几乎有十几种不同的方法来获取具有细微差异的对象实例，我建议用谷歌搜索它，因为它是一个很多人已经在互联网上写过的主题。

# command-line - 在 Windows 命令提示符中丢失了正斜杠的使用

> ID：199792
> 
> 赞同：2
> 
> 时间：2008-10-14T02:09:54.430
> 
> 标签：command-line, cygwin, windows-xp, cwrsync

我不能再在windows xp 命令提示符下使用/，而且它似乎是在一个拙劣的cygwin 安装之后启动的，例如cd /windows 不起作用，但习惯了。

谁能想到这可能是怎么发生的？

**哎呀！它通常在 XP 中不起作用**，尽管我读过它在 Vista 中起作用。我简化了我的问题，但这是错误的。**真正的问题是：**

我正在使用 cwrsync 二进制文件（用于 cygwin），它可以在命令提示符下以如下方式使用：

> ssh -i /keydir/keyfile 用户@服务器

但是在做了一些事情之后（好像是在安装 cygwin），甚至在重新安装了 cwrsync 文件之后，我现在只能做：

> ssh -i \keydir\keyfile user@server，即我在引用本地文件时必须使用windows约定。

我在 cwrsync 论坛上发布了这个，但它不是很活跃，所以我希望有人能认出这里发生了什么，我也许也应该试试 cygwin 论坛。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-30T18:10:59.563

实际上，从 DOS 2.0 开始，内核和文件 API*一直*支持正斜杠和许多命令行调用。请参阅：http: [//blogs.msdn.com/larryosterman/archive/2005/06/24/432386.aspx](http://blogs.msdn.com/larryosterman/archive/2005/06/24/432386.aspx)。

我曾经不遗余力地检测操作系统并在 PHP 中使用 PATH_SEPARATOR 类型常量，但我偶然发现了这一点（现在认为它的使用已被弃用，而不是简单的“/”）。

干杯。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T05:17:36.280

你想象的 - 它从来没有奏效。

如果你碰巧在里面`C:\`并输入

> `C:\>cd /windows`

它会带你去，`C:\WINDOWS\`但这只是因为`/windows`它不是一个有效的选项`cd`，所以它试图忽略`/`.

正斜杠是 UNIX 和 cygwin 中的路径分隔符，但 Windows 将它用于命令行选项，例如。`dir /w`.

# asp.net - 如何在 ASP.NET 2.0 中使用 DataSet 使 GridView 加载图像？

> ID：199808
> 
> 赞同：1
> 
> 时间：2008-10-14T02:20:56.123
> 
> 标签：asp.net, gridview, image

我有一个包含以下列的图片表：

```
PICTURE_ID int IDENTITY(1000,1) NOT NULL,
CATEGORY_ID int NOT NULL,
IMGDATA image NOT NULL,
CAPTION1 text COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
MIME_TYPE nchar(20) NOT NULL DEFAULT ('image/jpeg'),
IMGTHDATA image NOT NULL 
```

在我的代码隐藏中，我有这个：

```
string tableName = "CATPICS";
SqlConnection dbConnection = new SqlConnection(connStr);
SqlDataAdapter daCatPics = new SqlDataAdapter("SELECT TOP(3) * FROM CATEGORY_PICTURES", dbConnection);
DataSet dsPics = new DataSet();
daCatPics.Fill(dsPics, tableName);

gvCatPics.DataSource = dsPics;
gvCatPics.DataMember = tableName;
gvCatPics.DataBind(); 
```

在标记上，我几乎有：

```
<asp:GridView ID="gvCatPics" runat="server"></asp:GridView> 
```

但是，当代码执行时，它只是忽略了两个图像列（IMGDATA 和 IMGTHDATA）。由于某种原因，它无法识别它们是图像列。有谁知道让它渲染图像的最简单方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T02:29:26.090

您可以创建一个将图像作为流返回的页面，并从图像列（或模板列中的 IMG 标记）引用该页面；请参阅[GridViewDisplayBlob.aspx](http://www.netomatix.com/development/GridViewDisplayBlob.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T02:27:07.280

没有真正简单的方法可以做到这一点。基本上，您将需要创建一个处理程序来显示图像。然后在您的网格中，您将创建一个带有指向您的图像处理程序的 URL 的 img 标记。

这方面的一个例子可以在[这里](http://blogs.msdn.com/jdixon/articles/495408.aspx)找到。

**更新：**[这里](http://www.odetocode.com/Articles/172.aspx)有更好的例子。

# configuration - 我可以参数化 CruiseControl.NET 项目配置，以便 Web 界面公开参数吗？

> ID：199819
> 
> 赞同：1
> 
> 时间：2008-10-14T02:27:10.760
> 
> 标签：configuration, cruisecontrol.net, nant, project, parameterized

我目前正在尝试使用 NAnt 和 CruiseControl.NET 来管理我的软件开发的各个方面。目前，NAnt 几乎可以处理所有事情，包括根据我在命令行中指定的输入目标替换特定于环境的设置*（例如，数据库连接字符串） 。*

CruiseControl.NET 用于在提交新代码时为默认环境*(dev)构建应用程序。*我还希望 CruiseControl.NET 为我的其他环境测试和阶段调用构建，但我不希望每次（每天）调用开发构建时自动调用这些，因为测试和阶段部署发生的频率要低得多。测试和阶段部署仅在应用程序准备好进行 QA 时进行。

我可以通过指定多个项目来轻松做到这一点，每个环境一个。但是，我已经配置了许多项目，我的应用程序中的每个里程碑都有一个。如果我必须为每个里程碑设置 3 个项目，CruiseControl.NET 配置可能会很快失控。

**这是我的问题：** 我可以参数化 CruiseControl.NET 项目配置，以便 Web 界面公开参数吗？

*最好（我认为），我可以在 Web 界面中公开每个环境（例如，开发、测试、阶段）的复选框。将为检查的每个环境进行构建，无论构建是强制的还是自动的。如果我可以默认选中状态会更好。*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-05T18:29:52.867

此功能（动态构建参数）目前正在为 1.5 开发，您可以在[nightlies](http://ccnetlive.thoughtworks.com/CCNet-builds/1.5.0/)中试用。这是[描述该功能的帖子](http://csut017.wordpress.com/2009/05/12/dynamic-build-parameters-some-examples/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T11:25:50.377

正如 Scott 所提到的，这是不可用的，但只需编写一个小模板然后自动生成 ccnet.config 文件给定该模板和邮件合并类型的环境列表就不会花费太多.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T02:29:57.993

不幸的是，CruiseControl.NET 不能做类似的事情。这是一个好主意，因此您可能希望将其作为功能请求提交。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-01-07T21:03:51.620

现在从 Cruisecontrol 1.5 开始完全支持：http: [//cruisecontrolnet.org/projects/ccnet/wiki/Parameters](http://cruisecontrolnet.org/projects/ccnet/wiki/Parameters)

# php - 如何使用 PHP 将 SOAP 发送到 SAP Erecruitment 数据库

> ID：199822
> 
> 赞同：0
> 
> 时间：2008-10-14T02:28:24.517
> 
> 标签：php, soap, sap

我们的团队正在研究 SAP，并获得一个用 PHP 和 MySQL 编写的网站前端，以连接 SAP 上的招聘数据库......我们已经尝试制作 SOAP 客户端和一切，但似乎我们遗漏了一些东西......步骤是什么以确保它们可以在有或没有 wsdl 的情况下同步。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T13:17:25.313

The standard PHP SOAP module has always worked for me.... [http://no.php.net/manual/en/function.soap-soapclient-construct.php](http://no.php.net/manual/en/function.soap-soapclient-construct.php)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T19:05:31.957

以这种方式使用 RFC 可能更有意义

*   项目清单
*   没有编组和解组
*   您可以使用标准交付和支持的 SAP 代码
*   您不需要为功能模块或组创建 Web 服务

    适配器链接：[http ://saprfc.sourceforge.net/home.php](http://saprfc.sourceforge.net/home.php)

    买书链接： http: [//www.sap-press.com/product.cfm?account=&product=H1908](http://www.sap-press.com/product.cfm?account=&product=H1908)

# c# - 程序集命名和版本控制的最佳实践？

> ID：199823
> 
> 赞同：38
> 
> 时间：2008-10-14T02:28:56.480
> 
> 标签：c#, .net, assemblies, versioning

我正在寻找一些关于命名程序集和对其进行版本控制的良好做法。您多久增加一次主要或次要版本？

在某些情况下，我看到版本直接从 1.0 版升级到 3.0 版。在其他情况下，它似乎停留在 1.0.2.xxxx 版本。

这将用于整个公司的多个项目中使用的共享程序集。期待一些好的输入。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-17T17:03:37.367

在 MSDN 上 Suzanne Cook 的博客上的[这篇文章](http://blogs.msdn.com/suzcook/archive/2003/05/29/57148.aspx)中提供了一些很好的信息（2003-05-30 发布）：

> # 何时更改文件/程序集版本
> 
> 首先，文件版本和程序集版本不必相互一致。我建议文件版本随着每次构建而改变。但是，不要在每次构建时更改程序集版本，以便您可以分辨同一文件的两个版本之间的区别；为此使用文件版本。决定何时更改程序集版本需要对要考虑的构建类型进行一些讨论：运输和非运输。
> 
> **非**
> 发货版本 一般来说，我建议在发货版本之间保持非发货组件版本相同。这避免了由于版本不匹配而导致的强命名程序集加载问题。有些人更喜欢使用发布者策略为每个构建重定向新的程序集版本。但是，我建议不要将其用于非运输版本：它并不能避免所有加载问题。例如，如果合作伙伴 x 复制您的应用，他们可能不知道安装发布者政策。然后，您的应用程序将被他们破坏，即使它在您的机器上运行良好。
> 
> 但是，如果同一台机器上的不同应用程序需要绑定到程序集的不同版本，我建议为这些构建提供不同的程序集版本，以便可以使用每个应用程序的正确版本，而无需使用 LoadFrom/etc。
> 
> **发布**
> 版本 至于为发布版本更改该版本是否是一个好主意，这取决于您希望绑定如何为最终用户工作。您希望这些构建是并排的还是就地的？两个版本之间有很多变化吗？他们会破坏一些客户吗？您是否关心它会破坏它们（或者您是否想强制用户使用您的重要更新）？如果是，您应该考虑增加程序集版本。但是，再一次，考虑这样做太多次可能会在用户的磁盘上乱扔过时的程序集。
> 
> **当您更改您的程序集版本时**
> 要将硬编码版本更改为新版本，我建议在头文件中为版本设置一个变量，并将源代码中的硬编码替换为该变量。然后，在构建期间运行预处理器以放入正确的版本。我建议在发货后立即更改版本，而不是在之前更改版本，以便有更多时间来发现由于更改导致的错误。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-14T02:36:32.910

定义版本控制的一种方法是为每个部分赋予语义含义：

*   当与新版本的兼容性中断时，从 Nx 转到 N+1.0
*   当添加不破坏兼容性的新功能时，从 NM 转到 N.M+1
*   添加错误修复后，从 NMX 转到 NMX+1

上面只是一个例子——你想定义对你有意义的规则。但是对于用户来说，仅通过查看版本就可以快速判断是否存在不兼容是非常好的。

哦，别忘了公布你想出的规则，让人们知道会发生什么。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-08-18T22:35:16.353

语义版本控制有一套关于如何应用（以及何时）的指南和规则。很容易遵循，它只是工作。

[http://semver.org/](http://semver.org/)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-14T02:42:18.793

我建议的第一件事是熟悉 Assembly 版本和 File 版本之间的差异。不幸的是，当涉及到 AssemblyInfo 文件时，.NET 倾向于将这些视为相同，因为它通常只放置 AssemblyVersion 并允许 FileVersion 默认为相同的值。

既然您说这是一个共享程序集，我假设您的意思是它是在二进制级别共享的（而不是通过将项目包含在各种解决方案中）。如果是这种情况，您需要非常谨慎地更改程序集版本，因为这是 .NET 用来对程序集进行强命名（以允许您将其放入 GAC）并构成“程序集全名”的方式。当程序集版本更改时，它可以对使用它的应用程序进行重大更改，而无需在 app.config 文件中添加程序集重定向条目。

至于命名，我认为这取决于您公司的命名规则（如果有的话）和图书馆的目的。例如，如果这个库提供了不特定于任何特定产品或业务线的“核心”（或系统级）功能，您可以将其命名为：

```
CompanyName.Framework.Core 
```

如果它是更大图书馆的一部分，或者只是

```
CompanyName.Shared
CompanyName.Core
CompanyName.Framework 
```

至于何时增加版本号，它仍然是相当主观的，并且取决于您认为内部版本号的每个部分代表什么。默认的 Microsoft 方案是 Major.Minor.Build.Revision，但这并不意味着您不能提出自己的定义。最重要的是在您的策略中保持一致，并确保定义和规则对您的所有产品都有意义。

在我见过的几乎每个版本方案中，前两个部分都是 Major.Minor。当有大的更改和/或重大更改时，主要版本号通常会增加，而次要版本号通常会增加，以指示发生的更改不是重大更改。其他两个数字要主观得多，可以是“构建”（通常是序列日期值或每天更改的顺序更新数字）和“修订”或补丁号。我还看到它们颠倒过来（给出 Major.Minor.Revision.Build），其中 build 是来自自动构建系统的按顺序递增的数字。

请记住，在导出程序集时，程序集主要版本和次要版本用作类型库版本号。

最后，查看其中一些资源以获取更多信息：

[http://msdn.microsoft.com/en-us/library/51ket42z.aspx](http://msdn.microsoft.com/en-us/library/51ket42z.aspx)

[http://msdn.microsoft.com/en-us/library/system.reflection.assemblyversionattribute.aspx](http://msdn.microsoft.com/en-us/library/system.reflection.assemblyversionattribute.aspx)

[http://blogs.msdn.com/suzcook/archive/2003/05/29/57148.aspx](http://blogs.msdn.com/suzcook/archive/2003/05/29/57148.aspx)

# asp.net - ASP.NET：在gridview中隐藏列

> ID：199832
> 
> 赞同：6
> 
> 时间：2008-10-14T02:32:07.520
> 
> 标签：asp.net, .net, gridview

有没有办法可以控制代码中的列。

我有一个带有 select 的下拉框：每日和周末，以及带有周一、周二、周三、周四、周五、周六、周日的 gridview 列。如果用户选择每日我只想显示从星期一到星期五的列。

可以通过代码进行控制。哦，我在我的网页中使用这个 griview 并使用 C# 完成编码。

帮助！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-14T03:39:16.027

使用[列](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.columns.aspx)属性：

```
GridView1.Columns[5].Visible = false
GridView1.Columns[6].Visible = false 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-05T09:58:31.323

所有这些代码片段仅在您将 AutoGenerateColumns 设置为 false 时才有效。如果您使用的是 AutoGeneratedColumns，那么您必须循环每一行并隐藏相应的单元格。

谢谢

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T03:36:30.743

在 Item DataBound 事件处理程序子中，对于每个网格行，检查“每日”或“周末”的下拉列表，然后在适当的情况下将相关列的可见性设置为 False 或 true。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T03:43:13.837

[您可以通过对Columns](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.columns(VS.80).aspx)集合进行索引并设置 Visible 属性以编程方式隐藏或显示列。

例如，要隐藏 gridview 中的第一列：

```
theGridview.Columns[0].Visible = false; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T03:57:53.900

使用列的索引可能会很麻烦——方便的是，Columns 属性也接受列的名称，您可以在创建时使用列的 Name 属性设置它。这有助于使代码自我记录。

# java - java中的随机访问文件

> ID：199847
> 
> 赞同：4
> 
> 时间：2008-10-14T02:44:39.350
> 
> 标签：java, random-access

我有以下字段：

*   库存控制（16 字节记录）
    *   产品 ID 代码（int – 4 个字节）
    *   库存数量（int – 4 字节）
    *   价格（双倍 - 8 字节）

如何使用上述长度创建固定长度的随机访问文件？我在网上尝试了一些示例，但是当我尝试访问它们时，要么得到 EOF 异常，要么得到随机地址值。

我尝试了更多示例，但无法很好地理解这个概念。我正在尝试一个项目，并将尝试更多地探索它。

这是一些示例数据。`No. in stock`数据中可能存在漏洞`23 == 023`。

```
 Quantity
ID. No.   In Stock   Price

-------   --------   ------
 1001       476      $28.35
 1002       240      $32.56
 1003       517      $51.27
 1004       284      $23.75
 1005       165      $32.25 
```

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-14T03:41:47.863

java.io.RandomAccessFile 是您要查找的类。这是一个示例实现（您可能想要编写一些单元测试，因为我没有:)

```
package test;

import java.io.IOException;
import java.io.RandomAccessFile;

public class Raf {
    private static class Record{
        private final double price;
        private final int id;
        private final int stock;

        public Record(int id, int stock, double price){
            this.id = id;
            this.stock = stock;
            this.price = price;
        }

        public void pack(int n, int offset, byte[] array){
            array[offset + 0] = (byte)(n & 0xff);
            array[offset + 1] = (byte)((n >> 8) & 0xff);
            array[offset + 2] = (byte)((n >> 16) & 0xff);
            array[offset + 3] = (byte)((n >> 24) & 0xff);
        }

        public void pack(double n, int offset, byte[] array){
            long bytes = Double.doubleToRawLongBits(n);
            pack((int) (bytes & 0xffffffff), offset, array);
            pack((int) ((bytes >> 32) & 0xffffffff), offset + 4, array);
        }

        public byte[] getBytes() {
            byte[] record = new byte[16];
            pack(id, 0, record);
            pack(stock, 4, record);
            pack(price, 8, record);
            return record;
        }
    }

    private static final int RECORD_SIZE = 16;
    private static final int N_RECORDS = 1024;

    /**
     * @param args
     * @throws IOException 
     */
    public static void main(String[] args) throws IOException {
        RandomAccessFile raf = new RandomAccessFile(args[0], "rw");
        try{
            raf.seek(RECORD_SIZE * N_RECORDS);

            raf.seek(0);

            raf.write(new Record(1001, 476, 28.35).getBytes());
            raf.write(new Record(1002, 240, 32.56).getBytes());
        } finally {
            raf.close();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-05-26T10:51:15.333

使用最新的 Java 版本，您可以使用 FileChannel 管理随机访问文件。SeekableByteChannel 接口定义了一些方法，这些方法允许您更改指针在目标实体（如通道连接到的文件）中的位置。FileChannel 实现 SeekableByteChannel 允许您使用通道管理随机访问文件。方法大小、位置、截断允许您随机读取和写入文件。

有关详细信息和示例，请参阅[http://www.zoftino.com/java-random-access-files](http://www.zoftino.com/java-random-access-files)。

# silverlight - Silverlight ImageButton 用户控件

> ID：199866
> 
> 赞同：6
> 
> 时间：2008-10-14T02:53:07.900
> 
> 标签：silverlight, user-controls, silverlight-2-rc0

我刚开始使用 Silverlight (2 RC0)，似乎无法让以下工作。我想创建一个简单的图像按钮用户控件。

我的用户控件的 xaml 如下：

```
 <Button>
        <Button.Template>   
            <ControlTemplate>
                <Image Source="{TemplateBinding ImageSource}" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}" />
            </ControlTemplate>
        </Button.Template>
    </Button> 
```

后面的代码如下：

```
public partial class ImageButtonUserControl : UserControl
    {
        public ImageButtonUserControl()
        {
            InitializeComponent();
        }

        public Image Source
        {
            get { return base.GetValue(SourceProperty) as Image; }
            set { base.SetValue(SourceProperty, value); }
        }
        public static readonly DependencyProperty SourceProperty = 
            DependencyProperty.Register("SourceProperty", typeof(Image), typeof(ImageButtonUserControl),null);
    } 
```

我希望能够动态创建 ImageButtons 并将它们填充到像 WrapPanel 这样的容器中：假设我们已经有一个名为“image”的图像：

```
ImageButtonUserControl imageButton = new ImageButtonUserControl();
imageButton.Source = image;
this.thumbnailStackPanel.Children.Add(imageButton); 
```

我需要做什么才能显示图像？我假设我需要对 DataContext 做一些事情，但我不太确定是什么或在哪里。

谢谢你的帮助

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-14T04:27:21.967

您可以通过模板化一个普通的 Button 轻松获得 ImageButton，因此您根本不需要 UserControl。假设 Button.Content 将是 ImageSource。按钮的 ControlTemplate 将是：

```
 <ControlTemplate x:Key="btn_template">         
   <Image Source="{TemplateBinding Content}" />   
 </ControlTemplate> 
```

并且作为以 URL 集合作为其 ItemsSource 的 ItemsControl 的用法，您可以将 WrapPanel 添加为 ItemPanel。如果您未指定，默认为 StackPanel。

```
<DataTemplate x:Key="dataTemplate">
  <Button Template="{StaticResource btn_template}" Content="{Binding}"/>
</DataTemplate>    

 <ItemsControl ItemsSource="{Binding UrlCollection}" ItemsTemplate="{StaticResource dataTemplate}"/> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T17:58:22.787

我相信这会有所帮助。它对我有用！

[http://www.nikhilk.net/Silverlight-Effects-In-Depth.aspx](http://www.nikhilk.net/Silverlight-Effects-In-Depth.aspx)

取而代之的是 Image，使用 ImageSource。EG typeof(ImageSource) 等。

# java - 在java中处理环境特定配置的最佳方法是什么？

> ID：199869
> 
> 赞同：2
> 
> 时间：2008-10-14T02:54:46.303
> 
> 标签：java, configuration, tomcat

我有一个在 tomcat 中运行的应用程序，它有一堆配置文件，对于它运行的每个环境（开发、测试和生产）都是不同的。但并非配置文件中的每一行在环境之间都会有所不同，因此总是存在重复的信息，如果发生变化，这些信息不会得到更新。

是否有一个好的框架/库可以将单独的文件折叠成一个具有特定环境块的文件？或者其他处理这个问题的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T03:14:56.513

1.  为 .war 文件中分布的属性文件中的所有属性分配合理的默认值。
2.  为 webapp 上下文中的适当属性分配特定于环境的值（例如 conf/server.xml 或 conf/Catalina/localhost/yourapp.xml）
3.  让您的应用程序首先检查上下文（针对特定于环境的值），如果未找到覆盖，则回退到应用程序属性值中的默认值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T02:59:33.423

属性文件是我一直使用的。它可以手动编辑，也可以在您的软件中编辑，Properties 对象可以读取自身并将自身写入文件系统。这是javadoc页面：

[http://java.sun.com/j2se/1.4.2/docs/api/java/util/Properties.html](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Properties.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T03:43:12.570

如果您使用 maven，您可以使用它的资源过滤功能以及配置文件为您要部署到的每个环境生成一个属性文件。

作为额外的奖励，maven 还可以为您部署您的网络应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T03:04:33.337

重复并不是真正的问题，从长远来看，拥有一个中央配置文件而其他文件“扩展”可能会引起更多的麻烦。

我的建议是使用 ant 将适当的文件加载（复制和移动）到位，然后启动应用程序（捆绑到战争中？）。只是对每个环境有不同的任务。因此，您将拥有三个配置文件（dev.config、test.config 和 production.config），它们将被移动并覆盖 /WEB-INF 文件夹中的配置，具体取决于您正在运行的任务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T11:25:42.107

如果您想避免混乱，我建议单独为环境参数设置一个单独的配置文件。然后你将有一个更多的配置文件来管理。这是配置文件的数量与每个配置文件的复杂性之间的权衡。

# .net - 用于在页面内创建 div 样式窗口的 JavaScript 库

> ID：199872
> 
> 赞同：4
> 
> 时间：2008-10-14T02:56:01.823
> 
> 标签：.net, javascript, dhtml

我试图找到一个好的 JavaScript 库，它可以在我网站的页面中创建一个漂亮的“内部窗口”弹出窗口。

我不想担心屏幕定位（即不必计算窗口的大小是否会在屏幕外等...），而只需制作一个包含内容的新弹出窗口。

我将使用 .NET 3.5 ASP.NET（可能是 MVC，还没有开始），我知道 JQuery 有很好的支持，但据我所见，它没有这种类型的小部件功能。

请注意，我不想以任何方式、形状或形式使用“框架”！而是浮动 div 样式方法（或类似方法）。

多谢！标记

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T03:04:01.263

**浮动容器、面板和对话框：**

对于对话框和窗口，也许[**YUI 模块**](http://developer.yahoo.com/yui/container/module/)是一个**很好的解决方案**。

**模态框**

如果您**不是 javascript 程序员**，并且您对更精细的模态框感兴趣，可以使用 jQuery**插件** [**提供**](http://leandrovieira.com/projects/jquery/lightbox/)模[**态灯箱效果**](http://jquery.com/demo/thickbox/)。

**旁注：**有许多库提供这种功能，但如果盒子本身是您需要的唯一部件，请注意**某些库将包含许多您不使用的东西**。如果你小心地只使用你需要的包，你可以让你的页面保持美观和精简。

**旁注：**如果您相当精通 javascript，或者希望变得如此，请记住您始终可以*编写自己的*. javascript 世界中的人们直接转向库是很常见的。库是现代 javascript 领域的重要组成部分，但有时它们会成为开发人员的拐杖。自己写一些前端文章是深入前端开发的好方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T02:58:39.073

我用过一个叫[iBox](http://www.ibegin.com/labs/ibox/)的，效果很好。

如果您已经在使用 jQuery，那么您可能想要查看这[两个](http://leandrovieira.com/projects/jquery/lightbox/) [选项](http://jquery.com/demo/thickbox/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T05:08:54.083

你看过 JQuery 的 Dialog 小部件吗？

[http://docs.jquery.com/UI/Dialog](http://docs.jquery.com/UI/Dialog)

演示在底部。不要担心丑陋的（恕我直言）颜色，它们可以很容易地设计。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T03:07:03.080

到目前为止感谢您的帮助，我刚刚看了一下灯箱，虽然非常好，但我希望有一个非页面阻塞库，这些似乎（乍一看）都是灰色的这个页面，我希望少一些，而更多的是一个基于内联内容的窗口，它不会阻塞页面的其余部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T05:13:06.930

检查[Control.Window](http://livepipe.net/control/window)它基于原型。

# c++ - 设置背景颜色 CMDIFrameWnd

> ID：199876
> 
> 赞同：2
> 
> 时间：2008-10-14T03:00:03.127
> 
> 标签：c++, user-interface, mfc, colors

有没有办法在 MFC (2005) 中更改 MDIParent 窗口的背景颜色？

我曾尝试拦截 ON_WM_CTLCOLOR 和 ON_WM_ERASEBKGND 但均无效。OnEraseBkgnd 确实有效，但随后会被标准 WM_CTL 颜色覆盖。

干杯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T11:25:45.383

创建一个派生 CWnd 的类（例如 CClientWnd）

在您的 CWnd 派生类句柄中

```
afx_msg BOOL OnEraseBkgnd(CDC* pDC);
afx_msg void OnPaint(void);
afx_msg void OnSize(UINT nType, int cx, int cy); 
```

您需要以下消息映射条目：

```
ON_WM_ERASEBKGND()
ON_WM_PAINT()
ON_WM_SIZE() 
```

在 OnEraseBkgnd 中只返回 TRUE，您将在 OnPaint 中完成所有工作

在 OnPaint 中，随心所欲。要填充颜色，您可以这样做

```
CBrush brush;
brush.CreateSolidBrush(COLORREF(RGB( 80, 160, 240 )));

CRect clientRect;
GetClientRect(clientRect);

CPaintDC dc(this);
dc.FillRect(clientRect, &brush); 
```

在 OnSize 中，调用基类，然后使 invalidate 强制重绘：

```
CWnd::OnSize(nType, cx, cy);
Invalidate(FALSE); 
```

* * *

在您的大型机中，声明一个成员 CClientWnd（例如 m_clientWnd）

在你的大型机的 OnCreate 中，首先调用超类，然后

```
m_clientWnd.SubclassWindow(m_hWndMDIClient); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T05:51:08.617

CMDIFrameWnd 实际上被另一个称为 MDIClient 窗口的窗口所覆盖。这是一篇关于如何子类化此 MDIClient 窗口并更改背景颜色的 Microsoft 文章。我自己试过了，效果很好。

[http://support.microsoft.com/kb/129471](http://support.microsoft.com/kb/129471)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-18T06:38:51.700

至少在 VS2008 中似乎有一个简单的解决方案：

在

CMainFrame::OnPaint()

{

..

// 获取背景窗口的dc

CWnd* pWnd = CWnd::FromHandle(m_hWndMDIClient) ;

CPaintDC dc1(pWnd) ;

//然后在这个DC中绘制或bitblt

}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T03:22:16.733

只是在这里猜测，但尝试处理 ON_WM_PAINT。

# javascript - 如何确保 DOM 元素在包含 Flash 对象时触发鼠标悬停

> ID：199879
> 
> 赞同：2
> 
> 时间：2008-10-14T03:02:20.890
> 
> 标签：javascript, css, dom, flash, dom-events

我有一个包含几个子元素的 div，其中一个是 Flash 电影。

滚动此 div 时，我希望它更改样式以指示它已滚动。我的问题是`mouseover`and`mouseout`事件并不总是触发，尤其是当用户将鼠标移动到 flash 元素上过快时。

关于如何确保`mouseover`始终触发事件的任何建议。

我无法将事件添加到 Flash 电影本身，因为它是我没有源代码的专有代码。

此外，我无法在 div/图像中覆盖 Flash 电影，因为我需要在 Flash 本身内发生翻转和单击事件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T21:26:37.303

将 object/embed 标签的***wmode***参数更改为***opaque***。

您的代码应如下所示。

```
<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia
.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0" width="800" height="600">
    <param name="movie" value="movie.swf">
    <param name="wmode" value="opaque">
    <embed src="movie.swf" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="800" height="600"></embed>
</object> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T04:34:40.970

你可以做的是用一个不可见的 div 覆盖 flash 元素。将您的 onmouseover 处理程序放在该 div 上，并在处理程序中添加一行以隐藏覆盖 div。同时，`onmouseover`向窗口添加一个函数 - 当鼠标离开 flash 元素时应该会触发该函数。（我希望）。

1.  有一个`<div>`覆盖你的闪光灯。
2.  当用户将鼠标悬停在它上面时：
    1.  它调用它需要执行的任何函数。
    2.  它隐藏自己，允许与 SWF 进行正常交互。
    3.  它在窗口上放置了一个鼠标悬停功能，它将：
        1.  再次显示原件`div`。
        2.  调用你的“mouseout”函数。
        3.  删除该`window.onmouseover`功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T07:28:05.707

简单的答案是，鉴于您的限制，您不能。

您似乎已经知道的复杂答案。Flash 影片在不触发常规 DOM 事件的沙箱中运行。如果你想在flash中触发鼠标事件，你不能用DOM元素来掩盖它。如果你无法访问 Flash 电影的源代码，你就无法建立通往 JS 世界的“桥梁”。

我认为你没有双赢的局面。

# sql - 转义 ' 在 Access SQL 中

> ID：199889
> 
> 赞同：24
> 
> 时间：2008-10-14T03:08:20.613
> 
> 标签：sql, vba, ms-access, escaping

我正在尝试使用以下内容在 vba 中进行域查找：

```
DLookup("island", "villages", "village = '" & txtVillage & "'") 
```

这工作正常，直到 txtVillage 类似于狄龙湾，当撇号被视为单引号时，我得到一个运行时错误。

我写了一个简单的函数来转义单引号 - 它用“''”替换“'”。这似乎是经常出现的事情，但我找不到任何对具有相同功能的内置函数的引用。我错过了什么吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-14T03:21:28.327

“替换”功能应该可以解决问题。根据您上面的代码：

```
DLookup("island", "villages", "village = '" & Replace(txtVillage, "'", "''") & "'") 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T03:14:18.760

它比你想象的还要糟糕。想想如果有人输入这样的值会发生什么，而你没有逃脱任何东西：

```
'); DROP TABLE [YourTable] 
```

不漂亮。

没有内置函数来简单地转义撇号的原因是因为处理这个问题的正确方法是使用查询参数。对于 Ole/Access 样式查询，您可以将其设置为查询字符串：

```
DLookup("island", "village", "village = ? ") 
```

然后单独设置参数。不过，我不知道您如何从 vba 设置参数值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-14T08:04:09.003

尽管 DLookup 等速记域函数很诱人，但它们也有其缺点。等效的 Jet SQL 类似于

```
SELECT FIRST(island)
FROM villages
WHERE village = ?; 
```

如果您有多个匹配的候选者，它将选择“第一个”，“第一个”的定义取决于 Jet/ACE 引擎 IIRC 的实现（SQL 引擎）并且未定义。你知道哪个会是第一个吗？如果您不这样做，请避开 DLookup :)

[出于兴趣，Jet/ACE 的答案将是基于上次压缩数据库文件时的聚集索引的最小值，或者如果数据库从未压缩过，则为第一个（有效时间）插入值。聚集索引反过来由 PRIAMRY KEY 确定，否则为在 NOT NULL 列上定义的唯一约束或索引，否则是第一个（有效时间）插入的行。如果在 NOT NULL 列上定义了多个 UNIQUE 约束或索引，哪一个将用于集群？我不知道！我相信你明白“第一”并不容易确定，即使你知道如何确定！]

我还看到了微软的建议，从优化的角度避免使用域聚合函数：

有关 Access 数据库中查询性能的信息 [http://support.microsoft.com/kb/209126](http://support.microsoft.com/kb/209126)

“避免使用域聚合函数，例如 DLookup 函数……Jet 数据库引擎无法优化使用域聚合函数的查询”

如果您选择使用查询重写，则可以利用 PARAMETERS 语法，或者您可能更喜欢 Jet 4.0/ACE PROCEDURE 语法，例如

```
CREATE PROCEDURE GetUniqueIslandName
(
   :village_name VARCHAR(60)
)
AS 
SELECT V1.island_name
  FROM Villages AS V1
 WHERE V1.village_name = :village_name
       AND EXISTS 
       (
        SELECT V2.village_name
          FROM Villages AS V2
         WHERE V2.village_name = V1.village_name
         GROUP 
            BY V2.village_name
        HAVING COUNT(*) = 1
       ); 
```

这样，您可以根据需要使用引擎自己的功能（或至少是其数据提供者的功能）来转义所有字符（不仅仅是双引号和单引号）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T03:22:15.360

我相信访问可以使用 Chr$(34) 并且很高兴在里面有单引号/撇号。
例如

```
DLookup("island", "villages", "village = " & chr$(34) & nonEscapedString & chr$(34)) 
```

虽然那时你必须逃避 chr$(34) (")

您可以使用替换功能。

```
Dim escapedString as String

escapedString = Replace(nonescapedString, "'", "''") 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-04T09:12:01.327

Joel Coehoorn 建议的参数化查询是可行的方法，而不是在查询字符串中进行连接。首先 - 避免某些安全风险，其次 - 我有理由确定它需要逃到引擎自己的手中，你不必担心。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-06-18T13:58:27.377

但是，它应该是这样的（每个多一个双引号）：

```
sSQL = "SELECT * FROM tblTranslation WHERE fldEnglish=""" & myString & """;" 
```

或者我更喜欢什么：

制作一个函数来转义单引号，因为用“[]”“转义”将不允许您的字符串中出现这些字符......

```
Public Function fncSQLStr(varStr As Variant) As String

If IsNull(varStr) Then
        fncSQLStr = ""
    Else
        fncSQLStr = Replace(Trim(varStr), "'", "''")
    End If

End Function 
```

我将这个函数用于我的所有 SQL 查询，例如 SELECT、INSERT 和 UPDATE（以及 WHERE 子句中......）

```
strSQL = "INSERT INTO tbl" & 
    " (fld1, fld2)" & _
    " VALUES ('" & fncSQLStr(str1) & "', '" & fncSQLStr(Me.tfFld2.Value) & "');" 
```

或者

```
strSQL = "UPDATE tbl" & _
    " SET fld1='" & fncSQLStr(str1) & "', fld2='" & fncSQLStr(Me.tfFld2.Value) & "'" & _
    " WHERE fld3='" & fncSQLStr(str3) & "';" 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-14T03:16:13.453

顺便说一下，这是我的 EscapeQuotes 函数

```
Public Function EscapeQuotes(s As String) As String

    If s = "" Then
        EscapeQuotes = ""
    ElseIf Left(s, 1) = "'" Then
        EscapeQuotes = "''" & EscapeQuotes(Mid(s, 2))
    Else
        EscapeQuotes = Left(s, 1) & EscapeQuotes(Mid(s, 2))
    End If

End Function 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-25T02:28:01.757

对于单引号和替换功能有问题的人，这行可能会节省你的时间^o^

```
Replace(result, "'", "''", , , vbBinaryCompare) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-04T21:15:44.410

在可能带有撇号的标准周围加上括号。

就像是：

```
DLookup("island", "villages", "village = '[" & txtVillage & "]'") 
```

它们可能需要在单引号之外或在 txtVillage 周围，例如：

```
DLookup("island", "villages", "village = '" & [txtVillage] & "'") 
```

但是，如果您找到正确的组合，它将处理撇号。

基思乙

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2013-06-14T18:26:05.900

我的解决方案要简单得多。最初，我使用这个 SQL 表达式来创建 ADO 记录集：

```
Dim sSQL as String
sSQL="SELECT * FROM tblTranslation WHERE fldEnglish='" & myString & "';" 
```

当`myString`其中有一个撇号时，比如 Int'l Electrics，我的程序就会停止。使用双引号解决了这个问题。

```
sSQL="SELECT * FROM tblTranslation WHERE fldEnglish="" & myString & "";" 
```

# oop - 我从未遇到过编写良好的业务层。有什么建议吗？

> ID：199890
> 
> 赞同：12
> 
> 时间：2008-10-14T03:08:40.253
> 
> 标签：oop, n-tier-architecture, business-logic-layer

我环顾四周，看到了一些很棒的代码片段，用于定义规则、验证、业务对象（实体）等，但我不得不承认，我从未见过完整的优秀且编写良好的业务层。

我只知道我不喜欢什么，但不知道什么是伟大的。

谁能指出一些好的 OO 业务层（或出色的业务对象），或者让我知道他们如何判断业务层以及是什么让一个业务层变得出色？

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-14T03:19:11.403

> 我从未遇到过编写良好的业务层。

以下是[Alex Papadimoulis 对此的看法](http://thedailywtf.com/Articles/The-Mythical-Business-Layer.aspx)：

> *[...] 如果您考虑一下，软件应用程序中的几乎每一行代码都是业务逻辑：*
> 
> *   *客户数据库表及其 CustomerNumber (CHAR-13)、ApprovedDate (DATETIME) 和 SalesRepName (VARCHAR-35) 列：业务逻辑。如果不是，它只是 Table032 与 Column01、Column02 和 Column03。*
> *   *将 10% 折扣扩展到新客户的子程序：绝对是业务逻辑。希望不是软编码。*
> *   *以及以红色突出显示逾期发票的代码：这也是业务逻辑。Internet Explorer 肯定不会寻找字符串“unpaid”和“30+ days”，然后去，嘿，如果有 #990000 背景，那肯定会很好看！*
> 
> *那么如何将所有这些业务逻辑封装在单层代码中呢？当然是糟糕的架构和糟糕的代码！*
> 
> *[...] 通过暗示系统架构应该包括一个专门用于业务逻辑的层，许多开发人员采用了各种非常聪明的技术来实现该目标。它总是以灾难告终。*

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-14T03:13:43.007

我想这是因为一般来说，业务逻辑是任意且令人讨厌的。垃圾进垃圾出。

此外，大多数真正优秀的业务层很可能是专有的。;-)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T06:51:59.647

良好的业务层是经过彻底的领域分析设计的。如果您可以捕获业务的语义并将其与任何类型的实现隔离，无论是在数据存储中还是在任何特定应用程序（包括表示）中，那么逻辑应该在不同的上下文中进行良好的分解和可重用。

就像一个好的数据库模式设计应该捕获业务语义并将自己与任何应用程序隔离一样，业务层也应该这样做，即使数据库模式和业务层描述相同的实体和概念，两者也应该可以在不同的上下文中使用--即使业务逻辑发生变化，数据库架构也不必更改，除非架构不反映当前业务。业务层应该与任何存储模式一起工作，只要它是通过中间层抽象出来的。例如，ADO.NET 实体框架允许您设计一个映射到业务层的*概念*架构，并具有到存储架构的单独映射，无需重新编译业务对象层或概念层即可更改该映射。

如果业务方面的人可以查看用业务层编写的代码并大致了解正在发生的事情，那么这可能很好地表明对象设计正确——你已经成功地传达了一个解决方案问题域而不用来自解决方案域的工件来混淆它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-01-04T17:31:52.290

我总是被困在一块石头和一个坚硬的地方之间。理想情况下，您的业务逻辑根本不关心数据库或 UI 相关问题。

**键引起问题** 尽管如此，我发现诸如主键和外键之类的东西会引起问题。即使是像 Entity Framework 这样的工具也不能完全消除这种蠕变。将作为 POST 数据传递的 ID 转换为它们各自的对象，仅将其传递给业务层，然后再将它们传递给数据层以再次被剥离，这是非常低效的。

甚至 NoSQL 数据库也存在问题。它们倾向于返回完整的对象模型，但它们通常返回的比您需要的多，并且可能导致问题，因为您假设对象模型不会改变。在 NoSQL 数据库中仍然可以找到密钥。

**重用与开销** 还有代码重用的问题。数据层返回完全填充的对象是很常见的，包括该特定表中的每一列。但是，业务逻辑通常只关心此信息的有限子集。它适用于仅携带相关数据的专用数据传输对象。当然，您需要在表示之间进行转换，因此您创建了一个映射器类。然后，当您保存时，您需要以某种方式将这些较小的对象转换回完整的数据库表示或执行部分更新（意味着另一个 SQL 命令）。

所以，我看到很多业务层类接受直接映射到数据库表（数据传输对象）的对象。我还看到很多业务层也接受原始 UI 值（表示对象）。业务层在计算过程中调用数据库以检索所需数据的情况也很常见。尝试预先获取它可能效率低下（想想 if 语句如何影响检索到的数据），并且延迟加载的值会导致对数据库的大量魔术或意外调用。

**先写逻辑** 最近，我一直在尝试先写“核心”代码。这是执行实际业务逻辑的代码。我不了解你，但很多时候在查看别人的代码时，我会问这样一个问题，“但是，它在哪里做 [业务规则]？” 通常，业务逻辑充满了对抓取数据、转换数据等问题的关注，以至于我什至看不到它（大海捞针）。所以，现在我首先实现逻辑，当我弄清楚我需要什么数据时，我将其添加为参数或将其添加到参数对象。让其余代码适应这个新接口通常落在某种中介类上。

不过，就像我说的那样，在编写业务层时，你必须牢记很多，包括性能。上面的方法最近很有用，因为我还没有版本控制或数据库模式的权限。我在一个黑暗的房间里工作，到目前为止我只了解需求。

**编写时考虑到测试** 利用依赖注入对于预先设计好的架构很有用。尝试考虑如何在不访问数据库或其他服务的情况下测试代码。这也适用于可以在多个上下文中运行的小型、可重用的类。

**结论** 我的结论是，确实不存在完美的业务层。即使在同一个应用程序中，有时一种方法也只能在 90% 的时间内起作用。我们能做的最好的事情就是尝试编写最简单的东西。在很长一段时间内，我都避免使用 DTO 并使用对象包装 ADO.NET DataRows，因此更新会立即记录在底层 DataTable 中。这是一个巨大的错误，因为我无法复制对象，并且约束导致在奇怪的时间抛出异常。我这样做只是为了避免显式设置参数值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-14T03:11:09.593

Martin Fowler 已经在博客中广泛介绍了 DSL。我建议从那里开始。

[http://martinfowler.com/bliki/dsl.html](http://martinfowler.com/bliki/dsl.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-14T06:29:11.503

[学习和使用CSLA.Net](http://www.lhotka.net/)对我很有帮助（如果你是一名 MS 专家）。我从未实现过“纯”CSLA 应用程序，但使用了架构中提出的许多想法。

您最好的选择是继续寻找难以捉摸的灵丹妙药，并使用最适合您正在解决的问题的想法。把事情简单化。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-15T03:25:47.113

我发现的一个问题是，即使您有一个设计良好的业务层，也很难阻止业务逻辑泄漏，而开发工具往往会鼓励这种情况。例如，一旦您将验证器控件添加到 ASP.NET WebForm，您就会让业务逻辑泄漏到视图中。验证应该发生在业务层中，并且只有它的结果显示在视图中。一旦您向数据库添加约束，您的数据库中也会有业务逻辑。不过，DBA 类型往往强烈反对最后一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T03:15:21.863

我也没有。我们不会在应用程序中创建业务层。相反，我们使用[MVC-ARS](https://stackoverflow.com/questions/140098/is-mvc-ars-preferable-to-classic-mvc-to-prevent-overloading)。业务逻辑嵌入在 (S) 状态机和 (A) 动作中。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-14T03:39:33.513

可能是因为在现实中我们永远无法将业务逻辑与“流程”、输入、输出、接口完全解耦，最终人们发现很难处理抽象，更不用说将其与现实联系起来了。

# nhibernate - 如何告诉 NHibernate 总是强制引用标识符？

> ID：199896
> 
> 赞同：5
> 
> 时间：2008-10-14T03:13:05.457
> 
> 标签：nhibernate

如标题：我将如何一劳永逸地告诉 NHibernate，所有表名和列名都将在它生成的 SQL 中被引用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-06-14T05:44:31.553

你也可以试试：

```
SchemaMetadataUpdater.QuoteTableAndColumns(configuration); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-05-21T14:44:33.397

您需要添加

```
<property name="hbm2ddl.keywords">auto-quote</property> 
```

到您的 NHibernate 配置。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-14T06:47:52.993

我没有尝试过，但据我所知，可以根据[文档](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/session-configuration.html#configuration-namingstrategy)确定命名策略的自定义实现允许您重写表/列名称，因此也可以引用它们。

# .net - 打开标准 CollectionEditor 中的描述面板

> ID：199897
> 
> 赞同：4
> 
> 时间：2008-10-14T03:13:33.520
> 
> 标签：.net, visual-studio, designer

我有一个具有`List<T>`属性的组件。列表中的类的每个属性都装饰有描述属性，但描述不会显示在集合编辑器中

在 IDE 设计器中，有没有办法在标准集合编辑器中打开“描述”面板？我需要从 CollectionEditor 继承我自己的类型编辑器来实现这一点吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-14T07:22:34.283

基本上，您要么需要创建自己的编辑器，要么需要创建子类`CollectionEditor`并弄乱表单。后者更容易 - 但不一定漂亮......

以下使用常规集合编辑器表单，但只是简单地扫描它以查找`PropertyGrid`控件，启用`HelpVisible`.

```
/// <summary>
/// Allows the description pane of the PropertyGrid to be shown when editing a collection of items within a PropertyGrid.
/// </summary>
class DescriptiveCollectionEditor : CollectionEditor
{
    public DescriptiveCollectionEditor(Type type) : base(type) { }
    protected override CollectionForm CreateCollectionForm()
    {
        CollectionForm form = base.CreateCollectionForm();
        form.Shown += delegate
        {
            ShowDescription(form);
        };
        return form;
    }
    static void ShowDescription(Control control)
    {
        PropertyGrid grid = control as PropertyGrid;
        if (grid != null) grid.HelpVisible = true;
        foreach (Control child in control.Controls)
        {
            ShowDescription(child);
        }
    }
} 
```

要在使用中显示这个（注意使用`EditorAttribute`）：

```
class Foo {
    public string Name { get; set; }
    public Foo() { Bars = new List<Bar>(); }
    [Editor(typeof(DescriptiveCollectionEditor), typeof(UITypeEditor))]
    public List<Bar> Bars { get; private set; }
}
class Bar {
    [Description("A b c")]
    public string Abc { get; set; }
    [Description("D e f")]
    public string Def{ get; set; }
}
static class Program {
    [STAThread]
    static void Main() {
        Application.EnableVisualStyles();
        Application.Run(new Form {
            Controls = {
                new PropertyGrid {
                    Dock = DockStyle.Fill,
                    SelectedObject = new Foo()
                }
            }
        });
    }
} 
```

# mysql - MySQL 和评论

> ID：199905
> 
> 赞同：39
> 
> 时间：2008-10-14T03:17:19.083
> 
> 标签：mysql, comments

是否可以在某处以某种方式添加评论？

在使用 MySQL 时，我不会假装自己是任何专家，当然也不会整天花在它上面。我经常忘记我打算如何使用列（通常是位列），如果我可以添加评论以提醒我 1 是好还是坏，我会非常兴奋。

如果它只出现在“显示创建表格”之类的内容中，我会很高兴，但表格结构中的任何模糊位置都会比我桌子上当前的便利贴更好、更容易找到。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-14T03:23:28.587

[http://dev.mysql.com/doc/refman/5.0/en/create-table.html](http://dev.mysql.com/doc/refman/5.0/en/create-table.html)

```
table_option:
    {ENGINE|TYPE} [=] engine_name
  | AUTO_INCREMENT [=] value
  | AVG_ROW_LENGTH [=] value
  | [DEFAULT] CHARACTER SET [=] charset_name
  | CHECKSUM [=] {0 | 1}
  | [DEFAULT] COLLATE [=] collation_name
  | COMMENT [=] 'string' 
```

* * *

例子：

```
CREATE TABLE foo (
  id int(10) NOT NULL auto_increment COMMENT 'unique ID for each foo entry',
  bar varchar(255) default NULL COMMENT 'the bar of the foo',
  ....
) TYPE=MyISAM; 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-10-14T04:43:46.083

您可以评论列和表：

```
CREATE TABLE example (
  example_column INT COMMENT="This is an example column",
  another_column VARCHAR COMMENT="One more column"
) TYPE=MYISAM COMMENT="This is a comment about table"; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-14T03:24:11.080

MySQL 支持对将显示在 show create 上的表和列的注释：

```
create table example (field1 char(3) comment 'first field') comment='example table' 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-01-16T03:40:24.787

这是一个老歌，关于如何更新列评论或创建带有评论的表格有很多回应。但是关于如何查看评论的给出的答案相当糟糕

*   没有人证实是的，评论出现在[SHOW TABLES](http://dev.mysql.com/doc/refman/5.0/en/show-tables.html)中（正如最初的问题所考虑的那样）
*   Edward Yang 建议使用[INFORMATION_SCHEMA COLUMNS](http://dev.mysql.com/doc/refman/5.1/en/columns-table.html)表

查看评论的最简单方法是使用带有 FULL 关键字的[SHOW COLUMNS ：](http://dev.mysql.com/doc/refman/5.0/en/show-columns.html)
`SHOW FULL COLUMNS FROM mytable`

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-05-27T14:09:08.887

如果您想在表格中发表评论（在 phpmyadmin 中），请按照以下步骤操作

1.  打开 localhost/phpmyadmin
2.  转到您的数据库并选择表
3.  现在从顶部选择操作菜单。
4.  并转到表格选项和编辑表格注释。 [![在此处输入图像描述](https://i.stack.imgur.com/gaqmE.jpg)](https://i.stack.imgur.com/gaqmE.jpg)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-01-20T20:41:41.883

只有在删除等号后，最高投票的答案才对我有用。我的工作示例是

```
CREATE TABLE `example` (
`id` int(11) NOT NULL,
`two` varchar(255) COMMENT "comment text",
PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-14T03:19:05.990

您确定您不想使用 ENUM 列吗？好的 MySQL 表应该是自记录的。

另一种方法是注释具有用于定义表的 SQL 的模式文件（我假设你有这些，并且你没有使用 PHPMyAdmin 来动态增长表模式......）

但是，如果您坚持，[INFORMATION_SCHEMA COLUMNS](http://dev.mysql.com/doc/refman/5.1/en/columns-table.html)表，特别是 COLUMN_COMMENT 列，可能就是您要查找的内容。虽然它是专有的 MySQL 语法，所以我倾向于避免它（尽管数据库互操作性的想法真的是个笑话）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T12:09:48.273

如果您使用 MySQL Administrator 工具来管理/编辑您的数据库，那么每当您使用表编辑器时，每列的注释都会自动显示/可编辑。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-12-17T08:16:55.677

经测试。这行得通。

```
CREATE TABLE `table_with_comment` (
  `id` int(11) NOT NULL,
  `column_a` varchar(255) DEFAULT NULL COMMENT 'comment comlumn text',
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COMMENT='This is a table comment'; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-22T11:28:35.873

如果您到这里寻找 DATABASE/SCHEMA 中的评论，MySQL 不支持它，但 MariaDB 中支持它：

[https://mariadb.com/kb/en/create-database/](https://mariadb.com/kb/en/create-database/)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-06-18T03:17:46.063

我刚刚为此编写了一个应用程序。

可以在这里找到： [https ://github.com/SplicePHP/mysql-comments](https://github.com/SplicePHP/mysql-comments)

允许您在单个视图中更新多个数据库表和列。

链接中的说明。

# c# - 保护商业 .NET 软件不被随意复制的更好方法是什么？

> ID：199909
> 
> 赞同：1
> 
> 时间：2008-10-14T03:19:09.610
> 
> 标签：c#, .net

该软件包的主要重点是开发人员工具，但还有一个组件（DLL），少数开发人员希望使用他们自己的应用程序重新分发。这是在 .NET 3.5 下运行的托管代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T03:40:25.370

阻止其他人重用您的库的最简单方法是将所有类标记为“内部”并使用[InternalsVisibleTo 自定义属性](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)标记库程序集。这使您可以专门枚举哪些程序集（在您的情况下是每个开发人员工具）可以调用内部方法。所有其他程序集（例如客户可能编写的程序集）将被拒绝访问。

如果客户足够坚定，他们可以使用其他技术，如反射或逆向工程 IL 来重用您的库。但是这种技术会阻止他们直接使用您的库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T03:53:29.680

混淆和许可是保护程序集的“标准”方法

就像任何锁一样，有人可以弄清楚如何解锁它，问题是您想让他们这样做有多困难与您想在此过程中花费多少精力/金钱

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T03:29:57.230

将序列号键入注册人的详细信息（例如电子邮件）相当简单。这样他就知道你有机会从他的背上找到任何副本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T04:15:47.840

您可以查看名为 Oreans WinLicense 的产品。它应该是强大的。

谢谢。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T06:11:41.820

我对此进行了一些搜索，看来您有很多商业工具。喜欢：[eziriz](http://www.eziriz.com/?gclid=CJvC19KGppYCFQuHlAod0E3k6g)

我想知道是否有任何好的开源解决方案？

# f# - Explaining pattern matching vs switch

> ID：199918
> 
> 赞同：68
> 
> 时间：2008-10-14T03:22:37.200
> 
> 标签：f#, pattern-matching, ocaml, sml

I have been trying to explain the difference between switch statements and pattern matching(F#) to a couple of people but I haven't really been able to explain it well..most of the time they just look at me and say "so why don't you just use if..then..else".

How would you explain it to them?

EDIT! Thanks everyone for the great answers, I really wish I could mark multiple right answers.

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-14T04:15:07.017

Having formerly been one of "those people", I don't know that there's a succinct way to sum up why pattern-matching is such tasty goodness. It's experiential.

Back when I had just glanced at pattern-matching and thought it was a glorified switch statement, I think that I didn't have experience programming with algebraic data types (tuples and discriminated unions) and didn't quite see that pattern matching was both a control construct *and* a binding construct. Now that I've been programming with F#, I finally "get it". Pattern-matching's coolness is due to a confluence of features found in functional programming languages, and so it's non-trivial for the outsider-looking-in to appreciate.

I tried to sum up one aspect of why pattern-matching is useful in the second of a short two-part blog series on language and API design; check out [part one](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!180.entry) and [part two](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!181.entry).

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-14T07:39:46.167

Patterns give you a small language to describe the structure of the values you want to match. The structure can be arbitrarily deep and you can bind variables to parts of the structured value.

This allows you to write things extremely succinctly. You can illustrate this with a small example, such as a derivative function for a simple type of mathematical expressions:

```
type expr =
    | Int of int
    | Var of string
    | Add of expr * expr
    | Mul of expr * expr;;

let rec d(f, x) =
    match f with
    | Var y when x=y -> Int 1
    | Int _ | Var _ -> Int 0
    | Add(f, g) -> Add(d(f, x), d(g, x))
    | Mul(f, g) -> Add(Mul(f, d(g, x)), Mul(g, d(f, x)));; 
```

Additionally, because pattern matching is a static construct for static types, the compiler can (i) verify that you covered all cases (ii) detect redundant branches that can never match any value (iii) provide a very efficient implementation (with jumps etc.).

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-19T03:35:22.783

Excerpt from [this blog article](http://fsharpnews.blogspot.com/2009/08/advantages-of-pattern-matching.html):

Pattern matching has several advantages over switch statements and method dispatch:

*   Pattern matches can act upon ints, floats, strings and other types as well as objects.
*   Pattern matches can act upon several different values simultaneously: parallel pattern matching. Method dispatch and switch are limited to a single value, e.g. "this".
*   Patterns can be nested, allowing dispatch over trees of arbitrary depth. Method dispatch and switch are limited to the non-nested case.
*   Or-patterns allow subpatterns to be shared. Method dispatch only allows sharing when methods are from classes that happen to share a base class. Otherwise you must manually factor out the commonality into a separate function (giving it a name) and then manually insert calls from all appropriate places to your unnecessary function.
*   Pattern matching provides redundancy checking which catches errors.
*   Nested and/or parallel pattern matches are optimized for you by the F# compiler. The OO equivalent must be written by hand and constantly reoptimized by hand during development, which is prohibitively tedious and error prone so production-quality OO code tends to be extremely slow in comparison.
*   Active patterns allow you to inject custom dispatch semantics.

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-14T06:44:13.750

Off the top of my head:

1.  The compiler can tell if you haven't covered all possibilities in your matches
2.  You can use a match as an assignment
3.  If you have a discriminated union, each match can have a different 'type'

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-14T22:23:31.577

Switch is the two front wheels.

Pattern-matching is the entire car.

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-01-05T15:56:43.003

Tuples have "," and Variants have Ctor args .. these are constructors, they create things.

Patterns are destructors, they rip them apart.

They're dual concepts.

To put this more forcefully: the notion of a tuple or variant cannot be described merely by its constructor: the destructor is required or the value you made is useless. It is these dual descriptions which define a value.

Generally we think of constructors as data, and destructors as control flow. Variant destructors are alternate branches (one of many), tuple destructors are parallel threads (all of many).

The parallelism is evident in operations like

```
(f * g) . (h * k) = (f . h * g . k) 
```

if you think of control flowing through a function, tuples provide a way to split up a calculation into parallel threads of control.

Looked at this way, expressions are ways to compose tuples and variants to make complicated data structures (think of an AST).

And pattern matches are ways to compose the destructors (again, think of an AST).

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-08T14:54:02.017

Pattern matches in OCaml, in addition to being more expressive as mentioned in several ways that have been described above, also give some very important static guarantees. The compiler will prove for you that the case-analysis embodied by your pattern-match statement is:

*   exhaustive (no cases are missed)
*   non-redundant (no cases that can never be hit because they are pre-empted by a previous case)
*   sound (no patterns that are impossible given the datatype in question)

This is a really big deal. It's helpful when you're writing the program for the first time, and enormously useful when your program is evolving. Used properly, match-statements make it easier to change the types in your code reliably, because the type system points you at the broken match statements, which are a decent indicator of where you have code that needs to be fixed.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-04-11T11:16:16.267

If-Else (or switch) statements are about choosing different ways to process a value (input) depending on *properties* of the value at hand.

Pattern matching is about defining how to process a value given its *structure*, (also note that single case pattern matches make sense).

Thus pattern matching is more about deconstructing values than making choices, this makes them a very convenient mechanism for defining (recursive) functions on inductive structures (recursive union types), which explains why they are so abundantly used in languages like Ocaml etc.

PS: You might know the pattern-match and If-Else "patterns" from their ad-hoc use in math;

"if x has property A then y else z" (If-Else)

"some term in p1..pn where .... is the prime decomposition of x.." ((single case) pattern match)

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-10-14T03:41:19.113

Perhaps you could draw an analogy with strings and regular expressions? You describe *what* you are looking for, and let the compiler figure out *how* for itself. It makes your code much simpler and clearer.

As an aside: I find that the most useful thing about pattern matching is that it encourages good habits. I deal with the corner cases *first*, and it's easy to check that I've covered every case.

# .net - 如何确定 SqlConnection 是否被登记到 System.Transactions 的 tx 中？

> ID：199935
> 
> 赞同：6
> 
> 时间：2008-10-14T03:35:07.643
> 
> 标签：.net, ado.net, .net-2.0, transactions, msdtc

默认情况下，当我们使用 System.Transactions 中的事务（为实例创建 TransationScope）时，所有 Sql 连接（System.Data.SqlClient.SqlConnection）（但对于 Oracle.DataAccess.OracleConnection 也不是如此）在打开时被登记. 这称为自动登记。不错的功能。但可以通过连接字符串的参数 (enlist=false) 将其关闭。在这种情况下，将不会征用正在打开的连接。但它可以稍后手动登记。所以我的问题是：对于某些给定的 SqlConnection 实例，我如何确定该连接是否被登记（进入 System.Transaction）。我可以查看参数的连接字符串。但这不会做，因为正如我所说的连接可以手动登记。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-14T04:57:19.753

该框架似乎不允许这样做。

也许我们可以讨论为什么你需要知道这些信息？TransactionScopeOptions 为您提供有关何时创建事务的一些灵活性。

但是，拒绝回答“否”，稍后浏览一点源代码，我创建了这个代码，它确实有效。请注意，此代码可能随时停止运行，并为框架打补丁！！！！

```
 static bool IsEnlisted(SqlConnection sqlConnection)
    {
        object innerConnection = typeof(SqlConnection).GetField("_innerConnection", BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.FlattenHierarchy).GetValue(sqlConnection);
        var enlistedTransactionField =
            EnumerateInheritanceChain(innerConnection.GetType())
            .Select(t => t.GetField("_enlistedTransaction", BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.FlattenHierarchy))
            .Where(fi => fi != null)
            .First();
        object enlistedTransaction = enlistedTransactionField.GetValue(innerConnection);
        return enlistedTransaction != null;
    }

    static IEnumerable<Type> EnumerateInheritanceChain(Type root)
    {
        for (Type current = root; current != null; current = current.BaseType)
            yield return current;
    } 
```

同样，这是利用 .NET 框架中的私有变量和内部类。虽然它今天有效，但明天可能就不行了。

# ruby-on-rails - 使用 ajax 更新行状态

> ID：199936
> 
> 赞同：2
> 
> 时间：2008-10-14T03:35:29.513
> 
> 标签：ruby-on-rails, ajax

我目前正在尝试使用 Rails 编写我的第一个 ajax 接口。

该应用程序当前显示一个填充有列表项的表格。用户必须批准或拒绝每个列表项。我目前在每一行的末尾都有一个编辑链接，其中显示了我可以批准列表项的表单。

我正在考虑使用复选框而不是编辑链接。当用户单击复选框时，我想在不离开此页面的情况下使用状态、用户名和日期/时间更新数据库。

1.  我应该遵循哪些步骤？
2.  我可以使用复选框还是仅限于按钮？
3.  我应该使用什么 xxx_remote 助手？
4.  如何使用 ajax 调用的结果更新复选框状态？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T05:12:22.533

我认为复选框不是您要查找的正确控件。您说您希望用户能够批准或拒绝项目，这意味着您有 3 种状态：未处理、已批准和已拒绝。复选框仅支持 2 种状态：关闭和打开

我会使用两个链接接受和拒绝，然后按如下方式进行。

**在您看来：**

```
...
<tr id="item1">
  <td>Accept or Reject</td>
  <td>
    link_to_remote 'accept', :action => :accept, :id => 1, :method => :post
    link_to_remote 'reject', :action => :reject, :id => 1, :method => :post
  </td>
</tr>
... 
```

**在您的控制器中**

```
def accept
  item = Item.find(params[:id])
  item.accept
  respond_to do |want|
    want.js {
      render :update do |page|
        page << "$('item_#{item.id}').cells[0].innerHTML = 'Accepted'"
        ...include other updates you need to make to your row...
        page.visual_effect :highlight, "item_#{item.id}"
      end
    }
  end
end    
... similar for reject method ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T10:00:35.213

这是对 Andrew 提出的解决方案的评论，

我不得不写`link_to_remote`这样的函数参数

```
link_to_remote 'reject', :url => {:action => :reject, :id => item.id, :method => :post} 
```

另外，如果您使用的是 restful 资源，请记住向您的 routes.rb 添加新操作，即

```
map.resources :items, :member => {:accept => :post, :reject => :post} 
```

# mysql - 你如何在 mysql 中加入同一张表，两次？

> ID：199953
> 
> 赞同：112
> 
> 时间：2008-10-14T03:41:23.730
> 
> 标签：mysql

我有 2 张桌子。一个（域）具有域 id 和域名（dom_id、dom_url）。

另一个包含实际数据，其中 2 列需要 TO 和 FROM 域名。所以我有 2 列 rev_dom_from 和 rev_dom_for，它们都存储域表中的域名 id。

简单的。

现在我需要在网页上实际显示两个域名。我知道如何通过在reviews.rev_dom_for = domain.dom_url 查询上的LEFT JOIN 域来显示一个或另一个，然后你回显出dom_url，这将回显出rev_dom_for 列中的域名。

但是我如何让它在 dom_rev_from 列中回显第二个域名？

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2008-10-14T03:43:44.833

您将使用另一个联接，类似于以下内容：

```
SELECT toD.dom_url AS ToURL, 
    fromD.dom_url AS FromUrl, 
    rvw.*

FROM reviews AS rvw

LEFT JOIN domain AS toD 
    ON toD.Dom_ID = rvw.rev_dom_for

LEFT JOIN domain AS fromD 
    ON fromD.Dom_ID = rvw.rev_dom_from 
```

***编辑****：*

您所做的就是多次加入表格。查看帖子中的查询：它从评论表（别名为 rvw）中选择值，该表为您提供了对域表的 2 个引用（一个 FOR 和一个 FROM）。

此时，将 Domain 表左连接到 Reviews 表是一件简单的事情。一次（别名为 toD）用于 FOR，第二次（别名为 fromD）用于 FROM。

然后在 SELECT 列表中，您将从 DOMAIN 表的两个 LEFT JOINS 中选择 DOM_URL 字段，通过表别名为每个连接到 Domains 表引用它们，并将它们别名为 ToURL 和 FromUrl。

有关 SQL 中别名的更多信息，请阅读[此处](http://www.w3schools.com/SQL/sql_alias.asp)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-14T05:04:09.257

鉴于下表..

```
Domain Table
dom_id | dom_url

Review Table
rev_id | rev_dom_from | rev_dom_for 
```

试试这个 sql...（这与 Stephen Wrighton 上面写的几乎相同）诀窍是您基本上在同一个查询中从域表中选择两次并加入结果。

```
Select d1.dom_url, d2.dom_id from
review r, domain d1, domain d2
where d1.dom_id = r.rev_dom_from
and d2.dom_id = r.rev_dom_for 
```

如果您仍然卡住，请更具体地说明您不明白。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2013-02-09T06:35:02.693

阅读并尝试，这将帮助您：

**表格1**

```
column11,column12,column13,column14 
```

**表2**

```
column21,column22,column23,column24

SELECT table1.column11,table1.column12,table2asnew1.column21,table2asnew2.column21 
FROM table1 INNER JOIN table2 AS table2asnew1 ON table1.column11=table2asnew1.column21  INNER TABLE table2 as table2asnew2 ON table1.column12=table2asnew2.column22 
```

`table2asnew1`是表 2 的一个实例，与`table1.column11=table2asnew1.column21`

和

`table2asnew2`是表 2 的另一个实例，与`table1.column12=table2asnew2.column22`

# c++ - C++ 中 Thread.SetApartmentState 的等价物是什么？

> ID：199959
> 
> 赞同：5
> 
> 时间：2008-10-14T03:48:09.520
> 
> 标签：c++, windows, multithreading, com

在 C#`SetApartmentState`中，类中有一个方法`Thread`。我如何在 C++ 中做同样的事情？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T04:43:51.403

对于非托管进程，您可以通过将适当的参数传递给[`CoInitializeEx()`](http://msdn.microsoft.com/en-us/library/ms695279(VS.85).aspx). 拉里·奥斯特曼（Larry Osterman）为此写了一个*很棒的*小指南：

> ...
> 当线程调用`CoInitializeEx`（或 `CoInitialize`）时，线程告诉 COM 它准备托管两种公寓类型中的哪一种。要指示线程应该存在于 MTA 中，请将`COINIT_MULTITHREADED`标志传递给 `CoInitializeEx`. 要指示线程应该托管 STA，请调用 `CoInitialize`或将 `COINIT_APARTMENTTHREADED`标志传递给 `CoInitializeEx`.
> ...

-- [http://blogs.msdn.com/larryosterman/archive/2004/04/28/122240.aspx](http://blogs.msdn.com/larryosterman/archive/2004/04/28/122240.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T04:02:24.280

c++ 没有内置的线程支持。您要查找的内容取决于您在应用程序中实现线程的方式。赢32？线程？提升::线程？无论您使用哪种 API，都将决定您的问题的答案。

编辑：看起来这可能有一个例子给你：http: [//msdn.microsoft.com/en-us/library/system.threading.apartmentstate.aspx](http://msdn.microsoft.com/en-us/library/system.threading.apartmentstate.aspx)

看起来它适用于托管 C++。

# c# - 获取 Windows 服务的完整路径

> ID：199961
> 
> 赞同：59
> 
> 时间：2008-10-14T03:49:22.713
> 
> 标签：c#, .net, windows-services

如何找到动态安装 Windows 服务 .exe 文件的文件夹？

```
Path.GetFullPath(relativePath); 
```

返回基于`C:\WINDOWS\system32`目录的路径。

但是，该`XmlDocument.Load(string filename)`方法似乎对安装服务 .exe 文件的目录中的相对路径起作用。

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-10-14T03:57:51.667

尝试

```
System.Reflection.Assembly.GetEntryAssembly().Location 
```

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2012-10-29T20:48:57.000

试试这个：

```
AppDomain.CurrentDomain.BaseDirectory 
```

（就像这里：[如何找到 Windows 服务 exe 路径](https://stackoverflow.com/questions/2833959/how-to-find-windows-service-exe-path)）

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2008-11-14T14:54:26.680

```
Path.GetDirectoryName(System.Reflection.Assembly.GetEntryAssembly().Location) 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-14T13:38:32.433

这适用于我们的 Windows 服务：

```
//CommandLine without the first and last two characters
//Path.GetDirectory seems to have some difficulties with these (special chars maybe?)
string cmdLine = Environment.CommandLine.Remove(Environment.CommandLine.Length - 2, 2).Remove(0, 1);
string workDir = Path.GetDirectoryName(cmdLine); 
```

这应该为您提供可执行文件的绝对路径。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-14T14:24:16.583

上面的另一个版本：

```
string path = Assembly.GetExecutingAssembly().Location;
FileInfo fileInfo = new FileInfo(path);
string dir = fileInfo.DirectoryName; 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-06-11T20:57:57.017

Environment.CurrentDirectory 返回程序运行的当前目录。在 Windows 服务的情况下，返回 %WINDIR%/system32 路径，该路径是可执行文件将运行的位置，而不是可执行文件部署的位置。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-10-14T04:06:52.697

这应该为您提供可执行文件所在的路径：

```
Environment.CurrentDirectory; 
```

如果没有，您可以尝试：

```
Directory.GetParent(Assembly.GetEntryAssembly().Location).FullName 
```

一种更hacky但更实用的方式：

```
Path.GetFullPath("a").TrimEnd('a') 
```

:)

# .net - F# - 领域特定语言

> ID：199962
> 
> 赞同：4
> 
> 时间：2008-10-14T03:50:31.823
> 
> 标签：.net, f#

F# 是编程语言的未来吗？是时候学习 F# 了吗？市场上还有其他与 F# 相当的语言吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T04:05:13.930

F# 是一种通用的、面向对象的*函数*式语言，它并没有专门为特定领域的语言设计的任何内容，尽管您可能很容易在 F# 中创建 DSL。

如果您真的对学习 F# 之类的东西感兴趣，那么现在正是时候。如果您想学习一门新语言以增加被录用的机会，那么如果您仍然不熟悉函数式编程，那么 F# 可能不是一个好的选择。您可能想尝试**JavaScript**、**Python**、**Ruby**或**C#**并使用匿名函数。

如果你想坚持使用接近 F# 的东西，**ML**语言家族中的任何东西，尤其是**OCaml**。**Haskell**是一种纯函数式语言，没有副作用（Haskell 的*monads*除外）。还有**Lisp**家族、[Nemerle](http://nemerle.org/Main_Page)和其他几个。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-14T06:21:07.917

我想说现在是个*好*时机，我上周向 fsbugs 发送了一个问题，几个小时内就得到[了这个人](http://blogs.msdn.com/dsyme/)本人的答复。

现在用 c# 试试...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T03:53:28.683

好吧，了解另一种编程语言和另一种看待事物的方式永远不会有什么坏处。

由于目前 F# 不稳定，作为尚未正式发布的语言，可能不是*最好*的时机；但是，我现在仍然会学习它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T04:39:24.033

函数式语言已经存在了很长时间，但缺乏实用的生态系统来使它们与除了非常专业的业务开发人员（例如，一家大型投资银行过去~~可以~~在函数式上投入一些资源）相关。复杂算法的编程）。

微软的努力是不同的，不在于 F# 语言的纯度，而是它作为主要编程平台 (.NET) 的**一等公民的计划首次亮相，以及采用程序员在他/她****添加***时可能会遇到的摩擦可能非常低**它到他/她*****现有的*****基础设施**。*

 *在 .NET 中，已经可以在单个解决方案中从 C# 项目（反之亦然）引用 VB 项目。但由于 C# 或 VB 的中间语言实际上是相同的¹，.NET 程序员今天更喜欢坚持使用一种语言（C# 或 VB）并与那些来自另一个（几乎相同）黑暗面的程序员进行恶作剧.

另一方面，F# 将引入一种截然不同的语言工具。因此，您将能够在您喜欢的 .NET 环境（C# 或 VB）中继续编程，但是当出现不同的功能子项目时，您将能够在 F# 中对该子项目进行编程，同时仍然使用所有现有的 C#/ VB 资产。

至于未来，许多人认为与其说是一刀切的语言，不如说是减少了为手头的子项目/任务选择正确工具的摩擦。

在产品发布方面，微软表示它致力于提供 F# 作为 .NET 家族的一部分，但目前只发布了几个 CTP（还不是 beta 状态），所以我会说没有赶紧放下一切来学习 F#。（当我看到测试版时再问我一次。）

¹ VB 2008 中的 XML 文字可能是 VB 与 C# 最明显的区别。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-14T05:56:40.227

F# 和函数式编程是未来。但是已经存在的大量面向 OO 的语言、过程语言和声明性语言也是如此。在任何意义上，支撑这两者的概念都不是新的。随着强大的运​​行时集成，多语言（多（编程）语言）系统的未来看起来很光明，这可能是改变格局的一个趋势。

是的，这是学习 F# 的绝佳时机，社区规模小而充满活力，平台日趋成熟（不要忘记 F# 始于 2002 年），并且很快将成为 Visual Studio 的一部分。

至于其他语言，如前所述，F# 从 Ocml 大量借用，以至于在两者之间交叉编译代码可能需要一些摆弄。F# 还从 Haskell 借用了序列表达式和工作流 (mondas)。Scala 是同一领域的另一种有趣的语言。函数式构造也正在进入“传统”语言，如 C# 3.0、C++（现在任何一天都可以使用 lambdas..）。Python 有很好的库来编写函数式代码。Linq 和 PLinq 本质上是功能性/减损性的。

Lisp 是整个事情的祖父，而且也很自鸣得意！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-14T05:01:31.040

F# 不是编程语言的未来。事实上，它深深植根于过去。然而，它是一种很好的学习技术，因为它很可能代表了一种与您可能习惯的编程思维方式完全不同的方式。

此外，与动态类型一起，函数式编程是计划在下一版本的 c# 语言中更多包含的概念之一。

但是，出去学习吧！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-14T06:59:25.233

重新定义“未来”——FP 只是盒子里的另一个工具；有时 FP 解决方案非常有帮助，有时则没有那么多。但请记住，C# 在每次迭代时都在功能方面变得越来越好[尽管它不太可能提供 F# 的某些非常具体的 FP 方面，例如可区分联合等]。

同样，C# 团队已经讨论了更简单的不变性，所以让我们为未来的 C# 版本祈祷吧。还要记住，并行扩展/并行 LINQ 将许多 FP“杀手级功能”直接带入每种 .NET 语言。

就个人而言，我非常怀疑它 [F#] 会膨胀，我们都会突然切换到 F#；对于大多数以业务为中心的目标，C# 在 IMO 中仍然更有意义，特别是如果为可测试性而设计（你可以用任何语言编写糟糕的代码......）。

但是，如果您处于 FP 有意义的领域之一，并且您正在使用 .NET，那么 F# 绝对值得研究。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-02-27T15:27:36.890

我很惊讶[Clojure](http://www.clojure.net/2012/02/22/DSL-Examples/)在这次讨论中没有被提及。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-14T03:57:25.257

由于 F# 基本上是“.Net 的函数式编程”，因此有许多类似的（并且可能更成熟的语言），例如：

*   [Scala](http://www.scala-lang.org/)：JVM 上的函数式编程。
*   [Haskell](http://www.haskell.org/)：使用本机代码（或至少是准系统运行时）进行函数式编程。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-14T04:25:50.643

如果你想做函数式编程，去 Common LISP。它是跨平台的，非常稳定，并且已经存在了很长时间。它也是 LISP 家族的一部分；最著名的函数式语言之一。

# assembly - 如何使用 gcc 生成 Intel 语法的汇编代码？

> ID：199966
> 
> 赞同：166
> 
> 时间：2008-10-14T03:52:47.140
> 
> 标签：assembly, gcc, x86, intel-syntax

该`gcc -S`选项将以 AT&T 语法生成汇编代码，有没有办法以 Intel 语法生成文件？或者有没有办法在两者之间转换？

* * *

## 回答 #1

> 赞同：217
> 
> 时间：2008-10-14T04:36:30.997

### 采用`-masm=intel`

```
gcc -S -masm=intel -Og -fverbose-asm test.c 
```

这适用于 GCC，以及 clang3.5 及更高版本。 [GCC 手册](https://gcc.gnu.org/onlinedocs/gcc/x86-Options.html#index-masm_003ddialect)：

> *   `-masm=dialect`
>     使用选定的方言输出 asm 指令。支持的选项是 intel 或 att（默认选项）。达尔文不支持英特尔。

对于 Mac OSX，请注意默认情况下，该`gcc`命令实际上运行 clang。现代 clang 支持`-masm=intel`作为这个的同义词，但这[总是适用于 clang](https://stackoverflow.com/a/11957826/950427)：

```
clang++ -S -mllvm --x86-asm-syntax=intel test.cpp 
```

请注意，[在 clang 14 之前](https://reviews.llvm.org/D113707)，这不会*改变*clang 处理内联`asm()`语句的方式，这[与 GCC 不同](https://stackoverflow.com/questions/9347909/can-i-use-intel-syntax-of-x86-assembly-with-gcc)。

这些是 Matt Godbolt 的 Compiler Explorer 站点默认使用的选项：[https](https://godbolt.org/)
://godbolt.org/ 另请参阅[如何从 GCC/clang 程序集输出中删除“噪音”？](https://stackoverflow.com/questions/38552116/how-to-remove-noise-from-gcc-clang-assembly-output)获取有趣的 asm 输出的其他选项和技巧。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-04-12T16:50:18.770

这

```
gcc -S -masm=intel test.c 
```

和我一起工作。但我可以说另一种方式，尽管这与运行 gcc 无关。编译可执行文件或目标代码文件，然后使用 objdump 以 Intel asm 语法反汇编目标代码，如下所示：

```
 objdump -d --disassembler-options=intel a.out 
```

这可能会有所帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-05-26T18:30:31.857

我在 CPP 文件中有这段代码：

```
#include <conio.h>
#include <stdio.h>
#include <windows.h>

int a = 0;
int main(int argc, char *argv[]) {
    asm("mov eax, 0xFF");
    asm("mov _a, eax");
    printf("Result of a = %d\n", a);
    getch();
    return 0;
 }; 
```

这是与这个 GCC 命令行一起使用的代码：

```
gcc.exe File.cpp -masm=intel -mconsole -o File.exe 
```

它将生成 *.exe 文件，并且它在我的经验中有效。

```
Notes:
immediate operand must be use _variable in global variabel, not local variable.
example: mov _nLength, eax NOT mov $nLength, eax or mov nLength, eax

A number in hexadecimal format must use at&t syntax, cannot use intel syntax.
example: mov eax, 0xFF -> TRUE, mov eax, 0FFh -> FALSE. 
```

就这样。

# multithreading - COM：从其他线程调用会导致崩溃，如何让它在同一个线程上运行？

> ID：199972
> 
> 赞同：3
> 
> 时间：2008-10-14T03:55:14.857
> 
> 标签：multithreading, com, bho

我正在做一个在其他线程上接收事件的 BHO（IE 扩展）。当我从其他线程访问 DOM 时，IE 崩溃。是否可以使 DOM 从与主 BHO 线程相同的线程访问，以免崩溃？

这似乎是一个通用的 COM 多线程问题，我不太了解。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T04:27:20.983

研究使用[CoMarshalInterface](http://msdn.microsoft.com/en-us/library/ms678428.aspx)或[CoMarshalInterThreadInterfaceInStream](http://msdn.microsoft.com/en-us/library/ms693316.aspx)

这些将为您提供线程安全的 STA COM 对象的包装接口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T04:20:46.333

我不太了解 IE 扩展，但听起来某些 COM 对象需要标记为单线程单元，以便 COM 运行时系统确保它在最初调用它的同一线程上运行。如果您无法更改其他对象，您可能会通过标记为 STA 的单独 COM 对象将您的调用路由到 DOM 以实现相同的效果。希望这会有所帮助...我对 COM 多线程有所了解，但对 IE 扩展了解不多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T19:03:58.367

啊，有趣有趣的 COM 多线程。

[如果您只想将接口指针从一个线程转移到另一个线程， Gerald 的答案](https://stackoverflow.com/questions/199972/com-calling-from-other-thread-causes-crashes-how-to-make-it-run-on-the-same-thr#200012)看起来是正确的。我发现如果你在一个多线程系统中，GIT（全局接口表）对这种事情有很大的帮助......基本上你不会保留接口指针，而是 GIT 使用的 DWORD cookie为您正在使用的任何线程获取一个经过适当编组的接口指针。（您必须先在 GIT 中注册有问题的对象，然后在完成或对象完成后取消注册）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-03-11T21:01:34.303

不过要小心。性能可能成为一个严重的问题。

如果您只是想了解 BHO，则可以使用 STA 使 ::SetSite() 实现对象像单线程一样运行（这允许您让其他线程将 BHO 的指针从 GlobalInterfaceTable 中拉出正如@JasonS 提到的。

如果您正在做一些预期会成为产品一部分的事情，我强烈建议您非常仔细地重新考虑尽可能多地使用 MTA，并自己处理并发和线程安全问题。在这种情况下，您只需要确保与 BHO COM 对象互操作的线程本身是为 COM 初始化的。

例如，如果您想监视网站的传入/传出数据以寻找事物（危险或敏感） - 那么您不想强制所有这些线程进入 STA 对象的喉咙，因为以 Yahoo 为例，将启动 30 多个请求，您的 BHO 将开始锁定 IE。

# unit-testing - 单元测试是否适合短程序

> ID：199978
> 
> 赞同：8
> 
> 时间：2008-10-14T03:58:07.720
> 
> 标签：unit-testing

我不是一个新手，因为我从 1983 年就开始断断续续地进行编程，但我只有 Applescript、ARexx、HyperTalk 和 Bash 等脚本语言的真正经验。

我编写脚本来自动化数据输入、批处理图像和转换文件格式。我涉足处理、Ruby 和 Python。

我编写的大多数程序都在 200 行以下，最多有 10 个函数。我希望在未来编写更大、更强大的程序。我想改进我的实践，以避免造成脆弱、无法维护的混乱。我工作的编程环境（Script Editor.app 和 Text Wrangler.app）不支持自动化测试。

*在我现在工作*并*编写程序（而不是 OO）代码*的规模下，**编写单元测试是否合适**，我理解的是：

> 用于测试各个功能的短程序，然后将它们组合成一个功能齐全的更大程序。

在制作这种规模的程序时，**与它们的成本相比，****单元测试**是否值得？

 *** * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T04:02:03.827

是的。任何长于零行的东西都可以进行单元测试——通常效果很好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T04:09:35.357

我会看回归的可能性，而不是代码行数。如果您的程序将存在很长时间并且可能会被重构或以其他方式修改，那么单元测试可能是有意义的。如果代码是一次性的或者永远不可能被修改，那么单元测试可能就不值得了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-15T21:42:35.373

今天它是一个小项目，明天它是您公司基础设施的核心。立即开始，立即获得 100% 的代码覆盖率。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-15T21:26:48.947

单元测试有几个目的；最明显的是测试代码以确定它正在做它应该做的事情。但另一个更有用的目的是**隐式文档**；如果您针对特定行为明确对一段代码进行单元测试，那么即使不明显，该行为也很明显是可以预期的。

考虑不起眼的加法运算符。直截了当，对吧？那么，当添加两个有符号整数时，预期的行为是什么，这两个整数都大于 MAXINT / 2？是 MAXINT，还是负数？

有时，记录所有这些东西可能很笨拙。并不是说它不应该做，而是经验表明它经常不做。但是，测试上述情况是否定的明确单元测试消除了所有疑问；以及为回归提供有效的目的，行为没有随着时间的推移而改变。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-14T04:01:17.323

完全而言，您会知道在几个月内添加新功能时不会破坏任何现有功能....

只是对一段代码进行一组测试的众多优点之一。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-14T03:59:58.543

如果代码在逻辑上可以分成更小的单元，那么单元测试是合适的。如果代码不能明智地划分为更小的组件，那么它就是一个单元，我认为在这种情况下自动化单元测试和自动化功能测试将无法区分。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-14T04:10:17.103

绝对有益，因为编写测试可能有助于验证您的功能设计（API 是否有意义）并有助于保护您在未来避免错误。单元测试也可以作为你的函数的契约，它可以指示函数应该如何使用以及它们的期望。

对于只需阅读代码即可清楚的较短程序，如果您没有很多时间，彻底测试它可能无益。否则，我必须同意我的同事们的观点，即单元测试有很多好处，甚至对小型项目也有帮助。

警告：以下链接可能不适用，但随后的讨论值得阅读。

最近在博客圈内有一些关于何时适合进行测试的讨论，特别是测试驱动开发 (TDD)。您可能想查看一些文章，例如Roy Osherove 的[这](http://weblogs.asp.net/rosherove/archive/2008/09/20/goodbye-mocks-farewell-stubs.aspx) [三篇](http://weblogs.asp.net/rosherove/archive/2008/09/26/unit-testing-decoupled-from-design-adoption.aspx) [文章](http://weblogs.asp.net/rosherove/archive/2008/10/01/unit-testing-decoupled-from-tdd-as-well-adoption.aspx)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T04:19:22.013

唯一需要编写单元测试的时候是您关心程序的输出是否正确，并且将来会继续正确。

如果您的代码的正确性并不重要，那么就没有必要进行单元测试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-18T15:58:49.183

我必须离题大多数答案。Donald Knuth 曾在一次采访中说，当人们不确定自己在做什么或在一个不太舒服的领域工作时，他们倾向于测试大多数事情。

考虑到这一点，我说除了像*mcwafflestixlivejournalcom*所说的那样记录之外，单元测试只有在你不能 100% 确定你的代码时才能帮助你。以两个整数的加法运算符为例，如果我添加两个人的年龄，我不关心溢出。

OTOH，单元测试可以让您分解程序的核心逻辑（这使您做的事情更加模块化）并帮助您比“手动”测试更快地进行测试。毕竟，并非我们所有人都是唐纳德·高德纳。

**请记住，我的回答是针对小功能，就像原始发帖人问的那样**

# asp.net - 如何在 Gridview 中添加不同的控件？

> ID：199986
> 
> 赞同：1
> 
> 时间：2008-10-14T04:02:44.543
> 
> 标签：asp.net, gridview

我知道可以将 GridView 控件中的某些列更改为复选框，并且当您编辑某些行时，被高亮的单元格变成文本框，但假设我想在我的 gridView 中添加其他控件。例如：在下图中，我如何将 CategoryName 的条目更改为可能选择的下拉框？

![](https://i.stack.imgur.com/bFVWI.jpg)

[`[Full size]`](http://www.codersource.net/images/Gridview_depth_Image2.jpg)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T04:29:48.030

使用 TemplateField 并定义 EditItemTemplate 中的控件。

阅读[本文](http://msdn.microsoft.com/en-us/library/bb288032.aspx)作为起点。

# sql-server - 数据库引擎在 SQL 级别有多少兼容性？

> ID：199987
> 
> 赞同：2
> 
> 时间：2008-10-14T04:04:52.403
> 
> 标签：sql-server, postgresql, firebird

假设我想要一个可以在后端轻松切换数据库的应用程序。
我主要将 SQL Server 视为主要后端，但可以灵活地使用另一个数据库引擎。Firebird 和 PostGreSQL 似乎（从我简短的 wikipedia 游览中）与 SQL Server 最相似（而且它们是免费的）。

Firebird、PostGreSQL 和 MS SQL Server 的数据库设置、访问、查询等有多相似？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T04:14:27.813

不幸的是，SQL 因提供商而异。除了最简单的 SQL 之外，几乎不可能编写所有的 SQL 来在多个 RDBMS 上运行——然后你就进入了最低公分母领域。最好使用抽象层至少处理与数据库的连接（包括访问、发送查询），以及使用 ORM 来处理 SQL 本身或每个提供者的 SQL。

如果您想了解它们如何变化 - 很好的示例是自动递增 id 并获取最后插入记录的 ID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T05:41:16.327

我在一个项目中工作，其中绝对需要支持许多数据库，至少包括 Access、SQL Server 和 Oracle。

所以我知道这是可以做到的。大多数情况下，DML (SELECT,UPDATE,INSERT...) 是相同的，当然我们没有遇到太大的问题，使其在所有数据库中都能正常工作——只是偶尔的烦恼。MySQL 在当时是个例外，因为它根本就没有足够的能力。

我们在 DDL 中发现了大多数差异，但使用正确的架构（我们拥有），修复这个问题并不难。

唯一导致我们出现问题的是生成唯一的 id - 自动增量是非标准的。幸运的是，在大约 40 个表的数据库中，只有少数地方需要唯一 ID（良好的数据库设计）。最后，我们在代码中生成唯一 ID，并处理任何冲突（事务中的所有内容）。

它确实让事情变得更容易了，因为我们避免了对 ID 字段使用自动增量，很难想到唯一键 - 但从长远来看会更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T06:02:01.230

好吧，CRUD 的东西应该到处都是一样的，但是如果你构建任何复杂的东西，你可能会想要使用触发器和存储过程，这就是兼容性变低的地方。编写与 DBMS 无关的应用程序通常意味着将大部分业务逻辑移到数据库之外，因此在这种情况下，恕我直言，拥有 3 层应用程序是必须的。

或者，您可以使用一些类似于抽象层的包装库，但我还没有看到能够在一系列 DBMS-es 上正确完成这项工作的包装库。当然，这也取决于您使用的编程语言。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-11T13:32:51.723

正如其他答案所指出的，一旦您超出了基本的 SELECT/INSERT 内容（有时甚至在那里），DBMS 就会发生很大的变化。

我们还必须保持跨多个 DBMS 的兼容性。在我看来，最好的方法通常是使用某种兼容层。我们有一个内部的 DB 抽象库，但有几个可用的工具。

特别是，查看流行的 ORM（Hibernate、nHibernate 等）可能会有所帮助。它们通常提供 DB 独立性作为一种副作用。至少 Hibernate 还具有一种特殊的查询语言，它会自动为您使用的 DBMS 翻译成 SQL。

# c++ - 使用 scons，如何链接到预建库？

> ID：199999
> 
> 赞同：6
> 
> 时间：2008-10-14T04:10:46.853
> 
> 标签：c++, build-process, scons, build-tools

我最近开始使用 scons 构建几个小型跨平台项目。其中一个项目需要链接到预先构建的静态库......这是如何完成的？

在 make 中，我只需在 windows 上附加“link /LIBPATH:wherever libstxxl.lib”，在 unix 上附加“stxxl.a”。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-14T04:34:39.487

只是为了记录答案，因为我自己已经找到了。

```
Program( 'foo', ['foo.cpp'], LIBS=['foo'], LIBPATH='.' ) 
```

添加 LIBS 和 LIBPATH 参数将正确的参数添加到构建命令行。

更多信息[在这里](http://www.scons.org/doc/0.97/HTML/scons-user/x655.html)。*********