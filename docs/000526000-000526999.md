# StackOverflow 问答 000526000-000526999

# post - 用雅虎管道发布表格？

> ID：526006
> 
> 赞同：1
> 
> 时间：2009-02-08T16:45:19.187
> 
> 标签：post, yahoo-pipes

是否可以使用雅虎管道提交表单？

我基本上需要在某个地方登录，然后从网站的成员区域获取一些内容到提要中。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-08T17:05:46.870

虽然这与编程并不完全相关......我想它已经足够接近了。

不，使用 Yahoo Pipes 登录某个地方是不可能的。发送用户名/密码甚至不是这里唯一的问题。

真正的问题是，大多数（如果不是全部）需要登录的网站都依赖于会话 cookie 或类似的东西。Yahoo 管道可以执行 GET 请求，仅此而已。即使可以*在*URL 中发送您的用户名/密码，您也无法使用会话 cookie，因此后续请求将失败。

所以...如果您可以访问某处的托管网站：编写一个小的代理脚本（在 PHP 或任何可用的语言中）进行登录并获取数据。让 Yahoo 管道从您的代理页面读取数据。但是，如果您到此为止，您也可以立即生成 RSS 格式。;-)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-10-25T00:28:49.413

我做了一个可以登录和提取信息的管道。在使用 POST 的简单 Web 表单上工作正常。

# objective-c - 为应用程序创建 URI

> ID：526011
> 
> 赞同：2
> 
> 时间：2009-02-08T16:47:02.163
> 
> 标签：objective-c, cocoa, macos, uri

我想为我的应用程序提供一个 URI。例如，如果我的应用名称是“GetIt”：

> 得到它：//

有没有一种简单的方法来创建一个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T17:18:21.603

为 GetURL 事件创建一个 Apple 事件处理程序，然后将 URL 方案列表放入您的应用程序包中。Kimbro Staken 有[一篇博文，其中包含更多详细信息](http://www.xmldatabases.org/WK/blog/1154?t=item)。

我认为有一些可重用的 Cocoa 源代码为您处理 AE 处理程序，但我忘记了它的名称以及从哪里获得它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T20:50:47.063

除非您打算使您的应用程序可编写脚本，否则最简单的方法可能就是为此注册一个 Apple 事件处理程序。CocoaDev 有[一个很好的例子](http://www.cocoadev.com/index.pl?HowToRegisterURLHandler)来说明如何做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T20:07:34.033

此外，Craig Hockenberry 有[一篇](http://furbo.org/2008/10/01/redacted/)关于在 iPhone 应用程序中实现自定义 URL 方案的精彩文章。我没有在 Cocoa 的桌面上尝试过这个，所以我不知道会翻译多少。

# c - C中具有大量字符的字节顺序

> ID：526030
> 
> 赞同：9
> 
> 时间：2009-02-08T17:04:10.133
> 
> 标签：c, sockets, endianness

我正在用 C 语言进行一些套接字编程，并试图解决字节顺序问题。我的请求（发送）很好，但是当我收到数据时，我的字节都乱了。我从这样的事情开始：

```
char * aResponse= (char *)malloc(512);
int total = recv(sock, aResponse, 511, 0); 
```

在处理这个响应时，每个 16 位字的字节似乎都颠倒了（我使用的是 UDP）。我试图通过这样做来解决这个问题：

```
 unsigned short * _netOrder= (unsigned short *)aResponse;
    unsigned short * newhostOrder= (unsigned short *)malloc(total);
    for (i = 0; i < total; ++i)
    {
         newhostOrder[i] = ntohs(_netOrder[i]);
    } 
```

当我将数据视为短数据时，这可以正常工作，但是如果我再次将指针转换为 char，则字节会反转。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-08T19:11:41.357

好的，您在两个不同级别上所做的事情似乎存在问题。这里的部分混淆似乎源于您对指针的使用，它们指向的对象类型，以及指针指向的内存中值的编码的解释。

内存中多字节实体的编码称为字节序。两种常见的编码称为***小端***(LE) 和**大端**(BE)。使用 LE，一个 16 位的量（如 short）首先被编码为最低有效字节 (LSB)。在 BE 下，首先对最高有效字节 (MSB) 进行编码。

按照惯例，网络协议通常将事物编码为我们所说的“网络字节顺序”（NBO），这也恰好与 BE 相同。如果您在大端平台上发送和接收内存缓冲区，那么您将不会遇到转换问题。但是，您的代码将依赖于 BE 约定的平台。如果你想编写在 LE 和 BE 平台上都能正常工作的可移植代码，你不应该假设平台的字节序。

实现字节序可移植性是***ntohs()***、***ntohl()***、***htons()***和***htonl()***等例程的目的。这些函数/宏是在给定平台上定义的，用于在发送端和接收端进行必要的转换：

*   ***htons()*** - 将短值从主机订单转换为网络订单（用于发送）
*   ***htonl()*** - 将长值从主机顺序转换为网络顺序（用于发送）
*   ***ntohs()*** - 将短值从网络订单转换为主机订单（接收后）
*   ***ntohl()*** - 将长值从网络订单转换为主机订单（接收后）

了解您关于在转换回字符时访问内存的评论对内存中实体的实际顺序没有影响。也就是说，如果您以一系列字节的形式访问缓冲区，无论您使用的是 BE 机器还是 LE 机器，您都会以它们实际编码到内存中的任何顺序看到这些字节。因此，如果您在接收后查看 NBO 编码缓冲区，则 MSB 将是第一个 - 总是。如果您在转换回主机顺序后查看输出缓冲区，如果您有 BE 机器，则字节顺序将保持不变。相反，在 LE 机器上，字节现在将在转换后的缓冲区中全部反转。

最后，在您的转换循环中，变量`total`指的是字节。但是，您正在以`shorts`. 你的循环保护不应该是`total`，但应该是：

`total / sizeof( unsigned short )`

考虑到每个`short`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T17:15:02.263

> 当我将数据视为短数据时，这可以正常工作，但是如果我再次将指针转换为 char，则字节会反转。

这就是我所期望的。

> 我究竟做错了什么？

您必须知道发送者发送了什么：知道数据是字节（不需要反转），还是短或长（需要反转）。

Google 获取与 、 和 API 相关`ntohs`的`htons`教程`htons`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T17:15:52.403

目前尚不清楚`aResponse`代表什么（字符串？结构？）。[字节序](http://en.wikipedia.org/wiki/Endianness)仅与数值有关，`char`与 s 无关。您还需要确保在发送方，所有数值都从主机转换为网络字节顺序 ( `hton*`)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T17:18:42.833

除了你原来的问题（我认为已经回答了），你应该看看你的*malloc*声明。*malloc*分配字节，无符号短很可能是两个字节。

您的声明应如下所示：

```
unsigned short *ptr = (unsigned short*) malloc(total * sizeof(unsigned short)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T17:09:19.203

网络字节顺序是大端，所以如果你想让它有意义，你需要将它转换为小端，但如果它只是一个数组它不应该大惊小怪，发送方如何发送它的数据？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-30T11:59:48.930

对于单字节，我们可能不关心字节顺序。

# html - 如何将我的 div 放在其容器的底部？

> ID：526035
> 
> 赞同：870
> 
> 时间：2009-02-08T17:08:57.470
> 
> 标签：html, css

给定以下 HTML：

```
<div id="container">
  <!-- Other elements here -->
  <div id="copyright">
    Copyright Foo web designs
  </div>
</div>
```

我想`#copyright`坚持到底`#container`。我可以在不使用绝对定位的情况下实现这一点吗？

* * *

## 回答 #1

> 赞同：1058
> 
> 时间：2009-02-08T17:13:26.447

可能不会。

分配`position:relative`给`#container`，然后分配`position:absolute; bottom:0;`给`#copyright`。

* * *

```
#container {
    position: relative;
}
#copyright {
    position: absolute;
    bottom: 0;
}
```

```
<div id="container">
  <!-- Other elements here -->
  <div id="copyright">
    Copyright Foo web designs
  </div>
</div>
```

* * *

## 回答 #2

> 赞同：375
> 
> 时间：2012-02-01T03:53:15.593

实际上，@User 接受的答案仅在窗口高且内容短的情况下才有效。但是如果内容高而窗口短，它会将版权信息放在页面内容上，然后向下滚动查看内容会给你留下一个浮动的版权声明。这使得该解决方案对于大多数页面（实际上就像这个页面）都无用。

最常见的方法是演示的“CSS 粘性页脚”方法，或者稍微更苗条的变体。这种方法效果很好——如果你有一个固定高度的页脚。

如果你需要一个可变高度的页脚，如果内容太短，它会出现在窗口底部，如果窗口太短，它会出现在内容的底部，你会怎么做？

吞下你的骄傲，使用一张桌子。

例如：

```
* {
    padding: 0;
    margin: 0;
}

html, body {
    height: 100%;
}

#container {
    height: 100%;
    border-collapse: collapse;
}
```

```
<!DOCTYPE html>
<html>
<body>
    <table id="container">
        <tr>
            <td valign="top">
                <div id="main">Lorem ipsum, etc.</div>
            </td>
        </tr>
        <tr>
            <td valign="bottom">
                <div id="footer">Copyright some evil company...</div>
            </td>
        </tr>
    </table>
</body>
</html>
```

试试看。这适用于任何窗口大小、任何数量的内容、任何大小的页脚、每个浏览器……甚至 IE6。

如果您对使用表格进行布局感到畏缩，请花点时间问问自己为什么。CSS 应该让我们的生活更轻松——总的来说，它确实如此——但事实是，即使经过这么多年，它仍然是一个破碎的、违反直觉的混乱。它不能解决所有问题。它不完整。

表格并不酷，但至少就目前而言，它们有时是解决设计问题的最佳方式。

* * *

## 回答 #3

> 赞同：259
> 
> 时间：2015-01-07T05:04:24.103

## 弹性盒方法！

在[支持的浏览器](http://caniuse.com/#feat=flexbox)中，您可以使用以下内容：

[**示例在这里**](http://jsfiddle.net/bv1rs8s1/)

```
.parent {
  display: flex;
  flex-direction: column;
}
.child {
  margin-top: auto;
} 
```

```
.parent {
  height: 100px;
  border: 5px solid #000;
  display: flex;
  flex-direction: column;
}
.child {
  height: 40px;
  width: 100%;
  background: #f00;
  margin-top: auto;
}
```

```
<div class="parent">
  <div class="child">Align to the bottom</div>
</div>
```

* * *

上面的解决方案可能更灵活，但是，这里有一个替代解决方案：

[**示例在这里**](http://jsfiddle.net/rh4Lc5dr/)

```
.parent {
  display: flex;
}
.child {
  align-self: flex-end;
} 
```

```
.parent {
  height: 100px;
  border: 5px solid #000;
  display: flex;
}
.child {
  height: 40px;
  width: 100%;
  background: #f00;
  align-self: flex-end;
}
```

```
<div class="parent">
  <div class="child">Align to the bottom</div>
</div>
```

* * *

作为旁注，您可能需要添加供应商前缀以获得额外支持。

* * *

## 回答 #4

> 赞同：121
> 
> 时间：2013-10-01T07:16:53.480

**是**的，您可以在`absolute`不使用定位且不使用`table`s 的情况下执行此操作（使用标记等）。

[演示](http://jsfiddle.net/3Myn2/1/)
这经过测试可以在 IE>7、chrome、FF 上运行，并且非常容易添加到您现有的布局中。

```
<div id="container">
    Some content you don't want affected by the "bottom floating" div
    <div>supports not just text</div>

    <div class="foot">
        Some other content you want kept to the bottom
        <div>this is in a div</div>
    </div>
</div> 
```

```
#container {
    height:100%;
    border-collapse:collapse;
    display : table;
}

.foot {
    display : table-row;
    vertical-align : bottom;
    height : 1px;
} 
```

它有效地做了什么`float:bottom`，甚至解决了@Rick Reilly 的回答中指出的问题！

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2013-10-01T08:38:45.843

这是一个老问题，但这是一种独特的方法，可以在多种情况下提供帮助。

## 纯CSS，无绝对定位，无固定高度，跨浏览器（IE9+）

看看那个[**工作小提琴**](http://jsfiddle.net/avrahamcool/e64nf/)

因为正常流程是“从上到下”，我们不能简单地要求`#copyright`div 在没有某种绝对定位的情况下坚持到其父级的底部，但是如果我们希望`#copyright`div 坚持到其父级的顶部，它会很简单——因为这是正常的流动方式。

因此，我们将利用这一点作为我们的优势。我们将更改`div`HTML 中 s 的顺序，现在`#copyright`div 位于顶部，内容紧随其后。我们还让内容 div 一直拉伸（使用伪元素和清除技术）

现在只需在视图中反转该顺序即可。这可以通过 CSS 转换轻松完成。

我们将容器旋转 180 度，现在：向上是向下。（然后我们将内容反转为看起来正常）

如果我们想在内容区域中有一个滚动条，我们需要应用更多的 CSS 魔法。可以在[**这里**](http://jsfiddle.net/avrahamcool/q6jGr/5/)显示[在该示例中，内容位于标题下方-但其想法相同]

```
* {
  margin: 0;
  padding: 0;
}

html,
body,
#Container {
  height: 100%;
  color: white;
}

#Container:before {
  content: '';
  height: 100%;
  float: left;
}

#Copyright {
  background-color: green;
}

#Stretch {
  background-color: blue;
}

#Stretch:after {
  content: '';
  display: block;
  clear: both;
}

#Container,
#Container>div {
  -moz-transform: rotateX(180deg);
  -ms-transform: rotateX(180deg);
  -o-transform: rotate(180deg);
  -webkit-transform: rotateX(180deg);
  transform: rotateX(180deg);
}
```

```
<div id="Container">
  <div id="Copyright">
    Copyright Foo web designs
  </div>
  <div id="Stretch">
    <!-- Other elements here -->
    <div>Element 1</div>
    <div>Element 2</div>
  </div>
</div>
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2019-08-22T16:25:47.890

## CSS 网格

由于 CSS Grid 的使用越来越多，我想建议[**`align-self`**](https://developer.mozilla.org/en-US/docs/Web/CSS/align-self)网格容器内的元素。

`align-self`可以包含任何值：`end`, `self-end`,`flex-end`对于以下示例。

```
#parent {
  display: grid;
}

#child1 {
  align-self: end;
}

/* Extra Styling for Snippet */

#parent {
  height: 150px;
  background: #5548B0;
  color: #fff;
  padding: 10px;
  font-family: sans-serif;
}

#child1 {
  height: 50px;
  width: 50px;
  background: #6A67CE;
  text-align: center;
  vertical-align: middle;
  line-height: 50px;
}
```

```
<div id="parent">
  <!-- Other elements here -->
  <div id="child1">
    1
  </div>

</div>
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-02-08T17:20:38.460

试试这个;

```
<div id="container">
  <div style="height: 100%; border:1px solid #ff0000;">
  <!-- Other elements here -->
  </div>
</div>
<div id="copyright" style="position:relative;border:1px solid #00ff00;top:-25px">
   Copyright Foo web designs
</div> 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-07-11T16:13:00.810

`div`为上面的元素创建另一个容器`#copyright`。在版权上方添加一个新的`div`： `<div style="clear:both;"></div>` 它将强制**页脚**位于其他所有内容之下，就像使用相对定位 ( `bottom:0px;`) 的情况一样。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-08-19T00:37:09.690

虽然这里提供的答案似乎都不适用于我的特定情况或工作，但我遇到了[这篇文章](http://tanalin.com/en/articles/css-block-order/)，它提供了这个简洁的解决方案：

```
#container {
  display: table;
}

#copyright {
  display: table-footer-group;
} 
```

我发现它对于将响应式设计应用于移动显示非常有用，而无需重新排序网站的所有 html 代码，将`body`自身设置为表格。

请注意，只有第一个`table-footer-group`or`table-header-group`将被渲染为：如果有多个，其他将被渲染为`table-row-group`。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2013-06-07T04:26:31.027

如果您知道使用元素的**文本对齐**功能，您确实可以不使用`align`该框。`bottom``position:absolute``height``#container`**`inline-block`**

 **[在这里](http://jsfiddle.net/SqdPR/)你可以看到它的作用。

这是代码：

```
#container {
    /* So the #container most have a fixed height */
    height: 300px;
    line-height: 300px;
    background:Red;
}

#container > * {
    /* Restore Line height to Normal */
    line-height: 1.2em;
}

#copyright {
    display:inline-block;
    vertical-align:bottom;
    width:100%; /* Let it be a block */
    background:green;
} 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2015-08-21T08:58:49.240

# 使用 translateY 和 top 属性

只需将元素子元素设置为位置：相对，然后将其移动到顶部：100%（即父元素的 100% 高度）并通过变换坚持到父元素的底部：translateY(-100%)（即 -100% 的高度孩子）。

好处

*   您**不会**从页面流中获取元素
*   它是动态的

但仍然只是解决方法:(

```
.copyright{
   position: relative;
   top: 100%;
   transform: translateY(-100%);
} 
```

不要忘记旧浏览器的前缀。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2013-07-11T15:38:27.640

[CodePen 链接在这里](http://codepen.io/azizarslan/pen/vDCyg)。

```
html, body {
    width: 100%;
    height: 100%;
}

.overlay {
    min-height: 100%;
    position: relative;
}

.container {
    width: 900px;
    position: relative;
    padding-bottom: 50px;
}

.height {
    width: 900px;
    height: 50px;
}

.footer {
    width: 900px;
    height: 50px;
    position: absolute;
    bottom: 0;
}
```

```
<div class="overlay">
    <div class="container">
        <div class="height">
            content
        </div>
    </div>

    <div class="footer">
        footer
    </div>
</div>
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-02-08T17:12:05.263

如果你想让它“粘”在底部，不管容器的高度如何，那么绝对定位就是要走的路。当然，如果版权元素是容器中的最后一个元素，它总是在底部。

你能扩展你的问题吗？准确解释你想要做什么（以及为什么你不想使用绝对定位）？

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2014-01-06T08:22:34.220

如果您不知道子块的高度：

```
#parent {
    background:green;
    width:200px;
    height:200px;
    display:table-cell;
    vertical-align:bottom;
}
.child {
    background:red;
    vertical-align:bottom;
}
```

```
<div id="parent">
    <div class="child">child
    </div> 
</div>
```

[http://jsbin.com/ULUXIFon/3/edit](http://jsbin.com/ULUXIFon/3/edit)

如果您知道子块的高度，请添加子块，然后添加 padding-top/margin-top：

```
#parent {
    background:green;
    width:200px;
    height:130px;
    padding-top:70px;
}
.child {
    background:red;
    vertical-align:
    bottom;
    height:130px;
}
```

```
<div id="parent">
    <div class="child">child
    </div> 
</div> 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-05-15T14:50:38.890

此外，如果有使用`position:absolute;`or的规定`position:relative;`，您可以随时尝试使用`padding` **parent** `div`或放置`margin-top:x;`. 在大多数情况下不是一个很好的方法，但在某些情况下它可能会派上用场。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2016-05-19T07:01:57.637

```
 #container{width:100%; float:left; position:relative;}
#copyright{position:absolute; bottom:0px; left:0px; background:#F00; width:100%;}
#container{background:gray; height:100px;}
```

```
<div id="container">
  <!-- Other elements here -->
  <div id="copyright">
    Copyright Foo web designs
  </div>
</div>
```

```
<div id="container">
  <!-- Other elements here -->
  <div id="copyright">
    Copyright Foo web designs
  </div>
</div>
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-08-30T05:46:55.697

这是一种方法，旨在使具有已知高度和宽度（至少近似）的元素浮动到右侧并停留在底部，同时作为其他元素的内联元素。它集中在右下角，因为您可以通过其他方法轻松地将其放置在任何其他角落。

我需要制作一个导航栏，它在右下角有实际的链接和随机的兄弟元素，同时确保栏本身可以正确拉伸，而不会破坏布局。我使用了一个“阴影”元素来占据导航栏链接的空间，并将其添加到容器子节点的末尾。

* * *

```
<!DOCTYPE html>
<div id="container">
  <!-- Other elements here -->
  <div id="copyright">
    Copyright Foo web designs
  </div>
  <span id="copyright-s">filler</span>
</div>

<style>
  #copyright {
    display:inline-block;
    position:absolute;
    bottom:0;
    right:0;
  }
  #copyright-s {
    float:right;
    visibility:hidden;
    width:20em; /* ~ #copyright.style.width */
    height:3em; /* ~ #copyright.style.height */
  }
</style> 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-04-03T08:51:59.390

也许这对某人有帮助：您始终可以将 div 放在另一个 div 之外，然后使用负边距将其向上推：

```
<div id="container" style="background-color: #ccc; padding-bottom: 30px;">
  Hello!
</div>
<div id="copyright" style="margin-top: -20px;">
  Copyright Foo web designs
</div> 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2019-10-31T11:23:30.027

不想在底部使用“位置：绝对”作为粘性页脚。然后你可以这样做：

```
 html,
        body {
            height: 100%;
            margin: 0;
        }
        .wrapper {
            min-height: 100%;
            /* Equal to height of footer */
            /* But also accounting for potential margin-bottom of last child */
            margin-bottom: -50px;
        }
        .footer{
            background: #000;
            text-align: center;
            color: #fff;
        }
        .footer,
        .push {
            height: 50px;
        }
```

```
<html>
<body>
    <!--HTML Code-->
    <div class="wrapper">
        <div class="content">content</div>
        <div class="push"></div>
    </div>
    <footer class="footer">test</footer>
</body>
</html>
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-10-26T14:56:50.627

此特定场景的解决方案：

**将 inner 放在 parent 的底部。父级的高度由其“最高”兄弟级的高度设置**

设置：

*   我有一排有多个`<div class="container">`
*   这些`<div class="container">`在另一个内部彼此相邻`<div class="supercontainer">`
*   每个`<div class="container">`都有 3 个相互重叠的内部 div：`<div class="title">`, `<div class="content">`,`<div class="footer">`

期望的结果：

*   都`<div class="container">`具有相同的高度。高度没有以 px 为单位定义，它将是其中“最高”的高度。
*   `<div class="title">`应该在顶部`<div class="container">`
*   `<div class="content">`应该放在下面`<div class="title">`
*   `<div class="footer">`应该放在`<div class="container">`不与前面内容重叠的底部

这是当前状态：[https ://codepen.io/xavier-atero/pen/ExvWQww](https://codepen.io/xavier-atero/pen/ExvWQww)

[![在此处输入图像描述](https://i.stack.imgur.com/2nO8f.png)](https://i.stack.imgur.com/2nO8f.png)

```
.supercontainer {
  border: solid 1px black;
  display: flex;
}

.container, .other-container {
  position: relative;
  border: solid 1px red;
  width: 200px;
  margin: 10px;
}

.title {
  margin: 10px;
  border: solid 1px blue;
}

.content {
  margin: 10px;  
  border: solid 1px cyan;
}

.footer {
  margin: 10px;
  background: lime;
}
```

```
<body>
  <div class="supercontainer">
    <div class="container"> 
      <div class="title">
        This part represents the title and it is placed on top
      </div> 
      <div class="content">
        This one represents the body and it is placed below the title
      </div> 
      <div class="footer"> 
        And this one is the footer. It should always be at the bottom of the container
      </div>
    </div>
    <div class="other-container"> 
      <div class="title">
        This part represents the title and it is placed on top.
      </div> 
      <div class="content">
        This one represents the body and it is placed below the title. This one is longer than the first one to stretch the parent div. Since it is longer, the footers of the two containers are not alinged.
      </div> 
      <div class="footer"> 
        And this one is the footer. It should always be at the bottom of the container
      </div>
    </div>
  </div>
</body>
```

**__________ 使用 FLEXBOX 的解决方案 __________**

这是结果：[https ://codepen.io/xavier-atero/pen/MWvpBMz](https://codepen.io/xavier-atero/pen/MWvpBMz)

[![在此处输入图像描述](https://i.stack.imgur.com/vM1OB.png)](https://i.stack.imgur.com/vM1OB.png)

```
.supercontainer {
  border: solid 1px black;
  display: flex;
}

.container, .other-container {
  position: relative;
  border: solid 1px red;
  width: 200px;
  margin: 10px;
  display: flex;
  flex-direction: column;
}

.title {
  margin: 10px;
  border: solid 1px blue;
}

.content {
  margin: 10px;  
  border: solid 1px cyan;
}

.footer {
  margin: 10px;
  background: lime;
  margin-top: auto;
  border: solid 1px fuchsia;
}
```

```
<body>
  <div class="supercontainer">
    <div class="container"> 
      <div class="title">
        This part represents the title and it is placed on top
      </div> 
      <div class="content">
        This one represents the body and it is placed below the title
      </div> 
      <div class="footer"> 
        And this one is the footer. It should always be at the bottom of the container
      </div>
    </div>
    <div class="other-container"> 
      <div class="title">
        This part represents the title and it is placed on top.
      </div> 
      <div class="content">
        This one represents the body and it is placed below the title. This one is longer than the first one to stretch the parent div. Since it is longer, the footers of the two containers are not alinged.
      </div> 
      <div class="footer"> 
        And this one is the footer. It should always be at the bottom of the container
      </div>
    </div>
  </div>
</body>
```

**__________ 使用 TABLE-ROW 的解决方案 __________**

这是结果：[https ://codepen.io/xavier-atero/pen/rNzyKJm](https://codepen.io/xavier-atero/pen/rNzyKJm)

[![在此处输入图像描述](https://i.stack.imgur.com/uY4Qe.png)](https://i.stack.imgur.com/uY4Qe.png)

```
.supercontainer {
  border: solid 1px black;
  display: flex;
}

.container, .other-container {
  position: relative;
  border: solid 1px red;
  width: 200px;
  margin: 10px;
  border-collapse:collapse;
  display : table;
}

.title {
  margin: 10px;
  border: solid 1px blue;
}

.content {
  margin: 10px;  
  border: solid 1px cyan;
}

.footer {
  margin: 10px;
  background: lime;
  border: solid 1px fuchsia;
  display: table-row;
  vertical-align: bottom;
  height: 1px;
}
```

```
<body>
  <div class="supercontainer">
    <div class="container"> 
      <div class="title">
        This part represents the title and it is placed on top
      </div> 
      <div class="content">
        This one represents the body and it is placed below the title
      </div> 
      <div class="footer"> 
        And this one is the footer. It should always be at the bottom of the container
      </div>
    </div>
    <div class="other-container"> 
      <div class="title">
        This part represents the title and it is placed on top.
      </div> 
      <div class="content">
        This one represents the body and it is placed below the title. This one is longer than the first one to stretch the parent div. Since it is longer, the footers of the two containers are not alinged.
      </div> 
      <div class="footer"> 
        And this one is the footer. It should always be at the bottom of the container
      </div>
    </div>
  </div>
</body>
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-05-20T14:14:26.073

`float:bottom`CSS中没有调用任何内容。最好的方法是在这种情况下使用定位：

```
position:absolute;
bottom:0; 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-06-13T08:28:48.810

仅仅因为根本没有提到这一点，通常在像你这样的情况下效果很好：

将 copyright-div放在 container-div**之后**

您只需要以与其他容器类似的方式（相同的整体宽度、居中等）来格式化版权 div，一切都很好。

*CSS：*

```
#container, #copyright {
    width: 1000px;
    margin:0 auto;
} 
```

*HTML：*

```
<div id="container">
    <!-- Other elements here -->
</div>

<div id="copyright">
    Copyright Foo web designs
</div> 
```

唯一可能不理想的情况是您的 container-div 声明为`height:100%`，并且用户需要向下滚动才能查看版权。但即使你仍然可以解决（例如`margin-top:-20px`- 当你的版权元素的高度是 20 像素时）。

*   无绝对定位
*   没有表格布局
*   没有疯狂的 CSS，在其他所有浏览器中看起来都不同（至少 IE，你知道的）
*   简单明了的格式

旁白：我知道 OP 要求的解决方案是*“......粘在'容器' div 的底部......”*，而不是它下面的东西，但是来吧，人们在这里寻找好的解决方案，而这个是一个！

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-11-16T11:31:39.507

对于容器中只有一个子元素的容器，您可以使用`table-cell`and`vertical-align`方法可靠地将单个 div 定位在其父元素的底部。

请注意，使用`table-footer-group`提到的其他答案将破坏 parent 的高度计算`table`。

```
#container {
    display: table;
    width: 100%;
    height: 200px;
}
#item {
    display: table-cell;
    vertical-align: bottom;
}
```

```
<div id="container">
    <div id="item">Single bottom item</div>
</div>
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-12-03T18:44:27.767

您可以通过将可用空间分配给顶部的内容来使用网格：

```
 #container {
    display: grid;
    grid-template-rows: 1fr auto;
    height: 10rem; /* or 100% or anything */
}
```

```
<div id="container">
  This is random content.
  <div id="copyright">
    Copyright Foo web designs
  </div>
</div>
```

* * *

## 回答 #25

> 赞同：-2
> 
> 时间：2020-02-06T13:21:25.767

根据：[w3schools.com](https://www.w3schools.com/css/css_positioning.asp)

> 具有位置的元素：绝对；相对于最近的定位祖先定位（而不是相对于视口定位，如固定）。

因此，您需要将父元素定位为相对或绝对等，并将所需元素定位为绝对，然后将底部设置为 0。

# java - 如何为给定文件打开用户系统首选编辑器？

> ID：526037
> 
> 赞同：13
> 
> 时间：2009-02-08T17:09:45.567
> 
> 标签：java, file, editor, system

我试图弄清楚如何打开给定文件的系统首选编辑器。

比如说，我们有一个用 Java 编写的文件管理器。用户转到文件夹并查看文件列表。并且，例如，有一个文件`Icon.jpg`. 用户双击文件名并在系统的首选编辑器（即 Gimp）中打开文件。主要问题是 - 如何做到这一点？

我们可以这样做`Runtime.getRuntime().exec("something file")`，但是这样您应该知道在用户环境中首选哪个程序。但是怎么做？

我们也可以这样做`Desktop.getDesktop().edit(File file)`，但是这样我们无法跟踪进程并且无法知道该子进程是否已关闭。其他问题 - 功能在 linux 上不起作用（至少在 Ubuntu 8.10 上）。还有`Desktop.getDesktop().open(File file)`，但它强制打开文件查看器，而不是该文件类型的系统查看器。

我整个星期都在寻找解决方案，但没有找到任何合适且通用的解决方案。你知道这个问题的其他方法吗？对于我的项目，如果它可以在 Windows+Linux+Mac 上运行就足够了。

感谢您的回答和建议。

**编辑于 2009-02-08 23:04**

其他建议：我可以在 Windows 和 Linux 中强制“应用程序选择”窗口，就像在带有“打开文件”的 Mac 中一样？例如，然后您尝试打开文件，系统会要求您从系统首选列表中选择应用程序？（类似于 Windows 资源管理器中的“打开方式...”）。你知道吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-08T17:34:28.293

似乎如果你不能使用`java.awt.Desktop`你必须区分操作系统： Windows：

```
RUNDLL32.EXE SHELL32.DLL,OpenAs_RunDLL <file.ext> 
```

Linux：

```
edit <file.ext> 
```

苹果电脑：

```
open <file.ext> 
```

HTH。显然，这不是很便携...

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-08T17:28:11.160

查看[java.awt.Desktop](http://java.sun.com/javase/6/docs/api/java/awt/Desktop.html)对象。在你的情况下，你想调用[`edit()`](http://java.sun.com/javase/6/docs/api/java/awt/Desktop.html#edit(java.io.File))

如果要确保给定平台支持此调用，则可以执行以下操作（我尚未测试此代码）：

```
public boolean editFile(final File file) {
  if (!Desktop.isDesktopSupported()) {
    return false;
  }

  Desktop desktop = Desktop.getDesktop();
  if (!desktop.isSupported(Desktop.Action.EDIT)) {
    return false;
  }

  try {
    desktop.edit(file);
  } catch (IOException e) {
    // Log an error
    return false;
  }

  return true;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T17:27:12.270

这不是跨平台的，但在 Mac OS X 上你可以做到

```
Runtime.getRuntime().exec("open filename"); 
```

`open(1)`可执行文件使用[LaunchServices](http://developer.apple.com/DOCUMENTATION/Carbon/Conceptual/LaunchServicesConcepts/LSCIntro/chapter_1_section_1.html)选择要执行的正确程序，然后使用该程序打开名为`filename`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-27T06:41:11.393

这将在Windows中工作

```
Runtime.getRuntime().exec( "CMD /C START filename.ext " ); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-01-04T09:34:03.020

对于 JavaFX 应用程序，我们可以使用 HostServices。这个[问题](https://stackoverflow.com/questions/33094981/javafx-8-open-a-link-in-a-browser-without-reference-to-application/33100968#33100968)涵盖了如何使用 HostServices。这应该适用于 Ubuntu（已测试）/Windows（未测试）和 Mac（未测试）。

```
import java.io.File;
import java.io.IOException;
public class App extends Application {
}

File file = new File("/your/file/path");
HostServices hostServices = getHostServices();
hostServices.showDocument(file.getAbsolutePath()); 
```

getHostServices() 是 JavaFX Application 类的一个方法。

# sms - 通过 Web 应用程序接收 SMS 消息

> ID：526046
> 
> 赞同：15
> 
> 时间：2009-02-08T17:15:52.277
> 
> 标签：sms, gateway

我们正在构建一个 Web 应用程序，它应该能够接收 SMS 消息并将其中包含的信息存储在数据库中。

你用过哪些方法？有哪些服务提供商可以提供帮助？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-08T17:17:53.367

[http://www.clickatell.com/](http://www.clickatell.com/)是巨大的，它的工作原理和它在锡上说的完全一样。您支付一个电话号码和发送到该号码的短信，最终点击您网站上的一个 URL 来传递它们，就像有人发布表格一样。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-26T06:01:22.183

我建议使用诸如[TextMarks](http://textmarks.com/dev/)之类的服务。TextMarks 是免费的，让您为您的服务选择一个关键字，允许用户通过 TextMarks 的共享短代码 41411 将消息路由给您。这里唯一的问题是他们在每条消息中为短广告保留 20 个字符以支付他们的费用服务。

如果您超出了他们的广告赞助服务，您可以升级到不包含广告的高级版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T17:54:56.257

我还没有这样做，但我想你也可以在你的服务器上设置一个 Asterisk 系统，然后获取一个常规的 VOIP 帐户（Asterisk 挂钩）并配置 Asterisk 服务器以将所有 SMS 转发到你的应用程序。[本文](http://snapvoip.blogspot.com/2007/10/configuring-using-and-debugging.html)可能有助于设置 Asterisk 服务器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T18:34:14.757

我有使用[MX Telecom](http://www.mxtelecom.com)作为 SMS 网关的经验。基本上，每次我们收到传入的短信时，他们都会将数据发布到我们的网络服务中。有问题的应用程序也在发送 SMS 消息，我们只是对他们的网页进行了 http GET。

我不能谈论业务端（即成本），因为我只是负责实现这些功能——但是从开发的角度来看，使用 SMS 网关确实非常简单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-05T19:49:34.590

另一种（更便宜的）替代方法是让您的用户将短信发送到电子邮件地址，例如 sms@yourapp.com。然后，您可以拥有一个查看电子邮件帐户并将消息放入数据库的后台线程。

我已经与美国主要运营商实施并测试了这种方法，从智能手机到随用随付的“蹩脚”手机，一切都很顺利。

当用户将 SMS 发送到您的电子邮件地址时，您将获得 SMS 电子邮件网关地址（例如 8055551234@vtext.net），因此您可以发送响应消息。

唯一的缺点是在大多数手机上找到“发送到电子邮件地址”选项有点困难，但它（基本上）对你来说是免费的。这对于在测试工作流程时降低成本特别有用。每条 SMS 约 3 美分加起来很快，尤其是在自动化测试期间。

当您想要支持 SMS 号码时，您可以配置大多数 SMS 网关以将电子邮件发送到某个地址，这样您就不必更改您的基础设施来支持“真正的”SMS 消息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-08T17:56:29.013

+1 在塞巴斯蒂安上，我写的几乎一样

如果你正在使用 ruby​​，你可能想看看 adhearsion

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-03-19T08:50:04.277

您可以使用 SMS 网关软件，该软件将通过连接到 PC 的 GSM 调制解调器或 3G 加密狗接收 SMS 消息，并通过 HTTP 将它们发布到您的网站。例如：[这个软件](http://smsenabler.com)

# .net - IronPython 性能

> ID：526062
> 
> 赞同：7
> 
> 时间：2009-02-08T17:23:20.530
> 
> 标签：.net, performance, ironpython

我正在考虑将 IronPython 作为我正在编写的应用程序的脚本语言嵌入。所以为了尝试一下，我下载了 IronPython 2.0 并启动了交互式解释器。在我的带有 6 Gigs 内存的 Intel Quad Core 上，刚启动这件事大约需要 5 秒钟。我很难想象这对于一台功能较弱的机器来说会有多大的延迟。

基于[这些基准](http://www.codeplex.com/IronPython/Wiki/View.aspx?title=IP20VsCPy25Perf&referringTitle=IronPython%20Performance)，看起来 IronPython 的性能实际上并不算太差。或者是吗？我在安装过程中是否配置错误？或者这是交互式解释器的问题？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-08T17:32:09.250

IronPython 的性能确实相当不错。您获得的启动性能损失与 .NET 运行时有关。.NET 应用程序的启动时间通常很慢，因为大量程序集被加载，其中一些（至少是一些类）被即时编译。

这是 .NET 中的预期行为。实际运行时性能要好得多。通过预编译 IronPython 程序集并将副本放入 GAC：您机器的全局程序集缓存，甚至可以提高启动性能。这可以使用[`gacutil.exe`](http://msdn.microsoft.com/en-us/library/ex0ss12c(VS.80).aspx).

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T18:24:33.433

您还可以预编译 IronPython 附带的标准库，以获得更好的启动性能。有一个 pyc.py 示例可以做到这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T06:15:54.027

内核数量不会对启动性能产生太大影响 :)

由于 32 位和 64 位抖动之间的性能差异，在 64 位操作系统上启动特别慢。如果您使用的是 64 位操作系统但不需要 64 位进程，请尝试以下操作：

1.  将 ipy.exe 复制到 ipy32.exe
2.  使用 Windows SDK 中的 corflags.exe 通过说“corflags /32bit+ ipy32.exe”将 ipy32.exe 标记为 32 位可执行文件。

32 位版本应该会给你更好的启动——尽管仍然远不及 CPython 启动。但这是我们正在继续努力的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T17:36:42.767

启动时间和运行性能没有直接关系。Java applet 之所以享有盛名，主要不是因为 applet 运行缓慢，而是因为它需要几分钟的运行时间才能启动。如果您正在做一个桌面应用程序，我会担心启动性能。如果您正在运行的服务器代码的运行时间始终处于正常状态，那么这不是问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-09T00:36:31.670

CodePlex 上 IronPython 代码的解释器启动时间有所改进。尽管与 CPython 相比，我仍然看到延迟，但有显着的改进。

# c++ - 在 C 中将双精度数转换为整数时处理溢出

> ID：526070
> 
> 赞同：30
> 
> 时间：2009-02-08T17:27:51.893
> 
> 标签：c++, c, casting, floating-point

今天，我注意到当我将大于最大可能整数的双精度数转换为整数时，我得到 -2147483648。同样，当我转换一个小于最小可能整数的双精度时，我也会得到 -2147483648。

是否为所有平台定义了这种行为？
检测这种下溢/溢出的最佳方法是什么？在强制转换之前放置 min 和 max int 的 if 语句是最佳解决方案吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2015-05-24T14:07:33.580

将浮点数转换为整数时，溢出会导致未定义的行为。来自 C99 规范，第*6.3.1.4 节 Real floating and integer*：

> 当实浮点类型的有限值转换为除 以外的整数类型`_Bool`时，小数部分被丢弃（即，该值被截断为 0）。如果整数部分的值不能用整数类型表示，则行为未定义。

您必须手动检查范围，但**不要使用以下代码**：

```
// DON'T use code like this!
if (my_double > INT_MAX || my_double < INT_MIN)
    printf("Overflow!"); 
```

`INT_MAX`是一个**可能没有精确浮点表示**的整数常量。与浮点数进行比较时，它可能会舍入到最接近的更高或最接近的可表示浮点值（这是实现定义的）。例如，对于 64 位整数，`INT_MAX`is`2^63 - 1`通常会四舍五入为`2^63`，因此检查本质上变为`my_double > INT_MAX + 1`。`my_double`如果equals ，这不会检测到溢出`2^63`。

例如在 Linux 上使用 gcc 4.9.1，以下程序

```
#include <math.h>
#include <stdint.h>
#include <stdio.h>

int main() {
    double  d = pow(2, 63);
    int64_t i = INT64_MAX;
    printf("%f > %lld is %s\n", d, i, d > i ? "true" : "false");
    return 0;
} 
```

印刷

```
9223372036854775808.000000 > 9223372036854775807 is false 
```

如果您事先不知道整数和双精度类型的限制和内部表示，就很难做到这一点。但是，如果您转换 from`double`到`int64_t`，例如，您可以使用精确双精度的浮点常量（假设二进制补码和 IEEE 双精度）：

```
if (!(my_double >= -9223372036854775808.0   // -2^63
   && my_double <   9223372036854775808.0)  // 2^63
) {
    // Handle overflow.
} 
```

该构造`!(A && B)`还可以正确处理 NaN。s 的一个可移植、安全但略微不准确`int`的版本是：

```
if (!(my_double > INT_MIN && my_double < INT_MAX)) {
    // Handle overflow.
} 
```

这在谨慎方面犯了错误，并且会错误地拒绝等于`INT_MIN`或的值`INT_MAX`。但是对于大多数应用程序来说，这应该没问题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-08T17:42:41.333

`limits.h`具有整数数据类型的最大和最小可能值的常量，您可以在转换之前检查您的双变量，例如

```
if (my_double > nextafter(INT_MAX, 0) || my_double < nextafter(INT_MIN, 0))
    printf("Overflow!");
else
    my_int = (int)my_double; 
```

编辑：`nextafter()`将解决 nwellnhof 提到的问题

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-08T20:16:42.497

回答您的问题：当您抛出超出范围的浮点数时的行为是未定义的或特定于实现的。

从经验中说：我曾在一个 MIPS64 系统上工作，它根本没有实现这种类型的转换。CPU 没有做一些确定性的事情，而是抛出了一个 CPU 异常。应该模拟强制转换的异常处理程序返回而不对结果做任何事情。

我最终得到了随机整数。猜猜需要多长时间才能将错误追溯到此原因。:-)

如果您不确定数字不能超出有效范围，您最好自己检查范围。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-08T17:57:05.987

C++ 的一种可移植方式是使用 SafeInt 类：

[http://www.codeplex.com/SafeInt](http://www.codeplex.com/SafeInt)

该实现将允许对包括强制转换在内的 C++ 数字类型进行正常的加法/减法/等操作。每当检测到溢出情况时，它都会抛出异常。

```
SafeInt<int> s1 = INT_MAX;
SafeInt<int> s2 = 42;
SafeInt<int> s3 = s1 + s2;  // throws 
```

我强烈建议在溢出是重要场景的任何地方使用这个类。这使得很难避免无声地溢出。如果存在溢出恢复场景，只需捕获 SafeIntException 并根据需要进行恢复。

SafeInt 现在适用于 GCC 以及 Visual Studio

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-07-19T23:36:20.207

> 检测这种下溢/溢出的最佳方法是什么？

将截断`double`的范围与附近的*精确*`INT_MIN,INT_MAX`限制进行比较。

*诀窍*是将基于的限制准确*地*`INT_MIN,INT_MAX`转换为`double`值。A`double`可能无法准确表示`INT_MAX`，因为 an 中的位数`int` *可能*超过该浮点的精度。^(*1)在这种情况下，to 的转换`INT_MAX`会`double`受到四舍五入的影响。后面的数字`INT_MAX`是 2 的幂，当然可以表示为`double`. `2.0*(INT_MAX/2 + 1)`生成大于 的整数 1 `INT_MAX`。

这同样适用`INT_MIN`于非 2s 补码机器。

`INT_MAX`总是 2 - 1 的幂。
`INT_MIN`总是：（
`-INT_MAX` 不是 2 的补码）或
`-INT_MAX-1`（2 的补码）

```
int double_to_int(double x) {
  x = trunc(x);
  if (x >= 2.0*(INT_MAX/2 + 1)) Handle_Overflow();
  #if -INT_MAX == INT_MIN
  if (x <= 2.0*(INT_MIN/2 - 1)) Handle_Underflow();
  #else

  // Fixed 2022
  // if (x < INT_MIN) Handle_Underflow();
  if (x - INT_MIN < -1.0) Handle_Underflow();

  #endif
  return (int) x;
} 
```

* * *

检测 NaN 而不使用`trunc()`

```
#define DBL_INT_MAXP1 (2.0*(INT_MAX/2+1)) 
#define DBL_INT_MINM1 (2.0*(INT_MIN/2-1)) 

int double_to_int(double x) {
  if (x < DBL_INT_MAXP1) {
    #if -INT_MAX == INT_MIN
    if (x > DBL_INT_MINM1) {
      return (int) x;
    }
    #else
    if (ceil(x) >= INT_MIN) {
      return (int) x;
    }
    #endif 
    Handle_Underflow();
  } else if (x > 0) {
    Handle_Overflow();
  } else {
    Handle_NaN();
  }
} 
```

* * *

[编辑 2022] 6 年后更正角落错误。

`double`范围内的值`(INT_MIN - 1.0 ... INT_MIN)`（不包括端点）很好地转换为`int`. 之前的代码失败了。

* * *

^(*1)这也适用于`INT_MIN - 1`精度`int`大于 的情况`double`。尽管这种情况很少见，但这些问题很容易适用于`long long`. 考虑以下之间的区别：

```
 if (x < LLONG_MIN - 1.0) Handle_Underflow(); // Bad
  if (x - LLONG_MIN < -1.0) Handle_Underflow();// Good 
```

使用 2 的补码，`some_int_type_MIN`是 2 的（负）幂并且完全转换为 a `double`。因此`x - LLONG_MIN`在关注范围内是精确的，而`LLONG_MIN - 1.0`在减法中可能会遭受精度损失。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-08T19:01:03.783

另一种选择是使用[boost::numeric_cast](http://www.boost.org/libs/numeric/conversion/doc/html/boost_numericconversion/improved_numeric_cast__.html)，它允许在数字类型之间进行任意转换。它会在转换数字类型时检测范围丢失，如果无法保留范围则抛出异常。

上面引用的网站还提供了一个小示例，可以快速概述如何使用此模板。

当然，这不再是普通的 C 了；-)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-01-23T09:36:16.007

我们遇到同样的问题。如：

```
double d = 9223372036854775807L;
int i = (int)d; 
```

在 Linux/窗口中，i = -2147483648。但在 AIX 5.3 中 i = 2147483647。

如果双精度超出整数范围。

*   Linux/window 总是返回 INT_MIN。
*   如果双精度为正，AIX 将返回 INT_MAX，如果双精度为负，则返回 INT_MIN。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-08T17:39:38.593

我对此不确定，但我认为有可能“打开”下/溢出的浮点异常......看看这个[处理 MSVC7\8 中的浮点异常，](http://www.devx.com/cplus/Article/34993)这样你可能有一个替代方案if/else 检查。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-08T17:40:15.940

我无法确定它是否适用于所有平台，但这几乎是我使用过的每个平台上发生的情况。除了，根据我的经验，它滚动。也就是说，如果 double 的值为 INT_MAX + 2，那么当强制转换的结果最终为 INT_MIN + 2 时。

至于最好的处理方法，我真的不确定。我自己也遇到过这个问题，但还没有找到一种优雅的方式来处理它。我相信有人会做出回应，可以帮助我们俩。

# android - 没有 GUI 的 Android Activity

> ID：526074
> 
> 赞同：29
> 
> 时间：2009-02-08T17:29:48.023
> 
> 标签：android, user-interface, broadcastreceiver, android-service, intentfilter

我创建了一个仅用于从链接启动的活动（使用意图过滤器）。我不希望此活动具有 GUI - 我只希望它启动服务并在栏中放置通知。我试图将链接的意图过滤器放在我的服务中，但这不起作用。有没有更好的方法来回答意图过滤器 - 或者我可以让我的活动没有 GUI？
对不起，如果我让我感到困惑，艾萨克

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2011-06-25T08:50:16.753

呼应先前的响应，您不应该使用广播接收器。

在同样的情况下，我所做的就是这样声明主题：

```
<activity android:name="MyActivity"
          android:label="@string/app_name"
          android:theme="@android:style/Theme.NoDisplay"> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-09T06:10:14.520

您最好的选择似乎是使用`BroadcastReceiver`. 您可以创建一个新的 BroadcastReceiver 来侦听 Intent 以触发您的通知并像这样启动您的服务：

```
public class MyIntentReceiver extends BroadcastReceiver {    
  @Override 
  public void onReceive(Context _context, Intent _intent) {
    if (_intent.getAction().equals(MY_INTENT)) {
      // TODO Broadcast a notification
      _context.startService(new Intent(_context, MyService.class));
    }
  }    
} 
```

您可以直接在应用程序清单中注册此 IntentReceiver，而无需将其包含在 Activity 中：

```
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
  package="com.domain.myapplication">
  <application android:icon="@drawable/icon" android:label="@string/app_name">
    <service android:enabled="true" android:name="MyService"></service>
    <receiver android:enabled="true" android:name="MyIntentReceiver">
      <intent-filter>
        <action android:name="MY_INTENT" />
      </intent-filter>
    </receiver>
  </application>
</manifest> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-08-06T13:49:32.343

我不确定服务是否可以工作，但广播接收器肯定不会。使用 startActivity() 启动 URL。广播接收器无法对此做出响应。

[http://developer.android.com/reference/android/content/BroadcastReceiver.html](http://developer.android.com/reference/android/content/BroadcastReceiver.html)

FTA：请注意，虽然 Intent 类用于发送和接收这些广播，但这里的 Intent 广播机制与用于通过 Context.startActivity() 启动活动的 Intent 是完全分开的。BroadcastReceiver 无法查看或捕获与 startActivity() 一起使用的 Intent；同样，当你广播一个 Intent 时，你永远不会找到或启动一个 Activity。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-12-28T22:22:06.817

使用服务。我肯定工作。当您单击该程序时，它会在没有任何 GUI 的情况下完成工作。使用 pendintgintent...getService(MySerice.class ....)。然后，创建一个扩展 Service 类的新类 MyService。在 MyService.class 中，覆盖 onStart() 并做任何你想做的事情。

# scheme - 在 Scheme 中，“set！”有什么意义？

> ID：526082
> 
> 赞同：26
> 
> 时间：2009-02-08T17:36:30.350
> 
> 标签：scheme

在方案中使用`set!`赋值运算符有什么意义？为什么不只是`rebind`使用一个新值的变量`define`？

```
> (define x 100)
> (define (value-of-x) x) ;; value-of-x closes over "x"
> x
100
> (value-of-x)
100
> (set! x (+ x 1))
> x
101
> (value-of-x)
101
> (define x (+ x 1))
> x
102
> (value-of-x)
102
> 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-02-08T20:50:13.383

虽然`define`和`set!`都会在相同的范围内重新定义一个值，但当范围不同时，它们会做两件不同的事情。这是一个例子：

```
(define x 3)

(define (foo)
  (define x 4)
  x)

(define (bar)
  (set! x 4)
  x)

(foo) ; returns 4
x     ; still 3
(bar) ; returns 4
x     ; is now 4 
```

正如你所看到的，当我们创建一个新的词法作用域时（例如当我们创建`define`一个函数时），在该作用域内定义的任何名称都会掩盖出现在封闭作用域中的名称。这意味着当我们`define`d `x`to `4`in 时`foo`，我们确实为旧值创建了一个新`x`值。在`bar`, 因为`foo`在该范围内不存在，所以`set!`查找封闭范围以查找并更改 的值`x`。

另外，正如其他人所说，您只应该`define`在范围内使用一次名称。有些实现会让你摆脱多个`define`s，而有些则不会。此外，您只应该`set!`在已经`define`d 的变量上使用。同样，执行此规则的严格程度取决于实施情况。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-08T20:41:39.880

通常不允许`define`一个变量超过一次。大多数 REPL 允许在您尝试时方便，但如果您尝试在 Scheme 程序中这样做，它会给您一个错误。

例如，在 mzscheme 中，程序

```
#lang scheme
(define x 1)
(define x 2) 
```

给出错误

```
test.ss:3:8: module: duplicate definition for identifier at: x in: (define-values (x) 2) 
```

此外，`define`在其他上下文中使用时具有不同的含义。该程序

```
#lang scheme
(define x 1)
x
(let ()
  (define x 2)
  x)
x 
```

有输出

```
1
2
1 
```

这是因为`define`某些结构中的 s 实际上被视为`letrec`s。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-08T17:50:49.383

当您使用词法绑定时，您*不会* `define`：

```
(let ((x 1))
  (set! x (+ x 1))
  x) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-08T18:40:44.743

当您使用定义时，您使用新值创建一个新变量，而旧变量仍然存在旧值；它只是被新的隐藏了。在命令行上，您看不到 set! 的区别，但 define 将不能用于例如命令式程序中的循环计数器。

# data-structures - 用于实现电子表格的数据结构

> ID：526096
> 
> 赞同：11
> 
> 时间：2009-02-08T17:47:14.540
> 
> 标签：data-structures, spreadsheet

ms-excel等电子表格程序使用的数据结构是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T17:50:45.360

也许，可能是一个稀疏矩阵：

[http://en.wikipedia.org/wiki/Sparse_matrix](http://en.wikipedia.org/wiki/Sparse_matrix)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T18:17:06.787

虽然它不完全是 Excel，但 Open Office 的电子表格程序是开源的。这是一个相当大的代码库，但看一眼它可能会让您更好地理解这样的应用程序是如何实现的：

[http://contributing.openoffice.org/programming.html](http://contributing.openoffice.org/programming.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-01-13T23:27:54.357

我今天在接受采访时得到了这个问题。

他们正在寻找的答案（因为我最后问了面试官）是实现一个使用多个对象的类结构；公式、参考文献和数字。

提供的细节不多，但足以说明像谷歌文档这样的程序比看起来更有趣（编码）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T18:49:53.117

我希望它使用**很多**.

例如，用于重新计算公式的 AST（请参阅[此](https://stackoverflow.com/questions/314943/what-algorithm-does-excel-use-to-recalculate-formulas)问题）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T17:51:29.243

可能是一个多维数组。

# c++ - wxGLCanvas 退出进程

> ID：526109
> 
> 赞同：0
> 
> 时间：2009-02-08T17:55:01.467
> 
> 标签：c++, wxwidgets, wxglcanvas

我对 wx 库的 OpenGL 画布有疑问。当我使用该方法`SwapBuffers`时`wxGLCanvas`，整个过程都会以退出代码终止`1`。如果我删除方法调用，程序将继续运行。不幸的是，也没有 GL 图纸。

我认为这是 wx 库的内部问题。也许是由于一些编译问题或类似的事情。

只是想知道这个问题是否已经发生在其他人身上，以及是否，如何解决。

编辑：已解决。使用了错误的构造函数并将 NULL 引用作为 wxGLContext 传递...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T18:57:49.217

检查是否在 Canvas[创建中设置了 WX_GL_DOUBLEBUFFER？](http://docs.wxwidgets.org/2.6/wx_wxglcanvas.html). 为了验证您的 OpenGL 库等设置是否正确，构建并运行 wxWindows 下可用的 OpenGL 测试之一。我过去使用过 wxGL 层，它工作正常。大多数时候是设置问题。

# php - 重定向后超链接在Firefox中停止工作？

> ID：526114
> 
> 赞同：1
> 
> 时间：2009-02-08T17:56:45.517
> 
> 标签：php, firefox, redirect, hyperlink

在我正在进行的一个项目中，我使用 HTTP 标头在成功登录后将用户重定向到首页；

```
header("Location: http://example.com/index.php?");
exit(0); 
```

*编辑：向 url 添加问号以显示问题*

这在所有经过测试的浏览器中都可以正常工作 - 但是，在 Windows、mac 和 debian 上的 Firefox 3.0.6 中，它无法正确设置超链接。每个超链接都指向重定向指向的同一个 URL，完全忽略了“ `href`”属性。刷新页面无济于事 - 我必须手动重新输入 URL 并按 Enter 以使超链接重新开始工作。

我已经在 IE6、IE7、Opera 和 Safari 中尝试过，效果很好。我假设我实现重定向的方式有问题，有人能指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T18:57:15.757

解决方案似乎是这样的：我无法重定向到以问号结尾的 url，如果这样做，就会出现这个问题。在我看来，这不是 FF3 的预期行为，但我不知道 HTTP 规范是否足以说明是否是这种情况。

无论哪种方式，**通过从重定向 url 中删除问号解决了问题。**

# php - What is the best way to access data in a normalized database schema?

> ID：526118
> 
> 赞同：0
> 
> 时间：2009-02-08T17:59:27.057
> 
> 标签：php, sql, database, postgresql

I've got a problem that keeps coming up with normalized databases and was looking for the best solution.

Suppose I've got an album information database. I want to setup the schema in a normalized fashion, so I setup two tables - albums, which has one listing for each album, and songs, which lists all songs contained by albums.

```
albums
------
aid
name

songs
-----
aid
sid
length 
```

This setup is good for storing the data in a normalized fashion, as an album can contain any number of songs. However, accessing the data in an intuitive manner has now become a lot more difficult. A query which only grabs the information on a single album is simple, but how do you grab multiple albums at once in a single query?

Thus far, the best answer I have come up with is grouping by aid and converting the songs information as arrays. For example, the result would look something like this:

```
aid, sids,      lengths
1,   [1, 2],    [1:04, 5:45]
2,   [3, 4, 5], [3:30, 4:30, 5:30] 
```

When I want to work with the data, I have to then parse the sids and lengths, which seems a pointless exercise: I'm making the db concatenate a bunch of values just to separate them later.

My question: What is the best way to access a database with this sort of schema? Am I stuck with multiple arrays? Should I store the entirety of a song's information in an object and then those songs into a single array, instead of having multiple arrays? Or is there a way of adding an arbitrary number of columns to the resultset (sort of an infinite-join), to accommodate N number of songs? I'm open to any ideas on how to best access the data.

I'm also concerned about efficiency, as these queries will be run often.

If it makes any difference, I'm using a PostgreSQL db along with a PHP front-end.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T18:14:23.843

I have difficulty seeing your point. What exactly do you mean by "how do you grab multiple albums at once in a single query"? What exactly do you have difficulties with?

Intuitively I would say:

```
SELECT
  a.aid    album_id,
  a.name   album_name,
  s.sid    song_id,
  s.name   song_name,
  s.length song_length
FROM
  albums a
  INNER JOIN songs s ON a.aid = s.aid
WHERE
  a.aid IN (1, 2, 3) 
```

and

```
SELECT
  a.aid         album_id,
  a.name        album_name,
  COUNT(s.sid)  count_songs,
  SUM(s.length) sum_length   /* assuming you store an integer seconds value  */
FROM                         /* here, not a string containing '3:18' or such */
  albums a
  INNER JOIN songs s ON a.aid = s.aid
WHERE
  a.aid IN (1, 2, 3)
GROUP BY
  a.aid 
```

Depending on what you want to know/display. Either you query the database for aggregate information, or you calculate it yourself out of the query result #1 in your app.

Depending on how much data is cached in your app, and how long queries take the one strategy can be faster than the other. I would recommend querying the DB, though. DBs are made for this kind of stuff.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T20:01:11.013

> I see your point, but I have issues with the first query, because you end up with a lot of repeated data - the album name is repeated many times. I'm trying to have my cake and eat it, too - I want the data to be as compact as possible, but that's not realistic without aggregates.

Ah, I understand your question now. You're asking how best to micro-optimize something that's actually not very expensive for most cases. And the solution you're toying with is actually going to be significantly less efficient than the "problem" it's trying to solve.

My advice would be to join the tables and return the columns you need. For anything less than 10,000 records returned, you won't notice any significant wire time penalty for handing back that AlbumName with each Song record.

If you notice it performing slowly in the field, then optimize it. But keep in mind that a lot of smart people have spent about 50 years of research making the "join the tables & return what you need" solution fast. I doubt you'll beat it with your home-rolled string concatenation/de-concatenation strategy.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T08:45:40.520

I agree with Jason Kester insofar as I think this is unlikely to really be a performance bottleneck in practice, even if you have 10 columns with repeated data. However, if you're bent on cutting out that repeated data then I'll suggest using 2 queries:

**Query #1:**

```
SELECT sid, length     -- And whatever other per-song fields you want
FROM songs
ORDER BY aid 
```

**Query #2:**

```
SELECT aid, a.name, COUNT(*)
FROM albums a
JOIN songs s USING (aid)
GROUP BY aid, a.name
ORDER BY aid, a.name 
```

The second query enables you to break up the output of the first query into segments appropriately. Note that this will only work reliably if you can assume that no changes will be made to the table between these two queries -- otherwise you'll need a transaction with `SET TRANSACTION ISOLATION LEVEL SERIALIZABLE`.

Again, the mere fact that you're using two separate queries is likely to make this slower overall as in most cases the doubled network latency + query parsing + query planning is likely to swamp the effective increase in network throughput. But at least you won't have that nasty horrible feeling of sending repeated data... :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T18:04:54.143

The join queries will ask the database to put the tables together, matching the ids and return a single table. That way the data can be dynamically configured to the current task, something that non normalized databases cannot do.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T23:23:26.933

```
SELECT aid,GROUP_CONCAT(sid) FROM songs GROUP BY aid; 

+----+-------------------------+
|aid | GROUP_CONCAT(sid)       |
+----+-------------------------+
|  3 | 5,6,7                   |
+----+-------------------------+ 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-15T11:32:14.520

I wouldn't break your normalisation for that. Leave the tables normailsed and then use the following to query - [How to concatenate strings of a string field in a PostgreSQL 'group by' query?](https://stackoverflow.com/questions/43870/how-to-concatenate-strings-of-a-string-field-in-a-postgresql-group-by-query)

# apache-flex - 不能将 ImageSnapshot.captureBitmapData 与旋转矩阵一起使用

> ID：526119
> 
> 赞同：2
> 
> 时间：2009-02-08T18:00:00.487
> 
> 标签：apache-flex, bitmap, rotation, flex3, matrix

有没有人有使用带有旋转矩阵的 ImageSnapshot.captureBitmapData 函数的示例？这是我正在使用的代码：

```
var matrix:Matrix = new Matrix();
matrix.rotate(degreesToRadians(90));
var bitmapData:BitmapData = ImageSnapshot.captureBitmapData(textInput, matrix); 
```

但不幸的是，这会在 ImageSnapshot.as 中的以下行引发错误：

```
data = new BitmapData(scaledWidth, scaledHeight, true, 0x00000000); // <-- THROWS ERROR HERE AS scaledWidth / scaledHeight are extremely small numbers (-1-e16 etc)
            data.draw(source, matrix, colorTransform,
                      blendMode, clipRect, smoothing);
        }
        finally
        {
            if (source is IUIComponent)
                finishPrintObject(IUIComponent(source), normalState); // <-- ERROR THROWN HERE, BUT CAUSE OF ERROR IS ABOVE
        } 
```

我想要实现的是文本输入控件的旋转位图（我试图避免在应用程序中嵌入字体）。当我不旋转位图时，这段代码工作得很好，但我旋转它的那一刻，它就坏了。

**接受后的答案编辑**

我在原始问题中使用加载器类，并且我还想要文本 270 度 - 所以这是执行此操作的文本：

```
var matrix:Matrix = new Matrix();
                        matrix.rotate(Math.PI * 1.5);
                        matrix.translate(0, copyThis.width);

                        var bitmapData:BitmapData = ImageSnapshot.captureBitmapData(copyThis, new Matrix());
                        var rotatedBitmap : BitmapData = new BitmapData(bitmapData.height, bitmapData.width, false, 0xFFFF0000);

                        rotatedBitmap.draw(bitmapData, matrix);

                        loader.load(new Bitmap(rotatedBitmap)); 
```

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T19:03:10.860

我刚刚能够重现这一点，所以它确实看起来像是 ImageSnapshot 类中的错误。我能想到的只是它没有使用旋转矩阵进行测试，所以它完全被遗漏了。显然，尝试创建小于 1x1 的 bitmapData 是它引发错误的原因。老实说，无论如何似乎都无法绕过它。

认为您最好的选择可能是创建自己的简化快照类，或者仅使用单位矩阵来获取原始位图，然后将其复制到可以容纳旋转版本的新 bitmapData 中。

**编辑**

另一方面...由于闪存组件是从右上角注册的，因此您还需要将矩阵平移原始高度。虽然这可能已经解决了原来的问题，但它仍然打破。这是一个使用新 BitmapData 并转换由 ImageSnapshot 创建的解决方案

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
            import mx.graphics.ImageSnapshot;

            private function clickHandler(event : MouseEvent) : void
            {
                var matrix:Matrix = new Matrix();
                matrix.rotate(Math.PI / 2);
                matrix.translate(copyThis.height, 0);

                var bitmapData:BitmapData = ImageSnapshot.captureBitmapData(copyThis, new Matrix());
                var rotatedBitmap : BitmapData = new BitmapData(bitmapData.height, bitmapData.width, false, 0xFFFF0000);

                rotatedBitmap.draw(bitmapData, matrix);

                var g : Graphics = copyTo.graphics;

                g.clear();
                g.beginBitmapFill(rotatedBitmap);
                g.drawRect(0,0, rotatedBitmap.width, rotatedBitmap.height);
                g.endFill();
            }
        ]]>
    </mx:Script>

    <mx:VBox width="100%" height="100%" horizontalAlign="center">
        <mx:Canvas width="100%" height="100%">
            <mx:TextInput id="copyThis" text="COPY THIS"  horizontalCenter="0" verticalCenter="0"/>
        </mx:Canvas>
        <mx:Canvas id="copyTo" width="100%" height="100%" />
        <mx:Button id="copyIt" label="COPY IT" click="clickHandler(event)" />
    </mx:VBox>
</mx:Application> 
```

# python - 为什么 python 像这样订购我的字典？

> ID：526125
> 
> 赞同：42
> 
> 时间：2009-02-08T18:03:46.660
> 
> 标签：python, dictionary

这是我的字典

```
propertyList = {
    "id":           "int",
    "name":         "char(40)",

    "team":         "int",
    "realOwner":    "int",

    "x":            "int",
    "y":            "int",

    "description":  "char(255)",

    "port":         "bool",
    "secret":       "bool",
    "dead":         "bool",
    "nomadic":      "bool",

    "population":   "int",
    "slaves":       "int",
} 
```

但是当我用 "\n".join(myDict) 打印出来时，我得到了这个

```
name
nomadic
dead
port
realOwner
secret
slaves
team
y
x
population
id
description 
```

我知道字典是无序的，但每次出来的结果都是一样的，我不知道为什么。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-02-08T18:06:42.113

对于旧版本的 Python，真正的问题应该是“为什么不呢？” — 无序字典通常被实现为一个[哈希表](http://en.wikipedia.org/wiki/Hash_table)，其中元素的顺序是明确定义的，但不是很明显（[用于说明这一点的 Python 文档](https://docs.python.org/2.7/library/stdtypes.html#dict.items)）。您的观察结果完全符合哈希表的规则：明显任意，但顺序不变。

Python 已经改变了它的`dict`实现以保留插入顺序，[这在 Python 3.7中得到了*保证*](https://mail.python.org/pipermail/python-dev/2017-December/151283.html)。因此，该实现不再构成纯哈希表（但在其实现中仍*使用哈希表）。*

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-08T18:14:50.817

内置字典类型的[规范](http://docs.python.org/tutorial/datastructures.html#dictionaries)`key: value`拒绝保留任何顺序，最好将字典视为一组无序的对...

您可能需要检查[`OrderedDict`模块](http://www.xs4all.nl/~anthon/Python/ordereddict/)，它是具有键插入顺序的有序字典的实现。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-10T09:37:21.770

您可以依赖的唯一关于字典排序的事情是，如果没有对字典进行修改，则顺序将保持不变；例如，在不修改字典的情况下迭代字典两次将产生相同的键序列。然而，尽管 Python 字典的顺序是确定性的，但它可能会受到诸如插入和删除顺序等因素的影响，因此相同的字典最终可能具有不同的顺序：

```
>>> {1: 0, 2: 0}, {2: 0, 1: 0}
({1: 0, 2: 0}, {1: 0, 2: 0})
>>> {1: 0, 9: 0}, {9: 0, 1: 0}
({1: 0, 9: 0}, {9: 0, 1: 0}) 
```

# javascript - 有没有办法将值传递给 GM_xmlhttprequest？

> ID：526128
> 
> 赞同：2
> 
> 时间：2009-02-08T18:05:41.617
> 
> 标签：javascript, asynchronous, greasemonkey, gm-xmlhttprequest

如此处所示：

[如何从 GM_xmlhttprequest 返回值？](https://stackoverflow.com/questions/525243/how-can-i-return-a-value-from-gmxmlhttprequest)

我有一个异步脚本。我想将一个值传递给这个函数，以便在调用 onload 函数时可以使用它在网页中显示。

我面临的挑战是，每次我将它传递给函数时，这个值都会改变。

因此，例如，如果我传入“abc”、“def”、“xyz”。

我最终会得到

```
xyz
xyz
xyz 
```

代替

```
abc
def
xyz 
```

所以，我的问题是，我如何将一个值传递给这个函数，以便函数的每次调用都知道在完成时要显示什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T20:16:41.063

您正在寻找[关闭](https://stackoverflow.com/questions/99927/oo-javascript-definitive-explanation-of-variable-scope/101089#101089)：-

```
var urls = {"abc": "http://somehost/aurl",
           "def": "http://somehost/otherurl",
           "ghi": "http://someotherhost/aurl" }

for (var k in urls)
{

    GM_xmlhttpRequest({
        method: 'GET',
        url: urls[k],
        onload: function(text) {
            return  function(xhr) {
                //Do stuff with xhr responseText etc and the text parameter
                alert(text)
            }
        }(k)
    }
} 
```

这将在每个未完成的请求完成后提醒“abc”、“def”和“ghi”。

# linux - 使用 ALSA 查找流程听起来很快

> ID：526132
> 
> 赞同：5
> 
> 时间：2009-02-08T18:07:10.660
> 
> 标签：linux, shell, audio, posix, alsa

目前`/usr/sbin/alsa`Debian 知道使用声卡的进程的方式如下：

```
echo $( \
    lsof +D /dev -F rt \
    | awk '/^p/ {pid=$1} /^t/ {type=$1} /^r0x(74|e)..$/ && type == "tCHR" {print pid}' \
    | cut -c 2- \
    | uniq \
) 
```

这是相当丑陋的，取决于`lsof`. 我正在寻找一个没有 POSIX 解决方案`lsof`，也许使用 /proc。

```
 time for i in /proc/*/fd/*; do readlink $i | grep -q /dev/snd/pcm && echo $i | awk -F '/' '{print $3}'; done | uniq 
```

`lsof`不幸的是，似乎花费的时间是上面基于代码段的两倍。您能否让它更快，以使其成为可行的替代品？

**更新**我将以上内容改写为：

```
#!/bin/sh
for i in /proc/[0-9]*/fd/*
do
        if readlink $i | grep -q /dev/snd/pcm
        then
                IFS=/; set -- $i; unset IFS; echo $3
        fi
done 
```

但它似乎与我之前的片段具有相同的性能。我怀疑 grep 是罪魁祸首。

更新：我已经打开了关于该主题的[Debian 错误。](http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=514661)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-08T19:09:27.883

[ALSA FAQ](https://web.archive.org/web/20090201162847/http://alsa.opensrc.org/index.php/FAQ#How_can_I_find_which_processes_are_using_Alsa_devices.3F)上有这个问题的答案。在我的系统上，使用 fuser 比使用 lsof 快得多。

```
fuser -v /dev/snd/* 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T22:15:35.887

你在这里开始了很多进程。相反，您可以尝试以与您发布的 lsof 脚本类似的方式进行操作......但将 lsof 替换为 shell for 循环：

如果您想避免启动大量 grep 进程，请仅启动一个：

```
#!/bin/sh
for i in /proc/[0-9]*/fd/*
do
    echo ${i%/fd/*} $(readlink $i)
done | grep -q /dev/snd/pcm 
```

这在我的桌面上现在需要 4.5 秒，而当每个打开的文件有一个 grep 进程时需要 7.5 秒。

但是......我认为你的 grep 在这里没有必要。如果你这么在意，你可以试试：

```
#!/bin/sh
for i in /proc/[0-9]*/fd/*
do
    var="$(readlink $i)"
    if test x"$var" != x"${var#/dev/snd/pcm}"
    then
        echo $i
    fi
done 
```

这对我来说甚至更快（`test`几乎总是内置 shell），但我想这更多是因为糟糕的测试方法。自己试试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T12:59:35.927

你没有说你正在寻找什么样的时间表，而是你的替代建议

```
for i in /proc/[0-9]*/fd/*; 
```

可能会起作用并给您一些加速，就像使用`cut`而不是`awk`.

# ruby-on-rails - 添加快捷方式还是遵循 ActiveRecord 语义？

> ID：526133
> 
> 赞同：1
> 
> 时间：2009-02-08T18:07:18.743
> 
> 标签：ruby-on-rails, ruby, refactoring, associations, naming

又是和我的一个朋友争吵。考虑这段代码：

```
class User < ActiveRecord::Base
  has_many :groups
  def in_group?(group)
      groups.include?(group)
  end
end
class Group < ActiveRecord::Base
  has_many :members
  def add_user(user)
      members << user
  end
end 
```

我的观点是这些方法给代码增加了额外不必要的复杂性，而且很难猜到——比如为什么要#in_group？但不是#is_a_member_of?，或者为什么是#add_user 而不是#add_member，等等。基于我 4 年的 Rails 经验和 20 年的编程经验，我最好遵循 AR 语义并使用 User#groups.include?(group) 和 Group#members << user. 它们很容易猜到，如果我需要一些额外的功能，我可以对 has_many :members 使用回调并覆盖 User#groups.include? 如果有必要，在关联扩展模块中。

然而我的朋友认为最好使用快捷方式来创建“抽象点”，并且最好扩展此代码而不是使用回调或重载。

你怎么看？

**PS为了清楚起见，我讨厌“如果”的方法:)**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T18:35:21.370

我完全同意不应该添加这些方法。创建其他相关对象不是模型的工作。这就是关联代理的工作。我还要提防覆盖关联代理行为，因为由于代理的实现方式，您可能会看到一些奇怪的副作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T18:50:50.620

您引用的样式在“得墨忒耳法则”下是可以辩护的，该法则警告不要直接`groups`或`members`直接操作客户端代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T18:55:52.077

我绝对赞成抽象，但不赞成这种执行。你的朋友提出了一个很好的观点，如果你确定一个成员是否在一个组中的方式会发生变化怎么办？你有大量的重构工作要做​​，祝你好运！

但是，我看到了将令人困惑的函数放在错误的地方的论点。我会说您的组织不正确，为什么不将它们附加到特定的关系模型对象？

例子：

```
user.groups.in_group?("admin") 
```

或者

```
group.members.add_user(user) 
```

对我来说，这看起来更优雅，更冗长，但你的分离更相关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T18:44:00.663

For `in_group?`：您的方法名称在一个方向上是可以猜到的——当您阅读它时，它的作用非常明显。这是一种重要的可猜测性。当有人在维护这段代码时，他不会赶上`in_group?`电话。它也更具声明性和简洁性，从而提高了可读性（在这种情况下很少，但通常很好）。这是一种 Smalltalky 的方法。

另一方面，我认为这种`add_user`方法是不必要的。它似乎并不特别简洁或直接，只是不标准。这个名字仍然相当明显并且没有严重的危害，但我看不出它有什么好处。这似乎更像是一条风景优美的路线，而不是一条捷径。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T22:50:54.560

当有原因时（例如成为一个组中的“成员”改变了含义），我赞成这些方法。拥有这些方法封装了会随着时间而增长和变化的逻辑，并且确实有助于测试。这不是面向对象编程的重点吗？

# sql - 按 Max 分组

> ID：526143
> 
> 赞同：2
> 
> 时间：2009-02-08T18:13:44.127
> 
> 标签：sql, sql-server, aggregate-functions, greatest-n-per-group

```
SELECT tblIssue.SYMB, tblIssue.[PRCE], tblIssue.[Shareholder]
FROM tblIssue 
```

我正在尝试为每个 symb 的最大股东数量拉取 symb 和价格。例如，我将只有 1 行 ASN 价格为 60.62 美元。

```
SYMB价格股东
ASN $0.00 0
ASN 0.00 美元 51
ASN $25.18 0
ASN $25.26 0
ASN $36.00 0
ASN 60.62 231 美元
ASNL $0.00 101
ASR $0.00 4
ASR $0.00 24
ASR 37.17 美元 13

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T20:39:34.907

```
SELECT i1.*
FROM tblIssue i1
  LEFT OUTER JOIN tblIssue i2
  ON (i1.[SYMB] = i2.[SYMB] AND i1.[Shareholder] < i2.[Shareholder])
WHERE i2.[SYMB] IS NULL; 
```

这是我在解决这类问题时使用的一个技巧：`i1`当没有其他行`i2`具有相同`[SYMB]`和更大的`[Shareholder]`. 即，如果不存在更大的行`[Shareholder]`，则`i1`必须具有最大值。

当 的`[Shareholder]`每个不同值的最高值相同时，此查询将返回多行`[SYMB]`，但对于此线程上其他人给出的大多数其他答案也是如此。要解决此问题，您必须使用表的唯一列向联接添加另一个条件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T19:00:10.070

相关子查询似乎是最简单的（如果我理解您的问题）：

```
select symb, price, shareholder
from issue i
where price = ( select max(price) from issue where symb = i.symb) 
```

产生：

```
ASN 61 231
ASNL 0 101
ASR 37 13 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T18:35:59.417

```
WITH mx AS (
    SELECT tblIssue.SYMB, MAX(tblIssue.[Shareholder])
    FROM tblIssue
)
SELECT tblIssue.SYMB, tblIssue.[PRCE], tblIssue.[Shareholder]
FROM tblIssue
INNER JOIN mx
    ON mx.SYMB = tblIssue.SYMB
    AND mx.[Shareholder] = tblIssue.[Shareholder] 
```

这应该产生：

```
SYMB    Price   Shareholder
ASN $60.62  231
ASNL    $0.00   101
ASR $0.00   24 
```

如果这就是你要找的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T18:31:29.427

在甲骨文中：

```
SELECT symb, price
FROM (
  SELECT symb, price, ROW_NUMBER() OVER (PARTITION BY symb ORDER BY price DESC) AS rn
  FROM   tblIssue
)
WHERE rn = 1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T18:39:23.980

那会有所帮助；

```
Select * From tblIssue t2
Join 
(
Select MAX(t1.Shareholder) shrhldr, t1.symb symb
From tblIssue t1
Group by t1.symb
) tt On tt.shrhldr = t2.Shareholder and tt.symb = t2.symb 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-08T19:03:36.867

这类似于 Quassnoi 的回答，但更正以得到最大股东的行，这是 OP 所要求的。如果您有多行具有相同数量的最大股东的相同符号，它将随机给您其中之一。如果您想要所有这些，请将 ROW_NUMBER 更改为 RANK。

```
SELECT symb, price, shareholder
FROM (
  SELECT symb, price, shareholder, ROW_NUMBER() OVER (PARTITION BY symb ORDER BY shareholder DESC) AS rn
  FROM   tblIssue
)
WHERE rn = 1 
```

# sql-server - SQL Server 不只是用于报告开销吗？

> ID：526144
> 
> 赞同：1
> 
> 时间：2009-02-08T18:13:47.263
> 
> 标签：sql-server, report

我最近与一位使用 SQL Server 2005 的用户交谈，他说他们的数据库过度规范化，他们将数据复制到报表服务器。数据库不应该同时处理事务和报告吗？为什么我必须投资 2 台服务器并进行复制？

我知道这是一个开放式的主观问题，在上述情况下我没有统计数据，但是数据库调优不足以处理事务报告吗？我可以理解，对于数据挖掘场景，我们需要一个带有分析服务和反规范化的单独服务器。但是对于当年的交易呢？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T18:18:42.883

这取决于。

完全有可能在架构针对报告进行了优化的数据库中更好地处理一年甚至一个月的详细数据，或者甚至只是索引方案不同。

它还取决于报告的类型，如果您将当前月份的趋势与过去几个月进行比较，将它们放在同一个数据库中会容易得多。而且，如果您有每日移动平均线，那么在单个数据库中执行此操作要比在数据库边界上执行该操作要容易得多。

就过度标准化而言——这可能意味着很多事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T00:51:34.693

**应用程序 (OLTP) 和报告 (DW) 负载在规模**应用程序上可能并且通常非常不同。OLTP 事务一次处理少量记录，经常发生并且可能是选择、插入或更新。DW 查询倾向于处理大量记录，发生频率较低，并且应该是只读的。

在较小的应用程序或还没有数据历史的年轻应用程序上，性能不会成为问题。但是随着您的应用程序的增长和普及，将需要一个单独的数据库并最终需要一个单独的服务器来满足应用程序性能和分析报告的业务需求。

以下是这两种工作负载的概述。

OLTP 查询通常由对应用程序性能有既得利益并确切知道他们试图满足什么类型的业务功能的开发人员编写。每天多次执行相同的查询，并排除问题。以下是工作负载类型的一些示例。

*   记录销售。
*   验证密码。
*   检索产品详细信息。
*   更新用户资料。

DW 查询可以由查询工具自动生成，用于临时报告，也可以由几乎没有技术经验的分析师或业务用户直接编写。有些人可能更喜欢在他们选择的工具中选择 *，例如 SAS 或 Mathematica。如果不使用脏读来完成这些类型的查询，可能会对 OLTP 应用程序的性能造成严重破坏。即使是编写良好的查询来进行趋势分析或将大量客户分组到百分位，也可能需要全表扫描，因为它需要所有数据。可能需要回答的问题类型。

*   今天、本周、上个月卖出了多少辆自行车。
*   什么是最受欢迎的产品。
*   高利润产品在一天中的什么时间销售。
*   给我一个年度页面浏览量的趋势图。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T18:45:27.463

我认为有一个独立于生产/交易服务器的报告服务器通常是一个好主意。我已经设置了具有完全“未规范化”的数据结构的报告服务器，并且会使关系纯粹主义者畏缩......但它是一个报告服务器，所以没关系。

用户喜欢能够在没有 DBA 阻碍的情况下获取“他们的”数据（报告数据库当然是只读的）。

一组例程（或者更好的是无人值守的夜间批处理），从生产服务器中提取数据并汇总、汇总、交叉表和清理，其唯一目的是以尽可能快的方式向用户提供可用信息，通常是一个很好的解决方案。

在我的情况下，对于那些“你能为我创建一个将显示......”的报告类型的请求，绝对可以减轻我的工作量。让用户访问数据并培训他们使用工具并让他们使用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T18:32:37.380

在纯技术层面上，没有理由需要将两台服务器分开。他们可能出于“商业原因”做出决定，例如：

1.  根据报告的复杂性，它们在运行时可能会消耗大量资源。如果这会影响系统其他用户的性能，则可以将数据转储到单独的“报告”数据库服务器中。

2.  如果运行报告的人正在编写原始 SQL 但不是经验丰富的数据库开发人员，那么首先将数据转换为非规范化格式可能会很有用，以便他们更容易使用。它还可能有助于加快报告本身的性能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T18:50:48.280

这实际上取决于您的环境和应用程序。拥有单独的报告服务器是一个安全的选择。如果您的生产系统具有高度规范化的模式并且发生大量事务并引发记录锁定，那么针对此运行复杂的报告可能会产生毁灭性的性能损失。例如，如果可能由另一个开发人员构建的报表查询在复杂连接中不包含 (NOLOCK)，则几乎可以肯定会有问题。使用正确的查询（即错误的），您可以使整个数据库陷入停顿。如果报告允许用户提取大量数据，您可能也想查看它。您可能需要防止允许用户运行此类查询。仅应要求进行此类报告。恕我直言

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-08T18:54:18.350

两个数据库可能有意义。这是我自己的经验的一个例子。

数据库 1 用于收集数百万设备租赁的付款历史记录。该数据库的主要目的是从各个贷方收集数据并用作计算信用评分的输入。这个数据库很大，更新很多，从来没有暴露在网络上。

数据库 2 用于报告。小多了。从未更新。具有信用评分计算的输出。可通过网络访问。包括许多表、索引以支持按名称、地址等进行模糊搜索。

如果您认为数据库 1 有很多更新，那么一遍又一遍地更新与搜索相关的索引将是一种浪费。如果您认为数据库 1 很大，而数据库 2 很小，那么将多余的数据发送到面向网站的机器将是一种浪费。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-09T01:00:50.427

这可能是最佳解决方案，具体取决于进行报告的用户的精明程度以及他们使用的工具；如果他们必须手动加入 8 个表来获取临时客户报告，那么他们最好使用带有视图的报告服务器来为他们完成所有繁琐的工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-10T01:56:56.430

如果报告作者不了解数据结构，请为他们创建一些视图（只读）。在事务负担较低时运行资源密集型报告。有一个开发数据库以防止干扰生产。

当事情不同步并且您花费大量时间来查找问题时，总会出现一种情况。

高度理论化，但我的关系数据库教授会说，唯一的数据重复是主/外键关系或用于备份/测试目的的副本。我想听听他对数据仓库的看法。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-08T18:20:20.697

过度规范化通常意味着报告用户不了解数据模型。您可能希望远离事务数据库的那种用户。与您的事务数据库因报告用户正在执行奇特的联接而无响应相比，复制服务器是一种非常便宜的解决方案。

它主要是一种简单的组织措施，在操作用户和报告用户之间建立了界限。

# c# - 在 C# 中链接 IEnumerables？

> ID：526157
> 
> 赞同：19
> 
> 时间：2009-02-08T18:19:05.753
> 
> 标签：c#, iterator, ienumerable

有没有一种简单的内置方法来获取一个有序的`IEnumerable`s 列表并返回一个`IEnumerable`，它按顺序产生第一个中的所有元素，然后是第二个，依此类推。

我当然可以自己写，但我想知道在我做之前是否已经有办法完成这个看似有用的任务。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-08T18:22:12.130

试试 SelectMany。

```
IEnumerable<int> Collapse(IEnumerable<IEnumerable<int>> e){
 return e.SelectMany(x => x );
} 
```

此函数的目的是将一组 IEnumerable<IEnumerable<T>> 展平为一个 IEnumerable<T>。返回的数据将保留原始顺序。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-08T18:24:26.553

除了 JaredPar 的（正确）答案之外 - 还有查询语法：

```
var all = from inner in outer
          from item in inner
          select item; 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-08T18:34:54.927

除了（正确的）基于LINQ的答案......

如果您不想使用 LINQ，可以使用 yield 发明一个 ChainedEnumerable 类：

```
public class ChainedEnumerable<T> : IEnumerable<T>
{
    private readonly IEnumerable<T>[] _inners;

    public ChainedEnumerable(params IEnumerable<T>[] inners)
    {
        _inners = inners;
    }

    public IEnumerator<T> GetEnumerator()
    {
        foreach (IEnumerable<T> inner in _inners)
        {
            foreach (T t in inner)
            {
                yield return t;
            }
        }
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }
} 
```

像这样使用它：

```
List<string> a = new List<string> { "A1", "A2", "A3" };
List<string> b = new List<string> { "B1", "B2", "B3" };
ChainedEnumerable<string> chainedEnumerable =
    new ChainedEnumerable<string>(a, b);
foreach (string s in chainedEnumerable)
    Console.WriteLine(s); 
```

# javascript - 释放 Javascript 中未连接的 DOM 节点使用的内存

> ID：526167
> 
> 赞同：5
> 
> 时间：2009-02-08T18:24:34.917
> 
> 标签：javascript, memory-management

作为我的应用程序的一部分，我将一组小型 Dom 节点放在一起，这些节点不会一次全部显示出来。我将它们存储在一个内部数组中。用户可以调用他们的显示，在这种情况下，我将它们重新设置为用于显示它们的 div。这一切都很好。但是当需要用新的替换所有这些时，我想销毁旧的（有效地释放它们）。否则，随着时间的推移，内存使用量可能会呈指数增长。如何强制浏览器 js 引擎执行此操作？只是将我的 Dom 节点数组中的每个项目设置为 null 就足够了吗？我还有其他事情要做吗？或者也许我根本不必担心这个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T18:31:02.047

如果您将每个项目设置为空，它们将被自动垃圾收集。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-08T18:32:36.413

是的，将项目设置为 null 应该没问题……除了 Internet Explorer 必须注意一些实现细节：它对循环引用的处理是狡猾的。请参阅[http://msdn.microsoft.com/en-us/library/bb250448.aspx](http://msdn.microsoft.com/en-us/library/bb250448.aspx)

> 循环引用——当计算 Internet Explorer 的 COM 基础结构和任何脚本引擎之间的相互引用时，对象可能会泄漏内存

所以在某些情况下你*必须*打破循环引用。

# lisp - 在 Common Lisp 中，为什么 (if) 语句的多表达式体需要 (progn)？

> ID：526173
> 
> 赞同：15
> 
> 时间：2009-02-08T18:27:22.790
> 
> 标签：lisp, common-lisp

这只是 1950 年代遗留下来的一点历史遗留问题，还是从语法上讲，为什么 (if) 形式的多表达式主体需要 (progn)？为什么不能将多个表达式包装在一组括号中，例如 with (let)：

```
 (if some-cond
     ((exp1) (exp2) (exp3)) ; multi exp "then"
     (exp4)) ; single exp "else" 
```

编写一个宏来测试每个主体以首先查看它是否是一个列表，然后如果它是，它的第一个元素是否也是一个列表（因此不是函数调用）然后包装它的子组件似乎是微不足道的相应地在 (progn) 内。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-09T19:17:11.837

在 Common Lisp 中，这段代码：

```
(if t
    ((lambda (x) (+ x 5)) 10)
   20) 
```

将返回 15。根据您的建议，我认为它会看到 true 子句是一个列表，并自动将其转换为：

```
(if t
    (progn (lambda (x) (+ x 5)) 10)
   20) 
```

这将返回 10。对吗？

我不确定在 CL 中区分“列表”和“函数调用”是否“微不足道”。您是否打算让此更改不向后兼容？（新的有趣的 Lisp 方言总是很酷，但它不是 Common Lisp。）或者你能举个例子来说明你的想法吗？

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-08T20:46:28.777

Common Lisp 不是完美的，因为它是完美的，它是完美的，因为它是完美的。

整个语言建立在 25 个[特殊运算符](http://www.gigamonkeys.com/book/the-special-operators.html)之上； `if`是其中之一， `progn`是另一个。

`if`仅提供测试条件的基本机制，然后跳转到一个或另一个代码地址。 `progn`提供了做几件事并返回最后一个值的基本机制。

语言标准中有几个以此为基础的宏——例如`when`, `unless`, `cond`, `case`。

如果你愿意，你有几个选择来做你所设想的事情：一个，你可以写一个`ifm`宏，期望隐式`progn`s 作为 then- 和 else- 子句，或者你可以像你说的那样写它，以便它检测到意图，或者您甚至可以编写一个读取宏来为`progn`.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-08T20:16:56.193

> 从语法上讲，为什么（if）形式的多表达式体需要（progn）？

答案是“是”，尽管可能不是您所期望的原因。因为 Common Lisp（与 Scheme 和其他 Lisp 不同）需要`funcall`，所以您的建议并不含糊。即使它是模棱两可的，只要您的用户知道括号暗示`progn`在这里暗示，它就可以工作。

但是，该语言中没有其他结构*具有可选的单/双括号。很多结构都有隐含的`progn`的 s，但它们的括号语法总是相同的。

例如，每个分支`cond`都有一个隐式：`progn`

```
(cond (test1 body1) (test2 body2) ...) 
```

你不能来回切换：

```
(cond test1 exp1 (test2 body2) t exp3) 
```

因此，即使您的提议没有歧义，它也不符合该语言其余部分的语法。然而！就像你说的那样，宏实现起来很简单。你应该自己做，看看它是否运作良好。我很容易出错；我很偏颇，因为我几乎所有的 Lisping 都在 Scheme。

* 除外`case`。嗯。现在我想可能还有其他人。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-08T18:36:02.443

并非所有表达式都是列表。因为`(let ((a 42)) (if some-cond (a b c) (d e f)))`您不知道是否`(a b c)`应该将其解释为对函数的调用`a`或隐式预测。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-11T12:31:11.510

因为[IF](http://www.lispworks.com/documentation/HyperSpec/Body/s_if.htm#if)（<- HyperSpec 链接）的语法定义为：

```
if test-form then-form [else-form] => result* 
```

没有开始或结束标记。有一个 THEN-FORM 而不是 THEN-FORM*。PROGN 是一种定义表单序列的机制，其中表单从左到右执行并返回最后一个表单的值。

它可以这样定义：

```
my-if test-form (then-form*) [(else-form*)] => result*

(defmacro my-if (test then &optional else)
  (assert (and (listp then) (listp else)) (then else))
  `(if ,test (progn ,@then) (progn ,@else)))

(my-if (> (random 10) 5)
       ((print "high")
        :high)
       ((print "low")
        :low)) 
```

好吧，已经有一个支持多种形式的构造：COND。

```
(cond ((> (random 10) 5)
       (print "high")
       :high)
      (t
       (print "low")
       :low)) 
```

典型的风格是在必须尝试多个替代方案并且有多个 then/else-forms 时使用 COND。当只有一个测试并且同时存在 then 和 else 形式时，使用 IF。对于其他情况，有 WHEN 和 UNLESS。WHEN 和 UNLESS 仅支持一种或 THEN 形式（不支持 else 形式）。

我想最好有至少一个条件形式（在这种情况下是 IF ）没有额外的括号层。写作

```
(if (> (random 10) 5)
    (progn
       (print "high")
       :high)
    (progn
       (print "low")
       :low)) 
```

然后是要付出很小的代价。要么编写额外的 PROGN，要么切换到 COND 变体。如果您的代码真的可以从具有多个 then 和 else 形式的 IF 中受益，那么只需编写该宏（见上文）。Lisp 拥有它，因此您可以成为自己的语言设计师。考虑引入宏很重要：我的宏是否正确？它检查错误吗？这值得么？它可读（对其他人？）？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-08T18:33:11.763

扩展版本已经有宏。这本书真的很好：[http](http://www.gigamonkeys.com/book/) ://www.gigamonkeys.com/book/你的答案在本章中： http: [//www.gigamonkeys.com/book/macros-standard-control-constructs.html](http://www.gigamonkeys.com/book/macros-standard-control-constructs.html)

标准宏是 when 和 unless。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-03-16T03:07:23.840

请注意，在“{} 语言”（C、C++、Java ...）中，您有一个大括号中复合语句形式的 PROGN。

所以请注意这些等价/类比：

```
(if antecedent consequent alternative)
if (antecedent) consequent; else alternative;

(if antecedent (progn consequent1 consequent2) alternative)
if (antecedent) { consequent1; consequent2; } else alternative; 
```

`PROGN`运算符（及其表亲）是 Lisp 的“大括号” 。Lisp 中的括号不是它的“大括号”！

现在考虑 Perl。Perl 有一个完全支撑的`if`. 这也可以在 Lisp 中完成：

```
 (if antecedent (consequent1 consequent2 ...) (alternative1 alternative2 ...)) 
```

例如：

```
 (if (< foo 0)
   ((format t "foo is less than zero")
    (- foo))
   ((format t "foo is not less than zero")
    foo)) 
```

我认为我可以忍受这一点，但有些人会抱怨额外的括号，特别是在简单的情况下。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-08T19:15:34.797

当您没有“其他”分支时，标准宏`when`和`unless`帮助。`cond`否则，如果您在任何分支中有多个表达式，则最好使用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-08T18:55:40.627

在 Lisp 中，括号表示函数应用，而不是分组。如果`exp1`是一个返回函数的函数，你的表达式意味着什么？是否会用参数调用它`(exp2) (exp3)`？

# mysql - 使用查询从 mysql 表中获取字段的总和

> ID：526177
> 
> 赞同：0
> 
> 时间：2009-02-08T18:29:43.347
> 
> 标签：mysql

我的数据库中有下表..

```
CREATE TABLE IF NOT EXISTS `client` (
  `CARD_NO` varchar(15) NOT NULL,
  `F_NAME` varchar(20) NOT NULL,
  `L_NAME` varchar(20) NOT NULL,
  `SEX` varchar(5) NOT NULL,
  `DOB` date NOT NULL,
  `SUBCITY` varchar(10) NOT NULL,
  `KEBELE` varchar(5) NOT NULL,
  `HOUSE_NO` varchar(10) NOT NULL,
  `TEL_NO` int(10) DEFAULT NULL,
  `REGION_NO` varchar(10) DEFAULT NULL,
  PRIMARY KEY (`CARD_NO`),
  KEY `REGION_NO` (`REGION_NO`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `client`
--

INSERT INTO `client` (`CARD_NO`, `F_NAME`, `L_NAME`, `SEX`, `DOB`, `SUBCITY`, `KEBELE`, `HOUSE_NO`, `TEL_NO`, `REGION_NO`) VALUES
('1', '', '', 'male', '0000-00-00', '', '', '', NULL, '01'),
('2', '', '', 'male', '0000-00-00', '', '', '', NULL, '02'),
('3', '', '', 'femal', '0000-00-00', '', '', '', NULL, '03'),
('4', '', '', 'femal', '0000-00-00', '', '', '', NULL, '04'),
('5', '', '', 'male', '0000-00-00', '', '', '', NULL, '05'),
('6', '', '', 'male', '0000-00-00', '', '', '', NULL, '05');

-- --------------------------------------------------------

--
-- Table structure for table `non_pregnant`
--

CREATE TABLE IF NOT EXISTS `non_pregnant` (
  `VCT_CODE` varchar(15) NOT NULL,
  `CARD_NO` varchar(15) DEFAULT NULL,
  `RISK_OF_HIV` varchar(30) NOT NULL,
  `PURPOSE` varchar(10) NOT NULL,
  PRIMARY KEY (`VCT_CODE`),
  KEY `CARD_NO` (`CARD_NO`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `non_pregnant`
--

INSERT INTO `non_pregnant` (`VCT_CODE`, `CARD_NO`, `RISK_OF_HIV`, `PURPOSE`) VALUES
('1', '1', '', ''),
('2', '2', '', ''),
('3', '3', '', ''),
('4', '4', '', ''),
('5', '5', '', ''),
('6', '6', '', '');

-- --------------------------------------------------------

--
-- Table structure for table `non_pregnant_vct`
--

CREATE TABLE IF NOT EXISTS `non_pregnant_vct` (
  `VCT_CODE` varchar(15) NOT NULL DEFAULT '',
  `DATE_TESTED` date DEFAULT NULL,
  `TB_RESULT` varchar(10) NOT NULL,
  `HIV_RESULT` varchar(10) NOT NULL,
  `STD_RESULT` varchar(10) NOT NULL,
  PRIMARY KEY (`VCT_CODE`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `non_pregnant_vct`
--

INSERT INTO `non_pregnant_vct` (`VCT_CODE`, `DATE_TESTED`, `TB_RESULT`, `HIV_RESULT`, `STD_RESULT`) VALUES
('1', NULL, '', 'pos', ''),
('2', NULL, '', 'pos', ''),
('3', NULL, '', 'neg', ''),
('4', NULL, '', 'neg', ''),
('5', NULL, '', 'neg', ''),
('6', NULL, '', 'pos', '');

-- --------------------------------------------------------

--
-- Table structure for table `region`
--

CREATE TABLE IF NOT EXISTS `region` (
  `REGION_NO` varchar(10) NOT NULL,
  `REGION_NAME` varchar(10) NOT NULL,
  PRIMARY KEY (`REGION_NO`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `region`
--

INSERT INTO `region` (`REGION_NO`, `REGION_NAME`) VALUES
('01', 'washington'),
('02', 'newyork'),
('03', 'london'),
('04', 'paris'),
('05', 'burlin'); 
```

这是我想要的输出..

地区 女性 男性 总 检测 阳性 检测 阳性 检测 阳性              

这是我试图弄清楚但仍然错误的查询..

```
SELECT r.region_name, c.sex = 'male' as counting, c.sex = 'femal' as counting, v.hiv_result = 'pos' as MalePos from region r
left join client c
on c.region_no = r.region_no
left join non_pregnant p
on c.card_no = p.card_no
left join non_pregnant_vct v
on p.vct_code = v.vct_code
group by c.region_no; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T19:08:59.537

您对所需输出的描述非常不清楚，但我会试一试。尝试这个：

```
SELECT
    r.region_name,
    SUM(c.sex = 'male') as NMale,
    SUM(c.sex = 'femal') as NFemale,
    SUM(v.hiv_result = 'pos') as TotalPos,
    SUM(c.sex = 'male' AND v.hiv_result = 'pos') as MalePos,
    SUM(c.sex = 'femal' AND v.hiv_result = 'pos') as FemalePos
FROM region r
LEFT JOIN client c ON c.region_no = r.region_no
LEFT JOIN non_pregnant p ON c.card_no = p.card_no
LEFT JOIN non_pregnant_vct v ON p.vct_code = v.vct_code
GROUP BY c.region_no 
```

# django - 如何找出 request.session sessionid 并将其用作变量？

> ID：526179
> 
> 赞同：99
> 
> 时间：2009-02-08T18:31:19.520
> 
> 标签：django, session, sessionid

我知道您可以使用 获取会话变量`request.session['variable_name']`，但似乎没有办法以类似的方式将会话 ID 作为变量获取。这在任何地方都有记录吗？我找不到它。

* * *

## 回答 #1

> 赞同：163
> 
> 时间：2009-02-23T16:47:20.173

```
request.session.session_key 
```

请注意，只有存在会话、没有密钥、没有会话时，密钥才会存在。您可以使用它来测试会话是否存在。如果要创建会话，请调用 create。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-02-08T18:41:29.157

Django 会话将其密钥保存在 cookie 中。至少它的中间件是这样提取的：

```
from django.conf import settings
session_key = request.COOKIES[settings.SESSION_COOKIE_NAME] 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2013-02-02T06:47:53.880

在 Django >= 1.4 中使用：

```
request.session._session_key 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-02-01T13:14:40.660

这将为您获取会话 ID 或为您创建一个。如果你这样做`dir(request.session)`，你会得到很多有用的方法。

```
['TEST_COOKIE_NAME', 'TEST_COOKIE_VALUE', '__class__', '__contains__',
'__delattr__', '__delitem__', '__dict__', '__doc__', '__format__',
'__getattribute__', '__getitem__', '__hash__', '__init__', '__module__',
'__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__',
'__setitem__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 
'_get_new_session_key', '_get_or_create_session_key', '_get_session',
'_get_session_key', '_hash', '_session', '_session_key', 'accessed',
'clear', 'create', 'cycle_key', 'decode', 'delete', 'delete_test_cookie',
'encode', 'exists', 'flush', 'get', 'get_expire_at_browser_close',
'get_expiry_age', 'get_expiry_date', 'has_key', 'items', 'iteritems',
'iterkeys', 'itervalues', 'keys', 'load', 'modified', 'pop', 'save',
'session_key', 'set_expiry', 'set_test_cookie', 'setdefault',
'test_cookie_worked', 'update', 'values']

session_id = request.session._get_or_create_session_key() 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2016-09-25T22:42:12.017

要可靠地获取会话密钥，您需要确保首先创建了会话。[该文档](https://docs.djangoproject.com/en/dev/topics/http/sessions/#using-sessions-out-of-views)提到了一个`.create()`会话方法，可用于确保有一个会话密钥：

```
def my_view(request):
    if not request.session.session_key:
        request.session.create()

    print(request.session.session_key) 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-09T04:36:47.973

采用：

```
request.COOKIES['sessionid'] 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-06-17T09:36:45.213

在 Django 1.8 中：

> request.session.session_key

和

> request.session._session_key

两者都能正常工作。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2017-03-11T19:52:15.123

您也可以**签入您的会话**：

```
If "var" in request.session:
       Var = request.session['var']
        Return httpResponse("set")
Else:
       Return httpResponse("there isn't") 
```

# html - 优雅的 CSS 降级的 HTML/CSS 设计规划

> ID：526196
> 
> 赞同：0
> 
> 时间：2009-02-08T18:44:25.827
> 
> 标签：html, css, semantics

在我个人网站的首页上，我列出了所有文章及其发表日期。该数据将非常适合用于 HTML 表格标记。该表将仅用于显示表格数据。

我再次对其进行了研究，并且能够使用无序列表和一点 css 实现相同的布局。

所以现在我有两个版本，看起来都一样（即和ff）。我希望页面尽可能优雅地降级。

我查看没有样式表的表格页面，一切都很好地退化了。当我降级无表页面时，它看起来还可以。

但显然，表格页面的降级效果更好。

此外，在 lynx 中，表格版本看起来比无表格版本好得多。

在这种情况下，表格是否合理？

既然我有一个无表布局，我应该去吗？还是该表更适合降解目的？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-08T18:48:51.013

没什么大不了的，如果您希望它们降级为表，请使用表。这整个无表交易是关于正确的语义，而不是完全避免它们。

如果您认为您的数据属于表格，请将其放在一个表格中。

*但是，如果您使用表格进行格式化，请期待我用干草叉来追随您；）*

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T18:52:33.440

如果数据是表格，则使用表格。这就是他们的目的。

整个“没有表格”的事情更多地是为了避免表格，而不是显示表格，例如页面的整个布局。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T18:52:54.500

Html 表格用于.. 数据表格，css 点只是不将它们用于网站布局，使用表格来显示表格数据很好（并且预期）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T21:03:00.163

正如已经提到的那样，表格本身并不是邪恶的，而是糟糕的形式，让人想起 Good Old Web(r)，当时它是完成某些精美格式的唯一方法。

如今，不支持 CSS 的浏览器几乎是统计噪音。

[twiki.org](http://twiki.org/cgi-bin/view/Codev/CSS)中概述了使用和***避免***采用 CSS 方式的唯一原因（最初取自[wikipedia](http://en.wikipedia.org/w/index.php?title=Cascading_Style_Sheets&section=9#CSS_experiments)）

> 即使支持 CSS 的浏览器的可用性使 CSS 成为一种可行的技术，CSS 的采用仍然受到设计师与浏览器不正确的 CSS 实现和不完整的 CSS 支持的斗争的阻碍。即使在今天，这些问题仍然使 CSS 设计业务变得更加复杂和昂贵，并且跨浏览器测试仍然是必要的。继续不采用 CSS 的其他**原因是**：
> 
> *   它的复杂性，
> *   惯性和作者对 CSS 和所需技术的不熟悉，
> *   创作工具的支持不佳，
> *   浏览器之间的不一致和测试成本增加带来的风险，
> *   即使对于古代不支持 CSS 的浏览器的用户，也不太频繁地要求提供一致的外观。

大多数（如果不是全部）这些点已经成为过去。如今，它的优势远远超过了它所感知的问题。

除非您希望很多`links`朋友浏览您的网站并*希望*看到基于表格的布局——我个人不这样做，而且我经常使用`links`；）——**然后**选择表格。

# html - 在网页上呈现表格数据，以便用户直接将其复制到 Excel 中

> ID：526200
> 
> 赞同：1
> 
> 时间：2009-02-08T18:45:59.537
> 
> 标签：html, excel, html-table

在我的网页上，我希望能够呈现表格数据并让用户可以将其直接复制到 Excel 中。然而这不起作用，所有数据都粘贴在一个单元格中：

```
<table>
<tr><td>Column 1</td><td>Column 2</td></tr>
<tr><td>Data 1.1</td><td>Data 2.1</td></tr>
<tr><td>Data 1.2</td><td>Data 2.2</td></tr>
</table> 
```

如何呈现这些数据，以便可以将其直接复制到 Excel 中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T18:48:15.710

我只是在输入问题时想到了解决方案。您需要指定表体：

```
<table>
<tbody>
<tr><td>Column 1</td><td>Column 2</td></tr>
<tr><td>Data 1.1</td><td>Data 2.1</td></tr>
<tr><td>Data 1.2</td><td>Data 2.2</td></tr>
</tbody>
</table> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T11:05:49.083

这适用于 IE，但不幸的是其他浏览器（以下是 Firefox）需要一些用户的努力：

*   在 Excel 中选择“选择性粘贴”“文本”，尽管当单元格为空时列对齐会被搞砸
*   使用[Table2Clipboard](http://dafizilla.sourceforge.net/table2clip/)扩展

顺便说一句，列标题当然应该在 a`<thead>`内：

```
<table>

<thead>

<tr>
<th scope="col">Column 1</th>
<th scope="col">Column 2</th>
</tr>

</thead>

<tbody>

<tr>
<td>Data 1.1</td>
<td>Data 2.1</td>
</tr>

<tr>
<td>Data 1.2</td>
<td>Data 2.2</td>
</tr>

</tbody>

</table> 
```

# scripting - 如何在 C# 应用程序中嵌入 IronPython 以编写游戏脚本？

> ID：526201
> 
> 赞同：1
> 
> 时间：2009-02-08T18:46:46.120
> 
> 标签：scripting, c#-3.0, ironpython

我目前正在将我的小型太空游戏项目从 Delphi 2007 Win32 移植到 C#（和 XNA）。在 Delphi 中，我使用了 RemObjects 开源脚本解决方案“PascalScript”。

现在我继续使用 C# 开发游戏，我想使用 IronPython 来编写脚本。

唯一的问题是，我不知道如何实现这一点。如果你们中的一些人能给我一些建议，我会很高兴。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T19:03:24.870

如果你只是想看看它是如何实现的......

[这是](http://www.codeproject.com/KB/dotnet/Call_ironpython__in_C_.aspx)一个例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T20:02:45.323

[C# 4.0](http://channel9.msdn.com/pdc2008/TL16/)中的 DLR将为以编程方式调用 Python 代码提供本机支持；因此，您在 2010 年之前可以尝试的任何事情充其量都是骇人听闻的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T18:41:14.847

这是一个更好的例子（VS 2008 中的 C#）

**使用 IronPython 扩展您的 C# 应用程序**

[http://blogs.microsoft.co.il/blogs/berniea/archive/2008/12/04/extending-your-c-application-with-ironpython.aspx](http://blogs.microsoft.co.il/blogs/berniea/archive/2008/12/04/extending-your-c-application-with-ironpython.aspx)

# ruby - JRuby/Windows 和（本机）扩展如何区分它们？

> ID：526205
> 
> 赞同：3
> 
> 时间：2009-02-08T18:49:12.307
> 
> 标签：ruby, rubygems, jruby

我曾尝试将 EventMachine 等与 JRuby 一起使用。我收到有关本机扩展的错误。我相信这是由于 Java 的限制。我认为我在 Windows 上的事实使问题进一步复杂化。一些澄清将不胜感激。哪些扩展可以/不能与 JRuby 一起使用？我怎么知道？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T21:36:08.283

不幸的是，JRuby 不支持本地扩展，因为它们依赖于特定于 C 实现的特定内存和运行时细节。
通常你可以在 JVM 上找到一个等效的库，它可以很好地替代......

要完成[LDomagala 的回答](https://stackoverflow.com/questions/526205#526401)，您还可以参考与同一“本机扩展”问题相关的**[此线程](http://rubyforge.org/pipermail/tmail-talk/2008-June/000068.html)**

某些安装脚本可能依赖于`RUBY_PLATFORM` 根据您的操作系统确定是否构建本机扩展。如果您在 Windows 上，则不会构建它们。

避免本机编译的另一种方法是使用 ENV var ' `NORUBYEXT`'。

但这仍然可能需要对 ruby​​ 安装脚本进行一些调整......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T21:08:08.473

在 jruby 中使用本机扩展并没有真正简单的方法。本机扩展正在调用无法在 jruby 中调用的 c 代码，而无需在 java 中实现它。除此之外，一些扩展正在查看 jruby 端口，例如您提到的 EventMachine。

据我所知，查看是否可以将 gem/extension 与 jruby 一起使用的唯一方法是阅读文档、尝试或阅读源代码

# visual-studio-2008 - 如何在 Visual Studio 2008 中对 F# 代码进行单元测试？

> ID：526228
> 
> 赞同：4
> 
> 时间：2009-02-08T19:02:28.413
> 
> 标签：visual-studio-2008, unit-testing, f#, visual-studio-2008-sp1

我是 F# 新手，我打算创建新的 F# 项目，并在 Visual Studio 2008 中使用 F# 对其进行单元测试，但 Visual Studio 2008 单元测试向导没有 F# 测试项目选项（只有 C、C# 和VB 选项）。

1.  是否可以对 F# 进行单元测试？
2.  是否可以使用 F# 测试项目对 F# 进行单元测试？
3.  是否可以在 Visual Studio 2008 中使用 F# 测试项目对 F# 进行单元测试？
4.  如果 Visual Studio 2008 中没有向导，该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T20:17:20.297

我发现这篇关于 f# testing with nunit 的文章（链接[在这里](http://dcooney.com/ViewEntry.aspx?ID=453)）。然而，我确实记得还有另一种方法可以验证函数式语言代码的有效性（我使用 Clean '工作'，这类似于我的单身汉的 Haskell）。只是不记得他们叫什么，我记得它更像是一个数学证明。另外，我不确定它是否适用于 F#，因为如果我没看错的话，它与 Haskell'esque 语言有点不同。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T21:03:27.893

1.  如果您正在生成 .NET 代码，则可以使用 nunit 对 F# 进行单元测试，只要该接口合理地兼容 CLI。
2.  Nunit 适用于 .NET 程序集，而不适用于任何特定语言。如果您可以将 [TestFixture] 属性放在一个类上，并且可以将 [Test] 属性放在特定类中的公共方法上，这会返回 void，那么 NUnit 可以运行它。
3.  不知道。
4.  不知道。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-09T18:43:30.437

[此链接](http://bloggemdano.blogspot.com/2008/11/using-mstest-with-f.html)描述了使用带有 F# 的 VS 测试系统。您的操作方式与使用 C# 几乎相同。

缺点是 VS IDE 显然不会自动选择它——我相信你需要使用[mstest.exe](http://msdn.microsoft.com/en-us/library/ms182490(VS.80).aspx)从命令行运行。

编辑：哦，F# 的另一个很酷的东西是[FsCheck](http://www.codeplex.com/fscheck)。这允许您编写简单的测试，并让 FsCheck 系统尝试通过随机测试来反驳它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-08T20:32:55.657

没有什么强迫您使用 F# 来测试 F#。您可以简单地使用 C#、VB 或其他 .NET 支持的语言创建单元测试程序集，并简单地引用执行测试所需的 F# 程序集。您可以像为任何其他 .NET 程序集创建单元测试一样执行此操作。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-12T13:10:04.010

我不确定这是否与您的确切问题严格相关，但 Matthew Podwysocki 的博客上有一系列关于函数式语言单元测试的帖子——其中也有一些 F# 位。

*   [第 1 部分](http://codebetter.com/blogs/matthew.podwysocki/archive/2008/12/05/functional-programming-unit-testing.aspx)- xUnit 框架 - HUnit
*   [第 2 部分](http://codebetter.com/blogs/matthew.podwysocki/archive/2008/12/11/functional-programming-unit-testing-part-2.aspx)- 基于属性的测试 - QuickCheck
*   [第 3 部分](http://codebetter.com/blogs/matthew.podwysocki/archive/2008/12/15/functional-programming-unit-testing-part-3.aspx)- QuickCheck + xUnit 一起测试
*   [第 4 部分](http://codebetter.com/blogs/matthew.podwysocki/archive/2008/12/21/functional-programming-unit-testing-part-4.aspx)- 代码覆盖率
*   [第 5 部分](http://codebetter.com/blogs/matthew.podwysocki/archive/2009/01/02/functional-programming-unit-testing-part-5.aspx)– 保持纯净
*   [第 6 部分](http://codebetter.com/blogs/matthew.podwysocki/archive/2009/01/10/functional-programming-unit-testing-part-6.aspx)– 单子抽象
*   [旁白](http://codebetter.com/blogs/matthew.podwysocki/archive/2009/01/20/functional-programming-unit-testing-using-type-classes.aspx)——使用类型类
*   [第 7 部分](http://codebetter.com/blogs/matthew.podwysocki/archive/2009/01/29/functional-programming-unit-testing-part-7.aspx)- 改进您的代码库

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-08T19:10:45.073

您是在问是否可以在 F# 中进行单元测试，还是在问是否有针对它的向导？可以用任何语言进行单元测试，事实上，函数式语言是单元测试人员的梦想（我听说它是​​这样描述的。）因为一切都是静态的，并且您已经验证了所有边缘案例，您基本上已经验证了每个案例。

编辑：要回答第四个问题，请编写您自己的测试用例：

[http://en.wikipedia.org/wiki/Unit_testing](http://en.wikipedia.org/wiki/Unit_testing)

# c - 计算浮点数据类型的范围

> ID：526229
> 
> 赞同：5
> 
> 时间：2009-02-08T19:02:33.857
> 
> 标签：c

是否可以在不读取 float.h 和使用 ANSI C 的情况下以可移植的方式计算 float、double 和 long double 数据类型的范围？便携式，我的意思是包括目标机器不符合 IEEE 754 标准的情况。

我正在阅读 K&R 书，练习 2-1 要求我“计算”它们，所以我想这意味着完全避免包含 FLT_MIN、FLT_MAX、DBL_MIN 和 DBL_MAX 的 float.h（直接读取这些值肯定不会归类为“计算”）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-08T22:30:40.757

可以（至少对于 IEEE 754`float`和`double`值）通过（伪代码）计算最大浮点值：

```
~(-1.0) | 0.5 
```

在我们进行位旋转之前，我们必须将浮点值转换为整数，然后再转换回来。这可以通过以下方式完成：

```
uint64_t m_one, half;
double max;

*(double *)(void *)&m_one = -1.0;
*(double *)(void *)&half = 0.5;
*(uint64_t *)(void *)&max = ~m_one | half; 
```

那么它是怎样工作的？为此，我们必须知道如何对浮点值进行编码。

最高位编码符号，接下来的`k`位编码指数，最低位将保存小数部分。对于 的幂`2`，小数部分是`0`。

指数将以 的偏差（偏移量）存储`2**(k-1) - 1`，这意味着 的指数`0`对应于除了最高位设置之外的所有模式。

有两种具有特殊含义的指数位模式：

*   如果未设置任何位，则`0`如果小数部分为零，则值为；否则，该值是次正规的
*   如果设置了所有位，则该值为`infinity`要么`NaN`

这意味着最大的正则指数将通过设置除最低位之外的所有位进行编码，最低位对应于`2**k - 2`或`2**(k-1) - 1`减去偏差的值。

对于`double`值，`k = 11`即最高指数将是`1023`，因此最大浮点值的顺序`2**1023`约为`1E+308`。

最大的价值将有

*   符号位设置为`0`
*   除了最低指数位之外的所有位都设置为`1`
*   所有小数位设置为`1`

现在，可以理解我们的幻数是如何工作的：

*   `-1.0`设置了符号位，指数是偏差 - 即除了最高位之外的所有位都存在 - 小数部分是`0`
*   `~(-1.0)`只有最高指数位和所有小数位设置
*   `0.5`有一个符号位和小数部分`0`；指数将是偏差减号`1`，即除了最高和最低指数位之外的所有位都将出现

当我们通过逻辑或组合这两个值时，我们将得到我们想要的位模式。

* * *

计算也适用于 x86 80 位扩展精度值（aka `long double`），但位旋转必须按字节完成，因为没有足够大的整数类型来保存 32 位硬件上的值。

偏差实际上并不需要`2**(k-1) - 1`- 只要它是奇怪的，它就会适用于任意偏差。偏差必须是奇数，否则 和 的指数的位模式`1.0`在`0.5`最低位以外的其他地方会有所不同。

如果`b`浮点类型的基数（又名基数）不是`2`，则必须使用`b**(-1)`代替`0.5 = 2**(-1)`。

如果最大指数值不是 reservedrd，请使用`1.0`代替`0.5`。无论基数或偏差如何，这都将起作用（这意味着它不再限于奇数值）。使用的不同`1.0`是不会清除最低指数位。

* * *

总结一下：

```
~(-1.0) | 0.5 
```

只要基数为`2`，偏差为奇数且保留最高指数即可。

```
~(-1.0) | 1.0 
```

只要不保留最高指数，它就适用于任何基数或偏差。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T19:08:11.863

对于 99.99% 的应用程序，您应该假设 IEEE 754 并使用`<float.h>`. 在另外 0.01% 中，您将使用非常专业的硬件，在这种情况下，您应该知道根据硬件使用什么。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-09T05:51:12.833

冒着多余答案的风险：

不，没有可移植的方法来计算范围。这`<float.h>`就是提供标头的原因——因为没有一种可移植的方式来获取其中包含的信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T19:07:23.347

您可以尝试使浮动更大，直到它溢出。

# asp.net - ASP.NET 成员资格 - 用户超时时间早于预期

> ID：526233
> 
> 赞同：1
> 
> 时间：2009-02-08T19:06:22.913
> 
> 标签：asp.net, asp.net-membership

除了没有使用 web.config 中的超时设置之外，还有其他原因吗？它可能是 30 分钟的默认超时，但绝对小于 30 分钟。

```
 <authentication mode="Forms">
        <forms timeout="50000000" loginUrl="content/login.aspx"/>
    </authentication> 
```

对于我的 Login.aspx 页面上的代码：

```
 protected void LoginButton_Click(object sender, EventArgs e)
{
    if (Membership.ValidateUser(UserName.Text, Password.Text))
    {
        FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked);
    }
    else
    {
        FailureText.Text = "<br/>Login Failed. Please try again";
    }

} 
```

[编辑]

我相信超时发生在大约 10 分钟的空闲时间..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T19:47:41.600

ASP.NET 身份验证超时可以在 web.config 文件中设置（如您在问题中所示），但是，这也可以在代码中设置。您的 C# 代码中是否有任何明确设置表单超时值的区域？如果是这样，代码中的设置将覆盖 web.config 设置。

另一种可能性是使用代码生成的表单身份验证 cookie。这通常是在 C# 代码中完成的，类似以下内容：

```
FormsAuthenticationTicket ticket = new FormsAuthenticationTicket(
                                                            name,
                                                            isPersistent,
                                                            expirationTime); 
```

如果您创建一个超时设置为（例如）60 分钟的特定 FormsAuthenticationTicket，而您的 web.config 设置指示 30 分钟，则从代码中设置的票证将覆盖 web.config 设置。

请注意，ASP.NET 会话和 IIS 会话超时值对您的表单身份验证超时没有影响。

当然，作为最后一种可能性，由于表单身份验证通常基于客户端 cookie，因此用户可能正在清除/删除 cookie。这当然会导致用户无法通过您的网站进行身份验证。

还请查看Scott Forsyth 在 weblogs.asp.net 网站上的[这篇文章，其中详细介绍了这些问题。](http://weblogs.asp.net/owscott/archive/2006/07/15/forms-authentication-timeout.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T19:15:16.233

可能与会话超时有关，您可以在 web.config 中更改用户会话的超时，在 system.web 部分内添加：

```
<sessionState timeout="x minutes" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T22:17:05.957

这篇文章或相关链接可能会有所帮助：

[slipExpiration=NotReally 超时=NotWhatIThinkItIs](http://www.dotnetjunkies.com/WebLog/azenker/archive/2006/10/25/151807.aspx)

# email - 如何进行合法的电子邮件活动

> ID：526235
> 
> 赞同：14
> 
> 时间：2009-02-08T19:07:28.200
> 
> 标签：email, email-spam, blacklist

我们正在开展一个项目，该项目要求我们允许用户注册以接收某些事件的电子邮件通知。基于任何一个事件，可能会有数万或数十万封电子邮件。

我知道这在整个网络上每天都在进行，但我不知道如何管理电子邮件活动，以便当单个邮件提供商识别来自单一来源的大量邮件时，发件人不会被列为垃圾邮件发送者-- 我特别担心雅虎、MSN、AOL 等知名邮件提供商，他们可能会收到我们发送的大部分邮件。

是否有一种标准方法可用于开展用户自愿注册的合法电子邮件活动？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-08T21:01:24.467

四个步骤将显着增加您的机会：

1.  确保您的外发邮件服务器正在使用性能良好的软件（我建议使用 postfix）。行为不端的邮件软件可能会通过使服务器拒绝您的行为给您带来问题。
2.  确保您的服务器的正向和反向 DNS 匹配。许多邮件服务器会拒绝来自其他未正确配置的服务器的邮件。
3.  为您的域设置 SPF 记录并对其进行测试。
4.  为您的域设置 DomainKeys，这可能有点复杂。
5.  注册 ISP 反馈循环——（例如[Yahoo's](http://feedbackloop.yahoo.net/)）

在推出我们的一个网站时，我们的邮件服务器被 Yahoo! 限制了。因为我们发送的电子邮件量很大——所有这些都是注册通知。我们获得了如此多的新用户，以至于他们限制了我们的服务器。我们通过将该服务器的邮件队列刷新到另一台服务器来解决这个问题。在三台服务器受到限制后，我们设法将其余的邮件送达，从那以后我们一直很好。

您可能还希望考虑第三方服务，例如[CertifiedEmail](http://www.certifiedemail.net/)，它可能会花钱，但也可以确保更高的送达率。

最后，通过您的系统发送测试消息，以测试所有免费网络邮件服务、您可以找到的每个 ISP 以及您可以使用的每个邮件客户端的帐户。只有在您完成以上所有操作后，您才应该考虑发送邮件。

一旦你准备好了，我建议从一小群订阅者开始，然后再向上移动到完整列表。最好在问题很小的时候发现问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T20:33:18.760

“[垃圾邮件最佳实践](http://www.spam.org/info/Spam_Best_Practices.htm)”是一个起点，尽管大多是非技术性的。

在技​​术层面上，一个简单而重要的步骤是使用您的系统向自己发送一封测试电子邮件，并查看标头以查看是否有任何问题，例如 X-Authentication-Warning 标头。

一个即时生效的退订链接是绝对不可或缺的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T20:38:21.540

您可以阅读： [http](http://spamlinks.net/prevent-marketers.htm) ://spamlinks.net/prevent-marketers.htm和 [http://spam.abuse.net/marketerhelp/](http://spam.abuse.net/marketerhelp/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T21:36:37.627

无论您做什么，人和机器都会错误地将您的邮件分类为垃圾邮件。因此，您往往会将您的 IP 地址列入黑名单。

最好的选择是设置一些自动监控来检测您的 IP 何时被列入黑名单（将其连接到您的正常监控系统中） - 如果可能的话，您应该至少监控大多数大型公共黑名单。

如果可以的话，您还可以自动监控发送给选定第三方（Hotmail、Yahoo、Google）的邮件，以检测他们何时停止发送您的邮件——他们可能有您无法以编程方式查询的私人黑名单。

AOL 我发现这是一个特殊的问题，他们的政策几乎没有记录在案，如有更改，恕不另行通知。此外，他们的用户是业内最愚蠢的人，并且倾向于将任何内容标记为垃圾邮件。但是，他们（根据我的经验）会响应支持请求，并且如果您提出得当且合法，他们会将您的 IP 列入白名单。

如果您发现某个 IP 被列入黑名单，您可以采取措施将其删除，或暂时切换到另一个 IP（您仍然需要将原始 IP 取消列入黑名单，因为您最终可能希望重用它）。

# mysql - MySql 中的@@DBTS

> ID：526240
> 
> 赞同：1
> 
> 时间：2009-02-08T19:10:11.063
> 
> 标签：mysql, sql-server, microsoft-sync-framework

大家好，我想问一下MySql中是否有等价于@@DBTS TSQL全局变量（我需要访问整个数据库中已访问的最后一行的时间戳，而不仅仅是一个表）。

我需要这个，因为我正在尝试使用 Microsoft Sync Framework 和 MySql 进行双向同步。

任何帮助都感激不尽。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T20:15:20.583

据我所知，您可以获得的最接近的是这样的查询：

```
USE INFORMATION_SCHEMA;
SELECT MAX(UPDATE_TIME) FROM TABLES WHERE UPDATE_TIME < NOW(); 
```

`INFORMATION_SCHEMA`数据库保存了数据库中所有表的属性的几个表。使用该子句的原因`WHERE UPDATE_TIME < NOW()`是，仅通过运行该查询，您就会导致 MySQL 更新 中的一些表`INFORMATION_SCHEMA`，因此如果没有该`WHERE`子句，您将始终只获得当前时间。

显然，如果您的 MySQL 数据库真的很忙，以至于所有表基本上每秒更新一次，则此查询将不起作用，但在这种情况下，您最好尽可能多地同步，因为您知道会有修改。

# jquery - jQuery 淡入后字体在 IE 中看起来不正确

> ID：526243
> 
> 赞同：1
> 
> 时间：2009-02-08T19:11:49.923
> 
> 标签：jquery

当我将内容动态加载到 div 并淡入（或显示或幻灯片）时，字体在 IE 中看起来不是很清晰。但是，预加载内容的字体看起来还不错。

我也注意到 IE 中的 scriptaculous 会发生这种情况。

有没有人有任何想法？

火狐没有问题。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-09T06:35:14.447

这将在 v1.3 中工作：

```
$('#foo').fadeOut(function() {
  if (! $.support.opacity) {
    this.style.removeAttribute('filter');
  }
}); 
```

在早期版本中，您需要执行以下操作：

```
$('#foo').fadeOut(function() {
  if ($.browser.msie) {
    this.style.removeAttribute('filter');
  }
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T19:14:27.810

尝试在您的 div 上设置背景颜色。IE 对不透明度问题（或淡入，在这种情况下）非常奇怪，并且设置背景颜色通常有助于效果。

# c# - 如何检测应用程序是否受内存限制？

> ID：526246
> 
> 赞同：1
> 
> 时间：2009-02-08T19:14:06.283
> 
> 标签：c#, c++

如何检测应用程序是否受内存限制？是否有某种模式或工具？主要用于 C++ 和 C# 应用程序...我认为 Microsoft Visual Studio 中没有这样的工具。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T19:56:33.920

好吧，您可以使用它`perfmon`来查看应用程序在做什么。查看“.NET CLR 内存”计数器 - 有很多可用选项，例如 GC 收集（针对每一代）、GC 所花费的时间百分比、每一代的大小等。您还可以指定您只想要查看您的应用程序的数据。

如果这还不够详细，您将需要一个分析器 - 这里有许多选项，包括来自 Microsoft的免费[CLR Profiler 。](http://msdn.microsoft.com/en-us/library/ms979205.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T20:58:16.110

在大多数应用程序中，这实际上很容易检测到——即您的内存不足并且您的应用程序崩溃了。OTOH，如果您的意思是：我的应用程序是否通过分配和释放太多/太频繁来破坏内存，那么您有一个问题，探查器更擅长回答。关于使用哪个分析器的堆栈溢出问题已经提出了几个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T22:10:22.803

各种指向分析工具的指针都在目标上。但是，根据您可用的工具（和预算；-），有一些技术含量较低的方法可以快速获得提示：

1.  关闭盒子上的所有其他东西，看看性能是否有所提高。
2.  在另一个具有更多内存的机器上运行，看看性能是否有所提高。
3.  在运行之前、期间和之后监控磁盘活动并寻找峰值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T22:14:54.227

在 Linux 下，您使用[perfmon 内核补丁](http://lwn.net/Articles/303967/)提供的基于硬件的性能监控接口。它们不在主流内核中，目前有两种相互竞争的方法（LKML 需要花费大量时间来决定哪个更好），但它们都提供了对各种硬件计数器的访问。使用它们，您可以跟踪内存带宽问题、缓存问题等。这是相当低级的东西，但是当涉及到性能时，这些讨厌的问题很重要。

~~我不知道什么工具在 Windows 下提供等效功能~~我认为英特尔 VTune 可以做到这一点......他们声称有

> 强大的 Visual Studio 和 .NET 集成。快速深入到源代码以识别有问题的代码行。

并且有一个免费的评估版 - 所以你可以试一试。

# html - 通过绕过规则嵌入 Flash 对象？

> ID：526250
> 
> 赞同：0
> 
> 时间：2009-02-08T19:16:19.257
> 
> 标签：html, flash, iframe

我想将 youtube 视频嵌入到个人资料页面，但社交系统不允许嵌入 Flash 对象

现在我想知道是否有可能绕过这条规则，我首先想到的是将 iframe 嵌入到链接对象的页面中。

可悲的是，社交网络也不允许 iframe。

你有什么主意吗？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T20:38:53.130

您是否尝试过使用 javascript 来生成 flash 对象？

我使用 swfobject ( [http://blog.deconcept.com/swfobject/](http://blog.deconcept.com/swfobject/) )

## html

```
<div id="youTubVideo">
Loading You Tube Video
</div> 
```

## 脚本

```
<script type="text/javascript" src="swfobject.js>
</script>
<script type="text/javascript">
    var youTubeClip = new SWFObject("http://www.youtube.com/v/G3NueKXS6dk&hl=en&fs=1", "youTubVideo", "425", "344", "8", "#ffffff");
    youTubeClip.addParam("allowFullScreen", "true");
    youTubeClip.write("youTubVideo");
</script> 
```

# python - Python中的概率分布

> ID：526255
> 
> 赞同：21
> 
> 时间：2009-02-08T19:52:22.713
> 
> 标签：python, algorithm, random, distribution, probability

我有一堆键，每个键都有一个似然变量。我想随机选择其中一个键，但我希望不太可能（键、值）被选择而不是不太可能（更可能）的对象。我想知道您是否有任何建议，最好是我可以使用的现有 python 模块，否则我需要自己制作。

我已经检查了随机模块；它似乎没有提供这个。

我必须为 1000 组不同的对象做出数百万次这样的选择，每组包含 2,455 个对象。每个集合将相互交换对象，因此随机选择器需要是动态的。1000组2433个对象，即24.33亿个对象；低内存消耗至关重要。由于这些选择不是算法的主体，我需要这个过程非常快；CPU时间是有限的。

谢谢

更新：

好的，我试图明智地考虑您的建议，但时间是如此有限......

我查看了二叉搜索树方法，它似乎太冒险（复杂而复杂）。其他建议都类似于 ActiveState 配方。我拿了它并对其进行了一些修改，以期提高效率：

```
def windex(dict, sum, max):
    '''an attempt to make a random.choose() function that makes
    weighted choices accepts a dictionary with the item_key and
    certainty_value as a pair like:
    >>> x = [('one', 20), ('two', 2), ('three', 50)], the
    maximum certainty value (max) and the sum of all certainties.'''
    n = random.uniform(0, 1)
    sum = max*len(list)-sum 
    for key, certainty in dict.iteritems():
        weight = float(max-certainty)/sum
        if n < weight:
            break
        n = n - weight
    return key 
```

我希望通过动态保持确定性和最大确定性的总和来提高效率。欢迎任何进一步的建议。你们为我节省了很多时间和精力，同时提高了我的效率，这太疯狂了。谢谢！谢谢！谢谢！

更新2：

我决定让它一次选择更多的选择来提高它的效率。这将在我的算法中导致可接受的精度损失，因为它本质上是动态的。无论如何，这就是我现在所拥有的：

```
def weightedChoices(dict, sum, max, choices=10):
    '''an attempt to make a random.choose() function that makes
    weighted choices accepts a dictionary with the item_key and
    certainty_value as a pair like:
    >>> x = [('one', 20), ('two', 2), ('three', 50)], the
    maximum certainty value (max) and the sum of all certainties.'''
    list = [random.uniform(0, 1) for i in range(choices)]
    (n, list) = relavate(list.sort())
    keys = []
    sum = max*len(list)-sum 
    for key, certainty in dict.iteritems():
        weight = float(max-certainty)/sum
        if n < weight:
            keys.append(key)
            if list: (n, list) = relavate(list)
            else: break
        n = n - weight
    return keys
def relavate(list):
    min = list[0]
    new = [l - min for l in list[1:]]
    return (min, new) 
```

我还没试过。如果您有任何意见/建议，请不要犹豫。谢谢！

更新3：

我整天都在研究 Rex Logan 答案的任务定制版本。它实际上是一个特殊的字典类，而不是 2 个对象和权重数组；这使得事情变得相当复杂，因为 Rex 的代码会生成一个随机索引......我还编写了一个测试用例，它类似于我的算法中会发生的事情（但在我尝试之前我真的不知道！）。基本原则是：一个密钥被随机生成的次数越多，它再次生成的可能性就越小：

```
import random, time
import psyco
psyco.full()

class ProbDict():
    """
    Modified version of Rex Logans RandomObject class. The more a key is randomly
    chosen, the more unlikely it will further be randomly chosen. 
    """
    def __init__(self,keys_weights_values={}):
        self._kw=keys_weights_values
        self._keys=self._kw.keys()
        self._len=len(self._keys)
        self._findSeniors()
        self._effort = 0.15
        self._fails = 0
    def __iter__(self):
        return self.next()
    def __getitem__(self, key):
        return self._kw[key]
    def __setitem__(self, key, value):
        self.append(key, value)
    def __len__(self):
        return self._len
    def next(self):
        key=self._key()
        while key:
            yield key
            key = self._key()
    def __contains__(self, key):
        return key in self._kw
    def items(self):
        return self._kw.items()
    def pop(self, key):  
        try:
            (w, value) = self._kw.pop(key)
            self._len -=1
            if w == self._seniorW:
                self._seniors -= 1
                if not self._seniors:
                    #costly but unlikely:
                    self._findSeniors()
            return [w, value]
        except KeyError:
            return None
    def popitem(self):
        return self.pop(self._key())
    def values(self):
        values = []
        for key in self._keys:
            try:
                values.append(self._kw[key][1])
            except KeyError:
                pass
        return values
    def weights(self):
        weights = []
        for key in self._keys:
            try:
                weights.append(self._kw[key][0])
            except KeyError:
                pass
        return weights
    def keys(self, imperfect=False):
        if imperfect: return self._keys
        return self._kw.keys()
    def append(self, key, value=None):
        if key not in self._kw:
            self._len +=1
            self._kw[key] = [0, value]
            self._keys.append(key)
        else:
            self._kw[key][1]=value
    def _key(self):
        for i in range(int(self._effort*self._len)):
            ri=random.randint(0,self._len-1) #choose a random object
            rx=random.uniform(0,self._seniorW)
            rkey = self._keys[ri]
            try:
                w = self._kw[rkey][0]
                if rx >= w: # test to see if that is the value we want
                    w += 1
                    self._warnSeniors(w)
                    self._kw[rkey][0] = w
                    return rkey
            except KeyError:
                self._keys.pop(ri)
        # if you do not find one after 100 tries then just get a random one
        self._fails += 1 #for confirming effectiveness only
        for key in self._keys:
            if key in self._kw:
                w = self._kw[key][0] + 1
                self._warnSeniors(w)
                self._kw[key][0] = w
                return key
        return None
    def _findSeniors(self):
        '''this function finds the seniors, counts them and assess their age. It
        is costly but unlikely.'''
        seniorW = 0
        seniors = 0
        for w in self._kw.itervalues():
            if w >= seniorW:
                if w == seniorW:
                    seniors += 1
                else:
                    seniorsW = w
                    seniors = 1
        self._seniors = seniors
        self._seniorW = seniorW
    def _warnSeniors(self, w):
        #a weight can only be incremented...good
        if w >= self._seniorW:
            if w == self._seniorW:
                self._seniors+=1
            else:
                self._seniors = 1
                self._seniorW = w
def test():
    #test code
    iterations = 200000
    size = 2500
    nextkey = size 

    pd = ProbDict(dict([(i,[0,i]) for i in xrange(size)]))
    start = time.clock()
    for i in xrange(iterations):
        key=pd._key()
        w=pd[key][0]
        if random.randint(0,1+pd._seniorW-w):
            #the heavier the object, the more unlikely it will be removed
            pd.pop(key)
        probAppend = float(500+(size-len(pd)))/1000
        if random.uniform(0,1) < probAppend:
            nextkey+=1
            pd.append(nextkey)
    print (time.clock()-start)*1000/iterations, "msecs / iteration with", pd._fails, "failures /", iterations, "iterations"
    weights = pd.weights()
    weights.sort()
    print "avg weight:", float(sum(weights))/pd._len, max(weights), pd._seniorW, pd._seniors, len(pd), len(weights)
    print weights
test() 
```

仍然欢迎任何意见。@Darius：你的二叉树对我来说太复杂太复杂了；而且我不认为它的叶子可以有效地去除......谢谢所有

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-08T20:26:28.310

[这个 activestate 配方](http://code.activestate.com/recipes/117241/)提供了一种易于遵循的方法，特别是评论中的版本，不需要您预先规范化权重：

```
import random

def weighted_choice(items):
    """items is a list of tuples in the form (item, weight)"""
    weight_total = sum((item[1] for item in items))
    n = random.uniform(0, weight_total)
    for item, weight in items:
        if n < weight:
            return item
        n = n - weight
    return item 
```

如果您有大量项目，这将很慢。在这种情况下，二分搜索可能会更好......但编写起来也会更复杂，如果你的样本量很小，收益会很小。 如果您想遵循该路线，[这里是 python 中的二进制搜索方法的示例。](http://code.activestate.com/recipes/498229/)

（我建议在您的数据集上对这两种方法进行一些快速的性能测试。这种算法的不同方法的性能通常有点不直观。）

* * *

**编辑：**我接受了自己的建议，因为我很好奇，并做了一些测试。

我比较了四种方法：

*上面的 weighted_choice 函数。*

*像这样的二分搜索选择函数：*

```
def weighted_choice_bisect(items):
    added_weights = []
    last_sum = 0

    for item, weight in items:
        last_sum += weight
        added_weights.append(last_sum)

    return items[bisect.bisect(added_weights, random.random() * last_sum)][0] 
```

*1的编译版本：*

```
def weighted_choice_compile(items):
    """returns a function that fetches a random item from items

    items is a list of tuples in the form (item, weight)"""
    weight_total = sum((item[1] for item in items))
    def choice(uniform = random.uniform):
        n = uniform(0, weight_total)
        for item, weight in items:
            if n < weight:
                return item
            n = n - weight
        return item
    return choice 
```

*2的编译版本：*

```
def weighted_choice_bisect_compile(items):
    """Returns a function that makes a weighted random choice from items."""
    added_weights = []
    last_sum = 0

    for item, weight in items:
        last_sum += weight
        added_weights.append(last_sum)

    def choice(rnd=random.random, bis=bisect.bisect):
        return items[bis(added_weights, rnd() * last_sum)][0]
    return choice 
```

然后我建立了一个很大的选择列表，如下所示：

```
choices = [(random.choice("abcdefg"), random.uniform(0,50)) for i in xrange(2500)] 
```

还有一个过于简单的分析功能：

```
def profiler(f, n, *args, **kwargs):
    start = time.time()
    for i in xrange(n):
        f(*args, **kwargs)
    return time.time() - start 
```

**结果：**

（对函数进行 1000 次调用所需的秒数。）

*   简单未编译：0.918624162674
*   二进制未编译：1.01497793198
*   简单编译：0.287325024605
*   二进制编译：0.00327413797379

“编译”结果包括编译一次选择函数所花费的平均时间。（我计时了 1,000 次编译，然后将该时间除以 1,000，并将结果添加到选择函数时间。）

所以：如果你有一个很少改变的项目+权重列表，那么二进制编译方法是*迄今为止*最快的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-09T01:12:33.923

在对原始帖子的评论中，Nicholas Leonard 建议交换和采样都需要快速。这是该案例的一个想法；我没试过。

如果只有采样必须快速，我们可以使用一个值数组以及它们的概率的运行总和，并对运行总和进行二进制搜索（key 是一个统一的随机数） - O(log( n)) 操作。但是交换需要更新在交换条目之后出现的所有运行和值 - 一个 O(n) 操作。（你能选择只交换清单末尾附近的物品吗？我假设不会。）

因此，让我们在两个操作中都瞄准 O(log(n))。而不是数组，而是为每个要从中采样的集合保留一棵二叉树。叶子保存样本值及其（未归一化的）概率。一个分支节点保存其子节点的总概率。

采样时，生成一个`x`介于 0 和根的总概率之间的均匀随机数，然后下降树。在每个分支，如果左孩子的总概率为 ，则选择左孩子`<= x`。否则减去左孩子的概率`x`并向右走。返回您达到的叶子值。

要进行交换，请从其树中移除叶子并调整通向它的分支（降低它们的总概率，并删除任何单个子分支节点）。将叶子插入目标树：您可以选择放置它的位置，因此请保持平衡。在每个级别选择一个随机孩子可能就足够了——这就是我要开始的地方。增加每个父节点的概率，回溯到根节点。

现在采样和交换平均都是 O(log(n))。（如果您需要保证平衡，一个简单的方法是在分支节点中添加另一个字段来保存整个子树中的叶子数。添加叶子时，在每个级别选择叶子较少的孩子。这留下了一个可能性树仅因删除而变得不平衡；如果集合之间的流量相当均匀，这不会成为问题，但如果是，则在删除期间使用遍历中每个节点的叶子计数信息选择旋转。）

**更新：**根据要求，这是一个基本的实现。根本没调。用法：

```
>>> t1 = build_tree([('one', 20), ('two', 2), ('three', 50)])
>>> t1
Branch(Leaf(20, 'one'), Branch(Leaf(2, 'two'), Leaf(50, 'three')))
>>> t1.sample()
Leaf(50, 'three')
>>> t1.sample()
Leaf(20, 'one')
>>> t2 = build_tree([('four', 10), ('five', 30)])
>>> t1a, t2a = transfer(t1, t2)
>>> t1a
Branch(Leaf(20, 'one'), Leaf(2, 'two'))
>>> t2a
Branch(Leaf(10, 'four'), Branch(Leaf(30, 'five'), Leaf(50, 'three'))) 
```

代码：

```
import random

def build_tree(pairs):
    tree = Empty()
    for value, weight in pairs:
        tree = tree.add(Leaf(weight, value))
    return tree

def transfer(from_tree, to_tree):
    """Given a nonempty tree and a target, move a leaf from the former to
    the latter. Return the two updated trees."""
    leaf, from_tree1 = from_tree.extract()
    return from_tree1, to_tree.add(leaf)

class Tree:
    def add(self, leaf):
        "Return a new tree holding my leaves plus the given leaf."
        abstract
    def sample(self):
        "Pick one of my leaves at random in proportion to its weight."
        return self.sampling(random.uniform(0, self.weight))
    def extract(self):
        """Pick one of my leaves and return it along with a new tree
        holding my leaves minus that one leaf."""
        return self.extracting(random.uniform(0, self.weight))        

class Empty(Tree):
    weight = 0
    def __repr__(self):
        return 'Empty()'
    def add(self, leaf):
        return leaf
    def sampling(self, weight):
        raise Exception("You can't sample an empty tree")
    def extracting(self, weight):
        raise Exception("You can't extract from an empty tree")

class Leaf(Tree):
    def __init__(self, weight, value):
        self.weight = weight
        self.value = value
    def __repr__(self):
        return 'Leaf(%r, %r)' % (self.weight, self.value)
    def add(self, leaf):
        return Branch(self, leaf)
    def sampling(self, weight):
        return self
    def extracting(self, weight):
        return self, Empty()

def combine(left, right):
    if isinstance(left, Empty): return right
    if isinstance(right, Empty): return left
    return Branch(left, right)

class Branch(Tree):
    def __init__(self, left, right):
        self.weight = left.weight + right.weight
        self.left = left
        self.right = right
    def __repr__(self):
        return 'Branch(%r, %r)' % (self.left, self.right)
    def add(self, leaf):
        # Adding to a random branch as a clumsy way to keep an
        # approximately balanced tree.
        if random.random() < 0.5:
            return combine(self.left.add(leaf), self.right)
        return combine(self.left, self.right.add(leaf))
    def sampling(self, weight):
        if weight < self.left.weight:
            return self.left.sampling(weight)
        return self.right.sampling(weight - self.left.weight)
    def extracting(self, weight):
        if weight < self.left.weight:
            leaf, left1 = self.left.extracting(weight)
            return leaf, combine(left1, self.right)
        leaf, right1 = self.right.extracting(weight - self.left.weight)
        return leaf, combine(self.left, right1) 
```

**更新 2：**在[回答另一个问题](https://stackoverflow.com/questions/2140787/select-random-k-elements-from-a-list-whose-elements-have-weights/2149533#2149533)时，Jason Orendorff 指出二叉树可以通过像经典堆结构一样在数组中表示它们来保持完美平衡。（这也节省了在指针上花费的空间。）请参阅我对该答案的评论，了解如何使他的代码适应这个问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T20:08:31.440

你想给每个物体一个重量。权重越大，发生的可能性就越大。更准确地说 probx =weight/sum_all_weights。

然后生成一个 0 到 sum_all_weights 范围内的随机数，并将其映射到每个对象。

此代码允许您生成随机索引，并在创建对象时映射以提高速度。如果您的所有对象集具有相同的分布，那么您可以只使用一个 RandomIndex 对象。

```
import random

class RandomIndex:
    def __init__(self, wlist):
        self._wi=[]
        self._rsize=sum(wlist)-1
        self._m={}
        i=0
        s=wlist[i]
        for n in range(self._rsize+1):
            if n == s:
                i+=1
                s+=wlist[i]
            self._m[n]=i    

    def i(self):
        rn=random.randint(0,self._rsize)
        return self._m[rn]

sx=[1,2,3,4]

wx=[1,10,100,1000] #weight list
ri=RandomIndex(wx)

cnt=[0,0,0,0]

for i in range(1000):
    cnt[ri.i()] +=1  #keep track of number of times each index was generated

print(cnt) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T20:16:43.853

我会用这个[食谱](http://code.activestate.com/recipes/117241/)。您需要为对象添加权重，但这只是一个简单的比率，并将它们放在元组列表中（对象，信念/（信念总和））。使用列表推导应该很容易做到这一点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-08T20:20:31.083

[我建议你将这个加权随机的 PHP 实现](http://w-shadow.com/blog/2008/12/10/fast-weighted-random-choice-in-php/)移植到 Python。特别是，基于二分搜索的第二种算法有助于解决您的速度问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-08T20:30:14.570

这是一种经典的方法，在伪代码中，random.random() 为您提供从 0 到 1 的随机浮点数。

```
let z = sum of all the convictions
let choice = random.random() * z 
iterate through your objects:
    choice = choice - the current object's conviction
    if choice <= 0, return this object
return the last object 
```

例如：假设您有两个对象，一个重量为 2，另一个重量为 4。您生成一个从 0 到 6 的数字。如果`choice`介于 0 和 2 之间，这将以 2/6 = 1/3 的概率发生，那么它将被减去 2 并选择第一个对象。如果选择在 2 和 6 之间，这将以 4/6 = 2/3 的概率发生，那么第一个减法仍然会有 > 0 的选择，第二个减法将使第二个对象被选中。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-01-19T00:25:27.990

***大约3年后...***

如果你使用 numpy，也许最简单的选项是使用[`np.random.choice`](http://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.random.choice.html)，它接受一个可能值的列表，以及与每个值关联的可选概率序列：

```
import numpy as np

values = ('A', 'B', 'C', 'D')
weights = (0.5, 0.1, 0.2, 0.2)

print ''.join(np.random.choice(values, size=60, replace=True, p=weights))
# ACCADAACCDACDBACCADCAAAAAAADACCDCAADDDADAAACCAAACBAAADCADABA 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-08T20:01:37.323

最简单的做法是使用 random.choice（它使用均匀分布）并改变源集合中对象的出现频率。

```
>>> random.choice([1, 2, 3, 4])
4 
```

...与：

```
>>> random.choice([1, 1, 1, 1, 2, 2, 2, 3, 3, 4])
2 
```

因此，您的对象可能具有基本发生率 (n)，并且根据定罪率将 1 到 n 个对象添加到源集合中。这个方法真的很简单；但是，如果不同对象的数量很大或需要非常细粒度的定罪率，它可能会产生很大的开销。

或者，如果您使用均匀分布生成多个随机数并将它们相加，则出现在平均值附近的数字比出现在极端值附近的数字更有可能（想想掷两个骰子和得到 7 对 12 或 2 的概率）。然后，您可以按定罪率对对象进行排序，并使用多个骰子生成一个数字，用于计算和索引对象。使用接近平均值的数字来索引低信念对象和接近极端的数字来索引高信念项目。您可以通过更改“边数”和“骰子”的数量来改变选择给定对象的精确概率（将对象放入桶中并使用边数较少的骰子可能更简单，而不是试图将每个对象与特定结果相关联）：

```
>>> die = lambda sides : random.randint(1, sides)
>>> die(6)
3
>>> die(6) + die(6) + die(6)
10 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-08T20:35:52.467

一个非常简单的方法是为每个值设置权重，它不需要太多内存。

您可能可以使用哈希/字典来执行此操作。

您要做的是将随机数*x*与您想要选择的整个集合相乘和相加，然后将该结果除以集合中的对象数。

伪代码：

```
objectSet = [(object1, weight1), ..., (objectN, weightN)]
sum = 0
rand = random()
for obj, weight in objectSet
    sum = sum+weight*rand
choice = objectSet[floor(sum/objectSet.size())] 
```

*编辑*：我只是想到我的代码在非常大的集合中会有多慢（它是 O(n)）。下面的伪代码是 O(log(n))，基本上是使用二分查找。

```
objectSet = [(object1, weight1), ..., (objectN, weightN)]
sort objectSet from less to greater according to weights
choice = random() * N # where N is the number of objects in objectSet
do a binary search until you have just one answer 
```

Python 中的二进制搜索的实现遍布全网，这里不再赘述。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-09T20:31:49.490

这是特殊概率分布的更好答案，[Rex Logan 的答案](https://stackoverflow.com/questions/526255/probability-distribution-in-python/526585#526585)似乎是针对的。分布是这样的：每个对象都有一个介于 0 和 100 之间的整数权重，其概率与其权重成正比。由于这是目前公认的答案，我想这值得考虑。

所以保留一个包含 101 个 bin 的数组。每个 bin 都包含具有特定重量的所有对象的列表。每个箱子还知道其所有对象的*总*重量。

取样：按其总重量的比例随机挑选一个箱子。（为此使用标准配方之一——线性或二分搜索。）然后从垃圾箱中随机均匀地挑选一个对象。

转移对象：将其从 bin 中移除，将其放入目标的 bin 中，并更新两个 bin 的权重。（如果您使用二进制搜索进行采样，您还必须更新使用的运行总和。这仍然相当快，因为​​没有多少箱。）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-01-12T17:58:54.287

（一年后） [Walker 对不同概率的随机物体的别名方法](http://code.activestate.com/recipes/576564)非常快，非常简单

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-27T21:12:33.557

对于非非常大的数字，我需要更快的功能。所以在这里，在 Visual C++ 中：

```
#undef _DEBUG // disable linking with python25_d.dll
#include <Python.h>
#include <malloc.h>
#include <stdlib.h>

static PyObject* dieroll(PyObject *, PyObject *args)
{
    PyObject *list;
    if (!PyArg_ParseTuple(args, "O:decompress", &list))
        return NULL;

    if (!PyList_Check(list)) 
        return PyErr_Format(PyExc_TypeError, "list of numbers expected ('%s' given)", list->ob_type->tp_name), NULL;

    int size = PyList_Size(list);

    if (size < 1)
        return PyErr_Format(PyExc_TypeError, "got empty list"), NULL;

    long *array = (long*)alloca(size*sizeof(long));

    long sum = 0;
    for (int i = 0; i < size; i++) {
        PyObject *o = PyList_GetItem(list, i);

        if (!PyInt_Check(o))
            return PyErr_Format(PyExc_TypeError, "list of ints expected ('%s' found)", o->ob_type->tp_name), NULL;
        long n = PyInt_AsLong(o);
        if (n == -1 && PyErr_Occurred())
            return NULL;
        if (n < 0)
            return PyErr_Format(PyExc_TypeError, "list of positive ints expected (negative found)"), NULL;

        sum += n; //NOTE: integer overflow
        array[i] = sum;
    }

    if (sum <= 0)
        return PyErr_Format(PyExc_TypeError, "sum of numbers is not positive"), NULL;

    int r = rand() * (sum-1) / RAND_MAX; //NOTE: rand() may be too small (0x7fff).    rand() * sum may result in integer overlow.

    assert(array[size-1] == sum);
    assert(r < sum && r < array[size-1]);
    for (int i = 0; i < size; ++i)
    {
        if (r < array[i])
            return PyInt_FromLong(i);
    }
    return PyErr_Format(PyExc_TypeError, "internal error."), NULL;
}

static PyMethodDef module_methods[] = 
{
    {"dieroll", (PyCFunction)dieroll, METH_VARARGS, "random index, beased on weights" },
    {NULL}  /* Sentinel */
};

PyMODINIT_FUNC initdieroll(void) 
{
    PyObject *module = Py_InitModule3("dieroll", module_methods, "dieroll");
    if (module == NULL)
        return;
} 
```

# django - 在 Google App Engine 上运行的最佳 Django 功能？

> ID：526256
> 
> 赞同：5
> 
> 时间：2009-02-08T19:53:25.673
> 
> 标签：django, google-app-engine, frameworks

我正在开始一个关于 App Engine 的新项目，[Brandon 的建议](https://stackoverflow.com/questions/485178/architecture-guidance-for-appengine-websites/514057#514057)让我思考。

Django 的许多功能在 Google App Engine 上不起作用：~~例如管理界面和~~建模框架。

考虑到 App Engine 已经内置了一个简单的框架（“ [webapp](http://code.google.com/appengine/docs/python/tools/webapp/) ”），我可以从许多 Python 模板解决方案（包括 Django 的）中[自由选择](http://code.google.com/appengine/docs/python/gettingstarted/templates.html)，而不会将自己束缚在一个相对较重的框架（但在这种情况下是绝育的）框架中什么是如果我不使用 Django，我最想念的主要功能是什么？

背景：我只有很少的 Django 经验，我正在考虑使用[Mako](http://www.makotemplates.org/)模板（为了速度）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-08T20:33:01.397

主要区别在于您已经知道它当然不支持 Admin 和 Django 的（优秀）ORM。不过，这并不奇怪，因为 Google 自己的 Datastore API 非常出色。而且您不必学习 GQL 即可使用它。

但是使用 Django 意味着您可以利用更多现有功能（Django 中间件等），并且如果您将来想离开 Google App Engine，需要重写的代码会更少。

Google 还发布了[Google App Engine Helper for Django](http://code.google.com/p/google-app-engine-django/)，它可以帮助您设置 GAE Django 应用程序。

所以，我宁愿去使用 Django 而不是纯 webapp 的 Google App Engine 应用程序。

**根据要求编辑：** 我提到的 Django 的现有功能可以用于许多有用的应用程序，并且主要是由庞大的 DJango 社区每天开发的中间件。

除了DJango 本身提供的有用[的内置中间件之外，还有许多其他的也可以适应一些特定的用途。](http://docs.djangoproject.com/en/dev/ref/middleware/#ref-middleware)

仅举几例（这对我来说听起来很有趣）：

*   Google Analytics DJango 中间件
*   YUI Loader 作为 Django 中间件
*   Django 域重定向中间件
*   ForceHTTPS Django 中间件等...

为了有效地使用它们[，“Django 中的条件中间件执行”](http://noehr.org/post/conditional-middleware-execution-in-django/)会很方便。

搜索更多，你会发现更多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-10T16:21:14.507

似乎[管理界面](http://www.djangobook.com/en/1.0/chapter06/)正在获得[app-engine-patch](http://code.google.com/p/app-engine-patch/) 1.0beta 的支持（[链接到公告](http://groups.google.com/group/google-appengine/browse_thread/thread/f2c01c152b1e7ad2)）。

对我来说，这可能*是*Django 中最好的功能。（尽管我必须看看它在 App Engine 的无连接世界中是如何工作的。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T12:58:47.227

在撰写本文时，大部分 django 功能已在 Google Appengine Patch 项目的帮助下移植到 GAE。

主要还不是 Django 的模型支持，你必须使用 GAE db 模型。但它并没有那么痛。

只需获取[Appengine-Patch](http://code.google.com/p/app-engine-patch/)并尝试一下。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-02-13T10:56:44.850

帮自己一个忙，不要碰应用引擎。

如果或者更确切地说，当谷歌更改规则时，您在设计应用程序上投入的时间和精力将会丢失。它（AppEngine）是适当的，如果你不喜欢它，你实际上已经失去了你的投资。你不能只拿你的应用程序并在其他地方运行它。谷歌不是一个慈善机构——他们会改变规则，因为他们可以把他们的担忧放在微不足道的你之上。这是最糟糕的锁定方式...

# http - 用于分布式 HTTP 基准测试的工具？

> ID：526260
> 
> 赞同：2
> 
> 时间：2009-02-08T19:57:49.783
> 
> 标签：http, distributed, benchmarking

我想对我们公司正在开发的网站进行基准测试。它将由多个 Web 和后端服务器组成。

为了能够正确模拟大量请求，我正在考虑使用我们的开发机器（大约 15 Xp/Vista）和一些备用 Red Hat 服务器作为基准测试客户端。

是否有任何工具可以让我将这些机器设置为从机/客户端，然后控制它们执行组合基准测试并获得汇总结果？

基准测试将包括模拟普通用户登录和浏览几页。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T20:49:44.587

[Apache JMeter](http://jmeter.apache.org/)是这个领域的一个参考。您将在 JMeter 上设置为控制器，并根据可用内存和 cpu 为负载设置尽可能多的从站。

在您的情况下，最好使用非 gui 测试以获得更好的性能结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T20:04:06.147

如果你只是想模拟简单的请求，你可以使用[Apache 的`ab`](http://httpd.apache.org/docs/2.2/programs/ab.html).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T20:05:14.367

为此，我已经非常成功地使用了[磨床。](http://grinder.sourceforge.net/)

您可能还想指出，从 Intranet 到服务器所在的 DMZ，我们遇到了严重的基础设施问题，这种情况并不少见。无论我们推了多少，我们都无法通过足够的流量（有些公司可以从他们的 DMZ 和向外拥有千兆互联网连接，但指向内部的东西通常是完全不同的口径）

在一个项目中，我们最终在服务器大厅里放了几台披萨盒电脑。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-02-25T19:19:04.113

If load testing over many machines is necessary, take a look at [Tsung](http://tsung.erlang-projects.org/), a distributed load-testing tool written in Erlang. It's full-featured and will definitely scale across many machines.

# c# - ClickOnce：此计算机上未安装所需版本的 .NET Framework

> ID：526264
> 
> 赞同：3
> 
> 时间：2009-02-08T20:02:17.993
> 
> 标签：c#, .net-3.5, clickonce, vsto

我收到错误消息“此计算机上未安装所需版本的 .NET Framework。” （事件日志中的事件 ID 4096）尝试从 ClickOnce 部署和本地副本安装 VSTO 应用程序时。这很有趣，因为安装了 .NET 框架（在我的 32 位 Windows 7 PC 上）并且 VSTO 应用程序是在同一台机器上开发的（并且在 Visual Studio 2008 中工作）。

有人知道为什么我会得到这个例外吗？

> 名称：来自： [http://localhost/BlaBla.vsto](http://localhost/BlaBla.vsto)
> 
> “此计算机上未安装所需版本的 .NET Framework。”
> 
> ************** 异常文本 ************** Microsoft.VisualStudio.Tools.Applications.Deployment.InstallAddInFailedException：“所需的 .NET 版本此计算机上未安装框架。” 在 Microsoft.VisualStudio.Tools.Applications.Deployment.ClickOnceAddInDeploymentManager.InstallAddIn() 在 Microsoft.VisualStudio.Tools.Office.Runtime.SolutionInstaller.<>c__DisplayClass7.b__0()

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T21:07:10.100

在检查了明显的原因（见评论）之后，似乎将 Windows 7 作为原因。尽管很多人“切换”到 Win7，但它仍然是一个测试版。

想到几点：

*   你能检查一下 XP 或 Vista 上的 clickonce 安装吗？
*   您是否打开了自动更新？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T21:49:18.183

大家好，我正在更新我自己的一个插件并且也遇到了这个问题，所以我想我会在内部问一些朋友:-)。这里是瘦...

Win7RC .NET 分发中缺少以下文件（这是已知的并正在解决）：%ProgramFiles%\Reference Assemblies\Microsoft\Framework\v3.5\RedistList\FrameworkList.xml

将该文件从非 Win7 计算机（相同位置）复制到 Win7 框，您的发布应该可以工作。

我正在旅行，尚未验证（我附近没有非 Win7 盒子），但想为大家发布这个。

希望这可以帮助！

-th

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T20:47:13.627

可能是一个无声的询问或建议，但 ClickOnce 在 .Net 2.0 中出现了，你安装了吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T03:39:45.033

问题肯定与从 windows 7 部署有关，我是双启动 windows 7 和 server 2008，如果我从 server 2008 部署项目很好，但如果我从 windows 7 部署，它就不起作用.. 你不能在从 Windows 7 部署的任何操作系统上安装 VSTO clickonce 应用程序。臭虫。

这个错误是微软知道的，它被标记为已修复，我还没有发现它是 Windows 7 触发的 VSTO 中的错误，还是 Windows 7 本身中的错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T05:55:56.227

我不认为有修补程序，我仍在为这个问题苦苦挣扎，当我向微软的人询问这个错误时，他查找了错误数据库并找到了错误，并且它被标记为已修复，没有解决方法或版本有关问题或修复的信息。有用啊...

我们将不得不等到 RC1 发布，然后看看它是否已修复。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-11T06:42:14.210

我在 Windows 7 RC1 上并且有问题。我检查了 timheur 的解决方案，但它并没有为我解决。该文件存在于 Windows 7 RC1 中

它曾经在 Windows 7 Beta 中为我工作正常 - （很多次）在我参观了 LA 的 TechEd 2009 后它停止工作了！！但我从 BETA 升级到 RC1 大约在同一时间。

我刚刚使用 Windows 7 RC1 对我的 PC 进行了干净构建，但仍然存在问题。我可以从 Vista PC 上发布 OK 版本。

看来我的版本问题是从 Windows 7 Beta 升级到 Windows 7 RC1 引起的。

顺便说一句，当我从 Windows 7 PC 发布后从 Vista PC 发布时，发布过程告诉我发布是从不同的应用程序平台完成的。这向我证实了发布平台是问题的原因！

还有一件事……由于 Windows 7 无法正确发布 VSTO 应用程序，我决定在我的 Windows 7 机器上实现一个 Windows XP 虚拟 PC 并从那里开始。事实证明这也不起作用！生成的 Outlook 实施无法识别我的自定义任务表单区域。

我讨厌 VISTA，但似乎我必须去的地方。我会回到 Windows 7 BETA，但微软计划在本月底终止它。

我现在尝试了其他几件事......

1.  尝试在 Windows 7 RC 上将 Windows 2008 Server 安装为 VM！无法安装！

2.  尝试在 Windows 7 RC1 上安装 Virtual Server 2007。那没有用，它杀死了 Windows 7 虚拟服务器。

3.  尝试将 FrameworkList.xml 替换为 Vista 中的版本。那没有帮助。

谁能告诉我这个问题在微软内部是否有优先权？它是 Windows 7 的交易破坏者，RTM 就在不远处！！

# properties - Rhino Mocks - 当属性没有获取时验证属性集

> ID：526267
> 
> 赞同：11
> 
> 时间：2009-02-08T20:04:05.400
> 
> 标签：properties, rhino-mocks, setter

如果您有房产：

```
public class Fred
{
   public string UserName
   {
     set
     {
        userName=value;
     }
   }
} 
```

你如何使用 Rhino Mocks 来检查

```
fred= new Fred();
fred.UserName="Jim"; 
```

叫做。

```
Expect.Call(mockFred.UserName).SetPropertyWithArgument("Jim"); 
```

不编译。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-08T20:26:37.310

```
public interface IFred
{
    string UserName { set; }
}

[Test]
public void TestMethod1()
{
    IFred fred = MockRepository.GenerateMock<IFred>();
    fred.UserName = "Jim";
    fred.AssertWasCalled(x => x.UserName = "Jim");
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T20:20:02.707

您应该能够对属性集进行全部验证

```
[TestClass]
public class FredTests
{
    [TestMethod]
    public void TestFred()
    {
        var mocker = new MockRepository();
        var fredMock = mocker.DynamicMock<IFred>();

        fredMock.UserName = "Name";
        // the last call is actually to the set method of username
        LastCall.IgnoreArguments(); 
        mocker.ReplayAll();

        fredMock.UserName = "Some Test that does this.";
        mocker.VerifyAll();
    }

}

public interface IFred
{
    string UserName { set; }
} 
```

# c++ - tellp 在空 ostringstream 上的标准行为

> ID：526270
> 
> 赞同：4
> 
> 时间：2009-02-08T20:04:28.470
> 
> 标签：c++, standards-compliance, stringstream

`tellp`我对调用empty的标准行为有疑问`ostringstream`。我有一个函数 foo 调用`tellp`第一件事：

```
void foo(std::ostream& os)
{
    std::ostream::pos_type pos = os.tellp();
    // do some stuff.
}

int main()
{
    std::ostringstream os;
    foo(os);
} 
```

在 Visual Studio 2005 中，使用新创建的空函数调用此函数`ostringstream`会导致`pos`变量设置为 invalid `pos_type`，而在 Visual Studio 2005 中设置为`pos_type(_BADOFF)`。

`ofstream`没有相同的行为，其中`tellp`返回`pos_type(0)`，这是一个有效的`pos_type`。

这个标准符合行为吗？这种行为与其他编译器一致吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T23:45:00.187

27.6.2.4：

```
pos_type tellp(); 
```

> 返回：如果 fail() != false，返回 pos_type(-1) 表示失败。否则，返回 rdbuf()->pubseekoff(0, *cur* , *out* )。

pubseekoff在失败*时*返回 -1。但是我不确定为什么在*ostringstream*的情况下会发生这种情况，可能是太累了，找不到关于*undefined*或*implementation-dependent*的词。使用我的常识，我会说对于*ostringstream*这应该给 0，对于默认构造的 ostream -1，对于新打开的文件 0 的 ostream。

# filesystems - 什么是根目录？

> ID：526281
> 
> 赞同：5
> 
> 时间：2009-02-08T20:16:11.110
> 
> 标签：filesystems

我当然知道什么是根目录，但我发现很难向人们解释它是什么。我写了一个 Nintendo DS 应用程序，需要将一个文件夹复制到存储卡的根目录中，并且我经常收到将其复制到错误位置并且不明白根目录是什么的人的电子邮件。我认为他们没有意识到根目录可以被认为是一个目录或“文件夹”。

向这些人解释这一点的最佳方式是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-08T20:18:56.097

也许您可以告诉他们将其放在存储卡本身上，而不是放在任何文件夹中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T20:20:01.973

将其称为“顶级”文件夹。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T20:19:40.477

对他们来说，根目录是他们在双击存储卡图标时看到的第一个文件夹。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T20:29:40.003

使用隐喻怎么样：

您可以将文件夹结构视为树。每个文件夹都是一个带有子分支和叶子（文件）的分支。每个分支都连接到除一个之外的另一个（更大的分支）。根。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-08T22:32:56.493

你能创建一个简单的提取器/安装程序来为他们做这一切吗？可以为非技术人员节省很多麻烦。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-14T14:20:24.093

让他们把它想象成俄罗斯娃娃中的一个，其中较大的一个拥有所有剩余的娃娃，它们的大小一个接一个地减小。或者很像一棵家谱。根目录是 adam...，就像在 adam 和 eve 中一样，其余的是从树上最高的人 Adam 向外分支的后代。

# html - 如何强制浮动 DIV 匹配另一个浮动 DIV 的高度？

> ID：526294
> 
> 赞同：68
> 
> 时间：2009-02-08T20:20:22.147
> 
> 标签：html, css, height

我的 HTML 代码只是将页面分成两列，分别为 65%、35%。

```
<div style="float : left; width :65%; height:auto;background-color:#FDD017;">
   <div id="response">
   </div> 
</div>
<div style="float : left; width :35%;height:auto; background-color:#FDD017;">
   <div id="note">
   </div>
</div> 
```

在 中`response` `div`，我有可变数据；在中`note` `div`，我有固定的数据。即使这两个`div`s 有两组不同的数据，我也需要它们以相同的高度显示，以便背景颜色看起来填充包含两者的框。自然，问题在于`response` `div`，因为它的高度取决于当前显示在其中的数据量。

如何确保两列的高度始终相等？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2009-02-08T20:27:06.483

将它们包装在一个包含 div 并应用背景颜色，并在“列”之后有一个清除 div。

```
<div style="background-color: yellow;">
  <div style="float: left;width: 65%;">column a</div>
  <div style="float: right;width: 35%;">column b</div>
  <div style="clear: both;"></div>
</div> 
```

* * *

更新以解决一些评论和我自己的想法：

这种方法之所以有效，是因为它本质上是对您的问题的简化，在这个有点“oldskool”的方法中，我将两列放在后面跟着一个空的清除元素，清除元素的工作是告诉父级（有背景）这是哪里浮动行为结束，这允许父级在清除位置基本上呈现 0 像素的高度，这将是任何最高的先前浮动元素。

这样做的原因是为了确保父元素与最高的列一样高，然后在父元素上设置背景以使两列具有相同的高度。

应该注意的是，这种技术是“oldskool”，因为更好的选择是使用[clearfix](http://www.webtoolkit.info/css-clearfix.html)之类的东西或简单地在父元素上设置 overflow: hidden 来触发这种高度计算行为。

虽然这在这种有限的情况下有效，但如果您希望每列看起来不同，或者它们之间有间隙，那么在父元素上设置背景将不起作用，但是有一个技巧可以实现这种效果。

诀窍是为所有列添加底部填充，达到您期望的最大大小，这可能是最短和最高列之间的差异，如果您无法解决这个问题，那么选择一个大数字，然后您需要添加相同数字的负下边距。

您需要在父对象上隐藏溢出，但结果将是每列将请求呈现由边距建议的这个额外高度，但实际上并不请求该大小的布局（因为负边距会抵消计算）。

这将以最高列的大小呈现父级，同时允许所有列以其高度 + 使用的底部填充的大小呈现，如果此高度大于父级，则其余列将简单地剪掉。

```
<div style="overflow: hidden;">
  <div style="background: blue;float: left;width: 65%;padding-bottom: 500px;margin-bottom: -500px;">column a<br />column a</div>
  <div style="background: red;float: right;width: 35%;padding-bottom: 500px;margin-bottom: -500px;">column b</div>
</div> 
```

[您可以在bowers and wilkins 网站](http://www.bowers-wilkins.com/Speakers/Home_Audio/Nautilus/Overview.html)上看到这种技术的示例（参见页面底部的四个水平聚光灯图像）。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2011-03-08T14:52:56.763

如果您试图强制浮动 div 匹配另一个以创建列效果，这就是我所做的。我喜欢它，因为它简单而干净。

```
<div style="background-color: #CCC; width:300px; overflow:hidden; ">
    <!-- Padding-Bottom is equal to 100% of the container's size, Margin-bottom hides everything beyond
         the container equal to the container size. This allows the column to grow with the largest
         column. -->
    <div style="float: left;width: 100px; background:yellow; padding-bottom:100%; margin-bottom:-100%;">column a</div>
    <div style="float: left;width: 100px;  background:#09F;">column b<br />Line 2<br />Line 3<br />Line 4<br />Line 5</div>
    <div style="float:left; width:100px; background: yellow; padding-bottom:100%; margin-bottom:-100%;">Column C</div>
    <div style="clear: both;"></div>
</div> 
```

我认为这是有道理的。即使使用动态内容，它似乎也能很好地工作。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-08T20:33:27.200

[这是一个 jQuery 插件](http://www.filamentgroup.com/lab/setting_equal_heights_with_jquery/)，用于将多个 div 的高度设置为相同。下面是插件的实际代码。

```
$.fn.equalHeights = function(px) {
$(this).each(function(){
var currentTallest = 0;
$(this).children().each(function(i){
    if ($(this).height() > currentTallest) { currentTallest = $(this).height(); }
        });
    if (!px || !Number.prototype.pxToEm) currentTallest = currentTallest.pxToEm(); //use ems unless px is specified
        // for ie6, set height since min-height isn't supported
    if ($.browser.msie && $.browser.version == 6.0) { $(this).children().css({'height': currentTallest}); }
        $(this).children().css({'min-height': currentTallest}); 
    });
    return this;
}; 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-05-06T09:38:40.273

此问题的正确解决方案是使用`display: table-cell`

重要提示：此解决方案不需要，`float`因为`table-cell`已经将`div`转换为与同一容器中的其他元素对齐的元素。这也意味着您不必担心清除浮动、溢出、背景闪烁以及`float`黑客带来的所有其他令人讨厌的惊喜。

CSS：

```
.container {
  display: table;
}
.column {
  display: table-cell;
  width: 100px;
} 
```

HTML：

```
<div class="container">
    <div class="column">Column 1.</div>
    <div class="column">Column 2 is a bit longer.</div>
    <div class="column">Column 3 is longer with lots of text in it.</div>
</div> 
```

有关的：

*   [jsfiddle](http://jsfiddle.net/6j58h/)
*   [对列使用 CSS “display: table-cell”](http://www.senktec.com/2014/01/using-css-display-table-cell-for-columns/)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-08T20:27:07.590

您应该将它们包装在没有浮动的 div 中。

```
<div style="float:none;background:#FDD017;" class="clearfix">
    <div id="response" style="float:left; width:65%;">Response with two lines</div>
    <div id="note" style="float:left; width:35%;">single line note</div>
</div> 
```

我也在这里使用了 clearfix 补丁[http://www.webtoolkit.info/css-clearfix.html](http://www.webtoolkit.info/css-clearfix.html)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-12-10T02:36:28.540

我不明白为什么在 30 秒内您可以编写一个包含两列的表格并解决问题时，为什么这个问题会被搁置一旁。

这个 div 列高问题出现在一个典型的布局中。当一个普通的旧基本 HTML 标记可以做到这一点时，为什么还要求助于脚本呢？除非布局上有大量的表格，否则我不相信表格明显变慢的论点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-01-13T00:49:44.327

Flex 默认执行此操作。

```
<div id="flex">
 <div id="response">
 </div> 
 <div id="note">
 </div>
</div> 
```

CSS：

```
#flex{display:flex}
#response{width:65%}
#note{width:35%} 
```

[https://jsfiddle.net/784pnojq/1/](https://jsfiddle.net/784pnojq/1/)

奖金：多行

[https://jsfiddle.net/784pnojq/2/](https://jsfiddle.net/784pnojq/2/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-08T20:25:20.823

我建议您将它们都包装在具有所需背景颜色的外部 div 中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-21T11:15:57.470

您也可以随时使用背景图像来执行此操作。我倾向于 100% 地投票支持这个选项，因为唯一的其他完美解决方案是 Jquery 选项。

与使用带有背景颜色的外部 div 一样，您最终将不得不让两个 div 中的内容达到相同的高度。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-08-04T08:36:14.697

也遇到了同样的问题，需要三个具有不同内容的 div 彼此相邻，并使用右边框将它们“分开”，唯一有效的解决方案是另一个答案中 jQuery 选项的略微修改版本。[请记住，您还需要在此处](http://www.filamentgroup.com/examples/pxToEm/pxToEm.js)找到的脚本。

下面是我稍微修改过的脚本版本，它只允许真正的最小高度设置（因为我需要我的盒子至少有一定的高度）。

```
/*--------------------------------------------------------------------
 * JQuery Plugin: "EqualHeights"
 * by:    Scott Jehl, Todd Parker, Maggie Costello Wachs (http://www.filamentgroup.com)
 *
 * Copyright (c) 2008 Filament Group
 * Licensed under GPL (http://www.opensource.org/licenses/gpl-license.php)
 *
 * Description:   Compares the heights or widths of the top-level children of a provided element
                  and sets their min-height to the tallest height (or width to widest width). Sets in em units
                  by default if pxToEm() method is available.
 * Dependencies: jQuery library, pxToEm method    (article:
                  http://www.filamentgroup.com/lab/retaining_scalable_interfaces_with_pixel_to_em_conversion/)
 * Usage Example: $(element).equalHeights();
                  Optional: to set min-height in px, pass a true argument: $(element).equalHeights(true);
                  Optional: to specify an actual min-height (in px), pass an integer value, regardless of previous parameter: $(element).equalHeights(false,150);
 * Version: 2.0, 08.01.2008
--------------------------------------------------------------------*/

$.fn.equalHeights = function(px,minheightval) {
    $(this).each(function(){
        if (minheightval != undefined) { 
            var currentTallest = minheightval;    
        } 
        else { 
            var currentTallest = 0;
        }
        $(this).children().each(function(i){
            if ($(this).height() > currentTallest) { 
                currentTallest = $(this).height();
            }
        });
        if (!px || !Number.prototype.pxToEm) 
            currentTallest = currentTallest.pxToEm(); //Use ems unless px is specified.
        // For Internet Explorer 6, set height since min-height isn't supported.
        if ($.browser.msie && $.browser.version == 6.0) { 
            $(this).children().css({'height': currentTallest});
        }
        $(this).children().css({'min-height': currentTallest});
    });
    return this;
}; 
```

它就像一种魅力，不会减慢任何速度:)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-01-26T19:01:41.993

此代码将使您拥有可变数量的行（每行上具有可变数量的 DIV），并且它将使每行上的所有 DIV 与其最高邻居的高度匹配：

如果我们假设所有浮动的 DIV 都位于*ID*为“divContainer”的容器内，那么您可以使用以下内容：

```
$(document).ready(function() {

var currentTallest = 0;
var currentRowStart = 0;
var rowDivs = new Array();

$('div#divContainer div').each(function(index) {

    if(currentRowStart != $(this).position().top) {

        // we just came to a new row.  Set all the heights on the completed row
        for(currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) rowDivs[currentDiv].height(currentTallest);

        // set the variables for the new row
        rowDivs.length = 0; // empty the array
        currentRowStart = $(this).position().top;
        currentTallest = $(this).height();
        rowDivs.push($(this));

    } else {

        // another div on the current row.  Add it to the list and check if it's taller
        rowDivs.push($(this));
        currentTallest = (currentTallest < $(this).height()) ? ($(this).height()) : (currentTallest);

    }
    // do the last row
    for(currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) rowDivs[currentDiv].height(currentTallest);

});
}); 
```

# linq-to-sql - 是否可以在 Linq 属性映射中设置默认排序依据？

> ID：526306
> 
> 赞同：2
> 
> 时间：2009-02-08T20:28:54.170
> 
> 标签：linq-to-sql, castle-activerecord

我可以在 Active Record 中执行此操作，但是使用 Linq to SQL 是否可行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T21:16:47.360

您始终可以将属性添加到部分类文件中的数据上下文/实体对象：

```
partial class MyDataContext {
    public IOrderedQueryable<Foo> FoosByName {
        get {return Foos.OrderBy(foo=>foo.Name);}
    }
} 
```

然后任何开始的查询`FoosByName`都将被预先订购（但仍然是可组合的）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T21:11:01.790

如果您使用存储过程或视图来检索数据，则可以。然后 ORDER BY 可以在存储的过程或视图中，但 LINQ to SQL 不支持开箱即用。

# asp.net-mvc - Html.Checkbox 不在 ASP.net MVC 中保留其状态

> ID：526310
> 
> 赞同：0
> 
> 时间：2009-02-08T20:31:17.080
> 
> 标签：asp.net-mvc, checkbox

`Html.Checkbox`我对使用扩展方法创建的复选框有这个烦人的问题。显然，在回发的情况下不会保存复选框的状态（由于表单验证错误）。深入研究 MVC 代码本身 ( `System.Web.Mvc.Html.InputExtensions`)，我发现“已检查”属性是通过调用`htmlHelper.EvalBoolean(name)`.

此方法查找 ViewData 本身的键（在 name 参数中指定）。问题是复选框的值实际上位于ModelState中。调用 `htmlHelper.GetModelStateValue(name, typeof(bool))`将返回预期结果。

这是复选框实现中的缺陷吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T17:46:34.720

我在这里发布了另一个解决方法：

> [如何在 ASP.NET MVC 中维护 Html.CheckBox() 的状态](https://stackoverflow.com/questions/524936/how-to-maintain-state-of-html-checkbox-in-asp-net-mvc)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T21:34:47.517

此问题已在[codeplex](http://www.codeplex.com/aspnet/WorkItem/View.aspx?WorkItemId=3136)上发布，并将在 MVC RTM 中得到修复/支持。同时，这是一个很好的[解决方法](http://174.129.228.43/archive/2009/02/09/4.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T08:47:56.950

请记住，MVC 背后的理念是让 Web 回到几年前的状态。如果不使用 AJAX 之类的东西，您不应该在页面上进行回发。因此，您习惯于维护其自身状态的大多数控件将不再起作用。

你有没有想过使用 AJAX 来尝试解决这个问题？这样你就可以拥有你的 postbakc 并保持控件的状态？

# php - 我什么时候应该使用“最终”？

> ID：526312
> 
> 赞同：12
> 
> 时间：2009-02-08T20:32:59.387
> 
> 标签：php, final

我应该在日常编程（网络或其他方式）中声明一个类或方法 final 有什么特别的原因吗？请提供一个应该使用它的真实示例。

顺便说一句，我问是因为我试图[选择一个“晦涩”的关键字并掌握它](http://www.secretgeek.net/6min_program.asp "在 6 分钟内成为更好的程序员的 8 种方法。")。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-08T20:35:42.250

它可以防止其他程序员对您的类做您不打算让他们做的事情。因此，与其发表评论说“不要使用这个类来做 XXX”，不如设计它，让他们不会试图覆盖它并以这种方式滥用它。

**编辑**：由于请求了一个示例，我将描述一个您可能会发现这个关键字很方便的情况......假设您有一个定义两个对象如何相互通信的类，例如一个监听器和通知器。侦听器类显然必须允许继承，但您可能希望将通知器类设为 final，以便它必须在“具有”关系中使用。这样，您可以从侦听器对象中对它们接收到的消息的性质做出一些假设。

否则，就有可能从那个类继承，做各种疯狂的事情，比如扩展消息等等。如果您不希望其他程序员这样做，那么您可以将类设为 final。此外，这在广泛使用的公共 API 中可能更有意义，因为它还允许其他程序员轻松理解哪些类可以子类化。

另一个例子——假设你有一个基于缓冲区的流处理器，并且在你的 read()/write() 方法中，你维护一些关于你的对象当前状态的数据（即，当前字节或其他）。没有办法保证任何子类化这个类的人都会在处理过程中调用超类的方法——而且由于这样的类可能只包含几个方法，所以最好只使整个事情成为最终的而不是每个方法。这再次迫使人们使用该类“has-a”，而不是“is-a”，因此，可以控制您期望代码将如何执行。

我同意你的观点，让整个*班级*决赛可能是你需要在一个蓝月亮做一次的事情，但是如果你选择使用它，PHP 有这个能力是很好的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-08T20:51:50.807

[“Enforce Composition over Inheritance”](http://renaud.waldura.com/doc/java/final-keyword.shtml#classes)说得相当简洁。你保证你的类的某种行为是没有其他任何东西可以干扰的，正如下一节所解释的，它也可以具有安全优势。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-08T20:36:31.280

有些人声称您应该将*所有*类声明为 final，除非您特别打算允许并检查了它的多态扩展的含义。我倾向于认为这意味着对任何其他正在使用您的代码的人有很大的不信任，但不幸的是，有时这是有道理的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T21:00:45.043

在许多语言中，将类声明为 final 也提供了优化好处，因为它不需要查看 virt 表中的方法。

如果你想强制执行类的意图，并且意图使得子类化没有意义，那么使用 final; 否则，没有显着优势。

一般来说，它只是一种强制执行意图的机制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T20:37:04.507

final 类是不能被子类化的类，因此您不想创建任何派生类。例如在 Java 中，Math 类是最终的，因为 Java 不希望您能够重新定义绝对值的含义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-08T20:49:09.753

final （并在 c# 中密封）可以（由类库设计者）用于强制类的一些基本行为。
例如强制字符串具有不可变行为
java 中的字符串类被标记为 final，而在 c# 中它被标记为密封。
所有字符串都是不可变的，并且该行为无法更改。

# process - Software development process and lawyer

> ID：526317
> 
> 赞同：0
> 
> 时间：2009-02-08T20:35:17.507
> 
> 标签：process, project-management

On any if you ask a question about licenses, patents or copyright everybody will refer you to the lawyer (see SO’s “ask-a-lawyer” tag). I’m trying to setup a software development process where there will be place for a lawyer. But I cannot find any well known process that includes a lawyer, what activities a he or she performs. Can you referrer me to some publicly available resource that will explain lawyer activities and part in a software development process (RUP, MSF, XP, etc.)?

It’s really hard to convince a customer to pay money for something for activities that will cost more than project development :-) How currently organizations handle legal expenses for customer projects in most cases: via overhead or via time and materials?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T21:02:00.643

You don't need a lawyer as part of a software development process but you should get a lawyer whenever a legal document is involved (a license agreement or a contract for example).

Just like a small business should have lawyer write employee contracts but doesn't keep a full time lawyer in-house for that, you get a lawyer for a few hours to write you license or contract and then you fill in the names - or pay the lawyer another hour to fill in the names for you.

Once you know what legal requirements you have to fulfill in your fields (and for most software I believe there are none) you don't need a lawyer for development, all the contract work is outside the scope of the software project - at least until a salesperson adds a new feature to a contract to close a sale.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T01:00:21.707

Since it looks, from the comments, like you're specifically trying to avoid infringing on anyone else's patents in your software development process, I'll address that point in particular.

I don't know of any software process methodology that specifically addresses the point of "lawyer-clean" code, but plenty (most?) of them address "clean" code in general (via code reviews), so getting it "lawyer-clean" is more-or-less just another phase of code review.

In practice, the costs of having a lawyer review all (or some "risky" subset) of your code base as it's developed is unlikely to be cost-effective for a customer, and I doubt you'll find anyone willing to pay for it -- the risk/benefit ratio, especially for custom code (which nobody else is going to see source for). I can theoretically envisage some ultra-paranoid company wanting it, so there *might* be a niche market for it, like high-reliability/formal verification development tools/processes. Don't expect it to ever be mass-market.

Also, on the other side, you'd have to find a lawyer willing to do all of the hard yards in understanding your code and finding *any* relevant patents that might apply. I know a couple of patent-searching lawyers (doing IT for them was a speciality of a former job), and it's not a simple task to identify which patent(s) might infringe a chunk of code you've written. I'd expect that you'd almost need a patent lawyer per developer to keep up with the output volume, and the rates they'll charge will make the most outrageous hourly rate you've seen from an IT contractor seem like chicken feed.

Lawyers are also notoriously conservative creatures -- they'll typically say "no go" to anything that looks even vaguely suspect. You can't second-guess them, either, otherwise all those carefully-crafted protections you're selling to your customers are utterly worthless, so your code will have to be squeaky-clean to pass the lawyer(s)' scrutiny. Good luck writing code at a reasonable pace without using any new technology, process, or algorithm from the last 25 years...

Finally, assuming all of the above comes together, and you find a customer, a lawyer or several, and you manage to produce code that passes their paranoia filters, what do you do if your lawyer(s) miss a patent, and your customer gets sued? They'll sue you, and you'll have to sue the lawyer who stuffed up (or, rather, his/her professional indemnity insurance) to get any money out of them. What's more, all the patent search agreements I've seen have been of the "all care, but no responsibility" form. You might be able to crack that facade, with some extra legal maneuvering, but it'll cost you more again.

Very similar things apply to trademarks, incidentally. Copyright is a different beast, and something that your lawyer won't be able to detect in advance (how do they know that a programmer hasn't ripped a pile of code out of a previous employer's product?). For copyright, your best protection is to educate your developers on what constitutes copyright infringement, and thwack *hard* anyone dumb enough to break the rules.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T20:46:54.593

I don't think you'll find a "lawyer" milestone in any software development process. It seems a waste of time to find one to cite for your customer's benefit. Even if you could, I doubt that it would provide enough cover for the objections you're worried about that will cost more than software development.

There are lawyers that specialize in open source software, but the only "free as in beer" law that I know is "pro bono".

The best argument I can think of to justify this is to figure out what a patent fight would cost if you don't bring in a lawyer.

If you know the probability of being hit with such a suit you could multiply the average cost times the probability to come up with a dollar figure to compare to the lawyer's fees. That might be a more convincing argument than citing a software development methodology.

# python - pycurl 取消转移并尝试 & except

> ID：526325
> 
> 赞同：1
> 
> 时间：2009-02-08T20:39:16.610
> 
> 标签：python, pycurl

如何在 pycurl 中取消转账？我曾经在 libcurl 中返回 -1，但 pycurl 似乎不喜欢那样（“pycurl.error：写入回调的无效返回值 -1 17”）返回 0 也不起作用，我得到“错误：（23，'写入正文失败')”。另外，我如何使用 pycurl 进行尝试/除外？我没有在网上看到任何示例，也没有从网站上看到 pycurl 示例

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T23:14:21.810

示例代码在这里会有所帮助。从错误消息来看，并在源代码中查找它，您已经设置了一个写入回调。我认为这是由 CURLOPT_WRITEFUNCTION 配置的，其文档说：

> 返回实际处理的字节数。如果该金额与传递给您的函数的金额不同，它将向库发出错误信号，并将中止传输并返回 CURLE_WRITE_ERROR。

pycurl 包装器代码检查该值是否介于 0 和传递给它的数字之间。这就是为什么 -1 失败，以及为什么 0 触发 CURLE_WRITE_ERROR，引发“失败的写作主体”异常。pycurl 代码是：

```
 /* run callback */
 arglist = Py_BuildValue("(s#)", ptr, total_size);
 if (arglist == NULL)
     goto verbose_error;
 result = PyEval_CallObject(cb, arglist);
 Py_DECREF(arglist);
 if (result == NULL)
     goto verbose_error;

 /* handle result */
 if (result == Py_None) {
     ret = total_size;           /* None means success */
 }
 else if (PyInt_Check(result)) {
     long obj_size = PyInt_AsLong(result);
     if (obj_size < 0 || obj_size > total_size) {
         PyErr_Format(ErrorObject, "invalid return value for write callback %ld %ld", (long)obj_size, (long)total_size);
         goto verbose_error;
     }
     ret = (size_t) obj_size;    /* success */
 }
 else if (PyLong_Check(result)) {
      ... identical code for Long ...
 }
 else {
     PyErr_SetString(ErrorObject, "write callback must return int or None");
     goto verbose_error;
 } 
```

我在 pycurl 中看不到此函数支持另一个返回值的任何方法。可能还有其他方法，例如设置进度回调，这似乎确实允许中止。

curl本身的相关代码是：

```
/* If the previous block of data ended with CR and this block of data is
   just a NL, then the length might be zero */
if(len) {
  wrote = data->set.fwrite_func(ptr, 1, len, data->set.out);
}
else {
  wrote = len;
}

if(CURL_WRITEFUNC_PAUSE == wrote)
  return pausewrite(data, type, ptr, len);

if(wrote != len) {
  failf(data, "Failed writing body (%d != %d)", (int)wrote, (int)len);
  return CURLE_WRITE_ERROR;
} 
```

所以你可以看到 pycurl 不支持返回 curl 本身允许的 CURL_WRITEFUNC_PAUSE 。您还可以看到 curl 无法通过 write 回调函数支持中止。您将不得不使用其他东西。

# linux - 如何在 Linux 上取消关机？

> ID：526329
> 
> 赞同：44
> 
> 时间：2009-02-08T20:42:05.493
> 
> 标签：linux, unix, exit, shutdown, process-control

我熟悉并`shutdown`在 Linux 中使用，通常只是做

`> shutdown -h now`

但是有没有办法阻止关机的发生，比如我的目标是从现在开始关机 10 分钟，然后在 5 分钟后发现我真的不想关机？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-02-08T20:45:00.230

`shutdown -c``shutdown`是在合理最近的 s  上“取消关机” 。

该语法还支持`shutdown -c <message>`公告目的，因此如果其他人使用该机器，这很方便。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-02-08T20:43:31.060

您可以使用  `ps`  来查找关闭过程并中止它，例如使用`ps|grep shutdown`.

这个的替代和较少眼球密集的版本：

```
pkill shutdown
killall shutdown
kill `cat /var/run/shutdown.pid` 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-14T22:28:22.137

如果你迟到了一秒钟`shutdown -c`，并且已经在控制台上 root 了，那么在 init 更改运行级别后，非常快的`# init 5`将取消关闭。

注意：这个答案现在大部分已经过时了。`init 5`在 systemd 上不是很有用，遗憾的是，现在大多数系统都在使用它。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-08T20:45:48.263

来自`shutdown`BSD 系统的手册页：

> 可以通过终止关闭进程来取消计划的关闭（一个 SIGTERM 就足够了）。

# algorithm - 无向图中的循环

> ID：526331
> 
> 赞同：66
> 
> 时间：2009-02-08T20:44:18.623
> 
> 标签：algorithm, graph, graph-theory

给定一个具有*n*个顶点 (| *V* | = *n* )的无向图*G* =( *V* , *E* ) ，如何确定它是否包含*O* ( *n* ) 中的环？

 **** * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-02-08T21:00:32.940

我认为深度优先搜索可以解决它。如果未探索的边指向之前访问过的节点，则该图包含一个循环。此条件也使其成为 O(n)，因为您可以探索最大 n 条边而无需将其设置为 true 或留下没有未探索的边。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-02-10T16:07:18.627

实际上，深度优先（或者实际上是广度优先）搜索还不够。你需要一个更复杂的算法。

例如，假设有一个带有节点 {a,b,c,d} 和边 {(a,b),(b,c),(b,d),(d,c)} 的图，其中边 (x ,y) 是从 x 到 y 的边。（看起来像这样，所有边缘都朝下。）

```
 (a)
     |
     |
    (b)
    / \ 
  (d)  |
   |   |
    \ /
    (c) 
```

然后进行深度优先搜索可能访问节点（a），然后（b），然后（c），然后回溯到（b），然后访问（d），最后再次访问（c）并得出一个循环 -没有的时候。广度优先也会发生类似的事情。

您需要做的是跟踪您正在访问的节点。在上面的示例中，当算法到达 (d) 时，它已经完成了 (c) 的访问，但没有完成 (a) 或 (b) 的访问。所以重新访问一个完成的节点是好的，但是访问一个未完成的节点意味着你有一个循环。执行此操作的常用方法是将每个节点着色为白色（尚未访问）、灰色（访问后代）或黑色（已完成访问）。

这是一些伪代码！

```
define visit(node n):
  if n.colour == grey: //if we're still visiting this node or its descendants
    throw exception("Cycle found")

  n.colour = grey //to indicate this node is being visited
  for node child in n.children():
    if child.colour == white: //if the child is unexplored
      visit(child)

  n.colour = black //to show we're done visiting this node
  return 
```

然后运行 ​​visit(root_node) 当且仅当存在循环时才会抛出异常（最初所有节点都应该是白色的）。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2016-01-04T17:58:33.300

一个无环的连通无向图 G 是一棵树！任何一棵树都恰好有 n-1 条边，所以我们可以简单地遍历图的边列表并计算边数。如果我们计算 n-1 条边，则返回“是”，但如果我们到达第 n 条边，则返回“否”。这需要 O (n) 时间，因为我们最多查看 n 条边。

但是如果图没有连接，那么我们将不得不使用 DFS。我们可以遍历边缘，如果任何未探索的边缘导致访问的顶点，那么它就有循环。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2014-07-11T19:05:42.393

您可以使用 DFS 解决它。时间复杂度：O(n)

该算法的本质是，如果连接的组件/图不包含 CYCLE，它将始终是一棵树。[*见这里为证*](http://en.wikipedia.org/wiki/Tree_%28graph_theory%29)

让我们假设图没有循环，即它是一棵树。如果我们看一棵树，每个节点都来自一个节点：

1.either 到达它唯一的父级，它比它高一级。

2\. 或达到它的子级，它们比它低一级。

因此，如果一个节点有任何其他边不在上述两条边，它显然会将节点连接到它的祖先之一而不是它的父节点。这将形成一个循环。

现在事实已经清楚了，您所要做的就是为图运行 DFS（考虑到您的图是连接的，否则对所有未访问的顶点执行此操作），并且如果您找到已访问的节点的邻居而不是其父母，然后我的朋友在图中有一个循环，你就完成了。

当您对其邻居进行 DFS 时，您可以通过简单地将父级作为参数传递来跟踪父级。而且由于您最多只需要检查*n*条边，因此时间复杂度将为 O(n)。

希望答案有所帮助。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-11-21T17:10:39.727

顺便说一句，如果你碰巧知道它是连接的，那么它只是一棵树（因此没有循环）当且仅当`|E|=|V|-1`。当然，这不是少量的信息:)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-08T21:06:04.157

答案实际上是广度优先搜索（或深度优先搜索，这并不重要）。细节在于分析。

现在，算法有多快？

首先，假设图形没有循环。那么边的数量是 O(V)，图是一个森林，目标达到了。

现在，假设图形有循环，您的搜索算法将在第一个循环中完成并报告成功。该图是无向的，因此，当算法检查一条边时，只有两种可能性：要么它访问了边的另一端，要么它已经访问了，然后这条边闭合了一个圆。一旦它看到边缘的另一个顶点，那个顶点就会被“检查”，所以这些操作只有 O(V)。在整个算法运行过程中，第二种情况只会出现一次。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-06-26T19:26:31.773

一个简单的 DFS 会检查给定的无向图是否有环。

[这是相同的C++代码。](https://github.com/calmhandtitan/algorepo/blob/master/graph/cycleDetection_undirectedGraph.cpp)

上面代码中使用的**想法**是：

> 如果再次找到已经发现/访问过的节点并且不是父节点，那么我们有一个循环。

这也可以解释如下（@Rafał Dowgird 提到

> 如果未探索的边指向之前访问过的节点，则该图包含一个循环。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-11-05T07:05:01.567

有条件的 DFS 方法（父！= 下一个节点）让我们看看代码，然后了解发生了什么：

```
bool Graph::isCyclicUtil(int v, bool visited[], int parent) 
{ 
    // Mark the current node as visited 
    visited[v] = true; 

    // Recur for all the vertices adjacent to this vertex 
    list<int>::iterator i; 
    for (i = adj[v].begin(); i != adj[v].end(); ++i) 
    { 
        // If an adjacent is not visited, then recur for that adjacent 
        if (!visited[*i]) 
        { 
           if (isCyclicUtil(*i, visited, v)) 
              return true; 
        } 

        // If an adjacent is visited and not parent of current vertex, 
        // then there is a cycle. 
        else if (*i != parent) 
           return true; 
    } 
    return false; 
} 
```

上面的代码解释了自己，但我会尝试解释一个条件，即 *i != parent 这里如果假设图表是

1--2

然后当我们在 1 到 2 时，2 的父节点变为 1，当我们回到 1 时，因为 1 在 2 的 adj 矩阵中，那么由于下一个顶点 1 也是 2 的父节点，因此不会检测到循环此 DFS 方法中的直接父级。因此代码工作正常

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-01-19T23:32:43.610

我相信图是连接的假设很少。因此，您可以使用上面显示的证明，运行时间为 O(|V|)。如果不是，则|E|>|V|。提醒：DFS 的运行时间为**O(|V|+|E|)**。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-05-17T00:36:46.353

这是我基于 DFS 用 C 语言编写的代码，用于确定给定图是否连通/循环。最后有一些示例输出。希望它会有所帮助:)

```
#include<stdio.h>
#include<stdlib.h>

/****Global Variables****/
int A[20][20],visited[20],v=0,count=0,n;
int seq[20],s=0,connected=1,acyclic=1;

/****DFS Function Declaration****/
void DFS();

/****DFSearch Function Declaration****/
void DFSearch(int cur);

/****Main Function****/
int main() 
   {    
    int i,j;

    printf("\nEnter no of Vertices: ");
    scanf("%d",&n);

    printf("\nEnter the Adjacency Matrix(1/0):\n");
    for(i=1;i<=n;i++)
            for(j=1;j<=n;j++)
        scanf("%d",&A[i][j]);

    printf("\nThe Depth First Search Traversal:\n");

    DFS();

    for(i=1;i<=n;i++)
        printf("%c,%d\t",'a'+seq[i]-1,i);

    if(connected && acyclic)    printf("\n\nIt is a Connected, Acyclic Graph!");
    if(!connected && acyclic)   printf("\n\nIt is a Not-Connected, Acyclic Graph!");
    if(connected && !acyclic)   printf("\n\nGraph is a Connected, Cyclic Graph!");
    if(!connected && !acyclic)  printf("\n\nIt is a Not-Connected, Cyclic Graph!");

    printf("\n\n");
    return 0;
   }

/****DFS Function Definition****/
void DFS()
    { 
    int i;
    for(i=1;i<=n;i++)
        if(!visited[i])
          {
        if(i>1) connected=0;
        DFSearch(i);    
              } 
    }

/****DFSearch Function Definition****/
void DFSearch(int cur) 
    {
    int i,j;
    visited[cur]=++count;

        seq[count]=cur; 
        for(i=1;i<count-1;i++)
                if(A[cur][seq[i]]) 
                   acyclic=0;

    for(i=1;i<=n;i++)
        if(A[cur][i] && !visited[i])
           DFSearch(i);

    } 
```

* * *

**/*样本输出：**

```
majid@majid-K53SC:~/Desktop$ gcc BFS.c

majid@majid-K53SC:~/Desktop$ ./a.out
************************************

Enter no of Vertices: 10

Enter the Adjacency Matrix(1/0):

0 0 1 1 1 0 0 0 0 0 
0 0 0 0 1 0 0 0 0 0 
0 0 0 1 0 1 0 0 0 0 
0 0 0 0 0 0 0 0 0 0 
0 0 0 0 0 0 0 0 0 0 
0 1 0 0 1 0 0 0 0 0 
0 0 0 0 0 0 0 1 0 0 
0 0 0 0 0 0 0 0 1 0 
0 0 0 0 0 0 0 0 0 1 
0 0 0 0 0 0 1 0 0 0 

The Depdth First Search Traversal:
a,1 c,2 d,3 f,4 b,5 e,6 g,7 h,8 i,9 j,10    

It is a Not-Connected, Cyclic Graph!

majid@majid-K53SC:~/Desktop$ ./a.out
************************************

Enter no of Vertices: 4

Enter the Adjacency Matrix(1/0):
0 0 1 1
0 0 1 0
1 1 0 0
0 0 0 1

The Depth First Search Traversal:
a,1 c,2 b,3 d,4 

It is a Connected, Acyclic Graph!

majid@majid-K53SC:~/Desktop$ ./a.out
************************************

Enter no of Vertices: 5

Enter the Adjacency Matrix(1/0):
0 0 0 1 0
0 0 0 1 0
0 0 0 0 1
1 1 0 0 0 
0 0 1 0 0

The Depth First Search Traversal:
a,1 d,2 b,3 c,4 e,5 

It is a Not-Connected, Acyclic Graph!

*/ 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-12-16T05:55:08.117

如果 DFS 不产生后边，则无向图是无环的（即森林）。由于后边是将顶点连接到深度优先树中的祖先 的边（`u`, ） ，因此没有后边意味着只有树边，因此没有循环。所以我们可以简单地运行 DFS。如果找到后边缘，则有一个循环。复杂性是而不是。因为如果存在后边缘，则必须在看到不同的边缘之前找到它。这是因为在无环（无向）森林中，.`v``u``v``O(V)``O(E + V)``|V|``|E| ≤ |V| + 1`

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-12-24T10:41:10.893

正如其他人所提到的......深度优先搜索将解决它。一般来说，深度优先搜索需要 O(V + E)，但在这种情况下，您知道图最多有 O(V) 条边。所以你可以简单地运行一个 DFS，一旦你看到一个新的边缘就增加一个计数器。当计数器达到 V 时，您不必继续，因为图形肯定有一个循环。显然这需要 O(v)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-02-28T10:16:53.487

我相信正确使用 DFS 还取决于您将如何在代码中表示您的图形。例如，假设您正在使用相邻列表来跟踪相邻节点，并且您的图有 2 个顶点且只有一条边：V={1,2} 和 E={(1,2)}。在这种情况下，从顶点 1 开始，DFS 会将其标记为已访问，并将 2 放入队列中。之后它会弹出顶点 2，由于 1 与 2 相邻，并且 1 被 VISITED，DFS 将得出结论存在一个循环（这是错误的）。换句话说，在无向图中，(1,2) 和 (2,1) 是相同的边，您应该以某种方式对 DFS 进行编码，不要将它们视为不同的边。为每个访问的节点保留父节点将有助于处理这种情况。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-01-20T06:01:19.377

我最近开始研究图表。我用java写了一段代码，可以确定一个图是否有循环。我使用 DFT 在图中找到循环。我使用堆栈而不是递归来遍历图形。

在高级 DFT 中使用堆栈通过以下步骤完成

1.  访问节点
2.  如果节点不在访问列表中，则将其添加到列表中并将其推送到堆栈顶部
3.  将栈顶的节点标记为当前节点。
4.  对当前节点的每个相邻节点重复上述操作
5.  如果所有节点都被访问过，则将当前节点从堆栈中弹出

我从 Graph 的每个节点执行 DFT，并且在遍历过程中，如果遇到之前访问过的顶点，我会检查该顶点的堆栈深度是否大于 1。我还检查了一个节点是否有自己的边以及节点之间是否有多个边。我最初写的堆栈版本不是很优雅。我阅读了如何使用递归来完成它的伪代码，它很简洁。这是一个java实现。LinkedList 数组表示一个图形。每个节点及其相邻顶点分别由数组和每个项目的索引表示

```
class GFG {
Boolean isCyclic(int V, LinkedList<Integer>[] alist) {
    List<Integer> visited = new ArrayList<Integer>();
    for (int i = 0; i < V; i++) {
        if (!visited.contains(i)) {
            if (isCyclic(i, alist, visited, -1))
                return true;
        }
    }
    return false;
}

Boolean isCyclic(int vertex, LinkedList<Integer>[] alist, List<Integer> visited, int parent) {
    visited.add(vertex);
    for (Iterator<Integer> iterator = alist[vertex].iterator(); iterator.hasNext();) {
        int element = iterator.next();
        if (!visited.contains(element)) {
            if (isCyclic(element, alist, visited, vertex))
                return true;
        } else if (element != parent)
            return true;
    }
    return false;
} 
```

}

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-05-19T20:29:26.650

这是 C++ 中一个简单的算法实现，用于检查图是否`O(n)`及时有循环（n 是图中的顶点数）。我没有在这里展示 Graph 数据结构的实现（为了保持简短的回答）。该算法期望类 Graph 具有公共方法， `vector<int> getAdj(int v)`该方法返回与 相邻的顶点`v`并返回顶点`int getV()`总数。此外，算法假设 Graph 的顶点从 开始编号`0 to n - 1`。

```
class CheckCycleUndirectedGraph
{
private:
    bool cyclic;
    vector<bool> visited;

    void depthFirstSearch(const Graph& g, int v, int u) {
        visited[v] = true;
        for (auto w : g.getAdj(v)) {
            if (!visited[w]) {
                depthFirstSearch(g, w, v);
            }
            else if (w != u) {
                cyclic = true;
                return;
            }
        }
    }

public:
    CheckCycleUndirectedGraph(const Graph& g) : cyclic(false) {
        visited = vector<bool>(g.getV(), false);
        for (int v = 0; v < g.getV(); v++) {
            if (!visited[v]){
                depthFirstSearch(g, v, v);
                if(cyclic)
                  break;
            }
        }
    }

    bool containsCycle() const {
        return cyclic;
    }
}; 
```

请记住，Graph 可能由几个未连接的组件组成，并且组件内部可能存在循环。所示算法也检测此类图中的循环。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2017-11-16T01:32:02.413

您可以使用[boost 图形库](http://www.boost.org/doc/libs/1_65_1/libs/graph/doc/index.html)和[循环依赖项](http://www.boost.org/doc/libs/1_61_0/libs/graph/doc/file_dependency_example.html#sec:cycles)。它具有查找具有`back_edge`功能的循环的解决方案。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2012-07-16T18:30:02.307

无环无向图有 |E| < |V|-1。

```
public boolean hasCycle(Graph g) {

   int totalEdges = 0;
   for(Vertex v : g.getVertices()) {
     totalEdges += v.getNeighbors().size();
   }
   return totalEdges/2 > g.getVertices().size - 1;

} 
```

# c++ - 用于从头文件创建类主体的智能工具（插件？）

> ID：526335
> 
> 赞同：5
> 
> 时间：2009-02-08T20:46:21.973
> 
> 标签：c++, visual-studio, class, header

您可能知道这一点——您将创建一些不错的类，您稍微考虑一下，甚至可能在这里和那里绘制一点 UML，然后您就可以开始实施了。您创建带有成员函数的头文件，甚至可能是一些成员属性。

现在是枯燥的工作——将所有内容重写为 .cpp 文件。确实，使用 Visual Assist 之类的东西可以缩短这项任务，但我真的需要这样做吗？Visual Studio 中是否有任何工具/插件/直接功能可以为我执行此操作？你知道，在解决方案资源管理器中右键单击头文件，“为此头文件创建新的 .cpp”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T01:32:09.680

我记得，Rational Rose 可以生成（和往返）C++ 代码。

[IBM Rational](http://www-01.ibm.com/software/rational/?S_TACT=105AGY59&S_CMP=13&ca=dtl-13) [http://www-01.ibm.com/software/rational/?S_TACT=105AGY59&S_CMP=13&ca=dtl-13](http://www-01.ibm.com/software/rational/?S_TACT=105AGY59&S_CMP=13&ca=dtl-13)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T14:43:21.183

ArgoUML 是我们在工作中用来绘制类图的程序，它可以让您轻松查看您构建的类的 .h 和 .cpp 文件。不仅在 C++ 中，而且在 PHP(4/5)、C# 和 Java 中。它不允许您从 .h 文件制作图表，所以我不知道如果您已经编写了标题，它是否对您特别有用。不过，对于未来，它可能会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T23:58:23.027

不。

但我同意这将非常有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-14T15:57:15.413

DevExtra [http://www.toptensoftware.com/devextra/](http://www.toptensoftware.com/devextra/)

# scheme - 什么软件用Scheme写的？

> ID：526337
> 
> 赞同：11
> 
> 时间：2009-02-08T20:46:29.383
> 
> 标签：scheme

在几年前参加的编程语言概念课上，我很喜欢 Scheme。自从阅读了 Paul Graham 对 Lisp 的评价后，我就一直打算回去重新学习 Scheme，看看它是否会总体上改进我的编程。

有没有用Scheme编写的知名软件作品？开源包？网站？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-08T21:23:54.457

有关一些答案，请参阅这个[SO question 'are-there-people-using-scheme-out-there'](https://stackoverflow.com/questions/291033/are-there-people-using-scheme-out-there)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-08T20:57:37.250

它（曾经？）在某些开源软件包软件（例如 GIMP）中用作脚本语言。还有一些 GNU 项目使用 Guile（一种 Scheme 实现）作为他们的脚本语言。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-08T21:03:06.893

有些程序不是直接用方案编写的，而是通过方案解释器提供脚本功能。一些例子是 gimp 和窗口管理器锯鱼。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T21:02:46.600

我很确定[ITA Software](http://itasoftware.com/)的大多数算法都使用了 Scheme。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-08T21:40:53.857

*Jak & Daxter*系列游戏是用类似于 Scheme 的自定义语言编写的，称为[GOAL](http://en.wikipedia.org/wiki/Game_Oriented_Assembly_Lisp)。许多像垃圾收集和动态列表分配这样的 Schemey 功能不得不退出窗口才能使其在恒定的内存和时间中运行，但它仍然可以识别为 LISPish。GOAL 编译器是用 Commmon Lisp 编写的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-08T21:53:25.620

当然，Scheme 本身，以及[DrScheme](http://www.plt-scheme.org)等 Scheme 环境都是用 Scheme 编写的！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-09T01:33:11.833

此外，emacs 大量使用了自己的 lisp 方言，称为[Emacs Lisp](http://en.wikipedia.org/wiki/Emacs_Lisp)。这与 Scheme 非常相关，因为 Scheme 本身就是 Lisp 的一种方言。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-06-28T13:14:17.667

有一个名为[lambdanative](https://github.com/part-cw/lambdanative/wiki/Getting-Started)的框架，用于为 ios、android、linux 和 windows 系统创建跨平台应用程序。应用程序的代码是用方案编写的，该方案后来使用 Gambit-C 翻译成 C，然后使用各种平台的 SDK 为它们编译。它很好地使用了方案语言，而且还有很长的路要走。

所以有很多使用这个框架用 Scheme 编写的应用程序。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-08T22:15:18.127

我个人知道的两个：在一家电信公司工作时，我们安装了一个中间件产品，基本上是一个消息路由器，它是用 Scheme 编写的，并使用“schemelets”来识别和翻译消息。那是我第一次接触它。

第二个是特定的编译器和 IDE 套件（由于各种原因，我不能提及公司或产品，但它们来自**可视化工具****时代**之前:-)。

 *** * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-13T00:59:00.523

Haxima 游戏引擎是用 Scheme 编写的，Nazghul 游戏也在 Scheme 中运行。两者都是免费软件，因此您可以根据需要实际学习甚至修改代码。

# jquery - jQuery获取元素的渲染高度？

> ID：526347
> 
> 赞同：449
> 
> 时间：2009-02-08T20:49:55.943
> 
> 标签：jquery, css, height

如何获得元素的渲染高度？

假设您有一个`<div>`包含一些内容的元素。里面的这个内容将拉伸`<div>`. 当您没有明确设置高度时，如何获得“渲染”高度。显然，我尝试过：

```
var h = document.getElementById('someDiv').style.height; 
```

这样做有诀窍吗？如果有帮助，我正在使用 jQuery。

* * *

## 回答 #1

> 赞同：1298
> 
> 时间：2009-02-08T20:51:45.440

尝试以下之一：

```
var h = document.getElementById('someDiv').clientHeight;
var h = document.getElementById('someDiv').offsetHeight;
var h = document.getElementById('someDiv').scrollHeight; 
```

`clientHeight`包括高度和垂直填充。

`offsetHeight`包括高度、垂直填充和垂直边框。

`scrollHeight`包括包含文档的高度（在滚动的情况下会大于高度）、垂直填充和垂直边框。

* * *

## 回答 #2

> 赞同：199
> 
> 时间：2009-02-08T20:52:23.380

它应该只是

```
$('#someDiv').height(); 
```

用 jQuery。这将检索包装集中第一项的高度作为数字。

尝试使用

```
.style.height 
```

仅在您首先设置属性时才有效。不是很有用！

* * *

## 回答 #3

> 赞同：155
> 
> 时间：2015-01-26T17:35:14.873

***NON JQUERY*** *，因为在这些答案的顶部**使用了一堆链接......`elem.style.height`*

内部高度：
[https ://developer.mozilla.org/en-US/docs/Web/API/Element.clientHeight](https://developer.mozilla.org/en-US/docs/Web/API/Element.clientHeight)

```
document.getElementById(id_attribute_value).clientHeight; 
```

外部高度：
[https ://developer.mozilla.org/en-US/docs/Web/API/HTMLElement.offsetHeight](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement.offsetHeight)

```
document.getElementById(id_attribute_value).offsetHeight; 
```

或者我最喜欢的参考资料之一：http: [//youmightnotneedjquery.com/](http://youmightnotneedjquery.com/)

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2018-09-12T11:58:10.517

我用它来获取元素的高度*（返回浮点数）*：

```
document.getElementById('someDiv').getBoundingClientRect().height 
```

当您使用*虚拟 DOM*时，它也可以工作。我在 Vue 中这样使用它：

```
this.$refs['some-ref'].getBoundingClientRect().height 
```

对于 Vue 组件：

```
this.$refs['some-ref'].$el.getBoundingClientRect().height 
```

* * *

## 回答 #5

> 赞同：52
> 
> 时间：2013-01-30T09:14:36.853

您可以`.outerHeight()`用于此目的。

它将为您提供元素的完整渲染高度。此外，您不需要设置任何`css-height`元素。为了预防起见，您可以将其高度保持为**自动**，以便可以根据内容的高度进行渲染。

```
//if you need height of div excluding margin/padding/border
$('#someDiv').height();

//if you need height of div with padding but without border + margin
$('#someDiv').innerHeight();

// if you need height of div including padding and border
$('#someDiv').outerHeight();

//and at last for including border + margin + padding, can use
$('#someDiv').outerHeight(true); 
```

要清楚地了解这些功能，您可以访问 jQuery 的站点或[**此处的详细帖子**](https://17path.wordpress.com/2013/01/30/how-to-get-height-of-an-element-in-jquery/)。

它将清除//之间的*区别*`.height()``innerHeight()``outerHeight()`

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2017-02-11T21:12:53.513

```
style = window.getComputedStyle(your_element); 
```

然后简单地说：`style.height`

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2009-02-13T03:55:08.733

绝对用

```
$('#someDiv').height()   // to read it 
```

或者

```
$('#someDiv').height(newHeight)  // to set it 
```

我将其作为附加答案发布，因为我刚刚学到了一些重要的东西。

刚才我差点掉进了使用offsetHeight的陷阱。这就是发生的事情：

*   我使用了使用调试器的古老技巧来“观察”我的元素具有哪些属性
*   我看到哪一个的值与我预期的值差不多
*   它是 offsetHeight - 所以我使用了它。
*   然后我意识到它不适用于隐藏的 DIV
*   我在计算 maxHeight 后尝试隐藏，但这看起来很笨拙——一团糟。
*   我进行了搜索 - 发现了 jQuery.height() - 并使用了它
*   发现 height() 甚至对隐藏元素也有效
*   只是为了好玩，我检查了高度/宽度的 jQuery 实现

这只是其中的一部分：

```
Math.max(
Math.max(document.body["scroll" + name], document.documentElement["scroll" + name]),
Math.max(document.body["offset" + name], document.documentElement["offset" + name])
) 
```

是的，它同时查看滚动和偏移。如果失败，考虑到浏览器和 css 兼容性问题，它看起来会更进一步。换句话说，我不关心的东西——或者想要的东西。

但我不必。谢谢 jQuery！

故事的寓意：如果 jQuery 有某种方法，它可能是有充分理由的，可能与兼容性有关。

如果您最近还没有阅读[jQuery 方法列表，](https://api.jquery.com)我建议您看一下。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2020-01-06T11:43:08.220

我认为在 2020 年做到这一点的最好方法是使用 vanilla js 和`getBoundingClientRect().height;`

这是一个例子

```
let div = document.querySelector('div');
let divHeight = div.getBoundingClientRect().height;

console.log(`Div Height: ${divHeight}`);
```

```
<div>
  How high am I? 
</div>
```

除了获得`height`这种方式之外，我们还可以访问有关`div`.

```
let div = document.querySelector('div');
let divInfo = div.getBoundingClientRect();

console.log(divInfo);
```

```
<div>What else am I? </div>
```

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2012-07-31T13:55:18.603

我编写了一个甚至不需要 JQuery 的简单代码，并且可能会帮助一些人。加载后获取“ID1”的总高度并在“ID2”上使用

```
function anyName(){
    var varname=document.getElementById('ID1').offsetHeight;
    document.getElementById('ID2').style.height=varname+'px';
} 
```

然后只需设置身体加载它

```
<body onload='anyName()'> 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2018-08-20T10:00:28.797

```
document.querySelector('.project_list_div').offsetHeight; 
```

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2018-03-24T21:19:06.620

嗯，我们可以得到元素几何......

```
var geometry;
geometry={};
var element=document.getElementById(#ibims);
var rect = element.getBoundingClientRect();
this.geometry.top=rect.top;
this.geometry.right=rect.right;
this.geometry.bottom=rect.bottom;
this.geometry.left=rect.left;
this.geometry.height=this.geometry.bottom-this.geometry.top;
this.geometry.width=this.geometry.right-this.geometry.left;
console.log(this.geometry); 
```

这个普通的 JS 怎么样？

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2011-06-28T21:59:50.033

这就是答案吗？

“如果你需要计算但不显示它，请将元素设置为`visibility:hidden`and `position:absolute`，将其添加到 DOM 树中，获取 offsetHeight，然后将其删除。（这就是我上次检查时原型库在行后面所做的）。”

我在许多元素上都有同样的问题。该站点上没有要使用的 jQuery 或 Prototype，但如果它有效，我都赞成借用该技术。作为一些失败的例子，接下来是什么，我有以下代码：

```
// Layout Height Get
function fnElementHeightMaxGet(DoScroll, DoBase, elementPassed, elementHeightDefault)
{
    var DoOffset = true;
    if (!elementPassed) { return 0; }
    if (!elementPassed.style) { return 0; }
    var thisHeight = 0;
    var heightBase = parseInt(elementPassed.style.height);
    var heightOffset = parseInt(elementPassed.offsetHeight);
    var heightScroll = parseInt(elementPassed.scrollHeight);
    var heightClient = parseInt(elementPassed.clientHeight);
    var heightNode = 0;
    var heightRects = 0;
    //
    if (DoBase) {
        if (heightBase > thisHeight) { thisHeight = heightBase; }
    }
    if (DoOffset) {
        if (heightOffset > thisHeight) { thisHeight = heightOffset; }
    }
    if (DoScroll) {
        if (heightScroll > thisHeight) { thisHeight = heightScroll; }
    }
    //
    if (thisHeight == 0) { thisHeight = heightClient; }
    //
    if (thisHeight == 0) { 
        // Dom Add:
        // all else failed so use the protype approach...
        var elBodyTempContainer = document.getElementById('BodyTempContainer');
        elBodyTempContainer.appendChild(elementPassed);
        heightNode = elBodyTempContainer.childNodes[0].offsetHeight;
        elBodyTempContainer.removeChild(elementPassed);
        if (heightNode > thisHeight) { thisHeight = heightNode; }
        //
        // Bounding Rect:
        // Or this approach...
        var clientRects = elementPassed.getClientRects();
        heightRects = clientRects.height;
        if (heightRects > thisHeight) { thisHeight = heightRects; }
    }
    //
    // Default height not appropriate here
    // if (thisHeight == 0) { thisHeight = elementHeightDefault; }
    if (thisHeight > 3000) {
        // ERROR
        thisHeight = 3000;
    }
    return thisHeight;
} 
```

它基本上尝试任何事情，只是为了得到零结果。ClientHeight 没有影响。对于问题元素，我通常在 Base 中得到 NaN，在 Offset 和 Scroll 高度中得到零。然后我尝试了 Add DOM 解决方案和 clientRects 看看它是否在这里工作。

2011 年 6 月 29 日，我确实更新了代码以尝试同时添加到 DOM 和 clientHeight，结果比我预期的要好。

1）clientHeight 也是 0。

2) Dom 实际上给了我一个很棒的高度。

3) ClientRects 返回的结果几乎与 DOM 技术相同。

因为添加的元素本质上是流动的，所以当它们被添加到原本为空的 DOM Temp 元素时，它们会根据该容器的宽度进行渲染。这很奇怪，因为它比最终结束的时间短 30px。

我添加了一些快照来说明如何以不同方式计算高度。 ![菜单块正常渲染](https://i.stack.imgur.com/roB7P.jpg) ![菜单块添加到 DOM Temp 元素](https://i.stack.imgur.com/iaDFY.jpg)

身高差距很明显。我当然可以添加绝对定位和隐藏，但我相信这不会有任何效果。我继续坚信这行不通！

（我进一步离题）高度出来（渲染）低于真实渲染的高度。这可以通过设置 DOM Temp 元素的宽度以匹配现有父元素来解决，并且理论上可以相当准确地完成。我也不知道删除它们并将它们添加回现有位置会产生什么结果。当他们通过innerHTML 技术到达时，我将使用这种不同的方法进行研究。

*** 但是 ***这些都不是必需的。事实上，它像宣传的那样工作并返回了正确的高度！！！

当我能够让菜单再次可见时，令人惊讶的是，DOM 已经根据页面顶部的流畅布局返回了正确的高度（279 像素）。上面的代码还使用了返回 280px 的 getClientRects。

这在以下快照中进行了说明（从 Chrome 中获取）。
![在此处输入图像描述](https://i.stack.imgur.com/CsKMv.jpg)

现在我不知道为什么该原型技巧有效，但似乎有效。或者，getClientRects 也可以。

我怀疑这些特定元素的所有这些问题的原因是使用了 innerHTML 而不是 appendChild，但目前这纯粹是猜测。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2009-02-13T00:05:22.000

`offsetHeight`， 通常。

如果您需要计算某些东西但不显示它，请将元素设置为`visibility:hidden`and `position:absolute`，将其添加到 DOM 树中，获取`offsetHeight`，然后将其删除。（这就是我上次检查时原型库在幕后所做的事情）。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2015-01-01T09:04:33.780

有时 offsetHeight 会返回零，因为您创建的元素尚未在 Dom 中呈现。我为这种情况编写了这个函数：

```
function getHeight(element)
{
    var e = element.cloneNode(true);
    e.style.visibility = "hidden";
    document.body.appendChild(e);
    var height = e.offsetHeight + 0;
    document.body.removeChild(e);
    e.style.visibility = "visible";
    return height;
} 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2014-03-25T16:24:56.620

如果您已经在使用 jQuery，那么最好的选择是`.outerHeight()`or `.height()`，如前所述。

如果没有 jQuery，您可以检查使用中的 box-sizing 并添加各种填充 + 边框 + clientHeight，*或者*您可以使用[getComputedStyle](https://developer.mozilla.org/en-US/docs/Web/API/Window.getComputedStyle)：

var h = getComputedStyle(document.getElementById('someDiv')).height;

`h`现在将是一个类似“53.825px”的字符串。

而且我找不到参考，但我想我听说`getComputedStyle()`可能很昂贵，所以它可能不是你想在每个`window.onscroll`事件上调用的东西（但是，jQuery 也不是`height()`）。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-02-13T00:09:08.043

使用**MooTools**：

`$('someDiv').getSize().y`

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-01-27T15:02:40.283

如果我正确理解了您的问题，那么也许这样的事情会有所帮助：

```
function testDistance(node1, node2) {
    /* get top position of node 1 */
    let n1Pos = node1.offsetTop;
    /* get height of node 1 */
    let n1Height = node1.clientHeight;
    /* get top position of node 2 */
    let n2Pos = node2.offsetTop;
    /* get height of node 2 */
    let n2Height = node2.clientHeight;

    /* add height of both nodes */
    let heightTogether = n1Height + n2Height;
    /* calculate distance from top of node 1 to bottom of node 2 */
    let actualDistance = (n2Pos + n2Height) - n1Pos;

    /* if the distance between top of node 1 and bottom of node 2
       is bigger than their heights combined, than there is something between them */
    if (actualDistance > heightTogether) {
        /* do something here if they are not together */
        console.log('they are not together');
    } else {
        /* do something here if they are together */
        console.log('together');
    } 
} 
```

* * *

## 回答 #18

> 赞同：-4
> 
> 时间：2009-02-08T20:52:43.113

您是否专门在css中设置了高度？如果你没有，你需要使用`offsetHeight;`而不是`height`

```
var h = document.getElementById('someDiv').style.offsetHeight; 
```

# c - 如何展开（编译）解释器循环？

> ID：526351
> 
> 赞同：14
> 
> 时间：2009-02-08T20:51:04.630
> 
> 标签：c, optimization, compiler-construction, programming-languages, interpreter

我听说有些语言通过“展开解释器循环”从解释变为编译。

假设我有以下用于 ast 树的伪 c 代码解释器。

```
int interpret(node)
{
    switch(node) {
        case PLUS:
             return interpret(child(0))+interpret(child(1));
        case MINUS:
             return interpret(child(0))-interpret(child(1));       
    }
} 
```

如何展开此循环以创建已编译的程序？

**我看到你们所有人都对此表示反对，就像我不知道我在说什么一样，但这里有一段来自维基百科的引述，它准确地说明了我所描述的内容。**

*“因子最初只是解释，但现在完全编译（非优化编译器基本上展开解释器循环”*

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-08T21:09:38.440

“展开循环”通常意味着用一系列动作替换重复。循环：

```
for (int i = 0; i < 4; ++i) {
    a[i] = b[i] + c[i];
} 
```

将展开为等价物：

```
a[0] = b[0] + c[0];
a[1] = b[1] + c[1];
a[2] = b[2] + c[2];
a[3] = b[3] + c[3]; 
```

在我看来，维基百科引用的任何人都是在某种隐喻意义上使用这个短语。所以，从这个意义上说...

您的示例通常会在解释器中调用，该解释器正在遍历 AST 节点树，可能看起来像这样：

```
 ASSIGN
    |
 +--+---+
 |      |
REF   MINUS
 |      |
 x   +--+---+
     |      |
    VAR    PLUS
     |      |
     a   +--+--+
         |     |
        VAR  CONST
         |     |
         b     3 
```

并且该`interpret`功能将具有其他选项：

```
int interpret(node) {
    switch(node) {
        case PLUS:
             return interpret(child(0))+interpret(child(1));
        case MINUS:
             return interpret(child(0))-interpret(child(1));       
        case ASSIGN:
             return set(child(0), interpret(child(1));
        case VAR:
             return fetch(child(0));
        case CONST:
             return value(child(0));
        ...
    }
} 
```

如果您使用该`interpet`功能（实际上执行操作）遍历 AST，那么您就是在解释。但是如果函数*记录*了要执行的动作，而不是*执行*它们，那么你就是在编译。在伪代码中（实际上，伪代码*两次*，因为我假设一个假设的堆栈机器作为编译目标）：

```
string compile(node) {
    switch(node) {
        case PLUS:
             return(compile(child(0))) + compile(child(1)) + ADD);
        case MINUS:
             return(compile(child(0))) + compile(child(1)) + SUB);
        case ASSIGN:
             return(PUSHA(child(0))) + compile(child(1)) + STORE);
        case REF:
             return(PUSHA(child(0)));
        case VAR:
             return(PUSHA(child(0)) + FETCH);
        case CONST:
             return(PUSHLIT + value(child(0)));
        ...
    }
} 
```

调用`compile`该 AST（忽略任何伪代码拼写错误；-）会吐出如下内容：

```
PUSHA x
PUSHA a
FETCH
PUSHA b
FETCH
PUSHLIT 3
ADD 
SUB
STORE 
```

FWIW，我倾向于认为这是展开 AST，而不是展开解释器，但不会在不阅读上下文的情况下批评别人的隐喻。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T21:00:51.317

我有点困惑。我不认为“展开循环”在这里是正确的术语。即使您将代码重构为没有任何递归调用，您仍将使用解释器。

你可以用 GCC 编译这个程序。然后您将拥有一个已编译的程序，尽管已编译的程序将解释 AST。

将其转换为编译器的一种方法是`return interpret(child(0))+interpret(child(1));`，您将生成汇编指令，而不是执行加法，然后将其输出到文件中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T21:04:17.000

您在这里并没有真正的循环，因为并非所有的调用`interpret`都是尾调用。

假设堆栈模型，最接近您的编译器...

```
int compile(node)
{
    switch(node) {
        case PLUS:
             return compile(child(0))&&compile(child(1))&&compile_op(op_plus);
        case MINUS:
             return compile(child(0))&&interpret(child(1))&&compile_op(op_minus);       
    }
} 
```

但我认为在这种情况下*展开*更适用于字节码解释器而不是 AST 解释器。字节码指令通常在循环中解释。然后“展开”技术是发出对应于每个字节码指令的代码。

因子类似于 FORTH。*通常 FORTH 有一个生成线程代码*的外部解释器。线程代码可以设想为函数指针数组（有几种变体，直接线程、间接线程、子程序线程等）。线程代码由内部解释器执行。在这种情况下展开解释器是指内部解释器，并且是连接线程代码的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-09T11:48:28.717

Factory 是一种基于堆栈的语言，而不是基于 AST 的解释器。

我已经为演员解释器使用了基于堆栈的语言，所以这就是我所做的工作的方式，这可能与 Factor 并不完全不同。

每个函数都作为一个函数实现，该函数接受一个堆栈并返回一个堆栈（在我的情况下，是同一堆栈的变异版本，我不确定 Factor 是功能性的还是变异的）。在我的解释器中，每个函数也将函数的延续放在堆栈顶部，因此解释器知道下一步该做什么：

所以调用栈上下一个函数的解释器是这样的：

```
for (;;)
    stack = (stack[0].function_pointer)(stack); 
```

考虑函数 foo：

```
def foo (x,y):
   print( add(x, y) ) 
```

add 可以定义为：

```
pop a
pop b
stack[ return_offset ] = a + b
return stack 
```

和 foo 作为：

```
pop x
pop y
push _
push &print
push y
push x
push &add 
```

调用 foo(5,6) 的堆栈在循环的每一步都会演变成这样：

```
>> foo(5,6)
[&foo, 5, 6]
[&add, 5, 6, &print, _]
[&print, 11]
=> 11
[] 
```

一个简单的编译器可以展开 foo 函数的循环，生成等效的线程代码：

```
compiled_foo (stack): 
    stack = begin_foo(stack) // arranges stack for call to add
    stack = add(stack)
    stack = print(stack)
    return stack 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-10T03:12:31.100

这可能不相关，还要查看第二个 Futamura 投影

[http://en.wikipedia.org/wiki/Futamura_projection](http://en.wikipedia.org/wiki/Futamura_projection)

这表示编译器只是具有部分评估/常量折叠的解释器（理论上很好，但在实践中不好）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-08T22:11:48.367

在[本文中](http://wry.me/misc/peval.html)，我介绍了一个将解释器自动转换为编译器的示例（尽管编译为 Scheme 而不是机器代码）。这与其他人在这里给出的想法相同，但您可能会发现看到它自动化会有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-08T21:08:00.940

解释器在运行时扫描每个字节码（或 AST 节点）并分派给函数调用（通常在无限循环中使用 switch 语句）。

编译器基本上做同样的事情，但在编译时。编译器在编译时扫描每个字节码（或 AST 节点）并发出代码（机器代码或一些更高级别的中间语言，如 C）以在运行时调用适当的函数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-08T21:11:21.697

我认为这意味着不是循环语句并执行它们，而是循环语句并输出将执行的解释器代码。

基本上，正在发生的事情是将在解释器循环中执行的代码内联到一个新函数中。循环被“展开”，因为当代码执行时，它不再在解释器循环中，它只是通过生成函数的线性路径。

# php - 输出缓冲器如何使性能恶化

> ID：526358
> 
> 赞同：3
> 
> 时间：2009-02-08T20:53:51.083
> 
> 标签：php, output-buffering

我正在编写一个 php 脚本，在我的`header()`函数之前的某个地方，我已经将文本打印到浏览器，从而导致我的`header()`函数给了我一个众所周知的错误：

> 警告：无法修改标头信息 - 标头已发送。

`ob_start()`现在我的问题是，我有使用函数`ob_flush()`前后的意图。`header()`但是我曾经听说过输出缓冲区之类的东西会对应用程序的性能产生负面影响。这有多真实？

或者我应该坚持打印 Javascript 函数来重定向页面的想法。

谢谢你的时间。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T20:56:52.433

> 我们应该忘记小的效率，比如大约 97% 的时间：过早优化是万恶之源。

测试`ob_start`和朋友看看性能差异是否重要。如果是这样，请寻找替代方案。

`header()`最简单的选择是在打印之前移动呼叫。

因为您可能正在执行重定向，例如：

```
header('Location: /new/location/'); 
```

您不应该在此`header()`调用之前打印任何内容，因为无论如何客户端都不会对您打印的数据做任何事情（除非我缺少关于 HTTP 的内容）。

（Javascript 不是重定向的好选择，也不是`meta`刷新，除非您出于某种原因想要检测 Javascript。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T20:57:40.417

使用输出缓冲区需要服务器将 PHP 的整个输出存储在 RAM 中，因此如果它是一个大页面，您将最终使用相当多的内存 - 而且服务器还必须等到整个页面都完成在发送之前生成，这可能会导致小的延迟。但除此之外，我认为使用输出缓冲区并没有太大的劣势。对于您想要做的事情，这当然是一个合理的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T21:19:47.027

输出后在 PHP 代码中重新定位可以说明糟糕的应用程序设计。但我不知道你的情况，可以提出两种可能的方法。

1.  将代码拆分为模型（数据处理）和视图（输出）（参见[MVC](http://en.wikipedia.org/wiki/Model-view-controller)）。这意味着您甚至在显示任何内容之前就已经决定重新定位。我认为这种方式是首选。
2.  如果您*确实*需要显示输出（或发送的其他标头），常见的方法是结合 JS 和 HTML（在 noscript 中）：

    ```
    if (headers_sent()) {
        print('<script type="text/javascript">( document.location.replace ) ? document.location.replace("'.$location.'") : document.location.href = "'.$location.'";</script>'."\n".'<noscript><meta http-equiv="Refresh" content="0;URL='.$location.'" /></noscript>');
    } else {
        header('Location: '.$location);
        exit;
    } 
    ```

PS 这段代码是一段 Fusebox 框架。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T20:59:20.727

只是回答你的最后一句话：你可以在 php 中使用它重定向页面，`header('Location: '.$url)`显然它应该在任何其他输出之前出现，建议紧随其后`exit();`

# database - 我应该在 Firefox 扩展中使用哪个轻量级数据库？

> ID：526364
> 
> 赞同：5
> 
> 时间：2009-02-08T20:57:59.637
> 
> 标签：database, firefox

我目前使用平面文件将数据存储在 Firefox 扩展中，但认为这还不够。

**Firefox 扩展中通常使用哪些轻量级数据库？**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-08T21:00:05.747

[SQLite 内置在](https://developer.mozilla.org/en/Storage)最新版本的 Firefox 中，用作数据存储机制。更多信息，以及如何使用 FF 包装器 API 的示例，可以在[MDC](https://developer.mozilla.org/en/Storage)上找到。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T21:00:23.297

sqlite，用于 ff 本身

# java - 如何让 Java 套接字与公共 IP 一起工作？

> ID：526375
> 
> 赞同：5
> 
> 时间：2009-02-08T21:01:00.830
> 
> 标签：java, sockets

我让套接字与 localips 一起工作没有任何问题，但是一旦我将代码更改为使用公共 ips，我就一直得到 java.net.ConnectException。

我正在使用端口 8084，据我所知，在其他地方没有使用在命令提示符下，netstat -a | grep 8084 显示：文件标准输入：TCP user-9114eb19a8:8084 user-9114eb19a8:0 LISTENING

我已经进入我的路由器并确保它是打开的 我使用对[http://www.whatismyip.org的请求获取我的公共 IP](http://www.whatismyip.org)

服务器：

```
serverSocket = new ServerSocket (8084); 
```

客户：

```
socket = new Socket (hostaddr, 8084); //hostaddr is a string containing my public-IP
//it works when the program is run on a localnetwork and I am using my local-ips 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-08T21:15:39.517

什么类型的路由器？不要忘记，即使您的路由器上可能打开了一个端口，您也需要让您的路由器将端口 8084**转发**到目标计算机的内部 IP，否则由于网络地址转换 (NAT)，路由器/防火墙不知道什么一旦到达那里就与交通有关。

例如，假设您的客户端 PC 位于加利福尼亚，IP 为 10.1.1.100，路由器使用公共 IP 为 70.62.50.42。

您的服务器 PC 位于纽约，IP 为 192.168.1.121，位于内部 IP 为 192.168.1.1 和公共 IP 为 40.20.26.63 的路由器后面。您需要确保进入路由器并将端口 8084 (TCP) 转发到内部地址 192.168.1.121（内部服务器 PC）。

根据您的路由器级别，此术语将是端口转发、虚拟 IP 或静态 NAT 转换（还有其他一些，但您明白了）。

您无需调整客户端路由器上的任何设置，因为该路由器已经知道如何将您的请求路由到互联网。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T21:38:38.293

我询问了 netstat，只是想看看您是否在 127.0.0.1 上收听，但我不熟悉您的操作系统显示的内容。

假设您没有意外地仍在监听本地主机：使用路由器，您通常必须转发到特定地址。至少，对于我拥有的路由器，这就是我必须做的。假设您没有在监听 localhost，那么路由器需要转发到 ifconfig 显示的 IP。

# windows - 编写 rakefile 以在 Windows 中运行命令的最佳方法是什么？

> ID：526386
> 
> 赞同：3
> 
> 时间：2009-02-08T21:03:11.013
> 
> 标签：windows, ruby, command-line, command, rake

例如，我想在 rake 下运行以下命令。

```
robocopy C:\Media \\other\Media /mir 
```

我能够开始工作的 rakefile 是

```
def sh(str)
  str.tr!('|', '\\')
  IO.popen(str) do |pipe|
    pipe.each do |line|
      puts line
    end
  end
end

task :default do
  sh 'robocopy C:|Media ||other|Media /mir'
end 
```

然而，字符串文字的处理很尴尬。

如果我使用 heredoc 输入字符串文字

```
<<HEREDOC
copy C:\Media \\other\Media /mir
HEREDOC 
```

我得到了错误

```
rakefile.rb:15: Invalid escape character syntax
copy C:\Media \\other\Media /mir
          ^
rakefile.rb:15: Invalid escape character syntax
copy C:\Media \\other\Media /mir
                        ^ 
```

如果我使用单引号，则其中一个反斜杠会丢失。

```
irb(main):001:0> 'copy C:\Media \\other\Media /mir'
=> "copy C:\\Media \\other\\Media /mir" 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-09T19:00:41.313

双反斜杠被解释为转义的单反斜杠。您应该转义字符串中的每个反斜杠。

```
irb(main):001:0> puts 'robocopy C:\\Media \\\\other\\Media /mir'
robocopy C:\Media \\other\Media /mir 
```

或者，如果您真的不想转义反斜杠，则可以使用带有单引号标识符的此处文档。

```
irb(main):001:0> <<'HEREDOC'
irb(main):002:0' copy C:\Media \\other\Media /mir
irb(main):003:0' HEREDOC
=> "copy C:\\Media \\\\other\\Media /mir\n"
irb(main):004:0> puts _
copy C:\Media \\other\Media /mir 
```

# javascript - 统计或资源：哪个首先被禁用（比其他更频繁）？图片还是Javascript？

> ID：526391
> 
> 赞同：1
> 
> 时间：2009-02-08T21:05:29.387
> 
> 标签：javascript, html, css, image

我正在创建一个新网站，统计上出现了这个问题，包括所有浏览器（也包括手机浏览器），哪些浏览器更常被禁用？图片、Javascript 还是 CSS？我寻找答案的原因是设计涵盖最常见场景的图像替换技术。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T08:48:50.590

资源：[W3Schools 浏览器统计数据](http://www.w3schools.com/browsers/browsers_stats.asp)（底部的 JavaScript 统计数据）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T22:03:33.800

JavaScript 被更频繁地禁用。为什么？

*   移动浏览器
*   AdBlock Plus
*   一些防火墙阻止 JavaScript
*   偏执的用户

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T08:37:22.537

嗯，这很难说。禁用图像以节省带宽，同时禁用 javascript 以确保安全。我认为大多数用户会在保留图像的同时禁用 javascript。

# c# - 如何将文件存储在 EXE 中

> ID：526397
> 
> 赞同：35
> 
> 时间：2009-02-08T21:07:16.353
> 
> 标签：c#, file, executable

好的，所以我正在用 C# 编写我自己的安装程序，我想做的是将文件放入 .exe 中，这样我就可以执行 File.Copy(file, filedir);

或者，如果这不可能，是否有另一种方法可以做我想做的事情？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-08T23:28:54.283

我不会编写我自己的安装程序，但如果您真的想将文件嵌入到您的程序集中，您可以使用强类型资源。在项目的属性对话框中打开“资源”选项卡，然后添加您的文件。然后，您将能够使用以下方法获取文件：

```
ProjectNamespace.Properties.Resources.MyFile 
```

然后，您将能够使用以下方法将嵌入式资源写入磁盘：

```
System.IO.File.WriteAllBytes(@"C:\MyFile.bin", ProjectNamespace.Properties.Resources.MyFile); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-08T21:25:24.237

老实说，我建议您不要创建自己的安装程序。创建安装程序有很多问题。即使是大型安装程序制造商也不再制作自己的实际安装程序，他们只是创建自定义 MSI 包。

使用 Mirosoft 安装程序 (MSI)。这是正确的做法。为它制作自己的自定义前端，但不要重新创建已经存在的非常复杂的轮子。

更新：如果您只是为了学习而这样做，那么我会回避将其视为“安装程序”。有一天，您可能会很想进行“研究”并使用它，坦率地说，这就是当新版本的 Windows 出现时我们最终会遇到这么多问题的原因。人们用无效的假设创造自己的轮子。

您真正想要做的就是所谓的“打包”，而且您确实必须非常熟悉 Executable PE 格式，因为您正在谈论更改磁盘上 PE 映像的结构。

在某种程度上，您可以通过将文件放入资源中来模拟它，但这并不是安装程序或自解压器所做的。

这是[Self-Extractor](http://www.codeproject.com/KB/winsdk/selfextract.aspx)教程的链接，但它不在 C# 中。

我对 .NET PE 要求知之甚少，不知道您是否可以使用托管代码可执行文件来执行此操作。

UPDATE2：这可能是您正在寻找的更多内容，它将文件嵌入到资源中，但正如我所说，这并不是专业安装人员或自解压器的真正方式。我认为你可以嵌入资源有各种限制。但这里有一个用 C# 编写的[Self-Extractor Demo 。](http://www.codeproject.com/KB/cs/SelfExtractor.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-08T21:13:42.453

我在这里猜测，但如果您尝试在编译之前将资源存储在应用程序中，您可以在 Project Explorer 中，右键单击要添加的文件，选择属性并将类型更改为 Embedded Resource。

然后，您可以稍后使用此 KB 中的说明访问嵌入式资源：http: [//support.microsoft.com/kb/319292](http://support.microsoft.com/kb/319292)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T21:12:55.517

如果您只想将多个文件存储在单个文件存储中（并从那里提取文件、交互等），您可能还想查看 NFileStorage，一个[.net 文件存储](http://nfilestorage.codeplex.com ".net 文件存储")。用 100% .NET C# 编写，包括所有源代码。它还带有一个命令行解释器，允许从命令行进行交互。

# algorithm - 如何计算for循环执行期间发生的操作数？

> ID：526400
> 
> 赞同：5
> 
> 时间：2009-02-08T21:08:07.803
> 
> 标签：algorithm, for-loop

前几天我有考试，今天老师给了我们考试的关键答案。

其中一个问题是

> ```
> for ( j = 9; j >= 1; j-- ) 
> ```
> 
> 计算操作次数

结果是20。

谁能解释他如何从中获得 20 次手术？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-08T21:15:14.633

20 次操作：

```
set j = 9
check if j(9) >= 1
set j to 8
check if j(8) >= 1
set j to 7
check if j(7) >= 1
set j to 6
check if j(6) >= 1
set j to 5
check if j(5) >= 1
set j to 4
check if j(4) >= 1
set j to 3
check if j(3) >= 1
set j to 2
check if j(2) >= 1
set j to 1
check if j(1)>=1
set j to 0
check if j(0)>=1 
```

for( j=n ; j>=0 ; j-- )

好的，您从两个操作开始：

*   (j=n)
*   检查（j>=0）。

对于所有 n<0，它会停在那里。

如果 n=0，你会得到一个附加值：

*   j--
*   检查（j>=0）。

对于 n=1，你会得到另一组。

因此，对于 n<0，操作数为 2，对于 n>=0，操作数为 2n+4。

这些事情并不难。您只需要像计算机一样思考并仔细注意状态（变量集）的任何变化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T21:13:52.080

好吧，在第一次迭代中，`j`设置为`9`. 之后，每次迭代基本上都执行相同的两条指令：

*   首先，测试是否`j >= 1`和
*   第二，递减`j`（`j--`）。

这做了九次（从`9`包含到`0`包含）。在最后一次迭代中，我们再次测试是否`j >= 1`并且由于这是错误的，我们退出循环。因此，我们得到 1 + 9 * 2 + 1 = 20 次迭代。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T21:13:54.280

你写了什么值？只是好奇。

让我们一起数一数，玛雅：

```
for (j = 9; j >= 1; j--) 
```

一个用于将 9 分配给 j = 1；对于循环的每次迭代，将 j 的当前值与 1 进行一次比较 = 10；每次循环迭代 j 减一，除了最后一个 = 9；

1 + 10 + 9 = 20 在我的书中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T21:14:57.473

您有 1 个作业 (j=9)。"j--" 操作将运行 9 次；条件检查 "j>=1" 将运行 10 次（每次迭代你问问题 "is j>=1"），最后一次将失败。所以你有 1 + 9 + 10 = 20。

如果您的教练如此卑鄙以至于不提供帮助，那他就非常非常糟糕。这是您得到或没有得到的问题之一。导师应该帮忙。:)

# fonts - 创建 PostScript/TrueType 字体

> ID：526402
> 
> 赞同：3
> 
> 时间：2009-02-08T21:09:04.493
> 
> 标签：fonts, character, generator, file-format, vector-graphics

我有字母的坐标（例如使用 SVG）。如何为我的计算机生成 TrueType/PostScript 字体？

（已**编辑**：将*矢量*更改为 TrueType/PostScript）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T23:03:28.323

规范的字体编辑工具是[Fontographer](http://www.fontlab.com/font-editor/fontographer)和[Ikarus](http://www.fonttools.org/)（现在是 Fontmaster 的一部分）。还有一些免费工具。Adobe Type 1 字体规范可以在[这里](http://partners.adobe.com/public/developer/en/font/T1_SPEC.PDF)找到，OpenType 规范可以在[这里找到。](http://www.microsoft.com/typography/otspec/default.htm)

设计一种运行良好的字体并非易事。字体利用了很多光学技巧来使它们看起来平衡。一些关键是：

有些字母会略高于其他字母，以避免使它们的外观不均匀。例如，大写字母 '`A'`或 ' `O`' 可能略高于大写字母 ' `I`'，因为这样做是必要的，[因此高度看起来均匀。](http://books.google.co.uk/books?id=b40C60hN0KcC&pg=PA39&lpg=PA39&dq=font+design+optical+illusions&source=web&ots=Li2huxoqtH&sig=bVF7U7kG31V7o4bIOTIzZVZx7_c&hl=en&ei=k2CPSfWSO-TGjAeNu7iiCg&sa=X&oi=book_result&resnum=4&ct=result) 如果您还没有这样做，您可能需要稍微摆弄轮廓。

[提示](http://en.wikipedia.org/wiki/Font_hinting)为光栅化程序提供了[额外的信息](http://www.microsoft.com/typography/TrueTypeHintingIntro.mspx)，以确保应该相同宽度的东西被渲染。有[各种](http://www.microsoft.com/typography/hinting/tutorial.htm) [教程](http://dejavu-fonts.org/wiki/index.php?title=Hinting_tutorial) [可以](http://www.andrew.cmu.edu/user/twm/makefont/)讨论该主题的基础知识和一些书籍。

最后，您需要整理[字母](http://en.wikipedia.org/wiki/Letter-spacing)间距和[字距调整对。](http://en.wikipedia.org/wiki/Kerning) 如果您的字体是仅显示字体，那么这不太重要，因为您始终可以手动调整字体紧缩。如果要在其中设置文本正文，则必须解决此问题，否则文本看起来会很粗糙。

这不是一项简单的任务，因为需要完成的组合数量很多。从历史上看，这占字体构建总工作量的很大一部分——通常是 80% 或更多。网络上有教程，市场上有不少字体设计书籍对此进行了详细介绍。您可能还想挑选其他字体的字距对数据（可以在相关的字体度量文件中找到）并查看其他人做了什么。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T02:43:31.053

> 我有字母的坐标。如何生成 TrueType/PostScript 字体

以编程方式？我已经用 Python 和[TTX](http://www.letterror.com/code/ttx/)完成了。不是很漂亮，但将向量放入 TTF 文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T21:40:47.477

你可以看看[FontForge](http://fontforge.sourceforge.net/)丑陋但功能强大的字体编辑器。它还可以导入 SVG。

# python - Python 时间老化，第 2 部分：时区

> ID：526406
> 
> 赞同：22
> 
> 时间：2009-02-08T21:12:03.847
> 
> 标签：python, datetime, timezone

继我之前的问题*[Python time to age](https://stackoverflow.com/questions/508727/python-time-to-age)*之后，我现在遇到了一个关于时区的问题，事实证明它并不总是“+0200”。所以当 strptime 试图解析它时，它会抛出一个异常。

我想过用 [:-6] 或其他什么来切断 +0200，但是有没有真正的方法可以用 strptime 做到这一点？

如果重要的话，我正在使用 Python 2.5.2。

```
>>> from datetime import datetime
>>> fmt = "%a, %d %b %Y %H:%M:%S +0200"
>>> datetime.strptime("Tue, 22 Jul 2008 08:17:41 +0200", fmt)
datetime.datetime(2008, 7, 22, 8, 17, 41)
>>> datetime.strptime("Tue, 22 Jul 2008 08:17:41 +0300", fmt)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/lib/python2.5/_strptime.py", line 330, in strptime
    (data_string, format))
ValueError: time data did not match format:  data=Tue, 22 Jul 2008 08:17:41 +0300  fmt=%a, %d %b %Y %H:%M:%S +0200 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-09T02:22:49.683

> 有没有真正的方法可以用 strptime 做到这一点？

[不，但由于您的格式似乎是 RFC822 系列日期，您可以使用电子邮件](http://docs.python.org/library/email.util.html#email.utils.parsedate_tz)库更轻松地阅读它：

```
>>> import email.utils
>>> email.utils.parsedate_tz('Tue, 22 Jul 2008 08:17:41 +0200')
(2008, 7, 22, 8, 17, 41, 0, 1, 0, 7200) 
```

（7200 = 与 UTC 的时区偏移，以秒为单位）

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-02-08T21:30:13.290

> 2.6 版中的新功能。
> 
> 对于一个天真的对象，%z 和 %Z 格式代码被空字符串替换。

看起来这仅在> = 2.6中实现，我认为您必须手动解析它。

除了删除时区数据，我看不到其他解决方案：

```
from datetime import timedelta,datetime
try:
    offset = int("Tue, 22 Jul 2008 08:17:41 +0300"[-5:])
except:
    print "Error"

delta = timedelta(hours = offset / 100)

fmt = "%a, %d %b %Y %H:%M:%S"
time = datetime.strptime("Tue, 22 Jul 2008 08:17:41 +0200"[:-6], fmt)
time -= delta 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-03-12T14:48:06.807

您可以使用`dateutil`非常有用的库：

```
from datetime import datetime
from dateutil.parser import parse

dt = parse("Tue, 22 Jul 2008 08:17:41 +0200")
## datetime.datetime(2008, 7, 22, 8, 17, 41, tzinfo=tzoffset(None, 7200)) <- dt

print dt
2008-07-22 08:17:41+02:00 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T21:25:06.483

据我所知，`strptime()`不识别数字时区代码。如果您知道字符串总是以该形式的时区规范结束（+ 或 - 后跟 4 位数字），那么将其剪掉并手动解析似乎是一件非常合理的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T23:23:29.240

似乎 %Z 对应于时区名称，而不是偏移量。

例如，给定：

```
>>> format = '%a, %d %b %Y %H:%M:%S %Z' 
```

我可以解析：

```
>>> datetime.datetime.strptime('Tue, 22 Jul 2008 08:17:41 GMT', format)
datetime.datetime(2008, 7, 22, 8, 17, 41) 
```

虽然它似乎对时区没有任何作用，只是观察它存在并且有效：

```
>>> datetime.datetime.strptime('Tue, 22 Jul 2008 08:17:41 NZDT', format)
datetime.datetime(2008, 7, 22, 8, 17, 41) 
```

我想如果您愿意，您可以找到偏移量到名称的映射，转换您的输入，然后解析它。不过，截断您的输入可能更简单。

# uml - 如何在序列图中表示在循环中进行的调用？

> ID：526410
> 
> 赞同：52
> 
> 时间：2009-02-08T21:13:33.080
> 
> 标签：uml, sequence-diagram

我正在创建一个序列图，其中一个类正在被另一个类观察。被观察的类在循环中每 5 秒在观察者中调用一次更新。我需要在序列图中显示这一点。有没有办法显示它无限期地乱序循环？

还是在序列图的上下文中没有意义；我不应该包括它吗？或者我应该将它包含在不同类型的图表中吗？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-02-08T21:51:29.617

您可以使用一个包含消息发送箭头的框（以及同一重复结构中的任何其他内容）。

有关示例，请参阅[本教程](https://www.ibm.com/developerworks/rational/library/content/RationalEdge/feb04/3101.pdf)。

![带循环的序列图](https://i.stack.imgur.com/I3ZdK.jpg) [链接到更大的图像](http://www.ibm.com/developerworks/rational/library/content/RationalEdge/feb04/3101_figure10.html) [（存档）](https://web.archive.org/web/20150213005528/http://www.ibm.com/developerworks/rational/library/content/RationalEdge/feb04/3101_figure10.html)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2018-11-19T14:37:38.893

只是添加一张更清晰的图片，因为@joel.tony 的答案是该死的模糊。

[![在此处输入图像描述](https://i.stack.imgur.com/O2hYp.gif)](https://i.stack.imgur.com/O2hYp.gif)

如您所见，循环发生在称为*loop n*的框架内。有一个守卫，*array_size*，它控制循环的迭代。

总之，*循环 n*帧内的消息序列（`DataControl`和`DataSource`对象之间的消息）将发生*array_size*次。

# mysql - 在 MySQL 中实现计数器字段的最佳方法是什么

> ID：526420
> 
> 赞同：6
> 
> 时间：2009-02-08T21:17:08.657
> 
> 标签：mysql

我想开始计算网页被查看的次数，因此需要某种简单的计数器。这样做的最佳可扩展方法是什么？

假设我有一个表格 Frobs，其中每一行对应一个页面 - 一些明显的选项是：

1.  在 Frobs 表中有一个 unsigned int NumViews 字段，每个视图使用`UPDATE Frobs SET NumViews = NumViews + 1`. 据我了解，简单但不擅长缩放。

2.  有一个单独的表 FrobViews，其中为每个视图插入一个新行。要显示查看次数，您需要做一个简单的`SELECT COUNT(*) AS NumViews FROM FrobViews WHERE FrobId = '%d' GROUP BY FrobId`. 这不涉及任何更新，因此可以避免 MyISAM 表中的表锁定 - 但是，如果您想显示每个页面上的视图数量，读取性能将受到影响。

你怎么做呢？

这里有一些很好的建议： [http](http://www.mysqlperformanceblog.com/2007/07/01/implementing-efficient-counters-with-mysql/) ://www.mysqlperformanceblog.com/2007/07/01/implementing-efficient-counters-with-mysql/ 但我想听听 SO 社区的意见。

我目前正在使用 InnoDb，但对 InnoDb 和 MyISAM 的答案很感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T22:50:27.247

如果可伸缩性对您来说比数字的绝对准确性更重要，那么您可以在应用程序中短时间缓存视图计数，而不是在每个页面视图上都访问数据库 - 例如，每 100 次视图只更新一次数据库。

如果您的应用程序在数据库更新之间崩溃，那么显然您会丢失一些数据，但如果您可以容忍一定程度的不准确性，那么这可能是一种有用的方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-14T19:35:55.873

插入数据库不是您想要在页面视图上执行的操作。由于复制在 MySQL 上是单线程的，因此您可能会在使用所有插入更新从属数据库时遇到问题。

在我的公司，我们每天提供 2500 万次页面浏览量，并且我们采取了分层方法。

视图计数器存储在具有 2 列（profileId、viewCounter）的单独表中，它们都是无符号整数。

对于不常查看的项目，我们会更新页面视图中的表格。对于经常查看的项目，我们大约有 1/10 的时间更新 MySQL。对于这两种类型，我们都会在每次点击时更新 Memcache。
`int Memcache::increment ( string $key [, int $value = 1 ] )`

`if (pageViews < 10000) { UPDATE page_view SET viewCounter=viewCounter+1 WHERE profileId = :? }`

`else if ((int)rand(10) == 1) { //UPDATE page_view SET viewCounter= ?:cache_value WHERE profileId = :? }`

在 InnoDB 中执行 count(*) 效率非常低（MyISAM 将计数统计信息保存在索引中），但 MyISAM 会在读取时锁定表，从而降低并发性。对 50,000 或 100,000 行执行 count() 将需要很长时间。在 PK 上进行选择会非常快。

如果你需要更多的可扩展性，你可能想看看[redis](http://redis.io/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T21:20:46.040

我会采用您的第二种方法，并定期将您的第一个解决方案中的数据汇总到表格中。通过这种方式，您可以获得两种解决方案的优势。更清楚一点：每次点击时，您都会在表中插入一行（让我们将其命名为 hit_counters）。该表只有一个字段（pageid）。每隔 x 秒，您运行一个脚本（通过 cronjob），该脚本汇总来自 hit_counters 表的数据并将其放入第二个表中（我们将其命名为“命中”。您有两个字段：pageid 和总命中数。

我不确定，但恕我直言，如果您在同一页面上获得很多点击，innodb 对解决方案 1 的帮助不大：Innodb 在更新时锁定该行，因此对该行的所有其他更新都将被延迟。

根据您编写的程序的内容，您还可以通过计算您的应用程序并仅每 x 秒更新一次数据库来批量更新。这仅在您使用具有持久性存储的编程语言（如 Java Servlet 但不是 PHP）时才有效

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T22:56:11.757

我所做的（可能不适用于您的场景）是在准备/返回页面上显示的数据的存储过程中，我在返回数据的同时更新表计数器 - 那样，那里只是对服务器的一次调用，既获取数据，又在同一次调用中更新计数器。

如果您不使用 SP，（或者如果您的页面上没有数据库数据）您可能无法使用此选项，但如果您使用了，则需要考虑。

# javascript - jQuery - Internet Explorer 7 的兼容性问题？

> ID：526424
> 
> 赞同：0
> 
> 时间：2009-02-08T21:18:58.900
> 
> 标签：javascript, jquery, internet-explorer, cross-browser

我有这段代码，当鼠标悬停在图像上时，它会动态地将 Div 向上滑动。它在 Firefox 和 Google Chrome 中完美运行，但在 Internet Explorer 7 中，一切都运行得很慢，什么也没有发生。

jquery 代码是这样的：

```
jQuery.fn.masque = function(class) {

$(this).hover(function(){
$(this).find(class).stop().animate({height:'100px',opacity: '0.9'},400);
},function () { 
$(this).find(class).stop().animate({height:'0',opacity: '0'}, 300);
});
}
$(document).ready(function(){$('.thumb').masque('.masque');}); 
```

的HTML：

```
<div class="thumb bg25">
    <a href="#"><img src="img/image.jpg" alt="Something" /></a>
        <div class="masque">
            <h3 class="someclass"><a href="#" >Some text here</a></h3>
            <p class="someclass">Some text here</p>
            <p class="someclass">Some text here</p>
        </div>
</div> 
```

这是CSS：

```
.thumb {float:left; margin:0 14px 14px 0; width:126px; height:186px; padding:10px; position:relative;}

.masque{position:absolute; background:#212326; width:118px; bottom:10px; height:0; padding:4px; display:none;} 
```

我;从本地机器上运行它，而不是在服务器上。

..所以我认为我做错了什么，也许有一种有效的方法可以实现这种效果。谢谢！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T21:23:28.157

您是否尝试过关闭 stop() ？我完全在黑暗中拍摄，但我认为 IE7 可能会以不同的方式排队呼叫。我现在就测试一下。

## 更新

在测试它之后，由于名为类的变量，我在 IE7 中遇到了一些奇怪的错误。那一定是某种关键字。试试这个。

```
jQuery.fn.masque = function(classSelector) {
        $(this).hover(function(){
                $(this).find(classSelector).stop().animate({height:'100px',opacity: '0.9'},400);
        },function () {
            $(this).find(classSelector).stop().animate({height:'0',opacity: '0'}, 300);
        });
}; 
```

## 更新

你试过使用 slideUp 和 slideDown 吗？

```
jQuery.fn.masque = function(classSelector) {
    $(this).hover(function(){
        $(this).find(classSelector).slideDown();
    },function () {
        $(this).find(classSelector).slideUp();
    });
}; 
```

# c - C 编程：如何为 Unicode 编程？

> ID：526430
> 
> 赞同：86
> 
> 时间：2009-02-08T21:22:15.820
> 
> 标签：c, unicode, utf-8, character-encoding, locale

进行严格的 Unicode 编程需要哪些先决条件？

这是否意味着我的代码不应该`char`在任何地方使用类型，并且需要使用可以处理和的`wint_t`函数`wchar_t`？

而多字节字符序列在这个场景中起到什么作用呢？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-02-09T07:00:49.923

### C99 或更早版本

C 标准 (C99) 提供了宽字符和多字节字符，但由于无法保证这些宽字符可以容纳什么，因此它们的价值受到了一定的限制。对于给定的实现，它们提供了有用的支持，但是如果您的代码必须能够在实现之间移动，则不能充分保证它们是有用的。

因此，Hans van Eck 建议的方法（即围绕 ICU - Unicode 的国际组件 - 库编写一个包装器）是合理的，IMO。

UTF-8 编码有很多优点，其中之一是如果你不弄乱数据（例如截断它），那么它可以被不完全了解 UTF-8 复杂性的函数复制编码。绝对不是这种情况`wchar_t`。

完整的 Unicode 是 21 位格式。也就是说，Unicode 保留了从 U+0000 到 U+10FFFF 的代码点。

关于 UTF-8、UTF-16 和 UTF-32 格式（其中 UTF 代表 Unicode 转换格式 - 请参阅[Unicode](http://unicode.org/)）的有用之处之一是您可以在这三种表示之间进行转换而不会丢失信息。每个人都可以代表其他人可以代表的任何事物。UTF-8 和 UTF-16 都是多字节格式。

众所周知，UTF-8 是一种多字节格式，其结构严谨，可以可靠地找到字符串中字符的开头，从字符串中的任何点开始。单字节字符的高位设置为零。多字节字符的第一个字符以位模式 110、1110 或 11110（对于 2 字节、3 字节或 4 字节字符）之一开头，后续字节总是从 10 开始。连续字符总是在范围 0x80 .. 0xBF。有一些规则要求 UTF-8 字符必须以尽可能少的格式表示。这些规则的一个后果是字节 0xC0 和 0xC1（也是 0xF5..0xFF）不能出现在有效的 UTF-8 数据中。

```
 U+0000 ..   U+007F  1 byte   0xxx xxxx
 U+0080 ..   U+07FF  2 bytes  110x xxxx   10xx xxxx
 U+0800 ..   U+FFFF  3 bytes  1110 xxxx   10xx xxxx   10xx xxxx
U+10000 .. U+10FFFF  4 bytes  1111 0xxx   10xx xxxx   10xx xxxx   10xx xxxx 
```

最初，人们希望 Unicode 是一个 16 位的代码集，并且一切都适合 16 位的代码空间。不幸的是，现实世界更加复杂，不得不将其扩展到当前的 21 位编码。

因此，UTF-16 是“基本多语言平面”的单个单元（16 位字）代码集，这意味着具有 Unicode 代码点 U+0000 .. U+FFFF 的字符，但使用两个单元（32 位）来表示此范围之外的字符。因此，使用 UTF-16 编码的代码必须能够处理可变宽度编码，就像 UTF-8 一样。双单元字符的代码称为代理。

> 代理是来自两个特殊范围的 Unicode 值的代码点，保留用作 UTF-16 中成对代码单元的前导和尾随值。前导（也称为高）代理从 U+D800 到 U+DBFF，尾随或低代理从 U+DC00 到 U+DFFF。它们被称为代理，因为它们不直接表示字符，而只是作为一对。

当然，UTF-32 可以在单个存储单元中编码任何 Unicode 代码点。它对计算有效，但对存储无效。

[您可以在ICU](http://icu-project.org/)和 Unicode 网站上找到更多信息。

### C11 和`<uchar.h>`

C11 标准改变了规则，但即使是现在（2017 年年中），也不是所有的实现都赶上了这些变化。C11 标准将 Unicode 支持的更改总结为：

> *   Unicode 字符和字符串 ( `<uchar.h>`)（最初在 ISO/IEC TR 19769:2004 中指定）

以下是功能的最小概述。该规范包括：

> ### 6.4.3 通用字符名称
> 
> **语法**
> *Universal-character-name:*
>     `\u` *hex-quad*
>     `\U` *hex-quad hex-quad*
> *hex-quad:*
>     *十六进制数字 hexadecimal-digit hexadecimal-digit hexadecimal-digit*
> 
> ### 7.28 Unicode 实用程序`<uchar.h>`
> 
> 标头`<uchar.h>`声明了用于操作 Unicode 字符的类型和函数。
> 
> 声明的类型是`mbstate_t`（在 7.29.1 中描述）和`size_t`（在 7.19 中描述）；
> 
> ```
> char16_t 
> ```
> 
> 它是用于 16 位字符的无符号整数类型，与`uint_least16_t`（在 7.20.1.2 中描述）的类型相同；和
> 
> ```
> char32_t 
> ```
> 
> 它是用于 32 位字符的无符号整数类型，与`uint_least32_t`（也在 7.20.1.2 中描述）相同。

（翻译交叉引用：`<stddef.h>`defines `size_t`、 `<wchar.h>`defines `mbstate_t`、defines 和`<stdint.h>`defines`uint_least16_t`和`uint_least32_t`。）`<uchar.h>`头文件还定义了一组最小的（可重新启动的）转换函数：

> *   `mbrtoc16()`
> *   `c16rtomb()`
> *   `mbrtoc32()`
> *   `c32rtomb()`

有关于哪些 Unicode 字符可以在标识符中使用的规则，使用`\unnnn`or`\U00nnnnnn`符号。您可能必须主动激活对标识符中此类字符的支持。例如，GCC 要求`-fextended-identifiers`在标识符中允许这些。

请注意，macOS Sierra (10.12.5)，仅举一个平台，不支持`<uchar.h>`.

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-08T22:44:06.560

请注意，这不是关于“严格的 unicode 编程”本身，而是一些实践经验。

我们在我公司所做的是围绕 IBM 的 ICU 库创建一个包装库。包装库有一个 UTF-8 接口，在需要调用 ICU 时转换为 UTF-16。在我们的例子中，我们并不太担心性能下降。当性能成为问题时，我们还提供了 UTF-16 接口（使用我们自己的数据类型）。

应用程序可以基本保持原样（使用 char），尽管在某些情况下它们需要注意某些问题。例如，我们使用包装器代替 strncpy() 来避免切断 UTF-8 序列。在我们的例子中，这已经足够了，但也可以考虑检查组合字符。我们还有用于计算代码点数量、字素数量等的包装器。

在与其他系统交互时，我们有时需要进行自定义角色组合，因此您可能需要一些灵活性（取决于您的应用程序）。

我们不使用 wchar_t。使用 ICU 避免了可移植性方面的意外问题（但不是其他意外问题，当然 :-)。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-09T16:34:13.867

此[常见问题解答](http://www.cl.cam.ac.uk/~mgk25/unicode.html)包含大量信息。在该页面和[Joel Spolsky 的这篇文章](http://www.joelonsoftware.com/articles/Unicode.html)之间，您将有一个良好的开端。

我在此过程中得出的一个结论：

*   `wchar_t`在 Windows 上是 16 位，但在其他平台上不一定是 16 位。我认为这在 Windows 上是必要的邪恶，但可能可以在其他地方避免。它在 Windows 上很重要的原因是您需要它来使用名称中包含非 ASCII 字符的文件（以及 W 版本的函数）。

*   请注意，采用`wchar_t`字符串的 Windows API 需要 UTF-16 编码。另请注意，这与 UCS-2 不同。注意代理对。这个[测试页面](http://www.cl.cam.ac.uk/~mgk25/ucs/examples/UTF-8-test.txt)有启发性的测试。

*   如果您在 Windows 上编程，则不能使用`fopen()`, `fread()`,`fwrite()`等，因为它们只接受`char *`并且不理解 UTF-8 编码。使便携性变得痛苦。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-08T21:56:31.727

要进行严格的 Unicode 编程：

*   仅使用支持 Unicode 的字符串 API（*NOT* `strlen` , `strcpy`, ... 但它们的宽字符串对应物`wstrlen`, `wsstrcpy`, ...）
*   处理文本块时，使用允许存储 Unicode 字符（utf-7、utf-8、utf-16、ucs-2、...）而不会丢失的编码。
*   检查您的操作系统默认字符集是否与 Unicode 兼容（例如：utf-8）
*   使用与 Unicode 兼容的字体（例如 arial_unicode）

多字节字符序列是一种早于 UTF-16 编码（通常与 UTF-16 一起使用的编码）的编码，`wchar_t`在我看来它仅适用于 Windows。

我从来没有听说过`wint_t`。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-08-18T13:45:18.050

最重要的是**始终明确区分文本和二进制数据**。尝试遵循[Python 3.x `str`vs.`bytes`](http://diveintopython3.org/strings.html)或 SQL `TEXT`vs.的模型`BLOB`。

不幸的是，C 将`char`“ASCII 字符”和`int_least8_t`. 您需要执行以下操作：

```
typedef char UTF8; // for code units of UTF-8 strings
typedef unsigned char BYTE; // for binary data 
```

您可能还需要 UTF-16 和 UTF-32 代码单元的 typedef，但这更复杂，因为`wchar_t`未定义编码。你只需要一个预处理器`#if`。C 和 C++0x 中一些有用的宏是：

*   `__STDC_UTF_16__`— 如果已定义，则类型`_Char16_t`存在且为 UTF-16。
*   `__STDC_UTF_32__`— 如果已定义，则类型`_Char32_t`存在且为 UTF-32。
*   `__STDC_ISO_10646__`— 如果已定义，`wchar_t`则为 UTF-32。
*   `_WIN32`— 在 Windows 上，`wchar_t`是 UTF-16，尽管这违反了标准。
*   `WCHAR_MAX`— 可用于确定 的大小`wchar_t`，但不能确定操作系统是否使用它来表示 Unicode。

> 这是否意味着我的代码不应该在任何地方使用 char 类型并且需要使用可以处理 wint_t 和 wchar_t 的函数？

也可以看看：

*   [UTF-8 或 UTF-16 或 UTF-32 或 UCS-2](https://stackoverflow.com/questions/3473295/utf-8-or-utf-16-or-utf-32-or-ucs-2/)
*   [Unicode 支持需要 wchar_t 吗？](https://stackoverflow.com/questions/2259544/is-wchar-t-needed-for-unicode-support)

不，UTF-8 是一种使用`char*`字符串的完全有效的 Unicode 编码。它的优点是，如果您的程序对非 ASCII 字节是透明的（例如，一个行尾转换器，它作用于`\r`并`\n`通过其他字符不变），您根本不需要进行任何更改！

如果您使用 UTF-8，则需要更改`char`= 字符（例如，不要`toupper`在循环中调用）或`char`= 屏幕列（例如，用于文本换行）的所有假设。

如果您使用 UTF-32，您将拥有固定宽度字符的简单性（但不是固定宽度*字形*，但需要更改所有字符串的类型）。

如果您使用 UTF-16，您将不得不放弃固定宽度字符*的*假设和 8 位代码单元的假设，这使得这是从单字节编码升级最困难的路径。

我建议积极**避免** `wchar_t`，因为它不是跨平台的：有时是 UTF-32，有时是 UTF-16，有时是预 Unicode 东亚编码。我建议使用`typedefs`

更重要的是，[避免`TCHAR`](http://koverflow.com/questions/234365/is-tchar-still-relevant/3002494#3002494).

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-09T06:03:11.167

据我所知， wchar_t 是依赖于实现的（从这篇[wiki 文章](http://en.wikipedia.org/wiki/Wide_character)可以看出）。而且它不是unicode。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-09T06:40:42.903

您基本上希望将内存中的字符串作为`wchar_t`数组而不是 char 来处理。当您执行任何类型的 I/O（如读取/写入文件）时，您可以使用 UTF-8（这可能是最常见的编码）进行编码/解码，这很容易实现。只需谷歌 RFC。所以在内存中没有什么应该是多字节的。一个`wchar_t`代表一个字符。然而，当你开始序列化时，你需要编码为 UTF-8 之类的东西，其中一些字符由多个字节表示。

您还必须`strcmp`为宽字符串编写 etc. 的新版本，但这不是一个大问题。最大的问题将是与只接受 char 数组的库/现有代码的互操作。

当涉及到`sizeof(wchar_t)`（如果你想正确地做，你将需要 4 个字节），你可以随时使用`typedef`/ `macro`hacks 将它重新定义为更大的大小，如果你需要的话。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-03-29T18:45:44.073

我不会相信任何标准库的实现。只需滚动您自己的 unicode 类型。

```
#include <windows.h>

typedef unsigned char utf8_t;
typedef unsigned short utf16_t;
typedef unsigned long utf32_t;

int main ( int argc, char *argv[] )
{
  int msgBoxId;
  utf16_t lpText[] = { 0x03B1, 0x0009, 0x03B2, 0x0009, 0x03B3, 0x0009, 0x03B4, 0x0000 };
  utf16_t lpCaption[] = L"Greek Characters";
  unsigned int uType = MB_OK;
  msgBoxId = MessageBoxW( NULL, lpText, lpCaption, uType );
  return 0;
} 
```

# php - 您只在输出上运行 htmlspecialchars() 还是您还执行其他功能？

> ID：526438
> 
> 赞同：5
> 
> 时间：2009-02-08T21:25:16.453
> 
> 标签：php, xss, escaping, htmlspecialchars

输出用户输入时，您是否只使用`htmlspecialchars()`或是否有您还运行的功能/动作/方法？我正在寻找也可以处理 XSS 的东西。

我想知道我是否应该编写一个在输出上转义用户输入的函数，或者只使用`htmlspecialchars()`. 我正在寻找一般案例，而不是可以单独处理的特定案例。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-08T21:27:19.520

我通常使用

```
htmlspecialchars($var, ENT_QUOTES) 
```

在输入字段上。我创建了一个这样做的方法，因为我经常使用它，它使代码更短且更具可读性。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-09T04:03:49.020

**让我们快速回顾一下为什么在不同的情况下需要转义：**

如果您在引号分隔的字符串中，则需要能够转义引号。如果在xml中，则需要将“内容”与“标记”分开如果在SQL中，则需要将“命令”与“数据”分开如果在命令行上，则需要将“命令”分开来自“数据”

这是一般计算的一个非常基本的方面。因为分隔数据的语法可能出现在数据中，所以需要有一种方法来区分数据和语法，因此需要转义。

在网络编程中，常见的转义情况有： 1\. 将文本输出到 HTML 2\. 将数据输出到 HTML 属性 3\. 将 HTML 输出到 HTML 4\. 将数据插入到 Javascript 5\. 将数据插入到 SQL 6\. 将数据插入到 shell 命令中

如果处理不当，每一个都有不同的安全隐患。这真的很重要！让我们在 PHP 的上下文中回顾一下：

1.  将文本转换为 HTML：htmlspecialchars(...)

2.  数据转化为 HTML 属性 htmlspecialchars(..., ENT_QUOTES)

3.  HTML 到 HTML 使用诸如[HTMLPurifier](http://htmlpurifier.org/)之类的库来确保只存在有效的标签。

4.  我更喜欢将数据转换为 Javascript `json_encode`。如果是放在一个属性中，还是需要使用#2，比如

5.  将数据插入 SQL 每个驱动程序都有某种形式的 escape() 函数。这是最好的。如果你在一个普通的 latin1 字符集中运行，addslashes(...) 是合适的。不要忘记 addlashes() 调用周围的引号：

    "INSERT INTO table1 SET field1 = '" 。添加斜杠（$data）。"'"

6.  命令行 escapeshellarg() 和 escapeshellcmd() 上的数据——阅读手册

-- 牢记这些，您将消除 95%* 的常见网络安全风险！（* 一个猜想）

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2009-02-09T21:33:55.237

您不应该在输出时清理文本，它应该在输入时发生。我使用过滤器过滤应用程序的所有输入。它是可配置的，因此它可以在需要时允许特定的标签/数据通过（例如，对于所见即所得的编辑器）。

您应该尽可能少地处理输出文本，以确保速度。处理一次会产生更少的压力，然后处理 500,0000 次。

# c# - 全局禁止 c# 编译器警告

> ID：526443
> 
> 赞同：26
> 
> 时间：2009-02-08T21:28:39.737
> 
> 标签：c#, compiler-warnings, suppress

在我的应用程序中，我有相当多的实体具有通过反射设置其值的字段。（在这种情况下，NHibernate 正在设置它们）。我想摆脱“x 从未分配给并且将始终具有其默认值 0”警告，因此我可以更轻松地挑选出其他警告。我意识到您可以将它们包含在编译指示指令中，但是 AFAIK 您必须为每个指令执行此操作。是否有一个项目范围或解决方案范围的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-02-08T21:32:55.840

使用 C# 命令行选项 /nowarn [http://msdn.microsoft.com/en-us/library/7f28x9z3(VS.80).aspx](http://msdn.microsoft.com/en-us/library/7f28x9z3(VS.80).aspx)

要在 Visual Studio 中执行此操作，请转到**Project properties->Build->(Errors and warnings) Suppress Warnings**，然后指定一个逗号分隔的需要抑制的警告列表。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-08T21:34:15.680

打开项目属性，在构建选项卡上，在 Suppress warnings: 框中输入要隐藏的警告 ID。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-03-31T11:42:05.053

VC++ XML 标记是 <DisableSpecificWarnings/> ，带有分号分隔的数字 ID 列表。这似乎没有记录在我能看到的任何地方，但仅供参考。

# perl - 如何旋转和压缩 Log4perl 日志文件？

> ID：526446
> 
> 赞同：10
> 
> 时间：2009-02-08T21:29:09.547
> 
> 标签：perl, rotation, log4perl

据我所知，Log4Perl 或其在 CPAN 中的任何相关模块都不支持日志文件的旋转和压缩。

旋转可以通过使用来完成：

1.  [日志::Log4perl::Appender::文件](http://log4perl.sourceforge.net/releases/Log-Log4perl/docs/html/Log/Log4perl/Appender/File.html)
2.  [日志::调度::文件旋转](http://search.cpan.org/~markpf/Log-Dispatch-FileRotate/FileRotate.pm)。

但是两个模块都不支持旋转*和*压缩。（Log::Dispatch::FileRotate 在它的待办事项列表中有它，但它目前没有实现）。

可以使用 Linux 中的标准[Logrotate](http://iain.cx/src/logrotate/)工具来执行此操作，方法是使用 Log::Log4perl::Appender::File 的 recreate_check_interval 或 recreate_check_signal。

从最初的测试来看，使用带有[delaycompress](http://iain.cx/src/logrotate/)选项的 Logrotate 似乎可以解决问题——即使在高负载的机器上，一旦文件被移动，log4perl 将继续记录到同一个文件句柄，直到信号被输出。

但是，如果没有使用 delaycompress，并且在日志文件的压缩和 Perl 程序捕获信号之间存在（甚至是轻微的延迟），则可能会丢失一些日志数据。

你怎么看？还有其他我们没有想到的选择吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-27T17:40:57.400

多年来，我发现您几乎总是希望使用*外部*方法来使用 Log4perl 进行日志文件轮换。您只需避免内部日志轮换不可避免地遇到的许多微妙问题（日志延迟、权限问题）。

您已经提到了在 Linux 上使用 logrotate 的两种方法，为什么不坚持使用它们呢？Log4perl [FAQ 描述了使用 newsyslog](http://search.cpan.org/dist/Log-Log4perl/lib/Log/Log4perl/FAQ.pm#How_can_I_rotate_a_logfile_with_newsyslog)，它是 FreeBSD 的 logrotate 等价物，并提供类似的功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T16:17:15.080

我按照这里的建议联系了 Log::Dispatch::FileRotate 的作者，他解释了 Log::Dispatch::FileRotate 中尚未实现压缩的原因。

基本上，在旋转后立即压缩可能会在压缩过程中阻塞运行过程，这非常昂贵。

建议的选项是允许 Log::Dispatch::FileRotate 的用户在旋转之后对文件执行任意应用程序，从而在另一个非阻塞进程中执行此操作。

另一个建议是让文件系统触发器（如[inotify](http://en.wikipedia.org/wiki/Inotify)）在文件关闭以由主进程写入时触发压缩。

另一个建议是编写通过 gzip 管道或 perl gzip 模块之一压缩的日志文件。这可行，但会导致一些问题（grep/less）不起作用。zgrep 和 zless 可以工作，但是 zgrep 会在对仍然打开以供写入的 gzip 文件进行 grep 时发出难看的警告。在文件上使用“tail”也不起作用 - 所以这个选项不实用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-09T02:01:03.667

您是否考虑过与 Log::Dispatch::FileRotate 的维护者合作来添加它缺少的和您需要的功能？毕竟它是开源的。:)

如果您不想自己处理，有各种 CPAN 支持咨询公司可以为您做这件事。

# jquery - 在列表项上调用 show() 使其成为块元素并使项目符号消失

> ID：526449
> 
> 赞同：0
> 
> 时间：2009-02-08T21:30:11.463
> 
> 标签：jquery

我是 JQuery 的新手，但我基本上是从创建列表创建者开始的。我有一个空列表和一个输入字段以及一个链接，供用户将元素添加到列表中。当我添加一些东西时，我希望它首先被隐藏，然后使用 JQuery 动态显示。目前，它将它添加到列表中，但它设置了`display: block`而不是`display:list-item`或根本没有。难道我做错了什么？

所以这里有一些代码

```
$('a#addstep').click(function() {
    if ( $('#step').val().length > 0 ) {
        $('<li />')
            .text($('#step').val())
            .hide()
            .appendTo('ol#instructions')
            .show('normal');
    }
}); 
```

这是一些HTML

```
<ol id="instructions"></ol>
<input type="text" id="step" size="60" />
<a href="#" id="addstep">Add</a> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T21:42:32.603

我不确定为什么要添加额外的调用来显示/隐藏。当您添加一个项目时，它会显示它。请进一步解释为什么需要显示/隐藏。

如果你绝对必须。

```
$('a#addstep').click(function() {    
    if ( $('#step').val().length > 0 ) {        
        $('<li />')            
        .text($('#step').val())            
        .hide()            
        .appendTo('ol#instructions')            
        .show('normal', function() {
            $(this).css('display', 'list-item')
        });    
    }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T21:40:57.443

尝试使用

> (".theclass").css("display", "inline {or your desired value}");

而不是 show('normal')

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T21:48:59.920

试试这个（未经测试）：

```
$('a#addstep').click(function() {
    if ( $('#step').val().length > 0 ) {
        $('<li />')
            .css('display', 'list-item')   // ADDED
            .text($('#step').val())
            .hide()
            .appendTo('ol#instructions')
            .show('normal');
    }
}); 
```

# wpf - WPF DataGrid 上下文菜单

> ID：526454
> 
> 赞同：0
> 
> 时间：2009-02-08T21:34:18.583
> 
> 标签：wpf, datagrid, contextmenu

如何为 DataGrid（Microsoft 的网格）中的每一列定义不同的 ContextMenus？我发现网格提供了一个`ContextMenu`属性，但我想要列的不同上下文菜单项，而不是整个网格的相同 ContextMenu。

编辑：感谢您的回答！我试着听`ContextMenuOpeningEvent`你的建议，这是第一次成功：可以在 EventHandler 中修改 ContextMenu。但它引发了另一个（希望很小）问题 - 我现在必须识别`ContextMenuOpeningEvent`触发时鼠标光标所在的列。稍后我将研究如何做（或解决）这个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T07:38:39.130

我根本没有玩过它，所以这可能是错误的，但您可以覆盖 ContextMenuOpening 事件并即时创建适当的菜单。

[将菜单项添加到默认上下文菜单](https://stackoverflow.com/questions/210634/add-menu-item-to-default-context-menu)可能会给您一个起点。

祝你好运。

# python - Django 表单在唯一字段上验证失败

> ID：526457
> 
> 赞同：20
> 
> 时间：2009-02-08T21:36:23.010
> 
> 标签：python, django

我有一个简单的模型，定义为：

```
class Article(models.Model):
    slug  = models.SlugField(max_length=50,  unique=True)
    title = models.CharField(max_length=100, unique=False) 
```

和形式：

```
class ArticleForm(ModelForm):
    class Meta:
       model = Article 
```

当我尝试更新现有行时，此处的验证失败：

```
 if request.method == 'POST':
     form = ArticleForm(request.POST)

     if form.is_valid(): # POOF
         form.save() 
```

创建一个新条目很好，但是，当我尝试更新这些字段中的任何一个时，验证不再通过。

“errors”属性什么都没有，但我进入调试器并在 Django 的内心深处看到了这个：

slug：“没有这个的文章已经存在”

所以看起来 is_valid() 在唯一值检查上失败了，但我想做的就是**更新**行。

我不能这样做：

```
form.save(force_update=True) 
```

...因为表单将在验证时失败。

这看起来很简单，但我就是想不通。

我正在运行 Django 1.0.2

什么是在表单初始化时调用的 BaseModelForm.validate_unique() 。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-08T23:33:29.763

我不认为您实际上是在更新现有文章，而是创建一个新文章，大概具有或多或少相同的内容，尤其是 slug，因此您会收到错误消息。你没有得到更好的错误报告有点奇怪，但我也不知道你的视图的其余部分是什么样的。

如果你在哪里尝试这些方面的东西怎么办（我已经包含了更多可能的视图功能，改变它以满足你的需要）；我还没有真正测试过我的代码，所以我确信我至少犯了一个错误，但你至少应该得到一个大致的想法：

```
def article_update(request, id):
   article = get_objects_or_404(Article, pk=id)

   if request.method == 'POST':
      form = ArticleForm(request.POST, instance=article)

      if form.is_valid():
         form.save()

         return HttpResponseRedirect(to-some-suitable-url)

   else:
      form = ArticleForm(instance=article)

   return render_to_response('article_update.html', { 'form': form }) 
```

问题是，正如 taurean 所说，您应该使用要更新的对象来实例化您的模型表单，否则您将获得一个新的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T15:27:47.153

我也在寻找一种更新现有记录的方法，甚至尝试过`form.save(force_update=True)`但收到错误？？最后通过反复试验设法更新现有记录。下面的代码测试工作。希望这可以帮助...

# 来自 djangobook 的 models.py

```
class Author(models.Model):
    first_name = models.CharField(max_length=30)

    last_name = models.CharField(max_length=40)

    email = models.EmailField(blank=True, verbose_name='e-mail')

    objects = models.Manager()

    sel_objects=AuthorManager()

    def __unicode__(self):
        return self.first_name+' '+ self.last_name

class AuthorForm(ModelForm):
    class Meta:
        model = Author

# views.py
# add new record

def authorcontact(request):

    if request.method == 'POST':

        form = AuthorForm(request.POST)

        if form.is_valid():

            form.save()

            return HttpResponseRedirect('/contact/created')

    else:

        form = AuthorForm()

    return render_to_response('author_form.html', {'form': form}) 
```

# 更新现有记录

```
def authorcontactupd(request,id):

    if request.method == 'POST':

        a=Author.objects.get(pk=int(id))

        form = AuthorForm(request.POST, instance=a)

        if form.is_valid():

            form.save()

            return HttpResponseRedirect('/contact/created')

    else:
        a=Author.objects.get(pk=int(id))

        form = AuthorForm(instance=a)

    return render_to_response('author_form.html', {'form': form}) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T21:47:58.533

我只能猜测您正在获取一个对象来填写表格，并尝试再次保存它。

尝试使用 ModelForm，并用所需的对象实例化它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T21:49:46.737

看来您的 SlugField 正在返回 None 并且因为空/空白 slug 已经存在于数据库中的某处，它给出了“已经存在”错误。似乎您的 slug 字段根本没有正确保存。

# c# - 不在焦点时响应键盘？（C#，Vista）

> ID：526458
> 
> 赞同：5
> 
> 时间：2009-02-08T21:36:26.300
> 
> 标签：c#, windows, windows-vista

我正在尝试编写一个在按下 Shift 键时响应的应用程序，无论当前哪个应用程序具有焦点。

我用`SetWindowsHookEx()`和 with试过了`GetKeyboardState()`，但这两种方法都只在应用程序的窗口有焦点时才有效。我需要它在全球范围内工作。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T21:56:29.810

您必须使用 SetWindowsHookEx()。只有两种类型的钩子可以在托管语言中实现，WH_KEYBOARD_LL 和 WH_MOUSE_LL。所有其他钩子都需要一个可以注入另一个进程的 DLL。无法注入托管 DLL，无法初始化 CLR。

这篇[博文](https://docs.microsoft.com/en-us/archive/blogs/toub/low-level-keyboard-hook-in-c)有一个功能示例。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-14T13:27:14.137

提供的答案都没有帮助我解决我的问题，但我自己找到了答案。这里是。

使用`SetWindowsHookEx()`with`WH_KEYBOARD_LL`是正确的方法。但是，其他参数`SetWindowsHookEx()`不直观：

*   最后一个参数`dwThreadId`需要为 0。
*   倒数第二个参数`hMod`需要指向某个 DLL。我使用 `User32`了 DLL，无论如何它总是被加载并且被所有带有 GUI 的进程使用。我从[关于这个的 CodeProject 帖子中](http://www.codeproject.com/KB/cs/CSLLKeyboardHook.aspx)得到了这个想法。

因此，代码看起来有点像这样：

```
instance = LoadLibrary("User32");
hhook = SetWindowsHookEx(WH_KEYBOARD_LL, hookFunction, instance, 0); 
```

文档不清楚倒数第二个参数。它说：

> 如果挂钩过程在与当前进程关联的代码中，则 hMod 参数必须设置为 NULL [...]。

它并没有说明这只适用于某些类型的钩子，但不适用于`WH_KEYBOARD_LL`and `WH_MOUSE_LL`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T22:18:56.447

如果您使用 nobugz 引用的帖子中的技术，您将需要确保委托不会被垃圾收集，例如在设置挂钩时使用 GC.KeepAlive(_proc) ，否则在不确定的时间段后挂钩将当 delagate 被 GCed 时停止工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T21:39:33.483

设置一个 CBT 钩子看这里[http://www.codeproject.com/KB/DLL/keyboardhook.aspx](http://www.codeproject.com/KB/DLL/keyboardhook.aspx)

# sql - 没有自动增量字段的数据库上的自动增量字段

> ID：526460
> 
> 赞同：9
> 
> 时间：2009-02-08T21:36:51.290
> 
> 标签：sql, sql-server, auto-increment, ansi-sql

在 MS Sql Server 中很容易创建自动增量字段。在我的系统中，我停止对主键使用自动增量字段，现在我使用 Guid。太棒了，这种变化给我带来了很多好处。但在另一个非主键字段中，我确实需要实现“软自动增量”。这是因为我的系统是独立于数据库的，所以我在 c# 中以编程方式创建了 autoinc 值。

我想要关于没有自动增量的数据库上的自动增量字段的解决方案，您使用什么解决方案以及为什么？有一些关于这个的 Sql Ansi 声明？并直接从我的 c# 生成，是更好的解决方案吗？

PS：我知道*select max(id)+1 from table*它并不是真正的并发友好...

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-09T02:43:39.337

生成唯一 id 值的机制**必须**不受事务隔离的约束。这是数据库为每个客户端生成不同值所必需的，这比 的技巧要好，如果两个客户端尝试同时分配新值`SELECT MAX(id)+1 FROM table`，则会导致竞争条件。`id`

您无法使用标准 SQL 查询来模拟此操作（除非您使用表锁或*可序列化*事务）。它必须是一种内置于数据库引擎中的机制。

ANSI SQL 直到 SQL:2003 才描述为代理键生成唯一值的操作。在此之前，自增列没有标准，因此几乎每个品牌的 RDBMS 都提供了一些专有的解决方案。当然，它们变化很大，并且没有办法以简单、独立于数据库的方式使用它们。

*   MySQL 有`AUTO_INCREMENT`column 选项或`SERIAL`伪数据类型，相当于`BIGINT UNSIGNED AUTO_INCREMENT`;
*   Microsoft SQL Server 具有`IDENTITY`列选项，`NEWSEQUENTIALID()`介于自动增量和 GUID 之间；
*   Oracle有一个`SEQUENCE`对象；
*   PostgreSQL 有一个`SEQUENCE`对象或`SERIAL`伪数据类型，它根据命名约定隐式创建一个序列对象；
*   InterBase/Firebird 有一个`GENERATOR`很像`SEQUENCE`Oracle 中的对象；Firebird 2.1`SEQUENCE`也支持；
*   SQLite 将任何声明为主键的整数视为隐式自动递增；
*   DB2 UDB 几乎拥有一切：对象，或者您可以使用 " " 选项`SEQUENCE`声明列。`GEN_ID`

所有这些机制都在事务隔离之外运行，确保并发客户端获得唯一值。*此外，在所有情况下，都有一种方法可以查询当前会话*最近生成的值。必须有，因此您可以使用它在子表中插入行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-10T09:51:08.973

我认为你的问题实际上是一个很好的问题。但是，尝试提出仅 SQL 的解决方案很容易迷失方向。实际上，您将希望通过使用自动增量类型的数据库实现来提供优化和事务安全。

如果您需要抽象出自动增量运算符的实现，为什么不创建一个存储过程来返回您的自动增量值。大多数 SQL 方言以相对相同的方式访问存储过程，并且它应该更具可移植性。然后，您可以在创建存储过程时创建特定于数据库的自动增量逻辑 - 无需将许多语句更改为特定于供应商。

通过这种方式，您的插入可以很简单：

```
INSERT INTO foo (id, name, rank, serial_number)
 VALUES (getNextFooId(), 'bar', 'fooRank', 123456); 
```

然后在初始化数据库时以数据库特定的方式定义 getNextFooId() 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T21:42:51.323

大多数没有自动增量字段的数据库，如 SQL Server（我特别考虑 Oracle）都有序列，您可以在其中向序列询问下一个数字。无论有多少人同时请求号码，每个人都会得到一个唯一的号码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T21:47:35.540

传统的解决方案是有一个看起来像这样的 id 表

```
CREATE TABLE ids (
  tablename VARCHAR(32) NOT NULL PRIMARY KEY,
  nextid INTEGER
) 
```

创建数据库时，每个表填充一行。

然后，您进行选择以获取要插入的表的下一个 id，将其递增，然后使用新 id 更新表。显然，这里存在锁定问题，但对于插入率适中的数据库，它运行良好。它是完全便携的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-07T12:25:27.930

如果您需要一个非主键自动增量字段，一个非常好的 MySQL 唯一用于创建任意序列的解决方案是使用相对未知的`last_insert_id(expr)`函数。

> 如果 expr 作为 LAST_INSERT_ID() 的参数给出，则参数的值由函数返回，并作为 LAST_INSERT_ID() 返回的下一个值被记住。这可以用来模拟序列...

（来自[http://dev.mysql.com/doc/refman/5.1/en/information-functions.html#function_last-insert-id](http://dev.mysql.com/doc/refman/5.1/en/information-functions.html#function_last-insert-id)）

这是一个示例，它演示了如何为每个帖子的评论编号保留二级序列：

```
CREATE TABLE  `post` (
  `id` INT(10) UNSIGNED NOT NULL,
  `title` VARCHAR(100) NOT NULL,
  `comment_sequence` INT(10) UNSIGNED NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
);

CREATE TABLE  `comment` (
  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `post_id`  INT(10) UNSIGNED NOT NULL,
  `sequence` INT(10) UNSIGNED NOT NULL,
  `content` TEXT NOT NULL,
  PRIMARY KEY (`id`)
);

INSERT INTO post(id, title) VALUES(1, 'first post');
INSERT INTO post(id, title) VALUES(2, 'second post');

UPDATE post SET comment_sequence=Last_insert_id(comment_sequence+1) WHERE id=1;
INSERT INTO `comment`(post_id, sequence, content) VALUES(1, Last_insert_id(), 'blah');

UPDATE post SET comment_sequence=Last_insert_id(comment_sequence+1) WHERE id=1;
INSERT INTO `comment`(post_id, sequence, content) VALUES(1, Last_insert_id(), 'foo');

UPDATE post SET comment_sequence=Last_insert_id(comment_sequence+1) WHERE id=1;
INSERT INTO `comment`(post_id, sequence, content) VALUES(1, Last_insert_id(), 'bar');

UPDATE post SET comment_sequence=Last_insert_id(comment_sequence+1) WHERE id=2;
INSERT INTO `comment`(post_id, sequence, content) VALUES(2, Last_insert_id(), 'lorem');

UPDATE post SET comment_sequence=Last_insert_id(comment_sequence+1) WHERE id=2;
INSERT INTO `comment`(post_id, sequence, content) VALUES(2, Last_insert_id(), 'ipsum');

SELECT * FROM post;
SELECT * FROM comment; 
```

# python - NLTK 使用的实际例子

> ID：526469
> 
> 赞同：78
> 
> 时间：2009-02-08T21:41:13.060
> 
> 标签：python, nlp, nltk

我正在使用[自然语言工具包](http://www.nltk.org/)（NLTK）。

它的文档（[Book](http://www.nltk.org/book)和[HOWTO](http://nltk.googlecode.com/svn/trunk/doc/howto/index.html)）非常庞大，并且示例有时稍微高级一些。

NLTK 的使用/应用有什么好的但基本的例子吗？我正在考虑诸如*Stream Hacker*博客上的[NTLK 文章之类的事情。](http://streamhacker.wordpress.com/tag/nltk/)

 ** * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-08T21:50:53.490

这是我自己的实际示例，以方便其他人查找此问题（请原谅示例文本，这是我在[Wikipedia](http://en.wikipedia.org/wiki/Mr_Blobby)上找到的第一件事）：

```
import nltk
import pprint

tokenizer = None
tagger = None

def init_nltk():
    global tokenizer
    global tagger
    tokenizer = nltk.tokenize.RegexpTokenizer(r'\w+|[^\w\s]+')
    tagger = nltk.UnigramTagger(nltk.corpus.brown.tagged_sents())

def tag(text):
    global tokenizer
    global tagger
    if not tokenizer:
        init_nltk()
    tokenized = tokenizer.tokenize(text)
    tagged = tagger.tag(tokenized)
    tagged.sort(lambda x,y:cmp(x[1],y[1]))
    return tagged

def main():
    text = """Mr Blobby is a fictional character who featured on Noel
    Edmonds' Saturday night entertainment show Noel's House Party,
    which was often a ratings winner in the 1990s. Mr Blobby also
    appeared on the Jamie Rose show of 1997\. He was designed as an
    outrageously over the top parody of a one-dimensional, mute novelty
    character, which ironically made him distinctive, absurd and popular.
    He was a large pink humanoid, covered with yellow spots, sporting a
    permanent toothy grin and jiggling eyes. He communicated by saying
    the word "blobby" in an electronically-altered voice, expressing
    his moods through tone of voice and repetition.

    There was a Mrs. Blobby, seen briefly in the video, and sold as a
    doll.

    However Mr Blobby actually started out as part of the 'Gotcha'
    feature during the show's second series (originally called 'Gotcha
    Oscars' until the threat of legal action from the Academy of Motion
    Picture Arts and Sciences[citation needed]), in which celebrities
    were caught out in a Candid Camera style prank. Celebrities such as
    dancer Wayne Sleep and rugby union player Will Carling would be
    enticed to take part in a fictitious children's programme based around
    their profession. Mr Blobby would clumsily take part in the activity,
    knocking over the set, causing mayhem and saying "blobby blobby
    blobby", until finally when the prank was revealed, the Blobby
    costume would be opened - revealing Noel inside. This was all the more
    surprising for the "victim" as during rehearsals Blobby would be
    played by an actor wearing only the arms and legs of the costume and
    speaking in a normal manner.[citation needed]"""
    tagged = tag(text)    
    l = list(set(tagged))
    l.sort(lambda x,y:cmp(x[1],y[1]))
    pprint.pprint(l)

if __name__ == '__main__':
    main() 
```

输出：

```
[('rugby', None),
 ('Oscars', None),
 ('1990s', None),
 ('",', None),
 ('Candid', None),
 ('"', None),
 ('blobby', None),
 ('Edmonds', None),
 ('Mr', None),
 ('outrageously', None),
 ('.[', None),
 ('toothy', None),
 ('Celebrities', None),
 ('Gotcha', None),
 (']),', None),
 ('Jamie', None),
 ('humanoid', None),
 ('Blobby', None),
 ('Carling', None),
 ('enticed', None),
 ('programme', None),
 ('1997', None),
 ('s', None),
 ("'", "'"),
 ('[', '('),
 ('(', '('),
 (']', ')'),
 (',', ','),
 ('.', '.'),
 ('all', 'ABN'),
 ('the', 'AT'),
 ('an', 'AT'),
 ('a', 'AT'),
 ('be', 'BE'),
 ('were', 'BED'),
 ('was', 'BEDZ'),
 ('is', 'BEZ'),
 ('and', 'CC'),
 ('one', 'CD'),
 ('until', 'CS'),
 ('as', 'CS'),
 ('This', 'DT'),
 ('There', 'EX'),
 ('of', 'IN'),
 ('inside', 'IN'),
 ('from', 'IN'),
 ('around', 'IN'),
 ('with', 'IN'),
 ('through', 'IN'),
 ('-', 'IN'),
 ('on', 'IN'),
 ('in', 'IN'),
 ('by', 'IN'),
 ('during', 'IN'),
 ('over', 'IN'),
 ('for', 'IN'),
 ('distinctive', 'JJ'),
 ('permanent', 'JJ'),
 ('mute', 'JJ'),
 ('popular', 'JJ'),
 ('such', 'JJ'),
 ('fictional', 'JJ'),
 ('yellow', 'JJ'),
 ('pink', 'JJ'),
 ('fictitious', 'JJ'),
 ('normal', 'JJ'),
 ('dimensional', 'JJ'),
 ('legal', 'JJ'),
 ('large', 'JJ'),
 ('surprising', 'JJ'),
 ('absurd', 'JJ'),
 ('Will', 'MD'),
 ('would', 'MD'),
 ('style', 'NN'),
 ('threat', 'NN'),
 ('novelty', 'NN'),
 ('union', 'NN'),
 ('prank', 'NN'),
 ('winner', 'NN'),
 ('parody', 'NN'),
 ('player', 'NN'),
 ('actor', 'NN'),
 ('character', 'NN'),
 ('victim', 'NN'),
 ('costume', 'NN'),
 ('action', 'NN'),
 ('activity', 'NN'),
 ('dancer', 'NN'),
 ('grin', 'NN'),
 ('doll', 'NN'),
 ('top', 'NN'),
 ('mayhem', 'NN'),
 ('citation', 'NN'),
 ('part', 'NN'),
 ('repetition', 'NN'),
 ('manner', 'NN'),
 ('tone', 'NN'),
 ('Picture', 'NN'),
 ('entertainment', 'NN'),
 ('night', 'NN'),
 ('series', 'NN'),
 ('voice', 'NN'),
 ('Mrs', 'NN'),
 ('video', 'NN'),
 ('Motion', 'NN'),
 ('profession', 'NN'),
 ('feature', 'NN'),
 ('word', 'NN'),
 ('Academy', 'NN-TL'),
 ('Camera', 'NN-TL'),
 ('Party', 'NN-TL'),
 ('House', 'NN-TL'),
 ('eyes', 'NNS'),
 ('spots', 'NNS'),
 ('rehearsals', 'NNS'),
 ('ratings', 'NNS'),
 ('arms', 'NNS'),
 ('celebrities', 'NNS'),
 ('children', 'NNS'),
 ('moods', 'NNS'),
 ('legs', 'NNS'),
 ('Sciences', 'NNS-TL'),
 ('Arts', 'NNS-TL'),
 ('Wayne', 'NP'),
 ('Rose', 'NP'),
 ('Noel', 'NP'),
 ('Saturday', 'NR'),
 ('second', 'OD'),
 ('his', 'PP$'),
 ('their', 'PP$'),
 ('him', 'PPO'),
 ('He', 'PPS'),
 ('more', 'QL'),
 ('However', 'RB'),
 ('actually', 'RB'),
 ('also', 'RB'),
 ('clumsily', 'RB'),
 ('originally', 'RB'),
 ('only', 'RB'),
 ('often', 'RB'),
 ('ironically', 'RB'),
 ('briefly', 'RB'),
 ('finally', 'RB'),
 ('electronically', 'RB-HL'),
 ('out', 'RP'),
 ('to', 'TO'),
 ('show', 'VB'),
 ('Sleep', 'VB'),
 ('take', 'VB'),
 ('opened', 'VBD'),
 ('played', 'VBD'),
 ('caught', 'VBD'),
 ('appeared', 'VBD'),
 ('revealed', 'VBD'),
 ('started', 'VBD'),
 ('saying', 'VBG'),
 ('causing', 'VBG'),
 ('expressing', 'VBG'),
 ('knocking', 'VBG'),
 ('wearing', 'VBG'),
 ('speaking', 'VBG'),
 ('sporting', 'VBG'),
 ('revealing', 'VBG'),
 ('jiggling', 'VBG'),
 ('sold', 'VBN'),
 ('called', 'VBN'),
 ('made', 'VBN'),
 ('altered', 'VBN'),
 ('based', 'VBN'),
 ('designed', 'VBN'),
 ('covered', 'VBN'),
 ('communicated', 'VBN'),
 ('needed', 'VBN'),
 ('seen', 'VBN'),
 ('set', 'VBN'),
 ('featured', 'VBN'),
 ('which', 'WDT'),
 ('who', 'WPS'),
 ('when', 'WRB')] 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-10-12T02:52:43.647

NLP 通常非常有用，因此您可能希望将搜索范围扩大到文本分析的一般应用。我使用 NLTK 通过提取概念图来生成文件分类来帮助 MOSS 2010。它工作得非常好。文件开始以有用的方式聚集起来并不需要很长时间。

通常，要了解文本分析，您必须与您习惯的思维方式相切合。例如，文本分析对于发现非常有用。但是，大多数人甚至不知道搜索和发现之间的区别。如果您阅读了这些主题，您可能会“发现”您可能希望将 NLTK 用于工作的方式。

此外，请考虑您对没有 NLTK 的文本文件的世界观。您有一堆由空格和标点符号分隔的随机长度字符串。一些标点符号改变了它的使用方式，例如句点（它也是小数点和缩写的后缀标记）。使用 NLTK，您可以获得单词，甚至更多地获得词性。现在您已经掌握了内容。使用 NLTK 发现文档中的概念和操作。使用 NLTK 来了解文档的“含义”。在这种情况下，含义是指文档中的本质关系。

对 NLTK 感到好奇是件好事。文本分析将在未来几年内大举突破。那些了解它的人将更适合更好地利用新机会。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-08-08T21:03:16.737

我是[streamhacker.com](http://streamhacker.com/)的作者（感谢您的提及，我从这个特定问题中获得了相当多的点击流量）。你具体想做什么？NLTK 有很多工具可以做各种各样的事情，但在使用这些工具的目的以及如何最好地使用它们方面缺乏明确的信息。它也面向学术问题，因此将[教学](http://en.wikipedia.org/wiki/Pedagogy)示例转化为实际解决方案可能很繁重。

# c++ - 使用自动工具从 C++ 中使用 C 代码

> ID：526474
> 
> 赞同：5
> 
> 时间：2009-02-08T21:43:53.163
> 
> 标签：c++, c, linker

我正在用 C 编写的一些代码之上编写一个（我的第一个）C++ 类，但我只能通过在 extern 块中声明 C 函数来编译 C++。我的项目使用自动工具；有没有办法自动化这个过程，所以我不必维护两个头文件？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-08T21:48:48.690

在 C 代码头文件中的 #ifdef 内使用外部块

头文件的开始

```
#ifdef __cplusplus
extern "C" {
#endif 
```

...在头文件的末尾

```
#ifdef __cplusplus
}
#endif 
```

这样它就可以同时包含在 C 和 C++ 源代码中

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T21:48:26.803

是的，创建包装头文件，其中包含您的 C 头文件，如下所示...

```
//Wrapper.h
#ifdef __cplusplus
extern "C"
{

    #include "Actual.h"
}
#else
    #include "Actual.h"
#endif

//Use.cpp
#include "Wrapper.h"

int main()
{
    return 0;
}

//Use.c
#include "Wrapper.h"
/*or #include "Actual.h" */

int main()
{
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T21:49:29.310

使用 C 预处理器。做这样的事情：

```
 #ifdef __cplusplus
 extern "C" {
 #endif 
// code goes here

#ifdef __cplusplus
}
#endif 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T17:54:48.087

我们在头文件中有一个宏：

```
#ifdef __cplusplus
    #define _crtn "C"
#else
    #define _crtn
#endif 
```

然后在头文件中，我们可以使用`_crtn`：

```
#include "croutine.h"

extern _crtn void MyFunction( ... ); 
```

唯一的问题是确保在包含 MyFunction 实现的文件中包含包含 MyFunction 原型的头文件，以便使用“C”链接编译它。

这与@epatel 的答案相同，但只需要`#ifdef`一个头文件中的丑陋 's 。

# queue - 排队系统 - 启动多个工人的好方法是什么？

> ID：526487
> 
> 赞同：9
> 
> 时间：2009-02-08T21:51:50.490
> 
> 标签：queue, message-queue, worker-process, gearman, amazon-sqs

*   您如何为面向队列的系统设置一个或多个工作脚本？
*   您如何根据需要安排启动 - 并在必要时重新启动 - 工作脚本？（我正在考虑诸如 init.d/、基于 Ruby 的“上帝”、DJB 的 Daemontools 等工具）

我正在开发一个异步队列/工作系统，在这种情况下使用 PHP 和[BeanstalkdD](http://xph.us/software/beanstalkd/)（尽管实际的语言和守护进程并不重要）。任务本身并不太难——将带有命令和参数的数组编码为 JSON，以便通过 Beanstalkd 守护程序进行传输，然后在工作脚本中提取它们以根据需要对其进行操作。

还有许多其他类似的队列/工作者设置，例如[Starling](http://rubyforge.org/projects/starling/)、[Gearman](http://www.danga.com/gearman/)、[Amazon 的 SQS](http://aws.amazon.com/sqs/)和其他更多面向“企业”的系统，例如 IBM 的 MQ 和 RabbitMQ。如果你运行 Gearman 或 SQS 之类的东西 - 你如何*启动*和控制工作池？问题在于最初的工人启动，然后能够添加额外的额外工人，随意关闭它们（尽管我可以通过队列发送消息以关闭它们 - 只要一些“观察者”不会自动重新启动它们）。这不是 PHP 问题，它是关于直接设置一个或多个进程以在启动时运行的 Unix 进程，或者向池中添加更多工作人员。

循环脚本的[bash 脚本](http://pastebin.ca/1331063)已经到位 - 这会调用 PHP 脚本，然后从队列中收集并运行任务，偶尔退出以便能够自行清理（它也可以在失败时暂停几秒钟，或通过计划的活动）。这很好用，在此基础上构建工作进程一点也不难。

获得一个好的工作控制器系统是关于灵活性的，在机器启动时自动启动一个或两个，并且能够在队列繁忙时从命令行添加更多，在不再需要时关闭额外的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-01T17:47:16.277

我一直在帮助一个朋友，他正在从事一个项目，该项目涉及一个基于 Gearman 的队列，该队列将向多个服务器池上的各种 PHP 和 C 守护程序分派各种异步作业。

由于 /etc/init.d/ 中的简单 shell 脚本和以下命令，worker 被设计为像经典的 unix/linux 守护进程一样运行：

`invoke-rc.d myWorker start|stop|restart|reload`

这种机制简单有效。由于它依赖于标准的 linux 功能，即使对您的应用程序了解有限的人也可以启动或停止一个守护程序，如果他们知道它是如何被称为系统级的（在上面的示例中也称为“myWorker”）。

这种机制的另一个优点是它也使您的工作人员池管理变得容易。您的机器上可能有 10 个守护进程（myWorker1、myWorker2、...），并有一个“工作管理器”根据队列长度启动或停止它们。由于这些命令可以通过 ssh 运行，因此您可以轻松管理多个服务器。

这个解决方案可能听起来很便宜，但是如果你使用编码良好的守护进程和可靠的管理脚本来构建它，我不明白为什么对于任何平均（如“非关键”）项目来说，它的效率会低于大笔解决方案.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T18:42:00.133

真正的消息队列中间件（如 WebSphere MQ 或 MSMQ）提供“触发器”，当新消息放入队列时，作为 MQM 一部分的服务将启动工作程序。

AFAIK，没有“网络服务”排队系统可以做到这一点，这是野兽的本性。但是我只仔细研究了 SQS。在那里你必须轮询队列，而在亚马逊的情况下，过于急切的轮询将花费你一些真正的美元。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-09-26T07:53:19.003

[Supervisor](http://supervisord.org)是一个很好的监控工具。它包括一个 Web UI，您可以在其中监视和管理工作人员。

这是一个工人的简单配置文件。

```
[program:demo]
command=php worker.php ; php command to run worker file
numprocs=2 ; number of processes
process_name=%(program_name)s_%(process_num)03d ; unique name for each process if numprocs > 1
directory=/var/www/demo/ ; directory containing worker file
stdout_logfile=/var/www/demo/worker.log ; log file location
autostart=true ; auto start program when supervisor starts
autorestart=true ; auto restart program if it exits 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-03T22:08:49.570

我最近一直在研究这样的工具。它还没有完全完成（认为在我达到我可以称之为 1.0 的东西之前还需要几天以上的时间）并且显然还没有准备好投入生产，但重要的部分已经编码。任何人都可以在这里查看代码：[https](https://gitorious.org/workers_pool) ://gitorious.org/workers_pool 。

# html - CSS 和滚动条是怎么回事？

> ID：526488
> 
> 赞同：6
> 
> 时间：2009-02-08T21:52:24.780
> 
> 标签：html, css

我有一个带有 HTML 页面的客户端，其中包含几个带有文本内容的滚动 div。她使用了大量基于图像的设计，因此默认滚动条根本不适合它。她想使用不同的风格，但据我所知这是不可能的。

你怎么看？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-08T21:59:26.183

对此有一个 jQuery 答案 -

[jScrollPane](http://www.kelvinluck.com/assets/jquery/jScrollPane/jScrollPane.html)

它可以实现的效果有一些[很好的例子](http://www.kelvinluck.com/assets/jquery/jScrollPane/examples.html)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-08T22:18:26.043

从可用性的角度来看，更改滚动条是不行的。用户熟悉他/她的操作系统及其提供的视觉环境。改变这一点确实会造成混乱，尤其是在那些不熟悉计算机的人、老年人等中。

今天的大多数用户可能会认出滚动条，只要它具有基本形状 - 许多人甚至不会使用滚动条本身，而只是使用鼠标上的滚轮。

尽管如此，这仍然是一件值得考虑的事情。考虑你的听众。无论您做什么，如果您使用自定义滚动条，请确保它在所有平台/所有浏览器中都有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T22:00:24.760

您可以使用 CSS 更改颜色，但 IIRC 只有 IE v5.5+ 支持此 CSS。其他浏览器没有！

请参阅此处的演示： http: [//www.iconico.com/CSSScrollbar/](http://www.iconico.com/CSSScrollbar/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T21:57:58.153

有点可能。

```
body {
    scrollbar-face-color: #ffffff;
    scrollbar-highlight-color: #000000;
    scrollbar-shadow-color: #ffffff;
    scrollbar-3dlight-color: #ffffff;
    scrollbar-arrow-color: #000000;
    scrollbar-track-color: #808080;
    scrollbar-darkshadow-color: #000000;
} 
```

注意:: 如果您指定了 XHTML Doctype，它可能不起作用！

# installation - 安装 Xampp？

> ID：526507
> 
> 赞同：0
> 
> 时间：2009-02-08T22:09:19.497
> 
> 标签：installation, xampp, uninstallation

我必须先卸载以前的版本吗？在更新到最新版本之前？我收到错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T22:11:26.950

是的，Xamp 和 wamp 都强烈建议您在安装更新版本之前卸载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T22:23:52.693

我通常使用仅解压缩到目录的免安装版本。在这种情况下，不，您可以重命名目录并安装新版本。

但是，如果您使用的是安装程序，最好卸载。但是，请确保保存您的 mysql 数据库以及您可能希望在安装过程中保留的任何其他内容！

# apache - 为什么这个 mod_rewrite 规则没有像记录的那样工作？

> ID：526512
> 
> 赞同：1
> 
> 时间：2009-02-08T22:12:48.490
> 
> 标签：apache, mod-rewrite

我正在尝试在托管站点上调试 URL 重写，我无权访问`vhost.conf`，因此无法设置重写日志。我还能如何调试不起作用的规则？

如果有人有任何见解，这是我试图理顺的规则：

```
RewriteRule ^([^/]+)\.([^/]+)$ xslt.php [L] 
```

我期望发生的事情：有点但没有斜杠的 URL 被重写以指向`xslt.php`然后停止重写，这样它就不会进入循环。实际发生了什么？500 内部服务器错误（闻起来像是*在*循环）。我知道我可以添加 a`RewriteCond`来专门 exclude `xslt.php`，但我更想了解为什么这首先会破坏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T22:18:12.643

为什么不循环？xslt.php 有点但没有斜线。尝试将您的选项更改为 [L,NS]。

编辑：啊，我明白了。您缺少的是 [L] 终止了此请求的所有重写，但仍生成了一个子请求，该子请求获得了自己的重写通行证。[NS] 抑制该传球。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T22:24:44.327

该[`L`标志会导致](https://stackoverflow.com/questions/499970/why-would-modrewrite-rewrite-twice/500716#500716)使用新的、重写的 URL重新启动重写过程`xslt.php`，然后该 URL 也与您的模式匹配。

所以试试这个：

```
RewriteCond $0 !^xslt\.php$
RewriteRule ^([^/]+)\.([^/]+)$ xslt.php [L] 
```

# cocoa-touch - 如何使用 UINavigationController 的自定义视图创建 backBarButtomItem

> ID：526520
> 
> 赞同：35
> 
> 时间：2009-02-08T22:18:38.507
> 
> 标签：cocoa-touch

我有一个`UINavigationController`我推入其中的几个观点。在`viewDidLoad`其中一个视图中，我想将其设置`self.navigationItem.backBarButtonItem`为自定义视图（基于自定义图像）。我不知道为什么，但它似乎不起作用。相反，我得到了标准的“后退”按钮。

```
UIButton *backButton = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 63, 30)];
[backButton setImage:[UIImage imageNamed:@"back_OFF.png"] forState:UIControlStateNormal];
[backButton setImage:[UIImage imageNamed:@"back_ON.png"] forState:UIControlStateSelected];
UIBarButtonItem *backButtonItem = [[UIBarButtonItem alloc] initWithCustomView:backButton];
self.navigationItem.backBarButtonItem = backButtonItem;
[backButtonItem release];
[backButton release]; 
```

我用一个标准的标题进行了测试，它奏效了。上面的代码有什么问题？

```
self.navigationItem.backBarButtonItem = [[[UIBarButtonItem alloc] initWithTitle:@"Prout" style:UIBarButtonItemStyleDone target:nil action:nil] autorelease]; 
```

感谢您对此的任何帮助。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2012-03-21T21:34:57.157

从 iOS5 开始，我们有了一种*极好的新方法，可以使用*[UIAppearance 协议](http://developer.apple.com/library/ios/#documentation/uikit/reference/UIAppearance_Protocol/Reference/Reference.html)自定义几乎所有控件的外观，即`[UIBarButtonItem appearance]`. 外观代理允许您在应用程序范围内对控件的外观进行更改。下面是使用外观代理创建的自定义后退按钮的示例。

![在此处输入图像描述](https://i.stack.imgur.com/O1s5j.png)

使用下面的示例代码创建一个带有自定义图像的后退按钮，用于正常和突出显示状态。从您的 appDelegate 调用以下方法`application:didFinishLaunchingWithOptions:`

```
- (void) customizeAppearance {

UIImage *i1 = [[UIImage imageNamed:@"custom_backButton_30px"]
                      resizableImageWithCapInsets:UIEdgeInsetsMake(0, 15, 0, 6)];
UIImage *i2 = [[UIImage imageNamed:@"custom_backButton_24px"] 
                      resizableImageWithCapInsets:UIEdgeInsetsMake(0, 15, 0, 6)];

[[UIBarButtonItem appearance] setBackButtonBackgroundImage:i1 
                              forState:UIControlStateNormal 
                              barMetrics:UIBarMetricsDefault];

[[UIBarButtonItem appearance] setBackButtonBackgroundImage:i2 
                              forState:UIControlStateNormal 
                              barMetrics:UIBarMetricsLandscapePhone];

[[UIBarButtonItem appearance] setBackButtonBackgroundImage:i1
                              forState:UIControlStateHighlighted 
                              barMetrics:UIBarMetricsDefault];

[[UIBarButtonItem appearance] setBackButtonBackgroundImage:i2 
                              forState:UIControlStateHighlighted 
                              barMetrics:UIBarMetricsLandscapePhone];
} 
```

这只是一个简单的例子。通常，您希望为正常和突出显示（按下）状态提供单独的图像。

如果您对自定义其他控件的外观感兴趣，可以在这里找到一些很好的示例：http: [//ios.biomsoft.com/2011/10/13/user-interface-customization-in-ios-5/](http://ios.biomsoft.com/2011/10/13/user-interface-customization-in-ios-5/)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-09T20:00:36.677

我相当确定这`backBarButtonItem`是一个只读属性。不要修改`backBarButtonItem`，而是尝试设置自定义`leftBarButtonItem`并隐藏`backBarButtonItem`：

```
self.navigationItem.leftBarButtonItem = [[[UIBarButtonItem alloc] initWithTitle:@"Prout" style:UIBarButtonItemStyleDone target:nil action:nil] autorelease];
self.navigationItem.hidesBackButton = YES; 
```

您还需要确保连接自定义按钮以调用`UINavigationBar`.

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-10-14T08:22:58.930

我从来没有能够`UIBarButtonItem`用自定义视图和`setBackBarButtonItem`.

这是我找到的解决方案：让网络`UINavigationControllerDelegate`处理一切！这里的技巧是调用 的`popViewControllerAnimated:`方法，`viewController.navigationController`因此您不必创建任何自定义方法。

```
- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated {
    if([navigationController.viewControllers count ] > 1) {
        UIView *backButtonView = [[UIView alloc] initWithFrame:CGRectMake(0,0,70,35)];
        UIButton *myBackButton = [[UIButton buttonWithType:UIButtonTypeCustom] retain];
        [myBackButton setFrame:CGRectMake(0,0,70,35)];
        [myBackButton setImage:[UIImage imageNamed:@"back.png"] forState:UIControlStateNormal];
        [myBackButton setEnabled:YES];
        [myBackButton addTarget:viewController.navigationController action:@selector(popViewControllerAnimated:) forControlEvents:UIControlEventTouchUpInside];
        [backButtonView addSubview:myBackButton];
        [myBackButton release];
        UIBarButtonItem* backButton = [[UIBarButtonItem alloc] initWithCustomView:backButtonView];
        viewController.navigationItem.leftBarButtonItem = backButton;
        [backButtonView release];
        [backButton release];
    }
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-12-08T04:24:32.180

如果您的最终目标是简单地替换用于后退按钮的图像，您可以使用 iOS 5.0 中提供的 UIBarButtonItem 上的新方法：

setBackButtonBackgroundImage:forState:barMetrics:

苹果文档：http: [//developer.apple.com/library/ios/#documentation/UIKit/Reference/UIBarButtonItem_Class/Reference/Reference.html](http://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIBarButtonItem_Class/Reference/Reference.html)

这是一个简单的示例，它为您的应用中的所有后退按钮设置自定义背景图像：

```
UIImage *toolbarBackButtonBackgroundPortrait = [[UIImage imageNamed:@"toolbarBackButtonPortrait"] resizableImageWithCapInsets:UIEdgeInsetsMake(0, 17, 0, 6)];
UIImage *toolbarBackButtonBackgroundLandscape = [[UIImage imageNamed:@"toolbarBackButtonLandscape"] resizableImageWithCapInsets:UIEdgeInsetsMake(0, 17, 0, 6)];

[[UIBarButtonItem appearance] setBackButtonBackgroundImage:toolbarBackButtonBackgroundPortrait forState:UIControlStateNormal barMetrics:UIBarMetricsDefault];
[[UIBarButtonItem appearance] setBackButtonBackgroundImage:toolbarBackButtonBackgroundLandscape forState:UIControlStateNormal barMetrics:UIBarMetricsLandscapePhone]; 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-06-07T08:13:36.293

我愿意打赌这是苹果公司的一个错误，因为我遇到了完全相同的问题。原因是我可以让自定义`UIBarButtonItem`出现，但前提是我**不**尝试使用该`initWithCustomView:`方法。根据 API，导航控制器在推送新的视图控制器时会检查以下内容：

1.  如果新的顶级视图控制器有一个自定义的左栏按钮项，则显示该项。要指定自定义左栏按钮项，请设置视图控制器导航项的 leftBarButtonItem 属性。
2.  如果顶级视图控制器没有自定义左栏按钮项，但前一个视图控制器的导航项在其 backBarButtonItem 属性中具有有效项，则导航栏会显示该项。
3.  如果任何一个视图控制器都没有指定自定义条形按钮项，则使用默认的后退按钮并将其标题设置为前一个视图控制器的 title 属性的值——即视图控制器向下一层堆栈。（如果导航堆栈上只有一个视图控制器，则不会显示返回按钮。）

我的情况（以及您的情况）是 2。我指定的代码与您的**完全相同**（即，创建 a `UIButton`，为各种状态设置其`image`属性，创建 a `UIBarButtonItem`，使用 初始化它`UIButton`，然后将当前视图控制器的`backBarButtonItem`属性设置为`UIBarButtonItem`） ; 但是，当我稍后推送视图控制器时，导航控制器的左侧根本没有显示任何内容。奇怪的是，我可以单击“返回”按钮所在的位置，然后它会弹出视图控制器。

有趣的是，如果我`UIBarButtonItem`使用该`initWithTitle:style:target:action:`方法而不是该`initWithCustomView:`方法创建一个，它**确实会**显示一个带有自定义标题的自定义按钮。此外，正如 Travis 提到的，使用该`leftBarButtonItem`属性可以正常工作。但是，我宁愿遵守认可的逻辑，通过为当前视图控制器指定“后退”按钮——稍后在按下新视图控制器时显示——而不是为下一个视图控制器创建左按钮，可以说，它不应该关心与它之前的视图控制器有关的任何事情。:-\

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-08-25T02:21:11.617

使用导航控制器设置推送视图控制器`backBarButtonItem` **之前。**设置`backBarButtonItem`in`viewDidLoad`不起作用。

假设我有 MyTableViewController。当用户点击特定行时，我想使用 navigationController 推送 AnotherViewController。代码看起来像这样：

```
// in MyTableViewController's tableView:didSelectRowAtIndexPath method...
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] 
                               initWithImage:[UIImage imageNamed:@"yourImage.png"]
                                       style:UIBarButtonItemStyleBordered 
                                      target:nil 
                                      action:nil];

self.navigationItem.backBarButtonItem = backButton;
[backButton release];

[self.navigationController pushViewController:anotherViewController]; 
```

当显示 anotherViewController 时，导航栏中的后退按钮将具有`@"yourImage.png"`默认的后退按钮样式（矩形箭头）。另请注意，可以传递`nil`为`target`. 该按钮的行为类似于后退按钮。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-08-18T11:40:53.853

即使已经回答了这对我有用：

```
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"backArrow.png"] style:UIBarButtonItemStyleBordered target:nil action:nil];
self.navigationItem.backBarButtonItem = backButton;
[backButton release]; 
```

顺便说一句：即使在 iOS4 中使用 initWithCustomView 初始化我的后退按钮：对我也不起作用。;(

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-10-12T02:26:31.103

我也一直`customView`在使用`navigationItem.backBarButtonItem`. 我怀疑它可能只是在 SDK 中。

虽然此处概述的解决方法确实有效，但我提出了一个更优雅的解决方案：它仍然使用`navigationItem.leftBarButtonItem`，但会自动为您处理它（不再需要“子”视图控制器需要知道任何东西关于他们的“父母”和/或手动设置`navigationItem.leftBarButtonItem`）。

* * *

首先，`UINavigationControllerDelegate`为`UINavigationController`您感兴趣的后退按钮设置一些类。然后，在这个类中，设置类似于以下`willShowViewController`委托方法的内容：

```
-(void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated{
    // reference to view controller stack
    NSArray *viewControllers = [ navigationController viewControllers ];
    if( [ viewControllers count ] > 1 ){
        // the view controller we'll be linking to
        UIViewController *backViewController = [ viewControllers objectAtIndex: [ viewControllers count ] - 2 ];
        // create custom UIBarButtonItem
        UIBarButtonItem *leftButton = [[ UIBarButtonItem alloc ] initWithCustomView: someCustomView ];
        // set it as the leftBarButtonItem on the incoming viewcontroller
        viewController.navigationItem.leftBarButtonItem = leftButton;
        // tidy up
        [ leftButton release ];
    }
} 
```

我对此有一些进一步的问题；看起来，`UIBarButtonItem.action`并且`UIBarButtonItem.target`当它是一个时不起作用`navigationItem.leftBarButtonItem`。因此，您会留下一个实际上不会返回的自定义返回按钮。我将在您的自定义视图中响应触摸作为读者练习（我使用了 UIButton），但您需要将此方法添加到您的委托类中：

```
-(void)onDummyBackButtonTapped{
    [ someNavigationController popViewControllerAnimated: YES ];
} 
```

并在点击您的自定义视图时将其连接起来。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-01-23T18:10:27.323

> backBarButtonItem 不是只读属性。我不确定为什么它的行为如此奇怪，而以上是一个有效的（如果不太理想）的解决方法。

它的行为很奇怪，因为设置 vc 的 backBarButtonItem 并不会改变 vc 导航项的外观 - 相反，它会更改指向 vc 的 BACK 按钮。请参阅从 Apple FMI[更新导航栏。](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UINavigationController_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40006934-CH3-SW25)

那就是说我没有太多的运气让它自己工作。如果您环顾该站点，您会发现一些线程建议放置与您在调用之前已经拥有的代码非常相似的代码，以将新视图推送到堆栈上。我在那里有一些运气，但不幸的是，在使用自定义图像时不是这样。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-10-28T16:13:07.380

navigationController 的 backBarButtonItem 设置在您要影响其标题的项目上。

即在第 1 页的视图控制器中，例如 viewdidLoad：

```
self.title = @"Page 1 of 4";

self.navigationItem.backBarButtonItem =
[[[UIBarButtonItem alloc] initWithTitle:@"Page 1"
                                  style:UIBarButtonItemStyleBordered
                                 target:nil
                                 action:nil] autorelease]; 
```

您**不会**在第 2 页中覆盖它。

UINavigationItem 的文档：backBarButtonItem 清楚地说明了这一点：

> 当该项目是导航栏的后一项时——当它是顶部项目之下的下一项时——它可以表示为导航栏上的后退按钮。使用此属性指定后退按钮。您设置的后退栏按钮项的目标和操作应为零。默认值为显示导航项标题的条形按钮项。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-04-19T08:56:45.713

这就是我创建带有箭头而不是通常的文本的自定义方形后退按钮的方式。

我只是为我的 UINavigationController 设置了一个委托。我为此使用应用程序委托，因为窗口根视图控制器是我要控制的 UINavigationController。

所以 AppDelegate.m (ARC)：

```
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    ((UINavigationController*)_window.rootViewController).delegate = self;
    return YES;
}

#pragma mark - UINavigationControllerDelegate

- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated {
    if(navigationController.viewControllers.count > 1) {
        UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
        [button setImage:[UIImage imageNamed:@"back-arrow.png"] forState:UIControlStateNormal];
        [button setBackgroundColor:[UIColor grayColor]];
        button.frame = CGRectMake(0, 0, 44, 44);
        viewController.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:button];
        [button addEventHandler:^(id sender) {
            [navigationController popViewControllerAnimated:YES];
        } forControlEvents:UIControlEventTouchUpInside];
    }
} 
```

我正在使用[BlocksKit](https://github.com/zwaldowski/BlocksKit)来捕捉按钮点击事件。像这样的东西非常方便，但你也可以使用常规的 addTarget:action:forControlEvents: 方法

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-01-30T20:48:46.317

我想我找到了解决方案。只需在上一个控制器上的导航项上设置按钮（您要返回的那个）

因此，例如，如果我有一个根控制器并且我按下第二个控制器并想要自定义后退按钮，那么我应该执行以下操作：

```
self.navigationItem.backBarButtonItem = [[[UIBarButtonItem alloc]
    initWithImage:[UIImage imageNamed:@"ico.png"] style:UIBarButtonItemStyleBordered
    target:nil action:nil] autorelease]; 
```

其中 self 是根视图控制器，而不是第二个。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-08-01T09:43:30.950

我的逻辑：

1.  创建一个自定义按钮（又名自定义视图子类）
2.  使用自定义按钮/视图初始化 barbutton 项
3.  添加一个允许我们“返回”到之前的视图控制器的操作
4.  将左侧栏按钮项设置为您创建的此自定义栏按钮项
5.  隐藏您要推送到的视图控制器的后栏按钮项

第 3 步很重要。我认为模拟“返回”的最简洁方法就是使用 UINavigationController 的方法（popViewControllerAnimated:)。因此，我只需将该操作添加到我正在推送的 viewController (viewControllerToPush) 的 navigationController 中，如下所示：

```
[navItemButton addTarget:viewControllerToPush.navigationController action:@selector(popViewControllerAnimated:) forControlEvents:UIControlEventTouchUpInside]; 
```

例子：

```
UIViewController *viewControllerToPush = [[UIViewController alloc] init];
UIImage *navImage = [UIImage imageNamed:@"your_back_button_image"];

UIButton *navItemButton = [UIButton buttonWithType:UIButtonTypeCustom];
[navItemButton setImage:navImage forState:UIControlStateNormal];
[navItemButton setImage:navImage forState:UIControlStateHighlighted];
[navItemButton setFrame:CGRectMake(0, 0, navImage.size.width, navImage.size.height)];

[navItemButton addTarget:viewControllerToPush.navigationController action:@selector(popViewControllerAnimated:) forControlEvents:UIControlEventTouchUpInside];

UIBarButtonItem *barButtonItem = [[UIBarButtonItem alloc] initWithCustomView:navItemButton];

viewControllerToPush.navigationItem.leftBarButtonItem = barButtonItem;
viewControllerToPush.navigationItem.hidesBackButton = YES;
[self.navigationController pushViewController:viewControllerToPush animated:YES]; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-04-12T13:06:58.273

您可以使用 leftBarButtonItem 而不是后退按钮项目。并删除默认的后退按钮项，将其设置为 nil，如下所示；

```
navigationController?.navigationBar.backIndicatorImage = nil
navigationController?.navigationBar.backIndicatorTransitionMaskImage = nil

let button = UIButton.init(type: .custom)
button.imageView?.contentMode = UIViewContentMode.scaleAspectFit
button.setImage(UIImage.init(named: "top_back"), for: UIControlState.normal)
button.frame = CGRect.init(x: 0, y: 0, width: 75, height: 50) 
button.addTarget(self, action: #selector(handleBackButton), for: .touchUpInside)

let barButton = UIBarButtonItem.init(customView: button)
self.navigationItem.leftBarButtonItem = barButton 
```

# android - Android - 获取计时器小部件的时间

> ID：526524
> 
> 赞同：51
> 
> 时间：2009-02-08T22:23:17.420
> 
> 标签：android, time, view, widget, chronometer

如何从 Chronometer 获取时间？我尝试了 getText、getFormat、getBase 等，但它们都不起作用。

示例代码片段：

```
Chronometer t = (Chronometer)findViewById(R.id.toptime);
long time = SystemClock.elapsedRealtime()-t.getBase();
Log.d(null,"Was: "+time); //time is not the proper time for some reason - it is a random number between 0 and 50
t.setBase(SystemClock.elapsedRealtime());
t.start(); 
```

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-02-08T22:59:13.760

如果您查看 Chronometer 类的源代码，您会发现它不会将经过的时间存储在字段中，并且每次需要更新显示时都会在内部计算它。

然而，在你自己的代码中做同样的事情相对容易：

```
long elapsedMillis = SystemClock.elapsedRealtime() - chronometerInstance.getBase(); 
```

这假设你已经开始你的时钟是这样的：

```
chronometerInstance.setBase(SystemClock.elapsedRealtime());
chronometerInstance.start(); 
```

这是一个完整的例子：

```
public class ChronoExample extends Activity {
Chronometer mChronometer;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    LinearLayout layout = new LinearLayout(this);
    layout.setOrientation(LinearLayout.VERTICAL);

    mChronometer = new Chronometer(this);
    layout.addView(mChronometer);

    Button startButton = new Button(this);
    startButton.setText("Start");
    startButton.setOnClickListener(mStartListener);
    layout.addView(startButton);

    Button stopButton = new Button(this);
    stopButton.setText("Stop");
    stopButton.setOnClickListener(mStopListener);
    layout.addView(stopButton);

    Button resetButton = new Button(this);
    resetButton.setText("Reset");
    resetButton.setOnClickListener(mResetListener);
    layout.addView(resetButton);        

    setContentView(layout);
}

private void showElapsedTime() {
    long elapsedMillis = SystemClock.elapsedRealtime() - mChronometer.getBase();            
    Toast.makeText(ChronoExample.this, "Elapsed milliseconds: " + elapsedMillis, 
            Toast.LENGTH_SHORT).show();
}

View.OnClickListener mStartListener = new OnClickListener() {
    public void onClick(View v) {
        mChronometer.start();
        showElapsedTime();
    }
};

View.OnClickListener mStopListener = new OnClickListener() {
    public void onClick(View v) {
        mChronometer.stop();
        showElapsedTime();
    }
};

View.OnClickListener mResetListener = new OnClickListener() {
    public void onClick(View v) {
        mChronometer.setBase(SystemClock.elapsedRealtime());
        showElapsedTime();
    }
};
} 
```

关于 Chronometer 的一个有点令人困惑的事情是，您不能真正将它用作开始、停止和重新启动的秒表。当它运行时，它将始终显示自上次重置以来经过的时间，*无论您在此期间停止了多少次和多长时间*。当它停止时，它只是停止更新显示。

如果你需要像秒表这样的东西，你必须继承 Chronometer 或者使用[source](http://www.google.com/codesearch/p?hl=en#uX1GffpyOZk/core/java/android/widget/Chronometer.java&q=android%20chronometer)创建你自己的版本。

![替代文字](https://farm4.static.flickr.com/3301/3273256911_192eae1767_o.png)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-08-18T00:42:32.580

我发现这个例子非常有用，谢谢 nyenyec！

这是我关于如何将其变成真正的秒表功能的两分钱，而无需子类化 Chronometer。只需更改 mStartListener 方法以解析来自 mChronometer 的文本（它毕竟是从 TextView 派生的），计算毫秒，然后使用 setBase() 将基准时间重新调整为过去的时间量：

```
 View.OnClickListener mStartListener = new OnClickListener() {
    public void onClick(View v) {

      int stoppedMilliseconds = 0;

      String chronoText = mChronometer.getText().toString();
      String array[] = chronoText.split(":");
      if (array.length == 2) {
        stoppedMilliseconds = Integer.parseInt(array[0]) * 60 * 1000
            + Integer.parseInt(array[1]) * 1000;
      } else if (array.length == 3) {
        stoppedMilliseconds = Integer.parseInt(array[0]) * 60 * 60 * 1000 
            + Integer.parseInt(array[1]) * 60 * 1000
            + Integer.parseInt(array[2]) * 1000;
      }

      mChronometer.setBase(SystemClock.elapsedRealtime() - stoppedMilliseconds);
      mChronometer.start();
    }
  }; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-04-07T09:22:34.827

@nyenyec +1：这是我最终得到的结果，同时使用了没有子类的 nyenyec 的响应。

```
 chronometer.setOnChronometerTickListener(new OnChronometerTickListener() {                      
        @Override
        public void onChronometerTick(Chronometer chronometer) {
            long elapsedMillis = SystemClock.elapsedRealtime() - chronometer.getBase();
            if(elapsedMillis>THRESHOLD){
                doYourStuff();
            }
        }
    }); 
```

其中阈值是

```
private static final int THRESHOLD_EXERSISE = 60000; //In milliseconds 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-12-24T03:40:48.730

回复有点晚，但我今天试图自己解决这个问题。我最终只是解析了视图的文本：

```
 // Expects a string in the form MM:SS or HH:MM:SS
public static int getSecondsFromDurationString(String value){

    String [] parts = value.split(":");

    // Wrong format, no value for you.
    if(parts.length < 2 || parts.length > 3)
        return 0;

    int seconds = 0, minutes = 0, hours = 0;

    if(parts.length == 2){
        seconds = Integer.parseInt(parts[1]);
        minutes = Integer.parseInt(parts[0]);
    }
    else if(parts.length == 3){
        seconds = Integer.parseInt(parts[2]);
        minutes = Integer.parseInt(parts[1]);
        hours = Integer.parseInt(parts[0]);
    }

    return seconds + (minutes*60) + (hours*3600);
} 
```

因此，使用 view.getText().toString() 调用 getSecondsFromDurationString 可为您提供以秒为单位的总经过时间（我的应用程序是某种秒表，因此您可以暂停并恢复它）。

希望能帮助到你。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-12-22T08:53:30.700

我的解决方案：

```
 public void starttimer(View view){
    Button mybtn = (Button) view;
    if (mybtn.equals(findViewById(R.id.button1))) {
        mycm.setBase(SystemClock.elapsedRealtime() - elapsed);
        mycm.start();
    }
    else {
        mycm.stop();
        elapsed = SystemClock.elapsedRealtime() -  mycm.getBase();
    }
} 
```

在 onCreate 中：

```
 mycm = (Chronometer) findViewById(R.id.chronometer1);
    elapsed = 0; 
```

布局中有两个按钮都调用 starttimer 方法（开始和停止）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-11T04:29:32.140

```
 final Chronometer counter = (Chronometer) findViewById(R.id.chronometer1);
    counter.setOnChronometerTickListener(new OnChronometerTickListener() {

        public void onChronometerTick(Chronometer chronometer) {
            // TODO Auto-generated method stub
            chronometer.refreshDrawableState();

        }
    });

    final ToggleButton togglebutton = (ToggleButton) findViewById(R.id.togglebutton1);
    togglebutton.setOnClickListener(new OnClickListener() {
        public void onClick(View v) {
            // Perform action on clicks
            if (togglebutton.isChecked()) {
                counter.start();
            } else {
                counter.stop();
            }
        }
    }); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-07T09:55:58.673

```
//ok here is the final changed code which works well

import android.app.Activity;
import android.os.Bundle;
import android.os.SystemClock;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.Chronometer;
import android.widget.LinearLayout;
import android.widget.Toast;

public class HelloWidgetActivity extends Activity {
    Chronometer mChronometer;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        LinearLayout layout = new LinearLayout(this);
        layout.setOrientation(LinearLayout.VERTICAL);

        mChronometer = new Chronometer(this);
        layout.addView(mChronometer);

        Button startButton = new Button(this);
        startButton.setText("Start");
        startButton.setOnClickListener(mStartListener);
        layout.addView(startButton);

        Button stopButton = new Button(this);
        stopButton.setText("Stop");
        stopButton.setOnClickListener(mStopListener);
        layout.addView(stopButton);

        Button resetButton = new Button(this);
        resetButton.setText("Reset");
        resetButton.setOnClickListener(mResetListener);
        layout.addView(resetButton);

        setContentView(layout);
    }

    private void showElapsedTime() {
        long elapsedMillis = SystemClock.elapsedRealtime()
                - mChronometer.getBase();
        Toast.makeText(HelloWidgetActivity.this,
                "Elapsed milliseconds: " + elapsedMillis, Toast.LENGTH_SHORT).show();
    }

    View.OnClickListener mStartListener = new OnClickListener() {
        public void onClick(View v) {
          int stoppedMilliseconds = 0;
          String chronoText = mChronometer.getText().toString();
          String array[] = chronoText.split(":");
          if (array.length == 2) {
            stoppedMilliseconds = Integer.parseInt(array[0]) * 60 * 1000
                + Integer.parseInt(array[1]) * 1000;
          } else if (array.length == 3) {
            stoppedMilliseconds = Integer.parseInt(array[0]) * 60 * 60 * 1000 
                + Integer.parseInt(array[1]) * 60 * 1000
                + Integer.parseInt(array[2]) * 1000;
          }
          mChronometer.setBase(SystemClock.elapsedRealtime() - stoppedMilliseconds);
          mChronometer.start();
        }
      };

    View.OnClickListener mStopListener = new OnClickListener() {
        public void onClick(View v) {
            mChronometer.stop();
            showElapsedTime();
        }
    };

    View.OnClickListener mResetListener = new OnClickListener() {
        public void onClick(View v) {
            mChronometer.setBase(SystemClock.elapsedRealtime());
            mChronometer.stop();
            showElapsedTime();
        }
    };
} 
```

# javascript - 如何为 HTML 元素创建方法？

> ID：526526
> 
> 赞同：2
> 
> 时间：2009-02-08T22:24:08.167
> 
> 标签：javascript

我正在尝试创建一个简单、小型且基本的 JavaScript 框架，仅用于学习目的。但问题是我已经被困在最基本的东西上。

我正在尝试做这样的事情：

```
$('testdiv').testFunction(); 
```

我为此编写的代码：

```
var elementID;
var smallFramework = {

  $:function(id) {
    this.elementID = id;
  },

  testFunction:function() {
    alert(this.elementID);
  }

};
window.$ = smallFramework.$; 
```

但作为回报，我得到：

```
$('testdiv) is undefined 
```

任何人都可以帮助我解决这个小而希望简单的问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T22:30:23.893

要获得您期望的行为，您需要该`$`函数返回一个带有名为 的方法的对象`testFunction`。尝试：

```
var smallFramework = // an object for namespacing
{
  $:function(id) // the core function - returns an object wrapping the id
  {
    return {                    // return an object literal
      elementID: id,            // holding the id passed in
      testFunction: function()  // and a simple method
      {
         alert(this.elementID);
      }
    };
  }
}; 
```

当然，还有[许多其他方法](https://stackoverflow.com/questions/504803/how-do-you-create-a-method-for-a-custom-object-in-javascript)可以实现您想要的行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T23:42:12.877

尝试

```
smallFramework.$('testdiv'); 
```

反而。根据您发布的代码，这就是您的`$`功能结束的地方。

或者，您似乎正在尝试复制 jQuery 之类的东西。你可能想尝试这样的事情。

```
var $ = smallFramework = (function () {
   var f = 
   {

     find:function(id) {
       f.elementID = id;
       return f;  //every function should return f, for chaining to work
     },

     testFunction:function() {
       alert(f.elementID);
       return f;
     }

   }

return f.find  //the find function will be assigned to $. 
//and also assigned to smallFramework.
//the find function returns f, so you get access to testFunction via chaining
// like $("blah").testFunction()

})() //note this function gets called immediately. 
```

这段代码可能会让 JavaScript 新手感到困惑，因为它在很大程度上依赖于闭包的概念。我建议如果这没有意义，请花一些时间在 Douglas Crockford 的 JavaScript 网站上。这很重要，因为如果您碰巧`this`在 find 函数中使用上面的代码，因为`this`不会被绑定到`f`，因为您可能期望它在从`$`或 smallFramework 中使用它时会如此。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T22:41:16.067

如果您尝试向 HTML 元素添加方法，您可以按照这些思路进行操作。

```
$ = function( elementId ) {
    var element = document.getElementById( elementId );
    element.testFunction = function(){
        alert( this.id );
        return this; // for chaining
    }
    return element;
}

$('test').testFunction(); 
```

# .net - 实体框架：加载多对一实体

> ID：526530
> 
> 赞同：2
> 
> 时间：2009-02-08T22:28:01.277
> 
> 标签：.net, linq-to-sql, entity-framework

假设我有一个角色实体和一个站点实体。现在一个站点有许多角色，因此在 Role 类中有一个 Site 属性表示该关系。如果我想要一个站点的角色，我会这样做：

```
Site.Roles.Load() 
```

问题是，由于 Role 类的 Site 属性不是一个集合，而只是一个实体，因此没有 Load 方法：

```
currentRole.Site //???? 
```

因此，当加载角色时，站点为空，除了在角色集合上查询以获取 SiteID、从站点集合中获取站点，最后将其设置为 currentRole 的站点之外，没有其他方法可以获取站点财产。

一定有更好的方法？我是否必须强制在查询中加入某种形式？似乎这将由代码生成，就像 Load 方法的行为一样。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-10T07:21:27.307

实际上，访问它不会自动加载它。您可以使用 Include 方法将相关实体包含在单个查询中，但您也可以使用带有引用的 Load 方法，就像使用集合一样 - 它不是在 CLR 引用属性上，而是在与 CLR 平行的 EntityReference 属性上实体上的参考。它的名称与 CLR 参考相同，但附加了“参考”一词。所以你可以说：

```
currentRole.SiteReference.Load(); 
```

值得一提的是，在 EF 的 VS 2010 / .net 4.0 版本中，还可以在 ObjectContext 上设置一个属性，该属性将打开隐式延迟加载，以便访问 clr 引用时会自动加载它尚未加载。

丹尼

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T22:44:51.893

访问它将加载它。如果您希望它显式加载它，则对象查询上应该有一个 .Include() 方法。

```
db.Sites.Include("Role").ToList(); 
```

[这是一些文档](http://msdn.microsoft.com/en-us/library/bb738708.aspx)

# c# - 如何在文本框中找到光标的位置？C＃

> ID：526540
> 
> 赞同：64
> 
> 时间：2009-02-08T22:33:24.917
> 
> 标签：c#, cursor-position

我有一个标准的 WinForms TextBox，我想在文本中光标的位置插入文本。如何获取光标的位置？

谢谢

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-02-08T22:38:19.380

无论是否选择了任何文本，[SelectionStart](http://msdn.microsoft.com/en-us/library/system.windows.forms.textboxbase.selectionstart.aspx)属性都表示插入符号所在文本的索引。因此，您可以使用[String.Insert](http://msdn.microsoft.com/en-us/library/system.string.insert.aspx)注入一些文本，如下所示：

```
myTextBox.Text = myTextBox.Text.Insert(myTextBox.SelectionStart, "Hello world"); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-08T22:36:14.660

您想检查`SelectionStart`.`TextBox`

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-16T23:10:20.457

詹姆斯，当您只想在光标位置插入一些文本时，需要替换整个字符串是非常低效的。

更好的解决方案是：

```
textBoxSt1.SelectedText = ComboBoxWildCard.SelectedItem.ToString(); 
```

当您没有选择任何内容时，它将在光标位置插入新文本。如果您选择了某些内容，这会将您选择的文本替换为您要插入的文本。

我从[eggheadcafe 网站](http://www.eggheadcafe.com/conversation.aspx?messageid=33631735&threadid=33621636)找到了这个解决方案。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-09-05T13:54:56.107

您所要做的就是：

双击将文本插入到光标处的文档的项目（按钮、标签等）。然后输入：

```
richTextBox.SelectedText = "whatevertextyouwantinserted"; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-09-25T04:53:52.553

这是我的工作实现，允许只输入数字，并恢复最后一个有效的输入文本位置：

xml:

```
<TextBox
      Name="myTextBox" 
      TextChanged="OnMyTextBoxTyping" /> 
```

后面的代码：

```
private void OnMyTextBoxTyping(object sender, EventArgs e)
{
    if (!System.Text.RegularExpressions.Regex.IsMatch(myTextBox.Text, @"^[0-9]+$"))
    {
        var currentPosition = myTextBox.SelectionStart;
        myTextBox.Text = new string(myTextBox.Text.Where(c => (char.IsDigit(c))).ToArray());
        myTextBox.SelectionStart = currentPosition > 0 ? currentPosition - 1 : currentPosition;
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-08T22:56:12.503

您必须将`SelectionStart`属性保存在变量中，然后当您按下按钮时，将焦点移回 TextBox。然后将`SelectionStart`属性设置为变量中的那个。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-08T22:58:52.390

你会建议我在什么情况下记录变量？离开？

目前我有：

```
private void comboBoxWildCard_SelectedIndexChanged(object sender, EventArgs e)
{
    textBoxSt1.Focus();
    textBoxSt1.Text.Insert(intCursorPos, comboBoxWildCard.SelectedItem.ToString());

}

private void textBoxSt1_Leave(object sender, EventArgs e)
{
    intCursorPos = textBoxSt1.SelectionStart;
} 
```

正在录制离开事件，但没有插入文本，我错过了什么吗？

更新：我需要 textBoxSt1.Text =

```
textBoxSt1.Text = textBoxSt1.Text.Insert(intCursorPos, comboBoxWildCard.SelectedItem.ToString()); 
```

谢谢大家。

谢谢

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-04-09T09:37:47.853

```
int cursorPosition = textBox1.SelectionStart;
//it will extract your current cursor position where ever it is
//textBox1 is name of your text box. you can use one
//which is being used by you in your form 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-05-19T00:19:49.137

要在 a 的文本中单击鼠标时获取插入符号的位置，请`TextBox`使用`TextBox` `MouseDown`事件。使用 的 X 和 Y 属性创建一个点`MouseEventArgs`。有`TextBox`一个方法叫做`GetCharIndexFromPosition(point)`. 将点传递给它，它会返回插入符号的位置。如果您使用鼠标来确定要插入新文本的位置，则此方法有效。

# paypal - 如何从桌面应用程序使用 Paypal？

> ID：526541
> 
> 赞同：5
> 
> 时间：2009-02-08T22:34:01.700
> 
> 标签：paypal, desktop-application

是否可以像网页通常那样收集账单信息并将其从桌面应用程序发送到 Paypal？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T22:38:21.160

Paypal 使用 HTTP 协议进行通信。只要您将它与桌面应用程序一起使用，它就可以工作。

从这个[示例代码](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&content_ID=developer/library_code)页面可以看出，他们只是使用 api 向paypal 服务器发出 HTTP 请求（对于 php 示例是[cURL ）。](http://curl.haxx.se/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-07-29T12:52:51.343

不确定这对您来说是否为时已晚，但它可能会帮助其他人四处寻找类似的功能。我也一直在寻找一种方法，可以让我搜索贝宝交易并给我有关销售和销售产品的确切数字。然后我发现了我已经使用了一段时间的[PaySketch](http://www.paysketch.com)，它已经成为我日程的一部分，根据我从应用程序获得的统计数据（重新）组织营销和销售工作。我会说这是每个使用贝宝销售商品的供应商都必须拥有的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T13:49:30.737

您还可以尝试开发 adobe AIR 应用程序。该应用程序将独立于平台。[你可以在这里](http://www.adobe.com/devnet/air/)阅读更多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-05T12:04:28.543

如果您想从桌面跟踪您的 Paypal 帐户，您可以尝试[Putler](http://www.appsmagnet.com/paypal/putler)。它不会让您在桌面上接受新的付款，但可以向您显示有见地的报告。

# html - 您将使用什么 HTML/CSS 来创建带背景的文本输入？

> ID：526548
> 
> 赞同：12
> 
> 时间：2009-02-08T22:40:44.010
> 
> 标签：html, css, input

我有一个网站设计，其中包含如下所示的文本输入字段：

[输入字段 http://img401.imageshack.us/img401/4453/picture1ts2.png](http://img401.imageshack.us/img401/4453/picture1ts2.png)

我想知道创建此输入字段的最佳解决方案是什么。

我的一个想法是始终在输入周围放置一个带有背景图像的 div，并且在输入字段上禁用所有边框并以像素为单位指定宽度，例如：

```
<div class="borderedInput"><input type="text" /></div> 
```

我试图劝阻他们不要使用这种格式，但他们不会气馁，所以看起来我必须这样做。

这是最好的还是有其他方法？

--

审判：

我尝试了以下方法：

```
<style type="text/css">
input.custom {
    background-color: #fff;
    background:url(/images/input-bkg-w173.gif) no-repeat;
    width:173px;
    height:28px;
    padding:8px 5px 4px 5px;
    border:none;
    font-size:10px;
}
</style>
<input type="text" class="custom" size="12" /> 
```

但在 IE (6 & 7) 中，当您输入的内容超过宽度时，它会执行以下操作：

[超长 http://img240.imageshack.us/img240/1417/picture2kp8.png](http://img240.imageshack.us/img240/1417/picture2kp8.png)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-08T23:16:06.013

我会这样做：

```
<style type="text/css">
div.custom {
    background:url(/images/input-bkg-w173.gif) no-repeat;
    padding:8px 5px 4px 5px;
}
div.custom input {
    background-color: #fff;
    border:none;
    font-size:10px;
}
</style>
<div class="custom"><input type="text" class="custom" size="12" /></div> 
```

您只需要调整填充值，以便一切正确。在我看来，这绝对是最好的解决方案，因为在任何其他情况下，您都在使用整个输入字段。根据定义，整个输入字段是一个用户可以输入文本的框。

如果您可以依赖 JavaScript，您可以以编程方式将此类 div 元素包装在您的输入字段周围。

**编辑：** 使用 jQuery，你可以这样做：

```
$( 'input.custom' ).wrap( '<div class="custom"></div>' ); 
```

CSS：

```
div.custom {
    background:url(/images/input-bkg-w173.gif) no-repeat;
    padding:8px 5px 4px 5px;
}
input.custom {
    background-color: #fff;
    border:none;
    font-size:10px;
} 
```

还有你的 HTML：

```
<input class="custom" ... /> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T22:45:50.597

您不需要 div 元素，您可以直接为输入分配背景。

**编辑：**这是工作代码。我对其进行了测试，但您必须根据需要对其进行调整。据我所知，这里的一切都是必需的。

```
input {
    background: #FFF url(test.png) no-repeat bottom right;
    width: 120px;
    height: 20px;
    line-height:20px;
    padding:0;
    text-indent:3px;
    margin:0;
    border: none;
    overflow:hidden;
} 
```

**Edit2：**我不太确定我为什么会被否决，但是除非您需要比输入元素本身更大的图像，否则这种方法应该可以工作。在这种情况下，您应该使用额外的 div 元素。但是，如果图像与输入的大小相同，则不需要额外的标记。

**Edit3：**好的，在 bobince 指出一个问题之后，我离得更近了。这将在 IE6 和 7 中工作，并且在 FF 中很接近，但我仍在努力。

```
input {
    background: #FFF url(test.png) no-repeat 0px 0px;
    background-attachment:fixed;
    width: 120px;
    height: 20px;
    line-height:20px;
    padding:0px;
    text-indent:3px;
    margin:0;
    border: none;
}
body>input {
    background-position:13px 16px;
} 
```

**Edit4**：好的，我想这次我明白了，但它需要使用 CSS3 选择器，所以它不会被验证为 CSS 2.1。

```
input { 
    background: #FFF url(test.png) no-repeat 0px 0px;
    background-attachment:fixed;
    width: 120px;
    height: 20px;
    line-height:20px;
    padding:0px;
    text-indent:3px;
    margin:0;
    border: none;
}
body>input { 
    background-position:13px 16px;
}
body>input:enabled { 
    background-position:9px 10px;
} 
```

body>input 将针对除 IE6 之外的所有内容，body>input:enabled 将针对除 IE 6、7 和 8 之外的所有浏览器未禁用的任何表单元素。但是，因为 :enabled 是 CSS3 选择器，所以它不会'不验证为 CSS2.1。我找不到合适的 CSS2 选择器来让我将 IE7 与其他浏览器分开。如果不验证（直到验证器切换到 CSS3）对您来说是个问题，那么我认为您唯一的选择是额外的 div 元素。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T22:48:50.620

您是否使用这样的背景图像进行了评估：

```
<style type="text/css"> 
  input{ 
  background-color: #AAAAAA; 
  background-image: url('http://mysite.com/input.gif'); 
  border: 0px; 
  font-family: verdana; 
  font-size: 10px; 
  color: #0000FF; 
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T22:44:48.087

我已经这样做了几次。我在 div 中有背景图像，并使用 css 相应地定位输入字段。

看看我创建的使用此技术并使用代码的以下站点：[http](http://www.ukoffer.com/) ://www.ukoffer.com/ （右侧时事通讯）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T00:02:22.240

AFAIK，背景滚动问题可以在 Firefox 和朋友或 Internet Exploder 中解决；但不能一下子让每个人都开心。

我通常会说直接为输入设置样式，但现在我认为 div 示例听起来还不错，应该解决您的背景图像滚动问题。

在这种情况下，您将 div 设置为 position:relative，并将输入放入其中，并具有适当的填充和宽度（如果填充为 0，则为 100% 宽度）、背景透明，并将图像放在 div 上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T04:24:01.783

okoman 已经得到了正确的 CSS 方面。我可以建议使用 a`<label>`来改进标记的语义结构吗？

```
<label id="for-field-name" for="field-name">
    <span class="label-title">Field Name <em class="required">*</em></span>
    <input id="field-name" name="field-name" type="text" class="text-input" />
</label>

<style type="text/css">
    label, span.label-title { display: block; }
</style> 
```

这不仅更易于访问，而且它提供了许多钩子，您可以在未来将它们用于任何类型的 DOM 操作、验证或特定于字段的样式。

**编辑：**如果您不希望出于某种原因显示标签标题，您可以给它一个“可访问性”类并将该类设置为`display: none;`在 CSS 中。这将允许屏幕阅读器理解输入，但对普通用户隐藏。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-23T19:26:49.457

在没有 JavaScript 的情况下摆脱溢出的最简单方法很简单：

1.  创建 3 个跨度，并将它们的高度设置为图像的高度。
2.  将图像切成 3 部分，确保将图像切割成左右圆形部分分别位于第 1 和第 3 图像上。
3.  将第一个跨度的背景设置为具有左边框的图像，并将其设置为不重复。
4.  将第三个 span 的背景设置为具有右边框的图像，并将其设置为 no-repeat。
5.  将输入放在中间跨度内，记住将其高度设置为跨度的高度，并将其背景设置为第二张图像，并且仅重复-x。
6.  这将确保一旦输入被填充，输入似乎会水平扩展。没有重叠，也不需要 JS。

HTML 假设图片高度为 60px，第一个和第三个 span 的宽度为 30px，

```
<span id="first">nbsp;</span><br />
<span id="second"><input type="text" /></span><br />
<span id="third">nbsp;</span> 
```

CSS

```
span#first{background:url('firstimage') no-repeat; height:60px; width:30px;}
span#third{background:url('thirdimage') no-repeat; height:60px; width:30px;}
span#second input{background:url('second image') repeat-x; height:60px;} 
```

那应该可以解决您的问题。

# linq - LINQ（或任何东西）将对象列表中的项目添加到数据网格中的对象行？

> ID：526553
> 
> 赞同：0
> 
> 时间：2009-02-08T22:41:36.470
> 
> 标签：linq, reflection, datagridview, datarow

说对象如下：

```
string Name
Dictionary<string,bool> Tags 
```

其中标签是动态的，但有一个标签列表存储在核心数据对象的 Collection 中。

我希望能够像这样在数据网格中显示它：

```
Name  tag1  tag2 tag3
Bob   true  true
John  true       true 
```

我遗漏了错误，但如果需要，它可能在那里。

干杯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-09T03:52:24.663

你不能直接用 LINQ 做到这一点，因为你必须动态地创建投影，标签集合中的每个键都成为一个属性。

我建议您创建一个 DataSet，其列对应于标签（加上 Name 属性），然后行对应于您拥有的类的实例。

# c# - C＃ ？？结合？：问题

> ID：526555
> 
> 赞同：3
> 
> 时间：2009-02-08T22:42:34.753
> 
> 标签：c#, ternary-operator, conditional-operator

我正在为一个项目构建一个 XML Deserializer，并且我经常遇到这种类型的代码情况：

```
var myVariable = ParseNDecimal(xml.Element("myElement")) == null ? 
                 0 : ParseNDecimal(xml.Element("myElement")).Value; 
```

有没有更好的方法来写这个声明？

编辑：也许我应该澄清我的例子，因为我确实有一个帮助方法来将字符串解析为小数。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-08T22:47:24.273

您可以使用扩展方法：

```
public static T TryGetValue<T>( this XmlElement element ) {
    if ( null == element ) return default(T);
    return (T)element.Value;
}
...
...
var myVariable = xml.Element("myElement").TryGetValue<decimal>(); 
```

**编辑：**

“通用”解决方案：

```
static class Program {
    static void Main() {
        var xmlDecimal = new XElement( "decimal" );
        xmlDecimal.Value = ( 123.456m ).ToString();
        decimal valueOfDecimal_1 = xmlDecimal.ValueAs<decimal>( decimal.TryParse );
        bool valueOfBool_1 = xmlDecimal.ValueAs<bool>( bool.TryParse );

        var xmlBool = new XElement( "bool" );
        xmlBool.Value = true.ToString();
        decimal valueOfDecimal_2 = xmlBool.ValueAs<decimal>( decimal.TryParse );
        bool valueOfBool_2 = xmlBool.ValueAs<bool>( bool.TryParse );
    }
}

public static class StaticClass {
    public delegate bool TryParseDelegate<T>( string text, out T value );
    public static T ValueAs<T>( this XElement element, TryParseDelegate<T> parseDelegate ) {
        return ValueAs<T>( element, parseDelegate, default( T ) );
    }
    public static T ValueAs<T>( this XElement element, TryParseDelegate<T> parseDelegate, T defaultValue ) {
        if ( null == element ) { return defaultValue; }

        T result;
        bool ok = parseDelegate( element.Value, out result );
        if ( ok ) { return result; }

        return defaultValue;
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-08T22:47:25.083

**编辑：**鉴于已编辑的问题，这要简单得多。

它再次使用扩展方法，但现在无需在方法中进行转换。

```
var myVariable = ParseNDecimal(xml.Element("myElement").ValueOrDefault("0"));

...

public static string ValueOrDefault(this XElement element, 
                                     string defaultValue)
{
    return element != null ? element.Value : defaultValue;
} 
```

如果你不喜欢使用字符串参数的方法，你可以让它 take`object`和 call `ToString`，然后像这样调用它：

```
var myVariable = ParseNDecimal(xml.Element("myElement").ValueOrDefault(0m)); 
```

但是，这对我来说感觉有点不对劲。它假定解析将与`ToString`格式化相反。

**原始答案**

该语言没有什么特别可以帮助您的。（我不确定你的代码是否正确——你的意思不是`XAttribute`吗？）我建议编写一个实用程序方法：

```
var myVariable = xml.Element("myElement").ValueOrDefault(0m);

...

public static decimal ValueOrDefault(this XElement element, 
                                     decimal defaultValue)
{
    return element != null ?(decimal) element.Value : defaultValue;
} 
```

如果你调整问题中的代码，我也会对这里的代码做同样的事情。我怀疑您*确实*是要使用`XAttribute`，这会导致泛型出现问题-我没有以通用的方式编写上述内容，因为我相信您会想要调用`XAttribute`“转换为十进制”运算符。通用转换不会这样做，因为它在编译时不知道您想要什么样的转换。但是，您可以为您感兴趣的所有结果类型重载上述方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T23:01:59.993

你可以使用?? 运算符写得更干净一些，但我不确定你应该...

`Element()`如果没有具有该名称的子元素，则返回 null，因此您可以使用 ?? 滑入默认元素。您需要在调用`(decimal)`演员表之前执行此操作：

```
var myVariable 
    = (decimal)(xml.Element("myElement") ?? new XElement("myElement", 0)); 
```

就像我说的那样，虽然这会起作用，但我不确定你是否*应该*这样做。YMMV。

# php - 如何在 PHP 中将多维数组“展平”为简单数组？

> ID：526556
> 
> 赞同：87
> 
> 时间：2009-02-08T22:43:06.920
> 
> 标签：php, arrays, multidimensional-array

这可能是初学者的问题，但我已经阅读了较长时间的文档，但找不到任何解决方案。我想我可以对每个维度使用 implode，然后将这些字符串重新组合在一起`str_split`以创建新的简单数组。但是，我永远不知道连接模式是否也在值中，因此在执行完`str_split`我的原始值之后可能会中断。

`combine($array1, $array2)`多维数组中的数组有类似的东西吗？

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2013-02-20T05:11:37.630

```
$array  = your array

$result = call_user_func_array('array_merge', $array);

echo "<pre>";
print_r($result); 
```

参考： http: [//php.net/manual/en/function.call-user-func-array.php](http://php.net/manual/en/function.call-user-func-array.php)

**这是另一种解决方案（适用于多维数组）：**

```
function array_flatten($array) {

   $return = array();
   foreach ($array as $key => $value) {
       if (is_array($value)){ $return = array_merge($return, array_flatten($value));}
       else {$return[$key] = $value;}
   }
   return $return;

}

$array  = Your array

$result = array_flatten($array);

echo "<pre>";
print_r($result); 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2013-04-11T02:04:11.080

这是一条线，超级好用：

```
$result = array();
array_walk_recursive($original_array,function($v) use (&$result){ $result[] = $v; }); 
```

在匿名函数/闭包内部很容易理解。`$v`是你的价值`$original_array`。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-02-08T22:53:11.763

[采用`array_walk_recursive`](http://php.net/manual/en/function.array-walk-recursive.php)

```
<?php

$aNonFlat = array(
    1,
    2,
    array(
        3,
        4,
        5,
        array(
            6,
            7
        ),
        8,
        9,
    ),
    10,
    11
);

$objTmp = (object) array('aFlat' => array());

array_walk_recursive($aNonFlat, create_function('&$v, $k, &$t', '$t->aFlat[] = $v;'), $objTmp);

var_dump($objTmp->aFlat);

/*
array(11) {
  [0]=>
  int(1)
  [1]=>
  int(2)
  [2]=>
  int(3)
  [3]=>
  int(4)
  [4]=>
  int(5)
  [5]=>
  int(6)
  [6]=>
  int(7)
  [7]=>
  int(8)
  [8]=>
  int(9)
  [9]=>
  int(10)
  [10]=>
  int(11)
}
*/

?> 
```

使用 PHP 5.5.9-1ubuntu4.24 (cli) 测试（构建时间：2018 年 3 月 16 日 12:32:06）

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2018-12-21T21:42:46.263

如果您特别有一个不超过一层深度的数组（我发现一个常见的用例），您可以使用`array_merge`splat 运算符。

```
<?php

$notFlat = [[1,2],[3,4]];
$flat = array_merge(...$notFlat);
var_dump($flat); 
```

输出：

```
array(4) {
  [0]=>
  int(1)
  [1]=>
  int(2)
  [2]=>
  int(3)
  [3]=>
  int(4)
} 
```

splat 运算符有效地将数组数组更改为数组列表作为`array_merge`.

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-12-01T06:57:00.727

```
// $array = your multidimensional array

$flat_array = array();

foreach(new RecursiveIteratorIterator(new RecursiveArrayIterator($array)) as $k=>$v){

$flat_array[$k] = $v;

} 
```

还记录在案： [http ://www.phpro.org/examples/Flatten-Array.html](http://www.phpro.org/examples/Flatten-Array.html)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2020-07-09T05:26:28.773

对于 necrobumping 感到抱歉，但所提供的答案都没有达到我直观理解为“扁平化多维数组”的效果。即本案：

```
[
  'a' => [
    'b' => 'value',
  ]
] 
```

所有提供的解决方案都会将其展平为 just `['value']`，但这会丢失有关键和深度的信息，而且如果您在其他地方有另一个 'b' 键，它将覆盖它们。

我想得到这样的结果：

```
[
  'a_b' => 'value',
] 
```

`array_walk_recursive`不传递有关它当前递归的密钥的信息，所以我只用简单的递归来做到这一点：

```
function flatten($array, $prefix = '') {
    $return = [];
    foreach ($array as $key => $value) {
        if (is_array($value)) {
            $return = array_merge($return, flatten($value, $prefix . $key . '_'));
        } else {
            $return[$prefix . $key] = $value;
        }
    }
    return $return;
} 
```

根据您的喜好修改 $prefix 和 '_' 分隔符。

这里的游乐场：[https ://3v4l.org/0B8hf](https://3v4l.org/0B8hf)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-06-29T15:12:22.123

在 PHP 7 中，您可以使用生成器和生成器委托 ( `yield from`) 来展平数组：

```
function array_flatten_iterator (array $array) {
    foreach ($array as $value) {
        if (is_array($value)) {
            yield from array_flatten_iterator($value);
        } else {
            yield $value;
        }
    }
}

function array_flatten (array $array) {
    return iterator_to_array(array_flatten_iterator($array), false);
} 
```

例子：

```
$array = [
    1,
    2,
    [
        3,
        4,
        5,
        [
            6,
            7
        ],
        8,
        9,
    ],
    10,
    11,
];    

var_dump(array_flatten($array)); 
```

[http://3v4l.org/RU30W](http://3v4l.org/RU30W)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-02-08T22:48:01.433

非递归解决方案（但破坏顺序）：

```
function flatten($ar) {
    $toflat = array($ar);
    $res = array();

    while (($r = array_shift($toflat)) !== NULL) {
        foreach ($r as $v) {
            if (is_array($v)) {
                $toflat[] = $v;
            } else {
                $res[] = $v;
            }
        }
    }

    return $res;
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-02-08T23:16:22.783

```
function flatten_array($array, $preserve_keys = 0, &$out = array()) {
    # Flatten a multidimensional array to one dimension, optionally preserving keys.
    #
    # $array - the array to flatten
    # $preserve_keys - 0 (default) to not preserve keys, 1 to preserve string keys only, 2 to preserve all keys
    # $out - internal use argument for recursion
    foreach($array as $key => $child)
        if(is_array($child))
            $out = flatten_array($child, $preserve_keys, $out);
        elseif($preserve_keys + is_string($key) > 1)
            $out[$key] = $child;
        else
            $out[] = $child;
    return $out;
} 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2011-06-10T10:04:13.087

[PHP的用户评论](http://php.net/manual/pt_BR/class.recursiveiteratoriterator.php)（简化）和[这里](http://blog.siteroller.net/recursion-depth-in-arraywalk)的另一种方法：

```
function array_flatten_recursive($array) { 
   if (!$array) return false;
   $flat = array();
   $RII = new RecursiveIteratorIterator(new RecursiveArrayIterator($array));
   foreach ($RII as $value) $flat[] = $value;
   return $flat;
} 
```

这种方法的最大好处是它跟踪递归的深度，如果你在展平时需要它。
这将输出：

```
$array = array( 
    'A' => array('B' => array( 1, 2, 3)), 
    'C' => array(4, 5) 
); 
print_r(array_flatten_recursive($array)); 

#Returns: 
Array ( 
    [0] => 1 
    [1] => 2 
    [2] => 3 
    [3] => 4 
    [4] => 5 
) 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-08-24T22:58:29.357

在 PHP>=5.3 中，基于 Luc M 的回答（第一个），您可以使用这样的闭包

```
array_walk_recursive($aNonFlat, function(&$v, $k, &$t){$t->aFlat[] = $v;}, $objTmp); 
```

我喜欢这个，因为我不必像使用 create_function() 时那样用引号将函数的代码括起来

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-05-10T18:43:16.073

使用高阶函数（注意：我使用的是[内联匿名函数](http://php.net/manual/en/functions.anonymous.php)，它出现在 PHP 5.3 中）：

```
function array_flatten($array) {
    return array_reduce(
        $array,
        function($prev, $element) {
            if (!is_array($element))
                $prev[] = $element;
            else
                $prev = array_merge($prev, array_flatten($element));
            return $prev;
        },
        array()
    );
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-04-10T22:40:54.243

如果您对丢失数组键没问题，您可以使用递归闭包作为利用 array_values() 的回调来展平多维数组，确保此回调是 array_walk() 的参数，如下所示。

```
<?php  

$array = [1,2,3,[5,6,7]];
$nu_array = null;
$callback = function ( $item ) use(&$callback, &$nu_array) {
    if (!is_array($item)) {
    $nu_array[] = $item;
    }
    else
    if ( is_array( $item ) ) {
     foreach( array_values($item) as $v) {
         if ( !(is_array($v))) {
             $nu_array[] = $v;
         }
         else
         { 
             $callback( $v );
         continue;
         }    
     }
    }
};

array_walk($array, $callback);
print_r($nu_array); 
```

上一个示例的一个缺点是它涉及的代码比使用 array_walk_recursive() 和简化回调的以下解决方案要多得多：

```
<?php  

$array = [1,2,3,[5,6,7]];

$nu_array = [];
array_walk_recursive($array, function ( $item ) use(&$nu_array )
                     {
                         $nu_array[] = $item;
                     }
);
print_r($nu_array); 
```

查看[实时代码](https://3v4l.org/3LaNc)

这个例子似乎比上一个更可取，隐藏了有关如何从多维数组中提取值的细节。当然，迭代会发生，但它是否需要递归或控制结构，你只能通过**阅读 array.c**知道。由于函数式编程关注的是输入和输出，而不是获得结果的细节，因此人们当然可以不关心幕后的迭代是如何发生的，直到有远见的雇主提出这样的问题。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-08-31T11:46:50.173

基于之前chaos提交的示例函数的一种新方法，修复了multiarrays中覆盖字符串键的bug：

```
# Flatten a multidimensional array to one dimension, optionally preserving keys.
# $array - the array to flatten
# $preserve_keys - 0 (default) to not preserve keys, 1 to preserve string keys only, 2 to preserve all keys
# $out - internal use argument for recursion

function flatten_array($array, $preserve_keys = 2, &$out = array(), &$last_subarray_found) 
{
        foreach($array as $key => $child)
        {
            if(is_array($child))
            {
                $last_subarray_found = $key;
                $out = flatten_array($child, $preserve_keys, $out, $last_subarray_found);
            }
            elseif($preserve_keys + is_string($key) > 1)
            {
                if ($last_subarray_found)
                {
                    $sfinal_key_value = $last_subarray_found . "_" . $key;
                }
                else
                {
                    $sfinal_key_value = $key;
                }
                $out[$sfinal_key_value] = $child;
            }
            else
            {
                $out[] = $child;
            }
        }

        return $out;
}

Example:
$newarraytest = array();
$last_subarray_found = "";
$this->flatten_array($array, 2, $newarraytest, $last_subarray_found); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-09-11T01:25:56.243

```
/*consider $mArray as multidimensional array and $sArray as single dimensional array
this code will ignore the parent array
*/

function flatten_array2($mArray) {
    $sArray = array();

    foreach ($mArray as $row) {
        if ( !(is_array($row)) ) {
            if($sArray[] = $row){
            }
        } else {
            $sArray = array_merge($sArray,flatten_array2($row));
        }
    }
    return $sArray;
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-02-21T15:17:47.387

你可以试试这个：

```
function flat_an_array($a)
{
    foreach($a as $i)
    {
        if(is_array($i)) 
        {
            if($na) $na = array_merge($na,flat_an_array($i));
            else $na = flat_an_array($i);
        }
        else $na[] = $i;
    }
    return $na;
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-01-10T21:52:56.103

我找到了一种将多级数组转换为一个的简单方法。我使用函数“http_build_query”将数组转换为 url 字符串。然后，使用explode 拆分字符串并解码该值。

这是一个示例。

```
$converted = http_build_query($data);
$rows = explode('&', $converted);
$output = array();
foreach($rows AS $k => $v){
   list($kk, $vv) = explode('=', $v);
   $output[ urldecode($kk) ] =  urldecode($vv);
}
return $output; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-05-21T19:40:00.273

您可以使用[非标准 PHP 库 (NSPL)中的](https://github.com/ihor/Nspl)[flatten](https://github.com/ihor/Nspl#flattensequence-depth--null)函数。它适用于数组和任何可迭代的数据结构。

```
assert([1, 2, 3, 4, 5, 6, 7, 8, 9] === flatten([[1, [2, [3]]], [[[4, 5, 6]]], 7, 8, [9]])); 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-12-11T13:18:58.717

简单的方法..通过递归查看..

```
<?php

function flatten_array($simple){
static $outputs=array();
foreach ( $simple as $value)
{
if(is_array($value)){
    flatten_array($value);
}
else{
    $outputs[]=$value;
}

}
return $outputs;
}

$eg=['s'=>['p','n'=>['t']]];
$out=flatten_array($eg);
print_r($out);

?> 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-02-18T15:52:29.723

有人可能会觉得这很有用，我在某个维度上展平数组时遇到了问题，我将其称为最后一维，例如，如果我有如下数组：

```
array (
  'germany' => 
  array (
    'cars' => 
    array (
      'bmw' => 
      array (
        0 => 'm4',
        1 => 'x3',
        2 => 'x8',
      ),
    ),
  ),
  'france' => 
  array (
    'cars' => 
    array (
      'peugeot' => 
      array (
        0 => '206',
        1 => '3008',
        2 => '5008',
      ),
    ),
  ),
) 
```

或者：

```
array (
  'earth' => 
  array (
    'germany' => 
    array (
      'cars' => 
      array (
        'bmw' => 
        array (
          0 => 'm4',
          1 => 'x3',
          2 => 'x8',
        ),
      ),
    ),
  ),
  'mars' => 
  array (
    'france' => 
    array (
      'cars' => 
      array (
        'peugeot' => 
        array (
          0 => '206',
          1 => '3008',
          2 => '5008',
        ),
      ),
    ),
  ),
) 
```

对于这两个数组，当我调用下面的方法时，我得到结果：

```
array (
  0 => 
  array (
    0 => 'm4',
    1 => 'x3',
    2 => 'x8',
  ),
  1 => 
  array (
    0 => '206',
    1 => '3008',
    2 => '5008',
  ),
) 
```

所以我正在展平到最后一个应该保持不变的数组维度，下面的方法可以重构为实际上停止在任何级别：

```
function flattenAggregatedArray($aggregatedArray) {
    $final = $lvls = [];
    $counter = 1;
    $lvls[$counter] = $aggregatedArray;

    $elem = current($aggregatedArray);

    while ($elem){
        while(is_array($elem)){
            $counter++;
            $lvls[$counter] = $elem;
            $elem =  current($elem);
        }

        $final[] = $lvls[$counter];
        $elem = next($lvls[--$counter]);
        while ( $elem  == null){
            if (isset($lvls[$counter-1])){
                $elem = next($lvls[--$counter]);
            }
            else{
                return $final;
            }
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2014-07-23T20:44:54.140

如果您只对一个特定键的值感兴趣，您可能会发现这种方法很有用：

```
function valuelist($array, $array_column) {
    $return = array();
    foreach($array AS $row){
        $return[]=$row[$array_column];
    };
    return $return;
}; 
```

例子：

给定 $get_role_action=

```
array(3) {
  [0]=>
  array(2) {
    ["ACTION_CD"]=>
    string(12) "ADD_DOCUMENT"
    ["ACTION_REASON"]=>
    NULL
  }
  [1]=>
  array(2) {
    ["ACTION_CD"]=>
    string(13) "LINK_DOCUMENT"
    ["ACTION_REASON"]=>
    NULL
  }
  [2]=>
  array(2) {
    ["ACTION_CD"]=>
    string(15) "UNLINK_DOCUMENT"
    ["ACTION_REASON"]=>
    NULL
  }
} 
```

比`$variables['role_action_list']=valuelist($get_role_action, 'ACTION_CD');`会导致：

```
$variables["role_action_list"]=>
  array(3) {
    [0]=>
    string(12) "ADD_DOCUMENT"
    [1]=>
    string(13) "LINK_DOCUMENT"
    [2]=>
    string(15) "UNLINK_DOCUMENT"
  } 
```

从那里你可以像这样执行值查找：

```
if( in_array('ADD_DOCUMENT', $variables['role_action_list']) ){
    //do something
}; 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2015-09-25T06:38:29.143

这对我没有任何作用......所以不得不自己运行它。工作得很好：

```
function arrayFlat($arr){
$out = '';
    foreach($arr as $key => $value){

        if(!is_array($value)){
            $out .= $value.',';
        }else{
            $out .= $key.',';
            $out .= arrayFlat($value);
        }

    }
    return trim($out,',');
}

$result = explode(',',arrayFlat($yourArray));
echo '<pre>';
print_r($result);
echo '</pre>'; 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2015-11-11T22:47:51.497

给定多维数组并将其转换为一维，可以通过取消设置所有具有数组的值并将它们保存到第一维来完成，例如：

```
function _flatten_array($arr) {
  while ($arr) {
    list($key, $value) = each($arr); 
    is_array($value) ? $arr = $value : $out[$key] = $value;
    unset($arr[$key]);
  }
  return (array)$out;
} 
```

# web-services - “网络服务”和“网络服务”有什么区别？

> ID：526557
> 
> 赞同：1
> 
> 时间：2009-02-08T22:43:31.927
> 
> 标签：web-services, terminology

我认为“Web 服务”和“Web 服务”之间存在明显区别，并且发现自己将后者称为“小写 Web 服务”。

我会松散地将差异列出为：

*   “网页服务”

    *   最符合[W3C 定义](http://www.w3.org/TR/ws-arch/#whatis "W3C 对 Web 服务的定义")
    *   基于[WS-* 堆栈](http://en.wikipedia.org/wiki/WS-*)
    *   企业级
    *   成熟可靠
    *   高度关注基于行业标准的互操作性
*   “网页服务”

    *   没有正式定义
    *   基于松散的堆栈，不一定基于 XML
    *   启动级
    *   强烈关注简单性
    *   互操作性是必要的，但不受更成熟实践的约束
    *   对新技术开放

我有兴趣找到更正式的“Web 服务”定义以及其他人对两者之间任何差异的看法。

我也有兴趣寻找对“小写 Web 服务”的任何引用，因为我确信我在某个地方遇到过它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-09T00:19:18.390

我已经看到使用“Web 服务”表示基于 SOAP 的服务和“Web 服务”表示非 SOAP 服务和/或任何类型的基于 Web 的服务的区别，而与应用程序协议无关。但是，我不认为有任何硬性规定，你当然不能基于大小写做出任何假设。

我也对将非 SOAP 标记为“启动级别”或“非正式定义”持谨慎态度，因为有许多非常大的公司使用这种类型的服务（谷歌、亚马逊、Facebook、Flickr ......），而且这些服务是既不是启动级别，也不是非正式定义的。而且您可能会发现它们比大多数所谓的“企业”Web 服务（无论大小写如何）更“为企业做好准备”、成熟和可靠。大多数这些事情与实施它们的工程师的能力有关，而不是与应用协议或技术的实际选择有关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T23:59:01.513

Web 服务是通过 http 提供的任何服务，旨在由程序而不是人类读取。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T14:25:54.063

我认为“Web 服务”和“Web 服务”之间没有区别。任何一个或另一个的出现只是特定作者的习惯或惯例。

# javascript - 测试某物是否是 javascript 中的类

> ID：526559
> 
> 赞同：25
> 
> 时间：2009-02-08T22:44:09.350
> 
> 标签：javascript

大家好，我正在尝试测试传递给我的函数的参数是否是类名，以便我可以使用 instanceof 将其与其他类进行比较。

例如：

```
function foo(class1, class2) {
  // Test to see if the parameter is a class.
  if(class1 is a class)
  {
    //do some kind of class comparison.
    if(class2 is a class)
    {
       if(class1 instanceof class2)
       {
          //...
       }
    }
    else
    {
       //...
    }
  }
  else
    //...
} 
```

这可能吗？我无法用谷歌搜索答案。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-08T22:51:00.893

javascript 中实际上没有“类”之类的东西——除了原语之外的所有东西都是一个对象。甚至函数也是对象。

instanceof 确实适用于函数。看看这个[链接](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/instanceof_Operator)。

```
function Car(make, model, year)
{
  this.make = make;
  this.model = model;
  this.year = year;
}
var mycar = new Car("Honda", "Accord", 1998);
var a = mycar instanceof Car;    // returns true
var b = mycar instanceof Object; // returns true 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2017-04-04T02:35:37.050

**现在我们有了 ES6 的原生实现**，就有了“真正的类”。与构造函数一样，这些在很大程度上是原型继承的语法糖，但存在细微的差异，两者并不完全可互换。

到目前为止，我发现的唯一方法是获取`.toString()`对象原型的构造函数并检查它是否以 OR 开头，如果`class`对象有构造函数*并且*`.toString()`以.*`class`*

 *请注意，如果您的代码已编译（即：大多数 Babel 或 TypeScript 设置），那么它将返回`function...`而不是`class...`在运行时返回（因为类被转换为构造函数）。

```
function isClass(obj) {
  const isCtorClass = obj.constructor
      && obj.constructor.toString().substring(0, 5) === 'class'
  if(obj.prototype === undefined) {
    return isCtorClass
  }
  const isPrototypeCtorClass = obj.prototype.constructor 
    && obj.prototype.constructor.toString
    && obj.prototype.constructor.toString().substring(0, 5) === 'class'
  return isCtorClass || isPrototypeCtorClass
} 
```

这仅适用于已`class`为尚未转译为`function`.

用法：

```
class A {}
class B extends A {}
isClass(A) // true
isClass(new A()) // true
isClass(B) // true
isClass(new B()) // true

function C() {}
isClass(C) // false
isClass(new C()) // false
isClass({}) // false
isClass(Date) // false
isClass(new Date()) // false

//These cases return 'true' but I'm not sure it's desired
isClass(Object.create(A)) // true    
const x = {}
Object.setPrototypeOf(x, A)
isClass(x) // true 
```

如果有更好的方法，我很想知道它是什么。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2019-05-08T06:55:03.523

这是确定您是否具有类或函数的一种快速而肮脏的方法。

```
function myFunc() { };
class MyClass() { };

Object.getOwnPropertyNames(myFunc);
// -> [ 'length', 'name', 'arguments', 'caller', 'prototype' ]

Object.getOwnPropertyNames(MyClass);
// -> [ 'length', 'prototype', 'name' ] 
```

所以我们知道我们有一个函数而*不是*一个类，如果`arguments`是一个属性名：

```
Object.getOwnPropertyNames(myFunc).includes('arguments');
// -> true

Object.getOwnPropertyNames(MyClass).includes('arguments');
// -> false 
```

箭头函数和`aysnc`函数没有`arguments`属性名称或`prototype`. 更完整的示例可能如下所示（假设我们知道输入只能是函数或类）：

```
function isFunction(funcOrClass) {
  const propertyNames = Object.getOwnPropertyNames(funcOrClass);
  return (!propertyNames.includes('prototype') || propertyNames.includes('arguments'));
} 
```

```
function isFunction(funcOrClass) {
  const propertyNames = Object.getOwnPropertyNames(funcOrClass);
  return (!propertyNames.includes('prototype') || propertyNames.includes('arguments'));
}

console.log('class isFunction?', isFunction(class A {}));
console.log('function isFunction?', isFunction(function() {}));
console.log('async function isFunction?', isFunction(async function() {}));
console.log('arrow function isFunction?', isFunction(() => {}));
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T22:49:25.860

JavaScript 没有类。它具有与 一起使用时`new`可用于生成对象实例的功能。因此，您真的想测试 if`class2`是一个函数。有很多方法可以做到这一点；jQuery 中 isFunction() 的当前 (1.3) 实现如下所示：

```
isFunction: function( obj ) {
    return toString.call(obj) === "[object Function]";
}, 
```

...但是请参阅此处了解不同方法的概要： [JavaScript 中测试函数的最佳方法？](https://stackoverflow.com/questions/405164/best-method-of-testing-for-a-function-in-javascript)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-02-09T14:19:55.773

我的解决方案是检查函数原型是否具有其他属性，`constructor`并检查函数原型是否为`Function.prototype`.

即使在使用 babel 编译后，此解决方案也可以工作，或者脚本使用“use strict”运行。但是这个解决方案只有在类至少有一个公共函数或者扩展其他类时才有效。

```
function isClass(func){
  // Class constructor is also a function
  if(!(func && func.constructor === Function) || func.prototype === undefined)
    return false;

  // This is a class that extends other class
  if(Function.prototype !== Object.getPrototypeOf(func))
    return true;

  // Usually a function will only have 'constructor' in the prototype
  return Object.getOwnPropertyNames(func.prototype).length > 1;
}

// ----Example----

class Fruit{
  hello(){} // At least must have one public function
}

// Or at least it extend other class
class Pear extends Fruit{}

console.log(isClass(Fruit)); // true
console.log(isClass(Pear)); // true
console.log(isClass(function(){})); // false
console.log(isClass(function(){"use strict"})); // false
console.log(isClass(() => {})); // false
console.log(isClass({hello: 1})); // false
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-25T18:58:55.797

我知道`constructor.name`在函数上使用会返回“函数”，但在 ES6 类实例上这样做会返回类的名称。

我确实像这样使用它：

```
function isAClassInstance(item){
 return item.constructor.name !== "Function" && item.constructor.name !== "Object";
}

class A {};
function B(){};
const aInstanceClass = new A();
const bFunctionInstance = new B();
const bFunction = B;
const aClass = A;
console.log(aInstanceClass.constructor.name); /*Will return "A"*/
console.log(bFunctionInstance.constructor.name); /*Will return "B"*/
console.log(A.constructor.name); /*Will return "Function"*/
console.log(B.constructor.name); /*Will return "Function"*/
console.log(bFunction.constructor.name); /*Will return "Function"*/
console.log("is A a class instance: ", isAClassInstance(aClass)); /*false*/
console.log("is B a class instance: ", isAClassInstance(aClass)); /*false*/
console.log("is aInstanceClass a class: ", isAClassInstance(aInstanceClass)); /*true*/
console.log("is bFunction a class: ", isAClassInstance(bFunction)); /*false*/
console.log("is bFunctionInstance a class: ", isAClassInstance(bFunctionInstance)); /*true*/ 
```

对于我使用的情况，这非常有效。

注意：因为一个类在技术上是一个函数，`new A()`并且`new B()`都是相同的，因此从 isAClassInstance 返回相同的结果。将函数与类区分开来的唯一方法是不要`new`在函数上使用，并将 this 关键字仅用于类。

希望这会有所帮助:)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-10-14T13:27:00.650

试试这个：

```
function isClass(C) { 
    return typeof C === "function" && C.prototype !== undefined;
} 
```

每个类在内部只是一个创建此类实例的**函数**，以及`prototype`分配给`[[Prototype]]`新创建对象的属性，以使它们的行为类似于该特定类的实例。所以，要检查是否`C`是一个类，你需要检查这两件事——这就是`isClass()`上面的代码所做的。

请注意，使用`function`关键字声明的所有函数也可以用作`new`构造函数和内部`instanceof`测试。它们等价于类，也有一个类`prototype`，所以这种类型的每个函数都（正确地）被`isClass()`上面的函数识别为一个类。

```
console.log(isClass(Object));    // true
console.log(isClass(Number));    // true
console.log(isClass({a:1}));     // false
console.log(isClass(123));       // false
console.log(isClass("123"));     // false

class A {}
class B extends A {}

console.log(isClass(A));         // true
console.log(isClass(B));         // true
console.log(isClass(new B()));   // false

function f(name) { this.name = name; }

console.log(isClass(f));         // true 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-11-09T05:04:35.930

嘿，刚刚更新了一个旧线程，我采用了上述答案之一，并使其适用于 javascript 中的所有预定义类。例如。字符串，地图，额外

原来的：

```
function isClass(obj) {
  const isCtorClass = obj.constructor
      && obj.constructor.toString().substring(0, 5) === 'class'
  if(obj.prototype === undefined) {
    return isCtorClass
  }
  const isPrototypeCtorClass = obj.prototype.constructor 
    && obj.prototype.constructor.toString
    && obj.prototype.constructor.toString().substring(0, 5) === 'class'
  return isCtorClass || isPrototypeCtorClass
} 
```

新的：

```
export const isClass = (obj) => {
    if (obj == null || typeof obj == "undefined") { return false; }
    const isCtorClass = obj.constructor
        && obj.constructor.toString().substring(0, 5) === 'class'
    const isNativeCtorClass= obj.constructor && 
                                  obj.constructor.name != "Function" && 
                                  obj.constructor.name in global;
    if (obj.prototype === undefined) {
        return isCtorClass || isNativeCtorClass
    }
    const isPrototypeCtorClass = obj.prototype.constructor
        && obj.prototype.constructor.toString
        && obj.prototype.constructor.toString().substring(0, 5) === 'class'

    const isNativePrototypeCtorClass = obj.prototype.constructor.name in global && (
            global[obj.prototype.constructor.name] == obj.constructor || 
            global[obj.prototype.constructor.name] == obj
        );
    return isCtorClass || isPrototypeCtorClass || isNativeCtorClass || isNativePrototypeCtorClass
} 
```

这将检查全局 javascript 对象中的对象以检查它是否是当前注册的对象。

让我知道这是否会在某些用例中中断，但它对我有用。

```
isClass(function test() {})    // false
isClass(() => {})              // false
isClass(function  String() {}) // false
isClass(String)                // true
isClass("")                    // true
isClass(0)                     // true
isClass(class Test {})         // true
isClass(new Number(0))         // true
isClass(new (class Test{})())  // true 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2019-07-13T19:58:43.640

我发现这对我有用。

```
if(typeof type === 'function' && type.name !== 'Object'){
   // This is a class.
} 
```

我使用打字稿，我已经能够使用它来一致地过滤类。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2019-05-27T19:07:19.180

我还没有找到任何 100% 确定的方法来确定某个东西是否是一个类而不是一个函数。上面接受的答案在大多数情况下都有效，但如果有人重新定义他们类的 toString() 方法，它可能会在这种情况下中断。他们为什么要重新定义 toString()？我不知道，问他们是否还在:-)

所以我采取了定义这个函数的方法：

```
function isClass(v)
{ if (typeof v !== "function")
  { return false;
  }
  if ( typeof v.isClass === "function" &&
       v.isClass()
     )
  { return true;
  }
} 
```

这意味着我可以将我自己的类标记为我识别为类的类，方法是为它们提供返回 true 的静态方法 isClass()。如果此类类具有子类，则子类会继承该方法，因此也会被自动识别为“类”。

如果我需要使用没有此方法的其他人的类，我可能会首先将他们的类子类化，以便我的子类就像他们的类，除了它也有 isClass() -方法。

我希望 EcmaScript 的下一个版本能够弥补这种缺乏标准化解决方案的问题，但目前这是我能做的最好的。

它还有一个额外的好处，就是我实际上可以将方法 isClass() 也提供给我的一些非类函数，它们不是正确的类，然后能够将这些函数视为类，不管是什么我可能想要的原因。

# .net - .NET 中的 uint.MaxValue

> ID：526564
> 
> 赞同：0
> 
> 时间：2009-02-08T22:46:04.323
> 
> 标签：.net

```
uint x = uint.MaxValue - 100;
```

上述行导致 Visual Studio 报告“在检查模式下编译时操作溢出”

我显然错过了一些东西。有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T22:52:44.853

VS 重构工具使用的 C# 前端正在报告此错误。当您继续使用实际编译器编译它时，错误就会消失！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T22:51:18.337

可能会将 uint.MaxValue 隐式转换为有**符号**，因为您要减去一个隐式签名的常量。尝试：

```
uint x = uint.MaxValue - 100U; 
```

# ruby - 如何在 Ruby 中转义字符串以防止 SQL 注入？（无导轨）

> ID：526576
> 
> 赞同：14
> 
> 时间：2009-02-08T22:50:19.553
> 
> 标签：ruby, sql-injection

我只是想知道如何在 Ruby 中转义 SQL 查询（字符串）以防止 SQL 注入。请注意我没有使用 Rails 框架。

谢谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-08T23:13:54.537

如果可能，请使用 Ruby DBI 模块，而不是尝试引用您的字符串，而是使用参数化的准备查询，如下所示：

```
dbh = DBI.connect("DBI:Mysql:test:localhost", "testuser", "testpass")
sth = dbh.prepare("INSERT INTO people (id, name, height) VALUES(?, ?, ?)")
File.open("people.txt", "r") do |f|
  f.each_line do |line|
    name, height = line.chomp.split("\t")
    sth.execute(nil, name, height)
  end
end 
```

报价将为您妥善处理，注射将成为过去。

编辑：请注意，此示例显示 nil 作为第一个参数传递给 execute()。它对应于第一个 ? 在查询中，并由 DBI 模块转换为“NULL”。其他参数同样被正确引用并插入到查询中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-08T14:54:29.773

编写一个小函数来引用字符串。我认为 Rails 只是使用这样的东西：

```
def quote_string(v)
  v.to_s.gsub(/\\/, '\&\&').gsub(/'/, "''")
end 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T02:36:36.110

您不必使用导轨，您可以`require 'activerecord'`像在导轨中一样使用它（定义模型并使用它们）。你在那里所做的只是重新发明轮子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-11T15:59:28.323

不要试图清理您的数据。使用准备好的语句。另请参阅[http://bobby-tables.com/ruby.html](http://bobby-tables.com/ruby.html)

# .net - .NET PDB 文件的格式（架构）是什么？

> ID：526579
> 
> 赞同：6
> 
> 时间：2009-02-08T22:50:45.403
> 
> 标签：.net, debugging, pdb-files, dbghelp, dia-sdk

.NET PDB 文件的格式（架构）是什么？我想从这些文件中解析出信息，以便在调试应用程序中显示正确的代码行（行号）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-08T23:25:04.543

dbghelp 库（直截了当）：

[http://msdn.microsoft.com/en-us/library/ms679309(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms679309(VS.85).aspx)

DIA SDK（更全面，但COM）：

[http://msdn.microsoft.com/en-us/library/x93ctkx8(VS.80).aspx](http://msdn.microsoft.com/en-us/library/x93ctkx8(VS.80).aspx)

我自己只使用过 dbghelp，并且只用于本机二进制文件。我发现它很容易使用，如果您只需将地址转换为文件名和行号。不能说它是否也适用于托管应用程序，但如果不是，那么它看起来就像 DIA SDK 一样。

至于 PDB 格式，引用 DIA 页面，“因为后编译工具生成的 .pdb 文件格式不断修改，暴露格式是不切实际的”。就是这样，我想...

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-15T21:45:51.527

正如我在这篇[博](http://codebetter.com/blogs/patricksmacchia/archive/2009/04/15/the-microsoft-project-cci-common-compiler-infrastructure-goes-open-source.aspx)文中解释的那样，CCI 项目刚刚开源，社区第一次拥有一个 100% 托管的框架来读取 PDB 文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T22:59:02.310

看过工具帮助/调试帮助 API [http://msdn.microsoft.com/en-us/magazine/cc301692.aspx](http://msdn.microsoft.com/en-us/magazine/cc301692.aspx)吗？

# c++ - 修改打开的文件 c++

> ID：526583
> 
> 赞同：1
> 
> 时间：2009-02-08T22:51:10.303
> 
> 标签：c++, winapi

在 Windows 下，有没有办法修改由另一个进程使用 c++ 打开的文件/可执行文件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-08T23:02:56.420

> 有没有办法在 Windows 中修改打开的可执行文件？

不。

> 有没有办法使用 C++ 在 Windows 中修改打开的文件？

是的。如果它已使用适当的共享权限打开。请参阅[http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx) FILE_SHARE_WRITE

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T01:54:27.803

这可能是可能的，但可能并不容易实现。您需要在目标进程中注入线程并了解 PE 格式以正确编辑打开的文件并对其进行修改。
所有信息都在网络上。

祝你好运。

我找到了这个免费软件工具，它建议[解锁文件和文件夹](http://www.diamondcs.com.au/freeutilities/fileunlocker.php)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T04:49:14.043

只要可执行文件正在运行，操作系统就会将其保持为只读共享，因此无法直接对其进行修改。但是，您可以打开它进行*阅读*（如果您在`CreateFile`调用中指定读取共享），并在它运行时制作它的修改副本。

我不知道这是否是您的想法，但如果您正在执行此操作是您自己的程序，您可以启动新副本并让它从前一个停止的地方继续...不是直截了当，但是也不是那么困难。

# linq-to-sql - 从 LINQ 到 SQL 再到 Entity Framework，你想要什么特性？

> ID：526595
> 
> 赞同：1
> 
> 时间：2009-02-08T22:56:23.473
> 
> 标签：linq-to-sql, entity-framework

如果您要从 LINQ 迁移到 SQL 再到 Entity Framework，您最希望看到哪些特性随之迁移？您认为迁移现有项目需要哪些功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T23:17:53.640

1.  真正的执着无知。
2.  完成 POCO 支持。
3.  没有魔线。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T23:25:38.410

当与具有完整 LINQ 支持的 Fluent NHibernate 一起使用时，类似于 NHibernate 的内容。

在我看来，NHibernate 是目前最好的 ORM。唯一可以击败它的方法是完整的 LINQ 支持。NHibernate 目前还没有这个——只有基本的支持——而且 LINQ 语法比 NHibernate 给你的选项更有吸引力和自然。

# asp.net-mvc - 在 ViewModel 中放入什么

> ID：526641
> 
> 赞同：14
> 
> 时间：2009-02-08T23:23:14.220
> 
> 标签：asp.net-mvc, separation-of-concerns

你在你的视图中放了什么？

[Scott Hanselman](http://www.hanselman.com/blog)最近的一篇[关于](http://www.hanselman.com/blog/IPrincipalUserModelBinderInASPNETMVCForEasierTesting.aspx)使用特殊模型绑定器来简化测试的博客让我想到了以下问题：在构建视图模型的控制器逻辑中放置了什么，应该在视图中放置什么？他所做的是：

```
var viewModel = new DinnerFormViewModel {  
    Dinner = dinner,  
    Countries = new SelectList(PhoneValidator.Countries, dinner.Country)  
};  
return View(viewModel); 
```

现在，我使用相同的方式将数据传递给我的视图，但我不确定他如何处理 Country 属性。您可能会争论双方：将国家列表包装在 SelectList 中会为视图准备数据，就像您创建视图模型 DTO 来传递数据一样。另一方面，感觉就像您在专门操作要在下拉列表中使用的数据，从而限制了视图处理来自控制器的数据的方式。我觉得这在视图和控制器之间的关注点分离上有点灰色地带，我真的无法决定走哪条路。有没有这方面的最佳实践？

PS：为简单起见，让我们假设默认的 ASP.NET MVC 上下文，所以基本上是您的开箱即用项目。默认视图引擎和所有爵士乐。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-08T23:35:21.180

在 MVC（至少是这种风格）中，控制器的职责之一是为视图准备数据。所以我认为为视图消费准备一个特定的模型是完全可以接受的，这意味着它将在下拉列表中使用。在这种情况下，控制器只是让视图更容易，实际上可以防止笨拙的代码不得不流入视图。它还可以防止在 ViewData 中出现像 VieData["Countries"] 这样的魔法字符串。

总而言之，虽然在职责方面似乎存在一些灰色地带，但最终这就是控制器的工作：与视图交互并将域模型转换为其他更容易被控制器使用的模型。看法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-08T23:57:04.653

一些人建议每个视图拥有一个包罗万象的视图模型是理想的（称为[Thunderdome 原则](http://codebetter.com/blogs/jeremy.miller/archive/2008/10/23/our-opinions-on-the-asp-net-mvc-introducing-the-thunderdome-principle.aspx)）。

# .net - .NET 下的访问冲突错误的常见原因

> ID：526649
> 
> 赞同：8
> 
> 时间：2009-02-08T23:27:49.730
> 
> 标签：.net, vb.net, access-violation

我正在寻找 .NET 下访问冲突错误的常见原因。

到目前为止我检查过的东西 -

*   对所有实现 IDisposable 的对象调用 Dispose
*   检查对 COM 对象的调用中的有效参数
*   显式删除所有手动添加的事件处理程序
*   不要明确调用 GC.Collect/GC.WaitForPendingFinalizers
*   处理本机对象（位图等）时添加和*删除内存压力（已***添加**）
*   验证有效参数类型的所有 PInvoke 调用
*   确保正确使用 IntPtr、SafeHandle 和 HandleRef
*   线程（线程安全，可重入函数），正确使用等待句柄。（**已添加**）
*   确保应用程序和 DLL 都针对相同的平台（x86 或 x64）（应用程序和 dll 的目标应与 COM 对象相同。）（已**添加**）

还有其他建议吗？

**编辑**- 将故障转储分析移至不同的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T23:48:56.683

任何不安全或非托管代码的使用都可能使您遇到这种类型的异常。

[访问违规异常：](http://msdn.microsoft.com/en-us/library/system.accessviolationexception.aspx)

> 当代码尝试读取或写入尚未分配或无权访问的内存时，在非托管或不安全代码中会发生访问冲突。这通常是因为指针的值不正确。并非所有通过错误指针进行的读取或写入都会导致访问冲突，因此访问冲突通常表示通过错误指针发生了多次读取或写入，并且内存可能已损坏。因此，访问违规几乎总是表明严重的编程错误。在 .NET Framework 2.0 版中，AccessViolationException 清楚地标识了这些严重错误。
> 
> 在完全由可验证的托管代码组成的程序中，所有引用要么有效要么为空，并且访问冲突是不可能的。仅当可验证的托管代码与非托管代码或不安全的托管代码交互时，才会发生 AccessViolationException。

推荐的：

[GFlags](http://technet.microsoft.com/en-us/library/cc738763.aspx)和[应用程序验证器](http://msdn.microsoft.com/en-us/library/ms220948.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T23:30:17.510

您是在运行时生成 IL 还是使用这样做的组件？使用不安全的 C# 代码，进行指针操作？

# .net - .NET下的缓冲区溢出错误的常见原因

> ID：526655
> 
> 赞同：1
> 
> 时间：2009-02-08T23:32:07.147
> 
> 标签：.net, overflow, buffer

我正在寻找 .NET 下缓冲区溢出错误的常见原因。

**我知道在托管的 .NET 代码下缓冲区溢出是*不可能的。*但是，在 .NET 应用程序范围内仍然可能出现此异常。**

我想到的东西——

*   COM 对象调用的有效参数
*   PInvoke/Win32 调用的有效参数

调试缓冲区溢出错误的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T00:27:28.480

从评论到问题：

> 那么你们如何去调试.NET 下的缓冲区溢出错误呢？

大多数时候，一开始就没有什么可以调试的。我的意思是，当然存在错误并且您需要修复它，但错误不在您的代码中。它在您调用的非托管库中，您无法更改。您唯一能做的就是不要以这种方式使用该库。

所以这是一个常见原因：非托管库中的错误。

如果您调用没有错误的非托管库，也可能发生这种情况，但该库希望您明确告诉它缓冲区的大小并且您给它错误的数字。这是您需要修复的代码问题。然而，它在 .Net 中很少发生，因为查找缓冲区的大小通常就像检查字节数组的 .Length 属性一样简单。

# c++ - 刚开始 C++：编译时出现未定义符号错误

> ID：526660
> 
> 赞同：1
> 
> 时间：2009-02-08T23:36:29.320
> 
> 标签：c++, compilation

情况如下：

我刚开始我的第一个 C++ 课程。我对 C++ 一无所知，尽管这是对 C++ 课程的介绍，但老师几乎没有教过该语言的语法，只是我们已经知道的逻辑。

现在他给了我们一个程序描述并说，“写吧，哈哈。” 我理解逻辑很好，但正如我之前所说，我对 C++ 一无所知。因此，我首先用 java 编写了它（我确实知道），然后一旦我让它在 java 中工作，我就尝试将它编码为 C++。

但是现在我在编译时收到以下错误

```
uxb3% g++ -o Race race.cc
Undefined                       first referenced
 symbol                             in file
main                                /usr/local/gcc-4.1.1/bin/../lib/gcc/sparc-sun-solaris2.10/4.1.1/crt1.o
ld: fatal: Symbol referencing errors. No output written to Race
collect2: ld returned 1 exit status 
```

有人可以帮我吗？

这是我在 .txt 文件中的代码： [http ://rapidshare.com/files/195742284/race.txt.html](http://rapidshare.com/files/195742284/race.txt.html)

这是复制粘贴：

```
#include <cstdlib>
#include <ctime>
#include <iostream>
#include <string>

using namespace std;
class Race
{

        void main()
        {
                executeRace();
        }

        int randomMove()
        {
                srand(time(NULL));
                int randomInt = rand() % 100 + 1;
                return randomInt;
        }

        void executeRace()
        {
                int rabbitPosition = 1;
                int turtlePosition = 1;

                cout << "BANG!!!" << endl << "AND THEY'RE OFF!!!";

                while (rabbitPosition <=70 && turtlePosition <=70)
                {
                        printPositions(rabbitPosition, turtlePosition);

                        turtlePosition = turtleMoveSquares(turtlePosition);
                        rabbitPosition = rabbitMoveSquares(rabbitPosition);
                }

                printWinner(rabbitPosition, turtlePosition);

                tie(rabbitPosition, turtlePosition);
        }

        int turtleMoveSquares(int tPosition)
        {

                int turtleMove = randomMove();

                if(turtleMove >=1 && turtleMove <= 40)
                        tPosition = tPosition + 4;

                if(turtleMove >= 41 && turtleMove <= 50 )
                        tPosition = tPosition - 2;

                if(turtleMove >=51 && turtleMove <=100)
                        tPosition = tPosition + 2;

                if(tPosition < 1)
                        tPosition = 1;

                return tPosition;
        }

        int rabbitMoveSquares(int rabbitPosition)
        {

                int rabbitMove = randomMove();

                if(rabbitMove >=1 && rabbitMove <= 25)
                        rabbitPosition = rabbitPosition;

                if(rabbitMove >=26 && rabbitMove <= 55)
                        rabbitPosition = rabbitPosition + 10;

                if(rabbitMove >=56 && rabbitMove <=60)
                        rabbitPosition = rabbitPosition - 15;

                if(rabbitMove >=61 && rabbitMove <= 90)
                        rabbitPosition = rabbitPosition + 5;

                if(rabbitMove >=90 && rabbitMove <=100)
                        rabbitPosition = rabbitPosition - 3;

                if(rabbitPosition < 1)
                        rabbitPosition = 1;

                return rabbitPosition;
        }

        void printPositions(int rabbitPositions, int turtlePositions)
        {
                int turtleCount;
                int rabbitCount;
                int endCount;

                if(rabbitPositions == turtlePositions && rabbitPositions != 1)
                {
                        turtleCount = 1;

                        while(turtleCount < turtlePositions)
                        {
                                cout << "-";
                                turtleCount = turtleCount+1;
                        }
                        cout << "OUCH!";
                }

                else
                {
                        turtleCount = 1;
                        rabbitCount = 1;
                        endCount=1;

                        if(turtlePositions < rabbitPositions)
                        {
                                while(turtleCount < turtlePositions)
                                {
                                        cout <<  "-";
                                                turtleCount = turtleCount+1;
                                }

                                cout << "T";

                                while(rabbitCount < (rabbitPositions - turtlePositions))
                                {
                                        cout <<  "-";
                                        rabbitCount = rabbitCount+1;
                                }
                                cout << "H";

                        }

                        if(rabbitPositions < turtlePositions)
                        {
                                while(rabbitCount < rabbitPositions)
                                {
                                        cout << "-";
                                                rabbitCount = rabbitCount+1;
                                }
                                cout << "H";

                                while(turtleCount < (turtlePositions - rabbitPositions))
                                {
                                        cout << "-";
                                        turtleCount = turtleCount+1;
                                }
                                cout << "T";

                                cout << "\n";
                        }
                }
        }

        void printWinner(int rabbitPosition, int turtlePosition)
        {
                if(turtlePosition >= 70 && rabbitPosition < 70)
                {
                        cout << "TORTOISE WINS!!! YAY!!!\n";
                }
                else if(rabbitPosition >=70 && turtlePosition < 70)
                {
                        cout << "Hare wins. Yuch.\n";
                }
                else if(rabbitPosition >=70 && turtlePosition >=70)
                {
                        cout << "It's a tie\n";
                }
        }

        void tie(int turtlePosition, int rabbitPosition)
        {
                if(rabbitPosition >=70 && turtlePosition >=70)
                        executeRace();
        }
}; 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-08T23:39:05.960

它抱怨`main`未定义，这是正确的。C 和 C++ 需要一个名为返回的*独立*函数。拥有一个带有名为 的方法的*类*是不够的；编译器只关心独立的。`main``int`*`main`*

 *要记住的另一件事是，`class`类型中成员的默认可见性是*private*。要么改变你的类来使用`struct`——这几乎是两者之间的唯一区别——或者指定公共可见性：

```
class Race {
public:
  void main() { ... }
}; 
```

然后你可以`main`从你的类中调用该函数：

```
int main() {
  Race race;
  race.main();
  return EXIT_SUCCESS;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T23:39:30.263

您需要一个 main() 函数来为程序提供一个起点：

```
int main()
{
     // whatever...
     // Maybe:

     Race race;

     race.main();
} 
```

但是让你的许多方法成为静态方法可能是有意义的，因为它们不依赖于`Race`类的任何实例成员。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-08T23:41:04.627

您需要一个主要功能：

```
// The arguments are only needed if passing arguments to your program.
// You could just use `int main()`.
int main(int argc, char** argv)
{
    Race race;
    race.executeRace();
} 
```

左右，没有看到你的具体错误。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-08T23:41:19.010

C++ 与 Java 完全不同。例如，函数不必是类的一部分。您需要移动函数 main() 使其位于类之外。

```
class Race {
  // stuff
};

int main() {
  // stuff
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-08T23:42:19.883

也许这就是你的意思

```
#include <cstdlib>
#include <ctime>
#include <iostream>
#include <string>

using namespace std;

class Race
{

public:
    void ExecuteRace()
    {
        int rabbitPosition = 1;
        int turtlePosition = 1;

        cout << "BANG!!!" << endl << "AND THEY'RE OFF!!!";

        while (rabbitPosition <=70 && turtlePosition <=70)
        {
            printPositions(rabbitPosition, turtlePosition);

            turtlePosition = turtleMoveSquares(turtlePosition);
            rabbitPosition = rabbitMoveSquares(rabbitPosition);
        }

        printWinner(rabbitPosition, turtlePosition);

        tie(rabbitPosition, turtlePosition);
    }

private:
    int randomMove()
    {
        srand(time(NULL));
        int randomInt = rand() % 100 + 1;
        return randomInt;
    }

    int turtleMoveSquares(int tPosition)
    {

        int turtleMove = randomMove();

        if(turtleMove >=1 && turtleMove <= 40)
            tPosition = tPosition + 4;

        if(turtleMove >= 41 && turtleMove <= 50 )
            tPosition = tPosition - 2;

        if(turtleMove >=51 && turtleMove <=100)
            tPosition = tPosition + 2;

        if(tPosition < 1)
            tPosition = 1;

        return tPosition;
    }

    int rabbitMoveSquares(int rabbitPosition)
    {

        int rabbitMove = randomMove();

        if(rabbitMove >=1 && rabbitMove <= 25)
            rabbitPosition = rabbitPosition;

        if(rabbitMove >=26 && rabbitMove <= 55)
            rabbitPosition = rabbitPosition + 10;

        if(rabbitMove >=56 && rabbitMove <=60)
            rabbitPosition = rabbitPosition - 15;

        if(rabbitMove >=61 && rabbitMove <= 90)
            rabbitPosition = rabbitPosition + 5;

        if(rabbitMove >=90 && rabbitMove <=100)
            rabbitPosition = rabbitPosition - 3;

        if(rabbitPosition < 1)
            rabbitPosition = 1;

        return rabbitPosition;
    }

    void printPositions(int rabbitPositions, int turtlePositions)
    {
        int turtleCount;
        int rabbitCount;
        int endCount;

        if(rabbitPositions == turtlePositions && rabbitPositions != 1)
        {
            turtleCount = 1;

            while(turtleCount < turtlePositions)
            {
                cout << "-";
                turtleCount = turtleCount+1;
            }
            cout << "OUCH!";
        }

        else
        {
            turtleCount = 1;
            rabbitCount = 1;
            endCount=1;

            if(turtlePositions < rabbitPositions)
            {
                while(turtleCount < turtlePositions)
                {
                    cout <<  "-";
                    turtleCount = turtleCount+1;
                }

                cout << "T";

                while(rabbitCount < (rabbitPositions - turtlePositions))
                {
                    cout <<  "-";
                    rabbitCount = rabbitCount+1;
                }
                cout << "H";

            }

            if(rabbitPositions < turtlePositions)
            {
                while(rabbitCount < rabbitPositions)
                {
                    cout << "-";
                    rabbitCount = rabbitCount+1;
                }
                cout << "H";

                while(turtleCount < (turtlePositions - rabbitPositions))
                {
                    cout << "-";
                    turtleCount = turtleCount+1;
                }
                cout << "T";

                cout << "\n";
            }
        }
    }

    void printWinner(int rabbitPosition, int turtlePosition)
    {
        if(turtlePosition >= 70 && rabbitPosition < 70)
        {
            cout << "TORTOISE WINS!!! YAY!!!\n";
        }
        else if(rabbitPosition >=70 && turtlePosition < 70)
        {
            cout << "Hare wins. Yuch.\n";
        }
        else if(rabbitPosition >=70 && turtlePosition >=70)
        {
            cout << "It's a tie\n";
        }
    }

    void tie(int turtlePosition, int rabbitPosition)
    {
        if(rabbitPosition >=70 && turtlePosition >=70)
            ExecuteRace();
    }
};

void main()
{
    Race race;
    race.ExecuteRace();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-08T23:42:39.053

您没有主要功能。

C++ 与 Java 最大的不同在于它的 main() 函数有这样的签名（参数可选）：

```
int main(int argc, char** argv); 
```

它位于全局命名空间中。这是程序启动时调用的函数，可能是您缺少符号的原因。

尝试将此添加到您的程序中：

```
int main() {
    Race r;
    r.main();
    return 0;
} 
```

或者，您可以完全取消该课程，因为您实际上并没有对它做任何事情。

# .net - IntPtr、SafeHandle 和 HandleRef - 解释

> ID：526661
> 
> 赞同：46
> 
> 时间：2009-02-08T23:36:45.793
> 
> 标签：.net, winapi, interop

如果不将我指向 MSDN，有人可以简明扼要地解释每个这些的目的以及何时使用它们。（IntPtr、SafeHandle 和 HandleRef）

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-02-09T00:45:24.600

`IntPtr`只是一个简单的基于整数的结构，可以保存一个指针（即，在 32 位系统上为 32 位大小，在 64 位系统上为 64 位大小）。

`SafeHandle`是一个用于保存 Win32 对象句柄的类 - 它有一个终结器，可确保在对象被 GC 时关闭句柄。 `SafeHandle`是一个抽象类，因为不同的 Win32 句柄有不同的关闭方式。在引入 之前`SafeHandle`，`IntPtr`用于保存 Win32 句柄，但确保它们被正确关闭并防止被 GC 处理是程序员的责任。

`HandleRef`是一种确保在 P/Invoke 调用过程中未对非托管句柄进行 GC 的方法。如果没有类似的东西`HandleRef`，如果您的托管代码在 P/Invoke 调用之后对句柄没有做任何事情，如果在 P/Invoke 调用期间运行了 GC，它将不会意识到句柄仍在使用中并且可能 GC 它。我想（但我不确定也没有看过）`SafeHandle`可能会`HandleRef`用作封装句柄管理的一部分。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2010-02-17T23:36:50.000

```
HWnd a = new HWnd();
B.SendMessage(a.Handle, ...); 
```

假设这是程序中对“a”的唯一引用，这相当于：

```
HWnd a = new HWnd();
IntPtr h = a.Handle;
// a is no longer needed and thus can be GC'ed
B.SendMessage(h, ...); 
```

问题是当“a”被释放时，它会关闭句柄。如果在调用 SendMessage 之前或期间发生这种情况，则句柄将无效。

HandleRef 防止在程序使用 h 完成之前对“a”进行垃圾收集。

# excel - Excel合并多行

> ID：526664
> 
> 赞同：1
> 
> 时间：2009-02-08T23:39:13.243
> 
> 标签：excel

我觉得我错过了一些我想用 Excel 做的简单事情，但我在 Google 上错误地问了这个问题……就这样。

我正在为一位经营比赛计时公司的朋友查看一些 Excel 表格。在比赛结束时，他有一个 Excel 表格，格式如下，用于一系列比赛

姓名 | 性别 | 年龄 | 第 1 场 | 比赛 2 | 第 3 场
比赛鲍勃 | 中号 | 20 | 1 | |
铝 | 中号 | 24 | 2 | |
鲍勃 | 中号 | 20 | | 2 |
铝 | 中号 | 24 | | 1 |

::假设我们现在不关心时间，只需放置::

我想做“某事”（再次，我不确定正确的术语是什么，在 Excel 中合并实际上将两个相邻的单元格合并在一起），在那里我可以获得最终输出，使得

姓名 | 性别 | 年龄 | 第 1 场 | 比赛 2 | 第 3 场
比赛鲍勃 | 中号 | 20 | 1 | 2 |
铝 | 中号 | 24 | 2 | 1 |

我不确定如何将类似行的数据折叠在一起。

我不反对写一点 VBA，但我认为这是一个内置的 Excel 函数，但我不确定它叫什么或如何让它“跳舞”。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T23:47:49.247

[数据透视表。](http://office.microsoft.com/en-us/excel/HA010346321033.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T00:54:36.107

数据格式使生活变得比需要的更加困难。与其为第 1 场、第 2 场、第 3 场比赛等单独列，不如有一个名为“比赛编号”的列并像这样排列数据：

```
Name | Gender | Age | Race Number | Place
Bob  | M      |  20 |           1 |     1
Al   | M      |  24 |           1 |     2
Bob  | M      |  20 |           2 |     2
Al   | M      |  24 |           2 |     1 
```

这将使数据透视表（如 Jason 所建议）之类的东西更容易使用

# php - 持久化 PHP 应用程序设置的最佳方式是什么？

> ID：526666
> 
> 赞同：6
> 
> 时间：2009-02-08T23:39:35.537
> 
> 标签：php, database, web-applications, file-io, settings

我有一个正在开发的小型应用程序，我可能想将其提供/出售给其他人。我想保留一些设置，并创建一个管理界面来修改它们。将它们存放起来的最佳方法是什么？对于我将拥有的 10-20 个设置，DB 表似乎有点过头了，我希望尽可能快地检索这些设置。平面文件是另一个可行的选择吗？使用平面文件有哪些陷阱？与存储多个键和值的平面文件交互的最快/最简单方法是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-08T23:42:28.120

我经常[`parse_ini_file`](http://us2.php.net/function.parse-ini-file)为此使用 PHP。

所以如果你用这个写一个 .ini 文件：

```
; This is a sample configuration file
; Comments start with ';', as in php.ini

[first_section]
one = 1
five = 5
animal = BIRD

[second_section]
path = "/usr/local/bin"
URL = "http://www.example.com/~username"

[third_section]
phpversion[] = "5.0"
phpversion[] = "5.1"
phpversion[] = "5.2"
phpversion[] = "5.3" 
```

并使用以下 PHP 代码阅读它：

```
define('BIRD', 'Dodo bird');
$ini_array = parse_ini_file("sample.ini", true);
print_r($ini_array); 
```

你会得到这个输出：

```
Array
(
    [first_section] => Array
        (
            [one] => 1
            [five] => 5
            [animal] => Dodo bird
        )

    [second_section] => Array
        (
            [path] => /usr/local/bin
            [URL] => http://www.example.com/~username
        )

    [third_section] => Array
        (
            [phpversion] => Array
                (
                    [0] => 5.0
                    [1] => 5.1
                    [2] => 5.2
                    [3] => 5.3
                )

        )

) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T23:42:17.700

PHP 具有读取 .ini 文件的功能。

[http://is2.php.net/manual/en/function.parse-ini-file.php](http://is2.php.net/manual/en/function.parse-ini-file.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T01:02:16.413

这实际上取决于您要存储的“设置”类型。它们是数据库主机、端口和登录等“引导”设置吗？还是它们是专门针对您的应用程序的应用程序设置？

让管理界面在文件系统上写入文件的问题是写入文件所需的权限。每当您打开 Web 服务器来写入文件时，都会增加代码中的错误可能导致严重的权限提升的可能性。

数据库旨在允许读取和写入，而不会引入潜在的系统安全风险。

我们使用“生成”的 PHP 文件来存储静态配置数据（如数据库访问信息）。它由用户在命令行上的实用程序脚本生成。之后，所有非静态信息都存储在数据库表中。反过来，数据库表很容易从管理区域更新。当您升级您的应用程序时，它很容易扩展和升级。

将需要备份的“数据”集中在一个地方也容易得多。

我可以建议使用 memcached 或类似的东西来加速它吗？

只是几个想法...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T00:52:32.100

我认为通过 SimpleXMLElement 实现的 XML 对于这类事情非常有用。

配置（config.xml）：

```
<config version="1">
  <foo>value</foo>
  <bar>
    <baz>Boo</baz>
  </bar>
</config> 
```

阅读它的代码：

```
$config = simplexml_load_file('config.xml');
$version = (int) $config['version'];
$foo = (string) $config->foo;
$baz = (string) $config->bar->baz; 
```

将其写入文件的代码：

```
$config = new SimpleXMLElement('<config version="1"/>');
$config->foo = 'value';
$config->bar->baz = 'Boo';
$config->asXML('config.xml'); 
```

使用平面文件的主要缺陷是它可能导致脚本崩溃或并发编辑时可能导致数据损坏。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T23:44:33.933

考虑一个序列化为文件的 PHP 对象（或数组）。无需编写解析代码，足够快，可扩展。需要注意的是，随着代码的增长以支持进一步的设置，请考虑一种“升级”设置文件的策略。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-09T11:29:34.083

我只是将 PHP 数组用于配置文件。

```
<?php 
return array
(
    'user' => 'name',
    'pass' => 'word',
    'one_day' => 60 * 60 * 24
);
?> 
```

一些优点是，就像morendil提到的，不需要解析，它的速度很快，你可以存储各种复杂的变量/方程，你可以做以下事情：

```
<?php
$config = include 'path/to/file.php';
?> 
```

# visual-studio - VS2008文件和“开始调试”

> ID：526670
> 
> 赞同：0
> 
> 时间：2009-02-08T23:41:47.527
> 
> 标签：visual-studio, visual-studio-2008, fortran

这听起来像是一个新手问题——确实如此。我对 vs 比较陌生，几个月前我们开始使用它，但我仍然没有“从心理上”从命令行进行更改。所以，如果你能帮我做两件事：

1.  我创建了一个新项目（不是解决方案）。他将文件放在某个目录中。将代码放入其中后，我单击绿色小三角形（上面写着“调试”），然后他编译、构建并运行它。它工作正常。现在，有时，我只需要更改一点点代码，我不想为此而启动整个 VS。假设我没有更改任何其他内容，我该如何从命令行执行调试操作。
2.  我在哪里告诉他不要创建“调试”子目录，不要创建 HTML 构建日志、目标文件……等等，一般来说，我在哪里可以找到有助于我获得尽可能少的文件的设置。 ..除了我的原始来源和 .exe 结果吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T23:48:22.207

> 我只需要更改一点点代码，而且我不想仅仅为此而启动整个 VS。假设我没有更改任何其他内容，我该如何从命令行执行调试操作。

我认为您在这里想要的不是调试，而是重建您的项目。

> 我在哪里告诉他不要创建“调试”子目录，不要创建 HTML 构建日志、目标文件……等等，一般来说，我在哪里可以找到有助于我获得尽可能少的文件的设置。 ..除了我的原始来源和 .exe 结果吗？

这两个问题的答案都是使用命令行！您可以让 VS 从加载的项目中发出一个 make 文件。进行所需的修改后，使用 NMAKE 构建此 make 文件。“.obj”文件是作为编译和链接阶段之间的中间步骤创建的，这就是 C++[编译模型](http://www.cs.cf.ac.uk/Dave/C/node3.html)的工作方式。为什么坚持不生成它们？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T01:42:44.540

如果不启动 Visual Studio，就无法真正开始调试，因为 Visual Studio 是调试器。如果您只想构建它，您可以告诉 VS 从命令行重新构建解决方案，而无需启动 UI：有关详细信息，请参阅[MSDN](http://msdn.microsoft.com/en-us/library/aa292989(VS.71).aspx)。

您可以通过项目设置中的“中间文件”选项控制 DEBUG 和 RELEASE 目录的创建。尽管您需要在某处创建 obj 文件才能使编译工作。

# .net - 从 .NET 3.0 升级到 3.5：设置为 StateServer 的站点在 Web Garden 中恢复为 InProc

> ID：526697
> 
> 赞同：6
> 
> 时间：2009-02-08T23:50:17.023
> 
> 标签：.net, asp.net, session, state, state-server

设想：

以运行 .NET 3.0 的服务器和在启用了 Web 园的应用程序池中运行的 ASP.NET 网站为例（进程数：3）。web.config 配置如下：

```
    <会话状态
      cookieless="UseCookies"
      cookieName=".authz"
      模式="状态服务器"
      regenerateExpiredSessionId="true"
      stateConnectionString="tcpip=127.0.0.1:42424"
      超时=“60”
      useHostingIdentity="true" />

```

现在将机器升级到 .NET 3.5 SP1。重新启动服务器。结果：会话不再跨 w3wp.exe 实例维护，好像所有会话都已恢复到 InProc。当前的解决方法是减少到 1 个工作进程。

奇怪的是：不同服务器上的相同代码没有问题。我以前遇到过这个问题，但重启后它神奇地消失了。我已经重新启动了一次，但到目前为止没有任何乐趣。

比较两台服务器的两个 machine.configs 和 web.configs：完全相同。

[其他人遇到过这个问题](http://forums.iis.net/t/1153948.aspx)，但那里没有答案。

有任何想法吗？我*真的*被这个难住了。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-09T05:49:06.193

所以，这个简直太棒了。

当以下所有条件都为真时，就会出现该问题：

*   您正在运行 Windows Server 2003 (IIS 6.0) 和 ASP.NET 2.0 网站。
*   该网站配置为使用 Web Gardens，其中工作进程的最大数量大于 1。因此，您已将应用程序配置为使用进程外会话存储；在这种情况下，ASP.NET 状态服务在本地计算机上运行。
*   [应用程序池标识未设置为 NETWORK SERVICE，而是设置为您根据部署最佳实践](http://msdn.microsoft.com/en-us/library/ms998297.aspx)创建的自定义、低权限用户帐户。
*   您运行一个更新 .NET 框架的安装程序；就我而言，这是从 .NET 3.0 到 .NET 3.5 SP1 的更新。

当升级完成并重新启动服务器时，您会发现您的会话变量在刷新页面时经常丢失，因为只有三分之一的机会获得为您的原始请求提供服务的原始工作进程。但这无关紧要，因为您使用的是 ASP.NET 状态服务。什么破了？

使用 ASP.NET 状态服务时，ASP.NET 使用一个`machineKey`名为本次讨论）。这样一来，当任何工作进程使用会话标识符从服务请求数据时，可以确保数据在存储在外部数据源中时没有被篡改。

如果您在网络场中，那么您的文件中可能`machineKey`定义了一个静态`web.config`，并且不会发生此问题。但是对于单服务器网络花园方案，您可能依赖于默认`machineKey`设置，该设置是`AutoGenerate,IsolateApps`为 ASP.NET 2.0 应用程序设置的。这意味着 ASP.NET 会自动生成对您的应用程序池唯一的机器密钥。它根据某种算法重新生成此密钥，但这对于本次讨论并不重要。

生成的值通常存储在注册表中的`HKLM\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0\AutoGenKeys\{SID of the Application Pool Identity}`. 但是 .NET Framework 安装程序错误地（我确实认为这是一个错误）破坏了这个注册表项，并且为了雪上加霜，重置了这个键的权限，这样您的自定义应用程序池身份就无法写入注册表项。创建新的机器密钥。

结果是，在网络花园中启动的每个工作进程都在使用它自己的内存中机器密钥的副本，该机器密钥是它及时生成的，从而意外地有效地创建了一个网络农场场景。例如，工作进程 A 启动，发现不`AutoGenKey`存在任何条目（实际上，它甚至无法*读取*它），生成自己的并开始使用它来散列发送到 ASP.NET 状态服务的数据。它试图将这个新的机器密钥保存到注册表项，但静默失败。工作进程 B 启动，发现不`AutoGenKey`存在任何条目，生成自己的条目并开始使用*它*来散列数据……你知道这是怎么回事。

结果是现在您拥有使用三个不同机器密钥散列的会话数据。尽管会话标识符的数据存在，但三分之二的工作进程会因为它使用自己的密钥而将其拒绝为无效/被篡改。

您可以通过`machineKey`在`web.config`文件中明确设置自定义来解决此问题。

**或者您可以在命令提示符下重新运行`aspnet_regiis.exe -ga MachineName\ApplicationPoolUserName`以修复损坏的权限。**

你的问题解决了。是时候去睡觉了。

* * *

**6 月 30 日更新：**根据我在[Microsoft Connect](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=412881)上对此问题的报告，Microsoft 表示他们已经修复了安装程序，因此从升级到 .NET 4 开始不会发生这种行为。它仍然可能发生在所有未来的 3.0/3.5 升级中，所以我将保留这个问题/答案。

# wix - Windows 安装程序中的主要与次要升级

> ID：526707
> 
> 赞同：11
> 
> 时间：2009-02-08T23:56:00.427
> 
> 标签：wix, windows-installer

是否有任何理由不设置安装以便始终完成主要升级并更改产品代码？

我发现支持不同类型的安装需要更多的代码，并且“修复”安装似乎更容易通过重大升级进行。此外，需要安装的应用程序不是很大，因此不需要“服务包”或补丁安装程序。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-09T00:52:35.063

不会。如果您的应用程序很小，并且您不会感到卸载和安装的痛苦，那么主要升级是最容易做的事情。

如果主要升级用户体验不可接受，我只会转向更高级的更新机制。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-30T03:00:42.047

我通常发现较小的升级仅在少数情况下有用：

1：***卸载Bug***：安装的MSI的卸载顺序有Bug。由于次要升级不会卸载产品，而只是重新安装它。这允许您在调用之前修复卸载序列中的任何错误。

2：***修补程序***：非常大的产品需要进行非常小的调整。对单个文件或几个文件进行错误修复。对于只需要替换几个文件的所有大型产品，几周后通常会有一个小错误要求。重大升级可能会很糟糕 - 卸载并重新安装 10000 个文件中的 4 个？

3：打***补丁***：您想为您的产品部署补丁。MSI 确实允许主要升级补丁，但这些补丁比次要升级补丁更复杂（这也很困难）。

在我看来，“小更新”功能绝不应该用于任何目的。仅限主要或次要升级。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-01-08T08:38:17.480

更新类型 更改产品版本？更改产品 ID？

重大升级 是 是

小升级 是 否

小更新 否 否

# c# - 将自签名证书与 .NET 的 HttpWebRequest/Response 一起使用

> ID：526711
> 
> 赞同：84
> 
> 时间：2009-02-08T23:56:48.897
> 
> 标签：c#, ssl, httpwebrequest, ssl-certificate

我正在尝试连接到使用自签名 SSL 证书的 API。我这样做是使用 .NET 的 HttpWebRequest 和 HttpWebResponse 对象。我得到一个例外：

> 基础连接已关闭：无法为 SSL/TLS 安全通道建立信任关系。

我明白这意味着什么。而且我理解*为什么*.NET 觉得它应该警告我并关闭连接。但在这种情况下，无论如何我都想连接到 API，中间人攻击该死。

那么，我该如何为这个自签名证书添加一个例外呢？或者是告诉 HttpWebRequest/Response 根本不验证证书的方法？我该怎么做？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2009-02-09T00:07:28.293

事实证明，如果您只想完全禁用证书验证，您可以更改 ServicePointManager 上的 ServerCertificateValidationCallback，如下所示：

```
ServicePointManager.ServerCertificateValidationCallback = delegate { return true; }; 
```

这将验证所有证书（包括无效、过期或自签名证书）。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2009-02-09T00:51:07.690

@Domster：可行，但是您可能希望通过检查证书哈希是否与您期望的相符来加强一些安全性。所以扩展版本看起来有点像这样（基于我们正在使用的一些实时代码）：

```
static readonly byte[] apiCertHash = { 0xZZ, 0xYY, ....};

/// <summary>
/// Somewhere in your application's startup/init sequence...
/// </summary>
void InitPhase()
{
    // Override automatic validation of SSL server certificates.
    ServicePointManager.ServerCertificateValidationCallback =
           ValidateServerCertficate;
}

/// <summary>
/// Validates the SSL server certificate.
/// </summary>
/// <param name="sender">An object that contains state information for this
/// validation.</param>
/// <param name="cert">The certificate used to authenticate the remote party.</param>
/// <param name="chain">The chain of certificate authorities associated with the
/// remote certificate.</param>
/// <param name="sslPolicyErrors">One or more errors associated with the remote
/// certificate.</param>
/// <returns>Returns a boolean value that determines whether the specified
/// certificate is accepted for authentication; true to accept or false to
/// reject.</returns>
private static bool ValidateServerCertficate(
        object sender,
        X509Certificate cert,
        X509Chain chain,
        SslPolicyErrors sslPolicyErrors)
{
    if (sslPolicyErrors == SslPolicyErrors.None)
    {
        // Good certificate.
        return true;
    }

    log.DebugFormat("SSL certificate error: {0}", sslPolicyErrors);

    bool certMatch = false; // Assume failure
    byte[] certHash = cert.GetCertHash();
    if (certHash.Length == apiCertHash.Length)
    {
        certMatch = true; // Now assume success.
        for (int idx = 0; idx < certHash.Length; idx++)
        {
            if (certHash[idx] != apiCertHash[idx])
            {
                certMatch = false; // No match
                break;
            }
        }
    }

    // Return true => allow unauthenticated server,
    //        false => disallow unauthenticated server.
    return certMatch;
} 
```

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2013-02-27T20:35:47.057

请注意，在 .NET 4.5 中，您可以覆盖每个 HttpWebRequest 本身的 SSL 验证（而不是通过影响所有请求的全局委托）：

[http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.servercertificatevalidationcallback.aspx](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.servercertificatevalidationcallback.aspx)

```
HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(uri);
request.ServerCertificateValidationCallback = delegate { return true; }; 
```

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2009-03-08T04:08:47.157

将自签名证书添加到本地计算机受信任的根证书颁发机构

您可以通过以管理员身份运行 MMC 来导入证书。

[如何：使用 MMC 管理单元查看证书](http://msdn.microsoft.com/en-us/library/ms788967.aspx)

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2012-08-15T07:59:16.323

[Domster 的答案](https://stackoverflow.com/a/526730/8799)中使用的验证回调的范围可以限制为使用`ServerCertificateValidationCallback`委托上的 sender 参数的特定请求。下面的简单作用域类使用这种技术来临时连接一个仅对给定请求对象执行的验证回调。

```
public class ServerCertificateValidationScope : IDisposable
{
    private readonly RemoteCertificateValidationCallback _callback;

    public ServerCertificateValidationScope(object request,
        RemoteCertificateValidationCallback callback)
    {
        var previous = ServicePointManager.ServerCertificateValidationCallback;
        _callback = (sender, certificate, chain, errors) =>
            {
                if (sender == request)
                {
                    return callback(sender, certificate, chain, errors);
                }
                if (previous != null)
                {
                    return previous(sender, certificate, chain, errors);
                }
                return errors == SslPolicyErrors.None;
            };
        ServicePointManager.ServerCertificateValidationCallback += _callback;
    }

    public void Dispose()
    {
        ServicePointManager.ServerCertificateValidationCallback -= _callback;
    }
} 
```

上述类可用于忽略特定请求的所有证书错误，如下所示：

```
var request = WebRequest.Create(uri);
using (new ServerCertificateValidationScope(request, delegate { return true; }))
{
    request.GetResponse();
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-12-14T18:12:04.217

只是建立在[devstuff](https://stackoverflow.com/users/41321/devstuff)的答案上，包括主题和发行者......欢迎评论......

```
public class SelfSignedCertificateValidator
{
    private class CertificateAttributes
    {
        public string Subject { get; private set; }
        public string Issuer { get; private set; }
        public string Thumbprint { get; private set; }

        public CertificateAttributes(string subject, string issuer, string thumbprint)
        {
            Subject = subject;
            Issuer = issuer;                
            Thumbprint = thumbprint.Trim(
                new char[] { '\u200e', '\u200f' } // strip any lrt and rlt markers from copy/paste
                ); 
        }

        public bool IsMatch(X509Certificate cert)
        {
            bool subjectMatches = Subject.Replace(" ", "").Equals(cert.Subject.Replace(" ", ""), StringComparison.InvariantCulture);
            bool issuerMatches = Issuer.Replace(" ", "").Equals(cert.Issuer.Replace(" ", ""), StringComparison.InvariantCulture);
            bool thumbprintMatches = Thumbprint == String.Join(" ", cert.GetCertHash().Select(h => h.ToString("x2")));
            return subjectMatches && issuerMatches && thumbprintMatches; 
        }
    }

    private readonly List<CertificateAttributes> __knownSelfSignedCertificates = new List<CertificateAttributes> {
        new CertificateAttributes(  // can paste values from "view cert" dialog
            "CN = subject.company.int", 
            "CN = issuer.company.int", 
            "f6 23 16 3d 5a d8 e5 1e 13 58 85 0a 34 9f d6 d3 c8 23 a8 f4") 
    };       

    private static bool __createdSingleton = false;

    public SelfSignedCertificateValidator()
    {
        lock (this)
        {
            if (__createdSingleton)
                throw new Exception("Only a single instance can be instanciated.");

            // Hook in validation of SSL server certificates.  
            ServicePointManager.ServerCertificateValidationCallback += ValidateServerCertficate;

            __createdSingleton = true;
        }
    }

    /// <summary>
    /// Validates the SSL server certificate.
    /// </summary>
    /// <param name="sender">An object that contains state information for this
    /// validation.</param>
    /// <param name="cert">The certificate used to authenticate the remote party.</param>
    /// <param name="chain">The chain of certificate authorities associated with the
    /// remote certificate.</param>
    /// <param name="sslPolicyErrors">One or more errors associated with the remote
    /// certificate.</param>
    /// <returns>Returns a boolean value that determines whether the specified
    /// certificate is accepted for authentication; true to accept or false to
    /// reject.</returns>
    private bool ValidateServerCertficate(
        object sender,
        X509Certificate cert,
        X509Chain chain,
        SslPolicyErrors sslPolicyErrors)
    {
        if (sslPolicyErrors == SslPolicyErrors.None)
            return true;   // Good certificate.

        Dbg.WriteLine("SSL certificate error: {0}", sslPolicyErrors);
        return __knownSelfSignedCertificates.Any(c => c.IsMatch(cert));            
    }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-09-03T04:45:04.263

为其他人添加可能的帮助...如果您希望它提示用户安装自签名证书，您可以使用此代码（从上面修改）。

不需要管理员权限，安装到本地用户受信任的配置文件：

```
 private static bool ValidateServerCertficate(
        object sender,
        X509Certificate cert,
        X509Chain chain,
        SslPolicyErrors sslPolicyErrors)
    {
        if (sslPolicyErrors == SslPolicyErrors.None)
        {
            // Good certificate.
            return true;
        }

        Common.Helpers.Logger.Log.Error(string.Format("SSL certificate error: {0}", sslPolicyErrors));
        try
        {
            using (X509Store store = new X509Store(StoreName.My, StoreLocation.CurrentUser))
            {
                store.Open(OpenFlags.ReadWrite);
                store.Add(new X509Certificate2(cert));
                store.Close();
            }
            return true;
        }
        catch (Exception ex)
        {
            Common.Helpers.Logger.Log.Error(string.Format("SSL certificate add Error: {0}", ex.Message));
        }

        return false;
    } 
```

这似乎适用于我们的应用程序，如果用户按下否，通信将无法进行。

**更新：2015-12-11** - 将 StoreName.Root 更改为 StoreName.My - 我将安装到本地用户存储中，而不是 Root。即使您“以管理员身份运行”，某些系统上的 root 也无法工作

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-11-06T12:31:11.513

要记住的一件事是，拥有 ServicePointManager.ServerCertificateValidationCallback 似乎并不意味着没有完成 CRL 检查和服务器名称验证，它只是提供了一种覆盖其结果的方法。因此，您的服务可能仍需要一段时间才能获得 CRL，之后您才会知道它未通过某些检查。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-08-15T18:01:49.563

我遇到了与 OP 相同的问题，其中 Web 请求会引发确切的异常。我认为所有设置都正确，证书已安装，我可以很好地在机器存储中找到它并将其附加到 Web 请求中，并且我在请求上下文中禁用了证书验证。

原来我是在我的用户帐户下运行的，并且证书已安装到机器商店。这导致 Web 请求抛出此异常。为了解决这个问题，我要么以管理员身份运行，要么将证书安装到用户存储并从那里读取。

似乎 C# 能够在机器存储中找到证书，即使它不能与 Web 请求一起使用，这会导致一旦发出 Web 请求就会引发 OP 的异常。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-04-10T12:52:15.910

首先 - 我很抱歉，因为我使用了@devstuff 描述的解决方案。但是，我已经找到了一些改进它的方法。

*   **添加自签名证书处理**
*   证书原始数据对比
*   实际的**证书颁发机构验证**
*   一些额外的评论和改进

这是我的修改：

```
private static X509Certificate2 caCertificate2 = null;

/// <summary>
/// Validates the SSL server certificate.
/// </summary>
/// <param name="sender">An object that contains state information for this validation.</param>
/// <param name="cert">The certificate used to authenticate the remote party.</param>
/// <param name="chain">The chain of certificate authorities associated with the remote certificate.</param>
/// <param name="sslPolicyErrors">One or more errors associated with the remote certificate.</param>
/// <returns>Returns a boolean value that determines whether the specified certificate is accepted for authentication; true to accept or false to reject.</returns>
private static bool ValidateServerCertficate(
        object sender,
        X509Certificate cert,
        X509Chain chain,
        SslPolicyErrors sslPolicyErrors)
{
    if (sslPolicyErrors == SslPolicyErrors.None)
    {
        // Good certificate.
        return true;
    }

    // If the following line is not added, then for the self-signed cert an error will be (not tested with let's encrypt!):
    // "A certificate chain processed, but terminated in a root certificate which is not trusted by the trust provider. (UntrustedRoot)"
    chain.ChainPolicy.VerificationFlags = X509VerificationFlags.AllowUnknownCertificateAuthority;

    // convert old-style cert to new-style cert
    var returnedServerCert2 = new X509Certificate2(cert);

    // This part is very important. Adding known root here. It doesn't have to be in the computer store at all. Neither do certificates.
    chain.ChainPolicy.ExtraStore.Add(caCertificate2);

    // 1\. Checks if ff the certs are OK (not expired/revoked/etc) 
    // 2\. X509VerificationFlags.AllowUnknownCertificateAuthority will make sure that untrusted certs are OK
    // 3\. IMPORTANT: here, if the chain contains the wrong CA - the validation will fail, as the chain is wrong!
    bool isChainValid = chain.Build(returnedServerCert2);
    if (!isChainValid)
    {
        string[] errors = chain.ChainStatus
            .Select(x => String.Format("{0} ({1})", x.StatusInformation.Trim(), x.Status))
            .ToArray();

        string certificateErrorsString = "Unknown errors.";

        if (errors != null && errors.Length > 0)
        {
            certificateErrorsString = String.Join(", ", errors);
        }

        Log.Error("Trust chain did not complete to the known authority anchor. Errors: " + certificateErrorsString);
        return false;
    }

    // This piece makes sure it actually matches your known root
    bool isValid = chain.ChainElements
        .Cast<X509ChainElement>()
        .Any(x => x.Certificate.RawData.SequenceEqual(caCertificate2.GetRawCertData()));

    if (!isValid)
    {
        Log.Error("Trust chain did not complete to the known authority anchor. Thumbprints did not match.");
    }

    return isValid;
} 
```

设置证书：

```
caCertificate2 = new X509Certificate2("auth/ca.crt", "");
var clientCertificate2 = new X509Certificate2("auth/client.pfx", ""); 
```

传递委托方法

```
ServerCertificateValidationCallback(ValidateServerCertficate) 
```

`client.pfx`使用 KEY 和 CERT 生成，如下所示：

```
openssl pkcs12 -export -in client.crt -inkey client.key -out client.pfx 
```

# c# - 不一致错误 C#

> ID：526713
> 
> 赞同：1
> 
> 时间：2009-02-08T23:57:46.180
> 
> 标签：c#

我有一个问题，`protected SceneItem scene = null;`但我不明白为什么，错误是：

> 可访问性不一致：字段类型“AsteroidsFinal.Helpers.SceneItem”比字段“AsteroidsFinal.Helpers.Screen.scene”更难访问

```
using System;
using System.Collections.Generic;
using System.Text;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Graphics;

namespace AsteroidsFinal.Helpers
{

abstract public class Screen
{
    #region Variables

    protected SceneItem scene = null;

    protected Screen overlay;

    protected SpriteBatch batch = null;

    protected Game game = null;

    #endregion

    #region Properties

    public Game GameInstance
    {
        get { return game; }
    }

    public SpriteBatch Sprites
    {
        get { return batch; }
    }    

    #endregion

    public Screen(AsteroidGame game)
    {
        this.game = game;

        if (game != null)
        {
            IGraphicsDeviceService graphicsService = (IGraphicsDeviceService)game.Services.GetService(typeof(IGraphicsDeviceService));
            this.batch = new SpriteBatch(graphicsService.GraphicsDevice);
        }
    }

    public virtual GameState Update(TimeSpan time, TimeSpan elapsedTime)
    {
        scene.Update(time, elapsedTime);

        return (overlay == null) ? GameState.None : overlay.Update(time, elapsedTime);
    }

    public virtual void Render()
    {
        scene.Render();

        if (overlay != null)
            overlay.Render();
    }

    public virtual void Shutdown()
    {
        if (overlay != null)
            overlay.Shutdown();

        if (batch != null)
        {
            batch.Dispose();
            batch = null;
        }
    }

    public virtual void OnCreateDevice()
    {
        IGraphicsDeviceService graphicsService = (IGraphicsDeviceService)game.Services.GetService(typeof(IGraphicsDeviceService));
        batch = new SpriteBatch(graphicsService.GraphicsDevice);
    }
}

} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-09T00:01:55.607

屏幕是一个公共类。因为它是一个公共类，所以您可以从它内部创建派生类型，在 Screen 所在的程序集中，或在外部，在 Screen 所在的程序集中。

“场景”是受保护的，这意味着，它可以从派生自它所在的类的任何类访问，在本例中是 Screen，但是，您还没有声明 SceneItem，它是“场景”的类型公开。如果开发人员从 Screen 派生，但从程序集外部进行，那么他将无法访问 SceneItem 的类型，因为 SceneItem 很可能是内部的。

要解决此问题，您需要将 Screen 上的可访问性修饰符限制为内部，或者您需要将 SceneItem 上的可访问性修饰符修改为公开。

# runtime - 二叉搜索树的搜索时间

> ID：526718
> 
> 赞同：18
> 
> 时间：2009-02-08T23:59:58.793
> 
> 标签：runtime, binary-tree, analysis

有谁知道如何计算二叉搜索树的搜索时间（即最坏情况、最佳情况和平均情况）？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-09T00:03:29.893

对于非自平衡树（对于搜索树可能但不常见），最坏的情况是 O(n)，这是退化二叉树（链表）的情况。

在这种情况下，您必须平均搜索一半的列表才能找到所需的元素。

对于完美平衡的树，最佳情况是 O(log [2] n)，因为您将每个树级别的搜索空间减半。

平均情况介于这两者之间，完全取决于数据:-)

由于您很少能够控制数据插入树的顺序，因此自平衡树通常更可取，因为虽然它们为每次插入或删除增加了少量时间，但它们大大加快了搜索速度。他们最坏的情况比不平衡的树好得多。

```
 8
         _______/ \_______
        /                 \
       4                  12
    __/ \__             __/ \__
   /       \           /       \
  2         6        10        14
 / \       / \       / \       / \
1   3     5   7     9  11    13  15 
```

在这棵完美平衡的树中，您可以看到每个级别都有 2 ^(n -1 个节点。)`n`这意味着对于 15 个节点，您无需搜索超过四个节点即可找到它（例如，要查找、`13`您搜索`8`、`12`和）。这就是 log [2] n 数字的来源。`14``13`

如前所述，退化的不平衡树是一个链表。如果您的数据按顺序到达并将其插入到不平衡的二叉树中，您将得到：

```
1 -> 2 -> 3 -> 4 -> 5 -> 6 -> 7 -> 8 -> 9 -+
                                           |
+------------------------------------------+
|
+-> 10 -> 11 -> 12 -> 13 -> 14 -> 15 
```

要`13`在这种情况下找到，您需要搜索`1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, `10`, `11`,`12`和`13`，因此 O(n)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-09T00:04:56.897

可能想将此标记为“作业”。这是一个很好的起点：[http ://en.wikipedia.org/wiki/Binary_search_tree](http://en.wikipedia.org/wiki/Binary_search_tree)

一般来说，*平衡*二叉搜索树的最坏情况查找为 O(log n)，最佳情况为 O(1)（当所需值是根时）和平均情况为 O(log n)（叶子包含比其父级更多的值）。

最坏的情况是最有趣的，并且很容易通过识别二叉树的第一级有 1 个节点，第二级有 2 个，第三级有 4 个等来看出。*因此，深度为n*的二叉树中的节点数正好是*2^n - 1*。指数函数的数学逆是对数，因此：*O(log n)*。

不平衡的树可能与链表一样糟糕，并且可能具有如下形状：

```
 1
 / \
    2
   / \
      3
     / \
        4
       / \ 
```

在这种情况下，最坏情况的访问时间是*O(n)*。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-07-05T14:12:09.183

最好的情况是 O(1)。第一个元素可能是您要查找的项目。最坏的情况是 O(n)，即在一棵倾斜的树中，平均情况是 O(lg n)。

# big-o - 嵌套for循环的时间复杂度

> ID：526728
> 
> 赞同：55
> 
> 时间：2009-02-09T00:05:05.677
> 
> 标签：big-o, complexity-theory, time-complexity

我需要计算以下代码的时间复杂度：

```
for (i = 1; i <= n; i++)
{
  for(j = 1; j <= i; j++)
  {
   // Some code
  }
} 
```

是*O(n^2)*吗？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-02-09T00:20:41.287

是的，嵌套循环是快速获得大 O 符号的一种方法。

通常（但不总是）一个循环嵌套在另一个循环中会导致 O(n²)。

想想看，*对于 i 的每个值，*内部循环都会执行 i 次。外循环执行 n 次。

因此你会看到这样的执行模式：1 + 2 + 3 + 4 + ... + n 次

因此，我们可以通过说它显然执行超过 n 次（下限）来限制代码执行的次数，但是就 n 而言，我们执行代码的次数是多少？

好吧，从数学上讲，我们可以说它执行不超过 n² 次，这给了我们最坏的情况，因此我们的 O(n²) 的 Big-Oh 界限。（有关我们如何在数学上这样说的更多信息，请查看[Power Series](http://math2.org/math/expansion/power.htm)）

Big-Oh 并不总是准确衡量正在完成的工作量，但通常会给出最坏情况的可靠近似值。

* * *

**4 年后编辑：**因为这篇文章似乎获得了相当多的流量。我想更全面地解释我们如何使用幂级数将执行绑定到 O(n²)

来自网站：1+2+3+4...+n = (n² + n)/2 = n²/2 + n/2。那么我们如何将其变成 O(n²)？我们（基本上）要说的是 n² >= n²/2 + n/2。这是真的？让我们做一些简单的代数。

*   两边都乘以 2 得到： 2n² >= n² + n?
*   展开 2n² 得到：n² + n² >= n² + n?
*   两边减去 n² 得到： n² >= n?

应该清楚 n² >= n （不严格大于，因为 n=0 或 1 的情况），假设 n 始终是整数。

实际的 Big O 复杂度与我刚才所说的略有不同，但这就是它的要点。实际上，Big O 复杂性询问是否有一个常数我们可以应用于一个函数，使其大于另一个函数，以获得足够大的输入（参见[维基百科](http://en.wikipedia.org/wiki/Big_O_notation)页面）

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2014-11-08T00:09:17.753

解释这一点的一种快速方法是将其可视化。

如果 i 和 j 都是从 0 到 N，那么很容易看到 O(N^2)

```
O O O O O O O O
O O O O O O O O
O O O O O O O O
O O O O O O O O
O O O O O O O O
O O O O O O O O
O O O O O O O O
O O O O O O O O 
```

在这种情况下，它是：

```
O
O O
O O O
O O O O
O O O O O
O O O O O O
O O O O O O O
O O O O O O O O 
```

结果是 N^2 的 1/2，仍然是 O(N^2)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-09T00:08:46.963

实际上，它是 O(n^2)。另请参见[此处](https://stackoverflow.com/questions/428068/what-is-the-worst-case-time-complexity-for-this-algorithm)具有相同运行时的非常相似的示例。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-04-16T21:03:06.403

在外循环的第 1 次迭代（i = 1），内循环将迭代 1 次 在外循环的第 2 次迭代（i = 2），内循环将迭代 2 次 在外循环的第 3 次迭代(i = 3)，内部循环将迭代 3 次
。
.
在外循环的最终迭代（i = n）中，内循环将迭代 n 次

因此，内部循环中的语句将被执行的总次数将等于从 1 到 n 的整数之和，即：

```
((n)*n) / 2 = (n^2)/2 = O(n^2) times 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2022-02-16T17:26:20.353

让我们跟踪每个循环在每次迭代中执行的次数。

```
for (int i = 1; i <= n; i++){  // outer loop
    for (int j = 1; j <= i; j++){  // inner loop
        // some code
    }
} 
```

在外循环的第一次迭代（i = 1）中，内循环执行`once`。

在外循环的第二次迭代（i = 2）中，内循环执行`twice`。

在外循环的第三次迭代（i = 3）中，内循环执行`thrice`。

因此，在外循环的最后一次迭代（i = n）中，内循环执行`n times`。

因此，这段代码执行的总次数是

`1 + 2 + 3 + … + n`

`= (n(n + 1) / 2)` （自然数之和公式）

`= (((n^2) + n) / 2)`

`= O(n^2)`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-10-26T08:03:29.487

是的，它的时间复杂度是 O(n^2)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-03-13T16:33:34.830

我认为考虑它的最简单方法是这样的：

外循环运行 n 次，并且对于这些迭代中的*至少*n/2 次，内循环*至少运行 n/2*次。因此内循环迭代的总数至少为n ² /4。那是 O(n ² )

同样，外循环运行n次，每次迭代，内循环最多运行n次。因此，内循环迭代的总数最多为 n ²。这也在 O(n ² ) 中。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2021-09-13T09:12:07.587

内循环取决于外循环，内循环运行 I 次，这给了我

for n = 5 if i = 1 内部循环运行 1 次 1 = 1

if i = 2 内部循环运行 2 次 1 + 2 = 3

if i = 3 内部循环运行 3 次 1 + 2 + 3 = 6

if i = 4 内部循环运行 4 次 1 + 2 + 3 + 4 = 10

if i = 5 内部循环运行 5 次 1 + 2 + 3 + 4 + 5 = 15

从上面我们可以知道 n (n + 1) / 2

所以 O(n *(n+1))/2 = O(n2/2 + n/2) = O(n2/2) + O(n/2)

我不擅长算法分析，所以请随时纠正我的答案。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2014-04-29T10:20:19.493

首先，我们将考虑内部循环的迭代次数与外部循环索引的值无关的循环。例如：

```
 for (i = 0; i < N; i++) {
     for (j = 0; j < M; j++) {
         sequence of statements
      }
  } 
```

外循环执行 N 次。每次外循环执行，内循环执行M次。结果，内循环中的语句总共执行了 N * M 次。因此，两个循环的总复杂度为 O(N2)。

# maven-2 - Maven 插件执行另一个插件

> ID：526733
> 
> 赞同：26
> 
> 时间：2009-02-09T00:09:14.297
> 
> 标签：maven-2, plugins

我正在尝试创建一个新插件来打包我的最新项目。我试图让这个插件依赖于 maven-dependency-plugin 来复制我所有的项目依赖项。

我已将此依赖项添加到插件的 pom 中，但无法执行。

我的插件主 Mojo 中有这个注释：

```
@execute goal="org.apache.maven.plugins:maven-dependency-plugin:copy" 
```

我已经为目标尝试了其他一些名称，例如*dependency:copy*和 just *copy*，但它们都以一条消息结尾，指出在我的插件中找不到所需的目标。我究竟做错了什么？

其次是我在哪里为依赖插件提供配置信息？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-14T21:30:32.310

使用Atlassian 的 Don Brown的[Maven Mojo 执行器来运行任何其他任意插件。](https://github.com/TimMoore/mojo-executor)

> Mojo Executor 提供了一种在 Maven 2 插件中执行其他 Mojo（插件）的方法，允许您轻松创建由其他插件组成的 Maven 2 插件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-12T10:18:46.167

您是否尝试过创建自己的包装类型？然后您可以定义自己的生命周期映射，即将目标绑定到阶段。在这种情况下，您可以将 dependency:copy-dependencies 目标绑定到您的打包阶段，而不必将目标包装到您自己的 Mojo 中。

另请参阅：[如何为 Maven 创建新的打包类型？](https://stackoverflow.com/questions/1427722/how-do-i-create-a-new-packaging-type-for-maven)

# python - subprocess.Popen 错误

> ID：526734
> 
> 赞同：4
> 
> 时间：2009-02-09T00:10:49.143
> 
> 标签：python, subprocess, popen

我正在以静默模式运行 msi 安装程序并在特定文件中缓存日志。以下是我需要执行的命令。

`C:\Program Files\ My Installer\Setup.exe /s /v "/qn /lv %TEMP%\log_silent.log"`

我用了：

```
subprocess.Popen(['C:\Program Files\ My Installer\Setup.exe', '/s /v "/qn /lv %TEMP%\log_silent.log"'],stdout=subprocess.PIPE).communicate()[0] 
```

执行该命令，但它无法识别该操作并给出有关选择错误选项的错误。我已经交叉验证并发现该命令只能以这种方式工作。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-09T00:40:21.757

问题非常微妙。

您正在直接执行程序。它得到：

```
argv[0] = "C:\Program Files\ My Installer\Setup.exe"
argv[1] = /s /v "/qn /lv %TEMP%\log_silent.log" 
```

而它应该是：

```
argv[1] = "/s"
argv[2] = "/v"
argv[3] = "/qn"
argv[4] = "/lv %TEMP%\log_silent.log" 
```

换句话说，它应该接收 5 个参数，而不是 2 个参数。

还有，`%TEMP%`程序直接不知道！

有 2 种方法可以解决此问题：

1.  **调用外壳。**

    ```
    p = subprocess.Popen('C:\Program Files\ My Installer\Setup.exe /s /v "/qn /lv %TEMP%\log_silent.log"', shell=True)
    output = p.communicate()[0] 
    ```

2.  **直接调用程序（更安全）**

    ```
    s = ['C:\Program Files\ My Installer\Setup.exe', '/s /v "/qn /lv %TEMP%\log_silent.log"']
    safes = [os.path.expandvars(p) for p in argument_string]
    p = subprocess.Popen(safes[0], safes[1:])
    output = p.communicate()[0] 
    ```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T00:35:39.270

问题是您有效地只为 Setup.exe 提供了一个参数。不要从 shell 的角度来思考，你作为参数传递的字符串不会再被空格分割，这是你的职责！

因此，如果您绝对确定“/qn /lv %TEMP%\log_silent.log”应该是一个参数，那么使用这个：

```
subprocess.Popen(['C:\Program Files\ My Installer\Setup.exe', '/s', '/v', '/qn /lv %TEMP%\log_silent.log'],stdout=subprocess.PIPE).communicate()[0] 
```

否则（我猜这个是正确的），使用这个：

```
subprocess.Popen(['C:\Program Files\ My Installer\Setup.exe', '/s', '/v', '/qn', '/lv', '%TEMP%\log_silent.log'],stdout=subprocess.PIPE).communicate()[0] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T00:38:00.217

尝试将每个参数放在自己的字符串中（重新格式化以提高可读性）：

```
cmd = ['C:\Program Files\ My Installer\Setup.exe',
       '/s',
       '/v',
       '"/qn',
       '/lv',
       '%TEMP%\log_silent.log"']

subprocess.Popen(cmd, stdout=subprocess.PIPE).communicate()[0] 
```

我不得不说，那些双引号对我来说看起来不正确。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T01:03:07.550

你说：

```
subprocess.Popen(['C:\Program Files\ My Installer\Setup.exe', '/s /v "/qn /lv %TEMP%\log_silent.log"'],stdout=subprocess.PIPE).communicate()[0] 
```

目录名称真的是“我的安装程序”（带有前导空格）吗？

此外，作为一般规则，您应该在路径规范中使用正斜杠。Python 应该无缝地处理它们（即使在 Windows 上），并且避免 Python 将反斜杠解释为转义字符的任何问题。

（例如：

```
>>> s = 'c:\program files\norton antivirus'
>>> print s
c:\program files
orton antivirus 
```

)

# naming-conventions - 有没有最好的方法来处理命名时尚？

> ID：526736
> 
> 赞同：3
> 
> 时间：2009-02-09T00:13:05.520
> 
> 标签：naming-conventions, fad

在去年和我团队代码库的一些工作中，我注意到命名约定的稳步发展。

例如，有很多类被命名来表示它们是一个可以帮助你做某事的类。

这是我发现的：

```
MyClassUtil
MyClassFactory
MyClassHelper
MyClassManager
MyClassService 
```

在我看来，随着时间的推移，人们会为相对相同的事物提出命名约定，因此不是以一致的方式命名所有内容，而是最终得到一个包含一些约定的代码库。所有的新东西都是根据最新的时尚命名约定命名的，所以你几乎可以通过当时流行的约定来判断一段代码的时代。

处理这种趋势的最佳方法是什么？真的有问题吗？随着这些命名时尚的流行，人们应该使用最新的时尚吗？是否应该使用新的命名约定重命名所有现有项目？还是应该接受这种多样性是不可避免的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-09T00:43:19.313

它们看起来不像是时尚……所有这些名字都暗示了课程的目的，而这些目的是不同的。对于编程，一切都在名称中，应该非常谨慎地选择它们。品种不需要逃避。名称不同，因为类的目的不同。

**MyClassUtil - 一些** 与 MyClass 一起工作的实用程序，它没有附带。也许 MyClass 属于您正在使用的库，但您经常使用一些更高级别的函数，您需要在某个地方放置它们。

**MyClassFactory** - 以抽象的方式创建 MyClass 的实例。这允许您编写需要 MyClass 实例的代码。它可以从 MyClassFactory 中获取这些新实例。这将允许工厂在未来进行修改以提供 MyClass 的不同特定实现。也许在单元测试下，工厂只是提供虚拟/模拟 MyClasses。这意味着可以测试使用工厂的类而无需更改它，只需更改工厂，然后您就可以隔离正在测试的类。

**MyClassHelper -好吧** ，我可能同意，也许这可以更具体。它对 MyClass 有帮助，但又是什么。也许这有点类似于 MyClassUtil。但是，MyClassUtil 可能是与 MyClass 一起使用的通用函数，而帮助程序使用 MyClass 的特定实例进行初始化，然后可以对该实例执行操作。你需要为每个你想帮助的 MyClass 提供一个新的助手。

**MyClassManager -** 也许这处理 MyClass 实例池并存储或编排它们。例如。在 CommunicationsManager 中，该类将处理连接在一起的类，这些类处理与以太网或串行等端口或连接的通信，以及一个处理通过它发送的通信协议以便它可以传输数据包的类，以及一个处理这些数据包中的消息。

**MyClassService** -A 服务可以为您做事，例如给定邮政编码将其转换为网格参考。通常一个服务可以解决很多具体的事情。对于邮政编码示例，此类可能具有可以与不同网站对话以进行转换的实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-09T00:18:27.440

您在上面给出的所有类的名称都向我表明与面向对象原则的惊人背离。无法说明“MyClassUtil”或“MyClassService”的作用。它可以是任何东西。类命名应该是具体的，并且应该清楚地传达类的实际功能。这些都没有。处理这种倾向的最好方法是复习面向对象的编程技能并相应地命名类。

现在，可能是这些示例在应用程序架构中指出了这些类所代表的功能，而您对“MyClass”的使用只是在运行时更明确的占位符，在这种情况下，我不会查看这些作为命名时尚，而是作为类本身功能的描述性指标，带有应用程序底层架构的松散暗示。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-09T01:11:42.617

如果这很普遍，那么团队需要花一些时间研究 OO 设计：阅读备受推崇的 OO 框架的源代码、有关设计模式的书籍或 Evans “领域驱动设计”等书籍。

“Util”和“Manager”通常是糟糕设计的症状——“代码味道”。在它根深蒂固的特殊上下文（Rails 应用程序）之外的“助手”也是如此。

“工厂”和“服务”具有精确的技术含义，您可以检查代码是否符合这些设计模式。

一般的补救措施是与团队坐下来，明确讨论您期望从这些命名方案中获得什么好处，什么有意义，什么没有，然后在接下来的几个月内应用重构技术逐步淘汰你们都决定的名字是代码气味。

命名很重要。不能掉以轻心，也不是主观的事情。诚然，对于给定的命名问题，通常有不止一个正确答案。但是，很少有很多答案*与之前的选择一致*，这是关键。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-09T01:26:26.887

建议将名称重命名为更好的名称并重构代码，以便每个类都有明确的[职责](http://www.objectmentor.com/resources/articles/srp.pdf)。要了解使用哪种名称，请阅读 Tim Ottinger 关于[有意义名称](http://tottinge.blogsome.com/meaningfulnames/)的文章。

当一个类只做一件事时，给它起一个描述性的名字通常很容易。诸如“经理”之类的词含糊不清，可能表明该类负责执行许多不相关的事情，没有简单的名称能够描述该类的作用。如果只看类名就可以知道类做了什么，那么这个类就有了好名字。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-09T00:19:48.980

我真的不明白工厂或服务如何适应特定的时尚......

工厂是一种设计模式，如果类真的是工厂，那么它是一个非常合适的名称。

如果一个类是 Windows 服务，那么将其称为服务有什么问题？

除非您发现执行所有重命名重构的成本太高，即使您确实想要执行它们，否则没有问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-09T03:10:19.943

为什么不使用静态分析工具来帮助执行一组样式和一致性规则？

如果您在 .NET 世界中，Microsoft 提供了一个名为[StyleCop的工具](http://code.msdn.microsoft.com/sourceanalysis)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-09T15:38:16.777

In the classname examples you give does "MyClass" stand for an actual class name, so that you are really seeing names like "PersonnelRecordUtil" or "GraphNodeFactory"? MyClassFactory is a really bad actual name for a class.

# linux - 如何在 Ubuntu 中创建公共 HTML 文件夹？

> ID：526742
> 
> 赞同：28
> 
> 时间：2009-02-09T00:17:26.880
> 
> 标签：linux, public-html

简单的问题，但由于某种原因，我在谷歌上找不到确切的答案：

我在 Slicehost 上安装了一个全新的 Ubuntu，并想在我的主目录中为一个包含一堆静态 HTML 文件的简单网站创建一个公共目录。我该怎么做呢？只是键入`mkdir public_html`和设置权限的问题，还是有更清洁的方法？（我记得过去我遇到过问题，每次我将文件复制到我的 public_html 目录中时，我都必须手动设置其权限，这非常令人沮丧。）

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-09T00:38:50.667

假设您已经安装了 apache，请执行以下操作：

```
sudo a2enmod userdir
sudo service apache2 reload 
```

第一个命令启用 userdir apache mod，这正是您想要的。第二个重新加载 apache 配置，以便它开始使用新配置。

安装 apache2：

```
sudo apt-get install apache2 
```

当然，您还需要确保您的 public_html 文件夹的权限允许 www-data 用户查看其中的文件——755 通常运行良好。去做这个：

```
mkdir ~/public_html
chmod -R 755 ~/public_html 
```

这将递归 (-R) 遍历您的 public_html 并将权限设置为 755（所有者 rwx，以及组和其他 rx，rx）。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-09T00:44:10.937

其他答案与. `mod_userdir`_ 例如，如果您希望您的文件可以在域根目录下访问，那么您需要放置指令`http://www.yourdomain.com/~username/``/home/username/public_html/index.html``http://www.yourdomain.com/~username/index.html``http://www.yourdomain.com/index.html`

```
DocumentRoot /home/username/public_html 
```

在 Apache 配置文件中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T00:27:57.650

您需要为 Apache 使用[mod_userdir](http://httpd.apache.org/docs/1.3/mod/mod_userdir.html)`/var/www/` ，否则您需要从或任何地方设置符号链接。

您的权限问题是因为 Apache 没有对您的文件的读取权限。您需要允许读取访问权限`www-data`（或任何用户；特定于发行版）。

# java - 当精灵“从屏幕上掉下来”时，如何在 Java 游戏中调用 gameOver 方法？

> ID：526743
> 
> 赞同：2
> 
> 时间：2009-02-09T00:17:57.630
> 
> 标签：java, methods, screen

我正在使用 BlueJ 用 Ja​​va 开发一个简单的平台游戏。

在接下来的几周内，我将发布一些问题，寻求这个项目的帮助，因为我对编程不是很精通。所以我希望我不会变得烦人，如果你能帮助我，我将非常感激。

在我的游戏中，我有一个 gameOver 方法，它结束游戏并向控制台打印一条语句。我想要的是当我的播放器精灵“从屏幕上掉下来”时调用这个方法。

现在我在屏幕底部放置了一个矩形来表示某种危险（如水），当玩家与它发生碰撞时，它会调用 gameOver 方法并且游戏结束。但是，如果玩家跌落到屏幕的某个高度以下，我仍然希望游戏结束。

这是我的 gameOver 方法（来自“游戏”类）-

```
/** End the game. */
public void gameOver()
{
    world.terminate();
    isOver = true;
} 
```

这是我的玩家精灵（目前使用多边形绘制）-

```
super(Utils.createPolygon(170, 102,
    155, 118, 137, 118, 151, 134, 146,
    140, 167, 140, 170, 135, 174, 140,
    193, 140, 188, 134, 202, 118, 186,
    118, 170, 102)); 
setColor(new Color(254, 167, 184)); 
```

这是当玩家与敌人碰撞时结束游戏的代码（来自“Enemy”类，类似的代码也用于 Hazard 类）-

```
if (e.contact.involves(player) && (player.getLives() < 1)) {
    System.out.println("YOU ARE DEAD!");
    game.gameOver();
} 
```

我想要一个类似的，或者至少是简单的解决方案，当我的玩家精灵跌落或超出屏幕的某个坐标时，它会调用我的 gameOver 方法。

如果您能提供一个示例/示例代码，并附上注释以帮助我理解它，我将不胜感激，以便了解我应该如何实现这一目标。

非常感谢您，我期待您的答复。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-09T00:39:22.383

为了让你开始：

1.  想想如何获得玩家的当前位置。
2.  想想是什么让玩家跌倒（应该有一些方法/类来实现重力和下落？）
3.  检查玩家的位置，因为他们落在你的世界的边界上。如果他们在边界之外，是时候调用你的 GameOver 方法了。

检查边界：

1.  你的世界应该有一个玩家必须保持在上面才能生存的最小高度。记住这个值。
2.  如果你得到你的玩家的垂直位置并与这个最小高度进行比较，你应该得到一个布尔结果（安全与死亡）。
3.  请注意，屏幕位置从左上角开始，并随着您向右和向下移动而增加，因此您的玩家位置可能反映了这一点。因此，您很可能正在寻找测试 ( `player.getPosition().Y > world.getMaxAllowedHeight()`)；

* * *

供参考：请发布您已经尝试过的内容以及遇到问题的地方。寻求解决方案不会帮助任何人——你必须自己考虑一下。如果您不知道从哪里开始，请告诉我们；我们可以尝试引导您朝着正确的方向前进。

更新：听起来你已经做了一些思考，太棒了！对不起，如果我粗暴地跳到你的喉咙里，但你原来的帖子却另有建议。不过，下一次，请尝试问一个更多的帮助我帮助我自己的问题，而不是一个为我解决的问题。一个简单的“有人可以告诉我如何开始解决这个问题吗？” 会做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T00:36:06.993

为了帮助你做功课：

```
 // if the player goes out of bounds, the game is over
   if (player.getBounds().outside(game.getBounds()) 
   {
        System.out.println("YOU WENT OUT!");
        game.gameOver();
    } 
```

假设玩家有某种边界区域，而游戏本身也有某种区域......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T00:38:36.860

问自己的一个好问题是，“我的精灵在哪里？”。

下一个问题是，“我的世界的边界是什么？”。

如果你能回答这两个问题，那么你应该能够回答你自己的问题。

假设你有一个二维世界，只要精灵的位置在水平边界内和垂直边界内，那么你的精灵仍然在地图上，否则，他不在。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T01:09:49.593

你有游戏循环吗？

通常在游戏中会有某种紧密循环来控制逻辑和渲染过程，例如。

```
while(stillRunning)
{

   if(isPlayerDead()) 
   { 
       showGameOverScreen(); 
   }
   else
   {
       PerformLogic();
       RenderToScreen();
   }

   sleep(0);
} 
```

您需要扩展 isPlayerDead() 方法以检查碰撞以及精灵的位置是否大于屏幕高度。

# asp.net-mvc - 如何在 IIS 7 下为 ASP.Net MVC 应用程序的匿名用户创建本地用户配置文件？

> ID：526745
> 
> 赞同：3
> 
> 时间：2009-02-09T00:18:14.960
> 
> 标签：asp.net-mvc, iis-7, windows-7, forms-authentication, sql-server-express

我一直在试验 ASP.Net MVC，并且遇到了一个可能与 MVC 无关的问题。但我无法在默认 MVC 应用程序（创建新 MVC 项目时由向导创建的应用程序）中获得身份验证，以便在 Windows 7 上的 IIS 7 下正常工作。

如果我在 Visual Studio 环境下运行，它可以工作，但如果我将设置切换为在 IIS 下运行，我会在尝试提交登录或注册时遇到以下异常：

> 由于检索用户的本地应用程序数据路径失败，无法生成 SQL Server 的用户实例。请确保用户在计算机上有本地用户配置文件。连接将被关闭。

我相信这是因为该网站在我自己的 Visual Studio 帐户下运行，但在 IIS 中的 IUSR 帐户下运行。到目前为止，谷歌对异常消息的搜索一直没有帮助。

那么，可以为 IUSR 帐户创建本地用户配置文件吗？如果是这样，怎么做？我还应该做些什么来让 SQLExpress 引擎在 IIS 7 中的匿名帐户下工作？

我也尝试将 IIS 网站配置为使用我的帐户，但由于这是我的家用计算机，我的帐户没有密码，而且似乎 IIS 不会让网站配置为使用没有密码的帐户。或者，由于这是我第一次使用 IIS 7，并且配置感觉与 IIS 5/6 非常不同，我只是缺少正确的设置，可以让我配置用于匿名访问的帐户。

编辑：一些附加信息。如果我清空 App_Data 文件夹并从 IIS 重试，SQLExpress 会尝试创建我的数据库并失败，但异常消息包含更多信息以及以下建议。

> **SQLExpress 数据库文件自动创建** **错误：**
> 
> 连接字符串使用应用程序 App_Data 目录中的数据库位置指定本地 Sql Server Express 实例。提供者试图自动创建应用程序服务数据库，因为提供者确定该数据库不存在。成功检查应用程序服务数据库是否存在并自动创建应用程序服务数据库需要以下配置要求：
> 
> 1.  如果应用程序 App_Data 目录尚不存在，则 Web 服务器帐户必须对应用程序目录具有读写权限。这是必要的，因为如果 App_Data 目录不存在，Web 服务器帐户将自动创建它。
> 2.  如果应用程序 App_Data 目录已存在，则 Web 服务器帐户只需要对应用程序 App_Data 目录的读写权限。这是必要的，因为 Web 服务器帐户将尝试验证 Sql Server Express 数据库是否已存在于应用程序 App_Data 目录中。从 Web 服务器帐户撤消对 App_Data 目录的读取访问权限将阻止提供程序正确确定 Sql Server Express 数据库是否已存在。当提供程序尝试创建现有数据库的副本时，这将导致错误。需要写入权限，因为在创建新数据库时会使用 Web 服务器帐户凭据。
> 3.  机器上必须安装 Sql Server Express。
> 4.  Web 服务器帐户的进程标识必须具有本地用户配置文件。有关如何为计算机和域帐户创建本地用户配置文件的详细信息，请参阅自述文件。

我已经非常广泛地确认前三个建议已经得到满足。第四个似乎是我的问题的原因，但我不知道该怎么做。尽管该建议声称有一个描述它的自述文件，但我无法找到该文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-08T18:08:33.613

我在中等信任下也遇到了这个问题。创建数据库的进程至少需要高度信任。您可以通过查看您的 Web.Config 来检查这一点

```
<trust level="TrustLevel" /> 
```

如果您的 Web.Config 中没有指定信任，请尝试添加它并将其设置为 Full 或 High。如果这不起作用，则您的 IIS 中有一个 machine.config，您需要对其进行修改。

话虽如此，我发现解决此问题的最佳途径是使用 aspnet_regsql.exe 创建必要的表，然后更改 Web.Config 中的连接字符串以直接查看它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-26T15:51:34.500

我解决了“目录'LocalApplicationData'不存在。” 通过 SQL 作业运行 SSIS 包时出错，方法是确保 SQL SSIS 服务和 SQL Server 代理服务在与 swql 作业设置使用的帐户相同的帐户下运行！

在我的情况下，这是一个域帐户。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-11T16:56:03.023

解决方案：在开始遇到问题之前尝试卸载任何更新。我花了无数个小时——浪费了我一生中永远不会回来的时间——阅读并遵循每一个可能没有成功的解决方案。我卸载了所有 SQL Server 更新，现在一切正常。

# c++ - 在 Qt 中设置 QLineEdit 焦点

> ID：526761
> 
> 赞同：23
> 
> 时间：2009-02-09T00:28:33.720
> 
> 标签：c++, qt, qlineedit

我有一个qt问题。我希望 QLineEdit 小部件在应用程序启动时获得焦点。以下面的代码为例：

```
#include <QtGui/QApplication>
#include <QtGui/QHBoxLayout>
#include <QtGui/QPushButton>
#include <QtGui/QLineEdit>
#include <QtGui/QFont>

 int main(int argc, char *argv[])
 {
     QApplication app(argc, argv);

     QWidget *window = new QWidget();
     window->setWindowIcon(QIcon("qtest16.ico"));
     window->setWindowTitle("QtTest");

     QHBoxLayout *layout = new QHBoxLayout(window);

     // Add some widgets.
     QLineEdit *line = new QLineEdit();

     QPushButton *hello = new QPushButton(window);
     hello->setText("Select all");
     hello->resize(150, 25);
     hello->setFont(QFont("Droid Sans Mono", 12, QFont::Normal));

     // Add the widgets to the layout.
     layout->addWidget(line);
     layout->addWidget(hello);

     line->setFocus();

     QObject::connect(hello, SIGNAL(clicked()), line, SLOT(selectAll()));
     QObject::connect(line, SIGNAL(returnPressed()), line, SLOT(selectAll()));

     window->show();
     return app.exec();
 } 
```

为什么`line->setFocus()`只有在布局小部件之后放置它并且在它不起作用之前使用它时才将焦点设置在行小部件@app启动上？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-09T16:40:20.077

[键盘焦点](https://doc.qt.io/qt-5/focus.html)与小部件的[Tab 键顺序](https://doc.qt.io/qt-5/qwidget.html#setTabOrder)有关，默认的 Tab 键顺序*基于构建小部件的顺序*。因此，创建更多小部件会更改键盘焦点。这就是为什么你必须[`QWidget::setFocus`](https://doc.qt.io/qt-5/qwidget.html#setFocus)最后打电话的原因。

我会考虑为您的主窗口使用一个子类`QWidget`来覆盖[`showEvent`](https://doc.qt.io/qt-5/qwidget.html#showEvent)虚拟功能，然后将键盘焦点设置为`lineEdit`. 这将具有在`lineEdit`显示窗口时始终给予焦点的效果。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-03-07T23:08:12.233

另一个可能有效的技巧是使用`singleshot`计时器：

```
QTimer::singleShot(0, line, SLOT(setFocus())); 
```

实际上，这会在事件系统“空闲”之后立即调用实例的`setFocus()`槽`QLineEdit`，即在小部件完全构建之后的某个时间。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-09-10T19:39:45.527

也许这是一个更新，因为最后一个答案是在 2012 年，而 OP 最后一次编辑这个问题是在 2014 年。他们让我工作的方式是改变政策，然后设定焦点。

```
line->setFocusPolicy(Qt::StrongFocus);
line->setFocus(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T00:44:13.807

在 Qt setFocus() 是一个插槽中，您可以尝试其他采用 Qt::FocusReason 参数的重载方法，如下所示：

```
line->setFocus(Qt::OtherFocusReason); 
```

您可以在以下链接中阅读有关焦点原因选项的信息：

[http://doc.trolltech.com/4.4/qt.html#FocusReason-enum](http://doc.trolltech.com/4.4/qt.html#FocusReason-enum)

# messaging - 你将如何创建一个线程消息传递系统？

> ID：526762
> 
> 赞同：1
> 
> 时间：2009-02-09T00:29:51.140
> 
> 标签：messaging

我想知道线程消息传递系统的表结构。

我想会有3张桌子：

```
- message_thread
    - id
    - subject
- message_user
    - thread_id
    - user_id
    - thread_status (unread, read, trash, deleted)
- message
    - date (date sent)
    - sent_user_id
    - message 
```

每个`message_thread`人在 message_thread 中都有 1 条记录。每个用户都会有一个将`message_user`他们与该线程相关联的记录，以及他们对该线程的读取/删除状态。（`message_user`可能还包含一些关于不同状态何时发生的日期时间字段。）消息表将包含消息、发送它们的用户和时间。

该系统最终会像 Facebook 一样工作，或者看起来像 Gmail 的（尽管不是基于电子邮件）。

必需的：

*   超过 2 个用户参与该线程
*   每个用户必须有自己的线程读取/删除状态

这是你设置的方式吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T00:33:27.450

尝试一张表：

```
messages
  id (INT)
  user_id (INT, ref to users table)
  subject (CHAR)
  parent_id (INT, ref to messages table, NULL if head of thread)
  content (TEXT),
  (other per-message attributes) 
```

允许线程化，以及每条消息都有自己的主题。

要添加阅读状态，请添加一个将用户链接到消息的多对多表，其中表中的条目表示用户已阅读该消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-09T00:35:38.397

我会添加一个状态记录表，其中包含 user_id、thread_id、status_id 和状态更改的日期。

我还将组合 message 和 message_thread 表，因为它们看起来将是 1 对 1 并且可以组合。

# windows - 注定的技术？

> ID：526766
> 
> 赞同：0
> 
> 时间：2009-02-09T00:33:32.553
> 
> 标签：windows, survey

您认为哪些技术/语言/应用程序在 Windows 平台上达到了顶峰，哪些技术/语言/应用程序已经或应该被淘汰？我的投票，在某些方面可能是一厢情愿：

1.  VBScript
2.  微软访问
3.  ODBC
4.  闪光

我问是因为我们正在为技术和应用程序开发设定未来的方向，即除非别无选择，否则不要使用这些。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-09T00:49:15.807

我认为Windows总体上已经达到顶峰。最新版本的 Windows，Vista 在美国受到负面评价，欧洲和非洲有许多主要组织逐步淘汰 MS Windows 以支持 Linux 的例子，所有这一切都使 Linux 义务警员受益匪浅。 . 最糟糕的是，微软雇用了一些计算机行业最聪明的人，但通常被营销人员搞砸了。

我希望我会因为这个答案而在降级方面得到努力，但我认为这是值得的。作为一名高级/首席开发人员，我希望我可以使用一些 Microsoft 技术，但我害怕将我的公司拖入 Microsoft 的生存税之下，这使我偏向于一家在让我进入编程方面发挥重要作用的公司（ Apple Basic，然后是 MS Basic，然后是 90 年代后期带有 win32 API 的 c++），这令人失望。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-09T00:52:25.800

我认为 MS Access 并不是一种死技术/产品。但是，通常与 Access 相关联的旧版“Jet 数据库引擎”肯定处于过时模式。我不; 认为 MS 已经发布了 64 位 Jet Engine（我知道他们不打算这样做，但如果需求使他们改变主意也不会感到惊讶）。此外，喷气发动机不再是 MDAC 的一部分。

MS 希望 Access 数据库引擎的未来成为 SQL Express/SQL Compact/MSDE 类型的引擎。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-09T00:45:06.283

我真的不认为 Flash 注定要失败 .. 我现在押注它的未来超过 Silverlight

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-09T00:40:52.333

不确定为什么 Access 在您的列表中。仍然大量使用，是小型数据库的不错选择。

这就是我认为 MS 想要杀死的东西……它是否发生是另一回事。

1.  WinForms
2.  VB6
3.  C++（用于桌面应用程序）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-09T00:48:32.860

恕我直言，经典 ASP（相对于 ASP.Net）和 Visual Basic（再次，相对于 Visual Basic.Net）？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-09T01:18:21.820

老实说，我真的认为任何有能力进入这个名单的东西都不会被淘汰。让一项技术退役真的很难。看看 COBOL。每个人都说 COBOL 已经走到了尽头，并且多年来一直在说，你瞧，人们仍在使用它进行编程，并且有许多生产系统在运行它。

他是另一个例子，我大学毕业后的第一份工作是一家重型德尔福商店。没有 VB 和 MS 技术是邪恶的。很明显，我所在地区的每个人和美国的大多数人都放弃了它，转而使用 Visual Basic，或者像 C++ 这样更强大的东西。我上下发誓 Delphi 是一项死技术，而 Borland 正在走向下水道。话虽如此，它显然在今天使用。我错了。流行的技术永远不会真正消亡或过时，因为它们具有改变的能力，并且因为人们依赖于当前正在运行的系统（看看 FORTRAN，我知道一些物理学家仍在使用用它编写的程序）。一旦一种语言/系统流行起来，总会需要有人知道它，这意味着总是需要有人来改进。

在您提供的列表中，我会说也许 ODBC 可能会被淘汰，但对于其他遗留技术，我认为这将是一个很长的时间。您可能会争辩说 VB6 将被淘汰，但我认为不久之后会有人（不是 MS）为它编写一个新的编译器，不一定会重新使用它，而是延长它的寿命。里面写的太多了，组织只能把它扔掉。人们争论事情被重写，但它成功发生的频率是多少？IT之外的人的主要心态是：“没坏就不修”。这将使技术长期存在。我们可以说有些东西已经死了，但实际上它们都会存在很长时间。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-09T00:51:58.373

我同意 MS 根本不支持 C++，这是试图创建只能编写业务应用程序的程序员，因此不直接挑战 MS 自己吗？

另一个死在水中的是 Vista，在 Windows 7 上滚动。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-09T01:16:45.600

您所说的 flash 是指 Actionscript 还是整个平台？

Flash CS4 已经显示出一些巨大的潜力。

[这是一个很酷的 CS4 功能之旅](http://www.gotoandlearn.com/play?id=87)

# java - 学习遗留的 Java 系统

> ID：526767
> 
> 赞同：6
> 
> 时间：2009-02-09T00:33:45.140
> 
> 标签：java, legacy, maintenance

我的任务是维护和重构遗留 Java 系统。我目前使用 C# 和 .NET，虽然我熟悉 Java。

遗留系统使用 RMI，一种客户端/服务器架构，专为 1.4 JVM 设计。它用于 UI（据我所知）、Swing 和 AWT。

我的问题是：与我刚刚收到的代码库达成协议的最佳方式是什么？我正在考虑屏幕流程图、定义 RMI 调用之间的边界以及编写单元测试（针对可测试的位）。

当你收到一个不熟悉的代码库时，你会怎么做？

谢谢！

-贾罗德

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-09T00:37:40.670

对于收到的任何新代码，我做的第一件事就是查看现有的单元测试。编写新测试通常是第二件事。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-09T01:06:22.363

这在很大程度上取决于代码库的质量。实际上，您可以更狭义地定义它——这取决于代码的清晰程度以及评论的好坏（我写这篇文章是作为一个反复处于继承记录不佳的遗留代码库的人）。

代码库越差，你就越需要从外部推断它的功能——如果你不能弄清楚一个函数在做什么，你至少可以弄清楚 GUI 似乎暗示了什么它正在做的事情。拥有 RMI 接口可能是一件好事，因为它为您提供了 GUI 需要查看的简化图 - 从远程接口抽象是一个非常好的主意。

如果代码库真的很差，单元测试不太可能对您有所帮助，因为即使正确实施，您也可能正在测试错误的东西。我继承的最后一件事的一个例子：（*故意删除了名称和描述 - 在任何情况下它们对原件都没有帮助）*

```
 public static int[] a (List<int[]> input){  

   ... lots of opaque rubbish
   return b(input);
 }

 public static List<int[]> b{ List<int[]> input)
 {
   ... more crap....
   return some horribly mangled list of int[];
 } 
```

事实证明，所**完成**的是按数组的第二个元素的值对数组进行排序。在这种情况下，测试**b**以使其正常运行将毫无用处。

帮助您保持理智的建议：

*   删除明显未使用的代码。
*   尝试分解任何“神奇数字”
*   找到任何硬编码文件、路径或资源引用，并将它们分解为属性，或任何其他集中的通用方法来处理它们。
*   尝试确定应用程序是否真的按照它应该的方式执行 - 对于一些非常复杂的功能，你无法做出正面或反面的实际代表用户认为“从未真正正常工作”的东西，这并不罕见。
*   查找最初设计事物时的任何原始文档或规范。
*   既然你提到了 1.4，泛化映射可以阐明传递了哪些类型的对象。如果您有一个由 HashMap 支持的对象，并且它是如何填充的是一个谜，它可以真正简化您的生活，以确定它实际上是一个字符串到整数的映射 - 这通常比它实际假设的要容易得多正在做。

当然，如果代码库写得好，大部分这些都是不必要的，但无论如何你的工作都会容易得多。还有祝你好运。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T01:41:01.500

帮助我处理对我来说是新的代码的一件事——这对于编写良好的代码来说不太必要——是在一两天内对其进行大规模重构，然后丢弃我的所有更改。这个过程帮助我理解代码的作用；使用代码可以帮助我理解它。它也开始教会我代码的哪些部分是脆弱的。

如果您有机会迁移到 Java 的较新版本，那么对所有集合进行泛化将有助于了解传递的数据类型。

当然，我是在测试实验室中安装软件并稍微使用它以了解它的作用之后执行此操作的。

编辑：考虑我的回答，启用所有诊断跟踪和日志记录，使用系统，然后研究日志也很有用。如果存在通信协议跟踪，那么查看此跟踪将有助于了解代码使用的通信协议，也许与相同测试的 Wireshark 跟踪有关。

另一个有用的迁移是从旧的并发库迁移到新的 Java 5（和 6）并发库。这将帮助您了解线程的位置以及它们何时启动以及何时关闭。

当然，对于不熟悉的代码库上的任何代码更改，我假设进行了适当的测试以确保没有任何损坏！然而，为了平衡这一点，我了解到在重构糟糕的代码之后，新引入的错误通常比重构之前存在的错误更容易找到。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T01:08:02.937

收到新代码时我做的第一件事就是“尝试让它工作”！我的意思是：

*   首先安装它（根据安装说明，如果有的话）

*   然后熟悉它（通过阅读用户手册并运行一些重要的用例）

*   然后进行一些逆向工程以找出主要层。类和依赖项

*   然后我可以考虑编写新的测试用例（首先在接受级别，这对以后的回归测试很有用）

*   然后我给自己一些关于添加这个特性（即使它不是必需的）或改进现有特性的性能的“挑战”：这是挖掘现有代码库的好方法

*   当然，如果有一些已知的待处理错误/RFE，我会先处理这些

在您的特定情况下，我还将尝试记录 RMI 调用、执行什么调用或调用序列，并尽可能将其与使用级功能相关联。

此外（实际上这应该首先出现），要知道的重要一件事是该系统的主要目标（您的客户为什么要使用该系统？）。了解目标并牢记它们将避免您在维护代码的同时远离这些目标。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-09T04:46:32.257

Mike Hill 参加了一个演讲，他在演讲中谈到了他用来处理不良遗留代码的过程。他称之为“微测试”，它基本上隔离了你想要测试的每一件事（在它自己的函数或小对象中），并围绕它编写测试。这些测试并不意味着在商业意义上断言事物——它们只是为了捕捉在被测行执行后系统所处的状态。通常，他会断言变量具有它们在调试器中的值。当然，这些测试最初会通过，但在他编写了足够多的测试之后，他将有效地获得系统的快照。

一旦这些测试到位，他就可以开始重构那段代码以尝试理解它试图做什么。他可以安全地这样做，因为如果他稍微改变函数（或对象）的行为方式，他的“微测试”就会失败。虽然这意味着他无法对设计进行重大更改，但他可以消除很多噪音，并且可以了解系统正在做什么。一旦他对代码的目标有了清晰的认识，他就可以开始改进它，发现错误等。

这方面的免费资源不多，这就是我不提供链接的原因。希望我已经设法描述足够给你一些想法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-09T05:12:31.913

经验告诉我，学习遗留系统有 3 个主要目标。

*   了解代码应该做什么
*   了解它是如何做到的
*   （至关重要）了解为什么它会这样做

所有这三个部分都非常重要，并且有一些技巧可以帮助您入门。

首先，抵制只是通过 ctrl-click（或任何您的 IDE 使用的方式）围绕代码来理解所有内容的诱惑。您可能无法以这种方式将所有内容都放在脑海中，尤其是当每一行都迫使您查看多个其他类以了解它是什么时。

尽可能阅读文档；它通常可以帮助您快速获得构建后续所有内容的思维框架。

尽可能运行测试用例。

不要害怕问知道你是否有问题的人。诚然，您不应该将其他员工的时间浪费在无意义的查询上，但如果有些事情您根本不理解（这对于更多概念性问题尤其如此，例如，“将其实现为更有意义吗？ ___”或其他东西），在你把事情搞砸并且不知道为什么之前找出答案可能是值得的。

当你最终开始阅读代码时，从一个合乎逻辑的“主要”位置开始，然后从那里开始。不要只是从上到下阅读代码，或者按字母顺序，或者任何东西（这可能很明显）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-09T00:46:53.003

带有 RMI 的 Java 1.4 不是遗留的，从某些标准来看这实际上是新的！

尽你所能熟悉事物所在的位置——单元测试、跟踪代码/调用、处理一些 UML 图等。

尝试从其中的一小部分开始并跟踪代码路径以熟悉事物的位置，或者为自己分配一些需要查看代码的小修复/改进。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-09T01:28:16.977

构建并运行它将是我的第一件事。开始了解它试图解决的问题。

也许您可以将它导入到 JUDE 之类的 UML 工具中，并了解类如何交互。

编写 JUnit 测试是一个很好的建议。我想看看应用程序的分层程度。如果它很难测试，也许它太耦合了。单元测试会告诉你。如果您决定进行一些重构，它们还会为您提供安全网。

JDK 1.4？它的支持寿命已经结束。我还想看看代码是否至少可以在 JDK 5 下构建和运行，最好是在 JDK 6 下。也许您可以将其中一些 JUnit 测试放入 JMeter 并与 5 个同时用户进行快速的穷人负载测试。

如果您有一个数据模型，请将其拉​​入 ERWin 并开始查看表格、对象和屏幕是如何一起流动的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-09T03:16:13.410

当然你也可以试试单步执行。它很慢，但花一天时间浏览代码可能会节省一周的错误搜索......

您也可以尝试寻宝方法，列出每个功能并为其寻找代码......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-09T03:53:32.760

首先浏览代码以了解其结构。然后，在调试模式下运行应用程序并运行几次。这将向您展示流程和结构。

使用 Netbeans 对类图进行逆向工程。

# bash - 如何限制 BASH 脚本的运行时间

> ID：526782
> 
> 赞同：20
> 
> 时间：2009-02-09T00:40:32.053
> 
> 标签：bash, cygwin

我有一个长时间运行的 BASH 脚本，我在 Windows 上的 CYGWIN 下运行。

我想限制脚本运行 30 秒，如果超过此限制，则自动终止。理想情况下，我希望能够对任何命令执行此操作。

例如：

```
sh-3.2$ limittime -t 30 'myscript.sh' 
```

或者

```
sh-3.2$ limittime -t 30 'grep func *.c' 
```

在 cygwin 下 ulimit 命令似乎不起作用。

我对任何想法持开放态度。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2010-02-02T12:41:32.193

请参阅[http://www.pixelbeat.org/scripts/timeout](http://www.pixelbeat.org/scripts/timeout)脚本，其功能已集成到较新的 coreutils 中：

```
#!/bin/sh

# Execute a command with a timeout

# License: LGPLv2
# Author:
#    http://www.pixelbeat.org/
# Notes:
#    Note there is a timeout command packaged with coreutils since v7.0
#    If the timeout occurs the exit status is 124.
#    There is an asynchronous (and buggy) equivalent of this
#    script packaged with bash (under /usr/share/doc/ in my distro),
#    which I only noticed after writing this.
#    I noticed later again that there is a C equivalent of this packaged
#    with satan by Wietse Venema, and copied to forensics by Dan Farmer.
# Changes:
#    V1.0, Nov  3 2006, Initial release
#    V1.1, Nov 20 2007, Brad Greenlee <brad@footle.org>
#                       Make more portable by using the 'CHLD'
#                       signal spec rather than 17.
#    V1.3, Oct 29 2009, Ján Sáreník <jasan@x31.com>
#                       Even though this runs under dash,ksh etc.
#                       it doesn't actually timeout. So enforce bash for now.
#                       Also change exit on timeout from 128 to 124
#                       to match coreutils.
#    V2.0, Oct 30 2009, Ján Sáreník <jasan@x31.com>
#                       Rewritten to cover compatibility with other
#                       Bourne shell implementations (pdksh, dash)

if [ "$#" -lt "2" ]; then
    echo "Usage:   `basename $0` timeout_in_seconds command" >&2
    echo "Example: `basename $0` 2 sleep 3 || echo timeout" >&2
    exit 1
fi

cleanup()
{
    trap - ALRM               #reset handler to default
    kill -ALRM $a 2>/dev/null #stop timer subshell if running
    kill $! 2>/dev/null &&    #kill last job
      exit 124                #exit with 124 if it was running
}

watchit()
{
    trap "cleanup" ALRM
    sleep $1& wait
    kill -ALRM $$
}

watchit $1& a=$!         #start the timeout
shift                    #first param was timeout for sleep
trap "cleanup" ALRM INT  #cleanup after timeout
"$@"& wait $!; RET=$?    #start the job wait for it and save its return value
kill -ALRM $a            #send ALRM signal to watchit
wait $a                  #wait for watchit to finish cleanup
exit $RET                #return the value 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-09T00:55:24.700

以下脚本显示了如何使用后台任务执行此操作。第一部分在 10 秒限制后终止了一个 60 秒的进程。第二次尝试杀死已经退出的进程。请记住，如果您将超时设置得非常高，则进程 ID 可能会翻转并且您将终止错误的进程，但这更多是一个理论上的问题 - 超时必须*非常*大，您必须启动*很多*进程。

```
#!/usr/bin/bash

sleep 60 &
pid=$!
sleep 10
kill -9 $pid

sleep 3 &
pid=$!
sleep 10
kill -9 $pid 
```

这是我的 Cygwin 盒子上的输出：

```
$ ./limit10
./limit10: line 9:  4492 Killed sleep 60
./limit10: line 11: kill: (4560) - No such process 
```

如果您只想等到该过程完成，您需要进入一个循环并检查。这稍微不太准确`sleep 1`，因为其他命令实际上会花费一秒钟以上（但不会更多）。使用此脚本替换上面的第二部分（“ `echo $proc`”和“ `date`”命令用于调试，我不希望它们出现在最终解决方案中）。

```
#!/usr/bin/bash

date
sleep 3 &
pid=$!
((lim = 10))
while [[ $lim -gt 0 ]] ; do
    sleep 1
    proc=$(ps -ef | awk -v pid=$pid '$2==pid{print}{}')
    echo $proc
    ((lim = lim - 1))
    if [[ -z "$proc" ]] ; then
            ((lim = -9))
    fi
done
date
if [[ $lim -gt -9 ]] ; then
    kill -9 $pid
fi
date 
```

它基本上是循环的，每秒检查进程是否仍在运行。如果不是，它会以特殊值退出循环，以不尝试杀死孩子。否则它会超时并杀死孩子。

这是 a 的输出`sleep 3`：

```
Mon Feb  9 11:10:37 WADT 2009
pax 4268 2476 con 11:10:37 /usr/bin/sleep
pax 4268 2476 con 11:10:37 /usr/bin/sleep
Mon Feb  9 11:10:41 WADT 2009
Mon Feb  9 11:10:41 WADT 2009 
```

和一个`sleep 60`：

```
Mon Feb  9 11:11:51 WADT 2009
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
pax 4176 2600 con 11:11:51 /usr/bin/sleep
Mon Feb  9 11:12:03 WADT 2009
Mon Feb  9 11:12:03 WADT 2009
./limit10: line 20:  4176 Killed sleep 60 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-09T00:44:10.513

看看[这个链接](http://redflo.de/tiki-index.php?page=Bash+script+with+timeout+function)。这个想法只是您将`myscript.sh`作为脚本的子进程运行并记录其 PID，然后如果运行时间过长则将其终止。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-01-27T22:54:15.080

```
timeout 30s YOUR_COMMAND COMMAND_ARGUMENTS 
```

以下是coreutils下“超时”的所有选项：

```
$ timeout --help
Usage: timeout [OPTION] DURATION COMMAND [ARG]...
  or:  timeout [OPTION]
Start COMMAND, and kill it if still running after DURATION.

Mandatory arguments to long options are mandatory for short options too.
      --preserve-status
                 exit with the same status as COMMAND, even when the
                   command times out
      --foreground
                 when not running timeout directly from a shell prompt,
                   allow COMMAND to read from the TTY and get TTY signals;
                   in this mode, children of COMMAND will not be timed out
  -k, --kill-after=DURATION
                 also send a KILL signal if COMMAND is still running
                   this long after the initial signal was sent
  -s, --signal=SIGNAL
                 specify the signal to be sent on timeout;
                   SIGNAL may be a name like 'HUP' or a number;
                   see 'kill -l' for a list of signals
      --help     display this help and exit
      --version  output version information and exit

DURATION is a floating point number with an optional suffix:
's' for seconds (the default), 'm' for minutes, 'h' for hours or 'd' for days.

If the command times out, and --preserve-status is not set, then exit with
status 124\.  Otherwise, exit with the status of COMMAND.  If no signal
is specified, send the TERM signal upon timeout.  The TERM signal kills
any process that does not block or catch that signal.  It may be necessary
to use the KILL (9) signal, since this signal cannot be caught, in which
case the exit status is 128+9 rather than 124.

GNU coreutils online help: <http://www.gnu.org/software/coreutils/>
Full documentation at: <http://www.gnu.org/software/coreutils/timeout>
or available locally via: info '(coreutils) timeout invocation' 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-09T00:42:04.170

您可以将命令作为后台作业运行（即使用“&”），将 bash 变量用于“最后一次命令运行的 pid”，休眠必要的时间，然后`kill`使用该 pid 运行。

# python - 如何将自定义字段添加到 InlineFormsets？

> ID：526795
> 
> 赞同：6
> 
> 时间：2009-02-09T00:47:25.263
> 
> 标签：python, django, field, formset, inline-formset

我正在尝试使用以下代码将自定义字段添加到 InlineFormset，但这些字段不会显示在 Django Admin 中。InlineFormset 是否过于锁定而不允许这样做？我的 print "ding" 测试按预期触发，我可以打印出 form.fields 并在那里查看它们，但实际字段永远不会在管理员中呈现。

**管理员.py**

```
from django.contrib import admin
import models
from django.forms.models import BaseInlineFormSet
from django import forms
from forms import ProgressForm
from django.template.defaultfilters import slugify

class ProgressInlineFormset(BaseInlineFormSet):
    def add_fields(self, form, index):
        print "ding"
        super(ProgressInlineFormset, self).add_fields(form, index)
        for criterion in models.Criterion.objects.all():
            form.fields[slugify(criterion.name)] = forms.IntegerField(label=criterion.name)

class ProgressInline(admin.TabularInline):
    model = models.Progress
    extra = 8
    formset = ProgressInlineFormset

class ReportAdmin(admin.ModelAdmin):
    list_display = ("name", "pdf_column",)
    search_fields = ["name",]
    inlines = (ProgressInline,)

admin.site.register(models.Report, ReportAdmin) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-02-12T10:06:37.487

我用另一种方式做到了：

表格.py：

```
from django import forms
class ItemAddForm(forms.ModelForm):
    my_new_field = forms.IntegerField(initial=1, label='quantity')
    class Meta:
        model = Item 
```

管理员.py：

```
from django.contrib import admin
from forms import *
class ItemAddInline(admin.TabularInline):
    form = ItemAddForm 
```

到目前为止，这有效，我只需要以某种方式覆盖保存方法来处理这个新字段。看到这个：[http](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#form) ://docs.djangoproject.com/en/dev/ref/contrib/admin/#form 。它说默认情况下 Inlines 使用 BaseModelForm，它被发送到 formset_factory。它对我不起作用，尝试将 BaseModelForm 子类化并出现错误（没有属性'_meta'）。所以我改用 ModelForm 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-11-14T08:27:09.530

您可以通过另一种方式来做到这一点（动态形式）：

**管理员.py**

```
class ProgressInline(admin.TabularInline):
    model = models.Progress
    extra = 8

    def get_formset(self, request, obj=None, **kwargs):
        extra_fields = {'my_field': forms.CharField()}
        kwargs['form'] = type('ProgressForm', (forms.ModelForm,), extra_fields)
        return super(ProgressInline, self).get_formset(request, obj, **kwargs) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T12:12:45.163

```
model = models.Progress 
```

在管理员中，只有在此*Progress*模型中定义的字段。您没有覆盖它的字段/字段集选项。

如果要添加新的，有两个选项：

*   在模型定义中，添加那些新的附加字段（使它们成为可选的！）
*   在管理模型（*admin.TabularInline*）中，添加如下内容：

    字段 = ('newfield1', 'newfield2', 'newfield3')

看看[领域](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#fields)，领域[集](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#fieldsets)。

# .net - .NET 使用外部应用程序实现客户端/服务器排队模型的最佳方法？

> ID：526796
> 
> 赞同：3
> 
> 时间：2009-02-09T00:47:36.420
> 
> 标签：.net, web-services, request-queueing

这是规格：

1.  多个客户端在其本地计算机上使用 WPF winforms 应用程序
2.  客户端向服务器发起请求以执行模拟。此启动可能应通过 Web 服务进行，但欢迎提出其他建议
3.  请求在服务器上排队
4.  服务器通过 Web 服务向仿真模型发送顺序请求。
5.  服务器通知客户端模拟完成

另一个要求是让客户取消他们之前提出的请求。请注意，我们不必担心通过管道发送太多数据，我们只发送特定模拟运行完成（或失败）的确认

一开始我认为我可以用一个 asmx Web 服务来完成所有这些，但现在我认为这可能很笨拙。WCF 似乎是另一种选择，但我并不熟悉它，而且它似乎比我需要的功能复杂得多。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T02:12:04.017

***客户端：***要获得完成通知，您需要在从客户端调用 Web 服务时使用异步设计模式。如果您使用“添加 Web 引用”来创建客户端代理，则会为您生成异步模式方法。请参阅：“[在 .NET 设计模式中异步访问 Web 服务](http://www.codeproject.com/KB/cpp/wsasync.aspx)”。

***服务器：*** 一个普通的 .Net 2.0 asmx Web 服务可以将传入调用排队，以便在服务器上进行串行处理。您可以使用 BackgroundWorker 类构建一个简单的调度程序。调度程序接收每个传入请求并将其分配给后台线程。要序列化线程，请让 worker 方法在模拟调用周围*[放置一个锁。](http://msdn.microsoft.com/en-us/library/c5kehkcz.aspx)*请参阅[使用 BackgroundWorker 线程的示例](https://stackoverflow.com/questions/95700/vb-net-or-c-2008-multi-threaded-import/509999#509999)。

***Cancellation***：要处理取消，让服务器返回一个唯一的 id 及其对客户端请求的响应，并将 id 和关联的后台工作人员引用插入字典。Web 服务上的 CancelSimulation 方法接受 id，在字典中查找 BackgroundWorker 引用并调用其 CancelAsync 方法。任务完成或取消时删除字典条目。字典需要由所有 Web 服务调用共享，因此它应该是静态/共享的。幸运的是，静态[字典](http://msdn.microsoft.com/en-us/library/x8bctb9c.aspx)是线程安全的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T06:24:05.563

> WCF 似乎是另一种选择，但我并不熟悉它，而且它似乎比我需要的功能复杂得多。

我强烈建议你好好看看 WCF - 是的，一开始它可能有点令人生畏，但它通过配置为你提供了很大的灵活性，而不必编写特定的传输介质（例如 Web 服务与消息队列）。

既然您明确表示客户端会将请求发送到服务器上的队列 - 为什么不首先使用 MSMQ 等基于队列的消息传递系统？

使用服务器和客户端上的 WCF，您可以在使用 MSMQ 与使用“常规”HTTP SOAP 调用与使用例如 REST 调用之间快速切换 - 所有这些都在配置中。恕我直言，这种灵活性值得花一些时间来学习它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T08:13:36.487

你应该看看WCF。使用 Web 服务 + 轮询可能会杀死您的服务器（除非您没有那么多客户端） - 只需查看 Twitter。WCF 有一个持久连接，应该非常适合您。

至于排队，添加 System.Messaging 作为参考，使用 MSMQ。我不记得是否有用于 WCF 的 MSMQ 传输，但我相信您可以找到一个。使用它会用一块石头杀死两只鸟。如果您想使用 MSMQ，您的服务器将需要位于 Windows 域中。

否则，我强烈建议您将事件写入数据库，并在工作线程完成时从那里取出它们。将它们保存在内存队列中并不是很容错。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T01:33:12.033

您应该更仔细地查看 WCF。我已经为工作编写了一个自定义库来处理一些奇怪的配置内容，但是您可以使用 WCF 用几十行代码编写一个出色的 Web 服务。它是高度可扩展的。唯一的问题是“得到”它需要一段时间，但一旦你做到了，它真的非常简单。祝你好运。

# c++ - 用于创建 C/C++ 解析器/分析器的好工具

> ID：526797
> 
> 赞同：52
> 
> 时间：2009-02-09T00:48:13.530
> 
> 标签：c++, c, parsing, yacc, lex

有哪些好的工具可以快速开始解析和分析 C/C++ 代码？

特别是，我正在寻找处理 C/C++ 预处理器和语言的开源工具。这些工具最好使用 lex/yacc（或 flex/bison）作为语法，不要太复杂。他们应该处理最新的 ANSI C/C++ 定义。

这是我到目前为止发现的，但还没有详细研究它们（想法？）：

*   [CScope](http://cscope.sourceforge.net/) - 老式 C 分析器。不过，似乎没有进行完整的解析。被描述为用于查找 C 函数的美化“grep”。
*   [GCC](http://gcc.gnu.org/) - 每个人都喜欢的开源编译器。非常复杂，但似乎可以做到这一切。有一个用于创建 GCC 扩展的相关项目称为[GEM](http://research.alexeysmirnov.name/index.php?area=sec&proj=gem)，但自 GCC 4.1 (2006) 以来尚未更新。
*   [PUMA](http://ivs.cs.uni-magdeburg.de/~puma/) - 纯机械手。（来自页面：“该项目的目的是提供一个类库，用于分析和操作 C/C++ 源。为此，PUMA 提供了用于扫描、解析和操作 C/C++ 源的类。”） . 这看起来很有希望，但自 2001 年以来一直没有更新。显然 PUMA 已被合并到[AspectC++](http://www.aspectc.org/)中，但即使是这个项目自 2006 年以来也没有更新过。
*   各种 C/C++ 原始语法。你可以得到[c-c++-grammars-1.2.tar.gz](http://www.sigala.it/sandro/software.php)，但它自 1997 年以来一直无人维护。谷歌搜索一下就可以找到其他可以作为起点的基本 lex/yacc 语法。
*   还有其他人吗？

我希望以此为起点，将 C/C++ 源代码翻译成新的玩具语言。

谢谢！-马特

（添加 2/9）：只是澄清一下：除了 C/C++ 代码本身之外，我还想从预处理器中提取语义信息。我不希望“#define foo 42”消失在整数“42”中，但仍与名称“foo”相关联。不幸的是，这排除了几个首先运行预处理器并且只提供 C/C++ 解析树的解决方案）

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-09T01:38:25.173

解析 C++ 非常困难，因为语法是不可判定的。引用[Yossi Kreinin 的](http://www.yosefk.com/c++fqa/defective.html#defect-2)话：

> 异常复杂的语法
> 
> “杰出”应该按字面解释，因为*所有流行语言*都有[上下文无关](http://en.wikipedia.org/wiki/Context-free_grammar)（或“几乎”上下文无关）的语法，而 C++ 有[不可判定](http://en.wikipedia.org/wiki/Undecidability)的语法。如果你喜欢编译器和解析器，你可能知道这意味着什么。如果你不喜欢这种事情，有一个[简单的例子](http://www.yosefk.com/c++fqa/ctors.html#fqa-10.19)来说明解析 C++ 的问题：是`AA BB(CC);`对象定义还是函数声明？事实证明，答案很大程度上取决于语句*之前*的代码——“上下文”。这表明（在直观的层面上）C++ 语法对上下文非常敏感。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-09T10:04:52.990

您可以查看使用 llvm 进行解析的[clang 。](http://clang.llvm.org/StaticAnalysis.html)

现在完全支持 C++[链接](http://clang.llvm.org/cxx_status.html)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-02-09T03:05:44.760

[ANTLR](http://antlr.org)解析器生成器具有C/C++[语法](http://antlr.org/grammar/list)以及预处理器。我从来没有使用过它，所以我不能说它对 C++ 的解析有多完整。ANTLR 本身在一些场合对我来说是一个有用的工具，用于解析更简单的语言。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-02-09T01:25:52.130

根据您的问题，[GCCXML](http://www.gccxml.org/)可能是您的答案。基本上，它使用 GCC 解析源代码，然后为您提供易于理解的解析树 XML。使用 GCCXML，您可以一劳永逸地完成。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-03-14T06:38:01.230

[pycparser](http://code.google.com/p/pycparser/)是一个用 Python 编写的完整的 C (C99) 解析器。它有一个完全可配置的 AST 后端，因此它被用作您可能需要的任何类型的语言处理的基础。

不过不支持C++。当然，这*比*C 难多了。

* * *

**更新（2012 年）**：毫无疑问，此时的答案是[Clang](http://clang.llvm.org/) - 它是模块化的，支持完整的 C++（具有许多 C++-11 特性）并且具有相对友好的代码库。它还有一个用于绑定高级语言（即[Python](http://eli.thegreenplace.net/2011/07/03/parsing-c-in-python-with-clang/)）的 C API。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-09T01:03:38.220

看看[doxygen](http://www.doxygen.nl/manual/arch.html)是如何工作的，完整的源代码可用并且它是基于 flex 的。

一个误导性的候选者是[GOLD](http://www.devincook.com/goldparser/)，它是一个免费的基于 Windows 的解析器工具包，专门用于创建翻译器。他们*支持*的语言列表是指可以实现解析器的语言，而不是支持的解析语法列表。

他们只有 C 和 C# 的语法，没有 C++。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-03-13T20:02:29.840

[解析 C++ 是一项非常复杂的挑战](http://www.nobugs.org/developer/parsingcpp/)。

有 Boost/Spirit 框架，几年前他们确实[有过实现 C++ 解析器的想法](http://www.crystalclearsoftware.com/cgi-bin/boost_wiki/wiki.pl?action=browse&id=BoostSpiritCXXParser&revision=48)，但还[远未完成](http://www.nabble.com/boost-cxxparser--td18735062.html)。

完全正确地解析 ISO C++ 绝非易事，实际上有很多相关的努力。但它本身就是一项复杂的工作，如果不重写理解所有 C++**和**预处理器的完整编译器前端，就不容易完成。Spirit 人员提供了一个称为“wave”的预处理器实现。

也就是说，您可能想看看[猪肉/oink](http://blog.mozilla.com/tglek/2009/01/29/semantic-rewriting-of-code-with-pork-a-bitter-recap/)（基于 elsa），这是一个 C++ 解析器工具包，专门用于源代码转换目的，Mozilla 项目正在使用它来进行大规模静态源代码分析和自动代码重写，最有趣的部分是它不仅支持大部分C++，还支持预处理器本身！

另一方面，确实有一个可用的专有解决方案：EDG 前端，它几乎可以用于所有与 C++ 相关的工作。

就个人而言，我会查看 Mozilla 使用的基于 elsa 的猪肉/oink 套件，除此之外，FSF 现在已经批准使用运行时库许可证对[gcc 插件](http://gcc.gnu.org/wiki/plugins)的工作，因此我认为事情会发生变化很快，一旦人们可以使用二进制插件轻松利用基于 gcc 的 C++ 解析器来实现此类目的。

**所以，简而言之：如果你有钱：EDG，如果你现在**需要一些免费/开源的东西：else/oink 是相当有前途的，如果你有时间，你可能想在你的项目中使用 gcc。

另一个仅适用于 C 代码的选项是[cscout](http://www.spinellis.gr/cscout/)。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-09T00:55:24.077

C++ 的语法是出了名的多毛。Lambda上有[一个关于它的好帖子，](http://lambda-the-ultimate.org/node/2158)但要点是 C++ 语法可能需要任意多的前瞻。

对于我想你可能会做的那种事情，我会考虑破解 Gnu CC 或[Splint](http://www.splint.org/)。特别是 Gnu CC 确实非常彻底地分离了语言生成部分，因此您最好构建一个新的 g++ 后端。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-08-30T20:46:48.490

实际上，PUMA 和 AspectC++ 仍然在积极维护和更新。我正在研究使用 AspectC++ 并且想知道自己缺乏更新。我给作者发了电子邮件，他说 AspectC++ 和 PUMA 仍在开发中。您可以通过 SVN [https://svn.aspectc.org/repos/获得源代码，或者您可以在](https://svn.aspectc.org/repos/)[http://akut.aspectc.org](http://akut.aspectc.org)获得常规的二进制构建。和现在很多优秀的c++项目一样，作者没有时间跟上网页维护。如果你有一份全职工作和生活，这是有道理的。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-09T10:02:22.730

[Elsa](http://www.cs.berkeley.edu/~smcpeak/elkhound/sources/elsa/)在 C++ 解析方面胜过我所知道的一切，即使它不是 100% 兼容的。我是一个粉丝。有一个打印出 C++ 的模块，因此这可能是您的玩具项目的一个很好的起点。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-06-17T15:06:23.397

请参阅我们的[C++ 前端](http://www.semanticdesigns.com/Products/FrontEnds/CppFrontEnd.html) ，了解功能齐全的 C++ 解析器：构建 AST、符号表、进行名称和类型解析。您甚至可以解析和保留预处理器指令。C++ 前端构建在我们的[DMS 软件再工程工具包](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)之上，它允许您使用该信息通过源到源的转换来执行任意源代码更改。

DMS 是实现此类转换器的理想引擎。

话虽如此，我认为您想象的任务没有多大意义。我认为尝试替换 C++ 没有多大价值，而且您会发现构建一个完整的翻译器需要大量工作，尤其是当您的目标是“玩具”语言时。如果它的唯一目的是生成一个更易于解析的同构版本的 C++（等等，我们已经假设了一个健壮的 C++！），那么使用健壮的解析器解析 C++ 可能没有什么意义。

2012 年 5 月编辑：DMS 的 C++ 前端现在处理 GCC3/GCC4/C++11、Microsoft VisualC 2005/2010。稳健。

编辑 2015 年 2 月：现在处理 GCC 和 MS 方言中的 C++14。

编辑 2015 年 8 月：现在在统一的树中解析和捕获代码和预处理器指令。

编辑 2020 年 5 月：过去几年一直在做 C++17。C++20 正在进行中。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-09T00:59:41.443

[像tiny-C](http://bellard.org/tcc/)或[Small C](http://www.cpm.z80.de/small_c.html)这样更容易理解的东西怎么样？

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-09T09:55:21.390

不久前，我尝试编写一个工具来自动为 c 文件生成单元测试。

为了进行预处理，我将文件通过 GCC。输出很难看，但您可以轻松地从预处理文件中追踪原始代码的位置。但为了您的需要，您可能需要其他东西。

我使用[Meter](http://www.lysator.liu.se/c/metre-v2-3.html)作为 C 解析器的基础。它是开源的，使用 lex 和 yacc。这使得无需完全了解 lex 和 yacc 即可在短时间内轻松启动和运行。

我还编写了一个 C 应用程序，因为 lex 和 yacc 解决方案无法帮助我跨函数跟踪功能并一次性解析整个函数的结构。它在短时间内变得无法维护并被放弃。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-01-24T12:00:15.293

使用像 GNU 的[CFlow](http://www.gnu.org/software/cflow/)这样可以分析代码并生成调用图图表的工具怎么样，这就是[opengroup](http://www.opengroup.org/onlinepubs/000095399/utilities/cflow.html)（手册页）对 cflow 的看法。GNU版cflow自带源码，开源也...

希望这会有所帮助，最好的问候，汤姆。

# c++ - 为什么我会收到编译错误“ 未在此范围内声明”？

> ID：526817
> 
> 赞同：0
> 
> 时间：2009-02-09T00:57:29.187
> 
> 标签：c++, compilation

不久前，我的第一个 C++ 程序（这个）遇到了一些问题。基本上，我正在尝试为教授没有教我们语法的 C++ 课程的介绍做作业。这是我现在的代码：

```
#include <cstdlib>
#include <ctime>
#include <iostream>
#include <string>

using namespace std;
class Race
{
  public:
     void main()
     {

        executeRace();

        int randomMove()
        {
                srand(time(NULL));
                int randomInt = rand() % 100 + 1;
                return randomInt;
        }

        void executeRace()
        {
                int rabbitPosition = 1;
                int turtlePosition = 1;

                cout << "BANG!!!" << endl << "AND THEY'RE OFF!!!";

                while (rabbitPosition <=70 && turtlePosition <=70)
                {
                        printPositions(rabbitPosition, turtlePosition);

                        turtlePosition = turtleMoveSquares(turtlePosition);
                        rabbitPosition = rabbitMoveSquares(rabbitPosition);
                }

                printWinner(rabbitPosition, turtlePosition);

                tie(rabbitPosition, turtlePosition);
        }

        int turtleMoveSquares(int tPosition)
        {

                int turtleMove = randomMove();

                if(turtleMove >=1 && turtleMove <= 40)
                        tPosition = tPosition + 4;

                if(turtleMove >= 41 && turtleMove <= 50 )
                        tPosition = tPosition - 2;

                if(turtleMove >=51 && turtleMove <=100)
                        tPosition = tPosition + 2;

                if(tPosition < 1)
                        tPosition = 1;

                return tPosition;
        }

        int rabbitMoveSquares(int rabbitPosition)
        {

                int rabbitMove = randomMove();

                if(rabbitMove >=1 && rabbitMove <= 25)
                        rabbitPosition = rabbitPosition;

                if(rabbitMove >=26 && rabbitMove <= 55)
                        rabbitPosition = rabbitPosition + 10;

                if(rabbitMove >=56 && rabbitMove <=60)
                        rabbitPosition = rabbitPosition - 15;

                if(rabbitMove >=61 && rabbitMove <= 90)
                        rabbitPosition = rabbitPosition + 5;

                if(rabbitMove >=90 && rabbitMove <=100)
                        rabbitPosition = rabbitPosition - 3;

                if(rabbitPosition < 1)
                        rabbitPosition = 1;

                return rabbitPosition;
        }

        void printPositions(int rabbitPositions, int turtlePositions)
        {
                int turtleCount;
                int rabbitCount;
                int endCount;

                if(rabbitPositions == turtlePositions && rabbitPositions != 1)
                {
                        turtleCount = 1;

                        while(turtleCount < turtlePositions)
                        {
                                cout << "-";
                                turtleCount = turtleCount+1;
                        }
                        cout << "OUCH!";
                }

                else
                {
                        turtleCount = 1;
                        rabbitCount = 1;
                        endCount=1;

                        if(turtlePositions < rabbitPositions)
                        {
                                while(turtleCount < turtlePositions)
                                {
                                        cout <<  "-";
                                                turtleCount = turtleCount+1;
                                }
                                cout << "T";

                                while(rabbitCount < (rabbitPositions - turtlePositions))
                                {
                                        cout <<  "-";
                                        rabbitCount = rabbitCount+1;
                                }
                                cout << "H";

                        }

                        if(rabbitPositions < turtlePositions)
                        {
                                while(rabbitCount < rabbitPositions)
                                {
                                        cout << "-";
                                                rabbitCount = rabbitCount+1;
                                }
                                cout << "H";

                                while(turtleCount < (turtlePositions - rabbitPositions))
                                {
                                        cout << "-";
                                        turtleCount = turtleCount+1;
                                }
                                cout << "T";

                                cout << "\n";
                        }
                }
        }

        void printWinner(int rabbitPosition, int turtlePosition)
        {
                if(turtlePosition >= 70 && rabbitPosition < 70)
                {
                        cout << "TORTOISE WINS!!! YAY!!!\n";
                }
                else if(rabbitPosition >=70 && turtlePosition < 70)
                {
                        cout << "Hare wins. Yuch.\n";
                }
                else if(rabbitPosition >=70 && turtlePosition >=70)
                {
                        cout << "It's a tie\n";
                }
        }

        void tie(int turtlePosition, int rabbitPosition)
        {
                if(rabbitPosition >=70 && turtlePosition >=70)
                        executeRace();
        }

    }
};

int main()
{
  Race race;
  race.main();
  return EXIT_SUCCESS;
} 
```

这是我的编译错误：

```
uxb3% g++ o- Race Race.cc
g++: o-: No such file or directory
g++: Race: No such file or directory
Race.cc: In member function 'void Race::main()':
Race.cc:14: error: 'executeRace' was not declared in this scope
Race.cc:17: error: a function-definition is not allowed here before '{' token
Race.cc:24: error: a function-definition is not allowed here before '{' token
Race.cc:44: error: a function-definition is not allowed here before '{' token
Race.cc:64: error: a function-definition is not allowed here before '{' token
Race.cc:90: error: a function-definition is not allowed here before '{' token
Race.cc:153: error: a function-definition is not allowed here before '{' token
Race.cc:169: error: a function-definition is not allowed here before '{' token 
```

很抱歉一直在为这个任务打扰你们，但这是我的第一次，我现在非常非常沮丧和痴迷。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-09T01:00:57.573

你的函数中不能有[函数](http://i35.tinypic.com/2l8fbwl.jpg)*.

你可能想要这个：

```
#include <cstdlib>
#include <ctime>
#include <iostream>
#include <string>

using namespace std;
class Race
{
  public:
    int randomMove()
    {
            srand(time(NULL));
            int randomInt = rand() % 100 + 1;
            return randomInt;
    }

    void executeRace()
    {
            int rabbitPosition = 1;
            int turtlePosition = 1;

            cout << "BANG!!!" << endl << "AND THEY'RE OFF!!!";

            while (rabbitPosition <=70 && turtlePosition <=70)
            {
                    printPositions(rabbitPosition, turtlePosition);

                    turtlePosition = turtleMoveSquares(turtlePosition);
                    rabbitPosition = rabbitMoveSquares(rabbitPosition);
            }

            printWinner(rabbitPosition, turtlePosition);

            tie(rabbitPosition, turtlePosition);
    }

    int turtleMoveSquares(int tPosition)
    {

            int turtleMove = randomMove();

            if(turtleMove >=1 && turtleMove <= 40)
                    tPosition = tPosition + 4;

            if(turtleMove >= 41 && turtleMove <= 50 )
                    tPosition = tPosition - 2;

            if(turtleMove >=51 && turtleMove <=100)
                    tPosition = tPosition + 2;

            if(tPosition < 1)
                    tPosition = 1;

            return tPosition;
    }

    int rabbitMoveSquares(int rabbitPosition)
    {

            int rabbitMove = randomMove();

            if(rabbitMove >=1 && rabbitMove <= 25)
                    rabbitPosition = rabbitPosition;

            if(rabbitMove >=26 && rabbitMove <= 55)
                    rabbitPosition = rabbitPosition + 10;

            if(rabbitMove >=56 && rabbitMove <=60)
                    rabbitPosition = rabbitPosition - 15;

            if(rabbitMove >=61 && rabbitMove <= 90)
                    rabbitPosition = rabbitPosition + 5;

            if(rabbitMove >=90 && rabbitMove <=100)
                    rabbitPosition = rabbitPosition - 3;

            if(rabbitPosition < 1)
                    rabbitPosition = 1;

            return rabbitPosition;
    }

    void printPositions(int rabbitPositions, int turtlePositions)
    {
            int turtleCount;
            int rabbitCount;
            int endCount;

            if(rabbitPositions == turtlePositions && rabbitPositions != 1)
            {
                    turtleCount = 1;

                    while(turtleCount < turtlePositions)
                    {
                            cout << "-";
                            turtleCount = turtleCount+1;
                    }
                    cout << "OUCH!";
            }

            else
            {
                    turtleCount = 1;
                    rabbitCount = 1;
                    endCount=1;

                    if(turtlePositions < rabbitPositions)
                    {
                            while(turtleCount < turtlePositions)
                            {
                                    cout <<  "-";
                                            turtleCount = turtleCount+1;
                            }
                            cout << "T";

                            while(rabbitCount < (rabbitPositions - turtlePositions))
                            {
                                    cout <<  "-";
                                    rabbitCount = rabbitCount+1;
                            }
                            cout << "H";

                    }

                    if(rabbitPositions < turtlePositions)
                    {
                            while(rabbitCount < rabbitPositions)
                            {
                                    cout << "-";
                                            rabbitCount = rabbitCount+1;
                            }
                            cout << "H";

                            while(turtleCount < (turtlePositions - rabbitPositions))
                            {
                                    cout << "-";
                                    turtleCount = turtleCount+1;
                            }
                            cout << "T";

                            cout << "\n";
                    }
            }
    }

    void printWinner(int rabbitPosition, int turtlePosition)
    {
            if(turtlePosition >= 70 && rabbitPosition < 70)
            {
                    cout << "TORTOISE WINS!!! YAY!!!\n";
            }
            else if(rabbitPosition >=70 && turtlePosition < 70)
            {
                    cout << "Hare wins. Yuch.\n";
            }
            else if(rabbitPosition >=70 && turtlePosition >=70)
            {
                    cout << "It's a tie\n";
            }
    }

    void tie(int turtlePosition, int rabbitPosition)
    {
            if(rabbitPosition >=70 && turtlePosition >=70)
                    executeRace();
    }
};

int main()
{
  Race race;
  race.executeRace();
  return EXIT_SUCCESS;
} 
```

*当然，除非处理高级语言，例如微积分！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T01:01:54.933

编译器选项：

```
g++ -o Race Race.cc 
```

您还在 Race::main 函数中声明函数

```
class Race
{
  public:
     void main()
     {

        executeRace();
     } // <----- add this 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T01:00:45.780

我认为你应该使用`gcc -o ...`，而不是`gcc o- ...`。

其次，你不能用 C++ 中的函数来定义函数。

将另一个函数定义移到您的类之外`void main()`：特别是您需要将您之前的倒数第二个大括号`int main()`移到紧接之前`int randomMove()`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T01:02:09.783

您想要提取当前包含在 Race 中定义的 main() 函数中的各种函数（在其大括号内）。

选择它们，Ctrl-X（剪切），移动到 main() 声明的上方，Ctrl-V（粘贴）。重新格式化。重新编译。

# apache - 为什么在 Apache 中设置虚拟主机后，http://localhost 会重定向到我的默认虚拟主机？

> ID：526832
> 
> 赞同：7
> 
> 时间：2009-02-09T01:05:42.397
> 
> 标签：apache, http

这可能是一个简单的问题，但我想更好地了解 Apache 如何与虚拟主机一起工作。我正在设置虚拟主机，因为我同时在多个网站上工作并且我不想使用子目录。我几乎使用了默认的 Apache httpd.conf 文件，其中 DocumentRoot 指向类似“/www”的东西。我取消注释虚拟主机包括并添加以下内容：

```
名称虚拟主机 *:80

<虚拟主机 *:80>
    服务器名称 site1.dev
    DocumentRoot /www/site1
</虚拟主机>

<虚拟主机 *:80>
    服务器名称 site2.dev
    DocumentRoot /www/site2
</虚拟主机>

```

现在，当我访问[http://localhost](http://localhost)时，我得到了 site1 的默认页面。

我敢肯定这是有道理的，但我不太明白。我会认为只有明确发送到[http://site1.test](http://site1.test)的请求才会通过该指令进行路由，并且它不会成为默认值。有人可以解释为什么它成为默认值。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-09T01:10:46.643

[http://httpd.apache.org/docs/1.3/vhosts/name-based.html](http://httpd.apache.org/docs/1.3/vhosts/name-based.html)

（对于 2.x 也应该如此）

“如果没有找到匹配的虚拟主机，则将使用与 IP 地址匹配的第一个列出的虚拟主机。

因此，第一个列出的虚拟主机是默认虚拟主机。当 IP 地址与 NameVirtualHost 指令匹配时，将永远不会使用来自主服务器的 DocumentRoot。如果您想对不匹配任何特定虚拟主机的请求进行特殊配置，只需将该配置放入容器中，然后在配置文件中首先列出。”

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-09T11:01:13.697

答案 1 是正确的，我会添加 namevirtualhosts 因为第一个条目基本上匹配任何未命名的其他虚拟主机

它只能用于捕获无意的格式错误和中断的流量

即具有一个名为 john.domain.com 的机器运行 www.domain.com 和 www.domain2.com 作为 IP www.xxx.yyy.zzz 上的有效网络服务器可能具有像这样的最佳配置

```
 <VirtualHost *:80>
     DocumentRoot /var/webserver/static-sites/unknown/
    # a directory readable by apache with only a robots.txt denying everything
     ServerName bogus
     ErrorDocument 404 "/errordocuments/unknown-name.html"
    #custom 404 describing how/what they might have done wrong try pointing a browser {with a hosts file at http://bogus/ on 193.120.238.109 to see mine#
     ErrorLog /var/log/httpd/unknown-error.log
     CustomLog /var/log/httpd/unknown-access.log combined
    </VirtualHost>

    <VirtualHost *:80>
     DocumentRoot /var/webserver/static-sites/unknown/
    # a possibly different directory readable by apache with only a robots.txt denying everything
     ServerName www.xxx.yyy.zzz
     ServerAlias john.domain.com
     ErrorDocument 404 "/errordocuments/ip-name.html"
     ErrorDocument 403 "/errordocuments/ip-name.html"
    #custom 404 telling them as a likely hacker/bot you wish to have nothing to do with them see mine at http://193.120.238.109/
     ErrorLog /var/log/httpd/ip-error.log
     CustomLog /var/log/httpd/ip-access.log combined
    </VirtualHost>

    <VirtualHost *:80>
     ServerName domain.com
     RedirectPermanent / http://www.domain.com/
     ErrorLog logs/www.domain.com-error.log
     CustomLog logs/www.domain.com-access.log combined
    </VirtualHost>

    <VirtualHost *:80>
     DocumentRoot /var/webserver/ftpusers/domain
     ServerName www.domain.com
     ServerPath /domain
     ErrorLog logs/www.domain.com-error.log
     CustomLog logs/www.domain.com-access.log combined
    </VirtualHost>

    <VirtualHost *:80>
     ServerName domain2.com
     RedirectPermanent / http://www.domain2.com/
     ErrorLog logs/www.domain2.com-error.log
     CustomLog logs/www.domain2.com-access.log combined
    </VirtualHost>

    <VirtualHost *:80>
     DocumentRoot /var/webserver/ftpusers/domain2
     ServerName www.domain2.com
     ServerPath /domain2
     ErrorLog logs/www.domain2.com-error.log
     CustomLog logs/www.domain2.com-access.log combined
    </VirtualHost> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-11-08T18:03:03.910

确认对于 Apache 2.x，如果找不到匹配的虚拟主机，将使用第一个虚拟主机（具有相同的端口号）。

[http://httpd.apache.org/docs/2.2/vhosts/details.html](http://httpd.apache.org/docs/2.2/vhosts/details.html)

> “如果找不到匹配的虚拟主机，则请求从第一个虚拟主机提供，该虚拟主机具有匹配的端口号，该端口号位于客户端连接的 IP 列表中”

您可以随时在下方添加此代码，将其放在下方，`NameVirtualHost *:80`以便在未找到其他虚拟主机时默认为您的默认文档根目录提供服务。

```
<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /my/default/document/root
</VirtualHost> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-04-14T06:30:51.293

只需将此代码放在 httpd-vhosts.conf 的顶部即可

```
<VirtualHost localhost:80>
    ServerName localhost
    DocumentRoot d:/xampp/htdocs
    <Directory  "d:/xampp/htdocs/">
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Require local
    </Directory>
</VirtualHost> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-19T06:59:14.527

一种方法是：

1.  在您的 VirtualHosts 配置中，输入您要启用的特定本地站点名称，而不是使用通配符： `<VirtualHost site1.dev:80>`而不是`<VirtualHost *:80>`

2.  `NameVirtualHost *:80`可以通过在 vhosts.conf 文件中将其注释掉来关闭它

3.  在您的 /etc/hosts 文件中提及环回 IP 的两个别名： `127.0.0.1 localhost site1.dev`

就是这样。您应该会看到 localhost 像往常一样转到默认的 DocumentRoot，并且 site1.dev 转到您设置为虚拟主机的站点。

# text - 加入 12 列的最简单方法是什么？

> ID：526836
> 
> 赞同：0
> 
> 时间：2009-02-09T01:07:41.377
> 
> 标签：text, scripting, awk

我有 12 列由选项卡分隔。我怎样才能并排加入他们？

**[已添加]**您还可以告诉我其他方法，如 AWK：越快越好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-09T01:55:38.737

由于您专门询问了 awk（有更适合该工作的工具），因此以下是第一个解决方案：

```
awk '{print $1$2$3$4$5$6$7$8$9$10$11$12}' 
```

一个更复杂且可配置的解决方案是：您可以更改用于输出的列数：

```
awk -v lim=12 '{for(x=1;x<lim;x++){printf "%s",$x};print ""}' 
```

如果您不限于 awk，其他可能性是：

```
tr -d '\011'                     # to combine ALL columns on the line.
cut --output-delimiter='' -f1-12 # more general (1-12 or 3-7 or 1-6,9). 
```

根据您的编辑和评论，我建议 cut 是完成这项工作的最佳工具。使用“ `man cut`”、“ `info cut`”或“ `cut --help`”了解更多详细信息（这取决于您的平台）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-09T01:10:23.073

如果您只是使用 awk 连接列，我将使用 'tr' 并删除选项卡

```
cat file1 | tr -d '\011'>  file2 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T01:15:09.380

试试这个：

```
{
    print $1$2$3$4$5$6$7$8$9$(10)$(11)$(12)
} 
```

我不是`awk`天才，所以我不知道您是否可以使用某种循环结构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T01:56:54.473

好吧，这取决于您选择的编辑器/命令。但总的来说，它归结为什么都没有替换角色。例如，在 vim 中：“ `:%s/\t//g`”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-09T03:01:19.483

您没有提到您想使用什么工具，但是任何文本编辑器都可以将制表符替换为空字符，我想这会起作用，这就是我通常做的。

# syntax - 组装原型说明

> ID：526844
> 
> 赞同：1
> 
> 时间：2009-02-09T01:13:29.023
> 
> 标签：syntax, assembly, masm

我在 MASM32 Assembly 中写了一个作业，我几乎完成了它，但我有 2 个问题我似乎无法回答。首先，当我编译时，我收到消息：

> INVOKE 需要程序原型

&

> 无效的指令操作数

首先是由于这段代码：

```
.data?
Freq    DWORD ?
Time1   DWORD ?
Time2   DWORD ?

.code
start:
invoke QueryPerformanceFrequency, addr Freq
invoke QueryPerformanceCounter, addr Time1 
```

现在，我知道了

> INVOKE 指令必须在被调用过程的 PROTO 语句之前。

但即使我发现了 PROTO 语句的语法：

```
label PROTO [distance] [langtype] [,[parameter]:tag] 
```

我不明白我应该写什么才能使它工作，我什至不知道是什么导致了第二个错误或如何修复它......=/

* * *

**编辑**

我已经有了这些库，还有这些：

```
.386
.model flat, stdcall
option casemap :none

include \masm32\include\windows.inc
include \masm32\include\kernel32.inc
include \masm32\include\masm32.inc
includelib \masm32\lib\kernel32.lib
includelib \masm32\lib\masm32.lib 
```

我在 Windows Vista 下工作，以防万一也有帮助。

* * *

**编辑 2**

如果我在 .data 之后写 Freq :QWORD 我会收到以下错误消息：

> 使用假定为 ERROR 的寄存器

还有我应该在哪里添加

```
QueryPerformanceCounter PROTO :DWORD 
```

据我所知，这没有出错，但我仍然不确定是否有任何更改（我将它放在 .data 之前和库之后）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T01:21:40.563

为了调用外部 API，您需要包含适当的 *.inc 文件以及相应的 *.lib 文件。
尝试将这些语句添加到您的列表中：

```
include \masm32\include\kernel32.inc
includelib \masm32\lib\kernel32.lib 
```

（假设 \masm32 指的是您的 masm32 目录）

**更新：**
原型定义基本上告诉汇编器各个函数期望堆栈上有多少参数。在您的情况下，API 期望堆栈上有一个 32 位参数，原型如下所示：

```
QueryPerformanceCounter PROTO :DWORD 
```

**更新 2：**
为了使用性能计数器 API，您需要一个四字。原因是，API 需要一个指向四字（64 位）的指针作为参数（因此原型中的 DWORD）：

```
LOCAL Freq  :QWORD
invoke QueryPerformanceFrequency, ADDR Freq 
```

这应该可以解决问题。

**Update3：**
所以这是一个对我有用的完整示例：

```
 .486
    .model flat, stdcall
    option casemap :none

    include \masm32\include\windows.inc
    include \masm32\include\kernel32.inc
    include \masm32\include\masm32.inc

    includelib \masm32\lib\kernel32.lib
    includelib \masm32\lib\masm32.lib

    doPerf     PROTO

.code

start:

    invoke doPerf
    invoke ExitProcess,eax

    doPerf proc

        LOCAL Freq  :QWORD
        invoke QueryPerformanceFrequency, ADDR Freq
        mov esi, dword ptr Freq
        mov edi, dword ptr Freq+4

        ret

    doPerf endp

end start 
```

我想就是这样:) ESI 和 EDI 现在包含结果。

# .net - 捕获内存转储 - .NET

> ID：526846
> 
> 赞同：1
> 
> 时间：2009-02-09T01:13:59.460
> 
> 标签：.net, analysis, crash-dumps

寻找有关在用户在终端服务下运行时捕获内存转储的方法的建议。我曾尝试在 WinDbg 中使用“AdPlus”，但该应用程序在终端服务下运行，它似乎不喜欢这种组合。

这是一个 VB.NET 应用程序。

我的问题类似于[用于分析 .NET 应用程序内存转储的工具，](https://stackoverflow.com/questions/48148/tool-for-analyzing-net-app-memory-dumps)但需要允许应用程序在没有外部对话框的终端服务下运行。我在安静模式下尝试了 WinDbg，但它使会话崩溃。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-09T01:34:48.630

adplus 在终端服务下应该可以正常工作——我们经常这样使用它。您究竟是如何尝试使用它的。

使用终端服务会话要注意的一件事是会话本身是否有空闲超时。我们经常通过终端服务部分将客户附加到我们的服务中，然后想知道为什么服务在一小时后就死了。对此的解决方案是强制终端服务连接使用控制台会话（mstsc 命令行上的 /console）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-09T04:14:43.113

由于 adplus 从命令行运行，如果您注销或终端服务会话超时，脚本将停止。

一种可以考虑的可能性是使用 DebugDiag，它作为“本地系统”作为服务运行，因此它不依赖于登录的交互式用户会话。

您可以将服务配置为定期安排内存转储，并稍后在 DebugDiag 的另一个组件中查看/分析结果，所有这些都可以通过脚本进行自定义。

有用的链接和下载：

[http://blogs.msdn.com/sukeshak/pages/ddintro.aspx](http://blogs.msdn.com/sukeshak/pages/ddintro.aspx)

[http://blogs.msdn.com/tess/archive/2009/01/23/net-hang-analyzing-debug-diag-output.aspx](http://blogs.msdn.com/tess/archive/2009/01/23/net-hang-analyzing-debug-diag-output.aspx)

[http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en](http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en)

# .net - 是否可以从 WCF IDataContractSurrogate 实现中读取请求标头？

> ID：526854
> 
> 赞同：1
> 
> 时间：2009-02-09T01:18:45.423
> 
> 标签：.net, wcf, web-services, rest

我有一个正在[WCF中开发的](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)[RESTful 服务](http://msdn.microsoft.com/en-us/netframework/cc950529.aspx)。我正在公开一个没有可序列化类型的合同，因此我使用 DataContractSurrogate（的实现）来创建可以使用.[`IDataContractSurrogate`](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.idatacontractsurrogate.aspx)[`DataContractSerializer`](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractserializer.aspx)

我的问题是，如何访问 DataContractSurrogate 类中的请求/响应标头？

在服务中，可以通过简单地使用[`WebOperationContext`](http://msdn.microsoft.com/en-us/library/system.servicemodel.web.weboperationcontext.aspx)和在客户端[`WebOperationContext`](http://msdn.microsoft.com/en-us/library/system.servicemodel.web.weboperationcontext.aspx)中访问相同的[`OperationContextScope`](http://msdn.microsoft.com/en-us/library/system.servicemodel.operationcontextscope.aspx)对象，该对象可以通过对当前 WCF 通道 ( [`IContextChannel`](http://msdn.microsoft.com/en-us/library/system.servicemodel.icontextchannel.aspx)) 的引用来创建。

[`OperatoinContextScope`](http://msdn.microsoft.com/en-us/library/system.servicemodel.operationcontextscope.aspx)如果我能够在其中获得对 WCF 通道的引用，我可以创建一个，[`IDataContractSurrogate.GetDeserializedObject`](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.idatacontractsurrogate.getdeserializedobject.aspx)但我也不知道该怎么做。

有任何想法吗？

* * *

**@casperOne**：
我想在 DataContractSurrogate 实现中获取标头值，因为要将代理项转换为目标类型，我需要引用工厂对象单例池中的条目。

像这样的东西：

```
SingletonFactoryPool.Factories[factoryIdFromHeader].CreateTargetType(surrogateValues); 
```

由于其他原因，我已经在标题中传递了我需要的数据，如果我可以从标题中读取值似乎会更干净。不过，您的观点是有效的，我可以轻松地在代理中传递相同的数据。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-09T03:49:00.507

如果您需要访问数据合同中的通道，我会说您的课程设计不正确。您的合同应该是自包含的，并且不依赖于通过通道传递消息时使用的标头值。

您始终可以创建一个扩展（有许多领域可以这样做），它将采用反序列化的实例，然后将您需要添加的标头信息添加到其中。

当然，您总是可以创建一个单独的对象，它是反序列化实例（通过参数传递）和标头信息的混合物。

# c++ - 我应该如何部署 MFC 应用程序？

> ID：526855
> 
> 赞同：1
> 
> 时间：2009-02-09T01:18:50.523
> 
> 标签：c++, visual-studio, visual-studio-2008, winapi, mfc

我在 VS 2008 Express 中创建了一个应用程序作为 MFC 应用程序，只是为了利用简单的 GUI 创建。我可能会在纯 win32 中重新执行此应用程序，因为没有使用其他 MFC 类（只是一个按钮和一个文本框，按钮触发主程序，所有 win32）。我唯一决定我是留在 MFC 还是将其移植到纯 win32 的问题是：

部署 MFC 应用程序有多难？我需要做什么（在 VS 2008 中）以确保它在另一台机器上工作？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-09T01:27:10.287

静态链接MFC，它只是另一个.exe。
您可以将其提供给用户，或者使用 microsoft .msi 工具或常规 setup.exe 创建安装程序，例如[innosetup](http://www.jrsoftware.org/)。

编辑 - 您评论中的错误消息是关于属于 3rd 方库的另一个 dll。您不能（轻松）获取 DLL 并将其合并到您的应用程序中。许可还可能要求您将其 DLL 作为单独的库提供。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-10T15:53:22.387

您可以使用 Visual Studio 合并模块。这些可以在构建安装程序时添加。合并模块提供运行应用程序所需的所有 dll、文件。

# vim - 如何让 Vim 对文件名进行正常的（类似 Bash 的）制表符补全？

> ID：526858
> 
> 赞同：302
> 
> 时间：2009-02-09T01:19:45.373
> 
> 标签：vim

当我在 Vim 中打开一个新文件并使用制表符完成时，它会完成整个文件名，而不是像 Bash 那样进行部分匹配。有没有一个选项可以让这个文件名选项卡完成更像 Bash？

* * *

## 回答 #1

> 赞同：434
> 
> 时间：2009-02-09T02:02:20.107

我个人使用

```
set wildmode=longest,list,full
set wildmenu 
```

当您键入第一个选项卡时，它将尽可能完成。第二个标签点击将提供一个列表。第三个和后续选项卡将循环显示完成选项，因此您无需其他键即可完成文件。

bash-like 只是

```
set wildmode=longest,list 
```

不过满了就很得心应手了。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2012-11-04T04:25:59.323

最接近 Bash 完成的行为应该是

```
set wildmode=longest:full,full 
```

键入几个字符后，按一次 Tab 将给出所有可用的匹配项**`wildmenu`**。[这与Michael](https://stackoverflow.com/a/526940/1057593)的答案不同，后者在命令行下方打开了一个类似 quickfix 的窗口。

然后您可以继续输入其余字符或再次按 Tab 以自动完成第一个匹配项并围绕它圈出。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2016-09-01T08:21:43.673

除了建议的 wildmode/wildmenu，Vim 还提供了使用`Ctrl`+显示所有可能完成的选项`D`。这对于一些在 Vim 中搜索不同的自动完成选项时偶然发现这个问题的用户可能会有所帮助，就像我一样。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-09T02:16:58.730

如果您不想设置wildmenu，您可以在要打开文件时随时按`Ctrl`+ 。+将完成文件名，如 Bash 完成。`L``Ctrl``L`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-09T01:30:41.993

我假设您在 Vim 中通过`Ctrl`+使用自动完成功能`N`来搜索当前缓冲区。当你使用这个命令时，你会得到一个解决方案列表；只需重复该命令即可转到列表中的下一项。所有自动完成命令也是如此。当他们填写整个单词时，您可以继续浏览列表，直到找到您想要使用的单词。

这可能是一个更有用的命令：`Ctrl`+ `P`。唯一的区别是`Ctrl`+`P`在缓冲区中向后搜索而`Ctrl`+`N`向前搜索...实际上，它们都将提供具有相同元素的列表，并且它们可能只是以不同的顺序出现。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-07-11T15:25:50.883

`set wildmode=longest:full`给你一个类似 Bash 的完成：

*   单行建议
*   选项卡仅完成确定的内容
*   右/Ctrl-n | 左/Ctrl-p 选择建议。

[![所描述功能的预览](https://i.stack.imgur.com/upRoT.gif)](https://i.stack.imgur.com/upRoT.gif)

从帮助：

```
If you prefer the <Left> and <Right> keys to move the cursor instead
of selecting a different match, use this:
      :cnoremap <Left> <Space><BS><Left>
      :cnoremap <Right> <Space><BS><Right> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-09T01:34:39.677

尝试使用`:set wildmenu`. 除此之外，我不确定您到底在尝试什么。

哦，是的，也许试试这个链接：[link](http://vim.wikia.com/wiki/Using_bash_completion_with_ctags_and_Vim)

# php - 在图像标签的 src 中放置一个 php 脚本是否比正常速度慢？

> ID：526863
> 
> 赞同：2
> 
> 时间：2009-02-09T01:22:52.370
> 
> 标签：php, image, header

如果我把这个标签放在我的 HTML 中：

```
<img src="http://server/imageHandler.php?image=someImage.jpg" /> 
```

代替

```
<img src="http://server/images/someImage.jpg" /> 
```

并使用 imageHandler.php 脚本读取图像文件，输出过期标题并打印图像数据，我希望它会更慢。这是一种操纵图像标题的可行方法，还是因为图像无处不在，所以性能损失太大。还有其他方法可以通过我的 php 代码在图像上设置过期标头吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-09T01:32:13.143

是的，运行任何 PHP 脚本都比提供静态文件慢。

相反，您可以使用 Apache 配置指令设置过期标头。请参阅[`mod_expires`](http://httpd.apache.org/docs/2.2/mod/mod_expires.html). 例如，您可以将以下指令放在 Apache httpd.conf 或 .htaccess 文件中：

```
# enable expirations
ExpiresActive On
# expire JPG images after a month in the client's cache
ExpiresByType image/jpg A2592000 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T01:28:09.473

尝试类似的东西

```
header("Expires: <the date>");
http_send_file("someImage.jpg"); 
```

来自[http://us3.php.net/manual/en/function.http-send-file.php](http://us3.php.net/manual/en/function.http-send-file.php) http_send_file 函数（如果它按照我认为的方式工作）将文件直接从磁盘复制到网络接口，所以它发送图像本身的速度与服务器本身的速度一样快。（当然，运行 PHP 解释器所花费的时间仍然会使整个请求比提供静态文件慢一点。）

正如至少一个其他答案所提到的，如果您正在运行 Apache，设置 Expires 标头（或任何其他标头）的最佳方法可能是使用`.htaccess`文件，或者如果您可以访问主配置文件则更好服务器，把过期配置放在那里。看看[mod_expires](http://httpd.apache.org/docs/2.2/mod/mod_expires.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T01:29:39.453

如果图像处理程序使用 GD 或 Imagick，它将比常规的 img 标签慢得多。

我建议将图像输出缓存到一个临时文件，如果该文件存在，则图像处理程序只输出该原始数据，但如果应该创建一个新文件，则生成一次，然后再次用于缓存。

您可以使用 htaccess 设置到期时间。

[.htaccess 缓存](http://www.askapache.com/htaccess/speed-up-sites-with-htaccess-caching.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T01:28:35.743

这将取决于 imageHandler.php 执行的任务。您可以通过在代码中以毫秒为单位打印时间来测量它。

# asp.net - Resource.axd 文件 - 为什么这么多，为什么这么大？

> ID：526864
> 
> 赞同：0
> 
> 时间：2009-02-09T01:23:07.300
> 
> 标签：asp.net, javascript, ajax, asp.net-ajax

ASP.NET - 通过使用 ajax ToolkitScriptManager 控件，我设法显着减少了我的页面发出的 .axd 请求的数量。

我现在的问题是，为什么这些 .axd 文件中有这么多 JavaScript？我说的是大约。~1MB（未压缩）只是为了在页面上使用一些 Ajax 控件！

有没有办法让这个更精简/更小？

是否有一些特殊的配置方法可以使其更小？

我猜 ASP.NET 试图只包含它需要的 js，所以我可以关闭任何东西以减少代码的体积吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-09T01:59:59.130

您可以[压缩](http://www.codeplex.com/MbCompression).axd 文件以使它们更小。

# java - Zxing 编译错误

> ID：526866
> 
> 赞同：0
> 
> 时间：2009-02-09T01:24:08.220
> 
> 标签：java, compiler-errors, g1gc

由于我不拥有用于开发目的的 G1，因此我正在尽力使用模拟器。这就是说，我正在尝试使用 ZXing（Zebra Zrossing）库扫描我的 sdCard 中的 JPEG 图像或 PNG 图像。

我试图更改 Android 项目中的代码，所以它会从 sdCard 中的图像扫描，而不是从相机扫描，没有任何运气。

我接下来所做的可能是我问题的根源。

我尝试在一个新的 Android 项目中使用 JAVASE 代码为“修改后的”CommandLineRunner 提供图像，事情是这样的：

Eclipse 将构建该项目，但不会运行它。虚拟机日志向我抛出了这条消息：

> **02-08 20:47:45.916: WARN/dalvikvm(619): VFY: 无法解析静态方法 939: Ljavax/imageio/ImageIO;.read (Ljava/io/File;)Ljava/awt/image/BufferedImage ; 02-08 20:47:45.926: WARN/dalvikvm(619): VFY: 在 0x0004 拒绝操作码 0x71 02-08 20:47:45.926: WARN/dalvikvm(619): VFY: 拒绝 Lcom/magoco/fread/FRead； .decode2 (Ljava/io/File;Ljava/util/Hashtable;Ljava/lang/String;)Ljava/lang/String; 02-08 20:47:45.926: WARN/dalvikvm(619): Verifier 拒绝类 Lcom/magoco/fread/FRead；02-08 20:47:45.926: WARN/dalvikvm(619): 类初始化在 newInstance 调用中失败 (Lcom/magoco/fread/FRead;) 02-08 20:47:45.926: DEBUG/AndroidRuntime(619): 关闭VM 02-08 20:47:45.926: WARN/dalvikvm(619): threadid=3: thread exiting with uncaught exception (group=0x40010e28) 02-08 20:47:45.937: ERROR/AndroidRuntime(619): Uncaught handler:

我在网上搜索了答案，有人说这是 Dalvikvm 上的常见错误，因为可能存在预编译的类或库（真的，在 Eclipse 之外）并且 VM 无法使用它。

我在主要活动中发布我的代码：

```
package com.magoco.fread;

import java.awt.image.BufferedImage;
import java.io.BufferedInputStream;
import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.Hashtable;

import javax.imageio.ImageIO;
import javax.imageio.ImageReader;
import javax.imageio.stream.ImageInputStream;

import android.app.Activity;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.widget.TextView;

import com.google.zxing.DecodeHintType;
import com.google.zxing.MonochromeBitmapSource;
import com.google.zxing.MultiFormatReader;
import com.google.zxing.ReaderException;
import com.google.zxing.Result;
import com.google.zxing.client.result.ParsedResult;
import com.google.zxing.client.result.ResultParser;

public class FRead extends Activity {
    /** Called when the activity is first created. */
    @Override

public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);
    TextView tv = (TextView) this.findViewById(R.id.BarcodeResult);
    try {
        tv.setText(this.decodeOneArgument2("", false));
    } catch (Exception e) {
        e.printStackTrace();
    }
}

public String decodeOneArgument2(String argument, boolean dumpResults)
        throws Exception {
    String barcode = "";
    // File inputFile = new File(argument);
    File inputFile = new File("sdcard/dcim/pueblo.JPG");

    /* TESTING THAT I'VE GOT A FILE */
    System.out.println("FILE " + inputFile.toString());

    // decode(new URI(argument), hints);
    decode2(inputFile, null, barcode);
    return barcode;

}

public String decode2(File f, Hashtable<DecodeHintType, Object> hints,
        String barcode) throws IOException {

    /* IF I COMMENT THE NEXT LINE, IT RUNS BUT OF COURSE NO RESULT */
    BufferedImage image;
    try {
        image = ImageIO.read(f);
    } catch (IllegalArgumentException iae) {
        throw new FileNotFoundException("Resource not found: " + f);
    }
    try {
        MonochromeBitmapSource source = new BufferedImageMonochromeBitmapSource(
                image);
        Result result = new MultiFormatReader().decode(source, hints);
        ParsedResult parsedResult = ResultParser.parseResult(result);
        barcode = " format: " + result.getBarcodeFormat()+ result.getText() + "\nParsed result:\n"+ parsedResult.getDisplayResult();
        System.out.println(" format: " + result.getBarcodeFormat()+ result.getText() + "\nParsed result:\n"+ parsedResult.getDisplayResult());
        //return result;
    } catch (ReaderException e) {
        System.out.println(": No barcode found");
        return null;
    }
    return barcode;
} 
```

}

提前致谢

monn3t

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-17T10:01:48.953

海，我试图从条形码中提取数据，这些是我遵循的步骤。

1.下载ZXing 1.3并解压。

2.通过设置属性，将提取的zxing floder中的core/src和androidtest/src添加到android应用程序中。使用此链接设置属性，[http ://groups.google.com/group/zxing/browse_thread/thread/7d8693e6e42408f2](http://groups.google.com/group/zxing/browse_thread/thread/7d8693e6e42408f2)

现在包括以下代码，

```
package payoda.android.zxingApp;
import android.app.Activity;
import android.database.CursorJoiner.Result;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.widget.TextView;
import com.google.zxing.BarcodeFormat;
import com.google.zxing.MonochromeBitmapSource;
import com.google.zxing.MultiFormatReader;
import com.google.zxing.Reader;
import com.google.zxing.ReaderException;
import com.google.zxing.qrcode.QRCodeReader;
import com.google.zxing.client.androidtest.*;
import com.google.zxing.common.BaseMonochromeBitmapSource;

public class ZXingApplication1 extends Activity 
{
  TextView tv;
  com.google.zxing.Result result;

  public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);
    tv=(TextView)findViewById(R.id.text);
    Bitmap bitmap = BitmapFactory.decodeResource(getResources(),R.drawable.bar2); 
    MultiFormatReader reader1=new MultiFormatReader();//For all barcode formats
    QRCodeReader reader=new QRCodeReader();//Only for QRCode format

   try 
    {

       result=reader1.decode(new RGBMonochromeBitmapSource(bitmap));
       tv.setText(result.getText());
    } 
    catch (Exception e) 
    {   
        tv.setText("Within Catch block");
     } 
  }
 } 
```

这可能会对您有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-09T13:32:50.120

这是来自相关项目的肖恩。

您正在尝试在 Android 中使用用于 Java SE 的代码。Java SE 中的一些库不在 Android 中，例如 ImageIO。

查看 android/ 中的代码，它使用 Android 特定的类来加载图像。

# asp.net-mvc - ASP.NET MVC 框架中的缓存

> ID：526867
> 
> 赞同：9
> 
> 时间：2009-02-09T01:25:27.047
> 
> 标签：asp.net-mvc, caching, c#-3.0, castle-windsor

我在使用 ASP.NET MVC 框架方面相当陌生，并希望在缓存 MVC Web 应用程序的各个部分时能找到一些关于最佳实践的帮助。我知道堆栈溢出使用 MVC 和一些非常棒的缓存技术，而且它的 MILES 比我的应用程序快，即使在本地运行时也是如此。

我有几个问题。

1.  缓存实际上是如何工作的，您如何“启用”它，以及各种选项是什么。最好使用哪种缓存？

2.  我的应用程序有很多数据库事务，经常更改的列表。我担心页面刷新的及时性，因为用户没有获得最新版本的数据。在 Web 应用程序速度和显示“最新”数据之间取得平衡的最佳方法是什么？你们在处理这个问题时发现了哪些最佳实践？

3.  如何使用不同的缓存设置缓存不同的部分（我假设视图）？我认为它可以用子控制器来完成，但我有 NFI 如何去做这件事。

4.  我正在使用 Castle.Windor 与控制器的集成，我不确定这是否会改变任何东西。

5.  任何其他需要注意/小心的注意事项的最佳实践将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-09T01:47:01.410

您可能想查看[Phil Haack 的帖子](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx)，了解一些甜甜圈缓存。他是 ASP.NET MVC 的参考 :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T02:18:58.010

从“最佳实践”的角度来看，您需要考虑在任何使用缓存的应用程序中必须考虑的相同事项。

*   流量是否足以从缓存中受益？
*   特定数据多久更改一次？时效性有多重要？
*   我是否拥有数据访问层？如果是这样，我可以通过实际更改数据来触发缓存中的刷新并避免基于时间的过期吗？

而这样的例子不胜枚举。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T01:40:32.860

您可以使用 OutputCache 属性轻松缓存视图。我也使用 nHibernate 缓存机制缓存任何不经常更新的列表。

# flash - 在 Flash 中创建旋转视频墙

> ID：526873
> 
> 赞同：1
> 
> 时间：2009-02-09T01:27:36.540
> 
> 标签：flash, actionscript-3

关于如何在 Flash中创建类似于[Microsoft 的“我是 PC”的旋转视频墙的任何想法？](http://imapc.lifewithoutwalls.com/)Microsoft 网站上的一个是在 Silverlight 中完成的。我是 Flash 和 AS3 的新手，因此非常感谢任何指导和建议。

谢谢，

雅克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T01:38:41.303

您可以[从这里开始，](http://www.lemlinh.com/flash-source-3d-curve-wall/)因为包含源代码。请参阅[演示](http://www.lemlinh.com/demoflash/gallery/3d_curve_wall_1715/flashmo_098_3d_curve_wall.swf)。

您还可以使用[Papervision3D](http://blog.papervision3d.org/)并查看提供的示例来构建您自己的墙。

您也可以考虑仅使用 javascript 和图像（或画布），例如 Google 地图。有人试[了一下，看看这个](http://www.yango.co.uk/blog/?p=3)。

**// 还：**

完成将缩略图拼接在一起后，只需在单击其中一个图像时在新（场景|图层）中打开视频播放器。有一些用于 FLV 视频的视频播放器。Adobe Flash 中包含一个可以[自定义的](http://www.adobe.com/devnet/flash/articles/custom_flvcomp.html)[FLVPlayback 组件](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/video/FLVPlayback.html)，但也有一些开源组件：[Flash-Ajava Video Component](http://labs.adobe.com/wiki/index.php/Flash-Ajax_Video_Component)、[FLV Player](http://flv-player.net/)或[OS FLV](http://www.osflv.com/)。

# cocoa-touch - 使用 TouchXML 获取 Cocoa 中元素的值

> ID：526887
> 
> 赞同：12
> 
> 时间：2009-02-09T01:34:16.167
> 
> 标签：cocoa-touch, touchxml

由于 NSXML 在实际 iPhone 上的给定限制，我正在使用 TouchXml。无论如何，我刚刚开始使用 Objective-C，我来自 C# 背景，并且想学习一些新的东西..无论如何.. 这是我的 xml 文件...

```
<?xml version="1.0" encoding="utf-8"?>
<FundInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://tempuri.org/webservices">
  <FundsReleaseDate>2009-02-11T00:00:00</FundsReleaseDate>
  <FundValue>7800</FundValue>
  <FundShares>1000</FundShares>
</FundInfo> 
```

我正在尝试获得 7800，即 FundValue。有人能指出我正确的方向吗，我正在使用 TouchXml CXMLDocument 并且 myParser 是 CXMLDocument 类型，我已经尝试过

```
NSArray *nodes = [myParser nodesForXPath:@"//FundInfo" error:&err]; 
```

基本上节点评估为零

```
if ([nodes count] > 0 ) {
    amount = [nodes objectAtIndex:1];
} 
```

更新 1：我已经放弃使用 XPath 进行解析，并将其替换为 NSURLRequest，所以现在我将整个 XML 放在一个字符串中，但我对 Objective-C 的粗鲁介绍仍在继续……我刚刚意识到我对.NET BCL，Regex 之类的东西很容易获得。

UPDATE2：我已经弄清楚如何使用 RegexKitLite 进行正则表达式。

所以现在的问题是，我如何从 FundValue 中得到“7800”，它现在是一个大字符串。我已经通过使用 NSLog 编写它来确认我在我的 NSString 中有它。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-09T01:52:37.370

问题是您的 XML 有一个名称空间，这意味着您的 XPath 实际上并不匹配。不幸的是，没有默认映射，而且 XPath 实际上并没有定义一种在内部处理这个问题的好方法，所以您不能简单地通过更改 XPath 来修复它。相反，您需要告知解释器您希望如何将其映射到 XPath 中。

看起来 TouchXML 通过以下方式实现了对此的支持：

```
- (NSArray *)nodesForXPath:(NSString *)xpath namespaceMappings:(NSDictionary *)inNamespaceMappings error:(NSError **)error; 
```

因此，您可以尝试以下操作：

```
NSDictionary *mappings = [NSDictionary dictionaryWithObject:@"http://tempuri.org/webservices" forKey:@"tempuri"];
[myParser nodesForXPath:@"//tempuri:FundInfo" namespaceMappings:mappings error:&err]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-15T23:46:34.337

我有一个类似的问题。对指定了命名空间 (xmlns="http://somenamespace") 的 XML 进行任何选择都将导致找不到节点。考虑到它确实支持额外的命名空间格式，例如 xmlns:somenamespace="http://somenamespace"，这很奇怪。

在任何情况下，*到目前为止*，最简单的做法是进行字符串替换并将 xmlns="http://tempuri.org/webservices 替换为空字符串。

总的来说我喜欢touchxml，但我不敢相信这个bug仍然存在。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-09T01:50:11.730

尝试

```
NSArray *nodes = [myParser nodesForXPath:@"/FundInfo/*" error:&err]; 
```

# asp.net-mvc - 用于 ASP.NET MVC 应用程序的最佳 OpenId API

> ID：526890
> 
> 赞同：46
> 
> 时间：2009-02-09T01:35:11.203
> 
> 标签：asp.net-mvc, openid

我正在开发一个 ASP.NET MVC 应用程序，我想使用 OpenId。

什么是最好的选择？

*   DotNetOpenId
*   RPX
*   其他？？？

有谁知道 StackOverflow 使用什么？登录 UI 是定制开发的，还是由 API/服务提供的？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-02-09T01:40:42.140

我们在 Stack Overflow 上使用了优秀的 DotNetOpenId 库：

> [http://code.google.com/p/dotnetopenid/](http://code.google.com/p/dotnetopenid/)

现在搬到：

> [http://www.dotnetopenauth.net/](http://www.dotnetopenauth.net/)

我们*最初*的登录 UI 是由[ID Selector](http://www.idselector.com/)提供的，但我们已经推出了自己的极简版本。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-09T05:53:05.780

我将支持 DotNetOpenId 的推荐，并添加对[openid-selector](http://code.google.com/p/openid-selector/)（idselector 的开源版本）的推荐

# ruby-on-rails - 为什么 Ruby on Rails 不推荐使用脚手架方法

> ID：526891
> 
> 赞同：4
> 
> 时间：2009-02-09T01:35:23.947
> 
> 标签：ruby-on-rails, ruby

我正在学习 Ruby on Rails，所以我相信我迟早会发现这一点。

为什么在 Rails 版本 2 中不推荐使用脚手架方法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-09T01:47:09.363

脚手架方法违背了脚手架的精神，它旨在为您提供一个起点，您应该根据自己的需要进行构建。通过动态生成脚手架，您无需编辑任何内容。

脚手架生成器的新方法允许您编辑脚手架文件，以便您可以使用它来构建您实际需要的内容。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-09T01:49:04.227

我假设您指的是动态脚手架，因为脚手架生成器仍然存在并且很强大。

David Heinemeier Hansson 在记录中说动态脚手架在演示中看起来很棒，但是由于动态脚手架的全部目的是教人们使用 Rails，因此在一行代码中将其抽象出来更像是诅咒而不是祝福，因为没有人在生产代码中使用动态脚手架。. . 仅用于演示和教程。

如果您手边有 AWDWR 的副本，您可以阅读他在最新（第 3 版）中关于 p81 的完整解释（我不想复制粘贴）。

您仍然可以：脚本/生成脚手架模型名称来生成您的脚手架模型。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-09T01:48:02.310

然而，仍然有一个 Rails 插件可以做之前脚手架方法所做的事情。它被称为[ActiveScaffold](https://github.com/activescaffold/active_scaffold)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T01:42:00.577

因为人们认为它应该用于生产，这将是一个可怕的想法。相反，您会生成一个脚手架，然后您可以轻松地对其进行编辑并从那里准备好生产。

# installation - 在Wix中，升级产品时，如何决定安装旧版本的机器的文件覆盖和保存？

> ID：526892
> 
> 赞同：4
> 
> 时间：2009-02-09T01:38:12.757
> 
> 标签：installation, wix

例如，我不想覆盖配置文件和其他一些文件，我应该使用 WiX 做什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T20:26:19.063

假设您的文件只是 text/xml，则 MSI 的默认行为会注意到它们是无版本的，并且自上次安装以来已更改，因此升级时将跳过它们。请参阅[MSI 文件替换逻辑](http://blogs.msdn.com/astebner/archive/2005/08/30/458295.aspx)。

现在，如果您的配置文件在版本之间发生了更改（添加/删除了一些选项），您需要做一些事情来升级文件，同时保存以前编辑的值。这有点棘手。

看看： [StackOverflow - 使用 wix 管理配置文件](https://stackoverflow.com/questions/357911/manage-configuration-files-with-wix)

如果这是应用程序的用户设置，我倾向于同意上面帖子中的 Rob Mensching（主要的 WiX 人）的观点，最好让应用程序处理自己的配置和更新。

但是，如果它是服务的配置文件或不应该写入其自己的配置文件的东西，这将无法正常工作。您通常需要编写自定义操作来手动处理这种情况。娱乐时间。;)

# jquery - jQuery，最好的工作方式 捕获 <select> 更改事件的最佳方法是什么？我有一个具有不同输入元素的表单，但我只想在 <select> 更改的情况下触发一个事件。我不想使用 ID，因为表单上有很多选择。提前谢谢了！对于这样的选择： <select id="item_select" name="item"> <option>选择一个项目</option> <option value="1">Item 1</o

> ID：526895
> 
> 赞同：4
> 
> 时间：2009-02-09T01:39:36.200
> 
> 标签：jquery

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-09T01:50:54.393

如果您只希望页面中的*某些*选择具有更改事件，则可以向它们添加一个类，如下所示：

```
<select class='choose_me'>...</select>

<!-- later on in the page... -->

<select class='choose_me'>...</select> 
```

然后您可以通过执行以下操作从其中任何一个中捕获更改事件：

```
$('select.choose_me').change(function() { .... } ); 
```

如果要选择所有这些，只需将选择器更改为

```
$('select').change(function() { }); 
```

在函数内部，您可以使用 引用选择元素`$(this)`，因此代码如下：

```
$('select.choose_me').change(function() {
    alert($(this).val());
}); 
```

将提醒任何`<select>`标签的选定选项具有`choose_me`on change 类。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T01:42:32.213

对于这样的选择：

```
<select id="item_select" name="item"> 
    <option>Select an Item</option> 
    <option value="1">Item 1</option> 
    <option value="2">Item 2</option> 
    <option value="3">Item 3</option> 
</select> 
```

您执行以下操作：

```
 <script type="text/javascript"> 

    $(document).ready(function(){ 
        $("#item_select").change(function() 
        { 
// do your stuff

        }); 
    }); 
    </script> 
```

现在，如果您不想使用 id（尽管表单中的每个选择都可以有其单独的 ID），您还可以使用任何其他 CSS 选择器，例如 ("form select:first-child")

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-11T12:07:21.887

接受和建议的答案缺少一个重要点：如果用户使用键盘（例如箭头键或字母）导航选项框，则不会捕获更改。

您需要再添加一个事件，即“keydown”，并将其绑定到控件。

像这样的东西：

> > ```
> > $('select.foo').bind('change keyup',function() {
> >     // do something amazingly clever like  
> >     alert($(this).val());
> > }); 
> > ```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T01:47:28.710

您可以使用选择器“select”，如下所示：

```
$("select").change(function () {

}); 
```

并且您可以使用生成事件的选择

```
$(this) 
```

# c# - SMS 的 .NET 代码

> ID：526898
> 
> 赞同：7
> 
> 时间：2009-02-09T01:40:43.373
> 
> 标签：c#, sms

大家好。

我正在编写一些代码来通过 Zeep Mobile ( [http://zeepmobile.com/developers/](http://zeepmobile.com/developers/) ) 发送/接收 SMS 消息。

我查看了他们的谷歌群组，甚至联系了他们的支持人员，但他们一直不太擅长回复，我现在真的是瞎了眼。

我必须与他们整合（工作需要它），我不确定我的代码为什么不起作用。所以，我想知道是否有人有任何他们不介意共享的 C# .Net 代码，以便我可以将其集成到我的应用程序中。

当然，这完全取决于您是否有使用 Zeep 的经验。如果您希望我发布我的代码，我也可以这样做。让我知道。

谢谢，我非常感谢您的帮助。

**

## 编辑：我已经在这里添加了源代码，以防有人能帮忙！

**

请原谅草率的代码。它只是我为了测试 Zeep 而拼凑起来的东西，我希望有人可以试一试。（.Net 3.5 控制台应用程序，以防您要构建它）。

```
using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Linq;
using System.Text;
using System.Net;
using System.Net.Sockets;
using System.Net.Security;
using System.Web;
using System.Web.Handlers;
using System.IO;
using System.Security.Cryptography;
using System.Security.Cryptography.X509Certificates;

namespace ConsoleApplication1
{

    class Program
    {
        public static string API_KEY = "MY_API_KEY";
        public static string SECRET_ACCESS_KEY = "MY_SECRET_KEY";
        public static string PATTERN_RFC1123 = "ddd, dd MMM yyyy HH:mm:ss " + "GMT";

        static void Main(string[] args)
        {
            // URL for sending message - 
            //      send_message = "https://api.zeepmobile.com/messaging/2008-07-14/send_message";
            //      blast_message = "https://api.zeepmobile.com/messaging/2008-07-14/blast_message";
            string apiurl = "https://api.zeepmobile.com/messaging/2008-07-14/blast_message";

            // FORMAT must be Sun, 06 Nov 1994 08:49:37 GMT
            string http_date = DateTime.UtcNow.ToString("r");
            // Text to send
            string body = HttpUtility.UrlEncode("Test message.", System.Text.Encoding.UTF8);
            // NOTE: Use 'user_id=22&body=' instead of just 'body=' when sending a message to a user.
            // 22 is a user I have previously registered with ZEEP and is used for testing purposes.
            string parameters = "body=" + body; 
            // String that will be converted into a signature.
            string canonicalString = API_KEY + http_date + parameters;

            //------------START HASH COMPUTATION---------------------
            // Compute the Base64 HMACSHA1 value
            HMACSHA1 hmacsha1 = new HMACSHA1(SECRET_ACCESS_KEY.ToByteArray());

            // Compute the hash of the input file.
            byte[] hashValue = hmacsha1.ComputeHash(canonicalString.ToByteArray());

            String b64Mac = hashValue.ToBase64String();
            String authentication = String.Format("Zeep {0}:{1}", API_KEY, b64Mac);
            //-----------END HASH COMPUTATION------------------------

            // We are using TCPClient instead of an HTTPWebRequest because we need to manually
            // set the "Headers" such as Date, Authorization etc which cannot easily be done with HTTPWebRequest.
            Uri reqUrl = new Uri(apiurl);
            TcpClient client = new TcpClient(reqUrl.Host, reqUrl.Port);
            NetworkStream netStream = client.GetStream();
            // SSLStream is used for secure communication. ZEEP requires the use of SSL to send and SMS.
            System.Net.Security.SslStream sslStream = new System.Net.Security.SslStream(
                netStream, 
                false, 
                new System.Net.Security.RemoteCertificateValidationCallback(ValidateServerCertificate));
            sslStream.AuthenticateAsClient(reqUrl.Host);

            // POST content we are going to transmit over the SSL channel. 
            // See. http://zeepmobile.com/developers/documentation/messaging/2008-07-14/rest_api#send_message
            System.IO.StreamWriter s = new System.IO.StreamWriter(sslStream);
            s.WriteLine(String.Format("POST {0} HTTP/1.1", "/api/blast"));
            s.WriteLine(String.Format("Host: {0}", "api.zeepmobile.com"));
            s.WriteLine(String.Format("Authorization: Zeep {0}:{1}", API_KEY, b64Mac));
            s.WriteLine(String.Format("Date: {0}", http_date));
            s.WriteLine(String.Format("Content-Type: {0}", "application/x-www-form-urlencoded"));
            s.WriteLine(String.Format("Content-Length: {0}", parameters.Length));
            s.WriteLine(String.Format("{0}", parameters));
            s.Flush();

            System.IO.StreamReader r = new StreamReader(sslStream);
            string resp = r.ReadToEnd();
            Console.WriteLine(resp);
            r.Close();

        }

        // The following method is invoked by the RemoteCertificateValidationDelegate.
        // We want to make sure the SSL has no Policy errors and is safe.
        public static bool ValidateServerCertificate(
              object sender,
              X509Certificate certificate,
              X509Chain chain,
              SslPolicyErrors sslPolicyErrors)
        {
            if (sslPolicyErrors == SslPolicyErrors.None)
                return true;

            Console.WriteLine("Certificate error: {0}", sslPolicyErrors);

            // Do not allow this client to communicate with unauthenticated servers.
            return false;
        }

    }

    public static class Extensions
    {
        public static byte[] ToByteArray(this string input)
        {
            UTF8Encoding encoding = new UTF8Encoding();
            return encoding.GetBytes(input);
        }

        public static string ToBase64String(this byte[] input)
        {
            return Convert.ToBase64String(input);
        }
    }
} 
```

## 错误

运行此代码时发生的错误如下图所示。

![替代文字](https://aboutdev.files.wordpress.com/2009/02/error400.jpg)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-09T20:53:24.570

## 解决方案：

好的。我昨晚一直在努力，我取得了一些进展。我使用 Fiddler 构建 POST 消息，以查看我上面的内容与服务器预期的内容之间的任何差异。

我已经让它发送消息并返回 HTTP 200 OK 响应。同样，这段代码还没有准备好生产，它只是用来测试看看我是否能让 Zeep 工作。感谢所有回复的人，如果您正在寻找 ZEEP 代码，我希望这可以帮助您。

* * *

```
using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Linq;
using System.Text;
using System.Net;
using System.Net.Sockets;
using System.Net.Security;
using System.Web;
using System.Web.Handlers;
using System.IO;
using System.Security.Cryptography;
using System.Security.Cryptography.X509Certificates;

namespace ConsoleApplication1
{
    class Program
    {
        public static string API_KEY = "YOUR_API_KEY_GOES_HERE! INCLUDE DASHES!";
        public static string SECRET_ACCESS_KEY = "YOUR_SECRET_KEY_GOES_HERE!";

        static void Main(string[] args)
        {
            Console.WriteLine("BLAST - \r\n\r\n");
            BlastTcpPost();

            Console.WriteLine("SEND - \r\n\r\n");
            SendTcpPost();
        }

        /// <summary>
        /// Send a BLAST to all users in your ZEEP account.
        /// </summary>
        public static void BlastTcpPost()
        {
            SendSMS(
                "https://api.zeepmobile.com/messaging/2008-07-14/blast_message",    // URL for Send_Message 
                "You are on blast",                                                 // Message to send
                string.Empty                                                        // No UserId to send.
                );
        }

        /// <summary>
        /// Send a single message to a user in your ZEEP account.
        /// </summary>
        public static void SendTcpPost()
        {
            // Note:- 22 I use for the UserId is just a user I have signed up. Yours may be different and you 
            // might want to pass that in as a parameter.

            SendSMS(
                "https://api.zeepmobile.com/messaging/2008-07-14/send_message",     // URL for Send_Message
                "You are a user...good job!",                                       // Message to send
                "22"                                                                // User Id in your system.
                );

        }

        /// <summary>
        /// Uses a TCPClient and SSLStream to perform a POST.
        /// </summary>
        /// <param name="requestUrl">URL that the POST must be directed to.</param>
        /// <param name="body">Message that is to be sent.</param>
        /// <param name="user">UserId in your Zeep System. Only required if your sending a Single Message to a User. 
        /// Otherwise, just send a string.Empty.</param>
        /// <returns>Response from the server. (although it will write the response to console)</returns>
        public static string SendSMS(string requestUrl, string body, string user)
        {
            string parameters = "";
            string requestHeaders = "";
            string responseData = "";

            // FORMAT must be Sun, 06 Nov 1994 08:49:37 GMT
            string http_date = DateTime.UtcNow.ToString("r");

            // Clean the text to send
            body = HttpUtility.UrlEncode(body, System.Text.Encoding.UTF8);

            if (user.Length > 0) parameters += "user_id=" + user + "&";
            if (body.Length > 0) parameters += "body=" + body;

            // String that will be converted into a signature.
            string canonicalString = API_KEY + http_date + parameters;

            //------------START HASH COMPUTATION---------------------
            // Compute the Base64 HMACSHA1 value
            HMACSHA1 hmacsha1 = new HMACSHA1(SECRET_ACCESS_KEY.ToByteArray());

            // Compute the hash of the input file.
            byte[] hashValue = hmacsha1.ComputeHash(canonicalString.ToByteArray());

            String b64Mac = hashValue.ToBase64String();
            String authentication = String.Format("Zeep {0}:{1}", API_KEY, b64Mac);
            //-----------END HASH COMPUTATION------------------------

            string auth = String.Format("Zeep {0}:{1}", API_KEY, b64Mac);

            System.Uri uri = new Uri(requestUrl);
            System.Net.Sockets.TcpClient client = new System.Net.Sockets.TcpClient(uri.Host, uri.Port);
            string requestMethod = "POST " + uri.LocalPath + " HTTP/1.1\r\n";

            // Set Headers for the POST message
            requestHeaders += "Host: api.zeepmobile.com\r\n";
            requestHeaders += "Authorization: " + auth + "\r\n";
            requestHeaders += "Date: " + DateTime.UtcNow.ToString("r") + "\r\n";
            requestHeaders += "Content-Type: application/x-www-form-urlencoded\r\n";
            requestHeaders += "Content-Length: " + parameters.ToByteArray().Length + "\r\n";
            requestHeaders += "\r\n";

            // Get the data to be sent as a byte array.
            Byte[] data = System.Text.Encoding.UTF8.GetBytes(requestMethod + requestHeaders + parameters + "\r\n");
            // Send the message to the connected TcpServer.
            NetworkStream stream = client.GetStream();

            // SSL Authentication is used because the Server requires https.
            System.Net.Security.SslStream sslStream = new System.Net.Security.SslStream(
                stream,
                false,
                new System.Net.Security.RemoteCertificateValidationCallback(ValidateServerCertificate));
            sslStream.AuthenticateAsClient(uri.Host);

            // Send the data over the SSL stream.
            sslStream.Write(data, 0, data.Length);
            sslStream.Flush();

            // Receive the TcpServer.response.
            for (int i = 0; i < 100; i++)
            {
                if (stream.DataAvailable)
                {
                    break;
                }
                System.Threading.Thread.Sleep(100);
            }

            Byte[] bytes = new byte[1024];
            System.Text.StringBuilder sb = new System.Text.StringBuilder();
            while (stream.DataAvailable)
            {
                int count = sslStream.Read(bytes, 0, 1024);
                if (count == 0)
                {
                    break;
                }
                sb.Append(System.Text.Encoding.UTF8.GetString(bytes, 0, count));
            }

            responseData = sb.ToString();
            Console.WriteLine(responseData);
            // Close everything.
            client.Close();

            return responseData;
        }

        // The following method is invoked by the RemoteCertificateValidationDelegate.
        // We want to make sure the SSL has no Policy errors and is safe.
        public static bool ValidateServerCertificate(
              object sender,
              X509Certificate certificate,
              X509Chain chain,
              SslPolicyErrors sslPolicyErrors)
        {
            // Somehow the cert always has PolicyErrors so I am returning true regardless.
            return true;
            //if (sslPolicyErrors == SslPolicyErrors.None)
            //    return true;

            //Console.WriteLine("Certificate error: {0}", sslPolicyErrors);

            //// Do not allow this client to communicate with unauthenticated servers.
            //return false;
        }
    }

    public static class Extensions
    {
        public static byte[] ToByteArray(this string input)
        {
            UTF8Encoding encoding = new UTF8Encoding();
            return encoding.GetBytes(input);
        }

        public static string ToBase64String(this byte[] input)
        {
            return Convert.ToBase64String(input);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T07:25:50.830

您确定需要使用 a`TcpClient`和 an在代码中手动实现 HTTP 协议`SslStream`以与 Zeep 通信吗？我会尝试只使用一个`HttpWebRequest`对象，让 .NET Framework 为您处理 HTTP 特定的协议位。特别是因为您返回的错误消息似乎指向您发送的请求的方向，远程服务器无法理解。

（在 HTTP 标头和实际内容之间不需要额外的空行吗？我真的不记得*了*，如果我只是做正确的 .NET Framework 就不必这样做`WebRequest`......）

祝你好运！

# iis - Web 服务和报表管理器不加载（Sql Server Express 2008 with Reporting Services）

> ID：526903
> 
> 赞同：1
> 
> 时间：2009-02-09T01:43:19.700
> 
> 标签：iis, sql-server-2008, reporting-services, sql-server-2008-express

我刚刚安装了 Microsoft SQL Server Express 2008（带有 Reporting Services）。我的安装与 SQL Server 2005 并行。

到目前为止，在开发环境中创建报告和测试它们工作正常，但是我无法让 Web 服务器或报告管理器正常工作。

在 Reporting Services 配置管理器中，它们似乎已配置并具有工作地址（例如：[http://mymachine:8080/ReportServer_EXPRESS2008/](http://mymachine:8080/ReportServer_EXPRESS2008/)和[http://mymachine:8080/Reports_EXPRESS2008/](http://mymachine:8080/Reports_EXPRESS2008/)）。

虚拟目录在 IIS 中不存在，单击配置管理器中的链接会导致“找不到页面”。

如果我在 IIS 中创建虚拟目录，然后使用 Reporting Services 配置管理器修改这两个站点，则 Reporting Services 配置管理器似乎工作正常（出现所有正确的消息，表明它创建了新站点并删除了旧站点成功地）。但是，它只会删除现有的虚拟目录，而不会创建新的虚拟目录。

**以前有没有人遇到过这个问题和/或知道可能的解决方案？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-09T02:16:35.270

基本上，Reporting Services 2008 不再使用 IIS。

巧合（或默认？），我已经让 IIS（使用 Reporting Services 2005）在端口 8080 上运行。Reporting Services 2008 也想在端口 8080 上运行。

在这种情况下，新的 IIS 免费地址保留系统似乎不起作用。**更改端口号可以解决问题。**

# sql-server - 如何使用外部数据源有效地更新数据库？

> ID：526905
> 
> 赞同：0
> 
> 时间：2009-02-09T01:45:16.920
> 
> 标签：sql-server, database

我正在尝试使用来自多个数据源（即 LDAP 和其他一些 MS SQL 数据库）的信息在 MS SQL 数据库中填充用户信息。该流程需要作为每日定时任务运行，以保证用户信息表的频繁更新。

这个查询/更新脚本的最初尝试是用 VBScript 编写的，它将查询每个数据源，然后更新用户信息表。不幸的是，这需要很长时间来运行和更新用户信息表。

我很好奇是否有人写过类似的东西，以及您是否推荐或注意到通过用另一种语言编写脚本来提高性能。有些人因为多线程而推荐 Perl，但如果有人对改进流程或其他方法有任何其他建议，您可以分享技巧或经验教训。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T02:16:37.360

使用数据转换服务 (DTS) 或 SSIS 是一种很好的做法，因为它以执行重复的数据库任务而闻名。虽然这不能解决您的问题，但它可能会为您提供一些指示，因为您可以记录流程的每个阶段，将其包装在事务中等。它特别适合批量加载和更新，并且它理解 VBScript原生所以那里应该没有问题。

除此之外，我必须同意 Brian 的观点，找出导致它变慢的原因并修复它，更改语言不太可能自行修复它，特别是如果你有一个潜在的问题。一般来说，我在使用非常小的 LDAP 时的经验是，它可能是非常慢的阅读器批量用户详细信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-09T01:48:46.333

嗯。似乎您可以 cron 使用来自各种来源的转储实用程序的脚本，然后将输出转换为目标数据库的加载实用程序的良好格式。该脚本可以是 bash 或 Perl，等等。

编辑：在性能方面，我认为您要尝试的第一件事是确保在加载过程开始时禁用任何自动提交，然后在写入所有记录后发出提交。这可以产生巨大的性能差异。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T01:57:56.593

我无法告诉您如何解决您的特定问题，但是每当您遇到这种情况时，您都想在尝试解决它之前找出它为什么很慢。减速在哪里？需要考虑和调查的一些主要事项包括：

*   获取数据
*   与网络交互
*   查询数据库
*   更新数据库中的索引

获取一些时间和分析信息，以找出集中精力的地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T22:43:42.120

正如 MrTelly 所说，使用 SSIS 或 DTS。然后安排程序包运行。仅转换为这一点可能会解决您的速度问题，因为他们有针对批量插入优化的任务。无论如何，我永远不会用脚本语言而不是 t-SQl 来做到这一点。您的脚本可能会逐行运行，而不是在数据集上运行，但这只是一个猜测。

# database-design - 创建的表与通过添加列创建的表之间是否存在性能差异？

> ID：526908
> 
> 赞同：1
> 
> 时间：2009-02-09T01:47:18.320
> 
> 标签：database-design, alter-table

快速提问，我很好奇一次性定义的数据库表和随着时间的推移添加了列的数据库表之间是否有任何区别。增加列性能的那一个会在某种程度上受到影响吗？

无论如何，数据库供应商在这里并不太相关，除非这种情况下存在供应商差异。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-09T02:02:17.423

这里*存在*供应商差异。SQL 语言是由标准定义的，但存储细节留给每个供应商来实现。

例如，在 MySQL 中，当您添加一列时，数据库引擎会复制整个表，为每一行的新列腾出空间。一旦它复制了所有行，它就会删除表的旧副本。因此，新表的存储方式与您从一开始就使用新列定义它一样。但是您必须等待副本完成才能`ALTER TABLE`返回（如果表很大，这可能需要很长时间）。

在另一个品牌的数据库中（尽管我没有想到），添加一列可能会将额外的列与原始表分开存储。这将有助于快速添加新列，但检索数据会受到数据断开部分的影响。大概您以后可以告诉数据库引擎对表进行“碎片整理”并将所有列放在一起。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T23:54:32.090

在 Oracle 中，您可以将空列添加到现有的填充表中，除了表结构的逻辑重新定义之外，基本上不会发生任何事情。但是，当您填充这些列时，这当然可能在添加列时发生，然后行必须扩展，并且您可能会遇到一些问题，即某些行在包含它们的块中没有足够的可用空间，在这种情况下它们将被迁移到不同的块，指针留在原始位置（因此索引不受影响，因为它们继续指向原始位置）。

因此，如果您将填充的列添加到其中包含行的表中，那么您可能希望重命名原始表并执行“create table as select”来创建和填充新版本。索引、触发器、特权等当然也必须迁移。但是，如果表不是太大，您可以添加填充的列，由于行迁移而降低性能，然后执行表移动以重新组织它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T02:00:34.527

这将完全取决于存储引擎。一般来说，我会对添加的列感到非常满意，也许是在向它们扔一个 OPTIMIZE TABLE 之后。

# vim - 有没有办法在行尾粘贴一些东西？

> ID：526913
> 
> 赞同：1
> 
> 时间：2009-02-09T01:50:03.727
> 
> 标签：vim

有没有办法在行尾粘贴一些东西？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-09T01:53:16.090

按 将光标移动到行尾，`$`然后按`p`粘贴。

# c# - 这种自定义的 DateTime 格式是否会在其他文化中中断？

> ID：526918
> 
> 赞同：0
> 
> 时间：2009-02-09T01:51:18.840
> 
> 标签：c#, datetime, formatting, culture

显示我的 DateTime 值时，我希望它们的格式如下：“February 9, 2009 7:00 AM”

我正在使用以下代码，但担心日期在其他文化中可能显示不正确。谁能告诉我是否是这种情况，如果是这种情况，我该如何解决？

```
Date.ToString("MMMM dd, yyyy hh:mm tt"); 
```

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-09T03:59:21.963

> 我正在使用以下代码，但担心日期在其他文化中可能显示不正确。

究竟什么是“正确”？您是普通的客户端应用程序吗？如果是这样，您将获得本地化的月份名称。那是“不正确的”吗？取决于你在寻找什么。

如果您*确实*希望在客户端应用程序中使用区域设置友好的时间，那么使用默认的长日期格式将为您提供最流畅的结果。在我的语言环境中，我不希望看到 12 小时制或前一个月，尽管我肯定会理解它。

如果您是服务器端应用程序，您不想使用任何默认本地化的任何内容，因为语言环境将是您的服务器而不是您的用户，并且您将遇到一个奇怪的可移植性问题。在这种情况下，您必须允许用户选择他们自己的语言环境，或者使用您自己的日期格式化函数和内置的英文月份名称。

（或者，为了避免这个问题，没有月份名称。在这种情况下，ISO-8601 格式“YYYY-mm-dd HH:MM:SS”将是默认选择。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T11:29:33.840

我更喜欢 ISO 8601 格式（是的，没有“T”）：您不必根据谁在读取您的数据而在不同的表示之间进行权衡。更少的代码，更少的错误。

我一直在寻找最初用英文写成的文件，这些文件被“翻译”了，但日期保持“原样”，因此完全错误。

作为额外的奖励，ISO 格式的日期排序就像普通字符串一样！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T02:07:50.780

为什么不简单地使用用户的长日期/时间格式？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T02:08:51.527

编码

```
 DateTime now=DateTime.Now;
        foreach(CultureInfo inf in CultureInfo.GetCultures( CultureTypes.InstalledWin32Cultures))
        {
            Console.WriteLine(now.ToString("MMMM dd, yyyy hh:mm tt", inf.DateTimeFormat));
        } 
```

返回
Tlhakole 09, 2009 04:21 AM
guovvamanu 09, 2009 04:21
goevten 09, 2009 04:21
veljaca 09, 2009 04:21
kuovamaanu 09, 2009 04:21
Hatun puquy 09, 2009 04:21 am
guovva 04:21
ta?lvvmannu 09, 2009 04:21
Chwefror 09, 2009 04:21 am
二月 09, 2009 04:21
guovvamano 09, 2009 04:21
Hui-tanguru 09, 2009 04:21 am
Hatun puquy 09, 2009 04 :21 2009 年 2
月 9 日 04:21

我的意思是，这在他的代码中显示了每种文化

# excel - 为什么 Microsoft Excel 中仍有行数限制？

> ID：526921
> 
> 赞同：57
> 
> 时间：2009-02-09T01:53:01.003
> 
> 标签：excel, row-number, limits

在 Office 2007 之前，Excel 最多有 65,000 行。Office 2007 将其增加到最多 100 万行，这当然更好；但我很好奇——为什么会有限制？显然，随着电子表格大小的增加，性能会呈指数级下降；但是通过从一张小表格开始并仅根据需要动态“重新调整大小”来让 Excel 对此进行优化并不难。考虑到将限制从 65K 增加到 100 万必须做多少工作，为什么他们不一直这样做，所以它只受到可用内存和磁盘空间量的限制？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-09T02:54:36.193

可能是因为优化。Excel 2007 最多可以有 16 384 列和 1 048 576 行。奇怪的数字？

14 位 = 16 384、20 位 = 1 048 576

14 + 20 = 34 位 = 一个以上的 32 位寄存器可以保存。

但他们还需要存储单元格的格式（文本、数字等）和格式（颜色、边框等）。假设他们使用两个 32 位字（64 位），他们使用 34 位作为单元编号，并使用 30 位用于其他事物。

为什么这很重要？在内存中，他们不需要分配整个电子表格所需的所有内存，而只需分配数据所需的内存，并且每个数据都被标记在它应该位于的单元格中。

**2016 年更新：**

找到[Microsoft 的 Excel 2013 和 2016 规范的链接](https://support.office.com/en-us/article/Excel-specifications-and-limits-ca36e2dc-1f09-4620-b726-67c00b05040f)

*   打开的工作簿：受可用内存和系统资源的限制
*   工作表大小：1,048,576 行（20 位）乘 16,384 列（14 位）
*   列宽：255 个字符（8 位）
*   行高：409 点
*   分页符：水平和垂直 1,026 个（意外的数字，可能是错误的，10 位是 1024）
*   一个单元格可以包含的字符总数：32,767 个字符（有符号 16 位）
*   页眉或页脚中的字符：255（8 位）
*   工作簿中的工作表：受可用内存限制（默认为 1 个工作表）
*   工作簿中的颜色：1600 万种颜色（32 位，可完全访问 24 位色谱）
*   工作簿中的命名视图：受可用内存限制
*   独特的单元格格式/单元格样式：64,000（16 位 = 65536）
*   填充样式：256（8 位）
*   线宽和样式：256（8 位）
*   独特的字体类型：1,024（10 位）全局字体可供使用；每个工作簿 512
*   工作簿中的数字格式：200 到 250 之间，具体取决于您安装的 Excel 的语言版本
*   工作簿中的名称：受可用内存限制
*   工作簿中的窗口：受可用内存限制
*   工作表中的超链接：66,530 个超链接（意外数量，可能是错误的。16 位 = 65536）
*   窗口中的窗格：4
*   链接表：受可用内存限制
*   场景：受限于可用内存；摘要报告仅显示前 251 个场景
*   在场景中更改单元格：32
*   求解器中的可调整单元格：200
*   自定义功能：受可用内存限制
*   缩放范围：10% 到 400%
*   报告：受可用内存限制
*   排序参考：单次排序64个；使用顺序排序时不受限制
*   撤消级别：100
*   数据表单中的字段：32
*   工作簿参数：每个工作簿 255 个参数
*   过滤器下拉列表中显示的项目：10,000

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-09T02:03:16.673

一句话—​​—速度。多达一百万行的索引适合 32 位字，因此可以在 32 位处理器上高效使用。适合 CPU 寄存器的函数参数非常有效，而较大的函数参数需要在每次函数调用时访问内存，这是一个慢得多的操作。更新电子表格可能是一项涉及许多单元格引用的密集操作，因此速度很重要。此外，Excel 团队希望处理超过一百万行的任何人都将使用数据库而不是电子表格。

# sharepoint - Sharepoint 优化结果控件仅使用当前页面值

> ID：526929
> 
> 赞同：0
> 
> 时间：2009-02-09T01:57:56.827
> 
> 标签：sharepoint, search

我的人员搜索结果页面上有一个[SharePoint 优化搜索结果控件](http://msdn.microsoft.com/en-us/library/microsoft.office.server.search.webcontrols.refinesearchresults_members.aspx)。对搜索结果进行分页。该控件仅优化当前页面结果。

如何更改此行为，以便尽管对核心结果进行分页，但精炼结果适用于所有结果？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-14T05:50:38.627

不幸的是，它无法完成。排序和细化仅适用于为页面返回的结果，如搜索核心结果 Web 部件 XSLT 中定义的那样。这也是一个真正的耻辱。但是，如果您的点击次数永远不会超过 50 并且您将最大项目设置为 50，那么您将得到您想要的。:-)

# .net - F# 命名约定

> ID：526930
> 
> 赞同：19
> 
> 时间：2009-02-09T01:59:38.163
> 
> 标签：.net, f#, naming-conventions

F# 是否有“官方”命名/大小写约定？

我总是怀疑是否使用 C# 风格：

```
Class.MyFunctionName or Module.my_function_name 
```

在 F# 中，您需要混合 BCL 类和 F# 库类：它们具有不同的大小写，并且代码看起来非常难看。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-06-11T23:35:22.697

是的，存在混淆，因为多年来 F# 已经从 OCaml 演变为 .Net。基本上，命名约定是一个“重大变化”——旧代码与新代码不一致。

然而，2009 年 5 月的 CTP 已经解决了这个问题。

发行[说明](http://blogs.msdn.com/dsyme/archive/2009/05/20/detailed-release-notes-for-the-f-may-2009-ctp-update-and-visual-studio-2010-beta1-releases.aspx)说...

**标准库命名约定**

> F# 库采用的命名约定如下：
> 
> *   根据现有的 .NET 指南，所有 .NET 和 F# OO 代码都使用 PascalCase
>     
>     
> *   F# 函数式编程运算符（例如 List.map）用于 F# 内部实现代码。这种代码使用驼峰式命名运算符名称
>     
>     
> *   不应使用下划线。

**所以，你的问题...**

```
Class.MyFunctionName or Module.my_function_name 
```

答案是

> Class.MyFunctionName 和 Module.MyFunctionName （**但请参阅下面的编辑！**）

（适用上述规则 1）。

- 编辑。2019年11月2日——

当前的[指南](https://docs.microsoft.com/en-us/dotnet/fsharp/style-guide/formatting#use-camelcase-for-module-bound-public-functions)建议在模块级别的函数中使用 camelCase，所以它是

> Module.myFunctionName

然后使生产代码与 F# 库一致（例如 List.averageBy）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2019-08-16T13:20:15.753

我认为自当前接受答案的时间以来答案可能已经改变。

今天的[F# 风格指南](https://docs.microsoft.com/en-us/dotnet/fsharp/style-guide/)说：

> **对类型声明、成员和标签使用 PascalCase**
> 
> 类、接口、结构、枚举、委托、记录和有区别的联合都应该用 PascalCase 命名。记录和区分联合的类型和标签中的成员也应该使用 PascalCase。
> 
> ```
> type IMyInterface =
>     abstract Something: int
> 
> type MyClass() =
>     member this.MyMethod(x, y) = x + y
> 
> type MyRecord = { IntVal: int; StringVal: string }
> 
> type SchoolPerson =
>     | Professor
>     | Student
>     | Advisor
>     | Administrator 
> ```

[https://docs.microsoft.com/en-us/dotnet/fsharp/style-guide/formatting#use-pascalcase-for-type-declarations-members-and-labels](https://docs.microsoft.com/en-us/dotnet/fsharp/style-guide/formatting#use-pascalcase-for-type-declarations-members-and-labels)

和

> **将 camelCase 用于模块绑定的公共函数**
> 
> 当模块绑定函数是公共 API 的一部分时，它应该使用 camelCase: F#
> 
> ```
> module MyAPI =
>     let publicFunctionOne param1 param2 param2 = ...
> 
>     let publicFunctionTwo param1 param2 param3 = ... 
> ```

[https://docs.microsoft.com/en-us/dotnet/fsharp/style-guide/formatting#use-camelcase-for-module-bound-public-functions](https://docs.microsoft.com/en-us/dotnet/fsharp/style-guide/formatting#use-camelcase-for-module-bound-public-functions)

因此，基于这些，我的回答是：

```
Class.MyFunctionName 
Module.my_function_name 
```

应该这样写：

```
Class.MyFunctionName  
Module.myFunctionName 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-09T02:45:32.593

任何官方消息：我认为“还没有”，但每当 VS 2010 达到 Beta1 时，您可能会看到 F# 库接近最终的形式，并且相对于 CTP 会有一些重命名。考虑到它的历史，F# 可能总是比它的老 .NET 表亲更精神分裂。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T21:13:21.080

我的理解和当前用法是模块/静态函数具有小写字母，而“实例”函数具有大写字母。

**编辑**不是这个问题的答案，而是相关的：Don Syme 的[F# Formatting conventions](http://research.microsoft.com/fsharp/expert-fsharp-draft/FormattingConventions.doc)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-09T02:04:28.933

从我从 hubfs.com 和其他来源看到的情况来看，它是 .net 和 OCaml 的混合体。

我希望他们切换到其中一个而不是有两种不同的约定，并且作为微软，我相信他们会采用点网风格。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-09T18:33:30.507

不确定是否有任何真正的解决方案。似乎 OCaml 风格的代码可能会保留一些命名方式，即小写模块方法，而 OO 成员将采用 .NET 风格。

# html - 为什么要使用条件样式表？

> ID：526941
> 
> 赞同：4
> 
> 时间：2009-02-09T02:02:20.467
> 
> 标签：html, css

这个问题涵盖了大部分内容，但我试图向想要完全放弃条件样式表（IE6、移动设备等）的高级开发人员提出一个清晰的论点。请记住，我们实际上并没有消除 IE6，只是样式表。

还是我疯了，应该接受这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-09T02:07:20.673

什么是替代方案？CSS 黑客？

我有 IE7 和 IE6 的条件样式表。这为这些特定浏览器划分了修复程序。进行更改时，它可以轻松地让您在标准浏览器中测试/修复，在 IE7 中测试/修复，然后在 IE6 中测试/修复。测试流程更自然。它不违反标准，很容易，而且基本上是免费的。解释为什么*不*使用它们更有意义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T02:38:36.667

您可能想查看[Yahoo 重置 CSS 库](http://developer.yahoo.com/yui/reset/)。在我完成的许多项目中，它消除了对条件样式表的需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T02:05:27.107

你不应该。通过足够的工作，两种流行的浏览器都可以以相同的方式呈现页面。以[我](http://www.zi255.com)的为例 - 同时复杂而简单。

[编辑：将“从不”更改为“你不应该”，以为标题写的是“何时”]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T02:05:42.223

如果您可以在没有条件样式表的情况下满足您的需求，那么无论如何最好为所有浏览器提供一个样式表。但是，如果您不能在不丢失功能的情况下做到这一点，那么必须提出一个很好的论据来证明使用单个样式表是合理的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-09T02:45:22.923

因为 IE 6 和 IE 7 以各种众所周知的方式被破坏。*将修复*模块化的条件样式表是处理这些中断的最简单且受支持的方法。

当您说您的高级开发人员想要“放弃”条件样式表时，这到底是什么意思？

# sharepoint - SharePoint 资源字符串位于何处

> ID：526946
> 
> 赞同：4
> 
> 时间：2009-02-09T02:03:48.997
> 
> 标签：sharepoint, resources, master-pages, page-layout

我有一个页面布局，PeopleSearchResults.aspx 由其他人编写。它包含以下用于[SharePoint 优化人员搜索结果控件](http://msdn.microsoft.com/en-us/library/microsoft.office.server.search.webcontrols.refinesearchresults.aspx)的标记。

```
Title="<%$Resources:sps,RefineByTitle%>" 
```

在地球/SharePoint 上，我在哪里寻找代码引用的字符串？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T07:28:48.560

> SharePoint 资源字符串位于何处。

预配资源位于..\12\Resources中的**12 个配置单元中。**

12 Hive 是最常见的目录：*C:\Program Files\Common Files\Microsoft Shared\web server extensions\12*。

因此，要回答您的问题，假设您的 sharepoint 安装在驱动器 C 上，请查看***C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\Resources***文件夹。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-21T21:17:59.643

您指定的特定文件 sps.resx 实际上位于 12\CONFIG\Resources 中（但在 12\Resources 中还有很多其他文件）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T13:20:53.853

="<%$Resources:sps,RefineByTitle%>"

sps (.resx) 是 12\Resources 中资源文件的名称（如果您支持多种语言，可能会有几个带有额外位的文件，例如 .en-us.resx、fr-fr.resx 等），RefineByTitle 是该文件中语言条目的键。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-15T02:40:01.593

此外，请查看您网站的 App_GlobalResources 文件夹。（由 IIS 管理器确定）

# python - python控制台中断？和跨平台线程

> ID：526955
> 
> 赞同：0
> 
> 时间：2009-02-09T02:07:21.687
> 
> 标签：python, multithreading, console, quit

我希望我的应用程序在 python 中循环，但有办法退出。有没有办法从控制台获取输入，扫描字母 q 并在我的应用程序准备退出时快速？在 C 中，我只会创建一个等待 cin、扫描、锁定全局退出变量、更改、解锁和退出线程的 pthread，从而允许我的应用程序在完成转储文件或正在执行的操作时退出。我是否在 python 中以相同的方式执行此操作，它会是跨平台的吗？（我在 python 中看到了一个特定于 Windows 的全局单个实例）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T02:47:34.260

使用 threading 模块创建一个线程类。

```
import threading;

class foo(threading.Thread):
    def __init__(self):
        #initialize anything
    def run(self):
        while True:
            str = raw_input("input something");

class bar:
    def __init__(self)
        self.thread = foo(); #initialize the thread (foo) class and store
        self.thread.start(); #this command will start the loop in the new thread (the run method)
        if(quit):
            #quit 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T03:43:15.980

创建一个新线程很容易——线程模块会帮助你。您可能希望使其成为守护进程（如果您有其他退出程序的方式）。我*认为*您也可以在不锁定的情况下更改变量——python 实现了自己的线程，我相当确定类似的东西`self.running = False`将是原子的。

启动新线程的最简单方法是`threading.Thread(target=)`：

```
# inside your class definition
def signal_done(self):
    self.done = True

def watcher(self):
    while True:
        if q_typed_in_console():
            self.signal_done()
            return

def start_watcher(self):
    t = threading.Thread(target=self.watcher)
    t.setDaemon(True)    # Optional; means thread will exit when main thread does
    t.start()

def main(self):
    while not self.done:
        # etc. 
```

如果您希望您的线程更智能，拥有自己的状态等，您可以`threading.Thread`自己继承。文档有更多。

[与此相关：python 可执行文件本身是单线程的，即使你有多个 python 线程]

# qt - mingw 吐出无数关于忽略“dll 导入”属性的警告

> ID：526958
> 
> 赞同：3
> 
> 时间：2009-02-09T02:10:20.697
> 
> 标签：qt, warnings, mingw, dllimport

我`mingw32-make`用来编译一个使用 opengl 的 qt 项目，它可以正确编译一切，但它会吐出无数形式的警告消息：

```
c:/qt3/include/qcolor.h:67: warning: inline function `int qGray(int, int, 
int)' declared as dllimport: attribute ignored 
```

对于这个特定的实例，函数声明是：

```
Q_EXPORT inline int qGray( int r, int g, int b )// convert R,G,B to gray 0..255
{ return (r*11+g*16+b*5)/32; } 
```

我的问题是，为什么它会吐出所有这些警告？我怎样才能在不消除其他合法警告（即与我的代码直接相关并且可能是潜在问题的警告）的情况下使它们静音？

更重要的是，为什么 mingw 一开始就忽略了 dll 导入属性？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-09T15:26:42.547

如果定义了以下宏之一，我认为 Qt 应该只将 Q_EXPORT（Qt 4 中的 Q_DECL_EXPORT）定义为 dllexport/import 属性，因此请确保您的 makefile 或包含 Qt 头文件的代码（最终将包含 qglobal.h）没有定义它们中的任何一个：WIN32、_WIN32、__WIN32__、WIN64、_WIN64、__WIN64__。或者您可以在编译（或预处理器）标志中将 Q_EXPORT 定义为空，然后 Qt 应该跳过定义它。

# f# - F# 中的字符值

> ID：526961
> 
> 赞同：2
> 
> 时间：2009-02-09T02:11:37.277
> 
> 标签：f#

假设我有一个字符串“COLIN”。

这个字符串的数值值：

> 3 + 15 + 12 + 9 + 14 = 53。

所以

> A = 1，B = 2，C = 3，依此类推。

我什至不知道如何从 F# 开始。

```
let mutable nametotal = 0
let rec tcalculate name =
    name.ToString().ToCharArray()
    |> Seq.length 
```

这是我到目前为止所拥有的。只是为了测试它`seq.length`是否`toCharArray`真的有效。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-09T02:38:37.040

你所拥有的是体面的；这是另一个版本：

```
#light

let Value (c:char) = 
    (int c) - (int 'A') + 1

let CalcValue name =
    name |> Seq.sum_by Value

printfn "COLIN = %d" (CalcValue "COLIN")
// may be of interest:
printfn "%A" ("COLIN" |> Seq.map Value |> Seq.to_list) 
```

它假设原始输入是大写的。“int”是将char（或其他）转换为int的函数；Seq.sum_by 非常适合这个。

我还展示了一个使用地图的例子，不知道你对什么感兴趣。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T03:05:51.187

如果“映射”更加随意，您可以使用类似下面代码的策略，您可以在其中指定每个字母映射到的值的数据结构。

```
#light

let table = [
    'C', 3
    'O', 15
    'L', 12
    'I', 9
    'N', 14
    ]

let dictionary = dict table

let Value c = 
    match dictionary.TryGetValue(c) with
    | true, v -> v
    | _ -> failwith (sprintf "letter '%c' was not in lookup table" c)

let CalcValue name =
    name |> Seq.sum_by Value

printfn "COLIN = %d" (CalcValue "COLIN") 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T02:22:43.867

我找到了一种使用字符的 ascii 值并从那里获取数字的 hackish 方法，但我认为可能有更好的方法。

```
let tcalculate name =
    name.ToString().ToLower().ToCharArray()
    |> Seq.map (fun char -> Convert.ToInt32 char - 96)
    |> Seq.sum 
```

工作很漂亮，甚至可能比“映射”更有效，但我想查看我要求的解决方案

谢谢大家。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T02:23:09.857

您需要做的就是使字符串小写，像您所做的那样将其转换为 char 数组，循环遍历每个字母，获取每个 char 的值并减去 'a' 的值并加一个。这将使每个字母都具有其在字母表中位置的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-10-21T15:28:51.980

我意识到这已经很老了，但我最近正在学习 F# 并在这个问题中使用这些想法。也许有人会发现它很有用：

```
let table = 
  Seq.zip ['A'..'Z'] (Seq.initInfinite((+) 1)) 
  |> Map.ofSeq

let calc (input : string) =
  let s = input.ToUpper()
  match s with
  | _ when Seq.forall System.Char.IsLetter s ->
    Some (Seq.sumBy (fun c -> table.[c]) s)
  | _ -> None 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-05-09T05:56:21.233

```
let sumOfChar name =                                                // F# functional answer
  name 
  |> List.ofSeq                                                     // to char array 
  |> List.map (fun c -> int (System.Char.ToUpper c) - int 'A' + 1)  // to value
  |> List.fold (+) 0                                                // sum

sumOfChar "Herb"                                                    // 33

// Or simply this version:
let sumOfCharBy name =
  let value c = int (System.Char.ToUpper c) - int 'A' + 1
  List.sumBy value (List.ofSeq name)

sumOfCharBy "HerbM"                                                 // 46

// or simply:
let sumOfCharBy name =
  name |> Seq.sumBy (fun c -> int (System.Char.ToUpper c) - int 'A' + 1)

sumOfCharBy "HMartin"                                              // 83 
```

# c# - XML 文档： 具有多个泛型类型参数的标记

> ID：526970
> 
> 赞同：3
> 
> 时间：2009-02-09T02:18:22.410
> 
> 标签：c#, generics, xml-documentation

我正在尝试对类的成员使用 XML 文档，并且在某些情况下，我想使用标记来引用泛型类型。这里的问题是当指定多个泛型类型参数时会产生警告。很容易找到如何使用单个参数引用泛型类型，如下所示：

```
<see cref="Func{int}" /> 
```

但是，尝试这样的事情会产生警告：

```
<see cref="Func{int, bool}" /> 
```

似乎我对具有多个类型参数的引用使用了错误的语法，或者 C# 的 XML 文档当前不支持此类引用。奇怪的是，我似乎在 MSDN 或 Sandcastle 文档（我正在使用它来编译文档，并且还抱怨语法）中找不到任何关于此的信息。任何澄清在这里将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-09T03:36:54.733

使用 .NET 名称，而不是 C# 别名：

```
<see cref="Func{Int32, Boolean}" /> 
```

# asp.net - 无法使用不同的服务器名称进行授权

> ID：526973
> 
> 赞同：1
> 
> 时间：2009-02-09T02:21:28.877
> 
> 标签：asp.net, web-services, iis, authorization, azman

我有一个在 Windows 2003 上的 IIS 6.0 中运行的 Web 服务。它的身份验证模式是集成 Windows 安全性（禁用匿名），并且使用授权管理器和 XML 授权存储完成授权。我的测试用户是具有授权角色成员身份的域用户（实际上是管理员）。

我正在（暂时）在 Web 服务器（localhost）上测试它，并（暂时）使用 Internet Explorer 访问 Web 服务（.asmx）。

我可以通过 localhost 成功打开 Web 服务（wsdl）页面，如下所示：

```
http://localhost:8080/MyService/MyService.asmx 
```

使用此 url，集成 Windows 身份验证成功（静默），并且 AzMan 成功授权我访问该服务。服务器名称也是如此：

```
http://myserver:8080/MyService/MyService.asmx 
```

现在我需要使用外部主机名 (www.mysite.no) 来访问服务（这是为了让 ssl 使用颁发给该站点名的证书）。为此，我将主机名添加到我的 HOSTS 文件中，如下所示：

```
127.0.0.1   www.mysite.no 
```

...然后在 IE 中输入：

```
http://www.mysite.no:8080/MyService/MyService.asmx 
```

然后发生的是授权失败。我得到了 IE/Windows 登录框并输入了正确的凭据三次。然后我得到一个 401.1：

```
HTTP Error 401.1 - Unauthorized: Access is denied due to invalid credentials.
Internet Information Services (IIS) 
```

主机名如何影响通过 AzMan 的授权？

**编辑**：我有理由相信 AzMan 与它无关 - 这似乎是身份验证失败。

我已经在另一台服务器上重现了这个问题。本质似乎是通过本地主机文件中的条目访问 localhost 会以某种方式弄乱浏览器和 IIS 之间的集成 Windows 身份验证。

我已经解决了这个问题，现在只剩下我的好奇心了......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T02:44:31.007

我的第一个猜测是它不是主机名。

首先要做的是缩小问题范围，因为有几件事可能会出错。

首先将 IIS 站点设置为匿名访问，并确保您可以启动 Web 服务。这将验证您访问的是正确的 IIS 网站，并且确实缩小了授权问题。

此外，请检查应用程序池凭据以及包含 Web 服务的文件夹上的安全设置，因为这些可能是贡献者。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T14:00:12.737

启用审核登录失败审核并检查主机上的安全事件日志。
1) 在网络服务器上，转到控制面板、管理工具、本地安全策略。2）转到本地政策，审计政策。为“审核登录事件”添加失败。
3) 关闭 MMC。打开命令提示符并键入 gpupdate。4) 浏览到[http://www.mysite.no](http://www.mysite.no). 您将再次收到错误消息。5) 启动事件查看器（控制面板、管理工具、事件查看器）。导航到安全事件日志并查找登录失败。他们应该告诉您一些描述性的信息，例如“未授予用户指定的登录类型”。不幸的是，登录类型本身不是描述性的；登录类型 2 是交互式的（本地），3 是“通过网络访问此计算机”，5 是“作为服务登录”（NT 服务，而不是 WCF 服务）。可以在本地安全策略中授予所需的权限。

另外，请检查您是否在 IE 中启用了代理。如果您的流量被路由到代理，则代理可能不支持 NTLM。使用 IE 进行测试时，将主机添加为代理例外。

# c# - 如何在 C# 中创建 Observable Hashset？

> ID：526986
> 
> 赞同：16
> 
> 时间：2009-02-09T02:28:07.627
> 
> 标签：c#, wpf, data-binding

目前我在 WPF 应用程序中使用 ObservableCollection，该应用程序是 Conway 生命游戏的实现，适用于大约 500 个单元格，但之后它开始显着减慢。我最初使用 HashSet 编写应用程序，但找不到将单元格绑定到画布的任何方法。

有没有办法让我的 HashSet 通知其绑定对象的更改？我的 Cell 类是一个简单的整数 X,Y 对，如果该对存在，则单元格是活的，否则是死的。Cell 实现 INotifyPropertyChanged 并覆盖 GetHashCode 和 Equals。我无法让单元格显示任何更改，只有加载后立即出现的单元格。有没有办法将哈希集绑定到画布上的项目？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-09T02:40:55.023

我不知道这是否会有所帮助，但这是我为个人项目制作的“可观察集”的一个*非常简单的实现。*它本质上防止插入（或覆盖）已经在集合中的项目。

如果你愿意，你可以简单地从方法中返回而不是抛出异常。

```
public class SetCollection<T> : ObservableCollection<T> 
{
    protected override void InsertItem(int index, T item)
    {
        if (Contains(item)) throw new ItemExistsException(item);

        base.InsertItem(index, item);
    }

    protected override void SetItem(int index, T item)
    {
        int i = IndexOf(item);
        if (i >= 0 && i != index) throw new ItemExistsException(item);

        base.SetItem(index, item);
    }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-09T02:33:48.643

您也必须实现[INotifyCollectionChanged](http://msdn.microsoft.com/en-us/library/system.collections.specialized.inotifycollectionchanged.aspx)，然后它应该一切正常。还有另一个相关的 SO 答案，它[使用 freezables](https://stackoverflow.com/questions/269073/observablecollection-that-also-monitors-changes-on-the-elements-in-collection)来确保基础实体的更改也得到处理。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-02-13T21:15:41.037

我在这里发布了一个完整的 ObservableHashSet 供您使用。

[https://github.com/BellaCode/Public/tree/master/ObservableHashSet](https://github.com/BellaCode/Public/tree/master/ObservableHashSet)

它基于对 ObservableCollection 实现方式的反思，并提供相同的线程安全重入检查。

# java - 为什么Java中的某些方法会修改原始值而有些不会？

> ID：526991
> 
> 赞同：2
> 
> 时间：2009-02-09T02:33:44.683
> 
> 标签：java, groovy

**Concat()**方法不会修改原始值。它返回一个新值。
像这样：

```
String str = "good";
str.concat("ness");
System.out.println(str);   //"good" 
```

但是有些方法会修改原始值。为什么？

在 Groovy 中：

```
def languages = ["Java", "Groovy", "JRuby"]
languages.reverse()
===> [JRuby, Groovy, Java]
println languages
===> [Java, Groovy, JRuby]

languages.sort()
===> [Groovy, JRuby, Java]
println languages
===> [Groovy, JRuby, Java] 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-09T02:36:23.363

**[`String`](http://java.sun.com/javase/6/docs/api/java/lang/String.html)在 Java 中是不可变的。**任何“修改” a 的方法都`String`必须返回 的新实例`String`。

来自[该类的](http://java.sun.com/javase/6/docs/api/java/lang/String.html)[Java API 规范`String`](http://java.sun.com/javase/6/docs/api/java/lang/String.html)：

> 字符串是常量；它们的值在创建后无法更改。

[Java 语言规范在](http://java.sun.com/docs/books/jls/second_edition/html/jTOC.doc.html)[第 4.3.3 节：类字符串](http://java.sun.com/docs/books/jls/second_edition/html/typesValues.doc.html#26992)中定义了这种行为。

* * *

**对编辑的回应：**

似乎已添加了 Groovy 中的示例。（我之前没有用过Groovy，所以我的理解可能不正确。）

根据我从示例中了解到的情况，似乎有一个`languages`正在被`reverse`-ed 和`sort`-ed 的列表——这些操作本身不会修改`String`列表中包含的对象，而是作用于列表本身。

列表返回新列表的方式，或者它如何修改或不修改列表与`String`对象本身的行为无关。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T02:43:33.347

Java API 是由许多不同的人设计的，因此很难保持一切一致。我相信人们现在普遍接受不变性（即内部状态不应该改变）是一件好事，至少在价值对象方面是这样。

另一个类似的问题是，“为什么索引有时从 0 开始（大部分时间），而有时从 1 开始（JDBC）。” 同样，我认为这是 API 过于宽泛，不同 API 的开发人员无法协调的另一种情况（我可能在这里错了，如果有人知道 JDBC 基于 1 的真正原因，请告诉我）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T02:52:49.363

我想你的意思是`str.concat("ness")`相反。在这个带有 s 的特定示例中`String`，没有方法可以改变对象，因为`String`s 被设计为**不可变**的。在库中，您会发现许多改变对象状态的方法（例如[`StringBuffer.replace()`](http://java.sun.com/javase/6/docs/api/java/lang/StringBuilder.html#replace(int,%20int,%20java.lang.String))）和不改变对象状态的其他方法（例如[`String.replace()`](http://java.sun.com/javase/6/docs/api/java/lang/String.html#replace(java.lang.CharSequence,%20java.lang.CharSequence))）。您必须仔细阅读[API](http://java.sun.com/javase/6/docs/api/overview-summary.html)以确定是哪种情况。最终，这是由库设计者做出的选择，他们必须考虑与他或她正在编写的包相关的功能、易用性和约定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T02:42:56.843

因为有不可变和可变的类。

`String`，正如另一个答案指出的那样，是一个不可变的类。创建 String 后，它们的值始终保持不变。

如果您有一个`ArrayList<Integer>`对象，您可以使用它的`add`功能将另一个 Integer 添加到列表中。该`add`函数就地更改列表，而不是返回新列表。ArrayList 是可变的。

**对编辑的回应**：

对于您的 groovy 示例，它的设计者可能坐下来并注意到人们通常会想要一个包含反转结果的新列表，并保持旧列表不变。（为什么？我不知道）。另一方面，他们可能已经注意到在更多情况下您不希望有一个包含排序结果的新列表。所以它就地完成了它的工作。但我不知道也没有使用过 groovy，所以只是猜测。

在 Ruby 中，我听说有一个概念：就地更改对象的函数在它们后面写一个感叹号，而将结果作为新对象返回的函数没有感叹号：

```
newObj = obj.sort(); // new sorted list is returned
obj.sort!(); // obj is sorted in-place 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-09T05:12:03.863

在某种程度上，这也与编程风格有关。不更改原始对象并创建新副本以反映更改是安全编程的习惯用法。我相信 Josh Bloch 在他的书“Effective Java”（第一版）中提到了它。虽然我不记得他使用的确切术语。

在 String 的情况下，它返回一个新对象，因为 String 是不可变的。但是，在整个 Java API 中，您会看到原始对象发生更改的一些地方以及返回新对象的一些地方。正如前面有人指出的那样，这是因为不同的人在 API 上工作过，他们带来了自己的编程风格。

稍微不同的一点是：保持对象不可变增加了代码的安全性，它还允许我们以某种方式进行编码。

`(new Date()).add(new Month(7)).add(new Day(4))`

如果 Date 上的每个方法都返回一个新对象而不是更改它自己的状态，那么我们可以编写这样的代码。这使得程序非常可读。

但是，如果我们有大对象，保持对象不可变可能会降低系统的性能。**********