# StackOverflow 问答 000227000-000227999

# c++ - 在 C++ 中确定更改数据的最佳方法

> ID：227001
> 
> 赞同：4
> 
> 时间：2008-10-22T18:27:11.707
> 
> 标签：c++, file, compare, replication, librsync

我需要用 C++ 编写一个工具来确定一个文件中更改的位与另一个文件进行比较以进行复制。实现这一目标的最佳方法是什么？

我没有考虑特定的操作系统或库，我愿意接受建议。我的主要目标是减少复制所涉及的网络流量。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-22T18:29:40.610

查看 rsync - 它将文件拆分为块，计算每个块的校验和，并仅传输校验和以确定是否有任何更改，然后仅在必要时传输块数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T19:02:23.117

如果您不能按原样使用 rsync，请检查[librsync](http://librsync.sourceforge.net/)。它很旧，但代码易于阅读和改进。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T21:19:26.303

如果您在同一台机器上没有新旧版本的文件，那么类似 rsync 的算法是前进的方向（请参阅以前的答案）。如果您确实在同一台机器上同时拥有旧版本和新版本的文件，那么您可以比 rsync 做得更好：生成压缩差异并通过网络发送它们。

要生成有效的差异，请查看 VCDIFF (RFC 3284) 二进制增量压缩。一个很好的实现是 xdelta (www.xdelta.org)。如果您想避免由于许可证问题而在接收端使用 xdelta，那么实现解码器/解压缩器相当容易。编写自己的 VCDIFF 差异生成器来生成紧凑的差异要复杂得多（以搜索移动的块为例）。

在 VCDIFF 中，差异也可以是无源的，这意味着它们在手头没有任何源文件（应用差异的文件）的情况下解压缩到目标文件中——在 VCDIFF 中，压缩文件是在两个文件之间创建压缩增量的特殊情况文件。这很有用，因为无论目标是否有文件版本，您都可以使用相同的格式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T18:29:45.960

我会先尝试一些差异的实现（[http://en.wikipedia.org/wiki/Diff](http://en.wikipedia.org/wiki/Diff)）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T21:03:23.090

建议：使用散列函数和分治法来缩小变更范围。不完全是防碰撞解决方案，但 SHA-2 IMO 可以为您工作。

# iphone - 在 iPhone 应用程序中手动绘制渐变？

> ID：227005
> 
> 赞同：11
> 
> 时间：2008-10-22T18:28:08.350
> 
> 标签：iphone, cocoa-touch

如果我有两个 UIColors，在任意大小的区域上绘制均匀渐变的最佳方法是什么？

我猜你会创建一个 UIView 子类并在 drawRect 方法中使用 CG 绘图方法。我只是不知道哪些，或者是否有任何需要注意的陷阱，比如性能。有人做过吗？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2013-03-08T19:56:35.073

```
#import <QuartzCore/QuartzCore.h>    
- (void) setGradient {
    CAGradientLayer *gradient = [CAGradientLayer layer];
    gradient.frame = self.view.bounds;
    gradient.colors = [NSArray arrayWithObjects:(id)[[UIColor whiteColor] CGColor], (id)[[UIColor blackColor] CGColor], nil];
    [self.view.layer insertSublayer:gradient atIndex:0];     
} 
```

不要忘记将 QuartzCore 库添加到您的项目中。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-22T18:41:36.997

你会想要使用 CGGradient。请参阅 iPhone 开发中心“ [CGGradient 参考](http://developer.apple.com/library/ios/#documentation/GraphicsImaging/Reference/CGGradient/Reference/reference.html)”文档。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-01-25T11:06:23.990

添加渐变的 Swift 方法是：

```
 var view : UIView = UIView(frame: CGRectMake(0, 0, 320, 100))
    var g : CAGradientLayer = CAGradientLayer()
    g.frame = gradientView.bounds
    g.colors = ["000000".UIColor.CGColor , "111111".UIColor.CGColor]
    view.layer.insertSublayer(g, atIndex: 0) 
```

`UIColor()`是 Swift 转换为的辅助类`hex color`，`rgb color`强烈推荐。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-21T08:57:59.303

我发现使用 CAGradientLayer 产生了一个带有明显步进的渐变最终使用了这个

> [http://evilrockhopper.com/tag/cggradient/](http://evilrockhopper.com/tag/cggradient/)

根据这个问题[Gradients on UIView and UILabels On iPhone](https://stackoverflow.com/questions/422066/gradients-on-uiview-and-uilabels-on-iphone)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-26T18:26:32.483

对于绘制文本的视图，例如`UILabel`、`UITextView`和，您应该在函数`UITextField`内添加渐变。（有关示例，`drawRect`请参见此[帖子）。](https://stackoverflow.com/a/422208/877032)

, ,有一些很棒的子类`UILabel`，它们让您可以很容易地添加渐变（请参阅[GitHub 上的 JBGradient](https://github.com/carleek/JBGradientTextViews)）。`UITextView``UITextField`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-12-01T20:36:59.020

与@Anton Chikin 相同的解决方案，但更强大。请注意 ... 的覆盖，`layerClass`这样，您不必担心设置框架，并且框架会在旋转和调整大小时自动更新。

```
class GradientView: UIView {

    var colorA : UIColor = UIColor.greenColor() {
        didSet { updateGradient() }
    }
    var colorB : UIColor = UIColor.blueColor() {
        didSet { updateGradient() }
    }

    override class func layerClass() -> AnyClass {
        return CAGradientLayer.self
    }

    required init(coder aDecoder: NSCoder) {
        super.init(coder: aDecoder)
        updateGradient()
    }

    func updateGradient() {
        if let gLayer = layer as? CAGradientLayer {
            gLayer.colors = [colorA.CGColor, colorB.CGColor]
        }
    }

} 
```

如果您使用的是 IB，则可以通过“用户定义的运行时属性”设置属性。

如果您不使用 IB，请使用其他初始化程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-10-06T08:51:42.127

嗨，您可以使用以下方法在视图上应用渐变

```
-(void)applyGradientEffecttoView:(UIView *)aView
 {
     // Create the colors

     UIColor *darkOp = [UIColor colorWithRed:0.0f green:0.0f blue:0.0f alpha:1.0];
     UIColor *lightOp =[UIColor colorWithRed:255.0f green:255.0f blue:255.0f alpha:0.0];

      // Create the gradient
      CAGradientLayer *gradient = [CAGradientLayer layer];

      // Set colors
      gradient.colors = [NSArray arrayWithObjects:
                        (id)lightOp.CGColor,
                        (id)darkOp.CGColor,
                        nil];
     gradient.locations = [NSArray arrayWithObjects:
                          [NSNumber numberWithFloat:0.0f],
                          [NSNumber numberWithFloat:0.5],
                          nil];

    // Set bounds
     gradient.frame = aView.bounds;

   // Add the gradient to the view

  [aView.layer insertSublayer:gradient atIndex:0];
} 
```

# java - 在Java中重置时间戳的时间部分

> ID：227007
> 
> 赞同：39
> 
> 时间：2008-10-22T18:28:18.630
> 
> 标签：java, sql, timestamp

在 Java 中，给定一个时间戳，如何将时间部分单独重置为 00:00:00，以便时间戳代表该特定日期的午夜？

在 T-SQL 中，此查询将实现相同的功能，但我不知道如何在 Java 中执行此操作。

`SELECT CAST( FLOOR( CAST(GETDATE() AS FLOAT ) ) AS DATETIME) AS 'DateTimeAtMidnight';`

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-10-22T18:38:31.013

你可以去日期->日历->设置->日期：

```
Date date = new Date();                      // timestamp now
Calendar cal = Calendar.getInstance();       // get calendar instance
cal.setTime(date);                           // set cal to date
cal.set(Calendar.HOUR_OF_DAY, 0);            // set hour to midnight
cal.set(Calendar.MINUTE, 0);                 // set minute in hour
cal.set(Calendar.SECOND, 0);                 // set second in minute
cal.set(Calendar.MILLISECOND, 0);            // set millis in second
Date zeroedDate = cal.getTime();             // actually computes the new Date 
```

我喜欢 Java 日期。

请注意，如果您使用的是实际的 java.sql.Timestamps，它们有一个额外的 nanos 字段。Calendar 当然，对 nanos 一无所知，因此在最后创建 zeroedDate 时会盲目地忽略它并有效地删除它，然后您可以使用它来创建一个新的 Timetamp 对象。

我还应该注意，Calendar 不是线程安全的，所以不要以为你可以从多个线程调用静态单个 cal 实例以避免创建新的 Calendar 实例。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-22T21:22:41.307

如果您使用的是 commons lang，您可以调用`DateUtils.truncate`. 这是[javadoc 文档](http://commons.apache.org/proper/commons-lang/javadocs/api-release/org/apache/commons/lang3/time/DateUtils.html#truncate(java.util.Date,%20int))。

它和@Alex Miller 所说的一样。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-22T18:37:47.940

假设您的“时间戳”是 java.util.Date，它表示为自纪元开始（1970 年 1 月 1 日）以来的毫秒数，您可以执行以下算术：

```
public static Date stripTimePortion(Date timestamp) {
    long msInDay = 1000 * 60 * 60 * 24; // Number of milliseconds in a day
    long msPortion = timestamp.getTime() % msInDay;
    return new Date(timestamp.getTime() - msPortion);
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-11-19T21:57:19.080

我更喜欢这个解决方案：

```
GregorianCalendar now = new GregorianCalendar();
GregorianCalendar calendar = new GregorianCalendar(
              now.get(GregorianCalendar.YEAR), now.get(GregorianCalendar.MONTH), 
              now.get(GregorianCalendar.DAY_OF_MONTH)); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-03-19T21:21:50.257

做这个

```
import org.apache.commons.lang.time.DateUtils;

Date myDate = new Date();
System.out.println(myDate);        
System.out.println(DateUtils.truncate(myDate, Calendar.DATE)); 
```

输出是

2014 年 3 月 19 日星期三14:16:47 PDT 2014 年
3 月 19 日星期三 00:00:00 PDT

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T18:38:38.767

由于我没有做太多的 DateTime 操作，这可能不是最好的方法。我会生成一个日历并将日期用作源。然后将小时、分钟和秒设置为 0 并转换回日期。不过，很高兴看到更好的方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T19:21:25.810

使用 Calendar.set() 肯定是“按书本”解决方案，但您也可以使用 java.sql.Date：

```
java.util.Date originalDate = new java.util.Date();
java.sql.Date wantedDate = new java.sql.Date(originalDate.getTime()); 
```

那将完全符合您的要求，因为：

> 为了符合 SQL DATE 的定义，由 java.sql.Date 实例包装的毫秒值必须通过在实例关联的特定时区中将小时、分钟、秒和毫秒设置为零来“规范化” .

由于 java.sql.Date 扩展了 java.util.Date，因此您可以自由地使用它。请注意，wantedDate.getTime() 将检索原始时间戳 - 这就是您不想从 java.sql.Date 创建另一个 java.util.Date 的原因！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-07-10T12:20:07.887

在下面找到使用 Joda Time 并支持时区的解决方案。因此，您将在 JVM 中当前配置的时区中获取当前日期和时间 (into `currentDate`and `currentTime`) 或通知的某个日期和时间 (into `informedDate`and )。`informedTime`

下面的代码还通知通知的日期/时间是否在未来（变量`schedulable`）。

请注意 Joda Time 不支持*闰秒*。因此，您可能会偏离真实值大约 26 或 27 秒。这可能要在未来 50 年才能解决，到时累积误差会接近 1 分钟，人们才会开始关心它。

另见：[https ://en.wikipedia.org/wiki/Leap_second](https://en.wikipedia.org/wiki/Leap_second)

```
/**
 * This class splits the current date/time (now!) and an informed date/time into their components:
 * <lu>
 *     <li>schedulable: if the informed date/time is in the present (now!) or in future.</li>
 *     <li>informedDate: the date (only) part of the informed date/time</li>
 *     <li>informedTime: the time (only) part of the informed date/time</li>
 *     <li>currentDate: the date (only) part of the current date/time (now!)</li>
 *     <li>currentTime: the time (only) part of the current date/time (now!)</li>
 * </lu>
 */
public class ScheduleDateTime {
    public final boolean schedulable;
    public final long millis;
    public final java.util.Date informedDate;
    public final java.util.Date informedTime;
    public final java.util.Date currentDate;
    public final java.util.Date currentTime;

    public ScheduleDateTime(long millis) {
        final long now = System.currentTimeMillis();
        this.schedulable = (millis > -1L) && (millis >= now);

        final TimeZoneUtils tz = new TimeZoneUtils();

        final java.util.Date          dmillis   = new java.util.Date( (millis > -1L) ? millis : now );
        final java.time.ZonedDateTime zdtmillis = java.time.ZonedDateTime.ofInstant(dmillis.toInstant(), java.time.ZoneId.systemDefault());
        final java.util.Date          zdmillis  = java.util.Date.from(tz.tzdate(zdtmillis));
        final java.util.Date          ztmillis  = new java.util.Date(tz.tztime(zdtmillis));

        final java.util.Date          dnow   = new java.util.Date(now);
        final java.time.ZonedDateTime zdtnow = java.time.ZonedDateTime.ofInstant(dnow.toInstant(), java.time.ZoneId.systemDefault());
        final java.util.Date          zdnow  = java.util.Date.from(tz.tzdate(zdtnow));
        final java.util.Date          ztnow  = new java.util.Date(tz.tztime(zdtnow));

        this.millis       = millis;
        this.informedDate = zdmillis;
        this.informedTime = ztmillis;
        this.currentDate  = zdnow;
        this.currentTime  = ztnow;
    }
}

public class TimeZoneUtils {

    public java.time.Instant tzdate() {
        final java.time.ZonedDateTime zdtime = java.time.ZonedDateTime.now();
        return tzdate(zdtime);
    }
    public java.time.Instant tzdate(java.time.ZonedDateTime zdtime) {
        final java.time.ZonedDateTime zddate = zdtime.truncatedTo(java.time.temporal.ChronoUnit.DAYS);
        final java.time.Instant instant = zddate.toInstant();
        return instant;
    }

    public long tztime() {
        final java.time.ZonedDateTime zdtime = java.time.ZonedDateTime.now();
        return tztime(zdtime);
     }
    public long tztime(java.time.ZonedDateTime zdtime) {
        final java.time.ZonedDateTime zddate = zdtime.truncatedTo(java.time.temporal.ChronoUnit.DAYS);
        final long millis = zddate.until(zdtime, java.time.temporal.ChronoUnit.MILLIS);
        return millis;
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-01-18T15:22:21.830

这是一个带有主要示例的简单函数：

```
import java.util.Calendar;
import java.util.Date;
public class Util {
/**
 * Returns an imprecise date/timestamp. 
 * @param date
 * @return the timestamp with zeroized seconds/milliseconds
 */
public static Date getImpreciseDate(Date date) {
   Calendar cal = Calendar.getInstance(); // get calendar instance
   cal.setTime(date);// set cal to date
   cal.set(Calendar.SECOND, 0); // zeroize seconds 
   cal.set(Calendar.MILLISECOND, 0);   // zeroize milliseconds
   return cal.getTime();
}

public static void main(String[] args){
   Date now = new Date();
   now.setTime(System.currentTimeMillis()); // set time to now
   System.out.println("Precise date:  " + Util.getImpreciseDate(now));
   System.out.println("Imprecise date:  " + Util.getImpreciseDate(now));
}
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-08-20T13:03:07.110

只是试图为 Java-8 提供答案，尽管使用的答案`Calendar`也有效，但很多人不再使用该类了。

请参阅 SO Answers [this](https://stackoverflow.com/questions/51368395/convert-java-sql-timestamp-to-java-8-zoneddatetime) & [this](https://stackoverflow.com/questions/44002104/localdatetime-zoneddatetime-and-timestamp)以了解`java.time.ZonedDateTime`&之间的转换`java.sql.Timestamp`

然后你可以简单地截断`ZonedDateTime`几天并重新转换回`Timestamp`

```
Timestamp.valueOf(ZonedDateTime.now().truncatedTo(ChronoUnit.DAYS).toLocalDateTime()) 
```

# database - 可以处理半结构化数据的数据库？

> ID：227017
> 
> 赞同：2
> 
> 时间：2008-10-22T18:30:30.793
> 
> 标签：database, distributed

除了[CouchDB](http://couchdb.org)和 Native XML 数据库（例如[eXist](http://exist-db.org)），哪些数据库可以存储和查询非结构化和半结构化数据？

我收到了很多不同格式的数据（XML、JSON、YAML、CSV、一些自定义格式），我需要合并和使用这些数据，但是在关系数据库中开发模式既耗时又困难。

主要是，我正在研究开源解决方案。此外，在某些时候，我想以某种方式提供这些数据。

我知道将所有这些数据转换为通用格式会产生一些开销。在 XML 方面有一些不错的选择：eXist-db 和 BerkeleyDB-XML 似乎有很好的 XQuery 支持。

此外，虽然还很年轻，但 CouchDB 以其简单的“文档”格式看起来很有前途。

我看过的其他途径是 OODBMS，例如 ZODB 和 db4o；编写一些简单的解析脚本，然后“按原样”存储生成的记录对象。那里的问题是事后查询它们；OODBMS 似乎没有很好的查询引擎历史。

我不喜欢的是“blob-in-relational-db”解决方案。看起来像一个 hack，并没有真正考虑到数据的演变、FT 索引等。

还有其他我没有遇到的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T10:42:22.733

如果你想要一些非常通用的东西，你可以使用 RDF 存储。使用 RDF，您可以构建一个图，结果证明这是对半结构化数据的一个很好的抽象。您只需为图形提供数据固有的结构。在这种情况下，论文[Querying RDF Data from a Graph Database Perspective](http://www.dcc.uchile.cl/~cgutierr/papers/eswc05.pdf)（或[幻灯片](http://grupoweb.upf.es/WRG/dctos/030605_Guitierrez.pdf)）可能是一本有趣的读物。

一种更简单的方法是通过使用像[neo4j](http://neo4j.org/)这样的图形数据库更直接地使用图形抽象。这是一个开源项目（我也是其中的一部分）。图形数据库不会像 OODB 那样将您的数据与特定的应用程序联系起来。而且它也不会强迫您使用必须将数据放入其中的静态模式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T18:52:05.260

大多数现代 RDBMS 支持 xml 数据类型，认为 xml 文档是表字段中的值，使用 XPath/XQuery 从值中检索数据。类似地，您可以使用 CLOB 数据类型来表示一大块字符（即非结构化文档）；在这种情况下，Oracle、SQL Server 和其他公司都有扩展来对这些字段执行文本搜索。

很酷的是，这些半/非结构化搜索工具被实现为可从 sql 访问的运算符，因此您可以将这些搜索的结果与结构化查询混合；维护客户端应用程序的一致关系表示。在几个项目中，我们将原生 xml 数据存储在 Oracle DB 中，并使用标准 SQL 视图将数据投影为结构化数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T18:40:13.037

[如果您真的要存储非结构化数据——或者您不打算根据文档的结构进行索引——那么我认为像Lucene](http://lucene.apache.org/java/docs/)这样的全文搜索引擎对您来说很有价值。[developerWorks 有一篇](http://www.ibm.com/developerworks/java/library/j-lucene/)关于使用 Lucene 处理 XML的较早但内容丰富的文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T19:13:14.780

IBM DB2 版本 9支持[PureXML](http://www.ibm.com/db2/xml)。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-22T18:33:06.843

Microsoft SQL Server 从 2005 年开始具有 XML 列类型。

# javascript - 是否有适用于 Windows 的 JSLint 的离线版本？

> ID：227022
> 
> 赞同：29
> 
> 时间：2008-10-22T18:32:19.870
> 
> 标签：javascript, jslint

我想在不访问[JSLint](http://www.jslint.com/)网站的情况下检查我的 JavaScript 文件。
此工具是否有适用于 Windows 的桌面版本？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T18:39:38.920

来自[http://www.jslint.com/lint.html](http://www.jslint.com/lint.html)：

> 分析是通过在您的机器上运行的脚本完成的。您的脚本不是通过网络发送的。
> 
> 它也可用作[Konfabulator 小部件](http://www.widgetgallery.com/?search=jslint)。您可以通过将文件拖放到小部件上来检查文件。您可以通过双击小部件来重新检查文件。
> 
> 它也可用于[WSH 命令行](http://web.archive.org/web/20091217105428/http://www.jslint.com/wsh/index.html)版本。
> 
> 它也可以在[Rhino 命令行](http://www.jslint.com/rhino/index.html)版本中使用。

或者因为 JSLint 是在您的浏览器中运行的 JavaScript 程序 - 您可以获取脚本并在本地运行它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-19T17:26:19.710

你也可以在你的机器上使用 JavaScript Lint，
从这里获取
[JavaScript Lint](http://www.javascriptlint.com)

有关于如何将其集成到上述站点上的许多编辑器/IDE 中的说明。我在 UltraEdit 中使用它，效果很好。

从上面的网站

> > 您可以通过多种方式运行 JavaScript Lint：
> > 
> > 您可以将其集成到您的 IDE 中，例如 Visual Studio、SciTE 或任何其他支持外部工具的 IDE。当 JavaScript Lint 发现错误时，您的 IDE 会直接将您带到包含错误的行。
> > 
> > 您可以通过 Windows 程序员可能更喜欢的 Windows 资源管理器运行它。
> > 
> > 您可以使用命令行来集成到您的构建系统中，或者您可能是一名 Linux 程序员并且更喜欢命令行！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-03-17T22:09:02.277

这个老问题的附录：jslint.js 的 WScript 版本产生的错误消息与来自任何编译器的错误消息非常不同。

如果您希望它们相似，并且希望能够在命令行中指定 .js 文件的名称，而不是使用标准输入来读取文件，请执行以下操作：

下载[jslint.js，WScript 版本](http://jslint.com/wsh/jslint.js)。

编辑 jslint.js 文件。滚动到底部并找到以下内容：

```
 (function(){if(!JSLINT(WScript.StdIn.ReadAll(),..... 
```

将其（以及随后的所有内容）替换为：

```
(function(){
    var filename = "stdin";
    var content= "";
    if (WScript.Arguments.length > 0){
        filename = WScript.Arguments(0);
        var fso = new ActiveXObject("Scripting.FileSystemObject");
        //var file = fso.GetFile(filename);
        var fs = fso.OpenTextFile(filename, 1);
        content = fs.ReadAll();
        fs.Close();
        fso = null;
        fs = null;
    } else {
        content = WScript.StdIn.ReadAll();
    }
    if(!JSLINT(content,{passfail:false})){
        WScript.StdErr.WriteLine("JSLINT");
        for (var i=0; i<JSLINT.errors.length; i++) {
            // sample error msg:
            //  sprintf.js(53,42) JSLINT: Use the array literal notation [].
            var e=JSLINT.errors[i];
            if (e !== null){
                var line = (typeof e.line == "undefined")?'0':e.line;
                WScript.StdErr.WriteLine(filename + '(' +line+','+e.character+') JSLINT: '+e.reason);
                WScript.StdErr.WriteLine('    ' + (e.evidence||'').replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));
            }
        }}}()); 
```

这种变化有两件事：

1.  允许您在命令行上指定要在其上运行 lint 的文件，而不是作为标准输入。如果根本没有指定文件，标准输入仍然有效。
2.  以更类似于大多数 C/C++ 编译器的格式发出错误消息。

* * *

然后，在 cmd.exe 提示符下，您可以执行以下操作：

```
cscript.exe  jslint.js   MyJavascriptModule.js 
```

您将收到如下错误消息：

```
JSLINT
MyJavascriptModule.js(7,17) JSLINT: 'xml' is already defined.
    var xml = new ActiveXObject("Microsoft.XMLHTTP");
MyJavascriptModule.js(10,5) JSLINT: 'xml' used out of scope.
    xml.open("GET", url, true);
MyJavascriptModule.js(11,9) JSLINT: 'xml' used out of scope.
    if (xml.overrideMimeType) {
MyJavascriptModule.js(12,9) JSLINT: 'xml' used out of scope.
    xml.overrideMimeType('text/plain; charset=x-user-defined');
MyJavascriptModule.js(14,9) JSLINT: 'xml' used out of scope.
    xml.setRequestHeader('Accept-Charset', 'x-user-defined');
MyJavascriptModule.js(17,5) JSLINT: 'xml' used out of scope.
    xml.onreadystatechange = function() {
MyJavascriptModule.js(28,5) JSLINT: 'xml' used out of scope.
    xml.send('');
MyJavascriptModule.js(34,16) JSLINT: Expected '{' and instead saw 'url'.
    if (proxy) url = proxy + '?url=' + encodeURIComponent(url);
MyJavascriptModule.js(51,16) JSLINT: Expected '{' and instead saw 'url'.
    if (proxy) url = proxy + '?url=' + encodeURIComponent(url); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-10-10T09:42:32.323

我知道这是一个旧的，但没有人提到 JSLint 是开源的并且可以在 github 上找到。[https://github.com/douglascrockford/JSLint](https://github.com/douglascrockford/JSLint)

您可以使用包含的 HTML 页面，或使用以下方法创建自己的界面：

```
var options = {
    browser : true,
    plusplus : true,
    unparam : true,
    maxlen : 120,
    indent : 4 // etc
};
if (JSLINT(myCode, options)) {
    document.write('Passed!');
} else {
    document.write('Failed! :(');
}
document.write('<ul>');
for (i = 0; i < JSLINT.errors.length; i++) {
    document.write('<li><b>' + JSLINT.errors[i].line + ':</b> ' + JSLINT.errors[i].reason + '</li>');
}
document.write('</ul>'); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-22T18:36:41.483

您可以将页面保存到硬盘吗？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-01-01T23:11:40.980

我们发现[JSLint4Java](https://github.com/happygiraffe/jslint4java)非常好。如果您使用 Ant 来构建您的项目，那么它提供的 Ant 任务特别有用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T18:42:01.083

只需将 html 页面保存到您的硬盘驱动器，然后将它使用的 .js 文件下载到同一位置。这就是 JavaScript 的美妙之处。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-23T18:54:08.720

[在jslint CLI 选项](https://stackoverflow.com/questions/599842/jslint-cli-options)中提供更多答案（并非全部针对 Windows）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-03-24T13:12:31.780

你可以将这家伙制作的工具集成到 Visual Studio 中。

[http://jason.diamond.name/weblog/2008/08/09/verifying-javascript-with-jslint-and-visual-studio/#content](http://jason.diamond.name/weblog/2008/08/09/verifying-javascript-with-jslint-and-visual-studio/#content)

只需禁用您不需要的选项。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-03-24T13:22:41.333

可以在[此处](http://jslint.codeplex.com/)找到 Visual Studio 插件。

这有点粗糙，但可以完成工作。

我刚刚加入了该项目，并将在接下来的几个月内对其进行更新。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-02-20T13:39:03.533

Visual Studio 2010有一个不错的[扩展](https://jslint4vs2010.codeplex.com/)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-09-22T09:34:17.543

如果你使用记事本++，有一个 JSLint 插件适合你。

[记事本++的 JSLint 插件](http://jslintnpp.sourceforge.net/)

您可以从 notepad++ 的插件管理器中找到并安装它。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-22T19:11:05.580

大多数浏览器都能够保存“整个”页面，这意味着所有外部文件（如样式表、JavaScript 等）也会被下载并正确链接到 HTML 文档中（通常放在 HTML 文件旁边的文件夹中）。因此，绝对可以离线使用该工具。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-08-25T14:27:00.213

MiniME 是 JSLint 的替代方案，它在 Windows 下运行，您可能会发现它很有用。

完全披露，我支持：[http](http://www.toptensoftware.com/minime) ://www.toptensoftware.com/minime ，它进行缩小、混淆和一组合理的 lint 样式检查。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-09-13T18:28:46.430

# 使用 Node.js 运行的 JSLint Reporter

易于保持最新状态。

1.  安装[Node.js](http://nodejs.org/)。

2.  将[jslint-reporter](https://github.com/FND/jslint-reporter)安装到：`C:\jslint-reporter`

3.  下载 JSLint：

    ```
    C:\jslint-reporter>node wrapper.js --upgrade 
    ```

4.  测试：

    ```
    C:\Temp>node C:\jslint-reporter\wrapper.js missing_semicolon.js
    missing_semicolon.js:1:10:Expected ';' and instead saw 'console'.
    missing_semicolon.js:2:1:'console' was used before it was defined. 
    ```

# JSLint Node.js 包

易于设置，但您需要依赖包作者来使包含的 JSLint 保持最新：

1.  安装[Node.js](http://nodejs.org/)。

2.  使用Node.js 的包管理器*npm安装 JSLint：*

    ```
    C:\>npm -g install jslint 
    ```

3.  测试：

    ```
    C:\Temp>jslint missing_semicolon.js

    missing_semicolon.js
     #1 Expected ';' and instead saw 'console'.
        var x = 5 // Line 1, Pos 10 
    ```

# 其他解决方案

当然，要运行 JSLint，您也可以使用[Rhino](https://developer.mozilla.org/en/docs/Rhino)或任何其他适用于 Windows 的 JavaScript 实现。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-02-12T15:16:46.553

[CSE HTML Validator](https://www.htmlvalidator.com/)包括 JSLint 并在 Windows 桌面机器上运行。

# proxy - 如何使用特定于州的代理？

> ID：227028
> 
> 赞同：0
> 
> 时间：2008-10-22T18:34:09.383
> 
> 标签：proxy, geolocation

我需要通过特定于州的 IP 地址访问网站。关于如何做到这一点的任何建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T19:13:30.800

*（我假设您正在尝试访问一个分布在具有不同 IP 地址的多个主机上的网站，并且您想要访问其中一个特定的主机）*

如果您使用的是 Windows 2000、XP 或 Vista，它位于 %WINDIR%\system32\drivers\etc\hosts（该路径通常扩展为 c:\windows\system32\drivers\etc\hosts） 在 Unix 系统上，这将是 /etc/hosts

插入一行这样的内容：

`10.53.13.144 the-host-to-connect-to.example.com`

其中第一部分是此主机将解析到的 IP 地址，空格后面的部分是主机+域名。

保存文件；某些浏览器（例如 Opera、IE）需要关闭并重新打开，因为它们正在缓存 DNS 主机名。

此示例意味着，对 the-host-to-connect-to.example.com 的任何请求都将发送到 IP 地址为 10.53.13.144 的主机

# wpf - 从不相关的类中“借用”依赖属性是否可以接受？

> ID：227030
> 
> 赞同：4
> 
> 时间：2008-10-22T18:34:25.827
> 
> 标签：wpf, dependency-properties

我正在编写一个在 WPF 中呈现一些内容的类，我想让用户控制内容的呈现方式。渲染主要是描边线，所以我决定查看 System.Windows.Forms.Shapes.Line 类来了解我可能想要实现的属性。这导致我实现了大部分`StrokeXXXX`属性，这是一项繁重的工作，因为每个属性都需要元数据来影响渲染。

一位同事建议我只是“借用” Shape 的属性，如下所示：

```
Shape.StrokeThicknessProperty.AddOwner(typeof(MyType)); 
```

这似乎是一个不错的主意。我认为这样做我会失去设置强制和属性更改回调的能力，但看起来采用 PropertyMetadata 的重载允许这样做。我能看到的唯一缺点是如果 Shape 的实现发生变化，它会影响我们的类，但我不确定我期望 .NET 接口多久发生一次显着变化。

你怎么看？当知名类具有您想要的行为和稳定的界面时，这是定义属性的一个不错的捷径，还是在汽油浴中玩火的可靠方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T06:15:08.547

借用 DP 是非常安全和有用的……阅读WPF 博士关于该主题的[以下帖子！](http://www.drwpf.com/blog/Home/tabid/36/EntryID/20/Default.aspx)

以下是他提供的一些“提示”：

*   您应该始终知道所有者类对您借用的任何财产做了什么。
*   您应该注意默认值和继承。有时您需要一个默认值为 true 的 bool 属性......其他时候您可能需要默认值为 false。有时您需要一个继承的属性……有时您明确不想要继承。（借用 TextElement.FontSize 之类的属性确实会搞砸树中较低的位置。）
*   所有者类有时可能会定义一个 PropertyChangedCallback，它会干扰您随意使用该属性的能力。始终知道所有者类对属性做了什么。
*   所有者类可能会为阻止您输入要指定的值的属性提供验证例程。同样，始终知道所有者类对属性做了什么。该属性可以以一种使其性能成本高昂的方式注册，例如 FixedPage.Bottom ，只要对象上的属性发生更改，它就会使父级的排列无效。有时你可能明确地想要这种行为......其他时候它只会不必要地导致布局通过。同样，始终知道所有者类对属性做了什么。
*   如果您在框架本身尝试使用该属性的场景中使用该属性（例如 ItemsControl 上的 TextSearch.TextPath），您很可能会发现自己与框架发生争用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T19:49:06.270

I'd just keep creating my own dependency properties, personally. It really isn't much extra work, and then you don't have to worry about any of the possible caveats.

# sql - 我可以使用 JOIN 或 EXISTS 获得更好的性能吗？

> ID：227037
> 
> 赞同：35
> 
> 时间：2008-10-22T18:36:26.820
> 
> 标签：sql, performance

我有两张表机构和结果，我想看看是否有任何机构的结果，这样我就可以排除那些没有结果的机构。

我可以使用 JOIN 或 EXISTS 获得更好的性能吗？

谢谢你，
-尼梅什

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-22T19:39:56.207

根据语句、统计信息和数据库服务器，它可能没有区别——可能会产生相同的优化查询计划。

数据库在后台连接表的方式基本上有 3 种：

*   嵌套循环 - 对于一个比第二个大得多的表。较小表中的每一行都会检查较大表中的每一行。

*   合并 - 用于具有相同排序顺序的两个表。两者都按顺序运行并在它们对应的位置匹配。

*   哈希 - 其他一切。临时表用于建立匹配。

通过使用存在，您可以有效地强制查询计划执行嵌套循环。这可能是最快的方法，但您确实希望查询规划器来决定。

我会说您需要编写两个 SQL 语句并比较查询计划。您可能会发现它们的变化很大，具体取决于您拥有的数据。

例如，如果 [Institutions] 和 [Results] 的大小相似，并且都聚集在机构 ID 上，则合并连接将是最快的。如果 [Results] 比 [Institutions] 大得多，则嵌套循环可能会更快。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-22T18:44:46.040

这取决于。

最终，两者的目的完全不同。

您加入 2 个表以访问相关记录。如果您不需要访问相关记录中的数据，则无需加入它们。

EXISTS 可用于确定给定数据集中是否存在令牌，但不允许您访问相关记录。

发布您想到的两种方法的示例，我可能会给您一个更好的主意。

* * *

使用您的两个表机构和结果，如果您想要一个有结果的机构列表，这个查询将是最有效的：

```
select Institutions.institution_name 
from Institutions
inner join Results on (Institutions.institution_id = Results.institution_id) 
```

如果您有一个机构 ID，并且只想知道它是否有结果，使用 EXISTS 可能会更快：

```
if exists(select 1 from Results where institution_id = 2)
  print "institution_id 2 has results"
else
  print "institution_id 2 does not have results" 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-22T19:36:34.077

这取决于您的优化器。我在 Oracle 10g 和 11g 中尝试了以下两个。在 10g 中，第二个稍快一些。在 11g 中，它们是相同的。

但是，#1 实际上是对 EXISTS 子句的误用。使用连接查找匹配项。

```
select *
from
  table_one t1
where exists (
             select *
             from table_two t2
             where t2.id_field = t1.id_field
             )
order by t1.id_field desc

select t1.*
from 
  table_one t1
 ,table_two t2
where t1.id_field = t2.id_field
order by t1.id_field desc 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-22T18:50:54.700

无论是否存在性能差异，您都需要使用更适合您的目的的东西。您的目的是获取机构列表（而不是结果 - 您不需要额外的数据）。所以选择没有结果的机构...翻译 - 使用 EXISTS。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-22T18:46:43.163

我会说 JOIN 速度较慢，因为只要 EXISTS 调用找到某些内容，您的查询执行就会停止，而 JOIN 将一直持续到最后。

编辑：但这取决于查询。这是应该根据具体情况来判断的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-22T20:13:52.147

LEFT OUTER JOIN 的性能往往比 NOT EXISTS** 好，但在您的情况下，您想做 EXISTS 并且使用简单的 INNER JOIN 并不能完全复制 EXISTS 行为。如果您有一个机构的多个结果，执行 INNER JOIN 将返回该机构的多行。你可以通过使用 DISTINCT 来解决这个问题，但是无论如何 EXISTS 可能会更好地提高性能。

** 对于不熟悉此方法的人：

```
SELECT
     MyTable.MyTableID
FROM
     dbo.MyTable T1
LEFT OUTER JOIN dbo.MyOtherTable T2 ON
     T2.MyTableID = T1.MyTableID
WHERE
     T2.MyOtherTableID IS NULL 
```

相当于

```
SELECT
     MyTable.MyTableID
FROM
     dbo.MyTable T1
WHERE NOT EXISTS (SELECT * FROM MyOtherTable T2 WHERE T2.MyTableID = T1.MyTableID) 
```

假设 MyOtherTableID 是 NOT NULL 列。不过，第一种方法通常比 NOT EXISTS 方法执行得更快。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T22:19:56.603

如果 RESULTS 表中的每行不止一行`INSTITUTION`，`EXISTS()`则还有一个额外的好处是不需要您选择不同的机构。

至于性能，我已经看到`joins, IN(), and EXISTS()`每一个在各种用途中都是最快的。要找到适合您的目的的最佳方法，您必须进行测试。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-22T18:50:05.653

您是否使用 EXISTS 作为相关子查询的一部分？如果是这样，连接几乎总是会更快。

您的数据库应该有基准查询的方法。使用它们来查看哪个查询运行得更快。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-22T20:00:29.117

实际上，从您对问题的模糊描述来看，在我看来，NOT IN 查询是最明显的编码方式：

```
SELECT *
  FROM Institutions
  WHERE InstitutionID NOT IN (
     SELECT DISTINCT InstitutionID
       FROM Results
     ) 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-04-03T06:55:35.810

在上述情况下，Exists 语句的运行速度比 Joins 快。Exists 会给你一个记录，也会节省时间。在连接的情况下，记录的数量将更多，并且必须使用所有记录。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-22T18:42:57.977

如果您指的是使用左（或右）外连接或不存在的子查询，我相当肯定左外连接在性能方面获胜。例如：

`SELECT t1.* FROM table1 t1 LEFT OUTER JOIN table2 t2 ON t1.id = t2.id WHERE t2.id IS NULL`

以上应该比等效的子查询更快，并且如果您专门指的是存在 - 好吧，在结构允许的情况下，内部连接将始终是首选选项。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-22T19:28:37.980

如果您想要没有结果的机构，那么“Where Not Exists”子查询会更快，因为它会在为那些有结果的机构找到一个结果时立即停止......

如果你想要机构有结果，但你实际上并不想要结果，同样的事情。使用“存在位置”子查询。它会在找到单个结果后立即停止...这也确保结果集每个机构只有一条记录，而如果您的机构有多个结果，则使用加入方法将要求您添加“distinct”关键字或“Group By”子句，以消除从与单个机构匹配的多个结果记录中产生的重复 cartesion 产品行。

如果您需要结果，则执行 JOIN - 如果您不想查看没有结果的机构，则执行内部联接；如果您想查看所有机构，包括没有结果的机构，请执行外部联接。

# visual-studio-2008 - 如何使用调试从同一解决方案中的测试项目进入 Web 应用程序中的类？

> ID：227048
> 
> 赞同：1
> 
> 时间：2008-10-22T18:38:29.500
> 
> 标签：visual-studio-2008, unit-testing, tdd, nunit, testdriven.net

在使用 NUnit 和测试项目时，我们无法找到一种方法来进入我们在 Web 应用程序中测试的类。我们正在为 Visual Studio 2008 使用 TestDriven.NET 加载项。我们能够在测试项目中命中断点，但无法进入正在测试的 Web 应用程序类。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T18:45:33.493

您可能必须手动将调试器附加到 IIS 或内置 Web 服务器进程，具体取决于您正在开发的 Web 应用程序类型。使用“调试”菜单“附加到进程...”在单元测试中遇到断点后，手动附加调试器。

当然，这是假设您尝试访问仅在 Web 应用程序运行时才有效的类（例如 Web 服务）。

如果是这种情况，您可能需要查看模拟框架，例如[Moq](http://code.google.com/p/moq/)或[RhinoMocks](http://ayende.com/projects/rhino-mocks.aspx)，以便您的测试可以独立于此类依赖项执行。

如果它的类即使在主机应用程序（IIS 或内置 Web 服务器进程）未运行时也有效，那么很可能是因为编译和符号生成发生在调试器已经运行附加到您的单元测试之后。在这种情况下，一个简单的解决方法是将类物理分离到其自己的类库程序集中，然后从 Web 应用程序项目中引用该程序集（项目）。

# asp.net - 周围块的最佳服务器控制

> ID：227064
> 
> 赞同：0
> 
> 时间：2008-10-22T18:42:31.770
> 
> 标签：asp.net, servercontrols

我想知道人们通常使用什么服务器控件来围绕和分隔 Web 窗体场景中的相关控件和内容块。很多时候，我需要用一个“面板”围绕一个 HTML 块和相关的服务器控件，我可以根据后面代码中的一些 UI 逻辑来显示或隐藏它。我通常会遇到使用面板的情况，但是如果我需要在表格中包围多个 TR，这将不起作用，例如，因为面板呈现为在 Table 标签内无效的 div。在这种情况下，我通常只是将每个 TR 设置为 runat server 并单独显示/隐藏它们，但必须有更好的方法。我已经看到用于此场景的 PlaceHolder 控件，但想知道是否有人这样做或有任何其他建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T04:25:53.057

我不认为有一个适用于所有场景的单一答案——我们没有数百种工具，因此我们总是可以使用锤子。

当生成的 div 可以正常工作时，面板非常有用。PlaceHolder 继承自 Control 而不是 WebControl，因此您可以提出它使用较少开销的论点。当我有一个表并且需要隐藏一个单独的表行时，我也不会对添加和 id 和 runat="server" 到 tr 感到内疚。

或者，当我需要制作一个很大的编辑器控件表时（这适合 90% 的我想要隐藏单个表行的情况），我什至制作了一个控件，可以为我自动执行一些标记. 该控件使字段标题文本自动化，无论是否将其设为粗体（必需），添加带有滚动工具提示的帮助气泡，而我必须手动添加的只是文本框或其他编辑器控件。积极的副作用是我的自定义控件为我提供了一个 ID，我也可以将其设置为 Visible。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T18:46:18.547

即使使用 PlaceHolder 控件，Visual Studio 也会抱怨您没有有效的 HTML。

您可能会咬紧牙关，通过服务器端代码块来访问后面代码的属性：

```
<table>
  <tr>
     ....
  </tr>

  <% if( ShowSecretRow ) { %>

  <tr>
    <td>shhh!</td>
  </tr>

  <% } %>
</table> 
```

不过要小心……这是一个滑坡，你不希望你的 ASPX 太复杂。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T18:51:09.363

也许是字面控制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T18:56:31.723

你可以使用任何你想要的 html 元素，只要给它一个 id 和 runat 服务器。这给了你一些灵活性。

# c# - C# 扩展

> ID：227066
> 
> 赞同：2
> 
> 时间：2008-10-22T18:42:57.320
> 
> 标签：c#, extension-methods

我通常非常谨慎地使用扩展方法。当我确实觉得有必要编写扩展方法时，有时我想重载该方法。我的问题是，您对调用其他扩展方法的扩展方法有何看法？不好的做法？感觉不对，但我无法真正定义原因。

例如，第二个 CaselessIs 方法调用第一个：

```
public static bool CaselessIs(this string s, string compareTo)
{
    return string.Compare(s, compareTo, true) == 0;
}

public static bool CaselessIs(this string s, IEnumerable<string> compareTo)
{
    foreach(string comparison in compareTo)
    {
        if (s.CaselessIs(comparison))
        {
            return true;
        }
    }

    return false;
} 
```

不这样做会更合适吗？缺点是它违反了 DRY。

```
public static bool CaselessIs(this string s, string compareTo)
{
    return string.Compare(s, compareTo, true) == 0;
}

public static bool CaselessIs(this string s, IEnumerable<string> compareTo)
{
    foreach(string comparison in compareTo)
    {
        if (string.Compare(s, comparison, true) == 0)
        {
            return true;
        }
    }

    return false;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-22T18:53:16.397

我不得不说 DRY 在这里控制。就个人而言，我认为扩展方法调用另一个扩展方法没有任何问题，特别是如果另一个扩展包含在同一个程序集中。总而言之，方法调用只是由编译器从：

```
extended.ExtensionMethod(foo); 
```

到：

```
StaticType.ExtensionMethod(extended, foo); 
```

我没有看到将两个静态方法链接在一起有任何问题，因此，我认为链接两个扩展方法没有问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T18:52:11.563

个人觉得没啥问题，我觉得第二种情况感觉更不对......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T18:53:51.903

完全正确。为什么应该是错的？

当您定义扩展方法时，您隐含地针对 3.0 框架（实际上是新语言的编译器扩展），因此仅使用另一个扩展来完成工作没有任何问题。

查看评论，任何版本都没有错，即使“其他”扩展在另一个库中，至少在“使用”另一个扩展的意义上不是。扩展只是一种语法功能，有助于更好地理解代码之间的底层逻辑，向类添加一些常用操作......实际上它们只是对方法的屏蔽调用，这样你应该应用与你使用的完全相同的限制与方法调用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T18:53:20.170

我自己对此没有任何问题 - 但是，如果它让您感觉更好，您当然可以使用静态版本：

```
public static bool CaselessIs(this string s, IEnumerable<string> compareTo)
{
   foreach(string comparison in compareTo)
   {
      if (Extensions.CaselessIs(s, comparison))
      {
         return true;
      }
   }

   return false;
} 
```

就我个人而言，在这个例子中，我会称它为 CaselessMatches，并且将单数称为复数......但我想这只是挑剔。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T18:54:28.797

我看不出有什么问题。假设您创建了一个 someClass.ToMySpecialString()。如果 someClass.ToString() 已经有多个重载，为什么不能重载它？

# automation - 具有“管道”支持的持续集成工具？

> ID：227069
> 
> 赞同：2
> 
> 时间：2008-10-22T18:43:36.087
> 
> 标签：automation, continuous-integration, build-automation, automated-tests

我们的自动化构建和测试正在占用越来越多的资源，特别是因为我们支持许多平台并在调试和优化中进行测试。因此，我正在寻找一些工具支持，以允许更多增量的“管道”方法，以便我们可以更快地获得反馈和结果。一些理想的特征包括：

1.  支持增量反馈，因此我们可以在可用时查看构建、单元测试、快速测试、长时间运行测试、静态分析等的结果。

2.  任务依赖性：如果构建失败，则不应运行测试，但可以运行其他任务（如 lint 或其他东西）。

3.  支持多种构建和测试工具（包括自定义）。

4.  支持多种平台（Linux、Mac，可能还有 Windows）。

5.  一些归档能力会很棒，比如日志文件、构建/测试输出等。自然地，这可能会变得难以管理，因此理想情况下，一些数据会在 X 天或 Y 多次构建后被清除。

非常感谢任何指针或个人建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T18:45:23.930

您可能想看看[Jenkins（以前称为 Hudson）](http://jenkins-ci.org/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T18:49:38.027

我一直在使用[Anthill](http://www.anthillpro.com/html/default.html)，但您必须为此付费。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T18:52:59.250

[我认为， Automated Build Studio](http://www.automatedqa.com/products/abs/index.asp)很接近，尽管它可能不是您的选择，因为它仅适用于 Windows。

1.  是的。Web 前端在构建运行时提供增量反馈，包括详细信息和百分比。
2.  是的。构建过程是任务的层次结构。您可以确定任务是失败继续还是失败中止。
3.  是的。任务几乎可以是任何东西。随附的任务工具箱非常完整。
4.  不可以。构建服务器必须是 Windows 机器。但是，您可以从 Web 前端开始构建。
5.  是的。每个构建都被详细记录，分层，因此很容易查明每一步发生的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T19:01:07.020

我认为[buildbot](http://buildbot.net/trac)会做你想做的一切：

1.  Web 前端显示命令的输出。
2.  完整的任务依赖
3.  完全自定义的工具 - python 脚本，但主要是 shell 脚本
4.  目前我们在 Linux、Mac、Solaris、HP-UX 上使用它
5.  它记录了一切，我不知道它如何/是否清除了东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-17T12:17:47.207

必须同意 thinkworks 选项 - 转到“敏捷发布管理” [http://www.thoughtworks-studios.com/go-agile-release-management](http://www.thoughtworks-studios.com/go-agile-release-management)

有一个社区版（免费）和企业版中的一些不错的功能，例如环境配置和将特定工件（版本）部署到特定环境。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T08:54:08.570

我的 JetBrains TeamCity 设置近似于您的需要。

在一个项目下，我设置了多个不同的构建配置。

每个构建配置之间的区别在于构建目标的选择（我使用 NAnt）和触发。

我有一个“XYZ 集成”配置，它进行调试构建并运行一些 NUnit 测试。这会在签入完成 60 秒后触发，向开发团队提供快速反馈。

我还有一个“XYZ Daily”配置，它进行调试构建，运行 NUnit 测试，然后构建一些 MSI 并编译一些文档。正如您可能猜到的那样，它每天运行一次。

您也可以这样做，但配置范围更广。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T21:28:30.650

我们使用[Hericus Software 的](http://www.hericus.com/) [Zed Builds and Bugs Management](http://www.hericus.com/products_builds.html)，它可以处理您所描述的内容。我们的主要构建包括超过 61 个独立的步骤，涵盖 Java、C++、C# 的编译和 5 个不同操作系统平台的安装构建。有些步骤是并行执行的，有些可能会失败而不会导致整个构建失败，并且许多步骤是在不同的机器上远程执行的。

1) 是的。当为构建执行这些步骤时，您可以立即看到该步骤的结果，而无需等待整个构建完成。

2) 是的。您可以定义步骤失败是否导致完全构建失败。创建由“父”或“主”构建调用的“子”或“子”构建的能力允许极大的灵活性。

3) 是的。我们正在使用 makefile、ant、C# 解决方案和几个自定义脚本，它们都集成得很好。

4) 是的。构建服务器是 java 并且只需要 1.6 JDK，因此任何平台都可以用于主构建服务器或附属构建服务器。

5) 是的。复制到构建“状态”目录中的所有内容都会被保存。这包括可以从网站查看的命令标准输出/错误。您可以根据构建数量选择要保留多少“开发”构建历史。一个构建也可以提升为“QA”，在这种情况下，它不会被删除，直到它从“QA”中删除。从 QA 中，您可以将构建提升为“生产”，这将保留所有构建工件，直到您决定删除它们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-29T07:03:39.030

请尝试来自 Thoughtworks 的 Cruise

# algorithm - 最优矩形阴影算法

> ID：227071
> 
> 赞同：0
> 
> 时间：2008-10-22T18:44:39.923
> 
> 标签：algorithm, math, mathematical-optimization

我正在寻找一种算法来填充具有最短总线长度的矩形，以便给定区域的对象可以通过阴影。

例如，给定一个 5x3 厘米的矩形，我使用 1 厘米宽的平行线进行孵化，我可以通过孵化的最大物体是边长为 1 厘米的正方形。我使用了总共​​ 22 厘米（即 4x3+2x5）的阴影线。因此，为了通过 1 平方厘米的面积，我使用了 22 厘米的孵化线。

该算法应该找到一种模式，使当前 22cm 的整体阴影线最小化，同时不允许超过 1sqcm 的区域通过（对象不必是正方形甚至矩形的形式，重要的是整体区域）。

**编辑：**在 nlucaroni 的带领下，我发现了[蜂窝猜想](http://mathworld.wolfram.com/HoneycombConjecture.html)，该猜想指出，将平面划分为相等面积的区域的周长至少与正六边形网格的周长相同，这部分回答了我的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T19:19:02.740

您需要形成[镶嵌](http://mathworld.wolfram.com/Tessellation.html)的形状。Hexagon 可能是您最好的选择。但是，如果您通过的形状不完全符合镶嵌图案怎么办？

查看镶嵌并确定您的图案/屏幕/阴影是否必须是规则的，是否必须适合正在测试的对象等等。

如果实际上你是从形成面积 = 1 的无限直线构建它，那么你能做的最好的就是一个正方形（继续，找到面积相对于边比的最大值，或者找到周长通过取导数得到边比）。

您的问题非常模糊/不完整，s，这就是我为您准备的全部内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T19:29:36.620

整洁的问题。不过，我怀疑该算法最终会变得非常简单 - 必须使用一些“最佳”的屏幕角度集，以最小化给定长度的电线的开口尺寸。

实际上，这让我想起了切蛋糕的问题，你试图找到最小数量的直切来制作 x 片蛋糕。因此，解决方案可能是这样的，对于每根电线，尽量减小可以通过的最大物体的尺寸。这意味着在可能的情况下，用每根添加的电线将最大的“孔”切成两半。

编辑：当我实际尝试我提出的算法时，我得到的结果比天真的版本更差。放置电线时，您绝对需要考虑最小尺寸。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T19:23:41.640

孵化一个矩形是什么意思？

你能改写你的问题吗？

此外，在重新措辞期间，说明算法应该接收什么作为输入以及它应该产生什么作为输出。

# ios - 在 UIToolbar 上创建左箭头按钮（如 UINavigationBar 的“后退”样式）

> ID：227078
> 
> 赞同：292
> 
> 时间：2008-10-22T18:45:42.357
> 
> 标签：ios, iphone, cocoa-touch, uinavigationbar, uitoolbar

我很想在`UIToolbar`.

据我所知，获得其中之一的唯一方法是保留`UINavigationController`默认设置，并将其用于左侧栏项目。但是我无法找到将其创建为 a 的方法`UIBarButtonItem`，因此我无法在标准中创建一个`UIToolbar`，即使它们与`UINavigationBar`s 非常相似。

我可以使用按钮图像手动创建它，但我无法在任何地方找到源图像。它们具有 alpha 通道边缘，因此截屏和剪切不会得到非常通用的结果。

对于我打算使用的每种尺寸和配色方案，除了截图之外还有什么想法吗？

**更新：**请停止回避这个问题并暗示我不应该问这个，应该使用`UINavigationBar`. 我的应用是 Instapaper Pro。它只显示一个底部工具栏（以节省空间并最大化可读内容区域），我希望在底部放置一个左箭头形的后退按钮。

告诉我我不应该这样做**不是答案**，当然也不值得赏金。

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2009-02-22T12:44:06.223

我使用了以下来自[http://www.teehanlax.com/blog/?p=447的 psd](http://www.teehanlax.com/blog/?p=447)

[http://www.chrisandtennille.com/pictures/backbutton.psd](http://www.chrisandtennille.com/pictures/backbutton.psd)

然后，我刚刚创建了一个自定义 UIView，我在工具栏项的 customView 属性中使用它。

对我来说效果很好。

* * *

*编辑：正如* [*PrairieHippo*](https://stackoverflow.com/questions/227078/creating-a-left-arrow-button-like-uinavigationbars-back-style-on-a-uitoolba/3985773#comment12106974_3985773)[所指出的](https://stackoverflow.com/questions/227078/creating-a-left-arrow-button-like-uinavigationbars-back-style-on-a-uitoolba/3985773#comment12106974_3985773)*，*maralbjo*发现使用以下简单代码可以解决问题（需要捆绑中的自定义图像）应该与此答案结合使用。所以这里是附加代码：*

 *```
// Creates a back button instead of default behaviour (displaying title of previous screen)
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"back_arrow.png"]
                                                               style:UIBarButtonItemStyleBordered
                                                              target:self
                                                              action:@selector(backAction)];

tipsDetailViewController.navigationItem.leftBarButtonItem = backButton;
[backButton release]; 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2010-08-04T14:04:49.717

## Unicode 方法

我认为只使用 unicode 字符来完成工作要容易得多。您可以通过谷歌搜索[Unicode Triangles](http://www.fileformat.info/info/unicode/block/geometric_shapes/list.htm)或[Unicode Arrows](http://www.fileformat.info/info/unicode/block/arrows/list.htm)来查看箭头。从 iOS6 开始，Apple 将字符更改为带边框的 emoji 字符。要禁用边框，我添加了 0xFE0E [Unicode Variation Selector](https://stackoverflow.com/questions/4974668/what-is-the-unicode-variation-selector)。

```
NSString *backArrowString = @"\U000025C0\U0000FE0E"; //BLACK LEFT-POINTING TRIANGLE PLUS VARIATION SELECTOR

UIBarButtonItem *backBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:backArrowString style:UIBarButtonItemStylePlain target:nil action:nil];
self.navigationItem.leftButtonItem = backBarButtonItem; 
```

代码块仅用于演示。它适用于任何接受 NSString 的按钮。

有关字符的完整列表，请在 Google 中搜索 Unicode 字符和您想要的字符。这是[Black Left-Pointing Triangle](http://www.fileformat.info/info/unicode/char/25c0/index.htm)的条目。

## 结果

![结果](https://i.stack.imgur.com/C2IPg.png)

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2010-08-06T18:48:56.690

**警告：**有报道称这不适用于 iOS 6。这可能仅适用于旧版本的操作系统。显然，至少有一个开发者的应用程序因为使用了这个技巧而被拒绝（见评论）。使用风险自负。使用图像（参见上面的答案）可能是更安全的解决方案。

这可以在不使用 sekr1t 按钮类型 101 添加您自己的图像文件的情况下完成，以获得正确的形状。对我来说，诀窍是弄清楚我可以`initWithCustomView`用来创建`BarButtonItem`. 我个人需要将其用于动态导航栏而不是`toolbar`，但我使用工具栏对其进行了测试，并且代码几乎相同：

```
// create button
UIButton* backButton = [UIButton buttonWithType:101]; // left-pointing shape!
[backButton addTarget:self action:@selector(backAction) forControlEvents:UIControlEventTouchUpInside];
[backButton setTitle:@"Back" forState:UIControlStateNormal];

// create button item -- possible because UIButton subclasses UIView!
UIBarButtonItem* backItem = [[UIBarButtonItem alloc] initWithCustomView:backButton];

// add to toolbar, or to a navbar (you should only have one of these!)
[toolbar setItems:[NSArray arrayWithObject:backItem]];
navItem.leftBarButtonItem = backItem; 
```

如果您在工具栏上执行此操作，则必须调整设置项目的方式，但这取决于您的其余代码，我将其作为练习留给读者。:P 这个示例对我有用（编译并运行）。

等等，阅读 HIG，不要使用未记录的功能，等等。只有六种受支持的按钮类型，这不是其中之一。

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2013-09-18T13:57:02.200

![在此处输入图像描述](https://i.stack.imgur.com/8mPcu.png)

首先，您必须找到后退按钮的图像。我使用了一个名为[Extractor](https://github.com/0xced/iOS-Artwork-Extractor)的不错的应用程序，它可以从 iPhone 中提取所有图形。在**iOS7 中**，我设法检索到名为的图像`UINavigationBarBackIndicatorDefault`，它是黑色的，因为我需要红色调，所以我~~使用 Gimp 将颜色更改为红色。~~

**编辑：**

正如[btate](https://stackoverflow.com/users/450847/btate)在他的评论中提到的那样，无需使用图像编辑器更改颜色。以下代码应该可以解决问题：

```
imageView.tint = [UIColor redColor];
imageView.image = [[UIImage imageNamed:@"UINavigationBarBackIndicatorDefault"] imageWithRenderingMode:UIImageRenderingModeAlwaysTemplate]; 
```

然后我创建了一个视图，其中包含一个带有该箭头的 imageView、一个带有自定义文本的标签，并且在视图顶部我有一个带有操作的按钮。然后我添加了一个简单的动画（淡入淡出和平移）。

以下代码模拟后退按钮的行为，包括动画。

```
-(void)viewWillAppear:(BOOL)animated{
        UIImageView *imageView=[[UIImageView alloc] initWithImage:[UIImage imageNamed:@"UINavigationBarBackIndicatorDefault"]];
        [imageView setTintColor:[UIColor redColor]];
        UILabel *label=[[UILabel alloc] init];
        [label setTextColor:[UIColor redColor]];
        [label setText:@"Blog"];
        [label sizeToFit];

        int space=6;
        label.frame=CGRectMake(imageView.frame.origin.x+imageView.frame.size.width+space, label.frame.origin.y, label.frame.size.width, label.frame.size.height);
        UIView *view=[[UIView alloc] initWithFrame:CGRectMake(0, 0, label.frame.size.width+imageView.frame.size.width+space, imageView.frame.size.height)];

        view.bounds=CGRectMake(view.bounds.origin.x+8, view.bounds.origin.y-1, view.bounds.size.width, view.bounds.size.height);
        [view addSubview:imageView];
        [view addSubview:label];

        UIButton *button=[[UIButton alloc] initWithFrame:view.frame];
        [button addTarget:self action:@selector(handleBack:) forControlEvents:UIControlEventTouchUpInside];
        [view addSubview:button];

        [UIView animateWithDuration:0.33 delay:0 options:UIViewAnimationOptionCurveLinear animations:^{
            label.alpha = 0.0;
            CGRect orig=label.frame;
            label.frame=CGRectMake(label.frame.origin.x+25, label.frame.origin.y, label.frame.size.width, label.frame.size.height);
            label.alpha = 1.0;
            label.frame=orig;
        } completion:nil];

        UIBarButtonItem *backButton =[[UIBarButtonItem alloc] initWithCustomView:view];
}

- (void) handleBack:(id)sender{
} 
```

**编辑：**

而不是添加按钮，在我看来，更好的方法是使用手势识别器。

```
UITapGestureRecognizer* tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(handleBack:)];
[view addGestureRecognizer:tap];
[view setUserInteractionEnabled:YES]; 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-02-24T03:21:28.883

我不确定这是否可行，但您可以尝试`UINavigationController`使用默认设置创建按钮，在导航控制器的子视图层次结构中找到按钮，调用`removeFromSuperview`它，销毁导航控制器，然后将按钮添加为工具栏的子视图。您可能还需要`retain`在调用之前和按钮`removeFromSuperview`（然后`release`在将其添加为工具栏的子视图之后）以避免在此过程中释放它。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2014-08-21T06:08:40.683

使带有箭头的 UIButton 与 iOS 7 系统后退箭头非常接近（我不是设计师；）：

标准：

![标准系统后退箭头](https://i.stack.imgur.com/UJ0uL.png)

苹果 SD 哥特式 Neo

![Apple SD Gothic Neo < 字符](https://i.stack.imgur.com/FNJ1W.png)

在 Xcode 中：

*   关注按钮的标题值字段（或任何其他带有文本内容的视图/控件）
*   打开编辑 -> 特殊字符
*   选择括号组并双击“<”字符
*   将字体更改为：Apple SD Gothic Neo，Regular，具有所需大小（例如 20）
*   随心所欲地改变颜色

参考[@staticVoidMan](https://stackoverflow.com/a/20688668/455225)对 iOS 7 上类似 Back-like 箭头的回答

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2016-01-15T02:41:42.097

[![后退箭头](https://i.stack.imgur.com/4ByUK.png)](https://i.stack.imgur.com/4ByUK.png)

如果您不想打扰图像文件，可以使用以下代码在 UIView 子类中绘制箭头形状：

```
- (void)drawRect:(CGRect)rect {
    float width = rect.size.width;
    float height = rect.size.height;
    CGContextRef context = UIGraphicsGetCurrentContext();

    CGContextBeginPath(context);
    CGContextMoveToPoint(context, width * 5.0/6.0, height * 0.0/10.0);
    CGContextAddLineToPoint(context, width * 0.0/6.0, height * 5.0/10.0);
    CGContextAddLineToPoint(context, width * 5.0/6.0, height * 10.0/10.0);
    CGContextAddLineToPoint(context, width * 6.0/6.0, height * 9.0/10.0);
    CGContextAddLineToPoint(context, width * 2.0/6.0, height * 5.0/10.0);
    CGContextAddLineToPoint(context, width * 6.0/6.0, height * 1.0/10.0);
    CGContextClosePath(context);

    CGContextSetFillColorWithColor(context, [UIColor blackColor].CGColor);
    CGContextFillPath(context);
} 
```

其中箭头视图与 6.0 的宽度和 10.0 的高度成正比

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-01-31T18:52:12.183

```
 self.navigationItem.leftBarButtonItem = self.navigationItem.backBarButtonItem; 
```

为我工作。当我有更多选项卡然后可以放在选项卡栏上时，我使用了它，并且从“更多”推送的视图控制器覆盖了其 viewDidLoad 中的 leftBarButtonItem。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-02-24T03:09:18.210

您可以通过从 UIKit ${SDKROOT}/System/Library/Frameworks/UIKit.framework/Other.artwork 中的 Other.artwork 中提取它们来找到源图像。改装社区有一些提取它们的工具，[在这里](http://www.modmyi.com/forums/skinning-themes-discussion/425091-new-iphoneshop-1-22-supports-all-2-2-artwork.html)。提取图像后，您可以编写一些代码来根据需要重新着色并将其设置为按钮图像。您是否真的可以运送这样的东西（因为您正在嵌入派生的艺术品）可能有点冒险，所以也许您想和律师谈谈。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-11-19T21:29:16.847

Three20 库有一种方法可以做到这一点：

```
 UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithTitle: @"Title" style:UIBarButtonItemStylePlain 
                                                                target:self action:@selector(foo)];

  UIColor* darkBlue = RGBCOLOR(109, 132, 162);

  TTShapeStyle* style = [TTShapeStyle styleWithShape:[TTRoundedLeftArrowShape shapeWithRadius:4.5] next:
    [TTShadowStyle styleWithColor:RGBCOLOR(255,255,255) blur:1 offset:CGSizeMake(0, 1) next:
    [TTReflectiveFillStyle styleWithColor:darkBlue next:
    [TTBevelBorderStyle styleWithHighlight:[darkBlue shadow]
                                     shadow:[darkBlue multiplyHue:1 saturation:0.5 value:0.5]
                                      width:1 lightSource:270 next:
    [TTInsetStyle styleWithInset:UIEdgeInsetsMake(0, -1, 0, -1) next:
    [TTBevelBorderStyle styleWithHighlight:nil shadow:RGBACOLOR(0,0,0,0.15)
                                        width:1 lightSource:270 next:nil]]]]]];

  TTView* view = [[[TTView alloc] initWithFrame:CGRectMake(0, 0, 80, 35)] autorelease];
  view.backgroundColor = [UIColor clearColor];
  view.style = style;
  backButton.customView = view;

  self.navigationItem.leftBarButtonItem = backButton; 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-10-21T08:58:16.530

我发现使用以下简单的代码可以解决问题（需要捆绑包中的自定义图像）：

```
// Creates a back button instead of default behaviour (displaying title of previous screen)
    UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"back_arrow.png"]
                                                                   style:UIBarButtonItemStyleBordered
                                                                  target:self
                                                                  action:@selector(backAction)];

    tipsDetailViewController.navigationItem.leftBarButtonItem = backButton;
    [backButton release]; 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-05-25T04:23:57.220

这是我在搜索所有这些解决方案和其他解决方案后最终做的事情。它使用从 UIKit 库存图像中提取的可拉伸 png。这样，您可以将文本设置为您喜欢的任何内容

```
// Generate the background images
UIImage *stretchableBackButton = [[UIImage imageNamed:@"UINavigationBarDefaultBack.png"] stretchableImageWithLeftCapWidth:14 topCapHeight:0];
UIImage *stretchableBackButtonPressed = [[UIImage imageNamed:@"UINavigationBarDefaultBackPressed.png"] stretchableImageWithLeftCapWidth:13 topCapHeight:0];
// Setup the UIButton
UIButton *backButton = [UIButton buttonWithType:UIButtonTypeCustom];
[backButton setBackgroundImage:stretchableBackButton forState:UIControlStateNormal];
[backButton setBackgroundImage:stretchableBackButtonPressed forState:UIControlStateSelected];
NSString *buttonTitle = NSLocalizedString(@"Back", @"Back");
[backButton setTitle:buttonTitle forState:UIControlStateNormal];
[backButton setTitle:buttonTitle forState:UIControlStateSelected];
backButton.titleEdgeInsets = UIEdgeInsetsMake(0, 5, 2, 1); // Tweak the text position
NSInteger width = ([backButton.titleLabel.text sizeWithFont:backButton.titleLabel.font].width + backButton.titleEdgeInsets.right +backButton.titleEdgeInsets.left);
[backButton setFrame:CGRectMake(0, 0, width, 29)];
backButton.titleLabel.font = [UIFont boldSystemFontOfSize:13.0f];
[backButton addTarget:self action:@selector(yourSelector:) forControlEvents:UIControlEventTouchDown];
// Now add the button as a custom UIBarButtonItem
UIBarButtonItem *backButtonItem = [[[UIBarButtonItem alloc] initWithCustomView:backButton] autorelease];
self.navigationItem.leftBarButtonItem = backButtonItem; 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2014-01-30T10:26:33.820

在**Xcode 5.x中使用*****Interface Builder***很容易

 **![结果](https://i.stack.imgur.com/z4pQO.png)

*   使用***对象库***中的**工具栏**和**栏按钮项**

     *![组件](https://i.stack.imgur.com/lXTrL.png)* 
**   在按钮的***属性检查****器中使用您的*后退按钮图像编辑**图像**部分

     *![属性检查器](https://i.stack.imgur.com/ZR9uh.png)** 

 ****完毕！**

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-09-03T21:34:41.520

我试图做同样的事情，但我希望后退按钮位于导航栏中。（我实际上需要一个后退按钮，这不仅仅是返回，所以我不得不使用 leftBarButtonItem 属性）。我尝试了 AndrewS 的建议，但在导航栏中，它看起来不像它应该的样子，因为 UIButton 有点被转换为 UIBarButtonItem。

但我找到了解决这个问题的方法。我实际上只是在 UIButton 下放了一个 UIView，并为 UIBarButtonItem 设置了 customView。这是代码，如果有人需要它：

```
// initialize button and button view
UIButton *backButton = [UIButton buttonWithType:101];
UIView *backButtonView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, backButton.frame.size.width, backButton.frame.size.height)];

[backButton addTarget:self action:@selector(backButtonTouched:) forControlEvents:UIControlEventTouchUpInside];
[backButton setTitle:@"Back" forState:UIControlStateNormal];
[backButtonView addSubview:backButton];

// set buttonview as custom view for bar button item
UIBarButtonItem *backButtonItem = [[UIBarButtonItem alloc] initWithCustomView:backButtonView];
self.navigationItem.leftBarButtonItem = backButtonItem;

// push item to navigationbar items
[self.navigationController.navigationBar setItems:[NSArray arrayWithObject:backButtonItem]]; 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-24T22:40:27.507

要为 UIToolbar 创建一个图像，请在 photoshop 中制作一个 png，然后在任何颜色的地方将其设置为白色，并且在 alpha = 0 的地方将其单独放置。

SDK 实际上会在您制作的图标周围放置边框并将其变为白色，而无需您执行任何操作。

看，这是我在 Photoshop 中为我的前进按钮制作的（显然将它换成后退按钮）：

[http://twitpic.com/1oanv](http://twitpic.com/1oanv)

这就是它在 Interface Builder 中的样子

[http://twitpic.com/1oaoa](http://twitpic.com/1oaoa)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-08-28T20:41:31.730

不使用 png 的解决方案。基于这个 SO 答案：[将小箭头添加到 iPhone TableView Cell 中单元格的右侧](https://stackoverflow.com/questions/6322798/adding-the-little-arrow-to-the-right-side-of-a-cell-in-an-iphone-tableview-cell)

只需水平翻转 UITableViewCell ！

```
UIButton *btnBack = [[UIButton alloc] initWithFrame:CGRectMake(0, 5, 70, 20)];

// Add the disclosure
CGRect frm;
UITableViewCell *disclosure = [[UITableViewCell alloc] init];
disclosure.transform = CGAffineTransformScale(CGAffineTransformIdentity, -1, 1);
frm = self.btnBack.bounds;
disclosure.frame = CGRectMake(frm.origin.x, frm.origin.y, frm.size.width-25, frm.size.height);
disclosure.accessoryType = UITableViewCellAccessoryDisclosureIndicator;
disclosure.userInteractionEnabled = NO;
[self.btnBack addSubview:disclosure];

// Add the label
UILabel *lbl = [[UILabel alloc] init];
frm = CGRectOffset(self.btnBack.bounds, 15, 0);
lbl.frame = frm;
lbl.textAlignment = NSTextAlignmentCenter;
lbl.text = @"BACK";
[self addSubview:lbl]; 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-04-26T10:08:49.457

**斯威夫特 5.2 Xcode 11.4**

Apple Symbol **chevron.left**现在允许更优雅的解决方案来制作自定义按钮。我已经尽可能地匹配大小和间距。

[![在此处输入图像描述](https://i.stack.imgur.com/X8VpJ.png)](https://i.stack.imgur.com/X8VpJ.png)

```
import UIKit

class CustomBackButton: UIBarButtonItem {

    convenience init(target: Any, selector: Selector) {

        // Create UIButton
        let button = UIButton(frame: .zero)

        // Customise Title
        button.setTitle("Back", for: .normal)
        button.setTitleColor(.systemBlue, for: .normal)
        button.titleLabel?.font = UIFont.systemFont(ofSize: 17)

        // Customise Image
        let config = UIImage.SymbolConfiguration(pointSize: 19.0, weight: .semibold, scale: .large)
        let image = UIImage(systemName: "chevron.left", withConfiguration: config)
        button.setImage(image, for: .normal)

        // Add Target
        button.addTarget(target, action: selector, for: .touchUpInside)

        // Customise Spacing to match system Back button
        button.imageEdgeInsets = UIEdgeInsets(top: 0.0, left: -18.0, bottom: 0.0, right: 0.0)
        button.titleEdgeInsets = UIEdgeInsets(top: 0.0, left: -12.0, bottom: 0.0, right: 0.0)

        self.init(customView: button)
    }
} 
```

这可以实现为 a`UIToolbarItem`或 a`UINavigationItem`

```
override func viewDidLoad() {
    super.viewDidLoad()

    // UIToolbar Item
    let barBackButton = CustomBackButton(target: self, selector: #selector(backButtonTapped))
    let flexSpace = UIBarButtonItem(barButtonSystemItem: .flexibleSpace, target: nil, action: nil)
    navigationController?.setToolbarHidden(false, animated: false)
    toolbarItems = [barBackButton, flexSpace]

    // Navigation Item
    let navBackButton = CustomBackButton(target: self, selector: #selector(backButtonTapped))
    navigationItem.leftBarButtonItem = navBackButton
}

@objc func backButtonTapped() {
    print("Back tapped")
} 
```

如果要翻转按钮并使箭头指向右侧：

[![在此处输入图像描述](https://i.stack.imgur.com/I1JQ3.png)](https://i.stack.imgur.com/I1JQ3.png)

使用名为**“chevron.right”的Apple 符号**

将以下代码添加到`CustomBackButton`类中：

```
 // Put the image of the right side of the button
    button.transform = CGAffineTransform(scaleX: -1.0, y: 1.0)
    button.titleLabel?.transform = CGAffineTransform(scaleX: -1.0, y: 1.0)
    button.imageView?.transform = CGAffineTransform(scaleX: -1.0, y: 1.0) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-22T19:02:37.873

好吧，您不必为每种尺寸都设置不同的按钮，您可以使用`[UIImage stretchableImageWithLeftCapWidth:topCapHeight:]`，但我发现的唯一内容是自定义图像。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-23T11:00:25.763

如果您想避免自己绘制它，您可以使用未记录的类：UINavigationButton 样式为 1。当然，这可能会阻止您的应用程序被批准... /John

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-07-30T08:26:59.217

我有一个类似的问题，并出来一个库[PButton](https://github.com/shuoli84/PButton)。示例是返回导航按钮，就像按钮一样，可以在任何地方使用，就像自定义按钮一样。

像这样的东西： ![在此处输入图像描述](https://i.stack.imgur.com/sNAXZ.png)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-01-09T14:25:29.047

Swift 3 中的示例，右上角有一个上一个和一个下一个按钮。

```
let prevButtonItem = UIBarButtonItem(title: "\u{25C0}", style: .plain, target: self, action: #selector(prevButtonTapped))
let nextButtonItem = UIBarButtonItem(title: "\u{25B6}", style: .plain, target: self, action: #selector(nextButtonTapped))
self.navigationItem.rightBarButtonItems = [nextButtonItem, prevButtonItem] 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-02-25T09:12:16.933

迅速

```
// create button
    var backButton = UIButton(type: 101)

    // left-pointing shape!
    backButton.addTarget(self, action: #selector(self.backAction), for: .touchUpInside)
    backButton.setTitle("Back", for: .normal)

    // create button item -- possible because UIButton subclasses UIView!
    var backItem = UIBarButtonItem(customView: backButton)

    // add to toolbar, or to a navbar (you should only have one of these!)
    toolbar.items = [backItem]
    navItem.leftBarButtonItem = backItem 
```

* * *

## 回答 #23

> 赞同：-5
> 
> 时间：2012-08-22T12:12:30.750

试试这个。我相信您不需要后退按钮图像来创建这样的图像。

```
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithTitle:@"Back"
                                                               style:UIBarButtonItemStyleBordered
                                                              target:self
                                                              action:@selector(yourSelectorGoesHere:)];
self.navigationItem.backBarButtonItem = backButton; 
```

这就是你所要做的:)

* * *

## 回答 #24

> 赞同：-23
> 
> 时间：2008-10-23T01:33:37.010

你为什么做这个？如果您想要看起来像导航栏的东西，请使用 UINavigationBar。

工具栏具有与之关联的特定视觉样式。iPhone 的人机界面指南状态：

> 工具栏出现在屏幕的底部边缘，其中包含执行与当前视图中的对象相关的操作的按钮。

然后它给出了几个没有文本的大致方形图标的视觉示例。我会敦促你在这方面关注 HIG。

# wpf - ControlTemplate 中的 ElementName 绑定损坏

> ID：227081
> 
> 赞同：1
> 
> 时间：2008-10-22T18:46:14.490
> 
> 标签：wpf, binding

我有带有分组项目的 ListView。分组使用自定义 GroupStyle (Expander)。我想要一个复选框，它会在何时展开和折叠所有组。在我手动单击组标题并展开或折叠该组之前，它工作正常。单击该特定组后停止响应复选框选择。用户手动单击组后，绑定似乎被破坏。

请告知我做错了什么。

非常感谢。

真诚的，弗拉德。

```
<Window xmlns='http://schemas.microsoft.com/winfx/2006/xaml/presentation'
        xmlns:x='http://schemas.microsoft.com/winfx/2006/xaml'>
    <Window.Resources>
        <XmlDataProvider x:Key="MyData" XPath="/Info">
            <x:XData>
                <Info xmlns="">
                    <Item Name="Item 1" Category="Cat1" />
                    <Item Name="Item 2" Category="Cat1" />
                    <Item Name="Item 3" Category="Cat2" />
                    <Item Name="Item 4" Category="Cat2" />
                    <Item Name="Item 5" Category="Cat2" />
                    <Item Name="Item 6" Category="Cat3" />
                </Info>
            </x:XData>
        </XmlDataProvider>

        <CollectionViewSource x:Key='src' Source="{Binding Source={StaticResource MyData}, XPath=Item}">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="@Category" />
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>

        <ControlTemplate x:Key="ListTemplate" TargetType="ListView">
            <ListView BorderThickness="0"
                      ItemsSource='{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ItemsSource}'
                      DisplayMemberPath="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=DisplayMemberPath}">
                <ListView.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.ContainerStyle>
                            <Style TargetType="{x:Type GroupItem}">
                                <Setter Property="Margin" Value="0,0,0,5" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type GroupItem}">
                                            <Expander IsExpanded="{Binding IsChecked, ElementName=chkExpandAll, Mode=OneWay}">
                                                <Expander.Header>
                                                    <DockPanel>
                                                        <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" Margin="5,0,0,0" Width="100" />
                                                        <TextBlock FontWeight="Bold" Text="{Binding Path=ItemCount}" />
                                                    </DockPanel>
                                                </Expander.Header>
                                                <Expander.Content>
                                                    <ItemsPresenter />
                                                </Expander.Content>
                                            </Expander>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.ContainerStyle>
                    </GroupStyle>
                </ListView.GroupStyle>
            </ListView>
        </ControlTemplate>
    </Window.Resources>

    <StackPanel>
        <CheckBox Name="chkExpandAll" IsChecked="True" Content="Expand All" />
        <ListView ItemsSource='{Binding Source={StaticResource src}}' DisplayMemberPath="@Name" BorderThickness="1" Template="{StaticResource ListTemplate}" />
    </StackPanel>

</Window> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T15:11:34.253

我找到了问题的解决方案。需要做的是指定 Mode=TwoWay 和 UpdateSourceTrigger=Explicit，这样就不会破坏 Binding 并且一切正常。Bellow 是一个工作代码的例子。

```
<Window xmlns='http://schemas.microsoft.com/winfx/2006/xaml/presentation'
        xmlns:x='http://schemas.microsoft.com/winfx/2006/xaml'>
    <Window.Resources>
        <XmlDataProvider x:Key="MyData" XPath="/Info">
            <x:XData>
                <Info xmlns="">
                    <Item Name="Item 1" Category="Cat1" />
                    <Item Name="Item 2" Category="Cat1" />
                    <Item Name="Item 3" Category="Cat2" />
                    <Item Name="Item 4" Category="Cat2" />
                    <Item Name="Item 5" Category="Cat2" />
                    <Item Name="Item 6" Category="Cat3" />
                </Info>
            </x:XData>
        </XmlDataProvider>

        <CollectionViewSource x:Key='src' Source="{Binding Source={StaticResource MyData}, XPath=Item}">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="@Category" />
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>

        <ControlTemplate x:Key="ListTemplate" TargetType="ListView">
            <ListView BorderThickness="0"
                      ItemsSource='{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ItemsSource}'
                      DisplayMemberPath="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=DisplayMemberPath}">
                <ListView.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.ContainerStyle>
                            <Style TargetType="{x:Type GroupItem}">
                                <Setter Property="Margin" Value="0,0,0,5" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type GroupItem}">
                                          <StackPanel>
                                            <Expander Name="exp" IsExpanded="{Binding IsChecked, ElementName=chkExpandAll, Mode=TwoWay, UpdateSourceTrigger=Explicit}">
                                                <Expander.Header>
                                                    <DockPanel>
                                                        <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" Margin="5,0,0,0" Width="100" />
                                                        <TextBlock FontWeight="Bold" Text="{Binding Path=ItemCount}" />
                                                    </DockPanel>
                                                </Expander.Header>
                                                <Expander.Content>
                                                    <ItemsPresenter />
                                                </Expander.Content>
                                            </Expander>
                                            </StackPanel>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.ContainerStyle>
                    </GroupStyle>
                </ListView.GroupStyle>
            </ListView>
        </ControlTemplate>
    </Window.Resources>

    <StackPanel>
        <CheckBox Name="chkExpandAll" Content="Expand All" />
        <ListView ItemsSource='{Binding Source={StaticResource src}}' DisplayMemberPath="@Name" BorderThickness="1" Template="{StaticResource ListTemplate}" />
    </StackPanel>

</Window> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T21:18:23.107

看起来绑定已被破坏，因为它被设置为带有复选框的 OneWay，然后如果您单击任何扩展器，它将破坏绑定。将其设置为 TwoWay 将使其始终工作，但扩展一项将导致它们全部扩展，这不是很有用。

我相信解决这个问题的方法是不使用绑定，而是使用情节提要。您可以触发情节提要，这将导致所有扩展器设置为真/假，而不管它们的当前状态如何。不过，更新复选框可能会比较棘手，因为需要一些逻辑来查看是选中了所有复选框还是仅选中了一些复选框。

# vb.net - 在VB.Net中将字节数组转换为整数

> ID：227083
> 
> 赞同：4
> 
> 时间：2008-10-22T18:46:25.303
> 
> 标签：vb.net, arrays, integer, byte

我想知道将字节数组（长度为 4）转换为整数的最佳方法是在 vb.net 中吗？我知道BitConverter，但是执行函数调用来做一些应该可以通过复制4字节内存来完成的事情似乎很浪费。同样，如何将单/双从其二进制表示形式转换为单/双变量。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-22T18:59:55.743

“复制内存字节”是 .NET 并不特别适合的事情（而 VB.NET 更不适合）。因此，除非您可以选择切换到 C，否则函数调用几乎是不可避免的。

BitConverter 是一个经过深思熟虑、经过测试的功能。当然，您可以通过执行以下操作（在 C# 中）来避免它：

```
myInt = (*pbyte) | (*(pbyte + 1) << 8)  | (*(pbyte + 2) << 16) | (*(pbyte + 3) << 24); 
```

（顺便说一句，这*正是*BitConverter 在将字节数组转换为整数时所做的事情......）。

但是，这段代码：

*   比 BitConverter 等价物更难阅读和理解；
*   不执行 BitConverter 为您执行的任何错误检查；
*   不像 BitConverter 那样区分小端和大端表示。

换句话说：你可能会“保存”一个函数调用，但最终你会变得更糟（即使假设你没有引入任何错误）。一般来说，.NET Framework 的设计非常非常好，您不应该在使用它的功能时三思而后行，除非您遇到实际（性能）问题。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-22T19:40:59.107

> 我知道BitConverter，但是执行函数调用来做一些应该可以通过复制4字节内存来完成的事情似乎很浪费。

而我认为这种情况是“当已经有一个方法调用完全符合我的要求时，尝试手动编写一种有效的方法来执行此操作似乎是一种浪费。”

除非您*绝对确信*您在这段代码中存在性能瓶颈，否则请使用框架提供的功能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T19:16:04.760

mdb 是完全正确的，但是，这里有一些代码可以将 vb 字节数组转换为小端整数......（以防万一你想编写自己的 bitconverter 类）

' 其中 bits() 是长度为 4 的字节数组

```
Dim i as Integer 

i = (((bits(0) Or (bits(1) << 8)) Or (bits(2) << &H10)) Or (bits(3) << &H18)) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T19:19:11.150

您可以使用 System.Buffer 类阻止将 byte[] 复制到 int[]。

# ms-access - DTS 包和访问连接

> ID：227089
> 
> 赞同：2
> 
> 时间：2008-10-22T18:48:14.253
> 
> 标签：ms-access, connection, dts

使用 DTS 我正在动态创建一个访问数据库。创建文件后（此时有效），我让 DTS 包通过 HTTP 将其发布到另一个站点。（这个 HTTP 就是它必须完成的方式——规范的一部分。）

但是当包发布文件时，发布的版本以 0 字节文件的形式出现。发布文件的代码经过测试并且实现良好的代码。我确定它有效。一位同事告诉我，他认为出现这个“0字节”错误是因为Access连接没有关闭访问文件。他说必须完成 DTS 包才能关闭访问文件。

**问题是：**在发布文件的步骤执行之前，如何让 Access 关闭 Access 文件？

以防万一需要，步骤如下：

*   创建Access文件，为这个新文件设置一个预定义的访问连接对象
*   在 Access 中创建表
*   使用转换数据任务填充 Access 数据库（从 SQL Server）
*   通过 HTTP 发布文件（正在使用预定义/预测试的库）

预先感谢您的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T19:06:34.403

我刚刚发现的答案是，在我发布文件之前（或在我完成写入文件之后）让工作流关闭连接

我可以通过选中“工作流属性”对话框的选项选项卡上的“完成时关闭连接”复选框来完成此操作。

谢谢你们！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T18:50:29.070

我相信您的同事是正确的，通过 HTTP 的发布很可能需要在 DTS 之外进行，或者您可能需要研究关闭连接的 VBS 方式，但我不确定这是否可能。

# apache - 我可以阻止 Apache Web 服务器上每个站点的搜索爬虫吗？

> ID：227101
> 
> 赞同：20
> 
> 时间：2008-10-22T18:51:28.367
> 
> 标签：apache, search, web-crawler, httpd.conf

我在公共互联网上有一个登台服务器，为一些网站运行生产代码的副本。如果登台站点被编入索引，我真的不喜欢它。

有没有办法可以修改临时服务器上的 httpd.conf 以阻止搜索引擎爬虫？

更改 robots.txt 并不会真正起作用，因为我使用脚本将相同的代码库复制到两台服务器。另外，我也不想更改虚拟主机配置文件，因为有很多站点，如果我创建一个新站点，我不想记住复制某个设置。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2011-09-09T16:58:26.670

创建一个包含以下内容的 robots.txt 文件：

```
User-agent: *
Disallow: / 
```

将该文件放在临时服务器上的某个位置；您的目录根目录是放置它的好地方（例如`/var/www/html/robots.txt`）。

将以下内容添加到您的 httpd.conf 文件中：

```
# Exclude all robots
<Location "/robots.txt">
    SetHandler None
</Location>
Alias /robots.txt /path/to/robots.txt 
```

该`SetHandler`指令可能不是必需的，但如果您使用诸如 mod_python 之类的处理程序，则可能需要它。

该 robots.txt 文件现在将为您服务器上的所有虚拟主机提供服务，覆盖您可能为单个主机拥有的任何 robots.txt 文件。

（注意：我的回答与 ceejayoz 的回答建议你做的基本相同，但我不得不多花几分钟时间弄清楚所有细节才能让它发挥作用。为了其他人，我决定把这个答案放在这里谁可能会偶然发现这个问题。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-14T15:49:58.047

您可以使用 Apache 的 mod_rewrite 来执行此操作。假设您的真实主机是 www.example.com，而您的暂存主机是 staging.example.com。创建一个名为“robots-staging.txt”的文件并有条件地重写请求以转到该文件。

此示例适用于保护单个登台站点，这是一个比您要求的更简单的用例，但这对我来说很可靠：

```
<IfModule mod_rewrite.c>
  RewriteEngine on

  # Dissuade web spiders from crawling the staging site
  RewriteCond %{HTTP_HOST}  ^staging\.example\.com$
  RewriteRule ^robots.txt$ robots-staging.txt [L]
</IfModule> 
```

您可以尝试将蜘蛛重定向到不同服务器上的主 robots.txt，但一些蜘蛛可能会在从 HTTP 请求中获得“200 OK”或“404 未找到”返回码之外的任何内容后犹豫不决，并且他们可能不会阅读重定向的 URL。

以下是你将如何做到这一点：

```
<IfModule mod_rewrite.c>
  RewriteEngine on

  # Redirect web spiders to a robots.txt file elsewhere (possibly unreliable)
  RewriteRule ^robots.txt$ http://www.example.com/robots-staging.txt [R]
</IfModule> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T19:00:53.603

您能否将暂存虚拟主机上的 robots.txt 别名为托管在不同位置的限制性 robots.txt？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T19:18:05.363

要真正阻止页面被索引，您需要将站点隐藏在[HTTP auth](http://httpd.apache.org/docs/1.3/mod/mod_auth.html)后面。您可以在全局 Apache 配置中执行此操作并使用简单的 .htpasswd 文件。

唯一的缺点是您现在必须在第一次浏览登台服务器上的任何页面时输入用户名/密码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T19:04:00.853

根据您的部署方案，您应该寻找将不同 robots.txt 文件部署到 dev/stage/test/prod（或您拥有的任何组合）的方法。假设您在不同的服务器上有不同的数据库配置文件或（或类似的），这应该遵循类似的过程（您的数据库*确实*有不同的密码，对吗？）

如果您没有一个一步到位的部署过程，这可能是一个很好的动机......有大量的工具适用于不同的环境 - Capistrano 是一个非常好的工具，并且在 Rails/ 中受到青睐Django 的世界，但绝不是唯一的。

如果失败了，您可能会在 Apache 配置中设置一个全局别名指令，该指令将应用于所有虚拟主机并指向限制性 robots.txt

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T18:58:33.670

尝试[使用 Apache 来阻止坏机器人](http://www.evolt.org/article/Using_Apache_to_stop_bad_robots/18/15126/)。您可以让[用户代理](http://www.user-agents.org/)在线或只允许浏览器，而不是试图阻止所有机器人。

# ftp - 文件传输协议选项？

> ID：227117
> 
> 赞同：4
> 
> 时间：2008-10-22T18:58:13.157
> 
> 标签：ftp, protocols, data-transfer

我正在寻找一种将非平凡（10G > x >10MB）数据从一台机器传输到另一台机器的好方法，可能通过多个会话。

我已经简要地看了

*   *ftp (sftp, tftp, ftp)
*   http
*   种子（因为我一般不会有种子网络）
*   rsync（不确定我是否真的可以适应我的需要）

是否有任何其他协议可能更适合该法案？上面的大多数本身都不是非常容错的，而是依靠客户端/服务器应用程序来弥补缺陷。在这个阶段，我更关心协议本身，而不是运行良好的特定客户端/服务器实现。

（是的，我知道我可以通过 udp 自己编写，但我更喜欢*其他任何东西*！！）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T19:16:39.233

我使用 rsync（通过 SSH）传输任何我认为可能需要一分钟以上的时间。

速率限制、暂停/恢复和获取进度报告很容易。您可以使用 SSH 密钥将其自动化。它（通常）已经安装（无论如何，在 *nix 盒子上）。

根据您的需要， rsync 可能会适应。如果您要分发给很多用户，FTP/HTTP 可能更适合防火墙问题；但是 rsync 非常适合一对一或一对多的传输。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T19:07:11.033

rsync 几乎总是最好的选择。

因为它只传输差异，如果传输被中断，下一次它不会像第一次那样不同（当目标没有文件时）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T19:06:16.417

BitTorrent 不需要大型种子网络才能有效 - 它可以与一个播种机和一个对等方一起正常工作。设置跟踪器等需要一些开销，但一旦设置好，它就会是一种不错的、快速的、容错的传输方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T19:18:05.270

嗯，HTTP 是一个不错的选择，因为它支持使用[字节范围](http://en.wikipedia.org/wiki/Byte_serving)重新启动部分传输。FTP 或 TFTP 很好，因为您可以获得配置极其简单的服务器软件，而不必锁定 HTTP 服务器之类的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T19:24:47.660

[GridFTP](http://www.globus.org/alliance/publications/clusterworld/0404GridFinal.pdf)是 Argonne 用来可靠地传输大量数据的工具。

# c# - 将 UserControl 转换为特定类型的用户控件

> ID：227121
> 
> 赞同：7
> 
> 时间：2008-10-22T18:58:51.453
> 
> 标签：c#, asp.net, user-controls

有没有办法将用户控件转换为特定的用户控件，以便我可以访问它的公共属性？基本上我正在通过占位符的控件集合进行搜索，并且我正在尝试访问用户控件的公共属性。

```
foreach(UserControl uc in plhMediaBuys.Controls)
{
    uc.PulblicPropertyIWantAccessTo;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-22T19:01:39.187

```
foreach(UserControl uc in plhMediaBuys.Controls) {
    MyControl c = uc as MyControl;
    if (c != null) {
        c.PublicPropertyIWantAccessTo;
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T19:00:35.740

```
foreach(UserControl uc in plhMediaBuys.Controls)
{
  if (uc is MySpecificType)
  {
    return (uc as MySpecificType).PulblicPropertyIWantAccessTo;
  }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-22T19:04:08.777

## 铸件

我更喜欢使用：

```
foreach(UserControl uc in plhMediaBuys.Controls)
{
    ParticularUCType myControl = uc as ParticularUCType;
    if (myControl != null)
    {
        // do stuff with myControl.PulblicPropertyIWantAccessTo;
    }
} 
```

主要是因为使用 is 关键字会导致两次（准昂贵）强制转换：

```
if( uc is ParticularUCType ) // one cast to test if it is the type
{
    ParticularUCType myControl = (ParticularUCType)uc; // second cast
    ParticularUCType myControl = uc as ParticularUCType; // same deal this way
    // do stuff with myControl.PulblicPropertyIWantAccessTo;
} 
```

## 参考

*   [C# 中的 3 个强制转换运算符](http://rusek.org/stefan/default.aspx/2008/10/22/the-3-cast-operators-in-c/73/)
*   [C# 中类型转换对执行性能的影响](http://www.codeproject.com/KB/cs/csharpcasts.aspx)

# javascript - jQuery 中的 .load 未在 IE6 中加载 cfcharts

> ID：227129
> 
> 赞同：2
> 
> 时间：2008-10-22T19:00:54.383
> 
> 标签：javascript, jquery, coldfusion

我正在尝试使用包含 png 格式的 cfchart 的 .cfm 页面动态加载 div 标记的内容。当用户点击一个链接时，我正在使用加载函数将 .cfm 页面放入 div 中。

```
$("#bank").bind("click", function(){
    $("#chartx").load("bank.cfm");
}); 
```

我可以让它在 Firefox 中完美呈现，但在 IE6 中却不行。它没有给出错误信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T20:41:35.320

最奇怪的是，页面上附加的经典样式的 cfdebug 信息是导致它崩溃的原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T19:19:15.127

你试过 jQuery.get 吗？也许是这样的：

```
$("#bank").bind("click", function(){
    $.get("bank.cfm", function(data){
        $("#chartx").html(data);
    });
}); 
```

它没有那么干净，但更具体。也许它会采取与正在发生的事情不同的过程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T00:05:42.037

哦，原来是这样。我要说的是，有时在某些计算机上，如果您将 IE 安全设​​置设置得太高，将特殊组件加载到页面中的 AJAX 调用有时不起作用。

# java - Hibernate 使用复合键返回无效结果

> ID：227130
> 
> 赞同：1
> 
> 时间：2008-10-22T19:01:05.023
> 
> 标签：java, hibernate, jpa, composite-key

我得到了最奇怪的结果。我有一个带有复合键的类。如果我执行以下查询：

> 来自 LOVEJB l order by l.canonicalId desc

我的结果不是按我要求的“ **canonicalId** ”列排序的。相反，规范的 id 结果如下：

> 823 823 822 823 ,,,

有人可以给我一些关于我应该如何尝试破解它的指示吗？我已经搞砸了*hashcodes*和*equals*，我尝试了一个新的类等，但无济于事。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T22:18:38.900

我发现。我的复合键包含不属于表主键的列。谢谢大家。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T20:11:04.397

生成的实际 QUERY 是什么？顺序由 RDBMS 决定。在 Hib 配置中打开 show_sql 并手动运行该查询。

# .net - 使用 aspx 渲染引擎生成非 HTML

> ID：227132
> 
> 赞同：9
> 
> 时间：2008-10-22T19:01:25.693
> 
> 标签：.net, asp.net, asp.net-mvc, templates, latex

是否可以使用 asp 模板引擎（使用部分代码隐藏类、动态 <% ... %> 块等）来生成非 HTML？我想要一种干净且可维护的方式来动态生成代码。（具体来说，我想生成填充了数据库值的 LaTeX 代码。）

目前，我的 LaTeX 模板是带有占位符的资源字符串，我将这些字符串替换为数据库值。这种解决方案很快变得非常难以维护和清洁。我真的很想使用 aspx 标记中的动态块，但我不确定 a）当输出不是 HTML 时，aspx 是否会合适，或者 b）如何将结果实际呈现到 .tex 文件中.

生成代码本身位于 C# .dll 中。我们正在使用 .NET 3.5

这可能吗？提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T19:28:16.607

Visual Studio 2008 本机或 Visual Studio 2005 SDK 附带的 T4 模板，您几乎可以生成任何您想要的东西。

您可以通过以下链接获得更多信息：

*   [斯科特·汉塞尔曼的博客](http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx)
*   [Rob Conery 的博客](http://blog.wekeroad.com/blog/make-visual-studio-generate-your-repository/)
*   [Oleg Sych 的博客](http://www.olegsych.com/)，它是 T4 示例的完整存储库
*   [约翰丹佛斯的博客](http://weblogs.asp.net/jdanforth/archive/2008/04/23/t4-support-in-vs2008.aspx)

我很确定所有这些链接都是您探索的良好开端。

如果要在 Visual Studio 之外生成 T4 模板，可以使用自定义 MSBuild 任务来调用 T4 模板（[链接](http://geekswithblogs.net/EltonStoneman/archive/2008/07/25/an-msbuild-task-to-execute-t4-templates.aspx)）

下面是 MSBuild 任务的“执行”代码示例。[点击这里查看源代码](http://www.sixeyed.com/fileDrop/code/MSBuild/Sixeyed.MSBuild/Sixeyed.MSBuild/Tasks/CodeGen/ExecuteT4Template.cs)：

```
public override bool Execute()
{
    bool success = false;

    //read in the template:
    string template = File.ReadAllText(this.TemplatePath);

    //replace tags with property and item group values:
    ProjectHelper helper = new ProjectHelper(this);
    template = helper.ResolveProjectItems(template);

    //copy the template to a temp file:
    this._tempFilePath = Path.GetTempFileName();
    File.WriteAllText(this._tempFilePath, template);

    //shell out to the exe:
    ProcessHelper.Run(this, TextTransform.ToolPath, TextTransform.ExeName, string.Format(TextTransform.ArgumentFormat, this.OutputPath, this._tempFilePath));
    success = true;

    return success;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T19:13:07.557

我不明白为什么不。我在以前的工作中认识的人使用 ASP.NET 页面和中继器控件创建了一个数据库包装器生成器来插入属性。然后，他将文档内容写入源文件。

如果您担心 ASP.NET 会失败，您可以创建一个非常有限的测试用例并亲自查看。不应该花太多时间来测试一个理论并让您知道它是否满足您的需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T19:17:48.297

这当然是可能的。大多数服务器控件将被淘汰，因为它们会自动发出 HTML 标记。但是，您可以对页面进行数据绑定并使用数据绑定表达式。Visual Studio 无疑会抱怨无效标记。

然后，您必须通过 Cassini 或 ASP.NET 管道运行您的页面以获取输出。我在某个地方有一个单元测试工具可以做到这一点，而且非常简单。

*不过，更好*的主意可能是使用代码生成器。像 CodeSmith 这样的东西应该可以很好地工作，甚至 Visual Studio 的内置[T4](http://blog.wekeroad.com/blog/make-visual-studio-generate-your-repository/)也为您提供了很大的灵活性，而不是试图将您束缚在 HTML 中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T19:19:10.900

对于代码生成，您应该查看 T4 模板功能。它使用类似于 ASP.Net 的语法。

请参阅 Scott Hanselmans 帖子： [http ://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx](http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T19:19:19.853

是的你可以。只需创建一个标准的 .aspx 页面，删除所有 HTML 并在页面中放置您想要的任何内容。然后，您可以使用 <% %> 标记在页面中放置动态内容。就像 Jason Z 所说，您可以使用 Repeater 控件遍历项目集合以在“页面”中列出。此外，您将无法使用所有其他服务器控件，因为它们会生成 HTML，但您仍然可以根据需要创建自己的服务器控件和/或用户控件。

# c# - C# 语音识别 - 这是用户所说的吗？

> ID：227140
> 
> 赞同：55
> 
> 时间：2008-10-22T19:04:15.140
> 
> 标签：c#, speech-recognition, text-to-speech

我需要编写一个使用语音识别引擎的应用程序——无论是内置的 vista 引擎还是第三方引擎——它可以显示一个单词或短语，并识别用户何时阅读它（或它的近似值） ）。我还需要能够在语言之间快速切换，而无需更改操作系统的语言。

用户将在很短的时间内使用该系统。该应用程序需要在不需要首先针对用户的声音训练识别引擎的情况下工作。

如果这可以在 Windows XP 或更低版本的 Windows Vista 上运行，那也太棒了。

可选地，系统需要能够以用户选择的语言将屏幕上的信息读回给用户。我可以使用预先录制的画外音来解决这个规范，但首选方法是使用文本到语音引擎。

任何人都可以为我推荐一些东西吗？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-22T19:31:49.297

不久前，Joel on Software 上也有人问过类似的问题。您可以使用[System.Speech.Recognition](http://msdn.microsoft.com/en-us/library/system.speech.recognition.aspx)命名空间来执行此操作……但有一些限制。将 System.Speech（应该在 GAC 中）添加到您的项目中。这是 WinForms 应用程序的一些示例代码：

```
public partial class Form1 : Form
{
  SpeechRecognizer rec = new SpeechRecognizer();

  public Form1()
  {
    InitializeComponent();
    rec.SpeechRecognized += rec_SpeechRecognized;
  }

  void rec_SpeechRecognized(object sender, SpeechRecognizedEventArgs e)
  {
    lblLetter.Text = e.Result.Text;
  }

  void Form1_Load(object sender, EventArgs e)
  {
    var c = new Choices();
    for (var i = 0; i <= 100; i++)
      c.Add(i.ToString());
    var gb = new GrammarBuilder(c);
    var g = new Grammar(gb);
    rec.LoadGrammar(g);
    rec.Enabled = true;
  } 
```

这会识别从 1 到 100 的数字，并在表单上显示结果数字。您需要一个带有名为 lblLetter 的标签的表单。

System.Speech 仅适用于预定义的单词或短语列表；无论是在多功能性还是在识别质量方面，它都不完全是 NaturallySpeaking。但是你不必根据用户的声音来训练它，如果你只有一些用户可以说的不同的东西，它就可以很好地工作。而且它是免费的！（如果你有 Visual Studio）

如果您使用非常短的短语，它将无法正常工作；我为我的孩子制作了一个程序，让他们说出字母表中的字母并在屏幕上看到它们，但它做得并不好，因为许多字母听起来很相似（尤其是从一个四岁孩子的嘴里）。

至于更灵活的选择……嗯，有前面提到的 NaturallySpeaking，它有一个 SDK。但是您必须联系销售人员才能获得任何形式的访问权限，并且没有列出定价，因此它会作为“它的成本是多少？嗯，你有多少？”之一出现。之类的东西。似乎没有“下载并使用它”选项。:(

至于文本到语音，[System.Speech.Synthesis 会这样做](http://msdn.microsoft.com/en-us/library/system.speech.synthesis.aspx)。它甚至比语音识别更容易。我写了一个小程序让我输入，按 Enter，然后大声朗读文本。我四岁的孩子被它迷住了。:) （“爸爸，我想和 da wobot 聊天。”）

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-04T21:35:27.457

[Note: I was the development lead for the managed speech recognition API in .NET 3.0]

System.Speech is part of .NET 3.0, so it is available on both Vista and XP. In Vista you have the added benefit of having a speech recognition engine pre-installed by the OS. On XP you choices are: use the SAPI 5.1 SDK with a very old engine (but might work well enough for your command and control scenario), install Office 2003 which installs a newer version of the recognizer. There are a few SAPI 5 complient speech recognition engines available as well.

If you need to switch languages, you will want to use the System.Speech.Recognition.SpeechRecognitionEngine class which allows you to choose the SR engine for the language you need to support. Note that engines are defined by a set of languages they support (they might be using the same binary, only swapping data files to support additional languages).

Comment if you need to know more.

Philipp

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-25T05:32:37.963

在此之前添加“演讲”参考

![系统语音](https://i.stack.imgur.com/Xcf6X.jpg)

发现 Kyralessa 在 10 月 22 日发布的代码示例对我不起作用，但稍作修改的版本对我有用。将字符串添加到 Choices 对象时，使用全文英文单词而不是数字。似乎 MS 语音识别引擎无法自行识别数字。

我已经在前面的示例中添加了一些注释来标记这些修改。

```
public partial class Form1 : Form
{
  SpeechRecognizer rec = new SpeechRecognizer();

  public Form1()
  {
    InitializeComponent();
    rec.SpeechRecognized += rec_SpeechRecognized;
  }

  void rec_SpeechRecognized(object sender, SpeechRecognizedEventArgs e)
  {
    lblLetter.Text = e.Result.Text;
  }

  void Form1_Load(object sender, EventArgs e)
  {
    var c = new Choices();

    // Doens't work must use English words to add to Choices and
    // populate grammar.
    //
    //for (var i = 0; i <= 100; i++)
    //  c.Add(i.ToString());

    c.Add("one");
    c.Add("two");
    c.Add("three");
    c.Add("four");
    // etc...

    var gb = new GrammarBuilder(c);
    var g = new Grammar(gb);
    rec.LoadGrammar(g);
    rec.Enabled = true;
  } 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-22T19:14:04.623

如果引擎是您要询问的，那么我发现（请注意，我只是列出，我没有尝试过任何一个）：

[Lumenvox 引擎](http://www.lumenvox.com/products/speech_engine/)

您还拥有 Microsoft 本身的[SAPI SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=5e86ec97-40a7-453f-b0ee-6583171b4530&DisplayLang=en)，我仅尝试将其用于文本到语音，但根据其定义：

SDK 还包括可免费分发的文本转语音 (TTS) 引擎（美国英语和简体中文）**和语音识别 (SR) 引擎**（美国英语、简体中文和日语）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-22T19:23:25.757

请注意，如果您不首先需要培训，您将不会获得好的结果。语音识别是语音学的统计应用，这一领域非常坦率地说，信号的变化如此之大，以至于任何人都能理解其他人所说的话几乎是一个奇迹。一个现成的语音识别引擎很可能会倾向于使用更普遍的英语口音，但对于任何稍有不同的东西都会惨遭失败。

这就是为什么培训如此重要。我们可以轻松地通过过度拟合来做得很好，特别是如果我们减少问题空间。但是创建一个可扩展的机器学习解决方案？其中总是存在问题。

话虽如此，请考虑 Sphinx-4。这是一个用 Java 编写的现成解决方案，可在[http://cmusphinx.sourceforge.net/sphinx4/ 获得](http://cmusphinx.sourceforge.net/sphinx4/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T19:21:03.720

查看 .NET 3.5 中的新语音类库

> [http://msdn.microsoft.com/en-us/library/system.speech.recognition.speechrecognizer.aspx](http://msdn.microsoft.com/en-us/library/system.speech.recognition.speechrecognizer.aspx)

SR 和 TTS 的一般文档

> [http://msdn.microsoft.com/en-us/library/system.speech.recognition.aspx](http://msdn.microsoft.com/en-us/library/system.speech.recognition.aspx) [http://msdn.microsoft.com/en-us/library/system.speech.synthesis.aspx](http://msdn.microsoft.com/en-us/library/system.speech.synthesis.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T19:17:47.627

[Dragon Naturally speak SDK](http://www.nuance.com/for-developers/dragon/index.htm)可能值得一看。 [这个项目](http://www.codeproject.com/KB/cs/TextToSpeechWindowsSAPI.aspx)看起来很有趣。

虽然没有和他们中的任何一个一起玩。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T19:22:47.490

[语音 API](http://msdn.microsoft.com/en-us/library/ms723627(VS.85).aspx)提供文本到语音。就个人而言，我可能需要 Vista 并使用[System.Speech.SpeechRecognition](http://msdn.microsoft.com/en-us/library/system.speech.recognition.aspx)和[System.Speech.Synthesis.TtsEngine](http://msdn.microsoft.com/en-us/library/system.speech.synthesis.ttsengine.aspx)的托管接口，但如果您确实需要 XP 支持，则应该可以在非托管 API 中使用 P/Invoke。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-04T21:41:52.637

试试[Microsoft Speech Server](http://www.microsoft.com/speech/speech2007/default.mspx)，我认为它现在是[Office Communication Server 2007](http://office.microsoft.com/en-us/communicationsserver/FX101729111033.aspx)的一部分。它包含一个 SR/TTS 引擎、C# API 和与 Visual Studio 集成的工具。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-06-09T18:29:35.110

这是来自 MSDN 杂志的文章，首先讨论了使用用于 Vista 的 System.Speech API。其中一些已经过时了，因为 API 在 beta（撰写本文时）和 Vista 版本之间发生了变化，但这仍然是我找到的最好的资源之一，并且很好地介绍了 System.Speech 命名空间. 请参阅[http://msdn.microsoft.com/en-us/magazine/cc163663.aspx](http://msdn.microsoft.com/en-us/magazine/cc163663.aspx)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-07-20T00:44:54.143

好吧，这个问题已经有很多很好的回应，但我认为用 2016 年文档中的一些信息更新 Rob Segal 和 Philipp Schmid 的回应指向这个很好的代码示例是很有价值的：

[https://msdn.microsoft.com/en-us/library/office/system.speech.recognition.speechrecognitionengine.aspx](https://msdn.microsoft.com/en-us/library/office/system.speech.recognition.speechrecognitionengine.aspx)

它没有使用 Windows 的共享识别器（显示在屏幕中间的小 Windows 麦克风），它使用了一个很好的应用程序 SpeechRecognitionEngine，不需要任何视觉提示。UI 完全由您控制。

# java - java.awt.Component.getName() 和 setName() 是做什么用的？

> ID：227143
> 
> 赞同：22
> 
> 时间：2008-10-22T19:06:05.170
> 
> 标签：java, awt

是[`java.awt.Component.getName()`](http://docs.oracle.com/javase/6/docs/api/java/awt/Component.html#getName%28%29)用来做什么的？它似乎总是出现`null`在我使用 NetBeans 构建的应用程序中。我正在考虑在其中为每个组件存储一些帮助文本——我不想使用工具提示，我有另一个面板，我将在其中显示帮助文本。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-22T19:55:45.553

Component.setName(..) 在 JDK 中主要由外观实现类使用来为每个组件设置类似 ID 的字符串，例如 BasicOptionPaneUI 可能会在按钮组件上调用它以将其名称设置为“OptionPane.button”。

getName() 在 toString() 方法中使用，当在复合/父组件内以及在 AWT 和 Swing 调试日志记录代码中设置子组件的名称时。我强烈怀疑某些 AWT/Swing 测试框架也使用 getName() 方法。

因此，如果您不依赖 getName() 的上述任何用法，您可以尝试将它用于您的帮助消息，尽管我不推荐它。

也许你应该重新考虑你的设计？使用该名称在从资源包加载帮助文本的哈希图中进行一些查找？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-22T19:11:55.563

我还没有看到它被框架用于任何事情。如果您将组件传递给方法，那么它很有用，因此您可以询问它们的名称来决定如何处理它们。此外，许多 UI 测试框架使用它来允许您在测试脚本中按名称引用组件。不过，我看不出有任何理由不能将它用于帮助文本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T21:55:31.253

Herman Lintvelt 的答案最终成为我的应用程序的正确答案。

我创建了一个名为 HelpText.properties 的资源包。它包含名称=值对。我用 name=value 对中的“name”设置了我的每个组件。然后我使用框架的 getGlassPane() 来捕获所有鼠标移动。当鼠标在命名组件上运行时，它会在包中查找名称，显示帮助（如果可用）并将鼠标移动转发到实际组件。

*   [在这里](http://java.sun.com/docs/books/tutorial/uiswing/components/rootpane.html)查看如何使用玻璃板。
*   Jan Newmarch[关于使用资源包的网页](http://jan.newmarch.name/i18n/locale/resourcebundle.html)非常有帮助。
*   Kevin Riff 的[回复](http://www.javalobby.org/java/forums/t18586.html)帮助我弄清楚了如何找到我的资源包。

唷。只有 2 天的用餐时间。我终于开始习惯 Java 了 :)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-09-04T14:28:26.127

[FEST](http://fest.easytesting.org/)使用组件的名称在测试用例中识别它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-17T15:08:37.660

该`component.getName()`方法主要用于侦听器。如果您设置了组件的名称 ( `component.setName(name)`)，您可以从 a 的方法中调用该特定组件`Listener`。

例子：

```
public void someMethodOfsomeListener(SomeEvent e){
   if (e.getComponent().getName().equals(component.getName())
      //do stuff...
} 
```

请注意，您必须明确设置组件的名称，否则它将返回`null`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T19:26:28.763

此外，由于我认为 java.awt.Component 是 X 中的重量级对象，因此 xwininfo 和 xwd 等程序可能允许您按名称指定它。

我只是用一个JFrame试了一下，setName没有设置窗口的名字，窗口是由我在构造函数中传入的字符串命名的。但是我没有任何仅 awt 的示例代码可供测试，所以我上面写的内容可能是错误的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-26T22:24:34.377

我用它来处理一个单独的类中的听众。我将包含我的 object.addListener 的组件作为参数接收，而不是作为容器，而是作为包含该对象的类。感谢 Vivavinyl 首先设置名称的提示。它很有用并且有效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-24T00:43:18.400

这就是我使用 getName() 的目的：

```
 Frame[] frames = JFrame.getFrames();

    for (int i = 0; i < frames.length; ++i) {

        //get the frame
        Frame frame = frames[i];

        if (frame.getName().equals(frameName)) {

            //make the frame visible
            frame.setVisible(true);

            //focus the frame
            frame.requestFocus();

            //found
            return;

        }

    } 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2017-03-22T16:05:06.043

我已经搜索了很多答案以获取名称，我认为这是唯一简单的解决方案

```
public static void main(String[] args) {
    ActionListener actionListener = new ActionListener() {
        public void actionPerformed(ActionEvent actionEvent) {
            String name = actionEvent.getSource().toString();
            UserReaction(ObjectName.getComponentVariableName(name), "null");
        }
    };
    Button calculate_btn = new Button("Calculate");
    calculate_btn.setName("Calculate");
    calculate_btn.addActionListener(actionListener);
}

private static void UserReaction(String objectName) {
    if (objectName.equals("Calculate")) {
        //do something;         
    }
}static public String getComponentVariableName(String name) {
    String res = (name.substring(name.indexOf("[") + 1));
    res = res.split(",")[0];
    return res;
} 
```

# sharepoint - 为了学习 SharePoint 最佳实践而学习哪个 CodePlex/Google 代码项目

> ID：227147
> 
> 赞同：2
> 
> 时间：2008-10-22T19:08:48.113
> 
> 标签：sharepoint, google-code, codeplex

我是 sharepoint 开发的新手，但在 C++、VB6 和 C# 方面有大约 10 年的经验。根据我的经验，学习新语言或编码风格的一个好方法是花一些时间“剖析” CodePlex 或 Google 代码中可用的开源项目之一。为了避免在不知不觉中养成一些坏习惯，我想听听你可以推荐哪些项目。

TIA

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T20:03:37.907

我也会推荐 CKS，但我还要补充一点，我发现编码不是学习 SharePoint 时最大的问题，而是确定实现目标的最佳解决方案。您应该使用工作流还是事件处理程序？您应该使用自定义代码还是 BDC？您应该构建 Web 部件还是布局页面？您应该使用列表、自定义表单还是 InfoPath 表单？

因此，除了学习编码实践之外，您还应该花费大量时间寻找解决问题的方法。SharePoint 提供了很多好处，但不幸的是，简单的学习曲线并不是其中之一。我也有 10 年的开发经验，我花了 6 个月的时间才开始完全理解最有效地解决业务需求的最佳方法。

我建议：

[模式和实践 SharePoint 指南](http://www.codeplex.com/spg)

[SharePoint Server 2007 最佳实践资源中心](http://technet.microsoft.com/en-us/office/sharepointserver/bb736746.aspx)

[Microsoft Office SharePoint Server 2007 最佳实践（平装本）](https://rads.stackoverflow.com/amzn/click/com/0735625387)

[SharePoint 2007 和 WSS 3.0 处置模式示例](http://blogs.msdn.com/rogerla/archive/2008/02/12/sharepoint-2007-and-wss-3-0-dispose-patterns-by-example.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T19:13:28.943

一般来说，SharePoint“代码”将以为特定 SharePoint 安装编写的 Web 部件和页面的形式出现。但是，这并不意味着没有任何 SharePoint 实用程序和库。

事实上，我是托管在 Codeplex 上的[SmartPart](http://www.codeplex.com/smartpart)的忠实粉丝。这是一个非常有用的 SharePoint 工具，有大量下载和一些需要修复的错误，因此它是一个很好的项目，可以作为您的参考点*并*提交一些代码！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T19:26:47.420

你可以看看[http://www.codeplex.com/CKS](http://www.codeplex.com/CKS)这是微软员工发起的一个项目。

# .net - XSLT 转换效率

> ID：227148
> 
> 赞同：9
> 
> 时间：2008-10-22T19:10:03.867
> 
> 标签：.net, xslt

我是一名支持工程师，我们公司的产品允许 XSLT 转换以自定义输出。

为此，我做了一个 xsl 转换。它适用于典型大小（几个 100k）的源文件，但偶尔会出现一个非常大（10M）的源文件。在这种情况下，即使我让它研磨几天也不会产生输出。

SW工程团队对其进行了测试，发现对于有问题的转换和大型源文件确实非常慢（>天），如果我们的产品被编译为使用.Net 1.1中的转换引擎，但如果他们用.Net编译它2.0，速度很快（大约 1-2 分钟）。

长期的解决方案显然是，等待下一个版本。

在短期内，我想知道以下几点：1) XSLT 是否足够灵活，以至于有更有效和更低效的方法来实现相同的结果？例如，我构建 xsl 的方式是否有可能，转换引擎必须从源文件的开头多次迭代，随着下一个结果片段离开头越来越远，需要的时间越来越长？（Schlemiel the Painter），或者 2）它是否更依赖于转换引擎如何解释 xsl？

如果是 2，我不想浪费很多时间来改进 xsl（我不是 xsl 大天才，要实现我所做的一点点已经够难了……）。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T19:25:51.230

我不熟悉 .NET 实现，但通常可以做一些事情来加快大型文档的处理速度：

*   除非绝对必要，否则避免在 Xpath 表达式中使用“//”。
*   如果您只需要第一个或唯一一个匹配 Xpath 表达式的元素，请使用“[1]”限定符，例如“//iframe[1]”。许多处理器为此进行了优化。
*   只要有可能，在处理大量 XML 输入时，看看您是否可以围绕基于流的解析器（如 SAX）而不是基于 DOM 的解析器设计解决方案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T20:37:31.957

通常，如果您看到处理时间与输入大小呈非线性增加，您应该怀疑您的代码而不是框架。但是，当使用 .NET 2.0 编译该工具时，问题就消失了，所有的赌注都没有了。

使用 XSLT，如果您使用直接模板匹配进行所有解析，则很难创建非线性性能曲线：

```
<xsl:template match="foo">
  <!--OUTPUT-->
  <xsl:apply-templates / >
  <!--OUTPUT-->
</xsl:template>

 <xsl:template match="bar">
  <!--OUTPUT-->
  <xsl:apply-templates / >
  <!--OUTPUT-->
</xsl:template> 
```

**仔细注意您可能求助于`<xsl:for-each>`**解析的任何地方；模板匹配实际上总是获得相同结果的更好方法。

解决此性能问题的一种方法是一次重新创建一个模板匹配的 XSLT，在添加每个匹配后测试处理时间。你可以从这场比赛开始：

```
<xsl:template match="*">
  <xsl:copy>                   <!--Copy node                   -->
    <xsl:copy-of select="@*"/> <!--Copy node attributes         -->
    <xsl:apply-templates />    <!--Process children             -->
  </xsl:copy>
</xsl:template> 
```

这将匹配每个节点，一次一个，并将其复制到一个新文档中。这不应该表现出处理时间与输入大小的非线性增加（如果确实如此，那么问题不在于您的 XSLT 代码）。

在重新创建 XSLT 时，如果添加的模板匹配突然降低了性能，请注释掉模板中的每个块。然后，一次取消注释一个块，测试每次迭代的处理时间，直到找到导致问题的块。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T23:01:36.563

> 为了检测何时开始一个新部分，我这样做了：
> 
> ```
> <xsl:if test="@TheFirstCol>preceding-sibling::*[1]/@TheFirstCol" 
> ```
> 
> 这会导致很多或重新迭代吗？

确实。您选择的算法是 O(N ² )，如果有足够数量的兄弟姐妹，无论实现语言如何，都会非常慢。

这是一个使用密钥的有效算法：

# 解决方案1：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

 <xsl:output method="text"/>

 <xsl:key name="kC1Value" match="@c1" use="."/>

    <xsl:template match="/">
      <xsl:for-each select="*/x[generate-id(@c1) = generate-id(key('kC1Value',@c1)[1])]">

       <xsl:value-of select="concat('&#xA;',@c1)"/>

       <xsl:for-each select="key('kC1Value',@c1)">
         <xsl:value-of select="'&#xA;'"/>
         <xsl:for-each select="../@*[not(name()='c1')]">
           <xsl:value-of select="concat('   ', .)"/>
         </xsl:for-each>
       </xsl:for-each>
      </xsl:for-each>
    </xsl:template>
</xsl:stylesheet> 
```

不幸的是，XslTransform (.Net 1.1) 有一个众所周知的低效的`generate-id()`函数实现。

使用 XslTransform 可能会更快：

# 解决方案2：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

 <xsl:output method="text"/>

 <xsl:key name="kC1Value" match="@c1" use="."/>

    <xsl:template match="/">
      <xsl:for-each select="*/x[count(@c1 | key('kC1Value',@c1)[1]) = 1]">

       <xsl:value-of select="concat('&#xA;',@c1)"/>

       <xsl:for-each select="key('kC1Value',@c1)">
         <xsl:value-of select="'&#xA;'"/>
         <xsl:for-each select="../@*[not(name()='c1')]">
           <xsl:value-of select="concat('   ', .)"/>
         </xsl:for-each>
       </xsl:for-each>
      </xsl:for-each>
    </xsl:template>
</xsl:stylesheet> 
```

应用于以下小型 XML 文档时：

```
<t>
 <x c1="1" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="1" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="1" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="1" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="2" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="2" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="2" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="2" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="3" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="3" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="3" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="3" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="3" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="3" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="3" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="3" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="4" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="4" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="4" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="4" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="5" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="5" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="5" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="5" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="5" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="5" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="6" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="6" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="6" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="6" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="6" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="6" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="7" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="7" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="7" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="7" c2="1" c3="1" c4="0" c5="0"/>
 <x c1="8" c2="0" c3="0" c4="0" c5="0"/>
 <x c1="8" c2="0" c3="1" c4="0" c5="0"/>
 <x c1="8" c2="2" c3="0" c4="0" c5="0"/>
 <x c1="8" c2="1" c3="1" c4="0" c5="0"/>
</t> 
```

两种解决方案都产生了想要的结果：

```
1
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0
2
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0
3
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0
4
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0
5
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0
   0   0   0   0
   0   1   0   0
6
   2   0   0   0
   1   1   0   0
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0
7
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0
8
   0   0   0   0
   0   1   0   0
   2   0   0   0
   1   1   0   0 
```

从上面的小 XML 文件中，我通过复制每个元素 6250 次（使用另一个 XSLT 转换 :)）生成了一个 10MB 的 XML 文件。

对于 10MB xml 文件和 XslCompiledTransform (.Net 2.0 + )，这两个解决方案具有以下转换时间：

> 解决方案 1：3.3 秒。
> 解决方案 2：2.8 秒。

使用 XslTransform (.Net 1.1) 解决方案 2 运行了 1622 秒。那是大约27分钟。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T10:38:53.210

世界检查的一件事是您的 XSLT 是否经常查找 XML 文档的其他部分，即您在一个上下文节点中并在文档的另一部分甚至另一个文档中查找一个值。如果你这样做，它会严重影响性能，你应该考虑使用[xsl:key](http://www.zvon.org/xxl/XSLTreference/Output/xslt_key.html)和 key 函数。它告诉处理器对有问题的数据实施快速查找索引。

我曾经构建一个需要 8 小时才能运行的 XSLT（有很多交叉引用），然后切换到使用键给它带来了巨大的速度提升。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T10:48:44.313

在查找您的问题后，我在 Microsoft 找到了一个关于此的 KB。你可以[在这里](http://support.microsoft.com/kb/324478)看到它。

他们说 .NET 1 中的 XSLT 转换存在一些性能问题，他们可以提供快速修复。

如果您想尝试解决问题，这里有一个 XSLT 分析器[可用](http://code.msdn.microsoft.com/xsltprofiler)。

否则，您可以查看 Microsoft 网站上提供的用于优化 XSLT 速度问题的链接（[链接](http://www.google.ca/search?q=XSLT+performance+site%3Amicrosoft.com)）。

# .net - 将 Silverlight 连接到本地计算机的 COM 端口

> ID：227174
> 
> 赞同：3
> 
> 时间：2008-10-22T19:18:43.863
> 
> 标签：.net, silverlight, serial-port

我一直在寻找一种方法来让我的 Silverlight 应用程序与本地计算机上的 COM 端口通信。有没有人能够让 Silverlight 成功连接到您本地计算机的 COM 端口？如果是这样，您能否指出我的文档。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T19:24:23.073

Silverlight 无法做到这一点。

为什么不只使用标准的 .NET 桌面应用程序？如果您需要通过 Web 轻松部署，只需使用 Click-Once 进行部署。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T19:31:45.727

无法访问计算机资源，但您可以使用套接字进行通信。因此，可以让您的用户安装一个应用程序，该应用程序侦听端口并与 COM 端口通信。

为什么要尝试与 COM 端口通信？如果您正在寻找网络摄像头支持，请查看 Jonas 的 hack，它使用 Flash 获取网络摄像头输入：http: [//jonas.follesoe.no/WebcamInSilverlight2MacGyverStyle.aspx](http://jonas.follesoe.no/WebcamInSilverlight2MacGyverStyle.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T06:13:20.673

您可以通过打开从 Silverlight 控件到本地套接字的**套接字连接来执行此操作，该套接字具有 COM 端口访问权限**

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-12-14T23:01:17.717

Silverlight 4 使您能够与 COM (ActiveX) 通信。我写了一篇关于如何与支持与串口通信的 COM 库进行通信的博客文章。

[http://tech-michael.blogspot.com/2009/12/silverlight-talking-to-arduino.html](http://tech-michael.blogspot.com/2009/12/silverlight-talking-to-arduino.html)

请注意，提到的 ActiveXperts 对象是商业的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-22T22:10:35.827

我认为这些人已经很好地总结了 - Silverlight 处于一个紧凑的沙箱中，您将无法访问 COM 端口或其他本地资源。

所以让我们开始考虑替代方案：

*   使用 ClickOnce 和完整的 .NET 应用程序 - 让您轻松部署和更新，您将拥有 .NET 框架的全部功能。
*   使用请求一些额外权限的 XBAP（浏览器部署的 WPF）。将存在于浏览器中，但只能在安装了 .NET 3.0 / 3.5 的 Windows 机器上运行
*   编写一个与 GPS 设备对话并公开 API 的 ActiveX 控件。然后使用 JavaScript 使用此 API 并与 Silverlight 中的 JavaScript 代码进行交互。这将为您提供一个浏览器内的 GPS 应用程序，但您的用户必须安装一个额外的 GPS ActiveX 组件。

干杯，乔纳斯

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-07-07T20:33:40.637

您仍然可以在浏览器之外运行它并使用类似的包装器

[http://interopcom.codeplex.com/](http://interopcom.codeplex.com/)（我写的）

问候，保罗

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T19:25:07.610

本地计算机是指运行 silverlight 客户端应用程序的计算机吗？Silverlight 在安全沙箱中运行，您能否像这样连接到硬件资源值得怀疑。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-22T19:39:14.010

乔恩，

我实际上是在尝试从 Silverlight 读取我的 GPS。我想尝试一个有趣的概念，但我试图实现零安装足迹。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-08T14:42:51.320

如果您希望您的应用程序在 Windows 和 Mac 上运行怎么办？Silverlight 是一个很好的解决方案，因为它可以在两者上运行。如果您必须编写 WPF 应用程序或 ActiveX 控件等，这只会再次将您绑定到 Windows。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-12-16T22:26:38.570

您可以将 Silverlight 5 连接到本地 Comm 端口以及任何其他本地资源，但仅当 Silverlight 应用程序在 Windows（不是 Mac）下运行并且在 Internet 中运行 OOB（浏览器外）或浏览器内时探险家。

这样做的方法是创建一个*经典*的COM 自动化组件，并以完全信任的方式运行应用程序。您可以设置一个注册表项，以允许 Silverlight 5 应用程序能够在完全信任的浏览器中运行，但必须对应用程序进行签名，并且必须将公钥导入本地计算机上的受信任发布者。

完成后，Silverlight 支持 AutomactionFactory，允许您访问本地注册的 com 自动化对象。我们广泛使用此功能；它非常强大。在本例中，我们创建了一个 COM 组件，该组件提供对 SerialPort 对象的访问权限，并为其提供了一个返回所有可用端口列表的方法。

```
If AutomationFactory.IsAvailable Then
      SilPort = AutomationFactory.CreateObject("SilverPort.Ports")
      Dim AllPorts() As String
      AllPorts = SilPort.GetPortNames()
      ...
End If 
```

# c# - UAC 对控制台应用程序的需求

> ID：227187
> 
> 赞同：27
> 
> 时间：2008-10-22T19:21:32.143
> 
> 标签：c#, .net, .net-2.0, uac, manifest

我有一个控制台应用程序需要使用一些需要管理员级别的代码。我读过我需要添加一个清单文件 myprogram.exe.manifest ，如下所示：

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
  <trustInfo xmlns="urn:schemas-microsoft-com:asm.v3">
    <security>
      <requestedPrivileges>
        <requestedExecutionLevel level="requireAdministrator">
      </requestedPrivileges>
    </security>
  </trustInfo>
</assembly> 
```

但它仍然没有提高 UAC（在控制台中或在 VS 中调试）。我该如何解决这个问题？

## 更新

如果我在 Administrator 中运行解决方案或在 Administrator 中运行 /bin/*.exe，我能够使其工作。我仍然想知道是否有可能在应用程序启动时弹出一些东西，而不是明确地右键单击>以管理员身份运行？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2010-02-02T22:31:01.293

对于使用 Visual Studio 的任何人来说，这都非常简单。我正要设置 Windows SDK 并执行 mt.exe 构建后步骤以及所有这些，然后才意识到它已内置到 VS 中。我想我会记录下来以供后代使用。

1.  项目 | 添加新项目 -> Visual C# 项目 -> 应用程序清单文件
2.  打开 app.manifest，将 requestedExecutionLevel.@level 更改为“requireAdministrator”
3.  建造

多达

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2010-04-21T00:48:00.527

Scott 的回答将按照您的要求进行，但 Microsoft 建议控制台应用程序显示“拒绝访问”消息，而不是提示提升。

来自[http://msdn.microsoft.com/en-us/library/bb756922.aspx](http://msdn.microsoft.com/en-us/library/bb756922.aspx)：

> 控制台应用程序在控制台窗口上显示其输出，而不是使用单独的用户界面。如果应用程序需要完整的管理员访问令牌才能运行，则需要从提升的控制台窗口启动该应用程序。
> 
> 您必须对控制台应用程序执行以下操作：
> 
> 1.  将您的应用程序标记为“asInvoker”：您可以通过编写应用程序的清单来执行此操作，在该清单中设置 RequestedExecutionLevel == asInvoker。此设置允许来自非提升上下文的调用者创建您的流程，从而允许他们继续执行第 2 步。
>     
>     
> 2.  如果应用程序在没有完整管理员访问令牌的情况下运行，则提供错误消息：如果应用程序在非提升控制台中启动，您的应用程序应给出简短消息并退出。推荐的消息是：“拒绝访问。需要管理员权限才能使用选定的选项。使用管理员命令提示符来完成这些任务。”
>     
>     
> 
> 应用程序还应该在启动失败时返回错误代码 ERROR_ELEVATION_REQUIRED 以便于编写脚本。

我的 C# 代码如下。它在 Windows XP（管理员 -> 正常，标准用户 -> 拒绝）和 Windows Server 2008（提升管理员 -> 正常，非提升管理员 -> 拒绝，标准用户 -> 拒绝）上进行了测试。

```
static int Main(string[] args)
{
    if (!HasAdministratorPrivileges())
    {
        Console.Error.WriteLine("Access Denied. Administrator permissions are " +
            "needed to use the selected options. Use an administrator command " +
            "prompt to complete these tasks.");
        return 740; // ERROR_ELEVATION_REQUIRED
    }

    ...
    return 0;
}

private static bool HasAdministratorPrivileges()
{
    WindowsIdentity id = WindowsIdentity.GetCurrent();
    WindowsPrincipal principal = new WindowsPrincipal(id);
    return principal.IsInRole(WindowsBuiltInRole.Administrator);
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-03T16:21:07.747

您需要将 UAC 清单嵌入为嵌入式 Win32 资源。请参阅[将 UAC 清单添加到托管代码](http://blogs.msdn.com/shawnfa/archive/2006/04/06/568563.aspx)。

简而言之，您使用 Windows SDK 命令行工具将其嵌入到您的可执行文件中。

您可以通过将以下行作为构建后任务在 VS 项目的属性中将其作为构建后步骤自动化：

```
mt.exe -manifest "$(ProjectDir)$(TargetName).exe.manifest" -updateresource:"$(TargetDir)$(TargetName).exe;#1" 
```

# php - 从客户端 DOM 序列化 SVG 的最佳方法是什么？

> ID：227208
> 
> 赞同：6
> 
> 时间：2008-10-22T19:29:37.930
> 
> 标签：php, javascript, ajax, png, svg

我正在开发交互式 SVG/AJAX 界面，其中元素由用户即时创建和重新定位。我想支持用户将当前视图导出为 PNG 图像和/或 SVG 文档的功能。我真的希望 SVG 文档尽可能简单（没有很多嵌套转换）。是否有任何框架已经支持这一点？

我目前要求我的用户使用 Ctrl+Alt+PrntScrn 技术，我不想要求他们安装任何软件/插件。

服务器端代码现在用 PHP 实现，如果有帮助的话。我已经实现了使用 ImageMagick 从“原始”文档（在客户端进行任何修改之前）生成 PNG 图像的能力。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T22:25:50.477

我假设您只需要在支持 SVG 的浏览器中使用它。

Firefox、Safari 和 Opera 提供了非标准`XMLSerializer`API，因此您可以执行以下操作：

```
var svg = document.getElementById('svg_root'); // or whatever you call it
var serializer = new XMLSerializer();
var str = serializer.serializeToString(svg); 
```

从那里，您可以将其发送到服务器并接收 PNG 作为回报。

这是[Mozilla 关于从 DOM 序列化 XML 的开发者页面](https://developer.mozilla.org/en/Parsing_and_serializing_XML)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T13:05:49.507

Opera 实现了[W3C 的 DOM→XML 序列化](http://www.w3.org/TR/DOM-Level-3-LS/load-save.html)器。在 XML 模式下`innerHTML`，在 Gecko 中返回格式良好的 XML。

HTML5`<canvas>`可以使用将其内容导出为 PNG 文件`toDataURL()`，并且可以使用 绘制`<img>`画布上的任何元素`drawImage()`，因此应该可以`<img src="data:application/svg+xml,…">`在画布上创建、绘制它并导出为`data:`URL。

# diff - 如何查找 CVS 版本之间更改的行数？

> ID：227210
> 
> 赞同：2
> 
> 时间：2008-10-22T19:30:27.787
> 
> 标签：diff, cvs

我花了一天的大部分时间对我们的一个项目的代码库进行基本的一些内务更改（用`System.out.println()`log4j 替换所有调用）。

我有点好奇我用这组更改更新了多少行代码。

无论如何，是否有使用`cvs diff`或其他命令来准确计算已更改的行数？

我试过了

```
cvs diff -b -B -R 
```

获取工作目录（以及递归子目录）中的所有更改，但是对于每个更改的文件，它还会打印出文件/版本信息，这使得仅计算输出行数毫无用处。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-08T11:06:48.740

[diffstat](http://invisible-island.net/diffstat/)实用程序是一个很好的工具，可以从 cvs、svn 或其他 diff 的输出中获取一些简单的指标。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T19:58:32.303

从 diff 输出中过滤掉多余的行，然后计算行数。

例如，grep 仅以 < 或 > 开头的行

```
cvs diff -b -B -R | egrep '^<|>' | wc -l 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T19:40:51.980

您可以简单地将 cvs diff 的输出通过管道传输到 diffstat。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T19:53:02.873

如何验证您是否已使用以下内容更改了所有实例：

```
find . | egrep -v -e '(CVS|<other patterns you don't want>)' | \
    xargs egrep -e 'System\.out\.println[(][)]' | wc -l 
```

那应该给你零。

然后用 'log4j' 替换第二个 egrep 中的正则表达式应该让 wc -l 返回您更改的行数。

HTH。

干杯，

抢

# ruby-on-rails - 在acts_as_taggable_on_steroids 中按字母顺序对标签云进行排序

> ID：227211
> 
> 赞同：3
> 
> 时间：2008-10-22T19:30:29.893
> 
> 标签：ruby-on-rails, tags, tag-cloud, acts-as-taggable

我让acts_as_taggable_on_steroids 插件正常工作。在我看来，tag_cloud 方法可以正确创建和格式化云，但是标签是按“count desc”的顺序列出的。

如何按字母顺序在云中显示我的标签？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T20:30:56.900

这是我在我的网站上按名称对标签进行排序的操作：

```
<% tag_cloud Post.tag_counts.sort { |x, y| x.name <=> y.name }, %w(x-small small normal large x-large) do |tag, css_class| %>
  <%= link_to tag.name, tag_url( :tag => tag.name ), :class => css_class %>
<% end %> 
```

# .net - 在 .NET 中发送电子邮件，电子邮件保存在用户的已发送项目中

> ID：227213
> 
> 赞同：3
> 
> 时间：2008-10-22T19:30:53.637
> 
> 标签：.net, vb.net, email, outlook

我正在尝试使用 VB.NET 发送电子邮件。

有两个要求：

1.  电子邮件将保存在 Outlook（他们唯一的电子邮件客户端）中的“已发送邮件”文件夹中。
2.  PDF（即时生成）附加到电子邮件中。

我目前正在创建一个新的[MailMessage](http://msdn.microsoft.com/en-us/library/system.net.mail.mailmessage.aspx)并通过[SmtpClient](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.aspx)发送，但我相信这是从服务器发送的，而不是从客户端发送的。

这可能吗？

编辑：这是一个 winforms 应用程序，目的是向客户发送报告。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T19:35:59.803

我认为您需要执行以下操作之一才能获得所需的确切功能：

*   Outlook 互操作
*   交换事件接收器

作为一个更简单的选择，如何密件抄送用户（将进入他们的收件箱）并配置 Outlook 规则以将其移动到已发送的项目？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T19:36:55.467

你是对的，它不会最终出现在用户发送的项目中。您将遇到的问题之一是 Outlook 必须执行此操作的 API 已被病毒利用，因此用户每次都需要确定发送。

我会研究您是否可以通过与 Exchange 交谈来做到这一点。编写 Outlook 脚本和直接与 Exchange 对话都有 API。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T19:40:59.030

只需使用 Exchange WebDav API。

以下是有关如何使用 WebDav 发送电子邮件的 Microsoft 支持示例：[Q296713](http://support.microsoft.com/kb/296713)

注意：抱歉，上面的示例适用于 VB 6，将代码移植到 VB.NET 应该非常简单（另外，您可以使用 System.Xml 类和/或 StringBuilder 来帮助构建 WebDav xml 请求）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T19:34:48.760

您必须使用 Exchange 服务器 API 或拥有 Outlook 的本地副本并使用 Outlook 客户端 API 才能实现此目的。SMTP 客户端和交换器实际上几乎没有什么关系，除了 Exchange 服务器知道如何处理 SMTP 消息这一事实。

您最好只发送两份电子邮件，一份给发件人，一份给收件人。让它出现在发送的项目中并不是那么简单，但它会减少工作量并实现相同的目标。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-17T14:09:54.317

我想，为什么我们不能在我们的数据库中做出**规定**，并且在发送电子邮件后，我们发送的相同详细信息也应该保存在我们的**数据库**中，并在用户单击已**发送**项目按钮时可用。

[如何发送带附件的电子邮件？网络](http://ram-a-singh.blogspot.in/2013/03/how-to-send-email-with-attachment-vbnet.html)

# c# - 将 DataRowCollection 转换为 DataRow[]

> ID：227215
> 
> 赞同：49
> 
> 时间：2008-10-22T19:31:45.383
> 
> 标签：c#, performance, datarow, datarowcollection

将 DataRowCollection 实例转换为 DataRow[] 的最佳执行方式是什么？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-10-22T19:47:36.427

```
DataRow[] rows = dt.Select(); 
```

假设您仍然可以访问数据表。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2012-04-23T14:25:22.490

为了完整起见，这是另一种方式（使用 Linq），它*保留了行顺序*：

```
DataRow[] rows = dt.Rows.Cast<DataRow>().ToArray() 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-22T19:46:18.177

这很明显，但是：

`DataRowCollection.CopyTo(DataRow[] array, Int32 offset)`?

似乎无论如何，您都必须迭代集合（CopyTo 迭代内部 DataRowTree 元素）。

我想您可以使用反射来访问非公共树，但成本很高。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-08-27T15:47:48.773

如果您无权访问包含表，则可以使用扩展方法：

```
public static class DataRowCollectionExtensions
{
    public static IEnumerable<DataRow> AsEnumerable(this DataRowCollection source)
    {
        return source.Cast<DataRow>();
    }
} 
```

之后：

```
DataRow[] dataRows = dataRowCollection.AsEnumerable().ToArray(); 
```

但是，如果您可以访问包含表，最好使用`DataTable`的`AsEnumerable`扩展方法（[Description](http://msdn.microsoft.com/en-us/library/system.data.datatableextensions.asenumerable(v=vs.110).aspx)，[Source](http://referencesource.microsoft.com/System.Data.DataSetExtensions/a.html#234b3444d2a5ff75)）访问行：

```
DataRow[] dataRows = dataTable.AsEnumerable().ToArray(); 
```

无论哪种方式，您都可以使用带有多个重载（[Description](http://msdn.microsoft.com/en-us/library/system.data.datatable.select(v=vs.110).aspx)，[Source](http://referencesource.microsoft.com/System.Data/R/d57c1612e35a7f9a.html)`DataTable` ）的 's方法：`Select`

```
DataRow[] dataRows = dataTable.Select(); 
```

# python - 如何使用 Python 提取硬件 ID？

> ID：227222
> 
> 赞同：6
> 
> 时间：2008-10-22T19:33:34.363
> 
> 标签：python, hardware, extract

如何使用 python 脚本提取 HD 和 Bios 唯一 ID？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T20:01:08.177

去获取微软的[Scriptomatic](http://www.microsoft.com/downloads/details.aspx?familyid=09dfc342-648b-4119-b7eb-783b0f7d1178&displaylang=en)

运行它，从下拉列表中选择适当的类（WIN32_BIOS）

它将为您生成必要的 Python/WMI 代码。（它还将生成 VBScript、Perl 和 JScript）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T19:41:58.200

我想到的解决方案：

1.  使用[Win32 Python 扩展](http://python.net/crew/mhammond/win32/Downloads.html)并调用 Windows API 直接执行此操作
2.  使用 Python 的 WMI 包装器

（一些[WMI接口代码](http://www.microsoft.com/technet/scriptcenter/scripts/python/misc/wmi/mswmpy01.mspx?mfr=true)供参考）

*编辑*：我假设你的操作系统是 MS Windows :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T22:38:19.250

在 Linux 上，查看 /proc 目录。您必须解析文件才能找到您要查找的内容。

[这](http://www.linux.com/feature/126718)可能会有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-05T19:01:50.700

试试这个库：[硬件 ID 提取器](http://www.soft.tahionic.com/download-hdd_id/index.html)

* * *

工具小说明：

Hardware ID Extractor 是一个 Microsoft Windows 程序，可显示有关您的计算机硬件的数据：

硬盘：

*   硬盘 ID（硬盘 IDE 电子芯片中写入的唯一硬件序列号）

*   分区 ID（卷序列号）

中央处理器：

*   CPU ID（唯一硬件 ID）
*   CPU 供应商
*   CPU运行速度
*   CPU理论速度

物理内存：

*   内存负载（已使用的总内存，以百分比 (%) 为单位）*Total Physical（以字节为单位的总物理内存）*Avail Physical（以字节为单位的剩余物理内存）*Total PageFile（以字节为单位的总页面文件）*Available PageFile（剩余的页面文件字节）*总虚拟（以字节为单位的总虚拟内存）*可用虚拟（以字节为单位的虚拟内存）

# .net - 将 DAO 注入实体是一件坏事吗？

> ID：227225
> 
> 赞同：1
> 
> 时间：2008-10-22T19:34:42.617
> 
> 标签：.net, architecture

因此，像大多数新的 .NET 开发人员一样，您开始在各处传递 DataSet，尽管事情做得很好，但似乎并不正确。

下一步通常是创建扩展 DAL 基类的实体对象，这样你就有了

```
public class User : UserDAL
{
    //User specific methods
}
public class UserDAL
{
  //Bunch of user specific properties
  public User Load(int Id)
  {
    //Some low level ADO calls
  }
  private User LoadFromDataSet(DataSet ds)
  {
     //Load entity properties from DataSet 
  }    
} 
```

用户使用 ADO.NET 扩展具有低级数据访问调用的 UserDAL 对象。

从这里您将继续了解此实现意味着您与数据访问层绑定，并且您使用单独的实体、数据访问对象和 DAO 接口进行模拟或在需要时轻松更换 DAO。IE

```
public UserDAO : IUserDAO
{
  //Data access Functions
} 
```

通过使用泛型和反射或良好的 ORM，您可以减轻一些更常见的数据访问 CRUD 操作，即

```
Public UserDAO<User> : BaseDAO<User>, IUserDAO
{
  //BaseDAO deals with basic crud so more custom data access methods can go here 
} 
```

所以基本上这就是我目前所处的位置，除了一些其他好的做法，比如使用 IoC 来解决我想要的特定 IUserDAO。但是，虽然我看到了这种结构的优势，但我也觉得我错过了旧的 User.Load(1) 方法调用。

我想知道的是，将我的 IUserDAO 注入 User 实体并让它处理基本的 CRUD 操作会是一件坏事吗？

我的理解是，作为 POCO，用户实体通过网络传递不会有任何问题，并且添加诸如 Save()、Load() 等方法在数据传输对象的意义上没有相关性。

但是话虽如此，我的实体通常具有延迟加载的集合，这在 DTO 意义上没有任何意义。此外，我相信使用 WFP 可以选择我想要序列化的属性，或者至少我可以在需要通过网络发送它时创建一个新的 UserDTO。

所以基本上，除了那个问题之外，让我的 User 实体包含 DataAccess 相关方法的其他问题是什么？也有人可以澄清我所说的是否被称为活动记录模式或者这是别的什么？

编辑：

克里斯蒂安利巴多指出：

> 至于潜在的缺点，与持久性代码、跟踪/更新关联时的重新定位、可测试性和查询有更大的耦合。

会有更大程度的耦合，但我的想法是类似于以下内容：

```
public class User
{
   IUserDAO userDAO;
   public User()
   {
         userDAO = IoCContainer.Resolve<IUserDAO>;
   }
  public User(IUserDAO userDAO)
   {
         this.userDAO = userDAO;
   }
   //DAL methods
} 
```

所以耦合应该是最小的，至于可测试性，我不认为这是一个问题，因为我可以将一个模拟 DAO 注入到实体中。

感谢 Brian Hasden，这些都是非常好的资源，但我想我只是想为我显然要做的事情找理由。感谢您提供上述理由。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T19:42:05.893

我得出了同样的结论。加载在实体中通常没有意义，因为一旦有了实例，您要么创建一个新实体，要么已经加载了一个实体。多年来，我一直在使用带有保存（创建和更新）和删除的实体，没有任何问题。话虽如此，仍然有一个 DAO 来做其他事情通常很有用，所以你并没有完全结合 DAO 和实体。大多数情况下，对于我的实体，Save 和 Delete 方法只是调用 DAO Save 和 Delete 方法。

顺便说一句，我通常将脏标志与实体结合起来，以了解何时更改了属性，这样您就不会在实体未更改时进行不必要的保存调用。

通常，除了包含私有成员的 getter 和 setter 之外什么都不做的实体意味着您正在使用一个贫乏的域模型。这是一个相当有争议的反模式。

您可以在以下位置找到有关它的更多信息：

[http://www.martinfowler.com/bliki/AnemicDomainModel.html](http://www.martinfowler.com/bliki/AnemicDomainModel.html) [http://wrschneider.blogspot.com/2005/01/avoiding-anemic-domain-models-with.html](http://wrschneider.blogspot.com/2005/01/avoiding-anemic-domain-models-with.html) [http://www.dotnetjunkies.com/ WebLog/richardslade/archive/2007/03/07/209401.aspx](http://www.dotnetjunkies.com/WebLog/richardslade/archive/2007/03/07/209401.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T19:51:39.243

是的，您所描述的听起来就像活动记录（将数据库行制成一个对象，其逻辑是从/向数据库持久化）。毫无疑问，这是一种有效的技术。

至于潜在的缺点，与持久性代码、跟踪/更新关联时的重新定位、可测试性和查询有更大的耦合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T01:13:29.593

将持久性排除在域类的继承模型之外，很大程度上是为了编写可理解和可维护的代码。

持久性与您的班级的实际职责是正交的。我注意到，inherit-from-DAO 方法将世界任意划分为两类，从责任和行为的角度来看，它们没有什么不同。一个班级属于哪一方往往会随着时间而改变。您不希望该更改影响该类的 API 以及与其他类的交互。

示例：假设今天，您的 Product 类使用通过 IoC 检索的 IPriceCalculator。明天，你决定你需要允许修改每个产品的算法，这样你的 IPriceCalculator 就变成了数据驱动的。这可能是一个痛苦的变化，特别是如果您的价格计算器已经有一个提供重要功能的基类。

这个例子突出了另一个考虑因素：从 DAO 类继承意味着您的 User 类刚刚失去了继承可能具有有用行为的 Person 类的能力。（在 .NET 世界中，MarshalByRefObject 是人们需要继承的公共基类，它可能与基于继承的 DAO 要求相冲突。）对于单继承，为了获得可能需要单独考虑的功能而进行继承并不理想。

# visual-studio-2005 - Visual Studio 解决方案资源管理器锁定

> ID：227230
> 
> 赞同：8
> 
> 时间：2008-10-22T19:35:24.593
> 
> 标签：visual-studio-2005, tfs

我在使用带有 TFS 的 Visual Studio 2005 时遇到问题，解决方案资源管理器有时会停止响应交互。相反，它会发出哔哔声，就像我试图单击带有可见模式对话框的父窗口一样，但没有。到目前为止，我发现唯一要做的就是重新启动 VS，但这有点痛苦，因为我们的解决方案相当大。它甚至不是保证......当我加载解决方案时它可能会再次发生。

我很好奇是否有其他人遇到过这个问题并且知道重新启动 VS 直到它消失的更好解决方案。

[编辑：2010 年 6 月 11 日] 我已经搬到 VS 2008 并且从那以后就没有这个问题了。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-12T10:12:08.440

如果 VS 编辑器锁定伴随着创建永远不会完成的**Setup.exe**进程（在任务管理器中可见），那么这是 Microsoft Office 2007 组件的问题。

对我有用的解决方案 - 重新安装 Microsoft Office 2007。[更多详细信息](http://abdullin.com/journal/2009/5/12/visual-studio-2008-locks-or-freezes-in-aspx.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T20:59:51.823

在 Visual Studio 2005 中，弹出的模式对话框会记住它们相对于 Windows 虚拟桌面上 0,0 的位置。如果您更改您的多显示器配置，例如移除一个监视器，并且弹出对话框将自身恢复到不再是虚拟桌面的可见部分的位置，则您可以在屏幕外存在一个模态对话框。如果您再次进入这种情况，请尝试按 alt-spacebar 拉下窗口的系统菜单，然后按 M 移动。然后按下箭头键之一，对话框的位置将绑定到鼠标。然后，您可以将模式对话框重新显示在屏幕上。

此错误已在 VS 2008 SP1 中修复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T19:48:17.113

是的，这是 Visual Studio 2005 中的一个常见问题，后台线程会喜欢 Visual Studio，并且不会让任何事情发生。然后状态栏中应该会出现一个小图标，基本上说“Visual Studio 正在工作，请耐心等待。” 每当我第一次启动文档浏览器时，都会发生这种情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T19:58:27.903

我在 VS 2005 的不同部分遇到过类似的问题，但它们更多地与无法访问的网络驱动器和 IntelliSense 刷新有关。

我确保卸载任何未使用的网络驱动器并禁用 IntelliSense，因为无论如何我都在使用此方法使用 Visual Assist：

[http://www.wholetomato.com/forum/topic.asp?TOPIC_ID=5550](http://www.wholetomato.com/forum/topic.asp?TOPIC_ID=5550)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-03T15:29:47.150

我对 VS2008 9.0.30729.1 也有同样的问题。SP，一旦我使用 Alt+Space，然后是 M，然后将模型窗口拖到视图中，VS2008 就能够记住我希望在哪里显示这个模型对话框。

请注意，Google 无法找到此页面，但 Bing 可以！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-24T12:40:57.040

我的操作系统是 64 位的。我安装了office 2007。我卸载了它并安装了office 2010。然后这个问题开始出现。我使用修复选项运行“C:\Program Files (x86)\Common Files\microsoft shared\OFFICE12\Office Setup Controller\Setup.exe”应用程序，问题得到解决。我的一位同事出于同样的原因遇到了同样的问题，同样的修复也为他解决了这个问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T21:42:39.953

尝试从源代码管理中解除您的解决方案的绑定。您可以使用命令行 TFS 工具（“tf”）执行相同的操作，它应该防止 VS 由于高延迟连接/丢弃到 TFS 而冻结。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-25T07:48:21.247

此外，一个非常大的文档存储会显着减慢 Team Explorer 的速度……*叹息*

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-10T22:22:52.400

每次我进入设计器模式编辑 aspx 文件时，我的 Visual Studio 2008 都会锁定。

我的解决方案是使用 sp1 重新安装 .net 3.5，它似乎解决了问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-08-06T21:52:17.830

如果解决方案开始表现不佳，我会尝试的第一件事是删除 .suo 文件是否有帮助。此文件包含有关当前设计器和窗口状态（以及更多）的信息。

删除它允许重新打开解决方案，就像刚从源代码管理中签出时一样，而不会出现设计器崩溃等。

如果您有一些加载项问题，运行“devenv.exe /resetskippkgs”可能会有所帮助。（这会重新启用在先前错误后已禁用的加载项）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-08-16T16:09:12.603

全新安装 Office 2010 Pro Plus 后，我刚开始在 VS 2008 上遇到同样的问题。Alt-Space-M-箭头键没有做任何事情。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-29T14:38:40.430

我在 Visual Studio 2008 中遇到了同样的问题（特别是在安装 MVC 框架之后）。我的解决方案是安装 .Net 3.5 SP1 系列更新，通过添加/删除重新安装 Visual Studio，然后重新安装 MVC 框架......希望对某人有所帮助 - 因为这个问题真的很烦人。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-03-04T16:21:19.743

在将 Souution Explorer 取消对接并将其移动到第二台显示器后，我已将其锁定。

奇怪的是，当我更改正在处理的文件但不允许我单击窗口本身时，解决方案资源管理器仍然响应。

这已通过选择**Window > Reset Window Layout修复**

# wpf - ListBox vs. ListView - 如何选择数据绑定

> ID：227231
> 
> 赞同：326
> 
> 时间：2008-10-22T19:35:30.727
> 
> 标签：wpf, data-binding, listview, listbox

我正在考虑为 WPF 应用程序使用 ListBox 或 ListView。似乎要么支持数据绑定和项目模板。我的应用程序有一个简单的项目列表，我打算根据用户输入搜索/排序/过滤这些项目。数据绑定演示 ( [http://msdn.microsoft.com/en-us/library/ms771319.aspx](http://msdn.microsoft.com/en-us/library/ms771319.aspx) ) 使用带有 CollectionViewSource 的 ListBox。

是否有人对使用哪个控件以及何时使用有优点/缺点？

* * *

## 回答 #1

> 赞同：373
> 
> 时间：2008-10-22T20:10:43.823

ListView 是一个专门的 ListBox（也就是说，它继承自 ListBox）。它允许您指定不同的视图而不是直接列表。您可以滚动自己的视图，也可以使用 GridView（想想类似资源管理器的“详细信息视图”）。它基本上是多列列表框，是 windows 窗体列表视图的表亲。

如果您不需要 ListView 的附加功能，如果您只是显示项目列表（即使模板很复杂），您当然可以使用 ListBox。

# java - 在 Java 中以编程方式将 Word doc 转换为 HTML

> ID：227236
> 
> 赞同：24
> 
> 时间：2008-10-22T19:36:27.587
> 
> 标签：java, html, ms-word

我需要将 Word 文档转换为 Java 中的 HTML 文件。该函数将输入一个word文档，输出将是基于word文档页数的html文件，即如果word文档有3页，那么将生成3个具有所需分页符的html文件。

我搜索了可以将 doc 转换为 html 但没有结果的开源/非商业 API。以前做过这种工作的人请帮忙。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-06-23T09:21:16.403

我推荐[JODConverter](http://www.artofsolving.com/opensource/jodconverter)，它利用了 OpenOffice.org，它为当今可用的 OpenDocument 和 Microsoft Office 格式提供了可以说是最好的导入/导出过滤器。

JODConverter 有很多文档、脚本和教程可以帮助您。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T20:31:17.743

我在新的 MS Word XML 格式不可用的生产系统中成功使用了以下方法：

生成一个执行类似于以下操作的进程：

[http://www.oooninja.com/2008/02/batch-command-line-file-conversion-with.html](http://www.oooninja.com/2008/02/batch-command-line-file-conversion-with.html)

您可能希望在程序启动时启动一次 openoffice，并在程序期间根据需要多次调用 python 脚本（通过某种检查以确保 ooffice 进程始终存在）。

另一种选择是在每次需要进行转换时生成以下命令：

ooffice -headless "macro://<要转换的 ooffice vb 宏的路径，参数指向文件>"

我已经多次使用宏方法并且效果很好（抱歉，我没有可用的宏代码）。

虽然有通过 MS Word 执行此操作的机制，但它们在 Java 中并不容易，并且确实需要其他支持程序才能通过 OLE 驱动 MS Word。

我以前也使用过 abiword，它适用于许多文档，但确实会与更复杂的文档混淆（ooffice 似乎可以处理我扔给它的所有内容）。Abiword 的转换命令行界面比 ooffice 稍微简单一些。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-22T20:43:19.870

我们使用 tm-extractors ( [http://mvnrepository.com/artifact/org.textmining/tm-extractors](http://mvnrepository.com/artifact/org.textmining/tm-extractors) )，并回退到商业 Aspose ( [http://www.aspose.com/](http://www.aspose.com/) )。两者都有本机 Java API。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T01:56:04.667

如果它是 docx，您可以使用[docx4j](http://dev.plutext.org) (ASL v2)。这使用 XSLT 创建 HTML。

但是，它将为您提供整个文档的单个 HTML。

如果您希望每页都有一个 HTML，您可以使用 Word 放入 docx 的 lastRenderedPageBreak 标记来做一些事情（假设您使用 Word 创建它）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-10T21:02:04.730

在新的 MS word docx 中更容易做到这一点，因为格式是 XML。您可以使用 XSL 将 XML 格式的 Word 文档转换为 HTML 格式。

但是，如果您的 Word 文档是旧版本，您可以使用 POI 库 [http://poi.apache.org/](http://poi.apache.org/)然后访问它并生成一个 Java 对象，从那时起，您可以使用以下方法轻松地将其转换为 HTML 格式一个 HTML java 库

[http://www.dom4j.org/dom4j-1.4/apidocs/org/dom4j/io/HTMLWriter.html](http://www.dom4j.org/dom4j-1.4/apidocs/org/dom4j/io/HTMLWriter.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-11T14:09:25.250

我看到这个帖子出现在外部链接中，并且偶尔会发帖，所以我想我会发布一个更新（希望没人介意）。OpenOffice 不断发展，3.2 版再次改进了单词导入导出过滤器。OpenOffice 和 Java 可以在许多平台上运行，因此 Java 系统可以直接使用 OpenOffice UNO API 来导入/操作/导出多种格式（包括 word 和 pdf）的文档，或者使用[JODReports](http://jodreports.sourceforge.net/)或[Docmosis](http://www.docmosis.com)等库来促进。两者都有免费/开放选项。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-06-15T07:15:25.303

我尝试了这种方式，并从这个站点 [http://code.google.com/p/xdocreport/wiki/XWPFConverterXHTML与我一起工作](http://code.google.com/p/xdocreport/wiki/XWPFConverterXHTML)

这仅适用于 docx 将其转换为该 word 文档中包含的 html 图像。

```
 // 1) Load DOCX into XWPFDocument
    InputStream doc = new FileInputStream(new File("c:/document.docx"));
    XWPFDocument document = new XWPFDocument(doc);

   // 2) Prepare XHTML options (here we set the IURIResolver to load images from a "word/media" folder)
            XHTMLOptions options = XHTMLOptions.create(); //.URIResolver(new FileURIResolver(new File("word/media")));;

            // 3) Extract image
            String root = "target";
            File imageFolder = new File( root + "/images/" + doc );
            options.setExtractor( new FileImageExtractor( imageFolder ) );
            // 4) URI resolver
            options.URIResolver( new FileURIResolver( imageFolder ) );

            OutputStream out = new FileOutputStream(new File("c:/document.html"));
            XHTMLConverter.getInstance().convert(document, out, options); 
```

我希望这能解决你的问题

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T19:48:46.877

您必须找到 MS word doc 规范（因为它基本上是当时 word 中任何内容的二进制转储），然后慢慢地逐个元素地将 ms 单词“对象/状态”转换为 html相当于 你也许可以找到一个脚本来为你做这件事，因为这真的不是一件有趣的工作，我建议你不要这样做（转换文件格式，甚至自己从商业文件中读取总是很困难，而且往往是不完整的）。PS：只是[谷歌 doc2html](http://www.google.com/search?client=opera&rls=en&q=doc2html+conv&sourceid=opera&ie=utf-8&oe=utf-8)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-22T20:20:18.157

如果您使用 ooxml 格式定位 word 2007 文件，那么[本文](http://www.infoq.com/articles/cracking-office-2007-with-java)可能会有所帮助。还有一个为 Java 库实现 ooxml的[Ooxml4j项目。](http://www.openxml4j.org/Documentation/Overview.html)

如果您的目标是二进制文件……那是另一个问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T11:44:39.420

```
import officetools.OfficeFile; // package available at www.dancrintea.ro/doc-to-pdf/
...
FileInputStream fis = new FileInputStream(new File("test.doc"));
FileOutputStream fos = new FileOutputStream(new File("test.html"));
OfficeFile f = new OfficeFile(fis,"localhost","8100", true);
f.convert(fos,"html"); 
```

所有可能的转换：

doc --> pdf、html、txt、rtf

xls --> pdf、html、csv

ppt --> pdf, swf

html --> pdf

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-01-27T03:08:48.273

你可以[在线使用微软办公软件](https://products.office.com/zh-CN/office-online/view-office-documents-online?legRedir=true&CorrelationId=fa00faac-9fcd-40c8-b64d-893c4f25d553)

首先，在服务器端请求[https://view.officeapps.live.com/op/view.aspx?src=](https://view.officeapps.live.com/op/view.aspx?src=) 'your doc file online url'

然后使用[jsoup](https://jsoup.org/)解析结果 html

*当从移动设备访问时，html 将包含一个框架。*

# java - Java：有什么方法可以在组件中的某处将对象与组件相关联？

> ID：227249
> 
> 赞同：1
> 
> 时间：2008-10-22T19:39:27.380
> 
> 标签：java, awt

作为我[关于 java.awt.Component.getName() 属性的问题](https://stackoverflow.com/questions/227143/java-what-is-javaawtcomponentgetname-and-setname-used-for)的后续，我想知道是否有一种方法可以在 Component 的某处放置任意对象，类似于[.NET 中的 tag 属性](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.tag.aspx)？对于对组件有效但不一定知道该组件是什么的任何代码，这将非常方便。

例如，假设我正在尝试实现一个应用程序范围的帮助系统，该系统知道查看鼠标当前指向的任何组件，进入该组件并拉出它的帮助文本并将其显示在屏幕上它自己的窗格中（不，我不想使用工具提示）。我目前的回答是使用名称 (getName()/setName()) 来存储帮助文本，这将起作用，但名称必须是一个字符串。如果我想变得更漂亮并存储除字符串以外的任何东西，我想我会被卡住。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T13:30:12.023

`JComponent`有`putClientProperty`和`getClientProperty`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T19:45:18.333

组件没有办法做到这一点。但是，一种选择是使用静态地图并为其提供包装器，以便您可以查询与任何 UI（或其他）对象相关的数据。我以前做过这种事情，只要你把它设置为一种带接口的服务，它就可以非常优雅，并且不会破坏你的 OO 设计。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:51:33.583

每当我将组件添加到屏幕时，我通常都会创建一个哈希并放置（组件，cookie）。当您需要返回 cookie 对象时（可能是在某个事件中），该事件总是会获取组件的副本，然后您就只是远离 cookie 的一个 get(component) 而已。

在某些极端情况下，我将控件子类化并添加了一个字段。这是一个快速而肮脏的修复，因为对组件进行子类化就像几行代码一样，并且可以与生成屏幕的文件放在同一个类中。这仅在您只需要存储连接到单一类型控件的数据时才有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T20:38:56.527

是的，您可以使用 get/setName 设置某种标识符，然后使用该标识符映射到您的帮助。JavaHelp CSH 的东西有点像这样，除了我相信这是将组件本身放入地图中？

# migration - 如何将 CVS 存储库从一台服务器移动到另一台服务器并维护历史记录？

> ID：227262
> 
> 赞同：4
> 
> 时间：2008-10-22T19:43:54.000
> 
> 标签：migration, cvs

我的本地工作站上有一个 CVS 存储库。我已经向我的雇主证明了版本控制是一个好主意。好吧！所以现在我想将我的 CVS 历史从我的本地工作站迁移到一个真实的服务器上。

我已经在服务器上安装了 CVS，它正在工作。

现在，我可以移动我的存储库文件吗？还是我必须执行某种导入命令？

我知道我可以将当​​前代码库检查到新的 CVS 服务器中，但这会丢失历史记录，对吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-06T23:30:14.587

只需复制文件 - 它真的没有其他任何东西（至少如果源和目标操作系统相同）

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2008-10-22T19:46:50.967

我上周刚迁移了一个。

我们在工作中使用 Subversion，我所做的只是将根 Subversion 目录从一台机器移动到另一台机器。然后，当我在新机器上安装[VisualSVN 服务器](http://www.visualsvn.com/server/)时，我只选择了我移植的现有 Subversion 根目录，而不是创建新的存储库。它无缝地维护历史和文件。

我不确定这将如何与其他源代码控制系统一起使用。

# asp.net-mvc - 使用 Linq 将相关表中的数据复制并插入到一组新的相关表中的最佳方法是什么

> ID：227274
> 
> 赞同：2
> 
> 时间：2008-10-22T19:47:46.880
> 
> 标签：asp.net-mvc, linq, linq-to-sql, orm

我从事网页游戏，我使用 asp.net mvc，linqtosql。

我有 3 个存储默认游戏值的表：DefaultRegions、DefaultSubRegions 和 DefaultCountries。由于主键/外键，这 3 个表相互关联。

当有人创建新游戏时，我需要将这些表的值复制到 3 个名为 Regions、SubRegions 和 Country 的表中。在这 3 个表中，保存了正在进行的游戏的值（添加了 GameId 以区分游戏）。

现在，我需要更新关系，因为主键显然发生了变化。

任何人都知道以有效方式实现这一目标的方法吗？

我的想法会涉及繁琐的 foreach 循环，也许其他人有想法？

**编辑**看起来我最初的想法是最好的方法，谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T19:56:42.743

试试这个，它应该在提交时创建并关联所有新的自动生成的 ID。

```
var defaultRegions = from r in DefaultRegions
             select r;

IList<Region> rlist = new List<Region>();
foreach(var dr in defaultRegions) {
    var r = new Region {
        Name = dr.Name };

    foreach(DefaultSubRegion dsr in dr.DefaultSubRegions) {
        var sr = new SubRegion {
            Name = dsr.Name };

        foreach(DefaultCountries dc in dsf.DefaultCountries) {
            var c = new Country {
                Name = dc.Name };

            sr.Countries.Add(c);
        }

        r.SubRegions.Add(sr);
   }

   rlist.Add(r);
}

DataContext dc = new DataContext();
dc.Regions.InsertAllOnSubmit(rlist);
dc.Submit(); 
```

这应该对你有用，这是我发现复制数据的最简单方法。

# java - Java RMI 在租约到期后不关闭套接字

> ID：227276
> 
> 赞同：1
> 
> 时间：2008-10-22T19:48:13.133
> 
> 标签：java, sockets, rmi

我启用 RMI 的应用程序似乎正在泄漏套接字。我有一个通过 RMI 提供服务的 Java 应用程序。它使用在 Linux 上运行的 Java SE 1.6 RMI 实现。我观察到的问题是，如果客户端使用注册表获取对我的远程对象的引用，然后突然断开连接（断电、拔掉电缆等），服务器会保持套接字打开。我希望 RMI 实现在客户端的租约到期后进行清理，但这并没有发生。在服务器上，`unreferenced()`当租约到期时调用我的远程对象的方法，但套接字在 netstat 中无限期地处于“ESTABLISHED”状态。

由于我们无法强制客户端执行任何特定行为，因此几天后，我们的 Linux 发行版中的打开文件描述符达到了默认限制 1024，导致服务器无法打开任何新的套接字或文件。我考虑过 TCP keepalives，但由于 RMI 正在抽象出网络层，所以在建立连接后我无法访问实际的服务器套接字。

有没有办法强制 RMI 层清理绑定到具有过期租约的客户端连接的套接字？

**更新：**我使用的解决方案类似于选择的答案，但使用了不同的方法。我使用了一个自定义套接字工厂，然后将 createServerSocket() 返回的 ServerSocket 实例包装在一个透明包装器中，该包装器传递所有方法，除了 accept()。在 accpet 方法中，keepalives 在套接字返回之前启用。

```
public class KeepaliveSocketWrapper extends ServerSocket
{
    private ServerSocket _delegate = null;
    public KeepaliveSocketWrapper(ServerSocket delegate)
    {
        this._delegate = delegate;
    }

    public Socket accept() throws IOException
    {
        Socket s = _delegate.accept();
        s.setKeepAlive(true);
        return s;
    }
    .
    .
    .
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-22T23:47:42.947

```
public class MySocketFactorySettingKeepAlive ... {
  // overwrite createSocket methods, call super.createSocket, add keepAlive
}

Socket.setSocketImplFactory(youFactoryDemandingKeepAlive); 
```

然后只需使用 RMI。

如果我没记错的话，诀窍是在系统打开第一个套接字之前设法设置工厂——Java 不允许覆盖工厂；在最坏的情况下，使用反射来覆盖它:)))（开玩笑；会是一个黑客）

此外，您可能需要在 SecurityManager 中允许特定操作。

# python - 如何使用 Twisted Words Python 库创建一个简单的 Google Talk 客户端？

> ID：227279
> 
> 赞同：17
> 
> 时间：2008-10-22T19:48:33.570
> 
> 标签：python, twisted, xmpp, google-talk

我有兴趣使用 Python 制作 Google Talk 客户端，并希望使用 Twisted 库 Words 模块。我查看了这些示例，但它们不适用于 Google Talk 的当前实现。

有人对此有任何运气吗？您介意记录一个简短的教程吗？

作为一项简单的任务，我想创建一个客户端/机器人来跟踪我的各种 Google Talk 帐户的在线时间，以便我可以获得一个汇总数字。我想我可以将每个帐户中的机器人加为好友，然后使用 XMPP 存在信息来跟踪我可以聚合的时间。

谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-29T05:42:54.557

wokkel 是扭曲文字的未来。 [metajack](http://metajack.im/)写了一篇关于入门的非常好的[博客文章。](http://metajack.im/2008/09/25/an-xmpp-echo-bot-with-twisted-and-wokkel/)

如果您想从一个不错的功能示例项目开始，请查看我的[whatsup](http://github.com/dustin/whatsup)机器人。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-23T08:32:31.110

我已经使用该`xmpppy`库编写了一个简单的 Jabber 机器人（以及 Google 谈话机器人），效果很好。[xmpppy](http://xmpppy.sourceforge.net/)上的示例应该可以帮助您入门（特别是[`bot.py`](http://xmpppy.sourceforge.net/examples/bot.py)）

至于在 twisted.Words 中实际实现的东西：

[这](http://yoan.dosimple.ch/blog/2007/01/30/)是一个关于创建一个机器人的简单教程，该机器人将收到的每条消息都打印到本地终端（以及一个回复收到消息的尊敬的版本）。要跟踪各种帐户的在线时间，您可以为“状态”添加回调（在 Jabber 术语中，在线/离线/离开等是“状态变化”）

对于更完整的系统，[pownce-jabber-bot](http://code.google.com/p/pownce-jabber-bot/)使用 twisted.words 和 [wokkel](http://wokkel.ik.nu/)作为 jabber 界面。

[powncebot/__init__.py](http://code.google.com/p/pownce-jabber-bot/source/browse/trunk/powncebot/__init__.py?spec=svn15&r=15)文件似乎是一个很好的起点——它看起来很简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T08:24:24.153

不久前，我正在寻找在 python 中构建 XMPP 客户端。我还没有开始从事我正在寻找的项目。我没有看到任何使用扭曲的东西，但我发现了几个 XMPP 库。

*   [https://launchpad.net/python-xmpp/](https://launchpad.net/python-xmpp/)
*   [http://xmpppy.sourceforge.net/](http://xmpppy.sourceforge.net/)
*   [http://pyxmpp.jajcus.net/](http://pyxmpp.jajcus.net/)

我还发现了一个基于 GPL 的 python 程序，它使用 XMPP 执行多点会议系统。

[http://coders.meta.net.nz/~perry/jabber/confbot.php](http://coders.meta.net.nz/~perry/jabber/confbot.php)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-10-23T07:44:46.120

由于 Twisted 库似乎已经过时，您有两个选择：实现您自己的 XMPP 处理程序或寻找另一个库。

我建议使用原始 XML；XMPP 并不复杂，你一定会学到一些东西。

# python - 求解最小值的不等式

> ID：227282
> 
> 赞同：3
> 
> 时间：2008-10-22T19:48:55.847
> 
> 标签：python, language-agnostic, equation, linear-programming, inequality

我正在研究一个归结为一组方程和不等式的编程问题：

```
x[0]*a[0] + x[1]*a[1] + ... x[n]*a[n] >= D
x[0]*b[0] + x[1]*b[1] + ... x[n]*b[n] =  C 
```

我想解决 的值`X`将给出 的绝对最小值`C`，给定输入`D`和列表，`A`并且`B`由`a[0 - n]`和组成`b[0 - n ]`。

我目前正在用 Python 解决这个问题，但一般来说问题是与语言无关的。

澄清更新：系数`x[0 - n]`仅限于非负整数集。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-22T19:59:29.227

这看起来像一个[线性规划](http://en.wikipedia.org/wiki/Linear_programming)问题。[Simplex 算法](http://en.wikipedia.org/wiki/Simplex_algorithm)通常会给出很好的结果。它基本上走在由不等式界定的子空间的边界上，寻找最优值。

直观地想一想：每个不等式都表示一个半空间，一个 n 维空间中的平面，你必须在它的右侧。您的效用函数就是您要优化的功能。如果空间是封闭的，则最优值将位于封闭空间的顶点之一；如果它是开放的，那么最优值可能是无限的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T21:28:01.577

查看有关线性规划的[维基百科](http://en.wikipedia.org/wiki/Integer_programming#Integer_unknowns)条目。整数编程部分是您要搜索的内容（x[i] 是整数的约束并不容易）。

在 python 库中搜索 branch&bound、branch&cut 等（我认为它们尚未在 scipy 中实现）。

其他有趣的链接：

*   [GNU 线性规划工具包](http://www.gnu.org/software/glpk/)
*   [IBM 关于 GLPK 的文章](http://www-128.ibm.com/developerworks/linux/library/l-glpk1/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T19:56:32.320

看起来这是一个[线性规划](http://en.wikipedia.org/wiki/Linear_programming)问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T20:07:37.433

您可能想使用 Matlab 或 Mathematica 或查看来自[Numerical Recipes in C](http://www.nrbook.com/a/bookcpdf.php)的代码，以获得有关如何实现最小化函数的想法。提供的链接是本书 1992 年的版本。较新的版本可在亚马逊获得。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T20:33:19.987

这[家公司](http://www.lindo.com/)有一个工具来做这种事情。

# networking - Linux 和 IGMPv3 上的多播加入

> ID：227286
> 
> 赞同：10
> 
> 时间：2008-10-22T19:50:42.193
> 
> 标签：networking, multicast, igmp

我们遇到了一个棘手的问题。我们正在编写一个接收多播 UDP 流量的 C++ 程序。我们正在将我们的应用程序移至不同的网络环境，我们的运营团队已要求我们支持来自我们的应用程序的 IGMPv3 成员资格公告。初步调查表明 Linux 2.6 内核确实支持 IGMPv3。因此，我很困惑，当我们运行 tcpdump 时，我们会看到以下输出跟踪：

```
[rtv@myhost]$ sudo /usr/sbin/tcpdump -i eth1.22 igmp
tcpdump: listening on eth1.22
00:20:09.007094 switch-a.stage > ALL-SYSTEMS.MCAST.NET: igmp query v2 [max resp time 20] [ttl 1]
00:20:09.241946 10.129.22.236 > 232.0.1.10: igmp v2 report 232.0.1.10 (DF) [tos 0xc0]  [ttl 1]
00:20:10.472159 10.129.22.236 > 236.0.1.101: igmp v2 report 236.0.1.101 (DF) [tos 0xc0]  [ttl 1]

44 packets received by filter 
```

我的理解是，可以通过在文件 /proc/sys/net/ipv4/conf/eth1.22/force_igmp_version 中指定一个非零值来强制内核使用较低版本的 IGMP；但是，我已经确认该文件具有零值配置。

我们的应用程序使用以下代码加入多播组：

```
... joinMulticast(in_addr mcast_addr, in_addr interface_addr)
{
  struct ip_mreq  mcast_req;

  mcast_req.imr_multiaddr.s_addr = mcast_addr;
  mcast_req.imr_interface.s_addr = interface_addr;
  int err = setsockopt(fFileDesc, IPPROTO_IP, IP_ADD_MEMBERSHIP,
    (char*)&theMulti, sizeof(theMulti));
  // handle errors etc.
  // ...
} 
```

我们需要在源程序中包含一些额外的东西来强制 IGMPv3 吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-23T00:02:06.663

有几点需要注意。

第一个是（据我了解）将其设置`/proc/sys/net/ipv4/conf/eth1.22/force_igmp_version`为 0 并不意味着“使用 v3”，而是实际上将其设置为“自动”。我相信您可以将其设置为 3 以强制它使用 igmp v3。

但是，要注意的另一件事是 igmp 堆栈的行为由它所处的环境决定。如果您的 linux 机器从上游 igmp 路由器接收 igmp v2 成员资格查询，那么我相信默认linux 行为（由 igmp v3 rfc 规定）仅使用 igmp v2 进行报告。

据我了解，当您设置`/proc/sys/net/ipv4/conf/eth1.22/force_igmp_version`为 0 时，它会使用此行为。

# java - 我可以使用正则表达式在 java 中的类上查找方法吗？

> ID：227287
> 
> 赞同：2
> 
> 时间：2008-10-22T19:51:29.383
> 
> 标签：java, reflection

我知道如何使用固定字符串在 java 中查找方法，

```
someClass.getMethod("foobar", argTypes); 
```

但是有没有办法使用正则表达式而不是固定字符串来查找给定类的方法？

如果我想找到一个名为“foobar”或“fooBar”的方法，则可能是一个使用示例。使用像“foo[Bb]ar”这样的正则表达式将匹配这些方法名称中的任何一个。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T19:54:59.923

[您应该在getDeclaredMethods](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Class.html#getDeclaredMethods()) () 反射方法（或 GetMethods() 如果您只想要公共方法）上应用您的正则表达式。

[警告：如果有安全管理器，这两种方法都会抛出 SecurityException。]

您将它应用于 getDeclaredMethod() 返回的每个方法的每个名称，并且只在集合中记住兼容的方法。

就像是！

```
try
{
  final Pattern aMethodNamePattern = Pattern.compile("foo[Bb]ar");
  final List<Method> someMethods = aClass.getDeclaredMethods();
  final List<Method> someCompliantMethods = new ArrayList<Method>();
  for(final Method aMethod: someMethods)
  {
    final String aMethodName = aMethod.getName();
    final Matcher aMethodNameMatcher = aMethodNamePattern.getMatcher(aMethodName);
    if(aMethodNameMatcher.matches() == true)
    {
       someCompliantMethods.add(aMethod);
    }
}
catch(...) // catch all exceptions like SecurityException, IllegalAccessException, ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T20:03:47.470

不是直接的。您可以遍历所有方法并检查每个方法。

```
Pattern p = Pattern.compile("foo[Bb]ar");
for(Method m : someClass.getMethods()) {
  if(p.matcher(m.getName()).matches()) {
    return m; 
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:14:57.933

您可以通过迭代类上的所有方法并以这种方式匹配它们来做到这一点。

没那么简单，但它会做的伎俩

```
 ArrayList<Method> matches = new ArrayList<Method>();
    for(Method meth : String.class.getMethods()) {
        if (meth.getName().matches("lengt.")){
            matches.add(meth);
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T20:07:27.277

不，你不能这样做，但你可以得到一个类的方法列表，并将正则表达式应用于它们。

```
Method[] getMethods( String regexp, Class clazz, Object ... argTypes ){
    List<Method> toReturn = new ArrayList<Method>();
    for( Method m : clazz.getDeclaredMethods() ){ 
         if( m.getName().matches( regExp ) ) { // validate argTypes aswell here...
             toReturn.add( m );
         }
    }
    return toReturn.toArray(); 
} 
```

嗯，类似的东西......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-16T09:29:48.983

当我想寻找一些使用简单名称模式的方法时，我使用这个[org.reflections](https://github.com/ronmamo/reflections)

例如，寻找一些公开的方法，名称以 get 开头：

```
Set<Method> getters = ReflectionUtils.getAllMethods(SomeClass.class, ReflectionUtils.withModifier(Modifier.PUBLIC), ReflectionUtils.withPrefix("get")); 
```

# javascript - 如何使用 YUI Compressor 自动压缩 JavaScript 文件？

> ID：227288
> 
> 赞同：13
> 
> 时间：2008-10-22T19:51:35.640
> 
> 标签：javascript, batch-file, yui

[YUI Compressor](http://developer.yahoo.com/yui/compressor/)不接受通配符参数，所以我不能这样运行它：

```
C:>java -jar yuicompressor.jar *.js 
```

但我有超过 500 个文件，不想像这样创建批处理文件：

```
C:>java -jar yuicompressor.jar file1.js -o deploy\file1.js
C:>java -jar yuicompressor.jar file2.js -o deploy\file2.js
...
C:>java -jar yuicompressor.jar file500.js -o deploy\file500.js 
```

当然，我的文件名*也不*是统一的。

有没有办法在不编写任何代码的情况下自动执行此操作？:)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-22T20:05:49.197

我可能会选择一个makefile（我认为它可能更易于长期维护），但如果你想要一个快速n脏的Windows批处理命令，如下所示应该可以工作：

```
for %%a in (*.js) do @java -jar yuicompressor.jar "%%a" -o "deploy\%%a" 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T20:53:49.210

如果你是面向 Java 的，你也可以使用 Ant 进行转换。我找到了一篇关于[YUI Compressor 的 Ant Taks的](http://www.ubik-ingenierie.com/ubikwiki/index.php?title=Minifying_JS/CSS)[博客文章](http://blog.gomilko.com/2007/11/29/yui-compression-tool-as-ant-task/)。免责声明：从未尝试过 - 抱歉

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-04-14T08:22:35.227

YUI 压缩器现在支持通配符，从 2.4.4 版本开始。[您可以在此处](http://yuilibrary.com/download/yuicompressor/)或从[YUI Git Hub](https://github.com/yui/yuicompressor)获取最新版本。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-22T20:16:14.233

我应该提到，使用 GNU Make，我有以下规则：

```
%-min.js: %.js
    ${java} -jar ${compressor} $< -o ${<:.js=-min.js} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-22T20:14:03.783

对于 unix 或 cygwin，您可以使用 xargs 或类似的东西：

ls -1 *.js | awk '{printf("java -jar yuicompressor.jar %s -o deploy/%s",$1,$1)}'

当您对命令行执行它感到满意时，将其通过管道传输到 /bin/sh。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T20:10:42.480

您需要使用某种脚本来获取所有 .js 文件的列表，然后在所有文件上运行 YUI Compressor。在 windows 命令提示符下，这样的事情应该可以工作：

```
FOR %f IN (*.js) DO java -jar yuicompressor.jar %f -o deploy\%f 
```

# search - 如何找到成千上万的公司名称？

> ID：227303
> 
> 赞同：19
> 
> 时间：2008-10-22T19:55:39.500
> 
> 标签：search, testing, sample-data

如何查找或生成数千个公司名称以用于测试和演示目的？（地址、电话号码和相关信息也很好。）

我正在构建一个包含业务联系信息的系统。毫无疑问，相当普遍。

我的测试/演示数据库目前已随机生成加载个人姓名（感谢我找到的方便的 IRS 电子表格）。这对于内部测试和审查目的非常有效，但在向潜在客户展示时看起来真的很奇怪。

我尝试了各种在线公共信息源（例如 EDGAR 和基于县的财产记录搜索），但这些都需要我一次手动将结果拼接到 50 个左右的名称块中。我可以做到这一点，但我真的希望有一个搜索服务或数据存储，这些信息可以很容易地在非常大的批次中搜索和检索。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-22T20:03:07.380

我使用[假名生成器](http://www.fakenamegenerator.com/faq.php)：

> ### 我可以使用假名生成器身份做什么？
> 
> 数以千计的个人、公司和政府组织发现了与假名生成器有关的有用和创造性的东西。这里有一些例子：
> 
> *   很难获得高质量的测试数据，尤其是在法律（例如 HIPAA）禁止使用真实数据的情况下。阅读更多关于[使用真实数据进行测试的危险](http://career-resources.dice.com/job-technology/dangers_testing_real_data.shtml)。
> *   许多网站，例如留言板，设计不佳，使外国访问者难以注册帐户。使用虚假信息，您可以轻松填写​​注册表单并登录网站。
> *   填写表格时使用虚假信息，以避免泄露个人信息。
> *   生成虚假身份以在互联网上用作您的假名。这使您可以将现实生活和互联网生活分开。
> *   获取用于书籍或故事中角色的名称的想法。
> *   生成的信用卡可用于测试基本的客户端/服务器端验证技术，而不会意外处理真实卡。
> *   生成的国家身份号码可用于测试基本的客户端/服务器端验证技术，而不会有泄露真实信息的风险......

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-05-31T15:07:30.007

一个非常好的生成器是：[generateata](http://www.generatedata.com/#generator)。

它**非常可定制**：您可以从指定列表中生成名称、街道、电话号码、随机条目。

您可以以不同的格式**导出生成的数据，例如：** **SQL**、**HTML**、**Excel**、**XML**和**CSV**。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-22T20:08:40.567

[您可以从维基百科](http://en.wikipedia.org/w/index.php?title=Special%3ASearch&search=list+of+companies&ns0=1&fulltext=Search)之类的公共资源中获取名称，或者您可以从您选择的字典（/usr/share/dict/words 等）中随机获取（当然是非冒犯性的）名词并附加“公司”， “公司”，“有限公司”随机。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-22T20:09:53.370

我个人强烈建议不要使用任何形式的实际数据来测试/演示应用程序。

当使用真实的电子邮件地址并且电子邮件意外地发送给各种客户时，我不得不进入太多次并捡起碎片。

我会使用类似 RedGate 的工具来添加数据，使其成为虚拟数据，真实数据风险太大，至少在我看来。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-22T21:15:02.087

我建议使用一个“随机字符”生成器，将“公司名称”“公司类型”等串在一起。这将最大限度地减少实际显示真实公司名称的机会。

另外，查看 Ipsum Lorum 生成器；他们可能有一些提示。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T20:11:47.050

如果您只是想生成名称，我会使用上述两个选项之一。如果您正在寻找更复杂的数据，Redgate 制作了一个 SQL 数据生成器。我从来没有使用过这个程序，我只是知道它的存在。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-04-17T19:09:53.163

Faker 是一个以编程方式生成假名（公司和个人）的好工具。在 Python、Ruby 和 Perl 中基本上可以找到相同的实现。我不确定它的起源，但如果您对这些编程语言中的任何一种感到满意，绝对值得一试。它还可以从英语以外的语言生成假名。

链接：

*   [PyFaker](https://github.com/hayd/pyfaker)
*   [鲁比的伪装者](http://faker.rubyforge.org/)
*   Perl 的[数据::Faker](http://search.cpan.org/~jasonk/Data-Faker-0.07/lib/Data/Faker.pm)

这是 PyFaker 的自述文件的摘录，只是为了让您了解一下：

```
In [1]: from pyfaker import Fake

In [2]: fake = Fake(lang_code='en')

In [3]: fake.Address.street_address()
Out[3]: u'72449 Ward Shore'

In [4]: fake.Address.street_address()
Out[4]: u'7954 Waelchi Mall'

In [5]: fake.Company.bs()
Out[5]: u'whiteboard visionary markets'

In [6]: fake.Company.bs()
Out[6]: u'exploit innovative paradigms'

In [7]: fake.Name.name()
Out[7]: u'Aaliyah Bauch'

In [8]: fake.Name.name()
Out[8]: u"Chad O'Keefe" 
```

# iphone - 如何在 iPhone 视图中创建模糊文本？

> ID：227305
> 
> 赞同：7
> 
> 时间：2008-10-22T19:56:17.423
> 
> 标签：iphone, objective-c, cocoa-touch, graphics, uikit

我正在建立一个包含各种文本和图像元素的视图。

我想在视图中显示一些文本，并在其后面显示文本的模糊副本，而不仅仅是文本阴影。

如何将高斯模糊文本应用到 UIImage 或图层？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-08-10T18:39:38.570

查看 Apple 的 GLImageProcessing iPhone 示例。除其他外，它会进行一些模糊处理。

相关代码包括：

```
static void blur(V2fT2f *quad, float t) // t = 1
{
    GLint tex;
    V2fT2f tmpquad[4];
    float offw = t / Input.wide;
    float offh = t / Input.high;
    int i;

    glGetIntegerv(GL_TEXTURE_BINDING_2D, &tex);

    // Three pass small blur, using rotated pattern to sample 17 texels:
    //
    // .\/.. 
    // ./\\/ 
    // \/X/\   rotated samples filter across texel corners
    // /\\/. 
    // ../\. 

    // Pass one: center nearest sample
    glVertexPointer  (2, GL_FLOAT, sizeof(V2fT2f), &quad[0].x);
    glTexCoordPointer(2, GL_FLOAT, sizeof(V2fT2f), &quad[0].s);
    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
    glColor4f(1.0/5, 1.0/5, 1.0/5, 1.0);
    validateTexEnv();
    glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);

    // Pass two: accumulate two rotated linear samples
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
    glEnable(GL_BLEND);
    glBlendFunc(GL_SRC_ALPHA, GL_ONE);
    for (i = 0; i < 4; i++)
    {
        tmpquad[i].x = quad[i].s + 1.5 * offw;
        tmpquad[i].y = quad[i].t + 0.5 * offh;
        tmpquad[i].s = quad[i].s - 1.5 * offw;
        tmpquad[i].t = quad[i].t - 0.5 * offh;
    }
    glTexCoordPointer(2, GL_FLOAT, sizeof(V2fT2f), &tmpquad[0].x);
    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
    glActiveTexture(GL_TEXTURE1);
    glEnable(GL_TEXTURE_2D);
    glClientActiveTexture(GL_TEXTURE1);
    glTexCoordPointer(2, GL_FLOAT, sizeof(V2fT2f), &tmpquad[0].s);
    glEnableClientState(GL_TEXTURE_COORD_ARRAY);
    glBindTexture(GL_TEXTURE_2D, tex);
    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_COMBINE);
    glTexEnvi(GL_TEXTURE_ENV, GL_COMBINE_RGB,      GL_INTERPOLATE);
    glTexEnvi(GL_TEXTURE_ENV, GL_SRC0_RGB,         GL_TEXTURE);
    glTexEnvi(GL_TEXTURE_ENV, GL_SRC1_RGB,         GL_PREVIOUS);
    glTexEnvi(GL_TEXTURE_ENV, GL_SRC2_RGB,         GL_PRIMARY_COLOR);
    glTexEnvi(GL_TEXTURE_ENV, GL_OPERAND2_RGB,     GL_SRC_COLOR);
    glTexEnvi(GL_TEXTURE_ENV, GL_COMBINE_ALPHA,    GL_REPLACE);
    glTexEnvi(GL_TEXTURE_ENV, GL_SRC0_ALPHA,       GL_PRIMARY_COLOR);

    glColor4f(0.5, 0.5, 0.5, 2.0/5);
    validateTexEnv();
    glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);

    // Pass three: accumulate two rotated linear samples
    for (i = 0; i < 4; i++)
    {
        tmpquad[i].x = quad[i].s - 0.5 * offw;
        tmpquad[i].y = quad[i].t + 1.5 * offh;
        tmpquad[i].s = quad[i].s + 0.5 * offw;
        tmpquad[i].t = quad[i].t - 1.5 * offh;
    }
    glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);

    // Restore state
    glDisableClientState(GL_TEXTURE_COORD_ARRAY);
    glClientActiveTexture(GL_TEXTURE0);
    glBindTexture(GL_TEXTURE_2D, Half.texID);
    glDisable(GL_TEXTURE_2D);
    glTexEnvi(GL_TEXTURE_ENV, GL_OPERAND2_RGB,     GL_SRC_ALPHA);
    glActiveTexture(GL_TEXTURE0);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
    glDisable(GL_BLEND);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T17:36:17.127

iPhone OS 不提供我所知道的任何核心图像过滤器 - 否则，是的，过滤的 CALayer 将是正确的方法。如果 NSBitmapImageRep 可用，您可以通过将文本绘制到它来进行原始模糊，缩小图像（下采样），然后再次放大图像（上采样） - 不幸的是它似乎也丢失了。我已经看到在 Flash 中完成了模糊文本，它（最后我检查过）没有像素级过滤；您可以尝试寻找有关该内容的教程，并查看您可以适应 Cocoa Touch 的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T01:22:46.080

在桌面上，毫无疑问，您会使用 CoreImage 来执行此操作。

不过，在电话上，我认为没有办法使用 CoreGraphics 来做到这一点。如果它是绝对关键的，OpenGLES 可能会提供帮助。

但是，我建议重新考虑您的界面。我认为模糊的文字会分散注意力。

编辑：mledford 在评论中指出您可以使用 CoreAnimation。我不知道手机上的CA是否像桌面一样包含模糊半径，但你可以试试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T21:23:34.800

如果您使用 Alpha 层，您将受到性能影响。如果可能的话，考虑一种不同的方法（甚至可以预先合成文本并将其展平为图形而不是多层）。

尝试一下，并使用 Instruments 来检查性能，看看它是否可以接受。如果您在滚动视图中执行此操作，您的滚动将陷入*困境*。

# javascript - 使用 Prototype 或 jQuery 实现 .lastChild 的最佳方式

> ID：227312
> 
> 赞同：6
> 
> 时间：2008-10-22T19:57:56.280
> 
> 标签：javascript, jquery, prototypejs

目前我们使用原型和 jQuery 作为我们的 js 框架。现在，jQuery 设置为 $j() 以防止原型冲突。

过去，我们使用了很多原型的 Element.down()、Element.next() 和 Element.previous() 来遍历 DOM。但是，我需要一种简单的方法来检索最后一个子元素。我知道我可以使用 Element.childElements() 循环遍历一个数组，但我想要一些内联的东西，它可以清晰地读取并且可以流水线化。

只是想我会在重新发明轮子之前问一下。这是一段需要替换的包含 lastChild 的代码片段：

```
_find : function(rows, address) {
        var obj = null;
        for (var i=0; i < rows.length && obj == null; i++) {
            if (rows[i].down().className == 'b')
                obj = this._find(rows[i].lastChild.down().down().childElements(), address);
            else if (rows[i].lastChild.getAttribute('tabAddress') == address)
                return rows[i].lastChild;
        }
        return obj;
    } 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-23T04:35:25.627

伙计们，请注意选择器函数返回元素数组（不是单个元素），因此您必须通过索引添加结果数组中的元素：[0]。

原型中的代码

```
//if you only have the id of the parent
var lastChild = $$("#parent :last-child")[0]; 
//or
//if you have the actual DOM element
var lastChild = $(element).select(":last-child")[0]; 
```

jQuery中的代码

```
//if you only have the id of the parent
var lastChild = $("#parent :last-child")[0]; 
//or
//if you have the actual DOM element
var lastChild = $(":last-child", element)[0]; 
```

普通的 javascript 代码

```
var element = document.getElementById("parent");
var lastChild = element.childNodes[element.childNodes.length - 1]; 
```

另请注意，如果父元素没有子节点，这些可能会返回 null。

*   [关于 CSS :last-child 选择器的一些信息](http://www.quirksmode.org/css/firstchild.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T20:00:33.687

试试这个，它在 jQuery 中一直对我有用

```
var lastChild = $("#parent :last-child"); 
```

[http://docs.jquery.com/Selectors/lastChild](http://docs.jquery.com/Selectors/lastChild)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:06:42.347

使用 Prototype，您可以使用支持大多数 CSS3 语法的[$$实用函数：](http://www.prototypejs.org/api/utility/dollar-dollar)

```
var lastChild = $$(".b:last-child")[0]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-27T18:13:25.377

万一有人在网上搜索以回答他们的问题时发现此问题，您可以使用 Prototype 执行以下操作：

```
Element.childElements().last(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-06-06T19:11:39.693

对于仍然使用 Prototype 的其他人的参考，您可以添加自定义元素方法：

`Element.addMethods({ ... });`

我添加了这两个：

```
first: function(element) {
    element = $(element);
    return element.childElements()[0];      
},
last: function(element) {
    element = $(element);
    var i = element.childElements().size() - 1;
    return element.childElements()[i];
}

var first = $('foo').first();
var last = $('foo').last(); 
```

该`Element.first()`方法有点多余，我在链接时将其用于看起来更清晰的代码。

确保`reutrn element`启用链接。

# python - 用 Python 学习 CGI 编程的好资源是什么？

> ID：227318
> 
> 赞同：5
> 
> 时间：2008-10-22T19:59:19.057
> 
> 标签：python, cgi

我需要为嵌入在单板计算机上的应用程序编写一个浏览器界面（任何有兴趣的人都可以使用[Gumstix Verdex](http://www.gumstix.com/store/catalog/product_info.php?products_id=178)），因此由于空间和处理器限制（以及环境的可用性），我将无法使用任何 Web 框架我跑进去）。我仅限于核心 Python 和 cgi 模块来创建将与 C++ 应用程序通信的页面。

任何人都可以推荐一个好的资源（网络或书籍形式，但书籍是首选）在 Python 中学习 CGI 编程？

我需要应用程序做的事情相当简单。我有一个在同一设备上运行的 C++ 程序，我需要创建一个基于浏览器的用户界面，以便可以更改该应用程序的配置设置。UI 需要与 C++ 应用程序通信，最终数据验证将在其中完成。可以使用 Javascript 在 UI 上进行初步验证，然后使用 Python 在服务器上再次进行验证，但最终验证必须在应用程序本身中完成，因为无论如何它都是从文件中获取其初始配置。配置数据采用所有形式（布尔值、整数、浮点数和字符串）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T20:07:43.733

CGI 编程的最大资源之一是[CGI 主页](https://web.archive.org/web/20090413024447/http://hoohoo.ncsa.uiuc.edu/cgi/)。一旦你完成了这些，熟悉[cgi](https://docs.python.org/library/cgi.html)和[cgitb](https://docs.python.org/library/cgitb.html)模块应该是你的下一个任务。

但不要忽视学习[WSGI](http://wsgi.org/) [(libref)](https://docs.python.org/library/wsgiref.html)和使用 CGI-to-WSGI 适配器，例如[flup](http://www.saddi.com/software/flup/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T23:01:27.597

我不明白你为什么坚持使用 CGI，因为这是一个通用网关接口，旨在与像 apache 这样的网络服务器一起使用，而你在该设备上肯定没有。

我建议你使用[wsgiref.simple_server](http://docs.python.org/library/wsgiref.html#module-wsgiref.simple_server)这是一个单线程的内置网络服务器，随 python 2.5 及更高版本一起提供（如果你有 2.4 或更低版本，你可以[从 pypi d/l wsgiref](http://pypi.python.org/pypi/wsgiref/0.1.2)，它是一个纯 python 包）。这样，您还可以避开杂乱的 CGI 编程并编写[wsgi](http://wsgi.org/wsgi/)应用程序：

```
from wsgiref.simple_server import make_server

def application(environ, start_response):
    start_response('200 OK', [
        ('Content-Type', 'text/plain'),
    ])
    return ['Hello World!']

httpd = make_server('', 8000, application)
httpd.serve_forever() 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:14:25.577

*   [http://www.cs.virginia.edu/~lab2q/](http://www.cs.virginia.edu/~lab2q/)
*   [http://www.devshed.com/c/a/Python/Writing-CGI-Programs-in-Python/](http://www.devshed.com/c/a/Python/Writing-CGI-Programs-in-Python/)
*   [http://gnosis.cx/publish/programming/feature_5min_python.html](http://gnosis.cx/publish/programming/feature_5min_python.html)

都是通过google找到的...

并看看 pyblosxom：[http://pyblosxom.svn.sourceforge.net/viewvc/pyblosxom/](http://pyblosxom.svn.sourceforge.net/viewvc/pyblosxom/)这是一个用 python 编写的博客系统，使用 CGI。

# labview - LabVIEW“驱动程序” - 入门

> ID：227329
> 
> 赞同：8
> 
> 时间：2008-10-22T20:01:44.667
> 
> 标签：labview

我编写了一个独立的应用程序，通过 RS-232 端口控制设备，一些客户希望能够将设备与 LabVIEW 一起使用。我已经看到一些线程描述了学习使用 LabVIEW 时从哪里开始，但我想知道是否有人有为 LabVIEW 编写插件/驱动程序（这是正确的词吗？）的经验，也许会为我指明正确的方向。

现有的应用程序是 GUI，它允许人们使用更高级别的概念来控制设备 - 而不必知道串行端口通信的语法和协议。我也想把它抽象出来，以便用户可以将一些东西插入LabVIEW，我想它公开了一些允许操作设备并向客户端提供数据的动词和方法。

我认为 LabVIEW 有一个串行端口接口，但我确信使用此设备的人不想编写代码（解析器等）来与设备通信。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-27T16:03:20.193

[如果您准备花一点时间学习如何在 LabVIEW 中编程，可以在此处](http://www.ni.com/devzone/idnet/development.htm)和[此处](http://zone.ni.com/devzone/cda/tut/p/id/3271)找到有关如何开发仪器驱动程序的相关信息 。

本质上，您应该提供一组 VI（LabVIEW 代码单元）来实现您的设备支持的各种操作。LabVIEW 程序员将使用您的 VI 应提供的 VISA 资源（即串行端口）和错误输入/输出终端将这些序列链接在一​​起。有关示例，请参见第二个链接。

如果您不想学习如何正确地执行此操作（您的第二篇文章建议您不要这样做），请创建一个公开必要功能的 DLL，或委托 LabVIEW 程序员为您编写驱动程序。如果您可以提供足够的协议文档并且它不是非常复杂，那么应该花一个下午的时间。如果您有热衷于 LabVIEW 的用户，那么他们中的某个人可能会很乐意为您完成这项工作并获得适当的折扣或奖励 - 对于任何有 LabVIEW 能力的人来说，这样做真的不难，而且他们已经掌握了他们的手在您的设备上并了解它的作用。您可能想先与其他 LabVIEW 用户一起对结果进行 Beta 测试，因为您无法评估他们自己所做工作的质量。

如果你走 DLL 路线，你需要检查你需要的参数是否与 LabVIEW 数据类型兼容。我不是 C/C++ 程序员，所以我无法详细告诉您这意味着什么，但这[可能](http://lavag.org/topic/10902-whitepaper-on-how-to-write-a-labview-compatible-dll/)会有所帮助（Rolf Kalbermatter 是 LabVIEW 与外部代码接口方面的专家）。

如果您想找一位 LabVIEW 程序员，那么 National Instruments 可以通过他们的联盟计划为您推荐一位。

（编辑添加了关于为 LabVIEW 编写 DLL 的 LAVA 论坛帖子的链接）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T20:27:11.107

您尝试执行的操作有两种选择。

*   创建设备用户可以[从 LabVIEW 调用](http://digital.ni.com/public.nsf/allkb/DCB90714981A1F148625731E00797C33)的 DLL 。

*   在 LabVIEW 中重写您的应用程序。

为了吸引尽可能多的潜在客户，选项 #1 将是您的最佳解决方案。如果您的客户特别要求 LabVIEW 驱动程序，那么选项 #2 可能是该特定客户最省事的。这样做的原因是 LabVIEW 在很大程度上是一种小众语言（用于自动化和数据采集），对于许多 LabVIEW 开发人员来说，它是他们唯一知道的语言（或者他们唯一熟悉的语言）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T19:42:54.173

LabVIEW 可以轻松处理 RS232 通信——您只需向客户提供设备使用的命令和语法列表，或许还需要一个小型框架或具有基本功能的示例 VI。

我为你想要提供一个不需要用户解析他们自己的命令的更强大的驱动程序而鼓掌；大多数供应商通常所说的LabVIEW“驱动程序”只不过是捆绑在一个简单的GUI中的几个命令（“init”、“read”）。

您不必重新构建完整的应用程序，只需给他们足够的资源让他们自己开始 =)

首先，您可能需要[在 LabVIEW 中使用 VISA](http://forums.ni.com/ni/board/message?board.id=170&message.id=340676&requireLogin=False)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T23:33:58.577

LabVIEW 程序员的最佳资源是[National Instruments 知识库](http://sine.ni.com/kb/)。由于 LabVIEW 仅在这么小的部分中流行，因此没有很多其他网络资源。

我在 LabVIEW 中编程时读过的一本书是[LabVIEW Power Programming](https://rads.stackoverflow.com/amzn/click/com/0079136664)。它有很多很好的示例代码，如果我没记错的话，它向您展示了如何使用用 C++ 编写的 3rd 方 DLL。但是，它绝对*没有*向您展示如何编写这些 DLL。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-12-02T17:05:58.147

您的客户希望在 LabVIEW 中使用您的代码。这并不意味着您必须编写 LabVIEW 代码。

LabVIEW 可以与 DLL 交互。这里的技巧是避免更复杂的数据结构。如果您继续按基本数据类型的值传递，您将没有问题。LabVIEW 也可以处理与 DLL 之间的数组。避免指向指针或指向结构的指针。

LabVIEW 还可以与 .NET 程序集交互。

也没有什么可以阻止您通过 TCP/IP 使用客户端/服务器模型。

# .net - 通过加密保护软件

> ID：227340
> 
> 赞同：12
> 
> 时间：2008-10-22T20:06:26.763
> 
> 标签：.net, protection

对于我们的软件，我们使用硬件加密狗来保护软件。没有任何保护措施是完美的，但这种商业解决方案是负担得起的，并且可以让诚实的人保持诚实（如另一个线程中所述）。优点是存储在硬件加密狗上“不可读”的 128 位密钥。

我们想移除这个硬件加密狗并开始使用软件保护。基本上我们可以使用商业产品，但另一方面也不是牢不可破的。我对加密知之甚少，这就是我发布此内容的原因。如何在 Windows 计算机上存储无法通过 Reflector 或其他方式读取的密钥？但是，我应该能够访问用于测试许可证代码的密钥。

我只想要一个简单的解决方案，不能通过简单地使用 Reflector 来破解。

还是我在问一个非常愚蠢的问题？

* * *

感谢大家非常快速和有用的回复。我不想通过 Internet 使用许可，因为应用程序并不总是在连接的计算机上运行。然后我可能会遇到更多问题然后解决它们。我们现在很可能会寻求商业解决方案。似乎保护并不是那么微不足道。

非常感谢！！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-22T20:12:10.573

没有办法完全保护密钥。如果它可以被您的程序读取，那么它可以被另一个程序读取。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-22T21:12:53.290

我经营着一家处理这个问题近 20 年的软件公司。作为开发人员和企业主，我想首先鼓励您稍微拓宽您的目标。例如，将您的问题定义为“防止盗版”就是一个错误。您的目标应该是最大化收入。

话虽如此，有些人根本不会购买您的软件，但他们可能会付出相当大的努力来免费获得它。他们获得免费副本并不“公平”，但投入大量资源来防止它在很大程度上是浪费时间。事实上，这些人最终往往只是为了进入我们的更新列表、获得支持或因为他们的业务发展到现在可以负担得起我们的许可证的程度而“合法化”。在这些情况下，原始盗版最终会增加我们的收入。

那么，我们如何授权？

我们会在每次新安装时生成一个*随机*许可证号（10K 到 99K 之间的数字很好）。然后我们有一个生成匹配数字的算法（任何不平凡的事情都会做）。顺便说一下，我们使用随机数，以便在另一台计算机上重新安装的任何尝试都会导致不同的许可证/匹配号。

接下来，我们要求用户*打电话给我们*以获取其许可证的匹配号码（这很重要）。该软件会查看他们输入的匹配数字，并将其与用户端生成的匹配值进行比较。如果匹配，则软件完全激活。

我说让他们给我们打电话很重要，因为我们利用这个机会与他们讨论他们的设置，回答任何问题，并让他们知道他们正在与真实的人打交道。很少有人有勇气尝试打电话和冒充另一家公司（我们查找他们并将他们的信息与我们的采购数据库进行比较）。请注意，我们的套餐运行近 2000 美元，因此电话是合理的。如果您的包裹成本较低且体积较大，您可以通过电子邮件执行此操作。最后，我们使用电话通知用户如何使用新许可证获得升级和技术支持。

最后，我们将密钥存储在应用程序的数据库（本地安装的 MSDE/SQL Express 数据库）中，这样任何复制应用程序的尝试都将 A）不重要，B）带来大量特定于组织的数据首先购买了合法版本（使他们不太可能分享）。许可密钥被加密并“拆分”成两个不同的密钥，保存在两个不同的表中。因此，简单的“找到密钥并在盗版中输入”是行不通的。

底线？当您使整个软件包不仅仅是软件，构建一些基本的保护机制并引入人为因素时，您应该看到您不需要加密狗的费用和麻烦来最大化收入。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-22T20:26:41.417

当然，绝对的答案是，一个坚定而有技巧的攻击者可以破坏任何保护，但是，特别是对于需求或名望不高的软件，有技巧和有决心的攻击者很少见，因此采取保护措施是有意义的。

要验证许可证，将密钥发送到中心位置是最安全的方法，因为他们必须破解您的服务器（或协议，小心）才能进行验证。这需要连接才能使用可能可行或不可行的软件。您还可以将“许可证服务器”与您的软件一起分发，以进行仅需要本地网络访问的大型安装。如果您不能并且必须仅在本地验证，您可以使用本机代码编写一个 dll，这会使逆向工程变得更加困难。

为了保护代码本身，并使其保护更难绕过，混淆：

*   [.NET 混淆工具/策略](https://stackoverflow.com/questions/2525/best-net-obfuscation-toolsstrategy)
*   [（为什么）我应该使用混淆？](https://stackoverflow.com/questions/31882/why-should-i-use-obfuscation)
*   [我应该担心混淆我的 .NET 代码吗？](https://stackoverflow.com/questions/12075/should-i-be-worried-about-obfuscating-my-net-code)
*   [对于单个开发人员来说，什么是最物有所值的 c# 代码保护](https://stackoverflow.com/questions/71146/whats-the-best-value-for-money-c-code-protection-for-a-single-developer)

总而言之，您可能会从打包的解决方案中获得更好的价值。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-02T17:51:39.920

我通过一个有趣的演示阅读了有关[Skype 如何](http://www.blackhat.com/presentations/bh-europe-06/bh-eu-06-biondi/bh-eu-06-biondi-up.pdf)通过加密来保护软件的任务。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-22T20:20:19.217

这就是为什么复制保护和“保持诚实用户诚实”是一场失败的战斗。你不需要让诚实的用户保持诚实，他们已经做到了。

如今，大多数有效的复制保护方案都围绕着对中央服务器进行偶尔的密钥检查。让应用程序每隔一段时间检查一下中央服务器的密钥，您就可以确定该软件是否获得了正确的许可。显然，我过度简化了很多事情，但这是一种方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T20:20:36.407

基本上，您将需要使用商业解决方案。这里的方法与加密狗不同，您不能期望简单地复制加密狗。

相反，主要的解决方案是使用某种密钥，该密钥部分是根据运行该软件的计算机的相关信息计算得出的。做同样事情的 Keygens 可以由饼干制造，但事实就是如此。他们本可以简单地修补您的软件而不寻找加密狗。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T20:24:32.280

我的建议是，如果它适合居住，请坚持使用加密狗。这些往往是最可行的方法。

如果这不是一个选项，那么一定要找外部供应商。除其他外，您将寻找一些关键功能（不是双关语）：

*   密钥的安全存储
*   许可证检查
*   编译时混淆（使您的应用程序更难反汇编）

这些都不是万无一失的。底线是开发者与盗版斗争已久，当盗版者足够坚定时，我们总是输。如果您的主要目标是让诚实的人保持诚实，那么一个体面的商业软件保护包可能会为您做到这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T20:19:59.233

虽然没有什么是完美的，但如果您想自己做，请查看[CryptProtectData API。](http://msdn.microsoft.com/en-us/library/aa380261(VS.85).aspx)

不过老实说，购买解决方案可能会让您不那么头痛。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-22T20:28:44.643

这些数据只是商业资料还是您与工人分享的东西等等？

如果是后者，也许您可​​以编写一个快速的 c++ 程序来异或它。基本上如果密钥长度等于文档的长度，它应该是“牢不可破的”。我在 C++ 中所做的是创建一个文档大小的随机字符缓冲区，然后对其进行异或，然后简单地单独发送文档和密钥文件，然后其他人将它们异或一起以取回文档。

不知道这是否会帮助你。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-22T20:31:41.737

如果您将密钥存储在用户本地计算机上，那么无论您多么努力地阻止这种情况，破解者都可以访问它。

为什么不远程存储复制保护代码的密钥或关键部分并远程处理呢？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-22T20:37:27.310

为密钥生成哈希（SHA1、MD5 等）并在应用程序中对哈希进行硬编码。将密钥分发给您的用户。在您的可执行文件中，可以根据硬编码的哈希值检查用户指定密钥的哈希值：

```
bool CheckKey(string keyFromUser) 
   return SHA1(key) == "ABC2983CF293892CD298392FG";
} 
```

这意味着任何可以从您的组织（或其他用户）获得密钥的人都可以运行该应用程序，实际上很难通过检查可执行文件来确定密钥。

这显然不是一个很强的保护。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-22T21:08:37.620

一般来说，可以破解非联网机器上的软件。如果您的应用程序不够小众，以至于盗版者可以出售它的破解副本，那么您将在那里看到这一点。我听说的一个显然成功的解决方案是自修改代码。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-22T21:12:33.417

您可以尝试 PC 游戏中常用的标准方法，例如：[SafeDisc](http://en.wikipedia.org/wiki/SafeDisc)、[StarForce](http://en.wikipedia.org/wiki/StarForce)、[SecuROM](http://en.wikipedia.org/wiki/SecuROM)或任何其他 [版权保护软件](http://en.wikipedia.org/wiki/Copy_protection)。这些系统是保护您的应用程序的最发达的软件系统之一。

尽管如此，经验告诉我们，没有唯一的软件保护系统是牢不可破的，黑客破解它们所花费的时间与受保护内容的价值成正比。无论使用了多么先进的保护系统来防止流行游戏的盗版副本，破解都在等待几个月。

您已经说过许可证服务器对您的系统来说是一个麻烦，但我不会立即放弃它。我认为至少在第一个程序运行时颁发许可证的许可证服务器（例如每次安装的解密密钥不同）是减少盗版的最佳威慑措施。不仅取决于加密方法的强度，而且主要是因为自动注册系统。如果您让您的客户知道每个安装/用户的软件激活密钥是唯一的，并且它被存储并与用户的配置文件相匹配，他们会三思而后行赠送密钥+软件。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-02T17:14:02.150

请让我为您的问题添加一些想法：

*   您的软件是否需要任何类型的互联网连接？
    *   如果答案是“是”，您可以监控使用情况。（一定要告诉客户这个功能！）
    *   如果答案是“否”，您仍然可以在大多数情况下监控使用情况，但您无法强制连接到您的服务器以使产品正常工作。
*   您想为您的软件添加复制保护吗？这不是反问，因为
    *   某些软件必须由软件公司或其合作伙伴定制。如果有人复制软件，必须由专家定制，它对他没有任何用处。
    *   例如，如果您的客户的员工想在家中将您的高端电路设计软件用于他的私人项目，并且您允许他这样做，那么您的客户站点会有人投票支持您的产品每个购买决定。
    *   保护工作拷贝的努力可能高于未经授权的拷贝所造成的损失。（请记住，您仍然可以在下一个版本中包含它。）

# abap - 通过 SUBMIT 执行程序，带有 GUI 抑制

> ID：227351
> 
> 赞同：6
> 
> 时间：2008-10-22T20:10:09.423
> 
> 标签：abap, bapi

我想将 SAP 程序（事务）的功能公开为 BAPI。我需要调用报告和供应范围过滤器，以便绕过 GUI。

有没有人有 SUBMIT ... WITH ... ABAP 构造的工作示例，或其他关于如何完成我需要做的事情的建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T21:26:47.257

这是一个工作示例：

```
SUBMIT SAPF140 
    TO SAP-SPOOL                         "optional"
    SPOOL PARAMETERS print_parameters    "optional"
    WITHOUT SPOOL DYNPRO                 "optional (hides the spool pop-up)"
    VIA JOB jobname NUMBER l_number      "optional"
    AND RETURN                           "optional - returns to the calling prog"
    WITH EVENT   =  REVENT
    WITH BUKRS   IN RBUKRS
    WITH BELNR   IN lRBELNR
    WITH GJAHR   IN RGJAHR
    WITH USNAM   =  SY-UNAME
    WITH DATUM   =  SAVE_DATUM
    WITH UZEIT   =  SAVE_UZEIT
    WITH DELDAYS =  RDELDAYS
    WITH KAUTO   =  'X'
    WITH RPDEST  =  SAVE_PDEST
    WITH TITLE   =  TITLE. 
```

所有“WITH”语句都与我使用的被调用程序上的选择字段相关=它是一个 PARAMETER 语句（单个字段），我在其中使用它是一个 SELECT_OPTIONS 语句（范围）

这是一个如何填充范围的简单示例：

```
REFRESH lrbelnr.
lrbelnr-sign = 'I'.
lrbelnr-option = 'EQ'.
lrbelnr-low = HBKORM-belnr.
CLEAR lrbelnr-high.
append lrbelnr. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-24T23:48:50.510

如果您想将此功能抑制为 BAPI，则必须将该功能包装在远程函数调用 (RFC) 模块中。只需实现一个 RFC 功能模块。根据报告的实现方式，它可能使用 ABAP 对象，也可以从您的 RFC 实现中调用。鉴于这种情况，您有一个很好的解决方案。每当调整报告时，您的 BAPI 也会反映这些更改。如果它是无法包装的 SAP 标准程序，请考虑将其复制到您的命名空间并进行调整。然而，这可能会带来一些麻烦，当 SAP 通过支持包堆栈执行更新时，您不会意识到这一点。这两种方法的输出是不同的。除此之外，如果你想从外部调用它，除了实现一个 RFC 模块之外别无他法。

提交报告不能返回外面的值。报告始终仅用于 GUI 功能，而不用于交换数据。如果您的报告使用选择选项，您必须以某种方式在 RFC 中“手动”实现此功能，因为此语句不能在 RFC 模块中使用。我通常会尝试重新编写报告，对其进行模块化并将选择信息放在一个中心类中，或者可以从报告和您的 BAPI 功能模块中调用另一个功能模块。您所说的过滤器不能在 RFC 中自动实现。您必须手动实现这些范围。无法抑制出现的警告，如果您从远程系统进行 RFC 调用，并且出现带有警告的弹出窗口，您将以 shortdump 结束。所以，

如果您只是想通过作业计划绕过它，请创建一个变体并使用该变体安排报告，但我想这不是您正在寻找的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-19T04:46:13.920

您可以使用内置[BAPI](http://www.comeletstalk.com)也只需编写“*范围*”并按 F4。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-25T10:18:25.740

您可以将报表包装在[BATCH INPUT 会话中](http://help.sap.com/saphelp_nwes72/helpdata/en/69/c250274ba111d189750000e8322d00/frameset.htm)并在函数中执行它。唯一的缺点是每次更改报告时都需要重写 BATCH INPUT。

# language-agnostic - DopeWars 代码库 - 主要计算在哪里进行？

> ID：227352
> 
> 赞同：0
> 
> 时间：2008-10-22T20:10:14.447
> 
> 标签：language-agnostic

不是真正的 ac/c++ 人，所以我希望有人可以指导我查看包含游戏主要计算的文件？

我对在跑步/站立/等事件中决定一个人是“赢”还是“输”（一般来说）时如何计算事情特别感兴趣。

换句话说，赢/输将基于许多因素：它们是什么？有哪些公式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T22:06:47.067

你没有引用源，所以我用谷歌搜索了 DopeWars 并找到了这个： [http ://dopewars.sourceforge.net/](http://dopewars.sourceforge.net)

查看源代码， serverside.h/c 似乎是您正在寻找的。但请记住，dopewars.c 中已经预定义了许多限制。看看这个结构中的药品价格：

```
struct DRUG DefaultDrug[] = {
  /* The names of the default drugs, and the messages displayed when they
   * are specially cheap or expensive */
  {N_("Acid"), 1000, 4400, TRUE, FALSE,
   N_("The market is flooded with cheap home-made acid!")},
  {N_("Cocaine"), 15000, 29000, FALSE, TRUE, ""},
} 
```

*注意：示例结构不完整。请查看来源以查看完整列表。*

验证玩家选择的动作的实际功能存在于 serverside.c 中。

由“服务器”（游戏引擎）来验证玩家的选择和要采取的下一步并将其传达回客户端。在这种情况下，客户端可以是 GUI 或 Curses（命令行）驱动的客户端。客户端负责更新屏幕，从服务器获取新的输入（无论是输入字符还是鼠标点击）。

# asp.net - 如何在包含来自当前页面的动态信息的母版页中创建链接？

> ID：227357
> 
> 赞同：1
> 
> 时间：2008-10-22T20:11:06.053
> 
> 标签：asp.net

我有一个母版页，顶部菜单中有一个帮助链接。此链接应包含当前页面的动态书签，以便用户滚动到他当前看到的页面的帮助。

```
<a href="help.aspx#[NameOfCurentPage]">Help</a> 
```

你将如何实现这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T20:24:42.140

您可以做的另一件事是通过内容页面本身引用母版页。

为了让我自己更轻松，我在母版页本身中创建了一个可公开访问的方法：

```
Public Sub SetNavigationPage(ByVal LinkName As String)
   DirectCast(Me.FindControl(MenuName), HyperLink).NavigateUrl = "help.aspx#" & LinkName
End Sub 
```

然后在内容页面中，我通过以下方式获得对母版页的引用...

```
Dim myMaster As MasterPageClass = DirectCast(Me.Master, MasterPageClass)
myMaster.SetNavigationPage("CurrentPage") 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T20:15:46.667

我已经三个多月没有写过一行c#了，但是你可以在母版页（OnLoad）中连接一个事件并从那里设置链接。查看作为您的主页的 ContentPlaceholder 中的内容并获取其类型或名称，然后将其应用于链接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:19:46.597

我会使用“ [Request.PhysicalPath](http://msdn.microsoft.com/en-us/library/system.web.httprequest.physicalpath.aspx) ”来获取所请求的物理路径，然后在您的帮助 HMTL 中，您可以通过它们所在的页面来表示这些部分。

您可能会使用：

```
Path.GetFileName(Request.PhysicalPath).ToUpper() 
```

规范化数据。使用 PhysicalPath 将允许您在母版页中拥有所有逻辑；这将消除在所有内容页面中编写代码的需要。只是我的偏好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T21:14:56.500

放

```
<a href="help.aspx#<%= Path.GetFileName(this.Page.Request.FilePath) %>">Help</a> 
```

进入 MasterPage，然后以以下格式锚定在帮助页面上：

```
<a name="page1.aspx" />Blah, blah
<a name="page2.aspx" />Blah, blah 
```

如果您在子文件夹中重复页面名称，例如 Sub1/page1.aspx 和 Sub2/page1.aspx - 您必须稍微聪明一些。

# vb.net - 以 2.5 为增量舍入？

> ID：227376
> 
> 赞同：10
> 
> 时间：2008-10-22T20:16:50.050
> 
> 标签：vb.net

我需要将一个值四舍五入到最接近的 2.5 倍数。

例如：
6 --> 7.5
7.6 --> 10
等。

这似乎是最好的方法？

```
 Function RoundToIncrement(ByVal originalNumber As Decimal, ByVal increment As Decimal) As Decimal

        Dim num = Math.Round(originalNumber / increment, MidpointRounding.AwayFromZero) * increment
        If originalNumber Mod increment <> 0 And num < originalNumber Then
            num += increment
        End If
        Return num

    End Function 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-22T20:19:25.177

将数字除以 2.5，四舍五入到最接近的整数，然后将结果乘以 2.5。

你很近。

```
Function RoundToIncrement(ByVal orignialNumber As Decimal, ByVal increment As Decimal) As Decimal
    Return Math.Ceiling( orignialNumber / increment ) * increment
End Function 
```

Math.Ceiling 将始终将非整数向上舍入，因此您不需要后调整。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-22T20:19:32.323

将数字除以 2.5。四舍五入到最接近的 1。乘以 2.5。

当心累积错误，一切就绪。

-亚当

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-01-02T16:20:47.267

```
 /*
               This will round up (Math.Ceiling) or down (Math.Floor) based on the midpoint of the increment.  
               The other examples use Math.Ceiling and therefore always round up.
               Assume the increment is 2.5 in this example and the number is 6.13
            */
            var halfOfIncrement = Increment / 2;                                    // 2.5 / 2 = 1.25
            var floorResult = Math.Floor(originalNumber / Increment);               //Math.Floor(6.13 / 2.5) = Math.Floor(2.452) = 2
            var roundingThreshold = (floorResult * Increment) + halfOfIncrement;    //(2 * 2.5) = 5 + 1.25 = 6.25

            if (originalNumber >= roundingThreshold)                                //6.13 >= 6.25 == false therefore take Math.Floor(6.13/2.5) = Math.Floor(2.452) = 2 * 2.5 = 5
                result = Math.Ceiling(originalNumber / Increment) * Increment;
            else
                result = Math.Floor(originalNumber / Increment) * Increment; 
```

# .net - 泛型类集合的最佳实践

> ID：227380
> 
> 赞同：3
> 
> 时间：2008-10-22T20:18:09.937
> 
> 标签：.net, generics, collections

考虑以下代码：

```
abstract class SomeClassX<T>
{
  // blah
}

class SomeClassY: SomeClassX<int>
{
  // blah
}

class SomeClassZ: SomeClassX<long>
{
  // blah
} 
```

我想要 SomeClassX<T> 的集合，但是，这是不可能的，因为 SomeClassX<int> != SomeClassX<long> 和 List<SomeClassX<>> 是不允许的。

所以我的解决方案是让 SomeClassX<T> 实现一个接口并将我的集合定义为，其中 ISomeClassX 是接口：

```
class CollectionOfSomeClassX: List<ISomeClassX>
{
  // blah
} 
```

这是最好的方法，还是有更好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T20:43:32.803

我要么使用你建议的接口，要么让 SomeClassX 从另一个类继承。这实际上取决于您需要对集合中的对象做什么。无论它们有什么共同的功能都应该放在基类中，或者如果看起来更合适的话，应该放在接口中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T21:16:38.680

您最好的选择是按照您的建议，创建一个接口`ISomeClass`并实现它。我最近用一个用户偏好和配置文件系统解决了同样的问题，我们想用它来存储各种数据类型。它归结为：

```
public interface IEntry
{
    // ...
    object Value { get; set; }
} 
```

由于隐式实现了接口`Entry<Single>`，因此可以实例化特定的：`Entry<T>`

```
public class Entry<T> : IEntry
{
    T Value { get; set; }
    object IEntry.Value { get { return Value; } set { return Value; } }
} 
```

但是到了`IDictionary<string,IEntry>`时候，我们又将`IEntry`实例转换为`Entry<T>`适当的类型或将 Value 属性`IEntry`转换为适当的类型。

```
// assume entries is IDictionary<string,IEntry>...
var entry = entries["pizza-weight"];
var weight = (float)entry.Value; 
```

当然，这一切都是有道理的，因为就像`SomeClass<int>`!=`SomeClass<long>`所以是真的`IList<SomeClass<int>>`!= `IList<SomeClass<long>>`。

# c - 如何在不使用任何比较运算符且不使用 if、else 等的情况下以编程方式返回两个整数的最大值？

> ID：227383
> 
> 赞同：17
> 
> 时间：2008-10-22T20:19:11.607
> 
> 标签：c, bit-manipulation, max, obfuscation, puzzle

如何在不使用任何比较运算符且不使用 , 等的情况下以编程方式返回两个整数的`if`最大值`else`？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-22T20:27:26.957

max: // 将 MAX(a,b) 放入 a

```
a -= b;
a &= (~a) >> 31;
a += b; 
```

和：

整数a，b；

min: // 将 MIN(a,b) 放入 a

```
a -= b;
a &= a >> 31;
a += b; 
```

从[这里](http://web.archive.org/web/20130821015554/http://bob.allegronetwork.com/prog/tricks.html)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-22T20:27:21.073

[http://www.graphics.stanford.edu/~seander/bithacks.html#IntegerMinOrMax](http://www.graphics.stanford.edu/~seander/bithacks.html#IntegerMinOrMax)

```
r = x - ((x - y) & -(x < y)); // max(x, y) 
```

您可以通过算术移位`(x - y)`使符号位饱和来获得乐趣，但这通常就足够了。或者你可以测试高位，总是很有趣。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-15T08:44:26.853

在数学世界中：

```
max(a+b) = ( (a+b) + |(a-b)| ) / 2
min(a-b) = ( (a+b) - |(a-b)| ) / 2 
```

除了在数学上正确之外，它并没有像移位操作那样对位大小做出假设。

`|x|`代表 x 的绝对值。

# 评论：

你是对的，绝对值被遗忘了。这应该对所有 a、b 正面或负面都有效

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-22T20:32:00.707

我想我明白了。

```
int data[2] = {a,b};
int c = a - b;
return data[(int)((c & 0x80000000) >> 31)]; 
```

这行不通吗？基本上，你取两者的差，然后根据符号位返回一个或另一个。（这就是处理器大于或小于的方式。）因此，如果符号位为 0，则返回 a，因为 a 大于或等于 b。如果符号位为 1，则返回 b，因为 a 减去 b 导致结果为负，表示 b 大于 a。只需确保您的整数是 32 位签名的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-22T20:20:55.627

返回 (a > b ? a : b);

或者

```
int max(int a, int b)
{
        int x = (a - b) >> 31;
        int y = ~x;
        return (y & a) | (x & b); 
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-11-07T15:56:22.037

从 z0mbie（著名的 virii 作家）的文章“多态游戏”中，也许你会发现它很有用：

```
#define H0(x)       (((signed)(x)) >> (sizeof((signed)(x))*8-1))
#define H1(a,b)     H0((a)-(b))

#define MIN1(a,b)   ((a)+(H1(b,a) & ((b)-(a))))
#define MIN2(a,b)   ((a)-(H1(b,a) & ((a)-(b))))
#define MIN3(a,b)   ((b)-(H1(a,b) & ((b)-(a))))
#define MIN4(a,b)   ((b)+(H1(a,b) & ((a)-(b))))
//#define MIN5(a,b)   ((a)<(b)?(a):(b))
//#define MIN6(a,b)   ((a)>(b)?(b):(a))
//#define MIN7(a,b)   ((b)>(a)?(a):(b))
//#define MIN8(a,b)   ((b)<(a)?(b):(a))

#define MAX1(a,b)   ((a)+(H1(a,b) & ((b)-(a))))
#define MAX2(a,b)   ((a)-(H1(a,b) & ((a)-(b))))
#define MAX3(a,b)   ((b)-(H1(b,a) & ((b)-(a))))
#define MAX4(a,b)   ((b)+(H1(b,a) & ((a)-(b))))
//#define MAX5(a,b)   ((a)<(b)?(b):(a))
//#define MAX6(a,b)   ((a)>(b)?(a):(b))
//#define MAX7(a,b)   ((b)>(a)?(b):(a))
//#define MAX8(a,b)   ((b)<(a)?(a):(b))

#define ABS1(a)     (((a)^H0(a))-H0(a))
//#define ABS2(a)     ((a)>0?(a):-(a))
//#define ABS3(a)     ((a)>=0?(a):-(a))
//#define ABS4(a)     ((a)<0?-(a):(a))
//#define ABS5(a)     ((a)<=0?-(a):(a)) 
```

干杯

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-22T20:32:39.067

不像上面的那么时髦……但是……

```
int getMax(int a, int b)
{
    for(int i=0; (i<a) || (i<b); i++) { }
    return i;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-22T20:33:08.567

由于这是一个谜题，解决方案会稍微复杂：

```
let greater x y = signum (1+signum (x-y))

let max a b = (greater a b)*a + (greater b a)*b 
```

这是 Haskell，但在任何其他语言中都是一样的。C/C# 的人应该使用“sgn”（或“sign”？）而不是 signum。

请注意，这将适用于任意大小的整数和实数。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-22T20:43:24.270

这是一种欺骗，使用汇编语言，但它仍然很有趣：

```
 // GCC inline assembly
int max(int a, int b)
{
  __asm__("movl %0, %%eax\n\t"   // %eax = a
          "cmpl %%eax, %1\n\t"   // compare a to b
          "cmovg %1, %%eax"      // %eax = b if b>a
         :: "r"(a), "r"(b));
} 
```

如果您想严格遵守规则并说该`cmpl`指令对此是非法的，那么以下（效率较低的）序列将起作用：

```
 int max(int a, int b)
{
  __asm__("movl %0, %%eax\n\t"
      "subl %1, %%eax\n\t"
          "cmovge %0, %%eax\n\t"
          "cmovl %1, %%eax"
         :: "r"(a), "r"(b)
         :"%eax");
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-02-02T22:28:04.747

这些函数使用比较但不进行测试，并且在符合标准的系统上完全定义：

```
int min(int a, int b) {
    return (a <= b) * a + (b < a) * b;
}
int max(int a, int b) {
    return (a <= b) * b + (b < a) * a;
} 
```

这是一个没有乘法的替代方案，可移植到使用二进制补码作为负数的系统：

```
int min(int a, int b) {
    return (a & -(a <= b)) | (b & -(b < a));
}
int max(int a, int b) {
    return (b & -(a <= b)) | (a & -(b < a));
} 
```

两个版本都适用于所有整数类型。

请注意，**gcc**和**clang**都为上述函数生成无分支代码，并且**clang**为这两种替代方案生成了相同的最佳代码，这可以在此[Godbolt Compiler Explorer session](https://godbolt.org/z/dG5zsP)中看到。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-02-02T21:36:13.437

这是我在 C# 上仅使用`+, -, *, %, /`运算符的实现

```
using static System.Console;

int Max(int a, int b) => (a + b + Abs(a - b)) / 2;
int Abs(int x) => x * ((2 * x + 1) % 2);

WriteLine(Max(-100, -2) == -2); // true
WriteLine(Max(2, -100) == 2);   // true 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2013-10-06T03:30:26.840

```
int max(int a, int b)
{
   return ((a - b) >> 31) ? b : a;
} 
```

# reflection - 有没有办法以编程方式知道一个对象在内存中占用了多少空间？(.Net 2.0)

> ID：227401
> 
> 赞同：0
> 
> 时间：2008-10-22T20:23:40.113
> 
> 标签：reflection, memory, .net-2.0

我希望能够在我的代码的运行时知道某个对象占用了多少内存（在这种情况下是一个数据集，但我正在寻找一个“通用”解决方案）。

这可以通过反射实现吗？

这适用于 .Net 2.0。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T20:34:26.410

我相信这是重复的。查看：

*   [找出对象在 .NET 中使用多少内存的最简单方法是什么？](https://stackoverflow.com/questions/155022/what-is-the-easiest-way-to-find-out-how-much-memory-an-object-uses-in-net)
*   [确定一个类使用多少内存？](https://stackoverflow.com/questions/51540/determine-how-much-memory-a-class-uses#51895)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T20:47:26.807

太好了，总而言之，没有简单的方法，除了使用需要大量工作的 Profiling API。谢谢！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T20:49:34.633

```
int size = Marshal.SizeOf(typeof(int)); 
```

这也应该有效。

# excel - VB6 代码中的“Shift:=”是什么意思？

> ID：227417
> 
> 赞同：5
> 
> 时间：2008-10-22T20:27:25.537
> 
> 标签：excel, vb6

我在 VB6 应用程序中遇到了以下行。

```
mobjParentWrkBk.ExcelWorkBook.Application.Selection.Insert Shift:=xlToRight 
```

不幸的是，谷歌和其他搜索引擎并不是很有用，因为它们似乎省略了 := 部分。

什么是 C# 等价物？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-22T20:32:00.317

这是可选命名参数的 Visual Basic 语法。该`Insert`函数有一个名为 的参数`Shift`，正在指定该参数。

据我所知，C# 没有可选命名参数的等效项。相反，您需要调用该`Insert`方法，指定`Type.Missing`除`Shift`.

另请参阅以下 StackOverflow 问题：[VB.NET := Operator](https://stackoverflow.com/questions/204877/vbnet-operator)

更新（2008-10-29）：

C# 4.0 设置为引入可选参数和命名参数。[请参阅codebetter.com 上的](http://codebetter.com/blogs/matthew.podwysocki/archive/2008/10/28/named-and-optional-arguments-in-c-4-0.aspx)此博客条目。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-23T10:00:11.573

只是为了澄清约翰鲁迪的回应。

语法是可选的（小“o”），这意味着您不必使用它。根据我的经验，大多数 VB6 编码器不使用语法，而是更喜欢常规的“未命名”参数。

如果您确实选择使用它，则必须命名子过程调用中的所有后续参数。

命名参数语法可用于所有参数，无论是否使用 VBA 关键字`Optional`（大写“O”）声明了相应的参数。例如，考虑这个（有点愚蠢的）VBA 函数，它有两个参数，一个是 required ，一个是`Optional`：

```
Private Function TimesTen( _
    ByVal Value As Long, _
    Optional ByVal Factor As Long = 10 _
) As Long
  TimesTen = Value * Factor
End Function 
```

在 VBA 中，我可以对所需参数使用命名参数来调用它（`Optional`在 VBA 中可以简单地省略该参数，这与在 C#.NET 中`Type.Missing`必须用于所有省略的`Optional`参数不同）：

```
 MsgBox TimesTen(Value:=9) 
```

如果我想用“错误”顺序的参数调用它（为什么？？）我可以使用命名参数来实现：

```
 MsgBox TimesTen(Factor:=11, Value:=9) 
```

在命名参数之后尝试使用常规的“未命名”参数调用会导致编译错误：

```
 MsgBox TimesTen(Value:=9, 11) 
```

那么，如果 VB6 编码器很少使用命名参数，即使它们使用基本相同的语言，为什么 VBA 编码器还要使用命名参数呢？我认为这是因为 MS Office 应用程序的宏记录器生成的 VBA 倾向于（总是？）生成命名参数，并且许多 VBA 编码人员以这种方式学习编程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T20:36:08.373

VB6 和 VB.net 在方法中有可选参数。c# 可以选择方法重载。

VB6/VB.net 的说法 Shift:=xlToRight 允许通过名称传递特定参数的值。

例如 public sub mymethod(optional a as integer = -1, optional b as integer=1) ... end sub

我可以用 mymethod(b:=10) 调用这个方法

对于 c#，可能有 2 种方法

```
 void Shift()
{
defaultDirection = directionEnum.Left;
Shift(defaultDirection);
}

void Shift(directionEnum direction)
{
} 

```

还有1件事。虽然你可以通过传递参数来调用方法，但是在调用时添加参数名称会使代码更具可读性。
例如 DoSomethingWithData(CustomerData:= customer, SortDirection:=Ascending)

希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T20:42:29.903

这实际上是关于 Excel 以及它如何处理插入的全部内容。如果您选择一系列单元格并右键单击“插入”，系统将询问您移动单元格的方向。这是来自 Excel 帮助：

=======

范围对象上的插入方法

将一个单元格或一系列单元格插入工作表或宏表中，并将其他单元格移开以腾出空间。

表达式.插入（Shift，CopyOrigin）

表达式 必需。返回 Range 对象的表达式。

移位可选变体。指定移动单元格的方式。可以是以下 XlInsertShiftDirection 常量之一：xlShiftToRight 或 xlShiftDown。如果省略此参数，Microsoft Excel 将根据范围的形状来决定。

CopyOrigin 可选变体。副本来源。

===========

如果您没有定义常量，您可以替换以下数字

xlShiftDown：-4121 xlS​​hiftToLeft：-4159 xlShiftToRight：-4161 xlS​​hiftUp：-4162

# php - 当 PHP 是您的主要语言时，在 SQL Server 数据库中存储日期/时间的首选格式是什么？

> ID：227428
> 
> 赞同：12
> 
> 时间：2008-10-22T20:31:21.753
> 
> 标签：php, sql-server, datetime, time

我正在计划一个需要在 MSSQL 数据库中存储日期/时间的 PHP 应用程序。（好奇的是，它是一个日历应用程序。）存储这些信息的首选格式是什么？

MSSQL 有自己的 datetime 数据类型，在数据库本身中运行良好，可读性很强。但是，没有任何 MSSQL 函数可以将日期时间值转换为 PHP 的首选格式——UNIX 时间戳。这使得与 PHP 一起使用会更加痛苦。UNIX 时间戳很有吸引力，因为这正是 PHP 所喜欢的，但它的可读性肯定不高，而且没有一堆很好的内置 MSSQL 函数来处理数据。

您会将这些信息存储为 datetime 数据类型、UNIX 时间戳（作为 int、bigint 或 varchar 数据类型）、两种格式并排存储，还是完全存储为其他格式？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T20:51:57.700

我会以 MS-SQL 格式存储日期，以帮助充分利用 T-SQL 中的日期操作函数。更容易书写和阅读

```
SELECT * FROM Foo
WHERE DateDiff(d,field1,now()) < 1 
```

而不是通过操作整数来尝试执行等效操作

要将 MsSQL 日期转换为 unix 时间戳，请使用 dateDiff：

```
SELECT DATEDIFF(s,'1970-01-01 00:00:00',fieldName) as fieldNameTS
FROM TableName
WHERE fieldName between '10/1/2008' and '10/31/2008' 
```

要将 Unix 时间戳转换为 MsSQL 日期，您可以在 PHP 中执行此操作：

```
$msSQLDate = date("Y-m-d H:i:s", $unixDate ); 
```

或在 MsSQL 中

```
INSERT INTO TableName ( 
  fieldName
) VALUES (
  DATEADD(s,'1970-01-01 00:00:00', ? ) 
) 
```

其中参数一是 int($unixDate)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T20:36:44.847

我建议对任何 db 引擎中的所有日期都使用相同的方法，即 db 本机类型。（约会时间）

只需使用 "YYYY-MM-DD HH:MM:SS" 插入 php：`date('Y-m-d H:i:s', $myTimeStampInSeconds);`

- 编辑以回应下面的评论 -

1.  对于您可以使用的选定列`$timestamp = [strtotime](http://www.php.net/strtotime)( $yourColumnValue );`
2.  我建议以数据库本机格式存储，因为然后您可以使用 SQL 使用 SQL 日期/时间函数（如 DATEADD() 等）比较记录。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T10:52:18.940

大家好，美好的一天

是的，这可能是最好的方法，将日期存储在 db 中，它们将采用 db 格式，您可以在需要时根据需要进行格式化

但是在 ISO 开发的国际日期格式中还有另一种解决方案，我的意思是 ISO 8601。

ISO (ISO 8601) 定义的国际格式试图通过定义数字日期系统来解决所有日期问题，如下所示：YYYY-MM-DD 其中

YYYY 是年份 [所有数字，即 2100] MM 是月份 [01（一月）到 12（十二月）] DD 是日期 [01 到 31]，具体取决于飞蛾：P

使用数字日期在可读性和可用性方面也存在一些缺陷，它并不完美。但是，ISO 日期格式是普遍（且准确）可理解的日期表示的最佳选择。

请注意，此格式还可用于表示精确的日期和时间，以及时区信息

这是有关 ISO 8601:2000 的详细信息

[http://www.iso.org/iso/support/faqs/faqs_widely_used_standards/widely_used_standards_other/date_and_time_format.htm](http://www.iso.org/iso/support/faqs/faqs_widely_used_standards/widely_used_standards_other/date_and_time_format.htm)

没有了……再见

# vb.net - 改进 VB.NET URL 缩短器的建议？

> ID：227430
> 
> 赞同：1
> 
> 时间：2008-10-22T20:32:00.270
> 
> 标签：vb.net, url, function

这是我的功能（**更新**）：

```
Public Shared Function shortenUrl(ByVal URL As String) As String
    Return shortenUrl(URL, 32)
End Function
Public Shared Function shortenUrl(ByVal URL As String, ByVal maxLength As Integer) As String
    If URL.Length > maxLength Then
        String.Format("{0}...{1}", URL.Substring(0, (maxLength / 2)), URL.Substring(URL.Length - ((maxLength / 2) - 3)))
    Else
        Return URL
    End If
End Function 
```

我修复了它没有返回`maxLength`字符的问题，因为它没有考虑到省略号。

* * *

在我看来，这太复杂了；任何建议、评论和关注都非常受欢迎。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T20:35:11.760

为什么不这样做？

```
Public Shared Function shortenUrl(ByVal URL As String) As String
    Return shortenUrl(URL, 29)
End Function
Public Shared Function shortenUrl(ByVal URL As String, ByVal maxLength As Integer) As String
    If URL.Length > maxLength Then
        Return String.Format("{0}...{1}", URL.Substring(0, maxLength / 2),URL.Substring(URL.Length - (maxLength / 2)))
    Else
        Return URL
    End If
End Function 
```

这至少摆脱了所有的临时声明

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T21:51:20.703

好吧，我不知道它是否太复杂了......但它是错误的。如果我调用 shortUrl(URL, 29) 我希望返回的最大长度为 29 个字符。你的代码会给我 31。如果我用 30 的长度调用它，我会得到 33 个字符。您不包括插入的“...”，而是依靠舍入来获取子字符串长度并删除其余部分。

我会添加一些参数验证，并将其更改为：

```
Public Function shortenUrl2(ByVal URL As String, ByVal maxLength As Integer) As String
    Const middle as String = "..."
    If maxLength < 0 Then
       Throw New ArgumentOutOfRangeException("maxLength", "must be greater than or equal to 0")
    ElseIf String.IsNullOrEmpty(URL) OrElse URL.Length <= maxLength Then
       Return URL
    ElseIf maxLength < middle.Length Then
       Return URL.Substring(0, maxLength)
    End If

    Dim left as String = URL.Substring(0, CType(Math.Floor(maxLength / 2), Integer))
    Dim right as String = URL.Substring(URL.Length - (maxLength - left.Length - middle.Length))

    Return left & middle & right
End Function 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T20:37:17.090

```
Public Shared Function shortenUrl(ByVal URL As String, Optional ByVal maxLength As Integer = 29) As String
    If URL.Length > maxLength Then       
        Return String.Format("{0}...{1}", URL.Substring(0, maxLength / 2), URL.Substring(URL.Length - (maxLength / 2)))
    Else
        Return URL
    End If
End Function 
```

不知道为什么人们如此讨厌可选参数。他们做完全相同的事情*并向*用户公开如果他们不提供默认值将是什么值。

# xsd - 如何在 XML 模式中创建可重用的“美国州”类型？

> ID：227434
> 
> 赞同：4
> 
> 时间：2008-10-22T20:32:59.987
> 
> 标签：xsd, enumeration

我有一个包含多个地址的 XML 模式：

```
<xs:element name="personal_address" maxOccurs="1">
  <!-- address fields go here -->
</xs:element>
<xs:element name="business_address" maxOccurs="1">
  <!-- address fields go here -->
</xs:element> 
```

在每个地址元素中，我包含一个“美国州”枚举：

```
<xs:simpleType name="state">
    <xs:restriction base="xs:string">
        <xs:enumeration value="AL" />
        <xs:enumeration value="AK" />
        <xs:enumeration value="AS" />
                ....
            <xs:enumeration value="WY" />
        </xs:restriction>
</xs:simpleType> 
```

如何编写一次“美国州”枚举并在每个地址元素中重新使用它？如果这是一个 n00b 问题，我提前道歉——我以前从未写过 XSD。

我最初的尝试如下：

```
<xs:element name="business_address" maxOccurs="1">
  <!-- address fields go here -->
  <xs:element name="business_address_state" type="state" maxOccurs="1"></xs:element>
</xs:element> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T20:57:12.433

我认为你在正确的轨道上。我认为它更多地与 XML 命名空间有关。尝试以下操作：

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    targetNamespace="http://www.example.org/foo"
    xmlns:tns="http://www.example.org/foo"
    elementFormDefault="qualified">
    <xs:element name="business_address">
        <xs:complexType>
            <xs:sequence>
                <xs:element name="business_address_state"
                    type="tns:state" maxOccurs="1" />
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:simpleType name="state">
        <xs:restriction base="xs:string">
            <xs:enumeration value="AL" />
            <xs:enumeration value="AK" />
            <xs:enumeration value="AS" />
            <xs:enumeration value="WY" />
        </xs:restriction>
    </xs:simpleType>
</xs:schema> 
```

请注意，类型是**tns:state**而不仅仅是**state**

然后这就是你将如何使用它：

```
<?xml version="1.0" encoding="UTF-8"?>
<business_address xmlns="http://www.example.org/foo"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.example.org/foo foo.xsd ">
    <business_address_state>AL</business_address_state>
</business_address> 
```

请注意，此 XML 使用与 XSD 的 targetNamespace 相同的默认命名空间

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T05:54:25.843

虽然命名空间有助于保持模式的组织和防止冲突，但不是上面的命名空间允许重用，而是将类型放置为 <xs:schema> 根的直接子级，使其成为全局类型。（可在没有命名空间限定符的命名空间内使用，并且可以在任何使用 tns: 限定符的 tns 命名空间可见的地方使用。）

我更喜欢按照“伊甸园”方法构建我的模式，这可以最大限度地重用元素和类型（并且还可以促进对精心制作的唯一类型/元素的外部逻辑引用，例如存储在数据库中的数据字典.

请注意，虽然“伊甸园”模式模式提供了最大的重用性，但它也涉及最多的工作。在这篇文章的底部，我提供了指向博客系列中涵盖的其他模式的链接。

•**伊甸园方法** [http://blogs.msdn.com/skaufman/archive/2005/05/10/416269.aspx](http://blogs.msdn.com/skaufman/archive/2005/05/10/416269.aspx)

> 通过全局定义所有元素来使用模块化方法，并且像 Venetian Blind 方法一样，所有类型定义都是全局声明的。每个元素都被全局定义为节点的直接子节点，并且其类型属性可以设置为指定的复杂类型之一。

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema targetNamespace="TargetNamespace" xmlns:TN="TargetNamespace" xmlns:xs="http://www.w3.org/2001/XMLSchema"
elementFormDefault="qualified" attributeFormDefault="unqualified">
    <xs:element name="BookInformation" type="BookInformationType"/>
    <xs:complexType name="BookInformationType">
        <xs:sequence>
            <xs:element ref="Title"/>
            <xs:element ref="ISBN"/>
            <xs:element ref="Publisher"/>
            <xs:element ref="PeopleInvolved" maxOccurs="unbounded"/>
        </xs:sequence>
    </xs:complexType>
    <xs:complexType name="PeopleInvolvedType">
        <xs:sequence>
            <xs:element name="Author"/>
        </xs:sequence>
    </xs:complexType>
    <xs:element name="Title"/>
    <xs:element name="ISBN"/>
    <xs:element name="Publisher"/>
    <xs:element name="PeopleInvolved" type="PeopleInvolvedType"/>
</xs:schema> 
```

> 这种方法的优点是模式是可重用的。由于元素和类型都是全局定义的，因此两者都可以重用。这种方法提供了最大数量的可重用内容。缺点是架构冗长。当您创建通用库时，这将是一个合适的设计，在这些库中，您可以对模式元素和类型的范围以及它们在其他模式中的使用做出任何假设，特别是在可扩展性和模块化方面。

由于每个不同的类型和元素都有一个单一的全局定义，这些规范的粒子/组件可以与数据库中的标识符一对一地关联。乍一看，维护文本 XSD 粒子/组件与数据库之间的关联似乎是一项令人厌烦的持续手动任务，但 SQL Server 2005 实际上可以通过语句生成规范架构组件标识符

```
CREATE XML SCHEMA COLLECTION 
```

[http://technet.microsoft.com/en-us/library/ms179457.aspx](http://technet.microsoft.com/en-us/library/ms179457.aspx)

相反，为了从规范粒子构造模式，SQL Server 2005 提供了

```
SELECT xml_schema_namespace function 
```

[http://technet.microsoft.com/en-us/library/ms191170.aspx](http://technet.microsoft.com/en-us/library/ms191170.aspx)

ca·non·i·cal 与数学有关。（方程、坐标等）“最简单或标准形式” [http://dictionary.reference.com/browse/canonical](http://dictionary.reference.com/browse/canonical)

其他更容易构建但不太可重复/更“非规范化/冗余”的模式模式包括

•**俄罗斯娃娃方法**[http://blogs.msdn.com/skaufman/archive/2005/04/21/410486.aspx](http://blogs.msdn.com/skaufman/archive/2005/04/21/410486.aspx)

> 该模式有一个单一的全局元素 - 根元素。所有其他元素和类型都嵌套得越来越深，因为每种类型都适合它上面的类型，所以给它起了名字。由于此设计中的元素是在本地声明的，因此它们不能通过 import 或 include 语句重用。

•**萨拉米切片方法** [http://blogs.msdn.com/skaufman/archive/2005/04/25/411809.aspx](http://blogs.msdn.com/skaufman/archive/2005/04/25/411809.aspx)

> 所有元素都是全局定义的，但类型定义是本地定义的。这样其他模式可以重用这些元素。使用这种方法，具有本地定义类型的全局元素提供了元素内容的完整描述。此信息“切片”是单独声明的，然后重新聚合在一起，也可以拼凑在一起以构建其他模式。

•**威尼斯盲人方法** [http://blogs.msdn.com/skaufman/archive/2005/04/29/413491.aspx](http://blogs.msdn.com/skaufman/archive/2005/04/29/413491.aspx)

> 与俄罗斯娃娃方法类似，它们都使用单个全局元素。Venetian Blind 方法通过全局命名和定义所有类型定义来描述模块化方法（与全局声明元素和本地类型的 Salami Slice 方法相反）。每个全局定义的类型都描述了一个单独的“slat”，并且可以被其他组件重用。此外，根据架构顶部的 elementFormDefault 属性设置，所有本地声明的元素都可以是命名空间限定的或命名空间不限定的（slat 可以是“打开的”或“关闭的”）。

# sql-server - SQL Server 行长度

> ID：227438
> 
> 赞同：6
> 
> 时间：2008-10-22T20:33:46.007
> 
> 标签：sql-server, stored-procedures

我试图通过执行以下存储过程来确定表的行长度（以字节为单位）：

```
CREATE TABLE #tmp 
(
  [ID] int, 
  Column_name varchar(640), 
  Type varchar(640), 
  Computed varchar(640), 
  Length int, 
  Prec int, 
  Scale int, 
  Nullable varchar(640), 
  TrimTrailingBlanks varchar(640), 
  FixedLenNullInSource varchar(640), 
  Collation varchar(256)
)
INSERT INTO #tmp exec sp_help MyTable
SELECT SUM(Length) FROM #tmp
DROP TABLE #tmp 
```

问题是我不知道“sp_help”返回的表的表定义（数据类型等）。

我收到以下错误：

```
Insert Error: Column name or number of supplied values does not match table definition. 
```

查看 sp_help 存储过程并没有给我任何线索。

插入 sp_help 结果的正确 CREATE TABLE 语句是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T20:55:21.173

怎么做呢？

```
CREATE TABLE tblShowContig
(
    ObjectName CHAR (255),
    ObjectId INT,
    IndexName CHAR (255),
    IndexId INT,
    Lvl INT,
    CountPages INT,
    CountRows INT,
    MinRecSize INT,
    MaxRecSize INT,
    AvgRecSize INT,
    ForRecCount INT,
    Extents INT,
    ExtentSwitches INT,
    AvgFreeBytes INT,
    AvgPageDensity INT,
    ScanDensity DECIMAL,
    BestCount INT,
    ActualCount INT,
    LogicalFrag DECIMAL,
    ExtentFrag DECIMAL
)
GO

INSERT tblShowContig
EXEC ('DBCC SHOWCONTIG WITH TABLERESULTS')
GO

SELECT * from tblShowContig WHERE ObjectName = 'MyTable'
GO 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T13:13:54.833

上述答案均不正确或无效。

问题是确定每一列的数据类型每行消耗的字节数。

我有这项工作的唯一方法是：

1.  exec sp_help 'mytable' - 然后将第二个结果集的长度字段相加（如果使用 Query Analyzer 或 Management Studio 工作 - 只需将结果复制并粘贴到电子表格中并执行 SUM）

2.  编写一个 C# 或 VB.NET 程序来访问第二个结果集并对每一行的 Length 字段求和。

3.  修改 sp_help 的代码。

这不能使用 Transact SQL 和 sp_help 完成，因为无法处理多个结果集。

FWIW：结果集的表定义可以在这里找到：

[http://msdn.microsoft.com/en-us/library/aa933429(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa933429(SQL.80).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T21:21:02.713

尝试这个：

-- 总结所有列的长度

```
select SUM(sc.length)  
from syscolumns sc  
inner join systypes st on sc.xtype = st.xtype  
where id = object_id('table') 
```

-- 查看返回的各种物品

```
select st.name, sc.*  
from syscolumns sc  
inner join systypes st on sc.xtype = st.xtype  
where id = object_id('table') 
```

虽然不能保证，但它似乎与 sp_help 'table' 中出现的长度相同

免责声明：请注意，我阅读了 John Rudy 链接的文章，除了此处的最大大小之外，您还需要其他东西，例如 NULL 位图来获取实际的行大小。这里的尺寸也是最大尺寸。如果您有一个 varchar 列，则大多数行的实际大小较小....

Vendoran 有一个很好的解决方案，但我没有看到任何地方的最大行大小（基于表定义）。我确实看到了平均大小和各种分配信息，这正是您估计大多数事情的数据库大小所需的信息。

如果您对 sp_help 返回的长度感兴趣并将其相加，那么我认为（我不是 100% 确定）对 sysobjects 的查询会返回相同的数字。它们是否代表完整的最大行大小？不，您缺少诸如 NULL 位图之类的东西。它们是否代表了对您的实际数据的真实衡量？不，如果您只存储 100 个字符，VARCHAR(500) 也不会占用 500 个字节。此外，与行分开存储的 TEXT 字段和其他字段不显示其实际大小，仅显示指针的大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T21:48:15.420

这将为您提供所需的所有信息

```
Select * into #mytables
from INFORMATION_SCHEMA.columns

select * from #mytables

drop table #mytables 
```

**更新：**

我给出的答案是不完整的，**不是**不正确的。如果您查看返回的数据，您会意识到您可以使用 case 编写查询来计算行大小（以字节为单位）。它有你需要的一切：数据类型|大小|精度。BOL 具有每种数据类型使用的字节。当我有机会时，我会发布完整的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T20:40:55.977

我无法帮助您创建临时表来存储 sp_help 信息，但我可以帮助您计算行长。查看这篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/aa933068.aspx)；它可以帮助您根据字段长度、类型等进行计算。将其转换为可以通过查询 sysobjects 等重用的 SQL 脚本可能不会花费太多时间。

编辑：

我正在修改我的提议，为它编写一个脚本。我的方式远没有 Vendoran 的那么容易。:)

顺便说一句，我收回我之前所说的关于无法帮助临时表的内容。我可以：你做不到。sp_help 输出七个行集，因此我认为您无法执行原始问题中最初描述的操作。我认为你被困在使用不同的方法来提出它。

# javascript - 选择框 onClick - Rails

> ID：227440
> 
> 赞同：2
> 
> 时间：2008-10-22T20:34:09.827
> 
> 标签：javascript, ruby-on-rails

我有一个在 erb 代码中使用选择框的 Rails 应用程序。我想做的是重新加载传递排序参数的页面。我的控制器已经处理了它，但我不知道如何使用从我的选择框中选择的值重新加载页面。这是我的代码：

```
<% @options = {:latest => 'lastest' , :alphabetical => 'alphabetical', :pricelow => 'price-low', :pricehigh =>'pricehigh'} %>
<%= select_tag 'sort[]', options_for_select(@options), :include_blank => true,:onchange => "location.reload('location?sort='+this.value)"%> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T22:51:04.747

您是否考虑过在列表框中使用 ajax 调用？如果您的控制器上有一个基于排序参数仅返回排序列表的方法，那么您可以执行以下操作：

```
<% @options = {:latest => 'lastest' , :alphabetical => 'alphabetical', :pricelow => 'price-low', :pricehigh =>'pricehigh'} %>
<%= select_tag 'sort[]', options_for_select(@options), :include_blank => true,:onchange => remote_function(:url => {:controller => 'your_controller', :action => 'list_sort_method'}, :with => "'sort='+this.value", :update => "div_containing_list") %> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T08:45:52.393

如果您不想使用 AJAX，请在代码周围放置一个 form_tag。

[查看http://redmine.rubyforge.org/svn/trunk](http://redmine.rubyforge.org/svn/trunk)上的 Redmine 源代码。UsersController 做了类似的事情——有一个允许过滤器的组合框。选择组合会重新加载页面。

# c# - .Net 中使用现有 API 的事件的线程上下文是什么？

> ID：227446
> 
> 赞同：1
> 
> 时间：2008-10-22T20:35:18.937
> 
> 标签：c#, .net, multithreading

在 .Net 中使用 API 处理异步事件时，我发现自己无法预测库将如何针对大量对象进行扩展。

例如，使用 Microsoft.Office.Interop.UccApi 库，当我创建一个端点时，它会在电话事件发生时获取事件。现在假设我要创建 1000 个端点。每个端点的事件数量很少，但是 API 中幕后发生的事情是否能够跟上事件流的步伐？我不知道，因为它从未说明它是如何构建的。

假设我想在主线程中创建所有 1000 个对象。然后我想把 Login 方法放到一个大的线程池中，这样所有的对象都可以并行登录。然后，一旦所有对象都已登录，下一阶段将开始。

API引发的事件回调是否发生在原始创建线程中？一个单独的线程池？还是我使用 ThreadPool.QueueUserWorkItem 访问的同一个线程池？

我会更好地将每个对象放在它自己的线程中吗？在每个线程中分组几个对象？或者只是在主线程中创建所有 1000 个对象并通过 .Net 魔术就可以了？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T21:02:22.610

来自互操作程序集的事件只是 COM 连接点的包装器。来自连接点的调用到达的线程取决于在该连接点上建议的对象的线程模型。COM 将确保为此进行正确的线程切换。

如果您的对象是在主线程上实现的，在 .Net 中通常是一个 STA，那么所有事件都应该到达同一个线程。如果您希望调用从 COM 线程池（我认为与 CLR 线程池相同）到达随机线程，则需要在配置为 MTA 的线程上创建对象。

我强烈建议不要为每个对象创建一个线程： 1）如果您将这些线程创建为 STA，它们每个都会有一个消息队列，占用系统资源；2) 如果您将它们创建为 MTA，则无法保证事件调用会到达您的线程；3）您将有 1000 个空闲线程什么都不做，只是等待事件关闭；和 4) 启动和关闭所有这些线程将对您的应用程序产生可怕的性能成本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T20:43:52.133

这真的取决于很多事情，主要是你的硬件有多强大。线程池确实有一定数量的线程（您可以增加），它将为您的应用程序提供。因此，如果您的所有事件同时触发，有些事件很可能会等待片刻，而您的线程池会等待线程再次空闲。权衡是您也不会一直受到创建新线程的性能影响。可能创建 1000 个线程也不是正确的答案。

事实证明这是理想的，既因为重用线程的性能提升，也因为同时运行 1000 个线程可能比它的价值更多的内存/CPU 使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T13:46:28.043

我只想指出，在 .NET 2.0 及更高版本中，可以使用[ThreadPool.SetMaxThreads()](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.setmaxthreads(VS.80).aspx)以编程方式增加线程池中的最大线程数。鉴于此，您可以对线程数量设置硬性上限，从而确保调度程序不会因开销而陷入困境。

在这种情况下更有用的是，您可以使用[ThreadPool.SetMinThreads()](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.setminthreads(VS.80).aspx)设置最小线程数。有了这个，您可以确保您只在应用程序启动时支付 Franci 所说的“可怕的性能价格”。您可以将此与预期的用户数量峰值进行平衡，从而确保您不会创建大量新线程。

一个新的线程创建不会摧毁你。我担心的是需要同时创建大量线程的情况。如果您可以说这只会在启动时发生，那么您将是黄金。

# xml - 如何打印保留命名空间的 groovy 节点？

> ID：227447
> 
> 赞同：5
> 
> 时间：2008-10-22T20:35:41.493
> 
> 标签：xml, groovy, namespaces, xml-parsing

当我使用此代码输出一些我解析（和修改）的 XML 时`XmlParser`

```
XmlParser parser = new XmlParser()
def root = parser.parseText(feedUrl.toURL().text)
def writer = new StringWriter()
new XmlNodePrinter(new PrintWriter(writer)).print(root)
println writer.toString() 
```

根节点上的命名空间声明没有打印出来，即使它们在`toString()`根节点*中*......有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-02-16T05:25:26.847

我刚刚遇到了同样的问题，经过一番摆弄后，我找到了解决方法。

您使用***XmlSluper***而不是***XmlParser***并使用***StreamingMarkupBuilder***而不是***XmlNodePrinter***。然后利用**bind**中的闭包并使用**mkp**内置变量来声明命名空间。

例如; 使用上面 Ted 的源 xml 示例：

```
def root = new XmlSlurper().parseText("http://stackoverflow.com/feeds/question/227447".toURL().text))
def outputBuilder = new StreamingMarkupBuilder()
String result = XmlUtil.serialize(outputBuilder.bind {
    mkp.declareNamespace('':'http://www.w3.org/2005/Atom')
    mkp.declareNamespace('creativeCommons':'http://backend.userland.com/creativeCommonsRssModule')
    mkp.declareNamespace('re':'http://purl.org/atompub/rank/1.0')
    mkp.yield root }
)
println result 
```

结果是 ：

```
<?xml version="1.0" encoding="UTF-8"?><feed xmlns:creativeCommons="http://backend.userland.com/creativeCommonsRssModule" xmlns="http://www.w3.org/2005/Atom" xmlns:re="http://purl.org/atompub/rank/1.0">
<title type="text">How do I print a groovy Node with namespace preserved? - Stack Overflow </title>
<link rel="self" type="application/atom+xml" href="http://stackoverflow.com/feeds/question/227447"/>
<link rel="alternate" type="text/html" href="http://stackoverflow.com/questions/227447"/>
<subtitle>most recent 30 from stackoverflow.com</subtitle>
<updated>2011-02-16T05:13:17Z</updated>
<id>http://stackoverflow.com/feeds/question/227447</id>
<creativeCommons:license>http://www.creativecommons.org/licenses/by-nc/2.5/rdf</creativeCommons:license>
<entry>
<id>http://stackoverflow.com/questions/227447/how-do-i-print-a-groovy-node-with-namespace-preserved</id>
<re:rank scheme="http://stackoverflow.com">2</re:rank> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T04:55:15.527

看起来它正在对输出进行非规范化，并包括命名空间上下文以及实际需要命名空间上下文的节点。

例如，这个问题的网页嵌入了 creativeCommons 命名空间：

```
<feed xmlns="http://www.w3.org/2005/Atom" xmlns:creativeCommons="http://backend.userland.com/creativeCommonsRssModule" xmlns:thr="http://purl.org/syndication/thread/1.0">
  <!-- snip -->
  <creativeCommons:license>http://www.creativecommons.org/licenses/by-nc/2.5/rdf</creativeCommons:license>
  <!-- snip -->
</feed> 
```

当您使用此脚本输出 xml 时：

```
def root = new XmlParser().parseText("http://stackoverflow.com/feeds/question/227447".toURL().text)
println new XmlNodePrinter().print(root) 
```

它最终将命名空间移动到需要该命名空间的许可证节点。在这种情况下没什么大不了的，因为该命名空间中只有一个节点。如果大多数 XML 都是命名空间的，那么它可能会使事情变得更加臃肿。

```
<feed xmlns="http://www.w3.org/2005/Atom">
  <!-- snip -->
    <creativeCommons:license xmlns:creativeCommons="http://backend.userland.com/creativeCommonsRssModule">
http://www.creativecommons.org/licenses/by-nc/2.5/rdf
  </creativeCommons:license>
  <!-- snip -->
</feed> 
```

如果您确实希望节点标准化，则必须对 XmlNodePrinter 进行一些调整以执行 2 次通过 XML，首先收集所有使用的命名空间，然后在顶部而不是在每个命名空间节点内输出它们。groovy 源代码实际上非常易读，如果您确实需要它，修改起来并不难。

# windows - JavaScript - 提取文件夹名称

> ID：227449
> 
> 赞同：2
> 
> 时间：2008-10-22T20:36:13.880
> 
> 标签：windows, file, directory, javascript

我对 JavaScript 相当陌生。

给定本地计算机的文件夹路径（Windows），我想知道如何提取当前路径中所有可能文件夹的名称，而不知道有多少文件夹或它们的名称。

非常感谢您提前。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T21:18:41.890

这是一个小脚本，可让您开始使用 FileSystemObject 和 JScript：

```
var fso   = new ActiveXObject("Scripting.FileSystemObject");
var shell = new ActiveXObject("WScript.Shell");
var path  = "%ProgramFiles%";

var programFiles = fso.GetFolder(shell.ExpandEnvironmentStrings(path));
var subFolders   = new Enumerator(programFiles.SubFolders);

while (!subFolders.atEnd())
{
  var subFolder = subFolders.item();
  WScript.Echo(subFolder.Name);
  subFolders.moveNext();
} 
```

在命令行上使用 csript.exe 调用它：

```
cscript subfolders.js 
```

[Windows 脚本 5.6 文档](http://www.microsoft.com/downloads/details.aspx?FamilyId=01592C48-207D-4BE1-8A76-1C4099D7BBB9&displaylang=en)包含有关此主题（以及许多其他主题）所需的所有详细信息。下载它并随身携带，它真的很有帮助。在 Windows 系统上，稍微了解一下 FileSystemObject 及其亲属确实可以化险为夷。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T20:39:41.097

您不能在浏览器中通过 Javascript 执行此操作，因为 JS 无法从浏览器访问文件系统。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:45:05.140

假设脚本将在尝试访问本地硬盘驱动器有意义的上下文中执行（例如在 cscript 或经典 ASP 中），您最好的选择是[FileSystemObject](http://msdn.microsoft.com/en-us/library/d6dw7aeh(VS.85).aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T20:40:20.407

如果您在 Web 浏览器中执行 JavaScript，则不能，因为在这种情况下，出于安全原因，JavaScript 无法访问本地文件系统。

# sql - 加入同一个表两次时分组

> ID：227457
> 
> 赞同：1
> 
> 时间：2008-10-22T20:39:14.967
> 
> 标签：sql, db2

我正在写一个查询来总结一些数据。我在表中有一个基本上是布尔值的标志，所以我需要一些基于它的一个值的总和和计数，然后对另一个值进行同样的操作，如下所示：

```
select
   location
  ,count(*)
  ,sum(duration)
from my.table
where type = 'X'
  and location = @location
  and date(some_tstamp) = @date
group by location 
```

然后对于 type 列的另一个值也是如此。如果我加入这个表两次，我如何仍然分组所以我只能得到每个表的聚合，即 count(a. `*`) 而不是 count(*)...

编写两个单独的查询会更好吗？

**编辑**

谢谢大家，但我不是这个意思。我需要分别获取 type = 'X' 的摘要和 type = 'Y' 的摘要...让我发布一个更好的示例。我的意思是这样的查询：

```
select
   a.location
  ,count(a.*)
  ,sum(a.duration)
  ,count(b.*)
  ,sum(b.duration)
from my.table a, my.table b
where a.type = 'X'
  and a.location = @location
  and date(a.some_tstamp) = @date
  and b.location = @location
  and date(b.some_tstamp) = @date
  and b.type = 'Y'
group by a.location 
```

我需要按什么分组？另外，DB2 不喜欢 count(a. `*`)，这是一个语法错误。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T20:50:54.240

```
 select
   location
  ,Sum(case when type = 'X' then 1 else 0 end) as xCount
  ,Sum(case when type = 'Y' then 1 else 0 end) as YCount
  ,Sum(case when type = 'X' then duration else 0 end) as xCountDuration
  ,Sum(case when type = 'Y' then duration else 0 end) as YCountDuration
from my.table
where 
location = @location
  and date(some_tstamp) = @date
group by location 

```

这应该在 SQL Server 中工作。我猜 db2 应该有类似的东西。

编辑：添加 where 条件以限制记录选择 type = X 或 type = Y，如果“type”可以具有 X 和 Y 以外的值。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T20:43:15.503

您的 join 示例没有多大意义。您正在 A 和 B 之间做笛卡尔积。这真的是您想要的吗？

下面将为满足 WHERE 子句的每一对找到 count(*) 和 sum(duration)。根据您的描述，这听起来像您正在寻找的内容：

```
select
   type
  ,location
  ,count(*)
  ,sum(duration)
from my.table
where type IN ('X', 'Y')
  and location = @location
  and date(some_tstamp) = @date
group by type, location 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T22:24:58.590

为了使计数起作用，而不是 count(a.*)，只需执行 count(a.location) 或任何其他非空列（PK 将是理想的）。

至于主要问题，上面 shahkalpesh 或 George Eadon 给出的任何一个答案都行得通。此示例中没有理由将表连接两次。

# python - 如何获取字符的ASCII值

> ID：227459
> 
> 赞同：1202
> 
> 时间：2008-10-22T20:39:57.053
> 
> 标签：python, ascii

如何在[Python中获取字符的](http://en.wikipedia.org/wiki/Python_%28programming_language%29)[ASCII](http://en.wikipedia.org/wiki/ASCII)值？`int`

* * *

## 回答 #1

> 赞同：1580
> 
> 时间：2008-10-22T20:43:04.443

从[这里](http://mail.python.org/pipermail/python-win32/2005-April/003100.html)：

> 该函数**`ord()`**获取char的int值。如果您想在使用数字后转换回来，函数**`chr()`**可以解决问题。

```
>>> ord('a')
97
>>> chr(97)
'a'
>>> chr(ord('a') + 3)
'd'
>>> 
```

在 Python 2 中，还有一个`unichr`函数，它返回以序数为参数的[Unicode](http://en.wikipedia.org/wiki/Unicode)`unichr`字符：

```
>>> unichr(97)
u'a'
>>> unichr(1234)
u'\u04d2' 
```

在 Python 3 中，您可以`chr`使用`unichr`.

* * *

[ord() - Python 3.6.5rc1 文档](https://docs.python.org/3/library/functions.html#ord)

[ord() - Python 2.7.14 文档](https://docs.python.org/2/library/functions.html#ord)

* * *

## 回答 #2

> 赞同：181
> 
> 时间：2008-10-22T23:19:20.757

请注意，`ord()`它本身并没有给你 ASCII 值；它以任何编码为您提供字符的数值。因此，`ord('ä')`如果您使用的是 Latin-1，则结果可以是 228，或者`TypeError`如果您使用的是 UTF-8，它可以引发 a。如果您将 Unicode 传递给它，它甚至可以返回 Unicode 代码点：

```
>>> ord(u'あ')
12354 
```

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2008-10-22T20:41:56.817

您正在寻找：

```
ord() 
```

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2016-03-25T17:56:08.113

公认的答案是正确的，但是如果您需要一次将一大堆 ASCII 字符转换为它们的 ASCII 代码，那么有一种更聪明/更有效的方法可以做到这一点。而不是这样做：

```
for ch in mystr:
    code = ord(ch) 
```

或稍快：

```
for code in map(ord, mystr): 
```

您转换为直接迭代代码的 Python 本机类型。在 Python 3 上，这很简单：

```
for code in mystr.encode('ascii'): 
```

在 Python 2.6/2.7 上，它只是稍微复杂一些，因为它没有 Py3 样式`bytes`对象（`bytes`是 的别名`str`，按字符迭代），但它们确实有`bytearray`：

```
# If mystr is definitely str, not unicode
for code in bytearray(mystr):

# If mystr could be either str or unicode
for code in bytearray(mystr, 'ascii'): 
```

编码为按序数本机迭代的类型意味着转换速度更快；在 Py2.7 和 Py3.5 上的本地测试中，迭代 a`str`以获取其 ASCII 码使用10`map(ord, mystr)`所花费的时间大约是在 Py2 或Py3上使用的两倍，并且随着时间的延长，乘数会增加到〜6.5x-7x。`len``str``bytearray(mystr)``mystr.encode('ascii')``str``map(ord, mystr)`

唯一的缺点是转换是一次完成的，所以你的第一个结果可能需要更长的时间，真正巨大的`str`会有一个成比例的临时`bytes`/ `bytearray`，但除非这迫使你进入页面抖动，否则这可能并不重要.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-11-01T06:21:27.687

要获取字符的 ASCII 码，可以使用该`ord()`函数。

这是一个示例代码：

```
value = input("Your value here: ")
list=[ord(ch) for ch in value]
print(list) 
```

输出：

```
Your value here: qwerty
[113, 119, 101, 114, 116, 121] 
```

# python - 打开文件、读取、处理和回写 - Python 中最短的方法

> ID：227461
> 
> 赞同：13
> 
> 时间：2008-10-22T20:40:00.813
> 
> 标签：python, coding-style

我想对文件进行一些基本过滤。读取它，进行处理，然后写回它。

我不是在寻找“打高尔夫球”，而是想要最简单、最优雅的方法来实现这一目标。我想出了：

```
from __future__ import with_statement

filename = "..." # or sys.argv...

with open(filename) as f:
    new_txt = # ...some translation of f.read() 

open(filename, 'w').write(new_txt) 
```

该`with`语句使事情变得更短，因为我不必显式打开和关闭文件。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-23T16:28:39.713

实际上，使用 fileinput 的一种更简单的方法是使用 inplace 参数：

```
import fileinput
for line in fileinput.input (filenameToProcess, inplace=1):
    process (line) 
```

如果您使用 inplace 参数，它会将标准输出重定向到您的文件，因此如果您进行打印，它将写回您的文件。

此示例将行号添加到您的文件中：

```
import fileinput

for line in fileinput.input ("b.txt",inplace=1):
    print "%d: %s" % (fileinput.lineno(),line), 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T22:22:27.660

我会以不同的方式追求优雅：将文件读取和过滤操作实现为生成器，您将编写更多代码行，但它将更加灵活、可维护和高性能的代码。

请参阅 David M. Beazley 的[系统程序员生成器技巧](http://www.dabeaz.com/generators/)，这对于编写此类代码的任何人来说都是非常重要的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-22T22:15:46.020

这似乎有效：

```
with open(filename, "r+") as f:
    new_txt = process(f.read())
    f.truncate(0)
    f.write(new_txt) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T22:38:23.447

如果您正在寻找相当于“perl -pi”的python，这里有一个非常好的：

```
导入文件输入
对于 fileinput.input() 中的行：
   # 工艺线

```

有关更多信息，请参见[http://www.python.org/doc/2.5.2/lib/module-fileinput.html](http://www.python.org/doc/2.5.2/lib/module-fileinput.html)。

通过这种方式，您将在管道中使用您的 python 脚本来创建新文件：

```
$ myscript.py infile.txt > outfile.txt

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T07:33:50.637

如果你在中间崩溃，这样做不会[吃掉你的数据：](http://www.linux.org.au/conf/2007/talk/278.html)

```
from twisted.python.filepath import FilePath
p = FilePath(filename)
p.setContent(process(p.getContent())) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T19:52:55.650

[我使用生成器表达式](http://www.python.org/doc/2.5.2/ref/genexpr.html)的丑陋（但如问题中所述）解决方案；

```
# Some setup first
file('test.txt', 'w').write('\n'.join('%05d' % i for i in range(100)))

# This is the filter function
def f(i):
    return i % 3

# This is the main part 
file('test2.txt', 'w').write('\n'.join(str(f(int(l))) for l in file('test.txt', 'r').readlines()))

# And a wrapper for sanity
def filter_file(infile, outfile, filter_function)
    outfile.write('\n'.join(filter_function(l) for l in infile.readlines())) 
```

# php - 简单搜索：使用 CodeIgniter 将表单变量传递给 URI

> ID：227470
> 
> 赞同：3
> 
> 时间：2008-10-22T20:42:36.223
> 
> 标签：php, codeigniter

我的每个页面都有一个搜索表单。如果我使用表单助手，它默认为`$_POST`. 我希望搜索词显示在 URI 中：

```
http://example.com/search/KEYWORD 
```

我已经在谷歌上呆了大约一个小时，但无济于事。由于本机 URI 约定，我只找到了关于如何`$_GET`基本上禁用的文章。我不可能是第一个想要这种功能的人，不是吗？提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T01:44:21.027

如果您与未启用 JS 的人打交道，则有更好的解决方法。

**看法：**

```
<?php echo form_open('ad/pre_search');?>
   <input type="text" name="keyword" />
</form> 
```

**控制器**

```
<?php
    function pre_search()
    {
        redirect('ad/search/.'$this->input->post('keyword'));
    }

    function search()
    {
        // do stuff;
    }
?> 
```

我以前用过很多次。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T20:47:39.643

据我所知，没有任何方法可以通过简单的 POST 完成此操作。但是，您可以通过 Javascript 访问表单并更新目的地。例如：

```
<form id="myform" onsubmit="return changeurl();" method="POST">
<input id="keyword">
</form>

<script>
function changeurl()
{
    var form = document.getElementById("myform");
    var keyword = document.getElementById("keyword");

    form.action = "http://mysite.com/search/"+escape(keyword.value);

    return true;
}
</script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T07:03:06.133

查看这篇文章，了解如何启用 GET 查询字符串和分段 url。

[http://codeigniter.com/forums/viewthread/56389/#277621](http://codeigniter.com/forums/viewthread/56389/#277621)

启用后，您可以使用以下方法检索其他变量。

```
// url = http://example.com/search/?q=text
$this->input->get('q'); 
```

这更好，因为您不需要更改 allowed_uri_chars 配置设置。如果您只是将用户输入的任何内容放在 URI 中，您可能会收到“您提交的 URI 包含不允许的字符”错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-09T09:08:16.313

这是最好的解决方案：

```
$uri = $_SERVER['REQUEST_URI'];

$pieces = explode("/", $uri);

$uri_3 = $pieces[3]; 
```

谢谢[erunways](http://erunways.com)！

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-22T20:47:14.637

我对 CodeIgniter 了解不多，但它是 PHP，所以你不应该`$_GET`仍然可以使用它吗？您可以像 Google 一样格式化您的 URL：`mysite.com/search?q=KEYWORD`并使用`$_GET['q']`.

此外，搜索表单似乎不适合使用 POST；GET 是可收藏的，并不意味着服务器端正在发生变化。

# parsing - 将电话号码解析为组件

> ID：227473
> 
> 赞同：12
> 
> 时间：2008-10-22T20:43:04.490
> 
> 标签：parsing, phone-number

我需要一个经过良好测试的正则表达式（首选 .net 样式），或者一些其他简单的代码，可以将 USA/CA 电话号码解析为组件，所以：

*   3035551234122
*   1-303-555-1234x122
*   (303)555-1234-122
*   1 (303) 555 -1234-122

ETC...

全部解析为：

*   区号：303
*   交易所：555
*   后缀：1234
*   分机：122

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-07-15T11:41:28.843

到目前为止，没有一个答案对我来说足够强大，所以我继续寻找更好的东西，我找到了：

[谷歌处理电话号码的库](https://github.com/googlei18n/libphonenumber)

我希望它对你也有用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T20:52:18.263

这是我使用的一个：

```
^(?:(?:[\+]?(?<CountryCode>[\d]{1,3}(?:[ ]+|[\-.])))?[(]?(?<AreaCode>[\d]{3})[\-/)]?(?:[ ]+)?)?(?<Number>[a-zA-Z2-9][a-zA-Z0-9 \-.]{6,})(?:(?:[ ]+|[xX]|(i:ext[\.]?)){1,2}(?<Ext>[\d]{1,5}))?$ 
```

我相信我是从[RegexLib](http://regexlib.com)得到的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:57:21.963

首先去掉任何不是数字的东西。然后您的所有示例都简化为：

`/^1?(\d{3})(\d{3})(\d{4})(\d*)$/`

支持所有国家代码有点复杂，但同样的一般规则适用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T21:07:19.603

此正则表达式与您的示例完全一样：

```
Regex regexObj = new Regex(@"\(?(?<AreaCode>[0-9]{3})\)?[-. ]?(?<Exchange>[0-9]{3})[-. ]*?(?<Suffix>[0-9]{4})[-. x]?(?<Extension>[0-9]{3})");
Match matchResult = regexObj.Match("1 (303) 555 -1234-122");

// Now you have the results in groups 
matchResult.Groups["AreaCode"];
matchResult.Groups["Exchange"];
matchResult.Groups["Suffix"];
matchResult.Groups["Extension"]; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-09T09:45:02.083

这是一个与 GeoIP 一起使用的编写良好的库，例如：

[http://highway.to/geoip/numberparser.inc](http://highway.to/geoip/numberparser.inc)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-31T19:23:20.303

这是 Z Directory (vettrasoft.com) 提供的一种更易于使用的方法，适用于美国电话号码：

```
string_o s2, s1 = "888/872.7676";
z_fix_phone_number (s1, s2);
cout << s2.print();      // prints "+1 (888) 872-7676"
phone_number_o pho = s2;
pho.store_save(); 
```

最后一行将号码存储到数据库表“phone_number”中。列值：country_code = “1”、area_code = “888”、exchange = “872”等。

# compilation - 与默认的 4KB 相比，16KB 或 32KB 的 NTFS 分配块是否会使编译时间更快？

> ID：227483
> 
> 赞同：2
> 
> 时间：2008-10-22T20:44:21.337
> 
> 标签：compilation, ntfs, allocation

与默认的 4KB 相比，16KB 或 32KB 的 NTFS 分配块是否会使编译时间更快？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T20:52:38.183

我无法想象这会有很大的不同——磁盘块的大小与编译速度相差甚远。随着现代操作系统的缓存量，它似乎不太重要。

当然，真正的答案可以通过测量来找到。但是，在具有不同磁盘块大小的不同机器之间获得相似的条件可能会很棘手。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T20:55:19.550

我的猜测是磁盘碎片将是决定编译速度的最大因素（也就是说，对于相当大小的代码库）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T21:03:07.820

Dashogun 是正确的，至少在我的经验中是这样。较大的项目/解决方案在生成最终二进制文件的过程中会创建许多小的临时文件。我发现如果我一周左右对磁盘进行一次碎片整理（即使碎片整理程序不建议这样做），如果我不这样做，我不会看到性能下降。

作为一个佐证因素，有几个和我一起工作的人有同样的经历。

# c# - 关于 TabControl 中的事件特殊性的问题

> ID：227485
> 
> 赞同：2
> 
> 时间：2008-10-22T20:44:36.560
> 
> 标签：c#, winforms, event-handling, tabcontrol

我在下面有一个特殊问题的小演示。

```
using System;
using System.Windows.Forms;

namespace WindowsApplication1
{
    public class TestForm : Form
    {
        private System.Windows.Forms.TabControl tabControl1;
        private System.Windows.Forms.TabPage tabPage1;
        private System.Windows.Forms.TabPage tabPage2;
        private System.Windows.Forms.TextBox textBox1;

        public TestForm()
        {
            //Controls
            this.tabControl1 = new System.Windows.Forms.TabControl();
            this.tabPage1 = new System.Windows.Forms.TabPage();
            this.tabPage2 = new System.Windows.Forms.TabPage();
            this.textBox1 = new System.Windows.Forms.TextBox();

            // tabControl1
            this.tabControl1.Anchor = ((System.Windows.Forms.AnchorStyles)((((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Bottom)
                        | System.Windows.Forms.AnchorStyles.Left)
                        | System.Windows.Forms.AnchorStyles.Right)));
            this.tabControl1.Controls.Add(this.tabPage1);
            this.tabControl1.Controls.Add(this.tabPage2);
            this.tabControl1.Location = new System.Drawing.Point(12, 12);
            this.tabControl1.Name = "tabControl1";
            this.tabControl1.SelectedIndex = 0;
            this.tabControl1.Size = new System.Drawing.Size(260, 240);
            this.tabControl1.TabIndex = 0;
            this.tabControl1.Selected += new System.Windows.Forms.TabControlEventHandler(this.tabControl1_Selected);

            // tabPage1
            this.tabPage1.Controls.Add(this.textBox1);
            this.tabPage1.Location = new System.Drawing.Point(4, 22);
            this.tabPage1.Name = "tabPage1";
            this.tabPage1.Size = new System.Drawing.Size(252, 214);
            this.tabPage1.TabIndex = 0;
            this.tabPage1.Text = "tabPage1";

            // tabPage2
            this.tabPage2.Location = new System.Drawing.Point(4, 22);
            this.tabPage2.Name = "tabPage2";
            this.tabPage2.Size = new System.Drawing.Size(192, 74);
            this.tabPage2.TabIndex = 1;
            this.tabPage2.Text = "tabPage2";

            // textBox1
            this.textBox1.Anchor = ((System.Windows.Forms.AnchorStyles)(((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Left)
                        | System.Windows.Forms.AnchorStyles.Right)));
            this.textBox1.Location = new System.Drawing.Point(6, 38);
            this.textBox1.Name = "textBox1";
            this.textBox1.Size = new System.Drawing.Size(240, 20);
            this.textBox1.TabIndex = 0;

            // TestForm
            this.ClientSize = new System.Drawing.Size(284, 264);
            this.Controls.Add(this.tabControl1);
            this.Name = "Form1";
            this.Text = "Form1";
        }

        //Tab Selected
        private void tabControl1_Selected(object sender, EventArgs e)
        {
            this.Text = "TextBox Width: " + this.textBox1.Width.ToString();
        }
    }

    //Main
    static class Program
    {
        static void Main()
        {
            Application.Run(new TestForm());
        }
    }

} 
```

如果您运行上面的 C# 代码，您将获得一个包含选项卡控件的小表单。tabcontrol 内是第一个选项卡上的 texbox。如果您按照以下步骤操作，您将看到问题：

1.  选择tabPage2（表单标题中报textBox1的宽度）
2.  调整表格大小
3.  选择tabPage1（报错textBox1宽度）

有什么想法吗？文本框显然比报告的要大。如果再次单击 tabPage2，则会更新正确的大小。显然有一个事件更新 textBox1 的宽度。我可以在选择 tabPage1 时触发它吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T20:57:26.893

首先，感谢您提供完整的程序 - 它使您*更*容易弄清楚发生了什么！

虽然文本框不可见，但不会调整大小。当您选择 tabPage1 时，Selected 事件会在控件变得可见*之前*触发，并且文本框会再次布局。

现在，这就是它发生的原因——但你的真实情况是什么？如果您真的想捕捉控件的大小变化，请订阅它们的 Resize 事件。如果没有，你能解释更多关于你想要达到的目标吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T20:58:45.987

我很确定正在发生的事情是`Selected`在标签页变得可见之前稍微引发了事件。在标签页变得可见之前不会调整文本框的大小，因此您最终会在实际调整文本框大小之前检查文本框的大小值。当您再次更改选项卡时，文本框已调整大小，因此您获得了正确的值。

将示例表单的最后几行更改为如下所示，它将变得很明显：

```
 this.textBox1.SizeChanged += TextboxSizeChanged;
        }

        //Tab Selected
        private void tabControl1_Selected(object sender, EventArgs e)
        {
            System.Diagnostics.Debug.WriteLine("tab selected");
            this.Text = "TextBox Width: " + this.textBox1.Width.ToString();
        }

        private void TextboxSizeChanged(object sender, EventArgs e)
        {
            System.Diagnostics.Debug.WriteLine("Textbox resized");
        }
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T21:14:20.620

如果您通过向 textbox1.Resize 事件添加事件处理程序来稍微修改您的代码，您将看到会发生什么。tabPage1.Selected 事件发生在标签页中的控件调整大小之前，因此当您检查文本框的宽度时，您是在调整其大小之前对其进行检查。

通常这不会是一个问题，因为调整大小是在之后正确完成的，但我猜你会使用文本框的大小来做一些事情？

您应该能够编写自己的 TabControl 来解决此问题，但您必须进行试验才能看到这里的工作原理。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-22T20:56:44.290

不知道我是否理解这个问题。但是，您可以使用文本框的调整大小事件来捕获宽度更改或表单的调整大小。

在您的示例中，当您执行第 3 步时，tabPage1 的选择事件是否会触发？

# java - 查找从哪里加载 java 类

> ID：227486
> 
> 赞同：206
> 
> 时间：2008-10-22T20:44:41.040
> 
> 标签：java, classpath, classloader

有谁知道如何以编程方式找出java类加载器实际从哪里加载类？

我经常在大型项目中工作，其中类路径变得很长，手动搜索并不是一个真正的选择。我最近遇到了一个[问题](https://stackoverflow.com/questions/226280/eclipse-class-version-bug "问题")，即类加载器加载了一个不正确的类版本，因为它位于两个不同位置的类路径上。

那么如何让类加载器告诉我实际的类文件来自磁盘的哪个位置？

***编辑：***如果类加载器由于版本不匹配（或其他原因）实际上无法加载类怎么办，无论如何我们可以在读取它之前找出它试图读取的文件吗？

* * *

## 回答 #1

> 赞同：205
> 
> 时间：2008-10-22T21:15:09.013

这是一个例子：

```
package foo;

public class Test
{
    public static void main(String[] args)
    {
        ClassLoader loader = Test.class.getClassLoader();
        System.out.println(loader.getResource("foo/Test.class"));
    }
} 
```

这打印出来：

```
file:/C:/Users/Jon/Test/foo/Test.class 
```

* * *

## 回答 #2

> 赞同：107
> 
> 时间：2008-10-23T07:16:01.980

另一种找出类从哪里加载（不操作源）的方法是使用以下选项启动 Java VM：`-verbose:class`

* * *

## 回答 #3

> 赞同：92
> 
> 时间：2008-10-22T21:39:59.837

```
getClass().getProtectionDomain().getCodeSource().getLocation(); 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2008-10-22T21:53:58.637

这就是我们使用的：

```
public static String getClassResource(Class<?> klass) {
  return klass.getClassLoader().getResource(
     klass.getName().replace('.', '/') + ".class").toString();
} 
```

这将取决于 ClassLoader 实现： `getClass().getProtectionDomain().getCodeSource().getLocation()`

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2013-10-21T12:10:20.690

`ClassLoader`当对象被注册时，Jon 的版本失败，`null`这似乎暗示它是由 Boot 加载的`ClassLoader`。

此方法处理该问题：

```
public static String whereFrom(Object o) {
  if ( o == null ) {
    return null;
  }
  Class<?> c = o.getClass();
  ClassLoader loader = c.getClassLoader();
  if ( loader == null ) {
    // Try the bootstrap classloader - obtained from the ultimate parent of the System Class Loader.
    loader = ClassLoader.getSystemClassLoader();
    while ( loader != null && loader.getParent() != null ) {
      loader = loader.getParent();
    }
  }
  if (loader != null) {
    String name = c.getCanonicalName();
    URL resource = loader.getResource(name.replace(".", "/") + ".class");
    if ( resource != null ) {
      return resource.toString();
    }
  }
  return "Unknown";
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-04-22T15:49:31.250

仅编辑第一行：`Main`.class

```
Class<?> c = Main.class;
String path = c.getResource(c.getSimpleName() + ".class").getPath().replace(c.getSimpleName() + ".class", "");

System.out.println(path); 
```

输出：

```
/C:/Users/Test/bin/ 
```

也许风格不好，但效果很好！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-10-20T19:46:05.053

通常，我们不使用硬编码。我们可以先获取className，然后使用ClassLoader获取class URL。

```
 String className = MyClass.class.getName().replace(".", "/")+".class";
        URL classUrl  = MyClass.class.getClassLoader().getResource(className);
        String fullPath = classUrl==null ? null : classUrl.getPath(); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-22T20:49:18.533

看看这个类似的问题。 [发现同一类的工具..](https://stackoverflow.com/questions/135971/is-there-a-tool-to-discover-if-the-same-class-exists-in-multiple-jars-in-the-cl#136292)

我认为最相关的障碍是您是否有自定义类加载器（从 db 或 ldap 加载）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-02-07T20:27:25.247

简单的方法：

> System.out.println(java.lang.String.class.getResource(String.class.getSimpleName()+".class"));

输出示例：

> jar:file:/D:/Java/jdk1.8/jre/lib/rt.jar!/java/lang/String.class

或者

> String obj = "简单测试"; System.out.println(obj.getClass().getResource(obj.getClass().getSimpleName()+".class"));

输出示例：

> jar:file:/D:/Java/jdk1.8/jre/lib/rt.jar!/java/lang/String.class

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-02-14T23:48:56.150

这种方法适用于文件和罐子：

```
Class clazz = Class.forName(nameOfClassYouWant);

URL resourceUrl = clazz.getResource("/" + clazz.getCanonicalName().replace(".", "/") + ".class");
InputStream classStream = resourceUrl.openStream(); // load the bytecode, if you wish 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-10-22T20:46:37.167

假设您正在使用名为 的类`MyClass`，则以下内容应该有效：

```
MyClass.class.getClassLoader(); 
```

能否获得 .class 文件的磁盘位置取决于类加载器本身。例如，如果您使用 BCEL 之类的东西，则某个类甚至可能没有磁盘表示。

# java - JSTL、Bean 和方法调用

> ID：227500
> 
> 赞同：14
> 
> 时间：2008-10-22T20:50:29.950
> 
> 标签：java, exception, jsp, jstl, vignette

我正在开发一个 JSP，我需要在来自 Bean 的对象上调用方法。该页面的先前版本没有使用 JSTL，并且可以正常工作。我的新版本有这样的设置：

```
<jsp:useBean id="pageBean" scope="request" type="com.epicentric.page.website.PageBean" />
<c:set var="pageDividers" value="<%= pageBean.getPageDividers() %>" />
<c:set var="numColumns" value="${pageDividers.size()}" /> 
```

变量`pageDividers`是一个`List`对象。

我遇到了这个问题：当我询问`pageDivider`'s 的大小时，会引发异常。我知道这是一个简单的 JTSL 错误——我做错了什么？

错误信息是：

> 未指定默认命名空间时，函数大小必须与前缀一起使用

如何正确访问或调用`pageDividers`对象的方法？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-22T21:08:58.260

在 JSTL 中使用点运算符进行属性访问时，`${pageDividers.size}`（不需要**()**）导致调用名为`getSize()`.
由于 java.util.List 提供了一个名为`size()`（而不是`getSize()`）的方法，因此您将无法使用该代码访问列表长度。

* * *

为了访问列表大小，JSTL 提供了**fn:length**函数，使用如下

```
${fn:length(pageDividers)} 
```

请注意，为了使用**fn**命名空间，您应该将其声明如下

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %> 
```

此外，相同的函数可以用于任何集合类型，也可以用于字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T20:53:32.847

要使用 EL 访问 bean 的属性，您只需命名属性（而不是调用方法）。因此，假设您在 bean 中有一个名为 getSize() 的方法

```
${pageDividers.size} 
```

注意没有（）。

编辑：对不起...在原始帖子中出错。

# groovy - 如何阅读 Open Office 电子表格？

> ID：227507
> 
> 赞同：3
> 
> 时间：2008-10-22T20:51:34.440
> 
> 标签：groovy, openoffice.org

如何从 Groovy 读取 Open Office 3.0 电子表格 (.ods)？我想从命名工作表中选择特定列。理想情况下，添加“where”子句或其他条件子句会很有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T20:07:01.900

我从未使用过它，但[Open Office 有一个 Java API](http://api.openoffice.org/)，当然您也可以从 Groovy 中使用它。开始阅读的最佳位置似乎是[开发人员指南](http://wiki.services.openoffice.org/wiki/Documentation/DevGuide/OpenOffice.org_Developers_Guide)、[Java UNO 参考以及](http://api.openoffice.org/docs/java/ref/overview-summary.html)[Java](http://wiki.services.openoffice.org/wiki/API/Samples/Java)和（嘿！）[Groovy](http://wiki.services.openoffice.org/wiki/API/Samples/Groovy)中的示例。希望有帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-01T16:53:04.513

您能否将表格/电子表格导出为 SQL 条目，然后使用它。你也可以看看这个插件的goovy—— [http: //www.ifcx.org/](http://www.ifcx.org/wiki/GroovyForOpenOffice.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T06:58:09.413

可能是[Spring Factory](http://docs.codehaus.org/display/GROOVY/Using+Spring+Factories+with+Groovy)或[Groovy 和 JMX](http://docs.codehaus.org/display/GROOVY/Groovy+and+JMX)的东西。[Groovy 和 Open Office](https://sourceforge.net/forum/forum.php?forum_id=708126)有一个论坛。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-17T11:49:16.297

OpenOffice 文档是 ZIP 文件，其中包含 XML 格式的文档数据以及一些其他文件（word 文档的样式表）。[详细信息可以在这里找到](http://en.wikipedia.org/wiki/OpenDocument_technical_specification)。

calc 的主要问题是公式。如果您只有表格数据，那么您可以简单地读取单元格值并使用它。因此，您可以打开 ZIP 存档，读取其中`content.xml`的内容并使用任何 XML 解析器对其进行解析。

但是当单元格包含公式时，您需要执行它。在这种情况下，您必须通过 UNO API 打开文档。[这里是 Java 版本](http://www.openoffice.org/api/docs/java/ref/overview-summary.html)。有一个链接，您可以在其中下载示例代码，说明如何打开 ODF 文档以及如何检查其内容。[还有一些片段](http://codesnippets.services.openoffice.org/Calc/java.xml)，但没有一个显示如何检查工作表。

UNO 的主要缺点是文档。每种方法都在某处进行了解释，但您必须首先找到解决问题的方法。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-29T07:34:29.460

*因为标题没有提到 Groovy（只有问题细节才会提到），所以我不想提出这个新问题。*

通常如何阅读 Open Office 电子表格文档？有一些工具可以创建一个（ooo-python），但不是用于阅读一个。它们是 XML，但只是直截了当地深入研究并试图获得提取我想要的数据的正确逻辑似乎不太理想。

我想要的是类似于 Excel COM 支持的功能，但来自命令行工具（或脚本语言）。

# open-source - 音频水印开源项目

> ID：227517
> 
> 赞同：6
> 
> 时间：2008-10-22T20:55:35.260
> 
> 标签：open-source

您是否知道任何提供音频水印功能的开源库/项目？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T21:11:12.560

检查维基百科：[http ://en.wikipedia.org/wiki/Steganography#Implementations](http://en.wikipedia.org/wiki/Steganography#Implementations)

该站点的第 3 部分是关于音频的：http: [//www.binary-universe.net/](http://www.binary-universe.net/) 同一作者在 codeplex 上做了一个项目。

这些也做音频： [StegHide](http://steghide.sourceforge.net/) [mpeStego](http://www.petitcolas.net/fabien/steganography/mp3stego/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-01-21T21:43:07.670

我们制作了一个[C++ 水印库](https://github.com/jcelerier/watermarking/tree/master/src/libwatermark)作为学生项目。它实现：

*   最低有效位水印（不会抵抗任何东西），
*   扩频水印（应该会抵抗很多但听得见），
*   根据论文“Audio watermarking using time-frequency compression expansion”，压缩扩展算法有一个 MATLAB 代码，据说它非常健壮。

# java - 使 Perl 风格的正则表达式解释器的行为类似于基本或扩展的正则表达式解释器

> ID：227519
> 
> 赞同：1
> 
> 时间：2008-10-22T20:56:09.847
> 
> 标签：java, regex, grep

我正在编写一个工具来帮助学生学习正则表达式。我可能会用Java编写它。

想法是这样的：学生输入正则表达式，该工具显示文本的哪些部分将被正则表达式匹配。很简单。

但我想支持几种不同的正则表达式“口味”，例如：

*   基本正则表达式（想想：grep）
*   扩展正则表达式（想想：egrep）
*   Perl 正则表达式的子集，包括字符类 \w、\s 等。
*   sed 风格的正则表达式

Java 有 java.util.Regex 类，但它只支持 Perl 风格的正则表达式，它是基本和扩展 RE 的超集。我认为我需要的是一种方法来获取任何给定的正则表达式并转义不属于给定风味的元字符。然后我可以将它提供给 Regex 对象，它的行为就好像它是为选定的 RE 解释器编写的一样。

例如，给定以下正则表达式：

```
^\w+[0-9]{5}-(\d{4})?$ 
```

作为一个基本的正则表达式，它会被解释为：

```
^\\w\+[0-9]\{5\}-\(\\d\{4\}\)\?$ 
```

作为扩展的正则表达式，它将是：

```
^\\w+[0-9]{5}-(\\d{4})?$ 
```

作为 Perl 风格的正则表达式，它与原始表达式相同。

是否有“正则表达式的正则表达式”比我可以通过正则表达式搜索和替换来引用非元字符？我还能做什么？我可以使用其他 Java 类吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T21:31:53.377

我写过类似的东西：[是否有正则表达式来检测有效的正则表达式？](https://stackoverflow.com/questions/172303/is-there-a-regular-expression-to-detect-a-valid-regular-expression#172316)

您可以参与该表达式，并分别匹配每个标记：

```
[^?+*{}()[\]\\]                # literal characters
\\[A-Za-z]                     # Character classes
\\\d+                          # Back references
\\\W                           # Escaped characters
\[\^?(?:\\.|[^\\])+?\]         # Character classs
\((?:\?[:=!>]|\?<[=!])?        # Beginning of a group
\)                             # End of a group
(?:[?+*]|\{\d+(?:,\d*)?\})\??  # Repetition
\|                             # Alternation 
```

对于每场比赛，您可以在目标风味中拥有一些适当替换的字典。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-13T17:15:02.360

如果您的目标是一个 Unix / Linux 系统，为什么只针对每个正则表达式的最终主机？即，对 BRE 使用 grep，对 ERE 使用 egrep，对 PCRE 使用 perl，等等？您的模块唯一需要做的就是 UI。我见过的大多数正则表达式测试器（体面的）都使用这种方法的变体。

如果您想要另一个库建议，请查看[TRE](http://laurikari.net/tre/about/)的 BRE / ERE / POSIX / AWK 部分。它不支持反向引用，所以 PCRE / Python / Ruby / JS / Java 已经出局了……

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T21:20:04.290

查看这篇文章以获取“正则表达式的正则表达式”：[是否有正则表达式来检测有效的正则表达式？](https://stackoverflow.com/questions/172303/is-there-a-regular-expression-to-detect-a-valid-regular-expression)

您可以将其用作模块的基础。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T21:01:58.040

或者，您可以使用[Jakarta ORO](http://jakarta.apache.org/oro/)吗？

这支持以下正则表达式“风味”：

*   Perl5 兼容的正则表达式
*   类似 AWK 的正则表达式
*   全局表达式

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T21:56:32.377

如果你想让你的学生学习正则表达式，为什么不使用一个免费的工具——正则表达式教练——http: [//www.weitz.de/regex-coach/](http://www.weitz.de/regex-coach/)在网上学习和评估正则表达式非常好？

在类似问题上查看此 SO 线程 - [https://stackoverflow.com/questions/89718/is-there-anything-like-regexbuddy-in-the-open-source-world](https://stackoverflow.com/questions/89718/is-there-anything-like-regexbuddy-in-the-open-source-world)

BR，
~A

# java - 客户端 Swing 应用程序中的总线或侦听器/代表？

> ID：227526
> 
> 赞同：2
> 
> 时间：2008-10-22T20:57:37.627
> 
> 标签：java, swing, events, architecture

构建客户端摇摆应用程序应该在总线上通知什么（应用程序范围的消息系统，在概念上类似于 JMS，但要简单得多）以及应该使用直接侦听器通知什么？

乘坐公共汽车时，我总有一种无法回避的感觉“我不知道谁在哪里使用它”。此外，没有固定的顺序，很难否决事件，很难确切地知道在固定的时间发生了什么。

另一方面，使用监听器意味着要么直接引用源对象（耦合），要么通过无数次转换传递引用（A--b_listener-->B，B--c_listener-->C，只是因为 a 只需要知道一些东西C可以说，但B没有兴趣）。

那么，这方面有什么经验法则吗？有什么建议如何平衡吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T16:40:40.503

以我的经验，试图让 Swing 做一些它不是为或不希望你做的事情，是非常痛苦的。

我会选择最简单的方法；保持你的代码干净，用“Swing Way”做，直到你开始看到问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T04:26:33.143

事件总线是在某些架构中提供解耦的非常非常有用的工具。侦听器很容易实现，但是当您的对象和依赖图变得很大时，它们会受到很大的限制。侦听器往往会遇到循环依赖的问题（事件可能以奇怪的方式“反弹”，你最终不得不玩游戏以确保你不会被卡住。大多数绑定框架都会为你做到这一点，但有些令人反感知道侦听器事件正在发射到一百万个地方）。

我根据项目规模和可扩展性做出这种决定。如果它是一个大型应用程序，或者应用程序的某些方面可以通过动态方式（如插件模块等），那么总线是保持架构清洁的好方法（类似 OSGI 的模块容器是另一种方法，但是较重的重量）。

如果您正在考虑总线架构，我建议您查看[Event Bus](https://eventbus.dev.java.net/)项目 - 它与 Swing 配合得非常好，并为您所询问的内容提供了一个健壮的、开箱即用的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T09:14:30.027

Java Swing 中的约定是大量使用侦听器。坚持约定可以提高可维护性，但会扼杀创新。

我没有在 Swing 中遇到过总线方法，但我觉得它很有趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T12:13:12.520

好吧，我可以想象使用类似系统的 BUS 更新模型并使用侦听器委托来自模型的事件的方法。简单的场景：我得到了代表数据生产者的服务器端。然后在客户端有一个消费者接口，它消耗所有传入的消息并将它们转换为我的内部消息/DTO，并将它们推送到总线中，总线将它们分配到应用程序模型中。这些模型处理传入的消息并决定使用侦听器通知感兴趣的组件。

# asp.net-mvc - 如何在 ASP.NET 3.5 MVC 应用程序中将菜单项动态添加到母版页

> ID：227530
> 
> 赞同：1
> 
> 时间：2008-10-22T21:00:11.583
> 
> 标签：asp.net-mvc, model-view-controller, authentication, master-pages

我想根据会员安全登录角色将菜单项动态添加到我的母版页。从我在母版页 html 中读到的 RenderAction 可能可以做到这一点。由于我正在摸索这个，我不确定它的外观以及我如何在控制器中检查我当前的角色。我正在考虑创建一个表并将允许的菜单项与角色关系相关联，以便我可以传递到母版页以呈现动态菜单项。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T00:05:32.880

在控制器中，我会创建一个 MenuModel 类或类似的类，即菜单的模型。这将是一个仅数据类。考虑到当前用户的访问权限，在控制器中创建并填充它。这将允许您编写单元测试以确保您的安全代码是正确的。

然后我会通过 ViewData 将其传递给视图。我会将它与知道如何基于 MenuModel 类呈现菜单的辅助方法结合起来。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T12:22:36.963

如果这些“角色”是 ASP.NET Membership 角色，那么您可以使用带有 RoleGroup 标记的常规 LoginView 控件。我发现它在 MVC 中运行良好。如果“角色”是不同的（例如，您的模型中的某些东西），那么就按照 Haacked 所写的去做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T01:38:06.377

我不确定这是否是你要找的，但几周前我有一个同样的问题：

[卡住创建“安全修剪”html.ActionLink 扩展方法](https://stackoverflow.com/questions/121000/stuck-creating-a-security-trimmed-htmlactionlink-extension-method)

这允许我在母版页（或任何其他页面）中扩展菜单，通过 Authorize 属性控制对菜单项的访问：

这是[我执行此操作的代码](http://inq.me/post/ASPNet-MVC-Extension-method-to-create-a-Security-Aware-HtmlActionLink.aspx)。

# java - 如何在 Spring Web Flow 2 中的视图状态和操作状态之间传递模型数据

> ID：227532
> 
> 赞同：3
> 
> 时间：2008-10-22T21:01:27.650
> 
> 标签：java, spring, spring-webflow

在下面的 Web Flow 中，我将表单数据绑定到视图状态下提交事件的流变量 (lifeCycleForm)。我已验证名称、标签和描述属性都按预期填充。

但是，当计算操作状态中的表达式时，所有三个属性都为空。我的表单 bean 是可序列化的，我只是使用简单的字符串属性。

我做错了什么？

我对 Spring WebFlow 很陌生，所以我可能错过了一些明显的东西。

```
<var name="lifeCycleForm" class="com.btmatthews.freelancer.lifecycle.portlet.LifeCycleForm" />

<view-state id="createLifeCycle" model="lifeCycleForm">
    <binder>
        <binding property="name" required="true" />
        <binding property="label" required="true" />
        <binding property="description" required="false" />
    </binder>
    <transition on="submit" to="createLifeCycleAction" />
    <transition on="cancel" to="lifeCycleCreationCancelled" bind="false" />
</view-state>

<action-state id="createLifeCycleAction">        
    <evaluate expression="lifeCycleService.createLifeCycle(lifeCycleForm.name, lifeCycleForm.label, lifeCycleForm.description, null, null)" />
    <transition on="success" to="lifeCycleCreated" />
    <transition on="failure" to="createLifeCycle" />
</action-state>

<end-state id="lifeCycleCreated" />

<end-state id="lifeCycleCreationCancelled" /> 
```

**更新：**我忽略了在我原来的帖子中提到是我的单元测试失败了。从那以后我了解到 AbstractFlowExecutionTests 没有实现请求参数的绑定。这对我来说似乎有点疏忽。我已经尝试了最新的每晚 Spring WebFlow 2.0.4 并且行为保持不变。

**更新：**我的问题是 Spring WebFlow 模拟不模拟表单提交。

在此先感谢，布赖恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T08:03:01.487

令人懊恼的是，我最近还发现 Webflow 测试模拟不使用 Spring 的绑定。您是否尝试过在 Eclipse 等 IDE 中在 Tomcat 等容器中使用调试来运行流程？如果你没有，它会非常有用。如果您需要帮助，我可以提供进一步的提示，但如果您还没有开始，我会说下载 Eclipse Web 标准工具和 Web 工具项目插件。

顺便说一句，如果您真的希望能够对绑定进行单元测试，您仍然可以使用 Spring Webflow 1 FormActions 来绑定到模型对象，即使它会使您的流程更加冗长。

# c# - 如何让“复制到输出目录”与单元测试一起使用？

> ID：227545
> 
> 赞同：126
> 
> 时间：2008-10-22T21:06:27.767
> 
> 标签：c#, .net, visual-studio-2008, unit-testing, mstest

当我在执行测试之前构建单元测试项目时，测试输出被复制到 TestResults 文件夹，然后执行测试。我遇到的问题是，并非 Debug/bin 目录中的所有文件都被复制到 TestResults 项目中。

如何获取复制到 Debug/bin 目录的文件也复制到 TestResults 文件夹？

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-10-22T22:10:37.153

执行此操作的标准方法是在文件中指定[部署项](http://msdn.microsoft.com/en-us/library/ms182473.aspx "MSDN：团队系统测试部署")*`.testrunconfig`*，可以通过Visual Studio***测试***菜单或*解决方案项*文件夹中的*编辑测试运行配置项访问。*

 *** * *

## 回答 #2

> 赞同：62
> 
> 时间：2010-08-10T07:49:56.567

您可以指定部署属性，如下所示；您还需要设置“内容”和“如果较新则复制”属性（没有关于以后设置的文档，但您已经设置了这些以使其工作。

```
[TestMethod]
[DeploymentItem("mytestdata.xml")]
public void UploadTest()
{

} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-07-21T13:09:59.680

我必须打开“启用部署”下`Test -> Edit Test Settings -> Local -> Deployment`的`[DeploymentItem]`属性才能工作。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-12-01T00:20:54.180

这三个答案都是正确的，这取决于您的需要。

*在.testrunco* ​​nfig 中添加要部署的文件（VS2010 中的 .testsettings）会将所有这些文件复制到每个测试输出文件夹，即使是独立运行的无关测试也是如此。如果您运行一项测试，则 .testssettings 的部署部分中列出的所有测试数据文件都将复制到测试输出文件夹中。

在我的测试中，我需要将预期的 XML 文件复制到测试输出文件夹以与实际的测试输出 XML 进行比较。我使用 DeploymentItem 属性仅复制与正在运行的测试相关的 XML 文件。在 VS2010 中，我必须在 .testsettings 文件中启用部署（但不添加任何路径），然后在 DeploymentItem 中引用相对于 TestProject 的 XML 文件路径。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-08-30T17:32:23.143

我遇到了类似的问题，但我的问题与指向 TraceAndTestImpact.testsettings 文件而不是 Local.testsettings 文件有关。您可以在“测试/选择活动测试设置”菜单下从一个更改为另一个。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-09-04T20:30:13.137

以下适用于 VS2012 中包含在多个解决方案中的测试项目，而不使用 testsettings 文件：

1）将您希望部署的文件和文件夹排列到测试项目目录中的文件夹中。

2）在项目属性中，创建一个后期构建步骤

```
xcopy /Y /S /i "$(ProjectDir)<Project_Folder_Name>\*" "$(TargetDir)<Deployment_Folder_Name>" 
```

`$(ProjectDir)`并且`$(TargetDir)`是将由 VS 解释的宏，因此应包含在内。

`<Project_Folder_Name>`是在步骤 1 中创建的文件夹的名称。

`<Deployment_Folder_Name>`是将要部署测试文件的文件夹的名称，应该这样命名，以便在多个测试项目部署到同一目录时是唯一的，例如`<Project_Name>_TestInputs`.

共享位置中的测试文件也应复制到目标目录部署文件夹以限制测试交互。提供相对于`$(ProjectDir)`宏的源路径。例如`"$(ProjectDir)..\..\Common Files\C1219TDL-2008.xml"`.

3) 将`[DeploymentItem(source, destination)]`属性添加到使用部署文件的每个测试方法（最佳实践）或测试类（对于懒惰或匆忙的人来说更容易实践，最简单的方法是将项目更新为先前使用的相对路径或 testsettings 文件）。

在测试方法上，`source`是测试方法中使用的文件或目录相对于由创建的目标目录的路径，`xcopy`并且`destination`是相对于部署目录将创建的目录的路径。以便测试在目标目录或部署目录中运行一致。目标路径应该与没有文件引用的源路径相同。示例： `[DeploymentItem("Example_TestInputs\C1219TDL-2008.xml","Example_TestInputs")]`。`DeploymentItem`应该包含在使用该文件或目录的每个方法中。

在一个类上，`source`和`destination`都是由`xcopy`;在目标目录中创建的文件夹的名称 当运行类中的任何测试时，这会将整个文件夹复制到部署目录。例子：`[DeploymentItem("Example_TestInputs","Example_TestInputs")]`

4) 在测试方法中，您现在可以放心地访问文件和目录，无论 Visual Studio 当天决定将其放在哪里，例如`File.Exists(".\Example_TestInputs\C1219TDL-2008.xml")`.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-10-26T11:30:37.137

在 CopyLocal 不起作用的情况下，想通过提及一种让它专门为 dll 部署而不是将其用于数据或配置等的常规方法来增强接受的答案：

```
[DeploymentItem("bin\\release\\iRock.dll")]
[DeploymentItem("bin\\debug\\iRock.dll")] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T21:14:18.110

从 Visual Studio 中试用 Post-Build 事件命令行（如果您使用的是该 IDE）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-08-08T00:39:43.013

在 Visual Studio 2012 中，对于简单案例，您不需要 DeploymentItem 属性。[在这里](https://stackoverflow.com/a/18116053/746754)查看我的答案

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-07-18T11:10:37.670

```
[TestMethod]
[DeploymentItem("ProjectName/Folder/SubFolder/file.xml", "Folder/Subfolder")]
public void YourTestMethod()
{
   // in the method you are testing you should have this:
   var filePath = Path.GetDirectoryName(Assembly.GetExecutingAssembly().CodeBase) + "/Folder/Subfolder/file.xml";
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-10-27T19:38:14.503

接受的答案是正确的，大多数其他答案也是正确的。但是，多年来我发现如果您有大量数据文件，使用*DeploymentAttribtue*和*Copy to Output的 Visual Studio 单元测试的部署系统会很麻烦。*我发现将文件保存在原始位置效果更好。

我的其他答案中的完整详细信息在这里。 [https://stackoverflow.com/a/53004985/2989655](https://stackoverflow.com/a/53004985/2989655)

希望这可以帮助。

# winapi - 检查 RAM 托架 (Windows API)

> ID：227547
> 
> 赞同：0
> 
> 时间：2008-10-22T21:07:29.200
> 
> 标签：winapi, memory, hardware

我知道可以检查安装了多少物理 RAM 使用`GetPhysicallyInstalledSystemMemory`或操作系统可以看到多少 ram 使用`GlobalMemoryStatusEx`. 但是，我想知道是否有任何方法可以检查用户按插槽安装了多少内存。也就是说，能够以编程方式区分 1x2GB 内存和 2x1GB 内存，从而检查计算机是否可以通过软件轻松升级。理想情况下，一种无需 .Net 即可检查的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T21:44:26.627

使用 WMI 查看 Win32_PhysicalMemory。查看容量和银行标签属性。

更新：您不需要.NET。有关 C++中的示例，请参阅[使用 C++ 创建 WMI 应用程序](http://msdn.microsoft.com/en-us/library/aa389762(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T21:29:19.747

查看[此处](http://msdn.microsoft.com/en-us/library/cc300158(VS.85).aspx)列出的功能的 MSDN 文档，我看到该功能与 SMBIOS 表进行检查，该表由[此处](http://www.dmtf.org/standards/published_documents/DSP0134_2.6.0.pdf)的标准引用。 看来您确实可以通过 BIOS 找到您寻求的信息。您可能必须安装驱动程序才能将该信息传递给您的程序。

祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T13:13:33.367

您不需要 WMI（总是避免 WMI（慢）），也不需要任何驱动程序（当然）使用标准 Win32 SMB api

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T23:10:09.560

在 Linux 上，我几乎总能使用 dmidecode 找到该信息，它从 BIOS 解析 DMI 表。它显示了所有内存插槽以及每个内存插槽的内容，以及其他有趣的信息。但是，我不知道如何在 Windows 上获取 DMI 数据。

# javascript - 未终止的字符串文字的常见来源

> ID：227552
> 
> 赞同：58
> 
> 时间：2008-10-22T21:09:18.040
> 
> 标签：javascript, debugging, firefox-addon

我正在尝试调试在 Firefox 扩展中读取并执行的 JavaScript 脚本。我只能通过 Firebug 控制台看到错误（我的代码对 Firebug 不可见），并且它报告“未终止的字符串文字”。

我检查了这条线和它周围的线，一切似乎都很好——括号、大括号和引号是平衡的，等等。我应该寻找哪些其他可能的原因？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-09-03T12:32:02.890

大多数浏览器似乎都有这样的代码问题：

```
var foo = "</script>"; 
```

在 Firefox、Opera 和 IE8 中，这会导致未终止的字符串文字错误。在序列化包含脚本的 html 代码时可能会非常讨厌。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2008-12-23T07:39:52.373

寻找换行符！这些往往是原因。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2011-05-07T02:59:23.470

如果我有“声誉”，我会投票给 jamtoday 的答案

如果您的数据来自 PHP，这可能会有所帮助

```
$str = str_replace(array("\r", "\n"), '', $str); 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2011-09-14T18:02:08.490

我刚刚发现这`"<\/script>"`似乎和`"</scr"+"ipt>"`.

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-12-30T21:51:44.373

只需转义标签闭包或使用 ascii 代码

IE

```
<\/script> 
```

IE

```
<&#47;script> 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-22T21:30:35.797

您可以尝试通过[JSLint](http://jslint.com/)运行脚本。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-22T21:13:08.657

查找一个字符串，其中包含可能由某些服务器端代码插入的未转义的单个 qoute。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-23T16:01:01.330

如果您已经完成了任何剪切/粘贴操作：一些在线语法荧光笔会破坏单引号和双引号，将它们转换为格式化的引号对（匹配的开始和结束对）。（虽然我现在找不到任何例子）......所以这需要点击 Command-+ 几次并盯着你的引号字符

尝试[不同的字体？](https://stackoverflow.com/questions/4689/recommended-fonts-for-programming) 此外，不同的编辑器和 IDE 使用不同的标记器和突出显示规则，而 JS 是一种更动态的解析语言，因此请尝试在 emacs、vim、gedit（使用 JS 插件）中打开文件...如果幸运的话，其中之一它们将显示一条贯穿文件末尾的长紫色字符串。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-23T10:34:26.293

你有没有逃脱你的正斜杠（ / ）？我以前遇到过这些问题

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-05-27T16:57:22.773

过去，我在使用带角度的引号 ( ' ) 时遇到了麻烦，通常是从 Word 复制和粘贴。用常规单引号 ( ' ) 替换它们就可以了。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-12-02T12:13:03.197

也许是因为您的 PHP 代码中有换行符。如果您在警报窗口消息中需要换行符，请将其作为转义语法包含在 PHP 代码中每一行的末尾。我通常通过以下方式进行操作：

```
$message = 'line 1.\\n';
$message .= 'line 2.'; 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-07-08T12:52:38.610

另外，请记住 %0A 是编码的换行符 URL。我花了一段时间才找到我的违规代码中的换行符。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-03-13T16:34:47.013

如果没有任何帮助，请寻找一些 uni-code 字符，例如

```
\u2028 
```

这可能会在多行上破坏您的字符串并引发此错误

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-03-31T14:33:18.997

你试过[Chromebug](http://getfirebug.com/downloads#chromebug)吗？这是用于扩展的 Firebug。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-23T01:03:21.220

尝试“二分查找”。删除一半代码，然后重试。如果错误仍然存​​在，请删除剩余代码的一半。如果错误不存在，请将您删除的内容放回原处，然后删除其中的一半。重复。

您应该能够相当快地将其缩小到几行。我的经验是，在这一点上，你会注意到一些愚蠢的畸形字符串。

如果您不确定错误出现在哪个服务器端资源中，那么在保存到浏览器的 HTML 输出版本上执行此操作可能会很方便。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-23T01:26:10.347

网页开发人员猜错了查看者的浏览器使用哪种编码。这通常可以通过在页面标题中指定编码来解决。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-23T16:32:19.923

扫描错误消息提到的#行*之前的代码。*任何未终止的内容都会导致下游的某些内容（被指责的行#）被标记。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-03-31T14:05:50.650

空格是我发现的另一个问题，会导致此错误。使用函数修剪空白可能会有所帮助。

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2012-12-19T07:39:36.357

```
str = str_replace(array("\r\n","\n\r","\r", "\n"), '<br />', stripslashes($str)); 
```

这应该有效。

# lamp - 在 WAMP 上为 LAMP 开发是愚蠢的吗？

> ID：227557
> 
> 赞同：15
> 
> 时间：2008-10-22T21:12:25.460
> 
> 标签：lamp, wamp

在变得有点疏远开源，并花了几年时间在[ASP.NET](https://en.wikipedia.org/wiki/ASP.NET)中开发 Web 应用程序之后，我将开始做大量的 PHP / MySQL 开发。

我已经非常轻松地安装了[WampServer](https://www.wampserver.com/en/)以在我的 Windows 机器上启动并运行开发环境，但我的目标平台很可能是 Linux。我是否可能会因为在 Windows 上开发而以 Linux 为目标而遇到问题？是否建议投资获得用于开发 LAMP 应用程序的 Linux 环境设置？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-22T23:34:26.127

If you can, I'd invest in some kind of Linux, or at least *nix, development environment. For simple applications and websites, your setup is fine, but you will eventually run into subtle differences when you deploy.

Here are some things off the top of my head you'll want to watch out for if you stick with your Windows environment.

1.  File paths. A lot of PHP functions take file paths as arguments. Do *not* use the Windows backslash (\) separator. Even though you're on Windows, PHP will let you use a forward slash separator. Ideally abstract this away with your own file path class.

2.  Apache Modules, PECL Extensions. Apache Windows and Apache Unix often come with a different set of Apache Modules installed by default. Also, the same version of a module may run differently on a different platform. If your application relies on *any* Apache module, make sure it's available for both platforms. The same goes for PHP custom extensions (PECL).

3.  Process Forking. Using exec, `, etc. in a web application is a bad idea to begin with, but if you're using these functions they're going to behave differently between Windows and *nix

4.  File writing, locking, etc. works different

5.  Email is handled differently on both platforms

6.  The PHP group's code word for Windows is "some platforms". You can research more [on your own](http://www.google.com/search?q=site%3Aphp.net+%22some+platforms%22&btnG=Search) if you'd like

In general, the closer your development environment matches your production environment, the fewer environment/deployment related issues you'll have.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-22T21:15:15.453

在过去的几年里，我一直在这样做，还没有遇到任何问题——如果有的话，它可以通过强迫你编写更多可移植的代码来给你带来优势。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T21:23:15.673

Permissions and the fact that on Windows filenames aren't case-sensitive are the two things I can think of that have been a pain to me. But they are

1.  Solvable, at worst with an FTP client to change permissions.
2.  Good, easy ways to make you a better programmer (in a small way, yes).

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T21:15:27.093

不，在 WAMP 上开发并在 LAMP 上运行应该没问题，但至少在 LAMP 上运行。

我已经两种方式都没有遇到很多问题（好吧，过去在 WAMP 上部署企业站点时会遇到很多问题（不要尝试使用 PHP ISAPI 过滤器），但现在它们是可以解决的（[FastCGI](https://en.wikipedia.org/wiki/FastCGI)））。

只要您不添加任何声明它们在 Windows 上不受支持的 PECL 模块，您就不会有任何问题。此外（由于您说您使用的是 WAMP，我假设您使用的是 MySQL），[SQL Server](https://en.wikipedia.org/wiki/Microsoft_SQL_Server)和 PHP 有很多问题（它需要的古老驱动程序严重限制了查询的长度）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T21:16:58.307

理论上，PHP 和 MySQL 应该是完全平台无关的。

在实践中，如果您要拥有一个真正的生产应用程序，我建议您拥有一个镜像生产环境的测试环境，以避免意外。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T21:17:10.660

是的，我建议在尽可能接近生产环境的环境中进行开发。

There are differences between how PHP works on Windows as compared to Linux. And other differences like how Linux handles file permissions as compared to Windows. I run the free [VMware](https://en.wikipedia.org/wiki/VMware) server with a Linux virtual machine.

I have a [Samba](https://en.wikipedia.org/wiki/Samba_%28software%29) share on the Linux VM that I mount as a networked drive in Windows. Then I use [Eclipse](https://en.wikipedia.org/wiki/Eclipse_%28software%29) on Windows as my code editor.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T21:18:12.233

No, because pretty much the only thing you can't do on WAMP if you target LAMP is using [System()](http://fr.php.net/manual/en/function.system.php)/[Exec](http://fr.php.net/manual/en/book.exec.php) Calls, and **usually** that is a good thing because those should be used very sparsely.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T23:11:25.580

It's worth having a LAMP sandbox so you can get to know where to find - and how to edit - configuration files, get comfortable with restarting services, handling scheduled jobs, etc. if you are going to have to deal with these tasks in production.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-24T02:32:17.840

No.
VirtualBox + shared folders should be useful if you have about 6-8 hours free on one weekend to get all VirtualBox basics clear and settings worked out.

If you're switching to Linux, the process may take up to a month and you will be *highly* unproductive in that time, in terms of production code.

It is a good idea to keep practicing Linux on VirtualBox for Windows, in advance before switching, using one of [PCLinuxOS](https://en.wikipedia.org/wiki/PCLinuxOS), [CentOS](https://en.wikipedia.org/wiki/CentOS), [openSUSE](https://en.wikipedia.org/wiki/OpenSUSE), or [Ubuntu](https://en.wikipedia.org/wiki/Ubuntu_%28operating_system%29). I prefer CentOS and PCLinuxOS.

There's a gem called SLAMPP and another beauty called [XAMPP](https://en.wikipedia.org/wiki/XAMPP) <-- works on Linux and Windows.

IMO, as a rough guesstimate, if you expect to code 2000-3000 lines of code (that you write/add) per project, for six months to one year, stick to Windows and master Linux meanwhile using VirtualBox.

If above that, or if you plan to make a cool new LAMP website, I think you should switch to Linux first. Take a month more to get used to Linux. You can still shuffle around with dual boot or VirtualBox for as long as you like, starting as early as you can - learning Linux enough to debug a LAMP application does take time.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-27T12:36:53.750

Paths, beware of paths. You can build a whole [CMS](https://en.wikipedia.org/wiki/Content_management_system) and it would mess up because of paths.

# c# - Winforms 处理 IDisposable

> ID：227566
> 
> 赞同：2
> 
> 时间：2008-10-22T21:14:46.267
> 
> 标签：c#, winforms, dispose, idisposable

有没有人有关于正确使用 dispose 和 IDisposable 的好文章或教程。我试图向一些初级开发人员解释这一点，并希望获得一些额外的材料、示例等。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T21:20:44.227

[Shawn Farkas 的这篇 MSDN 文章http://msdn.microsoft.com/en-us/magazine/cc163392.aspx](http://msdn.microsoft.com/en-us/magazine/cc163392.aspx)是一个很好的起点。最终文章由 Joe Duffy 撰写，位于 http://www.bluebytesoftware.com/blog/2005/04/08/DGUpdateDisposeFinalizationAndResourceManagement.aspx，并在[http://www.bluebytesoftware.com/blog/2008/02](http://www.bluebytesoftware.com/blog/2008/02/18/IDisposableFinalizationAndConcurrency.aspx)[中](http://www.bluebytesoftware.com/blog/2005/04/08/DGUpdateDisposeFinalizationAndResourceManagement.aspx)进行了一些跟进[/18/IDisposableFinalizationAndConcurrency.aspx](http://www.bluebytesoftware.com/blog/2008/02/18/IDisposableFinalizationAndConcurrency.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T21:34:14.543

许多旧的建议来源暗示 IDisposable 以某种方式与终结器相关联。密切关注 Herb Sutter 对此主题的评论。如果您实现 IDisposable，请不要急于得出您需要编写终结器的结论，以“确保 Dispose 最终运行，以防客户端忘记调用它”。通常情况并非如此。一个类可以实现 IDisposable 以便它可以对其拥有的托管对象进行各种调用，例如依次处理这些对象。从终结器执行此操作绝对没有意义，因为终结器无法可靠地访问其他托管对象。此外，终结器所做的任何事情都必须能够从任何线程调用。终结器是一个非常晦涩的高级事物，而 IDisposable 是一个应该无处不在的简单模式。[情况进一步改变](https://stackoverflow.com/questions/155780/safehandle-in-c)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T22:18:52.923

这是我的。:-)

[http://www.blackwasp.co.uk/IDisposable.aspx](http://www.blackwasp.co.uk/IDisposable.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T02:18:58.057

告诉他们始终对一次性对象使用 using 语句。

```
using (MyDisposable obj = new MyDisposable())
{
  obj.some_stuff();

} //obj is disposed here 
```

# c# - HttpWebResponse 的编码问题

> ID：227575
> 
> 赞同：28
> 
> 时间：2008-10-22T21:17:05.373
> 
> 标签：c#, encoding

这是代码片段：

```
HttpWebRequest webRequest = (HttpWebRequest)WebRequest.Create(request.RawUrl);
WebRequest.DefaultWebProxy = null;//Ensure that we will not loop by going again in the proxy
HttpWebResponse response = (HttpWebResponse)webRequest.GetResponse();
string charSet = response.CharacterSet;
Encoding encoding;
if (String.IsNullOrEmpty(charSet))
encoding = Encoding.Default;
else
encoding = Encoding.GetEncoding(charSet);

StreamReader resStream = new StreamReader(response.GetResponseStream(), encoding);
return resStream.ReadToEnd(); 
```

问题是如果我测试：[http ://www.google.fr](http://www.google.fr)

所有“é”都没有很好地显示。我尝试将 ASCII 更改为 UTF8，但仍然显示错误。我已经在浏览器中测试了 html 文件，并且浏览器很好地显示了 html 文本，所以我很确定问题出在我用来下载 html 文件的方法上。

我应该改变什么？

*删除了无效的 ImageShack 链接*

### 更新 1：代码和测试文件已更改

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-11-19T20:55:12.273

如果未在服务器的内容类型标头中指定 CharacterSet，则默认为“ISO-8859-1”（与 HTML 中的“charset”元标记不同）。我将 HttpWebResponse.CharacterSet 与 HTML 的 charset 属性进行比较。如果它们不同 - 我使用 HTML 中指定的字符集再次重新读取页面，但这次使用正确的编码。

见代码：

```
 string strWebPage = "";
    // create request
    System.Net.WebRequest objRequest = System.Net.HttpWebRequest.Create(sURL);
    // get response
    System.Net.HttpWebResponse objResponse;
    objResponse = (System.Net.HttpWebResponse)objRequest.GetResponse();
    // get correct charset and encoding from the server's header
    string Charset = objResponse.CharacterSet;
    Encoding encoding = Encoding.GetEncoding(Charset);
    // read response
    using (StreamReader sr = 
           new StreamReader(objResponse.GetResponseStream(), encoding))
    {
        strWebPage = sr.ReadToEnd();
        // Close and clean up the StreamReader
        sr.Close();
    }

    // Check real charset meta-tag in HTML
    int CharsetStart = strWebPage.IndexOf("charset=");
    if (CharsetStart > 0)
    {
        CharsetStart += 8;
        int CharsetEnd = strWebPage.IndexOfAny(new[] { ' ', '\"', ';' }, CharsetStart);
        string RealCharset = 
               strWebPage.Substring(CharsetStart, CharsetEnd - CharsetStart);

        // real charset meta-tag in HTML differs from supplied server header???
        if(RealCharset!=Charset)
        {
            // get correct encoding
            Encoding CorrectEncoding = Encoding.GetEncoding(RealCharset);

            // read the web page again, but with correct encoding this time
            //   create request
            System.Net.WebRequest objRequest2 = System.Net.HttpWebRequest.Create(sURL);
            //   get response
            System.Net.HttpWebResponse objResponse2;
            objResponse2 = (System.Net.HttpWebResponse)objRequest2.GetResponse();
            //   read response
            using (StreamReader sr = 
              new StreamReader(objResponse2.GetResponseStream(), CorrectEncoding))
            {
                strWebPage = sr.ReadToEnd();
                // Close and clean up the StreamReader
                sr.Close();
            }
        }
    } 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-10-22T21:23:02.537

首先，编写该代码的更简单方法是使用 StreamReader 和 ReadToEnd：

```
HttpWebRequest webRequest = (HttpWebRequest)WebRequest.Create(myURL);
using (HttpWebResponse response = (HttpWebResponse)webRequest.GetResponse())
{
    using (Stream resStream = response.GetResponseStream())
    {
        StreamReader reader = new StreamReader(resStream, Encoding.???);
        return reader.ReadToEnd();
    }
} 
```

然后它“只是”找到正确编码的问题。你是如何创建文件的？如果它与记事本一起使用，那么您可能想要`Encoding.Default`- 但这显然不是便携式的，因为它是*您*PC 的默认编码。

在运行良好的 Web 服务器中，响应将在其标头中指示编码。话虽如此，在某些情况下，响应标头有时会声明一件事，而 HTML 声明另一件事。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-03-23T15:25:53.323

如果您不想下载该页面两次，我稍微修改了 Alex 的代码，使用[How do I put a WebResponse into a memory stream?](https://stackoverflow.com/questions/179676/how-do-i-put-a-webresponse-into-a-memory-stream) . 这是结果

```
public static string DownloadString(string address)
{
    string strWebPage = "";
    // create request
    System.Net.WebRequest objRequest = System.Net.HttpWebRequest.Create(address);
    // get response
    System.Net.HttpWebResponse objResponse;
    objResponse = (System.Net.HttpWebResponse)objRequest.GetResponse();
    // get correct charset and encoding from the server's header
    string Charset = objResponse.CharacterSet;
    Encoding encoding = Encoding.GetEncoding(Charset);

    // read response into memory stream
    MemoryStream memoryStream;
    using (Stream responseStream = objResponse.GetResponseStream())
    {
        memoryStream = new MemoryStream();

        byte[] buffer = new byte[1024];
        int byteCount;
        do
        {
            byteCount = responseStream.Read(buffer, 0, buffer.Length);
            memoryStream.Write(buffer, 0, byteCount);
        } while (byteCount > 0);
    }

    // set stream position to beginning
    memoryStream.Seek(0, SeekOrigin.Begin);

    StreamReader sr = new StreamReader(memoryStream, encoding);
    strWebPage = sr.ReadToEnd();

    // Check real charset meta-tag in HTML
    int CharsetStart = strWebPage.IndexOf("charset=");
    if (CharsetStart > 0)
    {
        CharsetStart += 8;
        int CharsetEnd = strWebPage.IndexOfAny(new[] { ' ', '\"', ';' }, CharsetStart);
        string RealCharset =
               strWebPage.Substring(CharsetStart, CharsetEnd - CharsetStart);

        // real charset meta-tag in HTML differs from supplied server header???
        if (RealCharset != Charset)
        {
            // get correct encoding
            Encoding CorrectEncoding = Encoding.GetEncoding(RealCharset);

            // reset stream position to beginning
            memoryStream.Seek(0, SeekOrigin.Begin);

            // reread response stream with the correct encoding
            StreamReader sr2 = new StreamReader(memoryStream, CorrectEncoding);

            strWebPage = sr2.ReadToEnd();
            // Close and clean up the StreamReader
            sr2.Close();
        }
    }

    // dispose the first stream reader object
    sr.Close();

    return strWebPage;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-09-12T20:36:29.490

这里有一些很好的解决方案，但它们似乎都试图从内容类型字符串中解析出字符集。这是使用 System.Net.Mime.ContentType 的解决方案，它应该更可靠，更短。

```
 var client = new System.Net.WebClient();
 var data = client.DownloadData(url);
 var encoding = System.Text.Encoding.Default;
 var contentType = new System.Net.Mime.ContentType(client.ResponseHeaders[HttpResponseHeader.ContentType]);
 if (!String.IsNullOrEmpty(contentType.CharSet))
 {
      encoding = System.Text.Encoding.GetEncoding(contentType.CharSet);
 }
 string result = encoding.GetString(data); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-07-29T04:27:29.107

这是一次下载的代码。

```
String FinalResult = "";
HttpWebRequest Request = (HttpWebRequest)System.Net.WebRequest.Create( URL );
HttpWebResponse Response = (HttpWebResponse)Request.GetResponse();
Stream ResponseStream = Response.GetResponseStream();
StreamReader Reader = new StreamReader( ResponseStream );

bool NeedEncodingCheck = true;

while( true )
{
    string NewLine = Reader.ReadLine(); // it may not working for zipped HTML.
    if( NewLine == null )
    {
        break;
    }

    FinalResult += NewLine;
    FinalResult += Environment.NewLine;

    if( NeedEncodingCheck )
    {
        int Start = NewLine.IndexOf( "charset=" );
        if( Start > 0 )
        {
            Start += "charset=\"".Length;   
            int End = NewLine.IndexOfAny( new[] { ' ', '\"', ';' }, Start );

            Reader = new StreamReader( ResponseStream, Encoding.GetEncoding(
                NewLine.Substring( Start, End - Start ) ) ); // Replace Reader with new encoding.

            NeedEncodingCheck = false;
        }
    }
}

Reader.Close();
Response.Close(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-25T14:10:42.310

我在强大的协议分析器 WireShark 的帮助下研究了同样的问题。我认为 httpWebResponse 类存在一些设计缺陷。实际上，整个消息实体是在你第一次调用 HttpWebRequest 类的 GetResponse() 方法时下载的，但是框架没有地方在 HttpWebResponse 类或其他地方保存数据，导致你必须获取响应流第二次。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-19T04:59:38.200

从 WebRequest 请求网页“www.google.fr”时仍然存在一些问题。

我用 Fiddler 检查了原始请求和响应。问题来自谷歌服务器。响应 HTTP 标头设置为 charset=ISO-8859-1，文本本身使用 ISO-8859-1 编码，而 HTML 表示 charset=UTF-8。这是不连贯的并导致编码错误。

经过多次测试，我设法找到了解决方法。只需添加：

```
myHttpWebRequest.UserAgent = "Mozilla/5.0"; 
```

到您的代码，Google Response 将神奇地完全变成 UTF-8。

# c# - WPF 引发异常解析 XAML，其中包括 Winforms 用户控件

> ID：227581
> 
> 赞同：7
> 
> 时间：2008-10-22T21:18:40.753
> 
> 标签：c#, wpf, winforms, xaml, user-controls

我有一个 WPF 应用程序，它使用了我使用 C++/CLI 创建的 Winforms 用户控件。当我的应用程序为我的主窗口解析 XAML 时，它会引发异常。该信息似乎有些缩写，但它说：

```
A first chance exception of type 'System.Windows.Markup.XamlParseException' occurred in PresentationFramework.dll

Additional information:   is not a valid Win32 application. (Exception from HRESULT: 0x800700C1)  Error in markup file 'OsgViewer;component/osgviewerwin.xaml' Line 1 Position 9. 
```

我在 XAML 中注释掉了我的 Winforms 控件，一切正常。我想也许我的控件的构造函数做错了，所以我在其中设置了一个断点，但是当我开始运行应用程序时断点似乎没有启用，并且从未被命中，我理解这意味着 DLL包含该行的内容未加载。当实例化 DLL 中的某个类型的对象时，这很可能会导致引发异常 - 找不到对象的构造函数的主体。

我过去在一个不同的项目上成功地做到了这一点，所以我从该应用程序中提取了一个不同的 WinForms 用户控件，并在 XAML 中对其进行了实例化，一切正常。

所以它在这个 DLL 中。我在我的 WPF C# 应用程序中引用了 DLL，当我在对象浏览器中加载 DLL 时，所有必需的类和命名空间都显示得很好。该应用程序编译良好，问题只是在解析 XAML 时出现。有人见过这样的东西吗？关于可能导致这种情况的任何想法？调试思路呢？谢谢！

```
<Window x:Class="OsgViewer.OsgViewerWin"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:int="clr-namespace:System.Windows.Forms.Integration;assembly=WindowsFormsIntegration"
    xmlns:myns="clr-namespace:MyGlobalNS.MyNS;assembly=MyAssembly"
...
        <int:WindowsFormsHost x:Name="m_Host">
            <myns:CMyClass  x:Name="m_MyClass" />
        </int:WindowsFormsHost>
...
</window> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-23T09:14:00.310

我遇到过这样的问题（但不是完全相同的错误消息）。似乎 WPF 无法实例化您的 Winforms 用户控件。

挑战在于找出原因。以下是我的建议，您可以尝试：

1.  检查您是否启用了非托管调试（在项目属性 -> 调试中）
2.  Find out if there are any dependencies your C++/CLI DLL where the Winforms control is implemented and if those dependencies cannot be resolved.
    In order to find out dependencies on native DLLs, you should use the tool [Dependency Walker (depends.exe)](http://www.dependencywalker.com/). .NET Reflector will only examine managed dependencies.
3.  Comment out code of your Winforms User Control step by step and try again.
4.  Use Gflags.exe to turn on *Loader Snaps* (cf. [Debugging LoadLibrary Failures](http://blogs.msdn.com/junfeng/archive/2006/11/20/debugging-loadlibrary-failures.aspx))

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-27T17:39:38.400

I've seen this problem when trying to use boost::threads. To support thread-local storage, boost::threads makes some Win32 API call that is incompatible with CLI applications. The problem gets triggered if you try to #include something from threads in CLI code.

Solution is to either avoid using boost::threads entirely or restrict its use to .cpp files in native code.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-19T13:07:56.580

I had simular symptoms and my problem was that the C# project was set to use Any CPU while the C++ project was set to use x86\. To set both to use x86 solved the problem

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T15:52:47.900

I also had this problem and all I had to do was go into the project properties>Security and click the This is a full trust application. I ran my project again and it worked!

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-16T06:40:41.557

Are you sure that you have the dll either in the system32 folder or in the same folder with the exe. I got the exactly same error message when running a WPF project built with CLI dll while the dll was located in the different folder.

mike

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-09T20:58:18.653

I also had this execption message, but my solutions was changing the order of XAML elments. I was using a XmlDataProvider and displaying the content in a listbox. I just put the XmlDataProvider before the ListBox.

# scripting - 您是否应该在开发组中标准化脚本语言？

> ID：227585
> 
> 赞同：4
> 
> 时间：2008-10-22T21:19:23.793
> 
> 标签：scripting

在工作中，我们编写少量到中等数量的脚本来帮助我们进行正常开发。我们有一些人更擅长 python，一些人更擅长 perl，一些人更擅长 php，等等......

有时我认为最好让人们使用他们最熟悉的语言工作。这可能意味着有时人们可以在脚本上做得更好（因为他们知道一种语言的更多技巧）。它还可以减少每个脚本的开发时间。

其他时候，我认为我们将从标准化中受益最多，这样可能会有更多的共享库，这样我们就不会陷入“我无法处理那个脚本，因为我不知道 python”的情况。

你认为我们应该标准化还是让人们为他们编写的每个脚本进行选择？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T21:21:48.437

我倾向于让人们选择，*并*雇佣那些乐于学习新事物的人。对于一个优秀的开发人员来说，获得几乎任何语言的基本流利程度应该很容易。而对于原作者离我们不远的小剧本，就更简单了。

当然，上面的第二部分是困难的部分。但您最终会得到一个更灵活、知识更渊博的团队。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T21:36:45.147

我会提倡对几种语言进行标准化。“你应该使用 Python、Perl 或 Ruby。不是 Rexx、PHP、NewBatch 或其他任何东西，因为你的兄弟们应该能够阅读你的作品而不会过度绝望或割伤他们的皮肤”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T21:23:58.620

我的观点是，它就像任何其他开发环境一样。您是否对一种开发语言进行标准化？为什么？您的脚本环境也应该如此。我不仅倾向于对特定语言进行标准化，而且我认为您应该标准化您希望在编程环境中做的所有事情（命名约定、编码风格等）。当然，也有反对的论点，偶尔也会有例外，但希望它们很少，而且有正当的理由。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T21:24:43.593

就像所有事情一样，有好处也有坏处。

作为一名开发人员，我不喜欢受到“官方公司标准”的限制。这些规则往往会限制和扼杀。

我认为最重要的是始终有两个可以读写脚本语言的员工，这样一个人就可以去度假或生病而不会耽误工作。

对于您系统的主要组件，最好将其标准化为一种语言——尽管这么说让我很痛苦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T21:44:48.610

我认为问这个问题的正确地方是你自己的团队。

您的团队应该就他们是否想要一个通用平台或是否想要自由选择适合工作的工具达成共识。这个问题没有单一的最佳答案，就像“什么是最好的脚本语言”一样，没有单一的最佳答案。

当然，每种方法都有其优点。如果每个团队成员都可以自由选择自己的语言，他们可能会更有效率，您的企业也会从中受益。另一方面，如果有人用只有她知道的语言编写了一个关键工具，然后她发生了一些事情（疾病、新工作等），你可能会陷入没有人知道如何解决的单点故障。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T22:38:51.323

只要有问题的语言用于脚本，我同意其他评论者的意见，即应该留给开发团队，并且在大多数情况下应该容忍不同的语言。

如果该语言用于您的主要代码库，则最好将其标准化。

如果一些开发人员抱怨脚本不是用他们的语言编写的，鼓励他们学习它，特别是如果它是 Ruby、Perl 等广泛使用的脚本之一。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T21:22:10.060

不。

您的开发环境希望是一个不断变化和培养的生物。应该能够适应新的能力（脚本语言），而多年未访问的旧地方有一天会被工具消除，或者不时重新访问并进行评估。希望开发脚本是少量的开发和自动化。团队很有可能会朝着一组标准（ant、python 等）漂移。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T23:39:59.280

对于每个项目，签入的任何内容都应该遵循最低复杂性的规则。

你的团队总有一天会离开，其他人将不得不进来并维护它。请不要让他们学习 5 种语言，否则他们会在源代码中寻找你的名字并追捕你。

当我们拿起这样的黑客项目时，我们几乎认为创作者完全是傻瓜并取笑他们。他们懒得去学习一种脚本语言？？？

也就是说，如果你不检查它——谁在乎呢？

# iphone - iPhone 应用程序的唯一标识符

> ID：227590
> 
> 赞同：31
> 
> 时间：2008-10-22T21:20:53.477
> 
> 标签：iphone, ios-simulator

对于将图像提交到服务器的 iPhone 应用程序，我需要以某种方式将来自特定手机的所有图像绑定在一起。每次提交时，我都想发送一些唯一的电话号码。看着

```
  [[UIDevice mainDevice] 唯一标识符]

和
  [[NSUserDefaults standardDefaults] stringForKey:@"SBFormattedPhoneNumber"]

```

但在模拟器中出现错误。

是否有苹果认可的方式来做到这一点？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-22T21:44:49.437

你得到什么错误？`[[UIDevice currentDevice] uniqueIdentifier]`（*已编辑以修复 API，感谢 Martin！*）是官方推荐的这样做方式。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-23T01:41:49.707

您还可以使用 CFUUID 生成 UUID。这是一些代码：

```
NSString *uuid = nil;
CFUUIDRef theUUID = CFUUIDCreate(kCFAllocatorDefault);
if (theUUID) {
  uuid = NSMakeCollectable(CFUUIDCreateString(kCFAllocatorDefault, theUUID));
  [uuid autorelease];
  CFRelease(theUUID);
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-04T03:21:24.933

到目前为止，获取唯一标识符最简单、最合适的方法是使用 Apple 明确提供的机制来获取 - `[[UIDevice currentDevice] uniqueIdentifier]`。您不能保证电话号码对于设备是唯一的，或者设备甚至会有电话号码。除此之外，这样做是一个可怕的想法，因为它肯定是对用户隐私的侵犯。`uniqueidentifier`如果您要以任何方式存储它，甚至应该对它进行哈希处理。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-12-30T07:04:08.510

为了保持您在安装之间创建的唯一标识符，您可以使用 Keychain [Made easy with SSKeychain](https://github.com/samsoffes/sskeychain)：只需按如下方式设置您的 UUID：

```
 [SSKeychain setPassword:@"Your UUID" forService:@"com.yourapp.yourcompany" account:@"user"]; 
```

然后在需要时再次调用它：

```
NSString *retrieveuuid = [SSKeychain passwordForService:@"com.yourapp.yourcompany" account:@"user"]; 
```

注意： **服务和帐户必须完全匹配**。

然后，如果应用程序被删除并重新安装，UUID 将在重新安装时保持不变。

如果您想跨设备共享此 UUID，请将您的应用设置为使用 iCloud。然后，您可以将 UUID 存储在 NSUserDefaults 中，与 KeyValueStore 同步，然后使用上面的代码在新设备钥匙串中设置 UUID。

如果我为以上所有内容键入代码，这个答案会变得非常长，但这里有大量示例代码可以解决所有问题。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-08-22T05:55:49.583

不要忘记在 iOS 5 中 uniqueIdentifier 将被弃用，你应该使用 CFUUID 而不是那个

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-10-11T03:13:41.577

有趣的是，Apple 已经弃用了 iOS 5 中的 uniqueIdentifier（如 gN0Me 所述）。这是相关的 TechCrunch 文章： [http ://techcrunch.com/2011/08/19/apple-ios-5-phasing-out-udid/](http://techcrunch.com/2011/08/19/apple-ios-5-phasing-out-udid/)

Apple 建议您不再唯一标识设备，而是标识*用户*。在大多数情况下，这是一个很好的建议，尽管在某些情况下仍需要**全局**唯一的设备 ID。这些场景在广告中很常见。因此，我编写了一个非常简单的插件库，它准确地复制了现有的行为。

在一个无耻的自我推销中，我将它链接在这里，希望有人觉得它有用。另外，我欢迎所有和任何反馈/批评： http: [//www.binpress.com/app/myid/591](http://www.binpress.com/app/myid/591)

不过，在您的特定情况下，我建议您跳过我的库提供的**全局**唯一 ID 功能，因为这对您的情况来说有点过分了。相反，我会生成一个简单的 CFUUID 并将其存储在 NSUserDefaults 中。此 ID 将特定于您的应用程序，但允许您在数据库中对“应用程序安装”的所有照片进行分组。

换句话说，通过弃用 uniqueIdentifier 方法，Apple 建议您不要识别每个设备，而是每个应用*安装*。除非您在特定条件下操作，否则*每个应用*ID 很可能更适合您的产品。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-26T21:05:48.567

这是一个有趣的问题，我也在寻求解决。这是我想解决的一个场景。

当您将手机卖给另一个人时会发生什么......然后该设备 ID 将属于其他人，因此即使该应用程序从 iPhone 中删除，它也可以重新添加，然后所有这些数据都将重新关联给新用户...这很糟糕。

使用带有设备 ID MD5 的电话号码将是一个很好的解决方案。我们想出的另一个方法是拥有一个 SQL Lite DB，其中包含一些使用设备 ID 散列的令牌。然后，当应用程序被删除时，数据库被杀死并且所有数据都被取消关联。我认为这可能太脆弱了。

还有其他想法吗？

Rob Ellis (PhoneGap/Nitobi)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-07-07T04:16:35.167

使用 Apple 的 GenericKeyChain 是最好的解决方案。这是工作示例>> [https://developer.apple.com/library/prerelease/ios/samplecode/GenericKeychain/Introduction/Intro.html](https://developer.apple.com/library/prerelease/ios/samplecode/GenericKeychain/Introduction/Intro.html)

了解 KeyChainAccess >> [https://developer.apple.com/library/mac/documentation/Security/Conceptual/keychainServConcepts/02concepts/concepts.html#//apple_ref/doc/uid/TP30000897-CH204-TP9](https://developer.apple.com/library/mac/documentation/Security/Conceptual/keychainServConcepts/02concepts/concepts.html#//apple_ref/doc/uid/TP30000897-CH204-TP9)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-22T21:25:12.063

还没有完成 iphone 的工作，但是如何对手机独有的东西进行哈希处理......哦，说电话号码？

[获取iphone号码](https://stackoverflow.com/questions/193182/programmatically-get-own-phone-number-in-iphone-os)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-26T14:33:20.493

片段：

```
NSString *phoneNumber = (NSString *) [[NSUserDefaults standardUserDefaults] objectForKey:@"SBFormattedPhoneNumber"]; // Will return null in simulator!
NSLog(@"Formatted phone number [%@]", phoneNumber); 
```

我 [最近] 在 OS 2.2.1 [和 OS 3.0] 上按原样运行此代码。

它在设备上运行时按预期工作，并返回我的电话号码以及完整的国际拨号代码 [在我的情况下为 1]。

在模拟器上运行时，值 [returned] 是一个空字符串，因此它只适用于实际的 iPhone 设备。

我没有在 iPod Touch 上测试它。

...

本周在不同的设备上运行此代码，并得到一个空值而不是数字。

经过进一步研究，此代码片段返回的数字似乎是在 iTunes 中为设备设置的数字。

如果您在设备激活时没有在 iTunes 中输入 iPhone 的号码，或者可能（在我的情况下）如果默认值不是 iPhone 的号码并且您仍然单击“确定”，这样 iTunes 不会列出电话号码您的 iPhone 已插入，此代码将返回一个空字符串。

[[以上是我最近在http://www.alexcurylo.com/blog/2008/11/15/snippet-phone-number/](http://www.alexcurylo.com/blog/2008/11/15/snippet-phone-number/])上发布的另一篇关于此主题的文章的评论串联]

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-01T15:21:26.217

[以下](http://www.innerfence.com/howto/find-iphone-unique-device-identifier-udid)是有关从 iTunes 获取它的方法的更多信息，这可能对测试有用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-24T14:54:48.743

我用这样的代码取得了成功：

```
- (NSString *)stringUniqueID {
    NSString *  result;
    CFUUIDRef   uuid;
    CFStringRef uuidStr;
    uuid = CFUUIDCreate(NULL);
    assert(uuid != NULL);
    uuidStr = CFUUIDCreateString(NULL, uuid);
    assert(uuidStr != NULL);
    result = [NSString stringWithFormat:@"%@", uuidStr];
    assert(result != nil);
    NSLog(@"UNIQUE ID %@", result);
    CFRelease(uuidStr);
    CFRelease(uuid);
    return result;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-09-03T07:49:11.287

您可以使用 MAC 地址作为唯一 ID。以下链接将为您提供帮助

[如何以编程方式获取 iphone 的 MAC 地址](https://stackoverflow.com/questions/677530/how-can-i-programmatically-get-the-mac-address-of-an-iphone)

# php - 需要从 mysql 帮助编译的数组

> ID：227596
> 
> 赞同：1
> 
> 时间：2008-10-22T21:22:43.037
> 
> 标签：php, mysql, database, arrays

这一直困扰着我，我无法理解它。我将使用食品类比来尝试简化我的问题。

1000 名公众成员被要求从 13 种脚垫中选择一种。这些选择然后根据他们的名字存储在一个 mysql 数据库中。

```
e.g.    billy   mary   etc.   etc.

milk....semi. .skimmed...

bread...white...brown....

cheese..edam.....edam....

fruit...apple...orange...

veg....potato...sprout...

meat....beef.....beef....

sweet..bonbons..liquorice..

fish...trout....salmon...

crisp....s&v....plain....

biscuit..hovis..rich tea..

wine.....red.....red.....

beer....stella..carlsburg..

carb....coke.....pepsi.... 
```

然后要求这 1000 个中的一个通过复选框选择从零到 13 的任何选项。

通过搜索数据库，有多少其他人选择了相同的品种？

显示在一个表格中，显示他们的所有名称以及他们为所有 13 个品种选择的内容。

那有意义吗？我希望如此，因为它让我发疯。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T22:39:00.077

假设你有一个简单的布局，那么你会有这样的东西（我将自己限制在三个类别中）：

```
PersonId  What_Milk  What_Bread  What_Cheese
       1  Semi       Wheat       Swiss
       2  Skimmed    Rolls       French
       3  Soy        Brown       Smelly
       4  Low Fat    Wheat       Swiss 
```

如果我理解正确，你的问题是这样的：

当第 4 个人被要求选择 0 .. 3 个她的食物时，她可以选择“面包”和“奶酪”复选框，这意味着查询应该产生第 1 个人作为匹配项。正确的？

```
SELECT
  PersonId,
  What_Milk,
  What_Bread,
  What_Cheese
FROM
  FoodPreference
WHERE
  PersonId != ?
  AND What_Milk   = IFNULL(NULLIF(?, ''), What_Milk)
  AND What_Bread  = IFNULL(NULLIF(?, ''), What_Bread)
  AND What_Cheese = IFNULL(NULLIF(?, ''), What_Cheese) 
```

您的复选框值稍后将转到问号占位符所在的位置。（*我已经用 IFNULL/NULLIF 替换了以前的 CASE WHEN 结构，它具有相同的效果，但对 PHP 准备好的语句更友好。*）

如果未选中复选框（从而将值固定为某物），则将相应的列与其自身进行比较。这意味着它的值不会影响结果。如果其他列匹配，则将选择该行。

这也意味着如果用户选择了*零*个复选框，则将返回*所有行。*一个人选择的食物越多，匹配就越接近。

在 PHP 中，我建议您使用`mysqli_prepare()`从查询字符串创建准备好的语句，并将`mysqli_stmt_bind_param()`实际值绑定到问号占位符。这比直接构建 SQL 字符串要安全得多。[PHP 文档有很多关于 mysqli 的信息](http://de.php.net/manual/en/class.mysqli.php)，请看一下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T22:34:06.543

部分答案：

*   通过排序和连接组成一组线性选择
*   比较然后变成一个简单的 WHERE 子句

因此，您首先要进行计算，将字符串放入“milk|semi|skimmed”之类的字段中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T01:50:47.053

```
$sql = mysql_query("        
    SELECT  
    *
    FROM  ".$prefix."_users
    WHERE  username !='$username'  
    AND req_country   = IFNULL(NULLIF($bcountry, ''), req_country)  
    AND req_region  = IFNULL(NULLIF($bregion, ''), req_region)  
    AND req_type = IFNULL(NULLIF($btype, ''), req_type)
    AND req_beds = IFNULL(NULLIF($bbeds, ''), req_beds)
    AND req_value = IFNULL(NULLIF($bvalue, ''), req_value)
    AND country   = IFNULL(NULLIF($scountry, ''), country)  
    AND region  = IFNULL(NULLIF($sregion, ''), region)  
    AND type = IFNULL(NULLIF($stype, ''), type)
    AND beds = IFNULL(NULLIF($sbeds, ''), beds)
    AND value = IFNULL(NULLIF($svalue, ''), value)
    AND pool = IFNULL(NULLIF($spool, ''), 'Yes')
    AND garage = IFNULL(NULLIF($sgarage, ''), >0) 
            AND disabled = IFNULL(NULLIF($sdisabled, ''), 'Yes')");
$num = mysql_num_rows($sql);
echo "Total matches ($num): <br><br>";
        while($row = mysql_fetch_array($sql)){...etc 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T23:09:38.623

```
SELECT  
    PersonId,  
    milk,  
    bread,  
    cheese
FROM  FoodPreference
WHERE  PersonId != :chosen_person_id  
    AND $milk= CASE WHEN :isset($_POST["milk"]))> '' THEN :isset($_POST["milk"]))   ELSE milk END  
    AND $bread= CASE WHEN :isset($_POST["bread"]))> '' THEN :isset($_POST["bread"]))  ELSE bread END  
    AND $cheese= CASE WHEN :isset($_POST["cheese"]))> '' THEN :isset($_POST["cheese"])) ELSE cheese END 
```

我在正确的轨道上吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T00:31:04.810

好的，我发布了一个回复，但 Tomalak 非常正确地指出了一个逻辑缺陷。我会再尝试：

将类别列为 13 列的另一种方法是将它们列为表中的 13 行，如下所示：

```
CREATE TABLE FoodPreference (
  PersonID   INT NOT NULL REFERENCES People,
  FoodCat    VARCHAR(10) NOT NULL REFERENCES FoodCategories,
  FoodChoice VARCHAR(10) NOT NULL,
  PRIMARY KEY (PersonID, FoodCat)
);
INSERT INTO FoodPreference VALUES
  (123, 'bread', 'white'),
  (123, 'milk', 'skim'),
  (123, 'cheese', 'edam'), ...
  (321, 'bread', 'brown'),
  (321, 'milk', 'whole'),
  (321, 'cheese', 'edam'), ... 
```

然后，您可以使用如下查询，将所选人 (p1) 的任何行与另一个人 (p2) 的具有相同食物选择的行匹配，然后再匹配该人的所有其他选择 (p3)：

```
SELECT DISTINCT p3.*
FROM FoodPreference AS p1
  JOIN FoodPreference AS p2 
    ON (p1.FoodCat = p2.FoodCat AND p1.FoodChoice = p2.FoodChoice 
      AND p1.PersonID != p2.PersonID)
  JOIN FoodPreference AS p3 
    ON (p2.PersonID = p3.PersonID AND p2.FoodCat != p3.FoodCat)
WHERE p1.PersonID = {(int)$chosen_person_id}
  AND p1.FoodCat IN ('milk', 'bread', 'cheese'); 
```

WHERE 子句中的列表 'milk'、'bread'、'cheese' 是您需要根据`$_POST`应用程序中的变量在 PHP 代码中构建的内容。如果选中了一个复选框，请将该食物类别包括在列表中。

```
<?php
$food_cat_array = array("'none'");
$legal_food_cats = array('milk'=>1, 'bread'=>1, 'cheese'=>1, ...);
foreach (array_intersect_key($_POST, $legal_food_cats) as $key => $checked) {
  if ($checked) {
    $food_cat_array[] = "'$key'"; 
  }
}
$in_predicate = join(',', $food_cat_array); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T23:25:51.040

```
case "display_results":

if ($bcountry = !isset($_POST["bcountry"])){
      $bcountry = "No";
      }else {
      $bcountry = "Yes";
      }
if ($bregion = !isset($_POST["bregion"])){
      $bregion = "No";
      }else {
      $bregion = "Yes";
      }
if ($btype = !isset($_POST["btype"])){
      $btype = "No";
      }else {
      $btype = "Yes";
      }
if ($bbeds = !isset($_POST["bbeds"])){
      $bbeds = "No";
      }else {
      $bbeds = "Yes";
      }
if ($bvalue = !isset($_POST["bvalue"])){
      $bvalue = "No";
      }else {
      $bvalue = "Yes";
      }
if ($scountry = !isset($_POST["scountry"])){
      $scountry = "No";
      }else {
      $scountry = "Yes";
      }
if ($sregion = !isset($_POST["sregion"])){
      $sregion = "No";
      }else {
      $sregion = "Yes";
      }
if ($stype = !isset($_POST["stype"])){
      $stype = "No";
      }else {
      $stype = "Yes";
      }
if ($sbeds = !isset($_POST["sbeds"])){
      $sbeds = "No";
      }else {
      $sbeds = "Yes";
      }
if ($svalue = !isset($_POST["svalue"])){
      $svalue = "No";
      }else {
      $svalue = "Yes";
      }
if ($spool = !isset($_POST["spool"])){
      $spool = "No";
      }else {
      $spool = "Yes";
      }
if ($sgarage = !isset($_POST["sgarage"])){
      $sgarage = "No";
      }else {
      $sgarage = "Yes";
      }
if ($sdisabled = !isset($_POST["sdisabled"])){
      $sdisabled = "No";
      }else {
      $sdisabled = "Yes";
      }

     $result = mysql_query("SELECT * FROM  ".$prefix."_users WHERE  username!='$username' 
AND (('$bcountry'='Yes' AND req_country= '$country') OR ('$bcountry'='No')) 
AND (('$bregion'='Yes' AND req_region= '$region') OR ('$bregion'='No'))
AND (('$btype'='Yes' AND req_type= '$type') OR ('$btype'='No'))
AND (('$bbeds'='Yes' AND req_beds= '$beds') OR ('$bbeds'='No'))
AND (('$bvalue'='Yes' AND req_value= '$value') OR ('$bvalue'='No'))
AND (('$scountry'='Yes' AND country= '$req_country') OR ('$scountry'='No'))
AND (('$sregion'='Yes' AND region= '$req_region') OR ('$sregion'='No'))
AND (('$stype'='Yes' AND type= '$req_type') OR ('$stype'='No'))
AND (('$sbeds'='Yes' AND beds= '$req_beds') OR ('$sbeds'='No'))
AND (('$svalue'='Yes' AND value= '$req_value') OR ('$svalue'='No'))
AND (('$spool'='Yes' AND pool= 'Yes') OR ('$spool'='No'))
AND (('$sgarage'='Yes' AND garage>=1 ) OR ('$sgarage'='No'))
AND (('$sdisabled'='Yes' AND disabled= 'Yes') OR ('$sdisabled'='No'))
")or die("MySQL ERROR: ".mysql_error());
$number = mysql_num_rows($result); 
```

# c# - 将 RAW 图像文件作为 GDI+ 位图读取

> ID：227604
> 
> 赞同：10
> 
> 时间：2008-10-22T21:24:21.800
> 
> 标签：c#, asp.net, .net, gdi+, dng

有没有一种将 RAW 图像文件（尤其是 Canon CR2 和 Adob​​e DNG 文件）作为 GDI+ 位图读取的好方法，而且速度相当快？

我发现了一个在 WPF 下运行的示例，该示例将使用任何已安装的图像编解码器读取图像，然后将其显示在图像控件中。我修改了这个示例，通过将 WPF 图像写入 MemoryStream 并从中创建位图来创建 GDI+ 位图。但是这个过程很慢！慢得可怕！在我的电脑上打开一张简单的图片大约需要 10 秒。此解决方案还需要对 WPF 程序集的引用，这感觉不对，尤其是因为我想在 ASP.NET 项目中运行代码。

有些程序会对图像进行批量转换，但我更喜欢在请求时动态转换图像。

那么，有什么建议吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T21:55:15.577

免责声明：我在 Atalasoft 工作。

我们的[DotImage Photo Pro](http://www.atalasoft.com/products/dotimage)产品可以做到这一点。如果您想尝试自己做，请考虑包装开源 DCRaw 或看看 Paint.NET 是如何做到的（我认为有一个 RAW 插件）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T09:07:43.520

DotImage Photo Pro 组件运行良好，但我在使用它从原始文件中提取预览图像时遇到了问题。这也超出了我对这个项目的预算。

[但是，我在这里](http://paintdotnet.forumer.com/viewtopic.php?f=16&t=3759)找到了 Paint.NET 的 RAW 插件的代码，它很容易适应我的需求。该插件运行 DCRaw 可执行文件 ussign并从流中`Process.Start`读取其输出。`StandardOutput`相当简单和快速！:-)

编辑：

该插件的链接不再起作用，但这是我用来提取图像的代码。以下代码提取存储在原始文件中的 jpg-preview。如果你想要完整的图像，你应该删除 -e 参数。但请注意，对于某些相机，您将获得 GDI+ 无法读取的 ppm 图像。

```
public Stream GetImageData(string inputFile, string dcRawExe)
{

    var startInfo = new ProcessStartInfo(dcRawExe)
    {
        Arguments = "-c -e \"" + inputFile + "\"",
        RedirectStandardOutput = true,
        UseShellExecute = false
    };

    var process = Process.Start(startInfo);

    var image = Image.FromStream(process.StandardOutput.BaseStream);

    var memoryStream = new MemoryStream();
    image.Save(memoryStream, ImageFormat.Png);

    return memoryStream;
} 
```

此外，您还需要一份 DCRaw 的副本。我使用了这个站点的 DcrawMS.exe：http: [//www.insflug.org/raw/Downloads/](http://www.insflug.org/raw/Downloads/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-23T14:06:43.267

这是 dcraw 的 C# 端口，虽然它相当旧（v8.88），但可以适应更新的佳能模型：
[https ://sourceforge.net/projects/dcrawnet/](https://sourceforge.net/projects/dcrawnet/)

**编辑：**
我刚刚让它在我自己的项目中工作，用于从 RAW 文件中读取 EXIF 数据：

1.  打开项目属性并将*输出类型*设置为*类库*。
2.  重新编译。
3.  在您自己的项目中添加对 DLL 的引用。
4.  `using dcraw;`在顶部添加。
5.  声明这些代码行：

    ```
    DcRawState state = new DcRawState();
    state.inFilename = filename;
    state.ifp = new RawStream(filename);

    Identifier id = new Identifier(state);
    id.identify(state.ifp); 
    ```

现在检查**状态**内的所有好东西（假设您的 RAW 文件受支持并且没有导致异常；）

# java - 接受 05/05/1999 和 5/5/1999 等的日期时间解析

> ID：227608
> 
> 赞同：4
> 
> 时间：2008-10-22T21:26:10.800
> 
> 标签：java, date, time, parsing

有没有一种简单的方法来解析可能在 MM/DD/yyyy 或 M/D/yyyy 或某种组合中的日期？即，在一位数的日期或月份之前，零是可选的。

要手动完成，可以使用：

```
String[] dateFields = dateString.split("/");
int month = Integer.parseInt(dateFields[0]);
int day = Integer.parseInt(dateFields[1]);
int year = Integer.parseInt(dateFields[2]); 
```

并通过以下方式验证：

```
dateString.matches("\\d\\d?/\\d\\d?/\\d\\d\\d\\d") 
```

是否有调用 SimpleDateFormat 或 JodaTime 来处理这个问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-22T21:31:25.267

是的，使用 setLenient：

```
DateFormat df = new SimpleDateFormat("MM/dd/yyyy");
df.setLenient(true);
System.out.println(df.parse("05/05/1999"));
System.out.println(df.parse("5/5/1999")); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-10-29T04:12:20.947

# java.time

Java 8 及更高版本包括 java.time 框架。该框架淘汰了此处其他答案中讨论的旧 java.util.Date/.Calendar 类。

java.time.format 包及其 java.time.format.DateTimeFormatter 类使用的模式代码类似于Ray Myers[接受的答案中所见的模式代码。](https://stackoverflow.com/a/228356/642706)虽然相似，但它们略有不同。特别是他们对重复字符的数量非常严格。如果你说`MM`，那么月份必须填充零，否则你会得到[DateTimeParseException](http://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeParseException.html)。如果月份数字可能有也可能没有填充零，只需使用单字符`M`.

在此示例代码中，请注意输入字符串的月份编号如何填充零，而月份编号则没有。两者都由单字符模式处理。

```
DateTimeFormatter formatter = DateTimeFormatter.ofPattern ( "M/d/yyyy" );
LocalDate localDate = formatter.parse ( "01/2/2015" , LocalDate :: from ); 
```

转储到控制台。

```
System.out.println ( "localDate: " + localDate ); 
```

> 本地日期：2015-01-02

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T02:35:25.887

看起来我的问题是使用“MM/DD/yyyy”，而我应该使用“MM/dd/yyyy”。大写的**D**是“年中的日”，而小写的**d**是“月中的日”。

```
new SimpleDateFormat("MM/dd/yyyy").parse(dateString); 
```

做这项工作。此外，“M/d/y”可以互换使用。仔细阅读[SimpleDateFormat API 文档](http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html)会发现以下内容：

“对于解析，模式字母的数量被忽略，除非需要分隔两个相邻的字段。”

# c# - 为什么 Columns.Insert 不更新 DataGridView (C#) 中的 DisplayIndex？

> ID：227612
> 
> 赞同：0
> 
> 时间：2008-10-22T21:27:07.553
> 
> 标签：c#, datagridview

我以编程方式在 DataGridView 中插入一列（即，未绑定到任何数据表/数据库），如下所示：

```
int lastIndex = m_DGV.Columns.Count - 1;  // Count = 4 in this case
DataGridViewTextBoxColumn col = (DataGridViewTextBoxColumn)m_DGV.Columns[lastIndex];
m_DGV.Columns.RemoveAt(lastIndex);
m_DGV.Columns.Insert(insertIndex, col);  // insertIndex = 2 
```

我发现有时使用这种方法我的列在视觉上是乱序的。一种解决方法是事后手动设置列的 DisplayIndex 属性。添加此代码“修复它”，但我不明白它为什么会这样。

```
Console.Write(m_DGV.Columns[0].DisplayIndex); // Has value of 0
Console.Write(m_DGV.Columns[1].DisplayIndex); // Has value of 1
Console.Write(m_DGV.Columns[2].DisplayIndex); // Has value of 3
Console.Write(m_DGV.Columns[3].DisplayIndex); // Has value of 2
col.DisplayIndex = insertIndex;
Console.Write(m_DGV.Columns[0].DisplayIndex); // Has value of 0
Console.Write(m_DGV.Columns[1].DisplayIndex); // Has value of 1
Console.Write(m_DGV.Columns[2].DisplayIndex); // Has value of 2
Console.Write(m_DGV.Columns[3].DisplayIndex); // Has value of 3 
```

顺便说一句，我的网格可以动态增加其列数。我想以块的形式增长它，所以每个插入不需要列分配（和相关的初始化）。然后将通过从末尾抓取未使用的列，将其插入所需位置并使其可见来添加每个“新”列。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T21:55:15.810

我怀疑这是因为 DataGridView 中列的顺序不一定决定显示顺序，尽管默认情况下没有明确指定列的顺序决定了 DisplayIndex 属性值。这就是为什么有一个 DisplayIndex 属性，因此您可以在不执行插入的情况下将列添加到集合中 - 您只需要指定 DisplayIndex 值，并且对于具有相等或更大 DisplayIndex 的所有内容都会发生级联更新。从您的示例中可以看出，插入的列也收到了第一个跳过的 DisplayIndex 值。

从我发现[的问题/答案中：](http://www.themssforum.com/Csharp/DataGridView-DisplayIndex/)

> 更改 DisplayIndex 将导致旧 DisplayIndex 和新 DisplayIndex 之间的所有列移动。

与几乎所有集合（LinkedLists 除外）一样，添加到集合中总是[比插入](http://www.dotnetperls.com/Content/List-Insert.aspx)集合中更好。您所看到的行为反映了该规则。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T09:00:57.023

我有几个想法。

1.  使用唯一名称而不是集合中的索引来寻址您的列怎么样？他们可能还没有名字，但如果你给他们一个有意义的名字，你可以跟踪谁是谁。

2.  您可以使用该类的`GetFirstColumn`, `GetNextColumn`, `GetPreviousColumn`,`GetLastColumn`方法`DataGridViewColumnCollection`，这些方法适用于显示顺序，而不是集合中的顺序。您也可以使用 for 循环遍历集合，`m_DGV.Columns[i]`直到找到所需的集合。

3.  创建一个继承的`DataGridView`and `DataGridViewColumnCollection`。简单地被覆盖以使用您的`DataGridView`新集合类。您的 new`DataGridViewColumnCollection`将包括一种通过显示索引来处理集合的方法，大概是通过迭代集合直到找到您想要的那个（参见＃2）。或者，您可以保存字典并为大量列保持更新。

    我怀疑保留字典会提高性能，因为每次移动列时，您基本上都必须重写整个内容。无论如何，迭代都是 O(n) ，除非您正在谈论具有数百列的异步操作，否则您可能没问题。

    假设它不会`this[]`搞砸`DataGridView`.

想法 #1 可能是最容易实现的，但不一定是最漂亮的。想法 #2 有效，你可以把它放在一个函数`DataGridViewColumn GetColumnByDisplayIndex(int Index)`中。想法#3 很可爱，当然也是最封装的方法，但也不是微不足道的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T19:40:41.347

感谢 cfeduke 的出色建议。我怀疑`Insert`会慢一些，但提供的链接让我知道慢了多少。

这就提出了如何在 DataGridView 上有效地动态插入和删除列的问题。看起来理想的设计是使用`Add`or添加大量列`AddRange`，然后永远不要真正删除它们。然后，您可以通过将该`Visible`属性设置为 false 来模拟删除。您可以通过抓取一个不可见的列、设置它`DisplayIndex`并使其可见来插入一个列。

但是，我怀疑这种方法会避免地雷。最重要的是，您不能再以直接的方式索引您的数据。也就是说，`m_DGV.Columns[i]`并且`m_DGV.Rows[n].Cells[i]`不会正确映射。我想你可以创建一个地图/字典来维护一个外部直观的映射。

由于我的应用程序（按照目前的设计）需要频繁的列插入和删除，因此它可能是值得的。有人有什么建议吗？

# perl - 如何递归复制目录并在 Perl 中过滤文件名？

> ID：227613
> 
> 赞同：12
> 
> 时间：2008-10-22T21:27:23.293
> 
> 标签：perl, recursion, directory, copy

如何复制包含子目录的目录，不包括与 Windows 系统上的某个正则表达式匹配的文件或目录？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-22T23:41:43.583

我会做这样的事情：

```
use File::Copy;
sub copy_recursively {
    my ($from_dir, $to_dir, $regex) = @_;
    opendir my($dh), $from_dir or die "Could not open dir '$from_dir': $!";
    for my $entry (readdir $dh) {
        next if $entry =~ /$regex/;
        my $source = "$from_dir/$entry";
        my $destination = "$to_dir/$entry";
        if (-d $source) {
            mkdir $destination or die "mkdir '$destination' failed: $!" if not -e $destination;
            copy_recursively($source, $destination, $regex);
        } else {
            copy($source, $destination) or die "copy failed: $!";
        }
    }
    closedir $dh;
    return;
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-22T22:00:53.210

另一个选项是 File::Xcopy。顾名思义，它或多或少地模拟了 windows xcopy 命令，包括其过滤和递归选项。

从文档中：

```
 use File::Xcopy;

    my $fx = new File::Xcopy; 
    $fx->from_dir("/from/dir");
    $fx->to_dir("/to/dir");
    $fx->fn_pat('(\.pl|\.txt)$');  # files with pl & txt extensions
    $fx->param('s',1);             # search recursively to sub dirs
    $fx->param('verbose',1);       # search recursively to sub dirs
    $fx->param('log_file','/my/log/file.log');
    my ($sr, $rr) = $fx->get_stat; 
    $fx->xcopy;                    # or
    $fx->execute('copy'); 

    # the same with short name
    $fx->xcp("from_dir", "to_dir", "file_name_pattern"); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-22T21:52:22.087

如果你碰巧在一个类 Unix 操作系统上并且可以访问`rsync (1)`，你应该使用它（例如通过`system()`）。

Perl 的 File::Copy 有点损坏（例如，它不会复制 Unix 系统上的权限），所以如果您不想使用系统工具，请查看 CPAN。也许[File::Copy::Recursive](http://search.cpan.org/perldoc?File::Copy::Recursive)可能有用，但我没有看到任何排除选项。我希望其他人有更好的主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T21:37:03.273

我不知道如何对副本进行排除，但您可以按照以下方式进行操作：

```
ls -R1 | grep -v <regex to exclude> | awk '{printf("cp %s /destination/path",$1)}' | /bin/sh 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T22:03:30.257

一个经典的答案是使用' `cpio -p`'：

```
(cd $SOURCE_DIR; find . -type f -print) |
perl -ne 'print unless m/<regex-goes-here>/' |
cpio -pd $TARGET_DIR 
```

' `cpio`' 命令处理实际的复制，包括权限保留。' ' 的技巧`cd $SOURCE_DIR; find . ...`处理从名称中删除源路径的前导部分。调用 ' ' 的唯一问题`find`是它不会遵循符号链接；`-follow`如果这是你想要的，你需要添加' '。

# desktop - 桌面应用的信用卡支付解决方案

> ID：227616
> 
> 赞同：5
> 
> 时间：2008-10-22T21:29:12.027
> 
> 标签：desktop, payment, credit-card

**关于网络**应用程序的支付处理器有很多问题，但我还没有看到桌面应用程序的问题。你有什么经验？

也许把它放在一个小背景下，要求：

1.  应该是可定制的
2.  如果不是在世界范围内（不太重要），至少应该在澳大利亚可用。
3.  不存储信用卡详细信息
4.  每次不同金额的经常性小额付款
5.  一键支付。用户可以在支付处理器提供商处注册。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T03:08:26.223

除非您正在寻找一个受伤的世界，否则您的客户端软件中不应该有信用卡处理代码！您可能希望拥有一个在线组件，它最好通过 HTTPS 请求响应您的客户端软件事件并处理付款。

您必须记住永远不要相信来自客户端计算机的任何业务决策/输入！否则，您可能会让自己受制于黑帽，他们会将您编码为功夫，让您破产。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T03:44:40.240

我想，小额支付有点把事情搞砸了，但为什么不使用 bpay 呢？澳大利亚的每个人都知道并信任 bpay，我认为：[http ://www.bpay.com.au/](http://www.bpay.com.au/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T23:32:43.307

时代可能会发生变化，但我认为您无法获得以上所有内容。

几年前，我确实有一些在北美使用信用卡的经验。当时我工作的公司需要每月支付不同金额的定期账单（很像您的要求）。当时，我调查过的供应商中没有一家允许在金额不同的情况下进行经常性付款。这可能已经改变，但我不知道其中之一。

我怀疑您的选择是存储信用卡并处理您自己的交易（不是太难，但您必须小心行走）或使用固定金额的定期计费。

# mstest - MSTest 可以在每次启动时运行特定的方法吗？

> ID：227621
> 
> 赞同：6
> 
> 时间：2008-10-22T21:30:31.477
> 
> 标签：mstest

**问题**

有没有一种方法可以在测试程序集通过 MSTest 运行时*始终运行？*

类似于 [TestInitialize] 和 [ClassInitialize] 属性的工作方式，但适用于整个程序集。我不想向每个测试类的 [ClassInitialize] 方法添加代码。

**推理**

我的一些测试与数据库交互。他们删除对生产数据库非常有害的数据和其他内容。只有一个配置文件告诉我的单元测试项目针对非生产数据库运行。

如果有一种在启动时运行的方法会说“好的，数据库名称不是‘生产’”，我会感觉更好

**想法**

Log4Net 使用程序集属性来配置自身。

```
using log4net.Config;
[assembly: XmlConfigurator()] 
```

也许我可以做一些类似的事情？

```
[assembly:  CheckDatabaseNameNot("production")] 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T21:34:22.047

您是否尝试过 [AssemblyInitialize]？

# ajax - 返回 JSON 或部分 html 的 ASP.NET MVC 控制器操作

> ID：227624
> 
> 赞同：430
> 
> 时间：2008-10-22T21:31:05.827
> 
> 标签：ajax, asp.net-mvc, json, asp.net-ajax

我正在尝试创建控制器操作，该操作将根据参数返回 JSON 或部分 html。将结果异步返回到 MVC 页面的最佳方法是什么？

* * *

## 回答 #1

> 赞同：545
> 
> 时间：2008-10-22T21:38:33.177

在您的操作方法中，返回 Json(object) 以将 JSON 返回到您的页面。

```
public ActionResult SomeActionMethod() {
  return Json(new {foo="bar", baz="Blech"});
} 
```

然后只需使用 Ajax 调用操作方法。您可以使用 ViewPage 中的一种辅助方法，例如

```
<%= Ajax.ActionLink("SomeActionMethod", new AjaxOptions {OnSuccess="somemethod"}) %> 
```

SomeMethod 将是一个 javascript 方法，然后评估返回的 Json 对象。

如果要返回纯字符串，只需使用 ContentResult：

```
public ActionResult SomeActionMethod() {
    return Content("hello world!");
} 
```

ContentResult 默认返回 text/plain 作为其 contentType。
这是可重载的，因此您还可以执行以下操作：

```
return Content("<xml>This is poorly formatted xml.</xml>", "text/xml"); 
```

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2009-09-29T14:38:38.313

I think you should consider the AcceptTypes of the request. I am using it in my current project to return the correct content type as follows.

Your action on the controller can test it as on the request object

```
if (Request.AcceptTypes.Contains("text/html")) {
   return View();
}
else if (Request.AcceptTypes.Contains("application/json"))
{
   return Json( new { id=1, value="new" } );
}
else if (Request.AcceptTypes.Contains("application/xml") || 
         Request.AcceptTypes.Contains("text/xml"))
{
   //
} 
```

You can then implement the aspx of the view to cater for the partial xhtml response case.

Then in jQuery you can fetch it passing the type parameter as json:

```
$.get(url, null, function(data, textStatus) {
        console.log('got %o with status %s', data, textStatus);
        }, "json"); // or xml, html, script, json, jsonp or text 
```

Hope this helps James

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2008-10-22T22:08:09.670

另一种处理 JSON 数据的好方法是使用 JQuery getJSON 函数。您可以致电

```
public ActionResult SomeActionMethod(int id) 
{ 
    return Json(new {foo="bar", baz="Blech"});
} 
```

Method from the jquery getJSON method by simply...

```
$.getJSON("../SomeActionMethod", { id: someId },
    function(data) {
        alert(data.foo);
        alert(data.baz);
    }
); 
```

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2013-07-18T22:14:38.307

I found a couple of issues implementing MVC ajax GET calls with JQuery that caused me headaches so sharing solutions here.

1.  Make sure to include the data type "json" in the ajax call. This will automatically parse the returned JSON object for you (given the server returns valid json).
2.  Include the `JsonRequestBehavior.AllowGet`; without this MVC was returning a HTTP 500 error (with `dataType: json` specified on the client).
3.  Add `cache: false` to the $.ajax call, otherwise you will ultimately get HTTP 304 responses (instead of HTTP 200 responses) and the server will not process your request.
4.  Finally, the json is case sensitive, so the casing of the elements needs to match on the server side and client side.

Sample JQuery:

```
$.ajax({
  type: 'get',
  dataType: 'json',
  cache: false,
  url: '/MyController/MyMethod',
  data: { keyid: 1, newval: 10 },
  success: function (response, textStatus, jqXHR) {
    alert(parseInt(response.oldval) + ' changed to ' + newval);                                    
  },
  error: function(jqXHR, textStatus, errorThrown) {
    alert('Error - ' + errorThrown);
  }
}); 
```

Sample MVC code:

```
[HttpGet]
public ActionResult MyMethod(int keyid, int newval)
{
  var oldval = 0;

  using (var db = new MyContext())
  {
    var dbRecord = db.MyTable.Where(t => t.keyid == keyid).FirstOrDefault();

    if (dbRecord != null)
    {
      oldval = dbRecord.TheValue;
      dbRecord.TheValue = newval;
      db.SaveChanges();
    }
  }

    return Json(new { success = true, oldval = oldval},
                JsonRequestBehavior.AllowGet);
} 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-23T01:25:39.817

To answer the other half of the question, you can call:

```
return PartialView("viewname"); 
```

when you want to return partial HTML. You'll just have to find some way to decide whether the request wants JSON or HTML, perhaps based on a URL part/parameter.

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-05-06T06:39:03.307

Alternative solution with [incoding framework](https://incframework.codeplex.com/)

Action return json

**Controller**

```
 [HttpGet]
    public ActionResult SomeActionMethod()
    {
        return IncJson(new SomeVm(){Id = 1,Name ="Inc"});
    } 
```

**Razor page**

```
@using (var template = Html.Incoding().ScriptTemplate<SomeVm>("tmplId"))
{
    using (var each = template.ForEach())
    {
        <span> Id: @each.For(r=>r.Id) Name: @each.For(r=>r.Name)</span>
    }
}

@(Html.When(JqueryBind.InitIncoding)
  .Do()
  .AjaxGet(Url.Action("SomeActionMethod","SomeContoller"))
  .OnSuccess(dsl => dsl.Self().Core()
                              .Insert
                              .WithTemplate(Selector.Jquery.Id("tmplId"))
                              .Html())
  .AsHtmlAttributes()
  .ToDiv()) 
```

Action return html

**Controller**

```
 [HttpGet]
    public ActionResult SomeActionMethod()
    {
        return IncView();
    } 
```

**Razor page**

```
@(Html.When(JqueryBind.InitIncoding)
  .Do()
  .AjaxGet(Url.Action("SomeActionMethod","SomeContoller"))
  .OnSuccess(dsl => dsl.Self().Core().Insert.Html())
  .AsHtmlAttributes()
  .ToDiv()) 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-01-12T00:50:22.540

You may want to take a look at this very helpful article which covers this very nicely!

Just thought it might help people searching for a good solution to this problem.

[http://weblogs.asp.net/rashid/archive/2009/04/15/adaptive-rendering-in-asp-net-mvc.aspx](http://weblogs.asp.net/rashid/archive/2009/04/15/adaptive-rendering-in-asp-net-mvc.aspx)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2017-08-08T05:35:38.450

PartialViewResult and JSONReuslt inherit from the base class ActionResult. so if return type is decided dynamically declare method output as ActionResult.

```
public ActionResult DynamicReturnType(string parameter)
        {
            if (parameter == "JSON")
                return Json("<JSON>", JsonRequestBehavior.AllowGet);
            else if (parameter == "PartialView")
                return PartialView("<ViewName>");
            else
                return null;

        } 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-03-17T10:19:30.670

For folks who have upgraded to MVC 3 here is a neat way [Using MVC3 and Json](http://geekswithblogs.net/michelotti/archive/2008/06/28/mvc-json---jsonresult-and-jquery.aspx)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-09-07T11:13:25.347

```
 public ActionResult GetExcelColumn()
    {            
            List<string> lstAppendColumn = new List<string>();
            lstAppendColumn.Add("First");
            lstAppendColumn.Add("Second");
            lstAppendColumn.Add("Third");
  return Json(new { lstAppendColumn = lstAppendColumn,  Status = "Success" }, JsonRequestBehavior.AllowGet);
            }
        } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-03-28T09:35:43.620

Flexible approach to produce different outputs based on the request

```
public class AuctionsController : Controller
{
  public ActionResult Auction(long id)
  {
    var db = new DataContext();
    var auction = db.Auctions.Find(id);

    // Respond to AJAX requests
    if (Request.IsAjaxRequest())
      return PartialView("Auction", auction);

    // Respond to JSON requests
    if (Request.IsJsonRequest())
      return Json(auction);

    // Default to a "normal" view with layout
    return View("Auction", auction);
  }
} 
```

The `Request.IsAjaxRequest()` method is quite simple: it merely checks the HTTP headers for the incoming request to see if the value of the X-Requested-With header is `XMLHttpRequest`, which is automatically appended by most browsers and AJAX frameworks.

Custom extension method to check whether the request is for json or not so that we can call it from anywhere, just like the Request.IsAjaxRequest() extension method:

```
using System;
using System.Web;

public static class JsonRequestExtensions
{
  public static bool IsJsonRequest(this HttpRequestBase request)
  {
    return string.Equals(request["format"], "json");
  }
} 
```

Source : [https://www.safaribooksonline.com/library/view/programming-aspnet-mvc/9781449321932/ch06.html#_javascript_rendering](https://www.safaribooksonline.com/library/view/programming-aspnet-mvc/9781449321932/ch06.html#_javascript_rendering)

# c - Fortran 数组到 C 数组。需要愚蠢的宏观技巧

> ID：227627
> 
> 赞同：4
> 
> 时间：2008-10-22T21:32:13.500
> 
> 标签：c, arrays, c-preprocessor

我有这个“简化”的 fortran 代码

```
real B(100, 200) 
real A(100,200)

... initialize B array code.

do I = 1, 100
  do J = 1, 200
    A(J,I) = B(J,I)
  end do
end do 
```

一位编程大师警告我，fortran 按列顺序有效访问数据，而 c 按行顺序有效访问数据。他建议我仔细查看代码，并准备好切换循环以保持旧程序的速度。

作为一个懒惰的程序员，我认识到所涉及的时间以及我可能犯的错误，我开始想知道是否有一种#define 技术可以让我安全、轻松地转换这段代码。

你有什么建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T21:43:48.517

您确定您的 FORTRAN 人员做对了吗？

您最初发布的代码片段已经以行优先顺序访问数组（这对于 FORTRAN 来说是“低效的”，对于 C 来说是“高效的”）。

如代码片段所示以及您的问题中提到的那样，获得此“正确”可能容易出错。担心首先将 FORTRAN 代码移植到 C 中，而不用担心这样的细节。当端口工作时 - 然后您可以担心将列顺序访问更改为行顺序访问（如果在端口工作后它甚至真的很重要）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-23T14:23:10.030

在 C 中，多维数组的工作方式如下：

```
#define array_length(a) (sizeof(a)/sizeof((a)[0]))
float a[100][200];
a[x][y] == ((float *)a)[array_length(a[0])*x + y]; 
```

换句话说，它们是真正的平面数组，`[][]`只是语法糖。

假设你这样做：

```
#define at(a, i, j) ((typeof(**(a)) *)a)[(i) + array_length((a)[0])*(j)]
float a[100][200];
float b[100][200];
for (i = 0; i < 100; i++)
    for (j = 0; j < 200; j++)
        at(a, j, i) = at(b, j, i); 
```

您正在按顺序浏览记忆，并假装它`a`实际上`b`是按列主要顺序排列的。这有点可怕`a[x][y] != at(a, x, y) != a[y][x]`，但只要你记得它是这样被骗的，你就没事了。

## 编辑

伙计，我觉得自己很笨。这个定义的目的是使`at(a, x, y) == at[y][x]`，它确实如此。所以更简单，更容易理解

```
#define at(a, i, j) (a)[j][i] 
```

会比我上面建议的更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T21:54:53.753

我大学毕业后的第一份编程工作是修复一个从 FORTRAN 移植的长期运行的 C 应用程序。阵列比您的阵列大得多，每次运行大约需要 27 小时。修好后，它们在大约 2.5 小时内运行……非常甜蜜！

*（好吧，确实没有分配，但我很好奇，发现他们的代码有一个大问题。尽管有这个修复，一些老前辈还是不太喜欢我。）*

似乎在这里发现了同样的问题。

```
real B(100, 200) 
real A(100,200)

... initialize B array code.

do I = 1, 100
  do J = 1, 200
    A(I,J) = B(I,J)
  end do
end do 
```

您的循环（要成为好的 FORTRAN）将是：

```
real B(100, 200) 
real A(100,200)

... initialize B array code.

do J = 1, 200
  do I = 1, 100
    A(I,J) = B(I,J)
  end do
end do 
```

否则，您将在行优先的数组中前进，这可能会非常低效。

至少我相信在 FORTRAN 中会是这样——已经很久了。

* * *

看到你更新了代码...

现在，您需要交换循环控制变量，以便在行上迭代，然后在转换为 C 时在列内迭代。

# language-agnostic - 网站启动通常对您来说有多顺利？

> ID：227628
> 
> 赞同：4
> 
> 时间：2008-10-22T21:32:38.913
> 
> 标签：language-agnostic

我和我的同事昨天正在讨论这个问题。似乎无论我们准备得多么好，无论我们进行多少测试，无论客户在网站公开之前说什么，初始网站启动似乎总是有些困难。有些客户比其他客户更好，但通常在测试期间还不错的事情在网站公开时突然出现可怕的错误。

这是一种常见的体验吗？我不只是在谈论功能崩溃（尽管这通常也是一个问题）。我还谈到了完全按照我们希望的方式工作的网站，但在网站公开时突然让客户不满意。我说的是在大部分开发过程中熟悉该网站的客户。这意味着，公开发布绝对不是他们第一次看到该网站。

如果你以前处理过这个问题，你有没有找到改善这种情况的方法？或者这只是一件总会有问题的事情吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T21:42:38.020

不用担心。这是完全和完全正常的，并且发生在每个软件中。任何可能出错的事情都会出错，而开发过程中最不稳定的实体，客户端，将成为这些事情的原因。

你可以做世界上所有的需求收集，写一份 100 页的提案，每小时提供项目截图和更新，但客户仍然不会批准。就个人而言，我觉得互联网是最糟糕的媒介之一，因为现在设计更加自由流动，客户总是在他/她的脑海里有一个特定的画面；一个看起来不像成品的。

我发现具有明确阶段和签字表的**防弹接触是处理这种情况的最佳方式。**假设您的工作已签订合同，您应确保在每个阶段向客户展示工作并被迫批准所做的每一项更改。至少这样，如果客户想要更改某些内容，您可以告诉他们他们已经签署了该部分，并且额外的工作将花费他们额外的费用（也在合同中定义）。

这种方法不仅对我有用，而且让客户停下来思考他/她真正想要什么。对我来说幸运的是，我的许多客户已经以技术为导向，所以他们明白这些事情可能需要时间，但那些对 Web 开发一无所知的人希望事情在几天内变得完美。只要您确保合同中涵盖了所有内容，客户就会考虑他们想要什么，并且不会在之后的问题上纠缠您。

当然，您在质量控制方面可以做的任何事情都会很棒，并有助于项目顺利进行。还要确保在项目之前计划出某种形式的方法，并且客户知道这种方法。通常，基本领域的改变可能代价高昂，而且许多客户似乎没有意识到一个小的改变可能需要改变很多东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T21:40:06.870

是的，在我们的项目中多次看到这一点（人类是善变的）。

在这些情况下对我们有帮助的是一个可以处理客户的优秀 PM/客户经理，这使得事情在技术层面上有点可以忍受。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T21:38:44.783

网站启动对我们来说通常相当顺利。当然，我们会进行广泛的验证，包括代码检查、部署到原型服务器（与我们的生产服务器相同）以及大量文档。

每次发布后，我们都会开会讨论什么进展顺利，什么进展不顺利，以便我们可以调整我们的整体流程和最知名的方法文档。

至于在最后一刻改变主意的客户......叹息......我们通过让他们签署测试版来最大限度地减少这种情况。这样，项目启动时就没有分歧。如果有分歧，总会有下一个版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T21:55:40.273

对于它的价值，我所做的最后一次网站启动顺利进行。现在，它不是一个高流量的网站，而且我最终修复了一些错误，但在实际发布当天没有任何问题。

这是一个 ASP.NET/C# 站点。它不是非常大或非常复杂，但也不是微不足道的。可能最值得注意的是它 100% 由我自己设计、实现和测试，从数据库模式一直到 CSS。这也是我第一次使用 ASP.NET。开发过程中有很多颠簸，但当我发布它时，我已经对它们非常熟悉，所以知道会发生什么。

我认为从中吸取的教训是要有良好的前期设计、扎实的实施技能和良好的测试，并且新站点不必是一场噩梦。至少有*可能*顺利启动。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T21:59:49.483

我不会将您的陈述仅限于网站。多年来，我从事过很多项目，并且在上线时总会有一些细节会被“发现”。再多的测试也无法消除所有可能发生的有趣事情。

我要说的一件事是，您在新系统“上线”的最初几个小时内学到的东西比在开发过程中学到的所有东西都更有价值。真正酷的问题和场景出现的时候到了。学会爱他们，并将这些时间用作下一次的学习点。然后每次都会很有趣！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T22:03:54.607

我们过去经常遇到这个问题，但最近少了很多。

对我们来说，部分原因在于更牢固的项目管理和记录规范（如此处其他答案中所建议的那样），但我相信更多的区别来自：

*   *期望管理 - 让客户接受迭代更改在发布后*仍然可以预期，这是正常的，不用担心
*   增加权威 - 我们现在是一个成熟的（13 年）网络开发人员，我们可以用很多专业知识说话
*   只是更有经验 - 我们现在可以提前预测大多数可能出现的查询，并解决它们，减轻它们或将它们引起客户的注意，这样它们就不会在当天刺痛我们

另外，我们很少做大张旗鼓的发布——软发布可以减轻压力。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T22:12:24.403

我的经验是，网站启动几乎总是困难重重。对于这个共同的事实，我只有两个例外。第一个是为一个人经营的小企业开发的网站。这很顺利，因为只有一个人可以取悦，所以很容易跟踪他们想要什么。另一个是一家财富 500 强公司推出的价值数百万美元的网站。这碰巧进展顺利，因为那里有 2 个 PM 和一小群顾问来管理客户的需求。再加上一个月的直接应用程序负载测试和 1,000 名用户的测试版发布，这意味着当该网站最终“上线”时，我能够整晚睡上一觉（这相当罕见）。但是，这些情况都不构成当时的规范。当然，有'

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T22:28:38.210

我相信您可以找出总是潜入的错误类型，例如，它是由于相当*肤浅*的测试造成的吗？例如，随机点击并检查事情是否正确。

为了改进，我提出以下建议：

*   创建指定所有测试程序的文件/清单。
*   让*普通人*进行测试，而不仅仅是构建应用程序的人。
*   *设置一个与生产*非常相似的登台环境。
*   发布后，分析出了什么问题以及为什么出了问题。
*   也许让外部质量检查来检查您的程序。

现在，所有这些建议当然非常明显，但将它们实施到您的启动程序中需要时间。

总的来说，这确实是一个持续的过程，它将帮助您和您的同事改进。并且更快乐，因为修复生产中的错误只会让你快速老化。;-)

请记住，您不会第一次完成。文件很重，这就是人们不阅读它们的原因。人们也很懒惰，不遵守程序。这意味着您始终可以分析发生的情况，返回并改进程序。

如果你有机会，我也会花一些时间来看看为什么另一次发布没有出现任何问题，并将其与平常进行比较。

# svn - 通过 svnsync 复制 SVN 存储库时如何解决此错误？

> ID：227634
> 
> 赞同：3
> 
> 时间：2008-10-22T21:35:53.137
> 
> 标签：svn, svnsync

我正在使用 svnsync 复制存储库，并且每次都在同一修订版上收到此错误。

> 传输文件数据 ...svnsync：“ [https://svn1.avlux.net/xxxxxx.net](https://svn1.avlux.net/xxxxxx.net) ”的报告：无法读取响应正文：安全连接被截断[https://svn1.avlux.net](https://svn1.avlux.net)）

这是一个很大的修订，我没有对服务器的管理员访问权限。有没有办法解决这个问题，即使它涉及手动签出和复制修订版？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T03:20:02.443

您只是想复制一次 repo 还是尝试设置一个持续的镜像方案？

如果是前者，您可以让同步直到失败，然后在失败的修订版和之前的修订版之间进行比较，并将其输出到文件中。因此，如果失败的转速是 135，它将是这样的：

```
svn diff -r134:135 http://your/repo/url > patch.diff 
```

然后，您可以将此补丁文件应用于新存储库的工作副本。

```
patch -p0 -i patch.diff 
```

然后只需提交对该工作副本的更改并再次启动 svnsync。

这是相当骇人听闻的，但它可能会奏效。

注意：我没有测试任何命令，可能存在一些语法错误，但一般方法应该在理论上可行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-10-24T20:26:26.707

我设法通过以下方式解决了这个问题： - 更新（Apache 和 svn 到最新版本） - 打开 svn V2 协议（该位置下的 apache 配置） SVNAdvertiseV2Protocol On

# sql-server - 关于在MSSQL的标识列中跳过ID的问题

> ID：227650
> 
> 赞同：4
> 
> 时间：2008-10-22T21:44:16.520
> 
> 标签：sql-server, sql-server-2005, identity

假设我有一个包含两列的 MSSQL 表：一个作为标识列的 int ID 列和一些其他日期时间或任何列。假设该表有 10 条 ID 为 1-10 的记录。现在我删除 ID = 5 的记录。

是否有任何情况下另一条记录将“填写”缺少的 ID？即什么时候会插入一条记录并给定一个ID 5？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T21:50:00.097

不，除非您专门启用标识插入（通常在复制具有标识列的表时完成）并手动插入 id 为 5 的行。SQLServer 跟踪插入到具有标识列的每个表中的最后一个标识，并将最后插入的值增加到在插入时获得下一个值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T21:56:21.580

仅当您使用 SET IDENTITY_INSERT 命令手动关闭身份 ID，然后使用 ID=5 进行插入时

否则 MS-SQL 将始终递增到更高的数字，并且永远不会重新使用丢失的插槽。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T09:21:36.003

尚未提及另一条记录将“填充”缺少的 IDENTITY 值的一种情况是重新播种 IDENTITY 时。示例（SQL Server 2008）：

```
CREATE TABLE Test 
(
   ID INTEGER IDENTITY(1, 1) NOT NULL, 
   data_col INTEGER NOT NULL
);

INSERT INTO Test (data_col) 
   VALUES (1), (2), (3), (4);

DELETE
  FROM Test 
 WHERE ID BETWEEN 2 AND 3;

DBCC CHECKIDENT ('Test', RESEED, 1)

INSERT INTO Test (data_col) 
   VALUES (5), (6), (7), (8);

SELECT T1.ID, T1.data_col 
  FROM Test AS T1
 ORDER 
    BY data_col; 
```

结果是：

```
ID  data_col
1   1
4   4
2   5
3   6
4   7
5   8 
```

这表明，不仅“空洞”填充了新的自动生成的值，而且在重新播种之前自动生成的值被重新使用，甚至可以复制现有的 IDENTITY 值。

# java - Beanshell catch(ex)：异常还是 Throwable？

> ID：227667
> 
> 赞同：4
> 
> 时间：2008-10-22T21:49:09.333
> 
> 标签：java, exception, beanshell

beanshell catch(ex) 捕获什么类型的异常：Exception 还是 Throwable？

例子：

```
try {
    .... } catch (ex) {     } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-24T02:14:53.057

那个松散类型的 catch 将捕获所有“ [Throwable](http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html) ”。这将包括[Errors](http://java.sun.com/javase/6/docs/api/java/lang/Error.html)，[Exceptions](http://java.sun.com/javase/6/docs/api/java/lang/Exception.html)和他们无数的孩子。您可以通过以下方式轻松确认：

```
try {
  new Throwable("Something Exceptional");
} catch (ex) {
  System.err.println(ex.getMessage());
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T23:32:24.477

Throwable （本质上）是 Exception 的超类——Exception 捕获的任何东西也将被 Throwable 捕获。在一般用法中它们是相同的，你很少（如果有的话）看到其他可抛出类型。

# flash - 在 Flash 9、Actionscript 3 中播放短声音的延迟

> ID：227674
> 
> 赞同：6
> 
> 时间：2008-10-22T21:52:18.640
> 
> 标签：flash, actionscript-3, audio

我有一些非常短的音频剪辑（不到一秒长）要在各种事件（按钮悬停、单击等）上播放。但是，动作和声音的实际播放之间通常存在明显的滞后。我尝试将声音嵌入到 .swf 中，并在开始时将其从外部加载，但都导致相同的结果。同样，我尝试过压缩和未压缩的音频。

看起来*是*音频缓冲区比我需要的要长得多，就像 Flash 可能更优化以播放更长的声音而不会出现任何口吃，但代价是开始声音的延迟时间更长。会是这样吗？有什么办法可以改变它们吗？由于我正在做的工作永远不需要播放声音超过一秒左右，并且总是会在开始时完全加载，因此拥有非常短的缓冲区根本不会造成伤害。

另一个可能的原因是：如果我在使用 loadSound() 时使用 .wav 文件...我无法让它真正播放声音。没有错误，一切都按原样返回，但没有播放实际的声音，这就是我目前将它们作为 .mp3 的原因。也许在使用 .mp3 音频（或任何压缩音频）时，解码时会有延迟？不过，我对此仍有疑问的原因是，当将它们作为 .wav 文件嵌入到 .swf 中时（通过将它们导入库中），它们在播放时仍然具有相同的延迟。

只是为了进行完整性检查，我将包含我拥有的代码，减去不相关的部分和错误检查。首先，在运行时加载它们：

```
var soundArray:Array = new Array();
loadSound( "click", "sounds/buttondroop4.mp3" );
loadSound( "hover", "sounds/Dink-Public_D-146.mp3" );

function loadSound( name:String, url:String ):void
{
   var req:URLRequest = new URLRequest( url );
   soundArray[ name ] = new Sound( req );
   soundArray[ name ].addEventListener( Event.COMPLETE, soundLoaded );
}
function soundLoaded( event:Event ):void
{
   for( var name:String in soundArray )
   {
      if( event.target == soundArray[name] )
      {
         trace( "Loaded sound [" + name + "]" );
         return;
      }
   }
}
function playSound( name:String ):void
{
   for( var nameSrc:String in soundArray )
   {
      if( name == nameSrc )
      {
         var channel:SoundChannel = soundArray[ name ].play();
         return;
      }
   }
}

// Sometime later, well after soundLoaded() callback is triggered...
playSound( "click" );
playSound( "hover" ); 
```

还有一种替代方法，将它们作为类嵌入到库中并从那里开始：

```
var sClick:soundClick = new soundClick();
var sHover:soundHover = new soundHover();
sClick.play();
sHover.play(); 
```

声音文件很小，一般小于 10kb。滞后很明显，以至于有人在看到它时首先抱怨的一个是按钮悬停时的声音效果似乎延迟了，所以不仅仅是我很挑剔。我觉得我一定是做错了什么；那里有太多闪光的东西，它们具有快速的声音效果，而没有任何接近这种滞后的地方。

编辑：为了响应关于声音文件本身的第一个响应，我已经检查过了，声音在文件的开头立即开始（即使剪掉除了声音的第一毫秒之外的所有内容，我仍然可以听到开始它发出的“滴答”声）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-26T16:10:18.167

这是一件小事，但是：

```
function playSound( name:String ):void
{
   for( var nameSrc:String in soundArray )
   {
      if( name == nameSrc )
      {
         var channel:SoundChannel = soundArray[ name ].play();
         return;
      }
   }
} 
```

应该：

```
function playSound(name:String):void
{
    if(soundArray[name])
    {
        soundArray[name].play();
    }
} 
```

不需要循环查找，因为这就是哈希表的用途。此外，您根本不应该使用 Array ，因为 Array 是使用整数索引的有序集。在这种情况下，您想使用一个对象（或字典）并将其命名为 soundMap（因为它将声音名称映射到声音对象）。

至于声音延迟——应该没有。我已经在 Flash 中制作了相当多的声音（包括大量的翻转和推出声音），这从来都不是问题。然而，Flash Player 10 有一个新[的低级声音 API](http://www.kaourantin.net/2008/05/adobe-is-making-some-noise-part-1.html)，该 API 的一位 Adob​​e 工程师在该文章中进行了描述。涉及到的解决方案有点像大锤，但也许您正在寻找毫秒精度。

fenomas 给出的建议是明智的：检查 mp3 文件的开头和结尾是否有死区，并尽可能将其修剪。另外 - 从事件处理程序到您的播放语句的路径是什么？那里有任何可能的障碍吗？mp3的格式是什么？Flash 最适合特定编码（我相信 44.1 hHz 和 128 位）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-23T02:55:27.513

嗯，我第一个脸红的回答是，当我完成这样的事情时，通常我会发现声音文件有一定的前置时间。你可以检查声音编辑器，但我在过去是将声音导入Flash IDE，制作一个空的影片剪辑，将声音放在剪辑的第1帧。然后，但编辑帧声音，你会得到一个漂亮的小界面来拖动声音播放的开始/结束点。然后我过去常常附加/删除剪辑以播放声音，或者将其留在某处并使用帧命令。

如果您已经确定前置时间是 Flash 而不是音频，那么我没有任何提示或技巧，除了相当明显的事情，例如在按键按下而不是向上播放点击声音......

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T17:24:16.430

我*遇到*了完全相同的问题...直到我注意到该问题仅在 Flash 中预览时才发生。尝试运行已编译的 swf（它对我有用）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-08-25T13:13:00.120

我有同样的问题。遇到了这个。显然，如果您让声音播放器在后台静默“运行”，则不需要为小声音“重新启动”。还没试过。。。

[http://www.ghostwire.com/blog/archives/as3-fixing-the-lag-that-arises-when-playing-a-short-sound-effect/](http://www.ghostwire.com/blog/archives/as3-fixing-the-lag-that-arises-when-playing-a-short-sound-effect/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-08-31T19:36:44.407

一种解决方案可能是使用将声音文件作为二进制数据读取的 ActionScript 库。

常设
[波 https://github.com/maxl0rd/standingwave3](https://github.com/maxl0rd/standingwave3)
[http://maxl0rd.github.com/standingwave3/](http://maxl0rd.github.com/standingwave3/)

此外，请务必检查 SWF 周围环境的音频设置。我调试了我的应用程序几个小时，直到意识到延迟来自我的蓝牙耳机连接。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-19T00:58:23.303

我在使用 Flash Player 10.0.2.x 时声音延迟很差（大约 1 整秒）。停止声道时的潜伏期相同。

我刚刚升级到 10.0.22.x，问题就消失了。

# c# - 面向业余爱好者的 OOP 和数据表

> ID：227678
> 
> 赞同：0
> 
> 时间：2008-10-22T21:54:13.287
> 
> 标签：c#, oop, datatable

我完全是一个业余爱好者，正在编写一个小应用程序来跟踪文件夹中的变化。我想我将在绑定到网格视图的一个数据表中保存有关要观看的目录的信息，当用户单击按钮时，程序将创建 FileSystemWatchers 来关注目录，他们会将事件消息发送到另一个数据表绑定到另一个gridview。在广阔的 OOP 世界中，我应该在哪里声明、启动和操作数据表？主窗体，在主窗体中，在一个类中，还是我应该“放弃”并使用 Visual Studio 自动创建一个 DataSet 并在其中粘贴两个表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T22:20:11.703

好马的课程。对于一个小的实用程序应用程序，使用 VS“Visual/RAD”编程风格可能会更好。例如，将表格等拖放到表单上，就像大多数教程显示的那样。

严格来说，对于更大的应用程序，更正确的方法是制作一个单独的程序集（.dll）来处理数据访问，然后从主窗体调用该程序集中的类。这个概念有许多术语，但实际上你想分离你的关注点。换句话说，让 UI 处理 UI 交互，有一个单独的程序集/项目/处理数据库交互的任何东西，以及另一个单独的程序集/项目/处理业务逻辑等的东西。

最后几句话对不同的人可能意味着不同的事情，并且没有 100% 正确的做事方式。

一些可能有帮助的文章：

[链接文本](http://msdn.microsoft.com/en-us/library/ms973279.aspx)
[链接文本](http://channel9.msdn.com/posts/funkyonex/Building-N-Tier-Applications-in-Visual-Studio-2008/)
[链接文本](http://alt.pluralsight.com/drjoe/webcasts/webcasts.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T22:30:33.680

我同意 KiwiBastard 的观点：使用 VS 工具生成类型化的 DataSet 会给您带来很多好处。

不过，这只会生成类。您仍然必须管理 DataSet 的一个实例。对于一个非常简单的应用程序，我没有将 UI 和业务逻辑分解到不同的类中，我会在 Form.xml 中执行此操作。对于任何复杂的应用程序，它都是业务逻辑类的一部分。

可能会为您省去很多麻烦的事情：数据绑定很好，ADO 也很好，但是某些类型的 ADO 代码（特别是 DataTable 上的事件处理程序）不能很好地与数据绑定配合使用。如果您正在使用 BindingSources（实际上，您应该使用），那么当您以编程方式操作 DataSet 的对象时（例如，当您添加和删除行时），暂停绑定通常是一个好主意。暂停和恢复绑定的成本非常小，它消除了一整类极难诊断的问题。

# php - 吐出输入的表单

> ID：227701
> 
> 赞同：-2
> 
> 时间：2008-10-22T22:04:57.680
> 
> 标签：php, javascript, forms, templates

我一辈子都找不到不通过电子邮件发送您提交的结果的表单。

我正在寻找一种表格，我可以让用户输入简单的数据，然后我可以以不同的方式向他们吐出。如果他们提交 First 和 Last，我会吐出 FirstLast@domain.com 等内容。我愿意手动搜索代码来执行此操作，但我找不到一个简单的表单可以让我执行此操作。

**编辑：** PHP 或类似的简单语言。我以前从未接触过.NET。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T23:26:04.253

形式：

```
<form action="process.php" method="post">
    First: <input type="text" name="first" />
    Last: <input type="text" name="last" />
    <input type="submit" />
</form> 
```

下一页：

```
<?php

$first = $_POST['first'];
$last =  $_POST['last']

echo $first . "." . $last . "@domain.com";
?> 
```

有关更多示例和说明，请参见[http://www.w3schools.com/php/php_forms.asp](http://www.w3schools.com/php/php_forms.asp)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T23:35:25.717

无论您如何获得它，请*始终*记住**永远不要相信用户输入**。

```
<?php

$sfirst = htmlentities($_POST['first']);
$slast =  htmlentities($_POST['last']);

echo $first . "." . $last . "@domain.com";
?> 
```

此外，对最终结果运行验证器可能会有所帮助。但请不要编写您自己的电子邮件地址验证器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T22:09:06.517

你在什么语言/平台/环境中工作？

我猜你可能正在寻找一个托管脚本或网络表单（我想人们将托管网络到邮件脚本的方式），但我怀疑那里会有一个这样做的。

但是，如果您有特定的框架可以使用，例如 PHP 或 .net，请更新问题并让我们知道是哪一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T23:20:06.780

这么简单的东西甚至不需要服务器端支持。

```
<form onsubmit="magic(this);return false">
    <p><label>First <input name=first/></label>
    <p><label>Last <input name=last/></label>
    <input type="submit">

    <div id="output"></div>
</form>   

<script type="text/javascript">
    var output = document.getElementById('output');
    function toHTML(text)
    {
        return text.replace(/</g,'&lt;');
    }

    function magic(form)
    {
        output.innerHTML = toHTML(form.first.value + form.last.value) + '@domain.com';
    }
</script> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T08:05:13.317

如果我的问题正确，听起来这可能会满足您的需求..

**注意：**此 PHP 代码不需要知道提交给它的表单中的字段，它只是循环遍历所有字段，包括多选字段（如复选框），并吐出它们的值。

```
<?php
// loop through every form field
while( list( $field, $value ) = each( $_POST )) {
   // display values
   if( is_array( $value )) {
      // if checkbox (or other multiple value fields)
      while( list( $arrayField, $arrayValue ) = each( $value ) {
         echo "<p>" . $arrayValue . "</p>\n";
      }
   } else {
      echo "<p>" . $value . "</p>\n";
   }
}
?> 
```

# asp.net - 对单击 CheckboxList 中的 ListItems 做出反应

> ID：227708
> 
> 赞同：0
> 
> 时间：2008-10-22T22:09:18.077
> 
> 标签：asp.net, javascript

当用户选中或取消选中单个复选框项目时，我想将一些逻辑应用于包含 CheckBoxList 控件的页面。比如说，动态显示或隐藏相关控件。

我想出了一种使用 ASP.Net 2.0 回调机制 (AJAX) 的方法，并在代码隐藏中结合了客户端 Javascript 和服务器端逻辑。然而，这个解决方案不是很安全（即很可能存在时间问题）。它不可移植，因为代码需要知道单个项目的顺序 ID 等。

我想出的代码分为两个函数，一个处理`onclick`事件，另一个处理返回的回调字符串：

```
<script type="text/javascript">

function OnCheckBoxClicked()
{
    // gathers the semi-colon separated list of labels,
    // associated with the currently checked items

    var texts = '';

    // iterate over each individual checkbox item
    // items in a checkboxlist are sequential, so
    // stop iteration at the first missing sequence number

    for (var index = 0; index < 99; index++)
    {
        var checkbox = document.getElementById('ctl00_cphAdmin_cblCategories_' + index);
        if (checkbox == null)
            break;

        if (checkbox.checked)
        {

            // find label associated with the current checkbox item

            var labels = document.getElementsByTagName('label');
            for (var index_ = 0; index_ < labels.length; index_ ++)
            {
                if (labels[index_].htmlFor == checkbox.id)
                {
                    texts = texts + labels[index_].innerHTML + ';';
                    break;
                }
            }
        }
    }

    // perform callback request
    // result will be processed by the UpdateCheckBoxes function

    WebForm_DoCallback('__Page', '_checkbox' + texts, UpdateCheckBoxes, 'checkbox', null, true /* synchronous */);
}
</script> 
```

在此示例中，我的复选框匹配博客文章的类别。

我需要将生成的回调字符串处理为包含以分号分隔的复选框名称列表以选中/取消选中，以确保相关的父/子类别正确同步。该字符串由服务器上执行的逻辑产生。

在其他情况下，生成的回调字符串可能是别的东西。

```
<script type="text/javascript">

function UpdateCheckBoxes(returnmessage, context)
{
    if (returnmessage == null || returnmessage == '')
        return ;

    // iterate over each individual checkbox item
    // items in a checkboxlist are sequential, so
    // stop iteration at the first missing sequence number

    for (var index = 0; index < 99; index++)
    {
        var checkbox = document.getElementById('ctl00_cphAdmin_cblCategories_' + index);
        if (checkbox == null)
            break;

        // find label associated with the current checkbox item

        var label = '';
        var labels = document.getElementsByTagName('label');
        for (var index_ = 0; index_ < labels.length; index_ ++)
        {
            if (labels[index_].htmlFor == checkbox.id)
            {
                label = ';' + labels[index_].innerHTML + ';';
                break;
        }
    }

        // perform custom processing based on the contents
        // of the returned callback string

        // for instance, here we check whether the returnmessage
        // contains the string ';' + label + ';'

        if (returnmessage.indexOf(label, 1) > 0)
        {
            // do something
        }        
    }
}

</script> 
```

这个问题没有更优雅的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T03:35:04.690

我会做几件事。一，我会想出一种方法来传递需要传递回客户端 onclick 处理程序的值。根据您填充 CheckBoxList 的方式，这可能就像为该复选框添加一个“onclick”属性到 ListItem 一样简单，该复选框调用您的函数并分配给标签的值相同，例如“OnCheckBoxClicked(this,'Label') . 这将消除派生标签的需要，尽管如果您只是传递了对它的引用（或父级，可能取决于标签在输入之前或输入包含在其中）。

第二，我还将对其进行更改，使其仅传回正在单击的当前项目并一次处理一个。

假设您的复选框（渲染时）看起来像：

```
 <label for="something">CheckBox 1</label>
  <input type='checkbox' id='ctl00_....' value='1' onclick="OnCheckBoxClicked(this,'CheckBox_1');" /> 
```

您的函数可能如下所示：

```
function OnCheckBoxClicked(checkbox,identifier)
{
  // do something based on the checkbox clicked

  WebForm_DoCallback('__Page', identifer, UpdateCheckBoxes, {checkbox: checkbox.id, label: identifier } , null, true /* synchronous */);
}

function UpdateCheckBoxes(result,context)
{
   var checkbox = document.getElementById(context.checkbox);
   var identifier = context.label;

   if (result)  // AJAX method now returns true/false as context holds info on controls
   {
       ... do something...
   }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T03:43:59.977

您可以在 onclick() 事件的复选框控件中添加一个事件。并将控件的 id 作为参数发送，然后更新所需控件的属性

```
<input type='checkbox' id='ctl00_....' value='1' onclick="OnCheckBoxClicked('ctrl_toUpdateID');" />

<script type="text/javascript">

function OnCheckBoxClicked(ctrlID)
{
  var ctrl = document.getElementById(ctrlID);
  if(ctrl.getAttribute('disabled')
 ctrl.removeAttribute('disabled')
else
    ctrl.setAttribute('disabled','disabled')

}
</script> 
```

# mysql - 除了初始成本之外，在 .net 上使用 MySQL 而不是 MSQL 服务器还有其他好处吗？

> ID：227710
> 
> 赞同：5
> 
> 时间：2008-10-22T22:10:02.550
> 
> 标签：mysql, .net, sql-server

我都使用过，我发现 MySql 有几个令人沮丧的错误，对以下方面的支持有限：IDE 集成、分析、集成服务、报告，甚至缺乏像样的经理。MSSQL Server 的总拥有成本也被吹捧为低于 MySQL（.net 环境），但保持开放的心态，有人能指出 MySql 的任何杀手级功能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T22:18:39.057

我过去使用过 MySQL，最近使用的是 MSSQL，但我不记得 MySQL 有什么和 MSSQL 不能做的事情。

我认为 MySQL 最致命的特性是它的简单性。对于某些项目，您并不需要像 MSSQL 这样的庞大系统所拥有的所有功能。我有 UNIX 的传统，并且发现像 my.ini 这样的简单配置文件是 MySQL 的杀手级功能。

MySQL 的安全系统也不太健壮，但它使大多数应用程序的工作正常。从这个角度来看，我相信 MySQL 它本身就是杀手，并且应该保持这种状态，让年轻用户首先以简单的视角了解 RDBMS。如果您的项目变得足够大以至于您正在考虑切换到更强大的系统，那么 MSSQL 可能会出现。

这就是发生在我身上的事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T22:33:39.510

我能想到的唯一一件事就是锁定。SQLServer 传统上的锁定策略很差，这让很多人感到困惑。

最终，您应该使用自己喜欢的东西。它并不是说 MySQL 不足以与 MS SQL 竞争，例如。Slashdot 使用 MySQL，所以它在高扩展性能方面几乎没有问题。

不过，它的杀手锏在于它是免费的——您可以部署尽可能多的软件，而无需担心许可问题。这对于软件的传播比任何人想象的都更为重要。

（TCO 是一件很难计算的事情——而且只是从付费顾问和其他既得利益者那里得到的建议。忽略这一点。MSSQL 很昂贵，而 MySQL 是免费的。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T22:58:20.397

大约 6 年前，我使用 ASP 和 MySQL 作为数据库开发了一个自定义电子商务网站。当时 MySQL 显然是比 MSDE 更好的选择，MSDE 内置了节流功能，这让我非常担心使用 MySQL。此外，使用 MySQL 和 MSDE/SQL 之间的编码差异并没有那么大的差异或令人担忧。

现在这么多年过去了，我试图将代码转换为 .NET，甚至在从 CRLab 购买了商业 MySQL 驱动程序之后。我发现，正如您所暗示的，IDE 集成达不到标准。

我会说即使我们的数据库表接近 4GB，MySQL 也做得很好。因此，当我切换到 MSSQL 时，我必须继续使用 SQL Workstation 或更高版本 ($$$)，而不是使用具有 4gb 限制的 SQL Express。

我所有的经验都改变了我开发新网站的方式。现在，除非预计会有很多流量。我使用 VistaDB，然后根据需要升级到 SQL Server。[VistaDB](http://www.vistadb.com)的语法和数据源与 SQL Server 兼容。最好的部分是它只有一个用于数据库的文件和一个用于您的 bin 文件夹的 dll。

根据我在 ASP 和现在的 .NET 中使用 MySQL 的个人经验，这是我的两分钱。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-20T16:33:20.237

需要考虑的三点；不幸的是，前两个是矛盾的：

1) .NET 和 MySQL 的设计初衷不是相互交互，而且双方都没有官方支持。您总是会遇到尝试将它们一起使用的问题。

2) 如果脱离 Windows 的可移植性可能成为问题（许多 .NET 代码通过 Mono 在其他平台上运行得非常好），您将希望避免将自己锁定得太深到 MSSQL。这并不意味着不使用它，而是要小心不要过度依赖它的特殊怪癖。

3) TCO 只是一个流行词。当它被*你*以外的任何人计算时，这完全是胡说八道。没有人可以做出这样的计算并诚实地声称它在他们的特定环境之外具有任何相关性。有太多因素，其中大多数与工具可用性等完全无关。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T04:53:41.817

我经常使用 MSSQL、MySql 和 PostGres（使用 .net、java 和 PHP）。关于 MySQL（尤其是与 MSSQL 相比），我最喜欢的一件事是您可以轻松地运行和恢复完整的数据库备份。

MSSQL 使用 .bak 文件的模型非常丑陋且耗时（另一篇文章的主题。）但是如果你想做一些像自动化测试或自动化构建过程（包括从头开始构建数据库），MySQL 可以是一个更容易处理。

其他几点：

自早期以来，管理工具已经变得更好。

如果您对事务、约束等感兴趣。请确保您将表定义为使用 InnoDB 存储引擎（而不是为速度而设计的 MyISAM。）

我确实想念 MSSQL 的模式生成工具，但我认为那里有等效的工具。

我们使用 Linux 数据库服务器和窗口的 Web 服务器（用于 .net 应用程序）取得了巨大成功。

如果您使用的是 NHibernate 或其他一些非 MS 数据抽象层之类的东西，那么超越 MSSQL 的情况也更有说服力......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T03:05:04.373

我几乎 99% 的项目都在使用 MySQL 的社区版本。我喜欢 MySQL，因为我可以通过 Xcopy 进行部署，并且与其他“xcopy-able”数据库服务器相比功能强大。我还编写了一个包装器来启动和停止 MySQL 和 Apache（如 LAMP），但具有我自己的实现和附加功能

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-10-22T22:26:08.573

MySQL 的 TCO 可能较低，因为管理和配置比 MS SQL 让您完成大部分配置的 Spaghetti GUI 更简单和直接，必须挖掘数百个晦涩的属性对话框才能完成基本的管理任务。

根据我的经验，MS SQL 在一个领域明显优于 MySQL：

*   与其他技术集成。MS SQL 允许您使用 Oracle 和 MySQL 数据库来回复制，并提供 SSIS 用于执行来自其他数据库服务器的预定数据转换。

可能还有其他人，但我对他们没有经验。

# xml - 如何选择唯一节点

> ID：227711
> 
> 赞同：15
> 
> 时间：2008-10-22T22:10:20.040
> 
> 标签：xml, xslt

我发现[这个页面](http://www.jenitennison.com/xslt/grouping/muenchian.html)描述了 Muenchian 方法，但我认为我应用错了。

考虑这将返回一组年龄：

```
/doc/class/person/descriptive[(@name='age')]/value 
```

> 1..2..2..2..3..3..4..7

但我想要一个节点集，每个年龄只有一个节点。

> 1..2..3..4..7

其中每一个似乎都返回所有值，而不是唯一值：

```
/doc/class/person/descriptive[(@name='age')][not(value=preceding-sibling::value)]/value
/doc/class/person/descriptive[(@name='age')]/value[not(value=preceding-sibling::value)] 
```

我错过了什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-22T22:44:09.660

这是一个例子：

```
<root>
    <item type='test'>A</item>
    <item type='test'>B</item>
    <item type='test'>C</item>
    <item type='test'>A</item>
    <item type='other'>A</item>
    <item type='test'>B</item>
    <item type='other'>D</item>
    <item type=''>A</item>
</root> 
```

和 XPath：

```
//preceding::item/preceding::item[not(.=preceding-sibling::item)]/text() 
```

结果：ABCD

**编辑**：正如 mousio 评论的那样，如果它是唯一一次出现，则不会捕获列表中的最后一项。考虑到这一点和 Fëanor 的评论，这里有一个更好的解决方案：

```
/root/item[not(.=preceding-sibling::item)] 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-23T14:49:18.120

这是使用他的数据的 BQ 答案的 Muenchian 版本：

```
<?xml version="1.0"?>
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <xsl:output indent="yes" method="text"/>
  <xsl:key name="item-by-value" match="item" use="."/>

  <xsl:template match="/">
    <xsl:apply-templates select="/root/item"/>
  </xsl:template>

  <xsl:template match="item">
    <xsl:if test="generate-id() = generate-id(key('item-by-value', normalize-space(.)))">
      <xsl:value-of select="."/>
      <xsl:text>
</xsl:text>
    </xsl:if>
  </xsl:template>

  <xsl:template match="text()">
    <xsl:apply-templates/>
  </xsl:template>
</xsl:stylesheet> 
```

这种变换给出

A
B
C
D

1.  `key()`模板中的上述查找返回`item`一个节点集，其中包含`item`与上下文节点具有相同字符串值的所有元素。
2.  如果您将期望单个节点的函数应用于节点集，它将在该节点集中的第一个节点上运行。
3.  在单次通过文档期间，所有调用`generate-id()`都保证为给定节点生成相同的 ID。
4.  `key()`因此，如果上下文节点与调用返回的第一个节点相同，则测试为真。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-01-21T10:54:46.020

对于那些仍在 XSLT 中寻找不同选择的人：

使用 XSLT 2.0，您可以使用“distinct-values(/doc/class/person/descriptive[(@name='age')]/value)”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-11T00:08:14.307

Muenchian 方法使用键从节点集中创建唯一的项目列表。对于您的数据，密钥如下所示：

```
<!-- Set the name to whatever you want -->
<xsl:key name="PeopleAges" match="/doc/class/person/descriptive[@name = 'age']/value" use="." /> 
```

从那里，我会亲自使用`xsl:apply-templates`，但您可以在其他地方使用以下`select`属性：

```
<!-- you can change `apply-templates` to: `copy-of` or `for-each`. -->
<xsl:apply-templates select="/doc/class/person/descriptive[@name = 'age']/value[count(. | key('PeopleAges', .)[1]) = 1]" /> 
```

上面的随附匹配要简单得多：

```
<xsl:template match="person/descriptive[@name = 'age']/value">
    <strong>Age: </strong><xsl:value-of select="." />
</xsl:template> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T22:29:52.637

您不是在前一个值之后缺少对“描述性”的引用吗？如下所示：

```
/doc/class/person/descriptive[(@name='age')][not(value=preceding-sibling::descriptive[@name='age']/value)]/value 
```

（没有测试过）

# powershell - powershell 是否具有与 popen 等效的功能？

> ID：227717
> 
> 赞同：5
> 
> 时间：2008-10-22T22:12:04.093
> 
> 标签：powershell

我需要能够启动一个进程并将输出读入一个变量。然后根据命令的返回，我可以选择显示完整输出或仅显示选定的子集。

所以要清楚，我想启动一个基于文本的进程（实际上是 psexec）并将该命令（stdout、stderr 等）的输出读入一个变量，而不是直接输出到控制台。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T22:22:41.793

你遗漏了一些关于什么样的过程的细节，但我认为Powershell 团队博客中的[这篇文章](http://blogs.msdn.com/powershell/archive/2007/01/16/managing-processes-in-powershell.aspx)有你想做的任何事情，无论是在某处管道传输可执行文件的输出，还是利用`System.Diagnostics.Process`.

既然第二个选项听起来像您想要做的，您可以使用`ProcessStartInfo`该类`true`作为`RedirectStandardOutput`属性输入，然后从对象的`StandardOutput`属性中读取`Process`以对输出执行任何您想要的操作。 `StandardError`工作原理相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T22:36:18.067

就将内容读入变量而言，您应该能够执行类似的操作

```
$output = ps 
```

不过，这只会捕获标准输出，不会捕获详细、警告或错误流。您可以通过测试特殊变量来获得上一条命令的退出代码`$?`。

我认为更多信息将有助于提供更完整的答案，但希望这是您正在寻找的某种方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T23:22:56.227

[PowerShell 社区扩展](http://www.codeplex.com/PowerShellCX)包括Start **-Process**。这实际上返回一个**System.Diagnostics.Process**。

```
> $proc = Start-Process pslist -NoShellExecute 
```

但是，虽然这会返回**Process**对象，但它不允许您在执行之前重定向输出。为此，可以创建自己的流程并通过首先修改**ProcessStartInfo**成员来执行它：

```
> $proc = New-Object System.Diagnostics.Process
> $proc.StartInfo = New-Object System.Diagnostics.ProcessStartInfo("pslist.exe")
> $proc.StartInfo.CreateNoWindow = $true
> $proc.StartInfo.UseShellExecute = $false
> $proc.StartInfo.RedirectStandardOutput = $true
> $proc.Start()
> $proc.StandardOutput.ReadToEnd() 
```

# .net - 是否可以使用 MSBuild 构建带有 Crystal Reports 的 .NET 1.1 VB 项目？

> ID：227723
> 
> 赞同：2
> 
> 时间：2008-10-22T22:16:00.543
> 
> 标签：.net, msbuild, crystal-reports, windows-vista, .net-1.1

我有一个包含 Crystal Reports 文件的项目，如果我将其升级到 VS 2005 和 .NET 2.0，它似乎无法正确构建。我认为原因是新版本的水晶报表与旧的报表格式不兼容。由于我现在正在运行 Vista，而 .NET 2003 在 Vista 上无法正常工作，因此我希望能够使用 MSBuild 构建以 .NET 1.1 框架为目标。这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T01:47:03.690

.NET 1.1 不使用 MSBuild，但您可以将项目转换为 VS 2005，并使用称为[MSBee](http://www.codeplex.com/Wiki/View.aspx?ProjectName=MSBee)的东西将您的项目反向定位到 1.1 运行时。我从未尝试过，但这可能是你最好的选择。

# c# - 我应该动态重新创建 PDF，而不是将其存储在数据库或文件系统中吗？

> ID：227727
> 
> 赞同：6
> 
> 时间：2008-10-22T22:16:38.107
> 
> 标签：c#, asp.net, sql-server-2005, itext

我需要客户能够下载已发送给他们的信件的 PDF 格式。

我已经阅读了有关文档或图像的数据库与文件系统存储的线程，听起来确实像是共识是，对于不仅仅是几个图像，文件系统是要走的路。

我想知道的：

*   一个合理的替代方法是将信件详细信息存储在数据库中，并在请求时“即时”重新创建 PDF？
*   这种方法是优于还是劣于从文件系统中获取 PDF？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-22T22:25:08.170

如果是出于存档目的，我肯定会存储 PDF，因为将来您的 PDF 生成脚本可能会更改，然后这封信将与最初发送的不完全相同。客户会期望它完全一样。

哪种方法更好并不重要，有时最好选择哪种方法更安全。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T22:29:09.113

我会把它储存起来有两个原因

1) 如果您更改了生成 PDF 的方式，您可能不希望更改历史项目。如果你每次都生成它们，要么它们会改变，要么你需要保留兼容性代码来生成“旧式”记录

2) 磁盘空间便宜。用户的耐心不是。除非您真的迫切需要存储或提取存储空间比生成 PDF 更难，否则请善待您的用户并将其存储起来。

显然，如果您每小时从稀疏数据集中创建数千个这样的数据，您可能没有存储空间。但如果你有空间，我会投票支持“使用它”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T22:27:18.383

您必须保留发送给客户的信件记录是否有取证原因？如果您要即时重新生成，您怎么知道未来的代码更改不会重写这封信（或者，如果该信息用于诉讼，至少客户可以在法庭上提出该论点）......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T22:20:18.617

我倾向于说“这取决于”。

当一个文档被多次请求时，如果您在第一次请求时编写它并随后检索它，可能会节省很多。

OTOH 如果大多数对文档的请求都是一次性类型的，并且创建过程不会占用您的大部分服务器容量，那么即时将具有明显的优势。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T22:23:48.890

如果您使用的是 ASP.NET，为什么不缓存 PDF。如果您愿意，您的缓存可以存储在数据库中，或者只要您首先需要它就可以保留在内存中。[企业库](http://www.codeplex.com/entlib)在缓存应用程序块中为您实现了这一点，并且使用起来非常简单。如果您缓存对象，使用块在数据库中创建存储，然后在需要时加载它，您不必担心重新创建它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T22:26:21.457

需要考虑的几件事是，PDF 是基于某个时间点存在的数据生成的。EG 基于上个月数据的账单？

如果是这样，您会每个月使用相同的模板来生成这封信吗？如果/当字母格式发生变化时会发生什么，如果您即时重新生成它不再是发送给他们的相同。是否有可能将 PDF 流存储到数据库中？

我猜我在说什么，您是否需要准确表示发送给用户的内容，或者是否灵活？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T02:24:57.483

是动态生成 pdf 文件还是静态存储它们的问题听起来更像是一个法律问题，而不是编程问题。

如果您无法获得可以为此提供指导的法律顾问，那么谨慎行事并静态存储它们会更安全。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-23T08:18:36.753

只要**PDF 文档是永久性的**（不仅仅是工作文档，而是正式签署并发送到公司或公司外的其他地方），您应该在您的网络上拥有此 PDF 文件的副本，以及一个链接到数据库中的这个文件。

您不能依赖可用数据在不同时间复制相同的文档，主要是因为：

1.  数据可以更改（是的！假设这封信是由部门负责人签署的，并且人员已更改？）
2.  您的报告格式将发生变化（页眉、页脚、徽标等）
3.  您制作的文档由将使用文档中可用数据的其他人保存。

# database - 重构为 n 层

> ID：227729
> 
> 赞同：1
> 
> 时间：2008-10-22T22:16:56.937
> 
> 标签：database, vb6, n-tier-architecture, dao

我是一个使用 DAO 的自学 vb6 程序员。下面是我可以编写的一段典型代码的示例：

```
Sub cmdMultiplier_Click()  'Button on form, user interface ' 
  dim Rec1 as recordset
  dim strSQL as string

  strSQL = "select * from tblCustomers where ID = " & CurrentCustomerID  'inline SQL '
  set rec1 = GlobalDataBase.openrecordset(strSQL)    ' Data access '

  if rec1.bof <> true or rec1.eof <> true then
    if rec1.fields("Category").value = 1 then
      PriceMultiplier = 0.9         ' Business Logic ' 
    else
      priceMultiplier = 1
    end if
 end if
End Sub 
```

请假装上面是一个 CRUD 应用程序的完整源代码。我知道这种设计很糟糕，一切都混在一起了。理想情况下，它应该具有三个不同的层，用户界面、业务逻辑和数据访问。我有点明白为什么这是可取的，但我不知道它是如何完成的，我怀疑这就是为什么我不完全明白为什么这样的分离是好的。如果有人可以将上述可笑的微不足道的示例重构为 3 层，我想我会走得更远。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T02:36:43.980

一个简单的例子，是的，但包含所有基本元素 - 它们只属于 3 个不同的类（见下文）。主要原因是“关注点分离”原则，即GUI只关心GUI的东西，Biz Logic层只关心业务规则，而数据访问层只关心数据表示。这允许每个层独立维护并跨应用程序重用：

```
'in Form class - button handler
Sub cmdMultiplier_Click()
    PriceMultiplier = ComputePriceMultiplier(CurrentCustomerId)
End Sub

'in Biz Logic class
Function ComputePriceMultiplier(custId as Integer) as Double
    Dim cust as Customer = GetCustomer(custId)
    if cust.Category = 1 then   'please ignore magic number, real code uses enums
        return 0.9
    end if
    return 1
End Function

'in Data Access Layer class
Function GetCustomer(custId as Integer) as Customer
    Dim cust as Customer = New Customer    'all fields/properties to default values
    Dim strSQL as String = "select * from tblCustomers where ID = " & custId
    set rec1 = GlobalDataBase.openrecordset(strSQL)    ' Data access '
    if rec1.bof <> true or rec1.eof <> true then
        cust.SetPropertiesFromRecord(rec1)
    end if
    return cust
End Function 
```

[一个“真正的”应用程序将缓存当前客户，具有用于客户查询的常量或存储过程等；为简洁而忽略]

将此与原始的“按钮处理程序中的所有内容”示例进行对比（这在 VB 代码中非常常见，因为这样做很容易） - 如果您需要在另一个应用程序中使用价格乘数规则，您会必须将代码复制、粘贴和编辑到该应用程序的按钮处理程序中。现在将有两个地方维护相同的业务规则，两个地方执行相同的客户查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T22:29:29.110

按钮的用途是什么？

我的第一步是：

*   提取访问数据库的部分。（警告：前面的空气代码）

```
function getCustomer(CurrentCustomerID as Long)

strSQL = "select * from tblCustomers where ID = " & CurrentCustomerID
set rec1 = GlobalDataBase.openrecordset(strSQL)
result = 1

if rec1.recordcount >0 then
    getCustomer = rec1
else
    getCustomer = false
endif
end function 
```

*   编写业务逻辑函数：

```
function getCustomerDiscount(customerID as Long)

customer = getCustomer(customerID)

res = 1
if customer then
    if customer("category")=1) then
        res = .9
    endif
endif

getcustomerdiscount = res

end function 
```

*   然后，更改按钮：

```
Sub cmdMultiplier_Click() 
    pricemultiplier = getcustomerdiscount(currentcustomerid)
end sub 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T00:48:58.580

通常，您的 UI 代码将响应用户引发的事件，在本例中为按钮单击。

之后它真的取决于你的程序是如何设计的，最基本的设计是引用一个客户实例，它会包含一个乘数属性。您的客户对象由 DAL 中的数据填充。

UI 验证将进入 UI 层，业务验证规则可以进入您的业务对象，然后您的 DAL 是您的持久层。

这是一个非常基本的伪代码示例：

```
btnClick
    Dim Cust as New Customer(ID)
    multplr = Cust.DiscountMultiplier
End Click

Class Customer
    Sub New(ID)
        Data = DAL.GetCustomerData(ID)
        Me.Name = Data("Name")
        Me.Address = Data("Address")
        Me.DiscountMultiplier = Data("DiscountMultiplier")
    End Sub
    Property ID
    Property Name
    Property Address
    Property DiscountMultiplier
        Return _discountMultiplier
    End
End Class

Class DAL
    Function GetCustomerData(ID)
        SQL = "Paramaterized SQL"
        Return Data
    End Function
End Class 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T03:33:57.563

知道如何重构是一件好事。从现在开始，您将知道如何分离图层。
但是，我认为您的时间最好花在升级您正在使用的工具上。你有考虑用 VB.Net 做吗？

保留现有代码库的一种方法是在 VB.Net 中对数据层和 BR 进行编码。然后通过 COM 接口公开 BR（这是项目中的复选框选项）。然后，您可以从当前界面使用新的 BR。

完成所有 BR 和 DAL 后，您将离一个完整的新平台仅一步之遥。

# c# - .Net 中的 Int128？

> ID：227731
> 
> 赞同：74
> 
> 时间：2008-10-22T22:17:19.353
> 
> 标签：c#, .net, int128

我需要做一些大整数数学。是否有任何表示 128 位整数并实现所有常用运算符的类或结构？

顺便说一句，我意识到可以使用十进制来表示 96 位整数。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-10-22T22:39:13.210

**它在[System.Numerics](http://msdn.microsoft.com/en-us/library/dd268287%28v=VS.100%29.aspx)**中。“BigInteger 类型是一种不可变类型，它表示一个任意大的整数，其值在理论上没有上限或下限。”

```
var i = System.Numerics.BigInteger.Parse("10000000000000000000000000000000"); 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2015-02-01T01:14:20.367

虽然`BigInteger`是大多数应用程序的最佳解决方案，但如果您有性能关键的数值计算，您可以使用我的[**Dirichlet.Numerics**](https://github.com/ricksladkey/dirichlet-numerics)库中的完整`Int128`和`UInt128`实现。如果并且太小但太慢，这些类型很有用。[](https://github.com/ricksladkey/dirichlet-numerics)**`Int64``UInt64``BigInteger`**

 *** * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-22T22:26:42.173

不，.NET <= 3.5 中什么都没有。我希望/期待[BigInteger](http://blogs.msdn.com/bclteam/archive/2007/01/16/introducing-system-numeric-biginteger-inbar-gazit.aspx)将在 .NET 4.0 中回归。（它是[从 .NET 3.5 中删除的](http://blogs.msdn.com/bclteam/archive/2008/01/04/where-did-biginteger-go-melitta-andersen.aspx)。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-03-21T22:02:56.913

BigInteger 现在是 C# 和 .NET 4.0 中的朋友的标准部分。请参阅：[Gunnar Peipman 的 ASP.NET 博客](http://weblogs.asp.net/gunnarpeipman/archive/2009/05/23/net-framework-4-0-introducing-biginteger.aspx)。请注意，CPU 通常可以更快地在恒定时间内处理普通整数，尤其是在使用通常的数学运算符（+、-、/、...）时，因为这些运算符通常直接映射到单个 CPU 指令。

使用 BigInteger，即使是最基本的数学运算也是对运行时间随数字大小而变化的方法的函数调用要慢得多。这是因为 BigInteger 实现了任意精度的算法，这增加了相当大但必要的开销。好处是 BigIntegers 不限于 64 甚至 128 位，而是由可用的系统内存（或大约 2^64 位精度，以先到者为准）。[在这里](https://msdn.microsoft.com/en-us/library/system.numerics.biginteger(v=vs.110).aspx)阅读。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-23T07:41:33.630

如果您不介意参考 J# 库（vjslib.dll 默认包含在 VS 中），那么 BigInteger 已经在 .NET 中实现了

```
using java.math;

public static void Main(){
    BigInteger biggy = new BigInteger(....)

} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-12-15T22:19:00.753

C# PCL 库，用于计算大数，例如 Int128 和 Int256。 [https://github.com/everbytes/BigMath](https://github.com/everbytes/BigMath)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-02-26T18:32:12.440

GUID 由 .NET 框架中的 128 位整数支持；尽管它没有任何典型的整数类型方法。

我之前为 GUID 编写了一个处理程序，将其视为 128 位整数，但这是为我在大约 8 年前工作的一家公司准备的。我不再有权访问源代码。

因此，如果您需要对 128 位整数的本机支持，并且出于任何原因不想依赖 BigInteger，您可能会破解 GUID 来满足您的目的。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-10-22T22:28:16.523

我相信 Mono 有一个 BigInteger 实现，您应该能够追踪其来源。

# browser - Web 浏览器中的 z-index 值是否有上限？

> ID：227738
> 
> 赞同：20
> 
> 时间：2008-10-22T22:20:07.383
> 
> 标签：browser, z-index

我有一个案例，第 3 方广告正在通过我的模态窗口实现流血。我想尽可能高地提高模态叠加层的 z-index，这样广告就不会显示在它上面。z-index 值有限制吗？我确定是否存在因浏览器而异。有人知道吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-06T07:34:58.537

大多数浏览器支持的最大 zIndex 值为 2147483647 (2^31-1)，但 Opera 9.2 不接受大于 2147483583 的值；他们在 9.5 版中修复了它。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-22T22:35:03.157

请记住，这`z-index`不适用于全局，但只能在“堆叠上下文”（在 CSS 中难以理解的[定义](http://www.w3.org/TR/CSS21/visuren.html#z-index)）内起作用，并且如果广告建立了自己的堆叠上下文，那么`z-index`您在其他地方设置的值可能根本不会影响它.

然而，更有可能是“窗口化”Flash（没有`wmode=transparent`属性的对象）的问题，浏览器在所有内容之上呈现，就好像*浏览器的 window 上方的窗口*一样。在这种情况下`z-index`根本没有帮助。您需要强制 ad[-provider] 使用`wmode=transparent`或使用一些带有 iframe 的疯狂黑客。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-22T22:22:35.943

并非如此，但您可能会考虑系统的自然限制，例如 int 范围。我**可能会保持在 32,767 以下**。在处理类似问题时，我在 javascript 中肯定超过了这一点，并且在我当时担心的主要浏览器和平台上没有遇到任何问题。

对于第 3 方广告和重叠式广告，确保Flash 嵌入上的**wmode="transparent"**是同样的常见问题。另外值得注意的是，IE 有一个堆叠 z-index 的错误，所以如果你没有看到成功，请确保你的头没有撞到墙上*。

我总是喜欢保持某种**约定**，而不是使用任意数字。例如，也许我的**css 中的所有内容都介于 0 和 10 之间**。也许 dhtml 的东西发生在 100 的位置值中，对于任何给定的模块都有一个有意义的 z-index。

***旁注：**具体来说，IE 错误是 IE 将文档流的新实例视为 z-index 的新堆叠上下文。当通常继承您的 z-index 的子节点被呈现为它自己的定位上下文时，您需要确保您的 z-indexes 不会在 DOM 层次结构中丢失。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-01T22:40:02.553

引自[http://techtrouts.com/is-there-a-limit-to-the-css-z-index-property/](http://techtrouts.com/is-there-a-limit-to-the-css-z-index-property/)：

理论上 z-index 属性应该是无限的，或者至少在 int 类型范围内，具体取决于操作系统和浏览器。但是，为了避免浏览器错误，您应该将 z-index 值限制为 +/- 32767 。

# c# - StringBuilder：如何获得最终的字符串？

> ID：227743
> 
> 赞同：66
> 
> 时间：2008-10-22T22:21:25.307
> 
> 标签：c#, string, stringbuilder

有人告诉我，用 StringBuilder 连接字符串更快。我已经更改了我的代码，但我没有看到任何属性或方法来获取最终的构建字符串。

我怎样才能得到字符串？

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2008-10-22T22:21:54.713

您可以使用`.ToString()`从`String`.`StringBuilder`

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-22T22:51:39.393

当您说“将 String 与 String builder 连接起来更快”时，仅当您**重复**（我重复 -**重复**）连接到同一个对象时，这才是正确的。

如果您只是连接 2 个字符串并立即将结果作为 a 做某事`string`，那么使用`StringBuilder`.

我刚刚偶然发现 Jon Skeet 写的很好：[http ://www.yoda.arachsys.com/csharp/stringbuilder.html](http://www.yoda.arachsys.com/csharp/stringbuilder.html)

如果您正在使用`StringBuilder`, 那么要获得结果`string`，只需调用`ToString()`（不出所料）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-22T22:21:51.640

使用 StringBuilder 完成处理后，使用 ToString 方法返回最终结果。

来自 MSDN：

```
using System;
using System.Text;

public sealed class App 
{
    static void Main() 
    {
        // Create a StringBuilder that expects to hold 50 characters.
        // Initialize the StringBuilder with "ABC".
        StringBuilder sb = new StringBuilder("ABC", 50);

        // Append three characters (D, E, and F) to the end of the StringBuilder.
        sb.Append(new char[] { 'D', 'E', 'F' });

        // Append a format string to the end of the StringBuilder.
        sb.AppendFormat("GHI{0}{1}", 'J', 'k');

        // Display the number of characters in the StringBuilder and its string.
        Console.WriteLine("{0} chars: {1}", sb.Length, sb.ToString());

        // Insert a string at the beginning of the StringBuilder.
        sb.Insert(0, "Alphabet: ");

        // Replace all lowercase k's with uppercase K's.
        sb.Replace('k', 'K');

        // Display the number of characters in the StringBuilder and its string.
        Console.WriteLine("{0} chars: {1}", sb.Length, sb.ToString());
    }
}

// This code produces the following output.
//
// 11 chars: ABCDEFGHIJk
// 21 chars: Alphabet: ABCDEFGHIJK 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-22T22:24:00.247

我只是想扔掉它可能不一定更快，它肯定会有更好的内存占用。这是因为字符串在 .NET 中是不可变的，每次更改字符串时都会创建一个新字符串。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-22T22:46:37.470

关于它更快/更好的内存：

我用 Java 研究了这个问题，我认为 .NET 会很聪明。

String 的实现令人印象深刻。

String 对象跟踪“长度”和“共享”（与保存字符串的数组的长度无关）

所以像

```
String a = "abc" + "def" + "ghi"; 
```

可以（由编译器/运行时）实现为：

```
- 将包含“abc”的数组扩展 6 个额外的空格。
 - 在 abc 之后复制 def
 - 在 def 之后复制 ghi。
 - 将指向“abc”字符串的指针指向 a
 - 将 abc 的长度设置为 3，将 a 的长度设置为 9
 - 在两者中设置共享标志。

```

由于大多数字符串都是短暂的，因此在许多情况下这会产生一些非常有效的代码。绝对没有效率的情况是当您在循环中添加字符串时，或者当您的代码如下时：

```
a = "abc";
a = a + "def";
a += "ghi"; 
```

在这种情况下，最好使用 StringBuilder 构造。

我的观点是，每次优化时都应该小心，除非您绝对确定自己知道自己在做什么，并且您绝对确定这是必要的，并且您进行测试以确保优化的代码通过用例，只需编写代码即可尽可能以最易读的方式，不要试图超越编译器。

在查看字符串源代码并发现编译器已经比我的用例做得更好之前，我浪费了 3 天的时间来处理字符串、缓存/重用字符串构建器和测试速度。然后我不得不解释我真的不知道我在做什么，我只是以为我知道了......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T22:34:25.747

concat 并不快 - 正如 smaclell 指出的那样，问题是不可变字符串强制额外分配和重新复制现有数据。

"a"+"b"+"c" 对字符串生成器的处理并不快，但是随着 concat 的 # 变大，使用中间字符串的重复连接会变得越来越快，例如：

x = "一个"; x+="b"; x+="c"; ...

# c++ - 寻找 16 位 x86 编译器

> ID：227762
> 
> 赞同：18
> 
> 时间：2008-10-22T22:29:04.307
> 
> 标签：c++, compiler-construction, embedded, x86-16

我正在开发一个嵌入式系统项目，并且遇到了编译器以编程方式嵌入 Paradigm C++ IDE 的问题。我希望能够自动化构建。

处理器是 AMD186ES。我没有使用操作系统 - 只是裸机的东西。我需要从 C++ 生成实模式 16 位 8086 机器代码。

我的谷歌搜索表明 G++ 可以构建这样的代码。

我的问题是：

可以配置 g++ 来构建此机器代码吗？

是否有其他 C++ 编译器也可以做到这一点？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-22T22:36:59.783

您最好的选择可能是[OpenWatcom](http://www.openwatcom.org/index.php/Main_Page)，它包含一个 C++ 编译器。早在 90 年代初到中期，我相信这是最好的 C/C++ 编译器。几年前它是开源的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-10-10T23:05:08.670

我目前正在使用 gnu `as`（binutils 的一部分和用于 gcc 的汇编程序），并且我已经成功地使用以下代码组装了 16 位汇编代码：

```
as <file>
ld --oformat binary -Ttext 0x0 -e start <file> 
```

我的汇编文件从以下开始：

```
.code16
.globl start
.text
start: 
```

因为它的普通二进制省略了行，

```
.globl start
start: 
```

只会产生警告，即使平面二进制文件不需要入口点。

* * *

我很难学到的东西；

```
-Ttext 0x0 
```

很关键，否则该`.text`段被推到 16 位寻址范围之外（不要问我为什么）

我个人还在学习组装，所以这只是我的方式，不一定是最好的方式。

* * *

**编辑：** 如果你正在编写引导代码，你应该改变

```
-Ttext 0x0 
```

到

```
-Ttext 0x7c00 
```

这将抵消您的内存地址，`0x7c00`因为引导代码通常`0x7c00`由 BIOS 加载。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-22T22:42:01.410

您的芯片供应商（我猜是 AMD）没有指向该芯片的编译器的指针吗？

如果没有，您也许可以使用一些 16 位 DOS 编译器 - 但您将遇到几个潜在的大问题：

1.  获取不依赖于 BIOS 或 MS-DOS 的编译器库
2.  调试
3.  嵌入式系统的链接器通常具有在特定内存区域中定位代码的特定支持。这通常不包含在 DOS 编译器中，但您可能能够找到某种链接器/定位器来为您解决问题。

仍然支持并生成 16 位代码的几个编译器是：

*   [数字火星](http://www.digitalmars.com/)
*   [打开沃通](http://www.openwatcom.org/index.php/Detailed_Contents#A_Wide_Range_of_Host_and_Target_Platforms)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-22T22:42:17.510

[这个谷歌搜索](http://www.google.co.uk/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=woR&q=gcc+cross+compilation+for+embedded+systems&btnG=Search&meta=)显示了一系列用于将 gcc 设置为交叉编译器的链接。要使其针对标准 ELF 二进制文件以外的其他内容，您可以使用输出。 [此链接](http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html)讨论排除标准库和自定义输出格式。您可能需要做一些摆弄才能使其正常工作。

作为替代方案，[openwatcom.org](http://www.openwatcom.org/index.php/Main_Page)有一个 Watcom C 编译器的开源版本，它可能也可以做你想做的事情。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-05-01T21:03:19.647

GCC 4.3 有一个补丁：**[New back end ia16: 16-bit Intel x86](http://gcc.gnu.org/ml/gcc-patches/2007-07/msg02108.html)**

这[是它的更新](http://gcc.gnu.org/ml/gcc-patches/2007-08/msg02195.html)。请注意，它可能不太好用，例如，更新后的帖子说：“现在支持构造函数和析构函数，但由于某种原因，它们只适用于 elks 配置。”

这个 Docker 容器有一个构建：[https ://registry.hub.docker.com/u/ysangkok/ia16-gcc-rask](https://registry.hub.docker.com/u/ysangkok/ia16-gcc-rask)

我还没有设法制作 DOS 二进制文件：[如何组装 GAS 程序集并将其与 Open Watcom C 库链接？](https://stackoverflow.com/questions/30191000/how-do-i-assemble-gas-assembly-and-link-it-with-the-open-watcom-c-library)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-22T22:48:55.140

看看[bcc](http://homepage.ntlworld.com/robert.debath/)，它是一个 16 位 x86 C 编译器。例如，它也有[Debian 软件包](http://packages.debian.org/bcc)。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-08-24T16:32:55.523

根据 2014 年的最新版本是**[Dev86](https://github.com/lkundrak/dev86)**。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-22T22:49:17.950

不确定，但我认为旧版本的 borland c++ 能够做到这一点。你可以下载版本 5.5 t :祝[你](http://cc.codegear.com/free/cppbuilder) 好运

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-25T12:16:01.203

80186 免费 C 编译器：

[http://coding.derkeiler.com/Archive/General/comp.arch.embedded/2005-09/msg01063.html](http://coding.derkeiler.com/Archive/General/comp.arch.embedded/2005-09/msg01063.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-22T22:50:58.460

我已经很久没有看过 Paradigm 的东西了（它们还在吗？）——你确定它们没有编译器的命令行等效项吗？我记得它们是建立在 Borland 的编译器工具链之上的……所以也许 Borland 编译器的旧副本可以解决问题？

-- 啊，再看远一点，我发现Paradigm 还在（www.devtools.com）销售X86 工具。（一定是摇钱树！）

他们的专业产品包括脚本......根据您计划做的工作量，咬紧牙关购买他们的全部产品可能是值得的......

祝你好运。

# java - Java Web 应用程序同步问题

> ID：227775
> 
> 赞同：1
> 
> 时间：2008-10-22T22:31:52.070
> 
> 标签：java, synchronized

假设我的网络应用程序中有一个名为“Foo”类的类。它有一个 initialise() 方法，当使用 Spring 创建 bean 时会调用该方法。然后，initialise() 方法尝试加载外部服务并将其分配给一个字段。如果无法联系到服务，则该字段将设置为空。

```
private Service service;

public void initialise() {
    // load external service
    // set field to the loaded service if contacted
    // set to field to null if service could not be contacted
} 
```

当有人在类“Foo”上调用 get() 方法时，如果它是在 initialise() 方法中启动的，则将调用该服务。如果服务的字段为空，我想尝试加载外部服务。

```
public String get() {
    if (service == null) {
        // try and load the service again
    }
    // perform operation on the service is service is not null
} 
```

如果我做这样的事情，我可能会遇到同步问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T23:56:08.453

*toolkit*的答案是正确的。要解决这个问题，只需声明你的 Foo 的 initialise() 方法是同步的。您可以将 Foo 重构为：

```
private Service service;

public synchronized void initialise() {
    if (service == null) {
        // load external service
        // set field to the loaded service if contacted
    }
}

public String get() {
    if (service == null) {            
        initialise(); // try and load the service again
    }
    // perform operation on the service is service is not null
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T22:45:28.830

是的，您将遇到同步问题。

假设您有一个 servlet：

```
public class FooServlet extends HttpServlet {

    private MyBean myBean;

    public void init() {
        myBean = (MyBean) WebApplicationContextUtils.
            getRequiredWebApplicationContext(getServletContext()).getBean("myBean");
    }

    public void doGet(HttpRequest request, HttpResponse response) {
        String string = myBean.get();
        ....
    }

}

class MyBean {
    public String get() {
        if (service == null) {
            // try and load the service again
        }
        // perform operation on the service is service is not null
    }
} 
```

您的 bean 定义如下所示：

```
<bean id="myBean" class="com.foo.MyBean" init-method="initialise" /> 
```

问题是您的 servlet 实例被多个请求线程使用。因此，由 service == null 保护的代码块可能被多个线程输入。

最好的解决方法（避免双重检查锁定等）是：

```
class MyBean {
    public synchronized String get() {
        if (service == null) {
            // try and load the service again
        }
        // perform operation on the service is service is not null
    }
} 
```

希望这是有道理的。如果没有，请发表评论。

# visual-studio - 在构建的二进制文件中更改版本信息

> ID：227783
> 
> 赞同：0
> 
> 时间：2008-10-22T22:35:34.810
> 
> 标签：visual-studio, visual-c++-6

如何更改已构建二进制文件中的版本信息？

具体来说，我有一个用 VS6 构建的 .exe，但似乎不包含任何公司信息或版本信息字符串。实际上，我什至不确定他们是如何进入那里的。是否有用于更新此信息的命令行工具？你如何从命令行构建中嵌入它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T22:45:40.170

Visual Studio 6 允许您将二进制文件作为资源打开（它位于从内存打开文件对话框的下拉选项中）。然后，您可以编辑版本信息资源部分的内容，然后保存二进制文件。

这对我来说总是感觉很狡猾，但我工作的一个地方是构建过程的一部分。

如果您想在构建之前将该信息获取到二进制文件中，请查看 Visual Studio 项目中的文件信息资源部分。

# python - 在保留原始列表的同时传递列表

> ID：227790
> 
> 赞同：12
> 
> 时间：2008-10-22T22:38:49.343
> 
> 标签：python, list

所以我正在自学 Python，但我遇到了列表问题。我想将我的函数传递给一个列表并从中弹出项目，同时保留原始列表。如何使 python “实例”传递的列表而不是传递指向原始列表的指针？

例子：

```
def burninate(b):
    c = []
    for i in range(3):
        c.append(b.pop())
    return c

a = range(6)
d = burninate(a)
print a, d 
```

输出： [0, 1, 2] [5, 4, 3]
所需输出： [0, 1, 2, 3, 4, 5] [5, 4, 3]

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-22T23:00:37.723

正如其他答案所建议的那样，您可以为您的函数提供列表的副本。

作为替代方案，您的函数可以获取参数的副本：

```
def burninate(b):
    c = []
    b = list(b)
    for i in range(3):
        c.append(b.pop())
    return c 
```

基本上，你需要清楚你的头脑（和你的文档）你的函数是否会改变它的参数。在我看来，返回计算值的函数不应更改其参数，而更改其参数的函数不应返回任何内容。示例参见 python 的 [].sort()、[].extend()、{}.update() 等。显然有例外（如 .pop()）。

此外，根据您的特定情况，您可以重写函数以避免使用 pop() 或其他修改参数的函数。例如

```
def burninante(b):
    return b[:-4:-1]   # return the last three elements in reverse order 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-22T22:42:32.643

您可以`burninate()`使用这样的列表副本调用：

`d = burninate(a[:])`

或者，

`d = burninate(list(a))`

另一种选择是在您的方法中制作列表的副本：

```
def burninate(b):
    c=[]
    b=b[:]
    for i in range(3):
        c.append(b.pop())
    return c

>>> a = range(6)
>>> b = burninate(a)
>>> print a, b
>>> [0, 1, 2, 3, 4, 5] [5, 4, 3] 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-22T22:45:13.807

做同样事情的一种更易读的方法是：

```
d = burninate(list(a)) 
```

在这里，`list()`构造函数基于`a`.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-22T23:00:00.890

更通用的解决方案是`import copy`, 并`copy.copy()`在参数上使用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-22T22:58:06.107

其他版本：

```
def burninate(b):
    c = []
    for i in range(1, 4):
        c.append(b[-i])
    return c 
```

```
def burninate(b):
    c = b[-4:-1]
    c.reverse()
    return c 
```

总有一天你会喜欢列表推导：

```
def burninate(b):
    return [b[-i] for i in range(1,4)] 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-07T10:52:00.650

您可以使用 copy.deepcopy()

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T23:09:10.093

```
burninate = lambda x: x[:-4:-1]
```

# objective-c - 你能在 mouseDown 事件中检测到 ctrl-click（上下文菜单）请求吗？

> ID：227797
> 
> 赞同：6
> 
> 时间：2008-10-22T22:40:47.387
> 
> 标签：objective-c, cocoa, macos

在我的跨平台架构中，我想在鼠标单击事件期间对上下文菜单单击（右键单击）进行操作。在 Cocoa 中，您能否在 mouseDown 事件期间检测到用户在触摸板上按 Ctrl 键或双击（右键单击等效）？我知道 NSView 的 menuForEvent 但不想在这里处理它。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-25T22:55:51.547

一般来说， -rightMouseDown: 应该被自动调用，但我见过它不是的情况——这些可能在 Leopard 中被修补。

但是现在，在 -mouseDown: 我使用以下代码检查控制键是否关闭：

```
- (void)mouseDown:(NSEvent *)event;
{
    if (event.modifierFlags & NSControlKeyMask)
        return [self rightMouseDown:event];

...
} 
```

-会

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-22T22:46:19.263

如果您正在使用 AppKit，并且想要检测视图中的右键单击，则应覆盖`-[NSResponder rightMouseDown:]`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-04-21T12:39:35.453

斯威夫特版本：

```
override func mouseDown(theEvent: NSEvent) {
    if theEvent.modifierFlags.contains(.ControlKeyMask) {
        return rightMouseDown(theEvent)
    }

    super.mouseDown(theEvent)
} 
```

# .net - SystemIcons 默认大小

> ID：227799
> 
> 赞同：1
> 
> 时间：2008-10-22T22:41:40.570
> 
> 标签：.net, icons

System.Drawing.SystemIcons 图标的默认（即本机）大小是多少？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T22:50:19.490

我在 Windows XP 上得到**32 。**

```
System.Drawing.Icon SystemIcon = System.Drawing.SystemIcons.Application;
Console.WriteLine(SystemIcon.Height);
Console.WriteLine(SystemIcon.Width); 
```

# ruby-on-rails - Rails Cookie 设置问题

> ID：227807
> 
> 赞同：3
> 
> 时间：2008-10-22T22:44:58.440
> 
> 标签：ruby-on-rails, ruby, cookies

我有一个 Rails 应用程序，它设置了一个 cookie，并在用户登录后重定向到另一台服务器。但是，由于某种原因，服务器看不到 Rails 应用程序设置的 cookie。我尝试将 http_only 设置为 false，但我什至看不到 cookie，除非域与我的 Rails 应用程序相同。这是我用来设置 cookie 的代码：

```
cookies[:dev_appserver_login] = 
  { :value => "#{email}:#{nick}:#{admin}:#{hsh}",
    :domain => "webserver-to-redirect-to",
    :expires => 30.days.from_now }

redirect_to session[:dest_url] 
```

[如果我在 Firefox 中使用Web Developer 扩展](https://addons.mozilla.org/en-US/firefox/addon/60)手动创建一个 cookie，它可以正常工作，但当 Rails 这样做时就不行。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-22T23:10:37.780

什么是重定向和重定向到服务器？您只能将“域”设置为当前主机名或父域，因此如果您在 a.example.com 上并且要重定向到 b.example.com，则必须将“域”设置为 .example。 com，*而不是*代码片段中暗示的 b.example.com。

（并且像 .com TLD 这样的开放域本身不允许作为域值，因此如果您想将 cookie 从 a.example.com 传递到 b.somewhereelse.com，您将需要一个更复杂的解决方案，可能涉及更改代码在someoneelse.com上。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T00:50:41.683

> 除非域与我的 Rails 应用程序相同，否则我什至看不到 cookie。

这就是cookie应该如何工作的。如果您直接通过 IP 访问它，那么就网络浏览器而言，您的“域”只是您的 IP，因此适用相同的规则。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-09T20:37:00.920

您可以在开发模式下通过编辑 /etc/hosts 文件并为您的应用程序创建主机名来解决此问题

`127.0.0.1 app1.localdev.com, app2.localdev.com`

然后，当创建 cookie 时，将域设置为“.localdev.com”（注意前面的句点），这将允许 localdev.com 的任何子域中的任何应用程序读取它。

另一个更广泛的解决方案（更适合生产部署，但需要设置更多工作）是为子应用设置路径代理，以便对 appdomain.com 的请求转到 app1 并请求对 appdomain.com/other-app/被代理到另一个应用程序。这使他们可以共享根域并轻松共享 cookie。

# c# - 为什么在 lambda 表达式中使用迭代变量不好

> ID：227820
> 
> 赞同：54
> 
> 时间：2008-10-22T22:47:52.320
> 
> 标签：c#, vb.net, lambda, iteration, warnings

我只是在写一些快速代码并注意到这个编译器错误

> 在 lambda 表达式中使用迭代变量可能会产生意想不到的结果。
> 相反，在循环中创建一个局部变量并将迭代变量的值分配给它。

我知道这意味着什么，我可以轻松修复它，没什么大不了的。
但我想知道为什么在 lambda 中使用迭代变量是个坏主意？
我以后会引起什么问题？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-10-22T22:52:39.347

考虑这段代码：

```
List<Action> actions = new List<Action>();

for (int i = 0; i < 10; i++)
{
    actions.Add(() => Console.WriteLine(i));
}

foreach (Action action in actions)
{
    action();
} 
```

你希望这会打印什么？显而易见的答案是 0...9 - 但实际上它打印了 10、10 次。这是因为只有一个变量被所有代表捕获。正是这种出乎意料的行为。

编辑：我刚刚看到你在谈论 VB.NET 而不是 C#。我相信 VB.NET 有更复杂的规则，因为变量在迭代中保持其值的方式。[Jared Parsons 的这篇文章](https://devblogs.microsoft.com/vbteam/closures-in-vb-part-5-looping/)提供了一些有关所涉及困难的信息——尽管它是从 2007 年开始的，所以从那时起实际行为可能已经改变。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-22T22:51:45.823

假设你的意思是 C# 这里。

这是因为编译器实现闭包的方式。使用迭代变量*可能*会导致访问修改后的闭包出现问题（请注意，我说“不能”不会“将”导致问题，因为有时它不会发生，具体取决于方法中的其他内容，有时您实际上想要访问修改后的闭包）。

更多信息：

[http://blogs.msdn.com/abhinaba/archive/2005/10/18/482180.aspx](http://blogs.msdn.com/abhinaba/archive/2005/10/18/482180.aspx)

更多信息：

[http://blogs.msdn.com/oldnewthing/archive/2006/08/02/686456.aspx](http://blogs.msdn.com/oldnewthing/archive/2006/08/02/686456.aspx)

[http://blogs.msdn.com/oldnewthing/archive/2006/08/03/687529.aspx](http://blogs.msdn.com/oldnewthing/archive/2006/08/03/687529.aspx)

[http://blogs.msdn.com/oldnewthing/archive/2006/08/04/688527.aspx](http://blogs.msdn.com/oldnewthing/archive/2006/08/04/688527.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2019-03-23T18:48:38.057

# .NET 中的闭包理论

[局部变量：范围与生命周期（加上闭包）](https://web.archive.org/web/20100123174756/http://www.panopticoncentral.net/archive/2006/03/28/11552.aspx)（2010 年存档）

（强调我的）

> 在这种情况下发生的是我们使用闭包。闭包只是一种位于方法之外的特殊结构，其中包含需要由其他方法引用的局部变量。**当查询引用局部变量（或参数）时，该变量被闭包捕获，并且对该变量的所有引用都被重定向到闭包。**

当您考虑闭包在 .NET 中的工作方式时，我建议您牢记这些要点，这是设计人员在实现此功能时必须使用的：

*   请注意，“变量捕获”和 lambda 表达式不是 IL 功能，VB.NET（和 C#）必须使用现有工具（在本例中为 classes 和`Delegate`s）来实现这些功能。
*   或者换一种说法，局部变量不能真正持久化到它们的范围之外。该语言所做的只是让它*看起来*可以，但它并不是一个完美的抽象。
*   `Func(Of T)`（即，`Delegate`）实例无法存储传递给它们的参数。
*   不过，`Func(Of T)`请务必存储该方法所属的类的实例。这是 .NET 框架用来“记住”传递给 lambda 表达式的参数的途径。

那么让我们来看看吧！

# 示例代码：

所以假设你写了一些这样的代码：

```
' Prints 4,4,4,4
Sub VBDotNetSample()
    Dim funcList As New List(Of Func(Of Integer))

    For indexParameter As Integer = 0 To 3
        'The compiler says:
        '   Warning     BC42324 Using the iteration variable in a lambda expression may have unexpected results.  
        '   Instead, create a local variable within the loop and assign it the value of the iteration variable

        funcList.Add(Function()indexParameter)

    Next

    For Each lambdaFunc As Func(Of Integer) In funcList
        Console.Write($"{lambdaFunc()}")

    Next

End Sub 
```

您可能希望代码打印 0,1,2,3，但实际上打印的是 4,4,4,4，这是因为`indexParameter`已在`Sub VBDotNetSample()`'s 范围内“捕获”，而不是在`For`循环范围内.

# 反编译示例代码

就个人而言，我真的很想看看编译器为此生成了什么样的代码，所以我继续使用了 JetBrains DotPeek。我将编译器生成的代码手动翻译回 VB.NET。

评论和变量名是我的。以不影响代码行为的方式对代码进行了略微简化。

```
Module Decompiledcode
    ' Prints 4,4,4,4
    Sub CompilerGenerated()

        Dim funcList As New List(Of Func(Of Integer))

        '***********************************************************************************************
        ' There's only one instance of the closureHelperClass for the entire Sub
        ' That means that all the iterations of the for loop below are referencing
        ' the same class instance; that means that it can't remember the value of Local_indexParameter
        ' at each iteration, and it only remembers the last one (4).
        '***********************************************************************************************
        Dim closureHelperClass As New ClosureHelperClass_CompilerGenerated

        For closureHelperClass.Local_indexParameter = 0 To 3

            ' NOTE that it refers to the Lambda *instance* method of the ClosureHelperClass_CompilerGenerated class, 
            ' Remember that delegates implicitly carry the instance of the class in their Target 
            ' property, it's not just referring to the Lambda method, it's referring to the Lambda
            ' method on the closureHelperClass instance of the class!
            Dim closureHelperClassMethodFunc As Func(Of Integer) = AddressOf closureHelperClass.Lambda
            funcList.Add(closureHelperClassMethodFunc)

        Next
        'closureHelperClass.Local_indexParameter is 4 now.

        'Run each stored lambda expression (on the Delegate's Target, closureHelperClass)
        For Each lambdaFunc As Func(Of Integer) in funcList      

            'The return value will always be 4, because it's just returning closureHelperClass.Local_indexParameter.
            Dim retVal_AlwaysFour As Integer = lambdaFunc()

            Console.Write($"{retVal_AlwaysFour}")

        Next

    End Sub

    Friend NotInheritable Class ClosureHelperClass_CompilerGenerated
        ' Yes the compiler really does generate a class with public fields.
        Public Local_indexParameter As Integer

        'The body of your lambda expression goes here, note that this method
        'takes no parameters and uses a field of this class (the stored parameter value) instead.
        Friend Function Lambda() As Integer
            Return Me.Local_indexParameter

        End Function

    End Class

End Module 
```

请注意`closureHelperClass`，整个主体只有一个 的实例`Sub CompilerGenerated`，因此该函数无法打印`For`0,1,2,3 的中间循环索引值（没有地方存储这些值）。该代码仅打印 4 次，即最终索引值（`For`循环后）四次。

# 脚注：

*   这篇文章中隐含了“截至 .NET 4.6.1”，但在我看来，这些限制不太可能发生巨大变化；如果您发现无法重现这些结果的设置，请给我留言。

“但是jrh你为什么发布一个迟到的答案？”

*   这篇文章中链接的页面要么丢失，要么乱七八糟。
*   在这个 vb.net 标记的问题上没有 vb.net 答案，截至撰写本文时，有一个 C#（错误语言）答案和一个主要是链接答案（带有 3 个死链接）。

# bash - 如何在 FreeBSD 下使 Bash 历史永久化？

> ID：227847
> 
> 赞同：7
> 
> 时间：2008-10-22T22:57:09.617
> 
> 标签：bash, freebsd

我有一个装有 Bash 的 FreeBSD 盒子。

我习惯了 Debian Linux，当我注销时，我的命令历史记录会自动保存，因此当我重新登录时，我可以按 up 或 Ctrl-R 或其他任何东西来访问我的历史记录。

如何设置 Bash 在 FreeBSD 上执行此操作？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-22T23:05:14.453

检查您的环境以确保设置了变量 HISTSIZE 和 HISTFILE。确保 HISTSIZE（要保存的命令数）足够大（我使用 10000）并且 HISTFILE 是可写的。如果未定义这些变量，请在 ~/.bashrc 文件中设置，然后注销并重新登录。

[编辑] 另外，请务必通过运行检查是否启用了历史记录：

```
set -o 
```

并寻找“历史”：

```
history         on 
```

如果历史是`off`你可以打开它

```
set -o history 
```

# java - Java Applet 区域设置

> ID：227853
> 
> 赞同：0
> 
> 时间：2008-10-22T22:59:17.773
> 
> 标签：java, localization, applet

我正在运行英语版本的 WindowsXP，但已将西班牙语设置为我在 Firefox 中唯一接受的语言。当我在浏览器会话中加载小程序时，我天真地期望将浏览器的语言设置为默认值，但事实并非如此。小程序以操作系统的默认语言英语启动。

我可以在我的 Applet 中添加一个新的 <param> 并在初始化期间调用 Locale.setDefault() ，但在我开始破解之前，我想知道我是否遗漏了一些明显的东西。浏览器或调用网页是否有一种通用机制可以设置 <applet> 的默认语言？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T00:36:11.570

java 插件使用操作系统区域设置而不是浏览器区域设置。

要覆盖默认语言环境，请进入java控制面板-java选项卡，按Applet Runtime Settings的View按钮，并在第4列添加所需的参数，即使它是灰色的也是可编辑的。

在你的情况下，尝试类似 -Duser.language=es

再见。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-13T10:29:01.517

以前，applet 和 Java 应用程序的默认语言环境是从 Windows 的语言环境派生的。对于 jre 7，Java 应用程序仍然如此，但对于 applet 则不再如此。无论您如何设置 Windows 语言环境，applet 的默认语言环境都是 en_US。这一定是与 Java 插件相关的错误。/阿隆

# language-agnostic - 如何避免贫血域模型并保持关注点分离？

> ID：227856
> 
> 赞同：20
> 
> 时间：2008-10-22T23:01:03.183
> 
> 标签：language-agnostic, design-patterns, oop

似乎决定让您的对象充分认识到它们在系统中的角色，并且仍然避免在数据库和服务层的域模型中存在过多的依赖关系？

例如：假设我有一个具有修订历史的实体，以及数据引用的几个“查找表”，您的实体对象应该具有从某些查找表中获取详细信息的方法，无论是通过提供对查找表行，或者通过将方法委托给它们，但为了做到这一点，它依赖于数据库层从这些行中读取数据。此外，当实体被保存时，它不仅需要知道如何保存自己，还需要知道如何将条目保存到修订历史中。是否需要将几十个不同的数据层对象和服务对象的引用传递给模型对象？这似乎使得逻辑比仅仅将瘦模型来回传递给服务层对象要复杂得多，但我听说过很多“智者”

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-23T00:16:05.450

真的很好的问题。我花了很多时间思考这些话题。

通过注意到表达域模型和关注点分离之间的张力，您展示了深刻的洞察力。这很像我问的关于[告诉不问和单一责任原则](https://stackoverflow.com/questions/169450/arent-information-expert-tell-dont-ask-at-odds-with-single-responsibility-princ)的问题中的张力。

这是我对这个话题的看法。

领域模型是贫乏的，因为它不包含领域逻辑。其他对象使用贫血域对象获取和设置数据。你所描述的对我来说听起来不像域逻辑。它可能是，但一般来说，查找表和其他技术语言很可能是对我们有意义但对客户不一定有意义的术语。如果这是不正确的，请澄清。

无论如何，域对象的构造和持久性不应该包含在域对象本身中，因为这不是域逻辑。

所以要回答这个问题，不，你不应该注入一大堆非域对象/概念，比如查找表和其他基础设施细节。这是将一个问题泄露给另一个问题。域驱动设计中的工厂和存储库模式最适合将这些问题与域模型本身分开。

但是请注意，如果您没有任何领域逻辑，那么您最终会得到乏味的领域对象，即一堆无脑的 getter 和 setter，这就是[一些商店声称的 SOA / 服务层](http://moffdub.wordpress.com/2008/09/03/soa-is-not-an-excuse-to-write-procedural-java/)的方式。

那么如何才能两全其美呢？您如何将您的领域对象仅关注领域逻辑，同时不影响 UI、构造、持久性等？我建议您使用像[Double Dispatch](http://www.c2.com/cgi/wiki?DoubleDispatchExample)这样的技术，或某种形式的[受限方法访问](http://moffdub.wordpress.com/restricted-method-access/)。

这是双重调度的示例。假设你有这行代码：

```
entity.saveIn(repository); 
```

在您的问题中， saveIn() 将拥有有关数据层的各种知识。使用双重调度， saveIn() 这样做：

```
repository.saveEntity(this.foo, this.bar, this.baz); 
```

并且存储库的 saveEntity() 方法具有如何在数据层中保存的所有知识，因为它应该。

除了此设置，您还可以：

```
repository.save(entity); 
```

这只是调用

```
entity.saveIn(this); 
```

我重新阅读了这篇文章，我注意到实体仍然很薄，因为它只是将其持久性发送到存储库。但在这种情况下，实体应该很薄，因为您没有描述任何其他域逻辑。在这种情况下，您可以说“去他妈的 Double Dispatch，给我访问器”。

是的，你可以，但是 IMO 它暴露了太多你的实体是如何实现的，而且这些访问器会分散域逻辑的注意力。我认为唯一应该具有获取和设置的类是名称以“Accessor”结尾的类。

我很快就会结束这个。就个人而言，我不会使用 saveIn() 方法编写实体，因为我认为即使只有 saveIn() 方法也会使域对象分散注意力。我使用朋友类模式、包私有访问，或者可能是[Builder 模式](http://www.javaworld.com/javaworld/jw-01-2004/jw-0102-toolbox.html?page=3)。

好了，我完成了。正如我所说，我对这个话题非常着迷。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T23:40:42.040

“服务层对象的瘦模型”是您真正想要编写服务层时所做的事情。

ORM 是您不想编写服务层时所做的。

当您使用 ORM 时，您仍然知道导航*可能*涉及查询这一事实，但您不会纠缠于它。

查找表可以是在没有非常完整的对象模型时使用的关系拐杖。您拥有的不是引用事物的事物，而是必须查找的代码。在许多情况下，代码只不过是带有数据库键的静态字符串池。并且相关方法在软件中出现在奇怪的地方。

但是，如果有更完整的对象模型，我们就有一流的*东西*，而不是这些退化的查找值。

例如，我有一些具有*n 个*不同“费率计划”之一的业务交易——一种定价模型。目前，旧的关系数据库将费率计划作为带有代码、一些定价数字和（有时）描述的查找表。

[每个人都知道密码——密码是神圣的。没有人确定正确的描述应该是什么。但他们知道密码。]

但实际上，“费率计划”是与合同相关联的对象。费率计划具有计算最终价格的方法。当应用程序向合同询问价格时，合同会将一些定价工作委托给相关的费率计划对象。

在生成合同价格时，可能会进行一些数据库查询以查找费率计划，但这对于两个类之间的责任委派是偶然的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-11T19:12:54.083

我同意 DeadBeef 的观点——这就是紧张局势。我并没有真正看到域模型是如何“贫血”的，仅仅是因为它不能自救。

必须有更多的东西。IE。它是乏力的，因为服务正在执行所有业务规则，而不是域实体。

```
Service(IRepository) injected

Save(){

DomainEntity.DoSomething();
Repository.Save(DomainEntity);

}

'Do Something' is the business logic of the domain entity.

**This would be anemic**:
Service(IRepository) injected

Save(){

if(DomainEntity.IsSomething)
  DomainEntity.SetItProperty();
Repository.Save(DomainEntity);

} 
```

看到继承的区别了吗？我愿意 ：）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T23:08:51.527

尝试“存储库模式”和“域驱动设计”。DDD 建议将某些实体定义为其他对象的聚合根。每个聚合都被封装。这些实体是“持久性无知的”。所有与持久性相关的代码都放在一个存储库对象中，该存储库对象管理实体的数据访问。这样您就不必将与持久性相关的代码与业务逻辑混合在一起。如果您对 DDD 感兴趣，请查看 eric evans 的书。

# .net - 如何确定 .NET 应用程序的依赖关系？

> ID：227886
> 
> 赞同：122
> 
> 时间：2008-10-22T23:18:43.303
> 
> 标签：.net, dll, dependencies, dependency-walker

如何确定 .NET 应用程序的依赖关系？[Dependency Walker](http://www.dependencywalker.com/)是否适用于托管应用程序？我已经下载了最新版本并尝试分析该应用程序，但它只是退出而没有太多解释。如果它不适用于 .NET，那么是否有其他工具可以帮助我调试运行时 DLL 加载问题？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-10-22T23:41:51.273

Dependency walker 适用于普通的 win32 二进制文件。所有 .NET dll 和 exe 都有一个小的 stub 标头部分，这使它们看起来像普通的二进制文件，但它基本上所说的只是“加载 CLR”——这就是依赖 walker 会告诉你的全部内容。

要查看您的 .NET 应用程序实际依赖的东西，您可以使用Red Gate非常出色的[.NET 反射器。](http://www.red-gate.com/products/reflector/)（编辑：请注意，.NET Reflector 现在是付费产品[。ILSpy](http://ilspy.net)是免费和开源的，非常相似。）

将您的 DLL 加载到其中，右键单击并选择“分析” - 然后您将看到一个“取决于”项目，它将向您显示它需要的所有其他 dll（以及这些 dll 中的方法）。

但有时它会变得更棘手，因为您的应用程序依赖于 X dll，并且存在 X dll，但无论出于何种原因，都无法在运行时加载或定位。

为了解决这些问题，Microsoft 有一个[程序集绑定日志查看器](http://msdn.microsoft.com/en-us/library/e74a18c4(VS.71).aspx)，它可以显示*运行时发生的情况*

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2016-04-04T13:34:14.720

我发现小型实用程序[AsmSpy](https://github.com/mikehadlow/AsmSpy)是解决加载程序集问题的宝贵工具。它列出了托管程序集的所有程序集引用，包括程序集版本。

`.dll`使用以下参数在 目录中的命令提示符下运行它：

```
asmspy . all 
```

[![asmspy 输出截图](https://i.stack.imgur.com/owDiJ.png)](https://i.stack.imgur.com/owDiJ.png)

使用 Chocolatey 快速安装：

```
choco install asmspy 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2011-08-25T16:03:14.433

在 ILDASM 中打开程序集文件并查看 MANIFEST 中的 @ .assembly extern

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2015-11-23T11:29:03.690

您无需下载和安装共享软件应用程序或工具。您可以使用 .NET 以编程方式执行此操作[`Assembly.GetReferencedAssemblies()`](https://msdn.microsoft.com/en-us/library/system.reflection.assembly(v=vs.110).aspx)

```
Assembly.LoadFile(@"app").GetReferencedAssemblies() 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-11-21T09:27:13.530

要浏览 .NET 代码依赖项，您可以使用工具 NDepend 的功能。该工具建议：

*   依赖[图](http://www.ndepend.com/docs/visual-studio-dependency-graph)
*   一个[依赖矩阵](http://www.ndepend.com/docs/dependency-structure-matrix-dsm)，
*   并且还可以编辑（或生成）一些[C# LINQ 查询以浏览依赖项。](http://www.ndepend.com/docs/cqlinq-features#Dependencies)

例如，此类查询可能如下所示：

```
from m in Methods 
let depth = m.DepthOfIsUsing("NHibernate.NHibernateUtil.Entity(Type)") 
where depth  >= 0 && m.IsUsing("System.IDisposable")
orderby depth
select new { m, depth } 
```

其结果如下所示：（注意代码度量**depth**，1 用于直接调用者，2 用于直接调用者的调用者...）（还要注意 Export to Graph 按钮将查询结果导出到[Call Graph](http://www.ndepend.com/docs/visual-studio-dependency-graph#Call)）

[![NDepend 依赖项通过 C# LINQ 查询浏览](https://i.stack.imgur.com/oAwfm.png)](https://i.stack.imgur.com/oAwfm.png)

依赖图如下所示：

[![NDepend 依赖图](https://i.stack.imgur.com/8lMZ4.jpg)](https://i.stack.imgur.com/8lMZ4.jpg)

依赖矩阵如下所示：

[![NDepend 依赖矩阵](https://i.stack.imgur.com/uC54j.png)](https://i.stack.imgur.com/uC54j.png)

依赖矩阵*实际上*不如图表直观，但它更适合浏览复杂的代码部分，例如：

[![NDepend 矩阵与图](https://i.stack.imgur.com/nUy4Z.jpg)](https://i.stack.imgur.com/nUy4Z.jpg)

*免责声明：我为 NDepend 工作*

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-03-08T05:25:18.383

如果您使用的是 Mono 工具链，则可以使用带有参数[的`monodis`实用程序](http://www.mono-project.com/docs/tools+libraries/tools/monodis/)`--assemblyref`来列出 .NET 程序集的依赖项。这将适用于`.exe`和`.dll`文件。

# 示例用法：

```
monodis --assemblyref somefile.exe 
```

### 示例输出（.exe）：

```
$ monodis --assemblyref monop.exe
AssemblyRef Table
1: Version=4.0.0.0
    Name=System
    Flags=0x00000000
    Public Key:
0x00000000: B7 7A 5C 56 19 34 E0 89
2: Version=4.0.0.0
    Name=mscorlib
    Flags=0x00000000
    Public Key:
0x00000000: B7 7A 5C 56 19 34 E0 89 
```

### 示例输出（.dll）：

```
$ monodis --assemblyref Mono.CSharp.dll
AssemblyRef Table
1: Version=4.0.0.0
    Name=mscorlib
    Flags=0x00000000
    Public Key:
0x00000000: B7 7A 5C 56 19 34 E0 89
2: Version=4.0.0.0
    Name=System.Core
    Flags=0x00000000
    Public Key:
0x00000000: B7 7A 5C 56 19 34 E0 89
3: Version=4.0.0.0
    Name=System
    Flags=0x00000000
    Public Key:
0x00000000: B7 7A 5C 56 19 34 E0 89
4: Version=4.0.0.0
    Name=System.Xml
    Flags=0x00000000
    Public Key:
0x00000000: B7 7A 5C 56 19 34 E0 89 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-23T00:45:22.783

启用程序集绑定日志将 HKLM\Software\Microsoft\Fusion 中的注册表值 EnableLog 设置为 1。请注意，您必须重新启动应用程序（使用 iisreset）才能使更改生效。

**提示：**请记住在完成后关闭融合日志记录，因为打开它会降低性能。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-12-17T16:19:41.423

有趣的是，我遇到了类似的问题，但没有找到任何合适的东西，并且知道旧的 Dependency Walker，所以最后我自己写了一个。

这专门处理 .NET 并将递归地显示程序集具有（和缺少）的引用。它还将显示本机库依赖项。

它是免费的（供个人使用），任何有兴趣的人都可以在这里获得：[www.netdepends.com](https://www.netdepends.com/)

[![www.netdepends.com](https://i.stack.imgur.com/Wd7KN.png)](https://i.stack.imgur.com/Wd7KN.png)

欢迎反馈。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-06-08T23:18:46.263

[http://www.amberfish.net/](http://www.amberfish.net/)

ChkAsm 将一次显示特定程序集的所有依赖项，包括版本，并轻松让您在列表中搜索程序集。为此目的比 ILSpy ( [http://ilspy.net/](http://ilspy.net/) ) 好得多，这是我用来完成此任务的工具。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-13T13:09:48.250

我使用的另一个方便的反射器插件是[依赖结构矩阵](http://tcdev.free.fr/)。看到什么类使用什么真是太好了。另外它是免费的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-28T14:06:09.437

尝试使用选项编译您的 .NET 程序集`--staticlink:"Namespace.Assembly"`。这会强制编译器在编译时引入所有依赖项。如果遇到未引用的依赖项，它将给出警告或错误消息，通常带有该程序集的名称。

`Namespace.Assembly`是您怀疑存在依赖性问题的程序集。通常，仅静态链接此程序集将传递引用所有依赖项。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-10-19T15:34:01.373

**为更新的 .Net 版本提供解决方案**

当 OP 提出问题时，情况可能并非如此，但目前有一个内置`dotnet`命令用于列出解决方案中的包依赖项：

```
 PS C:\foo> dotnet list package
    Project 'foo' has the following package references
        [net5.0]:
        Top-level Package               Requested    Resolved
        ...                             ...          ... 
```

可以在 Microsoft 文档网站上找到更多信息：[https ://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-list-package](https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-list-package)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-12-13T03:13:45.637

在我的公司，我们使用 Ashutosh Bhawasinka 的“装配信息”。它被实现为一个外壳扩展，因此您只需右键单击 *.dll 文件即可获得信息。您可以查看依赖关系树或获取所有依赖关系的平面列表。我喜欢这个工具的地方在于它还显示了公钥令牌，这是检查冲突的好方法。这是我公司的一个程序集的平面列表输出示例：

```
ICSharpCode.SharpZipLib, Version=0.86.0.518, Culture=neutral, PublicKeyToken=484f84ea1d6cf4da
mscorlib, Culture=neutral, PublicKeyToken=b77a5c561934e089
mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
System.Drawing, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089 
```

我们在 .Net Framework 4.0 中编译，因此您可以在 mscorlib 上看到该版本；我们还引用了为 .Net Framework 2.0 编译的 SharpZipLib，因此我们也看到了这种依赖关系。好的。

唯一的问题是该实用程序发布在已关闭的 CodePlex 上。幸运的是，我们保留了原始文件的副本。我在网络上的其他任何地方都找不到它，所以我决定在这里发布它供任何人获取（看起来我们只保存了 64 位版本）：

[http://riosoftware.com/temp/pub/Assembly%20Information%20for%2064bit%20Operating%20System.zip](http://riosoftware.com/temp/pub/Assembly%20Information%20for%2064bit%20Operating%20System.zip)

如果您发现此链接和工具有用，请“投票”此答案以帮助他人！

* * *

## 回答 #14

> 赞同：-5
> 
> 时间：2015-10-12T10:28:13.957

我看到和使用的最佳应用程序，显示错过/有问题的 dll： http: [//www.dependencywalker.com/](http://www.dependencywalker.com/)

# c - 如何仅使用标准库分配对齐的内存？

> ID：227897
> 
> 赞同：456
> 
> 时间：2008-10-22T23:23:41.717
> 
> 标签：c, memory-management

我刚刚完成了作为工作面试一部分的测试，一个问题难倒了我，甚至使用谷歌作为参考。我想看看 StackOverflow 的工作人员可以用它做什么：

> 该`memset_16aligned`函数需要一个 16 字节对齐的指针传递给它，否则它将崩溃。
> 
> a) 你将如何分配 1024 字节的内存，并将其与 16 字节的边界对齐？
> b) 执行后释放内存`memset_16aligned`。

```
{    
   void *mem;
   void *ptr;

   // answer a) here

   memset_16aligned(ptr, 0, 1024);

   // answer b) here    
} 
```

* * *

## 回答 #1

> 赞同：626
> 
> 时间：2008-10-22T23:27:13.923

### 原始答案

```
{
    void *mem = malloc(1024+16);
    void *ptr = ((char *)mem+16) & ~ 0x0F;
    memset_16aligned(ptr, 0, 1024);
    free(mem);
} 
```

### 固定答案

```
{
    void *mem = malloc(1024+15);
    void *ptr = ((uintptr_t)mem+15) & ~ (uintptr_t)0x0F;
    memset_16aligned(ptr, 0, 1024);
    free(mem);
} 
```

### 按要求解释

第一步是分配足够的备用空间，以防万一。由于内存必须是 16 字节对齐的（意味着前导字节地址需要是 16 的倍数），因此添加 16 个额外字节可以保证我们有足够的空间。在前 16 个字节的某处，有一个 16 字节对齐的指针。（请注意，它应该返回一个对于*任何*`malloc()`目的都充分对齐的指针。但是，'any' 的含义主要用于基本类型 - 、、、和指向对象的指针和指向函数的指针。当你做更专业的事情，比如玩图形系统，他们可能需要比系统的其他部分更严格的对齐——因此像这样的问题和答案。）*`long``double``long double``long long`*

 *下一步是将void指针转换为char指针；尽管有 GCC，但您不应该对 void 指针进行指针运算（并且 GCC 有警告选项可以在您滥用它时告诉您）。然后将 16 添加到开始指针。假设`malloc()`返回了一个不可能对齐的指针：0x800001。添加 16 得到 0x800011。现在我想向下舍入到 16 字节边界——所以我想将最后 4 位重置为 0。0x0F 将最后 4 位设置为 1；因此，`~0x0F`除了最后四位之外，所有位都设置为 1。加上 0x800011 得到 0x800010。您可以迭代其他偏移量并查看相同的算术是否有效。

最后一步，`free()`，很简单：你总是，而且只有，返回到`free()`一个值`malloc()`，`calloc()`或者`realloc()`返回给你——其他任何事情都是一场灾难。您正确地提供`mem`了保持该值-谢谢。免费发布它。

最后，如果您了解系统`malloc`包的内部结构，您可能会猜到它可能会返回 16 字节对齐的数据（或者它可能是 8 字节对齐的）。如果它是 16 字节对齐的，那么您就不需要使用这些值。然而，这是狡猾且不可移植的——其他`malloc`包有不同的最小对齐，因此当它做不同的事情时假设一件事会导致核心转储。在广泛的范围内，该解决方案是可移植的。

其他人提到`posix_memalign()`了另一种获得对齐内存的方法；这并非在任何地方都可用，但通常可以以此为基础来实现。请注意，对齐是 2 的幂很方便；其他路线更混乱。

还有一条评论——这段代码不检查分配是否成功。

### 修正案

[Windows Programmer](https://stackoverflow.com/users/23705/windows-programmer)指出您不能对指针执行位掩码操作，而且事实上，GCC（经过 3.4.6 和 4.3.1 测试）确实会这样抱怨。因此，下面是基本代码的修改版本——转换为主程序。正如已经指出的那样，我还冒昧地只添加了 15 而不是 16。我一直在使用`uintptr_t`C99，因为它已经存在了足够长的时间，可以在大多数平台上访问。如果不是`PRIXPTR`在语句中使用，那么代替使用`printf()`就足够了。*[[此代码包含CR](https://stackoverflow.com/users/832878/c-r)**指出的修复，它重申了**[Bill K](https://stackoverflow.com/users/12943/bill-k)**几年前首次提出的观点**，直到现在我都设法忽略了这一点。]*`#include <stdint.h>``#include <inttypes.h>`

```
#include <assert.h>
#include <inttypes.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

static void memset_16aligned(void *space, char byte, size_t nbytes)
{
    assert((nbytes & 0x0F) == 0);
    assert(((uintptr_t)space & 0x0F) == 0);
    memset(space, byte, nbytes);  // Not a custom implementation of memset()
}

int main(void)
{
    void *mem = malloc(1024+15);
    void *ptr = (void *)(((uintptr_t)mem+15) & ~ (uintptr_t)0x0F);
    printf("0x%08" PRIXPTR ", 0x%08" PRIXPTR "\n", (uintptr_t)mem, (uintptr_t)ptr);
    memset_16aligned(ptr, 0, 1024);
    free(mem);
    return(0);
} 
```

这是一个稍微更通用的版本，它适用于 2 的幂的大小：

```
#include <assert.h>
#include <inttypes.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

static void memset_16aligned(void *space, char byte, size_t nbytes)
{
    assert((nbytes & 0x0F) == 0);
    assert(((uintptr_t)space & 0x0F) == 0);
    memset(space, byte, nbytes);  // Not a custom implementation of memset()
}

static void test_mask(size_t align)
{
    uintptr_t mask = ~(uintptr_t)(align - 1);
    void *mem = malloc(1024+align-1);
    void *ptr = (void *)(((uintptr_t)mem+align-1) & mask);
    assert((align & (align - 1)) == 0);
    printf("0x%08" PRIXPTR ", 0x%08" PRIXPTR "\n", (uintptr_t)mem, (uintptr_t)ptr);
    memset_16aligned(ptr, 0, 1024);
    free(mem);
}

int main(void)
{
    test_mask(16);
    test_mask(32);
    test_mask(64);
    test_mask(128);
    return(0);
} 
```

为了转换`test_mask()`为通用分配函数，分配器的单个返回值必须对释放地址进行编码，正如一些人在他们的回答中指出的那样。

### 面试官的问题

[Uri](https://stackoverflow.com/users/23072/uri)评论说：也许我今天早上有 [a] 阅读理解问题，但如果面试问题特别说：“你将如何分配 1024 字节的内存”，而你显然分配的不止这些。这不会是面试官自动失败吗？

我的回复不适合 300 个字符的评论...

这取决于，我想。我认为大多数人（包括我）都认为这个问题的意思是“你将如何分配一个可以存储 1024 字节数据的空间，并且基地址是 16 字节的倍数”。如果面试官的意思是你如何分配 1024 字节（仅）并使其 16 字节对齐，那么选项就更有限了。

*   显然，一种可能性是分配 1024 个字节，然后对该地址进行“对齐处理”；这种方法的问题是实际可用空间没有正确确定（可用空间在 1008 到 1024 字节之间，但没有可用于指定大小的机制），这使得它不太有用。
*   另一种可能性是您应该编写一个完整的内存分配器并确保您返回的 1024 字节块是适当对齐的。如果是这种情况，您最终可能会执行与建议的解决方案非常相似的操作，但是您将其隐藏在分配器中。

但是，如果面试官期望这些回答中的任何一个，我希望他们认识到这个解决方案回答了一个密切相关的问题，然后重新构建他们的问题以将对话指向正确的方向。（此外，如果面试官真的很草率，那我就不想要这份工作；如果对一个不够精确的要求的答案在没有纠正的情况下被炮轰，那么面试官就不是可以安全工作的人。）

### 世界继续前进

问题的标题最近发生了变化。难倒我的是*解决 C 面试问题中的内存对齐问题*。修改后的标题（*如何仅使用标准库分配对齐的内存？*）需要稍微修改的答案——这个附录提供了它。

C11 (ISO/IEC 9899:2011) 新增功能`aligned_alloc()`：

> **7.22.3.1`aligned_alloc`功能**
> 
> **概要**
> 
> ```
> #include <stdlib.h>
> void *aligned_alloc(size_t alignment, size_t size); 
> ```
> 
> **说明**
> 该`aligned_alloc`函数为对象分配空间，该对象的对齐方式由 指定`alignment`，其大小由 指定`size`，其值为不确定。的值`alignment`应该是实现支持的有效对齐方式，并且的值`size`应该是 的整数倍`alignment`。
> 
> **返回**
> 该`aligned_alloc`函数返回一个空指针或一个指向已分配空间的指针。

POSIX 定义[`posix_memalign()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/posix_memalign.html)：

> ```
> #include <stdlib.h>
> 
> int posix_memalign(void **memptr, size_t alignment, size_t size); 
> ```
> 
> 描述
> 
> 该`posix_memalign()`函数应分配`size`在 指定的边界上对齐的字节`alignment`，并应返回指向在 中分配的内存的指针`memptr`。的值`alignment`应是 的两倍的幂`sizeof(void *)`。
> 
> 成功完成后， 指向的值`memptr`应为 的倍数`alignment`。
> 
> 如果请求的空间大小为 0，则行为是实现定义的；返回的值`memptr`应为空指针或唯一指针。
> 
> 该`free()`函数应释放先前已分配的内存`posix_memalign()`。
> 
> 返回值
> 
> 成功完成后，`posix_memalign()`应返回零；否则，应返回错误号以指示错误。

现在可以使用其中一个或两个来回答这个问题，但是当最初回答这个问题时，只有 POSIX 函数是一个选项。

在幕后，新的对齐内存功能与问题中概述的工作大致相同，除了它们能够更轻松地强制对齐，并在内部跟踪对齐内存的开始，这样代码就不会必须特别处理——它只是释放所使用的分配函数返回的内存。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-10-23T00:22:32.863

根据您对问题的看法，三个略有不同的答案：

1）对于提出的确切问题来说，Jonathan Leffler 的解决方案已经足够了，除了四舍五入到 16 位对齐，您只需要 15 个额外字节，而不是 16 个。

A：

```
/* allocate a buffer with room to add 0-15 bytes to ensure 16-alignment */
void *mem = malloc(1024+15);
ASSERT(mem); // some kind of error-handling code
/* round up to multiple of 16: add 15 and then round down by masking */
void *ptr = ((char*)mem+15) & ~ (size_t)0x0F; 
```

乙：

```
free(mem); 
```

2) 对于更通用的内存分配函数，调用者不希望跟踪两个指针（一个用于使用，一个用于释放）。因此，您将指向“真实”缓冲区的指针存储在对齐缓冲区下方。

A：

```
void *mem = malloc(1024+15+sizeof(void*));
if (!mem) return mem;
void *ptr = ((char*)mem+sizeof(void*)+15) & ~ (size_t)0x0F;
((void**)ptr)[-1] = mem;
return ptr; 
```

乙：

```
if (ptr) free(((void**)ptr)[-1]); 
```

请注意，与 (1) 不同，其中仅向 mem 添加了 15 个字节，如果您的实现恰好保证 malloc 的 32 字节对齐，则此代码实际上可以*减少*对齐（不太可能，但理论上 C 实现可能有 32 字节对齐类型）。如果您所做的只是调用 memset_16aligned，这并不重要，但如果您将内存用于结构，那么它可能很重要。

我不确定对此有什么好的解决方法（除了警告用户返回的缓冲区不一定适用于任意结构），因为无法以编程方式确定特定于实现的对齐保证是什么。我猜在启动时您可以分配两个或更多的 1 字节缓冲区，并假设您看到的最差对齐是保证对齐。如果你错了，你就会浪费内存。谁有更好的主意，请说出来...

[*补充*：“标准”技巧是创建一个“可能是最大对齐类型”的联合，以确定必要的对齐方式。最大对齐的类型可能是（在 C99 中）' `long long`'、' `long double`'、' `void *`' 或 ' `void (*)(void)`'；如果包含`<stdint.h>`，您大概可以使用 ' `intmax_t`' 代替`long long`（并且，在 Power 6 (AIX) 机器上，`intmax_t`会给您一个 128 位整数类型）。该联合的对齐要求可以通过将其嵌入到具有单个字符后跟联合的结构中来确定：

```
struct alignment
{
    char     c;
    union
    {
        intmax_t      imax;
        long double   ldbl;
        void         *vptr;
        void        (*fptr)(void);
    }        u;
} align_data;
size_t align = (char *)&align_data.u.imax - &align_data.c; 
```

然后，您将使用请求的对齐方式中的较大者（在示例中为 16）和`align`上面计算的值。

在（64 位）Solaris 10 上，结果的基本对齐方式似乎`malloc()`是 32 字节的倍数。
]

在实践中，对齐的分配器通常采用一个参数来进行对齐，而不是硬连线。因此，用户将传递他们关心的结构的大小（或大于或等于该结构的 2 的最小幂），一切都会好起来的。

3) 使用您的平台提供的内容：`posix_memalign`对于 POSIX，`_aligned_malloc`在 Windows 上。

4) 如果您使用 C11，那么最干净 - 可移植和简洁 - 选项是使用[`aligned_alloc`](http://en.cppreference.com/w/c/memory/aligned_alloc)此版本语言规范中引入的标准库函数。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-10-22T23:36:01.457

您也可以尝试[`posix_memalign()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/posix_memalign.html)（当然在 POSIX 平台上）。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-23T00:46:25.310

这是“汇总”部分的另一种方法。不是最出色的编码解决方案，但它完成了工作，并且这种类型的语法更容易记住（另外适用于不是 2 的幂的对齐值）。`uintptr_t`演员表是安抚编译器所必需的；指针算术不太喜欢除法或乘法。

```
void *mem = malloc(1024 + 15);
void *ptr = (void*) ((uintptr_t) mem + 15) / 16 * 16;
memset_16aligned(ptr, 0, 1024);
free(mem); 
```

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2010-08-07T10:36:21.557

不幸的是，在 C99 中，似乎很难以一种可以在任何符合 C99 的 C 实现中移植的方式保证任何类型的对齐。为什么？因为不能保证指针是“字节地址”，所以人们可能会在平面内存模型中想象。**uintptr_t**的表示也没有得到保证，它本身就是一个可选类型。

我们可能知道一些使用**void ***表示的实现（根据定义，还有**char ***），它是一个简单的字节地址，但在 C99 中它对我们程序员来说是不透明的。*一个实现可以用一个集合 { segment* , *offset* }来表示一个指针，其中*offset*可以“在现实中”有谁知道什么对齐。为什么，指针甚至可以是某种形式的哈希表查找值，甚至是链表查找值。它可以编码边界信息。

在最近的 C 标准 C1X 草案中，我们看到了**_Alignas**关键字。这可能有点帮助。

C99 给我们的唯一保证是内存分配函数将返回一个适合分配给指向任何对象类型的指针的指针。由于我们无法指定对象的对齐方式，因此我们无法实现自己的分配函数，负责以明确定义、可移植的方式对齐。

如果这个说法是错误的，那就太好了。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-10-21T16:40:40.810

在 16 与 15 字节计数填充前面，您需要添加以获得 N 对齐的实际数字是**max(0,NM)**，其中 M 是内存分配器的自然对齐（两者都是 2 的幂）。

由于任何分配器的最小内存对齐是 1 个字节，因此 15=max(0,16-1) 是一个保守的答案。但是，如果您知道您的内存分配器将为您提供 32 位 int 对齐地址（这很常见），您可以使用 12 作为填充。

这对于本示例并不重要，但在具有 12K RAM 的嵌入式系统上可能很重要，其中保存的每个 int 都很重要。

如果您实际上要尝试保存每个可能的字节，那么实现它的最佳方法是将其作为宏，以便您可以将其提供给您的本机内存对齐。同样，这可能仅对需要保存每个字节的嵌入式系统有用。

在下面的示例中，在大多数系统上，值 1 正好适用于`MEMORY_ALLOCATOR_NATIVE_ALIGNMENT`，但是对于我们理论上具有 32 位对齐分配的嵌入式系统，以下可以节省一点点宝贵的内存：

```
#define MEMORY_ALLOCATOR_NATIVE_ALIGNMENT    4
#define ALIGN_PAD2(N,M) (((N)>(M)) ? ((N)-(M)) : 0)
#define ALIGN_PAD(N) ALIGN_PAD2((N), MEMORY_ALLOCATOR_NATIVE_ALIGNMENT) 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-10-22T23:42:39.650

[也许他们会对memalign](http://www.gnu.org/software/libtool/manual/libc/Aligned-Memory-Blocks.html#Aligned-Memory-Blocks)的知识感到满意？正如 Jonathan Leffler 指出的那样，有两个更新的首选函数需要了解。

哎呀，弗洛林打败了我。但是，如果您阅读我链接到的手册页，您很可能会理解早期海报提供的示例。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-07-14T16:34:12.040

我很惊讶没有人投票赞成[Shao](https://stackoverflow.com/users/413771/shao)的[回答](https://stackoverflow.com/a/3430102)，据我所知，不可能按照标准 C99 的要求去做，因为将指针正式转换为整数类型是未定义的行为。（除了标准允许转换`uintptr_t`<-> `void*`，但标准似乎不允许对`uintptr_t`值进行任何操作然后将其转换回来。）

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-06-05T05:19:14.063

我们一直在为 Accelerate.framework 做这种事情，这是一个高度矢量化的 OS X / iOS 库，我们必须一直注意对齐。有很多选择，其中一两个我在上面没有看到。

对于像这样的小数组，最快的方法就是把它贴在堆栈上。使用 GCC/clang：

```
 void my_func( void )
 {
     uint8_t array[1024] __attribute__ ((aligned(16)));
     ...
 } 
```

不需要 free()。这通常是两条指令：从堆栈指针中减去 1024，然后将堆栈指针与 -alignment 相加。据推测，请求者需要堆上的数据，因为数组的寿命超过了堆栈，或者递归正在工作，或者堆栈空间非常宝贵。

在 OS X / iOS 上，所有对 malloc/calloc/etc 的调用。总是 16 字节对齐。例如，如果您需要为 AVX 对齐 32 字节，那么您可以使用 posix_memalign：

```
void *buf = NULL;
int err = posix_memalign( &buf, 32 /*alignment*/, 1024 /*size*/);
if( err )
   RunInCirclesWaivingArmsWildly();
...
free(buf); 
```

有些人提到了类似的 C++ 接口。

不应该忘记，页面是按 2 的大幂次对齐的，所以页面对齐的缓冲区也是 16 字节对齐的。因此，mmap() 和 valloc() 以及其他类似的接口也是可选的。mmap() 的优点是，如果需要，可以使用其中的非零值预初始化缓冲区。由于它们具有页面对齐大小，因此您不会从中获得最小分配，并且在您第一次触摸它时可能会出现 VM 故障。

Cheesy：打开保护 malloc 或类似的。像这个这样大小为 n*16 字节的缓冲区将对齐 n*16 字节，因为 VM 用于捕获溢出并且其边界位于页面边界处。

一些 Accelerate.framework 函数采用用户提供的临时缓冲区作为暂存空间。在这里，我们必须假设传递给我们的缓冲区严重错位，并且用户正在积极尝试使我们的生活变得艰难。（我们的测试用例在临时缓冲区之前和之后粘贴了一个保护页以强调恶意。）在这里，我们返回我们需要保证其中某处有一个 16 字节对齐段所需的最小大小，然后手动对齐缓冲区。这个大小是desired_size + alignment - 1。所以，在这种情况下是1024 + 16 - 1 = 1039字节。然后像这样对齐：

```
#include <stdint.h>
void My_func( uint8_t *tempBuf, ... )
{
    uint8_t *alignedBuf = (uint8_t*) 
                          (((uintptr_t) tempBuf + ((uintptr_t)alignment-1)) 
                                        & -((uintptr_t) alignment));
    ...
} 
```

*添加alignment-1 会将指针移过第一个对齐的地址，然后与-alignment 进行与运算（例如，对齐= 16 的0xfff...ff0）将其返回到对齐的地址。*

正如其他帖子所描述的，在其他没有 16 字节对齐保证的操作系统上，您可以调用具有更大大小的 malloc，稍后为 free() 留出指针，然后按照上面描述的方式对齐并使用对齐的指针，就像描述了我们的临时缓冲区案例。

至于aligned_memset，这是相当愚蠢的。您只需循环最多 15 个字节即可到达对齐的地址，然后在最后使用一些可能的清理代码继续对齐存储。您甚至可以在向量代码中进行清理位，或者作为与对齐区域重叠的未对齐存储（假设长度至少是向量的长度）或使用类似 movmaskdqu 的东西。有人只是懒惰。但是，如果面试官想知道您是否对 stdint.h、位运算符和内存基础知识感到满意，这可能是一个合理的面试问题，因此可以原谅人为设计的示例。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2010-10-12T18:09:09.643

使用 memalign、[Aligned-Memory-Blocks](http://www.gnu.org/s/libc/manual/html_node/Aligned-Memory-Blocks.html)可能是解决问题的好方法。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-05-10T21:28:41.873

阅读这个问题时，我首先想到的是定义一个对齐的结构，实例化它，然后指向它。

由于没有其他人建议，我是否有一个根本原因失踪？

作为旁注，由于我使用了一个 char 数组（假设系统的 char 是 8 位（即 1 个字节）），我认为没有`__attribute__((packed))`必要（如果我错了，请纠正我），但我把它以任何方式。

这适用于我尝试过的两个系统，但可能存在编译器优化，我不知道给我带来了相对于代码功效的误报。我`gcc 4.9.2`在 OSX 和`gcc 5.2.1`Ubuntu 上使用过。

```
#include <stdio.h>
#include <stdlib.h>

int main ()
{

   void *mem;

   void *ptr;

   // answer a) here
   struct __attribute__((packed)) s_CozyMem {
       char acSpace[16];
   };

   mem = malloc(sizeof(struct s_CozyMem));
   ptr = mem;

   // memset_16aligned(ptr, 0, 1024);

   // Check if it's aligned
   if(((unsigned long)ptr & 15) == 0) printf("Aligned to 16 bytes.\n");
   else printf("Rubbish.\n");

   // answer b) here
   free(mem);

   return 1;
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-11-25T13:23:51.053

MacOS X 特定：

1.  所有用 malloc 分配的指针都是 16 字节对齐的。
2.  支持 C11，因此您只需调用 aligned_malloc (16, size)。

3.  MacOS X 在启动时为 memset、memcpy 和 memmove 选择针对单个处理器进行优化的代码，并且该代码使用您从未听说过的技巧来加快速度。memset 有 99% 的几率比任何手写的 memset16 运行得更快，这使得整个问题毫无意义。

如果你想要一个 100% 便携的解决方案，在 C11 之前没有。因为没有可移植的方法来测试指针的对齐方式。如果它不必是 100% 便携的，你可以使用

```
char* p = malloc (size + 15);
p += (- (unsigned int) p) % 16; 
```

这假设在将指针转换为无符号整数时，指针的对齐方式存储在最低位中。转换为 unsigned int 会丢失信息并且是实现定义的，但这并不重要，因为我们不会将结果转换回指针。

可怕的部分当然是原始指针必须保存在某个地方才能用它调用 free() 。所以总而言之，我真的怀疑这种设计的智慧。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-03-25T18:27:14.500

您还可以添加一些 16 字节，然后通过在指针下方添加 (16-mod) 将原始 ptr 推送到 16 位对齐：

```
main(){
void *mem1 = malloc(1024+16);
void *mem = ((char*)mem1)+1; // force misalign ( my computer always aligns)
printf ( " ptr = %p \n ", mem );
void *ptr = ((long)mem+16) & ~ 0x0F;
printf ( " aligned ptr = %p \n ", ptr );

printf (" ptr after adding diff mod %p (same as above ) ", (long)mem1 + (16 -((long)mem1%16)) );

free(mem1);
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-11-25T14:00:38.330

如果有限制，你不能浪费一个字节，那么这个解决方案有效：注意：有一种情况可以无限执行：D

```
 void *mem;  
   void *ptr;
try:
   mem =  malloc(1024);  
   if (mem % 16 != 0) {  
       free(mem);  
       goto try;
   }  
   ptr = mem;  
   memset_16aligned(ptr, 0, 1024); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-03-14T14:05:20.757

对于解决方案，我使用了填充的概念，它对齐内存并且不浪费单个字节的内存。

如果有限制，你不能浪费一个字节。所有用 malloc 分配的指针都是 16 字节对齐的。

支持 C11，因此您只需调用`aligned_alloc (16, size)`.

```
void *mem = malloc(1024+16);
void *ptr = ((char *)mem+16) & ~ 0x0F;
memset_16aligned(ptr, 0, 1024);
free(mem); 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2019-11-06T18:46:04.013

```
size =1024;
alignment = 16;
aligned_size = size +(alignment -(size %  alignment));
mem = malloc(aligned_size);
memset_16aligned(mem, 0, 1024);
free(mem); 
```

希望这是最简单的实现，让我知道您的意见。

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2012-09-04T08:58:41.210

```
long add;   
mem = (void*)malloc(1024 +15);
add = (long)mem;
add = add - (add % 16);//align to 16 byte boundary
ptr = (whatever*)(add); 
```

# version-control - 如何对包含多个应用程序的包进行版本控制

> ID：227905
> 
> 赞同：2
> 
> 时间：2008-10-22T23:29:09.710
> 
> 标签：version-control, packaging

我想创建一个包含三个应用程序的 MSI 安装程序。在处理功能请求列表并进行错误修复时，我将频繁发布每个应用程序的更新。这三个应用程序目前分别为 1.6.3、1.6.12 和 1.8.1 版本。

我想知道你们可以为该软件包的版本推荐什么。我是不是该：

1.  使软件包版本独立于各个应用程序的版本？
2.  更改应用程序，使它们始终具有相同的版本？
3.  其他一些建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T23:42:13.660

每次其中一个应用程序的版本发生更改时，都修改软件包版本。然后，您可以查看软件包版本并准确了解每个应用程序正在使用的版本。

示例：主版本 1.4.1 具有 (1.6.3, 1.6.12, 1.8.1)

主版本 1.4.2 有 (1.6.3, 1.6.13, 1.8.1)

主版本 1.5.0 有 (1.7.0, 1.6.13, 1.8.2)

主版本 2.0.0 有 (1.7.0, 1.6.14, 2.0.0)

因此，如果您正在对您的某个应用程序进行次要版本升级，则主应用程序也会上升一个次要版本号。对子应用程序的重大更改会导致主应用程序也获得主要版本号更改。

# ruby-on-rails - 如何查看对 ActiveResource 请求的 HTTP 响应？

> ID：227907
> 
> 赞同：7
> 
> 时间：2008-10-22T23:31:01.187
> 
> 标签：ruby-on-rails, ruby, activeresource

我正在尝试调试不起作用的 ActiveResource 调用。

查看 ActiveResource 发出的请求的 HTTP 响应的最佳方式是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-08-24T12:30:03.043

Monkey 修补连接以启用 Net::HTTP 调试模式。请参阅[https://gist.github.com/591601](https://gist.github.com/591601) - 我写它是为了解决这个问题。将此要点添加到您的 rails 应用程序将为您提供`Net::HTTP.enable_debug!`并且`Net::HTTP.disable_debug!`您可以使用它来打印调试信息。

Net::HTTP 调试模式是不安全的，不应该在生产中使用，但是对于调试来说非常有用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-11-07T18:25:43.070

添加一个新文件来`config/initializers/`调用`'debug_connection.rb'`，内容如下：

```
class ActiveResource::Connection
  # Creates new Net::HTTP instance for communication with
  # remote service and resources.
  def http
    http = Net::HTTP.new(@site.host, @site.port)
    http.use_ssl = @site.is_a?(URI::HTTPS)
    http.verify_mode = OpenSSL::SSL::VERIFY_NONE if http.use_ssl
    http.read_timeout = @timeout if @timeout
    # Here's the addition that allows you to see the output
    http.set_debug_output $stderr
    return http
  end
end 
```

这会将整个网络流量打印到 $stderr。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T02:58:41.563

我喜欢[Wireshark](http://www.wireshark.org/)，因为您可以在 Web 浏览器客户端（通常是您的开发机器）上启动它，然后执行页面请求。然后你可以找到HTTP数据包，右键点击“Follow Conversation”可以看到HTTP头来回移动。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-25T13:09:11.073

这简单。只需查看返回的响应即可。:)

两种选择：

*   您的计算机上有源文件。编辑它。`puts response.inspect`在适当的地方放一个。记得删除它。
*   Ruby 有开放课程。找到正确的方法并重新定义它以完全满足您的需求，或者使用别名和调用链来执行此操作。可能有一种方法可以返回响应——抓取它，打印它，然后返回它。

这是后一种选择的一个愚蠢的例子。

```
# Somewhere buried in ActiveResource:
class Network
  def get
    return get_request
  end

  def get_request
    "I'm a request!"
  end
end

# Somewhere in your source files:
class Network
  def print_request
    request = old_get_request
    puts request
    request
  end
  alias :old_get_request :get_request
  alias :get_request :print_request
end 
```

想象第一个类定义在 ActiveRecord 源文件中。第二个类定义在您的应用程序中的某个地方。

```
$ irb -r openclasses.rb 
>> Network.new.get
I'm a request!
=> "I'm a request!" 
```

您可以看到它打印它然后返回它。整齐吧？

（虽然我的简单示例没有使用它，因为它没有使用 Rails，但请检查`alias_method_chain`以组合您的别名调用。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T09:20:24.140

这仅在您还控制服务器时才有效：

按照服务器日志，找出被调用的 URL：

```
Completed in 0.26889 (3 reqs/sec) | Rendering: 0.00036 (0%) | DB: 0.02424 (9%) | 200 OK [http://localhost/notifications/summary.xml?person_id=25738] 
```

然后在 Firefox 中打开它。如果服务器是真正的 RESTful（即无状态），您将获得与 ARes 相同的响应。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T23:31:21.093

也许最好的方法是使用流量嗅探器。

（这完全可以工作......除了在我的情况下，我想看到的流量是加密的。D'oh！）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T02:06:04.587

或者当我不知道确切的内部结构时，我进入事物的方法实际上只是抛出一个“调试器”语句，使用“脚本/服务器 --debugger”启动服务器，然后逐步执行代码直到我'我在我想要的地方，然后在 IRB 那里开始一些检​​查.....这可能会有所帮助（嘿卢克顺便说一句）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-09-26T09:17:20.733

我会在这里使用[TCPFlow](http://www.circlemud.org/jelson/software/tcpflow/)来观察通过网络传输的流量，而不是修补我的应用程序来输出它。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-25T17:40:44.410

firefox 插件 live http headers ( [http://livehttpheaders.mozdev.org/](http://livehttpheaders.mozdev.org/) ) 非常适合这个。或者您可以使用[http://www.httpviewer.net/之类的网站工具](http://www.httpviewer.net/)

# c# - C# WPF 中的内存泄漏

> ID：227909
> 
> 赞同：27
> 
> 时间：2008-10-22T23:31:26.413
> 
> 标签：c#, memory-leaks, garbage-collection, profiling

我可以使用一些建议来追踪 C# 中内存泄漏的原因。我了解什么是内存泄漏，并且知道它们为什么会在 C# 中发生，但我想知道您过去使用过哪些工具/策略来解决它们？

我正在使用.NET Memory Profiler，我发现我的一个巨大的主要对象在我关闭它管理的窗口后仍留在内存中，但我不确定如何处理它的所有链接。

如果我不够清楚，只需发布​​一个问题的答案，我将编辑我的问题作为回应。谢谢！

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-22T23:56:28.063

进入调试器，然后在“立即”窗口中键入：

```
.load C:\Windows\Microsoft.NET\Framework\v2.0.50727\sos.dll 
```

sos.dll 的路径各不相同。找出正确路径的方法是在“模块”窗格中查找 mscorwks.dll。无论从哪里加载，都是 sos.dll 的正确路径。

然后输入：

```
System.GC.Collect() 
```

这将确保收集到任何无法到达的东西。然后输入：

```
!DumpHeap -type <some-type-name> 
```

这将向您显示所有现有实例的表格以及地址。您可以像这样找出使实例保持活动状态的原因：

```
!gcroot <some-address> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-23T04:54:48.523

.NET Memory Profiler 是一款出色的工具，我经常使用它来诊断 WPF 应用程序中的内存泄漏。

我相信您知道，使用它的一个好方法是在使用特定功能之前拍摄快照，然后在使用它、关闭窗口等之后拍摄第二张快照。比较两个快照时，您可以查看有多少某种类型的对象被分配但没有被释放：这是一个泄漏。

双击一个类型后，分析器将向您显示使该类型对象保持活动状态的最短根路径。.NET 对象在 WPF 中泄漏的方式有很多种，因此发布您看到的根路径应该有助于确定最终原因。但是，一般来说，尝试了解为什么这些对象会保留您的对象，并查看是否有某种方法可以在窗口关闭时分离您的事件处理程序、绑定等。

我最近发布了一篇关于可能由某些绑定引起的特定[内存泄漏的](http://support.microsoft.com/kb/938416)[博客文章；](http://code.logos.com/blog/2008/10/detecting_bindings_that_should_be_onetime.html)对于特定类型的泄漏，那里的代码对于查找有问题的绑定很有用。

# model-view-controller - 使用 MVC，应该如何处理 View 之间的通信？模型之间？

> ID：227919
> 
> 赞同：5
> 
> 时间：2008-10-22T23:34:38.183
> 
> 标签：model-view-controller, model, view, controller, components

*在我实施 MVC之前*，我寻求正确理解 MVC 的第三个问题：

我想到了两种情况：

1.  主应用程序窗口需要启动首选项窗口。（一个视图调用另一个视图。）
2.  应用程序的主要模型需要访问首选项模型中的属性。（一个模型访问另一个模型。）

这些问题是相关的，因为它们都涉及模型-视图-控制器三元组之间的通信，这是我在谷歌搜索中没有找到太多讨论的主题。

解决此问题的明显方法是将所有内容包装在一个顶级“应用程序”对象中，该对象处理模型之间的事务并允许控制器调用彼此的方法。我已经看到了这个实现，但我不相信这是一个好主意。我还可以看到涉及控制器观察多个模型并响应多个视图的可能性，但这似乎会变得非常混乱且难以理解。

关于如何最好地实施这种串扰的建议？我觉得这是一个非常明显的问题，但我一直无法找到一个有据可查的解决方案。

从更广泛的角度来看，如果有人有显示这些 MVC 问题的典型方法的链接，我很乐意看到它。我没有太多运气找到可靠的、重要的参考资料。Python 中的示例会很可爱，但我很乐意阅读任何内容。

**编辑 1**：

我看到下面说了一些非常有趣的事情，总的来说，我描述的方法似乎没有人有问题。它已经几乎是 Vincent 所描述的 FrontController 设计的一种惰性形式。我当然没有预见到在实现该模式时会出现任何问题，但是，似乎没有人真正解决过关于模型之间通信的问题。所有的答案似乎都在解决单个模型中对象之间的通信。我对为应用程序的单独组件维护单独的模型更感兴趣，因此我不会将 50 个状态属性填充到单个模型类中。我应该将它们维护为子模型吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T23:58:01.740

关于 (1)，视图不调用其他视图。它们调用可能导致呈现其他视图的控制器操作。在您的情况下，主应用程序窗口包含一个用户界面元素（按钮、链接），该元素调用控制器操作来显示首选项窗口。

关于（3），模型组件当然可以相互关联。这不是意外，也不是必须避免的。例如，您的 Customer 模型可能有一组关联的 Orders。通过 Customer 类中的方法访问客户的订单是非常自然的。

您可能想查看 wikipedia 上的[MVC 页面](http://en.wikipedia.org/wiki/Model-view-controller)以获得概述。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T23:53:59.097

您可能需要考虑查找前端控制器设计模式。

> 前端控制器模式定义了一个负责处理应用程序请求的组件。前端控制器集中了视图选择、安全性和模板等功能，并将它们一致地应用于所有页面或视图。因此，当这些函数的行为需要改变时，只需要改变应用程序的一小部分：控制器及其辅助类。

这样，来自视图的所有请求都会发送到 FrontController，然后由 FrontController 决定调用哪个特定操作（控制器）。有时，它可能会像您的第一种情况一样直接转发到另一个视图。

模型中的多个对象相互交谈没有问题。事实上，这将是非常普遍的。在我看来，模型中的所有对象就像一个组件来表示数据和对数据的操作。

[这篇](http://msdn.microsoft.com/en-us/library/ms978723.aspx)文章可能会有所帮助。还有[这个](http://java.sun.com/blueprints/patterns/FrontController.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T00:05:55.143

模型并不意味着单个模型对象。模型是整个域模型的子集，它与控制器操作和相关视图直接相关。

# installation - 是否有任何 NSIS 最佳实践或编码标准？

> ID：227923
> 
> 赞同：6
> 
> 时间：2008-10-22T23:36:39.523
> 
> 标签：installation, coding-style, nsis

我正在创建几个 NSIS 安装程序，随着我在这方面的专业知识的增长，我不再满足于让事情正常工作，我想看看是否有一些围绕这种语言的最佳实践或编码标准，比如如何编写条件、变量名、卸载程序等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T11:13:35.433

据我所知，没有可用的 NSIS 特定编码标准——但有很多[教程](http://nsis.sourceforge.net/Category:Tutorials)和[示例](http://nsis.sourceforge.net/Category:Code_Examples)可供学习。与您尝试掌握的所有其他语言一样，我认为阅读其他人的代码会很有帮助，并会激发您朝不同方向思考。

根据我自己使用 NSIS 的经验，我还可以建议定期整理您的安装程序脚本。当您学习新事物时，旧的解决方法会变得过时，可以被适当的解决方案取代。还要注意新的发展。在我们能够使用 nsDialogs 之前，InstallOptions 是用户定义对话框的最佳选择——现在用更少的代码更容易做到这一点。

由于您的目标是创建多个安装程序，因此我也会尝试在不同的安装程序中重用尽可能多的代码。使用 .nsh 文件可以实现模块化共享功能，并培养良好且干净的代码库。

# svn - Subversion Auth：无法再访问“存储库集合”页面

> ID：227924
> 
> 赞同：0
> 
> 时间：2008-10-22T23:36:54.623
> 
> 标签：svn

在向 svn 添加身份验证和访问规则后，我看不到“存储库集合”页面。“访客”可以导航到 mydomain.com/svn/public，管理员可以同时看到 svn/public 和 svn/private，但没有一个用户可以看到/svn。

是否可以让“访客”访问 mydomain.com/svn 并且只看到 /public 链接？

这是我设置的...

**颠覆.conf：**

```
<location /svn>
DAV svn
SVNParentPath /home/subversion
SVNListParentPath on

AuthzSVNAccessFile /etc/svn-access-file

AuthType Basic
AuthName "Subversion Repository"
AuthUserFile /etc/svn-auth-file
Require valid-user 
</Location> 
```

**svn-访问文件：**

```
[public:/]
guest = r
@admin = rw

[private:/]
@admin = rw

[groups]
admin = karl.r 
```

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T09:31:37.887

这可能不是您想要的，但我们已经完全停止使用存储库页面的集合。相反，我们使用带有 Calm 主题的 websvn：[http](http://websvn.tigris.org/) ://websvn.tigris.org/屏幕截图： [http](http://chrison.net/content/binary/websvn2.png) ://chrison.net/content/binary/websvn2.png （不是我的屏幕截图）。

通过 Apache 的 DAV 模块授予访问权限，在默认站点配置（启用站点/默认）中使用它：

```
<Location /websvn>
   AuthType Basic
   AuthName "Company WebSVN"
   AuthUserFile /home/svn/dav_svn.passwd
   Require group developers
   AuthGroupFile /home/svn/dav_svn_groups
</Location> 
```

您可能不需要 group 行，在需要的地方用 valid-user 代替。

PS 我刚刚注意到我们的 /svn/ 目录和你的一样，没有尾随的 / 就无法工作。Websvn 确实可以工作，不管有没有斜杠！现在，我已经在我们的 httpd.conf 中将 /svn 重定向到 /svn/，这解决了这个问题。我使用了以下重定向语句：

```
RedirectMatch ^(/svn)$ $1/ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T08:31:10.503

使用 < location /svn/ > 修复它，现在所有 repos 都可以从 /svn/ 看到，如果客人点击“私人”，它会将它们锁定。

但是，它只适用于 url 中的斜杠。mydomain.com/svn/ 有效，但 mydomain.com/svn 无效。

# python - python中的win32con模块是什么？我在哪里可以找到它？

> ID：227928
> 
> 赞同：47
> 
> 时间：2008-10-22T23:38:30.300
> 
> 标签：python, module

我正在构建一个在 Windows 中使用 python 和 c++ 的开源项目。我收到以下错误消息：

```
 ImportError: No module named win32con 
```

同样的情况发生在它正在工作的“预建”代码中（除了在我的电脑中：P）

我认为这是 python 中的一种“流行”模块，因为我在其他论坛上看到了几条消息，但没有一条可以帮助我。

我有 Python2.6，我应该已经安装了那个模块吗？那是VC++的东西吗？

感谢您的帮助。

我得到了这个网址[http://sourceforge.net/projects/pywin32/](http://sourceforge.net/projects/pywin32/) 但我不确定如何处理可执行文件：S

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2016-09-05T11:29:31.733

```
pip install pypiwin32 
```

[Glyph](https://glyph.twistedmatrix.com)已经打包了它，直到有人在`pywin32`构建过程中发送补丁来构建轮子以关闭[https://sourceforge.net/p/pywin32/bugs/680/](https://sourceforge.net/p/pywin32/bugs/680/)

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-22T23:40:26.630

该模块包含与 Win32 编程相关的常量。它不是 Python 2.6 版本的一部分，但应该是 pywin32 项目下载的一部分。

**编辑：**我想可执行文件是一个安装程序，虽然我上次下载 pywin32 它只是一个 zip 文件。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-06-04T18:59:55.523

好的，我在这里偶然发现了两次安装在两台机器上，所以这里是该资源的快速链接

[http://sourceforge.net/projects/pywin32/files/pywin32/](http://sourceforge.net/projects/pywin32/files/pywin32/)

这是项目的实际下载页面，现在是自述文件下载

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2020-04-26T22:17:31.230

如果您安装了 pywin32，则可以在 python 3.7+ 中执行

```
import win32.lib.win32con as win32con 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-23T05:56:35.543

请注意，[Pywin32 下载](http://sourceforge.net/project/platformdownload.php?group_id=78018)页面包含 2.6 版（i386 和 AMD64）的安装程序。[ActiveState](http://www.activestate.com/Products/activepython/feature_list.mhtml)发行版是*包含 pywin32 的单个安装程序*-当前版本为 2.5.2。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-11-20T03:10:48.303

PyWin32 下载参考（包括项目参考）可在[pypi](https://pypi.python.org/pypi/pywin32)注册表中找到。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2019-04-05T23:03:43.483

导航到：C:\Python27\Lib\site-packages\win32\lib 并将 win32con.py 文件复制到您的项目目录中。

# cocoa - Cocoa 中是否有用于 Windows 中同步 TrackPopupMenu 的等效技术？

> ID：227935
> 
> 赞同：0
> 
> 时间：2008-10-22T23:41:28.623
> 
> 标签：cocoa, synchronous, nsmenu

为了响应 rightMouse 事件，我想调用一个显示上下文菜单、运行它并响应所选菜单项的函数。在 Windows 中，我可以使用带有 TPM_RETURNCMD 标志的 TrackPopupMenu。

在 Cocoa 中实现这一点的最简单方法是什么？似乎 NSMenu:popUpContextMenu 想要将事件发布到指定的 NSView。我必须创建一个虚拟视图并在返回之前等待事件吗？如果是这样，鉴于我没有返回我的 main ，我该如何“等待”或刷新事件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T00:00:06.463

在 Cocoa 中执行此操作的“正确”方法是让菜单项的目标和操作执行所需的方法。但是，如果您必须在初始调用中执行此操作，您可以使用它`[NSView nextEventMatchingMask:]`来不断获取您感兴趣的新事件、处理它们并循环。这是一个等待直到释放鼠标右键的示例。您可能想要使用更复杂的掩码参数，并不断调用`[NSView nextEventMatchingMask:]`，直到您得到您想要的。

```
`NSEvent *localEvent = [[self window] nextEventMatchingMask: NSRightMouseUpMask];` 
```

`我认为您会找到更容易的“正确”方法。`

 `* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T18:15:45.690

看来 popUpContextMenu 已经是同步的了。由于我没有看到使用 NSMenu 而不让它向 NSView 发送通知的方法，所以我想出了一个实例化临时 NSView 的方案。目标是显示弹出菜单并在单个函数调用的上下文中返回所选项目。以下是我提出的解决方案的代码片段：

```
// Dummy View class used to receive Menu Events

@interface DVFBaseView : NSView
{
    NSMenuItem* nsMenuItem;
}
- (void) OnMenuSelection:(id)sender;
- (NSMenuItem*)MenuItem;
@end

@implementation DVFBaseView
- (NSMenuItem*)MenuItem
{
    return nsMenuItem;
}

- (void)OnMenuSelection:(id)sender
{
    nsMenuItem = sender;
}

@end

// Calling Code (in response to rightMouseDown event in my main NSView

void HandleRButtonDown (NSPoint pt)
{
    NSRect    graphicsRect;  // contains an origin, width, height
    graphicsRect = NSMakeRect(200, 200, 50, 100);

    //-----------------------------
    // Create Menu and Dummy View
    //-----------------------------

    nsMenu = [[[NSMenu alloc] initWithTitle:@"Contextual Menu"] autorelease];
    nsView = [[[DVFBaseView alloc] initWithFrame:graphicsRect] autorelease];

    NSMenuItem* item = [nsMenu addItemWithTitle:@"Menu Item# 1" action:@selector(OnMenuSelection:) keyEquivalent:@""];

    [item setTag:ID_FIRST];

    item = [nsMenu addItemWithTitle:@"Menu Item #2" action:@selector(OnMenuSelection:) keyEquivalent:@""];

    [item setTag:ID_SECOND];
    //---------------------------------------------------------------------------------------------
// Providing a valid windowNumber is key in getting the Menu to display in the proper location
//---------------------------------------------------------------------------------------------

    int windowNumber = [(NSWindow*)myWindow windowNumber];
    NSRect frame = [(NSWindow*)myWindow frame];
    NSPoint wp = {pt.x, frame.size.height - pt.y};  // Origin in lower left

    NSEvent* event = [NSEvent otherEventWithType:NSApplicationDefined
                     location:wp
                     modifierFlags:NSApplicationDefined 
                     timestamp: (NSTimeInterval) 0
                     windowNumber: windowNumber
                     context: [NSGraphicsContext currentContext]
                     subtype:0
                     data1: 0
                     data2: 0]; 

    [NSMenu popUpContextMenu:nsMenu withEvent:event forView:nsView];      
    NSMenuItem* MenuItem = [nsView MenuItem];

    switch ([MenuItem tag])
    {
    case ID_FIRST: HandleFirstCommand(); break;
    case ID_SECOND: HandleSecondCommand(); break;
    }
 } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T03:52:20.957

除了不推荐使用的 Carbon 之外，没有直接的等价物。

要检测右键单击，请按照[这些说明](http://boredzo.org/blog/archives/2007-01-07/how-to-detect-a-click)进行操作。它们确保您能够正确检测右键单击和按住不放，并在应该显示菜单时显示菜单，在不应该显示时不显示菜单。

对于以下事件，您可以尝试`[[NSRunLoop currentRunLoop] runMode:NSEventTrackingRunLoopMode untilDate:[NSDate distantFuture]]`. 您需要反复调用它，直到用户选择了其中一个菜单项。

使用`nextEventMatchingMask:NSRightMouseUpMask`不会在所有情况下，甚至在大多数情况下都有效。如果用户在您的控件上单击*鼠标*右键，鼠标右键会在它下降后立即上升，而无需选择菜单项，并且菜单项选择可能（尽管不一定）通过鼠标左键发生。最好重复运行运行循环，直到用户选择某些内容或关闭菜单。

我不知道如何判断用户在没有选择任何内容的情况下关闭了菜单。

# http - 在 nginx 中处理 OPTIONS 请求

> ID：227939
> 
> 赞同：33
> 
> 时间：2008-10-22T23:42:19.637
> 
> 标签：http, nginx, haproxy, http-options-method

我们目前使用 HAProxy 作为负载均衡器，它会定期向下游框发出请求，以确保它们使用 OPTIONS 请求处于活动状态：

> 选项 /index.html HTTP/1.0

我正在将 nginx 设置为带有缓存的反向代理（使用 ncache）。出于某种原因，当 OPTIONS 请求进来时，nginx 会返回 405：

> 192.168.1.10 - - [22/Oct/2008:16:36:21 -0700]“选项/index.html HTTP/1.0”405 325“-”“-”192.168.1.10

直接访问下游网络服务器时，我得到正确的 200 响应。我的问题是：如何让 nginx 将该响应传递给 HAProxy，或者，如何在 nginx.conf 中设置响应？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2012-02-08T16:14:15.450

我可能迟到了，但我遇到了同样的问题，并找到了两个解决方案。

首先是欺骗 Nginx 405 状态实际上是 200 OK 然后 proxy_pass 它到你的 HAProxy 像这样：

```
error_page 405 =200 @405;
location @405 {
    root /;
    proxy_pass http://yourproxy:8080;
} 
```

第二种解决方案只是捕获 OPTIONS 请求并为这些请求构建响应：

```
location / {
    if ($request_method = OPTIONS ) {
        add_header Content-Length 0;
        add_header Content-Type text/plain;
        return 200;
    }
} 
```

只需选择哪个更适合您。

我在一篇[博文中写了这篇文章](http://blog.rogeriopvl.com/archives/nginx-and-the-http-options-method)，您可以在其中找到更多详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-11T21:27:12.383

在 httpchk 选项中，您可以像这样指定 HTTP 方法：

```
httpchk GET http://example.com/check.php 
```

您还可以使用 POST 或像 / 这样的普通 URI。我让它检查 PHP，因为 PHP 在 Nginx 外部运行。

# c# - HttpListenerRequest POST 参数在哪里？

> ID：227946
> 
> 赞同：5
> 
> 时间：2008-10-22T23:46:33.433
> 
> 标签：c#, .net, post, parameters, httplistenerrequest

我在[MSDN](http://msdn.microsoft.com/en-us/library/system.net.httplistenerrequest.aspx)中进行了搜索，但无法确定 HttpListenerRequest 的 POST 参数在哪里？

任何的想法？

*QueryString 似乎只有 Get 参数而不是 post

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T00:21:29.417

经过几个小时的搜索（我在这里发布之前一直在搜索），我意识到我需要发回一个请求来获取表单参数。因此，一旦我`HttpListenerRequest`填满了 POST 参数，就不在里面了。您需要发送其他请求来获取它们：

```
//POST param
if (webRequest.Method == "POST")
{
    StreamReader getPostParam = new StreamReader(request.InputStream, true);
    postData = getPostParam.ReadToEnd();
    byte[] postBuffer = System.Text.Encoding.Default.GetBytes(postData);
    postDataStream.Write(postBuffer, 0, postBuffer.Length);
    postDataStream.Close();
}
//END POST param 
```

# javascript - JavaScript 中的程序化重音减少（又名文本规范化或非重音）

> ID：227950
> 
> 赞同：50
> 
> 时间：2008-10-22T23:48:14.757
> 
> 标签：javascript, unicode, normalization, accent-insensitive, text-normalization

我需要比较两个字符串，例如：

> 吕贝克 == 吕贝克

在 JavaScript 中。

为什么？好吧，我有一个自动完成字段，它使用 Lucene 发送到 Java 服务，其中地名自然存储（如 Lübeck），但也作为规范化文本进行索引，

```
import sun.text.Normalizer;
oDoc.setNameLC = Normalizer.normalize(oLocName, Normalizer.DECOMP, 0)
    .toLowerCase().replaceAll("[^\\p{ASCII}]",""); 
```

这样，不知道输入“Mèxico”的人可以输入“mexico”并获得返回“Mèxico”的匹配项（在许多其他可能的点击中，例如“CaféMèxico，迪拜，阿联酋”）。

现在的问题是我无法更改服务以在服务器端进行任何突出显示，因此我在客户端 JavaScript 端突出显示类似的内容：

```
return result.replace( input.replace(/[aeiou]/g,"."), "<b>$1</b>"); 
```

这有点花哨，因为我在输入中转义了特殊的正则表达式字符。这对于在点击开始时简单的一个单词匹配很好，但如果你突然希望支持像“london cafe”这样的多单词匹配，它真的会崩溃：

```
input = input.strip().toLowerCase(); //fyi prototype's strip is like trim
re = new RegEx(input.replace(/[aeiou]/g,".").replace(/\s+/g,"|"),"gi");
return result.replace(re, "<b>$1</b>"); 
```

这不适用于说“london ca”（正在输入 london cafe），因为它会将“Jack London Cabin, Dawson City, Canada”标记为：`"Ja<b>ck</b> <b>London</b> <b>ca</b>bin, Dawson <b>Ci</b>ty, <b>Ca<b/>nada"`[特别注意“ck”和“Ci”]

因此，我正在寻找一些不像以下内容那么疯狂的东西：

```
input = input.strip().toLowerCase();
input = input.replace(/a/g,"[ÀàÁáÂâÃãÄäÅåÆæĀāĂăĄą]");
input = input.replace(/e/g,"[ÈèÉéÊêËëĒēĔĕĖėĘęĚě]");
// ditto for i, o, u, y, c, n, maybe also d, g, h, j, k, l, r, s, t, w, z 
re = new RegEx(input.replace(/\s+/g,"|"),"gi");
return result.replace(re, "<b>$1</b>"); 
```

是否有一个编译表我可以参考映射一系列字符，这些字符是另一个字符的重音版本到该字符，我不是指普通的 unicode 图表。如果是这样，我是否可以避免使用奇怪的、可能很慢的 RegEx 语句？

*关于赏金：*
在我开始赏金之前，有两个答案，一个是让我用 Ruby 来做，[另一个](https://stackoverflow.com/questions/227950/programatic-accent-reduction-in-javascript-aka-text-normalization-or-unaccenting/228006#228006)是[MizzardX](https://stackoverflow.com/users/22364/mizardx)写的，它是我在问题中提出的基本形式的完成。现在不要误会我的意思，我真的很感激能像他那样完全解决问题，但我只是希望可能有另一种方法。到目前为止，似乎每个路过查看问题和答案的人都认为 MizzardX 可以很好地涵盖它，或者他们没有不同的方法。我会对不同的方法感兴趣，如果在赏金关闭之前它根本不可用，MizzardX 将赢得赏金（尽管在残酷的转折中，他的编辑使它成为社区 wiki 的答案，所以我不确定是否他会得到赏金的！）

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-23T00:17:58.520

```
/**
 * Creates a RegExp that matches the words in the search string.
 * Case and accent insensitive.
 */
function make_pattern(search_string) {
    // escape meta characters
    search_string = search_string.replace(/([|()[{.+*?^$\\])/g,"\\$1");

    // split into words
    var words = search_string.split(/\s+/);

    // sort by length
    var length_comp = function (a,b) {
        return b.length - a.length;
    };
    words.sort(length_comp);

    // replace characters by their compositors
    var accent_replacer = function(chr) {
        return accented[chr.toUpperCase()] || chr;
    }
    for (var i = 0; i < words.length; i++) {
        words[i] = words[i].replace(/\S/g,accent_replacer);
    }

    // join as alternatives
    var regexp = words.join("|");
    return new RegExp(regexp,'g');
}

var accented = {
    'A': '[Aa\xaa\xc0-\xc5\xe0-\xe5\u0100-\u0105\u01cd\u01ce\u0200-\u0203\u0226\u0227\u1d2c\u1d43\u1e00\u1e01\u1e9a\u1ea0-\u1ea3\u2090\u2100\u2101\u213b\u249c\u24b6\u24d0\u3371-\u3374\u3380-\u3384\u3388\u3389\u33a9-\u33af\u33c2\u33ca\u33df\u33ff\uff21\uff41]',
    'B': '[Bb\u1d2e\u1d47\u1e02-\u1e07\u212c\u249d\u24b7\u24d1\u3374\u3385-\u3387\u33c3\u33c8\u33d4\u33dd\uff22\uff42]',
    'C': '[Cc\xc7\xe7\u0106-\u010d\u1d9c\u2100\u2102\u2103\u2105\u2106\u212d\u216d\u217d\u249e\u24b8\u24d2\u3376\u3388\u3389\u339d\u33a0\u33a4\u33c4-\u33c7\uff23\uff43]',
    'D': '[Dd\u010e\u010f\u01c4-\u01c6\u01f1-\u01f3\u1d30\u1d48\u1e0a-\u1e13\u2145\u2146\u216e\u217e\u249f\u24b9\u24d3\u32cf\u3372\u3377-\u3379\u3397\u33ad-\u33af\u33c5\u33c8\uff24\uff44]',
    'E': '[Ee\xc8-\xcb\xe8-\xeb\u0112-\u011b\u0204-\u0207\u0228\u0229\u1d31\u1d49\u1e18-\u1e1b\u1eb8-\u1ebd\u2091\u2121\u212f\u2130\u2147\u24a0\u24ba\u24d4\u3250\u32cd\u32ce\uff25\uff45]',
    'F': '[Ff\u1da0\u1e1e\u1e1f\u2109\u2131\u213b\u24a1\u24bb\u24d5\u338a-\u338c\u3399\ufb00-\ufb04\uff26\uff46]',
    'G': '[Gg\u011c-\u0123\u01e6\u01e7\u01f4\u01f5\u1d33\u1d4d\u1e20\u1e21\u210a\u24a2\u24bc\u24d6\u32cc\u32cd\u3387\u338d-\u338f\u3393\u33ac\u33c6\u33c9\u33d2\u33ff\uff27\uff47]',
    'H': '[Hh\u0124\u0125\u021e\u021f\u02b0\u1d34\u1e22-\u1e2b\u1e96\u210b-\u210e\u24a3\u24bd\u24d7\u32cc\u3371\u3390-\u3394\u33ca\u33cb\u33d7\uff28\uff48]',
    'I': '[Ii\xcc-\xcf\xec-\xef\u0128-\u0130\u0132\u0133\u01cf\u01d0\u0208-\u020b\u1d35\u1d62\u1e2c\u1e2d\u1ec8-\u1ecb\u2071\u2110\u2111\u2139\u2148\u2160-\u2163\u2165-\u2168\u216a\u216b\u2170-\u2173\u2175-\u2178\u217a\u217b\u24a4\u24be\u24d8\u337a\u33cc\u33d5\ufb01\ufb03\uff29\uff49]',
    'J': '[Jj\u0132-\u0135\u01c7-\u01cc\u01f0\u02b2\u1d36\u2149\u24a5\u24bf\u24d9\u2c7c\uff2a\uff4a]',
    'K': '[Kk\u0136\u0137\u01e8\u01e9\u1d37\u1d4f\u1e30-\u1e35\u212a\u24a6\u24c0\u24da\u3384\u3385\u3389\u338f\u3391\u3398\u339e\u33a2\u33a6\u33aa\u33b8\u33be\u33c0\u33c6\u33cd-\u33cf\uff2b\uff4b]',
    'L': '[Ll\u0139-\u0140\u01c7-\u01c9\u02e1\u1d38\u1e36\u1e37\u1e3a-\u1e3d\u2112\u2113\u2121\u216c\u217c\u24a7\u24c1\u24db\u32cf\u3388\u3389\u33d0-\u33d3\u33d5\u33d6\u33ff\ufb02\ufb04\uff2c\uff4c]',
    'M': '[Mm\u1d39\u1d50\u1e3e-\u1e43\u2120\u2122\u2133\u216f\u217f\u24a8\u24c2\u24dc\u3377-\u3379\u3383\u3386\u338e\u3392\u3396\u3399-\u33a8\u33ab\u33b3\u33b7\u33b9\u33bd\u33bf\u33c1\u33c2\u33ce\u33d0\u33d4-\u33d6\u33d8\u33d9\u33de\u33df\uff2d\uff4d]',
    'N': '[Nn\xd1\xf1\u0143-\u0149\u01ca-\u01cc\u01f8\u01f9\u1d3a\u1e44-\u1e4b\u207f\u2115\u2116\u24a9\u24c3\u24dd\u3381\u338b\u339a\u33b1\u33b5\u33bb\u33cc\u33d1\uff2e\uff4e]',
    'O': '[Oo\xba\xd2-\xd6\xf2-\xf6\u014c-\u0151\u01a0\u01a1\u01d1\u01d2\u01ea\u01eb\u020c-\u020f\u022e\u022f\u1d3c\u1d52\u1ecc-\u1ecf\u2092\u2105\u2116\u2134\u24aa\u24c4\u24de\u3375\u33c7\u33d2\u33d6\uff2f\uff4f]',
    'P': '[Pp\u1d3e\u1d56\u1e54-\u1e57\u2119\u24ab\u24c5\u24df\u3250\u3371\u3376\u3380\u338a\u33a9-\u33ac\u33b0\u33b4\u33ba\u33cb\u33d7-\u33da\uff30\uff50]',
    'Q': '[Qq\u211a\u24ac\u24c6\u24e0\u33c3\uff31\uff51]',
    'R': '[Rr\u0154-\u0159\u0210-\u0213\u02b3\u1d3f\u1d63\u1e58-\u1e5b\u1e5e\u1e5f\u20a8\u211b-\u211d\u24ad\u24c7\u24e1\u32cd\u3374\u33ad-\u33af\u33da\u33db\uff32\uff52]',
    'S': '[Ss\u015a-\u0161\u017f\u0218\u0219\u02e2\u1e60-\u1e63\u20a8\u2101\u2120\u24ae\u24c8\u24e2\u33a7\u33a8\u33ae-\u33b3\u33db\u33dc\ufb06\uff33\uff53]',
    'T': '[Tt\u0162-\u0165\u021a\u021b\u1d40\u1d57\u1e6a-\u1e71\u1e97\u2121\u2122\u24af\u24c9\u24e3\u3250\u32cf\u3394\u33cf\ufb05\ufb06\uff34\uff54]',
    'U': '[Uu\xd9-\xdc\xf9-\xfc\u0168-\u0173\u01af\u01b0\u01d3\u01d4\u0214-\u0217\u1d41\u1d58\u1d64\u1e72-\u1e77\u1ee4-\u1ee7\u2106\u24b0\u24ca\u24e4\u3373\u337a\uff35\uff55]',
    'V': '[Vv\u1d5b\u1d65\u1e7c-\u1e7f\u2163-\u2167\u2173-\u2177\u24b1\u24cb\u24e5\u2c7d\u32ce\u3375\u33b4-\u33b9\u33dc\u33de\uff36\uff56]',
    'W': '[Ww\u0174\u0175\u02b7\u1d42\u1e80-\u1e89\u1e98\u24b2\u24cc\u24e6\u33ba-\u33bf\u33dd\uff37\uff57]',
    'X': '[Xx\u02e3\u1e8a-\u1e8d\u2093\u213b\u2168-\u216b\u2178-\u217b\u24b3\u24cd\u24e7\u33d3\uff38\uff58]',
    'Y': '[Yy\xdd\xfd\xff\u0176-\u0178\u0232\u0233\u02b8\u1e8e\u1e8f\u1e99\u1ef2-\u1ef9\u24b4\u24ce\u24e8\u33c9\uff39\uff59]',
    'Z': '[Zz\u0179-\u017e\u01f1-\u01f3\u1dbb\u1e90-\u1e95\u2124\u2128\u24b5\u24cf\u24e9\u3390-\u3394\uff3a\uff5a]'
}; 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-05-06T15:11:52.107

一个更完整的版本，支持区分大小写、连字等等。原文来源： http: [//lehelk.com/2011/05/06/script-to-remove-diacritics/](http://web.archive.org/web/20120918093154/http://lehelk.com/2011/05/06/script-to-remove-diacritics/)

```
var defaultDiacriticsRemovalMap = [
    {'base':'A', 'letters':/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},
    {'base':'AA','letters':/[\uA732]/g},
    {'base':'AE','letters':/[\u00C6\u01FC\u01E2]/g},
    {'base':'AO','letters':/[\uA734]/g},
    {'base':'AU','letters':/[\uA736]/g},
    {'base':'AV','letters':/[\uA738\uA73A]/g},
    {'base':'AY','letters':/[\uA73C]/g},
    {'base':'B', 'letters':/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},
    {'base':'C', 'letters':/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},
    {'base':'D', 'letters':/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},
    {'base':'DZ','letters':/[\u01F1\u01C4]/g},
    {'base':'Dz','letters':/[\u01F2\u01C5]/g},
    {'base':'E', 'letters':/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},
    {'base':'F', 'letters':/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},
    {'base':'G', 'letters':/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},
    {'base':'H', 'letters':/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},
    {'base':'I', 'letters':/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},
    {'base':'J', 'letters':/[\u004A\u24BF\uFF2A\u0134\u0248]/g},
    {'base':'K', 'letters':/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},
    {'base':'L', 'letters':/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},
    {'base':'LJ','letters':/[\u01C7]/g},
    {'base':'Lj','letters':/[\u01C8]/g},
    {'base':'M', 'letters':/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},
    {'base':'N', 'letters':/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},
    {'base':'NJ','letters':/[\u01CA]/g},
    {'base':'Nj','letters':/[\u01CB]/g},
    {'base':'O', 'letters':/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},
    {'base':'OI','letters':/[\u01A2]/g},
    {'base':'OO','letters':/[\uA74E]/g},
    {'base':'OU','letters':/[\u0222]/g},
    {'base':'P', 'letters':/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},
    {'base':'Q', 'letters':/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},
    {'base':'R', 'letters':/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},
    {'base':'S', 'letters':/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},
    {'base':'T', 'letters':/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},
    {'base':'TZ','letters':/[\uA728]/g},
    {'base':'U', 'letters':/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},
    {'base':'V', 'letters':/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},
    {'base':'VY','letters':/[\uA760]/g},
    {'base':'W', 'letters':/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},
    {'base':'X', 'letters':/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},
    {'base':'Y', 'letters':/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},
    {'base':'Z', 'letters':/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},
    {'base':'a', 'letters':/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},
    {'base':'aa','letters':/[\uA733]/g},
    {'base':'ae','letters':/[\u00E6\u01FD\u01E3]/g},
    {'base':'ao','letters':/[\uA735]/g},
    {'base':'au','letters':/[\uA737]/g},
    {'base':'av','letters':/[\uA739\uA73B]/g},
    {'base':'ay','letters':/[\uA73D]/g},
    {'base':'b', 'letters':/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},
    {'base':'c', 'letters':/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},
    {'base':'d', 'letters':/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},
    {'base':'dz','letters':/[\u01F3\u01C6]/g},
    {'base':'e', 'letters':/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},
    {'base':'f', 'letters':/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},
    {'base':'g', 'letters':/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},
    {'base':'h', 'letters':/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},
    {'base':'hv','letters':/[\u0195]/g},
    {'base':'i', 'letters':/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},
    {'base':'j', 'letters':/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},
    {'base':'k', 'letters':/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},
    {'base':'l', 'letters':/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},
    {'base':'lj','letters':/[\u01C9]/g},
    {'base':'m', 'letters':/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},
    {'base':'n', 'letters':/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},
    {'base':'nj','letters':/[\u01CC]/g},
    {'base':'o', 'letters':/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},
    {'base':'oi','letters':/[\u01A3]/g},
    {'base':'ou','letters':/[\u0223]/g},
    {'base':'oo','letters':/[\uA74F]/g},
    {'base':'p','letters':/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},
    {'base':'q','letters':/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},
    {'base':'r','letters':/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},
    {'base':'s','letters':/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},
    {'base':'t','letters':/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},
    {'base':'tz','letters':/[\uA729]/g},
    {'base':'u','letters':/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},
    {'base':'v','letters':/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},
    {'base':'vy','letters':/[\uA761]/g},
    {'base':'w','letters':/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},
    {'base':'x','letters':/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},
    {'base':'y','letters':/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},
    {'base':'z','letters':/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}
];
var changes;
function removeDiacritics (str) {
    if(!changes) {
        changes = defaultDiacriticsRemovalMap;
    }
    for(var i=0; i<changes.length; i++) {
        str = str.replace(changes[i].letters, changes[i].base);
    }
    return str;
} 
```

# asp.net - 压缩内存缓存

> ID：227952
> 
> 赞同：3
> 
> 时间：2008-10-22T23:48:33.320
> 
> 标签：asp.net, caching, compression

有没有人有使用压缩缓存数据的经验？我知道stackoverflow在内部使用这种方法。

优缺点都有什么？

有什么gotchyas吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T23:56:13.447

Scott Hanselman 刚刚创建了一个 Session 包装类，它可以在将项目放入缓存/会话/任何内容之前对其进行压缩。你可能想看看！

[http://www.hanselman.com/blog/TheWeeklySourceCode35ZipCompressingASPNETSessionAndCacheState.aspx](http://www.hanselman.com/blog/TheWeeklySourceCode35ZipCompressingASPNETSessionAndCacheState.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T23:54:38.863

你应该试试memcached。它是一个分布式缓存服务器，易于使用并提供令人印象深刻的压缩功能。

# sql-server - SQL Server 2005：拒绝访问 sp_prepexec

> ID：227967
> 
> 赞同：1
> 
> 时间：2008-10-22T23:56:32.743
> 
> 标签：sql-server

我有一个 SQL Server 2005 数据库，由于一些行为不佳的应用程序通过 sp_prepexec 运行游标，该数据库正遭受锁不足的困扰。我想运行游标的应用程序之一已经“忘记”关闭它。我想拒绝特定用户对 sp_prepexec 的访问，以防止生产数据库中发生锁饥饿。

当我尝试以下语法时：

在 sp_prepexec 上对 applicationUser 使用 master 拒绝执行

我必须使用 master，因为当我不使用时：只有当当前数据库是 master 时，才能授予对服务器范围目录视图或系统存储过程或扩展存储过程的权限。

但问题是 applicationUser 不是 master 数据库中的用户。所以我收到以下错误：找不到用户'applicationUser'，因为它不存在或您没有权限。

如果我将该用户添加到 master 它似乎不会阻止 applicationUser 在生产数据库中运行 sp_prepexec 。

有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T00:29:57.120

您能否拒绝对角色而不是特定用户的权限？

```
USE master
GO
DENY EXECUTE ON production.sp_prepexec TO public
GO 
```

# json - JSON.js 是否会导致与 Sys.Serialization.JavaScriptSerializer.serialize 冲突

> ID：227968
> 
> 赞同：0
> 
> 时间：2008-10-22T23:56:49.450
> 
> 标签：json, asp.net-ajax, telerik

我在我的网络表单中使用 Telerik 控件，并希望在客户端上序列化对象。由于我收到 Sys.Serialization.JavaScriptSerializer.deserialize 的 stackoverflow 错误，我想尝试 JSON。使用 JSON 和 MS 库，我得到“Sys.Application 未定义”。

有没有人遇到过这个问题，你做了什么？

**编辑**

我在父页面上序列化我的对象并通过参数将它们传递给子窗口。子窗口位于 IFRAME 标记中。该对象可以在子页面中使用，但是我在序列化它时收到 stackoverflow 错误。该对象是一个对象数组。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-23T00:35:01.073

我可能有一个工作。在父页面上，我执行以下操作：

```
 //  Call Dialog Window                
 var radWindow = window.radopen(null, "DialogWindow");
 var args = new Object();

 //  Assign DisplayValues            
 args.serialPairs = Sys.Serialization.JavaScriptSerializer.serialize(jsonDataValuePairs);

 radWindow.argument = args;
 radWindow.SetUrl("AssignCCMProfile.aspx?CCMId=" + ccmId + "&ExecDate=" + execDate);
 radWindow.Center();
 radWindow.Show(); 
```

在子页面上，我执行以下操作：

```
dataValuePairs = Sys.Serialization.JavaScriptSerializer.deserialize(args.serialPairs); 
```

这对我来说似乎是一个kluge。它可以工作，但我宁愿将对象从父窗口传递到子窗口，并且仍然能够序列化子窗口上的对象。

# ruby-on-rails - Rails 测试：夹具、工厂和幻数

> ID：227973
> 
> 赞同：5
> 
> 时间：2008-10-22T23:58:42.550
> 
> 标签：ruby-on-rails, unit-testing, testing, yaml

我有一个应用程序需要大量数据（1000 条记录）来进行适当的测试。我发现获得一组体面的可测试、合理数据的唯一方法是使用**我的生产 DB 的一个子集**。我已将其转换为正常“测试/固定装置”位置的 YAML 固定装置。

这行得通，但现在我有一堆看似脆弱的测试和断言，它们取决于它们是满足条件 X 的特定数量的记录......

例子

```
def test_children_association
  p = Parent.find(1)
  assert_equal 18, p.children.count, "Parent.children isn't providing the right records"
end 
```

这对我来说似乎不是一个好主意，但**我不确定是否有更好/可接受的方法**来测试需要大量数据层次结构的应用程序。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-23T12:03:08.003

测试中的幻数不是反模式。你的测试需要非常简单，以至于你不需要*测试*它们。这意味着你会有一些神奇的数字。这意味着当您更改少量功能时，您的测试将中断。这很好。

Fixtures 有[一些问题](http://www.floehopper.org/articles/2006/06/27/rails-fixtures-help-or-hindrance)，但是你可以做一些简单的事情来让它们更容易使用：

1.  在您的夹具中只有基线数据，大多数测试需要但不关心的数据类型。这将需要预先投入时间，但最好早点承受痛苦，而不是为项目的生命周期编写糟糕的单元测试。

2.  在测试的上下文中添加要测试的数据。这提高了测试的可读性，并避免在单元测试开始时编写“确保没有人弄乱固定装置”的健全性检查。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T08:27:05.753

我要说的第一件事是：你在那个例子中测试什么？如果它是一个普通的 AR has_many 关联，那么我不会费心为它编写测试。您所做的只是测试 AR 是否有效。

一个更好的例子可能是如果您有一个非常复杂的查询，或者在获取子记录列表时涉及其他处理。当您取回它们时，您可以遍历返回的列表并验证子项是否符合您使用的条件，而不是测试计数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T10:04:16.837

我发现在这种情况下最有用的是根本不使用固定装置，而是动态构建数据库对象，例如

```
def test_foo
   project = Project.create valid_project.merge(....)
   *do assertions here*
end 
```

在我的 test_helpers 中，我有很多方法：

```
def valid_project
   { :user_id => 23, :title => "My Project" }
end

def invalid_project
   valid_project.merge(:title => nil)
end 
```

我发现必须构建大量测试对象的痛苦使我自然而然地设计了更简单、更通用的类结构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T12:55:20.250

卡梅伦说得对：你在测试什么？

什么样的系统需要 1000 条记录来测试？请记住，您的测试应该尽可能小，并且应该测试应用程序的行为。对于绝大多数这些测试，它不可能需要数千条记录。

对于需要对象关系的少量行为测试，请考虑模拟对象。您只会指定使测试通过所需的确切最小行为量，并且它们根本不会影响数据库，这将在您的测试套件中获得巨大的性能提升。跑得越快，人们跑得越频繁。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T17:06:41.750

我在这里可能有一个独特的情况，但我确实需要相当多的记录来测试这个应用程序（我把它降到了 150 条左右）。我正在分析历史数据并且有很多级别的`has_many`. 我的一些方法跨多个表执行自定义 SQL 查询，我最终可能会修改这些表以使用`ActiveRecord.find`，但我需要先运行测试。

无论如何，我最终使用了一些**ruby​​ 代码来创建 fixtures**。代码包含在我的`test_helper`; 它检查测试数据库以查看数据是否过时（基于时间条件）并按**程序擦除和重新创建记录**。在这种情况下，通过程序创建它可以让我知道我正在测试的数据*应该*是什么，这**比使用生产数据的子集**并希望我第一次计算的数字是我将来应该测试的更安全.

我还开始使用[Shoulda](http://www.thoughtbot.com/projects/shoulda/)，它与许多其他有用的东西一起使 ActiveRecord 关联测试变得如此简单：

```
should_have_many :children
should_belong_to :parent 
```

# html - 是否有可能有一个类似于 html TEXTAREA 的元素来包装文本而不是显示滚动条？

> ID：227977
> 
> 赞同：0
> 
> 时间：2008-10-23T00:01:08.537
> 
> 标签：html, css

是否有 IE7 和 Firefox 会遵守的 CSS 样式来改变 TEXTAREA 的行为，使其表现得更像......嗯......更像是我现在正在输入的东西！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T00:15:52.127

自动换行是 <textarea> 的默认行为。但是，如果您编写一堆没有任何空格的文本，它将生成一个水平滚动条。如果您只是将键盘上的键捣碎以测试您的文本区域，那么您可能会得到一个滚动条并认为它没有环绕。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T00:13:35.110

尝试输入没有空格的文本，您将看到一个水平滚动条。
在此页面上查看源代码以查看适用于此文本区域的样式；）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T00:15:20.943

虽然它不在 HTML 规范中，但我相信您正在寻找：

```
<textarea wrap="soft"></textarea> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T00:44:25.143

以及（如由W3C指定）的默认行为是文本区域只能在遇到一个空白包，例如，如果你键入999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
通知，它超过了`cols`一个textarea的属性，因此它会自动指示文本区域提供底部的水平滚动条，但只有打算破坏您网站设计的用户才会这样做（我想知道他们之后会得到什么）

无论如何，textarea 的 wrap 属性与其在浏览器中的外观无关，只是`wrap="off"`因为它更关心它如何在表单中发送空格的值，
这是一个简短的阅读[包装教程](http://www.web-wise-wizard.com/html-tutorials/html-form-forms-textarea-wrap.html#Html_Textarea_Wrap_W3c_Validation_Accessibility)

# .net - 人们在记录时捕获的字段 - log4net

> ID：227978
> 
> 赞同：5
> 
> 时间：2008-10-23T00:01:11.750
> 
> 标签：.net, asp.net, logging, log4net

我有兴趣了解人们在使用 log4net 等记录器时在其应用程序中记录时实际捕获和使用的字段。

这可以从调试到测试再到生产，可以用于胖客户端应用程序，但我更多地考虑 Web 应用程序的语义（即 asp.net）。

此外，在 Web 的上下文中（以及在一定程度上对于胖客户端），我对人们如何为给定请求构建日志整体的层次结构以及如何识别单个请求等感兴趣。

干杯安东尼

以下是我到目前为止所拍摄的内容：

LogId、ServerName、ServerIP、ApplicationAbbrv、ApplicationVersion、ApplicationAppDomain、LogDateTime、LogTimeStamp、LogLogger、CodeType、CodeClass、CodeFile、CodeLocation、CodeMethod、CodeLine、CodeStackPosition、LogMessage、LogException、LogEntityOrigin、ContextSessionId、ContextUserName、ContextThread、ContextObjectPropertyData、ContextMachineId、ContextMachineIP

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T00:56:19.800

为了为请求创建一个“交互堆栈”，我们在用户第一次访问应用程序时在 cookie 中为用户分配一个 sessionid(guid)。然后我们按 sessionid/datetime 排序，看看事件的顺序是什么。

我们经常记录的另一件事是用户试图操作（插入/删除/更新）的数据（减去 ssn 等敏感数据），因为数据质量似乎是错误的主要来源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T00:05:39.433

记录所有**错误**。

记录为已处理但应记录的**警告事件。**

除此之外，您需要将多少细节记录为**Info**取决于您。您可以将每个进入/退出点记录为信息到方法。就我个人而言，我认为这是对开发人员没有信心的代码的过度杀伤和症状。我会记录处理过程中发生的所有“主要”操作。

# java - 使用 JSTL 导入另一个 Web 资源的内容

> ID：227984
> 
> 赞同：1
> 
> 时间：2008-10-23T00:04:06.300
> 
> 标签：java, jsp, import, jstl

我有一个 JSP 页面，它将在不同的服务器上显示另一个网页的确切内容。我的理解是，来自 JSTL 的 c:import 应该能够包含不属于当前 Web 应用程序的文件中的内容。

我添加了 c:import url="page on my server in a different application" 并且工作正常，但是当我尝试包含来自另一台服务器的页面时它失败了。

关于可能出现什么问题的任何建议？

**编辑：**确切的错误是：“服务器遇到了一个内部错误（），它阻止了它完成这个请求。”。但是，从同一服务器请求页面，不同的应用程序工作......我得到了页面的内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T01:46:43.550

一个确切的代码以及“它如何失败”将是一个很大的帮助。所有读心者目前都在休假。

同时，看看[http://www.ibm.com/developerworks/java/library/j-jsp06173.html](http://www.ibm.com/developerworks/java/library/j-jsp06173.html)

```
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
...
<c:import 
  url="http://www.truenorthguitars.com/Clients/Richman/index.htm" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-08T01:32:29.853

我曾经遇到过类似的错误。原来是我运行应用程序的机器通过防火墙连接到互联网时出现了一些问题。一旦我将应用程序部署到始终连接的机器上，它就可以正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T03:31:08.630

如果它在同一台服务器、不同的应用程序上运行，则可能存在一个未在某处初始化的变量，或者某个使其引发异常的状态。检查错误日志以查找可能指向导致问题的特定代码行的任何堆栈跟踪。

# database-design - 合并来自不同来源的事实？还是单独加载？

> ID：227990
> 
> 赞同：3
> 
> 时间：2008-10-23T00:07:40.613
> 
> 标签：database-design, data-warehouse

我们有两个不同来源的数据：一些来自客户，一些来自不同的供应商。目前，我们将这些数据物理地“合并”成一个近百列、数万行且两个维度没有正式分离的海量表。因此，我们实际上不能多次使用该表。

我将把这个烂摊子重新设计成一个适当的、但很小的星型模式。

两个维度很明显。例如，其中之一是时间。

客户提供的数据提供了许多事实值。每个供应商可能（或可能不）提供符合相同维度的附加事实值。

这个事实数据都具有相同的粒度。它可以被称为“稀疏”，因为我们并不经常从所有供应商那里获得信息。

这是我的困境。

这是一个从不同来源填充的事实表（带有一些空值）吗？

或者这是*n* +1 个事实表——一个来自客户，另一个来自每个供应商？

每种设计都有优点和缺点。对于“合并”或“单独加载”之间的选择，我需要一些第二意见。

* * *

客户提供收入、成本、计数、重量和其他他们知道的关于交易结束的信息。

供应商一提供了一些关于一些交易的额外细节——权重、成本、持续时间。其他交易对供应商一没有任何价值。

供应商二提供了一些关于一些交易的额外细节——数量、持续时间、长度、外币汇率。其他交易对供应商二没有价值。

一些交易将有两个供应商。少数交易将没有供应商。

一张有空值的表？三张桌子？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T10:35:36.743

我会选择单一事实表。这种方法的亮点在于它将所有的繁重工作都留在了加载时而不是查询时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T19:55:29.507

根据您的描述，听起来单个事实表是可行的方法。

听起来事实表会有时间 x 事务 x 客户（？）。

我之前的问题是真的试图找出一些供应商数据是否是其自身维度的候选者。我会把它留给你来确定。但听起来不像。

Null 事实可能会在聚合期间引发警告（取决于平台），但使用可能具有误导性的零填充它们的替代方法会更糟。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T14:05:09.563

我相信，由于两个来源共享相同的粒度，答案是您应该拥有一个事实表。考虑一下您希望最终用户如何与信息进行交互。如果它有意义并且业务报告将受益于这些位于同一地点的数据，那么这就是您的答案。尽量避免在事实表中出现空值。如果您可以输入零（并且零对数据有意义，即认为温度），那么就这样做。它将为您的用户节省一些混乱，并且正如 TrickyNixon 指出的那样会导致聚合问题。

实际上，您在“棕地”应用程序中处于一个很好的位置。您可以查看当今存在的内容并利用经验来创建更好的设计。这是选择最好的谷物的最重要时间，希望在 DW 的生命周期内不会改变。

# visual-studio - 在 VS 2005 中增量构建

> ID：227991
> 
> 赞同：2
> 
> 时间：2008-10-23T00:08:35.650
> 
> 标签：visual-studio, build, visual-studio-2005

我们在 VS 2005 中有 50 个项目的解决方案。

如果没有任何改变，有什么方法可以进行增量构建吗？

它现在有点做，但它为每个项目执行所有预构建和构建后事件。

有什么办法可以预防吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T22:52:02.780

查看**构建事件**选项卡。注意底部的下拉菜单**Run the post-build event:**。它是否说“成功构建”？尝试将其更改为“当构建更新项目输出时”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T02:59:55.557

如果您提前知道要构建或不构建哪些，则可以创建仅构建指定项目的不同构建配置。

此解决方案根本不使用依赖项，因此仅当您有几个不同的不同项目组时它才会起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T00:20:56.687

默认情况下，Visual Studio 会执行您所描述的操作，不会对最新项目执行自定义构建步骤。

您的依赖项或构建设置中的某些内容导致它更新所有构建。不幸的是，如果没有额外的信息，很难追踪。

# sql - 使用 SQL Server DTS 包有条件地在目标表中插入/更新行

> ID：227993
> 
> 赞同：2
> 
> 时间：2008-10-23T00:10:20.483
> 
> 标签：sql, sql-server, database, tsql, dts

我想创建一个 DTS 包以将数据从 Oracle 表中提取到 SQL2K 表中。如何插入 SQL2K 表中尚未存在的行并更新 SQL2K 表中已存在的行？

我想我可以截断并重新填充整个表或创建一个临时表，然后将临时表中的更新/插入到目标表中。

使用 DTS 有没有更简单的方法？

谢谢，

罗卡尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T02:42:42.360

您可以在 DTS 包中使用两个数据驱动的查询任务来执行此操作：一个用于插入，另一个用于更新。数据驱动的查询任务使用起来有点麻烦，但它们确实有效。我还在使用动态 t-sql 的 AS/400 数据库的 sql server 2000 中完成了这个（“合并”）。您将编写一个 t-sql 脚本，输出 psql 并在链接服务器上运行它到 Oracle 数据库。

更新：DTS“数据驱动查询任务”**将**允许您将数据从 DTS 中的 sql server 连接插入|更新到 DTS w/oa 临时表或链接服务器中的 oracle 服务器连接。

更新2；这里有一些关于我的意思的更多信息： [http ://www.databasejournal.com/features/mssql/article.php/3315951](http://www.databasejournal.com/features/mssql/article.php/3315951)

[http://msdn.microsoft.com/en-us/library/aa933507(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa933507(SQL.80).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T09:02:24.373

您是否保持相同的主键值？

如果您有多种选择，某些版本的 SQL 支持 MERGE 语句，它将按照您的需要进行更新或插入。

或者你可以自己写。

类似于将所有行加载到 SQL 数据库中的临时表中，并逐行检查主 SQL 表中是否存在主键。如果键存在则更新行，如果不存在则插入。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T00:23:01.863

是的，源和目标中的主键值将匹配。

我希望在不使用临时（暂存）表的情况下完成这项任务。

另外，我使用的是 sql server 2000，所以 MERGE 语句不可用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T10:04:44.170

TSQL 无法在同一个语句中执行 INSERT 或 UPDATE，但是您可以很容易地在两个语句中执行此操作（如上所述）。

声明 1：

```
DELETE FROM dbo.WhateverTable 
WHERE WhateverTableID IN (SELECT WhateverTableID FROM MySource) 
```

声明 2：

```
INSERT INTO dbo.WhateverTable 
SELECT * FROM MySource 
```

另外，您是否有任何理由不想使用临时表？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-18T11:02:44.247

尝试：

```
DELETE FROM dbo.WhateverTable WHERE WhateverTableID IN (SELECT WhateverTableID FROM MySource) 
```

它可能很慢，请改用 join ：

```
Delete a
from firstTable a join secondTable b on a.id = b.id 
```

# sql - SQL存储过程临时表内存问题

> ID：227994
> 
> 赞同：3
> 
> 时间：2008-10-23T00:11:31.480
> 
> 标签：sql, sql-server, stored-procedures

我们有以下简单的存储过程，它作为通宵 SQL 服务器代理作业运行。通常它会在 20 分钟内运行，但最近 MatchEvent 和 MatchResult 表已经增长到每个超过 900 万行。这导致存储过程需要 2 个多小时才能运行，我们 SQL 盒上的所有 8GB 内存都用完了。这使得数据库对尝试访问它的常规查询不可用。

我认为问题是临时表太大并导致内存和数据库不可用问题。

如何重写存储过程以提高效率并减少内存占用？

注意：我已经编辑了 SQL 以表明存在影响初始 SELECT 语句的条件。为了简单起见，我以前忽略了这一点。此外，当查询运行时，CPU 使用率为 1-2%，但如前所述，内存已达到最大值

```
 CREATE TABLE #tempMatchResult
(
    matchId VARCHAR(50)
)

INSERT INTO #tempMatchResult
SELECT MatchId FROM MatchResult WHERE SOME_CONDITION

DELETE FROM MatchEvent WHERE

MatchId IN (SELECT MatchId FROM #tempMatchResult)

DELETE FROM MatchResult WHERE
MatchId In (SELECT MatchId FROM #tempMatchResult)

DROP TABLE #tempMatchResult 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T01:32:38.290

这里可能发生了很多事情，这并不是您的全部查询。

首先，我同意其他海报。如果可能的话，尝试在没有临时表的情况下重写它。

但是假设您在这里需要一个临时表，那么您有一个大问题，因为您没有在其上定义 PK。这将大大增加您的查询运行所需的时间。像这样创建你的表：

```
CREATE TABLE #tempMatchResult (
    matchId VARCHAR(50) NOT NULL PRIMARY KEY /* NOT NULL if at all possible */
);

INSERT INTO #tempMatchResult
SELECT DISTINCT MatchId FROM MatchResult; 
```

此外，请确保您的 TempDB 大小正确。您的 SQL 服务器很可能会在您身上动态扩展数据库文件，从而导致您的查询占用 CPU 和磁盘时间。此外，请确保您的事务日志大小正确，并且它不会自动增长。祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T00:16:48.863

看上面的代码，为什么需要临时表？

```
 DELETE FROM MatchEvent WHERE
MatchId IN (SELECT MatchId FROM MatchResult)

DELETE FROM MatchResult
-- OR Truncate can help here, if all the records are to be deleted anyways. 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T00:36:30.523

您可能希望以某种方式分段处理。（我假设查询比您展示的要复杂得多？）在这种情况下，您需要尝试以下其中一种：

*   编写存储过程以迭代结果。（处理时可能仍会锁定。）
*   重复选择 N 个第一个命中，例如`LIMIT 100`并处理它们。
*   通过分别扫描表的区域来划分工作，使用 WHERE M <= x AND x < N 之类的方法。
*   更频繁地运行“午夜工作”。说真的，每 5 分钟运行一次这样的事情反而会产生奇迹，尤其是在工作非线性增加的情况下。（如果没有，您仍然可以将工作分散在一天中的几个小时内。）

在 Postgres 中，我使用条件索引取得了一些成功。如果满足某些条件，它们会通过应用索引来发挥作用。这意味着您可以将许多“已解决”的行和少数未解决的行保留在同一个表中，但仍然可以获得该特殊索引而不是未解决的那些。是的。

应该指出，这是使用数据库变得*有趣*的地方。您需要密切关注您的索引并`EXPLAIN`在您的查询中大量使用。

（哦，记住，*有趣*在你的爱好中是一件好事，但在工作中却不是。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T07:14:18.833

首先，索引是必须在这里看到戴夫 M 的答案。

我有时会在删除非常大的数据集时使用的另一种方法是创建一个包含所有数据的影子表，重新创建索引，然后使用 sp_rename 将其切换进来。您必须小心这里的事务，但取决于数据的数量数据被删除这可以更快。

*注意*如果 tempdb 有压力，请考虑使用连接而不是将所有数据复制到临时表中。

所以例如

```
CREATE TABLE #tempMatchResult (
    matchId VARCHAR(50) NOT NULL PRIMARY KEY /* NOT NULL if at all possible */
);

INSERT INTO #tempMatchResult
SELECT DISTINCT MatchId FROM MatchResult;

set transaction isolation level serializable
begin transaction 

create table MatchEventT(columns... here)

insert into MatchEventT
select * from MatchEvent m
left join #tempMatchResult t on t.MatchId  = m.MatchId 
where t.MatchId is null 

-- create all the indexes for MatchEvent

drop table MatchEvent
exec sp_rename 'MatchEventT', 'MatchEvent'

-- similar code for MatchResult

commit transaction 

DROP TABLE #tempMatchResult 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T09:08:03.910

### 尽可能避免使用临时表

它只是用尽内存。
你可以试试这个：

```
DELETE MatchEvent
FROM MatchEvent  e , 
     MatchResult r
WHERE e.MatchId = r.MatchId 
```

### 如果你不能避免临时表

我要在这里伸出脖子说： **您不需要临时表上的索引，**因为您希望临时表是等式中最小的表，并且您想对其进行表扫描（因为所有行是相关的）。索引在这里帮不了你。

### 做点小事

一次处理几行。
这可能会减慢执行速度，但应该释放资源。

- 一次一排

```
SELECT @MatchId = min(MatchId) FROM MatchResult

WHILE @MatchId IS NOT NULL
BEGIN
    DELETE MatchEvent 
    WHERE  Match_Id = @MatchId 

    SELECT @MatchId = min(MatchId) FROM MatchResult WHERE MatchId > @MatchId 
END 
```

- 一次几行

```
CREATE TABLE #tmp ( MatchId Varchar(50) ) 

/* get list of lowest 1000 MatchIds: */ 
INSERT #tmp 
SELECT TOP (1000) MatchId 
FROM MatchResult 
ORDER BY MatchId 

SELECT @MatchId = min(MatchId) FROM MatchResult

WHILE @MatchId IS NOT NULL
BEGIN
    DELETE MatchEvent
    FROM MatchEvent e , 
         #tmp       t
    WHERE e.MatchId = t.MatchId 

    /* get highest MatchId we've procesed: */  
    SELECT @MinMatchId = MAX( MatchId ) FROM #tmp  

    /* get next 1000 MatchIds: */  
    INSERT #tmp 
    SELECT TOP (1000) MatchId 
    FROM MatchResult 
    WHERE MatchId > @MinMatchId
    ORDER BY MatchId 

END 
```

这一次最多删除 1000 行。
您一次删除的行越多，您将使用的资源越多，但它往往会运行得越快（直到您用完资源！）。您可以尝试找到比 1000 更优的值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-21T14:38:19.927

```
DELETE FROM MatchResult WHERE
MatchId In (SELECT MatchId FROM #tempMatchResult) 
```

可以替换为

```
DELETE FROM MatchResult WHERE SOME_CONDITION 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-02-11T13:29:20.037

你能在matchresult和matchevent之间打开级联删除吗？然后您只需要担心确定要删除的一组数据，并让 SQL 处理另一组数据。

另一种方法是使用 OUTPUT 子句，但这肯定更麻烦。

这两个都可以让您从两个表中删除，但只需声明（并执行）一次过滤谓词。这可能*仍然*不如其他海报所建议的批处理方法那样高效，但值得考虑。YMMV`**********