# StackOverflow 问答 000324000-000324999

# haskell - 原始递归

> ID：324003
> 
> 赞同：0
> 
> 时间：2008-11-27T15:12:37.497
> 
> 标签：haskell, lambda, functional-programming, lambda-calculus

我将如何使用原始递归定义函数“简化”？

简化 :: Expr -> Expr
...

简化 使用基本算术简化表达式，例如简化 (Plus (Var "x") (Const 0)) = Var "x"

# c - memcpy 与 C 中的赋值

> ID：324011
> 
> 赞同：30
> 
> 时间：2008-11-27T15:17:04.087
> 
> 标签：c, struct, variable-assignment, memcpy

在什么情况下我应该期望 memcpys 在现代 INTEL/AMD 硬件上胜过分配？我在 32 位 Intel 平台上使用 GCC 4.2.x（但也对 64 位感兴趣）。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-11-27T15:24:49.827

你永远不应该期望他们胜过分配。原因是，当编译器认为它会更快时（如果您使用优化标志），编译器无论如何都会使用 memcpy。如果不是，并且如果结构足够小以适合寄存器，则可以使用直接寄存器操作，这根本不需要任何内存访问。

GCC 内部有特殊的块移动模式，可以确定何时直接更改寄存器/内存单元，或何时使用 memcpy 函数。请注意，在分配结构时，编译器在编译时知道移动将有多大，因此它可以展开小副本（例如，在行中执行 n 次移动而不是循环）。注意`-mno-memcpy`：

```
-mmemcpy
-mno-memcpy
    Force (do not force) the use of "memcpy()" for non-trivial block moves.  
    The default is -mno-memcpy, which allows GCC to inline most constant-sized copies. 
```

谁比编译器本身更清楚何时使用 memcpy？

# php - 给 Windows 系统的负载赋值

> ID：324014
> 
> 赞同：1
> 
> 时间：2008-11-27T15:18:38.217
> 
> 标签：php, windows, macos, load, uptime

我在 php 中编写了一个图像处理脚本，它作为 cron 计划任务（在 OSX 中）运行。为避免系统过载，脚本会检查系统负载（使用“正常运行时间”），并且仅在负载低于预定义阈值时运行。

我现在已经将它移植到 Windows (2003 Server) 并且正在寻找一个类似的命令行函数来将系统负载报告为整数或浮点数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T13:03:58.187

## 不要使用负载...

在这种情况下，系统负载不是一个好的指标。在 Unix 上，它基本上告诉您，目前有多少进程已准备好并等待执行。但是，由于进程可能必须等待的原因有很多，因此即使系统上的“负载”很高，您的脚本实际上也可以在不消耗其他进程任何性能的情况下运行。

## ...使用不错

您应该`nice(1)`在 Unix 上使用，在 Windows 上使用等价物（“进程优先级”？），这样操作系统就可以决定何时运行您的脚本！

如果您将脚本的优先级设置为可能的绝对最低优先级，那么它只会在当前无事可做时由调度程序执行。

可能您将不得不实施某种机制来防止同时运行多个脚本实例，以防执行时间超过两次调用之间的时间间隔。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T16:21:20.633

您可以在 Windows 命令行中尝试此操作。这适用于 XP，也可以获得很多其他信息。

wmic CPU

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T16:01:45.493

您可以使用名为[pv](http://www.teamcti.com/pview/prcview.htm)的命令行实用程序来显示特定时间段（默认为 500 毫秒）内的进程名称和 CPU% 使用率：

```
pve.exe -o"%n\t%c" 
```

有使用`-?`描述可用参数的开关的帮助。

它需要比 OSX/linux 上的正常运行时间多一点的工作，因为您必须将第一列中的数字相加（或省略进程名称，只需将每行输出的值相加）才能得到总数（以 % 为单位） ） CPU使用率。

好的一面是，通过更多的工作，您可以获得执行进程正在使用的特定 CPU 数量，而不是整个系统 CPU 消耗。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T16:07:41.283

WMI 对 Windows 中的几乎所有内容进行基准测试，包括系统负载。

我找到[了一个关于它的线程](http://forums.cacti.net/post-9117.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T18:05:58.987

只需使用标准的 win32 api (GTC)

# performance - 提供 64 位特定版本的软件

> ID：324015
> 
> 赞同：7
> 
> 时间：2008-11-27T15:18:57.857
> 
> 标签：performance, 64-bit

通过将我的本机 C++ 客户端和服务器构建为 64 位代码，我是否期望看到任何性能提升？

什么样的应用程序可以从 64 位特定构建中受益？

我想任何广泛使用 long 的东西都会受益，或者任何需要大量内存（即超过 2Gb）的应用程序，但我不确定还有什么。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-27T15:54:18.377

**英特尔 x64 与 x86 的架构优势**

*   更大的地址空间
*   更丰富的寄存器集
*   可以链接外部库或加载 64 位的插件

**x64 模式的架构缺点**

*   所有指针（以及许多指令）都占用 2 倍的内存，在最坏的情况下将有效的处理器缓存大小减半
*   无法链接到外部库或加载 32 位的插件

在我编写的应用程序中，当切换到 64 位时，我有时会看到大幅加速 (30%)，有时会看到大幅减速 (> 2 倍)。在我受寄存器限制的数字处理/视频处理应用程序中发生了巨大的加速。

在转换为 64 位时，我在自己的代码中看到的唯一大幅减速是来自一个大型指针追踪应用程序，其中一个编译器做了一些非常糟糕的“优化”。另一个编译器生成的代码性能差异可以忽略不计。

**现在移植的好处**

一旦你知道要注意什么，编写 64 位兼容的代码在 99% 的情况下并不难。大多数情况下，它归结为在引用内存地址时使用 size_t 和 ptrdiff_t 而不是 int （我在这里假设 C/C++ 代码）。将大量未编写为支持 64 位的代码转换可能会很痛苦。

即使为您的应用程序构建 64 位版本没有意义（可能没有），也值得花时间学习构建构建所需的内容，以便至少所有新代码和未来的重构将是 64 位兼容的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-27T15:39:33.057

在努力确定是否存在 64 位构建的技术案例之前，您必须验证是否存在*业务*案例。您的客户是否要求这样的构建？它会让您在与其他供应商的竞争中获得明确的优势吗？创建这样的构建的成本是多少？在您的会计、销售和营销流程中添加另一个项目会产生哪些业务成本？

虽然我认识到您需要了解性能改进的潜力，然后才能掌握竞争优势，但我强烈建议您从大局的角度来解决问题。如果您是一家小型企业或个体企业，那么您应该对自己进行适当的尽职调查。如果您为更大的组织工作，您的上级会非常感谢您为思考这些问题所付出的努力（或者如果您似乎没有准备好回答这些问题，他们会认为整个问题只是令人讨厌的过度）。

综上所述，我的总体*技术*反应是，绝大多数面向用户的应用程序不会从 64 位构建中看到任何优势。想一想：当前应用程序中的性能问题有多少来自处理器限制（或 RAM 访问限制）？您当前的应用程序*是否*存在性能问题？（如果不是，你可能不应该问这个问题。）

如果它是客户端/服务器应用程序，我敢打赌，网络延迟对客户端性能的贡献要大得多（尤其是在您的查询通常返回大量数据的情况下）。假设这是一个数据库应用程序，您的性能配置文件中有多少是由于服务器上的磁盘延迟时间造成的？如果您考虑影响性能的所有因素，您将更好地了解您的特定应用程序是否会从 64 位升级中受益，如果是，您是否需要同时升级，或者是否所有好处将仅来自服务器端升级。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T15:21:33.750

别的不多，真的。尽管在某些情况下，作为程序员，编写 64 位应用程序可能对您有一些好处。一个简单的示例是主要关注与注册表交互的应用程序。作为 32 位进程，您的应用程序将无法访问 64 位系统上的大量注册表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T15:46:22.340

继续@ [mdbritt](https://stackoverflow.com/questions/324015/supplying-64-bit-specific-versions-of-your-software#324055)的评论，如果它是服务器构建，或者如果您正在分发给 Linux 用户，则构建 64 位 [当前] 更有意义。

似乎更多的 Windows 工作站仍然是 32 位的，而且新版本可能没有庞大的客户群。

另一方面，现在许多服务器安装都是 64 位的：RHEL、Windows、SLES 等。在我看来，***不***为它们构建会切断很多潜在的使用。

桌面 Linux 用户也可能正在运行他们最喜欢的发行版的 64 位版本（很可能是 Ubuntu、SuSE 或 Fedora）。

然而，构建 64 位的主要明显好处是您可以绕过 3GB 的内存使用障碍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T15:25:41.820

根据[此网页](http://techreport.com/articles.x/8131/2)，如果您使用大量和/或深度循环，您将从具有 64 位 CPU 的额外通用寄存器中受益最多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-27T15:26:14.533

由于额外的寄存器和新的传递参数约定（实际上与额外的寄存器相关联），您可以获得收益。

# cocoa - 当我的应用程序不在最前面时，如何在 NSStatusWindowLevel 窗口中获取键盘事件？

> ID：324032
> 
> 赞同：5
> 
> 时间：2008-11-27T15:27:46.340
> 
> 标签：cocoa, macos

创建半透明窗口后（[基于 Matt Gemmell 的示例代码](http://stormsilver.net/itunescheck/browser/tags/0.91/TransparentWindow.m?rev=25)），我想在此窗口中获取键盘事件。当我的应用程序是活动应用程序时，似乎只有键盘事件，而我想要键盘事件，即使我的应用程序不活动但窗口可见。

基本上，我想要 Quicksilver 应用程序（由 blacktree）提供的行为。

有人对如何做到这一点有任何提示吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T16:26:48.780

有两种选择：

1.  与附加的 Carbon 运行循环一起使用[`GetEventMonitorTarget()`](http://developer.apple.com/documentation/Carbon/Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/c/func/GetEventMonitorTarget)来获取键盘事件。示例代码可在 CocoaDev 的[此页面上找到。](http://www.cocoadev.com/index.pl?KeyboardEventsFromOtherApps)

2.  使用 注册事件陷阱[`CGEventTapCreate`](http://developer.apple.com/documentation/Carbon/Reference/QuartzEventServicesRef/Reference/reference.html#//apple_ref/c/func/CGEventTapCreate)。示例代码可以在Apple 开发者邮件列表 的[这个线程中找到。](http://lists.apple.com/archives/quartz-dev/2005/Oct/msg00013.html)

**编辑：**请注意，只有在通用访问首选项窗格中选中“启用辅助设备访问”时，这些方法才有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T16:49:20.203

一个更简单的方法可能更适合您，即让您的应用程序仅在后台运行。关于[LSUIElement](http://www.cocoadev.com/index.pl?LSUIElement) plist 键的 CocoaDev 的讨论解释了如何设置它。基本上，您的应用程序不会出现在 Dock 或应用程序切换器中，并且在激活时不会替换当前应用程序的菜单栏。从用户的角度来看，它永远不是“活动”应用程序，但您打开的任何窗口都可以被激活并正常响应事件。唯一需要注意的是你永远不会显示你的菜单栏，所以你可能必须设置一个 NSStatusItem （显示在菜单栏右侧的那些图标菜单之一）来控制（即退出，调出首选项等）您的应用程序。

编辑：我完全忘记了 Interface Builder 中的 Non-Activating Panel 复选框。您需要使用 NSPanel 而不是 NSWindow 来获得此选择。此设置允许您的面板在不激活您的应用程序的情况下接受点击和键盘输入。我打赌这个设置和 Carbon Hot Keys API 的一些组合是 QuickSilver 用于他们的 UI 的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T10:23:10.883

更新：
Apple 实际上似乎从 10.5 BTW 开始再次改变了一切（我最近升级了，我的示例代码没有像以前那样工作）。

现在，如果您是 root 或启用了辅助设备，您确实只能捕获设置事件点击的 keydown 事件，无论您计划捕获哪个级别，也无论您是否选择捕获（这允许您修改甚至丢弃事件）或者只听。当标志发生变化（实际上甚至改变这些）和其他事件时，您仍然可以获得信息，但在其他情况下没有 keydown。

但是，使用 carbon 事件处理程序和方法 RegisterEventHotKey() 允许您注册一个热键，并且在按下它时您会收到通知，您既不需要是 root，也不需要启用辅助设备之类的任何东西。我认为 Quicksilver 可能就是这样做的。

# silverlight - 如何 BringToView 将最新项目添加到绑定的 ObservableCollection

> ID：324035
> 
> 赞同：2
> 
> 时间：2008-11-27T15:29:33.670
> 
> 标签：silverlight

我有一个 silverlight 控件（视图），它显示数据上下文（视图模型）的指定属性中的项目列表。

我需要的是控件中的滚动查看器根据最新项目添加到列表的位置滚动到顶部或底部。（它总是列表的开头或结尾，我不需要担心列表插入的中间。）

在 WPF 中，我只使用 DataContextChanged 事件开始侦听视图模型，但在 Silverlight 中，该事件是内部的。

关于如何解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-15T20:43:51.437

一个很好的起点是[CodeProject 上的附加行为](http://www.codeproject.com/KB/WPF/AttachedBehaviors.aspx)。

一个有用的行为是观察 ListBox.ItemsSource 并在设置时附加到可观察的集合。在集合更改事件上，使用 ListBox.ScrollIntoView 显示更改的项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T11:24:23.540

我不能使用 ObservableCollection 的 CollectionChangedEvent，因为我需要 DataContextChanged 事件来获取首先保存 Collection 的 DataContext。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-13T08:04:39.697

你不会在 ViewModel 中这样做吗？

无论 ViewModel 具有 ObservableCollection，都公开一个名为 SelectedItem 的 T 类型属性，并且每当 ObservableCollection 随新项目发生变化时，CollectionChanged 事件将允许您设置 SelectedItem 属性。完成此操作后，将控件中的 SelectedItem 连接到 ViewModel 上的此属性。

This will obviously only work with controls like ListBox where a SelectedItem property exists.

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-28T20:58:57.440

代替 WPF 中的 DataContextChanged，您可以使用 ObservableCollection 的 CollectionChanged 事件。在更改的集合中，您将了解 NewItem 索引。

# web-services - 我在哪里可以获得世界各地城市/地方的数据库？

> ID：324039
> 
> 赞同：10
> 
> 时间：2008-11-27T15:30:01.547
> 
> 标签：web-services, geolocation

在 dopplr [ [http://www.dopplr.com]](http://www.dopplr.com])有一个选项可以填写旅行城市，网站会自动找到世界各地的城市。是否有任何网络服务或数据库可用于此类城市查找？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-27T16:00:27.633

[http://www.geonames.org/](http://www.geonames.org/)很有用 - HTML 查询、下载和网络服务。

还有[http://developer.yahoo.com/geo/](http://developer.yahoo.com/geo/) - 你需要一个 Yahoo 开发者 ID。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-27T15:33:24.817

Google 地图 API 包括[地理编码服务](http://code.google.com/apis/maps/documentation/services.html)，还有[很多其他选项](http://www.google.com/search?q=geocoding%20service)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T15:36:11.193

[您可以在 wikipedia 上](http://en.wikipedia.org/wiki/City#Lists)下载并处理此列表。如果你相信它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-18T22:12:55.753

我发现的最好的世界城市免费数据库来自 MaxMind。请参阅[http://www.maxmind.com/app/geolitecity](http://www.maxmind.com/app/geolitecity)它还包括地理编码信息和人口。使用国家和地区的 ISO 标准。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-18T22:19:32.167

有[OpenStreetMap 名称查找器](http://wiki.openstreetmap.org/wiki/Name_finder)。

我不知道它是否一定是最完整的资源，但 AFAIK OSM 对任何用途都是免费的，其他选项可能/可能不是这种情况。

# windows - Windows 如何确定/处理任何给定文件的 DOS 短名称？

> ID：324041
> 
> 赞同：12
> 
> 时间：2008-11-27T15:32:41.073
> 
> 标签：windows, file, filesystems, short-filenames

我有一个包含这些文件的文件夹：

```
alongfilename1.txt <--- created first
alongfilename3.txt <--- created second 
```

当我在命令提示符下运行**DIR /x**时，我看到分配了这些短名称：

```
ALONGF~1.TXT alongfilename1.txt
ALONGF~2.TXT alongfilename3.txt 
```

现在，如果我添加另一个文件：

```
alongfilename1.txt 
alongfilename2.txt <--- created third
alongfilename3.txt 
```

我看到这个：

```
ALONGF~1.TXT alongfilename1.txt
ALONGF~3.TXT alongfilename2.txt
ALONGF~2.TXT alongfilename3.txt 
```

美好的。它似乎是根据我创建文件的日期/时间分配“~#”。它是否正确？

现在，如果我删除“alongfilename1.txt”，其他两个文件**将保留它们的短名称**。

```
ALONGF~3.TXT alongfilename2.txt
ALONGF~2.TXT alongfilename3.txt 
```

该 ID（在本例中为 ~1）何时发布以用于另一个短名称。会吗？

另外，我机器上的文件是否有可能有一个短名称 X，而同一文件在另一台机器上有一个短名称 Y？我特别关注其自定义操作使用 DOS 短名称的安装。

多谢你们。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-27T15:51:40.833

如果我是你，我**永远不会**依赖任何文件系统驱动程序的任何版本（无论是微软的，还是其他操作系统的）来保持其用于生成短文件名的算法的一致性。Microsoft Fastfat 和 NTFS 驱动程序的确切行为没有“正式”记录（除了一些高级别的概述），因此不是 API 合同的一部分。如果您更新驱动程序，今天有效的方法明天可能无效。

此外，短名称绝对不需要包含波浪字符 - 例如，请参阅[Raymond Chen 的这篇文章](http://blogs.msdn.com/oldnewthing/archive/2004/04/14/113052.aspx)。

在 MSDN 博客中可以找到有关此主题的大量信息 - 例如：

*   [强制 Windows 使用短文件名的注册表项](https://web.archive.org/web/20190907082504/https://blogs.msdn.microsoft.com/astebner/2005/01/27/registry-key-to-force-windows-to-use-short-filenames/)
*   [NTFS 好奇心（第一部分）：短文件名](https://web.archive.org/web/20190128085320/https://blogs.msdn.microsoft.com/adioltean/2005/01/27/ntfs-curiosities-part-i-short-file-names/)

此外，不要依赖字母数字字符的唯一存在。查看[Linux VFAT 驱动程序](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=fs/fat/namei_vfat.c;h=bf326d4356a3347ff9a143328cbef11c01792213;hb=ed313489badef16d700f5a3be50e8fd8f8294bc8)，例如，大写字母、数字和以下字符的任何组合都是有效的：$ % ' ` - @ { } ~ ! # ( ) & _ ^。NTFS 将在兼容模式下运行...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-27T15:43:09.180

短文件名是随文件创建的。该算法的工作原理是这样的（通常，但请参阅[moocha 的回复](https://stackoverflow.com/questions/324041/how-does-windows-determinehandle-the-dos-short-name-of-any-given-file#324087)）：

```
counter = 1
stripped_filename = strip_dots(strip_non_ascii_characters(filename))
shortfn = first_6_characters(stripped_filename)
while (file_exists(shortfn + "~" + counter + "." + extension)) {
    increment counter by 1
    if more digits are added to counter, shorten shortfn by 1 
    /* e.g. if counter comes to 9 and shortf~9.txt is taken. try short~10.txt next */
} 
```

这意味着一旦文件被创建，它将保留它的短名称，直到它被删除。

一旦文件被删除，短名称就可以再次使用。

如果您将文件移动到其他地方，它可能会获得一个新的短名称（例如，您将 c:\somefilewithlongname.txt ("c:\somefi~1.txt") 移动到 d:\stuff\somefilewithlongname.txt，如果有 d:\stuff\somefileelse.txt ("d:\stuff\somefi~1.txt")，被移动文件的短名称为 somefi~2.txt)。似乎短名称仅在给定机器上的给定目录中持久存在。

所以：短文件名将由文件系统生成，通常通过上述方法。最好假设短文件名不是持久的，因为 c:\longfi~1.txt 在一台机器上可能是“c:\longfilename.txt”，而在另一台机器上可能是“c:\longfish_story.txt”；此外，当文件被删除时，短名称会立即再次可用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-27T15:46:48.580

我相信 MSDOS 将长名称和短名称之间的关联存储在每个目录文件中。

它不取决于日期/时间。

如果您将文件移动到新目录中......这将重置 Piskvor 提到的算法再次应用

在新目录中（移动后），您将获得：

```
ALONGF~1.TXT alongfilename1.txt
ALONGF~2.TXT alongfilename2.txt
ALONGF~3.TXT alongfilename3.txt 
```

即使沿着文件名 2.txt 最初是第三个创建的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T15:47:16.693

[这个链接](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/prork/prdf_fls_ggrm.mspx?mfr=true)说明了 NTFS 是如何做到的。我猜想在更新的版本上它仍然是相同的想法。

> 在 Windows 2000 中，FAT 和 NTFS 都使用 Unicode 字符集作为它们的名称，其中包含一些 MS-DOS 无法读取的禁止字符。为了生成一个简短的 MS-DOS 可读文件名，Windows 2000 会从 LFN 中删除所有这些字符并删除所有空格。因为 MS-DOS 可读文件名只能有一个句点，Windows 2000 也会从文件名中删除所有多余的句点。接下来，如有必要，Windows 2000 将文件名截断为六个字符，并附加一个波浪号 (~) 和一个数字。例如，每个不重复的文件名都附加了 ~1 。重复的文件名以 ~2 结尾，然后以 ~3 结尾，依此类推。文件名被截断后，文件扩展名被截断为三个或更少的字符。最后，在命令行显示文件名时，

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-24T17:32:37.300

当文件由运行 Samba 的网络服务器提供时，短名称由服务器生成，它们不遵循可预测的模式。

因此，假设您可以预测短名称的形式是不安全的。

```
 G:\>dir /x *.txt

 Directory of G:\

08/25/2009  12:34 PM             1,848 S2XYYV~1.TXT strace_output.txt
03/01/2010  05:32 PM           325,428 TEY7IH~O.TXT tomcat-dump-march-1.txt
03/11/2010  12:01 AM             5,811 DI356A~S.TXT ddmget-output.txt
01/23/2009  01:03 PM           313,880 DLA94Q~K.TXT ddm-log-fn.txt
04/20/2010  07:42 PM             7,491 A50QZP~A.TXT april-20-2010.txt 
```

# c++ - 如何最好地从模板混乱切换到干净的类架构（C++）？

> ID：324043
> 
> 赞同：1
> 
> 时间：2008-11-27T15:33:37.483
> 
> 标签：c++, templates, simplify

假设一个较大的模板库包含大约 100 个文件，其中包含大约 100 个模板，总共超过 200,000 行代码。一些模板使用多重继承使库本身的使用变得相当简单（即从一些基本模板继承并且只需要实现某些业务规则）。

所有存在的（经过几年的发展）、“工作”并用于项目。

但是，使用该库编译项目会消耗越来越多的时间，并且需要相当长的时间才能找到某些错误的源。修复通常会导致意想不到的副作用或相当困难，因为一些相互依赖的模板需要更改。由于功能数量众多，几乎不可能进行测试。

现在，我真的很想简化架构以使用更少的模板和更专业的小类。

是否有任何行之有效的方法来完成这项任务？什么是开始的好地方？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-27T16:06:44.813

我不确定我是否了解模板如何/为什么会出现问题，以及为什么普通的非模板类会有所改进。这难道不是意味着*更多的*类、更少的类型安全以及更大的潜在错误吗？

我可以理解简化架构、重构和删除各种类和模板之间的依赖关系，但是自动假设“更少的模板将使架构更好”是有缺陷的 imo。

我会说模板*可能*让您构建一个比没有它们时更简洁的架构。仅仅因为您可以使单独的类*完全*独立。如果没有模板，调用另一个类的类函数必须提前知道该类或其继承的接口。使用模板，这种耦合不是必需的。

删除模板只会导致*更多*的依赖，而不是更少。添加的模板类型安全可用于在编译时检测大量错误（为此目的，使用 static_assert 自由地散布您的代码）

当然，在某些情况下，增加的编译时间可能是避免使用模板的正当理由，如果您只有一群习惯于“传统”OOP 术语思考的 Java 程序员，模板可能会使他们感到困惑，这可以是避免使用模板的另一个正当理由。

但从架构的角度来看，我认为避免使用模板是朝着错误方向迈出的一步。

重构应用程序，当然，这听起来很有必要。但是不要仅仅因为应用程序的原始版本滥用了它，就丢弃了生成可扩展和健壮代码的最有用的工具之一。特别是如果您已经关心代码量，删除模板很可能会导致*更多*代码行。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-27T15:50:29.540

您需要自动化测试，这样在十年后当您的继任者遇到同样问题时，他可以重构代码（可能添加更多模板，因为他认为这将简化库的使用）并且知道它仍然满足所有测试用例。同样，任何小错误修复的副作用都将立即可见（假设您的测试用例很好）。

除此之外，“分而治之”

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-27T15:54:07.567

编写单元测试。

新代码必须与旧代码相同的地方。

这至少是一个提示。

编辑：

如果您弃用已用新功能替换的旧代码，您可以逐步过渡到新代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-27T15:45:48.007

好吧，问题是模板的思维方式与面向对象的基于继承的方式非常不同。除了“重新设计整个事物并从头开始”之外，很难回答其他任何问题。

当然，对于特定情况可能有一种简单的方法。如果不了解您拥有的更多信息，我们将无法判断。

模板解决方案如此难以维护的事实无论如何都表明设计不佳。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-27T16:03:53.023

一些要点（但请注意：这些确实*不是*邪恶的。但是，如果您想更改为非模板代码，这可能会有所帮助）：

* * *

**查找您的静态接口**。模板在哪里取决于存在哪些功能？他们在哪里需要 typedef？

将公共部分放在抽象基类中。一个很好的例子是当您偶然发现 CRTP 习语时。您可以将其替换为具有虚函数的抽象基类。

**查找整数列表**。如果您发现您的代码使用像 的整数列表`list<1, 3, 3, 1, 3>`，您可以将它们替换为`std::vector`，如果所有使用它们的代码都可以使用运行时值而不是常量表达式。

**查找类型特征**。有很多代码涉及检查某些 typedef 是否存在，或者某些方法是否存在于典型的模板化代码中。抽象基类通过使用纯虚方法和将 typedef 继承到基类来解决这两个问题。通常，typedef 只需要触发像*SFINAE*这样的可怕功能，这也是多余的。

**查找表达式模板**。如果您的代码使用表达式模板来避免创建临时变量，您将不得不消除它们并使用将临时变量返回/传递给相关操作员的传统方式。

**查找函数对象**。如果你发现你的代码使用了函数对象，你也可以将它们更改为使用抽象基类，并且有类似`void run();`调用它们的东西（或者如果你想继续使用`operator()`，最好是这样！它也可以是虚拟的）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-27T23:49:25.423

据我了解，您最关心构建时间和库的可维护性？

首先，不要试图一次“修复”所有问题。

其次，了解您要解决的问题。模板的复杂性通常是有原因的，例如强制某些用途，并使编译器帮助您不犯错误。这个原因有时可能会被认为很远，但是不应该掉以轻心，因为“没有人真正知道他们在做什么”而抛出 100 行。我在这里建议的所有内容都可能引入非常讨厌的错误，您已被警告过。

第三，首先考虑更便宜的修复：例如更快的机器或分布式构建工具。至少，把板子占用的所有内存都扔进去，扔掉旧磁盘。它确实有所作为。一个用于操作系统的驱动器，一个用于构建的驱动器是廉价的人 RAID。

图书馆是否有据可查？那是你制作它的最佳机会。查看诸如 doxygen 之类的工具来帮助你创建这样的文档。

都考虑了？好的，现在对构建时间提出一些建议；）

* * *

了解 C++**[构建模型](http://www.cs.cf.ac.uk/Dave/C/node3.html)**：每个 .cpp 都是单独编译的。这意味着许多带有许多标头的 .cpp 文件 = 巨大的构建。不过，这并不是将所有内容都放入一个 .cpp 文件的建议！但是，可以极大地加快构建速度的一个技巧（！）是创建一个包含一堆 .cpp 文件的单个 .cpp 文件，并且只将该“主”文件提供给编译器。但是，您不能盲目地这样做——您需要了解这可能引入的错误类型。

如果您还没有，请获得一台可以远程**访问的单独构建机器。**你必须做很多几乎完整的构建来检查你是否破坏了一些包含。您将希望在另一台机器上运行它，这不会阻止您从事其他工作。从长远来看，无论如何您都需要它来进行日常集成构建；）

使用**预编译头文件**。（使用快速机器可以更好地扩展，见上文）

**检查您的标头包含政策**。虽然每个文件都应该是“独立的”（即包含它需要被其他人包含的所有内容），但不要随意包含。不幸的是，我还没有找到一个工具来查找不必要的#incldue 语句，但花一些时间删除“热点”文件中未使用的标题可能会有所帮助。

**为您使用的模板创建和使用前向声明**。通常，您可以在许多地方包含带有前向声明的标题，而仅在少数特定的地方使用完整的标题。这可以极大地帮助编译时间。检查`<iosfwd>`标头标准库如何为 i/o 流执行此操作。

**少数类型的模板重载**：如果您有一个仅对少数类型有用的复杂函数模板，如下所示：

```
// .h
template <typename FLOAT> // float or double only
FLOAT CalcIt(int len, FLOAT * values) { ... } 
```

您可以在标头中声明重载，并将模板移动到正文：

```
// .h
float CalcIt(int len, float * values);
double CalcIt(int len, double * values);

// .cpp
template <typename FLOAT> // float or double only
FLOAT CalcItT(int len, FLOAT * values) { ... }

float CalcIt(int len, float * values) { return CalcItT(len, values); }
double CalcIt(int len, double * values) { return CalcItT(len, values); } 
```

这会将冗长的模板移动到单个编译单元。
不幸的是，这仅对类有有限的用途。

检查[**PIMPL 习语**](http://www.google.de/search?q=PIMPL+idiom)[是否可以将](http://www.google.de/search?q=PIMPL+idiom)**代码从标头移动到 .cpp 文件中。**

 **隐藏在它后面的一般规则是**将库的接口与实现分开**。使用注释、`detail`命名空间和单独`.impl.h`的标题在精神上和物理上将外部应该知道的内容与其完成方式隔离开来。这暴露了您的库的真正价值（它实际上封装了复杂性吗？），并让您有机会首先替换“简单目标”。

* * *

更具体的建议——以及给出的建议有多有用——很大程度上取决于实际的图书馆。

祝你好运！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-27T15:55:20.047

如前所述，单元测试是个好主意。实际上，与其通过引入可能会产生影响的“简单”更改来破坏您的代码，不如专注于创建一套测试，并修复不符合测试的问题。当错误出现时，有一个更新测试的活动。

除此之外，如果可能的话，我建议升级您的工具，以帮助调试与模板相关的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-27T20:33:19.127

我经常遇到巨大的遗留模板，需要大量时间和内存来实例化，但并非必须如此。在这些情况下，最简单的删除胖子的方法是获取所有不依赖任何模板参数的代码，并将其隐藏在正常翻译单元中定义的单独函数中。当必须稍微修改此代码或更改文档时，这也具有触发更少重新编译的积极副作用。这听起来很明显，但令人惊讶的是，人们经常编写类模板并认为它所做的一切都必须在标题中定义，而不仅仅是需要模板信息的代码。

您可能要考虑的另一件事是通过使模板“mixin”样式而不是多重继承的聚合来清理继承层次结构的频率。看看有多少地方可以让模板参数之一成为它应该派生的基类的名称（工作方式`boost::enable_shared_from_this`）。当然，这通常只有在构造函数不带参数时才能正常工作，因为您不必担心正确初始化任何内容。

# asp.net - 从 ASP.NET 连接到 Oracle 非常慢 - 如何诊断？

> ID：324044
> 
> 赞同：0
> 
> 时间：2008-11-27T15:33:59.620
> 
> 标签：asp.net, performance, oracle, debugging

我有一个连接到 oracle 数据库的 ASP.NET 应用程序。

dev 中某些查询的性能非常慢 - 连接到数据库、运行查询（实际上是调用包中的 SP）并返回单行结果大约需要 90 秒。

我在应用程序上运行了一个分析器，大约 100% 的时间花在本机代码 Oracle.DataAccess.Client.OpsDac.Read （在 OraOps10.dll 中）

相同的查询在 prod 中运行良好。TNSPING dev db 低于 10ms，事实上我通过 sqldeveloper 连接没有问题。

如何确定导致减速的原因？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:37:58.083

DEV Web 服务器和 DB 是否在同一台机器上？是你的本地机器吗？

如果不是，响应时间是否与您的本地计算机相似？

您可以将 DEV Web 应用程序指向 PROD 吗？如果是，时间是否相同？

这是单个查询还是所有查询？

# .net - Windows 临时文件行为 - 它们是否被系统删除？

> ID：324045
> 
> 赞同：43
> 
> 时间：2008-11-27T15:34:21.163
> 
> 标签：.net, windows, file

使用 .net 框架，您可以选择创建临时文件

```
Path.GetTempFileName(); 
```

MSDN 没有告诉我们临时文件会发生什么。我记得在某处读到它们在重新启动时被操作系统删除。这是真的？

如果文件没有被操作系统删除，为什么它们被称为临时文件？它们是普通目录中的普通文件。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-27T17:47:23.377

简短的回答：它们不会被删除。

长答案：托管[`Path.GetTempFileName()`](http://msdn.microsoft.com/en-us/library/system.io.path.gettempfilename.aspx)方法调用本机 Win32API[`GetTempFileName()`](http://msdn.microsoft.com/en-us/library/aa364991.aspx)方法，如下所示：

```
//actual .NET 2.0 decompiled code 
// .NET Reflector rocks for looking at plumbing
public static string GetTempFileName()
{
    string tempPath = GetTempPath();
    new FileIOPermission(FileIOPermissionAccess.Write, tempPath).Demand();
    StringBuilder tmpFileName = new StringBuilder(260);
    if (Win32Native.GetTempFileName(tempPath, "tmp", 0, tmpFileName) == 0)
    {
        __Error.WinIOError();
    }
    return tmpFileName.ToString();
} 
```

本机方法的文档指出：

> ![](https://stackoverflow.com/Content/img/wmd/blockquote.png)名称已由该函数创建的临时文件不会自动删除。要删除这些文件，请调用 DeleteFile。

我发现了一篇很棒的文章，名为[“那些讨厌的临时文件”](https://web.archive.org/web/20071020031505/http://dotnet.org.za/markn/archive/2006/04/15/51594.aspx)（2007 年 10 月存档），它从基础开始，涉及处理临时文件的一些不太明显的问题，例如：

*   如何确保文件被删除（即使应用程序崩溃！提示：[`FileOption.DeleteOnClose`](http://msdn.microsoft.com/en-us/library/system.io.fileoptions.aspx)并让内核处理它）
*   如何为文件获取正确的缓存策略，以提高性能（提示[`FileAttributes.Temporary`](http://msdn.microsoft.com/en-us/library/system.io.fileattributes.aspx)：）
*   如何确保文件内容保持安全，因为：
    *   使用托管方法的文件名比使用非托管方法更容易预测
    *   临时文件被创建，然后*关闭*，然后你得到它的路径（只能再次打开它），从而为恶意代码/用户劫持文件留下了一个小机会。

文章中的 C# 代码：

```
using System;
using System.IO;
using System.Security.Permissions;
using System.Security.Principal;
using System.Security.AccessControl;

public static class PathUtility
{
    private const int defaultBufferSize = 0x1000; // 4KB

#region GetSecureDeleteOnCloseTempFileStream

    /// <summary>
    /// Creates a unique, randomly named, secure, zero-byte temporary file on disk, which is automatically deleted when it is no longer in use. Returns the opened file stream.
    /// </summary>
    /// <remarks>
    /// <para>The generated file name is a cryptographically strong, random string. The file name is guaranteed to be unique to the system's temporary folder.</para>
    /// <para>The <see cref="GetSecureDeleteOnCloseTempFileStream"/> method will raise an <see cref="IOException"/> if no unique temporary file name is available. Although this is possible, it is highly improbable. To resolve this error, delete all uneeded temporary files.</para>
    /// <para>The file is created as a zero-byte file in the system's temporary folder.</para>
    /// <para>The file owner is set to the current user. The file security permissions grant full control to the current user only.</para>
    /// <para>The file sharing is set to none.</para>
    /// <para>The file is marked as a temporary file. File systems avoid writing data back to mass storage if sufficient cache memory is available, because an application deletes a temporary file after a handle is closed. In that case, the system can entirely avoid writing the data. Otherwise, the data is written after the handle is closed.</para>
    /// <para>The system deletes the file immediately after it is closed or the <see cref="FileStream"/> is finalized.</para>
    /// </remarks>
    /// <returns>The opened <see cref="FileStream"/> object.</returns>
    public static FileStream GetSecureDeleteOnCloseTempFileStream()
    {    
        return GetSecureDeleteOnCloseTempFileStream(defaultBufferSize, FileOptions.DeleteOnClose);    
    }

    /// <summary>
    /// Creates a unique, randomly named, secure, zero-byte temporary file on disk, which is automatically deleted when it is no longer in use. Returns the opened file stream with the specified buffer size.
    /// </summary>
    /// <remarks>
    /// <para>The generated file name is a cryptographically strong, random string. The file name is guaranteed to be unique to the system's temporary folder.</para>
    /// <para>The <see cref="GetSecureDeleteOnCloseTempFileStream"/> method will raise an <see cref="IOException"/> if no unique temporary file name is available. Although this is possible, it is highly improbable. To resolve this error, delete all uneeded temporary files.</para>
    /// <para>The file is created as a zero-byte file in the system's temporary folder.</para>
    /// <para>The file owner is set to the current user. The file security permissions grant full control to the current user only.</para>
    /// <para>The file sharing is set to none.</para>
    /// <para>The file is marked as a temporary file. File systems avoid writing data back to mass storage if sufficient cache memory is available, because an application deletes a temporary file after a handle is closed. In that case, the system can entirely avoid writing the data. Otherwise, the data is written after the handle is closed.</para>
    /// <para>The system deletes the file immediately after it is closed or the <see cref="FileStream"/> is finalized.</para>
    /// </remarks>
    /// <param name="bufferSize">A positive <see cref="Int32"/> value greater than 0 indicating the buffer size.</param>
    /// <returns>The opened <see cref="FileStream"/> object.</returns>
    public static FileStream GetSecureDeleteOnCloseTempFileStream(int bufferSize)
    {
        return GetSecureDeleteOnCloseTempFileStream(bufferSize, FileOptions.DeleteOnClose);
    }

    /// <summary>
    /// Creates a unique, randomly named, secure, zero-byte temporary file on disk, which is automatically deleted when it is no longer in use. Returns the opened file stream with the specified buffer size and file options.
    /// </summary>  
    /// <remarks>
    /// <para>The generated file name is a cryptographically strong, random string. The file name is guaranteed to be unique to the system's temporary folder.</para>
    /// <para>The <see cref="GetSecureDeleteOnCloseTempFileStream"/> method will raise an <see cref="IOException"/> if no unique temporary file name is available. Although this is possible, it is highly improbable. To resolve this error, delete all uneeded temporary files.</para>
    /// <para>The file is created as a zero-byte file in the system's temporary folder.</para>
    /// <para>The file owner is set to the current user. The file security permissions grant full control to the current user only.</para>
    /// <para>The file sharing is set to none.</para>
    /// <para>The file is marked as a temporary file. File systems avoid writing data back to mass storage if sufficient cache memory is available, because an application deletes a temporary file after a handle is closed. In that case, the system can entirely avoid writing the data. Otherwise, the data is written after the handle is closed.</para>
    /// <para>The system deletes the file immediately after it is closed or the <see cref="FileStream"/> is finalized.</para>
    /// <para>Use the <paramref name="options"/> parameter to specify additional file options. You can specify <see cref="FileOptions.Encrypted"/> to encrypt the file contents using the current user account. Specify <see cref="FileOptions.Asynchronous"/> to enable overlapped I/O when using asynchronous reads and writes.</para>
    /// </remarks>
    /// <param name="bufferSize">A positive <see cref="Int32"/> value greater than 0 indicating the buffer size.</param>
    /// <param name="options">A <see cref="FileOptions"/> value that specifies additional file options.</param>
    /// <returns>The opened <see cref="FileStream"/> object.</returns>
    public static FileStream GetSecureDeleteOnCloseTempFileStream(int bufferSize, FileOptions options)
    {    
        FileStream fs = GetSecureFileStream(Path.GetTempPath(), bufferSize, options | FileOptions.DeleteOnClose);

        File.SetAttributes(fs.Name, File.GetAttributes(fs.Name) | FileAttributes.Temporary);

        return fs;    
    }

#endregion

#region GetSecureTempFileStream

    public static FileStream GetSecureTempFileStream()
    {    
        return GetSecureTempFileStream(defaultBufferSize, FileOptions.None);    
    }

    public static FileStream GetSecureTempFileStream(int bufferSize)
    {
        return GetSecureTempFileStream(bufferSize, FileOptions.None);
    }

    public static FileStream GetSecureTempFileStream(int bufferSize, FileOptions options)
    {
        FileStream fs = GetSecureFileStream(Path.GetTempPath(), bufferSize, options);

        File.SetAttributes(fs.Name, File.GetAttributes(fs.Name) | FileAttributes.NotContentIndexed | FileAttributes.Temporary);

        return fs;
    }

    #endregion

#region GetSecureTempFileName

    public static string GetSecureTempFileName()
    {    
        return GetSecureTempFileName(false);    
    }

    public static string GetSecureTempFileName(bool encrypted)
    {    
        using (FileStream fs = GetSecureFileStream(Path.GetTempPath(), defaultBufferSize, encrypted ? FileOptions.Encrypted : FileOptions.None))
        {    
            File.SetAttributes(fs.Name, File.GetAttributes(fs.Name) | FileAttributes.NotContentIndexed | FileAttributes.Temporary);

            return fs.Name;    
        }

    }

#endregion

#region GetSecureFileName

    public static string GetSecureFileName(string path)
    {    
        return GetSecureFileName(path, false);    
    }

    public static string GetSecureFileName(string path, bool encrypted)
    {    
        using (FileStream fs = GetSecureFileStream(path, defaultBufferSize, encrypted ? FileOptions.Encrypted : FileOptions.None))
        {    
            return fs.Name;    
        }    
    }

#endregion

#region GetSecureFileStream

    public static FileStream GetSecureFileStream(string path)
    {    
        return GetSecureFileStream(path, defaultBufferSize, FileOptions.None);    
    }

    public static FileStream GetSecureFileStream(string path, int bufferSize)
    {
        return GetSecureFileStream(path, bufferSize, FileOptions.None);
    }

    public static FileStream GetSecureFileStream(string path, int bufferSize, FileOptions options)
    {    
        if (path == null)
            throw new ArgumentNullException("path");

        if (bufferSize <= 0)
            throw new ArgumentOutOfRangeException("bufferSize");

        if ((options & ~(FileOptions.Asynchronous | FileOptions.DeleteOnClose | FileOptions.Encrypted | FileOptions.RandomAccess | FileOptions.SequentialScan | FileOptions.WriteThrough)) != FileOptions.None)
            throw new ArgumentOutOfRangeException("options");

        new FileIOPermission(FileIOPermissionAccess.Write, path).Demand();

        SecurityIdentifier user = WindowsIdentity.GetCurrent().User;

        FileSecurity fileSecurity = new FileSecurity();

        fileSecurity.AddAccessRule(new FileSystemAccessRule(user, FileSystemRights.FullControl, AccessControlType.Allow));

        fileSecurity.SetAccessRuleProtection(true, false);

        fileSecurity.SetOwner(user);

        // Attempt to create a unique file three times before giving up.
        // It is highly improbable that there will ever be a name clash,
        // therefore we do not check to see if the file first exists.

        for (int attempt = 0; attempt < 3; attempt++)
        {    
            try
            {    
                return new FileStream(Path.Combine(path, Path.GetRandomFileName()),
                                        FileMode.CreateNew, FileSystemRights.FullControl,
                                        FileShare.None, bufferSize, options, fileSecurity);
            }

            catch (IOException)
            {
                if (attempt == 2)
                    throw;
            }

        }

        // This code can never be reached.
        // The compiler thinks otherwise.
        throw new IOException();

    }

#endregion

} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-27T15:36:24.013

根据我 %tmp% 中的 March 文件，我不会说。

重新为什么将它们称为临时的-因为这是它们的预期用途。它们不是系统文件；它们不是应用程序文件，也不是用户文档……它们的存在只是为了允许应用程序进行临时处理（可能处理大量数据），或者经常通过 IPC 将数据传递给另一个进程。因此，它们确实是暂时的。

您的目标应该是删除您创建的任何临时文件，无法承受致命的“杀死”等。我经常为此使用“使用” - 我创建一个包装类 - 即

```
sealed class TempFile : IDisposable { // formatted for space
    string path;
    public string Path {
        get {
            if(path==null) throw new ObjectDisposedException(GetType().Name);
            return path;
        }
    }
    public TempFile() : this(System.IO.Path.GetTempFileName()) { }

    public TempFile(string path) {
        if (string.IsNullOrEmpty(path)) throw new ArgumentNullException("path");
        this.path = path;
    }

    private void Dispose(bool disposing) {
        if (path != null) {
            try {
                File.Delete(path);
            } catch { } // best endeavours...
            path = null;
        }
    }
    public void Dispose() {
        GC.SuppressFinalize(this);
        Dispose(true);
    }
    ~TempFile() {
        Dispose(false);
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-27T15:40:42.993

有一个**FileOptions.DeleteOnClose**选项可以做你想做的事。

这是[MSDN](http://msdn.microsoft.com/en-us/library/system.io.path.gettempfilename(VS.80).aspx)页面的链接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T15:36:15.387

不，这不是真的。基本上，您的应用程序负责清理自己的烂摊子。如果不这样做，临时文件会随着时间的推移而累积。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T15:40:05.553

不，它由创建临时文件来处理它的软件（阅读：开发人员）负责。

查看您自己的临时文件夹，看看效果如何；-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-27T16:30:17.213

它们被称为临时文件，因为在大多数情况下，用户可以假设她可以安全地清理临时目录中的混乱......如果不是，一般来说，这些文件无论如何都会被锁定。

一般来说，这些文件应该是短暂的：创建它们，根据需要使用它们，当场删除它们。更糟糕的是，在退出应用程序时删除它们。

有时，你不能，例如。存档管理器或 VCS 允许使用编辑器（或差异查看器等）查看文件，但在编辑器之前关闭（或无法监视生成的进程......）。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-11-24T23:26:00.760

我在互联网上读过很多次人们不想使用的 `Path.GetTempFileName`文章，因为他们说它可以返回一个已经存在的文件，为了解决这个问题，你可以根据 GUID 创建一个文件名。

这个函数解决了这个问题：迭代直到找到一个不存在的具有特定扩展名的文件名。

VB.net

```
Public Shared Function GetTempFileName(ByVal extensionWithDot As String) As String
    Dim tempFileName As String
    Do
        tempFileName = System.IO.Path.GetTempFileName
        If extensionWithDot IsNot Nothing Then
            tempFileName = tempFileName.Replace(System.IO.Path.GetExtension(tempFileName), extensionWithDot)
        End If
    Loop While System.IO.File.Exists(tempFileName)
    Return tempFileName
End Function 
```

C＃：

```
public static string GetTempFileName(string extensionWithDot)
{
    string tempFileName = null;
    do {
        tempFileName = System.IO.Path.GetTempFileName;
        if (extensionWithDot != null) {
            tempFileName = tempFileName.Replace(System.IO.Path.GetExtension(tempFileName), extensionWithDot);
        }
    } while (System.IO.File.Exists(tempFileName));
    return tempFileName;
} 
```

注意：我使用参数 extensionWithDot 因为 System.IO.Path.GetExtension 返回点。

# asp.net - 管理页面顺序

> ID：324047
> 
> 赞同：2
> 
> 时间：2008-11-27T15:35:19.617
> 
> 标签：asp.net

在一个 ASP.NET 3.5 站点中，我们有一个相对标准的付款结帐流程，其中包含许多需要按顺序访问的页面（购物篮、付款详细信息等）

每个页面都有一个“继续”按钮，可重定向到序列中的下一页。

我想要一种管理页面序列的方法，以便：

1.  我可以有一个定义“继续”按钮及其代码隐藏 OnClick 事件处理程序的母版页
2.  如果用户尝试不按顺序访问页面（例如，通过直接在浏览器中输入 URL），他们会被重定向到正确的页面
3.  此页面序列在我的代码中的一个位置很好地定义（例如在枚举中）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-27T16:00:34.123

为什么不使用 ASP.NET Wizard 控件？

或者（我还没有尝试过，所以我不能说它的效果如何），你可以使用 Windows Workflow 来定义一个顺序工作流，并让它控制顺序页面出现[。http://上有一篇文章www.devx.com/dotnet/Article/34732](http://www.devx.com/dotnet/Article/34732)将带您以这种方式完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T03:36:32.083

检查每个 Page_Load 方法中的 HttpRequest.UrlReferrer 变量...

[http://msdn.microsoft.com/en-us/library/system.web.httprequest.urlreferrer.aspx](http://msdn.microsoft.com/en-us/library/system.web.httprequest.urlreferrer.aspx)

...并且不要忘记检查空值！您可以根据它们的来源将它们弹回应该在的位置。

```
protected void Page_Load(object sender, EventArgs e)
{
    if (!IsPostBack)
    {
        Session["PreviousPage"] = Request.UrlReferrer.ToString();
        ...
    }
    else
    {
        ...
    }
} 
```

# .net - 找出 .NET 对象的大小

> ID：324053
> 
> 赞同：56
> 
> 时间：2008-11-27T15:38:10.593
> 
> 标签：.net, memory-management, garbage-collection, profiling

我试图找出我的对象占用了多少内存，以查看其中有多少最终在[大对象堆上](https://docs.microsoft.com/en-us/dotnet/standard/garbage-collection/large-object-heap)（超过 85,000 字节）。

是否像为 int 添加 4、为 long 添加 8、为每个对象的任何引用类型等添加 4（或 8，如果您使用 64 位，则为 8）一样简单，或者是否有方法、属性等的开销？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-11-27T15:53:09.877

不要忘记实际对象的大小不包括它引用的任何对象的大小。

唯一可能最终出现在大型对象堆上的是数组和字符串——其他对象本身往往相对较小。即使是具有（比如说）10 个引用类型变量（x86 上每个 4 个字节）和 10 个 GUID（每个 16 个字节）的对象也只会占用大约 208 个字节（类型引用和同步块有一点开销）。

同样，在考虑数组的大小时，不要忘记如果元素类型是引用类型，那么只有*引用*的大小才对数组本身计数。换句话说，即使你有一个包含 20,000 个元素的数组，即使它引用了更多的数据，数组对象本身的大小也只会超过 80K（在 x86 上）。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2011-08-19T13:55:56.123

请按照以下步骤获取对象的大小。

1.  转到 Visual Studio 2010 项目属性 →*调试*选项卡 →*启用非托管代码调试*。

2.  转到 Visual Studio*调试*菜单 →*选项和设置*→*调试*→*符号*。

3.  在那里，启用 Microsoft 符号服务器并保留默认值（符号可能会开始下载）。

4.  在代码中设置断点，开始调试 ( `F5`)。

5.  打开*调试*→*窗口*→*立即窗口*。

6.  进入`.load sos.dll`（*罢工之子*）

7.  输入`!DumpHeap -type MyClass`（要查找大小的对象）

8.  从输出中，定位到对象的地址，即 (00a8197c)

    地址 MT 大小 00a8197c 00955124 36

9.  下一个，`!ObjSize 00a8197c`

10.  你去 → sizeof(00a8197c) = 12 (0x48) 字节 (MyClass)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-07-05T09:36:46.847

如果可以的话 - 序列化它！

```
Dim myObjectSize As Long

Dim ms As New IO.MemoryStream
Dim bf As New Runtime.Serialization.Formatters.Binary.BinaryFormatter()
bf.Serialize(ms, myObject)
myObjectSize = ms.Position 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-28T01:46:41.943

您正在进入高级 .NET 调试领域。从[John Robins 调试书籍](https://rads.stackoverflow.com/amzn/click/com/0735622027)开始。

将[WinDBG](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)与 Sos.dll（.NET 发行版的一部分）和[Sosex.dll](http://www.stevestechspot.com/SOSEXANewDebuggingExtensionForManagedCode.aspx)扩展一起使用。使用这些工具，您可以真正看到应用程序运行时发生的情况。您将找到上述问题的答案。

（另一个建议是安装[Shared Source CLI 2.0](http://www.microsoft.com/downloads/details.aspx?FamilyId=8C09FD61-3F26-4555-AE17-3121B4F51D4D&displaylang=en)，又名 Rotor 2，以查看引擎盖下发生了什么。）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-03-26T10:32:39.557

[Gomes 的方法](https://stackoverflow.com/questions/324053/find-out-the-size-of-a-net-object/7122653#7122653)简化：

1.  转到 Visual Studio (2010) 项目属性* →*调试*选项卡 →*启用非托管代码调试*。

2.  在代码中设置断点，开始调试 ( `F5`)。

3.  打开*调试*→*窗口*→*立即窗口*。

4.  进入`.load sos`

5.  输入（将 myObject 替换为您的对象的名称）

    > ? String.Format("{0:x}",Integer.Parse(System.Runtime.InteropServices.GCHandle.InternalAddrOfPinnedObject(System.Runtime.InteropServices.GCHandle.Alloc( *myObject* ).GetHandleValue()).ToString())

6.  使用结果作为参数`!ObjSize`

请参阅：[SOS.DLL、对象地址和 Visual Studio 调试器简介](http://thibaud60.blogspot.com/2011/01/sosdll-object-address-and-visual-studio.html)

示例（我们正在寻找名为 的对象`tbl`）：

```
.load sos
extension C:\Windows\Microsoft.NET\Framework\v4.0.30319\sos.dll loaded
? string.Format("{0:x}",Integer.Parse(System.Runtime.InteropServices.GCHandle.InternalAddrOfPinnedObject(System.Runtime.InteropServices.GCHandle.Alloc(tbl).GetHandleValue()).ToString())-4)
"27ccb18"
!ObjSize 27ccb18
PDB symbol for clr.dll not loaded
sizeof(027ccb18) =       154504 (     0x25b88) bytes (System.Data.DataTable) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-27T15:57:50.167

除非它是一个巨大的值类型或实例类型（即数千个字段），否则您需要担心的唯一类型是大型数组或字符串。当然，要计算出数组的大小，你需要知道元素的大小。

.NET（当前）对齐类型的方式与本机编译器对齐类型的方式非常相似。基本类型具有自然对齐，通常是最接近其大小的两个整数幂：

```
Single, Int32, UInt32 - 4
IntPtr, UIntPtr, pointers, references  - 4 on 32-bit, 8 on 64-bit
Double, Int64, UInt64 - 8
Char, Int16, UInt16   - 2
Byte, SByte           - 1 
```

组装类型时，编译器将确保任何给定类型的所有字段在实例内的起始偏移量与匹配该类型的边界对齐 - 假设未使用显式布局。

用户定义类型本身具有对齐方式，该对齐方式被计算为其任何字段类型的最高对齐方式。如果需要，可以扩展类型的大小以使类型的大小也对齐。

但是当然，所有引用类型在大小和对齐方式上仍然只有 IntPtr.Size，所以引用类型的大小不会影响该类型的数组。

请注意，CLR 可以自行选择与上述不同的布局类型，可能是为了增加缓存局部性或减少对齐所需的填充。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-08-31T10:44:42.363

作为估计（2017 年），您可以调试应用程序，在字典生效之前设置断点，拍摄“内存使用快照”（标签：*诊断工具*下的*内存使用*），填写字典并获取另一个快照。

 *这并不准确，但它是一个很好的猜测。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-11-24T10:22:22.497

在这种情况下`Dictionary<TKey, TValue>`，您可以通过二进制序列化来获取对象大小。这是一个示例代码：

```
var dictionary = new DictionaryGenerator().GetSomeLargeDictionary();
var memoryStream = new System.IO.MemoryStream();
var binaryFormatter = new System.Runtime.Serialization.Formatters.Binary.BinaryFormatter();
binaryFormatter.Serialize(memoryStream, dictionary);
Console.WriteLine($"Size of dictionary: {memoryStream.Position} byte(s)"); 
```

# asp.net-mvc - 如何在 3 层 Web 应用程序（ASP.NET MVC）中使用 Autofac？

> ID：324054
> 
> 赞同：9
> 
> 时间：2008-11-27T15:38:19.877
> 
> 标签：asp.net-mvc, dependency-injection, autofac

我可以找到的示例使用两层架构，其中控制器直接使用数据访问层中的存储库类。见[这里](http://code.google.com/p/autofac/wiki/AspNetIntegration)或[这里](http://www.iridescence.no/post/Inversion-of-Control-ASPNET-MVC-and-Unit-Testing.aspx)。

如果您有使用这些组件的服务或业务逻辑层，您会在哪里注册数据访问层的组件？理想情况下，不应从用户界面层引用数据访问层，对吗？所以 Application_Start 不是正确的地方。

有什么更好的方法？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-27T19:03:40.243

必须知道您要使用哪些实现。通常有 3 种方法可以完成此操作：

1.  在编译时这是 Autofac 使用的
2.  在运行时从 Castle Windsor 可以执行的预定义配置文件
3.  在运行时使用动态配置

使用 Autofac，您有几个选择

1.  在 Application_Start 中将所有内容连接在一起
2.  将责任交给另一个实现[工厂模式](http://en.wikipedia.org/wiki/Factory_method_pattern)并注册所需组件的组件。

对于#2，我将实现类似于 IContainer 接口的东西，以便您的 IoC 框架与您的系统松散耦合。然后让您的数据访问实现使用该接口注册所需的组件。

# .net - 我无法在 IIS 6 中更改目标 .NET Framework

> ID：324061
> 
> 赞同：1
> 
> 时间：2008-11-27T15:41:02.447
> 
> 标签：.net, iis, target-framework

在我们在当前项目中使用的特定测试系统上禁用了针对另一个版本的 .Net Framework 的选项。

我尝试了以下方法但没有成功：

*   杀死所有 W3WP.EXE 进程
*   重新启动 IIS 服务
*   远程调试已从框中删除。

只是希望得到一些指点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T15:55:26.020

尝试[在 IIS 上重新注册 ASP.NET](http://community.versionone.com/KnowledgeBase/FAQs/Q10089.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T10:21:01.623

你确定你问的是正确的问题吗？

没有新的 .NET 运行时版本可供定位。如果您有 3.0 或 3.5 框架，您的 IIS 在运行时仍会显示 2.0，因为 3.0 和 3.5 仅在框架类和 2.0 应用程序的编译器方面有所不同！

您应该只在 IIS 配置中看到 1.X 和 2.0 框架。

编辑：目标切换仅在您编译应用程序时发生。因为 2.0、3.0 和 3.5 都在同一个 .NET Runtime Environment 2.0 (VM) 上运行。您仍然需要安装其他框架，因为它们的 API 不同，但都运行在相同的中间语言指令集上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T22:53:40.513

我认为如果您在 .net 安装后安装 iis，就会发生这种情况。只需使用 aspnet_regiis.exe，如前所述。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T10:07:02.290

你在 IIS 中有 ASP.net 服务（允许）吗

无论如何，您可以使用一些 vbscript 来更改 .net 版本。

# c# - 用于在 BlogSpot 上写博客的 C# 语法荧光笔

> ID：324062
> 
> 赞同：7
> 
> 时间：2008-11-27T15:42:00.820
> 
> 标签：c#, syntax-highlighting, blogs, blogspot

我正在为我在 BlogSpot 上的博客寻找语法荧光笔和代码格式化程序。我今天尝试了几个，但都想包含`<style>`标签，或者引用样式表。我正在寻找一个非常适合代码段的，并且包括内联样式。有什么建议么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-08-06T05:19:24.713

上面引用的项目已移动：
[http ://alexgorbatchev.com/wiki/SyntaxHighlighter](http://alexgorbatchev.com/wiki/SyntaxHighlighter)

在 Blogger 上使用它的说明：
mlawire.blogspot.com/2009/07/blogger-syntax-highlighting.html

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-27T16:33:44.867

你总是可以将额外的几个字节的样式复制到你的博客中，比如[Pygments](http://pygments.org/)荧光笔（这真的非常棒） 。`<head>`您甚至不需要安装任何软件；只需从在线服务中复制 HTML。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-03-27T16:16:10.417

我创建了一个[**免费的在线 C# 语法荧光笔**](http://www.pvladov.com/p/code-colorizer.html)，它具有您需要的功能 - 内联所需的 CSS 样式。您所要做的就是选中“内联样式”复选框，粘贴您的 C# 代码并单击“着色”**按钮**。你可以[**在我的博客上找到它**](http://www.pvladov.com/p/code-colorizer.html)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-27T16:23:50.020

试试这个：[http ://code.google.com/p/syntaxhighlighter/](http://code.google.com/p/syntaxhighlighter/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-01T10:04:58.900

我使用[SyntaxHighlighter](http://alexgorbatchev.com/wiki/SyntaxHighlighter) Javascript 库。它真的很容易添加和使用。

这里有更多关于它的信息，可能会帮助其他人：

[http://www.craftyfella.com/2010/01/syntax-highlighting-with-blogger-engine.html](http://www.craftyfella.com/2010/01/syntax-highlighting-with-blogger-engine.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-27T15:46:57.550

我有这个确切的问题。

[我为Pygments](http://pygments.org)编写了一个图像格式化程序（包含在核心发行版中）。

请不要因为这样的可憎而恨我，但是是的，它将突出显示的代码呈现为 png 或 jpg 或任何你想要的。所以它没有外部依赖等。

```
pygmentize -f png -o mysource.png mysource.cs 
```

我尝试确保始终链接纯文本版本的源代码以供人们复制粘贴。

# c# - 如何强制在 C# 中调用基本构造函数？

> ID：324066
> 
> 赞同：16
> 
> 时间：2008-11-27T15:43:49.337
> 
> 标签：c#, asp.net, oop, constructor, c#-2.0

我有一个 BasePage 类，所有其他页面都来自：

```
public class BasePage 
```

此 BasePage 有一个构造函数，其中包含必须始终运行的代码：

```
public BasePage()
{
    // Important code here
} 
```

我想强制派生类调用基构造函数，如下所示：

```
public MyPage
    : base()
{
    // Page specific code here
} 
```

**我该如何强制执行（最好在编译时）？**

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-27T15:48:53.817

基本构造函数总是会在某个时候被调用。如果你调用`this(...)`而不是`base(...)`调用同一个类中的另一个构造函数 - 这又将不得不调用另一个同级构造函数或父构造函数。迟早你总会遇到一个构造函数，它要么`base(...)`显式调用，要么隐式调用基类的无参数构造函数。

有关构造函数链接的更多信息，请参阅[本文](http://pobox.com/~skeet/csharp/constructors.html)，包括各个位的执行点（例如变量初始值设定项）。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-27T15:46:24.900

如果您没有显式调用任何其他带参数的基类构造函数，则不带参数的基类构造函数会自动运行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-27T15:46:36.490

基类构造函数总是被调用，即使你没有显式调用它。所以你不需要做任何额外的工作来确保发生这种情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T15:47:15.333

始终需要调用基本构造函数之一，并且在未明确说明基本构造函数时调用默认构造函数。

编辑：为了清楚起见，重新措辞。

# objective-c - 如何阻止将超类方法调用到子类

> ID：324080
> 
> 赞同：5
> 
> 时间：2008-11-27T15:50:08.027
> 
> 标签：objective-c, cocoa

我正在使用子类扩展类的功能，并且我正在做一些肮脏的事情，使超类方法在子类的上下文中变得危险（应用程序将挂在循环中）。我知道这不是一个天才的想法，但我正在寻找低调的果实，现在它可以为我节省一些时间。哦，这是一项肮脏的工作，但总得有人去做。

最重要的是，我需要从外部阻止该方法，或者在直接调用超类时抛出异常。（但我仍然从子类中使用它，除非要小心）。

最好的方法是什么？

更新 - -

所以这就是我的目标。我不是自我回答，因为 Boaz 的回答提到了多种有效的方法来做到这一点，这正是适合我的方式。在子类中，我重写了这样的方法：

```
- (int)dangerousMethod
{
  [NSException raise:@"Danger!" format:@"Do not call send this method directly to this subclass"];
  return nil;
} 
```

我将此标记为已回答，但显然这并不意味着它已关闭，欢迎提供进一步的建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-27T16:15:27.900

只需在您的子类中重新实现 unsafe 方法并让它什么都不做或抛出异常或将其重新实现为安全的，只要新实现不调用 unsafe 超类方法即可。

对于这里的 C++ 工作人员：Objective C 不允许您将方法标记为私有。您可以使用其类别系统将接口拆分为单独的文件（从而隐藏“私有”文件），但类上的所有方法都是公共的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-06-01T23:05:38.530

您可以覆盖要在子类`.h`文件中阻止的任何方法。您可以`dangerousMethod`通过将以下内容放入`.h`文件中来使其不可用。

```
- (int)dangerousMethod __attribute__((unavailable("message"))); 
```

这将使`dangerousMethod`使用您的子类的任何人都无法使用该方法。

为了防止其他代码使用此方法的超类版本，您可以通过将其放入`.m`文件中来进一步限制。

```
- (int)dangerousMethod 
{
    return nil;     
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T16:38:14.110

注意：我是 ObjC/Cocoa 新人：

```
@implementation MyClass
-(void)myMethod:(NSString *)txt{
    if([self class] != [MyClass class]) return;
    NSLog(@"Hello");
}
@end 
```

彼得

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T17:34:53.137

本文解释了如何[在 Objective C 中创建私有变量](http://macdevelopertips.com/objective-c/private-methods.html)。它们并不是真正私有的，但是根据我的阅读，如果您尝试从子类中调用它们，编译器会发出警告。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-11-27T15:54:38.597

如果您将超类中的方法创建为“私有”，则子类无法调用它们。我不熟悉Objective C，但我见过的所有其他面向对象的语言都有“私有”限定符。

# c# - 以编程方式设置发布页面内容

> ID：324085
> 
> 赞同：4
> 
> 时间：2008-11-27T15:50:58.323
> 
> 标签：c#, .net, sharepoint, moss

我想知道如何通过代码（MOSS 2007）设置发布页面内容。
这就是我创建页面的方式：

```
PublishingPage page = publishingWeb.GetPublishingPages().Add("MyPage.aspx", pageLayout);
SPFile pageFile = page.ListItem.File;
page.Title = "My Page";                    
page.Update(); 
```

但是我设置它的内容的尝试没有奏效。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T17:31:30.163

我不知道是否可以**回答**我自己的问题，但是在反映了 Sharepoint 的代码隐藏之后，我能够找到一种设置页面内容的方法：

```
string content = "Welcome to <strong>My Page</strong>";
page.ListItem[FieldId.PublishingPageContent] = content; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T17:31:46.543

就个人而言，我认为您可能会以错误的方式进行操作。

为什么不将您的代码包装在一个功能中，该功能甚至可以包含物理 aspx 文件，但页面内容是可选的。

然后，您可以在激活该功能时将该页面添加到 SharePoint 附带的标准页面文档库中，这都可以通过 CAML (XML) 完成，并且您不必在功能接收器中编写代码。

# c# - 为什么 System.Web.Hosting.ApplicationHost.CreateApplicationHost 会抛出 System.IO.FileNotFoundException？

> ID：324091
> 
> 赞同：5
> 
> 时间：2008-11-27T15:53:42.497
> 
> 标签：c#

我看到需要让程序集可用于传递给函数的第一个参数的类型。我想是的，我无法弄清楚我错过了什么。

此代码在服务中。我在“网络服务”用户帐户下运行该服务，当我将帐户更改为我登录的会话的帐户时，它工作正常。但是，有什么区别，我怎样才能让它为 NETWORK SERVICES 用户工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-01-27T08:52:39.017

将二进制文件复制到 Web 应用程序的 bin 文件夹也可以解决此问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-03T19:51:25.933

顺便说一句，[这个](http://radio-weblogs.com/0105476/stories/2002/07/12/executingAspxPagesWithoutAWebServer.html)页面有关于这个主题的更多信息，以及解决 GAC 问题与将程序集复制到 bin 文件夹的可能方法。该页面在这一点上有几年的历史，但它似乎仍然相关。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T07:49:45.000

我也有这个问题。我认为运行时正在尝试加载包含作为第一个参数传递给 CreateApplicationHost 的类型的程序集，但找不到它

出于某种奇怪的原因，当我在我的物理目录（第三个参数）中创建一个 bin 目录时它起作用了，该目录包含它试图加载的类型的 exe 或程序集。

我不知道为什么它不首先查看工作目录...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T19:36:48.597

网络服务是一个内置帐户，对资源的访问非常有限（有充分的理由）。您可能不应该更改它，因为您会将您的网站打开到其他潜在的漏洞。

如果您必须这样做，请参阅[此处](http://msdn.microsoft.com/en-us/library/ms998320.aspx)了解如何配置它以访问其他资源。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T01:09:04.623

我认为这与网络服务帐户或代码访问安全性更密切相关，与 GAC 无关。我正在使用 CreateApplicationHost() 在 MS 测试项目中创建一个 ASP.Net 主机，它的工作原理就像一个冠军。我使用的类型不在部署到 GAC 甚至强命名的程序集中（它在 TestProject 中定义）。

你必须喜欢这些类型的不一致......它让生活变得有趣。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-08T01:23:55.053

[http://www.developer-corner.com/Blogs/tabid/117/articleType/ArticleView/articleId/78/Unit-testing-of-ASPNET-pages-Http-Handlers-and-Http-modules.aspx](http://www.developer-corner.com/Blogs/tabid/117/articleType/ArticleView/articleId/78/Unit-testing-of-ASPNET-pages-Http-Handlers-and-Http-modules.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-29T01:19:49.443

我无法让它在 Windows 2008（64 位，但我认为这不重要）上的 .NET2 中工作。当我的用户是本地管理员时它可以工作，但我不希望我的服务以提升的权限运行。我到处搜索，终于弄明白了（没有将程序集添加到 GAC，对我同样不利）：为我的自托管站点创建一个 web.config 文件，该文件设置 bin 文件夹以进行探测。在我没有 web.config 文件之前，因为我的网站都是用代码处理的。这是我的配置文件现在的样子：

```
<configuration>
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <probing privatePath="bin"/>
    </assemblyBinding>
  </runtime>
</configuration> 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-01-19T11:21:39.900

我终于找到了答案：似乎给 ApplicationHost.CreateApplicationHost() 的类型必须在位于 GAC 的程序集中。简单，愚蠢:)

# c# - 如何使用 LinqToSql 访问与外键相关的列值？

> ID：324095
> 
> 赞同：0
> 
> 时间：2008-11-27T15:54:49.983
> 
> 标签：c#, linq-to-sql

我正在尝试将 LinqToSql 连接为我的数据访问层并遇到一些问题，这可能是由于我缺乏使用 LinqToSql 的经验。

我有两张表，一张叫 Project，一张叫 Employee。该项目具有 OpenedBy 和 ClosedBy 字段，它们是对 Employee 表的外键引用，该表具有 EmployeeId 和 Name 字段。

当我获取一个项目时，我希望它获取 OpenedBy 和 ClosedBy 的 EmployeeName。我想访问这些，如下所示：

```
// assuming data is of type project

this.OpenedByName.Text = data.OpenedByName;
this.ClosedByName.Text = data.ClosedByName; 
```

是否也可以在 OpenedBy 或 ClosedBy 更改时设置这些值？这可能吗？示例代码将不胜感激！

**澄清**

我想这样做而不必使用存储过程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T16:04:21.573

如果您有 2 个来自 Employee 表的关系，我认为您将有 2 个子属性`project.Employee`， 和`project.Employee1`在每个 Project 实体中。

您可以更改关联的名称，只需转到关系属性，选择子属性，然后将每个子员工的名称更改为更具描述性。

您可以根据需要命名子属性，例如，您可以：

```
this.OpenedByName.Text = data.OpenedByEmployee.Name;
this.ClosedByName.Text = data.ClosedByEmployee.Name; 
```

# iphone - 我需要在我的数据库应用程序中唯一标识每个 iPhone 用户。什么代码可以实现这一点？

> ID：324099
> 
> 赞同：5
> 
> 时间：2008-11-27T15:55:41.603
> 
> 标签：iphone, cocoa-touch

我知道每部 iPhone 都有一个除电话号码或 ESN 之外的电子标识符 - 我如何称呼它以及它返回什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-27T16:04:22.447

UIDevice 类包含您需要的信息。

`[[UIDevice currentDevice] uniqueIdentifier]`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T16:16:21.953

如果您需要安全性，那么您可能无法使用设备的内置唯一标识符，因为很容易欺骗此信息。我只是在这里猜测，但是，从您的服务器的角度来看，很可能有一个包含手机 ID 的传入连接/请求。现在，您如何才能真正确定连接/请求实际上来自具有该 ID 的 iPhone？

一种解决方案是以安全的方式为连接到您的服务器的每个新设备颁发一个您自己的唯一 ID（即第三方无法获得该 ID）。然后，您需要使用安全协议，从而向您的服务器证明连接/请求来自知道上述 ID 的设备。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-27T16:21:00.040

如果您正在编写网络应用程序，为什么不使用标准 cookie？

# flash - 非全屏 FLV 播放

> ID：324102
> 
> 赞同：1
> 
> 时间：2008-11-27T15:58:41.833
> 
> 标签：flash, video, fullscreen, playback

我正在构建一个需要模拟 YouTube 视频的全屏演示。我拖动了一个播放外部 .flv 文件的视频。

如果舞台未设置为全屏，它可以正常工作。但我需要像这样将舞台设置为全屏：

```
stage.displayState = StageDisplayState.FULL_SCREEN;
stage.scaleMode = StageScaleMode.NO_SCALE; 
```

问题是当动画到达视频时屏幕变黑并且视频不播放。我已经设置了一个实例名称并尝试将以下代码放在框架的操作中：

```
video.fullScreenTakeOver = false; 
```

但不影响问题。

反正有没有让舞台处于全屏模式并以正常大小播放视频？

塔克斯

我正在使用 Flash CS3 Pro 并生成一个 .exe。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-12T17:32:33.273

故障似乎是由`flvPlayback`舞台上有一个组件引起的，但不是在时间轴的第一帧上。

最简单的解决方案是将组件放在第一帧上。

或者，如果这不切实际，那么简单地将组件放在影片剪辑的第一帧上似乎可行。

最后将`flvPlayback`脚本放在舞台上应该也可以。

只要记住`video.fullScreenTakeOver = false;`所有情况

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T16:27:00.480

尝试在组件的参数中将“scaleMode”参数设置为“noScale”？

# mysql - 处理大型数据库表的策略

> ID：324103
> 
> 赞同：10
> 
> 时间：2008-11-27T15:58:48.540
> 
> 标签：mysql, ruby-on-rails, ruby, database

我正在考虑构建一个 Rails 应用程序，该应用程序将有一些相当大的表，行数超过 5 亿行。为了保持快速，我目前正在研究如何将大表拆分为更易于管理的块。我看到从 MySQL 5.1 开始有一个分区选项，这是一个可能的选项，但我不喜欢确定分区的列必须是表上主键的一部分的方式。

我真正想做的是根据写入的值拆分 AR 模型写入的表，但据我所知，没有办法做到这一点 - 有没有人对我如何实现这个有任何建议或任何替代策略？

谢谢

阿尔丰

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T16:39:37.290

MySQL 中的分区列不限于主键。事实上，分区列根本不必是键（尽管会透明地为它创建一个键）。您可以按 RANGE、HASH、KEY 和 LIST 进行分区（这与 RANGE 类似，只是它是一组离散值）。阅读 MySQL 手册以了解分区类型[的概述](http://dev.mysql.com/doc/refman/5.1/en/partitioning-types.html)。

还有一些替代解决方案，例如[HScale](http://www.hscale.org/display/HSCALE/Home) - 一种基于特定标准透明地对表进行分区的中间件插件。[HiveDB](http://www.hivedb.org/)是一个用于 MySQL 水平分区的开源框架。

除了分片和分区之外，您还应该使用某种集群。最简单的设置是基于复制的设置，可帮助您将负载分散到多个物理服务器上。您还应该考虑更高级的集群解决方案，例如 MySQL 集群（由于数据库的大小，可能不是一个选项）和集群中间件，例如[Sequioa](http://community.continuent.com/community/sequoia)。

实际上，我前段时间在 stack-overflow 上问了一个关于[使用 MySQL 进行缩放](https://stackoverflow.com/questions/189903/scaling-solutions-for-mysql-replication-clustering)的相关问题，几天后我在收集了很多关于该主题的信息后回答了自己。可能也与您相关。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T18:03:28.990

如果您想按时间拆分数据，以下解决方案可能适合您的需要。您可能可以使用[MERGE](http://dev.mysql.com/doc/refman/5.0/en/merge-storage-engine.html "合并")表；

假设您的表名为 MyTable，并且您每周需要一张表

1.  您的应用程序始终登录同一个表
2.  每周作业自动重命名您的表并重新创建一个空表：MyTable 重命名为 MyTable-Year-WeekNumber，并创建一个新的空 MyTable
3.  合并表被删除并重新创建。

如果要获取过去三个月的所有数据，请创建一个合并表，其中仅包含最近 3 个月的表。根据不同时期的需要创建尽可能多的合并表。如果你*不能*包含当前插入数据的表（在我们的例子中是MyTable），你会更开心，因为你不会有任何读/写并发

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T09:34:11.987

[您可以使用DataFabric](http://github.com/fiveruns/data_fabric/tree/master)在 Active Record 中完全处理这个问题。

如果不合适的话，自己实现类似的行为并不复杂。Google sharding 对在应用层内处理表分区的架构模式进行了大量讨论。它具有避免中间件或依赖于 db vender 特定功能的优点。另一方面，您需要负责应用程序中的更多代码。

# java - 将 BLOB 存储在数据库中的最常用方法？

> ID：324104
> 
> 赞同：0
> 
> 时间：2008-11-27T15:59:03.797
> 
> 标签：java, database, groovy, blob

在编写实用程序脚本以将图像插入数据库时​​，我想知道是否有一种更规范的方法。最后解决了一些类似的问题：

```
def sql = Sql.newInstance(...)
// ...    
Connection conn = sql.getConnection()
PreparedStatement stmt.prepareStatment(...)
stmt.setBinary(...)
stmt.executeUpate() 
```

必须有一种更时髦的方法，有人可以启发我吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T18:27:19.333

A "Groovier" way could be just storing the path were you'd store the images.

Storing the images in a directory and storing just the path in the db is the best way.

# java - Hibernate：解析/翻译 HQL FROM 部分以获取对类别名、类名

> ID：324105
> 
> 赞同：3
> 
> 时间：2008-11-27T15:59:16.560
> 
> 标签：java, hibernate, hql

谁能指出我，我如何解析/评估 HQL 并获取键是表别名和值的映射 - 完全限定的类名。

例如对于 HQL

> SELECT a.id from Foo a INNER JOIN a.test b

我希望有对：

一、package1.Foo

湾。package2.TestClassName

结果集相对容易做

> ```
> HQLQueryPlan hqlPlan = ((SessionFactoryImpl)sf).getQueryPlanCache().getHQLQueryPlan( getQueryString(), false, ((SessionImpl)session).getEnabledFilters() );
> String[] aliases = hqlPlan.getReturnMetadata().getReturnAliases();
> Type[] types = hqlPlan.getReturnMetadata().getReturnTypes(); 
> ```

[在此处](http://www.hibernate.org/389.html)查看详细信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T15:04:20.573

很难做到这一点，但似乎您可以通过一些内部接口获取 AST 并遍历它：

```
QueryTranslator[] translators = hqlPlan.getTranslators();
AST ast = (AST)((QueryTranslatorImpl)translators[0]).getSqlAST();
    new NodeTraverser(new NodeTraverser.VisitationStrategy() {
    public void visit(AST node) {
        if(node.getType() == SqlTokenTypes.FROM_FRAGMENT || node.getType() == SqlTokenTypes.JOIN_FRAGMENT) {
            FromElement id = (FromElement)node;
            System.out.println(node+": "+id.getClassAlias()+" - "+id.getClassName());
        }
    }
}).traverseDepthFirst(ast); 
```

所以这似乎是从编译的查询中检索别名映射，但我会非常小心地使用这个解决方案：它将对象类型转换为通常对休眠客户端不可见的子类，并根据猜测不同节点的语义来解释 AST . 这可能不适用于所有 HQL 语句，并且在未来的休眠版本上可能不起作用或具有不同的行为。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T08:48:21.423

我为我的问题找到了正确的解决方案。除了那部分之外，您的原始帖子几乎是正确的：

```
if(node.getType() == SqlTokenTypes.FROM_FRAGMENT || node.getType() == SqlTokenTypes.JOIN_FRAGMENT) {
 FromElement id = (FromElement)node;
 System.out.println(node+": "+id.getClassAlias()+" - "+id.getClassName());
} 
```

请更正您的答案，我接受。

# open-source - 在组织中采用开源软件

> ID：324108
> 
> 赞同：5
> 
> 时间：2008-11-27T15:59:52.657
> 
> 标签：open-source, organization

为组织采用开源软件的利弊是什么？有没有人做过这件事，以及他们采用的软件的一些例子以及它是如何使用的？

通常捐款的出现是因为人们将其作为一种爱好，那么我们如何才能确保它会得到持续的支持呢？恕我直言，如果是专有软件，则对组织（金钱）有激励作用，只要软件有利可图，他们就会继续雇用人员来保持其开发。如果我错了，请纠正我。对于可能反对使用开源软件的建议的经理，我可以期待哪些论据？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-27T16:07:27.713

“开源”一词仅描述了一种许可模式。严格来说，唯一能保证你拥有的优点是许可证赋予的自由，没有你能保证拥有的缺点。

有许多开源产品也是商业化的，由公司创建、维护和支持以获取利润。还有许多开源产品由志愿者维护，但也有商业支持。例如，如果您购买 Red Hat Enterprise Linux，那么 Red Hat 将支持您使用它附带的所有产品，甚至包括由志愿者维护的产品。

至于如何确保会有持续的支持，你不能。不是开源，不是专有软件，不是任何东西。使用开源，如果社区足够大，即使当前的维护者放弃它，您也可以有理由相信社区将继续维护它（可能以新名称），并且您可以选择自己维护或雇用别人去做。自己维护它可能不是一个有吸引力的选择，但它可以在紧要关头挽救生命。

对于专有软件，如果作者决定停止维护它，那你就很不走运了。例如，考虑成千上万的 Visual Basic 6 用户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T18:19:04.920

您的评论说明了开源软件的主要优点：

> [在]专有软件的情况下，对组织（金钱）有激励，只要软件有利可图，他们就会继续雇用人员来保持开发。

问题在于，如果它不再有利可图（例如，因为代码非常稳定以至于人们购买它并继续使用它而无需升级），那么该软件的用户可能会因越来越多的运行良好的稳定产品而陷入困境古老的机器，直到有一天机器崩溃，或者必须升级到新版本的操作系统才能运行其他系统，但由于不再维护专有软件，您不得不放弃应用程序. 事实上，出售专有软件的公司倒闭并非闻所未闻。而且，如果您不能确保该软件有一个代码托管帐户来保护您免受供应商倒闭的可能性，那么您就会陷入困境。

如果代码是开源的并且你是明智的（你在获得产品时获得了源代码），那么你可以将旧产品移植到新系统中。这有多难取决于代码的性质和质量——但这是可能的。如果该软件是专有的，您可能永远无法选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T12:43:02.777

问题是：“采用开源软件”是什么意思。如果你打算用开源软件 (OSS) 从根本上交换每一个闭源软件 (CSS)，你将会失败得可怕。

我可以向您保证，您的组织已经在其 IT 基础设施的关键部分使用 OSS。

在我看来，您只需要正式确定 OSS 如何进入公司，以及公司是否（以及以何种形式）回馈 OSS。大多数公司需要关键任务软件的支持合同，并要求 OSS 需要通过提供支持的供应商购买。

在许多情况下，明确禁止回馈 OSS 项目，只有在 CTO/CIO 签署特定贡献后才允许。

只需确保您的策略足够灵活，以允许 IT 部门当前运行的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T13:54:22.570

反对开源的经理说什么并不重要。

您必须非常了解您将要使用的开源产品。
您必须确保它为公司提供正确的解决方案。您必须确信您可以在市场上找到知道或可以学习使用该产品的人。您必须了解该产品的 TCO。

然后你可以和经理争论，并给他充分的理由，公司可以从开源中受益。

请记住，最便宜的解决方案不是最佳解决方案。公司需要赚钱而不是省钱。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T15:03:45.270

取决于情况，但通常，对于一个内部的、非关键的、不需要保护系统的系统，就像企业中所做的大多数事情一样，开源就像万圣节一样，只要你真的不需要关心遵循企业政策。

对于其他大的、重要的、需要保护的项目，它真的很简单。您需要参与您使用的项目并拥有一个托管该项目的内部存储库（因此您有一个与外部分支保持同步的内部分支）。问题是这些应用程序需要很长时间才能制作，并且支持了数千年。团队往往会发生很大变化，并且有很多人参与其中。有人需要并且可以分配到存储库/构建管理。

现在，如果它只是关于经理，那么它只是关于沟通和争论。通常他们害怕支持，因为它的长期成本。他们往往喜欢听到最佳实践，告诉他们这就是大公司所做的（和例子），他们也倾向于参与项目以及他们甚至或可能找到支持的其他时间。

此外，任何承包商都会很乐意支持 OSS。谁会拒绝金钱和开发 OSS 的能力。

# php - PHP/SQL Server 报表编写

> ID：324116
> 
> 赞同：1
> 
> 时间：2008-11-27T16:02:18.753
> 
> 标签：php, sql-server, report

使用 PHP 和 SQL Server 编写报告的好方法是什么？是否有支持 SQL Server 的第三方供应商？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T16:07:30.817

自 2005 版起， SQL Server 就提供了开箱即用的[Reporting Services 。如果您使用的是 SQL Server 2000，则可以免费下载 Reporting Services 2000。](http://www.microsoft.com/sql/reporting/)Reporting Services 是基于 Web 的，因此您可以从任何地方引用的 URL 驱动它。您还可以在报告中将超链接嵌入回您的应用程序。

大多数（如果不是全部）第三方报告工具都支持 SQL Server。任何具有 ODBC 工具的东西都可以用来查询它。如果您需要在 Windows 以外的设备上运行支持报告的 Web 服务器，您可以查看其中一种开源系统，例如[Pentaho](http://www.pentaho.com/)、[BIRT](http://www.eclipse.org/birt/)或[Jasper Reports](http://www.jaspersoft.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-02T20:46:48.320

看看这个：http: [//sourceforge.net/projects/phpreportgen/](http://sourceforge.net/projects/phpreportgen/)

您必须使用 SVN 来获取代码，但它工作得非常好，并且几乎可以使用任何数据源。

# java - 在java中实现活动记录的最佳方法是什么？

> ID：324118
> 
> 赞同：2
> 
> 时间：2008-11-27T16:03:47.737
> 
> 标签：java, activerecord

我想知道`Map<String,Object>`对于普通记录的简单实现是否就足够了。

我想做类似于 Ror 的事情。当您自动将字段添加到数据库中的表时，您可以访问 Dto 中的字段。

我不想添加一个字段，然后必须将相同的字段添加到 DTO 声明中。它不干燥。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-08-02T09:33:53.620

看看这个： http: [//javalite.io/](http://javalite.io/) - 这是 Java 中 ActiveRecord 的实现

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T16:24:13.107

我认为您正在寻找一个非常轻量级的对象关系映射工具？

如果您想自己动手，那么 developerWorks 上的[这篇文章](http://www.ibm.com/developerworks/library/os-ad-gwt2/)中有一个小示例。

您可能想查看其他任何数量，但 Hibernate、JPA 和 JDO 可能是最受欢迎的。[Prevayler](http://www.prevayler.org)类型系统可能是您正在寻找的。当然，这些都可能不是您所追求的。你能再具体一点吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-19T11:27:00.057

如果**DRY**对您来说是重要的关键字，那么您应该考虑从数据库模式生成源代码（反之亦然）。在 ORM 世界中，Hibernate 提供了出色的源代码生成工具。

由于您不是在寻找 ORM 解决方案，我可以向您推荐我的数据库抽象工具 jOOQ：http: [//jooq.sourceforge.net](http://jooq.sourceforge.net)

它结合了从您的数据库模式生成的类似 ActiveRecord 的结构，以及一个查询 DSL，以便以类型安全的方式实际执行您的查询。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-02T10:02:02.567

这取决于你想要什么。

Java 是一种静态语言，因此您不能执行 RoR ActiveRecord 技巧，它将方法动态添加到类中，除非您想自己操作字节码。

这意味着您必须在 java 方法（getter/setter）和数据库表之间的某处声明映射。

您可以基于表生成 java 类的代码，也许这就是您想要的？

# python - 在同一个表达式中拆分两次？

> ID：324132
> 
> 赞同：5
> 
> 时间：2008-11-27T16:12:04.457
> 
> 标签：python

想象一下，我有以下内容：

```
inFile = "/adda/adas/sdas/hello.txt"

# that instruction give me hello.txt
Name = inFile.name.split("/") [-1]

# that one give me the name I want - just hello
Name1 = Name.split(".") [0] 
```

有没有机会简化只用一个表达式做同样的工作？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-27T16:16:23.047

[您可以通过使用os.path.basename](http://docs.python.org/library/os.path.html#os.path.basename)来获取路径的最后一部分，然后使用[os.path.splitext](http://docs.python.org/library/os.path.html#os.path.splitext)来获取不带扩展名的文件名，从而独立地获取您想要的平台。

```
from os.path import basename, splitext

pathname = "/adda/adas/sdas/hello.txt"
name, extension = splitext(basename(pathname))
print name # --> "hello" 
```

使用[os.path.basename](http://docs.python.org/library/os.path.html#os.path.basename)和[os.path.splitext而不是 str.split，或者 re.split 更合适（因此获得的分数比任何其他答案都多），因为它不会在](http://docs.python.org/library/os.path.html#os.path.splitext)[使用不同路径分隔符](http://en.wikipedia.org/wiki/Path_(computing)#Representations_of_paths_by_operating_system_and_shell)的其他平台上崩溃[（你会惊讶于它的多样性）](http://en.wikipedia.org/wiki/Path_(computing)#Representations_of_paths_by_operating_system_and_shell)。

它还带有最多分，因为它准确地回答了您对“一条线”的问题，并且在美学上比您的示例更令人愉悦（尽管这与所有品味问题一样值得商榷）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T21:35:48.547

回答主题中的问题，而不是尝试分析示例...

如果您想分割路径，您真的想使用[Florians解决方案，但如果您承诺不使用它进行路径解析......](https://stackoverflow.com/questions/324132/split-twice-in-the-same-expression#324141)

您可以使用[re.split()](https://docs.python.org/library/re.html#module-contents)使用多个分隔符进行拆分，方法是使用“|”或：使用“|”对它们进行拆分，看看这个：

```
import re
inFile = "/adda/adas/sdas/hello.txt"
print re.split('\.|/', inFile)[-2] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T16:16:15.213

```
>>> inFile = "/adda/adas/sdas/hello.txt"
>>> inFile.split('/')[-1]
'hello.txt'
>>> inFile.split('/')[-1].split('.')[0]
'hello' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T16:30:01.973

如果它总是像上面那样的路径，你可以使用 os.path.split 和 os.path.splitext

以下示例将仅打印 hello

```
from os.path import split, splitext
path = "/adda/adas/sdas/hello.txt"
print splitext(split(path)[1])[0] 
```

有关更多信息，请参阅[https://docs.python.org/library/os.path.html](https://docs.python.org/library/os.path.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T16:28:50.850

我很确定一些 Regex-Ninja*，会给你一种或多或少理智的方式来做到这一点（或者我现在看到其他人已经发布：在一行上写两个表达式的方法......）

但我想知道为什么你只想用一个表达式来拆分它？对于这样一个简单的拆分，做两个可能比创建一些高级的非此即彼的逻辑更快。如果你分裂两次它也更安全：

我猜你想分开路径，文件名和文件扩展名，如果你首先在'/'上分割你知道文件名应该在最后一个数组索引中，那么你可以尝试只分割最后一个索引，看看是否你可以找到文件扩展名或没有。那么你不需要关心路径名中是否有点。

*（任何*理智*的正则表达式用户都不应被冒犯。;）

# 64-bit - autotools可以创建多平台makefile吗

> ID：324134
> 
> 赞同：2
> 
> 时间：2008-11-27T16:12:33.990
> 
> 标签：64-bit, makefile, 32-bit, autotools, multiplatform

我有一个我已经开发了几年的插件项目，该插件可与 [主要应用程序版本、第 3 方库版本、32 位与 64 位] 的多种组合一起使用。是否有一种（干净的）方法可以使用 autotools 创建一个构建所有版本插件的 makefile。

据我通过浏览 autotools 文档可以看出，与我想要的最接近的是拥有 N 个独立的项目副本，每个副本都有自己的 makefile。这对于测试和开发来说似乎有点不太理想，因为 (a) 我需要在所有不同的副本中不断传播代码更​​改，并且 (b) 多次复制项目会浪费很多空间。有没有更好的办法？

**编辑：**

一段时间以来，我一直在推出自己的解决方案，我有一个花哨的 makefile 和一些 perl 脚本来寻找各种 3rd 方库版本等。因此，我对其他非 autotools 解决方案持开放态度。对于其他构建工具，我希望它们对最终用户来说非常容易安装。这些工具还需要足够聪明，以便在没有大量麻烦的情况下搜索各种 3rd 方库和标头。我主要是在寻找一个 linux 解决方案，但一个也适用于 Windows 和/或 Mac 的解决方案将是一个奖励。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-27T17:59:52.307

如果您的问题是：

> 我可以在某台机器 A 上使用自动工具来创建一个可以在所有其他机器上运行的通用 makefile 吗？

那么答案是“不”。自动工具甚至不会假装尝试这样做。它们旨在包含可移植代码，这些代码将确定如何在目标机器上创建一个可行的 makefile。

如果您的问题是：

> 我可以使用自动工具来配置需要在不同机器上运行的软件，使用我的插件使用的不同版本的主要软件，以及各种 3rd 方库，更不用说 32 位与 64 位问题了吗？

那么答案是“是”。自动工具旨在能够做到这一点。此外，它们适用于 Unix、Linux、MacOS X、BSD。

我有一个程序 SQLCMD（它比 Microsoft 的同名程序早了十年甚至更多），它与 IBM Informix 数据库一起工作。它检测安装的客户端软件（称为 IBM Informix ESQL/C，IBM Informix ClientSDK 或 CSDK 的一部分）的版本，以及它是 32 位还是 64 位。它还检测安装了哪个版本的软件，并根据支持产品中的可用功能调整其功能。它支持已经发布了大约 17 年的版本。它是自动配置的——我必须为 Informix 功能和其他几个小玩意（高分辨率时序、/dev/stdin 的存在等）编写一些 autoconf 宏。但这是可行的。

另一方面，我不会尝试发布适合所有客户机器和环境的单个 makefile。有太多的可能性是明智的。但是 autotools 会为我（和我的用户）处理细节。他们所做的只是：

```
./configure 
```

这比弄清楚如何编辑 makefile 更容易。（哦，在最初的 10 年里，程序是手动配置的。尽管我设置了很好的默认设置，但人们很难做到。这就是我转向自动配置的原因：它使人安装。）

* * *

福兹先生评论说：

> 我想要介于两者之间的东西。在我的情况下，客户将在同一台机器上使用相同基础应用程序的多个版本和位数。我不担心交叉编译，例如在 Linux 上构建 Windows 二进制文件。

您是否需要为 32 位和 64 位版本单独构建插件？（我认为是的 - 但你可能会让我感到惊讶。）所以你需要提供一种机制让用户说

```
./configure --use-tppkg=/opt/tp/pkg32-1.0.3 
```

（其中 tppkg 是您的第三方包的代码，位置由用户指定。）但是，请记住可用性：用户*必须*提供的此类选项越少越好；对此，不要硬编码应该是可选的东西，例如安装位置。一定要查看默认位置 - 这很好。并且默认为您找到的东西的琐碎。也许如果您同时找到 32 位和 64 位版本，那么您应该同时构建这两个版本——不过，这需要仔细构建。您可以随时回显“正在检查 TP-Package ...”并指出您找到的内容和找到的位置。然后安装程序可以更改选项。确保在“ `./configure --help`”中记录选项是什么；这是标准的自动工具实践。

但是不要做任何交互式的事情；配置脚本应该运行，报告它做了什么。Perl`Configure`脚本（注意大写字母 - 它是一个完全独立的自动配置系统）是剩下的少数密集交互配置系统之一（这可能主要是因为它的传统；如果重新开始，它很可能是非交互的）。与非交互式系统相比，此类系统的配置更令人讨厌。

交叉编译很困难。我从来不需要这样做，谢天谢地。

* * *

福兹先生还评论说：

> 感谢您的额外评论。我正在寻找类似的东西：

```
./configure --use-tppkg=/opt/tp/pkg32-1.0.3 --use-tppkg=/opt/tp/pkg64-1.1.2 
```

> 它将在当前平台的一个 makefile 中创建 32 位和 64 位目标。

好吧，我确信可以做到；与两个单独的配置运行并在两者之间进行完全重建相比，我不太确定这样做是否值得。您可能想要使用：

```
./configure --use-tppkg32=/opt/tp/pkg32-1.0.3 --use-tppkg64=/opt/tp/pkg64-1.1.2 
```

这表示两个单独的目录。您必须决定如何进行构建，但大概您有两个子目录，例如 ' `obj-32`' 和 ' `obj-64`' 用于存储单独的目标文件集。您还可以按照以下方式安排您的 makefile：

```
FLAGS_32 = ...32-bit compiler options...
FLAGS_64 = ...64-bit compiler options...

TPPKG32DIR = @TPPKG32DIR@
TPPKG64DIR = @TPPKG64DIR@

OBJ32DIR = obj-32
OBJ64DIR = obj-64

BUILD_32 = @BUILD_32@
BUILD_64 = @BUILD_64@

TPPKGDIR =
OBJDIR   =
FLAGS    =

all:    ${BUILD_32} ${BUILD_64}

build_32:
    ${MAKE} TPPKGDIR=${TPPKG32DIR} OBJDIR=${OBJ32DIR} FLAGS=${FLAGS_32} build

build_64:
    ${MAKE} TPPKGDIR=${TPPKG64DIR} OBJDIR=${OBJ64DIR} FLAGS=${FLAGS_64} build

build:  ${OBJDIR}/plugin.so 
```

这假定插件将是一个共享对象。这里的想法是自动工具将检测第三方软件包的 32 位或 64 位安装，然后进行替换。如果需要 32 位包，则 BUILD_32 宏将设置为 build_32，否则留空；BUILD_64 宏将被类似处理。

当用户运行 ' `make all`' 时，它将首先构建 build_32 目标，然后构建 build_64 目标。要构建 build_32 目标，它将重新运行`make`并配置 32 位构建的标志。同样，要构建 build_64 目标，它将重新运行`make`并配置 64 位构建的标志。重要的是，所有受 32 位与 64 位构建影响的标志都在递归调用时设置`make`，并且构建对象和库的规则要仔细编写 - 例如，将源编译为对象的规则必须是小心地将目标文件放在正确的目标目录中 - 例如，使用 GCC，您将指定（在`.c.o`规则中）：

```
${CC} ${CFLAGS} -o ${OBJDIR}/$*.o -c $*.c 
```

宏 CFLAGS 将包含处理位的 ${FLAGS} 值（例如，`FLAGS_32 = -m32`FLAGS_64 = -m64 `, and so when building the 32-bit version,`FLAGS = -m32 `would be included in the`CFLAGS` 宏。

自动工具中的剩余问题是如何确定 32 位和 64 位标志。如果最坏的情况发生在最坏的情况下，您将不得不自己为此编写宏。但是，我希望（没有研究过）您可以使用 autotools 套件中的标准工具来完成它。

除非您仔细（甚至无情地）为自己创建一个对称的 makefile，否则它不会可靠地工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-27T16:17:34.727

据我所知，你不能这样做。但是，您是否坚持使用自动工具？[CMake](http://www.cmake.org/)和[SCons](http://www.scons.org/)都不是一个选项吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T16:25:29.890

我们试过了，它不起作用！所以我们现在使用[SCons](http://www.scons.org/)。

该主题的一些文章：[1](http://freshmeat.net/articles/view/1702/)和[2](http://freshmeat.net/articles/view/2799/)

**编辑：** 我喜欢 SCons 的一些小例子：

```
env.ParseConfig('pkg-config --cflags --libs glib-2.0') 
```

使用这行代码，您可以将 GLib 添加到编译环境 ( *env* )。不要忘记学习 SCons 的[用户指南](http://www.scons.org/doc/1.1.0/HTML/scons-user/book1.html)（你真的不必了解 Python！）。对于最终用户，您可以使用[PyInstaller](http://pyinstaller.python-hosting.com/wiki)或类似的东西尝试 SCons。

和相比`make`，你使用 Python，所以是一门完整的编程语言！考虑到这一点，您可以做任何事情（或多或少）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-10T17:35:57.780

您是否考虑过使用具有多个构建目录的单个项目？如果您的 automake 项目以正确的方式实现（即：不像 gcc）

以下是可能的：

```
mkdir build1 build2 build3
cd build1
../configure $(YOUR_OPTIONS)
cd build2
../configure $(YOUR_OPTIONS2)
[...] 
```

您可以传递不同的配置参数，例如包含目录和编译器（即交叉编译器）。

然后，您甚至可以通过运行在单个 make 调用中运行它

```
make -C build1 -C build2 -C build3 
```

# wpf - 具有混合纵横比的 WPF VisualBrush

> ID：324146
> 
> 赞同：4
> 
> 时间：2008-11-27T16:20:16.890
> 
> 标签：wpf, diagramming, visualbrush

我们正在使用 Mindfusion WPF 图表组件。我需要一个 Visualbrush，它必须能够在第三方组件中用于图表。

我们在图表画布上有水平延伸的车道。我们必须为该车道定义背景颜色，并在左上角定义一些文本，以便在 x 轴上重复。当车道重新调整大小时，文本必须保持相同大小，而车道的其余部分用颜色填充。

不幸的是，我们唯一能做的就是为图表组件提供一个 Visualbrush，然后将其设置为车道的背景。似乎无法使用此限制，因为我无法定义具有固定大小的文本，在 x 轴上重复，同时还具有颜色画笔拉伸，所有这些都在单个 Visualbrush 中。如何才能做到这一点？

# asp.net-mvc - 条件属性 - Asp.Net MVC 视图

> ID：324161
> 
> 赞同：1
> 
> 时间：2008-11-27T16:26:28.673
> 
> 标签：asp.net-mvc

我需要将条件禁用和类属性添加到下拉表单元素。我有以下内容，但是它不会在任何状态下写出任何一个属性。有没有解决的办法。

```
<%=  Html.DropDownList("--Choose Make--", "models", ViewData["model_disabled"] == "false" ? new { @disabled = "disabled", @class = "test" } : null)%> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T19:40:54.600

问题是：

```
ViewData["model_disabled"] == "false" 
```

ViewData[] 的返回是对象。用两个对象调用 == 会比较它们的身份（即它们是否完全相同的对象实例），而不是它们的相等性（即字符串是否具有相同的值）。

你可以试试这个：

```
((string)ViewData["model_disabled"]) == "false" 
```

**编辑：**

[MvcContrib](http://www.codeplex.com/MvcContrib) ViewData 扩展提供了一种更简洁的语法：

```
ViewData.Get<string>("model_disabled") == "false" 
```

虽然这感觉更干净一些，但您也会注意到它稍长一些。:-p

# sql - 我们应该在数据库表命名约定中使用前缀吗？

> ID：324163
> 
> 赞同：12
> 
> 时间：2008-11-27T16:26:50.420
> 
> 标签：sql, database, naming-conventions

我们正在工作中的开发团队决定表、列、过程等的命名约定。表的单复数命名*已经确定*，我们使用单数。我们正在讨论是否为每个表名使用前缀。我想阅读有关是否使用前缀的建议，以及为什么。

它是否提供了任何安全性（对于可能的入侵者来说至少又多了一个障碍）？我认为用前缀命名它们通常更舒服，以防我们在代码中使用表的名称，所以不要将它们与变量、属性等混淆。但我想阅读更有经验的开发人员的意见。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-27T17:09:37.040

我发现匈牙利 DB 对象前缀来指示它们的类型相当烦人。

我曾在每个表名都必须以“tbl”开头的地方工作过。在每种情况下，当有人需要进行其他微小的更改时，命名约定最终都会造成很大的痛苦。

例如，如果您的约定是表格以“tbl”开头，视图以“v”开头，那么当您决定在后端用其他东西替换表格并提供视图以实现兼容性或甚至作为首选接口？我们最终得到了以“tbl”开头的视图。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-27T16:32:26.070

我更喜欢使用应用程序或解决方案的短名称为表和其他数据库对象添加前缀。

这有助于我想到两种可能的情况：

1.  如果您选择使用任何需要应用程序数据库中的表的第三方框架组件（例如，asp 网络成员资格提供程序），您就不太可能发生命名冲突。

2.  如果您正在为客户开发解决方案，他们可能仅限于单个数据库（特别是如果他们为外部托管付费），需要他们将多个应用程序的数据库对象存储在单个数据库中。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-27T16:59:05.533

我看不出任何命名约定如何提高安全性......

如果入侵者有权访问数据库（具有有害权限），他们肯定有权列出表名并选择查看它们的用途。

但我认为真正令人困惑的表名可能会间接恶化安全性。这将使进一步的开发变得困难，从而减少安全问题得到修复的机会，甚至可能隐藏潜在问题：

如果一个名为（例如）'sro235onsg43oij5' 的表充满了带有随机字符串和数字的随机命名的列，新开发人员可能只会认为它是随机测试数据（除非他触及与之交互的代码），但如果它被命名'userpasswords' 或类似的任何查看表格的开发人员可能会对密码以明文形式存储感到震惊。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-04T21:04:53.210

为什么不根据您制定的编码指南命名表格？将表名视为“类”，将列视为“属性”或“字段”。这有助于使用可以从类/成员命名自动推断表/列命名的 ORM。

例如，如下声明的[Castle ActiveRecord](http://www.castleproject.org/activerecord/index.html)[假定名称与](http://www.castleproject.org/activerecord/documentation/trunk/usersguide/class.html)它们所在的成员相同。

```
[ActiveRecord]
public class Person
{
    [PrimaryKey]
    public Int32 Id { get; set; }

    [Property]
    public String Name { get; set; }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-27T16:35:49.090

如果您使用 SqlServer，最好的开始是查看提供的示例数据库以获得一些指导。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-09-17T15:56:53.990

过去，我一直反对在表名和列名中使用前缀。然而，当面临重新设计系统的任务时，具有前缀对于进行搜索和替换是非常宝贵的。例如，对“tbl_product”的 grepping 可能会比对“product”的 grepping 提供更多相关的结果。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-11-27T16:36:44.503

如果您担心混淆表名，请在代码中使用匈牙利符号样式系统。也许“s”代表字符串+“tn”代表表名：

```
 stnUsers = 'users';
 stnPosts = 'posts'; 
```

当然，前缀取决于您，这取决于您喜欢代码的详细程度......`strtblUsers, strtblnmeUsers, thisisthenameofatableyouguysUsers...`

将前缀附加到表名确实有一些好处，特别是如果您不将该前缀硬编码到系统中，并允许它在每次安装时更改。第一，正如 Ian 所说，您与其他组件发生冲突的风险较小，第二，如果您愿意，您可以让程序的两个或多个实例在同一个数据库上运行。

# .net - 如何在 .NET 中独立更改字体的宽度和高度？

> ID：324166
> 
> 赞同：2
> 
> 时间：2008-11-27T16:27:37.280
> 
> 标签：.net, fonts

鉴于这样的事情：

`thefont = New Font("Courier New", fontheight)`

和这个：

`' g is a Graphics object`

`g.DrawString("some text", thefont, Brushes.Black, X, Y)`

我可以在两者中间放置什么来更改字体的宽度，以便“某些文本”水平扩展或压缩但高度保持不变？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T20:15:46.993

您可以使用比例变换来做到这一点，如下所示：

```
 Matrix m = new Matrix();
        m.Scale(3, 1);
        g.Transform = m;
        g.DrawString("Some text", this.Font, Brushes.Black, new PointF(10, 10));
        g.ResetTransform(); 
```

# bash - 从 bash 变量中删除空格

> ID：324167
> 
> 赞同：8
> 
> 时间：2008-11-27T16:27:48.763
> 
> 标签：bash

假设一个变量包含空格、换行符和制表符，后跟一些文本，为什么会这样：

```
${var#"${var%%[![:space:]]*}"}  # strip var of everything 
                                # but whitespace
                                # then remove what's left 
                                # (i.e. the whitespace) from var 
```

删除空白并留下文本，但是：

```
${var##[:space:]*}  # strip all whitespace from var 
```

才不是？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-27T16:51:06.203

如果我设置`var=" This is a test "`了，您的两个建议都不起作用；只是主要的东西被删除了。为什么不使用删除所有出现的空格而不仅仅是第一个空格的替换功能：

```
 ${var//[[:space:]]} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-27T16:49:12.120

[:space:] 是一个字符类。仅当它嵌套在另一组 [ ] 中时才有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-02T16:38:57.510

flolo 的答案记录在 bash 手册页的“参数替换”部分。另一个文档来源是[Advanced Bash-Scripting Guide的](http://tldp.org/LDP/abs/html/)[Parameter Substitution](http://tldp.org/LDP/abs/html/parameter-substitution.html)部分。ABS 指南包括带有优秀示例代码的基本文档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-06T10:04:08.257

$(echo $var) 怎么样

```
> a="   123 456  " ; a2="$(echo $a)" ; echo "a=\"${a}\" a2=\"${a2}\""
a="   123 456  " a2="123 456" 
```

# c++ - MSXML2::IXMLDOMDocument2Ptr->GetXML() 弄乱了我的字符串！

> ID：324168
> 
> 赞同：2
> 
> 时间：2008-11-27T16:28:01.430
> 
> 标签：c++, msxml

全部，

这是我的代码

```
//declare string pointer
BSTR markup;

//initialize markup to some well formed XML <-

//declare and initialize XML Document
MSXML2::IXMLDOMDocument2Ptr pXMLDoc;
HRESULT hr;
hr = pXMLDoc.CreateInstance(__uuidof(MSXML2::DOMDocument40));
pXMLDoc->async = VARIANT_FALSE;
pXMLDoc->validateOnParse = VARIANT_TRUE;
pXMLDoc->preserveWhiteSpace = VARIANT_TRUE;    

//load markup into XML document
vtBoolResult = pXMLDoc->loadXML(markup);

//do some changes to the XML file<-

//get back string from XML doc
markup = pXMLDoc->Getxml(); //<-- this retrieves RUBBISH 
```

在这一点上，我的字符串被破坏了（开始时只有几个汉字，然后是垃圾）。看起来像一个编码问题。

我还尝试了以下方法：

```
_bstr_t superMarkup = _bstr_t(markup);

//did my stuff

superMarkup = pXMLDoc->Getxml();

markup = superMarkup; 
```

但我仍然得到相同的结果。

即使我调用 GetXML() 而不更改 xml 文档中的任何内容，我仍然会得到垃圾。

此时，如果我尝试将损坏的指针分配给另一个指针，它将引发错误：

> 试图恢复写保护内存。这通常表明其他内存已损坏。

有什么建议吗？

编辑1：

**我发现这与 XML 字符串的大小有关。如果它发生在给定的 XML 字符串上并且我减小了大小（保持相同的模式），它将正常工作。看起来 MSXML2::DOMDocument40 对大小有限制？详细来说，如果我有超过 16407 个字符，就会发生这种情况。我还有一个 GetXML 将检索 RUBBISH - 如果它 <= 16407 一切正常。**

编辑2：

**罗迪是对的 - 我错过了那`_bstr_t`是一门课......**

敲响任何铃铛？

干杯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-27T17:46:54.297

尝试更换

```
 BSTR Markup; 
```

和

```
 bstr_t Markup; 
```

BSTR 几乎是一个愚蠢的指针，我认为 GetXML() 的返回结果被转换为一个临时的，然后在你看到它时被销毁。bstr_t 用一些智能指针的优点包装了它......

注意：您的“SuperMarkup”事情没有按照我的建议进行。同样， **BSTR 只是一个指针**，并不“拥有”它所指向的内容。另一方面，bstr_t 确实如此。我认为您的 GetXML() 函数正在返回一个 bstr_t，然后在超出范围时将其删除，使您的 BSTR 指向不再有效的内存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T18:54:00.777

好吧，我认为帕特里克是对的。我使用了您的代码并制作了一个名为 getxmltest 的快速 ATL EXE 项目。我在#include 指令之后添加了这一行

```
#import "MSXML3.DLL" 
```

删除了注册组件的构建后事件，因为我不想从 exe 公开任何组件，但只引用了所有 ATL 头文件和库，并将以下代码添加到 _tWinMain

```
extern "C" int WINAPI _tWinMain(HINSTANCE /*hInstance*/, HINSTANCE /*hPrevInstance*/, 
                                LPTSTR /*lpCmdLine*/, int nShowCmd)
{
    CoInitialize(NULL);
    {
        //declare string pointer
        _bstr_t                     markup;
        //initialize markup to some well formed XML <-
        //declare and initialize XML Document
        MSXML2::IXMLDOMDocument2Ptr pXMLDoc;
        HRESULT                     hr              = pXMLDoc.CreateInstance(__uuidof(MSXML2::DOMDocument));

        pXMLDoc->async              = VARIANT_FALSE;
        pXMLDoc->validateOnParse    = VARIANT_TRUE;
        pXMLDoc->preserveWhiteSpace = VARIANT_TRUE;    

        //load markup into XML document
        VARIANT_BOOL                vtBoolResult    = pXMLDoc->loadXML(L"<XML></XML>");

        //do some changes to the XML file<-
        //get back string from XML doc
        markup = pXMLDoc->Getxml(); //<-- this retrieves RUBBISH (not anymore...)
        ATLTRACE("%S", (BSTR)markup.GetBSTR());
    }
    CoUninitialize();
    return _AtlModule.WinMain(nShowCmd);
} 
```

生成的跟踪线如下...

```
'getxmltest.exe': Loaded 'C:\Windows\winsxs\x86_microsoft.windows.common-controls_6595b64144ccf1df_6.0.6001.18000_none_5cdbaa5a083979cc\comctl32.dll'
<XML></XML>
'getxmltest.exe': Unloaded 'C:\Windows\SysWOW64\msxml3.dll'
The program '[6040] getxmltest.exe: Native' has exited with code 0 (0x0). 
```

我们可以在哪里看到我们最初输入的字符串。我没有在代码中添加任何逻辑，因为我虽然这足以在使用 MSXML 引擎处理它之后显示生成的 xml。显然，您可以使用此代码进行更多测试，看看接下来会发生什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T20:21:25.233

但是，我不精通这个*特定*的xml 库：

这里需要注意的是原始问题在检索结果时覆盖了变量“标记”。许多 XML 解析器返回指向初始输入（即标记）的指针，因此当您用输出替换它时，您也删除了 XML 解析器的输入。

此过程似乎可能会使您刚刚收到的字符串无效。您会注意到 Eugenio Miró 在他的示例中没有犯这个错误，因为他分配了一个不同的变量来保存输入 (pXMLDoc)。

你可能想做的一个快速测试是改变

```
//get back string from XML doc
markup = pXMLDoc->Getxml(); //<-- this retrieves RUBBISH 
```

到

```
//get back string from XML doc
BSTR output = pXMLDoc->Getxml(); //<-- perhaps this doesn't 
```

看看这是否有所作为。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T13:52:20.087

这是我之前编写的代码，稍加修改，添加了 20000 个“子”元素:)，效果很好。

```
extern "C" int WINAPI _tWinMain(HINSTANCE /*hInstance*/, HINSTANCE /*hPrevInstance*/, 
                                LPTSTR /*lpCmdLine*/, int nShowCmd)
{
    CoInitialize(NULL);
    {
        //declare string pointer
        _bstr_t                           markup;
        //initialize markup to some well formed XML <-
        //declare and initialize XML Document
        try {
            MSXML2::IXMLDOMDocument2Ptr   pXMLDoc;
            HRESULT                       hr              = pXMLDoc.CreateInstance(__uuidof(MSXML2::DOMDocument));    
            pXMLDoc->async                = VARIANT_FALSE;
            pXMLDoc->validateOnParse      = VARIANT_TRUE;
            pXMLDoc->preserveWhiteSpace   = VARIANT_TRUE;    

            //load markup into XML document
            VARIANT_BOOL                  vtBoolResult    = pXMLDoc->loadXML(L"<XML></XML>");

            for (int i = 0; i < 20000; i++) {
                MSXML2::IXMLDOMNodePtr    node            = pXMLDoc->createNode(_variant_t("element"), _bstr_t("child"), _bstr_t(""));

                if (node)
                    pXMLDoc->documentElement->appendChild(node);
            }

            //do some changes to the XML file<-
            //get back string from XML doc
            markup = pXMLDoc->Getxml(); //<-- th
            ATLTRACE("XML lenght = %d, xml=%S\n", markup.length(), (BSTR)markup.GetBSTR());
        } catch(_com_error e) {
            ATLTRACE("error = %S\n", (BSTR)e.ErrorMessage());
        }
    }
    CoUninitialize();
    return _AtlModule.WinMain(nShowCmd);
} 
```

这会在调试器中产生一个 1024 输出行，但如果您愿意，这可以轻松地将 xml 打印到 stdoutput。这是我到目前为止得到的输出

```
'getxmltest.exe': Loaded 'C:\Windows\winsxs\x86_microsoft.windows.common-controls_6595b64144ccf1df_6.0.6001.18000_none_5cdbaa5a083979cc\comctl32.dll'
XML lenght = 160013, xml=<XML><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><child/><'getxmltest.exe': Unloaded 'C:\Windows\SysWOW64\msxml3.dll'
The program '[4884] getxmltest.exe: Native' has exited with code 0 (0x0). 
```

# asp.net-ajax - 如何将服务器端错误消息传递给 ASP.NET Ajax 客户端？

> ID：324170
> 
> 赞同：2
> 
> 时间：2008-11-27T16:28:10.667
> 
> 标签：asp.net-ajax, telerik

一个示例场景：

1.  用户执行更新，例如拖放。这是一个 ajax 请求。
2.  服务器端代码无法验证更新或操作失败。抛出异常。
3.  应向用户显示合理的错误消息。

我应该如何将异常传达给客户端并在 div 消息框中显示错误消息？

该消息应在**事后**显示。有时可以防止客户端代码中的错误，但我并不担心这一点。

使用文件隐藏代码中的传统数据绑定，我可以在错误条件后显示标签。但是，如果 Ajax 控件连接到在 aspx 中指定的提供程序类，我看不出这怎么可能。我能想到的唯一选择是在客户端代码中捕获服务器端异常。这可能吗？

我正在为 ASP.NET Ajax 使用 Telerik RadControls。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-01-08T13:22:17.400

您可以尝试直接在 Ajax 框架中添加错误处理程序，如下所示：

~~[http://encosia.com/how-to-improve-aspnet-ajax-error-handling/](http://encosia.com/how-to-improve-aspnet-ajax-error-handling/)~~

# macos - 在 OS X 上挂载一个 windows smb 共享，以便“www”用户可以访问它

> ID：324171
> 
> 赞同：2
> 
> 时间：2008-11-27T16:28:42.177
> 
> 标签：macos, mount, smb

试图在 OS X 上挂载 smb 共享，以便“www”用户可以从那里读取文件。

SMB 共享可通过 Active Directory 帐户访问。我可以通过 Finder 挂载共享（cmd-k ...）

我的基本方法是

```
# 1) create mountpoint 
sudo mkdir /Volumes/www_mdisk

# 2) permissions for mountpoint
sudo chown www:www /Volumes/www_mdisk; sudo chmod 777 /Volumes/www_mdisk

# 3) make a link from apache docroot to mountpoint (http.conf FollowSymlinks is on)
cd /Library/WebServer/Documents; ln -s /Volumes/www_mdisk mdisk

# 4) mount the SMB share using the Active Directory user 'ad_user'
sudo mount_smbfs -O www/www '//DOMAIN;ad_user@smbshare_host/sharepath' 
```

第 4 步失败了。我已经阅读了手册页，尝试了许多不同的组合（有或没有 -O 开关），但无法让它工作

你能帮我做对吗？谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-10-04T00:52:33.960

抱歉，这个答案迟了两年，但我遇到了类似的问题，并且或多或少地能够使用您的步骤解决它。我按照步骤 1-3，然后在步骤 4 中，我 sudo'd 为 _www 而不是使用 -O 选项（因为它不再存在。）

```
sudo -u _www mount_smbfs //User:Password@Host/Share /mount/point 
```

我正在运行 10.6 Snow Leopard，而 Apache 用户似乎是 _www。无论如何，在解决这个问题一段时间后（因为 chown 和 chmod 似乎不适用于安装的 Samba 共享），这终于奏效了。谢谢！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T10:04:33.653

好的，我现在可以在 Mac OS X 10.4 上执行此操作

```
# 4) mount the SMB share using the Active Directory user 'ad_user'
sudo mount_smbfs -O www/www -u 70 -g 70 '//DOMAIN;ad_user@smbshare_host/sharepath' www_mdisk

# 5) make sure http.conf has 'Options Indexes' enabled for Docroot
duh. 
```

因此，按照上述步骤，现在一切都可以在 10.4 上运行。

问题是，步骤 4) 在 Mac OS X 10.5 上不起作用。mount_smbfs 丢失了“-O”选项...

有人知道如何在 10.5 上执行此操作吗？

# database - 查询与查看

> ID：324177
> 
> 赞同：7
> 
> 时间：2008-11-27T16:30:12.847
> 
> 标签：database, database-design

我想知道查询和视图在性能方面有什么区别。如果视图成本很高，除了查询我还能做些什么来提高性能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-01T19:43:04.423

我不能代表所有数据库，但在 SQL Server 中，除非您拥有 Enterprise 版本，否则您无法索引视图。未索引的视图在性能方面可能比查询差得多，尤其是当您针对它编写查询以添加一些 where 条件时。索引视图通常可以表现得相当好。索引视图还可以针对不同表中的多个字段，这可能会提高临时查询的性能。（可能不会，在性能调整中，您必须始终针对您的特定情况进行测试。）

反对意见的一点是，它们不允许运行时选择 where 标准。因此，您通常会同时获得视图和查询。

视图可以更容易地维护（只需在连接中添加新表，访问财务报告的所有内容都可用），但它们更难以进行性能调整。这部分是因为它们倾向于过度概括，因此比只返回必要的最小值的对应物慢。是的，正如乔纳森所说，您很容易将报告的视图合并成一个混乱，它比需要多次加入同一个大表，而且速度非常慢。

观点闪耀的两个地方是： 确保始终正确描述复杂的关系。这就是为什么报告作者倾向于偏爱他们的原因之一。限制对记录子集的访问

对于视图、即席查询或存储过程，可以执行的查询类型也有限制。例如，您不能使用 if 语句（或其他过程类型代码，例如循环），或者如上所述，您不能为 where 条件提供运行时值。

视图通常明显变慢的一个地方是当它们调用其他视图时。底层视图需要在某些数据库中完全实现，因此您可能需要调用 4,459,203 条记录才能看到您最终感兴趣的 10 条记录。开始多次分层，它会变得非常慢，非常快；调用视图的视图只是一种糟糕的做法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T16:54:20.753

在 SQL Server 中，我相信视图和查询之间的性能差异可以忽略不计。我建议提高性能的方法是创建另一个保存视图结果的表。您也许可以创建一个暂存表来保存新数据，然后可以在某个时间间隔运行一个存储过程，用新信息填充工作表。触发器可能适用于此目的。根据您的应用程序的要求，此设计可能合适，也可能不合适。如果您正在处理近乎实时的数据，这种方法将导致并发问题......

要研究的另一件事是绝对确保您用于构建视图的基表已正确索引，并且查询本身已优化。最后，我相信在 SQL Server 企业中创建索引视图是可能的，尽管我以前没有使用过它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T16:46:17.883

如果它们执行完全相同的操作，则视图在第一次执行时可能会稍微快一些，因为数据库服务器将为其预编译执行计划。不过取决于你的服务器。

强调力量和轻微...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T16:54:01.923

视图促进了代码重用，并且可以抽象出数据库的复杂性，以提供更连贯的“业务”数据模型。然而，它们几乎没有那么可调。您可能会发现自己处于需要提供连接提示或其他低级优化的位置，而我合作过的许多 DBA 不喜欢将它们应用于视图，因为它们可能会在许多查询中重复使用，意见是这些应尽可能少地使用提示类型。我喜欢自己使用视图。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-27T16:54:10.737

在简单的情况下，视图和即席查询在性能方面几乎相同。如此之多，以至于当您使用视图进行编程时，您应该将其视为视图定义的文本被剪切并粘贴到您的父查询中。

HLGEM 在他的回答中指出，某些版本的 SQL Server 允许您“索引”视图——在这种情况下，SQL Server 在幕后维护着与表相同的结构，使得索引视图和表在术语上非常相似的表现。

在 SQL Server 中，尽管您通常可以相当自由地嵌套视图而不会遇到性能问题，但这会使事情变得更难理解和调试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-27T17:35:32.107

对计算机而言，视图几乎不比直接写出查询更昂贵。视图可以为程序员/用户节省大量时间，一次又一次地写出相同的查询，然后出错等等。如果视图还用于对基础表执行授权（访问控制），则视图也可能是访问数据的唯一方式。

如果查询表现不佳，您需要查看查询是如何形成的，以及表上是否都有适当的索引。如果您的系统需要准确的统计信息以使优化器运行良好，那么您最近是否充分更新了这些统计信息？

很久以前，我遇到过一个系统，其中一个查询生成器创建了一个查询，该查询在一个 FROM 子句中列出了 17 个表，其中包括一个表与其自身的几个 LEFT OUTER JOIN。而且，事实上，更仔细的研究表明，其中一些“表”实际上是多表视图，其中一些还涉及自外连接，并且它们本身也涉及视图的自外连接。说“*可怕*”是轻描淡写的。有很多清理工作可以提高查询的性能——消除不必要的外连接、自连接等。（它实际上早于 SQL-92 的显式连接表示法 - 我很久以前说过 - 所以外连接语法是 DBMS 特定的。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-27T16:42:16.440

如果您指的是网络性能，那么使用本地缓存（如使用 ADO.Net 数据集）将减少网络流量，但可能会导致锁定问题。只是一个想法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-27T16:49:27.127

视图仍然是一个查询，它只是抽象了它的某些部分，以便可以简化您的查询（如果它们做类似的事情）并最大限度地重用。

# sql - 是否可以在 SQL Server 中创建一个可以处理序列的函数？

> ID：324178
> 
> 赞同：0
> 
> 时间：2008-11-27T16:30:14.810
> 
> 标签：sql, sql-server, oracle, sequence

我们正在研究将持久层从 Oracle 移植到另一个数据库的各种选项，我们正在研究的一个是 MS SQL。但是，我们在整个代码中使用 Oracle 序列，因此移动似乎会让人头疼。我了解@identity，但这将是对持久性代码的大规模检修。

是否可以在 SQL Server 中创建一个可以处理序列的函数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T16:38:47.010

这取决于您当前在 Oracle 中使用的序列。通常在插入触发器中读取一个序列。

从你的问题我猜是持久层在插入数据库之前生成序列（包括新的pk）

在 MSSQL 中，您可以将 SQL 语句与 ';' 组合在一起，因此要检索新创建记录的标识列，请使用 INSERT INTO ... ; 选择范围标识（）

因此，插入记录的命令返回一个记录集，其中包含单行和单列，其中包含标识列的值。

您当然可以改变这种方法，并创建序列表（类似于 Oracle 中的双表），如下所示：

```
INSERT INTO SequenceTable (dummy) VALUES ('X');
SELECT @ID = SCOPE_IDENTITY();
INSERT INTO RealTable (ID, datacolumns) VALUES (@ID, @data1, @data2, ...) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T06:47:12.510

我去年在一个项目上做了这个。基本上，我只是创建了一个包含序列名称、当前值和增量数量的表。

然后我创建了一个 4 procs ：

*   GetCurrentSequence(sequenceName)
*   GetNextSequence(sequenceName)
*   CreateSequence(sequenceName, startValue, incrementAmount)
*   删除序列（序列名称）

但是有一个你可能不理解的限制；函数不能有副作用。因此，您可以为 GetCurrentSequence(...) 创建一个函数，但 GetNextSequence(...) 需要是一个 proc，因为您可能希望增加当前序列值。但是，如果它是一个过程，您将无法直接在插入语句中使用它。

所以而不是

```
insert into mytable(id, ....) values( GetNextSequence('MySequence'), ....); 
```

相反，您需要将其分成 2 行；

```
declare @newID int;
exec @newID = GetNextSequence 'MySequence';
insert into mytable(id, ....) values(@newID, ....); 
```

此外，SQL Server 没有任何机制可以执行类似的操作

```
MySequence.Current 
```

或者

```
MySequence.Next 
```

希望有人会告诉我上述限制是不正确的，但我很确定它们是准确的。

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T17:09:41.223

如果你有很多代码，无论如何你都会想要对代码进行大规模的检查；在 Oracle 中运行良好的东西并不总是在 MSSQL 中运行良好。例如，如果您有很多游标，虽然您可以将它们逐行转换为 MSSQL，但您不会获得良好的性能。

简而言之，这不是一件容易的事。

# uml - UML 是消息传递系统的良好表示法吗？

> ID：324180
> 
> 赞同：2
> 
> 时间：2008-11-27T16:31:18.257
> 
> 标签：uml, design-patterns, messaging

自从[企业集成模式](https://rads.stackoverflow.com/amzn/click/com/0321200683)出版以来，人们一直在使用该书中介绍的符号来记录异步异构消息传递系统。

但是我们的商店或多或少地围绕着专门执行 UML 的专有文档工具进行了标准化。标准 UML 图之一是否适合记录异步消息传递系统，包括转换器、路由器等？如果是，是哪一个？如果不是，那么反对为此目的调整 UML 的杀手锏是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T17:09:15.327

UML 提供了一种通过[配置文件进行扩展的机制](http://en.wikipedia.org/wiki/Profile_%28UML%29)

配置文件允许您指定构造型、标记值和约束。

每个原型都可以有一个可选的原型图标。

也许您可以下载 UML 的 EIP 配置文件？

如果没有，如果您的 UML 工具支持，您可以构建自己的配置文件，并使用[Gregor Hohpe 网站上作为 Visio 形状提供的图标](http://www.eaipatterns.com/downloads.html)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T08:51:02.523

我认为工具包一针见血。[EIP 的作者自己在他们的书](http://www.eaipatterns.com/Introduction.html)的介绍中引用了 UML 概要文件。但是他们提供的链接已损坏，请按照此链接访问 OMG 的[UML 企业应用程序集成](http://www.omg.org/technology/documents/formal/eai.htm)配置文件。

# performance - Number VS Varchar(2) 主键

> ID：324181
> 
> 赞同：11
> 
> 时间：2008-11-27T16:31:28.133
> 
> 标签：performance, primary-key, numbers, varchar

我现在到了我需要设计我的数据库（Oracle）的项目的这一点。通常对于状态和国家表，我不使用数字主键，例如

```
STATUS (max 6)
AC --> Active
DE --> Deleted

COUNTRIES (total 30)
UK --> United Kingdom
IT --> Italy
GR --> Greece 
```

这些表是静态的，不会通过应用程序更新，并且预计将来不会更改，因此在将这些值用作外键的表中不会出现更新问题。

应用程序的主表将使用状态和国家（不止一次，例如来源国、目的地国），预计每年将增加 600000 行

所以我的问题是，在查询 3 个表的连接时，这些 VARCHAR(2) 键是否会对性能产生影响。第一个会比第二个慢很多吗？

```
SELECT m.*,
       s.status_name,
       c.country_name
  FROM main m, status s, countries c
 WHERE m.status_cd = s.status_cd
   AND m.country_cd = c.country_cd
   AND m.status_cd = 'AC'
   AND m.country_cd = 'UK'

SELECT m.*,
       s.status_name,
       c.country_name
  FROM main m, status s, countries c
 WHERE m.status_cd = s.status_cd
   AND m.country_cd = c.country_cd
   AND m.status_cd = 1
   AND m.country_cd = 2 
```

* * *

澄清：

状态不是二进制的（表名旁边的“max 6”）。这些值可能是：

```
* active
* deleted
* draft
* send
* replaced 
```

我们需要向用户显示解码后的值，所以我们需要名称。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T17:20:17.923

状态表和国家表都非常小，以至于无论是否正式声明，它们都将成为实践中的常驻内存。实际上，除了外键通常需要在所引用的主键字段上建立索引外，您可能不想打扰表上的任何索引。

不同类型的连接之间的性能差异将可以忽略不计，如果有的话，数字代码会变慢，因为要存储“更多”数据（但它是如此之小以至于可以忽略不计）。

因此，请使用自然代码。除此之外，第一个示例中的 SQL 更清晰；'UK' 和 'AC' 比 1 和 2 更有意义。

在非 Oracle DBMS 中，您可能会将 CHAR(2) 用于状态和国家代码值。Oracle 用户倾向于使用 VARCHAR2 来处理所有事情；我不确定使用 CHAR(2) 列是否会受到惩罚，特别是因为列值是固定长度的。（例如，在 Informix 下，一个 VARCHAR(2) 字段 - 最多两个字符的字段 - 将存储为 3 个字节、一个长度（在您的情况下始终为 2）和 2 个数据字节。相比之下，一个 CHAR(2 ) 字段将只占用 2 个字节。)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T17:08:16.623

看看这个[链接](http://searchoracle.techtarget.com/expert/KnowledgebaseAnswer/0,289625,sid41_gci1269687,00.html)。底线是 varchar 和 num 之间没有太大的性能差异。因此，您应该选择对专栏有意义的内容。在这里，varchar 似乎更有意义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T16:36:43.083

如果“状态”是（并且将永远是？）二进制活动/已删除字段，为什么还要打扰表格。这似乎是标准化到了一个不切实际的极端。

简单地使用 tinyint(1) 字段并将活动/删除状态记录为 1 或 0肯定*会*更快，更不用说更容易了。

这完全消除了你的一个连接，这一定是件好事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T17:17:30.380

在这种情况下，您选择哪种方法并不重要。重要的部分是在整个数据库中使用相同的类型，并且在您的 id 约定中保持一致。

# .net - 使用 .net (XmlDataDocument,XslCompiledTransform,XmlTextWriter) 执行 xml+xsl=html 时从日期时间中删除“T”

> ID：324188
> 
> 赞同：0
> 
> 时间：2008-11-27T16:33:38.237
> 
> 标签：.net, html, xml, vb.net, xslt

从结果中删除“T”的最简单方法是什么？

我希望结果是“YYYY/MM/DD HH/MM/SS”

vb.net 代码非常简单

```
 xmlDoc = New Xml.XmlDataDocument(data_set)
        xslTran = New Xml.Xsl.XslCompiledTransform
        xslTran.Load(strXslFile)
        writer = New Xml.XmlTextWriter(strHtmlFile, System.Text.Encoding.UTF8)

        xslTran.Transform(xmlDoc, Nothing, writer)

        writer.Close() 
```

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-27T20:37:16.200

这是一种更易读的方法：

```
<xsl:value-of select="substring(., 1, 10)"/>
<xsl:text> </xsl:text>
<xsl:value-of select="substring(., 12, 8)"/> 
```

这不太可读但更简洁：

```
<xsl:value-of select="concat(substring(., 1, 10), ' ', substring(., 12, 8))"/> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T08:52:24.970

您还可以在 XSLT 文件中使用 substring-before 和 substring-after 函数。

```
<xsl:value-of select="substring-before(@datetime, 'T')" />
<xsl:text> </xsl:text>
<xsl:value-of select="substring-after(@datetime, 'T')"/> 
```

或者，您可以使用 translate 函数，将 T 替换为空格。

```
<xsl:value-of select="translate(@datetime,'T',' ')"/> 
```

# benchmarking - 对于编写有意义的基准，您能给我什么建议？

> ID：324200
> 
> 赞同：5
> 
> 时间：2008-11-27T16:37:35.327
> 
> 标签：benchmarking

我开发了一个框架，供我们组织中的几个团队使用。在此框架之上开发的那些“模块”可以表现得完全不同，但它们都非常消耗资源，即使有些比其他的更多。他们都在输入中接收数据，分析和/或转换它，然后进一步发送。

我们计划购买新硬件，我的老板让我根据模块定义和实施基准测试，以便比较我们得到的不同报价。

我的想法是简单地以一组精心挑选的数据作为输入按顺序启动每个模块。

你有什么建议吗？对这个简单的程序有何评论？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-27T16:53:44.017

你的问题很广泛，所以很遗憾我的回答也不会很具体。

首先，基准测试很难。不要低估产生有意义的、可重复的、高度可信的结果所需的努力。

第二，你的绩效目标是什么？是吞吐量（每秒的事务或操作）吗？是延迟（执行交易所需的时间）吗？你关心平均表现吗？我关心最坏情况下的性能吗？你关心绝对最坏的情况还是我关心 90%、95% 或其他百分位数获得足够的性能？

根据您的目标，您应该设计基准来衡量该目标。因此，如果您对吞吐量感兴趣，您可能希望以规定的速率将消息/事务/输入发送到您的系统，并查看系统是否跟上。

如果您对延迟感兴趣，您将发送消息/事务/输入并测量处理每一个需要多长时间。

如果您对最坏情况下的性能感兴趣，您将向系统添加负载，直到您认为“现实”（或系统设计说它应该支持的任何内容）。

其次，您没有说这些模块是否会受 CPU 限制、I/O 限制、它们是否可以利用多个 CPU/内核等。当您尝试评估不同的硬件解决方案时，您可能会发现您的应用程序会受益更多来自出色的 I/O 子系统与大量 CPU。

第三，最好的基准（也是最难的）是将实际负载放入系统中。这意味着，您记录生产环境中的数据，并通过这些数据放置新的硬件解决方案。完成这项工作比听起来要难，通常，这意味着在系统中添加各种测量点以查看其行为（如果您还没有）修改现有系统以添加记录/播放功能，修改播放以不同的速率运行，并获得一个真实的（即类似于生产）环境进行测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T16:52:58.540

最有意义的基准是衡量您的代码在日常使用中的表现。这显然会为您提供最真实的数字。

选择几个现实生活中的数据集，并让它们通过您的组织每天使用的相同流程。为了获得额外的荣誉，请与使用您的框架的人交谈，并要求他们提供一些“最佳情况”、“正常”和“最坏情况”数据。如果存在隐私问题，请匿名数据，但尽量不要更改任何可能影响性能的内容。

请记住，您是在对两组硬件进行基准测试和比较，而不是您的框架。将所有软件视为黑匣子，简单地衡量硬件性能。

最后，考虑保存数据集并使用它们来类似地评估您对软件所做的任何后续更改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T17:16:02.347

如果您的系统应该能够同时处理所有调用的多个客户端，那么您的基准测试应该反映这一点。请注意，有些电话不能很好地配合使用。例如，让 25 个线程同时发布相同位的信息可能会导致服务器端锁定，从而扭曲您的结果。

从具体细节的角度来看，我使用 Perl 及其[Benchmark 模块](http://perldoc.perl.org/Benchmark.html)来收集我关心的信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T20:23:11.813

如果您要比较不同的硬件，那么衡量每笔交易的成本可以很好地比较硬件与性能之间的权衡。一种配置可能会为您提供最佳性能，但成本太高。较便宜的配置可能会为您提供足够的性能。

模拟负载的“最坏情况”或“高峰时间”非常重要。使用“典型”卷进行测试也很重要。获得良好的服务器利用率是一种平衡行为，它不会花费太多，它可以提供所需的性能。

跨硬件配置的测试很快就会变得昂贵。另一个可行的选择是首先测量您拥有的配置，然后使用模型在虚拟系统中模拟该行为。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T16:53:20.053

如果可以，请尝试记录用户（或进程）对您的框架所做的一些操作，最好使用真实系统的克隆。这为您提供了最真实的数据。需要考虑的事项：

1.  哪些功能最常用？
2.  传输了多少数据？
3.  不要假设任何事情。如果您认为“这将是快/慢”，请不要下注。在 10 例中有 9 例，你错了。

为 1+2 创建前十名并以此为基础。

也就是说：如果您用新硬件替换旧硬件，您可以预期自您购买第一套以来每年的执行速度大约提高 10%（如果系统在其他方面相当相同）。

如果您有专门的系统，数字可能会完全不同，但通常情况下，新硬件不会有太大变化。例如，向数据库添加有用的索引可以将查询的运行时间从两小时减少到两秒。硬件永远不会给你那个。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-09-20T09:52:59.517

在我看来，在基准测试软件方面有两种基准。首先是微基准，当您尝试单独评估一段代码或系统如何处理狭义定义的工作负载时。比较两种用 Java 编写的排序算法。比较两个 Web 浏览器各自执行某些 DOM 操作的速度。其次，当您尝试在实际工作负载下评估软件系统时，有系统基准测试（我刚刚命名）。比较我在 Google Compute Engine 和 Amazon AWS 上运行的基于 Python 的后端。

在处理 Java 之类的东西时，请记住，VM 需要先预热，然后才能为您提供真实的性能。如果使用`time`命令测量时间，将包括 JVM 启动时间。您几乎总是希望忽略启动时间或单独跟踪它。

微基准测试

在第一次运行期间，CPU 缓存中会充满必要的数据。磁盘缓存也是如此。在随后的几次运行中，VM 继续预热，这意味着 JIT 会编译它认为有助于编译的内容。您想忽略这些运行并在之后开始测量。

进行大量测量并计算一些统计数据。平均值、中位数、标准差，绘制图表。看看它，看看它有多大的变化。可能影响结果的因素包括 VM 中的 GC 暂停、CPU 上的频率缩放、其他一些进程可能会启动一些后台任务（如病毒扫描）、操作系统可能会决定将进程移动到不同的 CPU 内核上，如果你[有 NUMA](https://access.redhat.com/solutions/48756)架构，结果会更加显着。

在微基准测试的情况下，所有这些都是一个问题。在开始之前杀死你可以杀死的进程。使用可以为您完成部分工作的基准测试库。像[https://github.com/google/caliper](https://github.com/google/caliper)之类的。

系统基准测试

如果在实际工作负载下对系统进行基准测试，这些细节并不真正让您感兴趣，您的问题“只是”知道什么是实际工作负载、如何生成它以及要收集哪些数据。如果您可以检测生产系统并在那里收集数据，那总是最好的。您通常可以这样做，因为您正在测量最终用户特征（网页渲染了多长时间），并且这些特征是 I/O 绑定的，因此收集数据的代码不会减慢系统速度。（页面需要通过网络传送给用户，我们在这个过程中是否也记录了一些数字也没有关系）。

请注意分析和基准测试之间的区别。基准测试可以为您提供做某事所花费的绝对时间，而分析可以为您提供与其他需要做的事情相比所花费的相对时间。这是因为分析器运行大量检测程序（常用技术是每隔几百毫秒停止世界并保存堆栈跟踪）并且检测会显着减慢一切。

# python - 在 Python 中解析大型 XML 文档的最快方法是什么？

> ID：324214
> 
> 赞同：68
> 
> 时间：2008-11-27T16:47:54.353
> 
> 标签：python, xml, performance, parsing

我目前正在根据 Python Cookbook 的第 12.5 章运行以下代码：

```
from xml.parsers import expat

class Element(object):
    def __init__(self, name, attributes):
        self.name = name
        self.attributes = attributes
        self.cdata = ''
        self.children = []
    def addChild(self, element):
        self.children.append(element)
    def getAttribute(self,key):
        return self.attributes.get(key)
    def getData(self):
        return self.cdata
    def getElements(self, name=''):
        if name:
            return [c for c in self.children if c.name == name]
        else:
            return list(self.children)

class Xml2Obj(object):
    def __init__(self):
        self.root = None
        self.nodeStack = []
    def StartElement(self, name, attributes):
        element = Element(name.encode(), attributes)
        if self.nodeStack:
            parent = self.nodeStack[-1]
            parent.addChild(element)
        else:
            self.root = element
        self.nodeStack.append(element)
    def EndElement(self, name):
        self.nodeStack.pop()
    def CharacterData(self,data):
        if data.strip():
            data = data.encode()
            element = self.nodeStack[-1]
            element.cdata += data
    def Parse(self, filename):
        Parser = expat.ParserCreate()
        Parser.StartElementHandler = self.StartElement
        Parser.EndElementHandler = self.EndElement
        Parser.CharacterDataHandler = self.CharacterData
        ParserStatus = Parser.Parse(open(filename).read(),1)
        return self.root 
```

我正在处理大小约为 1 GB 的 XML 文档。有谁知道更快的方法来解析这些？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-11-28T20:03:02.700

在我看来，您的程序似乎不需要任何 DOM 功能。我会支持使用 (c)ElementTree 库。如果您使用 cElementTree 模块的 iterparse 函数，您可以按照自己的方式处理 xml 并在事件发生时处理它们。

但是请注意，Fredriks 关于使用 cElementTree [iterparse 函数](http://effbot.org/zone/element-iterparse.htm)的建议：

> 要解析大文件，您可以在处理完元素后立即删除它们：

```
for event, elem in iterparse(source):
    if elem.tag == "record":
        ... process record elements ...
        elem.clear() 
```

> 上述模式有一个缺点；它不会清除根元素，因此您最终会得到一个包含许多空子元素的元素。如果您的文件很大，而不仅仅是很大，这可能是个问题。要解决此问题，您需要掌握根元素。最简单的方法是启用开始事件，并保存对变量中第一个元素的引用：

```
# get an iterable
context = iterparse(source, events=("start", "end"))

# turn it into an iterator
context = iter(context)

# get the root element
event, root = context.next()

for event, elem in context:
    if event == "end" and elem.tag == "record":
        ... process record elements ...
        root.clear() 
```

lxml.iterparse [()](http://codespeak.net/lxml/FAQ.html#why-can-t-i-just-delete-parents-or-clear-the-root-node-in-iterparse)不允许这样做。

前面的不适用于 Python 3.7，考虑下面的方式来获取第一个元素。

```
import xml.etree.ElementTree as ET

# Get an iterable.
context = ET.iterparse(source, events=("start", "end"))

for index, (event, elem) in enumerate(context):
    # Get the root element.
    if index == 0:
        root = elem
    if event == "end" and elem.tag == "record":
        # ... process record elements ...
        root.clear() 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-27T19:00:41.700

你试过这个`cElementTree`模块吗？

`cElementTree`包含在 Python 2.5 及更高版本中，作为 xml.etree.cElementTree。参考[基准](http://effbot.org/zone/celementtree.htm)。

请注意，由于 Python 3.3`cElementTree`被用作默认实现，因此 Python 3.3+ 版本不需要此更改。

*删除了无效的 ImageShack 链接*

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-27T17:53:36.453

我推荐你使用[lxml](http://lxml.de/)，它是一个非常快的 libxml2 库的 python 绑定。

根据我的经验，libxml2 和 expat 的性能非常相似。但我更喜欢 libxml2（和 python 的 lxml），因为它似乎更积极地开发和测试。libxml2 也有更多的特性。

lxml 大部分 API 与[xml.etree.ElementTree](https://docs.python.org/3/library/xml.etree.elementtree.html)兼容。它的网站上有很好的文档。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-27T16:56:38.470

注册回调会极大地减慢解析速度。[编辑]这是因为（快速）C 代码必须调用 Python 解释器，它不如 C 快。基本上，您使用 C 代码读取文件（快速），然后在 Python 中构建 DOM （慢）。[/编辑]

尝试使用 xml.etree.ElementTree，它 100% 用 C 语言实现，它可以解析 XML，而不需要对 python 代码进行任何回调。

文档解析完成后，您可以对其进行过滤以获得您想要的内容。

如果这仍然太慢并且您不需要 DOM，则另一种选择是将文件读入字符串并使用简单的字符串操作来处理它。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-27T21:30:57.450

如果您的应用程序对性能敏感并且可能会遇到大文件（如您所说，> 1GB），那么我**强烈**建议您不要使用您在问题中显示的代码，原因很简单，*它将整个文档加载到 RAM 中*. 我鼓励您重新考虑您的设计（如果可能的话），以避免一次将整个文档树保存在 RAM 中。不知道您的应用程序的要求是什么，除了尝试使用“基于事件”设计的通用建议之外，我无法正确建议任何特定方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-11-19T22:50:42.987

**如果您不需要将整个树存储在内存中，则expat ParseFile**效果很好，这迟早会耗尽您的 RAM 来存储大文件：

```
import xml.parsers.expat
parser = xml.parsers.expat.ParserCreate()
parser.ParseFile(open('path.xml', 'r')) 
```

它将文件读入块中，并将它们提供给解析器，而不会导致 RAM 爆炸。

文档：[https ://docs.python.org/2/library/pyexpat.html#xml.parsers.expat.xmlparser.ParseFile](https://docs.python.org/2/library/pyexpat.html#xml.parsers.expat.xmlparser.ParseFile)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-05-09T22:42:55.347

我花了相当长的时间尝试这个，似乎最快且内存占用最少的方法是使用 lxml 和 iterparse，但要确保释放不需要的内存。在我的示例中，解析 arXiv 转储：

```
from lxml import etree

context = etree.iterparse('path/to/file', events=('end',), tag='Record')

for event, element in context:
    record_id = element.findtext('.//{http://arxiv.org/OAI/arXiv/}id')
    created = element.findtext('.//{http://arxiv.org/OAI/arXiv/}created')

    print(record_id, created)

    # Free memory.
    element.clear()
    while element.getprevious() is not None:
        del element.getparent()[0] 
```

这样`element.clear`还不够，还要删除任何指向先前元素的链接。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-01-11T07:49:04.900

在 Python3 中，您应该更改语法
而不是这个

```
# get the root element
event, root = context.next() 
```

试试这个（就像在[Iterparse object has no attribute next](https://stackoverflow.com/questions/28542497/iterparse-object-has-no-attribute-next)中推荐的那样）

```
# get the root element
event, root = next(context) 
```

这条线是不必要的

```
# turn it into an iterator
context = iter(context) 
```

# licensing - Microsoft Office PerformancePoint Server 2007 的许可模式如何工作？

> ID：324219
> 
> 赞同：0
> 
> 时间：2008-11-27T16:50:28.703
> 
> 标签：licensing, moss, performancepoint

我对 Microsoft PerformancePoint Server 的许可模式感到困惑。

当我查看 [http://www.microsoft.com/business/performancepoint/howtobuy/default.aspx](http://www.microsoft.com/business/performancepoint/howtobuy/default.aspx)

我看到一个 20,000 美元的服务器许可证，外加一个 200 美元的 CAL 许可证。但是语言对于这意味着什么有点含糊不清——任何查看报告的用户或报告更新者/创建者都需要 CA1 吗？

非常感谢，

d

-彼得

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T02:36:32.683

它现在[包含在](http://blogs.msdn.com/sharepoint/archive/2009/01/23/microsoft-business-intelligence-strategy-update-and-sharepoint.aspx)MOSS 2007 的企业许可证中。

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2008-12-26T06:57:21.630

我不是律师或任何人，但这个许可条款看起来微软实际上无法强制执行。有时他们会在法律上毫无根据的许可证中添加条款（即他们无法起诉您并获胜）并且只是假设您会遵守许可证，因为您害怕。

# windows-xp - 如何在 Windows XP 上注销之前运行我的程序？

> ID：324220
> 
> 赞同：9
> 
> 时间：2008-11-27T16:51:02.540
> 
> 标签：windows-xp, registry, logout, runonce

我正在寻找“RunOnceEx”的反向版本。

RunOnceEx 确实在用户的外壳（桌面和任务栏）启动之前运行了一些程序。在 runonceex 完成之前，登录进度将不会继续。

我想做完全相同的事情，但在用户注销时。当她/他注销时，所有正在运行的程序都关闭，离开shell（桌面和任务栏），然后“我希望我的程序在这一刻执行”，最后注销。

我认为这是可能的，因为“mobsync.exe”正在这样做。但我找不到在哪里以及如何做。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-27T16:58:24.067

警告，如此[**处**](http://www.eggheadcafe.com/software/aspnet/30020406/trouble-getting-logoff-sc.aspx)所述，将允许您**为*****所有*****用户**`gpedit.msc`配置注销脚本。

 *如果您只需要一个用户的脚本，您需要直接在注册表中声明它，在`HKCU`和`HKLM`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-17T17:38:05.800

To run this only for the current user, you can use WMI to get an information when a shutdown/logout occurs.

Either you write a small C# (or any other language that can use WMI) application or vbs script to listen on the *Win32_ComputerShutdownEvent* WMI event.

An example C# app can be found here in this question: [Get Log off event from system](https://stackoverflow.com/questions/984881/get-log-off-event-from-system)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-27T16:53:29.040

在谷歌的第一个结果中为我找到

要执行一个程序，您可以创建一个脚本来运行它并使用组策略来执行它。在组策略编辑器中导航到用户配置-->Windows 设置-->脚本（登录/注销）

[更多信息在这里](http://technet.microsoft.com/en-us/library/cc738773.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-12-17T14:44:42.780

如果您希望正在运行的程序在注销时执行代码，那么您应该挂钩该`WM_QUERYENDSESSION`消息并查找(0x80000000)的`lParam`值。`ENDSESSION_LOGOFF`

测试这个`lParam`值很重要，因为其他值表示“强制关闭” - 即您的进程可能在您的代码甚至被允许运行之前被终止。事实上，大多数关闭/会话结束消息只是为了让您有机会运行最后一分钟的清理代码，并且对长时间运行的操作进行响应并不安全；但是这种特殊的组合应该没问题。

Note: I've never tried to actually run a separate process in response to the `WM_QUERYENDSESSION` message. It's possible that the window manager will disallow this, like it does during shutdown. Try it and see, I guess.

If you're in a .NET environment (you didn't specify), a quicker way is to add an event handler to the `Microsoft.Win32.SystemEvents.SessionEnding` event.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-15T16:08:28.623

您需要的是[GINA](http://msdn.microsoft.com/en-us/library/aa375457%28VS.85%29.aspx)的实现。您可以在[WlxIsLogoffOk](http://msdn.microsoft.com/en-us/library/aa380569%28VS.85%29.aspx)函数中运行自定义命令，该函数在用户启动注销时调用

创建正确的 GINA dll 后，您可以在此处注册它：`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\@GinaDLL`

这是一个可能满足您需求的实现（它提供了一个注销注册表项，您可以在其中指定您的命令）： [http ://wwwthep.physik.uni-mainz.de/~frink/newgina_pre09/readme.html](http://wwwthep.physik.uni-mainz.de/~frink/newgina_pre09/readme.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-16T13:28:51.137

正如 VonC 和 TFD 已经提到的，组策略编辑器只是操纵注册表的另一种方式。

只需使用 gpedit 进行您喜欢的更改（在 Userconfig - Windows 设置 - 脚本中），然后查看注册表`[HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\System\Scripts]` 以了解如何直接执行此操作。

在我的 PC 上（挂在域中）还有一个隐藏文件夹`C:\WINDOWS\System32\GroupPolicy`，其中包含用于用户和机器的子文件夹。两者都有额外的子文件夹，称为 Shutdown 和 Startup。也许你也可以使用这些。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-17T13:37:40.483

如果您需要一些简单的东西并为单个（或任何）用户工作，您可以使用 C++ 或 C# 制作一个简单的应用程序。

最简单的方法是在托盘中有一个 C#（只需将托盘组件添加到表单中），并为**FormClosing**事件注册和事件处理程序。它看起来像这样：

```
 private void Form1_FormClosing(object sender, FormClosingEventArgs e)
    {
        if (e.CloseReason != CloseReason.UserClosing)
        {
            // It's not the user closing the application,
            // Let's do whatever you want here, for example starting a process
            Process notePad = new Process();

            notePad.StartInfo.FileName   = "notepad.exe";
            notePad.StartInfo.Arguments = "ProcessStart.cs";

            notePad.Start();
        }
    } 
```

因此，您的应用程序将使用 Windows 或用户启动。它会等待（使用一点内存）并在系统关闭或用户注销等时执行某些操作（通过检查上面的“CloseReason”）。

# asp.net - UpdatePanel 不刷新

> ID：324222
> 
> 赞同：1
> 
> 时间：2008-11-27T16:51:31.150
> 
> 标签：asp.net, ajax.net

我有一个带有 HtmlInputHidden 字段的简单页面。我使用 Javascript 来更新该值，并且在回发页面时，我想读取该 HtmlInputHidden 字段的值。该 HtmlInputHidden 字段的 Value 属性在回发时是默认值（它在创建页面时具有的值，而不是通过 Javascript 反映的值）。我还尝试使用 ScriptManager.RegisterHiddenField(Page, "MyHtmlImputHiddenField", "initialvalue") 注册 HtmlInputHidden 字段，但它仍然只能让我读取“初始值”，即使我（通过 javascript）可以检查该值已更改。

我尝试对 rowid 进行硬编码，令我惊讶的是，在回发之后 gridview 与删除之前完全相同，但记录已从数据库中删除。（我已经调用了数据绑定方法）。

```
 protected void gridViewDelete(object sender, GridViewDeleteEventArgs e)
  {

      bool bDelete = false;
      bool bCheck = false;

      if (hfControl.Value != "1")
      {
          // check relationship
          bCheck = validation_method(.......);
          if (bCheck)
          {
              bDelete = true;
          }   
      }
      else
      {
          hfControl.Value = "";
          bDelete = true;
      }

      if (bDelete)
      {
          //process delete
      }
      else
      {
          string script = string.Empty;

          script += " var x; ";
          script += " x = confirm('are u sure?'); ";
          script += " if (x){ " ;
          script += " document.getElementById('hfControl').value  = '1'; ";
          script += " setTimeOut(__doPostBack('gridView','Delete$"
                                      + e.RowIndex + "'),0);";
          script += " } ";

          ScriptManager.RegisterClientScriptBlock(this,
                                       Page.GetType()
                                       , "confirm"
                                       , script
                                       ,true);
      }
   } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-27T23:57:22.600

在回发时，页面加载时隐藏字段的视图是回发的内容，还是您在页面加载时设置的值？您可能不得不担心在回发中您没有将值重置为原始值的情况。另一点是，如果您进行删除，您是在刷新显示的数据还是相同？这些将是我的建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T11:32:49.340

当我进行回发时，该值与回发的值相同。我认为更新面板没有刷新。我试图做__doPostBack（'UpdatePanel1'，''），也没有工作。

# parsing - 如何使用 mshtml 获取框架的内容？

> ID：324231
> 
> 赞同：2
> 
> 时间：2008-11-27T16:54:36.307
> 
> 标签：parsing, frames, mshtml

这是问题：

我在 IE 中有一个钩子，它对`WebBrowser.OnNavigateComplete2`事件做出反应以解析文档的内容以获得一些精确的信息。

该文档包含框架，因此我查看了`HTMLDocument.frames`. 对于每一个，我都会查看 document.body.outerHTML 属性以检查内容。

问题是，我正在寻找的字符串永远不会在那里显示，而它显示在结局页面中。那么，我是不是找错地方了？如果它在页面完全加载时显示，那么它会在某个时候下载，对吗？但我应该看哪个对象？

顺便说一句，我不知道这是否重要，但我正在搜索的页面来自 ASP.NET 应用程序。

```
public void OnNavigateComplete2(object pDisp, ref object url)
{
    document = (HTMLDocument)webBrowser.Document;

    mshtml.FramesCollection frames = document.frames;
    for (int i = 0; i < frames.length; i++)
    {
        object refIdx = i;
        IHTMLWindow2 frame = (IHTMLWindow2)frames.item(ref refIdx);
        string frameContent = frame.document.body.outerHTML;
    }
} 
```

感谢您的帮助。

* * *

@rams 每个页面都会多次启动此事件，所以我认为这是每次加载框架时，即使我没有赶上我正在寻找的那个。如果没有，捕获帧内容的事件是什么？

我想要做的是在精确的框架上检测一些精确的信息，然后保存它。稍后，某个用户操作触发了一个网页加载，我需要从解析框架中获得的信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T17:55:43.250

您知道要查找内容的框架的名称/ID吗？如果是这样，在您的 navigateComplete2 事件中，您能否获得对框架的引用，例如

```
iFrame frm = document.frames(<your frame id>);

int readyState=0;

while(frm.readystate !=4){
// do nothing. be careful to not create an endless loop
}

if(frm.readyState==4){
   // get your content now
} 
```

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T17:23:08.387

你在使用某种线程吗？在单独的线程中运行浏览器确实会搞砸事情。尝试在 STAThread 中执行它并检查是否得到正确的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T19:59:29.553

您的字符串未显示的原因是由于框架。Web 浏览器控件在加载主文档后触发文档导航完成事件。此时，框架尚未请求其来源。在 Web 浏览器控件解析文档后，对帧源的请求将发出并下载。

您能描述一下您要完成的工作吗？

# simulation - 我将如何为足球管理模拟构建结果预测器？

> ID：324234
> 
> 赞同：3
> 
> 时间：2008-11-27T16:55:25.230
> 
> 标签：simulation, pseudocode

我正在寻找一些关于像足球经理和冠军经理这样的游戏在模拟真实得分线时如何达到相当高水平的真实感的思考。我意识到其中一些算法可能会填满货架，但我正在寻找更清晰的概述。

即使是一些概述在游戏循环期间不同玩家属性如何相互对抗的伪代码也会非常有趣。

我希望在业余时间为 Windows Mobile 平台做一个小项目，如果有任何有用的信息，我将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-01-20T22:14:50.937

你可能想看看我的项目，这是一个足球（足球）比赛模拟：http: [//sourceforge.net/projects/openfootie/](http://sourceforge.net/projects/openfootie/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T17:03:31.437

我的猜测是这样的算法对于像SI Games这样的游戏公司来说是商业机密，你不会在公共场所找到任何关于他们算法的提示。

您可以查看开源足球管理游戏，例如[bygfoot](http://bygfoot.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T17:15:14.657

如果您能够收集有关过去比赛结果的足够信息，则可以制作一个简单的[多元回归](http://en.wikipedia.org/wiki/Multiple_regression)模型来以合理的准确度预测得分。不过，您必须仔细选择变量。查看[此](http://pareonline.net/getvn.asp?v=7&n=2)和[此](http://www.nyx.net/~tmacfarl/STAT_TUT/reg_sion.ssi)以获取有关使用回归技术进行预测的更多信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T17:15:48.340

当然，任何此类算法的一个组成部分都是分析过去 X 年的*实际*足球得分：职业、大学和高中。

如果您要汇总仅活跃的职业球员的可用数据，然后查看他们参加的每场比赛的得分，您就可以开始获得一种可能的方法。

例如，也许有一个踢球者在对阵一支球队时只是僵住了 - 因此，当两支球队互相比赛时，教练不会让他上场。

显然，这样的分析应该提前完成，而**不是**在 Windows Mobile 设备上 :)

然而，这至少是一个合理的起点。

另外，一定不要依赖纯粹的统计数据——如果劳伦斯·泰勒摔断乔·泰斯曼的腿，你有多好也没关系：-\

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-27T11:49:39.590

您可能想看看一些开源足球模拟引擎：

[环境管理系统+](http://esmsworld.net/tiki-view_forum.php?forumId=4)

[脚踩](http://bygfoot.sourceforge.net)

我想说很难确定为此类游戏开发引擎的“正确”方法是什么。我认为它基本上是你认为应该如何确定的......显然偷看其他人的源代码会有所帮助:)

我还没有时间看 BygFoot，但是，我看了一下 ESMS，它看起来还不错！主循环没有你想象的那么大......

我会说必须涉及随机因素，这将允许“震惊”结果等，您还应该考虑最近的状态、球员的士气、健康、耐力、主场/客场等因素，并相应地为球员提供奖金.

希望这会有所帮助！

# asp.net - ASP.NET - 在屏幕底部显示应用程序构建日期/信息

> ID：324245
> 
> 赞同：30
> 
> 时间：2008-11-27T17:04:09.610
> 
> 标签：asp.net, versioning

我有一个 asp.net Web 应用程序，它有多个版本部署在其网络内的不同客户服务器上。我们的一种做法是让客户在遇到问题时通过电子邮件发送屏幕截图。

在旧的 asp.net 1.1 时代，我们可以使用反射获取构建 DLL 的详细信息，并在屏幕上一个微妙的位置显示有关构建日期和编号的信息。

在 .NET 2.0 及更高版本中，构建模型发生了变化，这种机制不再有效。我听说过不同的构建系统，但我真的在寻找最简单的方法，在 3.5 框架上，来完成这个功能在框架 1.1 上所做的事情。

1.  每次执行构建时，更新构建日期/时间，并以某种方式更新构建号
2.  能够看到构建时间戳和编号，显示在屏幕上
3.  尽可能简单地实现

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-24T13:30:38.047

我选择只使用执行程序集的日期。我发布文件的方式，这很好用。

```
lblVersion.Text = String.Format("Version: {0}<br>Dated: {1}",
    System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.ToString(),
    System.IO.File.GetLastWriteTime(System.Reflection.Assembly.GetExecutingAssembly().Location).ToShortDateString()); 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-27T17:16:56.667

我们正在使用 .Net 2.0 并从程序集中提取版本信息。也许并不理想，但我们使用描述来存储构建日期。

```
Assembly assembly = Assembly.GetExecutingAssembly();
string version = assembly.GetName().Version.ToString();
string buildDate = ((AssemblyDescriptionAttribute)Attribute.GetCustomAttribute(
    assembly, typeof(AssemblyDescriptionAttribute))).Description; 
```

构建过程使用 asminfo nant 任务来生成包含此信息的 AssemblyInfo.cs 文件。

```
 <asminfo output="Properties\AssemblyInfo.cs" language="CSharp">
        <imports>
            <import namespace="System" />
            <import namespace="System.Reflection" />
            <import namespace="System.Runtime.CompilerServices" />
            <import namespace="System.Runtime.InteropServices" />
        </imports>
        <attributes>
            <attribute type="AssemblyVersionAttribute" value="${assembly.version}" />
            <attribute type="AssemblyInformationalVersionAttribute" value="${assembly.version}" />
            <attribute type="AssemblyDescriptionAttribute" value="${datetime::now()}" />
            ...
        </attributes>
    </asminfo> 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-12-19T18:31:34.757

我正在使用 .NET 2.0 和 3.5，它能够设置构建号和构建日期。虽然帮助面板说如果还让 .NET 设置它，它将使用随机数进行修订，这不是真的，它实际上放置了可以轻松提取的日期/时间信息，这已由在线文档确认：http: [//msdn.microsoft.com/en-us/library/system.reflection.assemblyversionattribute.assemblyversionattribute.aspx](http://msdn.microsoft.com/en-us/library/system.reflection.assemblyversionattribute.assemblyversionattribute.aspx)

请参阅此博客： [http ://dotnetfreak.co.uk/blog/archive/2004/07/08/determining-the-build-date-of-an-assembly.aspx?CommentPosted=true#commentmessage](http://dotnetfreak.co.uk/blog/archive/2004/07/08/determining-the-build-date-of-an-assembly.aspx?CommentPosted=true#commentmessage)

我想自己设置构建版本，但仍然想要自动日期/时间戳，所以我对 AssemblyVersion("1.0.*") 使用类似的东西

这是一个提取构建日期/时间的示例函数

```
private System.DateTime BuildDate()
{

//This ONLY works if the assembly was built using VS.NET and the assembly version attribute is set to something like the below. The asterisk (*) is the important part, as if present, VS.NET generates both the build and revision numbers automatically.
//<Assembly: AssemblyVersion("1.0.*")> 
//Note for app the version is set by opening the 'My Project' file and clicking on the 'assembly information' button. 
//An alternative method is to simply read the last time the file was written, using something similar to:
//Return System.IO.File.GetLastWriteTime(System.Reflection.Assembly.GetExecutingAssembly.Location)

//Build dates start from 01/01/2000

System.DateTime result = DateTime.Parse("1/1/2000");

//Retrieve the version information from the assembly from which this code is being executed

System.Version version = System.Reflection.Assembly.GetExecutingAssembly().GetName().Version;

//Add the number of days (build)

result = result.AddDays(version.Build);

//Add the number of seconds since midnight (revision) multiplied by 2

result = result.AddSeconds(version.Revision * 2);

//If we're currently in daylight saving time add an extra hour

if (TimeZone.IsDaylightSavingTime(System.DateTime.Now, TimeZone.CurrentTimeZone.GetDaylightChanges(System.DateTime.Now.Year)))
{
    result = result.AddHours(1);
}

return result;

} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-27T17:15:58.230

您可以通过反射获得装配构建日期，请查看以下示例：

*   [艰难地确定构建日期](http://blog.codinghorror.com/determining-build-date-the-hard-way/)
*   [确定装配的构建日期](http://dotnetfreak.co.uk/blog/archive/2004/07/08/determining-the-build-date-of-an-assembly.aspx)

# .net - Linux 世界中是否有与 .Net FileSystemWatcher 等价的东西？

> ID：324258
> 
> 赞同：10
> 
> 时间：2008-11-27T17:11:41.187
> 
> 标签：.net, linux, file-io

我发现 .Net FileSystemWatcher 类对于编写实用程序非常方便，这些实用程序会在文件出现在其监视的文件夹中时自动生效。*nix 世界中是否有任何与此功能等效的功能，可以让我查看文件夹（可能还有它的所有子目录）？

**编辑：**最好这将是不需要内核补丁的东西。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-12-21T15:47:31.487

我想在 Ubuntu 10.10 的 Mono 中使用 FileSystemWatcher 分享我的观察。这是 C# 中 FileSystemWatcher 的一个非常简单的实现

```
using System;
using System.Collections.Generic;
using System.Collections;
using System.Text;
using System.IO;
using System.Reflection;

namespace FileSystemWatcherSandbox
{
    public class Program
    {
        static void Main(string[] args)
        {
            foreach(DictionaryEntry de in Environment.GetEnvironmentVariables())
            {
                Console.WriteLine("{0} = {1}",de.Key,de.Value);
            }
            string basePath = AppDomain.CurrentDomain.BaseDirectory;
            Console.WriteLine("watching: {0}", basePath);
            FileSystemWatcher fsw = new FileSystemWatcher(basePath);
            fsw.Changed += new FileSystemEventHandler(fsw_Changed);
            fsw.Created += new FileSystemEventHandler(fsw_Created);
            fsw.Deleted += new FileSystemEventHandler(fsw_Deleted);
            fsw.Error += new ErrorEventHandler(fsw_Error);
            fsw.Renamed += new RenamedEventHandler(fsw_Renamed);
            fsw.EnableRaisingEvents = true;
            fsw.IncludeSubdirectories = true;
            while (true)
            {
                WaitForChangedResult result = fsw.WaitForChanged(WatcherChangeTypes.All,10000);
                Console.WriteLine(result.TimedOut ? "Time out" : "hmmm");
            }
        }

        static void fsw_Renamed(object sender, RenamedEventArgs e)
        {
            Console.WriteLine("({0}): {1} | {2}", MethodInfo.GetCurrentMethod().Name, e.ChangeType, e.FullPath);
        }

        static void fsw_Error(object sender, ErrorEventArgs e)
        {
            Console.WriteLine("({0}): {1}", MethodInfo.GetCurrentMethod().Name, e.GetException().Message);
        }

        static void fsw_Deleted(object sender, FileSystemEventArgs e)
        {
            Console.WriteLine("({0}): {1} | {2}", MethodInfo.GetCurrentMethod().Name, e.ChangeType, e.FullPath);
        }

        static void fsw_Created(object sender, FileSystemEventArgs e)
        {
            Console.WriteLine("({0}): {1} | {2}", MethodInfo.GetCurrentMethod().Name, e.ChangeType, e.FullPath);
        }

        static void fsw_Changed(object sender, FileSystemEventArgs e)
        {
            Console.WriteLine("({0}): {1} | {2}", MethodInfo.GetCurrentMethod().Name, e.ChangeType, e.FullPath);
        }
    }
} 
```

此代码经过测试，可在 Windows XP 和 Ubuntu 10.10 上运行。但是，我想指出，在 Ubuntu 10.10（也可能是更早的版本）下，FileSystemWatcher 的行为是独一无二的。
如果正在监视的目录不包含子目录，则调用 FileSystemWatcher 并将 IncludeSubdirectories 属性设置为 true 将导致 FileSystemWatcher 忽略事件。但是，如果目标目录中有子目录，则将 IncludeSubdirectories 设置为 true 将按预期工作。
如果 IncludeSubdirectories 设置为 false，则始终有效。在这种情况下，FileSystemWatcher 将只监视目标目录。
我希望这对希望跨不同操作系统使用 Mono 并调用 FileSystemWatcher 类型的程序员有用。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-27T17:13:35.583

那将是[Gamin 文件更改监视器](http://www.gnome.org/%7Eveillard/gamin/)或[Inotify](http://en.wikipedia.org/wiki/Inotify)。

编辑：Mono 确实有 Gamin 绑定——事实上，它的 FileSystemWatcher 实现使用了 Gamin。[https://www.mono-project.com/docs/faq/technical/#what-are-the-issues-with-filesystemwatcher](https://www.mono-project.com/docs/faq/technical/#what-are-the-issues-with-filesystemwatcher)。

> **FileSystemWatcher 有什么问题？**
> 
> FileSystemWatcher 的 Mono 实现有许多后端，最优化的一个，依赖较少的一个是 inotify-backend（在 Mono 1.1.17 和更新版本中可用）。
> 
> 有了这个后端，内核为 Mono 提供了对文件系统上文件的任何更改的更新，但它需要一个支持 inotify 的内核，只有较新的 Linux 发行版才会提供该内核。
> 
> 在较旧的 Linux 系统中，您必须安装 FAM 或 Gamin（两者都可以使用）。您可能需要安装 -devel 数据包。
> 
> 对于 *BSD 系列，有一个基于 Kqueue 的实现，将在运行时检测到时使用。
> 
> 如果上述方法都不起作用，Mono 会退回到轮询目录以进行更改，这远非最佳。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-27T18:30:41.230

正如已经说过的，Mono 有“System.IO.FileSystemWatcher”类，这是相关链接： [http://www.go-mono.com/docs/monodoc.ashx?link=T%3aSystem.IO。文件系统观察器](http://www.go-mono.com/docs/monodoc.ashx?link=T%3aSystem.IO.FileSystemWatcher)

> “Mono 的 FileSystemWatcher 实现有多个后端。这是必要的，因为并非 Mono 支持的所有操作系统都具有提供应用程序预期功能所需的所有功能。
> 
> 如果操作系统内核支持使用该功能的监视目录（Linux 上的 inotify、BSD 或 OSX 上的 KEvents）；否则，它会回退到使用 Gamin 或 FAM 库（这些库提供了一个 API 来监视目录），如果这些功能都不可用，Mono 将每 750 毫秒轮询一次监视的目录。
> 
> 您可以通过在执行应用程序之前设置 MONO_MANAGED_WATCHER 环境变量来强制轮询行为（而不是使用内核支持）。这对于不支持 inotify 并且仍需要轮询以检测更改的文件系统可能很有用。”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-27T17:14:05.190

是的， dnotify 和[inotify](http://www-128.ibm.com/developerworks/linux/library/l-inotify.html)。

我不知道 Mono 是否有这些包装，但值得检查。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-02T15:27:32.290

如果您正在使用出色的 QT 库 (www.qtsoftware.com)，它包含在 QFileSystemWatcher 中。

# xslt - 如何在 XSLT 中将数字转换为重复字符？

> ID：324259
> 
> 赞同：2
> 
> 时间：2008-11-27T17:12:28.097
> 
> 标签：xslt, mediawiki, freemind

我有以下输入：

```
<node TEXT="txt">
  <node TEXT="txt">
    <node TEXT="txt"/>
    <node TEXT="txt"/>
  </node>
  <node TEXT="txt"/>
</node>
<node TEXT="txt"/> 
```

我目前正在使用：

```
<xsl:number level="multiple" count="node" format="1"/> 
```

在 XSTL 脚本中接收以下输出：

```
1 txt
1.1 txt
1.1.1 txt
1.1.2 txt
1.2 txt
2 txt 
```

但我想要这个输出：

```
* txt
** txt
*** txt
*** txt
** txt
* txt 
```

你能帮助我吗？

PS：我想将 freemind 地图转换为基本的 mediawiki 列表语法。是的！我知道有几种方法可以将本地 freemind 映射到媒体 wiki，但我需要将`<node>`-tree 转换为`***`-lists

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T18:08:24.597

一种简单的方法是只翻译

```
<xsl:number/>
```

成想要的格式。

这种转变：

`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">`

`<xsl:output method="text"/>`

`<xsl:strip-space elements="*"/>`

```
<xsl:template match="node">
  <xsl:variable name="vIndent">
    <xsl:number level="multiple" count="node"/>
  </xsl:variable>

  <xsl:value-of select=
   "concat(translate($vIndent,
                     '1234567890.',
                     '**********'),
           ' ',
           @TEXT,
         '&#xA;'
         )"/>
 <xsl:apply-templates/>
</xsl:template> 
```

`</xsl:stylesheet>`

应用于此 XML 文档时：

```
<t>
    <节点文本="txt">
        <节点文本="txt">
            <节点文本="txt"/>
            <node TEXT="txt"/></node>
        <node TEXT="txt"/></node>
    <节点文本="txt"/>
</t>

```

产生想要的结果：

```
* 文本文件
** 文本文件
*** 文本文件
*** 文本文件
** 文本文件
* 文本文件

```

请注意使用 translate() 函数来丢弃任何“。” 字符并将任何数字转换为“*”。

# winapi - 在 win32 中找出进程在内核中花费时间的原因

> ID：324261
> 
> 赞同：0
> 
> 时间：2008-11-27T17:13:34.443
> 
> 标签：winapi, profiling, kernel

我正在 WinXp VmWare 会话中编译一个 vc8 C++ 项目。在 RedHat VmWare 会话中，它比 gcc3.2 慢得多，所以我正在查看任务管理器。这就是说我的编译过程中有很大一部分花费在内核中。这对我来说听起来不对。

Win32 是否有 strace 的等价物？至少可以让我大致了解正在调用哪些内核函数。可能有一些突出的东西是罪魁祸首。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T18:35:56.243

Windows Resource Kit contains a tool called `kernrate`. It's a sampling profiler. It can profile entire system or a particular process. By default, its resolution is on a module level, but can be tuned down to several bytes. You should be fine with default resolution as you'll see which modules/drivers are consuming most of the time.

[Here](http://www.nynaeve.net/?p=45) is some info regarding its use.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T17:23:14.953

不完全是 strace，但有一种方法可以查看内核调用堆栈，并且通过在 CPU 使用率高的时候对其进行采样，您通常可以估计一直在用的东西。

安装[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)并确保使用符号服务器支持对其进行配置。您可以通过以下方式做到这一点：

1.  安装[WinDebug](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)以获取更新的 dbghelp.dll
2.  通过在选项 | 中设置路径，将 Process Explorer 设置为使用此版本的 dbghelp.dll。Process Explorer 的配置符号菜单。
3.  同样在同一个对话框中，设置符号路径，使其包含 MS 符号服务器和本地缓存。

这是符号路径的示例值：

```
SRV*C:\symbolcache*http://msdl.microsoft.com/download/symbols 
```

（您可以将 _NT_SYMBOL_PATH 环境变量设置为相同的值，以使调试工具使用相同的符号服务器和缓存路径。）该路径将导致 dbghelp.dll 在要求为不提供符号的模块提供符号时将符号下载到本地磁盘在本地有符号。

像这样设置 Process Explorer 后，您可以获取进程的属性，转到线程选项卡，然后双击最繁忙的线程。这将导致 Process Explorer 临时挂接到进程并扫描线程的堆栈，然后去查找堆栈上各种返回地址的符号。返回地址的符号和模块名称（对于非 MS 第三方驱动程序）应该为您提供有关 CPU 时间花费在何处的有力线索。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T19:35:01.163

VmWare 支持应该解决这个问题。它可能在 VmWare 实现中的某个地方。

例如，您可以使用[IrpTracker](http://www.osronline.com/article.cfm?article=199)，它可以让您了解内核中发生了什么。另一种选择是使用内核调试器，即[WinDbg](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)。如果 cpu 负载非常高，只是在调试器中随机中断并查看调用堆栈可以让您知道谁是 cpu 负载背后的驱动程序。但正如我所说，我猜这将是一些 VmWare 组件。值得在没有仿真的情况下检查问题是否在 WinXP 上的同一台计算机上仍然存在。

# batch-file - 批处理文件以删除早于指定日期的文件

> ID：324267
> 
> 赞同：16
> 
> 时间：2008-11-27T17:14:43.240
> 
> 标签：batch-file

如何创建批处理文件以删除早于指定日期的文件？

这似乎不起作用；

```
:: --------DELOLD.BAT----------
@echo off
SET OLDERTHAN=%1
IF NOT DEFINED OLDERTHAN GOTO SYNTAX

for /f "tokens=2" %%i in ('date /t') do set thedate=%%i
type %1
pause
set mm=%thedate:~0,2%
set dd=%thedate:~3,2%
set yyyy=%thedate:~6,4%

set /A dd=%dd% - %OLDERTHAN%
set /A mm=%mm% + 0

if /I %dd% GTR 0 goto DONE
set /A mm=%mm% - 1
if /I %mm% GTR 0 goto ADJUSTDAY
set /A mm=12
set /A yyyy=%yyyy% - 1

:ADJUSTDAY
if %mm%==1 goto SET31
if %mm%==2 goto LEAPCHK
if %mm%==3 goto SET31
if %mm%==4 goto SET30
if %mm%==5 goto SET31
if %mm%==6 goto SET30
if %mm%==7 goto SET31
if %mm%==8 goto SET31
if %mm%==9 goto SET30
if %mm%==10 goto SET31
if %mm%==11 goto SET30
if %mm%==12 goto SET31

goto ERROR

:SET31
set /A dd=31 + %dd%
goto DONE

:SET30
set /A dd=30 + %dd%
goto DONE

:LEAPCHK
set /A tt=%yyyy% %% 4
if not %tt%==0 goto SET28
set /A tt=%yyyy% %% 100
if not %tt%==0 goto SET29
set /A tt=%yyyy% %% 400
if %tt%==0 goto SET29

:SET28
set /A dd=28 + %dd%
goto DONE

:SET29
set /A dd=29 + %dd%

:DONE
if /i %dd% LSS 10 set dd=0%dd%
if /I %mm% LSS 10 set mm=0%mm%
for %%i in (*.*) do (
set FileName=%%i
call :PROCESSFILE %%~ti
)

set mm=
set yyyy=
set dd=
set thedate=
goto EXIT

:SYNTAX
ECHO.
ECHO USAGE:
ECHO DELOLD X
ECHO   Where X is the number of days previous to Today.
ECHO.
ECHO EX: "DELOLD 5" Deletes files older than 5 days.
GOTO EXIT

:PROCESSFILE
set temp=%1
set fyyyy=20%temp:~6%
set fmm=%temp:~0,2%
set fdd=%temp:~3,2%
if /I %fyyyy% GTR 2069 set fyyyy=19%temp:~6%

:: ***************************************
:: * This is where the files are deleted *
:: * Change the ECHO command to DEL to   *
:: * delete. ECHO is used for test.      *
:: ***************************************
if /I %yyyy%/%mm%/%dd% GEQ %fyyyy%/%fmm%/%fdd% (
ECHO %FileName%
)

set temp=
set fyyyy=
set fmm=
set fdd=

:EXIT

:: ----------END-DELOLD.BAT------------- 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-27T18:14:54.240

I use this script:

```
////////////////////////////////////////////////////////
// Deletes file older than a number of days 
// in the current directory
////////////////////////////////////////////////////////
// Usage: wscript DeleteOlderThan.js [#Days]
// By default, remove files older than 30 days
////////////////////////////////////////////////////////

function removeDays(date, nDays)
{
    var dateRet = date
    return dateRet.setDate(date.getDate() - nDays);
}

function addSlash(strPath)
{
    var c = strPath.substr(-1, 1);
    if( c !== '\\' && c !== '/' )
    {
        strPath += '\\';
    }
    return strPath;
}

// Read arguments
var nDays = WScript.Arguments(0) || 30;

// Create system objects
var fs = WScript.CreateObject("Scripting.FileSystemObject");
var shell = WScript.CreateObject("WScript.Shell");

// Retrieve current directory
var strDirectoryPath = addSlash(shell.CurrentDirectory);

// Compute date
var dateNow = new Date();
var dateTest = removeDays(dateNow, nDays);

// Iterate on files
var folder = fs.GetFolder(strDirectoryPath);
var files = folder.Files;

for( var it = new Enumerator(files); !it.atEnd(); it.moveNext() )
{
    var file = it.item();

    if( file.DateLastModified < dateTest)
    {
        file.Delete(true);
    }
} 
```

which I invoke every day with:

```
wscript "C:\Program Files\Utils\DeletesOlderThan.js" 30 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-01-07T01:59:00.747

如果您在 Windows Server 上和/或安装了 Server Resource Kit，[那么 forfiles](http://technet.microsoft.com/en-us/library/cc753551(WS.10).aspx)可能正是您正在寻找的。

示例：打印所有文件名，超过 180 天

```
forfiles /S /D -180 /C "cmd /C Echo @Path" >olderthan180days.txt 
```

删除所有超过 365 天的 PDF 文件

```
forfiles /S /M *.pdf /D -365 /C "cmd /C Del @Path" 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-27T17:50:16.537

**编辑：**我想通了。

要删除所有早于给定日期的文件：

```
REM del_old.bat
REM usage: del_old MM-DD-YYY
for /f "tokens=*" %%a IN ('xcopy *.* /d:%1 /L /I null') do if exist %%~nxa echo %%~nxa >> FILES_TO_KEEP.TXT
for /f "tokens=*" %%a IN ('xcopy *.* /L /I /EXCLUDE:FILES_TO_KEEP.TXT null') do if exist "%%~nxa" del "%%~nxa"
```

要删除比给定日期新的所有文件：

```
REM del_new.bat
REM usage: del_new MM-DD-YYYY
for /f "tokens=*" %%a IN ('xcopy *.* /d:%1 /L /I null') do if exist "%%~nxa" del "%%~nxa"
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-07-25T00:03:55.560

eJames：确实，我发现您的 xcopy 解决方案运行良好！我最喜欢它的一点是它应该在除英语之外的 Windows 语言版本中也能工作，因为 XCOPY 参数的格式似乎与日期设置无关。精彩的！;]

一项改进是预先创建 FILES_TO_KEEP.TXT 文件，这样如果没有文件符合保留条件，第二个 XCOPY 语句仍然可以继续执行删除（如果找不到 FILES_TO_KEEP.TXT 文件，它将失败）。这是我的脚本（请注意，在此示例中，我将其更改为仅删除 *.pdf 文件，并且我还更改了临时文件名以确保没有潜在的冲突，并在之后清理临时文件）：

```
@echo off
SET OLDERTHAN=%1
IF NOT DEFINED OLDERTHAN GOTO SYNTAX

echo >> ~~~FILES_TO_KEEP.TXT~
for /f "tokens=*" %%a IN ('xcopy *.pdf /d:%1 /L /I null') do if exist %%~nxa echo %%~nxa >> ~~~FILES_TO_KEEP.TXT~
for /f "tokens=*" %%a IN ('xcopy *.pdf /L /I /EXCLUDE:~~~FILES_TO_KEEP.TXT~ null') do if exist "%%~nxa" del "%%~nxa"
del ~~~FILES_TO_KEEP.TXT~

GOTO END

:SYNTAX
ECHO.
ECHO USAGE:
ECHO DELOLD mm-dd-yyyy
ECHO   Where mm-dd-yyyy is the date prior to which you want to delete files.
ECHO.
ECHO EX: "DELOLD 10-17-2008" Deletes files older than October 17, 2008.
ECHO.
ECHO This should work on any language version of Windows, but has only been 
ECHO tested in English-US versions.
GOTO END

:END 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-26T13:16:26.603

也许你会喜欢这个： [http ://blog.jumlin.com/2010/10/move-files-in-folders-and-subfolders-older-than-one-year/](http://blog.jumlin.com/2010/10/move-files-in-folders-and-subfolders-older-than-one-year/)

那是一个可以移动超过一年的文件的脚本，它甚至支持各种日期格式和子文件夹。您可以进行一些更改以使其删除而不是移动它们。它是一个非常完整的脚本，带有评论和解释。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-27T18:57:22.080

My solution works if you

*   either have a `touch` utility on your system (which I do)
*   or can afford to temporarily change system date using `date` command (which is probably not the case, but who knows)

Here's the idea:

1.  In the target directory, create a signal file (with a unique name), and with timestamp equal to your deletion threshold time. It can be done with `touch` (which accepts desired timestamp as a parameter), or by remembering current date with `date /T`, changing system date to desired with `date <param>`, and restoring the original date.

2.  Use `for /f %%I in ('dir /od')` to iterate over all files ordered by date, deleting them one by one. After you encounter (and delete) the signal file, stop deleting.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-27T17:42:07.693

我想知道为什么你必须使用 ole DOS shell... [Python](http://www.python.org/)或[Windows Powershell](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)将是 2008 年的正确选择 :)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-27T17:41:33.153

我不知道您是否可以使用 .BAT 文件以及 Windows 附带的一些工具来做到这一点，但您肯定可以使用 .js (JScript) 或 .vbs (VBScript) 文件。您是在 Windows 下执行此操作的，对吗？如果是这样，那么默认情况下，Windows 可以像处理 .bat 文件一样处理 .js 和 .vbs 文件。他们要强大得多。

而且，如果您碰巧只针对 Windows Server 2008，还有更好的 PowerShell（可下载用于其他 Windows 版本）。

# performance - 查询列表项并使用 SharePoint Web 服务与对象模型

> ID：324272
> 
> 赞同：5
> 
> 时间：2008-11-27T17:15:23.707
> 
> 标签：performance, web-services, sharepoint

我的公司正在考虑编写一个自定义应用程序，该应用程序需要跨多个网站集执行许多列表项查询。它需要在 WSS 3.0 上运行，如果它也能在 WSS 2.0 上运行，“会很好”。它不是为 MOSS/SPS 设计的，但如果它在这些平台上工作，它“会很好”。对于解决方案应使用哪个 .NET 版本没有限制。

对于这种类型的应用程序，什么会更好：对象模型/API 或 SharePoint Web 服务？我考虑的主要因素是性能，其次是特性和功能。谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T17:37:12.913

首先要考虑的是“我的代码是在共享点服务器上运行还是远程运行？”

*   如果它是**远程**运行的，你别无选择，使用**网络服务**

*   如果它在**共享点服务器**上运行，我建议使用**对象模型**，因为性能会更好，您将可以访问更多 API，并且身份验证会更容易（=自动）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-27T17:43:02.060

对象模型更好，因为您可以访问附加功能和列表项的完整详细信息，例如版本历史记录。

对象模型的性能也更好（只要您正确地 dispose() 您的 spsite 和 spweb 对象）。

Sharepoint 对象模型在 2 和 3 之间存在一些差异，但如果您查看 v2 的参考，那么它也可以与 v3 完全兼容。

Web 服务在 v2 和 v3 之间根本没有变化，这解释了为什么它们没有 v3 的任何新功能。

对象模型将在性能上获胜的原因是您不会将数据序列化为 Xml，然后传输一大块 Xml，然后反序列化 Xml。对象模型节省了您的内存和带宽。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T21:00:33.847

+1 给其他海报。

如果您决定采用 OM 路线，那么您可以从一个来源同时编译 WSS 2.0 和 WSS 3.0。这些应该让你开始。

[使用 Visual Studio 2008 为 Sharepoint 2003 开发？](https://stackoverflow.com/questions/243201/developing-for-sharepoint-2003-using-visual-studio-2008)

[如何引用一个 API 的两个版本？](https://stackoverflow.com/questions/286826/how-to-reference-two-versions-of-an-api)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T17:15:40.387

可以在 Infopath 表单中使用 OM 吗？目前我正在使用 Web 服务来提取我想要的列表数据，但我更愿意使用 OM。

# php - Subversion ... 是否适用于 PHP 框架应用程序？

> ID：324277
> 
> 赞同：1
> 
> 时间：2008-11-27T17:16:09.163
> 
> 标签：php, svn, frameworks

我正在使用 CodeIgniter 和 PHP 开发一个网站。我的一些朋友建议我开始使用 Subversion 来管理我的组织。有人可以给我一个基本的解释，说明什么是没有行话的 SVN，以及它对于需要 5 个文件来运行单个页面的框架是否实用？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-27T17:25:15.137

Subversion 允许您将源代码存储在一个中央位置，从多个位置（即笔记本电脑、台式机）进行更改、跟踪更改并在需要时将更改恢复到源代码树。

你有没有做过很大的“改进”，然后决定你走错了方向？使用 Subversion，您可以在开始朝错误的方向前进之前恢复到源代码的版本。

或者这样，您对代码库进行了一些细微的更改，但直到很久以后才注意到您引入了一个新错误。您可以使用 subversion 恢复到以前的代码版本，帮助您跟踪引入错误的更改。

与多个开发人员共享源代码时更有价值，但即使对于我的单个开发人员项目，我发现将所有源代码和更改都放在 Subversion 存储库中非常方便。

如果将它与 Trac 结合使用，则可以跟踪错误/功能、里程碑，并使用 Trac Wiki 记录您的项目。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-27T17:21:31.540

无论您使用什么框架或语言，每个项目（即使只有一个开发人员）都应该受到源代码控制。

使用简单的话，Subversion 将保留您的代码文件的历史记录，如果您想将它们恢复到以前的状态或在磁盘崩溃的情况下恢复副本（在这种情况下，SVN 必须在另一台计算机上）。它还将帮助您轻松查看文件的两个版本之间的差异。

有关更多信息，请阅读 TortoiseSVN 用户指南，它对 Subversion 有很好的概述。

这里有一些很好的信息：[第 2 章基本概念](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-basics.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T17:35:51.543

SVN 是一个版本控制系统。它用作所有代码的中央存储库。

SVN 的一个显着优势在于它使用 Copy-Modify-Merge 工作流模型而不是 Lock-Modify-Unlock 模型。这背后的想法是每个开发人员签出或复制（复制）他们自己的代码版本，对其进行处理（修改），将其重新签入并协调可能与其他开发人员所做的其他工作发生冲突的任何更改（合并） .

这真的很方便，就像您想处理一段代码一样，您不必担心文件被锁定，因为其他人正在处理它。

如果有的话，开发人员应该使用 SVN 对其代码的所有修订进行编目，并在需要时恢复。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T17:20:25.567

SVN 是一个[版本控制](http://en.wikipedia.org/wiki/Revision_control)系统——这意味着它存储给定文件的各种先前版本，并允许许多人处理同一个文件，最后将所有更改放在一起。如有必要，它还可以帮助您返回到以前的版本。

如果有很多人在做这个项目，你应该在你的项目中使用它。但即使你是唯一一个工作的人，如果项目处于版本控制中，管理项目也会更容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T17:21:30.043

这是一种保持版本控制的方法。您可以将其视为某种增量备份。您将代码发送到 SVN 服务器，它只保存与上一个版本的差异。这样，您可以在需要时返回到早期版本。它还允许您与更多人一起工作并轻松合并差异。我说，你应该使用它。它既简单又有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-28T00:58:53.130

不管你生产什么软件，即使你是一个人，也必须使用 SVN。我每天都依赖它。它是我离不开的一个软件工具。如果您可以在异地安装它，它也会为您提供备份。

一些简单的事情，例如在您进行更改时能够对文件的先前版本进行比较，可以提供很大的帮助。

在客户端使用 windows 下的 Toortoise。它集成到 Windows 中，非常好用。

# objective-c - 在objective-c/cocoa中抛出异常

> ID：324284
> 
> 赞同：424
> 
> 时间：2008-11-27T17:18:57.740
> 
> 标签：objective-c, cocoa, exception-handling

在objective-c/cocoa中抛出异常的最佳方法是什么？

* * *

## 回答 #1

> 赞同：533
> 
> 时间：2008-11-27T17:25:20.630

我使用`[NSException raise:format:]`如下：

```
[NSException raise:@"Invalid foo value" format:@"foo of %d is invalid", foo];
```

* * *

## 回答 #2

> 赞同：258
> 
> 时间：2008-11-27T23:32:02.057

这里要注意一点。在 Objective-C 中，与许多类似的语言不同，您通常应该尽量避免对正常操作中可能发生的常见错误情况使用异常。

[Apple 的 Obj-C 2.0 文档](http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ObjectiveC/Chapters/ocExceptionHandling.html#//apple_ref/doc/uid/TP30001163-CH13-TPXREF168)声明如下：“重要提示：异常在 Objective-C 中是资源密集型的。您不应将异常用于一般流程控制，或仅表示错误（例如文件不可访问）”

[Apple 的概念性异常处理文档](http://developer.apple.com/documentation/Cocoa/Conceptual/Exceptions/Exceptions.html)解释了相同的内容，但用了更多的话：“重要提示：您应该保留使用异常来进行编程或意外运行时错误，例如越界集合访问、尝试改变不可变对象、发送无效消息, 并失去与窗口服务器的连接。您通常在创建应用程序时而不是在运行时处理这些带有异常的错误。[.....] 代替异常，错误对象 (NSError) 和Cocoa 错误传递机制是在 Cocoa 应用程序中传达预期错误的推荐方式。”

部分原因是为了遵守 Objective-C 中的编程习惯（在简单的情况下使用返回值，在更复杂的情况下使用引用参数（通常是 NSError 类）），部分原因是抛出和捕获异常的成本要高得多，而且最后（并且最重要的是）Objective-C 异常是 C 的 setjmp() 和 longjmp() 函数的一个薄包装，基本上搞乱了你仔细的内存处理，请参阅[这个解释](http://newsgroups.derkeiler.com/Archive/Comp/comp.sys.mac.programmer.help/2007-08/msg00020.html)。

* * *

## 回答 #3

> 赞同：62
> 
> 时间：2008-11-27T18:35:25.823

```
@throw([NSException exceptionWith…]) 
```

Xcode 将`@throw`语句识别为函数退出点，就像`return`语句一样。使用该`@throw`语法可避免*您*可能从`[NSException raise:…]`.

此外，`@throw`可用于抛出不属于 NSException 类的对象。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-07-08T14:24:36.030

关于`[NSException raise:format:]`. 对于那些具有 Java 背景的人，您会记得 Java 区分 Exception 和 RuntimeException。Exception 是已检查的异常，而 RuntimeException 是未检查的。特别是，Java 建议对“正常错误情况”使用检查异常，对“由程序员错误导致的运行时错误”使用未检查异常。似乎 Objective-C 异常应该用在你会使用未经检查的异常的地方，并且错误代码返回值或 NSError 值在你将使用检查的异常的地方是首选的。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-11-27T22:23:10.387

我认为要保持一致，最好将@throw 与您自己的扩展 NSException 的类一起使用。然后你在 try catch finally 中使用相同的符号：

```
@try {
.....
}
@catch{
...
}
@finally{
...
} 
```

Apple 在这里解释了如何抛出和处理异常： [Catching Exceptions](http://developer.apple.com/documentation/Cocoa/Conceptual/Exceptions/Tasks/RaisingExceptions.html) [Throwing Exceptions](http://developer.apple.com/documentation/Cocoa/Conceptual/Exceptions/Tasks/RaisingExceptions.html)

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-11-06T21:39:59.180

从 ObjC 2.0 开始，Objective-C 异常不再是 C 的 setjmp() longjmp() 的包装器，并且与 C++ 异常兼容，@try 是“免费的”，但抛出和捕获异常的成本要高得多。

无论如何，断言（使用 NSAssert 和 NSCAssert 宏系列）抛出 NSException，并且将它们用作 Ries 状态是明智的。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-04-19T02:58:20.013

**使用 NSError 来传达失败而不是异常。**

关于 NSError 的要点：

*   NSError 允许 C 风格的错误代码（整数）清楚地识别根本原因，并希望允许错误处理程序克服错误。您可以非常轻松地将来自 SQLite 等 C 库的错误代码包装到 NSError 实例中。

*   NSError 还具有作为对象的好处，并提供了一种使用其 userInfo 字典成员更详细地描述错误的方法。

*   但最重要的是，NSError 不能被抛出，因此它鼓励一种更主动的错误处理方法，这与其他语言相反，后者只是将烫手山芋扔得更远，在调用堆栈上只能报告给用户和没有以任何有意义的方式处理（如果您相信遵循 OOP 的最大信息隐藏原则，则不是）。

参考链接： [参考](https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/nserror_Class/Reference/Reference.html)

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2014-05-12T07:33:34.717

这是我从“The Big Nerd Ranch Guide (4th edition)”中学到的：

```
@throw [NSException exceptionWithName:@"Something is not right exception"
                               reason:@"Can't perform this operation because of this or that"
                             userInfo:nil]; 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2013-01-23T11:04:28.010

您可以使用两种方法在 try catch 块中引发异常

```
@throw[NSException exceptionWithName]; 
```

或第二种方法

```
NSException e;
[e raise]; 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-07-22T17:01:11.770

我相信你永远不应该使用异常来控制正常的程序流程。但是，只要某个值与所需值不匹配，就应该抛出异常。

例如，如果某个函数接受一个值，并且该值永远不允许为零，那么抛出异常而不是尝试做一些“聪明”的事情是可以的......

里斯

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-06-30T09:01:35.573

仅当您发现自己处于指示编程错误并希望停止应用程序运行的情况下才应抛出异常。因此，抛出异常的最佳方法是使用 NSAssert 和 NSParameterAssert 宏，并确保未定义 NS_BLOCK_ASSERTIONS。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-11-09T11:32:31.510

案例示例代码：@throw([NSException exceptionWithName:...

```
- (void)parseError:(NSError *)error
       completionBlock:(void (^)(NSString *error))completionBlock {

    NSString *resultString = [NSString new];

    @try {

    NSData *errorData = [NSData dataWithData:error.userInfo[@"SomeKeyForData"]];

    if(!errorData.bytes) {

        @throw([NSException exceptionWithName:@"<Set Yours exc. name: > Test Exc" reason:@"<Describe reason: > Doesn't contain data" userInfo:nil]);
    }

    NSDictionary *dictFromData = [NSJSONSerialization JSONObjectWithData:errorData
                                                                 options:NSJSONReadingAllowFragments
                                                                   error:&error];

    resultString = dictFromData[@"someKey"];
    ...

} @catch (NSException *exception) {

      NSLog( @"Caught Exception Name: %@", exception.name);
      NSLog( @"Caught Exception Reason: %@", exception.reason );

    resultString = exception.reason;

} @finally {

    completionBlock(resultString);
} 
```

}

使用：

```
[self parseError:error completionBlock:^(NSString *error) {
            NSLog(@"%@", error);
        }]; 
```

另一个更高级的用例：

```
- (void)parseError:(NSError *)error completionBlock:(void (^)(NSString *error))completionBlock {

NSString *resultString = [NSString new];

NSException* customNilException = [NSException exceptionWithName:@"NilException"
                                                          reason:@"object is nil"
                                                        userInfo:nil];

NSException* customNotNumberException = [NSException exceptionWithName:@"NotNumberException"
                                                                reason:@"object is not a NSNumber"
                                                              userInfo:nil];

@try {

    NSData *errorData = [NSData dataWithData:error.userInfo[@"SomeKeyForData"]];

    if(!errorData.bytes) {

        @throw([NSException exceptionWithName:@"<Set Yours exc. name: > Test Exc" reason:@"<Describe reason: > Doesn't contain data" userInfo:nil]);
    }

    NSDictionary *dictFromData = [NSJSONSerialization JSONObjectWithData:errorData
                                                                 options:NSJSONReadingAllowFragments
                                                                   error:&error];

    NSArray * array = dictFromData[@"someArrayKey"];

    for (NSInteger i=0; i < array.count; i++) {

        id resultString = array[i];

        if (![resultString isKindOfClass:NSNumber.class]) {

            [customNotNumberException raise]; // <====== HERE is just the same as: @throw customNotNumberException;

            break;

        } else if (!resultString){

            @throw customNilException;        // <======

            break;
        }

    }

} @catch (SomeCustomException * sce) {
    // most specific type
    // handle exception ce
    //...
} @catch (CustomException * ce) {
    // most specific type
    // handle exception ce
    //...
} @catch (NSException *exception) {
    // less specific type

    // do whatever recovery is necessary at his level
    //...
    // rethrow the exception so it's handled at a higher level

    @throw (SomeCustomException * customException);

} @finally {
    // perform tasks necessary whether exception occurred or not

} 
```

}

* * *

## 回答 #13

> 赞同：-7
> 
> 时间：2010-10-28T23:07:44.073

没有理由不在目标 C 中正常使用异常，甚至表示业务规则异常。苹果可以说使用 NSError 谁在乎。Obj C 已经存在了很长时间，并且曾经所有的 C++ 文档都说了同样的话。抛出和捕获异常的成本有多高并不重要的原因是异常的生命周期非常短，而且......它是正常流程的一个例外。我一生中从未听过任何人说过，这个异常需要很长时间才能被抛出和捕获。

此外，有些人认为目标 C 本身太昂贵，而是用 C 或 C++ 编写代码。所以说总是使用 NSError 是不明智和偏执的。

但是这个线程的问题还没有回答什么是抛出异常的最佳方法。返回 NSError 的方法是显而易见的。

是这样吗： [NSException raise:... @throw [[NSException alloc] initWithName.... 还是 @throw [[MyCustomException... ？

我在这里使用的检查/未检查规则与上面略有不同。

（在此处使用 java 隐喻）检查/未检查之间的真正区别很重要——>您是否可以从异常中恢复。恢复我的意思不仅仅是不崩溃。

所以我使用带有@throw 的自定义异常类来处理可恢复的异常，因为我很可能会有一些应用程序方法在多个@catch 块中查找某些类型的故障。例如，如果我的应用程序是一台 ATM 机，我将为“WithdrawalRequestExceedsBalanceException”设置一个 @catch 块。

我将 NSException:raise 用于运行时异常，因为我无法从异常中恢复，除了在更高级别捕获它并记录它。并且为此创建一个自定义类是没有意义的。

无论如何，这就是我所做的，但如果有更好的、类似的表达方式，我也想知道。在我自己的代码中，自从我很久以前停止编写 C 代码以来，即使我通过 API 传递了一个 NSError，我也从不返回一个 NSError。

# sql-server - XQuery 获取属性列表

> ID：324289
> 
> 赞同：4
> 
> 时间：2008-11-27T17:19:30.530
> 
> 标签：sql-server, xpath, xquery

如果我`Section`在一个 XML 文档中有多个元素，我应该使用什么 XQuery 来获取所有`name`值的列表？

```
<Section name="New Clients" filePath="XNEWCUST.TXT" skipSection="False"> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-27T17:43:26.833

在 XPath 2.0（它是 XQuery 的一个子集）中，可以使用以下表达式来获取“Section”元素的“name”属性的所有字符串值的序列：

```
for $attr in //Section/@name
 return string($attr) 
```

请注意，使用“//”缩写通常是一种不好的做法，因为这可能需要遍历整个（子树）。在文档结构已知的任何情况下，都应该首选更具体的 XPath 表达式（例如使用特定位置步骤的表达式）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T18:16:18.467

```
//Section/@name 
```

或者

```
//Section/@name/string(.) 
```

对于字符串值

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T17:23:24.050

```
 /Section/@name 
```

# javascript - “剪切和粘贴” - 使用 Javascript 在 DOM 中移动节点

> ID：324303
> 
> 赞同：47
> 
> 时间：2008-11-27T17:26:30.830
> 
> 标签：javascript, dom

我的 html 代码大致如下所示：

```
<div id="id1">
  <div id="id2">
    <p>some html</p>
    <span>maybe some more</span>
  </div>
  <div id="id3">
    <p>different text here</p>
    <input type="text">
    <span>maybe even a form item</span>
  </div>
</div> 
```

显然还有更多的东西，但这是基本的想法。我需要做的是切换#id2和#id3的位置，所以结果是：

```
<div id="id1">
  <div id="id3">...</div>
  <div id="id2">...</div>
</div> 
```

有谁知道可以读取和写入两个节点（及其所有子节点）以交换它们在 DOM 中的位置的功能（我确定我不是第一个需要此功能的人）？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-11-27T17:29:37.313

在这种情况下，`document.getElementById('id1').appendChild(document.getElementById('id2'));`应该做的伎俩。

更一般地，您可以使用[`insertBefore()`](https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2017-10-05T22:26:02.953

这个函数接受传入的任何节点，并用给定的标签包装它。在示例代码片段中，我用一个 section 标签包裹了一个 span 标签。

```
function wrap(node, tag) {
  node.parentNode.insertBefore(document.createElement(tag), node);
  node.previousElementSibling.appendChild(node);
} 
```

```
function wrap(node, tag) {
  node.parentNode.insertBefore(document.createElement(tag), node);
  node.previousElementSibling.appendChild(node);
}
let toWrap = document.querySelector("#hi");
wrap(toWrap, "section");
console.log(document.querySelector("section > #hi"), " section wrapped element");
```

```
<span id="hi">hello there!</span>
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-08-03T14:41:42.197

您可以使用 [insertAdjacentElement](https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentElement)而不是对`appendChild`元素相对于目标元素的位置进行更多控制。

语法：`targetElement.insertAdjacentElement(position, element)`. 它有四个位置代码：

*   'beforebegin'：在 targetElement 本身之前。
*   'afterbegin'：就在 targetElement 内部，在它的第一个子元素之前。
*   'beforeend'：就在 targetElement 内部，在它的最后一个子元素之后。
*   'afterend'：在 targetElement 本身之后。

它显示为：

```
//beforebegin
<p>
  //afterbegin
  foo
  //beforeend
</p>
//afterend 
```

在您的情况下，您可以将代码编写为：

```
document.getElementById('id2').insertAdjacentElement('beforebegin', document.getElementById('id3')); 
```

请注意，这样，您不需要引用父（容器）元素！

还要考虑你有比 id2、id3 更多的元素，例如：id4、id5、id6。现在，如果你想在 id2 之后重新定位例如 id5，它很简单：

```
function changePosition() {
   document.getElementById('id2').insertAdjacentElement('afterend', document.getElementById('id5'));
}
```

```
<div id='container'>
  <div id='id1'>id1</div>
  <div id='id2'><u>id2</u></div>  
  <div id='id3'>id3</div>  
  <div id='id4'>id4</div>  
  <div id='id5'><b>id5</b></div>  
  <div id='id6'>id6</div>  
</div>

<p><input type='button' onclick="changePosition()" value="change position"></p>
```

# php - 如何使用 preg_split 在 2 个句子后截断 RSS 提要描述？

> ID：324306
> 
> 赞同：1
> 
> 时间：2008-11-27T17:27:55.943
> 
> 标签：php

我想对位于 $the_content 中的 RSS 提要进行描述，并使用 preg_split 在 2 个完整句子（或 200 个单词，然后是下一个完整句子）后将其切断。

我尝试了几次，但我已经走了。我知道我想做什么，但我似乎什至无法开始做一些事情来完成这项工作。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T19:48:50.167

正确拆分 HTML 非常棘手，不值得使用正则表达式。如果你想要 HTML，像[DOM 文本迭代器](http://pornel.net/source/domlettersiterator.php)之类的东西会很有用。

1.  将描述转换为文本：

    ```
    $text = html_entities_decode(strip_tags($html),ENT_QUOTES,'UTF-8'); 
    ```

2.  这将需要前 200 个字符（200 个单词对于一个句子来说有点太多了，不是吗？），然后寻找句子的结尾：

    ```
    $text = preg_replace('/^(.{200}.*?[.!?]).*$/','\1',$text); 
    ```

您可以更改`[.!?]`为更复杂的内容，例如标点符号后需要空格或要求附近没有标点符号：

```
 (?<![^.!?]{5})[.!?](?=[^.!?]{5}) 
```

`(?=…)`是肯定断言。`(?<!…)`看起来落后于当前位置的否定断言。`{5}`意思是5次。

我还没有测试过:)

# haskell - Haskell 中的符号简化（使用递归？）

> ID：324311
> 
> 赞同：1
> 
> 时间：2008-11-27T17:30:19.277
> 
> 标签：haskell, functional-programming

我怎样才能给出一个包含以下所有表达式的一般规则？例如，一个表达式，另一个用于 sub 和一个用于 mult。我需要使用递归，但我很困惑......

```
simplify :: Expr->Expr

simplify (Mult (Const 0)(Var"x"))
 = Const 0 
simplify (Mult (Var "x") (Const 0))
 = Const 0
simplify (Plus (Const 0) (Var "x")) 
= Var "x"
simplify (Plus (Var "x") (Const 0))
 = Var "x" 
simplify (Mult (Const 1) (Var"x")) 
= Var "x"
simplify (Mult(Var"x") (Const 1))
 = Var "x" 
simplify (Minus (Var"x") (Const 0))
 = Var "x"
simplify (Plus (Const x) (Const y)) 
= Const (x + y)
simplify (Minus (Const x) (Const y))
= Const (x - y)
simplify (Mult (Const x) (Const y))
 = Const (x * y)
simplify x = x 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-27T20:03:19.623

首先：我对 Haskell 知之甚少，我在这门语言上花费的总时间在 5 年左右的时间里不超过 8 个小时，尽管我已经阅读了很多关于该语言的内容。因此，请原谅我毫无疑问的可怕风格。

我解决了这个问题，因为它看起来像是一种进入一点 Haskell 编程的简单方法。首先，我制作了一个受样本启发的数据类型：

```
data Expr = Const Int | Mult Expr Expr | Plus Expr Expr | Var String 
```

我让它比原来的简单一点，并省略了减号，但除此之外都是一样的。

我很快发现使用例如“Const 4”构造的值不能用上面的方法打印，因为没有适用的显示功能。我将 Expr 设为 Show 类型类的实例，并提供了 show 的简单定义，同时考虑了运算符优先级：

```
instance Show Expr where
    show (Const n) = show n
    show (Var n) = show n
    show (Plus a b) = (show a) ++ "+" ++ (show b)
    show (Mult a b) = "(" ++ (show a) ++ ") * (" ++ (show b) ++ ")" 
```

接下来是简化任务本身。正如格洛梅克所暗示的那样，尝试在一个函数中使用模式匹配来评估所有内容存在问题。

具体来说，对于任何给定的操作（示例中的所有操作都是二元的），您希望首先简化左树，然后是右树，然后根据这些子树评估的内容简化当前 Expr；例如，如果两者都简化为 Const，那么您可以用评估的操作替换整个子树。但是，模式匹配会迫使您根据直接节点的子节点来选择要做什么，而不是子树在简化后返回的内容。

因此，要让模式匹配完成决定是否将当前节点作为常量子表达式求值的工作，重要的是简化子树，然后基于简化的整体进行调度。

我使用一个名为 eval 的单独函数来做到这一点，其目的是对可以减少的事物进行模式匹配，假设子树已经减少。它还处理 0 和 1 的乘法，以及 0 的加法：

```
-- Tries to evaluate any constant expressions.
eval :: Expr -> Expr
eval (Mult (Const a) (Const b)) = Const (a * b)
eval (Mult (Const a) b)
    | a == 0 = Const 0
    | a == 1 = b
    | otherwise = (Mult (Const a) b)
eval (Mult a (Const b))
    | b == 0 = Const 0
    | b == 1 = a
    | otherwise = (Mult a (Const b))
eval (Plus (Const a) (Const b)) = Const (a + b)
eval (Plus (Const a) b)
    | a == 0 = b
    | otherwise = (Plus (Const a) b)
eval (Plus a (Const b))
    | b == 0 = a
    | otherwise = (Plus a (Const b))
eval e = e 
```

现在我有了 eval，并且我知道在表达式树的顶层调用是安全的（即它不会无限递归），我可以在简化子树后从 simple 中调用它：

```
-- Tries to match evaluation rules after simplifying subtrees.
simplify :: Expr -> Expr
simplify (Plus a b) = eval (Plus (simplify a) (simplify b))
simplify (Mult a b) = eval (Mult (simplify a) (simplify b))
simplify e = e 
```

此版本的简化有许多限制：它不会将乘法分布在非 Const 子树上，它不会重新排序表达式以将常量表达式组合在一起（因此 1+a+2 的等价物不会简化为a+3) 等。但是，它完成了基本工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T17:52:55.003

当您需要处理嵌套表达式时，递归就会出现。例如，您如何简单地（加（加 2 3）（加 4 5））？

一种方法是将其分解为两个功能。将一层逻辑（您在上面显示）移动到它自己的函数中。主要的简化函数可能有一个类似于以下 Plus 的规则：

```
simplify (Plus x y) = simplify_one_level (Plus (simplify x) (simplify y)) 
```

# apache-flex - Flex 绑定和 AS3

> ID：324315
> 
> 赞同：2
> 
> 时间：2008-11-27T17:31:59.383
> 
> 标签：apache-flex, binding, degrafa

我在帆布容器中有一个 degrafa 表面。我想链接宽度和高度。当我使用绑定时，它按预期工作：

```
// binding
   BindingUtils.bindProperty(rect,"height",this,"height"); 
   BindingUtils.bindProperty(rect,"width",this,"width"); 
```

现在，有人告诉我应该在 validateSize() 或 updateDisplayList() 上执行此操作，以我目前对 flex 的了解，我真的不知道为什么，但我尝试了以下操作

```
override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void {

    trace(unscaledWidth, unscaledHeight);
    this.width = unscaledWidth;
    rect.width =unscaledWidth;
    this.height = unscaledHeight;
    rect.height = unscaledHeight;

} 
```

degrafa 矩形可以很好地调整大小，但不能很好地调整“this”画布容器。他们似乎没有绑定，我错过了什么吗？

此外，我想稍微修改一下 rect.width = this.width 中的关系，其中包含一些我无法使用 bindproperty 方法做的因素。

非常感谢任何线索。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-04-11T12:59:28.920

您应该在 updateDisplayList 的某个地方调用：

```
super.updateDisplayList(unscaledWidth, unscaledHeight); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T19:49:50.290

以防万一，

更多代码

```
public class RectangleShape extends BaseShape 
{
public function RectangleShape(fillColor:int) {
    super.name = shapeName;
    solidFill.color = fillColor;

    // shape
    solidFill.alpha = 0.3;
    rect.fill = solidFill;
    rect.stroke = solidStroke;    
    geoGroup.geometryCollection.addItem(rect);     
    geoGroup.target = surface;

    surface.graphicsCollection.addItem(geoGroup);  
    this.addChild(surface);

  // binding
  // BindingUtils.bindProperty(rect,"height",this,"height"); 
  // BindingUtils.bindProperty(rect,"width",this,"width"); 
}

 override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void {

    trace(unscaledWidth, unscaledHeight);
    this.width = unscaledWidth;
    rect.width =unscaledWidth;
    this.height = unscaledHeight;
    rect.height = unscaledHeight;

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-11T15:47:37.830

该`updateDisplayList()`方法是您应该调整和定位组件子对象的位置。您不应该设置组件本身的大小（即：不要这样做：）`this.width=100`。

您还可以`updateDisplayList()`使用 Flash 图形 API 在 中进行编程绘图。

`updateDisplayList()`由 Flex 和两个参数调用，`unscaledWidth` 并且`unscaledHeight`是您的组件将呈现的大小。您应该尊重这些尺寸，并根据它们设置组件的子对象的大小。

在 中设置大小时`updateDisplayList()`，不要直接修改宽度/高度属性。这样做会触发更多的 Flex 生命周期方法来执行。而是使用`setActualSize()`子组件的方法。

设置子对象的 x/y 属性也是如此。不要直接设置，使用`move()`方法。

最后，在 Flex 4 中，他们为 Spark 组件添加了一些类似的生命周期方法。尽可能使用它们：`setLayoutBoundsSize()`, `setLayoutBoundsPosition()`.

这是您的原始`updateDisplayList()`文件，按上述修改：

```
override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void {

    trace(unscaledWidth, unscaledHeight);

    // like Janroel said above, you should call the super class method
    // the only time you don't need to is when your component extends UIComponent
    // (because UIComponent's updateDisplayList doesn't do anything)
    super.updateDisplayList(unscaledWidth, unscaledHeight);

    // don't do this (your component will get sized by its parent)
    //this.width = unscaledWidth;
    // if 'rect' inherits from UIComponent you should use the setActualSize() method:
    rect.setActualSize(unscaledWidth, unscaledHeight);
    // if it doesn't inherit from UIComponent, do it the regular way...
    rect.width =unscaledWidth;
    //this.height = unscaledHeight;
    rect.height = unscaledHeight;
} 
```

# c# - c# databound ComboBox : InvalidArgument=Value of '1' 对 'SelectedIndex' 无效

> ID：324331
> 
> 赞同：5
> 
> 时间：2008-11-27T17:40:04.420
> 
> 标签：c#, winforms, combobox

我在运行时添加到表单的绑定 ComboBox（在 Windows 表单上）上设置 SelectedIndex 时遇到问题，我怀疑发生了一些奇怪的事情。

当我尝试这个时，我收到错误“InvalidArgument='1' 的值对'SelectedIndex' 无效。”

```
private void Form1_Load(object sender, EventArgs e)
        {
            List<string> comboBoxList = new List<string>();
            comboBoxList.Add("Apples");
            comboBoxList.Add("Oranges");
            comboBoxList.Add("Pears");

            ComboBox comboBox1 = new ComboBox();
            comboBox1.DataSource = comboBoxList;
            comboBox1.SelectedIndex = 1;
            this.Controls.Add(comboBox1);
        } 
```

但是，如果我直接将项目添加到 ComboBox 中，则没有问题，如下所示：

```
comboBox1.Add("Apples"); 
```

此外，如果我在设置 SelectedIndex 之前将控件添加到表单中，也没有问题，如下所示：

```
ComboBox comboBox1 = new ComboBox();
this.Controls.Add(comboBox1);
comboBox1.DataSource = comboBoxList;
comboBox1.SelectedIndex = 1; 
```

谁能解释为什么在将控件添加到表单之前我不能从数据源设置选定的索引？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-27T18:01:29.043

我的理解是数据绑定通常由绑定上下文处理，这是父表单绑定上下文。因此，在将组合框添加到表单之前，不会发生数据源绑定。如果您将组合框的 bindingcontext 设置为表单绑定上下文，您也可以让它工作。

```
comboBox1.BindingContext = this.BindingContext;
comboBox1.DataSource = comboBoxList;
comboBox1.SelectedIndex = 1;
this.Controls.Add(comboBox1); 
```

[BindingContext 类](http://msdn.microsoft.com/en-us/library/system.windows.forms.bindingcontext.aspx)

[什么是 BindingContext](http://windowsclient.net/blogs/faqs/archive/2006/07/12/what-is-bindingcontext.aspx)

# asp.net - 最好的 asp.net 日历/时间表组件？

> ID：324334
> 
> 赞同：8
> 
> 时间：2008-11-27T17:41:33.530
> 
> 标签：asp.net, calendar

我正在寻找最好的 asp.net 日历/时间表组件。我喜欢谷歌日历的外观，它绝对需要是一个原生的.net组件，可以自定义。

我不介意它是否是更大框架的一部分（例如telerik）。链接到样本会很棒。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T08:52:40.800

如果你真的在寻找最好的，你需要看看我的 ;-)

DayPilot Lite（开源）：

[http://www.daypilot.org/demo/Lite/](http://www.daypilot.org/demo/Lite/)

DayPilot Pro（商业版）：

[http://www.daypilot.org/demo/Calendar/GoogleLike.aspx](http://www.daypilot.org/demo/Calendar/GoogleLike.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-23T15:07:43.217

[Telerik](http://www.telerik.com/)的 ASP.NET 控件非常好。

它们提供 ASP.NET AJAX 和 ASP.NET MVC 控件。

日历： [http ://demos.telerik.com/aspnet-ajax/calendar/examples/overview/defaultcs.aspx](http://demos.telerik.com/aspnet-ajax/calendar/examples/overview/defaultcs.aspx)

调度程序： http: [//demos.telerik.com/aspnet-ajax/scheduler/examples/overview/defaultcs.aspx](http://demos.telerik.com/aspnet-ajax/scheduler/examples/overview/defaultcs.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-16T01:48:15.533

根据您尝试执行的操作，[BaseCalendar](http://basecalendar.codeplex.com/)可能对您有用。它没有调度程序，但它是高度可定制的。项目中包含一些演示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T19:48:07.703

查看 ComponentOne 的 WebSchedule 和 WebCalendar 现场演示：[http ://helpcentral.componentone.com/c1webexamples/](http://helpcentral.componentone.com/c1webexamples/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T02:44:49.160

DevExpress 目前有 60 个免费控件：

[http://www.microsoft.com/web/content.aspx?id=15-helpful-in-browser-web-development-tools](http://www.microsoft.com/web/content.aspx?id=15-helpful-in-browser-web-development-tools)

我不确定日历是否包含在其中，但他们确实有一个，您可以尝试一下。

安东尼， [www.codersbarn.com](http://www.codersbarn.com) :-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-12T14:25:54.817

尝试[web2cal](http://web2cal.com)。这是相当不错的。外观漂亮，易于定制

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-23T15:03:35.053

ComponentOne Schedule 和 Calendar 真的很容易使用。它们可以放在表单上并通过单个属性相互连接。此外，调度程序带有内置的 xml 数据存储，因此无需任何代码即可使其工作！

查看此[调度程序和日历示例](http://demo.componentone.com/aspnet/controlexplorer/C1Schedule/CalendarNavigation.aspx)

# c# - 从 Constructor 调用工厂以获取“this”的新版本

> ID：324341
> 
> 赞同：3
> 
> 时间：2008-11-27T17:44:19.093
> 
> 标签：c#, constructor

我可能会倒退……我有一个类似于文档的类和另一个类似于模板的类。它们都继承自同一个基类，我有一个从模板（或从另一个文档，它在基类中的方法）创建新文档的方法。因此，如果我想从模板创建一个新文档，我只需实例化模板并在其上调用 GetNewDoc()；

```
Document doc = mytemplate.GetNewDoc(); 
```

在 Document 类中，我有一个空白构造函数来创建一个新的空白文档，以及另一个接受文档 ID 的构造函数，这样我就可以从数据库中加载文档。但是，我还想要一个带有模板 ID 的构造函数。这样我可以做到

```
Document doc = New Document(TemplateID) 
```

因为模板类已经有能力返回一个文档，我希望构造函数做类似的事情

```
Template temp = new Template(TemplateID);
this = temp.GetNewDoc(); 
```

当然，我不能这样做，因为“this”是只读的——而且感觉很奇怪。我觉得我在这里很愚蠢，所以请随意大喊:)

问题是有问题的对象非常复杂，有几个子对象集合和多个表上的数据库持久性，所以我不想复制太多代码。不过，我想我可以从模板中获取新文档，然后复制字段/属性，因为集合应该很容易遵循 - 这看起来像是重复。

更详细的代码示例：

 `````
using System;
using System.Collections.Generic;
using System.Text;

namespace Test
{
class Program
{
    static void Main(string[] args)
    {
        // This just creates the object and assigns a value
        Instance inst = new Instance();
        inst.name = "Manually created";
        Console.WriteLine("Direct: {0}", inst.name);

        //This creates a new instance directly from a template
        MyTemplate def = new MyTemplate();
        Instance inst2 = def.GetInstance(100);
        Console.WriteLine("Direct from template: {0}", inst2.name);

        Instance inst3 = new Instance(101);
        Console.WriteLine("Constructor called the template: {0}", inst3.name);
        Console.ReadKey();

    }
}

public class Instance
{
    public string name;

    public Instance(int TemplateID)
    {
        MyTemplate def = new MyTemplate();
        //If I uncomment this line the build will fail
        //this = def.GetInstance(TemplateID);
    }

    public Instance()
    {
    }
}

class MyTemplate
{
    public Instance GetInstance(int TemplateID)
    {
        Instance inst = new Instance();
        //Find the template in the DB and get some values
        inst.name = String.Format("From template: {0}", TemplateID.ToString());
        return inst;
    }
}
} 
````  `* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-27T17:55:00.787

如果您希望能够仅从构造函数中的代码创建新对象以外的任何事情，请不要首先使用构造函数。

你真的需要一个带有 int 的 Instance 构造函数吗？为什么不把它变成静态工厂方法：

```
public static Instance CreateInstance(int id)
{
    MyTemplate def = new MyTemplate();
    return def.GetInstance(id);
} 
```

静态方法相对于构造函数有很多优点——尽管也有一些缺点。（对此有一个[单独的 SO 问题](https://stackoverflow.com/questions/194496)- 值得一看。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T17:57:26.617

您不能从构造函数或任何其他方法重新创建“this”。您可以创建另一个对象并复制内容，但我会将工厂公开。定义一个具有三个 createDocument() 方法的工厂类，一个用于空白文档，一个用于来自数据库的文档，第三个来自模板：

```
public class Factory {
   public static Document createBlankDocument();
   public static Document createDocument( DocumentId id );
   public static Document createDocumentFromTemplate( TemplateId id );
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T18:41:00.930

我和 Jon 在一起，使用工厂方法要好得多，因为这对开发人员来说非常清楚正在发生的事情（*不仅仅是*创建一个新对象）。

工厂方法对程序员说，“这里发生了一些特殊的初始化，使用**new**不够好”。

通常，当您想要回收或缓存资源时，您会使用工厂，相反，当您使用**new**关键字时，您不会期望回收或缓存的资源；你期待一个全新的资源（它直接融入关键字）:)

# .net - 奇怪的 Firefox 输入错误

> ID：324344
> 
> 赞同：3
> 
> 时间：2008-11-27T17:46:57.777
> 
> 标签：.net, firefox, input, httpmodule

我对此有点吃惊，所以我想知道是否有任何 SOers 以前遇到过它。

我有一个基本平坦的页面，在标记中播种了许多 input=text，默认值依次为 A、B、C、D、E。标记在查看源代码中如下所示：

```
<td class="action invoice">
  <a href="#foo">Toggle Invoice</a>
  <div class="data">
    <input type="text" class="formatted" value="A" />
    <a href="#" class="notes" title="Add Note">Add Note</a>
  </div>
</td> 
```

迭代多行 A->E。

该页面由 ASP.NET 2.0 应用程序创建。版本 1 仅仅是“user.aspx?id=1” 版本 2 是由 RESTlike HTTPModule 在内部从“users/1”映射到“user.aspx?id=1”的路径。

版本 1 很好。*渲染后*的版本 2让我输入的值可重复地按 E、A、B、D、E 的顺序排列，但我看不出这个顺序的原因。

我可以查看源代码并且 value="X" 是正确的，并且在 firebug 中的 DOM 检查中*defaultValue*是正确的，但*值*不是。

*   这不是 CSS 问题 - CSS 已从页面中删除。
*   这不是 JS 问题 - JS 已关闭。
*   这不是 HTML 问题 - 标记在所有情况下都是完全相同的。

唯一的区别是如何请求标记。就好像 Firefox 以某种方式与服务器发生了量子纠缠。

有没有人*听说过*这样的事情？我惊呆了。

**编辑**：这也绝对是一个 FF 问题。IE、Opera 和 Chrome 都可以正常使用该页面。

**编辑2**：我的字面意思是请求的路径。一个版本是对*[http://localhost/user.aspx?id=1](http://localhost/user.aspx?id=1)*的请求，另一个（失败的）版本是对*[http://localhost/users/1](http://localhost/users/1)*的请求，该版本由 HTTPModule 映射到第一个路径。name= 无济于事，因为默认值不是人工输入的，它们在源中提供。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T21:30:07.447

我敢打赌，它与映射的 url 没有文件扩展名有关，因此 Firefox 没有正确推断出内容类型。尝试在 ASP 代码中将内容类型显式设置为“text/html”，看看是否可以修复它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T18:04:52.453

你是说C,A,B,D,E吗？我敢打赌，属性中未加引号或不匹配的 " 会弄乱 C 的 td 标签解析。当表中的标签未正确包含在 tr/td/etc 中时，firefox 会将其移至前面的页。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T08:51:53.190

你说：“唯一的区别是如何请求标记。” 你能扩展一下吗？这是某种 DHTML 交付，还是工作和非工作情况都是完整的 HTML 页面？

添加不同的 name="" 参数有帮助吗？在某些情况下，当您返回上一页时，Firefox 确实会尝试保留以前输入的值，而且我之前看到它在出现名称冲突时会感到困惑。

编辑：你说名字无济于事，但你试过了吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T15:32:03.650

我还没有完全找到解决方案，它的可重复性似乎取决于我尚未确定的某些因素，但我有一些偶然的证据表明这似乎是FF 中发生的事情的组合（可能是对内容的回应*）*另一个选项卡 - 投机）和***相关页面没有严格的文档类型***。

我会保持打开状态，以防其他人遇到并找到这个奇怪的小精灵的原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-18T20:48:26.297

Firefox 非常积极地在刷新和后退/前进导航之间保存表单数据。

我想我会尝试`autocomplete="off"`在表单输入中添加一个属性，看看是否有帮助。

我认为 Firefox 可能会将当前 URI 与引用 URI 进行比较，以查看它应该如何处理它保存的表单数据。在您的第二个示例中，两者不匹配。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T02:07:51.330

如果您可以创建一个重新创建的案例并将其提交给 Firefox 团队的[错误报告](https://bugzilla.mozilla.org/)，以便他们可以修复它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-01T02:10:42.150

通过[HTML Validator](http://validator.w3.org/)运行您的代码，以查看是否有任何缺失的语法片段导致其呈现怪异。

# language-agnostic - 怎样才能克制住自己想要重写一切的压倒性冲动？

> ID：324346
> 
> 赞同：44
> 
> 时间：2008-11-27T17:47:49.507
> 
> 标签：language-agnostic

## 设置

您是否有过这样的经历：进入一段代码进行看似简单的更改，然后意识到您刚刚踏入了一个值得认真关注的荒地？这通常会伴随着官方的**FREAK OUT**时刻，在那里重写所有眼前的一切的压倒性感觉开始蔓延。

*重要的是要注意，这些糟糕的代码不一定来自其他人，因为它可能确实是我们过去编写或贡献过的东西。*

## 问题

很明显，有一些严重的代码腐烂、可怕的架构等需要处理。与这个问题相关的真正问题是，**现在不是重写代码的正确时机**。这可能有很多原因：

*   目前处于发布周期的中间，因此任何更改都应该是最小的。
*   现在是凌晨 2:00，大脑开始关闭。
*   它可能对时间表产生看似不利的影响。
*   兔子洞可能比我们此时的眼睛所能看到的要深得多。
*   ETC...

## 问题

那么我们应该如何平衡不断改进代码的责任，同时也是一个负责任的开发者呢？我们如何避免为[破窗理论](http://www.codinghorror.com/blog/archives/000326.html)做出贡献，同时也意识到行动及其可能导致的潜在鲁莽？

* * *

## 更新

很好的答案！在大多数情况下，似乎有两种思想流派：

1.  不要抗拒这种冲动，因为拥有它是一件好事。
2.  不要屈服于诱惑，因为它会把你烧到地上。

知道是否有更多的人觉得存在任何平衡会很有趣。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-27T18:04:26.010

我是制作清单的忠实粉丝！

一旦冲动让你重写一些东西——花 10 分钟列出需要重写的东西。跟随所有可以让您进一步了解需要注意的代码的小巷，并列出这些小巷。

希望在相对较短的时间内，您将拥有以下两件事之一：

*   一个非常长的列表，完全让你不想再重写任何东西。
*   一个实际上并没有那么长的列表，所以为什么不放纵自己去重写呢？！

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-27T18:01:42.647

我发现花两个月的时间来修复由我的“无害”重写引起的错误足以治愈我在没有明确的授权/项目计划的情况下做这些事情的冲动。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-27T18:27:03.373

对我来说最难忘的此类项目发生在大约 4 年前，当时我被叫到远程办公室“帮助”一个项目，该项目将在 1 周内向客户进行主要演示，但根本没有工作。该项目主要转移到印度和 IMO，项目管理失败导致大量意大利面条代码过于分散，无法以目前的形式正常工作。

经过一整天的审查，我向管理层提出了我的意见，即该项目只需要大规模重构和重组，否则将永远无法正常工作。这次讨论的结果是 6 天 20 小时工作 / 4 小时睡眠，其中 2 天我实际上是在公司大堂的沙发上睡的，因为我在开车回酒店时浪费了时间。

代码的主要改进包括：

*   命名标准的应用
*   移至源代码控制
*   开发构建过程
*   单个组件的文档

大多数原始代码都保留在原地，但只是移动和重组/重构以使其长期可持续。这是地狱周吗？当然。它是否使项目更成功？是的。

我无法忍受意大利面条式代码，我经常会贡献自己的个人时间来解决它。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-27T20:30:03.500

> 怎样才能克制住自己想要重写一切的压倒性冲动？

变老*

由于发生在我身上，我逐渐失去了重写一切的冲动。为什么？

*   一旦你做了几次，你就会意识到你最终的结果往往比开始时更糟。
*   即使您是上帝赐予您的编程天赋，并且您出色的重写没有引入新的错误，您也将无法注意到或实现大约 30% 的事物所依赖的小型边缘案例功能/错误。这将花费您数月的时间来修复
*   没有什么比时间更能磨灭你的非理性繁荣了。通常这是一个可悲的损失，但在这种情况下，这是一场胜利。

*（如果您没有空闲时间变老，更多经验也可能是合适的替代品）

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-27T17:59:08.190

重写的冲动是正义的，前提是：

*   您“冻结”现有代码（带有标签）
*   您在单独的分支中开始重写尝试
*   您首先准备一些单元测试以确定当前行为并确保重现现有功能...

也就是说，您必须在重写过程与遗留代码的测量稳定性之间取得平衡。
“如果它没有损坏，请不要修复它”;）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-27T19:24:32.947

这不是一个完整的答案，但阅读漂亮的文章 *[The Narcissism of Small Code Differences](http://weblog.raganwald.com/2008/05/narcissism-of-small-code-differences.html)*可能会有所帮助。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-11-27T19:17:04.053

你是绝对正确的，有一个正确的时间和一个错误的时间来重写（和破坏）代码。

让我想起了我认识的一位工程师，他有一个习惯，只要他愿意，他就会潜入并进行重大改写。这让他的产品的 QA 人员陷入了困境——如果他报告了一个关于微不足道的 bug，那么这个 bug 就会得到修复，但是工程师在修复一个 bug 时对他注意到的内容的主要重写会引入另外 50 个*新的*bug，这然后质量检查人员需要追踪。

因此，消除重写的诱惑的一种方法是站在 QA 工程师的立场上走一英里，他们必须测试、诊断和报告所有这些新错误。甚至可以将自己借给 QA 部门几个月，以了解他们所做的工作类型（如果您从未这样做过）。

另一个建议是为自己制定一条规则，写下笔记来描述任何变化。当您签入对源代码控制的代码更改时，可能会发布这些注释。您可能会被激励以这种方式尽可能地进行较小的更改。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-11-27T18:01:24.033

只是不要 - 兔子洞总是太深。进行任何小的局部更改，使该地方比您找到的地方更干净，但是当您保持警惕并有足够的时间进行刻录时，请进行大的重构。

在[sourcemaking.com](http://sourcemaking.com/refactoring/the-nature-of-the-game)上解决小阶段大重构的一个很好的开始：

> 你必须像汉塞尔和格莱特一样，在边缘啃咬，今天一点，明天再多一点

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-11-27T18:08:16.267

1.  重读“重构”。
2.  拿一张纸，逐条列出“难闻的气味”清单。
    （对于 BadSmells() 中的每一种气味 {
    打印气味名称；
    }
3.  向代码添加注释，包括列表中的项目。
    而（气味持久（））{
4.  仔细研究清单，一次专注于一种气味。
    }

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-11-27T20:21:38.870

就个人而言，这就是 JIRA 或 Bugzilla 等错误跟踪软件与我一起使用的地方。

当我看到所有破损的窗户时，我很难不修理它们，但如果情况足够糟糕（并且时间允许），我会开一张票并将其分配给我或分配给负责的小组，这样我不要偏离正题。

——我只做他们需要做的事情，但问题已记录在案并将及时修复。

——这并不是说小破窗就应该这样处理；小问题应始终联系恕我直言。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-27T18:04:59.987

就我而言，如果你没有比重写代码更好的事情要做，那么你应该让其他人都知道，然后**去做**。显然，如果要花费数天时间才能获得任何结果，并且更改将意味着过多的停机时间，那么这不是一个好主意，但最终该代码将成为一个问题。让其他人意识到代码很糟糕，并尝试采取某种行动来重写它。

上述陈述的问题在于，作为程序员/开发人员，您**总是**有其他事情让自己忙起来。只需将其留在待办事项的低优先级列表中，因此当您在某些工作上苦苦挣扎时，您可以始终保持您的节奏与重写。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-27T19:23:58.300

我从来没有在任何特别敏捷的地方工作过，所以我所做的是：

1）弄清楚是否存在不涉及重大重写的合理修复。如果不是，那么请清理一些时间（也许通过向其他人解释修复的难度）并进行重写。

2）有一个合理的修复，无需重大重写。应用修复，运行测试，签入，将错误标记为已修复。

3）现在，提出一个新的错误/问题（增强请求），概述提议的重写以及它将如何改进代码（更简单？更易于维护？减少耦合？影响性能或资源使用？）。把它分配给我自己，CC 任何对那段代码感兴趣的人。

4) 让人们有机会发表评论，然后在我现有的任务中优先考虑新的错误。这通常意味着现在不要这样做，因为大多数时候如果我有一个“适当的”错误要修复，那么我至少有两个。一旦清除了关键列表，或者下次我需要做一些不无聊的事情时就去做。或者也许几天后它似乎不再值得做，而且它不会完成，我已经节省了我本来应该花在做它的时间。

我认为，重要的是避免每次修复小错误时都要[刮牦牛毛。](http://sethgodin.typepad.com/seths_blog/2005/03/dont_shave_that.html)

权衡是，如果你要重写的代码*真的很*糟糕，那么重写的优先级很容易被低估，你最终会花费大量时间来维护它，以至于你没有时间用需要较少的维护。这需要牢记。但是，无论重写应该是什么优先级，或者您的组织如何分配这些优先级，在同一代码区域修复不良设计*都不是一回事*作为纠正导致您最初处理的崩溃的一个错误。这必须在第 1 步考虑：如果设计意味着代码中可能潜伏着一大堆其他的错误，那么仅仅修复这个错误可能是不“合理的”。如果它确实是一个错字，但你碰巧发现了一个重构机会，因为你打开了文件，那么更正它并且不触及其他任何东西是“合理的”。

显然，您的商店越敏捷，您可以进行的重构就越重要，而不会造成破坏性/耗时/政治性以至于需要单独的任务。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-11-27T19:30:00.330

Joel 有[一篇](http://www.joelonsoftware.com/articles/fog0000000069.html)关于此的文章：

> 程序员总是想扔掉代码并重新开始是有一个微妙的原因。原因是他们认为旧代码一团糟。这是一个有趣的观察：*他们可能是错的*。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-27T20:37:54.420

如果它是您继承的某些代码，请开始制作您自己的代码。编写单元测试，然后重构。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-11-27T23:09:01.277

编写更多单元测试只是为了发现代码运行得非常好。

如果您仍然有重写它的冲动，您将进行一些测试以发现您的重写代码现在失败了；）

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-27T17:55:19.023

坏代码不是可以完全避免的，但可以通过适当的抽象来隔离。如果确实是荒地，也就是说周围没有垃圾填埋场，那么专注于设计过程比试图让人们编写完美的代码更有效。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-27T18:29:42.620

我不认为你应该阻止自己这样做。大多数情况下，如果您感觉要进行大改写，那么这样做几乎是正确的。在这件事上，我非常不同意乔尔·斯波尔斯基的观点……

虽然这是我不同意他的*少数几个*地方之一......；）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-11-27T20:06:51.613

当它足够好时停止重写。为此，您需要知道什么好的计划不仅适合您的雇主，而且适合您。毕竟你做编程是为了生活而不是为了好印象。制定合理的标准，真正告诉你你很好，结果是下降，是时候进行下一个任务了。你应该喜欢你的程序，而不是你的老板喜欢它们。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-05-28T18:46:00.933

仅当您的老板/公司确实鼓励它时才进行重构，否则您最终会经常花费额外的时间来完善代码......直到有人不那么敬业的人再次触及它。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-05-28T19:02:02.167

开始假设：您已经“尽早提交，经常提交”。

那么*开始*重构永远不会是一个糟糕的时机，因为您可以在任何时候轻松退出。我发现一开始总觉得这很容易，但是在做了一些改变并看到效果之后，我开始意识到这将是一项艰巨的工作。是时候询问是否真的有时间进行更改，或者是否在下次使用此代码之前继续使用它是更好的方法。

愿意停下来，丢弃一个重构了一半的分支，并在适当的时候以令人讨厌但快速的方式去做，这是关键。

那是为了重构，其中更改是增量的，并且运行（或几乎运行）的软件可以让您保持良好的基础。重写是不同的，因为直到你弄清楚它需要的时间比你想象的要长得多。我可能过于从字面上理解了这个问题，但几乎从来都不是把它扔掉并重新开始的好时机。

# c - 拆分链表

> ID：324353
> 
> 赞同：1
> 
> 时间：2008-11-27T17:52:48.607
> 
> 标签：c, data-structures, linked-list

为什么这个程序中的拆分列表总是空的？（它来自链接列表上的[维基百科](http://en.wikipedia.org/wiki/Linked_List#Language_support)页面上的代码。）

```
/* 
    Example program from wikipedia linked list article
    Modified to find nth node and to split the list
*/

#include <stdio.h>
#include <stdlib.h>

typedef struct ns
{
    int data;
    struct ns *next; /* pointer to next element in list */
} node;

node *list_add(node **p, int i)
{
    node *n = (node *)malloc(sizeof(node));
    if (n == NULL)
        return NULL;

    n->next = *p; //* the previous element (*p) now becomes the "next" element */
    *p = n;       //* add new empty element to the front (head) of the list */
    n->data = i;

    return *p;
}

void list_print(node *n)
{
    int i=0;
    if (n == NULL)
    {
        printf("list is empty\n");
    }
    while (n != NULL)
    {
        printf("Value at node #%d = %d\n", i, n->data);
        n = n->next;
        i++;
    }
}

node *list_nth(node *head, int index) {
    node *current = head;
    node *temp=NULL;
    int count = 0; // the index of the node we're currently looking at
    while (current != NULL) {
        if (count == index)
            temp = current;
        count++;
        current = current->next;
    }
    return temp;
}
/* 
This function is to split a linked list:
Return a list with nodes starting from index 'int ind' and
step the index by 'int step' until the end of list.
*/
node *list_split(node *head, int ind, int step) {
    node *current = head;
    node *temp=NULL;
    int count = ind; // the index of the node we're currently looking at
    temp = list_nth(current, ind);
    while (current != NULL) {
        count = count+step;
        temp->next = list_nth(head, count);
        current = current->next;
    }

    return temp; /* return the final stepped list */
}

int main(void)
{
    node *n = NULL, *list1=NULL, *list2=NULL, *list3=NULL, *list4=NULL;
    int i;
    /* List with 30 nodes */
    for(i=0;i<=30;i++){
        list_add(&n, i);
    }
    list_print(n);

    /* Get 1th, 5th, 9th, 13th, 18th ... nodes of n etc */ 

    list1 = list_split(n, 1, 4);

    list_print(list1);

    list2 = list_split(n, 2, 4); /* 2, 6, 10, 14 etc */   
    list_print(list2);

    list3 = list_split(n, 3, 4); /* 3, 7, 11, 15 etc */   
    list_print(list3);

    list3 = list_split(n, 4, 4); /* 4, 8, 12, 16 etc */   
    list_print(list4);

    getch();
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T18:03:43.500

```
 temp = list_nth(current, ind);

 while (current != NULL) {
        count = count+step;
        temp->next = list_nth(head, count);
        current = current->next;
    } 
```

You are finding the correct item to begin the split at, but look at what happens to temp from then on ... you only ever assign to temp->next.

You need to keep track of both the head of your split list and the tail where you are inserting new items.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T18:20:54.353

Your description of what list_split is supposed to return is pretty clear, but it's not clear what is supposed to happen, if anything, to the original list. Assuming it's not supposed to change:

```
node *list_split(node *head, int ind, int step) {
    node *current = head;
    node *newlist=NULL;
    node **end = &newlist;
    node *temp = list_nth(current, ind);

    while (temp != NULL) {
        *end = (node *)malloc(sizeof(node));
        if (*end == NULL) return NULL;
        (*end)->data = temp->data;
        end = &((*end)->next);
        temp = list_nth(temp, step);
    }

    return newlist; /* return the final stepped list */
} 
```

(You probably want to factor a list_insert routine out of that that inserts a new node at a given location. list_add isn't very useful since it always adds to the beginning of the list.)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T18:18:51.253

The program, actually, has more than one problem.

*   Indexes are not a native way to address linked list content. Normally, pointers to nodes or iterators (which are disguised pointers to nodes) are used. With indexes, accessing a node has linear complexity (`O(n)`) instead of constant `O(1)`.

*   Note that `list_nth` returns a pointer to a "live" node within a list, not a copy. By assigning to `temp->next` in `list_split`, you are rewiring the original list instead of creating a new one (but maybe it's intentional?)

*   Within `list_split`, `temp` is never advanced, so the loop just keeps attaching nodes to the head instead of to the tail.

*   Due to use of `list_nth` for finding nodes by iterating through the whole list from the beginning, `list_split` has quadratic time (`O(n**2)`) instead of linear time. It's better to rewrite the function to iterate through the list once and copy (or re-attach) required nodes as it passes them, instead of calling `list_nth`. Or, you can write `current = list_nth(current, step)`.

*   **[EDIT]** Forgot to mention. Since you are rewiring the original list, writing `list_nth(head, count)` is incorrect: it will be travelling the "short-cirquited" list, not the unmodified one.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T19:28:08.273

I also notice that it looks like you are skipping the first record in the list when you are calculating *list_nth*. Remember is C we normally start counting at zero.

Draw out a Linked List diagram and follow your logic:

```
[0]->[1]->[2]->[3]->[4]->[5]->[6]->[7]->[8]->[9]->...->[10]->[NULL] 
```

# php - 字符串中的零填充数字

> ID：324358
> 
> 赞同：147
> 
> 时间：2008-11-27T17:55:12.860
> 
> 标签：php

我需要将单个数字（1 到 9）转换为（01 到 09）。我可以想到一种方法，但它又大又丑又麻烦。我相信一定有一些简洁的方法。有什么建议么

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2008-11-27T17:59:07.987

首先，您的描述具有误导性。`Double`是浮点数据类型。您可能想用字符串中的前导零填充您的数字。以下代码执行此操作：

```
$s = sprintf('%02d', $digit); 
```

有关详细信息，请参阅 的文档[`sprintf`](http://php.net/sprintf)。

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2008-11-27T18:10:42.860

There's also [str_pad](http://ca3.php.net/str_pad)

```
<?php
$input = "Alien";
echo str_pad($input, 10);                      // produces "Alien     "
echo str_pad($input, 10, "-=", STR_PAD_LEFT);  // produces "-=-=-Alien"
echo str_pad($input, 10, "_", STR_PAD_BOTH);   // produces "__Alien___"
echo str_pad($input, 6 , "___");               // produces "Alien_"
?> 
```

* * *

## 回答 #3

> 赞同：75
> 
> 时间：2011-06-15T12:39:26.263

使用[str_pad 的](http://www.php.net/str_pad)解决方案：

```
str_pad($digit,2,'0',STR_PAD_LEFT); 
```

php 5.3 上的基准测试

> 结果 str_pad：0.286863088608
> 
> 结果 sprintf：0.234171152115

代码：

```
$start = microtime(true);
for ($i=0;$i<100000;$i++) {
    str_pad(9,2,'0',STR_PAD_LEFT);
    str_pad(15,2,'0',STR_PAD_LEFT);
    str_pad(100,2,'0',STR_PAD_LEFT);
}
$end = microtime(true);
echo "Result str_pad : ",($end-$start),"\n";

$start = microtime(true);
for ($i=0;$i<100000;$i++) {
    sprintf("%02d", 9);
    sprintf("%02d", 15);
    sprintf("%02d", 100);
}
$end = microtime(true);
echo "Result sprintf : ",($end-$start),"\n"; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-07-14T07:31:49.000

的性能`str_pad`很大程度上取决于填充的长度。要获得更一致的速度，您可以使用[str_repeat](https://www.php.net/manual/en/function.str-repeat.php)。

```
$padded_string = str_repeat("0", $length-strlen($number)) . $number; 
```

还使用数字的字符串值以获得更好的性能。

```
$number = strval(123); 
```

在 PHP 7.4 上测试

```
str_repeat: 0.086055040359497   (number: 123, padding: 1)
str_repeat: 0.085798978805542   (number: 123, padding: 3)
str_repeat: 0.085641145706177   (number: 123, padding: 10)
str_repeat: 0.091305017471313   (number: 123, padding: 100)

str_pad:    0.086184978485107   (number: 123, padding: 1)
str_pad:    0.096981048583984   (number: 123, padding: 3)
str_pad:    0.14874792098999    (number: 123, padding: 10)
str_pad:    0.85979700088501    (number: 123, padding: 100) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-02-07T12:32:21.077

这是我处理正数和负数的解决方案

```
<?php

// add zeros to a number at left or right side.
function add_zeros_to_number( $number, $number_of_zeros, $zeros_position="left"){
    // check if number is negative
    $is_negative = FALSE;
    if ( strpos($number , '-') !== FALSE ){
        $is_negative = TRUE;
        $number = substr($number, 1);
    }
    if($zeros_position == "right"){
        $r = str_pad($number, $number_of_zeros, "0", STR_PAD_RIGHT);
    }else{
        $r = str_pad($number, $number_of_zeros, "0", STR_PAD_LEFT);
    }
    if( $is_negative ){
        return "-".$r;
    }else{
        return $r;
    }
}

// how to use
$number = -333;   // Desire number 
$number_of_zeros = 4;  // number of zeros [ your number length + zeros ]
$position = "right";  // left or right . default left
echo $result = add_zeros_to_number($number, $number_of_zeros, $position);

// output
// -333 => -3330    left
// -333 => -0333    right 
```

# visual-studio-2008 - 如何在 VS Setup 项目中创建网站快捷方式？

> ID：324367
> 
> 赞同：0
> 
> 时间：2008-11-27T17:59:03.540
> 
> 标签：visual-studio-2008, installation, setup-project, shortcuts

如何在 VS 2008 安装项目中创建指向我的网站的快捷方式？

安装应用程序后，我想在用户的 Program Menu\MyProgram 中创建一个快捷方式。

我可以创建应用程序本身的快捷方式，但我不知道如何创建 http:// 地址的快捷方式。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T18:07:51.977

Found the answser.

Create a .cmd file with:

start [http://www.mywebsite.com](http://www.mywebsite.com)

And add a shortcut to it.

# asp.net - WebPartManager 和移动控件

> ID：324370
> 
> 赞同：2
> 
> 时间：2008-11-27T17:59:31.213
> 
> 标签：asp.net, mobile

WebPartManager 可以与从移动 Web 控件构造的 Web 部件一起使用吗？如果可能，应该这样做吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-28T07:16:27.643

我看起来很有希望，你只需要尝试一下。在移动开发中，您总是需要完全控制生成的输出，这看起来像是完成部分工作的工具。

但请记住，许多设备都有自己的问题，因此您需要能够控制输出的每个部分。到目前为止，我还没有遇到任何适合这项工作的框架。

# asp.net - 创建没有 ASMX 文件的 Web 服务？

> ID：324373
> 
> 赞同：6
> 
> 时间：2008-11-27T18:00:36.720
> 
> 标签：asp.net, vb.net, web-services

我编写了一个 ASP.NET 复合控件，其中包含一些与 Web 服务通信的 Javascript。

我已将控件和服务的类打包到一个 DLL 中，以方便人们在其他项目中使用它。

我遇到的问题是，除了在他们的项目中引用 DLL 之外，我的控件的使用者还必须包含一个用于 Web 服务的 .ASMX 文件。虽然它不是一个复杂的文件（只是一个引用 DLL 中的类的单行文件），但如果可以的话，我想避免使用它。

有什么方法可以避免必须拥有 .ASMX 文件？

*   我可以在 Application_Start 中向 Web 服务器注册服务吗？
*   我可以对 web.config 进行更改以以某种方式引用它吗？

感谢所有建议！

**更新：** John Sheehan 的回复（如下）中链接的文章确实有效 - 但如果您想使用 AJAX 调用 Web 服务，则不能。有人知道 AJAX 友好的版本吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T18:42:24.403

Try something like this. I don't know if it will work though. I got this idea from ELMAH, which creates a handler for a page that doesn't physically exist and then serves it up from the assembly.

```
<configuration>
   <system.web>
      <httpHandlers>
         <add verb="*" path="*WebService.asmx" type="MyHandler.WebServiceHandler, MyHandler" />
      </httpHandlers>
   </system.web>
</configuration> 
```

EDIT: I was close, see this article (in VB though): [http://www.codeproject.com/KB/aspnet/wsinaclasslibrary.aspx](http://www.codeproject.com/KB/aspnet/wsinaclasslibrary.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-05T08:54:14.017

我知道这是一个非常古老的问题，但没有得到正确的回答，所以这里是：

默认情况下，每个 *.ASMX 请求都由`System.Web.Services.Protocols.WebServiceHandlerFactory`.

在 .NET 反射器中查看此类的源代码，可以在没有 ASMX 文件的情况下拥有 web 服务，但您需要`CoreGetHandler`通过反射调用内部方法。

以下方法将获取您的 Web 服务并返回其 IHttpHandler。

```
public IHttpHandler GetHttpHandlerForWebService(WebService webService, HttpContext context)
{
    var webServiceType = webService.GetType();
    var wshf = new System.Web.Services.Protocols.WebServiceHandlerFactory();
    var coreGetHandler = wshf.GetType().GetMethod("CoreGetHandler");
    var httpHandler = (IHttpHandler)coreGetHandler.Invoke(wshf, new object[] { webServiceType, context, context.Request, context.Response });
    return httpHandler;
} 
```

一旦你有了你的 httphandler，你只需调用

> httpHandler.ProcessRequest(上下文)

完毕。没有 ASMX 和 web.config 条目。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-09T19:48:59.983

这是一篇关于您的问题的非常好的工作文章：

在 Codeproject 上[的类库项目中创建 Web 服务。](http://www.codeproject.com/Articles/21431/Creating-Web-Services-in-a-Class-Library-project "在类库项目中创建 Web 服务")

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T06:12:22.123

考虑尝试页面方法（[请参阅此博客文章](http://geekswithblogs.net/frankw/archive/2008/03/13/asp.net-ajax-callbacks-to-web-methods-in-aspx-pages.aspx)）。您所要做的就是将 web 方法属性添加到后面的 aspx 代码中的静态方法中。然后从您的客户端代码 (javascript) 访问 PageMethod 对象。不需要 ASMX 文件。希望这可以帮助。

* * *

## 回答 #5

> 赞同：-7
> 
> 时间：2008-11-27T18:36:58.597

Short answer is no. The ASMX is the entry point for any web service. There are alternatives if you use WCF, but that's not entirely the same thing.

# .htaccess - 如何强制某些页面以斜杠结尾 [.htaccess]

> ID：324381
> 
> 赞同：5
> 
> 时间：2008-11-27T18:03:47.463
> 
> 标签：.htaccess

这是一个多站点问题。我有很多带有 .htaccess 文件的站点，其中多行类似于：

```
rewriterule ^(page-one|page-two|page-three)/?$ /index.php?page=$1 [L] 
```

这意味着 www.domain.com/page-one 和 www.domain.com/page-one/ 都将加载 www.domain.com/index.php?page=page-one

但是我总是被告知，确保每页只使用一个 URL 是一种很好的 SEO 做法，所以我想做的是让 www.domain.com/page-one 重定向到 www.domain.com/page -one/ 通过 .htaccess 文件。

请注意我**不**寻找的答案是从行尾删除 ?$ ，因为这只会导致 www.domain.com/page-one 成为 404 链接。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-17T06:56:14.860

这是一个强制所有内容以斜杠结尾的片段

```
rewritecond %{REQUEST_FILENAME} !-f
rewritecond %{REQUEST_URI} !(.*)/$
rewriterule ^(.*)$ http://%{HTTP_HOST}/$1/ [L,R=301] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T18:34:13.767

使用 HTTP 重定向将使用“错误”URL 的用户发送到正确的 URL。例如，您可以使用：

```
 RewriteRule ^(.+[^/])$ $1/ [R] 
```

在你自己的 RewriteRule 之前。

但请注意：这也会在以文件名结尾的 URL 中添加斜杠。如果你有这样的 URL，你必须在重定向之前为它们设置例外。

另请参阅[尾部斜杠的常见问题解答条目](http://httpd.apache.org/docs/1.3/misc/FAQ-E.html#set-servername)和[mod_rewrite 的示例页面](http://httpd.apache.org/docs/2.2/rewrite/rewrite_guide.html#trailingslash)！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T18:07:14.740

*未经测试*，但你不能这样做吗？

```
RewriteRule ^(.*[^/])$ $1/
RewriteRule ^(page-one|page-two|page-three)?$ /index.php?page=$1 [L] 
```

# c++ - Logging over the wire?

> ID：324386
> 
> 赞同：1
> 
> 时间：2008-11-27T18:05:03.777
> 
> 标签：c++, linux, logging

We have cases wherein we write a lot of log files to the host increasing the i/o on a host. Are there any good open source logging over the wire solutions.

The application language is C++ on Red Hat Linux 3.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T23:34:12.070

一个非常简单的日志记录选项是使用 syslog 并依靠（在正确配置后）syslog 守护程序将其转发到远程服务器。

看一眼：

`openlog()`

`syslog()`

`closelog()`

和：

`syslog.conf`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T18:29:28.690

First set of questions:

*   Do you need all those log files?
*   All the time?
*   Can you control how much logging occurs?
*   Why not?

Second set of questions:

*   Why are your log writing operations slow?
*   Are you using inappropriate operations (for example, O_SYNC or related options on POSIX)?
*   How many disk drives do you have?
*   Can you gain by having different log files on different drives (or, at least, having the log files on a different drive from where the other files are stored)?

As @igalse says, there are logging libraries available. For C++, you should look at what is available at [Boost](http://www.boost.org/), but there are undoubtedly other sources too.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T18:33:02.007

For C++, Boost doesn't contain a library for logging yet. But you can use the most advanced candidate, written by John Torjo, [here](http://torjo.com/log2/doc/html/index.html).

It allows to filter some of your logging (you probably need that, if the logging is so important that it becomes a performance problem) and setting different destinations, like a stream.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T18:11:16.450

There are logging libraries that can help you. depending on your application language. But if i/o is a problem probably network bandwidth is a bigger problem.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T12:48:46.693

如果主机上的 I/O 受到不必要的影响，那么我认为您是：

*   进行 FAR 过多的日志记录 - 充分记录以使其持续接近 IO 写入速度可能太多了 - 因为即使是最普通的硬件也可以轻松地每秒执行几兆字节而不会出现问题
*   对日志进行太多刷新 - 这更有可能。默认情况下，Syslogd 会大量刷新日志（对于日志密集型应用程序来说太多了）——这是为了在发生崩溃时日志文件是持久的——但会生成大量 IO。Syslogd 可以在每个文件的基础上重新配置（参见其手册页），而不是经常刷新文件。

如果有相同的问题，登录到网络服务器并不能解决这些问题 - 事实上，如果多个主机登录到同一台服务器，情况会变得更糟。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-27T18:15:20.793

The application language is C++ on Red Hat Linux 3\.

# performance - 是否可以更改 Java ME 中的垃圾收集行为？

> ID：324398
> 
> 赞同：2
> 
> 时间：2008-11-27T18:09:38.543
> 
> 标签：performance, java-me, garbage-collection

我想知道是否可以调整垃圾收集器在 JavaMe 上的工作方式以以某种方式提高性能（可能会减少通道数）？我看过一些关于它的文章，但大多是针对 Java SE 的，其中大多数都说 GC 高度依赖于制造商。那会是多少。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T12:06:05.567

何时触发垃圾收集器在很大程度上是一个谜，除非您第一手了解您的应用程序在其上运行的特定 VM 是如何实现的，以及它是如何为您正在使用的特定手机配置和定制的。

调用 java.lang.System.gc() 并不能保证触发垃圾收集器。它通常只会增加 VM 很快启动垃圾收集的可能性。

我发现在同一个线程中连续调用 System.gc() 3 次但从 3 种不同的方法往往工作得相当好。

有很多方法可以解决 JavaME 标准 API 实现中的低效率问题，以减少生成的垃圾量：

*   扩展 ByteArrayOutputStream 以便在您想要访问数据时不创建字节数组的副本。

*   避免调用 StringBuffer.getChars() 和 StringBuffer.toString()。让您的代码使用 StringBuffer 偏移量和长度。

*   将本地缓冲区（byte []，StringBuffer ...）转换为实例或静态变量（并使用同步保护它们）。显然，这样做会产生开销，但它可以防止您的应用程序由于垃圾收集过于频繁而冻结。

*   扩展 StringBuffer 以避免在 String 和 StringBuffer 之间来回切换：实现 append(String, offset, length), parseInt(int), indexOf(String, index), replace(offset, StringBuffer, offset, length)...

...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T18:21:04.620

我看不到任何可能的方法来调整 J2ME 中的垃圾收集行为。

如果您遇到由垃圾收集引起的暂停问题，您必须做两件事：

*   通过重用对象来减少程序产生的垃圾，并避免像字符串连接这样的代价高昂的事情（改用 StringBuffer）
*   使用 System.gc() 在一点点冻结无关紧要时强制垃圾收集（例如，在游戏的“加载”屏幕期间），以减少在烦人时触发收集器进程的几率。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T12:57:47.793

感谢所有输入的人。我已经看到不可能为支持 Java Me 的设备调整 GC。至少不是以任何简单或有用的方式。无论如何，我都会保留这个问题，以防这种情况暂时发生变化。:)

# apache - How do I redirect URLS that begin with /test/ to a separate script?

> ID：324400
> 
> 赞同：2
> 
> 时间：2008-11-27T18:10:26.887
> 
> 标签：apache, .htaccess, mod-rewrite

I have an existing htaccess that works fine:

```
RewriteEngine On
RewriteCond %{SCRIPT_FILENAME} !-f
RewriteCond %{SCRIPT_FILENAME} !-d
RewriteRule (.*) /default.php 
DirectoryIndex index.php /default.php 
```

I wish to modify this so that all urls that start with /test/ go to /test/default.php.

Example: [http://www.x.com/hello.php](http://www.x.com/hello.php) -- > [http://www.x.com/default.php](http://www.x.com/default.php) Example: [http://www.x.com/test/hello.php](http://www.x.com/test/hello.php) -- > [http://www.x.com/test/default.php](http://www.x.com/test/default.php)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T18:13:59.143

Basically, just put `/test/` in front of your expression. Also, the parentheses are unnecessary here:

```
RewriteRule ^/test/ /test/default.php 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T18:22:40.857

If you need to pass on information from the URL you can capture it (with parentheses) and send it to default.php (with $1) as follows:

```
RewriteRule ^/test/(.*)$ /test/default.php/$1 
```

so that http//..../test/foo/bar/ would result in /test/default.php/foo/bar/ . Your script can then access the extra information.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T14:10:33.317

我会使用：

```
RewriteCond %{REQUEST_URI} ^/([^/]*/)*
RewriteRule !/default\.php$ %0default.php [L] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T18:00:35.800

```
RewriteRule ^/test(/.*)?$ /test/default.php [L] 
```

如果需要，访问 $_SERVER 全局数组中的原始 URI。

从您的原件来看，您可能想要：

```
RewriteEngine On
RewriteCond %{SCRIPT_FILENAME} !-f
RewriteCond %{SCRIPT_FILENAME} !-d
RewriteRule ^/test(/.*)?$ /test/default.php [L]
RewriteCond %{SCRIPT_FILENAME} !-f
RewriteCond %{SCRIPT_FILENAME} !-d
RewriteRule ^(.*)$ /default.php 
```

# haskell - How do I simplify the below expressions using primitive recursion?

> ID：324428
> 
> 赞同：1
> 
> 时间：2008-11-27T18:24:21.180
> 
> 标签：haskell, functional-programming, lambda-calculus

> **Possible Duplicate:**
> [Symbolic simplification in Haskell (using recursion?)](https://stackoverflow.com/questions/324311/symbolic-simplification-in-haskell-using-recursion)

The simplifications I have in mind are

```
0*e = e*0 = 0
1*e = e*1 = 0+e = e+0 = e-0 = e 
```

and simplifying constant subexpressions, e.g. `Plus (Const 1) (Const 2)` would become `Const 3`. I would not expect variables (or variables and constants) to be concatenated: `Var "st"` is a distinct variable from `Var "s"`.

For example `simplify(Plus (Var "x") (Const 0))= Var "x"`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T18:29:46.787

Well, can't you apply pattern matching to the individual cases?

```
simplify (Plus (Const 0) (Expr x)) = simplify (Expr x)
simplify (Plus (Expr x) (Const 0)) = simplify (Expr x)
simplify (Mult (Const 0) _) = Const 0
simplify (Mult _ (Const 0)) = Const 0
– … and so on 
```

EDIT: Yes, of course … recursion added.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T19:46:43.760

我对haskell知之甚少，但基本上你会想做一个表达式树遍历。

树是 EXP: (operator) (EXP) (EXP) EXP: (const) EXP: (var)

那么你的简化就变成了伪代码

```
simplify(Exp e)
if (e is const) return e
else if (e is var) return e
else
{//encode simplification rules
    Exp left = simplify(e.left)
    Exp right = simplify(e.right)
    if(operator is PLUS)
    {
        if(left == 0) return right;
        if(right == 0) return left;
    }
    else if(operator is MULT)
    {
        if(left == 1) return right;
        if(right == 1) return left;
        if(left == 0) return 0;
        if(right == 0) return 0;
    }
//and so on for other operators
} 
```

这有点像java esque，但我认为这个想法就在那里，基本上你将不得不进行树遍历。

# activex - ActiveX on Visual C++ 6 Tutorial

> ID：324433
> 
> 赞同：1
> 
> 时间：2008-11-27T18:27:59.143
> 
> 标签：activex, visual-c++-6

I have to build an application based in an ActiveX library (MIL for Matrox framegrabbers). The library should be already working, since it compiles and run a console application provided as example. (Yes, the console application is probably not using any ActiveX at all... I actually don't know)

The application will set times, frames per second, etc.

I never used Visual C++ before (I have some poor C programming skills), let alone an ActiveX library. I'm not even able to get an "Ok Cancel" dialog to work...

**I need the most basic ever vc6 + ActiveX tutorial.**

Thanks in advance.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-27T20:02:53.430

[这](http://www.codeguru.com/cpp/com-tech/atl/tutorials/article.php/c17)是一个示例 - 如何创建控件（您已经拥有一个）以及如何与之交互。

顺便说一句，使用 VC++ 并不是 IMO 的最佳选择。COM 客户端的编程在 VB 中要简单得多...

# visual-studio - 我可以为 IIS6 的 w3wp.exe 设置进程标题吗？

> ID：324435
> 
> 赞同：5
> 
> 时间：2008-11-27T18:28:39.470
> 
> 标签：visual-studio, debugging, iis-6, w3wp

在 Visual Studio 的“附加到进程”对话框中，我可以看到每个可用进程的标题列。我有什么方法可以设置特定 w3wp.exe 进程的标题以反映它托管的应用程序池？

PS - 我知道 iisapp.vbs 以及它使我能够识别哪个 w3wp.exe 属于哪个应用程序池的方式。我的目标是在这里提供更用户友好的解决方案:)

PPS - 当前运行 IIS6。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T22:45:12.213

假设您在非生产服务器上进行调试，最简单的做法是将每个 w3wp 进程的身份设置为不同的帐户。我在 IIS 管理员中找不到任何东西来设置标题。即使调试器正在运行，我也无法像在线程中那样设置标题。希望这可以帮助。

# php - 使用php将pdf文件转换为txt文件

> ID：324436
> 
> 赞同：4
> 
> 时间：2008-11-27T18:28:49.533
> 
> 标签：php, pdf, text-files

有这个程序，pdftotext，可以将pdf文件转换为文本文件。要直接在 linux 控制台上使用它：

```
pdftotext file.pdf 
```

这将在与 pdf 文件相同的目录中生成一个 file.txt。我正在寻找一种从 php 程序内部执行此操作的方法，经过一番谷歌搜索后，我以两个对我有用的命令结束：*system()*和*exec()*。所以我用这个制作了一个php文件：

```
<?php
    system('pdftotext file.pdf');
?> 
```

但是当我运行这段代码时，它不起作用。没有创建 txt 文件。所以我尝试用另一个命令创建一个测试文件：

```
<?php
    system('touch test.txt');
?> 
```

这工作得很好。我也使用过 exec() 并且结果是一样的。为什么它不起作用？

**编辑：**按照 RoBorg 的建议，我在命令中添加了 2>&1 参数，所以：

```
<?php
    system('pdftotext file.pdf 2>&1');
?> 
```

它打印了一条错误消息：

> pdftotext：加载共享库时出错：libfontconfig.so.1：无法打开共享对象文件：没有这样的文件或目录

似乎服务器上缺少某些东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T18:52:58.533

这可能是权限问题，但请尝试以下操作：

```
<?php
    system('pdftotext file.pdf 2>&1');
?> 
```

将`2>&1`stderr 重定向到 stdout，因此将打印任何错误消息。从那时起，它应该很容易修复。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T18:31:54.380

PHP 有一个内置的 PDF 函数库，应该能够为您提供所需的内容：http:
[//nl3.php.net/pdf](http://nl3.php.net/pdf)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-15T20:50:24.173

安装这个。它为我解决了这个问题。

[http://www.ssforge.com/ssforge-standard/onlinehelp/help/faq/libstdc.html](http://www.ssforge.com/ssforge-standard/onlinehelp/help/faq/libstdc.html)

现在，pdftotext 效果很好。

# emacs - Disable Carbon Emacs scroll beep

> ID：324457
> 
> 赞同：11
> 
> 时间：2008-11-27T18:38:22.133
> 
> 标签：emacs, dot-emacs, carbon-emacs

I've been looking into adopting Carbon Emacs for use on my Mac, and the only stumbling block I've run into is the annoying scroll beep when you try to scroll past the end of the document. I've looked online but I can't seem to find what I should add to my .emacs that will stop it from beeping when scrolling. I don't want to silence it completely, just when scrolling. Any ideas?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-01T17:36:30.217

```
(setq visible-bell t) 
```

这使 emacs 闪烁而不是哔哔声。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T20:22:27.303

Using the hints from the [Emacs wiki AlarmBell page](http://www.emacswiki.org/emacs/AlarmBell), this does it for me:

```
(defun my-bell-function ()
  (unless (memq this-command
        '(isearch-abort abort-recursive-edit exit-minibuffer
              keyboard-quit mwheel-scroll down up next-line previous-line
              backward-char forward-char))
    (ding)))
(setq ring-bell-function 'my-bell-function) 
```

If you don't know the name of a command, press `C-h k` then the key/action you would like to get the name of.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-12-16T20:20:47.550

在斯蒂芬哈萨德的回答和基普顿巴罗斯的评论之间：

```
(setq ring-bell-function 'ignore) 
```

似乎是最简洁的，适用于 emacs 24.x，并回答了原始问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-27T19:12:34.640

You will have to customize the `ring-bell-function`.

This page may provide hints:

[http://www.emacswiki.org/emacs/AlarmBell](http://www.emacswiki.org/emacs/AlarmBell)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-12T17:29:02.017

这似乎可以解决问题：

```
(setq ring-bell-function nil) 
```

# c# - 最上层？

> ID：324463
> 
> 赞同：7
> 
> 时间：2008-11-27T18:42:58.430
> 
> 标签：c#, .net

我怎样才能在所有其他应用程序上显示一些东西。我想在我的程序的所有形式和我的桌面上打开的所有其他程序（不是我的）上显示一些东西。

***Top 大多数都不起作用我已经测试过，我的浏览器可以覆盖我的应用程序：S**

这是我使用 TopMost 为 TRUE 时的图像。你可以看到我的浏览器已经结束了...

[http://www.freeimagehosting.net/uploads/5a98165605.png](http://www.freeimagehosting.net/uploads/5a98165605.png)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-27T18:43:28.490

您可以使用表单实例并将属性**TopMost**设置为 True。

* * *

**如果你想超越所有的 Windows， Win32 Api**调用 还有另一种方法。

这是您可以执行的操作：

在您的表单类中添加：

```
[System.Runtime.InteropServices.DllImport("user32.dll")]
public static extern bool SetForegroundWindow(IntPtr hWnd); 
```

在表单加载中，您可以添加：

```
SetForegroundWindow(this.Handle); 
```

这应该可以解决问题。

## 更新

**TopMost**应该可以完成这项工作，但是：最重要的 OR/AND Win32 Api 调用仅在 Visual Studio 内不起作用（对于 Vista 和 VS2008 我测试过......我无法判断其他）。尝试使用 /bin 目录中的 .Exe 运行程序，它会工作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-27T19:03:10.993

Form.TopMost 属性会将您的表单设置为高于所有其他正在运行的 Windows 应用程序（不仅仅是您的表单）的顶级表单。

```
myForm.TopMost = true; // This will do the job 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T19:18:10.247

TopMost 属性是您所需要的（从来没有遇到过问题）

* * *

在 MSDN 上它说：

> 最顶层表单是与所有其他（非最顶层）表单重叠的表单，即使它不是活动表单或前景表单。最顶层的表单始终显示在桌面上窗口 z 顺序的最高点。

[http://msdn.microsoft.com/en-us/library/system.windows.forms.form.topmost.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.topmost.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-12T03:56:11.813

在我的团队中，我们有一个在 Windows 启动后继续运行的内部工具。它是一个 WinForm，TopMost 设置为 ture。在 Vista 上，有时我们也会遇到同样的问题。在非常随机的时间，表单会丢失 TopMost 属性，并且其他非最顶层窗口会出现在其上方。我有一个研究日志，但没有找到答案，许多其他人也有同样的问题，似乎在非常低级别的 Vista 上存在关于 TopMost 属性的错误。

# xna - 在 Delphi Prism 中做 XNA

> ID：324466
> 
> 赞同：3
> 
> 时间：2008-11-27T18:45:32.650
> 
> 标签：xna, delphi-prism, oxygene, xna-3.0

我已经安装了 Delphi Prism 和 XNA Game Studio 3.0。我已成功翻译为 Delphi Prism XNA 教程 1“在屏幕上显示 3D 模型”（[http://msdn.microsoft.com/en-us/library/bb197293.aspx](http://msdn.microsoft.com/en-us/library/bb197293.aspx)）。项目编译良好，但我无法加载模型。看起来XNA中有一个新的“contentproj”类型不在Delphi Prism中......知道如何让它工作吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T13:51:27.943

您可以使用 msbuild 手动构建内容项目。它可能没有相同的集成，您可以在解决方案资源管理器中添加内容和更改设置......但它会成功:-)

这是有关此的更多信息：http: [//blogs.msdn.com/shawnhar/archive/2006/11/07/build-it-ahead-of-time.aspx](http://blogs.msdn.com/shawnhar/archive/2006/11/07/build-it-ahead-of-time.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T15:23:28.357

我终于设法通过 1）从命令行使用 MSBuild 构建“* .contentproj”，2）将生成的“内容”目录作为输出我的 Delphi Prism 可执行文件的子目录来使其工作。

让 Delphi Prism 自动识别 *.contentproj 并自动构建它会很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T21:40:21.893

我还没有做过任何 XNA 的东西，但这是我最好的猜测 :-)

因此，Content Project 类型是标准 XNA 项目的子项目，它只是将游戏内容（纹理、声音等）编译为嵌套编译过程，对吗？

所以我假设在项目文件或解决方案文件中必须有对子项目的引用，也许最好的方法是在 C# 或 VB 中创建一个简单的 XMA 项目并查看生成的元文件（ csproj、contentproj 等）

*编辑：*

* * *

*哦，我在这里建议您手动创建 contentproj 文件并插入引用，一旦您知道它们的样子，我假设 VS 将允许您添加、删除您的内容等*

* * *

然后剩下的问题是 XNA 内容管道编译过程是如何被触发的，如果它不是“刚刚发生”，这可能是 marc hoffman 等人的问题

希望这会有所帮助，这只是一个猜测。

顺便说一句，很高兴在 StackOverFlow 见到你。

Rgds 蒂姆·贾维斯。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T21:49:12.267

据我所知，Prism 只是公布了，没有发布。因此，试验不是最终产品。作为 RO 客户，我希望收到一封电子邮件，但不会在此之前发布，除非是发布它。坦率地说，我不知道 XNA 支持已经完成，甚至还没有工作。考虑到 Prism 的正式发布最快还有将近一个月的时间，你尝试这个可能还为时过早。

我不知道该告诉您如何解决 XNA 的问题，但等待 Prism 本身是明智的。在 Prism 发布之前，我会认为 XNA 支持“待定”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-09T01:21:00.573

System.reflection 可用于访问 XNA 的内部工作以创建 xnb 文件

```
method Game1.LoadContent;
var
    importer : TextureImporter;
    texContent : Texture2DContent;
    cc : ContentCompiler;
    fullPath : String;
    fs : FileStream;
    args : array[1..7] of System.Object;
    begin
    spriteBatch := new SpriteBatch(GraphicsDevice);
    importer := new TextureImporter;
    texContent := importer.Import(’asset.png’, nil) as Texture2DContent;

    var compilerType := typeOf(ContentCompiler);

    cc := compilerType.GetConstructors(BindingFlags.NonPublic or BindingFlags.Instance)[0].Invoke(nil) as ContentCompiler;

    var compileMethod := compilerType.GetMethod("Compile", BindingFlags.NonPublic or BindingFlags.Instance);

    fullPath := ‘assestName.xnb’;

    fs := File.Create(fullPath);

    args[1] := fs;
    args[2] := texContent;
    args[3] := TargetPlatform.Windows;
    args[4] := GraphicsProfile.Reach;
    args[5] := true;
    args[6] := fullPath;
    args[7] := fullPath;

    compileMethod.Invoke
    (
        cc,
        args
    );

    //SpriteTexture := Content.Load(’assetName’);
end; 
```

# java - HTTP headers encoding/decoding in Java

> ID：324470
> 
> 赞同：14
> 
> 时间：2008-11-27T18:51:26.803
> 
> 标签：java, http, servlets, utf-8, header

A custom HTTP header is being passed to a Servlet application for authentication purposes. The header value must be able to contain accents and other non-ASCII characters, so must be in a certain encoding (ideally UTF-8).

I am provided with this piece of Java code by the developers who control the authentication environment:

```
String firstName = request.getHeader("my-custom-header"); 
String decodedFirstName = new String(firstName.getBytes(),"UTF-8"); 
```

But this code doesn't look right to me: it presupposes the encoding of the header value, when it seemed to me that there was a proper way of specifying an encoding for header values (from MIME I believe).

Here is my question: what is the right way (tm) of dealing with custom header values that need to support a UTF-8 encoding:

*   on the wire (how the header looks like over the wire)
*   from the decoding point of view (how to decode it using the Java Servlet API, and can we assume that request.getHeader() already properly does the decoding)

Here is an environment independent code sample to treat headers as UTF-8 in case you can't change your service:

```
String valueAsISO = request.getHeader("my-custom-header"); 
String valueAsUTF8 = new String(firstName.getBytes("ISO8859-1"),"UTF-8"); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-31T20:24:24.273

再次重申：RFC 2047 在实践中并未实施。HTTP/1.1 的下一个修订版将删除对它的任何提及。

所以，如果你需要传输非 ASCII 字符，最安全的方法是将它们编码成一个 ASCII 序列，例如 Atom Publishing Protocol 中的“Slug”标头。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-27T20:30:07.650

正如已经提到的，第一眼应该总是去[HTTP 1.1 规范](http://www.greenbytes.de/tech/webdav/rfc2616.html)（RFC 2616）。[它表示](http://www.greenbytes.de/tech/webdav/rfc2616.html#basic.rules)，如果标头值中的文本包含来自 ISO-8859-1 以外的字符集的字符，则它必须使用[RFC 2047](https://www.rfc-editor.org/rfc/rfc2047)定义的 MIME 编码。

所以这对你来说是一个加分项。如果 ISO-8859-1 字符集涵盖了您的要求，那么您只需将您的字符放入您的请求/响应消息中。否则 MIME 编码是唯一的选择。

只要用户代理根据这些规则将值发送到您的自定义标头，您就不必担心解码它们。这就是 Servlet API 应该做的。

* * *

但是，还有一个更基本的原因可以解释为什么您的代码片段没有按照应有的方式进行。第一行获取标头值作为 Java 字符串。正如我们所知，它在内部表示为 UTF8，因此此时 HTTP 请求消息解析已经完成并完成。

下一行获取该字符串的字节数组。由于没有指定编码（恕我直言，这种没有参数的方法早就应该被弃用），使用当前系统默认编码，通常不是 UTF8，然后数组再次转换为 UTF8 编码。出局。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-31T17:16:56.367

The HTTPbis working group is aware of the issue, and the latest drafts get rid of all the language with respect to TEXT and RFC 2047 encoding -- it is not used in practice over HTTP.

See [http://trac.tools.ietf.org/wg/httpbis/trac/ticket/74](http://trac.tools.ietf.org/wg/httpbis/trac/ticket/74) for the whole story.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-27T19:54:13.840

有关规则，请参阅[HTTP 规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec2.html#sec2)，在第 2.2 节中说明

> TEXT 规则仅用于不打算由消息解析器解释的描述性字段内容和值。仅当根据 RFC 2047 [14] 的规则进行编码时，*TEXT 的字可能包含来自 ISO-8859-1 [22] 以外的字符集的字符。

上面的代码不会正确解码 RFC2047 编码字符串，让我相信服务没有正确遵循规范，他们只是在标头中嵌入了原始 utf-8 数据。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-01T15:34:46.453

感谢您的回答。似乎理想的情况是按照 RFC 2047 遵循正确的 HTTP 标头编码。在线路上 UTF-8 中的标头值如下所示：

```
=?UTF-8?Q?...?= 
```

现在有趣的是：似乎 Tomcat 5.5 或 6 都没有按照 RFC 2047 正确解码 HTTP 标头！Tomcat 代码在任何地方都假定标头值使用 ISO-8859-1。

因此，对于 Tomcat，特别是，我将通过编写一个过滤器来解决这个问题，该过滤器处理对标头值的正确解码。

# asp.net - C# ASP.NET - how to use the default view engine standalone?

> ID：324473
> 
> 赞同：4
> 
> 时间：2008-11-27T18:53:28.063
> 
> 标签：asp.net, viewengine

I would like to be able to use an ASP.NET view as an email template, complete with the <%= "hi there" %> syntax. Is there a way to invoke/setup this view engine in a standalone way?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-27T19:35:33.970

一种选择是使用 Cassini 来托管网站；但是，您是否考虑过只使用 IIS 并获取 HTML？一个选项是从客户端应用程序执行此操作，我最近在 Web 应用程序中使用的另一个选项是覆盖渲染方法，并提供我传递的流编写器。这让我可以获取 HTML，然后将其传递给电子邮件对象。

就我而言，这很有效，因为我可以让用户预览电子邮件。如果这对您不起作用，那么您将不得不查看托管 API 并托管您自己的实例（Cassini 就是这样做的）。

# django - 在 Django 表单中，如何将字段设置为只读（或禁用）以使其无法编辑？

> ID：324477
> 
> 赞同：495
> 
> 时间：2008-11-27T18:54:06.737
> 
> 标签：django, forms, field, readonly

在 Django 表单中，如何将字段设置为只读（或禁用）？

当表单用于创建新条目时，应启用所有字段 - 但当记录处于更新模式时，某些字段需要是只读的。

例如，在创建新`Item`模型时，所有字段都必须是可编辑的，但在更新记录时，有没有办法禁用该`sku`字段，使其可见，但不能编辑？

```
class Item(models.Model):
    sku = models.CharField(max_length=50)
    description = models.CharField(max_length=200)
    added_by = models.ForeignKey(User)

class ItemForm(ModelForm):
    class Meta:
        model = Item
        exclude = ('added_by')

def new_item_view(request):
    if request.method == 'POST':
        form = ItemForm(request.POST)
        # Validate and save
    else:
            form = ItemForm()
    # Render the view 
```

类`ItemForm`可以重用吗？`ItemForm`或`Item`模型类需要进行哪些更改？我是否需要编写另一个类“ `ItemUpdateForm`”来更新项目？

```
def update_item_view(request):
    if request.method == 'POST':
        form = ItemUpdateForm(request.POST)
        # Validate and save
    else:
        form = ItemUpdateForm() 
```

* * *

## 回答 #1

> 赞同：473
> 
> 时间：2008-11-28T04:09:23.527

[正如这个答案](https://stackoverflow.com/questions/324477/in-a-django-form-how-do-i-make-a-field-readonly-or-disabled-so-that-it-cannot/34538169#34538169)所指出的，Django 1.9 添加了[Field.disabled](https://docs.djangoproject.com/en/stable/ref/forms/fields/#disabled)属性：

> disabled 布尔参数，当设置为 True 时，使用 disabled HTML 属性禁用表单字段，以便用户无法编辑它。即使用户篡改了提交给服务器的字段值，它也会被忽略，取而代之的是表单初始数据中的值。

使用 Django 1.8 及更早版本，要禁用小部件上的条目并防止恶意 POST 黑客攻击，除了`readonly`在表单字段上设置属性外，您还必须清理输入：

```
class ItemForm(ModelForm):
    def __init__(self, *args, **kwargs):
        super(ItemForm, self).__init__(*args, **kwargs)
        instance = getattr(self, 'instance', None)
        if instance and instance.pk:
            self.fields['sku'].widget.attrs['readonly'] = True

    def clean_sku(self):
        instance = getattr(self, 'instance', None)
        if instance and instance.pk:
            return instance.sku
        else:
            return self.cleaned_data['sku'] 
```

或者，替换`if instance and instance.pk`为另一个表明您正在编辑的条件。`disabled`您还可以在输入字段上设置属性，而不是`readonly`.

该`clean_sku`函数将确保该`readonly`值不会被 a 覆盖`POST`。

否则，没有内置的 Django 表单字段会在拒绝绑定输入数据的同时呈现一个值。如果这是您想要的，您应该创建一个单独`ModelForm`的排除不可编辑的字段，然后将它们打印在您的模板中。

* * *

## 回答 #2

> 赞同：191
> 
> 时间：2015-12-30T22:22:00.283

Django 1.9 添加了 Field.disabled 属性：[https ://docs.djangoproject.com/en/stable/ref/forms/fields/#disabled](https://docs.djangoproject.com/en/stable/ref/forms/fields/#disabled)

> disabled 布尔参数，当设置为 True 时，使用 disabled HTML 属性禁用表单字段，以便用户无法编辑它。即使用户篡改了提交给服务器的字段值，它也会被忽略，取而代之的是表单初始数据中的值。

* * *

## 回答 #3

> 赞同：99
> 
> 时间：2008-12-01T17:25:04.500

对小部件进行设置`readonly`只会使浏览器中的输入变为只读。添加`clean_sku`which 返回`instance.sku`可确保字段值不会在表单级别更改。

```
def clean_sku(self):
    if self.instance: 
        return self.instance.sku
    else: 
        return self.fields['sku'] 
```

这样您就可以使用模型（未修改的保存）并避免出现所需字段错误。

* * *

## 回答 #4

> 赞同：80
> 
> 时间：2011-08-13T10:25:18.187

[awalker的回答](https://stackoverflow.com/questions/324477/in-a-django-form-how-do-i-make-a-field-readonly-or-disabled-so-that-it-cannot/5238191#5238191)对我帮助很大！

[我已经使用get_readonly_fields](https://docs.djangoproject.com/en/dev/ref/contrib/admin/#django.contrib.admin.ModelAdmin.readonly_fields)更改了他的示例以使用 Django 1.3 。

通常你应该在下面声明这样的东西`app/admin.py`：

```
class ItemAdmin(admin.ModelAdmin):
    ...
    readonly_fields = ('url',) 
```

我已经适应了这种方式：

```
# In the admin.py file
class ItemAdmin(admin.ModelAdmin):
    ...
    def get_readonly_fields(self, request, obj=None):
        if obj:
            return ['url']
        else:
            return [] 
```

它工作正常。现在，如果您添加一个项目，该`url`字段是可读写的，但在更改时它变为只读。

* * *

## 回答 #5

> 赞同：63
> 
> 时间：2009-09-14T23:47:47.857

要使这项工作适用于某个`ForeignKey`领域，需要进行一些更改。首先，`SELECT HTML`标签没有只读属性。我们需要`disabled="disabled"`改用。但是，浏览器不会为该字段发送回任何表单数据。所以我们需要将该字段设置为不需要，以便该字段正确验证。然后我们需要将值重置回原来的值，这样它就不会被设置为空白。

因此，对于外键，您需要执行以下操作：

```
class ItemForm(ModelForm):

    def __init__(self, *args, **kwargs):
        super(ItemForm, self).__init__(*args, **kwargs)
        instance = getattr(self, 'instance', None)
        if instance and instance.id:
            self.fields['sku'].required = False
            self.fields['sku'].widget.attrs['disabled'] = 'disabled'

    def clean_sku(self):
        # As shown in the above answer.
        instance = getattr(self, 'instance', None)
        if instance:
            return instance.sku
        else:
            return self.cleaned_data.get('sku', None) 
```

这样浏览器就不会让用户更改字段，并且始终`POST`保持空白。然后我们重写该`clean`方法以将字段的值设置为实例中最初的值。

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2011-01-10T14:03:02.673

对于 Django 1.2+，您可以像这样覆盖该字段：

```
sku = forms.CharField(widget = forms.TextInput(attrs={'readonly':'readonly'})) 
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2011-07-22T11:54:23.557

我创建了一个 MixIn 类，您可以继承它以便能够添加一个 read_only 可迭代字段，该字段将在非首次编辑时禁用和保护字段：

（基于 Daniel 和 Muhuk 的回答）

```
from django import forms
from django.db.models.manager import Manager

# I used this instead of lambda expression after scope problems
def _get_cleaner(form, field):
    def clean_field():
         value = getattr(form.instance, field, None)
         if issubclass(type(value), Manager):
             value = value.all()
         return value
    return clean_field

class ROFormMixin(forms.BaseForm):
    def __init__(self, *args, **kwargs):
        super(ROFormMixin, self).__init__(*args, **kwargs)
        if hasattr(self, "read_only"):
            if self.instance and self.instance.pk:
                for field in self.read_only:
                    self.fields[field].widget.attrs['readonly'] = "readonly"
                    setattr(self, "clean_" + field, _get_cleaner(self, field))

# Basic usage
class TestForm(AModelForm, ROFormMixin):
    read_only = ('sku', 'an_other_field') 
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2013-02-28T11:40:12.783

我刚刚为只读字段创建了最简单的小部件 - 我真的不明白为什么表单还没有这个：

```
class ReadOnlyWidget(widgets.Widget):
    """Some of these values are read only - just a bit of text..."""
    def render(self, _, value, attrs=None):
        return value 
```

在表格中：

```
my_read_only = CharField(widget=ReadOnlyWidget()) 
```

非常简单 - 让我只是输出。在带有一堆只读值的表单集中很方便。当然 - 你也可以更聪明一点，给它一个带有 attrs 的 div，这样你就可以向它附加类。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2011-03-08T20:51:34.080

我遇到了类似的问题。看起来我可以通过在我的类中定义一个`get_readonly_fields`方法来解决它。`ModelAdmin`

像这样的东西：

```
# In the admin.py file

class ItemAdmin(admin.ModelAdmin):

    def get_readonly_display(self, request, obj=None):
        if obj:
            return ['sku']
        else:
            return [] 
```

好消息是，`obj`当您添加新项目时它将是无，或者当您更改现有项目时它将是正在编辑的对象。

`get_readonly_display`记录[在这里](https://docs.djangoproject.com/en/stable/ref/contrib/admin/#modeladmin-methods)。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2017-07-24T15:34:58.527

我如何使用 Django 1.11 做到这一点：

```
class ItemForm(ModelForm):
    disabled_fields = ('added_by',)

    class Meta:
        model = Item
        fields = '__all__'

    def __init__(self, *args, **kwargs):
        super(ItemForm, self).__init__(*args, **kwargs)
        for field in self.disabled_fields:
            self.fields[field].disabled = True 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2018-03-26T08:15:13.413

对于 django 1.9+，
您可以使用 Fields disabled 参数来禁用字段。例如，在 forms.py 文件中的以下代码片段中，我已禁用employee_code 字段

```
class EmployeeForm(forms.ModelForm):
    employee_code = forms.CharField(disabled=True)
    class Meta:
        model = Employee
        fields = ('employee_code', 'designation', 'salary') 
```

参考 [https://docs.djangoproject.com/en/dev/ref/forms/fields/#disabled](https://docs.djangoproject.com/en/dev/ref/forms/fields/#disabled)

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2011-03-16T08:09:03.427

一个简单的选择是只输入`form.instance.fieldName`模板而不是`form.fieldName`.

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2012-03-30T13:36:21.720

再一次，我将提供另一种解决方案 :) 我使用的是[Humphrey 的代码](https://stackoverflow.com/questions/324477/in-a-django-form-how-do-i-make-a-field-readonly-or-disabled-so-that-it-cannot/1424453#1424453)，所以这是基于此的。

但是，我遇到了字段是`ModelChoiceField`. 一切都会根据第一个请求进行。但是，如果表单集尝试添加新项目但验证失败，则`SELECTED`选项被重置为 default的“现有”表单出现问题`---------`。

无论如何，我无法弄清楚如何解决这个问题。所以相反，（我认为这实际上在表单中更干净），我制作了 fields `HiddenInputField()`。这只是意味着您必须在模板中做更多的工作。

所以对我来说，解决方法是简化表格：

```
class ItemForm(ModelForm):

    def __init__(self, *args, **kwargs):
        super(ItemForm, self).__init__(*args, **kwargs)
        instance = getattr(self, 'instance', None)
        if instance and instance.id:
            self.fields['sku'].widget=HiddenInput() 
```

然后在模板中，您需要对[formset 进行一些手动循环](https://docs.djangoproject.com/en/dev//topics/forms/modelforms/#using-the-formset-in-the-template)。

因此，在这种情况下，您将在模板中执行以下操作：

```
<div>
    {{ form.instance.sku }} <!-- This prints the value -->
    {{ form }} <!-- Prints form normally, and makes the hidden input -->
</div> 
```

这对我来说效果更好，而且形式操作更少。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2011-03-10T03:28:10.370

作为对[Humphrey 帖子](https://stackoverflow.com/questions/324477/in-a-django-form-how-do-i-make-a-field-readonly-or-disabled-so-that-it-cannot/1424453#1424453)的有用补充，我遇到了 django-reversion 的一些问题，因为它仍然将禁用字段注册为“已更改”。下面的代码解决了这个问题。

```
class ItemForm(ModelForm):

    def __init__(self, *args, **kwargs):
        super(ItemForm, self).__init__(*args, **kwargs)
        instance = getattr(self, 'instance', None)
        if instance and instance.id:
            self.fields['sku'].required = False
            self.fields['sku'].widget.attrs['disabled'] = 'disabled'

    def clean_sku(self):
        # As shown in the above answer.
        instance = getattr(self, 'instance', None)
        if instance:
            try:
                self.changed_data.remove('sku')
            except ValueError, e:
                pass
            return instance.sku
        else:
            return self.cleaned_data.get('sku', None) 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2011-05-13T16:06:00.807

由于我还不能发表评论（[muhuk 的解决方案](https://stackoverflow.com/questions/324477/in-a-django-form-how-do-i-make-a-field-readonly-or-disabled-so-that-it-cannot/331550#331550)），我将作为单独的答案回复。这是一个完整的代码示例，对我有用：

```
def clean_sku(self):
  if self.instance and self.instance.pk:
    return self.instance.sku
  else:
    return self.cleaned_data['sku'] 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-02-09T03:02:45.290

我遇到了同样的问题，所以我创建了一个似乎适用于我的用例的 Mixin。

```
class ReadOnlyFieldsMixin(object):
    readonly_fields =()

    def __init__(self, *args, **kwargs):
        super(ReadOnlyFieldsMixin, self).__init__(*args, **kwargs)
        for field in (field for name, field in self.fields.iteritems() if name in self.readonly_fields):
            field.widget.attrs['disabled'] = 'true'
            field.required = False

    def clean(self):
        cleaned_data = super(ReadOnlyFieldsMixin,self).clean()
        for field in self.readonly_fields:
           cleaned_data[field] = getattr(self.instance, field)

        return cleaned_data 
```

用法，只需定义哪些必须是只读的：

```
class MyFormWithReadOnlyFields(ReadOnlyFieldsMixin, MyForm):
    readonly_fields = ('field1', 'field2', 'fieldx') 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2016-04-20T13:46:30.830

根据[Yamikep 的回答](https://stackoverflow.com/questions/324477/in-a-django-form-how-do-i-make-a-field-readonly-or-disabled-so-that-it-cannot/21654713#21654713)，我找到了一个更好且非常简单的解决方案，它也可以处理`ModelMultipleChoiceField`字段。

从中删除字段`form.cleaned_data`会阻止保存字段：

```
class ReadOnlyFieldsMixin(object):
    readonly_fields = ()

    def __init__(self, *args, **kwargs):
        super(ReadOnlyFieldsMixin, self).__init__(*args, **kwargs)
        for field in (field for name, field in self.fields.iteritems() if
                      name in self.readonly_fields):
            field.widget.attrs['disabled'] = 'true'
            field.required = False

    def clean(self):
        for f in self.readonly_fields:
            self.cleaned_data.pop(f, None)
        return super(ReadOnlyFieldsMixin, self).clean() 
```

用法：

```
class MyFormWithReadOnlyFields(ReadOnlyFieldsMixin, MyForm):
    readonly_fields = ('field1', 'field2', 'fieldx') 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2016-08-19T10:13:11.297

如果您需要多个只读字段。您可以使用下面给出的任何方法

**方法一**

```
class ItemForm(ModelForm):
    readonly = ('sku',)

    def __init__(self, *arg, **kwrg):
        super(ItemForm, self).__init__(*arg, **kwrg)
        for x in self.readonly:
            self.fields[x].widget.attrs['disabled'] = 'disabled'

    def clean(self):
        data = super(ItemForm, self).clean()
        for x in self.readonly:
            data[x] = getattr(self.instance, x)
        return data 
```

**方法二**

继承方法

```
class AdvancedModelForm(ModelForm):

    def __init__(self, *arg, **kwrg):
        super(AdvancedModelForm, self).__init__(*arg, **kwrg)
        if hasattr(self, 'readonly'):
            for x in self.readonly:
                self.fields[x].widget.attrs['disabled'] = 'disabled'

    def clean(self):
        data = super(AdvancedModelForm, self).clean()
        if hasattr(self, 'readonly'):
            for x in self.readonly:
                data[x] = getattr(self.instance, x)
        return data

class ItemForm(AdvancedModelForm):
    readonly = ('sku',) 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2020-08-02T14:04:32.783

您可以在小部件中优雅地添加只读：

```
class SurveyModaForm(forms.ModelForm):
    class Meta:
        model  = Survey
        fields = ['question_no']
        widgets = {
        'question_no':forms.NumberInput(attrs={'class':'form-control','readonly':True}),
        } 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2012-06-15T21:44:12.160

对于 Admin 版本，如果您有多个字段，我认为这是一种更紧凑的方式：

```
def get_readonly_fields(self, request, obj=None):
    skips = ('sku', 'other_field')
    fields = super(ItemAdmin, self).get_readonly_fields(request, obj)

    if not obj:
        return [field for field in fields if not field in skips]
    return fields 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2013-11-27T15:40:44.977

带有一个通用示例的另外两种（相似）方法：

1）第一种方法 - 删除 save() 方法中的字段，例如（未测试；））：

```
def save(self, *args, **kwargs):
    for fname in self.readonly_fields:
        if fname in self.cleaned_data:
            del self.cleaned_data[fname]
    return super(<form-name>, self).save(*args,**kwargs) 
```

2）第二种方法 - 在 clean 方法中将字段重置为初始值：

```
def clean_<fieldname>(self):
    return self.initial[<fieldname>] # or getattr(self.instance, fieldname) 
```

基于第二种方法，我将其概括如下：

```
from functools                 import partial

class <Form-name>(...):

    def __init__(self, ...):
        ...
        super(<Form-name>, self).__init__(*args, **kwargs)
        ...
        for i, (fname, field) in enumerate(self.fields.iteritems()):
            if fname in self.readonly_fields:
                field.widget.attrs['readonly'] = "readonly"
                field.required = False
                # set clean method to reset value back
                clean_method_name = "clean_%s" % fname
                assert clean_method_name not in dir(self)
                setattr(self, clean_method_name, partial(self._clean_for_readonly_field, fname=fname))

    def _clean_for_readonly_field(self, fname):
        """ will reset value to initial - nothing will be changed 
            needs to be added dynamically - partial, see init_fields
        """
        return self.initial[fname] # or getattr(self.instance, fieldname) 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2012-09-04T10:50:36.010

这是一个稍微复杂的版本，基于[christophe31 的回答](https://stackoverflow.com/questions/324477/in-a-django-form-how-do-i-make-a-field-readonly-or-disabled-so-that-it-cannot/6789609#6789609)。它不依赖于“只读”属性。这使得它的问题，比如选择框仍然可以改变和数据选择器仍然弹出，消失了。

相反，它将表单字段小部件包装在只读小部件中，从而使表单仍然有效。原始小部件的内容显示在`<span class="hidden"></span>`标签内。如果小部件有一个`render_readonly()`方法，它会将其用作可见文本，否则它会解析原始小部件的 HTML 并尝试猜测最佳表示。

```
import django.forms.widgets as f
import xml.etree.ElementTree as etree
from django.utils.safestring import mark_safe

def make_readonly(form):
    """
    Makes all fields on the form readonly and prevents it from POST hacks.
    """

    def _get_cleaner(_form, field):
        def clean_field():
            return getattr(_form.instance, field, None)
        return clean_field

    for field_name in form.fields.keys():
        form.fields[field_name].widget = ReadOnlyWidget(
            initial_widget=form.fields[field_name].widget)
        setattr(form, "clean_" + field_name, 
                _get_cleaner(form, field_name))

    form.is_readonly = True

class ReadOnlyWidget(f.Select):
    """
    Renders the content of the initial widget in a hidden <span>. If the
    initial widget has a ``render_readonly()`` method it uses that as display
    text, otherwise it tries to guess by parsing the html of the initial widget.
    """

    def __init__(self, initial_widget, *args, **kwargs):
        self.initial_widget = initial_widget
        super(ReadOnlyWidget, self).__init__(*args, **kwargs)

    def render(self, *args, **kwargs):
        def guess_readonly_text(original_content):
            root = etree.fromstring("<span>%s</span>" % original_content)

            for element in root:
                if element.tag == 'input':
                    return element.get('value')

                if element.tag == 'select':
                    for option in element:
                        if option.get('selected'):
                            return option.text

                if element.tag == 'textarea':
                    return element.text

            return "N/A"

        original_content = self.initial_widget.render(*args, **kwargs)
        try:
            readonly_text = self.initial_widget.render_readonly(*args, **kwargs)
        except AttributeError:
            readonly_text = guess_readonly_text(original_content)

        return mark_safe("""<span class="hidden">%s</span>%s""" % (
            original_content, readonly_text))

# Usage example 1.
self.fields['my_field'].widget = ReadOnlyWidget(self.fields['my_field'].widget)

# Usage example 2.
form = MyForm()
make_readonly(form) 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2021-12-20T05:27:29.563

你可以这样做：

1.  检查请求是更新还是保存新对象。
2.  如果请求是更新，则禁用字段`sku`。
3.  如果请求是添加一个新对象，那么您必须在不禁用该字段的情况下呈现表单`sku`。

这是一个如何做到这一点的例子。

```
class Item(models.Model):
    sku = models.CharField(max_length=50)
    description = models.CharField(max_length=200)
    added_by = models.ForeignKey(User)

class ItemForm(ModelForm):
    def disable_sku_field(self):
        elf.fields['sku'].widget.attrs['readonly'] = True

    class Meta:
        model = Item
        exclude = ('added_by')

def new_item_view(request):
    if request.method == 'POST':
        form = ItemForm(request.POST)
        # Just create an object or instance of the form.
        # Validate and save
    else:
            form = ItemForm()
    # Render the view 
```

```
def update_item_view(request):
    if request.method == 'POST':
        form = ItemForm(request.POST)
        # Just create an object or instance of the form.
        # Validate and save
    else:
        form = ItemForm()
        form.disable_sku_field() # call the method that will disable field.

    # Render the view with the form that will have the `sku` field disabled on it. 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-02-02T15:44:57.893

这是最简单的方法吗？

就在这样的视图代码中：

```
def resume_edit(request, r_id):
    .....    
    r = Resume.get.object(pk=r_id)
    resume = ResumeModelForm(instance=r)
    .....
    resume.fields['email'].widget.attrs['readonly'] = True 
    .....
    return render(request, 'resumes/resume.html', context) 
```

它工作正常！

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2018-09-03T11:50:30.520

如果您正在使用`Django ver < 1.9`（`1.9`已添加`Field.disabled`属性），您可以尝试将以下装饰器添加到您的表单`__init__`方法中：

```
def bound_data_readonly(_, initial):
    return initial

def to_python_readonly(field):
    native_to_python = field.to_python

    def to_python_filed(_):
        return native_to_python(field.initial)

    return to_python_filed

def disable_read_only_fields(init_method):

    def init_wrapper(*args, **kwargs):
        self = args[0]
        init_method(*args, **kwargs)
        for field in self.fields.values():
            if field.widget.attrs.get('readonly', None):
                field.widget.attrs['disabled'] = True
                setattr(field, 'bound_data', bound_data_readonly)
                setattr(field, 'to_python', to_python_readonly(field))

    return init_wrapper

class YourForm(forms.ModelForm):

    @disable_read_only_fields
    def __init__(self, *args, **kwargs):
        ... 
```

主要思想是，如果字段是，则`readonly`不需要任何其他值，除了`initial`.

PS：别忘了设置`yuor_form_field.widget.attrs['readonly'] = True`

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2021-11-09T17:10:53.050

今天，我在类似的用例中遇到了完全相同的问题。但是，我不得不处理基于类的视图。基于类的视图允许继承属性和方法，从而更容易以简洁的方式重用代码。

我将通过讨论为用户创建个人资料页面所需的代码来回答您的问题。在此页面上，他们可以更新他们的个人信息。但是，我想在不允许用户更改信息的情况下显示一个电子邮件字段。

是的，我本可以省略电子邮件字段，但我的强迫症不允许这样做。

在下面的示例中，我将表单类与 disabled = True 方法结合使用。此代码在 Django==2.2.7 上测试。

```
 # form class in forms.py

# Alter import User if you have created your own User class with Django default as abstract class.
from .models import User 
# from django.contrib.auth.models import User

# Same goes for these forms.
from django.contrib.auth.forms import UserCreationForm, UserChangeForm

class ProfileChangeForm(UserChangeForm):

    class Meta(UserCreationForm)
        model = User
        fields = ['first_name', 'last_name', 'email',]

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.fields['email'].disabled = True 
```

可以看到，指定了所需的用户字段。这些是必须在个人资料页面上显示的字段。如果需要添加其他字段，则必须在 User 类中指定它们，并将属性名称添加到此表单的 Meta 类的字段列表中。

在获得所需的元数据后，调用 __init__ 方法来初始化表单。但是，在此方法中，电子邮件字段参数“已禁用”设置为 True。这样做会改变前端字段的行为，从而导致只读字段即使更改 HTML 代码也无法编辑。[参考字段.disabled](https://docs.djangoproject.com/en/3.2/ref/forms/fields/#disabled)

为了完成，在下面的示例中可以看到使用表单所需的基于类的视图。

```
 # view class in views.py

from django.contrib import messages
from django.contrib.messages.views import SuccessMessageMixin
from django.contrib.auth.mixins import LoginRequiredMixin
from django.views.generic import TemplateView, UpdateView
from django.utils.translation import gettext_lazy as _

class ProfileView(LoginRequiredMixin, TemplateView):
    template_name = 'app_name/profile.html'
    model = User

   def get_context_data(self, **kwargs):
      context = super().get_context_data(**kwargs)
      context.update({'user': self.request.user, })
      return context

class UserUpdateView(LoginRequiredMixin, SuccesMessageMixin, UpdateView):
    template_name = 'app_name/update_profile.html'
    model = User
    form_class = ProfileChangeForm
    success_message = _("Successfully updated your personal information")

    def get_success_url(self):
        # Please note, one has to specify a get_absolute_url() in the User class
        # In my case I return:  reverse("app_name:profile")
        return self.request.user.get_absolute_url()

    def get_object(self, **kwargs):
        return self.request.user

    def form_valid(self, form):
        messages.add_message(self.request, messages.INFO, _("Successfully updated your profile"))
        return super().form_valid(form) 
```

ProfileView 类只显示一个 HTML 页面，其中包含有关用户的一些信息。此外，它还包含一个按钮，如果按下该按钮，就会进入由 UserUpdateView 配置的 HTML 页面，即“app_name/update_profile.html”。可以看到，UserUpdateView 拥有两个额外的属性，即“form_class”和“success_message”。

视图知道页面上的每个字段都必须填充来自用户模型的数据。但是，通过引入“form_class”属性，视图不会获得用户字段的默认布局。相反，它被重定向以通过表单类检索字段。这在灵活性方面具有巨大的优势。

通过使用表单类，可以为不同的用户显示具有不同限制的不同字段。如果在模型本身内设置限制，每个用户都会得到相同的待遇。

模板本身并不那么壮观，但可以在下面看到。

```
 # HTML template in 'templates/app_name/update_profile.html' 

{% extends "base.html" %}
{% load static %}
{% load crispy_form_tags %}

{% block content %}

<h1>
    Update your personal information
<h1/>
<div>
    <form class="form-horizontal" method="post" action="{% url 'app_name:update' %}">
        {% csrf_token %} 
        {{ form|crispy }}
        <div class="btn-group">
            <button type="submit" class="btn btn-primary">
                Update
            </button>
        </div>
</div>

{% endblock %} 
```

可以看出，表单标签包含一个包含视图 URL 路由的操作标签。按下更新按钮后，UserUpdateView 被激活，它会验证是否满足所有条件。如果是，则触发 form_valid 方法并添加成功消息。成功更新数据后，用户将返回到 get_success_url 方法中的指定 URL。

下面可以找到允许视图 URL 路由的代码。

```
# URL routing for views in urls.py

from django.urls import path
from . import views

app_name = 'app_name'

urlpatterns = [
    path('profile/', view=views.ProfileView.as_view(), name='profile'),
    path('update/', view=views.UserUpdateView.as_view(), name='update'),
    ] 
```

你有它。使用表单的基于类的视图的完整实现，因此可以将电子邮件字段更改为只读和禁用。

对于非常详细的示例，我深表歉意。可能有更有效的方法来设计基于类的视图，但这应该可行。当然，我可能对某些事情说错了。我也在学习。如果有人有任何意见或改进，请告诉我！

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-03-24T06:37:40.760

如果您使用的是 Django admin，这里是最简单的解决方案。

```
class ReadonlyFieldsMixin(object):
    def get_readonly_fields(self, request, obj=None):
        if obj:
            return super(ReadonlyFieldsMixin, self).get_readonly_fields(request, obj)
        else:
            return tuple()

class MyAdmin(ReadonlyFieldsMixin, ModelAdmin):
    readonly_fields = ('sku',) 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-04-30T18:15:20.690

我认为你最好的选择就是在你的模板中包含 readonly 属性，`<span>`或者`<p>`如果它是只读的，而不是将它包含在表单中。

表格用于收集数据，而不是显示它。话虽如此，在`readonly`小部件中显示和清理 POST 数据的选项是很好的解决方案。

# visual-studio - 构建安装项目的问题

> ID：324482
> 
> 赞同：1
> 
> 时间：2008-11-27T18:59:01.250
> 
> 标签：visual-studio, deployment, installation, build-automation

我正在开发一种工具来简化应用程序的部署。因此，我的目标是自动化安装项目的构建。

情况：当我使用 Visual Studio 构建安装项目时，创建了 msi 和 exe 文件并成功结束。当我在命令提示符下运行命令时出现问题，我不断收到此错误*“错误：找不到项目输出组的输出'（无法确定名称）'”*

命令提示符的命令是：

> C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE>devenv "C:\Project's Directory\Project.Setup.vdproj" /Build

任何人都可以帮助我。我真的被困住了。

* * *

编辑：我的问题的解决方案是创建一个解决方案，其中包含设置项目和实际上是设置项目的输出项目的项目。

> C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE>devenv "C:\Project's Directory\Project.Setup.sln" /Build

谢谢大家。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T00:11:41.540

你不能这样做。

问题是您已将设置项目的输入定义为解决方案中其他项目的输出。您必须构建整个解决方案才能使用此方法。

您可以这样做，但您必须手动将所需的所有文件链接到安装项目中。这有点棘手，但同样可行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T00:09:49.157

我怀疑您有一个安装项目正在引用另一个项目的输出。在这种情况下，您需要使用

```
devenv [solutionname] /build 
```

您收到错误的原因是因为 Visual Studio 尚未编译引用的项目。

旁注：如果您尝试在 vs 2005 或更高版本中自动化构建，我会调查[wix](http://wix.sourceforge.net)，因为使用 msbuild 更容易自动化。

# .net - 如何使用 .Net 检查 Active Directory 服务器是否已启动并正在运行？

> ID：324484
> 
> 赞同：7
> 
> 时间：2008-11-27T19:00:49.390
> 
> 标签：.net, active-directory, ldap

在尝试查询 AD 服务器之前，我想检查它是否还活着并且正在运行。看起来像一件微不足道的事情，但我还没有找到任何东西来阐明这一点。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T19:35:39.960

我只是尝试获取与正在运行的用户关联的当前域上下文：

```
try {
    var domain = Domain.GetCurrentDomain();
    /* Whatever i need from the domain */
} catch(ActiveDirectoryOperationException ex) {
    MessageBox.Show("Cannot contact AD Server");
} 
```

* * *

如果您想连接到另一个域，您可以尝试：

```
try {
    var domain = Domain.GetDomain(
        new DirectoryContext(DirectoryContextType.Domain, "mydomain.local"));
    /* Whatever i need from the domain */
} catch(ActiveDirectoryOperationException ex) {
    MessageBox.Show("Cannot contact AD Server");
} 
```

# javascript - 您如何使用 JavaScript 读取 CSS 规则值？

> ID：324486
> 
> 赞同：127
> 
> 时间：2008-11-27T19:02:00.403
> 
> 标签：javascript, html, css

我想返回一个包含 CSS 规则所有内容的字符串，就像您在内联样式中看到的格式一样。我希望能够在不知道特定规则中包含什么的情况下做到这一点，所以我不能只通过样式名称（如`.style.width`等）将它们拉出来

CSS：

```
.test {
    width:80px;
    height:50px;
    background-color:#808080;
} 
```

到目前为止的代码：

```
function getStyle(className) {
    var classes = document.styleSheets[0].rules || document.styleSheets[0].cssRules
    for(var x=0;x<classes.length;x++) {
        if(classes[x].selectorText==className) {
            //this is where I can collect the style information, but how?
        }
    }
}
getStyle('.test') 
```

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-11-27T19:36:26.043

改编自[此处](http://www.javascriptkit.com/domref/cssrule.shtml)，以 scunliffe 的回答为基础：

```
function getStyle(className) {
    var cssText = "";
    var classes = document.styleSheets[0].rules || document.styleSheets[0].cssRules;
    for (var x = 0; x < classes.length; x++) {        
        if (classes[x].selectorText == className) {
            cssText += classes[x].cssText || classes[x].style.cssText;
        }         
    }
    return cssText;
}

alert(getStyle('.test')); 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2014-12-17T14:09:06.473

由于“nsdel”接受的答案仅适用于文档中的一个样式表，因此这是经过调整的完整工作解决方案：

```
 /**
     * Gets styles by a classname
     * 
     * @notice The className must be 1:1 the same as in the CSS
     * @param string className_
     */
    function getStyle(className_) {

        var styleSheets = window.document.styleSheets;
        var styleSheetsLength = styleSheets.length;
        for(var i = 0; i < styleSheetsLength; i++){
            var classes = styleSheets[i].rules || styleSheets[i].cssRules;
            if (!classes)
                continue;
            var classesLength = classes.length;
            for (var x = 0; x < classesLength; x++) {
                if (classes[x].selectorText == className_) {
                    var ret;
                    if(classes[x].cssText){
                        ret = classes[x].cssText;
                    } else {
                        ret = classes[x].style.cssText;
                    }
                    if(ret.indexOf(classes[x].selectorText) == -1){
                        ret = classes[x].selectorText + "{" + ret + "}";
                    }
                    return ret;
                }
            }
        }

    } 
```

注意：选择器必须与 CSS 中的相同。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2015-03-18T18:43:15.170

# 解决方案 1（跨浏览器）

```
function GetProperty(classOrId,property)
{ 
    var FirstChar = classOrId.charAt(0);  var Remaining= classOrId.substring(1);
    var elem = (FirstChar =='#') ?  document.getElementById(Remaining) : document.getElementsByClassName(Remaining)[0];
    return window.getComputedStyle(elem,null).getPropertyValue(property);
}

alert( GetProperty(".my_site_title","position") ) ; 
```

# 解决方案 2（跨浏览器）

```
function GetStyle(CLASSname) 
{
    var styleSheets = document.styleSheets;
    var styleSheetsLength = styleSheets.length;
    for(var i = 0; i < styleSheetsLength; i++){
        if (styleSheets[i].rules ) { var classes = styleSheets[i].rules; }
        else { 
            try {  if(!styleSheets[i].cssRules) {continue;} } 
            //Note that SecurityError exception is specific to Firefox.
            catch(e) { if(e.name == 'SecurityError') { console.log("SecurityError. Cant readd: "+ styleSheets[i].href);  continue; }}
            var classes = styleSheets[i].cssRules ;
        }
        for (var x = 0; x < classes.length; x++) {
            if (classes[x].selectorText == CLASSname) {
                var ret = (classes[x].cssText) ? classes[x].cssText : classes[x].style.cssText ;
                if(ret.indexOf(classes[x].selectorText) == -1){ret = classes[x].selectorText + "{" + ret + "}";}
                return ret;
            }
        }
    }
}

alert( GetStyle('.my_site_title') ); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2016-10-28T05:09:18.600

我发现没有任何建议真正有效。这是一种更强大的方法，可以在查找类时标准化间距。

```
//Inside closure so that the inner functions don't need regeneration on every call.
const getCssClasses = (function () {
    function normalize(str) {
        if (!str)  return '';
        str = String(str).replace(/\s*([>~+])\s*/g, ' $1 ');  //Normalize symbol spacing.
        return str.replace(/(\s+)/g, ' ').trim();           //Normalize whitespace
    }
    function split(str, on) {               //Split, Trim, and remove empty elements
        return str.split(on).map(x => x.trim()).filter(x => x);
    }
    function containsAny(selText, ors) {
        return selText ? ors.some(x => selText.indexOf(x) >= 0) : false;
    }
    return function (selector) {
        const logicalORs = split(normalize(selector), ',');
        const sheets = Array.from(window.document.styleSheets);
        const ruleArrays = sheets.map((x) => Array.from(x.rules || x.cssRules || []));
        const allRules = ruleArrays.reduce((all, x) => all.concat(x), []);
        return allRules.filter((x) => containsAny(normalize(x.selectorText), logicalORs));
    };
})(); 
```

这是 Chrome 控制台的实际操作。

[![在此处输入图像描述](https://i.stack.imgur.com/AElQK.png)](https://i.stack.imgur.com/AElQK.png)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-08T19:31:21.977

需要注意的一些浏览器差异：

给定CSS：

```
div#a { ... }
div#b, div#c { ... } 
```

并给出 InsDel 的示例，类将**在 FF 中有 2 个类，在 IE7 中**有 3 个类。

我的例子说明了这一点：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <style>
    div#a { }
    div#b, div#c { }
    </style>
    <script>
    function PrintRules() {
    var rules = document.styleSheets[0].rules || document.styleSheets[0].cssRules
        for(var x=0;x<rules.length;x++) {
            document.getElementById("rules").innerHTML += rules[x].selectorText + "<br />";
        }
    }
    </script>
</head>
<body>
    <input onclick="PrintRules()" type="button" value="Print Rules" /><br />
    RULES:
    <div id="rules"></div>
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-08-05T03:38:23.450

这是遍历页面中所有规则的代码：

```
function iterateCSS(f) {
  for (const styleSheet of window.document.styleSheets) {
    const classes = styleSheet.rules || styleSheet.cssRules;
    if (!classes) continue;

    for (const cssRule of classes) {
      if (cssRule.type !== 1 || !cssRule.style) continue;
      const selector = cssRule.selectorText, style=cssRule.style;
      if (!selector || !style.cssText) continue;
      for (let i=0; i<style.length; i++) {
        const propertyName=style.item(i);
        if (f(selector, propertyName, style.getPropertyValue(propertyName), style.getPropertyPriority(propertyName), cssRule)===false) return;
      }
    }
  }
}

iterateCSS( (selector, propertyName, propertyValue, propertyPriority, cssRule) => {
  console.log(selector+' { '+propertyName+': '+propertyValue+(propertyPriority==='important' ? ' !important' : '')+' }');
});
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-05-11T07:10:35.893

```
function getStyle(className) {
    document.styleSheets.item("menu").cssRules.item(className).cssText;
}
getStyle('.test') 
```

注意：“menu”是您应用了 CSS 的元素 ID。"className" 一个 css 类名，我们需要获取它的文本。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-06-18T14:07:10.530

已调整 julmot 的答案以获得更完整的结果。此方法还将返回类是选择器一部分的样式。

```
//Get all styles where the provided class is involved
//Input parameters should be css selector such as .myClass or #m
//returned as an array of tuples {selectorText:"", styleDefinition:""}
function getStyleWithCSSSelector(cssSelector) {
    var styleSheets = window.document.styleSheets;
    var styleSheetsLength = styleSheets.length;
    var arStylesWithCSSSelector = [];

    //in order to not find class which has the current name as prefix
    var arValidCharsAfterCssSelector = [" ", ".", ",", "#",">","+",":","["];

    //loop through all the stylessheets in the bor
    for(var i = 0; i < styleSheetsLength; i++){
        var classes = styleSheets[i].rules || styleSheets[i].cssRules;
        var classesLength = classes.length;
        for (var x = 0; x < classesLength; x++) {
            //check for any reference to the class in the selector string
            if(typeof classes[x].selectorText != "undefined"){
                var matchClass = false;

                if(classes[x].selectorText === cssSelector){//exact match
                    matchClass=true;
                }else {//check for it as part of the selector string
                    //TODO: Optimize with regexp
                    for (var j=0;j<arValidCharsAfterCssSelector.length; j++){
                        var cssSelectorWithNextChar = cssSelector+ arValidCharsAfterCssSelector[j];

                        if(classes[x].selectorText.indexOf(cssSelectorWithNextChar)!=-1){
                            matchClass=true;
                            //break out of for-loop
                            break;
                        }
                    }
                }

                if(matchClass === true){
                    //console.log("Found "+ cssSelectorWithNextChar + " in css class definition " + classes[x].selectorText);
                    var styleDefinition;
                    if(classes[x].cssText){
                        styleDefinition = classes[x].cssText;
                    } else {
                        styleDefinition = classes[x].style.cssText;
                    }
                    if(styleDefinition.indexOf(classes[x].selectorText) == -1){
                        styleDefinition = classes[x].selectorText + "{" + styleDefinition + "}";
                    }
                    arStylesWithCSSSelector.push({"selectorText":classes[x].selectorText, "styleDefinition":styleDefinition});
                }
            }
        }
    }
    if(arStylesWithCSSSelector.length==0) {
        return null;
    }else {
        return arStylesWithCSSSelector;    
    }
} 
```

此外，我还创建了一个函数，将 css 样式定义收集到您提供的根节点的子树中（通过 jquery 选择器）。

```
function getAllCSSClassDefinitionsForSubtree(selectorOfRootElement){
    //stack in which elements are pushed and poped from
    var arStackElements = [];
    //dictionary for checking already added css class definitions
    var existingClassDefinitions = {}

    //use jquery for selecting root element
    var rootElement = $(selectorOfRootElement)[0];
    //string with the complete CSS output
    var cssString = "";

    console.log("Fetching all classes used in sub tree of " +selectorOfRootElement);
    arStackElements.push(rootElement);
    var currentElement;

    while(currentElement = arStackElements.pop()){
        currentElement = $(currentElement);
        console.log("Processing element " + currentElement.attr("id"));

        //Look at class attribute of element 
        var classesString = currentElement.attr("class");
        if(typeof classesString != 'undefined'){
            var arClasses = classesString.split(" ");

            //for each class in the current element
            for(var i=0; i< arClasses.length; i++){

                //fetch the CSS Styles for a single class. Need to append the . char to indicate its a class
                var arStylesWithCSSSelector = getStyleWithCSSSelector("."+arClasses[i]);
                console.log("Processing class "+ arClasses[i]);

                if(arStylesWithCSSSelector != null){
                    //console.log("Found "+ arStylesWithCSSSelector.length + " CSS style definitions for class " +arClasses[i]);
                    //append all found styles to the cssString
                    for(var j=0; j< arStylesWithCSSSelector.length; j++){
                        var tupleStyleWithCSSSelector = arStylesWithCSSSelector[j];

                        //check if it has already been added
                        if(typeof existingClassDefinitions[tupleStyleWithCSSSelector.selectorText] === "undefined"){
                            //console.log("Adding " + tupleStyleWithCSSSelector.styleDefinition);
                            cssString+= tupleStyleWithCSSSelector.styleDefinition;
                            existingClassDefinitions[tupleStyleWithCSSSelector.selectorText] = true;
                        }else {
                            //console.log("Already added " + tupleStyleWithCSSSelector.styleDefinition);
                        }
                    }
                }
            }
        }
        //push all child elments to stack
        if(currentElement.children().length>0){
            arStackElements= arStackElements.concat(currentElement.children().toArray());
        }
    }

    console.log("Found " + Object.keys(existingClassDefinitions).length + " CSS class definitions");
    return cssString;
} 
```

请注意，如果使用相同的选择器多次定义一个类，则上述函数只会选择第一个。请注意，该示例使用 jQuery（但 cab 相对容易被重写为不使用它）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-06-20T05:35:59.710

```
const getStyle = query => [...document.querySelector(query).computedStyleMap().entries()].map(e=>(e[1]+=[],e)).map(e=>e.join`:`+';').join`\n` 
```

在一行中，为任何查询打印出生成的 css。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-27T16:40:50.873

我做了一个类似的辅助函数，它显示了这个页面不需要的样式。将 a 附加`<div>`到正文中，列出所有未使用的样式。

（与萤火虫控制台一起使用）

```
(function getStyles(){var CSSrules,allRules,CSSSheets, unNeeded, currentRule;
CSSSheets=document.styleSheets;

for(j=0;j<CSSSheets.length;j++){
for(i=0;i<CSSSheets[j].cssRules.length;i++){
    currentRule = CSSSheets[j].cssRules[i].selectorText;

    if(!document.querySelectorAll(currentRule).length){ 
       unNeeded+=CSSSheets[j].cssRules[i].cssText+"<br>"; 
  }       
 }
}

docBody=document.getElementsByTagName("body")[0];
allRulesContainer=document.createElement("div");
docBody.appendChild(allRulesContainer);
allRulesContainer.innerHTML=unNeeded+isHover;
return false
})() 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-27T19:32:07.317

//在IE中工作，不确定其他浏览器...

```
alert(classes[x].style.cssText); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-04T22:43:33.610

此版本将遍历页面上的所有样式表。根据我的需要，样式通常位于 20 多个样式表中的倒数第二个，所以我向后检查它们。

```
 var getStyle = function(className){
        var x, sheets,classes;
        for( sheets=document.styleSheets.length-1; sheets>=0; sheets-- ){
            classes = document.styleSheets[sheets].rules || document.styleSheets[sheets].cssRules;
            for(x=0;x<classes.length;x++) {
                if(classes[x].selectorText===className) {
                    return  (classes[x].cssText ? classes[x].cssText : classes[x].style.cssText);
                }
            }
        }
        return false;
    }; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-09-24T16:37:21.000

我添加了对象的返回，其中属性被解析出样式/值：

```
var getClassStyle = function(className){
    var x, sheets,classes;
    for( sheets=document.styleSheets.length-1; sheets>=0; sheets-- ){
        classes = document.styleSheets[sheets].rules || document.styleSheets[sheets].cssRules;
        for(x=0;x<classes.length;x++) {
            if(classes[x].selectorText===className){
                classStyleTxt = (classes[x].cssText ? classes[x].cssText : classes[x].style.cssText).match(/\{\s*([^{}]+)\s*\}/)[1];
                var classStyles = {};
                var styleSets = classStyleTxt.match(/([^;:]+:\s*[^;:]+\s*)/g);
                for(y=0;y<styleSets.length;y++){
                    var style = styleSets[y].match(/\s*([^:;]+):\s*([^;:]+)/);
                    if(style.length > 2)
                        classStyles[style[1]]=style[2];
                }
                return classStyles;
            }
        }
    }
    return false;
}; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-08-03T14:13:48.943

我创建了一个搜索所有样式表并将匹配项作为键/值对象返回的版本。您还可以指定**startsWith**来匹配子样式。

```
getStylesBySelector('.pure-form-html', true); 
```

返回：

```
{
    ".pure-form-html body": "padding: 0; margin: 0; font-size: 14px; font-family: tahoma;",
    ".pure-form-html h1": "margin: 0; font-size: 18px; font-family: tahoma;"
} 
```

从：

```
.pure-form-html body {
    padding: 0;
    margin: 0;
    font-size: 14px;
    font-family: tahoma;
}

.pure-form-html h1 {
    margin: 0;
    font-size: 18px;
    font-family: tahoma;
} 
```

编码：

```
/**
 * Get all CSS style blocks matching a CSS selector from stylesheets
 * @param {string} className - class name to match
 * @param {boolean} startingWith - if true matches all items starting with selector, default = false (exact match only)
 * @example getStylesBySelector('pure-form .pure-form-html ')
 * @returns {object} key/value object containing matching styles otherwise null
 */
function getStylesBySelector(className, startingWith) {

    if (!className || className === '') throw new Error('Please provide a css class name');

    var styleSheets = window.document.styleSheets;
    var result = {};

    // go through all stylesheets in the DOM
    for (var i = 0, l = styleSheets.length; i < l; i++) {

        var classes = styleSheets[i].rules || styleSheets[i].cssRules || [];

        // go through all classes in each document
        for (var x = 0, ll = classes.length; x < ll; x++) {

            var selector = classes[x].selectorText || '';
            var content = classes[x].cssText || classes[x].style.cssText || '';

            // if the selector matches
            if ((startingWith && selector.indexOf(className) === 0) || selector === className) {

                // create an object entry with selector as key and value as content
                result[selector] = content.split(/(?:{|})/)[1].trim();
            }
        }
    }

    // only return object if we have values, otherwise null
    return Object.keys(result).length > 0 ? result : null;
} 
```

我在生产中使用它作为[纯形式](https://github.com/john-doherty/pure-form)项目的一部分。希望能帮助到你。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-11-07T08:15:45.933

我遇到了同样的问题。在伙计们的帮助下，我想出了一个非常聪明的解决方案，可以完全解决这个问题（在 chrome 上运行）。

从网络中提取所有图像

```
 function AllImagesUrl (domain){
  return  performance.getEntries()
    .filter( e=> 
       e.initiatorType == "img" &&
       new RegExp(domain).test(e.name) 
    )
  .map( e=> e.name.replace('some cleaning work here','') ) ``` 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2016-11-10T11:28:26.150

根据@dude 的回答，这应该返回对象中的相关样式，例如：

```
.recurly-input {                                                                                                                                                                             
  display: block;                                                                                                                                                                            
  border-radius: 2px;                                                                                                                                                                        
  -webkit-border-radius: 2px;                                                                                                                                                                
  outline: 0;                                                                                                                                                                                
  box-shadow: none;                                                                                                                                                                          
  border: 1px solid #beb7b3;                                                                                                                                                                 
  padding: 0.6em;                                                                                                                                                                            
  background-color: #f7f7f7;                                                                                                                                                                 
  width:100%;                                                                                                                                                                                
} 
```

这将返回：

```
backgroundColor:
"rgb(247, 247, 247)"
border
:
"1px solid rgb(190, 183, 179)"
borderBottom
:
"1px solid rgb(190, 183, 179)"
borderBottomColor
:
"rgb(190, 183, 179)"
borderBottomLeftRadius
:
"2px"
borderBottomRightRadius
:
"2px"
borderBottomStyle
:
"solid"
borderBottomWidth
:
"1px"
borderColor
:
"rgb(190, 183, 179)"
borderLeft
:
"1px solid rgb(190, 183, 179)"
borderLeftColor
:
"rgb(190, 183, 179)"
borderLeftStyle
:
"solid"
borderLeftWidth
:
"1px"
borderRadius
:
"2px"
borderRight
:
"1px solid rgb(190, 183, 179)"
borderRightColor
:
"rgb(190, 183, 179)"
borderRightStyle
:
"solid"
borderRightWidth
:
"1px"
borderStyle
:
"solid"
borderTop
:
"1px solid rgb(190, 183, 179)"
borderTopColor
:
"rgb(190, 183, 179)"
borderTopLeftRadius
:
"2px"
borderTopRightRadius
:
"2px"
borderTopStyle
:
"solid"
borderTopWidth
:
"1px"
borderWidth
:
"1px"
boxShadow
:
"none"
display
:
"block"
outline
:
"0px"
outlineWidth
:
"0px"
padding
:
"0.6em"
paddingBottom
:
"0.6em"
paddingLeft
:
"0.6em"
paddingRight
:
"0.6em"
paddingTop
:
"0.6em"
width
:
"100%" 
```

代码：

```
function getStyle(className_) {

    var styleSheets = window.document.styleSheets;
    var styleSheetsLength = styleSheets.length;
    for(var i = 0; i < styleSheetsLength; i++){
        var classes = styleSheets[i].rules || styleSheets[i].cssRules;
        if (!classes)
            continue;
        var classesLength = classes.length;
        for (var x = 0; x < classesLength; x++) {
            if (classes[x].selectorText == className_) {
                return _.pickBy(classes[x].style, (v, k) => isNaN(parseInt(k)) && typeof(v) == 'string' && v && v != 'initial' && k != 'cssText' )
            }
        }
    }

} 
```

# lotus-notes - 以编程方式创建 Notes 链接热点 (URL)

> ID：324488
> 
> 赞同：1
> 
> 时间：2008-11-27T19:03:21.990
> 
> 标签：lotus-notes, lotusscript

Notes 客户端的早期版本会自动将*发送*的URL 转换为收件人的可点击链接（无论邮件客户端如何），但在 6.5（可能是更高版本）中不再发生这种情况；也就是说，URL 以纯文本形式发送。Notes UI 允许通过 Create->Hotspot->Link Hotspot 菜单完成，但这会变得乏味。

我正在寻找一种在 LotusScript 中创建链接热点的方法。迄今为止，我的研究使我相信这是不可能的，但可能存在某种黑客行为。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T12:03:25.243

将 url 自动转换为可点击链接是用户的偏好。

在 6.5 中，它是通过 File/Preferences/User Preferences/Basics 设置的。在 8 中，它是通过 File/Preferences/Basic Notes Client Config 设置的。

我认为您不能使用 lotusscript 显式创建 url 链接热点。您可以创建一个 doc 链接，但没有明显的方法可以将其转换为 url 链接。

您可以尝试一种方法，将表单设置为在客户端上呈现直通 html，然后为链接构建相关的 html。

更新以回应评论。

场景是我们想要控制接收邮件的用户看到的内容。我们有几个案例需要考虑。

1.  收件人正在使用 Notes 并通过notes to notes 路由直接接收邮件。
2.  收件人使用任何客户端在互联网上，并允许使用丰富格式的电子邮件。
3.  收件人使用任何客户端在互联网上，并且只允许纯文本电子邮件。

在第一种情况下，如果用户打开该选项，他们将看到链接。您还可以在富文本中创建传递 html，假设在设计中设置了表单选项，它将在 Notes 客户端上呈现。如果它是直接电子邮件，并且您真的不需要任何其他丰富的 Notes 功能，您也可以构建 MIME 消息。

在接下来的两种情况下，您只想发送格式正确的 MIME 消息。在第一种情况下，用户将接受丰富的格式，因此您可以将消息构造为简单的 html 并以这种方式包含链接。在第二种情况下，用户不会，您必须使用纯文本。幸运的是，大多数邮件客户端会自动将纯文本消息中收到的 url 转换为您的链接。这可能是 Notes 客户端中的一个选项。

发送丰富的邮件内容时最好还包括纯文本的 MIME 部分。这样你就不需要关心用户喜欢什么版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-30T14:03:57.940

您需要作弊并创建一个 MIME 条目来获取您的链接。走那条路，你也可以借此机会让它看起来非常好。示例代码在[这个网站上](https://stackoverflow.com/questions/686384/sending-formatted-lotus-notes-rich-text-email-from-excel-vba "示例代码")

# binary - 浮点十六进制八进制二进制

> ID：324491
> 
> 赞同：1
> 
> 时间：2008-11-27T19:04:32.143
> 
> 标签：binary, floating-point, hex, calculator, octal

我正在开发一个计算器，它允许您以八进制、十六进制、二进制，当然还有十进制执行小数点后的计算。尽管找到一种将浮点十进制数转换为浮点十六进制、八进制、二进制（反之亦然）的方法，但我遇到了麻烦。

计划是以十进制进行所有数学运算，然后将结果转换为适当的数字系统。任何帮助、想法或示例将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T19:44:34.450

*嗯……这是我*大学计算机科学“淘汰”课程中的家庭作业。

二进制操作在Schaum 的大纲系列： Seymour Lipschutz*的基本计算机数学中进行了描述。*由于某种原因，23 年后它仍然在我的书架上。

作为提示，将八进制和十六进制转换为二进制，执行操作，再转换回二进制。

或者您可以执行十进制运算并在之后执行八进制/十六进制/二进制的转换。对于所有位置数字系统算术，该过程基本相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T20:23:02.533

您使用的是什么编程语言？将所有内容更改为二进制绝对是一个好主意，对二进制进行数学运算然后转换回来。如果将 (unsigneD) 二进制数乘以 2，则 ti 与左移（C 中的 << 1）相同，除以 2 与位屎右（C 中的 >>）相同。加减法和你在小学做的一样。

另外，请记住，如果您将浮点数转换为 int，它将截断它 int(10.5) = 10;

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T18:45:51.000

几天前我遇到了同样的问题。我找到了[http://www.binaryconvert.com](http://www.binaryconvert.com)，它允许您以任何您想要的顺序在浮点十进制、二进制、八进制和十六进制之间进行转换。

# asp.net - How can generate views in asp.net-mvc unit tests?

> ID：324492
> 
> 赞同：6
> 
> 时间：2008-11-27T19:06:01.643
> 
> 标签：asp.net, asp.net-mvc, unit-testing

Im trying to generate views in unit tests but i can't get around the missing VirtualPathProvider. Most viewengines use the VirtualPathProviderViewEngine base class that gets the provider from the current HostingEnvironment.

```
protected VirtualPathProvider VirtualPathProvider {
    get {
        if (_vpp == null) {
            _vpp = HostingEnvironment.VirtualPathProvider;
        }
        return _vpp;
    }
    set {
        _vpp = value;
    }
} 
```

In unit tests there is no HostingEnvironment, even if i create one there is no current VirtualPathProvider.

How can i workaround this problem? Do i have to create a custom FakeWebFormViewEngine?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T04:57:42.960

VS Team System 2010 中提供了一些适用于您正在尝试做的验收测试的功能。正如 Gregory 提到的，针对 MVC 的 Beamer 单元测试是对控制器进行的。您还可以根据您实现模型的方式来测试模型。

这是争议很大的地方。有些人将模型视为业务实体，而我将它们视为特定于视图的模型的表示。更多的视图模型。由于我的模型中没有真正的功能，我不必对其进行测试。我在 MVC 之外测试了我的 DAL，即业务逻辑层。MVC 确实是表示层的一部分。它是您的演示文稿的分层，而不是您的应用程序。你仍然分层你的应用程序。

就单元测试而言，控制器是您测试的地方。如果有需要测试的方法，您可以测试您的模型。至于视图，它们是由用户或通过像 Watin 这样的自动化测试的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T03:54:30.413

如果这听起来很无知，请原谅我，但是生成视图的目的是什么？我可能遗漏了一些东西，但单元测试的主要重点是“测试单元”。在正确设置的 ASP.NET MVC 应用程序中，需要测试的代码位于控制器及其下方。其实我想说，如果开发得当，它在下面。

视图的测试是用户接受度测试。无论如何，我认为自动化这一点没有任何问题，但我不确定这是必须通过单元测试完成的事情。

我错过了什么吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T01:23:11.510

我也尝试过这样做。不幸的是，问题不只是 VirtualPathProvider (VPP)。VPP 用于将视图或部分视图映射到物理路径以确定文件的存在。不幸的是，ViewContext 以虚拟路径结束，而不是物理路径，因此当呈现视图时，Builder 使用不存在的 HostingEvnironment 属性。

如果您使用的是带有测试功能的 Visual Studio 版本，那么您可以使用 Web 单元测试。这将允许您使用浏览器调用 URL，然后解析响应以检查值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-20T09:17:12.460

您可以尝试[使用 Ivonna](http://ivonna.biz)进行集成（并且在某种程度上是单元）测试您的视图。

# javascript - asp.net mvc & 弹出对话框

> ID：324495
> 
> 赞同：1
> 
> 时间：2008-11-27T19:06:36.073
> 
> 标签：javascript, asp.net-mvc, modal-dialog

人们对在 ASP.Net MVC 中创建弹出窗口有什么建议？我在 Web 表单世界中使用了 AJAX 工具包和组件艺术的方法，并且正在寻找具有类似功能的东西。

人们喜欢哪些 JQUERY 插件？SimpleModal，JBOX（我想这是，它叫什么）

是否值得探索从 AJAX 工具包中提取 JavaScript？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T19:34:15.250

jqModal 看起来很酷[http://dev.iceburg.net/jquery/jqModal/](http://dev.iceburg.net/jquery/jqModal/) - 只做了一些简短的实验，还没有在生产中使用，但是已经为我当前的项目放入了玩具箱。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T15:15:13.213

我喜欢[灯箱](http://leandrovieira.com/projects/jquery/lightbox/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T08:44:58.523

我正在使用[Yahoo 的 YUI Dialog](http://developer.yahoo.com/yui/container/dialog/index.html)。效果很好，您可以轻松连接键盘挂钩，例如“escape”以关闭。它使页面的背景变暗，并且在浏览器中经过了很好的测试。

# perl - 如何从一个 Perl 数组中添加另一个数组中尚未包含的元素？

> ID：324498
> 
> 赞同：10
> 
> 时间：2008-11-27T19:09:56.767
> 
> 标签：perl, arrays

鉴于：

```
my @mylist1;
push(@mylist1,"A");
push(@mylist1,"B");
push(@mylist1,"C");

my @mylist2;
push(@mylist2,"A");
push(@mylist2,"D");
push(@mylist2,"E"); 
```

在 Perl 中插入 mylist2 中的所有元素的最快方法是什么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-27T19:58:10.617

您可以只使用[`List::MoreUtils`](https://metacpan.org/module/List::MoreUtils)模块的`uniq`：

```
use List::MoreUtils qw(uniq);

my @mylist1;
push( @mylist1, "A" );
push( @mylist1, "B" );
push( @mylist1, "C" );

my @mylist2;
push( @mylist2, "A" );
push( @mylist2, "D" );
push( @mylist2, "E" );

@mylist2 = uniq( @mylist1, @mylist2 );

printf "%s\n", ( join ',', @mylist2 );    # A,B,C,D,E 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-27T19:28:40.083

```
my %k;
map { $k{$_} = 1 } @mylist1;
map { $k{$_} = 1 } @mylist2;
@mylist2 = keys %k; 
```

或者：

```
my %k;
map { $k{$_} = 1 } @mylist2;
push(@mylist2, grep { !exists $k{$_} } @mylist1); 
```

实际上 - 这些可能是错误的，因为它们没有考虑到原始列表中是否存在重复项。

你没有在你的问题中说这些列表是应该代表集合（不能包含重复项）还是只是简单的列表。您实际上想要`@mylist2 = @mylist1 U @mylist2`的表明您将它们视为集合。

编辑：将增量更改为分配 - 保存哈希值的读取

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T19:37:26.133

[*截至2008-11-27的原始答案降至“自问题”；从那里开始的分析是 2008 年 11 月 29 日的新分析。*]

最快的 - 不确定。这行得通，尽管它并不漂亮：

```
#!/bin/perl -w
use strict;

my @mylist1;
push(@mylist1,"A");
push(@mylist1,"B");
push(@mylist1,"C");

my @mylist2;
push(@mylist2,"A");
push(@mylist2,"D");
push(@mylist2,"E");

sub value_in
{
    my($value, @array) = @_;
    foreach my $element (@array)
    {
        return 1 if $value eq $element;
    }
    return 0;
}

@mylist2 = (@mylist2, grep { ! value_in($_, @mylist2) } @mylist1);

print sort @mylist2, "\n"; 
```

这避免了将数组转换为散列 - 但对于大型数组，`value_in`子可能会很慢。

由于问题是“什么是最快的方法”，我做了一些基准测试。出乎我意料的是，我的方法是最慢的。令我惊讶的是，最快的方法不是来自 List::MoreUtils。这是测试代码和结果 - 使用我原始提案的修改版本。

```
#!/bin/perl -w
use strict;
use List::MoreUtils  qw(uniq);
use Benchmark::Timer;

my @mylist1;
push(@mylist1,"A");
push(@mylist1,"B");
push(@mylist1,"C");

my @mylist2;
push(@mylist2,"A");
push(@mylist2,"D");
push(@mylist2,"E");

sub value_in
{
    my($value) = shift @_;
    return grep { $value eq $_ } @_;
}

my @mylist3;
my @mylist4;
my @mylist5;
my @mylist6;

my $t = Benchmark::Timer->new(skip=>1);
my $iterations = 10000;

for my $i (1..$iterations)
{
    $t->start('JLv2');
    @mylist3 = (@mylist2, grep { ! value_in($_, @mylist2) } @mylist1);
    $t->stop('JLv2');
}
print $t->report('JLv2');

for my $i (1..$iterations)
{
    $t->start('LMU');
    @mylist4 = uniq( @mylist1, @mylist2 );
    $t->stop('LMU');
}
print $t->report('LMU');

for my $i (1..$iterations)
{
    @mylist5 = @mylist2;
    $t->start('HV1');
    my %k;
    map { $k{$_} = 1 } @mylist5;
    push(@mylist5, grep { !exists $k{$_} } @mylist1);
    $t->stop('HV1');
}
print $t->report('HV1');

for my $i (1..$iterations)
{
    $t->start('HV2');
    my %k;
    map { $k{$_} = 1 } @mylist1;
    map { $k{$_} = 1 } @mylist2;
    @mylist6 = keys %k;
    $t->stop('HV2');
}
print $t->report('HV2');

print sort(@mylist3), "\n";
print sort(@mylist4), "\n";
print sort(@mylist5), "\n";
print sort(@mylist6), "\n";

Black JL: perl xxx.pl
9999 trials of JLv2 (1.298s total), 129us/trial
9999 trials of LMU (968.176ms total), 96us/trial
9999 trials of HV1 (516.799ms total), 51us/trial
9999 trials of HV2 (768.073ms total), 76us/trial
ABCDE
ABCDE
ABCDE
ABCDE
Black JL: 
```

这是在运行 Solaris 10 的古董 Sun E450 上为具有多重性的 32 位 SPARC 编译的 Perl 5.10.0。

我相信测试设置是公平的；他们都将答案生成到一个新数组中，与 mylist1 和 mylist2 分开（因此 mylist1 和 mylist2 可以重复用于下一次测试）。指定为 HV1（哈希值 1）的答案在分配给 @mylist5 之后开始计时，我认为这是正确的。但是，当我在作业前开始计时时，它仍然是最快的：

```
Black JL: perl xxx.pl
9999 trials of JLv2 (1.293s total), 129us/trial
9999 trials of LMU (938.504ms total), 93us/trial
9999 trials of HV1 (505.998ms total), 50us/trial
9999 trials of HV2 (756.722ms total), 75us/trial
ABCDE
ABCDE
ABCDE
ABCDE
9999 trials of HV1A (655.582ms total), 65us/trial
Black JL: 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T19:45:08.817

由于您的“（ABCDE）”评论，我假设您实际上是指将 mylist2 中不在 mylist1 中的那些元素推送到 mylist1。如果这个假设不正确，您需要说明您希望事情以什么顺序结束。

首先，将 mylist1 中的元素存储在散列中，然后将 mylist2 中未在散列中找到的所有元素推送到 mylist1。

```
my %in_mylist1;
@in_mylist1{@mylist1} = ();
push @mylist1, grep ! exists $in_mylist1{$_}, @mylist2; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T00:44:08.500

```
my(%work);
@work{@mylist1, @mylist2} = undef;
@mylist2 = sort keys %work; 
```

# java - Java 在对象释放和垃圾回收后仍然使用系统内存

> ID：324499
> 
> 赞同：9
> 
> 时间：2008-11-27T19:11:11.257
> 
> 标签：java, memory-management, memory-leaks, garbage-collection

我正在运行 JVM 1.5.0（Mac OS X 默认），并且正在活动监视器中监视我的 Java 程序。我有以下内容：

```
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.Date;

public class MemoryTest {

public static void memoryUsage() {
 System.out.println(
     Runtime.getRuntime().totalMemory() - 
     Runtime.getRuntime().freeMemory()
 );
}

public static void main( String[] args ) throws IOException {

    /* create a list */
    ArrayList<Date> list = new ArrayList<Date>();

    /* fill it with lots of data */
    for ( int i = 0; i < 5000000; i++ ) {
        list.add( new Date() );
    } // systems shows ~164 MB of physical being used

    /* clear it */
    memoryUsage();      //  about 154 MB
    list.clear();
    list = null;
    System.gc();
    memoryUsage();      //  about 151 KB, garbage collector worked

    // system still shows 164 MB of physical being used.
    System.out.println("Press enter to end...");
    BufferedReader br = new BufferedReader( 
            new InputStreamReader( System.in )
            );
    br.readLine();
} 
```

}

那么为什么即使垃圾收集器似乎工作得很好，物理内存也没有被释放呢？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-27T19:16:01.903

许多 JVM 从不将内存返回给操作系统。是否这样做是特定于实现的。对于那些不这样做的人，在启动时指定的内存限制（通常通过 -Xmx 标志）是为其他应用程序保留内存的主要方法。

我很难找到关于这个主题的文档，但是[Sun 的 Java 5 的垃圾收集器文档](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html)确实解决了这个问题，这表明在正确的条件下，如果使用正确的收集器，堆将会缩小——默认情况下，如果超过 70 % 的堆是空闲的，它会收缩到只有 40% 是空闲的。控制这些的命令行选项是`-XX:MinHeapFreeRatio`和`-XX:MaxHeapFreeRatio`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-27T19:39:19.283

JVM 有几个命令行选项可以帮助调整 Java 使用的堆大小。每个人都知道（或应该知道） -Xms 和 -Xmx，它们设置了堆的最小和最大大小。

但是还有 -XX:MinHeapFreeRatio 和 -XX:MaxHeapFreeRatio 是 JVM 管理可用空间的各自限制。它通过缩小使用的堆来做到这一点，并且可以降低程序的内存消耗。

您可以在这里找到更多信息：

*   [Sun Java System Application Server Enterprise Edition 8.1 2005Q1 性能调优指南，第 4 章](http://docs.sun.com/source/819-0084/pt_tuningjava.html)
*   [调整垃圾收集大纲](http://www.petefreitag.com/articles/gctuning/)，Pete Freitag

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-27T19:27:45.297

您需要使用特定于 JVM 的分析器来监视程序使用的实际堆空间，而不是分配给 JVM 的内存。

JVM 不仅不愿意释放它分配的堆内存，而且由于各种原因（包括即时编译）而倾向于吞噬空间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T19:16:51.463

操作系统是否可能显示当前分配给程序的内存 - 即使分配了 150~ MB 也不意味着 150~ MB 正在使用中。

# python - Problem with Boolean Expression with a string value from a lIst

> ID：324506
> 
> 赞同：1
> 
> 时间：2008-11-27T19:16:46.410
> 
> 标签：python

I have the following problem:

```
 # line is a line from a file that contains ["baa","beee","0"]
  line = TcsLine.split(",")
  NumPFCs = eval(line[2])
  if NumPFCs==0:
     print line 
```

I want to print all the lines from the file if the second position of the list has a value == 0.

I print the lines but after that the following happens: Traceback (most recent call last):

['baaa', 'beee', '0', '\n']

***BUT after I have the next ERROR***

```
ilation.py", line 141, in ?
    getZeroPFcs()
ilation.py", line 110, in getZeroPFcs
    NumPFCs = eval(line[2])
  File "<string>", line 0 
```

Can you please help me? thanks

What0s

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T21:38:47.340

让我解释一下你在这里做什么。

如果你写：

```
NumPFCs = eval(line[2]) 
```

评估顺序为：

*   取字符串行的第二个字符，即引号'"'
*   将此引用评估为 python 表达式，这是一个错误。

如果你把它写成：

```
NumPFCs = eval(line)[2] 
```

那么评估的顺序是：

*   评估该行，生成一个 python 列表
*   取该列表的第二个元素，这是一个单字符字符串：“0”
*   字符串不能与数字进行比较；这也是一个错误。

用您的话说，您想要执行以下操作：

```
NumPFCs = eval(eval(line)[2]) 
```

或者，稍微好一点，将 NumPFCs 与字符串进行比较：

```
if NumPFCs == "0": 
```

但这可能出错的方式几乎数不胜数。您应该忘记`eval`并尝试使用其他方法：字符串拆分，正则表达式等。其他人已经提供了一些建议，我相信会有更多的建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T07:00:40.030

给猫剥皮的方法有很多种，因为它是:)

不过，在我们开始之前，**不要在不属于你的字符串上使用 eval，**所以如果该字符串曾经离开过你的程序；即它一直保存在一个文件中，通过网络发送，有人可以发送一些讨厌的东西。如果有人可以，你可以肯定有人会。

您可能想查看您的数据格式。将 ["baa","beee","0", "\n"] 之类的字符串放在文件中对我来说没有多大意义。

第一种也是最简单的方法是去掉不需要的东西并进行字符串比较。只要 '0' 字符串看起来总是一样的，并且你不是真的在整数值 0 之后，只有字符模式，这将起作用：

```
TcsLine = '["baa","beee","0"]'

line = TcsLine.strip('[]').split(",")
if line[2] == '"0"':
   print line 
```

* * *

第二种方法类似于第一种方法，只是我们将数字字符串转换为整数，产生您正在寻找的整数值（但打印 'line' 不带所有引号）：

```
TcsLine = '["baa","beee","0"]'

line = [e.strip('"') for e in TcsLine.strip('[]').split(",")]
NumPFCs = int(line[2])
if NumPFCs==0:
   print line 
```

* * *

难道字符串实际上是一个json数组？然后，如果我运行 Python<2.6 或仅在 Python>=2.6 上导入 json，我可能会去获取[simplejson以正确解析它。](http://pypi.python.org/pypi/simplejson)然后将生成的 '0'-string 转换为一个整数，如前面的示例所示。

```
TcsLine = '["baa","beee","0"]'

#import json # for >= Python2.6
import simplejson as json # for <Python2.6

line = json.loads(TcsLine)
NumPFCs = int(line[2])
if NumPFCs==0:
   print line 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T19:30:26.710

Your question is kind of hard to read, but using eval there is definitely not a good idea. Either just do a direct string comparison:

```
line=TcsLine.split(",")
if line[2] == "0":
    print line 
```

or use int

```
line=TcsLine.split(",")
if int(line[2]) == 0:
    print line 
```

Either way, your bad data will fail you.

I'd also recomment reading [PEP 8](http://www.python.org/dev/peps/pep-0008/).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T19:31:04.197

我在您的代码段中看到了一些问题：

1.  你假设列表总是至少有 3 个元素
2.  如果包含的字符串无效，则 eval 将引发异常 python
3.  你说你想要第二个元素，但你访问了第三个元素。

这是一种更安全的方法

```
line=TcsLine.split(",")
if len(line) >=3 and line[2].rfind("0") != -1:
     print line 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T21:15:36.437

我建议使用正则表达式来捕获如何指定 0 的所有变体：带双引号，不带任何引号，带单引号，引号外有额外空格，引号内有空格，你想要什么处理的方括号等。

# .net - .NET：如何在 Active Directory 中查找用户？

> ID：324518
> 
> 赞同：11
> 
> 时间：2008-11-27T19:26:39.260
> 
> 标签：.net, active-directory

如何在 Active Directory 中查找用户？

一些示例用户名是：

*   化身\ian
*   化身\
*   ian@avatopia.com
*   ian@avatopia.local
*   avatopia.com\ian

需要注意的是，我不知道域名的名称，[也不应该对其进行硬编码](https://stackoverflow.com/questions/192366/how-to-grab-ad-credentials-from-client-machine-in-a-web-application#192414)。

堆栈溢出中有一些[示例代码](https://stackoverflow.com/questions/192366/how-to-grab-ad-credentials-from-client-machine-in-a-web-application)失败。

```
using System.DirectoryServices;

/// <summary>
/// Gets the email address, if defined, of a user from Active Directory.
/// </summary>
/// <param name="userid">The userid of the user in question.  Make
/// sure the domain has been stripped first!</param>
/// <returns>A string containing the user's email address, or null
/// if one was not defined or found.</returns>
public static string GetEmail(string userid)
{
    DirectorySearcher searcher;
    SearchResult result;
    string email;

    // Check first if there is a slash in the userid
    // If there is, domain has not been stripped
    if (!userid.Contains("\\"))
    {
        searcher = new DirectorySearcher();
        searcher.Filter = String.Format("(SAMAccountName={0})", userid);
        searcher.PropertiesToLoad.Add("mail");
        result = searcher.FindOne();
        if (result != null)
        {
            email = result.Properties["mail"][0].ToString();
        }
    }

    return email;
} 
```

它专门确保您没有传递完整的用户名。例如

```
Bad: avatopia\ian
Bad: avatar\ian
Good: ian
Good: ian 
```

因为不允许您通过域，所以无法区分两个用户

```
ian
ian 
```

另一个人对 sackoverflow 有[同样的问题](https://stackoverflow.com/questions/161398/finding-a-user-in-active-directory-with-the-login-name)，但接受的答案说你必须

> 首先找到所需域的命名上下文

我[不知道](https://stackoverflow.com/search?q=naming+context+active+directory)“命名上下文”是什么，也不知道“必需域”是什么。我真的不想写一个正则表达式来尝试将用户名解析为域名和帐户名，例如

```
domain.something\user-name 
```

进入

```
domain.something
user-name 
```

因为我知道会有一些我会出错的极端情况。我想要在活动目录中查找用户的正确、预期的方法。

CodeProject 上有一个不错的页面[如何在 Active Directory 中执行几乎所有操作](http://www.codeproject.com/KB/system/everythingInAD.aspx)，但您无法通过用户名查找用户信息

我希望我可以给我的域控制器（[无论它是谁，它在哪里，无论它叫什么](http://weblogs.asp.net/steveschofield/archive/2004/04/28/121857.aspx)）一个用户名，它会确定该用户属于哪个域，与该域控制器通信，并完成工作.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T20:13:16.360

这对我有用。

您应该能够区分不同域控制器（即域/用户名）上的不同用户，因为 ldappath 会有所不同。根据您的说法，您不在乎，因为您[没有指定 ldappath](https://stackoverflow.com/questions/192366/how-to-grab-ad-credentials-from-client-machine-in-a-web-application#192414)。

您正在进行一项关于剥离 User.Identity.Name 的域/的投标交易。但我不确定你在担心什么，你只需要将字符串切成两半，第一次遇到'\'时就该砍了。

如果你不喜欢，你可以使用“正确的方式”：http: [//msdn.microsoft.com/en-us/library/ms973834.aspx](http://msdn.microsoft.com/en-us/library/ms973834.aspx)

这也很好[http://geekswithblogs.net/mhamilton/archive/2005/09/30/55621.aspx](http://geekswithblogs.net/mhamilton/archive/2005/09/30/55621.aspx)

```
 /// This is some imaginary code to show you how to use it

      Session["USER"] = User.Identity.Name.ToString();
      Session["LOGIN"] = RemoveDomainPrefix(User.Identity.Name.ToString()); // not a real function :D
      string ldappath = "LDAP://your_ldap_path";
      // "LDAP://CN=<group name>, CN =<Users>, DC=<domain component>, DC=<domain component>,..."

      Session["cn"] = GetAttribute(ldappath, (string)Session["LOGIN"], "cn");
      Session["displayName"] = GetAttribute(ldappath, (string)Session["LOGIN"], "displayName");
      Session["mail"] = GetAttribute(ldappath, (string)Session["LOGIN"], "mail");
      Session["givenName"] = GetAttribute(ldappath, (string)Session["LOGIN"], "givenName");
      Session["sn"] = GetAttribute(ldappath, (string)Session["LOGIN"], "sn");

/// working code

public static string GetAttribute(string ldappath, string sAMAccountName, string attribute)
    {
        string OUT = string.Empty;

        try
        {
            DirectoryEntry de = new DirectoryEntry(ldappath);
            DirectorySearcher ds = new DirectorySearcher(de);
            ds.Filter = "(&(objectClass=user)(objectCategory=person)(sAMAccountName=" + sAMAccountName + "))";

            SearchResultCollection results = ds.FindAll();

            foreach (SearchResult result in ds.FindAll())
            {
                OUT =  GetProperty(result, attribute);
            }
        }
        catch (Exception t)
        {
            // System.Diagnostics.Debug.WriteLine(t.Message);
        }

        return (OUT != null) ? OUT : string.Empty;
    }

public static string GetProperty(SearchResult searchResult, string PropertyName)
    {
        if (searchResult.Properties.Contains(PropertyName))
        {
            return searchResult.Properties[PropertyName][0].ToString();
        }
        else
        {
            return string.Empty;
        }
    } 
```

对于域/用户名

```
 public static string GetDomain(string s)
    {
        int stop = s.IndexOf("\\");
        return (stop > -1) ?  s.Substring(0, stop + 1) : null;
    }

    public static string GetLogin(string s)
    {
        int stop = s.IndexOf("\\");
        return (stop > -1) ? s.Substring(stop + 1, s.Length - stop - 1) : null;
    } 
```

对于 username@domain 样式

```
 public static string GetDomain(string s) //untested
    {
        int stop = s.IndexOf("@");
        return (stop > -1) ? s.Substring(stop + 1, s.Length - stop - 1) : null;
    }

    public static string GetLogin(string s) //untested
    {
        int stop = s.IndexOf("@");
        return (stop > -1) ?  s.Substring(0, stop) : null;
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T20:56:32.123

我不知道纯.net 方法。但是你可以使用 win32 的[CredUIParseUserName](http://msdn.microsoft.com/en-us/library/aa375175(VS.85).aspx)。

# windows - 如何在程序启动后在不打开控制台的情况下从批处理文件运行程序？

> ID：324539
> 
> 赞同：194
> 
> 时间：2008-11-27T19:42:20.617
> 
> 标签：windows, batch-file

目前我的批处理文件如下所示：

```
myprogram.exe param1 
```

程序启动，但 DOS 窗口仍然打开。我怎样才能关闭它？

* * *

## 回答 #1

> 赞同：281
> 
> 时间：2013-03-21T14:15:12.330

使用启动命令可以防止批处理文件等待程序。只要记住在“开始”之后要运行的程序前面加上一个空的双引号。例如，如果要从批处理命令运行 Visual Studio 2012：

```
Start ""  "C:\Program Files (x86)\Microsoft Visual Studio 11.0\Common7\IDE\devenv.exe" 
```

注意开始后的双引号。

* * *

## 回答 #2

> 赞同：170
> 
> 时间：2008-11-27T19:43:39.443

您可以使用 exit 关键字。这是我的一个批处理文件的示例：

```
start myProgram.exe param1
exit 
```

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-11-27T19:45:13.077

看START命令，可以这样：

```
START rest-of-your-program-name 
```

例如，这个批处理文件将等到记事本退出：

```
@echo off
notepad c:\test.txt 
```

但是，这不会：

```
@echo off
start notepad c:\test.txt 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-11-27T19:48:09.513

从我[自己的问题](https://stackoverflow.com/questions/298562)：

```
start /b myProgram.exe params... 
```

如果您从现有的 DOS 会话启动程序，则可以使用。

如果没有，调用vb脚本

```
wscript.exe invis.vbs myProgram.exe %* 
```

[Windows Script Host Run() 方法](https://stackoverflow.com/questions/298562)采用：

*   intWindowStyle : 0 表示“不可见的窗口”
*   bWaitOnReturn : false 表示您的第一个脚本不需要等待您的第二个脚本完成

这是 invis.vbs：

```
set args = WScript.Arguments
num = args.Count

if num = 0 then
    WScript.Echo "Usage: [CScript | WScript] invis.vbs aScript.bat <some script arguments>"
    WScript.Quit 1
end if

sargs = ""
if num > 1 then
    sargs = " "
    for k = 1 to num - 1
        anArg = args.Item(k)
        sargs = sargs & anArg & " "
    next
end if

Set WshShell = WScript.CreateObject("WScript.Shell")

WshShell.Run """" & WScript.Arguments(0) & """" & sargs, 0, False 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2012-10-02T16:29:27.550

当我尝试从批处理文件运行 java 类时，这是唯一对我有用的东西：

`start "cmdWindowTitle" /B "javaw" -cp . testprojectpak.MainForm`

您可以`start`按照正确的语法为您的项目自定义命令：

```
Syntax
      START "title" [/Dpath] [options] "command" [parameters]

Key:
   title      : Text for the CMD window title bar (required)
   path       : Starting directory
   command    : The command, batch file or executable program to run
   parameters : The parameters passed to the command

Options:
   /MIN       : Minimized
   /MAX       : Maximized
   /WAIT      : Start application and wait for it to terminate
   /LOW       : Use IDLE priority class
   /NORMAL    : Use NORMAL priority class
   /HIGH      : Use HIGH priority class
   /REALTIME  : Use REALTIME priority class

   /B         : Start application without creating a new window. In this case
                ^C will be ignored - leaving ^Break as the only way to 
                interrupt the application
   /I         : Ignore any changes to the current environment.

   Options for 16-bit WINDOWS programs only

   /SEPARATE   Start in separate memory space (more robust)
   /SHARED     Start in shared memory space (default) 
```

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2008-11-27T19:46:36.257

你应该试试这个。它启动没有窗口的程序。它实际上闪烁了一秒钟，但很快就消失了。

```
start "name" /B myprogram.exe param1 
```

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2015-07-18T02:24:24.847

如何解决“空间问题”和本地依赖：

```
@echo off
cd "C:\Program Files\HeidiSQL"
start heidisql.exe

cd "C:\Program Files (x86)\Google\Chrome\Application"
start chrome.exe

exit 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-11-15T15:35:13.817

这个问题已经有很多答案了，但我发布这个是为了澄清一些重要的事情，尽管情况可能并非总是如此：

```
Start "C:\Program Files\someprog.exe" 
```

可能会在某些 Windows 版本中导致问题，因为`Start`实际上期望第一组引号是 Windows 标题。因此，最佳做法是首先双引号注释或空白注释：

```
Start "" "C:\Program Files\someprog.exe" 
```

或者

```
Start "Window Title" "C:\Program Files\someprog.exe" 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-06-22T16:28:57.197

我从 GUI 执行此操作的解决方案：

1.  创建要运行的程序的快捷方式；

2.  编辑快捷方式的属性；

3.  `TARGET`将字段更改为`%COMSPEC% /C "START "" "PROGRAMNAME""`;

4.  `RUN`将字段更改为最小化。

准备好！看你喜欢什么...

PS：程序参数可以在最后两个引号之间插入；该`PROGRAMNAME`字符串可以是文件名、相对路径或绝对路径——如果您输入绝对路径并擦除驱动器号和分号，那么无论主机分配给它的字母是什么，它都可以在拇指驱动器中工作。 . （另外，如果您将快捷方式放在同一个文件夹中并在程序文件名之前`PROGRAMNAME`加上`%CD%`变量，路径将始终匹配；同样的技巧可以在`START IN`字段中使用）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-04-24T18:36:10.183

如果您希望按计划或始终运行此批处理文件；您可以使用 Windows 计划工具，它在启动批处理文件时不会在窗口中打开。

打开`Task Scheduler`：

*   开始 -> 运行/搜索 ->`'cmd'`
*   输入`taskschd.msc`-> 输入

从右侧，单击`Create Basic Task`并按照菜单操作。

希望这可以帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-12-04T13:29:43.450

这是我的首选解决方案。它取自对类似问题的[回答。](https://stackoverflow.com/a/21130357/2796593)

使用 VBS 脚本调用批处理文件：

```
Set WshShell = CreateObject("WScript.Shell")
WshShell.Run chr(34) & "C:\path\to\your\batchfile.bat" & Chr(34), 0
Set WshShell = Nothing 
```

将上面的行复制到编辑器并使用 .VBS 扩展名保存文件。

# wpf - WPF：如何编辑位于 UserControl 内的 DockPanel 的内容？

> ID：324552
> 
> 赞同：2
> 
> 时间：2008-11-27T19:49:57.933
> 
> 标签：wpf, vb.net, xaml, user-controls

我创建了一个用户控件（在 vb.net 代码中），它包含两个停靠面板，一个用于标题内容（称为 HeaderDockPanel），一个用于其他内容（称为 RootDockPanel）。dockPanel 是用户控件的依赖属性。

这些依赖属性声明如下：

```
Public Shared ReadOnly RootDockPanelProperty As DependencyProperty = DependencyProperty.Register( _
       "RootDockPanel", GetType(DockPanel), GetType(MyUserControl), New PropertyMetadata( _
       Nothing))

Public Shared ReadOnly HeaderDockPanelProperty As DependencyProperty = DependencyProperty.Register( _
            "HeaderDockPanel", GetType(DockPanel), GetType(MyUserControl), New PropertyMetadata( _
            Nothing)) 
```

我尝试如下更改这些停靠面板的内容，但没有成功：

```
<Wpf:EditBaseControl>
    <Wpf:MyUserControl.HeaderDockPanel>
        <DockPanel>
            <Button Content="buttonContent" />
            <TextBlock Text="textBlock" />
        </DockPanel>
    </Wpf:MyUserControl.HeaderDockPanel>
</Wpf:EditBaseControl> 
```

如何编辑 UserControl 内的 DockPanel 的内容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T20:45:06.140

1 我在这里没有正确理解您的设计方法。为什么需要依赖属性作为 DockPanel。如果您在 XAML 中设置 x:Name 属性并访问该名称，例如 _dockPanel，则可以直接在后面的用户控件代码中引用 DockPanel。访问 _dockPanel.Children 属性来操作它的孩子，

2 关于 DP 的另一个想法，您可能需要将 DockPanel 实例添加到 Wpf:EditBaseControl 作为 DependancyPropertyChanged 事件的内容。

3 如果您想尝试[不显眼的](http://msdn.microsoft.com/en-us/magazine/cc163497.aspx)方式（即[WPF 自定义控件](http://msdn.microsoft.com/en-us/magazine/cc163421.aspx)），那么我建议您为此创建一个[HeaderedItemsControl 并将 ItemsPanel](http://msdn.microsoft.com/en-us/library/system.windows.controls.headereditemscontrol.aspx)设置为该控件的 DockPanel。

# eclipse - 如何使用eclipse调试器调试JSF核心库的stacktrace？

> ID：324564
> 
> 赞同：1
> 
> 时间：2008-11-27T20:02:41.527
> 
> 标签：eclipse, spring, jsf, remote-debugging

欢迎我正在扩展一些用 Sprint 和 JSF 编写的应用程序。我的工作部分是编写 xml 配置文件。经过一些更改后，我从库生成器中获得了报告。

我可以使用 Eclipse 调试器附加的 jar 访问并找到什么方法抛出错误（以及为什么）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-02T02:15:50.793

您可能想在此处重新表述您所要求的内容。

当然，您可以将 Eclipse 调试器附加到该应用程序。不过，您需要在调试模式下运行它。您需要将一些参数传递给 JVM。就像是

```
java -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,address=127.0.0.1 .. 
```

您可能还希望将 Eclipse 指向源 jar，以便您可以单步执行代码。但既然你在谈论配置文件，我宁愿先检查日志。

# javascript - 使用 JavaScript 跟踪 URL

> ID：324571
> 
> 赞同：1
> 
> 时间：2008-11-27T20:04:43.520
> 
> 标签：javascript, ajax

有没有办法在不设置的情况下在 JavaScript 中跟踪 URL `document.location.href`？

我有一个显示对象列表的页面，每个对象都可能有一个与之关联的文件下载，可以通过超链接访问。单击该链接会启动一个 AJAX 请求，该请求最终会导致生成一个临时文件，该文件可由唯一的临时 URL 引用。

在 AJAX 调用完成的那一刻，它只是将 设置`document.location.href`为临时 URL 并启动文件下载。当然，这有改变浏览器地址栏中的 URL 的副作用，所以如果页面被刷新，文件将被再次下载，而不是对象列表页面本身被刷新。我想我可以将 URL 设置回原来的样子，但这感觉有点 hacky。

顺便说一句，我正在使用 Prototype JavaScript 框架。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T20:11:11.543

您可以使用新网址打开一个新窗口吗？或者尝试将 iframe 的 url 设置为新的 url，两者都应该提供文件下载（后者是更好的选择）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T20:11:38.610

您可以使用隐藏的 iframe - 将其 src 设置为要下载的文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T20:12:54.830

如果您这样做只是为了触发文件下载，那么这听起来像是一个使用隐藏 Iframe 的好应用程序。改为设置 iframe 的 SRC，这样您就不必弄乱主页面了。

# apache-flex - Actionscript 3 绑定变量

> ID：324572
> 
> 赞同：0
> 
> 时间：2008-11-27T20:06:16.280
> 
> 标签：apache-flex, actionscript, binding

我正在尝试将一个可绑定变量设置为绑定到另一个。本质上我想创建一个别名。我会放弃，但这似乎很高兴知道。

本质上，我希望 model.configView 中的更改反映在视图中，以便绑定到 view.... 的东西与绑定到 model.configView... 的东西在此示例中的行为相同

```
[可绑定]
var view = model.configView;...
<mx:Label text="{view.lblThisLabel.name}" />

```

目前它没有，并且我收到错误消息“无法绑定到类'Object'上的属性'lblThisLabel'（类不是IEventDispatcher）”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T20:09:34.307

这里没有足够的代码来真正说明发生了什么，但是您已将其设为`view`可绑定，这并不意味着所有`view`的孩子都是可绑定的。您也必须进入`view`并使其`lblThisLabel`可绑定。

我们其他人也很难知道它是如何在你的脑海中运作的。也许你也应该描述一下。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T15:12:02.830

此外，我认为即使使用您的实际代码，`view`应该检测到更改，如果分配的属性也不可绑定，`view`也不会更新......`model.configView`

# architecture - 创建通用信息模型的最佳方法是什么？

> ID：324573
> 
> 赞同：2
> 
> 时间：2008-11-27T20:06:17.263
> 
> 标签：architecture, soa, semantics

我想知道创建**[通用信息模型](http://en.wikipedia.org/wiki/Common_Information_Model_(computing))**的最佳方法。为了清楚起见，我还听说它被称为规范信息模型、语义信息模型和主数据模型——据我所知，它们都指的是同一个概念。

我过去听说过结合“自上而下”和“自下而上”的方法是最好的。这具有结合“象牙塔”架构师和开发人员的优势 - 工作将在中间的某个地方相遇，通常既合乎逻辑又实用。然而，这涉及引进许多具有不同技能的人。

我还看到了一些关于[分布式管理任务组](http://www.dmtf.org)的参考资料，但我对 CIM 开发方面的最佳实践了解不多。

这是我对获得一些反馈非常感兴趣的事情，因为拥有强大的 CIM 是**SOA**的先决条件。

**更新**

我听说整体 SOA 实施采用了另一种策略：让业务参与进来，并寻求高管的支持。这将是“自上而下”努力的一部分。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-04T18:46:24.833

规范数据模型是独立于任何应用程序或服务的数据模型。您需要集成的每个应用程序都应该将消息从这种通用格式转换为这种通用格式。

您应该只在模型中集成需要在应用程序之间共享的数据。查看应用程序/服务发送/接收的消息。不要试图创建一个单一的企业数据模型，我从未见过这样的工作。始终存在围绕应用程序和应用程序所有权的政治问题。

创建模型的实用方法：

*   从创建参考表开始（标准域定义 valuta、国家、婚姻状况、城市等）
*   如果有超过 2 个消费者，则标准化常见概念（客户、地址）
*   如果可用，请使用或参考公共标准（ISO，本体，例如都柏林核心）
*   明确分配模型的所有权。

# c# - WCF：将表单数据发送到 Web 服务的最佳实践？

> ID：324599
> 
> 赞同：0
> 
> 时间：2008-11-27T20:27:10.027
> 
> 标签：c#, wcf, forms

我们正在使用 C#、ASP.NET 和 WCF。我正在尝试将表单数据发送到 Web 服务，该服务又使用我的表单中的数据插入/更新数据库。我应该如何发送我的数据？

我们已经很好地填充了表单，但是在将更新发送回 Web 服务时遇到了一些问题。我们已经确定在这种情况下使用数据集不是很好的做法，它很慢，而且我们必须根据自己的喜好做太多的 SELECT *。

我有大约 15 个领域需要跨越。一名团队成员希望将所有内容作为我认为不是最佳的参数传递。我们尝试在 Object[] 数组中发送所有内容，但收到一个奇怪的错误“Type 'System.DBNull' with data contract name 'DBNull:http...' is not expected. Add any types not known statically to the list of已知类型”,

任何建议都非常受欢迎。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T00:08:13.217

我们使用 WCF 使用属性来定义我们的数据协定和数据方法。

基本上我们创建一个程序集来定义我们所有的类和另一个程序集来提供 WCF 连接位

OPur 类程序集包含一个服务类和几个消息类。

我们为我们的服务定义一个接口，并用相关的 WCF 标记对其进行标记。这是我们的服务合同。

```
[ServiceContract]
public interface IExampleWebService
{
    [OperationContract]
    CreateAccountResponse CreateAccount(int parameter, CreateAccountArguments another parameter);

    [OperationContract]
    DeleteAccountResponse DeleteAccount(int parameter);
} 
```

我们在一个类中实现这个接口，并创建各种数据契约（我们的响应和参数类）。

```
[DataContract]
public class CreateAccountResponse
{
    [DataMember]
    public bool CreatedOk { get; set; }

    [DataMember]
    public int AccountId { get; set; }
} 
```

这些类使用 Web 服务暴露给我们的表单（我们创建另一个程序集作为 Web 服务，并有一个从我们的服务类继承的类（在此示例中未显示），因此我们让 Visual Studio 完成所有设置 WCF 的工作服务，因为我们通过易于使用和维护的 Web 服务获得了好处。

# c# - LINQ to XML 新手问题：按节点名称返回节点

> ID：324604
> 
> 赞同：0
> 
> 时间：2008-11-27T20:32:50.657
> 
> 标签：c#, xml, c#-3.0, linq-to-xml

问候！

如果我有这样的 XML：

```
<Root>
    <AlphaSection>
    .
    .
    .
    </AlphaSection>

    <BetaSection>
        <Choices>
            <SetA>
                <Choice id="choice1">Choice One</Choice> 
                <Choice id="choice2">Choice Two</Choice>
            </SetA>
            <SetB>
                <Choice id="choice3">Choice Three</Choice> 
                <Choice id="choice4">Choice Four</Choice>
            </SetB>
        </Choices>
    </BetaSection>

    <GammaSection>
    .
    .
    .
    </GammaSection>
</Root> 
```

我想获得“BetaSection”中的所有选择项，无论它们属于哪个“集合”。我尝试了以下方法：

```
var choiceList = from choices in myXDoc.Root.Element("BetaSection").Elements("Choices")
                 where (choices.Name == "Choice")
                 select new
                 {
                     Name = choices.Attribute("id").Value,
                     Data = choice.Value
                 }; 
```

但无济于事。我该怎么办？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-27T20:38:06.980

您根本不需要 where 子句 - 您只需将 Elements 调用更改为 Descendants：

```
var choiceList = myXDoc.Root
                       .Element("BetaSection")
                       .Descendants("Choice")
                       .Select(element => new
                               {
                                  Name = element.Attribute("id").Value,
                                  Data = element.Value;
                               }); 
```

（我已将其从查询表达式转换为简单的点表示法，因为我认为查询表达式并没有真正帮助您。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T00:44:28.120

我会写这个。我更喜欢 SQL 语法而不是方法语法，但这只是个人喜好问题......

```
class Program
{
    static void Main(string[] args)
    {
        String     xml          = @"<Root>
                                        <AlphaSection></AlphaSection>
                                        <BetaSection>
                                            <Choices>
                                                <SetA>
                                                    <Choice id='choice1'>Choice One</Choice>
                                                    <Choice id='choice2'>Choice Two</Choice>
                                                </SetA>
                                                <SetB>
                                                    <Choice id='choice3'>Choice Three</Choice>
                                                    <Choice id='choice4'>Choice Four</Choice>
                                                </SetB>
                                            </Choices>
                                        </BetaSection>
                                        <GammaSection></GammaSection>
                                    </Root>";
        XElement    xmlElement  = XElement.Parse(xml);
        var         choiceList  = from c in xmlElement.Descendants().Elements("Choice")
                                  select new {
                                      Name = c.Attribute("id").Value,
                                      Data = c.Value
                                  };
        foreach (var choice in choiceList) {
            Console.WriteLine("Name: {0} Data: {1}", choice.Name, choice.Data );
        }
    }
} 
```

# mysql - MySQL 触发器 - 将 SELECT 存储在变量中

> ID：324605
> 
> 赞同：55
> 
> 时间：2008-11-27T20:33:00.093
> 
> 标签：mysql, sql, triggers

我有一个触发器，我希望有一个变量来保存我从 a 获得的 INT `SELECT`，所以我可以在两个 IF 语句中使用它，而不是调用`SELECT`两次。您如何在 MySQL 触发器中声明/使用变量？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-11-29T23:29:15.373

`DECLARE`您可以使用语法在 MySQL 触发器中声明局部变量。

这是一个例子：

```
DROP TABLE IF EXISTS foo;
CREATE TABLE FOO (
  i SERIAL PRIMARY KEY
);

DELIMITER //
DROP TRIGGER IF EXISTS bar //

CREATE TRIGGER bar AFTER INSERT ON foo
FOR EACH ROW BEGIN
  DECLARE x INT;
  SET x = NEW.i;
  SET @a = x; -- set user variable outside trigger
END//

DELIMITER ;

SET @a = 0;

SELECT @a; -- returns 0

INSERT INTO foo () VALUES ();

SELECT @a; -- returns 1, the value it got during the trigger 
```

为变量赋值时，必须确保查询只返回一个值，而不是一组行或一组列。例如，如果您的查询在实践中返回一个值，那没关系，但只要它返回多行，您就会得到“ `ERROR 1242: Subquery returns more than 1 row`”。

您可以使用`LIMIT`or`MAX()`来确保将局部变量设置为单个值。

```
CREATE TRIGGER bar AFTER INSERT ON foo
FOR EACH ROW BEGIN
  DECLARE x INT;
  SET x = (SELECT age FROM users WHERE name = 'Bill'); 
  -- ERROR 1242 if more than one row with 'Bill'
END//

CREATE TRIGGER bar AFTER INSERT ON foo
FOR EACH ROW BEGIN
  DECLARE x INT;
  SET x = (SELECT MAX(age) FROM users WHERE name = 'Bill');
  -- OK even when more than one row with 'Bill'
END// 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-27T21:58:54.337

```
`CREATE TRIGGER `category_before_ins_tr` BEFORE INSERT ON `category`
  FOR EACH ROW
BEGIN
    **SET @tableId= (SELECT id FROM dummy LIMIT 1);**

END;`; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-15T12:43:45.717

```
CREATE TRIGGER clearcamcdr AFTER INSERT ON `asteriskcdrdb`.`cdr` 
FOR EACH ROW
BEGIN
  SET @INC = (SELECT sip_inc FROM trunks LIMIT 1);
  IF NEW.billsec >1 AND NEW.channel LIKE @INC 
    AND NEW.dstchannel NOT LIKE "" 
  THEN
    insert into `asteriskcdrdb`.`filtre` (id_appel,date_appel,source,destinataire,duree,sens,commentaire,suivi) 
      values (NEW.id,NEW.calldate,NEW.src,NEW.dstchannel,NEW.billsec,"entrant","",""); 
  END IF;
END$$ 
```

不要尝试这个@home

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-12-20T15:42:55.467

我发布这个解决方案是因为我很难找到我需要的东西。这篇文章让我足够接近（+1 表示感谢），**如果数据与 test 匹配，这是插入之前重新排列列数据**的最终解决方案。

注意：这是来自我继承的*遗留项目，其中：*

1.  唯一键是`rridprefix`+`rrid`
2.  在我接手之前，没有任何约束可以防止重复的唯一键
3.  我们需要将两个表（一个充满重复项）组合到主表中，该表现在对复合键有约束（因此合并失败，因为获取表不允许来自不干净表的重复项）
4.  `on duplicate key`不太理想，因为列太多并且可能会更改

**无论如何，这里的触发器将任何重复的键放入遗留列，同时允许我们存储遗留的坏数据（而不是触发获取表的复合唯一键）**。

```
BEGIN
  -- prevent duplicate composite keys when merging in archive to main
  SET @EXIST_COMPOSITE_KEY = (SELECT count(*) FROM patientrecords where rridprefix = NEW.rridprefix and rrid = NEW.rrid);

  -- if the composite key to be introduced during merge exists, rearrange the data for insert
  IF @EXIST_COMPOSITE_KEY > 0
  THEN

    -- set the incoming column data this way (if composite key exists)

    -- the legacy duplicate rrid field will help us keep the bad data
    SET NEW.legacyduperrid = NEW.rrid;

    -- allow the following block to set the new rrid appropriately
    SET NEW.rrid = null;

  END IF;

  -- legacy code tried set the rrid (race condition), now the db does it
  SET NEW.rrid = (
    SELECT if(NEW.rrid is null and NEW.legacyduperrid is null, IFNULL(MAX(rrid), 0) + 1, NEW.rrid)
    FROM patientrecords
    WHERE rridprefix  = NEW.rridprefix
  );
END 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-27T23:29:27.103

或者您可以只在调用触发器的 SQL 中包含 SELECT 语句，因此它作为触发器行中的列之一传入。只要您确定它只会返回一行（因此只有一个值）。（当然，它不能返回与触发器中的逻辑交互的值，但无论如何都是如此。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-07-01T07:34:16.570

据我想我理解你的问题我相信你可以简单地在“DECLARE”中声明你的变量，然后在“开始”之后你可以使用'select into'you variable''语句。代码如下所示：

```
DECLARE
YourVar  varchar(50);
begin 
select ID into YourVar  from table
where ... 
```

# haskell - 理解类型错误：“预期签名 Int*Int->Int 但得到 Int*Int->Int”

> ID：324612
> 
> 赞同：8
> 
> 时间：2008-11-27T20:36:09.433
> 
> 标签：haskell, ml, type-theory

[Steve Yegge](http://steve-yegge.blogspot.com/)关于[服务器端 Javascript](http://www.mozilla.org/rhino/)的[帖子](http://steve-yegge.blogspot.com/2008/06/rhinos-and-tigers.html)的评论开始讨论语言中类型系统的优点，该[评论](http://steve-yegge.blogspot.com/2008/06/rhinos-and-tigers.html?showComment=1213654200000#c869153593831177660)描述了：

> [...来自HM](http://en.wikipedia.org/wiki/Hindley-Milner)风格系统的示例，您可以在其中获得以下内容：
> 
> ```
> expected signature Int*Int->Int but got Int*Int->Int 
> ```

你能举一个函数定义的例子（或两个？）和一个会产生该错误的函数调用吗？看起来在大型程序中调试可能非常困难。

另外，我可能在[Miranda](http://miranda.org.uk/)看到过类似的错误吗？（我已经 15 年没用过了，所以我对它的记忆很模糊）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-27T20:55:25.773

我对 Yegge（和 Ola Bini）关于静态类型的观点持保留态度。如果您欣赏静态类型为您提供的东西，您将了解您选择的编程语言的类型系统是如何工作的。

IIRC，ML 对元组使用 '*' 语法。<type> * <type> 是一个有两个元素的元组类型。因此， (1, 2) 将具有 int * int 类型。

Haskell 和 ML 都使用 -> 作为函数。在 ML 中，int * int -> int 将是一个函数的类型，它接受一个 int 和 int 的元组并将其映射到一个 int。

您可能会看到一个看起来与 Ola 在从另一种语言进入 ML 时引用的错误类似的错误的原因之一是，如果您尝试使用括号和逗号将参数传递给一个函数，就像在 C 或 Pascal 中那样，接受两个参数。

问题是，函数式语言通常将多个参数的函数建模为函数返回函数。所有函数只接受一个参数。如果函数应该接受两个参数，则它会接受一个参数并返回一个具有单个参数的函数，该函数返回最终结果，依此类推。为了使所有这些清晰易读，函数应用只需通过连词即可完成（即将表达式并排放置）。

因此，ML 中的一个简单函数（注意：我使用 F# 作为我的 ML）可能看起来有点像：

```
let f x y = x + y;; 
```

它有类型：

```
val f : int -> int -> int 
```

（一个接受整数并返回一个函数的函数，该函数本身接受一个整数并返回一个整数。）

但是，如果你天真地用元组调用它：

```
f(1, 2) 
```

...你会得到一个错误，因为你将一个 int*int 传递给期望一个 int 的东西。

我认为这是 Ola 试图中伤的“问题”。不过，我认为问题并没有他想的那么严重。当然，在 C++ 模板中情况要糟糕得多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-27T21:17:01.487

这可能是指一个编写错误的编译器，它未能插入括号来消除错误消息的歧义。具体来说，该函数需要一个 元组`int`并返回一个`int`，但您传递了一个元组 of`int`和一个函数 from `int`to `int`。更具体地说（在 ML 中）：

```
fun f g = g (1, 2);

f (42, fn x => x * 2) 
```

这将产生类似于以下的类型错误：

> 预期类型`int * int -> int`，得到类型`int * (int -> int)`

如果省略括号，则此错误可能会令人讨厌地模棱两可。

值得注意的是，这个问题远非 Hindley-Milner 独有。事实上，我想不出任何特定于 HM的奇怪类型*错误。*至少，没有一个像给出的例子。我怀疑奥拉只是在吹烟。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-07T15:14:44.757

由于许多函数式语言允许您以与重新绑定变量相同的方式重新绑定类型名称，因此实际上很容易出现这样的错误，特别是如果您`t`在不同模块中为您的类型（例如，）使用了一些通用名称。这是 OCaml 中的一个简单示例：

```
# let f x = x + 1;;
val f : int -> int = <fun>
# type int = Foo of string;;
type int = Foo of string
# f (Foo "hello");;
This expression has type int but is here used with type int 
```

我在这里所做的是将类型标识符重新绑定`int`到与内置类型不兼容的新`int`类型。稍加努力，我们就可以得到或多或少与上面相同的错误：

```
# let f g x y = g(x,y) + x + y;;
val f : (int * int -> int) -> int -> int -> int = <fun>
# type int = Foo of int;;
type int = Foo of int
# let h (Foo a, Foo b) = (Foo a);;
val h : int * int -> int = <fun>
# f h;;
This expression has type int * int -> int but is here used with type
  int * int -> int 
```

# c++ - MFC 应用程序中的多字节字符集

> ID：324624
> 
> 赞同：0
> 
> 时间：2008-11-27T20:45:09.507
> 
> 标签：c++, unicode, mfc

我有一个 MFC 应用程序，我想在其中添加国际化支持。该项目配置为使用“多字节字符集”（在我的情况下，“unicode 字符集”不是一个选项）。

现在，如果我将键盘设置为某种外语，我希望 CWnd::OnChar() 函数向我发送多字节字符，但它似乎并没有那样工作。OnChar() 函数总是在其 nChar 变量中向我发送一个 1 字节字符。

我认为 _getmbcp() 函数会给我应用程序的当前代码页，但这个函数总是返回 0。

任何意见，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T08:41:31.823

与在非 Unicode 场景中的往常一样，只有在相应地设置了系统区域设置（又名在控制面板“非 Unicode 应用程序的语言”中）时，您才会获得可靠的结果。如果没有，不要指望有什么好的。

例如，如果系统区域设置为繁体中文，您将收到 2 个连续的 WM_CHAR 消息（每个字节一个，假设用户编写了一个 2 字符字符）。

isleadbyte() 应该可以帮助您确定第二个字节是否即将到来。

如果您的系统区域设置未设置为中文，即使使用中文键盘/IME，也不要期望收到正确的消息。误导部分是某些场景有效。例如，使用希腊语键盘，您将收到基于希腊语代码页的 WM_CHAR 字符值，即使您的系统语言环境是基于拉丁语的。但是您真的应该远离尝试应对此类情况：不能保证成功，并且可能会根据 Windows 版本和区域设置而有所不同。

正如 MikeB 所写，MS AppLocale 是您进行基本测试的朋友。

[ad]如果你需要翻译你的 UI ， [appTranslator是你的朋友 [/ad]](http://www.apptranslator.com)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T04:33:58.953

对于 _getmbcp，MSDN 说“返回值 0 表示正在使用单个字节代码页。” 这肯定使它不是很有用。请尝试以下方法之一：GetUserDefaultLCID GetSystemDefaultLCID GetACP。（现在为什么没有 GetACP 的“用户”等价物？）

无论如何，如果您希望 _getmbcp 返回一个实际值，请将您的系统默认语言设置为中文、日文或韩文。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-28T01:11:48.767

并在这里帮忙？[Microsoft C 运行时中的多字节函数](http://www.geocities.com/yongweiwu/multibyte.htm)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-28T03:41:33.800

至于更改默认代码页：

用户的默认代码页（对于 WinXP - 不确定在 Vista 上的情况）是在“高级”选项卡上的“区域和语言选项”控制面板小程序中设置的。

“非 Unicode 程序的语言”设置当前用户的默认代码页。不幸的是，它实际上并没有告诉你它正在配置的代码页号——它只是给出了语言（可能会用区域变体进一步指定）。从最终用户的角度来看，这很有意义，因为我认为代码页编号对 99.999% 的最终用户没有意义。您需要重新启动才能使更改生效。如果您使用 regmon 来确定哪些更改，您可能会想出一些更容易指定默认代码页的东西。

Microsoft 还有一个不受支持的实用程序 AppLocale，用于测试更改特定应用程序代码页的本地化：http: [//www.microsoft.com/globaldev/tools/apploc.mspx](http://www.microsoft.com/globaldev/tools/apploc.mspx)

您还可以通过调用更改线程的代码页`SetThreadLocale()`- 但您还必须调用 C 运行时的`setlocale()`函数，因为某些 CRT 函数不与 Win API 语言环境函数对话（反之亦然）。有关详细信息，请参阅Chris Grimes 的[“Windows`SetThreadLocale`和 CRT `setlocale`”](http://www.codeproject.com/KB/locale/CRTSynch.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T20:51:39.917

实际上有一种非常简单（但很奇怪）的方法可以强制 OnChar 函数将 unicode 字符发送到应用程序，即使它是在多字节字符集中配置的：

```
SetWindowLongW( m_hWnd, GWL_WNDPROC, GetWindowLong( m_hWnd, GWL_WNDPROC ) ); 
```

只需调用“SetWindowLong”的 unicode 版本，它就会强制应用程序接收 unicode 字符。

# javascript - 在 HTML 页面中包含数据的最佳方式是什么？

> ID：324627
> 
> 赞同：2
> 
> 时间：2008-11-27T20:46:20.240
> 
> 标签：javascript, html

在 HTML 页面中包含数据的最佳方式是什么？数据不是人类可读的，一旦页面加载，将由脚本处理。我能想到的选项是：

*   在页面内的隐藏/空`<div>`或`<span>`元素上使用类和标题属性

*   `<script>`页面底部元素中的JSON

*   页面加载后通过 XMLHttpRequest 加载数据

*   XML 数据岛

所有这些方法似乎都有缺点，所以我想知道你的想法是什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T20:49:57.813

我会选择 JSON。或者其他一些 JavaScript 代码，如果有原因的话。这对于脚本来说是最容易使用的，并且仅限于脚本本身的限制。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-27T21:04:45.647

`<script>`我会在元素中使用 JSON 。实际上，我会把它变成一个实际的脚本。浏览器将解析和评估 JSON，因此请借此机会将其存储在某个变量中。

使用 CSS 隐藏元素有点脆弱，因为一些客户端（不一定是浏览器，认为搜索引擎）可能仍将它们视为页面数据的一部分。

在页面加载后通过 XHR 加载数据是可以的，但这并不是严格意义上的问题的答案。它也有点慢，因为它会导致额外的服务器往返（想想你的对端用户，低延迟对他们来说非常重要）。

XML 数据岛：我不确定您指的是什么，但这听起来像是会引起很多验证器投诉的东西，并且在该字符串节点中可能很脆弱，可以由浏览器呈现。

因此，将数据存储在`<script>`元素中听起来像是回答问题最简单、最安全、最合适的方式。

# api - 使用 Flickr API 查找无标签照片的最简单方法

> ID：324629
> 
> 赞同：0
> 
> 时间：2008-11-27T20:47:44.947
> 
> 标签：api, metadata, flickr

我正在做一个小项目来帮助我在 Flickr 上标记内容。

我一直在查看 API，并且有明显的方法来搜索标记的内容，但不是一种简单的方法来查找哪些内容没有被标记（不只是循环通过图像 ID 直到我找到一个没有标记的内容）。

过去有没有人遇到过这种情况并找到了一个简单的解决方法？

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T17:51:24.807

[flickr.photos.getUntagged](http://www.flickr.com/services/api/flickr.photos.getUntagged.html)将为您自己的照片执行此操作。我很确定除了蛮力之外，没有其他方法可以进行更一般的搜索。

# c# - 为什么 .NET 没有像 Java 那样的 SoftReference 和 WeakReference？

> ID：324633
> 
> 赞同：19
> 
> 时间：2008-11-27T20:52:00.633
> 
> 标签：c#, weak-references, soft-references

我真的很喜欢 WeakReference 的。但我希望有一种方法可以告诉 CLR 多少（例如，在 1 到 5 的范围内）您认为该引用有多弱。那将是辉煌的。

Java 有 SoftReference、WeakReference，我相信还有第三种类型，称为“幻像引用”。那是 3 个级别，GC 在决定该对象是否获得印章时具有不同的行为算法。

我正在考虑将.NET 的 WeakReference 子类化（幸运的是，它没有被密封）来制作一个基于过期计时器或其他东西的伪 SoftReference。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2011-08-18T04:21:05.320

我认为 NET 没有软引用的根本原因是因为它可以依赖具有虚拟内存的操作系统。Java 进程必须指定它的最大操作系统内存（例如用`-Xmx128M`），并且它*永远不会*占用比这更多的操作系统内存。而 NET 进程不断占用它需要的操作系统内存，当 RAM 用完时，操作系统会提供磁盘支持的虚拟内存。如果 NET 允许软引用，那么 NET 运行时将不知道何时释放它们，除非它深入操作系统以查看其内存是否实际在磁盘上分页（讨厌的 OS/CLR 依赖项），或者它请求运行时指定最大进程内存占用（例如，相当于`-Xmx`）。我猜微软不想添加`-Xmx`NET，因为他们认为操作系统应该决定每个进程获得多少 RAM（通过选择将哪些虚拟内存页面保存在 RAM 或磁盘上），而不是进程本身。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-09-15T17:20:21.277

Java SoftReferences 用于创建内存敏感缓存（它们没有其他用途）。

从 .NET 4 开始，.NET 有一个[System.Runtime.Caching.MemoryCache](https://msdn.microsoft.com/en-us/library/system.runtime.caching.memorycache(v=vs.110).aspx)类，它可能会满足任何此类需求。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-28T01:13:19.920

具有不同程度的弱点（优先级）的 WeakReference*听起来* 不错，但也可能会使 GC 的工作更难，而不是更容易。（我不知道 GC 的内部结构，但是）我会假设为 WeakReference 对象保留了某种额外的访问统计信息，以便 GC 可以有效地清理它们（例如，它可能会删除最少使用的项目第一的）。

增加的复杂性很可能不会使任何事情变得更有效，因为最有效的方法是首先摆脱不经常使用的 WeakReferences。如果你可以指定一个优先级，你会怎么做？这听起来像是过早的优化：程序员大部分时间并不真正知道并且在猜测；结果是较慢的 GC 收集周期，可能是回收了错误的对象。

但它引出了一个问题，如果你关心被回收的 WeakReference.Target 对象，它真的是 WeakReference 的好用处吗？

这就像一个缓存。您将内容塞入缓存并要求缓存在 x 分钟后使其陈旧，但大多数缓存根本不保证将其保留。它只是保证如果确实如此，它将根据请求的策略将其过期。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-27T20:57:41.697

我对为什么不存在的猜测很简单。我想，大多数人都会把它称为一种美德，即只有一种类型的参考，而不是四种。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-02-18T17:13:03.277

也许 ASP.NET 缓存类 (System.Web.Caching.Cache) 可能有助于实现您想要的？如果内存不足，它会自动删除对象：

*   [ASP.NET 缓存概述](http://msdn.microsoft.com/en-us/library/ms178597.aspx)

这是一篇文章，展示了如何在 Windows 窗体应用程序中使用 Cache 类。

引自：[相当于.net中的SoftReference？](https://stackoverflow.com/questions/632039/equivalent-to-softreference-in-net/632066#632066)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-19T17:06:14.697

不要忘记您也有您的标准参考资料（您每天使用的参考资料）。这给了你一个更高的层次。

当您并不真正关心对象是否消失时，应该使用 Wea​​kReferences，而 SoftReferences 只应该在您使用普通引用时使用，但您宁愿清除您的对象以便您耗尽内存。我不确定具体细节，但我怀疑 GC 在确定哪些对象处于活动状态时通常会通过 SoftReferences 而不是 WeakReferences 进行跟踪，但是当内存不足时也会跳过 SoftReferences。

我的猜测是 .Net 设计者觉得这种差异让大多数人感到困惑，或者 SoftReferences 增加了比他们真正想要的复杂性更多的复杂性，因此决定将它们排除在外。

附带说明一下，AFAIK PhantomReferences 主要是为虚拟机内部使用而设计的，而不是供实际客户端使用的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-27T21:12:43.197

也许应该有一个属性，您可以在其中指定对象 >= 在收集之前的哪个世代。所以如果你指定 1 那么它是最弱的参考。但是，如果您指定 3，那么它需要在之前的至少 3 个集合中存活下来，然后才能考虑将其用于集合本身。

我认为轨道恢复标志对此没有好处，因为到那时对象已经完成了？虽然可能是错的...

（PS：我是OP，刚刚注册。PITA，它不会从“未注册”帐户继承您的历史记录。）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-19T16:37:18.170

不知道为什么 .NET 没有软引用。但在 Java 软引用中，恕我直言，过度使用。原因是至少在应用程序服务器中，您希望能够影响每个应用程序的 Softreferenzen 存活时间。目前这在 Java 中是不可能的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-27T21:03:18.020

寻找传递给构造函数的“trackResurrection”选项？

GC 类也提供了一些帮助。

# permissions - IBM U2 (UniVerse 10.2) - 创建模式 - 如何

> ID：324634
> 
> 赞同：3
> 
> 时间：2008-11-27T20:52:02.583
> 
> 标签：permissions, u2, universe, multivalue-database

我们有一个传统的紫外线帐户。一个目录中的数据文件，另一个目录中的应用程序和子例程。我们最新的项目是实现 JDBC，为了从 java 中完全访问子例程，我相信我需要在现有的 uv 帐户上创建一个模式。

我怎样才能做到这一点？我尝试以 uvadm 身份登录并创建一个模式。得到以下错误：

> 创建模式测试；UniVerse/SQL：“uvadm”不是 SQL 用户。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-20T19:28:05.440

根据文档，他们都是管理员，但 UniVerse 管理员只是对创建中使用的基础文件（uvadm 和/或 root）具有读写权限的人。

> 谁是宇宙管理员？
> 
> 要执行大多数管理任务，您必须以 UniVerse 管理员身份登录。在 UNIX 系统上，UniVerse 管理员必须以 root 或 uvadm 身份登录。在 Windows 系统上，UniVerse 管理员必须以 Administrators 组的成员身份登录。然后，您可以使用 UniVerse Admin 和 UniVerse 管理命令来执行 UniVerse 管理。

但是，*UniVerse SQL* *管理员*是对*CATALOG*具有读/写权限的人。如果您无法创建目录，可能是因为您所在的目录没有 r/w 权限，因为目录只是一个文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-04T23:02:24.110

你在安装UniVerse的时候，你说uvsql的所有者是谁——uvadm还是root？我知道解决此问题的唯一方法是重新安装以允许回答 uvadm，以便正确设置和分类 SQL 中的所有文件。

# wpf - 如何使圆角边框的内容也圆角？

> ID：324641
> 
> 赞同：59
> 
> 时间：2008-11-27T20:59:22.850
> 
> 标签：wpf

我有一个包含 3x3 网格的圆角边框元素。网格的角伸出边界。我该如何解决？我尝试使用 ClipToBounds 但没有得到任何结果。谢谢你的帮助

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-11-28T02:58:04.030

[这是Jobi](https://stackoverflow.com/users/8091/jobi-joy)提到的这个[线程的亮点](https://stackoverflow.com/questions/324641/how-to-make-the-contents-of-a-round-cornered-border-be-also-round-cornered#325003)

*   装饰器（即边框）或布局面板（即 Stackpanel）都没有开箱即用的这种行为。
*   ClipToBounds 用于布局。ClipToBounds 不会阻止元素在其边界之外绘制；它只是防止孩子的布局“溢出”。此外，大多数元素不需要 ClipToBounds=True，因为它们的实现无论如何都不允许其内容的布局溢出。最显着的例外是画布。
*   最后，Border 将圆角视为其布局范围内的图形。

这是一个继承自 Border 并实现正确功能的类的实现：

```
 /// <Remarks>
    ///     As a side effect ClippingBorder will surpress any databinding or animation of 
    ///         its childs UIElement.Clip property until the child is removed from ClippingBorder
    /// </Remarks>
    public class ClippingBorder : Border {
        protected override void OnRender(DrawingContext dc) {
            OnApplyChildClip();            
            base.OnRender(dc);
        }

        public override UIElement Child 
        {
            get
            {
                return base.Child;
            }
            set
            {
                if (this.Child != value)
                {
                    if(this.Child != null)
                    {
                        // Restore original clipping
                        this.Child.SetValue(UIElement.ClipProperty, _oldClip);
                    }

                    if(value != null)
                    {
                        _oldClip = value.ReadLocalValue(UIElement.ClipProperty);
                    }
                    else 
                    {
                        // If we dont set it to null we could leak a Geometry object
                        _oldClip = null;
                    }

                    base.Child = value;
                }
            }
        }

        protected virtual void OnApplyChildClip()
        {
            UIElement child = this.Child;
            if(child != null)
            {
                _clipRect.RadiusX = _clipRect.RadiusY = Math.Max(0.0, this.CornerRadius.TopLeft - (this.BorderThickness.Left * 0.5));
                _clipRect.Rect = new Rect(Child.RenderSize);
                child.Clip = _clipRect;
            }
        }

        private RectangleGeometry _clipRect = new RectangleGeometry();
        private object _oldClip;
    } 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2015-02-05T13:07:36.627

纯 XAML：

```
<Border CornerRadius="30" Background="Green">
    <Border.OpacityMask>
        <VisualBrush>
            <VisualBrush.Visual>
                <Border 
                    Background="Black"
                    SnapsToDevicePixels="True"
                    CornerRadius="{Binding CornerRadius, RelativeSource={RelativeSource AncestorType=Border}}"
                    Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Border}}"
                    Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Border}}"
                    />
            </VisualBrush.Visual>
        </VisualBrush>
    </Border.OpacityMask>
    <TextBlock Text="asdas das d asd a sd a sda" />
</Border> 
```

**更新：** 找到了一种更好的方法来实现相同的结果。您现在也可以将*Border*替换为任何其他元素。

```
<Grid>
    <Grid.OpacityMask>
        <VisualBrush Visual="{Binding ElementName=Border1}" />
    </Grid.OpacityMask>
    <Border x:Name="Border1" CornerRadius="30" Background="Green" />
    <TextBlock Text="asdas das d asd a sd a sda" />
</Grid> 
```

[![例子](https://i.stack.imgur.com/xXUyh.png)](https://i.stack.imgur.com/xXUyh.png)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-09-05T05:07:38.897

正如 Micah 提到`ClipToBounds`的，它不适用于`Border.ConerRadius`.

有[UIElement.Clip](http://msdn.microsoft.com/en-us/library/system.windows.uielement.clip.aspx)属性，它`Border`继承。

如果您知道边框的确切大小，那么这里是解决方案：

```
<Border Background="Blue" CornerRadius="3" Height="100" Width="100">
      <Border.Clip>
        <RectangleGeometry RadiusX="3" RadiusY="3" Rect="0,0,100,100"/>
      </Border.Clip>
      <Grid Background="Green"/>
</Border> 
```

如果大小未知或动态，则可以使用`Converter`for 。[在此处](https://stackoverflow.com/questions/5649875/wpf-how-to-make-the-border-trim-the-child-elements)`Border.Clip`查看解决方案。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-12-23T09:05:27.633

所以我刚刚遇到了这个解决方案，然后进入了 Jobi 提供的 msdn 论坛链接，并花了 20 分钟编写了我自己的 ClippingBorder 控件。

然后我意识到 CornerRadius 属性类型不是双精度数，而是 System.Windows.CornerRaduis 接受 4 个双精度数，每个角一个。

所以我现在要列出另一个替代解决方案，它很可能会满足大多数人的要求，他们将来会偶然发现这篇文章......

假设您有如下所示的 XAML：

```
<Border CornerRadius="10">
    <Grid>
        ... your UI ...
    </Grid>
</Border> 
```

问题是 Grid 元素的背景会渗出并显示出圆角。确保您`<Grid>`具有透明背景，而不是将相同的画笔分配给`<Border>`元素的“背景”属性。不再流血，也不需要一大堆 CustomControl 代码。

确实，从理论上讲，客户区仍然有可能越过角落的边缘，但是您可以控制该内容，因此您作为开发人员应该能够有足够的填充，或者确保控件旁边的形状边缘是合适的（在我的情况下，我的按钮是圆形的，所以非常适合角落，没有任何问题）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-02-02T18:15:41.493

使用@Andrew Mikhailov 的解决方案，您可以定义一个简单的类，这样就`VisualBrush`不需要手动为每个受影响的元素定义一个：

```
public class ClippedBorder : Border
{
    public ClippedBorder() : base()
    {
        var e = new Border()
        {
            Background = Brushes.Black,
            SnapsToDevicePixels = true,
        };
        e.SetBinding(Border.CornerRadiusProperty, new Binding()
        {
            Mode = BindingMode.OneWay,
            Path = new PropertyPath("CornerRadius"),
            Source = this
        });
        e.SetBinding(Border.HeightProperty, new Binding()
        {
            Mode = BindingMode.OneWay,
            Path = new PropertyPath("ActualHeight"),
            Source = this
        });
        e.SetBinding(Border.WidthProperty, new Binding()
        {
            Mode = BindingMode.OneWay,
            Path = new PropertyPath("ActualWidth"),
            Source = this
        });

        OpacityMask = new VisualBrush(e);
    }
} 
```

要对此进行测试，只需编译以下两个示例：

```
<!-- You should see a blue rectangle with rounded corners/no red! -->
<Controls:ClippedBorder
    Background="Red"
    CornerRadius="10"
    Height="425"
    HorizontalAlignment="Center"
    VerticalAlignment="Center"
    Width="425">
    <Border Background="Blue">
    </Border>
</Controls:ClippedBorder>

<!-- You should see a blue rectangle with NO rounded corners/still no red! -->
<Border
    Background="Red"
    CornerRadius="10"
    Height="425"
    HorizontalAlignment="Center"
    VerticalAlignment="Center"
    Width="425">
    <Border Background="Blue">
    </Border>
</Border> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-27T21:06:59.823

使网格更小或边框更大。这样边框元素就完全包含了网格。

或者看看你是否可以让网格的背景透明，这样“突出”就不明显了。

**更新：**糟糕，没有注意到这是一个 WPF 问题。我对此并不熟悉。这是一般的 HTML/CSS 建议。也许它有帮助...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-09-20T08:11:52.340

我不喜欢使用自定义控件。而是创建了一个行为。

```
using System.Linq;
using System.Windows;
using System.Windows.Interactivity;

/// <summary>
/// Base class for behaviors that could be used in style.
/// </summary>
/// <typeparam name="TComponent">Component type.</typeparam>
/// <typeparam name="TBehavior">Behavior type.</typeparam>
public class AttachableForStyleBehavior<TComponent, TBehavior> : Behavior<TComponent>
        where TComponent : System.Windows.DependencyObject
        where TBehavior : AttachableForStyleBehavior<TComponent, TBehavior>, new()
{
#pragma warning disable SA1401 // Field must be private.

    /// <summary>
    /// IsEnabledForStyle attached property.
    /// </summary>
    public static DependencyProperty IsEnabledForStyleProperty =
        DependencyProperty.RegisterAttached("IsEnabledForStyle", typeof(bool),
        typeof(AttachableForStyleBehavior<TComponent, TBehavior>), new FrameworkPropertyMetadata(false, OnIsEnabledForStyleChanged));

#pragma warning restore SA1401

    /// <summary>
    /// Sets IsEnabledForStyle value for element.
    /// </summary>
    public static void SetIsEnabledForStyle(UIElement element, bool value)
    {
        element.SetValue(IsEnabledForStyleProperty, value);
    }

    /// <summary>
    /// Gets IsEnabledForStyle value for element.
    /// </summary>
    public static bool GetIsEnabledForStyle(UIElement element)
    {
        return (bool)element.GetValue(IsEnabledForStyleProperty);
    }

    private static void OnIsEnabledForStyleChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        UIElement uie = d as UIElement;

        if (uie != null)
        {
            var behColl = Interaction.GetBehaviors(uie);
            var existingBehavior = behColl.FirstOrDefault(b => b.GetType() ==
                  typeof(TBehavior)) as TBehavior;

            if ((bool)e.NewValue == false && existingBehavior != null)
            {
                behColl.Remove(existingBehavior);
            }
            else if ((bool)e.NewValue == true && existingBehavior == null)
            {
                behColl.Add(new TBehavior());
            }
        }
    }
} 
```

* * *

```
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Media;

/// <summary>
/// Behavior that creates opacity mask brush.
/// </summary>
internal class OpacityMaskBehavior : AttachableForStyleBehavior<Border, OpacityMaskBehavior>
{
    protected override void OnAttached()
    {
        base.OnAttached();

        var border = new Border()
        {
            Background = Brushes.Black,
            SnapsToDevicePixels = true,
        };

        border.SetBinding(Border.CornerRadiusProperty, new Binding()
        {
            Mode = BindingMode.OneWay,
            Path = new PropertyPath("CornerRadius"),
            Source = AssociatedObject
        });

        border.SetBinding(FrameworkElement.HeightProperty, new Binding()
        {
            Mode = BindingMode.OneWay,
            Path = new PropertyPath("ActualHeight"),
            Source = AssociatedObject
        });

        border.SetBinding(FrameworkElement.WidthProperty, new Binding()
        {
            Mode = BindingMode.OneWay,
            Path = new PropertyPath("ActualWidth"),
            Source = AssociatedObject
        });

        AssociatedObject.OpacityMask = new VisualBrush(border);
    }

    protected override void OnDetaching()
    {
        base.OnDetaching();

        AssociatedObject.OpacityMask = null;
    }
} 
```

* * *

```
<Style x:Key="BorderWithRoundCornersStyle" TargetType="{x:Type Border}">
    <Setter Property="CornerRadius" Value="50" />
    <Setter Property="behaviors:OpacityMaskBehavior.IsEnabledForStyle" Value="True" />
</Style> 
```

# python - 地图等价物是什么 > 在 Python 中？

> ID：324643
> 
> 赞同：9
> 
> 时间：2008-11-27T21:00:47.730
> 
> 标签：python, dictionary

在 C++ 中经常做这样的事情：

```
typedef map<int, vector<int> > MyIndexType; 
```

然后我像这样使用它：

```
MyIndexType myIndex;
for( ... some loop ...)
{
  myIndex[someId].push_back(someVal);
} 
```

如果地图中没有条目，代码将插入一个新的空向量，然后附加到它。

在 Python 中，它看起来像这样：

```
myIndex = {}

for (someId,someVal) in collection:
   try:
      myIndex[someId].append(someVal)
   except KeyError:
      myIndex[someId] = [someVal] 
```

除了这里的尝试有点难看。当在字典声明时遇到 KeyError 时，有没有办法告诉字典要插入的对象类型？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-27T21:10:23.247

你想使用：

```
from collections import defaultdict
myIndex = defaultdict(list)
myIndex[someId].append(someVal) 
```

标准库[`defaultdict`对象](http://docs.python.org/library/collections.html#id3)。

Python 文档中的示例用法：

```
>>> s = [('yellow', 1), ('blue', 2), ('yellow', 3), ('blue', 4), ('red', 1)]
>>> d = defaultdict(list)
>>> for k, v in s:
        d[k].append(v)

>>> d.items()
[('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])] 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-27T21:06:08.997

可能是这样的：

```
myIndex = {}
for (someId,someVal) in collection:
    myIndex.setdefault(someId, []).append(someVal) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T22:04:32.623

只是为了完成 Alastair 的答案：还有**setdefault的****get**等价物，称为**get**（而不是 getdefault，正如人们可能认为的那样）：

 ****```
myIndex = {}
someId = None
myList = myIndex.get(someId, []) # myList is [] now 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T22:12:21.687

从 Python 2.5 起，您可以通过实现来获取 setdefault 或使用 defaultdict 的行为

```
__missing__(k) 
```

[如这里](http://www.python.org/doc/2.5.2/lib/typesmapping.html)的注释 10所示。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T21:14:37.670

这个怎么样？它可能不是性能最佳的，但我认为这是“可能工作的最简单的事情”。

```
myIndex = {}

for (someId,someVal) in collection:
   if someId not in myIndex:
       myIndex[someId] = []
   myIndex[someId].append(someVal) 
```

# asp.net-mvc - 如何在 ASP.NET MVC 中设置 HTML Helper TextBox 的宽度？

> ID：324649
> 
> 赞同：48
> 
> 时间：2008-11-27T21:06:44.487
> 
> 标签：asp.net-mvc

我发现一些显然与旧版本的 mvc 一起使用的示例表明存在某种长度参数：

```
<%=Html.TextBox("test", 50)%> 
```

但这可能是错误地设置了值。

这在当前版本中如何工作？传入样式似乎没有任何效果。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2010-01-23T16:47:11.657

原来的答案不再像写的那样工作：

```
<%=Html.TextBox("test", new { style="width:50px" })%> 
```

将为您提供一个以“{ style="width:50px" }" 作为其文本内容的文本框。

要针对当前版本的 MVC 1.0 进行调整，请使用以下脚本（注意添加了第二个参数 - 我的开头为空白，根据您的需要进行相应调整）：

```
<%=Html.TextBox("test", "", new { style="width:50px" })%> 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-11-28T04:58:27.873

为此，您必须使用**HtmlAttributes**，但有一个问题：[HtmlAttributes 和 css class](http://forums.asp.net/t/1304585.aspx)。

你可以这样定义它：

```
new { Attrubute="Value", AttributeTwo = IntegerValue, @class="className" }; 
```

这是一个更现实的例子：

```
new { style="width:50px" };
new { style="width:50px", maxsize = 50 };
new {size=30, @class="required"} 
```

最后在：

MVC 1

```
<%= Html.TextBox("test", new { style="width:50px" }) %> 
```

MVC 2

```
<%= Html.TextBox("test", null, new { style="width:50px" }) %> 
```

MVC 3

```
@Html.TextBox("test", null, new { style="width:50px" }) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-27T22:28:22.747

像这样的东西应该工作：

```
<%=Html.TextBox("test", new { style="width:50px" })%> 
```

或更好：

```
<%=Html.TextBox("test")%>

<style type="text/css">
    input[type="text"] { width:50px; }     
</style> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-05T15:08:28.077

我强烈建议构建您的 HtmlHelpers。我认为 apsx 代码会更易读、更可靠、更耐用。

点击链接； [http://msdn.microsoft.com/en-us/library/system.web.mvc.htmlhelper.aspx](http://msdn.microsoft.com/en-us/library/system.web.mvc.htmlhelper.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-27T22:56:49.897

不要使用长度参数，因为它不适用于所有浏览器。最好的方法是在输入标签上设置样式。

```
<input style="width:100px" /> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-12T23:37:40.083

我对 MVC 3 的真实示例在这里：

```
<% using (Html.BeginForm()) { %>

<p>

Start Date: <%: Html.TextBox("datepicker1", DateTime.Now.ToString("MM/dd/yyyy"), new { style = "width:80px;", maxlength = 10 })%> 

End Date: <%: Html.TextBox("datepicker2", DateTime.Now.ToString("MM/dd/yyyy"), new { style = "width:80px;", maxlength = 10 })%> 

<input type="submit" name="btnSubmit" value="Search" /> 

</p>

<% } %> 
```

所以，我们有以下

**"datepicker1"** - 控件的 ID

**DateTime.Now.ToString("MM/dd/yyyy"** ) - 默认值

**style = "width:80px;** " - 文本框的宽度

**maxlength = 10** - 我们只能输入 10 个字符

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-15T09:23:27.020

新的 { style="width:50px", maxsize = 50 };

应该

新的 { style="width:50px", maxlength = 50 };

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-07T06:41:50.693

在 mvc3.0 中设置文本框和 maxlength

```
@Html.TextBoxFor(model => model.SearchUrl, new { style = "width:650px;",maxlength = 250 }) 
```

# intellisense - Visual Studio 2005 Intellisense 与 Rhino Mocks

> ID：324656
> 
> 赞同：1
> 
> 时间：2008-11-27T21:13:19.450
> 
> 标签：intellisense, rhino-mocks

Rhino Mocks 下载附带一个“Rhino.Mocks.xml”文件，该文件显然为 Rhino Mocks 添加了 Intellisense。

您需要对该文件执行什么操作才能使其正常工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T21:14:49.510

将它放在与您引用的 DLL 相同的目录中，它应该会被自动拾取。

# php - 哪个更快：in_array() 还是 PHP 中的一堆表达式？

> ID：324665
> 
> 赞同：16
> 
> 时间：2008-11-27T21:17:24.263
> 
> 标签：php, arrays, if-statement

执行以下操作是否更快：

```
 if ($var != 'test1' && $var != 'test2' && $var != 'test3' && $var != 'test4') { ... } 
```

或者：

```
 if (!in_array($var, array('test1', 'test2', 'test3', 'test4') { ... } 
```

是否有许多值，在这一点上做一个或另一个更快？

（在这种情况下，第二个选项中使用的数组并不存在。）

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-27T21:21:51.790

我强烈建议只使用`in_array()`，任何速度差异都可以忽略不计，但是单独测试每个变量的可读性是可怕的。

只是为了好玩，这是我运行的一个测试：

```
$array = array('test1', 'test2', 'test3', 'test4');
$var = 'test';
$iterations = 1000000;

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    if ($var != 'test1' && $var != 'test2' && $var != 'test3' && $var != 'test4') {}
}
$end = microtime(true);

print "Time1: ". ($end - $start)."<br />";

$start2 = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    if (!in_array($var, $array) ) {}
}
$end2 = microtime(true);

print "Time2: ".($end2 - $start2)."<br />";

// Time1: 1.12536692619
// Time2: 1.57462596893 
```

需要注意的一点微不足道的注意事项，如果`$var`未设置，方法 1 需要更长的时间（取决于您测试的条件数）

## 更新较新的 PHP 版本：

Martijn：我已经将数组扩展为**五个**元素，并寻找`test3`，作为一种平均情况。

**PHP5.6**

```
Time1: 0.20484399795532
Time2: 0.29854393005371 
```

**PHP7.1**

```
Time1: 0.064045906066895
Time2: 0.056781053543091 
```

**PHP7.4**

```
Time1: 0.048759937286377
Time2: 0.049691915512085 
```

**PHP8.0**

```
Time1: 0.045055150985718
Time2: 0.049431085586548 
```

结论：原始测试不是最好的测试，而且：在 php7+ 中已成为偏好问题。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-28T01:43:02.167

请注意，如果您要替换一堆`!==`语句，则应将第三个参数传递给[`in_array`](http://uk.php.net/manual/en/function.in-array.php)as `true`，这会强制对数组中的项目进行类型检查。

普通`!=`的显然不需要这个。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-27T21:22:13.070

第一个会更快 - 第二个有很多开销：创建数组，调用函数，搜索数组......

然而，正如我在几个答案中所说的那样，过早优化是万恶之源。您应该编写可读的代码，然后*如果*需要对其进行优化，则对其进行优化。

编辑：

我对@Owen 的代码（PHP 5.2.6 / windows）的时间安排：

```
Time1: 1.33601498604
Time2: 4.9349629879 
```

在循环内移动数组（...），如问题所示：

```
Time1: 1.34736609459
Time2: 6.29464697838 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-03-18T18:19:36.177

这是该板凳的实时更新与另一个案例[https://3v4l.org/OA2S7](https://3v4l.org/OA2S7)

PHP 7.3 的结果：

*   多重比较：**0.0575** 07991790771

*   in_array: **0.0256** 8507194519

*   array_flip() 外循环测量 + isset(): **0.0146** 78001403809

*   array_flip() 外部循环未测量 + isset(): 0.0156 **50033950806**

*   foreach 和比较：**0.0627** 82049179077

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-12-11T08:52:40.823

嗨，我只是将这种情况发挥到了极致，并指出随着值数量的增加，简单的比较**并不是**最有效的方式。

这是我的代码：

```
$var = 'test';
$num_values = 1000;
$iterations = 1000000;
print "\nComparison performance test with ".$num_values." values and ".$iterations." loop iterations";
print "\n";

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    if ($var != 'test0' &&
        $var != 'test1' &&
        // ...
        // yes I really have 1000 lines in my file
        // ...
        $var != 'test999') {}
}
print "\nCase 1: plain comparison";
print "\nTime 1: ". (microtime(true) - $start);
print "\n";

$start = microtime(true);
$array = array();
for($i=0; $i<$num_values; $i++) {
    $array1[] = 'test'.$i;
}
for($i = 0; $i < $iterations; ++$i) {
    if (!in_array($var, $array1) ) {}
}
print "\nCase 2: in_array comparison";
print "\nTime 2: ".(microtime(true) - $start);
print "\n";

$start = microtime(true);
$array = array();
for($i=0; $i<$num_values; $i++) {
    $array2['test'.$i] = 1;
}
for($i = 0; $i < $iterations; ++$i) {
    if (!isset($array2[$var])) {}
}
print "\nCase 3: values as keys, isset comparison";
print "\nTime 3: ".(microtime(true) - $start);
print "\n";

$start = microtime(true);
$array = array();
for($i=0; $i<$num_values; $i++) {
    $array3['test'.$i] = 1;
}
for($i = 0; $i < $iterations; ++$i) {
    if (!array_key_exists($var, $array3)) {}
}
print "\nCase 4: values as keys, array_key_exists comparison";
print "\nTime 4: ".(microtime(true) - $start);
print "\n"; 
```

我的结果（PHP 5.5.9）：

```
Case 1: plain comparison
Time 1: 31.616894006729

Case 2: in_array comparison
Time 2: 23.226133823395

Case 3: values as keys, isset comparison
Time 3: 0.050863981246948

Case 4: values as keys, array_key_exists comparison
Time 4: 0.13700890541077 
```

我同意，这有点极端，但它展示了 PHP 的类哈希表关联数组的大局和巨大潜力，你只需要使用它

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-27T21:26:04.230

in_array 对于大量项目会更快。基于与数据和您的计算机相关的许多因素，“大”是非常主观的。既然您在问，我假设您处理的项目数量并不多。对于较长的列表，请注意[此信息](http://blog.maartenballiauw.be/post/2007/01/php-code-performance-tweaks.aspx)，并使用翻转数组来衡量性能，以便 php 可以利用散列查找而不是线性搜索。对于“静态”数组，调整可能不会提高性能，但也可能。

使用 Owen 的测试代码，使用翻转数组和更多迭代以获得更一致的结果：

```
$array2 = array_flip($array);
$iterations = 10000000;

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    if (!isset($array2[$var])) {}
}
$end = microtime(true);
print "Time3: ".($end - $start)."<br />";

Time1: 12.875
Time2: 13.7037701607
Time3: 3.70514011383 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-16T04:04:50.407

请注意，正如 RoBorg 指出的那样，创建数组有开销，因此应该在迭代循环内移动它。出于这个原因，Sparr 的帖子也有点误导，因为 array_flip 函数存在开销。

这是另一个包含所有 5 种变体的示例：

```
$array = array('test1', 'test2', 'test3', 'test4');
$var = 'test';
$iterations = 1000000;

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
   if ($var != 'test1' && $var != 'test2' && $var != 'test3' && $var != 'test4') {}
}
print "Time1: ". (microtime(true) - $start);

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
   if (!in_array($var, $array) ) {}
}
print "Time2: ".(microtime(true) - $start);

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
   if (!in_array($var, array('test1', 'test2', 'test3', 'test4')) ) {}
}
print "Time2a: ".(microtime(true) - $start);

$array2 = array_flip($array);
$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
  if (!isset($array2[$var])) {}
}
print "Time3: ".(microtime(true) - $start);

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    $array2 = array_flip($array);
  if (!isset($array2[$var])) {}
}
print "Time3a: ".(microtime(true) - $start); 
```

我的结果：

```
Time1 : 0.59490108493 // straight comparison
Time2 : 0.83790588378 // array() outside loop - not accurate
Time2a: 2.16737604141 // array() inside loop
Time3 : 0.16908097267 // array_flip outside loop - not accurate
Time3a: 1.57209014893 // array_flip inside loop 
```

总之，使用`array_flip`(with isset) 比 inarray 快，但不如直接比较快。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-06-21T20:12:21.017

当谈到 PHP，并询问是否：

*   一组 "if" 和 "else ifs" ，
*   带有一组“或”条件的“如果”（如原始帖子详细信息中所示），或
*   将“in_array”与动态构造的数组一起使用，

更好，

应该记住，PHP 语言“switch”语句是为这种情况设计的替代方法，可能是更好的答案。（虽然张贴者的例子让我们只比较两个解决方案，但实际的问题标题要求考虑 in_array 与 PHP 语句，所以我认为这是公平的游戏）。

那么，在海报的示例中，我建议：

```
switch ($var)
{ case 'test1': case 'test2': case 'test3': case 'test4':
     echo "We have a good value"; break;
  default:
     echo "We do not have a good value";
} 
```

我希望 PHP 在这种情况下允许使用几个非原始构造，例如“或”的逗号。但是上面是 PHP 的设计者认为是处理这个问题的最清晰的方法。而且它在执行时似乎也比其他两种选择更有效。

只要我说的是愿望清单，在 SQL 中找到的“IN”对于发布者的示例情况会更加清晰。

这种想法可能是导致人们想要在这种情况下使用“in_array”的原因，但不幸的是必须构建一个数据结构，然后使用为该数据结构设计的谓词，而不是有办法只在没有发生这种开销的情况下说出来。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-08-27T07:52:56.363

我知道这个问题已经有将近 10 年的历史了，但是还有其他方法可以做到这一点。我使用了[Nick 页面中的](http://nickology.com/2012/07/03/php-faster-array-lookup-than-using-in_array/)方法 B，其中包含数千个条目。它非常快。

```
foreach(array_values($haystack) as $v)
    $new_haystack[$v] = 1; 
}

// So haystack becomes:
$arr[“String1”] = 1;
$arr[“String2”] = 1;
$arr[“String3”] = 1;

// Then check for the key:
if (isset($haystack[$needle])) {
    echo("needle ".$needle." found in haystack");
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-02-08T23:31:23.740

我的测试

```
$array = array('test1', 'test2', 'test3', 'test4');
$var = 'test';
$iterations = 1000000;

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    if ($var != 'test1' && $var != 'test2' && $var != 'test3' && $var != 'test4') {}
}
$end = microtime(true);

print "Time1: ". ($end - $start)."<br />";

$start2 = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    if (!in_array($var, $array) ) {}
}
$end2 = microtime(true);

print "Time2: ".($end2 - $start2)."<br />";

$array_flip = array_flip($array);

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    if (!isset($array_flip[$var])) {}
}
$end = microtime(true);
print "Time3: ".($end - $start)."<br />";

$start = microtime(true);
for($i = 0; $i < $iterations; ++$i) {
    if (!isset($array[$var])) {}
}
$end = microtime(true);

print "Time4: ". ($end - $start)."<br />"; 
```

> 时间1：0.20001101493835
> 
> 时间2：0.32601881027222
> 
> 时间3：0.072004079818726
> 
> 时间4：0.070003986358643

# iphone - +initialize/+load 是否应该始终以 if (self == [MyClass class]) 守卫开头？

> ID：324666
> 
> 赞同：10
> 
> 时间：2008-11-27T21:18:57.460
> 
> 标签：iphone, objective-c, cocoa, macos

在你的一个 Objective-C 类中实现 +initialize 或 +load 方法时，你应该*总是*从这种保护开始吗？：

```
@implementation MyClass

+ (void)initialize {
    if (self == [MyClass class]) {
        ...
    }
}

...
@end 
```

似乎 +load 和 +initialize 中的代码通常只想执行一次。因此，这将有助于避免在子类加载/初始化时重复执行。

我想我只是想从一些 ObjC 向导那里得到一些强化，这是必要的/常见的做法......

对此有何普遍看法？你会建议总是这样做吗？

您对 +load 和 +initialize 的建议是否相同，或者它们的处理方式是否有所不同？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T22:16:00.260

快速的回答是：不。

可以在 Apple 开发者邮件列表中找到有关[此问题的深入讨论。](http://lists.apple.com/archives/Cocoa-dev/2005/Sep/msg00055.html)

它的要点是：

1.  运行时实际上会在调用子类*之前*`+initialize`调用​​超类。
2.  *如果您*确实*包含了守卫，则具有自己`+initialize`方法的类的子类将不会触发相关的 KVO 通知。*

 *对于第 2 点的示例，请务必阅读上述主题中的[这篇文章。](http://lists.apple.com/archives/Cocoa-dev/2005/Sep/msg00061.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-27T22:03:31.550

是的，如果您正在初始化应该只初始化一次的全局变量，您应该在您的 intialize 和 load 方法中执行此操作。

也就是说，在很多情况下你可以避免它......

如果需要对每个类的每个继承者执行工作，则不应使用此条件包装：

*   例如，将每个类的所有继承类名添加到集合中。
*   **编辑添加：**或者您正在建立 KVO 依赖项（如 eJames 所述）

还有一些情况你不需要打扰：

*   如果您执行的操作是幂等的（如果重复则不要更改值）
*   该类是“密封的”（设计没有后代）

“幂等”部分是相关的。初始化程序应该只是设置初始状态（每次都应该相同）。在一个好的初始化器中，重复应该无关紧要。尽管我认为如果您忘记在条件中包含该方法*确实*很重要，这可能会很烦人。

**编辑添加：另**一种方法，正确反映任何仅初始化一次的要求，将测试您要初始化的属性是否已经初始化。IE

```
id myGlobalObject = nil;

+(void)initialize
{
    if (myGlobalObject == nil)
    {
        myGlobalObject = [[MyGlobalClass alloc] init];
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-09T09:25:10.770

是的！！！！

因为一个类的initialize方法可能会被调用很多次。例如，当你在父类中实现了initialize，而在子类中没有实现，那么你先调用子类，父类的初始化会被调用两次。

```
@implementation BaseClass

+ (void)initialize
{
    NSLog(@"BaseClass initialize self=%@, class=%@", self, [BaseClass class]);
}

@end

@interface SubClass : BaseClass
@end

@implementation SubClass

// don't implement the initialize method

@end 
```

===================

现在当你先调用 SubClass 时，就像

```
[SNSBaseSubLogic alloc] 
```

查看调试控制台，输出：

```
BaseClass initialize self=BaseClass, class=BaseClass
BaseClass initialize self=SubClass, class=BaseClass 
```

所以，你必须使用

```
+ (void)initialize
{
   if (self == [BaseClass class]) {
      NSLog(@"BaseClass initialize self=%@, class=%@", self, [BaseClass class]);
   }
} 
```

确保方法体执行一次。

# jsf - JSF : java.lang.IllegalStateException: Client-id : _idJsp35 在 Alfresco Web 客户端的面树中重复

> ID：324668
> 
> 赞同：2
> 
> 时间：2008-11-27T21:21:12.120
> 
> 标签：jsf, alfresco

我正在扩展 Alfresco Web Client 并在一个页面中扩展面板时出现此错误。我总是不明白。

```
JSF : java.lang.IllegalStateException: Client-id : _idJsp35 is duplicated in the faces tree in Alfresco Web Client 
```

我试图为每个组件提供可能的唯一 ID，但仍然出现错误。我怎样才能找到该错误的来源？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-10T13:28:31.063

每当我看到这一点时，都是由于您的 JSP 中有重复的 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-14T16:55:57.763

不指定 id 并让 JSF 为您完成工作不是更好吗？

# .net - 文件的安全流更新

> ID：324670
> 
> 赞同：2
> 
> 时间：2008-11-27T21:22:07.780
> 
> 标签：.net, windows

我们通过将新记录写入临时文件来执行大型文本文件的更新，然后用临时文件替换旧文件。一个高度缩写的版本：

```
var tpath = Path.GetTempFileName();
try
{
    using (var sf = new StreamReader(sourcepath))
    using (var tf = new StreamWriter(tpath))
    {
        string line;
        while ((line = sf.ReadLine()) != null)
            tf.WriteLine(UpdateLine(line));
    }

    File.Delete(sourcepath);
    File.Move(tpath, sourcepath);
}
catch
{
    File.Delete(tpath);
    throw;
} 
```

如果有任何东西抛出异常（找不到文件，没有权限），原始文件保持不变，这就是我们想要的。

但是，代码存在以下问题：

1.  现实世界中是否存在`Delete`成功但`Move`失败的情况？这将删除原始数据和更新数据。这会很糟糕。

2.  最常见的失败是从另一个应用程序打开源文件，并且`Delete`失败。这意味着所有更新工作都将被丢弃。有没有办法在开始时查看源文件是否可删除，如果不是则放弃更新？

3.  我们有用户将 Windows 资源管理器摘要属性（如标题或评论）放在文件上。当我们删除文件时，这些将被丢弃。有没有办法将旧文件的摘要属性复制到新文件？我们应该这样做吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T21:46:30.587

避免“删除然后移动失败问题”的正常方法是：

*   写入 file.new
*   将 file.current 移动到 file.old
*   将 file.new 移动到 file.current
*   删除文件.new

然后，当您阅读时，如果缺少 file.current，请使用 file.new，如果看到 file.old，请删除它。

检查文件是否可用：尝试打开它进行写入，但追加到末尾。当然，您需要先关闭手柄，然后再移动它，中间其他人可以打开它——但这至少是一个*合理*的优化。

不确定是否要复制摘要等，恐怕。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T23:17:02.523

为什么不先检查 FileAttributes 呢？

尝试这样的事情：

```
//If File is readonly
if ( (file.Attribute & System.FileAttributes.ReadOnly) == System.FileAttributes.ReadOnly ) 
        //Don't delete. 
```

也尝试使用 .OpenWrite()。如果您可以打开要写入的文件，则说明该文件未被访问且当前未被使用。如果文件当前处于未打开状态，您只能打开文件进行写入。我不推荐这个，但它可以帮助你。

```
 FileStream fs = File.OpenWrite(file);
  fs.Close();
  return false; 
```

您还可以使用 FileLock 检查方法。像这样的东西：

```
protected virtual bool IsFileLocked(FileInfo file)
{
    try
    {
        using (file.Open(FileMode.Open, FileAccess.ReadWrite, FileShare.None))
        {
           return false;
        }
    }

    catch (IOException)
    {
        return true;
    } 
```

}

您可能还想检查 FileIOPermission.Write。这允许查看文件是否可写（并且能够删除）。

```
fileIOPerm = New FileIOPermission(FileIOPermissionAccess.Write, FileSpec);
fileIOPerm.Demand(); 
```

关于原始帖子中的问题 #3...您始终可以使用 File.Copy(path1,path2,true) 将文件移动到临时文件夹。您可能需要考虑使用临时文件夹并为文件操作编写更好的逻辑。

如果您确实决定使用临时文件夹或临时文件/中间文件，那么您还将解决您的问题 #2。先尝试移动文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T21:48:06.167

一些“肮脏”的把戏。

1.  首先不要删除原始文件，先将其移动到另一个位置（临时路径），然后如果移动更新文件成功，则删除旧文件。如果更新失败，您将在某个地方找到原始文件来恢复它。

2.  我认为这篇文章会对你有帮助[MSDN](http://msdn.microsoft.com/en-us/library/aa363874(VS.85).aspx)

3.  如果用户需要“标题”和“评论”，您应该保留它们。我从来没有尝试将它们从一个文件复制到另一个文件，所以我不知道如何帮助你。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T22:02:49.990

[Windows Vista 或更高版本上的事务性 NTFS](http://en.wikipedia.org/wiki/Transactional_NTFS)可能对您的方案有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-27T23:22:55.197

正如已经提到的，您确实应该研究 ReplaceFile，它旨在帮助您完成正在做的事情。.NET 函数只是 Win32 函数的包装，人们可能希望原子性问题已经解决。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T01:54:36.033

很多好的建议。我能够解决以下问题：

```
var sInfo = new FileInfo(sourcePath);
if (sInfo.IsReadOnly)
    throw new IOException("File '" + sInfo.FullName + "' is read-only.");

var tPath = Path.GetTempFileName();
try
{
    // This throws if sourcePath does not exist, is opened, or is not readable.
    using (var sf = sInfo.OpenText())
    using (var tf = new StreamWriter(tPath))
    {
        string line;
        while ((line = sf.ReadLine()) != null)
            tf.WriteLine(UpdateLine(line));
    }

    string backupPath = sInfo.FullName + ".bak";
    if (File.Exists(backupPath))
        File.Delete(backupPath);

    File.Move(tPath, backupPath);
    tPath = backupPath;
    File.Replace(tPath, sInfo.FullName, null);
}
catch (Exception ex)
{
    File.Delete(tPath);
    throw new IOException("File '" + sInfo.FullName + "' could not be overwritten.", ex);
} 
```

`OpenText`如果源文件打开或不可读，并且更新未完成，则抛出。如果有任何问题，原始文件将保持不变。`Replace`将旧文件的摘要属性复制到新文件。即使源文件与临时文件夹位于不同的卷上，这也有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-27T22:36:16.787

我发现将这种模式包装在它自己的类中很有用。

```
class Program {
    static void Main( string[] args ) {
        using( var ft = new FileTransaction( @"C:\MyDir\MyFile.txt" ) )
        using( var sw = new StreamWriter( ft.TempPath ) ) {
            sw.WriteLine( "Hello" );
            ft.Commit();
        }
    }
}

public class FileTransaction :IDisposable {
    public string TempPath { get; private set; }
    private readonly string filePath;

    public FileTransaction( string filePath ) {
        this.filePath = filePath;
        this.TempPath = Path.GetTempFileName();
    }

    public void Dispose() {
        if( TempPath != null ) {
            try {
                File.Delete( TempPath );
            }
            catch { }
        }
    }

    public void Commit() {
        try {
            var oldPath = filePath + ".old";
            File.Move( filePath, oldPath );
        }
        catch {}

        File.Move( TempPath, filePath );

        TempPath = null;
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-29T02:04:37.150

此代码片段显示了一种获得对文件的独占访问权限的技术（在本例中为读取）：

```
// Try to open a file exclusively
FileInfo fi = new FileInfo(fullFilePath);

int attempts = maxAttempts;
do
{
    try
    {
        // Try to open for reading with exclusive access...
        fs = fi.Open(FileMode.Open, FileAccess.Read, FileShare.None);
    }
    // Ignore any errors... 
    catch { }

    if (fs != null)
    {
        break;
    }
    else
    {
        Thread.Sleep(100);
    }
}
while (--attempts > 0);

// Did we manage to open file exclusively?
if (fs != null)
{
    // use open file....

} 
```

# sql - 指定集群主控的 SQL 语句

> ID：324677
> 
> 赞同：1
> 
> 时间：2008-11-27T21:27:02.387
> 
> 标签：sql, cluster-computing

我有集群应用程序，需要将其中一个节点指定为主节点。集群节点在带有**nodeID**、**isMaster**、**lastTimestamp**列的表中进行跟踪。

**集群中的每个节点每X**秒都会尝试成为主节点。节点只能成为主节点，如果

*   没有其他主节点
*   当前主节点上的**lastTimestamp早了****2*X**

满足上述条件之一时

*   当前主节点的**isMaster**应该被清除
*   应该设置新主节点的**isMaster**
*   新主节点的**lastTimestamp**应设置为“now”时间戳。

在没有两个或更多节点成为主节点的情况下，实现上述目标的**单个（可移植）SQL 语句是什么？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T00:09:33.667

我可以想象一个 Oracle 数据库的解决方案，但我不确定它是否可移植。为什么这需要是一个可移植的 SQL 语句？大多数数据库允许表锁定和事务，这允许您在多个语句中执行此类操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T05:53:55.563

这种协调通常不是由 DBMS 本身处理，而不是由运行在 DBMS 上的应用程序处理吗？我也可以设想在我熟悉的 DBMS 中执行此操作的方法，但对您的系统没有更多了解（它可能使用共享磁盘，因此所有节点都看到相同的数据；可能存在阻止并发访问的锁定协议到数据；是否是主节点上的用户进程定期更新 lastTimestamp），这将很难有多大帮助。而且，正如 Jamie Love 所指出的，DBMS 应该允许多个进程协调对相关记录的访问——主要的相关记录是当前的主记录。

[*编辑*：也许我读得太多了。

单个 UPDATE 语句必须对表的两行进行差异更新，并且如果两个更新中只有一个是可能的，则必须失败。也就是说，它必须既将当前的主服务器更改为非主服务器，也必须更改自己的记录，使其成为主服务器。一个问题是 DBMS 如何强制执行“只有一行可能是主”约束。让我们假设如果出现问题，它的工作原理和整个语句将失败 - 正如它应该的那样。为什么人们经常忽略表名，即使他们提供了列名？哦，好吧，表名以下是*ClusterControl*。每个节点必须以某种方式知道自己的 NodeID；我使用 {MyNodeID} 来指示它出现在 SQL 中的位置。

您需要单独的心跳更新：

```
 UPDATE ClusterControl
     SET lastTimestamp = CURRENT_TIMESTAMP
     WHERE NodeID = {MyNodeID}; 
```

“获取主状态”更新可能是：

```
UPDATE ClusterControl
    SET lastTimestamp = (CASE
                         WHEN NodeID = {MyNodeID} THEN CURRENT_TIMESTAMP
                         ELSE lastTimestamp END),
        isMaster      = (CASE
                         WHEN NodeID = {MyNodeId} THEN 'Y'
                         ELSE 'N' END)
    WHERE (NodeID  = {MyNodeID} AND isMaster = 'N') OR
          (NodeID != {MyNodeID} AND
           lastTimestamp < CURRENT_TIMESTAMP - INTERVAL '120' SECOND AND
           isMaster = 'Y'
          ); 
```

“获取主状态”更新背后的理论是（SET 子句）：

*   新 master 的 lastTimestamp 字段设置为当前时间戳，但旧 master 保持不变。
*   isMaster 字段更改为新主服务器的“Y”和旧主服务器的“N”。

WHERE 子句背后的理论是：

*   仅当当前节点不是当前节点且时间戳超过 120 秒（问题中的“2 * X”）时更改当前节点的记录，如果它不是当前主节点或当前主节点的记录.

由于有一个（可能是神话般的）约束来确保只有一行具有“Y”标志，因此当主服务器是最新的时，这应该会按要求失败。

**未经测试的 SQL！**

]

# c# - C# 将 HyperLinkColumn 添加到 GridView

> ID：324682
> 
> 赞同：1
> 
> 时间：2008-11-27T21:32:36.120
> 
> 标签：c#, gridview

我正在尝试将 HyperLinkColumns 动态添加到我的 GridView。我有以下代码：

```
HyperLinkColumn objHC = new HyperLinkColumn();
objHC.DataNavigateUrlField = "title";
objHC.DataTextField = "Link text";
objHC.DataNavigateUrlFormatString = "id, title";
objHC.DataTextFormatString = "{2}";

GridView1.Columns.Add(objHC); 
```

这不起作用，所以.. 我怎样才能将 HyperLinkColumn 添加到我的 GridView？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T22:02:47.137

您可能希望在绑定行时添加它：

```
protected void yourGrid_RowDataBound(object sender, GridViewRowEventArgs e)
{
        HyperLink hlControl = new HyperLink();
        hlControl.Text = e.Row.Cells[2].Text; //Take back the text (let say you want it in cell of index 2)
        hlControl.NavigateUrl = "http://www.stackoverflow.com";
        e.Row.Cells[2].Controls.Add(hlControl);//index 2 for the example
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T21:43:56.113

您必须在 DataBinding 发生之前执行此操作，检查[GridView Events](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview_events.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-15T13:50:34.833

我认为您应该使用 HyperLinkField 而不是 HyperLinkColumn。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T15:46:10.207

如果您只想重定向到另一个 URL，那么只需使用 HyperLink Web 控件并将其推送到 RowDataBound 事件中所需的 GridView Row 单元格中。
或者
如果你想在发送到另一个 URL 之前执行任何服务器事件，试试这个
  1) 在 GridView 的 RowDataBound 事件中添加 LinkBut​​ton 对象。
  2) 设置 CommandName、CommandArgument 属性（如果需要将任何数据传递给此对象）。
  3）通过处理GridView的RowCommand事件来捕获这个事件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T15:48:43.323

顺便说一句，我只是认为您可以使用 DataGridView 并在设计器中选择 Link 列，您的问题就会结束。DataGridView 确实有一个链接列，而不是您只需要在“单击”上添加一个事件，您就可以获得所需的内容。如果您可以切换到 DataGridView，则此解决方案有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-16T17:02:54.443

我知道这个线程很旧，但忍不住加了我的 2 美分。以下教程中解释的过程对我来说非常有效： [ASP Alliance](http://authors.aspalliance.com/aspxtreme/webforms/controls/addinghyperlinkfieldstogridview.aspx)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-11-27T21:43:47.800

看来你把事情搞混了。我不知道 - 该代码是如何编译的？

GridView 的列集合可以接受“DataControlField”类型的列。我认为您需要初始化 HyperLinkField 并设置相关属性（文本、NavigateUrl、HeaderText、Target）并将其添加到列集合中。

HyperLinkColumn 类在您使用 DataGrid 时有意义（不适用于 GridView）。

希望有帮助。

# shell - 命令行保留标记

> ID：324695
> 
> 赞同：0
> 
> 时间：2008-11-27T21:45:40.667
> 
> 标签：shell, command-line, cmd, command-line-interface, reserved-words

使用 CLI 构建应用程序时，避免使用通常用于 shell 功能的标记很有用。

例如，`|`用于将一个应用程序的输出连接到下一个应用程序的输入。

请提供需要转义才能使用的令牌的完整列表？

作为最低限度/摘要，对于每个令牌，请确定适用的操作系统/shell、令牌功能的简单说明以及任何转义方法。

（欢迎提供其他有用的信息，一旦上述内容明确。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T21:50:12.043

[从Unix](http://www.grymoire.com/Unix/Quote.html)开始怎么样？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T02:34:04.997

Fernando Miguélez 为您提供了极好的信息来源。规定哪些字符没有特殊含义几乎更容易。该列表将是：

```
A-Z a-z 0-9 _ - . , / + @ 
```

任何其他 ASCII 标点符号在某个地方都有一些特殊的意义。该列表中的某些成员与另一个字符组合具有特殊意义；例如，' `$@`' 和 ' `$-`' 都是特殊的，但 ' `$`' 告诉你这一点，而不是 ' `@`' 或 ' `-`'。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T02:43:29.550

在 Windows 和 MS-DOS 系统上，以下是无效的文件名：

```
CON, PRN, AUX, CLOCK$, NUL
COM0, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9
LPT0, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, LPT9 
```

在极少数情况下，您可以绕过此限制并创建此类文件，但您在尝试访问或查看它们时会遇到问题。

# javascript - 我可以向另一个域发出 XMLHttpRequest 吗？

> ID：324697
> 
> 赞同：22
> 
> 时间：2008-11-27T21:47:42.363
> 
> 标签：javascript, xml, ajax, xmlhttprequest

有没有办法将 XMLHttpRequest 与其他域结合使用？

我想从 Google 解析一些 xml 而不必使用服务器，因此运行起来非常复杂。

```
var req = getXmlHttpRequestObject();
...
req.open('GET', 'http://www.google.de/ig/api?weather=Braunschweig', true);
        req.setRequestHeader("Content-Type","text/xml");
        req.onreadystatechange = setMessage;
        req.send(null); 
```

在服务器端做这件事是没有选择的，至少我不必问

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-27T21:52:14.927

不，不是现在。我相信我读到计划/设计正在由标准组织为未来制定，因此我们可以安全地做到这一点。

否则，跨站点脚本漏洞将十分猖獗。

如果其他站点 API 支持，[JSONP是一种可能的解决方案。](http://www.west-wind.com/Weblog/posts/107136.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-04-10T07:44:22.403

HTML5 现在支持 XmlHttpRequest 级别 2 的跨域请求，请查看：

[http://www.html5rocks.com/en/tutorials/cors/](http://www.html5rocks.com/en/tutorials/cors/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T21:54:01.833

这是一个安全问题，大多数（全部？）浏览器不会让你这样做。您可以使用隐藏的 IFrame 进行提取，但它足够复杂，我只需使用服务器（或切换到不同的语言，如果我不必在浏览器中运行）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-11-13T12:29:49.973

由于客户端（浏览器）的安全问题，您不能进行跨域请求，例如通过 XMLHttpRequest 或 jQuery（它是 XMLHttpRequest 的包装器）从 example1.com 到 example2.com。这在支持HTML5的现代浏览器中可以通过CORS(跨源资源共享)有效实现，并不是每个客户端浏览器都可以使用。所以解决方法是在example2.com的example1.com中插入script标签，这个解决方案是众所周知的作为 JSON-P（带填充的 JSON），名称可能会产生误导，因为数据可以是服务器提供的任何格式（example2.com）。其实现代码在此链接[http://newtechinfo.net/jsonp中给​​出-for-cross-domain-ajax/](http://newtechinfo.net/jsonp-for-cross-domain-ajax/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-27T21:54:47.760

由于浏览器现在限制 XSS 攻击的 SOP（同源策略），这是不可能的。
您将不得不使用服务器端脚本（PHP 或其他东西）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-09-16T06:28:19.230

可以使用 HTML5 向另一个域发出 XHR。当使用 HTTP 与另一个网站通信时，您也可以使用 XHR 发出不同的协议请求。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-27T21:55:02.720

您可以尝试在服务器端做一些事情。因此，在您的应用程序中，您向远程站点发出请求，获取结果并将其返回给您的客户端。然后，AJAX 调用仅调用您自己的服务器并且可以正常工作。

# arm - 手臂。从超级用户模式访问用户 R13 和 R14

> ID：324704
> 
> 赞同：7
> 
> 时间：2008-11-27T21:53:45.767
> 
> 标签：arm, supervisor-mode

如何访问进入管理员模式时保存的用户 R13 和 R14？我正在使用 ARM7TDMI。

IE 我不想访问现在包含用户模式返回地址的主管 R14，而是想要用户模式的链接寄存器的值。这是我正在编写的调试器的一部分。

这些寄存器有特殊的别名吗？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-28T01:38:08.683

我将描述您特定问题的答案，但同样的方法也适用于其他模式。

您需要通过将 CPSR 中的模式位更改为系统模式来更改处理器模式。这将使您可以访问用户模式的 SP/LR（R13 和 R14）。请记住，系统模式是特权模式，但它的 R13 和 R14 与用户模式的 R13 和 R14 相同。

进入系统模式后，阅读 R13 和 R14 并将它们放在您想要的位置。然后只需将模式位切换回您以前的模式（我相信在您的示例中这是主管模式），您就可以开始了。

**请注意，我们没有从主管模式切换到用户模式。** 如果您从主管切换到用户，**您将无法回到主管模式**。（否则将无法保护用户代码升级权限）。这就是我们使用系统模式的原因——系统模式具有特权，但寄存器与用户模式相同。

您可以通过操纵 CPSR 中的模式位随意在任何特权模式之间切换。我认为它们是低5位？我在路上，没有触手可及的信息。否则我会为您提供我上面描述的汇编代码。实际上，如果你想在你的胸前放一些头发，就拿我上面给你的东西，实施它，测试它，然后把它贴回这里。:-D

（我应该为“一般情况”添加一件事（你的情况非常具体）——你可以检查 SPSR 以查看“你来自哪里”——并使用它来确定你需要切换到哪种模式。）

顺便说一句，我最近刚刚为我的一位客户做了这个……我猜是小世界。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-28T17:52:34.447

我发现了一个更好的方法：-

在执行 STM 时，如果 r15 不是操作数之一，则 ^ 可以访问用户模式寄存器。但是，自动递增似乎在指令中不起作用，如果您想访问寄存器库，则需要在之后使用 nop。

就像是

```
stmfd r13, {r13-r14}^ ;store r13 and r14 usermode
nop
sub r13, r13, #8      ;update stack pointer 
```

# c++ - 将stringstream内容写入ofstream

> ID：324711
> 
> 赞同：63
> 
> 时间：2008-11-27T21:56:05.823
> 
> 标签：c++, stl, parameters, stringstream, ofstream

我目前使用`std::ofstream`如下：

```
std::ofstream outFile;
outFile.open(output_file); 
```

然后我尝试将`std::stringstream`对象传递给`outFile`如下：

```
GetHolesResults(..., std::ofstream &outFile){
  float x = 1234;
  std::stringstream ss;
  ss << x << std::endl;
  outFile << ss;
} 
```

现在我`outFile`只包含垃圾：“0012E708”到处重复。

在`GetHolesResults`我可以写

```
outFile << "Foo" << std:endl; 
```

它将正确输出`outFile`。

关于我做错了什么有什么建议吗？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2008-11-28T02:25:21.273

您可以这样做，而无需创建字符串。它使输出流在右侧读出流的内容（可用于任何流）。

```
outFile << ss.rdbuf(); 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2015-03-16T06:00:43.510

如果您正在使用`std::ostringstream`并且想知道为什么什么都没有写，`ss.rdbuf()`那么使用`.str()`函数。

```
outFile << oStream.str(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-12-07T09:26:23.507

将 stringstream rdbuf 传递给流时，不会翻译换行符。输入文本可以包含`\n`因此查找替换不起作用。旧代码写入 fstream 并将其切换到 stringstream 会丢失 endl 转换。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-12-14T01:08:25.410

我宁愿写`ss.str();`而不是`ss.rdbuf();`（并使用字符串流）。

如果您使用`ss.rdbuf()`的格式标志`outFile`将被重置，从而使您的代码不可重用。即，调用者`GetHolesResults(..., std::ofstream &outFile)`可能想要写这样的东西来在表格中显示结果：

```
outFile << std::setw(12) << GetHolesResults ... 
```

...并想知道为什么忽略宽度。

# asp.net - 堆栈跟踪中的数字是什么意思

> ID：324714
> 
> 赞同：2
> 
> 时间：2008-11-27T21:58:43.417
> 
> 标签：asp.net, .net, stack-trace

[这个问题](https://stackoverflow.com/questions/305244/what-do-the-n-values-mean-at-the-end-of-a-method-name-in-a-stack-trace)的完全重复。

当您在 .Net 应用程序中遇到错误时，我们会得到一个堆栈跟踪。
例如

```
 [ADOException: cannot open connection]
  NHibernate.Impl.SessionFactoryImpl.OpenConnection() +153
  Hibernate.AdoNet.ConnectionManager.GetConnection() +119
  NHibernate.Impl.SessionImpl.get_Connection() +42 
```

这些数字是什么意思？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T22:13:07.240

数字表示错误所在的行。如果在发布模式下编译，它指的是 dll 中该函数中的 Microsoft 中间语言 (MSIL) 行。如果在调试模式下编译，它指的是代码中的实际行。

# c++ - C++ MySQL 数据库连接

> ID：324722
> 
> 赞同：1
> 
> 时间：2008-11-27T22:08:56.937
> 
> 标签：c++, mysql

我不是数据库专家，所以我正在寻找有关我正在考虑设置的基于 Web 的系统的建议。

我所拥有的系统的一般设置是它将有一个基于 Web 的界面（可能在 PHP 中）用于登录等，以及一些在服务器上运行的 C++ 代码进行一些处理。PHP 和 C++ 代码都需要对 MySQL DB 进行读/写访问。

那么，（1）使用 C++ 访问/更新 MySQL 数据库的最佳方法是什么？

(2) 对于可以同时从 PHP 和 C++ 访问的数据库，我是否应该注意任何问题/事情。我有点假设数据库会照顾所有这些......

谢谢，

勒汉

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-27T22:12:26.867

数据库应该处理并发访问。您可以考虑使用[MySQL++](http://tangentsoft.net/mysql++/)作为库来从 C++ 代码访问 mysql。我只知道它的存在，没有使用经验，所以我不能告诉你可用性。

# regex - xsd 模式限制 - 不允许反斜杠

> ID：324724
> 
> 赞同：1
> 
> 时间：2008-11-27T22:12:24.853
> 
> 标签：regex, validation, xsd

我需要在 xsd 文档定义的给定字符串字段中禁止反斜杠字符。但是，像我一样绿色，我对我的 xsd 和/或正则表达式知识没有信心。这是我到目前为止所拥有的：

```
<xs:simpleType name="BackslashRestrictedField">
  <xs:restriction base="xs:string">
    <xs:minLength value="0" />
    <xs:pattern value="[^\\]"/> <!-- disallow backslash '\' char ??? -->
  </xs:restriction>
</xs:simpleType> 
```

建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T22:38:30.823

如果我是对的，使用此表达式，您只允许一个长度为一个字符且不接受反斜杠的字符串。在您的正则表达式末尾添加 * 应该可以解决此问题。

# php - 有没有办法从 php 中在沙箱中执行 php 代码

> ID：324726
> 
> 赞同：22
> 
> 时间：2008-11-27T22:12:52.203
> 
> 标签：php, module, sandbox

我想从 php 执行一个 php 脚本，它将使用不同的常量和已定义的不同版本的类。

是否有一个沙箱 php_module 我可以：

```
sandbox('script.php'); // run in a new php environment 
```

代替

```
include('script.php'); // run in the same environment 
```

还是[proc_open()](http://php.net/proc_open)是唯一的选择？

PS：该脚本无法通过网络访问，因此 fopen(' [http://host/script.php](http://host/script.php) ') 不是一个选项。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-27T22:23:14.850

有[runkit](http://www.php.net/runkit) ，但如果您不需要主进程和子进程之间的任何交互，您可能会发现只通过命令行调用脚本（使用[shell_exec ）更简单。](http://www.php.net/shell_exec)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-07-02T10:35:36.760

这是 GitHub 上的一门课程，在早期阶段可能会有所帮助，但看起来很有希望。

[https://github.com/fregster/PHPSandbox](https://github.com/fregster/PHPSandbox)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-28T11:04:23.893

此外，您应该查看[反引号运算符](http://www.php.net/language.operators.execution)：

```
$sOutput = `php script_to_run.php`; 
```

这将允许您检查正在运行的脚本的输出。但是，请注意，脚本将以您拥有的权限运行，但您可以通过在 Linux 上使用 sudo 来规避这一点。

此方法还假定您已安装 PHP CLI，但并非总是如此。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-17T10:03:48.060

有[`Runkit_Sandbox`](http://www.php.net/manual/en/runkit.sandbox.php)- 你可以让它工作，它是一个 PHP 扩展。我会说要走的路。

但是您可能需要自己创建一个“沙箱”，例如通过重置您使用的超全局变量的全局变量状态。

```
class SandboxState
{
    private $members = array('_GET', '_POST');
    private $store = array();
    public function save() {
        foreach($members as $name) {
            $this->store[$name] = $$name;
            $$name = NULL;
        }
    }
    public function restore() {
        foreach($members as $name) {
            $$name = $this->store[$name];
            $this->store[$name] = NULL;
        }

    }
} 
```

用法：

```
$state = new SanddboxState();
$state->save();

// compile your get/post request by setting the superglobals
$_POST['submit'] = 'submit';
...

// execute your script:
$exec = function() {
    include(func_get_arg(0)));
};
$exec('script.php');

// check the outcome.
...

// restore your own global state:
$state->restore(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-09-09T21:03:38.937

动态插件函数执行，允许加载的文件和函数执行它想要的任何东西，但是它只能接受和返回可以`json_encode`'ed 的变量。

```
function proxyExternalFunction($fileName, $functionName, $args, $setupStatements = '') {
  $output = array();
  $command = $setupStatements.";include('".addslashes($fileName)."');echo json_encode(".$functionName."(";
  foreach ($args as $arg) {
    $command .= "json_decode('".json_encode($arg)."',true),";
  }
  if (count($args) > 0) {
    $command[strlen($command)-1] = ")";//end of $functionName
  }
  $command .= ");";//end of json_encode
  $command = "php -r ".escapeshellarg($command);

  exec($command, $output);
  $output = json_decode($output,true);
} 
```

外部代码是完全沙盒的，您可以通过执行应用任何您想要的权限限制`sudo -u restricedUser php -r ...`。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-04T05:18:28.573

为此，我开发了一个 BSD 许可的沙箱类。它利用 PHPParser 库来分析沙盒代码，根据用户可配置的白名单和黑名单对其进行检查，并具有广泛的配置选项以及合理的默认设置。根据您的需要，您可以轻松地重新定义在沙盒代码中调用的类并将它们路由到不同的类。

该项目还包括一个沙盒工具包（仅在您的本地机器上使用！），可用于试验沙盒设置，以及完整的手册和 API 文档。

[https://github.com/fieryprophet/php-sandbox](https://github.com/fieryprophet/php-sandbox)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-12T04:33:29.257

我知道它不是 100% 相关的主题，但可能对某人有用 n__n

```
function require_sandbox($__file,$__params=null,$__output=true) {

    /* original from http://stackoverflow.com/a/3850454/209797 */

    if($__params and is_array($__params))
     extract($__params);

    ob_start();
    $__returned=require $__file;
    $__contents=ob_get_contents();
    ob_end_clean();

    if($__output)
     echo $__contents;
    else
     return $__returned;

}; 
```

# c# - 如何模拟 System.Data.IDataReader 中的 GetValues() 方法？

> ID：324727
> 
> 赞同：5
> 
> 时间：2008-11-27T22:12:59.580
> 
> 标签：c#, unit-testing, rhino-mocks, datareader

如何模拟 System.Data.IDataReader 中的 GetValues() 方法？

这个方法改变了传递给它的对象数组，所以它不能简单地返回一个模拟值。

```
private void UpdateItemPropertyValuesFromReader( object item, IDataReader reader )
{
    object[] fields = new object[ reader.FieldCount ];
    reader.GetValues( fields ); //this needs to be mocked to return a fixed set of fields

    // process fields
   ...
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-27T22:17:36.780

您需要使用带有委托的 Expect.Do() 方法。然后这个委托需要“做”一些事情来代替调用代码。因此，编写一个为您填充字段变量的委托。

```
private int SetupFields( object[] fields )
{
    fields[ 0 ] = 100;
    fields[ 1 ] = "Hello";
    return 2;
}

[Test]
public void TestGetValues()
{
    MockRepository mocks = new MockRepository();

    using ( mocks.Record() )
    {
        Expect
            .Call( reader.GetValues( null ) )
            .IgnoreArguments()
            .Do( new Func<object[], int>( SetupField ) )
    }    

    // verify here
} 
```

# postal-code - 英国郊区数据库

> ID：324736
> 
> 赞同：0
> 
> 时间：2008-11-27T22:18:19.507
> 
> 标签：postal-code

这不是一个真正的技术问题，而是我正在构建的系统所必需的。我在英国郊区/邮政编码数据库之后。我无法在任何地方找到它，并想知道它是否可用（免费）。我知道在澳大利亚可以从澳大利亚邮政免费下载。此外，还需要一个美国郊区/邮编数据库作为次要问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T22:23:09.920

可能值得一看 我在[哪里可以获得所有国家/地区的邮政编码？](https://stackoverflow.com/questions/308017/where-can-i-get-postal-codes-for-all-countries)

接受的答案是[http://www.geonames.org/](http://www.geonames.org/)，但也列出了其他一些选项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T23:49:35.393

要获取美国邮政系统的数据库工具，请访问此处：

[美国邮政系统数据库工具](https://www.usps.com/business/address-information-systems.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T22:40:39.323

英国特定：

您可以从皇家邮政购买信息。该数据库在这里被称为 PAF[详细信息。](http://www.royalmail.com/portal/rm/jump2?mediaId=400085&catId=400084)它非常昂贵，而且您必须每年支付。在我看来完全是抢劫，但确实如此。

或者，您可以使用 3rd 方分销商，实际上并不便宜，但提供更好的 API。我们使用[Postcode Anywhere](http://www.postcodeanywhere.co.uk/)，他们拥有令人讨厌的严格许可证，但非常好的 API 可以将搜索嵌入到应用程序/网站等中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-22T18:51:08.757

皇家邮政 PAf 数据难以负担，但如果您从皇家邮政索取样本数据，它们包括完整的地区表，以及该地区出现的邮政编码部门（例如，“CO6”中的“East Bergholt” 7")。它还包括标志，以显示邮政分类是否需要位置，以防邮政编码不清晰。

此外，正如[其他帖子](https://stackoverflow.com/questions/1461695/how-do-i-utilise-longitude-latitude-values-efficiently-in-mysql/)中所提到的，每个英国邮政编码的纬度/经度都已泄露。

# delphi - 如何在 Delphi 中为指向数组的指针保留内存？

> ID：324748
> 
> 赞同：1
> 
> 时间：2008-11-27T22:25:53.970
> 
> 标签：delphi, memory-management, pointers

我正在开发类来表示特殊类型的矩阵：

```
type
  DifRecord = record
    Field: String;
    Number: Byte;
    Value: smallint;
  end;

type
  TData = array of array of MainModule.DataRecord;

type
  TDifference = array of DifRecord;

type
  TFogelMatrix = class
  private
    M: Byte;
    N: Byte;
    Data: ^TData;
    DifVector: ^TDifference;
    procedure init(); 
  public
    constructor Create(Rows, Cols: Byte);
    destructor Destroy;
  end; 
```

现在在构造函数中，我需要为 Data 和 DifVector 类成员保留内存。如您所见，我使用指向记录数组的指针。所以，主要问题是，我怎样才能正确地保留内存？我想我不能使用这样的东西： 因为我正在失去主要想法 - 在运行时尽可能多地保留内存空间。感谢您的评论。
`new(Data);
new(DifVector);` 

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-27T22:29:54.257

由于您使用的是动态数组，`array of`因此您应该使用 SetLength 来指定数组的长度，这可以动态完成。

IE。像这样：

```
SetLength(Data, 100); 
```

这不会保留 100 个字节，但会保留足够的空间来容纳 100 个数组所包含的任何类型的元素。

将数组的声明更改为简单数组：

```
Data: TData;
DifVector: TDifference; 
```

并将它与 SetLength 一起使用，它应该可以解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T07:58:02.833

另请注意，在 Delphi 中，动态数组类型的变量存储为指针（在 DotNet 中，您将其称为引用类型）。

除非您将此变量转换为指针，否则编译器不会让您自己进行分配。您应该像已经提到的 lassevk 一样使用 SetLength()。

使用多维数组（如 TData），您可以通过一次调用 SetLength() 设置所有维度，一次性设置两个维度。这导致了一个类似立方体的结构（每个维度都具有相同的长度）。但是也可以为一个维度中的每个索引赋予与其下一个维度不同的长度。对于二维，这有时被称为“锯齿状”数组。

为此，您可以这样写：

```
SetLength(Data, SizeOfFirstDimension);
for i = 0 to SizeOfFirstDimension - 1 do
  SetLength(Data[i], SizeOfSecondDimensionPerIndex(i)); 
```

在此示例中，我使用名为“SizeOfSecondDimensionPerIndex”的函数来确定第二维中每个数组的大小，但您可以以任何方式确定此大小。

在旁注中，我建议您使用“R”前缀来定义记录类型。我在任何主要的编码风格指南中都不知道这一点，但是如果您查看指针的“P”前缀，接口的“I”前缀，类字段的“F”前缀，“a”前缀对于参数，常量的'C'-前缀，资源字符串的'S'-前缀，您可以遵循此逻辑并使用'R'-前缀作为记录。我知道这有助于我更好地掌握我的代码！

祝你好运！

# wpf - 通过 MembershipProvider 在断开连接的 WPF 应用程序中对 ActiveDirectory 用户进行身份验证和 GetRoles

> ID：324752
> 
> 赞同：9
> 
> 时间：2008-11-27T22:29:32.747
> 
> 标签：wpf, active-directory, roles, membership-provider

我有一个项目要求，我需要在远程/断开连接的 WPF 应用程序中对 ActiveDirectory 进行身份验证。

可能有几种方法可以尝试这样做，但是使用 ActiveDirectory 的 MembershipProvider 的最佳方法是什么？

我需要：

1.  验证用户是否存在。
2.  获取AD用户的组和角色。

这需要从 Active Directory 所在网络之外的远程位置进行。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-28T05:57:14.590

从 WinForms 或 WPF 应用程序中，您现在可以利用“[客户端应用程序服务](http://msdn.microsoft.com/en-us/library/bb384297.aspx)”（感谢 MS 提供了一个非常通用的名称，现在寻求帮助非常痛苦！）。

这允许您连接到可以验证登录的 WCF 服务。上面的链接有一个演练，展示了让它全部工作是多么容易，一旦你有一个工作的应用程序，你可以修改你的配置以指向不同的 MembershipProvider 和/或 RoleProvider。

值得注意的是，开箱即用的解决方案包括一个名为[ActiveDirectoryMembershipProvider](http://msdn.microsoft.com/en-us/library/system.web.security.activedirectorymembershipprovider.aspx)的 MembershipProvider ，但没有用于 Active Directory 的 RoleProvider。

如果您确实需要获得角色（或组）的能力并且您正在使用 .NET 4.0，那么您可以利用新添加的 Active Directory API，这使一切变得更加容易，即[System.DirectoryServices.AccountManagement](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.aspx)。对于最基本的 Membership 和 Role 服务，您需要以下内容来创建自己的基本 MembershipProvider 和 RoleProvider：

*   MembershipProvider.ValidateUser() - 应该使用[PrincipalContext.ValidateCredentials()](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.principalcontext.validatecredentials.aspx)
*   RoleProvider.GetAllRoles() - 使用新的 GroupPrincipal() 作为新的[PrincipalSearcher()的源](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.principalsearcher.aspx)
*   RoleProvider.IsUserInrole() - 使用[UserPrincipal](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.userprincipal.aspx)。[FindByIdentity()](http://msdn.microsoft.com/en-us/library/bb383475.aspx)方法来获取用户，使用[GroupPrincipal](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.groupprincipal.aspx)。[FindByIdentity()](http://msdn.microsoft.com/en-us/library/bb359434.aspx)获取组，然后对用户使用[IsMemberOf()](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.userprincipal.ismemberof.aspx)方法查看他们是否是组的成员。

您可以根据需要实现尽可能少或尽可能多的 API，您应该在新的 AccountManagement 命名空间中找到执行此操作所需的一切。

# c# - Mediawiki 标记的开源解析器代码

> ID：324758
> 
> 赞同：8
> 
> 时间：2008-11-27T22:35:44.217
> 
> 标签：c#, php, open-source, parsing, mediawiki

我有兴趣选择性地解析 Mediawiki XML 标记以生成自定义 HTML 页面，该页面是实际 PHP Mediawiki 渲染引擎生成的 HTML 的某个子集。

我想要它用于 BzReader，这是一个用 C# 编写的离线 Mediawiki 压缩转储阅读器。因此，C# 解析器将是理想的，但任何好的代码都会有所帮助。

当然，如果以前没有人这样做过，我想是时候开始一个项目来维护一个免费且独立的 Mediawiki 解析器了，它基于 Mediawiki 自己的解析器，但与 Mediawiki 本身的集成不太紧密。

那么，有没有人知道我可以从任何基础开始，这会比从 Mediawiki PHP 代码中破解更好？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-27T22:42:11.050

[http://www.mediawiki.org/wiki/Alternative_parsers](http://www.mediawiki.org/wiki/Alternative_parsers)上有一个解析器列表，但那里不包含 ac# 解析器...

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-10T13:31:00.500

**更新**
记住，Screwturn 并不坚持使用 Mediawiki 语法，而是使用自己的变体，这确实有点不同。

Mediawiki 语法不适用于 LALR 解析器（甚至 LL*），因为它的定义有很多歧义，并且还允许使用 HTML。[在这个问题中](https://stackoverflow.com/questions/5442025/processing-a-rule-inside-another-rule)有一个讨论，你基本上坚持编写自己的解析器和标记器，而不是简单地为它编写一个 BNF 文件，然后使用 ANTLR/Gold/Irony。

[Roadkill Wiki](http://roadkill.codeplex.com)使用[克里奥尔语解析器](https://bitbucket.org/mrshrinkray/roadkill/src/55d7ee8c74f3131f807f8b1f34e4753adc9f20be/src/Roadkill.Core/Text/Parsers?at=default)进行 Mediawiki 解析，但支持有限。

* * *

Screwturn 在 GPL 许可下发布，并且有一个 C# 解析器：

*   [旋拧​​许可证](http://www.screwturn.eu/Commercial.ashx)
*   [螺丝转源下载](http://www.screwturn.eu/download.ashx)（可惜没有web svn）

你所学的课程是 Core.Formatter ，它有很多正则表达式来完成它的工作：

```
public static class Formatter {

} 
```

这不是最好看的代码“但它有效”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-27T23:02:53.007

[我在这里](http://hewgill.com/journal/entries/343-the-abomination-of-mediawiki-templates)对 Mediawiki 模板有一些话要说。有趣的是，现在有一个替代解析器列表，我将不得不对此进行调查。

# javascript - 如何从客户端脚本使用远程 Web 服务？

> ID：324771
> 
> 赞同：6
> 
> 时间：2008-11-27T22:53:23.837
> 
> 标签：javascript, ajax, web-services, http, mashup

据我了解，由于当前浏览器中的“同源策略”强制执行，不可能从发送到与 Javascript 原始域不同的域的 XmlHttpRequest 获取数据。

我在这件事上的经验几乎为零，所以我对 Javascript 无法使用 Web 服务感到困惑。这是否意味着具有 Ajax 功能的 Web 应用程序只能与自己交互，而不能调用其他域提供的服务？“混搭”如何运作？我猜这些服务是在服务器端使用的，然后数据通过本地 Ajax 调用传递给客户端。我不知道。

我可以想象实现客户端使用服务的唯一方法是通过`<script>`标签直接从目标 Web 服务的域中检索 Javascript 文件，然后使用其 API 与远程域进行交互。

谁能启发我？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-28T00:56:06.070

在您的问题中，您提到了 <script> 技巧。JSONP 就是基于此。[它是大约 3 年前由 Bob Ippolito 正式提出的](http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/)。它没有让您有权谈论脚本的来源——来源是由您的网页定义的，而不是它包含的其他内容。它之所以起作用，只是因为服务器将 JSON 包装在一个回调函数中，该函数应该在您的代码中定义，并在加载时由 <script> 执行。JSONP 最著名的例子是 Yahoo 服务，包括 Flickr。

另一种技术是使用 window.name 来传输信息。[四个月前，Kris Zyp 详细介绍了这项技术](http://www.sitepen.com/blog/2008/07/22/windowname-transport/)。此外，他的文章将 window.name 传输与 JSONP 进行了比较。我不知道有任何知名服务提供商支持这种新的传输方式。显然它会随着时间而改变。

当然，我应该提到即将推出的[Microsoft XDomainRequest](http://msdn.microsoft.com/en-us/library/cc288060(VS.85).aspx)。它计划与 IE8 一起发布，并且没有其他供应商承诺支持它，但它被提出是为了包含在 HTML 5 中。XDR 是一个有用的功能，但我怀疑它会在发布之前进行多次更改公认。

如果您查看链接，您现在可能已经知道所有这些方法都需要来自 3rd 方服务器的一定程度的合作。您不能随意使用随机服务。如果您确实必须使用不合作的服务，唯一的解决方案是通过您自己的服务器代理它，但存在所有相关问题：合法性有问题、性能下降、服务器负载增加、用户浏览器和用户之间的连接数量减少你的服务器等等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-27T23:06:42.797

看看 JSONP，它使用几乎您所描述的方法围绕相同的来源策略工作，只要确保您相信您从哪里获得它......

# c# - Crystal Reports：传递多行参数值

> ID：324776
> 
> 赞同：2
> 
> 时间：2008-11-27T22:57:12.143
> 
> 标签：c#, .net, asp.net, crystal-reports

我想像这样将一些参数传递给 Crystal Report：

```
ReportDocument.DataDefinition.FormulaFields[parameterName].Text   = 'Text'; 
```

除非我想从 ASPX 传递一个多行文本框（包含 \n 和 \r 字符。）

报告查看器报告“缺少此字符串的匹配 '。”。

是否有任何示例/列表/建议如何解析（多行）文本并使其工作？

谢谢，

*斯特凡*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T22:36:39.653

如果你想保留换行符，你应该用 sindre j 描述的一些模糊的东西替换它们。为了使换行符在 Crystal Reports 中正确显示，您需要将 Crystal Report 公式中的晦涩字符替换为 html 换行符。然后将公式字段添加到报告中并右键单击，选择“格式字段”，选择“段落”选项卡，并将“文本解释”更改为“HTML 文本”。您还需要确保在“通用”选项卡上选中“可以增长”属性。请参见下面的示例公式：

`"<html>" + Replace({?ParameterField}, "___", "<br>") + "<html/>"`

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T12:02:34.480

在将 \r\n 对传递给报告之前，您必须用一些晦涩的东西替换它，然后制作一个水晶公式，将其转换回报告中的 cr-lf 对。

将 cr-lf 转换为三个下划线的示例

C＃

ReportDocument.DataDefinition.FormulaFields[somefield].Text = textWithCrLf.Replace("\r\n","___");

水晶配方：

替换（{somefield}，“___”，chr（13））

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-18T14:00:00.167

无论您采用何种解析技术，您都可能希望使用 Parameter 的 DefaultValues 或 CurrentValues 集合。DefaultValues 集合填充可用值的列表。CurrentValues 集合填充选定值的列表。

# python - 在 Django 中加快批量 ORM 操作的策略

> ID：324779
> 
> 赞同：9
> 
> 时间：2008-11-27T23:01:18.407
> 
> 标签：python, django, batch-file, orm

我的一个 API 调用可能会导致对大量对象（Django 模型）的更新。我遇到了性能问题，因为我正在单独更新每个项目，保存并继续下一个：

```
for item in Something.objects.filter(x='y'):
    item.a="something"
    item.save() 
```

有时我的过滤条件看起来像“其中 x 在 ('a','b','c',...)”。

对此的官方回答似乎[是“不会修复”](http://code.djangoproject.com/ticket/661)。我想知道人们在这些情况下使用什么策略来提高性能。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-28T04:39:02.267

您链接到的票证用于批量创建 - 如果您不依赖覆盖的`save`方法或前/后保存信号来做一些保存工作，[`QuerySet`有一个`update`方法](http://docs.djangoproject.com/en/dev/topics/db/queries/#updating-multiple-objects-at-once)可以用来`UPDATE`对过滤的行执行：

```
Something.objects.filter(x__in=['a', 'b', 'c']).update(a='something') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T02:05:22.670

您需要使用事务或手动创建 sql 语句。您还可以尝试使用支持一些出色的 ORM 功能的 SQLAlchemy，例如工作单元（或应用程序事务）。

Django 交易：[http ://docs.djangoproject.com/en/dev/topics/db/transactions/?from=olddocs](http://docs.djangoproject.com/en/dev/topics/db/transactions/?from=olddocs)

SQLAlchemy：[http ://www.sqlalchemy.org/](http://www.sqlalchemy.org/)

# code-snippets - 您如何存储您的个人片段数据库以便在任何地方（工作等）使用它？

> ID：324786
> 
> 赞同：13
> 
> 时间：2008-11-27T23:10:30.230
> 
> 标签：code-snippets

我已经阅读了有关存储代码片段的几个讨论，但我没有找到我正在寻找的信息，所以让我们定义它：

*   在家里，我有几个副项目，其中大部分都很小，一个很大，还有许多小例子，它们展示了一种特定的语言特性（例如，C++ 中的一些模板技巧）。
*   因为我认为这些示例在我工作时提供参考会很有用，而不是试图记住这个或在家里尝试和工作的特定片段的确切细节，我希望它可以用于例如在 USB 闪存驱动器上。
*   问题是大多数片段/小程序/示例都是在 Visual Studio 中组织、编写、编译和测试的，如果我必须将它们放在一些代码片段管理器应用程序中，那将是重复的。我可以将包含所有示例的 Visual Studio 解决方案的源代码复制到闪存驱动器，但与专用的代码片段存储库管理器相比，搜索不太方便。或者，如果我对示例写出更好的评论和描述，也许我可以改变这一点，这样就可以了。

任何想法、最佳实践、解决方案和类似东西的经验都值得赞赏。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T00:18:29.800

我将所有内容都保存在源代码控制存储库中，并按语言进行索引。当我学习新语言时，我会将一些有用的旧东西翻译成新语言，以学习如何用新语言做事。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T00:51:01.027

我将我的代码存储在一个在线源代码库 - code.google.com 中，并使用 Web 前端浏览感兴趣的部分。

因为在google上，所以也很容易搜索。。

您需要做的就是将代码组织到每种语言、区域等的文件夹中，并将它们全部放在同一个存储库中。

唯一的缺点是，**如果**您想对片段保密，那么这将不起作用。显然，您需要在线才能以这种方式访问​​，但您可以轻松地间歇性地进行 SVN 更新，以刷新您可能需要的任何本地离线副本。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-27T23:36:06.870

我发现 Wiki 是保存信息和代码片段的完美工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T23:39:34.913

与其说是片段，不如说是我自己收集或开发的常用库，我保留了一个名为“_lib”的文件夹。每当我需要该文件夹中的某些内容（例如：jquery.js、CSS 重置）时，我只需将该目录符号链接到我的工作文件夹中，然后就可以了！或者，我只是`svn:externals`用来将它引入其他项目。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T01:35:13.150

我在家里和工作中都在 Visual Studio 中工作。

我基本上将所有代码片段都放在一个文件夹中，该文件夹与我的[Live Mesh](https://www.mesh.com/Welcome/Default.aspx)同步。然后我将每个文件夹添加到 VS 以使其能够自动检测新片段。对我来说就像一个魅力:)

因此，我在[Snippy](http://www.codeplex.com/snippy)创建了一个片段，将其保存到我的同步文件夹中。繁荣，在VS中工作，根本没有额外的配置:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-09T12:35:33.197

查看[Snippets](http://snippets.me/) — Mac 和 Windows 上可用的代码片段管理器，支持同步并且是免费的。有一个称为[Distributors](http://snippets.me/distributors/)的功能，它允许您**在 IDE 或代码编辑器中重用代码片段**。这是[当前支持的 IDE 的列表](http://snippets.me/distributors/list.html)。

# c# - 有没有一种甜蜜、有效的方法可以用两个不同的参数两次调用同一个方法？

> ID：324797
> 
> 赞同：1
> 
> 时间：2008-11-27T23:23:31.187
> 
> 标签：c#, arrays, parameters, methods, call

例如说我有以下字符串：

var testString = "你好，世界";

我想调用以下方法：

var newString = testString.Replace("Hello", "").Replace("world", "");

是否有一些代码结构可以简化这一点，这样我只需要指定一次 Replace 方法，并且可以指定一堆参数一次性传递给它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T23:50:10.460

使这更具可读性的另一个选择是添加新行和适当的缩进（这对我来说是更好的选择）：

```
var newString = testString.Replace("Hello", "")
                          .Replace("world", "")
                          .Replace("and", "")
                          .Replace("something", "")
                          .Replace("else",""); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-27T23:37:58.053

创建一个函数，将`String`和 a传递给该函数`Dictionary(String, String)`。遍历 Dictionary 和 中的每个项目`InputString.Replace(DictionaryEntry.Key, DictionaryEntry.Value)`。返回具有替换值的字符串。

`.Replace.Replace`但如果只有2次，我会这样做......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-28T00:37:10.007

在某些语言（例如python）中，存在reduce 或fold 函数的概念——这是一种表示列表中所有元素的循环的功能方式。

使用 reduce 你可以写这样的东西

```
return reduce(lambda a, x: a.Replace(x, ''), ['hello', 'world'], 初始)

```

这与

```
a = 初始
对于 ['hello', 'world'] 中的 x：
    a = a.替换（x，''）
返回一个

```

在 python 中，您也可以将其发音为

```
减少（str.replace，['hello'，'world']，初始）。

```

当然，这是否更简单完全是另一个问题——但很多人当然喜欢编写这样的代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-27T23:42:08.370

正如其他帖子中所述，有很多方法。

但通常甜蜜=高效（=可维护）=简单。最好不要尝试，除非您描述问题的上下文有某些原因。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-27T23:37:49.473

您提出的任何构造都可能比您的原始帖子更复杂。如果您有很多不同的参数要传递，您可以构建这些参数的向量并在执行调用时对其进行迭代。但是话又说回来，对于您当前的示例，修改后的版本会更长，编写起来也更复杂。两次只是重复率太小。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-27T23:41:35.767

您可以创建自己的 Replace 扩展方法，该方法采用 IEnumberable 参数。然后循环遍历迭代器并使用 replace 方法。

然后你可以这样称呼它 .Replace(new string[] {"Matt", "Joanne", "Robert"}, "")

我认为这应该这样做

```
public static string Replace(this string s, IEnumerable<string> strings, string replacementstring)
{
    foreach (var s1 in strings)
    {
        s = s.Replace(s1, replacementstring);
    }

    return s;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-28T00:01:44.963

您可以使用正则表达式来执行此操作，例如：

```
var newString = Regex.Replace(testString, "Hello|world", ""); 
```

如果你想从一个序列以编程方式构建正则表达式，它会是这样的：

```
var stringsToReplace = new[] { "Hello", "world" };
var regexParts = stringsToReplace.Select(Regex.Escape);
var regexText = string.Join("|", regexParts.ToArray()); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-27T23:56:47.110

我不知道这是否更甜，但你可以这样做：

```
string inputString = "Hello, world";
string newString = new[] { "Hello", "world" }.Aggregate(inputString, (result, replace) => result.Replace(replace, "")); 
```

这将从输入字符串作为种子开始，并使用每个替换字符串运行该函数。

理解 Aggregate 函数的一个更好的例子可能是：

```
List<Payment> payments = ...;
double newDebt = payments.Aggregate(oldDebt, (debt, payment) => debt - payment.Amount); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-28T00:10:36.380

很多人说你应该使用 IEnumerable 和 List 和 Arrays 等，虽然这完全“可以”，但如果我是你，我宁愿在 C# 中使用 params 关键字。如果我要实现这样的东西 - 我可能不会关心像你的双重替换方法调用这样简单的事情......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-28T00:50:54.537

我看到这些模式有几个缺陷 - 首先，字符串是不可变的，多次调用 replace 或在循环中可能很糟糕，特别是如果您的输入字符串很大。如果您一心想要调用 replace，那么至少使用 StringBuilder 类中的 Replace 方法。

# c++ - DirectShow 的 eof 检测

> ID：324803
> 
> 赞同：2
> 
> 时间：2008-11-27T23:29:30.783
> 
> 标签：c++, windows, deadlock, directshow

有没有办法检测 DirectShow filtergraph 已经到达其文件的末尾？在其文件末尾，我的意思是带有 SampleGrabber 过滤器的过滤器图将永远不会收到另一个 SampleCB 调用。

以下是一些不起作用的事情：

*   信任`IMediaDet::get_StreamLength`（通常说视频中的帧数比实际存在的帧数多）
*   信任`IMediaSeeking::GetDuration`（与IMediaDet一致，+/-一帧）
*   使用`IMediaControl::GetState`（即使文件中的所有帧都已处理完毕，过滤器图仍会运行）

**背景：**

我正在做视频处理，我有一个类可以用 SampleGrabber 创建一个过滤器图。每当`SampleGrabber::SampleCB`被调用时，我都会用互斥锁阻止它，这样我就可以在拉模式下运行过滤器图。当我准备好另一帧时，我在我的主线程中取消阻塞互斥锁并等待`SampleGrabber::SampleCB`向我发送它已完成的信号。对于某些视频，`IMediaDet::get_StreamLength`告诉我视频的帧数比实际存在的帧数多。一旦我提取了最后一帧并请求比实际存在的帧多一个，主线程就会永远阻塞，因为`SampleGrabber::SampleCB`永远不会再被调用。我希望能够检测到`SampleGrabber::SampleCB`永远不会调用文件源。像 Windows Media Player 这样的应用程序能够以某种方式做到这一点，因为 GUI 报告视频在最后一个真实帧之后结束，所以显然有一种方法可以做到这一点。

**编辑：**

我`WaitForSingleObject`用来实现主线程阻塞。到目前为止，我一直在使用的解决方法是按照 Greg 的建议：有一个有限的超时。不幸的是，这有点棘手。等待失败的原因有很多，例如真正的 eof、慢速网络文件系统、丢失网络连接、慢速解码器等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T00:12:27.453

也许使用[IMediaEventEx](http://msdn.microsoft.com/en-us/library/ms785899(VS.85).aspx)接口？其中一个事件代码是[EC_COMPLETE](http://msdn.microsoft.com/en-us/library/ms783543(VS.85).aspx)，记录为“来自特定流的所有数据都已呈现”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T23:39:22.213

假设主线程正在阻塞`WaitForSingleObject`，你能不指定等待的超时时间吗？然后，如果等待返回是因为它已经超时而不是因为它收到了一个信号，你就会知道它是最后一帧。

# xslt - 如何删除所有换行符？

> ID：324822
> 
> 赞同：14
> 
> 时间：2008-11-27T23:51:00.740
> 
> 标签：xslt, newline, line-breaks

我有这样的事情：

```
<node TEXT="   txt A   "/>
<node TEXT="

       txt X

"/>
<node>
   <html>
      <p>
        txt Y
      </p>
   </html>
</node>
<node TEXT="txt B"/> 
```

我想用 XSLT 来得到这个：

```
txt A
txt X
txt Y
txt B 
```

我想去除@TEXT 和 CDATA 的所有无用空格和换行符。为输出提供结构的唯一 XML 输入是`<node>`-tags。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-28T07:50:23.597

以下变换：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:output method="text"/>

<xsl:template match="*">
  <xsl:apply-templates select="@TEXT | node()"/>
</xsl:template>

<xsl:template match="node/@TEXT | text()">
  <xsl:if test="normalize-space(.)">
    <xsl:value-of select=
     "concat(normalize-space(.), '&#xA;')"/>
  </xsl:if>

  <xsl:apply-templates />
</xsl:template>

</xsl:stylesheet> 
```

应用于此 XML 文档时

```
<t>
<node TEXT="   txt A   "/>
<node TEXT="       txt X"/>
<node>
    <html>
        <p>        txt Y      </p>
    </html>
</node>
<node TEXT="txt B"/>
</t> 
```

产生想要的结果：

txt A
txt X
txt Y
txt B

**请注意标准 XPath 函数[normalize-space()](http://www.w3.org/TR/xpath#section-String-Functions)**的使用，它去除所有前导和尾随空格，并仅用一个空格替换每个其他空格序列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T00:31:32.967

你可能想要

```
 <xsl:strip-space elements="node"/> 
```

[在这里](http://www.w3schools.com/XSL/el_preserve-space.asp)解释。这篇[文章](http://www.ibm.com/developerworks/xml/library/x-tipwhitesp.html)有更多的细节。

# .net - .Net 设计模式的好来源

> ID：324824
> 
> 赞同：4
> 
> 时间：2008-11-27T23:53:31.280
> 
> 标签：.net, design-patterns, resources

我正在寻找一个很好的软件模式在线资源。最好有全面的选择和简洁的书面解释，而不仅仅是链接的集合。.Net 示例会很好，但不是必需的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-27T23:56:55.220

[使用 Microsoft .NET 的企业解决方案模式](http://msdn.microsoft.com/en-us/library/ms998469.aspx)

[面向 ASP.NET 程序员的设计模式](http://www.devx.com/dotnet/Article/33695)

[数据和对象工厂公司——模式](http://www.dofactory.com/Patterns/Patterns.aspx)

[DesignPatternsFor.Net](http://www.designpatternsfor.net/default.aspx?pid=4)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-28T01:39:42.503

我推荐Freemans 的[Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)一书。这些是适用于大多数 OO 语言的通用设计模式。我推荐这本书作为设计模式的入门书。在这本书之后，[GOF 书](https://rads.stackoverflow.com/amzn/click/com/0201633612)将是另一个推荐（但不是第一本书）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-28T00:02:52.777

收下这本书：

[欧洲经济区的 P](https://rads.stackoverflow.com/amzn/click/com/0321127420)由 Martin Fowler

这是那本书的在线信息

[http://martinfowler.com/eaaCatalog/](http://martinfowler.com/eaaCatalog/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-27T23:59:20.037

其他一些资源

*   [四人帮也有一些模式。](http://www.dofactory.com/Default.aspx)
*   [MSDN Patterns & Practices 也可能有帮助](http://msdn.microsoft.com/en-ca/practices/default.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-28T00:04:21.913

您可能还想阅读 .NET Design Patterns 一书。

上面的一些书是我读过的，当然可以担保。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-28T13:00:02.930

这是[设计模式的描述](http://sourcemaking.com/)

我认为这是一个非常好的阅读和学习设计模式的页面

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-28T13:12:56.117

要查看实际实现的模式示例，为什么不获取一个开源 .net 项目（例如 Paint.NET 或 CommunityServer）并查看代码库？您还可以获取 Reflector 并查看基类库的源代码。

# javascript - 需要帮助重构一个简单的 jquery 动画脚本

> ID：324825
> 
> 赞同：1
> 
> 时间：2008-11-27T23:54:27.520
> 
> 标签：javascript, jquery, refactoring

我有一个状态消息框（div 框）位于网页底部，使用位置：固定；和底部：0;。它的高度最初是 11px。

当状态消息超过默认高度时，我希望允许用户双击它，使其增长。如果他们再次双击它或将鼠标从框移开，它应该会再次缩小。

我设法让它完全按照我的意愿工作，但在我看来，应该可以更优雅地编写它：

```
<script type="text/javascript">
    $(document).ready(function() {
        $("#footer").dblclick(showStatusBar);
    });     
    function showStatusBar() {
        var footer = $("#footer");
        footer.unbind('dblclick', showStatusBar);
        footer.animate({ height: "100px" }, 200);
        footer.dblclick(hideStatusBar);
        footer.bind('mouseleave', hideStatusBar);
    }

    function hideStatusBar() {
        var footer = $("#footer");
        footer.unbind('mouseleave', hideStatusBar);
        footer.unbind('dblclick', hideStatusBar);
        footer.animate({ height: "11px" }, 200);            
        footer.dblclick(showStatusBar);
    }
</script> 
```

我玩过[切换](http://docs.jquery.com/Events/toggle#fnfn2fn3.2Cfn4.2C...)事件，但无法让它工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-28T00:12:00.590

您可以创建一个用作切换功能的功能。像这样的东西：

```
// NOTE: Untested!
function statusBarToggle() {
    /* Starts as hidden. */
    if(this.isHidden == undefined)
        this.isHidden = true;

    this.isHidden = !this.isHidden;

    var newHeight = this.isHidden ? 11 : 200;

    $(this)
        .stop()
        .animate({ height: newHeight + 'px' }, 200);

    /* When mouse leaves open status bar, close it. */
    if(this.isHidden)
        $(this).unbind('mouseleave', statusBarToggle);
    else
        $(this).bind('mouseleave', statusBarToggle);
}

$(document).ready(function() {
    // ...
    $('#footer').dblclick(statusBarToggle);
} 
```

这给状态栏一个“isHidden”属性，并使用它来检查我们是否显示或隐藏状态栏。如果您需要，此功能也适用于其他元素。

（你可以链接许多 jQuery 命令，就像我在上面使用 'stop' 和 'animate' 函数所做的那样。）

# c# - 跳出嵌套循环

> ID：324831
> 
> 赞同：235
> 
> 时间：2008-11-27T23:58:44.173
> 
> 标签：c#, for-loop, nested-loops

如果我有一个嵌套在另一个循环中的 for 循环，我怎样才能以最快的方式有效地退出两个循环（内部和外部）？

我不想必须使用布尔值然后不得不说转到另一个方法，而只是在外循环之后执行第一行代码。

什么是解决这个问题的快速而好的方法？

我在想异常并不便宜/应该只在真正异常的情况下抛出等。因此，从性能的角度来看，我认为这种解决方案不会很好。

我认为利用 .NET 中的新功能（匿名方法）来做一些非常基本的事情是不正确的。

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2008-11-28T00:03:37.080

好吧，`goto`但这很丑陋，而且并不总是可能的。您还可以将循环放入方法（或匿名方法）中并用于`return`退出回到主代码。

```
 // goto
    for (int i = 0; i < 100; i++)
    {
        for (int j = 0; j < 100; j++)
        {
            goto Foo; // yeuck!
        }
    }
Foo:
    Console.WriteLine("Hi"); 
```

与：

```
// anon-method
Action work = delegate
{
    for (int x = 0; x < 100; x++)
    {
        for (int y = 0; y < 100; y++)
        {
            return; // exits anon-method
        }
    }
};
work(); // execute anon-method
Console.WriteLine("Hi"); 
```

* * *

请注意，在 C# 7 中，我们应该得到“本地函数”，这（语法待定等）意味着它应该像这样工作：

```
// local function (declared **inside** another method)
void Work()
{
    for (int x = 0; x < 100; x++)
    {
        for (int y = 0; y < 100; y++)
        {
            return; // exits local function
        }
    }
};
Work(); // execute local function
Console.WriteLine("Hi"); 
```

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2008-11-28T02:21:38.097

C# 适应 C 中常用的方法 - 在循环条件之外设置外循环变量的值（即，使用 int 变量`INT_MAX -1`的 for 循环通常是不错的选择）：

```
for (int i = 0; i < 100; i++)
{
    for (int j = 0; j < 100; j++)
    {
        if (exit_condition)
        {
            // cause the outer loop to break:
            // use i = INT_MAX - 1; otherwise i++ == INT_MIN < 100 and loop will continue 
            i = int.MaxValue - 1;
            Console.WriteLine("Hi");
            // break the inner loop
            break;
        }
    }
    // if you have code in outer loop it will execute after break from inner loop    
} 
```

正如代码中的注释所说`break`，不会神奇地跳转到外循环的下一次迭代——所以如果你有在内循环之外的代码，这种方法需要更多的检查。在这种情况下考虑其他解决方案。

这种方法适用于`for`and`while`循环，但不适用于`foreach`. 如果`foreach`您没有对隐藏枚举器的代码访问权限，因此您无法更改它（即使您`IEnumerator`没有某些“MoveToEnd”方法）。

[对内联评论作者的致谢： [Meta](https://stackoverflow.com/users/167044/meta)
`i = INT_MAX - 1`的建议/ [ygoe](https://stackoverflow.com/users/143684/ygoe)的评论。 [jmbpiano](https://stackoverflow.com/users/4107124/jmbpiano)正确评论内部循环后的代码by [blizpasta](https://stackoverflow.com/users/20646/blizpasta)
`for``foreach`
`IntMax`] 

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2009-02-02T21:21:34.033

**此解决方案不适用于 C#**

对于通过其他语言发现此问题的人，**Javascript、Java 和 D 允许标记中断并继续**：

```
outer: while(fn1())
{
   while(fn2())
   {
     if(fn3()) continue outer;
     if(fn4()) break outer;
   }
} 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-11-28T00:07:24.640

在外环中使用合适的防护装置。在你休息之前将保护设置在内循环中。

```
bool exitedInner = false;

for (int i = 0; i < N && !exitedInner; ++i) {

    .... some outer loop stuff

    for (int j = 0; j < M; ++j) {

        if (sometest) {
            exitedInner = true;
            break;
        }
    }
    if (!exitedInner) {
       ... more outer loop stuff
    }
} 
```

或者更好的是，将内部循环抽象为一个方法，并在它返回 false 时退出外部循环。

```
for (int i = 0; i < N; ++i) {

    .... some outer loop stuff

    if (!doInner(i, N, M)) {
       break;
    }

    ... more outer loop stuff
} 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-11-28T00:06:52.613

不要引用我的话，但您可以按照 MSDN 中的建议使用[goto 。](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/goto#example-1)还有其他解决方案，包括在两个循环的每次迭代中检查的标志。最后，您可以使用异常作为解决问题的真正重量级解决方案。

去：

```
for ( int i = 0; i < 10; ++i ) {
   for ( int j = 0; j < 10; ++j ) {
      // code
      if ( break_condition ) goto End;
      // more code
   }
}
End: ; 
```

健康）状况：

```
bool exit = false;
for ( int i = 0; i < 10 && !exit; ++i ) {
   for ( int j = 0; j < 10 && !exit; ++j ) {
      // code
      if ( break_condition ) {
         exit = true;
         break; // or continue
      }
      // more code
   }
} 
```

例外：

```
try {
    for ( int i = 0; i < 10 && !exit; ++i ) {
       for ( int j = 0; j < 10 && !exit; ++j ) {
          // code
          if ( break_condition ) {
             throw new Exception()
          }
          // more code
       }
    }
catch ( Exception e ) {} 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-11-28T00:04:43.083

是否可以将嵌套的 for 循环重构为私有方法？这样你就可以简单地“返回”退出循环的方法。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2016-03-02T18:47:33.063

在我看来，人们似乎很不喜欢一个`goto`声明，所以我觉得有必要稍微澄清一下。

我相信人们的“情绪”`goto`最终归结为对代码的理解和对可能的性能影响的（误解）。因此，在回答这个问题之前，我将首先详细介绍它是如何编译的。

众所周知，C#编译为IL，然后使用SSA编译器编译为汇编器。我将对这一切如何运作提供一些见解，然后尝试回答问题本身。

**从 C# 到 IL**

首先，我们需要一段 C# 代码。让我们从简单的开始：

```
foreach (var item in array)
{
    // ... 
    break;
    // ...
} 
```

我将逐步执行此操作，以使您对引擎盖下发生的事情有一个很好的了解。

第一次翻译：从`foreach`到等效`for`循环（注意：我在这里使用数组，因为我不想深入了解 IDisposable 的细节——在这种情况下，我还必须使用 IEnumerable）：

```
for (int i=0; i<array.Length; ++i)
{
    var item = array[i];
    // ...
    break;
    // ...
} 
```

第二个翻译：`for`and`break`被翻译成更简单的等价物：

```
int i=0;
while (i < array.Length)
{
    var item = array[i];
    // ...
    break;
    // ...
    ++i;
} 
```

第三个翻译（这相当于IL代码）：我们改变`break`并`while`进入一个分支：

```
 int i=0; // for initialization

startLoop:
    if (i >= array.Length) // for condition
    {
        goto exitLoop;
    }
    var item = array[i];
    // ...
    goto exitLoop; // break
    // ...
    ++i;           // for post-expression
    goto startLoop; 
```

虽然编译器在一个步骤中完成了这些事情，但它可以让您深入了解该过程。从 C# 程序演变而来的 IL 代码是最后一个 C# 代码的*直译*。您可以在这里亲自查看：[https](https://dotnetfiddle.net/QaiLRz) ://dotnetfiddle.net/QaiLRz （单击“查看 IL”）

现在，您在这里观察到的一件事是，在此过程中，代码变得更加复杂。观察这一点的最简单方法是我们需要越来越多的代码来完成同样的事情。您可能还争辩说`foreach`,`for`和实际上是 的简写`while`，这部分是正确的。`break``goto`

**从 IL 到汇编程序**

.NET JIT 编译器是一个 SSA 编译器。我不会在这里详细介绍 SSA 表单的所有细节以及如何创建优化编译器，它太多了，但可以对将会发生的事情给出一个基本的了解。为了更深入地了解，最好开始阅读优化编译器（我喜欢这本书的简要介绍：[http](http://ssabook.gforge.inria.fr/latest/book.pdf) : //ssabook.gforge.inria.fr/latest/book.pdf）和 LLVM (llvm.org) .

*每个优化编译器都依赖于代码简单*且遵循*可预测模式*这一事实。在 FOR 循环的情况下，我们使用图论来分析分支，然后在我们的分支中优化诸如循环之类的东西（例如向后分支）。

但是，我们现在有前向分支来实现我们的循环。您可能已经猜到了，这实际上是 JIT 修复的第一步，如下所示：

```
 int i=0; // for initialization

    if (i >= array.Length) // for condition
    {
        goto endOfLoop;
    }

startLoop:
    var item = array[i];
    // ...
    goto endOfLoop; // break
    // ...
    ++i;           // for post-expression

    if (i >= array.Length) // for condition
    {
        goto startLoop;
    }

endOfLoop:
    // ... 
```

如您所见，我们现在有一个向后分支，这是我们的小循环。这里唯一仍然令人讨厌的是由于我们的`break`声明而最终得到的分支。在某些情况下，我们可以以相同的方式移动它，但在其他情况下，它会一直存在。

那么为什么编译器会这样做呢？好吧，如果我们可以展开循环，我们也许可以对其进行矢量化。我们甚至可以证明只是添加了常量，这意味着我们的整个循环可能会化为乌有。总结一下：通过使模式可预测（通过使分支可预测），我们可以证明某些条件在我们的循环中成立，这意味着我们可以在 JIT 优化期间发挥作用。

然而，分支往往会破坏那些很好的可预测模式，因此优化人员不太喜欢这种模式。Break，continue，goto——它们都打算打破这些可预测的模式——因此并不是真正的“好”。

在这一点上，您还应该意识到，一个简单的语句比`foreach`一堆到处乱跑的`goto`语句更容易预测。就（1）可读性和（2）从优化器的角度来看，它都是更好的解决方案。

另一件值得一提的是，它与优化编译器以将寄存器分配给变量（称为*寄存器分配*的过程）非常相关。您可能知道，您的 CPU 中只有有限数量的寄存器，它们是迄今为止硬件中最快的内存。在最内层循环中的代码中使用的变量更有可能被分配一个寄存器，而循环之外的变量则不太重要（因为此代码的命中率可能较低）。

**求助，太复杂了……我该怎么办？**

底线是您应该始终使用您可以使用的语言结构，这通常会（隐含地）为您的编译器构建可预测的模式。如果可能，尽量避免使用奇怪的分支（特别是：`break`、或 a中间什么都没有）。`continue``goto``return`

这里的好消息是，这些可预测的模式既易于阅读（对于人类），也易于发现（对于编译器）。

其中一种模式称为 SESE，它代表 Single Entry Single Exit。

**现在我们来解决真正的问题。**

想象一下，你有这样的东西：

```
// a is a variable.

for (int i=0; i<100; ++i) 
{
  for (int j=0; j<100; ++j)
  {
     // ...

     if (i*j > a) 
     {
        // break everything
     }
  }
} 
```

使其成为可预测模式的最简单方法是完全消除`if`：

```
int i, j;
for (i=0; i<100 && i*j <= a; ++i) 
{
  for (j=0; j<100 && i*j <= a; ++j)
  {
     // ...
  }
} 
```

在其他情况下，您还可以将该方法拆分为 2 个方法：

```
// Outer loop in method 1:

for (i=0; i<100 && processInner(i); ++i) 
{
}

private bool processInner(int i)
{
  int j;
  for (j=0; j<100 && i*j <= a; ++j)
  {
     // ...
  }
  return i*j<=a;
} 
```

**临时变量？好、坏还是丑？**

您甚至可能决定从循环中返回一个布尔值（但我个人更喜欢 SESE 形式，因为这是编译器会看到它的方式，而且我认为它更易于阅读）。

有些人认为使用临时变量更清洁，并提出这样的解决方案：

```
bool more = true;
for (int i=0; i<100; ++i) 
{
  for (int j=0; j<100; ++j) 
  {
     // ...
     if (i*j > a) { more = false; break; } // yuck.
     // ...
  }
  if (!more) { break; } // yuck.
  // ...
}
// ... 
```

我个人反对这种做法。再看一下代码是如何编译的。现在想想这将如何处理这些漂亮的、可预测的模式。得到图片？

对了，让我拼一下。将会发生的是：

*   编译器会将所有内容写成分支。
*   作为优化步骤，编译器将进行数据流分析，以尝试删除`more`仅在控制流中使用的奇怪变量。
*   如果成功，该变量`more`将从程序中删除，只保留分支。这些分支将被优化，因此您只会从内部循环中获得一个分支。
*   如果不成功，该变量`more`肯定会在最内层循环中使用，因此如果编译器不对其进行优化，它很有可能被分配给一个寄存器（这会占用宝贵的寄存器内存）。

所以，总而言之：编译器中的优化器会遇到很多麻烦来找出`more`仅用于控制流，并且**在最好的情况下**会将其转换为外部外部的单个分支 for环形。

换句话说，最好的情况是它最终会得到这样的结果：

```
for (int i=0; i<100; ++i) 
{
  for (int j=0; j<100; ++j)
  {
     // ...
     if (i*j > a) { goto exitLoop; } // perhaps add a comment
     // ...
  }
  // ...
}
exitLoop:

// ... 
```

我个人对此的看法很简单：如果这是我们一直以来的意图，让我们让编译器和可读性的世界变得更容易，并立即编写。

**tl;博士：**

底线：

*   如果可能的话，在你的 for 循环中使用一个简单的条件。尽可能坚持使用您可以使用的高级语言结构。
*   如果一切都失败了，而你只剩下`goto`or `bool more`，那么更喜欢前者。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-11-28T00:47:14.107

您要求快速、良好、不使用布尔值、不使用 goto 和 C# 的组合。你已经排除了所有可能的方式来做你想做的事。

最快最不难看的方法是使用 goto。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2008-11-28T00:10:42.293

将因素纳入函数/方法并使用提前返回，或将循环重新排列为 while 子句。goto/exceptions/whatever 在这里肯定不合适。

```
def do_until_equal():
  foreach a:
    foreach b:
      if a==b: return 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-12-14T01:04:32.767

有时很高兴将代码抽象成它自己的函数，而不是使用提前返回 - 虽然提前返回是邪恶的:)

```
public void GetIndexOf(Transform transform, out int outX, out int outY)
{
    outX = -1;
    outY = -1;

    for (int x = 0; x < Columns.Length; x++)
    {
        var column = Columns[x];

        for (int y = 0; y < column.Transforms.Length; y++)
        {
            if(column.Transforms[y] == transform)
            {
                outX = x;
                outY = y;

                return;
            }
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2020-04-12T18:03:11.850

最**干净**、**最短**和**最可重用**的方法是自调用匿名函数：

*   没有转到
*   无标签
*   没有临时变量
*   没有命名函数

使用匿名方法**比最佳答案短**一行。

```
new Action(() =>
{
    for (int x = 0; x < 100; x++)
    {
        for (int y = 0; y < 100; y++)
        {
            return; // exits self invoked lambda expression
        }
    }
})();
Console.WriteLine("Hi"); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-28T05:22:43.020

自从`break`几十年前我第一次看到 C 语言以来，这个问题一直困扰着我。我希望某些语言增强功能可以扩展 break 从而起作用：

```
break; // our trusty friend, breaks out of current looping construct.
break 2; // breaks out of the current and it's parent looping construct.
break 3; // breaks out of 3 looping constructs.
break all; // totally decimates any looping constructs in force. 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-12-20T17:48:03.613

我见过很多使用“break”的例子，但没有一个使用“continue”的例子。

它仍然需要内部循环中的某种标志：

```
while( some_condition )
{
    // outer loop stuff
    ...

    bool get_out = false;
    for(...)
    {
        // inner loop stuff
        ...

        get_out = true;
        break;
    }

    if( get_out )
    {
        some_condition=false;
        continue;
    }

    // more out loop stuff
    ...

} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-01-30T06:37:02.170

结束双循环的最简单方法是直接结束第一个循环

```
string TestStr = "The frog jumped over the hill";
char[] KillChar = {'w', 'l'};

for(int i = 0; i < TestStr.Length; i++)
{
    for(int E = 0; E < KillChar.Length; E++)
    {
        if(KillChar[E] == TestStr[i])
        {
            i = TestStr.Length; //Ends First Loop
            break; //Ends Second Loop
        }
    }
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-01-30T07:25:31.160

可以使用循环中的自定义条件来打破循环，从而获得干净的代码。

```
 static void Main(string[] args)
    {
        bool isBreak = false;
        for (int i = 0; ConditionLoop(isBreak, i, 500); i++)
        {
            Console.WriteLine($"External loop iteration {i}");
            for (int j = 0; ConditionLoop(isBreak, j, 500); j++)
            {
                Console.WriteLine($"Inner loop iteration {j}");

                // This code is only to produce the break.
                if (j > 3)
                {
                    isBreak = true;
                }                  
            }

            Console.WriteLine("The code after the inner loop will be executed when breaks");
        }

        Console.ReadKey();
    }

    private static bool ConditionLoop(bool isBreak, int i, int maxIterations) => i < maxIterations && !isBreak; 
```

使用此代码，我们将获得以下输出：

*   外部循环迭代 0
*   内循环迭代 0
*   内循环迭代 1
*   内循环迭代 2
*   内循环迭代 3
*   内循环迭代 4
*   内循环后的代码会在break时执行

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-06-20T01:03:06.700

我记得在我的学生时代，有人说在数学上可以证明你可以在没有 goto 的情况下在代码中做任何事情（即没有任何情况下 goto 是唯一的答案）。所以，我从不使用 goto（只是我的个人喜好，不暗示我是对还是错）

无论如何，要打破嵌套循环，我会这样做：

```
var isDone = false;
for (var x in collectionX) {
    for (var y in collectionY) {
        for (var z in collectionZ) {
            if (conditionMet) {
                // some code
                isDone = true;
            }
            if (isDone)
                break;
        }
        if (isDone) 
            break;
    }
    if (isDone)
        break;
} 
```

...我希望这对那些喜欢我的人有所帮助是反 goto “fanboys” :)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-07-10T12:17:28.807

我就是这样做的。仍然是一种解决方法。

```
foreach (var substring in substrings) {
  //To be used to break from 1st loop.
  int breaker=1;
  foreach (char c in substring) {
    if (char.IsLetter(c)) {
      Console.WriteLine(line.IndexOf(c));
      \\setting condition to break from 1st loop.
      breaker=9;
      break;
    }
  }
  if (breaker==9) {
    break;
  }
}
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-03-12T19:56:13.610

此处未提及的另一个既干净又不依赖于较新的 .NET 功能的选项是将双循环合并为产品上的单循环。然后在循环内部，可以使用简单的数学计算计数器的值：

```
int n; //set to max of first loop
int m; //set to max of second loop

for (int k = 0; k < n * m; k++)
{
    //calculate the values of i and j as if there was a double loop
    int i = k / m;
    int j = k % m;

    if(exitCondition)
    {
        break;
    }
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2022-01-13T15:09:03.867

人们经常忘记 for 循环的第二条语句本身就是中断条件，因此代码中不需要额外的 if。

像这样的工作：

```
bool run = true;
int finalx = 0;
int finaly = 0;
for (int x = 0; x < 100 && run; x++)
{
    finalx = x;
    for (int y = 0; y < 100 && run; y++)
    {
        finaly = y;
        if (x == 10 && y == 50) { run = false; }
    }
}
Console.WriteLine("x: " + finalx + " y: " + finaly);  // outputs 'x: 10 y: 50' 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2022-02-28T22:22:26.313

只需`return`在内部循环内使用，两个循环就会退出......

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2014-09-10T14:03:03.457

抛出一个自定义异常，该异常退出外循环。

它适用于`for`, `foreach`or`while`任何类型的循环和任何使用`try catch exception`块的语言

```
try 
{
   foreach (object o in list)
   {
      foreach (object another in otherList)
      {
         // ... some stuff here
         if (condition)
         {
            throw new CustomExcpetion();
         }
      }
   }
}
catch (CustomException)
{
   // log 
} 
```

* * *

## 回答 #22

> 赞同：-4
> 
> 时间：2012-08-10T12:25:34.873

```
 bool breakInnerLoop=false
        for(int i=0;i<=10;i++)
        {
          for(int J=0;i<=10;i++)
          {
              if(i<=j)
                {
                    breakInnerLoop=true;
                    break;
                }
          }
            if(breakInnerLoop)
            {
            continue
            }
        } 
```

* * *

## 回答 #23

> 赞同：-4
> 
> 时间：2015-03-19T11:03:49.330

我看到你接受了这个人提到你的 goto 语句的答案，在现代编程和专家意见中，goto 是一个杀手，我们称它为编程中的杀手，这有一些特定的原因，我不会在这里讨论它此时，但您的问题的解决方案非常简单，您可以在这种情况下使用布尔标志，就像我将在我的示例中演示的那样：

```
 for (; j < 10; j++)
            {
                //solution
                bool breakme = false;
                for (int k = 1; k < 10; k++)
                {
                   //place the condition where you want to stop it
                    if ()
                    {
                        breakme = true;
                        break;
                    }
                }

                if(breakme)
                    break;
               } 
```

简单明了。:)

* * *

## 回答 #24

> 赞同：-6
> 
> 时间：2013-12-14T01:26:29.673

你有没有看`break`关键字？哦

这只是伪代码，但你应该能够明白我的意思：

```
<?php
for(...) {
    while(...) {
        foreach(...) {
            break 3;
        }
    }
} 
```

如果您考虑`break`成为类似 的函数`break()`，那么它的参数将是要跳出的循环数。由于我们在此处代码的第三个循环中，我们可以打破所有三个循环。

手册： http: [//php.net/break](http://php.net/break)

* * *

## 回答 #25

> 赞同：-11
> 
> 时间：2008-11-28T00:02:30.310

我认为除非你想做“布尔的事情”，否则唯一的解决办法就是扔。你显然不应该这样做..！

# linq-to-entities - LinqToEntities 和外键

> ID：324847
> 
> 赞同：0
> 
> 时间：2008-11-28T00:10:22.527
> 
> 标签：linq-to-entities, foreign-key-relationship

我正在尝试使用 LinqToEntities，只是注意到数据模型中没有外键字段。在尝试添加记录时，这似乎会造成一些麻烦。

环顾四周，我发现在添加记录时，您可以执行以下操作（产品具有类别表的外键）。

```
Product myProduct = new Product();
myProduct.ProductName = ProductName;
myProduct.Categories = db.CategorySet.Where(c => c.CategoryID == CategoryID).First();
db.AddToProductSet(myProduct);
db.SaveChanges(); 
```

我确信有更好的方法来做到这一点。但我的问题是真的，这是它在 LinqToEntities 中的工作方式吗？在我看来，这比简单地给它一个外键（即 myProduct.CategoryID = categoryid）要复杂得多。

如果我在一个表中有 5 个外键，我将不得不检索 5 个对象才能将它们链接起来？

我可以看到执行上述操作可能有意义并且有好处，但是如果您只是尝试将 1 条记录添加到在另一个表中具有单个外键的数据库中，则看不到好处。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T05:43:28.783

对于任何刚接触 Linq To Entities 并想知道我所做的事情的人......是的，这就是 Linq To Entities 的样子。您需要引用一个实际的对象，而不是仅仅给出一个外键。

在我看来，这会对性能造成不利影响，但从我目前所做的来看，性能一点也不差。实际上它比 Linq To SQL 更好。

# iphone - 如何在 UINavigationController 标题视图中自定义后退按钮的文本颜色？

> ID：324860
> 
> 赞同：13
> 
> 时间：2008-11-28T00:20:09.073
> 
> 标签：iphone, cocoa-touch

我在 UINavigationController 的导航栏上使用了自定义 tintColor，因为颜色太浅，我需要使用深色文本。更换标题视图和我在右侧添加的自定义按钮相对容易，但我似乎无法将自定义视图粘贴在后退按钮上。这就是我现在正在尝试的：

```
 UILabel *backLabel = [[UILabel alloc] initWithFrame:CGRectZero];

    [backLabel setFont:[UIFont fontWithName:[[UIFont fontNamesForFamilyName:@"Arial Rounded MT Bold"] objectAtIndex:0] size:24.0]];
    [backLabel setTextColor:[UIColor blackColor]];
    [backLabel setShadowColor:[UIColor clearColor]];

    [backLabel setText:[aCategory displayName]];
    [backLabel sizeToFit];
    [backLabel setBackgroundColor:[UIColor clearColor]];

    UIBarButtonItem *temporaryBarButtonItem=[[UIBarButtonItem alloc] initWithCustomView:backLabel];

    temporaryBarButtonItem.customView = backLabel;
    [backLabel release];

    self.navigationItem.backBarButtonItem = temporaryBarButtonItem;
    [temporaryBarButtonItem release];] 
```

自定义视图并没有坚持下去，而且我没有看到任何明显简单的方法来获取默认按钮内的实际文本并开始更改其样式。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2012-05-10T19:07:12.187

This works, solves the original question (change the Navbar BACK button - and no buttons on other toolbars, no buttons on tab bars, etc):

```
[[UIBarButtonItem appearanceWhenContainedIn:[UINavigationBar class], nil] setTitleTextAttributes:[NSDictionary dictionaryWithObjectsAndKeys:[UIColor blackColor], UITextAttributeTextColor,nil]
         forState:UIControlStateNormal]; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-28T13:29:52.540

没有官方的方法可以做到这一点。我能想到的两种方法是：

*   导航视图树以找到现有的后退按钮，并手动设置其文本颜色。这可能不是一个好主意，因为它很脆弱，而且按钮甚至可能没有可配置的 textColor 属性。

*   创建您自己的后退按钮（即，使用您自己的图像），并设置其颜色。这就是我们在很多地方所做的。这是一个多一点的工作，但结果正是你想要的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-01-21T22:20:16.837

我尝试遍历设置文本，但它最终出现在 UINavigationItemButtonView 上，它似乎只是直接绘制。没有办法设置颜色。

我能够让它工作的唯一方法是将文本转换为图像，然后将后退按钮设置为图像。

```
UIBarButtonItem * backItem = [[UIBarButtonItem alloc] initWithImage:backImage style:UIBarButtonItemStylePlain target:nil action:nil];
navItem.backBarButtonItem = backItem;
[backItem release]; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-04T10:26:02.670

SkotchV 是正确的。在以前版本的 SDK 中，他们使用不同的 UIButton 实例，允许通过遍历子视图层次结构进行自定义。这已经不可能了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-12-28T00:57:48.330

@DrMickeyLauer 在我的开发环境中可以迭代层次结构以设置文本颜色。
当您填充`UINavigationBar's`左右视图时，您`UINavigationBar`将拥有`UIButtons`子视图。如果你喜欢 UIToolbars 并将其添加到导航栏，你可以遍历你的 navBar.items，检查`UINavigationItems`(via `isKindOfClass:`)。这些导航项具有左右项数组。这些数组包含（除其他外）您放在导航栏左右视图中的工具栏。这些左右数组使您可以访问工具栏的`UIBarButtonItems`. 然后您可以调用`setTitleTextAttributes`来`UIBarButtonItems`设置它们的文本和阴影颜色。

But, as Ben Gottlieb stated, this is a fragile approach. It leaves you wondering whether the navigation bar organization will change in the future.

# c++ - 基于分隔符的 C++ 字符串修改和提取

> ID：324867
> 
> 赞同：0
> 
> 时间：2008-11-28T00:30:13.547
> 
> 标签：c++, string

这是一个基本问题，但我在思考解决方案时遇到了麻烦，所以我需要朝着正确的方向努力。

我有一个要拉入的输入文件，我必须将它放入一个字符串变量中。问题是我需要把这个字符串分成不同的东西。将有 3 个字符串和 1 个整数。它们用“：”分隔。

我知道我可以通过 find() 找到第一个“：”的位置，但我真的不知道如何在字符串中前进，对于每一件事并将其放入它自己的字符串/整数中。

文件的实际输入如下所示：

```
A:PEP:909:Inventory Item 
```

A 将是我必须执行的命令......所以这将是一个字符串。PEP 是一个键，需要是一个字符串。909 是一个整数。

最后一个是字符串。

所以我想我想做的是有 3 个字符串 var 和 1 个 int 并将所有这些东西放入它们各自的变量中。

所以我想我最终会想要将这个 C++ 字符串转换为 C 字符串，这样我就可以使用 atoi 将一个部分转换为 int。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-28T01:51:26.893

我通常使用这样的东西：

```
void split(const std::string &s, char delim, std::vector<std::string> &elems) {
    std::stringstream ss(s);
    std::string item;
    while(std::getline(ss, item, delim)) {
        elems.push_back(item);
    }
} 
```

你可以像这样使用它：

```
std::vector<std::string> tokens;
split("this:is:a:test", ':', tokens); 
```

标记现在将包含“this”、“is”、“a”和“test”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T01:04:42.823

看看[boost::tokenizer](http://www.boost.org/doc/libs/1_37_0/libs/tokenizer/tokenizer.htm)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-28T01:50:09.953

这最好在您想要使用 C++ 标准库时`std::getline`完成：`std::istringstream`

```
std::string command;
std::string key;
int         id;
std::string item;

std::string line = "A:PEP:909:Inventory Item";

// for each line: 
std::istringstream stream(line);

std::getline(stream, command, ':');
std::getline(stream, key, ':');
stream >> id;
std::getline(stream, item);

// now, process them 
```

考虑将其放入自己的结构中：

```
struct record {
    std::string command;
    std::string key;
    int         id;
    std::string item;

    record(std::string const& line) {
        std::istringstream stream(line);
        stream >> *this;
    }

    friend std::istream& operator>>(std::istream& is, record & r){
        std::getline(is, r.command, ':');
        std::getline(is, r.key, ':');
        stream        >> r.id;
        std::getline(is, r.item);
        return is;
    }
}; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-28T00:38:17.010

使用 C 风格的字符串，您可以使用[strtok()](http://linux.die.net/man/3/strtok)来执行此操作。你也可以使用[sscanf()](http://linux.die.net/man/3/sscanf)

但是由于您正在处理 C++，您可能希望坚持使用内置的 std::string 函数。因此，您可以使用 find()。Find 有一个形式，它接受第二个参数，即开始搜索的偏移量。因此，您可以使用 find(':') 查找第一个实例，然后使用 find(':', firstIndex+1) 查找下一个实例，其中 firstIndex 是第一次调用 find() 返回的值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T00:50:06.767

我发现并不少见的一个舒适的解决方案是以下原型：

```
string SplitToken(string & body, char separator) 
```

它将所有内容返回到第一次出现分隔符，并删除该部分，包括分隔符。

“我的”MFC - 基于 CString 的实现如下所示：

```
CString SplitStringAt(CString & s, int idx)
{
   CString ret;
   if (idx < 0)
   {
      ret = s;
      s.Empty();
   }
   else
   {
      ret = s.Left(idx);
      s = s.Mid(idx+1);
   }
   return ret;
}

CString SplitToken(CString & s,TCHAR separator)
{
   return SplitStringAt(s, s.Find(separator));
} 
```

这绝对不是最有效的方法 - 主要缺点是修改了正文并为每个令牌制作了一个新的（部分）副本，所以不要在性能关键位置使用它！

然而，我发现这个（和一些相关的函数）对于简单的解析器非常有用。

# haskell - 如何评估表达式？

> ID：324878
> 
> 赞同：-2
> 
> 时间：2008-11-28T00:46:27.837
> 
> 标签：haskell, functional-programming, lambda-calculus

给定表达式包含的变量的值列表，如何评估表达式？

```
eval::[(Variable,Integer)]->Expr->Integer 
```

例子：

```
eval[("x",2), ("y",4)](Mult(Plus(Var "x") (Const))(Var "y"))= 12 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T00:51:35.970

变量和 Expr 不是 Haskell 中的内置类型。

如果您正在使用库或处理较大程序的一部分，那么它可能具有您所追求的功能。

如果您自己定义了这些类型，那么由您决定。

如果这是针对课程作业，那么您可能想阅读有关语法和解析技术的内容。尝试将字符串分解为标记并构建可以评估的符号表示。如果您还没有找到它[http://www.zvon.org/other/haskell/Outputglobal/index.html](http://www.zvon.org/other/haskell/Outputglobal/index.html)是一个很好的参考站点。

如果您喜欢更重量级的东西（并且牢牢掌握haskell和monadic编程），那么我建议您花时间学习使用Parsec [http://www.haskell.org/haskellwiki/Parsec](http://www.haskell.org/haskellwiki/Parsec)。

# optimization - 搞笑[或不那么搞笑]代码优化

> ID：324896
> 
> 赞同：3
> 
> 时间：2008-11-28T00:59:03.223
> 
> 标签：optimization

Raymond Chen 在他最近关于代码优化[的帖子](http://blogs.msdn.com/oldnewthing/archive/2008/11/26/9143050.aspx)中这么说...如果您考虑所有需要考虑的因素，那么明显的优化 - 一个需要优化的优化 - 往往是“去优化”......

我敢肯定，在您了解更多信息后，您一定遇到过/甚至是您感到尴尬的编码优化...

愿意分享吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-28T01:53:59.290

[Duff 的 Device](http://en.wikipedia.org/wiki/Duff%27s_device)，它是如此扭曲以至于它看起来甚至不应该在 ISO C 中编译：

```
int n = (count + 7) / 8;
switch (count % 8) {
case 0: do { *to = *from++;
case 7:      *to = *from++;
case 6:      *to = *from++;
case 5:      *to = *from++;
case 4:      *to = *from++;
case 3:      *to = *from++;
case 2:      *to = *from++;
case 1:      *to = *from++;
           } while (--n > 0);
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-28T01:12:06.210

我最喜欢的例子是[XOR 交换算法](http://en.wikipedia.org/wiki/XOR_swap_algorithm)：

```
// swap these two values:
int x = 4;
int y = 2;
```

```
// original:
int temp = x;
x = y;
y = temp;
```

```
// optimized version:
x ^= y;
y ^= x;
x ^= y;
```

是的，它不使用临时变量，通常可以在三个处理器周期内完成，但它的作用肯定不明显！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-28T02:18:59.427

我最喜欢的是

```
// original code
int a[10];
a[5] = 3;

// optimized code
int a[10];
*(a + 5) = 3; 
```

是的，突然之间，这神奇地更快！`</sarcasm>`

# asp.net-mvc - 为什么我的页面没有重定向到此受保护页面的登录屏幕？

> ID：324904
> 
> 赞同：2
> 
> 时间：2008-11-28T01:13:58.700
> 
> 标签：asp.net-mvc, security, web-config

如果用户未通过身份验证，我将以下内容添加到我的 web.config 以将用户重定向到登录页面，但是转到 URL 会导致重定向吗？

```
 <location path="user/add">
    <system.web>
      <authorization>
        <deny users="?" />
      </authorization>
    </system.web>
  </location> 
```

我有设置表单验证。像这样：

```
<authentication mode="Forms">
      <forms loginUrl="/user/login"
             protection="All"
             timeout="30"
             name="MyCookie"
             requireSSL="false"
             slidingExpiration="true"
             defaultUrl="default.aspx"
             />

    </authentication> 
```

使用 .net 和 mvc。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T03:37:45.573

你有那个动作或控制器的“授权”属性吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T07:36:42.750

也许您也应该尝试允许用户标签来检查这部分是否有效？

嗯，我猜评论中不允许使用尖括号？所以我把它们改成小括号。

（位置路径=“用户/添加”）

```
(system.web)
  (authorization)
    (allow users="testuser" /)
    (deny users="*" /)
  (/authorization)
(/system.web) 
```

（/地点）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T01:25:29.753

对于我的一个应用程序，我在与以下相同的节点中有以下内容`<authentication>`：

```
<authorization>
    <deny users="?"/>
</authorization> 
```

但这涵盖了整个应用程序......

# html-encode - 如何处理需要编辑的编码输入？

> ID：324905
> 
> 赞同：0
> 
> 时间：2008-11-28T01:14:11.027
> 
> 标签：html-encode, antixsslibrary

使用微软的 AntiXssLibrary，你如何处理需要稍后编辑的输入？

例如：

用户输入： `<i>title</i>`

保存到数据库中： `<i>title</i>`

在编辑页面上，它会在文本框中显示如下内容： `&lt;i&gt;title&lt;/i&gt;`因为我在显示在文本框中之前已经对其进行了编码。

用户不喜欢这样。

写入输入控件时可以不编码吗？

更新：

我仍在努力解决这个问题。下面的答案似乎是在显示之前对字符串进行解码，但这不会允许 XSS 攻击吗？

一位说可以在输入字段值中解码字符串的用户被否决了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T15:09:10.750

看起来您不止一次对其进行编码。在 ASP.NET 中，使用 Microsoft 的 AntiXss 库，您可以使用 HtmlAttributeEncode 方法对不受信任的输入进行编码：

```
<input type="text" value="<%= AntiXss.HtmlAttributeEncode("<i>title</i>") %>" />
```

这导致

```
<input type="text" value="&#60;i&#62;title&#60;&#47;i&#62;" />
```

在呈现页面的标记中，并`<i>title</i>`在输入框中正确显示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T01:35:47.627

您的问题似乎是双重编码；HTML 需要转义一次（因此它可以毫无问题地插入到页面上的 HTML 中），但两次会导致编码版本出现字面意思。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T01:29:08.623

您可以调用 HTTPUtility.HTMLDecode(MyString) 将文本恢复为未编码的形式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-10T18:19:37.910

如果您允许用户输入将在网站上呈现的 HTML，您需要做的不仅仅是对其进行编码和解码。

使用 AntiXss 通过将脚本和标记转换为文本来防止攻击。它不会对将直接呈现的“清理”标记做任何事情。您将不得不从用户的输入中手动删除脚本标签等，以便在这种情况下得到完全保护。

您需要去除合法元素上的脚本标签和 JavaScript 属性。例如，攻击者可以将恶意代码注入到 onclick 或 onmouseover 属性中。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-11-28T01:27:57.987

是的，输入框内的代码不受脚本攻击，不需要编码。

# javascript - 在用户键入时修改 HTML 文本区域？

> ID：324906
> 
> 赞同：4
> 
> 时间：2008-11-28T01:14:37.513
> 
> 标签：javascript, html

当用户输入文本区域时，如何操作文本区域内的文本？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T01:27:34.523

您将使用该`onKeyUp`事件来检测按键，然后使用`value`textarea 的属性来获取和/或设置值。

```
<script language="text/javascript">
    function change_text() {
        // get the text
        text = document.getElementById("your_textarea").value;

        // ...

        // set the text
        document.getElementById("your_textarea").value = text;
    }
</script>

...

<textarea id="your_textarea" onKeyUp="change_text()"></textarea> 
```

# mysql - 带有联合表的 mysqldump

> ID：324911
> 
> 赞同：1
> 
> 时间：2008-11-28T01:23:19.353
> 
> 标签：mysql, federated-table

我需要包含数据的 mysqldump，但在数据库中也有几个带有 FEDERATED 引擎的表。mysqldump 也包括 FEDERATED 表的 INSERT，导致示例“重复条目”错误的原因（因为表已经填充了数据）。

我可以分别转储结构和数据，然后删除 FEDERATED 表的 INSERT，但这与“自动进行可靠备份”不完全相同

如何使用 FEDERATED 表备份然后恢复 Mysql 数据库？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T01:38:41.380

快速查看差异后，解决方案是编译您自己的 mysqldump 修补版本，默认情况下跳过 FEDERATED 表的 INSERT。我没有尝试自己应用它，所以 YMMV。

[http://bugs.mysql.com/bug.php?id=32038](http://bugs.mysql.com/bug.php?id=32038)

# webkit - 是否可以使用 WebKit 在清晰的背景上呈现网页内容？

> ID：324923
> 
> 赞同：34
> 
> 时间：2008-11-28T01:34:03.200
> 
> 标签：webkit, transparency, widget, alphablending

我正在尝试评估 WebKit 补丁的可能性，该补丁将允许所有渲染的图形渲染到完全透明的背景上。

期望的效果是呈现完全没有任何背景的 Web 内容，它应该看起来漂浮在桌面上（或浏览器窗口后面显示的任何内容）。

有人见过这样的应用吗？（我能想到一些可以的终端仿真器。）如果有人在 WebKit 内部工作过（或者可能是 Gecko？），你认为有可能做到这一点吗？

* * *

**更新：**我开始意识到 Mac OSX 仪表板小部件使用这种精确的技术。所以，这一定是可能的。

* * *

**更新 2：**我在 linux 上编译了 WebKit 并注意到配置选项包括：

```
--enable-dashboard-support
enable Dashboard support default=yes 
```

我越来越近了。任何人都可以帮忙吗？

* * *

**更新 3：**我继续在各种相关邮件列表的帖子中找到对此的引用。

*   [https://lists.webkit.org/pipermail/webkit-dev/2008-September/005019.html](https://lists.webkit.org/pipermail/webkit-dev/2008-September/005019.html)
*   [https://lists.webkit.org/pipermail/webkit-dev/2009-June/008182.html](https://lists.webkit.org/pipermail/webkit-dev/2009-June/008182.html)

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-07-15T19:26:31.757

**解决了！**

通过持续的研究、搜索论坛和源代码存储库，我拼凑了必要的步骤，仅使用 libwebkit 和标准的 compiz 桌面（任何具有合成功能的 Xorg 桌面都应该这样做）来完成此任务。

对于当前的 libwebkit (1.1.10-SVN)，有一个 Ubuntu PPA：

```
deb http://ppa.launchpad.net/webkit-team/ppa/ubuntu jaunty main
deb-src http://ppa.launchpad.net/webkit-team/ppa/ubuntu jaunty main 
```

就代码而言，关键是调用`webkit_web_view_set_transparent`.

当然，您运行它的系统应该有一个功能强大的显卡（intel、radeon 或 nvidia）并运行一个合成窗口管理器（如 Compiz）。

最后，要真正看到透明度，您正在查看的内容必须使用 CSS3 设置透明背景，否则它仍然是完全不透明的。

它很简单：

```
BODY { background-color: rgba(0,0,0,0); } 
```

这是最简单的 webkit 浏览器应用程序的完整示例，具有透明度支持：

```
#include <gtk/gtk.h>
#include <webkit/webkit.h>

static void destroy_cb(GtkWidget* widget, gpointer data) {
  gtk_main_quit();
}

int main(int argc, char* argv[]) {
  gtk_init(&argc, &argv);

  if(!g_thread_supported())
    g_thread_init(NULL);

  // Create a Window, set colormap to RGBA
  GtkWidget* window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
  GdkScreen *screen = gtk_widget_get_screen(window);
  GdkColormap *rgba = gdk_screen_get_rgba_colormap (screen);

  if (rgba && gdk_screen_is_composited (screen)) {
    gtk_widget_set_default_colormap(rgba);
    gtk_widget_set_colormap(GTK_WIDGET(window), rgba);
  }

  gtk_window_set_default_size(GTK_WINDOW(window), 800, 800);
  g_signal_connect(window, "destroy", G_CALLBACK(destroy_cb), NULL);

  // Optional: for dashboard style borderless windows
  gtk_window_set_decorated(GTK_WINDOW(window), FALSE);

  // Create a WebView, set it transparent, add it to the window
  WebKitWebView* web_view = web_view = WEBKIT_WEB_VIEW(webkit_web_view_new());
  webkit_web_view_set_transparent(web_view, TRUE);
  gtk_container_add (GTK_CONTAINER(window), GTK_WIDGET(web_view));

  // Load a default page
  webkit_web_view_load_uri(web_view, "http://stackoverflow.com/");

  // Show it and continue running until the window closes
  gtk_widget_grab_focus(GTK_WIDGET(web_view));
  gtk_widget_show_all(window);
  gtk_main();
  return 0;
} 
```

[![截屏！](https://i.stack.imgur.com/pZok0.png)](https://i.stack.imgur.com/pZok0.png)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-09T11:34:02.863

回到 Safari 1.3 和 2，有一个隐藏的调试菜单（通过终端调用：）`defaults write com.apple.Safari IncludeDebugMenu 1`，其中包括一个“使用透明窗口”选项。

*   [http://www.macosxhints.com/article.php?story=20050418015445258](http://www.macosxhints.com/article.php?story=20050418015445258)
*   [http://www.wiredatom.com/blog/2005/10/20/safari-transparency/](http://www.wiredatom.com/blog/2005/10/20/safari-transparency/)

不确定这是 WebKit 的事情还是 Safari 的事情。

（在 Safari 3 中，调试菜单似乎已被没有透明窗口选项的“开发”菜单（在 Preferences > Advanced 中启用）取代。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-26T12:59:26.693

基本上，您希望将 ARGB 颜色空间设置为发送到窗口管理器。显然，只有支持合成的窗口管理器才能利用这一点。

您可能想与 screenlet 和 compiz 开发人员交谈，他们应该能够提供更多帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-12-03T16:07:17.117

这个要点对我有用，截至 2013 年，仅在 ubuntu 上测试过：

[https://gist.github.com/pouria-mellati/7771779](https://gist.github.com/pouria-mellati/7771779)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-03-29T15:27:45.633

对于单个屏幕截图，我有一个非常容易实现的新解决方案。它使用 node.js 和 phantom.js 库。

1.  安装 node.js
2.  在控制台/终端中运行“npm install -g phantomjs”
3.  将以下内容另存为 script.js 并从控制台“phantomjs script.js”运行它

    ```
    var page = require('webpage').create();
    page.viewportSize = { width: 1920, height: 1500 };
    page.open("http://www.theWebYouWantToRender");
    page.onLoadFinished = function(status) {
        page.evaluate(function() {
            document.body.style.background = 'transparent';
        });

        page.render('render.png');
        phantom.exit();
    }; 
    ```

4.  利润？：） 请享用

# internet-explorer - 每次访问网页时检查新版本 - 缓存

> ID：324927
> 
> 赞同：0
> 
> 时间：2008-11-28T01:37:19.323
> 
> 标签：internet-explorer, caching

我在一所使用非我们开发的基于 Intranet 的学生管理解决方案的大学工作。

最近进行的更改导致我们必须设置 Internet Explorer 以在每次访问时检查网页的新版本。否则某些页面将无法正确运行，我们将获得旧内容，从而导致交易错误。基本上是一种痛苦，尤其是因为它需要一段时间才能弄清楚正在发生的事情并为所有帐户锁定的用户解决问题。

无论如何，这将如何影响网页的缓存，内容现在总是被重新下载还是缓存在大多数情况下仍然有效？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T02:38:54.303

听起来您无法控制在响应客户端期间向页面添加[Expires 标头。](http://stevesouders.com/hpws/rule-expires.php)如果你这样做了，那么你可以显式地控制页面在客户端上缓存的时间。但是，客户端可以通过[更改浏览器中的设置](http://careers.queensu.ca/common/IEsettings.asp)[来覆盖](http://support.microsoft.com/kb/263070)Expires Header 。这就是你所做的。如果您将浏览器配置为始终获取页面的新版本，则浏览器将不会缓存任何内容。您可以调整 IE 缓存的数量，但更好的解决方案是让服务器设置 Expires Header。

# mysql - MySQL "WITH" 子句

> ID：324935
> 
> 赞同：109
> 
> 时间：2008-11-28T01:43:04.603
> 
> 标签：mysql, sql, common-table-expression

我正在尝试使用 MySQL 创建带有“WITH”子句的视图

```
WITH authorRating(aname, rating) AS
   SELECT aname, AVG(quantity)
   FROM book
   GROUP BY aname 
```

但似乎 MySQL 不支持这一点。

我认为这是非常标准的，我确信 Oracle 支持这一点。无论如何强制MySQL使用“WITH”子句？我已经尝试过使用 MyISAM 和 innoDB 引擎。这两个都不行。

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2008-11-28T07:49:26.547

更新：MySQL 8.0 终于有了通用表表达式的特性，包括递归 CTE。

这是一个宣布它的博客：http: [//mysqlserverteam.com/mysql-8-0-labs-recursive-common-table-expressions-in-mysql-ctes/](http://mysqlserverteam.com/mysql-8-0-labs-recursive-common-table-expressions-in-mysql-ctes/)

以下是我早先的答案，最初是我在 2008 年写的。

* * *

MySQL 5.x 不支持使用`WITH`SQL-99 中定义的语法进行查询，也称为*公用表表达式。*

这是自 2006 年 1 月以来对 MySQL 的功能请求：[http ://bugs.mysql.com/bug.php?id=16244](http://bugs.mysql.com/bug.php?id=16244)

其他支持公用表表达式的 RDBMS 产品：

*   Oracle 9i 第 2 版及更高版本：
    [http ://www.oracle-base.com/articles/misc/with-clause.php](http://www.oracle-base.com/articles/misc/with-clause.php)
*   Microsoft SQL Server 2005 及更高版本：http:
    [//msdn.microsoft.com/en-us/library/ms190766 (v=sql.90).aspx](http://msdn.microsoft.com/en-us/library/ms190766(v=sql.90).aspx)
*   IBM DB2 UDB 8 及更高版本：http:
    [//publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp ?topic=/com.ibm.db2.udb.doc/admin/r0000879.htm](http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/admin/r0000879.htm)
*   PostgreSQL 8.4 及更高版本：
    [https ://www.postgresql.org/docs/current/static/queries-with.html](https://www.postgresql.org/docs/current/static/queries-with.html)
*   Sybase 11 及更高版本： http:
    [//dcx.sybase.com/1100/en/dbusage_en11/commontblexpr-s-5414852.html](http://dcx.sybase.com/1100/en/dbusage_en11/commontblexpr-s-5414852.html)
*   SQLite 3.8.3 及更高版本：
    [http ://sqlite.org/lang_with.html](http://sqlite.org/lang_with.html)
*   HSQLDB： http:
    [//hsqldb.org/doc/guide/dataaccess-chapt.html#dac_with_clause](http://hsqldb.org/doc/guide/dataaccess-chapt.html#dac_with_clause)
*   Firebird 2.1 及更高版本（第一个支持递归查询的开源 DBMS）： [http ://www.firebirdsql.org/file/documentation/release_notes/html/rlsnotes210.html#rnfb210-cte](http://www.firebirdsql.org/file/documentation/release_notes/html/rlsnotes210.html#rnfb210-cte)
*   H2 数据库（但*仅*递归）：
    [http ://www.h2database.com/html/advanced.html#recursive_queries](http://www.h2database.com/html/advanced.html#recursive_queries)
*   Informix 14.10 及更高版本： [https ://www.ibm.com/support/knowledgecenter/SSGU8G_14.1.0/com.ibm.sqls.doc/ids_sqs_with.htm](https://www.ibm.com/support/knowledgecenter/SSGU8G_14.1.0/com.ibm.sqls.doc/ids_sqs_with.htm)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-02-11T21:07:24.317

你可能对这样的事情感兴趣：

```
select * from (
    select * from table
) as Subquery 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-05-14T17:07:07.777

您的语法正确：

```
WITH AuthorRating(AuthorName, AuthorRating) AS
   SELECT aname         AS AuthorName,
          AVG(quantity) AS AuthorRating
   FROM Book
   GROUP By Book.aname 
```

但是，正如其他人所提到的，MySQL 不支持此命令。在 SQL:1999 中添加了 WITH；SQL 标准的最新版本是 SQL:2008。[您可以在Wikipedia](http://en.wikipedia.org/wiki/SQL:1999)上找到有关支持 SQL:1999 各种功能的数据库的更多信息。

MySQL 传统上在支持 SQL 标准方面有点落后，而像 Oracle、SQL Server（最近）和 DB2 等商业数据库则更紧跟它们。PostgreSQL 通常也非常符合标准。

您可能想查看 MySQL 的路线图；我不完全确定何时支持此功能，但它非常适合创建可读的汇总查询。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-28T02:15:39.653

Oracle 确实支持 WITH。

它看起来像这样。

```
WITH emps as (SELECT * FROM Employees)
SELECT * FROM emps WHERE ID < 20
UNION ALL
SELECT * FROM emps where Sex = 'F' 
```

@ysth WITH 很难用谷歌搜索，因为它是一个通常被排除在搜索之外的常用词。

您需要查看[SELECT 文档](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_10002.htm#i2161315)以了解子查询分解是如何工作的。

我知道这不能回答 OP，但我正在清理任何可能已经开始的混乱。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-10-31T23:44:17.997

基于@Mosty Mostacho 的答案，对于确定表中不存在哪些条目且不在任何其他数据库中的特定情况，您可以在 MySQL 中执行等效操作。

```
select col1 from (
   select 'value1' as col1 union
   select 'value2' as col1 union
   select 'value3' as col1
) as subquery
left join mytable as mytable.mycol = col1
where mytable.mycol is null
order by col1 
```

您可能希望使用具有宏功能的文本编辑器将值列表转换为带引号的选择联合子句。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-06-11T07:25:54.990

MariaDB 现在支持 WITH。MySQL 现在不是。 [https://mariadb.com/kb/en/mariadb/with/](https://mariadb.com/kb/en/mariadb/with/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-26T08:53:01.673

你试过临时表吗？这解决了我的问题：

```
create temporary table abc (
column1 varchar(255)
column2 decimal
);
insert into abc
select ...
or otherwise
insert into abc
values ('text', 5.5), ('text2', 0815.8); 
```

然后您可以在此会话的每个选择中使用此表：

```
select * from abc inner join users on ...; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-06-06T08:48:51.450

```
 WITH authorRating as (select aname, rating from book)
   SELECT aname, AVG(quantity)
   FROM authorRating
   GROUP BY aname 
```

# python - JDBC 和 MSSQL 似乎正在截断大字段

> ID：324945
> 
> 赞同：1
> 
> 时间：2008-11-28T01:58:14.760
> 
> 标签：python, sql-server, jdbc, jython

我正在使用 jython 2.2.1 和 jdbc 1.2 并连接到 mssql 2000 数据库，将电子邮件的内容写入其中。当我到达可能相当大的电子邮件正文时，有时我需要将数据截断为 5000 个字符。除了 mssql 和 jdbc 像校园恶霸一样联合起来攻击我，当我每次检查数据库负载时我的数据是否丢失，最大字符数 = 256 个字符。

我检查了字段的大小，它设置为 5000。什么给出了？

我很确定它与 jdbc 相关，因为以前的版本使用.... vb6 & odbc，没有问题。

这是一些代码：

```
BODY_FIELD_DATABASE=5000

def _execute_insert(self):
    try:
        self._stmt=self._con.prepareStatement(\
            "INSERT INTO EmailHdr (EntryID, MailSubject, MailFrom, MailTo, MailReceive, MailSent, AttachNo, MailBody)\
             VALUES (?, ?, ?, ?, ?, ?, ?, cast(? as varchar (" + str(BODY_FIELD_DATABASE) + ")))")
        self._stmt.setString(1,self._emailEntryId)
        self._stmt.setString(2,self._subject)
        self._stmt.setString(3,self._fromWho)
        self._stmt.setString(4,self._toWho)
        self._stmt.setString(5,self._emailRecv)
        self._stmt.setString(6,self._emailSent)
        self._stmt.setString(7,str(int(self._attachmentCount) + 1))
        self._stmt.setString(8,self._format_email_body()) 
        self._stmt.execute()
        self._prepare_inserting_attachment_data()
        self._insert_attachment_data()
    except:
        raise

def _format_email_body(self):
    if not self._emailBody:
        return " "
    if len(self._emailBody) > BODY_FIELD_DATABASE:
        return self._clean_body(self._emailBody[:BODY_FIELD_DATABASE])
    else:
        return self._clean_body(self._emailBody)

def _clean_body(self,dirty):
    '''used to clean =20 occurrence in email body that contains chinese characters
       http://en.wikipedia.org/wiki/Quoted-printable'''
    dirty=str(dirty)
    return dirty.replace(r"=20","") 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-28T02:03:08.977

删除了我的答案 - 这是完全错误的。把它放在这里，这样评论和对话就会流连忘返。

**编辑：**

正如您在评论中看到的那样，发生了以下事情：

数据已正常放入数据库，但 MSSQL 查询管理器无法显示中文字符。

# f# - 此表达式应具有“unit”类型，但具有“ConsoleKeyInfo”类型

> ID：324947
> 
> 赞同：35
> 
> 时间：2008-11-28T01:59:10.810
> 
> 标签：f#, functional-programming, unit-type

我只是想在 F# 控制台应用程序中暂停一下，所以我写道：

Console.ReadKey()

但这给出了警告：`This expression should have type 'unit', but has type 'ConsoleKeyInfo'.`

我能做些什么来解决这个问题？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-11-28T02:14:48.593

解决方案：

```
Console.ReadKey() |> ignore 
```

说明：`Console.ReadKey()`返回一个“ConsoleKeyInfo”类型的对象，但您将它用作语句而不将返回值分配给任何东西。因此，F# 会警告您忽略了一个值。`ignore`接受任何类型并且不返回任何内容。可以这样定义：

```
let ignore _ = () 
```

# database - 在数据库中写入评论表

> ID：324949
> 
> 赞同：3
> 
> 时间：2008-11-28T02:01:45.017
> 
> 标签：database, database-design

我正在开发一个社交网络系统，该系统将有来自多个不同位置的评论。一个可以是朋友，一个可以是事件，一个可以是群组——很像 Facebook。我想知道的是，从实际的角度来看，编写评论表的最简单方法是什么？我应该在一个表中完成所有操作并允许外键访问各种不同的表，还是每个不同的表都有自己的注释表？谢谢您的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T02:21:30.453

我认为，单个评论表是更优雅的设计。不过，不要考虑多个 FK，而是考虑一个中间表 - CommentedItem。因此 Friend、Event、Group 等都具有 CommentedItem 的 FK，并且您为每个表中的每个新行创建一个 CommentedItem 行。现在 Comments 只需要一个 FK 到 CommentedItem。例如，要获取给定朋友的所有评论：

```
SELECT * FROM Comment c
JOIN CommentedItem ci on c.CommentedItemId = ci.CommentedItemId
JOIN Friend f on f.CommentedItemId = ci.CommentedItemId
WHERE f.FriendId = @FriendId 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T02:45:33.273

我都做过，答案取决于情况。对于*你*想要做的事情，我会做一个“评论”表，然后单独的“链接器”表。这将为您提供最佳性能，因为您可以实现“[完美指数](http://www.singingeels.com/Articles/Understanding_SQL_Many_to_Many_Relationships.aspx)”。

我还建议在 Comments 表中放置一个“CommentTypeID”字段，以提供有关您将从哪个链接器表中提取附加详细信息的“线索”。

编辑： CommentTypeID 字段不应在索引中使用，而仅用于代码中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T02:18:53.673

[这](https://stackoverflow.com/questions/307748/news-feed-database-design-as-in-facebook)是一个等价的问题。

编辑：根据评论，尚不清楚这是一个等效的问题，因此我在下面将其拼写出来。

这两个问题都询问有关数据库性能问题的项目（两者都恰好是社交​​网络，但这只是巧合）。两者都有一组不同的对象，它们共享一个共同的属性集合（一个是事件，发生在每个对象上，另一个是发生在每个对象上的注释）。

这两个问题都有效地询问了创建一个结合不同的公共特征的 UNION 查询，或者使用适当的外键将它们分解到一个公共表中是否更有效。

我认为它们是等价的；对一个的最佳答案将同样适用于另一个。

（如果您不同意，我很高兴听到原因；请发表评论。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T03:10:53.007

需要注意的一件事是，如果您不使用高度规范化的数据库，它有时会导致 IO 行链接和表扫描。

我相信 oracle 建议执行大约第三范式的规范化模型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T09:29:55.407

我会选择[多态关联](http://en.wikipedia.org/wiki/Polymorphic_association)。许多现代 Web 开发框架开箱即用地支持它，这使其成为处理此类关系的最简单、最轻松的方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T20:38:03.710

Actually you can probably go to [http://www.zazazine.com](http://www.zazazine.com) and look through their articles. You may find an answer there

# asp.net - 具有多个实例和 web.configs 的单个 ASP.net 站点

> ID：324957
> 
> 赞同：10
> 
> 时间：2008-11-28T02:09:26.453
> 
> 标签：asp.net, iis, web-config

我们有一个在 IIS 服务器上运行的旧版 ASP.net 支持的站点，该站点由一个中心团队开发，并被多个客户使用。然而，每个客户都有自己的站点 aspx 文件副本和 web.config 文件。这会导致问题，因为善意的支持工程师对源 aspx 文件的副本所做的更改没有被折叠回中央源，因此我们的代码库出现了分歧。我们当前的文件夹结构类似于：OurApp/Source aspx & default web.config
Customer1/Source aspx & web.config
Customer2/Source aspx & web.config
Customer3/Source aspx & web.config
Customer4/Source aspx & web.config
。 ..

这是我想改变的，每个客户只有一个定制的 web.config 文件，所有客户共享一组通用的源文件。类似于：OurApp/Source aspx & default web.config
Customer1/web.config
Customer2/web.config
Customer3/web.config
Customer4/web.config
...

所以我的问题是，我该如何设置？我是 ASP.net 和 IIS 的新手，因为我通常在家里使用 php 和 apache，但我们在工作中使用 ASP.net 和 ISS。

* * *

使用了源代码控制，我打算重新培训支持工程师，但有没有办法避免源 aspx 文件的多个副本？我讨厌那种重复！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-28T03:57:43.177

如果您在单个应用程序实例上死心塌地，您可以在单个 web.config 中使用自定义 ConfigurationSection 后完成您的工作。有关基础知识，请参阅：

*   [http://haacked.com/archive/2007/03/12/custom-configuration-sections-in-3-easy-steps.aspx](http://haacked.com/archive/2007/03/12/custom-configuration-sections-in-3-easy-steps.aspx)
*   [http://msdn.microsoft.com/en-us/library/2tw134k3.aspx](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx)

示例 XML 可能是：

```
<YourCustomConfigSection>
   <Customers>
     <Customer Name="Customer1" SomeSetting="A" Another="1" />
     <Customer Name="Customer2" SomeSetting="B" Another="2" />
     <Customer Name="Customer3" SomeSetting="C" Another="3" />
   </Customers>
</YourCustomConfigSection> 
```

现在在您的 ConfigSection 属性中，公开 Name、SomeSetting 和 Another。当访问或设置属性时，使用条件（请求域或唯一标识客户的其他内容）来决定使用哪个。

通过正确的实施，应用程序开发人员无需了解幕后发生的事情。他们只使用 CustomSettings.Settings.SomeSetting 而不必担心哪个客户正在访问该应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T02:48:11.537

我知道这可能看起来很烦人，但重复实际上是一件好事。这里的问题在于**您的**流程，而不是系统的设置方式。

将站点分开实际上是一件好事。虽然它看起来像“重复”，但实际上并非如此。是**分离**。应积极劝阻您的支持工程师更改生产代码。

您应该考虑更改您的流程，以便在随处部署后进行更改。从长远来看，这将使您的一切变得容易得多。

要实际回答您的问题，答案是否定的，您不能这样做。原因是 web.config 并非旨在存储用户级别设置，而是旨在存储每个应用程序实例设置。在您的情况下，您需要每个用户一个应用程序实例，这意味着单独的配置文件。

为了使您的系统正常工作，您需要能够先发制人地告诉应用程序使用哪个配置文件，如果没有用户的某种输入，这是不可能的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T02:12:03.937

使用外部源代码控制应用程序并根据需要不断推出更新。

无论如何，让支持工程师实时更新您的实时站点并不是一个好主意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T03:15:40.577

根据 Web 配置中的实际内容以及客户之间的不同设置，您可以选择使用单个 Web 配置，并将其他客户特定的配置选项存储在数据库或其他一些自定义 xml/文本文件中。只要 web.config 中的特定客户设置与 IIS 的运行方式无关，并且您只是使用它来存储值，那么此解决方案可能对您很有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T04:06:36.683

如果我理解正确，听起来您有多个部署（每个客户端一个），唯一的区别是 web.config，对吗？

首先，虽然我不知道您的独特情况，但我通常会敦促您继续单独安装。它通常允许更大的灵活性。在我脑海中浮现：您是否会进行自定义，或者不同的客户端运行不同的版本？你*确定*吗？在这里保持灵活性的最简单方法是继续进行单独安装。

在我看来，如果您的做法正确对齐，那一点也不难看。根据您提到的一些事情，您在该领域遇到了麻烦 - 显然，可能存在源代码控制购买/培训问题。但你知道这一点。我还会仔细研究您的部署程序等。我有一种感觉，你可能在这方面还有其他问题，我的意思是绝对没有冒犯。

也就是说，假设您想继续前进。

您没有说所有客户端是否共享一个公共数据库，但我认为不，因为设计这种类型的系统通常不值得额外的复杂性（这在任何规模的系统中都可能很严重）所以人们经常选择让他们分开。

这意味着您已将连接字符串存储在某处。通常那将是 web.config ......所以这似乎打破了我们的计划。

确实，这种情况的明显优雅几乎总是被它引入的挑战所抵消。如果我仔细考虑过，我可能会通过引入另一个智能管理连接字符串的数据库来解决这个问题，或者可能会钻研将所有登录信息直接保存在 web.config 中（这是可能的，但......不理想） ，但是我的直觉说这项工作将被浪费，因为有一天你最终会回到你现在的工作方式。

另外：直接在生产中更改代码显然不是这里的最佳实践。但是，如果您在一个拥有任何流量的单一共享平台上，那将永远不会发生。深思熟虑。

如果我遗漏了什么，请告诉我！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T20:00:38.867

再次感谢大家的回答。在通读它们并思考后，我认为我将暂时不理会多个实例，我将首先尝试改进我们的更新过程。然后我将开发一个新版本的应用程序，该版本在数据库层具有用户配置信息，然后根据某人的建议根据请求域或 URL 选择用户。这样我就可以有一个应用程序实例干净地支持多个不同的客户端配置。

由于大多数客户端配置数据实际上是与表示或数据源相关的，没有什么复杂的。我认为我们最终得到了多个应用程序实例，主要是因为最初的程序员没有期待多个客户并且没有为此进行设计，所以当后来有人出现并添加第二个客户时，他们只是复制了应用程序，这对于每个实例都是浪费的与原版约 99.99% 相同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T02:05:16.820

正如我们所说，我正在实施这一点。

在主 web.config 中，每次安装我有 1 个项目。它指向我为每个客户端构建的自定义配置文件（以及自定义母版页、css、图像等）。

使用 WebConfigurationManager.OpenWebConfiguration，我在其子目录中打开新的 webconfig。我通过使用 System.Web.HttpContext.Current.Request.Url.OriginalString 并确定调用我的 uRL 来确定使用哪一个。根据该 URL，我知道要使用哪个 web.config。

从那时起，客户端都使用相同的代码库。他们也有自己的数据库。

当我们进行更新时必须更新 30-40 个安装的想法吓坏了我。我们不想支持 30-40 个代码库，因此除了母版页、css 和图像之外不会有自定义。

我编写了一个自定义类库，它知道如何切换到正确的 webconfig，并阅读了我使用所有设置构建的自定义部分。

我现在唯一的问题是 FormsAuthentication Cookie。我也需要能够切换它。不幸的是，名称的属性是只读的

# active-directory - 将查询字符串传递给 rDirectory

> ID：324959
> 
> 赞同：0
> 
> 时间：2008-11-28T02:11:44.763
> 
> 标签：active-directory

是否可以将查询字符串传递给 Namescape 的[rDirectory](http://www.namescape.com/Products/rDirectory/Default.aspx)？我想构建一个可以进行搜索并在 rDirectory 中显示结果的网络应用程序，而不是首先启动 rDirectory 并进行所述搜索。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-01T19:08:53.730

经过一番挖掘和查看一些 rDirectory 代码后，查询字符串看起来像这样：Results.aspx?CatalogKey=2&FilterExp=x&WhereTxt=x&SortFields=cn。不幸的是，“FilterExp”和“WhereTxt”值都作为加密文本传递。

看起来需要一些时间、精力，也许还需要对 rDirectory Web 应用程序进行一些逆向工程才能更进一步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T18:33:12.403

如果您指的是 Namescape 的 rDirectory，查询字符串将类似于以下内容：

[http://[服务器名称]/?runapp=b05810fe-be2c-4a12-b3a9-858bbb71eff1&AutoSearch=true&cn=alice%20cooper&telephoneNumber=](http://[servername]/?runapp=b05810fe-be2c-4a12-b3a9-858bbb71eff1&AutoSearch=true&cn=alice%20cooper&telephoneNumber=) *867*

runapp guid 是从 Designer 菜单中的 rDirectory 应用程序页面捕获的。如果您对此有更多疑问，请联系 support@namescape.com

# regex - 正则表达式匹配零

> ID：324961
> 
> 赞同：6
> 
> 时间：2008-11-28T02:12:43.077
> 
> 标签：regex

我正在寻找一种正则表达式模式，它可以匹配多种不同的零组合，例如 00-00-0000 或 0 或 0.0 或 00000

请帮忙

谢谢！

编辑：

好吧，我有一个返回结果集的 Web 服务，根据它返回给我的内容，我可以决定结果是否值得在页面上显示。因此，如果我得到 00-00-0000 或 0 或 00000，我会假设未找到数据，但是如果它带回 001 或 000123 或 0356.00 - 1000 或 0.6700，这将是有效的。

希望这能澄清我的问题

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-28T02:15:30.560

您需要更好地定义在零之间出现的有效内容。从您的问题出发，我假设您正在寻找任意数量的零和任意数量的“-”和“。”分组。它们之间....

`0([-.]?0+)*`

希望你不介意，肥皂盒：

根据问题编辑，您要查找的是其中包含非零数字的任何字符串，因此：

`[1-9]`

或者，如果正则表达式引擎自动锚定字符串的开头和结尾：

`.*[1-9].*`

可能是更好的解决方案。

这与您要求的测试相反，但这很容易改变（反转 if 语句的含义）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T02:56:34.297

```
[^123456789]+ 
```

或者

```
[^1-9]+ 
```

我相信这就是您正在寻找的...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-12-11T12:40:02.943

I use this one, starts and ends with zero and contains only zeros.

```
^[0]+$ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-28T02:51:03.560

这是与您到目前为止所要求的内容相匹配的正则表达式。如果还有更多您希望它匹配，请指定。

```
0+((\.0+)|(-0+)*) 
```

这符合您要求的所有示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T02:53:20.933

试试这个：

```
(00-00-0000|0|0\\.0|00000) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-28T03:17:09.450

您似乎过于复杂化了需要做的事情。与其寻找结果全为零的不同组合，不如使用正则表达式来识别您*关心*的数据。

因此，我建议你使用这个：[1-9]

This will match if the string contains any digit that is non-zero, assuming that you're looking at numeric data, of course.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-01-04T08:19:30.683

Hello this is how you can match only "0"

```
^0([-.]?[0]*)$ 
```

it can match 0, 0.00, 0., but not 0.001, 01, or anything else.

# camera - 在WIA中，如何将我的程序添加到从数码相机获取图像的程序列表中？

> ID：324974
> 
> 赞同：3
> 
> 时间：2008-11-28T02:24:57.653
> 
> 标签：camera, wia

当我将数码相机与计算机连接时，会出现一个对话框，其中包含所有可用于从相机获取图像的注册程序。现在我想在列表中添加我自己的程序，这样当我单击我的程序的项目时，我可以使用我自己的程序从数码相机中获取图像。

非常感谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-27T00:57:16.263

WIA 有一个设备管理器对象，它提供了一个允许程序注册事件通知的接口。

## 联系设备管理器

您使用该`IWiaDevMgr`界面与设备管理器进行交互。您可以通过调用获得指向该接口的指针`CoCreateInstance()`：

```
 IWiaDevMgr *pWiaDevMgr;
    HRESULT hr;
    hr = CoCreateInstance(CLSID_WiaDevMgr,
        NULL,
        CLSCTX_LOCAL_SERVER,
        IID_IWiaDevMgr,
        (void*)&pWiaDevMgr); 
```

## 为活动注册程序

然后，注册一个在事件触发时运行的程序很简单：

```
pWiaDevMgr->RegisterEventCallbackProgram(
    WIA_REGISTER_EVENT_CALLBACK,
    NULL,
    &WIA_EVENT_DEVICE_CONNECTED,
    bstrCommandline,
    bstrName,
    bstrDescription,
    bstrIcon); 
```

命令行、名称、描述和图标都是`BSTR`s，因为它们是通过一个COM接口传递的。您可以使用`SysAllocString()`和它的朋友来创建它们，或者使用 Visual C 扩展或 ATL 提供的类来创建和管理它们。

## 释放设备管理器

如果您没有为接口使用支持 COM 的智能指针，请不要忘记释放以下引用的引用`CoCreateInstance()`：

```
 pWiaDevMgr->Release(); 
```

如果你不释放它，COM系统*会*想办法惩罚你，但它可能不会立即明显......

## 注销

偶然测试表明，当用于注册事件的所有四个参数都准确传递时，删除已注册的事件是有效的。电话是：

```
pWiaDevMgr->RegisterEventCallbackProgram(
    WIA_UNREGISTER_EVENT_CALLBACK,
    NULL,
    &WIA_EVENT_DEVICE_CONNECTED,
    bstrCommandline,
    bstrName,
    bstrDescription,
    bstrIcon); 
```

这是一个潜在的烦恼，因为似乎没有记录的 API 来列出已注册的事件。这意味着如果您的安装程序注册了一个程序，那么它还应该记录使用的参数，以便您的卸载程序可以取消注册该事件。

## 事件参数

命令行可以包含字符串，在解析命令行之前，这些字符串`%1`将`%2`分别替换为所触发事件的端口名称和 GUID。

插入相机时，图标、名称和描述会显示在呈现给用户的列表中。名称应短于描述。

该图标是文件名和资源标识符的组合。一个好的默认值是`"sti.dll,0"`相机和扫描仪的通用图像。如果您提供自己的图标，则几乎可以肯定该字符串必须包含 DLL 的完全限定路径。走出去，我想故意在路径中的任何地方包含一个逗号，而不是作为资源 id 之前的分隔符会造成麻烦。

## 在幕后

WIA/STI 存储事件列表的实际位置没有记录。但是，通过在 regedit 中进行一些搜索，我在我的 XP SP3 系统上找到了事件目录。人们可能会想象它会在其他系统中的类似位置找到......

注册表项`HKLM\SYSTEM\CurrrentControlSet\Control\StillImage\Events`包含系统已知的每个事件的子项。每个键都有一个名为 GUID 的值，其中包含标识该事件的 GUID。

例如，设备连接事件处理程序列在`Connect`子项中。

各个 WIA/STI 设备的密钥可以在`HKLM\SYSTEM\CurrentControlSet\Control\Class\{6BDD1FC6-810F-11D0-BEC7-08002BE2092F}`密钥等其他地方找到。

请记住，这些位置没有记录在案。触摸它们需要您自担风险，您的里程会有所不同，...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T11:54:43.247

您需要使用 WIA（Windows Image Acquisition）界面。IWiaDevMgr 提供了三种方法来执行此操作：RegisterEventCallbackProgram、RegisterEventCallbackCLSID 和 RegisterEventCallbackInterface。如果您希望 Windows 在用户在“自动播放”对话框中单击您时启动您的程序，您可以使用 RegisterEventCallbackProgram 或 RegisterEventCallbackCLSID。

# open-source - 您使用/推荐哪些开源 GIS 工具？

> ID：324976
> 
> 赞同：6
> 
> 时间：2008-11-28T02:25:32.067
> 
> 标签：open-source, gis

我正在研究开源 GIS 资源——并且想知道现有的所有开源工具——人们实际使用/发现有用的东西。

[http://en.wikipedia.org/wiki/GIS_software](http://en.wikipedia.org/wiki/GIS_software)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-28T00:56:57.327

这是我经常使用的一些

*   [地理信息系统](http://postgis.refractions.net/)
*   [格达尔](http://www.gdal.org/)
*   [地图服务器](http://mapserver.org/)
*   [uDig](http://udig.refractions.net/)
*   [草](http://grass.itc.it/)
*   [地理](http://trac.osgeo.org/geos/)
*   [地理服务器](http://geoserver.org/display/GEOS/Welcome)
*   [格林威治标准时间](http://gmt.soest.hawaii.edu/)
*   [开放层](http://openlayers.org/)
*   [瓷砖缓存](http://tilecache.org/)
*   [qgis](http://www.qgis.org/)

大名单在这里[http://opensourcegis.org/](http://opensourcegis.org/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T21:30:16.737

[http://sharpmap.codeplex.com](http://sharpmap.codeplex.com)用于 .Net 世界。我们不在 OSGeo 下，所以你不会在那里找到我们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-25T23:05:42.883

我发现 Quantum GIS 非常有用：

[http://qgis.org/en/about-qgis.html](http://qgis.org/en/about-qgis.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-25T22:55:43.983

以下是其他资源：

*   维基百科[GIS软件对比](http://en.wikipedia.org/wiki/Comparison_of_GIS_software)
*   [免费和开源桌面 GIS (FOS-GIS) 概述](http://www.spatialserver.net/osgis/)

正如[MarkJ 所](https://stackoverflow.com/users/15639/markj)指出的，[OSGeo.org](http://www.osgeo.org)也是一个必须检查的地方。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-29T18:30:42.667

另一个大清单：[OSGeo](http://www.osgeo.org/)是一个支持开源地理空间软件的合作项目。

# python - 如何确定电子邮件是否经过 Base64 编码？

> ID：324980
> 
> 赞同：5
> 
> 时间：2008-11-28T02:30:50.620
> 
> 标签：python, email, encoding, jython, email-headers

我很难确定文本电子邮件的正文是否是 base64 编码的。如果是，则使用这行代码；使用 jython 2.2.1

```
dirty=base64.decodebytes(dirty) 
```

否则继续正常。

这是我有atm的代码。哪行代码可以让我从电子邮件中提取：

“内容传输编码：base64”

```
import email, email.Message
import base64

def _get_email_body(self):
    try:
        parts=self._email.get_payload()
        check=parts[0].get_content_type()
        if check=="text/plain":
            part=parts[0].get_payload()
            enc = part[0]['Content-Transfer-Encoding']
            if enc == "base64":
                dirty=base64.decodebytes(dirty)
        elif check=="multipart/alternative":
            part=parts[0].get_payload()
            enc = part[0]['Content-Transfer-Encoding']
            if part[0].get_content_type()=="text/plain":
                dirty=part[0].get_payload()
                if enc == "base64":
                    dirty=base64.decodebytes(dirty)
            else:
                return "cannot obtain the body of the email"
        else:
            return "cannot obtain the body of the email"
        return dirty
    except:
        raise 
```

好的，这段代码现在可以工作了！谢谢大家

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-28T02:44:04.760

尝试：

```
enc = msg['Content-Transfer-Encoding'] 
```

这是一个标题，因此您将无法看到它的身体。您应该能够在同一地点找到主题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-05-25T18:00:07.227

它是一个标头，但您必须首先从消息中获取有效负载。

这将是：

```
header = msg.get_payload()[0]
header['Content-Transfer-Encoding'] 
```

我正在使用 Python 3

# c# - 带有图标的 GDI 句柄。l

> ID：324982
> 
> 赞同：0
> 
> 时间：2008-11-28T02:31:19.263
> 
> 标签：c#, winforms, gdi+, gdi, handles

我有一个winforms 应用程序。我有一个带有很多图标的用户控件。用户可以在表单上多次加载此控件（在选项卡式布局中）。现在我每次创建控件时都在加载图标（在应用程序中可能高达 50 次）。有没有办法在应用程序中缓存这些图标。如果我这样做，会减少我正在使用的 gdi 句柄的数量，因为这已成为一个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T03:11:24.173

您可以为每个图标创建一个单例类。它创建句柄的第一个引用。后续调用使用现有句柄。

在不了解您的用户控制的更多信息的情况下，我的下一个建议只能是非常笼统的。但是你可以有一个单一的位图层，你可以在上面绘制所有的图标。用户控件的其余元素将存在于该位图上方和周围。

不幸的是，这个想法在性能方面可能存在问题。要求您重构所有准备用于排列图标的代码。最后，从具有控制形式结构的框架如何理想地工作来看，它是非制度性的。

我们在使用 CAM 软件附带的参数形状的输入表单时遇到了资源问题。太多的文本条目导致了各种形式的陌生和泄漏。因此，我们改为创建带有边框的标签，看起来像文本条目，并且有一个文本条目（以及一个组合框条目）。当用户选择、输入或单击单个文本条目时，会移动到新条目，并且为前一个条目设置标签。

这完全是一个不直观的设置，而不是您通常编码的方式，但它是处理我们的资源问题的唯一方法。

根据我的经验，当您必须处理数十或数百个条目并且您必须使用不同的设计来解决问题时，GUI 框架似乎会出现问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-08T16:14:44.143

如果问题是“图标”的数量（不确定您的意思），您可以使用 Image-Lists。例如，Listview 控件可以引用图像列表中的图标，而不是为每个项目保留完整副本（但不确定这是否适用于您的情况）。*****``****