# StackOverflow 问答 000569000-000569999

# c# - 自动重新排序数据表主键中的列？

> ID：569004
> 
> 赞同：0
> 
> 时间：2009-02-20T10:14:40.127
> 
> 标签：c#, datatable, primary-key

我有一个名为 Permissions 的表，它在名为 _permissionsSet 的数据集中定义，它有 3 列：PermissionGroup、Permission、PermissionLevel（按此顺序）

我将表上的主键设置为包括所有 3 列，如下所示

```
DataColumn[] keys = new DataColumn[3];
keys[0] = _permissionsSet.Permissions.Columns[0];
keys[1] = _permissionsSet.Permissions.Columns[1];
keys[2] = _permissionsSet.Permissions.Columns[2];

_permissionsSet.Permissions.PrimaryKey = keys; 
```

当我查看“键”中的值时，它们符合预期：

```
? keys
{System.Data.DataColumn[3]}
[0]: {PermissionGroup}
[1]: {Permission}
[2]: {PermissionLevel} 
```

但是当我查看主键时，顺序发生了变化！

```
? _permissionsSet.Permissions.PrimaryKey
{System.Data.DataColumn[3]}
[0]: {PermissionGroup}
[1]: {PermissionLevel}
[2]: {Permission} 
```

在我的数据表中使用 Rows.find 方法时，这具有明显的含义。

有谁知道为什么会这样？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-24T03:42:03.687

The DataTable.PrimaryKey property returns a simple unsorted array of DataColumn objects. If you want to sort them, take a look at [Array.Sort](http://msdn.microsoft.com/en-us/library/bzw8611x.aspx). You'll need to implement an IComparer for the DataColumn type that compares instances by their .Ordinal property.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-30T09:27:53.870

也许看看你的数据表上的约束集合。如果这三列上已经存在唯一约束，则在设置 PrimaryKey 属性时，DataTable 将重用该约束（因为从逻辑上讲，主键中的列顺序与关系数据中的其他地方一样，是无关紧要的）。

如果您无法控制现有的其他约束，则需要在设置后读取 Primary Key 属性，并适当地重新排序 Find 参数。

**编辑**

理想情况下，有人会编写一个看起来像 find 的扩展方法，但采用名称/值对，并根据 PrimaryKey 属性的当前值计算出正确的顺序。再次，它提出了在数据库中搜索是否更合适的问题。

# eclipse - Eclipse :: 在“打开资源”对话框中隐藏 .svn 文件

> ID：569032
> 
> 赞同：36
> 
> 时间：2009-02-20T10:25:08.213
> 
> 标签：eclipse

是否可以在 Eclipse 的“打开资源”对话框（Ctrl + Shift + R）中隐藏 .svn 文件？

当你有数百个文件时，这很烦人......

干杯。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2011-05-31T09:17:39.913

尝试以下操作：

项目 > 属性 > 资源 > 资源过滤器 > 添加

选择：排除所有、文件夹、所有子项（递归）

名称匹配：.svn

确定并申请

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-14T18:11:59.027

如果插件没有为您完成工作怎么办？就像我的情况一样，我安装了 subclipse，但它没有隐藏文件！我什至卸载-重新安装

没关系，这篇博文解决了这个问题：[http ://blog.pengoworks.com/index.cfm/2009/4/20/Eclipse-showing-svnbase-files-in-Open-Resource-dialog](http://blog.pengoworks.com/index.cfm/2009/4/20/Eclipse-showing-svnbase-files-in-Open-Resource-dialog)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T10:28:13.433

Subversive/Subclipse 安装程序将为您完成所有工作（忽略 .svn 作为资源），另外您还可以获得 SVN 支持...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-03T23:38:49.663

正如 Doug 间接指出的，在安装 Subversive 或 Subclipse 之后，您必须在 Eclipse 中关闭并重新打开项目。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T11:21:48.920

如果由于某种原因您不能按照[gimpf](https://stackoverflow.com/users/15529/gimpf)的[建议](https://stackoverflow.com/questions/569032#569042)安装 SVN 插件，您可以过滤 Open Resource 对话框的列表。

如this SO question中所示，您在“开放资源”对话框的右上角有一个蓝色小箭头。
单击它并“选择工作集”。然后根据需要创建一个新的工作集，以仅包含您需要的内容。

[替代文字 http://giano.com.dist.unige.it/eclipseMirror/eclipse/downloads/drops/R-3.3-200706251500/whatsnew/images/openresource.png](http://giano.com.dist.unige.it/eclipseMirror/eclipse/downloads/drops/R-3.3-200706251500/whatsnew/images/openresource.png)

不如让插件为您完成工作那么实用；）

# c# - .Net winform 属性显示可见但我看不到

> ID：569039
> 
> 赞同：0
> 
> 时间：2009-02-20T10:27:53.120
> 
> 标签：c#, .net, winforms

我有一个奇怪的情况，我从我的应用程序中打开一个表单，隐藏它，当我尝试第二次显示它时，Visible 属性显示为 true，TopMost 也为 true，位置正确，但我看不到它。

任何想法在哪里以及看什么来解决问题是什么？

（注意：事件处理程序/委托可能存在问题，但我不太确定从哪里开始）

*更新*- 我将 ShowInTaskbar 设置为 true - 我在任务栏中看到它，但无法将其置于前面，并且右键单击任务栏按钮什么也不做。Alt-Tab 也不行。不会出现在任务管理器中。

尝试过 Crack.NET，但找不到任何让我“进入”对象实例的属性。.Net Memory Profiler 对此没有帮助，我相信，Winspector 我不确定该怎么做。

**UPDATE2** - 我撒谎了，它不是直接的 WinForm，我是从一个自定义类继承的，而后者又从 WinForm 继承。我尝试直接从 Form 继承，它可以工作。所以现在我必须去查看自定义类的代码。我会及时向大家发布...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T10:34:24.697

会不会超出屏幕边界？（即搬出）。

使用 Spy++ 或[Winspector](http://www.windows-spy.com/)并尝试找到这个丢失的窗口并准确查看它隐藏的位置/原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T12:24:48.487

好的，搞定了。

自定义表单类有一个“很酷”的功能——它淡入淡出。

但显然只有一次。

所以我看不到表格的原因是不透明度为0！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T10:32:41.940

父窗口是否可见？

Windows 有关于不可见窗口的子级不可见的规则，无论它们自己的可见性如何。

# asp.net - ASP.NET 表单验证 - 使用 JS/DHTML 突出显示字段

> ID：569054
> 
> 赞同：1
> 
> 时间：2009-02-20T10:33:22.763
> 
> 标签：asp.net, validation

今天早上有一个问题一直困扰着我。我正在构建一个具有许多输入表单的 ASP.NET webforms 应用程序，并且我正在尝试标准化我管理验证的方式。我想使用内置的验证器（RequiredFieldValidator、Regex 等）。我的html要求是：

验证前：

```
<div class="formLine">
   <label for="fieldID">Form Label</label>
   <input type="text" id="fieldID" />
</div> 
```

验证后（如果出现错误）：

```
<div class="formLine formError">
<label for="fieldID">Form Label</label>
<input type="text" id="fieldID" />
<span class="errorMessage">Please enter some value</span>
</div> 
```

额外的**跨度**很好，这是通过 ASP.NET 验证控件实现的。我的问题是将**formError**类添加到包含`<div>`.

我很乐意使用 jQuery/DHTML 添加此类，但只是不知道在哪里挂钩。是否可以使用 jQuery 监视 DOM 更改 - 例如，每当添加一个跨度作为子级时触发事件处理程序`<div class="formLine">`?

还有其他人有什么好的建议来解决这个问题吗？

谢谢阅读。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T10:42:58.467

***编辑：澄清后***

您可以编写由 onClick 客户端事件调用的自定义函数。因为您使用的是 ASP.Net 验证控件，所以您应该能够调用函数 ValidatorValidate(val)，其中 val 是验证器。然后，您可以检查验证器 SPAN 标记的内容是否存在验证错误，并相应地更新 div 标记。

注意：我不是客户端验证方面的专家，但这原则上应该有效。

[有关 MSDN 的更多信息。](http://msdn.microsoft.com/en-us/library/aa479045.aspx#aspplusvalid_clientside)

* * *

您需要使用 id 标签将您的 div 声明为 runat="server"，以便您可以在服务器端代码中引用它，然后在页面加载中对 Page.IsValid 进行测试，如果您的验证器之一无法验证，它将返回 false。

然后，您可以以编程方式在您的 div 上设置类属性。就像是：

```
<div class="formLine" id="divForm" runat="server">   
  <label for="fieldID">Form Label</label>   
  <input type="text" id="fieldID" />
</div> 
```

代码隐藏 (VB)

```
If Not Page.IsValid Then
  divForm.Attributes.Remove("class")
  divForm.Attributes.Add("class", "formLine formError")
End If 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T11:00:38.283

我假设您正在寻找一种在客户端执行此操作的方法，而无需回发。

当您在 Web 表单上使用 asp.net 验证控件时，您会注意到对 WebUIValidation.js 的脚本引用呈现在您的页面上。窥视该文件提供了一些有用的信息。该文件中有一个名为 Page_IsValid 的全局变量。每当验证失败时，该变量都会设置为 false。

编辑：WebUIValidation.js 脚本参考早于 .net 2.0，因此您无法再查看该文件。但是，Page_IsValid 变量仍然存在，可以通过挂钩到表单提交处理程序来使用。像这样的东西

```
// verified that this works
$(document).ready(function() {
    $('#form1').bind('submit', function(e) {
        if (!Page_IsValid)
            $('#yourDiv').addClass('error');
    });
}); 
```

# c# - 使用 HashTable 验证 dataTable 的每一列

> ID：569056
> 
> 赞同：0
> 
> 时间：2009-02-20T10:34:14.993
> 
> 标签：c#, .net, dataset

我有一个数据表，其列可以说 col1,col2,col3 现在我想验证每个列的值是否为 0

我不想使用会写很多东西的 if else 子句。

是否有可能使用 HashTable 或其他方法来完成相同的任务？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T10:37:47.027

循环`Columns`并将值为 0 的列存储在 a 中`List<DataColumn>`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T10:39:59.190

您可以为 OnColumnChanged 事件创建一个事件处理程序并检查该值是否不为零。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T11:31:06.743

如果您想知道任何列是否为 0，则：

```
bool haveZero = (col1 == 0) || (col2 == 0) || (col3 == 0) 
```

如果您需要知道是否全部为零，则将 ors 替换为 ands。

如果您试图确定列中的任何值是否为零，则可以使用 LINQ：

bool col1HasZero = myDataTable.AsEnumerable().Rows.Select(r => (int)r.[1]).Any(v => v == 0);

并将 Any(predicate) 替换为 All(predicate) 以查看所有值是否为零。

（针对 LINQ to DataSets 的 System.Data.DataSetExtensions.dll 链接）。

# c# - 有没有办法在 Switch 语句中执行某些代码，只有在任何情况下都通过时才执行？

> ID：569069
> 
> 赞同：2
> 
> 时间：2009-02-20T10:38:59.007
> 
> 标签：c#, switch-statement

有没有一种方法可以为每个“案例”执行相同的代码行，但只需输入一次，而不是为所有案例指定相同的代码？

```
 switch (SomeTest)
        {
            case "test1":
                {
                    // Do something for test 1 
                    break;
                }
            case "test2":
                {
                    // Do something for test 2 
                    break;
                }
            case "test3":
                {
                    // Do something for test 3 
                    break;
                }
            // =====> Then do something generic here for example if case is test1, test2 or test3
        } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T10:40:46.583

你是不是想多了？

```
switch(SomeTest)
{
    // specific stuff
}

// code you want running for every case 
```

否则，您可以在不设置标志或其他东西的情况下做的最好的事情是：

```
switch(SomeTest)
{
    // specific stuff
}

switch(SomeTest)
{
    case "Test1", "Test2", "Test3":
        // stuff for the matching cases
} 
```

或者，如果您想为匹配的每个案例运行代码：

```
bool runGenericStuff = true;

switch(SomeTest)
{
    // specific stuff
    default:
        runGenericStuff = false;
}

if (runGenericStuff)
{
    // run generic stuff
} 
```

这样您就不必在每种情况下都设置标志。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T10:43:36.953

将通用逻辑放在单独的方法中，并在需要它的每个案例标签上调用它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T10:49:02.803

我会这样做：

```
 bool doSomething = true;

    switch (SomeTest)
    {
        case "test1":
            {
                // Do something for test 1 
                break;
            }
        case "test2":
            {
                // Do something for test 2 
                break;
            }
        case "test3":
            {
                // Do something for test 3 
                break;
            }
        default:
            {
            doSomething = false;
            }
    }

    if (doSomething)
    {
    // your code here
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T10:43:54.517

布尔应该IDoSomething = false；

```
 switch (SomeTest)
    {
        case "test1":
            {
                // Do something for test 1 
                ShouldIDoSomething=true;
                break;
            }
        case "test2":
            {
                // Do something for test 2 
                ShouldIDoSomething=true;
                break;
            }
        case "test3":
            {
                // Do something for test 3 
                ShouldIDoSomething=true;
                break;
            }
        // =====> Then do something generic here for example if case is test1, test2 or test3

    } 
```

if(ShouldIDoSomething) DoSomething 通用

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T10:48:50.870

对此没有特殊的语法支持。您可以通过执行以下操作来获得效果：

```
public static void DoSomething(string testValue)
{
    bool hasMatch = true;
    switch(testValue)
    {
        case "Test1":
            WL("Test1");
            break;
        case "Test2":
            WL("Test2");
            break;
        case "Test3":
            WL("Test3");
            break;
        default:
            WL("No match.");
            hasMatch = false;
            break;
    }
    if (hasMatch)
    {
        WL("Match found.");
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T10:40:45.587

默认情况下，C# 的开关不会进入下一个案例（与 C/C++ 不同），但您可以转到另一个案例。

```
Debug.Assert(value != 99);
switch (value) {
  case 1:
    DoSomething();
    goto case 99;
  case 2:
    DoSomethingElse():
    goto case 99:
  case 3:
    DoNothingHere();
    break;

  case 99:
    // A case that will never be directly called.
    DoSomethingInCommon();
    break;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T14:02:44.587

稍微简单一点

```
switch(x) {
  case Foo:
    // your normal cases here
    break;
  default: 
    // post-processing NOT covered by normal cases
    return;  
}
// post-processing if any of the cases were handled 
```

# c++ - 模板类值的 C++ std::map

> ID：569073
> 
> 赞同：18
> 
> 时间：2009-02-20T10:40:20.877
> 
> 标签：c++, templates, methods, stdmap

我正在尝试声明一个`Row`和一个`Column`类，其中`Row`有一个私有`std::map`值指向一个模板`Column`。像这样的东西：

```
template <typename T> class DataType {
  private:
    T type;
};
template <typename T> class Field {
  private:
    T value;
    DataType<T> type;
};
class Row {
  private:
    std::map<unsigned long,Field*> column;
}; 
```

好吧，我想原则上这个类不应该知道我们想使用`Row`哪种`Field`（或），即它是第1 列中的 a 还是第2 列中的 a 。但我不确定什么是正确的语法对于声明，或者如果在这个意义上是有限的，我应该使用别的东西。`Column``Field<int>``Field<double>``Row::column``std::map`

我感谢您的建议，并提前感谢您的建议。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-20T10:58:24.780

`Field`单独不是一个类型，而是一个模板，它可以生成一系列类型，例如`Field<int>`和`Field<double>`。所有这些领域都不相关，以至于一个领域以某种方式从另一个领域派生而来。所以你必须在所有这些生成的类型之间建立某种关系。一种方法是使用通用的非模板基类：

```
class FieldBase { };

template <typename T>
class Field : public FieldBase {
  private:
    T value;
    DataType<T> type;
};
class Row {
  private:
    std::map<unsigned long,FieldBase*> column;
}; 
```

并考虑在代码中使用智能指针而不是原始指针。无论如何，现在的问题是类型信息丢失了 - 无论您指向 a`Field<double>`还是指向 a`Field<int>`都不再知道，只能通过在模板派生类设置的基础中保留某种类型标志来检测- 或通过询问 RTTI 使用

```
dynamic_cast<Field<int>*>(field) != 0 
```

但这很丑陋。特别是因为你想要的是一个值语义。即，您希望能够复制您的行，并且它会复制其中的所有字段。并且您希望在存储双精度时获得双精度 - 无需先使用 RTTI 破解您的派生类型。

一种方法是使用有区别的联合。这基本上是一些任意类型的联合，此外还有一个类型标志，它存储当前存储在该字段中的值（例如，是否为双精度、整数、...）。例如：

```
template <typename T>
class Field {
  private:
    T value;
    DataType<T> type;
};
class Row {
  private:
    std::map<unsigned long, 
             boost::variant< Field<int>, Field<double> > > 
      column;
}; 
```

boost::variant 为您完成所有工作。您可以使用访问使其使用正确的重载调用函子。看看它的[说明书](http://www.boost.org/doc/libs/1_38_0/doc/html/variant.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T10:49:09.340

1.  你有一个错误：你必须在字段中“值”成员（一个可能应该是“类型”）。
2.  请不要在地图的值中保留原始指针。使用[boost::shared_ptr](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/shared_ptr.htm)。
3.  此外，您应该有充分的理由编写这样的类，其中已经有大量您可以使用的 DB/表处理代码。因此，如果适用，请考虑使用现有的东西，而不是编写自己的表格处理代码。

现在，回答您的问题 :)，Field<> 类可以继承自所有数据类型共享的公共基类。这样，诸如列映射之类的容器可以保留指向模板类实例化的派生对象的指针（使**共享指针成为共享指针）。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T13:24:30.497

A`Row< int, float, int>`与 a 确实不同`Row<int, std::string>`。显然，`Row<int,float,int>.field<0>`应该是`Field<int>` 一阵子`Row<int,float,int>.field<1>`应该是一个`Field<float>`。并且 `Row<int,float,int>.field<3>`是编译器错误。

最简单的方法是使用 Boost。Loki 开创了很多智能（请参阅[Andrei Alexandrescu 的](http://en.wikipedia.org/wiki/Special:BookSources/9780201704310#Online_text)[*Modern C++ Design*](http://en.wikipedia.org/wiki/Special:BookSources/9780201704310#Online_text)），但[Boost](http://www.boost.org/)更现代且得到更好的支持。

通常，您不会遍历字段 - 每个字段都有自己的类型。但是，您确实需要一个`FieldBase`. `boost::array<FieldBase, N>`如果您需要这样的接口，那么在内部将字段存储为 a （即`Row<int,float,int>`有 a ）可能也是值得的`boost::array<FieldBase, 3>`。不过，您永远不需`dynamic_cast`要这样做`FieldBase*`。那是一个运行时测试，您总是在编译时知道`T`每个测试的确切内容。`Field<T>`

# asp.net - 创建皮肤菜单的方法是什么？

> ID：569082
> 
> 赞同：0
> 
> 时间：2009-02-20T10:42:33.507
> 
> 标签：asp.net, css

我想为 ASP 默认菜单开发自定义皮肤或 CSS。

我希望我的菜单看起来像可以购买的自定义控件，例如[Telerik 的 Rad](http://www.telerik.com/products/aspnet-ajax.aspx)。

如果尝试用谷歌搜索 ASP 菜单的 CSS 属性，但只找到了一些公开属性。非常感谢这里的一些帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T14:45:41.910

我认为这是一个 CSS 标记 + 图形设计的问题。
参见简单的 css 教程：
[使用 CSS 创建导航菜单](http://www.justskins.com/css-designs/creating-navigation-menus-with-css/480)
现在，设计视频：
[如何在 Photoshop 中创建 web 2.0 菜单栏](http://www.wonderhowto.com/how-to/video/how-to-create-a-web-2-0-menu-bar-in-photoshop-242144/)
深度设计教程：
[Tutzor web 2.0 风格设计](http://www.tutzor.com/index.php/2008/05/tutzor-web-20-style-re-design/)

现在，谈论 ASP.NET + CSS，试试[ASP.NET 2.0 CSS Friendly Control Adapters](http://www.asp.net/CSSAdapters/WalkThru/WalkThrough.aspx)

# .net - 从 VB.Net 应用程序插入具有 40 列的新记录的最佳方法

> ID：569094
> 
> 赞同：0
> 
> 时间：2009-02-20T10:46:43.357
> 
> 标签：.net, sql-server, database

我的一位同事正在开发一个 .NET 应用程序。他需要为他的对象编写保存函数。

通常他会使用 SQL Server 中的存储过程来执行此操作，但使用 40 列是一项艰巨的任务。

我们的其他几位同事更喜欢使用 XSD 进行数据库交互。

在处理大型记录时，什么是最大努力、可维护性和效率的权衡？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T15:34:02.683

一种对我有用的方法是创建一个带有一个参数的存储过程 - 一个 xml 字符串。然后，您可以使用内置 sql 工具来 xpath 到字符串中的数据，或者只是将其解析出来。

假设您的 xml 如下所示：

```
<data>
<col1 value="myVal">
<col2 value="myVal2">
<col3 value="myVal3">
</data> 
```

你的 sproc 看起来像这样：

```
Create Procedure InsertData @xml xml
as

DECLARE @hDoc int
--Prepare input values as an XML documnet
exec sp_xml_preparedocument @hDoc OUTPUT, @xml

Insert Into MyTable(col1,col2,col3)
select col1,col2,col3
from OPENXML(@hdoc,'/data/')
WITH (col1 varchar(100) '/data/col1/@value', col2 varchar(100) '/data/col2/@value', col3 varchar(100) '/data/col3/@value')
EXEC sp_xml_removedocument @hDoc

GO 
```

您可以在此处看到更多信息： [http ://technet.microsoft.com/en-us/library/ms187897.aspx](http://technet.microsoft.com/en-us/library/ms187897.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T10:49:52.833

XSD 不影响 app 和 db 之间的通信。你用什么与db进行通信？数据适配器？您应该在命令中使用参数作为值。然后您可以使用直接表访问或存储过程。直接表访问速度更快，但 SP（通常）更可靠。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T11:55:50.227

我怀疑你在这里使用 ado.net。

如果您这样做，您必须使用 SqlCommandBuilder 来自动创建插入、更新和删除语句的惰性选项。SqlCommandBuilder 检查一个 SqlDataAdapter，该 SqlDataAdapter 设置有从单个表中选择的单个查询。查询甚至可以是一个选择 *

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-23T16:55:15.147

这是那些没有真正答案的问题之一。

这取决于您当时想要达到的目标。

我通常会使用存储过程，因为我可以编写更少的代码行，并且我可以调整存储过程而无需重新构建或重新部署任何东西。如果我需要添加新字段，那么显然需要额外的代码。

如果速度成为一个问题，我可以探索更复杂的解决方案。

我喜欢 Brendan 提出的使用 XML 的建议，但是我认为我们可能会做很多工作来避免创建太多参数。我可以看到这将是处理我们达到某个极限之王的情况的一种非常好的方法。

# wpf - 如何让 StackPanel 的孩子向下填充最大空间？

> ID：569095
> 
> 赞同：393
> 
> 时间：2009-02-20T10:47:24.430
> 
> 标签：wpf, xaml, autolayout, autoresize, dockpanel

我只想要左边的流动文本，右边的帮助框。

帮助框应该一直延伸到底部。

如果你把`StackPanel`下面的外层拿出来，效果很好。

但是出于布局的原因（我正在动态插入 UserControls），我需要将`StackPanel`.

如您所见，我如何使`GroupBox`向下延伸到底部，我已经尝试过：`StackPanel`

*   `VerticalAlignment="Stretch"`
*   `VerticalContentAlignment="Stretch"`
*   `Height="Auto"`

XAML：

```
<Window x:Class="TestDynamic033.Test3"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Test3" Height="300" Width="600">
    <StackPanel 
        VerticalAlignment="Stretch" 
        Height="Auto">

        <DockPanel 
            HorizontalAlignment="Stretch" 
            VerticalAlignment="Stretch" 
            Height="Auto" 
            Margin="10">

            <GroupBox 
                DockPanel.Dock="Right" 
                Header="Help" 
                Width="100" 
                Background="Beige" 
                VerticalAlignment="Stretch" 
                VerticalContentAlignment="Stretch" 
                Height="Auto">
                <TextBlock Text="This is the help that is available on the news screen." TextWrapping="Wrap" />
            </GroupBox>

            <StackPanel DockPanel.Dock="Left" Margin="10" Width="Auto" HorizontalAlignment="Stretch">
                <TextBlock Text="Here is the news that should wrap around." TextWrapping="Wrap"/>
            </StackPanel>

        </DockPanel>
    </StackPanel>
</Window> 
```

## 回答：

谢谢马克，使用`DockPanel`而不是`StackPanel`清理它。一般来说，我发现自己`DockPanel`现在越来越多地使用 WPF 布局，这是固定的 XAML：

```
<Window x:Class="TestDynamic033.Test3"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Test3" Height="300" Width="600" MinWidth="500" MinHeight="200">
    <DockPanel 
        VerticalAlignment="Stretch" 
        Height="Auto">

        <DockPanel 
            HorizontalAlignment="Stretch" 
            VerticalAlignment="Stretch" 
            Height="Auto" 
            MinWidth="400"
            Margin="10">

            <GroupBox 
                DockPanel.Dock="Right" 
                Header="Help" 
                Width="100" 
                VerticalAlignment="Stretch" 
                VerticalContentAlignment="Stretch" 
                Height="Auto">
                <Border CornerRadius="3" Background="Beige">
                    <TextBlock Text="This is the help that is available on the news screen." TextWrapping="Wrap" 

                Padding="5"/>
                </Border>
            </GroupBox>

            <StackPanel DockPanel.Dock="Left" Margin="10" Width="Auto" HorizontalAlignment="Stretch">
                <TextBlock Text="Here is the news that should wrap around." TextWrapping="Wrap"/>
            </StackPanel>

        </DockPanel>
    </DockPanel>
</Window> 
```

* * *

## 回答 #1

> 赞同：375
> 
> 时间：2009-02-20T11:25:07.600

听起来你想要一个`StackPanel`最终元素用完所有剩余空间的地方。但为什么不使用 a `DockPanel`？用装饰其他元素`DockPanel`，`DockPanel.Dock="Top"`然后你的帮助控件可以填充剩余空间。

XAML：

```
<DockPanel Width="200" Height="200" Background="PowderBlue">
    <TextBlock DockPanel.Dock="Top">Something</TextBlock>
    <TextBlock DockPanel.Dock="Top">Something else</TextBlock>
    <DockPanel
        HorizontalAlignment="Stretch" 
        VerticalAlignment="Stretch" 
        Height="Auto" 
        Margin="10">

      <GroupBox 
        DockPanel.Dock="Right" 
        Header="Help" 
        Width="100" 
        Background="Beige" 
        VerticalAlignment="Stretch" 
        VerticalContentAlignment="Stretch" 
        Height="Auto">
        <TextBlock Text="This is the help that is available on the news screen." 
                   TextWrapping="Wrap" />
     </GroupBox>

      <StackPanel DockPanel.Dock="Left" Margin="10" 
           Width="Auto" HorizontalAlignment="Stretch">
          <TextBlock Text="Here is the news that should wrap around." 
                     TextWrapping="Wrap"/>
      </StackPanel>
    </DockPanel>
</DockPanel> 
```

如果您在一个没有`DockPanel`可用的平台上（例如 WindowsStore），您可以使用网格创建相同的效果。这是上面使用网格完成的示例：

```
<Grid Width="200" Height="200" Background="PowderBlue">
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
    </Grid.RowDefinitions>
    <StackPanel Grid.Row="0">
        <TextBlock>Something</TextBlock>
        <TextBlock>Something else</TextBlock>
    </StackPanel>
    <Grid Height="Auto" Grid.Row="1" Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="100"/>
        </Grid.ColumnDefinitions>
        <GroupBox
            Width="100"
            Height="Auto"
            Grid.Column="1"
            Background="Beige"
            Header="Help">
            <TextBlock Text="This is the help that is available on the news screen." 
              TextWrapping="Wrap"/>
        </GroupBox>
        <StackPanel Width="Auto" Margin="10" DockPanel.Dock="Left">
            <TextBlock Text="Here is the news that should wrap around." 
              TextWrapping="Wrap"/>
        </StackPanel>
    </Grid>
</Grid> 
```

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2009-02-20T11:44:52.843

发生这种情况的原因是因为堆栈面板测量每个具有正无穷大的子元素作为它正在堆叠元素的轴的约束。子控件必须返回它们想要的大小（正无穷大不是来自任一轴的[MeasureOverride](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.measureoverride.aspx)的有效返回），因此它们返回适合所有内容的最小尺寸。他们无法知道他们真正需要填补多少空间。

如果您的视图不需要具有滚动功能并且上面的答案不适合您的需求，我建议您实现自己的面板。您可能可以直接从 StackPanel 派生，然后您需要做的就是更改[ArrangeOverride](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.arrangeoverride.aspx)方法，以便它在其子元素之间划分剩余空间（给它们每个相同数量的额外空间）。如果给元素的空间比他们想要的多，它们应该渲染得很好，但是如果你给它们的空间少，你就会开始看到故障。

如果您希望能够滚动整个内容，那么恐怕事情会变得更加困难，因为 ScrollViewer 为您提供了无限的工作空间，这将使您处于与子元素相同的位置起初。在这种情况下，您可能希望在新面板上创建一个新属性，用于指定视口大小，您应该能够将其绑定到 ScrollViewer 的大小。理想情况下，您将实现[IScrollInfo](http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.iscrollinfo.aspx)，但如果您要正确实现所有它，那将开始变得复杂。

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2009-02-20T17:30:40.937

另一种方法是使用具有一列和*n*行的 Grid。将所有行高设置为`Auto`，将最底部的行高设置为`1*`。

我更喜欢这种方法，因为我发现 Grids 比 DockPanels、StackPanels 和 WrapPanels 具有更好的布局性能。但是，除非您在 ItemTemplate 中使用它们（对大量项目执行布局），否则您可能永远不会注意到。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2016-03-10T21:16:15.100

您可以使用[SpicyTaco.AutoGrid](https://github.com/kmcginnes/SpicyTaco.AutoGrid) - 的修改版本`StackPanel`：

```
<st:StackPanel Orientation="Horizontal" MarginBetweenChildren="10" Margin="10">
   <Button Content="Info" HorizontalAlignment="Left" st:StackPanel.Fill="Fill"/>
   <Button Content="Cancel"/>
   <Button Content="Save"/>
</st:StackPanel> 
```

第一个按钮将被填充。

您可以通过 NuGet 安装它：

```
Install-Package SpicyTaco.AutoGrid 
```

我建议看看[SpicyTaco.AutoGrid](https://github.com/kmcginnes/SpicyTaco.AutoGrid)。它对于 WPF 中的表单而不是 非常有用`DockPanel`， `StackPanel`并且`Grid`可以非常轻松优雅地解决拉伸问题。只需查看 GitHub 上的自述文件。

```
<st:AutoGrid Columns="160,*" ChildMargin="3">
    <Label Content="Name:"/>
    <TextBox/>

    <Label Content="E-Mail:"/>
    <TextBox/>

    <Label Content="Comment:"/>
    <TextBox/>
</st:AutoGrid> 
```

# user-interface - 何时使用微调器与表单对象

> ID：569098
> 
> 赞同：1
> 
> 时间：2009-02-20T10:48:09.827
> 
> 标签：user-interface, forms, textbox, spinner

什么时候适合使用[微调器](http://en.wikipedia.org/wiki/Spinner_(computing))对象，而不是使用标准[文本输入](http://en.wikipedia.org/wiki/Text_box)对象（又名表单或文本框）？

我正在寻找有关 GUI 中“最佳实践”的信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T10:49:32.040

我在想，微调器对象应该只用在可以上下单击小的增量值的地方，例如像打印作业的份数这样的小数字。

# .net - 为什么 Char.MinVal / .MaxVal 不是静态的？

> ID：569109
> 
> 赞同：2
> 
> 时间：2009-02-20T10:51:13.703
> 
> 标签：.net, char

```
public struct Char
{
 public const char MaxValue = (char)0xffff;
 public const char MinValue = '\0';
} 
```

为什么不将这些字段设为静态？为什么它总是为每个字符分配额外的内存，而这两个值是永久的？

**编辑**：我不知道我怎么能隐含地忘记静态！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T10:52:24.590

const 字段是隐式静态的。从规范的第 10.4 节：

> 即使常量被认为是静态成员，*常量声明* 既不需要也不允许*静态* 修饰符。同一修饰符在常量声明中多次出现是错误的。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-20T10:53:23.450

因为它们是静态的。

常量字段是隐式静态的。

# c++ - 为什么调用 std::map::clear() 后内存仍然可以访问？

> ID：569110
> 
> 赞同：20
> 
> 时间：2009-02-20T10:51:35.577
> 
> 标签：c++, stdmap

我正在观察 std::map::clear() 的奇怪行为。此方法应该在调用时调用元素的析构函数，但是在调用 clear() 后仍然可以访问内存。

例如：

```
struct A
{
  ~A() { x = 0; }
  int x;
};

int main( void )
{
  std::map< int, A * > my_map;
  A *a = new A();
  a->x = 5;
  my_map.insert( std::make_pair< int, *A >( 0, a ) );

  // addresses will be the same, will print 5
  std::cout << a << " " << my_map[0] << " " << my_map[0]->x << std::endl;

  my_map.clear();

  // will be 0
  std::cout << a->x << std::endl;

  return 0;
} 
```

问题是，为什么变量`a`在 map::clear() 调用其析构函数后仍然可以访问？`delete a;`调用后我需要写`my_map.clear()`还是覆盖内容是否安全`a`？

提前感谢您的帮助，斯内格

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-20T10:53:24.197

如果您将指针存储在地图（或列表或类似的东西）上，**您**有责任删除指针，因为地图不知道它们是否是用新创建的。如果您不使用指针，则 clear 函数仅调用析构函数。

哦，还有一件事：调用析构函数（甚至调用删除）并不意味着不能再访问内存。这仅意味着如果您这样做，您将访问垃圾。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-20T11:07:07.240

std::map 不管理指针值指向的内存 - 由您自己完成。如果您不想使用智能指针，您可以编写一个通用的 free & clear 函数，如下所示：

```
template <typename M> void FreeClear( M & amap ) 
    for ( typename M::iterator it = amap.begin(); it != amap.end(); ++it ) {
        delete it->second;
    }
    amap.clear();
} 
```

并使用它：

```
std::map< int, A * > my_map;
// populate
FreeClear( my_map ) 
```

;

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T10:56:14.923

那是因为`map.clear()`调用映射中包含的数据的析构函数，在你的情况下，指向`a`. 而这无济于事。

您可能希望在映射中放置某种[智能指针](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/smart_ptr.htm)`a`，以便自动回收所占用的内存。

顺便说一句，你为什么把模板参数放在调用中`make_pair`？模板参数推导在这里应该做得很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T11:09:03.973

当您释放一块堆内存时，其内容不会归零。它们仅可用于再次分配。当然你应该考虑内存不可访问，因为访问未分配内存的影响是不确定的。

实际上阻​​止对内存页面的访问发生在较低级别，而标准库不会这样做。

当你用new分配内存时，你需要自己删除它，除非你使用智能指针。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T11:18:17.103

任何容器都存储您的对象类型并调用相应的构造函数：每个节点的内部代码可能类似于：

```
__NodePtr
{
    *next;
    __Ty    Val;
} 
```

当你分配它时，它是通过基于类型构造 val 然后链接来实现的。类似于：

```
_Ty _Val = _Ty();
_Myhead = _Buynode();
_Construct_n(_Count, _Val); 
```

当您删除它时，它会调用相应的析构函数。

当您存储引用（指针）时，它不会调用任何构造函数，也不会破坏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-08T19:07:16.757

在过去 2 个月的饮食、睡眠和呼吸图上度过，我有一个建议。尽可能让地图分配它自己的数据。由于您在此处强调的原因，它更清洁了。

还有一些微妙的优势，例如如果您将数据从文件或套接字复制到地图的数据，只要节点存在，数据存储就会存在，因为当地图调用 malloc() 分配节点时，它会分配内存对于密钥和数据。（又名 map[key].first 和 map[key].second）

这允许您使用赋值运算符而不是 memcpy()，并且需要对 malloc() 的调用减少 1 次 - 您所做的调用。

```
IC_CDR CDR, *pThisCDRLeafData;  // a large struct{}

    while(1 == fread(CDR, sizeof(CDR), 1, fp))  {
    if(feof(fp)) {
        printf("\nfread() failure in %s at line %i", __FILE__, __LINE__);
    }
    cdrMap[CDR.iGUID] = CDR; // no need for a malloc() and memcpy() here    
    pThisCDRLeafData  = &cdrMap[CDR.iGUID]; // pointer to tree node's data 
```

需要注意的一些注意事项值得在这里指出。

1.  不要在添加树节点的代码行中调用 malloc() 或 new，因为您对 malloc() 的调用将返回一个指针，然后地图对 malloc() 的调用已分配一个位置来保存 malloc() 的返回.
2.  在调试模式下，尝试释放（）你的内存时会遇到类似的问题。这两个对我来说似乎都是编译器问题，但至少在 MSVC 2012 中，它们存在并且是一个严重的问题。
3.  考虑一下在哪里“锚定”您的地图。IE：声明它们的地方。您不希望它们错误地超出范围。main{} 始终是安全的。

    ```
    INT _tmain(INT argc, char* argv[])    {
    IC_CDR      CDR, *pThisCDRLeafData=NULL;
    CDR_MAP     cdrMap;
    CUST_MAP    custMap;
    KCI_MAP     kciMap; 
    ```

4.  我很幸运，很高兴有一个关键映射分配一个结构作为节点数据，并让该结构“锚定”一个映射。虽然 C++ 已经放弃了匿名结构（一个必须撤销的可怕决定），但作为第一个结构成员的映射就像匿名结构一样工作。非常光滑和干净，尺寸效应为零。在函数调用中传递指向叶拥有的结构的指针，或按值传递结构的副本，两者都工作得很好。强烈推荐。

5.  您可以捕获 .insert 的返回值，以确定它是否在该键上找到了现有节点，或者创建了一个新节点。（代码见#12）使用下标表示法不允许这样做。选择 .insert 并坚持下去可能会更好，特别是因为 [] 符号不适用于多图。（这样做是没有意义的，因为没有“a”键，而是多重映射中具有相同值的一系列键）
6.  您可以而且应该捕获 .erase 和 .empty() 的返回值（是的，有些东西是函数，需要 () 而有些，比如 .erase，则不需要）
7.  您可以使用 .first 和 .second 获取任何映射节点的键值和数据值，按照惯例，所有映射都使用它们分别返回键和数据
8.  为自己节省大量的混乱和打字，并为您的地图使用 typedef，就像这样。

    ```
    typedef map<ULLNG, IC_CDR>      CDR_MAP;    
    typedef map<ULLNG, pIC_CDR>     CALL_MAP;   
    typedef struct {
        CALL_MAP    callMap;
        ULNG        Knt;         
        DBL         BurnRateSec; 
        DBL         DeciCents;   
        ULLNG       tThen;       
        DBL         OldKCIKey;   
    } CUST_SUM, *pCUST_SUM;
    typedef map<ULNG,CUST_SUM>  CUST_MAP, CUST_MAP;  
    typedef map<DBL,pCUST_SUM>  KCI_MAP; 
    ```

9.  使用 typedef 和 & 运算符传递对映射的引用，如

    `ULNG DestroyCustomer_callMap(CUST_SUM Summary, CDR_MAP& cdrMap, KCI_MAP& kciMap)`

10.  对迭代器使用“auto”变量类型。编译器将从 for() 循环体的其余部分中指定的类型确定要使用哪种映射 typedef。它是如此的干净，几乎是魔法！

    `for(auto itr = Summary.callMap.begin(); itr!= Summary.callMap.end(); ++itr) {`

11.  定义一些清单常量以使 .erase 和 .empty() 的返回更有意义。

    `if(ERASE_SUCCESSFUL == cdrMap.erase (itr->second->iGUID)) {`

12.  鉴于“智能指针”实际上只是保持引用计数，请记住，您始终可以保持自己的引用计数，这可能以一种更清晰、更明显的方式。将它与上面的#5 和#10 结合起来，您可以编写一些像这样的漂亮干净的代码。

    ```
    #define Pear(x,y) std::make_pair(x,y) //  some macro magic

    auto res = pSumStruct->callMap.insert(Pear(pCDR->iGUID,pCDR));
    if ( ! res.second ) {
        pCDR->RefKnt=2;
    } else {
        pCDR->RefKnt=1;
        pSumStruct->Knt += 1;
    } 
    ```

13.  使用指针挂在为自己分配所有内容的映射节点上，IE：没有指向用户 malloc()ed 对象的用户指针，运行良好，可能更有效，并且可用于改变节点的数据而没有副作用在我的经验中。

14.  在同一主题上，可以非常有效地使用这样的指针来保存节点的状态，`pThisCDRLeafData`如上所示。将其传递给改变/更改特定节点数据的函数比传递对映射的引用更干净，并且返回节点所需的键`pThisCDRLeafData`指向。

15.  迭代器不是魔术。当您在地图上导航以获取值时，它们既昂贵又缓慢。对于包含一百万个值的映射，您可以每秒大约 2000 万次基于键读取节点。使用迭代器可能会慢 1000 倍。

我认为现在涵盖了它。如果有任何变化或有其他见解要分享，将会更新。我特别喜欢将 STL 与 C 代码一起使用。IE：在任何地方都看不到一堂课。它们只是在我工作的环境中没有意义，这不是问题。祝你好运。

# .net - .NET 配置文件 configSource 在应用程序目录文件夹之外

> ID：569117
> 
> 赞同：86
> 
> 时间：2009-02-20T10:54:37.753
> 
> 标签：.net, configuration

我有两个应用程序，一个是控制台应用程序，另一个是 ASP.NET 应用程序。他们都需要知道相同的 appSettings 和 connectionStrings。所以理想情况下，我想使用 app.config/web.config 文件的 configSource 属性将其指向一个中心位置。例如

```
<connectionStrings configSource="D:\connectionStrings.config"/>
<appSettings configSource="D:\appSettings.config"/> 
```

然而，这失败并出现错误：

> configSource 属性无效。: configSource 'D:\appSettings.config' 无效。它必须引用与配置文件相同目录或子目录中的文件。

无论如何仍然使用配置管理器 appSettings/connectionStrings 并从外部位置获取值？
我很高兴不得不添加代码来做到这一点，但我不想更换整个配置管理器系统。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-03-28T22:56:36.623

另一种解决方案是简单地将配置文件作为链接添加到所有项目中，而不是将文件实际复制到项目中。然后将文件的“构建操作”设置为“内容”，将“复制到输出目录”设置为“如果较新则复制”，当您编译项目时，您将在输出目录中拥有该文件。

要将文件添加为“添加现有项目”对话框中的链接，有一个带有下拉列表的添加按钮。从“添加”按钮的下拉列表中选择“添加为链接”以完成该过程。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-12-02T17:01:06.563

在 appSettings 下，您可以使用 file= 而不是 configSource=

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-20T11:03:33.690

似乎就是这样。configSource 必须位于同一文件夹或更深的文件夹中。

尽管我不确定您是否*应该*使用 NTFS 硬链接，但您*可以。*[疯狂的笑容]

 ** * *

## 回答 #4

> 赞同：10
> 
> 时间：2016-07-16T07:25:42.550

**视觉工作室 2015**

如果您在使用 Web.Config 时遇到此问题，则接受的答案是正确的，但只是为了扩展，因为这让我给了自己一个面子：

当您使用“添加为链接”将 .config 文件添加到项目中，然后将链接的复制属性设置为“如果较新时复制”或“始终复制”，则物理文件将被复制到 /bin 文件夹。

因此，当您在 Web.Config 中定义了一个配置部分时，如下所示：

```
 <section name="mySpecialConfig" type="System.Configuration.AppSettingsSection" requirePermission="false" /> 
```

那么你必须像这样定义相关的配置元素：

```
 <mySpecialConfig configSource="bin\MySpecialConfig.config">
  </mySpecialConfig> 
```

这样 configSource 指向物理 bin\MySpecialConfig.config 文件**而不是链接** 另外，请注意路径是**相对**物理路径。

这可能看起来非常明显，但如果您在物理文件还没有在 \bin 文件夹中之前没有这样做，那么它可能不会立即单击。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-20T11:01:43.210

您可以从任意位置加载配置，*但*不能通过 ConfigurationManager 的静态属性获得：

```
Configuration myConfig = ConfigurationManager.OpenExeConfiguration(path) 
```

（有一个允许指定多个文件的重载，以支持默认/用户漫游/用户本地层次结构。）

丢失静态属性意味着所有代码都需要了解不同的配置。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-08-29T20:21:07.087

在连接字符串的情况下，确实可以指向共享文件。如果共享文件位于网络 UNC 上，则需要在托管应用程序的计算机上具有管理权限。

解决方案：在您的 web.config 中，使用 configSource 指向本地配置文件。由于 .Net 的限制，这必须处于或低于根配置文件的级别。我只是指向 app 文件夹本身的一个文件：

```
<connectionStrings configSource="ConnectionStrings.config" /> 
```

在应用程序池用户可访问的共享位置中，添加包含共享连接字符串的配置文件。此文件不得包含除 connectionStrings 部分本身之外的任何 xml。共享文件 ConnectionStrings.config 如下所示：

```
<connectionStrings>
    <clear/>
    <add name="connString1" connectionString="connString1 info goes here"/>
    <add name="connString2" connectionString="connString2 info goes here"/>
</connectionStrings> 
```

现在的诀窍。在您的应用文件夹中创建一个指向外部共享配置文件的 Windows 符号链接。您需要管理员权限才能执行此操作：

```
mklink ConnectionStrings.config \\someServer\someShare\someFolder\ConnectionStrings.config 
```

我们刚刚超越了 .Net。配置系统将使用 configSource 设置在名为 ConnectionStrings.config 的本地文件中查找连接字符串。符号链接看起来像 .Net 的文件，符号链接解析为共享配置文件。

注意事项：对共享文件的更改不会自动触发 .Net 中的应用程序重启。对于 IIS，需要手动重新启动网站或应用程序池。

由于需要管理权限来创建符号链接，这种方法可能不适用于所有人。如果共享文件位于同一逻辑驱动器上，则有两种相关的替代方案可能有效 - 硬链接和连接。有关更多信息，请参阅[此讨论](https://security.stackexchange.com/questions/10194/why-do-you-have-to-be-an-admin-to-create-a-symlink-in-windows)和[此讨论](https://social.technet.microsoft.com/Forums/windows/en-US/96813c92-5476-44d3-bdb9-d46fc7f4c901/symlinks-vs-junction-points-vs-hard-links?forum=w7itprogeneral)。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-20T11:01:39.187

您可以将这两个设置放在[machine.config](http://msdn.microsoft.com/en-us/library/ms229697(VS.71).aspx)中，然后它们可用于服务器上的所有应用程序。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-11T11:02:14.953

我发现效果最好的解决方案是将“共享”配置文件放在中央文件中，然后使用 Visual Studio 中的预构建事件将它们复制到每个需要它的项目的相对文件夹中。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-07-27T12:43:39.040

我在这个问题上遇到了很大的困难，但我在这里找到了一个很好的解决方案：[使用外部配置测试运行](https://stackoverflow.com/questions/152866/how-can-you-use-external-configuration-files-i-e-with-configsource-with-an-m "使用外部配置测试运行")

（您可以通过编辑 .testrunco​​nfig 文件来指示测试运行将文件和目录复制到测试运行目录中。）

虽然为什么单元测试类型的项目可以从它自己的 app.config 中获取配置设置，但不能像普通的 app.config 那样加载引用的配置文件，这让我有点困惑。我将其称为错误，因为您希望测试项目 app.config 的行为方式与应用程序的 app.config 行为方式相同，但事实并非如此。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-08-01T19:18:34.717

您可以使用`file`属性而不是`configSource`

[这里](https://bhrnjica.net/2016/01/30/using-external-config-files-in-net-applications/)有一篇很好的文章

这允许您像这样指定相对路径

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <appSettings file="..\..\..\..\..\..\ExternalFile.config"></appSettings>
</configuration> 
```

该路径是相对于输出目录的。

然后在 ExternalFile.config 中，您只需添加该`appSettings`部分

```
<appSettings>
    <add key="SomeKey" value="alue"/>
</appSettings> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-10-26T00:53:29.693

如果您有多个项目需要共享相同的连接字符串，请将要在不同项目之间共享的连接字符串配置文件放在类库项目中。然后从需要使用连接字符串的项目中，执行以下操作：

1.  如果是控制台项目或单元测试项目：

在控制台或单元测试项目中，在 app.config 中执行此操作：`<connectionStrings configSource="connectionString.config"/>`

就是这样。

为什么根本不需要链接？答：当您构建项目时，connectionString.config 会被复制到输出文件夹。其他项目的 app.config 文件也被复制到输出文件夹。因此，当您运行启动项目时，启动项目的 app.config 与 connectionString.config 位于同一文件夹中。这就是为什么不需要链接的原因。

2.  如果是 Web 项目：

在网络配置中这样做： `<connectionStrings configSource="bin\connectionString.config"/>`

请注意，如果将 connectionString.config 文件设置为 Copy If Newer，有时 Visual Studio 2019 不会检测到更改。因此，您可以将其设置为始终复制。

# asp.net - asp:Calendar DateClicked 事件（不仅仅是 SelectionChanged）

> ID：569126
> 
> 赞同：2
> 
> 时间：2009-02-20T10:58:25.310
> 
> 标签：asp.net, user-interface, webforms, calendar

我正在使用标准`asp:Calendar`控件。当用户单击日期时，我通过处理事件显示[模式弹出窗口。](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ModalPopup/ModalPopup.aspx)`SelectionChanged`

然而，这意味着如果用户单击一个日期，然后关闭弹出窗口，然后再次单击相同的日期，则不会发生任何事情。

我宁愿处理一个`DateClick`事件，并完全取消选择日期的概念。

这可以使用`asp:Calendar`?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T11:30:57.477

找到了解决方法：

在`SelectionChanged`事件处理程序中，只需调用

```
calendar.SelectedDates.Clear(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-12-13T11:25:31.977

我有一个类似的问题 - 我通过阻止用户选择当前选择的日期来解决它。我在`DayRender`事件中添加了以下内容：

```
If e.Day.Date = DateValue(calCalendar.SelectedDate) Then
    e.Day.IsSelectable = False
End If 
```

# .net - 在 .NET 中序列化大量对象时出现 SerializationException

> ID：569127
> 
> 赞同：21
> 
> 时间：2009-02-20T10:58:45.823
> 
> 标签：.net, serialization

我在.NET 中序列化大量对象时遇到问题。对象图非常大，使用了一些新数据集，所以我得到：

```
System.Runtime.Serialization.SerializationException
"The internal array cannot expand to greater than Int32.MaxValue elements." 
```

有没有人达到这个极限？你是怎么解决的？

如果可能的话我仍然可以使用内置的序列化机制会很好，但似乎必须自己滚动（并保持与现有数据文件的向后兼容性）

这些对象都是[POCO](http://en.wikipedia.org/wiki/Plain_Old_CLR_Object)并且正在使用`BinaryFormatter`. 每个被序列化的对象都实现`ISerializable`了选择性地序列化其成员（其中一些在加载期间重新计算）。

看起来这对于 MS 来说是一个未解决的问题（[详情请点击此处](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=303278)），但它已作为 Wont Fix 解决。详细信息是（来自链接）：

> 对于超过 1320 万个对象的对象图，二进制序列化失败。这样做的尝试会导致 ObjectIDGenerator.Rehash 中出现异常，并带有引用 Int32.MaxValue 的误导性错误消息。
> 
> 在检查 SSCLI 源代码中的 ObjectIDGenerator.cs 后，似乎可以通过在 size 数组中添加额外的条目来处理更大的对象图。请参阅以下行：
> 
> ```
> // Table of prime numbers to use as hash table sizes. Each entry is the
> // smallest prime number larger than twice the previous entry.
> private static readonly int[] sizes = {5, 11, 29, 47, 97, 197, 397,
> 797, 1597, 3203, 6421, 12853, 25717, 51437, 102877, 205759, 
> 411527, 823117, 1646237, 3292489, 6584983}; 
> ```
> 
> 但是，如果序列化适用于任何合理大小的对象图，那就太好了。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T03:37:03.437

我尝试重现该问题，但即使 13+ 百万个对象中的每一个都只有 2 个字节，代码也需要永远运行。因此，我怀疑如果您在自定义 ISerialize 实现中更好地打包数据，您不仅可以解决问题，还可以显着提高性能。不要让序列化程序深入了解您的结构，而是在您的对象图爆炸成数十万个或更多数组元素时将其切断（因为如果您有那么多对象，它们可能非常小否则你无论如何都无法将它们保存在内存中）。以这个例子为例，它允许序列化程序查看 B 类和 C 类，但手动管理 A 类的集合：

```
class Program
{
    static void Main(string[] args)
    {
        C c = new C(8, 2000000);
        System.Runtime.Serialization.Formatters.Binary.BinaryFormatter bf = new System.Runtime.Serialization.Formatters.Binary.BinaryFormatter();
        System.IO.MemoryStream ms = new System.IO.MemoryStream();
        bf.Serialize(ms, c);
        ms.Seek(0, System.IO.SeekOrigin.Begin);
        for (int i = 0; i < 3; i++)
            for (int j = i; j < i + 3; j++)
                Console.WriteLine("{0}, {1}", c.all[i][j].b1, c.all[i][j].b2);
        Console.WriteLine("=====");
        c = null;
        c = (C)(bf.Deserialize(ms));
        for (int i = 0; i < 3; i++)
            for (int j = i; j < i + 3; j++)
                Console.WriteLine("{0}, {1}", c.all[i][j].b1, c.all[i][j].b2);
        Console.WriteLine("=====");
    }
}

class A
{
    byte dataByte1;
    byte dataByte2;
    public A(byte b1, byte b2)
    {
        dataByte1 = b1;
        dataByte2 = b2;
    }

    public UInt16 GetAllData()
    {
        return (UInt16)((dataByte1 << 8) | dataByte2);
    }

    public A(UInt16 allData)
    {
        dataByte1 = (byte)(allData >> 8);
        dataByte2 = (byte)(allData & 0xff);
    }

    public byte b1
    {
        get
        {
            return dataByte1;
        }
    }

    public byte b2
    {
        get
        {
            return dataByte2;
        }
    }
}

[Serializable()]
class B : System.Runtime.Serialization.ISerializable
{
    string name;
    List<A> myList;

    public B(int size)
    {
        myList = new List<A>(size);

        for (int i = 0; i < size; i++)
        {
            myList.Add(new A((byte)(i % 255), (byte)((i + 1) % 255)));
        }
        name = "List of " + size.ToString();
    }

    public A this[int index]
    {
        get
        {
            return myList[index];
        }
    }

    #region ISerializable Members

    public void GetObjectData(System.Runtime.Serialization.SerializationInfo info, System.Runtime.Serialization.StreamingContext context)
    {
        UInt16[] packed = new UInt16[myList.Count];
        info.AddValue("name", name);
        for (int i = 0; i < myList.Count; i++)
        {
            packed[i] = myList[i].GetAllData();
        }
        info.AddValue("packedData", packed);
    }

    protected B(System.Runtime.Serialization.SerializationInfo info, System.Runtime.Serialization.StreamingContext context)
    {
        name = info.GetString("name");
        UInt16[] packed = (UInt16[])(info.GetValue("packedData", typeof(UInt16[])));
        myList = new List<A>(packed.Length);
        for (int i = 0; i < packed.Length; i++)
            myList.Add(new A(packed[i]));
    }

    #endregion
}

[Serializable()]
class C
{
    public List<B> all;
    public C(int count, int size)
    {
        all = new List<B>(count);
        for (int i = 0; i < count; i++)
        {
            all.Add(new B(size));
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-11-19T12:16:04.857

该问题已在 .NET Core 2.1 中得到修复。我已请求将解决方案反向移植到 .NET Framework 4.8：

[https://github.com/Microsoft/dotnet-framework-early-access/issues/46](https://github.com/Microsoft/dotnet-framework-early-access/issues/46)。

如果您认为问题应该得到解决，您可以发表评论，这对您也很重要。.NET Core 中的修复是重用 Dictionary 中存在的素数生成器也用于 BinaryFormatter。

如果您有这么多对象序列化并且您不想等待 40 分钟来读回它们，请确保将以下内容添加到您的 App.Config 中：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <runtime>
    <!-- Use this switch to make BinaryFormatter fast with large object graphs starting with .NET 4.7.2 -->
      <AppContextSwitchOverrides value="Switch.System.Runtime.Serialization.UseNewMaxArraySize=true" />
  </runtime>
</configuration> 
```

启用最终随 .NET 4.7.2 提供的 BinaryFormatter 反序列化修复。可以在此处找到有关这两个问题的更多信息：

[https://aloiskraus.wordpress.com/2017/04/23/the-definitive-serialization-performance-guide/](https://aloiskraus.wordpress.com/2017/04/23/the-definitive-serialization-performance-guide/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T06:01:50.067

你有没有想过 Int32.MaxValue 是 2,147,483,647 - 超过 20*亿*。

您需要 16GB 的内存*来存储指针*（假设是 64 位机器），更不用说对象本身了。在 32 位机器上只有一半，尽管将 8GB 的​​指针数据压缩到最大 3GB 左右的可用空间中将是一个好技巧。

我强烈怀疑您的问题不是对象的数量，而是序列化框架正在进入某种无限循环，因为您的数据结构中有引用循环。

考虑这个简单的类：

```
public class Node
{
    public string Name {get; set;}
    public IList<Node> Children {get;}
    public Node Parent {get; set;}
    ...
} 
```

这个简单的类不能被序列化，因为 Parent 属性的存在意味着序列化会进入一个无限循环。

由于您已经实现了 ISerializable，因此您已经完成了 75% 的解决方法——您只需要确保从您存储的对象图中删除任何循环，而是存储一个对象*树*。

一种经常使用的技术是存储引用对象的*名称*（或*id*）而不是实际引用，在加载时将名称解析回对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T18:04:20.350

根据数据的结构，也许您可​​以序列化/反序列化大对象图的子图？如果数据可以以某种方式进行分区，您就可以侥幸逃脱，只创建序列化数据的少量重复。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T11:10:55.013

我猜......一次序列化更少的对象？

2个主要问题：

*   它们是什么物体？
    *   波科？
    *   数据表？
*   它是什么类型的序列化？
    *   xml？
        *   XmlSerializer？
        *   数据合同序列化器？
    *   二进制？
        *   二进制格式化程序？
        *   肥皂格式化程序？
    *   其他？
        *   json？
        *   定制？

序列化需要对数据量有什么考虑*；*例如，一些序列化框架支持对象和序列化数据的流式传输，而不是依赖于完整的对象图或临时存储。

另一种选择是序列化同质数据集而不是完整图 - 即将所有“客户”与“订单”分开序列化；这通常会减少体积，但会增加复杂性。

那么：这里的场景是什么？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T11:11:30.363

听起来您遇到了框架的内部限制。[您可以使用BinaryReader](http://msdn.microsoft.com/en-us/library/system.io.binarywriter.aspx) / [Writer](http://msdn.microsoft.com/en-us/library/system.io.binarywriter.aspx)或[DataContractSerializer](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractserializer.aspx)或其他任何东西编写自己的序列化，但我知道这并不理想。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T11:15:21.417

伙计，您已经到达 .net 的尽头！

我没有达到这个限制，但这里有一些指示：

1.  使用 [XmlIgnore] 跳过一些对象 - 也许您不需要序列化所有内容

2.  您可以手动使用序列化程序（即不使用属性，而是通过实现 Serialize() ）并将模型划分为更多文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-06T18:25:47.333

您需要同时获取所有数据吗？*一千三百万*个对象是一次性处理的大量信息。

您可以实现分页机制并以较小的块获取数据。而且它可能会增加应用程序的响应能力，因为您不必等待所有这些对象完成序列化。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-03-03T13:22:34.320

**非常大的对象的二进制序列化**

如果您在使用 BinaryFormater 时遇到此限制`binaryformatter the internal array cannot expand to greater than int32.maxvalue elements`，请使用此代码片段帮助自己步骤 1

安装 nuget 包：Install-Package Newtonsoft.Json.Bson -Version 1.0.2

```
using Newtonsoft.Json.Bson; //import require namesapace

//Code snippet for serialization/deserialization

public byte[] Serialize<T>(T obj)
{
    using (var memoryStream = new MemoryStream())
    {
        using (var writer = new BsonDataWriter(memoryStream))
        {
            var serializer = new JsonSerializer();
            serializer.Serialize(writer, obj);
        }
        return memoryStream.ToArray();
    }
}

public T Deserialize<T>(byte[] data)
{
    using (var memoryStream = new MemoryStream(data))
    {
        using (var reader = new BsonDataReader(memoryStream))
        {
            var serializer = new JsonSerializer();
            return serializer.Deserialize<T>(reader);
        }
    }
} 
```

# validation - 如果 PDF 文档符合 PDF/A，我如何测试它？

> ID：569129
> 
> 赞同：57
> 
> 时间：2009-02-20T10:58:59.987
> 
> 标签：validation, pdf, test-suite, pdfa

我们编写了一个创建 PDF 文件的软件。我们如何检查生成的 pdf 文件是否与 PDF/A 兼容？有没有可用的测试套件？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2010-03-02T21:55:04.503

PDF/A 验证器列表位于[pdfa.org](https://www.pdfa.org)网站上：

[维拉pdf](https://www.pdfa.org/new/verapdf-1-8-ships/)

此处提供免费的在线 PDF/A 验证器：

[http://www.validatepdfa.com/](http://www.validatepdfa.com/)

可从 PDFLib 获得有关许多这些 PDF/A 验证器的准确性的报告：

[https://www.pdflib.com/fileadmin/pdflib/pdf/pdfa/2009-05-04-Bavaria-report-on-PDFA-validation-accuracy.pdf](https://www.pdflib.com/fileadmin/pdflib/pdf/pdfa/2009-05-04-Bavaria-report-on-PDFA-validation-accuracy.pdf)

硒也是：

[https://www.pdflib.com/knowledge-base/pdfa/](https://www.pdflib.com/knowledge-base/pdfa/)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2013-01-28T02:29:43.077

3 [-Heights™ PDF Validator Online Tool](http://www.pdf-tools.com/pdf/validate-pdfa-online.aspx)为不同的[PDF/A 一致性级别和版本](https://en.wikipedia.org/wiki/PDF/A)提供了良好的反馈。

*   PDF/A1-a
*   PDF/A2-a
*   PDF/A2-b
*   PDF/A1-b
*   PDF/A2-u

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-07-09T08:51:32.183

使用 OPEN 验证器进行 pdf 验证：

DROID（数字记录对象识别）[http://sourceforge.net/projects/droid/](http://sourceforge.net/projects/droid/)

JHOVE - JSTOR/哈佛对象验证环境[http://hul.harvard.edu/jhove/](http://hul.harvard.edu/jhove/)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-20T11:11:45.823

您有 Adob​​e PDFL 或 Acrobat Professional 吗？如果这样做，您可以使用预检操作。

* * *

## 回答 #5

> 赞同：-6
> 
> 时间：2010-03-17T11:46:04.440

如果您下载最新版本的 Adob​​e Acrobat Reader，它将告诉您您的 pdf 是否符合 PDF/A。只需打开 PDF 文件，就会出现一个蓝色的大标记。

OpenOffice 支持 PDF/A。出于某种原因，“PDF/A-1”被称为

```
“选择 PDF 版本”
```

在 OpenOffice 内部。只需将该值加 1，您的输出应该是 PDF/A。

不同的值可以是

```
0 = PDFXNONE
1 = PDFX1A2001
2 = PDFX32002
3 = PDFA1A
4 = PDFA1B 
```

你设置

```
过滤数据
```

成为一个

```
HashMap('SelectPdfVersion',1) //1 代表 PDFX1A2001
```

# php - ASP 与 PHP 中的中继器、数据列表

> ID：569130
> 
> 赞同：2
> 
> 时间：2009-02-20T10:59:14.747
> 
> 标签：php

谁能给我一些建议。在 ASP 中，我们可以使用 datalist 和 repeater 控件来重复行，但我们如何在 PHP 中做类似的事情。

我正在为类似收件箱页面设计一个私人消息页面。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T11:52:45.337

使用循环构造。例如：

```
<?php foreach ($rows as $row): ?>
  <tr>
    <td><?php echo htmlspecialchars($row['id']); ?></td>
    <td><?php echo htmlspecialchars($row['name']); ?></td>
    <td><?php echo htmlspecialchars($row['email']); ?></td>
  </tr>
<?php endforeach; ?> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-20T11:05:16.573

看看[聪明](http://www.smarty.net/crashcourse.php)的。它有[{foreach}](http://www.smarty.net/manual/en/language.function.foreach.php)结构。

# regex - 如何从 URL 中获取域名

> ID：569137
> 
> 赞同：59
> 
> 时间：2009-02-20T11:01:32.527
> 
> 标签：regex, url

如何从 URL 字符串中获取域名？

### 例子：

```
+----------------------+------------+
| input                | output     |
+----------------------+------------+
| www.google.com       | google     |
| www.mail.yahoo.com   | mail.yahoo |
| www.mail.yahoo.co.in | mail.yahoo |
| www.abc.au.uk        | abc        |
+----------------------+------------+ 
```

有关的：

*   [通过正则表达式匹配网址](https://stackoverflow.com/questions/568864/maching-a-web-address-through-regex)

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-20T11:30:41.487

我曾经不得不为我工作的一家公司编写这样的正则表达式。解决方案是这样的：

*   获取每个可用[ccTLD](http://en.wikipedia.org/wiki/CcTLD)和[gTLD](http://en.wikipedia.org/wiki/Generic_top-level_domain)的列表。您的第一站应该是[IANA](http://www.iana.org/domains/root/db/)。来自 Mozilla 的列表乍一看很不错，但缺少 ac.uk 等，因此它并不是真正可用的。
*   像下面的例子一样加入列表。**警告：**订购很重要！如果*org.uk*出现在*uk*之后，那么**example.org.uk**将匹配**org**而不是**example**。

正则表达式示例：

```
.*([^\.]+)(com|net|org|info|coop|int|co\.uk|org\.uk|ac\.uk|uk|__and so on__)$ 
```

*这非常有效，并且还匹配了像de.com*和朋友这样的奇怪的非官方顶级。

好处：

*   如果正则表达式是最佳排序的，则非常快

这个解决方案的缺点当然是：

*   如果 ccTLD 更改或添加，则必须手动更新的手写正则表达式。乏味的工作！
*   非常大的正则表达式，所以不是很可读。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2020-01-24T13:48:48.660

聚会有点晚了，但是：

```
const urls = [
  'www.abc.au.uk',
  'https://github.com',
  'http://github.ca',
  'https://www.google.ru',
  'http://www.google.co.uk',
  'www.yandex.com',
  'yandex.ru',
  'yandex'
]

urls.forEach(url => console.log(url.replace(/.+\/\/|www.|\..+/g, '')))
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2017-07-11T20:36:56.263

准确提取域名可能非常棘手，主要是因为域扩展名可以包含 2 个部分（如 .com.au 或 .co.uk），而子域（前缀）可能存在也可能不存在。列出所有域扩展不是一种选择，因为有数百个。例如 EuroDNS.com 列出了 800 多个域名扩展。

因此，我编写了一个简短的 php 函数，它使用“parse_url()”和一些关于域扩展的观察来准确提取 url 组件和域名。功能如下：

```
function parse_url_all($url){
    $url = substr($url,0,4)=='http'? $url: 'http://'.$url;
    $d = parse_url($url);
    $tmp = explode('.',$d['host']);
    $n = count($tmp);
    if ($n>=2){
        if ($n==4 || ($n==3 && strlen($tmp[($n-2)])<=3)){
            $d['domain'] = $tmp[($n-3)].".".$tmp[($n-2)].".".$tmp[($n-1)];
            $d['domainX'] = $tmp[($n-3)];
        } else {
            $d['domain'] = $tmp[($n-2)].".".$tmp[($n-1)];
            $d['domainX'] = $tmp[($n-2)];
        }
    }
    return $d;
} 
```

这个简单的功能几乎适用于所有情况。有一些例外，但这些非常罕见。

要演示/测试此功能，您可以使用以下内容：

```
$urls = array('www.test.com', 'test.com', 'cp.test.com' .....);
echo "<div style='overflow-x:auto;'>";
echo "<table>";
echo "<tr><th>URL</th><th>Host</th><th>Domain</th><th>Domain X</th></tr>";
foreach ($urls as $url) {
    $info = parse_url_all($url);
    echo "<tr><td>".$url."</td><td>".$info['host'].
    "</td><td>".$info['domain']."</td><td>".$info['domainX']."</td></tr>";
}
echo "</table></div>"; 
```

对于列出的 URL，输出将如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/8Ceqo.jpg)](https://i.stack.imgur.com/8Ceqo.jpg)

如您所见，无论呈现给函数的 URL 是什么，都一致地提取了域名和不带扩展名的域名。

我希望这个对你有用。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-20T11:19:12.420

```
/^(?:www\.)?(.*?)\.(?:com|au\.uk|co\.in)$/ 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-09-10T06:22:05.137

有两种方法

**使用拆分**

然后只需解析该字符串

```
var domain;
//find & remove protocol (http, ftp, etc.) and get domain
if (url.indexOf('://') > -1) {
    domain = url.split('/')[2];
} if (url.indexOf('//') === 0) {
    domain = url.split('/')[2];
} else {
    domain = url.split('/')[0];
}

//find & remove port number
domain = domain.split(':')[0]; 
```

**使用正则表达式**

```
 var r = /:\/\/(.[^/]+)/;
 "http://stackoverflow.com/questions/5343288/get-url".match(r)[1] 
 => stackoverflow.com 
```

希望这可以帮助

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-20T11:07:14.743

我不知道任何库，但是域名的字符串操作很容易。

困难的部分是知道名称是在第二级还是第三级。为此，您将需要一个您维护的数据文件（例如，.uk 并不总是第三级，一些组织（例如 bl.uk、jet.uk）存在于第二级）。

来自 Mozilla的[Firefox 源](http://mxr.mozilla.org/mozilla/source/netwerk/dns/src/effective_tld_names.dat?raw=1)有这样一个数据文件，检查 Mozilla 许可，看看你是否可以重复使用它。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-07-19T03:21:11.293

```
import urlparse

GENERIC_TLDS = [
    'aero', 'asia', 'biz', 'com', 'coop', 'edu', 'gov', 'info', 'int', 'jobs', 
    'mil', 'mobi', 'museum', 'name', 'net', 'org', 'pro', 'tel', 'travel', 'cat'
    ]

def get_domain(url):
    hostname = urlparse.urlparse(url.lower()).netloc
    if hostname == '':
        # Force the recognition as a full URL
        hostname = urlparse.urlparse('http://' + uri).netloc

    # Remove the 'user:passw', 'www.' and ':port' parts
    hostname = hostname.split('@')[-1].split(':')[0].lstrip('www.').split('.')

    num_parts = len(hostname)
    if (num_parts < 3) or (len(hostname[-1]) > 2):
        return '.'.join(hostname[:-1])
    if len(hostname[-2]) > 2 and hostname[-2] not in GENERIC_TLDS:
        return '.'.join(hostname[:-1])
    if num_parts >= 3:
        return '.'.join(hostname[:-2]) 
```

此代码不保证适用于所有 URL，并且不会过滤那些语法正确但无效的 URL，例如“example.uk”。

但是，在大多数情况下它会完成这项工作。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-03-09T10:48:08.293

如果不使用 TLD 列表来比较它们是不可能的，因为它们存在许多情况，例如[http://www.db.de/](http://www.db.de/)或[http://bbc.co.uk/](http://bbc.co.uk/)将被正则表达式解释为域`db.de`（正确）和`co.uk`（错误）。

但即便如此，如果您的列表也不包含 SLD，您也不会成功。[像http://big.uk.com/](http://big.uk.com/)和[http://www.uk.com/](http://www.uk.com/)这样的URL都将被解释为`uk.com`（第一个域是 big.uk.com）。

因此，所有浏览器都使用 Mozilla 的公共后缀列表：

[https://en.wikipedia.org/wiki/Public_Suffix_List](https://en.wikipedia.org/wiki/Public_Suffix_List)

您可以通过以下 URL 将其导入代码中：

[http://mxr.mozilla.org/mozilla-central/source/netwerk/dns/effective_tld_names.dat?raw=1](http://mxr.mozilla.org/mozilla-central/source/netwerk/dns/effective_tld_names.dat?raw=1)

随意扩展我的功能以提取域名，仅。它不会使用正则表达式，而且速度很快：

[http://www.programmierer-forum.de/domainnamen-ermitteln-t244185.htm#3471878](http://www.programmierer-forum.de/domainnamen-ermitteln-t244185.htm#3471878)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-11-11T04:18:37.053

基本上，你想要的是：

```
google.com        -> google.com    -> google
www.google.com    -> google.com    -> google
google.co.uk      -> google.co.uk  -> google
www.google.co.uk  -> google.co.uk  -> google
www.google.org    -> google.org    -> google
www.google.org.uk -> google.org.uk -> google 
```

选修的：

```
www.google.com     -> google.com    -> www.google
images.google.com  -> google.com    -> images.google
mail.yahoo.co.uk   -> yahoo.co.uk   -> mail.yahoo
mail.yahoo.com     -> yahoo.com     -> mail.yahoo
www.mail.yahoo.com -> yahoo.com     -> mail.yahoo 
```

您不需要构建一个不断变化的正则表达式，因为如果您只需查看名称的倒数第二部分，就会正确匹配 99% 的域：

```
(co|com|gov|net|org) 
```

如果是其中之一，那么您需要匹配 3 个点，否则 2 个。简单。现在，我的正则表达式魔法与其他一些 SO'ers 的魔法不匹配，所以我发现实现这一目标的最佳方法是使用一些代码，假设您已经剥离了路径：

```
 my @d=split /\./,$domain;                # split the domain part into an array
 $c=@d;                                   # count how many parts
 $dest=$d[$c-2].'.'.$d[$c-1];             # use the last 2 parts
 if ($d[$c-2]=~m/(co|com|gov|net|org)/) { # is the second-last part one of these?
   $dest=$d[$c-3].'.'.$dest;              # if so, add a third part
 };
 print $dest;                             # show it 
```

根据您的问题，只需获取名称：

```
 my @d=split /\./,$domain;                # split the domain part into an array
 $c=@d;                                   # count how many parts
 if ($d[$c-2]=~m/(co|com|gov|net|org)/) { # is the second-last part one of these?
   $dest=$d[$c-3];                        # if so, give the third last
   $dest=$d[$c-4].'.'.$dest if ($c>3);    # optional bit
 } else {
   $dest=$d[$c-2];                        # else the second last
   $dest=$d[$c-3].'.'.$dest if ($c>2);    # optional bit 
 };
 print $dest;                             # show it 
```

我喜欢这种方法，因为它是免维护的。除非你想验证它实际上是一个合法的域，但那是没有意义的，因为你很可能只使用它来处理日志文件，而一个无效的域一开始就不会在那里找到它的方式。

如果您想匹配“非官方”子域，例如 bozo.za.net 或 bozo.au.uk，bozo.msf.ru 只需将 (za|au|msf) 添加到正则表达式。

我很乐意看到有人只使用正则表达式来完成所有这些，我相信这是可能的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-11-03T21:09:23.330

`/[^w{3}\.]([a-zA-Z0-9]([a-zA-Z0-9\-]{0,65}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}/gim`

使用这个 javascript 正则表达式会忽略 www 和后面的点，同时保持域不变。也正确匹配没有 www 和 cc tld

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-02-28T16:26:59.707

因此，如果您只有一个字符串而不是 window.location 您可以使用...

```
String.prototype.toUrl = function(){

if(!this && 0 < this.length)
{
    return undefined;
}
var original = this.toString();
var s = original;
if(!original.toLowerCase().startsWith('http'))
{
    s = 'http://' + original;
}

s = this.split('/');

var protocol = s[0];
var host = s[2];
var relativePath = '';

if(s.length > 3){
    for(var i=3;i< s.length;i++)
    {
        relativePath += '/' + s[i];
    }
}

s = host.split('.');
var domain = s[s.length-2] + '.' + s[s.length-1];    

return {
    original: original,
    protocol: protocol,
    domain: domain,
    host: host,
    relativePath: relativePath,
    getParameter: function(param)
    {
        return this.getParameters()[param];
    },
    getParameters: function(){
        var vars = [], hash;
        var hashes = this.original.slice(this.original.indexOf('?') + 1).split('&');
        for (var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
        return vars;
    }
};}; 
```

如何使用。

```
var str = "http://en.wikipedia.org/wiki/Knopf?q=1&t=2";
var url = str.toUrl;

var host = url.host;
var domain = url.domain;
var original = url.original;
var relativePath = url.relativePath;
var paramQ = url.getParameter('q');
var paramT = url.getParamter('t'); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-06-15T08:27:05.887

出于某种目的，我昨天做了这个快速的 Python 函数。它从 URL 返回域。它很快，不需要任何输入文件列表的东西。但是，我并不假装它适用于所有情况，但它确实完成了我对简单文本挖掘脚本所需的工作。

输出如下所示：

[http://www.google.co.uk](http://www.google.co.uk) => google.co.uk
[http://24.media.tumblr.com/tumblr_m04s34rqh567ij78k_250.gif](http://24.media.tumblr.com/tumblr_m04s34rqh567ij78k_250.gif) => tumblr.com

```
def getDomain(url):    
        parts = re.split("\/", url)
        match = re.match("([\w\-]+\.)*([\w\-]+\.\w{2,6}$)", parts[2]) 
        if match != None:
            if re.search("\.uk", parts[2]): 
                match = re.match("([\w\-]+\.)*([\w\-]+\.[\w\-]+\.\w{2,6}$)", parts[2])
            return match.group(2)
        else: return '' 
```

似乎工作得很好。
但是，必须对其进行修改以根据需要删除输出中的域扩展名。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-05-24T16:27:09.520

1.  这怎么样

    `=((?:(?:(?:http)s?:)?\/\/)?(?:(?:[a-zA-Z0-9]+)\.?)*(?:(?:[a-zA-Z0-9]+))\.[a-zA-Z0-9]{2,3})` （您可能需要在模式末尾添加“\/”

2.  如果您的目标是摆脱作为参数传入的 url，您可以将等号添加为第一个字符，例如：

    =((?:(?:(?:http)s?:)?//)?(?:(?:[a-zA-Z0-9]+).?)*(?:(?:[ a-zA-Z0-9]+)).[a-zA-Z0-9]{2,3}/)

    并替换为“/”

这个例子的目标是摆脱任何域名，无论它以何种形式出现。（即确保 url 参数不包含域名以避免 xss 攻击）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-04-21T10:44:22.387

您能在 .com （或其他）之前查找单词吗（其他列表的顺序与频率相反，请参见[此处](https://www.icdsoft.com/blog/what-are-the-most-popular-tlds-domain-extensions/)

并取第一个匹配组，即

```
window.location.host.match(/(\w|-)+(?=(\.(com|net|org|info|coop|int|co|ac|ie|co|ai|eu|ca|icu|top|xyz|tk|cn|ga|cf|nl|us|eu|de|hk|am|tv|bingo|blackfriday|gov|edu|mil|arpa|au|ru)(\.|\/|$)))/g)[0] 
```

您可以通过将此行复制到任何选项卡上的开发人员控制台中来测试它

此示例适用于以下情况：

[![在此处输入图像描述](https://i.stack.imgur.com/BGXcz.png)](https://i.stack.imgur.com/BGXcz.png)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-01-10T09:54:38.037

这里的所有答案都非常好，但有时都会失败。所以我知道链接其他东西并不常见，已经在别处回答过，但你会发现你不必把时间浪费在不可能的事情上。这是因为像*mydomain.co.uk*这样的域无法知道提取的域是否正确。如果您说要通过 URL 提取，则前面有 http 或 https 或什么都没有（但如果前面可能什么都没有，则必须删除

```
filter_var($url, filter_var($url, FILTER_VALIDATE_URL)) 
```

在下面，因为 FILTER_VALIDATE_URL 不能将不以 http 开头的字符串识别为 url，因此可以将其删除，并且您也可以使用这样的愚蠢方法来实现，这永远不会失败：

```
$url = strtolower('hTTps://www.example.com/w3/forum/index.php');

if( filter_var($url, FILTER_VALIDATE_URL) && substr($url, 0, 4) == 'http' )
{
// array order is !important
$domain = str_replace(array("http://www.","https://www.","http://","https://"), array("","","",""), $url);
$spos = strpos($domain,'/');
if($spos !== false)
{
 $domain = substr($domain, 0, $spos);
} } else { $domain = "can't extract a domain"; }

echo $domain; 
```

[在此处检查 FILTER_VALIDATE_URL 默认行为](https://www.php.net/manual/en/filter.filters.validate.php)

但是，如果您想检查一个域的有效性，并且始终确保提取的值是正确的，那么您必须检查一组有效的顶级域，如下所述： [https ://stackoverflow.com/a /70566657/6399448](https://stackoverflow.com/a/70566657/6399448) 否则您将永远无法确定提取的字符串是正确的域。不幸的是，这里的所有答案有时都会失败。

Ps 在这里有意义的独特答案在我看来是这样的（对不起，我之前没有读过它。它提供了相同的解决方案，即使没有提供我上面提到或链接的示例）： [https ://stackoverflow.com/一个/569219/6399448](https://stackoverflow.com/a/569219/6399448)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2022-01-26T18:55:22.783

我知道您实际上要求使用正则表达式并且不是特定于一种语言。但在 Javascript 中，您可以这样做。也许其他语言可以以类似的方式解析 URL。

## 简单的 Javascript 解决方案

```
const domain = (new URL(str)).hostname.replace("www.", ""); 
```

为了完整起见，将此解决方案保留在 js 中。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2009-02-20T11:15:54.613

您需要一份可以删除哪些域前缀和后缀的列表。例如：

前缀：

*   `www.`

后缀：

*   `.com`
*   `.co.in`
*   `.au.uk`

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2010-03-23T04:02:21.700

```
#!/usr/bin/perl -w
use strict;

my $url = $ARGV[0];
if($url =~ /([^:]*:\/\/)?([^\/]*\.)*([^\/\.]+)\.[^\/]+/g) {
  print $3;
} 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2015-04-01T22:38:52.857

```
/^(?:https?:\/\/)?(?:www\.)?([^\/]+)/i 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2015-08-03T02:59:16.970

使用这个 (.)(.*?)(.) 然后只提取开始点和结束点。容易，对吧？

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2015-10-01T18:46:30.307

只是为了知识：

```
'http://api.livreto.co/books'.replace(/^(https?:\/\/)([a-z]{3}[0-9]?\.)?(\w+)(\.[a-zA-Z]{2,3})(\.[a-zA-Z]{2,3})?.*$/, '$3$4$5');

# returns livreto.co 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2019-05-28T16:48:23.270

我知道问题是寻求正则表达式解决方案，但每次尝试都无法涵盖所有​​内容

我决定用 Python 编写这个方法，它只适用于具有子域（即 www.mydomain.co.uk）的 url，而不是多级子域，如`www.mail.yahoo.com`

```
def urlextract(url):
  url_split=url.split(".")
  if len(url_split) <= 2:
      raise Exception("Full url required with subdomain:",url)
  return {'subdomain': url_split[0], 'domain': url_split[1], 'suffix': ".".join(url_split[2:])} 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2021-12-30T17:54:32.003

假设我们有这个：http: [//google.com](http://google.com)

而你只想要域名

```
let url = http://google.com;
let domainName = url.split("://")[1];
console.log(domainName); 
```

# sql-server - 如何在 Sql Server 2005+ 中执行嵌套脚本

> ID：569143
> 
> 赞同：3
> 
> 时间：2009-02-20T11:04:35.920
> 
> 标签：sql-server

是否有任何 sql 忍者知道如何从另一个脚本中执行脚本 (.sql)？专门针对 Sql Server 2005+ 平台。例如伪代码如下：

**ScriptA 内容**

```
RESTORE DATABASE [MyDbName]
    FROM  
        DISK = N'path' WITH  FILE = 1
.......
GO
Exec c:\scripts\ScriptB.sql 
```

**ScriptB 内容**

```
USE [MyDbName]
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MyTableName]') AND type in (N'U'))
CREATE TABLE [dbo].[MyTableName]
........
GO 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T11:17:20.320

您可以从 SSMS 打开 SQLCMD 模式或在 SQLCMD.exe 中运行脚本。SQLCMD 支持脚本变量和脚本引用。

```
---script1-----
create table ....
:r path/to/another/script (which can reference others)
--------------- 
```

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T11:11:33.467

以下文章提供了如何实现此目的的示例。

[http://www.sqlservercentral.com/articles/Administering/scriptrunner/292/](http://www.sqlservercentral.com/articles/Administering/scriptrunner/292/)

这是一个免费工具，可以运行多个脚本，但不能从现有脚本中运行。

[http://www.xsqlsoftware.com/Product/ProductDetails.aspx?ProdID=ScriptExecutor](http://www.xsqlsoftware.com/Product/ProductDetails.aspx?ProdID=ScriptExecutor)

下面是通过使用 xp_cmdshell 存储过程调用 isql 实用程序从另一个脚本中执行脚本的示例。

[http://www.sqlservercentral.com/articles/Administering/scriptscheduling/450/](http://www.sqlservercentral.com/articles/Administering/scriptscheduling/450/)

应该是您开始工作所需要的，但如果您需要进一步的帮助，请给我留言。

干杯，约翰

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T11:13:24.370

Core MS SQL 不这样做，但一些工具具有一些宏功能（即完成客户端站点）。

[SQLCMD](http://msdn.microsoft.com/en-us/library/ms162773.aspx)支持 ":r" 导入另一个文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T11:14:14.087

据我所知，您不必将这两个脚本结合起来。您可以只执行第一个，然后执行另一个。

您可以通过制作加载 .sql 文件然后使用 ADODB.Connection 执行这两个脚本的 vbscript 来做到这一点。

这个 vbscript 应该这样做：

```
Set con = CreateObject("ADODB.Connection")
con.ConnectionString = "*** Database connection string here ***"
con.Open 

Set fso = CreateObject("Scripting.FileSystemObject")

Set sqlFile = fso.OpenTextFile("scriptA.sql", 1)
con.Execute sqlFile.ReadAll
sqlFile.Close

Set sqlFile = fso.OpenTextFile("scriptB.sql", 1)
con.Execute sqlFile.ReadAll
sqlFile.Close

Set fso = Nothing 
Set con = Nothing 
```

# c# - 将 StackPanel.Visibility 绑定到其子项的 Visibility 属性

> ID：569144
> 
> 赞同：4
> 
> 时间：2009-02-20T11:04:43.220
> 
> 标签：c#, wpf, data-binding, xaml

我对 DataBinding 比较陌生，只是阅读它。我想要做的是以下内容：

我有一个带有许多子控件的 StackPanel：

```
 <StackPanel Orientation="Horizontal">
            <TextBox x:Name="textbox1" Width="100">1</TextBox>
            <TextBox x:Name="textbox2" Width="100">2</TextBox>
            <TextBox x:Name="textbox3" Width="100">3</TextBox>
        </StackPanel> 
```

文本框的`visibility`属性可以通过代码更改。现在，如果所有`TextBoxe`s 都设置为`Visibility=Collapsed`，我也想`StackPanel.Visibility`设置为`Collapsed`，但如果`TextBoxe`显示一个或多个 s `(Visibility=Visible)`，`StackPanel.Visibility`也应该设置为`Visible`。

这可以通过简单的 DataBinding 来实现，还是我必须在 C# 代码中实现这个功能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T11:17:49.770

我想不出一种直接通过数据绑定来做到这一点的方法。

就个人而言，我会在视图后面有一个视图模型，并将视图 DataContext 设置为视图模型。

在视图模型中，如果所有文本框都已折叠，我将有一个属性告诉视图。该属性将由代码设置。然后将堆栈面板可见性绑定到该属性。

（该属性必须是依赖属性，或者视图模型必须实现 INotifyPropertyChanged 以使视图自动更新）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T11:13:50.577

您是否考虑过将 TextBoxes 的可见性设置为`Hidden`？这将“隐藏”为文本框分配的空间。假设它们在 StackPanel 中没有其他控件，那么它将不可见。

当然，此解决方案可能会对您的实现做出一些幼稚的假设。

如果您需要更复杂的场景，我会尝试以下操作：注意：这是伪代码 - 可能无法编译..

1）使用多重绑定

```
<StackPanel>
  <StackPanel.Visibility Converter={StaticResource visibilityConverter}>
    <MultiBinding.Bindings>
      <Binding ElementName="textBox1" Path="Visibility" />
      <Binding ElementName="textBox2" Path="Visibility" />
      <Binding ElementName="textBox3" Path="Visibility" />
    </MultiBinding.Bindings>
  </StackPanel.Visibility>
</StackPanel> 
```

2) 声明转换器

```
<Window.Resources>
  <local:VisibilityConverter x:Key="visibilityConverter" />
</Window.Resources> 
```

3) 定义转换器

```
public class VisibilityConverter : IMultiValueConverter
{
  public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
  {
    Visibility text1Vis = (Visibility)values[0];
    Visibility text2Vis = (Visibility)values[1];
    Visibility text3Vis = (Visibility)values[2];

    if (text1Vis == text2Vis == text3Vis == Visibility.Collapsed)
      return Visibility.Collapsed;

    return Visibility.Visible;
  }
} 
```

# windows - 在 vsjitdebugger 列表中包含 WinDbg

> ID：569145
> 
> 赞同：6
> 
> 时间：2009-02-20T11:05:08.007
> 
> 标签：windows, debugging, postmortem-debugging

当 vsjitdebugger 被配置为 HKLM 中的默认调试器时，是否可以将 WinDbg 包含在由 vsjitdebugger 显示的调试器列表中...\AeDebug？

理想情况下，我希望能够在 vsjitdebugger 中的选项列表中包含更多命令行，这些命令行在进程遇到未处理的异常时可用：使用 DrWatson 或使用 WinDbg 保存小型转储以供以后检查。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T12:51:49.073

在 VS7 之前，曾经有这样一个（未记录的）选项。该界面是一个名为[vs7jit](http://groups.google.com/group/microsoft.public.vsnet.debugging/browse_frm/thread/3678c5acc3944055?pli=1)的工具。

[此处](http://groups.google.com/group/microsoft.public.win32.programmer.kernel/browse_thread/thread/475ecc21c30cb635/818bdd912773d457?q=Extending+vsjitdebugger#818bdd912773d457)也进行了讨论，并且在那里提出的其他方向可能仍然有效 - 特别是 John Robbins 的“调试器选择器”代码。

# c++ - 是否有任何 api 用于获取 Apache WebServer 中 UseCanonicalName 的值？

> ID：569148
> 
> 赞同：1
> 
> 时间：2009-02-20T11:05:40.767
> 
> 标签：c++, apache, webserver, httpd.conf

我们需要从使用 api 的应用程序中检查 Apache Webserver（任何版本）中 httpd.conf 中 UseCanonicalName 的值。我已经用谷歌搜索了它，但找不到任何与之相关的 api。请帮忙。TIA

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-05-15T19:39:47.420

查询`httpd.conf`文件以获取`/UseCanonicalName/`.

# javascript - javascript覆盖居中对齐的模式弹出窗口

> ID：569149
> 
> 赞同：2
> 
> 时间：2009-02-20T11:06:02.577
> 
> 标签：javascript

想知道只需将 javascript 覆盖在页面中心的 div 上。

只想使用纯 java 脚本**在页面中心**显示和隐藏 div，并显示“请稍候...”消息并禁用背景。这个 div 也应该显示在页面的其他内容之上。

我的 div 看起来像这样

```
<div id='mydiv' style="display:none;" ><img src="myimg.gif" /> Please Wait... </div> 
```

单击按钮时，我想显示在页面上对齐的 div 内容中心。

我**不想**使用 jquery、extjs 等来实现这一点。

我在网上看到了一些示例，其中添加了许多其他功能到模态弹出窗口中，只是在寻找简单而干净的东西。执行此操作所需的最低限度的 JS。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T11:20:54.397

要显示的 div 需要有一个 ID：

```
<div id="loaderdiv"> 
```

然后在您的 javascript 中，使用以下代码显示此 div：

```
document.getElementById("loaderdiv").style.display = ''; 
```

这是你需要的最低限度。

可以使用 CSS 将图像居中：

```
<div style="position:absolute;top:50%;left:50%;margin-top:-[imgheight/2]px;margin-left:-[imgwidth/2]px"> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-04T06:19:54.883

```
<div class="overlay_msg" id="overlay_msg" style="width:350px; height:100px; background-color:#ffffff; margin-left:300px; margin-top:20%; visibility:hidden; z-index:201; position:fixed; padding:15px; text-align:center;">
                <a href="http://example.com">example.com</a><br />
        </div><!--overlay_msg-->
        <div class="my_overlay" id="my_overlay" style="background-color:#000000; opacity:.7; position:fixed; z-index:200; width:100%; height:100%; margin:0px; padding:0px; visibility:hidden;" onclick="hideMyOverlay()">
        </div><!--my_overlay-->
        <script type="text/javascript">
            function showMyOverlay()
            {
                document.getElementById('my_overlay').style.visibility='visible';
                document.getElementById('overlay_msg').style.visibility='visible';
            }
            function hideMyOverlay()
            {
                document.getElementById('my_overlay').style.visibility='hidden';
                document.getElementById('overlay_msg').style.visibility='hidden';               
            }
        </script> 
```

# c# - 如何在 C#.NET 中不同类型的对象之间进行深度复制

> ID：569154
> 
> 赞同：10
> 
> 时间：2009-02-20T11:08:42.447
> 
> 标签：c#, .net, reflection, serialization

我需要按字段名称映射 ObjectV1 和 ObjectV2 之间的所有字段值和子集合。ObjectV2 与 ObjectV1 位于不同的命名空间中。

模板 ClassV1 和 ClassV2 之间的继承已被打折，因为这两个类需要独立发展。我考虑过使用反射（很慢）和二进制序列化（也很慢）来执行公共属性的映射。

有首选方法吗？还有其他选择吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T11:26:05.057

作为每次使用反射的替代方法，您可以创建一个辅助类，该类使用 Reflection.Emit 动态创建复制方法 - 这意味着您只会在启动时获得性能影响。这可以为您提供所需的灵活性和性能的组合。

由于 Reflection.Emit 相当笨重，我建议查看[这个](http://www.codeplex.com/reflectoraddins/Wiki/View.aspx?title=ReflectionEmitLanguage&referringTitle=Home)Reflector 插件，它非常适合构建此类代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T11:15:33.817

它是什么版本的 .NET？

**对于浅拷贝：**

在 3.5 中，您可以预编译一个`Expression`来执行此操作。在 2.0 中，您可以`HyperDescriptor`很容易地使用它来做同样的事情。两者都将大大优于反射。

`Expression`该方法在[`MiscUtil`](http://www.yoda.arachsys.com/csharp/miscutil/)-中有一个预先固定的实现`PropertyCopy`：

```
DestType clone = PropertyCopy<DestType>.CopyFrom(original); 
```

**（结束浅）**

BinaryFormatter （在问题中）在这里不是一个选项 - 它根本不起作用，因为原始类型和目标类型不同。如果数据是基于合同的，**如果**所有合同名称都匹配，XmlSerializer 或 DataContractSerializer 将起作用，但如果可能的话，上面的两个（浅）选项会更快。

另外 - 如果您的类型标有通用序列化属性（`XmlType`或`DataContract`），那么[protobuf-net](http://code.google.com/p/protobuf-net/) **可以**（在某些情况下）为您执行深度复制/更改类型：

```
DestType clone = Serializer.ChangeType<OriginalType, DestType>(original); 
```

但这取决于具有非常相似模式的类型（实际上，它不使用名称，它使用属性上的显式“顺序”等）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-15T14:45:04.590

您可能想看看[AutoMapper](https://github.com/automapper/automapper)，这是一个专门在对象之间复制值的库。它使用约定优于配置，因此如果属性确实具有完全相同的名称，它将为您完成几乎所有的工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-15T14:11:39.587

这是我构建的解决方案：

```
 /// <summary>
        /// Copies the data of one object to another. The target object gets properties of the first. 
        /// Any matching properties (by name) are written to the target.
        /// </summary>
        /// <param name="source">The source object to copy from</param>
        /// <param name="target">The target object to copy to</param>
        public static void CopyObjectData(object source, object target)
        {
            CopyObjectData(source, target, String.Empty, BindingFlags.Public | BindingFlags.Instance);
        }

        /// <summary>
        /// Copies the data of one object to another. The target object gets properties of the first. 
        /// Any matching properties (by name) are written to the target.
        /// </summary>
        /// <param name="source">The source object to copy from</param>
        /// <param name="target">The target object to copy to</param>
        /// <param name="excludedProperties">A comma delimited list of properties that should not be copied</param>
        /// <param name="memberAccess">Reflection binding access</param>
        public static void CopyObjectData(object source, object target, string excludedProperties, BindingFlags memberAccess)
        {
            string[] excluded = null;
            if (!string.IsNullOrEmpty(excludedProperties))
            {
                excluded = excludedProperties.Split(new char[1] { ',' }, StringSplitOptions.RemoveEmptyEntries);
            }

            MemberInfo[] miT = target.GetType().GetMembers(memberAccess);
            foreach (MemberInfo Field in miT)
            {
                string name = Field.Name;

                // Skip over excluded properties
                if (string.IsNullOrEmpty(excludedProperties) == false
                    && excluded.Contains(name))
                {
                    continue;
                }

                if (Field.MemberType == MemberTypes.Field)
                {
                    FieldInfo sourcefield = source.GetType().GetField(name);
                    if (sourcefield == null) { continue; }

                    object SourceValue = sourcefield.GetValue(source);
                    ((FieldInfo)Field).SetValue(target, SourceValue);
                }
                else if (Field.MemberType == MemberTypes.Property)
                {
                    PropertyInfo piTarget = Field as PropertyInfo;
                    PropertyInfo sourceField = source.GetType().GetProperty(name, memberAccess);
                    if (sourceField == null) { continue; }

                    if (piTarget.CanWrite && sourceField.CanRead)
                    {
                        object targetValue = piTarget.GetValue(target, null);
                        object sourceValue = sourceField.GetValue(source, null);

                        if (sourceValue == null) { continue; }

                        if (sourceField.PropertyType.IsArray
                            && piTarget.PropertyType.IsArray
                            && sourceValue != null ) 
                        {
                            CopyArray(source, target, memberAccess, piTarget, sourceField, sourceValue);
                        }
                        else
                        {
                            CopySingleData(source, target, memberAccess, piTarget, sourceField, targetValue, sourceValue);
                        }
                    }
                }
            }
        }

        private static void CopySingleData(object source, object target, BindingFlags memberAccess, PropertyInfo piTarget, PropertyInfo sourceField, object targetValue, object sourceValue)
        {
            //instantiate target if needed
            if (targetValue == null
                && piTarget.PropertyType.IsValueType == false
                && piTarget.PropertyType != typeof(string))
            {
                if (piTarget.PropertyType.IsArray)
                {
                    targetValue = Activator.CreateInstance(piTarget.PropertyType.GetElementType());
                }
                else
                {
                    targetValue = Activator.CreateInstance(piTarget.PropertyType);
                }
            }

            if (piTarget.PropertyType.IsValueType == false
                && piTarget.PropertyType != typeof(string))
            {
                CopyObjectData(sourceValue, targetValue, "", memberAccess);
                piTarget.SetValue(target, targetValue, null);
            }
            else
            {
                if (piTarget.PropertyType.FullName == sourceField.PropertyType.FullName)
                {
                    object tempSourceValue = sourceField.GetValue(source, null);
                    piTarget.SetValue(target, tempSourceValue, null);
                }
                else
                {
                    CopyObjectData(piTarget, target, "", memberAccess);
                }
            }
        }

        private static void CopyArray(object source, object target, BindingFlags memberAccess, PropertyInfo piTarget, PropertyInfo sourceField, object sourceValue)
        {
            int sourceLength = (int)sourceValue.GetType().InvokeMember("Length", BindingFlags.GetProperty, null, sourceValue, null);
            Array targetArray = Array.CreateInstance(piTarget.PropertyType.GetElementType(), sourceLength);
            Array array = (Array)sourceField.GetValue(source, null);

            for (int i = 0; i < array.Length; i++)
            {
                object o = array.GetValue(i);
                object tempTarget = Activator.CreateInstance(piTarget.PropertyType.GetElementType());
                CopyObjectData(o, tempTarget, "", memberAccess);
                targetArray.SetValue(tempTarget, i);
            }
            piTarget.SetValue(target, targetArray, null);
        } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T11:15:50.307

如果速度是一个问题，您可以使反射过程脱机并生成用于映射公共属性的代码。您可以在运行时使用轻量级代码生成来执行此操作，也可以通过构建要编译的 C# 代码完全离线执行此操作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-15T04:57:45.150

如果您控制目标对象的实例化，请尝试使用**JavaScriptSerializer**。它不会吐出任何类型信息。

```
new JavaScriptSerializer().Serialize(new NamespaceA.Person{Id = 1, Name = "A"}) 
```

返回

```
{Id: 1, Name: "A"} 
```

由此应该可以反序列化具有相同属性名称的任何类。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T11:12:27.773

如果速度是一个问题，您应该在方法本身中实现克隆方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-13T20:37:53.153

对于深拷贝，我使用了 Newtonsoft 和 create 和通用方法，例如：

```
public T DeepCopy<T>(T objectToCopy)
{
    var objectSerialized = JsonConvert.SerializeObject(objectToCopy);
    return JsonConvert.DeserializeObject<T>(objectSerialized);
} 
```

我知道这不是什么正统的解决方案，但它对我有用。

# postgresql - 从 Postgres 服务确定集群目录

> ID：569157
> 
> 赞同：7
> 
> 时间：2009-02-20T11:09:34.767
> 
> 标签：postgresql

是否可以从服务器本身确定 Postgres 服务器正在使用的集群目录 - 即服务（在 Windows 下）由以下内容启动：

```
C:\foo\postgres.exe -D "D:\emr\data" 
```

是否`SELECT`可以对正在运行的服务器进行查询或函数来检索值`D:\emr\data`？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T13:34:49.457

（为了完整性）甚至更短：

```
SHOW data_directory; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T11:25:41.670

```
SELECT setting FROM pg_settings WHERE name = 'data_directory' 
```

# .net - 如何向 DevExpress XtraGrid 添加加权平均摘要？

> ID：569162
> 
> 赞同：2
> 
> 时间：2009-02-20T11:11:15.513
> 
> 标签：.net, devexpress, xtragrid, weighted-average, group-summaries

DevExpress Grid (XtraGrid) 允许网格及其组进行汇总计算。可用选项包括计数、最大值、最小值、平均值、总和、无和自定义。

有没有人有一些示例代码显示如何根据作为另一列中的值提供的权重计算加权平均列？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T14:38:32.020

我最终解决了这个问题，并将在此处发布我的解决方案，以防其他人发现它有用。

如果加权平均值由值和每行权重组成，则包含该值的列应将权重 GridColumn 对象分配给其 Tag 属性。然后，此事件处理程序将完成其余的工作：

```
private static void gridView_CustomSummaryCalculate(object sender, CustomSummaryEventArgs e)
{
    GridColumn weightColumn = ((GridSummaryItem)e.Item).Tag as GridColumn;

    if (weightColumn == null)
        return;

    switch (e.SummaryProcess)
    {
        case CustomSummaryProcess.Start:
        {
            e.TotalValue = new WeightedAverageCalculator();
            break;
        }
        case CustomSummaryProcess.Calculate:
        {
            double size = Convert.ToDouble(e.FieldValue);
            double weight = Convert.ToDouble(((GridView)sender).GetRowCellValue(e.RowHandle, weightColumn));

            ((WeightedAverageCalculator)e.TotalValue).Add(weight, size);
            break;
        }
        case CustomSummaryProcess.Finalize:
        {
            e.TotalValue = ((WeightedAverageCalculator)e.TotalValue).Value;
            break;
        }
    }
}

private sealed class WeightedAverageCalculator
{
    private double _sumOfProducts;
    private double _totalWeight;

    public void Add(double weight, double size)
    {
        _sumOfProducts += weight * size;
        _totalWeight += weight;
    }

    public double Value
    {
        get { return _totalWeight==0 ? 0 : _sumOfProducts / _totalWeight; }
    }
} 
```

该代码假定基础列值可以通过`Convert.ToDouble(object)`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T11:38:03.157

如果您在 sum 中提供自己的 lambda 表达式，您应该能够按标准 sum 对它们进行分组。我认为这应该有效：

```
var grouped = from item in items
orderby item.Group
group item by item.Group into grp
select new
{
Average= grp.Sum(row => row.Value * row.Weight)
}; 
```

# algorithm - 穷人的认证算法？

> ID：569183
> 
> 赞同：10
> 
> 时间：2009-02-20T11:17:31.487
> 
> 标签：algorithm, language-agnostic, authentication

*头脑风暴请求*

我需要一个具有一些不寻常要求的身份验证算法的想法。

该算法将用于验证消息的**发送者**是否合法。

## 限制：

1.  “传输层”是电子邮件
    *   发件人（“*爱丽丝*”）是一个人
    *   *Alice*只能使用网络浏览器和互联网访问（包括网络邮件帐户）作为她的工具；所以她不能做很复杂的计算
    *   接收器（' *Bob* '）是一台无法直接访问*互联网*的计算机。
    *   *Bob*有一个定期检查的电子邮件帐户。
    *   *Bob*可以发送电子邮件。
    *   不向第 3 方发送信息：*Alice*和*Bob*不能发送任何带外信息。阅读一些公开可用的信息（例如来自时间服务器的时间）是可以的。

## 假设：

*   *Alice*可以在本地访问*一些*信息：也许她带着一个笔记本，或者我们甚至可以假设她的网络邮件帐户是防黑客的，因此敏感信息可以存储在那里。
*   *Alice*和*Bob*可以在身份验证之前直接交换敏感信息（私钥？）

## 非目标：

*   不需要对消息的实际有效负载进行编码。
*   速度/延迟不是（大）问题

## 一些帮助您入门的想法：

1.  普通的旧硬编码密码。
    *问题*：

    *   蛮力攻击（不太可能）
    *   如果以明文形式进行通信，则可能进行窃听，然后可能进行重放攻击
2.  基于当前日期/时间的简单算法
    示例：*Alice*添加当前日期、小时和分钟，并将结果作为身份验证令牌发送，*Bob*可以验证。让我们假设对时间服务器的只读访问不违反规则 #7（没有第 3 方）。
    *问题*：

    *   *默默无闻的安全性*：该算法在某种程度上是安全的，只是因为它不是公开可用的（嗯，现在是……哎呀！）
3.  某种质询-响应机制*——Alice*发送认证请求，*Bob*回复质询，*Alice*发送预期响应和实际有效负载。
    机制的细节是什么？我不知道 ：）

你能想到什么*？*我希望看到一些有创意的答案;-)

**编辑：**

也许举个例子可以让规则 3 更清楚：让我们假设*Alice*正在使用专有的闭源设备*`<cough>`iPhone`<cough>`*访问互联网，或者她站在公共互联网信息亭前。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-20T14:37:48.043

我对人性化的低技术挑战-响应机制的想法：

1.  Bob 每次收到有效消息时都会更改挑战（例如，他对当前时间进行加盐哈希）
2.  每条发送给 Bob 的无效消息都会让他回复当前的挑战，因此 Alice 可以通过发送空邮件来查询他
3.  一旦 Alice 知道挑战，她就会去[https://www.pwdhash.com/](https://www.pwdhash.com/)
    *   在“站点地址”中，她进入了当前的挑战
    *   在“站点密码”中，她输入了她的个人密码（Bob 知道）
    *   PwdHash 生成“哈希密码”
4.  Alice 向 Bob 写了一条消息，使用刚刚创建的哈希作为主题
5.  Bob 收到消息，根据 PwdHash 算法对当前挑战和 Alice 的密码进行哈希处理，看看他的结果是否与消息主题匹配
6.  如果是，Bob 接受该消息并发送包含新挑战的确认（本质上这是第 1 步）

好处：

*   便宜又简单，甚至可以在相当现代的移动设备上运行
*   人性化（没有数学，容易记住，在网上很容易获得先决条件）
*   没有重放攻击可能
*   网络上没有明文密码
*   不会用完密码（就像一次性便笺簿一样）
*   没有固有的时间限制（就像 RSA 令牌一样）
*   PwdHash网站可以存盘，本地调用，这里没有第三方依赖

缺点：

*   Bob 和 Alice 必须预先共享一个密钥（Alice 的密码），因此 Alice 不能在场外更改她的密码
*   泄露 Alice 的密码是最简单的攻击媒介（但几乎所有受密码保护的系统都是如此）

请注意，PwdHash 是一种开放式散列算法，Bob 可以轻松实现它。PwdHash 网站无需回发即可工作，一切都只是客户端 JavaScript，没有留下任何痕迹。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-20T11:27:45.317

我能想到的两个选择：

*   发行一次性密码卡（事前沟通，笔记本）
*   产生密码的电子设备（避免重放攻击）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-20T12:36:40.393

除了[Treb 的回答](https://stackoverflow.com/questions/569183/poor-mans-authentication-algorithm/569265#569265)之外，您还可以使用可以打印的一次性密码来代替 SecurID。有关详细信息，请参阅“[完美纸密码](http://www.grc.com/ppp/design.htm)”。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-20T11:22:42.367

在建议使用简单的公钥/私钥并签署电子邮件时，我是否遗漏了一些明显的东西？

Firefox 至少有一个扩展允许 GPG 在 webmail 中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-20T11:41:59.323

详细说明[lassevks 答案](https://stackoverflow.com/questions/569183/poor-mans-authentication-algorithm/569209#569209)：

在我的公司，我们使用来自 RSA 的 SecurID 令牌进行远程身份验证。

它为您提供一个每 60 秒更改一次的 6 位数字作为身份验证令牌，*假设*您的令牌生成器和服务器是宇宙中唯一知道当前有效令牌的人。

作为一种低技术替代方案，可以向 Alice 提供一组 n（10、20、100 - 在您的特定情况下是合理的）一次性身份验证代码。我会问她一个特定的代码（例如列表中的数字 42）。使用此代码后，将失效，无法继续使用。

**编辑：**有关低技术解决方案的良好实施，请参阅[lacop 的答案。](https://stackoverflow.com/questions/569183/poor-mans-authentication-algorithm/569422#569422)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T11:32:36.350

如果 Alice 可以在她的机器上运行代码（例如通过使用在某个公共站点上找到的 JavaScript，例如：[http](http://www.functions-online.com/en/sha1.html) ://www.functions-online.com/en/sha1.html ），她可以接收挑战，哈希连同密码一起发回。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-20T11:37:39.443

考虑创建一个网页，其中包含作为 JavaScript 的算法，可能作为下载（这样她可以下载一次并随身携带在 USB 驱动器上）。

这个想法是她打开页面，检查源代码（所有 JavaScript 必须是内联的），然后在页面上的文本字段中输入她的密码。JavaScript 将在她键入时将其转换为代码（因此在她执行此操作时没有网络流量；如果有，则可能有一个键盘记录器在后台运行）。

获得代码后，她可以将其复制到某个地方。

JavaScript 可以使用当前时间作为种子。将当前时间切成五分钟的间隔。大多数情况下，使用当前时间就足以解码密码，如果您接近五分钟间隔的开始，请尝试使用前一个时间。

请参阅此站点以获取示例：[https ://www.pwdhash.com/](https://www.pwdhash.com/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-20T11:33:22.417

如果您不打算使用 PKI，这无疑是最好的解决方案，请尝试使用[CRAM-MD5](http://en.wikipedia.org/wiki/CRAM-MD5)之类的挑战-响应系统（尽管我建议使用不同的摘要算法）。

您的限制使安全加密系统的实施几乎不可行。你能做些什么来改变交通工具吗？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-20T11:34:02.150

这是另一个建议：

*   从[Diffie-Hellman 密钥交换](http://en.wikipedia.org/wiki/Diffie-Hellman)开始，产生一个共享私钥，*大概只有 Alice*和*Bob*知道。
*   有一个只有*Alice*和*Bob*知道的预定义密码。
*   让Alice使用共享密钥加密密码并将其发送*给**Bob*
*   现在*Bob*可以看到*大概-Alice*真的是*Alice*。

问题：

*   Diffie-Hellman 使用小数并不安全。
*   什么是简单的对称加密算法（用于加密密码）？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-20T16:33:25.253

最简单的解决方案是让 Bob 定期向 Alice 的邮件帐户发送邮件。当她需要 Bob 提供的东西时，她必须使用其中一封邮件进行回复。Bob 可以将一些检查令牌放入邮件中（邮件 ID，或必须在邮件主题或正文中重复的字符串）。

就像许多电子邮件验证方案一样。

缺点：这仅证明攻击者可以访问 Alice 的邮件帐户，而不是实际上是 Alice 本人。为了解决这个问题，您可以告诉 Alice 一个密码并使用“JavaScript HTML 页面”技巧，这样她就可以使用她的密码对来自 Bob 的密钥进行编码。

这将证明她可以访问她的邮件帐户并且她知道密码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T11:34:49.420

我能想到几种方法：

安装类似的 https 加密服务：

> [http://webnet77.com/cgi-bin/helpers/blowfish.pl](http://webnet77.com/cgi-bin/helpers/blowfish.pl)

或者

> [http://cybermachine.awardspace.com/encryption.php/](http://cybermachine.awardspace.com/encryption.php/)

或者您可以结合 XOR 加密发出一次性密码

或者你可以编写一个简单的Java App（如果可以在机器上执行Java），可以通过www加载并提供公钥加密。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-20T11:42:40.990

在不交换密码的情况下保护传输中的数据的一种简单方法是三向异或：

1.  Alice 使用她自己的密钥创建了几个字节。
2.  她用这些字节对数据进行异或，使它们不可读。
3.  Alice 将加密数据发送给 Bob
4.  Bob 使用他自己的密钥创建了几个字节。
5.  他用这些字节对数据进行异或。
6.  Bob 将双重加密的数据发回给 Alice
7.  Alice 再次应用她的 XOR 模式。现在，数据只用 Bob 的模式编码
8.  Alice 将数据发回给 Bob
9.  Bob 现在可以用他自己的模式解码数据

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-20T11:44:47.100

嗯……这算不算第三方？

设置 Bob - Charlie 的兄弟，他可以通过 HTTPS 从 Internet 访问。要向 Bob 发送消息，Alice 首先必须登录 Charlie（通过普通的旧密码），然后 Charlie 会给她一个一次性令牌。然后她将她的电子邮件连同令牌一起发送给 Bob。

# c++ - C++ MSXML2 - 从 XML 中删除命名空间

> ID：569184
> 
> 赞同：1
> 
> 时间：2009-02-20T11:17:37.650
> 
> 标签：c++, xml, namespaces

我需要一种能够从 C++ 中的 XML 文档中删除所有命名空间的好方法。目前，该文档已加载到 MSXML2::IXMLDOMDocument2Ptr 类中。

目前看不到任何可以做到这一点的方法

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T14:57:45.907

没有办法直接做，因为namespace+local-name本质上就是节点的名字。命名空间不是在属性上添加的。

您将需要使用全新的节点重新创建文档，但这可以在 XSLT 中更轻松地完成：

```
<xsl:template match='*'>
  <xsl:element name='{local-name(.)}'>
    <xsl:apply-templates select='*|@*|text()'/>
  </xsl:element>
</xsl:template>

<xsl:template match='@*'>
  <xsl:attribute name='{local-name(.)}'>
    <xsl:value-of select='.'/>
  </xsl:attribute>
</xsl:template> 
```

使用默认模板规则来处理文本节点，这应该可以工作（但未经测试）。

# macos - 如何使用 Applescript 在 Mail 中的选择之外选择下一条消息？

> ID：569187
> 
> 赞同：2
> 
> 时间：2009-02-20T11:19:00.813
> 
> 标签：macos, email, applescript

我写了一个简短的 Applescript 将选定的邮件移动到该邮箱的相关存档中。但是，当它运行时，不再有选择。（如果我然后按向上或向下，它会选择整个邮箱中的第一条或最后一条消息）。我不知道如何使用 AppleScript 在当前选择之外选择下一条消息。我真的不介意“下一个”是之前还是之后的消息，只要它在选择附近（即将消失）。

如果有帮助，这是我的 Applescript：

```
tell application "Mail"
    set selectedMessages to selection
    repeat with theMessage in selectedMessages
        set theAccount to account of mailbox of theMessage
        set read status of theMessage to true
        set mailbox of theMessage to mailbox "_old" of theAccount
    end repeat
end tell 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-05T18:44:49.043

尝试这样的事情：

```
tell application "Mail"
    set theSelection to selection
    set theMessage to item 1 of theSelection
    set theMailbox to theMessage's mailbox
    set theMessageID to theMessage's id
    set theMessageIDs to (id of every message of theMailbox)
    -- do work here
    set theMessages to (every message of theMailbox)
    repeat with i from 1 to (count theMessageIDs)
        if item i of theMessageIDs is theMessageID then
            set message viewer 1's selected messages to {item i of theMessages}
            exit repeat
        end if
    end repeat
end tell 
```

请注意，这假设了一些事情——只选择了一个邮箱，您没有移动最后一封邮件，等等。

# c++ - Boost被认为有害吗？

> ID：569198
> 
> 赞同：51
> 
> 时间：2009-02-20T11:23:44.437
> 
> 标签：c++, boost

这里的很多 C++ 问题的答案都包含响应：

> “您应该使用 boost::(在此处插入您最喜欢的智能指针) 甚至更好的 boost::(在此处插入您最喜欢的大型复杂 boost 类型)”

我完全不相信这对那些显然是 C++ 新手的提问者有任何帮助。我的理由如下：

*   在不了解幕后情况的情况下使用智能指针将导致一代 C++ 程序员缺乏程序员的一些基本技能。这似乎已经在 J​​ava 领域发生了。

*   决定使用哪种类型的智能指针在很大程度上取决于要解决的问题域。此处发布的问题几乎总是缺少这一点，因此简单地说“使用共享指针”可能至少没有帮助，而且可能完全错误。

*   Boost 还不是 C++ 标准的一部分，在提问者使用的特定平台上可能不可用。安装它有点痛苦（我只是使用[Jam](http://en.wikipedia.org/wiki/Perforce_Jam#Boost.jam)完成的），如果你想要的只是一些智能指针，那就太矫枉过正了。

*   如果您正在编写[FOSS](http://en.wikipedia.org/wiki/Free_and_open_source_software)代码，您不希望代码严重依赖外部库，同样，您的用户可能没有这些库。由于库之间依赖关系的拜占庭复杂性，我曾多次推迟使用 FOSS 代码。

总而言之，我并不是说不推荐 Boost，而是说我们在这样做时应该更加小心。

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-02-20T11:31:44.747

几点：

*   在不理解的情况下使用任何东西都被认为是有害的。但最终被烧毁的只有无知的技术用户（和他的经理）。
*   您不必安装 boost 来获取智能指针 - 它们只是标题。安装本身相当简单，最简单的方法是输入一两个命令。
*   许多 Boost 库和解决方案都存在于 TR1 中或将存在于 C++0x 中
*   您将始终依赖外部库...尝试选择在维护和支持方面具有光明前景的库。
*   除非你想推出你的定制解决方案——这会有一些优点和缺点。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2009-02-20T13:20:45.093

C++ 不是一种对新手友好的语言。向 Scott Meyers 道歉，初学者学习 C++ 的不仅仅是一种语言，而是四种：

1.  C部分
2.  面向对象部分：类、继承、多态等。
3.  STL：容器、迭代器、算法
4.  模板和元编程

我认为如果初学者已经在攀登这座山，他们应该从一开始就指向 C++ 更“现代”的方面。否则意味着初学者将使用常规指针、资源泄漏等来学习 C-ish C++。发现自己陷入了痛苦的世界，然后发现 Boost 和其他库作为阻止伤害的一种方式。

无论如何，这都是一幅复杂的画面，那么为什么不将他们指向一个对所投入的精神努力有积极回报的方向呢？

至于依赖关系，大量的 Boost 只是标题。Boost 的自由许可证应该允许它包含在几乎任何项目中。

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2009-02-20T12:48:21.147

你知道编译器是如何工作的吗？你知道操作系统是如何工作的吗？你知道处理器是如何工作的吗？你知道电子产品是如何工作的吗？你知道电是怎么工作的吗？

在某些时候，您正在使用黑匣子，问题是，“我的无知对我目前正在做的事情有问题吗？”。

如果你对知识有品味，那是一件好事——我在面试工程师时显然认为这是一个加分项——但不要忘记你工作的最终目的：构建解决问题的系统。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2009-02-20T11:30:27.353

我不同意。没有人会建议您在没有彻底了解幕后发生的事情的情况下深入研究智能指针，但明智地使用它们可以消除大量常见错误。此外，Boost 是高质量的生产代码，C++ 新手可以从中学到很多东西，包括设计和实现。它也不是非常复杂，你可以挑选你需要的部分。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-02-20T12:47:12.303

*   不可能一直透彻地理解一切。因此，请相信许多专业 C++ 开发人员的话，boost 的许多部分确实是在您的日常开发中使用的非常有用的东西。
*   在 C++0X 中包含相当多的提升证明即使是管理语言发展的团队也认为提升是一件好事（tm）
*   C++ 是一种奇怪的、难懂的语言。与难以掌握的难度相比，它相对容易学习。你可以用它做一些非常神秘的事情。Boost::mpl 建立在一些神秘的东西之上。我喜欢 boost，但每次看到我的组织中有人使用 boost::mpl 时，我都会感到畏缩。原因：即使是经验丰富的 C++ 开发人员也难以理解它是如何工作的，而使用它的代码通常反映了这一点（它最终看起来就像是有人敲打代码直到它工作为止）。这*不是*一件好事，所以我部分同意不应该谨慎使用 boost 的某些部分（boost::spirit 是另一个例子）。
*   C++ 标准也是一个奇怪的东西。大多数常见的编译器并没有实现所有现有的标准（例如模板导出）。这只是预期的指导方针。
*   如果您的开发人员没有能力决定在特定情况下使用哪个智能指针，也许他们不应该在没有高级指导的情况下乱搞代码的那部分。
*   从运行时开始，总是有外部库。很多提升只是标头，因此它不会*引入*新的外部依赖项。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-02-20T12:11:05.137

坦率地说，对于初学者来说，我认为 boost 并不是那么适合。我认为初学者最好先了解基础知识是如何工作的，然后再使用更高级别的工具/库（如 boost 甚至 STL）向上移动。在初学者阶段，这不是关于生产力，而是关于理解。我认为了解指针是如何工作的，例如能够手动创建一个链表或对一个链表进行排序是每个程序员都应该学习的基础知识的一部分。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-02-20T11:38:47.600

我认为 boost 是一个很棒的库。我喜欢它。我最喜欢的库是 boost::bind 和 boost::function，它们使函数指针更加灵活和易于使用。它非常适合不同的框架并保持代码整洁。

我也使用不同的 Boost 类。例如，我使用 boost::graph 创建图形类，并使用 boost::filesystem 处理目录中的文件。

但是，boost 非常复杂。你需要成为一个有经验的程序员才能知道它的价值。此外，您需要至少有一些 C++ 经验才能了解 Boost 的工作原理以及在此处或此处使用 Boost 的含义。

因此，我强烈建议有经验的程序员使用 Boost，尤其是当他们（再次）试图重新发明轮子时。它真的可以像它在锡上所说的那样：朝着你的目标前进。

但是，如果您觉得提出问题的人是初学者并试图理解（例如）内存分配，那么告诉他尝试提升智能指针是一个非常糟糕的主意。这根本没有帮助。只有当人们体验了标准内存分配技术的工作原理时，才能理解智能指针类等的优点。

最后，Boost**不像**学习驾驶自动变速箱的汽车。这就像学习驾驶 F1 赛车。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-02-20T12:48:52.767

我完全同意你的看法。这就是我首先向他们解释应该如何完成的原因（即在推荐 boost::variant 时，我解释他们通常应该使用有区别的联合。我尽量不要说这只是一个“神奇的提升”，而是展示他们原则上是如何实现的。当我推荐 boost::shared_ptr 时，我解释说他们需要使用指针 - 但最好使用具有共享所有权语义的智能指针。）。`boost::xxx`当我看到提问者是初学者时，我尽量不说“使用”。它是一种不像某些脚本语言那样简单易用的语言。必须了解自己使用的东西，因为语言不能保护程序员免于做坏事。

当然，新手不可能从一开始就理解所有内容。但他们应该了解他们的 boost 库解决了什么以及它是如何实现的。

您无法将其与首先学习处理器或汇编语言进行比较。类似地，知道空指针的位模式是什么样子并不重要。这些知识与学习 C++ 编程无关。但 C++ 中的指针、数组或任何其他*基本*事物都不是。在使用`[boost|std]::shared_ptr`或`[boost|std]::array`成功地。在我看来，为了成功使用 boost 实用程序，必须首先了解这些内容。这与如何使用原始指针手动实现 pimpl-idiom 之类的细节无关——这不是我要说的重点。但关键是，首先应该了解关于指针或 boost 库帮助的其他部分的基本知识（例如，对于指针，它们是什么以及它们有什么用处）。只需查看 shared_ptr 手册并尝试在不了解指针的情况下获取它。不可能。

重要的是始终将他们指向适当的提升手册。Boost 手册质量很高。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-02-20T12:43:54.963

几乎所有答案的共识是，对于经验丰富的开发人员和复杂的、现实世界的 C++ 软件来说，boost 非常有价值。我完全同意。

我也认为提升*对于*初学者来说非常有价值。使用 lexical_cast 不是比使用 ostringstream 更容易吗？或者使用 BOOST_FOREACH 代替迭代器语法？最大的问题是缺乏良好的 boost 文档，尤其是对于初学者。需要的是一本书，它会告诉你如何从 boost 开始，哪些库是简化任务的简单库，哪些库更复杂。将这些库与良好的文档一起使用将使 IMO 更容易学习 C++。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-03-06T15:30:38.563

我们应该尽可能鼓励使用标准的罐装库（而 Boost 几乎是标准的）。

有些人似乎认为初学者应该先学习 C++ 的 C 方面，然后再介绍更高层次的东西。然而，人们倾向于在受过训练的情况下工作，所以我们将看到很多使用管理不善的原始指针（管理良好的原始指针有时非常困难）、数组（以及删除之间不可避免的混淆）编写的生产代码并删除 []) 之类的东西。我用过这样的代码。我不想再做一次了。

以您希望他们编写代码的方式开始初学者。这意味着首先要教他们 STL 容器和算法以及一些 Boost 库，所以当他们需要一组东西时，他们首先想到的是 vector<>。然后教他们低层次的构造，这样当他们遇到它们时，或者在非常罕见的情况下需要微优化时，他们就会知道它们（或在哪里查找它们）。

基本上有两种类型的程序员：程序员，他们应该以他们应该编写的方式学习语言，以及爱好者，他们将学习低级的东西，包括操作系统原理、C、汇编代码等. 两者都可以通过学习他们将要使用的语言来得到很好的服务，而只有爱好者才能通过学习一些任意级别的基础知识来得到很好的服务。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-02-20T20:56:03.423

> 我完全不相信这对那些显然是 C++ 新手的提问者有任何帮助。...：
> 
> *   在不了解幕后情况的情况下使用智能指针将导致一代 C++ 程序员缺乏程序员的一些基本技能。

我们是否告诉新手程序员他们必须先学习汇编语言才能阅读现代编程语言？他们显然不知道引擎盖下发生了什么。

“Hello World”是否应该包含 I/O 子系统的实现？

就我个人而言，在我学会如何编写类之前，我学会了如何构造对象。我想我在学习 C 风格的数组之前就学会了如何使用 STL 向量。我认为这是正确的方法：“这里是如何使用 a 来引用几个几乎相同的变量`std::vector`，稍后我将向您展示通过 C 样式数组和`new[]`and扫过地毯下的内容`delete[]`。”

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-03-06T15:14:23.923

我认为你混合了很多不同的问题，并不是所有的问题都与 Boost 相关：

首先，是否应该鼓励程序员（或特别是 C++ 新手）使用他们不理解的库、习语、范式、语言或语言特性？

*   不，当然不是。每个程序员都应该了解他们使用的工具，*尤其是*像 C++ 这样的语言。但是，我在这里没有看到很多关于 SO 的问题，鼓励人们不理解他们正在使用的代码。当人们说他们想在 C++ 中做 X 时，我认为会说“Boost 有一个 X 的实现，它可以工作，这比自制解决方案做得更多，所以使用它”。

当然，如果问题是“X 是如何工作的”，则无法用“使用 Boost 的实现”来回答这个问题。但是对于前一种问题，我真的没有看到推荐 Boost 的问题。

我也看不出如何在不了解引擎盖下发生的事情的情况下使用 Boost。无论有没有 Boost，C++ 都不是 Java。使用 Boost 绝不会保护您免受语言的复杂性影响。你仍然需要担心复制构造函数、指针算法、模板和其他所有可能在你面前爆炸的东西。

这与 Java 中发生的情况完全不同。他们设计了一种语言，消除了所有的微妙之处。Boost 不会那样做。恰恰相反，它在泛型编程中开创了新的习语和技术。使用 Boost 并不总是那么简单。

关于 Boost 的可用性，我认为这不是问题。在绝大多数问题中使用的平台上都可以使用它，如果他们无法使用 Boost，那么该建议仍然没有*害处*，只是没用。

此外，大多数 Boost 库都是只有头文件的，不需要你安装整个东西。如果您只需要智能指针，只需包含这些标头即可。

关于 FOSS，在某些情况下你有一个观点但我想说这是用户*没有*的通用性较低的库的问题。但是 Boost*非常*普遍，如果人们没有它，他们应该得到它，因为它几乎适用于任何问题领域。当然，该许可证与您提到的任何 FOSS 项目兼容。我宁愿从事一个使用 Boost 来完成繁重工作的 OSS 项目，而不是重新发明自己的（有缺陷的和专有的）轮子的项目，因为陡峭的学习曲线是可以避免的。

所以，是的，在某些情况下，推荐 Boost 是没有帮助的。但我不明白它是如何有害的。

无论如何，我看不出它的危害甚至比教新手自己*滚动的*危害还要大。在 C++ 中，这是灾难的根源。这是 C++ 仍然以容易出错和产生错误软件而闻名的唯一原因。因为很长一段时间以来，人们都是自己从头开始编写所有东西，不信任标准库，不信任第三方代码，不信任 C 语言中所有不合法的东西。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-02-20T11:40:43.197

我不同意。当然，与使用 3rd 方库相比，从头开始编写代码时，您总是会更了解所有事物的内部工作原理。但是时间和金钱是有限的，使用像 boost 这样的好的 3rd 方库是节省资源的好方法。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-02-20T11:32:20.157

我明白你的意思，但理解某些东西并不意味着你必须从头开始重写所有内容。

它们不是“标准的”，但它们是图书馆所能获得的标准。

确实，部署它们可能会很痛苦（但并非所有子库都需要编译）；另一方面，他们自己没有进一步的依赖关系，所以我也不会太担心那部分。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-03-06T15:08:30.037

我同意你的看法，高级库对你隐藏了一些东西。从短期来看，这可能是个好主意，但从长远来看，新手对语言的理解会有很大的差距。

对于我们这些非新手来说，说“只使用这个库”很容易，因为我们已经走过了漫长而艰辛的学习之路，自然我们想省去别人做同样事情的麻烦。

新手应该努力使用自己的低级解决方案来解决问题。然后，当他们更好地了解自己的解决方案如何工作时，他们可以使用第三方解决方案，并确信他们对幕后发生的事情有所了解。他们会更好地使用那个库！

我认为这是一个更广泛的主题，而不仅仅是关于 Boost。我完全后悔选择 VB 作为我的第一语言。如果我刚从丑陋、难学的 c 开始，我会比现在领先几年。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-05-09T23:58:55.940

范围和动态资源所有权是一般的基本需求，boost 的实现非常好，强烈推荐。我经常使用它们，它们工作正常。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-20T12:32:32.510

我同意关于智能指针的观点。我是一个 C++ 初学者，当问一个关于指针语法的简单问题时，一个[答案](https://stackoverflow.com/questions/558474/what-makes-more-sense-char-string-or-char-string/558520#558520)建议智能指针是要走的路。我知道我还没有为提升做好准备（我也没有真正为 STL 做好准备），所以在大多数情况下，我会避开那种建议。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-20T20:45:44.803

Boost 是一个很棒的库。我真的希望它在广度和接受度方面有所增长。使用它，扩展它，推广它。

.NET 社区的一大优点是它有一个很棒的基类库。我相信 C++ 的基本问题之一是简约的 C++ 标准库。无论您去哪里开发代码、FOSS 或公司，都可以选择使用一些库，因为没有广泛的标准库。所以你最终会成为一个 INSERT_YOUR_COMPANY_HERE C++ 程序员，而且不一定太容易转移。是的，您的设计/架构技能转移，但是学习曲线需要熟悉下一个地方正在使用的任何库集。.NET 开发人员基本上将使用相同的类库并且可以开始运行。此外，构建（和重用）的库具有更广泛的构建基础。

顺便说一句，您可以使用[http://codepad.org](http://codepad.org)作为代码粘贴箱，它支持 boost！

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-21T01:55:03.157

我曾为那些将 boost 视为库以避免部分原因的公司工作，部分原因是它过去的声誉是一个管理不善的项目。我知道项目已经发生了变化，但是想要使用 boost 的商业项目必须知道库中包含的代码的来源，或者至少确保他们不会对知识产权或专利侵权负责.

可悲的是，图书馆有这样的声誉，它需要一段时间才能在商业领域广泛使用之前打破。我也觉得这是一个不盲目推荐的理由。

# .net - 如何按字母顺序排列属性 (Visual Studio 2008)

> ID：569206
> 
> 赞同：1
> 
> 时间：2009-02-20T11:26:33.103
> 
> 标签：.net, visual-studio, visual-studio-2008

我真的很肛门，想按字母顺序/按类型排序我的类属性。

这是否可以使用 VS 中预先存在的功能或可以做到这一点的宏？

例如：

```
public string foo {get; set;}
public string bar {get; set;}
public int fong {get; set;}
public string loo {get; set;} 
```

to （如果您想按字母顺序排列）

```
public string bar {get; set;}
public int fong {get; set;}
public string foo {get; set;}
public string loo {get; set;} 
```

或（如果您想按类型排序，然后按字母顺序）

```
public string bar {get; set;}
public string foo {get; set;}
public string loo {get; set;}
public int fong {get; set;} 
```

非常感谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2015-10-12T12:28:33.157

我知道一个不同的解决方案。将您的代码复制到`Excel`然后将其复制回`Visual Studio`.

1.  在 VS 中复制您的文本/代码
2.  启动 Excel
3.  在 Excel 中插入文本/代码
4.  选择你的文本/代码
5.  项目清单
6.  右键单击它
7.  点击排序
8.  点击从A到Z
9.  您的文本/代码现在已排序。在 Excel 中选择您的文本/代码
10.  复制您的文本/代码并将其粘贴到 VS

[![在此处输入图像描述](https://i.stack.imgur.com/hke1b.png)](https://i.stack.imgur.com/hke1b.png)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T18:13:48.297

据我所知，DevExpress 的[CodeRush/Refactor](http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/)（通过附加组件）以及[Resharper](http://www.jetbrains.com/resharper/features/code_formatting.html)通过其代码格式化功能都支持这一点。

马克

# .net - Linq2XML，为什么 Element()、Elements() 不起作用？

> ID：569208
> 
> 赞同：4
> 
> 时间：2009-02-20T11:27:36.660
> 
> 标签：.net, xml, linq, linq-to-xml

我正在尝试遍历一个简单的站点地图（动态添加和删除元素。）这是示例布局

```
<?xml version="1.0" encoding="UTF-8"?>
<urlset
      xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9
            http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd">
  <url>
    <loc>http://mysite.com/</loc>
    <priority>1.00</priority>
    <changefreq>daily</changefreq>
  </url>
  <url>
    <loc>http://mysite.com/Default.aspx</loc>
    <priority>0.80</priority>
    <changefreq>daily</changefreq>
  </url>
</urlset> 
```

奇怪的是，当我在加载文档后尝试使用 Element() 方法访问子元素时，它为 null，Elements() 也是如此，所以我无法遍历它们。Nodes() 方法虽然有元素。

这是我写的代码

```
XElement siteMap = XElement.Load(Server.MapPath("~/sitemap.xml"));

//First remove all article nodes
foreach (XElement elem in siteMap.Elements())
{
    XElement loc = elem.Element("loc");
    if (loc.Value.Contains("http://mysite.com/articles/"))
        elem.Remove();
} 
```

无论我做什么来尝试检索 elem (Element, Elements) 的元素，我都会得到一个空值。

有什么问题？此代码应该运行。不是吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T11:32:00.050

```
var doc = XDocument.Load(Server.MapPath("~/sitemap.xml"));
foreach (XElement elem in doc.Root.Elements()) {
     var loc = elem.Element(XName.Get("loc","http://www.sitemaps.org/schemas/sitemap/0.9") );
     if (loc.Value.Contains("http://astrobix.com/articles/"))
         elem.Remove();
} 
```

您也可以改为执行以下操作：

```
doc.Root.Elements()
   .Where(x => x.Element(XName.Get("loc", "http://www.sitemaps.org/schemas/sitemap/0.9"))
                .Value.Contains("http://astrobix.com/articles/"))
   .Remove(); 
```

# php - 泛滥菜单（php、javascript、ajax）有问题吗？

> ID：569215
> 
> 赞同：0
> 
> 时间：2009-02-20T11:30:15.077
> 
> 标签：php, javascript, ajax

我的网站上有两个下拉菜单。使用的技术有 Javascipt、php、mysql。

```
City : [        ] 
Area : [        ] 
```

TODO：当用户选择城市时，我想在数据库中查询城市区域并动态填充区域下拉菜单。

当用户选择区域时，我想再次查询数据库以获取属于该特定区域和城市的结果。

像这样的东西（一步一步）。

```
------------------------1
City:[Choose City]
------------------------2
City :[New York]
------------------------3
City :[New York] 
Area : [Choose Area]
------------------------4
City :[New York] 
Area : [Times Square]
    ------------------------4

10 Results Found for New York/Times Square:
1 . Result1 .
2 . Result2
...
..
. 
```

这是数据库架构：

```
CREATE DATABASE `db_results` ;

CREATE TABLE `tbl_results`(
    `result_id` INT NOT NULL AUTO_INCREMENT,
    `result_title` VARCHAR(20),
    `result_content` TEXT,
    `result_category` INT,
    `result_city` INT,
    `result_area` INT,
    PRIMARY KEY(`result_id`),
);

CREATE TABLE `tbl_area`(
    `area_id` INT NOT NULL AUTO_INCREMENT,
    `area_name` VARCHAR(50),
    `area_city` INT,
    PRIMARY KEY(`area_id`)
);

CREATE TABLE `tbl_cities`(
    `city_id` INT NOT NULL AUTO_INCREMENT,
    `city_name` VARCHAR(40),
    PRIMARY KEY(`city_id`)
); 
```

我创建了脚本来动态淹没菜单，但是当我使用动态生成的菜单查询数据库时，它会给出错误，即“区域”是未定义的索引。

这是文件的链接： **[文件](http://webwonderland.googlepages.com/problem4)**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T12:48:52.453

没有太多信息可以继续，但是从您的 php 错误通知中，您正在尝试访问结果数组/数据库表中不存在的索引（来自您的 tbl_area 定义 - 并假设您的查询返回所有字段 - area_id、area_name 和area_city 都是有效的指标，但 'area' 不是）。

# ocx - 运行 regsvr32 /s /c "myocx.ocx" 需要哪些权限/权限

> ID：569218
> 
> 赞同：10
> 
> 时间：2009-02-20T11:30:40.863
> 
> 标签：ocx, regsvr32

我将 WindowsXP 配置为构建机器。构建过程在不是管理员的帐户下运行。

一些项目在最后一步注册一个 ocx 控件，例如

```
regsvr32 /s /c ".\debug\myocx.ocx" 
```

此步骤失败，我认为这与权限有关，因为在管理员帐户下执行相同操作可以正常工作。

我需要为构建帐户提供哪些权利/权限/策略，我在哪里做？（浏览本地用户和组以及本地安全设置对我没有帮助）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-20T12:30:23.340

通过 regedit，您需要在“HKEY_CLASSES_ROOT.

右键单击 HKEY_CLASSES_ROOT 并选择权限...完全控制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T12:07:26.423

注册 OCX 归结为在 HKLM 下的注册表中写入条目。默认情况下，非管理员帐户在那里没有权限，而且我不太确定您的构建帐户是否应该（在我的书中安装调试 OCX 仍然是“安装”（相对于构建））。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-01-24T20:01:18.433

## 无需管理员身份即可应用 regsvr32 权限的 PowerShell 脚本

虽然可以只[授予对 HKCR key 的完全控制权](https://stackoverflow.com/a/569404/3063884)，但这可能会导致授予不必要的访问权限。在研究如何做到这一点时，有一次我最终获得了 HKCR 的权限，导致需要重新映像我的机器。为了想出这个脚本，我使用了[procmon](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon)工具，并过滤了注册表权限被拒绝，然后在脚本中授予它们。

以下 PowerShell 脚本仅对我确定注册 DLL（以及 OCX）所必需的那些键创建（非继承）权限。这允许单个帐户（在本例中为构建服务器代码构建器帐户）被授予注册 DLL 的访问权限，而无需成为管理员。将第一个变量 - `$buildAcctUserName`- 替换为设置规则时要使用的帐户。

```
$buildAcctUserName = "AzureDevOpsBuilder"

# Create Rule for full control of keys that need to be added to/updated/deleted from
$user = New-Object System.Security.Principal.NTAccount("$($env:COMPUTERNAME)\$buildAcctUserName")
$rule = New-Object System.Security.AccessControl.RegistryAccessRule(
  $user, 
  [System.Security.AccessControl.RegistryRights]"FullControl", 
  [System.Security.AccessControl.InheritanceFlags]"ContainerInherit, ObjectInherit",  <# ContainerInherit / None / ObjectInherit #>
  [System.Security.AccessControl.PropagationFlags]::None, 
  [System.Security.AccessControl.AccessControlType]::Allow)

# Grant access to HKCR
$regHKCRHive=[Microsoft.Win32.RegistryHive]::ClassesRoot;
$regHKCRBaseKey=[Microsoft.Win32.RegistryKey]::OpenBaseKey($regHKCRHive,[Microsoft.Win32.RegistryView]::Default)
$regkey=$regHKCRBaseKey.OpenSubKey("", $true) 
$acl = $regkey.GetAccessControl()
$acl.SetAccessRule($rule)
$regkey.SetAccessControl($acl)

# Grant access to HKLM\Software
$regHKLMHive=[Microsoft.Win32.RegistryHive]::LocalMachine
$regHKLMBaseKey=[Microsoft.Win32.RegistryKey]::OpenBaseKey($regHKLMHive,[Microsoft.Win32.RegistryView]::Default)
$regkey=$regHKLMBaseKey.OpenSubKey("SOFTWARE", $true) 
$acl = $regkey.GetAccessControl()
$acl.SetAccessRule($rule)
$regkey.SetAccessControl($acl)

# Grant access to HKLM\Software\Wow6432Node
$regkey=$regHKLMBaseKey.OpenSubKey("SOFTWARE\Wow6432Node", $true) 
$acl = $regkey.GetAccessControl()
$acl.SetAccessRule($rule)
$regkey.SetAccessControl($acl)

# Grant access to HKCR\Wow6432Node\CLSID
$regkey=$regHKCRBaseKey.OpenSubKey("Wow6432Node\CLSID", $true) 
$acl = $regkey.GetAccessControl()
$acl.SetAccessRule($rule)
$regkey.SetAccessControl($acl)

# Grant access to HKCR\TypeLib
$regkey=$regHKCRBaseKey.OpenSubKey("TypeLib", $true) 
$acl = $regkey.GetAccessControl()
$acl.SetAccessRule($rule)
$regkey.SetAccessControl($acl)

# Grant access to HKCR\Wow6432Node\Interface
$regkey=$regHKCRBaseKey.OpenSubKey("Wow6432Node\Interface", $true) 
$acl = $regkey.GetAccessControl()
$acl.SetAccessRule($rule)
$regkey.SetAccessControl($acl)

# Grant access to HKCR\Interface
$regkey=$regHKCRBaseKey.OpenSubKey("Interface", $true) 
$acl = $regkey.GetAccessControl()
$acl.SetAccessRule($rule)
$regkey.SetAccessControl($acl)

# Grant access to HKCR\AppID
$regkey=$regHKCRBaseKey.OpenSubKey("AppID", $true) 
$acl = $regkey.GetAccessControl()
$acl.SetAccessRule($rule)
$regkey.SetAccessControl($acl) 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-20T11:50:18.680

请检查 regsvr32 的错误消息，如

[http://support.microsoft.com/kb/249873](http://support.microsoft.com/kb/249873)

而且我也不确定 /c 开关..

希望这可能会有所帮助。

# c# - 异常捕获最佳实践 (c#/.net)

> ID：569227
> 
> 赞同：5
> 
> 时间：2009-02-20T11:32:18.863
> 
> 标签：c#, exception

如果我有这样的代码：

```
void a()
{
    try
    {
        b();
    }
    catch (MyException)
    {
        // Handle any problems that occurred in b(c(d()))
    }
}

void b()
{
    c();
    // Do something else
}

void c()
{
    d();
    // Do something else
}

void d()
{
    // Do something, throw a MyException if it fails
} 
```

假设在任何时候都不需要清理，最好在 c() 中对 d() 的调用和 b() 中对 c() 的调用周围放置一个 try{}catch{throw;} 还是认为可以让 d() 的异常“自然地”冒泡到 a() 而没有任何干预 try/catch 块？

我想额外的 try/catch 块充当一种“文档”，但它们似乎是多余的，所以我只是想知道其他人会认为最好的方法是什么。

抱歉，如果这有点太基本了，我正在努力解决例外情况，但我似乎对它们还没有很好的感觉。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T11:34:19.030

让它传播，直到你可以处理它。如果你不能处理它，那么抓住它是没有意义的。那么问题来了，你能有效地处理`c()`方法内部的异常吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T11:40:27.253

基本上，没有。这不是处理这些情况的建议方法。

当且仅当您可以处理异常并对其进行适当的处​​理或向调用堆栈中更高的调用者提供更多信息（通过将其封装在更通用的异常中）时，您才应该捕获异常。如果你做不到，你应该让异常在调用堆栈中冒泡，直到有人可以适当地处理它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T12:41:46.107

异常的最大优点是您可以处理可以对它们做一些事情的问题，而不是直接在检测到丢失文件的函数中，或者在函数的调用者或其调用者中，&c。

然而，异常也**必须**在链中的某个地方处理。这些点出现在哪里取决于您使用的框架，以及它的异常管理包含什么。关键问题是：您*的切入点*是什么，允许异常逃脱未被捕获会产生不良影响？典型例子包括

1.  [交互式 UI 应用程序中的事件处理代码（至少在 WinForms 和 ASP.NET 中可以通过提供异常事件处理程序](http://social.msdn.microsoft.com/forums/en-US/csharpgeneral/thread/06097037-dc26-4169-88be-fb70161fb748)来集体捕获）。
2.  响应外部消息的集成点（例如，从队列中获取消息、处理文件、侦听命名管道、实现[WCF](http://msdn.microsoft.com/en-us/library/aa480210.aspx)服务）。
3.  进行后台处理的计时器事件。
4.  线程启动方法。

有时，您还希望捕获低级别的一般技术错误并将其作为更特定于域的异常重新抛出。这通常在精心设计的库中完成，以保护用户免受其内部实现细节的影响。在企业应用程序中，您可能希望捕获某些 SqlExceptions 并将它们作为特定于应用程序的异常（例如 YourApp.UnknownCustomer）重新抛出，以便在更高级别的逻辑上处理它们。

我的建议是：尽可能在最高级别处理问题，但要确保那里的异常捕获器有合理的异常可以处理。顺便说一句，除非您讨厌您的用户，否则不要向他们显示异常及其堆栈跟踪！;-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T11:38:51.657

我会说，这取决于你想用这些信息做什么。

我总是试图在尽可能接近源头的地方发现问题——为什么要一直追回问题，而不是试图在问题发生的地方处理它？为了代码的可读性和理解，我也相信 try/catch 尽可能接近问题的根源。

如果您正在为自己编写程序，并且没有其他人会接触它，那么请为您和代码做最适合您的事情。

# sql-server - 是否有任何工具可以在 Microsoft SQL Server (MSSQL) 上进行迁移（如 Ruby）？

> ID：569230
> 
> 赞同：2
> 
> 时间：2009-02-20T11:32:39.877
> 
> 标签：sql-server, migration

是否有任何工具或“最佳实践”用于在 MSSQL 上创建迁移？我有一个开发和生产数据库，开发数据库经常创建新的 SPROC，偶尔还会添加结构。我希望能够在每次迭代期间编写一组脚本来更新开发服务器，然后在发布时执行所有脚本以更新生产。在红宝石中，我可以通过迁移来做到这一点 - 有没有等价的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T11:39:22.857

有几个：

*   [在 SQL Server 上运行的 Rails 迁移](http://wiki.rubyonrails.org/rails/pages/HowtoConnectToMicrosoftSQLServer)
*   [RikMigrations](http://www.rikware.com/RikMigrations.html)
*   [塔伦蒂诺](http://code.google.com/p/tarantino/)
*   [迁移者.NET](http://code.google.com/p/migratordotnet/)
*   [机器迁移](http://blog.eleutian.com/2008/04/25/AFirstLookAtMachineMigrations.aspx)
*   [亚音速迁移](http://blog.wekeroad.com/2007/10/03/subsonic-migrate-me/)
*   [dbDeploy.NET](http://dbdeploy.com/2007/09/25/dbdeploynet-v10-officially-released/)
*   [流利的迁移者](http://wiki.github.com/enkari/fluentmigrator)

[来源](http://flux88.com/blog/net-database-migration-tool-roundup/)

对于它的价值，我最喜欢的是 Fluent Migrator。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-10-17T21:54:59.983

在 Red Gate，我们现在有了一个使用 SQL 比较和 SQL 源代码控制的迁移解决方案。

[http://www.red-gate.com/MessageBoard/viewtopic.php?t=14107](http://www.red-gate.com/MessageBoard/viewtopic.php?t=14107)

它目前是一个早期访问版本，将于今年年底推出，因此我们渴望获得尽可能多的反馈。

# programming-languages - 格式与语言

> ID：569232
> 
> 赞同：1
> 
> 时间：2009-02-20T11:33:01.123
> 
> 标签：programming-languages, binary

[在 SO 宇宙的其他地方](https://stackoverflow.com/questions/568671/why-should-i-use-a-human-readable-file-format/568683#568683)，一场风暴已经肆虐了一段时间。关于人类是否应该更喜欢他们可以阅读的东西而不是他们不能阅读的东西。这让我在长时间的中断后摘下思考帽，向开明的人提出一个问题：

> 格式何时演变为特定领域的语言？或者，我如何决定是否需要人类可读格式或领域特定语言。PostScript 是引发这一切的想法。

**PS：**请原谅开场白；mod-down/close 如果这已经被问过了。 **PPS：**当我说语言时，我的真正意思是一种带有条件、循环等的编程语言。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T11:39:35.880

真的取决于为什么人类可能想要阅读它。

许多潜在可读的格式（例如 HTML）在机器生成时可能非常难以阅读。

无论如何，真正的程序员会在早餐时阅读核心转储:-)

至于语言问题，这将取决于定义（并且“DSL”没有明确定义）。我会说需要一个执行元素（多么模糊），如果它只是数据的二进制序列化，那么我不会称它为一种语言（例如许多光栅格式）。

* * *

进一步考虑这一点，这里似乎有两个潜在的相互关联的问题：

*   文本（可能人类可读）或二进制（对人类读者来说很难）更好（其中包含整个不可操作性方面）。
*   格式什么时候变成 DSL。

虽然第一个问题在其他地方有所涉及，但它不能与后者完全分开。毕竟有以二进制格式保存的 DSL（例如 Word 宏）和可以编译的 DSL（例如 .NET SDK 包含将 XSLT 转换为程序集的工具）。

这使我认为提出的真正问题是：是什么使格式成为 DSL。这里的问题是“DSL-ness”在旁观者眼中非常依赖于上下文。

HTML 是 DSL 吗？具有事件处理程序属性和 JavaScript 的 HTML 是 DSL 吗？第一个是有争议的，后者很难说不，因为肯定使用了程序代码。

我对这个问题的最初反应是认为 DSL 需要某种形式的定向执行。即在处理DSL 应用程序修改它的操作。进一步思考，这是一个过于宽泛的定义。考虑一个没有宏的文字处理应用程序。加载的文档明显支配应用程序的状态并驱动其性能。

这导致了基于人工创作的第二个潜在定义，以直接用语言指定指令以指导一个（或一类）应用程序。然而，这很模糊。但至少避免了 WP 文档成为 DSL。

因此，我目前的回答是：重要吗？DSL 或格式是让计算机做事的工具，学术定义并没有真正推动这项活动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T11:35:35.907

> 格式何时演变为特定领域的语言？或者，我如何决定我想要 > HRF 还是 DSL。PostScript 是引发这一切的想法。

每种格式都可以看作是一种语言。因为它需要规则来理解消息。需要完全指定计算机可读语言，不能有任何误解。

所以你可以说它们不需要进化，因为它们已经是语言了。

我使用了以下定义：

*   HRF（人类可读格式），几乎任何书面格式。
*   DSL（域特定语言），用于单一目的的语言。

如果您将语言的定义限制为仅包括包含循环和分支的编程语言。故事变了。简单的 INI 文件不需要这些结构。但是宏语言可以。所以你可以说，只有描述行为（序列、基于数据的决策）的语言才有可能演变成一种语言。

# .net - 如何在“#,##0”和“{0:n2}”样式格式字符串表示之间进行转换？

> ID：569242
> 
> 赞同：0
> 
> 时间：2009-02-20T11:36:18.137
> 
> 标签：.net, formatting, string-formatting

.NET 支持两种类型的字符串格式。

我处于现有配置数据具有`#,##0`样式格式的情况。一项新功能需要格式化为相同的输出，但此功能所需的 API 只接受 type 的格式`{0:n2}`。

有谁知道在这两种数字类型表示之间进行转换的方法？ `DateTime`可以忽略。

**编辑**我了解到：

*   该`{0:n2}`样式被称为[标准数字格式](http://msdn.microsoft.com/en-us/library/dwhawy9k(VS.80).aspx)

*   该`#,##0`样式称为[自定义数字格式](http://msdn.microsoft.com/en-us/library/0c899ak8(VS.80).aspx)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T12:43:23.013

不，你不能。

从您指向有关标准格式字符串[的 MSDN 文章的链接，您会发现：](http://msdn.microsoft.com/en-us/library/dwhawy9k(VS.80).aspx)

> 实际的负数模式、数字组大小、千位分隔符和小数分隔符由当前的 NumberFormatInfo 对象指定。

因此，标准格式说明符将根据程序运行的文化而有所不同。

由于您的自定义格式准确地指定了数字的外观，因此无论程序在何种文化下运行。它总是会看起来一样的。

程序运行的文化在编译时是未知的，它是一个运行时属性。

所以答案是：不，你不能自动映射，因为没有一对一的一致映射。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T13:28:48.303

**黑客警报！！！**

正如[Arjan 在他出色的回答中指出的那样，](https://stackoverflow.com/questions/569242/how-to-convert-between-0-and-0n2-style-format-string-representations/569450#569450)我想做的事情不可能在所有地区都以防弹的方式进行（感谢 Arjan）。

出于我的目的，我知道我只处理数字，而我关心的主要问题是具有相同的小数位数。所以这是我的黑客。

```
private static string ConvertCustomToStandardFormat(string customFormatString)
{
    if (customFormatString == null || customFormatString.Trim().Length == 0)
        return null;

    // Percentages do not need decimal places
    if (customFormatString.EndsWith("%"))
        return "{0:P0}";

    int decimalPlaces = 0;

    int dpIndex = customFormatString.LastIndexOf('.');
    if (dpIndex != -1)
    {
        for (int i = dpIndex; i < customFormatString.Length; i++)
        {
            if (customFormatString[i] == '#' || customFormatString[i] == '0')
                decimalPlaces++;
        }
    }

    // Use system formatting for numbers, but stipulate the number of decimal places
    return "{0:n" + decimalPlaces + "}";
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-03-07T16:17:29.593

这用于将数字格式化为 2 个小数位

```
string s = string.Format("{0:N2}%", x); 
```

# .net - 存储字符串列表的最佳数据类型？

> ID：569245
> 
> 赞同：3
> 
> 时间：2009-02-20T11:37:18.040
> 
> 标签：.net, vb.net, list, types, ienumerable

在 .NET 中，您使用哪种数据类型来存储字符串列表？

目前我正在使用`List(Of String)`它，因为它比`Array`管理和添加/删除东西更容易。我试图了解其他选项是什么，它们何时变得方便以及何时应该避免`List(Of String)`使用。

你用其他类型吗？为什么和何时？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T11:39:06.133

`List(Of String)`是存储字符串列表的绝佳方式。如果您需要从中间添加/删除元素，您可能需要考虑使用 a`LinkedList(Of String)`但在大多数情况下`List`都可以。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T11:42:51.863

几乎总是[`List<string>`](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)或[`Dictionary<TKey, string>`](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)。

当您需要基于索引的列表时使用列表，当您希望随机访问给定键的字符串值时使用字典。

但是，请尽量坚持，当然[`IList<string>`](http://msdn.microsoft.com/en-us/library/system.collections.ilist.aspx)，[`IDictionary<TKey, string>`](http://msdn.microsoft.com/en-us/library/s4ys34ea.aspx)在可能的情况下。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T11:46:58.530

System.Collections.Specialized.StringCollection 也是一个选项，但我个人更喜欢 List(Of String)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T11:48:27.077

我认为这个名字真的说明了一切：在大多数情况下是存储*字符串列表**`List(Of String)`*的最佳方式。

 *# c# - MethodInfo.Invoke 不带参数

> ID：569249
> 
> 赞同：72
> 
> 时间：2009-02-20T11:38:46.600
> 
> 标签：c#

我尝试做的示例代码肯定会比我的英语做得更好：

```
public bool IsNumericValueInBounds (string value, Type numericType)
{
  double d = double.NaN;     

  bool inBounds = (bool)numericType.GetMethod ("TryParse").Invoke (null, new object[] { value, d });

  return inBounds;
} 
```

不幸的是 TryParse 方法需要一个 out 参数，所以这不起作用。任何想法如何解决这个问题？

（ps.：这不是鸭子打字的一个很好的例子吗？ - 因为我知道每个 numericType 都有一个“TryParse”或者我弄错了？）

* * *

## 回答 #1

> 赞同：153
> 
> 时间：2009-02-20T11:42:41.287

```
public static bool TryParse( string text, out int number ) { .. }

MethodInfo method = GetTryParseMethodInfo();
object[] parameters = new object[]{ "12345", null }
object result = method.Invoke( null, parameters );
bool blResult = (bool)result;
if ( blResult ) {
    int parsedNumber = (int)parameters[1];
} 
```

# asp.net-mvc - 在 ASP.NET MVC 中记录错误

> ID：569252
> 
> 赞同：113
> 
> 时间：2009-02-20T11:38:58.957
> 
> 标签：asp.net-mvc, error-handling

我目前在我的 ASP.NET MVC 应用程序中使用 log4net 来记录异常。我这样做的方式是让我的所有控制器都继承自 BaseController 类。在 BaseController 的 OnActionExecuting 事件中，我记录了任何可能发生的异常：

```
protected override void OnActionExecuted(ActionExecutedContext filterContext)
{
    // Log any exceptions
    ILog log = LogManager.GetLogger(filterContext.Controller.GetType());

    if (filterContext.Exception != null)
    {
        log.Error("Unhandled exception: " + filterContext.Exception.Message +
            ". Stack trace: " + filterContext.Exception.StackTrace, 
            filterContext.Exception);
    }
} 
```

如果在控制器操作期间发生未处理的异常，这非常有用。

至于 404 错误，我在 web.config 中设置了一个自定义错误，如下所示：

```
<customErrors mode="On">
    <error statusCode="404" redirect="~/page-not-found"/>
</customErrors> 
```

在处理“page-not-found”网址的控制器操作中，我记录了请求的原始网址：

```
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult PageNotFound()
{
    log.Warn("404 page not found - " + Utils.SafeString(Request.QueryString["aspxerrorpath"]));

    return View();
} 
```

这也有效。

我遇到的问题是如何记录 .aspx 页面本身上的错误。假设我在某个页面或某些内联代码上出现编译错误，会引发异常：

```
<% ThisIsNotAValidFunction(); %>
<% throw new Exception("help!"); %> 
```

似乎 HandleError 属性正确地将其重新路由到 Shared 文件夹中的 Error.aspx 页面，但它绝对没有被我的 BaseController 的 OnActionExecuted 方法捕获。我在想我可以将日志代码放在 Error.aspx 页面本身上，但我不确定如何在该级别检索错误信息。

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-02-20T12:55:05.077

我会考虑通过插入[Elmah](http://code.google.com/p/elmah/)来简化您的 Web 应用程序。

您将 Elmah 程序集添加到您的项目中，然后配置您的 web.config。然后它将记录在控制器或页面级别创建的异常。它可以配置为登录到各种不同的地方（如 SQL Server、电子邮件等）。它还提供了一个 Web 前端，以便您可以浏览异常日志。

这是我添加到我创建的任何 asp.net mvc 应用程序的第一件事。

我仍然使用 log4net，但我倾向于使用它来记录调试/信息，并将所有异常留给 Elmah。

您还可以在[如何在 ASP.NET 应用程序中记录错误（异常）问题中找到更多信息？](https://stackoverflow.com/questions/11950/how-do-you-log-errors-exceptions-in-your-asp-net-apps).

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-03-09T06:59:43.277

您可以挂钩 Global.asax 中的 OnError 事件。

像这样的东西：

```
/// <summary>
/// Handles the Error event of the Application control.
/// </summary>
/// <param name="sender">The source of the event.</param>
/// <param name="e">The <see cref="System.EventArgs"/> instance containing the event data.</param>
protected void Application_Error(object sender, EventArgs e)
{
    if (Server != null)
    {
        Exception ex = Server.GetLastError();

        if (Response.StatusCode != 404 )
        {
            Logging.Error("Caught in Global.asax", ex);
        }

    }

} 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2011-09-14T21:50:38.323

MVC3
创建继承自 HandleErrorInfoAttribute 并包含您选择的日志记录的属性

```
public class ErrorLoggerAttribute : HandleErrorAttribute 
{
    public override void OnException(ExceptionContext filterContext)
    {
        LogError(filterContext);
        base.OnException(filterContext);
    }

    public void LogError(ExceptionContext filterContext)
    {
       // You could use any logging approach here

        StringBuilder builder = new StringBuilder();
        builder
            .AppendLine("----------")
            .AppendLine(DateTime.Now.ToString())
            .AppendFormat("Source:\t{0}", filterContext.Exception.Source)
            .AppendLine()
            .AppendFormat("Target:\t{0}", filterContext.Exception.TargetSite)
            .AppendLine()
            .AppendFormat("Type:\t{0}", filterContext.Exception.GetType().Name)
            .AppendLine()
            .AppendFormat("Message:\t{0}", filterContext.Exception.Message)
            .AppendLine()
            .AppendFormat("Stack:\t{0}", filterContext.Exception.StackTrace)
            .AppendLine();

        string filePath = filterContext.HttpContext.Server.MapPath("~/App_Data/Error.log");

        using(StreamWriter writer = File.AppendText(filePath))
        {
            writer.Write(builder.ToString());
            writer.Flush();
        }
    } 
```

在 Global.asax RegisterGlobalFilters 中放置属性

```
 public static void RegisterGlobalFilters(GlobalFilterCollection filters)
    {
       // filters.Add(new HandleErrorAttribute());
        filters.Add(new ErrorLoggerAttribute());
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T12:17:51.873

您是否考虑过扩展 HandleError 属性？此外，Scott 有一篇关于控制器/操作上的过滤器拦截器的博客[文章](http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T06:53:41.513

Error.aspx 视图的定义如下：

```
namespace MvcApplication1.Views.Shared
{
    public partial class Error : ViewPage<HandleErrorInfo>
    {
    }
} 
```

HandleErrorInfo 具有三个属性： string ActionName string ControllerName Exception Exception

您应该能够访问 HandleErrorInfo 并因此访问视图中的异常。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-20T12:09:07.993

您可以尝试检查 HttpContext.Error，但我对此不确定。

# delphi - 是否可以在非可视单元或类对象内部创建使用 TClientDataSet？

> ID：569254
> 
> 赞同：1
> 
> 时间：2009-02-20T11:39:06.647
> 
> 标签：delphi, runtime, tclientdataset

是否可以在运行时在对象内创建和使用 TClientDataSet？

我喜欢在我的表中进行几处更改，并以类似缓存的方式同时应用这些更改，而 TClientDataSet 让我可以做到这一点。知道什么时候我想这样做，我必须构建一个 TForm。

是否可以？

更新

如果没有 TDataSetProvider 和没有 TSQLQuery ，它可以使用吗？如何使用？因为我试过了，它给了我一个错误 no Provider！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T12:15:08.027

组件只是类，您可以同样使用它们：

```
procedure TMyObject.DoSomeDBStuff;
var
  localClientDataset: TClientDataset;
begin
  localClientDataset := TClientDataset.Create( );
  try

  finally
    localClientDataset.Free;
  end;
end; 
```

如果您愿意，还可以创建一个客户端数据集属性：

```
type
  TMyObject = class
  private
    FClientDB: TClientDataset;
  published
    property Dataset: TClientDataset read FClientDB;
  end; 
```

一些可视化组件可能需要一个可视父级，但对于 TClientDataset 应该没有这样的要求。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T23:42:28.313

您可以在运行时创建 TClientDataset。（请参阅 Vegar 的回答。）至于提供程序问题，解决方案是为其定义字段，然后使用 CreateDataset 方法（而不是 Open 方法！）打开数据集，然后它就可以工作了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T11:59:55.130

你当然可以这样做。但您也可以考虑使用数据模块。您可以将不可见的组件拖动到数据模块并使用对象检查器来设置值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T11:48:17.483

是的，您可以这样做，TClientDataSet 是非可视组件，并且并非设计为仅在表单内部使用。

您可以构建一个单元（没有 .dfm 的.pas），而不是具有可以使用 TClientDataSet 的类和方法并将其作为参数返回。

# css - a:visited 在 Mozilla Firefox 中不起作用

> ID：569268
> 
> 赞同：7
> 
> 时间：2009-02-20T11:42:49.167
> 
> 标签：css, firefox, anchor, visited

我创建了一个链接，当我尝试设置样式时；

```
a:visited {
    text-decoration: underline;
    color: #FF0000;
} 
```

它似乎不起作用。它在 IE 中运行良好。我也遵守了命令；链接，访问，悬停，活动。
这是一个已知问题，还是我犯了任何错误？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-20T13:59:24.377

这可能与您选择器所在的特定性和顺序有关。通常，在指定链接状态时，您应该遵循“ **l** o **v** e / **ha** te”原则：

1.  `:`**l**`ink`

2.  `:`**v**`isited`

3.  `:`**H**`over`

4.  `:`**一个**`ctive`

也许你以前有`:hover`or`:active`选择器`:visited`？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T11:49:28.697

下载适用于 Firefox 的 Firebug 或 WebDeveloper 插件，并使用它来检查链接的样式，比如使用 Inspect，以查看设置样式的位置。您应该能够看到正在应用哪些样式以及从何处应用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-05-12T13:54:43.923

我听说这与安全性有关-因此，Firefox 引擎盖下的某些东西会禁止显示已访问的链接，因此其他软件无法检查活动样式并找出用户所在的位置。

这确实有点道理，但他们应该把它作为一种选择，他们还应该向人们解释他们所做的就是这样，并为我们节省一些时间......

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-11-12T13:49:25.470

转到工具 -> 选项并检查 Firefox 是否记住了您的浏览历史记录。如果未选中此选项，则浏览器无法显示您访问了哪些链接，因为您拒绝浏览器提供该信息，因此您访问的链接不会改变颜色。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-02-05T22:50:43.483

由于 Google/Bing/等的安全问题。很高兴告诉你，只有一小部分属性可以用 :visited 伪类设置样式。文字装饰不是其中之一，尽管颜色应该可以工作。

根据 OP 在发布此问题时使用的 IE 版本，问题可能是 IE 不兼容，尤其是在 IE8 之前，与标准和其他浏览器不兼容。

更多信息在这里（在其他地方）：[https ://www.w3schools.com/cssref/sel_visited.asp](https://www.w3schools.com/cssref/sel_visited.asp)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T11:50:18.990

它很可能被另一种风格所覆盖。如果您安装了 Web Developer 工具栏，您可以通过从 CSS 菜单中选择“查看样式信息”来查看受影响的 CSS 样式以及它们的来源。

# svn - 更改默认的 SVN 差异工具

> ID：569270
> 
> 赞同：16
> 
> 时间：2009-02-20T11:43:00.273
> 
> 标签：svn, diff

在博客之后，我创建了一个批处理文件 wm.bat：

```
"d:\svnroot\external\winmerge\WinMerge.exe" /B /WAIT "d:\svnroot\external\winmerge\WinMergeU.exe" /e /ub /dl %3 /dr %5 %6 %7 
```

我试着打电话

```
svn diff | wm 
```

但这没有用。那么如何将[WinMerge](http://en.wikipedia.org/wiki/WinMerge)或类似实用程序与`svn diff`.

扩展下面大卫的答案，更改 Windows 的默认值需要编辑位于 (for Windows XP) 的配置文件

```
C:\Documents and Settings\%USERNAME%\Application Data\Subversion\config 
```

或 (Windows Vista)

```
C:\Users\%USERNAME%\AppData\Roaming\Subversion\config 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-20T11:45:43.357

好的，看看[原来的博](http://flimflan.com/blog/UsingWinMergeWithSubversion.aspx)文，这就是你想要的：

```
svn diff --diff-cmd wm [optional-filename] 
```

如果您想查看此处实际发生的情况（即`svn diff`传递给指定的参数的类型`diff-cmd`），您可以使用`svn diff --diff-cmd echo`并查看它所说的内容：

```
[~/src/gosmore-dev]$ svn diff --diff-cmd echo
Index: gosmore.cpp
===================================================================
-u -L gosmore.cpp   (revision 13753) -L gosmore.cpp (working copy) .svn/text-base/gosmore.cpp.svn-base gosmore.cpp 
```

上面删除了一些引号，但基本上你可以看到`svn diff`会通过

```
-u -L "<left-label>" -L "<right-label>" <left-file> <right-file> 
```

到您的批处理文件。您拥有的批处理文件用于将这些命令转换为 WinMerge 可以理解的格式。

[svn book](http://svnbook.red-bean.com/en/1.7/svn.advanced.externaldifftools.html)中提供了有关这一切如何工作的更多细节和示例。

要使您的批处理文件成为默认文件`svn diff`，您需要`[helpers]`在本地 subversion 配置文件的部分中添加以下行（`~/.subversion/config`在 Linux 中，我不确定配置文件在 Windows 中的位置）（请参阅[前面的 SO question](https://stackoverflow.com/questions/569270/change-default-svn-diffing-tool/569281#569281)）

```
diff-cmd=wm.bat 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-08-24T02:10:25.323

看看这个链接：

[http://blog.tplus1.com/index.php/2007/08/29/how-to-use-vimdiff-as-the-subversion-diff-tool/](http://blog.tplus1.com/index.php/2007/08/29/how-to-use-vimdiff-as-the-subversion-diff-tool/)

为了方便SOer，这里是一个副本：

> > 获取此 diffwrap.sh 脚本并将其保存在任何地方。我将我的保存在我的 $HOME/bin 目录中。确保使其可执行！我在下面展示它：
> 
> ```
> #!/bin/sh
> # Configure your favorite diff program here.
> DIFF="/usr/bin/vimdiff" 
> # Subversion provides the paths we need as the sixth and seventh
> # parameters.
> LEFT="$6"
> RIGHT="$7"
> # Call the diff command (change the following line to make sense for
> # your merge program).
> "$DIFF" "$LEFT" "$RIGHT"
> 
> # Return an errorcode of 0 if no differences were detected, 1 if some were.
> # Any other errorcode will be treated as fatal. 
> ```
> 
> 然后将`$HOME/.subversion/config`文件更改为指向该脚本：
> 
> ```
> [helpers]
> diff-cmd = /home/matt/bin/diffwrap.sh 
> ```
> 
> 然后去diff一个文件！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-15T20:55:08.857

创建包含对您最喜欢的合并程序的调用的批处理文件后，您可以通过修改该行将 Subversion 配置为始终在 Windows 中使用您的批处理文件（每次使用时不需要 --diff-cmd 参数）

```
# diff-cmd = diff_program (diff, gdiff, etc.) 
```

在文件 C:\Documents and Settings\username\Application Data\Subversion\config 中。此行应更改为指向您的批处理文件。例如：

```
diff-cmd = c:\bin\wm.bat 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-01-20T15:23:37.353

对于 Mac::

打开这个文件：~/.subversion/config

查找并取消注释包含： diff-cmd 的行（通过从开始中删除 # ）

在 diff-cmd 前面，给出 diff 工具的名称，就像在我的例子中我使用的是 araxis 合并 diff 工具，所以它看起来像这样：

diff-cmd=/Applications/Araxis Merge.app/Contents/Utilities/araxissvndiff

在此之后，每当您在终端上运行 svn diff 时，如果将显示该工具中文件的差异

确保 diff-cmd 单词前后没有空格。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-12-28T18:14:42.120

将[Cygwin](http://en.wikipedia.org/wiki/Cygwin)和 SVN 1.7 与 WinMerge 一起使用时，将此批处理文件用作外部差异工具。我不得不调整[http://manual.winmerge.org/CommandLine.html](http://manual.winmerge.org/CommandLine.html)以使用 Cygwin 路径。

在`.subversion\config`：

```
[helpers]
diff-cmd = C:\path\to\winmergesvndiff.bat 
```

的内容`winmergesvndiff.bat`

```
@echo off

set left=%6
set right=%7

REM Repeat these two lines for all drives
set left=%left:/cygdrive/c/=c:/%
set right=%right:/cygdrive/c/=c:/%

REM Path to WinMerge may vary
start "WinMerge" /B  "C:\program files (x86)\winmerge\WinMergeU.exe" /e /s /ub /dl %3 /dr %5 %left% %right% 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-10-06T16:01:53.923

[Meld](https://sourceforge.net/projects/meld-installer/)对我来说真的很棒。安装后，我去`Subversion`配置文件，取消注释该`diff-cmd`行并将其设置为meld.exe时的路径。就我而言：

```
[helpers]
### ...
### Set diff-cmd to the absolute path of your 'diff' program.
###   This will override the compile-time default, which is to use
###   Subversion's internal diff implementation.
diff-cmd = D:\SOFT\Meld\meld\meld.exe 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-11-22T17:06:53.070

您需要将路径转换为 ​​Windows 样式：

```
#!/bin/sh

LEFT="$6"
RIGHT="$7"

RRIGHT=`cygpath.exe -pw $RIGHT`
LLEFT=`cygpath.exe -pw $LEFT`

/cygdrive/c/Program\ Files\ \(x86\)/WinMerge/WinMergeU.exe /e /s /ub /dl %3 /dr %5 $LLEFT $RRIGHT 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-15T18:34:15.173

使用[Cygwin](http://en.wikipedia.org/wiki/Cygwin)、 Subversion （Cygwin 的版本）和[WinDiff](https://en.wikipedia.org/wiki/WinDiff)需要注意处理后者对正斜杠的不容忍。我使用以下通过 svn 的 diff-cmd 设置安装的[Bash](http://en.wikipedia.org/wiki/Bash_%28Unix_shell%29)脚本，通过 'svn diff' 获得所需的结果：

```
arg1=$(echo $6 | sed 's/\//\\/g' | sed 's/\\cygdrive\\c/c:/')
arg2=$(echo $7 | sed 's/\//\\/g' | sed 's/\\cygdrive\\c/c:/')
cmd /c windiff.exe $arg1 $arg2 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-12-20T16:23:23.787

我对简单的 .bat 文件有 3 个问题，尤其是当修订与工作目录中的不匹配时：

*   svn 可能会将要比较的文件写入临时目录 - 然后在 WinMerge 有机会查看它们之前删除它们
*   svn 可以从 .svn\pristine 子目录中获取文件，其文件名是一长串十六进制数字
*   WinMerge 的语法高亮基于文件扩展名，当 svn 使用临时文件时，它没有扩展名

所以我最终在 .bat 文件中封装了一个小 PowerShell 来解决这些问题：

```
;@echo off
;set  leftdesc=%~3
;set rightdesc=%~5
;set  leftfile=%~6
;set rightfile=%~7
;Findstr -rbv ; %0 | powershell -c -
;goto:sCode

&{
  $leftExt, $rightExt = ($env:leftdesc, $env:rightdesc) -replace '.*([.]\w+).*','$1'
  if ($env:leftfile.EndsWith($leftExt)){
    $leftFile = $env:leftfile
  }else{
    $leftFile = Join-Path $env:temp ((Split-Path $env:leftfile -Leaf) + $leftExt)
    Copy-Item $env:leftfile $leftFile -Force
  }
  if ($env:rightfile.EndsWith($rightExt)){
    $rightFile = $env:rightfile
  }else{
    $rightFile = Join-Path $env:temp ((Split-Path $env:rightfile -Leaf) + $rightExt)
    Copy-Item $env:rightfile $rightFile -Force
  }
  $descriptions = '/dl "' + $env:leftdesc + '" /dr "' + $env:rightdesc + '"'
  $fileNames    = '"' + $leftFile + '" "' + $rightFile + '"'
  start 'C:\Program Files (x86)\WinMerge\WinMergeU.exe' ('/e /u ' +$descriptions + ' ' + $fileNames)
}

;:sCode
;goto :eof 
```

感谢[Walid Toumi](http://walid-toumi.blogspot.com/2011/04/inclure-du-code-ps-dans-un-fichier.html)的包装。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-12-11T20:16:29.107

类似于上述答案的东西对我有用，但是，我的特定设置需要一些定制。我需要进行修改以 (1) 说明 Cygwin 中的“/tmp”目录，以及 (2) 确保“/tmp”文件保持存在（因此“启动”从 Meld 的启动中消失了）。

下面的 .bat 文件对我有用：

*   赛格温 (x64)
*   SVN（命令行）
*   融合
*   视窗 10

--

```
@echo off

set left=%6
set right=%7

REM Repeat these two lines for all drives
set left=%left:/cygdrive/d/=d:/%
set right=%right:/cygdrive/d/=d:/%
set left=%left:/tmp=c:/cygwin64/tmp%
set right=%right:/tmp=c:/cygwin64/tmp%

"C:\program files (x86)\meld\Meld.exe" %left% %right% 
```

# .net - Microsoft .NET Framework Data Provider for Oracle 执行脚本问题

> ID：569271
> 
> 赞同：0
> 
> 时间：2009-02-20T11:43:07.463
> 
> 标签：.net, oracle, sql-scripts

我们在执行以 BEGIN 开头的脚本时遇到问题，并且与上述提供程序有多个过程或触发器。执行这些失败。有没有人遇到过类似的问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T13:57:12.913

我相信这是 MS DPO 的“功能”。

> Oracle 数据库不支持单个连接上的多个事务——它们总是在连接级别限定范围。因此，ODP.NET 将事务传播到在连接上执行的命令。Microsoft 提供程序要求您将事务显式分配给每个命令。
> 
> （来自[MSDN：比较 Microsoft .NET Framework 1.1 Data Provider for Oracle 和 Oracle Data Provider for .NET](http://msdn.microsoft.com/en-us/library/ms971518.aspx#odpvsmsdp_topic11)）

如果可以，请考虑使用 ODP.NET。

# regex - Vim 搜索模式，如果发生则删除到行尾

> ID：569280
> 
> 赞同：46
> 
> 时间：2009-02-20T11:45:38.940
> 
> 标签：regex, vim

我正在尝试在文本文件中搜索某种模式。如果出现这种模式，则意味着不需要该行的其余部分，因此可以删除。

我曾尝试使用以下命令，但到目前为止都没有成功。

```
:%s/{pattern}/d$

:g/{pattern}/d$ 
```

如果有人有任何建议，他们将不胜感激

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-02-20T11:55:54.580

会`:%s/{pattern}.*//`工作吗？

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-02-20T12:35:42.643

或者，以下也适用

```
:g/{pattern}/normal nd$ 
```

对于你想要的，我会接受mirod的建议。我发布的内容更灵活一些，在类似情况下可能会派上用场。

解释：

在模式匹配的每一行上，执行以下正常模式命令“nd$”。光标位于行首，'n' 跳转到模式，'d$' 删除到行尾。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-09-16T11:33:56.267

要替换模式和其他任何内容，请使用正则表达式通配符`.*`

```
:1,$s/pattern.*//g 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2011-01-13T17:58:29.763

```
%s/\\(replay-pattern-later\\) pattern2/\1/gc 
```

这将重播 pattern1 但消除 pattern2。使用“/gc”全局应用（继续）并提示每次出现。

# .net - 如何管理缓存的 IDisposable 对象？

> ID：569282
> 
> 赞同：10
> 
> 时间：2009-02-20T11:46:24.087
> 
> 标签：.net, caching, idisposable

我有一个创建成本很高的对象，它使用一些非托管资源，这些资源在完成后必须显式释放，因此实现 IDisposable()。我想要一个缓存这些昂贵资源的实例，以便最大限度地降低创建成本，但我不知道如何处理处置。

如果使用对象的方法负责处置，那么我最终会在缓存中处置实例，然后必须重新创建这些实例，从而破坏缓存点。如果我不在使用它们的方法中处置对象，那么它们永远不会被处置。我以为当它们从缓存中取出时我可以处理它们，但是我最终可能会处理一个仍在被方法使用的实例。

让它们超出范围并被垃圾收集器收集并在那时释放资源是否有效？这感觉是错误的，并且反对他们一次性的想法......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T12:14:34.410

To (mis-)quote Raymond Chen:*每个没有过期策略的缓存都是泄漏*

所以，设置一个明确的缓存过期策略，让缓存正常处理。这仍然需要处理应用程序关闭。

如果您的非托管资源归进程所有，您可以让进程在关闭时释放它们。

**如果进程不**拥有非托管资源，则需要检测关闭并显式处理缓存的元素。

如果您无法可靠地检测到进程关闭，并且托管资源很昂贵，则非托管资源不会，请将托管资源与非托管资源分开，并让缓存仅保留托管资源。

如果非托管资源很昂贵，因此需要缓存，并且它们不属于进程，并且您无法可靠地检测到进程关闭并且您无法承受泄漏它们，那么您的问题就无法解决。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T17:21:07.293

一次性物品总是需要有一个明确的所有者负责处理它们。但是，这并不总是创建它们的对象。此外，所有权可以转让。

意识到这一点，解决方案就变得显而易见了。**不丢弃，回收！**您不仅需要一种从缓存中获取资源的方法，还需要一种返回它的方法。此时缓存再次成为所有者，并且可以选择保留资源以供将来使用或处置它。

```
 public interface IDisposableItemCache<T> : IDisposable
      where T:IDisposable 
   {
      /// <summary>
      /// Creates a new item, or fetches an available item from the cache.
      /// </summary>
      /// <remarks>
      /// Ownership of the item is transfered from the cache to the client.
      /// The client is responsible for either disposing it at some point,
      /// or transferring ownership back to the cache with
      /// <see cref="Recycle"/>.
      /// </remarks>
      T AcquireItem();

      /// <summary>
      /// Transfers ownership of the item back to the cache.
      /// </summary>
      void Recycle(T item);

   } 
```

**编辑：**我刚刚注意到这个想法也存在于 Spring 中，它被称为[object pool](http://www.springframework.net/doc/sdk/2.0/html/Spring.Core~Spring.Pool.IObjectPool_members.html)。他们的`BorrowObject`和`ReturnObject`方法与我的示例中的方法相匹配。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T11:51:46.243

首先，包装原生资源的类型应该是可终结的，而不仅仅是一次性的。更好的是，使用[SafeHandle](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.safehandle.aspx)来包装原生资源。

除非有人明确负责说他们已经完成了该项目并且可以处理它，否则我认为你最好让 GC 来处理它。请注意，它必须是可终结的，否则 GC 不会再看一眼。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T11:51:29.830

您可以将非托管资源与托管实例分离，并使用缓存管理器来保存一组非托管资源。托管对象将尝试从缓存管理器获取非托管资源的实例，该实例将从缓存中创建一个或提供一个空闲实例，并在处理时将其返回给缓存管理器（而不是自行处理） . 缓存管理器将是唯一负责分配和释放非托管资源的对象，当它认为有必要时。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T13:31:28.997

您可以使用类工厂和 IDisposable 解决此问题。例如：

```
public class CachedObject : IDisposable {
  private int mRefCount;
  private CachedObject(int something) {
    mRefCount = 1;
  }
  public static CachedObject CreateObject(int something) {
    CachedObject obj = LookupInCache(something);
    if (obj != null) Interlocked.Increment(ref obj.mRefCount);
    else obj = new CachedObject(something);
    return obj;
  }
  private static CachedObject LookupInCache(int something) {
    CachedObject obj = null;
    // Implement cache lookup here, don't forget to lock
    //..
    return obj;
  }
  public void Dispose() {
    int cnt = Interlocked.Decrement(ref mRefCount);
    if (cnt == 0) {
      // Remove from cache
      // 
    }
  }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T13:18:30.167

一个对象应该由创建它的类处理。由于您的调用者尚未在缓存中创建项目，因此他们也无权处置它们。

我想确保您的工厂方法被命名为“Get *Class* ”而不是“Create *Class* ”，以强调调用者不负责创建，因此不负责处置。

# c# - 如何使用视觉样式绘制 3D 边框？

> ID：569289
> 
> 赞同：4
> 
> 时间：2009-02-20T11:47:44.940
> 
> 标签：c#, .net, winforms, visual-styles

我可以使用 ControlPaint.DrawBorder3D 绘制 3D 边框，但我得到了“Windows 经典”3D 边框。我想绘制当前主题的 3D 边框——在默认的 XP 主题中，这是一个 1px 的蓝色或灰色边框。我如何绘制它，以及如何获得它的宽度？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T21:47:13.633

听起来您可能需要查看[System.Windows.Forms.VisualStyles.VisualStyleRenderer](http://msdn.microsoft.com/en-us/library/system.windows.forms.visualstyles.visualstylerenderer.aspx)：

> `System.Windows.Forms.VisualStyles` 命名空间公开`VisualStyleElement` 了表示视觉样​​式支持的所有控件和用户界面 (UI) 元素的对象。要绘制或获取有关特定元素的信息，您必须将 a 设置`VisualStyleRenderer`为您感兴趣的元素。
> 
> 要绘制元素，请使用 `DrawBackground`方法。该类 `VisualStyleRenderer`还包括方法，例如`GetColor`和 `GetEnumValue`，它们提供有关当前视觉样式如何定义元素的信息。

该页面上还有一个代码示例。

您必须自己绘制边框，但是您可以从中获取颜色， `VisualStyleElement.Window.Caption.Active`并且大小应该是窗口框架的大小（我相信），即`VisualStyleElement.Window.FrameBottom.Active`. 如果您探索`VisualStyleElement.Window`，您应该能够确定哪个窗口元素具有绘制边框所需的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T21:39:57.690

**Pre .NET Framework 2.0 答案**

我假设您正在绘制自己的特殊控件，并且您想使用当前活动主题的元素来绘制它，以便它更适合标准 XP 控件。例如，您**不会**尝试在标准 Button 控件上启用主题。正确的？

它实际上有些复杂。您的主要关注点应该是 UxTheme.dll。这包含了绘制主题控件所需的一切。 [这](http://www.codeproject.com/KB/miscctrl/uxtheme.aspx)是一个很好的围绕这个 dll 的 C# 包装器，让您的生活更轻松。还有其他的，所以如果这不是你想要的，我希望我已经为你指出了正确的方向。

# jquery - IE 的 replaceAdjacentText 方法有什么替代方法吗？

> ID：569293
> 
> 赞同：0
> 
> 时间：2009-02-20T11:48:14.723
> 
> 标签：jquery, html, dom, cross-browser

我需要重写一个经典的 ASP 页面，使其与 Internet Explorer、Firefox 和 Safari 兼容。当前实现使用方法[replaceAdjacentText](http://msdn.microsoft.com/en-us/library/ms536714(VS.85).aspx)来操作 DOM。据我所知[，除 Internet Explorer 之外的任何浏览器都不支持](http://www.aptana.com/reference/html/api/HTMLElement.html#HTMLElement.replaceAdjacentText)此方法。

我想做的是用可以跨多个浏览器平台工作的东西替换 replaceAdjacentText 的使用。这是否可以通过现有的 jQuery 插件或其他替代方案实现？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:19:09.937

使用[jQuery 操作](http://docs.jquery.com/Manipulation)

尝试将这些方法与 jQuery 一起使用：

**append(), appendTo(), prepend(), prependTo(), after(), before(), insertAfter(), insertBefore()**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T12:08:22.240

jQuery 几乎肯定有适合您的东西，但总的来说，您似乎在寻找[Node](http://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-1950641247)接口的 DOM 遍历属性和方法，特别是**previousSibling**、**nextSibling**和**firstChild**。松散的例子[在这里](https://developer.mozilla.org/En/DOM/Node.nextSibling)。需要注意的一件事是您返回的节点类型，壁虎将空白文本节点添加到 DOM，而 IE 没有。

谷歌也有很多关于 JS DOM 遍历的教程。

# c# - 键盘事件

> ID：569296
> 
> 赞同：-2
> 
> 时间：2009-02-20T11:48:27.903
> 
> 标签：c#

每当我在我的服务器系统中按下键时，我都会将该键事件发送到另一个系统，之后相应的操作应该在客户端机器中发生..帮助我找到更好的方法来解决这个问题

提前谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T11:57:21.657

请向我们提供有关您要执行的操作的更多详细信息。为了模拟 Windows 窗体中的按键，我会使用 SendKeys 类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T11:59:00.733

如果我理解正确，那么您所拥有的听起来还不错。你是说：

*   你有一个客户端服务器架构。
*   在服务器上（可能是在命令控制台或管理应用程序上）你按下一个键。
*   键对应于一个动作。该操作需要在客户端调用。

您可以使用异步 WCF 来实现这一点。有关更多信息，请参见[此处](https://stackoverflow.com/questions/353383/beginners-wcf-question-consumable-asynchronous-services)和[此处。](https://stackoverflow.com/questions/400798/how-to-make-a-call-to-my-wcf-service-asynchronous)看待这个问题的一种方法是作为分布式观察者模式。您的服务器是主题，客户端是观察者。

* * *

更新：在 .Net 中处理关键事件

您可以尝试在表单中添加 KeyDown 事件处理程序：

```
private void Form1_KeyDown(object sender, KeyEventArgs e)
{
    if (e.Control & e.KeyCode == Keys.C)
    {
        MessageBox.Show( "Ctrl + C pressed" );
        // Swallow key event, i.e. indicate that it was handled.
        e.Handled = true;
    }
} 
```

但是，如果您的表单上有任何控件，那么您将不会收到该事件。您可能需要做的是使用消息过滤器嗅探 Windows 消息。例如

```
public class KeyDownMessageFilter : IMessageFilter
{
    public const int WM_KEYDOWN = 0x0100;

    public bool PreFilterMessage(ref Message m)
    {
        if (m.Msg == WM_KEYDOWN)
        {
            // Key Down
            return true; // Event handled
        }
        return false;
    }
} 
```

[使用AddMessageFilter](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.addmessagefilter.aspx)方法将此消息过滤器添加到应用程序。如果要检查是否按下了 CTRL 键以获得按键消息，请检查[lparam](http://msdn.microsoft.com/en-us/library/ms646280(VS.85).aspx)。

如果其中任何一个不清楚，请告诉我。

# c# - 本地化枚举描述属性

> ID：569298
> 
> 赞同：36
> 
> 时间：2009-02-20T11:48:50.383
> 
> 标签：c#, .net, localization, enums

在 .net 中本地化枚举描述的最佳方法是什么？

（有关枚举描述示例，请参阅[向枚举常量添加描述）](http://dotnet.mvps.org/dotnet/faqs/?id=enumdescription&lang=en)

理想情况下，我想要使用 ResourceManager 和资源文件的东西，这样它就可以适应应用程序的其他区域的本地化方式。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-20T22:51:26.187

这就是我最终的结果，我没有看到添加自定义属性类来保存资源键然后查找资源文件的价值 - 为什么不直接使用枚举类型名 + 值作为资源键？

```
using System;
using System.Resources;
using System.Reflection;

public class MyClass
{
  enum SomeEnum {Small,Large};

  private ResourceManager _resources = new ResourceManager("MyClass.myResources",
                          System.Reflection.Assembly.GetExecutingAssembly());    

  public string EnumDescription(Enum enumerator)
  {     
    string rk = String.Format("{0}.{1}",enumerator.GetType(),enumerator);
    string localizedDescription = _resources.GetString(rk);

    if (localizedDescription == null)
       {
       // A localized string was not found so you can either just return
       // the enums value - most likely readable and a good fallback.
       return enumerator.ToString();

       // Or you can return the full resourceKey which will be helpful when
       // editing the resource files(e.g. MyClass+SomeEnum.Small) 
       // return resourceKey;
       }
    else
       return localizedDescription;
    }

  void SomeRoutine()
  {
    // Looks in resource file for a string matching the key
    // "MyClass+SomeEnum.Large"
    string s1 = EnumDescription(SomeEnum.Large);       
  }
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-02-24T09:53:50.997

我的解决方案，使用本机解密属性：

```
public class LocalizedEnumAttribute : DescriptionAttribute
{
    private PropertyInfo _nameProperty;
    private Type _resourceType;

    public LocalizedEnumAttribute(string displayNameKey)
        : base(displayNameKey)
    {

    }

    public Type NameResourceType
    {
        get
        {
            return _resourceType;
        }
        set
        {
            _resourceType = value;

            _nameProperty = _resourceType.GetProperty(this.Description, BindingFlags.Static | BindingFlags.Public);
        }
    }

    public override string Description
    {
        get
        {
            //check if nameProperty is null and return original display name value
            if (_nameProperty == null)
            {
                return base.Description;
            }

            return (string)_nameProperty.GetValue(_nameProperty.DeclaringType, null);
        }
    }
}

public static class EnumExtender
{
    public static string GetLocalizedDescription(this Enum @enum)
    {
        if (@enum == null)
            return null;

        string description = @enum.ToString();

        FieldInfo fieldInfo = @enum.GetType().GetField(description);
        DescriptionAttribute[] attributes = (DescriptionAttribute[])fieldInfo.GetCustomAttributes(typeof(DescriptionAttribute), false);

        if (attributes.Any())
            return attributes[0].Description;

        return description;
    }
} 
```

枚举声明

```
public enum MyEnum
{
    [LocalizedEnum("ResourceName", NameResourceType = typeof(ResourceType))]
    Test = 0
} 
```

然后打电话`MyEnumInstance.GetLocalizedDescription()`

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-20T11:51:55.057

有一个简单的解决方案：使用 LocalizedDescription 属性传递资源键。

```
 [Serializable]
    public class LocalizableDescriptionAttribute:DescriptionAttribute
    {
        public LocalizableDescriptionAttribute(string resourceKey)
            :base(Resources.ResourceManager.GetString(resourceKey))
        { }

    } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-20T14:15:59.873

我曾经做过的一种方法是在与枚举相同的命名空间中添加一个扩展方法，它返回一个字符串。就我而言，它只是硬编码的，但从资源文件中获取它们是没有问题的。

```
 public static string Describe(this SomeEnum e)
    {
        switch(e)
        {
            SomeEnum.A:
                return "Some text from resourcefile";
            SomeEnum.B:
                return "Some other text from resourcefile";
            ...:
                return ...;
        }
    } 
```

也许不是一个非常顺利或花哨的解决方案，但它有效 =)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-11-12T09:28:43.180

将@nairik 的方法替换为以下内容以添加对标志枚举的支持。

```
public static string GetLocalizedDescription(this Enum @enum)
{
    if ( @enum == null )
        return null;

    StringBuilder sbRet = new StringBuilder();

    string description = @enum.ToString();

    var fields = description.Split(new char[] { ',', ' ' }, StringSplitOptions.RemoveEmptyEntries);

    foreach ( var field in fields )
    {
        FieldInfo fieldInfo = @enum.GetType().GetField(field);
        DescriptionAttribute[] attributes = ( DescriptionAttribute[] )fieldInfo.GetCustomAttributes(typeof(DescriptionAttribute), false);

        if ( attributes.Any() )
            sbRet.AppendFormat("{0}, ", attributes[0].Description);
        else
            sbRet.AppendFormat("{0}, ", field);
    }

    if ( sbRet.Length > 2 )
        sbRet.Remove(sbRet.Length - 2, 2);

    return sbRet.ToString();
} 
```

并替换属性中的 NameResourceType：

```
public Type NameResourceType
{
    get
    {
        return _resourceType;
    }
    set
    {
        _resourceType = value;

        _nameProperty = _resourceType.GetProperty(base.Description, BindingFlags.Static | BindingFlags.Public | BindingFlags.NonPublic);
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T11:52:01.313

在这个问题中查看我的表格示例：

[LINQ to SQL 中数据库数据的本地化/I18n](https://stackoverflow.com/questions/537204/localisation-i18n-of-database-data-in-linq-to-sql)

状态类型表映射到枚举值。这里真正的好处是您可以在您的报告和应用程序中进行本地化，并指定外部 ID 以与不想要您的内部值等的第三方集成。它将枚举描述与其值分离。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T11:55:01.350

您不能应用多个 System.ComponentModel.DescriptionAttribute（因此该选项已失效）。

所以添加一个间接级别，描述保存一个资源名称，然后在资源中使用本地化支持。显然，枚举的用户需要调用您的辅助方法来执行此操作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-01-31T00:34:55.940

这看起来不错： http: [//www.codeproject.com/Articles/19980/Data-Binding-an-Enum-with-Descriptions](http://www.codeproject.com/Articles/19980/Data-Binding-an-Enum-with-Descriptions)

# wcf - SSL 错误远程证书名称不匹配

> ID：569320
> 
> 赞同：2
> 
> 时间：2009-02-20T11:54:16.173
> 
> 标签：wcf, ssl

我正在使用 WCF 让客户端访问服务。我正在尝试使用 TLS (https) 访问端点。我有带有私钥和公钥的证书。

如果我让服务的端点具有与证书名称相同的主机名（“颁发给”），那么我可以从客户端访问该服务。

如果“颁发给”和端点域名的名称不同，我会收到错误“无法为具有权限的 SSL/TLS 安全通道建立信任关系”。我已将证书添加到“受信任的根”、“个人”和“受信任的人”。在我的服务中，我使用了“PeerOrChainTrust”。

如果有人对此有任何想法，请告诉我。

谢谢，扬

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T13:03:47.723

在这种情况下，您需要在客户端为服务器定义信任策略，

在对服务进行任何调用之前调用一次 SetCertPolicy。

```
using System.Net;
using System.Security.Cryptography.X509Certificates;
        public static void SetCertPolicy()
        {
            ServicePointManager.ServerCertificateValidationCallback += RemoteCertValidate;
        }

        private static bool RemoteCertValidate( object sender, X509Certificate cert, X509Chain chain,
            SslPolicyErrors error )
        {
            // trust any cert!!!
            return true;
        } 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-20T12:00:52.447

我认为您不能覆盖对证书名称是否与服务器名称匹配的检查。

某些代理允许您在警告后手动覆盖，但除非 WCF 具有禁用证书验证的设置，否则会带来所有危险。SSL 的设计首先是为了让客户端能够验证它正在与哪个服务器通信，否则您将面临各种漏洞（包括中间人和假服务器）。

# python - 用于 Python 的简单、跨平台 MIDI 库

> ID：569321
> 
> 赞同：28
> 
> 时间：2009-02-20T11:54:36.593
> 
> 标签：python, audio, midi

我想做一个创建 MIDI 声音的小应用程序。我从来没有在编程中处理过声音，所以我想从一些基本的并且有很好的文档的东西开始。我想坚持使用 Python，因为我对它最熟悉，并且最初不想让自己不知所措。

我的时间在 Windows 和 Ubuntu 之间分配了大约 50/50，所以在这两个平台上“正常工作”的东西真的很有帮助。

有什么建议么？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2010-01-25T19:57:20.683

MIDIUtil 库（托管[在](http://code.google.com/p/midiutil/)Google Code 上）可以满足您的需求：从纯 Python 库中编写 MIDI 文件。关于它的好处（并且完全公开：我是作者）是您不必跟踪较低级别的 MID 事件，例如 note-on 和 note-off：它会为您处理它们。

作为写笔记的示例，您可以执行以下操作：

```
MyMIDI = MIDIFile(1)
track = 0
channel = 0
pitch = 60
time = 0
duration = 1
volume = 100
MyMIDI.addNote(track,channel,pitch,time,duration,volume) 
```

希望这可以帮助

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-10-05T23:08:14.280

我一直在寻找一个纯 Python 库来生成 MIDI 文件，[mxm 的 Python MIDI 库](http://www.mxm.dk/products/public/pythonmidi)就是这样。

从[这个 dzone 片段](http://snippets.dzone.com/posts/show/572)中，有一个上述库的单文件版本，[smidi.py](http://larndham.net/service/pys60/smidi.py)（[这里](http://gist.github.com/202595)的要点是为了后代）

用法很简单：

```
>>> import smidi
>>> m = smidi.MidiOutFile('out.mid')
>>> m.header()
>>> m.start_of_track()
>>> m.update_time(0)
>>> m.note_on(note=0x40)  # single note
>>> m.update_time(192)
>>> m.note_off(note=0x40) # stop it after 192
>>> m.update_time(0)
>>> m.end_of_track()
>>> m.eof() 
```

大概可以在 Windows 上运行（因为原始示例`C:\out.mid`用作输出文件名），并且我已经在 OS X 上对其进行了测试

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-20T12:09:15.547

[pyPortMidi](http://alumni.media.mit.edu/~harrison/code.html)是 PortMidi 的 Python 包装器，它被描述为“用于实时 MIDI 控制的跨平台 C 库”。我自己没用过，但看起来很有前途。明确提到能够实时发送 MIDI 数据。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-09-14T19:46:20.833

如果您只需要生成 Midi 或处理 midi 文件，请尝试[mingus](http://code.google.com/p/mingus/)，它是一个很棒的包，它还允许更高的抽象，例如和弦、和弦进行、音阶等。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-03-19T20:39:40.167

[我尝试了 wiki http://wiki.python.org/moin/PythonInMusic](http://wiki.python.org/moin/PythonInMusic)上列出的八个软件包。我发现music21（[http://web.mit.edu/music21/](http://web.mit.edu/music21/)）是那个

*   最全面的
*   最好的教程
*   最容易安装在windows上

但至于您对简单的要求，我认为这不是最简单的。但我无法让任何其他程序以稳健的方式读取 MIDI 文件（我有各种奇怪而美妙的 MIDI 文件格式）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-19T18:36:56.423

pyGame 1.9 中添加了 Midi 支持（输入和输出），虽然它主要处于开发阶段并且还没有很好的文档记录，但它可以工作。

pyGame 的后继者 pgreloaded（或 pygame2）也正在开发 Midi 支持。

另请注意，尽管 pyGame 的标题中有“游戏”，但它的用途远远超出了游戏设计。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-02-20T12:22:46.730

看看[cSounds](http://www.csounds.com/)。

# asp.net - 文本框中的动态值

> ID：569323
> 
> 赞同：0
> 
> 时间：2009-02-20T11:54:50.260
> 
> 标签：asp.net

我有一个这样的文本框：

```
<asp:TextBox ID="txtLogin" runat="server" Text='<%# strUserID %>'></asp:TextBox> 
```

`strUserID`是在我的代码隐藏中设置的字符串值，我绑定文本框以查看该值。我试过了`<%= strUserID %>`，但它对我不起作用。你能告诉我为什么吗？

另外，我有一个这样的隐藏字段：

```
<input id="hdnUserID" runat="server" type="hidden" value='<%=txtLogin.ClientID %>'  /> 
```

我有一个函数打印隐藏字段值，如下所示：

```
function CheckForValue()
{
    var uid = window.document.getElementById('<%= txtLogin.ClientID %>').value;
    alert(hdnUserID);

    return false;
} 
```

但此警报始终打印为“[object]”。谁能解释一下？看起来`<%= value %>`根本不起作用。但我在我早期的项目中看到现有代码有这些行！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T12:34:39.510

如果您的 strUserID 值是在后面的代码中设置的成员变量，请确保它的访问修饰符被声明为至少受保护，否则您将无法访问它。此外，您要使用的符号是`<%= strUserID %`> 而不是`<%# strUserID %>`# 用于获取数据绑定数据项的值。

同样在您的第二点中，我认为您不需要隐藏字段。您不能只使用以下内容来获取您的文本框值吗？

```
function CheckForValue()
{
    var textValue = window.document.getElementById('<%= txtLogin.ClientID %>').value;
    alert(textValue);

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T12:03:25.917

尝试为您的消息获取文本框的 innerHTML 或 innerText 值。

# asp.net - ASP.NET：它是否涉及 Active X？

> ID：569327
> 
> 赞同：4
> 
> 时间：2009-02-20T11:55:46.933
> 
> 标签：asp.net, security, user-interface, activex

抱歉，真的是新手问题，但如果我要创建一个 ASP.NET 网站应用程序，例如链接到数据库的事件日历 - 与此日历交互的用户会使用 Active X 吗？

真的不知道如何以其他方式提出这个问题。我问的原因是我的工作系统阻止了 Active X 控件，因此使用 ASP.NET 开发任何东西都没有意义。

作为一个附带问题 - 什么不使用 Active X？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T11:57:54.263

ASP.NET 是一种服务器端技术，不一定与 ActiveX 或其他任何客户端技术有任何关系。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T11:57:36.760

ASP.NET 不使用 ActiveX，除非您通过互操作来这样做。

有许多 ASP.NET 控件等可以执行您想要的操作并使用 JavaScript 等而不是 ActiveX。对于真正灵活的动态内容，MS 正在推动[Silverlight](http://silverlight.net/)，这是他们在许多方面与 Flash 的竞争对手。

# .net - 用于合并文件的 .NET 库

> ID：569335
> 
> 赞同：3
> 
> 时间：2009-02-20T11:58:18.723
> 
> 标签：.net, file-comparison

您是否知道任何可用于比较和特别是合并两个文件（如 .pst）的 .net 库 - 如果开源或便宜，那将是最好的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T14:12:00.647

下面是一些实现

*   [http://www.codeproject.com/KB/recipes/diffengine.aspx](http://www.codeproject.com/KB/recipes/diffengine.aspx)
    *   前段时间写的，但完全是公共领域
*   [http://www.mathertel.de/Diff/](http://www.mathertel.de/Diff/)
    *   基于 Eugene Myers 经典算法。目前获得 BSD 许可
    *   也很旧，但算法和实现都很好而且很稳定
*   [http://www.menees.com/DiffDotNet.htm](http://www.menees.com/DiffDotNet.htm)
    *   作为一个应用程序，尽管它将几乎所有的差异逻辑都推迟到一个简单的库中，所以这将是库使用的一个很好的例子。

我建议从 Myers 实现开始，因为它基于合理的算法，因此如果存在错误，您可能能够根据其他一些参考实现来识别它。

# apache-flex - Flex FileReference.download - 是否可以打开相关的应用程序

> ID：569350
> 
> 赞同：1
> 
> 时间：2009-02-20T12:05:25.007
> 
> 标签：apache-flex, flash, flex3

当使用 FileReference.download() 从服务器检索文件时，我想为用户提供直接打开相关应用程序的选项，而不必先将其保存到磁盘。

这在 Flex 3 中可行吗？而且，如果是这样，它是如何完成的！

谢谢，马克

附言。我也试过做 URLLoader.load(URLRequest) ，但没有骰子......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T12:15:13.800

不，不幸的是你不能这样做。我的猜测是这是由于安全限制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T13:43:48.703

从 Web 应用程序来看，这肯定是不可能的。通过要求操作系统处理文件的打开并将其保留在该位置，可以从 AIR 应用程序中实现。Windows 和 OS X 应该能够优雅地处理它。

为什么 Adob​​e 限制来自 Web 应用程序的此类操作是有道理的。对于任何人来说，创建一个带有下载和运行病毒的 Flash 应用程序的常规网站都是一个明显的机会，而用户实际上对此一无所知。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-08T22:21:56.243

navigateToURL(urlReq, "_blank") 在大多数情况下都有效，但不要在 IE 7 和更早版本中打开 Excel、CSV 文件（MS 办公应用程序）。

# java - 读取 HTML 文件以在 JEditorPane 中查看

> ID：569351
> 
> 赞同：1
> 
> 时间：2009-02-20T12:06:23.587
> 
> 标签：java, html, user-interface, swing

我有一个打印到 HTML 文件的 Java 程序。另一种方法读取此文件并将其打印到编辑器窗格。

我的问题是橙色不起作用。我的代码如下：

```
print.println("<html><p><br><font color=\"orange\">"); 
```

当我将此 html 文件传递​​到编辑器窗格时，所有颜色都是正确的。红色、黄色和蓝色都可以，但橙色不行（我也试过用粉色等代替橙色，但没有运气）。如果我将橙色更改为蓝色，则效果很好。当我在网络上将它作为 HTML 文件打开时，我想要的橙色文本是橙色的并且可以正常工作。帮助？

同样所有的缩进都很好，但是当它接近结尾时，它会向右移动。例如：

```
abc 0
bcd 1
vde 1
def 2
...
swe 7      
    dfr 8            
              ..................................................... ert 3 
```

其中 ert 3 是需要打印的最后一个字符串。但它设法适合框中的所有文本。

* * *

*编辑*：感谢第一部分的帮助。关于底部的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T12:27:50.850

橙色不起作用，因为它不是默认的 html 单词

[http://www.handleidinghtml.nl/divers/kleuren/schermafdrukken/16kleuren.gif](http://www.handleidinghtml.nl/divers/kleuren/schermafdrukken/16kleuren.gif)

显示 16 种默认颜色。

然而，大多数浏览器支持其他颜色，但 java 仅支持 HTML 3.2

阅读有关 HTMl 的所有内容并在[http://java.sun.com/docs/books/tutorial/uiswing/components/html.html中摆动](http://java.sun.com/docs/books/tutorial/uiswing/components/html.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T12:34:54.953

JEdi​​torPane 不支持现代浏览器支持的所有内容。[很快](http://forums.sun.com/thread.jspa?threadID=5327759)，就会有一个[JWebPane](http://weblogs.java.net/blog/ixmal/archive/2008/05/introducing_jwe.html)组件，它将提供完整的基于 WebKit 的 HTML 支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T18:42:00.453

HTML in swing 不符合标准。

看看这个组件[https://xhtmlrenderer.dev.java.net/](https://xhtmlrenderer.dev.java.net/)

# jakarta-ee - 如何从 servlet 获取信息到 JBoss Portal 2.5.4 中的 portlet

> ID：569352
> 
> 赞同：0
> 
> 时间：2009-02-20T12:06:29.593
> 
> 标签：jakarta-ee, jboss, jboss-portal

我有一个基于 JBoss Portal 2.5.4 构建的门户，需要一些 I18N。在 login.jsp 页面（位于 portal-server.war 中）上，我们添加了语言切换。页面上的链接之一是忘记密码工具。

出于与外观相关的原因，ForgetPassword 页面在我们的 JBoss 门户中实现为最大化的 portlet。但是，显然，还没有用户对象，因为还没有登录。

那么如何将用户在 login.jsp 上选择的语言环境信息传递到 Forget Password jsp 中呢？

我试过了：

*   会话变量（不行，它们不会跨越战争）
*   cookie（JBoss Portal 吞下它们）
*   URL 参数（JBoss Portal 也吞下它们）
*   System.setProperty() - 当他们到达 ForgetPassword jsp 时，他们被重置了。

这一切都在 Windows Vista 或 2003 上运行。

我缺少一些明显的技术吗？我是否只需要咬紧牙关，将我的 ForgetPassword 页面重新组织为 servlet，以便获取 URL 参数？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T15:37:46.720

好的，我找到了一种机制来做到这一点 - 在 portal-object.xml 中创建一个新的 portlet 窗口 (ForgotPasswordWindow_de)：

```
<window>
    <window-name>ForgotPasswordWindow_de</window-name>
    <instance-ref>UserMgmtPortletInstance_de</instance-ref>
    <region>center</region>
<height>0</height>
</window> 
```

它指向 portlet-instances.xml 中的一个新的 portlet 实例 (UserMgmtPortletInstance_de)，它指向同一个 Portlet，并定义了一个语言首选项。

```
<deployments>
   <deployment>
        <instance>
           <instance-id>UserMgmtPortletInstance</instance-id>
           <portlet-ref>UserMgmtPortlet</portlet-ref>
           <preferences>
            <preference>
                <name>lang</name>
                <value>en</value>
                <read-only>true</read-only>
            </preference>
           </preferences>
          <security-constraint>
              <policy-permission>     
                <unchecked/>                
                 <action-name>view</action-name>
              </policy-permission>
           </security-constraint>
        </instance>
   </deployment>
   <!-- add new deployment for UserMgmtPortletInstance_de -->
   <deployment>
        <instance>
           <instance-id>UserMgmtPortletInstance_de</instance-id>
           <portlet-ref>UserMgmtPortlet</portlet-ref>
           <preferences>
            <preference>
                <name>lang</name>
                <value>de</value>
                <read-only>true</read-only>
            </preference>
           </preferences>
          <security-constraint>
              <policy-permission>     
                <unchecked/>                
                 <action-name>view</action-name>
              </policy-permission>
           </security-constraint>
        </instance>
   </deployment>
</deployments> 
```

然后，在 Portlet doView() 代码中，我找到了这个首选项，并设置了一个属性。

```
 String lang = request.getPreferences().getValue("lang", null);

    request.setAttribute("lang", lang); 
```

然后，在 jsp 中，我查看属性，并设置语言环境。

```
String locale = (String) request.getAttribute("lang"); 
```

首先，登录页面有一个开关，如果语言是德语，它会调用 ForgotPasswordWindow_de 而不是 ForgotPasswordWindow_en

# svn - SVN 中的发布管理

> ID：569353
> 
> 赞同：17
> 
> 时间：2009-02-20T12:07:20.090
> 
> 标签：svn, release-management

当我查看 SVN 日志时，我真的希望我能看到告诉我发布何时完成的标记。我在 PVCS 和[Perforce](http://www.perforce.com/perforce/doc.current/manuals/cmdref/tag.html)等其他版本控制系统中看到了这一点。

这可以在SVN中完成吗？我做了一些研究，到目前为止，似乎不支持这种事情。

## 编辑

我们不希望每次发布都将源代码复制到不同的文件夹中。*这会导致开发人员机器上出现*大量不必要的文件重复， 并且只为我们提供了每个版本的修订号的记录。我可以使用文本文档来做到这一点！

## 编辑2

我的目标是有一个单一的视图来显示我的版本的年表，在这之间我可以看到每个版本之间发生的所有代码更改。这样就可以更轻松地编译发行说明。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-20T12:12:42.963

不是这样的。在 SVN 中进行发布的公认方法是有一个“标签”目录，在其中复制每个特定版本的发布源。例如`/tags/release-0.11`......没有什么可以防止您`tags`意外地弄乱目录，开箱即用，但是有些人喜欢设置预提交挂钩以防止意外提交以释放标签。

这是一篇[不错的文章](https://www.devroom.io/2006/11/21/svn-how-to-release-software-properly/)，描述了 SVN 中的发布过程。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-20T14:08:47.740

理查德，标签非常接近，但我想知道您是否需要一个专门的发布分支。

为此，尽早从主干创建一个分支，称为“发布”。然后像往常一样在主干上工作，当您准备好发布时，将主干中的更改合并到“发布”中。这是您应该修改发布的唯一方法。

然后，您可以根据需要从发布中标记，而不是 100% 必要。

但这会给你一个分支，其中包含主干修订的子集。通过以下方式了解您的发布日期：

```
svn log --stop-on-copy svn://server/project/branches/release 
```

这将为您提供发布日期列表（带有修订版）。要查看每个版本中的内容，请执行以下操作：

```
svn mergeinfo --show-revs=merged "svn://server/project/trunk" "svn://server/project/branches/release"@<release revision> 
```

另请注意，通过这种方式，您不仅限于严格按顺序发布主干中的所有内容 - 您可以挑选修订版，如果您还不想发布修订版，则不包括修订版，但仍包括后续修订版。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-20T12:38:18.940

> 我的目标是有一个单一的视图来显示我的版本的年表，在这之间我可以看到每个版本之间发生的所有代码更改。

你研究过 Tortoise SVN 修订图吗？如果您标记每个版本（正如其他人指出的那样，这不涉及在服务器或工作站上复制文件），那么您可以按时间顺序查看所有修订，标签指示实际版本。您可以通过突出显示您感兴趣的两个修订并从上下文菜单中选择差异来区分版本和/或主干。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-20T12:25:16.910

将主干复制到 svn 存储库中的标签路径是实现此目的的方法。它是一个 svn 副本，因此不会在 svn 存储库服务器上出现重复文件。如果您选择检出除主干以外的 svn 路径，则只有在本地有重复文件。提交这些工作副本然后返回到它们被签出的 svn 路径。

这本质上是 svn 中分支的特定常规实现。查看在线 svn book 了解更多详细信息。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-20T12:13:08.670

标记将是在制作发布标签时写入的提交消息（到 /tags 的 svn 副本）。至少这是最常用的方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T13:17:25.133

看看 SVN Book 的主题：

[标记](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.tags.html) 和 [浏览存储库](http://svnbook.red-bean.com/en/1.5/svn.tour.history.html#svn.tour.history.browsing)

标签和分支是“写时复制”，这意味着存储库中没有额外的副本。通常，除非出于某种原因（IE 在分支上开发），否则单个开发人员不需要本地副本。

如果您标记每个版本，那么您可以通过浏览存储库来查看标记。上面的链接直接讨论了命令行工具，但也有像 Windows 上的 TortoiseSVN 这样的 GUI 工具。您可以获取历史记录，进行比较等。

要查看版本中所做的更改，您只需显示从您想要的标签修订版到前一个标签的修订版 +1 的主干日志。这听起来像是额外的工作，但是一旦你习惯了它就很简单了。

使用我们的构建工具，我们还将带有一些版本号信息的文件提交回主干，并且注释具有构建的版本号。如果您的主要代码在主干中，这也可以用作构建中的标记（查看版本提交之间的内容）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-20T13:21:18.553

虽然 Subversion 本身不提供发布管理，但版本控制工具通常不负责此活动。您正在寻找的是可以与 Subversion 交互的活动/问题/变更管理工具。

为此，我们在我的工作地点使用 Jira，并将它与 Subversion 链接。Jira 提供了路线图和更改历史记录，其中包括每个版本中的问题。这些问题中的每一个都与源代码控制的变化有关。因此，您可以将源代码中的更改与发布的版本联系起来。

我认为通常最好将这两个工具分开。尽管 Perforce 特别试图将两者联系在一起，但他们只是简单地这样做。有些事情，比如通过电子邮件向用户发送问题的更改、为问题添加评论、为问题添加附件，这些在 Jira 等专用软件中做得更好。另一方面，Jira 不太擅长版本控制、合并和分支源......这在像 Subversion 这样的专门软件中处理得更好。

为了充分披露，除了 Jira 之外，还有其他工具，例如 Bugzilla、Trac、IBM Rational Jazz 等，它们可以使用 Subversion 做同样的事情，尽管 Jira 具有不同级别的功能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-20T14:22:12.043

+1 用于使用提交消息。

对于一个项目，我创建了一个名为 build 的 SVN 用户。构建机器将此登录名用于 SVN。每当构建机器/进程进行构建时，它也会更新一个文件，并且 SVN 提交消息是构建的版本/其他标识符。

然后我们还为该构建创建了一个标签。通过这种方式，我们可以在主干中看到构建何时/何处穿插其他更改。

所以我的建议（最简单的方法）是创建另一个名为 build 的文件（或您想要的任何其他文件）并附加到该文件或只是在您的构建脚本/过程中对其进行修改，然后将其重新签入/使用名称提交发布版本作为提交消息。简单的。然后它将显示在您的历史查询中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T13:01:23.393

此外，如果您知道要比较的修订版，您可以进行 SVN 比较，您将看到哪些文件已更改以及两个修订版之间的更改情况。

不确定您的总体设置，但有人提到 TortoiseSVN。这绝对是一个好的开始。我个人将 Eclipse 与 subclipse 插件一起使用，它允许我在修订之间的图形环境中执行差异。只要您有您的项目，您就可以将任何修订与任何其他修订进行比较，因此您不需要进行所有类型的文件复制。

另外，我们通常在每个存储库中设置三个目录。分支、树干和标签。正如有人指出的那样，标签专门用于识别发布。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-20T15:00:02.890

我遇到了同样的问题，我试图为我的公司修复它的方法是在主干中有一个“发布”文件夹，这个文件夹只包含实际的可执行文件或需要成为部署的一部分。

我在“发布”文件夹中为每个版本创建一个以“1.0.0.0”开头的新文件夹，并使用相同的发布文件夹名称标记代码，即案例中的 1.0.0.0。

我不确定这是否是正确的方法，但它解决了我的问题，以找出我已部署的可执行文件。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-08T14:25:40.827

如果您在存储库的根目录遵循“标签/分支/主干”的常规 svn 约定，开发人员通常不想检查整个存储库，而只需要从主干向下检查。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-07-11T20:53:05.790

我想提供一种不同的方法来帮助解决您所说的问题：创建发行说明并查看版本之间的代码差异。

我们使用 Tortoise SVN 附带的名为 SubWCRev 的实用程序。我们有一个构建后事件，它获取 SVN 修订号并将其粘贴到一个文件中 - 对于网站，我们将其放在一个名为 version.html 的文件中。然后在任何时间点，您都可以将您的版本（无论是当前在 QA、Prod 还是任何其他环境中的版本）与 SVN 中的确切修订号联系起来。不再需要标记，不再想知道发布中包含什么，不再烦扰开发人员更新版本文件。

为了确定发布中包含的内容，您可以将 SVN 日志从修订 X 拉到修订 Y 并将注释复制到文档中并进行编辑以制作漂亮的发布说明文档。代码审查或版本差异也是如此。只需使用与您的 version.html、properties.cs、readme.txt 等相关的修订号。

我还建议使用某种工件存储库来保存您的构建。如果您切换到使用 SVN 修订号作为您的版本号，您始终可以返回到 SVN 中的确切修订，这意味着您不需要为 SVN 中的每个版本提供源代码的标签或副本。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-02-20T12:27:58.260

供参考，

SVN 副本不是硬拷贝，它只是链接，因此除了更改的文件之外不会占用任何空间。无论如何，这些版本都会占用空间。因此，为每个版本创建一个副本不会占用任何空间。

# jquery - HTML 表格行链接

> ID：569355
> 
> 赞同：13
> 
> 时间：2009-02-20T12:07:56.670
> 
> 标签：jquery, html, html-table

使 HTML 表格的一行成为链接的最佳方法是什么？我目前正在使用 jquery 对行进行斑马条纹，并突出显示 onmouseover/off 选定的行，所以如果 JavaScript 是答案，请使用 jquery。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-20T15:33:13.200

我只使用css：

```
<style>
table.collection {width:500px;border-collapse:collapse;}
table.collection tr {background-color:#fff; border-bottom: 1px #99b solid;}
table.collection tr:hover {background-color:#ffe;}
table.collection td {display:table-cell;border-bottom: 1px #99b solid; padding:0px;}
table.collection td a {text-decoration:none; display:block; padding:0px; height:100%;}
</style>
<table class="collection">
<tr>
    <td><a href="#">Linky1</a></td>
    <td><a href="#">Data1</a></td>
</tr>
<tr>
    <td><a href="#">Linky2</a></td>
    <td><a href="#">Data2</a></td>
</tr>
</table> 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-20T15:18:55.887

```
$(document).ready(function(){
   $("tr").click(function(){
      /* personally I would throw a url attribute (<tr url="http://www.hunterconcepts.com">) on the tr and pull it off on click */
      window.location = $(this).attr("url");

   });
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T12:26:00.887

为 tr 元素注册一个 onclick 事件处理程序。像这样使用 jQuery：

```
$("tr").bind("click", function(){ 
  window.location = 'http://www.example.com/'; 
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-13T10:04:14.853

如果您不介意用通用元素替换表格，则不需要 jQuery：

```
<style>
    .table {
        border-collapse: collapse;
        border-spacing: 0;
        display: table;
    }
    .tr {
        display: table-row;
    }
    .td {
        display: table-cell;
    }

</style>

<section class="table">
    <a class="tr" href="#">
        <div class="td">
            A
        </div>
        <div class="td">
            B
        </div>
        <div class="td">
            C
        </div>
    </a>
</section> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-18T15:00:37.720

```
<td>
    <a href="/whatevs/whatevs">
        <div class="tdStreacher"> linkName
        </div>
    </a>
</td>

.tdStreacher{
    height: 100%;
    width: 100%;
    padding: 3px;
} 
```

这样，每个单元格的所有区域都将充当链接，因此，整行都充当链接。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-02T17:28:29.303

这是一个基于 Nick 解决方案的 jQuery 插件。

```
(function($) {
  $.fn.linkWholeRows = function() {

    // for each object
    return this.each(function() {

      // for each row
      $(this).find('tbody tr').each(function() {
        // get the first link's href
        var href = $(this).find('td > a').attr('href');
        // if none found then
        if (href === undefined) {
          return true; // continue
        }

        // wrap all cells with links that do not already have a link
        $(this).children().not(':has(a)').each(function() {
          $(this).contents().wrapAll('<a href="' + href + '" />');
        });

        // apply the row's height to all links
        // in case that the cells' content have different heights
        var height = $(this).children().css('height');
        $(this).find('td > a').each(function() {
          $(this).css('height', height);
          // do not forget to apply display:block to the links
          // via css to make it work properly
        });
      }); // each row

    }); // each object

  };
})(jQuery); 
```

期望行被包裹在 tbody 中。高度是明确设置的，因为尼克的原始解决方案不适用于我在具有不同高度的相邻单元格上。确保将 a 元素设置为块。如果要应用填充，请将其应用到 a 元素而不是表格单元格：

```
a {
  display: block;
  padding: 0.25em 0.5em;
}
tbody td { padding: 0; } 
```

只需调用

```
$('#your-table').linkWholeRows(); 
```

希望能帮助到你。干杯，理查德

# javascript - 使用 javascript 清除所有 HTML 字段

> ID：569357
> 
> 赞同：12
> 
> 时间：2009-02-20T12:08:52.910
> 
> 标签：javascript, html

是否可以通过调用 javascript 函数清除 HTML 中的所有文本框？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-20T12:16:25.310

```
var elements = document.getElementsByTagName("input");
for (var ii=0; ii < elements.length; ii++) {
  if (elements[ii].type == "text") {
    elements[ii].value = "";
  }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-20T12:12:07.567

```
var fields = document.getElementsByTagName('input'),
    length = fields.length;
while (length--) {
    if (fields[length].type === 'text') { fields[length].value = ''; }
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-20T12:16:27.540

这应该做的工作

```
var inputElements = document.getElementsByTagName('input');

for (var i=0; i < inputElements.length; i++) {
    if (inputElements[i].type == 'text') {
        inputElements[i].value = '';
    }
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-20T12:14:10.807

虽然不是最简单的解决方案，但请查看 jQuery。您应该能够执行以下操作：

```
$("input[type=text]").val(''); 
```

不过，我不是 jQuery 专家。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-20T12:12:36.270

如果所有字段都开始空白，您可以调用表单的重置方法：（
`document.forms[0].reset()` 根据您的具体情况，通常有更优雅的方法来获取表单句柄）。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-20T12:25:43.353

我认为

```
$("input:text").val(""); 
```

应该与 jQuery 一起使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-11-06T18:20:22.833

旧帖子..但是，以 jquery 为例：

```
$("input[type=text],textarea,input[type=email]").val(''); 
```

# apache-flex - 如何使用颜色选择器更改 css 控件字体颜色

> ID：569377
> 
> 赞同：0
> 
> 时间：2009-02-20T12:15:25.670
> 
> 标签：apache-flex

我使用颜色选择器作为字体颜色。我想知道当我从颜色选择器中选择任何颜色时，所有文本颜色都会更改为选择的颜色。是否可以使用 css 来解决问题。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T12:20:41.680

将事件处理程序添加到颜色选择器的更改事件，并将 selectedColor 属性分配为应用程序的颜色样式。

```
application.setStyle("color", colorPicker.selectedColor); 
```

# php - 从关联数组（php）中提取值的子集

> ID：569379
> 
> 赞同：17
> 
> 时间：2009-02-20T12:16:05.233
> 
> 标签：php, arrays, associative-array

我想做一些看似非常简单的事情，但我找不到任何东西：只需提取类似于 array_splice 的数组的子集，但*使用键来检索值*：

```
$data = array('personName' => 'John', 'personAge' => 99, 'personId' => 1,  
              /* many more data I don't need here ... */);

list($name, $age, $id) = array_splice_by_keys($data,
                          array('personName', 'personAge', 'personId'); 
```

如果一切都失败了，是否有一个内置函数可以通过键过滤关联数组？例如：

**$filteredArray = array__extract__keys__and__values($srcArray, $arrayOfWantedKeys);**

```
// create a new array with ONLY those key => values I need
$wanted_values = array_extract_keys_and_values($data,
                  array('personName', 'personAge', 'personId');

echo $wanted_values['personName']; 
```

我想我想做第一个的原因是我不喜欢在我的代码中重复关联数组访问，复制经常使用的值似乎更好（例如在循环中), 到一个局部变量中，而且输入 $name 比 $somearray['name'] 容易得多。

编辑：谢谢，我想与列表一起使用，解决方案是

```
list($x, $y, $z) = array_values(array_intersect_key($array, array_flip($wantedKeys))); 
```

array_flip 的有趣使用！

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-20T13:06:53.097

这与 SilentGhost 的答案基本相同，但这可能更容易，而且可能会慢一点。

```
array_intersect_key($array, array_flip($wantedKeys)); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-20T12:37:54.243

在 php 版本 >= 5.1.0 中，您可以使用[`array_intersect_key`](https://secure.php.net/array_intersect_key)：

```
$data = array('personName' => 'John', 'personAge' => 99, 'personId' => 1,  
          'test' => 23);
$ex = array('personName'=>0, 'personAge'=>0, 'personId'=>0);
var_dump(array_intersect_key($data, $ex)); 
```

值`$ex`无关紧要，它们只需要存在即可。

# performance - 使用 BizTalk Server 2006 的 TCP/IP 适配器时出现窒息

> ID：569400
> 
> 赞同：0
> 
> 时间：2009-02-20T12:28:26.310
> 
> 标签：performance, biztalk, tcp, adapter

我正在使用从 codeplex 获得的用于 BizTalk Server 2006 的 TCP/IP 适配器：http: [//www.codeplex.com/BTSTCPIP](http://www.codeplex.com/BTSTCPIP)
一旦应用程序部署到生产环境中，我们就开始体验到应用程序性能的阻塞。请求越多，性能下降越多。
有时，接收端口会变得无响应，我们必须强制重启主机实例以暂时让服务再次响应，但我们一次又一次地遇到相同的问题。我想问一下你们中是否有人使用过相同的适配器并且遇到过类似的问题？如果是，我们如何克服这些问题。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T14:16:40.840

我们经历了类似的行为，但这是一个更深层次的系统性问题。该问题是否影响其他应用程序？您的 DBA 是否发现数据库中有过多的阻塞？您的 SQL 作业是否正在运行和/或失败？您的备份是否定期处理？

我记录了我们在[这里](http://www.implementsivillage.net/PermaLink,guid,ac3f65fa-0051-48a0-bb8b-f9e741c1a0d1.aspx)遇到的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-07T22:48:47.607

连接是否被关闭？如果端口是双向的，您是否提供某种响应？当我使用 HL7 Pack 附带的 MLLP 适配器时，我记得与此相关的一些事情。

# delphi - 四舍五入货币价值的推荐方法

> ID：569401
> 
> 赞同：4
> 
> 时间：2009-02-20T12:29:06.917
> 
> 标签：delphi

首先看到如下问题：

[SetRoundMode(rmUp) 并舍入“round”值（如 10），结果为 10,0001。](https://stackoverflow.com/questions/565797/setroundmodermup-and-rounding-round-values-like-10-results-in-10-0001-how-come)

我需要将货币值向上取整，因此 0.8205 变为 0.83，但上面显示的 SimpleRoundTo 行为让我有些头疼。

如何以安全的方式将货币价值四舍五入？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T12:34:44.593

您可以使用 Ceil 功能：

```
newvalue := Ceil(oldvalue * 100) / 100; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T15:00:52.357

请注意，将 0.8205 舍入到 0.83，以及将 0.8305 舍入到 0.84，将导致舍入的平均偏差向上。默认舍入模式是银行家舍入，向偶数舍入以避免方向偏差。

如果您的计算具有复式性质，这一点尤其重要。带有方向偏差的舍入可能导致任一侧的不匹配。

使用`SetRoundMode`更改 FPU 控制字。请注意，这种 FPU 模式舍入应用于浮点运算的情况下，在考虑`Currency`类型时可能并不明显，这是一种定点类型（缩放的 64 位整数）。`Currency`即使在预期值为 82.00时，中间浮点计算（例如 82.000000000000001）中的小不精确最终也会向上取整。更改线程全局舍入模式只需要谨慎进行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T18:00:03.610

你这样做是错的。

不要使用浮点数来表示时间和金钱等重要类型！

使用代表您需要的最高精度的整数。例如，使用表示 1000 美分的整数。然后您可以传递 82050 左右，当您最终需要将其显示为字符串时**，然后才**使用整数计算进行舍入。

要真正回答您的问题，不应四舍五入 0.8205 美元。应该是 0.825 美元。

# redirect - 从 domain.com 重定向到 www.domain.com 保留 GET 和 POST 数据

> ID：569402
> 
> 赞同：0
> 
> 时间：2009-02-20T12:29:10.957
> 
> 标签：redirect, http-status-code-301

目前，如果人们访问 domain.com 或 www.domain.com，我的网站会显示相同的数据。

我想设置一个重定向，以便所有对 domain.com 的请求都将发送到 www.domain.com。因此，访问 domain.com 的用户将被重定向到 www.domain.com。就像你去[http://amazon.com/?a=b会发生什么](http://amazon.com/?a=b)

我不想丢失或损坏在 domain.com 请求中发送的任何 GET 或 POST 数据。

做这个的最好方式是什么？我应该使用 301 重定向吗？这是否会导致用户的浏览器将 GET/POST 数据重新发送到 www.domain.com URL？

[编辑] 好的，Zaagmans 说将 POST 透明地重定向给用户是不可能的。所以让我们暂时忽略 POST。我应该如何仅使用查询字符串数据进行重定向？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T12:33:51.400

[Redirecting Post Requests](http://windowsitpro.com/article/articleid/26302/redirecting-post-requests.html)文章详细解释了这一点。**提议的307**
重定向 的一个（可能）缺点是浏览器会提醒用户并提供继续或取消请求的选项。

 *** * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:13:25.417

是的。对于 GET，您需要使用 301，并且浏览器需要重新请求它。如果您的 GET 是幂等的（它们应该是幂等的），那么这将不是问题。搜索引擎以不尊重其他 30x 代码的方式尊重 301。

我不知道您使用的是哪个 Web 服务器，但通常有 URL 重写/重定向模块可以为您处理很多此类问题。

# javascript - Internet Explorer 7 上的 JavaScript / jQuery 问题

> ID：569408
> 
> 赞同：0
> 
> 时间：2009-02-20T12:31:05.913
> 
> 标签：javascript, jquery, javascript-events

我有一个简单的 HTML 页面，如下所示：

```
...<div id="main">
    <a href="#">Click here!</a>
</div>... 
```

我在标题中有一段 jQuery JavaScript，如下所示：

```
 <script type="text/javascript">
    $(document).ready(function() {
        DoHello();
    });

    function DoHello()
    {   
        $("div#main a").text("Click here!");
        $("div#main a").attr("onmouseup", "javascript:alert('Hello!');");
    }
</script> 
```

当我在 FireFox 中单击 HTML 链接时，我会收到一条警报，上面写着“你好！”。为什么这在 IE7/8 中不起作用？

当我在 IE 中查看（动态）构建 DOM 时，我可以看到“onmouseup”存在但从未被调用。我尝试用“onclick”替换“onmouseup” - 同样的问题......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T12:39:23.693

您不应该将 JavaScript 伪协议用于任何事情。

这应该有效：

```
function DoHello()
{   
    $("div#main a")
        .text("Click here!")
        .mouseup(function(){
             alert('Hello!');
        });
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T12:39:17.220

不要使用expando事件，使用jQuery！

```
$("div#main a").mouseup(function(){ alert('Hello!') }); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T12:40:58.557

而不是像这样添加 onmouseup 事件，为什么不使用这样的 jQuery 方法：

```
$("div#main a").mouseup(function() {
   alert("hello");
}); 
```

应该工作:)有关更多信息，请查看 - [http://docs.jquery.com/Events/mouseup](http://docs.jquery.com/Events/mouseup)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T12:42:42.000

您应该像这样使用[绑定](http://docs.jquery.com/Events/bind)函数：

```
function DoHello(){
$("div#main a").bind("mouseup", function(e){
    alert("Hello!");
});
} 
```

# asp.net - 如何选择虚拟主机？

> ID：569410
> 
> 赞同：1
> 
> 时间：2009-02-20T12:31:32.933
> 
> 标签：asp.net, hosting

我有几个基于 Web 的个人项目正在筹备中，我无法选择如何托管它们。

我在域名和实际文件托管方面有疑问（我认为这是两个不同的主题，尽管许多公司都提供这两者）。

## 域名

我在 Freeparking.co.uk 注册了一个域名，但他们不提供我认为我需要的那种服务。我可以将域名转移到其他地方吗？除此之外，他们唯一要做的就是托管一个带有整页框架的页面，我为其配置了一个 URL。基本的 URL 隐藏，但这意味着人们无法为我网站中的特定页面添加书签。

## 托管

我希望使用 SQL Server 2005 托管 ASP.NET 应用程序（复数）。选择托管环境的步骤是什么？如何将域名连接到托管环境？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T12:42:50.550

域名最好与主机分开。体面的域名注册商让你自由定义*域名服务器*，然后提供域名的 IP 地址。通常（但不一定）这些名称服务器由托管公司提供。所以，步骤是：

1.  选择托管服务提供商（抱歉，我不推荐 ASP 托管服务提供商）。
2.  配置名称服务器，至少 yourdomain.com 的 A 记录指向您服务器的 ip（这通常由托管公司自动完成）。
3.  在注册商处配置您的域名，使其引用上述名称服务器。

域名注册商也可以提供名称服务器的东西，或者您可以使用例如[EveryDNS](http://www.everydns.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T12:43:34.167

您的域名只是驱动域名系统 - DNS 的名称服务器中的 IP 地址。检查 Freeparking 是否真的在做 NameServer 的事情。

1.  您可以选择任何满足您要求的主机。

2.  您的主机将拥有自己的 DNS 系统（即作为您的 Web 应用程序主机的服务器的 IP 地址）。

3.  要求 Freeparking 将您的域名指向新 IP 的名称。

我需要相同的 ASP.Net 和 SQL，然后选择了 DiscountASP.net（尽管它们在美国），到目前为止服务非常好 =>

他们也做电子邮件方面的工作。域名的 MX 部分。

# windows-vista - 如何从 Windows 2008/Vista 中删除注册表项

> ID：569411
> 
> 赞同：0
> 
> 时间：2009-02-20T12:32:24.053
> 
> 标签：windows-vista, vbscript, windows-server-2008

我有这个脚本可以在 Windows 2008/Vista 上运行以删除一个注册表项，但我无法让它运行：

```
Const HKEY_CLASSES_ROOT     = &H80000000
strComputer = "."
strKeyPath = "Installer\Products\334A4D1453680B74CA87BEE6B7E40113" 
Set objRegistry = GetObject("winmgmts:\\" & _
    strComputer & "\root\default:StdRegProv") 
DeleteSubkeys HKEY_CLASSES_ROOT, strKeypath 

Private Sub DeleteSubkeys(HKEY_CURRENT_USER, strKeyPath) 
  strComputer = "."
  Set objRegistry = GetObject("winmgmts:\\" & _
    strComputer & "\root\default:StdRegProv") 

  objRegistry.EnumKey HKEY_CURRENT_USER, strKeyPath, arrSubkeys 
  If IsArray(arrSubkeys) Then 
    For Each strSubkey In arrSubkeys 
        DeleteSubkeys HKEY_CURRENT_USER, strKeyPath & "\" & strSubkey 
    Next 
  End If 

  objRegistry.DeleteKey HKEY_CURRENT_USER, strKeyPath 
End Sub 
```

知道为什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T20:53:49.090

您是否以管理员用户身份运行它？尽管您使用 HKEY_CURRENT_USER 作为参数名称，但您仍试图从 HKEY_CLASSES_ROOT 中删除，这通常需要提升访问权限。

# wcf - SSL 错误 + WCF

> ID：569413
> 
> 赞同：2
> 
> 时间：2009-02-20T12:33:26.453
> 
> 标签：wcf, ssl

 **[SSL 错误 RemoteCertificateNameMismatch](https://stackoverflow.com/questions/569320/ssl-error-remotecertificatenamemismatch)**的完全重复**
[SSL 错误 RemoteCertificateNameMismatch](https://stackoverflow.com/questions/569346/ssl-error-remotecertificatenamemismatch)**

 **我正在使用 WCF 让客户端访问服务。我正在尝试使用 TLS (https) 访问端点。我有带有私钥和公钥的证书。

如果我让服务的端点具有与证书名称相同的主机名（“颁发给”），那么我可以从客户端访问该服务。

如果“颁发给”和端点域名的名称不同，我会收到错误“无法为具有权限的 SSL/TLS 安全通道建立信任关系”。我已将证书添加到“受信任的根”、“个人”和“受信任的人”。在我的服务中，我使用了“PeerOrChainTrust”。

请让我知道是否有人对此有任何想法

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T12:40:56.093

在这种情况下，您需要在客户端为服务器定义信任策略，

在对服务进行任何调用之前调用一次 SetCertPolicy。

```
using System.Net;
using System.Security.Cryptography.X509Certificates;
        public static void SetCertPolicy()
        {
            ServicePointManager.ServerCertificateValidationCallback += RemoteCertValidate;
        }

        private static bool RemoteCertValidate( object sender, X509Certificate cert, X509Chain chain,
            SslPolicyErrors error )
        {
            // trust any cert!!!
            return true;
        } 
```

# .net - .NET 类库许可理念——疯狂？

> ID：569417
> 
> 赞同：1
> 
> 时间：2009-02-20T12:34:43.160
> 
> 标签：.net, licensing

您好我目前正在开发一个 .NET 库（不是控件），并考虑如何提供组合的“开发”和可自由运行时可部署的许可方案来使用它。

我正在考虑开发人员许可，某种节点锁定会很好（文件和/或服务器/Web服务），但我希望允许开发人员在运行时自由分发我的软件。

我在徘徊，如果对于运行时许可证，最好将许可证密钥的 MD5 哈希值、调用程序集（或可执行文件/模块 - 不确定）的公司信息，或者它自己的信息作为其中的一部分强名称哈希键？

这意味着我的用户每次发布/分发他们的软件时都必须生成运行时许可证，但我认为这不应该太繁重。这可以通过有效的开发/构建许可/节点锁定机器完成，使过程非常简单和轻松。

这是现阶段的一个想法。我很想听听人们对这个想法的任何想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T13:53:08.370

关于这个的一些想法：

*   我相信是乔尔·斯波尔斯基（Joel Spolsky）指出，您必须使获得许可证比破坏（抱歉）“解决”软件的许可机制更容易。作为开发人员使用过节点锁定软件后，这可能会让人感到痛苦，尤其是如果您拥有多台机器。也许看看基于用户的许可（即，我的用户在他们的个人资料中的某处有一个单一的许可，如果它尚未使用，那么无论你在哪台机器上都可以使用它）。
*   我预见到您的双重许可方案存在问题，即拥有无限运行时许可证，但仍需要*同一*库的每座开发人员许可证。例如，是什么阻止了开发人员为他们的开发目的“许可”运行时？
*   执行是另一个问题。您如何确定您的客户是否违反了您的许可协议？拥有图书馆“电话回家”很可能会排除它在许多公司的防火墙环境中的使用。
*   你需要为这个计划投入多少精力？你能买一个吗？您能否利用这段时间来改进您的图书馆，以便您的客户购买升级版？
*   如果有任何类似的图书馆，请检查它们是否有任何形式的复制保护。如果没有，请立即忘记它，因为您将以这种方式将销售交给您的竞争对手。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T13:43:29.483

每个人都讨厌许可，那么为什么不使用他们在代码中的一个对象上设置的简单许可密钥呢？

YourNamespace.Licensing.SetLicenseKey(193421340982384);

我不会要求他们为每个构建重新创建许可证密钥，这会很乏味。但是，您可以这样做，以便您提供给他们的许可证密钥可以转换为公钥令牌，然后您可以查看它是否与调用您的代码的程序集的公钥令牌匹配。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T14:36:16.907

感谢所有人的想法和评论。

是的，需要考虑一些好点。

进行讨论；

我不是想在这里开发一个无敌的许可系统（这可能是不可能的，我不想使用加密狗等），我正在开发自己的单人项目，所以花 3000 美元买了一个现成的解决方案永远不会发生。

我只是想阻止它很容易将许可证发送给另一个开发人员或使用一个许可证而不是 5 个许可证“逃脱”。合法用户会付钱，但有决心的人无论如何都会绕过它，所以我不会费心去阻止他们。我有点认为无论如何都应该有一种“开发者荣誉”的氛围——剥削你的开发者伙伴是 IMO 的恶业。尼亚耶夫？大概。

作为对使用开发者运行时许可证的开发人员的回答。我可能在这里遗漏了一些东西，但这个想法是，当他们的软件准备好交付时，客户会生成一个运行时许可证密钥 - 即构建并准备好 - 这使得许可证应用程序被锁定，而不是用于开发应用程序的机器锁定开发人员许可证密钥。

我在想的许可证只是一个随库分发的文件，因此可以根据需要在开发和运行时之间切换。我的许可证代码将能够判断它是哪种许可证类型（许可证文件中加密块中的 dev/rt 指示符？）

必须通过从我随软件提供的工具调用密钥发布 Web 服务来激活/创建开发许可证密钥。用户将提供一些信息，例如姓名和电子邮件地址。该工具将采用特定于机器的东西。所有内容都被发送到 Web 服务，该服务返回一个包含个人信息（原始文本副本？）的许可证文件和一个哈希（然后是 SHA，而不是 MD5！）

在运行时，我的库加载许可证密钥文件（开发或运行时），并相应地验证许可证（验证其运行的节点或调用它的应用程序）。我可以允许用户代码按照建议调用，传递许可证密钥文件流。

这会奏效还是我真的疯了？

干杯。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T14:33:15.450

如果您告诉我们图书馆的实际用途，将会有所帮助！但我建议的一种方法是从 System.ComponentModel.Component 类继承库。这将使您的库可以访问属性 DesignMode，这使您可以区分它是在 Visual Studio 设计器中运行还是在运行时运行。然后，只有当组件在设计器中运行时，您才可以强制执行您的许可证，也许在构造器中。.

```
if(this.DesignMode){
///Do your check here
} 
```

关于许可本身，您可以从本文[链接文本中获得很多信息](http://msdn.microsoft.com/en-us/library/fe8b1eh9.aspx)

当然，如果不知道您的库是做什么的，很难知道这是否是正确的方法，但如果它类似于托管在设计器表面上的 DataSet，则这种方法可能需要进一步研究

# c# - 识别模板化列表框中的按钮

> ID：569423
> 
> 赞同：1
> 
> 时间：2009-02-20T12:37:10.237
> 
> 标签：c#, wpf, listbox

我有一个分配有自定义 DataTemplate 的 ListBox，以便它可以正确显示它的内容 - 每行一个自定义“附件”（由三个字符串属性组成）对象。此外，每一行都有一个按钮。该按钮应触发将所选附件添加到 MemoryList 的事件。这是数据模板：

```
 <DataTemplate x:Key="AccessoryListBoxTemplate">
        <StackPanel>
             <!--Truncated-->
                    <TextBlock FontFamily="Avenir Next LT Pro" VerticalAlignment="Center" FontSize="14" Text="{Binding Path=AgilityHeader}" Margin="3,0,0,0" Grid.Column="0" />
                    <TextBlock FontFamily="Avenir Next LT Pro" VerticalAlignment="Center" FontSize="14" Text="{Binding Path=ItemNumber}" Grid.Column="1" />
                    <TextBlock FontFamily="Avenir Next LT Pro" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding Path=Price}" FontSize="14" Grid.Column="2" />
                    <Button x:Name="ButtonAccessoryAddToMemoryList" VerticalAlignment="Center" Click="buttonAccessoryAddToMemoryList_Click" HorizontalAlignment="Right" FontSize="14" Width="80" Grid.Column="3" Margin="0,5,0,5">Minneslista</Button>
                </Grid>
            </StackPanel>
        </StackPanel>
    </DataTemplate> 
```

这是列表框：

```
<ListBox Grid.ColumnSpan="3" Grid.Row="1" BorderThickness="0" x:Name="ListBoxAccessories" ItemTemplate="{StaticResource AccessoryListBoxTemplate}" HorizontalContentAlignment="Stretch" ItemsSource="{Binding}" SelectedIndex="-1" IsEnabled="True" /> 
```

我遇到的问题是 - 我无法可靠地识别在哪一行 ButtonAccessoryAddToMemoryList 被点击，因为如果用户没有先选择行然后按下按钮所在的行未设置为 ListBox 的 SelectedItem按钮 - 老实说，这是谁做的？:)

我应该如何确定按下了哪个按钮？任何帮助将不胜感激。谢谢！

[编辑]**感谢查德威克的回答。完美运行。**[/编辑]

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T13:57:19.187

如果您真正想要知道单击了哪个 Accessory 对象，则可以设置按钮的 Tag 属性：

```
<Button x:Name="ButtonAccessoryAddToMemoryList" Tag="{Binding}" Click="buttonAccessoryAddToMemoryList_Click" ... >Minneslista</Button> 
```

然后在点击处理程序中抛出对象：

```
private void ButtonAccessoryAddToMemoryList(object sender, RoutedEventArgs e)
{
    Button b = e.Source as Button;
    Accessory a = b.Tag as Accessory; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T13:18:29.373

1.  尝试 MV-VM 模式和命令绑定。如果数据模板被绑定到它自己的对象并且命令被激活，那么你就已经知道被点击的记录了。

2.  在 XAML 中，您可以为按钮提供 _Loaded 事件处理程序。然后，在后面的代码中，设置 _Click 事件。也许制作一个委托数组，以便点击将调用不同的处理程序。

# sql - 奇怪的 SQL 问题

> ID：569438
> 
> 赞同：1
> 
> 时间：2009-02-20T12:41:18.790
> 
> 标签：sql

我已经使用了一段时间的 SQL 查询有一个非常奇怪的问题。我正在使用 SQL Server 2005。

这是从中进行查询的示例表：

```
日志：
日志_ID | FB_ID | 日期 | 日志名称 | 日志类型

   7 | 4 | 2007/11/8 | 尼娜 | 危急
   6 | 4 | 2007/11/6 | 约翰 | 危急
   5 | 4 | 2007/11/6 | 迈克 | 危急
   4 | 4 | 2007/11/6 | 迈克 | 危急
   3 | 3 | 2007/11/3 | 本 | 危急
   2 | 3 | 2007/11/1 | 本 | 危急

```

现在，想法是返回处理每个 FB_ID 的 Log_Person 的第一个日期，但是，如果有多个 Log_Name，我只想要 SECOND Log_Name（第一次将责任移交给另一个）。结果应如下所示：

```
期望的结果
日志_ID | FB_ID | 日期 | 日志名称 | 日志类型

   6 | 4 | 2007/11/6 | 约翰 | 危急
   2 | 3 | 2007/11/1 | 本 | 危急

```

在较早的帖子中，Peter Lang 和 Quassnoi 给出了精彩的答案，如下所示。可悲的是，我几乎无法理解那里发生了什么，但它们就像一种魅力。这是代码：

```
夸斯诺伊

选择 lo4.*
从
    （当 ln.log_id 为 NULL 时选择 CASE THEN lo2.log_id ELSE ln.log_id END
    AS log_id, ROW_NUMBER() OVER (PARTITION BY lo2.fb_id ORDER BY lo2.cdate) AS rn
    从
        （选择罗。*，
            （选择前 1 个 log_id
            FROM t_log li WHERE li.fb_id = lo.fb_id AND li.cdate >= lo.cdate
            AND li.log_id lo.log_id AND li.log_name lo.log_name
            ORDER BY cdate, log_id)
        作为 next_id
        FROM t_log 罗）
    lo2 左外连接 t_log ln ON ln.log_id = lo2.next_id)
lo3，t_log lo4
其中 lo3.rn = 1 和 lo4.log_id = lo3.log_id

彼得·朗

选择 *
来自日志
在哪里 log_id 在
    （从日志中选择最小值（log_id）
    在哪里
        (SELECT COUNT(DISTINCT log_name)
        来自日志 log2
        其中 log2.fb_id = log.fb_id ) = 1 或 log.log_name  
        （从日志 log_3 中选择 log_name
        其中 log_3.log_id =
            （选择最小值（log_id）
            来自日志 log4
            其中 log4.fb_id = log.fb_id ))
    按 fb_id 分组）

```

现在，如果您已经阅读了这么多，那么问题来了。为什么它们都可以正常工作，但是一旦我在它们上应用其他过滤器，一切都会混合起来？

我什至尝试使用 WITH 子句创建一个临时表，并在其上使用 Date 和 Log_Type 过滤器，但它仍然不起作用。一些本应包含在过滤器中的结果突然被排除在外。最初我会得到第一个日期的唯一名称，或者如果 Log_Name 列中有多个名称，则获得第二个名称，现在我会随机得到任何东西，如果有的话。以类似的方式，使用*WHERE (DATE BETWEEN '2007/11/1' AND '2007/11/30')*会导致永久循环，其中使用*WHERE (MONTH(Date) = '11') AND (YEAR(Date) = '2007')*可以正常工作。但是，如果我在后一个选项中再添加一个过滤器，例如*.. AND WHERE Log_Type = 'Critical'*，它将再次出现在 permaloop 上。两个永久循环都发生在 Lang'

我需要使用 UNION ALL 将这种类型的搜索与另一种类型的搜索结合起来，所以我想知道我将来是否会遇到更多类似的奇怪问题？很明显，我对这里的 SQL 有一些不明白的地方，而我的查询 DL 是今天，所以我在这里有点压力。感谢所有的帮助。:)

**编辑：**澄清。需要上述查询的结果，并且这些结果只需要在给定时间（月）内过滤为“关键”案例。

然后，这将与另一个搜索相结合，该搜索返回第一次记录具有“支持”状态 (Log_Type) 的 FB_ID。这个想法是为了描述每个月在数据库中记录了多少新病例。

**编辑 2：**更新，Russ Cam 下面的建议是有效的，但它排除了任何最初在给定范围之外注明日期的 FB_ID，即使 Log_Name 更改的查询结果行将存在于范围内。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T12:56:19.363

就像测试人员一样，当您将他们的任一语句包装在 SELECT 语句中时会发生什么，有效地将他们的语句转换为子查询，然后在其上放置 WHERE 子句？

例如，

```
SELECT log.*
FROM
(
    SELECT lo4.*
    FROM
        (SELECT CASE WHEN ln.log_id IS NULL THEN lo2.log_id ELSE ln.log_id END
        AS log_id, ROW_NUMBER() OVER (PARTITION BY lo2.fb_id ORDER BY lo2.cdate) AS rn 
        FROM 
        (SELECT lo.*,
            (SELECT TOP 1 log_id
            FROM t_log li WHERE li.fb_id = lo.fb_id AND li.cdate >= lo.cdate
            AND li.log_id  lo.log_id AND li.log_name  lo.log_name
            ORDER BY cdate, log_id)
        AS next_id
        FROM t_log lo)
    lo2 LEFT OUTER JOIN t_log ln ON ln.log_id = lo2.next_id)
    lo3, t_log lo4
    WHERE lo3.rn = 1 AND lo4.log_id = lo3.log_id
) AS log
WHERE log.Date BETWEEN @start and @end 
```

我会预料到这个工作

**编辑：**

试试这个版本。将变量设置为所需的值。本质上，我们只想在每个子查询中检索满足我们条件的少量结果，这样我们就不会尝试在未索引的列上运行大型结果集的条件。

```
DECLARE @log_type CHAR(20) --Set this to the correct datatype
SET @log_type = 'Critical'

DECLARE @start_date DATETIME
SET @start_date = '20 FEB 2009' -- use whichever datetime format is appropriate

DECLARE @end_date DATETIME
SET @end_date = '21 FEB 2009' -- use whichever datetime format is appropriate

    SELECT lo4.*
    FROM
        (
        SELECT 
            CASE WHEN ln.log_id IS NULL THEN lo2.log_id ELSE ln.log_id END AS log_id, 
            ROW_NUMBER() OVER (PARTITION BY lo2.fb_id ORDER BY lo2.cdate) AS rn 
        FROM 
            (
             SELECT lo.*,
            (SELECT TOP 1 log_id
             FROM t_log li 
             WHERE 
             li.fb_id = lo.fb_id 
             AND li.cdate >= lo.cdate
             AND li.log_id <> lo.log_id 
             AND li.log_name <> lo.log_name
             AND log_type = @log_type
             AND li.cdate BETWEEN @start_date and @end_date
             ORDER BY cdate, log_id
             ) AS next_id
             FROM t_log lo
            ) lo2 
        LEFT OUTER JOIN 
        t_log ln 
        ON ln.log_id = lo2.next_id
        /* AND ln.cdate BETWEEN @start_date and @end_date
           I think that this would be needed for cases where
           the next_id is null
        */
    ) lo3, 
    t_log lo4
    WHERE 
    lo3.rn = 1 
    AND lo4.log_id = lo3.log_id 
```

**编辑2：**

在进一步考虑这一点之后，重要的是要获得更多问题的答案。这些问题已经在[Quassnoi 的回答](https://stackoverflow.com/questions/569438/weird-sql-issue/569486#569486)中提出，并且将极大地改变返回的结果集。简而言之，

**1\. 对于指定的日期范围，**

*   原始日志记录的日志日期和下一个日志记录的日志日期是否都需要落入该日期范围内？

*   您是否只想包含每个 fb_id 的下一个日志记录的日期在日期范围内的结果（即原始日志记录的日期无关紧要）？

*   您是否只想包含每个 fb_id 的原始日志记录日期在日期范围内的结果（即下一个日志记录的日期，该日期将在发生切换的结果集中返回, 可以在日期范围之后）。？

**2.对于指定的日志类型，**

*   原始日志记录和下一条日志记录的日志类型是否需要与指定的日志类型相同？

*   您是否希望包含下一个日志记录与指定日志类型匹配的结果，而不管每个 fb_id 的原始日志记录的日志类型如何？

*   您是否只想包含原始日志记录与指定日志类型匹配的结果，而与下一个日志记录的日志类型无关？

这些问题的答案对于如何构建查询以及推断结果数据实际告诉您的内容至关重要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T12:58:30.870

嗯，先谢谢夸奖：）

我的查询实际上是查看所有记录，为每条记录选择下一个负责人，并为某个`fb_id`.

如果没有为此的过渡`fb_id`，它将被选为过渡到`NULL`。

然后查询选择每个第一个转换（即使用`ROW_NUMBER`of `1`），无论是真正的转换还是假的，并检查它是真的还是假的。

如果它是真实的（对于非`NULL`那个是），它返回承担责任的人的**id**；如果没有，它会返回**给予**责任的人`NULL`（即根本没有给予责任）。

如您所见，此查询在很大程度上依赖于索引`(fb_id, cdate, id)`来搜索下一个负责人。如果你添加新的条件，它就不能再使用这个索引并且变得很慢。

请说明您要添加的条件，我们会再次尝试为您提供帮助:)

您说要添加`log_type`到查询中。

怎么`first transition`算的？当两个字段和时，您是否需要返回第一个转换`critical`，或者仅从`non-critical`to转换`critical`，或者当其中任何一个是时`critical`？

如果您只需要添加`date range`，例如，是否应该计算完成工作但`February`付出的人？或者谁得到了工作并给予它？`February``March``January``February`

同时，试试这个：

```
SELECT lo4.*
FROM
    (
    SELECT CASE WHEN ln.log_id IS NULL THEN lo2.log_id ELSE ln.log_id END AS log_id,
           ROW_NUMBER() OVER (PARTITION BY lo2.fb_id ORDER BY lo2.cdate) AS rn 
    FROM 
        (
        SELECT
               lo.*,
               (
               SELECT TOP 1 log_id
               FROM t_log li
               WHERE li.fb_id = lo.fb_id 
                     AND li.cdate >= CASE WHEN lo.cdate < @range THEN @range ELSE lo.cdate END
                     AND li.cdate < DATEADD(month, 1, @range)
                     AND li.log_id <> lo.log_id
                     AND li.log_name <> lo.log_name
               ORDER BY
                 cdate, log_id
               ) AS next_id
        FROM t_log lo
        WHERE lo.cdate >= @range
          AND lo.cdate < DATEADD(month, 1, @range)
        ) lo2
    LEFT OUTER JOIN t_log ln ON ln.log_id = lo2.next_id
    ) lo3,
t_log lo4
WHERE lo3.rn = 1
  AND lo4.log_id = lo3.log_id 
```

如您所见，那里有两个日期范围检查。

子查询中的一个`inner`过滤掉`recipient`超出日期范围的转换。

查询中的一个`outer`过滤掉`sender`超出范围的转换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T13:15:54.853

一些非常一般的建议：尝试为查询的所有变体制定执行计划，并检查数据库使用哪些对象来获取数据。

查询优化器可能会为每个查询变体使用完全不同的资源集，并且某些对象是无效的（例如，基于原始表的临时表/物化视图不是最新的等）。此类资源可能会导致您看到的结果无效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T19:26:36.420

你觉得下面会做吗？

```
 set nocount on

declare @log table
(
log_id int
,fb_id int
,log_date datetime
,log_name nvarchar(25)
,log_type nvarchar(20)
)

insert into @log(log_id, fb_id, log_date, log_name, log_type) values (7, 4, convert(datetime,'8/11/2007', 103), N'Nina', N'Critical')
insert into @log(log_id, fb_id, log_date, log_name, log_type) values (6, 4, convert(datetime,'6/11/2007', 103), N'John', N'Critical')
insert into @log(log_id, fb_id, log_date, log_name, log_type) values (5, 4, convert(datetime,'6/11/2007', 103), N'Mike', N'Critical')
insert into @log(log_id, fb_id, log_date, log_name, log_type) values (4, 4, convert(datetime,'6/11/2007',103), N'Mike', N'Critical')
insert into @log(log_id, fb_id, log_date, log_name, log_type) values (3, 3, convert(datetime,'3/11/2007',103), N'Ben', N'Critical')
insert into @log(log_id, fb_id, log_date, log_name, log_type) values (2, 3, convert(datetime,'1/11/2007',103), N'Ben', N'Critical') 
insert into @log(log_id, fb_id, log_date, log_name, log_type) values (1, 2, convert(datetime,'10/9/2007',103), N'Pat', N'Critical') 
insert into @log(log_id, fb_id, log_date, log_name, log_type) values (0, 2, convert(datetime,'1/9/2007',103), N'Couger', N'Critical') 

declare @result table
(
intid int identity(1,1)
,log_id int
,fb_id int
,log_date datetime
,log_name nvarchar(25)
,log_type nvarchar(20)
,_min_intid int
,_position int
)

insert into @result (log_id, fb_id, log_date, log_name, log_type)
select log_id, fb_id, log_date, log_name, log_type from @log order by fb_id, log_date

update r
set r._min_intId = w.freq
from @result r join 
(select distinct fb_id, min(intid) freq from @result group by fb_id) w
on r.fb_id = w.fb_id

update @result set _position = intid - _min_intid + 1

select log_id, fb_id, log_date, log_name, log_type from @result where _position = 2 

```

# ant - 如何使 Ant 副本中的 Ant 文件列表一起工作

> ID：569439
> 
> 赞同：2
> 
> 时间：2009-02-20T12:41:19.167
> 
> 标签：ant

我想使用以下文件列表（Ant）的结果：

```
<filelist id="docfiles" dir="doc">
    <file name="foo.xml"/>
    <file name="bar.xml"/>
</filelist> 
```

进入以下副本：

```
<copy todir="folder">
??? 
</copy> 
```

我已经尝试将它们组合在一起，例如：

```
<copy todir="folder">
 <filelist id="docfiles" dir="doc">
  <file name="foo.xml"/>
  <file name="bar.xml"/>
 </filelist>
</copy> 
```

但 Ant 回答说此类任务不支持 FileLists。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T13:01:08.337

如最新的[Ant 复制任务](http://ant.apache.org/manual/Tasks/copy.html)文档中所述：

> 指定为嵌套元素
> `fileset` ***或任何其他资源集合的参数***
> 
> [资源集合](http://ant.apache.org/manual/Types/resources.html#collection)用于选择要复制的文件组。要使用资源集合，必须设置 todir 属性。
> 
> **在 Ant 1.7 之前，仅`<fileset>`支持作为嵌套元素。**

由于资源集合包括：

*   文件集、目录集、文件列表和路径（和衍生类型）公开文件资源
*   tarfileset 可以根据配置公开文件或 tarentry 资源
*   zipfileset 可以根据配置公开文件或 zipentry 资源
*   propertyset 暴露属性资源

`filelist`元素内的A`copy`应该在 Ant 1.7 中工作。

Ant 1.6.x 将不支持它。

# testing - 上传文件时，Watin 测试挂起应用程序

> ID：569447
> 
> 赞同：1
> 
> 时间：2009-02-20T12:42:54.293
> 
> 标签：testing, nunit, teamcity, watin

我有一个关于 watin 测试的问题，应该浏览 pdf 并将其上传到网页。这个测试在我的机器上运行顺利，总是找到 pdf，点击提交并等待 30 秒上传完成。

但是当我尝试在构建机器（teamcity）上运行这个测试时，测试会在它应该等待上传的时候挂起。问题是测试不会超时，即使我在整个测试的 1 分钟内将超时设置为 nunit，或者尝试重新加载页面。测试只是在上传步骤冻结了整个站点。

测试这个功能真的很重要，但是由于那些上传的测试会挂起整个构建，我们必须手动完成，这并不是测试自动化的想法。

有谁知道如何解决这个上传问题？或者至少设法使这个测试超时。

```
stack trace = at System.RuntimeType.InvokeDispMethod(String name, BindingFlags invokeAttr, Object target, Object[] args, Boolean[] byrefModifiers, Int32 culture, String[] namedParameters)
  at System.RuntimeType.InvokeMember(String name, BindingFlags bindingFlags, Binder binder, Object target, Object[] providedArgs, ParameterModifier[] modifiers, CultureInfo culture, String[] namedParams)
  at System.RuntimeType.ForwardCallToInvokeMember(String memberName, BindingFlags flags, Object target, Int32[] aWrapperTypes, MessageData& msgData)
  at mshtml.DispHTMLBaseElement.click()
  at WatiN.Core.InternetExplorer.IEElement.ClickOnElement()
  at WatiN.Core.Element.Click()
  at WatiN.Core.FileUpload.Set(String fileName) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T12:46:29.870

我认为这里的问题是您的单元测试依赖于太多的外部资源，例如您的开发机器的文件系统，网络等。

问问自己测试的重要性是什么：是否有任何涉及的业务逻辑可以放入单独的类中？然后你可以为这个类编写测试。您基本上需要的是在不实际上传文件或访问网络的情况下测试上传过程的所有逻辑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T14:43:53.430

问题是 WatiN 使用 sendkeys 设置要上传的文件（名称）。在 WatiN 2.0 beta 1 中，这被更改为使用一些 API 调用。这解决了在需要文本输入的对话框自动化时挂起测试的问题。

# python - Django：使用表单的一个模板中的多个模型

> ID：569468
> 
> 赞同：122
> 
> 时间：2009-02-20T12:50:26.413
> 
> 标签：python, django, django-forms

我正在构建一个支持票证跟踪应用程序，并且我想从一个页面创建一些模型。票证通过外键属于客户。注释也通过 ForeignKey 属于门票。我想选择一个客户（这是一个完全独立的项目）或创建一个新客户，然后创建一个票证，最后创建一个分配给新票证的注释。

由于我对 Django 还很陌生，所以我倾向于迭代工作，每次都尝试新功能。我玩过 ModelForms，但我想隐藏一些字段并进行一些复杂的验证。似乎我正在寻找的控制级别要么需要表单集，要么手动完成所有事情，并配有繁琐的手动编码模板页面，我试图避免这种情况。

我缺少一些可爱的功能吗？有人对使用表单集有很好的参考或示例吗？我花了整个周末为他们编写 API 文档，但我仍然一无所知。如果我分解并手动编码所有内容，这是一个设计问题吗？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-02-22T16:09:05.280

[用ModelForms](http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#topics-forms-modelforms)实现这真的不是太难。假设您有表格 A、B 和 C。您打印出每个表格和页面，现在您需要处理 POST。

```
if request.POST():
    a_valid = formA.is_valid()
    b_valid = formB.is_valid()
    c_valid = formC.is_valid()
    # we do this since 'and' short circuits and we want to check to whole page for form errors
    if a_valid and b_valid and c_valid:
        a = formA.save()
        b = formB.save(commit=False)
        c = formC.save(commit=False)
        b.foreignkeytoA = a
        b.save()
        c.foreignkeytoB = b
        c.save() 
```

[这](http://docs.djangoproject.com/en/dev/ref/forms/validation/#ref-forms-validation)是自定义验证的文档。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2009-06-12T09:50:28.660

一天前我也遇到了同样的情况，这是我的 2 美分：

1）我在这里找到了可以说是单一形式的多个模型输入的最短和最简洁的演示：http: [//collingrady.wordpress.com/2008/02/18/editing-multiple-objects-in-django-with-newforms/](http://collingrady.wordpress.com/2008/02/18/editing-multiple-objects-in-django-with-newforms/) .

简而言之：为每个模型制作一个表单，将它们都提交到一个模板中`<form>`，使用`prefix`keyarg 并让视图句柄验证。如果存在依赖，只需确保在依赖之前保存“父”模型，并在提交“子”模型的保存之前使用父 ID 作为外键。该链接有演示。

2）也许表单集可以被打败，但据我研究，表单集主要用于输入同一模型的倍数，*可以*选择通过外键将其绑定到另一个模型/模型。但是，似乎没有用于输入多个模型数据的默认选项，而这似乎不是 formset 的用途。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-03T13:05:53.570

我最近遇到了一些问题，只是想出了如何做到这一点。假设你有三个类，Primary、B、C，并且 B、C 有一个主外键

```
 class PrimaryForm(ModelForm):
        class Meta:
            model = Primary

    class BForm(ModelForm):
        class Meta:
            model = B
            exclude = ('primary',)

    class CForm(ModelForm):
         class Meta:
            model = C
            exclude = ('primary',)

    def generateView(request):
        if request.method == 'POST': # If the form has been submitted...
            primary_form = PrimaryForm(request.POST, prefix = "primary")
            b_form = BForm(request.POST, prefix = "b")
            c_form = CForm(request.POST, prefix = "c")
            if primary_form.is_valid() and b_form.is_valid() and c_form.is_valid(): # All validation rules pass
                    print "all validation passed"
                    primary = primary_form.save()
                    b_form.cleaned_data["primary"] = primary
                    b = b_form.save()
                    c_form.cleaned_data["primary"] = primary
                    c = c_form.save()
                    return HttpResponseRedirect("/viewer/%s/" % (primary.name))
            else:
                    print "failed"

        else:
            primary_form = PrimaryForm(prefix = "primary")
            b_form = BForm(prefix = "b")
            c_form = Form(prefix = "c")
     return render_to_response('multi_model.html', {
     'primary_form': primary_form,
     'b_form': b_form,
     'c_form': c_form,
      }) 
```

此方法应允许您执行所需的任何验证，以及在同一页面上生成所有三个对象。我还使用了 javascript 和隐藏字段来允许在同一页面上生成多个 B、C 对象。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-10-19T12:05:43.293

[MultiModelForm](https://django-betterforms.readthedocs.org/en/latest/multiform.html#working-with-modelforms) from[`django-betterforms`](https://github.com/fusionbox/django-betterforms)是一个方便的包装器，可以执行 Gnudiff 的回答中描述的[操作](https://stackoverflow.com/a/985901/1888983)。它将常规`ModelForm`s 包装在一个单独的类中，该类透明地（至少对于基本用途）用作单一形式。我从他们下面的文档中复制了一个示例。

```
# forms.py
from django import forms
from django.contrib.auth import get_user_model
from betterforms.multiform import MultiModelForm
from .models import UserProfile

User = get_user_model()

class UserEditForm(forms.ModelForm):
    class Meta:
        fields = ('email',)

class UserProfileForm(forms.ModelForm):
    class Meta:
        fields = ('favorite_color',)

class UserEditMultiForm(MultiModelForm):
    form_classes = {
        'user': UserEditForm,
        'profile': UserProfileForm,
    }

# views.py
from django.views.generic import UpdateView
from django.core.urlresolvers import reverse_lazy
from django.shortcuts import redirect
from django.contrib.auth import get_user_model
from .forms import UserEditMultiForm

User = get_user_model()

class UserSignupView(UpdateView):
    model = User
    form_class = UserEditMultiForm
    success_url = reverse_lazy('home')

    def get_form_kwargs(self):
        kwargs = super(UserSignupView, self).get_form_kwargs()
        kwargs.update(instance={
            'user': self.object,
            'profile': self.object.profile,
        })
        return kwargs 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-04-18T20:53:18.140

我目前有一个解决方法（它通过了我的单元测试）。当您只想从其他模型中添加有限数量的字段时，这是一个很好的解决方案。

我在这里错过了什么吗？

```
class UserProfileForm(ModelForm):
    def __init__(self, instance=None, *args, **kwargs):
        # Add these fields from the user object
        _fields = ('first_name', 'last_name', 'email',)
        # Retrieve initial (current) data from the user object
        _initial = model_to_dict(instance.user, _fields) if instance is not None else {}
        # Pass the initial data to the base
        super(UserProfileForm, self).__init__(initial=_initial, instance=instance, *args, **kwargs)
        # Retrieve the fields from the user model and update the fields with it
        self.fields.update(fields_for_model(User, _fields))

    class Meta:
        model = UserProfile
        exclude = ('user',)

    def save(self, *args, **kwargs):
        u = self.instance.user
        u.first_name = self.cleaned_data['first_name']
        u.last_name = self.cleaned_data['last_name']
        u.email = self.cleaned_data['email']
        u.save()
        profile = super(UserProfileForm, self).save(*args,**kwargs)
        return profile 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-20T14:38:37.510

“我想隐藏一些字段并进行一些复杂的验证。”

我从内置的管理界面开始。

1.  构建 ModelForm 以显示所需的字段。

2.  使用表单中的验证规则扩展表单。通常这是一种`clean`方法。

    确保这部分工作得相当好。

完成此操作后，您可以离开内置的管理界面。

然后，您可以在单个网页上处理多个部分相关的表单。这是一堆模板内容，用于在单个页面上呈现所有表单。

然后，您必须编写视图函数来读取和验证各种表单内容并执行各种对象 saves()。

“如果我分解并手动编码所有内容，这是一个设计问题吗？” 不，这只是很多时间并没有太多好处。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-05-26T00:16:10.387

根据 Django 文档，内联表单集用于此目的：“内联表单集是模型表单集之上的一个小型抽象层。这些简化了通过外键处理相关对象的情况”。

请参阅[https://docs.djangoproject.com/en/dev/topics/forms/modelforms/#inline-formsets](https://docs.djangoproject.com/en/dev/topics/forms/modelforms/#inline-formsets)

# svn - SVN 和重音字符

> ID：569471
> 
> 赞同：3
> 
> 时间：2009-02-20T12:51:29.110
> 
> 标签：svn, character-encoding

我有一个我管理的颠覆存储库。当我尝试添加名称中包含重音（非 ASCII）字符的文件时，服务器拒绝该命令。服务器在 Ubuntu 上运行，客户端是 Windows 上的 Eclipse。

[我在SVN 常见问题解答](http://subversion.tigris.org/faq.html)中找不到任何关于文件名中重音字符的内容，也没有在[SVN Book](http://svnbook.red-bean.com/)中找到任何内容。我知道在源代码文件的名称中包含重音字符可能不是一个好主意，但是......这是要求......

知道在哪里可以找到文档吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T14:50:50.150

确保在您的服务器上安装了 apr-iconv。如果没有 apr-iconv，Subversion 不能转换 utf8 字符串，如果转换失败会抛出错误。

您还可以从服务器错误日志中获得更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T13:14:49.787

[这](http://www.juretta.com/log/2007/05/09/svn_can_t_convert_string_from_utf-8_to_native_encoding_/)听起来很相关，但是当您没有给出从服务器获得的确切错误时，这很难。

尽管如此，听起来还是不错的建议：检查本地系统的文件名编码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-07T10:48:11.317

检查**svn:eol 样式**

# sql - 使用变量标签的 SQL GOTO 语句

> ID：569473
> 
> 赞同：1
> 
> 时间：2009-02-20T12:53:49.837
> 
> 标签：sql, sql-server, goto

我希望能够做这样的事情：

```
declare @label varchar
set @label = 'label_1'
goto @label

label_1:

label_2: 
```

当然，sql server 给了我一个不正确的语法错误......所以我想知道我是否仍然可以用稍微不同的语法来做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-03-10T03:31:42.613

我已经编写了一个可能对其他人有用的功能性技巧。在 SQL Server 2008 上，您不能动态构建 goto，也不能在变量中提供标签。老派的技巧是加载变量，跳转到一个点，然后使用 if 语句来确定真正的目的地。

GOTO 当然[**被认为是有害**](http://en.wikipedia.org/wiki/Considered_harmful)的，通常是一个坏主意。

```
l1:
    print '1'
l2:
    print '2'
    goto l4
l3:
    print '3'   -- should not print
l4:
    print '4'
    declare @lbl nvarchar(5)
    set @lbl = N'l6'
    goto vjump
    --  goto @lbl   -- doesn't work
    --  exec('goto ' + @lbl) -- doesn't work
l5:
    print '5'
l6:
    print '6'
l7:
    print '7'
    return
vjump:
    if @lbl = 'l1'
        goto l1
    if @lbl = 'l2'
        goto l2
    if @lbl = 'l3'
        goto l3
    if @lbl = 'l6'
        goto l6 
```

这产生

```
1
2
4
6
7 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T13:15:24.170

只有在动态构建 SQL 语句时才能执行此操作。

不过最好避免 GOTO - 主要是为了代码的可读性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-10-22T02:23:36.940

显然不是一个及时的答案，但是当我最近发现自己想要这样做时，原因是因为我想多次执行相同的代码然后返回正常流程，基本上是“gosub”而不是“goto”。 ...

你可以做到这一点**。**不是使用 gosub，而是使用临时存储过程——创建一个临时存储过程`create procedure #DRY`，然后调用它。完成后可以放下它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T12:57:30.187

为什么不简单地使用 if/else？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-18T14:45:47.670

据我所知，您无法参数化 GOTO。如果您使用动态 SQL，则可以这样做。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-20T13:15:22.407

尝试这个：

```
exec("goto "+@label) 
```

# php - PHP 脚本可以反序列化使用 Perl 创建的可存储文件吗？

> ID：569476
> 
> 赞同：3
> 
> 时间：2009-02-20T12:54:51.490
> 
> 标签：php, perl, serialization, storable

PHP 脚本可以反序列化使用 Perl 创建的可存储文件吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-20T12:58:30.560

[不，但是您可以使用PHP::Serialization](http://search.cpan.org/perldoc?PHP::Serialization)从 Perl 转储 PHP 可读数据。您可能还想选择更标准的东西，例如 YAML 或 JSON。几乎任何语言都可以理解这些。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T13:08:56.290

您可以使用 JSON 作为两种语言之间的通用语言，我建议在 Perl 端使用[JSON::XS](http://search.cpan.org/~mlehmann/JSON-XS-2.2311/XS.pm)（在 C/C++ 中实现子例程）进行表演，然后您可以使用[此扩展名](http://it2.php.net/json)回读（在 PHP 中）JSON .

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T14:39:59.893

PHP 是图灵完备的，答案并不是真正的“不”，而是“不是本机或任何知名的公共模块”。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-20T18:42:23.557

正如混乱所指出的那样，您特别要求[*Storable*](http://search.cpan.org/perldoc?Storable)，因此切换到 YAML（或 JSON）*可能*是可能的，但可能不会。这可能有助于将其放入[YAML](http://search.cpan.org/perldoc?YAML::Syck)（甚至[JSON](http://search.cpan.org/perldoc?JSON::Syck)）：

```
$output_format = 'YAML';
popen( "perl -MStorable -M${output_format}::Syck=Dump -e 'print Dump( retrieve( q{$storable_file_path} ))'", "r" ); 
```

# python - 在 Python 中获取页面上的表单

> ID：569477
> 
> 赞同：0
> 
> 时间：2009-02-20T12:54:57.883
> 
> 标签：python

我正在开发一个网络漏洞扫描器。我已经完成了 30% 的程序，因为它只能扫描 HTTP GET 方法。但是我现在遇到了一个问题：我不知道如何让程序对 POST 方法进行渗透测试。

我的想法是让它从网站上的所有页面中提取表单数据/名称，但我不知道该怎么做。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T12:58:39.623

使用[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)进行屏幕抓取。

对于较重的脚本，请使用[twill](http://twill.idyll.org/)：

> twill 是一种简单的语言，它允许用户从命令行界面浏览 Web。使用斜纹，您可以浏览使用表​​单、cookie 和大多数标准 Web 功能的网站。

使用斜纹布，您可以轻松填写​​表格并将`POST`其返回到服务器。Twill 有一个[Python API](http://twill.idyll.org/python-api.html)。一个从填充的例子：

```
from twill.commands import go, showforms, formclear, fv, submit

go('http://issola.caltech.edu/~t/qwsgi/qwsgi-demo.cgi/')
go('./widgets')
showforms()

formclear('1')
fv("1", "name", "test")
fv("1", "password", "testpass")
fv("1", "confirm", "yes")
showforms()

submit('0') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T12:57:53.383

您是在问如何使用[urllib2](http://www.python.org/doc/2.5.2/lib/module-urllib2.html)执行 POST 方法吗？

您可能想查看[示例](http://www.python.org/doc/2.5.2/lib/urllib2-examples.html)。

在尝试了其中一些之后，您可能想要发布带有更具体问题的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T14:28:49.470

如果您知道如何从表单中收集数据/名称，您只需要一种处理 http POST 方法的方法。我想您将需要一个发送多部分表单数据的解决方案。

您应该查看 MultipartPostHandler：

[http://odin.himinbi.org/MultipartPostHandler.py](http://odin.himinbi.org/MultipartPostHandler.py)

如果您需要支持 unicode 文件名，请参阅修复： http: [//peerit.blogspot.com/2007/07/multipartposthandler-doesnt-work-for.html](http://peerit.blogspot.com/2007/07/multipartposthandler-doesnt-work-for.html)

# c++ - 用于 C++ 的独立于平台的并发编程库

> ID：569481
> 
> 赞同：3
> 
> 时间：2009-02-20T12:56:53.903
> 
> 标签：c++, cross-platform, parallel-processing

我熟悉 Java 中的并发编程，它为此提供了很多工具。然而，C++ 并发编程并不是那么容易上手的。

在 C++ 上开始并发编程的最佳方式是什么？是否有任何不错的库可以包装并发编程原语并为您提供更高级的构造？

我尝试[了 QtConcurrent](http://labs.trolltech.com/page/Projects/Threads/QtConcurrent)，它为您提供了不错的 MapReduce 功能，但它严重偏向于使用 Qt 进行并发计算，因此如果您不想使用 Qt，这不是一个好的选择。

还有其他类似的库吗？人们在这里使用什么？

提前感谢您的帮助，斯内格

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-20T13:22:40.393

有几种选择：

[ACE](http://www.cs.wustl.edu/~schmidt/ACE.html)，它提供了一些[并发结构](http://www.cs.wustl.edu/~schmidt/ACE-papers.html#concurrency)

英特尔[线程构建模块](http://www.threadingbuildingblocks.org/)

[提升::线程](http://www.boost.org/doc/libs/1_38_0/doc/html/thread.html)

[开放式MP](http://openmp.org/wp/)

[Qt 线程库](https://doc.qt.io/qt-5/threads.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T13:08:25.123

Morendil 的建议（CSP - 通信顺序进程）非常值得一看——它是一种非常不同的线程视图，并且一旦你将头绕在它周围，它就会很好地工作。我第一次遇到它是在 Transputers 相当深奥的 Occam 语言中遇到的，但这个想法一直困扰着我。

一个更传统的想法：[boost::threads](http://www.boost.org/doc/libs/1_38_0/doc/html/thread.html)非常适合构建基于线程的并发程序。虽然水平很低。

[OpenMP](http://openmp.org/wp/)比线程级别更高，并且得到很好的支持。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T13:03:27.693

您可以查看具有[C++](http://www.cs.kent.ac.uk/projects/ofa/c++csp/)实现的[CSP 。](http://en.wikipedia.org/wiki/Communicating_sequential_processes)但是，与 Java 的线程原语不同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T13:10:55.303

[这个问题](https://stackoverflow.com/questions/565137/multithreaded-job-queue-manager)连同答案可能会对您有所帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T16:32:52.073

英特尔的线程构建块非常适合在单个数据并行循环级别引入并发性，它负责管理线程和自动分配工作。它可以以与 OpenMP 类似的方式使用，但不需要显式编译器支持。

# cursor - 更改网页上鼠标光标的热点

> ID：569488
> 
> 赞同：1
> 
> 时间：2009-02-20T12:59:55.890
> 
> 标签：cursor

我想更改鼠标指针的热点，我们已经使用 .cur 文件更改了图标，使其位于图像的右下角，而不是左上角。

就像一个倒箭头光标，设计师/老板想出了一个很好的设计，几乎需要这个。

是否可以更改网页上鼠标光标的热点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T13:28:39.473

我没有测试过，从[developer.mozilla.org](https://developer.mozilla.org/en/Using_URL_values_for_the_cursor_property)得到它：

Gecko 1.8beta3 中添加了对光标值的 CSS3 语法的支持；因此它适用于 Firefox 1.5。它允许指定光标热点的坐标，该坐标将被限制在光标图像的边界上。如果未指定，则从文件本身（对于 CUR 和 XBM 文件）读取热点的坐标或将其设置为图像的左上角。CSS3 语法的一个例子是：

```
cursor: url(foo.png) 4 12, auto; 
```

链接到[CCS3 光标](http://www.w3.org/TR/css3-ui/#cursor)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T13:09:20.127

这是不可能的，我很高兴 - 我认为你只会让你的用户感到沮丧。

**编辑：**我错了-我认为这是不可能的-我仍然认为您不应该这样做。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-02-20T13:29:04.200

你不能。就像这里的大多数人一样，我会告诉你不要这样做，即使你可以......

但是，对于非常具体的情况，例如某些艺术家的页面、游戏光标或光标指向下方的类似 3D 的地图，我可以想象这样的事情。现在，如果你真的需要一个面向媒体的网站的特殊光标，而不是信息网站，我会用一个空白光标文件隐藏光标，并使用一些 Javascript 在光标上附加一个浮动图像，这样它“看起来像“热点在其他地方。

当然，您的网站的可用性和兼容性会下降，但上面的解决方案是如果您真的需要自由发挥创意，并且您的用户对这类东西持开放态度。

# css - 在父 div 中浮动 2 个 div 并将这些 div 排列在另一个下方

> ID：569490
> 
> 赞同：0
> 
> 时间：2009-02-20T13:01:17.683
> 
> 标签：css, html, alignment, css-float

我正在创建一个包含 3 列的网页。中间一栏是所有内容的所在。我要输入的内容必须是左对齐图像的格式，然后是图像旁边的一些文本。这在整个专栏中流动，带有不同的图像和相应的文本。由于我的布局是基于 div 的布局，因此我为该列放置了一个主 div (page_content)。然后标题（h4）和标题下面我输入了另一个div。这个 div 又包含单独的 div，这些 div 嵌套在图像的 div（照片类）和文本的 div（lat_art 类）中。下面给出了 HTML 代码和 CSS 代码。我的问题是第一个图像和文本出现了，但随后在第一个文本下方垂直排列，即仅占据 div 的 50% 并向右浮动，将其对应的文本推到其下方相同的 50% 空间中。我是否应该为单个 div 指定高度，可能图像比文本大。但如果我这样做，我的代码不会变成静态的。我希望它是动态的。请帮忙。

## HTML 代码

```
<div id="page_content"> 
<h4 class="center_cap">LATEST ARTISTS</h4> 
<!--Div for the content begins here--> 
<div> 
<!--Individual div begins here--> 
<div > 
<div class="photo"> 
<img src="Images/guitar.jpg" alt="guitar"/> 
</div> 
<div class="lat_art"> 
<span class="artist">ROCK ON</span> 
<p> 
Good news to all the fans of 'Rock On'. Concerts all around the world. 
</p> 
</div> 
</div> 
<!--Individual div ends here--> 

<!--Individual div begins here--> 
<div > 

<div class="photo"> 
<img src="Images/guitar.jpg" alt="guitar"/> 
</div> 

<div class="lat_art"> 
<span class="artist">ROCK ON</span> 
<p> 
Good news to all the fans of 'Rock On'. Concerts all around the world. 
</p> 
</div> 
</div> 
</div> 
<!--Div for the content ends here--> 
</div> 
```

## 来自外部样式表的代码

```
.photo{ 
width:48%; 
float:left; 
padding-left:2px; 
} 
.lat_art{ 
width:50%; 
float:right; 
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T13:38:56.953

这真的很难理解，因为你描述的每一个词都是“div”。无论如何，您描述了您有三列，但如果我理解正确，那只是您要问的中间那一列。

你想要这种格式：

*   左边的图片
*   图片右侧有标题
*   在标题下，您有很多环绕图片的文字

正确的？

你的问题是你漂浮，但你没有清除浮动。这意味着它下面的**所有**内容都将根据图片对齐。您需要设置 clear:both 在您不想再包装内容之后。

我写了一个小例子并测试了它。CSS 是内联的，以使示例简短而简单。

```
<div>
<img src="pircture.png" style="float:left;height:400px;width:400px" />
<h4>My header</h4>
<p> A little content</p>
<div style="clear:both"></div>
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T13:43:20.920

通过使用Yahoo!的[YUI Grids CSS](http://developer.yahoo.com/yui/grids/) ，您可能会为自己节省大量时间和精力。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:57:40.410

我不是 100% 确定我理解这个问题。如果您确实希望您*所称的**单个 div*在左侧有图片，在右侧有文本，您可以通过将 photo 和**lat_art** div **left**浮动来完成此操作。如果您确实希望文本在右侧并在图片较长时在图片下方流动，则根本不要浮动“lat_art **”**。

 *****无需在*单个 div*上指定高度，或清除它们上的浮动，因为默认情况下它们将低于另一个（div 是块）。

你在这里也成为了divitis的受害者——`<span class="artist">ROCK ON</span>` 可能是更有意义的东西，比如`<h5 class="artist">ROCK ON</h5>` 一个段落或其他相应样式的东西。img 可以很容易地是：

```
<img src="Images/guitar.jpg" alt="guitar" class="photo"/> 
```

而不是：

```
<div class="photo"> 
<img src="Images/guitar.jpg" alt="guitar"/> 
</div> 
```

# c# - 在 C# 和 C++ 之间传输图像数据

> ID：569494
> 
> 赞同：1
> 
> 时间：2009-02-20T13:02:05.310
> 
> 标签：c#, image, pixel, windows

我正在做一个项目，我将在 C# windows 应用程序中创建一个用户界面。它需要显示一张图片。我想将图片数据传输到一个 C++ 模块，该模块将对其进行编辑，然后返回结果。

我已经确定了如何在 C# 和 C++ 之间传输数据（我使用 C++ DLL）。我的问题是：C# 中的哪个类可以做我想做的事？我需要它来将图像数据导出到某种像素矩阵（最好使用分离的 RGB 值，每个大小为 1 字节 = 3 字节/像素），我可以在 C++ 模块中使用。此外，它需要能够将结果导入回对象中，并显示在 C# windows 应用程序窗口中。

有什么想法可能最适合我吗？

谢谢，马尔基。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T13:04:46.927

如果您想按照您的描述使用像素数据，那么 Bitmap.LockBits 是适合您的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T14:04:33.757

为大家解答！:-)

不，如果您只想将像素传递给本机 C++，则不需要任何封送处理，也不需要任何不安全的代码。

你可以查看这篇文章，如果我*正是*这样做的，调用包含手工汇编语言的 C++ 函数来进行一些图像处理：

[http://danbystrom.se/2008/12/22/optimizing-away-ii/](http://danbystrom.se/2008/12/22/optimizing-away-ii/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T13:06:57.403

您的 dll 方法期望作为输入参数是什么？

编辑：据我所知，在 c# 中，您需要进入“不安全模式”才能直接使用像素（并且快速:)）。像[这样](http://www.vcskicks.com/fast-image-processing.html)的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T13:10:48.797

除了 danbystrom 关于 Bitmap.LockBits 的回答之外，您还需要查看用于复制二进制数据的 Marshal 类。以 Marshal.Copy 方法为例。

# string - 将行从一个 .txt 文件移动到另一个

> ID：569497
> 
> 赞同：0
> 
> 时间：2009-02-20T13:03:29.363
> 
> 标签：string, scripting, cmd, batch-file

我正在尝试将某些行从一个 .txt 文件移动到另一个。这些线条都遵循一定的模式。我一直在研究在批处理文件中使用 find 命令，但这不会从原始文件中删除该行。

例如：

```
find \i pattern "d:\example1.txt" >> "d:\example2.txt" 
```

有什么办法可以做到这一点？

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T13:07:55.060

使用`findstr`您也可以打印*不*匹配的行。所以你可以分几个步骤来完成，伪编码如下：

*   `findstr pattern input > output`
*   `findstr /v pattern input > input-inverse`
*   `move /y input-inverse input`

这应该让您在输出中保留与模式匹配的所有行，以及没有这些行的输入。

编辑：最后一步使用带有覆盖选项的移动，因此无需删除之前的输入。我想我（主要是 Linux 人）认为“重命名”和“移动”是同一件事，并认为这种覆盖是理所当然的。所以，谢谢你的提醒。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T13:08:03.923

如果您可以使用外部程序，一种方法是使用[awk](http://en.wikipedia.org/wiki/Awk)或[sed](http://en.wikipedia.org/wiki/Sed)。

awk 示例：

```
awk /pattern/ { print } 
```

赛德示例：

```
sed '/inverse_pattern/ d' //Deletes lines which do not match 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T13:07:44.780

如何创建两个文件，然后替换原始文件？

```
find \i pattern "d:\example1.txt" >> "d:\example2.txt"
find \i antipattern "d:\example1.txt" >> "d:\example3.txt"
del example1.txt
ren example3.txt example1.txt 
```

从文件中删除行很难。通常，即使在真正的编程环境中，您也会在此处使用额外的文件。

这是一个稍微不同的实现：

```
ren example1.txt source.txt
find \i pattern "d:\source.txt" >> "d:\example2.txt"
find \i antipattern "d:\source.txt" >> "d:\example1.txt"
del source.txt 
```

# mysql - SQL 问题，LEFT JOIN [..] IN()

> ID：569512
> 
> 赞同：0
> 
> 时间：2009-02-20T13:08:51.173
> 
> 标签：mysql, sql, join, mysql-error-1054

这个小的 SQL 错误困扰着我。查询似乎没有问题，只是范围（？），示例效果最好：

```
SELECT ocp.*, oc.*, GROUP_CONCAT( u.username SEPARATOR ', ') AS `memjoined`
FROM gangs_ocs_process ocp, gangs_ocs oc
LEFT JOIN users u ON u.userid IN ( ocp.membersin )
WHERE ocp.ocid =1 AND ocp.gangid =1 AND oc.oc_name = ocp.crimename
GROUP BY ocp.ocid
LIMIT 0 , 30 
```

有一个列 (gangs_ocs_process.membersin)，其中包含已加入的 ID 列表（即 1、2、5）。我正在尝试一次性获取每个 ID 的用户名（从`users`表中）。

问题是`LEFT JOIN users u ON u.userid IN ( ocp.membersin )`

如果我替换`1,2,4`为`ocp.membersin`（放置文字列表而不是列名），它可以正常工作。它返回一个包含用户名 ( [image](http://decepti0n.com/u/f/tmp_fTceB.jpg) ) 的列。但是，如果我离开 ocp.membersin，我会收到以下错误：

`#1054 - Unknown column 'ocp.membersin' in 'on clause'`

这是我第一次在左连接中使用 IN，所以我有点迷茫。

任何帮助都会很棒:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T13:47:19.490

我认为“IN”不适用于这种语法。MySQL 期望 IN 类似于数据集，而不是分隔字符串。我认为您需要找到一种方法来获取成员，将其扩展为 MySQL 可以使用的数据集（可能是临时表），然后加入其中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T14:27:10.270

如果您的表中有分隔字符串，则说明您的数据库存在设计问题。添加一个新表来保存这些值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T13:11:46.707

你不能让它工作的原因是因为首先你需要让你的数据库正常化。您永远不应该在单个列中有 ID 列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T13:16:55.540

这是保持会员资格的**不好方法。**

但是如果你仍然需要忍受它，你可以尝试`REGEXP`匹配来测试成员资格：

```
SELECT ocp.*, oc.*, GROUP_CONCAT( u.username SEPARATOR ', ') AS `memjoined`
FROM gangs_ocs_process ocp
LEFT JOIN users u ON (ocp.membersin RLIKE CONCAT('(^|,)[[:blank:]]?', userid, '[[:blank:]]?($|,)'))
JOIN gangs_ocs oc ON (ocp.ocid = 1 AND ocp.gangid = 1 AND oc.oc_name = ocp.crimename)
GROUP BY ocp.ocid
LIMIT 0 , 30 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T13:16:57.457

再看一遍后，我认为您的问题是尝试在错误的点以及 IN 语法进行聚合，并且您应该在受 IN 内容限制的子查询中进行聚合。我对您的架构知之甚少，无法使其开箱即用，但您想要这样的东西。SomeKeyfield 应该与 gangs_ocs_process 相关联

```
SELECT ocp.*, oc.*, u.Memjoined
FROM gangs_ocs_process ocp, gangs_ocs oc
LEFT JOIN (Select SomeKeyField, GROUP_CONCAT( u.username SEPARATOR ', ') as memjoined
            from  users where userid in
            (select membersin from gangs_ocs_process 
             where [whatever conditions] )
             Group By SomeKeyField) u on ocp.SomeKeyField = u.SomeKeyField

WHERE ocp.ocid =1 AND ocp.gangid =1 AND oc.oc_name = ocp.crimename
GROUP BY ocp.ocid
LIMIT 0 , 30 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T13:17:57.797

您确定“membersin”在“gangs_ocs_process”表中，而不是“gangs_ocs”表中吗？

# c# - 是否有令人信服的理由反对使用 C# 关键字“as”？

> ID：569522
> 
> 赞同：7
> 
> 时间：2009-02-20T13:12:32.787
> 
> 标签：c#, .net, casting, types, as-keyword

我发现使用以下内容：

```
TreeViewItem i = sender as TreeViewItem;
if(i != null){ ... } 
```

比以下更容易编写和理解：

```
if(sender.GetType() == typeof(TreeViewItem)){
    TreeViewItem i = (TreeViewItem)sender;
    ...
} 
```

是否有令人信服的理由*不*使用第一个构造？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-20T13:22:24.527

在大多数情况下，我更喜欢强制转换，`as`因为通常如果对象的类型错误，则表明存在错误。错误*应该*导致异常 IMO - 并且执行转换的行比代码中的后面`InvalidCastException`要清晰得多。`NullReferenceException`

`as`当传递了对您不想要的类型的对象的引用是有效且合法的时，应该使用它。这种情况确实会出现，但根据我的经验，它不像正常铸造那样频繁。

但是，使用 比较类型`GetType()`很少是正确的解决方案 - 只有当您想要检查所涉及的*确切*类型而不是兼容类型时才适用。

我已经在其他地方写了一个关于“cast vs as”讨论的[更长的答案。](https://stackoverflow.com/questions/496096/casting-vs-using-the-as-keyword-in-the-clr/496167#496167)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-20T13:14:39.617

一点也不 - 它让您有机会验证转换（转换）是否完成。如果你这样做

```
TreeViewItem i = (TreeViewItem) sender; 
```

如果强制转换失败，您可能会遇到异常。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-20T13:20:51.613

一般来说，这两个片段是*不*等价的。`TreeViewItem i = sender as TreeViewItem`即使`sender`是 的孙子，也会产生正确的结果`TreeViewItem`，而`sender.GetType() == typeof(TreeViewItem)`仅当是`true` *且*没有任何可能的子类时。`sender``TreeViewItem`

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-20T13:17:07.863

“如”：好东西。一直使用它。

如果您真的想要手动比较类型的替代方法，请尝试：

```
 if(person is Employee) { } 
```

读起来更好。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-20T13:18:04.320

你的例子最好写成：

```
if (sender is TreeViewItem) {
    TreeViewItem i = (TreeViewItem)sender;
    ...
} 
```

`as`操作员可以帮助避免的正是这种双重类型的检查。因此，对于您引用的示例，我会说这绝对是一个很好的解决方案。

但是，在某些情况下您确实*需要*演员表。如果你期待 a并且什么都不想要，那么如果你得到其他`TreeViewItem`任何东西，强制转换将确保抛出 an 。`InvalidCastException`

就像在大多数情况下一样，这里没有一揽子规则：**为正确的工作使用正确的工具**。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T13:20:40.210

如果您想要一个普通（不可为空）的值类型，显然这不起作用，例如：

```
int test = sender as int; 
```

无效，但是：

```
int? test = sender as int?; 
```

被允许。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T13:17:35.770

“as”更快，但要记住的是：

*   如果有问题，“as”会返回 null 而不是抛出异常

*   它不会进行自定义转换 iirc

*   它不适用于参考-> 价值

编辑：“as”肯定更快（[http://www.codeproject.com/KB/cs/csharpcasts.aspx](http://www.codeproject.com/KB/cs/csharpcasts.aspx)）

Edit2：所以基本上是速度与安全的决定

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-20T13:17:48.687

不，我经常使用它。它允许您以干净的方式避免`InvalidCastException`s。

例如：

```
TreeViewItem tvItem = sender as TreeViewItem;

if (tvItem != null) return;

// Do stuff 
```

相对于：

```
try
{
    TreeViewItem tvItem = (TreeViewItem)sender;
    // Do stuff.
}
catch (InvalidCastException ex)
{
    // Didn't work, do something about it
    return; // ... or not...
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-20T13:33:28.837

如果获取错误的类型是一个错误，那么您应该使用强制转换。这样做的原因是确实存在问题，您应该知道它。

如果该值可能为空，并且在发生这种情况时这不是系统中的错误，则使用“as”。原因是您应该在任何时候使用“as”来获取空值是可以接受的。

请记住，您不能使用“as”来转换为值类型，因为 null 值对它们来说是不可接受的。如果你有一个值类型并且想要使用“as”，你将需要使用一个可以为空的值类型。

[何时使用“as”与铸造](http://aspalliance.com/1811_Standard_Type_Casting_and_as_Operator_Conversions.3)

# sql-server - 在 Reporting Services 2008 中存储和检索会话变量

> ID：569524
> 
> 赞同：1
> 
> 时间：2009-02-20T13:13:38.480
> 
> 标签：sql-server, vb.net, reporting-services, ssrs-2008

有没有办法在登录期间设置会话变量，然后可用于报告？

我们有一个报告服务服务器，我们从交易系统中移动和非规范化数据以用于报告目的。为了让我们的用户在交易系统中使用相同的用户名和密码登录，我们设置了自定义表单身份验证，经过多次试验和错误，它终于可以工作了。此外，我们有权访问我们的交易系统，因此用户权限的任何更改都会立即反映在 Reporting Services 中。

我们现在的问题是我们想添加一些附加功能，例如根据我们的事务系统中的用户权限/组锁定参数。我们已经找到了一种方法，但它效率低下，基本上我们有存储过程来查询我们的事务系统以检查访问。问题是这些查询通常会针对每个报告请求运行，即使答案不太可能改变。如果能够访问可以在登录期间设置一次然后从报告中访问的会话级别数据，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T10:34:58.233

使用反射，您可以访问正在运行的作业的 HTTPContext，您可以从中获取 Session 对象（取决于您的设置）。对于与安全性相关的稍微不同的场景，我们不得不使用此方法：如果您有一个使用多个数据集的报表，则只有第一个数据集会获得正确的用户上下文。这个 hack 允许您自己获取 HTTPContext（我们在自定义数据层中使用它）。

[此处](http://social.msdn.microsoft.com/forums/en-US/sqlreportingservices/thread/adaf03b6-c9b3-4743-bc58-046081b485cb/)摘自 MSDN 论坛文章：

```
using System.Reflection;
using Microsoft.ReportingServices.Diagnostics;

// This is declared outside of a method body for improved performance,
// since this reflection bit only needs to run once

private static FieldInfo contextField = 
  typeof(RunningJobContext).GetField("m_optionalWebCtx", 
                   BindingFlags.Instance | BindingFlags.NonPublic);

// Call this in your method
HttpContext context = (HttpContext)contextField.GetValue(Globals.JobContext); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T10:48:33.943

将访问权限移至 asp.net 站点并使用 reportviewer 控件，您肯定有更多的灵活性。

确保您的开发机器和 IIS 机器上的控件版本相同，VS 2008 版本为 9.0.0.0。

然后，您必须获得 IIS 和报告服务器设置之间的权限/访问权限，但这并不难。

此时，您可以更好地控制设置、隐藏和控制所有参数或提供您自己的参数控制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T11:08:58.730

SSRS不能[直接访问 session](http://dotnet.org.za/patrick/archive/2005/07/29/40419.aspx)。我的建议：

1.  在数据库中创建表以托管所有权限/组相关信息，将 userID 作为参数传递给存储过程。问题 - 触发此表中的更改。
2.  使用 ASP.NET 作为 SSRS 的包装器，因此会话变量不会有问题。[从 ASP.NET 应用程序中的 SQL Reporting Services 开始](http://www.c-sharpcorner.com/UploadFile/chauhan_sonu57/SQLReportingServices03032006002905AM/SQLReportingServices.aspx)

# c# - c#线程和属性

> ID：569525
> 
> 赞同：2
> 
> 时间：2009-02-20T13:13:47.480
> 
> 标签：c#, winforms, multithreading

我想从工作线程中读取两个属性。这是该类的示例：

```
public partial class FrmPrincipal : Form
{
    private int Height;
    private int Width;
    private string token;

    public FrmPrincipal()
    {
        InitializeComponent();
        ...
    }

    private void menuItem1_Click(object sender, EventArgs e)
    {
        Thread t = new Thread(RequestImage);
        t.Start();
    }

    private void RequestImage()
    {
        try
        {
            ...

            // I want to read these properties
            int alto = this.Height;
            int ancho = this.Width;
            this.token = "...";

            ...
        }
        catch (Exception ex)
        {
            ...
        }
    } 
```

当 menuItem1_Click 被执行时，它使用 RequestImage 方法启动一个新线程。在这种方法中，我需要读取 this.Height 和 this.Width 并更新 this.token 的值。

我怎样才能做到这一点？

我正在为 windows mobile (Compact Framework 2.0) 编写应用程序。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T13:18:01.153

我建议您在单击处理程序中捕获它们，并将它们传递给新线程的委托。这最容易通过实际 ThreadStart 的 lambda 表达式来完成：

```
public partial class FrmPrincipal : Form
{
    private string token;

    public FrmPrincipal()
    {
        InitializeComponent();
        ...
    }

    private void menuItem1_Click(object sender, EventArgs e)
    {
        int width = Width;
        int height = Height;
        Thread t = new Thread(() => RequestImage(width, height));
        t.Start();
    }

    private void RequestImage(int width, int height)
    {
        try
        {
            ...

            int alto = height;
            int ancho = width;
            this.token = "...";

            ...
        }
        catch (Exception ex)
        {
            ...
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T14:10:33.897

您发布的代码不需要任何额外的东西。但是，只有在线程运行时没有其他代码访问令牌成员时，它才能正常工作。对变量的共享读/写访问需要被锁保护。但这还不是全部，您还必须确保线程正确同步，读取“令牌”的线程可能应该等到工作线程更新值。谷歌搜索“生产者消费者模式”，你会发现很多关于这个主题的文献。

假设在这种情况下，您需要 UI 线程中的某种代码来等待 RequestImage() 完成，然后使用其结果，处理同步的最简单方法是让 RequestImage() 在完成时调用 Control.BeginInvoke()工作。

请注意，您还需要处理 UI 线程在工作线程完成之前终止的情况。不这样做很可能会产生 ObjectDisposed 异常。Q&D 解决方案是将线程的 IsBackground 属性设置为 True。确保线程中止时不会发生任何令人讨厌的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T13:19:42.943

将方法的签名更改为 void RequestImage(object state) 并调用 t.Start(this) 将表单实例传递到线程主体。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-20T13:19:11.633

声明共享变量 volatile 就足够了。

**编辑：** 有人可以解释为什么这不是一个好的答案吗？我认为该令牌应该是易变的。否则 GUI 线程可以使用缓存值。

# .net - 关联来自两个或多个进程的日志记录

> ID：569526
> 
> 赞同：0
> 
> 时间：2009-02-20T13:13:51.817
> 
> 标签：.net, logging

我有两个已启动并正在运行的进程，并且正在从中进行日志记录。一个是客户端，另一个是 Web 服务。我想建立一个中央日志系统，我可以在其中跟踪日志和进程之间的交互——例如，当我查看日志时，我希望能够将来自客户端的调用与 Web 服务相关联。我想这意味着客户端进程的 processid 需要以某种方式流向 web 服务才能被跟踪？

这对于当前的日志框架（如 Enterprise Library 或 Log4Net）是否可行？有没有人研究过这样的事情？

任何帮助，将不胜感激。

如果您对此有更明确的术语，请随时更改问题或标签的标题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T15:39:47.397

您应该能够使用 .Net Enterprise Library Logging Application Block 轻松完成此操作。这将允许您从两个进程登录到同一个数据库/表。

至于将一个进程连接到下一个进程，是的 - 您需要在调用进程中创建某种唯一 ID 并将其传递给被调用的进程。然后，您可以在调用之前从调用者那里记录该值，并在调用开始时从被调用者那里记录它。

我建议您为进程间通信使用单独的日志记录级别。我经常将诸如通知消息之类的通信记录下来。这样可以轻松地将它们从日志中的其余消息中过滤掉。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T23:51:57.633

要在中央位置收集和存储日志数据，您通常需要某种日志服务器或接收器应用程序（特别是如果您想同时写入单个日志文件并仍保持良好的性能）。您可能想尝试一下我们的日志记录工具[SmartInspect](http://www.gurock.com/products/smartinspect/)，因为它带有一个日志服务器，可以接收来自多个进程/机器的日志数据。SmartInspect 还附带一个查看器应用程序，用于分析和过滤日志数据。

# python - 对于 pygtk 应用程序，什么是好的嵌入式浏览器？

> ID：569547
> 
> 赞同：4
> 
> 时间：2009-02-20T13:19:32.630
> 
> 标签：python, user-interface, gtk, webkit, mozilla

我打算在我的 pygtk 应用程序中使用嵌入式浏览器，我正在 gtkmozembed 和 pywebkitgtk 之间进行辩论。两者之间有什么引人注目的区别吗？有没有我不知道的第三种选择？

应该注意的是，我不会使用它来访问网络上的内容。我主要将它用于 UI 目的。

我的优先事项是：

1.  它需要稳定。
    *   它需要是跨平台的。
    *   它应该很容易使用。
    *   应该积极维护。
    *   它应该是可扩展的。
    *   它应该很快。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-11T21:06:20.010

gtkmozembed 在 Windows 上不可用，但您可以直接使用 gecko 嵌入接口。这将需要您编写一些 C++ 代码。

据我所知，gtk webkit 端口在 Windows 上尚不可用，并且似乎仍在经历很多变化。

有关跨平台 gecko 嵌入解决方案的示例，请查看[Miro](http://www.getmiro.com/ "米罗")。Miro 是 python，他们只编写了几个 C++ 类来在 Windows 上嵌入 gecko，同时在 linux 上使用 gtkmozembed。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T14:44:31.880

如果你通过网页来判断，那么肯定是 pywebkitgtk

来自此页面的[pygtkmoz](http://sourceforge.net/projects/pygtkmoz)

“注意：此项目不再维护。请改用 gnome-python-extras ( [http://www.pygtk.org](http://www.pygtk.org) )。对于这可能导致的任何麻烦，我深表歉意，但从长远来看，这会更好。Python 绑定对于 GtkEmbedMozilla。”

并且[pywebkitgtk](http://code.google.com/p/pywebkitgtk/)看起来像活动的项目[更改](http://code.google.com/p/pywebkitgtk/source/list)

# c# - .NET 的 IMAP 文件夹路径编码 (IMAP UTF-7)？

> ID：569549
> 
> 赞同：6
> 
> 时间：2009-02-20T13:20:02.037
> 
> 标签：c#, .net, encoding, imap, utf-7

IMAP 规范（[RFC 2060](http://www.faqs.org/rfcs/rfc2060.html) , 5.1.3\. Mailbox International Naming Convention）描述了如何处理文件夹名称中的非 ASCII 字符。它定义了**修改后**的UTF-7 编码：

> 按照惯例，国际邮箱名称是使用 [UTF-7] 中描述的 UTF-7 编码的修改版本指定的。这些修改的目的是更正 UTF-7 的以下问题：
> 
> 1.  UTF-7 使用“+”字符进行移位；这与邮箱名称中通常使用的“+”冲突，特别是 USENET 新闻组名称。
>     
>     
> 2.  UTF-7 的编码是使用“/”字符的 BASE64；这与使用“/”作为流行的层次分隔符相冲突。
>     
>     
> 3.  UTF-7 禁止“\”的未编码使用；这与使用“\”作为流行的层次分隔符相冲突。
>     
>     
> 4.  UTF-7 禁止“~”的未编码使用；这与在某些服务器中使用“~”作为主目录指示符相冲突。
>     
>     
> 5.  UTF-7 允许多种替代形式来表示相同的字符串；特别是，可打印的 US-ASCII 字符可以以编码形式表示。
>     
>     
> 
> 在修改后的 UTF-7 中，可打印的 US-ASCII 字符（“&”除外）代表它们自己；也就是说，八位字节值为 0x20-0x25 和 0x27-0x7e 的字符。字符“&”（0x26）由两个八位字节序列“&-”表示。
> 
> 所有其他字符（八位字节值 0x00-0x1f、0x7f-0xff 和所有 Unicode 16 位八位字节）都以修改后的 BASE64 表示，对 [UTF-7] 进行了进一步修改，即使用“，”而不是“/”。
> 修改后的 BASE64 不得用于表示任何可以表示自身的打印 US-ASCII 字符。
> 
> “&”用于转换为修改后的 BASE64，“-”用于转换回 US-ASCII。所有名称都以 US-ASCII 开头，并且必须以 US-ASCII 结尾（即，以 Unicode 16 位八位字节结尾的名称必须以“-”结尾）。

在我开始实现它之前，我的问题是：是否有一些**.NET 代码/库**（甚至在框架中）可以完成这项工作？我找不到 .NET 资源（仅[适用于其他语言/框架的实现](http://search.cpan.org/~pmakholm/Encode-IMAPUTF7-1.01/lib/Encode/IMAPUTF7.pm)）。

*谢谢！*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2019-09-21T13:02:41.673

```
//
// ImapEncoding.cs
//
// Author: Jeffrey Stedfast <jestedfa@microsoft.com>
//
// Copyright (c) 2013-2019 Microsoft Corp. (www.microsoft.com)
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
//

using System.Text;

namespace MailKit.Net.Imap {
    static class ImapEncoding
    {
        const string utf7_alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+,";

        static readonly byte[] utf7_rank = {
            255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
            255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
            255,255,255,255,255,255,255,255,255,255,255, 62, 63,255,255,255,
             52, 53, 54, 55, 56, 57, 58, 59, 60, 61,255,255,255,255,255,255,
            255,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,
             15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,255,255,255,255,255,
            255, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
             41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51,255,255,255,255,255,
        };

        public static string Decode (string text)
        {
            var decoded = new StringBuilder ();
            bool shifted = false;
            int bits = 0, v = 0;
            int index = 0;
            char c;

            while (index < text.Length) {
                c = text[index++];

                if (shifted) {
                    if (c == '-') {
                        // shifted back out of modified UTF-7
                        shifted = false;
                        bits = v = 0;
                    } else if (c > 127) {
                        // invalid UTF-7
                        return text;
                    } else {
                        byte rank = utf7_rank[(byte) c];

                        if (rank == 0xff) {
                            // invalid UTF-7
                            return text;
                        }

                        v = (v << 6) | rank;
                        bits += 6;

                        if (bits >= 16) {
                            char u = (char) ((v >> (bits - 16)) & 0xffff);
                            decoded.Append (u);
                            bits -= 16;
                        }
                    }
                } else if (c == '&' && index < text.Length) {
                    if (text[index] == '-') {
                        decoded.Append ('&');
                        index++;
                    } else {
                        // shifted into modified UTF-7
                        shifted = true;
                    }
                } else {
                    decoded.Append (c);
                }
            }

            return decoded.ToString ();
        }

        static void Utf7ShiftOut (StringBuilder output, int u, int bits)
        {
            if (bits > 0) {
                int x = (u << (6 - bits)) & 0x3f;
                output.Append (utf7_alphabet[x]);
            }

            output.Append ('-');
        }

        public static string Encode (string text)
        {
            var encoded = new StringBuilder ();
            bool shifted = false;
            int bits = 0, u = 0;

            for (int index = 0; index < text.Length; index++) {
                char c = text[index];

                if (c >= 0x20 && c < 0x7f) {
                    // characters with octet values 0x20-0x25 and 0x27-0x7e
                    // represent themselves while 0x26 ("&") is represented
                    // by the two-octet sequence "&-"

                    if (shifted) {
                        Utf7ShiftOut (encoded, u, bits);
                        shifted = false;
                        bits = 0;
                    }

                    if (c == 0x26)
                        encoded.Append ("&-");
                    else
                        encoded.Append (c);
                } else {
                    // base64 encode
                    if (!shifted) {
                        encoded.Append ('&');
                        shifted = true;
                    }

                    u = (u << 16) | (c & 0xffff);
                    bits += 16;

                    while (bits >= 6) {
                        int x = (u >> (bits - 6)) & 0x3f;
                        encoded.Append (utf7_alphabet[x]);
                        bits -= 6;
                    }
                }
            }

            if (shifted)
                Utf7ShiftOut (encoded, u, bits);

            return encoded.ToString ();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T14:04:59.090

这太专业了，无法出现在框架中。尽管我见过的许多不完整的“实现”根本不关心转换，但 codeplex 上可能有一些东西，并且很乐意将所有非 us-ascii 字符传递到 IMAP 服务器。

但是我过去已经实现了它，它实际上只有 30 行代码。您遍历字符串中的所有字符，如果它们在 0x20 和 0x7e 之间的范围内输出它们（不要忘记在“&”之后附加“-”），否则收集所有非 us-ascii 并使用 UTF7 转换它们（或UTF8 + base64，我不太确定）用“，”替换“/”。此外，您需要维护“转移状态”，例如，无论您当前是在编码非 us-ascii 还是输出 us-ascii，并在状态更改时附加转换标记“&”和“-”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-07-17T11:08:10.183

未经测试，但如果应用了[Aleksey](https://stackoverflow.com/questions/569549/imap-folder-path-encoding-imap-utf-7-for-net/51379904#comment91955764_51379904)的错误修复，则[此](https://github.com/smiley22/S22.Imap/blob/master/Util.cs#L333)MIT 许可代码看起来不错：

```
 /// <summary>
    /// Takes a UTF-16 encoded string and encodes it as modified UTF-7.
    /// </summary>
    /// <param name="s">The string to encode.</param>
    /// <returns>A UTF-7 encoded string</returns>
    /// <remarks>IMAP uses a modified version of UTF-7 for encoding international mailbox names. For
    /// details, refer to RFC 3501 section 5.1.3 (Mailbox International Naming Convention).</remarks>
    internal static string UTF7Encode(string s) {
        StringReader reader = new StringReader(s);
        StringBuilder builder = new StringBuilder();
        while (reader.Peek() != -1) {
            char c = (char)reader.Read();
            int codepoint = Convert.ToInt32(c);
            // It's a printable ASCII character.
            if (codepoint > 0x1F && codepoint < 0x7F) {
                builder.Append(c == '&' ? "&-" : c.ToString());
            } else {
                // The character sequence needs to be encoded.
                StringBuilder sequence = new StringBuilder(c.ToString());
                while (reader.Peek() != -1) {
                    codepoint = Convert.ToInt32((char)reader.Peek());
                    if (codepoint > 0x1F && codepoint < 0x7F)
                        break;
                    sequence.Append((char)reader.Read());
                }
                byte[] buffer = Encoding.BigEndianUnicode.GetBytes(
                    sequence.ToString());
                string encoded = Convert.ToBase64String(buffer).Replace('/', ',').
                    TrimEnd('=');
                builder.Append("&" + encoded + "-");
            }
        }
        return builder.ToString();
    }

    /// <summary>
    /// Takes a modified UTF-7 encoded string and decodes it.
    /// </summary>
    /// <param name="s">The UTF-7 encoded string to decode.</param>
    /// <returns>A UTF-16 encoded "standard" C# string</returns>
    /// <exception cref="FormatException">The input string is not a properly UTF-7 encoded
    /// string.</exception>
    /// <remarks>IMAP uses a modified version of UTF-7 for encoding international mailbox names. For
    /// details, refer to RFC 3501 section 5.1.3 (Mailbox International Naming Convention).</remarks>
    internal static string UTF7Decode(string s) {
        StringReader reader = new StringReader(s);
        StringBuilder builder = new StringBuilder();
        while (reader.Peek() != -1) {
            char c = (char)reader.Read();
            if (c == '&' && reader.Peek() != '-') {
                // The character sequence needs to be decoded.
                StringBuilder sequence = new StringBuilder();
                while (reader.Peek() != -1) {
                    if ((c = (char)reader.Read()) == '-')
                        break;
                    sequence.Append(c);
                }
                string encoded = sequence.ToString().Replace(',', '/');
                int pad = encoded.Length % 4;
                if (pad > 0)
                    encoded = encoded.PadRight(encoded.Length + (4 - pad), '=');
                try {
                    byte[] buffer = Convert.FromBase64String(encoded);
                    builder.Append(Encoding.BigEndianUnicode.GetString(buffer));
                } catch (Exception e) {
                    throw new FormatException(
                        "The input string is not in the correct Format.", e);
                }
            } else {
                if (c == '&' && reader.Peek() == '-')
                    reader.Read();
                builder.Append(c);
            }
        }
        return builder.ToString();
    } 
```

* * *

不要在当前状态下使用[此](https://sourceforge.net/p/imapnet/discussion/704327/thread/3c4bfc6b/?limit=50)代码，它包含`[...] UTF7.GetBytes([...]) [...] .Replace('+', '&')`- 它使用现有的 .Net UTF-7 编码例程，并且（除其他外）在结果中替换`+`为`&`。这是**错误**的，因为它不仅将“移位字符”从`+`to更改为`&`（这是有意且正确的），而且还 `+`更改了 base64 编码区域内的所有字符（不得更改为`&`）。

# java - Java 中的非阻塞 UDP I/O 与阻塞 UDP I/O

> ID：569555
> 
> 赞同：18
> 
> 时间：2009-02-20T13:22:26.773
> 
> 标签：java, udp, nio, datagram

非阻塞 TCP/IP`SocketChannel`和`Selector`NIO 帮助我用少量线程处理许多 TCP/IP 连接。但是 UDP`DatagramChannels`呢？（我必须承认我对 UDP 不是很熟悉。）

`DatagramChannel`即使未在阻塞模式下运行，UDP 发送操作似乎也不会阻塞。是否真的存在`DatagramSocket.send(DatagramPacket)`由于拥塞或类似原因而导致阻塞的情况？我真的很好奇是否存在这种情况以及生产环境中存在哪些可能的情况。

如果`DatagramSocket.send(DatagramPacket)`实际上没有阻塞并且我不会使用已连接`DatagramSocket`并仅绑定到一个端口，那么将非阻塞模式与`DatagramChannel`and一起使用没有优势`Selector`吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-20T13:48:40.970

使用Java的DatagramSockets、Channels等已经有一段时间了，但我仍然可以给你一些帮助。

UDP 协议不像 TCP 那样建立连接。相反，它只是发送数据并忘记它。如果确保数据实际到达那里很重要，那是客户的责任。因此，即使您处于阻塞模式，您的发送操作也只会在刷新缓冲区所需的时间内阻塞。由于 UDP 对网络一无所知，它会尽早将其写出，而不检查网络速度或它是否真的到达了它应该去的地方。因此，对您而言，通道似乎实际上已准备好进行更多发送。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-20T21:10:41.233

UDP 不会阻塞（它只会在将数据传输到操作系统时阻塞）这意味着如果在任何时候下一跳/交换机/机器无法缓冲 UDP 数据包，它就会丢弃它。在某些情况下，这可能是理想的行为。但这是你需要注意的事情。

UDP也不保证

*   按发送顺序发送数据包。
*   不要分解大数据包。
*   跨交换机转发数据包。通常交换机之间的 UDP 转发被关闭。

但是 UDP 确实支持多播，因此可以将相同的数据包传送到一个或多个主机。但是，发件人不知道是否有人收到数据包。

关于 UDP 的一个棘手的事情是它大部分时间都可以工作，但有时会以非常难以重现的方式严重失败。出于这个原因，即使您进行了一些测试并且它似乎有效，您也不应该假设可靠性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-10T09:07:11.863

非阻塞 UDP 在接收端最有用。数据包发送只能因本地情况而延迟：本地流量整形工具（如“游戏网卡”）将游戏流量优先于其他流量源，或者网卡过载（这不太可能发生）可能会延迟数据包的发送。一旦退出系统。一旦数据包离开本地接口，它就不再是应用程序的关注点了。

# .net - .Net Control 做谷歌浏览器对接

> ID：569558
> 
> 赞同：5
> 
> 时间：2009-02-20T13:23:34.603
> 
> 标签：.net, google-chrome, components, docking

我喜欢 Google Chrome 允许您从窗口中抓取标签以创建其他窗口的方式。有谁知道是否有办法在我的.Net 应用程序中进行这种停靠和取消停靠？或者更好的是，是否有人知道是否有可以提供此类功能的 .Net 组件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T13:39:43.783

[DevExpress](http://devexpress.com/Products/NET/Controls/WinForms/Bars/dock_window.xml)有一个停靠控件。我们在我们的应用程序中使用它

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T13:29:22.763

我自己没有尝试过，但看起来[Avalon Dock](http://www.codeplex.com/AvalonDock/) 会给你类似的功能。

# wpf - 在 WPF 中动态加载图像

> ID：569561
> 
> 赞同：49
> 
> 时间：2009-02-20T13:26:30.647
> 
> 标签：wpf, image, dynamic, loading

我对 WPF 有一个奇怪的问题，我在运行时从磁盘加载图像并将它们添加到 StackView 容器中。但是，图像没有显示。经过一番调试，我找到了诀窍，但它真的没有任何意义。我制作了一个小型演示应用程序来识别问题：

新建一个WPF项目，粘贴代码如下：

xml:

```
<Window x:Class="wpfBug.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300" Loaded="Window_Loaded">
    <StackPanel Name="sp">
    </StackPanel>
</Window> 
```

xaml.cs，粘贴下面的默认使用：

```
namespace wpfBug
{
    /// <summary>
    /// Interaction logic for Window1.xaml
    /// </summary>
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        private void Window_Loaded(object sender, RoutedEventArgs e)
        {
            Image i = new Image();
            BitmapImage src = new BitmapImage();
            src.BeginInit();
            src.UriSource = new Uri("picture.jpg", UriKind.Relative);
            src.EndInit();
            i.Source = src;
            i.Stretch = Stretch.Uniform;
            //int q = src.PixelHeight;        // Image loads here
            sp.Children.Add(i);
        }
    }
} 
```

将图像复制到 bin/Debug 文件夹并将其命名为“picture.jpg”

该程序不显示任何内容，除非注释行未注释。

谁能解释我做错了什么，或者为什么会这样？如果删除图像并运行程序，它会在“int q= ...”行生成异常。如果该行被注释，即使没有图像，程序也会毫无例外地运行。仅在必要时才加载图像，但是当我将图像控件添加到 StackPanel 时应该加载图像。

有什么想法吗？

编辑：顺便说一句，如果您将图像添加为资源，则不需要“int q = ..”行。

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-02-24T06:56:44.453

这是因为创造被延迟了。如果您希望立即加载图片，您可以简单地将这段代码添加到 init 阶段。

**src.CacheOption = BitmapCacheOption.OnLoad;**

像这样：

```
src.BeginInit();
src.UriSource = new Uri("picture.jpg", UriKind.Relative);
src.CacheOption = BitmapCacheOption.OnLoad;
src.EndInit(); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-03-16T13:38:37.023

在执行程序集中加载资源的代码中，我的图像“Freq.png”位于文件夹“图标”中并定义为“资源”。

```
 this.Icon = new BitmapImage(new Uri(@"pack://application:,,,/" 
             + Assembly.GetExecutingAssembly().GetName().Name 
             + ";component/" 
             + "Icons/Freq.png", UriKind.Absolute)); 
```

如果有人愿意，我还做了一个函数......

```
/// <summary>
/// Load a resource WPF-BitmapImage (png, bmp, ...) from embedded resource defined as 'Resource' not as 'Embedded resource'.
/// </summary>
/// <param name="pathInApplication">Path without starting slash</param>
/// <param name="assembly">Usually 'Assembly.GetExecutingAssembly()'. If not mentionned, I will use the calling assembly</param>
/// <returns></returns>
public static BitmapImage LoadBitmapFromResource(string pathInApplication, Assembly assembly = null)
{
    if (assembly == null)
    {
        assembly = Assembly.GetCallingAssembly();
    }

    if (pathInApplication[0] == '/')
    {
        pathInApplication = pathInApplication.Substring(1);
    }
    return new BitmapImage(new Uri(@"pack://application:,,,/" + assembly.GetName().Name + ";component/" + pathInApplication, UriKind.Absolute)); 
} 
```

用法：

```
 this.Icon = ResourceHelper.LoadBitmapFromResource("Icons/Freq.png"); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-20T14:26:36.387

这是一种奇怪的行为，虽然我无法说明为什么会发生这种情况，但我可以推荐一些选项。

首先，一个观察。如果您将图像作为内容包含在 VS 中并将其复制到输出目录，则您的代码可以正常工作。如果图像在 VS 中标记为“无”并且您将其复制过来，则它不起作用。

解决方案 1：文件流

BitmapImage 对象接受 UriSource 或 StreamSource 作为参数。让我们改用 StreamSource。

```
 FileStream stream = new FileStream("picture.png", FileMode.Open, FileAccess.Read);
        Image i = new Image();
        BitmapImage src = new BitmapImage();
        src.BeginInit();
        src.StreamSource = stream;
        src.EndInit();
        i.Source = src;
        i.Stretch = Stretch.Uniform;
        panel.Children.Add(i); 
```

问题：流保持打开状态。如果在此方法结束时关闭它，图像将不会显示。这意味着文件在系统上保持写锁定状态。

解决方案 2：内存流

这基本上是解决方案 1，但您将文件读入内存流并将该内存流作为参数传递。

```
 MemoryStream ms = new MemoryStream();
        FileStream stream = new FileStream("picture.png", FileMode.Open, FileAccess.Read);
        ms.SetLength(stream.Length);
        stream.Read(ms.GetBuffer(), 0, (int)stream.Length);

        ms.Flush();
        stream.Close();

        Image i = new Image();
        BitmapImage src = new BitmapImage();
        src.BeginInit();
        src.StreamSource = ms;
        src.EndInit();
        i.Source = src;
        i.Stretch = Stretch.Uniform;
        panel.Children.Add(i); 
```

现在您可以修改系统上的文件，如果您需要的话。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T14:27:27.477

您可以尝试将处理程序附加到 BitmapImage 的各种事件：

*   [`DecodeFailed`](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.bitmapsource.decodefailed.aspx)
*   [`DownloadFailed`](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.bitmapsource.downloadfailed.aspx)
*   [`DownloadCompleted`](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.bitmapsource.downloadcompleted.aspx)

就图像而言，他们可能会告诉您一些正在发生的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-16T09:03:40.930

这是从 URI 加载图像的扩展方法：

```
public static BitmapImage GetBitmapImage(
    this Uri imageAbsolutePath,
    BitmapCacheOption bitmapCacheOption = BitmapCacheOption.Default)
{
    BitmapImage image = new BitmapImage();
    image.BeginInit();
    image.CacheOption = bitmapCacheOption;
    image.UriSource = imageAbsolutePath;
    image.EndInit();

    return image;
} 
```

使用示例：

```
Uri _imageUri = new Uri(imageAbsolutePath);
ImageXamlElement.Source = _imageUri.GetBitmapImage(BitmapCacheOption.OnLoad); 
```

就那么简单！

# asp.net - 在 ASP.net 中上传文件而不使用 FileUpload 服务器控件

> ID：569565
> 
> 赞同：98
> 
> 时间：2009-02-20T13:28:39.520
> 
> 标签：asp.net, upload, file-upload

如何获取 ASP.net 网络表单 (v3.5) 以使用普通的旧格式发布文件`<input type="file" />`？

我对使用 ASP.net FileUpload 服务器控件不感兴趣。

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-02-20T13:47:37.073

在你的 aspx 中：

```
<form id="form1" runat="server" enctype="multipart/form-data">
 <input type="file" id="myFile" name="myFile" />
 <asp:Button runat="server" ID="btnUpload" OnClick="btnUploadClick" Text="Upload" />
</form> 
```

在后面的代码中：

```
protected void btnUploadClick(object sender, EventArgs e)
{
    HttpPostedFile file = Request.Files["myFile"];

    //check file was submitted
    if (file != null && file.ContentLength > 0)
    {
        string fname = Path.GetFileName(file.FileName);
        file.SaveAs(Server.MapPath(Path.Combine("~/App_Data/", fname)));
    }
} 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2013-10-09T10:35:29.507

这是一个不依赖任何服务器端控制的解决方案，就像 OP 在问题中描述的那样。

客户端 HTML 代码：

```
<form action="upload.aspx" method="post" enctype="multipart/form-data">
    <input type="file" name="UploadedFile" />
</form> 
```

upload.aspx 的 Page_Load 方法：

```
if(Request.Files["UploadedFile"] != null)
{
    HttpPostedFile MyFile = Request.Files["UploadedFile"];
    //Setting location to upload files
    string TargetLocation = Server.MapPath("~/Files/");
    try
    {
        if (MyFile.ContentLength > 0)
        {
            //Determining file name. You can format it as you wish.
            string FileName = MyFile.FileName;
            //Determining file size.
            int FileSize = MyFile.ContentLength;
            //Creating a byte array corresponding to file size.
            byte[] FileByteArray = new byte[FileSize];
            //Posted file is being pushed into byte array.
            MyFile.InputStream.Read(FileByteArray, 0, FileSize);
            //Uploading properly formatted file to server.
            MyFile.SaveAs(TargetLocation + FileName);
        }
    }
    catch(Exception BlueScreen)
    {
        //Handle errors
    }
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-02-20T13:39:16.500

您必须将 to 的`enctype`属性设置`form`为`multipart/form-data`; `HttpRequest.Files`然后您可以使用集合访问上传的文件。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-20T13:39:14.847

使用带有 runat 服务器属性的 HTML 控件

```
 <input id="FileInput" runat="server" type="file" /> 
```

然后在asp.net Codebehind

```
 FileInput.PostedFile.SaveAs("DestinationPath"); 
```

如果您有兴趣，还有一些[第 3 方](http://mattberseth.com/blog/2008/07/aspnet_file_upload_with_realti_1.html)选项会显示进度

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-03-27T08:48:00.633

是的，您可以通过 ajax post 方法实现这一点。在服务器端，您可以使用 httphandler。因此，我们没有根据您的要求使用任何服务器控件。

使用 ajax 你也可以显示上传进度。

您必须将文件作为输入流读取。

```
using (FileStream fs = File.Create("D:\\_Workarea\\" + fileName))
    {
        Byte[] buffer = new Byte[32 * 1024];
        int read = context.Request.GetBufferlessInputStream().Read(buffer, 0, buffer.Length);
        while (read > 0)
        {
            fs.Write(buffer, 0, read);
            read = context.Request.GetBufferlessInputStream().Read(buffer, 0, buffer.Length);
        }
    } 
```

示例代码

```
function sendFile(file) {              
        debugger;
        $.ajax({
            url: 'handler/FileUploader.ashx?FileName=' + file.name, //server script to process data
            type: 'POST',
            xhr: function () {
                myXhr = $.ajaxSettings.xhr();
                if (myXhr.upload) {
                    myXhr.upload.addEventListener('progress', progressHandlingFunction, false);
                }
                return myXhr;
            },
            success: function (result) {                    
                //On success if you want to perform some tasks.
            },
            data: file,
            cache: false,
            contentType: false,
            processData: false
        });
        function progressHandlingFunction(e) {
            if (e.lengthComputable) {
                var s = parseInt((e.loaded / e.total) * 100);
                $("#progress" + currFile).text(s + "%");
                $("#progbarWidth" + currFile).width(s + "%");
                if (s == 100) {
                    triggerNextFileUpload();
                }
            }
        }
    } 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-20T13:43:01.217

Request.Files 集合包含随表单上传的所有文件，无论它们来自 FileUpload 控件还是手动编写的`<input type="file">`.

因此，您只需在 WebForm 中间编写一个普通的旧文件输入标记，然后读取从 Request.Files 集合上传的文件。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-05-20T21:33:10.333

正如其他人回答的那样， Request.Files 是一个 HttpFileCollection ，其中包含已发布的所有文件，您只需向该对象询问文件，如下所示：

```
Request.Files["myFile"] 
```

但是当有多个输入标记具有相同的属性名称时会发生什么：

```
Select file 1 <input type="file" name="myFiles" />
Select file 2 <input type="file" name="myFiles" /> 
```

在服务器端，前面的代码 Request.Files["myFile"] 只返回一个 HttpPostedFile 对象，而不是两个文件。我在 .net 4.5 上看到了一个名为 GetMultiple 的扩展方法，但对于以前的版本它不存在，为此我建议扩展方法为：

```
public static IEnumerable<HttpPostedFile> GetMultiple(this HttpFileCollection pCollection, string pName)
{
        for (int i = 0; i < pCollection.Count; i++)
        {
            if (pCollection.GetKey(i).Equals(pName))
            {
                yield return pCollection.Get(i);
            }
        }
} 
```

如果存在，此扩展方法将返回 HttpFileCollection 中名称为“myFiles”的所有 HttpPostedFile 对象。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-20T13:36:31.810

[HtmlInputFile 控件](http://msdn.microsoft.com/en-us/library/system.web.ui.htmlcontrols.htmlinputfile(VS.80).aspx)

我一直都在用这个。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-05-31T02:03:31.460

```
//create a folder in server (~/Uploads)
 //to upload
 File.Copy(@"D:\CORREO.txt", Server.MapPath("~/Uploads/CORREO.txt"));

 //to download
             Response.ContentType = ContentType;
             Response.AppendHeader("Content-Disposition", "attachment;filename=" + Path.GetFileName("~/Uploads/CORREO.txt"));
             Response.WriteFile("~/Uploads/CORREO.txt");
             Response.End(); 
```

# c - What is a good programming pattern for handling return values from stdio file writing functions

> ID：569573
> 
> 赞同：8
> 
> 时间：2009-02-20T13:32:55.547
> 
> 标签：c, stdio

I'm working on some code that generates a lot of

```
ignoring return value of ‘size_t fwrite(const void*, size_t, size_t, FILE*)’, declared with attribute warn_unused_result 
```

warnings when compiled with g++, and I'm wondering about the best programming pattern to actually record and handle the return value of a large number of separate sequential `fwrite`s (i.e. not the same `fwrite` in a loop)

Let's say that the code looks like this at the moment:

```
fwrite (&blah, sizeof (blah), 1, fp);
// ... more code ...
fwrite (&foo, sizeof (foo), 1, fp);
// ... more code ... 
```

I'm currently thinking about something like this, but I may have difficulty cleaning up the file pointer:

```
if (fwrite (&blah, sizeof (blah), 1, fp) != 1) return someerrorcode;
// ... more code ...
if (fwrite (&foo, sizeof (foo), 1, fp) != 1) return someerrorcode;
// ... more code ... 
```

I think that approach is clearly better than nesting, which would get too crazy too quick:

```
if (fwrite (&blah, sizeof (blah), 1, fp) == 1) {
   // ... more code ...
   if (fwrite (&foo, sizeof (foo), 1, fp) == 1) {;
      // ... more code ...
   }
} 
```

Surely there is already an established best-practice pattern for this sort of thing, though?

Of course, as I am mainly looking into this to get rid of the compiler warnings, I could just assign the return value to a dummy variable and ignore it, but I'd like to try doing it the right way first.

```
dummy = fwrite (&blah, sizeof (blah), 1, fp);
// ... more code ...
dummy = fwrite (&foo, sizeof (foo), 1, fp);
// ... more code ... 
```

**Update:** I've removed the c++ tag as this code is really just c being compiled using g++, so c based solutions are needed to keep with the rest of the code base.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-20T13:49:23.853

The poor man's C exception handling based on goto (in fact, the one and only instance of goto NOT being harmful):

```
int foo() {
    FILE * fp = fopen(...);
    ....

    /* Note: fwrite returns the number of elements written, not bytes! */
    if (fwrite (&blah, sizeof (blah), 1, fp) != 1) goto error1;

    ...

    if (fwrite (&foo, sizeof (foo), 1, fp) != 1) goto error2;

    ...

ok:
    /* Everything went fine */
    fclose(fp);
    return 0;

error1:
    /* Error case 1 */
    fclose(fp);
    return -1;

error2:
    /* Error case 2 */
    fclose(fp);
    return -2;
} 
```

You get the idea. Restructure as you wish (single/multiple returns, single cleanup, custom error messages, etc.). From my experience this is the most common C error handling pattern out there. The crucial point is: NEVER, EVER ignore stdlib return codes, and any good reason to do so (e.g. readability) is not good enough.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-20T14:02:20.343

I'd do something along these lines:

```
FILE * file = fopen("foo", "wb");
if(!file) return FAILURE;

// assume failure by default
_Bool success = 0;

do
{
    if(!fwrite(&bar, sizeof(bar), 1, file))
        break;

    // [...]

    if(!fwrite(&baz, sizeof(baz), 1, file))
        break;

    // [...]

    success = 1;
} while(0);

fclose(file);

return success ? SUCCESS : FAILURE; 
```

With a little C99 macro magic

```
#define with(SUBJECT, FINALIZE, ...) do { \
    if(SUBJECT) do { __VA_ARGS__ } while(0); if(SUBJECT) FINALIZE; \
} while(0) 
```

and using `ferror()` instead of our own error flag as suggested by Jonathan Leffler, this can be written as

```
FILE * file = fopen("foo", "wb");
with(file, fclose(file),
{
    if(!fwrite(&bar, sizeof(bar), 1, file))
        break;

    // [...]

    if(!fwrite(&baz, sizeof(baz), 1, file))
        break;

    // [...]
});

return file && !ferror(file) ? SUCCESS : FAILURE; 
```

If there are other error conditions aside from io errors, you'll still have to track them with one or more error variables, though.

~~Also, your check against `sizeof(blah)` is wrong: `fwrite()` returns the count of objects written!~~

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T13:49:50.747

You could write a wrapper function

```
void new_fwrite(a, b, c, d) {
    if (fwrite (a, b, c, b) != b) 
       throw exception;
} 
```

and then replace all calls to fwrite with new_fwrite

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T13:50:08.593

Ignoring errors is a bad idea. It's much better to do something nasty like crash the program so that at least you know something went wrong, rather than silently proceeding. Even better is nice error checking and recovery.

If you're using C++, you can create an RAII wrapper for the FILE* so that it'll always get closed. Look at std::auto_ptr for ideas. You can then return a useful error code or from the function whenever you wish, or throw an exception and not have to worry about forgotten cleanup items.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T13:42:59.470

You can remove the warnings like this:

```
(void) fwrite ( ,,,, ); 
```

Addressing your main question, if any of the fwrite() calls fail, I'd guess that it doesn't make sense to continue, as the output is presumably corrupt. In that case, and as you tagged this C++, I'd throw an exception.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T13:44:15.457

Nesting is bad, and multiple returns are not good either.

I used to use following pattern:

```
#define SUCCESS (0)
#define FAIL    (-1)
int ret = SUCCESS;

if (!fwrite(...))
    ret = FAIL;
if (SUCCESS == ret) {
    do_something;
    do_something_more;
    if (!fwrite(...))
        ret = FAIL;
}
if (SUCCESS == ret)
    do_something;

return ret; 
```

I know it looks ugly but it has single return point, no excessive nesting and very easy to maintain.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T13:46:15.077

Well ... You could create a wrapper function, that re-tries the write if it fails, perhaps up to some maximum number of retries, and returns success/failure:

```
int safe_fwrite(FILE *file, const void *data, size_t nbytes, unsigned int retries);
void print_and_exit(const char *message); 
```

Then your main code could be written as

```
#define RETRIES 5
if(!safe_fwrite(fp, &blah, sizeof blah, RETRIES))
  print_and_exit("Blah writing failed, aborting");
if(!safe_fwrite(fp, &foo, sizeof foo, RETRIES))
  print_and_exit("Foo writing failed, aborting"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T13:46:42.720

Your first solution looks ok. Usually a `goto err;` comes in more handy as you may need some common cleanup part (such as rewinding to a known position).

To make GCC quiet just do:

```
(void)fwrite (&blah, sizeof (blah), 1, fp);
(void)fwrite (&foo, sizeof (foo), 1, fp); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T13:47:01.630

Something like this would work

```
if (fwrite (&blah, sizeof (blah), 1, fp) != 1) throw SomeException; 
```

If you're worried about pointers being cleaned up you can wrap the pointer in some form of smart pointer before carrying out your fwrite's.

If you don't want to use smart pointers then this will work, but it's messy, so I'd try the smart pointer route first

```
if (fwrite (&blah, sizeof (blah), 1, fp) != 1) {
    //cleanup here
    throw SomeException;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-20T13:47:49.210

Why don’t you wrap the `fwrite` into a Writer object of some kind and throw an exception if fwrite() returns an error code? Easy to code, easy to use, easy to manage. IMHO, of course. :)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T13:53:29.227

Maybe something like this? You catch the errors without making the code too unreadable, and you can do cleanup after the end of the faux loop.

```
#define WRITE_ERROR 100
#define WRITE_OK 0

int do_fwrite(void* ptr, size_t bytes, int fp) {
  if ( fwrite(ptr, bytes, 1, fp) != bytes ) return WRITE_ERROR;
  return WRITE_OK;
}

int my_func() {
   int errcode = 0;

   ...
   do {
     if ( errcode = do_fwrite(&blah, sizeof(blah), fp) ) break;
     ....
     if ( errcode = do_fwrite(&foo, sizeof(foo), fp) ) break;
     ....
     etc
   } while( false );

   fclose(fp);
   return errcode;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-20T14:02:46.193

Ok, given that I'm looking for a `c` solution (no exceptions), how about:

```
void safe_fwrite(data,size,count,fp) {
   if (fwrite(data,size,count,fp) != count) {
      printf("[ERROR] fwrite failed!\n");
      fclose(fp);
      exit(4);
   }
} 
```

And then in my code I have:

```
safe_fwrite (&blah, sizeof (blah), 1, fp);
// ... more code ...
safe_fwrite (&foo, sizeof (foo), 1, fp);
// ... more code ... 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-20T14:10:44.647

A potentially elegant C solution for this could be something like this (warning - untested, uncompiled code ahead):

```
 size_t written;
  int    ok = 1;
  size_t num_elements = x;
  ok = (fwrite(stuff, sizeof(data), num_elements, outfile) == num_elements);

  if (ok) {
    ... do other stuff ...
  }

  ok = ok && (fwrite(stuff, sizeof(data), num_elements, outfile) == num_elements);

  if (ok) {
    ... etc etc ad nauseam ...
  }

  fclose(outfile);

  return ok; 

```

The above accomplishes two goals at the same time:

*   Return values are checked, thus eliminating the warning and giving you the ability to return a status code.
*   Thanks to the short circuit evaluation, should one of the fwrite() calls fail, the subsequent ones will not be executed, so at least the file write stops instead of giving you a potentially corrupt file if the error condition disappears halfway through the function and you're able to write data again

Unfortunately the 'ugly' `if (ok)` blocks are necessary if you don't want to use the short-circuit evaluation everywhere. I've seen this pattern used in comparatively small functions using short circuit evaluation everywhere and I would think that it's probably best suited to that particular use.

# javascript - 在thickbox中提交表单

> ID：569595
> 
> 赞同：2
> 
> 时间：2009-02-20T13:43:32.340
> 
> 标签：javascript, jquery, thickbox

当用户单击提交表单数据提交到我的 php 时，我希望在thickbox 中打开一个联系表单，该表单将处理该数据并将成功的消息显示回thickbox。php页面被调用，但我将如何获取表单数据？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T14:57:36.217

首先使用thickbox 的iframe 功能将表单加载到thickbox 中。通过将其放在文档的 HTML 头中，确保您已加载 jquery 和thickbox：

```
<script type="text/javascript" src="/javascripts/jquery.js"></script>
<script type="text/javascript" src="/javascripts/thickbox.js"></script>
<link href="/stylesheets/thickbox.css" rel="stylesheet" type="text/css" /> 
```

然后在 iframe 中加载联系我们表单的页面上放置一个链接：

```
<a href="/contact_us_form.php?KeepThis=true&TB_iframe=true&height=400&width=600&modal=true" class="thickbox" title="Contact Us">Contact Us</a> 
```

您的表单应该具有具有以下基本结构的标记：

```
<div id="content">
  <form id="contact_us" action="/contact_us.php" method="POST">
     ...
  </form>
</div> 
```

现在通过 AJAX 将 jQuery 用于您的表单。把它放在 HTML 文档的头部：

```
<script type="text/javascript">
  jQuery(function($){
    $('#contact_us').submit(function(){ 
      $.post($(this).attr('action'), function(html) { 
        $('#content').html(html)
      })
      return false
    })
  })
</script> 
```

这是做什么的：

1.  向表单添加一个函数，以便在提交表单时调用。它返回 false 以防止发生表单提交的默认行为。

2.  此提交功能将使用您设置为的表单操作执行 AJAX 发布`contact_us.php`。

3.  最后，这将获取`contact_us.php`返回的任何内容并将 div 的内容替换为 id 内容。

所以让你的`contact_us.php`脚本实际发送电子邮件或创建一个数据库记录，不管它做什么，然后让它返回这个 HTML：

```
<p>Thank you for your submission!</p>

<p><a href="#" onclick="window.parent.tb_remove(); return false">Continue</a> 
```

显然，这可以是您想要的任何内容，您希望最终用户看到的任何消息。该链接向您展示了如何使厚盒窗口消失。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-22T05:45:11.693

要发布表单数据，需要使用 jQuery 的序列化函数。

修改上面的例子：

```
$.post($(this).attr('action'), $(this).serialize(), function(html) { 
    $('#content').html(html);
}); 
```

# mod-rewrite - mod_rewrite - 旧参数名称到新名称

> ID：569600
> 
> 赞同：1
> 
> 时间：2009-02-20T13:44:20.573
> 
> 标签：mod-rewrite, parameters

大家好，我需要一些在 mod_rewrite 中工作的重定向。

我需要重定向以下内容

```
http://mysite.com/dictionary/find?word=test 
```

至

```
http://mysite.com/dictionary/find?w=test 
```

我确信解决方案足够简单，但我对 mod_rewrite 和正则表达式的了解非常有限，而且我无法解决。这是我迄今为止所尝试的无济于事。

```
RewriteCond %{QUERY_STRING} word= [NC]
RewriteRule ^/(.*)word=(\w+)/$ /w=$1 [L] 
```

任何帮助将非常感激。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T13:53:09.413

这对你来说应该足够了......

重写规则 (?|&)word=(\w+) $1w=$2

即使与其他参数结合使用，这也将替换它。您尝试仅处理查询字符串很有趣，我从未使用过它，并且无法回答是否可能。

作为旁注，打开：

RewriteLog "/var/log/apache2/rewrite.log"
RewriteLogLevel 2

以获得更多有用的反馈。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T21:22:51.440

尝试这个：

```
RewriteCond %{QUERY_STRING} ^(([^&]*&)*)word=(.*)
RewriteRule ^dictionary/find$ $0?%1w=%3 [R=301,L] 
```

# matlab - 没有框架的依赖注入

> ID：569601
> 
> 赞同：9
> 
> 时间：2009-02-20T13:44:23.397
> 
> 标签：matlab, dependency-injection

我正在 MATLAB 中编写一个中型分析程序（5-10kloc）（不是我的决定），并且我正在尝试使用依赖注入来使我的代码更具可测试性。我想我了解基本的对象/构造函数注入模型，但我对这如何扩大依赖关系图感到困惑。

例如，如果我有对象 A，它有一个对象 B，它有一个对象 C，并且对象 C 有一个需要注入的依赖项，我是否需要通过整个链传递它？最终，由于这是一个数据分析程序，一切基本上都回到了一个 AnalyzeData 对象/方法，这是否意味着该对象必须注入整个程序的所有依赖项？

也许答案只是在这种情况下使用 ServiceFactory/ServiceProvider，但我想知道是否可以在没有框架的情况下将许多依赖项扩展到大型对象图。

此外，鼓励对我的想法/措辞/基本原理进行更正——我基本上是通过 Google/HN/SO 学习到的大部分内容。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T14:05:20.057

与 Matlab 无关的答案：

如果（A 需要 B）和（B 需要 C），那么您首先创建 C，然后创建 B 并将 C 传递给 B。然后创建 A 并将（B 有 C）传递给 A。

现在，如果 C 需要注入依赖项，则将其称为 D，您仍然可以在此事件序列之后使用 setter 注入来执行此操作。如果依赖项对于 C 来说是可选的，就会出现这种情况。否则，在程序初始化中可能存在缺陷，即 C 在传递给 B*之前没有注入 D。*

如果您想在已经拥有（A 拥有（B 拥有 C））之后使用构造函数注入将 D 注入 C，那么您必须使用 setter 注入将新的（C 拥有 D）传递给 B，但是这个序列事件的数量通常不是 DI 的有效场景。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T16:33:04.833

*免责声明：OO 语言不可知的答案*

不，您不需要通过整个对象图传递依赖关系。不必实例化具体类型或将它们作为参数传递是 DI 的重点。通常，您将拥有一些其他实体，例如称为 Assembler，它将注入这些依赖项。汇编器可以是临时的、手写的，也可以是一些 DI 框架。

例如：

*   类 ClsA 具有类型接口 IB 的属性。
*   ClsB 类实现 IB 并具有类型接口 IC 的属性。
*   ClsC 类实现 IC。

您的汇编程序将引导应用程序并：

1.  创建名为 oC 的 ClsC 类实例
2.  创建名为 oB 的 ClsB 实例并将其注入 oC
3.  创建名为 oA 的实例并将其注入 oB

您所有的域对象都只知道接口。Assembler 知道所有的对象，但它的目的只是创建对象图并让所有东西都运动起来。手写汇编程序非常合适；有些人更喜欢编写接线代码而不是使用配置文件。如果您不打算多次使用它，请不要认为编写汇编程序（DI 框架）是值得的。关键是你的类是用 DI 方式编写的。

看看这篇文章： http: [//books.google.com/books ?id=vRxAnRb3mb4C&pg=PP1&dq=Danijel+Arsenovski#PPA428,M1](http://books.google.com/books?id=vRxAnRb3mb4C&pg=PP1&dq=Danijel+Arsenovski#PPA428,M1)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T14:00:19.723

滚动您自己的 IoC 容器，您可以在其中请求您的依赖项而无需注入它们，或者使用静态网关模式获取单例以使用工厂动态创建类。

我发现这个视频对这些主题非常有用 - [http://www.dnrtv.com/default.aspx?showNum=126](http://www.dnrtv.com/default.aspx?showNum=126)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T14:04:43.973

如果你手动进行依赖注入，你最好不要传递依赖。您只需使用其依赖项创建 C，使用 C 创建 B，使用 B 创建 A。A 无需了解有关 C 或其依赖项的任何信息。它只知道 B 的接口，并且通常依赖项不是对象接口的一部分。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T16:34:10.727

如果我正确理解您的问题，答案可能取决于您如何创建实例化对象的类。在最新版本的 MATLAB 中，可以通过两种方式定义类：“值”类或“句柄”类（[此处](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_oop/ug_intropage.html)的 MATLAB 文档）。从文档中引用：

*   **值类：** “值类的对象与分配给它们的变量永久关联。复制值对象时，也会复制对象的数据，并且新对象与原始对象的更改无关。实例的行为类似于标准MATLAB 数值和结构类。”

*   **句柄类：** “句柄类的对象使用句柄来引用类的对象。句柄是标识类的特定实例的变量。当句柄对象被复制时，句柄被复制，而不是其中存储的数据对象的属性。副本指的是与原始对象相同的数据——如果您更改原始对象的属性值，则复制的对象会反映相同的更改。

下面的示例代码提供了一些示例，说明如何与上面描述的“嵌套”对象进行交互，包括值类嵌套对象和句柄类嵌套对象：

```
% For value classes:

objC = C(...);  % Make an object of class C, where "..." stands
                %   for any input arguments
objB = B(...,objC);  % Make an object of class B, passing it objC
                     %   and placing objC in field 'objC'
objA = A(...,objB);  % Make an object of class A, passing it objB
                     %   and placing objB in field 'objB'

% If the '.' operator (field access) is defined for the objects:

objA.objB.objC.D = 1;  % Set field 'D' in objC to 1
objA.objB.objC = foo(objA.objB.objC,...);  % Apply a method that
                                           %   modifies objC and
                                           %   returns the new
                                           %   object 
```

* * *

```
% For handle classes:

hC = C(...);  % Get a handle (reference) for a new object of class C
hB = B(...,hC);  % Get a handle for a new object of class B,
                 %   passing it handle hC and placing it in field 'hC'
hA = A(...,hB);  % Get a handle for a new object of class A,
                 %   passing it handle hB and placing it in field 'hB'

% If the '.' operator (field access) is defined for the objects:

hC.D = 1;  % Set field 'D' to 1 for object referenced by hC; Note
           %   that hC and hA.hB.hC both point to same object, and
           %   can thus be used interchangably
foo(hC);  % Apply a method that modifies the object referenced by hC

% If instead using get/set methods for the handle object:

set(hC,'D',1);
set(get(get(hA,'hB'),'hC'),'D',1);  % If variable hC wasn't made, get
                                    %   reference from nested objects
foo(hC);
foo(get(get(hA,'hB'),'hC')); 
```

如您所见，使用句柄类可以通过将句柄（本质上是指针）的副本存储在另一个变量中来帮助您避免将函数调用和字段引用链接起来。句柄类还消除了用对这些对象进行操作的方法返回的新副本覆盖对象的旧副本的需要。

希望这对您的要求有所帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T14:11:36.937

对Matlab一无所知，但我假设（从你的话）有对象。如果是这样，请使用[服务定位器](http://martinfowler.com/articles/injection.html#UsingAServiceLocator)而不是依赖注入。服务定位器实现起来非常简单，因此不需要框架。

# c# - 在 C# 应用程序中使用 C++ 类 DLL

> ID：569603
> 
> 赞同：46
> 
> 时间：2009-02-20T13:44:55.673
> 
> 标签：c#, dll, c++-cli, unmanaged

我有一个非托管 C++ DLL，它只导出一个类（不是 COM ......它只是一个简单的 C++ 类）作为它的接口。我想在 C# 中使用这个类，但被告知它不能仅仅导入到 C# 中。

在我的 C# 应用程序中使用此类的正确方法是什么？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-02-20T13:53:43.033

假设类 Foo 的简单方法：

1.  创建一个 C++/CLI 项目，调用这个 FooWrapper。
2.  使 FooWrapper 依赖于非托管的 dll（但是你通常会这样做）。
3.  创建一个托管类 ManagedFoo，其中包含一个 Foo* 类型的私有实例字段。
4.  在 ManagedFoo 中提供公共包装函数，这些函数转发到底层实例字段。
5.  可选（尽管推荐）：
    *   将参数从 .net 惯用语（字符串等）转换为 C++ 惯用语（std::string 或 char*）
    *   捕获非托管异常并抛出托管异常

然后你让你的 c# 代码依赖于 FooWrapper 项目/dll 并确保非托管 dll 与它一起正确部署，如何完成取决于非托管 dll 但在同一目录中通常就足够了。

如果函数不依赖于类的实例，那么更简单的是 P/Invoke

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-20T14:24:35.877

对于单个类库来说，这个答案可能有点矫枉过正，但 SWIG 是一个很好的解决方案，可以“包装”C/C++ 类以供其他语言使用。它适用于 C#。

*看* [http://www.swig.org/](http://www.swig.org/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T15:18:24.780

DllImport 是您最好的选择。有一些数据类型按摩，特别是如果你传递结构，但你几乎可以用它做任何事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T13:55:12.450

您需要一个代理（GoF 模式）中介来桥接托管/非托管边界。

两种选择：

*   C++/CLI 包装器
*   COM 包装器。

前者会更直接，后者有两个步骤pure C++ -> COM -> .NET。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T21:01:22.800

有时，提供自己的 C 接口会更容易。 [SWIG](http://www.swig.org/)的设置并非易事。我使用了托管 C++ 和 C++/CLI，它们都很好。最简单的就是做一个 C 包装器（并且可以被任何其他语言使用，因为大多数语言都有调用 C 函数的方法）。

# c# - 如何使用 Visual c# Express 制作服务应用程序？

> ID：569606
> 
> 赞同：18
> 
> 时间：2009-02-20T13:46:38.057
> 
> 标签：c#, service

我已经构建了一个应用程序来解析用于在 mssql 数据库中集成数据的 XML 文件。我正在使用 Visual c# express。有一种方法可以使用快速版提供服务，还是我必须让 Visual Studio 来做？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-02-20T13:52:10.400

绝对可以。您甚至可以使用`csc`. VS 中唯一的东西就是**模板**。但是您可以自己引用 System.ServiceProcess.dll。

关键点：

*   编写一个继承自的类`ServiceBase`
*   在你的`Main()`，使用`ServiceBase.Run(yourService)`
*   在`ServiceBase.OnStart`覆盖中，生成您需要完成工作的任何新线程等（`Main()`需要立即退出或算作启动失败）

## 示例代码

非常基本的模板代码是：

**程序.cs**：

```
using System;
using System.ServiceProcess;

namespace Cron
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        static void Main()
        {
            System.ServiceProcess.ServiceBase.Run(new CronService());
        }
    }
} 
```

**CronService.cs**：

```
using System;
using System.ServiceProcess;

namespace Cron
{
    public class CronService : ServiceBase
    {
        public CronService()
        {
            this.ServiceName = "Cron";
            this.CanStop = true;
            this.CanPauseAndContinue = false;
            this.AutoLog = true;
        }

        protected override void OnStart(string[] args)
        {
           // TODO: add startup stuff
        }

        protected override void OnStop()
        {
           // TODO: add shutdown stuff
        }
    }
} 
```

**CronInstaller.cs**：

```
using System.ComponentModel;
using System.Configuration.Install;
using System.ServiceProcess;

[RunInstaller(true)]
public class CronInstaller : Installer
{
  private ServiceProcessInstaller processInstaller;
  private ServiceInstaller serviceInstaller;

  public CronInstaller()
  {
    processInstaller = new ServiceProcessInstaller();
    serviceInstaller = new ServiceInstaller();

    processInstaller.Account = ServiceAccount.LocalSystem;
    serviceInstaller.StartType = ServiceStartMode.Manual;
    serviceInstaller.ServiceName = "Cron"; //must match CronService.ServiceName

    Installers.Add(serviceInstaller);
    Installers.Add(processInstaller);
  } 
} 
```

并且 .NET 服务应用程序的安装方式与普通服务应用程序不同（即您不能使用`cron.exe /install`或其他一些命令行参数。相反，您必须使用 .NET SDK 的`InstallUtil`：

```
InstallUtil /LogToConsole=true cron.exe 
```

## 资源

*   Mark Strawmyer[在 .NET 中创建 Windows 服务](http://www.codeguru.com/csharp/csharp/cs_network/windowsservices/article.php/c6027/)
*   Dave Fetterman[在五分钟内用 .NET 编写有用的 Windows 服务](http://blogs.msdn.com/b/bclteam/archive/2005/03/15/396428.aspx)
*   [安装和卸载服务](http://msdn.microsoft.com/en-us/library/aa984379%28v=vs.71%29.aspx)
*   [演练：在组件设计器中创建 Windows 服务应用程序](http://msdn.microsoft.com/en-us/library/aa984464%28v=vs.71%29.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T13:55:29.720

您可以尝试使用 Visual Web Developer Express 以及用于 Web 服务的 coding4fun 开发人员工具包库（通过托管代码包装器）：-

[http://www.microsoft.com/express/samples/c4fdevkit/default.aspx](http://www.microsoft.com/express/samples/c4fdevkit/default.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T13:55:50.390

Express版可以编写和编译Windows Service项目，但不能正常创建。唯一简单的方法是在 Visual Studio 中创建一个新的服务项目，然后将项目文件复制到使用 Express Edition 的机器上。之后，您不再需要 Visual Studio。

有3种方法可以做到这一点：

*   使用 Visual Studio 转到机器并创建项目
*   谷歌一个创建服务的在线教程和下载项目源代码
*   下载并安装 Visual Studio 的 90 天试用版以创建项目

但是，您仍然会遇到一些困难，例如，如果您想重命名您的项目，或者不必为每个新服务重复此操作。最好的长期解决方案是让老板最终支付标准版或专业版的副本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T13:57:30.590

根据[这篇](http://msdn.microsoft.com/en-us/library/d56de412(VS.80).aspx)MSDN 文章，您没有服务的项目模板。但我很确定，如果您知道模板为您做了什么，您就可以创建和编译服务。

# c# - 放气流中的输出文件上的 InvalidArgument

> ID：569614
> 
> 赞同：0
> 
> 时间：2009-02-20T13:48:08.053
> 
> 标签：c#, .net

我想使用放气流放气文件。

下面是我正在使用的代码。

使用 (oZipper = new DeflateStream(outputFile, CompressionMode.Compress))

其中 oZipper 是一个文件流。

当我进入上面的代码行时（使用（oZipper ...），抛出异常：

基本流不可写，InvalidArgumentException。参数：stream(outputFile，即文件流)。

知道这是为什么吗？我的代码似乎很好，我传递了正确的东西。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T13:51:28.450

您是如何打开 FileStream 的？听起来您打开它是为了阅读而不是写作。

编辑：所以这更像是一个答案......

GSS 使用 File.Create 打开 FileOutputStream，但在使用它创建 DeflateStream 之前*关闭了流。*这阻止了 DeflateStream 写入输出流，因此出现了问题。删除关闭电话解决了这个问题。

# graceful-degradation - Web 应用程序域外的优雅降级：问题有多严重？

> ID：569629
> 
> 赞同：6
> 
> 时间：2009-02-20T13:51:58.230
> 
> 标签：graceful-degradation, progressive-enhancement

*为冗长的介绍道歉 - 只是试图适当地设置场景以避免歧义和混乱。*

Web 应用程序已经从用于服务器端逻辑的基于浏览器的笨接口发展为完全基于浏览器的应用程序，对服务器端逻辑的需求最少。可以通过识别清晰的 Web 应用程序代来描述这种演变。

让我们暂时只考虑两代：前 ajax 和后 ajax。当然还有其他因素，例如与 CSS 支持和访问控制标头相关的因素，但让我们从简单的开始。

从无样式、无 JavaScript 的简单系统开始，添加优雅降级的增强层并使用 ajax 打包、响应迅速的现代应用程序完成是一项具有挑战性且容易出错的任务。这绝非易事。

Web 应用程序可能属于哪一代取决于访问该应用程序的方式。如果通过 Lynx 访问，同样的 Web 应用程序似乎是第一代应用程序，如果通过 FireFox 3.1 访问，则似乎是最新一代应用程序，中间有几个级别，具体取决于用于访问应用程序的用户代理。

创建一个根据用户代理的功能优雅降级的 Web 应用程序的问题，其中为利用当前浏览器功能而创建的东西将恢复到*可能在 15 年前*在面对 Lynx 时创建的东西的功能，这是非常困难的.

我无法想象一个桌面应用程序会面临这样的操作环境变化。

能够利用 Vista 中的功能的单个可执行文件（相对于一组特定于操作系统的变体）在 XP 下运行和缺少某些 Vista 功能时可能会很好地应对。要在与 Web 应用程序相当的距离内降级，相同的桌面应用程序在 DOS 等纯命令行环境中运行时仍必须运行，尽管方式不那么花哨。

在 Lynx 下运行它，它是第一代 Web 应用程序。在 FireFox 3.1 下运行相同的程序，这是一款精美、闪亮的现代网络应用程序。如果遇到这样的问题，你会认为它具有挑战性、棘手但可行。

在 DOS 下运行它，它是一个命令行应用程序。在 Vista 下运行它，它是一个花哨、闪亮的现代网络应用程序。如果遇到这样的问题，你会认为它很疯狂。或者你会吗？

**桌面应用程序是否曾经像 Web 应用程序那样在操作环境中面临如此广泛的变化？**

**这个问题（方差的广度，而不是方差本身）是 Web 应用程序领域独有的，还是可以在桌面开发中找到？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T14:00:06.683

桌面应用程序在这方面没有 Web 应用程序存在的相同问题。它们通常被设计为在一个定义明确的平台上运行。

这在未来可能会改变。计算正在从台式机转移到手机和更小的笔记本电脑。未来桌面应用程序将不得不在更广泛的平台上运行。这可能会导致问题，因为我们用于开发桌面应用程序的大多数框架都比 Web 应用程序框架更糟糕。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T14:24:24.767

> 我无法想象一个桌面应用程序会面临这样的操作环境变化。

桌面应用程序必须处理不同类型的差异。游戏中的显卡就是一个很好的例子：您希望为基本客户提供体面的支持，但您拥有闪亮的新显卡的高端客户会想要为他们的钱奔波。当您进入 GPU 处理和卡上内存管理领域时，您将有足够的理由诅咒操作环境中的差异。

您通常还处理比网络应用程序更多的处理器和内存密集型软件，因此您也必须考虑到这一点。而且我什至没有谈论跨操作系统的可操作性（许多桌面软件处理得非常优雅）。

当然，没有什么能让桌面软件发行商对环境施加严格的标准。这只是业务问题。但也没有什么能强迫你支持非主流浏览器（大多数 Web 应用程序真的支持 Lynx 吗？！？）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T13:56:41.137

在应用程序和操作系统 (OS) 领域，问题通常是相反的。操作系统负责处理维护兼容性的所有复杂性。另一方面，应用程序通常规定*最低*操作系统版本。

应用程序开始看到这个问题的另一个地方是 Java 世界，以及在较小程度上可以在多操作系统上工作的所有其他所谓的脚本语言。

# sql - 组织 ID 字段作为复合主键

> ID：569643
> 
> 赞同：4
> 
> 时间：2009-02-20T13:57:08.517
> 
> 标签：sql, sql-server, performance, nhibernate, database-design

我们目前有一个系统，每个客户在注册时都会获得自己的数据库。毫不奇怪，这已经失控了。

我们正在准备将所有这些数据库合并到一个数据库中。为此，我们需要注意该行所属的组织。这在数据库上处理得如何最好，以下方法有哪些优点/缺点（速度、可维护性等）？

**选项 1**：将组织 ID 设为所有表并使其成为主键的一部分（使所有键成为复合键）。

**选项 2**：将组织 ID 作为具有组织表外键的列添加到所有表。

**选项3**：别的。

我们正在考虑通过这一举措迁移到 NHibernate，如果这对所做的事情有影响的话。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T14:07:22.377

选项 1 和 2 不是相互排斥的，您应该两者都做。组织上的外键约束有助于确保您的组织键有效。复合主键是实现唯一性的唯一方法，除非您想重新设置所有记录的键，而且它对于查找性能也很有价值。或者，您必须在组合数据上创建一个新的主键列，例如一个标识列。这样的改变可能需要在其他地方进行更多的改变。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T14:02:29.220

我工作的公司使用选项 2，速度和可维护性并不是太大的问题。至于速度，只要您正确设置索引，您的查询应该会非常快。为了可维护性，我会说选项 2 与您现在处理的相比绝对是朝着正确方向迈出的一步。它真的很容易使用，您所要做的就是加入您的查询，您可以添加您需要的任何客户信息。

Cdonner 提出了一个很好的观点。在您将要查询的那些表中，最好有一个复合键。如果您正确索引表，它们可以帮助提高查询性能

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T14:05:12.600

我想我会选择＃2，但这取决于您的主键在您的表上的样子，以及如果组织 ID 不在键中，您是否必须担心冲突。

不过，请确保将其编入索引，因为您可能会将其包含在许多查询中！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T14:38:50.710

使用这种设计，您肯定会严重破坏所有查询。您需要为**每个**查询再添加一个字段，而您将忘记为最重要的一个字段执行此操作。

`GUID`所以如果你仍然想加入你的数据库，你真的真的需要使用s 。这将大大简化过渡。

当然，如果您不将主键用于`ordering`.

如果你这样做了，你需要添加你想要的这个字段，或者，更可取的是，添加一个虚假的排序自动增量字段并仍然使用`GUID`'s 作为主键。

# python - PyQt：如何在不冻结 GUI 的情况下更新进度？

> ID：569650
> 
> 赞同：20
> 
> 时间：2009-02-20T14:00:06.153
> 
> 标签：python, multithreading, user-interface, pyqt, qthread

## **问题：**

1.  在不锁定 GUI（“无响应”）的情况下跟踪线程进度的最佳做法是什么？
2.  一般来说，线程在 GUI 开发中的最佳实践是什么？

## **问题背景：**

*   我有一个适用于 Windows 的 PyQt GUI。
*   它用于处理 HTML 文档集。
*   处理一组文档需要三秒到三个小​​时不等。
*   我希望能够同时处理多个集合。
*   我不希望 GUI 锁定。
*   我正在寻找线程模块来实现这一点。
*   我对线程比较陌生。
*   GUI 有一个进度条。
*   我希望它显示所选线程的进度。
*   如果已完成，则显示所选线程的结果。
*   我正在使用 Python 2.5。

**我的想法：**让线程在更新进度时发出 QtSignal 触发一些更新进度条的功能。完成处理时也会发出信号，以便显示结果。

```
#NOTE: this is example code for my idea, you do not have
#      to read this to answer the question(s).

import threading
from PyQt4 import QtCore, QtGui
import re
import copy

class ProcessingThread(threading.Thread, QtCore.QObject):

    __pyqtSignals__ = ( "progressUpdated(str)",
                        "resultsReady(str)")

    def __init__(self, docs):
        self.docs = docs
        self.progress = 0   #int between 0 and 100
        self.results = []
        threading.Thread.__init__(self)

    def getResults(self):
        return copy.deepcopy(self.results)

    def run(self):
        num_docs = len(self.docs) - 1
        for i, doc in enumerate(self.docs):
            processed_doc = self.processDoc(doc)
            self.results.append(processed_doc)
            new_progress = int((float(i)/num_docs)*100)

            #emit signal only if progress has changed
            if self.progress != new_progress:
                self.emit(QtCore.SIGNAL("progressUpdated(str)"), self.getName())
            self.progress = new_progress
            if self.progress == 100:
                self.emit(QtCore.SIGNAL("resultsReady(str)"), self.getName())

    def processDoc(self, doc):
        ''' this is tivial for shortness sake '''
        return re.findall('<a [^>]*>.*?</a>', doc)

class GuiApp(QtGui.QMainWindow):

    def __init__(self):
        self.processing_threads = {}  #{'thread_name': Thread(processing_thread)}
        self.progress_object = {}     #{'thread_name': int(thread_progress)}
        self.results_object = {}      #{'thread_name': []}
        self.selected_thread = ''     #'thread_name'

    def processDocs(self, docs):
        #create new thread
        p_thread = ProcessingThread(docs)
        thread_name = "example_thread_name"
        p_thread.setName(thread_name)
        p_thread.start()

        #add thread to dict of threads
        self.processing_threads[thread_name] = p_thread

        #init progress_object for this thread
        self.progress_object[thread_name] = p_thread.progress  

        #connect thread signals to GuiApp functions
        QtCore.QObject.connect(p_thread, QtCore.SIGNAL('progressUpdated(str)'), self.updateProgressObject(thread_name))
        QtCore.QObject.connect(p_thread, QtCore.SIGNAL('resultsReady(str)'), self.updateResultsObject(thread_name))

    def updateProgressObject(self, thread_name):
        #update progress_object for all threads
        self.progress_object[thread_name] = self.processing_threads[thread_name].progress

        #update progress bar for selected thread
        if self.selected_thread == thread_name:
            self.setProgressBar(self.progress_object[self.selected_thread])

    def updateResultsObject(self, thread_name):
        #update results_object for thread with results
        self.results_object[thread_name] = self.processing_threads[thread_name].getResults()

        #update results widget for selected thread
        try:
            self.setResultsWidget(self.results_object[thread_name])
        except KeyError:
            self.setResultsWidget(None) 
```

对此方法的任何评论（例如缺点、陷阱、赞美等）都将受到赞赏。

## **解析度：**

我最终使用 QThread 类和相关的信号和插槽在线程之间进行通信。这主要是因为我的程序已经将 Qt/PyQt4 用于 GUI 对象/小部件。该解决方案还需要对我现有的代码进行较少的更改来实现。

这是一篇适用的 Qt 文章的链接，该文章解释了 Qt 如何处理线程和信号，[http://www.linuxjournal.com/article/9602](http://www.linuxjournal.com/article/9602)。摘录如下：

> 幸运的是，Qt 允许跨线程连接信号和槽——只要线程运行它们自己的事件循环。与发送和接收事件相比，这是一种更简洁的通信方法，因为它避免了所有重要的应用程序中都需要的所有簿记和中间 QEvent 派生类。线程之间的通信现在变成了将信号从一个线程连接到另一个线程的槽的问题，线程之间交换数据的互斥和线程安全问题由 Qt 处理。
> 
> 为什么有必要在要连接信号的每个线程中运行一个事件循环？原因与 Qt 在将信号从一个线程连接到另一个线程的插槽时使用的线程间通信机制有关。当建立这样的连接时，它被称为排队连接。当信号通过排队连接发出时，下一次执行目标对象的事件循环时调用插槽。如果槽被另一个线程的信号直接调用，则该槽将在与调用线程相同的上下文中执行。通常，这不是您想要的（尤其是如果您使用数据库连接，则不是您想要的，因为数据库连接只能由创建它的线程使用）。排队的连接将信号正确地分派给线程对象，并通过搭载事件系统在其自己的上下文中调用其槽。这正是我们想要的线程间通信，其中一些线程正在处理数据库连接。Qt 信号/槽机制在根本上是上述线程间事件传递方案的实现，但具有更清洁和更易于使用的接口。

**注意：** *eliben*也有一个很好的答案，如果我不使用处理线程安全和互斥的 PyQt4，他的解决方案将是我的选择。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-22T01:33:00.037

如果你想使用信号来指示主线程的进度，那么你真的应该使用 PyQt 的 QThread 类而不是 Python 线程模块中的 Thread 类。

PyQt Wiki 上有一个使用 QThread、信号和槽的简单示例：

[https://wiki.python.org/moin/PyQt/Threading,_Signals_and_Slots](https://wiki.python.org/moin/PyQt/Threading,_Signals_and_Slots)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-19T21:21:59.003

本机 python 队列将不起作用，因为您必须阻塞队列 get()，这会破坏您的 UI。

Qt本质上在内部实现了一个队列系统，用于跨线程通信。尝试从任何线程调用此调用以发布对插槽的调用。

QtCore.QMetaObject.invokeMethod()

它很笨重，文档记录也很差，但它应该可以做你想做的事情，即使是来自非 Qt 线程。

您也可以为此使用事件机制。有关名为“post”之类的方法，请参见 QApplication（或 QCoreApplication）。

编辑：这是一个更完整的例子......

我基于 QWidget 创建了自己的类。它有一个接受字符串的槽；我这样定义它：

```
@QtCore.pyqtSlot(str)
def add_text(self, text):
   ... 
```

稍后，我在主 GUI 线程中创建了这个小部件的实例。从主 GUI 线程或任何其他线程（敲木头）我可以调用：

```
QtCore.QMetaObject.invokeMethod(mywidget, "add_text", QtCore.Q_ARG(str,"hello world")) 
```

笨重，但它能让你到达那里。

担。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-21T07:18:06.127

我建议您使用队列而不是信号。就我个人而言，我发现它是一种更加健壮和易于理解的编程方式，因为它更加同步。

线程应该从队列中获取“作业”，并将结果放回另一个队列。然而，线程可以使用第三个队列来获取通知和消息，例如错误和“进度报告”。一旦以这种方式构建代码，管理起来就会变得更加简单。

这样，一组工作线程也可以使用单个“作业队列”和“结果队列”，它将来自线程的所有信息路由到主 GUI 线程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T05:44:14.730

如果您的方法“processDoc”没有更改任何其他数据（只是查找一些数据并返回它并且不更改父类的变量或属性），您可以在其中使用 Py_BEGIN_ALLOW_THREADS 和 Py_END_ALLOW_THREADS 宏（[有关详细信息，请参见此处](http://www.python.org/doc/2.4/api/threads.html)）。因此文档将在不会锁定解释器的线程中处理，并且 UI 将被更新。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-08-26T12:52:23.007

下面是一个基本的 PyQt5/PySide2 示例，展示了如何在更新进度条的同时运行后台任务。该任务被移至工作线程，并使用自定义信号与主 GUI 线程进行通信。任务可以停止和重新启动，并在窗口关闭时自动终止。

```
# from PySide2 import QtCore, QtWidgets
#
# class Worker(QtCore.QObject):
#     progressChanged = QtCore.Signal(int)
#     finished = QtCore.Signal()

from PyQt5 import QtCore, QtWidgets

class Worker(QtCore.QObject):
    progressChanged = QtCore.pyqtSignal(int)
    finished = QtCore.pyqtSignal()

    def __init__(self):
        super().__init__()
        self._stopped = True

    def run(self):
        count = 0
        self._stopped = False
        while count < 100 and not self._stopped:
            count += 5
            QtCore.QThread.msleep(250)
            self.progressChanged.emit(count)
        self._stopped = True
        self.finished.emit()

    def stop(self):
        self._stopped = True

class Window(QtWidgets.QWidget):
    def __init__(self):
        super().__init__()
        self.button = QtWidgets.QPushButton('Start')
        self.button.clicked.connect(self.handleButton)
        self.progress = QtWidgets.QProgressBar()
        layout = QtWidgets.QVBoxLayout(self)
        layout.addWidget(self.progress)
        layout.addWidget(self.button)
        self.thread = QtCore.QThread(self)
        self.worker = Worker()
        self.worker.moveToThread(self.thread)
        self.worker.finished.connect(self.handleFinished)
        self.worker.progressChanged.connect(self.progress.setValue)
        self.thread.started.connect(self.worker.run)

    def handleButton(self):
        if self.thread.isRunning():
            self.worker.stop()
        else:
            self.button.setText('Stop')
            self.thread.start()

    def handleFinished(self):
        self.button.setText('Start')
        self.thread.quit()

    def closeEvent(self, event):
        self.worker.stop()
        self.thread.quit()
        self.thread.wait()

if __name__ == '__main__':

    import sys
    app = QtWidgets.QApplication(sys.argv)
    window = Window()
    window.setWindowTitle('Threaded Progress')
    window.setGeometry(600, 100, 250, 50)
    window.show()
    sys.exit(app.exec_()) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T18:43:44.160

在 Python 中你总是会遇到这个问题。谷歌 GIL “全局解释器锁”了解更多背景信息。有两种通常推荐的方法来解决您遇到的问题：使用[Twisted](http://twistedmatrix.com/trac/)或使用类似于2.5 中引入的[多处理模块的模块。](http://docs.python.org/library/multiprocessing.html)

Twisted 将要求您学习异步编程技术，这在开始时可能会令人困惑，但如果您需要编写高吞吐量的网络应用程序会很有帮助，并且从长远来看对您更有利。

多处理模块将派生一个新进程并使用 IPC 使其表现得就像您拥有真正的线程一样。唯一的缺点是您需要安装相当新的 python 2.5，它默认包含在大多数 Linux 发行版或 OSX 中。

# javascript - 如何在其成员函数之一中引用对象？

> ID：569654
> 
> 赞同：1
> 
> 时间：2009-02-20T14:01:19.783
> 
> 标签：javascript, oop, this

我有以下内容：

```
var o = {f: function(fn) {
    fn.call(o);
}};
var ob = {f: function() {
    o.f(function() {
        this.x = 2; //HERE: how can this reference ob?
        //ob.x = 2;
    });
}};
ob.f();
ob.x; // undefined 
```

`o.f(fn)`调用`fn`where`this`绑定到 o。

在 HERE，我想用来`this`访问 ob。但是，当`ob.f`被调用时，`this`必然会`o`. 我认为 JQuery 是这样工作的。例如：

```
$(...).blah(function() {
    this // this is bound to $(...) jquery object.
    ...
}; 
```

我现在正在做的是：

```
var Ob = function() {
    var self = this;
    self.f = function() {
        o.f(function() { self.x = 2; };
    };
};
var ob = new Ob();
ob.f();
ob.x; // 2 
```

但出于文体原因，我不喜欢上面的内容：

1.  使用`new`运算符听起来像太经典的 OOP。
2.  定义`**class** Ob`using`function`并不直观（至少在开始时）。

这就是为什么我试图`ob`用对象文字来定义。但是我找不到在函数中引用对象`ob`的方法，该函数使用设置`this`为其他对象的方法调用而不是`ob`.

我可以执行以下操作：

```
var ob = {f: function() {
    o.f(function() {
        self.x = 2;
    });
}};
var self = ob;
ob.f();
ob.x; 
```

但我不知道如何考虑以上因素。我试过：

```
function obj(o) {
    return function() {
        var self = o;
        return o;
    }();
}
var ob = obj({f: function() {
    o.f(function() {
        self.x = 2;
    });
}});
ob.f();
ob.x;// ReferenceError: self is not defined 
```

那么，有没有办法在对象内部的函数中可靠地引用对象（`this`可以根据上下文绑定到任何东西）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T14:16:52.243

在 JavaScript 中，函数是对象，有两种调用函数的方法：

```
call(scope, arg1, arg2, ...);
apply(scope, args);  // args is an array of arguments to call the function with 
```

第一个参数“范围”是函数内绑定到“this”的对象。因此，以下示例是等效的：

```
obj.method(1, 2, 3);
obj.method.call(obj, 1, 2, 3);
obj.method.apply(obj, [1, 2, 3]); 
```

在您的第一个示例中，您使用 'o' 作为范围调用传递给 of() 的函数：

```
var o = {f: function(fn) {
    fn.call(o);
}}; 
```

因此，您在“ob”中传递的函数引用了“o”，如下所示：

```
var ob = {f: function() {
    o.f(function() {
        this.x = 2; //HERE: how can this reference ob?
        //ob.x = 2;
    });
}}; 
```

在“HERE”行中，“this”实际上是“o”。

您可以尝试以下方法：

```
var ob = {f: function() {
    var self = this;
    o.f(function() {
        self.x = 2; // self is ob now
    });
}}; 
```

或者您可以修改函数“of”以获取范围参数：

```
var o = {f: function(fn, scope) {
    fn.call(scope || this); // Uses the given scope or this (= 'o') if no scope is provided
}}; 
```

然后你可以在'ob'中传递'this'：

```
var ob = {f: function() {
    o.f(function() {
        this.x = 2; // 'this' will be the 'outer' this
    }, this); // Here: this as scope
}}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T14:13:44.107

遵循 Douglas Crockford 的简单构造函数模式，我将创建一个使用对象字面量而不是 new 的构造函数。像这样：

```
var o = {f: function(fn) {
    fn.call(o);
}};

function obj() {
    var me = {};
    me.f = function () {
        o.f(function() {
            me.x = 2;
        });
    };
    return me;
}

var ob = obj();
ob.f();
ob.x; // 2 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:37:54.653

您可以在没有辅助功能的情况下做到这一点，只需使用文字：

```
var o = {f: function(fn) {
    fn.call(o);
}};
var ob = {f: function() {
    var self = this; // this == ob
    o.f(function() {
        self.x = 2; // self == enclosing function's this == ob
    });
}};
ob.f();
assert(ob.x == 2); 
```

# calendar - 如何用我自己的替换 DevExpress ASP.NET 日历？

> ID：569655
> 
> 赞同：0
> 
> 时间：2009-02-20T14:01:23.357
> 
> 标签：calendar, replace, devexpress

我们正在为我们的 ASP.NET 应用程序使用 DevExpress 控制工具包。由于以下原因，我想用我自己的替换 DevExpress 默认下拉日历：

*   DevExpress 下拉日历绝对位于它分配到的文本框旁边。这很糟糕，因为在 IE 上，它会被其他相对定位的元素所掩盖，这些元素是日历父级的兄弟姐妹。可以通过在这些父元素上设置大量 z-index 来解决它，但这很烦人。如果日历元素位于 DOM 的最末端并具有非常高的 z-index 会更好，从而位于所有内容之上。
*   我有一个不同的设计，我必须应用到日历上，由一些艺术家制作。它非常好，但我不确定我是否能够按原样使用日历 HTML。

此外，替换必须在任何地方进行 - 无论是在网格视图中还是在独立控件中。

有谁知道如何做到这一点？我也可以选择一个变体，在其中使用我制作的一些自定义 gridview 列类型和日历类型。

目前我对 DevExpress 的复杂性有点不知所措。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-27T21:21:43.630

在回答您问题的第二部分，日历控件的设计 - 您实际上可以编辑 DevExpress 编辑器 CSS 文件（称为**styles.css**），该文件将包含在您使用的任何 DevExpress 主题中（即**App_Themes\Aqua\Editors**）。

如果您打开 CSS 文件，所有与日历相关的样式都以**.dxeCalendar**为前缀，编辑这些样式应反映在所有日历控件中（无论是在 ASPxGridView 中还是在独立编辑器中等）。

我不确定下拉日历的位置，但您应该查看 DevExpress 支持中心——那里真的很有帮助！

www.devexpress.com/Support/Center

希望这可以帮助！

# rdf - RDF 数据实例是否嵌入了 RDF Schema？

> ID：569657
> 
> 赞同：1
> 
> 时间：2009-02-20T14:01:50.923
> 
> 标签：rdf, semantic-web, ontology

RDF Schema 存在一个预定义的规范。我想知道 RDF 数据实例中是否嵌入了 RDF Schema 片段？类似于类的名称，也恰好是主题/对象的名称。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T15:28:04.023

那是没有必要的。您可以将定义和数据分开。例如，如果您创建一个 FOAF 文档，您将不会在其上包含 FOAF 模式，而只是使用对它的引用，如下所示（非常简单的片段）：

```
<foaf:Person rdf:about="#me" xmlns:foaf="http://xmlns.com/foaf/0.1/">
  <foaf:name>Dan Brickley</foaf:name>
  <foaf:mbox_sha1sum>241021fb0e6289f92815fc210f9e9137262c252e</foaf:mbox_sha1sum>
  <foaf:homepage rdf:resource="http://danbri.org/" />
  <foaf:img rdf:resource="/images/me.jpg" />
</foaf:Person> 
```

# c# - C#，Linq2Sql：是否可以将两个可查询对象合并为一个？

> ID：569671
> 
> 赞同：11
> 
> 时间：2009-02-20T14:07:51.610
> 
> 标签：c#, linq-to-sql, lambda, expression-trees, iqueryable

**我有一个可查询**的地方，我使用了各种[`Where`](http://msdn.microsoft.com/en-us/library/system.linq.queryable.where.aspx)和[`WhereBetween`](https://stackoverflow.com/questions/553443/c-linq2sql-creating-a-predicate-to-find-elements-within-a-number-of-ranges/553457#553457)语句将集合缩小到某个集合。现在**我需要添加一种`Where || WhereBetween`**. 换句话说，我不能像到目前为止那样将它们链接在一起，因为这将作为 And 起作用。那么，我该怎么做呢？

**我看到两种可能性：**

1.  **从我拥有的一个中**创建两个可查询**`Where`，一个使用，一个使用`WhereBetween`. **然后将它们连接起来**。不知道这是否可能？另外，虽然不是在我的特定情况下，但您很可能会以重复结束...**
***   以某种方式**将`Where`表达式和在 中创建的表达式`WhereBetween`**与某种 Or 合并。**

 *** * *

第一个，如前所述，我不确定是否可能。如果是这样，我不太确定这是一个好方法。

第二，我可以将其视为一种选择，但不能完全确定所有细节。以下是`WhereBetween`我的另一个问题的方法，我现在使用它并且效果很好：

```
 public static IQueryable<TSource> WhereBetween<TSource, TValue>(
        this IQueryable<TSource> source,
        Expression<Func<TSource, TValue>> selector,
        IEnumerable<Range<TValue>> ranges)
    {
        var param = Expression.Parameter(typeof(TSource), "x");
        var member = Expression.Invoke(selector, param);
        Expression body = null;
        foreach (var range in ranges)
        {
            var filter = Expression.AndAlso(
                Expression.GreaterThanOrEqual(member,
                     Expression.Constant(range.A, typeof(TValue))),
                Expression.LessThanOrEqual(member,
                     Expression.Constant(range.B, typeof(TValue))));
            body = body == null ? filter : Expression.OrElse(body, filter);
        }
        return body == null ? source : source.Where(
            Expression.Lambda<Func<TSource, bool>>(body, param));
    } 
```

我在想我可以将它的表达式构建部分提取到一种新方法中。或许是这样的：

```
 public static IQueryable<TSource> WhereBetween<TSource, TValue>(
        this IQueryable<TSource> source,
        Expression<Func<TSource, TValue>> selector,
        IEnumerable<Range<TValue>> ranges)
    {
        return source.Where(WhereBetween(selector, ranges));
    }

    public static Expression<Func<TSource, bool>> WhereBetween<TSource, TValue>(
        Expression<Func<TSource, TValue>> selector,
        IEnumerable<Range<TValue>> ranges)
    {
        var param = Expression.Parameter(typeof(TSource), "x");
        var member = Expression.Invoke(selector, param);
        Expression body = null;
        foreach (var range in ranges)
        {
            var filter = Expression.AndAlso(
                Expression.GreaterThanOrEqual(member,
                     Expression.Constant(range.A, typeof(TValue))),
                Expression.LessThanOrEqual(member,
                     Expression.Constant(range.B, typeof(TValue))));
            body = body == null ? filter : Expression.OrElse(body, filter);
        }
        return body == null 
            ? ø => true
            : Expression.Lambda<Func<TSource, bool>>(body, param);
    } 
```

然后我可以使用这个新方法来获取表达式而不是可查询的。所以，假设我有`WhereBetween(ø => ø.Id, someRange)`and 例如`ø => ø.SomeValue == null`。我怎样才能将这两者与 Or 结合起来？我正在查看方法中`Expression.OrElse`使用的`WhereBetween`方法，我认为这可能是我需要的，或者这可能是`Expression.Or`. 但是我对这个表达的东西很不稳定，所以我不确定在这里选择什么，或者即使我在正确的轨道上：p

有人可以在这里给我一些指示吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T14:25:42.097

您在这里有两个选项 -`Queryable.Union`或表达式组合。我通常倾向于后者，通过`OrElse`- （至少使用 LINQ-to-SQL）你可以使用 2 个表达式（见下文） - 但无论哪种情况，它都应该组合起来：

```
 using(var ctx = new DataClasses1DataContext())
    {
        ctx.Log = Console.Out;
        Expression<Func<Customer, bool>> lhs =
            x => x.Country == "UK";
        Expression<Func<Customer, bool>> rhs =
            x => x.ContactName.StartsWith("A");

        var arr1 = ctx.Customers.Where(
            lhs.OrElse(rhs)).ToArray();

        var arr2 = ctx.Customers.Where(lhs)
            .Union(ctx.Customers.Where(rhs)).ToArray();
    } 
```

两者都只`arr1`执行`arr2`一次数据库命中（尽管 TSQL 不同；第一个`OR`在`WHERE`子句中有一个；第二个有两个单独的查询`UNION`）。

这是我使用的扩展方法：

```
static Expression<Func<T, bool>> OrElse<T>(
    this Expression<Func<T, bool>> lhs,
    Expression<Func<T, bool>> rhs)
{
    var row = Expression.Parameter(typeof(T), "row");
    var body = Expression.OrElse(
        Expression.Invoke(lhs, row),
        Expression.Invoke(rhs, row));
    return Expression.Lambda<Func<T, bool>>(body, row);
} 
```

# winforms - TreeView 重新获取 Ctrl+Click 的焦点

> ID：569673
> 
> 赞同：4
> 
> 时间：2009-02-20T14:09:21.433
> 
> 标签：winforms, treeview, focus, click, double-click

我有一个 WinForms TreeView 控件，我想用它来根据当前选择的节点打开另一个表单。当我 Ctrl+单击节点时，我想打开另一个表单。

目前，如果我在 DoubleClick 处理程序中打开另一个表单（显然，双击节点），它会按照我想要的方式工作；但是，如果我使用 Click（或 MouseClick）处理程序并在按下 Control 键时打开另一个表单，它会正确打开另一个表单，但会将焦点返回到原始表单。

打开另一个表单后，如何让焦点不会返回到原始表单（我仍然想保持打开状态）？为什么 Click 和 DoubleClick 处理程序之间的行为不同？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T22:00:32.067

事件返回后，TreeView 会夺回焦点。很烦人。您可以使用一个技巧：使用 Control.BeginInvoke 延迟事件的操作：

```
private void treeView1_NodeMouseClick(object sender, TreeNodeMouseClickEventArgs e) {
  this.BeginInvoke(new TreeNodeMouseClickEventHandler(delayedClick), sender, e);
}
private void delayedClick(object sender, TreeNodeMouseClickEventArgs e) {
  // Now do your thing...
} 
```

当 TreeView 的所有事件完成运行并且您的程序进入空闲状态并重新进入消息循环时，delayedClick 方法就会运行。

# asp.net - HMACSHA1.ComputeHash() 线程安全问题

> ID：569683
> 
> 赞同：7
> 
> 时间：2009-02-20T14:12:38.120
> 
> 标签：asp.net, hmac, sha1

我在问自己，在 asp.net 页面的代码隐藏中使用包含 HMACSHA1 实例的静态（共享）变量是否会很危险。问题是在处理同一个 asp.net 页面上的多个同时请求时，所有 asp.net worker-process 线程将使用相同的 HMACSHA1-instance。由 ComputeHash() 使用/修改的所有 (HMACSHA1) 实例和 ComputeHash() 方法变量将由所有线程共享（= 可以修改）？！这个假设正确吗？结果 ComputeHash 的返回值不能保证是正确的？！？！因此，我不允许在所有 asp.net 线程上使用静态/共享 HMACSHA1 实例。

我只是想知道你对这个问题的看法。

对此的唯一解决方案是 ComputeHash() 方法中的关键路径等。但那是“我们无法企及的”..

问候，克里斯

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-11-13T23:27:02.807

在四核 HT cpu 上运行 8 或 16 个并行任务时，我刚刚从 SHA256Cng.ComputeHash 中得到一个未知的加密异常，其中包括执行哈希计算。

在 ComputeHash 周围添加锁定语义解决了这个问题 - 所以看起来至少 SHA256Cng 版本不是线程安全的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-20T14:22:02.340

散列算法是确定性的，它们每次都**必须为给定的输入返回相同的散列。**

只要您每次都使用相同的密钥，就无需将它们设为静态。但是，如果您使用无参数构造函数构造 HMACSHA1 实例，那么它会生成一个随机密钥。您应该从 KeyValue 属性中获取随机值并将其与哈希一起存储。

使用静态实例绝对是危险的。如果 Thread1 设置要计算的值，然后 Thread2 在 Thread1 调用 ComputerHash() 之前设置该值，则 Thread1 将获取 Thread2 值的哈希值。如果任一线程正在设置密钥，也会发生同样的情况。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-11-11T07:21:28.803

值得知道的`KeyedHashAlgorithm.ComputeHash()`是，这不是线程安全的，因为它给出了相同的不确定结果`KeyedHashAlgorithm.Key`。

在我的情况下，我想缓存 KeyedHashAlgorithm 因为我`KeyedHashAlgorithm.Key`的总是相同的，以从客户端验证**真实性。**我意识到这`ComputeHash()`并不一致，可能它会将内部变量缓存到`KeyedHashAlgorithm`实例中。我应该缓存每个线程的实例`ThreadStatic`或`ThreadLocal`. 这是测试：

静态`KeyedHashAlgorithm`给出不一致的结果：

```
var kha = KeyedHashAlgorithm.Create("HMACSHA256");
kha.Key = Encoding.UTF8.GetBytes("key");
Action comp = () =>
{
    var computed = kha.ComputeHash(Encoding.UTF8.GetBytes("message"));
    Console.WriteLine(Convert.ToBase64String(computed));
};
Parallel.Invoke(comp, comp, comp, comp, comp, comp, comp, comp); 
```

与`KeyedHashAlgorithm`每个线程相比：

```
ThreadLocal<KeyedHashAlgorithm> tl= new ThreadLocal<KeyedHashAlgorithm>(() =>
{
    var kha = KeyedHashAlgorithm.Create("HMACSHA256");
    kha.Key = Encoding.UTF8.GetBytes("key");
    return kha;
});
Action comp = () =>
{
    var computed = tl.Value.ComputeHash(Encoding.UTF8.GetBytes("message"));
    Console.WriteLine(Convert.ToBase64String(computed));
};
Parallel.Invoke(comp, comp, comp, comp, comp, comp, comp, comp); 
```

此代码可用于测试“线程安全”结果的其他功能。希望这对其他人有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-03T17:46:33.190

如果你想要线程安全而不需要锁定，你可以使用 ThreadStatic 属性在每个线程上创建一个唯一的实例，如下所示：

```
[ThreadStatic]
private static HMACSHA1 _hmacSha1;

public static HMACSHA1 HmacSha1
{
    get 
    {
        if (_hmacSha1 == null)
        {
            // this will happen once on each thread
            _hmacSha1 = new HMACSHA1(GetKeyBytes());
        }               

        return _hmacSha1;
    }
} 
```

现在，两个旁注：

1.  访问线程静态字段比访问普通静态字段花费的时间要长得多。因此，线程静态版本可能对您更好，也可能不会更好。

2.  如果您在每个页面请求中执行一次，那么差异将非常小，以至于您选择哪种方法都无关紧要。如果您在一个非常紧凑的循环中执行此操作，或者您的锁定部分中的代码花费了很长时间，那么选择可能很重要。

# php - gd中的php和true类型集合

> ID：569684
> 
> 赞同：6
> 
> 时间：2009-02-20T14:13:42.860
> 
> 标签：php, gd, fonts, truetype

我尝试在 GD 库中使用具有 4 种字体的真正类型集合“gulim.ttc”。

像这样：

```
$font = "fonts/gulim.ttc";
imagettftext($im, 20, 0, 0, 25, $white, $font, $string); 
```

问题是，PHP/GD 只使用 ttc 文件中的第一种字体，但我需要第三种字体，称为“Dotum”。

或者，有没有办法将 ttc 文件提取或转换为 ttf 文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T09:50:50.540

以下是一些将 TTC 文件分解为 TTF 的程序的链接：[link](http://www.filewatcher.com/m/breakttc.exe.11019.0.0.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-08-03T22:44:40.790

这里有一些不同的方法：[https](https://superuser.com/questions/114603/how-to-install-os-x-ttc-font-on-windows-error-ttc-does-not-appear-to-be) ://superuser.com/questions/114603/how-to-install-os-x-ttc-font-on-windows-error-ttc-does-not-appear-to-be 。还有一个指向 C 中源代码的指针。这是另一个：[http ://solaris.sunfish.suginami.tokyo.jp/tips/playground/truetype/ttc2ttf/ttc2ttf.cpp](http://solaris.sunfish.suginami.tokyo.jp/tips/playground/truetype/ttc2ttf/ttc2ttf.cpp)

那里唯一的编码示例似乎是日语……考虑到 TTC 文件几乎适用于亚洲语言，这是有道理的。无论如何，我也发现了这个：http: [//hdmr.org/d/read.php/1172771146](http://hdmr.org/d/read.php/1172771146)（可能需要谷歌翻译）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-23T17:58:15.213

不确定您是否找到任何东西，但我遇到了同样的问题并找到了以下救生链接……它有斜体、居中、右对齐、左对齐和下划线。唯一缺少的是粗体，无论如何这很简单。

[php-imagestringright-center-斜体](http://www.puremango.co.uk/2009/04/php-imagestringright-center-italic/)

**来自该网站：** “它们甚至可以使用您通过 ImageLoadFont 加载的字体，这非常棒！您甚至可以嵌套效果，例如创建带有阴影的右对齐斜体字符串！”

每个函数都有一个可选的最终参数 $ImageString，它包含一个字符串，表示用于编写字符串的函数。例如，如果我们想用斜体写一个右对齐的字符串，我们可以使用下面的代码：

```
ImageStringRight($image, 5, 25, 'Right + Italic', $col, 5, 'ImageStringItalic'); 
```

# pfx - _without_ 使用 OpenSSL 从 PFX 文件中提取证书

> ID：569687
> 
> 赞同：2
> 
> 时间：2009-02-20T14:15:13.417
> 
> 标签：pfx

我找到了一个[使用 OpenSSL 的答案](https://stackoverflow.com/questions/403174/convert-pfx-to-cer/405545#405545)，但我在 Windows 上，而且手头并不容易。有没有办法（例如使用 CERTUTIL 或 VBScript）查看 .PFX 文件中的证书？

如果我使用“certutil -dump”，它会询问密钥的密码。我不想要密钥，并且证书应该是公开的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-09-06T15:37:46.950

在 PFX 文件中，私钥*和*证书都被加密（使用相同的密码）。如果您不知道密码，您将无法获得证书。如果你知道，`certutil -dump`应该就够了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-10-22T12:27:28.060

您可以使用`Get-PfxData`来自`pkiclient`.

[https://docs.microsoft.com/en-us/powershell/module/pkiclient/get-pfxdata?view=win10-ps](https://docs.microsoft.com/en-us/powershell/module/pkiclient/get-pfxdata?view=win10-ps)

例子：

```
$mypwd = ConvertTo-SecureString -String "localhost" -Force -AsPlainText
$mypfx = Get-PfxData -FilePath C:\Users\oscar\Desktop\localhost.pfx -Password $mypwd   
$mypfx
$mypfx.EndEntityCertificates 
```

如果您有证书并需要`.sst`（Microsoft 序列化证书存储）、`.cer`（CERT）或`.p7b`（PKCS#7）文件，您可以使用`Export-Certificate`（`pkiclient`或通过 MMC 导出它而不使用私钥）。

[https://docs.microsoft.com/en-us/powershell/module/pkiclient/export-certificate?view=win10-ps](https://docs.microsoft.com/en-us/powershell/module/pkiclient/export-certificate?view=win10-ps)

导出 IIS Express 生成的 localhost 证书的示例：

启动 mmc.exe。

然后转到：

文件 -> 添加或删除管理单元 -> 证书 -> 添加 -> 计算机帐户 -> 本地计算机

展开 Personal 文件夹，您将看到您的 localhost 证书。

双击，转到详细信息并复制证书指纹。

然后运行命令：

```
$cert = (Get-ChildItem -Path cert:\LocalMachine\My\{YourThumbprint})
Export-Certificate -Cert $cert -FilePath C:\Users\oscar\Desktop\localhost.cer 
```

注意：如果您需要当前用户的证书，请在上述命令中替换`LocalMachine`为。`CurrentUser`

# c# - 识别SqlConnection对象的底层sql连接

> ID：569688
> 
> 赞同：3
> 
> 时间：2009-02-20T14:15:48.253
> 
> 标签：c#, sql-server, sqlconnection, spid

我可以使用 GetHashCode() 来识别对象，但是有什么方法可以识别 SqlConnection 对象获得的实际 sql 连接？

我（仍在）尝试调试涉及池连接和应用程序角色的问题，如果我能够可靠地识别底层 sql 连接，它会很有帮助。

这是一些可能说明问题的代码

```
SqlConnection c = new SqlConnection(myConnString);

c.Open();  // GetHashCode == "X"

c.Close(); // returns connection to pool

c.Open;  // GetHashCode() == "X" but possibly different pooled connection? 
```

当我写这个问题时，我突然想到我可能想要的是连接的 SPID。可悲的是，由于我试图解决的错误，当 SQL 删除连接时，SPID 不可用（所以在我最感兴趣的时候，我无法在该连接上运行命令来获取 SPID） .

还有什么好主意吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2016-07-02T23:52:25.430

@埃德吉尼斯，

（我知道这是一个旧线程，但为了将来可能需要它的人的利益）

;tldr 回答：并非没有一些代码更改（主要是非破坏性和合理的更改恕我直言）。

非常奇怪的是，一旦打开连接对象，Microsoft 就不会公开 SPID。例如，我可以看到可以从 SqlConnection 对象而不是 SPID 获得的 SQL 版本名称和其他 SQL Server 特定属性。

细节：

每个 SQLConnection 都分配有一个 SPID。这是使用 T-SQL 命令@@SPID 获得的，但这在 SQL Server 端执行。诀窍是将它与在 SQL Server 端完成的主要工作一起传递，并在 C# 端读取它。

需要 SPID 的四种可能情况。

1.  您正在执行一个返回结果集的存储过程（减去 spid）
2.  您正在执行 INS/UPD/DEL 存储过程。
3.  您正在从 ADO.Net (yikes!!) 运行 Prepared SQL stms On the fly (inline) 来执行 CRUD 操作（即没有存储过程的场景 1 和 2）
4.  您正在使用 SqlBulkCopy 将数据直接插入到表中

**1\. 返回结果集的存储过程**

假设您有一个从主数据库返回行的 SP (USP_GetDBDetails)。我们需要在 Existing SQL Stmt 中添加一行代码来返回 SPID 并在 C# 端使用 Paramter 类型获取它以检索 ReturnValue。也可以读取主要的结果集。

存储过程是一个美丽的东西。**它们可以同时返回一个返回值和一个结果集和一个输出参数。**在这种情况下，在 SP 端，我们只需要在 ADO.Net 使用 SqlConnection 执行的 SP 的末尾添加额外的返回值。我们这样做如下面的 T-SQL 代码所示：

```
CREATE Procedure [dbo].[USP_GetDBDetails] 
AS
BEGIN

    SELECT 
            database_id,
            name,
            create_date         
      FROM  [sys].[databases]

      Return @@SPID -- Line of Code that needs to be added to return the SPID

END 
```

现在在 C# 端捕获 SPID（根据需要修改连接字符串）：

```
 using (SqlConnection conn = new SqlConnection(@"Data Source=(local);Initial Catalog=master;Persist Security Info=True;Integrated Security =SSPI;"))
        {

            string strSql = "USP_GetDBDetails";

            SqlCommand sqlcomm = new SqlCommand();
            sqlcomm.CommandText = strSql;
            sqlcomm.CommandType = CommandType.StoredProcedure;
            sqlcomm.Connection = conn;

            SqlParameter returnValueParam = sqlcomm.Parameters.Add("@ReturnValue", SqlDbType.Int);
            returnValueParam.Direction = ParameterDirection.ReturnValue;

            conn.Open();

**// Reader Section**
            SqlDataReader rdr = sqlcomm.ExecuteReader();
            DataTable dt = new DataTable();
            dt.Load(rdr); // Get the Reultset into a DataTable so we can use it !
            rdr.Close();  // Important to close the reader object before reading the return value.

// Lets get the return value which in this case will be the SPID for this connection.
           string spid_str = returnValueParam.Value.ToString();
           int spid = (int)sqlcomm.Parameters["@ReturnValue"].Value; // Another Way to get the return value.

           Console.WriteLine("SPID For this Conn = {0} ", spid);

// To use the Reult Sets that was returned by the SP:

        foreach (DataRow dr in dt.Rows)
        {
            string dbName = dr["Name"].ToString();
            // Code to use the Other Columns goes here

        }
      } 
```

输出 ：

```
SPID For this Conn = 66 
```

* * *

**2.如果Connection对象正在执行一个处理INS/UPS/DEL的SP**

就像我们在场景 1 中所做的那样，在负责 INS/UPD/DEL 的 SP 的末尾添加 RETURN @@SPID。

在 C# 端获取 SPID .. 一切都与场景 1 中的相同，除了**阅读器部分**。删除 Reader Section 下的 4 行，并用下面的这一行替换。（显然，迭代 DataTable dt 的 foreach 循环不是必需的）

```
sqlcomm.ExecuteNonQuery(); 
```

* * *

**3\. INS/UPD/DEL 使用内联 SQL**

将这些 stmts 移动到存储过程中并按照场景 2 的步骤进行操作。可能有一些方法可以做一些 T-SQL 杂技来注入 @@SPID 并通过可能使用 MultipleActiveResultSets 选项返回它，但不是很优雅的 IMO。

* * *

**4\. SqlBulkCopy**。

这将需要查询表以获取 spid。由于没有存储过程可以从 SqlServer 返回可以捕获的 SPID。

我们需要添加一个额外的 INT 类型列来保存 SPID 值，如下所示：

```
ALTER TABLE dbo.TBL_NAME ADD
    SPID int NOT NULL Default( @@SPID )
GO 
```

通过这样做，SQL Server 将自动将 SPID 值插入到新添加的列中。在处理 BulkCopy 的 C# ADO 端不需要更改代码。典型的 Bulkcopy ADO 代码如下所示，它应该在上面的 ALTER TABLE Stmt 之后继续工作。

```
 using (SqlConnection connection = new SqlConnection(connectionString))
        {
            connection.Open();

            using (SqlBulkCopy bulkCopy = new SqlBulkCopy(connection))
            {

            DataTable dt = new DataTable();
            dt.Columns.Add("Col1");
            dt.Columns.Add("Col2");

            string[] row = { "Col1Value", "Col2Value" };

            dt.Rows.Add(row);
                bulkCopy.DestinationTableName = "TBL_NAME_GOES_HERE"; //TBL_NAME

                try
                {
                    // Write from the source to the destination.
                    bulkCopy.WriteToServer(dt);
                }
                catch (SqlException ex)
                {

                  // Handle Exception

                }
            }
     } 
```

因此，要检查输出，请从 dbo.TBL_NAME 中选择不同的 SPID

就是这样 。希望对某人有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T14:49:22.167

您可以在连接字符串中设置应用程序名称，然后在 SQL Server 中可见。通常它默认为 SQL 客户端，但您可以覆盖：

`"Integrated Security=true;Initial Catalog=Northwind;server=(local);Application Name=MyKeyword"`

此属性可以由 SqlConnection 实例的 ConnectionString 属性读回。

编辑：正如 edg 所指出的，连接字符串定义了哪个连接池，所以这可能不起作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-21T15:25:09.103

并不是说这是不可能的，但我还没有找到任何方法来做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T14:20:29.303

不是一个直接的答案，而是你应该注意的一些事情。对象的哈希码在其整个生命周期内不应更改。如果是这样，那么您可以将一个对象放入散列集合中，更改它的散列码，然后无法再次从集合中检索它。

如果您附加一个调试器并查看私有字段，您不能打开某种内部标识符吗？如果是这样，如果需要，您可以在调试期间通过反射访问它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T23:14:32.077

如果我正确理解您的问题，理查德的回答对您没有帮助，因为您正在寻找底层 .NET 连接池中的实际对象。我也不相信哈希会有所帮助，因为您正在查看基础池。

我没有答案，本身，而是一个建议。获取 Reflector（现在是 RedGate 产品）的副本并通过 System.Data.DLL 并查看事物是如何存储在底层池中的。我不确定它会给你一个快速而简单的答案，但如果有任何事情你可以反思以获得帮助调试你的问题的答案，它就会在那里。

顺便说一句，您要解决的错误是什么？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T23:17:02.070

您可以尝试的一件事是

```
SqlConnection.ClearPool(); 
```

或者

```
SqlConnection.ClearAllPools(); 
```

看看您是否可以隔离您面临的任何问题。

# c++-cli - 在 C++/CLI 中传递非托管指针

> ID：569690
> 
> 赞同：5
> 
> 时间：2009-02-20T14:16:16.393
> 
> 标签：c++-cli, pointers, unmanaged

我正在创建一个依赖于众多 C++ 静态库的 C++/CLI 包装 DLL。一些函数调用期望传入非托管指针。如何正确传递它们？

此外，其他函数期望“this 指针”作为 void* 传入。传递“这个”的正确方法是什么？

**这是我的班级定义...**

```
public ref class RTPClient
{
    public:
        RTPClient();
        ~RTPClient();

        bool Connect();
        void Disconnect();

    private:
        CIsmaClient* mClient;
}; 
```

**这是我使用有问题的指针的用法......**

```
RTPClient::RTPClient():
    mClient(NULL)
{
    CIsmaClient::Create(&mClient, NULL, &AllocBuffer, &GetDataPointer, this);
} 
```

**&mClient 和“this”的使用会导致以下编译器错误...** 1>.\VBLoadSimulatorDll.cpp(40) : 错误 C2664: 'CIsmaClient::Create' : 无法将参数 1 从 'cli::interior_ptr' 转换为 ' CIsmaClient **' 1> with 1> [ 1> Type=CIsmaClient * 1> ]

1>.\VBLoadSimulatorDll.cpp(40)：错误 C2664：“CIsmaClient::Create”：无法将参数 5 从“VBLoadSimulator::RTPClient ^const”转换为“VOID *”

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T14:34:41.110

如果您将指针传递给托管类，那么很容易将 ^ 引用转换为指针，但您必须固定托管对象，以便 GC 不会在内存中移动它（从而使指针无效）

这很简单[pin_ptr](http://msdn.microsoft.com/en-us/library/1dz8byfh(VS.80).aspx)

但是，您的代码正在做两件不起作用的事情

```
RTPClient::RTPClient():
        mClient(NULL)
{
    CIsmaClient::Create(
        &mClient,          // 1
        NULL, 
        &AllocBuffer, 
        &GetDataPointer, 
        this);            //2
} 
```

1）您试图获取托管堆上某些东西的地址（指向指针 mClient 的*指针的位置在托管堆上。*

因此它可以在内存中移动，因此编译器供应商内部指针（其值通过 GC 操作维护）。这需要[固定](http://www.codeproject.com/KB/mcpp/pinnedpointers.aspx)，并且仅当 Create 函数不希望在其范围结束后使用指针时才有效（如果它将它传递到其他任何地方来存储它，这将导致错误）。

2）您传递的是[句柄](http://en.wikipedia.org/wiki/C%2B%2B/CLI)（有趣的帽子符号）而不是指针。（阅读关于这些的维基百科部分，它们是一个很好的概述）非托管代​​码不能（也不能）理解这一点。

在这种情况下，我能想到这个参数的唯一原因是作为传递给后续函数回调的显式状态变量（如果我错了，请纠正我）。在这种情况下，'this' 永远不会正常工作，因为一旦 pin_ptr 超出范围，它就会在内存中移动。

考虑到这一点，这里是一个（部分）更正的实现，明确了哪些可以修复，哪些不能修复。

```
RTPClient::RTPClient():
        mClient(NULL)
{
    // make it clear you want the address of the instance variable
    pin_ptr<CIsmaClient*> pinnedClient = &this->mClient; 
    CIsmaClient::Create(
        pinnedClient,          // fixed
        NULL, 
        &AllocBuffer, 
        &GetDataPointer, 
        x /* pass something else in */);            //2
} 
```

如果您提供有关最后一个参数的用途的更多信息，我可以建议可能的解决方案

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-12T09:50:55.813

我想你会认为这是通过 void 指针传递托管引用的最简单方法：

```
void SomeFunction(void* input)
{
  gcroot<ManagedClass^>* pointer = (gcroot<ManagedClass^>*)(input);
  (*pointer)->ManagedFunction();
}

void Example()
{
  ManagedClass^ handle = gcnew ManagedClass();
  gcroot<ManagedClass^>* pointer = new gcroot<ManagedClass^>(handle);
  SomeFunction((void*)pointer);
  delete pointer;
} 
```

# php - php 文件中的 nvl() 函数

> ID：569693
> 
> 赞同：2
> 
> 时间：2009-02-20T14:16:56.707
> 
> 标签：php, mysql

我只是在查看一个 php 文件，并遇到了以下代码：

```
switch (nvl($mode))
{
  case "add" :
     print_add_category_form(nvl($id, 0));
     break;

  case "edit" :
     print_edit_category_form($id);
     break;
} 
```

nvl() 函数有什么作用？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T14:45:29.087

可能它就像 Oracle 的 NVL 函数，尽管据我所知需要两个参数。

我用 PHP 作为语言搜索了谷歌代码搜索，有几个例子，比如：

```
/**
* If $var is undefined, return $default, otherwise return $var.
*/
function nvl(&$var, $default = "")
{
    return isset($var) ? $var
                       : $default;
} 
```

但是，我认为您最好按照 ceejayoz 的建议自己在代码中查找声明。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-03-03T16:29:33.640

或者，如果您可以访问 PHP 7.0.0，请尝试使用[空合并运算符](http://php.net/manual/en/migration70.new-features.php)“??”

所以代替（Oracle语法）：

```
nvl($id, 0) 
```

您可以使用：

```
$id ?? 0 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T14:18:27.793

谁知道？它不是标准的 PHP 函数。在代码中的其他地方查找该函数的定义位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-25T06:24:14.793

有关 Oracle 使用的 nvl() 的定义，请参见下面的链接。PHP 没有。因此，您的代码示例的开发人员可能已经实现了类似的功能。

[http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/functions105.htm](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/functions105.htm)

在我的代码中，我使用自己的实现，它更接近 Oracle 定义的：

**顺便说一句：“nvl”的意思是“[n]ull [v]a[l]ue”**

```
// Function: nvl
//
// Replaces null or '' string.
//
// PARAMETERS:
//   $val     - Value to be returned normally.
//   $replace - Value to be returned if $val is null or ''.
//
// RETURNS:
//   See parameters.

function nvl($val, $replace)
{
    if( is_null($val) || $val === '' )  return $replace;
    else                                return $val;
} 
```

# ruby - 如何计算 Ruby 数组中的重复元素

> ID：569694
> 
> 赞同：71
> 
> 时间：2009-02-20T14:17:21.073
> 
> 标签：ruby, arrays

我有一个排序数组：

```
[
  'FATAL <error title="Request timed out.">',
  'FATAL <error title="Request timed out.">',
  'FATAL <error title="There is insufficient system memory to run this query.">'
] 
```

我想得到这样的东西，但它不一定是哈希：

```
[
  {:error => 'FATAL <error title="Request timed out.">', :count => 2},
  {:error => 'FATAL <error title="There is insufficient system memory to run this query.">', :count => 1}
] 
```

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-02-20T14:39:02.190

以下代码*打印*您要求的内容。我会让你决定如何实际使用来生成你正在寻找的哈希：

```
# sample array
a=["aa","bb","cc","bb","bb","cc"]

# make the hash default to 0 so that += will work correctly
b = Hash.new(0)

# iterate over the array, counting duplicate entries
a.each do |v|
  b[v] += 1
end

b.each do |k, v|
  puts "#{k} appears #{v} times"
end 
```

**注意：**我刚刚注意到您说数组已经排序。上面的代码不需要排序。使用该属性可能会产生更快的代码。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2009-02-21T02:17:31.667

您可以使用以下命令非常简洁地（一行）执行此操作[`inject`](http://www.ruby-doc.org/core/classes/Enumerable.html#M003160)：

```
a = ['FATAL <error title="Request timed out.">',
      'FATAL <error title="Request timed out.">',
      'FATAL <error title="There is insufficient ...">']

b = a.inject(Hash.new(0)) {|h,i| h[i] += 1; h }

b.to_a.each {|error,count| puts "#{count}: #{error}" } 
```

将产生：

```
1: FATAL <error title="There is insufficient ...">
2: FATAL <error title="Request timed out."> 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2014-05-28T11:35:31.470

如果你有这样的数组：

```
words = ["aa","bb","cc","bb","bb","cc"] 
```

在需要计算重复元素的地方，单行解决方案是：

```
result = words.each_with_object(Hash.new(0)) { |word,counts| counts[word] += 1 } 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2017-01-24T18:04:40.070

[使用Enumerable#group_by](https://ruby-doc.org/core-2.2.3/Enumerable.html#method-i-group_by)对上述答案的另一种方法。

```
[1, 2, 2, 3, 3, 3, 4].group_by(&:itself).map { |k,v| [k, v.count] }.to_h
# {1=>1, 2=>2, 3=>3, 4=>1} 
```

将其分解为不同的方法调用：

```
a = [1, 2, 2, 3, 3, 3, 4]
a = a.group_by(&:itself) # {1=>[1], 2=>[2, 2], 3=>[3, 3, 3], 4=>[4]}
a = a.map { |k,v| [k, v.count] } # [[1, 1], [2, 2], [3, 3], [4, 1]]
a = a.to_h # {1=>1, 2=>2, 3=>3, 4=>1} 
```

[`Enumerable#group_by`](https://ruby-doc.org/core-2.2.3/Enumerable.html#method-i-group_by)在 Ruby 1.8.7 中添加。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2017-04-05T13:42:21.620

以下情况如何：

```
things = [1, 2, 2, 3, 3, 3, 4]
things.uniq.map{|t| [t,things.count(t)]}.to_h 
```

它感觉更清晰，更能描述我们实际尝试做的事情。

我怀疑它对于大型集合的性能也会比迭代每个值的集合更好。

基准性能测试：

```
a = (1...1000000).map { rand(100)}
                       user     system      total        real
inject                 7.670000   0.010000   7.680000 (  7.985289)
array count            0.040000   0.000000   0.040000 (  0.036650)
each_with_object       0.210000   0.000000   0.210000 (  0.214731)
group_by               0.220000   0.000000   0.220000 (  0.218581) 
```

所以它的速度要快一些。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2019-09-01T21:06:07.517

使用[枚举#tally](https://ruby-doc.org/core-2.7.0/Enumerable.html#method-i-tally)

```
["a", "b", "c", "b"].tally 

#=> { "a" => 1, "b" => 2, "c" => 1 } 
```

注意：仅适用于 Ruby 版本 >= 2.7

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2018-09-24T20:54:04.090

从 Ruby >= 2.2 你可以使用[`itself`](https://ruby-doc.org/core-2.2.0/Object.html#method-i-itself)：`array.group_by(&:itself).transform_values(&:count)`

更多细节：

```
array = [
  'FATAL <error title="Request timed out.">',
  'FATAL <error title="Request timed out.">',
  'FATAL <error title="There is insufficient system memory to run this query.">'
];

array.group_by(&:itself).transform_values(&:count)
 => { "FATAL <error title=\"Request timed out.\">"=>2,
      "FATAL <error title=\"There is insufficient system memory to run this query.\">"=>1 } 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-05-03T22:03:20.613

我个人会这样做：

```
# myprogram.rb
a = ['FATAL <error title="Request timed out.">',
'FATAL <error title="Request timed out.">',
'FATAL <error title="There is insufficient system memory to run this query.">']
puts a 
```

然后运行程序并将其通过管道传递给 uniq -c：

```
ruby myprogram.rb | uniq -c 
```

输出：

```
 2 FATAL <error title="Request timed out.">
 1 FATAL <error title="There is insufficient system memory to run this query."> 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-20T14:56:51.710

```
a = [1,1,1,2,2,3]
a.uniq.inject([]){|r, i| r << { :error => i, :count => a.select{ |b| b == i }.size } }
=> [{:count=>3, :error=>1}, {:count=>2, :error=>2}, {:count=>1, :error=>3}] 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-07-28T03:39:49.550

如果您想经常使用它，我建议您这样做：

```
# lib/core_extensions/array/duplicates_counter
module CoreExtensions
  module Array
    module DuplicatesCounter
      def count_duplicates
        self.each_with_object(Hash.new(0)) { |element, counter| counter[element] += 1 }.sort_by{|k,v| -v}.to_h
      end
    end
  end
end 
```

加载它

```
Array.include CoreExtensions::Array::DuplicatesCounter 
```

然后在任何地方使用，只需：

```
the_ar = %w(a a a a a a a  chao chao chao hola hola mundo hola chao cachacho hola)
the_ar.duplicates_counter
{
           "a" => 7,
        "chao" => 4,
        "hola" => 4,
       "mundo" => 1,
    "cachacho" => 1
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-21T02:24:20.403

简单的实现：

```
(errors_hash = {}).default = 0
array_of_errors.each { |error| errors_hash[error] += 1 } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-11-13T18:14:16.287

这是示例数组：

```
a=["aa","bb","cc","bb","bb","cc"] 
```

1.  选择所有唯一键。
2.  对于每个键，我们将它们累积到一个哈希中以获得如下内容：`{'bb' => ['bb', 'bb']}`

```
    res = a.uniq.inject({}) {|accu, uni| accu.merge({ uni => a.select{|i| i == uni } })}
    {"aa"=>["aa"], "bb"=>["bb", "bb", "bb"], "cc"=>["cc", "cc"]}

```

现在您可以执行以下操作：

```
res['aa'].size 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-01-05T21:22:05.200

由于#tally 适用于 2.7 及更高版本，而我还没有，因此很容易在数组上使用 #count 方法。在数组上使用#uniq 来获取数组每个成员的一份副本，然后在数组中找到该成员的#count：

```
counts=Hash.new
arr.uniq.each {|name| counts[name]=arr.count(name) } 
```

例子：

```
arr = [ 1, 2, 2, 3, 3, 3, 3, 3, 4, 4, 5]
arr.uniq => [1, 2, 3, 4, 5]
counts=Hash.new; arr.uniq.each {|name| counts[name]=arr.count(name) } 
```

给我们

```
counts => {1=>1, 2=>2, 3=>5, 4=>2, 5=>1} 
```

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2020-04-19T16:04:43.110

```
def find_most_occurred_item(arr)
    return 'Array has unique elements already' if arr.uniq == arr
    m = arr.inject(Hash.new(0)) { |h,v| h[v] += 1; h }
    m.each do |k, v|
        a = arr.max_by { |v| m[v] }
        if v > a
            puts "#{k} appears #{v} times"
        elsif v == a
            puts "#{k} appears #{v} times"
        end 
    end
end

puts find_most_occurred_item([1, 2, 3,4,4,4,3,3]) 
```

# python - Django 形式的懒惰选择

> ID：569696
> 
> 赞同：23
> 
> 时间：2009-02-20T14:18:37.293
> 
> 标签：python, django, forms, lazy-evaluation

我有一个这样的 Django my_forms.py：

```
class CarSearchForm(forms.Form):  
    # lots of fields like this
    bodystyle = forms.ChoiceField(choices=bodystyle_choices()) 
```

每个选择例如（“轿车”、“轿车（15 辆汽车）”）。所以选择是由这个函数计算的。

```
def bodystyle_choices():  
    return [(bodystyle.bodystyle_name, '%s (%s cars)' %  
          (bodystyle.bodystyle_name, bodystyle.car_set.count()))  
          for bodystyle in Bodystyle.objects.all()] 
```

我的问题是每次我只导入 my_forms.py 时都会执行选择函数。我认为这是由于 Django 声明其字段的方式：在类中但不在类方法中。这很好，但是我的views.py 导入了my_forms.py，因此无论使用哪个视图，都会在每个请求上完成选择查找。

我认为也许将choices=bodystyle_choices 不带括号会起作用，但我得到：

```
'function' 对象不可迭代
```

显然我可以使用缓存并将“import my_forms”放在所需的视图函数中，但这并没有改变重点：我的选择需要是懒惰的！

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-05-10T11:21:16.050

您可以使用“懒惰”功能:)

```
from django.utils.functional import lazy

class CarSearchForm(forms.Form):  
    # lots of fields like this
    bodystyle = forms.ChoiceField(choices=lazy(bodystyle_choices, tuple)()) 
```

非常好的实用功能！

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-20T14:33:58.177

尝试使用 ModelChoiceField 而不是简单的 ChoiceField。我认为你可以通过稍微调整你的模型来实现你想要的。查看[文档](http://docs.djangoproject.com/en/dev/ref/forms/fields/#modelchoicefield)了解更多信息。

我还要补充一点，ModelChoiceFields`lazy`默认是 :)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-03-27T01:08:09.523

您现在可以使用（因为我认为是 Django 1.8）：

```
class CarSearchForm(forms.Form):  
    # lots of fields like this
    bodystyle = forms.ChoiceField(choices=bodystyle_choices) 
```

注意缺少的括号。如果您需要传递参数，我只需为该表单制作一个特殊版本的函数，并将它们硬编码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-04-08T14:32:53.987

扩展 Baishampayan Ghose 所说的话，这可能应该被认为是最直接的方法：

```
from django.forms import ModelChoiceField

class BodystyleChoiceField(ModelChoiceField):
    def label_from_instance(self, obj):
        return '%s (%s cars)' % (obj.bodystyle_name, obj.car_set.count()))

class CarSearchForm(forms.Form):  
    bodystyle = BodystyleChoiceField(queryset=Bodystyle.objects.all()) 
```

文档在这里：[https ://docs.djangoproject.com/en/1.8/ref/forms/fields/#modelchoicefield](https://docs.djangoproject.com/en/1.8/ref/forms/fields/#modelchoicefield)

这样做的好处`form.cleaned_data['bodystyle']`是`Bodystyle`实例而不是字符串。

# sql - sql查询查找非映射列值

> ID：569697
> 
> 赞同：0
> 
> 时间：2009-02-20T14:19:05.453
> 
> 标签：sql, plsql

很难用语言来形容，所以假设这个示例表：

```
| 编号 | col1 | col2 |
--------------------
| 1 | 啊 | 12 |
| 2 | 啊 | 12 |
| 3 | bb | 13 |
| 4 | 抄送| 13 |

```

我想要一个选择第 3 行和第 4 行甚至只是值 13 的查询

所以类似于检查这个假设：“col2 的所有相同值都应该映射 col1 的一个值”

我一直在通过对单独查询中的每一列进行“分组依据”和行数进行检查并进行比较，但是能够挑选出有问题的行会很好

查询或 pl/sql 过程会很好

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T14:25:59.897

只得到“13”：

```
select col2
from mytable
group by col2 having count(distinct col1) > 1; 
```

要获取行：

```
select * from mytable where col2 in
( select col2
  from mytable
  group by col2 having count(distinct col1) > 1
); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T14:24:18.577

如果您想要的是基于唯一 col1 的 col2，就是这样：

```
SELECT col2 FROM [table] GROUP BY col1 HAVING count(id) = 1; 
```

如果您希望 col2 基于唯一的 col1 和 col2 值，则以下内容应该有效：

```
SELECT col2 FROM [table] GROUP BY col1, col2 HAVING count(id) = 1; 
```

# vba - 从 VBA 访问串行端口的最佳方法是什么？

> ID：569698
> 
> 赞同：11
> 
> 时间：2009-02-20T14:19:13.407
> 
> 标签：vba, serial-port, powerpoint, com-interface

从 VBA 访问串行端口的最佳方法是什么？

我需要我们的一些销售代表能够从 PowerPoint 中的操作按钮通过串行端口发送一个简单的字符串。我不常用 VBA，尤其是像这样的东西。通常我会把它变成某种应用程序，但我实际上并不认为这个想法是那么糟糕。这将是他们在投影仪上演示此设备并与其他销售人员和非技术人员交谈时的便捷工具。此外，这个销售人员对 VBA 或 PowerPoint 演示文稿进行小的修改也没有问题，但在重新编译 .NET 应用程序时就不行了。

我知道我们可以通过从动作演示文稿中运行的批处理文件来做到这一点，但这并不让我很高兴。我想我们可能可以访问一个 COM 对象并从那里运行，但我对在 VBA 中使用的最新和最好的库并不真正了解，而且快速了解如何轻松打开它也很不错，发送并关闭连接。

由于这将需要在多人的计算机上运行，​​因此如果它可以轻松地传输到其他机器上会很好。我应该可以说它必须在 Office 2007 和 Windows XP 上运行。不过，与其他任何东西的兼容性将是一个不错的奖励。

我应该如何处理这个？有什么好的提示或技巧吗？图书馆推荐？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-18T13:18:48.927

Win32 API 将串行端口作为文件处理。您可以通过从 VBA 中调用这些 API 函数直接访问串行端口。我必须为旧的 .NET 应用程序执行此操作，但 VBA 也不例外。

而不是在这个网站上为你散列，这是我多年来一直坚持的参考。[如何在 VBA 中进行串口通信](http://www.thescarms.com/vbasic/commio.aspx "如何在 VBA 中进行串口通信")

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2017-01-11T22:52:52.997

```
Sub Stinky()
Dim COM_Byte As Byte
Dim Received_Lines As Long
Dim Input_Buffer As String
Dim Output_Buffer As String
Dim Chars2Send As Long
Dim CharsRemaining As Long
Dim lfsr As Long
    Open "COM7:9600,N,8,1" For Random As #1 Len = 1
    Input_Buffer = ""
    CharsRemaining = 0
    Do
    Get #1, , COM_Byte
    If COM_Byte Then
        If COM_Byte = 13 Then           ' look for CR line termination
            Debug.Print Input_Buffer, Now   ' print it
            Input_Buffer = ""               ' and clear input buffer
        '   generate some output (9 characters)
            lfsr = &H3FFFFFFF - 2 ^ (Received_Lines And 15)
            Output_Buffer = "?@@@@@@@@"
            Chars2Send = 9
            CharsRemaining = 9
            For j = 0 To 2
                Mid(Output_Buffer, 2 + j, 1) = Chr(Asc(Mid(Output_Buffer, 2 + j, 1)) + (31 And Int(lfsr / 32 ^ (2 - j))))
            Next j
            Debug.Print Output_Buffer
        '   show what I generated
            Received_Lines = Received_Lines + 1 ' keep track of received line count
        Else
            Input_Buffer = Input_Buffer & Chr(COM_Byte) ' assemble output buffer
        '   process any characters to send
            If CharsRemaining Then
                CharsRemaining = CharsRemaining - 1
                COM_Byte = Asc(Mid(Output_Buffer, Chars2Send - CharsRemaining, 1))
                Put #1, , COM_Byte
            End If
        End If
    End If
    DoEvents
    Loop
    Close
End Sub 
```

这对我有用。我不确定 OPEN 是否真的设置了波特率，因为我第一次使用 TeraTerm。我的 COM 端口是与 BASYS3 原型开发套件的 USB 连接。它在 9600 处喷出字符，以 CR 结尾的 36 个字符的记录。我可以随机发送 9 个字符的命令。在上面的代码中，我每次收到新行时都会生成这些命令字符串。我选择发送哪个字符的方式有点笨拙：也许更好的方法是拥有一个字符指针和多个字符，当它们相等时将它们都设置为零。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-11-02T18:38:28.270

这是一个简短的 VBA 代码模块，可以在 PC 串行端口上发送和接收消息。这不是很优雅，但很简单，应该适用于现代版本的 Excel 和 Windows。

您可以自行扩展功能并存储或解析消息。这只是显示处理串行端口的低级内容。

前 5 行声明毫秒“睡眠”库函数（基于 Excel 版本）。

SerialPort() 子例程概述了打开端口、传输一些数据、接收一些数据、再次尝试接收一些数据（以表明它确实没有与“文件结束”错误发生冲突）和关闭端口的步骤。港口。

* * *

```
#If VBA7 Then ' Excel 2010 or later
    Public Declare PtrSafe Sub Sleep Lib "kernel32" (ByVal Milliseconds As LongPtr)
#Else ' Excel 2007 or earlier
    Public Declare Sub Sleep Lib "kernel32" (ByVal Milliseconds As Long)
#End If

Public Sub SerialPort()
    ' open a COM port, transmit a message, gather results, close the port.

    ' open the COM port as file #1
    Debug.Print "Open COM port 4"
    Open "COM4:115200,N,8,1" For Binary Access Read Write As #1

    transmit$ = Chr(2) + "Hello, World." + Chr(13)
    receiveDummy$ = "~~~"

    ' transmit a message
    Put #1, , transmit$
    Debug.Print "Message sent."

    ' wait a bit for a response
    Sleep 100

    ' check for received message
    Debug.Print "Look for incoming message."
    On Error Resume Next
    Do While True
        receive$ = receiveDummy$  'dummy value
        Input #1, receive$
        If receive$ = receiveDummy$ Then Exit Do  'the string didn't change, so move on
        Debug.Print receive$
    Loop
    On Error GoTo 0

    ' do it again to show that the empty input queue doesn't stop the flow
    Debug.Print "Look again for incoming message (should not stop on error)."
    On Error Resume Next
    Do While True
        receive$ = receiveDummy$  'dummy value
        Input #1, receive$
        If receive$ = receiveDummy$ Then Exit Do  'the string didn't change, so move on
        Debug.Print receive$
    Loop
    On Error GoTo 0

    ' close the serial port
    Debug.Print "Close COM port."
    Close #1

    Debug.Print "Done."
End Sub 
```

# dry - 您如何使用 xy 坐标跟随 DRY 代码？

> ID：569705
> 
> 赞同：3
> 
> 时间：2009-02-20T14:22:08.800
> 
> 标签：dry, coordinates

您将如何以您选择的语言在此示例中获得梦寐以求的 DRY 理想：

```
drawLine(Point(0, 0), Point(w, 0));
int curRowY = 0;
for(int row=0; row<rowHeights.size(); row++) {
    curRowY += rowHeights[row];
    drawLine(Point(0, curRowY), Point(w, curRowY));
}

drawLine(Point(0, 0), Point(0, h));
int curColX = 0;
for(int col=0; col<colWidths.size(); col++) {
    curColX += colWidths[col];
    drawLine(Point(curColX, 0), Point(curColX, h));
} 
```

*注意：大量的 ad-hoc 预处理器宏的*可读性和可写性可能极低，因此已淘汰。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T14:52:59.410

答案很简单：向量。例如

```
repeatLines(Point start, Point end, Vector direction, int[] gaps)
    {
    drawLine(start, end);
    for (int i = 0; i < gaps.Length; i++)
        {
        Vector vector = direction * gaps[i];
        start += vector;
        end += vector;
        drawLine(start, end);
        }
    }

repeatLines(Point(0, 0), Point(0, w), Vector(1, 0), rowHeights);
repeatLines(Point(0, 0), Point(h, 0), Vector(0, 1), colWidths); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T14:45:03.237

[我同意斯图尔特的观点，但我坚持作为学术练习。]

棘手...

在某种程度上，你并没有*真正*重复自己。你正在做两件相似的事情，它们（字面上和比喻上）彼此正交。

我想您可以执行以下操作，尽管它不再具有可读性并且当然不再具有更高的性能：

[伪 C#]：

```
void DrawGrid()
{
    DrawLines(w, rowHeights, true);
    DrawLines(h, colWidths, false);
}

void DrawLines(int lineLength, int[] lineSeparations, bool isHorizontal)
{
    MyDrawLine(Point(0, 0), Point(lineLength, 0), isHorizontal);
    int offset = 0;
    for (int i = 0; i < widths.length; i++)
    {
        offset  += lineSeparations[i];
        MyDrawLine(Point(offset, 0), Point(offset, lineLength), isHorizontal);
    }
}

void MyDrawLine(Point startPoint, Point endPoint, bool isHorizontal)
{
    if (isHorizontal)
    {
        SwapXAndYCoordinates(startPoint);
        SwapXAndYCoordinates(endPoint);
    }

    drawLine(startPoint, endPoint);
} 
```

再想一想，我认为这只是一个愚蠢的想法...... :-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T14:33:38.663

也许，在这种情况下，你把 DRY 太过分了？

尽管如此，作为一项学术练习，我期待看到是否有人能提出与您当前代码一样可读的解决方案 - 但没有明显的重复！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:02:17.453

如果您的网格是方形的，我认为以下方法可以工作：

```
void drawGrid()
{
    for(int i = 1, offset = 10; i <= numPoints; i++, offset += 10)
    {
        Point p = new Point(i * offset, i * offset);

        drawHorizontal(p);
        drawVertical(p);
    }
}

void drawHorizontal(Point p)
{
    drawLine(new Point(0, p.y), new Point(width, p.y));
}

void drawVertical(Point p)
{
    drawLine(new Point(p.x, 0), new Point(p.x, height));
} 
```

# .net - 在 .NET 中转换 VB6 PropertyBag

> ID：569707
> 
> 赞同：2
> 
> 时间：2009-02-20T14:22:40.093
> 
> 标签：.net, vb.net, vb6, propertybag

对于某些文件操作，我们使用 VB6 的 PropertyBag 对象通过 Content 属性将各种项目转换为字节数组。然后我们将字节数组保存为二进制文件的一部分。稍后当我们加载文件时，我们读回文件，读入字节数组并使用属性包的读取属性重构项目。我们经常使用它来存储客户徽标等图像。

.NET 框架对使用 PropertyBags 有哪些支持？除了编写 COM 帮助程序 DLL 之外。属性包是仅 VB6 的构造还是它们是通用 OLE/COM 自动化框架的一部分？

我希望避免编写 VB6 辅助 DLL 并直接访问（通过声明）所需的 COM 函数。我不希望复制功能，而是将存储在 bytearray 中的对象转换为它们的 .NET 等效项。

**注意：**我对在 .NET 中实现属性包的功能不感兴趣。只有能够读取已保存的 VB6 属性包的字节。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T07:13:19.967

.NET 中对 PropertyBags 的支持为 0。对象的序列化替换了 PropertyBag 构造。

所以在我看来，你有两个选择。

1.  咬紧牙关，编写 10 或 20 行的 Interop dll。
2.  分析序列化属性包的内容，看看你是否可以解码它并找出图像和流的偏移量等。

我知道我要去哪一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-05T19:45:54.670

您可以在他的[旧 VB6 示例页面](http://www.mvps.org/emorcillo/en/code/vb6/index.shtml)上查看 Edanmo 的**加载并将图片保存到字节数组**示例。它非常简单，可用于“序列化”任何实现 IPersistStream 接口的对象，例如 ADODB.Recordset。VB6 的 PropertyBag 将 IPersistStream 用于对象，并可能实现“自定义”VT_Xxx 变体类型序列化。

顺便说一句，Edanmo 的代码片段允许您读取通过复制/粘贴存储到 Access 网格的图像列的图像。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-01-07T12:56:48.963

值得指出的是，您可以通过在项目中引用 VB6 运行时 DLL 从 .NET 直接访问 VB6 PropertyBag。

添加对：（ `C:\WINDOWS\SysWow64\MSVBVM60.DLL` 或可能在 System32 文件夹中）的引用

然后您将在对象浏览器中看到 PropertyBag：

[![在此处输入图像描述](https://i.stack.imgur.com/PESOc.png)](https://i.stack.imgur.com/PESOc.png)

请注意，此 VB6 类不具有读取/写入磁盘文件、字节数组等的功能。它仅管理内存数据 (AFAIK)。因此，仅此一项并不能解决如何以 PropertyBag 存储的任何格式保存/加载数据的问题。

# php - 使用 PHP 发送回复邮件

> ID：569712
> 
> 赞同：-1
> 
> 时间：2009-02-20T14:24:33.613
> 
> 标签：php, email, email-spam

我正在使用 PHP 向那些向我发送邮件的人发送回复邮件。

我的问题是当我发送电子邮件时，它位于垃圾邮件文件夹中。我该怎么做才能正确投递邮件。我该怎么办？

### 我的代码

```
<?php
    $email_id="welcome@gmail.com";
    $recipient = "@gmail.com"; //Recipient
    $mail_body = $message; //Mail body
    $subject = "Subject ".$Name.""; //Subject
    $header = "From: ". $Name . " <" . $email . ">\r\n"; //Optional headerfields
    $header .='Content-type: text/plain; charset=utf-8'."\r\n";
    mail($recipient, $subject, $mail_body, $header); /mail command :)
?> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T14:36:40.120

确保使用发送电子邮件地址填充 From、Reply-To、Sender、Return-Path 和 Errors-To 标头。但是，电子邮件可能被过滤为垃圾邮件的原因有很多——您的 ISP 可能被阻止，邮件的内容可能包含使其被标记的内容，等等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T14:39:01.783

问题不一定在您的代码中。一种可能是您的服务器的邮件传输代理配置错误——我曾经遇到过[这个](http://cbl.abuseat.org/helocheck.html)问题。值得检查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T18:39:46.157

问题不是来自您的代码。您可能需要配置您的服务。为了被大多数电子邮件服务提供商接受，您应该设置 [DomainKey](http://en.wikipedia.org/wiki/DomainKeys)或[Sender Id](http://en.wikipedia.org/wiki/Sender_ID)。

如果您在专用服务器上运行此代码，还应确保您的[IP 地址](http://en.wikipedia.org/wiki/IP_address)未列入黑名单。

# c# - Java 和 C# 的并行开发

> ID：569714
> 
> 赞同：2
> 
> 时间：2009-02-20T14:25:03.143
> 
> 标签：c#, java, maintenance

我正在维护两个非常相似的调度程序——一个在 Java 中，一个在 C# 中。C# 版本最初是使用 JLCA 创建的，然后手动修改。在过去的几周里，Java 版本已经被其他人进行了相当大的修改（所以我必须追踪他的更改），我想知道是否使用 Internet 上可用的工具之一重新转换它，或者是否只是尝试每次需要时手动进行更改。这个问题对我来说很可能经常出现 - 有没有办法维护两种不同语言的软件版本并尽可能轻松地保持同步？！建议将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T14:30:10.590

我不确定这是否适合您，但您可能需要考虑使用 Java 进行开发，然后使用[IKVM](http://www.ikvm.net/)将 jar 文件转换为 .NET 程序集。我已经有几年没有使用它了，但当时它工作得很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T15:14:45.380

我使用现成的代码转换器以两种不同的语言*维护*项目的经历非常糟糕（请注意，我没有说要*转换*，我完全相信使用自动化工具进行初始转换/清理可能有优点.)

[有些人经常支持多个平台](http://www.joelonsoftware.com/items/2006/09/01b.html)，[他们喜欢指出没有自己的内部工具的语言选择的痛苦](http://www.joelonsoftware.com/items/2006/09/01.html)，但他们倾向于使用专门的语言或按照约定将自己绑定到一组语言结构，以便他们的中间编译器可以为他们完成繁重的工作。

缺少一些很酷的专有交叉编译器和与之相伴的代码约定，我会手动完成这项工作。诀窍将是严格监控签入，并确保在两个地方都检查功能。根据问题的严重程度，您可以发明一个源代码控制流程（范围可能从压迫性和痛苦到相对较轻的重量），以帮助保证这一点（例如，您可以要求开发人员仅签入对分支的更改直到端口在两个平台上都完成，此时您将它们合并。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T14:57:10.633

我会亲自手动维护差异。这意味着如果在某些时候在 .NET 中做一些不同的事情更有意义（很可能是这种情况，以使代码符合习惯），您不需要继续手动重新应用该更改。

另一种选择是转换原始 Java 代码，复制它，然后转换修改后的 Java 代码。比较两次转换的结果，并将该更改应用于您现有的代码，以便轻松完成。这样可以在保留现有代码的同时使您免于进行“gruntwork”转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:04:39.400

你考虑过J#吗？

根据您的需要和配置，您可以将 Java 代码交叉编译为 Java 和 J#。您可能需要将公共部分重构为一个单独的模块，以便在任一环境中编译（J# 停留在 Java 1.2，只有几个 1.3 类）。

请记住，J# 是旧的，并且在 VS 2008 中不再可用（您需要 Visual Studio 2005 的旧副本），但是根据您项目的复杂性，这可能是一个可行的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T15:30:52.003

如果它们如此相似，维护两个版本有什么真正的优势吗？也许你可以放弃其中一个...

# windows-services - 将 Windows 服务连接到 QuickBooks 的工作示例...？

> ID：569715
> 
> 赞同：1
> 
> 时间：2009-02-20T14:25:19.993
> 
> 标签：windows-services, quickbooks

任何人都可以提供连接到 QuickBooks 桌面版的 Windows 服务的工作示例吗？

我可以使用 QuickBooks SDK 中的示例代码让我的控制台应用程序正常连接，但它似乎没有作为 Windows 服务做任何事情......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T13:36:20.263

QBSDK 不喜欢使用 QBW 文件的 Windows 服务（或 IIS）。他们有一个解决方法，但它并不漂亮，而且根据我的经验，它并不太可靠。

它需要一个名为 QBXMLRP2e.exe 的 COM 组件

[开发者指南](http://dev.developer.intuit.com/qbSDK-current/doc/pdf/DevGuideQBFC.pdf)有一些关于它的信息，但谷歌搜索会提供更好的结果。

我会提供一些我在尝试使用它时编写的代码，但是a）它被遗弃了，我不知道它到底在哪里，b）它一开始就不能正常工作，所以我不想要让你误入歧途。

抱歉，我无法提供更多帮助。

# vb.net - 在 VB.NET 中将 UTF-8 转换为 ASCII

> ID：569725
> 
> 赞同：3
> 
> 时间：2009-02-20T14:28:25.290
> 
> 标签：vb.net, character-encoding

我正在编写一个控制台应用程序，它读取来自不同邮箱的电子邮件并通过它们进行处理。从各种自动化系统接收电子邮件。电子邮件消息被记录和/或转发。

问题是某些电子邮件以 UTF-8 编码并以引用打印格式传输编码，这会混淆特殊字符（主要是 ä、ö 和 å）。我还没有找到任何将它们转换为可读格式的解决方案。

例如，quoted-printable 中的“ä”是“=C3=A4”。使用正常的转换方法，结果是“Ã¤”（胡言乱语）。

我无耻地从这里撕掉了这个示例转换表：http: [//forums.sun.com/thread.jspa?threadID=5315363](http://forums.sun.com/thread.jspa?threadID=5315363)

```
char 代码点 UTF-8 编码为 Latin-1

ä 11100100 = E4 11000011 10100100 = C3 A4 = \u00C3\u00A4
å 11100101 = E5 11000011 10100101 = C3 A5 Ã¥ = \u00C3\u00A5
ö 11110110 = F6 11000011 10110110 = C3 B6 ö = \u00C3\u00B6

Ä 11000100 = C4 11000011 10000100 = C3 84 ? = \u00C3\u0084
Å 11000101 = C5 11000011 10000101 = C3 85 × = \u00C3\u0085
Ö 11010110 = D6 11000011 10010110 = C3 96 ? = \u00C3\u0096

```

那么如何从 UTF-8 值中获取真正的代码点呢？我宁愿不使用任何外部库。此外，我已经尝试过几次，但都失败了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T14:32:17.057

我不完全确定，但这可能会奏效：

```
Encoding.ASCII.GetString(Encoding.UTF8.GetBytes(yourString)) 
```

我现在不在我的电脑上，所以我无法测试它，但我会稍后尝试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T14:32:56.323

您需要从 UTF-8 转换为 Latin1 - 在进行引用可打印转换之后。

[http://msdn.microsoft.com/en-us/library/66sschk1.aspx](http://msdn.microsoft.com/en-us/library/66sschk1.aspx)看起来很有希望。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T00:47:03.773

从您描述的效果来看，我猜您是通过直接连接到 POP3 邮箱来获取电子邮件的？如果是这样，那么您将收到**原始**格式的电子邮件，并且这些邮件中的大多数很可能是 MIME 格式。

MIME（[维基百科](http://en.wikipedia.org/wiki/MIME)有一个很好的概述）是一个相当大且复杂的标准，实现一个可靠地处理您想要涵盖的所有案例的 MIME 解析器可能需要几周时间。

因此，我会考虑使用为您完成这项工作的第三方 MIME 库。

# javascript - 外部JS和浏览器

> ID：569730
> 
> 赞同：1
> 
> 时间：2009-02-20T14:30:28.047
> 
> 标签：javascript, internet-explorer, caching

我有一个包含在我的 ASPX 页面中的外部 JS 文件。每当我对 JS 进行更改时，我都需要关闭浏览器并重新打开它以查看更改。我试过 Ctrl F5 来刷新缓存的 JS 副本，但这在 IE 中不起作用。

有没有办法不重新启动浏览器来查看更新的更改？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T15:33:37.223

正如其他人所建议的那样，我将切换到 Firefox 进行开发，并将 IE 仅用于测试。

如果您想继续在 IE 上进行开发，请尝试使用[Internet Explorer Developer Toolbar](http://www.microsoft.com/en-us/download/details.aspx?id=18359)。它提供了 Firebug 的一些功能，您可以快速访问禁用缓存或清除特定域缓存的选项，从而解决您的缓存问题。

![缓存菜单](https://lh5.ggpht.com/_EuP0VgCBcqk/SZ7OqlxsyuI/AAAAAAAACV0/4cVa_syswwQ/s800/capturaIEDevToolbar.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T14:35:46.830

我有时会在其他选项卡中打开 JavaScript 或 CSS 文件并强制重新加载这些选项卡以让 IE 理解“请重新加载所有内容，不，真的，所有内容”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T14:31:54.063

单击刷新按钮时尝试按住 shift 键。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T14:33:24.700

以我的经验，IE 非常积极地缓存事物。您可能需要多次按 Ctrl + F5，直到您的更改出现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T14:48:38.657

Ctrl-F5 或 Shift + 单击刷新可能会起作用。如果没有，您可以从工具/Internet 选项/常规/临时文件/删除中强制清除缓存。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T15:00:24.213

我强烈建议在另一个浏览器中开发......激进的缓存对于 IE来说可能会很*痛苦。*开发完成后，您可以返回并在 IE 中进行测试。

此外，作为 Web 开发人员， [Firebug](http://getfirebug.com/)（或类似的东西）是我不能没有的。另一个不错的 Firefox 插件是[Web Developer Toolbar](https://addons.mozilla.org/en-US/firefox/addon/60)（它有一个简单的菜单选项来清除 FF 的缓存）。

如果您宁愿坚持使用 IE，我认为 James Socol 将内容保存在其他选项卡中将是避免缓存的最可靠方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T15:18:58.460

您是否将 IE 设置为每次都检查更新版本的存储页面？

工具-->Internet选项-->设置[btn]-->每次访问页面[广播]

# php - 无法让 PHP 在 Vista 64 上使用 mySQL

> ID：569731
> 
> 赞同：3
> 
> 时间：2009-02-20T14:30:36.203
> 
> 标签：php, mysql, windows-vista, 64-bit

我正在运行 Vista 64 机器，并尝试使用 IIS7 设置 Joomla（我喜欢 Joomla，我想在我的网站上有一些 asp.net 组件，所以这就是我想使用 IIS7 而不是 Apache 的原因）。*这是我第一次同时安装 php 和 mysql，所以很可能我做错了什么……尽管我认为我尝试了足够多的诊断步骤（如下所述），对我来说*没有什么明显的错误……

我安装了 PHP（32 位，5.2.8），这似乎工作正常：我有一个 test.php，它在 IIS7 提供的网页中显示 phpinfo。

我还安装了 mySQL（32 位，5.1.31，从[http://dev.mysql.com/downloads/mysql/5.1.html#win32](http://dev.mysql.com/downloads/mysql/5.1.html#win32)下载）。这似乎也可以正常工作（我可以使用 MySQL Administrator 连接到它）。

我已经设置了 php.ini 和什么不打开 mySQL 扩展。如果我从命令行执行 php -m，我会在列表中看到 mysql 。但是，对于 phpinfo（来自命令行 (php -info) 或通过 IIS（在 test.php 文件中）提供服务），没有 mysql 部分。因为 mysql 甚至没有出现在 php 的命令行调用中，所以我认为这与 IIS 没有任何关系——只是在 vista 上安装了 mysql 和 php。

我没有安装 mysql 64 位，因为我安装了 32 位 php，并且由于 mysql 32 位似乎工作正常，我认为这不是问题。似乎没有官方的 64 位版本的 php，所以这就是我安装它的原因（同样，这似乎工作正常）。

我目前禁用了 UAC，所以这不是问题。

如果我在我的 php.ini 中将分号放回 extension=php_mysql.dll 的前面，那么在运行 php -m 时，mysql 模块不会出现。如果我再把它拿出来，它就会出现。所以我至少可以确定我正在修改正确的 php.ini 。

我已将 libeay32.dll、libmysql.dll 和 php_mysql.dll 复制到 c:\windows\system32。我已经把它们拿出来了，这似乎对 php -m 的输出没有影响（即，如果从 php.ini 中取消注释模块，mysql 仍然显示在那里）。

我还尝试将 dll ibeay32.dll、libmysql.dll 和 php_mysql.dll 复制到 c:\windows\sysWOW64; 这没有什么区别。

从命令行运行 php -info 似乎最小的积极步骤是 mysql 出现。还有什么我应该尝试弄清楚为什么mysql出现在php -m而不是php -info中的原因吗？还是我用它来衡量php是否可以与mysql对话？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T15:39:41.547

我已经解决了大部分。

答案是将 libmysql.dll 复制到 sysWOW64。不需要其他 dll，也不需要将任何内容复制到 system32。我猜这是在 64 位系统上使用 php32 的结果。

起初我认为这不起作用，因为从命令行运行 php -info 仍然不显示 mysql。但是，从 IIS 提供的 php 文件运行 phpinfo 会显示 mysql。

我仍然不知道为什么从命令行运行 php -info 时没有显示 mysql，但我想我现在可以忍受这个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T16:16:00.133

如果您想专注于 php 开发，我强烈建议您不要手动安装这些东西，而是从[http://www.apachefriends.org/en/xampp.html下载 xampp](http://www.apachefriends.org/en/xampp.html)

基本上，这是一个经过全面测试和构建的软件包，它将链接软件并为您提供完整的开发环境。

还有其他 apache/php/mysql 捆绑包。

这里的问题是，只要你让 apache php 与 mysql 一起工作，你就可以轻松配置 IIS 连接器，并且不会破坏 mysql 连接

还记得检查一切

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:21:39.187

您确定`php.ini`CLI 和 IIS 使用相同吗？在 POSIX 兼容的系统上，php 通常使用两个不同的系统。根据我的经验，无意中使用了错误的 php.ini 是Windows 上 php*的*主要障碍。

尝试稍微改变 php.ini 中的一个选项（比如`memory_limit`to`129M`代替`128M`左右），然后使用[ini_get](http://php.net/ini_get)来确定这个改变是否会影响 php@IIS/@CLI。如果这确实只影响 php@IIS，请搜索`php.ini`on `C:`- 也许还有第二个（通常在`PATH`, like中`C:\Windows\php.ini`）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:31:57.727

以下是我成功遵循的一篇不错的分步文章的链接。它没有专门针对 x64，但老实说，我认为这不是您的配置的问题。 [关联](http://www.atksolutions.com/articles/install_php_mysql_iis.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T12:49:24.527

我在 vista 64 上遇到了几乎相同的问题，问题是 system32 中 php 安装中的 libmysql.dll 被我替换的 mysql 安装覆盖，mysqladmin 和 joomla 工作正常。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T13:22:58.197

您还可以尝试在 IIS7 中为 32 位应用程序设置单独的应用程序池，然后在池的高级设置中，将“启用 32 应用程序”设置为 true（默认为 false）。然后将 php 站点设置为使用该应用程序池。

# silverlight - 最新版本的 Silverlight 是否以任何方式依赖于 .Net 3.0、3.5？

> ID：569743
> 
> 赞同：2
> 
> 时间：2009-02-20T14:33:22.983
> 
> 标签：silverlight

如果您阅读了[Silverlight 2 月 18 日发布](http://download.microsoft.com/download/F/D/8/FD8F5947-78FF-40A5-9A34-5E35243C12E4/40115/Microsoft%20Silverlight%20Release%20History.html#Silverlight2GDR1)的发行说明，您将看到一行内容：

***尝试在未安装任一框架的机器上使用需要 .Net Framework 3.0 或 3.5 的功能时出现正常失败***

这是什么意思？Silverlight 肯定与完整的 .Net 3.0 或 3.5 框架没有直接依赖关系。当它在 OS X 上运行并且假设在 Windows 和 OS X 上运行之间没有区别时，它怎么可能？

有人知道这件事吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T15:31:19.990

Jeff - short answer: NO. In the release notes this comment refers to UIAutomation implementations in Silverlight, not the core features.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T14:59:05.230

我不能代表该网站的信誉，但我发现[此](http://maordavid.blogspot.com/2007/07/does-silverlight-require-net-framework.html)链接指出：

> 关于 Silverlight 的一个常见问题是 -“是否需要安装 .NET Framework 才能使用 Silverlight？”。答案是否定的。
> 
> .NET Framework 的跨平台版本包含在 4MB Silverlight 1.1 下载中，这意味着您不需要在客户端上安装任何额外的东西。
> 
> .NET Framework 的 Silverlight 版本包括与完整 .NET Framework 一起提供的相同 CLR 引擎，以及 .NET Framework 命名空间库的子集。

我还发现[这个](http://silverlight2.blogspot.com/2008/01/silverlight-doesn-require-net-to-run.html)站点解释了虽然运行时不需要 .NET，但在构建时需要它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:04:27.777

Silverlight 运行时基本上是 .NET 运行时的迷你版。如果您运行的 C# 代码执行的操作需要不属于子集的功能，那么它现在会尝试不崩溃。

Various subsets of the .NET runtime have been ported to non-Windows systems, Silverlight's just the most widely-known one.

# jquery - 在 jQuery 中，如何在固定高度的父级中制作幻灯片动画？

> ID：569749
> 
> 赞同：2
> 
> 时间：2009-02-20T14:34:28.910
> 
> 标签：jquery, html, css

我在具有固定高度的容器内的元素上使用 jQuery 幻灯片动画时遇到问题。我的应用程序中有一个页面，其中有一个大的可滚动 div，其中包含许多较小的 div，每个 div 代表用户收件箱中的“消息”。在每个消息 div 中都有一个“删除”按钮，当单击该按钮时，通过使用 jQuery 的`slideUp()`函数将消息从较大的框架中隐藏起来。

在我将 max-height 属性添加到容器 div 之前，这一切正常。现在，当单击删除按钮时，没有动画，而是 div 立即消失在视线之外。如果我从框架中删除 max-height 属性，动画效果很好，但由于框架可以包含任意数量的消息，我真的需要它有一个最大高度，并且当它超过该高度时可以滚动。

我尝试用`slideUp()`我自己的动画函数替换内置函数，并将 max-height 替换为固定高度，但这些都不起作用。

这些是一些相关的 CSS 和 JS 示例：

```
//css  
div.messageList  
    {  
        border: solid 1px #B22222;  
        cursor: default;  
        color: #000000;  
        max-height: 800px;  
        overflow: auto;  
        width: 100%;  
    }  

.unreadMessage  
    {  
        margin: 2px;  
        border: solid 1px #B22222;  
        text-align: left;  
        background-color: #98FB98;  
    }  

//js  
function hideMessage(id) {  
        $('#' + id).slideUp(500);  
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T15:10:38.510

我假设当您编写框架时，您并不是指实际框架，而是指您包含的 DIV (.messageList)

```
 <style type="text/css">
            div.messageList  
            {  
                border: solid 1px #B22222;
                cursor: default;  
                color: #000;  
                max-height: 200px;
                overflow: auto;  
            }

            div.messageListContainer  
            {

            }

            .unreadMessage  
            {
                padding: 5px;
                margin: 2px;
                cursor: pointer;
                border: solid 1px #B22222;  
                text-align: left;  
                background-color: #98FB98;  
            }  
        </style>
        <script type="text/javascript">
            $(document).ready(function(){
                $(".unreadMessage").click(function(){ $(this).slideUp(500); });
            });
        </script>
        <div class="messageList">
            <div class="messageListContainer">
                <div class="unreadMessage">Lorem ipsum dolor sit amet, consectetur dipiscing elit. Nullam tempus.</div>
                <div class="unreadMessage">Lorem ipsum dolor sit amet, consectetur dipiscing elit. Nullam tempus.</div>
                <div class="unreadMessage">Lorem ipsum dolor sit amet, consectetur dipiscing elit. Nullam tempus.</div>
                <!-- Add more messages to test -->

            </div>
        </div> 
```

这在 IE7 和 FF3 中对我有用，但我不能说[max-height](http://www.w3schools.com/Css/pr_dim_max-height.asp)是跨浏览器兼容的，但我认为我所拥有的就是你想要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-24T20:36:47.693

我尝试了第一个答案，它至少在 Firefox 上也适用于我：你可以[在这里](http://jsbin.com/etibu)看到它。

建议：检查您的文档类型。试试这个：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
```

尝试通过“live('click',callback)”函数而不是“bind('click',callback)”来绑定你的事件。由于您的内容是通过 ajax 加载的，因此可以确保事件在页面加载时附加到 DOM 中不存在的元素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T21:23:14.847

这不是一个解决方案，而是一种解决方法，您是否考虑过允许整个页面滚动（而不仅仅是那个 div）？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T23:16:54.083

我的猜测是 dom 正在超载，而您只看到 1 帧动画。尝试 .slideUp(20000) 以确定是否存在真正的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T10:32:47.423

感谢猎人的建议。我试过了，恐怕它对我不起作用。我的事件绑定、css 和 div 布局或多或少完全符合您的建议，并且动画仍然跳跃。更多细节，虽然我不确定如何相关：

*   页面上的内容是使用 JQuery 的 load() 函数异步加载的。
*   这是一个 ASP.NET MVC 应用程序
*   我正在使用 IE7。

现在我已经用闪烁和淡入淡出动画替换了幻灯片，这并不是世界末日，但我很想知道如何解决这个问题。

PS我不确定我是否应该将其发布为我自己问题的答案，我对这个网站很陌生，它告诉我我没有足够的声誉来发表评论。

谢谢。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-10T19:28:27.570

像 john c 我也假设你的处理程序没有绑定到 .load()-ed dom。尝试使用 livequery 来解决这个问题。我这里有一个例子：h [ttp://www.madnet.ch/2009/02/28/gallery-included/](http://www.madnet.ch/2009/02/28/gallery-included/)

# silverlight - 在 Silverlight 中控制渲染顺序 (ZOrder) 而不使用 Canvas 控件

> ID：569751
> 
> 赞同：6
> 
> 时间：2009-02-20T14:35:25.443
> 
> 标签：silverlight, xaml, silverlight-2.0

我通过将 UserControl 添加到父控件的“Children”集合中，以编程方式将 UserControl 添加到 Silverlight 2 中的另一个。起初，这很好用。如果我对窗口执行其他操作（在我的情况下，我将整个面板滚动出视图然后返回视图），那么它显然会更改渲染顺序并导致我的控件位于其他控件之后。我正在寻找一种方法来控制这种行为，以强制我的窗口位于顶部。Canvas 控件有一个 ZOrder 属性，允许您设置它，但我没有使用 Canvas，我使用的是 Grids。

我玩过使用 Children.Insert 并弄乱索引，这也改变了渲染顺序，但这似乎是解决问题的一种笨拙方式。我怎样才能强制我的控制在上面？

——马特

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T23:36:51.920

Canvas.ZIndex 将适用于 Grid（以及从 UIElement 派生的任何其他控件）。

正如您从[http://msdn.microsoft.com/en-us/library/bb979730(VS.95).aspx](http://msdn.microsoft.com/en-us/library/bb979730(VS.95).aspx)中看到的那样， 任何从 UIElement（Silverlight 中所有渲染元素的基类）派生的东西都支持 Canvas.ZIndex属性，以及 Canvas.Top 和 Canvas.Left。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T16:55:05.630

在 Grid 中，ZOrder 应该由 order 或 Children 决定。位置 0 位于底部，位置 1 位于位置 0 的顶部，依此类推。

我不确定我是否同意您可以将 Canvas.ZIndex 与网格一起使用 - 它是 Canvas 的附加属性，因此仅当您的 Grid 在 Canvas 中时才可用。

[http://msdn.microsoft.com/en-us/library/system.windows.controls.canvas.zindex(VS.95).aspx](http://msdn.microsoft.com/en-us/library/system.windows.controls.canvas.zindex(VS.95).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T15:49:46.670

您应该能够在网格中使用 Canvas.ZIndex，它实际上命名错误，应该是 Panel.ZIndex 但它应该可以工作。

# python - 如何判断哪个对象属性泡菜失败？

> ID：569754
> 
> 赞同：35
> 
> 时间：2009-02-20T14:36:09.343
> 
> 标签：python, serialization

当您腌制具有某些无法腌制的属性的对象时，它将失败并显示一般错误消息，例如：

```
PicklingError: Can't pickle <type 'instancemethod'>: attribute lookup __builtin__.instancemethod failed 
```

有什么方法可以判断哪个属性导致了异常？我正在使用 Python 2.5.2。

尽管我原则上理解问题的根本原因（例如，在上面的示例中具有实例方法），但仍然很难*准确定位它*。就我而言，我已经定义了一个自定义`__getstate__`方法，但忘记了一个关键属性。这发生在嵌套对象的复杂结构中，所以我花了一段时间来识别坏属性。

根据要求，这是一个简单的示例，泡菜故意失败：

```
import cPickle as pickle
import new

class Test(object):
    pass

def test_func(self):
    pass

test = Test()
pickle.dumps(test)
print "now with instancemethod..."
test.test_meth = new.instancemethod(test_func, test)
pickle.dumps(test) 
```

这是输出：

```
now with instancemethod...
Traceback (most recent call last):
  File "/home/wilbert/develop/workspace/Playground/src/misc/picklefail.py", line 15, in <module>
    pickle.dumps(test)
  File "/home/wilbert/lib/python2.5/copy_reg.py", line 69, in _reduce_ex
    raise TypeError, "can't pickle %s objects" % base.__name__
TypeError: can't pickle instancemethod objects 
```

不幸的是，没有暗示该属性`test_meth`会导致问题。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-20T19:30:46.623

您可以针对 Python 提交错误，因为它不包含更多有用的错误消息。同时，修改中的`_reduce_ex()`函数`copy_reg.py`。

```
if base is self.__class__:
    print self # new   
    raise TypeError, "can't pickle %s objects" % base.__name__ 
```

输出：

```
<bound method ?.test_func of <__main__.Test object at 0xb7f4230c>>
Traceback (most recent call last):
  File "nopickle.py", line 14, in ?
    pickle.dumps(test)
  File "/usr/lib/python2.4/copy_reg.py", line 69, in _reduce_ex
    raise TypeError, "can't pickle %s objects" % base.__name__
TypeError: can't pickle instancemethod objects 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-08-28T04:04:50.237

我和你有同样的问题，但是我的类有点复杂（即类似对象的大树），所以打印没有太大帮助，所以我一起破解了一个辅助函数。它不完整，仅适用于酸洗协议 2：这已经足够了，所以我可以找到我的问题。如果您想扩展它以涵盖所有内容，该协议在[http://www.python.org/dev/peps/pep-0307/](http://www.python.org/dev/peps/pep-0307/)中进行了描述，我已将这篇文章设为可编辑，以便每个人都可以更新代码。

```
import pickle
def get_pickling_errors(obj,seen=None):
    if seen == None:
        seen = []
    try:
        state = obj.__getstate__()
    except AttributeError:
        return
    if state == None:
        return
    if isinstance(state,tuple):
        if not isinstance(state[0],dict):
            state=state[1]
        else:
            state=state[0].update(state[1])
    result = {}    
    for i in state:
        try:
            pickle.dumps(state[i],protocol=2)
        except pickle.PicklingError:
            if not state[i] in seen:
                seen.append(state[i])
                result[i]=get_pickling_errors(state[i],seen)
    return result 
```

K 是不腌制的对象的用法示例

```
>>> get_pickling_errors(K)
{'_gen': {}, '_base': {'_gens': None}} 
```

这意味着属性 K._gen 不可提取，对于 K._base._gens 也是如此。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-10-20T23:01:38.370

我发现如果您将 Pickler 子类化并尝试将 Pickler.save() 方法包装起来，除了块

```
import pickle
class MyPickler (pickle.Pickler):
    def save(self, obj):
        try:
            pickle.Pickler.save(self, obj)
        except Exception, e:
            import pdb;pdb.set_trace() 
```

然后像这样称呼它

```
import StringIO
output = StringIO.StringIO()
MyPickler(output).dump(thingee) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-08-06T22:55:07.437

如果您使用`dill`，您的示例不会失败...

```
>>> import dill
>>> import new
>>> 
>>> class Test(object):
...     pass
... 
>>> def test_func(self):
...     pass
... 
>>> test = Test()
>>> dill.dumps(test)
'\x80\x02cdill.dill\n_create_type\nq\x00(cdill.dill\n_load_type\nq\x01U\x08TypeTypeq\x02\x85q\x03Rq\x04U\x04Testq\x05h\x01U\nObjectTypeq\x06\x85q\x07Rq\x08\x85q\t}q\n(U\r__slotnames__q\x0b]q\x0cU\n__module__q\rU\x08__main__q\x0eU\x07__doc__q\x0fNutq\x10Rq\x11)\x81q\x12}q\x13b.'
>>> test.test_meth = new.instancemethod(test_func, test)
>>> dill.dumps(test)
'\x80\x02cdill.dill\n_create_type\nq\x00(cdill.dill\n_load_type\nq\x01U\x08TypeTypeq\x02\x85q\x03Rq\x04U\x04Testq\x05h\x01U\nObjectTypeq\x06\x85q\x07Rq\x08\x85q\t}q\n(U\r__slotnames__q\x0b]q\x0cU\n__module__q\rU\x08__main__q\x0eU\x07__doc__q\x0fNutq\x10Rq\x11)\x81q\x12}q\x13U\ttest_methq\x14h\x01U\nMethodTypeq\x15\x85q\x16Rq\x17cdill.dill\n_create_function\nq\x18(cdill.dill\n_unmarshal\nq\x19Ubc\x01\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00C\x00\x00\x00s\x04\x00\x00\x00d\x00\x00S(\x01\x00\x00\x00N(\x00\x00\x00\x00(\x01\x00\x00\x00t\x04\x00\x00\x00self(\x00\x00\x00\x00(\x00\x00\x00\x00s\x07\x00\x00\x00<stdin>t\t\x00\x00\x00test_func\x01\x00\x00\x00s\x02\x00\x00\x00\x00\x01q\x1a\x85q\x1bRq\x1cc__builtin__\n__main__\nU\ttest_funcq\x1dNN}q\x1etq\x1fRq h\x12N\x87q!Rq"sb.' 
```

所以我们必须找到`dill`不能腌制的东西......

```
>>> class Unpicklable(object):
...   def breakme(self):
...     self.x = iter(set())
... 
>>> u = Unpicklable()
>>> dill.dumps(u)
'\x80\x02cdill.dill\n_create_type\nq\x00(cdill.dill\n_load_type\nq\x01U\x08TypeTypeq\x02\x85q\x03Rq\x04U\x0bUnpicklableq\x05h\x01U\nObjectTypeq\x06\x85q\x07Rq\x08\x85q\t}q\n(U\r__slotnames__q\x0b]q\x0cU\n__module__q\rU\x08__main__q\x0eU\x07breakmeq\x0fcdill.dill\n_create_function\nq\x10(cdill.dill\n_unmarshal\nq\x11U\xafc\x01\x00\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00C\x00\x00\x00s"\x00\x00\x00d\x01\x00d\x00\x00l\x00\x00}\x01\x00t\x01\x00t\x02\x00\x83\x00\x00\x83\x01\x00|\x00\x00_\x03\x00d\x00\x00S(\x02\x00\x00\x00Ni\xff\xff\xff\xff(\x04\x00\x00\x00t\t\x00\x00\x00itertoolst\x04\x00\x00\x00itert\x03\x00\x00\x00sett\x01\x00\x00\x00x(\x02\x00\x00\x00t\x04\x00\x00\x00selfR\x00\x00\x00\x00(\x00\x00\x00\x00(\x00\x00\x00\x00s\x07\x00\x00\x00<stdin>t\x07\x00\x00\x00breakme\x02\x00\x00\x00s\x04\x00\x00\x00\x00\x01\x0c\x01q\x12\x85q\x13Rq\x14c__builtin__\n__main__\nh\x0fNN}q\x15tq\x16Rq\x17U\x07__doc__q\x18Nutq\x19Rq\x1a)\x81q\x1b}q\x1cb.'
>>> u.breakme()
>>> dill.dumps(u)
Traceback (most recent call last):
…(snip)… 
pickle.PicklingError: Can't pickle <type 'setiterator'>: it's not found as __builtin__.setiterator
>>> 
```

如果错误消息不好，我可以用`dill.detect`它来查看顶级对象包含哪些不可提取的对象。

```
>>> dill.detect.badobjects(u, depth=1)
{'__hash__': <method-wrapper '__hash__' of Unpicklable object at 0x10a37b350>, '__setattr__': <method-wrapper '__setattr__' of Unpicklable object at 0x10a37b350>, '__reduce_ex__': <built-in method __reduce_ex__ of Unpicklable object at 0x10a37b350>, '__reduce__': <built-in method __reduce__ of Unpicklable object at 0x10a37b350>, '__str__': <method-wrapper '__str__' of Unpicklable object at 0x10a37b350>, '__format__': <built-in method __format__ of Unpicklable object at 0x10a37b350>, '__getattribute__': <method-wrapper '__getattribute__' of Unpicklable object at 0x10a37b350>, '__delattr__': <method-wrapper '__delattr__' of Unpicklable object at 0x10a37b350>, 'breakme': <bound method Unpicklable.breakme of <__main__.Unpicklable object at 0x10a37b350>>, '__repr__': <method-wrapper '__repr__' of Unpicklable object at 0x10a37b350>, '__dict__': {'x': <setiterator object at 0x10a370820>}, 'x': <setiterator object at 0x10a370820>, '__sizeof__': <built-in method __sizeof__ of Unpicklable object at 0x10a37b350>, '__init__': <method-wrapper '__init__' of Unpicklable object at 0x10a37b350>}
>>> dill.detect.badtypes(u, depth=1)
{'__hash__': <type 'method-wrapper'>, '__setattr__': <type 'method-wrapper'>, '__reduce_ex__': <type 'builtin_function_or_method'>, '__reduce__': <type 'builtin_function_or_method'>, '__str__': <type 'method-wrapper'>, '__format__': <type 'builtin_function_or_method'>, '__getattribute__': <type 'method-wrapper'>, '__delattr__': <type 'method-wrapper'>, 'breakme': <type 'instancemethod'>, '__repr__': <type 'method-wrapper'>, '__dict__': <type 'dict'>, 'x': <type 'setiterator'>, '__sizeof__': <type 'builtin_function_or_method'>, '__init__': <type 'method-wrapper'>}
>>> set(dill.detect.badtypes(u, depth=1).values())
set([<type 'dict'>, <type 'method-wrapper'>, <type 'instancemethod'>, <type 'setiterator'>, <type 'builtin_function_or_method'>]) 
```

`dill`不依赖于`__getstate__`存在的方法，尽管如果它存在，它可能应该使用它。您还可以使用`objgraph`来获取用于构建不腌制事物的所有对象依赖项的图片。根据以上信息，它可以帮助您理清问题的根源。

请参阅`dill.detect`在此问题中追踪不可提取项目的用途：[https ://github.com/uqfoundation/dill/issues/58](https://github.com/uqfoundation/dill/issues/58)

# winapi - 如何在 Win32 上从 Emacs 打印？

> ID：569758
> 
> 赞同：7
> 
> 时间：2009-02-20T14:36:52.647
> 
> 标签：winapi, emacs, printing

我在 Windows XP 上运行从[此处](http://ourcomments.org/Emacs/EmacsW32.html)下载的 Emacs 23.0.60.1，并将网络打印机配置为默认打印机。

如何设置 Emacs 以轻松打印缓冲区内容？

Win32 的修补 Emacs 版本的[文档](http://ourcomments.org/Emacs/EmacsW32Util.html)提到“快速和简单”打印，但“快速打印”菜单条目没有出现，并且常规条目（“打印缓冲区”、“Postscript 打印缓冲区”）似乎没有做任何事物。

**编辑：**
我对 Emacs 22.3 的官方 Windows 版本有同样的问题。因此，任何版本的设置/故障排除说明将不胜感激。

**EDIT2：**
我使用了下面 Joe Casadonte 提出的 PrintFile 解决方案，效果很好。不过，我仍然会对为什么“正确”方式不起作用的任何想法感兴趣。

*（顺便说一句，这是一个适当的 SO 问题，只是与编程相关吗？）*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-08-17T20:19:20.893

我将使用通用 USB 打印机描述 Windows 7 的所有内容。根据您的版本调整需要的过程。网络通常可以以相同的方式访问。只需使用`//NetworkComputerName/SharedPrinterName`而不是 //MyComputer/MyPrinter 并跳过步骤 1.-6..

1.  转到*开始 -> 控制面板 -> 硬件和声音 -> 设备和打印机*
2.  右键单击您的打印机选择“打印机属性”
3.  转到“共享”并选中“共享这台打印机”和“在客户端计算机上渲染打印作业”
4.  输入共享名称：`MyPrinter`或您能记住且没有空格的名称。
5.  单击确定以保存您的更改。
6.  转到*开始 -> 计算机*以检查左下角的计算机名称（例如`MyComputer`）
7.  在 Emacs 中评估`(setq printer-name "//MyComputer/MyPrinter")`或将其放入您的 .emacs.el 文件中
8.  完毕。您可以使用打印文件`M-x print-buffer`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T05:16:54.903

这不是“正确”的方式，但我多年来一直这样做，而且效果很好。我使用[PrintFile](http://www.lerup.com/printfile/)，一个免费的打印程序（也可以单独使用）。然后我的 .emacs 中有这个：

```
(defun joc-make-fname-from-buffer-name (buffer-name-in)
  "Returns a valid filename from a given buffer name"
  (interactive "b")
  (save-match-data
    (let* ((start (string-match "[^ \*]" buffer-name-in))
           (end (string-match "[ \*]*$" buffer-name-in (match-end 0)))
           (rc (substring buffer-name-in start end)))
      ;; remove some special characters
      (while (string-match "[:]+" rc)
        (setq rc (replace-match "_" t t rc)))
      rc)))

(when is-win32
    (defun joc-print-buffer-or-region (prefix)
      "Prints buffer or region via PrintFile32\.  If a prefix arg is set (via C-u) then
       the current region is printed, otherwise the current buffer is printed."

      (interactive "P")

      ;; ----- set the print directory, fname and args -----
      (let* ((print-dir (expand-file-name "~/emacs/print"))
             (print-fname (joc-make-fname-from-buffer-name (buffer-name)))
             (print-fullpath (concat print-dir "/" print-fname))
             (print-args "/delete")
             ;; ----- set rstart and rend to the current region -----
             (rstart (point-min)) (rend (point-max)))

        ;; ----- if prefix given, set them to region -----
        (if (and prefix)
            (if (and (point) (mark) (/= (point) (mark)))
                (progn (setq rstart (min (point) (mark)))
                       (setq rend (max (point) (mark))))
              (error "No region defined")))

        ;; ----- make the directory -----
        (if (not (file-directory-p print-dir))
            (make-directory print-dir))

        ;; ----- write buffer/region to a temp file, print it, delete directory -----
        (write-region rstart rend print-fullpath)
        (call-process "prfile32" nil t nil print-args print-fullpath)
        (delete-directory print-dir)))) 
```

我已经很多年没有看过它了，因为它可以正常工作，所以我相信它可以改进。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T10:06:05.910

将以下行添加到您的 emacs 初始化文件

```
(setq printer-name "//domain/printer-name") 
```

# debugging - 你如何使用 postgres 调试函数？

> ID：569764
> 
> 赞同：5
> 
> 时间：2009-02-20T14:38:38.137
> 
> 标签：debugging, postgresql

我正在使用 pgAdmin III 1.8.4 并发现它是一个苛刻的情妇。

编写存储过程（函数）时，没有查询编译。所以我不知道我的函数是否会工作，直到我调用它。

其他人如何解决这个缺陷？（除了第一次做对：p）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T14:42:48.187

`EnterpriceDB`包括[**PL/PGSQL 调试器**](http://www.enterprisedb.com/products/postgres_plus_as/debugging.do)，您可以使用它来逐步执行代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T14:45:10.427

为它写一个单元测试。当然，这不会为您提供调试能力，但理想情况下，您应该有一个单元测试套件（和一个集成测试套件），您可以针对您的代码运行证明它有效......并且让您知道什么时候出现问题。

# perl - 如何在 Perl foreach 循环中一次读取两个项目？

> ID：569772
> 
> 赞同：38
> 
> 时间：2009-02-20T14:41:28.753
> 
> 标签：perl, loops

我正在寻找的是这样的：

```
@list = qw(1 2 3 4 5 6);
foreach (@list) {
  #perl magic goes here 
  print "i: $i, j:$j\n";
} 
```

返回：

```
i:1, j:2
i:3, j:4
i:5, j:6 
```

为了响应下面的一个非常好的建议，我需要指定这个脚本将在其他人的构建服务器上运行，并且不允许我使用来自 CPAN 的任何模块。仅限标准 Perl。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-20T14:57:50.927

我相信正确的方法是使用来自[List::MoreUtils 的natatime](https://metacpan.org/pod/List::MoreUtils)：

来自文档：

> natatime 块列表
> 
> 创建一个数组迭代器，用于一次以项目块循环遍历数组`$n`。（`n`一次，明白了吗？）。一个例子可能比我能用语言给出的解释更好。

例子：

```
 my @x = ('a' .. 'g');
 my $it = natatime 3, @x;
 while (my @vals = $it->())
 {
     print "@vals\n";
 } 
```

这打印

```
美国广播公司
定义
G

```

的实施[`List::MoreUtils::natatime`](http://search.cpan.org/perldoc/List::MoreUtils)：

```
sub natatime ($@)
{
    my $n = shift;
    my @list = @_;

    return sub
    {
        return splice @list, 0, $n;
    }
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-20T14:51:45.217

我会使用拼接。

```
my @list = qw(1 2 3 4 5 6);
while(my ($i,$j) = splice(@list,0,2)) {
  print "i: $i, j: $j\n";
} 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-20T14:43:28.357

我想你会想以不同的方式做到这一点。试试这个：

```
while (scalar(@list) > 0) {
    $i = shift(@list);
    $j = shift(@list);
    print "i: $i, j:$j\n";
} 
```

请记住，这将破坏列表，但它适用于那个小循环。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-02-20T18:23:30.187

### 设置一些测试数据，然后导入[`say`](http://search.cpan.org/perldoc/Modern::Perl)：

```
use Modern::Perl;
use List::AllUtils qw'zip';

my @array = zip @{['a'..'z']}, @{[1..26]} ; 
```

### 使用增量变量的简单循环。

```
 {
      my $i = 0;
      while(
        (my($a,$b) = @array[$i++,$i++]),
        $i <= @array # boolean test
      ){
        say "$a => $b";
      }
    } 
```

### 使用.[`List::Pairwise`](http://search.cpan.org/perldoc?List::Pairwise)  [`(pair)`](http://search.cpan.org/perldoc?List::Pairwise#pair)

```
 use List::Pairwise qw'pair';

    for my $pair (pair @array){
      my($a,$b) = @$pair;

      say "$a => $b";
    } 
```

### 一次循环遍历数组 2，使用.[`List::MoreUtils`](http://search.cpan.org/perldoc?List::MoreUtils)  [`(natatime)`](http://search.cpan.org/perldoc?List::MoreUtils#natatime)

```
 use List::AllUtils qw'natatime';

    my $iter = natatime 2, @array;
    while( my($a,$b) = $iter->() ){
      say "$a => $b";
    } 
```

### 将其强制为散列，并遍历键。如果您不关心订单，这很有用。

```
 {
      my %map = @array;
      for my $key (keys %map){
        my $value = $map{$key};
        say "$key => $value";
      }
    } 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-02-20T14:51:14.250

不幸的是，最接近的等价物是老派：

```
for(my $ix = 0; $ix <= $#list; $ix += 2) {
    my $i = $list[$ix];
    my $j = $list[$ix + 1];
    print "i: $i, j:$j\n";
} 
```

我更喜欢 Jack M 的回答，真的，虽然我会用更性感的 Perl 来写：

```
while(@list) {
    my $i = shift @list;
    my $j = shift @list;
    print "i: $i, j:$j\n";
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-20T19:31:18.650

如果我只能使用没有模块的标准 Perl，我可能会使用 C 风格的 for 循环，计数为 2：

```
for( my $i = 0; $i &lt; @array; $i += 2 ) {
    my( $j, $k ) = @array[ $i, $i+1 ];
    ...
    } 
```

如果您有奇数个元素，则必须决定如何处理额外的元素。你的问题可能不在乎你得到一个未定义的额外元素，因为你特别需要对。

简单地读取数组末尾并不会改变数组，所以这部分很好。

如果你必须有对，一个简单的策略可能是在数组的末尾添加一个适当的值，这样你总是以对结束。同样，您可以删除最后一个元素（或任何元素）以再次以偶数结束。这些取决于你的问题。

否则，您将做更多的工作：

```
for( my $i = 0; $i < @array; $i += 2 ) {
    push @pair, $array[$i];
    push @pair, $array[$i+1] if $i+1 <= $#array;
    ... 
    } 
```

但是，如果您想从其中一个无法使用的模块中获得一些花哨的东西，您可以将该模块添加到您的代码中。如果您可以编写代码，则可以使用模块。您可能只需要在适当设置时将模块包含在您提供的所有代码中`@INC`。这是[inc::Module::Install](http://search.cpan.org/dist/Module-Install)和[PAR](http://search.cpan.org/dist/PAR)的基本思想。

我花了很多时间使用构建系统来创建自己的 CPAN 存储库，从其私有 CPAN 安装其依赖项，然后测试代码。拥有一个构建农场并不排除使用模块。这是当地的政策。但是，即使有可能，这也可能并非在所有情况下都有意义。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-04-30T11:22:35.343

冒着死灵术标签的风险，我决定从 Tim Toady 的背包中再添加一个：

```
for (0 .. $#list) {
    next if $_ % 2;
    my ($i, $j) = @list[$_, $_ + 1];
    say "i:$i, j:$j";
} 
```

非破坏性、无重复列表、无状态变量且相当简洁。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-20T14:54:15.337

您可能希望创建一个简单的子例程以使其适合您。

我建议这样做：

```
{
  my $cl_ind = 0;
  sub arrayeach(@) {
    my @obj = @_;
    if(($cl_ind+2) > @obj)
    {
      $cl_ind = 0;
      return;
    }
    $cl_ind+=2;
    return ($obj[$cl_ind-2],$obj[$cl_ind-1]);
  }
} 
```

封闭使其工作干净。使用 arrayeach （它的工作方式类似于 hash each 而不需要对数组进行危险的强制：

```
my @temp = (1,2,3,4,5,6,1,2,3,4,5,6);
while( ($a,$b) = arrayeach(@temp)) {
  print "A $a AND $b\n";
} 
```

这是非破坏性的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-10-18T18:31:19.913

通用功能解决方案怎么样。

```
use Carp; # so mapn can croak about errors

sub mapn (&$@) {
    my ($sub, $n, @ret) = splice @_, 0, 2;
    croak '$_[1] must be >= 1' unless $n >= 1;
    while (@_) {
        local *_ = \$_[0];
        push @ret, $sub->(splice @_, 0, $n)
    }
    @ret
}

sub by ($@) {mapn {[@_]} shift, @_}
sub every ($@); *every = \&by; 
```

该`mapn`函数的工作方式与 类似`map`，不同之处在于其块之后的第一个参数是要采用的元素数。它将第一个元素 `$_` 和所有元素放在 `@_` .

```
print mapn {"@_\n"} 2 => 1 .. 5;
# prints
1 2
3 4
5 
```

接下来的两个相同的子，`by`并`every`为各种循环结构创建有用的副词。他们使用 mapn 处理列表，并返回所需大小的数组引用列表

```
print "@$_\n" for every 2 => 1..10;

print map {"@$_\n"} grep {$_->[1] > 5} by 2 => 1..10; 
```

我发现这是一种比 natatime 或其他一次性解决方案（如 ac 样式 for loop）更清洁、更直观的解决方案。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-06-21T12:43:35.737

```
my $i;
for ( qw(a b c d) ) {
    if (!defined($i)) { $i = $_; next; }
    print STDOUT "i = $i, j = $_\n";
    undef($i);
} 
```

输出：

```
i = a, j = b
i = c, j = d 
```

它也适用于列表，不仅适用于数组。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-20T16:09:39.867

正如 Mirod 解释的那样，它没有太多代码。这几乎就是你需要的一切。（请注意，我没有对奇数列表等进行任何检查。）

```
#!/usr/bin/env perl
use strict;
use warnings;

my @list = qw/1 2 3 4 5 6/;
my $get_em = get_by(2, @list);

while ( my ($i, $j) = $get_em->() ) {
  print "i: $i, j: $j\n";
}

sub get_by {
  my $n = shift;
  my @list = @_;

  return sub {
    return splice @list, 0, $n;
  }
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-12-15T11:34:16.597

小型阵列的快速解决方案：

```
for ( map {$_*2} 0..@list/2-1 ){
    my ($i, $j) = @list[$_,$_+1];
    print "i: $i, j:$j\n";
} 
```

某种单线

数据：

```
@v = (a=>1, b=>2, c=>3); 
```

这

```
print join ', ', map{sprintf '%s:%s', $v[$_], $v[$_+1]} grep {!($_%2)} 0..$#v 
```

或类似的东西

```
print join ', ', map {sprintf '%s:%s', @v[$_,$_+1]} map {$_*2} 0..@v/2-1; 
```

结果是一样的

```
a:1, b:2, c:3 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-20T14:53:43.467

使用 for 循环可以满足您的需要。

```
use strict;
use warnings;

my @list = qw(1 2 3 4 5 );
my $i = 0;

for ($i = 0; $i < scalar(@list); $i++)
{
    my $a = $list[$i];
    my $b = $list[++$i];
    if(defined($a)) {
        print "a:$a";
    }
    if(defined($b)) {
        print "b:$b";
    }   
    print "\n";
} 
```

**编辑**：我更正了我的帖子以使用标量函数来检索数组的大小，并添加一些检查以防数组不包含偶数个元素。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-01-09T14:10:23.593

另一种方法，不完全清洁，但可用。每个创建迭代器，您可以使用它两次。当参数是经典数组时，它返回索引和值，请阅读：[https ://perldoc.perl.org/functions/each.html](https://perldoc.perl.org/functions/each.html)

所以，你的代码可以是这样的：

```
my @array=qw(one two three four five); #five element as unpaired will be ignored
while (my ($i1,$one,$i2,$two)=(each(@array),each(@array)) {
  #we will use $ix for detect end of array
  next unless defined $i1 and defined $i2; #secure complete end of array
  print "fetched array elements: $one => $two\n";
}; 
```

上面的示例不会破坏源数据，反对移位或类似的。我希望这对任何人都有帮助。当然，使用普通迭代器的情况要好得多。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-20T18:34:08.677

我想出了这段代码来解决类似的要求：

```
sub map_pairs(&\@) {
    my $op = shift;
    use vars '@array';
    local *array = shift;    # make alias of calling array

    return () unless @array;

    # Get package global $a, $b for the calling scope
    my ($caller_a, $caller_b) = do {
        my $pkg = caller();
        no strict 'refs';
        \*{$pkg.'::a'}, \*{$pkg.'::b'};
    };

    # Get index counter size.
    my $limit = $#array/2;

    # Localize caller's $a and $b
    local(*$caller_a, *$caller_b);

    # This map is also the return value
    map {
        # assign to $a, $b as refs to caller's array elements
        (*$caller_a, *$caller_b) = \($array[$_], $array[$_+1]);
        $op->();    # perform the transformation
    } 
    map { 2 * $_ } 0..$limit;  # get indexes to operate upon.
} 
```

你像这样使用它：

```
@foo = qw( a 1 b 2 c 3 );
my @bar = map_pairs { "$a is $b" } @foo; 
```

要得到：

```
@bar = ( 'a is 1', 'b is 2', 'c is 3' ); 
```

我一直想提交给 List::MoreUtils 的维护者，但我没有提供 XS 版本。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-20T23:39:31.860

这是一个不复制列表的 natatime 实现：

```
sub natatime {
  my $n = shift;
  my $list = \@_;

  sub {
    return splice @$list, 0, $n;
  }
}

my $it = natatime(3, qw(1 2 3 4 5 6));
while ( my @list = $it->() ) {
  print "@list\n";
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-04-23T20:57:17.767

这可以非破坏性地完成，[Eric Strom](https://stackoverflow.com/users/189416/eric-strom)简直太棒了[`List::Gen`](https://metacpan.org/pod/List::Gen)：

```
perl -MList::Gen=":utility" -E '@nums = "1" .. "6" ; 
      say "i:$_->[0] j:$_->[1]" for every 2 => @nums' 
```

**输出**：

```
i:1 j:2 
i:3 j:4 
i:5 j:6 
```

**编辑**（添加无 CPAN 版本）：

数组切片和 C 样式 for loop *à la* [brian d foy](https://stackoverflow.com/a/570914/2019415)和[Tom Christiansen](https://stackoverflow.com/a/29590758/2019415)！这可以理解为“使用索引 ( `$i`) 一次循环遍历一个`@list` `foreach` `$n`元素”：

```
use v5.16; # for strict, warnings, say

my @list = "1" .. "6";
my $n = 2 ;   # the number to loop by
$n-- ;        # subtract 1 because of zero index

foreach (my $i = 0 ; $i < @list ; $i += $n ) { 
  say "i:", [ @list[$i..$i+$n] ]->[0], " j:", [ @list[$i..$i+$n] ]->[1];
  $i++ ;          
} 
```

`->[0]`我们将结果作为匿名数组 ( ) 的元素 ( ) 访问`[ ]`。对于更通用的输出，可以单独使用插值数组切片，*例如*：根据需要`print "@list[$i..$i+$n]";`更改 的值`$n`。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-11-18T05:13:57.600

将元素数除以二，迭代一。打印索引和下一个：

```
print "i:$list[$_*2], j:$list[$_*2+1]\n" for 0..$#list/2; 
```

或者，如果您想要一个完整的块：

```
foreach my $i ( 0..$#list/2 ) { print "i:$list[$i*2], j:$list[$i*2+1]\n"; } 
```

或者：

```
foreach my $n ( 0..$#list/2 ) { 
    my ($i,$j) = @list[$n*2,$n*2+1];
    print "i:$i, j:$j\n"; 
} 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2015-04-17T13:18:37.130

~~我认为更简单的方法是使用旧的可怜的“每个”。直接这样：~~

 ~~```
while (my ($key,$value) = each @list) {
        print "$key=$value\n";
} 
```~~  ~~更新：

是的，这是错误的。应该首先将列表转换为哈希，但它可能过于昂贵：

```
my %hash = (@list);
while (my ($key,$value) = each %hash) {
        print "$key=$value\n";
} 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2020-05-06T07:06:38.847

```
while ($#rec>0) {
  my($a,$b) = ( shift(@rec), shift(@rec) );
  print "($a,$b)\n";
} 
```

# asp.net - 在 ASP.NET 中获取网页统计信息

> ID：569773
> 
> 赞同：0
> 
> 时间：2009-02-20T14:42:35.083
> 
> 标签：asp.net, web

您会推荐哪个免费（最好是开源）组件来捕获我在 ASP.NET 下的网站访问统计信息？我有可用的 SqlServer。我更喜欢后端的 db 与文件日志记录，因为它是可报告的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T14:44:59.320

完全放弃日志解析并使用[Google Analytics](http://google.com/analytics)。它更准确，因为它计算未记录的缓存页面视图。它是便携式的。它提供了很多很棒的指标。最重要的是它是免费的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T14:50:02.133

如果您只想跟踪“网页统计信息”，那么最好的办法是通过[Google Analytics](http://www.google.com/analytics/)将其外包给 Google 。

如果您在数据库中记录应用程序特定或业务领域相关的事件，那么将应用程序中的日志数据记录到 SQL 服务器中只会真正为您带来增量收益（超过使用 Google Analytics）。

否则，不值得努力完成 Urchin（谷歌收购分析的公司）和谷歌已经完成的工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T14:53:00.003

作为替代方案（某些人建议的 Google Analytics），您可以拥有一个 ETL 过程来获取 IIS 日志并将它们导入 SQL。然后根据需要运行您的报告（例如 SSRS）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-06T23:52:33.377

如果您在数据库中记录应用程序特定或业务领域相关的事件，那么将应用程序中的日志数据记录到 SQL 服务器中只会真正为您带来增量收益（除了使用 ASP.NET 中的统计信息之外）。

如果您只想跟踪“网页统计信息”，那么您最好的选择是外包我更喜欢后端的 db 与文件日志记录，因为它是可报告的。

请访问：[http ://www.ratin.ir/details/2535/1/1/1/](http://www.ratin.ir/details/2535/1/1/1/)

[回复](http://www.ratin.ir)

# c++ - 智能指针（升压）解释

> ID：569775
> 
> 赞同：230
> 
> 时间：2009-02-20T14:42:46.923
> 
> 标签：c++, boost, smart-pointers

以下一组指针有什么区别？你什么时候在生产代码中使用每个指针，如果有的话？

示例将不胜感激！

1.  `scoped_ptr`

2.  `shared_ptr`

3.  `weak_ptr`

4.  `intrusive_ptr`

你在生产代码中使用 boost 吗？

* * *

## 回答 #1

> 赞同：350
> 
> 时间：2009-02-20T15:19:34.980

### 智能指针的基本属性

当您拥有可以分配每个智能指针的属性时，这很容易。有三个重要的属性。

*   **完全没有所有权**
*   **所有权转让**
*   **所有权份额**

第一个意味着智能指针不能删除对象，因为它不拥有它。第二个意味着只有一个智能指针可以同时指向同一个对象。例如，如果要从函数返回智能指针，则所有权将转移到返回的智能指针。

第三个意思是多个智能指针可以同时指向同一个对象。这也适用于*原始指针*，但是原始指针缺少一个重要特性：它们不定义它们是否*拥有*。如果每个所有者都放弃该对象，则所有权共享智能指针将删除该对象。这种行为恰好经常需要，因此共享拥有智能指针被广泛传播。

一些拥有智能指针既不支持第二个也不支持第三个。因此它们不能从函数返回或传递到其他地方。这最适合`RAII`智能指针保持本地并且刚刚创建以便在对象超出范围后释放对象的目的。

所有权共享可以通过复制构造函数来实现。这自然会复制一个智能指针，并且副本和原始指针都将引用同一个对象。所有权转移目前在 C++ 中无法真正实现，因为没有任何方法可以将某物从一个对象转移到该语言支持的另一个对象：如果您尝试从函数中返回一个对象，那么会发生该对象被复制的情况。因此，实现所有权转移的智能指针必须使用复制构造函数来实现所有权转移。然而，这反过来又破坏了它在容器中的使用，因为需求声明了容器元素的复制构造函数的某种行为，这与这些智能指针的这种所谓的“移动构造函数”行为不兼容。

C++1x 通过引入所谓的“移动构造函数”和“移动赋值运算符”为所有权转移提供了原生支持。它还带有这样一个所有权转移智能指针，称为`unique_ptr`.

### 分类智能指针

`scoped_ptr`是一个既不可转让也不可共享的智能指针。如果您需要在本地分配内存，它只是可用的，但请确保它在超出范围时再次被释放。但如果您愿意，它仍然可以与另一个 scoped_ptr 交换。

`shared_ptr`是共享所有权的智能指针（上面的第三种）。它是引用计数的，因此它可以看到它的最后一个副本何时超出范围，然后释放管理的对象。

`weak_ptr`是一个非拥有的智能指针。它用于引用托管对象（由 shared_ptr 管理）而不添加引用计数。通常，您需要从 shared_ptr 中取出原始指针并复制它。但这并不安全，因为您无法检查对象何时被实际删除。因此，weak_ptr 通过引用由 shared_ptr 管理的对象来提供方法。如果您需要访问该对象，您可以锁定它的管理（以避免在另一个线程中一个 shared_ptr 在您使用该对象时释放它）然后使用它。如果weak_ptr 指向一个已经被删除的对象，它会通过抛出一个异常来通知你。当你有一个循环引用时，使用weak_ptr 是最有益的：引用计数不能轻易应对这种情况。

`intrusive_ptr`就像 shared_ptr 但它不会将引用计数保留在 shared_ptr 中，而是将计数的递增/递减留给需要由托管对象定义的一些辅助函数。这样做的好处是已经引用的对象（其引用计数由外部引用计数机制递增）可以填充到 intrusive_ptr 中 - 因为引用计数不再是智能指针的内部，但智能指针使用现有的引用计数机制。

`unique_ptr`是一个所有权转移指针。您不能复制它，但可以使用 C++1x 的移动构造函数来移动它：

```
unique_ptr<type> p(new type);
unique_ptr<type> q(p); // not legal!
unique_ptr<type> r(move(p)); // legal. p is now empty, but r owns the object
unique_ptr<type> s(function_returning_a_unique_ptr()); // legal! 
```

这是 std::auto_ptr 遵循的语义，但由于缺少对移动的本机支持，它无法为它们提供没有缺陷的。unique_ptr 将自动从临时的其他 unique_ptr 窃取资源，这是移动语义的关键特征之一。auto_ptr 将在下一个 C++ 标准版本中被弃用，取而代之的是 unique_ptr。C++1x 还将允许将只能移动但不能复制到容器中的对象填充。因此，例如，您可以将 unique_ptr 填充到向量中。如果您想了解更多关于此的信息，我将在这里停下来，并为您提供一篇关于此[的精彩文章。](https://devblogs.microsoft.com/cppblog/rvalue-references-c0x-features-in-vc10-part-2/)

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2009-02-20T14:51:22.253

**scoped_ptr**是最简单的。当它超出范围时，它会被销毁。以下代码是非法的（scoped_ptrs 是不可复制的），但会说明一点：

```
std::vector< scoped_ptr<T> > tPtrVec;
{
     scoped_ptr<T> tPtr(new T());
     tPtrVec.push_back(tPtr);
     // raw T* is freed
}
tPtrVec[0]->DoSomething(); // accessing freed memory 
```

**shared_ptr**是引用计数的。每次发生复制或赋值时，引用计数都会增加。每次触发实例的析构函数时，原始 T* 的引用计数都会减少。一旦为 0，指针就被释放。

```
std::vector< shared_ptr<T> > tPtrVec;
{
     shared_ptr<T> tPtr(new T());
     // This copy to tPtrVec.push_back and ultimately to the vector storage
     // causes the reference count to go from 1->2
     tPtrVec.push_back(tPtr);
     // num references to T goes from 2->1 on the destruction of tPtr
}
tPtrVec[0]->DoSomething(); // raw T* still exists, so this is safe 
```

**weak_ptr**是对共享指针的弱引用，需要您检查指向的 shared_ptr 是否仍然存在

```
std::vector< weak_ptr<T> > tPtrVec;
{
     shared_ptr<T> tPtr(new T());
     tPtrVec.push_back(tPtr);
     // num references to T goes from 1->0
}
shared_ptr<T> tPtrAccessed =  tPtrVec[0].lock();
if (tPtrAccessed[0].get() == 0)
{
     cout << "Raw T* was freed, can't access it"
}
else
{
     tPtrVec[0]->DoSomething(); // raw 
} 
```

**intrusive_ptr**通常在您必须使用第 3 方智能 ptr 时使用。它将调用一个免费函数来添加和减少引用计数。有关更多信息，请参阅 boost 文档的[链接。](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/smart_ptr.htm)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-02-20T15:06:34.510

不要忽视[`boost::ptr_container`](http://www.boost.org/doc/libs/release/libs/ptr_container/)任何关于提升智能指针的调查。`std::vector<boost::shared_ptr<T> >`在例如太慢的情况下，它们可能是无价的。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-02-20T14:59:58.957

我赞同有关查看文档的建议。它并不像看起来那么可怕。还有一些简短的提示：

*   `scoped_ptr`- 超出范围时自动删除的指针。注意 - 不能分配，但不会引入开销
*   `intrusive_ptr`- 没有开销的引用计数指针`smart_ptr`。但是对象本身存储引用计数
*   `weak_ptr`- 一起`shared_ptr`处理导致循环依赖的情况（阅读文档，并在谷歌上搜索漂亮的图片；）
*   `shared_ptr`- 通用的、最强大的（和重量级的）智能指针（来自 boost 提供的那些）
*   还有 old `auto_ptr`，它确保它指向的对象在控制离开范围时自动销毁。但是，它具有与其他人不同的复制语义。
*   `unique_ptr`-[将与 C++0x 一起提供](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1856.html)

**对编辑的回应：** 是

# linq - 如何使用 LINQ to Entities 浏览多个关系？

> ID：569782
> 
> 赞同：3
> 
> 时间：2009-02-20T14:44:04.860
> 
> 标签：linq, entity-framework

我刚开始使用 LINQ to Entities，我正在尝试将我们当前在存储过程中执行的搜索复制为 LINQ to Entities 查询。但是，我似乎无法找出正确的方法来查询距查询起点多于一个“连接”的实体的属性。

例如，假设我有表 Campaign、CampaignLocation 和 Location，它们具有从 Campaign 到 CampaignLocation 以及从 CampaignLocation 到 Location 的外键。非常标准的多对多表配置。当我开始像这样编写我的 LINQ 查询时：

```
 var campaigns = from c in context.Campaign.CampaignLocation 
```

这是我可以去的关联链中的尽可能远的地方。“CampaignLocation”上似乎没有可用的“位置”属性，因此我可以过滤位置的属性。

我尝试使用这样的 LINQ 连接语法：

```
 var campaigns = from c in context.Campaign
                 join cl in context.CampaignLocation 
                   on c.CampaignID equals cl.CampaignID 
```

但是“cl”别名上似乎没有“CampaignID”属性。这真的很奇怪，桌子上有一个名为那个的列。它不是在模型对象上，因为它是 Campaign 表的外键吗？

我在哪里出错了，我错过了什么？

**[更新]**

看起来我用于外键的任何整数列都没有被添加为模型对象的属性。显示了外键关系，但不存在 ID 属性。当我从数据库中读取模式时，有什么方法可以让设计人员将这些属性添加到模型中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T14:49:34.397

该属性只是表本身的实体引用，您是否在 EF 模型中为 ComaignLocation<->Location 定义了位置关系？然后根据您实际尝试执行的操作（连接等）。我会考虑使用 linq 连接语法、linq 嵌套查询（可以形成连接）或仅使用您最初拥有的 proc。如果最初有一个 proc 的目的，只需将其拉入您的 EF 模型。

编辑更新：

尝试打开模型并从数据库中刷新这些表，列应该在那里，但是可以手动删除它们。即使列到位，您仍然必须在 EFModel 中自己定义关系。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T15:13:37.270

这些有用吗？

```
 Campaign campaign1 = context.Campaigns.Where(x => x.CampaignID == 1).Single();
    foreach (CampaignLocation campaignlocation in campaign1.CampaignLocations)
    {
        Response.Write(campaignlocation.Location.Name + "<br />");
    }

    Location location1 = context.Locations.Where(x => x.LocationID == 3).Single();
    foreach (CampaignLocation campaignlocation in location1.CampaignLocations)
    {
        Response.Write(campaignlocation.Campaign.Name + "<br />");
    } 
```

（我怀疑您缺少外键或对象引用...）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:24:36.620

替代答案 - 如果您在创建数据库后更改了数据库，则需要手动编辑/重新创建 .edmx 文件？

# windows - 如何编写脚本将文件从 Unix 复制到 Windows？

> ID：569789
> 
> 赞同：0
> 
> 时间：2009-02-20T14:45:27.510
> 
> 标签：windows, unix, vbscript, copy, samba

有什么方法可以制作一个脚本，将文件从 Unix 驱动器复制到 Windows 驱动器上？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T14:52:12.127

我一直使用安全副本（[SCP](http://en.wikipedia.org/wiki/Secure_copy)）手动执行此操作。SCP 已经安装在大多数 Unix 机器上。在我的 PC 上，我安装了[PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/)，它是一个适用于 Windows 的安全终端应用程序，还包含一个安全复制实用程序。

当您从 Windows 命令行手动执行安全复制时，您将 Unix 用户名放入命令行命令，但随后您必须在提示符处输入密码，因此它是交互式的。但我也考虑过从脚本或批处理文件中执行此操作。在这种情况下，您需要在适当的机器上[创建和安装私钥和公钥。](http://the.earth.li/~sgtatham/putty/0.60/htmldoc/Chapter8.html#pubkey-intro)我创建了适当的密钥并将它们安装在 Windows 和 Unix 机器上，然后我再次手动执行 Windows 命令行安全复制，当时它没有**要求**我输入密码。因此，这是您完成任务的一种方式。不过，我敢肯定还有很多其他方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T14:50:23.537

是的，只要执行脚本的操作系统可以从 Unix 驱动器读取并写入 Windows 驱动器。由于这是标记为 vbscript，我假设您在 Windows 上运行，因此您可能希望查看类似[的](http://www.fs-driver.org/)内容以访问 Windows 的 Unix 文件系统（尽管那是 Linux ext 驱动程序）。然后它只是运行一个标准的复制功能来完成你的任务。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T14:57:41.227

既然你有一个 Samba 标签，你是在谈论从 Unix 机器上安装一个网络共享到你的 Windows 机器上吗？

如果是这样，它将被视为普通网络驱动器，您将能够通过共享复制您拥有权限的任何内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-08T13:07:36.150

我会使用[期望](http://expect.sourceforge.net/)工具。

这是一个例子，如何上传

*   `/local/path/to/file`

到

*   `\\HOST\SHARE\remote\path\to\file`

`domain\user`使用密码进行身份验证`password`：

```
expect <<<EOF
set timeout 10
spawn smbclient //HOST/SHARE "-Udomain\\user%password"
expect {
  "smb: \\\\\\\\>" {
    send "cd /remote/path/to\r"
    expect {
      "NT_STATUS_OBJECT_NAME_NOT_FOUND" {exit 1}
      "smb: *>"                         {
        set timeout -1
        send "put /local/path/to/file file\r"
        expect {
          "putting file " {
            expect "smb: *>" {exit 0}
          }
          "smb: *>" {exit 1}
        }
      }
    }
  }
}
# Timeout
exit 1
EOF 
```

# c# - 在 IIS/ASP.NET 的物理文件夹中创建虚拟应用程序/目录

> ID：569797
> 
> 赞同：4
> 
> 时间：2009-02-20T14:47:04.557
> 
> 标签：c#, asp.net, iis, web-config, virtual-directory

我想要实现的很简单：

*   我有一个网站，说“我的网站” - *[http://localhost](http://localhost)*
*   在这个网站上，我有一个（物理）文件夹“foo” - *[http://localhost/foo](http://localhost/foo)*
*   在“foo”文件夹中，我想要一个名为“upload”的虚拟目录（应用程序？），因此 URL 变为*[http://localhost/foo/upload](http://localhost/foo/upload)*

请注意，“my-site”是一个空的网站，里面有一堆文件夹，“foo”、“bar”、“baz”等。

因此，当我右键单击“foo”并选择“新建 > 虚拟目录”并添加我在 VS.NET 中编写的应用程序，然后尝试导航到[http://localhost/foo/upload](http://localhost/foo/upload)时，我收到此错误：

```
Parser Error Message: An error occurred loading a configuration file: Failed to 
start monitoring changes to 'C:\InetPub\my-site\foo\web.config' 
because access is denied. 
```

问题是，**没有**网络配置。在“foo”文件夹中，它不应该，因为它只是站点中的一个普通文件夹。如果我在顶层添加虚拟目录，比如[http://localhost/foo_upload](http://localhost/foo_upload)，一切都会正常运行......那么，我在这里做错了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T15:06:37.570

这听起来像是您的系统的权限问题 - 对于 .NET 帐户，运行 ASP.NET 的用户上下文需要访问您的站点。

在直到 Windows Server 2000 的系统上，该用户是一个简单称为 ASPNET 的本地帐户，之后更改为 NT_AUTHORITY 帐户之一 - 找到它的最简单方法是为 IIS WPG 组（本地组）提供对帐户。

MS 在[http://support.microsoft.com/kb/316721/](http://support.microsoft.com/kb/316721/)上提供了说明，使用上述说明来确定您应该检查访问权限的用户帐户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-02T17:23:59.190

我只是为遇到相同问题并找到此主题的人回答。

我向所有人添加了权限（在这种情况下，它将在文件夹中`C:\InetPub\my-site\foo\`）。然后我在页面上打印了用户在这个文件夹中执行应用程序的内容......

就像是：

```
labelCurrentUser.Text = System.Security.Principal.WindowsIdentity.GetCurrent().Name; 
```

然后我删除了所有人的权限并添加了我得到的用户。

# wpf - 在 WPF 应用程序中存储全局信息的最佳位置在哪里？

> ID：569800
> 
> 赞同：1
> 
> 时间：2009-02-20T14:47:33.900
> 
> 标签：wpf

我是一名前 PHP 开发人员，现在正在开发 WPF/C# 应用程序，并且无法理解访问全局变量的最佳方式以及 UserControls 如何访问主窗口等。

在我的 Window1 类的构造函数中，我将 UserControls 加载到一个内部 Dictionary 中，然后在运行时将它们动态加载到 DockPanel 中，这很好用并保持每个字典的内部状态。

```
public Window1()
{
    InitializeComponent();

    List<string> userControlKeys = new List<string>();
    userControlKeys.Add("Welcome");
    userControlKeys.Add("News");
    Type type = this.GetType();
    Assembly assembly = type.Assembly;
    foreach (string userControlKey in userControlKeys)
    {
        string userControlFullName = String.Format("{0}.Pages.{1}", type.Namespace, userControlKey);
        UserControl userControl = (UserControl)assembly.CreateInstance(userControlFullName);
        _userControls.Add(userControlKey, userControl);
    }

    //set the default page
    btnWelcome.RaiseEvent(new RoutedEventArgs(Button.ClickEvent));
} 
```

**问题**：如何从 UserControl 中访问 Window1 中的字典？

*   我可以访问静态类 Window1 但不能访问它的实例化，因此为它制作一个 Getter 让我没有进一步的了解。
*   C# 中有全局属性，但我可以想象有更好、更 OOP 的方式
*   似乎我是从网站/会话变量的角度来看待这个的，因此错过了桌面开发的一个关键概念，即“状态无处不在”

希望有人可以对此有所了解。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T15:00:22.030

尝试使用[单例](http://www.yoda.arachsys.com/csharp/singleton.html)对象。这个想法是利用静态对象的机制来实现“全局”变量，但这些变量包含在对象中以进行健全管理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:07:36.910

你有几个选择：

1.  .Net 设置对象。这带来了额外的功能，例如序列化。如果这是您的整个应用程序也应该可以访问的某种应用程序设置，那么这是有道理的。
2.  您可以存储在 Window1 的资源集合下。然后使用 UserControl 中的 FindResource(...) 来查找对象。这使得 Window1 的子树中的所有元素都可以访问字典。
3.  您可以利用 UserControl 的 Tag 属性。我不会推荐它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:00:32.530

我不知道它在 WPF 中是如何工作的，但是在 WinForms 中，每个控件都有一个[FindForm](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.findform.aspx)方法，该方法返回对其父窗体的引用。我想在 WPF 中有类似的东西，尽管我仍在寻找它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T12:37:02.287

一旦您真正了解 WPF 的数据绑定方面，控件应该（几乎）永远不需要在代码中访问其父级。数据绑定加转换器非常强大。我也将控制事件处理程序视为绝对的最后手段。

我想你是对的; PHP 是一个非常不同的世界。我一直在为我的 WPF 和其他 .Net 应用程序使用 MVVM 模式。看看这篇关于 MVVM 模式的文章，你可能会得到一些新的想法：http: [//msdn.microsoft.com/en-us/magazine/dd419663.aspx](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx)

# asp.net - httpmodules 和 httphandlers 之间的交互

> ID：569801
> 
> 赞同：3
> 
> 时间：2009-02-20T14:48:28.110
> 
> 标签：asp.net, httphandler, httpmodule

在我们的 asp.net 2.0 应用程序中，我们使用 httpmodule 和 httphandler 通过 cookie 计算一些指标。为了计算网络传输时间，httpmodule:EndRequest 将 Transferstart 存储在 cookie 中，httphandler:Processrequest 使用 datetime.now 减去 transferstart 以确定整体网络时间。它是否正确？我也不清楚请求流程。它是这样的：request > HttpModule::OnStart > HttpModule::OnEnd > HttpHandler::ProcessRequest？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T14:51:55.093

顺序是：

*   模块启动
*   处理程序处理请求
*   模块 OnEnd

顺便说一句，使用`HttpContext.Items`属性在处理程序和模块之间共享信息可能比使用 cookie 更好。

# c# - 修复项目 GUID

> ID：569815
> 
> 赞同：1
> 
> 时间：2009-02-20T14:51:43.190
> 
> 标签：c#, asp.net, visual-studio

我有一个解决方案文件已从它引用的项目中“脱离”，因此 .sln 中的项目 GUID 引用指向他们引用的项目的不正确 GUID，并且这个问题在几个项目本身中仍然存在。

1）是否有解决此问题的自动化工具？任何处理过这个问题的人都知道，最令人恼火的部分是它仍然在 Visual Studio 中构建，而 msbuild 爆炸了——我认为这意味着必要的信息在那里，并且可以修复。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T14:59:26.510

我不知道自动工具，但我以前有过这个，进入 .sln 文件并更改 GUID 的手动修复很简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:07:56.503

解决方案文件只是一个文本文件。我不知道是否有一个自动化工具可以修复它，但你可以在记事本中自己完成，或者编写一个使用正则表达式的简单脚本来完成它。

# .net - 如何在 WCF 和 Silverlight 之间共享 Linq to Entities 数据合同

> ID：569819
> 
> 赞同：5
> 
> 时间：2009-02-20T14:52:26.730
> 
> 标签：.net, linq, wcf, silverlight, web-services

0 否决星 1

我希望能够共享我的数据合同（在 linq to entity 设计器中生成的类用 [DataContract] 属性装饰。

我正在尝试使用此处详述的体系结构：http: [//www.netfxharmonics.com/2008/11/Understanding-WCF-Services-in-Silverlight-2](http://www.netfxharmonics.com/2008/11/Understanding-WCF-Services-in-Silverlight-2)并尝试在我的 Silverlight 项目中使用“添加为链接的方法，详见此处： http: [//www.netfxharmonics.com/2008/12/Reusing-NET-Assemblies-in-Silverlight](http://www.netfxharmonics.com/2008/12/Reusing-NET-Assemblies-in-Silverlight)

我遇到的问题是在我的 silverlight 项目中引用我的服务接口。

我的解决方案有以下项目：

ORM - 包含一个 Linq to Entities edmx 模型（命名空间：company.client.Service） - 其中的类用 DataContract 属性等装饰。

ServiceInterface - 包含接口（命名空间 company.client.Service）和对返回的类（客户等）的 ORM 的引用

Service - 包含服务接口（命名空间 company.client.Service）的实现，并引用 ServiceInterface 和类的 ORM。

[ServiceHost - 仅包含http://www.netfxharmonics.com/2008/11/Understanding-WCF-Services-in-Silverlight-2](http://www.netfxharmonics.com/2008/11/Understanding-WCF-Services-in-Silverlight-2)中推荐的 .svc 文件

WebSLHost - silverlight 应用程序的主机

Gui - silverlight GUI。

我希望所有项目都是标准的.net 程序集，当然除了 silverlight gui。

当我尝试添加指向我的服务接口文件的链接时（如[http://www.netfxharmonics.com/2008/12/Reusing-NET-Assemblies-in-Silverlight](http://www.netfxharmonics.com/2008/12/Reusing-NET-Assemblies-in-Silverlight)所示），它会给出一个编译错误，说明它可以'找不到 ORM 并且无法识别我的实体类型。

我希望能够与我的服务和 silverlight 客户端共享 linq 到实体生成器生成的数据合同，所以如果有人有任何想法，我将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T15:07:51.590

您正在尝试的内容仅适用于“完整”.NET 到“完整”.NET（或至少匹配）；即便如此，它还是违反了 SOA 的规则……

数据契约的整个想法是你共享数据的*形状*，而不是实现。这意味着 Silverlight 不了解 EDMX 或一些更不寻常的 DataContract 属性（如回调）并不重要 - 数据仍然完好无损。

通过使用 mex 生成的类版本，您仍将拥有相同的基本数据行为 - 这是 WCF 与 Silverlight 的预期用例。所以只需使用服务参考。或者，您需要有一个位于 EDMX 和 WCF 之间的 DTO 类；只要 DTO 只使用 WCF 属性（但没有 EDMX）就应该没问题，但显然这会带来巨大的维护成本。我个人怀疑在最简单的情况下是否值得。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T16:54:47.620

我仍然认为您最好的选择是不要尝试将您的 linq-to-entities 类从您的 WCF 组件传递给您的客户端。相反，创建只保存数据的简单 DataContract 类（仅限属性）。在 WCF 端填写它，将其发送过去，然后在您的客户端中使用数据来重构可以与 linq 一起使用的正确对象。

有道理？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T22:33:35.967

不幸的是，LINQ to Entities 类在其数据契约中公开了一些实现特性。如果根本不让这些类成为数据契约，他们真的会做得更好。

如前所述，只需创建您自己的与要返回的数据形状相匹配的数据协定 (DTO) 类。返回这些类的单个实例，或它们的列表。

我建议不要使用 DataSet、DataTable 或其他任何特定于平台的东西。这样做的原因曾经是它不与其他平台（如 Java）互操作。但是，我已经看到它在 .NET 中无法正常互操作的情况 - 在不同的 .NET 版本之间，我怀疑在完整的 .NET 和 Silverlight 之间。如上所述，使用 DTO。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T23:40:24.267

从这里所说的以及我在其他地方读到的内容看来，EDM 数据合同似乎无法以我想要的方式与 Silverlight 共享。

但是，看起来确实可以与 silverlight 共享 linq to sql 数据合同。不完全是我想要的，但我可能会考虑的东西。我刚刚开始使用 WCF 和 silverlight，还没有决定哪个是我最好的选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T23:12:00.773

我正在尝试做同样的事情，只是发布在 Silverlight.net 论坛上。

如果没有办法，那么 MS 的疏忽是多么可怕！实体是未来，未来不会对 Linq to SQL 做太多的增强。想要使用 Silverlight + WCF + Entity Framework 真的那么罕见吗？您要么被每个服务代理命名空间中的单独实体困住（这在真正的 Silverlight 应用程序中不起作用），要么复制模式并在您的客户模式和实体模式之间进行转换，这会失去美感和实体框架的简单性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-03T09:59:14.010

我可以看到两种可能的解决方案。

1.  修改生成的 linq-to-entities 类，用预处理器指令非silverlight行包围

    如果！银光

    //非silverlight代码

    万一

2.  另一种方法是将 .NET 程序集转换为与 Silverlight 兼容的程序集，如本文所述： [将 .NET程序集转换为 Silverlight 程序集](http://www.codeproject.com/KB/silverlight/SLAssemblies.aspx)

# android - Android上奇怪的ListView选择行为

> ID：569830
> 
> 赞同：3
> 
> 时间：2009-02-20T14:56:32.350
> 
> 标签：android, listview

得到了一个扩展的活动`ListActivity`。该列表由扩展的自定义适配器备份`BaseAdapter`。

```
getListView().setFocusable(true);
getListView().setChoiceMode(ListView.CHOICE_MODE_SINGLE); 
```

我做了一个简单的`(getSelectedItemPosition() == ListView.INVALID_POSITION)`签入`onPrepareOptionsMenu()`以禁用需要选择项目的项目。

现在，我在启动活动后所做的事情（动作发生在模拟器下，ver.1.1）一个它的样子：

1.  点击菜单 - 菜单项被禁用 - 确定
2.  用鼠标滚轮选择一个项目并点击菜单 - 项目启用 - 确定
3.  单击列表外的任意位置，重复 2)。项目未启用 - WTF？
4.  从头开始，选择一个项目，点击 Del 并移动鼠标。结果与 3 相同。

为什么这些 (3, 4) 事情不断发生在我身上？:) TIA。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T16:22:38.650

依靠`selectedItemPosition`a`ListView`可能是一种危险的方法。根据我的经验，如果列表失去焦点（通过单击其他内容），则`selectedItemPosition`设置为`INVALID_POSITION`.

基本上，如果您的项目没有橙色“突出显示”的外观，请指望它`selectedItemPosition`是空的。

作为替代方案，您可能希望通过覆盖`onItemClick`and`onItemSelection`方法并保存所选项目的索引来记住所选项目，然后使用它来控制菜单选项的可用性。

# php - 如何将会话保存到 mysql 中？

> ID：569841
> 
> 赞同：2
> 
> 时间：2009-02-20T14:58:37.777
> 
> 标签：php, mysql

我需要有关将会话保存到 mysql 的帮助。

现在我正在为我的登录系统使用 php 普通会话。

这是我的代码：

**授权文件**

```
<?php
session_start();
include('db.inc.php');
$email=mysql_real_escape_string($_POST['email']);
$pwd=mysql_real_escape_string($_POST['pwd']);
$sql="Select member_id,email,password,nama,type from users where email='$email' and password=md5('$pwd')";
$exec=mysql_query($sql);
$result=mysql_fetch_array($exec);
if ($result['type'] == "member")
{
$_SESSION['nama']=$result['nama'];
$_SESSION['id']=$result['member_id'];
header('location:member.php');
}
else
{
    echo 'Anda gagal login';
   header('location:index.php');
}
?> 
```

**成员.php**

```
<?php
session_start();
include('output_fns.php');
if(!$_SESSION['nama'])
{
    header('location:index.php');
}
else
{
do_kepala('Member');
echo 'Welcome &nbsp;&nbsp;&nbsp;' . $_SESSION['nama'];
menu_member();
?> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T15:04:02.583

您将不得不[为会话保存处理程序定义自定义函数](http://us.php.net/manual/en/function.session-set-save-handler.php)。当然，您还必须在 MySQL 数据库上创建一个表。有许多复杂的步骤，您可以在[这里](http://www.tek-tips.com/faqs.cfm?fid=2037)找到所有这些步骤。

# sql-server-2005 - SQL Server 表中的日文/中文语言数据

> ID：569845
> 
> 赞同：3
> 
> 时间：2009-02-20T14:59:39.973
> 
> 标签：sql-server-2005, unicode, asp-classic, collation

所以我遇到了一个有趣的问题，我需要帮助的速度比我使用 SQL Server 的技能要快得多。

我们有一个包含一堆文本的表格，所有这些文本都使用不同的语言。大多数这些数据在浏览器中正确显示，但是，中文或日文的任何内容都会被浏览器完全破坏。

这是一个 ASP.old 应用程序，我们用来显示来自运行 MS SQL Server 2005 的服务器的数据。

以前，我们也遇到过同样的问题，我们通过更改 ASP 页面中的编码解决了这个问题。自从我们这样做以来，这些文件没有改变，但问题又出现了。因此，我必须得出结论，问题在于数据库，因为这是我们上次修复它以来唯一更新的东西。

到目前为止，我一直在尝试研究排序规则，但我离 SQL 专家还很远，所以这很困难。

如果需要，我可以提供更多信息，任何可以帮助我找到答案的信息，除了 URL（机密性和所有）。

如果有人有任何想法，我将不胜感激。

附加信息：

-列类型是'ntext'

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T15:05:41.033

排序规则只影响排序顺序，不影响编码。你需要确定你的中文和日文内容的编码是什么（见[这个](http://technet.microsoft.com/en-us/library/ms180942(SQL.90).aspx)）。如果不是 UCS-2，你就有问题（因为你不能同时支持多个页面编码）。如果是 UCS-2，您需要确保您的 ASP 页面的编码也设置为 UTF-8（并且浏览器通过将编码正确设置为 UTF-8 来识别 - 请参阅查看/编码）。

或者更简单地说：如果创建内容的应用程序没有使用 Unicode 字符，那么在中文、日文和欧洲字符之间切换时，您将不得不切换页面编码。

如果您在数据库中正确编码了 Unicode 内容，并且在页面上使用了 UTF-8 编码，那么在显示任何特殊字符时应该不会有问题（只要您在页面上使用 Unicode 字体）：

```
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
```

我意识到有几个编辑我不是很清楚，所以让我添加一些基础知识。

字符集是一组字符（例如 ASCII、UNICODE、...）的标准化表示。

字符编码是用于存储给定字符集字符的二进制表示。ASCII 有自己的编码。Unicode 是一个非常大的字符集，旨在支持现有的所有字符，它有多种编码（UTF-8、UTF-16、UCS-2，...）。

只有 Unicode 使您能够使用相同的数据库和应用程序设置同时支持西方和远东的内容。但是，中文和日语的旧字符集不是 Unicode。如果您的内容不是 Unicode（例如 BIG 5），则无法在 UTF-8 编码的网页上显示它。

如果创建内容的应用程序使用一种编码（例如 BIG-5）并且数据库将其存储为 Unicode 数据，这可能会变得很棘手。如果发生这种情况，信息可能会丢失。

您甚至必须在 Windows 中安装相应的语言包才能正确查看字符。不幸的是，编码问题并不容易诊断。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T15:19:36.990

这里可能有几个问题，但既然你说你之前解决了这个问题，它可能只是浏览器显示问题。您应该确保正确设置了编码并安装了语言包。您可以在几台不同的计算机和浏览器上进行检查，以确定它是特定机器、浏览器的问题还是一般问题。

否则，您是否在所有数据库表中使用 nvarchar 或 ntext 字段？如果不是，那么您将在该级别丢失中文和日文字符。此外，如果您使用任何存储过程、函数等，您需要确保变量也是 nvarchar 或 ntext。

最后，重新检查您的 ASP 页面在所有地方都保留了编码。我对 ASP 经典不是很熟悉，所以我会让其他人帮忙。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T01:13:45.897

您的 ASP 文件中有以下内容吗？

```
<%@codepage=65001%>
Session.CodePage = 65001 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T14:31:49.770

ntext 在 SQL 2005 中已被弃用（[http://geekswithblogs.net/johnsPerfBlog/archive/2008/04/16/ntext-vs-nvarcharmax-in-sql-2005.aspx](http://geekswithblogs.net/johnsPerfBlog/archive/2008/04/16/ntext-vs-nvarcharmax-in-sql-2005.aspx)）。不确定它是否有帮助，但您可以尝试将 ntext 转换为 nvarchar。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-02T15:55:34.753

您说您甚至无法从 Management Studio 中读取它。检查是否已经丢失任何数据非常重要。

为了知道如何恢复它，您必须知道它是如何损坏的。

1.  这些词是如何写入数据库的？任何转码（包括被 ASP 隐藏）在写入 DB 之前是否已完成？

2.  实际上已经存储在数据库中的是什么？您可以获得“损坏”字的前两个/三个字节，并将它们的字节范围与常见字符集进行比较。

如果数据来自浏览器，您应该检查表单页面的编码。浏览器使用页面的编码来编码和提交数据。如果字符集/编码不匹配接收器（例如您的 ASP 页），它可能会错误地解码单词。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-04T13:52:07.560

如果您修改了数据库，那么最可能的罪魁祸首是字段的存储。您可以通过不是 ntext 的变量传递字段，而只是 text 或 varchar。这将杀死进入的数据，然后返回网页看起来会出错。

你用什么将数据插入数据库？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-05T18:09:18.993

我怀疑你有几个问题。

实际上有几种常用的方法来表示日文和中文文本，使用传统编码（用于日文的 Shift_JIS、EUC-JP 和 JIS 变体，以及用于中文的其他几种）或 Unicode（UTF-8 或 UTF-16）。对于多语言应用程序，首选的解决方案是以 UTF-8 传输页面内容；Windows 本身更喜欢以 UTF-16 存储内容（这是 MS SQL Server 中使用的 NTEXT 和 NVARCHAR）。

为了使日语内容正确显示，您需要确保在数据管道的每个阶段都发生正确的转换。让我们假设您为了理智而使用 Unicode，但如果您有意选择使用 Shift-JIS、big5、gb2312 或其他东西，答案将是相似的，只是更复杂。

如果您的数据主要来自 Web 表单，则需要确保将代码页设置为 65001，通常使用每个 ASP 文件顶部的 <%@codepage=65001%> 指令。

此外，您需要向您的用户代理（Web 浏览器）提示您正在使用 UTF-8。有两种技术，一种涉及 HTTP 标头；另一种涉及 HTTP 标头。另一种选择是使用元标记伪造 HTTP 标头。

元标记解决方案：

HTTP 标头解决方案，使用我生疏的 ASP 技能（假设是 javascript，但您可能使用的是 vbscript，这需要您删除分号） Response.ContentType="text/html"; Response.Charset="utf-8";

如果您在提要而不是 Web 表单中将数据导入 MSSQL，您还需要确保数据被正确转换。根据您的导入机制，指定源编码的方法会有所不同，因此我将不得不将其留作“读者练习”。

接下来，在将数据提交到 SQL Server 时，您需要确保使用正确的 SQL 输入机制。如果您没有对查询进行参数化（并且应该这样做），则在将文本参数放入查询时，您需要记住使用 N'MyText' 表单而不是 'MyText'。如果您正在参数化您的文本，当您使用 adVarChar 时，您应该改用 adVarWChar。（每种 ADO 数据类型都有对应的“W”类型）。

此外，一些浏览器使用 HTML LANG 属性作为提示，以适合内容语言的字体显示文本。如果您碰巧知道您的内容使用哪种语言，您可以将 LANG="ja-jp" 添加到任何 HTML 元素（包括 BODY）。然后浏览器应该使用该语言的合理默认字体（但如果您愿意，可以明确指定一种）。即使您为特定语言选择了不合适的默认字体，过去 5 年中制造的大多数浏览器都会执行一些字体链接魔术，但如果您使用合适的字体，您将获得更可靠的结果和稍微更好的渲染性能。

作为附加说明，如果您在浏览器上手动强制编码为 shift-jis 时得到几乎正确的结果，这意味着您可能正在使用 windows-1252 作为您的字符集 <%@codepage=1252%> 并且您很幸运，内容并没有完全混乱。有一些黑客可以恢复软管的 Shift-Jis-in-1252 或 iso-8859-1，但它们不是 100% 可靠的。

至于 SQL server 上的排序规则，这有两个影响。在 NVARCHAR 和 NTEXT 字段上，它只影响排序和查询（包括区分大小写、重音和假名）。在 varchar 和 text 字段上，它也会影响编码，但这不是解决您的问题的最明智的方法。

# c# - 在 C# 中的标记前后插入文本的最佳算法？

> ID：569847
> 
> 赞同：1
> 
> 时间：2009-02-20T14:59:58.037
> 
> 标签：c#, search, highlight

我正在为 MVC C# 应用程序开发一个搜索功能，该应用程序将通过过滤器放置一个（可能很大的）文本块，并在给定搜索查询的情况下，将`<span>`在每个搜索词之前和之后放置一个具有突出显示样式的 html。

我有一个简单的算法，但我感觉它会很慢，可能是因为需要创建的字符串数量（2 * 匹配数）。

```
public static string Surround(string original, string head, string tail, string match, StringComparison comparer)
{
    var ret = original;

    if (ret.IndexOf(match, 0, comparer) != -1)
    {
        var lastIndex = 0;

        while ((lastIndex = ret.IndexOf(match, lastIndex, comparer)) != -1)
        {
            ret = ret.Insert(lastIndex, head);
            var tailIndex = lastIndex + match.Length + head.Length;
            lastIndex = tailIndex;
            ret = ret.Insert(tailIndex, tail);
        }
    }

    return ret;
} 
```

我想知道是否有人可以为更好的算法提供一些提示，以更好地处理大块文本？我正在考虑使用字符串生成器，但我也想到我可能会以完全错误的方式处理这个问题。任何见解将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T15:21:11.543

正则表达式将完成这项工作，并且代码应该简单得多。但是，您需要进行测试以确定它是否确实提供了更好的性能。像这样的东西：

```
public static string Surround(
    string original, string head, string tail, string match)
{
    return Regex.Replace(
        original, match, head + "$0" + tail, RegexOptions.IgnoreCase);
} 
```

如果您可以在保存 2N 个字符串连接时传递整个替换器，那就更好了：

```
public static string Surround(string original, string replacer, string match)
{
    return Regex.Replace(original, match, replacer, RegexOptions.IgnoreCase);
}

Surround("foo bar baz", "<span>$&</span>", "bar");  //call like so 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:09:37.360

StringBuilder 当然会快得多，但是当您执行 .Insert 时，您每次都会移动大量数据。因此，最好仅使用 .Append 在 StringBuilder 中构建结果。不是。插入。

但是，您也应该能够为此使用正则表达式，尽管我不知道语法（当我需要时，我使用一个名为 RegEx Buddy 的出色工具来构建我的正则表达式。）。

编辑：这个世界上很少有人能够区分正则表达式和传输线噪声。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:34:25.753

卢克的回答很好，但你可能想先转义“匹配”中的任何特殊字符，以防有人使用 .\^$? 等在他们的搜索中（除非你当然想允许）。

**ETA：**允许特殊字符将允许更强大的搜索，但也会导致意外输出，因为找到的文本将被替换为模式而不是实际匹配的文本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T17:44:08.737

RegEx 解决方案绝对比我制作的更优雅。但是，使用 StringBuilder 通常要快一些，并且不需要对搜索词和前/后修复进行正则表达式转义。

```
private static string Surround(string original, string head, string tail, string match, StringComparison comparisonType)
{
  if (string.IsNullOrEmpty(original) || string.IsNullOrEmpty(match) || (string.IsNullOrEmpty(head) && string.IsNullOrEmpty(tail)))
    return original;

  var resultBuilder = new StringBuilder();
  int matchLength = match.Length;
  int lastIdx = 0;

  for (;;)
  {
    int curIdx = original.IndexOf(match, lastIdx, comparisonType);

    if (curIdx > -1)
      resultBuilder
        .Append(original, lastIdx, curIdx - lastIdx)
        .Append(head)
        .Append(original, curIdx, matchLength)
        .Append(tail);
    else
      return resultBuilder.Append(original.Substring(lastIdx)).ToString();

    lastIdx = curIdx + matchLength;
  }
} 
```

我希望你可以使用它。

**更新** 做一些性能测试似乎我的解决方案只有在您搜索“短”字时才会更快。如果单词很长（即长度> 7）正则表达式获胜，但如果单词很短（即长度<7），那么我的解决方案将获胜。有谁知道这是为什么？什么操作对长度如此敏感？是 IndexOf(string, int, int) 还是 Append(string, int, int)？

# windows - Unix 和 Windows 的命令行 GUID？

> ID：569858
> 
> 赞同：25
> 
> 时间：2009-02-20T15:02:13.837
> 
> 标签：windows, unix, command-line, guid

是否有适用于 Unix 和 Windows 的命令行工具使用相同的算法为两个平台创建[GUID ？](http://en.wikipedia.org/wiki/Globally_unique_identifier)

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2010-07-15T20:54:26.860

'e2fsprogs' 项目维护*uuidgen*实用程序。

[http://e2fsprogs.sourceforge.net/](http://e2fsprogs.sourceforge.net/)

它已经在任何 Linux/BSD* 发行版上可用。

对于 Windows，我建议安装 Cygwin，'e2fsprogs' 包可以从那里获得！

作为**j4y**报告，该实用程序在 MAC OS 下可用。

赶紧跑：

```
  $ uuidgen -r # 基于随机的 UUID/GUID
  $ uuidgen -t # 基于时间的 UUID/GUID

```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T15:07:24.027

我不知道是否有可用的命令行工具，但您可以简单地用 C# 编写一个（它应该与 Mono 一起运行）：

```
class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine(System.Guid.NewGuid().ToString());
    }
} 
```

您可以轻松地修改程序以更改 GUID 的格式，将其复制到剪贴板或任何适合您需要的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T20:27:09.717

一些有用的知识：

C# 中 Guid.ToByteArray() 和 SQL Server GUID 类型的字节顺序为：

```
 { 3, 2, 1, 0, 5, 4, 7, 6, 8, 9, 10, 11, 12, 13, 14, 15 }; 
```

使用 SYS_GUID() 创建并存储为 RAW[16] 的 Oracle GUID 被订购：

```
 { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 }; 
```

您可能会发现这个[在线 GUID 转换器](http://www.robobunny.com/cgi-bin/guid)很方便。我不确定该来源是否可供您自己使用，但应该不难弄清楚。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:24:52.253

有大量的[在线应用程序](http://www.google.com/search?q=guid+generator&rls=com.microsoft:*&ie=UTF-8&oe=UTF-8&startIndex=&startPage=1)可以做到这一点。

如果您使用的是 PHP，则可以使用 uniqid 函数。

我在[http://jug.safehaus.org/](http://jug.safehaus.org/)找到了一个纯 Java 程序。这应该可以在任何可以安装 Java 的地方工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-12T13:21:12.217

在 Windows XP 中，您可以在命令窗口中使用以下命令。

```
uuidgen.exe 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-04-22T10:39:48.540

如果你在一个已经有 python 的系统上，你可以简单地在命令行上运行它：

```
python -c 'import uuid; print(uuid.uuid4())' 
```

（Python 预装在许多 Linux 发行版以及 MacOS 上）

# apache - 将 ProxyPass 用于页面而不是图像

> ID：569861
> 
> 赞同：3
> 
> 时间：2009-02-20T15:03:55.907
> 
> 标签：apache, proxy, mod-jk, ajp, proxypass

由于[可怕的、可怕的错误](https://stackoverflow.com/questions/246540/apache-tomcat-error-wrong-pages-being-delivered)，我们改变了将 Apache 连接到 Tomcat 的方式。我们正在使用`mod_jk`：

```
JkMount /path ajp13 
```

现在我们正在使用`mod_proxy_ajp`：

```
ProxyPass /path ajp://localhost:8009/path
ProxyPassReverse /path ajp://localhost:8009/path 
```

但是，有一个功能`JkMount`提供但`ProxyPass`不提供：选择文件类型的能力。这使得代理 html 文件成为可能，但不能代理图像 - 换句话说，让快速的 Apache 为静态的东西提供服务，而只为动态的东西使用慢速的 Tomcat。

```
JkMount /*.html ajp13 
```

有什么办法可以做到这一点`ProxyPass`吗？可能使用周围的`<Location>`指令或类似的东西？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T15:29:52.147

使用[ProxyPassMatch](http://httpd.apache.org/docs/2.2/mod/mod_proxy.html#proxypassmatch)：

```
ProxyPassMatch ^/(path/.*\.html)$ ajp://localhost:8009/$1 
```

[编辑：马库斯唐宁的更正]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:38:13.327

不是您的问题，而是使用此配置需要注意的事项。在使用 apache mod_proxy 连接到 tomcat 时，我的错误日志显示在中等负载下连接断开。将此添加到 httpd.conf 解决了我的问题。

```
SetEnv force-proxy-request-1.0 1
SetEnv proxy-nokeepalive 1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T23:08:12.107

kmkaplan 的帖子是正确的答案，但它给了我错误：

```
Syntax error on line 32 of .../httpd-vhosts.conf:
ProxyPass Unable to parse URL 
```

当我将指令更改为：

```
ProxyPathMatch ^/(path/.*\.html)$ ajp://localhost:8009/$1 
```

我只能假设将`$1`右侧放在端口号旁边会`8009`混淆它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-15T01:54:16.437

我们使用以下内容让 Apache 提供图像并设置合理的过期标头：

```
<Virtualhost *:80>
    ServerName domain.com
    ServerAlias *.domain.com

    Alias /img/ /var/www/domain/img/
    <Directory /var/www/domain/img/>
        ExpiresActive On
        ExpiresByType image/gif "access plus 1 months"
        ExpiresByType image/jpg "access plus 1 months"
        ExpiresByType image/jpeg "access plus 1 months"
        ExpiresByType image/png "access plus 1 months"
        ExpiresByType image/x-icon "access plus 1 months"
        ExpiresByType image/ico "access plus 1 months"
        # This will prevent apache from having to check for a .htaccess file on each request.
        AllowOverride None
        # Allow symlinks. Otherwise, apache will make a separate call on each filename to ensure it is not a symlink.
        Options +FollowSymLinks -SymLinksIfOwnerMatch
        Order allow,deny
        Allow from all
    </Directory>

    ProxyRequests Off
    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>

    # Prevent domain.com/img from being served by Tomcat
    ProxyPass /img !

    # Pass all other requests to Tomcat
    ProxyPass / ajp://localhost:8009/

    # 1\. Note that usually no ProxyPassReverse directive is necessary. The AJP request includes
    #    the original host header given to the proxy, and the application server can be expected to
    #    generate self-referential headers relative to this host, so no rewriting is necessary. 
    # 2\. If you still want to use it, read this first:
    #    http://www.humboldt.co.uk/2009/02/the-mystery-of-proxypassreverse.html
    # ProxyPassReverse / http://domain.com/
</Virtualhost> 
```

但是，如您所见，我们将图像存储在 Tomcat 应用程序之外。我不知道它是否也适用于应用程序内的图像。

# svn - 如何查询我的 subversion 存储库？

> ID：569865
> 
> 赞同：19
> 
> 时间：2009-02-20T15:05:10.880
> 
> 标签：svn

目前，我只想查找过去 X 天内未修改的所有文件，但最终我希望能够对我的 subversion 存储库进行更复杂的查询。

是否有某种 Subversion 查询语言或我可以使用的 API？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-02T20:41:51.317

您可以使用 SvnQuery 项目 ( [http://svnquery.tigris.org](http://svnquery.tigris.org) )，该项目旨在为执行此类查询提供查询接口。它有一个 .NET API 和一个 Web 前端，提供相同的查询语言。您可以使用运算符、嵌套表达式、通配符、短语和间隙短语进行复杂查询。您要求的操作员，计算现在和上次提交日期之间的差异，没有实现，但由于它是一个开源项目，您可以自愿这样做或发布功能请求:-)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-20T15:50:12.207

您可以使用[svn log](http://svnbook.red-bean.com/en/1.5/svn.ref.svn.c.log.html)命令生成一个 XML 文件，其中包含有关所有提交的大量信息，如下所示：

```
svn log URL --xml --verbose > commits.xml 
```

您可以使用更多选项来限制修订范围，获取有关 rev props 的更多信息，包括合并信息等。

然后问题就变成了“我如何对 XML 文档的内容执行查询”，这比使用现有的 SVN API 更容易。例如，在 C# 中，您可以[对 XML 进行 LINQ 查询](http://msdn.microsoft.com/en-us/library/bb308960.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T15:33:59.187

目前没有，没有被广泛使用的颠覆查询语言或基于查询的 api（好吧，现在看有人反驳我，我想这就是网络生活）。

这意味着您只能将普通 svn 命令的输出拼接在一起，例如

```
svn info 
```

和

```
svn log 
```

我敢肯定 bash 或 powershell 之类的东西至少可以做到这一点。如果你被 Windows 批处理卡住了，我现在开始哭了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T15:46:50.873

没有存储库查询语言或搜索 API。对于复杂的查询，您需要一个存储库索引器（如[http://supose.soebes.de/wiki/supose](http://supose.soebes.de/wiki/supose)）或提交数据库（如[http://www.viewvc.org/](http://www.viewvc.org/)）。[http://markmail.org/thread/wszzgnrny6o2r7u7](http://markmail.org/thread/wszzgnrny6o2r7u7)有更多链接。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-07-13T09:27:41.960

您可能需要查看[VoilàSVN](http://www.voilasvn.com/)或[OpenGrok](http://opengrok.github.io/OpenGrok/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-16T18:49:07.500

使用 Powershell，您可以对日志消息进行一些很好的查询

```
$data = [xml] (svn log -r "r1:r2" --xml)
$data.log.logentry | where-object {$_.message -match "regex"} 
```

甚至在更改的文件上（使用一些必要的魔法来避免众所周知的 powershell 问题）

```
$diff = [xml] (svn diff -r "r1:r2" --xml --summarize | %{$_ -replace "item", "item1"})
$diff.diff.paths.path | where-object {$_.item1 -eq "file"} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T15:48:04.537

如前所述，svn log/info 可以与 shell 命令结合使用来查找您想要的内容。或者，您可以直接在 C/C++ 中使用 SVN 自己的 API 以编程方式处理存储库实体。SVN 有 Python 绑定。如果 Java 是您选择的语言，请尝试[http://svnkit.com/](http://svnkit.com/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-09-03T00:56:18.043

检查鱼眼。真的很酷。

[https://confluence.atlassian.com/display/FISHEYE035/EyeQL+reference+guide](https://confluence.atlassian.com/display/FISHEYE035/EyeQL+reference+guide)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-02-11T13:54:41.713

除了使用 Subversion 命令行或 TortoiseSVN 等图形客户端查看 svn 存储库历史记录外，您还可以为 Subversion 存储库安装高级 Web 界面。

例如，在 VisualSVN Server 3.2 和更新版本中，您可以使用基于 Web 的修订历史查看器，[请参阅此处的演示](http://demo-server.visualsvn.com/!/#serf/history/head/trunk)。

[在此处查看基于 HTML5 的 web svn 客户端](https://www.visualsvn.com/server/features/svn-web-interface/)的描述。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-09-23T01:52:08.897

从 1.7 SVN 开始，工作副本在 .svn 目录中有一个 wc.db 文件。它是一个基本的 sqlite 数据库，因此很容易查询。

您应该确保您的工作副本是最新的。如果您所做的不仅仅是快速简单的选择，那么复制文件会更安全，而不是冒险破坏它。

更改日期基于 unix 纪元。例如：

```
sqlite3 .svn\wc.db "select changed_revision, datetime((changed_date/1000000),'unixepoch') changed_date, changed_author, repos_path from NODES" 
```

# wcf - 如何向公众隐藏 WCF 服务？

> ID：569870
> 
> 赞同：1
> 
> 时间：2009-02-20T15:06:22.343
> 
> 标签：wcf, security

您可以采取哪些措施来向公众“隐藏” WCF 服务？

即，即使他们知道 URL，您也不会公开方法等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T15:14:13.587

如果他们知道您的合同的规格是什么，我认为您无法做到。如果他们不这样做，那么他们只是随机猜测（只要您不公开元数据）。您最好的选择是在您的合约中包含一个身份验证功能，该功能必须首先被调用，并且是允许后续调用所必需的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T16:20:09.280

您要确保不做的另一件事是发布服务的元数据（WSDL 或 MEX）。如果您发布 WSDL，那么有人可以很容易地看到您服务上的所有方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T16:32:15.583

不要通过 HTTP 公开它。使用 TCP 绑定并将其托管在您的 Intranet 上。Intranet 之外的任何人都无法找到它。或者通过命名管道托管它，没有人会在你自己的机器之外找到它。

如果您使用的是基于 HTTP 的协议，那么除了使 url 变得晦涩难懂，人们可能永远不会搜索之外，没有其他方法可以隐藏它。

# c# - 为什么 C# 不能解密 Perl 的 Crypt::Rijndael 的输出？

> ID：569871
> 
> 赞同：1
> 
> 时间：2009-02-20T15:06:29.660
> 
> 标签：c#, perl, aes, encryption, rijndaelmanaged

一个文件已被 Perl 加密。初始解密尝试失败，我现在正在尝试确定是否有任何 hoojoo 正在进行（需要一些其他设置）

**达夫 Perl 代码：**

```
use strict;

use Crypt::Rijndael;

my $key ='...';

my $rcipher = Crypt::Rijndael->new ($key, Crypt::Rijndael::MODE_CBC());

undef $/;
my $encrypted = <>;

print $rcipher->decrypt($encrypted); 
```

**C#解密实现**

```
 CryptoStream decryptor = null;
        StreamReader srDecrypt = null;
        FileStream fsIn = null;
        RijndaelManaged rijndaelCipher = null;
        string fileContents;
        try
        {
            rijndaelCipher = new RijndaelManaged();
            rijndaelCipher.Mode = CipherMode.CBC;
            rijndaelCipher.Key = Encoding.UTF8.GetBytes(Password);
            rijndaelCipher.IV = Encoding.UTF8.GetBytes(Password);
            rijndaelCipher.Padding = PaddingMode.None;

            fsIn = new FileStream(FilePath, FileMode.Open);
            decryptor = new CryptoStream(fsIn, rijndaelCipher.CreateDecryptor(), CryptoStreamMode.Read);
            srDecrypt = new StreamReader(decryptor);
            fileContents = srDecrypt.ReadToEnd();
        }
        finally
        {
            if (decryptor != null)
                decryptor.Close();
            if (fsIn != null)
                fsIn.Close();
            if (srDecrypt != null)
                srDecrypt.Close();

            if (rijndaelCipher != null)
                rijndaelCipher.Clear();
        } 
```

**Perl 代码应该如何阅读**

```
binmode OUTF;

my $key ="..."; # Your secret key

my $rcipher = Crypt::Rijndael->new ($key, Crypt::Rijndael::MODE_CBC());

$rcipher->set_iv($key); # You may wish this IV to be something different from the Secret Key

my $plaintext = "Please encrypt me"; # Your string to be encrypted

if(length($plaintext) % 16 != 0 ) {

$plaintext .= ' ' x (16 - (length($plaintext) % 16)); } 

my $rencrypted = $rcipher->encrypt($plaintext); 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-20T19:42:02.850

我是 Perl 的[Crypt::Rijndael](http://search.cpan.org/dist/Crypt-Rijndael)的维护者。我没有编写原始代码，但是当其他人失败时，我会尝试使其工作。

我收到了另一份这样的报告，即[RT #27632](https://rt.cpan.org/Ticket/Display.html?id=27632)。模块中的问题是一个有符号的 int，它应该是一个无符号的 int。最新版本的[Crypt::Rijndael](http://search.cpan.org/dist/Crypt-Rijndael) 1.07 应该有修复。您使用的是哪个版本？

此外，其中一些问题与平台有关。如果您查看发行版中的 rijndael.h 代码，您会看到我必须跳过这些障碍才能为各种平台获取正确的类型大小。我认为您使用的是 Windows（但不是 Cygwin）。您使用的是哪个版本的 Windows？

如 RT 票证中所述，第一步是使用[Crypt::Rijndael](http://search.cpan.org/dist/Crypt-Rijndael)和 C# 实现使用相同的初始化向量加密相同的消息。你应该得到相同的输出。如果你没有得到相同的密文，那就有问题了。

让我知道这对你来说是如何工作的，以便我可以在需要时将其作为[Crypt::Rijndael](http://search.cpan.org/dist/Crypt-Rijndael)错误进行跟踪。

谢谢，

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T15:17:45.060

我假设你在 Windows 上运行它。您正在处理二进制数据，因此您需要考虑到这一点。在 Perl 中，您必须使用[binmode](http://perldoc.perl.org/functions/binmode.html)。我认为您需要在 C# 中使用 BinaryReader（但我不是 C# 程序员，所以我不确定）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T15:28:34.457

你有相同的静脉注射尺寸吗？我在问，因为我在 Perl 到 C# 加密转换方面遇到了类似的问题，Perl 中的 IV 大小不同。

您的 KeySize 是 256（位），但您在 Perl 代码中的密钥是 3 个字节，12 位，如果我记得 Perl 用空格填充它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T15:23:46.047

您是否尝试过加密/解密一个简单的字符串？有了它，您可以验证加密中是否存在某些内容（而不是读取文件）。

# c# - C#中的双射字典/Map

> ID：569877
> 
> 赞同：6
> 
> 时间：2009-02-20T15:06:57.257
> 
> 标签：c#, dictionary

.NET 中是否有一个双射字典可以有效地存储键/值对，其中键和值都是不同的，所以双射映射（即 TryGetValue/TryGetKey）是可能的？天真的方法是有两个内部字典：一个键值字典和一个值键字典，但这在内存方面效率不高。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T15:10:26.233

我不相信.NET中有一个。根据键/值类型，我不确定使用两个字典是否会导致效率损失*这么*大：这是我在看到问题之前会做的事情，因为它很简单。

事实上，它*非常*简单，因为我已经在另一个 Stack Overflow 答案中实现了它。我看看能不能找到。。。

编辑：我发现了两个：

*   [我的一个](https://stackoverflow.com/questions/255341/getting-key-of-value-of-a-generic-dictionary/255630#255630)
*   [另一个基于我的](https://stackoverflow.com/questions/268321/bidirectional-1-to-1-dictionary-in-c)，但使用 Remove 等进行了更全面的开发。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T15:17:56.760

本质上，您需要 2 个引用相同二进制元素的集合。您将始终拥有对这两个元素的引用的开销，但无论哪种方式都可以。每组都需要一个不同的比较器，但开销很小。由于您引用了相同的元素，因此在这两个集合中，您没有 2 个副本。

[HashSet](http://msdn.microsoft.com/en-us/library/bb359438.aspx) [HashSet 方法/成员](http://msdn.microsoft.com/en-us/library/bb341004.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:10:17.700

为什么这在内存方面没有效率？除非您只有 64MB RAM，否则对于大多数（甚至是大型表）来说这不是问题。如果它变得太大，那么您应该真正考虑使用适当的数据库引擎。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:14:25.927

如果存储在字典中的值是对象类型，则唯一的内存开销将是 Dictionary 对象本身的内存开销。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T15:19:39.457

“翻转”键和值很容易。

```
var source = GetSomeDictionary();
var opposite = source.ToDictionary(x => x.Value, x => x.Key) 
```

> 这在内存方面效率不高

好吧，如果您发现您确实无法容纳第二本词典……那么您可以在需要时生成它。这具有不需要维护两个字典的额外好处。

但最有可能的是，你可以拿着第二本字典——并且想要为了节省时间。

# c# - 如何在 .NET 中使用大位图？

> ID：569889
> 
> 赞同：13
> 
> 时间：2009-02-20T15:09:43.257
> 
> 标签：c#, bitmap, gdi, out-of-memory

我正在尝试编写一个轻量级的图像查看应用程序。但是，.NET 存在系统内存限制。

尝试加载大型位图（**9000 x 9000 像素**或更大，24 位）时，我收到 System.OutOfMemoryException。这是在具有 2GB RAM（其中 1.3GB 已用完）的 Windows 2000 PC 上。尝试加载文件也需要很多时间。

以下代码生成此错误：

```
Image image = new Bitmap(filename);
using (Graphics gfx = this.CreateGraphics())
{
    gfx.DrawImage(image, new Point(0, 0));
} 
```

与此代码一样：

```
Stream stream = (Stream)File.OpenRead(filename);
Image image = Image.FromStream(stream, false, false);
using (Graphics gfx = this.CreateGraphics())
{
    gfx.DrawImage(image, new Rectangle(0, 0, 100, 100), 4000, 4000, 100, 100, GraphicsUnit.Pixel);
} 
```

此外，这样做就足够了：

```
Bitmap bitmap = new Bitmap(filename);
IntPtr handle = bitmap.GetHbitmap(); 
```

后一个代码旨在与 GDI 一起使用。在研究这一点时，我发现这实际上是一个内存问题，其中 .NET 尝试在单个连续内存块中分配两倍于所需的内存。

[http://bytes.com/groups/net-c/279493-drawing-large-bitmaps](http://bytes.com/groups/net-c/279493-drawing-large-bitmaps)

我从其他应用程序（Internet Explorer、MS Paint 等）中知道可以打开大图像，而且速度相当快。我的问题是，***如何在 .NET 中使用大型位图？***

无论如何要流式传输它们，还是非内存加载它们？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T20:11:18.443

这是一个两部分的问题。第一个问题是如何在不耗尽内存的情况下加载大图像（1），第二个问题是提高加载性能（2）。

(1) 考虑一个像 Photoshop 这样的应用程序，您可以在其中处理在文件系统上消耗千兆位的巨大图像。在大多数系统（甚至 8gb x64 系统）上，将整个图像保存在内存中并且仍然有足够的空闲内存来执行操作（过滤器、图像处理等，甚至只是添加层）是不可能的。

这就是为什么像这样的应用程序使用交换文件的概念。在内部，我假设 Photoshop 使用专有文件格式，适用于他们的应用程序设计，并构建为支持从交换部分加载，使他们能够将文件的一部分加载到内存中进行处理。

(2) 通过为每种文件格式编写自定义加载器，可以提高性能（很多）。这需要您阅读要使用的文件格式的文件头和结构。一旦你掌握了它，它就不会那么难了，但它并不像调用方法那么简单。

例如，您可以搜索 FastBitmap 以查看有关如何非常快速地加载位图 (BMP) 文件的示例，其中包括解码位图标头。这涉及到 pInvoke 并让您了解您所面临的问题，您需要定义位图结构，例如

```
 [StructLayout(LayoutKind.Sequential, Pack = 1)]
        public struct BITMAPFILEHEADER
        {
            public Int16 bfType;
            public Int32 bfSize;
            public Int16 bfReserved1;
            public Int16 bfReserved2;
            public Int32 bfOffBits;
        }

        [StructLayout(LayoutKind.Sequential)]
        public struct BITMAPINFO
        {
            public BITMAPINFOHEADER bmiHeader;
            public RGBQUAD bmiColors;
        }

        [StructLayout(LayoutKind.Sequential)]
        public struct BITMAPINFOHEADER
        {
            public uint biSize;
            public int biWidth;
            public int biHeight;
            public ushort biPlanes;
            public ushort biBitCount;
            public BitmapCompression biCompression;
            public uint biSizeImage;
            public int biXPelsPerMeter;
            public int biYPelsPerMeter;
            public uint biClrUsed;
            public uint biClrImportant;
        } 
```

可能与创建 DIB ( [http://www.herdsoft.com/ti/davincie/imex3j8i.htm](http://www.herdsoft.com/ti/davincie/imex3j8i.htm) ) 和奇怪的事情一起工作，比如数据被“颠倒”存储在一个位图中，你需要考虑或者你会看到当你打开它时的镜像:-)

现在这只是位图。假设你想做 PNG，那么你需要做类似的事情，但解码 PNG 标头，最简单的形式并不难，但如果你想获得完整的 PNG 规范支持，那么你会很有趣：- )

PNG 与位图不同，因为它使用基于块的格式，其中具有“标题”，您可以找到不同的数据。我在玩格式时使用的一些块的示例是

```
 string[] chunks =  
new string[] {"?PNG", "IHDR","PLTE","IDAT","IEND","tRNS",
"cHRM","gAMA","iCCP","sBIT","sRGB","tEXt","zTXt","iTXt",
"bKGD","hIST","pHYs","sPLT","tIME"}; 
```

您还必须了解 PNG 文件的 Adler32 校验和。因此，您想要执行的每种文件格式都会增加一组不同的挑战。

我真的希望我能在我的回复中提供更完整的源代码示例，但这是一个复杂的主题，老实说我自己没有实现交换，所以我无法就此提供太多可靠的建议。

简短的回答是 BCL 中的图像处理能力并不那么热门。中等答案是尝试查找是否有人编写了可以帮助您的图像库，而长答案是卷起袖子自己编写应用程序的核心。

既然你在现实生活中认识我，你就知道在哪里可以找到我；）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T16:04:02.797

对于一个真正全面的答案，我会使用 Reflector 查看 Paint.NET 的源代码（[http://www.getpaint.net/](http://www.getpaint.net/)）；用 C# 编写的高级图形编辑程序。

（正如评论中指出的，Paint.NET 曾经是开源的，但现在是闭源的）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T09:28:37.950

有一件事让我很震惊。您是否在绘制整个图像而不仅仅是可见部分？您不应该绘制比您在应用程序中显示的更大的图像部分，使用 x、y、width 和 heigth 参数来限制绘制区域。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:19:52.077

关于什么：

```
Image image = new Bitmap(filename);
using (Graphics gfx = Graphics.FromImage(image))
{    
// Stuff
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T15:20:40.170

只是一个快速修复，我有同样的问题，我创建了第二个位图实例并在构造函数中传递了位图。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T15:21:35.257

你能创建一个新的、空白的、相同尺寸和颜色深度的位图吗？如果是这种情况，您至少知道您的环境可以处理图像。然后问题出在图像加载子系统中，当然您的链接可能就是这种情况。

我想你可以编写自己的位图加载器，但对于非平凡的格式来​​说这是很多工作，所以我不建议这样做。

也许有替代库可以解决标准加载器的这些问题？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T15:21:42.430

所以你是说不是位图的加载而是渲染导致内存不足？

如果是这样，您可以使用 Bitmap.LockBits 来获取像素并自己编写基本的图像调整器吗？

# c# - 多值字典

> ID：569903
> 
> 赞同：84
> 
> 时间：2009-02-20T15:14:06.943
> 
> 标签：c#

我将如何在 C# 中创建一个多值字典？

例如`Dictionary<T,T,T>`，第一个 T 是键，其他两个是值。

所以这是可能的：`Dictionary<int,object,double>`

谢谢

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-02-20T16:31:12.623

如果您尝试将值组合在一起，这可能是创建简单结构或类并将其用作字典中的值的好机会。

```
public struct MyValue
{
    public object Value1;
    public double Value2;
} 
```

那么你可以有你的字典

```
var dict = new Dictionary<int, MyValue>(); 
```

你甚至可以更进一步，实现你自己的字典类来处理你需要的任何特殊操作。例如，如果您想要一个接受 int、object 和 double 的 Add 方法

```
public class MyDictionary : Dictionary<int, MyValue>
{
    public void Add(int key, object value1, double value2)
    {
        MyValue val;
        val.Value1 = value1;
        val.Value2 = value2;
        this.Add(key, val);
    }
} 
```

那么您可以像这样简单地实例化并添加到字典中，而不必担心创建“MyValue”结构：

```
var dict = new MyDictionary();
dict.Add(1, new Object(), 2.22); 
```

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2009-02-20T15:18:41.377

只需创建一个`Pair<TFirst, TSecond>`类型并将其用作您的值。

我的[C# in Depth source code](http://csharpindepth.com/Downloads.aspx)中有一个示例。为简单起见，在此转载：

```
using System;
using System.Collections.Generic;

public sealed class Pair<TFirst, TSecond>
    : IEquatable<Pair<TFirst, TSecond>>
{
    private readonly TFirst first;
    private readonly TSecond second;

    public Pair(TFirst first, TSecond second)
    {
        this.first = first;
        this.second = second;
    }

    public TFirst First
    {
        get { return first; }
    }

    public TSecond Second
    {
        get { return second; }
    }

    public bool Equals(Pair<TFirst, TSecond> other)
    {
        if (other == null)
        {
            return false;
        }
        return EqualityComparer<TFirst>.Default.Equals(this.First, other.First) &&
               EqualityComparer<TSecond>.Default.Equals(this.Second, other.Second);
    }

    public override bool Equals(object o)
    {
        return Equals(o as Pair<TFirst, TSecond>);
    }

    public override int GetHashCode()
    {
        return EqualityComparer<TFirst>.Default.GetHashCode(first) * 37 +
               EqualityComparer<TSecond>.Default.GetHashCode(second);
    }
} 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-02-20T15:18:41.800

```
Dictionary<T1, Tuple<T2, T3>> 
```

编辑：对不起 - 我忘记了在 .NET 4.0 出来之前你不会得到元组。哦！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-20T15:25:43.153

我认为这对于字典语义来说是相当过分的，因为字典根据定义是键及其各自值的集合，就像我们看到一本语言字典的方式，其中包含一个单词作为键，其描述性含义为价值。

但是您可以表示一个可以包含值集合的字典，例如：

```
Dictionary<String,List<Customer>> 
```

或者一个键的字典和一个字典的值：

```
Dictionary<Customer,Dictionary<Order,OrderDetail>> 
```

然后，您将拥有一个可以包含多个值的字典。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-20T15:18:34.700

我不认为你可以直接这样做。您可以创建一个包含您的`object`和的类`double`，并将其实例放入字典中。

```
class Pair
{
    object obj;
    double dbl;
}

Dictionary<int, Pair> = new Dictionary<int, Pair>(); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T15:18:50.067

如果这些值是相关的，为什么不将它们封装在一个类中而只使用普通的旧字典呢？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T15:30:30.507

你描述了一个多图。

您可以将值设为 List 对象，以存储多个值（>2 以实现可扩展性）。

覆盖字典对象。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-01-12T18:04:29.117

我解决了使用：

```
Dictionary<short, string[]> 
```

像这样

```
Dictionary<short, string[]> result = new Dictionary<short, string[]>();
result.Add(1,
           new string[] 
                    { 
                    "FirstString",
                    "Second"
                    }
                );
        }
return result; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-05-31T11:04:45.397

我知道这是一个旧线程，但是 - 因为它没有被提及，所以它有效

```
 Dictionary<string, object> LookUp = new Dictionary<string, object>();
  LookUp.Add("bob", new { age = "23", height = "2.1m", weight = "110kg"});
  LookUp.Add("jasper", new { age = "33", height = "1.75m", weight = "90kg"});
  foreach(KeyValuePair<string, object> entry in LookUp )
  {
      object person = entry.Value;
      Console.WriteLine("Person name:" + entry.Key + " Age: "  + person.age);          
  } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-04-05T17:36:17.467

这是 C# 中单键到多值映射的实现，它使用基于集合的键类型：

[https://github.com/ColmBhandal/CsharpExtras/blob/master/CsharpExtras/Dictionary/MultiValueMapImpl.cs](https://github.com/ColmBhandal/CsharpExtras/blob/master/CsharpExtras/Dictionary/MultiValueMapImpl.cs)

字典的行为类似于从键类型到值类型集合的常规字典，但还提供直接添加值类型的单个值的功能，并在后台处理基础集合的创建和/或添加到该集。

# mysql - 如何设计问答数据库（MySql）

> ID：569907
> 
> 赞同：2
> 
> 时间：2009-02-20T15:15:16.957
> 
> 标签：mysql, database, database-design, normalization

我需要为论坛设计一个数据库。由于各种原因，我将根帖子与其子帖子分开。从性能的角度来看，我需要用户输入的文本能够以最佳方式搜索。

我的问题，我是否应该将每个表（根帖子和子帖子）分成两个表：
root-posts_meta（保存数据，例如 id、创建时间、视图、....）
root-posts_data（id、title、body ) 全文索引

与子帖子表相同的想法。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T15:17:15.093

分离不会影响其可搜索性或搜索性能。如果这是您唯一关心的问题，您不妨将每个表格保留为单个表格。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T15:19:32.560

`TEXT`无论如何，字段都存储在行外。

分离表既不会提高可读性，也不会提高查询的性能。

你最好把它放在一张桌子上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:25:51.843

正如其他人所说，不要分开表格。它没有任何好处，它实际上有性能的缺点。添加另一个表意味着它只是在呈现页面时您的查询必须执行的另一个表连接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:26:58.020

当我做类似的事情时，我将线程数据放在一个表中，并将数据（包括根帖子）放在另一个表中。在回答你的问题之前，我必须问你，你真的确定需要将 root 和 sub 分开吗？

如果您想坚持根-子分离，我认为进一步分离它们不会有任何好处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T16:00:43.383

基本上，在常规论坛应用程序中，根消息和子消息在本质上几乎相同。如果您真的想获得一些关于新线程开始的特殊信息，您可能希望有一个名为 thread 的单独表，以及消息表中属于该线程的所有消息。对于根消息，消息本身可以具有 null 的 parent_msg_id，或者如果它们是回复，则可以具有另一条消息的 id。像这样：

```
thread:
- thread_id
- started_ts
- author (long live redundancy!)
- other columns

message:
- message_id
- thread_id (reference to thread-thread_id)
- parent_msg_id (nullabel reference to message.message_id)
- body, author, timestamp etc 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T16:08:48.120

规范化是将数据分成更小的部分，从而创建更好的设计。不幸的是，单独的表意味着更多的连接和连接对性能不利。因此，您最终会取消规范化架构以提高性能。

我建议将这些东西放在同一张桌子上。

仅当它们确实完全不同时才将它们放在不同的表中，而不仅仅是略有不同，或者您觉得将它们分开会很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T16:10:46.353

由于 InnoDB 没有 FULLTEXT 支持，并且如果需要某种事务支持，那么就没有办法绕过这种分离。
[mysql-全文](http://dev.mysql.com/doc/refman/5.1/en/fulltext-search.html)

详解：InnoDB 没有全文，MyIsam 没有 TX 支持。以 SO 为例。每个问题实体都有投票数、用户更新、更改历史（在我的系统中我还有很多其他的东西，让我们不要进入我所做的业务逻辑）。其中许多字段必须在实体的生命周期内与其他表中的其他更改一起更改（即在一个事务下更改），并且我需要对数据字段的全文支持。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-24T09:30:41.727

If transaction support is important to you, then you could still use one table for data and have something like [Sphinx](http://www.sphinxsearch.com/ "Sphinx Free open-source SQL full-text search engine") for fulltext search.

# xslt - 是否有 XSL“包含”指令？

> ID：569908
> 
> 赞同：65
> 
> 时间：2009-02-20T15:15:29.280
> 
> 标签：xslt

我有以下 XSL 片段：

```
 <xsl:for-each select="item">
    <xsl:variable name="hhref" select="link" />
    <xsl:variable name="pdate" select="pubDate" />
    <xsl:if test="hhref not contains '1234'">
      <li>
        <a href="{$hhref}" title="{$pdate}">
          <xsl:value-of select="title"/>
        </a>
      </li>
    </xsl:if>
  </xsl:for-each> 
```

if 语句不起作用，因为我无法计算出包含的语法。我将如何正确表达 xsl:if？

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2009-02-20T15:22:25.690

当然有！例如：

```
<xsl:if test="not(contains($hhref, '1234'))">
  <li>
    <a href="{$hhref}" title="{$pdate}">
      <xsl:value-of select="title"/>
    </a>
  </li>
</xsl:if> 
```

语法是：`contains(stringToSearchWithin, stringToSearchFor)`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-20T17:30:29.487

**使用标准[XPath](http://www.w3.org/TR/xpath)函数[contains()](http://www.w3.org/TR/xpath#function-contains)。**

**功能**：*布尔* **包含**（字符串，字符串）

如果第一个参数字符串包含第二个参数字符串，则[contains函数返回 true，否则返回 false](http://www.w3.org/TR/xpath#function-contains)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-20T15:23:00.540

确实有一个 xpath contains 函数，它应该看起来像：

```
<xsl:for-each select="item">
  <xsl:variable name="hhref" select="link" />
  <xsl:variable name="pdate" select="pubDate" />
  <xsl:if test="not(contains($hhref,'1234'))">
    <li>
      <a href="{$hhref}" title="{$pdate}">
        <xsl:value-of select="title"/>
      </a>
    </li>
  </xsl:if>
</xsl:for-each> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-20T15:20:45.193

它应该是这样的......

```
<xsl:if test="contains($hhref, '1234')"> 
```

（未测试）

参见[w3schools](https://www.w3schools.com/xml/xsl_functions.asp)（BTW 总是一个很好的参考）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T15:24:59.273

来自[Zvon.org XSLT 参考](http://zvon.org/xxl/XSLTreference/Output/index.html)：

```
XPath function: boolean contains (string, string) 
```

希望这可以帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T15:24:01.647

```
<xsl:if test="not contains(hhref,'1234')"> 
```

# process - 团队质量与特定流程

> ID：569927
> 
> 赞同：2
> 
> 时间：2009-02-20T15:18:58.583
> 
> 标签：process

杰夫阿特伍德最近关于[坏苹果](http://www.codinghorror.com/blog/archives/001227.html)的博客让我想起了我在职业生涯中给予了很多思考的东西。更重要的是，团队成员的质量或他们遵循的过程的质量。

我得出的结论是，团队成员的质量远比他们遵循的流程重要。我是过程的忠实粉丝。需要遵循规则并跟踪和分析衡量标准，但是当团队由高技能和高效率的成员组成时，这些规则和衡量标准的性质可能会大不相同。问题是您对高效团队与高效流程的体验如何？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T15:31:20.427

人是项目成功的首要决定因素。接下来是流程，最后是工具。

然而，经验表明，最有效的人是那些拥有出色的过程（或“横向”）知识的人，而不是领域（“特定”）知识的人。

具体来说，如何协作的知识（例如，在需要时寻求帮助的能力）、如何沟通的知识（什么使会议有效、写得好、明智地使用电子邮件），以及如何组织工作的知识（划分工作到任务中，计划任务，执行计划，跟踪与计划的分歧）。

因此，始终以“好人”为目标，但要注意“好人”一词中的歧义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T15:30:56.870

我建议，给定一个高效的团队，最终会有一个高效的流程。如果有一个“糟糕”的流程，但有一个体面的团队有能力管理/改进/控制该流程，那么他们将改进流程，直到它适合他们的有效性。

即使给出了最好的流程，一个无效的团队仍然是一个无效的团队，无论流程如何实施/控制，除非团队中无效的成员，如杰夫所说的“坏苹果”，被摆脱。我想一个好的过程是摆脱这些坏苹果的一种方法。

最初，流程是由人来制定的，如果流程做得好，他们会让人们保持一致。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-20T15:22:51.587

简单地说，一个好的团队可以使用一个糟糕的流程。他们效率低下，但他们可以让它发挥作用。

# objective-c - 在视图控制器之间进行通信的最佳方式是什么？

> ID：569940
> 
> 赞同：165
> 
> 时间：2009-02-20T15:20:45.630
> 
> 标签：objective-c, iphone, cocoa-touch, delegates, key-value-observing

作为 Objective-c、cocoa 和 iPhone 开发的新手，我强烈希望充分利用语言和框架。

我正在使用的资源之一是斯坦福大学的 CS193P 课堂笔记，他们留在网上。它包括讲义、作业和示例代码，并且由于该课程是由 Apple 开发人员提供的，我绝对认为它是“从马的嘴里”。

课程网站： http:
[//www.stanford.edu/class/cs193p/cgi-bin/index.php](http://www.stanford.edu/class/cs193p/cgi-bin/index.php)

第 8 课涉及构建基于 UINavigationController 的应用程序的作业，该应用程序将多个 UIViewController 推送到 UINavigationController 堆栈上。这就是 UINavigationController 的工作原理。这是合乎逻辑的。但是，幻灯片中有一些关于 UIViewController 之间通信的严厉警告。

我将引用这张严肃的幻灯片：
[http ://cs193p.stanford.edu/downloads/08-NavigationTabBarControllers.pdf](http://cs193p.stanford.edu/downloads/08-NavigationTabBarControllers.pdf)

第 16/51 页：

> # 如何不共享数据
> 
> *   全局变量或单例
>     *   这包括您的**应用程序委托**
> *   直接依赖关系使您的代码可重用性降低
>     *   而且更难调试和测试

好的。我对此很失望。不要盲目地将用于在 viewcontroller 之间进行通信的所有方法都扔到应用程序委托中，并在应用程序委托方法中引用 viewcontroller 实例。公平'nuff。

再进一步，我们得到这张幻灯片，告诉我们*应*该做什么。

第 18/51 页：

> # 数据流的最佳实践
> 
> *   弄清楚需要传达的**确切内容**
> *   **为您的视图控制器**定义输入参数****
> ***   为了在层次结构上进行通信，请**使用松散耦合**
>     *   为观察者定义一个通用接口（如委托）**

 **这张幻灯片之后是一张看似占位符的幻灯片，讲师随后使用带有 UIImagePickerController 的示例显然演示了最佳实践。我希望视频可用！:(

好吧，所以……我的objc-fu恐怕不是那么强。我也对上面引用的最后一行感到有些困惑。我一直在做我的谷歌搜索，我发现一篇似乎不错的文章谈论了观察/通知技术的各种方法：http:
[//cocoawithlove.com/2008/06/five-approaches-to -listening-observing.html](http://cocoawithlove.com/2008/06/five-approaches-to-listening-observing.html)

方法 #5 甚至将委托表示为一种方法！除了.... 对象一次只能设置一个委托。那么当我有多个视图控制器通信时，我该怎么办？

好的，这就是组织的帮派。*我知道我可以通过引用我的 appdelegate 中的多个 viewcontroller 实例轻松地在应用程序委托中执行我的通信方法，但我想正确*地做这种事情*。*

 *请回答以下问题，帮助我“做正确的事”：

1.  当我试图在 UINavigationController 堆栈上推送一个新的视图控制器时，应该 **由谁来做这个推送。****哪个**类/文件是正确的位置？
2.  当我想在我的一个 UIViewControllers 中影响一些数据（iVar 的值）**时**执行此操作的“正确”方法是什么？
3.  假设我们一次只能在一个对象中设置一个委托，当讲师说*“为观察者定义一个通用接口（如委托）”*时，实现会是什么样子。如果可能的话，一个伪代码示例在这里会非常有帮助。

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2009-02-22T19:17:34.873

这些都是很好的问题，很高兴看到您正在做这项研究并且似乎关心学习如何“正确地做”而不是仅仅将它破解在一起。

***首先***，我同意前面的答案，这些答案侧重于在适当的时候（根据 MVC 设计模式）将数据放入模型对象中的重要性。通常您希望避免将状态信息放入控制器中，除非它是严格的“表示”数据。

***其次***，有关如何以编程方式将控制器推送到导航控制器上的示例，请参见斯坦福演示文稿的第 10 页。有关如何使用 Interface Builder 以“可视方式”执行此操作的示例，请查看[本教程](http://www.invasivecode.com/iNVASIVE_CODE/Blog/Entries/2009/1/14_UINavigationController.html)。

***第三***，也许也是最重要的一点，请注意，如果您在“依赖注入”设计模式的上下文中考虑它们，斯坦福演讲中提到的“最佳实践”会更容易理解。简而言之，这意味着您的控制器不应该“查找”它需要完成其工作的对象（例如，引用全局变量）。相反，您应该始终将这些依赖项“注入”到控制器中（即，通过方法传入它需要的对象）。

如果您遵循依赖注入模式，您的控制器将是模块化和可重用的。如果您考虑一下斯坦福大学的演讲者来自哪里（即，作为 Apple 员工，他们的工作是构建易于重用的类），可重用性和模块化是高度优先事项。他们提到的所有共享数据的最佳实践都是依赖注入的一部分。

这就是我回应的要点。如果有帮助，我将在下面包含一个使用依赖注入模式和控制器的示例。

**将依赖注入与视图控制器一起使用的示例**

假设您正在构建一个屏幕，其中列出了几本书。用户可以选择他/她想要购买的书籍，然后点击“结帐”按钮进入结帐屏幕。

要构建它，您可以创建一个 BookPickerViewController 类来控制和显示 GUI/视图对象。它将从哪里获得所有书籍数据？假设它依赖于 BookWarehouse 对象。所以现在你的控制器基本上是在模型对象（BookWarehouse）和 GUI/视图对象之间传递数据。换句话说，BookPickerViewController 依赖于 BookWarehouse 对象。

不要这样做：

```
@implementation BookPickerViewController

-(void) doSomething {
   // I need to do something with the BookWarehouse so I'm going to look it up
   // using the BookWarehouse class method (comparable to a global variable)
   BookWarehouse *warehouse = [BookWarehouse getSingleton];
   ...
} 
```

相反，应该像这样注入依赖项：

```
@implementation BookPickerViewController

-(void) initWithWarehouse: (BookWarehouse*)warehouse {
   // myBookWarehouse is an instance variable
   myBookWarehouse = warehouse;
   [myBookWarehouse retain];
}

-(void) doSomething {
   // I need to do something with the BookWarehouse object which was 
   // injected for me
   [myBookWarehouse listBooks];
   ...
} 
```

当苹果公司的人在谈论使用委托模式来“在层次结构上进行通信”时，他们仍然在谈论依赖注入。在这个例子中，一旦用户选择了他/她的书并准备结账，BookPickerViewController 应该做什么？好吧，这不是它的工作。它应该将这项工作委托给其他对象，这意味着它依赖于另一个对象。所以我们可能会修改我们的 BookPickerViewController init 方法如下：

```
@implementation BookPickerViewController

-(void) initWithWarehouse:    (BookWarehouse*)warehouse 
        andCheckoutController:(CheckoutController*)checkoutController 
{
   myBookWarehouse = warehouse;
   myCheckoutController = checkoutController;
}

-(void) handleCheckout {
   // We've collected the user's book picks in a "bookPicks" variable
   [myCheckoutController handleCheckout: bookPicks];
   ...
} 
```

所有这一切的最终结果是你可以给我你的 BookPickerViewController 类（和相关的 GUI/视图对象），我可以很容易地在我自己的应用程序中使用它，假设 BookWarehouse 和 CheckoutController 是我可以实现的通用接口（即协议） ：

```
@interface MyBookWarehouse : NSObject <BookWarehouse> { ... } @end
@implementation MyBookWarehouse { ... } @end

@interface MyCheckoutController : NSObject <CheckoutController> { ... } @end
@implementation MyCheckoutController { ... } @end

...

-(void) applicationDidFinishLoading {
   MyBookWarehouse *myWarehouse = [[MyBookWarehouse alloc]init];
   MyCheckoutController *myCheckout = [[MyCheckoutController alloc]init];

   BookPickerViewController *bookPicker = [[BookPickerViewController alloc] 
                                         initWithWarehouse:myWarehouse 
                                         andCheckoutController:myCheckout];
   ...
   [window addSubview:[bookPicker view]];
   [window makeKeyAndVisible];
} 
```

最后，您的 BookPickerController 不仅可重用，而且更易于测试。

```
-(void) testBookPickerController {
   MockBookWarehouse *myWarehouse = [[MockBookWarehouse alloc]init];
   MockCheckoutController *myCheckout = [[MockCheckoutController alloc]init];

   BookPickerViewController *bookPicker = [[BookPickerViewController alloc] initWithWarehouse:myWarehouse andCheckoutController:myCheckout];
   ...
   [bookPicker handleCheckout];

   // Do stuff to verify that BookPickerViewController correctly called
   // MockCheckoutController's handleCheckout: method and passed it a valid
   // list of books
   ...
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-22T01:37:57.573

这种事情总是一个品味问题。

话虽如此，我总是更喜欢通过模型对象进行协调（#2）。顶级视图控制器加载或创建它需要的模型，每个视图控制器在其子控制器中设置属性以告诉它们需要使用哪些模型对象。大多数更改通过使用 NSNotificationCenter 传递到层次结构；触发通知通常内置在模型本身中。

例如，假设我有一个包含 Accounts 和 Transactions 的应用程序。我还有一个 AccountListController、一个 AccountController（显示带有“显示所有交易”按钮的帐户摘要）、一个 TransactionListController 和一个 TransactionController。AccountListController 加载所有帐户的列表并显示它们。当您点击一个列表项时，它会设置其 AccountController 的 .account 属性并将 AccountController 推入堆栈。当您点击“显示所有交易”按钮时，AccountController 会加载交易列表，将其放入 TransactionListController 的 .transactions 属性中，并将 TransactionListController 推入堆栈，等等。

例如，如果 TransactionController 编辑事务，它会在其事务对象中进行更改，然后调用其“保存”方法。“保存”发送一个 TransactionChangedNotification。任何其他需要在事务更改时自行刷新的控制器都会观察通知并自行更新。TransactionListController 大概会；AccountController 和 AccountListController 可能取决于他们试图做什么。

对于#1，在我早期的应用程序中，我在子控制器中有某种​​ displayModel:withNavigationController: 方法，可以设置并将控制器推送到堆栈上。但是随着我对 SDK 的熟悉程度越来越高，我已经远离了它，现在我通常让父母推着孩子。

对于#3，考虑这个例子。这里我们使用两个控制器，AmountEditor 和 TextEditor，来编辑交易的两个属性。编辑器实际上不应保存正在编辑的交易，因为用户可以决定放弃交易。因此，他们都将父控制器作为委托，并在其上调用一个方法，说明他们是否更改了任何内容。

```
@class Editor;
@protocol EditorDelegate
// called when you're finished.  updated = YES for 'save' button, NO for 'cancel'
- (void)editor:(Editor*)editor finishedEditingModel:(id)model updated:(BOOL)updated;  
@end

// this is an abstract class
@interface Editor : UIViewController {
    id model;
    id <EditorDelegate> delegate;
}
@property (retain) Model * model;
@property (assign) id <EditorDelegate> delegate;

...define methods here...
@end

@interface AmountEditor : Editor
...define interface here...
@end

@interface TextEditor : Editor
...define interface here...
@end

// TransactionController shows the transaction's details in a table view
@interface TransactionController : UITableViewController <EditorDelegate> {
    AmountEditor * amountEditor;
    TextEditor * textEditor;
    Transaction * transaction;
}
...properties and methods here...
@end 
```

现在来自 TransactionController 的一些方法：

```
- (void)viewDidLoad {
    amountEditor.delegate = self;
    textEditor.delegate = self;
}

- (void)editAmount {
    amountEditor.model = self.transaction;
    [self.navigationController pushViewController:amountEditor animated:YES];
}

- (void)editNote {
    textEditor.model = self.transaction;
    [self.navigationController pushViewController:textEditor animated:YES];
}

- (void)editor:(Editor*)editor finishedEditingModel:(id)model updated:(BOOL)updated {
    if(updated) {
        [self.tableView reloadData];
    }

    [self.navigationController popViewControllerAnimated:YES];
} 
```

需要注意的是，我们已经定义了一个通用协议，编辑器可以使用它与他们拥有的控制器进行通信。通过这样做，我们可以在应用程序的另一部分重用编辑器。（也许 Accounts 也可以有注释。）当然，EditorDelegate 协议可以包含不止一种方法；在这种情况下，这是唯一必要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T08:21:54.513

看到你的问题了。。

发生的事情是有人对 MVC 架构有混淆的想法。

MVC 具有三个部分.. 模型、视图和控制器.. 所述问题似乎无缘无故地将其中两个结合在一起。视图和控制器是独立的逻辑部分。

所以......你不想有多个视图控制器......

你想拥有多个视图，以及在它们之间进行选择的控制器。（如果您有多个应用程序，您也可以有多个控制器）

意见不应该做决定。控制器应该这样做。因此，任务、逻辑和使您的生活更轻松的方法的分离。

所以..确保您的视图只是这样做，对数据有一个很好的看法。让您的控制器决定如何处理数据以及使用哪个视图。

（当我们谈论数据时，我们谈论的是模型......一种很好的标准存储、访问、修改方式......另一个我们可以打包并忘记的单独逻辑）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-05T08:38:23.293

假设有两个类 A 和 B。

A类的实例是

一个实例；

A 类生成 B 类的实例，如

B b实例；

在您的 B 类逻辑中，您需要在某处通信或触发 A 类的方法。

**1) 错误的方式**

您可以将 aInstance 传递给 bInstance。现在从 bInstance 中的所需位置调用所需的方法 [aInstance methodname]。

这本来可以达到您的目的，但是释放会导致内存被锁定而不是释放。

如何？

当您将aInstance 传递给bInstance 时，我们将aInstance 的retaincount 增加了1。在释放bInstance 时，我们将阻塞内存，因为bInstance 永远无法将aInstance 变为0，因为bInstance 本身是aInstance 的对象。

此外，由于aInstance被卡住，bInstance的内存也会被卡住（泄漏）。因此，即使在稍后时间释放aInstance 本身之后，它的内存也会被阻塞，因为bInstance 不能被释放并且bInstance 是aInstance 的类变量。

**2）正确的方式**

通过将aInstance定义为bInstance的delegate，不会有aInstance的retaincount变化或内存纠缠。

bInstance 将能够自由调用位于 aInstance 中的委托方法。在bInstance的deallocation上，所有的变量都是自己创建并被释放的。在aInstance的deallocation上，由于bInstance中没有aInstance的纠缠，会被干净的释放。

# c# - 使用 C++-cli，如何实例化 C# 库中定义的 WinForms 表单？

> ID：569945
> 
> 赞同：1
> 
> 时间：2009-02-20T15:21:36.707
> 
> 标签：c#, c++-cli

很抱歉，如果这个问题已经得到解答，但我找不到。

我试图在调用 C++ 程序中的函数时打开 C# 表单（主程序在 C++-cli 中，表单在 C# 中，它是一个空表单，只是为了尝试它的工作原理）。我正在使用 Visual Studio 2005，我的解决方案中有两个项目。C# 项目只是一个表单，我已将其配置为类库。但是，当我转到 C++ 程序的函数时，我会在开头键入以下内容：

```
int _stdcall Init(void)
{
...
FormProject::Form1 form1;
form1 = new FormProject::Form1::Form1();
form1.something();
...
} 
```

我在 C++ 方面的经验很少，我尝试过不同的组合，但我很不幸。C++ 项目已与 CLI 兼容。我已经包括了所需的：

```
#using <System.Windows.Forms.dll>
#using <System.dll> 
```

我知道有一些大错误，但我只需要运行此表单，不再需要。非常感谢你。

编辑：我已经添加了参考。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T15:27:11.387

C++/CLI 项目需要添加对 C# 项目的引用，然后才能在 C# 库中使用类型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T15:30:37.993

如果我理解你，我认为你需要使用 C++/CLI 的语法增强来实例化 C# 对象。例如，您发布的代码应该是：

```
FormProject::Form1^ form1;
form1 = gcnew FormProject::Form1::Form1();  // or FormProject::Form1()
form1->something(); 
```

我建议您在托管 C++ 中创建一个新的 WinForms 项目，然后查看生成的代码以了解正确的语法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T15:27:16.270

您是否在 C++ 项目中添加了对 FormProject 的引用？如果您已经这样做了，您是否为 FormProject 命名空间包含了 #using 语句？

# svn - 强制用户在编辑之前在 SVN 中锁定文件

> ID：569948
> 
> 赞同：28
> 
> 时间：2009-02-20T15:21:47.220
> 
> 标签：svn, version-control, tortoisesvn, visualsvn

我们的项目中有一些文件无法合并，因此在编辑之前必须由用户锁定这些文件。有没有办法强制用户在编辑之前锁定文件？

我们正在使用 Subversion 和 TortoiseSVN / VisualSVN。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-20T15:29:55.080

两步：

*   将**svn:needs-lock**属性放在这些文件上。这样他们就以只读方式签出
*   当必须修改这样的文件时，使用**svn lock**命令并像往常一样提交

链接：

*   [http://svnbook.red-bean.com/nightly/en/svn.advanced.locking.html](http://svnbook.red-bean.com/nightly/en/svn.advanced.locking.html)
*   [http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-locking.html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-locking.html)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2013-10-15T06:01:48.090

更具体地说，如果你安装了 TortoiseSVN，

1.  在 Windows 资源管理器中右键单击该文件，选择 TortoiseSVN->Properties
2.  点击新建->NeedsLock
3.  在对话框中选择需要锁定：![](https://i.stack.imgur.com/NEw3a.png)
4.  点击确定
5.  提交文件
6.  完毕！

# c++ - 当 ActiveX 控件被实例化时，是什么导致 Excel 中的 Visual Basic 运行时错误 -2147319765 (8002802b)？

> ID：569950
> 
> 赞同：4
> 
> 时间：2009-02-20T15:22:19.513
> 
> 标签：c++, vba, activex, excel

我使用 C++ 创建了一个 ActiveX 控件。我使用 Visual Basic 代码来实例化 Excel 工作表中的控件。我只能运行一次 VB 脚本，后续运行在尝试访问“ActiveSheet”变量时会导致以下运行时错误：

```
Microsoft Visual Basic

Run-time error '-2147319765 (8002802b)':

Automation error
Element not found 
```

我正在尝试找出导致此错误的原因以及如何修复它？

作为一个实验，我尝试创建一个由 Visual Studio 向导生成的简单 ActiveX 控件（在 VS 2005 和 2008 中）。我没有在这个测试用例中添加或修改任何代码。简单的测试用例仍然会导致此错误。

系统中的其他 ActiveX 控件不会从 VB 代码中导致此错误（例如，我尝试实例化“位图图像”）。

这是VB代码（我录制的一个宏，但是手工编码的VB也有同样的问题）：

```
Sub Macro1()
    ActiveSheet.OLEObjects.Add(ClassType:="test.test_control.1" _
        , Link:=False, DisplayAsIcon:=False).Select
End Sub 
```

谁能给我一个答案？或者，任何指向可能有帮助的资源的指针都将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T21:31:51.940

您已经创建了对 Excel 应用程序的“不合格”引用，您无法通过使用用于 VBA 的全局变量来释放该应用程序，该全局变量不应在 VB 6.0 中使用。

这是使用 VB 6.0 的一个不幸的副作用，但这是我所知道的使用 VB6 的唯一问题，而且很容易解决。

您的问题源于使用“ActiveSheet”全局变量。使用 VBA 时，这很好，但使用 VB 6.0 时，您必须避免这种情况，否则您将创建一个无法发布的 Excel 应用程序。这种方法第一次运行良好，但在您的例程**第二**次运行时会导致各种未定义的行为。

在您的示例中，代码应该执行以下操作：

```
Sub Macro1()
    Dim xlApp As Excel.Application
    Set xlApp = New Excel.Application

    xlApp.ActiveSheet.OLEObjects.Add(ClassType:="test.test_control.1" _
        , Link:=False, DisplayAsIcon:=False).Select

    ' Then when done:
    xlApp.Quit()
    xlApp = Nothing
End Sub 
```

有关如何处理此问题的详细讨论，请参阅：

VB 6.0 教程 - 查找和修复不合格的引用 ( [http://www.xtremevbtalk.com/showthread.php?p=900556#post900556](http://www.xtremevbtalk.com/showthread.php?p=900556#post900556) )

有关此问题的 Microsoft 文档，请参阅：

Excel 自动化第二次代码运行失败 (MSKB 178510) ( [http://support.microsoft.com/default.aspx?scid=http://support.microsoft.com:80/support/kb/articles/q178/5/ 10.asp](http://support.microsoft.com/default.aspx?scid=http://support.microsoft.com:80/support/kb/articles/q178/5/10.asp) )

在 Visual Basic 中使用早期绑定时 Office 自动化出现错误或意外行为 (MSKB 319832) ( [http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q319832&](http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q319832&) )

**编辑**：*请注意，由于某种原因，使用 html 'a' 标签不适用于这些链接。有人可能需要查看解析器？*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T09:58:08.853

在与 Microsoft 交谈后，我发现了我遇到的问题的原因。

使用 VS 2005/2008 向导创建 ActiveX 控件时，您需要选中“选项”页面中的“连接点”复选框。这会添加 IConnectionPointContainerImpl 作为 ATL 类的基类，该类又实现 IConnectionPointContainer。

不这样做意味着您不能多次通过 Visual Basic 将 ActiveX 控件插入 Excel 文档。第二次执行脚本时，您开始收到“自动化错误”。

这个问题的答案很简单而且很有效，尽管我仍然不确定它与“自动化错误”的实际关系，让我想知道为什么错误消息没有提供更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T18:29:07.863

我收到了不同的消息，但行为很奇怪，就像这个问题一样。看看我的问题[在这里](https://stackoverflow.com/questions/103516/excel-addin-access-violation)。就我而言，VBA CodeCleaner 做到了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T09:40:40.153

根据错误描述和猜测，我建议您尝试以下操作。

*   确保您可以在别处毫无问题地实例化您的 ActiveX 控件。这可能只是 ActiveX 实例化的问题，而不是 Excel 问题。

同样在相关的现在，您应该使用一般的“test.test_control”而不是“test.test_control.1”，但这不是您的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-05T14:48:17.360

我在手动实现接口但没有事件的 UserControl 类中遇到此错误。这种情况下的解决方案是为 ComSourceInterfaces 属性声明一个空接口：

```
[ComVisible( true )]
[Guid( "your-guid-here" )]
[ProgId( "progid-here" )]
[ComDefaultInterface( typeof( IMyClass ) )]
[ComSourceInterfaces( typeof( IMyClassEvents ) )]
[ClassInterface( ClassInterfaceType.None )]
public partial class ExcelMap : UserControl, IMyClass
{
    //implementation here
}

[ComVisible( true )]
[Guid( "your-2nd-guid" )]
[InterfaceType( ComInterfaceType.InterfaceIsDual )]
public interface IMyClass
{
     //whatever things you need to define here
}

[ComVisible( true )]
[Guid( "your-3rd-guid" )]
[InterfaceType( ComInterfaceType.InterfaceIsDual )]
public interface IMyClassEvents
{
    //empty interface to avoid Automation errors
    //you can define events here in the normal way, but it's not necessary
} 
```

# .net - 按需加载 Iron Ruby DSL 文件

> ID：569956
> 
> 赞同：1
> 
> 时间：2009-02-20T15:23:06.983
> 
> 标签：.net, ruby, dsl, iron

目前，我有一个应用程序存储用 boo 内部 DSL 编写的元数据信息。

我将元数据存储在单独的 .boo 文件中，当我需要它们时，我会像这样加载它们：

IConfigReader reader = factory.Create(BUILD_FILE_NAME);

我想通过将 boo DSL 转换为 Iron Ruby 来利用 Iron Ruby 或实际上 Ruby 的元编程。

首先，是否可以以这种方式加载 Ruby 文件，其次，我可以将数据结构从 DLR 返回到 CLR。

我真的不明白，这是有道理的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T15:38:51.017

是的你可以。请参阅： [http ://www.ironruby.net/Documentation/Hosting_Ruby_in_.NET](http://www.ironruby.net/Documentation/Hosting_Ruby_in_.NET)

# c# - 我可以更改 Environment.NewLine 的值吗？

> ID：569975
> 
> 赞同：7
> 
> 时间：2009-02-20T15:27:52.463
> 
> 标签：c#, .net, newline

我正在使用一个使用 Environment.NewLine 的库，因为它在编写文件时是换行符。我需要它来编写 Unix 格式的文件，因此想更改换行符。

我可以更改 Environment.NewLine 的值吗？

任何其他想法（除了转换文件创建后）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-20T15:31:35.560

> 我可以更改 Environment.NewLine 的值吗？

不。如果您知道要为哪个平台编写代码，请为每个平台创建类并让它们有自己的实现。在最简单的情况下，这将如下所示：

```
public abstract class Platform { public abstract string Newline { get; } }

public sealed class Unix : Platform {
    public override string Newline { get { return "\n"; } }
} 
```

等等，然后只使用适当类的实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:32:21.547

根据 MSDN，Environment 类是密封的，因此您无法从它继承来更改值。据我所知，这是您能够做到的唯一方法。或者，您可以尝试创建一个扩展 Environment 类的部分类。我从来没有尝试过后者，所以不确定它是否会起作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T15:41:11.027

Environment.Newline 正在返回托管 .Net 运行时的运行时环境的换行符。您不应该使用它来将换行符转换为另一个平台的换行符。

我建议实现您自己的转换类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:32:34.403

Environment.NewLine 属性常量，所以没有改变它。我可以推荐的最好的事情是将使用它的任何地方更改为您自己的常量。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T15:38:57.273

第三方库是写入流还是将文件名传递给它？

在前一种情况下，您可以传递一个 MemoryStream ，然后在换行符上进行替换以获得您想要的。在后者中，将其写入临时文件，然后流式传输到真实文件（同时替换行尾）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T15:57:50.533

上帝保佑你不能......你会完全改变`System.Environment`命名空间的整个含义。

您想要做的是为特定操作系统编写一些东西（无论您在哪个环境上运行应用程序），所以 Environment. 不是你应该开始使用的。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-11-30T18:17:47.130

我们遇到了这个问题，我们必须将 NewLine 的值更改`<br />`为 web 输出。

它需要在我们的班级中使用另一个属性。真的没有办法解决。

# xml - 如何计算与 GPX 文件的距离？

> ID：569980
> 
> 赞同：24
> 
> 时间：2009-02-20T15:28:47.703
> 
> 标签：xml, algorithm, gps, gpx

我有一个带有 GPS 轨迹的[GPX 文件。](http://en.wikipedia.org/wiki/GPX_(data_transfer))现在我想计算我用这条轨道覆盖的距离。

计算这个的最佳方法是什么？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-20T15:41:29.683

计算两点（GPX 文件中的每一对航点）之间距离的传统方法是使用 Haversine 公式。

我有一个实现该算法的 SQL Server 函数。这应该很容易翻译成其他语言：

```
create function dbo.udf_Haversine(@lat1 float, @long1 float, 
                   @lat2 float, @long2 float) returns float begin
    declare @dlon float, @dlat float, @rlat1 float, 
                 @rlat2 float, @rlong1 float, @rlong2 float, 
                 @a float, @c float, @R float, @d float, @DtoR float

    select @DtoR = 0.017453293
    select @R = 3959      -- Earth radius

    select 
        @rlat1 = @lat1 * @DtoR,
        @rlong1 = @long1 * @DtoR,
        @rlat2 = @lat2 * @DtoR,
        @rlong2 = @long2 * @DtoR

    select 
        @dlon = @rlong1 - @rlong2,
        @dlat = @rlat1 - @rlat2

    select @a = power(sin(@dlat/2), 2) + cos(@rlat1) * 
                     cos(@rlat2) * power(sin(@dlon/2), 2)
    select @c = 2 * atn2(sqrt(@a), sqrt(1-@a))
    select @d = @R * @c

    return @d 
end 
```

这将返回以英里为单位的距离。对于千米，将地球半径替换为等效千米。

[这里](http://mathforum.org/library/drmath/view/51879.html)有更深入的解释。

编辑：此功能足够快且足够准确，可以使用邮政编码数据库进行半径搜索。[多年来，它在这个网站](http://kofc.org/un/findCouncil/index.action)上一直做得很好（但现在已经不行了，因为链接现在已经断开了）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-15T09:54:42.697

[Mike Gavaghan](http://www.gavaghan.org/blog/free-source-code/geodesy-library-vincentys-formula/)在他的网站上有一个用于计算距离的算法。有一个 C# 和一个 JAVA 版本的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-04T16:28:15.193

可以在[这里找到](http://www.programmersheaven.com/download/48584/19/ZipView.aspx)[Vincenty 公式](http://www.movable-type.co.uk/scripts/latlong-vincenty.html)的 Delphi 实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-28T10:58:07.923

这是一个 Scala 实现。

3958.761 是[地球的平均半径，](http://en.wikipedia.org/wiki/Earth_radius#Mean_radii)以英里为单位。要获得以公里（或其他单位）为单位的结果，只需更改此数字即可。

```
// The Haversine formula
def haversineDistance(pointA: (Double, Double), pointB: (Double, Double)): Double = {
  val deltaLat = math.toRadians(pointB._1 - pointA._1)
  val deltaLong = math.toRadians(pointB._2 - pointA._2)
  val a = math.pow(math.sin(deltaLat / 2), 2) + math.cos(math.toRadians(pointA._1)) * math.cos(math.toRadians(pointB._1)) * math.pow(math.sin(deltaLong / 2), 2)
  val greatCircleDistance = 2 * math.atan2(math.sqrt(a), math.sqrt(1 - a))
  3958.761 * greatCircleDistance
}

// A sequence of gpx trackpoint lat,long pairs parsed from the track GPX data
val trkpts: Seq[(Double, Double)] = {
  val x = scala.xml.XML.loadString(track)
  (x \\ "trkpt").map(trkpt => ((trkpt \ "@lat").text.toDouble, (trkpt \ "@lon").text.toDouble))
}

// Distance of track in miles using Haversine formula
val trackDistance: Double = {
  trkpts match {
    case head :: tail => tail.foldLeft(head, 0.0)((accum, elem) => (elem, accum._2 + haversineDistance(accum._1, elem)))._2
    case Nil => 0.0
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-18T13:49:03.487

这个问题相当古老，但我想添加一个 python 选项以确保完整性。[GeoPy](https://geopy.readthedocs.io/en/1.11.0/#module-geopy.distance)同时具有`great-circle distance`和`Vincenty distance`。

# ajax - AJAX 更新面板吞下异常及其奇怪的行为

> ID：569991
> 
> 赞同：3
> 
> 时间：2009-02-20T15:31:08.197
> 
> 标签：ajax, exception-handling

我刚刚发现 AJAX 更新面板的奇怪行为。第一个让我尴尬的想法是，我注意到当我在异步回发期间抛出异常时，它会被环境吞噬。

因为这是我第一次遇到这样的问题，所以我开始做实验——尝试抛出不同类型的异常，或者在 updatePanel 之外抛出相同的异常（例如在 Page_Init 事件中）。结论是，当异步回发中抛出异常时，环境会吞下它，并且页面呈现就像什么都没发生一样（这是不可接受的点）。但是当我在正常的页面生命周期内抛出异常时，异常以通常的方式转发并且页面按预期失败（我希望我的推论是正确的）

问题是我应该怎么做才能启用异常抛出

（顺便说一句，虽然我一直在写这条消息，但我注意到由于业务逻辑的变化，不再需要抛出上述异常，但无论如何我对它发生的原因很感兴趣）

updatePanel 的第二个问题是当我在 Page_Load 设置它 {up.Visible=false;} 时，然后在某个方法设置它 {up.Visible=true; up.Update() } - 它仍然未渲染。我在两个地方都设置了断点；.visible 在页面呈现时设置为 true，但无论如何它仍然是不可见的。我没有看到任何明显的原因。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-09-22T11:38:53.267

要在更新面板代码中引发错误时启用 asp.net 错误屏幕，您需要在 ScriptManager 中进行设置：

```
EnablePartialRendering="false" 
```

# delphi - GetMem x ReallocMem

> ID：569995
> 
> 赞同：5
> 
> 时间：2009-02-20T15:31:42.423
> 
> 标签：delphi, arrays, memory-management

System.GetMem 和 System.ReallocMem 有什么区别？

Delphi 2009 Help for ReallocMem，与GetMem 的描述完全相同。System.FreeMem 和 System.Dispose 怎么样

**我应该对数组使用什么？**

```
type
  PMemberDataList = ^TMemberDataList;
  TMemberDataList = array[0..MaxClassMembers -1] of PMemberData;

var
  FItems: PMemberDataList;

begin
  GetMem(FItems, Value * SizeOf(Pointer));
  FreeMem(FItems);
end; 
```

**或者**

```
begin
  ReallocMem(FItems, Value * SizeOf(Pointer));
  Dispose(FItems);
end; 
```

**解决方案**

在人们建议之后，我将 FItems 声明为记录类型，而不是指向记录的指针，将 TMemberDataList 声明为动态数组，将长度设置为（de）分配数组，新建/处理数据

```
type
  PMemberDataList = ^TMemberDataList;
  TMemberDataList = array of PMemberData;
var
  Items: TMemberDataList;
  Item: PMemberData;

// Add
begin
  Setlength(Items, 1);
  New(Item);
  Items[0]:= Item
end;

// Remove
begin
  Dispose(Items[0]);
  Setlength(Items, 0);
end; 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-20T16:09:02.457

GetMem 总是分配内存，FreeMem 总是释放/释放内存，ReallocMem 可以做一个，另一个，或两者兼而有之。事实上，如果使用得当，ReAllocMem 确实是唯一需要的内存管理 API。如果你从一个 nil 指针开始，然后调用大小 > 0 的 ReAllocMem，那么它的行为就像 GetMem。如果您使用 size = 0 调用 ReAllocMem，那么它的行为就像 FreeMem。它真正“重新分配”内存的唯一一次是指针非零且大小> 0。

New 和 Dispose 旨在与类型化指针一起使用，或者对于“老派”人来说，旧的 Turbo Pascal 对象模型（旧的“对象）语法。New 和 Dispose 还将确保任何类型化的指针是对托管类型将正确初始化该类型。例如，给定以下内容：

```
type
  PMyRec = ^TMyRec;
  TMyRec = record
    Name: string;
    Value: Variant;
  end;

var
  Rec: PMyRec;
begin
  New(Rec);
  try
    Rec.Name := 'TestValue';
    Rec.Value := 100;
    ...
  finally
    Dispose(Rec);
  end;
end; 
```

New 和 Dispose 将确保记录的 Name 和 Value 字段已正确初始化和最终确定或清理。New 和 Dispose，在上述情况下等价于：

```
GetMem(Rec, SizeOf(Rec^));
Initialize(Rec);
...
Finalize(Rec);
FreeMem(Rec); 
```

对于您给出的示例，Gamecat 是正确的，您可能最好使用动态数组，因为它们可以更好地由编译器管理，并且它们还带有自己的内在长度。在您的示例中，您必须单独跟踪数组中的项目数，这样无论您在哪里传递数组，您还必须传递当前分配的长度。通过使用动态数组，所有信息都被整齐地打包在一起。这将允许您通过简单地执行以下操作之一来迭代数组，而不管当前长度如何：

```
var
  Member: TMemberData;
  Items: array of TMemberData;
  ...
begin
  SetLength(Items, Value);
  for Member in Items do  // iterate over each element in the array
  ...
  for Low(Items) to High(Items) do // same as above only using std functions
  ...
end; 
```

最后，您可能想要使用动态数组的另一个原因是，如果 TMemberData 包含字符串、变体、接口或其他“托管”类型，它们将被正确初始化和完成，而无需手动执行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T15:36:09.760

GetMem 分配一块内存。ReallocMem 重新分配一块内存。

但是你最好使用动态数组：

```
var
  FItems : array of TMemberDataList;

begin
  SetLength(FItems, Value);
end; 
```

它更像是德尔福的方式。

**例子**

你可以这样做：

```
type
  TMemberDataList = array[0..MaxClassMembers -1] of TMemberData;

var
  FItems: TMemberDataList;
begin
  // Don't need to allocate FItems
end; 
```

或者：

```
type
  TMemberDataList = array of TMemberData;

var
  FItems: TMemberDataList;
begin
  SetLength(FItems, MaxClassMembers);
end; 
```

类变量是指针。因此，您不必像使用 TP 那样使用显式指针。您仍然可以使用指向记录或对象的指针，但没有理由这样做。***~~*************