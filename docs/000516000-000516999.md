# StackOverflow 问答 000516000-000516999

# c# - 使用 LINQ 确定列表中的字符串之一是否包含指定字符串的初始部分

> ID：516003
> 
> 赞同：2
> 
> 时间：2009-02-05T14:01:42.733
> 
> 标签：c#, vb.net, linq, list, string

我想使用 LINQ 实现以下功能。

情况1：

```
listOfStrings = {"C:","D:","E:"}
myString = "C:\Files"

Output: True 
```

案例二：

```
listOfStrings = {"C:","D:","E:"}
myString = "F:\Files"

Output: False 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-05T14:05:39.153

```
bool b = listOfStrings.Any(myString.StartsWith); 
```

或更冗长（但更容易理解）：

```
bool b = listOfStrings.Any(s => myString.StartsWith(s)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T14:06:13.440

试试这个：

```
bool contains = listOfStrings.Exists(s => myString.IndexOf(s)!=-1); 
```

如果您知道它应该在字符串的开头，那么：

```
bool contains = listOfStrings.Exists(s => myString.StartsWith(s)); 
```

**编辑**马克的解决方案更好:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T14:07:52.080

您可以使用 Any 扩展方法：

```
bool result = listOfStrings.Any(str => str.StartsWith(...)); 
```

# batch-file - DOS脚本根据日期动态获取文件名和路径

> ID：516005
> 
> 赞同：1
> 
> 时间：2009-02-05T14:02:28.240
> 
> 标签：batch-file, microsoft-dynamics

我必须在 Windows 中编写一些批处理/dos 脚本，将文件放入 UNIX 框中。但是路径和文件名在 Windows 中每年和每月都会分别发生变化。

假设 Windows 中路径 C:/2009MICS 的目录将保存全年的文件（12 个文件）。我的批次将每月运行，并且应该只选择相应月份的文件。例如，如果我的批次在 2 月 9 日运行。它应该从 2009MICS 文件夹中选择并传输 2 月的文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T14:40:47.630

```
copy "%date:~6%.txt" "\path\to\destination" 
```

会将 2009.txt 复制到目标路径。要包括月份，请使用

```
copy "%date:~3%.txt" "\path\to\destination" 
```

免责声明 - 我在德文版的 Win Vista 上进行了测试，希望它也适用于国际版。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-28T19:02:49.257

一种方法是使用 GetDate.cmd（最后）将今天的日期检索到环境变量中。从中您可以将`%mm%`变量（当前月份）与文件日期戳的月份进行比较，如下所示：

```
 @echo off
  :: see http://ss64.com/nt/syntax-args.html
  for %%f in (*.bat) do (
     echo.
     echo Parameter '~tf' reports '%%~tf' for '%%f'

     :: see http://ss64.com/nt/for_f.html
     echo.
     for /f "tokens=1-2" %%g in ("%%~tf") do (
        echo the file date %%g
        echo the file time %%h
        )

     for /f "tokens=1-3 delims=- " %%i in ("%%~tf") do (
        echo the year     %%i
        echo the month    %%j
        echo the day      %%k
        )

     ) 
```

结果：

```
 Parameter '~tf' reports '2009-08-28 11:52 AM' for 'test-date.bat'

  the file date 2009-08-28
  the file time 11:52
  the year     2009
  the month    08
  the day      28 
```

如果日期戳不可靠/未使用，您可以使用类似的令牌结构来解析文件名中的日期。

```
 ::GetDate.cmd - Source: http://ss64.com/nt/syntax-getdate.html :
  @echo off
  SETLOCAL
  FOR /f "tokens=1-4 delims=/-. " %%G IN ('date /t') DO (call :s_fixdate %%G %%H %%I %%J)
  goto :s_print_the_date

  :s_fixdate
  if "%1:~0,1%" GTR "9" shift
  FOR /f "skip=1 tokens=2-4 delims=(-)" %%G IN ('echo.^|date') DO (
      set %%G=%1&set %%H=%2&set %%I=%3)
  goto :eof

  :s_print_the_date
  echo Month:[%mm%]  Day:[%dd%]  Year:[%yy%]
  ENDLOCAL
  SET mm=%mm%&SET dd=%dd%&SET yy=%yy% 
```

进一步阅读：

[http://ss64.com/nt/syntax-getdate.html](http://ss64.com/nt/syntax-getdate.html) - 将日期返回到环境变量中，独立于区域日期设置 [http://ss64.com/nt/syntax-datemath.html](http://ss64.com/nt/syntax-datemath.html) - 从任何日期添加或减去天数 [http ://ss64.com/nt/syntax-delolder.html](http://ss64.com/nt/syntax-delolder.html) - 从单个文件夹中删除超过 N 天的文件

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-20T12:56:42.403

我看到两种不同的方式来解释你在问什么..

日期是由您运行脚本的日期驱动的，因此实际上是使用系统日期，还是由要复制的文件的文件日期驱动？

菲尔有一个很好的观点，但是如果您未能在给定日期激活脚本并尝试稍后再做，例如 3 月 1 日，将约会过程锁定到当前日期将会使您的排序陷入困境。

对于文件部分，我会做类似的事情：

```
@echo off
setlocal ENABLEDELAYEDEXPANSION
pushd C:\2009MICS
for /F "delims=" %%f in ('dir /b /a-d') do (
    for /f "tokens=2 delims=- " %%t in ("%%~tf") do set TimeStamp=%%t
    if not exist !TimeStamp!\ mkdir !TimeStamp!\
    copy %%f !TimeStamp!\ >nul
)
exit /b 
```

我希望我的问题是正确的，否则这是一个开始:)

# c++ - std::map，指向映射键值的指针，这可能吗？

> ID：516007
> 
> 赞同：30
> 
> 时间：2009-02-05T14:02:47.787
> 
> 标签：c++, stl, pointers, map

```
std::map<std::string, std::string> myMap;

std::map<std::string, std::string>::iterator i = m_myMap.find(some_key_string);
if(i == m_imagesMap.end())
    return NULL;

string *p = &i->first; 
```

最后一行有效吗？我想将此指针 p 存储在其他地方，它在整个程序生命周期内都有效吗？但是如果我向这个映射添加更多元素（使用其他唯一键）或删除一些其他键会发生什么，它不会重新分配这个字符串（键值对），所以 p 将变得无效？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-02-05T14:24:56.633

第 23.1.2#8 节（关联容器要求）：

> 插入成员不应影响迭代器和对容器的引用的有效性，而擦除成员应仅使迭代器和对被擦除元素的引用无效。

因此，*是的，除非您删除**该*元素，否则可以保证存储指向映射元素的数据成员的指针是有效的。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-05T14:12:01.167

第一，地图保证稳定；即迭代器不会因元素插入或删除而失效（当然，被删除的元素除外）。

但是，迭代器的稳定性并不能保证指针的稳定性！尽管大多数实现通常会使用指针（至少在某种程度上）来实现迭代器（这意味着假设您的解决方案可以工作是非常安全的），*但您真正应该存储的是迭代器本身*。

您可以做的是创建一个小对象，例如：

```
struct StringPtrInMap
{
  typedef std::map<string,string>::iterator iterator;
  StringPtrInMap(iterator i) : it(i) {}
  const string& operator*() const { return it->first; }
  const string* operator->() const { return &it->first; }
  iterator it;
} 
```

然后存储它而不是字符串指针。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T14:25:14.683

如果您不确定哪些操作会使您的迭代器无效，您可以在[参考资料](http://www.cplusplus.com/reference/stl/)中轻松查找。例如对于[vector::insert](http://www.cplusplus.com/reference/stl/vector/insert.html)它说：

> 这有效地增加了向量大小，当且仅当新向量大小超过当前向量容量时，才会自动重新分配分配的存储空间。矢量容器中的重新分配使所有先前获得的迭代器、引用和指针无效。

另一方面，[map::insert没有提及任何此类内容。](http://www.cplusplus.com/reference/stl/map/insert.html)

正如皮埃尔所说，您应该存储迭代器而不是指针。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T14:29:02.053

你为什么要这样做？

您不能更改 *p 的值，因为它是 const std::string。如果您确实更改了它，那么您可能会通过更改元素的排序顺序来破坏容器的不变量。

除非您有其他未在此处给出的要求，否则您应该只获取字符串的副本。

# c# - C# httpwebrequest 和 javascript

> ID：516027
> 
> 赞同：23
> 
> 时间：2009-02-05T14:07:48.930
> 
> 标签：c#, javascript, ajax, httpwebrequest

我正在使用 C# HttpWebRequest 来获取网页的一些数据。问题是在页面加载后使用 javascript/ajax 更新了一些数据，而我没有在响应字符串中得到它。有没有办法让 webrequest 等到页面中的所有脚本都完成执行？

谢谢

阿米特

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-05T16:16:12.710

只是一个想法，但有一种方法可以让 .net 像在浏览器中一样加载网页：使用 System.Windows.Forms

您可以将网页加载到 WebBrowser 控件中

```
WebBrowser wb = new WebBrowser();
wb.ScrollBarsEnabled = false;
wb.ScriptErrorsSuppressed = true;
wb.Navigate(url);
while (wb.ReadyState != WebBrowserReadyState.Complete) { Application.DoEvents(); }
wb.Document.DomDocument.ToString() 
```

这可能会为您提供 pre ajax DOM，但也许有一种方法可以让它首先运行 ajax。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-05T14:16:32.767

如果我正确解释了您的问题，那么您的问题没有简单的解决方案。

您正在从服务器上抓取 HTML，并且由于您的 C# 代码不是真正的 Web 浏览器，因此它不会执行客户端脚本。

这样您就无法访问您获取的 HTML 不包含的信息。

**编辑：**我不知道来自原始网站的这些 AJAX 调用有多复杂，但您可以使用 Firebug 或 Fiddler for IE 查看请求是如何发出的，以便在您的 C# 应用程序中调用这些 AJAX 调用。所以你可以添加你需要的信息。但这只是理论上的解决方案。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T14:16:46.040

当您在网络浏览器中打开网页时，浏览器会执行 javascript 并下载页面使用的其他资源（图像、脚本等）。HttpWebRequest 本身不会执行任何操作，它只会下载您请求的页面的 html。它永远不会自己执行任何 javascript/ajax 代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-07-22T12:13:17.430

使用 HttpWebRequest 下载页面，以编程方式在源代码中搜索相关的 ajax 信息，然后使用新的 HttpWebRequest 将数据拉下来。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-05T14:18:53.183

HttpWebRequest 不模拟网络浏览器，它只是下载您指向的资源。这意味着它不会执行甚至下载 JavaScript 文件。

您必须使用 FireBug 之类的东西来获取通过 JavaScript 提取的数据的 URL，并将您的 HttpWebRequest 指向那个。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-24T12:05:39.730

用于`HttpWebRequest`下载页面。在源代码中搜索相关的 AJAX 信息，然后使用 new`HttpWebRequest`将这些数据拉下来。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-02-09T06:27:12.657

您可以使用[PhantomJs](http://phantomjs.org/)。我有这个[问题](https://stackoverflow.com/questions/35267191/changing-localstorage-before-opening-the-page-in-phantomjs)，但没有找到解决我的问题的方法。在我看来，最好的解决方案是[This](https://stackoverflow.com/questions/35267191/changing-localstorage-before-opening-the-page-in-phantomjs)。

我的解决方案是这样的：

```
var page = require('webpage').create();

page.open("https://sample.com", function(){
    page.evaluate(function(){
        var i = 0,
        oJson = jsonData,
        sKey;
        localStorage.clear();

        for (; sKey = Object.keys(oJson)[i]; i++) {
            localStorage.setItem(sKey,oJson[sKey])
        }
    });

    page.open("https://sample.com", function(){
        setTimeout(function(){
         page.render("screenshoot.png") 
            // Where you want to save it    
           console.log(page.content); //page source
            // You can access its content using jQuery
            var fbcomments = page.evaluate(function(){
                return $("body").contents().find(".content") 
            }) 
            phantom.exit();
        },10000)
    });     
}); 
```

# qt - 如何为当前项目制作 QCombobox 绘画项目委托？（Qt 4）

> ID：516032
> 
> 赞同：4
> 
> 时间：2009-02-05T14:08:44.730
> 
> 标签：qt, qt4, qcombobox, qitemdelegate

QCombobox 设置项目委托不为当前项目绘制..

我正在尝试创建一个组合框，显示不同的线类型（实线、虚线、虚线等）。目前我正在为其内容设置项目委托，以便绘制/绘制线型而不是显示名称。所有线型都在正确绘制，但是一旦我从组合框中选择任何线型，组合框的当前索引仅显示线名而不是绘制它。如何让它在当前组合框索引上绘制选定的线型？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-18T09:26:32.640

委托在组合弹出窗口中绘制项目：

```
class LineStyleDelegate(QtGui.QItemDelegate):

    def __init__(self, object, parent = None):
        QtGui.QItemDelegate.__init__(self, parent)

    def paint(self, painter, option, index):
        data = index.model().data(index, QtCore.Qt.UserRole)
        if data.isValid() and data.toPyObject() is not None:
            data = data.toPyObject()
            painter.save()

            rect = option.rect
            rect.adjust(+5, 0, -5, 0)

            pen = QtGui.QPen()
            pen.setColor(QtCore.Qt.black)
            pen.setWidth(3)
            pen.setStyle(data)
            painter.setPen(pen)

            middle = (rect.bottom() + rect.top()) / 2

            painter.drawLine(rect.left(), middle, rect.right(), middle)
            painter.restore()

        else:
            QtGui.QItemDelegate.paint(self, painter, option, index)

        painter.drawLine(rect.left(), middle, rect.right(), middle)
        painter.restore()

    else:
        QtGui.QItemDelegate.paint(self, painter, option, index) 
```

paintEvent 以组合方式绘制当前项目。当然，您可以手动绘制它，但是有一种简单的方法可以绘制组合框控件本身（如果您想要当前的箭头按钮或 smth）：

```
def paintEvent(self, e):
    data = self.itemData(self.currentIndex(), QtCore.Qt.UserRole)
    if data.isValid() and data.toPyObject() is not None:
        data = data.toPyObject()
        p = QtGui.QStylePainter(self)
        p.setPen(self.palette().color(QtGui.QPalette.Text))

        opt = QtGui.QStyleOptionComboBox()
        self.initStyleOption(opt)
        p.drawComplexControl(QtGui.QStyle.CC_ComboBox, opt)

        painter = QtGui.QPainter(self)
        painter.save()

        rect = p.style().subElementRect(QtGui.QStyle.SE_ComboBoxFocusRect, opt, self)
        rect.adjust(+5, 0, -5, 0)

        pen = QtGui.QPen()
        pen.setColor(QtCore.Qt.black)
        pen.setWidth(3)
        pen.setStyle(data)
        painter.setPen(pen)

        middle = (rect.bottom() + rect.top()) / 2

        painter.drawLine(rect.left(), middle, rect.right(), middle)
        painter.restore()

    else:
        QtGui.QComboBox.paintEvent(self, e) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T23:15:20.747

I think I've encountered this problem before, having a delegate that displays the line correctly in the drop-down menu but not in the combo box itself.

The documentation ([http://doc.trolltech.com/4.4/qcombobox.html](http://doc.trolltech.com/4.4/qcombobox.html)) states that:

"For the text and icon in the combobox label, the data in the model that has the Qt::DisplayRole and Qt::DecorationRole is used."

I suspect that an approach which involves a model that returns suitable data for the DecorationRole might work, but it could be problematic to get it to behave just the way you want it to.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T19:26:54.807

您还可以将图像保存为图标并使用 QComboBox::setIconSize() 来避免缩放。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-07T21:09:44.783

只需覆盖paintEvent。这是一些草图代码：

```
void PenComboBox::paintEvent( QPaintEvent* pEvent)
{
  QComboBox::paintEvent( pEvent);
  QVariant itemData = this->itemData( this->currentIndex(), Qt::DisplayRole);
  if( !itemData.isNull() && qVariantCanConvert<QPen>( itemData))
  {
    QPainter painter(this);
    // .. etc
  }
} 
```

# python - 扩展可能不完整列表的最 Pythonic 方式

> ID：516039
> 
> 赞同：8
> 
> 时间：2009-02-05T14:11:32.043
> 
> 标签：python

我正在寻找的是最好的说法，'如果这个列表太短，请将其延长到 9 个元素并添加'Choice 4'、'Choice 5'等作为附加元素。此外，将任何“无”元素替换为“选择 x”。也可以替换“”和0。

一个示例转换是

```
['a','b',None,'c'] 
```

到

```
['a','b','Choice 3','c','Choice 5','Choice 6','Choice 7','Choice 8','Choice 9'] 
```

我最初的代码滥用了 try/except 并且有一个我没有注意到的错误；感谢 joeforker 和所有指出这一点的人。根据评论，我尝试了两个测试同样出色的简短解决方案：

```
def extendChoices(cList):
  for i in range(0,9):
    try:
      if cList[i] is None:
        cList[i] = "Choice %d"%(i+1)
    except IndexError:
      cList.append("Choice %d"%(i+1) 
```

和

```
def extendChoices(cList):
  # Fill in any blank entries
  for i, v in enumerate(cList):
    cList[i] = v or "Choice %s" % (i+1)

  # Extend the list to 9 choices  
  for j in range(len(cList)+1, 10):
    cList.append("Choice %s" % (j)) 
```

我认为#2 更符合 Python 风格，所以我将使用它。它很容易理解并使用常见的结构。拆分步骤是合乎逻辑的，并且会使某人更容易一目了然。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T15:54:23.037

与 不同`zip`，Python 会`map`自动扩展较短的序列`None`。

```
map(lambda a, b: b if a is None else a,
    choicesTxt,
    ['Choice %i' % n for n in range(1, 10)]) 
```

您可以将 lambda 简化为

```
map(lambda a, b: a or b,
    choicesTxt,
    ['Choice %i' % n for n in range(1, 10)]) 
```

如果可以将其他类似假的对象`choicesTxt`视为`None`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-05T14:31:59.677

我最初的反应是将列表扩展名和“填空”拆分为单独的部分，如下所示：

```
for i, v in enumerate(my_list):
    my_list[i] = v or "Choice %s" % (i+1)

for j in range(len(my_list)+1, 10):
    my_list.append("Choice %s" % (j))

# maybe this is nicer for the extension?
while len(my_list) < 10:
    my_list.append("Choice %s" % (len(my_list)+1)) 
```

如果您坚持使用该方法，请按照[Douglas](https://stackoverflow.com/questions/516039/most-pythonic-way-to-extend-a-potentially-incomplete-list/516070#516070)`try...except`所示捕获特定异常。否则，你会抓住**一切**: , , , ... 。你不想那样做。**`KeyboardInterrupts``RuntimeErrors``SyntaxErrors`**

 ****编辑：**修复 1-indexed list 错误 - 感谢[DNS](https://stackoverflow.com/users/51025/dns)！

**编辑：**添加了替代列表扩展

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T14:17:39.440

我想我会做一些类似的事情，但需要做一些整理：

```
for i in range(0,10):
  try:
    if choicesTxt[i] is None:
      choicesTxt[i] = "Choice %d"%i
  except IndexError:
    choicesTxt.append("Choice %d"%i) 
```

其中唯一重要的两个是只捕获`IndexError`而不是任何异常，并从 0 开始索引。

原版唯一真正的问题是如果`choicesTxt`为空，则添加的选项将减少一个。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T14:36:36.140

您可以使用地图（字典）而不是列表：

```
choices_map = {1:'Choice 1', 2:'Choice 2', 3:'Choice 12'}
for key in xrange(1, 10):
    choices_map.setdefault(key, 'Choice %d'%key) 
```

然后你的地图就填满了你的数据。
如果你想要一个列表，你可以这样做：

```
choices = choices_map.values()
choices.sort() #if you want your list to be sorted
#In Python 2.5 and newer you can do:
choices = [choices_map[k] for k in sorted(choices_map)] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-05T14:22:01.880

我认为您应该将调整数组大小视为一个单独的步骤。为此，如果数组太短，请调用`choicesTxt=choicesTxt+[None]*(10-len(choicesTxt))`. 可以使用`None`列表推导来完成选择重新分配。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-05T16:30:29.093

对我来说最简单和最 Pythonic 的是：

```
repl = lambda i: "Choice %d" % (i + 1) # DRY
print ([(x or repl(i)) for i, x in enumerate(aList)]
     + [repl(i) for i in xrange(len(aList), 9)]) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-05T14:28:08.310

那怎么样（似乎是一个字典——而不是一个列表——当它*不完整*时）

```
a = {1:'a', 2:None, 5:'e'} #test data
[a[x] if x in a and a[x] is not None else 'Choice %d'%x for x in xrange(1,10)] 
```

再次编辑：如果它真的是一个列表（不是字典）：

```
b=['a',None,'b']
[b[x] if len(b)>x and b[x] is not None else 'Choice %d'%x for x in xrange(10)] 
```

我认为需要 Python 2.5（因为三元运算符）？

（感谢 joeforker 修复了它使用键 1 到 10 而不再使用 0 到 10；感谢 SilentGhost：in 比 has_key() 或 len() 更 Pythonic）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-05T14:29:56.077

如果您不介意用“Choice %d”替换任何计算结果为 False 的内容，那么`result`适用于 Python 2.4。

如果您介意并且拥有 Python 2.5 及更高版本，请使用`result2_5_plus`ternary 的强大功能`if`。

如果您不喜欢或不能使用三元 if，那么利用 and 的事实`True == 1`，`False == 0`使用 的结果`x is None`来索引列表。

```
x = ["Blue", None, 0, "", "No, Yelloooow!"]
y = [None]*9

result = [(t or "Choice %d" % (i+1))\ 
        for i, t in enumerate(x + y[len(x):])]

result2_5_plus = [(t if t is not None else "Choice %d" % (i+1))\ 
        for i, t in enumerate(x + y[len(x):])]

result_no_ternary_if = [[t, "Choice %d" % (i+1)][t is None]\
    for i, t in enumerate(x + y[len(x):])]

['Blue', 'Choice 2', 'Choice 3', 'Choice 4', 'No, Yelloooow!', 'Choice 6', 'Choice 7', 'Choice 8', 'Choice 9']
['Blue', 'Choice 2', 0, '', 'No, Yelloooow!', 'Choice 6', 'Choice 7', 'Choice 8', 'Choice 9'] 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-05T14:40:38.303

我有点不清楚你为什么使用 range(1, 10); 由于您使用的是choicesTxt[i]，因此最终会跳过对列表中第一个元素的无检查。

此外，如果您正在创建一个新列表，显然有更简单的方法可以做到这一点，但您是专门要求添加到现有列表中的。

我不认为这真的更干净或更快，但你可以考虑这个不同的想法。

```
for i, v in enumerate(choicesTxt):
    choicesTxt[i] = v or "Choice " + str(i + 1)

choicesTxt.extend([ "Choice " + str(i) for i in range(len(choicesTxt) + 1, 10) ]) 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-05T15:01:08.947

我会做

```
for i, c in enumerate(choices):
    if c is None:
        choices[i] = 'Choice X'

choices += ['Choice %d' % (i+1) for i in range(len(choices), 10)] 
```

它只替换实际`None`值（不是任何评估为假的值），并在一个单独的步骤中扩展列表，我认为这更清楚。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-05T15:07:41.210

我发现当列表理解变长时，最好只使用标准的 for 循环。几乎和其他人一样，但无论如何：

```
>>> in_list = ["a","b",None,"c"]
>>> full_list = in_list + ([None] * (10 - len(in_list)))
>>> for idx, value in enumerate(full_list):
...     if value == None:
...             full_list[idx] = 'Choice %d' % (idx + 1)
...
>>> full_list
['a', 'b', 'Choice 3', 'c', 'Choice 5', 'Choice 6', 'Choice 7', 'Choice 8', 'Choice 9', 'Choice 10'] 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-05T15:10:46.230

```
choices[:] = ([{False: x, True: "Choice %d" % (i + 1)}[x is None] for i, x in enumerate(choices)] +
  ["Choice %d" % (i + 1) for i in xrange(len(choices), 9)]) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-05T15:25:20.037

您可以通过列表理解更简单：

```
extendedChoices = choices + ([None] * (10 - len(choices)))
newChoices = ["Choice %d" % (i+1) if x is None else x
    for i, x in enumerate(extendedChoices)] 
```

这将附加`None`到您的选择列表，直到它至少有 10 个项目，枚举结果，如果缺少第 X 个元素，则插入“选择 X”。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-05T16:05:20.033

```
def choice_n(index):
  return "Choice %d" % (index + 1)

def add_choices(lst, length, default=choice_n):
  """
  >>> add_choices(['a', 'b', None, 'c'], 9)
  ['a', 'b', 'Choice 3', 'c', 'Choice 5', 'Choice 6', 'Choice 7', 'Choice 8', 'Choice 9']
  """

  for i, v in enumerate(lst):
    if v is None:
      lst[i] = default(i)

  for i in range(len(lst), length):
    lst.append(default(i))

  return lst

if __name__ == "__main__":
  import doctest
  doctest.testmod() 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-05T16:30:53.947

好在一行：

```
`[a or 'Choice %d' % i for a,i in map(None,["a","b",None,"c"],range(10))]`
```

`虽然这将用“Choice n”替换任何评估为 False 的内容（例如 None、''、0 等）。`"a or 'Choice %d' % i"`如果您不想这样做，最好用函数替换。`

 `关键是`map`可以使用 None 的参数将列表扩展到所需的长度，在所需的位置使用 None。

一个更整洁（更 Pythonic）的版本是：

```
`def extend_choices(lst,length):
    def replace_empty(value,index):
        if value is None:
            return 'Choice %d' % index
        return value
    return [replace_empty(value,index) for value,index in map(None,lst,range(length))]` 
```

* * *

 `## 回答 #16

> 赞同：0
> 
> 时间：2009-02-05T14:22:05.640

我还建议使用 xrange 而不是 range。xrange 函数根据需要生成数字。Range 会提前生成它们。对于小系列来说，差别不大，但对于大系列来说，节省的费用可能很大。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-05T14:36:01.383

```
>>> in_list = ["a","b",None,"c"]
>>> new = ['choice ' + str(i + 1) if j is None else j for i, j in enumerate(in_list)]
>>> new.extend(('choice ' +str(i + 1) for i in range(len(new), 9)))
>>> new
['a', 'b', 'choice 3', 'c', 'choice 5', 'choice 6', 'choice 7', 'choice 8', 'choice 9'] 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-09-10T11:28:39.177

我的两分钱...

```
def extendchoices(clist):
    clist.extend( [None]*(9-len(clist)) )
    for i in xrange(9):
        if clist[i] is None: clist[i] = "Choice %d"%(i+1) 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-04-15T05:05:27.233

如果可以替换任何错误值，例如 '' 或 0

```
>>> mylist = ['a','b',None,'c']
>>> map(lambda a,b:a or "Choice %s"%b, mylist, range(1,10))
['a', 'b', 'Choice 3', 'c', 'Choice 5', 'Choice 6', 'Choice 7', 'Choice 8', 'Choice 9'] 
```

如果你真的只能替换为 None

```
>>> map(lambda a,b:"Choice %s"%b if a is None else a, mylist, range(1,10))
['a', 'b', 'Choice 3', 'c', 'Choice 5', 'Choice 6', 'Choice 7', 'Choice 8', 'Choice 9'] 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-05-15T08:25:44.917

```
>>> my_list=['a','b',None,'c']
>>> map (lambda x,y:x or 'Choice {}'.format(y+1),my_list,range(9))
['a', 'b', 'Choice 3', 'c', 'Choice 5', 'Choice 6', 'Choice 7', 'Choice 8', 'Choice 9'] 
```

# visual-studio - 为什么 Visual Studio 在打开文件时要签出文件？

> ID：516040
> 
> 赞同：2
> 
> 时间：2009-02-05T14:11:49.937
> 
> 标签：visual-studio, version-control, visual-studio-2005, devforce, vcs-checkout

为什么 Visual Studio 在打开文件时要签出文件？

我只需双击文件将其打开，Visual Studio 就想查看它。我没有对其进行任何更改。我刚打开它。

即在解决方案资源管理器中，我双击 ctlEmployeeEdit.vb，Visual Studio 要做的第一件事就是签出该文件。我设置了 VS 以在结帐时提示我，所以我通常对结帐说不，然后控件将显示。

我们正在使用 Visual Studion 2005 和 Visual Source Safe 2005。

我们有超过一百个文件的解决方案，它只发生在满手的文件上，但满手的手似乎越来越大，现在几乎满嘴了。（嗯，我想知道一只手是否比一张嘴大？但这个问题是另一个帖子。）

另外如何解决这个问题？

发生这种情况时，我是否应该删除解决方案的本地副本并从 Visual Source Safe 再次“获取最新”？

我感觉你们中的一些人会说解决这个问题的方法是升级到**真正**的源代码控制产品。:)

**编辑：**

一些第三方控制是：

1.  DevExpress 用户控件 v8.3
2.  IdeaBlade DevForce 控制

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T14:17:45.773

这不是默认的 VS 行为。几乎可以肯定，它是一个 3rd 方插件，它在文件打开时执行某些操作，最终以结帐请求结束。你安装了什么插件？

还有一些设计师最终会在打开文件时意外检查文件。有设计师开放吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T14:13:23.410

我相信特殊类型的文件可能会发生这种情况 - 特别是设置项目文件，但您并没有过于具体地说明它是什么类型的文件？

至少它在 TFS 2008 中是这样工作的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T14:15:59.227

你有打开任何 WinForms 设计器吗？有时 VS.Net 想要更改这些文件，这通常是设计人员由于引用问题而无法加载自定义控件的情况。

# java - 在 Java 中，是否保证调用“finally”块（在 main 方法中）？

> ID：516049
> 
> 赞同：25
> 
> 时间：2009-02-05T14:13:50.133
> 
> 标签：java, error-handling, finally

我是一名 Java 菜鸟，我想知道，如果我有以下典型的 Java 代码

```
public class MyApp {
  public static void main(String[] args) {
    try {
      // do stuff
    } catch {
      // handle errors
    } finally {
      // clean up connections etc.
    }
  }
} 
```

JVM 是否保证 finally 块将始终运行？为了理解我从哪里来，我已经习惯了 C/C++ 程序，如果你取消引用一个 NULL 指针并且你不能在此之后运行任何代码，这些程序可能会崩溃。

但据我了解 Java 和整个 GC / 托管内存业务一般来说，没有空指针解引用之类的东西，一切都是可捕获的预期，所以我的程序实际上没有办法崩溃，可以让它跳过 finally ，或者有吗？例如，在 Python 中，我通常会这样做

```
try:
  # do stuff
except AnExceptionIKnewMightHappen:
  # react in an appropriate way
except:
  # log that weird error I had not known could happen 
```

而且我从来没有让任何应用程序在不通过我的代码的情况下死掉。

当然，如果操作系统出于某种原因杀死了进程（或者如果某些东西杀死了整个系统，比如拔掉插头），那么 Java 就无能为力了。此外，从 PHP 中，我知道您无法防范的不可捕获的错误，即使解释器在它发生后仍然存在（至少它能够输出正确的消息）。

**编辑：**为了清楚起见（任何人都没有真正误解它），让我补充一点，我正在寻找*我的代码*中可能导致最终被绕过的东西。所以指向 System.exit 是一个有用的提醒，即使我不明白为什么我想做这样的事情。

JVM 退出是一种相当明显的方式，我将其视为外部原因。指出您还必须记住在 JVM 和应用程序继续运行时线程退出的可能性非常有帮助，因为即使现在对我来说似乎也很明显，但我没有想到这一点。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-02-05T14:15:39.240

基本上是的，除了[这里列出](http://docs.oracle.com/javase/tutorial/essential/exceptions/finally.html)的注释（强调我的）：

> 如果在执行 try 或 catch 代码时 JVM 退出，则 finally 块**可能不会**执行。同样，如果执行 try 或 catch 代码的线程被中断或杀死，即使应用程序作为一个整体继续运行，finally 块**也可能不会执行。**

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-05T14:17:53.153

不保证：

```
public class Main {
    public static void main(String args[]) {
        try {
            System.out.println("try");
            System.exit(0);
        } catch (Exception e) {
            System.out.println("exception");
        } finally {
            System.out.println("finally");
        }
    }
} 
```

运行那个。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-05T14:17:56.303

一句话，是的。

Java 中 finally 块中的代码总是执行，除非：

*   JVM 在 try 或 catch 块期间退出
*   运行代码的线程在 try 或 catch 块期间被中断或杀死

（来自：http: [//java.sun.com/docs/books/tutorial/essential/exceptions/finally.html](http://java.sun.com/docs/books/tutorial/essential/exceptions/finally.html)）

因此，除非您显式调用 System.exit(int)，或者在外部终止进程或线程，否则您可以依赖它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-05T14:18:10.937

当然，finally 块每次都会运行。JVM 崩溃或调用 exit() 函数的情况除外。我有代码，Java 应用程序调用了出现段错误的 JNI 本机代码。由此产生的崩溃杀死了 JVM，并阻止了 finally 的运行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-05T14:20:38.607

克里斯卡梅隆是正确的。但通常`finally`会执行一个 -block 。Java中确实存在空指针取消引用：

```
try {
    List<Object> x = null;
    x.get(1); //throws the unchecked NullPointerException
} finally {
    //will be executed
} 
```

finally-Block 被执行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T05:21:49.973

是的，JVM 总是执行它。保证。

当然……如果 JVM*本身*死掉了（例如：System.exit()），那么它就无法保证任何事情。但是 JVM 死亡不是 java 内的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T14:15:23.237

嗯，是的 :) 无论你的代码是否进入了 catch，finally 都会运行。这是放置尝试后清理的代码的好地方。

显然，如果您破坏 jvm，它将无法运行 :)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T14:15:44.873

是的，finally 块将始终运行，除非 JVM 崩溃（非常罕见，但这可能会发生）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-11-01T03:35:41.973

唯一没有执行 finally 块的异常是 JVM 崩溃或 system.exit()。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-03-02T00:05:17.320

似乎很明显，在 JVM 退出后不会再运行**任何东西**，或者不会在那个被杀死的线程中运行代码。明显的。因此，当 JVM 运行时，每一个将运行的代码都会运行，并且在 JVM 退出或死线程后，**什么**都不会运行，甚至任何类型的代码都不会运行。所以，没有办法阻止，但是如果需要finally子句，就放吧。

# asp.net - ASP.NET MVC 中的视图特定模型？

> ID：516051
> 
> 赞同：8
> 
> 时间：2009-02-05T14:14:12.397
> 
> 标签：asp.net, asp.net-mvc

我对 MVC 比较陌生，所以这可能是一个新手问题。

我正在尝试了解如何在一些看似不直截了当的场景中保持清晰的关注点分离的最佳实践。

我现在正在研究两种情况。想象一个非常基本的应用程序，它允许用户查看和编辑律师的在线资料。有一个动作/视图来显示特定用户的配置文件和一个动作/视图来编辑特定用户的配置文件。很容易想象一个漂亮而干净的 Model 类来表示用户配置文件的详细信息，可能使用实体框架制作并映射到用户配置文件 SQL 表。

在用于显示用户个人资料的视图操作/视图中，从功能上讲，我需要一个按钮或链接来让用户编辑个人资料。但这应该只对部分用户可用。例如，用户可以编辑他们自己的个人资料。此外，超级用户可以编辑任何人的个人资料。我的问题是视图应该如何决定在呈现特定配置文件时链接是否应该存在。我认为视图包含确定当前用户是否可以编辑当前配置文件的逻辑是错误的。我应该向 UserProfile 模型类添加 IsEditable 属性吗？这并不让人感到悲惨，但也不觉得完全正确。我是否应该创建一个新的模型类来聚合 UserProfile 以及有关安全性的其他信息？

另一种情况......在编辑特定个人资料时，可编辑的内容之一是特定律师的专业列表。可能的专业列表不固定。如果视图想要在组合框中呈现它们，它需要来自数据库的所有可能专业的列表。视图不应该直接从数据库中获取它们，所以我是否再次执行聚合模型并为视图提供 UserProfile 和有效专业列表？

我想我想弄清楚的一般问题是我是否应该对创建许多基本上特定于单个视图的小模型类感到满意。每个类都将包括该特定视图所需的更大域模型的各种不相关部分。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-08-21T19:25:45.760

**ViewModel**模式更具体地适用于您所描述的场景。您可以使用**ViewData**，但这是不太推荐的解决方案，因为您失去了 ASP.NET MVC 框架的许多好处。例如，当您使用**ViewData**时，您的视图中没有类型安全、编译时检查和智能感知支持。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T14:22:51.223

对于您的场景，我在 ViewData 中传递另一个参数 ViewData["AllowEdit"] 如果 View 应该显示编辑链接，则该参数设置为 true。我更喜欢将模型克隆到特定于视图的模型中以添加这个单一属性。我有时会创建特定于视图的模型——例如，我有一个 Grid ViewUserControl，它采用一个网格模型，我可以从其他模型类的任何列表中生成它——但在这种情况下我不会。

在我看来，我会做这样的事情：

```
<% if (Convert.ToBoolean(ViewData["AllowEdit"])) { %>
<%= Html.ActionLink("Edit", "Edit", "Profile",
                    new { id = ViewData.Model.ID }, null ) %>
<% } %> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T14:30:19.197

对于您的第一种情况，我可能会尝试将其逻辑封装在配置文件模型中，可能使用 CanEdit() 之类的函数，它接受用户信息参数并检查用户是否是配置文件的所有者或者他们是否具有超级用户权限. 然后在控制器中，我将调用该函数并使用 ViewData 将结果传递给视图。

其次，在编辑配置文件控制器操作中，检索专业列表（通过模型）并使用 ViewData 将其传递给视图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T14:30:45.937

您可以为所有视图模型类创建一个基本模型类，并在其中包含在许多视图中被认为有用的信息，即使不是在所有视图中也是如此。例如，当前登录用户的 ID。

```
public class BaseModel
{
    Guid ActiveUserId;
}

public class EditModel : BaseModel
{
    Guid AuthorUserId;
} 
```

然后，在您看来，您可以进行基本比较：

```
<% if (Model.ActiveUserId == AuthorUserId)
    Response.Write (Html.ActionLink (.....)) %> 
```

这个简单的检查是完全可以的，它没有太多的逻辑，无论如何，应该有人决定这个链接是否应该出现。当然，您可以制作两种不同的视图，带有链接和不带有链接，但这有点矫枉过正。

# math - NineBlock 代

> ID：516056
> 
> 赞同：1
> 
> 时间：2009-02-05T14:15:06.823
> 
> 标签：math, identicon

我希望自己实现这些在 StackOverflow 上找到的 Identicons 或 Gravatar。我能找到的大多数问题都是关于利用现有的 3rd 方库，尤其是那些与[Gravatar](http://en.gravatar.com/)挂钩的库。

[![替代文字](https://i.stack.imgur.com/DE8h5.jpg)](https://i.stack.imgur.com/DE8h5.jpg)
[（来源：[levated.net](http://www.levitated.net/daily/9bExamples.jpg)）]

经过一番搜索，我偶然发现了[这个页面](http://www.levitated.net/daily/lev9block.html)。从它的外观来看，它并不难。需要随机挑选的是：

*   一种形状在中间
*   角落的一种形状
*   边缘的一种形状
*   2 种颜色
*   除中间形状外的所有形状的旋转

使用 md5 哈希值播种随机发生器并开始检索随机数。然后，将 (pi/2)*i 添加到边缘周围的每个形状，以创建酷炫的径向对称效果。

你可以说我在这里用文字思考，但我想知道我是否误解了任何东西。此外，如果您有任何想法，可以随机分配更多以增加多样性。如果我开始更改以下内容，外观或感觉是否会“损坏”：

*   形状的比例？
*   然后也许还有块内形状的位置偏移？
*   选择两种以上的颜色？每个块有两种颜色，具有相同的径向对称性？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-03T20:44:40.733

正如您在本网站上您自己的 gravatar 中看到的那样，您可以选择 4x4 字段。每边偶数个单元格对中间使用的形状的限制较少，因为它们也会旋转。

如果旋转，则可以允许偏移。在两个维度上相等的偏移量可能看起来更对称并且可能受到青睐，但没有必要这样做。

您也可以以不同的方式旋转 180°，失去一些对称性，但正如您[在此处](http://en.wikipedia.org/wiki/Identicon)看到的，它确实为您提供了有趣的标识。

当然，您可以选择两种以上的颜色。从审美的角度来看，明智地选择特定方案中的颜色。也许一些效果，比如使颜色逐渐向边缘变亮或变暗，看起来会很有趣。

我是否正确理解您，您将使用用户电子邮件地址的 MD5 值播种随机发生器，从而能够即时重新计算他​​的 gravatar？然后不需要让他创建一个帐户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-03T20:48:54.360

也称为“同名”

*   [https://stackoverflow.com/questions/tagged/gravatar](https://stackoverflow.com/questions/tagged/gravatar)
*   [http://en.wikipedia.org/wiki/Identicon](http://en.wikipedia.org/wiki/Identicon)
*   [https://stackoverflow.com/questions/267945/how-do-you-generate-that-default-avatar-in-stackoverflow](https://stackoverflow.com/questions/267945/how-do-you-generate-that-default-avatar-in-stackoverflow)

# time - 添加小数作为时间

> ID：516057
> 
> 赞同：0
> 
> 时间：2009-02-05T14:15:07.917
> 
> 标签：time, excel-2007, decimal

无论如何添加一组十进制数字并将其视为时间？例子; 15.00 = 15 小时 1.00 = 1 小时 .20 = 20 分钟 .45 = 45 分钟 .15 = 15 分钟

excel将此添加到16.80，但如果你想要它作为时间答案将是17.15

17 小时 15 分钟

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T14:27:10.717

我猜你正在制定某种时间表。我将数据以 0:45、0:30、7:00 等形式输入到 Excel 电子表格中，并确保时间单元格的格式为 [h]:mm，因此 > 24 小时的时间不会显示为日期。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T20:26:35.937

现在才注意到您的评论，所以我认为您在 Excel 中的数据已经为 0.25 = 25 分钟。

您可以使用以下公式添加一个新列：

```
=FLOOR(A1,1) + (A1 - FLOOR(A1,1)) * 5/3 
```

（假设数据在 A 列）

如果访问数据包含像 1.8 这样的数字，您将得到奇怪的值（在这种情况下，您将得到 2 小时 20 分钟）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T14:28:55.080

你我遇到了很多问题，特别是如果 .20 是 20 分钟。如果是这样，0.8 是多少？80分钟？1小时20分钟？

# c# - Microsoft 报告服务与子报表流有关的问题

> ID：516058
> 
> 赞同：2
> 
> 时间：2009-02-05T14:15:22.113
> 
> 标签：c#, reporting-services, subreport

> **可能重复：**
> [Reporting Services 2008 - 长子报表导致分页](https://stackoverflow.com/questions/1008432/reporting-services-2008-long-subreports-cause-page-break)

我在报告服务主报告中有一个子报告。子报表大约从主报表页面的中间开始。如果我在子报表中的详细信息行很少，以便所有内容都可以在第一页上呈现，那么一切都很好。但是，如果子报表中有更多详细信息行，因此无法在第一页上打印所有内容，则整个子报表将移至第二页。我不希望发生这种情况，如何避免？

我还注意到，如果子报表中有超过一页的数据，它也会从第一页开始，并按照我的意愿流动。我想避免出现这样的情况：我的行数超过了第一页的容量，而行数仍然少于一页。我认为 KeepTogether 属性控制了这一点，但在我的报告中它设置为 false。

有任何想法吗 ？

# eclipse - Eclipse PDE - 标记注释类型 - 背景颜色未更新

> ID：516065
> 
> 赞同：3
> 
> 时间：2009-02-05T14:16:27.460
> 
> 标签：eclipse

我是一名学生，作为年度项目的一部分，我正在开发 eclipse 插件。
我遇到了一个奇怪的问题并尝试修复它 2 天：

我在`plugin.xml`.
对于我添加的每个标记和我添加的`annotationTypes`每个. 我的目的是为背景线着色。 在每一个中，我都放置了不同的图标和不同的.`annotationType``markerAnnotationSpecification`

`markerAnnotationSpecification``colorPreferenceValue`

奇怪的是：
创建标记时，一切都很好，甚至显示图标（每个标记的图标不同），但每个标记的线条背景颜色相同。
我注意到`markerAnnotationSpecification colorPreferenceValue`每次都是最后一次。
当我更改 中的顺序时`markerAnnotationSpecification`，`plugin.xml`颜色变为最后一个。

我不知道该怎么办？

我也到了偏好页面并在那里更改了注释类型颜色 - 应用后我看到它将 3 注释类型颜色更新为相同的颜色。
我不能添加一个以上（我不这么认为......）
我可以以`markerAnnotationSpecification.colorPreferenceValue`编程方式控制吗？如果是这样，如何？

我正在添加我的代码 - 也许你会看到我没有看到的内容：

```
 <extension id="BatonPassing.diff_marker_b"
              name="SiteBDiffMarker"
              point="org.eclipse.core.resources.markers">
      <super type="org.eclipse.core.resources.textmarker"/>
      <persistent value="true"/>
 </extension>

 <extension
         point="org.eclipse.ui.editors.annotationTypes">
         <type
             name="diffAnnotationB"
             super="org.eclipse.ui.workbench.texteditor.info"
             markerType="BatonPassing.diff_marker_b">
             <!--markerSeverity="0"-->
         </type>
   </extension>

   <extension
         point="org.eclipse.ui.editors.markerAnnotationSpecification">
         <specification
             icon = "icons/il.gif"
             annotationType="diffAnnotationB"
             verticalRulerPreferenceKey="highlight.rulers.vertical"
             textPreferenceKey="highlight.text"
            colorPreferenceKey="highlight.color"
            highlightPreferenceKey="highlight.background"
            textPreferenceValue="true"
            textStylePreferenceValue="BOX"
            overviewRulerPreferenceKey="highlight.rulers.overview"
            presentationLayer="4"
            highlightPreferenceValue="true"
            label="DiffSiteB"
            symbolicIcon="warning"
            colorPreferenceValue="255,0,0"
            verticalRulerPreferenceValue="true"
            overviewRulerPreferenceValue="true"
            textStylePreferenceKey="highlight.text.style" >
        </specification >
    </extension> 
```

每个标记代码都是相同的，但 ID 和名称`colorPreferenceValue`不同。

请帮我。非常感
谢哈达斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-06-13T21:52:17.790

colorPreferenceKey 对于每个 markerAnnotation 规范都应该是唯一的。那应该可以解决您的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-11-30T10:56:43.903

如果有人还在为这个问题而苦苦挣扎。您需要将`presentationLayer`属性更改为`specification`与`markerAnnotationSpecification`. 最好使最高优先级的注释获得最小的数字，即`1`其余的从那里获得递增的数字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-17T01:18:20.977

您确定在插件的 Java 代码中创建它们时指定了不同的标记 ID 类型字符串吗？只是一个健全的检查...

# sharepoint - 使用 CAML 的 MAX 查询

> ID：516073
> 
> 赞同：8
> 
> 时间：2009-02-05T14:17:46.430
> 
> 标签：sharepoint, moss, caml

我想选择一个共享点列表项，它具有特定列的最大值。如何使用 CAML 查询来做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-08-12T09:49:02.533

以下 CAML 查询将返回给定列的最大值：

```
var maxValue;

try
{
    using (SPSite objSite = new SPSite(sSiteUrl))
    {
        using (SPWeb objWeb = objSite.OpenWeb())
        {
            SPList objList = objWeb.Lists[sListName];

            SPQuery objQuery = new SPQuery();
            objQuery.Query = "<OrderBy><FieldRef Name='ColumnName' Ascending='False' /></OrderBy><RowLimit>1</RowLimit>";
            objQuery.Folder = objList.RootFolder;

            // Execute the query against the list
            SPListItemCollection colItems = objList.GetItems(objQuery);

            if (colItems.Count > 0)
            {
                maxValue = (<Insert Appropriate Cast>) colItems[0];
            }
        }
    }
}
catch (Exception ex)
{
    ...
}

return maxValue; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-06T16:15:18.313

```
<Query>
    <OrderBy>
            <FieldRef Name="particularcolumn" Ascending="FALSE" />
    </OrderBy>
</Query> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T22:02:30.390

这可以通过此字段以降序方式排序并获取返回的集合的第一个元素。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-24T20:19:13.303

使用客户端对象模型，这就是我从列表中检索最大 ID 的方式。

```
using (ClientContext clientContext = new ClientContext("https://sharepointed.com"))
    {
        clientContext.Credentials = System.Net.CredentialCache.DefaultNetworkCredentials;

        oWeb = clientContext.Web;

        List myList= oWeb.Lists.GetByTitle("MyList");

        CamlQuery camlQuery = new CamlQuery();
        camlQuery.ViewXml = ("<View><Query> <OrderBy> <FieldRef Name='ID' Ascending='False' /> </OrderBy> </Query> <RowLimit>1</RowLimit> </View>");
        Microsoft.SharePoint.Client.ListItemCollection listItems = myList.GetItems(camlQuery);
        clientContext.Load(listItems);
        clientContext.ExecuteQuery();
     } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-06-01T15:35:21.803

```
<script type="text/javascript" charset="utf8" src="/jquery-3.2.1.min.js"></script>
<script type="text/javascript" charset="utf8" src="/jquery.SPServices-2014.02.min.js"></script>

<script type="text/javascript">

    function getLastItemId() {
    var userId = _spPageContextInfo.userId;
    var caml = "<View><Query><Where>"
        + "<Eq><FieldRef Name='Author' LookupId='TRUE' /><Value Type='Integer'>" 
        + userId + "</Value></Eq></Where>" 
        + "<OrderBy><FieldRef Name='Created' Ascending='False' /></OrderBy>" 
        + "</Query><RowLimit>1</RowLimit></View>";
    var ctx = SP.ClientContext.get_current()
    var web = ctx.get_web()
//ENTER YOUR LIST NAME BELOW
    var list = web.get_lists().getByTitle("YOUR LIST NAME")
    var query = new SP.CamlQuery();
    query.set_viewXml(caml);
    var items = list.getItems(query);
    ctx.load(items)
    ctx.executeQueryAsync(function() {
// success actions
        var count = items.get_count();
        //should only be 1
        if (count > 1)  {
           throw "Something is wrong. Should only be one latest list item / doc";
        }

        var enumerator = items.getEnumerator();
        enumerator.moveNext();
        var item = enumerator.get_current();
        var id = item.get_id();
// do something with your result!!!!
        alert(id);
}, function() { 
        //failure handling comes here
        alert("failed"); 
});
}
getLastItemId();

</script>
<button id="button1" type="button" onclick="getLastItemId();">click to get last ID</button> 
```

我设法让以下工作我使用了脚本 Web 部件并将以下内容添加到 Web 部件中。当您单击该按钮时，将弹出一个带有最高项目 ID 号的警报。

# clojure - Clojure 'if' 从不评估它的第三个参数

> ID：516082
> 
> 赞同：7
> 
> 时间：2009-02-05T14:18:44.197
> 
> 标签：clojure

一段时间以来，我一直试图弄清楚这个。

```
(defn is-decimal [astr]
  (if (. astr (indexOf (int \.)))
    (Double/parseDouble astr)
    (Integer/parseInt astr))) 
```

这就是我写的函数。`is-decimal`要么传递诸如 "2.5" 或 "5" 之类的东西，但它总是使用`if`' 的第二个参数，而不是它的第三个参数。我`(. astr (indexOf (int \.)))`在 REPL 中进行了测试，它似乎工作正常，失败时返回 -1，失败时返回 1。我相信这可能是问题所在。-1 在 Clojure 中并不意味着错误。谁能想到解决这个问题的方法？

提前致谢。

编辑：感谢您的帮助。在我写完这篇文章后，我有了一个想法。我编写了一个检查 1 和 -1 的谓词函数。正是我需要的。我不应该在醒来后直接编码：\

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-06T19:16:16.437

如果要测试字符串是否包含字符，可以使用正则表达式：

```
(re-find #"\." astr) 
```

或者：

```
(some #(= \. %) astr) 
```

或者：

```
(contains? (into #{} astr) \.) 
```

或者您也可以使用`includes?`clojure.contrib.seq [-utils](https://github.com/clojure)来执行此操作。

Clojure 已经有一个知道如何区分整数和双精度数的阅读器，所以如果你确定你的字符串中只有数字，你可以使用它。（但要小心，这会读取任何内容，而不仅仅是数字。这有潜在的危险。如果您的字符串有可能不是数字，请不要使用它。）

请注意，Clojure 还处理整数太大而无法装入本机`int`而不溢出的情况。如果要解析整数，可能需要查看[bigint](http://clojure.org/api#toc105)函数而不是`parseInt`.

```
user> (class (read-string "2.5"))
java.lang.Double
user> (class (read-string "2"))
java.lang.Integer
user> (class (read-string "2000000000000"))
java.math.BigInteger 
```

如果你的函数是一个谓词，那么在 Clojure 中通常将其命名`decimal?`而不是`is-decimal`. 您的函数实际上更像是一个数字解析器，所以我个人将其称为`parse-number`或`string-to-number`.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T14:26:40.343

未经测试：

```
(if (> 0 (. astr (indexOf (int \.)))) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T14:25:30.127

好吧，如果它确实返回 -1 如果它失败然后检查 -1 并返回 false 如果它是

# php - PHP Regex - /i caseless not working 和奇怪的空数组元素

> ID：516088
> 
> 赞同：0
> 
> 时间：2009-02-05T14:19:36.643
> 
> 标签：php, regex

源文本（7）：

1.  给4辆车
2.  嘎5车
3.  GA 5 Cars @mustang 需要六个排气管
4.  给 -1 汽车 @mustang
5.  给汽车@mustang
6.  给 3 辆车 @ford
7.  给 5 辆车 @cobra_gt

应该成功的吃了1,2,3,6,7

preg_match('/Give (\d+) Cars @(\w+)|GA (\d+) Cars @(\w+)/i', $a->text, $output);

print_r($输出); 产生：

```
Array
(
)
Array
(
)
Array
(
    [0] => GA 5 Cars @mustang
    [1] => 
    [2] => 
    [3] => 5
    [4] => mustang
)
Array
(
)
Array
(
)
Array
(
    [0] => Give 3 Cars @ford
    [1] => 3
    [2] => ford
)
Array
(
    [0] => Give 5 Cars @cobra_gt
    [1] => 5
    [2] => cobra_gt
) 
```

如您所见，它不适用于小写字母，对于数字 #3，它不会产生正确的数组，而是产生空元素。知道我在哪里出错了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T14:27:31.353

1 和 2 丢失 @ 4 有 -1（这与 \d 不匹配） 5 缺少数字

您可以将“@”更改为“（@）？” 使 @ 可选。

或者：

```
preg_match('/(Give|GA) (-?\d+) Cars( @(\w+))?/i', $a->text, $output); 
```

关于空数组元素，您有 4 个子匹配项，即使它们由或 (|) 分隔，它们都算数，并且只会填充匹配中使用的子匹配项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T14:38:34.593

给定输入：

1.  给4辆车
2.  嘎5车
3.  GA 5 Cars @mustang 需要六个排气管
4.  给 -1 汽车 @mustang
5.  给汽车@mustang
6.  给 3 辆车 @ford
7.  给 5 辆车 @cobra_gt

和表达式：

```
/Give (\d+) Cars @(\w+)|GA (\d+) Cars @(\w+)/i 
```

1.  不匹配，因为您只匹配其中包含“ `@something`”的内容。
2.  与#1 相同
3.  这符合预期
4.  `-`前面的导致`1`匹配失败
5.  `Give`和之间没有数字`Cars`
6.  这符合预期
7.  这符合预期

至于为什么它不产生“正确”的数组，它实际上是。在您的表达式中，您有 4 个捕获组。仅仅因为您的输入与 OR'd 表达式中的第二个匹配（“ `GA`”一个）并不意味着组编号从 1 开始，因此无论您如何匹配，组将始终具有相同的编号，所以...

```
/Give (\d+) Cars @(\w+)|GA (\d+) Cars @(\w+)/i
      ^ 1         ^ 2      ^3          ^4 
```

因此，如果您匹配 ' `Give`' 情况，您将拥有第 1 组和第 2 组，如果您匹配 ' `GA`' 情况，则将填充第 3 组和第 4 组。

（另外，' `i`'修饰符工作正常，你只是没有正确考虑你的输入）

# sql-server - 如何查看 SQL 2000 数据库中最近的关系更改

> ID：516091
> 
> 赞同：3
> 
> 时间：2009-02-05T14:21:16.093
> 
> 标签：sql-server

我有一个 SQL Server 2000 数据库，在特定时间范围内有很多 PK/FK 关系更改。有什么方法可以检索到数据库的所有关系更改或添加？

我尝试了返回所有 ForeignKeys 的查询。

```
SELECT f.constid, OBJECT_NAME(f.fkeyid) AS 'FKTable', c1.[name] AS 'FKColumnName', OBJECT_NAME(f.rkeyid) AS 'PKTable', c2.[name] AS 'PKColumnName'
FROM sysforeignkeys f
INNER JOIN syscolumns c1
ON f.fkeyid = c1.[id]
AND f.fkey = c1.colid
INNER JOIN syscolumns c2
ON f.rkeyid = c2.[id]
AND f.rkey = c2.colid
ORDER BY constid
GO 
```

我希望 constid 字段是连续的，所以我可以查找在特定 constid 之后所做的任何事情。但是事实并非如此，它似乎没有按任何顺序编写 constid 。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T14:22:39.167

不，除非你在某个地方有一个复制品和像 Redgate 的比较这样的工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T14:23:01.457

除非您使用触发器进行一些特殊的日志记录，以便在创建、更改或删除关系时，没有自动获取最近关系更改列表的方法。

# .net - 一键更新所有 WCF 服务引用（单击两次也可以！）

> ID：516098
> 
> 赞同：4
> 
> 时间：2009-02-05T14:23:29.367
> 
> 标签：.net, asp.net, visual-studio, wcf, reference

我有多个项目包含多个 WCF 服务引用。

我的 WCF 服务处于不断变化的状态，因此我经常不得不四处走动并更新我的所有服务引用。

有没有办法通过一个动作来实现这一目标？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T14:25:28.300

好吧，您可以`svcutil`通过构建脚本在命令行中使用，而不是使用 IDE？然后你所要做的就是重新执行 bat/script/whatever...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T00:40:44.283

我根本不使用生成的代理。我的客户端和服务器之间只有一个共享程序集，它定义了服务合同接口+以下技巧。

```
 // this class can be used to instantiate a unidirectional proxy (one that doesn't require callbacks from the server)
    public class UniDirectionalServiceProxy<T> : System.ServiceModel.ClientBase<T> where T : class
    {
        public UniDirectionalServiceProxy()
        {
        }

        public UniDirectionalServiceProxy(string endpointConfigurationName) :
            base(endpointConfigurationName)
        {
        }

        public UniDirectionalServiceProxy(string endpointConfigurationName, string remoteAddress) :
            base(endpointConfigurationName, remoteAddress)
        {
        }

        public UniDirectionalServiceProxy(string endpointConfigurationName, System.ServiceModel.EndpointAddress remoteAddress) :
            base(endpointConfigurationName, remoteAddress)
        {
        }

        public UniDirectionalServiceProxy(System.ServiceModel.Channels.Binding binding, System.ServiceModel.EndpointAddress remoteAddress) :
            base(binding, remoteAddress)
        {
        }

        // new keyword allows us to supercede the inherited protected member and make it public.
        public new T Channel
        {
            get
            {
                return base.Channel;
            }
        }
    } 
```

看起来很熟悉，对吧？构造该对象，然后您只需更改调用以使用 Channel 成员。

您也可以使用 ChannelFactory 来获得几乎相同的结果（我假设他们将 Channel 作为 ClientBase 的受保护成员以鼓励开发人员使用 ChannelFactory），但我更喜欢这种机制，因为您最终会得到一个封装通信控制和调用的单个对象穿过电线。显然，这样你就失去了 svcutil 的异步方法，但无论如何用委托来做自己很容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T20:27:29.007

如果可以的话，我更愿意避免通过 IDE 机制设置对 WCF 服务的引用。我宁愿简单地在单独的类库中提供代理。这样，通常会发生的情况是源代码存储库的更新会破坏本地副本的构建，然后很明显需要更改某些内容。毕竟，它应该像任何公共接口更改一样痛苦。我不是 svcutil.exe 的粉丝。

# web-services - 在 ColdFusion 中获取可读的 WSDL 服务方法参数错误

> ID：516099
> 
> 赞同：1
> 
> 时间：2009-02-05T14:23:33.313
> 
> 标签：web-services, coldfusion, error-handling, wsdl

我正在开发一个服务调用脚本，如下所示：

```
<cfinvoke webservice="#ServiceURL#" method="AddCustomer" returnvariable="ResponseData" argumentcollection="#stAguments#">
    <cfinvokeargument name="api_key" value="#ServiceKey#" />
</cfinvoke> 
```

**显然，在此调用之前填充了stAguments**结构。想象一下，您忘记将参数之一添加到此容器中或使用了错误的参数类型，例如创建了无效请求。ColdFusion 抛出可以被捕获的异常，但不能（不是字面意思）被读取：

```
*Web service operation AddCustomer with parameters {postcode={12345},org_name={Terms test 7.79661762856},fax={},html={1},addr1={address1},firstname={sergey},city={Austin},country={},taxable={},notify={1},lastname={galashyn},addr2={},ssn={},api_key={8FE9AD0BCF2382D92A1080DB3AA62DB9},taxrate={0},terms={Net 15},active={},state={},salutation={Mr.},password={123},account_manager={1}} cannot be found.* 
```

手动一一检查所有这些参数让我大吃一惊。这就是问题。

也许有人使用一些技术来使这更容易。

我什至考虑过某种解析器来自动进行这种比较。

将欣赏任何想法和想法。

谢谢你。

PS对不起我的英语——不是我的母语。请问我是不是写的不够清楚。

**编辑：**

澄清。问题不在于访问服务。我是它的所有者，我绝对知道每种方法的所有参数及其类型。

问题仅在于创建请求时读取错误消息——填充方法参数容器。

例如，方法有 10 个参数，但我不小心添加了 9 个 - CF 的本地实例抛出错误，该方法无法找到并显示我已传递的字段的原始列表（上面列出的）。我需要将它们与方法参数一一进行比较，以找到我错过的内容。

确实，这是一个可用性和节省时间的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T17:48:14.257

> 确实，这是一个可用性和节省时间的问题。

好的，所以如果我对您的理解正确，您需要一种“调试”方式来比较您所拥有的与您需要的。

让我们假设你有一个“这就是它应该是这样”的结构：

```
<cfset WSargs = StructNew()>
<cfset WSargs.AddCustomer = StructNew()>
<cfset WSargs.AddCustomer.postcode  = "\d{5}">
<cfset WSargs.AddCustomer.org_name  = ".+">
<cfset WSargs.AddCustomer.fax       = ".*">
<cfset WSargs.AddCustomer.html      = "^[01]$">
<cfset WSargs.AddCustomer.addr1     = ".*">
<cfset WSargs.AddCustomer.firstname = ".*">
<cfset WSargs.AddCustomer.city      = ".*">
<cfset WSargs.AddCustomer.country   = ".*">
<cfset WSargs.AddCustomer.taxable   = ".*">
<cfset WSargs.AddCustomer.notify    = "^[01]$">
<cfset WSargs.AddCustomer.lastname  = ".*">
<cfset WSargs.AddCustomer.addr2     = ".*">
<cfset WSargs.AddCustomer.ssn       = ".*">
<cfset WSargs.AddCustomer.taxrate   = "^\d*$">
<cfset WSargs.AddCustomer.terms     = ".*">
<cfset WSargs.AddCustomer.active    = ".*">
<cfset WSargs.AddCustomer.state     = ".*">  
<cfset WSargs.AddCustomer.salutation= ".*">
<cfset WSargs.AddCustomer.password  = ".+">
<cfset WSargs.AddCustomer.account_manager = "^[01]$"> 
```

并且您需要一个与 this 进行比较的函数`argumentcollection`。

```
<cffunction name="CompareStructs" returntype="array" output="no">
  <cfargument name="template" type="struct" required="yes">
  <cfargument name="data"     type="struct" required="yes">

  <cfset var errors = ArrayNew(1)>
  <cfset var key = "">

  <cfloop collection="#template#" item="key">
    <cfif StructKeyExists(data, key)>
      <cfif REFind(template[key], ToString(data[key])) eq 0> 
        <cfset ArrayAppend(errors, "Field '#key#' has an invalid value.")>
      </cfif>
    <cfelse>
      <cfset ArrayAppend(errors, "Field '#key#' is missing.")>
    </cfif>
  </cfloop>

  <cfloop collection="#data#" item="key">
    <cfif not StructKeyExists(template, key)>
      <cfset ArrayAppend(errors, "Field '#key#' is not allowed.")>
    </cfif>
  </cfloop>

  <cfreturn errors>
</cffunction> 
```

像这样调用：

```
<cfset errors = CompareStructs(WSargs.AddCustomer, stAguments)>

<cfif ArrayLen(errors) eq 0>
  <cfinvoke 
    webservice="#ServiceURL#" 
    method="AddCustomer" 
    returnvariable="ResponseData" 
    argumentcollection="#stAguments#"
  >
    <cfinvokeargument name="api_key" value="#ServiceKey#" />
  </cfinvoke>
<cfelse>
  <cfdump var="#errors#" label="Errors calling AddCustomer()">
  <cfabort>
  <!--- or whatever --->
</cfif> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T15:31:36.140

您的头痛源于仅接受传递给您的方法的值而没有验证输入。这很容易通过在您的方法中添加验证和重载来解决。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T20:33:36.910

最后，我完成了编写额外的代码来帮助我测试我的服务。此外，我需要为我的 API 用户提供 CFML 中的示例并将这些任务结合起来。

想分享代码示例，也许其他人会发现它们有用。

我使用了验证结构方法（但通过删除正则表达式来简化它，因为它们在我的情况下是开销——服务验证传入的参数并报告错误）。主要思想是提取 WSDL 并构建结构模板以与测试数据进行比较。此外，添加了带有接口的简单脚本来测试不同的方法，它可以帮助我更快地测试服务的变化。

因此，这里是[用于获取 WSDL 和比较结构的 UDF](http://galashyn.com/assets/code/udflib.cfm.txt)（我的 XPath-fu 可能并不完美：），这里是[基本测试代码](http://galashyn.com/assets/code/invoke.cfm.txt)。

*希望这种发布代码的方式不会违反规则。*认为在这里发布它不是一个好主意。

特别感谢[Tomalak](https://stackoverflow.com/users/18771/tomalak)的想法。

# jquery - 在主元素对象上扩展 jquery

> ID：516110
> 
> 赞同：1
> 
> 时间：2009-02-05T14:27:10.483
> 
> 标签：jquery

我看过一些 jquery 代码，人们在其中扩展了主要对象，例如：

```
 $('someId').myCustomObject(); 
```

这是可能的还是我弄错了？（如果是，如何？）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T14:43:04.990

是的，这很容易实现。构建扩展的标准模式是：

```
(function($) {

  $.fn.myCustomObject = function(options) {
    var defaults = { ... };
    var opts = $.extend(defaults, options);

    this.each(function(i) {

      ... // Act on each item, $(this).
      ... // Use opts.blah to read merged options.

    });
  };

})(jQuery); 
```

这允许您在插件中使用“$”，但允许兼容模式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T14:30:13.317

我相信您正在寻找的是 jQuery.fn.extend：

[jQuery.fn.extend](http://docs.jquery.com/Core/jQuery.fn.extend)

# asp.net - 构建时验证所有 ASPX、ASCX 和 HTML 文件

> ID：516118
> 
> 赞同：5
> 
> 时间：2009-02-05T14:28:26.843
> 
> 标签：asp.net, html, visual-studio, validation

当您打开文件时，Visual Studio 将在错误列表窗口中显示 AS?X 或 HTML 文件中的错误。但是，一旦您关闭文件，错误就会从错误列表中删除。

是否可以在一个操作中验证所有 AS?X 和 HTML 文件（最好是作为构建的一部分）并一次显示所有错误？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T18:04:56.207

如果您使用的是 Web 应用程序项目，则可以添加使用**aspnet_compiler**编译应用程序的构建任务。

# sql - 如何在 T-SQL 2005 中删除之前触发触发器？

> ID：516119
> 
> 赞同：18
> 
> 时间：2009-02-05T14:28:48.903
> 
> 标签：sql, sql-server-2005, tsql

如何在 T-SQL 2005 中删除之前触发触发器？FOR 实际上在事件之后触发，并且它们似乎在 TRIGGER 函数中没有 BEFORE 参数。INSTEAD OF 不是我想要的。我需要在删除记录之前触发。有任何想法吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-05T14:42:15.007

您可以使用 INSTEAD OF 选项，只需显式删除末尾的行。例如：

```
CREATE TRIGGER dbo.My_Table_Delete_Instead_Of_Trigger
ON dbo.My_Table
INSTEAD OF DELETE
AS
BEGIN

     -- Do some stuff here

     DELETE T
     FROM DELETED D
     INNER JOIN dbo.My_Table T ON T.PK_1 = D.PK_1 AND T.PK_2 = D.PK_2
END 
```

这假定主键由列 PK_1 和 PK_2 组成。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T14:35:23.693

你不能。但是您可以在 AFTER DELETE 触发器中执行回滚。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T14:36:25.237

你不能。您可以做的是检查 DELETE 表并在需要时撤消删除。

以下是事件顺序：

*   向 SQL Server 发送 DELETE 命令
*   项目已从表中删除
*   OnDelete 触发器触发执行您的
*   逻辑如果逻辑失败/通过/无论如何，撤消删除

# php - 是否可以在没有 https 服务器的情况下拥有安全的 Web 表单？

> ID：516127
> 
> 赞同：6
> 
> 时间：2009-02-05T14:31:13.517
> 
> 标签：php, javascript, http, https

我有一个托管在提供商上的网站，它没有给我一个固定的 IP 地址，所以我不能使用 https。我想使用网络表单但以安全的方式编辑某些页面。

客户端将是 iphone 类型的设备，因此 java 或 flash 小程序将是不可能的。

*   有没有办法只在浏览器中使用 javascript 在服务器和浏览器之间建立安全连接？

服务器上的语言目前是 php，但它可以是 ruby​​、python、perl 或 lua。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-05T14:36:42.023

安装 SSL 证书在技术上不需要固定的 IP 地址 - SSL 证书与主机名（通用名称）相关联。我们经常更改主机上的 IP 地址，并且从未更改与证书相关的任何内容。

也就是说，你确实可以使用 JavaScript 或类似的东西，但这并不是一个很好的解决方案——它总是闻起来像黑客。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T14:37:17.013

您可以使用在 javascript 中实现的某种形式的[公钥加密](http://www.hanewin.net/encrypt/)：

*   你给客户端表单、你的公钥和一个 js 加密库
*   提交时，js 开始加密表单有效负载
*   你用你的私钥解密

这将阻止任何人在网络上嗅探您的敏感信息，但不提供任何针对中间人攻击的保护。SSL 使这种攻击更难实施，但并非不可能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T14:39:05.543

不是传统意义上的，不是，但有几个选择：

1.  获得更好的托管。您可以以每月 20 美元的价格购买[具有固定 IP 的 VPS 。](http://www.linode.com/index.cfm)每年30美元的证书。对于需要安全的人来说相当便宜。

2.  [您可以使用 javascript 和 PGP](http://www.hanewin.net/encrypt/)加密表单数据。这很便宜（它会在您的用户看来），但它*应该*保证您的数据足够安全。

3.  可能有第三方允许通过他们的服务器（以及扩展）他们的证书提交表单。但是，您和您的用户必须相信他们不会滥用数据。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T14:34:57.940

*理论上*，您可以使用 Javascript 和 XmlHttpRequests在客户端和服务器之间实现某种安全通信。在实践中，这听起来像是很多工作，而且它快速且真正安全的机会似乎很低。

正如 Alex 上面所说，即使您设法在 JS 中实现，您仍然必须通过不安全的连接将 JS 提供给客户端，因此这一切都毫无意义。

尽管如此，更疯狂的事情已经在 J​​avascript 中实现了......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T14:34:41.620

我会说答案是否定的。原因是没有 https，所有流量都是未加密的纯文本。因此，任何人都可以读取客户端的任何加密算法或密钥交换。不过我可能是错的……我从未尝试过。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T14:38:25.233

这在理论上是可能的，前提是您可以控制客户端并且（例如）那里有未从服务器下载的受信任的 javascript。我可以详细说明，但与使用 https 相比，这些行中的任何内容都是 PITA 并且容易出错。

此外，不需要固定 IP - 你有域名吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T14:34:53.477

怎么可能使用Javascript？为了让浏览器执行 javascript，它必须首先从（前面提到的）不安全的服务器下载它。HTTPS 是一种服务器/客户端协议，因此如果您无法使用服务器本身实现，那么您将根本无法实现它。

HTTPS 所需要的只是一个 IP 地址，因此它是否更改也没关系。您应该能够使用带有动态 IP 的 HTTPS，但您可能需要与您的主机商交谈。如果您的主机位于共享服务器上，那么它将无法正常工作，您将需要一个专用 IP。它们并没有那么贵，所以也许你应该每月支付 3/4 美元？

亚历克斯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T14:39:57.477

SSL 根据域名而不是 IP 地址运行。只要您拥有并拥有一个域名，并且有一个愿意打开端口 443 并安装您为您的站点购买的证书的提供商，您就可以使用 HTTPS。

话虽这么说，假设您做不到，请查看[SRP](http://srp.stanford.edu/)：

来自该站点：“SRP 是一种安全的基于密码的身份验证和密钥交换协议。它解决了将客户端安全地验证到服务器的问题......此外，SRP 交换了一个加密强的秘密，作为成功身份验证的副产品，它使双方能够安全地通信。”

他们有一个 Javascript 示例。您将使用副产品通过网络加密数据。

但是，像大多数海报一样，您最好还是换一个新的提供商。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-31T16:56:01.507

差不多 2 年后，但现在 JavaScript 中有一个开源 SSL/TLS 实现。但是，它目前依赖 Flash 提供原始套接字访问......所以除非应用程序要在 android 手机而不是 iphone 上运行，否则它可能没有那么有用。

[http://github.com/digitalbazaar/forge/blob/master/README](http://github.com/digitalbazaar/forge/blob/master/README)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-01T14:04:19.723

是的。您可以使用[Private Forms](https://privateforms.com)中使用 PGP 加密的嵌入式表单。

Private Forms 是一种 SaaS，它在将数据发送到服务器之前对客户端的 Web 表单数据进行加密。然后，此加密数据将发送给您。所有数据都使用您的 PGP 公钥加密，只有您可以使用您的 PGP 私钥解密。

因此，填写表格的人知道它是“安全的”，但他们不需要熟悉细节（如生成密钥等）。

# c# - C#/WPF 中的选项卡式界面

> ID：516139
> 
> 赞同：3
> 
> 时间：2009-02-05T14:36:15.520
> 
> 标签：c#, wpf, tabbed

我目前正在开发一个带有选项卡式界面的应用程序。我希望能够通过将选项卡拖动到窗口的一个边缘来水平或垂直拆分工作区。

例如，打开两个标签：http: [//666kb.com/i/b65vvbusbxhvgy8mf.png](http://666kb.com/i/b65vvbusbxhvgy8mf.png)

然后将一个选项卡拖到屏幕底部并将其放下。应该出现第二个 tabcontrol：http: [//666kb.com/i/b65vvjnd1ylz54jdz.png](http://666kb.com/i/b65vvjnd1ylz54jdz.png)

如何在 .NET 3.5 中使用 C# 和 WPF 实现这一点？
我认为 Photoshop 可以做到这一点，而且我相信还有许多其他应用程序。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T14:38:14.673

查看[AvalonDock](http://www.codeplex.com/AvalonDock)，也许这可以帮助您进入正确的方向。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-05T03:47:33.527

Actipro 选项卡式工作区控件非常优雅，我自己没有看到任何错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T14:44:38.153

有一些图书馆可以做到这一点。除了 AvalonDock，还有[Sand Dock](http://www.divelements.com/net/controls/sanddockwpf/)和[Infragistics WPF Controls](http://www.infragistics.com/dotnet/netadvantage/wpf.aspx)。我都用过。两者都有自己的错误。在这一点上，我正在使用 Infragistics 控件，并且它们在每个版本中都变得更好。

# java - Java 6 是否为 JMX 远程连接打开默认端口？

> ID：516142
> 
> 赞同：28
> 
> 时间：2009-02-05T14:36:27.297
> 
> 标签：java, jmx, jconsole, jvisualvm

我的具体问题与 JDK 1.6 中使用的 JMX 有关：如果我使用 JRE 1.6 运行 Java 进程

```
com.sun.management.jmxremote 
```

在命令行中，Java 是否为远程 JMX 连接选择默认端口？

背景故事：我目前正在尝试开发一个程序来提供给客户，使他们能够通过 JMX 从远程机器连接到我们的一个流程。目标是促进他们对实时显示控制台上发生的情况进行远程调试。由于他们的服务水平协议，他们有强烈的动机去捕获尽可能多的数据，如果情况看起来太复杂而无法快速修复，则重新启动显示控制台并允许它重新连接到服务器端。

我知道我可以在 JDK 1.6 进程上运行[jconsole ，并在 JDK 1.6.7 后的进程上运行](http://java.sun.com/developer/technicalArticles/J2SE/jconsole.html)[jvisualvm](http://java.sun.com/javase/6/docs/technotes/tools/share/jvisualvm.html) ，并提供对控制台的物理访问权限。但是，由于涉及的操作要求和人员问题，我们有强烈的动力去远程获取我们需要的数据并让它们重新启动和运行。

编辑：我知道命令行端口属性

```
com.sun.management.jmxremote.port=portNum 
```

我要回答的问题是，如果您不在命令行中设置该属性，Java 是否会选择另一个端口进行远程监控？如果是这样，你怎么能确定它可能是什么？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2011-08-08T16:48:51.440

*AFAIK，*

以下是将*JMX 客户端进程*（像 jconsole、jmxterm、mc4j、jvmstat、jmxmonitor、jps 等**管理应用程序）连接到***JMX 服务器进程*（**代理**）的可能性。

假设连接 JMX 客户端和 JMX 服务器的协议是“Java RMI”（又名“RMI-JRMP”）。这应该是默认值。可以配置[其他协议](http://docs.oracle.com/javase/6/docs/technotes/guides/jmx/overview/connectors.html#wp5529)，特别是“RMI-IIOP”和“JMXMP”。特殊协议是可能的：例如，[MX4J](http://mx4j.sourceforge.net/)项目另外提供了 SOAP/HTTP 和各种基于 HTTP 的序列化协议。

有关配置的详细信息，请参阅[Sun/Oracle 文档](http://docs.oracle.com/javase/6/docs/technotes/guides/management/agent.html)。

还可以查看`jre/lib/management/management.properties`JDK 发行版中的文件。

所以，可能性：

**案例 0：JVM 在没有任何特定配置的情况下启动**

在 Java 6 之前：JVM 不充当 JMX 服务器。在 JVM 内部运行的任何程序都可以通过编程方式访问 JVM 的[MBeanServer](http://docs.oracle.com/javase/6/docs/api/javax/management/MBeanServer.html)并使用它来进行线程之间有趣的数据交换或进行 JVM 监控，但无法从 JVM 进程外部进行管理。

从 Java 6 开始：即使没有明确配置，也可以在*本地*（从同一台机器）访问 JVM 的 JMX 功能，如“案例 1”中所述。

**案例1：JVM启动`-Dcom.sun.management.jmxremote`**

JVM 配置为作为*本地*（仅限同一机器）JMX 服务器工作。

在这种情况下（原则上仅适用于 Sun/Oracle JVM），JMX 客户端可以通过`/tmp/hsperfdata_[user]`. 这在 Sun 文档中被提及并称为“本地监控”（以及[Attach API](http://docs.oracle.com/javase/6/docs/jdk/api/attach/spec/index.html)）。它不适用于 FAT 文件系统，因为在那里无法正确设置权限。请参阅[此博客条目](https://blogs.oracle.com/lmalventosa/entry/jconsole_local_process_list_on)。

Sun 建议`jconsole`在与 JMX 服务器分开的机器上运行，因为这`jconsole`显然是一种资源消耗，因此这种“本地监控”事情不一定是个好主意。

然而，本地监控相当安全，只能在本地使用并且可以通过文件系统权限轻松控制。

**案例 2：JMX 服务器启动时使用`-Dcom.sun.management.jmxremote.port=[rmiregistryport]`**

JVM 被配置为在多个 TCP 端口上侦听的 JMX 服务器。

命令行上指定的端口将由 JVM 分配，并且在那里可以使用 RMI 注册表。注册表公布一个名为“jmxrmi”的连接器。它指向第二个随机分配的 TCP 端口（一个“临时”端口），JMX RMI 服务器在该端口上进行侦听，并通过该端口进行实际的数据交换。

“案例 1”中描述的本地始终在“案例 2”中启用。

JMX 服务器默认侦听所有接口，因此您可以通过本地连接到 127.0.0.1:[rmiregistryport] 以及远程连接到 [任何外部 IP 地址]:[some port] 来连接到它（并控制它） .

*这意味着您必须考虑安全隐患*。您只能通过设置让 JVM 监听 127.0.0.1:[rmiregistryport] `-Dcom.sun.management.jmxremote.local.only=true`。

不幸的是，无法指定临时端口的分配位置——它总是在启动时随机选择。这很可能意味着您的防火墙需要成为该死的瑞士奶酪！但是，有一些[解决方法](http://olegz.wordpress.com/2009/03/23/jmx-connectivity-through-the-firewall/)。特别是，Apache Tomcat 通过其[JMX Remote Lifecycle Listener](http://tomcat.apache.org/tomcat-7.0-doc/config/listeners.html#Additional_Implementations)设置临时 JMX RMI 服务器端口。执行这个小魔法的代码可以在[org.apache.catalina.mbeans.JmxRemoteLifecycleListener](http://grepcode.com/file/repo1.maven.org/maven2/org.apache.tomcat/tomcat-catalina-jmx-remote/7.0.14/org/apache/catalina/mbeans/JmxRemoteLifecycleListener.java/)中找到。

如果您使用此方法，您不妨确保：

1.  JMX 客户端必须向 JMX 服务器进行身份验证
2.  客户端和服务器之间的 TCP 交换使用 SSL 加密

[Sun/Oracle 文档](http://docs.oracle.com/javase/6/docs/technotes/guides/management/agent.html)中描述了这是如何完成的

**其他方法**

您可以做一些有趣的排列来避免使用 RMI 协议。特别是，您可以将 servlet 引擎（如 Jetty）添加到您的流程中。然后添加 servlet，在内部将一些基于 HTTP 的交换转换为对 JVM 的直接访问`MBeanServer`。然后，您将处于“案例 0”，但仍具有管理功能，可能通过基于 HTML 的界面。[JBoss JMX 控制台](http://docs.oracle.com/javase/1.5.0/docs/guide/management/SNMP.html)就是一个例子。

[更题外话，您可以根据此文档](http://docs.oracle.com/javase/1.5.0/docs/guide/management/SNMP.html)直接使用 SNMP（我没有尝试过）。

**显示和告诉时间**

现在是时候用一些代码来说明 JXM 交换了。我们从[Sunoracle 教程](http://docs.oracle.com/javase/tutorial/rmi/client.html)中获得灵感。

这在 Unix 上运行。我们使用配置为 JMX 服务器的 JVM：

`-Dcom.sun.management.jmxremote.port=9001`

我们`lsof`用来检查它保持打开的 TCP 端口：

`lsof -p <processid> -n | grep TCP`

应该会看到类似这样的内容，注册表端口和临时端口：

```
java    1068 user  127u  IPv6 125614246                 TCP *:36828 (LISTEN)
java    1068 user  130u  IPv6 125614248                 TCP *:9001  (LISTEN) 
```

我们`tcpdump`用来检查 JMX 客户端和 JMX 服务器之间的数据包交换：

`tcpdump -l -XX port 36828 or port 9001`

我们在主目录中设置了一个文件`.java.policy`，以允许客户端实际远程连接：

```
grant {
    permission java.net.SocketPermission 
    "<JMX server IP address>:1024-65535", "connect,resolve";
}; 
```

然后我们可以运行它，看看会发生什么：

```
package rmi;

import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;

import javax.management.remote.rmi.RMIConnection;
import javax.management.remote.rmi.RMIServer;

public class Rmi {

    public static void main(String args[]) throws Exception {
        // We need a Security Manager (not necessarily an RMISecurityManager)
        if (System.getSecurityManager() == null) {
            System.setSecurityManager(new SecurityManager());
        }
        //
        // Define a registry (this is just about building a local data structure)
        // 
        final int comSunManagementJmxRemotePort = 9001;
        Registry registry = LocateRegistry.getRegistry("<JMX server IP address>", comSunManagementJmxRemotePort);
        //
        // List registry entries. The client connects (using TCP) to the server on the
        // 'com.sun.management.jmxremote.port' and queries data to fill the local registry structure.
        // Among others, a definition for 'jmxrmi' is obtained.
        //
        System.out.print("Press enter to list registry entries");
        System.in.read();
        String[] names = registry.list();
        for (String name : names) {
            System.out.println("In the registry: " + name);
        }
        //
        // 'Looking up' the entry registered under 'jmxrmi' involves opening and tearing down
        // a TCP connection to the 'com.sun.management.jmxremote.port', as well as a TCP
        // connection to an ephemeral secondary port chosen at server startup.
        // The actual object locally obtained is a "javax.management.remote.rmi.RMIServerImpl_Stub"
        // indicating where the ephemeral port is.
        // "RMIServerImpl_Stub[UnicastRef [liveRef: [endpoint:[$IP:$EPHEMERAL_PORT](remote),objID:[-62fb4c1c:131a8c709f4:-7fff, -3335792051140327600]]]]"        
        //
        System.out.print("Press enter to get the 'jmxrmi' stub");
        System.in.read();
        RMIServer jmxrmiServer = (RMIServer)registry.lookup("jmxrmi");
        System.out.println(jmxrmiServer.toString());
        //
        // Now get a "RMI Connection" to the remote. This involves setting up and tearing
        // down a TCP connection to the ephemeral port. 
        //        
        System.out.print("Press enter to get the 'RMIConnection'");
        System.in.read();
        RMIConnection rcon = jmxrmiServer.newClient(null);
        //
        // Ask away. This involves setting up and tearing
        // down a TCP connection to the ephemeral port. 
        //
        System.out.print("Press enter to get the 'domains'");
        System.in.read();
        for (String domain : rcon.getDomains(null)) {
            System.out.println("Domain: " + domain);
        }
        //
        // Ok, that will do. For serious applications, we better use the higher-level JMX classes
        //
    }   
} 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-02-05T15:28:24.383

[文档](http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html)建议 JMX 代理使用**本地**端口——从机器外部无法访问的端口——除非您指定以下属性：

`com.sun.management.jmxremote.port=portNum`

这是出于安全原因，也是出于 Potato Head 先生给出的原因。因此，看起来 Java 6 没有为 JMX 打开默认的*远程访问*端口。

编辑：在 OP 添加了包含更多信息的答案后添加。

您的另一个选择是以某种方式创建一个本地代理来侦听所有本地 JMX 连接并导出此信息。这样，您就不需要在服务器上对每个 JVM 实例进行如此神奇的配置。相反，本地代理可以通过 JMX 连接到所有 JVM，然后以某种方式远程公开这些信息。我不确定您将如何实现这一点，但与您通过 JMX 远程公开所有 JVM 所需的工作相比，这样的工作可能更少。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-11-25T08:22:03.443

实际上，您可以使用一个未记录的属性来强制 JMX 在随机端口号上创建可远程访问的连接器。

```
-Dcom.sun.management.jmxremote.authenticate="false" 
-Dcom.sun.management.jmxremote="true" 
-Dcom.sun.management.jmxremote.ssl="false" 
-Dcom.sun.management.jmxremote.port="0"
-Dcom.sun.management.jmxremote.local.only="false" 
```

最后两个属性是最重要的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T15:15:53.363

该[文档](http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html)似乎表明 JMX 代理使用本地临时端口，**除非**您指定以下属性：

```
com.sun.management.jmxremote.port=portNum 
```

避免使用默认端口，因为您可以在一个系统上拥有*许多*Java 应用程序，如果有默认端口，则只能管理一个应用程序！提供上述配置属性是为了*远程*管理的**明确目的**。

 *如果您必须坚持使用临时端口，那么 JMX 代理的 URL 应该可以通过以下系统属性从 JVM 内访问（尽管这很可能是本地地址）：

```
com.sun.management.jmxremote.localConnectorAddress 
```

**注意**：我猜你总是可以在远程可用地址上打开一个套接字，并在本地套接字上代理请求，但是使用可用选项似乎更有吸引力！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-10T01:54:38.463

所以，我的问题的简短回答是“不”。

但是，研究原因很有趣。查看`netstat`有效本地连接的输出。这是我看到的由于`jconsole`与自身建立本地连接而打开的端口。如您所见，端口 1650 是用于 JMX 信息的本地端口：

```
Proto  Local Address          Foreign Address        State
TCP    Gandalf:1650           Gandalf:1652           ESTABLISHED
TCP    Gandalf:1650           Gandalf:1653           ESTABLISHED
TCP    Gandalf:1650           Gandalf:1654           ESTABLISHED
TCP    Gandalf:1650           Gandalf:1655           ESTABLISHED
TCP    Gandalf:1650           Gandalf:1656           ESTABLISHED
TCP    Gandalf:1652           Gandalf:1650           ESTABLISHED
TCP    Gandalf:1653           Gandalf:1650           ESTABLISHED
TCP    Gandalf:1654           Gandalf:1650           ESTABLISHED
TCP    Gandalf:1655           Gandalf:1650           ESTABLISHED
TCP    Gandalf:1656           Gandalf:1650           ESTABLISHED 
```

但是，尝试连接`jconsole`到`localhost:1650`. 可悲的是，所有能让你受益的是“连接失败：表中没有这样的对象”消息。

所以，我最初的故事的结论是，如果我们要为我们的客户使用 JMX 进行远程监控，我们确实需要为我们系统中启动的各种 Java 进程识别唯一的单独远程访问端口。幸运的是，这一切都需要明智地使用 VM 参数：

```
com.sun.management.jmxremote.port=portNum 
```

我们几乎可以肯定会有一个顺序的预先指定的范围，`portNum`以便客户可以使用端口号选择正确的远程应用程序。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-07-23T18:21:05.913

我最近一直在研究如何从 java 代码启用远程 JMX 管理，而不需要使用特殊属性集启动 JVM。我确定的解决方案是启动我自己的私有 RMI 注册表——很简单——并在该注册表上公开 JMX 服务。我创建自己的 MBeanServer，然后创建一个新的 JMXConnectorServer。JMXConnectorServer 是通过类似的调用创建的

```
connector = JXMConnectorServerFactory.newJMXConnectorServer(url, null, server); 
```

其中 server 是 MBeanServer，url 是 JMXServiceURL 的一个实例。

url 的格式为“service:jmx:rmi:///jndi/rmi://localhost:/jmxrmi”，其中 port 是（本地）私有注册表的端口号。“jmxrmi”是 JMX 服务的标准服务名称。

设置好这个并启动连接器后，我发现我可以使用主机名：端口从 jconsole 连接到它。

这完全满足了我的需求；我很想知道是否有人认为这种方法存在缺陷。

参考：[JMX 教程，第一章。3](http://docs.oracle.com/javase/1.5.0/docs/guide/jmx/tutorial/connectors.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-03-20T22:48:32.917

如果您碰巧在 Glassfish 应用服务器中运行您的应用程序，只需运行以下 asadmin 命令，您需要重新启动所有正在运行的服务器才能使更改生效。

./asadmin 启用-安全-管理员

有额外的 Glassfish 服务器配置可以进一步提高安全性，请参阅[通过 JMX 远程连接到 Glassfish](https://blogs.oracle.com/prsad/entry/connecting_securely_to_glassfish_via)中的更多信息。

# jquery - 为什么 $('someObject').attr("id")[0] 在 IE 中不起作用？

> ID：516143
> 
> 赞同：0
> 
> 时间：2009-02-05T14:36:28.840
> 
> 标签：jquery

以下 jquery 代码在 firefox 中工作，但在 IE 中返回 undefined：

```
$('someObject').attr("id")[0] 
```

这是为什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T14:43:08.343

尝试

```
$('someObject').attr("id").charAt(0) 
```

Internet Explorer 中的字符串不支持 [] 索引器运算符。string::charAt() 是正确的使用方法。

# c# - 为什么我不能拥有受保护的接口成员？

> ID：516148
> 
> 赞同：81
> 
> 时间：2009-02-05T14:36:58.373
> 
> 标签：c#, interface, protected, access-modifiers

反对在接口上声明受保护的访问成员的论点是什么？例如，这是无效的：

```
public interface IOrange
{
    public OrangePeel Peel { get; }
    protected OrangePips Seeds { get; }
} 
```

在这个例子中，接口`IOrange`将保证实现者*至少*`OrangePips`向他们的继承者提供一个实例。如果实施者愿意，他们可以将范围扩大到 full `public`：

```
public class NavelOrange : IOrange
{
    public OrangePeel Peel { get { return new OrangePeel(); } }
    protected OrangePips Seeds { get { return null; } }
}

public class ValenciaOrange : IOrange
{
    public OrangePeel Peel { get { return new OrangePeel(); } }
    public OrangePips Seeds { get { return new OrangePips(6); } }
} 
```

接口成员的目的`protected`是为*继承者*（子类）提供支持契约，例如：

```
public class SpecialNavelOrange : NavelOrange
{
    ...
    // Having a seed value is useful to me.
    OrangePips seeds = this.Seeds; 
    ...
} 
```

（诚​​然，这对 s 不起作用`struct`）

我在接口中看不到`private`or`internal`修饰符的太多情况，但同时支持`public`and`protected`修饰符似乎是完全合理的。

* * *

我将尝试通过将成员与s 完全分开来解释`protected`成员在s 上的效用：`interface``interface`

让我们想象一个新的 C# 关键字 ,`support`来强制继承合同，因此我们声明如下：

```
public support IOrangeSupport
{
    OrangePips Seeds { get; }
} 
```

这将允许我们通过契约类为它们的继承者提供受保护的成员：

```
public class NavelOrange : IOrange, IOrangeSupport
{
    public OrangePeel Peel { get { return new OrangePeel(); } }
    protected OrangePips Seeds { get { return null; } }
} 
```

这并不是特别有用，因为类已经通过`protected`首先提供成员来暗示这种契约。

但是我们也可以这样做：

```
public interface IOrange : IOrangeSupport
{
   ...
} 
```

从而适用`IOrangeSupport`于所有实现`IOrange`并要求它们提供特定`protected`成员的类——这不是我们目前可以做的事情。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-02-05T15:13:07.083

我认为每个人都认为接口只有公共成员，没有实现细节。您正在寻找的是一个[抽象类](http://msdn.microsoft.com/en-us/library/ms173150.aspx)。

```
public interface IOrange
{
    OrangePeel Peel { get; }
}

public abstract class OrangeBase : IOrange
{
    protected OrangeBase() {}
    protected abstract OrangePips Seeds { get; }
    public abstract OrangePeel Peel { get; }
}

public class NavelOrange : OrangeBase
{
    public override OrangePeel Peel { get { return new OrangePeel(); } }
    protected override OrangePips Seeds { get { return null; } }
}

public class ValenciaOrange : OrangeBase
{
    public override OrangePeel Peel { get { return new OrangePeel(); } }
    protected override OrangePips Seeds { get { return new OrangePips(6); } }
} 
```

编辑：公平地说，如果我们有一个派生自类 Ornament 的 PlasticOrange，它只能实现 IOrange 而不能实现受 Seeds 保护的方法。没事儿。根据定义，接口是调用者和对象之间的契约，而不是类与其子类之间的契约。抽象类与我们接近这个概念一样接近。这很好。您实质上提出的是语言中的另一种构造，通过它我们可以将子类从一个基类切换到另一个基类，而不会破坏构建。对我来说，这没有意义。

如果要创建类的子类，则子类是基类的特化。它应该完全了解基类的任何受保护成员。但是，如果您突然想要切换基类，那么子类应该与任何其他 IOrange 一起使用是没有意义的。

我想你有一个公平的问题，但这似乎是一个极端的案例，老实说，我认为它没有任何好处。

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-02-05T14:43:16.597

不明白为什么要这个。如果您希望派生类提供特定方法的实现，请选择抽象基类。接口就是这样 - 接口。公共合同，没有别的。将接口视为规范，它描述了实现对外界的看法。两针插头的规范没有说明（至少我假设）它的内部结构应该是什么样的。它必须与插头插座接口兼容。 [（来源：][[中国制造网](http://www.made-in-china.com/image/2f0j00MCetlafAYTWcM/Two-Round-pin-Plug-with-Power-Wire.jpg)][）][![插头](https://i.stack.imgur.com/qcE4O.jpg)](https://i.stack.imgur.com/qcE4O.jpg)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-05T14:40:24.217

因为没有意义。接口是公开的合约。我是一个 IThing，因此如果被问到我会执行 IThing 方法。您不能要求 IThing 确认它执行它无法告诉您的方法。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-05T14:40:20.737

存在接口以允许人们在不知道具体实现是什么的情况下访问您的类。它完全脱离了数据传递合约的实现。

因此，接口中的所有内容都必须是公开的。非公共成员仅在您有权访问实现时才有用，因此不会对接口定义做出有意义的贡献。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-05T14:40:08.507

接口成员*是*一个公共 API；诸如此类的东西`protected`是实现细节 - 接口没有*任何*实现。我怀疑您正在寻找的是显式接口实现：

```
public class NavelOrange : IOrange
{
    public OrangePeel Peel { get { return new OrangePeel(); } }
    OrangePips IOrange.Seeds { get { return null; } }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2021-04-11T14:27:26.153

**从 C# 8.0（2019 年 9 月）开始，您可以在接口内使用访问修饰符**

检查接口 c# 8.0 中的这些更改

[在 C# 8.0 中使用默认接口方法更新接口](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/tutorials/default-interface-methods-versions)

看到这些帖子

[C# 8 接口：公共、私有和受保护的成员](https://jeremybytes.blogspot.com/2019/11/c-8-interfaces-public-private-and.html)

[深入了解 C# 8 接口](https://jeremybytes.blogspot.com/2019/09/a-closer-look-at-c-8-interfaces.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-11-01T16:25:00.530

界面就像钥匙**的形状**。

[![在此处输入图像描述](https://i.stack.imgur.com/wMbB6.jpg)](https://i.stack.imgur.com/wMbB6.jpg)

这不是关键。

这不是锁。

**这只是纤细的接触点。**

出于这个原因，接口的所有成员（定义密钥的形状）都必须是公共的。

对于打开锁的钥匙来说，重要的是它们都具有相同的形状。

通过**公开**形状（界面） ，您可以让其他人创建兼容的锁或兼容的钥匙。

否则，将其（接口）设置为**内部**您将不允许其他人创建兼容的锁或兼容的钥匙。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-05T14:48:34.713

接口是向客户端承诺某些功能的合约。换句话说，接口的目的是能够将类型转换为它，并像这样将其传递给需要该接口保证的功能的代码。由于某种类型的客户端代码无法访问该类型的受保护成员，因此在接口中声明受保护项是没有意义的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-10-12T23:24:28.647

与抽象基类相比，受保护的接口将允许（抽象类的）“多重继承”，我会发现它有用一两次......

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-09-11T11:10:37.160

仅作记录：从 C# 8.0 开始，接口现在可以包含

*   受保护的成员
*   私人会员
*   执行

作为底线，它引入了一些以前仅在支持多重继承的语言中可用的功能，例如多个基本成员的共享实现。

[https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/tutorials/default-interface-methods-versions](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/tutorials/default-interface-methods-versions) [https://jeremybytes.blogspot.com/2019/11/c-8-interfaces -public-private-and.html](https://jeremybytes.blogspot.com/2019/11/c-8-interfaces-public-private-and.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-05T14:39:52.890

接口是关于某个对象可以做什么的，所以当使用实现该接口的类时，开发人员会期望所有成员都被实现，因此受保护的访问修饰符对接口没有任何意义。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-05T14:40:16.367

一个接口只包含公共成员。受保护意味着您声明的任何内容仅对类和派生类实例可用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-05T14:45:49.587

当前的接口设计有一个合理的判断，即它为实现者提供了更大的灵活性。请记住，接口通常是由框架程序员编写的，而实现者是不同的人。强制执行将是不必要的苛刻。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-05T14:49:49.733

通过实现一个接口，该类型声明它支持一组特定的方法。如果这些方法中的任何一个不是公共的，则调用者将无法使用它，因此该类型将不支持所述接口。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-06-12T19:03:38.157

任何实现 .net 接口的类都必须包含所有接口成员的实现。此外，任何类都可以向派生类公开它希望的任何成员。要求接口的实现必须包含一个只能从派生类中使用的成员将没有任何用处，除非（1）这样的成员对接口外部的东西可见，或者（2）接口实现可以使用他们自己没有定义的成员。如果允许接口包含嵌套类（可以访问接口的`protected`成员），那么`protected`接口成员是有意义的。实际上，如果嵌套在接口中的类可以为该接口定义扩展方法，它们可能非常有用。不幸的是，不存在这样的设施。

顺便说一句，即使不能在接口中嵌套类，将`internal`访问修饰符应用于接口成员仍然很有用，其效果是只有定义接口的程序集才能为其定义任何实现。

# jquery - 如何使用 jQuery 选择关注它的元素

> ID：516152
> 
> 赞同：64
> 
> 时间：2009-02-05T14:37:27.340
> 
> 标签：jquery, focus, css-selectors

如何选择具有当前焦点的元素？

jQuery中没有`:focus`过滤器，这就是为什么我们可以使用这样的东西：

```
$('input:focus').someFunction(); 
```

* * *

## 回答 #1

> 赞同：153
> 
> 时间：2012-03-26T15:29:47.130

`$(document.activeElement)`将返回当前聚焦的元素，并且比使用伪选择器:focus 更快。

来源：[http ://api.jquery.com/focus-selector/](http://api.jquery.com/focus-selector/)

* * *

## 回答 #2

> 赞同：123
> 
> 时间：2010-01-14T02:28:49.340

```
alert($("*:focus").attr("id")); 
```

我使用 jQuery。

它将提醒元素的 id 正在聚焦。

我希望它对你有用。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-02-05T14:40:49.097

最好的方法是为 onFocus 事件设置一个处理程序，然后将一个变量设置为具有焦点的元素的 ID。

像这样的东西：

```
var id;

$(":input").focus(function () {
     id = this.id;
}); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-05T18:41:58.893

你有没有尝试过

```
$.extend($.expr[':'], {
    focused: function(elem) { return elem.hasFocus; }
});

alert($('input :focused').length); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-11-24T18:03:58.490

如果你使用 JQuery，你可以写一个[这样的选择器](http://forum.jquery.com/topic/focus-selector-filter)：

```
$.expr[':'].focus = function(a){ return (a == document.activeElement); } 
```

然后，您可以选择当前聚焦的元素：`$(":focus")`

不仅表单控件可以有焦点。任何带有 tabindex 的 html 元素都可以在现代浏览器中聚焦。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-11-14T17:22:06.150

从当前 jQuery 版本 (1.7) 文档的示例中提取：

```
$(elem).is(":focus"); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-05-09T09:51:36.850

检查元素是否有焦点。

```
if ($("...").is(":focus")) {
  ...
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-08-22T11:49:09.527

这是它的 CoffeeScript 版本。基于 jmanrubia 的代码：

`$.expr[':'].focus = (a) -> a is document.activeElement`

你也可以这样称呼它`$(".:focus")`

# language-agnostic - 尽早规划效率与过早优化

> ID：516160
> 
> 赞同：12
> 
> 时间：2009-02-05T14:38:54.123
> 
> 标签：language-agnostic, optimization

我似乎注意到在优化方面出现了两种思想流派：

1.  **过早的优化是万恶之源**。只有在编写了最易读和最简单的东西时，您才应该进行优化。如果在分析之后您确定软件太慢，您应该优化。
2.  **优化应该在项目生命周期的早期完成**。优化需要计划，但应该合理地完成。

从表面上看，他们似乎是相当反对的观点。问题是，我看到了两种思想流派的优点。我还可以想到这两种思维方式帮助我编写更好更快的软件的时候。

有没有办法调和这两个想法？有中间立场吗？有没有一个想法是完成这项工作的最佳工具的时候？还是我提出了一种错误的二分法，两种观点可以和平共存？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-05T14:47:34.480

尽早在设计和架构级别进行优化。稍后在实现级别进行微优化。

您需要了解您所做的设计决策的性能成本，这在以后很难改变。实现通常可以在以后进行调整，这就是为什么在您知道这是一个问题之前不值得这样做的原因。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-05T14:43:50.400

我通常做的是应用那些不会花费我任何东西（或几乎没有）的优化。我也一直在寻找那些不能很好地扩展并且经常被调用的算法。除此之外，在软件运行并且我有机会启动分析器之前，我不会进行优化。只有这样，我才会投入大量时间进行优化。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T14:55:46.290

专注于编写完全按照它应该做的事情的代码，并且只写所需的次数。优化干净、优雅的代码通常很简单。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-05T15:04:27.910

理想的做法是先进行概要分析，然后在必要时进行优化，但这不适用于设计；当你有任何可执行的配置文件时，更改设计将非常昂贵。因此，设计必须预先注意效率。通常这意味着预先勾勒出高效的算法，并保持足够的灵活性以供以后更改。（这通常最好通过良好的功能分离来完成，尽可能保持模块独立，出于其他原因，这是一种很好的设计实践。）

通常，在设计阶段，您会很好地了解性能的重要性。如果需要，您可以从一开始就针对性能进行设计（不包括代码级优化）。

在两种其他相似的做法之间进行选择时，还需要养成有效的编码习惯。例如，在 C++ 中，键入`++i`而不是值得`i++`，因为它是一件微不足道的事情，有时可以显着提高效率。

除此之外的任何事情都应该等到（a）很明显提高性能会得到回报，并且（b）你知道热点在哪里。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-05T15:35:34.480

改编这句话“赢了就是战术，输了就是作弊”，我想说

> 如果它有效，它就是“效率规划”，如果它没有，它就是“过早的优化”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-05T14:59:16.830

我喜欢[这家伙](http://smallwig.blogspot.com/2008/04/smallwig-theory-of-optimization.html)的表述。

> 1.  通过使用更明智的整体方法进行优化。
> 2.  通过使代码不那么奇怪来进行优化。
> 3.  通过使代码更怪异的优化。

前两个是你的第 2 点。他的第 3 点是你的第 1 点，而他的第 3 点是万恶之源。他是对的，使代码“更怪异”的优化会使其更复杂、更难理解，从而导致更多的错误和维护问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-05T15:29:48.267

我还会：**从一开始就使用适当且高效的数据结构**。这确实涵盖了广泛的内容：

1.  了解所有标准容器是如何工作的，它们擅长什么，不擅长什么。例如。SortedDictionary 在插入和搜索方面很快，但在删除方面很差。LinkedList 可以快速添加和删除，但在搜索等方面很差。
2.  知道你的瓶颈在哪里。会不会是cpu、磁盘、内存、显卡、IO、网络等等。知道如何有效利用每一个，每个领域都需要不同的设计模式。这实际上也取决于正在开发的应用程序 - 对于 UI 响应性、数据处理良好的磁盘缓存，需要关注的核心指标是什么。
3.  多线程。如果应用程序将扩展到多个内核，则需要在开发生命周期的早期就决定是否需要这样的系统。在稍后阶段用螺栓拧上螺纹的成本要高得多。

有些答案你会从经验中知道，有些需要研究，但它永远不会是猜测工作。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-05T16:23:22.243

第一次就尽可能地构建它，而无需花费大量时间或精力。然后让它为你的注意力而战。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-05T14:42:20.857

我会说中间立场是在编写代码时牢记已知的低效率，但如果这意味着初始开发需要额外时间或增加复杂性，则不要尽早优化。

我的理论是，“编写简单的工作代码，然后根据测试需要进行优化。”

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-05T14:51:25.223

它应该纯粹是投资回报分析。如果您可以在设计优化方面付出一点努力并获得巨大的性能回报，那就去做吧。渐渐地，你会到达付出努力的回报不再有意义的地步。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-05T15:00:49.400

有一个基本事实：

> 您无法优化无法测试的内容

因此，正如其他人所说，尤其是在性能优化方面，您必须编写代码才能对其进行测试。此外，在大量代码中，一种算法通常可能是最快的一种，但考虑到它与其他代码的相互关系，它要么是浪费时间的无用优化，要么比选项 2、3 慢。 ..

但是，您可以利用大量知识，尤其是在概念层面，可以帮助您在全球范围内“预先优化”您的设计。

不幸的是，这是没有真正结束的辩论之一。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-05T15:34:17.040

尤其是数据库不容易重构，并且通常是系统中最大的瓶颈，因为设计人员认为他们在设计时不应该关心性能。这是短视的。有许多已知的数据库优化几乎总是会更快。在您的设计和初始编码中不使用它们以避免“过早优化”是愚蠢的。例如，游标几乎永远不会（除非您正在寻找运行总计）比 SQl Server 中的基于集合的查询执行得更好。编写游标而不是基于集合的查询并不会更快（一旦您了解了基于集合的查询），因此没有理由从基于游标的代码开始。与派生表副子查询相同。

选择使用使以后难以进行性能调整的工具也是一个短视的决定，因此在考虑您打算如何访问数据库时，这应该是您考虑的一部分。

任何针对数据库编写代码或设计数据库的人都应该花时间阅读针对特定类型数据库的性能调整。提前知道如何编写一个可搜索的查询，什么样的东西应该有你开始使用的索引，以及常见的瓶颈是什么，这将帮助你在第一次做得更好。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-05T15:39:11.647

这就是计划发挥作用的地方。如果你有一个很好的计划并且对你正在写的东西有一个很好的模型，那么优化应该只需要在后期进行。如果您发现自己需要优化很多代码，那么您很可能一开始就做错了事。

其中很多也将伴随着经验和从事类似任务的工作。通常，您唯一需要编写需要优化的东西是在您覆盖以前从未使用过的东西时。优化发生在规划阶段和项目后期阶段 IMO。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-05T16:49:49.117

该代码除了提供基本功能外，还具有软件开发人员需要提供的另外三个功能：

1.  表现
2.  可维护性
3.  鲁棒性

空闲代码将提供所有这三个。在资源有限的情况下，应该针对需要评估的内容优化对哪部分代码的调用。以牺牲其他为代价优化其中之一是危险的，应尽可能避免。

# fullscreen - DirectX 10 视频模式切换和性能

> ID：516162
> 
> 赞同：4
> 
> 时间：2009-02-05T14:39:42.687
> 
> 标签：fullscreen, directx-10, windowed

在 DirectX 10 应用程序中，在全屏模式和窗口模式之间切换是否会产生任何类型的开销，例如必须重新创建纹理和/或顶点缓冲区？

换句话说，我是否可以构建一个应用程序，该应用程序旨在在窗口模式和全屏模式之间进行“大量”切换，而不必在切换发生时对性能造成影响？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T20:42:16.870

在 DirectX10 中有 DXGI。您使用交换链。交换链的缓冲区需要调整大小，所以会有一些开销（当然），但它应该是优化的。我担心的是通过切换视图模式导致用户癫痫发作。

[http://msdn.microsoft.com/en-us/library/bb205075(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb205075(VS.85).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-16T05:34:10.660

在 D3D10 中，您无需在模式切换时重新创建纹理、缓冲区或任何 D3D 资源。一个值得注意的例外是在 ResizeBuffers 调用之后需要更新交换链后缓冲引用（应该这样做以获得最佳的全屏性能），但就性能而言，这并不是什么大问题。

不过，这并不意味着改变模式很便宜。模式更改操作本身对于您的应用程序和系统的其余部分来说都是非常昂贵的（特别是在 Vista 中，需要重新启动 DWM）。Win7改进了很多，所以我建议你玩一下，看看它是否满足你的性能要求，但不要指望立即过渡。

# c# - 如何从 HttpWebResponse 获取详细信息

> ID：516174
> 
> 赞同：1
> 
> 时间：2009-02-05T14:41:29.657
> 
> 标签：c#, httpwebrequest, httpwebresponse

我正在发布 httpwebrequst，但在 HttpWebResponse 中我收到错误代码 403 禁止。现在这个错误对我来说不是很充分。

然后我尝试了一个测试程序（我没有 :() 的源代码并用它来发布相同的帖子，它返回了一个禁止的代码 403 但还告诉我需要 SSL。所以有可能得到更多“服务器端”详细信息来自失败的 httpwebrequest，只是错误代码？

谢谢你

* * *

只是为了澄清事情。我得到 403 很好，我只是想知道为什么当我在 webexception 中看到类似的东西时，测试程序可以告诉 SSL 需要 SSL

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T14:50:05.897

如果由于协议错误而引发 WebException，则其 Response 属性将包含从 Web 服务器接收到的实际响应。

```
try 
{
    // Do WebRequest
}
catch (WebException ex) 
{
    if (ex.Status == WebExceptionStatus.ProtocolError) 
    {
        HttpWebResponse response = ex.Response as HttpWebResponse;
        if (response != null)
        {
            // Process response
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T14:50:38.920

没有明确的方式来询问更详细的信息，不——基本上，你得到了你得到的。

也就是说，Web 服务器通常会返回文档以及有时包含有用信息的错误代码，就像您得到的解释 SSL 证书问题的错误代码一样。如需帮助找出此类问题，请查看[Fiddler——](http://www.fiddlertool.com/fiddler/)它会向您展示有关服务器响应的所有信息。

至于你的具体错误，很难说；403 可以表示一些不同的事情。但是，如果您收到一个表明与 SSL 相关的响应，您可能只是在处理一个错误或过期的证书（[请参阅这个问题](https://stackoverflow.com/questions/244019/httpwebrequest-over-ssl)），或者服务器可能需要安全连接但没有得到一个。您是否尝试过直接使用 Web 浏览器访问 URL，只是为了查看您是否收到提示证书问题的警告，或者除了未经调解的 403 响应之外的任何内容？

# .net - 如何保持动态填充的数据集与程序保持一致？

> ID：516188
> 
> 赞同：2
> 
> 时间：2009-02-05T14:45:30.837
> 
> 标签：.net, winforms

我有一个 winform 应用程序，它使用一些引用的 Web 服务来获取数据。返回的数据是我循环并添加到数据集的对象数组。

当我调用该服务时，通常需要 2 或 3 分钟才能获取所有数据。

如果用户退出程序并稍后回来，我不希望他们不得不再次重新下载所有数据。

当我在调试模式下运行应用程序时，下载的信息没有持久性；这让我很担心。

我仍处于“开发模式”，所以我还没有真正组装一个安装程序来测试信息是否保留在应用程序中。

我对几件事感到好奇：

1.  用户退出后，数据集中存储的数据是否保留？
2.  如果没有，您会建议如何完成此操作？
3.  我考虑过使用 XML 进行存储；当您拥有 9-10 MB 数据时，这是最佳选择吗？

    * * *

    编辑：最终结果：好的 - 这是最终结果（感谢大家的快速回复）

当应用程序退出时，我调用一个函数来保存数据。这是一个片段：

```
 using System.IO;
   using System.Runtime.Serialization;
   using System.Runtime.Serialization.Formatters.Binary;            
   FileStream fs;
   IFormatter formatter = new BinaryFormatter();
    //activities
    if (actList.Length > 0)
    {
        fs = new FileStream("activities.bin", FileMode.Create, FileAccess.Write, FileShare.None);
        formatter.Serialize(fs, actList);
        fs.Close();
    }
    //users
    if (userList.Length > 0)
    {
        fs = new FileStream("users.bin", FileMode.Create, FileAccess.Write, FileShare.None);
        formatter.Serialize(fs, userList);
        fs.Close();
    } 
```

userList 和 actList 参数是来自 Web 服务调用的 List 对象。

我实现的另一件事（稍微偏离主题）是创建一个应用程序设置以保存用户上次从 Web 服务下载的时间。它被保存为

```
Properties.Settings.Default.last_downloaded 
```

如果用户单击下载按钮，则会提示他们上次执行下载的日期，并有机会说“不”。

再次感谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T14:51:07.487

.NET 对象没有持久性，除非您自己编写它 - 例如通过序列化到用户配置文件中的文件（或ClickOnce 的[隔离存储](https://stackoverflow.com/questions/202013/clickonce-and-isolatedstorage)）。

注意：就个人而言，我根本不会`DataSet`在这种情况下使用；如果您将数据作为对象列表下载，那么就保持它们那样 -`List<T>`等等。

Re xml：9-10Mb 很大但不是很大。这实际上取决于数据的性质和其他要求；除非您已经在使用 Web 压缩（GZIP 等），否则您可能会发现使用更紧凑的格式（如 csv）或二进制格式（如[协议缓冲区](http://code.google.com/p/protobuf-net/)）传输数据更快。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T14:53:47.900

You need to manually persist any data that you want to save. What you can do is take your Dataset, and, when your application is closing, [serialize](http://msdn.microsoft.com/en-us/library/7ay27kt9(VS.71).aspx) the dataset to a file. Then when the app opens, if the file exists, deserialize the dataset from that file instead of calling the webservice.

# c# - C# Treeview 状态展开

> ID：516192
> 
> 赞同：0
> 
> 时间：2009-02-05T14:46:33.673
> 
> 标签：c#, asp.net, treeview

我的母版页中有一个树视图。加载内容页面时，我想保存树视图状态（哪些节点折叠/展开）。我将节点存储在 ArrayList 中。代码：

```
private void SaveTreeviewState(TreeNodeCollection nodes)
{
    foreach (TreeNode t in nodes)
    {
        // Store expandable state in ArrayList (true or false)
        //NodePaths.Add(t.Expanded);
        NodePaths.Add(t);

        // Check for childnods
        if (t.ChildNodes.Count > 0)
            // recall this method
            SaveTreeviewState(t.ChildNodes);

    }
} 
```

该方法由 treeview 对象的 unload 事件调用：

```
protected void tvManual_Unload(object sender, EventArgs e)
{
    SaveTreeviewState(tvManual.Nodes);

    // Clear session
    Session["Treeview"] = null;

    // Add arraylistm to session
    Session["Treeview"] = NodePaths;

} 
```

在母版页的加载事件中，我检查是否设置了我的会话。设置会话后，我调用读取会话的方法。

会话中的 arraylist 包含我所有的节点，所以这是正确的。但是，所有节点都将属性 expended 设置为 false。这是不正确的，因为我扩展了多个节点。

希望你们能理解我的问题并能帮助我。

先进的Thnx

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T14:55:36.273

因为保存的列表实际上是一个对象列表（TreeNode 对象），所以您实际上是在存储对对象的引用。我猜在 tvManual_Unload 上，展开状态正在改变或类似的东西。可能您正在使用进程内会话，这类似于对对象的引用（没有序列化），因此对对象属性的任何更改对存储在会话中的对象也是可见的。

您可以通过将值存储到会话中来避免这种副作用。例如，存储一个 Dictionary<string, bool>，其中键将包含节点路径，值将包含展开状态。

# java - Eclipse 中的 JBoss 调试

> ID：516196
> 
> 赞同：66
> 
> 时间：2009-02-05T14:47:41.440
> 
> 标签：java, eclipse, debugging, jboss

如何配置 JBoss 以在 Eclipse 中调试应用程序？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-02-05T14:51:57.170

您的意思是从 Eclipse[远程调试 JBoss吗？](http://jmdesp.free.fr/billeterie/?p=95)

从[配置 Eclipse 进行远程调试](http://www.onjava.com/pub/a/onjava/2005/08/31/eclipse-jboss-remote-debug.html?page=6)：

> 如下设置 JAVA_OPTS 变量：

```
set JAVA_OPTS= -Xdebug -Xnoagent 
   -Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=n %JAVA_OPTS% 
```

> 或者：

```
JAVA_OPTS="-Xdebug -Xnoagent 
  -Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=n $JAVA_OPTS" 
```

在 Debug 框架中，选择 Remote Java Application 节点。

在 Connection Properties 中，指定`localhost`为 Host，并将 Port 指定为在 JBoss 服务器的运行批处理脚本中指定的端口，`8787`.

![JBoss 调试](https://i.stack.imgur.com/L7JBX.png)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-05T15:00:51.227

如果您使用 Eclipse WebTools 设置 JBoss 服务器，您可以简单地以调试模式启动服务器（服务器视图中的调试按钮）。这将允许您在 JBoss 内运行的应用程序中设置断点。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-07-08T16:43:02.690

VonC 在他的回答中提到了如何从 Eclipse 远程调试。

我想补充一点，`JAVA_OPTS`设置已经在`run.conf.bat`. 您只需要取消注释它们：

在`JBOSS_HOME\bin\run.conf.bat`Windows 上：

```
rem # Sample JPDA settings for remote socket debugging
set "JAVA_OPTS=%JAVA_OPTS% -Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=n" 
```

Linux 版本类似，位于`JBOSS_HOME/bin/run.conf`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-12-03T08:51:48.093

在这里，如果你想直接调试服务器，那么你可以使用：

1.)**窗户**->

2.)**显示视图**-> 服务器：右键单击服务器，然后在调试模式下运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-12-04T11:56:12.660

您需要在 Eclipse 调试配置中定义一个远程 Java 应用程序：

打开调试配置（选择项目，然后从菜单运行/调试配置中打开） 在左侧树中选择远程 Java 应用程序，然后按“新建”按钮 在右侧面板上选择您的 Web 应用程序项目并在端口字段中输入 8787。这是此过程的详细说明的链接。

当您启动远程调试配置时，Eclipse 将附加到 JBoss 进程。如果成功，调试视图将显示 JBoss 线程。工具栏/菜单中还有一个断开图标可停止远程调试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-01-20T10:51:10.117

@VonC 说的是正确的，但是您可以将设置调试的命令直接放入Launch 的`VM`参数中。`jBoss`

为此，请`jBoss`在内部打开服务器`Eclipse`，转到打开启动配置并将其放入`VM`参数中`textbox`： [vm args](https://i.stack.imgur.com/lHJQC.jpg)

# c++ - 相对路径在 Xcode C++ 中不起作用

> ID：516200
> 
> 赞同：33
> 
> 时间：2009-02-05T14:48:20.860
> 
> 标签：c++, xcode, macos, path

网上有很多帖子详细说明了相对路径如何在 Xcode 中不起作用。我确实有一个 Xcode 模板，我下载了相对路径可以工作的地方，但是我无法弄清楚为什么也无法在其他项目中复制它。

首先，我在 Xcode 3.1 中使用 C++。我没有使用 Objective-C，也没有使用任何 Cocoa/Carbon 框架，只是纯 C++。

这是在我的其他 Xcode 模板中工作的代码：

```
sound->LoadMusic( (std::string) "Resources/Audio/Pop.wav" ); 
```

这个相对路径在 Windows 中也适用于我。运行以下命令为我提供了应用程序完整路径的绝对路径：

```
std::cout << "Current directory is: " << getcwd( buffer, 1000) << "\n"; 
```

/应用程序/myApp

我们如何获得在 Xcode .app 包中工作的相对路径？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-02-06T16:19:06.653

我花了大约 5 个小时的 Google 并尝试了不同的方法，终于找到了答案！

```
#ifdef __APPLE__
#include "CoreFoundation/CoreFoundation.h"
#endif

// ----------------------------------------------------------------------------
// This makes relative paths work in C++ in Xcode by changing directory to the Resources folder inside the .app bundle
#ifdef __APPLE__    
    CFBundleRef mainBundle = CFBundleGetMainBundle();
    CFURLRef resourcesURL = CFBundleCopyResourcesDirectoryURL(mainBundle);
    char path[PATH_MAX];
    if (!CFURLGetFileSystemRepresentation(resourcesURL, TRUE, (UInt8 *)path, PATH_MAX))
    {
        // error!
    }
    CFRelease(resourcesURL);

    chdir(path);
    std::cout << "Current Path: " << path << std::endl;
#endif
// ---------------------------------------------------------------------------- 
```

我抛出了一些额外的包含守卫，因为这使得它只编译 Apple（我开发跨平台）并使代码更好。

我感谢其他 2 个人的回答，您的帮助最终使我走上了正确的轨道，找到了这个答案，所以我投了你们俩的票。多谢你们！！！！

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-06T05:01:31.717

不要依赖二进制代码中的当前工作目录。只是不要。在 Mac、Windows 或 Unix 上，您不能相信操作系统或 shell 会将其设置为您期望的位置。

对于直接 C，使用 dyld.h 中的 _NSGetExecutablePath 来获取当前可执行文件的路径，然后你可以从那里去相对。

如果您只是在试验并希望它工作，请在 Xcode 中选择 Project > Edit Active Executable，那里有一个面板，您可以在其中将初始工作目录设置为项目目录、可执行文件的父目录或任何任意目录。这应该只用于测试目的。在 Mac OS 中，当您编写一个真正的应用程序并从 Finder 启动它时，工作目录是 /。对于 Unix 应用程序，您无法控制工作目录是什么。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T05:07:29.300

我的猜测是您正在构建的应用程序类型是一次性可执行文件，而不是可执行的应用程序包。一般来说，在 OS X 和 Unix 上，资源是从驱动器的绝对根目录加载的，这与 Visual C++ 将“根”作为相对于项目根目录的路径的处理方式不同。不要依赖与任何特别是跨操作系统（或就此而言的操作系统版本）的任何东西相关的路径。您可以在 Xcode 中设置工作目录，但这只会影响从 Xcode 启动的应用程序。如果您要从 Finder 的构建目录中执行它，它会再次设置为驱动器的根目录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-14T11:56:37.957

只是关于相对路径和 xcode 的评论。

我最近注意到，如果您的应用程序没有将被复制到资源文件夹中的文件，则当前工作目录设置为实际 .app 的目录 - 例如在以下级别：myApp.app

但是，如果您将文件添加到项目中并将其复制到应用程序包的 Resources 文件夹中，它会将 cwd 设置为 .app 内部的 3 层。例如在 myApp.app/Contents/MacOS/myApp 级别

似乎 xcode 正试图为您提供智能，并假设您的应用程序包中没有资源，那么您将希望加载 .app 级别的文件，而不是内部可执行文件级别。

即使从 Finder 启动应用程序，这种情况仍然存在。所以也许是避免相对路径的另一个原因。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2021-04-06T13:48:53.033

如果您像我一样使用 SDL，则`SDL_GetBasePath()`返回 OSX 上的资源目录。

这是一个简单的包装函数：

```
std::string GetLoadFilename( const std::string& filename ) {
    std::string path;
    auto* base_path = SDL_GetBasePath();
    if( base_path == nullptr )
        return "./"+filename;
    path = std::string(base_path);
    path += filename;
    SDL_free(base_path);
    return path;
} 
```

可以像`sound->LoadMusic(GetLoadFilename("Audio/Pop.wav"));`使用 OP 的问题一样调用它。

# c# - c# windows服务导致整个机器无限期挂起/崩溃

> ID：516201
> 
> 赞同：1
> 
> 时间：2009-02-05T14:48:30.267
> 
> 标签：c#, windows-services, windows-server-2003, remoting

我有一个 C# 2.0 Windows 服务（100% 托管代码），*有时* 当它启动/重新启动时，它会导致整个机器（Windows Server 2003）无限期挂起。当我单击“启动服务”时，服务控制进度条显示一半，然后机器在本地终端和远程桌面会话中完全没有响应。唯一的解决办法是重启机器。

系统事件日志中没有任何内容。

该服务是一个远程处理服务器，它在启动时通过 TCP 对其他远程处理服务器（也是 Windows 服务）进行远程调用。

起初我认为这可能是网卡问题，所以我们更换了机器（更好的规格，不同的网卡），但我在大约十分之一的重启中仍然遇到同样的问题......。所以 90% 的时间是完全没问题的。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T14:50:19.017

将日志记录代码添加到服务的 onStart 例程。您应该能够找出哪些函数调用正在占用您的 CPU，并从那里开始工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T14:51:37.250

这是您代码中的错误！也许发布一个精简版。

正如@GWLlosa 所建议的，添加丰富的日志记录。

# silverlight - 如何使用 Silverlight 监视 ItemsControl 中的更改？

> ID：516203
> 
> 赞同：0
> 
> 时间：2009-02-05T14:49:26.630
> 
> 标签：silverlight, itemscontrol

我有一个绑定到 ObservableCollection 的 ItemsControl。当可观察集合发生变化时，我有一个事件处理程序来查看 ItemsControl 的子项。不幸的是，当时 ItemsControl 还没有添加新项目（这是可以理解的）。我如何知道 ItemsControl 何时完成添加新的子控件？

换句话说，如果我使用 ItemsControl 来显示文本框列表，当新的 TextBox 控件添加到显示中时如何通知我？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T15:30:32.710

好吧，我最终深入控件以找到 ContentPresenter。然后我附加到 LayoutUpdated 事件，该事件对孩子进行计数以查看它是否发生了变化。

这是一种奇怪的解决方案，但它确实有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T23:53:57.920

如果将 ObservableCollection 绑定到 ItemsControl，它恰好是 silverlight WCF 客户端生成的集合类型，那么您可以侦听 ObservableCollection 引发的事件。

这实际上是 Silverlight 知道是否重新渲染的方式。您可以独立于 UI 对集合进行操作，并且 UI 行为正常。

# postgresql - PostgreSQL 恢复和备份解决方案

> ID：516206
> 
> 赞同：10
> 
> 时间：2009-02-05T14:50:03.400
> 
> 标签：postgresql, backup, restore

A) 定期备份大型 PostgreSQL 数据库的最佳解决方案是什么（在最新的 Ubuntu 服务器上运行 8.3 版）；请不要用那些令人痛苦的缓慢插入语句说 pg_dump

B）在现实世界中工作的 PostgreSQL 数据库复制的最佳解决方案是什么

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T15:14:58.933

我认为只有一个答案。

PITR，或时间点恢复。它基本上是事务日志的归档，据我所知，这是进行备份的最佳方式。

我已经为 8.1 设置了几次，但在 8.3 中应该是一样的。

在 postgresql.conf 中，您需要做的就是添加以下内容：

```
archive_command = 'test ! -f /path/to/your/backups/archive_logs/%f && cp -i %p /path/to/your/backups/archive_logs/%f </dev/null' 
```

此命令将存档日志复制到指定目录，您可以在其中使用您选择的备份软件安全地备份它。

要进行完整备份，您需要首先告诉 PostgreSQL 您正在进行备份。它是通过 psql 命令`psql "SELECT pg_start_backup('my_backup');"` 完成的，之后只需使用 rsync、cpio 或其他工具复制数据目录即可。如果数据库被大量使用，文件将在复制过程中发生变化，因此该工具能够正确处理而不是退出是很重要的。

复制完成后，只需运行`psql "SELECT pg_stop_backup();"`告诉 PostgreSQL 再次停止它。这些命令所做的是在备份开始的存档日志中放置一个标记，因此在还原时，它知道需要从哪里开始读取。

这种技术也可以用于复制的热备份，但它不可读，只是准备在紧急情况下接管。我认为 8.4 版计划完全热备份，所以在此之前我认为没有其他选择。

如果您使用 PITR，一件很棒的事情是，您可以指定一个时间戳，以便您希望附加存档日志的时间。所以它也可以从事故中拯救数据库（比如删除或更改一些数据）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T15:09:39.773

A. pg_dump 默认不使用插入语句。默认情况下，它将使用 COPY 命令。-d 或 --inserts 的命令行开关将导致 pg_dump 将插入语句放入导出中。如果您的 pg_dump 命令中有这些开关中的任何一个，只需删除它们以使 pg_dump 使用 COPY。

B. 在即将发布的 Postgres 版本中，他们将进行开箱即用的[简单复制。](http://www.postgresonline.com/journal/index.php?/archives/56-PostgreSQL-8.4-goodies-in-store.html)我认为 8.4 版本很快就会发布。因此，如果可能的话，这可能值得等待。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T15:01:15.513

您可以结合每晚/每天/每周/每月 pg_dumps使用[在线 WAL-Backup 。](http://www.postgresql.org/docs/8.3/static/continuous-archiving.html)每周/每月一次，您应该复制整个集群。

恢复效果非常好，并且在您提前复制时几乎不会丢失数据（rsync 是最好的，因为它非常有效）。

速度很好，因为它只需要应用比你最新的完整集群备份/复制晚的 WAL。

# wpf - 如何使 Binding 尊重 DependencyProperty 值强制？

> ID：516210
> 
> 赞同：11
> 
> 时间：2009-02-05T14:51:06.877
> 
> 标签：wpf, binding, dependency-properties, coercion

我有一个带有 CoerceValueCallback 的 DependencyProperty 控件。此属性绑定到模型对象上的属性。

当将控件属性设置为导致强制的值时，绑定会将未强制的**值**推送到模型对象。控件上的属性值被正确强制。

如何让绑定将**强制**值推送到模型对象？

```
void Initialize()
{
    UIObject ui = new UIObject();
    ModelObject m = new ModelObject();
    m.P = 4;

    Binding b = new Binding("P");
    b.Source = m;
    b.Mode = BindingMode.TwoWay;
    Debug.WriteLine("SetBinding");
    // setting the binding will push the model value to the UI
    ui.SetBinding(UIObject.PProperty, b);

    // Setting the UI value will result in coercion but only in the UI.
    // The value pushed to the model through the binding is not coerced.
    Debug.WriteLine("Set to -4");
    ui.P = -4;

    Debug.Assert(ui.P == 0);
    // The binding is TwoWay, the DP value is coerced to 0.
    Debug.Assert(m.P == 0); // Not true. This will be -4\. Why???
}

class UIObject : FrameworkElement
{
    public static readonly DependencyProperty PProperty =
        DependencyProperty.Register("P", typeof(int), typeof(UIObject), 
        new FrameworkPropertyMetadata(
            new PropertyChangedCallback(OnPChanged), 
            new CoerceValueCallback(CoerceP)));

    public int P
    {
        get { return (int)GetValue(PProperty); }
        set { SetValue(PProperty, value); }
    }

    private static void OnPChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        Debug.WriteLine(typeof(UIObject) + ".P changed from " + e.OldValue + " to " + e.NewValue);
    }

    private static object CoerceP(DependencyObject sender, object value)
    {
        int p = (int)value;
        if (p < 0)
        {
            Debug.WriteLine(typeof(UIObject) + ".P coerced from " + p + " to 0");
            p = 0;
        }
        return p;
    }
}

class ModelObject
{
    private int p;
    public int P
    {
        get
        {
            Debug.WriteLine(this + ".P returned " + this.p);
            return this.p;
        }
        set
        {
            Debug.WriteLine(this + ".P changed from +" + this.p + " to " + value);
            this.p = value;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-03T04:38:22.930

我认为这就是强制的全部想法 - 在不触发任何其他依赖项的修改的情况下即时正确的值。您可以使用下面的代码代替本机强制机制：

```
OnPChanged(/* ... */)
{
    // ...
    var coercedP = CoerceP(P);
    if (P != coercedP)
        P = coercedP;
    // ...
} 
```

HTH。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T17:04:25.460

我不认为强制回调是双向的。一种解决方法是在强制回调中更新模型的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-04-11T15:00:33.107

这是您在目标对象上设置值的扩展方法

```
public static void SetTargetValue<T>(this FrameworkElement element, DependencyProperty dp, T value)
    {
        var binding = BindingOperations.GetBinding(element, dp);
        if (binding == null) return;
        var name = binding.Path.Path;
        var splits = name.Split('.');
        var target = element.DataContext;
        for (var i = 0; i < splits.Length; i++)
        {
            PropertyInfo property;
            if (i == splits.Length - 1)
            {
                property = target.GetType().GetProperty(splits[i]);
                property.SetValue(target, value);
            }
            else
            {
                property = target.GetType().GetProperty(splits[i]);
                target = property.GetValue(target);
            }
        }
    } 
```

因此，在此方法中，使用绑定，您可以将值设置为源。当然源路径可以有很多名称 - Property1.Property2.Property3 等。在强制方法中，您只需调用此方法：

```
private static object CoerceProperty(DependencyObject d, object baseValue)
    {
        if (!Check)
        {
            var sender = (FrameworkElement)d;
            sender.SetTargetValue(MyPropertyProperty, myValue);
            return needValue;
        }
        return baseValue;
    } 
```

# iphone - 如何访问 iPhone 应用程序目录并在其中存储图像文件

> ID：516215
> 
> 赞同：6
> 
> 时间：2009-02-05T14:52:01.757
> 
> 标签：iphone, objective-c, cocoa-touch

我想知道我是否可以访问安装我的应用程序的目录。我还想在同一目录中创建一个子目录来存储我在应用程序中捕获的所有图像。我还想使用 iPhone 的默认图像查看器查看图像。这可以做到吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-13T16:23:07.027

```
NSString *appFolderPath = [[NSBundle mainBundle] resourcePath];

NSFileManager *fileManager = [NSFileManager defaultManager];  
NSLog(@"App Directory is: %@", appFolderPath);
NSLog(@"Directory Contents:\n%@", [fileManager directoryContentsAtPath: appFolderPath]); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-12-21T11:09:37.857

您可以获取应用程序的 Document 文件夹

```
NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES); 
NSString *documentsDirectory = [paths objectAtIndex:0]; // Get documents folder 
```

您可以使用 NSFileManger 创建文件夹和文件。您可以将文件存储在文档文件夹中，甚至可以将其存储在临时文件夹中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-04-21T12:16:29.597

如果要访问模拟器上的应用程序，请导航到此目录：

> ~/库/应用程序支持/iPhone 模拟器/用户/应用程序

如果您想在设备上访问该应用程序，它会变得有点棘手。首先，将您的 iOS 设备插入 iTunes 并备份手机（关闭加密）。然后下载此应用程序：[iPhone / iPod Touch Backup Extractor](http://supercrazyawesome.com/)，找到您的捆绑包 ID 并单击提取。然后，该应用程序将获取所有数据供您查看。当然这不是实时的，但可以完成工作！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-02T03:25:51.853

~/Library/Application Support/iPhone Simulator/User/Applications [链接文本](http://developer.apple.com/iphone/library/documentation/xcode/conceptual/iphone_development/120-Running_Applications/running_applications.html "关联")

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-11T13:28:27.267

要存储您自己的任何文件，您必须使用 Girish 已经说过的 Documents 目录。但是，如果您需要显示使用相机捕获的图像，则可以使用 UIImagePickerController（默认图像查看器）显示它们的唯一方法是在将其初始化为保存的相册时指定源类型。

* * *

## 回答 #6

> 赞同：-11
> 
> 时间：2009-02-05T15:10:36.713

来吧，这一切都在示例代码和文档中。事实上，它甚至是 iPhone 开发中心的常见问题之一。我拒绝给出答案。相反，这里有一个链接： [很容易找到可以回答您的问题的文档](http://developer.apple.com/iphone/library/codinghowtos/DataManagement/index.html)

# .net - 使构建过程独立于 GAC

> ID：516217
> 
> 赞同：4
> 
> 时间：2009-02-05T14:53:40.460
> 
> 标签：.net, visual-studio-2005, gac

我们如何才能使 .NET 项目的构建过程（Dev Studio 2005）完全独立于运行它的特定机器上的 GAC 上安装的内容。

这是我们要解决的问题：根据碰巧安装到 GAC 中的程序集，我们的构建过程会在输出目录中生成不同的 .NET 程序集，然后我们使用这些程序集来构建 .MSI

大概这是因为开发工作室假设，因为它安装在 GAC 中，所以它不应该作为我们产品的一部分安装。

我们希望禁用此行为，以便将项目直接或间接引用的所有 .NET 程序集复制到项目的输出目录中（.NET 2.0 运行时标准程序集除外）。

对于*直接*程序集引用，我知道设置“Copy Local=True”可以做到这一点。

但是，这不适用于间接程序集引用。

即，我们的一个项目引用了一个名为“A.dll”的程序集，该程序集依赖于另一个名为“B.dll”的程序集，该程序集与“A.dll”位于同一目录中。在 GAC 中未安装“B.dll”的机器上，A.dll 和 B.dll 都将复制到 Dev studio 构建过程中的输出目录中。这就是我们想要的。

但是在将 B.dll 安装到 GAC 的机器上，即使 A.dll 的“Copy Local = True”，B.dll 也不会被复制到输出目录中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T16:29:59.453

就像 Marc 建议的那样，唯一的方法是添加依赖引用并设置 CopyLocal=True。

但我开始同意 Danny 的回答 - 不要使用 Dev Studio 进行部署，因为您无法充分控制构建过程。

为什么？Dev Studio 有一些“默认”逻辑，如果它已经计算了属性的值，那么它不会将其保存到 .CSPROJ 文件中，而将 Dev Studio 实例留在另一台机器上的任务是“默认” “把财产换成别的东西了！

唯一没有错误的方法是直接显式编辑 .csproj xml 文件并确保您已将 True 添加到 Reference 元素：

```
<ItemGroup>
    <Reference Include="ConfigManagerClient, Version=1.0.0.0, Culture=neutral, PublicKeyToken=20fc1ffb797ec904, processorArchitecture=MSIL">
    <SpecificVersion>False</SpecificVersion>
    <HintPath>..\..\thirdparty\CM\ConfigManagerClient.dll</HintPath>
    <!-- If DevStudio inferred this to be true, then it won't explicitly save it.
         When the project is loaded on another machine on which the assembly is
         installed in the GAC,
         Dev Studio on _that_ machine will infer that CopyLocal should be False!!
     -->
    <Private>True</Private>
</Reference> 
```

这种行为似乎使得几乎不可能知道您的 .CSPROJ 文件在另一台机器上运行时会做什么。

从长远来看，最好不要将构建和打包过程委托给 Dev Studio，而只是使用 Nant 和显式命令行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:33:52.110

我认为您可能不应该依赖 Visual Studio 构建过程来自动为您执行此操作，特别是当结果可能因构建机器而异时。

在这种情况下我要做的（无论您是使用 Visual Studio 构建还是使用自动构建脚本都适用）是有一些构建后脚本（为了简单起见，我通常使用批处理文件）将项目需要的所有程序集复制到构建后立即的适当目录（我通常将不属于我的项目的任何程序集保存在源代码管理的目录中，以便它们都在一个地方）。然后，当您构建安装程序时，一切都在它需要的地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T14:57:21.887

最简单的答案是明确的：添加对 B.dll 的引用并根据需要设置它。

# c# - 在尚未构建 csproj 时抑制 AfterBuild 目标

> ID：516227
> 
> 赞同：8
> 
> 时间：2009-02-05T14:55:49.240
> 
> 标签：c#, msbuild

我在 MSBuild 中有一个构建后目标来复制一些构建输出。

这作为对`AfterBuild`目标的依赖项（由 暴露`Microsoft.CSharp.targets`）链接：

```
<Target Name="AfterBuild" DependsOnTargets="InstallUtil;CopyPostBuildFiles" /> 
```

如果构建实际上没有重新构建，有什么方法可以避免文件被复制？

例如，当 MSBuild 依赖项分析断言不需要构建项目，因为它的源文件都没有更新，它不会构建，但仍然执行我的复制目标。有什么办法可以防止这种情况发生吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-12-12T21:31:20.313

我只是用谷歌搜索并找到了这个多年的答案。我找到了一种方法，通过从核心目标窃取一个想法来更容易地做到这一点。覆盖 BeforeBuild 和 AfterBuild 并执行以下操作：

```
 <Target Name="BeforeBuild">
    <PropertyGroup>
      <MyBeforeCompileTimestamp>%(IntermediateAssembly.ModifiedTime)
                 </MyBeforeCompileTimestamp>
    </PropertyGroup>
  </Target>

  <Target Name="AfterBuild">
    <CallTarget Condition="$(MyBeforeCompileTimestamp) !=   
          %(IntermediateAssembly.ModifiedTime)" Targets="MyTarget" /> 
  </Target> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-12-21T19:01:00.253

由于您要覆盖 AfterBuild 目标，因此它将始终在构建发生后执行。这是重建或正常构建的情况。如果您想在重建（而不是构建）之后执行一些操作，那么您应该扩展 Rebuild 目标的依赖属性。因此，在您的情况下，在重建发生后注入目标，您的项目文件应如下所示：

```
<Project ...>
   <!-- some content here -->

   <Import Project="... Microsoft.Csharp.targets" />

    <PropertyGroup>
        <RebuildDependsOn>
            $(RebuildDependsOn);
            InstallUtil;
            CopyPostBuildFiles
        </RebuildDependsOn>
    </PropertyGroup>
</Project> 
```

此方法扩展了 Rebuild 目标用来声明它所依赖的目标的属性。我在文章[Inside MSBuild](http://msdn.microsoft.com/en-us/magazine/cc163589.aspx)中对此进行了详细说明，请参阅*扩展构建过程*部分。

此外，如果您可以指定哪些文件将“*触发*”更新发生，那么 AfterBuild 目标可能会实现您尝试完成的任务。换句话说，您可以在目标中指定一组“输入”和一组“输出”，它们都是文件。如果所有输出都是在所有输入之后创建的，那么目标将被认为是最新的并被跳过。这个概念被称为增量构建，我已经在文章[MSBuild Best Practices Part 2](http://msdn.microsoft.com/en-us/magazine/dd483291.aspx)中介绍了它。我也在我的书中详细介绍了这一点，[Microsoft Build Engine 内部：使用 MSBuild 和 Team Foundation Build](https://rads.stackoverflow.com/amzn/click/com/0735626286)。

**编辑：添加 BuildDependsOn 示例**

如果您希望目标仅在文件实际构建时执行，而不仅仅是在执行 Rebuild 目标时执行。然后你应该创建你的项目，如下所示：

```
<Project ...>
   <!-- some content here -->

   <Import Project="... Microsoft.Csharp.targets" />

    <PropertyGroup>
        <BuildDependsOn>
            $(BuildDependsOn);
            CustomAfterBuild;
        </BuildDependsOn>
    </PropertyGroup>
   <Target Name="CustomAfterBuild" Inputs="$(MSBuildAllProjects);
            @(Compile);                               
            @(_CoreCompileResourceInputs);
            $(ApplicationIcon);
            $(AssemblyOriginatorKeyFile);
            @(ReferencePath);
            @(CompiledLicenseFile);
            @(EmbeddedDocumentation); 
            $(Win32Resource);
            $(Win32Manifest);
            @(CustomAdditionalCompileInputs)"
    Outputs="@(DocFileItem);
             @(IntermediateAssembly);
             @(_DebugSymbolsIntermediatePath);                 
             $(NonExistentFile);
             @(CustomAdditionalCompileOutputs)">

   <!-- Content here -->

    </Target>

</Project> 
```

**我刚刚从 Microsoft.CSharp.targets 中的CoreCompile**目标复制了输入和输出（*我假设您在这里使用 C#*）并将其粘贴到此处。这意味着每当执行**CoreCompile**目标时，都会跳过目标。此外，由于我扩展了 BuildDependsOn，我们知道 MSBuild 将在构建项目时尝试并执行它。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-06T07:43:26.367

像在编译目标中那样使用输入和输出目标的属性怎么样？

```
<PropertyGroup>
  <PostBuildDir>CopiedFilesDirectory</PostBuildDir>
</PropertyGroup>

<Target Name="AfterBuild" DependsOnTargets="InstallUtil;CopyPostBuildFiles" />

<Target Name="CopyPostBuildFiles"
        Inputs="@(PostBuildFiles)"
        Outputs="@(PostBuildFiles -> '$(PostBuildDir)%(Filename)%(Extension)'">
    <Copy SourceFiles="@(PostBuildFiles)"
          DestinationFolder="PostBuildDir"/>
</Target> 
```

您可以在*CopyPostBuildFiles*和*InstallUtil*或直接在*AfterBuild*上使用它。

[有关目标输入输出](http://msdn.microsoft.com/en-us/library/ms171483.aspx)的更多信息，请参阅此页面

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T15:21:51.620

构建目标定义为：

```
<Target Name = "Build" DependsOnTargets="BeforeBuild;CoreBuild;AfterBuild"/> 
```

我认为如果您的文件没有更改，则不会执行 CoreBuild，因此您可以尝试**使用 AfterCompile**而不是 AfterBuild。

```
<Target Name="AfterCompile" DependsOnTargets="InstallUtil;CopyPostBuildFiles" /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T22:52:26.373

那这个呢。

> *   *构建中断*。发生编译错误时设置为 true，否则设置为 false。可用于构建中断目标以确定它们是在编译错误后执行还是正常执行。
> 
> [http://blogs.msdn.com/aaronhallberg/archive/2008/02/12/team-build-2008-property-reference.aspx](http://blogs.msdn.com/aaronhallberg/archive/2008/02/12/team-build-2008-property-reference.aspx)

我还没有尝试过，但听起来很有希望。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-06-07T16:25:27.497

当且仅当项目目标文件已重建时，这将调用 AfterBuild 目标：

```
<Target Name="AfterBuild"
    DependsOnTargets="InstallUtil;CopyPostBuildFiles"
    Inputs="$(TargetPath)"
    Outputs="$(DeployPath)\$(TargetFileName)" /> 
```

这假定您已定义一个属性，该属性`$(DeployPath)`标识您复制目标输出文件的文件夹。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-03-07T21:27:06.943

我对 MSBuild 了解不多，但对于 Visual Studio for C# 使用的 MSBuild 项目，有一个简单的替代方案：使用 Post-build 构建事件而不是 AfterBuild 目标。

您可以通过 Visual Studio 项目属性对话框在第三个选项卡“构建事件”上设置构建后构建事件。在某些情况下，最好在此对话框中输入一些命令，然后在确定其工作方式后直接编辑 .csproj 文件。

请记住在对话框中选择“运行此构建后事件：当构建更新项目输出时” - 这是获得 OP 请求的功能的关键。

就像我说的，我对 MSBuild 了解不多，可能是 Post-build 构建事件不适用于 AfterBuild 目标可以做的某些事情。但我已经用它来复制文件和运行 BAT 脚本，而且它工作得很好。

编辑：

我将添加一些关于我通常如何在我的 C# 项目中使用构建后事件的注释。

为了区分不同的功能区域，我通常创建一个名为 PostBuildEvent.bat 的 BAT 脚本，并将其放在与 .csproj 文件相同的文件夹中。然后我的构建后事件只包含两行：

```
cd $(ProjectDir)
PostBuildEvent.bat 
```

然后我将我想要的命令放在 PostBuildEvent.bat 文件中。这是一个例子：

```
copy "..\..\..\..\..\Shared Bin\Merlinia.CommonClasses.NamedPipesNative.dll" bin
copy "..\..\..\..\..\Shared Bin\Merlinia.CommonClasses.NamedPipesNative.pdb" bin

cd Packed-NonObfuscated
call PackForWindowsSystem32-NonObfuscated.bat
cd ..\

cd Packed-Obfuscated
call PackForWindowsSystem32-Obfuscated.bat
cd ..\

pause 
```

请记住，要从 BAT 脚本调用 BAT 脚本，您明确指定“调用”。还要注意“暂停”的使用 - 这可以通过双击 BAT 文件来测试脚本，然后您可以在 cmd 窗口中看到任何错误消息。当脚本通过 MSBuild 运行时，“暂停”将被忽略。

# arrays - 如何在所有工作表中获取单元格的值

> ID：516228
> 
> 赞同：0
> 
> 时间：2009-02-05T14:55:57.647
> 
> 标签：arrays, vba, excel

我正在尝试编写一个 VBScript 函数，该函数将 Excel 文档的所有选项卡中的单元格（“E1”）的值收集到一个数组（审阅者）中。

我写了以下代码，但是数据没有存储到数组中，有人可以告诉我我做错了什么吗？

这是代码：

![vba 截图](https://i.stack.imgur.com/ZhiEa.jpg)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T15:13:16.147

我看不到您的代码，因为我的公司已阻止访问 imageshack。

您是否尝试过类似以下的方法？

```
Dim i As Long
Dim reviewers() As String
ReDim reviewers(0 To Worksheets.Count - 1)

For i = 0 To Worksheets.Count - 1
    reviewers(i) = Worksheets(i + 1).Cells(1, 5).Value
Next 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:31:19.480

甚至，由于 Worksheets 是基于 1 的（所以我们可能会失去 +1 和 -1 的业务）：

```
Dim i As Long
Dim reviewers() As String
ReDim reviewers(1 To Worksheets.Count)

For i = 1 To Worksheets.Count 
    reviewers(i) = Worksheets(i).Cells(1, 5).Value
Next 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T20:52:22.670

你的代码说

```
 Reviewers(N) = Sheets(N+1).Range("B7:C7").Value 
```

范围 B7:C7 由两个单元格组成，而不是一个，因此该值是一个数组，而不是单个值。使用一个单元格的范围。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-05-28T05:36:30.817

如果你想要它们都在那里，你只需要连接单元格，或者如果你想添加它们，用 + 替换 &，我不知道它们是值还是文本。

```
Reviewers(N) = Sheets(N+1).Range("B7").Value & Sheets(N+1).Range("C7").Value 
```

# c# - Linq 表达式混淆与延迟执行相结合

> ID：516229
> 
> 赞同：0
> 
> 时间：2009-02-05T14:56:44.493
> 
> 标签：c#, asp.net-mvc, linq, reflection, routing

一旦路径与特定需求或模式匹配，我想执行代码的特定部分。我将从不同的插件中导入一些路径，这些路径将被搜索并整理出哪些对我的意图有用或无用。

这个想法是，一旦我从这些路径中获得匹配，我想创建这个类的一个实例并调用它的方法来返回一个`view`.

我可以弄清楚足以传递一个委托并调用适当的代码，但这仍然让我持有一个指向该类的指针，这是我不想要的。我想创建这个类的一个实例并调用所需的方法。

这是一个大纲：

```
public class TestView : IView
{
    public void Render(ViewContext viewContext, System.IO.TextWriter writer) {}
}

class TestViewCreator
{
    public IView CreateView(object Arguments)
    {
        return new TestView();
    }
}

public class CentralStash
{
    // T = TestViewCreator
    // How do I describe the method I want to call (CreateView)?
    public void RegisterPath<T>(string url, object Arguements)
    {

    }

    public IView GetView(string url)
    {
        var viewCreator = ObjectFactory.GetInstance<T>();
        //How do I call the method description on the type that I have jsut instanced?
        return null;
    }
} 
```

我有一种感觉，我可能应该在这里使用路线，或者可能是一种表达方式？我知道这可能与委托有关，但我不希望因为它们的指针而放置一些对象。

朝正确方向轻推将不胜感激。

**更新：**

当然，我可以创建界面：

```
public interface IViewCreator
{
    public IView CreateView(object Arguments);
} 
```

并创建一个来调用`CreateView`，但我希望让它更强大。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-07-29T09:10:41.773

```
public IView GetView(string url)
{
    object viewCreatorObj = ObjectFactory.GetInstance<T>();
    TestViewCreator viewCreator=? viewCreatorObj as TestViewCreator;

    return viewCreator.CreateView(null);
} 
```

# .net - 如何在对 asp .net 应用程序进行单元测试时使用 web.config

> ID：516233
> 
> 赞同：75
> 
> 时间：2009-02-05T14:57:34.150
> 
> 标签：.net, asp.net, unit-testing

我从单元测试开始，我有一个使用 web.config 作为连接字符串的方法。

我希望能够使用

```
[DeploymentItem("web.config")] 
```

要获取 Web 配置文件，这仍然给我留下了空引用异常（这就是我编写下一个测试的目的）。

如何使用我要测试的项目中包含的配置文件？

我正在使用 VS 2008 中包含的测试框架，如果这有什么不同的话。

谢谢

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-02-05T15:02:19.193

单元测试项目应该有自己的配置文件。

在测试项目中，您可以选择 Add、New Item、Application Configuration File。

该文件的行为与 web.config 完全相同，但随后用于您的单元测试。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2014-05-08T18:39:39.583

您可以使用`OpenMappedExeConfiguration`. 确保`System.Configuration`已添加到您项目的引用中。

```
ExeConfigurationFileMap fileMap = new ExeConfigurationFileMap()
fileMap.ExeConfigFilename = @"c:\my-web-app-location\web.config"

Configuration config = ConfigurationManager.OpenMappedExeConfiguration(fileMap, ConfigurationUserLevel.None);
string connectionString = config.AppSettings.Settings["ConnectionString"].Value; 
```

这是web.config，非常标准。

```
<?xml version="1.0"?>
<configuration>
  <configSections>
  </configSections>
  <appSettings>
    <add key="ConnectionString" value="Data Source=XXXX;Initial Catalog=XXX; Trusted_Connection=True;"/>
  </appSettings>
</configuration> 
```

**2017-09-29 更新**

我上了一门课，可以更轻松地从文件中读取 AppSetitngs。我从[Zp Bappi](http://zpbappi.com/testing-codes-with-configurationmanager-appsettings/)那里得到了这个想法。

```
public interface IAppSettings
{
    string this[string key] { get; }
}

public class AppSettingsFromFile : IAppSettings
{
    readonly Configuration Config;

    public AppSettingsFromFile(string path)
    {
        var fileMap = new ExeConfigurationFileMap();
        fileMap.ExeConfigFilename = path;
        Config = ConfigurationManager.OpenMappedExeConfiguration(fileMap, ConfigurationUserLevel.None);
    }

    public string this[string key]
    {
        get
        {
            return Config.AppSettings.Settings[key].Value;
        }
    }
} 
```

以下是如何使用该类。

```
IAppSettings AppSettings = new AppSettingsFromFile(@"c:\my-web-app-location\web.confg");
string connectionString = AppSettings["ConnectionString"]; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-08-05T13:11:31.943

将您的 web.config 文件复制到“/bin”文件夹并将其重命名为“AppName.dll.config”。

其中“AppName”- 是生成的程序集的名称。

我多次使用这个黑客。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-05T15:07:01.323

您将希望您的结果明确且可重复。为此，您需要处理已知数据，以便您可以清楚地定义正常情况和边界情况。在我的工作中，这*始终*是一个特定的服务器和数据集，因此单元测试模块具有内置的连接字符串。其他人更喜欢使用单元测试项目之外的连接字符串。我从未见过有人推荐使用网站的配置文件！（开发或其他）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-04-26T20:55:57.047

我建议将配置读取部分抽象化，以便对其进行模拟。像这样的东西，请参阅 Jon_Lindeheim 的回复[How to read Web.Config file while Unit Test Case Debugging?](https://stackoverflow.com/questions/23513355/how-to-read-web-config-file-while-unit-test-case-debugging)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T15:38:02.150

如果您需要一个连接字符串，那么您不是在编写单元测试（假设您正在使用连接字符串来访问数据库）。单元测试不应该与外部环境交互。您将希望在每次签入后都运行它们，以便它们更好地以光速运行。

对于单元测试，您需要将代码与数据库隔离。修改您的测试（以及您正在测试的代码，如有必要），这样您就不需要去数据库进行测试。

# c++ - 我什么时候应该在 C++ 中使用 typedef？

> ID：516237
> 
> 赞同：76
> 
> 时间：2009-02-05T14:59:52.147
> 
> 标签：c++, typedef

在我多年的 C++ (MFC) 编程中，我从来没有觉得需要使用`typedef`，所以我真的不知道它是用来做什么的。我应该在哪里使用它？`typedef`是否存在首选使用的实际情况？或者这真的更像是一个特定于 C 的关键字吗？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-02-05T15:04:47.410

## 模板元编程

`typedef`对于许多[模板元编程](http://en.wikipedia.org/wiki/Template_metaprogramming)任务来说是*必需*的——每当一个类被视为“编译时类型函数”时，a被用作“编译时类型值”来获得结果类型。例如，考虑一个简单的元函数，用于将指针类型转换为其基类型：`typedef`

```
template<typename T>
struct strip_pointer_from;

template<typename T>
struct strip_pointer_from<T*> {   // Partial specialisation for pointer types
    typedef T type;
}; 
```

示例：类型表达式的`strip_pointer_from<double*>::type`计算结果为`double`。请注意，模板元编程在库开发之外并不常用。

## 简化函数指针类型

`typedef`*有助于*为复杂的函数指针类型提供简短、清晰的别名：

```
typedef int (*my_callback_function_type)(int, double, std::string);

void RegisterCallback(my_callback_function_type fn) {
    ...
} 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-02-05T15:08:32.223

在 Bjarne 的书中，他指出您可以使用 typedef 来处理具有不同整数大小的系统之间的可移植性问题。（这是一个释义）

在 4 的机器上`sizeof(int)`你可以

```
typedef int int32; 
```

然后`int32`在代码中的任何地方使用。当您转到`sizeof(int)`2 的 C++ 实现时，您只需更改`typdef`

```
typedef long int32; 
```

并且您的程序仍将适用于新的实施。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-02-05T15:05:15.443

与函数指针一起使用

使用 typedef 隐藏函数指针声明

```
void (*p[10]) (void (*)() ); 
```

只有少数程序员可以说 p 是一个“由 10 个指向返回 void 的函数的指针组成的数组，并获取指向另一个返回 void 且不带参数的函数的指针”。繁琐的语法几乎无法辨认。但是，您可以通过使用 typedef 声明大大简化它。首先，为“指向返回 void 且不带参数的函数的指针”声明一个 typedef，如下所示：

```
 typedef void (*pfv)(); 
```

接下来，根据我们之前声明的 typedef 为“指向返回 void 并获取 pfv 的函数的指针”声明另一个 typedef：

```
 typedef void (*pf_taking_pfv) (pfv); 
```

现在我们已经创建了 pf_taking_pfv typedef 作为笨拙的“指向返回 void 并获取 pfv 的函数的指针”的同义词，声明一个包含 10 个此类指针的数组是轻而易举的事：

```
 pf_taking_pfv p[10]; 
```

[从](http://www.devx.com/tips/Tip/13829)

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-02-05T15:14:34.147

只是为所说的事情提供一些例子：STL 容器。

```
 typedef std::map<int,Froboz> tFrobozMap;
 tFrobozMap frobozzes; 
 ...
 for(tFrobozMap::iterator it=frobozzes.begin(); it!=map.end(); ++it)
 {
     ...
 } 
```

甚至使用 typedef 之类的并不罕见

```
typedef tFrobozMap::iterator tFrobozMapIter;
typedef tFrobozMap::const_iterator tFrobozMapCIter; 
```

另一个例子：使用共享指针：

```
class Froboz;
typedef boost::shared_ptr<Froboz> FrobozPtr; 
```

* * *

**[更新]**根据评论 - 把它们放在哪里？

最后一个例子 - 使用`shared_ptr`- 很容易：是真正的标题材料 - 或者至少是一个前向标题。无论如何，您确实需要 shared_ptr 的前向声明，其声明的优点之一是与前向 decl 一起使用是安全的。

换句话说：如果有一个 shared_ptr 你可能应该只通过一个 shared_ptr 使用该类型，因此分离声明没有多大意义。

（是的，xyzfwd.h 很痛苦。我只会在热点中使用它们——知道热点很难识别。归咎于 C++ 编译+链接模型......）

容器类型定义我通常在声明容器变量的地方使用——例如，在本地用于本地变量，当实际容器实例是类成员时，作为类成员。如果实际的容器类型是一个实现细节，这很有效——不会导致额外的依赖。

如果它们成为*特定*接口的一部分，它们将与它们一起使用的接口一起声明，例如

```
// FrobozMangler.h
#include "Froboz.h"
typedef std::map<int, Froboz> tFrobozMap;
void Mangle(tFrobozMap const & frobozzes); 
```

当类型是不同接口之间的绑定元素时，就会出现问题 - 即多个标头需要相同的类型。一些解决方案：

*   与包含的类型一起声明（适用于该类型经常使用的容器）
*   将它们移动到单独的标题
*   移动到一个单独的标题，并使其成为一个数据类，其中实际容器再次是一个实现细节

我同意后者不是那么好，我只会在遇到麻烦时使用它们（不是主动）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-05T15:12:19.470

typedef 在很多情况下都很有用。

基本上，它允许您为类型创建别名。当/如果您必须更改类型时，其余代码可能会保持不变（这当然取决于代码）。例如，假设您想在 c++ 向量上进行迭代

```
vector<int> v;

...

for(vector<int>::const_iterator i = v->begin(); i != v.end(); i++) {

// Stuff here

} 
```

将来您可能会考虑用列表更改向量，因为您必须对其进行的操作类型。如果没有 typedef，您必须更改代码中所有出现的向量。但是如果你写这样的东西：

```
typedef vector<int> my_vect;

my_vect v;

...

for(my_vect::const_iterator i = v->begin(); i != v.end(); i++) {

// Stuff here

} 
```

现在您只需更改一行代码（即从“ `typedef vector<int> my_vect`”到“ `typedef list<int> my_vect`”），一切正常。

当你有复杂的数据结构时，typedef 还可以节省你的时间，这些数据结构写起来很长（而且难以阅读）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-05T15:13:56.487

使用 typedef 的一个很好的理由是某些东西的类型可能会改变。例如，假设现在，16 位整数可以很好地索引某些数据集，因为在可预见的未来，您将拥有少于 65535 个项目，并且空间限制很重要，或者您需要良好的缓存性能。但是，如果您需要在包含超过 65535 个项目的数据集上使用程序，您希望能够轻松切换到更宽的整数。使用 typedef，您只需在一个地方更改它。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-03-19T00:28:08.417

`typedef`不仅允许为复杂类型使用别名，而且为您提供了一个自然的地方来记录类型。我有时将它用于文档目的。

有时我会使用字节数组。现在，一个字节数组可能意味着很多事情。`typedef`可以方便地将我的字节数组定义为“hash32”或“fileContent”，以使我的代码更具可读性。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-05T15:03:35.603

typedef 的实际用途：

*   为冗长的模板类型提供友好的别名
*   为函数指针类型提供友好的别名
*   为类型提供本地标签，例如：

    ```
    template<class _T> class A
    {
        typedef _T T;
    };

    template<class _T> class B
    {
        void doStuff( _T::T _value );
    }; 
    ```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-07-20T10:14:14.767

使用 typedef 的另一个用例是我们想要启用一种 **容器独立代码**（但不完全是！）

让我们说你有课：

```
Class CustomerList{

public:
    //some function
private:
    typedef list<Customer> CustomerContainer;
    typedef CustomerContainer::iterator Cciterator;
}; 
```

上面的代码使用 typedef 封装了内部容器实现，即使将来列表容器需要更改为向量或双端队列，CustomerList 类的用户仍然不需要担心确切的容器实现。

因此，typedef 封装并在一定程度上帮助我们编写独立于容器的代码

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T15:04:56.803

每当它使源代码更清晰或更易于阅读时。

我在 C# 中将 typedef 用于泛型/模板。“NodeMapping”比很多“Dictionary<string, XmlNode>”更易于阅读/使用和理解。恕我直言。所以我推荐它用于模板。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-02-11T21:12:02.693

Typedef 允许您的课程具有灵活性。当你想改变程序中的数据类型时，你不需要改变多个位置，只需要改变一个出现。

```
typedef <datatype example  int or double> value_type 
```

您可以使用 nay name 代替`value_type`, 但`value_type`通常是标准名称。

所以你可以使用 typedef

```
value_type i=0;     //same as a int or double i=0; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-04-03T10:32:41.753

的 1 个实际例子`typedef`是`size_t`. 它保证足够大以包含主机系统可以处理的最大对象的大小。最大允许大小取决于编译器；如果编译器是 32 位那么它只是一个`typedef`for`unsigned int`但如果编译器是 64 位那么它将是一个`typedef`for `unsigned long long`。`size_t`数据类型永远不会是负数。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-02-05T15:31:49.930

...而且您不需要 Typedef 用于枚举或结构。

还是你？

```
typedef enum { c1, c2 } tMyEnum;
typedef struct { int i; double d; } tMyStruct; 
```

可以更好地写为

```
enum tMyEnum { c1, c2 }
struct  tMyStruct { int i; double d; }; 
```

那是对的吗？C呢？

# internet-explorer - 什么可能导致会话 Cookie 在会话中消失？

> ID：516248
> 
> 赞同：2
> 
> 时间：2009-02-05T15:03:18.427
> 
> 标签：internet-explorer, cookies, session

我有一个 Web 应用程序，它使用会话 cookie 来保持用户登录。当他们登录时，系统会生成一个 GUID，它与数据库中的用户记录相关联。GUID 然后存储在 cookie 中，因此可以在每次页面加载时读取它并根据数据库条目进行检查。

设置 cookie 的代码非常简单。

```
Response.Cookies("UserSession")("ID") = vsSessionCookie
Response.Cookies("UserSession").path = "/" 
```

尽管该系统已使用多年，但新客户已开始抱怨发生错误。当我们在错误发生时记录有关错误的信息（包括 cookie）时，我看到会话 cookie 根本不再存在。查看代码确实表明，如果会话 cookie 走动，应用程序会出错。

请注意，应用程序使用的具有到期日期的持久性 cookie 会保留下来。

我知道它应该更优雅地处理这个问题，但我感到困惑的问题是什么可能导致会话 cookie 消失。这不是用户在一段时间内不活动的情况，因为他们声称这是在他们使用系统时随机发生的。不幸的是，它们并没有更具体，但在一种情况下，我发现它发生在他们在系统中运行报告之后。此报告显示在一个新的浏览器窗口中（使用 Window.Open 在 JavaScript 中打开），因此看起来关闭此窗口会杀死原始窗口中的会话 cookie。

该系统（可悲）仅适用于 IE，但我找不到任何会导致此行为的设置，并且它适用于许多其他客户端。

是否有可能导致这种行为的设置？为什么它应该对某些客户有效，而对其他客户无效？

也许它与关闭窗口无关，并且其他一些过程正在会话中清除会话cookie，但是什么？

这么多问题....对不起，但如果有人对此情况有任何经验，那将有很大帮助！

对于信息，Web 系统是用 ASP.Net 编写的。还有一个用经典 ASP 编写的系统对客户端也有同样的影响，所以我不认为 Web 系统本身有问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T15:37:53.960

所有客户端都使用相同版本的 IE 吗？我还在 Windows 防病毒软件上看到了清除 cookie。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T15:46:39.367

我遇到过这样的问题，从 IE6 到现在 IE8。问题似乎是当你启动 IE 时（第一页是什么），如果它是一个本地页面（例如 file://c:\a.htm）然后从那里你去实际的网站，（它仍然可以）然后在您的网站中，它会打开一个弹出窗口，然后当您关闭弹出窗口时（即会话 cookie 被破坏时，因为 cookie 中的所有数据都消失了，我被注销了。所以我的解决方案是（开始 > 运行 > 'iexplore [http://www.mywebapp-site.com](http://www.mywebapp-site.com) '）

但我也遇到了未设置cookie中的某些数据集的问题，仍然不知道..为什么..

# aspect-ratio - 你对 16:9 屏幕网页设计的看法

> ID：516249
> 
> 赞同：18
> 
> 时间：2009-02-05T15:03:32.500
> 
> 标签：aspect-ratio

我设计的网络应用程序主要供同事和客户使用（不是 PDA、电话等）。随着越来越多的用户配备 16:9 型屏幕，传统的屏幕布局不再符合人体工程学。

例如，长的垂直导航栏可能不完全适合，或者可能需要滚动复杂的表单才能移动到下一个输入字段。

您如何应对这种发展？你是更水平地展开还是坚持旧的布局？这真的不是问题吗？

**更新**

感谢所有的答复。我发现它们很有用。以下是我想到的一些想法：

*   我认为 4:3 格式可能仍然是最广泛使用的格式，但我希望这种情况会有所改变。

*   此外，我在公司访问的大多数用户都将他们的*所有*窗口最大化（真的！）所以调整浏览器大小以适应内容的想法在那里没有帮助。

*   就我而言，大多数网络应用程序都涉及信息或数据输入的搜索和显示（其中一些可能涉及大而复杂的表单）。这主要是我关心的数据输入应用程序。也许 AJAX 和选项卡式控件可能是一种前进的方式。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-05T15:14:29.387

当我们查看宽屏采用率时，大多数情况下分辨率只是水平增加。1024x768 笔记本电脑变成 1280x800，1600x1200 显示器变成 1920x1200 等等。垂直尺寸仍然照常可用。

是时候更新这个答案以适应人们在网上冲浪的方式、地点和方式的变化了。我倾向于在一定程度上流动的响应式设计，但由于媒体查询和其他有用的技术，设计人员可以更好地控制演示文稿重排，同时仍然能够适应任何视图/屏幕尺寸。

当可用视图小于某个限制时调整和折叠内容，并将文本保持在最大线宽但扩展和重新排列其他元素是我已经开始做的事情。

这不仅限于将网站缩小到移动设备上，而且还可以将元素调整并适应高清电视上的全屏浏览器 - 或者只是在具有类似于上网本的尺寸的较小平板电脑上填充并看起来不错.

我个人仍然不理解使用传统的“流体”布局，其中中心文本列可以毫不犹豫地扩展到 2000 像素，除非在 Web**应用程序**中，您需要显示类似 excel 的数据矩阵或大图像而不是实际的文本内容。就我个人而言，我偶然发现了太多这样的网站，它们的边距也太小了，如果我加宽浏览器，即使在 1920 宽度下，边距也不会增加，而且仍然太小——设计师给我施加了一个不舒服的边距我无法通过使用浏览器的开发工具更改网站的 CSS 来修复它^^

对我来说，响应式设计的第一步是采用我非常喜欢的臭名昭著的 960 像素固定宽度，并在视图较小时分三步进行调整。这使得它在较小的设备上一直很愉快，一直到手机屏幕。然而，我目前的挑战是将设计扩大到 1200 像素左右，因为我的口味太宽了，需要进行另一个元素重排 - 但许多网站甚至没有任何内容可以用于此目的......

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-05T15:28:05.960

作为用户**和**设计师，我讨厌固定宽度的网站。许多网站可以变得流畅，但不是因为它是“简单的出路”。然后遵循适合（双关语）支持该观点的各种合理化。

新闻快讯：短行长度是一个可以追溯到早期报纸研究的神话。有关详细信息，请参阅[此摘要](http://www.humanfactors.com/downloads/nov02.asp)并做出您自己的判断。

很宽的行可能对某些人来说是不可读的（我个人认为这不是什么大问题），但大约 900 像素的三列固定布局也是如此，这样每行大约有 8 到 10 个单词。

我一直试图通过查看网站的人口统计数据（例如，通过谷歌分析）并查看谁倾向于访问来设计合理的调整大小......

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-05T15:09:43.890

如果你仔细想想，16:9 的屏幕在垂直方向上并没有真正受到限制。根据我使用这些显示器的经验，它们的原始分辨率通常为 1920x1080。垂直空间仍然大于大多数分辨率（1024x768、1280x1024 等）

然而，我已经开始编写液体布局来处理水平空间。一些网页设计师喜欢坚持使用 960 像素的固定宽度。这完全取决于您要向用户展示的内容。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-05T16:19:04.220

以下是我作为用户以及网页设计师和开发人员推荐的一些原则：

1.  尽量避免水平滚动。大多数人都有一个只能向一个方向工作的鼠标滚轮。水平滚动通常被认为非常烦人。现在通常可以接受垂直滚动。
2.  列大小在长段落中很重要。我通常会推荐大约 15-20 个字的宽度，但请随意尝试。来自 alphadogg 的链接读起来很有趣，但我不得不说在 Web 开发中很难用“英寸”这个词来理解。单词或字符可能是一个更好的衡量标准，这将我引向下一个项目：
3.  使用相对单位作为宽度。在大多数情况下，这使您可以将宽度保持在一定数量的单词。
4.  有用的提示：相对单位的问题是页面可以扩展超过页面的宽度。您可以通过在 css 中指定 90% 左右的 max-width 属性来控制大多数浏览器。因此，当某人的显示器上的文本很大时，他们仍然不必水平滚动。

同样，不建议在大多数情况下简单地将内容流到浏览器宽度的 100%。而且我认为随着显示器变得越来越大，无论如何你会看到越来越少的人最大化浏览器窗口。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-05T15:29:19.873

除了其他评论...

大多数用户还没有使用宽屏显示器。更重要的是，许多使用宽屏显示器的用户没有最大化他们的网络浏览器。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-05T15:10:51.377

这些天我不太担心旧屏幕，每当 800 像素不够时，我很容易切换到 1000 像素。但是，您不应该故意设计更宽的东西，例如 1920x1080 分辨率。拥有这种屏幕的用户数量并不多。即使不是这样，太宽的设计也会影响可用性。阅读水平拉伸到〜1500px的文本并不是很好。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-05T17:12:02.723

要考虑的一件事是您的应用程序的状态。它是一个主权应用程序，用户需要在一段时间内将全部注意力集中在它上面吗？我最近在我们的 Web 应用程序中重新设计了一个页面，它允许用户执行其他语言的翻译。在这种情况下，用户将“潜入”应用程序的这一部分一段时间，所以我去掉了通常会分散注意力的导航元素，以便为手头的任务留出更多空间。

在这种情况下，用户群仅限于我公司内部的人，我知道他们都有宽屏显示器，所以很容易做出扩大范围的决定。一般来说，我会说仍然应该为非宽屏显示器设计，但在有明显优势的情况下，让设计能够利用额外的空间。我见过一些为常规屏幕布局的页面，但使用 JavaScript 来检测页面是否更宽，如果是，则重新排列一些页面元素。这样一来，默认配置始终可用，但使用宽屏和 JavaScript 的用户可以更好地利用他们的空间。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-05T15:35:57.567

我在 30 英寸显示器上进行所有开发，并在 20 英寸显示器上进行预览，以进行快速健全性检查。在我最近发布的一个应用程序版本中，我有一个 JS 发回我的目标受众正在使用的统计数据，然后我返回了许多小于 1024x768 的随机数。在我收集的大约一百个统计数据中，只有 5 或 6 个用户在大于 1440x900 的屏幕上全屏运行。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-05T17:19:20.557

设计您的网站，以便重要的是**内容**，而不是外观。然后，您可以提供备用 CSS 样式表供用户选择。

这对设计师来说有时会更加困难。例如，使用表格进行布局是行不通的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-05T17:21:49.927

请不要。

为 4:3 设计，最大宽度可能为 800 到 900 像素。

我使用的许多计算机（就像我工作中的几乎每一台计算机）都是 4:3。只有我的笔记本电脑是 16:9（我认为实际上是 16:10，但足够接近）。

我不喜欢我的网络浏览器和我的显示器一样宽，这是浪费空间。您无法阅读那么宽的文本。在我的桌面 4:3 LCD（我现在正在使用）上，宽度是 14 英寸。你无法阅读 14 英寸宽的文本，眼睛会忘记它在哪一行。这是一种可怕的痛苦。大多数网站都会限制真实内容的宽度。StackOverflow 的主要内容栏对我来说大约是 8 英寸，阅读量很大。

所以当你去 16:9 时，情况会变得更糟。现在你可能有 16 英寸而不是 14 英寸。那是巨大的。那么你如何处理所有这些空间？你不能只放文本，除非你想并排放置两篇文章（比如两个报纸专栏），我怀疑你想这样做。这意味着你只是用不重要的废话来填充它。更多侧边栏，更多广告栏。基本上你是在强迫内容填充空间。

不是每个人都运行 1920x1080。不是每个人都保持他们的网络浏览器最大化。用不重要的列填满我近一半的屏幕对我没有吸引力。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-05T08:09:48.197

在我的设计课程中，我们有一条经验法则，即线长不应大于线高的 40 倍。原因很明显：当你的眼睛回溯到下一行的开头时，你想确定它是下一行，而不是同一行或下一个加一。

出于这个原因，我总是使用固定宽度的设计。我目前的显示器有一个 43 厘米宽的活动区域。此 SO 页上的行高为 5mm。如果 SO 使用流体设计，那么线长/线高的比率将是不可接受的 84。
在 30 英寸显示器上情况更糟。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-05T15:10:02.220

我坚持为大多数人开发，仍然使用 4:3 显示器。如果我想创建特定于 16:9 的内容，我可能会提供指向“增强宽屏显示器”版本的链接，有点像 DVD 背面的标签，当时并非所有 DVD 都是变形宽银幕。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-05T15:13:29.047

*绝大多数*网络用户仍然使用标准的非宽屏显示器（请参阅下面的统计数据和我的评论），所以我会为他们设计。我个人针对 1024x768 分辨率进行了优化。

[http://www.thecounter.com/stats/2009/January/res.php](http://www.thecounter.com/stats/2009/January/res.php)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-05T16:00:08.813

这是另一个 SO question 的链接，其中*可能*包含一些有用的信息。

[书籍推荐网络用户界面设计](https://stackoverflow.com/questions/516424/book-recommendation-web-user-interface-design)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-05T17:36:07.933

不要假设垂直分辨率在宽屏上是可以的。1440x900 似乎是一种流行的分辨率，虽然它比 1024x768 大，但它明显比 1280x1024 短。

此外，不要假设所有这些新的宽屏显示器都在正确使用。我见过不少显示器没有以其原始分辨率使用的设置。人们要么不知道有什么不对，要么他们欣赏超大字符，即使它使事情变得有点模糊。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-05T18:17:05.213

不要忘记，仅仅因为用户拥有宽屏显示器，并不意味着他们的窗口也最大化。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-06T08:09:10.837

我总是使用 964px 作为网站的宽度。近似值，因站点而异，但考虑到垂直滚动条，我将其保持在 1024 像素以下。这利用了该网站对于 800 像素宽的屏幕来说并不过大，但在 1024 和 1280 像素宽的屏幕上看起来不错。

根据我的经验，我发现即使用户使用相当大的宽屏（我自己有双 22" (1680x1050) 屏幕），我仍然更喜欢固定宽度布局，大约 1024 像素宽以提高可读性。

我非常不喜欢阅读非常大的文本，我喜欢将其保持在“书本宽度”。我觉得很有吸引力并且拥有庞大用户群的大多数网站都在这些规模左右。

希望这可以帮助。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-07T14:56:45.053

作为宽屏显示器的普通用户，我不希望看到设计师让他们的网站变得更宽。我运行 24 英寸宽屏 (1920x1200)，当我浏览网页时，我通常并排运行两个浏览器。如果有的话，最好让一些网站更窄一些。大多数网站在 960 像素下都可以正常运行，但是当我不得不将网站打开得更宽或滚动查看所有内容时，这很烦人。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-05T07:32:40.500

请考虑使用 1024x600 屏幕的上网本用户的快速增长。我认为这应该是您当前项目的最小设计尺寸。

# css - 有没有办法动态更改按钮的 CSS 类？

> ID：516255
> 
> 赞同：2
> 
> 时间：2009-02-05T15:05:12.013
> 
> 标签：css, wicket

我正在开发一个基于 Wicket 的 Web 应用程序。在应用程序中有一些按钮，并非每个用户都有权使用。这些按钮实际上是简单的链接，例如

```
<a wicket:id="publishButton" title="Publish" class="rightPanel_publish"><wicket:message key="publish"/></a> 
```

使用 CSS 类（来自外部 CSS 文件）设置其视觉外观，例如

```
a.rightPanel_publish {
    display: block;
    width: 90px;
    height: 27px;
    background: url( ../imgs/right_panel_icon03.gif ) left top repeat-y;
    text-decoration: none;
    color: black;
    padding: 12px 0px 0px 35px;
} 
```

当用户无权使用按钮时，链接被禁用（在 Java 中），并且由于某种原因不再使用 CSS。

**我的问题**是：有没有办法确定链接在运行时被禁用并更改 CSS 类？我宁愿避免使用 javascript（到目前为止，设法使整个项目保持 JS-free...），并且更喜欢适用于所有浏览器的东西。

非常感谢，

尤瓦尔=8-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T15:09:24.000

不幸的是，我不知道如何在没有 JS 的情况下更改按钮页面。CSS、Java 和其他一切都在页面加载时运行，在页面加载后与页面交互的唯一方法是通过 JS。

然而，这里是适用于任何浏览器（IE 6+、Safari、Opera、FF 等）的 JS，

```
 if(document.getElementById('foo'))
  {
    document.getElementById('foo').className='bar';
  } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-27T08:03:35.197

您还可以根据用户身份验证状态使用 AttributeModifier 更改按钮的外观（即 css 类）：

```
myButton.add(new AttributeModifier("class", new AbstractReadOnlyModel<String>() {

        private static final long serialVersionUID= 1L;

        @Override
        public String getObject () {
            if (!isAuthorized()) {
                return "rightPanel_unauthorized";
            }
            return "rightPanel_publishbutton";
        }
    })); 
```

在您的 CSS 中，您可以根据需要定义“.rightPanel_unauthorized”样式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T15:12:10.640

如果没有某种脚本，就无法做到这一点。“DHTML”中的“D”代表“Javascript”：P

* * *

编辑：实际上，既然你说*某些东西*正在禁用链接/按钮，那么某些东西可以/应该也将一个“禁用”类（让 CSS 注意到的唯一 x 浏览器方式）附加到同一个元素。运行时切换不会进入它 - 如果一个事物正在改变状态，它需要彻底这样做。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-21T16:29:39.403

Wicket 链接在禁用时将 <a> 标记替换为 <span>。

应用 CSS 时请记住这一点，例如：

```
.rightPanel_publish_button {
  display: block;
  width: 90px;
  height: 27px;
  background: url( ../imgs/right_panel_icon03.gif ) left top repeat-y;
  text-decoration: none;
  color: black;
  padding: 12px 0px 0px 35px;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-31T15:43:58.667

我用`*.setVisible(Boolean boolean)`

它可用于 Wicket 中的 WebMarkupContainer 模型。setVisible() 可以根据用户角色分配到类中的其他位置。所以你可能不得不寻找它......

# c# - 带有自定义 ConfigurationSection 的 COM+ 服务器配置

> ID：516261
> 
> 赞同：1
> 
> 时间：2009-02-05T15:06:25.007
> 
> 标签：c#, configuration, com+

我有一个 COM+ 服务器托管一个实现 ServicedComponent 的 .Net 组件。

COM+ 服务器需要访问一个配置文件，其中定义了自定义配置部分。

我可以使用以下代码加载配置：

```
ExeConfigurationFileMap fileMap = new ExeConfigurationFileMap();
fileMap.ExeConfigFilename = @"%MY_FOLDER_WITH_ALL_DLLS%\MyComServer.dll.config";
Configuration config = ConfigurationManager.OpenMappedExeConfiguration(fileMap, ConfigurationUserLevel.None);

// All is fine until the next line:

MyCustomSettings customSettings = (MyCustomSettings)tempConfiguration1.GetSection("customSettings"); 
```

System.InvalidCastException：无法将“System.Configuration.DefaultSection”类型的对象转换为“MyProject.MyCustomSettings”类型

以下是我在配置文件中声明自定义配置部分的方式：

```
<configSections>
    <section name="MyProject.MyCustomSettings" type="MyProject.MyCustomSettings, MyProject, Version=1.0.3322.1077, Culture=neutral, PublicKeyToken=176fc8b9840b0b09"/>
</configSections> 
```

这种情况确实返回了一个 DefaultSection 对象，它似乎没有多大用处，因为我期待一个 CustomSettings 对象。

请注意，MyProject 是强命名的。

一种选择是在 GAC 中安装 MyProject.dll 程序集，但出于组织原因，此解决方案没有吸引力。

还有什么建议吗？

如何从运行在 DLLHost 中的进程的给定程序集的配置文件中加载自定义配置部分？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-02-05T16:09:22.210

我自己在这个问题上浪费了几个小时。最后，我通过将 <configSection> 移动到 <configuration> 的正下方解决了这个问题。一直以来，我在 <configSection> 之上还有其他配置元素。

# java - Java 套接字编程

> ID：516263
> 
> 赞同：1
> 
> 时间：2009-02-05T15:06:45.160
> 
> 标签：java, sockets, networking

从我之前的问题开始，我将尝试澄清我面临的问题之一。

我正在尝试创建 PacMan 的多人游戏版本。

我如何制作应用程序的一个简单概述是，我有一个服务器，它有一个 ServerSocket，它不断地监听一个特定的端口。一旦客户端连接，它就会创建一个线程，在该线程中进行所有数据传输。它首先侦听客户端想要移动的方向，然后将更新发送回客户端。在客户端，它与发送方向相反，然后等待接收更新。这是使用 ObjectOutput/Input Streams 完成的。还有一个包含所有游戏逻辑的游戏类，它有游戏循环，每个循环调用每个连接的玩家 serverThread.exchangeDatas() 方法。

我的游戏在连接一个客户端的情况下可以正常工作，但是一旦另一个客户端加入（本地是我测试过的所有内容，但这应该可以正常工作吗？）它使我的游戏在服务器线程中崩溃，产生以下错误 java.io.StreamCorruptedException：无效的类型代码：00。

是触发此异常的代码吗

```
 Object o = in.readObject();
        if (o instanceof Direction)
        {
            // Get new location
            player.setDirection((Direction) o);
        //System.out.println("Got: " + (Direction)o + " new location: " + player.getNextLocation());
        }

        // Send gameState

        //System.out.println("Sending data");
        Data data = new Data(game.getGameState(), game.getScared(), game.getScareLeft(), player.getLives(), player.getScore());
        out.flush();
        out.writeObject(data);
        out.flush();
        out.reset(); 
```

[服务器代码](http://pastebin.com/m1e8de96b)

[ServerThread 代码（在 exchangeData 方法中崩溃的代码）](http://pastebin.com/m459b43)

[客户端控制器代码](http://pastebin.com/m60c82176)

[游戏循环代码 - 第 42 行调用了交换数据​​方法](http://pastebin.com/m79a9a07)

任何帮助都将是惊人的。

[http://www.mediafire.com/download.php?nwwqmzywfom](http://www.mediafire.com/download.php?nwwqmzywfom)

这是客户端和服务器的下载（它们是netbeans项目）

对不起我乱七八糟的代码=[

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T16:23:34.117

如果没有其余代码，这很难调试，所以我将发布我的第一个版本并尝试一下。你为什么在你的流上调用 .reset() ？这会将流中的读取位置移回开始，这不是我想要的（从未使用过 ObjectInputStream）。

* * *

好的，我拿了你的代码并修改了一些小东西，以便它可以编译，并且它对我有用 .reset()。看起来你在那里做的是对的。

如果没有其余的代码，我认为我无法提供更多帮助。对不起。

PS：我假设您拥有您发布的代码所没有的可序列化、实现可运行等内容。但是如果你没有设置这些东西，那么你的代码一开始就不会编译。

* * *

在弄乱您的代码 45 分钟后，我无法让错误发生。我不得不在这里和那里修改一些东西才能让它运行（因为它缺少一两个类和上面的一些代码），但我认为我没有改变它（很多）。我不确定我的更改会影响什么，这有点难以知道。

关于发生了什么，我有两个猜测。第一个将再次成为 .reset() 的事情。如果您还没有对此发表评论，请查看是否有任何区别。

因此，在忽略这一点的情况下，我将对这里发生的事情进行不同的尝试。

```
java.io.StreamCorruptedException: invalid type code: 00 
```

我猜 00 可能是一个提示。我的理解是应该发送一个签名字节（作为对象就是你所说的那样的证明，所以字符串不会被解释为双精度数或 PacManGameUI），显然 Java 不高兴，因为它是错误的。

但是为什么是00？这是一个有趣的值。我的猜测（这是一个很大的猜测）是整数的第一个字节（使用 ObjectOutputStream.writeInt() 发送时为 4 个字节）。也许您在输入流上调用 .readObject 之前发送了一个未被读取的整数？我不确定这是否会导致错误，但这是我最好的猜测。

在这种情况下，有两件事要做。首先是减少事情。制作两个小类文件，它们除了启动线程之外什么都不做，这些线程以缩减的方式（没有所有游戏管理的东西）相互通信，但使用相同的流程和逻辑。看看你是否可以在那里重新创建错误。

另一种方法（如果你敢的话，这将更有启发性）是使用[WireShark](http://www.wireshark.org)或[tcpdump](http://openmaniak.com/tcpdump.php)之类的东西来监听两个程序部分之间的对话。这将让您看到您发送的原始字节。虽然这可能会令人困惑且难以解释，但它应该可以轻松确定您是否发送了错误的对象。发送一个 int 大概需要 4 个字节，但是发送一个大的结构需要更多。通过实验，你应该能够弄清楚。这很痛苦，但它会让你*确切地*知道正在发送什么。

可能很难窥探环回接口（当计算机与自己对话时），至少在带有 WireShark 的 Windows 上（我不记得这很容易），所以用两台计算机（一台作为服务器，一个作为客户端），因此您可以轻松查看数据包。

再次抱歉，我无法提供更多帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:27:15.167

多线程需要同步。您是否使用同步流（或自己同步对流的访问）？

**更新：**给出的代码示例很可能从多个线程中调用。如果多个线程访问同一个流，则很可能会发生类似您遇到的错误。

我建议看看[http://java.sun.com/docs/books/tutorial/essential/concurrency/sync.html](http://java.sun.com/docs/books/tutorial/essential/concurrency/sync.html)。

通过将方法/类标记为同步，运行时将确保此方法/类将在不超过 1 个线程中同时处于活动状态。这实际上是一个庞大而困难的话题，因此请花一些时间学习基础知识并确保您了解基本问题。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T16:30:49.063

也许有点离题，但[javagaming.org](http://www.javagaming.org/)有一个“在线游戏开发和网络”部分。您可能也想检查一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T08:56:30.040

我可以问一下，如果第二个客户可以加入，您期望会发生什么？您没有存储该 Thread 对象的引用，当发生另一次迭代时，该对象不再具有引用，因此 JRE 会销毁该对象，不是吗？

```
while (true)
{
    System.out.println("Waiting for conneciton on port " + port);
    Socket client = listener.accept();
    System.out.println("Accepted a connection from: " + client.getInetAddress());
    Thread t = new Thread(new PacManServerThread(client, game));
    t.start();
} 
```

当然你需要做类似的事情

```
myGenericArray.add(t); 
```

在循环结束时，否则一旦对象在循环中失去作用域，它就会被破坏？

# javascript - jQuery：取消绑定事件处理程序以稍后再次绑定它们

> ID：516265
> 
> 赞同：40
> 
> 时间：2009-02-05T15:07:35.643
> 
> 标签：javascript, jquery, events

有谁知道如何取消绑定一组事件处理程序，但记住它们以便以后再次绑定它们？有什么建议么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-05T17:49:29.870

该项目的数据中有一个事件元素。这应该让你开始，你可以在解除绑定之前读取你的元素并将处理程序存储在一个数组中。如果您需要更多帮助，请发表评论。我从阅读 $.fn.clone 方法中得到了这个想法，所以也看一下。

```
$(document).ready(function() {
    $('#test').click(function(e) {
        alert('test');
        var events = $('#test').data("events");
        $('#test').unbind('click', events.click[0]);
    });
});

<a id="test">test</a> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-07-17T12:10:10.627

以下是如何实现这一点，提供了一个`storeEvents`和一个`restoreEvents`关于选择的方法。`storeEvents`在调用它的那一刻拍摄事件的快照。`restoreEvents`恢复到上一个​​以前的快照。可能需要稍微扭曲它以在恢复时参数化取消绑定，也许您希望在最后一个快照之后保留绑定事件。

```
(function($){

    function obj_copy(obj){
            var out = {};
        for (i in obj) {
            if (typeof obj[i] == 'object') {
                out[i] = this.copy(obj[i]);
            }
            else
                out[i] = obj[i];
        }
        return out;
    }

    $.fn.extend({

        storeEvents:function(){
            this.each(function(){
                $.data(this,'storedEvents',obj_copy($(this).data('events')));
            });
            return this;
        },

        restoreEvents:function(){
            this.each(function(){
                var events = $.data(this,'storedEvents');
                if (events){
                    $(this).unbind();
                    for (var type in events){
                        for (var handler in events[type]){
                            $.event.add(
                                this, 
                                type, 
                                events[type][handler], 
                                events[type][handler].data);
                        }
                    }
                }
            });
            return this;
        }

    });
})(jQuery); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-04-05T20:45:21.107

由于 jQuery 1.4.2+ 改变了事件处理程序的存储方式，这似乎是相关的：

我发现最好的方法是使用事件命名空间：

```
var ary_handlers = [ fn_highlight, fn_onpress, fn_cleanup ];
for ( idx = 0; idx < ary_handlers.length; idx++ ){
  $('#test').bind('click.foobar',ary_handlers[idx]);
}

// and then later: 
$('#test').unbind('.foobar'); 
```

在上面的示例中，所有 foobar 事件都未绑定。请注意，如果您需要更精细的控制，您可以命名每个点击处理程序并关联到您的处理程序数组：

```
var ary_handlers = [ fn_highlight, fn_onpress, fn_cleanup ];
for ( idx = 0; idx < ary_handlers.length; idx++ ){
  $('#test').bind('click.ns_' + String(idx), ary_handlers[idx]);
}

// and then later you could pick off a specific one to unbind
$('#test').unbind('.ns_2'); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-05T20:38:00.767

有一个名为[Copy Events](https://plugins.jquery.com/copyevents/)的 jQuery 插件，它将事件从一个对象复制到另一个对象。这可以很容易地用于从一个元素“保存”事件并稍后将它们带回来。只有一个选择:)

编辑：修复断开的链接

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T15:24:40.647

为了解除绑定事件处理程序，您需要将处理程序函数传递给 unbind()。所以你已经有了处理函数，你所要做的就是记住它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-07T08:52:09.470

您可以使用以下**`event.handler`**参数：

```
$(document).ready(function() {
    $('#test').click(function(e) {
        e.preventDefault();
        alert('test');
        $('#test').unbind('click', e.handler);
        //Do Something...
        $('#test').click();
    });
});

<a id="test">test</a> 
```

`event.handler`返回接收到事件的当前处理程序，因此通过省略它可以保留其他处理程序。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2012-06-29T04:46:49.117

Nick Craver 似乎对 jQuery 1.4.2+ 有[正确的答案](https://stackoverflow.com/a/2519061/39396)。他还包括一个有用的[小提琴](http://jsfiddle.net/968jj/)。他的解决方案允许您检索附加到 jQuery 元素的所有事件处理程序，并确定它们附加到哪个处理程序。

# java - 单击html元素时如何从jsp调用java方法？

> ID：516267
> 
> 赞同：4
> 
> 时间：2009-02-05T15:07:46.000
> 
> 标签：java, jsp

正如标题所说，当单击某个元素（例如锚点）时，如何从 jsp 调用 java 类方法？（无需重新加载页面）

如果可以做到这一点，我如何传递该方法，调用它的页面的某些部分 html 代码？

我在 Jboss AS 上使用 jsp、servlets、javascript、struts2 和 java。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T15:20:24.697

您要做的是在单击所述元素时让 javascript 触发 AJAX 请求。此 AJAX 请求将发送到服务器，然后该服务器可以调用您想要的任何 Java 代码。

现在您可以自己构建这一切，也可以使用许多现成的解决方案之一。我建议在 Google 上搜索 JSP Ajax 标记库。像这个[http://ajaxtags.sourceforge.net/](http://ajaxtags.sourceforge.net/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T15:24:59.570

正如[Marko 指出的那样](https://stackoverflow.com/questions/516267/how-to-call-a-java-method-from-a-jsp-when-a-html-element-is-clicked/516293#516293)，您可能需要阅读更多关于 Web 编程中客户端/服务器分离的内容。如果您想要一个框架来帮助您从 Javascript 进行远程 Java 调用，请查看[DWR](http://directwebremoting.org/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-03-06T05:58:46.503

您可以使用 Ajax 调用来执行此操作。现在，当单击 HTML 对象时，调用 java 脚本。然后在 JavaScript 中对 servlet 进行 Ajax 调用，如下所示

```
 $.get("Query?ID="+id ,function(RespValue) 
         {

} 
```

这里 Query 是我在 web.xml 中定义的 servlet 映射，Id 是我传递的参数，您也可以发送多个参数。RespValue 是 servlet 返回的响应值。在servelt 中编写一个do Get 方法并执行您的java 代码。如果要返回一些值，请使用函数（RespValue），否则将其删除。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T15:13:29.500

您无法在客户端浏览器中执行服务器端 java 代码。

您可以做的是执行新的 http 请求，该请求将在服务器上执行一些操作并返回操作结果。

鉴于问题的语气，最好阅读一些 JSP 教程。没有论坛帖子答案会更好地解释它。

# xhtml - 透明div问题

> ID：516283
> 
> 赞同：0
> 
> 时间：2009-02-05T15:11:11.627
> 
> 标签：xhtml, css

嘿，我有这个显示为弹出窗口的 div：

```
<div class="popup">
</div> 
```

然后使用 jquery 我添加另一个类给它与该类关联的 css、位置、大小、颜色和透明度：

```
.show {
    position: absolute;
    color: #F4F5F6;
    width: 600px;
    margin-left: -300px;
    height:300px;
    background: #000000;
    left:50%;
    top:200px;

    filter:alpha(opacity=95); 
    -moz-opacity: 0.95; 
    opacity: 0.95;
} 
```

我的问题是这样的：

我正在向 div 添加文本和图像。

最终像：

```
<div class="popup show">
    <div class="image">
      <img scr="blabla.png">
    </div>
    <div class="text">
      ble ble ble
    </div>
</div> 
```

我的问题如下，即使我在这里覆盖了不透明度：

```
div.image
{
    position: relative;
    float:left;
    width:202;
    height:402;
    filter:alpha(opacity=100); 
        -moz-opacity: 1; 
        opacity: 1; 
} 
```

图像仍然具有透明度。

无论如何都可以覆盖不透明度值而不必将图像 div 放在弹出 div 之外？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T15:12:43.277

试试这个：

```
div.image
{
position: relative;
float:left;
width:202;
height:402;
filter:alpha(opacity=100) !important; 
    -moz-opacity: 1 !important; 
    opacity: 1 !important; 
} 
```

[http://www.w3.org/TR/CSS2/cascade.html#important-rules](http://www.w3.org/TR/CSS2/cascade.html#important-rules)

编辑：对不起；我什至以前遇到过这个，但没有树枝。我认为嵌套元素的最大不透明度与外部元素的不透明度相同；你永远不会比你的父元素更不透明！最后我检查了这是一个正确的 CSS 问题，但我不知道解决方法。

作为一种解决方法，您可以尝试不进行嵌套，而是使用一些 ucnning 定位技巧。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T15:29:42.103

由于 '.show' 类的不透明度为 95%，因此它的所有后代也是如此。这很不幸，但这就是不透明度的工作原理。只要他们仍然是真正的后代，后代就无法克服他们祖先的不透明。

您必须使用半透明 png 设置“.show”背景，或者将结果设置为一些尴尬的 html（请参阅：[透明元素内的非透明元素](http://css-tricks.com/non-transparent-elements-inside-transparent-elements/)）

不想生涩，但[这个谷歌搜索](http://www.google.com/search?hl=en&q=css+opacity+child+element&btnG=Search&aq=1&oq=css+opacity+chil)（或类似的东西）可能会有所帮助

# java - Java中“this”的使用

> ID：516291
> 
> 赞同：8
> 
> 时间：2009-02-05T15:13:16.973
> 
> 标签：java, this, variable-assignment

如果我写以下课程：

```
public class Example {

      int j;
      int k;

      public Example(int j, int k) {
           j = j;
           k = k;
      }

      public static void main(String[] args) {
           Example exm = new Example(1,2);
           System.out.println(exm.j);
           System.out.println(exm.k);
      }

} 
```

程序可以编译，但是当我运行程序时，main方法会打印出两个0。我知道，为了说我想在构造函数中初始化实例变量，我必须写：

```
this.j = j;
this.k = k; 
```

但是如果我不写它，那么在构造函数中（在表达式的左侧和写手侧）评估（或考虑）哪个变量？是参数还是实例变量？这有什么不同吗？

是否还有其他`this`必须使用的情况？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-05T15:17:05.187

如果你的构造函数中没有写“this.variable”，并且如果你的构造函数中有一个与你的字段变量同名的局部变量（包括函数参数），那么会考虑局部变量；局部变量遮蔽了字段（又名类变量）。

一个地方，“这个”是唯一的出路：

```
class OuterClass {
  int field;

  class InnerClass {
    int field;

    void modifyOuterClassField()
    {
      this.field = 10; // Modifies the field variable of "InnerClass"
      OuterClass.this.field = 20; // Modifies the field variable of "OuterClass",
                                  // and this weird syntax is the only way.
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-05T15:18:30.380

如果您只`j`在构造函数中说，那么编译器会认为您在这两种情况下都指的是参数。所以

```
j = j; 
```

只需将参数的值分配给`j`参数`j`（这是一个非常没有意义但仍然有效的语句）。

因此，为了消除歧义，您可以添加前缀`this.`以明确表示您的意思是具有相同名称的成员变量。

的另一个用途`this`是当您需要将对当前对象的引用传递给某个方法时，例如：

```
someObject.addEventListener(this); 
```

在此示例中，您需要将当前对象作为一个整体来引用（而不仅仅是对象的一个​​成员）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-05T15:16:15.657

如果你不写这个，那么你将参数分配给它自己；参数变量隐藏实例变量。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-05T15:17:08.243

当您想要返回对象本身时，这很有用

```
return this; 
```

这很有用，因为如果一个类具有例如 Method1() 和 Method2()，两者都返回 this，则允许您编写如下调用

```
object.Method1().Method2() 
```

同样在方法内部，在调用期间将对象本身传递给另一个函数也很有用。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-05T15:30:44.690

另一种有用的方法（虽然很少使用）是声明方法参数 final：

以下块将不会编译，因此会立即提醒您注意错误：

```
 public Example(final int j, final int k) {
       j = j;
       k = k;
  } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-05T15:17:16.683

在您的构造函数代码中，您正在为自己分配变量。'j' 是在构造函数的参数中指定的 j。即使它是上面定义的类变量 j，那么您仍然在说“j = j”......即 j 不会在左侧和右侧进行不同的评估。

```
 public Example(int j, int k) {
       this.j = j;
       this.k = k;
  } 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-05T15:21:12.417

您所遇到的称为[变量阴影](http://en.wikipedia.org/wiki/Variable_shadowing)。查看此概述，了解[Java 中不同类型的变量](http://leepoint.net/notes-java/data/variables/45local-inst-class.html)。

一般来说：Java 编译器使用它可以找到的最近的变量进行赋值。在一个方法中，它会首先尝试找到一个局部变量，然后将搜索的焦点扩大到类和实例变量。

我个人认为好的（其他人不喜欢它）的一个习惯是在成员变量前面加上 m_ 并为不改变其值的 CONSTANT_VARIABLES 使用大写。故意使用变量阴影的代码非常（！）难以调试和使用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-05T15:18:37.803

您在示例中将参数分配给自身。

更一般地说：如果您没有为变量添加范围，则假定当前范围 - 这是您的情况下的函数。'this.j' 告诉 jre 在对象范围内使用变量 j - 对象的成员变量。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-05T15:19:21.563

就像罗伯特格兰特所说的那样，'this' 是您明确表示您指的是成员变量而不是局部变量的方式。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-06T07:01:29.350

要[使用方法回答您关于此的后续问题](https://stackoverflow.com/questions/516291#516435)，Srikanth 提到的[内部类仍然是使用此方法的有效示例：（](https://stackoverflow.com/questions/516291#516310)这次使用方法）

```
public class OuterClass
{
    void f() {System.out.println("Outer f()");};
    class InnerClass {
        void f() {
            System.out.println("Inner f()");
            OuterClass.this.f();
        }
    }
} 
```

[匿名类](http://mindprod.com/jgloss/anonymousclasses.html)也有同样的情况：

> 您可以通过以下方式引用外部类的方法：
> 
> *   `MyOuterClass.this.yOuterInstanceMethod()`,
> *   `MyOuterClass.myOuterInstanceMethod()`,
> *   或者只是`myOuterInstanceMethod()` ***如果没有歧义***。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-03T12:14:37.380

为避免这种情况，请使用 IDE（如 Eclipse），它会在这种情况下生成警告。

另外，除非绝对不可能，否则请使您的字段成为最终字段。这样做的原因有很多（除了这个）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-06T07:29:20.077

这并不能完全回答您的问题，但如果您使用 Eclipse，您可能会发现“分配无效”设置很有用。我相信这也会出现在其他 IDE 中。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-07-03T11:02:11.360

您可能想看看[强制显式指针](https://stackoverflow.com/questions/910020/what-is-the-advantage-of-having-this-self-pointer-mandatory-explicit)[有什么好处？`this/self`](https://stackoverflow.com/questions/910020/what-is-the-advantage-of-having-this-self-pointer-mandatory-explicit)
尽管`this`正如您所注意到的，在 Java 中使用不是强制性的，但我相信它也会对`this`在 Java 中使用的主题有所启发。

# wpf - WPF 绑定来自 L2S 的关系组合框，并过滤所有这些组合框

> ID：516297
> 
> 赞同：0
> 
> 时间：2009-02-05T15:13:59.827
> 
> 标签：wpf, linq-to-sql, data-binding, filtering

在带有 Linq to SQL 的 WPF 项目中，如果您使用 O/R - 设计器创建一个简单的结构，其中 3 个都与 forgin 键关系相关联，如下所示：

客户 <-- 订单 <-- 项目，并说我想要一个带有 3 个同步组合框的简单窗口，当您选择客户时，您只会看到他的订单，而当您选择订单时，您只会看到该订单的项目。这一切都很简单......

可以说我想为所有组合框添加过滤功能。如果我想使用 LINQ dbml 文件中的实体对象，我该怎么做？

编辑 - 详细说明过滤。我想过滤内存中的集合而不需要再次查询数据库，过滤器可以是组合框上方的文本框，没关系，我的问题是我无法过滤组合框，因为它们绑定到 EntitySet通过L2S，不实施过滤。

谢谢，埃里克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T19:34:59.660

我会考虑使用 CollectionViewSource。Bea Stollnitz 在[这里](http://www.beacosta.com/blog/?p=17)有一个很好的入门知识，我用[这篇博](http://sandyvalley.spaces.live.com/Blog/cns!AB1484B25F28E501!461.entry)文向我展示了如何过滤。这将使您无需使用数据库即可进行过滤和排序，而且速度非常快。

# compilation - 函数式语言天生就慢吗？

> ID：516301
> 
> 赞同：49
> 
> 时间：2009-02-05T15:14:40.417
> 
> 标签：compilation, functional-programming

为什么函数式语言在基准测试中总是落后于 C？如果您有静态类型的函数式语言，在我看来，它可以编译为与 C 相同的代码，或者甚至更优化的代码，因为编译器可以使用更多语义。为什么看起来所有函数式语言都比 C 慢，为什么它们总是需要垃圾收集和过度使用堆？

有谁知道适用于嵌入式/实时应用程序的功能语言，其中内存分配保持在最低限度并且生成的机器代码精简且快速？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2012-06-05T17:07:54.517

> 函数式语言天生就慢吗？

从某种意义上说，是的。他们需要的基础设施不可避免地增加了理论上可以使用手工汇编程序实现的开销。特别是，一流的词法闭包只适用于垃圾收集，因为它们允许值超出范围。

> 为什么函数式语言在基准测试中总是落后于 C？

首先，谨防选择偏差。C 作为基准套件中的最低公分母，限制了可以完成的工作。如果你有一个比较 C 和函数式语言的基准，那么它几乎可以肯定是一个非常简单的程序。可以说如此简单，以至于在今天几乎没有实际意义。仅使用 C 作为基准来解决更复杂的问题实际上是不可行的。

最明显的例子是并行性。今天，我们都有多核。甚至我的手机也是多核的。众所周知，多核并行在 C 语言中很困难，但在函数式语言中却很容易（我喜欢 F#）。其他示例包括任何受益于持久数据结构的东西，例如，撤消缓冲区对于纯函数式数据结构来说是微不足道的，但在 C 等命令式语言中可能是大量工作。

> 为什么看起来所有函数式语言都比 C 慢，为什么它们总是需要垃圾收集和过度使用堆？

函数式语言看起来会更慢，因为你只会看到比较容易用 C 编写好的代码的基准测试，而你永远不会看到比较函数式语言开始表现出色的更复杂任务的基准测试。

但是，您已经正确地确定了当今函数式语言的最大瓶颈可能是什么：它们的分配率过高。干得好！

函数式语言分配如此繁重的原因可以分为历史原因和固有原因。

从历史上看，Lisp 实现已经做了*很多*拳击50年了。这种特性传播到许多其他使用类似 Lisp 的中间表示的语言。多年来，语言实施者一直在使用拳击作为解决语言实施复杂性的快速解决方案。在面向对象的语言中，默认设置总是堆分配每个对象，即使它显然可以被堆栈分配。然后效率的负担被推到了垃圾收集器上，并且已经投入了大量精力来构建垃圾收集器，这些垃圾收集器可以达到接近堆栈分配的性能，通常是通过使用凹凸分配的 Nursery 生成。我认为应该投入更多的精力来研究功能语言设计，以最大限度地减少装箱和垃圾收集器设计，这些设计针对不同的需求进行了优化。

分代垃圾收集器非常适合堆分配很多的语言，因为它们几乎可以与堆栈分配一样快。但它们在其他地方增加了大量的间接费用。今天的程序越来越多地使用队列之类的数据结构（例如，用于并发编程），这些数据结构给分代垃圾收集器带来了病态的行为。如果队列中的项目超过第一代，那么它们都被标记，然后它们都被复制（“撤离”），然后对其旧位置的所有引用都得到更新，然后它们就有资格被收集。这比它需要的速度慢了大约 3 倍（例如，与 C 相比）。标记区域收集器，例如[Beltway](http://people.cs.umass.edu/~moss/papers/pldi-2002-beltway.pdf) (2002) 和[Immix](http://users.cecs.anu.edu.au/~steveb/pubs/papers/immix-pldi-2008.pdf)（2008）有可能解决这个问题，因为托儿所被一个可以像托儿所一样被收集的区域所取代，或者，如果它包含大部分可到达的值，它可以被另一个区域取代，并一直老化直到它包含大部分无法访问的值。

尽管 C++ 已经存在，Java 的创建者还是犯了对泛型采用类型擦除的错误，导致不必要的装箱。例如，[我对一个简单的哈希表进行了基准测试，它在 .NET 上的运行速度比 JVM 快 17 倍，](http://fsharpnews.blogspot.co.uk/2010/05/java-vs-f.html)部分原因是 .NET 没有犯这个错误（它使用了具体化的泛型），也因为 .NET 具有值类型。我实际上责怪 Lisp 让 Java 变慢了。

所有现代函数式语言实现都继续过度装箱。Clojure 和 Scala 等基于 JVM 的语言几乎没有选择余地，因为它们所针对的 VM 甚至无法表达值类型。OCaml 在其编译过程的早期就丢弃类型信息，并在运行时使用标记整数和装箱来处理多态性。因此，OCaml 经常将单个浮点数装箱并且总是将元组装箱。例如，OCaml 中的三个字节由一个指针（其中嵌入一个隐式 1 位标记，在运行时重复检查）表示，该指针指向一个具有 64 位标头和 192 位主体的堆分配块，其中包含三个标记的 63 位整数（其中 3 个标记再次在运行时重复检查！）。这显然是疯了。

在函数式语言的拆箱优化方面已经做了一些工作，但从未真正获得关注。例如，标准 ML 的 MLton 编译器是一个全程序优化编译器，它进行了复杂的拆箱优化。可悲的是，它早于它的时代，而且“长”的编译时间（在现代机器上可能不到 1 秒！）阻止了人们使用它。

打破这一趋势的唯一主要平台是 .NET，但令人惊讶的是，这似乎是个意外。尽管`Dictionary`对值类型的键和值进行了非常优化的实现（因为它们是未装箱的），但像 Eric Lippert 这样的微软员工继续[声称值类型的重要之处在于它们的按值传递语义](http://blogs.msdn.com/b/ericlippert/archive/2010/09/30/the-truth-about-value-types.aspx)而不是源自其未装箱的内部表示的性能特征。Eric 似乎被证明是错误的：更多的 .NET 开发人员似乎更关心拆箱而不是按值传递。实际上，大多数结构是不可变的，因此是引用透明的，因此按值传递和按引用传递之间没有语义差异。性能是可见的，结构可以提供巨大的性能改进。结构的性能甚至节省了堆栈溢出，结构用于避免商业软件中[的 GC 延迟，如 Rapid Addition](http://download.microsoft.com/download/9/9/C/99CA11E6-774E-41C1-88B5-09391A70AF02/RapidAdditionWhitePaper.pdf)！

函数式语言大量分配的另一个原因是固有的。像哈希表这样的命令式数据结构在内部使用巨大的整体数组。如果这些是持久的，那么每次进行更新时都需要复制巨大的内部数组。因此，像平衡二叉树这样的纯功能数据结构被分割成许多小的堆分配块，以便于从一个版本的集合到下一个版本的重用。

当像字典这样的集合只在初始化期间写入，然后从很多地方读取时，Clojure 使用了一个巧妙的技巧来缓解这个问题。在这种情况下，初始化可以使用变异来构建“幕后”结构。但是，这对增量更新没有帮助，并且生成的集合仍然比它们的命令式等价物读起来慢得多。从好的方面来说，纯函数式数据结构提供持久性，而命令式数据结构则没有。然而，很少有实际应用程序从实践中的持久性中受益，因此这通常不是有利的。因此，对不纯函数式语言的渴望，你可以毫不费力地使用命令式风格并从中获益。

> 有谁知道适用于嵌入式/实时应用程序的功能语言，其中内存分配保持在最低限度并且生成的机器代码精简且快速？

如果您还没有，请看一下 Erlang 和 OCaml。两者对于内存受限的系统都是合理的，但都不会生成特别好的机器代码。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-05T15:37:31.573

没有什么是天生的。这是一个示例，其中[*解释*的OCaml 比等效的 C 代码运行得更快](http://scienceblogs.com/goodmath/2006/11/02/the-c-is-efficient-language-fa/ "“C 是有效的”语言谬误")，因为由于语言的差异，OCaml 优化器具有不同的可用信息。当然，笼统地声称 OCaml 绝对比 C 快是愚蠢的。关键是，这取决于你在做什么，以及你是如何做的。

也就是说，[OCaml](http://caml.inria.fr/ocaml/index.en.html)是一种（主要是）函数式语言的一个例子，它实际上是为[性能](http://groups.google.com/group/comp.ai.genetic/msg/0e6338ae12f1f653 "OCaml 中的 Eratosthenes 筛选和优化的 C")而设计的，而不是纯粹的。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-05T15:21:25.787

函数式语言需要消除在语言抽象级别可见的可变状态。因此，需要复制将通过命令式语言就地突变的数据，而突变发生在副本上。举个简单的例子，请参阅 Haskell 与 C 中的快速排序。

此外，垃圾收集是必需的，因为`free()`它不是纯函数，因为它有副作用。因此，在语言抽象级别释放内存且不涉及副作用的唯一方法是垃圾收集。

当然，原则上，足够智能的编译器可以优化大部分复制。这已经在某种程度上完成了，但是让编译器足够聪明以理解你的代码在那个级别的语义是很困难的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-05T15:27:23.123

过程语言的控制流更好地匹配现代计算机的*实际*处理模式。

C 非常紧密地映射到其编译产生的汇编代码，因此有“跨平台汇编”的绰号。计算机制造商花了几十年的时间使汇编代码尽可能快地运行，因此 C 继承了所有这些原始速度。

相比之下，函数式语言的无副作用、固有的并行性根本不能很好地映射到单个处理器上。调用函数的任意顺序需要序列化到 CPU 瓶颈：如果没有非常聪明的编译，你将一直在进行上下文切换，任何预取*都*不会起作用，因为你一直在跳跃到处都是，...基本上，计算机制造商为漂亮的、可预测的过程语言所做的所有优化工作都毫无用处。

然而！随着转向许多功能较弱的内核（而不是一两个涡轮增压内核），函数式语言*应该*开始缩小差距，因为它们自然地水平扩展。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-05T15:29:15.117

C 速度很快，因为它基本上是一组用于汇编程序的宏 :) 当您在 C 中编写程序时，没有“幕后”。当您决定是时候分配内存并以同样的方式释放时，您会分配内存。当您编写实时应用程序时，这是一个巨大的优势，其中可预测性很重要（实际上比其他任何事情都重要）。

Also, C compilers are generally extremly fast because language itself is simple. It even doesn't make any type checkings :) This also means that is easier to make hard to find errors. Ad advantage with the lack of type checking is that a function name can just be exported with its name for example and this makes C code easy to link with other language's code

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-02-05T15:20:53.883

简短的回答：因为 C 很快。就像，*快得惊人的疯狂*。一种语言根本不必“慢”就可以让 C 把它交给它。

C 语言之所以快，是因为它是由真正伟大的程序员创建的，而 gcc 已经在数十年的时间里进行了优化，并且比 99% 的语言都多出数十名优秀的程序员。

简而言之，除了需要非常特定的函数式编程结构的特殊任务之外，您不会击败 C。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-05T15:53:40.573

好吧，Haskell 仅比 GCC 的 C++ 慢 1.8 倍，后者在典型的基准测试任务中比 GCC 的 C 实现要快。这使得 Haskell 非常快，甚至比 C#（即 Mono）还要快。

相对语言速度

*   1.0 C++ GNU g++
*   1.1 C GNU gcc
*   1.2 ATS
*   1.5 Java 6-服务器
*   1.5 清洁
*   1.6 帕斯卡 自由帕斯卡
*   1.6 Fortran 英特尔
*   1.8 Haskell GHC
*   2.0 C# 单声道
*   2.1 斯卡拉
*   2.2 艾达 2005 GNAT
*   2.4 Lisp SBCL
*   3.9 Lua LuaJIT

[资源](http://shootout.alioth.debian.org/u32/benchmark.php?test=all&lang=all)

作为记录，我在 iPhone 上使用 Lua 进行游戏，因此如果您愿意，您可以轻松使用 Haskell 或 Lisp，因为它们更快。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-05T15:21:10.980

就目前而言，函数式语言并没有大量用于行业项目，因此没有足够认真的工作投入到优化器中。此外，为命令式目标优化命令式代码可能更容易。

函数式语言有一项壮举可以让它们现在很快超越命令式语言：微不足道的并行化。

微不足道不是因为它很容易，而是它可以内置到语言环境中，而开发人员不需要考虑它。

对于许多项目来说，使用与线程无关的语言（如 C）中强大的多线程的成本是令人望而却步的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-05T15:25:59.863

我不同意tuinstoel。重要的问题是，当函数式语言用于本应使用的函数式语言时，它是否能提供更快的开发时间并产生更快的代码。请参阅[Wikipedia 上的效率问题部分](http://en.wikipedia.org/wiki/Functional_programming#Efficiency_issues)，了解我的意思。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-05T15:31:37.340

更大的可执行文件大小的另一个原因可能是惰性评估和非严格性。编译器无法在编译时确定某些表达式何时被评估，因此一些运行时被填充到可执行文件中来处理这个（调用所谓的*thunks*的评估）。至于性能，懒惰既好也坏。一方面它允许额外的潜在优化，另一方面代码大小可以更大，程序员更有可能做出错误的决定，例如参见 Haskell 的*foldl* vs. *foldr* vs. *foldl'* vs. *foldr'*。

# bash - 使用 Makefile 中的通用目标进行 make 的 Bash 完成

> ID：516305
> 
> 赞同：2
> 
> 时间：2009-02-05T15:15:38.420
> 
> 标签：bash, makefile, gnu-make, bash-completion

我有一个 Makefile，我的大部分目标都是通过固定序列创建的。似乎 bash 完成只建议正常目标的完成，例如

```
target_name:
        #$@ 
```

而不是通用目标。有没有办法让 bash 完成所有目标，即使它们没有像上面的例子那样明确？更具体地说，假设我定义了一个目标名称列表，并执行以下操作：

```
list=target1 target2
$(list):
        #$@ 
```

有什么方法可以使这些目标可用于 bash 完成？或者，甚至更高级，假设我有两个列表，并且我希望目标由两个列表中元素的所有可能组合组成。我也可以将这些目标用于 bash 完成吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T16:09:54.207

```
$ 制作-qp | grep '^[^.#].*:'
全部：bin1 bin2 bin3
bin1: obj1.o obj2.o obj3.o
obj1.o：obj1.c obj1.h
...
$ 制作-qp | sed -n -e 's/^\([^.#[:space:]][^:[:space:]]*\): .*/\1/p'
全部
bin1
对象1.o
...
```

`-q`阻止 Make 实际运行任何东西，并`-p`要求它转储其数据库。

然后您需要做的就是编写并注册一个[完成函数](http://www.gnu.org/software/bash/manual/bashref.html#Programmable-Completion)（[示例](http://freshmeat.net/projects/bashcompletion/)）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T16:04:37.807

没有可行的解决方案，AFAIK。

这个命令：

```
make -qsp 2>/dev/null | egrep '^[^#%\.=]*:[^=]' | awk -F ': ' '{ print $2}' 
```

将扩展您的 makefile 目标。

你可以尝试将它添加到你的`/etc/bash_competion`.，但我认为它需要进一步调试以应对更复杂的情况。

# .net - 关于GetHashCode实现的问题

> ID：516309
> 
> 赞同：3
> 
> 时间：2009-02-05T15:16:52.223
> 
> 标签：.net, performance, clr

[http://msdn.microsoft.com/en-us/library/system.object.getashcode(VS.80).aspx](http://msdn.microsoft.com/en-us/library/system.object.gethashcode(VS.80).aspx)说：

> 为了获得最佳性能，散列函数必须为所有输入生成随机分布。

它是否对性能有任何影响，或者可以使用不提供“随机分布”但不会导致更多冲突的函数（如 return this.Id）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T15:19:45.837

`return this.Id`通常会很好（特别是如果`Id`它是不可变且唯一的） - 主要思想是避免冲突。但是，还要考虑待处理的数据 -`Id`您尚未保存的 27 行中的哪一行？

还要注意`GetHashCode`和`Equals`实现[必须一致](https://stackoverflow.com/questions/371328/why-is-it-important-to-override-gethashcode-when-equals-method-is-overriden-in-c)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:24:39.290

使用 this.Id 通常没问题。基础是您不希望有太多的冲突最终出现在同一个*bucket*中。桶号通常通过获取哈希码并将其视为“mod x”来获得，其中 x 是哈希表中的桶数，通常是素数（或可能的素数）。

如果您只是使用增加的 ID（1、2、3、4...），就桶分布而言，这最终会变得非常随机。只有当您的 ID 遵循一种模式，该模式很可能为您需要担心的大量条目提供相同的存储桶编号。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T15:26:30.940

似乎措辞不佳......我认为他们的意思是哈希码应该“均匀分布”在**所有**可能的`int`值上（如果我错了，.net 专家请纠正我），这将有助于最大限度地减少冲突。

这是一个例子：假设我所有的哈希码都在 1 到 10 的范围内。如果我要使用哈希码来计算数组长度为 100 的数组索引，那么我最多只能得到 10 个不同的索引。这意味着我的数组利用率很低，我会遇到很多冲突。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T15:29:12.493

它可能对例如产生影响。根据高位散列​​到桶中的散列表（不常见）。此外，如果您的 id 都可以被 4 整除，那么这可能会使散列到存储桶中的哈希表`hash_code%buckets`仅每四个存储桶使用一次。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T15:37:03.010

我更喜欢使用

```
this.Id.GetHashCode(); 
```

我认为这使得哈希更有可能被正确分配，而不是直接使用 Id。

# django - Django：检索抽象派生模型

> ID：516313
> 
> 赞同：1
> 
> 时间：2009-02-05T15:17:22.020
> 
> 标签：django, django-models, abstract-class

[在对我之前的问题](https://stackoverflow.com/questions/515145/how-do-i-implement-a-common-interface-for-django-related-object-sets)得到很好的回答后，我遇到了另一个问题。

我遵循[第三种方法](https://stackoverflow.com/questions/515145/how-do-i-implement-a-common-interface-for-django-related-object-sets/515318#515318)，了解 djangodocs 对[抽象模型子类](http://docs.djangoproject.com/en/dev/topics/db/models/#id5)化的说法。

我正在使用最新的 Django，rev 9814。我得到的奇怪行为：

```
In [1]: o = Order()

In [2]: o.save()
DEBUG:root:STORING EVENT MESSAGE: Order created. pk=2 -- LEVEL TOP
DEBUG:root:Saving order pk=2 

# it actually does exist in the database, so everything's cool.

In [3]: o.id
Out[3]: 2L # huh?

In [4]: o._default_manager
Out[4]: <django.db.models.manager.Manager object at 0x16e5370>

In [5]: Order.objects.all()
Out[5]: []

# WTF? and even more WTF below:

In [6]: Order.objects.get(id=2) 
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Users/adam/_dev/cashfire/<ipython console> 

/opt/local/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/django/db/models/manager.py in get(self, *args, **kwargs)
     91 
     92     def get(self, *args, **kwargs):
---> 93         return self.get_query_set().get(*args, **kwargs)
     94 
     95     def get_or_create(self, **kwargs):

/opt/local/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/django/db/models/query.py in get(self, *args, **kwargs)
    333         """
    334         clone = self.filter(*args, **kwargs)
--> 335         num = len(clone)
    336         if num == 1:
    337             return clone._result_cache[0]

/opt/local/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/django/db/models/query.py in __len__(self)
    159                 self._result_cache = list(self._iter)
    160             else:
--> 161                 self._result_cache = list(self.iterator())
    162         elif self._iter:
    163             self._result_cache.extend(list(self._iter))

/opt/local/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/django/db/models/query.py in iterator(self)
    286             else:
    287                 # omit aggregates in object creation
--> 288                 obj = self.model(*row[index_start:aggregate_start])
    289 
    290             for i, k in enumerate(extra_select):

TypeError: __init__() takes exactly 1 argument (5 given) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T08:15:42.713

好吧，我的错（实用程序员的“不要再责怪 SQL”）。这正是 traceback 所说`__init__`的，忘记了 args 和 kwagrs。傻我。

# asp.net-mvc - 如何在 ASP.NET MVC RC 中进行验证？

> ID：516314
> 
> 赞同：3
> 
> 时间：2009-02-05T15:18:01.503
> 
> 标签：asp.net-mvc, validation

ASP.NET MVC 是否提供标准验证器功能，还是您必须手动创建自己的验证？如果是后者，是否有可用于 ASP.NET MVC Web 应用程序的第三方验证器？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T15:20:51.107

发布此答案后不久，我发现[xval](http://xval.codeplex.com/)是 ASP.NET MVC 的验证框架。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T15:30:17.267

ASP.NET MVC 包含类似`Html.ValidationSummary()`和`Html.ValidationMessage()`. 如果您使用`TryUpdateModel`. 您也可以手动验证并自己设置错误消息。[这](http://blog.maartenballiauw.be/post/2008/08/29/Form-validation-with-ASPNET-MVC-preview-5.aspx)是一个如何使用它的例子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T15:27:30.470

David Hayden在 www.codebetter.com 上[写了一篇文章，描述了一种处理验证的好方法。](http://codebetter.com/blogs/david.hayden/archive/2009/02/03/an-aha-moment-on-mvc-validation-extensibility-in-defaultmodelbinder-bye-to-idataerrorinfo.aspx)当然 xVal 是一种选择，但了解一下总是很棒的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T15:34:19.550

我实现了我在 Stephen Walther 的[博客](http://www.stephenwalther.com/blog/archive/2008/09/09/asp-net-mvc-application-building-forums-4-1-2-validation-revisited.aspx)上找到的代码的变体。我通过定义一个包含 GetRuleViolations() 方法的 IValidatedEntity 接口并实现调用 GetRuleViolations() 并在违规数量非零时引发自定义异常的部分 OnValidate 方法，将它与 LINQ2SQL 模型一起使用。在控制器中，这会在数据上下文的 SubmitChanges 上触发。如果我遇到异常，我会通过 GetRuleViolations() 方法重新查询模型以构建模型错误以传回视图。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-10T17:54:42.080

您还可以签出[.net 验证框架](http://www.codeplex.com/ValidationFramework)。它是一个规则框架，可让您创建验证器，将验证器应用于规则，将规则附加到模型，并在运行时在客户端和服务器上检查这些规则。它提供了灵活的方式来配置规则——大量使用 linq 来进行流畅和强类型的配置。它还提供了可扩展点来创建您自己的客户端脚本生成器和规则。

该框架利用 MVC RC HtmlHelpers 和默认约定。

如果您下载最新的源代码，您可以看到在 SplitBranch -> QSAspMvc 快速入门项目中工作的框架示例。它仍在积极开发中。

# proxy - 通过代理服务器的 HTTPS 连接

> ID：516323
> 
> 赞同：124
> 
> 时间：2009-02-05T15:20:35.227
> 
> 标签：proxy, https

是否可以通过代理服务器进行 HTTPS 连接？如果是，什么样的代理服务器允许这样做？

[与如何在 Apache HTTP Client 4 中使用 Socks 5 代理](https://stackoverflow.com/questions/22937983/how-to-use-socks-5-proxy-with-apache-http-client-4)重复？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-02-05T15:34:49.613

TLS/SSL（HTTPS 中的 S）保证您和您正在联系的服务器之间没有窃听者，即没有代理。通常，您使用[`CONNECT`](https://www.rfc-editor.org/rfc/rfc2616#section-9.9)通过代理打开 TCP 连接。在这种情况下，代理将无法缓存、读取或修改任何请求/响应，因此相当无用。

如果希望代理能够读取信息，可以采取以下方法：

1.  客户端启动 HTTPS 会话
2.  代理透明地拦截连接并返回一个临时生成的（可能是弱的）证书 K [a]，由客户端无条件信任的证书颁发机构签名。
3.  代理启动 HTTPS 会话到目标
4.  代理验证 SSL 证书的完整性；如果证书无效，则显示错误。
5.  代理流内容、解密并用 K [a重新加密]
6.  客户端显示东西

一个例子是 Squid 的[SSL bump](http://wiki.squid-cache.org/Features/SslBump)。[同样，可以配置](https://portswigger.net/burp/help/proxy_options_installingCAcert.html)burp来执行此操作。这也被[埃及 ISP 用于不太友好的环境中](http://arstechnica.com/security/2015/03/google-warns-of-unauthorized-tls-certificates-trusted-by-almost-all-oses/)。

请注意，现代网站和浏览器可以使用[HPKP](https://www.rfc-editor.org/rfc/rfc7469)或[内置证书引脚](https://www.imperialviolet.org/2011/05/04/pinning.html)来破坏这种方法。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2016-11-30T09:55:21.083

简短的回答是：这是可能的，并且可以使用特殊的 HTTP 代理或 SOCKS 代理来完成。

首先，HTTPS 使用 SSL/TLS，它通过在不安全的通道上建立安全的通信通道来确保端到端的安全性。如果 HTTP 代理能够看到内容，那么它就是中间人窃听者，这违背了 SSL/TLS 的目标。因此，如果我们想通过普通的 HTTP 代理进行代理，那么一定有一些技巧在发挥作用。

诀窍是，我们使用一个名为[`CONNECT`](https://en.wikipedia.org/wiki/HTTP_tunnel#HTTP_CONNECT_tunneling). 并非所有 HTTP 代理都支持此功能，但现在很多都支持。TCP 代理无法看到以明文形式传输的 HTTP 内容，但这不会影响它来回转发数据包的能力。这样，客户端和服务器就可以在代理的帮助下相互通信。这是代理 HTTPS 数据的安全方式。

还有一种不安全的做法，即 HTTP 代理成为中间人。它接收客户端发起的连接，然后发起另一个到真实服务器的连接。在实现良好的 SSL/TLS 中，客户端将被通知代理不是真正的服务器。因此，客户端必须通过忽略警告来信任代理才能正常工作。之后，代理只需解密来自一个连接的数据，重新加密并将其馈送到另一个连接。

最后，我们当然可以通过[SOCKS](https://en.wikipedia.org/wiki/SOCKS)代理来代理 HTTPS，因为 SOCKS 代理工作在较低级别。您可能认为 SOCKS 代理既是 TCP 代理又是 UDP 代理。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-05T15:56:07.853

据我记得，您需要在代理上使用 HTTP CONNECT 查询。这会将请求连接转换为透明的 TCP/IP 隧道。

所以你需要知道你使用的代理服务器是否支持这个协议。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-07-06T12:35:02.167

如果它仍然感兴趣，这里是一个类似问题的答案： [Convert HTTP Proxy to HTTPS Proxy in Twisted](https://stackoverflow.com/questions/3118602/convert-http-proxy-to-https-proxy-in-twisted/3186044#3186044)

要回答问题的第二部分：

> 如果是，什么样的代理服务器允许这样做？

开箱即用，大多数代理服务器将配置为仅允许 HTTPS 连接到端口 443，因此具有自定义端口的 https URI 将不起作用。这通常是可配置的，具体取决于代理服务器。例如，Squid 和 TinyProxy 支持这一点。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-09-03T07:56:00.083

这是我使用 SOCKS 代理同时支持 HTTP 和 HTTPS 请求的完整 Java 代码。

```
import java.io.IOException;
import java.net.InetSocketAddress;
import java.net.Proxy;
import java.net.Socket;
import java.nio.charset.StandardCharsets;

import org.apache.http.HttpHost;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.protocol.HttpClientContext;
import org.apache.http.config.Registry;
import org.apache.http.config.RegistryBuilder;
import org.apache.http.conn.socket.ConnectionSocketFactory;
import org.apache.http.conn.socket.PlainConnectionSocketFactory;
import org.apache.http.conn.ssl.SSLConnectionSocketFactory;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.impl.conn.PoolingHttpClientConnectionManager;
import org.apache.http.protocol.HttpContext;
import org.apache.http.ssl.SSLContexts;
import org.apache.http.util.EntityUtils;

import javax.net.ssl.SSLContext;

/**
 * How to send a HTTP or HTTPS request via SOCKS proxy.
 */
public class ClientExecuteSOCKS {

    public static void main(String[] args) throws Exception {
        Registry<ConnectionSocketFactory> reg = RegistryBuilder.<ConnectionSocketFactory>create()
            .register("http", new MyHTTPConnectionSocketFactory())
            .register("https", new MyHTTPSConnectionSocketFactory(SSLContexts.createSystemDefault
                ()))
            .build();
        PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager(reg);
        try (CloseableHttpClient httpclient = HttpClients.custom()
            .setConnectionManager(cm)
            .build()) {
            InetSocketAddress socksaddr = new InetSocketAddress("mysockshost", 1234);
            HttpClientContext context = HttpClientContext.create();
            context.setAttribute("socks.address", socksaddr);

            HttpHost target = new HttpHost("www.example.com/", 80, "http");
            HttpGet request = new HttpGet("/");

            System.out.println("Executing request " + request + " to " + target + " via SOCKS " +
                "proxy " + socksaddr);
            try (CloseableHttpResponse response = httpclient.execute(target, request, context)) {
                System.out.println("----------------------------------------");
                System.out.println(response.getStatusLine());
                System.out.println(EntityUtils.toString(response.getEntity(), StandardCharsets
                    .UTF_8));
            }
        }
    }

    static class MyHTTPConnectionSocketFactory extends PlainConnectionSocketFactory {
        @Override
        public Socket createSocket(final HttpContext context) throws IOException {
            InetSocketAddress socksaddr = (InetSocketAddress) context.getAttribute("socks.address");
            Proxy proxy = new Proxy(Proxy.Type.SOCKS, socksaddr);
            return new Socket(proxy);
        }
    }

    static class MyHTTPSConnectionSocketFactory extends SSLConnectionSocketFactory {
        public MyHTTPSConnectionSocketFactory(final SSLContext sslContext) {
            super(sslContext);
        }

        @Override
        public Socket createSocket(final HttpContext context) throws IOException {
            InetSocketAddress socksaddr = (InetSocketAddress) context.getAttribute("socks.address");
            Proxy proxy = new Proxy(Proxy.Type.SOCKS, socksaddr);
            return new Socket(proxy);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-06-06T05:49:59.103

您可以使用中间人技术和动态 SSL 生成来完成此操作。看看[mitmproxy——](http://mitmproxy.org/)它是一个基于 Python 的、支持 SSL 的 MITM 代理。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-12-01T07:53:10.553

通过 SSH 隧道（端口转发）HTTPS（Linux 版本）：

1.  使用 443 on 关闭`localhost`。

2.  以 root 身份启动隧道：

    ```
    ssh -N login@proxy_server -L 443:target_ip:443 
    ```

3.  添加`127.0.0.1 target_domain.com`到`/etc/hosts`.

您在本地主机上所做的一切。
然后：`target_domain.com`可从`localhost`浏览器访问。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-07-12T02:22:28.530

我不认为“在代理服务器上有 HTTPS 连接”意味着代理服务器的中间人攻击类型。我认为这是在询问是否可以通过 TLS 连接到 http 代理服务器。答案是肯定的。

* * *

> 是否可以通过代理服务器进行 HTTPS 连接？

是的，请在此处查看我的问题和答案。[HTTPS 代理服务器仅适用于 SwitchOmega](https://stackoverflow.com/questions/56981993/https-proxy-server-only-works-in-switchomega)

> 如果是，什么样的代理服务器允许这样做？

这种代理服务器部署 SSL 证书，就像普通网站一样。但是您需要一个`pac`文件供浏览器通过 SSL 配置代理连接。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-09-14T04:55:36.123

我试过

*   开始隧道：`ssh -N -D 12345 login@proxy_server`
*   在 Firefox 设置中将代理设置为`localhost:12345`
    *   并勾选“将此代理用于所有协议”

但这会导致每当我尝试连接到 https 网站时出现错误“不安全的连接”。

解决方案是

*   “取消勾选”“将此代理用于所有协议”
*   仅将代理“localhost:12345”设置为 SOCKS 代理
*   并将 HTTP 代理、SSL 代理、FTP 代理留空

来自数字海洋文档的参考

[如何使用 SOCKS 隧道在没有 VPN 的情况下安全地路由 Web 流量](https://www.digitalocean.com/community/tutorials/how-to-route-web-traffic-securely-without-a-vpn-using-a-socks-tunnel)

# database - Mnesia 交易

> ID：516324
> 
> 赞同：0
> 
> 时间：2009-02-05T15:20:37.193
> 
> 标签：database, erlang, mnesia

不小心我正在编写的一些代码自己慢慢变成了一个数据库系统，具有增量索引、自由格式的“文档”（又名 CouchDB 类型），它可以具有任意属性...... annyywaay......我决定继续发展它，主要是为了教育目的，并且为了我的需要而真正严格地定制它并保持精简，因为我不想让它对我自己的需要有用（多么慷慨:)）......

无论如何，我想知道是否有人对 Mnesia 如何“在幕后”实施交易有意见/更多信息。

Ulf W.，我一直很欣赏你在网上的帖子，所以也许你对此有更深入的信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-21T16:56:35.117

Mnesia 使用两阶段提交协议来管理分布式事务。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-05T16:55:20.463

所以我一直在考虑更多的事情......事务锁可以通过在每个表示表行的元组中都有一个“Lock”元素来破解......该元素将包含Pid持有执行当前事务的锁的进程（并且由事务管理器产生）（或者出于效率原因，Pid 将存储在其他地方，关键是每行都有一个 Pid）。如果另一个事务想要从锁定的行写入/读取，事务管理器将不执行它，并将其留在队列中以供以后尝试（下一次尾递归）。我将不得不更多地考虑检查点如何工作......但总的来说，我开始理解事物的结构，至少在概念上......它会很丑;

关于分布式事务......我猜测事务乐趣是通过电线发送到另一个节点，首先将其转换为二进制文件，然后在另一端重建它......现在，关于这个的问题。由于 fun 是一个闭包，假设我在 fun 中使用了一个绑定在 fun 之外的变量，例如 10 个元素的列表，然后闭包作为要在另一个节点上执行的事务传入（由事务管理器透明地显示）-我假设闭包语义代表将发送具有 10 个元素的列表以及闭包“关闭”的词汇环境的一部分……我在这里遗漏了什么吗？只是在想如何实现分布式事务......

谢谢

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-27T05:52:56.087

由于 Mnesia 是开源的，您可以查看代码本身。与 CouchDB 类似。

# asp.net - ASP.NET - AJAX - 部分后跟完整回发问题

> ID：516330
> 
> 赞同：0
> 
> 时间：2009-02-05T15:21:25.460
> 
> 标签：asp.net, asp.net-ajax

我有一个包含一系列 Web 控件的页面。其中之一是关闭了 AutoPostBack 的文本框。

页面的操作方式是点击一个按钮来保存表单数据。此按钮位于更新面板之外。

因此，当我点击保存按钮时，下拉列表会发生部分回发，并且在此回发完成后，会触发保存按钮的完整回发。但是，当完整的回发触发时，表单数据将返回到单击保存按钮之前的状态 - 即我的更改被删除。

我相信这可能与从部分更新返回的视图状态以及在完整回发触发之前未在页面中更新的视图状态有关 - 或者它已损坏。

有没有人有任何想法？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T15:48:47.463

听起来并不消极，但这些情况让我放弃了“按部就班”的 ASP.net AJAX。学习 jQuery /w 简单的 ASP.net 表单 /w 没有回发让我构建了比我不得不努力使用更新面板等的更有用和更酷的 UI 体验。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T15:27:44.307

如果在 UpdatePanel 上设置 UpdateMode="Conditional" 和 ChildrenAsTriggers="true"，这将确保部分回发仅在 DropDownList 的回发事件触发时执行，而不是在单击按钮时执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T15:41:22.190

感谢您及时的回复！但是我也需要保存按钮单击事件来触发。事件触发的顺序是完美的：

1.  下拉列表更改事件（部分）
2.  保存按钮点击事件（完整）

问题是部分回发后表单数据丢失。

非常感谢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T16:39:20.793

我已经在另一篇文章中发布了解决方案。这个简单的代码将确保您的视图状态适用于回发和部分回发。

[使用 ASP.NET AJAX 和更新面板时如何处理视图状态的想法](https://stackoverflow.com/questions/271269/ideas-for-how-to-deal-with-viewstate-when-using-asp-net-ajax-and-update-panels)

# python - 是否可以使用 gdata API 进行谷歌搜索？

> ID：516335
> 
> 赞同：1
> 
> 时间：2009-02-05T15:22:28.373
> 
> 标签：python, gdata-api

我可能只是厚实（没什么新东西），但我似乎无法在 gdata API 文档中找到与老式的香草谷歌搜索相关的任何内容。有谁知道这是否可能？（我知道这可能需要一点点修修补补，但我已经创建了一个 Python 网络抓取类来为我做这件事，但我想知道使用 gdata 是否是*正确的做法*）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T15:35:12.123

AFAIK，gdata API 仅适用于 Google Doc 的应用程序（Google 电子表格等）。

搜索 API 确实为“Flash 和其他非 JavaScript 环境”公开了一个 REST 接口：

[http://code.google.com/apis/ajaxsearch/documentation/#fonje](http://code.google.com/apis/ajaxsearch/documentation/#fonje)

# objective-c - 使用带有 OCMock 或 Hamcrest 的结构

> ID：516346
> 
> 赞同：9
> 
> 时间：2009-02-05T15:24:49.087
> 
> 标签：objective-c, iphone, cocoa-touch, ocmock, hamcrest

我遇到了障碍，我想知道这里聪明的集体思想是否可以提供帮助。在 ObjC CocoaTouch 中，我试图模拟一个接受结构参数并返回结构的对象。OCMock 咳出了一个毛球，所以我试着用 Hamcrest 火柴盒包裹起来。没有死。我正在测试的函数/方法如下所示：

```
- (CLLocationCoordinate2D)pixelToLatLong:(CGPoint)aPoint; 
```

我使用这样的代码：

```
#define OCMOCK_STRUCT(atype, variable) [NSValue value:&variable withObjCType:@encode(atype)]
-(void) testMyWidget
{
    CLLocationCoordinate2D ulLL = (CLLocationCoordinate2D){123,456};
    CLLocationCoordinate2D lrLL = (CLLocationCoordinate2D){654,321};
    [[[(id)myObj expect] andReturn:OCMOCK_STRUCT(CLLocationCoordinate2D, ulLL)] pixelToLatLong:(CGPoint){0,0}];
    [[[(id)myObj expect] andReturn:OCMOCK_STRUCT(CLLocationCoordinate2D, lrLL)] pixelToLatLong:(CGPoint){320,460}];//lower right point
} 
```

这有点工作。因此，在我正在测试的对象中，我进行了必要的必要编辑以在构建信息窗口中获得一个绿色条...错误..绿色按钮。当我确定我的测试应该通过时，我得到断言失败错误。这些错误告诉我该方法被意外调用并将这些结构的值列为问号。我尝试用 Hamcrest 匹配器包装结构，但我无处可去。我正准备破解我的调试器，这无疑会告诉我出了什么问题。这里有人在 OCMock/Hamcrest 和结构方面遇到过类似的问题吗？如果是这样，处理这些类型的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-07T14:42:03.903

你很亲密。你的#define 应该是：

```
#define OCMOCK_STRUCT(atype, variable) [NSValue valueWithBytes:&variable withObjCType:@encode(atype)] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-21T01:09:02.317

最好的答案实际上是克里夫本人：[http ://codeforfun.wordpress.com/2009/02/07/ocmock-return-a-struct/](http://codeforfun.wordpress.com/2009/02/07/ocmock-return-a-struct/)

他只是没有更新这个问题，羞耻:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-30T16:50:37.877

我对宏观答案有疑问；编写一个帮助函数，返回测试类中的结构并使用：

```
[[[mockObject stub] andCall:@selector(selectorName) onObject:self] someMethod]; 
```

工作得很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-09T03:42:09.160

有时，手工编码的模拟比试图强制模拟对象框架超出其正常使用模式更容易。

# wsdl - WSDL 的粒度

> ID：516353
> 
> 赞同：0
> 
> 时间：2009-02-05T15:26:50.440
> 
> 标签：wsdl

我正在寻找每个 wdsl 创建一个操作而不是在单个 wdsl 中捆绑操作的一些优点和缺点

下面的小例子：

```
 <operation name="Divide">
     <input message="y:DivideMessage"/>
     <output message="y:DivideResponseMessage"/>
  </operation> 
```

而不是分裂，这是更复杂的操作，每个操作有一个 wsdl 的优点/缺点是什么

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T10:38:27.667

我不确定我是否理解这个问题......但是如果您询问将所有操作放在一个 WSDL 中还是将每个操作放在一个 WSDL 中......

如果操作在同一个端点上，我认为最好将所有内容保存在一个 WSDL 中，因为许多工具将允许您从 WSDL 生成 Web 服务客户端：使用单个 WSDL 然后您可以生成一个客户端能够调用所有的操作。如果操作在单独的 WSDL 中，您将不得不生成多个客户端，每个操作一个，使用起来会很不舒服......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-17T13:48:20.500

我的建议是为一个**对象**（例如：customerManagement）或**方面**使用一个 WSDL ，然后包括几个操作（例如：CRUD=* *C* *reate,* *R* *ead,* *U* *pdate 和 * *D* *elete） .

在考虑 WSDL 设计时，不仅仅是 wsdl 操作。您还应该考虑在 WSDL(s) 中选择正确的端口类型和目标名称空间值。

您的 WSDL 与编译/生成后的代码结果之间的关系如下：

```
 - WSDL:targetNamespace -> Package 
 - WSDL:Porttype        -> Class
 - WSDL:Operation       -> Method 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-06T23:49:20.687

**把所有东西放在一起**：
优点：一个文件要同步，没有依赖关系
缺点：一个大文件，可能很难清楚地知道去哪里

**单独的文件**：
优点：文件更小，更易于维护和扩展
缺点：可能更难调试交叉引用依赖项，或查找重复条目

**建议**：
WSDL 文件被认为类似于合同。因此，您应该将“常识”的东西放在一起，并且只专注于您在当前应用程序中需要的东西。我建议将“对象”保存在单个“词典”文件中，并将一些基本（常见）操作保存在第 2 层文件中（具有包含第 1 文件的指针）。然后在任何专业化中，我将创建一个第三层文件，该文件仅指定当前应用程序需要的唯一操作，甚至将操作拆分为多个文件。

# php - 从 A 类的 B 类（扩展 A 类）调用静态方法

> ID：516355
> 
> 赞同：5
> 
> 时间：2009-02-05T15:27:05.197
> 
> 标签：php, oop

练习测试中有一个有趣的问题，我不明白答案。以下代码的输出是什么：

```
<?php
class Foo {
    public $name = 'Andrew';

    public function getName() {
        echo $this->name;
    }
}

class Bar extends Foo {
    public $name = 'John';

    public function getName() {
        Foo::getName();
    }
}

$a = new Bar;
$a->getName();
?> 
```

最初，我认为这是一个错误，因为静态方法不能引用 $this（至少在 PHP5 中）。我自己对此进行了测试，它实际上输出了 John。

我添加了 Foo::getName(); 在脚本的末尾，确实得到了我所期待的错误。那么，当您从扩展您调用的类的类中调用静态方法时，会发生什么变化？

有人介意详细解释这里发生了什么吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T17:20:26.187

Foo::getName() 使用较旧的 PHP4 风格的[范围解析运算符](http://uk.php.net/manual/en/keyword.paamayim-nekudotayim.php)来允许调用被覆盖的方法。

在 PHP5 中，您将改用[parent](http://uk.php.net/manual/en/language.oop5.paamayim-nekudotayim.php) ::getName()

如果您想扩展而不是完全覆盖基类的行为，这很有用，例如，这可能会使它更清晰

```
class Bar extends Foo {
    public $name = 'John';

    public function getName() {
        echo "My name is ";
        parent::getName();
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T15:29:51.307

如果调用绑定到其他对象的静态方法，则该方法在当前对象的上下文中执行。这允许访问 $this-object。

从子类内部调用超类方法的更好方法是：

```
parent::getName(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T15:30:57.747

$this 指向在其上下文中调用该方法的对象。所以：$this 是 $a->getName() 是 $a。$fooInstance->getName() 中的 $this 将是 $fooInstance。在 $this 被设置（在对象 $a 的方法调用中）并且我们调用静态方法的情况下，$this 仍然分配给 $a。

似乎使用此功能可能会引起很多混乱。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T17:13:23.050

当您调用时，`$a->getName()`您引用的是一个特定对象，`$a`它属于类`Bar`，因此返回“John”。

`Foo::getName()`在函数之外无效，因为没有特定的对象。

我不确定它在 PHP 中是否有效，但如果你**将**对象转换为超类，`(Foo)$a->getName()`那么你会得到“Andrew”作为结果。您仍然在谈论特定对象 ( `$a`)，但在这种情况下是 type `Foo`。（*请注意，您通常不想这样做*）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T18:14:03.630

有时程序员比用英语更善于用代码解释事物！

这里发生的第一件事是重载的概念。当你实例化 Bar 时，它的 getName() 方法重载了 Foo 中的同名方法。

重载是OOD的一个强大而重要的部分。

但是，能够调用存在于父类 (Foo) 中的方法的版本通常很有用。

这是一个例子：

```
class Dog
{
   public function getTag()
   {
      return "I'm a dog.";
   }
}

class Skip extends dog
{
   public function getTag()
   {
      return Dog::getTag() . " My name is Skip.";
      // I'm using Dog:: because it matches your example. However, you should use parent:: instead.
   }
}

$o = new Skip();
echo $o->getTag(); // Echo's: "I'm a dog. My name is Skip." 
```

显然，这是一个非常狭隘的例子，但它说明了一个观点。

您的基类是类型的最通用实现。在这种情况下，它是“狗”。您希望将信息放在该类型的所有实例通用的这个基类中。这可以防止每个派生类中的重复（如“跳过”）。

您的脚本可能无意中利用了此功能。

# c# - 域设计 - 在子类中引用实体

> ID：516356
> 
> 赞同：0
> 
> 时间：2009-02-05T15:27:10.253
> 
> 标签：c#, domain-driven-design

假设我有一个实体 Foo，它包含另一个实体 Bar 的列表。Bar 应该直接引用 Foo 吗？IE..

```
public class Foo
{
   public int Id {get; set;}
   public IList<Bar> Bars {get; set;}
}

public class Bar
{
   public int Id {get; set;}
   public Foo parentFoo {get; set;  //this will be set to an the Foo entity on creation
} 
```

还是我只是在我的 Bar 类中省略了对 Foo 的引用？

我倾向于忽略该参考，但想知道这里的正确方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T15:33:07.183

正确的做法是问“Bar 出于某种原因需要引用 Foo 吗？”这个问题。如果 Bar 不需要对它做任何事情，不要只是把引用放在那里。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T15:34:48.537

这真的取决于例子。如果**需要**知道父级（例如，执行双向导航`XmlNode`等），那么您将需要它。这仅适用于单亲父母。

如果您只需要更改通知，那么事件可能会更加通用 - 特别是，事件允许多个“父母”不带偏见。

如果孩子不需要关心父母，那就不要打扰。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T15:37:26.033

除非`Bar`对象绝对需要知道`Foo`它属于哪一个，否则不要使用它。

如果您认为有必要，请考虑如何处理`Bar`属于多个对象的对象`Foo`（完全可能使用您描述的类结构）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T15:48:14.610

我将支持“如果需要就做”的答案，但要警告说，双向耦合往往会导致代码脆弱。`Bar`仔细考虑从back to的引用是否`Foo`是绝对必要的。如果它可以完全避免，它应该。

# java - 数据库框架开发

> ID：516364
> 
> 赞同：2
> 
> 时间：2009-02-05T15:28:47.627
> 
> 标签：java, database, frameworks, persistence, velocity

我正在开发（另一个）供个人使用的 java web 框架，除此之外，我还想开发某种持久性框架。

我已经开发和引擎，为了访问表，您必须只扩展一个类并创建具有与表中相同类型和名称的字段。前任：

```
private int id;
private String nome; 
```

所以您现在只需要构建查询并执行。引擎将值放在正确的字段上。

最近我对 Django 有很好的体验，为了更新、创建和过滤你只需要调用 .save()、.create(field1=field, field2=213) 和 .filter(filterfield) 的表=价值）。

我想构建它，但我遇到了一些麻烦，因为扩展类实际上必须写更多，我不想强​​迫。我有想法让扩展类编写一个实现接口的枚举。因此，超类获取这些字段以及私有 HashMap（键是枚举）并保留值，因此客户端只需调用：

```
String nome = Usuarios.get(Usuarios.fields.name); 
```

检索值。

```
Usuarios.update(new Pair(Usuarios.fields.name, "José Leal"), new Pair(Usuarios.fields.sobrenome, "Domingues")); 
```

要更新等等。

有人有更好的主意吗？我也使用速度框架，所以我希望我的字段可以被它的 getter 访问。

ps：我知道hibernate等的存在。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T15:51:43.587

我建议您不要强迫用户为其模型对象扩展您自己的类之一。这使它们无法扩展自己的类，并使它们更容易受到您以后可能进行的 API 更改的影响。

看到 javax.persistence 已经定义了可用于将属性映射到数据库的注释，我建议您让用户使用带注释的属性为他们的模型对象创建 POJO。这样，除了提到的其他好处外，您还可以遵循已经建立的标准，从而降低用户的进入门槛。

# .net - .NET 中属性的限值

> ID：516367
> 
> 赞同：2
> 
> 时间：2009-02-05T15:29:15.270
> 
> 标签：.net, asp.net, properties, enums, intellisense

我知道这可能是一个菜鸟问题，但它让我很烦。

假设我有一个在 .aspx 页面中引用的用户控件：

```
<uc:somecontrol runat="server" id="uc1" property1="red" /> 
```

当在 VS05 中智能感知将显示属性 1 的“红色”、“绿色”、“蓝色”等选项时，我该如何做到这一点？类似于在文本框上的模式中选择“文本”、“多行”和“密码”时的方式。我正在使用VB。

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-05T15:30:54.410

使您的属性成为枚举而不是字符串。

```
Enum ControlColor
Red = 1
Blue = 2
Green = 3
End Enum 
```

和

```
Public Property MyProperty As ControlColor 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T15:41:41.783

正如 Rex 所说，在新文件中定义一个枚举：

```
Public Enum ControlColor
    Red = 1
    Blue = 2
    Green = 3
End Enum 
```

然后在您的控件中，像这样定义您的属性（我的 VB 语法生疏，但我认为这是正确的）：

```
Private _color As ControlColor

Public Property [Color] As ControlColor
    Get
        Return _color
    End Get
    Set (ByVal value As ControlColor)
        _color = value
    End Set
End Property 
```

# visual-studio-2008 - 一个解决app.config问题的两个测试项目（Visual Studio 2008 Professional）

> ID：516373
> 
> 赞同：1
> 
> 时间：2009-02-05T15:30:25.113
> 
> 标签：visual-studio-2008, unit-testing, app-config

我有 2 个项目，每个项目都有自己的单元测试项目，每个项目+测试项目对都有一个 app.config。如果我每次只运行一个，测试就不会失败。但是，如果使用“在解决方案中运行所有测试”，所有测试将只使用 app.config 之一，并且对于这些测试项目之一中的所有测试，这将是错误的。

如何从单个项目运行所有测试而不必使用单独的解决方案，因此它们不使用另一个项目的 app.config？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T04:51:53.653

我不认为你能做到。您可能遇到的问题是 Visual Studio 只会将一个测试列表传递给 MSTest。启动时的 MSTest 将使用它遇到的第一个 .DLL 的配置文件。

出于性能原因，MSTest 在遇到不同 .DLL 中的测试时不会关闭/启动新进程，因此它永远不会加载第二个配置文件。

在我看来，您有两种选择。

1.  合并配置文件，以便在测试之间共享它们。

2.  更改您的测试，使它们不需要配置文件。您拥有它们的事实表明您正在进行集成测试而不是与它们的依赖项隔离的单元测试，但如果您有一个复杂的代码库，我可以理解它为什么会发生。

# php - 除 Zend Debugger 之外的 PHP 的 Step Debugger

> ID：516385
> 
> 赞同：1
> 
> 时间：2009-02-05T15:32:05.907
> 
> 标签：php, debugging

我只是想看看是否有人知道任何其他能够单步执行代码的调试器。

我知道 xdebug 并使用它以及 Zend Debugger 和其他调试脚本（我已经为此编写了自己的小部件）。

但是，我正在寻找一个很好的替代步骤调试的方法——我已经搜索过，但还没有找到任何东西。还有其他东西可以处理这个吗？Zend Debugger 肯定不是我们唯一的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T15:36:27.893

我使用[php_dbg](http://www.php-debugger.com/dbg/installation.php)进行 PHP 步进调试（附带 PhpED）。

# database - 我应该克隆或非规范化我的数据库以供便携式使用吗？

> ID：516387
> 
> 赞同：3
> 
> 时间：2009-02-05T15:32:55.450
> 
> 标签：database, portability

我有一个包含大量数据的数据库，并且都是“整洁的”、标准化的（在合理范围内 - 使用 EAV），并且我有存储过程来访问和修改数据。

我还有一个 WinForms 应用程序，用户可以下载它来搜索和查看这些数据（无插入）。为了方便使用和更新，我一直在使用 SQLite 来存储这些数据，并且效果非常好。

我正在努力更新整个过程，我想知道是否应该使用非规范化的数据视图来发送给用户，将所有属性作为列的 1 个表，或者继续使用与主数据库？

我最初的想法是这样的：

**非规范化视图：** 好处...提供了一种查询数据的简单方法（因为我没有做很多连接，只是一堆列搜索。

缺点...我必须管理第二个数据访问层。当然，我认为这不会很困难，但仍然需要做更多的工作。

如果添加了新属性，我必须再次修改架构并适应更改。而我可以在那里简单地查询属性包和工作表。

**相同的架构：** 优点...与主数据库相同的布局，因此更新很少，而且我什至可以在构建数据访问层时使用相同的查询，因为 SQLite 不支持存储过程。

缺点...有很多用于查找代码等的小表，因此在构建查询和在 DAL 中管理它时，我可能会遇到问题。

我应该如何进行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T15:36:27.970

如果您开发应用程序来查询数据视图而不是底层数据本身，那么您将能够为这两种情况保留相同的数据库，而无需担心或无需更改 DAL。

# c++ - 我什么时候不需要 typedef？

> ID：516395
> 
> 赞同：6
> 
> 时间：2009-02-05T15:34:22.093
> 
> 标签：c++, c, typedef

我遇到了一些代码阅读

```
typedef enum eEnum { c1, c2 } tagEnum;

typedef struct { int i; double d; } tagMyStruct; 
```

我听说这些结构源自 C。在 C++ 中，您可以轻松编写

```
enum eEnum { c1, c2 };
struct MyStruct { int i; double d; }; 
```

真的吗？你什么时候需要第一个变种？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-05T16:16:37.797

首先，这两种声明在 C 和 C++ 中都是合法的。但是，在 C 中，它们的语义略有不同。（特别是，您稍后引用该结构的方式会有所不同）。

要理解的关键概念是，在 C 中，结构存在于单独的命名空间中。所有内置类型以及 typedef 都存在于“默认”命名空间中。也就是说，当我键入时`int`，编译器只检查这个“默认”命名空间。如果我在您的示例中键入“tagMyStruct”，编译器也只检查这个命名空间。但根据您使用的声明类型，该名称空间中可能不存在该结构。

结构是不同的，存在于单独的命名空间中。因此，如果我做出以下声明：

```
struct mystruct {}; 
```

我*不能*简单地将其称为 mystruct。相反，我必须指定我想要 struct 命名空间中存在的 mystruct：

```
void foo(struct mystruct bar); // Declare a function which takes a mystruct as its parameter 
```

从长远来看，这有点冗长和尴尬。相反，您可以将其 typedef 到默认命名空间中：

```
typedef struct mystruct mystruct; // From now on, 'mystruct' in the normal namespace is an alias for 'mystruct' in the struct namespace 
```

现在，我的函数可以以直接的方式声明：

```
void foo(mystruct bar); 
```

因此，您的第一个示例只是将这两个步骤合并在一起：声明一个结构，并将别名放入常规命名空间。当然，由于我们无论如何都要对它进行类型定义，我们不需要“原始”名称，因此我们可以使结构匿名。所以在你的声明之后

```
typedef struct { int i; double d; } tagMyStruct; 
```

我们有一个没有名称的结构，它在默认命名空间中已被类型定义为“tagMyStruct”。

C就是这样对待它的。这两种类型的声明都是有效的，但一种不会在“默认”命名空间中创建别名，因此每次引用该类型时都必须使用 struct 关键字。

在 C++ 中，不存在单独的 struct 命名空间，因此它们的含义相同。（但首选较短的版本）。

*编辑*为了清楚起见，不，C 没有名称空间。不是通常意义上的。C 只是将标识符放入两个预定义的命名空间之一。结构（和枚举，我记得）的名称放在一个中，所有其他标识符放在另一个中。从技术上讲，这些是命名空间，因为它们是单独的“容器”，其中放置名称以避免冲突，但它们肯定不是 C++/C# 意义上的命名空间。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-05T15:42:16.180

在 C 中，如果你要写

```
struct MyStruct { int i; double d; }; 
```

每当您想引用该类型时，您都必须指定您正在谈论的是一个结构：

```
struct MyStruct instanceOfMyStruct;
struct MyStruct *ptrToMyStruct; 
```

使用 typedef 版本：

```
typedef struct { int i; double d; } tagMyStruct; 
```

你只需要写：

```
tagMyStruct instanceOfMyStruct;
tagMyStruct *ptrToMyStruct; 
```

typedef 版本的另一大优势是您可以在 C 和 C++ 中以相同的方式引用结构，而在第二个版本中，它们在 C 中的引用方式与在 C++ 中的不同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T15:37:20.450

这只是简写。

在第二种情况下，要声明您将使用的结构：

```
struct MyStruct a; 
```

在第一个变体中，您可以这样做：

```
tagMyStruct a; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T15:39:29.883

第二种变体也存在于 C 中。

每当您想命名您的类型时，您都可以使用第一个变体，例如：

```
tagEnum myFunc(tagMyStruct * myArg); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T15:42:11.343

第一个在 C++ 中可能不方便，因为您不能在头文件中转发声明它。

# java - 如何为 Java 程序创建 .exe？

> ID：516399
> 
> 赞同：54
> 
> 时间：2009-02-05T15:34:53.480
> 
> 标签：java, exe

> **可能重复：**
> [如何将我的 java 程序转换为 .exe 文件？](https://stackoverflow.com/questions/147181/how-can-i-convert-my-java-program-to-an-exe-file)

我想为 Java 程序创建一个 Windows .exe。以前，我为此使用过 JEXECreator，但并不完全令人满意，因为：

*   可执行文件有时可以在创建它的机器上运行，但不能在其他机器上运行。
*   该程序是商业的；如果您使用试用版，它会在您的应用程序中添加一个唠叨屏幕。

如果目标机器上没有安装 Java，我不需要生成的 .exe 来工作（事实上，我认为这是不可能的）。

有什么建议吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-05T15:40:07.387

[Launch4j](http://launch4j.sourceforge.net/)也许？不能说我自己用过，但听起来像你所追求的。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-05T15:56:58.820

大多数将 java 应用程序转换为 .exe 文件的程序只是程序的包装器，最终用户仍需要安装 JRE 才能运行它。据我所知，没有任何转换器可以使其成为字节码的本机可执行文件（已经尝试过，但如果有任何成功的话，您现在就会听说它们）。

至于包装器，我用过的最好的（如前所述）是：

[JS平滑](http://jsmooth.sourceforge.net/)

和

[启动4j](http://launch4j.sourceforge.net/)

祝你好运！

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-05T15:41:13.827

如果你真的想要一个 exe Excelsior JET 是一个专业级的产品，可以编译为本机代码：

[http://www.excelsior-usa.com/jet.html](http://www.excelsior-usa.com/jet.html)

您还可以查看 JSMooth：

[http://jsmooth.sourceforge.net/](http://jsmooth.sourceforge.net/)

如果您的应用程序与其兼容的 AWT/Apache 类路径兼容，那么 GCJ 将编译为本机 exe。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-12-10T05:47:02.507

我使用 exe4j 将所有 java jar 打包成一个最终的 .exe 文件，用户可以将其用作普通的 Windows 应用程序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-05T16:22:10.203

你可以试试[exe4j](http://www.ej-technologies.com/products/exe4j/overview.html)。这实际上是我们通过它的表亲[install4j](http://www.ej-technologies.com/products/install4j/overview.html)使用的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T16:05:38.100

[Java Service Wrapper](http://wrapper.tanukisoftware.org)可能会对您有所帮助，具体取决于您的要求。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2009-02-05T15:39:17.920

如果目标机器上安装了 Java，则无需创建 .exe 文件。一个 .jar 文件就足够了。

# math - LaTeX 相当于 Google Chart API

> ID：516406
> 
> 赞同：19
> 
> 时间：2009-02-05T15:36:05.570
> 
> 标签：math, latex, png, formula

我目前正在研究将二维数学公式放入网页的不同解决方案。我认为维基百科解决方案（从 LaTeX 源代码生成 png 图像）已经足够好了，直到我们在 webbrowsers 中获得对 MathML 的支持。

我突然意识到可以为数学公式创建一个等效的[Google Charts API 。](http://code.google.com/apis/chart/)这已经完成了吗？由于 LaTeX 代码中涉及的奇怪字符，它甚至可能吗？

我想点击像 latex2png.org/api/?eq="E = mc^2" 这样的网址并得到以下响应：![e=mc^2](https://upload.wikimedia.org/math/f/0/9/f09291a2934068644f41981dd51eb5b0.png)

**编辑：** 感谢到目前为止的答案。但是，我已经知道有几种工具可以从乳胶源代码（在线和我的命令行）生成 png 图像，但我正在寻找一种通过 Http GET 请求获取图像的简单方法。也许这样的服务不存在。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-09-04T19:15:33.420

# 更新

正如@hughes（和其他人）所指出的，以前的 Google Chart API 已被弃用。

我写的例子到 2015 年 9 月仍然有效，但现在应该使用一个新的（[文档](https://developers.google.com/chart/infographics/docs/formulas?hl=en)）：

[![](https://chart.googleapis.com/chart?cht=tx&chl=%5CLaTeX)](https://chart.googleapis.com/chart?cht=tx&chl=%5CLaTeX)

# 旧答案

谷歌图表可以做到（[文档](http://code.google.com/intl/de-DE/apis/chart/infographics/docs/formulas.html)）：

[http://chart.apis.google.com/chart?cht=tx&chl=%5CLaTeX](http://chart.apis.google.com/chart?cht=tx&chl=%5CLaTeX)

我将它与 Google Docs 一起使用，因为它还不支持数学。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-09-25T07:43:06.393

**72pines.com 比 chart.apis.google****更具**可读性：

[替代文字 http://tex.72pines.com/latex.php?latex=%0D%0A4x_0%5CDelta%28x%29%2B3%5CDelta%28x%29%2B2%5CDelta%28x%5E2%29%3E0%0D %0A](http://tex.72pines.com/latex.php?latex=%0D%0A4x_0%5CDelta%28x%29%2B3%5CDelta%28x%29%2B2%5CDelta%28x%5E2%29%3E0%0D%0A)

```
http://tex.72pines.com/latex.php?latex=%0D%0A4x_0%5CDelta%28x%29%2B3%5CDelta%28x%29%2B2%5CDelta%28x%5E2%29%3E0%0D%0A 
```

* * *

或*更改*了背景颜色的**chart.apis.google**

 *![替代文字](https://chart.apis.google.com/chart?cht=tx&chf=bg,s,FFFF00&chl=%0D%0A4x_0%5CDelta%28x%29%2B3%5CDelta%28x%29%2B2%5CDelta%28x%5E2%29%3E0%0D%0A)

```
https://chart.apis.google.com/chart?cht=tx&chf=bg,s,FFFF00&chl=%0D%0A4x_0%5CDelta%28x%29%2B3%5CDelta%28x%29%2B2%5CDelta%28x%5E2%29%3E0%0D%0A 
```

* * *

或**chart.apis.google**的背景颜色*透明*并*调整大小*

![替代文字](https://chart.apis.google.com/chart?cht=tx&chs=428x35&chf=bg,s,FFFFFF00&chl=%0D%0A4x_0%5CDelta%28x%29%2B3%5CDelta%28x%29%2B2%5CDelta%28x%5E2%29%3E0%0D%0A)

```
https://chart.apis.google.com/chart?cht=tx&chs=428x35&chf=bg,s,FFFFFF00&chl=%0D%0A4x_0%5CDelta%28x%29%2B3%5CDelta%28x%29%2B2%5CDelta%28x%5E2%29%3E0%0D%0A 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-05T15:40:28.773

您可以尝试使用[在线图像生成器获取数学公式](http://modis.ispras.ru/Lizorkin/math2image.html)作为开始。

[mathurl](http://mathurl.com)是 TinyURL.com 的数学版本。它允许您使用短 url 引用 LaTeXed 数学表达式。例如，[http](http://mathurl.com/?5v4pjw) ://mathurl.com/?5v4pjw将显示 [LaTeX 输出图像]，然后您可以对其进行编辑。[有关mathurl 帮助页面的](http://mathurl.com/help.html)更多详细信息

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-12-23T17:20:21.883

[我刚刚在 Ajaxian](https://web.archive.org/web/20091227035542/http://ajaxian.com/archives/mathjax) [通过 Wayback Machine]上遇到了[MathJax ：](https://www.mathjax.org/)

> MathJax 似乎有机会成为一个实用的解决方案，在 HTML 页面中提供高质量的 LaTeX 和 MathML 数学符号显示。

输出非常漂亮，而且都是纯 HTML 和 CSS，这使得它具有可扩展性和可选性。性能目前有点迟钝，但这是公认的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T15:48:41.613

正如大家所说，已经有很多服务可以做到这一点。这是我使用过多次的另一个简单的方法（如果需要，您可以将它本地安装在您的服务器上）： http:
[//www.codecogs.com/components/equationeditor/equationeditor.php](http://www.codecogs.com/components/equationeditor/equationeditor.php)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T15:39:51.803

我会好好看看[MediaWiki LaTeX 支持](http://www.mediawiki.org/wiki/Manual:Enable_TeX)如何做到这一点并从那里借用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-08-31T13:51:43.170

请查看此站点以了解无需安装任何软件即可创建 TeX 文档的方法。然后，您可以使用任何屏幕捕获方法对结果图像进行片段化，并将结果图像嵌入到任何网站中。

访问[http://sharelatex.com](http://sharelatex.com)

该软件可以免费使用，但您需要注册才能创建文档。

# c++ - 来自绑定方法的原始函数指针

> ID：516411
> 
> 赞同：3
> 
> 时间：2009-02-05T15:37:15.613
> 
> 标签：c++, boost, delegates, callback

我需要将一个方法绑定到一个函数回调中，除了这个片段不合法，如[demote-boostfunction-to-a-plain-function-pointer](https://stackoverflow.com/questions/282372/demote-boostfunction-to-a-plain-function-pointer/512189#512189)中讨论的那样。

获得这种行为的最简单方法是什么？

```
struct C {
void m(int x) {
    (void) x;
    _asm int 3;
}};

typedef void (*cb_t)(int);
int main() {
    C c;
    boost::function<void (int x)> cb = boost::bind(&C::m, &c, _1);
    cb_t raw_cb = *cb.target<cb_t>(); //null dereference
    raw_cb(1);
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T15:49:06.573

您可以将该绑定参数推入全局变量并创建一个静态函数，该函数可以获取该值并在其上调用该函数，或者您将不得不动态生成每个实例的函数 - 这将涉及一些一种即时代码生成在堆上生成一个存根函数，该函数将静态局部变量设置为您想要的值，然后在其上调用该函数。

第一种方法简单易懂，但根本不是线程安全的或可重入的。第二个版本是混乱和困难的，但如果做得好，它是线程安全的和可重入的。

编辑：我刚刚发现 ATL 使用代码生成技术来做到这一点 - 它们动态生成设置`this`指针和其他数据的 thunk，然后跳转到回调函数。 [这是一篇 CodeProject 文章](http://www.codeproject.com/KB/atl/atl_underthehood_5.aspx)，它解释了它是如何工作的，并可能让您了解如何自己做。特别注意最后一个示例（程序 77）。

请注意，自从撰写本文以来，DEP 已经存在，您需要使用`VirtualAlloc`with`PAGE_EXECUTE_READWRITE`来获取一块内存，您可以在其中分配您的 thunk 并执行它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T16:02:14.957

你可以让你自己的类做和 boost 绑定函数一样的事情。该类所要做的就是接受函数类型和指向包含该函数的对象的指针。例如，这是一个 void return 和 void param 委托：

```
template<typename owner>
class VoidDelegate : public IDelegate
{
public:
   VoidDelegate(void (owner::*aFunc)(void), owner* aOwner)
   {
      mFunction = aFunc;
      mOwner = aOwner;
   }
   ~VoidDelegate(void)
   {}
   void Invoke(void)
   {
      if(mFunction != 0)
      {
         (mOwner->*mFunction)();
      }
   }

private:
   void (owner::*mFunction)(void);
   owner* mOwner;
}; 
```

用法：

```
class C
{
   void CallMe(void)
   {
      std::cout << "called";
   }
};
int main(int aArgc, char** aArgv)
{
   C c;
   VoidDelegate<C> delegate(&C::CallMe, &c);
   delegate.Invoke();
} 
```

现在，既然`VoidDelegate<C>`是一个类型，拥有这些的集合可能是不切实际的，因为如果列表也包含 B 类的函数怎么办？它不能。

这就是多态性发挥作用的地方。你可以创建一个接口 IDelegate，它有一个函数 Invoke：

```
class IDelegate
{
   virtual ~IDelegate(void) { }
   virtual void Invoke(void) = 0;
} 
```

如果`VoidDelegate<T>`实现 IDelegate，您可以拥有 IDelegate 的集合，因此可以对不同类类型中的方法进行回调。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-27T17:31:59.027

```
#include <iostream>
typedef void(*callback_t)(int);

template< typename Class, void (Class::*Method_Pointer)(void) >
void wrapper( int class_pointer )
{
   Class * const self = (Class*)(void*)class_pointer;
   (self->*Method_Pointer)();
}

class A
{
public:
   int m_i;
   void callback( )
   { std::cout << "callback: " << m_i << std::endl; }
};

int main()
{
   A a = { 10 };
   callback_t cb = &wrapper<A,&A::callback>;
   cb( (int)(void*)&a);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T15:54:27.577

我现在可以通过将 C 转换为单例，将 C::m 分解为 C::m_Impl 并声明静态 C::m(int) 来将其转发到单例实例。谈论一个黑客。

# c++ - C++ 中的 Visual Studio 调试错误

> ID：516431
> 
> 赞同：1
> 
> 时间：2009-02-05T15:40:57.137
> 
> 标签：c++, visual-studio, winapi, debugging, unhandled-exception

由于某种原因，一旦我引用第三方供应商的 dll 类，集成调试器就会**导致错误。**相同的代码在构建并作为发行版运行时运行，独立运行。调试和发布的两个属性应该是相同的，因为我没有真正改变它们。我将 lib 文件添加到两个构建的路径中。我只是有：

```
ClassNameFromDll blah; 
```

当它到达这里时，我得到了这个异常：

MTGO SO Bot.exe 中 0x78a3f623 (mfc90ud.dll) 处的未处理异常：0xC0000005：访问冲突读取位置 0xf78e4568。

它出现在：afxtls.cpp，第 252 行。

这是一个 MFC 应用程序，但我并没有真正使用任何 MFC，除了一个非常简单的 gui，它触发了一个全是 win32 的事件。我正在使用 Visual Studio 2008 Express。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T16:41:12.460

查看我的 VC9 安装中的 atltls.cpp 文件，崩溃发生在这里：

```
inline void* CThreadSlotData::GetThreadValue(int nSlot)
{
    EnterCriticalSection(&m_sect);
    ASSERT(nSlot != 0 && nSlot < m_nMax);
    ASSERT(m_pSlotData != NULL);
    ASSERT(m_pSlotData[nSlot].dwFlags & SLOT_USED);   // <== crash
    // ...
} 
```

因此，在发布版本中没有发生崩溃的原因是因为 ASSERT() 在该版本中是无操作的。我不熟悉 ATL 对线程本地存储的使用，但这个断言表明某些东西正在请求一个尚未存储任何内容的插槽中的值。

那个 TLS 插槽的初始化是你的责任还是第 3 方 DLL 的责任，我不知道。

它看起来`GetThreadValue()`有一些额外的保护措施，例如它会在发布版本中为未初始化的插槽返回一个 NULL 指针（尽管我不确定这是否会得到保证） - 我敢打赌，第 3 方 DLL 依赖于那个行为（即，它检查是否返回 NULL），因此在发布版本中不会发生崩溃。请注意，供应商可能会间接使用 CThreadSlotData 类（堆栈跟踪会提供有关此的线索），因此他们可能不知道它的期望。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:45:19.637

*引人入胜的心理调试*

它在发布模式下运行良好并在调试模式下崩溃的事实让我相信你已经设法以某种方式引用了该 DLL (mfc90u.dll) 的发布版本，而不是引用库本身并允许链接器来决定要导入哪个版本。

您可能没有在此应用程序中将 MFC 用于任何东西，但如果它是作为 MFC 应用程序构建的，无论您是否需要，您都将获得所有 MFC 内容（这意味着您还必须解决 MFC 依赖问题并发布MFC DLL 与您的应用程序）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T16:21:43.887

你有可以发布的堆栈跟踪吗？它可能有一些有用的信息。

如果供应商仍然积极支持 3rd 方 DLL，那么您应该做的第一件事是查看是否可以使用一个非常简单的程序出现同样的问题，您可以将其发送给供应商并要求他们修复它。

如果供应商不可用或响应不够：

如果您有第 3 方 DLL 的源代码并且可以轻松构建您自己的版本，那么您可能拥有最好的调试方法（没有让供应商支持您）。即使您无法轻松构建可调试源代码的 DLL，您也可以追溯构造函数的汇编指令并将源代码用作映射来帮助您了解正在发生的事情。

即使您没有第 3 方 DLL 的源代码，那么我认为最好的做法是通过构造函数进行跟踪`ClassNameFromDll`以尝试找出问题所在。比较 Debug 版本与 Release 版本中的指令路径可能会有所帮助。

MFC 源代码与 MSVC 一起分发（可能不与 Express 版本一起分发，但我认为与所有其他版本一起分发）所以当您进入 MFC DLL 的代码时，您可能会发现该源代码有助于弄清楚发生了什么。

# .net - .NET Web 服务安全

> ID：516438
> 
> 赞同：0
> 
> 时间：2009-02-05T15:42:14.933
> 
> 标签：.net, web-services, security, authentication

有没有很好的例子说明以下 Web 服务如何工作？我希望 Windows/Web 客户端能够访问 Web 服务，但客户端应该传递用户名、密码和 IP 地址，并且 Web 服务应该能够确定它是否在允许的用户列表中在接受请求之前。

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T15:45:50.213

使用 WCF，您可以通过使用`TransportWithMessageCredential`安全性（通过 SSL）并提供您自己的[密码验证器](http://msdn.microsoft.com/en-us/library/aa702565.aspx)来做到这一点。但是，此时您（我被告知）无法访问客户端 IP。为此，您需要检查方法本身中的 IP - 您可以使用 来执行此操作`RemoteEndpointMessageProperty`，[就像这样](http://web.archive.org/web/20090412074418/http://nayyeri.net/blog/detect-client-ip-in-wcf-3-5)。

如果您不想走这`TransportWithMessageCredential`条路，那么将用户名和密码作为参数传递给方法也是有效的（但很笨拙）（只要传输是安全的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:46:25.127

我们有一个 WebService Login 方法来验证提供的凭据。如果用户通过验证，则返回票证值。

然后，在使用其他所有 WebMethod 时，此票证将用作 SoapHeader。 [http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapheader.aspx](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapheader.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T15:48:34.967

好吧，您可以将 Web 服务设置为使用 NT 身份验证，这将获得代表用户名和密码的令牌。允许的用户将由 NT 安全性定义。就默认情况下将在 HTTP 标头中传递的 IP 地址而言。

# visual-studio - 从 Visual Studio 复制粘贴代码，但粘贴未格式化的代码

> ID：516441
> 
> 赞同：41
> 
> 时间：2009-02-05T15:43:16.320
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-2005, copy-paste

有没有办法强制 Visual Studio 将选定的代码作为*未格式化*的文本复制到剪贴板？

当我将代码复制粘贴到 Word 或更常见的 Outlook 中时，我必须通过记事本来摆脱格式......必须有一种更简单的方法！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-05T15:50:28.707

Visual Studio 确实将未格式化的文本放在剪贴板上，但它也会放置格式化的文本。（剪贴板支持多种同步格式，并且操作系统假设它们只是相同数据的不同表示，尽管没有技术强制执行这一点。）

然后，您用来粘贴的应用程序会选择其首选格式。在 Word 中，也许在 Outlook 中，有一个“选择性粘贴”命令允许您选择要使用的格式。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-05T15:57:54.370

我的部门使用[PureText。](http://www.stevemiller.net/puretext/)坐在系统托盘中；复制文本，单击它 - 去除所有格式，留下纯文本。我确信它很像[PlainTextClipboard。](http://stackoverflow.com/questions/516441/copy-paste-code-from-visual-studio-but-paste-unformatted-code/516461#516461)

> “PureText 基本上相当于打开记事本，执行 PASTE，然后是 SELECT-ALL，然后是 COPY。PureText 的好处是使用单个热键执行所有这些操作，并将结果自动粘贴到当前窗口中。”

对此的刺激是片状的 Lotus Notes。粘贴我从网页无辜复制的 HTML 标记文本时喜欢崩溃....

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2015-07-15T18:56:52.513

如果粘贴后按 CTRL+Z 会反转为非格式化的，因为格式化实际上算作常规粘贴之后的一步。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2021-12-09T10:27:21.133

此功能可以通过 关闭`editor.copyWithSyntaxHighlighting`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-05T15:45:46.563

当我这样做时，选择附加到小剪贴板项目“匹配目标格式”的小弹出菜单选项对我有用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-06-24T12:27:42.867

从[这篇博客文章](http://codinglifestyle.wordpress.com/2013/05/17/copy-and-paste-formatting-with-visual-studios-dark-theme/)中，我得到了这些说明，用于在激活“深色主题”的情况下从 VS 复制和粘贴时摆脱黑色背景，但可以调整其中的 html 以根据需要更改其余格式（例如设置所有文本都变为黑色）。

**如果需要，安装 Productivity Power Tools**

> 打开工具 → 扩展和更新
> 
> 选择 Online (Visual Studio Gallery) 并搜索 Productivity Power Tools 2012/2013
> 
> 出现提示时下载并重新启动 Visual Studio

**生产力电动工具设置**

> 打开工具 → 选项 → 展开 Productivity Power Tools 选择 HTML Copy
> 
> 将 BeforeCodeSnippet 选项更改为：

```
<style type="text/css">.identifier {color:black !important;}</style>
<pre style="{font-family}{font-size}{font-weight}{font-style}"> 
```

> 将 EmitSpanClass 更改为：**True**
> 
> 检查 EmitSpanStyle 是否为：**True**

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-05T15:49:00.643

您可能会发现[http://www.extrabit.com/plaintextclipboard/](http://www.extrabit.com/plaintextclipboard/)是一个有用的工具。一些应用程序有一个剥离格式的粘贴选项，但你真正需要的是一个剥离格式的复制操作，这是 VS 不提供的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-04-20T17:07:42.630

在 Outlook 2007 中，我已将默认粘贴更改为仅执行文本。转到编辑器选项 | 高级 在“剪切、复制、粘贴”标题下，选择从其他程序粘贴：[仅保留文本]

如果您仍然想粘贴格式化（在我的情况下不太常见），请使用特殊粘贴...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-05T15:50:34.213

[这个 Microsoft Office 站点](http://office.microsoft.com/en-us/help/HA010429611033.aspx)提供了一种解决方法，包括编写一个宏来替换 ctrl+v 功能以始终粘贴纯文本，但这可能不是您想要的。您也可以重新映射未使用的快捷方式 (ctrl+?) 来为您提供此功能，这样您就不必一直启用/禁用宏。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-05-10T22:46:26.440

对于没有“特殊粘贴”的应用程序，您可以使用[PureText 之类的应用程序](http://www.stevemiller.net/puretext/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-03-19T12:06:13.860

**供审查的 Visual Studio 扩展[副本](https://visualstudiogallery.msdn.microsoft.com/5d17a777-0964-47e3-a6e5-3eed5b31ea93)可能对您很方便。**实际上，它不会进行无格式复制，而是应用它自己的简单的基于文本的模板。

它支持“堆栈溢出”格式，它只是删除前导空格，同时尽可能保持缩进，并引入某种标题。

从[Visual Studio 库](https://visualstudiogallery.msdn.microsoft.com/5d17a777-0964-47e3-a6e5-3eed5b31ea93)中获取并试用。

*披露：我是那个扩展的作者。如果我可以根据您的需要改进它，请通知我。*

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-09-01T09:56:29.863

适用时的技巧：

*   您不想安装扩展程序
*   您的目标应用程序没有“选择性粘贴”等选项。

* * *

您可以复制代码并将其粘贴到 VS Code 搜索框中（按 Ctrl+F 时显示）。然后从那里再次复制它。

然后，您可以将未格式化的文本粘贴到您想要的任何位置。

# cocoa - NSManagedObjectID 到 NSData

> ID：516443
> 
> 赞同：14
> 
> 时间：2009-02-05T15:44:51.307
> 
> 标签：cocoa, core-data, save

我发现了这个很棒的 NSManagedObjectID。这对于引用 Entity/NSManagedObject/NSEntityDescription 非常有用，对吧？
让我们从一个实体获取一个 ID：

```
NSEntityDescription *entity = [self newEntity];     
NSManagedObjectID *objID = [entity objectID]; 
```

所以......知道如何把它`objID`变成一个字符串吗？或者更好：NSData。实际上可以将其保存到 NSUserDefaults 中。;-)

顺便说一句： NSFetchRequest 不想在我的情况下工作。我使用了这个例子的修改版本：[answer of an old question](https://stackoverflow.com/questions/499897/save-coredata-entities-in-nsuserdefaults)。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-02-05T16:45:29.063

要获取对应于 a 的存档`NSManagedObject`URI `objectID`：

```
NSManagedObject* myMO;
...
NSURL *uri = [[myMO objectID] URIRepresentation];
NSData *uriData = [NSKeyedArchiver archivedDataWithRootObject:uri]; 
```

为了返回原始托管对象的实例，您需要一个 CoreData 堆栈，其中包含*已添加*到`NSPersistentStoreCoordinator`. 然后：

```
NSData *uriData;
NSPersistentStoreCoordinator *psc;
NSManagedObjectContext *moc; //with moc.persistentStoreCoordinator = psc.
...
NSURL *uri = [NSKeyedUnarchiver unarchiveObjectWithData:uriData];
NSManagedObjectID *moID = [psc managedObjectIDForURIRepresentation:uri];
NSManagedObject *myMO = [moc objectWithID:moID]; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T16:37:06.633

从 NSManagedObjectID[文档](http://developer.apple.com/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSManagedObjectID_Class/Reference/NSManagedObjectID.html)：

> 对象 ID 可以转换为 URI 表示形式，以后可以归档和重新创建以引用给定对象（使用 managedObjectIDForURIRepresentation: (NSPersistentStoreCoordinator) 和 objectWithID: (NSManagedObjectContext)。例如，可以存储应用程序中最后选择的组在用户中默认通过组对象的 ID。您还可以使用对象 ID URI 表示来存储跨持久存储的“弱”关系（不可能进行硬连接）。

只需将其转换为 URL，然后将其转换为字符串或数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T16:28:56.710

你看过[URIRepresentation](http://developer.apple.com/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSManagedObjectID_Class/Reference/NSManagedObjectID.html#//apple_ref/occ/instm/NSManagedObjectID/URIRepresentation)吗？将 NSURL 转换为 NSString 和 NSData 很容易。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-10-06T23:45:10.263

在归档之前，您不需要将 NSURL 转换为 NSString。只需归档 NSURL。

编辑：我最近了解到对象的 ID 可以更改，例如在迁移之后。因此，将 ID 保存到磁盘以期望稍后能够引用该对象似乎不是一个好主意。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-12-28T20:42:10.047

这是我目前发现的最干净和最短的方法，使用 4.0 中添加的`setURL`and`getURL`方法来避免对`NSKeyedUnarchiver`and的额外调用`NSKeyedArchiver`：

**二传手：**

```
 + (void)storeSomeObjectId:(NSManagedObjectID *)objectId
 {
     [[NSUserDefaults standardUserDefaults] setURL:[objectId URIRepresentation] 
                                            forKey:@"someObjectIdKey"];
     [[NSUserDefaults standardUserDefaults] synchronize];
 } 
```

**吸气剂：**

```
 + (SomeManagedObject *)getObjectByStoredId
 {
     NSURL *uri = [[NSUserDefaults standardUserDefaults] URLForKey:@"someObjectIdKey"];
     NSManagedObjectID *objectId = [self.persistentStoreCoordinator managedObjectIDForURIRepresentation:uri];
     SomeManagedObject *object = [self.managedObjectContext objectWithID:objectId];
 } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-05T19:08:03.910

正如@preston 所说，不要将 objectID 保存到磁盘，而是：

1.  在您的实体上创建一个名为“id”的新属性
2.  在您的实体父实体上创建一个名为“myEntitysMaxId”的新属性
3.  覆盖您的实体父实现“addNewMyEntityObject：”
4.  在那里，增加“myEntitysMaxId”并将该值设置为新实体“id”
5.  当您根据其属性获取实体时，请像往常一样执行此操作！

更干净更好！

# python - Python 正则表达式：将“ThisFileName.txt”转换为“This File Name.txt”

> ID：516451
> 
> 赞同：2
> 
> 时间：2009-02-05T15:46:33.740
> 
> 标签：python, regex

我试图在每个大写字母之前添加一个空格，除了第一个。

这是我到目前为止所拥有的，以及我得到的输出：

```
>>> tex = "ThisFileName.txt"
>>> re.sub('[A-Z].', ' ', tex)
' his ile ame.txt' 
```

我想要：'这个文件名.txt'

（如果我也可以摆脱 .txt，那就太好了，但我可以在单独的操作中做到这一点。）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T15:53:24.083

这里的关键概念是正则表达式中的反向引用：

```
import re
text = "ThisFileName.txt"
print re.sub('([a-z])([A-Z])', r'\1 \2', text)
# Prints: "This File Name.txt" 
```

为了以可靠的方式删除“.txt”，我建议`os.path.splitext()`

```
import os
filename = "ThisFileName.txt"
print os.path.splitext(filename)
# Prints: ('ThisFileName', '.txt') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T15:55:08.433

```
re.sub('([a-z])([A-Z])', '\\1 \\2', 'TheFileName.txt') 
```

编辑：StackOverflow 吃一些 \s，当不在“代码模式”时......因为我忘记在上面的代码之后添加换行符，所以它没有在“代码模式”中解释:-((。因为我在这里添加了那个文本我不需要改变任何东西，现在它是正确的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T16:01:31.697

另一个可能的正则表达式使用后看：

```
(?<!^)([A-Z]) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T22:49:01.890

如果文件名是`Hello123There.txt`. 因此，如果您想要在所有大写字母之前有一个空格，而不管它们前面是什么，您可以：

```
import re

def add_space_before_caps(text):
    "Add a space before all caps except at start of text"
    return re.sub(r"(?<!^)(?=[A-Z])", " ", text)

>>> add_space_before_caps("Hello123ThereIBM.txt")
'Hello123 There I B M.txt' 
```

# java - 使用大量标记对文本进行国际化的最佳实践？

> ID：516453
> 
> 赞同：5
> 
> 时间：2009-02-05T15:46:48.340
> 
> 标签：java, templates, internationalization, markup

我正在开发一个网络项目，该项目（希望）有一天会以多种语言提供（我说“希望”，因为虽然我们今天只计划了一个英语网站，但我公司的其他产品是多语言的，我希望我们足够成功，也需要它）。

我了解最佳实践（我在这里使用 Java、Spring MVC 和 Velocity）是将用户将看到的所有文本放在外部文件中，并在 UI 文件中按名称引用它们，例如：

```
#in messages_en.properties:
welcome.header = Welcome to AppName!

#in the markup
<title>#springMessage("welcome.header")</title> 
```

但是，以前我自己从来没有在一个项目上经历过这个过程，我很好奇当你有一些 UI 的部分标记很重时，最好的处理方法是什么，例如：

```
<p>We are excited to announce that Company1 has been acquired by
<a href="http://www.companydivisionx.com" class="boldLink">Division X</a>,
a fast-growing division of <a href="http://www.company2.com" class="boldLink">Company 2</a>, Inc. 
(Nasdaq: <a href="http://finance.google.com/finance?q=blah" class="boldLink">BLAH</a>), based in... 
```

我能想到的一个选择是将这个“低级”标记存储在 messages.properties 本身的消息中——但这似乎是最糟糕的选择。

我能想到的其他选择是：

*   将每个非标记内部片段存储在 messages.properties 中，例如`acquisitionAnnounce1`, `acquisitionAnnounce2`, `acquisitionAnnounce3`。不过，这似乎*很*乏味。
*   将此消息分解为更多可重用的组件，例如`Company1.name`、`Company2.name`、`Company2.ticker`等，因为这些组件中的每一个都可能在许多其他消息中重用。这可能占此特定消息中单词的 80%。

是否有任何最佳实践来处理带有大量此类标记的国际化文本？是不是只得咬咬牙忍着撕碎每一段文字的痛苦？从您亲自处理过的任何项目中，最好的解决方案是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T16:38:43.710

Typically if you use a template engine such as [Sitemesh](http://www.opensymphony.com/sitemesh/) or [Velocity](http://velocity.apache.org/tools/devel) you can manage these smaller HTML building blocks as subtemplates more effectively.

By so doing, you can incrementally boil down the strings which are the purely internationalized ones into groups and make them relevant to those markup subtemplates. Having done this sort of work using templates for an app which spanned multi-languages in the same locale, as well as multiple locales, we never ever placed markup in our message bundles.

I'd suggest that a key good practice would be to avoid placing markup (even at a low-level as you put it) inside message properties files ***at all costs!*** The potential this has for unleashing hell is not something to be overlooked - biting the bullet and breaking things up correctly, is far less of a pain than having to manage many files with scattered HTML markup. Its important you can visualise markup as holistic chunks and scattering that everywhere would make everyday development a chore since:

*   You would lose IDE color highlighting and syntax validation
*   High possibility that one locale file or another can easily be missed when changes to designs / markup filter down

Breaking things down (to a realistic point, eg logical sentence structures but no finer) is somewhat hard work upfront but worth the effort.

Regarding string breakdown granularity, here's a sample of what we did:

```
 comment.atom-details=Subscribe To Comments
    comment.username-mandatory=You must supply your name
    comment.useremail-mandatory=You must supply your email address 
    comment.email.notification=Dear {0}, the comment thread you are watching has been updated.
    comment.feed.title=Comments on {0}
    comment.feed.title.default=Comments
    comment.feed.entry.title=Comment on {0} at {1,date,medium} {2,time,HH:mm} by {3}

    comment.atom-details=Suscribir a Comentarios
    comment.username-mandatory=Debes indicar tu nombre
    comment.useremail-mandatory=Debes indicar tu direcci\u00f3n de correo electr\u00f3nico
    comment.email.notification=La conversaci\u00f3n que estas viendo ha sido actualizada
    comment.feed.title=Comentarios sobre {0}
    comment.feed.title.default=Comentarios
    comment.feed.entry.title=Comentarios sobre {0} a {1,date,medium} {2,time,HH:mm} por {3} 
```

So you can do interesting things with how you string replace in the message bundle which may also help you preserve it's logical meaning but allow you to manipulate it mid sentence.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T21:57:33.613

As others have said, please never split the strings into segments. You will cause translators grief as they have to coerce their language syntax to the ad-hoc rules you inadvertently create. Often it will not be possible to provide a grammatically correct translation, especially if you reuse certain segments in different contexts.

**Do not remove the markup, either.**

Please do not assume professional translators work in Notepad :) Computer-aided translation (CAT) tools, such as the Trados suite, know about markup perfectly well. If the tagging is HTML, rather than some custom XML format, no special preparation is required. Trados will protect the tags from accidental modification, while still allowing changes where necessary. Note that certain elements of tags often need to be localized, e.g. alt text or some query strings, so just stripping all the markup won't do.

Best of all, unless you're working on a zero-budget personal project, consider contacting a localization vendor. Localization is a service just like web design. A competent vendor will help you pick the optimal solution/format for your project and guide you through the preparation of the source material and incorporating the localized result. And of course they and their translators will have all the necessary tools. (Full disclosure: I am a translator / localization specialist. And don't split up strings :)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T16:09:51.790

首先，**不要**拆分你的字符串。这使得本地化人员翻译文本变得更加困难，因为他们看不到要翻译的整个字符串。

我可能会尝试在链接周围使用占位符：

<a href="%link1%" class="%link1class%">Division X</a>

当我将网站本地化为 30 种语言时，我就是这样做的。它并不完美，但它有效。

我认为从字符串中删除所有标记是不可能（或容易）的，您需要有一种方法来插入 URL 和任何额外的标记。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T17:22:30.783

You should avoid breaking up your strings. Not only does this become a nightmare to translate, but it also makes grammatical assumptions which may not be correct in the target language.

While placeholders can be helpful for many things, I would not recommend using placeholders for URLs. This allows you to customize the URL for different locales. After all, no sense sending them to an English language page when their locale is Argentine Spanish!

# apache-flex - 如何在 Flex 中打开真实的弹出窗口

> ID：516456
> 
> 赞同：2
> 
> 时间：2009-02-05T15:48:20.787
> 
> 标签：apache-flex, air, popup, window

我需要在我的 flex / air 应用程序中打开弹出窗口，该窗口将像**普通**应用程序窗口一样显示。我所能做的就是打开一个显示**在**我的主弹性窗口中的窗口。

是否有可能，如果没有，是否有一些解决方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T18:50:42.853

为此，您必须使用 NativeWindow。API 文档的更多信息：http: [//livedocs.adobe.com/flex/3/langref/flash/display/NativeWindow.html](http://livedocs.adobe.com/flex/3/langref/flash/display/NativeWindow.html)

```
import flash.display.NativeWindowInitOptions;
import flash.display.NativeWindowSystemChrome;
import flash.display.NativeWindowType;
import flash.display.NativeWindow;
import flash.display.StageAlign;
import flash.display.StageScaleMode;
import flash.geom.Rectangle;

var windowOptions:NativeWindowInitOptions = new NativeWindowInitOptions();
windowOptions.systemChrome = NativeWindowSystemChrome.STANDARD;
windowOptions.type = NativeWindowType.NORMAL;

var newWindow:NativeWindow = new NativeWindow(windowOptions);
newWindow.stage.scaleMode = StageScaleMode.NO_SCALE;
newWindow.stage.align = StageAlign.TOP_LEFT;
newWindow.bounds = new Rectangle(100, 100, 800, 800);

newWindow.activate(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T21:10:58.717

对于 Flex 应用程序，您需要使用[mx.core.Window](http://livedocs.adobe.com/flex/3/langref/mx/core/Window.html)。对于非 Flex ActionScript 应用程序，您应该使用[flash.display.NativeWindow](http://livedocs.adobe.com/flex/3/langref/flash/display/NativeWindow.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-21T05:14:30.373

flex 3有一个很好的[例子](http://livedocs.adobe.com/flex/3/html/help.html?content=layouts_12.html)。

# c# - 复制列表 列出

> ID：516463
> 
> 赞同：30
> 
> 时间：2009-02-05T15:49:23.750
> 
> 标签：c#, .net

给定以下类定义：

```
public class BaseClass
{
    public string SomeProp1 { get; set; }
}

public class DerivedClass : BaseClass
{
    public string SomeProp2 { get; set; }
} 
```

如何获取 a`List<BaseClass>`并将其转换为 a `List<DerivedClass>`？

在我的实际场景`BaseClass`中，有一大堆属性，我不想一个接一个地复制（然后记得在添加其他属性时进行维护）。

添加参数化构造函数`BaseClass`不是一个选项，因为此类是由 WCF 服务引用定义的。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-05T15:51:56.660

```
List<DerivedClass> result = 
    listBaseClass.ConvertAll(instance => (DerivedClass)instance); 
```

实际上，当您需要基于原始对象创建新对象时，ConvertAll 很好，当您只需要转换时，您可以使用以下内容

```
List<DerivedClass> result = 
    listBaseClass.Cast<DerivedClass>().ToList(); 
```

如果不是列表中的所有项目都可以转换为 DerivedClass ，那么请改用 OfType

```
List<DerivedClass> result =
    listBaseClass.OfType<DerivedClass>().ToList(); 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-05T15:52:35.443

您无法转换实际对象，但很容易使用转换后的内容创建一个新列表：

```
List<BaseClass> baseList = new List<BaseClass>(...);
// Fill it here...

List<DerivedClass> derivedList = baseList.ConvertAll(b => (DerivedClass) b); 
```

或者，如果您不使用 C# 3：

```
List<DerivedClass> derivedList = baseList.ConvertAll<DerivedClass>(delegate
    (BaseClass b) { return (DerivedClass) b; }; 
```

这假设原始列表实际上充满了 DerivedClass 的实例。如果不是这种情况，请更改委托以根据给定的 BaseClass 创建适当的 DerivedClass 实例。

编辑：我不知道为什么我不只是发布一个 LINQ 解决方案：

```
List<DerivedClass> derivedList = baseList.Cast<DerivedClass>().ToList(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T16:05:18.973

[（从这里](https://stackoverflow.com/questions/516467/copying-a-listbaseclass-to-listderivedclass/516492#516492)重复）

首先 - 请注意，您*可以*将构造函数（和其他代码）添加到 WCF 类中 - 您只需在部分类中执行此操作（并且不理会生成的代码）。

听起来列表中项目的**类型**需要更改 - 所以我们不能只是投射。反射是一种选择，但速度很慢。由于您使用的是 3.5，我们也许可以编写一个`Expression`来更有效地为我们做这件事......沿着[这些思路](http://groups.google.com/group/microsoft.public.dotnet.languages.csharp/browse_thread/thread/d9722a51b04300a?q=clone+linq#0edae91abc1c0f1a)，但也使用第二个类：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
static class Program
{
    class Foo
    {
        public int Value { get; set; }
        public override string ToString()
        {
            return Value.ToString();
        }
    }
    class Bar : Foo {}
    static void Main()
    {
        List<Foo> foos = new List<Foo>();
        for (int i = 0; i < 10; i++) foos.Add(new Foo { Value = i });

        List<Bar> bars = foos.ConvertAll<Bar>(Clone<Foo, Bar>);
    }
    public static TTo Clone<TFrom, TTo>(this TFrom obj) where TTo : TFrom, new()
    {
        return ObjectExtCache<TFrom, TTo>.Convert(obj);
    }
    static class ObjectExtCache<TFrom, TTo> where TTo : TFrom, new()
    {
        private static readonly Func<TFrom, TTo> converter;
        static ObjectExtCache()
        {
            ParameterExpression param = Expression.Parameter(typeof(TFrom), "in");
            var bindings = from prop in typeof(TFrom).GetProperties()
                           where prop.CanRead && prop.CanWrite
                           select (MemberBinding)Expression.Bind(prop,
                               Expression.Property(param, prop));
            converter = Expression.Lambda<Func<TFrom, TTo>>(
                Expression.MemberInit(
                    Expression.New(typeof(TTo)), bindings), param).Compile();
        }
        public static TTo Convert(TFrom obj)
        {
            return converter(obj);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T17:19:09.027

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Linq;

namespace ConsoleApplication22
{
    class Program
    {
        static void Main(string[] args)
        {
            List<BaseClass> source = new List<BaseClass>();
            source.Add(new DerivedClass { Name = "One" });
            source.Add(new BaseClass());
            source.Add(new DerivedClass { Name = "Three" });

            List<DerivedClass> result =
                new List<DerivedClass>(source.OfType<DerivedClass>());
            result.ForEach(i => Console.WriteLine(i.Name));
            Console.ReadLine();
        }
    }

    public class BaseClass
    {
    }

    public class DerivedClass : BaseClass
    {
        public string Name { get; set; }
    }

} 
```

此代码不仅会转换，而且只会包含属于派生类的实例，并排除任何不是派生类的实例。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-05T17:35:30.477

正如其他人所建议的那样，如果您有 a 的实例，则可以使用 的方法`List<BaseClass>`将其转换为 a 。`List<DerivedClass>``ConvertAll``List`

更一般地说，如果你有任何实现`IEnumerable<T>`（没有`ConvertAll`方法），你可以使用 Linq`Cast`做同样的事情：

```
IEnumerable<DerivedClass> result = listBaseClass.Cast<DerivedClass>(); 
```

如果您需要 a `List`back 而不是`IEnumerable`，您可以`ToList()`在最后添加一个呼叫。

不过，正如 Jon 所说，这一切都是假设 in 中的所有条目`listBaseClass`实际上都是 type `DerivedClass`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-09-17T06:20:23.543

仅作记录，如果有带参数的构造函数，则需要显式实例化列表中的每个项目。

使用 OP 示例：

```
public class BaseClass
{
    public BaseClass (string param1)
    {
         Param1 = param1;
    }
    public string SomeProp1 { get; set; }
    public string Param1 { get; private set; }
}

public class DerivedClass : BaseClass
{
    public DerivedClass (string param1) : base(param1){}
    public string SomeProp2 { get; set; }
} 
```

在这种情况下，代码行应该是这样的：

```
List<DerivedClass> result = listBaseClass.ConvertAll(l=> new DerivedClass(l.Param1)); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2021-12-02T15:21:59.183

正如 Jon Skeet 所指出的，使用的解决方案`ConvertAll(x => (DerivedClass)x)`只有在 的内容`List<BaseClass>`实际上是`DerivedClass`.

但是，如果`List<BaseClass>`包含 的实例`BaseClass`，那么您需要`DerivedClass`为每个元素创建一个新实例。这需要构造函数来允许这样做。

```
public class BaseClass
{
    protected int _intField;
    protected string _stringField;

    public string SomeProp1 { get; set; }
}

public class DerivedClass : BaseClass
{
    public string SomeProp2 { get; set; }

    public DerivedClass(BaseClass b)
    {
        _intField = b._intField;
        _stringField = b._stringField;
        SomeProp1 = b.SomeProp1;

        SomeProp2 = String.Empty;
    }
}

...

var source = new List<BaseClass>();
//... add elements of type BaseClass

var derived = source.ConvertAll(x => new DerivedClass(x)); 
```

# firefox-addon - Firefox 扩展：在网页中嵌入 javascript

> ID：516465
> 
> 赞同：4
> 
> 时间：2009-02-05T15:49:40.283
> 
> 标签：firefox-addon

我想在每个页面中插入一些脚本，这些脚本具有一些功能，这些功能将由该页面的修改后的 HTML 调用，使用 Firefox 扩展。我可以将 JavaScript 插入 HTML 的头部，也可以修改页面，但是 onmouseover 事件不会调用 java 脚本函数。是否有人对如何做到这一点有任何指示，在本地扩展中使用 java 脚本或作为在线资源。

没有 GreaseMonkey，我需要用我的插件来做，而不是要求用户安装greasemonkey、我的插件和脚本。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T15:52:14.913

[Greasemonkey](https://addons.mozilla.org/en-US/firefox/addon/748)就是这样做的。太棒了！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:52:29.217

制作一个[Greasemonkey](https://addons.mozilla.org/en-US/firefox/addon/748)脚本。请参阅[Userscripts.org](http://userscripts.org/)以获取大量示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T15:53:03.680

为什么不使用[Greasemonkey](https://addons.mozilla.org/en-US/firefox/addon/748)？它允许您在 Firefox 上的任何页面上执行 javascript，如果执行您输入的代码不够好，您也可以动态添加链接到头部。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T15:53:09.310

您可以使用 Firebug 修改 DOM。我不确定您是否可以在本地加载文件..听起来很恶意。此外，您可以在 Firebug 控制台（一个 la python/ruby 控制台）中运行任意 javascript 命令

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-13T16:26:16.170

有一些 Greasemonkey 到扩展的“编译器”（或扩展包装器）：

[Arantius 的 GM 编译器](http://arantius.com/misc/greasemonkey/script-compiler) [Gina Trapani 的多 GM 脚本编译器](http://smarterware.org/1342/greasemonkey-multi-script-compiler-released)

随着时间的推移，我使用[了第一个](http://arantius.com/misc/greasemonkey/script-compiler)进行了广泛的内部调整。但是，我不相信编译器会得到积极维护（默认最大版本仅为 3.0），因此可能无法与最新的 GreaseMonkey 或 FireFox 保持同步。

我认为[Gina Trapani 的](http://smarterware.org/1342/greasemonkey-multi-script-compiler-released)设计更适合针对同一域的多个脚本，但我没有使用它。

这些都不是“GreaseMonkey 解决方案”本身，因为最终用户不必安装 GreaseMonkey。他们得到了一个真实的 FireFox 扩展。核心与 GM 非常相似，但您可以随意更改或添加。

# javascript - 使用 CSS 表达式的 IE6 性能

> ID：516469
> 
> 赞同：4
> 
> 时间：2009-02-05T15:50:10.800
> 
> 标签：javascript, css, performance, internet-explorer-6, css-expressions

我们正在开发一个将出售给许多客户的网络应用程序。已经有一个客户（一家银行）决定一旦产品准备好就购买。不幸的是，由于一些沟通不畅，他们使用的唯一浏览器是 IE6。该应用程序在启动时已经考虑到它不需要支持 IE7 以下的任何其他内容。结果也相当不错——它在 IE7/FF/Opera/Safari 上完全可用。尚未在 Chrome 上进行测试，但预计会有小问题。不幸的是，毕竟现在有 IE6 的要求......

该应用程序还没有开发太远，设计也还不错，所以变化不是那么可怕。不过，这需要一些工作。

IE6 的一个优点是它支持两个非标准且非常有用的功能。首先是条件注释，它允许我包含一些仅适用于 IE6 的 CSS/JS 文件。其次是CSS表达式。也就是说，像这样的事情：

```
input
{
    background-color: expression(this.type='text'?'silver':'');
} 
```

本质上，它将 CSS 值绑定到 JavaScript 表达式。这可以轻松模拟 IE6 本身不支持的许多 CSS 功能，并且可以大大减轻我的负担。

不幸的是，IE 因其 JavaScript 性能而臭名昭著。我担心使用太多这些表达式可能会减慢速度。我也不知道银行用的是什么电脑。由于这是一个相当大的一个，我希望他们所有的分支机构都有各种各样的。我不希望在那里使用任何东西——一些简单的数学、三元运算符和查看这个元素/父元素的属性。在 IE6_override.CSS 文件中仍然会有几十个。

这会是个问题吗？

**补充：**废话，这就是我害怕的。好的，看看我可以使用多少其他技巧来解决这些缺点。谢谢，人们！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T15:58:11.767

[https://developer.yahoo.com/blogs/ydn/high-performance-sites-rule-7-avoid-css-expressions-7202.html](https://developer.yahoo.com/blogs/ydn/high-performance-sites-rule-7-avoid-css-expressions-7202.html)

原来你可能想避免使用这些，它们很危险。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T16:10:35.733

在许多页面事件上重新评估表达式，如果使用过于宽松，可能会降低整个页面的性能。（然而，他们仍然无法对可能导致他们需要重新评估的所有事件做出反应。）

MS 承认 expression() 是一个错误，并将[从未来的浏览器中删除它](http://blogs.msdn.com/ie/archive/2008/10/16/ending-expressions.aspx)。

对于 IE6 的各种 CSS 缺点，通常有更好的个别 JavaScript 解决方法。

如此多的公司仍然坚持使用可怕的 IE6，这是相当可悲的。也许如果您延迟交付项目，他们到那时就会升级！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-11-19T09:35:07.657

可以使 IE 表达式以最佳方式执行，不仅可以避免连续重新评估之类的事情，还可以将所需的样式与 IE 特定的类名挂钩，从而使 IE 特定的 CSS 更易于维护（因为表达式本身就是恶心）：

```
input
{
    1:expression(this.executedExpressions ? void 0 : this.className += (this.type == 'text' ? ' ie-text' : ''));
    2:expression(this.executedExpressions = true);
}

input.ie-text
{
    background-color:silver;
} 
```

如果您要使用 IE 表达式，这是最好的方法。（我真的应该写一篇关于它的详尽文章）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T16:00:05.147

不幸的是，CSS 表达式在性能方面非常糟糕，因为结果是不断计算的，在页面加载时一直在计算，而不仅仅是在页面第一次加载时。如果您必须使用表达式，那么您最好使用带有 onLoad 事件的标准 JavaScript。

有关更多信息，请参阅本文：[http ://www.robertnyman.com/2007/11/13/stop-using-poor-performance-css-expressions-use-javascript-instead/](http://www.robertnyman.com/2007/11/13/stop-using-poor-performance-css-expressions-use-javascript-instead/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-05T16:51:29.380

我建议你切换到任何支持 CSS 选择器的 JS 框架，这样你就可以模拟 CSS 表达式的行为

如果您在 IE6 上打开此 URL，您可以测试 JS 框架的性能

[http://slicktest.perrohunter.com](http://slicktest.perrohunter.com)

干杯

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T15:59:45.863

是的，IE 时期的表达真的很慢。想办法避免它们。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-05T16:48:21.710

我自己没有尝试过，但[IE7-js](http://code.google.com/p/ie7-js/)看起来很有希望。它声称使 IE6 与 IE7 兼容

**编辑：**顺便说一下，要为 IE6 添加一些样式，您也可以使用

```
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" media="screen"  href="ie6styles.css" />
<![endif]--> 
```

并且您始终可以使用 jquery 在包括 IE6 在内的所有浏览器中动态设置 css 属性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-08-18T22:25:17.977

如果您必须使用它们，在[一次性执行 IE CSS 表达式中](http://vacskamati.blogspot.com/2008/10/one-time-execution-of-ie-css.html)找到的技术将有助于解决性能（但不是安全）问题。

# unix - 将最后 n 行文件添加到 tar/zip

> ID：516481
> 
> 赞同：0
> 
> 时间：2009-02-05T15:52:45.333
> 
> 标签：unix, shell, zip, tar

我需要定期发送一组可能会变得非常大的日志文件，因此我只想发送每个文件的最后*n*行。

例如：

```
/usr/local/data_store1/file.txt (500 lines)
/usr/local/data_store2/file.txt (800 lines) 
```

给定一个包含名为 的所需文件列表的文件`files.txt`，我想创建一个存档（tar 或 zip），其中包含每个文件的最后 100 行。

我可以通过使用尾部文件创建一个单独的目录结构来做到这一点，但是当可能发生一些管道魔术来完成它时，这似乎是一种资源浪费。还必须保留完整的目录结构，因为不同目录中的文件可以具有相同的名称。

如果可能的话，我希望解决方案是一个 shell 脚本，但是 perl（不添加模块）也是可以接受的（这适用于没有安装 ruby​​/python/etc.. 的 Solaris 机器。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-18T20:24:55.797

您专注于特定的实现，而不是着眼于更大的图景。

如果最终目标是在目标机器上获得文件的精确副本，同时尽量减少传输的数据量，那么您应该使用 rsync，它仅自动发送文件中已更改的部分，同时也可以自动压缩在接收的同时发送和解压缩。

在目标机器上运行 rsync 不再需要标准 sshd 的守护进程，并且要设置没有密码的自动传输，您只需要使用公钥身份验证即可。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:58:07.320

你可以试试

```
tail -n 10 your_file.txt | while read line; do zip /tmp/a.zip $line; done 
```

zip文件在哪里`a.zip`，10是`n`或

```
tail -n 10 your_file.txt | xargs tar -czvf test.tar.gz -- 
```

对于 tar.gz

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T20:03:21.147

使用**logrotate**。

看看里面`/etc/logrotate.d`的例子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T16:06:08.957

没有管道魔术，你必须创建你想要的文件夹结构并压缩它。

```
mkdir tmp
for i in /usr/local/*/file.txt; do
    mkdir -p "`dirname tmp/${i:1}`"
    tail -n 100 "$i" > "tmp/${i:1}"
done
zip -r zipfile tmp/* 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-05T16:01:13.740

为什么不将您的日志文件放在 SCM 中？

您的接收者在他的机器上创建了一个存储库，他从该存储库中通过签出文件来检索文件。

您只需提交文件即可发送文件。只会传输差异。

# c# - 从图像创建半透明光标

> ID：516494
> 
> 赞同：9
> 
> 时间：2009-02-05T15:54:27.607
> 
> 标签：c#, winforms, transparency, mouse-cursor

是否可以从图像创建光标并使其半透明？

我目前正在拍摄自定义图像并覆盖鼠标光标图像。如果我能把它做成半透明的就好了，但不是必须的。销售人员喜欢闪亮的。

目前正在做这样的事情：

```
Image cursorImage = customImage.GetThumbnailImage(300, 100, null, IntPtr.Zero);
cursorImage.SetResolution(96.0F, 96.0F);
int midPointX = cursorImage.Width / 2;
int midPointY = cursorImage.Height / 2;
Bitmap cursorMouse = GetCursorImage(cursorOverlay);
Graphics cursorGfx = Graphics.FromImage(cursorImageCopy);
cursorGfx.DrawImageUnscaled(cursorMouse, midPointX, midPointY);

Cursor tmp = new Cursor(cursorImage.GetHicon()); 
```

[替代文字 http://members.cox.net/dustinbrooks/drag.jpg](http://members.cox.net/dustinbrooks/drag.jpg)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-09-11T06:52:19.273

我试过下面的例子，它工作正常......

```
 public struct IconInfo
    {
        public bool fIcon;
        public int xHotspot;
        public int yHotspot;
        public IntPtr hbmMask;
        public IntPtr hbmColor;
    }

    [DllImport("user32.dll")]
    [return: MarshalAs(UnmanagedType.Bool)]
    public static extern bool GetIconInfo(IntPtr hIcon, ref IconInfo pIconInfo);

    [DllImport("user32.dll")]
    public static extern IntPtr CreateIconIndirect(ref IconInfo icon);

    public static Cursor CreateCursor(Bitmap bmp, int xHotSpot, int yHotSpot)
    {
        IntPtr ptr = bmp.GetHicon();
        IconInfo tmp = new IconInfo();
        GetIconInfo(ptr, ref tmp);
        tmp.xHotspot = xHotSpot;
        tmp.yHotspot = yHotSpot;
        tmp.fIcon = false;
        ptr = CreateIconIndirect(ref tmp);
        return new Cursor(ptr);
    } 
```

我已经把它放在按钮点击事件上（你可以从你喜欢的地方打电话）：

```
Bitmap b = new Bitmap("D:/Up.png");
this.Cursor = CreateCursor(b, 5, 5); 
```

Up.png 图像在 Adob​​ePhotoshop 中以 75% 的不透明度保存。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-04T21:39:35.643

在我的头顶上（我会先尝试）：

1.  创建与原始大小相同但具有 ARGB 结构的新位图
2.  drawimage：现有位图到新位图
3.  访问原始位图数据，并将 A 字节替换为 128

你应该在那里有漂亮的半透明位图。

如果性能允许，您可以扫描完全透明的像素并将它们的 A 设置为零！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-08-09T13:42:23.267

如果您想“即时”设置自定义鼠标光标位图的透明度，您可能会发现此功能很有帮助。它使用颜色矩阵来设置任何给定位图的透明度，并将返回修改后的位图。要获得一点透明度，**TranspFactor**应该在 225 到 245 之间，试试吧。（需要导入 System.Drawing 和 System.Drawing.Imaging）

```
public static Bitmap GetBMPTransparent(Bitmap bmp, int TranspFactor) 
```

{

```
Bitmap transpBmp = new Bitmap(bmp.Width, bmp.Height);
using (ImageAttributes attr = new ImageAttributes()) {
    ColorMatrix matrix = new ColorMatrix { Matrix33 = Convert.ToSingle(TranspFactor / 255) };
    attr.SetColorMatrix(matrix);
    using (Graphics g = Graphics.FromImage(transpBmp)) {
        g.DrawImage(bmp, new Rectangle(0, 0, bmp.Width, bmp.Height), 0, 0, bmp.Width, bmp.Height, GraphicsUnit.Pixel, attr);
    }
}
return transpBmp; 
```

}

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2012-09-21T17:23:47.837

这很容易，我不使用 API。

代码是

```
 Bitmap img = new Bitmap(new Bitmap(@"image.png"), 30, 30); //this is the size of cursor

  Icon icono = Icon.FromHandle(img.GetHicon()); //create the Icon object 

  Cursor = new Cursor(icono.Handle); //the icon Object has the stream to create a Cursor. 
```

我希望这是你的解决方案

# language-agnostic - 结合 min() 和 max() 的函数是否有“规范”名称？

> ID：516500
> 
> 赞同：24
> 
> 时间：2009-02-05T15:55:59.960
> 
> 标签：language-agnostic, standards, nomenclature

我发现我经常最终编写一个我总是称之为“ `clamp()`”的函数，它是一种和的`min()`组合`max()`。此功能是否有标准的“规范”名称？

它总是看起来像这样：

```
function clamp($val, $lower, $upper)
{
  if ($val < $lower)
    return $lower;
  else if ($val > $upper)
    return $upper;
  else
    return $val;
} 
```

或者简单地使用内置`min()`和`max()`函数：

```
function clamp($val, $lower, $upper)
{
  return max($lower, min($upper, $val));
} 
```

存在变体：您还可以检查无效输入 where `lower > upper`，然后抛出异常或反转输入。或者您可以忽略输入的顺序并将其称为三个函数的中值，但这可能会造成混淆。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-05T16:00:12.073

**夹子**是个好名字。

让我们把它作为标准。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T16:06:22.653

在某些语言中，您有功能限制

num = 限制（val，最小值，最大值）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T16:26:26.543

```
clip(val, lo, hi) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T16:43:32.390

我们`pin`在这里使用。实际上，我们使用`pin`简单的范围和`clamp`其他东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T15:59:07.270

我只是去一个函数名“rangeCheck”

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-10-17T19:14:41.733

**绑定**呢？

```
bound(min, val, max) 
```

还是[**约束**](http://processing.org/reference/constrain_.html)？

```
constrain(val, min, max) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-04-17T20:18:44.363

您如何看待**InRangeClosestTo** (Number, RangeLowerBound, RangeUpperBound) 或**ClosestInRange** (Number, LowerBoundOfRange, UpperBoundOfRange) 之类的东西？他们的意思是“给我最接近数字的范围内的元素”，我希望这是显而易见的。

这个概念比一个有两侧但不多的 Clamp 更精确，或者如果数字不在范围内，可能不想返回任何内容的 Limit 或 Bound，

对我来说，它们比我看到的其他部分更清晰；虽然理解它们可能需要几秒钟的时间，但您只需要对名称进行推理，最多可以简单地看一下评论以确认；当你看到它有多精确时，这很好（它是精确的，对吧？）。

您可能只会怀疑范围是否包含在内，但我认为大多数人会正确地认为它是包含在内的。或者，您可以使用 InInclRangeClosestTo 和 InExclRangeClosestTo，尽管我没有看到独占范围有很多用途。

当然，如果你想使用它们，你应该有一个自动完成的 IDE。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-05T16:41:57.997

中位数

因为它泛化到更多的值。

# python - 是否有与 Linux/Unix“折叠”命令等效的 Vim？

> ID：516501
> 
> 赞同：6
> 
> 时间：2009-02-05T15:56:00.037
> 
> 标签：python, vim, formatting, comments, word-wrap

我意识到 Vim 中有一种隐藏/折叠行的方法，但我正在寻找的是一种选择文本块并让 Vim 在第 80 列或附近换行的方法。

大多数情况下，我想在向现有评论添加一些文本并将其推送超过 80 个字符的情况下将其用于评论。如果它也可以在换行时在行首插入注释标记，那就太好了。此外，我更喜欢不自动包装整个文件的解决方案，因为在将结构化代码保持在 80 个字符的行长以下时，我使用了一个特定的约定。

这主要用于 Python 代码，但我也有兴趣学习该问题的一般解决方案，以防我必须将其应用于其他类型的文本。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-05T16:02:09.947

```
gq 
```

它由 textwidth 选项控制，`":help gq"`有关详细信息，请参阅。

`gq`默认情况下将在当前行上工作，但您可以使用`Ctrl`+突出显示可视块`V`并像这样格式化多行/段落。

`gqap`执行当前的“段落”文本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T12:12:52.173

看看 ":help =" 和 ":help 'equalprg"

```
:set equalprg=fold 
```

在正常模式下 == 通过外部折叠程序过滤当前行。或者视觉选择一些东西并点击=

# visual-studio-2008 - 如何在 TFS 的同一路径上添加多个项目/解决方案

> ID：516508
> 
> 赞同：2
> 
> 时间：2009-02-05T15:57:57.193
> 
> 标签：visual-studio-2008, tfs

我正在开发一个 C# 项目，该项目必须为多个平台（.Net 和 CF.Net）构建，并且根据过去的经验，我发现最适合我的方法是同时存在多个并行解决方案每个平台对应的同一个文件夹。所有代码文件、资源等都由这些项目/解决方案共享，并且对于所有并行项目都是通用的。

例如。

```
    /解决方案文件夹  
        我的解决方案.sln  
        MySolution_CE.sln  
        /我的项目  
            我的项目.csproj  
            MyProject_CE.csproj  

```

现在的问题是，一旦我将 MySolution.sln 添加到源代码管理中，我就无法添加 MySolution_CE.sln。它说的是“不能在同一路径上添加两个解决方案”。

**<edit>**
为了回答 ctake 的问题，我试图通过右键单击解决方案并说“添加到源代码管理”来从 VS2008 添加解决方案。

另外我忘了提到我还是手动添加了解决方案，但是 VS2008 并没有绑定到这个解决方案，即文件不能从 VS2008 中的这些“强制”解决方案中签入/签出。
**</编辑>**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-15T19:15:22.753

尝试使用命令行工具 - tf.exe，然后在打开未绑定的解决方案后使用 File/Source Controls/Change Source Control... 对话框设置绑定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T16:37:18.057

好的，这是解决此问题的可能方法。不用说它很不优雅，但它仍然可以工作，而无需经历为 VS2008 编写自定义源代码控制插件的痛苦......

步骤：

1\. 在 Visual Studio 中打开 MySolution.sln，然后说添加到源代码管理，然后签入第一个版本。

2\. 转到文件-> 源代码管理-> 更改源代码管理并取消绑定与源代码管理的解决方案。

3\. 关闭 MySolution.sln

4\. 打开 MySolution_CE.sln

5\. 转到 File->Source Control->Change Source control 并通过单击 Bind 从源控制绑定解决方案 如果 dir 结构，VS2008 应该会自动选择正确的绑定问题中提到的得到遵守。

6\. 将 CE 特定文件添加到解决方案/项目并进行初始签入。

7\. 每次您希望从其他解决方案签入时重复此绑定/取消绑定操作（我知道这很痛苦）。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-06T22:33:38.080

如果您使用的是 TFS + 您已经设置了工作区映射，则“将解决方案添加到源代码管理”向导并不是必需的。（如果您使用的是另一个源代码控制系统，或者解决方案文件夹未映射，则不是这样。）

您需要做的就是使用 Change Source Control 对话框将绑定写入 sln/proj 文件。与成熟的向导不同，CSC 对话框不应该有任何检查阻止您绑定 >1 并排存在的解决方案。

# javascript - 有没有人能够动态编辑 OpenWYSIWYG 控件中的文本？

> ID：516514
> 
> 赞同：2
> 
> 时间：2009-02-05T15:59:06.833
> 
> 标签：javascript, openwysiwyg

就像问题说的那样，有没有人能够使用[OpenWYSIWYG](http://www.openwebware.com/)控件并使用 JavaScript 动态更改其内容？这很困难，因为它通过使 textarea 不可见并插入某种 iframe 并将其用作编辑器，从而将您的 textarea 转换为 WYSIWYG 编辑器。

我试过这样的代码但失败了：

```
document.getElementById("textarea-wysiwyg").value = "BLARG"; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T18:12:53.847

如果您知道这是页面上唯一的框架，那么您可以执行以下操作：

```
window.frames[0].document.body.innerHTML = 'blarg' 
```

当我在[http://www.openwebware.com/wysiwyg/demo.shtml](http://www.openwebware.com/wysiwyg/demo.shtml)在 firebug 上尝试时，上述方法有效。

希望这可以帮助...

# sql-server - Sql Server（实体框架）： created_at ， updated_at 列

> ID：516517
> 
> 赞同：4
> 
> 时间：2009-02-05T15:59:12.607
> 
> 标签：sql-server, ruby-on-rails, entity-framework

我想我应该提到我正在尝试让 Entity Framework\SQL 服务器做一些我习惯于从 Rails 来的事情。我真的只是想知道为我在数据库中插入/更新的记录自动创建 created_at 和 updated_at 列值的“最佳”方式。

现在我已经加入了**ObjectContext.SavingChanges**事件，并且一切正常。然而，在我编写并测试了我的代码之后，我意识到可能有更好或更快的方法来做到这一点。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T16:23:14.133

一种方法是使用插入/更新触发器将 created_at 和 updated_at 列设置为当前时间。

**插入触发器**看起来像这样：

```
CREATE TRIGGER [dbo].[inserted_myTable] ON [dbo].[myTable] AFTER INSERT
AS 
BEGIN
    SET NOCOUNT ON;
    UPDATE [dbo].[myTable] Set AdmitDateTime = GetDate() where pkid in (SELECT pkid FROM Inserted)
END 
```

**更新触发器**看起来像这样 ：

```
CREATE TRIGGER [dbo].[updated_myTable] ON  [dbo].[myTable] AFTER UPDATE
AS 
BEGIN
    SET NOCOUNT ON;
    UPDATE [dbo].[myTable] Set AdmitDateTime = GetDate() where pkid in (SELECT pkid FROM Inserted)
END 
```

触发方法的一个优点是时间/日期将始终位于同一时区。另一个优点是，如果有人在您的应用程序之外修改了数据库记录，这些字段仍然会更新。

# windows-mobile - 使用 HTMLControl 更改用户代理字符串

> ID：516519
> 
> 赞同：0
> 
> 时间：2009-02-05T15:59:38.533
> 
> 标签：windows-mobile

我正在编写一个托管 HTML 控件的应用程序（VS2005，C++，针对 WM5）。在向服务器发出请求时，我可以修改此控件使用的用户代理吗？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-02-05T16:06:00.393

[http://msdn.microsoft.com/en-us/library/system.web.httpresponse.addheader.aspx](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.addheader.aspx)

使用 AddHeader 修改用户代理。

由于您处于控件中，因此使用它来获取当前的 HttpResponse 对象。this.Page.Response.AddHeader

# perl - 为什么现在我已经迁移到新服务器，WebBBS 不能工作？

> ID：516521
> 
> 赞同：0
> 
> 时间：2009-02-05T15:59:56.147
> 
> 标签：perl, apache, webbbs

我已将 WebBBS 板从一台服务器移至另一台服务器。自从董事会不工作。每当我尝试访问该板时，我都会收到 Apache 错误。甚至不知道从哪里开始调试，我不是 Perl 人。文件路径保持不变，不涉及任何数据库。

[http://gammonline.com/members/board/](http://gammonline.com/members/board/)

有任何想法吗？

经过一些测试，我认为问题与位于该文件夹中的 index.cgi 有关（重命名时未收到错误）。

谢谢，

罗伊。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T16:14:30.843

> 服务器错误日志中可能提供有关此错误的更多信息。

说明一切。您必须找到错误日志并查看它。

如果您使用的是 CGI，第一步是检查您是否已授予它正确的权限，因此它完全是一个可执行脚本。

```
chmod 755 index.cgi 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T16:07:11.233

这是由 Apache 配置错误引起的。设置 LogLevel 调试和 tail -f 错误日志。这可能与覆盖的 .htaccess 权限有关，或者，它需要一个未加载的模块。错误日志会立即告诉您。

# edi - 为什么仍然使用EDI，如何处理？

> ID：516524
> 
> 赞同：18
> 
> 时间：2009-02-05T16:00:06.770
> 
> 标签：edi

为什么面对更易于使用的技术仍然使用这种古老的格式？它是否提供了一些我没有看到的好处？似乎大量供应商仍然只提供这种格式的数据，而不是像 XML 这样更易于管理和使用的东西；至少提供这两种格式对我来说是有意义的。

此外，当您别无选择只能使用 EDI 时，有哪些好的方法来处理和使用它？像 BizTalk 这样的东西是不可能的，因为它太贵了。是否有任何免费/开源应用程序可以使 EDI 更易于使用？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-05T16:05:27.087

一旦您熟悉了 EDI 使用的分隔符，就不难理解 EDI。您可能还会问自己，为什么还有人会使用 CSV 或制表符分隔的数据。

答案可能是这些格式是由委员会定义并在某个行业标准化的“领域特定语言”，并且已经投入了大量资金来支持这些格式。再次抛出所有这些的商业案例在哪里？

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-05T16:05:21.190

一个词，惯性。由具有不同议程的不同公司和组织之间的委员会开发 EDI 格式是一场噩梦（很遗憾我曾去过那里）。

要求他们放弃这些，让另一轮委员会同意 Web 服务 API 标准将需要更长的时间，你如何向非技术委员会推销用另一种电子格式替换的想法？它给了他们什么可能的商业优势。最初，电子交换的好处是显而易见的，但以另一种替代的好处却不是。我们在这里谈论的是真正的大公司。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-05T16:45:55.477

您可能对以下项目感兴趣：

[http://bots.sourceforge.net/en/index.shtml](http://bots.sourceforge.net/en/index.shtml) [谷歌代码存档](https://code.google.com/archive/p/bots/source/default/source)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-05T16:05:35.433

切换到 XML 会给您带来什么——更容易调试的行格式？

通常你设置它然后离开它，没有太多需要使用原始 EDI 提要，当然不足以放弃标准并重新开始。
有很多标准，比如传真，可以变得更具可读性，但没有真正迫切需要改变它们。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-05T16:35:47.883

因为它是一个正式建立的标准（实际上是一套非常庞大和全面的标准）。这就是标准所声称的好处之一——你不需要在很长一段时间内改变任何东西。

要改变它，需要两个或更多（通常是成千上万）贸易伙伴（可能包括你的所有竞争对手）之间达成一致。

EDI 格式具有更高的信噪比（因为它们是在被认为重要的时候设计的。）了解并理解 EDI 的人会看着您的 XML 并说“牛肉（数据）在哪里？”

很少有开发人员编写自己的解析器。有许多优秀的映射器可用（并且内置了许多遗留和企业应用程序）。因此，您的痛苦可以得到很多缓解（包括 SourceForge 上的至少一个开源应用程序）。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-05T16:37:16.397

一点信息给所有感兴趣的人。EDI 基本上是一种由委员会设计的数据交换格式，它不仅规定了数据格式（如 XML）的规则，而且还开始定义可能在 2 家公司之间发送的每个文档。因此，对于可以在公司之间交换的任何数据，他们提出了每个文件中应该包含的内容的确切定义。当然，没有人能预见到两家公司想要交换的每一条数据。因此，您最终会发现公司使用为一件事定义的字段，用于其他一些信息。

您最终得到的是一种极其复杂的数据格式，其中许多使用它的人不遵循标准，因为他们需要发送标准不考虑的自定义信息。所以最后，您仍然需要与每家您想打交道的公司交谈，并找出他们实现的所有小特性，就像您去找具有自定义 XML 接口的人一样。除了在 EDI 的情况下，格式很难解析，甚至更难写好，所以你最终会做一大堆工作只是为了发送一个文档，而在使用自定义 XML 解决方案进行同样的思考时会导致少很多倍的问题。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-05T16:06:09.503

“如果它没有坏，就不要修理它。”

这些组织中的大多数都在使用 EDI 处理大量数据，并且不会在没有令人信服的理由的情况下更改为更现代的东西。遗憾的是，为第三方开发人员提供便利通常并不符合条件。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-11-04T14:47:22.670

恕我直言，EDIFACT 存在几个问题。

1.  从中解析或生成对象模型并不容易。这可能不再是一个大问题，因为现在有很好的系统可以为你做这件事，例如 smooks.org
2.  这并不容易阅读。你习惯了，但 XML 更容易阅读
3.  验证不是那么容易（与验证 XML 相比）
4.  有太多不同的版本和口味，D95B、D96B、D00A、D00B 等。
5.  但我认为最大的问题是每个人使用标准的方式不同。它们使用相同的“格式”，但字段的定义不同。我们使用 EDIFACT 来发送和接收来自集装箱码头的消息，它们都有细微的差别。例如，他们都将使用 D95B CODECO，但对于某些终端，某个部分是强制性的，而对于另一个部分，它是可选的，甚至不允许存在。然后你有使用相同但其中的内容不同的段。

所以总结一下：这是一种颈部疼痛。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-02-05T16:09:22.413

EDI 是一种非常紧凑的格式，通常用于使数据交换中的带宽使用尽可能小。例如，德国海关在其 ATLAS 系统中使用它来每天交换大量数据。

它难以解析且难以阅读，但如果结果数据的大小很重要，那么它可能是一个不错的选择，并且大多数大型业务应用程序都支持它。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-05T16:02:32.397

旧版支持

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-05T16:25:31.397

EDI 在许多行业中非常多产。用更新的技术替换已经在使用的技术将会非常昂贵。

考虑到这一点，沃尔玛使用 EDI 与其供应商、商店、分销链等进行通信。我猜他们与数以万计的供应商打交道。他们每个人都在 EDI 技术上投入了数千美元。如果 Walmart 决定切​​换到 XML，它的决定会影响成千上万的公司，而不仅仅是 Walmart。

对于任何 EDI 用户来说都是如此。毕竟，这是贸易伙伴之间使用的标准。

我同意，EDI 使用起来很痛苦。但是“回到过去”，这就是我们所拥有的一切。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-12-04T10:57:46.287

在文档交换方面，Edifact 是最好的标准之一。大多数问题来自贸易伙伴发送非标准化文件。

是的，这是一种有点奇怪的格式，如果您不知道来龙去脉的话，使用起来会很乏味，但 XML 也是如此。

您真的想要 XML 而不是 Edifact？看看 peppol（泛欧在线公共采购）正在制定的臃肿、难以阅读的 XML 标准。

是的，如果您在系统中没有任何错误，那么它工作得很好而且花花公子，一旦您习惯了这种格式，排除故障就会比故障排除 UBL 文档容易得多。

你说你有 0.00 美元可用于该项目？您确实应该调查公司中完成的手动工作量，EDI 可以提供的成本效益分析非常方便。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-09-27T14:16:13.103

哪些类型的信息可以通过 EDI 交换？

通过 EDI 可进行多种类型的业务信息交换，包括：

-•预订信息

-•提单信息

-•发票

-•电子转帐

-•到达通知信息

-•发货状态信息

选择 EDI 对我的公司有何好处？-•它简化了您与 APL 之间的通信流程

-•无需重新键入数据，从而消除错误和重新检查信息的需要

-•它消除了纸张处理和文件存储的需要

-•它提高了周转时间和数据的准确性

-•无需传真

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-02-05T16:41:45.857

一种解决方案，虽然会花费您，但要找像[ADX](http://www.adx.com/)这样的公司，该公司拥有可用于将 EDI 格式转换为更令人愉悦的格式（如 CSV）的工具。根据您正在进行的交易量和类型，这既可以负担得起，也可以减轻很多压力。我过去使用过他们的产品，虽然设置起来有点麻烦，但它们确实工作得很好，而且非常稳定。由于 EDI 的历史，您可能会找到数百家提供类似服务的其他公司。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-05T16:13:45.727

EDI 在 XML 之前就已经存在。除了双方可以预先协商适用于他们双方的 EDI 格式这一事实之外，您还必须考虑 VAN（增值网络）的部分。

在某些情况下，VAN 执行消息验证，甚至读取消息并对其执行操作，例如根据其内容将其复制到其他方。

真正使用 EDI 的唯一原因是因为“它一直都是这样做的”，因此有很多现有的基础设施来支持它。为什么在不需要的时候切换到 XML？又如何说 XML 不会被 JSON 取代，而 JSON 会被其他东西取代？

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-11-07T09:10:17.743

另一个原因是订单等业务消息。发票，信用票据等交易中有很多财务价值，它们需要安全，但也许更重要的是，它们需要端到端的验证和验证以及不可否认性。

例如，我向您发送价值 1/2 百万欧元的商品订单，您将商品发送给我，然后我“丢失”订单信息并告诉您我没有付款。标准和 VANS 的结合使这几乎是不可能的，或者至少有如此多的审计线索，以至于可以跟踪问题。这就是为什么“哦，让我们使用 xml 和互联网而不是 EDIFACT 和 VANS”往往会失败的原因。正如其他人回答的那样，惯性，但它是建立在稳定有效、安全、可靠且易于理解的系统中的惯性。

以便宜的价格做这件事并不总是一种选择。

如果我在 87 年第一次实施 EDI 时有什么安慰的话，那么几乎没有任何软件，所以我得到了 Interbridge 表，并使用 Cognos 软件和 HP Mini 为英国 TRADACOMS 标准编写了我自己的解析器，它运行良好。假设您与其他 EDI 合作伙伴进行交易，成本可能来自需要使用 VAN。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-07-09T16:53:43.000

我在 2 个关于海运物流的项目中使用了 EDI（ANSI X12 和 EDIFACT），发现它们非常有用，因为大多数海运承运人和贸易伙伴都接受它们作为不同系统之间通信的标准方式。

因此，EDI 格式仍在使用并将继续使用，因为它是一个已建立的标准，并且有数千家公司围绕它们开发了系统，替换它们确实是一件大事。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-05T16:03:47.743

我也不得不使用 EDI，我同意。我们使用 BizTalk 对其进行映射，效果很好。许多系统都建立在 EDI 之上（远在 XML 之前）。

# svn - 将 TortoiseSVN 与 Redmine 集成

> ID：516542
> 
> 赞同：4
> 
> 时间：2009-02-05T16:03:22.597
> 
> 标签：svn, tortoisesvn, trac, redmine, issue-tracking

我正在尝试将 Redmine 与 TortoiseSVN 集成，但我无法做到这一点，因为 TSVN 总是给我这个错误：

> “没有可用的问题跟踪器提供商。”

我按照以下步骤操作：

*   在我的项目文件夹属性中，我添加了 'bugtraq:url -> `http://myweb/../issues/show/%BUGID%`'
*   在 Redmine 设置中，我在存储库选项卡中添加了 SVN，Redmine 显示我的存储库没有任何问题。

我不确定是否缺少任何步骤或我必须做些什么来进行集成。

或者我应该看一下trac，因为它看起来更稳定并且有更好的支持？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-09T14:46:38.040

关于 Stefan 的帖子的更多细节：

对于您正在尝试做的事情，仅设置 bugtraq:url 是不够的。您还需要设置“bugtraq:message”属性或“bugtraq:logregex”属性。例如，在我们的 redmine 设置中，我们允许在提交消息中包含以下项目：

*   **参考**：参考，参考，问题ID
*   **修复**：修复，关闭，修复错误

因此，我们使用 bugtraq:logregex 以获得最大的灵活性：

```
([Cc]loses|[Ii]ssue[Ii][Dd]|[Rr]eferences|[Rr]efs|[Ff]ixes(\s[Bb]ug)?)\s?#(\d+)
\d+ 
```

这涵盖了我们所有的选择。

通过这样做，乌龟会突出显示链接到 redmine 的提交评论部分，并将数字变成一个链接，您可以单击该链接转到实际的 redmine 问题。

更高级的选项是允许您直接从 redmine 中选择一个打开的错误。正是这个功能需要在你的机器上安装一个特定的插件，但据我所知，这样的 redmine 插件不存在，所以我们目前有点坚持使用基本选项。当有人编写这样的插件并安装它时，您将能够像您当前尝试的那样进入“问题跟踪器集成”，并且一切正常。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-05T17:19:47.263

请阅读[文档](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-bugtracker.html)。

错误“没有可用的问题跟踪器提供程序”表示您尚未为 TSVN 安装问题跟踪器[插件](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-bugtracker.html#tsvn-dug-bugtracker-ref)。

bugtraq: 属性不需要插件。您可以在没有插件的情况下使用那些（但您将无法在提交对话框中获取未解决问题的列表）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-10T11:20:32.130

您可以尝试使用现有[的 Redmine Tortoise 插件。](http://code.google.com/p/turtlemine/)

# .net - 为什么百分比的标准数字格式包含空格？

> ID：516549
> 
> 赞同：11
> 
> 时间：2009-02-05T16:04:51.190
> 
> 标签：.net, number-formatting

## 背后的故事

我有一些十进制值，作为较大字符串的一部分，我在网页上显示为字符串。我开始使用标准数字格式字符串来输出它。例如

```
myDecimal.ToString("P0") 
```

`0`之后告诉它`P`我不想要小数位。就目前而言，这很有效，因为我的输出最终看起来像：

> 根据分阶段最低公司贡献率 2% 计算如上

空间问题

我真的想摆脱数字和百分号之间的空间，因为在某些情况下它最终会跨行分裂。而且，我更喜欢 % 来对接这个数字。

## 可能的解决方法

1.html/css解决方案

我可以在它周围放一个`<nobr>`标签或一个`<span style="white-space: nowrap;">`。但是，这感觉很尴尬，而且无论如何我更喜欢 % 来匹配这个数字，因为我认为它看起来更好。这就是我们在这片森林的脖子上的报告中写它的方式，所以这就是我希望它在网页上的方式。

2.自定义格式字符串

我将最终使用自定义数字格式字符串，例如

```
myDecimal.ToString("0%") 
```

## 问题

在数字和百分号之间用空格显示百分比是否更常见？这会让我感到惊讶，但它可能是。

有没有办法告诉**标准数字格式字符串**我不想要空间？

使用**自定义数字格式字符串**而不是**标准数字格式字符串**有什么缺点吗？

好的 - 我承认，这不仅仅是一个问题 - 如果您全部回答，则额外加分。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-12-02T20:45:26.337

这对我有用：

```
System.Globalization.CultureInfo  newCulture = (System.Globalization.CultureInfo)System.Threading.Thread.CurrentThread.CurrentCulture.Clone();
newCulture.NumberFormat.PercentPositivePattern = 1;  // Avoid putting a space between a number and its percentage
System.Threading.Thread.CurrentThread.CurrentCulture = newCulture; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T16:25:52.240

查看[http://www.nasdaq.com/](http://www.nasdaq.com/)或[http://finance.yahoo.com/](http://finance.yahoo.com/)似乎数字后面没有空格的百分号很常见:)

看看[http://msdn.microsoft.com/en-us/library/system.globalization.numberformatinfo.percentpositivepattern.aspx](http://msdn.microsoft.com/en-us/library/system.globalization.numberformatinfo.percentpositivepattern.aspx)

它可能取决于文化，默认（不变）beeing n %

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T23:03:05.743

要更改默认的 PercentPositivePattern 值，您必须创建一个新的 CultureInfo 对象并使用它来代替默认值，默认值可能是“en-us”。（或者，您可以在 Web.config 中指定“en-za”作为文化，但出于明显的原因，我不建议这样做。）

[ASP 论坛](http://forums.asp.net/t/1103759.aspx)上有一篇很棒的文章解释了如何完成所有这些工作。请参阅第三张海报 (m0brien) 编写的代码。我将他的确切代码复制到我的母版页的 Page_Load 方法中，这样我就不必再考虑它了。

当然，您总是可以只执行 String.Format().Replace(" ", String.Empty)，但您必须在整个站点中执行此操作。另外，老实说，当你可以卷起袖子玩弄你的全球化价值观时，乐趣在哪里？？？

# .net - 如何检索元数据以获取 sql server 存储过程的返回值

> ID：516552
> 
> 赞同：1
> 
> 时间：2009-02-05T16:05:03.233
> 
> 标签：.net, sql-server, code-generation, metadata

我想从 .NET 代码分析 SQL Server 存储过程，以检索它返回的数据/列的元数据（不是 OUTPUT 参数）。就像您在 DataSet i VisualStudio 上拖放 sp 时一样，它会自动生成列。对于我正在测试的一些代码生成，它可能对我有用。

这些过程包含简​​单的选择语句，如 SELECT a,b FROM c，我想获取关于 a 和 b 的元数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T16:09:51.790

您可以使用`SET FMTONLY ON`（并执行它） - 但这有点命中注定。它不涵盖所有场景（分支等） - 并且仍然可以执行一些代码（扩展存储过程等）。

或者-使用表值函数（udfs）-它们具有更丰富/更正式的元数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-02T23:42:23.733

在 SQL Server 2012 /Denali 中，您可以使用[`sys.dm_exec_describe_first_result_set_for_object`](http://msdn.microsoft.com/en-us/library/ff878236%28v=sql.110%29.aspx).

这将返回有关过程中第一个结果集的信息（只要所有代码路径都返回此结果集）

# java - 如何使用 jsp 将 java 数组传输到 javaScript 数组？

> ID：516565
> 
> 赞同：13
> 
> 时间：2009-02-05T16:06:51.060
> 
> 标签：java, javascript, arrays, jsp

我的服务器上有一个字符串列表，我试图以数组的形式到达客户端。我尝试使用的代码如下：

在jsp中我有一个`List<String>`专栏

我正在尝试以下代码：

```
<%int j = 0; %>
for(var i = 0; i < <%=columns.size()%>; i++)
{
  colArray[i] = "<%=columns.get(j++)%>";
} 
```

此代码仅返回 colArray 中每个元素的列列表中的第一个元素。

我也试过：

```
colArray = <%=columns.toArray()%>; 
```

这也不起作用。我觉得我在某个地方犯了一个小错误，只是没有看到它。我正在尝试做的事情是否可能以我正在尝试的方式进行？

谢谢。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-05T16:19:18.900

您将在服务器上执行的 JSP 代码与在客户端上执行的 JavaScript 代码混合在一起。该片段`<%=columns.get(j++)%>`在服务器上执行一次，此时围绕它的 JavaScript 循环无关紧要。当它到达客户端时，循环的主体只是说明`colArray[i] = "first entry";`哪个当然会将相同的字符串放入数组的每个元素中。

您需要做的是在服务器上执行一个循环，如下所示：

```
<% for (int i=0; i<columns.size(); i++) { %>
colArray[<%= i %>] = "<%= columns.get(i) %>"; 
<% } %> 
```

我的 JSP 技能生疏，语法可能有所不同，但我希望您能理解。

**编辑：**正如评论中所指出的，您需要非常小心地转义这些字符串中可能导致它们被解释为 JavaScript 代码（最突出的引号）的任何内容 - 特别是如果它们包含用户生成的内容。[否则，您将让您的应用程序对跨站点脚本](http://en.wikipedia.org/wiki/Cross-site_scripting)和[跨站点请求伪造](http://en.wikipedia.org/wiki/XSRF)攻击敞开大门。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T16:49:18.090

尝试使用 JSON（Javascript 对象表示法）对数组进行编码并在 javascript 上对其进行解码会非常简单

在这里查看

[http://www.json.org/java/index.html](http://www.json.org/java/index.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-05T16:19:22.190

一旦 JavaScript 到达客户端，服务器代码就停止执行。服务器代码不会与客户端代码“并行”执行。

您必须在 Java 中构建整个 JavaScript 初始化并将其完整且可执行地发送到客户端：

```
<%
StringBuffer values = new StringBuffer();
for (int i = 0; i < columns.size(); ++i) {
    if (values.length() > 0) {
        values.append(',');
    }
    values.append('"').append(columns.get(i)).append('"');
}
%>
<script type="text/javascript">
var colArray = [ <%= values.toString() %> ];
</script> 
```

这只是一种方法，您还可以通过在`[`and中嵌入服务器代码“即时”构建输出`]`。我使用此示例尝试演示构建包含客户端 JavaScript 的字符串与将其输出到浏览器之间的分离。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-09-17T13:05:48.587

Exp 语言：

```
colArray = ${columns} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-10-08T14:24:27.780

对我来说，这个解决方案已经奏效。首先，您应该制作一个 JSONArray 并使用它的 toJSONString() 方法。此方法将列表转换为 JSON 文本。它的结果是一个 JSON 数组。

```
<% 
List<String> exampleList = new ArrayList<>();
exampleList.add("Apple");
exampleList.add("Orange");
exampleList.add("Lemon");

JSONArray fruitList = new JSONArray();
fruitList.addAll(exampleList);
%> 
```

在您的 JSP 页面中，您应该调用列表的 toJSONString() 方法，并将 JSON 文本传递给 JavaScript 数组。

```
<script type="text/javascript"> var fruitArray = <%= fruitList.toJSONString() %>;</script> 
```

（可选地，您可以为列表创建一个简单的 getter 方法。如果您只在 JSP 页面中实例化具有列表字段的 JAVA 类。）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-06-05T20:34:43.827

上面发布的解决方案在我的情况下不起作用，我需要一个额外的 Javascript 变量来进行转移：

```
var codesJS=new Array();
<% String[] codes=(String[])request.getAttribute("codes");
if(codes!=null){
    for(int i=0; i<codes.length; i++){ %>
        var code='<%= codes[i] %>';           //--> without this doesnt work
        codesJS[<%= i %>]=code; 
    <%}
}%> 
```

# c# - C# 冗余委托

> ID：516569
> 
> 赞同：0
> 
> 时间：2009-02-05T16:07:54.523
> 
> 标签：c#, delegates

```
public delegate T GetObject<T>(SqlDataReader reader);
public delegate KeyValuePair<TKey, TValue> GetObject<TKey, TValue>(SqlDataReader reader); 
```

是否有可能删除第二行（这两行在连续的行上）根本没有任何区别，肤浅的或没有的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T16:11:12.427

绝对 - 例如，任何试图声明类型值的东西都`GetObject<string,string>`将无法编译。

现在，您当然可以替换任何*使用*`GetObject<TKey,TValue>`with （如果您明白我的`GetObject<KeyValuePair<TKey,TValue>>`意思），但您不能只删除第二行。

您还应该注意反射使用 this 的情况。在您的情况下，这可能不是问题，但它是一种简单的方法，可以让重大更改仅在执行时可见，而不是被编译器拾取。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T16:11:34.547

能否有所作为。明确地。删除此委托定义将导致以前有效的代码成为编译错误。

```
var x = new GetObject<int,String>(SomeFunction); 
```

# user-interface - 是否可以使用 Jython 的 SWT？

> ID：516571
> 
> 赞同：11
> 
> 时间：2009-02-05T16:08:18.470
> 
> 标签：user-interface, swt, jython

SWT-Gui 看起来很不错。有没有简单的方法在 Jython 中使用它？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-05T16:28:43.683

鉴于您可以使用 Jython 中的所有 Java 类，也可以使用 SWT。

例如，改编自[SWT 片段](http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.swt.snippets/src/org/eclipse/swt/snippets/Snippet63.java?view=co)，请确保您的 CLASSPATH 中有 SWT jar：

```
import org.eclipse.swt as swt
import org.eclipse.swt.widgets as widgets
import org.eclipse.swt.layout as layout

result = None

display = widgets.Display()

shell = widgets.Shell(display)
shell.pack()
shell.open()

dialog = widgets.Shell(shell, swt.SWT.DIALOG_TRIM | swt.SWT.APPLICATION_MODAL)
dialog.setLayout(layout.RowLayout())

ok = widgets.Button(dialog, swt.SWT.PUSH)
ok.setText ("OK")
cancel = widgets.Button(dialog, swt.SWT.PUSH);
cancel.setText("Cancel");

class MyListener(widgets.Listener):
    def handleEvent(self, event):
        global result
        result = event.widget == ok
        dialog.close()

listener = MyListener()
ok.addListener(swt.SWT.Selection, listener)
cancel.addListener(swt.SWT.Selection, listener)

dialog.pack()
dialog.open()
while not dialog.isDisposed():
    if not display.readAndDispatch():
        display.sleep ()
print "Result:", result
display.dispose() 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-18T00:08:18.907

Jython 有一些其他细节可以使代码更简洁。

Jython 自动将 getter 和 setter 转换为公共属性，以便

```
ok.setText ("OK") 
```

变得简单

```
ok.text = 'OK' 
```

然后，您可以将它们作为命名参数提供给构造函数。Jython 还处理为您的事件处理程序创建侦听器对象：

```
def handleEvent(self, event):
    global result
    result = event.widget == ok
    dialog.close()

ok = widgets.Button(dialog, swt.SWT.PUSH
        text='OK',
        widgetSelected=handleEvent)
cancel = widgets.Button(dialog, swt.SWT.PUSH
        text='Cancel',
        widgetSelected=handleEvent) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-05T16:36:29.940

实际上，不需要特殊的模块。[Sean McGrath 的这次演讲](http://seanmcgrath.pbwiki.com/f/BarCampDublinJythonPresentation.pdf)包含一个简单的 Jython/SWT GUI 示例。

演讲的幻灯片 11 开头是：

```
"""
Simple SWT Example
Sean McGrath
"""
from org.eclipse.swt.events import *
from org.eclipse.swt.graphics import *
from org.eclipse.swt.layout import *
from org.eclipse.swt.widgets import *
from org.eclipse.swt.layout.GridData import *
from org.eclipse.swt import * 
```

它表明 SWT 可以直接从 Jython 中使用。完整的[示例](http://seanmcgrath.pbwiki.com/f/swt.py)就在 Sean 的网站上。

# testing - 我是单元测试还是集成测试？

> ID：516572
> 
> 赞同：9
> 
> 时间：2009-02-05T16:08:26.207
> 
> 标签：testing, automated-tests

我从自动化测试开始，我想测试我的一种数据访问方法。如果数据库没有返回记录，我正在尝试测试代码的作用。

这是应该在单元测试或集成测试中完成的事情吗？

谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-05T16:16:19.780

如果您的测试代码连接到实际数据库并依赖于某些数据的存在（或缺少数据）以使测试通过，那么它就是一个集成测试。

我通常更喜欢通过模拟“数据访问方法”用于获取实际数据的组件来测试类似的东西，无论是 JDBC 连接还是 Web 服务代理或其他任何东西。使用mock，你说“当这个方法被调用时，返回这个”或者“确保这个方法被调用N次”，然后你告诉被测类使用mock组件而不是真正的组件。这是一个“单元测试”，因为您正在测试被测类的行为方式，在一个封闭的系统中，您已经准确地声明了其他组件的行为方式。您已经完全隔离了被测类，并且可以确保您的测试结果不会波动并且依赖于另一个组件的状态。

不确定您使用的是什么语言/技术，但在 Java 世界中，您可以为此目的使用 JMock、EasyMock 等。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-13T15:53:50.307

我认为更多的时间浪费在争论什么是单元与什么是集成测试而不是增加价值。

我不在乎。

让我换一种说法：如果我在测试它，我会看到两种方法 - 伪造返回零行的数据库，或者实际连接到没有数据可供选择的数据库。我可能会从最容易做和最容易实施的任何事情开始测试——如果它运行得足够快，我可以获得有意义的反馈。如果我需要它跑得更快或者认为会有一些优势，我会考虑另一个。

例如，我可能会在我的工作中开始连接到实际的测试数据库。但是如果软件需要与许多不同的数据库一起工作——Oracle、PostGres、MySQL、SQL 服务器和数据库，或者如果工作中的测试数据库因为“刷新”而停机，我可能会写“纯/单元”完全孤立存在的测试。

在我晚年，我更喜欢更频繁地使用“面向开发人员”和“面向客户”这个词，并进行更有意义的测试。我发现广泛使用诸如“单元”之类的术语，然后得到一个关于它的定义会导致人们做一些事情，比如模拟文件系统或模拟 getter 和 setter——我觉得没有帮助的活动。

我坚信这一点；我已经在谷歌之前介绍过它。

[http://www.google.com/url?sa=t&source=web&oi=video_result&ct=res&cd=1&url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DPHtEkkKXSiY&ei=9-wKSobjEpKANvHT_MEB&rct=j&q=heusser+ GTAC+2007&usg=AFQjCNHOgFzsoVss50Qku1p011J4-UjhgQ](http://www.google.com/url?sa=t&source=web&oi=video_result&ct=res&cd=1&url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DPHtEkkKXSiY&ei=9-wKSobjEpKANvHT_MEB&rct=j&q=heusser+GTAC+2007&usg=AFQjCNHOgFzsoVss50Qku1p011J4-UjhgQ)

祝你好运！让我们知道怎么回事！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-05T16:13:29.237

做你的测试，让其他人花时间研究分类学。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-05T17:02:52.383

我的观点是，您应该根据范围对测试进行分类：

*   **单元测试**可以独立运行，无需任何外部依赖项（文件 IO、网络 IO、数据库、外部 Web 服务）。
*   集成**测试**可以触及外部系统。

如果测试需要运行真实的数据库，则将其称为集成测试并将其与单元测试分开。这很重要，因为如果您将集成和单元测试混合在一起，那么您的代码可维护性就会降低。

混合的测试包意味着新开发人员可能需要一大堆外部依赖项才能运行测试套件。想象一下，您想要更改与数据库相关但实际上并不需要数据库运行的一段代码，如果您需要一个数据库来运行与数据库相关的测试，您将会感到沮丧项目。

如果外部依赖项难以模拟（例如，在 DotNet 中，如果您使用 Rhino Mocks 并且外部类没有接口），则创建一个接触外部系统的瘦包装类。然后在单元测试中模拟出那个包装器。您不需要数据库来运行这个简单的测试，所以不需要数据库！

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-05T16:29:26.740

有些人（包括我自己）对单元测试与集成测试的构成有严格的规定。

如果满足以下条件，则测试[不是单元测试](http://haacked.com/archive/2008/07/22/unit-test-boundaries.aspx)：

*   它与数据库对话
*   它通过网络进行通信
*   它涉及文件系统
*   它不能与您的任何其他单元测试同时运行
*   你必须对你的环境做一些特殊的事情（比如编辑配置文件）才能运行它

例如，这可能是区分单元测试将为您使用模拟所做的事情的一种方法，而不是任何真正的资源提供者——文件系统、数据库等。

集成测试可以看成是系统/应用层耦合度很高的测试，所以基础测试是单元测试，系统互操作性是集成测试的重点。

尽管如此，它仍然是一个灰色地带，因为人们通常可以查明这些规则的某些例外情况。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-05T16:43:50.643

我认为重要的问题是“我**应**该做什么？”

在这种情况下我认为你应该进行单元测试。模拟与数据库对话的代码并让它返回一个可靠的结果（无行），这样你的测试会检查没有行时会发生什么，而不是当数据库返回数据库中的任何内容时会发生什么测试。

绝对是单元测试！

```
[TestMethod]
public void ForgotMyPassword_SendsAnEmail_WhenValidUserIsPassed()
{
    var userRepository = MockRepository.GenerateStub<IUserRepository>();
    var notificationSender = MockRepository.GenerateStub<INotificationSender>();
    userRepository.Stub(x => x.GetUserByEmailAddressAndPassword("me@home.com", "secret")).Return(new User { Id = 5, Name = "Peter Morris" });

    new LoginController(userRepository, notificationSender).ResendPassword("me@home.com", "secret");

    notificationSender.AssertWasCalled(x => x.Send(null),
        options => options.Constraints(Text.StartsWith("Changed")));
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-05T16:26:42.237

我相信可以在没有真实数据库的情况下将其作为单元测试进行测试。与其使用数据库的真实接口，不如用[模拟/存根/假对象](http://googletesting.blogspot.com/2008/06/tott-friends-you-can-depend-on.html)替换它（更好的可视化 PDF 在[这里](http://code.google.com/testing/TotT-2008-06-12.pdf)）。

如果将其编写为单元测试证明太难了，并且您无法重构代码以使其易于测试，那么您最好将其编写为集成测试。它会运行得更慢，因此您可能无法在代码更改后运行所有集成测试（与您可以每秒运行成百上千的单元测试不同），但只要它们定期运行（例如作为持续集成），它们会产生一些价值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T16:11:58.540

很可能是单元测试......但这里有一条模糊的线。这实际上取决于执行了多少代码 - 如果它包含在库或类中，那么它的单元测试，如果它跨越多个组件，那么它更像是一个集成测试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-05T16:12:09.770

我相信这应该在单元测试中完成。您没有测试它是否可以连接到数据库，或者您可以调用您的存储过程......您正在测试代码的行为。

我可能是错的，但这就是我的想法，除非有人给我一个不这样想的理由。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T16:56:25.330

根据定义，这是一个单元测试：您正在测试特定路径上代码的单个隔离元素

# algorithm - 如何使用纬度/经度数据进行有效的范围搜索+计数？

> ID：516574
> 
> 赞同：10
> 
> 时间：2009-02-05T16:09:18.403
> 
> 标签：algorithm, data-structures, geospatial, latitude-longitude, geography

我正在使用由纬度/经度对表示的大量点（这些点不一定是唯一的，该集合中可能有几个点位于同一位置）。这些点存储在数据库中。

我需要做的是找出一种有效执行搜索的方法，以获取位于任意点的给定半径（例如 25 英里）内的点数。计数不需要 100% 准确 - 更重要的是，它只需要快速，并且合理地接近正确计数。使用 SQL 执行此操作是可能的，方法是在 WHERE 子句中使用带有一些三角函数的查询来过滤点到参考点的距离。不幸的是，这个查询非常非常昂贵，而且缓存不太可能提供太多帮助，因为位置会非常分散。

我最终希望构建某种能够有效处理这种操作的内存结构 - 以牺牲数据的一些准确性和活跃性（可能每天只重建一次）来换取速度. 我一直在对 kd-trees 进行一些研究，但我还不清楚这可以如何应用于纬度/经度数据（与二维平面中的 x,y 数据相反）。

如果有人有我应该研究的任何想法或解决方案，我将非常感激 - 所以提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T16:26:30.100

***我认为您不应该使用此解决方案。几天前随机想到它，我认为测量与特定点的距离，网格方块的位置将基于圆形而不是统一的网格。离 0,0 越远，这就越不准确！***

我所做的是在我的 PostalCode 类上有 2 个附加值。每当我更新 PostalCode 上的 Long/Lat 时，我都会计算出 Long 0, Lat 0 的 X,Y 距离。

```
public static class MathExtender
{
    public static double GetDistanceBetweenPoints(double sourceLatitude, double sourceLongitude, double destLatitude, double destLongitude)
    {
        double theta = sourceLongitude - destLongitude;
        double distance =
            Math.Sin(DegToRad(sourceLatitude))
            * Math.Sin(DegToRad(destLatitude))
            + Math.Cos(DegToRad(sourceLatitude))
            * Math.Cos(DegToRad(destLatitude))
            * Math.Cos(DegToRad(theta));
        distance = Math.Acos(distance);
        distance = RadToDeg(distance);
        distance = distance * 60 * 1.1515;
        return (distance);
    }

    public static double DegToRad(double degrees)
    {
        return (degrees * Math.PI / 180.0);
    }

    public static double RadToDeg(double radians)
    {
        return (radians / Math.PI * 180.0);
    }
} 
```

然后我像这样更新我的课程：

```
private void CalculateGridReference()
{
    GridReferenceX = MathExtender.GetDistanceBetweenPoints(0, 0, 0, Longitude);
    GridReferenceY = MathExtender.GetDistanceBetweenPoints(0, 0, Latitude, 0);
} 
```

所以现在对于我的数据库中的每一行，我有一个距网格参考 0,0 的 x,y 网格距离（以英里为单位）。如果我想找到长/纬度为 5 英里的所有地方，我首先会获得 X、Y 网格参考（比如 25,75），然后我会在数据库中搜索 20..30、70..80，然后进一步使用过滤内存中的结果

```
MathExtensder.GetDistanceBetweenPoints(candidate.Lat, candidate.Long, search.Lat, search.Long) < TheRadiusOfInterest 
```

数据库中的部分超快，而内存中的部分在较小的集合上工作以使其超准确。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T16:18:06.357

使用[`R-Trees`](http://en.wikipedia.org/wiki/R-tree).

在 Oracle 中，使用 Oracle Spatial，您可以创建索引：

```
CREATE INDEX ix_spatial ON spatial_table (locations) INDEXTYPE IS MDSYS.SPATIAL_INDEX; 
```

这将为您创建一个`R-Tree`并搜索它。

您可以使用任何`Earth Model`您喜欢的：`WGS84`等`PZ-90`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T16:15:43.540

对空间数据使用某种搜索树，例如[四叉树](http://en.wikipedia.org/wiki/Quadtree)。在“另见”下引用了更多此类数据结构。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-27T11:43:23.527

[您可以在 Jan Philip Matuschek 的文章“使用边界坐标查找纬度/经度距离内的点](http://janmatuschek.de/LatitudeLongitudeBoundingCoordinates)”中找到对 Bombe 建议的出色解释。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T16:16:56.470

您能否提供一个现有昂贵查询的样本？

如果您基于参考点和其他数据点的 sine() 和 cosine() 进行适当的大圆计算，则可以通过将这些 sin/cos 值实际存储在数据库中来进行非常实质性的优化除了纬度/经度值。

或者，只需使用您的数据库来提取一个匹配的经度/经度范围的矩形，然后再过滤掉那些超出真实圆形半径的矩形。

但请记住，高纬度地区的经度比赤道地区的距离要短一些。不过，应该很容易找出该矩形的正确纵横比。如果您需要考虑非常靠近极点的区域，您也会遇到错误，因为矩形选择无法处理与极点重叠的圆圈。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T16:26:04.907

此 UDF（SQL Server）将为您提供两个纬度/经度点之间的距离：

```
CREATE FUNCTION [dbo].[zipDistance] (
    @Lat1 decimal(11, 6),
    @Lon1 decimal(11, 6),
    @Lat2 decimal(11, 6),
    @Lon2 decimal(11, 6)
)
RETURNS
    decimal(11, 6) AS
BEGIN

    IF @Lat1 = @Lat2 AND @Lon1 = @Lon2
        RETURN 0 /* same lat/long points, 0 distance = */

    DECLARE @x decimal(18,13)
    SET @x = 0.0

    /* degrees -> radians */
    SET @Lat1 = @Lat1 * PI() / 180
    SET @Lon1 = @Lon1 * PI() / 180
    SET @Lat2 = @Lat2 * PI() / 180
    SET @Lon2 = @Lon2 * PI() / 180

    /* accurate to +/- 30 feet */
    SET @x = Sin(@Lat1) * Sin(@Lat2) + Cos(@Lat1) * Cos(@Lat2) * Cos(@Lon2 - @Lon1)
    IF 1 = @x
        RETURN 0

    DECLARE @EarthRad decimal(5,1)
    SET @EarthRad = 3963.1

    RETURN @EarthRadius * (-1 * ATAN(@x / SQRT(1 - @x * @x)) + PI() / 2)

END 
```

而且，显然，您可以在单独的查询中使用它，例如：

```
SELECT * FROM table WHERE [dbo].[zipDistance] < 25.0 
```

# ruby-on-rails - 有没有办法收集 Rails 应用程序中的所有模型？

> ID：516579
> 
> 赞同：223
> 
> 时间：2009-02-05T16:10:15.437
> 
> 标签：ruby-on-rails, activerecord, collections, model

有没有一种方法可以收集 Rails 应用程序中的所有模型？

基本上，我可以这样做： -

```
Models.each do |model|
  puts model.class.name
end 
```

* * *

## 回答 #1

> 赞同：422
> 
> 时间：2012-05-23T02:52:32.927

Rails 3、4 和 5 的完整答案是：

如果`cache_classes`关闭（默认情况下它在开发中关闭，但在生产中打开）：

```
Rails.application.eager_load! 
```

然后：

```
ActiveRecord::Base.descendants 
```

这可以确保您的应用程序中的所有模型（无论它们在哪里）都被加载，并且您正在使用的提供模型的任何 gem 也被加载。

这也应该适用于继承自的类`ActiveRecord::Base`，例如`ApplicationRecord`在 Rails 5 中，并且只返回后代的子树：

```
ApplicationRecord.descendants 
```

如果您想了解有关*如何*完成此操作的更多信息，请查看[ActiveSupport::DescendantsTracker](http://api.rubyonrails.org/classes/ActiveSupport/DescendantsTracker.html)。

* * *

## 回答 #2

> 赞同：120
> 
> 时间：2010-01-12T10:50:42.427

以防万一有人偶然发现这个，我有另一种解决方案，不依赖于 dir 阅读或扩展 Class 类......

```
ActiveRecord::Base.send :subclasses 
```

这将返回一个类数组。所以你可以这样做

```
ActiveRecord::Base.send(:subclasses).map(&:name) 
```

* * *

## 回答 #3

> 赞同：103
> 
> 时间：2009-02-05T16:17:39.543

**编辑：查看评论和其他答案。有比这个更聪明的答案！或者尝试将其改进为社区 wiki。**

模型不会将自己注册到主对象，所以不，Rails 没有模型列表。

但是您仍然可以查看应用程序的模型目录的内容...

```
Dir.foreach("#{RAILS_ROOT}/app/models") do |model_path|
  # ...
end 
```

编辑：另一个（疯狂的）想法是使用 Ruby 反射来搜索扩展 ActiveRecord::Base 的每个类。不知道如何列出所有课程...

编辑：只是为了好玩，我找到了一种列出所有课程的方法

```
Module.constants.select { |c| (eval c).is_a? Class } 
```

编辑：最终成功列出所有模型而不查看目录

```
Module.constants.select do |constant_name|
  constant = eval constant_name
  if not constant.nil? and constant.is_a? Class and constant.superclass == ActiveRecord::Base
    constant
  end
end 
```

如果您也想处理派生类，那么您将需要测试整个超类链。我通过向 Class 类添加一个方法来做到这一点：

```
class Class
  def extend?(klass)
    not superclass.nil? and ( superclass == klass or superclass.extend? klass )
  end
end

def models 
  Module.constants.select do |constant_name|
    constant = eval constant_name
    if not constant.nil? and constant.is_a? Class and constant.extend? ActiveRecord::Base
    constant
    end
  end
end 
```

* * *

## 回答 #4

> 赞同：70
> 
> 时间：2011-12-08T21:34:29.690

```
ActiveRecord::Base.connection.tables.map do |model|
  model.capitalize.singularize.camelize
end 
```

将返回

```
["Article", "MenuItem", "Post", "ZebraStripePerson"] 
```

**附加信息**如果您想在没有模型的对象名称上调用方法：字符串未知方法或变量错误，请使用此

```
model.classify.constantize.attribute_names 
```

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2016-03-29T07:06:33.397

对于**Rails5**模型[现在](http://blog.bigbinary.com/2015/12/28/application-record-in-rails-5.html)是`ApplicationRecord`so 的子类，要获取应用程序中所有模型的列表，您可以：

```
ApplicationRecord.descendants.collect { |type| type.name } 
```

或更短：

```
ApplicationRecord.descendants.collect(&:name) 
```

如果您处于开发模式，则需要先预先加载模型：

```
Rails.application.eager_load! 
```

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2011-01-04T20:30:47.100

我寻找方法来做到这一点，最终选择了这种方式：

```
in the controller:
    @data_tables = ActiveRecord::Base.connection.tables

in the view:
  <% @data_tables.each do |dt|  %>
  <br>
  <%= dt %>
  <% end %>
  <br> 
```

来源：http: [//portfo.li/rails/348561-how-can-one-list-all-database-tables-from-one-project](http://portfo.li/rails/348561-how-can-one-list-all-database-tables-from-one-project)

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2012-05-21T07:27:02.543

如果您没有无表模型，我认为@hnovick 的解决方案是一个很酷的解决方案。该解决方案也可以在开发模式下工作

不过，我的方法略有不同-

```
ActiveRecord::Base.connection.tables.map{|x|x.classify.safe_constantize}.compact 
```

分类应该可以*正确地*从字符串中为您提供类的名称。safe_constantize 确保您可以安全地将其转换为类而不会引发异常。如果您有不是模型的数据库表，则需要这样做。紧凑，以便删除枚举中的任何 nil。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2014-01-05T05:28:39.723

如果你只想要类名：

```
ActiveRecord::Base.descendants.map {|f| puts f} 
```

只需在 Rails 控制台中运行它，仅此而已。祝你好运！

编辑：@sj26 是对的，您需要先运行它，然后才能调用后代：

```
Rails.application.eager_load! 
```

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2009-02-06T16:49:19.587

这似乎对我有用：

```
 Dir.glob(RAILS_ROOT + '/app/models/*.rb').each { |file| require file }
  @models = Object.subclasses_of(ActiveRecord::Base) 
```

Rails 仅在使用模型时才加载模型，因此 Dir.glob 行“需要”模型目录中的所有文件。

一旦您将模型放入数组中，您就可以做您想做的事情（例如在视图代码中）：

```
<% @models.each do |v| %>
  <li><%= h v.to_s %></li>
<% end %> 
```

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2019-10-08T15:58:53.337

在**Rails 6**中，[Zetiwerk](https://github.com/fxn/zeitwerk)成为了默认的代码加载器。

对于急切加载，请尝试：

```
Zeitwerk::Loader.eager_load_all 
```

然后

```
ApplicationRecord.descendants 
```

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2010-03-11T15:42:38.410

一行：`Dir['app/models/\*.rb'].map {|f| File.basename(f, '.*').camelize.constantize }`

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2012-04-16T14:35:09.423

`ActiveRecord::Base.connection.tables`

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2012-07-19T14:08:58.493

仅一行：

```
 ActiveRecord::Base.subclasses.map(&:name) 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2013-11-13T15:38:12.540

我还不能发表评论，但我认为[sj26 答案](https://stackoverflow.com/a/10712838/727539 "sj26 答案")应该是最佳答案。只是一个提示：

```
Rails.application.eager_load! unless Rails.configuration.cache_classes
ActiveRecord::Base.descendants 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2017-04-28T06:22:26.753

是的，您可以通过多种方式找到所有模型名称，但我在 gem [model_info](https://github.com/nitanshu/model_info)中所做的是，它会为您提供所有模型，甚至包含在 gems 中。

```
array=[], @model_array=[]
Rails.application.eager_load!
array=ActiveRecord::Base.descendants.collect{|x| x.to_s if x.table_exists?}.compact
array.each do |x|
  if  x.split('::').last.split('_').first != "HABTM"
    @model_array.push(x)
  end
  @model_array.delete('ActiveRecord::SchemaMigration')
end 
```

然后简单地打印这个

```
@model_array 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-07-26T22:34:02.370

这适用于 Rails 3.2.18

```
Rails.application.eager_load!

def all_models
  models = Dir["#{Rails.root}/app/models/**/*.rb"].map do |m|
    m.chomp('.rb').camelize.split("::").last
  end
end 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2017-03-28T15:48:42.610

为避免预加载所有 Rails，您可以这样做：

```
Dir.glob("#{Rails.root}/app/models/**/*.rb").each {|f| require_dependency(f) } 
```

require_dependency(f) 和`Rails.application.eager_load!`使用的一样。这应该避免已经需要的文件错误。

然后你可以使用各种解决方案来列出 AR 模型，比如`ActiveRecord::Base.descendants`

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2012-03-27T12:14:33.503

```
Module.constants.select { |c| (eval c).is_a?(Class) && (eval c) < ActiveRecord::Base } 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-06-10T12:41:12.697

这是一个经过复杂 Rails 应用程序审查的解决方案（为 Square 供电的那个）

```
def all_models
  # must eager load all the classes...
  Dir.glob("#{RAILS_ROOT}/app/models/**/*.rb") do |model_path|
    begin
      require model_path
    rescue
      # ignore
    end
  end
  # simply return them
  ActiveRecord::Base.send(:subclasses)
end 
```

它采用了该线程中答案的最佳部分，并将它们组合成最简单、最彻底的解决方案。这处理模型位于子目录中的情况，使用 set_table_name 等。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-10-23T06:24:36.930

刚刚遇到这个，因为我需要打印所有模型及其属性（基于@Aditya Sanghi 的评论）：

```
ActiveRecord::Base.connection.tables.map{|x|x.classify.safe_constantize}.compact.each{ |model| print "\n\n"+model.name; model.new.attributes.each{|a,b| print "\n#{a}"}} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-11-13T23:02:44.320

这对我有用。特别感谢以上所有帖子。这应该返回所有模型的集合。

```
models = []

Dir.glob("#{Rails.root}/app/models/**/*.rb") do |model_path|
  temp = model_path.split(/\/models\//)
  models.push temp.last.gsub(/\.rb$/, '').camelize.constantize rescue nil
end 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2013-11-14T22:25:07.780

我在*Rails 4*中尝试了很多这些答案，但都没有成功（哇，他们为了上帝的缘故改变了一两件事）我决定添加我自己的。调用 ActiveRecord::Base.connection 并提取表名的那些工作但没有得到我想要的结果，因为我隐藏了一些我不想的模型（在 app/models/ 内的文件夹中）删除：

```
def list_models
  Dir.glob("#{Rails.root}/app/models/*.rb").map{|x| x.split("/").last.split(".").first.camelize}
end 
```

我把它放在一个初始化程序中，可以从任何地方调用它。防止不必要的鼠标使用。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-10-16T21:21:56.190

`Rails`实现方法，`descendants`但模型不一定继承自`ActiveRecord::Base`，例如，包含模块的类`ActiveModel::Model`将具有与模型相同的行为，只是不会链接到表。

因此，作为上述同事所说的补充，只需稍加努力即可：

`Class`Ruby类的 Monkey Patch ：

```
class Class
  def extends? constant
    ancestors.include?(constant) if constant != self
  end
end 
```

和方法`models`，包括祖先，如下：

该方法`Module.constants`返回（表面上）一个 的集合`symbols`，而不是常量，因此，该方法`Array#select`可以像下面的猴子补丁一样替换`Module`：

```
class Module

  def demodulize
    splitted_trail = self.to_s.split("::")
    constant = splitted_trail.last

    const_get(constant) if defines?(constant)
  end
  private :demodulize

  def defines? constant, verbose=false
    splitted_trail = constant.split("::")
    trail_name = splitted_trail.first

    begin
      trail = const_get(trail_name) if Object.send(:const_defined?, trail_name)
      splitted_trail.slice(1, splitted_trail.length - 1).each do |constant_name|
        trail = trail.send(:const_defined?, constant_name) ? trail.const_get(constant_name) : nil
      end
      true if trail
    rescue Exception => e
      $stderr.puts "Exception recovered when trying to check if the constant \"#{constant}\" is defined: #{e}" if verbose
    end unless constant.empty?
  end

  def has_constants?
    true if constants.any?
  end

  def nestings counted=[], &block
    trail = self.to_s
    collected = []
    recursivityQueue = []

    constants.each do |const_name|
      const_name = const_name.to_s
      const_for_try = "#{trail}::#{const_name}"
      constant = const_for_try.constantize

      begin
        constant_sym = constant.to_s.to_sym
        if constant && !counted.include?(constant_sym)
          counted << constant_sym
          if (constant.is_a?(Module) || constant.is_a?(Class))
            value = block_given? ? block.call(constant) : constant
            collected << value if value

            recursivityQueue.push({
              constant: constant,
              counted: counted,
              block: block
            }) if constant.has_constants?
          end
        end
      rescue Exception
      end

    end

    recursivityQueue.each do |data|
      collected.concat data[:constant].nestings(data[:counted], &data[:block])
    end

    collected
  end

end 
```

猴子补丁`String`。

```
class String
  def constantize
    if Module.defines?(self)
      Module.const_get self
    else
      demodulized = self.split("::").last
      Module.const_get(demodulized) if Module.defines?(demodulized)
    end
  end
end 
```

最后，模型方法

```
def models
  # preload only models
  application.config.eager_load_paths = model_eager_load_paths
  application.eager_load!

  models = Module.nestings do |const|
    const if const.is_a?(Class) && const != ActiveRecord::SchemaMigration && (const.extends?(ActiveRecord::Base) || const.include?(ActiveModel::Model))
  end
end

private

  def application
    ::Rails.application
  end

  def model_eager_load_paths
    eager_load_paths = application.config.eager_load_paths.collect do |eager_load_path|
      model_paths = application.config.paths["app/models"].collect do |model_path|
        eager_load_path if Regexp.new("(#{model_path})$").match(eager_load_path)
      end
    end.flatten.compact
  end 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2018-11-22T18:35:57.480

```
Dir.foreach("#{Rails.root.to_s}/app/models") do |model_path|
  next unless model_path.match(/.rb$/)
  model_class = model_path.gsub(/.rb$/, '').classify.constantize
  puts model_class
end 
```

这将为您提供项目中的所有模型类。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-05-03T10:55:08.397

可以检查这个

```
@models = ActiveRecord::Base.connection.tables.collect{|t| t.underscore.singularize.camelize} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2013-08-22T05:29:45.000

```
def load_models_in_development
  if Rails.env == "development"
    load_models_for(Rails.root)
    Rails.application.railties.engines.each do |r|
      load_models_for(r.root)
    end
  end
end

def load_models_for(root)
  Dir.glob("#{root}/app/models/**/*.rb") do |model_path|
    begin
      require model_path
    rescue
      # ignore
    end
  end
end 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-10-08T21:15:59.320

假设所有模型都在 app/models 中，并且您的服务器上有 grep 和 awk（大多数情况下），

```
# extract lines that match specific string, and print 2nd word of each line
results = `grep -r "< ActiveRecord::Base" app/models/ | awk '{print $2}'`
model_names = results.split("\n") 
```

它比 `Rails.application.eager_load!`使用`Dir`.

**编辑：**

这种方法的缺点是它遗漏了间接继承自 ActiveRecord 的模型（例如`FictionalBook < Book`）。最可靠的方法是`Rails.application.eager_load!; ActiveRecord::Base.descendants.map(&:name)`，即使它有点慢。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-10-06T09:57:36.557

如果有人觉得它有用，我只是把这个例子放在这里。解决方案基于此答案[https://stackoverflow.com/a/10712838/473040](https://stackoverflow.com/a/10712838/473040)。

假设您有一个用作外部世界的主要 ID 的列（您可以[在此处](https://github.com/equivalent/public_uid)`public_uid`找到为什么要这样做的原因）

现在假设您已经在一堆现有模型上引入了这个字段，现在您想要重新生成所有尚未设置的记录。你可以这样做

```
# lib/tasks/data_integirity.rake
namespace :di do
  namespace :public_uids do
    desc "Data Integrity: genereate public_uid for any model record that doesn't have value of public_uid"
    task generate: :environment do
      Rails.application.eager_load!
      ActiveRecord::Base
        .descendants
        .select {|f| f.attribute_names.include?("public_uid") }
        .each do |m| 
          m.where(public_uid: nil).each { |mi| puts "Generating public_uid for #{m}#id #{mi.id}"; mi.generate_public_uid; mi.save }
      end 
    end 
  end 
end 
```

你现在可以运行`rake di:public_uids:generate`

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-11-13T14:30:44.240

确保在调用之前预先加载您的应用程序，`descendants`以便加载所有类：

```
Rails.application.eager_load! unless Rails.application.config.eager_load

ApplicationRecord.descendants.each do |clazz|
  # do something with clazz, e.g. User, Event, Attendance, etc.
end 
```

# ruby - 在 Ruby 中插入 Set 以改变数组中元素的顺序

> ID：516586
> 
> 赞同：0
> 
> 时间：2009-02-05T16:12:34.950
> 
> 标签：ruby, arrays, set

```
@search_results = Array.new
duplicates = Set.new
results.each { |result|    @search_results.push(result) unless duplicates.add?(result[:url]) } 
```

这段代码混淆了数组@search_results 中元素的顺序。为什么在集合和数组中插入相同的元素会改变数组的插入顺序？似乎元素引用存在一些问题。有人可以解释吗？

编辑1：我正在使用一个数组。很抱歉之前的错字。我通过代码进行了双重检查，它也使用了 Array（无论如何都没有 Hash 的推送方法）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T17:41:03.883

不保证 Hash 中元素的顺序。如果您想要保证顺序，则必须对键进行排序。

我相信这应该在 Ruby 1.9 中得到修复。

**编辑：**我假设你的结果在一个数组中，如果它是一个哈希，那么顺序不能保证，你必须对键进行排序，这就是我的测试的样子：

```
#!/usr/bin/ruby -W

require 'pp'
require 'set'

results = Array.new

results << {:url => 'http://lifehacker.com'}
results << {:url => 'http://stackoverflow.com'}
results << {:url => 'http://43folders.com'}
results << {:url => 'http://lolindrath.com'}
results << {:url => 'http://stackoverflow.com'}
results << {:url => 'http://lifehacker.com'}

@search_results = Array.new
duplicates = Set.new

results.each { |result| @search_results.push(result) unless duplicates.add?(result[:url])}

puts "## @search_results"
pp @search_results 
```

如果我运行它，结果如下：

```
## @search_results
[{:url=>"http://stackoverflow.com"}, {:url=>"http://lifehacker.com"}] 
```

我发现这很奇怪，所以为了确定，我`.nil?`在末尾加上了一个 add `.add?`，这是我的结果：

```
## @search_results
[{:url=>"http://lifehacker.com"},
 {:url=>"http://stackoverflow.com"},
 {:url=>"http://43folders.com"},
 {:url=>"http://lolindrath.com"}] 
```

现在*这*就是我所期待的：这就是你所说的“乱码”吗？

**编辑 2：**经过进一步调查，我认为这是因为 Ruby 在将非布尔数据转换为布尔值时有非常严格的规则（当然，请参阅[Wikipedia 上的 Ruby Gotchas](http://en.wikipedia.org/wiki/Ruby_(programming_language)#.22Gotchas.22)和[Stack Overflow](https://stackoverflow.com/questions/372652/what-are-the-ruby-gotchas-a-newbie-should-be-warned-about)），因此基本上任何只有假的东西都是真的假的，一切否则是真的。因此`.nil?`将其显式转换为真/假。

```
irb(main):007:0> puts "zero is true" if 0
zero is true
=> nil
irb(main):008:0> puts "zero is false" unless 0
=> nil 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T19:22:11.727

乱码怎么办？是什么样的对象`results`？如果`results`是 a`Set`或 a `Hash`，那么您不能保证任何两个遍历 of`results`的顺序相同。

另外，你可以做

```
@search_results = results.uniq 
```

if`results`是一个`Array`获得所有独特结果的方法。

```
------------------------------------------------------------- Array#uniq
     array.uniq   -> an_array
------------------------------------------------------------------------
     Returns a new array by removing duplicate values in self.

        a = [ "a", "a", "b", "b", "c" ]
        a.uniq   #=> ["a", "b", "c"] 
```

# erlang - Erlang 的可扩展性秘诀是什么？

> ID：516587
> 
> 赞同：14
> 
> 时间：2009-02-05T16:13:19.863
> 
> 标签：erlang, scalability

Erlang 在处理大量消息和请求方面享有盛誉。我没有时间下载并尝试深入了解 Erlang 先生对切换理论的理解......所以我想知道是否有人可以教我（或指向一个好的教学网站。）

假设作为一个思想实验，我想将 Erlang ejabberd 移植到 Python 和 C 的组合中，以一种给我相同的速度和可扩展性的方式。我必须理解和实施哪些结构或模式？（Python 的 Twisted 是否已经这样做了？）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-05T16:15:35.677

[函数式语言（特别是 Erlang）如何/为什么能够很好地扩展？](https://stackoverflow.com/questions/474497/how-why-do-functional-languages-specifically-erlang-scale-well/474530#474530)（讨论原因）

[http://erlang.org/course/course.html](http://erlang.org/course/course.html)（用于教程链）

至于移植到其他语言，使用大多数现代语言很容易实现消息传递系统。获得函数式风格可以在 Python 中轻松完成，尽管您不会“免费”获得 Erlang 的内部调度功能。Stackless Python 可以复制 Erlang 的大部分并发特性，虽然我不能说细节，因为我没有太多使用它。If 确实看起来更“明确”（因为它要求您在 Erlang 的设计允许内部发生并发的地方定义代码中的并发）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T17:42:18.483

Erlang 不仅是关于可扩展性，而且主要是关于

*   可靠性
*   软实时特性（由软实时 GC 启用，这是可能的，因为不变性 [无循环] 并且不共享任何内容等）
*   并发任务的性能（廉价的任务切换、廉价的进程生成、参与者模型……）
*   可扩展性 - 在当前状态下值得商榷，但发展迅速（大约 32 个核心，它比大多数竞争对手要好，但在不久的将来应该会更好）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T02:20:28.327

erlang 的另一个影响可伸缩性的特性是轻量级廉价进程。由于进程的开销很小，erlang 可以产生比大多数其他语言更多的进程。与许多其他语言相比，您使用 erlang 进程可以获得更多的收益。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T13:43:58.223

我认为 Erlang 的最佳选择是网络绑定应用程序 - 使节点之间的通信更加简单，并且诸如心跳监控、使用主管自动重启等功能都内置在 OTP 中。

# sql-server-2005 - 针对 SQL Server 2005 数据库中的 CSV 字段进行报告

> ID：516592
> 
> 赞同：0
> 
> 时间：2009-02-05T16:14:19.580
> 
> 标签：sql-server-2005, tsql, csv, parsing

好的，所以我正在针对 sql server 2005 中的第三方数据库编写报告。除了一张表中的一个字段外，大部分情况下它都是标准化的。他们有一个用户表（包括组）。这个表有一个 UserID 字段（PK）、一个 IsGroup 字段（位）、一个成员字段（文本）这个成员字段有一个逗号分隔的这个组所有成员的列表或（如果不是组）此成员所属组的逗号分隔列表。

问题是编写一个显示哪些用户属于哪些组的存储过程的最佳方法是什么？我有一个将 id 解析成表格的函数。所以我能想出的最好方法是创建一个游标，循环遍历每个组并解析出用户 ID，将它们写入临时表（使用组 ID），然后从临时表中选择？

用户表示例： ID| IsGroup
|Name|Members
1|True|Admin|3
2|True|Power|3,4
3|False|Bob|1,3
4|False|Susan|2
5|True|Normal|6
6 |假|比尔|5

我希望我的查询显示：GroupID|UserID
1|3
2|3
2|4
5|6

希望这是有道理的...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T22:16:41.610

你的技术可能是最好的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-10T03:49:06.427

如果您有（或可以创建）一个包含组的单独表，您可以将其与 users 表连接，并将它们与 charindex 函数匹配，并在两边用逗号填充数据。在部署之前，我会用一些相当极端的工作负载测试这种方法的性能。但是，它确实具有独立和简单的优点。请注意，将示例更改为使用带有 where 子句的交叉连接会产生与此完全相同的执行计划。

**数据示例：**
`SELECT *
FROM   (SELECT 1       AS ID,
               '1,2,3' AS MEMBERS
        UNION
        SELECT 2,
               '2'
        UNION
        SELECT 3,
               '3,1'
        UNION
        SELECT 4,
               '2,1') USERS
       LEFT JOIN (SELECT '1' AS MEMBER
                  UNION
                  SELECT '2'
                  UNION
                  SELECT '3'
                  UNION
                  SELECT '4') GROUPS
         ON CHARINDEX(',' + GROUPS.MEMBER + ',',',' + USERS.MEMBERS + ',') > 0`

 `**结果：**

```
id成员组
1 1,2,3 1
1 1,2,3 2
1 1,2,3 3
2 2 2
3 3,1 1
3 3,1 3
4 2,1 1
4 2,1 2

```

# java - 增加一个十六进制值（JAVA）

> ID：516593
> 
> 赞同：10
> 
> 时间：2009-02-05T16:14:22.730
> 
> 标签：java, hex, increment

你能在Java中增加一个十六进制值吗？即“十六进制值”=“十六进制值”++

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-05T16:19:03.517

这取决于如何存储十六进制值。如果您在字符串中有十六进制值，请将其转换为整数，递增并将其转换回。

```
int value = Integer.parseInt(hex, 16);
value++;
String incHex = Integer.toHexString(value); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-05T16:20:12.923

**简短的回答**：是的。它是

```
myHexValue++; 
```

**更长的答案**：您的“十六进制值”可能存储为整数。将其转换为十六进制（而不是通常的十进制）字符串的业务是通过

```
Integer.toHexString( myHexValue ) 
```

并从一个十六进制字符串

```
Integer.parseInt( someHexString, 16 ); 
```

M。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-05T16:16:44.893

“十六进制值”是什么意思？您的值存储在什么数据类型中？

请注意， int/short/char/... 不关心您的值最初是如何表示的：

```
int i1 = 0x10;
int i2 = 16; 
```

`i1`并且`i2`将具有*完全相同的内容*。Java（以及大多数其他语言）不关心常量/值的表示法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-05T16:17:19.340

是的。无论如何，所有整数都是二进制的，所以你如何声明它们并不重要。

```
int hex = 0xff;
hex++;  // hex is now 0x100, or 256
int hex2 = 255;
hex2++; // hex2 is now 256, or 0x100 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T19:50:06.820

数字的基数纯粹是 UI 问题。在内部，整数存储为二进制。只有当您将其转换为人类表示时，您才会选择数字基数。所以你的问题真的归结为“如何增加一个整数？”。

# php - 循环数组问题

> ID：516609
> 
> 赞同：0
> 
> 时间：2009-02-05T16:18:28.637
> 
> 标签：php

我有一个简化的 ajay 脚本，我从中删除了所有不相关的代码。我遇到的问题首先是我的列数组和随后的 foreach 循环。我想遍历每个元素并将相应的元素更改为 YES 如果为真，如果为假，则为 NO，我不明白为什么它不起作用。

如果有任何问题，例如语法错误或大括号等，它们是简化我的代码的问题，并且不存在于我机器上的版本中。

```
<?php
$con = mysqli_connect("localhost", "", "", "");
if (!$con) {
    echo "Can't connect to MySQL Server. Errorcode: %s\n". mysqli_connect_error();
    exit;
}
$con->set_charset("utf8");
    $query1 = 'SELECT EGGS, SALAD, TREES, REVISED FROM AUCTIONS WHERE ARTICLE_NO = ?';
    if ($getRecords = $con->prepare($query1)) {
        $getRecords->bind_param("s", $pk);
        $getRecords->execute();
        $getRecords->bind_result($EGGS, $SALAD, $TREES, $REVISED);
        while ($getRecords->fetch()) {
        $columns = array('EGGS', 'SALAD', 'TREES', 'REVISED');
            foreach($columns as $column) {
                $$column = $columns[$column] ? 'YES' : 'NO';
            }
            imageSize = imageResize($PIC_URL, 250, 300);
            echo "<h1>".$EGGS."</h1>";
        }
    }
function imageResize($imageURL, $maxWidth, $maxHeight) {
    $imageSize["width"] = 0;
    $imageSize["height"] = 0;
    $size = getimagesize($imageURL);
    if ($size) {
        $imageWidth  = $size[0];
        $imageHeight = $size[1];
        $wRatio = $imageWidth / $maxWidth;
        $hRatio = $imageHeight / $maxHeight;
        $maxRatio = max($wRatio, $hRatio);
        if ($maxRatio > 1) {
            $imageSize["width"] = $imageWidth / $maxRatio;
            $imageSize["height"] = $imageHeight / $maxRatio;
            return $imageSize;
        } else {
            $imageSize["width"] = $imageWidth;
            $imageSize["height"] = $imageHeight;
            return $imageSize;
        }
    } else {
        die(print_r(error_get_last()));
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T16:31:40.090

你的循环是错误的 - $columns['EGGS'] 不存在：

```
$columns = array('EGGS', 'SALAD', 'TREES', 'REVISED');
foreach($columns as $column) {
    $$column = $columns[$column] ? 'YES' : 'NO';
} 
```

它应该是：

```
$columns = array('EGGS', 'SALAD', 'TREES', 'REVISED');
foreach($columns as $column) {
    $$column = $$column ? 'YES' : 'NO';
} 
```

或者更好：

```
$tmp = array();
$columns = array('EGGS', 'SALAD', 'TREES', 'REVISED');
foreach($columns as $column) {
    $tmp[$column] = $$column ? 'YES' : 'NO';
} 
```

这样你就不会覆盖你的绑定变量。

`while()`另请注意，出于性能原因，您应该将该常量数组声明移到循环之外。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T16:42:17.650

但是我只想补充一点，虽然使用像 $$COLUMN 这样的变量似乎是一个不错的功能，但它稍后会变得非常混乱并产生很多额外的变量。

为什么不创建一个临时数组，保存所有 YES/NO 对？

此外，PHP 不允许变量包含数字。我不知道当您创建这样的变量时会发生什么：

```
$name = "123variable";
$$name = "foo"; 
```

我得去看看。

编辑：我刚刚看到您只将查询结果绑定到一些变量。我仍然认为这不是一个好的编码风格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T16:26:26.607

`$columns[$column]`不存在-我无法想象您要做什么，但这是一个错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T16:30:56.880

改变你的循环

```
foreach($columns as $column) {
     $$column = $columns[$column] ? 'YES' : 'NO';
} 
```

到：

```
foreach($columns as $key=>$column) {
     $$column = $columns[$key] ? 'YES' : 'NO';
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T16:34:19.103

将循环更改为：

```
foreach($columns as $column) {
    $$column = $$column ? 'YES' : 'NO';
} 
```

# validation - 领域驱动设计中的验证

> ID：516615
> 
> 赞同：65
> 
> 时间：2009-02-05T16:20:17.993
> 
> 标签：validation, domain-driven-design

您如何处理域驱动设计中复杂聚合的验证？您是否正在整合您的业务规则/验证逻辑？

我了解参数验证，并且了解可以附加到模型本身的属性验证，并执行诸如检查电子邮件地址或邮政编码是否有效或名字具有最小和最大长度之类的操作。

但是涉及多个模型的复杂验证呢？您通常将这些规则和方法放在您的架构中的什么位置？如果有的话，你用什么模式来实现它们？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-02-06T22:29:04.033

与其依赖`IsValid(xx)`整个应用程序的调用，不如考虑从 Greg Young 那里获得一些建议：

> 永远不要让您的实体进入无效状态。

这基本上意味着您从将实体视为纯数据容器转变为更多关于具有行为的对象。

考虑一个人的地址的例子：

```
 person.Address = "123 my street";
 person.City = "Houston";
 person.State = "TX";
 person.Zip = 12345; 
```

在任何这些调用之间，您的实体都是无效的（因为您将拥有彼此不一致的属性。现在考虑一下：

```
person.ChangeAddress(.......); 
```

所有与更改地址行为相关的调用现在都是一个原子单元。您的实体在这里永远不会无效。

如果您采用这种建模行为而不是状态的想法，那么您可以获得一个不允许无效实体的模型。

如需对此进行深入讨论，请查看此 infoq 采访： http: [//www.infoq.com/interviews/greg-young-ddd](http://www.infoq.com/interviews/greg-young-ddd)

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-06-13T13:28:05.370

我喜欢 Jimmy Bogard 对这个问题的解决方案。他在他的博客上发表了一篇题为[“使用访问者和扩展方法进行实体验证”](http://www.lostechies.com/blogs/jimmy_bogard/archive/2007/10/24/entity-validation-with-visitors-and-extension-methods.aspx)的文章，其中他提出了一种非常优雅的实体验证方法，建议实现一个单独的类来存储验证代码。

```
public interface IValidator<T>
{
    bool IsValid(T entity);
    IEnumerable<string> BrokenRules(T entity);
}

public class OrderPersistenceValidator : IValidator<Order>
{
    public bool IsValid(Order entity)
    {
        return BrokenRules(entity).Count() == 0;
    }

    public IEnumerable<string> BrokenRules(Order entity)
    {
        if (entity.Id < 0)
            yield return "Id cannot be less than 0.";

        if (string.IsNullOrEmpty(entity.Customer))
            yield return "Must include a customer.";

        yield break;
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-06T22:21:02.147

我通常使用规范类，它提供了一个方法（这是 C#，但你可以翻译成任何语言）：

```
bool IsVerifiedBy(TEntity candidate) 
```

此方法对候选人及其关系进行全面检查。您可以在规范类中使用参数来使其参数化，例如检查级别...

您还可以添加一个方法来了解候选人未验证规范的原因：

```
IEnumerable<string> BrokenRules(TEntity canditate) 
```

您可以简单地决定像这样实现第一个方法：

```
bool IsVerifiedBy(TEntity candidate)
{
  return BrokenRules(candidate).IsEmpty();
} 
```

对于违反规则，我通常会编写一个迭代器：

```
IEnumerable<string> BrokenRules(TEntity candidate)
{
  if (someComplexCondition)
      yield return "Message describing cleary what is wrong...";
  if (someOtherCondition) 
      yield return
   string.Format("The amount should not be {0} when the state is {1}",
        amount, state);
} 
```

对于本地化，您应该使用资源，为什么不将文化传递给 BrokenRules 方法。我将这些类放置在模型命名空间中，其名称表明它们的用途。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-03-12T21:14:23.360

多个模型验证应该通过您的聚合根。如果您必须跨聚合根进行验证，则可能存在设计缺陷。

我对聚合进行验证的方式是返回一个响应接口，告诉我验证是否通过/失败以及有关失败原因的任何消息。

您可以验证聚合根上的所有子模型，以使它们保持一致。

```
// Command Response class to return from public methods that change your model
public interface ICommandResponse
{
    CommandResult Result { get; }
    IEnumerable<string> Messages { get; }
}

// The result options
public enum CommandResult
{
    Success = 0,
    Fail = 1
}

// My default implementation
public class CommandResponse : ICommandResponse
{
    public CommandResponse(CommandResult result)
    {
        Result = result;
    }

    public CommandResponse(CommandResult result, params string[] messages) : this(result)
    {
        Messages = messages;
    }

    public CommandResponse(CommandResult result, IEnumerable<string> messages) : this(result)
    {
        Messages = messages;
    }

    public CommandResult Result { get; private set; }

    public IEnumerable<string> Messages { get; private set; }
}

// usage
public class SomeAggregateRoot
{
    public string SomeProperty { get; private set; }

    public ICommandResponse ChangeSomeProperty(string newProperty)
    {
        if(newProperty == null)
        {
            return new CommandResponse(CommandResult.Fail, "Some property cannot be changed to null");
        }

        SomeProperty = newProperty;

        return new CommandResponse(CommandResult.Success);
    }
} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2016-08-23T01:12:12.763

这个问题现在有点老了，但如果有人感兴趣，这里是我如何在我的服务类中实现验证。

我的每个服务类中都有一个私有的**Validate**方法，该方法接受一个实体实例和正在执行的操作，如果验证失败，则会引发自定义异常，其中包含损坏规则的详细信息。

**具有内置验证的示例 DocumentService**

```
public class DocumentService : IDocumentService
{
    private IRepository<Document> _documentRepository;

    public DocumentService(IRepository<Document> documentRepository)
    {
        _documentRepository = documentRepository;
    }

    public void Create(Document document)
    {
        Validate(document, Action.Create);

        document.CreatedDate = DateTime.Now;

        _documentRepository.Create(document);
    }

    public void Update(Document document)
    {
        Validate(document, Action.Update);

        _documentRepository.Update(document);
    }

    public void Delete(int id)
    {
        Validate(_documentRepository.GetById(id), Action.Delete);

        _documentRepository.Delete(id);
    }

    public IList<Document> GetAll()
    {
        return _documentRepository
            .GetAll()
            .OrderByDescending(x => x.PublishDate)
            .ToList();
    }

    public int GetAllCount()
    {
        return _documentRepository
            .GetAll()
            .Count();
    }

    public Document GetById(int id)
    {
        return _documentRepository.GetById(id);
    }

    // validation 

    private void Validate(Document document, Action action)
    {
        var brokenRules = new List<string>();

        if (action == Action.Create || action == Action.Update)
        {
            if (string.IsNullOrWhiteSpace(document.Title))
                brokenRules.Add("Title is required");

            if (document.PublishDate == null)
                brokenRules.Add("Publish Date is required");
        }

        if (brokenRules.Any())
            throw new EntityException(string.Join("\r\n", brokenRules));
    }

    private enum Action
    {
        Create,
        Update,
        Delete
    }
} 
```

我喜欢这种方法，因为它允许我将所有核心验证逻辑放在一个地方，从而使事情变得简单。

# asp.net - 有没有办法知道会话使用了多少 RAM？

> ID：516616
> 
> 赞同：3
> 
> 时间：2009-02-05T16:20:22.093
> 
> 标签：asp.net, session

我在一个会话中获得了一个具有类型安全变量的类；int、字符串、数据集等

有没有办法找出该会话使用了多少内存？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T16:31:20.857

使用分析器是您最好的选择。就我个人而言，我真的很喜欢 jetbrains [dotTrace](http://www.jetbrains.com/profiler/)。

# .net - WPF 应用程序中使用的“弱事件”模式是什么？

> ID：516617
> 
> 赞同：17
> 
> 时间：2009-02-05T16:20:31.940
> 
> 标签：.net, wpf, events, design-patterns, weak-events

`WindowsBase`DLL 使用摘要定义事件`IWeakEventListener`：

> 为希望通过 WeakEvent 模式和 System.Windows.WeakEventManager 接收事件的类提供事件侦听支持。

这种模糊的描述并没有描述“弱事件模式”实际上是什么。

那么，这种模式是什么，为什么要使用它，它在 WPF 应用程序之外有用吗？

**编辑**已经有一些很好的答案，但没有人谈论过这种模式在 WPF 应用程序之外是否有用。在我看来，弱事件模式（如依赖属性）与 WPF API 和 DLL 有着千丝万缕的联系。是否有可用于非 WPF 应用程序的等效实现？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-05T16:23:51.590

重要的一点在注释中：

> 遵循 WeakEvent 模式的主要原因是事件源的对象生命周期可能独立于事件侦听器。使用 Wea​​kEventManager 的中央事件调度允许侦听器的处理程序被垃圾收集，即使源对象仍然存在

所以如果你有`publisher`和`subscriber`对象，那么通常在`subscriber`订阅了`publisher`'s 事件之后，`subscriber`就不能被垃圾回收了。弱事件模式使两个“弱”之间的链接（如在[WeakReference](http://msdn.microsoft.com/en-us/library/system.weakreference.aspx)中），因此不存在这种依赖关系。`subscriber`（另一种方法是在想要有资格进行垃圾收集时取消订阅该事件，但这会变得混乱。）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-05T16:27:23.797

[弱事件模式](http://msdn.microsoft.com/en-us/library/aa970850.aspx)

订阅事件可能会导致订阅者未被收集。您会假设该对象将被收集，因为您没有其他对它的引用 - 但是事件发布者持有侦听器对象并将其保存在内存中（除非它明确取消订阅，在这种情况下，您需要确切知道何时退订）。有管理的泄漏。

作为一个经验法则，如果事件发布者的等待时间比侦听器长，您可能会遇到这个问题并应该检查一下。

WeakEvents 应该可以帮助您，因为如果对它的唯一活动引用是“弱”，则该对象将被收集。仅当您计划开发新控件时才应该关注此模式，这通常会暴露大量事件。

基本思想类似于 WeakReference wrt 垃圾回收。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-09-22T14:19:05.963

在 .NET 4.5 中，改进了对建立对事件的弱引用的支持。

代替

```
source.Event += OnEvent; 
```

您可以使用新的[WeakEventManager<TEventSource, TEventArgs>](https://msdn.microsoft.com/en-us/library/hh199438%28v=vs.110%29.aspx)：

```
WeakEventManager<EventSource, EventArgs>.AddHandler(source, "Event", OnEvent); 
```

[在这里阅读更多。](http://www.codeproject.com/Articles/738109/The-NET-weak-event-pattern-in-Csharp)

# .net - .NET 是否有贝叶斯过滤器库

> ID：516625
> 
> 赞同：6
> 
> 时间：2009-02-05T16:22:47.753
> 
> 标签：.net, bayesian

.NET 是否有贝叶斯过滤器库？

我想设置一组文件夹，并根据之前移动到文件夹的内容自动将电子邮件移动到这些文件夹中。

如果您熟悉 FogBugz 自动排序，那正是我想做的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T19:39:23.847

我找到[了 Weka.Net](http://sourceforge.net/projects/wekadotnet)，它是[Weka Java 机器学习框架](http://www.cs.waikato.ac.nz/ml/weka/)到 .NET 的一个端口。它是一个 alpha 版本，看起来没有那么活跃，但如果它有 Weka 的核心，你可以用它来写你想要的。 [Mailprobe](http://savannah.nongnu.org/projects/mailprobe/) “确实支持 N 个类别，而不仅仅是垃圾邮件/非垃圾邮件” - 所以也许这就是您正在寻找的。这个[朴素的贝叶斯分类器](http://www.codeproject.com/KB/cs/BayesClassifier.aspx)也可能有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T17:35:59.807

这完全不能回答您的问题，但名为[Popfile](http://getpopfile.org/)的产品使用 Perl 库来执行此操作。

# sql-server - 运行 SQL Server 报告服务的最佳实践。我应该在数据库还是 Web 服务器上运行？

> ID：516630
> 
> 赞同：3
> 
> 时间：2009-02-05T16:23:19.063
> 
> 标签：sql-server, reporting-services

我正在配置一个新环境来运行多个 Intranet Web 应用程序。我有两台服务器，一台是 SQL Server 2008 服务器，另一台是 IIS 服务器。我还需要安装 SQL Server Reporting Services。我不确定在数据库服务器或 Web 服务器上运行报告服务是否更好。这种情况有最佳实践吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T16:37:31.170

依靠...

报告服务呈现是相当密集的处理器，因此您需要牢记这一点。通常，如果我正在设计一个具有重负载或吞吐量要求的系统，我会将报告服务实例放在它自己的服务器上。最佳实践实际上取决于系统的复杂性。

如果第三台服务器不是一个选项，并且您已经拥有的两台服务器的规格相似，我可能会将其放在处理器负载最低的一台上。如果您将报告服务器放置在 Web 服务器上，请确保 Reporting Services 将您的专用数据库服务器用于报告服务元数据，这样您就不必在两台机器上都安装 RDBMS。

您需要记住，如果您不将报告服务器与 SQL Server 放在同一个盒子上，您将需要另一个 SQL Server 许可证。该产品只有在与 SQL 安装在同一台机器上时才是“免费的”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T17:19:03.660

我将在您的 Web 服务器上运行安装程序，以便在那里安装 Reporting Services 的 Web 服务组件。

在 IIS 中使用自己的应用程序域配置报告服务也是有益的，这样您就可以独立于其他 Web 应用程序调整配置。

当您使用 Reporting Services 配置工具运行安装程序时，在您的非 Web 服务器（即专用数据库服务器）上设置数据库。这样，您的所有数据处理都在一台服务器上处理，而您的所有 Web 处理/数据渲染都在另一台服务器上处理。

希望这很清楚并且有用，但请随时提出进一步的问题。

干杯，约翰

# c# - SqlDataReader 访问值的性能差异？

> ID：516637
> 
> 赞同：1
> 
> 时间：2009-02-05T16:24:04.270
> 
> 标签：c#, asp.net, sqldatareader

从**SqlDataReader**访问值时，这两者之间是否存在性能差异：

```
string key = reader.GetString("Key"); 
```

或者

```
string key = reader["Key"].ToString(); 
```

在此代码示例中：

```
string key;

using (SqlDataReader reader = cmd.ExecuteReader())
{
    while (reader.Read())
    {
        key = reader.GetString("Key");
        // or
        key = reader["Key"].ToString();
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T16:31:55.020

Microsoft MVP 写了一篇关于此的博客文章：http: [//jeffbarnes.net/portal/blogs/jeff_barnes/archive/2006/08/09/Maximize-Performance-with-SqlDataReader.aspx](http://jeffbarnes.net/portal/blogs/jeff_barnes/archive/2006/08/09/Maximize-Performance-with-SqlDataReader.aspx)

以下是他的结论：

```
 .NET 1.1    .NET 2.0
Ordinal Position:                   8.47        9.33
Get Methods:                        11.36       8.07
Case Sensitive:                     14.51       12.53
Case Insensitive (All Upper):       13.93   12.23
Case Insensitive (All Lower):       14.47   12.48
Case Insensitive (Mixed):           14.48   12.57 
```

但实际上，除非您要处理大量行，否则不必担心。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T16:45:01.030

我刚刚浏览了.NET 源代码，两种访问方法本质上是相同的。唯一的区别是第二个做了一个额外的拳击。所以第一个对应于类似的东西（在基本类型的情况下）：

```
int key = GetInternalSQLDataAsInt32("Key"); 
```

而第二个是：

```
int key = (int)(object)GetInternalSQLDataAsInt32("Key"); 
```

GetInternalSQLDataAsInt32(...) 函数表示将数据从 SQL 编组到 .NET 的 SQL 数据库机制。

但如上所述，基于字符串的键和基于序数的键之间可以预期会有更显着的差异。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T16:26:48.727

即使有，与首先从数据库中获取数据的成本相比，它也不太可能产生重大影响。

我个人更喜欢第一个版本 - 它表明我希望该列是一个字符串列，而不是取一个数字并将其转换为字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T16:27:02.270

尽管您的代码需要修改；使用序数是最快的方法。

# windows - 合适的安装目录

> ID：516641
> 
> 赞同：0
> 
> 时间：2009-02-05T16:24:47.297
> 
> 标签：windows, installation

我有一个需要在 Windows 64 机器上安装的程序。大多数应用程序已移植到 64 位，但仍有一两个次要模块我们没有移植，主要是由于第三方依赖性。我应该在哪里安装这个程序？C:\program 文件 (x86) 还是 c:\program 文件？因为它是我倾向于 c:\program 文件的混合物，但也许有一个我不知道的标准。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T16:27:50.660

安装到“C:\Program Files”

在 (x86) 中放置类似的混合内容没有标准。

如果它仍然主要是 x86，我可能会说否则，但从它的声音来看，你没有多少仍然是 x86，对吗？

# delphi - 如何使用位/位运算符来控制对象状态？

> ID：516646
> 
> 赞同：5
> 
> 时间：2009-02-05T16:25:45.890
> 
> 标签：delphi, bitwise-operators, object-state

我想创建轻对象数据包以在客户端和服务器应用程序之间传递。

这是一个非常简单的任务，我可以只用一个字节来控制，所以一个字节中的每一位都会有不同的含义，

仅使用位

```
0 = False 
1 = True 
```

我现在需要的东西：

```
1 - Loaded from database 
2 - Persisted
3 - Changed
4 - Marked to Delete
5 -
6 - 
7 - Null Value 
8 - Read Only

1) How do I use bit operators in Delphi to check each bit value? 
2) How do I set the bit Values? 
```

**解决方案**

在所有帮助之后，我将使用下一组

```
 TStateType = (
    stLoaded    = 0,   // loaded from persistance
    stNative    = 2,   // value loaded and converted to native type
    stPersisted = 3,   // saved
    stChanged   = 4,   // object or member changed
    stToDelete  = 5,   // marked to delete
    stReadOnly  = 6,   // read only object, will not allow changes
    stNull      = 7    // value is null
  );
  TState = Set of TStateType; 
```

对于流 -> 持久性，这将是要使用的记录：

```
 TDataPackage = record
    Data: TBytes;
    TypeInfo: TMetaInfo;
    State: Byte;
    Instance: TBuffer;
  end; 
```

**谢谢大家**，所有的答案和评论。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T17:08:15.540

我真的会为此使用一套。但是，我看到你真的想要一个字节。在任何地方都使用集合，然后最后类型转换为一个字节。

该解决方案将需要更少的输入，支持标准的 delphi 运算符，并且正如 Barry Kelly 所指出的那样，确实没有性能损失。

```
procedure Test;
type
  TSetValues = (
    TSetValue1   = 0,
    TSetValue2   = 1,
    TSetValue4   = 2,
    TSetValue8   = 3,
    TSetValue16  = 4,
    TSetValue32  = 5,
    TSetValue64  = 6,
    TSetValue128 = 7
  );

  TMySet = set of TSetValues;
var
  myValue: byte;
  mySet: TMySet;
begin
  mySet := [TSetValue2, TSetValue16, TSetValue128];
  myValue := byte(mySet);
  ShowMessage(IntToStr(myValue)); // <-- shows 146
end; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T16:46:01.670

我会为此使用一组：

```
type
    TMyDatum = (mdLoaded, mdPersisted, mdChanged, mdMarkedToDelete, ...);
    TMyData = set of TMyDatum;

var
  Foo: TMyData;
begin 
  Foo := [mdLoaded, mdChanged];
  if (mdPersisted in Foo) then ... 
```

这些是作为整数实现的，因此您可以轻松地传递它们。而且我发现代码比位运算符更具可读性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T16:36:08.927

[本页](http://library.thinkquest.org/C006657/delphi/operators_in_delphi.htm)介绍 Delphi 运算符，包括位运算符。

听起来您需要使用 and 运算符。例如：

```
const
  LOADED_FROM_DATABASE = 1;
  PERSISTED = 2;
  CHANGED = 4;
  // etc...

//...

if (bitFlags and LOADED_FROM_DATABASE) <> 0 then
begin
  // handle LOADED FROM DATABASE
end;

if (bitFlags and PERSISTED) <> 0 then
begin
  // handle PERSISTED
end;

// etc... 
```

为了设置标志，您可以使用 OR：

```
bitFlags := LOADED_FROM_DATABASE or PERSISTED or CHANGED; 
```

# php - 简单的 PHP 表单验证和验证符号

> ID：516647
> 
> 赞同：2
> 
> 时间：2009-02-05T16:25:46.250
> 
> 标签：php, regex, validation

嗨，有一些表格我想在上面使用一些基本的 php 验证（正则表达式），你是怎么做的？我只有一般的文本输入、用户名、密码和日期来验证。我也想知道如何检查空输入框。我已经在互联网上查看了这些东西，但我没有找到任何好的教程。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T16:36:41.983

1.  阅读有关文本处理的 PHP.net 文档。
2.  使用字符串方法和正则表达式为电子邮件类型、日期类型等创建一个函数，如果有效则返回 true，否则返回 false。
3.  提交表单时使用函数进行测试，并向用户显示相应的错误消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T16:55:42.337

您应该使用的另一个函数是 trim() 从所有空格中清除输入以进行验证 - 一些用户可能只输入一个空格作为数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-07T17:16:54.857

有很多关于它的信息：[php form](http://phpforms.net/tutorial/html-basics/php-forms.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T16:40:52.320

空输入框通常没有设置（我不确定它是否是标准行为），因此您可以执行以下操作。客户端验证在一般情况下很有用，但您无法确定这些值如何到达服务器，因此必须进行服务器端验证。

```
if (isset($_POST['input_name'])) {
    echo $_POST['input_name'];
} 
```

最安全的方法是处理尽可能少的用户输入。例如密码，将其转换为哈希，无论如何您都不需要以纯文本形式保护它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T16:52:37.023

我一直在为我的最后一个 PHP 项目使用[Zend Framework 。](http://framework.zend.com/)在您的情况下，这可能有点矫枉过正，但[`Zend_Form`](http://framework.zend.com/manual/en/zend.form.quickstart.html)绝对值得一试。由于 Zend Framework 基本上是一组相当松散耦合的 API，您`Zend_Form`无需深入了解 ZF 的 MVC 架构的核心即可使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T18:17:21.377

PHP 内置了处理验证/过滤 的[函数。](http://www.w3schools.com/php/php_ref_filter.asp)如果您可以使用它们，这是使用它们[的一个很好的例子。](http://www.devolio.com/blog/archives/413-Data-Filtering-Using-PHPs-Filter-Functions-Part-one.html)

# visual-studio-2008 - 使用部署方法时如何从项目中删除对象？

> ID：516650
> 
> 赞同：0
> 
> 时间：2009-02-05T16:26:16.873
> 
> 标签：visual-studio-2008, sql-server-2005

当您从项目/解决方案中删除过时的对象时，将此更改转移到生产中的最佳方式是什么？部署是否有此选项？

编辑：这是 Visual Studio 2008 中的一个数据库项目，部署到 SQL Server 2005。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T16:33:04.207

我不知道有任何自动删除过时对象的方法。我们使用数据库 diff，然后在这里手动编写删除语句。

如果有人有更好的解决方案，我很想听听（我们使用的是 VS 2005，而不是 2008，但我想这不会有太大的不同）

# sql - 从代表天、月和年的三个数字创建日期的规范方法是什么？

> ID：516657
> 
> 赞同：1
> 
> 时间：2009-02-05T16:27:03.580
> 
> 标签：sql, sql-server, date

我有 2009 年，11 个月和 12 天。所有这些都作为整数传递给我。我想做的是从这些中创建一个日期。我想将这些用作我的 where 语句的一部分。

从干净的代码和最重要的速度角度来看，最好的方法是什么？

我个人使用的是 MS SQL，我相信这会有所作为。

提前致谢，

亚历克斯。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T16:31:34.210

仅使用整数的最明确的格式是`YYYYMMDD`、`YYYY-MM-DD`和`YYYY/MM/DD`。我不能专门谈论 MSSQL，但根据我的经验，`YYYY-MM-DD`它是最普遍支持的（在很大程度上是因为它是[ISO 8601 标准](http://en.wikipedia.org/wiki/ISO_8601)的一部分）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T16:38:54.617

假设您`INT`的 s 被调用`@d`，`@m`并且`@y`：

```
DATEADD(month, ((@y - 1900) * 12) + @m - 1, @d - 1) 
```

**编辑**

请注意，这种技术无论如何都不是“规范的”，它依赖于操纵 SQL Server 的`DATETIME`.

如果你传递了无效的值`@d`，`@m`或者`@y`你会得到一个无效`DATETIME`的回报：

*   { @y=2009, @m=11, @d=12 } 返回 2009-11-12（正确）
*   { @y=2009, @m=11, @d=50 } 返回 2009-12-19（错误）
*   { @y=2009, @m=13, @d=12 } 返回 2010-01-12（错误）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T16:29:41.593

您是在谈论将它们组合以存储在数据库中，还是以这种方式存储它们并希望将它们组合在查询中并转换为 dte 以使用日期数学函数？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T16:38:57.940

正如 Ben yyyy-mm-dd（ANSI 标准）所提到的，这是一个非常安全的选择，因为它不像 dd mm yyyy 或 mm dd yyyy 那样模棱两可。SQL Server 很乐意将以该格式传递的 varchar 转换为日期。

# c++ - 为什么我不能在地图中放置迭代器？

> ID：516662
> 
> 赞同：1
> 
> 时间：2009-02-05T16:28:38.897
> 
> 标签：c++, string, stl, map, iterator

我有一张这样定义的地图

```
std::map<some_key_type, std::string::iterator> mIteratorMap; 
```

还有一个名为“mHugeString”的巨大字符串。然后我遍历字符串收集迭代器，如下所示：

```
std::string::iterator It=mHugeString.begin();
std::string::iterator EndIt=mHugeString.end();
for(;It!=EndIt;++It){
  ...defining a key element...
  if(need_to_store_an_iterator)mIteratorMap[key_of_a_right_type]=It;
} 
```

最后我应该收到一个映射，其中迭代器与某种键相关联。但是迭代器在通过“make_pair”与键配对时会以某种方式失去自己，除非它指向字符串末尾的某个位置。很难说，但也许最后 256 个字节没问题。

所以问题不在于如何避免丢失迭代器，无论如何存储它们是一个愚蠢的主意，但为什么尝试在字符串开头存储迭代器会失败，为什么最后的迭代器也能正常工作？它们之间有什么区别？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T16:35:32.143

我还没有尝试过，但我希望你当然**可以**将迭代器值存储为映射中的值。

您是否知道，如果您更改了`mHugeString`之前存储的任何迭代器的内容，现在都将无效？

您可以选择将索引存储到字符串中，而不是迭代器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T16:56:36.250

我不知道为什么它应该是问题。我编写了这段代码来检查似乎工作正常的迭代器的存储和检索。[注意：我没有使用 make_pair ，因为它不应该是相关的，尽管尝试不使用它！]

```
#include <string>
#include <iostream>
#include <map>

enum UniqueKey {One, Two, Three};

typedef std::map<UniqueKey, std::string::iterator> UniqueKeyStringMap;

int main()
{
    UniqueKeyStringMap storage;

    std::string stringOne = "This is one string";

    std::string::iterator it = stringOne.begin() + 8; // "o"
    std::cout << " Iterator to store: " << std::string(it, it + 3) << std::endl;

    storage[UniqueKey::One] = it;   // Store iterator

    // Retrieve and print, string and map are valid

    UniqueKeyStringMap::iterator mapIter = storage.find(UniqueKey::One);
    if (mapIter != storage.end())
    {
        std::cout << " From storage: " << 
            std::string(mapIter->second, mapIter->second + 3) << std::endl;
    }
} 
```

预期输出：要存储的迭代器：一个来自存储：一个

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T03:26:20.143

没关系，您*可以*将迭代器存储在地图中。如果你得到一些错误，那是由其他原因引起的。请注意，如果您修改字符串，指向您的字符串的迭代器将变为无效。

请向我们展示一个完整的、可编译的代码片段，该代码片段呈现为不可用，以便我们对其进行分析。

# spring - Spring - 绑定到对象而不是字符串或原语

> ID：516670
> 
> 赞同：7
> 
> 时间：2009-02-05T16:30:24.603
> 
> 标签：spring, data-binding, spring-mvc

假设我有以下命令对象：

```
class BreakfastSelectCommand{
    List<Breakfast> possibleBreakfasts;
    Breakfast selectedBreakfast;
} 
```

我怎样才能让春天用列表中的早餐填充“selectedBreakfast”？

我想我会在我的jsp中做这样的事情：

```
<form:radiobuttons items="${possibleBreakfasts}" path="selectedBreakfast"  /> 
```

但这似乎不起作用。有任何想法吗？

谢谢，

-摩根

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-08T10:19:44.753

这一切的关键是 PropertyEditor。

您需要为早餐类定义一个 PropertyEditor，然后在控制器的 initBinder 方法中使用 registerCustomEditor 配置 ServletDataBinder。

例子：

```
public class BreakfastPropertyEditor extends PropertyEditorSupport{
    public void setAsText(String incomming){
        Breakfast b = yourDao.findById( Integer.parseInt(incomming));
        setValue(b);
    }
    public String getAsText(){
        return ((Breakfast)getValue()).getId();
    }
} 
```

请注意，您将需要一些空值检查等，但您明白了。在您的控制器中：

```
public BreakfastFooBarController extends SimpleFormController {
    @Override
    protected void initBinder(HttpServletRequest request, ServletRequestDataBinder binder) {
        binder.registerCustomEditor(Breakfast.class, new BreakfastPropertyEditor(yourDao));
    }
} 
```

需要注意的事项：

*   PropertyEditor 不是线程安全的
*   如果您需要spring bean，请手动注入它们或在spring中将它们定义为原型范围并使用方法注入到您的控制器中
*   如果入站参数无效/未找到，则抛出 IllegalArgumentException，spring 会将其正确转换为绑定错误

希望这可以帮助。

编辑（回应评论）：在给定的例子中看起来有点奇怪，因为 BreakfastSelectCommand 看起来不像一个实体，我不确定你的实际场景是什么。假设它是一个实体，例如`Person`具有一个`breakfast`属性，那么该`formBackingObject()`方法将从 the 加载 Person 对象`PersonDao`并将其作为命令返回。然后，绑定阶段将根据所选值更改早餐属性，以便到达的命令`onSubmit`已设置早餐属性。

根据您的 DAO 对象的实现，调用它们两次或尝试加载相同的实体两次实际上并不意味着您将运行两个 SQL 语句。这尤其适用于 Hibernate，它保证它将返回与给定标识符的会话中相同的对象，因此运行让绑定尝试加载`Breakfast`选择，即使它没有改变也不应该导致任何不当高架。

# java - if-less 代码：它只是一个智力挑战还是具体有用？

> ID：516677
> 
> 赞同：7
> 
> 时间：2009-02-05T16:31:38.000
> 
> 标签：java, design-patterns, oop

我的一个朋友正在谈论这些关于对象状态转换的设计技术（他是 Java 大师，顺便说一句），在没有`boolean myState`成员的情况下执行，而是将`myState`成员声明为实现与“所有者”相同接口的对象。 .

好的，我太神秘了，所以你可以在[这里](http://andreagazzarini.blogspot.com/)找到讨论，以及代码示例。

就我个人而言，我对这种方法感到兴奋，因为我的朋友向我解释了它背后的理念；从设计的角度来看，我也认为它非常连贯。顺便说一句，我关心的主要是性能和内存使用，因为编译时和运行时优化可能会进入游戏。由于我不了解 JIT 编译器和 JVM 内部结构，我很想有更广泛的意见。

你有什么想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T05:57:32.850

我不得不不同意——抛开有用的设计模式不谈，*这个特殊的例子*是荒谬的矫枉过正：

*   一个 15 行的类，具有易于理解的过程
*   变成了一个 50 行的类，目的很模糊

我看不出这是一种改进——它违反了 YAGNI ¹和 ASAP ²，使代码膨胀，并降低了效率（在不需要时实例化了多个对象来完成这项工作）。

作为一项智力练习，有点意思。作为一种编程习惯，*可怕*！;-)

* * *

¹ YANGI = 你不需要它

²尽快 = 尽可能简单

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T16:52:55.773

听起来您在问使用状态设计模式是否有“具体有用”的好处，我肯定会说是的，特别是如果您的应用程序实际上严重依赖其对象的“状态”。一个流行的典型例子是视频播放器，它始终处于一种状态，并且只能根据当前所处的状态转换到不同的状态（例如，如果它已经停止，它就不能停止，但它可以播放，它可以倒带，等等）。

虽然可以通过一些 if/else/switch 类型的条件（if (isStopped())、play() 等）相对轻松地管理该特定示例，因为没有那么多状态需要处理，当状态或者它们的转换规则开始变得更多或更复杂，状态模式绝对变得非常有价值，因为没有它，你的代码往往会疯狂地积累 elseif，随着时间的推移，事情变得越来越不可读和可管理。

所以是的，一般来说，如果您发现对象的行为根据它们的状态而变化（如果 isStopped() play() / elseif isPlaying() stop() / elseif (isBroken() fix()) 等），那么是的，请考虑使用状态模式。前面的工作要多一些，但通常值得付出努力，而且做得对，我怀疑你会仅仅因为使用它而注意到任何显着的开销。

[Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)也很好地描述了它的方法和原因——我强烈建议几乎所有编写面向对象代码的人都可以阅读这本书。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T16:41:05.050

状态/策略模式是经过验证的。它们不仅仅是智力活动。如果您现在正在考虑性能和内存使用情况……您可能正在自找麻烦。获取代码...然后配置文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T16:49:13.487

它是一种非常有用的技术。

您不会在您的班级周围传播 if(myState) 语句。
您可以将该技术扩展到许多状态，并且只需更改分配给**myState**成员的内容。

至于性能和内存使用情况，等到你有东西要测量——也许你需要尝试两种方法，并在它们工作时测量它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T05:29:23.297

是的，这很有效，而且很酷......直到某个程度（它变得愚蠢的程度）。如果必须，您甚至可以使用匿名内部类，甚至可以使用枚举。

# c++ - 用于 C++ 的 XMLUnit

> ID：516682
> 
> 赞同：8
> 
> 时间：2009-02-05T16:32:26.877
> 
> 标签：c++, xml, unit-testing, xmlunit

有谁知道是否存在类似 XMLUnit for C++ 的东西？我正在寻找一种简单的方法来检查 XML 输出中的节点、值等。我们在 Visual Studio 中使用 Google 测试，但我想任何使工作更容易的库就足够了。

我使用 Xerces 作为 XML 解析器，但 XMLUnit ( [http://xmlunit.sourceforge.net/](http://xmlunit.sourceforge.net/) ) 有一些封装在 XML 解析器上的特性，这些特性对于单元测试非常有用。例如，使用 XPath 表达式的断言、比较两个“相似”XML 的函数等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-01-11T16:58:31.297

我过去曾结合使用 Xerces 和 CPPUnit 来完成此任务。在我的测试用例中，我会在 setUp() 函数中使用 Xerces API 创建一个 DOM 对象。这个 DOM 将代表我的预期结果。然后，在测试用例本身中，我将读取 XML 文件，并且被测试的类将填充一个表示文件内容的 DOM 对象。为了检查相等性，我将通过 Xerces API (DOMTreeWalker) 遍历两个 DOM 树，并在比较 DOM 节点的内容时使用 CPPUnit 断言。这有点乏味，但当时没有可以模仿 XmlUnit 的框架。我想 Google Test 在完成这项任务时会和 CPPUnit 一样好用。

Xerces API 对 XPath 表达式有一些支持：

[http://xerces.apache.org/xerces-c/faq-parse-3.html#faq-2](http://xerces.apache.org/xerces-c/faq-parse-3.html#faq-2)

对于验证，您需要设置一个错误处理程序，如此处所述，并将其合并到您的测试用例中：

[在 Xerces C++ 中验证文档](https://stackoverflow.com/questions/2455071/validating-document-in-xerces-c)

对于 XSLT 转换检查，您需要使用 Xalan。它适用于 Xerces，所以我预计不会有任何重大困难：

[http://xalan.apache.org/old/xalan-c/index.html](http://xalan.apache.org/old/xalan-c/index.html)

我找不到任何在 C++ 中打包类似 XMLUnit 的操作的明显产品。所以答案是我认为你必须自己动手。祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-31T23:30:17.213

我真的很喜欢[http://pugixml.org/](http://pugixml.org/)

它：

*   是稳定的
*   非常快
*   有很好的文档和示例代码
*   在 MIT 许可下获得许可
*   对 STL 非常友好
*   仍然是一个相当活跃的项目
*   对xpath有很大的支持

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-16T16:11:00.427

You can use tinyxml package here: [tinyxml](http://sourceforge.net/projects/tinyxml/)

I'm working with it and it's quite friendly and bug free.

It's an xml handling. I guess it wasn't designed for unit testing, but you can use it to check/test your xml files. It as expected loads the xml into a DOM object and supplies a nice API to run on the nodes.

Gal

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-16T16:17:36.103

Xerces at [http://xerces.apache.org/xerces-c/](http://xerces.apache.org/xerces-c/)i pretty full featured, has a C++ interface and produces good error messages, which several other XML parsers don't do so well. Having said that, it's pretty big & I've wound up using my own wrapper round the C parser [Expat](http://expat.sourceforge.net/).

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-19T01:45:15.800

我目前正在将 libxml++ 用于我的个人项目。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-07-31T17:48:48.040

我将 Boost property_tree 用于 xml，易于使用，非常健壮，并且与 Boost 单元测试框架配合得很好。

# c# - C# createuser 向导 OnDeactivate 未触发

> ID：516685
> 
> 赞同：0
> 
> 时间：2009-02-05T16:33:05.283
> 
> 标签：c#, asp.net, createuserwizard

我很困惑我有一个 createuser 向导控件，我将它与我的自定义用户类和角色类一起使用。

我有一个步骤，以便管理员用户可以创建新用户并为他们分配角色。OnActivate 方法正在触发，但 OnDeactivate 未触发。我在这两种方法上都设置了断点，并确认它根本不会进入该方法。我已经在下面包含了标记和代码，（对不起，它有点长，我不想删掉任何东西，以防出现问题）：

```
<asp:Content ID="Content1" ContentPlaceHolderID="ContentPlaceHolder1" runat="Server">
<asp:CreateUserWizard ID="CreateUserWizard1" runat="server" ContinueDestinationPageUrl="~/admin/default.aspx"
    DisableCreatedUser="false" Font-Names="Verdana" BackColor="white" Font-Size="10pt"
    BorderWidth="1px" BorderColor="#CCCC99" BorderStyle="Solid" CompleteSuccessText="The account has been successfully created."
    UnknownErrorMessage="The account was not created. Please try again.">
    <WizardSteps>
        <asp:CreateUserWizardStep ID="CreateUserWizardStep2" runat="server" Title="Step 1: Basic User Information"
            OnDeactivate="UpdateCurrentLvl_OnDeactivate">
            <ContentTemplate>
                <table style="font-size: 10pt; font-family: Verdana" border="0" width="400">
                    <tr>
                        <td style="font-weight: bold; color: white; background-color: #6b696b" align="center"
                            colspan="2">
                            Create Your UserID
                        </td>
                    </tr>
                    <tr>
                        <td align="right">
                            <asp:Label ID="UserNameLabel" runat="server" AssociatedControlID="UserName">UserID:</asp:Label></td>
                        <td>
                            <asp:TextBox ID="UserName" runat="server"></asp:TextBox>
                            <asp:RequiredFieldValidator ID="UserNameRequired" runat="server" ToolTip="User Name is required."
                                ErrorMessage="User Name is required." ValidationGroup="CreateUserWizard1" ControlToValidate="UserName">
                                    *</asp:RequiredFieldValidator>
                        </td>
                    </tr>
                    <tr>
                        <td align="right">
                            <asp:Label ID="PasswordLabel" runat="server" AssociatedControlID="Password">Password:</asp:Label></td>
                        <td>
                            <asp:TextBox ID="Password" runat="server" TextMode="Password"></asp:TextBox>
                            <asp:RequiredFieldValidator ID="PasswordRequired" runat="server" ToolTip="Password is required."
                                ErrorMessage="Password is required." ValidationGroup="CreateUserWizard1" ControlToValidate="Password">
                                    *</asp:RequiredFieldValidator>
                        </td>
                    </tr>
                    <tr>
                        <td align="right">
                            <asp:Label ID="ConfirmPasswordLabel" runat="server" AssociatedControlID="ConfirmPassword">Re-Type Password:</asp:Label>
                        </td>
                        <td>
                            <asp:TextBox ID="ConfirmPassword" runat="server" TextMode="Password"></asp:TextBox>
                            <asp:RequiredFieldValidator ID="ConfirmPasswordRequired" runat="server" ToolTip="Confirm Password is required."
                                ErrorMessage="Confirm Password is required." ValidationGroup="CreateUserWizard1"
                                ControlToValidate="ConfirmPassword">
                                    *</asp:RequiredFieldValidator>
                        </td>
                    </tr>
                    <tr>
                        <td align="right">
                            <asp:Label ID="EmailLabel" runat="server" AssociatedControlID="Email">Email:</asp:Label>
                        </td>
                        <td>
                            <asp:TextBox ID="Email" runat="server"></asp:TextBox>                                
                        </td>
                    </tr>
                </table>
                <br />
                <br />
                <table style="font-size: 10pt; font-family: Verdana" border="0" width="400">
                    <tr>
                        <td style="font-weight: bold; color: white; background-color: #6b696b" align="center"
                            colspan="2">
                            If You Forget Your Password
                        </td>
                    </tr>
                    <tr>
                        <td align="right">
                            Security Question:
                        </td>
                        <td>
                            <asp:DropDownList ID="Question" runat="server" Width="200">
                                <asp:ListItem Text="[Select a Question]" />
                                <asp:ListItem Text="Favorite Pet" />
                                <asp:ListItem Text="Mother's Maiden Name" />
                                <asp:ListItem Text="Who was your childhood hero?" />
                                <asp:ListItem Text="Your favorite pasttime?" />
                            </asp:DropDownList>
                            <asp:RequiredFieldValidator ID="QuestionRequired" runat="server" InitialValue="[Select a Question]"
                                ControlToValidate="Question" ErrorMessage="Select a Security Question" ValidationGroup="CreateUserWizard1">*</asp:RequiredFieldValidator>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" width="170">
                            Your Answer:
                        </td>
                        <td>
                            <asp:TextBox ID="Answer" runat="server"></asp:TextBox>
                            <asp:RequiredFieldValidator ID="AnswerRequired" runat="server" ControlToValidate="Answer"
                                ErrorMessage="RequiredFieldValidator" ValidationGroup="CreateUserWizard1">*</asp:RequiredFieldValidator>
                        </td>
                    </tr>
                </table>
                <br />
                <br />
                <table style="font-size: 10pt; font-family: Verdana" border="0" width="400">
                    <tr>
                        <td style="font-weight: bold; color: white; background-color: #6b696b" align="center"
                            colspan="2">
                            Help Us Customize Your Experience
                        </td>
                    </tr>
                    <tr>
                        <td align="right" width="170">
                            Set Level of the user:</td>
                        <td>
                            <asp:DropDownList ID="cLevel" runat="server">
                                <asp:ListItem Text="[Select a Level]" />
                                <asp:ListItem Text="1" />
                                <asp:ListItem Text="2" />
                                <asp:ListItem Text="3" />
                            </asp:DropDownList>
                            <asp:RequiredFieldValidator ID="RequiredFieldValidator1" runat="server" InitialValue="[Select a Level]"
                                ControlToValidate="cLevel" ErrorMessage="Select a Level" ValidationGroup="CreateUserWizard1">*</asp:RequiredFieldValidator>
                        </td>
                    </tr>
                    <tr>
                        <td align="center" colspan="2">
                            <asp:CompareValidator ID="PasswordCompare" runat="server" ErrorMessage="The Password and Confirmation Password must match."
                                ValidationGroup="CreateUserWizard1" ControlToValidate="ConfirmPassword" ControlToCompare="Password"
                                Display="Dynamic">
                            </asp:CompareValidator>
                        </td>
                    </tr>
                    <tr>
                        <td style="color: red" align="center" colspan="2">
                            <asp:Literal ID="ErrorMessage" runat="server" EnableViewState="False"></asp:Literal>
                        </td>
                    </tr>
                </table>
            </ContentTemplate>
        </asp:CreateUserWizardStep>
        <asp:WizardStep runat="server" ID="wsAssignUserToRoles" AllowReturn="False" Title="Step 2: Assign User To Roles"
            OnActivate="AssignUserToRoles_Activate" OnDeactivate="AssignUserToRoles_Deactivate">
            <table>
                <tr>
                    <td>
                        Select one or more roles for the user:</td>
                </tr>
                <tr>
                    <td>
                        <asp:ListBox ID="AvailableRoles" runat="server" SelectionMode="Multiple" Height="104px"
                            Width="264px"></asp:ListBox>
                    </td>
                </tr>
            </table>
        </asp:WizardStep>
        <asp:CompleteWizardStep ID="CompleteWizardStep2" runat="server">
        </asp:CompleteWizardStep>
    </WizardSteps>
    <TitleTextStyle Font-Bold="True" BackColor="#6B696B" ForeColor="White"></TitleTextStyle>
</asp:CreateUserWizard> 
```

后面的代码是：

```
public partial class admin_createuser : System.Web.UI.Page
{
protected void Page_Load(object sender, EventArgs e)
{

}

protected void CreateUserWizard1_CreatedUser(object sender, EventArgs e)
{
    // Create an empty Profile for the newly created user
    ProfileCommon p = (ProfileCommon)ProfileCommon.Create(CreateUserWizard1.UserName, true);

    // Populate some Profile properties off of the create user wizard
    p.CurrentLevel = Int32.Parse(((DropDownList)CreateUserWizard1.CreateUserStep.ContentTemplateContainer.FindControl("clevel")).SelectedValue);

    // Save profile - must be done since we explicitly created it
    p.Save();
}

// Activate event fires when the user hits "next" in the CreateUserWizard
public void AssignUserToRoles_Activate(object sender, EventArgs e)
{
    // Databind list of roles in the role manager system to a listbox in the wizard
    AvailableRoles.DataSource = Roles.GetAllRoles(); ;
    AvailableRoles.DataBind();
}

// Deactivate event fires when user hits "next" in the CreateUserWizard 
public void AssignUserToRoles_Deactivate(object sender, EventArgs e)
{
    // Add user to all selected roles from the roles listbox
    for (int i = 0; i < AvailableRoles.Items.Count; i++)
    {
        if (AvailableRoles.Items[i].Selected == true)
            Roles.AddUserToRole(CreateUserWizard1.UserName, AvailableRoles.Items[i].Value);
    }
}

//set the user level to the value set in the form as it has been inserted into the DB at this point.
public void UpdateCurrentLvl_OnDeactivate(object sender, EventArgs e)
{
    int level = Int32.Parse(((DropDownList)CreateUserWizard1.CreateUserStep.ContentTemplateContainer.FindControl("clevel")).SelectedValue);
    MyMembershipUser myUser = (MyMembershipUser)Membership.GetUser(CreateUserWizard1.UserName);
    myUser.CurrentLVL = level;
    Membership.UpdateUser(myUser);
} 
```

}

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T17:37:11.253

好吧，我似乎找到了“一个”答案……不知道为什么会这样。

我在 /admin/createuser.aspx 下有创建用户向导页面。当我把它放在网站的根目录中时，即.. /createuser.aspx 一切正常！！！！

无法解释，但它似乎解决了问题.. 很奇怪！

.....**编辑**

我说得太早了。这似乎是一个权限的事情。我认为它想让我（正在创建另一个帐户的用户）退出并登录尚未加入任何组的新用户。这意味着他们无法访问我的 web.config 中具有安全性的任何页面。

问题是如何阻止被注销的人并授予新用户权限？

我的最终解决方案是在 CreateUserWizard 控件中使用此语句：

```
LoginCreatedUser="false" 
```

它只是阻止用户登录并消除对权限问题的任何担忧，因为当前登录的用户必须首先拥有该页面的权限。

# inversion-of-control - 国际奥委会和赛事

> ID：516686
> 
> 赞同：2
> 
> 时间：2009-02-05T16:34:10.397
> 
> 标签：inversion-of-control, ioc-container

我很难协调 IoC、接口和事件。让我们看看我是否可以在不写书的情况下解释这一点。

我刚刚开始使用 IoC，我正在玩 Spring。我们有一个简单的数据层，它早在 EF 或其他人之前就已构建。其中一个类是具有一些方法和事件的 DBProcedure。

我创建了一个“真正的” DBProcedure 类实现的 IDBProcedure 接口。在 TDD 方式中，我希望能够将“真正的” DBProcedure 类换成另一个实现相同接口的测试类。对我来说，这意味着 IDBProcedure 接口应该定义在与我的数据层不同的命名空间/项目中，对吗？

但是 DBProcedure 可以引发一些事件，并且这些事件提供自定义 EventArgs 派生类。这是否意味着 EventArgs 类也需要在数据层之外定义？似乎它可以使界面工作，但这似乎很糟糕，因为它传播了数据层？

另一方面，也许我有错误的想法——即使我没有使用任何“真实”类，在我测试获取接口和事件定义时是否可以包含数据层命名空间？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T17:43:27.247

是的，您需要将接口及其依赖的所有类型移动到某处，因为您*不*希望接口模块依赖于实现。

对此的典型选择是两种选择之一

```
Impl ----> Api <---- client 
```

（实现依赖于api，客户端依赖于api，api模块中的一切）

```
Impl ----> Api <----- client
\           |          /
 \          V         /
  ------->Model<------ 
```

在这里，*每个人都*依赖于一个通用的“模型”模块，其中包含枚举等。此版本的优点是您可以让多个 API 模块共享相同的公共枚举和其他工件。（因为你真的不希望 API 通常依赖于其他 API 模块）

# executable - 自修改代码的用途是什么？

> ID：516688
> 
> 赞同：51
> 
> 时间：2009-02-05T16:34:24.517
> 
> 标签：executable, self-modifying

**自我修改代码**有什么实际用途吗？

我知道它们可用于构建蠕虫/病毒，但我想知道程序员可能不得不使用自我修改代码是否有充分的理由。

有任何想法吗？假设的情况也是受欢迎的。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-05T16:37:41.827

事实证明，关于“[自我修改代码](http://en.wikipedia.org/wiki/Self-modifying_code)”的维基百科条目有一个很棒的列表：

> 1.  **状态相关循环的半自动优化**。
> 2.  **运行时代码生成**，或在运行时或加载时（例如，在实时图形领域很流行）中的算法的专门化，例如准备代码以执行特定调用中描述的键比较的通用排序实用程序。
> 3.  **更改对象的内联状态**，或模拟闭包的高级构造。
> 4.  **修补子程序地址调用**，通常在加载动态库时进行，或者在每次调用时修补子程序对其参数的内部引用，以便使用它们的实际地址。这是否被视为“自我修改代码”是一个术语的例子。
> 5.  **进化计算系统**，例如遗传编程。
> 6.  隐藏代码以**防止逆向工程**，例如通过使用反汇编器或调试器。
> 7.  隐藏代码以**逃避**病毒/间谍软件扫描软件等的检测。
> 8.  使用重复操作码的滚动模式填充 100% 的内存（在某些架构中），以**擦除所有程序和数据**，或**烧毁硬件**。
> 9.  **压缩要在运行时解压缩和执行的代码**，例如，当内存或磁盘空间有限时。
> 10.  一些非常有限的指令集别无选择，只能使用自修改代码来**实现某些功能**。例如，仅使用减法和分支如果负“指令”的“单指令集计算机”机器不能进行间接复制（类似于 C 编程中的“*a = **b”语言）而不使用自修改代码。
> 11.  **更改容错**指令

 **关于使用自我修改代码阻止黑客的观点：

在几次固件更新过程中，DirectTV 在他们的智能卡上慢慢组装了一个程序，以销毁被黑客入侵以非法接收未付费频道的卡。[有关更多信息，请参阅 Jeff 关于黑色星期天黑客](http://www.codinghorror.com/blog/archives/001125.html)的 Coding Horror 文章。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-05T16:37:56.943

我见过自修改代码用于：

1.  速度优化，通过让程序在运行中为自己编写更多代码

2.  混淆，使逆向工程更加困难

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-05T16:40:10.183

在以前 RAM 有限的时代，使用自我修改代码来节省内存。现在，例如像[UPX](http://upx.sourceforge.net/)这样的应用程序压缩实用程序用于在加载应用程序的压缩图像后解压缩/修改自己的代码。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-05T17:02:17.843

因为 Commodore 64 没有很多寄存器并且有一个 1Mhz 的处理器。当您需要读取一个内存地址偏移量时，修改源更容易。

```
@Reader:
LDA $C000
STA $D020
INC Reader+1
JMP Reader 
```

无论如何，那是我最后一次编写自修改代码 :-)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-05T20:09:59.043

人工智能？

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-01-06T13:36:49.457

因为它真的很酷，有时这就是足够的理由。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-09-17T05:53:18.670

1960 年代的汇编语言使用自修改代码来实现没有堆栈的函数调用。

Knuth，v1，第 1 版，第 182 页：

```
MAX100  STJ   EXIT   ;Subroutine linkage
        ENT3  100    ;M1\. Initialize
        JMP   2F
1H      CMPA  X,3    ;M3\. Compare
        JGE   *+3
2H      ENT2  0,3    ;M4\. Change m
        LDA   X,3    ;(New maximum found)
        DEC3  1      ;M5\. Decrease k
        J3P   1B     ;M2\. All tested?
EXIT    JMP   *      ;Return to main program 
```

> 在包含此编码作为子程序的较大程序中，单条指令“JMP MAX100”将导致寄存器 A 设置为位置 X + 1 到 X + 100 的当前最大值，最大值的位置将出现在 rI2 . 在这种情况下，子程序链接是通过指令“MAX100 STJ EXIT”和随后的“EXIT JMP *”实现的。由于 J 寄存器的操作方式，exit 指令将跳转到最初引用 MAX100 的位置之后的位置。

*编辑：*即使在这里有简短的解释，也可能很难看到发生了什么。在行`MAX100 STJ EXIT`中，`MAX100`是指令的标签（因此对于整个过程而言），`STJ`表示 STORE 跳转寄存器（我们刚刚来自*的地方*），`EXIT`表示标记为“EXIT”的内存位置是 STORE 的目标。`EXIT`，我们稍后看到的是最后一条指令的标签。所以它正在覆盖代码！但是，许多指令（包括`STJ`这里）隐式地仅覆盖指令字的操作数部分。所以`JMP`保持不变，并且`*`是一个虚拟令牌，因为放在那里真的没有任何意义，它只会被覆盖。

* * *

自修改代码也用于寄存器间接寻址不可用的地方，但您需要的地址就在寄存器中。PDP-1 语言：

```
dap .+1  ;deposit address part of accumulator in (IP+1)
lac xy   ;load accumulator with (ADDRESS) [xy is a dummy symbol, just like * above] 
```

这两条指令`ACC := (ACC)`通过修改加载指令的操作数来执行。

像这样的修改是相对安全的，在古董建筑上，它们是*必要的。*

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-02-05T17:37:09.803

很多原因。在我的头顶上：

*   运行时类构建和元编程。例如，拥有一个与 SQL 表建立连接并生成专门用于该表的客户端类的类工厂（具有列的访问器、查找方法等）。

*   然后当然还有著名的 bitblt 示例和 regexp 类似物。

*   基于 RT 信息的动态优化（a la tracking JITs）

*   增值环境中 ada 样式泛型函数的子类型特化。

——马库斯

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-02-05T16:37:15.493

动态链接是一种自我修改（修补绝对和/或相对跳转位置）......不过，这通常由 O/S 的程序加载器完成。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-05T16:38:18.907

[神经网络](http://en.wikipedia.org/wiki/Artificial_neural_network)是一种自修改代码。

然后是[进化算法](http://en.wikipedia.org/wiki/Evolutionary_Algorithm)，它们会自我修改。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-05T16:51:02.703

Mike Abrash 不久前为 Dobb 博士的日记描述了 Pixomatic 代码生成器：[http](http://www.ddj.com/architect/184405807) ://www.ddj.com/architect/184405807 。那是一个软件 3d dx7(?) 兼容的光栅化器。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-05T16:54:39.077

大声笑 - 我曾两次编写过自修改代码：

1.  第一次学习汇编语言时，在我理解间接索引访问之前
2.  意外地，作为汇编语言和 C 中的指针错误

我可以想象在某些情况下，自修改代码会比替代代码更有效，但没有什么明显的飞跃。一般来说，这是要避免的——调试噩梦等——除非你故意像上面提到的那样试图混淆。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-05T16:49:19.617

实现自己的脚本语言的应用程序经常这样做。例如，数据库服务器经常以这种方式编译存储过程（或查询）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-06T13:58:54.267

SwiftShader 中的动态代码生成是一种自修改代码形式，使其能够在 CPU 上高效地实现 Direct3D 9。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-01-23T08:05:54.053

现代示例：我有一个需要 JWT 令牌才能工作的脚本。要请求令牌，需要进行交互式登录，或者使用与新 JWT 令牌一起发布的刷新令牌。将刷新令牌存储在脚本中并在每次执行时更新它会很好

# c# - 如何为带有参数的非泛型基类声明泛型类的构造函数

> ID：516689
> 
> 赞同：1
> 
> 时间：2009-02-05T16:34:44.483
> 
> 标签：c#, generics

我有一个带有派生泛型类的非泛型基类。AbstractRepository 和 ILoggingManager 由 IoC 框架提供。

**基类**

```
public abstract class EventHandlerBase
    : AbstractDataProvider
    , IEventHandler
{
    public EventHandlerBase(
        AbstractRepository data,
        ILoggingManager loggingManager
        )
        : base(data, loggingManager)
    {
    }
} 
```

**派生类**

```
public abstract class EventHandlerBase<TDetail>
    : EventHandlerBase
    where TDetail : Contracts.DeliveryItemEventDetail
{
} 
```

我想在派生类中声明一个构造函数，它将调用非泛型基类，但我不知道语法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T16:38:00.593

```
public class EventHandlerBase(AbstractRepository data,
                              ILoggingManager loggingManager)
     : base(data, loggingManager)
{
     // Whatever
} 
```

应该可以正常工作。如果没有，你能说明你遇到的问题吗？

编辑：我认为整个基类的事情可能会混淆这里的问题。在泛型类型中声明构造函数时，不指定类型参数。例如，`List<T>`看起来像：

```
public class List<T>
{
    public List()
    {
    }
} 
```

这个想法是，在类声明中，`T`是已知的——当你想添加*更多*类型参数时，你只需要指定类型参数，例如对于像`ConvertAll`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T16:49:16.687

它不应该更像：

```
public abstract class EventHandlerBase<TDetail> : EventHandlerBase    
  where TDetail : Contracts.DeliveryItemEventDetail
{
  public EventHandlerBase(AbstractRepository data, ILoggingManager loggingManager)
    : base(data, loggingManager)
  {
     // Initialize generic class
  }
} 
```

# xml - 在 flex 中处理特定的 RDF 文件

> ID：516691
> 
> 赞同：0
> 
> 时间：2009-02-05T16:35:45.433
> 
> 标签：xml, apache-flex, rdf

我仍在处理特定的 RDF 文件，但似乎有些事情对我来说并不正确。我的 RDF 文件的代码如下：

```
<?xml version = '1.0"?>

<rdf:RDF xmlns:rdf = "http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns:dc = "http://purl.org/dc/elements/1.1/"
xmlns:dp = "http://www.telemed.uniud.it/dp/0.1/"
xmlns:dcq = "http://purl.org/dc/qualifiers/1.0/" >

<rdf:Description rdf:about="m021">
    <dc:creator>CAB</dc:creator>
    <dc:title>m021</dc:title>
    <dc:subject></dc:subject>
    <dc:date>null</dc:date>
    <dc:description></dc:description>
    <dc:identifier>1</dc:identifier>
    <dc:relation.requires rdf:resource="./20x/m02120x"/>
    <dc:relation.requires rdf:resource="./10x/m02110x"/>
    <dc:relation.requires rdf:resource="./5x/m0215x"/>
    <dc:relation.requires rdf:resource="./2.5x/m0212.5x"/>
    <dc:relation.requires rdf:resource="preview.jpg"/>
    <dp:resolution rdf:parseType="Resource">
      <dp:unit>micron</dp:unit>
      <dp:x>0.23235294</dp:x>
      <dp:y>0.23046875</dp:y>
    </dp:resolution>
    <dp:objective rdf:parseType="Resource">
      <dp:magnification>20.0</dp:magnification>
      <dp:na>0.6</dp:na>
    </dp:objective>
    <dp:imsize rdf:parseType="Resource">
      <dp:x>316</dp:x>
      <dp:y>236</dp:y>
    </dp:imsize>
</rdf:Description>

<rdf:Description rdf:about="./20x/m02120x">
    <dp:type>plane</dp:type>
    <dp:magnification>20</dp:magnification>
    <dp:matrix rdf:parseType="Resource">
        <dp:xrange>1-103</dp:xrange>
        <dp:yrange>1-86</dp:yrange>
    </dp:matrix>
</rdf:Description>

</rdf:RDF> 
```

我已经使用 URLLoader 加载了这个文件，并且在我的脚本中我试图访问一些属性。例如，我必须访问属性 dp:x，嵌套在 dp:resolution 中，嵌套在 rdf:Description 中，在我看来，正确的代码是：

//假设'result:XML'是包含我所有RDF和xmlLabel标签的变量

xmlLabel.text = '测试：' + result.Description.resolution.x;

但是这段代码给了我一个空的结果。

我尝试了一种不同的（而不是优雅的方式）来通过以下行来做到这一点：

xmlLabel.text = '测试：' + result.child(0).child(11).child(1);

和这段代码工作，给我的价值 0.23235294 （如预期）

我的问题是：我在调用属性时做错了什么？我还尝试了没有结果的“双点”符号（例如结果..描述）。

问题可能是我正在处理的文件不是有效的 XML 文件？在这种情况下，有没有办法让我的 RDF 适应有效的 XML 以使其工作？

谢谢您的回答

大卫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T16:50:27.853

嗨，大卫（是的，是我，程 :)）。结果为空的原因是该标签是在命名空间中指定的，并且您必须在访问该标签时指定它。[您可以在这个 flex 教程](http://www.jumpingbean.co.za/blogs/mark/flex_xml_namespace_processing)中找到有用的信息。

基本上你必须声明一个命名空间变量，比如：

```
var rdf:Namespace = new Namespace ("http://www.w3.org/1999/02/22-rdf-syntax-ns#");
var dp:Namespace = new Namespace ("http://www.telemed.uniud.it/dp/0.1/"); 
```

然后在访问节点时使用它，例如：

```
var resolution = result.ref::Description.dp::resolution 
```

# eclipse - 枚举我所有的 Eclipse 编辑器？

> ID：516704
> 
> 赞同：5
> 
> 时间：2009-02-05T16:37:42.387
> 
> 标签：eclipse, eclipse-rcp, jface, eclipse-pde

我构建了一个简单的 Eclipse 插件，用户可以在其中使用`TableViewer`数据库资源打开任何这些资源的编辑器。

因此，用户可能有零个向上运行的编辑器实例。

是否有 API 可用于获取这些编辑器实例的列表？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T16:51:12.063

您可以通过以下方式获取对所有打开编辑器的引用：

```
PlatformUI.getWorkbench().getActiveWorkbenchWindow()
    .getActivePage().getEditorReferences(); 
```

然后检查这些以选择引用编辑器类型实例的那些。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-04-28T16:12:07.890

根据 API 的 javadoc，一个工作台可以有多个窗口，一个窗口可以有多个页面，并且它们不共享编辑器。

因此，为了获得所有打开的编辑器，您应该按照以下方式执行操作（排除错误检查等）：

```
List<IEditorReference> editors = new ArrayList<IEditorReference>();
for (IWorkbenchWindow window : PlatformUI.getWorkbench().getWorkbenchWindows()) {
    for (IWorkbenchPage page : window.getPages()) {
        for (IEditorReference editor : page.getEditorReferences()) {
            editors.add(editor);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T14:59:40.213

请注意，这样的枚举[不会尊重标签顺序](http://dev.eclipse.org/newslists/news.eclipse.platform/msg72043.html)

以下是编辑器枚举的示例：

```
IWorkbenchWindow window = HandlerUtil.getActiveWorkbenchWindowChecked(event);
IWorkbenchPage page = window.getActivePage();
IEditorPart actEditor = page.getActiveEditor();
IEditorReference[] editors = page.getEditorReferences();
for (int i=0; i<editors.length-1; i++) {
  if (editors[i].getEditor(true) == actEditor) {
    page.activate(editors[i+1].getEditor(true));
    return null;
  }
} 
```

# sql - SQL 生成一组日期

> ID：516712
> 
> 赞同：4
> 
> 时间：2009-02-05T16:38:38.250
> 
> 标签：sql, datetime, postgresql

我试图找到一种方法让 SELECT 语句返回具有给定间隔的 2 个输入日期之间的日期集。我希望能够轻松更改将返回的时间范围和间隔，因此使用一系列 SELECT ... UNION 进行硬编码并不理想。

例如：我希望最后 60 秒内的所有日期都以 5 秒为间隔。

预期的：

```
 times
---------------------
2009-02-05 08:00:00
2009-02-05 08:00:05
2009-02-05 08:00:10
2009-02-05 08:00:15
2009-02-05 08:00:20
...
2009-02-05 08:00:55 
```

编辑： generate_series(...) 可以用来代替 SELECT 中的表，并模拟一个包含一系列数字的表，其中包含给定的起始值、结束值和可选的步骤。从那里可以将它转换为我需要的时间函数类型并在 SELECT 期间进行操作。

谢谢夸斯诺伊。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T16:49:45.407

```
SELECT CAST (s || ' seconds' AS INTERVAL) + TIMESTAMP 'now'
FROM generate_series(0, -60, -5) s 
```

# performance - 如何对虚拟机进行基准测试

> ID：516716
> 
> 赞同：17
> 
> 时间：2009-02-05T16:38:54.727
> 
> 标签：performance, vmware, virtualization, benchmarking, xen

我正在尝试对 XenServer 与 ESX 进行公平比较，我想做的一个比较是多个 VM 的性能。有谁知道如何以公平的方式对 VM 性能进行基准测试？

在每台服务器上，我想运行固定数量的 XP/Vista VM（例如 8 个），并衡量每个服务器在负载下运行的速度。理想情况下，我想要对整个系统（CPU/内存/磁盘/网络）进行一些基准测试，而不仅仅是一个方面。

在我看来，这实际上是一件非常棘手的事情，要获得任何有意义的结果，因此将不胜感激任何建议！

我也有兴趣查看已发布的任何现有报告或比较（最好是独立的，而不是偏向供应商的！）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T16:00:27.860

作为一般性的回答，VMware（与 SPEC Virtualization 小组委员会中的其他虚拟化供应商一起）已经整合了一个名为[VMmark](http://www.vmware.com/products/vmmark/)的虚拟机管理程序基准测试套件，可供下载。VMmark 网站讨论了为什么此基准测试可能有助于比较管理程序，包括[常见问题解答](http://www.vmware.com/products/vmmark/faq.html)和描述基准测试的[白皮书。](http://www.vmware.com/vmtn/resources/573)

也就是说，如果您正在寻找一些非常具体的东西（例如，它将如何在*您的*工作负载下执行），您可能必须推出自己的 VMmark 变体，特别是如果您不尝试做 VMmark 基准测试的各种事情（例如，Web 服务器、数据库服务器、文件服务器等）尽管如此，其开发背后的方法应该是令人感兴趣的。

免责声明：我为 VMware 工作，但不在 VMmark 上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T16:48:10.993

我不明白为什么您不能在 VM 中使用通用基准测试：WinSAT、Passmark、Futuremark、SiSoftware 等……将 VM 托管在不同的主机上，看看情况如何。

顺便说一句，与您的预期用途不匹配的基准实际上可能会阻碍您的评估。根据正确执行此操作的重要性，您可能必须自己构建以使其具有相关性。

你为什么要坐板凳？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T21:12:52.847

一些轶事证据怎么样？

我将假设这是一个测试环境，因为您想在 XP/Vista 上进行基准测试。如果我错了，请纠正我。

我目前的测试环境是大约 20 台虚拟机，它们具有不同的操作系统（2000/XP/Vista/Vista64/Server 2008/Server 2003），在具有 8Gb RAM（希望很快升级到 16Gb）和最慢的双四核 Xeon 机器上采用不同的配置所有机器都是 Vista，主要是由于磁盘访问量大（即使禁用了 Windows Defender）

建议 - 硬件 RAID。否则运行 Vista 虚拟机太痛苦了。- 更多内存。

如果您正在进行基准测试并希望运行 Vista 虚拟机，我建议您将重点放在对磁盘访问进行基准测试。如果在其他地方会有性能差异，我怀疑它们会有什么重要意义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-27T08:15:08.110

我最近遇到了 VMware 的 ESX 性能文档 - [http://www.vmware.com/pdf/VI3.5_Performance.pdf](http://www.vmware.com/pdf/VI3.5_Performance.pdf)。那里有很多关于提高性能和基准测试的内容。

# .net - Visual Studio“任何 CPU”目标是什么意思？

> ID：516730
> 
> 赞同：540
> 
> 时间：2009-02-05T16:43:26.713
> 
> 标签：.net, visual-studio-2008, build, 64-bit

我对 Visual Studio 2008 中的 .NET 平台构建选项有些困惑。

什么是“Any CPU”编译目标，它生成什么样的文件？我检查了这个“任何 CPU”构建的输出可执行文件，发现它们是 x86 可执行文件（谁不会看到它的到来！）。那么，将可执行文件定位到 x86 与“任何 CPU”之间有什么区别吗？

我注意到的另一件事是托管 C++ 项目没有此平台作为选项。这是为什么？这是否意味着我对“任何 CPU”可执行文件是普通的 32 位可执行文件的怀疑是正确的？

* * *

## 回答 #1

> 赞同：414
> 
> 时间：2009-02-05T16:47:06.690

AnyCPU**程序**集在加载到 64 位进程时将 JIT 到 64 位代码，当加载到 32 位进程时将 JIT 到 32 位代码。

通过限制 CPU，您会说：*程序集使用的某些东西（可能是非托管的）需要 32 位或 64 位。*

* * *

## 回答 #2

> 赞同：337
> 
> 时间：2010-01-23T18:01:21.167

我想大部分重要的东西已经说了，但我只是想补充一点：如果你编译为**Any CPU**并在 x64 平台上运行，那么你将无法加载 32 位 DLL 文件，因为您的应用程序不是在[WoW64](https://en.wikipedia.org/wiki/WoW64)中启动的，但是那些 DLL 文件需要在那里运行。

如果您编译为 x86，则 x64 系统将在 WoW64 中运行您的应用程序，您将能够加载 32 位 DLL 文件。

因此，如果您的依赖项可以在任一环境中运行，我认为您应该选择“Any CPU”，但如果您有 32 位依赖项，请选择 x86。Microsoft 的这篇文章对此进行了一些解释：

*[/CLRIMAGETYPE（指定 CLR 图像的类型）](http://msdn.microsoft.com/en-us/library/31zwwc39.aspx)*

顺便说一句，[其他 Microsoft 文档](https://docs.microsoft.com/en-us/windows/uwp/packaging/device-architecture#x86)同意 x86 通常是更便携的选择：

> 选择 x86 通常是应用程序包最安全的配置，因为它几乎可以在所有设备上运行。在某些设备上，具有 x86 配置的应用程序包将无法运行，例如 Xbox 或某些 IoT Core 设备。但是，对于 PC，x86 包是最安全的选择，并且具有最大的设备部署范围。很大一部分 Windows 10 设备继续运行 x86 版本的 Windows。

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2017-01-20T14:35:57.823

归功于*[“CLR via C#”](https://books.google.co.uk/books?id=36tCAwAAQBAJ&pg=PT38)*一书，请参见：

[![在此处输入图像描述](https://i.stack.imgur.com/xzfCG.png)](https://i.stack.imgur.com/xzfCG.png)

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2009-02-05T16:47:51.057

这是[一个快速概述](https://web.archive.org/web/20150401033053/http://visualstudiohacks.com/articles/visual-studio-net-platform-target-explained)，解释了不同的构建目标。

根据我自己的经验，如果您希望构建一个可以在 x86 和 x64 平台上运行的项目，并且您没有任何特定的 x64 优化，我会将构建更改为专门说“x86”。

这样做的原因是有时你会得到一些 DLL 文件发生冲突，或者一些代码最终会在 x64 环境中导致[WoW崩溃。](http://en.wikipedia.org/wiki/Windows_on_Windows)通过专门指定 x86，x64 操作系统会将应用程序视为纯 x86 应用程序，并确保一切顺利运行。

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2009-02-05T16:48:19.557

查看文章*[Visual Studio .NET 平台目标说明](http://web.archive.org/web/20151215192101/http://visualstudiohacks.com/articles/visual-studio-net-platform-target-explained/)*。

> 默认设置“任何 CPU”意味着程序集将在当前运行的 CPU 上本地运行。意思是，它将在 64 位机器上以 64 位运行，在 32 位机器上以 32 位运行。如果从 64 位应用程序调用程序集，它将作为 64 位程序集执行，依此类推。

上面的链接已经被报坏了，所以这里有另一篇有类似解释的文章：*[What AnyCPU Real Means As Of .NET 4.5 and Visual Studio 11](http://web.archive.org/web/20131121072002/http://blogs.microsoft.co.il/sasha/2012/04/04/what-anycpu-really-means-as-of-net-45-and-visual-studio-11/)*

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2009-02-05T16:48:02.833

“Any CPU”是指当程序启动时，.NET Framework 会根据操作系统的位数来确定是以 32 位还是 64 位运行您的程序。

*x86*和*Any CPU*之间存在区别：在 x64 系统上，为 X86 编译的可执行文件将作为 32 位可执行文件运行。

就您的怀疑而言，只需转到 Visual Studio 2008 命令行并运行以下命令。

```
dumpbin YourProgram.exe /headers 
```

它将告诉您程序的位数，以及更多信息。

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2009-02-05T17:16:11.280

任何 CPU 意味着它可以在任何平台上工作。这是因为托管代码类似于 Java。将其视为被编译为 .NET Framework 在运行时解释的字节码。

C++ 没有此选项，因为它被编译为特定于平台的机器代码。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-07-07T05:55:55.420

我建议阅读[这篇文章](http://blogs.microsoft.co.il/sasha/2012/04/04/what-anycpu-really-means-as-of-net-45-and-visual-studio-11/)。

使用*AnyCPU*时，语义如下：

> *   如果进程在 32 位 Windows 系统上运行，则它作为 32 位进程运行。[CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)被编译成 x86 机器码。
> *   如果进程在 64 位 Windows 系统上运行，则它作为 32 位进程运行。CIL 被编译成 x86 机器码。
> *   如果进程在 ARM Windows 系统上运行，它将作为 32 位进程运行。CIL 被编译为 ARM 机器代码。

# visual-studio - 除了 Addins 文件夹，VS 插件在哪里（以及如何）部署？

> ID：516746
> 
> 赞同：0
> 
> 时间：2009-02-05T16:48:15.313
> 
> 标签：visual-studio, deployment, add-in, extensibility

我试图弄清楚如何将 Visual Studio 加载项部署到它自己的文件夹，而不是使用 Addins 文件夹。我知道这是可能的——像 ReSharper 这样的工具可以做到——但我找不到任何关于如何告诉 VS 加载项所在位置的信息。有人可以向我解释它是如何完成的吗？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T02:19:49.187

Carlos Quintero 有你的答案 - [http://www.mztools.com/Articles/2008/MZ2008001.aspx](http://www.mztools.com/Articles/2008/MZ2008001.aspx) - 没有惊喜......

# javascript - 使用 jQuery 对记录进行分页

> ID：516754
> 
> 赞同：1
> 
> 时间：2009-02-05T16:49:14.360
> 
> 标签：javascript, jquery, ajax, json, paging

我有一个包含大量记录的 JSON 结果。我想显示第一个，但有一个下一步按钮可以查看第二个，依此类推。我不希望页面刷新，这就是为什么我希望 JavaScript、jQuery 甚至第三方 AJAX 库的组合可以提供帮助。

有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T17:36:48.023

希望这可以帮助：

```
var noName = {
    data: null
    ,currentIndex : 0
    ,init: function(data) {
        this.data = data;
        this.show(this.data.length - 1); // show last
    }
    ,show: function(index) {
        var jsonObj = this.data[index];
        if(!jsonObj) {
            alert("No more data");
            return;
        }
        this.currentIndex = index;
        var title = jsonObj.title;
        var text = jsonObj.text;
        var next = $("<a>").attr("href","#").click(this.nextHandler).text("next");
        var previous = $("<a>").attr("href","#").click(this.previousHandler).text("previous");

        $("body").html("<h2>"+title+"</h2><p>"+text+"</p>");
        $("body").append(previous);
        $("body").append(document.createTextNode(" "));
        $("body").append(next);
    }
    ,nextHandler: function() {
        noName.show(noName.currentIndex + 1);
    }
    ,previousHandler: function() {
        noName.show(noName.currentIndex - 1);
    }
};

window.onload = function() {
    var data = [
        {"title": "Hello there", "text": "Some text"},
        {"title": "Another title", "text": "Other"}
    ];
    noName.init(data);
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T16:57:40.023

我使用 jqgrid 就是为了这个目的。奇迹般有效。

[http://www.trirand.com/blog/](http://www.trirand.com/blog/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T17:29:03.360

我会亲自将 json 数据加载到全局变量中并以这种方式分页。希望您不要介意我对调查数据背景的假设，我想我记得昨天的您。

```
var surveyData = "[{prop1: 'value', prop2:'value'},{prop1: 'value', prop2:'value'}]"
$.curPage = 0;

$.fn.loadQuestion = function(question) {
    return this.each(function() {
        $(this).empty().append(question.prop1);
        // other appends for other question elements
    });
}

$(document).ready(function() {
    $.questions = JSON.parse(surveyData);  // from the json2 library json.org
    $('.questionDiv').loadQuestion($.questions[0]);     

    $('.nextButton').click(funciton(e) {
        if ($.questions.length >= $.curPage+1)
            $('.questionDiv').loadQuestion($.questions[$.curPage++]);
        else
            $('.questionDiv').empty().append('Finished');
    });
}); 
```

~ 未经测试

我不得不承认@sktrdie 创建一个完整的插件来处理调查的方法会很好。IMO 这种方法确实是一种阻力最小的解决方案。

# c++ - 使用 CreateFile 打开一个套接字

> ID：516763
> 
> 赞同：1
> 
> 时间：2009-02-05T16:50:35.513
> 
> 标签：c++, winapi, sockets, serial-port, createfile

我们有一些旧的串行代码，只需打开然后关闭它即可检查串行端口是否可用。现在我们正在向应用程序添加网络支持，我想通过提供 ip 地址作为字符串来重用该功能。

```
/**
 * So far I have tried:
 * A passed in portPath normally looks like:
\\?\acpi#pnp0501#1#1#{GUID}          
10.2.0.155:2001
//10.2.0.155:2001/
\\.\10.2.0.155:2001\
\\?\10.2.0.155:2001\
 * all without success.
 */
    bool PortIsAvailable( const CString& portPath )
    {
        HANDLE hCom = ::CreateFile( portPath,
                                   GENERIC_READ | GENERIC_WRITE,
                                   0,                    // comm devices must be opened with exclusive-access
                                   NULL,                 // no security attributes
                                   OPEN_EXISTING,        // comm devices must use OPEN_EXISTING
                                   FILE_FLAG_OVERLAPPED, // not overlapped I/O
                                   NULL );                // hTemplate must be NULL for comm devices
        if (INVALID_HANDLE_VALUE != hCom ) 
        {
            ::CloseHandle( hCom );
            return true;
        }
        return false;
    } 
```

我知道我可以先使用 connect 然后关闭，但我想以最少的更改重用该功能。如果我能重用这个功能就更好了。如果不是，那么我将不得不编写代码来确定它是否是套接字。

**我想知道通过 CreateFile 打开套接字的正确方法是什么？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T19:39:45.297

您不能通过 CreateFile 创建套接字。为此，您应该使用 Windows[套接字 API 。](http://msdn.microsoft.com/en-us/library/ms741394(VS.85).aspx)要创建 SOCKET 句柄，您可以使用[WSASocket](http://msdn.microsoft.com/en-us/library/ms742212(VS.85).aspx)。请注意，此函数返回的 SOCKET 可以用作带有某些[Windows 函数的 Windows 句柄，例如 ReadFile 和 WriteFile](http://msdn.microsoft.com/en-us/library/ms740522(VS.85).aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T19:13:43.960

我不相信您可以使用`CreateFile()`. 套接字是从 BSD (iirc) 导入的抽象，并以名称兼容的方式实现（最初是 via `winsock.h`，现在是`winsock2.h`）。我认为 MS 从未将套接字支持添加到`CreateFile()`.

更多理由：大多数（一切？）`CreateFile()`操作返回本机 Windows 句柄。因为套接字是一种非本地抽象，它们在操作系统中没有本地句柄，所以`CreateFile()`处理它们没有意义。

# sharepoint - SharePoint 2007 导航并消除其延迟

> ID：516764
> 
> 赞同：0
> 
> 时间：2009-02-05T16:50:37.587
> 
> 标签：sharepoint, sharepoint-2007

在 SharePoint 2007 中，有一个用户可以将鼠标悬停在顶部的导航，它会显示子项的下拉菜单。当他们从下拉列表中移除鼠标时，它会消失，但只是在短暂的延迟之后。这可能会导致问题，就好像人们试图单击页面上某处的链接，但导航菜单尚未隐藏，他们会不小心点击它。再加上最初出现的菜单也被延迟了，所以在他们将鼠标悬停在他们*实际*想要点击的页面上的链接之前，菜单会突然出现并拦截他们不想要点击的点击的意思。

我在一些可疑区域戳了 core.js，但似乎无法确定。有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T16:55:43.333

这是 SharePoint 的正常行为。该控件是 ASP.Net 2.0 的 asp:Menu 控件，您唯一能做的就是自定义站点的 MasterPage 或 DefaultPage。

如果您更改“layouts”文件夹的 core.js 文件，您将失去 Microsoft 支持，因此请注意更改此文件夹中的任何文件。

建议你修改已有的控件或者新建一个，放到MasterPage的这个位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-19T14:58:26.610

这一点 CSS 将修复它。我刚刚在 sharepoint 2010 中遇到了同样的事情，这就是让列表在您滚出后立即消失所需的全部内容：

```
li.hover-off>ul 
{
    display:none;
} 
```

它的工作方式是，当您将鼠标悬停在导航中的某个项目上时，它会添加一个名为“悬停”的 CSS 类，一旦您的鼠标离开该区域，它就会将该类更改为“悬停”1 秒钟，然后将其完全移除。此 CSS 将直接隐藏具有“悬停”类的列表项下方的无序列表，从而在鼠标离开父项时立即隐藏弹出窗口。

# java - 将“this”与方法一起使用（在 Java 中）

> ID：516768
> 
> 赞同：18
> 
> 时间：2009-02-05T16:51:42.517
> 
> 标签：java, methods, this

在 Java 中将“this”与方法一起使用怎么样？它是可选的还是在某些情况下需要强制使用？

我遇到的唯一情况是在类中调用方法中的方法。但它是可选的。这是一个愚蠢的例子，只是为了说明我的意思：

```
public class Test {

    String s;

    private String hey() {
        return s;
    }

    public String getS(){
        String sm = this.hey();
        // here I could just write hey(); without this
        return sm;
    }
} 
```

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-05T16:55:34.910

您需要它的三种明显情况：

*   在与构造函数的第一部分相同的类中调用另一个构造函数
*   区分局部变量和实例变量（无论是在构造函数中还是在任何其他方法中）
*   将对当前对象的引用传递给另一个方法

这是所有三个的示例：

```
public class Test
{
    int x;

    public Test(int x)
    {
        this.x = x;
    }

    public Test()
    {
        this(10);
    }

    public void foo()
    {
        Helper.doSomethingWith(this);
    }

    public void setX(int x)
    {
        this.x = x;
    }
} 
```

我相信在你需要的地方也有一些使用内部类的奇怪情况，`super.this.x`但应该避免它们非常晦涩，IMO :)

编辑：我想不出任何示例，为什么您希望将其用于直接的`this.foo()`方法调用。

编辑： saua 就晦涩的内部类示例做出了贡献：

> 我认为晦涩的情况是：`OuterClass.this.foo()`当从也有方法`foo()`的内部类中的代码访问外部类时。`foo()`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T16:54:21.060

我使用“this”来澄清代码，通常作为我正在调用实例方法而不是访问类级别方法或字段的提示。

但不是。除非由于范围命名冲突而需要消除歧义，否则您实际上并不需要“this”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T17:04:20.463

对于大多数通用编程，`this`关键字是可选的，通常用于避免混淆。但是，有几个地方需要它。

```
class Foo {
    int val;

    public Foo(int val) {
         this(val, 0);  //this MUST be here to refer to another constructor
    }

    public Foo(int val, int another) {
        val = val;       //this will work, but it generally not recommended.
        this.val = val;  //both are the same, but this is more useful.
        method1();       //in a Foo instance, it will refer to this.method1()
        this.method1();  //but in a Foo2 instance, you must use this to do the same
    }

    public void method1() {}
}

class Foo2 extends Foo {
    public Foo2(int val) {
        this(val);        //this will refer to the other Foo2 constructor
    }
    public Foo2(int val, int another) {
        super(val, another);
        super.method1();   //this will refer to Foo.method1()
    }

    @Override
    public void method1() {}//overridden method
} 
```

这些不是所有情况，而是一些更普遍的情况。我希望这可以帮助您更好地理解`this`和`super`关键字以及如何/何时使用它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T16:54:56.050

唯一真正需要的情况是当您有一个与成员变量同名的方法的参数时。就个人而言，我尝试始终使用它来明确变量/方法的范围。例如，您可以有一个静态方法或一个实例方法。阅读代码时，知道哪个是哪个会很有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:26:49.950

The only reason to prepend `this` in front of a method invocation is to indicate that you're calling a non-static method. I can't think of any other valid reason to do this (correct me I'm wrong). I don't recommend this convention as it doesn't add much value. If not applied consistently then it could be misleading (as a this-less method invocation could still be a non-static method). How often does one care if the method being invoked is static or not? Furthermore, most IDEs will highlight static methods differently.

I have heard of conventions where `this` indicates calling the subclass's method while an absence of `this` is calling the super class's method. But this is just silly as the convention could be the other way around.

**Edit**: As mmyers points out (see comment), `this` works with static methods. With that, I see absolutely no reason to prepend with `this` as it doesn't make any difference.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T20:01:16.420

[http://java.sun.com/j2se/1.5.0/docs/api/java/lang/StringBuilder.html](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/StringBuilder.html)

如果您的方法需要返回对象的实例，您绝对需要这个。

```
public class StringBuildable {
    public StringBuildable append(String text) {
        // Code to insert the string -- previously this.internalAppend(text);
        return this;
    }
} 
```

这允许您以以下方式将方法链接在一起：

```
String string = new StringBuildable()
    .append("hello")
    .append(' ')
    .append.("World")
    .toString()
; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T18:47:12.580

不是答案（所以请随意投反对票），但我无法将其放入有人询问的评论中。

很多人使用“this.x”来直观地区分实例变量与局部变量和参数。

所以他们会这样做：

```
private int sum;
public int storeSquare (int b) {
    int c=b*b;
    this.sum+=c; // Makes sum "pop" I guess
    return c;
} 
```

我个人认为这是一个坏习惯：任何可用的编辑器都会可靠地将实例和局部变量设置为不同的颜色——它不需要任何人为错误的模式。

用“这个”来做。只有 50% 的安全。如果您尝试在 x 是局部变量时放置 this.x，则编译器肯定会捕获它，但是没有什么可以阻止您“忘记”用 this 标记实例变量，并且如果您忘记标记只有一个（或者如果其他人在您的代码上工作）并且您依赖于该模式，那么该模式可能弊大于利

就我个人而言，我相当确定这种模式源于程序员（正当）对以下事实感到不适：

```
public void setMe(int me) {
    this.me=me;
} 
```

你需要“这个”的事实。在我面前是由参数的名称决定的——我同意它只是感觉草率。你想要保持一致——如果你需要的话。在我面前有，为什么不经常使用呢？

虽然我理解这种不适，但打字。使用实例变量的每一个地方都是迂腐的、毫无意义的、丑陋的和不可靠的。如果它真的困扰您并且您绝对*需要*使用模式来解决它，请尝试将“p”放在参数前面的习惯。作为副作用，它甚至应该使其更加恒定，因为参数 case 现在将匹配方法 case..

```
public void setMe( int pMe) 
```

# version-control - 在 TFS 中搁置和签入有什么区别？

> ID：516770
> 
> 赞同：34
> 
> 时间：2009-02-05T16:52:03.373
> 
> 标签：version-control, tfs, shelve, checkin

各自的概念是什么？

什么时候可以搁置更改而不是签入？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-05T16:56:59.773

搁置意味着更改被搁置以供*您*以后处理。

签入意味着更改可供团队的其他成员使用，将在构建中并最终发布。

非常不一样。将搁置视为您未完成任务时进行上下文切换的工具。签到意味着您已经完成（至少完成了一部分）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-05T17:00:49.813

当您想要保存所做的更改时搁置您的更改，但需要返回到以前的版本以进行您想要部署的其他更改（可能是错误修复），而不需要您当前正在处理的更新。由于您通常会定期检查，因此我发现这种情况很少发生 - 就像我刚刚部署到 QA 框并立即发现错误一样。我将搁置当天的更改，使我回到 QA 部署的版本，进行更新，然后取消搁置我的更改——根据需要合并两者。再长一点，您可能会希望查看以前的版本和分支。不过，我很高兴听到搁置被证明更有用的其他经验。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-05T17:08:49.050

其他用户可以通过搜索下载您的搁置集，因此这是传递代码以进行评论的好方法。但是，如果您尝试取消搁置已签出的代码文件，则会收到错误消息，因此您需要准备好干净的环境。

如果我正在处理我无法签入的大事，我经常在一天结束时搁置我的更改。这样，如果我的电脑在一夜之间死机，我就可以在服务器上进行备份。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T17:03:44.770

达西明白了。您还可以将搁置视为大部分不公开可见的私有分支。Shelvesets 也可以完全删除，不像删除签入的代码。如果你删除一个搁置集，它就永远消失了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-01-17T14:53:29.860

上面的每个人都说了这么多，我从中学到了分配。

Just to add my experience, correct me if I am wrong. In a project, we have a configuration file **mypc.json** specific to each PC of the developer. We usually override it when running server locally. Other team members have the same file name with different configurations in it. No one wants their file to be pushed with the same name to the development branch. So I use shelve to save these type of changes. Whenever I need these configurations I can easily apply changes from shelve and my environment configurations are back in my project.

# java - 如何在 Spring 配置文件中为 bean 的属性分配枚举值？

> ID：516771
> 
> 赞同：113
> 
> 时间：2009-02-05T16:52:29.283
> 
> 标签：java, spring

我定义了一个独立的枚举类型，如下所示：

```
package my.pkg.types;

public enum MyEnumType {
    TYPE1,
    TYPE2
} 
```

现在，我想将该类型的值注入到 bean 属性中：

```
<bean name="someName" class="my.pkg.classes">
   <property name="type" value="my.pkg.types.MyEnumType.TYPE1" />
</bean> 
```

...那没有用:(

我应该如何将枚举注入 spring bean？

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2009-02-05T17:18:47.843

你试过“TYPE1”吗？我想Spring无论如何都使用反射来确定“类型”的类型，因此完全限定名称是多余的。Spring 通常不订阅冗余！

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2010-01-28T20:35:04.733

使用 value 子元素而不是 value 属性并指定 Enum 类名：

```
<property name="residence">
    <value type="SocialSecurity$Residence">ALIEN</value>
</property> 
```

这种方法优于仅仅编写的优点`value="ALIEN"`是，如果 Spring 不能从属性中推断出枚举的实际类型（例如，属性的声明类型是接口），它也可以工作。[*改编自 araqnid 的评论。*]

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2012-07-11T23:27:31.503

我知道这是一个非常古老的问题，但如果有人正在寻找更新的方法来做到这一点，请使用 spring util 命名空间：

```
<util:constant static-field="my.pkg.types.MyEnumType.TYPE1" /> 
```

如[弹簧文档](http://static.springsource.org/spring/docs/3.0.x/reference/xsd-config.html)中所述。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-02-05T17:22:16.150

你可以只做“TYPE1”。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-07-04T12:48:39.790

这就是为我做的 MessageDeliveryMode 是 bean 将具有值 PERSISTENT 的枚举：

```
<bean class="org.springframework.amqp.core.MessageDeliveryMode" factory-method="valueOf">
    <constructor-arg value="PERSISTENT" />
</bean> 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-06-17T08:36:10.140

使用 SPEL 和 P-NAMESPACE：

```
<beans...
xmlns:p="http://www.springframework.org/schema/p" ...>
..
<bean name="someName" class="my.pkg.classes"
    p:type="#{T(my.pkg.types.MyEnumType).TYPE1}"/> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-02-03T11:33:13.717

具体而言，将值设置为枚举类型的常量的名称，例如，在您的情况下为“TYPE1”或“TYPE2”，如下所示。它会起作用：

```
<bean name="someName" class="my.pkg.classes">
   <property name="type" value="TYPE1" />
</bean> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T23:50:15.993

如果您想添加更多价值并写入自定义类型，您可以编写 Bean 编辑器（详细信息在 Spring 文档中）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-08-20T04:48:21.210

Spring 集成示例，基于 Enum 字段的路由：

```
public class BookOrder {

    public enum OrderType { DELIVERY, PICKUP } //enum
    public BookOrder(..., OrderType orderType) //orderType
    ... 
```

配置：

```
<router expression="payload.orderType" input-channel="processOrder">
    <mapping value="DELIVERY" channel="delivery"/>
    <mapping value="PICKUP" channel="pickup"/>
</router> 
```

# gzip - #ZipLib 解压 GZip 时出错

> ID：516774
> 
> 赞同：0
> 
> 时间：2009-02-05T16:52:44.137
> 
> 标签：gzip, sharpziplib, compression

尝试使用#ZipLib 0.85.5 解压缩一些 GZ 文件时出现此错误

这些文件没有损坏，我可以使用 7-Zip 正确解压缩。

ICSharpCode.SharpZipLib.SharpZipBaseException 意外的 EOF

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-06T15:55:27.600

您可以尝试不同的托管库吗？我对sharpziplib了解不多，但你为什么不直接使用内置的[System.IO.Compression.GZipStream](http://msdn.microsoft.com/en-us/library/system.io.compression.gzipstream.aspx)来解压 .gz 数据呢？

# vb.net - 为什么 Me.components 什么都没有？

> ID：516776
> 
> 赞同：0
> 
> 时间：2009-02-05T16:53:09.253
> 
> 标签：vb.net, winforms, custom-controls

我编写了一个自定义 ErrorProvider，它为现有的 ErrorProvider 添加了一些功能（设置控件 BackColor、ErrorCount 等）。这是有效的发现，但现在由于某种原因它落在了构造函数上：

```
_LoginErrorProvider = New ErrorLogErrorProvider(Me.components) 
```

该错误是一个 NullReferenceException，它是由 Me.components 是 Nothing 的事实引起的。谁能解释为什么表单的组件集合什么都不是？该表格似乎以其他方式工作正常！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T17:08:33.137

您还可以将 ErrorLogErrorProvider 类放到 Form / UserControl 的设计图面上，为 InitializeComponent 生成的代码将正确初始化组件成员并将其传递给错误提供程序的构造函数（VS 对所有非可视组件执行此操作）。只需确保您的 ErrorLogErrorProvider 类派生自 Component 或实现 IComponent 接口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T17:04:52.567

当您将组件添加到设计图面时，它会将其添加到 InitializeComponent 函数中

```
me.components = new System.ComponentModel.Container() 
```

所以只需将其添加到您的自我中即可。

或者你的

```
_LoginErrorProvider = New ErrorLogErrorProvider(Me.components) 
```

在 InitializeComponent 之前被调用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T17:04:10.477

解决了它，在表单中添加另一个组件似乎可以解决问题，它有点杂乱但有效。我想理想的解决方案是将我的 ErrorProvider 添加到 me.components 但为了做到这一点，你需要初始化一个你不能初始化的新实例，因为 Me.components 什么都没有！

它可以让一个人发疯......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-10-13T11:01:10.873

解决了！

使用下面的代码来解决它！

```
Public Sub New()

    ' This call is required by the designer.
    InitializeComponent()

    ' Add any initialization after the InitializeComponent() call.

End Sub 
```

# c++ - 从 QGLPixelBuffer 获取深度缓冲区

> ID：516778
> 
> 赞同：0
> 
> 时间：2009-02-05T16:53:49.140
> 
> 标签：c++, qt, opengl

我在 QT 应用程序中使用 OpenGL。在某些时候，我正在渲染到 QGLPixelBuffer。我需要获取图像的深度缓冲区，我通常使用 glReadPixels(..., GL_DEPTH_COMPONENT, ...); 我尝试将 QGLPixelBuffer 设为当前，然后使用 glReadPixels() 但我得到的只是一张白色图像。

这是我的代码

```
bufferCanvas->makeCurrent();
[ ...render... ]
QImage snapshot(QSize(_lastWidth, _lastHeight), QImage::Format_Indexed8);
glReadPixels(0, 0, _lastWidth, _lastHeight, GL_DEPTH_COMPONENT, GL_UNSIGNED_BYTE, snapshot.bits());
snapshot.save("depth.bmp"); 
```

有什么明显的问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-28T20:17:50.190

好吧，不能保证存储在 QImage 中的底层像素数据（并通过其 QImage::bits() 函数获得）与 OpenGL 的 glReadPixels() 函数写入的内容兼容。

由于您使用的是 QGLPixelBuffer，[QGLPixelBuffer::toImage()](http://doc.trolltech.com/4.5/qglpixelbuffer.html#toImage)有什么问题？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T23:52:17.533

接下来是疯狂的猜测。

您正在使用 QImage 创建索引位图，但是您没有分配颜色表。我的猜测是默认颜色表使您的图像显示为白色。在保存图像之前尝试此操作：

```
for ( int i = 0 ; i <= 255 ; i++ ) {
    snapshot.setColor( i, qRGB( i, i, i ) );
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T19:00:57.887

我从未直接使用过 QImage，但我会尝试回答或研究以下领域：

1.  你在读取图像之前用深度位调用 glClear() 吗？
2.  您的 QGLFormat 是否启用了深度缓冲区？
3.  可以直接dump readPixel 并验证它是否有正确的数据吗？
4.  QImage::bits() 是否确保具有所需对齐的顺序内存存储？

希望这可以帮助

# c# - 获取当前 GMT 时间

> ID：516788
> 
> 赞同：47
> 
> 时间：2009-02-05T16:55:30.463
> 
> 标签：c#, .net, timezone, utc, ntp

C# 中是否有返回 UTC (GMT) 时区的方法？不是基于系统的时间。

基本上，即使我的系统时间不正确，我也想获得正确的 UTC 时间。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2012-03-12T15:30:46.860

而不是打电话

```
DateTime.Now.ToUniversalTime() 
```

你可以打电话

```
DateTime.UtcNow 
```

相同但更短:) 文档[在这里](http://msdn.microsoft.com/en-us/library/system.datetime.utcnow.aspx)。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-05T16:59:57.803

不是基于系统的时间？您需要拨打网络时间服务或类似的电话。你可以写一个[NTP](http://www.ntp.org/)客户端，或者只是截屏[世界时钟](http://www.timeanddate.com/worldclock/)；）

我不相信 .NET 有内置的 NTP 客户端，但有[很多可用](http://www.google.com/search?q=c%23+ntp+client)的 .NET 客户端。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-01-20T12:15:36.127

我从 UNITY 使用这个

```
//Get a NTP time from NIST
//do not request a nist date more than once every 4 seconds, or the connection will be refused.
//more servers at tf.nist.goc/tf-cgi/servers.cgi
public static DateTime GetDummyDate()
{
    return new DateTime(1000, 1, 1); //to check if we have an online date or not.
}
public static DateTime GetNISTDate()
{
    Random ran = new Random(DateTime.Now.Millisecond);
    DateTime date = GetDummyDate();
    string serverResponse = string.Empty;

    // Represents the list of NIST servers
    string[] servers = new string[] {
        "nist1-ny.ustiming.org",
        "time-a.nist.gov",
        "nist1-chi.ustiming.org",
        "time.nist.gov",
        "ntp-nist.ldsbc.edu",
        "nist1-la.ustiming.org"                         
    };

    // Try each server in random order to avoid blocked requests due to too frequent request
    for (int i = 0; i < 5; i++)
    {
        try
        {
            // Open a StreamReader to a random time server
            StreamReader reader = new StreamReader(new System.Net.Sockets.TcpClient(servers[ran.Next(0, servers.Length)], 13).GetStream());
            serverResponse = reader.ReadToEnd();
            reader.Close();

            // Check to see that the signature is there
            if (serverResponse.Length > 47 && serverResponse.Substring(38, 9).Equals("UTC(NIST)"))
            {
                // Parse the date
                int jd = int.Parse(serverResponse.Substring(1, 5));
                int yr = int.Parse(serverResponse.Substring(7, 2));
                int mo = int.Parse(serverResponse.Substring(10, 2));
                int dy = int.Parse(serverResponse.Substring(13, 2));
                int hr = int.Parse(serverResponse.Substring(16, 2));
                int mm = int.Parse(serverResponse.Substring(19, 2));
                int sc = int.Parse(serverResponse.Substring(22, 2));

                if (jd > 51544)
                    yr += 2000;
                else
                    yr += 1999;

                date = new DateTime(yr, mo, dy, hr, mm, sc);

                // Exit the loop
                break;
            }
        }
        catch (Exception ex)
        {
            /* Do Nothing...try the next server */
        }
    }
return date;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T17:00:08.443

如果我要猜测如何获得有保证的准确时间，您必须找到/编写一些 NNTP 类来获取时间服务器的时间。

如果您在 google 上搜索[C# NTP](http://www.google.com/search?q=C%23+ntp)，您可以找到一些[实现](http://dotnet-snippets.com/dns/simple-network-time-ntp-protocol-client-SID571.aspx)，否则请检查[NTP](http://en.wikipedia.org/wiki/Network_Time_Protocol)协议。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-05T17:01:31.637

如果您的系统时间不正确，那么您从 DateTime 类中得到的任何东西都无济于事。但是，您的系统可以将时间与时间服务器同步，因此，如果启用该功能，则各种 DateTime UTC 方法/属性将返回正确的 UTC 时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-11-18T08:18:54.300

您可以简单地硬编码一个基础 DateTime 并计算给定 DateTime 与该基础之间的差异，以确定所需的精确 DateTime，如下代码所示：

```
 string format = "ddd dd MMM yyyy HH:mm:ss";     
    string utcBaseStr = "Wed 18 Nov 2020 07:31:34";
    string newyorkBaseStr = "Wed 18 Nov 2020 02:31:34";     
    string nowNewyorkStr = "Wed 18 Nov 2020 03:06:47";

    DateTime newyorkBase = DateTime.ParseExact(newyorkBaseStr, format, CultureInfo.InvariantCulture);
    DateTime utcBase = DateTime.ParseExact(utcBaseStr, format, CultureInfo.InvariantCulture);
    DateTime now = DateTime.ParseExact(nowNewyorkStr, format, CultureInfo.InvariantCulture);

    var diffMiliseconds = (now - newyorkBase).TotalMilliseconds;
    DateTime nowUtc = utcBase.AddMilliseconds(diffMiliseconds);

    Console.WriteLine("Newyork Base = " + newyorkBase);     
    Console.WriteLine("UTC Base = " + utcBase);
    Console.WriteLine("Newyork Now = " + now);      
    Console.WriteLine("Newyork UTC = " + nowUtc); 
```

上述代码的输出如下：

```
Newyork Base = 11/18/2020 2:31:34 AM
UTC Base = 11/18/2020 7:31:34 AM
Newyork Now = 11/18/2020 3:06:47 AM
Newyork UTC = 11/18/2020 8:06:47 AM 
```

# php - Facebook-WordPress 评论/反馈集成

> ID：516789
> 
> 赞同：8
> 
> 时间：2009-02-05T16:55:32.867
> 
> 标签：php, wordpress, facebook

目前，我的 Facebook 个人资料会自动从 WordPress 实例重新发布博客文章。

但是，我希望能够将发布到 Facebook 博客的评论也显示在适当位置的另一个博客上。

有没有办法用 Facebook API 做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T11:09:44.730

有一堆支持 facebook-connect 的 WordPress 插件可以帮助您实现这一目标。这是一对：

*   [社交 Facebook 连接](http://www.sociable.es/facebook-connect/)
*   [WP-Facebook-连接](http://wordpress.org/extend/plugins/wp-facebookconnect/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T19:09:18.087

yoavf 答案很好。Facebook 的 wiki 中维护了包含这些插件的列表： [http ://wiki.developers.facebook.com/index.php/Facebook_Connect_Plugin_Directory](http://wiki.developers.facebook.com/index.php/Facebook_Connect_Plugin_Directory)

[http://dentedreality.com.au/2008/12/implementing-facebook-connect-on-wordpress-in-reality](http://dentedreality.com.au/2008/12/implementing-facebook-connect-on-wordpress-in-reality)有一种不在该列表中的新颖方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T01:43:01.350

您需要转到博客的来源，弄清楚评论表单是如何发布的（POST 或 GET），然后您可以[在此处使用模拟 ajax 文档](http://wiki.developers.facebook.com/index.php/Mock_ajax)。然后在 facebook 应用程序中，您构建一个类似于博客评论的表单。确保各个表单元素的所有 id 都是相同的。然后在您的提交按钮上，您有一个这样的链接。

```
<a  clickrewriteid="dummy" clickrewriteform="comment_form" 
clickrewriteurl="blog_form_action">Submit</a> 
```

所以*dummy*是将接收任何输出的元素的 id。
*comment_form*是将发布到博客评论处理器的表单的 ID。
*blog_form_action*是您的博客表单操作属性中的 url。

如果一切正常，*comment_form*表单将发布到您的博客处理器页面，以便从 facebook 提交的评论也将出现在博客上。

如果博客使用 GET 作为其方法，您只需确保*blog_form_action*包含查询字符串

希望有帮助！

# c# - 如何从 C# 代码运行 sp？

> ID：516794
> 
> 赞同：0
> 
> 时间：2009-02-05T16:56:11.477
> 
> 标签：c#, ado.net, odbc

我是 ADO.net 的新手。我实际上创建了一个示例数据库和一个示例存储过程。我对这个概念很陌生。我不确定如何从 C# windows 应用程序连接到数据库。请指导我一些帮助或样本来做同样的事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T17:00:08.987

听起来您正在寻找有关 ADO.NET 的教程。

[这是一个关于直接 ADO.NET 的内容。](http://www.csharp-station.com/Tutorials/AdoDotNet/Lesson01.aspx)
[这是关于 LINQ to SQL 的另一篇文章。](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T17:00:33.730

像这样的东西......（假设你将传递一个 Person 对象）

```
public int Insert(Person person)
{
SqlConnection conn = new SqlConnection(connStr);
conn.Open();
SqlCommand dCmd = new SqlCommand("InsertData", conn);
dCmd.CommandType = CommandType.StoredProcedure;
try
{
dCmd.Parameters.AddWithValue("@firstName", person.FirstName);
dCmd.Parameters.AddWithValue("@lastName", person.LastName);
dCmd.Parameters.AddWithValue("@age", person.Age);
return dCmd.ExecuteNonQuery();
}
catch
{
throw;
}
finally
{
dCmd.Dispose();
conn.Close();
conn.Dispose();
}
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T17:00:51.593

这是通常的模式（对于不同的数据库可能会有点不同，Sql Server 不要求您在命令文本中指定参数，但 Oracle 会，并且在 Oracle 中，参数以 : 为前缀而不是 @）

```
using(var command = yourConnection.CreateCommand())
{
   command.CommandText = "YOUR_SP_CALL(@PAR1, @PAR2)";
   command.CommandType = CommandType.StoredProcedure;
   command.Parameters.Add(new OdbcParameter("@PAR1", "lol"));
   command.Parameters.Add(new OdbcParameter("@PAR2", 1337));
   command.ExecuteNonQuery();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T17:01:13.480

像这样的东西：

```
var connectionString = ConfigurationManager.ConnectionStrings["YourConnectionString"].ConnectionString;

        var conn = new SqlConnection(connectionString);

        var comm = new SqlCommand("YourStoredProc", conn) { CommandType = CommandType.StoredProcedure };

        try
        {
            conn.Open();

            // Create variables to match up with session variables
            var CloseSchoolID = Session["sessCloseSchoolID"];

            //  SqlParameter for each parameter in the stored procedure YourStoredProc
            var prmClosedDate = new SqlParameter("@prmClosedDate", closedDate);
            var prmSchoolID = new SqlParameter("@prmSchoolID", CloseSchoolID);

            // Pass the param values to YourStoredProc
            comm.Parameters.Add(prmClosedDate);
            comm.Parameters.Add(prmSchoolID);

            comm.ExecuteNonQuery();
        }

        catch (SqlException sqlex)
        {

        }

        finally
        {
            conn.Close();
        } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T17:01:27.380

这是一个很好的起点[http://support.microsoft.com/kb/310130](http://support.microsoft.com/kb/310130)

```
OdbcConnection cn;
OdbcCommand cmd;
OdbcParameter prm;
OdbcDataReader dr;

try {
    //Change the connection string to use your SQL Server.
    cn = new OdbcConnection("Driver={SQL Server};Server=servername;Database=Northwind;Trusted_Connection=Yes");

    //Use ODBC call syntax.
    cmd = new OdbcCommand("{call CustOrderHist (?)}", cn);

    prm = cmd.Parameters.Add("@CustomerID", OdbcType.Char, 5);
    prm.Value = "ALFKI";

    cn.Open();

    dr = cmd.ExecuteReader();

    //List each product.
    while (dr.Read()) 
    Console.WriteLine(dr.GetString(0));

    //Clean up.
    dr.Close();
    cn.Close();
}
catch (OdbcException o) {
    MessageBox.Show(o.Message.ToString());
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T17:01:32.667

如果使用 SQL Server：

```
SqlConnection connection = new SqlCOnnection("Data Source=yourserver;Initial Catalog=yourdb;user id=youruser;passowrd=yourpassword");
SqlCommand cmd = new SqlCommand("StoredProcName", connection);
cmd.CommandType=StoredProcedureType.Command;
connection.Open();
cmd.ExecuteNonQuery();
connection.Close(); 
```

如果不是，则将 Sql 替换为 Ole 并更改连接字符串。

# java - 混合语言源目录布局

> ID：516798
> 
> 赞同：5
> 
> 时间：2009-02-05T16:57:15.890
> 
> 标签：java, python, sql, directory

我们正在运行一个使用多种不同语言的大型项目：Java、Python、PHP、SQL 和 Perl。

到目前为止，人们一直在他们自己的私有存储库中工作，但现在我们希望将整个项目合并到一个存储库中。现在的问题是：目录结构应该如何？我们应该为每种语言设置单独的目录，还是应该按组件/项目将其分开？python/perl/java 对通用目录布局的处理能力如何？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T17:01:47.127

我的经验表明这种布局是最好的：

```
mylib/
    src/
       java/
       python/
       perl/
       .../
    bin/
       java/
       python/
       perl/
    stage/
    dist/ 
```

`src`是您的来源，并且是唯一签入的内容。

`bin`是在构建过程中发生“编译”的地方，并且没有被签入。

`stage`是您在构建期间复制内容以准备打包的地方

`dist`是您放置构建工件的地方

我将模块/组件/库放在层次结构的顶部，因为我单独构建每个模块，并使用依赖管理器根据需要组合它们。

当然，命名约定各不相同。但我发现这非常令人满意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T23:37:25.707

我认为最好的办法是确保您的各种模块不依赖于同一目录中（即按组件分开）。很多人似乎对这个想法非常害怕，但是一套好的构建脚本应该能够自动消除任何痛苦。

最终目标是使基础设施的安装变得容易，然后在环境设置好后真正轻松地在单个组件上工作。

（重要的是要注意，我来自 Perl 和 CL 世界，我们将“模块”安装到某个全局位置，例如 ~/perl 或 ~/.sbcl，而不是像 Java 人那样在每个项目中包含每个模块。你会认为这将是一个维护问题，但它最终不是一个。使用定期更新 git 存储库（或 CPAN）中每个模块的脚本，这确实是最好的方法。）

编辑：还有一件事：

项目总是有外部依赖。我的项目需要 Postgres 和正常工作的 Linux 安装。将它与版本控制中的应用程序代码捆绑在一起会很疯狂——但是在新的工作站上设置所有内容的脚本非常有帮助。

我想我想说的是，也许以一种迂回的方式，我认为你不应该区别对待你的内部模块和外部模块。

# asp.net - 如何判断用户帐户是否已使用 ASP.Net Forms 身份验证登录？

> ID：516802
> 
> 赞同：3
> 
> 时间：2009-02-05T16:58:24.437
> 
> 标签：asp.net, security, forms-authentication

我们的 SSO 登录过程针对 SQL Server 中的自定义用户存储使用表单身份验证。

我们的新安全要求之一是一次只允许一个帐户有一个活动会话。因此，任何时候用户登录时，我们都会检查登录凭据是否已经处于活动状态，并且最好防止新用户再次登录，直到另一个会话结束。或者，如果这样更容易实施，我们可以强制结束另一个会话。

有没有一种简单的方法可以使用表单身份验证来做到这一点？我们考虑了一种自定义方法，我们跟踪数据库中的每个会话，但这将是很多工作，我们可能必须修改所有应用程序以检测 session_end，我希望避免这种情况。我认为 Forms Auth 中必须有一些东西可以处理这个问题。

我见过 MembershipUser.IsOnline() 方法，这看起来很理想，但我们没有使用 Membership 提供程序。

更新：为了清楚起见，我不需要检查当前用户是否登录，我需要知道其他人是否已经使用同一个帐户登录。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T17:08:02.403

试试这个：

```
System.Web.HttpContext.Current.User.Identity.IsAuthenticated 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T17:07:48.723

如果`HttpContext.Current.User`属性不为空，则他们已登录。并且`Identity.IsAuthenticated`为真。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T17:18:00.887

如果我理解正确，您将需要根据用户 ID 存储最后一个活动状态。
Membership.IsOnline() 是通过检查持久在成员数据库中的[LastActivityDate属性来实现的。](http://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.lastactivitydate.aspx)
所以在某个地方，您需要跟踪用户活动。
您也许可以实现一个 httpmodule 来更新用户活动的时间戳。

# macos - 使用 applescript 在特定工作表上的 iWork 编号中创建新表格

> ID：516805
> 
> 赞同：4
> 
> 时间：2009-02-05T16:58:51.003
> 
> 标签：macos, applescript, iwork

我无法使用 Applescript 在特定工作表上创建新表，除非我要插入新表的工作表是新的或当前选定的。我使用的代码的一般形式是：

```
 tell application "Numbers"
    tell document 1
    tell sheet "This is the sheet I want to use"
    make new table with properties {name:"A new table"}
    end tell 
    end tell 
    end tell 
```

有没有人在实现这一目标方面取得了更大的成功？在我看来，这对于 Numbers 中的一些高级电子表格脚本来说有点问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-05-30T15:50:12.380

好的。我的第一个答案被接受了，无法删除，但还不够，所以我决定编辑它并添加一些真正解决问题的代码！

该代码来自于 Nigel Garvey 的 Yvan Koenig。两者都在[applescript-users list](http://lists.apple.com/mailman/listinfo/applescript-users)上活跃，顺便说一句，这非常好，尤其是因为这两位先生的活动，以及许多其他伟大的 AppleScripters。

它依赖于 GUI 脚本（这总是一件很可怕的事情，不得不依靠，但这是我们所拥有的）。

调用`my activateGUIscripting()`可能会提示输入管理员密码。如果您绝对**知道**您启用了 GUI 脚本（系统首选项->通用访问->为辅助设备启用访问）-那么您可以省略这一行。

接下来的两行只是示例调用，因此您需要一个名为“Sheet 1”的工作表才能使这些示例调用起作用。

这将允许您在任何文档的任何工作表中创建表格，无论选择什么或最前面。

```
--EXAMPLE CALLS
my activateGUIscripting()
my selectsheet(1, "Sheet 1")
my createNewTable(1, "Sheet 1", "myNewTable", 69, 13)

--NUMBERS UTILS
on createNewTable(dName, sName, newTable, nb_rows, nb_columns)
    tell application "Numbers" to tell document dName to tell sheet sName
        make new table with properties {name:newTable, row count:nb_rows, column count:nb_columns}
    end tell
end createNewTable

--=====
on activateGUIscripting()
    (* to be sure than GUI scripting will be active *)
    tell application "System Events"
        if not (UI elements enabled) then set (UI elements enabled) to true
    end tell
end activateGUIscripting
--=====
(*
==== Uses GUIscripting ====
 *)
on selectsheet(theDoc, theSheet)
    script myScript
        property listeObjets : {}
        local maybe, targetSheetRow
        --+++++
        -- set log_report to "point 2 : " & (current date) & return
        --+++++
        tell application "Numbers"
            activate
            set theDoc to name of document theDoc (* useful if the passed value is a number *)
            tell document theDoc to set my listeObjets to name of sheets
        end tell -- "Numbers"…

        set maybe to theSheet is in my listeObjets
        set my listeObjets to {} -- So it will not be saved in the script *)
        if not maybe then
            error "The sheet “" & theSheet & "” is unavailable in the spreadsheet “" & theDoc & "” !"
        end if -- not maybe

        set maybe to 5 > (system attribute "sys2")
        tell application "System Events" to tell application process "Numbers"
            tell outline 1 of scroll area 1 of splitter group 1 of splitter group 1 of window theDoc
                if maybe then (* macOS X 10.4.x
'(value of attributes contains 0)': '(value of attribute "AXDisclosureLevel" is 0)' sometimes works in Tiger, sometimes not.
The only possible instances of 0 amongst the attributes are the disclosure level of a sheet row and the index of the first row, which represents a sheet anyway.
Another possibility is '(value of attribute -1 is 0)', which makes me uneasy. *)
                    set targetSheetRow to first row where ((value of attributes contains 0) and (value of first static text is theSheet))
                else (* macOS X 10.5.x or higher *)
                    set targetSheetRow to first row where ((value of attribute "AXDisclosureLevel" is 0) and ((groups is {}) and (value of first static text is theSheet)) or (value of first group's first static text is theSheet))
                end if -- maybe…
                (*
Handler modified to accomodate sheets requiring a lot of time to get the focus
*)
                tell targetSheetRow to set value of attribute "AXSelected" to true
                set cnt to 0
                repeat (*
Must way that Numbers becomes ready to receive the value *)
                    try
                        tell targetSheetRow to set value of attribute "AXDisclosing" to true
                        exit repeat
                    on error
                        set cnt to cnt + 1
                        delay 0.5 -- half a second
                    end try
                end repeat
            end tell -- outline…
        end tell -- "System Events"…
        --+++++
        -- set log_report to log_report & "point 3, cnt = " & cnt & return & (current date) & return
        --+++++
        tell application "Numbers" to tell document theDoc to tell sheet theSheet to tell table 1
            with timeout of 20 * 60 seconds (*
WITH this setting, the script will be able to wait 20 minutes for the asked value.
I hope that the document will not be so huge that this delay prove to be too short. *)
                value of cell "A1"
            end timeout
        end tell -- "Numbers"…
        --+++++
        -- set log_report to log_report & "point 4 : " & (current date) & return
        --+++++
        tell application "System Events" to tell application process "Numbers" (*
Do the trick one more time to be sure that the sheet is open *)
            tell targetSheetRow to set value of attribute "AXDisclosing" to true
        end tell -- "System Events"…
        --+++++
        -- return log_report & "point 5 : " & (current date) & return
        --+++++
        (*
End of the modified piece of code
*)
    end script
    run myScript
end selectsheet 
```

# .net - 通过 clickonce 部署确保最新版本

> ID：516807
> 
> 赞同：1
> 
> 时间：2009-02-05T16:59:00.037
> 
> 标签：.net, winforms, deployment, clickonce

我如何确保所有客户端在使用 clickonce 部署时始终使用最新版本的 winforms 应用程序（来自网络的更新，假设始终连接）。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T17:01:12.463

ClickOnce 应用程序在启动时会自动尝试连接并获取最新更新（如果您打开了默认情况下的该选项）。

取自[MSDN](http://msdn.microsoft.com/en-us/library/s22azw1e(VS.80).aspx)

* * *

需要更新

有时您可能希望要求用户运行应用程序的更新版本。例如，您可能会对外部资源（如 Web 服务）进行更改，这会阻止早期版本的应用程序正常工作。在这种情况下，您可能希望将您的更新标记为需要并阻止用户运行早期版本。注意注意

尽管可以使用其他更新策略来要求更新，但检查应用程序启动之前是保证无法运行旧版本的唯一方法。当启动时检测到强制更新时，用户必须接受更新或关闭应用程序。

要将更新标记为需要，请在“应用程序更新”对话框中单击“指定此应用程序所需的最低版本”，然后指定发布版本（Major、Minor、Build、Revision），该版本指定了可以使用的应用程序的最低版本号安装。有关详细信息，请参阅应用程序更新对话框。

这与在部署清单中设置 Deployment 元素的 minimumRequiredVersion 属性相同；例如：复制代码

* * *

您应该能够指定所需的版本，并在应用程序启动之前对其进行更新。

# java - 有没有人在巴克敏斯特的真实世界经验？

> ID：516809
> 
> 赞同：6
> 
> 时间：2009-02-05T16:59:11.393
> 
> 标签：java, eclipse, build-process, build-automation, buckminster

我目前正在评估 ivy、maven 和 buckminster 以简化我们的构建过程。从概念上讲，buckminster 似乎是最先进的，但也具有相当的复杂性。

我在网上找不到这么多巴克明斯特的第一手经验，因此我向 Stackoverflow 社区提出了问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T18:11:58.330

我们在 7 月份的构建过程中采用了 buckminster。

我们的设置是使用由 CruiseControl 服务器运行的 Ant。

我们选择它是因为我们有多个项目存在于多个存储库中。我们有几个 RCP 产品使用这些项目的不同组合。

*   必须使用我们已经编写的元数据（清单文件、产品文件）*来*管理每个产品的结帐（和构建）。让构建和开发元数据不同步太容易了。
*   手动构建捆绑包和生成产品仍然不容易。
*   新的启动器需要快速启动并运行。两天以上的时间来设置开发环境是不可接受的。

总的来说，我发现它是一个非常强大的工具，但文档很差。有很多新概念，因为它是一个可以插入工具的框架，所以这些概念的一些名称可能非常抽象。

然而，巴克明斯特绝对*擅长*解决上述三个问题。

其他补充：

*   它可以引导自己，例如：它可以检查自己，给定一个最小的核心
*   它似乎正在积极开发中
*   通过邮件列表提供的支持很简洁，但通常很有帮助。
*   它具有基本的脚本语言。很简陋。

不利的一面（除了缺乏文档）：

*   它仍然不成熟 - 你会发现偶尔的错误，以及一些应该存在但不存在的功能。
*   我不知道如何使测试包工作
*   测试 OSGi 产品仍然很重要，也不容易变得无头。

总的来说，我会说它需要一段时间才能上床，但做得很好。我无法将它与 Ivy 或 Maven 相提并论，尽管 Spring 对 OSGi 的采用可能会使开发人员对 Maven 的关注度达到临界质量。

我已经回答了[一些](https://stackoverflow.com/search?q=buckminster)关于 buckminster 的问题，希望在您开始时提供帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-09-28T20:55:10.540

我们使用通过 Jenkins 运行的 buckminster 来构建一个 KNIME (eclipse) 更新站点，该站点具有托管在多个存储库中的多个插件/功能。最初的决定是因为它是如何[构建 KNIME 社区贡献](https://www.knime.com/community)的。有一个学习曲线，但一旦开始运行。我们的很多初始设置过程都基于[开发插件 - 与 Jenkins 持续集成中的说明](http://wiki.idempiere.org/en/Developing_Plug-Ins_-_Continous_Integration_with_Jenkins)

# php - 使用 If 语句上传的 PHP 文件验证

> ID：516810
> 
> 赞同：0
> 
> 时间：2009-02-05T16:59:45.337
> 
> 标签：php, mysql, validation, file-upload, if-statement

嗨，我对 php 很陌生，但我一直在关注一些教程，但它们似乎不起作用，所以我试图适应它们。我已经测试了这段代码，它可以工作到一定程度，但还有一些我无法理解的东西，php文件没有上传（很好），但细节仍然被写入数据库，尽管$ ok是spose设置为 0（不好）。如果解释这里发生的事情可能会更容易：

- 用户可以上传 gif 或 jpeg 文件。添加到数据库的详细信息。- 用户不能上传任何文件，因为将使用默认值。添加到数据库的详细信息。- 用户**不能**上传任何其他文件。数据库上不应该有任何记录，用户应该再试一次。

到目前为止我的代码：

```
<?php

//This is the directory where images will be saved
$target = "images/";
$target = $target . basename( $_FILES['photo']['name']);
$ok=0; 

//This gets all the other information from the form
$name= mysql_real_escape_string ($_POST['nameMember']);
$bandMember= mysql_real_escape_string ($_POST['bandMember']);
$pic= mysql_real_escape_string ($_FILES['photo']['name']);
$about= mysql_real_escape_string ($_POST['aboutMember']);
$bands= mysql_real_escape_string ($_POST['otherBands']);

$uploaded_size=$_FILES['photo']['file_size']; 
if ($uploaded_size > 350000)
{
echo "Your file is too large, 35Kb is the largest file you can upload.<br>";
$ok=0;
} 
if ($uploaded_type =="text/php")
{
echo "No PHP files<br>";
$ok=0;
} 

if (!($uploaded_type =="image/jpeg"))
{
echo "JPEG<br>";$ok=1;
} 

if ($uploaded_type =="image/gif")
{
echo "GIf<br>";$ok=1;
} 

if (empty($pic)){
echo "You haven't uploaded a photo, a default will be used instead.<br/>";$ok=1;}

if ($ok==0)
{
Echo "Sorry your file was not uploaded, please try again with the correct format.";
}

//If everything is ok we try to upload it
else
{ 

// Connects to your Database
mysql_connect("localhost", "*******", "******") or die(mysql_error()) ;
mysql_select_db("project") or die(mysql_error()) ;

//Writes the information to the database
mysql_query("INSERT INTO dbProfile (nameMember,bandMember,photo,aboutMember,otherBands)
VALUES ('$name', '$bandMember', '$pic', '$about', '$bands')") ;

//Writes the photo to the server
if(move_uploaded_file($_FILES['photo']['tmp_name'], $target))
{

//Tells you if its all ok
echo "The file ". basename( $_FILES['uploadedfile']['name']). " has been uploaded, and your information has been added to the directory<br/>";
print "<a class=\"blue\" href=\"createMember.php\">Add Another Record</a> | <a class=\"blue\" href=\"listMember.php\">Band Member Profiles and Affiliates Menu</a>";
}
else {

//Gives and error if its not
echo "<p>If you have uploaded a picture there may have been a problem uploading your file.</p>";
print "<a class=\"blue\" href=\"createMember.php\">Add Another Record</a> | <a class=\"blue\" href=\"listMember.php\">Band Member Profiles and Affiliates Menu</a>";
}
}
?> 
```

提前喝彩。CHL

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T17:03:45.673

错误可能是这个 if 语句：

```
 if (!($uploaded_type =="image/jpeg"))
  {
    echo "JPEG<br>";$ok=1;
  } 
```

因为每次您上传内容类型不等于“image/jpeg”的图像时，$ok 的计算结果为 1，因此所有内容都会写入数据库。

但也要注意，像这样检查 MIME 类型可能会给您带来麻烦，因为用户能够伪造文件的 MIME 类型。

例如，您可以使用 Imagick 获取正确的图像 MIME 类型。在此处查看更多详细信息：http: [//de2.php.net/manual/en/function.imagick-identifyimage.php](http://de2.php.net/manual/en/function.imagick-identifyimage.php)

编辑：刚刚注意到， $uploaded_type 不会在脚本中的任何地方初始化。正如我所说，您可以使用 $_FILES['photo']['type'] 粗略估计 MIME 类型。

# .net - 您如何在 vb.net 中解析 HTML

> ID：516811
> 
> 赞同：19
> 
> 时间：2009-02-05T16:59:56.727
> 
> 标签：.net, html, vb.net, parsing, html-content-extraction

我想知道是否有一种简单的方法可以在 vb.net 中解析 HTML。我知道 HTML 不是 XML 的严格子集，但如果可以这样对待它会很好。有什么东西可以让我在 VB.net 中以类似 XML 的方式解析 HTML 吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-04-09T03:43:26.723

'也添加 prog ref: Microsoft.mshtml

'然后在页面上：

```
Imports mshtml

Function parseMyHtml(ByVal htmlToParse$) As String
    Dim htmlDocument As IHTMLDocument2 = New HTMLDocumentClass()
    htmlDocument.write(htmlToParse)
    htmlDocument.close()

    Dim allElements As IHTMLElementCollection = htmlDocument.body.all

    Dim allInputs As IHTMLElementCollection = allElements.tags("a")
    Dim element As IHTMLElement
    For Each element In allInputs
        element.title = element.innerText
    Next

    Return htmlDocument.body.innerHTML
End Function 
```

如发现[here](http://www.codeproject.com/KB/vb/Parsing_HTML.aspx)：

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-05T17:02:07.003

我喜欢[Html Agility 包](http://html-agility-pack.net/)——它对开发人员非常友好、免费且源代码可用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-10-23T22:05:38.147

不要使用敏捷包，只需使用 mshtml 库来访问 dom，这是 ie 使用的，非常适合浏览 HTML 元素。

如果你问我，敏捷包是讨厌的和不必要的 hackie，mshtml 是要走的路。在msdn上查找。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-05T17:06:46.027

如果您的 HTML 遵循 XHTML 标准，则可以使用 System.XML 命名空间类进行大量解析和处理。

另一方面，如果您要解析的是 Web 开发人员所说的“标签汤”，那么您将需要像[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)这样的第三方解析器。

如果您试图弄清楚浏览器将如何解释您的 HTML，因为每个浏览器对标签汤的解析略有不同，这可能只是您问题的部分解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T17:02:36.660

是否形成良好？如果 HTML 实际上格式正确，则可以将其解析为 XML。如果它是标签汤并且有未封闭的元素等，我认为您将不得不四处寻找第三方解决方案。

# windows - 在运行时检查程序中是否存在函数

> ID：516813
> 
> 赞同：0
> 
> 时间：2009-02-05T17:00:08.100
> 
> 标签：windows, dynamic, mingw, symbols, getprocaddress

我正在编写一个程序，该程序旨在通过某些函数定义进行扩展。编译程序的一种方法是创建一个将您的代码链接到主代码的可执行文件。问题是：要定义的功能之一是可选的，我需要对此进行测试。

在 Linux 上，这是我正在做的事情：

使用 g++ 的“-rdynamic”选项或 ld 的“--export-dynamic”选项编译程序。然后，像这样使用 ldsym：

```
fct_type myfct = (fct_type)dlsym(RTLD_DEFAULT, "fct"); 
```

如果程序中存在函数“fct”，则返回其地址，否则返回NULL。

现在，在 Windows 上，我应该能够这样做：

```
dll_handle = GetModuleHandle(0);
fct_type myfct = (fct_type)GetProcAddress(dll_handle, "fct"); 
```

但是 MinGW32 上的 g++ 没有“-rdynamic”或“--export-dynamic”选项！所以这行不通。有人知道在 Windows 上用 MinGW32 做什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T18:06:52.240

好的，所以最后，我会回答我自己的问题......

你必须与标志链接，`-Wl,--export-all-symbols`它可以工作......

# c# - 如何在绑定的 DataGridViewComboBoxCell 中获取对底层对象的引用？

> ID：516820
> 
> 赞同：1
> 
> 时间：2009-02-05T17:00:57.833
> 
> 标签：c#, .net, vb.net, winforms, datagridview

我不知道我今天是不是脑子有问题，或者这实际上比我想象的要难。

我有一个 DataGridView，其 DataGridViewComboBoxColumn 绑定到 CustomObjects 的通用 IList。这是我如何设置列的粗略代码示例。

```
DataGridViewComboBoxColumn location = new DataGridViewComboBoxColumn() 
{
    Name = "Location",
    DataSource = new BindingSource(GetMyLocations(), null),
    DisplayMember = "Name",
    ValueMember = "ID"
}; 
```

然后当我想返回一个单元格的值时：

```
string id = (string)row.Cells["Location"].Value; 
```

但我不想要对 ID 属性的引用，我想要对实际 Location 对象的引用！我试过不指定 ValueMember，但这似乎只是使用 DisplayMember。

我可以遍历 DataSource 列中的所有 Location 对象并检查匹配的 ID 属性，但是，看起来 ComboBoxCell 应该能够直接返回它。

另外，在这种情况下我不能使用字典。

关于实现这一目标的最佳方法的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T17:16:35.647

您可以使用`IList`of `KeyValuePair`s of "Name" 和您的自定义对象。这个想法是你需要`ValueMember`指向你的对象的引用。我记得有一段时间与`ComboBox`es 有类似的问题。

像下面这样的东西应该可以解决问题（在我的脑海中并且未经测试）：

```
IList<KeyValuePair<String,MyObject>> comboData = 
    new IList<KeyValuePair<String,MyObject>>();

foreach(var o in GetMyLocations())
    comboData.Add(new KeyValuePair<String,MyObject>(o.Name, o));

DataGridViewComboBoxColumn location = new DataGridViewComboBoxColumn()
{
    Name = "Location",
    DataSource = comboData,
    DisplayMember = "Key",
    ValueMember = "Value"
}; 
```

您可能想要更改`GetMyLocations()`为返回`KeyValuePair`列表，因此您不会无缘无故地填充两个列表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-01-25T18:59:13.560

```
public class Thing
{
    public string id{  get ;  set ; }
    public string Name  {  get ;  set ; }

    //self ref
    public Thing This
    {
        get { return this; }
    }
}

form_load(){
      comboboxcell.ValueMember = "This";  // self ref
      comboboxcell.DisplayMember = "Name";
}

 datagridview1.CellValueChanged += (s, e) => {
    var cb = (DataGridViewComboBoxCell)dgv_titles.Rows[e.RowIndex].Cells[e.ColumnIndex];
   var selectedObject  = (Thing)cb.Value  ;
} 
```

那是我遇到的最简单和最干净的方式。

[http://mikehadlow.blogspot.com/2006/09/problems-with-datagridviewcomboboxcolu.html](http://mikehadlow.blogspot.com/2006/09/problems-with-datagridviewcomboboxcolu.html)

# php - 动态包含

> ID：516823
> 
> 赞同：1
> 
> 时间：2009-02-05T17:01:23.837
> 
> 标签：php, dynamic, include

什么是使用 $_GET 包含页面而不将允许的页面放入数组/使用开关等的最安全方法。我有很多页面，所以不，谢谢。

```
$content = addlashes($_GET['content']);

if (file_exists(PAGE_PATH."$content.html")) {
包括（PAGE_PATH。“$content.html”）；
}

```

那有多安全？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T17:10:09.793

如果您检查输入的有效模式，您会睡得更安全。例如，假设您知道包含的文件永远不会有子目录并且总是字母数字

```
if (preg_match('/^[a-z0-9]+$/', $_GET['page']))
{
    $file=PAGE_PATH.$_GET['page'].".html";
    if (file_exists($file))
    {
         readfile($file);
    }
} 
```

我使用了[readfile](http://uk.php.net/readfile)，好像 .html 文件只是静态的，没有必要使用包含。

您的方法可能存在的缺陷是您可以设计系统中任何 HTML 文件的路径，并将其作为 PHP 执行。如果您能找到某种方法在文件系统上获取您自己设计的 HTML 文件，您可以通过脚本执行它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T17:10:41.323

这是非常糟糕的做法。您应该设置一个控制器来处理对需要执行或检索的代码的分派，而不是尝试直接从用户提供的变量中包含它。永远不要在包含文件时信任用户输入。您没有什么可以阻止他们包含您不希望包含的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T17:09:48.220

将它与只接受“a-zA-Z-”的正则表达式匹配。

编辑：我不认为阻止特定模式是一个好主意。就像我说的那样，我宁愿做一个只接受我们知道不会导致漏洞利用的字符的正则表达式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T17:09:08.190

假设“允许”的页面集都存在于 下`PAGE_PATH`，那么我可能会建议如下内容：

*   修剪页面名称
*   拒绝以斜杠开头的页面名称（可能是绝对路径的尝试）
*   拒绝包含`..`（可能是路径遍历的尝试）的页面名称
*   显式前缀`PAGE_PATH`并包含（希望）安全路径

如果您的页面名称都遵循一些一致的规则，例如字母数字字符，那么您理论上可以使用正则表达式来验证，拒绝“坏”的页面名称。

PHP 网站上有[更多关于这些问题的讨论。](http://uk.php.net/manual/en/security.filesystem.php)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T17:27:15.003

最安全的方法是稍微清理一下请求。

1.  去掉任何`../`
2.  剥离`^\/`

从那里，确保您检查他们请求的文件是否存在并且可以读取。那么，就`include`这样吧。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T17:10:14.397

它看起来通常是安全的，因为您在显示页面之前检查页面是否确实存在。但是，您可能希望创建一个人们不应使用有效 $_SESSION 凭据查看的页面的黑名单。这可以通过数组/开关来完成，或者您可以简单地将所有特殊页面放在某个目录中，然后进行检查。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T17:10:23.133

您可以先扫描包含所有 HTML 模板的目录，然后将所有模板名称缓存在一个数组中，以便验证 GET 参数。但即使你缓存了这个数组，它仍然会产生某种开销。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T17:12:25.313

不。你永远不会预料到所有可能的攻击，你会被黑客入侵。

如果您想让您的代码不使用数组等，请使用具有两列 ID 和路径的数据库。通过数字 ID 请求页面。忽略所有对不是纯数字且不在您的有效 ID 范围内的 ID 的请求。如果您担心 SEO，您可以在链接中的数字 id 之后添加任意页面名称，就像 Stack Overflow 一样。

数据库不必是重型的。例如，您可以使用[SQLite](http://www.sqlite.org/)。

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2009-02-05T17:05:11.333

您应该至少使用类似的东西来防止 XSS 攻击。

```
$content = htmlentities($_GET['page'], ENT_QUOTES, 'UTF-8'); 
```

并且 addlashes 不会保护您免受 SQL 注入的侵害。

# c# - 如何限制 SSRS 中单个报告的下载选项？

> ID：516829
> 
> 赞同：1
> 
> 时间：2009-02-05T17:02:13.413
> 
> 标签：c#, reporting-services

[这个问题](https://stackoverflow.com/questions/352130/sql-reporting-services-restrict-export-formats)询问如何限制整个服务器。我只想为一份报告这样做。我找到了一个代码片段，但它没有提供有关如何实现的任何线索：

```
 foreach (RenderingExtension extension in this.reportViewer.LocalReport.ListRenderingExtensions()) {
if (extension.Name == "PDF") {            
((Extension)(extension.GetType().GetField("m_serverExtension", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance).GetValue(extension))).Visible = false;
} 
```

我看不到如何让报告在加载时引用此代码。有谁知道我应该如何让报告执行此代码？

编辑：顺便说一下，报告访问是通过 SSRS 报告管理器网络应用程序进行的。总的来说，我们对这个产品很满意，所以不会考虑重新发明轮子来实现一个黑客来生产什么，本质上是一个“会很好”的功能。

报告的可用呈现选项在报告级别上无法控制，这仍然有点令人难以置信。哼哼。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T11:27:06.540

顺便说一句，我发现[这个博客条目](http://mikemason.ca/blog/?p=4)对上面的代码做了一点澄清。原来我们正在谈论使用reportviewer 组件来限制导出选项。显然，这需要一个肮脏的、肮脏的 hack，而且这不是我们想要运行我们的报告功能的方式。

因此，除非有人在接下来的两周内有比这更好的主意，否则我会将其标记为答案，基本上可以总结为：

您只能在某些条件下限制这样的功能，即使这样做也绝非易事。

这似乎是 SSRS 更广泛适用性的明显失败，因为我们有需要 Excel 导出功能的用户和需要仅限于 PDF 的用户。那好吧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T09:07:44.497

有关系吗？

一旦他们下载了数据并将其带到了异地，无论如何你已经丢失了它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-10T23:18:34.877

您还没有真正描述过如何调用报告 - 您是否创建了某种应用程序？你真的在使用报表查看器控件吗？

您可以使用报告 URL 并包括 rs:Format 参数以特定格式生成报告，例如

[http://SERVER/reportserver?%2fSomeFolder%2fSomeReport&rs:Command=Render&rs:Format=PDF](http://SERVER/reportserver?%2fSomeFolder%2fSomeReport&rs:Command=Render&rs:Format=PDF)

上面的 URL 将报告生成为 PDF。您还可以使用 URL 隐藏报告工具栏等，因此您可以在应用程序中将这些 URL 创建为链接，可能一个仅使用 rs:Command=Render 作为“查看报告”链接，另一个链接包含 rs:Format= PDF 作为“导出为 PDF”链接。

有关[Reporting Services URL 访问](http://msdn.microsoft.com/en-us/library/ms153586(SQL.90).aspx)的更多信息。

# c# - 我应该为简单的控制台应用程序使用 C# 命名空间吗？

> ID：516841
> 
> 赞同：2
> 
> 时间：2009-02-05T17:06:45.183
> 
> 标签：c#, namespaces, projects-and-solutions

我是 C# 新手，对使用命名空间的最佳实践感到好奇。

我有一个包含单个类库项目以及几个小型控制台应用程序项目的解决方案。所有控制台应用程序项目所做的只是解析命令行参数并调用库项目中的不同类。库项目使用标准的 CompanyName.Tool 约定。

我的问题是，由于给定控制台应用程序的唯一目的是库项目中的一个类，并且永远不会从另一个项目或类中调用它自己，我需要将它放在命名空间中吗？似乎没有必要。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T17:08:15.757

你是对的。这是不必要的。您想要使用命名空间的唯一原因是您正在创建库以在许多程序中重用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T17:08:59.203

不，你不需要。我发现在没有命名空间的情况下保留应用程序（控制台、Web 或窗口）的入口点会更容易维护。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T17:09:43.227

如果您查看属性，该项目将具有默认命名空间。任何没有给定显式命名空间的类都将继承该命名空间。所以你不需要任何类的命名空间，除非它与项目不同。

# apache-flex - Flex 3 DataGridColumn HeaderText 本地化

> ID：516843
> 
> 赞同：1
> 
> 时间：2009-02-05T17:07:00.317
> 
> 标签：apache-flex, actionscript-3, actionscript, flex3, localization

我正在使用 Flex 3 中的 ResourceBundle 在多语言应用程序中工作。我在 DataGrid 中显示数据并像这样定义 DataGridColumn headerText

```
headerText="{localizedHeaderText('LABEL_USER_NAME')} 
```

此函数返回用户名的本地化标签，但是当我动态选择另一种语言时，会刷新但 headerText 标签？

有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T21:05:59.333

Unless you make the localizedHeaderText method bindable, the binding will never be re-evaluated since it does not know about the change event of the resourceManager.

Assuming you are in a UIComponent subclass, you'll need to do the following:

1.  override resourcesChanged and dispatch a custom event
2.  add [Bindable(event="customEvent")] above the method

Sample code:

```
override protected function resourcesChanged():void {
    super.resourcesChanged();
    dispatchEvent(new Event("localeChange"));
} 
```

and

```
[Bindable(event="localeChange")]
public function localizedHeaderText(key:String):String {
    return resourceManager.getString('resources', key);
} 
```

# c# - 首先调用链式构造函数的 1 个充分理由？

> ID：516844
> 
> 赞同：3
> 
> 时间：2009-02-05T17:07:02.483
> 
> 标签：c#

有人可以给我一个很好的理由，为什么在 C# 中总是在任何构造函数主体之前调用链式构造函数？

.NET 允许您在构造函数中的任何位置调用链式构造函数，那么为什么 C# 强制您在构造函数主体执行之前执行它呢？

我曾经写信给 Anders H 并问过他这个问题，尽管他一定很忙，但他还是很友好地花时间回复。不幸的是，他设法回答了一个我实际上并没有问过的问题（关于命名构造函数。）

所以，出于好奇，我想我会在这里问，因为我个人认为这种限制没有一个很好的理由，所以希望我能接受再教育:-)

只是为了澄清。.NET CLR 规则是必须调用 1 个构造函数，只能调用 1 个构造函数，并且只能调用一次。所以在 CLR 中这些是有效的

```
public class Meh
{
  public Meh()
  {
    Console.WriteLine("Meh()");
    this("Hello");
  }

  public Meh(string message)
  {
    Console.WriteLine("Meh {0}", message);
    base();
  }
} 
```

但不是在 C# 中

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T17:21:27.103

首先执行链式构造函数可确保所有基类元素在派生类中至少与在基类中一样可用。允许在任意点执行链式构造函数将是一种折衷，几乎没有明显的好处。

允许链式构造函数的任意入口点也排除了基类的延迟创建，因为这样的功能可能会运行链式构造函数两次。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-01T17:39:12.190

/* 因为你可以在 delphi public class BaseClass { public BaseClass(string sSql) { ExecSQL(sSql); //执行查询 } }

```
public class DerivedClass : BaseClass
{
    public DerivedClass(int i, DateTime dt)
    {
        string sSql = "";
        //construct sSql based on i, dt
        base(sSql);
        //do something else
    }
} 
```

*/

//按照下面的代码来处理基本构造器代码。public class BaseClass { public BaseClass() { //什么都不做 }

```
 public BaseClass(string sSql)
    {
        ExecSQL(sSql);
        //DO NOT do anything else
    }    

    public BaseClass(int i, DateTime dt)
    {
        //in base class ignore the parameters.
        string sWhereClause = "";
        string sSql = setSQL(sWhereClause);
        ExecSQL(sWhereClause);
        //DO NOT do anything else
    }

   protected virtual string setSQL(string value)
   {
       //set the sql
       string sSql = "";
       //add value into sSql
       return sSql;
   }

   protected virtual void ExecSQL(string sSql)
   {
       int i = 1;
       //execute query            
   }
}

public class DerivedClass: BaseClass 
{
    //public DerivedClass(string sSql):base (sSql){}
    public DerivedClass()
    {
        //do nothing
    }

    public DerivedClass(string sSql)
    {
        ExecSQL(sSql);
       //DO NOT do anything else
    }

    public DerivedClass(int i, DateTime dt)
    {
        ExecSQL(i, dt);
        //do something else after base execution
    }

   protected void ExecSQL(int i, DateTime dt) //overloaded procedure
   {
       string sWhereClause = "";
       //construct wherclause based on i, dt
       string sSql = setSQL(sWhereClause); //calls baseclass function
       base.ExecSQL(sWhereClause); //calls baseclass procedure
   }       
} 
```

DerivedClass mdD = new DerivedClass(2, DateTime.Now); BaseClass mdB = new BaseClass("sql");

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T17:14:57.693

既然您说“主观”，我想您不是在问历史原因；所以：

1.  这就是 C++ 的做法。
2.  为什么不希望构造基类？
3.  值得使语言更复杂以适应您提到的任何罕见用例作为“2。”的答案？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T17:38:06.180

所以它与基本构造函数是一致的。当您使用 : base() 引用基本构造函数时，会在构造函数之前调用它们，因此很有意义： this() 具有相同的语义。

此外，实际上并没有一个合理的用例可以让它反过来工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T14:53:21.630

如果确实有不应该提供此功能的原因，那么 CLR 或其他 .NET 语言将不支持它。我只能得出结论，答案是“因为它一直都是这样”的答案之一，并且限制可能只是从 C++ 或其他东西复制而来。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-15T15:27:08.107

当您传递基本构造函数的参数需要验证检查时，这是一个问题。这不应该在基构造函数中完成，也不能在派生类中完成。

（我在这里假设一个人不会有一个什么都不做的无参数构造函数。在我的情况下我不能有，因为要求不应该有一个。）

我看不到一个优雅的解决方案。

# javascript - JavaScript 检索信息中的问题

> ID：516849
> 
> 赞同：1
> 
> 时间：2009-02-05T17:08:19.080
> 
> 标签：javascript, html

前提：我已经开始研究 javascript 和 DOM，并且我有这个 HTML 片段：

```
<body>
    <div id="Area_T10" class="abAdArea">
        <script src="http://ad.dc2.adtech.de/addyn/3.0/831/***1644116***/0/744/ADTECH;" language="javascript1.1" type="text/javascript"></script>
        <script>
            ** -- My script  var n = **
        </script>
    </div>
</body> 
```

我想从中检索数字“16644116”，`div`但我不知道该怎么做。

你能帮我吗？

最好的祝福。

多梅尼科

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T17:18:46.640

我假设您想从脚本源 URL 中提取数字。

第一步，获取脚本源值：

```
var src = document.getElementsByTagName('script')[0].src; 
```

然后，如果您熟悉正则表达式，您应该能够创建一个模式来提取该值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T17:14:51.690

*   使用您喜欢的任何 DOM 操作技术（可能是库）从属性中提取 URL
*   使用正则表达式提取 URL 的所需部分

# java - Java：图像作为切换按钮

> ID：516850
> 
> 赞同：5
> 
> 时间：2009-02-05T17:08:27.553
> 
> 标签：java, swing

如何在 Swing 界面中创建切换图像按钮？我有两个图像，imageon.jpg 和 imageoff.jpg，我基本上想要一个可点击的元素来切换图像并触发一个事件。

更新：有没有办法覆盖图像周围通常的“chrome”？我更喜欢简单的图像，而不是里面有图像的按钮。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T17:12:30.757

加载图像`ImageIcon`。创建一个`JToggleButton`. 然后使用 应用图标`AbstractButton.setIcon/setPressedIcon/setSelectedIcon`。用 删除边框`AbstractButton.setBorderPainted(false)`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T17:09:49.920

怎么样[`JToggleButton`](http://java.sun.com/javase/6/docs/api/javax/swing/JToggleButton.html)？您可以对其进行子类化并覆盖`paint()`以根据是否选择它来绘制正确的图像。

另一种方法是子类化`JPanel`并捕获鼠标点击，覆盖`paintComponent()`以绘制正确的图像。这样，唯一被绘制的是实际图像（与`JToggleButton`选项不同）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-07-18T08:41:07.930

我对 JButtons 也有同样的问题。试试这个：

```
result = new JButton( icon );
result.setBorderPainted( false );
result.setContentAreaFilled( false );

width = icon.getIconWidth();
height = icon.getIconHeight();
result.setPreferredSize( new Dimension( width, height ) ); 
```

有必要设置首选大小以消除按钮周围的额外空间。这适用于 Windows 7 和 Mac OS X 10.6。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:09:34.200

最好的办法是继承 AbstractButton，并设置边框和背景等属性（在您的构造函数中）。

```
MyButton() {
    setBorder(null);
    setBackground(null);
    } 
```

# windows - 如何在 Linux 中使用 POSIX 方法从文件中读取 Unicode-16 字符串？

> ID：516862
> 
> 赞同：5
> 
> 时间：2009-02-05T17:09:54.897
> 
> 标签：windows, linux, unicode, posix, wchar-t

我有一个包含 UNICODE-16 字符串的文件，我想将其读入 Linux 程序。这些字符串是从 Windows 的内部 WCHAR 格式原始写入的。（Windows 是否总是使用 UTF-16？例如在日文版本中）

我相信我可以使用原始读取和使用 wcstombs_l 进行转换来读取它们。但是，我不知道要使用什么语言环境。在我最新的 Ubuntu 和 Mac OS X 机器上运行“locale -a”会产生零语言环境，其名称中包含 utf-16。

有没有更好的办法？

更新：正确答案和下面的其他人帮助我使用 libiconv。这是我用来进行转换的函数。我目前将它放在一个类中，该类将转换为一行代码。

```
// Function for converting wchar_t* to char*. (Really: UTF-16LE --> UTF-8)
// It will allocate the space needed for dest. The caller is
// responsible for freeing the memory.
static int iwcstombs_alloc(char **dest, const wchar_t *src)
{
  iconv_t cd;
  const char from[] = "UTF-16LE";
  const char to[] = "UTF-8";

  cd = iconv_open(to, from);
  if (cd == (iconv_t)-1)
  {
    printf("iconv_open(\"%s\", \"%s\") failed: %s\n",
           to, from, strerror(errno));
    return(-1);
  }

  // How much space do we need?
  // Guess that we need the same amount of space as used by src.
  // TODO: There should be a while loop around this whole process
  //       that detects insufficient memory space and reallocates
  //       more space.
  int len = sizeof(wchar_t) * (wcslen(src) + 1);

  //printf("len = %d\n", len);

  // Allocate space
  int destLen = len * sizeof(char);
  *dest = (char *)malloc(destLen);
  if (*dest == NULL)
  {
    iconv_close(cd);
    return -1;
  }

  // Convert

  size_t inBufBytesLeft = len;
  char *inBuf = (char *)src;
  size_t outBufBytesLeft = destLen;
  char *outBuf = (char *)*dest;

  int rc = iconv(cd,
                 &inBuf,
                 &inBufBytesLeft,
                 &outBuf,
                 &outBufBytesLeft);
  if (rc == -1)
  {
    printf("iconv() failed: %s\n", strerror(errno));
    iconv_close(cd);
    free(*dest);
    *dest = NULL;
    return -1;
  }

  iconv_close(cd);

  return 0;
} // iwcstombs_alloc() 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T19:41:26.760

最简单的方法是将文件从 utf16 转换为 utf8 本机 UNIX 编码，然后读取它，

```
iconv -f utf16 -t utf8 file_in.txt -o file_out.txt 
```

您还可以使用 iconv(3)（参见 man 3 iconv）使用 C 转换字符串。大多数其他语言也绑定到 iconv。

您可以使用任何 UTF-8 语言环境，例如 en_US.UTF-8，这通常是大多数 Linux 发行版的默认语言环境。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T18:43:50.400

> （Windows 是否总是使用 UTF-16？例如在日文版本中）

是的，NT 的 WCHAR 始终是 UTF-16LE。

（用于日语安装的“系统代码页”确实是 cp932/Shift-JIS，在 NT 中仍然存在，以造福于许多非 Unicode 原生的应用程序、FAT32 路径等。）

但是，wchar_t 不能保证为 16 位，在 Linux 上也不会，使用的是 UTF-32 (UCS-4)。所以 wcstombs_l 不太可能高兴。

正确的做法是使用 iconv 之类的库将其读入您在内部使用的任何格式 - 大概是 wchar_t。您*可以*尝试通过插入字节来自己破解它，但您可能会弄错像代理这样的东西。

> 在我最新的 Ubuntu 和 Mac OS X 机器上运行“locale -a”会产生零语言环境，其名称中包含 utf-16。

事实上，由于所有的 \0，Linux 不能使用 UTF-16 作为语言环境的默认编码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-09T09:15:08.400

您可以读取二进制文件，然后进行自己的快速转换： [http](http://unicode.org/faq/utf_bom.html#utf16-3) ://unicode.org/faq/utf_bom.html#utf16-3 但是使用正确处理无效序列的库（如 libiconv）可能更安全。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T17:20:57.683

我强烈建议使用 Unicode 编码作为程序的内部表示。使用 UTF-16 或 UTF-8。如果您在内部使用 UTF-16，那么显然不需要翻译。如果您使用 UTF-8，则可以使用其中包含的语言环境，`.UTF-8`例如`en_US.UTF-8`.

# c# - Interlocked 是否在所有线程中提供可见性？

> ID：516863
> 
> 赞同：10
> 
> 时间：2009-02-05T17:10:01.793
> 
> 标签：c#, multithreading, visibility, interlocked

假设我有一个变量“counter”，并且有多个线程使用 Interlocked 访问和设置“counter”的值，即：

```
int value = Interlocked.Increment(ref counter); 
```

和

```
int value = Interlocked.Decrement(ref counter); 
```

我可以假设，Interlocked 所做的更改将在所有线程中可见吗？

如果没有，我应该怎么做才能让所有线程同步变量？

编辑：有人建议我使用 volatile。但是当我将“计数器”设置为 volatile 时，会出现编译器警告“对 volatile 字段的引用不会被视为 volatile”。

当我阅读在线帮助时，它说：“通常不应使用 ref 或 out 参数传递 volatile 字段”。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-01-26T16:08:13.080

> 我可以假设，Interlocked 所做的更改将在所有线程中可见吗？

这取决于您如何读取该值。如果您“只是”阅读它，那么不，除非您将其标记为易失性，否则它不会总是在其他线程中可见。但是，这会导致烦人的警告。

作为替代方案（并且更喜欢 IMO），请使用另一个 Interlocked 指令阅读它。这将始终在所有线程上看到更新的值：

```
int readvalue = Interlocked.CompareExchange(ref counter, 0, 0); 
```

它返回读取的值，如果为 0，则将其与 0 交换。

动机：警告暗示某事不正确；结合这两种技术（易失性和互锁性）并不是这样做的预期方法。

更新：似乎另一种不使用“易失性”的可靠 32 位读取方法是按照[此答案](https://stackoverflow.com/a/6139812/33080)`Thread.VolatileRead`中的建议使用。还有一些证据表明我完全错误地使用32 位读取，例如[这个 Connect issue](http://connect.microsoft.com/VisualStudio/feedback/details/256490/interlocked-read-only-does-long-data-type)，尽管我想知道这种区别本质上是否有点迂腐。`Interlocked`

我真正的意思是：不要将此答案用作您的唯一来源；我对此表示怀疑。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-01-26T19:16:38.223

x86 CPU 上的 InterlockedIncrement/Decrement（x86 的锁加/减）会自动创建*内存屏障*，从而为所有线程提供可见性（即，所有线程都可以按顺序看到其更新，如顺序内存一致性）。内存屏障使所有待处理的内存加载/存储完成。`volatile`与此问题无关，尽管 C# 和 Java（以及一些 C/C++ 编译器）强制执行`volatile`内存屏障。但是，联锁操作已经有 CPU 的内存屏障。

另请查看我在stackoverflow中[的另一个答案。](https://stackoverflow.com/questions/1581718/does-interlocked-compareexchange-use-a-memory-barrier/1716587#1716587)

请注意，我假设 C# 的 InterlockedIncrement/Decrement 是到 x86 的锁加/减的内在映射。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T17:20:43.643

事实上，他们不是。如果您想安全地修改`counter`，那么您正在做正确的事情。但是，如果您想`counter`直接阅读，则需要将其声明为`volatile`. 否则，编译器没有理由相信它`counter`会改变，因为`Interlocked`操作是在它可能看不到的代码中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T17:10:44.600

互锁确保一次只有 1 个线程可以更新值。为了确保其他线程可以读取正确的值（而不是缓存值），将其标记为 volatile。

公共 volatile int 计数器；

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-06-04T19:00:59.917

不; 单独的**Interlocked-at-Write-Only 并*不能*确保代码中的变量读取实际上是新鲜的；**即使在“强内存模型”下，不能正确读取字段的程序也*可能不是线程安全的。*这适用于任何形式的分配给线程之间共享的字段。

*这是一个由于 JIT 而*永远不会终止的代码示例。（它是从[.NET 中的 Memory Barriers](http://afana.me/archive/2015/07/10/memory-barriers-in-dot-net.aspx/)修改为针对该问题更新的可运行 LINQPad 程序）。

```
// Run this as a LINQPad program in "Release Mode".
// ~ It will never terminate on .NET 4.5.2 / x64\. ~
// The program will terminate in "Debug Mode" and may terminate
// in other CLR runtimes and architecture targets.
class X {
    // Adding {volatile} would 'fix the problem', as it prevents the JIT
    // optimization that results in the non-terminating code.
    public int terminate = 0;
    public int y;

    public void Run() {
        var r = new ManualResetEvent(false);
        var t = new Thread(() => {
            int x = 0;
            r.Set();
            // Using Volatile.Read or otherwise establishing
            // an Acquire Barrier would disable the 'bad' optimization.
            while(terminate == 0){x = x * 2;}
            y = x;
        });

        t.Start();
        r.WaitOne();
        Interlocked.Increment(ref terminate);
        t.Join();
        Console.WriteLine("Done: " + y);
    }
}

void Main()
{
    new X().Run();
} 
```

[.NET 中内存屏障](http://afana.me/archive/2015/07/10/memory-barriers-in-dot-net.aspx/)的解释：

> *这次是 JIT，而不是硬件。*很明显，JIT 已经缓存了变量 terminate [在 EAX 寄存器中的值，并且] 程序现在卡在上面突出显示的循环中..
> 
> 在 while 循环中使用 a`lock`或添加 a都可以解决问题。`Thread.MemoryBarrier`或者你甚至可以使用`Volatile.Read`[or a `volatile`field]。*这里内存屏障的目的只是为了抑制 JIT 优化。*现在我们已经了解了*软件和硬件如何重新排序内存操作*，是时候讨论内存屏障了。

**也就是说，在读取端需要一个额外的*屏障构造来**防止编译和 JIT 重新排序/优化*问题：**这是与内存一致性不同的问题！

在此处添加`volatile`会*阻止*JIT 优化，从而“解决问题”，即使这样会导致警告。该程序也可以通过使用`Volatile.Read`导致障碍的各种其他操作之一来纠正：这些障碍与底层硬件内存栅栏一样是 CLR/JIT 程序正确性的一部分。

# jquery - jQuery UI 中的内存泄漏

> ID：516869
> 
> 赞同：0
> 
> 时间：2009-02-05T17:11:43.847
> 
> 标签：jquery, ajax, jquery-ui, memory-leaks, jquery-ui-progressbar

我有一个简单的页面，它由一个包含三个表`jQuery UI progressbars`和一个 ajax 调用的表组成。

ajax 调用一个空的 php 文件，成功后我销毁并重新创建我的进度条。

它看起来很简单，但运行它会导致内存泄漏`IE7`（`Chrome`尽管 Chrome 处理得更优雅）。

这是我的代码：

```
<script type="text/javascript" src="jQuery/js/jquery-1.3.1.js"></script>
<script type="text/javascript" src="jQuery/js/plugins/jquery-ui-1.6rc4.min.js"></script>
<link rel="stylesheet" type="text/css" href="jQuery/css/ui.all.css" />

<script type="text/javascript">
$(function(){
    timed();    
});

function timed()
{
    $.ajax({
        url: "index.php",
        success: function(msg){
            $(".progressbar").progressbar("destroy").progressbar();
        }
    });

    setTimeout("timed()",1000);
} 
```

```
<table> 
<tbody>
    <tr> 
        <td>
          <div class="progressbar"></div>
        </td>
        <td>
          <div class="progressbar"></div>
        </td>
        <td>
          <div class="progressbar"></div>
        </td>
    </tr> 
</tbody> 
```

关于我在这里缺少的任何想法？

我试过在我的 Success 函数`$("*").unbind();`的行之前添加。`$(".progressbar")`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T17:27:31.243

你为什么要破坏然后重建它？将进度值重置为零并让它不理会，直到您以后再次需要它，这不是更简单吗？如果您特别不希望它可见，您甚至可以 .hide() 它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T21:51:21.460

我想我要做的就是在应用程序启动时创建进度条，克隆它，并在完成处理后将其添加到我的模板中。这从本质上将内存使用减慢到爬行（每 4-5 次刷新大约 4k）而不是当前（每次刷新大约 100 到 300 k）。

# c# - 到本地 Sql Express 服务器的并发 SqlConnection 和 EntityConnection

> ID：516873
> 
> 赞同：1
> 
> 时间：2009-02-05T17:12:27.107
> 
> 标签：c#, sql-server-2005, linq-to-entities

我将 Linq2Entity 用于我的大部分数据库操作。然而，对于数据库创建、表创建和初始数据插入，我使用纯 SQL 文件。因此我需要一个SqlConnection 和一个EntityConnection。不幸的是，实体框架开始抱怨 Sql Server 没有在管道的另一端进行侦听。

我不确定这里的问题是什么，这可能是由于用户实例化。清除 SqlConnection 的池或处置连接实例无济于事。

我正在使用的连接字符串如下：

“数据源=.\SQLEXPRESS；初始目录=dbname；集成安全=SSPI；”

更新：

我曾尝试将 EntityConnection 用于数据库维护目的，但遇到了麻烦。我不能使用 EntityConnection 来创建数据库和删除数据库。EntityConnection 不支持以下语法，但对 ms SQL express 的 SqlConnection 可以正常工作。

```
CREATE DATABASE silverfit ON ( NAME = silverfit, FILENAME = 'c:\silverfit\silverfit.mdf' ); 
```

同样由于某种原因，EntityConnection 不允许我更改删除数据库所必需的数据库。恐怕我仍然需要 SqlConnection 来创建数据库和表..

SqlConnections 和 EntityConnections 有没有办法为本地 ms SQL express 数据库共存？

谢谢， 沃特

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-06T01:26:16.117

您是否尝试过创建一个 SqlConnection，然后将其传递给 EntityConnection 的构造函数？EntityConnection 的重载之一采用 MetadataWorkspace 和 DbConnection（从中派生 SqlConnection）。这样做的轻微缺点是您必须手动创建 MetadataWorkspace，它收集定义您的 .csdl、.ssdl 和 .msl 文件工作区。但是，从长远来看，您应该能够为执行 DML 查询和使用实体框架共享一个连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T17:55:00.330

我不同意您需要一个普通的 SQL 连接和实体连接来完成此任务，至少正如您所描述的那样。您可以使用实体连接执行 SQL。查看[EntityConnection.CreateDbCommand](http://msdn.microsoft.com/en-us/library/system.data.common.dbconnection.createdbcommand.aspx)。自然地，这里有一个危险，即您在一个非数据库服务器特定的实例（如 EntityConnection）上执行特定于数据库服务器的事情。但在这种情况下，它可能胜过拥有单独的连接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-06T01:10:20.440

您是否尝试使用 EntityConnection.StoreConnection 来检索 SqlConnection 并使用它执行命令？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-08T12:28:07.897

如果您尝试在运行时将数据库文件附加到 SQL Server Express，看起来好像是这样，那么一次只能打开一个连接。这是其他事情的问题，而不仅仅是您要完成的事情。例如，假设您通过 VS 中的服务器资源管理器连接到“c:\silverfit\silverfit.mdf”并尝试打开数据库中的一个表。打开表后，尝试运行您的应用程序。它会爆炸。

但是，如果您打开 SQL Management Studio Express（您可以[在此处](http://www.microsoft.com/downloadS/details.aspx?familyid=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&displaylang=en)下载），然后将数据库附加到 SQL Server，您遇到的问题应该会消失。此时，您应该能够通过 SQLConnection 或 EntityConnection 打开与数据库的多个连接。

在运行时将数据库附加到 SQL Server express 引擎实际上只适用于演示目的或概念证明。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-08T19:00:53.217

ADO.NET 是否通过连接池保持打开到数据库的连接？尝试将 Pooling=False 添加到连接字符串，因为这可能允许在删除数据库之前将其关闭。

# .net - 在 LINQ to SQL 中附加实体的问题

> ID：516879
> 
> 赞同：2
> 
> 时间：2009-02-05T17:14:26.977
> 
> 标签：.net, linq-to-sql

我正在尝试在 LINQ to SQL 中附加一个实体，但它会引发以下异常 L：

**已尝试附加或添加一个不是新的实体，可能是从另一个 DataContext 加载的。这是不支持的。**

```
<Table Name="dbo.Products" Member="Products">
    <Type Name="Product">
      <Column Name="Id" Type="System.Int64" DbType="BigInt NOT NULL IDENTITY" IsReadOnly="true" IsPrimaryKey="true" IsDbGenerated="true" CanBeNull="false" />
      <Column Name="Name" Type="System.String" DbType="NVarChar(MAX) NOT NULL" CanBeNull="false" />    
      <Column Name="IsDeleted" Type="System.Boolean" DbType="Bit NOT NULL" CanBeNull="false" />
      <Column Name="Timestamp" Type="System.Data.Linq.Binary" DbType="timestamp NOT NULL" CanBeNull="false" IsVersion="true" />
      {...SOME ASSOCIATIONS....}
    </Type>
</Table> 
```

我用来附加实体的代码是：

```
var context = new MyDataContext();
context.Products.Attach(entity, true); 
```

任何想法，为什么我会收到这个错误？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T17:21:10.210

您可以将实体附加到与创建它的对象不同的 DataContext 上，前提是它首先被序列化和反序列化（比如将其发送到客户端并让它返回）。

看[这里](http://blogs.msdn.com/dinesh.kulkarni/archive/2007/10/08/attach-if-you-have-something-detached.aspx)了解更多

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T17:38:12.297

我猜您遇到了这个问题，因为您尝试在 n 层环境中使用 LINQ2SQL，可能使用 ASP.NET，以便在尝试提交对数据库的更改时不再存在旧上下文？

我遇到了完全相同的问题，并通过为数据层编写通用存储库实现来解决它们。它处理所有实体分离/附加问题，甚至支持更新和删除实体分离树，并且可以帮助您更轻松地编写数据层。[您可以在此处](https://devermind.wordpress.com/2008/10/13/a-linq-disconnected-mode-abstract-base-class/)找到更详细的描述和源代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-04T22:10:11.107

PLINQO 自动在您的实体上实现分离功能以及大量其他功能和增强功能。如果您有兴趣，请查看[http://www.plinqo.com](http://www.plinqo.com)

# c# - ref 和 out 和有什么不一样？（C＃）

> ID：516882
> 
> 赞同：3
> 
> 时间：2009-02-05T17:15:31.220
> 
> 标签：c#

有什么简洁的解释吗？

还回答： [.NET 中 ref 和 out 参数之间的区别](https://stackoverflow.com/questions/135234/difference-between-ref-and-out-parameters-in-net)

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-05T17:18:37.110

对于来电者：

*   对于 ref 参数，变量必须已经明确分配
*   对于out参数，变量不一定要明确赋值，而是在方法返回之后

对于方法：

*   一个 ref 参数一开始是明确分配的，您不必*为*它分配任何值
*   一个 out 参数*并不是*一开始就明确分配的，你必须确保任何时候返回（无一例外）它*都会*被明确分配

所以：

```
int x;
Foo(ref x); // Invalid: x isn't definitely assigned
Bar(out x); // Valid even though x isn't definitely assigned
Console.WriteLine(x); // Valid - x is now definitely assigned

...

public void Foo(ref int y)
{
    Console.WriteLine(y); // Valid
    // No need to assign value to y
}

public void Bar(out int y)
{
    Console.WriteLine(y); // Invalid: y isn't definitely assigned
    if (someCondition)
    {
        // Invalid - must assign value to y before returning
        return;
    }
    else if (someOtherCondition)
    {
        // Valid - don't need to assign value to y if we're throwing
        throw new Exception();
    }
    else
    {
        y = 10;
        // Valid - we can return once we've definitely assigned to y
        return;
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T17:18:16.923

最简洁的查看方式：

参考 = 输入

出=出

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T17:17:08.063

请参阅MSDN 上的[这篇](http://msdn.microsoft.com/en-us/vcsharp/aa336814.aspx)文章。他们都完成了微妙不同的事情，真的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T17:17:46.393

ref 和 out 参数传递模式用于允许方法更改调用者传入的变量。ref 和 out 之间的区别很微妙但很重要。每种参数传递模式都旨在应用于略有不同的编程场景。out 和 ref 参数之间的重要区别是每个参数使用的明确分配规则。

带有 out 参数的方法的调用者不需要在调用之前分配作为 out 参数传递的变量；但是，被调用者需要在返回之前分配给 out 参数。

来源： [MSDN](http://msdn.microsoft.com/en-us/vcsharp/aa336814.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T17:23:49.377

从 Alex 提到的 MSDN 文章中，

> 带有 out 参数的方法的调用者不需要在调用之前分配作为 out 参数传递的变量；但是，被调用者需要在返回之前分配给 out 参数。
> 
> 相反，ref 参数被认为是由被调用者最初分配的。因此，被调用者不需要在使用前分配给 ref 参数。

总而言之，在方法内部您可以考虑设置 ref 参数，但不能考虑设置参数 - 您必须设置这些。在方法之外，他们应该采取同样的行动。

# hudson - 如何确保在 Hudson 中一次只运行某一类别的工作中的一个？

> ID：516883
> 
> 赞同：5
> 
> 时间：2009-02-05T17:15:44.447
> 
> 标签：hudson

我使用 Hudson 来自动化测试一个非常重要的产品。我希望我的测试主机能够运行理论上支持的尽可能多的并发构建，但 excel 测试除外，它必须在任何时候每台机器运行一个。可以同时运行任意数量的非 excel 测试，但是每台机器一次最多只能运行一个 excel 测试。

背景：

我的大多数测试都是普通的单元测试——我可以轻松地并行运行这种东西。不幸的是，我的单元测试计划中的一个重要且耗时的部分包括已在 Excel 中实现的测试。

您可能认为在 Excel 中实现测试很疯狂——实际上有一个重要原因：我们的大多数用户通过 Excel 访问我们的系统。Excel 有自己古怪的数据处理方式，因此保证我们的东西适用于 Excel 用户的唯一方法是从字面上实现我们的 reg-test 我们的应用程序 Excel。

我编写了一个测试运行工具，它可以让我轻松启动一组 excel 测试：每个测试都是一个 .xls 文件。每个组都是一个充满 excel 文件的文件夹。我有大约 30 个组需要运行以进行端到端测试。我的工具将每个测试的结果转换为 Hudson 能够理解的 JUnit 样式 XML。测试使用 pywin32com 库来自动化 excel。当它们自己运行时，它们是可靠的。

我有一组专门用于运行测试的计算机。每台机器都是四核的，理论上可以同时运行很多东西。不幸的是，我发现 COM 不能用于一次安全地控制每台机器超过 1 个 excel。

也就是说，如果第二个构建星尝试通过 COM 与 Excel 对话，它可能会干扰已经运行的构建并导致两个测试都失败。

我可以在机器允许的范围内运行尽可能多的其他非 excel 进程，但我需要找到一种方法，以便 Hudson 不会尝试在任何一台机器上同时启动超过 1 个需要 excel 的进程。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T19:13:37.847

听起来 Locks and Latches 插件可能会对您有所帮助。

[http://hudson.gotdns.com/wiki/display/HUDSON/Locks+and+Latches+plugin](http://hudson.gotdns.com/wiki/display/HUDSON/Locks+and+Latches+plugin)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T18:17:59.517

哈德森不是java吗？

由于您已标记此帖子 python，我将指出[buildbot](http://buildbot.net/)具有[从属锁](http://buildbot.net/repos/release/docs/buildbot.html#Interlocks)以限制单个从属上的各个步骤（或者如果您愿意，可以将它们用作更粗略的锁）。

# c# - StructureMap 使用 Scan 自动注册泛型类型

> ID：516892
> 
> 赞同：9
> 
> 时间：2009-02-05T17:17:48.470
> 
> 标签：c#, structuremap

我有一个界面：

```
IRepository<T> where T : IEntity 
```

当我使用一些只返回任何旧数据的假存储库实现来敲我的 UI 时。

它们看起来像这样：

```
public class FakeClientRepository : IRepository<Client> 
```

目前我正在这样做：

```
ForRequestedType<IRepository<Client>>()
   .TheDefaultIsConcreteType<FakeRepositories.FakeClientRepository>(); 
```

但是对于我所有的 IEntities 来说都是很多次。是否可以使用 Scan 为其各自的 IRepository 自动注册我所有的假存储库？

编辑：据我所知，但我收到错误说请求的类型未注册:(

```
Scan(x =>
{
    x.TheCallingAssembly();
    x.IncludeNamespaceContainingType<FakeRepositories.FakeClientRepository>();
    x.AddAllTypesOf(typeof(IRepository<>));
    x.WithDefaultConventions();
}); 
```

谢谢

安德鲁

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-06-03T17:20:33.747

有一种更简单的方法可以做到这一点。有关详细信息，请参阅此博客文章：[高级结构映射：连接实现以打开泛型类型](http://lostechies.com/jimmybogard/2009/12/18/advanced-structuremap-connecting-implementations-to-open-generic-types/)

```
public class HandlerRegistry : Registry
{
    public HandlerRegistry()
    {
        Scan(cfg =>
        {
            cfg.TheCallingAssembly();
            cfg.IncludeNamespaceContainingType<FakeRepositories.FakeClientRepository>();
            cfg.ConnectImplementationsToTypesClosing(typeof(IRepository<>));
        });
    }
} 
```

这样做可以避免创建自己的`ITypeScanner`或约定。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-06T09:25:13.260

谢谢克里斯，这[正是](https://stackoverflow.com/a/516955)我所需要的。为清楚起见，这是我从您的链接中所做的：

```
Scan(x =>
{
    x.TheCallingAssembly();
        x.IncludeNamespaceContainingType<FakeRepositories.FakeClientRepository>();
    x.With<FakeRepositoryScanner>(); 
});

private class FakeRepositoryScanner : ITypeScanner
{
    public void Process(Type type, PluginGraph graph)
    {
        Type interfaceType = type.FindInterfaceThatCloses(typeof(IRepository<>));
        if (interfaceType != null)
        {
            graph.AddType(interfaceType, type);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T17:35:26.217

看看来自 StructureMap 用户组的讨论：[http ://groups.google.com/group/structuremap-users/browse_thread/thread/649f5324c570347d](http://groups.google.com/group/structuremap-users/browse_thread/thread/649f5324c570347d)

# database - 从 Hibernate 映射中获取列长度？

> ID：516906
> 
> 赞同：9
> 
> 时间：2009-02-05T17:20:39.883
> 
> 标签：database, hibernate, validation

要验证我收到的数据，我需要确保长度不会超过数据库列的长度。现在所有长度信息都存储在 Hibernate 映射文件中，是否可以通过编程方式访问这些信息？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T01:50:49.823

你可以做到，但这并不容易。您可能希望在启动时执行以下操作并存储值的静态缓存。有很多特殊情况需要处理（继承等），但它应该适用于简单的单列映射。我可能遗漏了一些 instanceof 和 null 检查。

```
for (Iterator iter=configuration.getClassMappings(); iter.hasNext();) {
    PersistentClass persistentClass = (PersistentClass)iter.next();
    for (Iterator iter2=persistentClass.getPropertyIterator(); iter2.hasNext();) {
       Property property = (Property)iter2.next();
       String class = persistentClass.getClassName();
       String attribute = property.getName();
       int length = ((Column)property.getColumnIterator().next()).getLength();
    }
  } 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T21:42:53.550

根据布赖恩的回答，这就是我最终要做的。

```
private static final Configuration configuration = new Configuration().configure();

public static int getColumnLength(String className, String propertyName) {
    PersistentClass persistentClass = configuration.getClassMapping(className);
    Property property = persistentClass.getProperty(propertyName);
    int length = ((Column) property.getColumnIterator().next()).getLength();

    return length;
} 
```

这似乎运作良好。希望这对偶然发现这个问题的人有所帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-01-28T18:38:34.953

我首选的开发模式是将列长度基于一个常数，这可以很容易地引用：

```
class MyEntity {
   public static final int MY_FIELD_LENGTH = 500;

   @Column(length = MY_FIELD_LENGTH)
   String myField;

   ...
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-20T10:01:51.383

有时获取 Configuration 对象可能会出现问题（如果您正在使用某些应用程序框架并且您没有使用 Configuration 自己创建会话工厂）。

例如，如果您使用的是 Spring，则可以使用 LocalSessionFactoryBean（来自您的 applicationContext）来获取 Configuration 对象。然后获得列长度只是小菜一碟；）

```
factoryBean.getConfiguration().getClassMapping(String entityName) .getTable().getColumn(Column col).getLength() 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-12T18:53:39.613

但是，当我尝试访问时`LocalSessionFactoryBean`，我接受了一个类转换异常

```
LocalSessionFactoryBean factoryBean = (LocalSessionFactoryBean) WebHelper.instance().getBean("sessionFactory"); 
```

例外：

```
org.hibernate.impl.SessionFactoryImpl cannot be cast to org.springframework.orm.hibernate3.LocalSessionFactoryBean

<bean id="sessionFactory"
        class="org.springframework.orm.hibernate3.LocalSessionFactoryBean> 
```

这似乎很狡猾......

**编辑：**找到答案。您需要在 bean 名称字符串前面使用 & 符号

```
LocalSessionFactoryBean factoryBean = (LocalSessionFactoryBean) WebHelper.instance().getBean("&sessionFactory"); 
```

[看到这个春季论坛帖子](http://forum.springsource.org/archive/index.php/t-22070.html)

# mysql - MySql Union 未在视图中执行

> ID：516910
> 
> 赞同：0
> 
> 时间：2009-02-05T17:21:24.017
> 
> 标签：mysql

我正在尝试为我创建的 2 个选择语句的 UNION 创建一个视图。

单独执行时，UNION 工作正常

但问题是当我将它作为视图执行时，只有 UNION 的第一部分被执行。

我正在使用的查询如下

```
SELECT DISTINCT products.pid AS id, 
                products.pname AS name, 
                products.p_desc AS description,
                products.p_loc AS location,
                products.p_uid AS userid,
                products.isaproduct AS whatisit 
           FROM products

          UNION
          SELECT DISTINCT services.s_id AS id, 
                services.s_name AS name, 
                services.s_desc AS description,
                services.s_uid AS userid,
                services.s_location AS location,
                services.isaservice AS whatisit 
           FROM services
          WHERE services.s_name 
```

当我单独执行时，上述工作正常。但是当我将它用作视图时，它并没有给我服务部分的结果。

有人可以帮我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-17T19:06:16.760

从[工会描述：](http://dev.mysql.com/doc/refman/5.1/en/union.html)

> 第一个 SELECT 语句中的列名用作返回结果的列名。在每个 SELECT 语句的相应位置列出的选定列应具有相同的数据类型。（例如，第一个语句选择的第一列应该与其他语句选择的第一列具有相同的类型。）

这意味着，userid 和 location 在第二个 select 语句中混合在一起。

# bash - 在 cygwin 中转义“运行”命令行选项

> ID：516912
> 
> 赞同：4
> 
> 时间：2009-02-05T17:21:33.453
> 
> 标签：bash, cygwin

我在通过“运行”将参数传递到 Windows 端时遇到问题

为了演示，它看起来像这样：

```
run C:\foo.exe /BUILD 
```

'/BUILD' 参数永远不会传递给可执行文件。有人知道解决这个问题的方法吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-09T21:54:58.447

经过大量研究后，正确的答案是通过批处理文件传递它 - 强制“运行”只执行一个 cmd，将所有执行传递给批处理文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T17:31:07.367

我不经常使用 Cygwin，但可能：

`run 'c:\foo.exe /BUILD'`

（如果不是单引号，那么可能是双引号？）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T17:33:17.877

您是否尝试将其括在引号中，例如：

```
run "C:\foo.exe /BUILD" 
```

我想知道 shell 是否混淆了参数属于谁 - 也就是说，“运行”正在消耗 /BUILD，而不是传递它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T15:41:40.597

foo.exe 应该做什么，你怎么知道它没有得到 /build 命令行选项？如果你这样做`info run`，你会得到：

```
Windows  programs  are  either  GUI  programs or console programs. When
started console  programs  will  either  attach  to an existing console
or  create a new one. GUI programs can  never attach to an exiting con-
sole. There is no way to attach to an existing console but hide  it  if
started as GUI program.

run  will  do this for you. It works  as intermediate and starts a pro-
gram but makes the console window hidden. 
```

最后一点很重要——它隐藏了控制台窗口。所以，你会看到这样的东西：

```
</cygdrive/d/sandbox> $ run ls -la
</cygdrive/d/sandbox> $ 
```

但如果你改为运行它，你会看到不同的东西：

```
</cygdrive/d/sandbox> $ cat foo.lst
cat: foo.lst: No such file or directory
</cygdrive/d/sandbox> $ run ls -la >foo.lst
</cygdrive/d/sandbox> $
</cygdrive/d/sandbox> $ cat foo.lst
total 9272280
drwx------+ 15 jcasadonte     ????????             0 Feb  7 10:39 .
drwxrwxr-x+ 14 Administrators SYSTEM               0 Feb  7 00:44 ..
-rwx------+  1 jcasadonte     ????????         26300 Apr 10  2006 ATT01779.jpg
[...etc...] 
```

第一个命令正在运行，但它正在打印到一个不存在的控制台窗口。

注意：我会使用 DOS 命令解释器来完成该示例，就像您正在尝试做的那样，但是 XP cmd.exe 没有正确处理“>”，并将其交给`run`而不是`ls`.

# continuous-integration - 如何自动化集成测试？

> ID：516915
> 
> 赞同：25
> 
> 时间：2009-02-05T17:21:56.980
> 
> 标签：continuous-integration, integration, integration-testing

我想知道一些事情，我知道为了使您的测试更容易，您应该在单元测试期间使用模拟来仅测试您想要的组件，而无需外部依赖。但在某些时候，您必须硬着头皮测试与您的数据库、文件、网络等交互的类。

我的主要问题是：您如何测试这些课程？

*   我不觉得在我的 CI 服务器上安装数据库是一个好习惯，但是您还有其他选择吗？

*   我应该使用其他 CI 工具创建另一个服务器，并具有所有外部依赖项吗？

*   我应该像单元测试一样频繁地在 CI 上运行集成测试吗？

*   也许应该由专职人员负责手动测试这些组件？（或负责创建测试环境并配置您的类与外部依赖项之间的交互，例如编辑应用程序的配置文件）

我想知道你在现实世界中的表现如何。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-06T17:29:57.647

> 我想知道你在现实世界中的表现如何？

在现实世界中，没有关于做什么的简单规定，但有一个指导性真理：您希望在引入错误/错误/测试失败后尽快发现它们。让它成为你的向导；其他一切都是技术。

几种常见的技术：

*   并行运行的测试。这是我的偏好；我喜欢有两个系统，每个系统都运行自己的 CruiseControl* 实例（我是其提交者），一个运行单元测试并提供快速反馈（< 5 分钟），而另一个系统持续运行集成测试。我喜欢这个，因为它最大限度地减少了签入发生和系统测试可能捕获它之间的延迟。有些人不喜欢的缺点是，对于同一个签入，您最终可能会出现多个测试失败，包括单元测试失败和集成测试失败。在实践中，我不认为这是一个主要的缺点。

*   系统/集成测试仅在单元测试通过后运行的生命周期模型。围绕这种模型构建了诸如 AnthillPro* 之类的工具，这种方法非常流行。在他们的模型中，他们采用已通过单元测试的工件，将它们部署到单独的登台服务器，然后在那里运行系统/集成测试。

如果您对此主题有更多疑问，我建议您参加[持续集成和测试会议](http://www.citconf.com/)(CITCON) 和/或[CITCON 邮件列表](http://tech.groups.yahoo.com/group/citcon/)。

*   那里有很多[CI 和构建|流程自动化工具](http://confluence.public.thoughtworks.org/display/CC/CI+Feature+Matrix)。这些只是其工具类别的代表。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T17:30:39.817

我最常看到的方法是在签入时立即运行单元测试，并以固定的时间间隔运行更长时间的集成测试（可能在不同的服务器上；这真的取决于你的喜好）。我还看到集成测试分为“短期运行”集成测试和“长期运行”集成测试，它们以不同的时间间隔运行（例如，“短期运行”测试每小时运行一次，而“长期运行”测试-running”测试在一夜之间运行）。

任何自动化测试的真正目标是尽可能快地向开发人员提供反馈。考虑到这一点，您应该尽可能多地运行集成测试。如果集成测试的运行时间差异很大，则应该更频繁地运行快速集成测试，而减少运行速度较慢的集成测试。您运行任何一组测试的频率取决于运行所有测试需要多长时间，以及测试运行对运行时间较短的测试（包括单元测试）的破坏程度。

我意识到这并不能回答你的整个问题，但我希望它能给你一些关于调度部分的想法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T17:26:33.537

根据集成测试的实际性质，我建议使用嵌入式数据库引擎，在任何运行之前至少重新创建一次。这使得不同提交的测试能够并行工作，并为测试提供了一个明确定义的起点。

网络服务——根据定义——也可以安装在其他地方。

但始终要非常小心，将您的 CI 机器与任何开发或生产环境分开。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T17:31:16.867

我不知道您使用的是哪种平台，但我使用的是 Java。在我工作的地方，我们在 JUnit 中创建集成测试，并使用像 Spring 这样的 DI 容器注入适当的依赖项。它们由开发人员自己（通常是一小部分）和 CI 服务器针对真实数据源运行。

在我看来，你运行集成测试的频率取决于它们运行的​​时间。尽可能多地运行它们。让真人参与其中，让他或她在自动化测试困难或过于昂贵的领域（例如：拼写、不同 GUI 组件的位置）运行手动系统测试。将配置文件的编辑留给机器。在我工作的地方，我们在计算机上设置了系统变量（DEV；TEST 等），并让应用程序根据这些变量选择配置文件。

# javascript - JavaScript 正则表达式对象

> ID：516917
> 
> 赞同：3
> 
> 时间：2009-02-05T17:22:03.857
> 
> 标签：javascript, regex

我尝试用 JavaScript 编写一个简单的 Markdown 解析器。因此我想检查`[link content][link id]`语法。我使用以下代码：

```
data = data.replace( /\[(.*?)\][ ]*\[([0-9]+)\]/g, '<a href="$2">$1</a>' ); 
```

它工作得很好，但现在我想用 RegExp 对象来做这件事。所以我设置了以下代码：

```
var r = new RegExp( '\[(.*?)\][ ]*\[([0-9]+)\]', 'g' );
data = data.replace( r, '<a href="$2">$1</a>' ); 
```

但它不起作用。它甚至说我的正则表达式（因为第一个例子做得很好）是无效的：

> 不匹配 ) 在正则表达式中

我认为这一定与我不知道的一些 RegExp 对象特性有关。我做错了什么，如何解决问题？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-05T17:25:40.183

因为 RegExp 构造函数的第一个参数是字符串，而不是模式文字，所以您必须转义反斜杠，因为您希望在模式中使用文字反斜杠：

```
var r = new RegExp( '\\[(.*?)\\][ ]*\\[([0-9]+)\\]', 'g' ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T18:51:44.847

除了模式的反斜杠问题之外，还有：

```
data = data.replace( r, '<a href="$2">$1</a>' ); 
```

可能很危险。我假设你已经处理了 HTML 转义，所以我不能这样做：

```
[<script>stealCookies()</script>][http://oops.example.com/]
[hover me][http://hello" onmouseover="stealCookies()] 
```

但是您仍然需要检查 URL 是一个已知良好的方案，所以我不能这样做：

```
[click me][javascript:stealCookies()] 
```

您可能希望使用该方法的 String.replace(r, func) 变体，并在您的替换制作“func”中包含验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T17:25:48.703

```
var r = /\[(.*?)\][ ]*\[([0-9]+)\]/g;
data = data.replace( r, '<a href="$2">$1</a>' ); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T17:26:01.353

双重逃避你的反斜杠：

```
var r = new RegExp( '\\[(.*?)\\][ ]*\[([0-9]+)\\]', 'g' ); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T17:30:24.247

您需要双重转义：

```
var r = new RegExp( '\\[(.*?)\\][ ]*\\[([0-9]+)\\]', 'g' ) 
```

# xml - 如何在 complexType 中混合无界组和受限组？

> ID：516934
> 
> 赞同：1
> 
> 时间：2009-02-05T17:28:05.173
> 
> 标签：xml, xsd

我正在尝试创建一个工具，该工具可以为通过序列化 .NET 中的类型生成的 XAML 生成 XSD，但这与 .NET 无关。

假设我有一个类型。这种类型具有属性并且是一个集合。

```
public class MyType : Collection<CollectedType>
{
  public PType1 PropertyOne {get;set;}
  public PType2 PropertyTwo {get;set;}
} 
```

这序列化为以下内容（省略对象图构造）：

```
<MyType xmlns="clr-namespace:blahblahblah">
  <CollectedType name="First instance in the collection"/>
  <CollectedType name="Second instance in the collection"/>
  <MyType.PropertyOne>
    <PType1 Value = "Serialized object in PropertyOne" />
  </MyType.PropertyOne>
  <MyType.PropertyTwo>
    <PType2 Value = "Serialized object in PropertyTwo" />
  </MyType. PropertyTwo >
</MyType> 
```

在为这种类型生成 XSD 时，我可以说以下内容：

*   MyType 是一个复杂类型
*   MyType 将包含对名为 CollectedTypeGroup 的组的引用
*   *   CollectedTypeGroup 包含 CollectedType 的元素和扩展 CollectedType 的类型的元素
*   MyType 将包含一个名为 MyType.PropertyOne 的元素
*   *   PType1 是另一个复杂类型
*   MyType 将包含一个名为 MyType.PropertyTwo 的元素
*   *   PType2 是另一个复杂类型

这一切都相对容易做到。这是生成的 xsd 的一部分：

```
 <xs:complexType name="MyType">
    <xs:sequence>
      <xs:element name="MyType.PropertyOne" type="PType1"/>
      <xs:element name="MyType.PropertyOne" type="PType1"/>
      <xs:group ref="CollectedTypeGroup"/>
    </xs:sequence>
  </xs:complexType> 
```

现在是困难的部分。因为 XML 将被映射回对象图，所以我有一个关于如何将元素添加到 MyType 的限制列表，这些限制**必须**由模式强制执行。如果这三个要求**并且只有这三个**没有被强制执行，我会遇到用户尝试使用我的架构的问题：

1) 添加到 MyType 的元素**不得限制为特定顺序**
2) 表示我的对象属性的元素**只能出现一次或根本不出现**
3) 组元素**必须是无界**的；它们可以出现在父元素中的任何位置，并且可以出现 0...* 次

这是我有一个可怕的时间。我找不到满足这三个要求的选择、序列、全部等的令人满意的组合。我还尝试将元素放在单独的组、complexTypes 等中。似乎没有任何效果。

如何将我的元素和我的组组合成一个 complexType 并满足我的三个要求？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T18:20:00.200

这是否满足您的需求？

```
 <xs:element name="MyType" type="MyType.Type"/>
    <xs:complexType name="MyType.Type">
      <xs:sequence>
        <xs:group ref="CollectedTypeGroup" minOccurs="0" maxOccurs="unbounded"/>
        <xs:choice minOccurs="0">
          <xs:sequence>
            <xs:element name="MyType.PropertyOne" type="PType1.Type"/>
            <xs:group ref="CollectedTypeGroup" minOccurs="0" maxOccurs="unbounded"/>
            <xs:sequence minOccurs="0">
              <xs:element name="MyType.PropertyTwo" type="PType2.Type"/>
              <xs:group ref="CollectedTypeGroup" minOccurs="0" maxOccurs="unbounded"/>
            </xs:sequence>
          </xs:sequence>
          <xs:sequence>
            <xs:element name="MyType.PropertyTwo" type="PType2.Type"/>
            <xs:group ref="CollectedTypeGroup" minOccurs="0" maxOccurs="unbounded"/>
            <xs:sequence minOccurs="0">
              <xs:element name="MyType.PropertyOne" type="PType1.Type"/>
              <xs:group ref="CollectedTypeGroup" minOccurs="0" maxOccurs="unbounded"/>
            </xs:sequence>
          </xs:sequence>
        </xs:choice>
      </xs:sequence>
    </xs:complexType>
    <xs:group name="CollectedTypeGroup">
      <xs:choice>
        <xs:element name="CollectedType" type="CollectedType.Type"/>
        <xs:element name="DerivedCollectedType" type="CollectedType.Type"/>
        <xs:element name="DerivedCollectedType2" type="CollectedType.Type"/>
      </xs:choice>
    </xs:group>
    <xs:complexType name="CollectedType.Type">
      <xs:attribute name="name" type="xs:string"/>
    </xs:complexType>
    <xs:complexType name="PType1.Type">
      <xs:sequence>
        <xs:element name="PType1">
          <xs:complexType>
            <xs:attribute name="Value" type="xs:string"/>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
    </xs:complexType>
    <xs:complexType name="PType2.Type">
      <xs:sequence>
        <xs:element name="PType2">
          <xs:complexType>
            <xs:attribute name="Value" type="xs:string"/>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
    </xs:complexType> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T16:38:03.500

这让人们困惑了多年，但在 XML Schema 中定义这种内容模型是不可能的。

唯一保证您的元素出现一次或根本不出现并且以任何顺序出现的模式粒子是 xsd:all。但是，您可能已经发现，xsd:all 中元素的最大界限是 1，而不是无界限。

如果你的集合元素有一个容器元素，你可以摆脱这个：

```
<xs:complexType name="MyType">
    <xs:sequence>
      <xs:element name="MyType.PropertyOne" type="PType1" minOccurs="0"/>
      <xs:element name="MyType.PropertyTwo" type="PType2" minOccurs="0"/>
      <xs:element name="collection" type="CollectionType" minOccurs="0"/>
    </xs:sequence>
</xs:complexType>
<xs:complexType name="CollectionType">
    <xs:sequence>
       <xs:group ref="CollectedTypeGroup"/>
    </xs:sequence>
</xs:complexType> 
```

将事物提取到组、复杂类型等中不会帮助您解决这个问题，因为 Schema 处理器会将其展平以执行其验证。

仅供参考，[Relax NG](http://www.relaxng.org/)没有这个限制。您可以使用它的“交错”构造来定义您要查找的内容（它与模式“全部”相同，但允许无限制的子级）。

希望这可以帮助。

# python - 是否可以使用 matplotlib 在地图上绘制图像？

> ID：516935
> 
> 赞同：8
> 
> 时间：2009-02-05T17:28:10.227
> 
> 标签：python, matplotlib

使用底图很容易绘制一组坐标，如下所示：

```
x, y = m(lons, lats)    
m.plot(x, y, 'go') 
```

但是可以使用图像而不是绿色圆圈（'go'）吗？我没有从文档中找到这样做的直接方法。

所以，让我们稍微澄清一下：我正在使用以底图作为背景生成的地图，并希望在其顶部绘制一些 .png 图像，而不是常规的普通标记。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T18:47:00.427

如果您想绘制`.png`图像，那么您应该尝试[http://matplotlib.sourceforge.net/api/pyplot_api.html#matplotlib.pyplot.imshow](http://matplotlib.sourceforge.net/api/pyplot_api.html#matplotlib.pyplot.imshow)

您可能还对 Matplotlib 底图工具包感兴趣。[http://matplotlib.sourceforge.net/basemap/doc/html/](http://matplotlib.sourceforge.net/basemap/doc/html/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-18T18:41:53.623

供您参考，前几天我回答了一个类似的问题：[Python Matplotlib Basemap overlay small image on map plot](https://stackoverflow.com/questions/11487797/python-matplotlib-basemap-overlay-small-image-on-map-plot/11495585#11495585)

# nhibernate - 当数据库发生变化时，你如何管理你的 ORM 层？

> ID：516936
> 
> 赞同：3
> 
> 时间：2009-02-05T17:28:23.847
> 
> 标签：nhibernate, linq-to-sql, orm, linq-to-entities

我理解不自动刷新 .dbml (Linq2Sql)、.edmx (Linq2Entities) 或 .hbm.xml (NHibernate) 的原因。在每个 ORM 解决方案中，如果您在数据库中有更改，则需要更新这些文件。**如果你 100% 确定它不会破坏任何东西，有没有办法自动刷新这些文件？**

我相当熟悉 RoR 中的迁移。**.NET 世界中是否有可靠的迁移工具？**

一般来说，**您如何保持数据库设计的敏捷性，而不是一次又一次地手动重新创建这些映射文件？**

如果此问题重复，请提供链接。我找不到一个。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T17:33:44.507

我不确定您对更新 EDMX 的犹豫是什么。继续并从数据库中更新您的模型。很有可能它会起作用。但如果没有，只需从源代码管理中获取旧版本，然后手动进行更改。

另一方面，使用 LINQ to SQL 就更难了，因为没有更新功能。您必须从模型中删除更改的对象，重新添加它们，然后手动重新应用您所做的任何更改。同样，源代码控制在这里至关重要。您需要将 XML 文件与以前的版本进行比较，以确保您没有忘记任何内容。

我不确定您关于迁移的问题是什么意思。是的，有一个工具 (RikMigrations)，它的作用与 Rails 中的迁移类似。但是迁移当然会改变你的数据库元数据。它们不会更改您的 ORM 映射。这是在其他地方完成的，在 Rails 和 .NET 中都是如此。

# architecture - 多个 CPU 可以同时写入同一个 RAM 位置吗？

> ID：516940
> 
> 赞同：4
> 
> 时间：2009-02-05T17:30:50.750
> 
> 标签：architecture, memory, synchronization, cpu

机器字长（或更小）的写入是否序列化？只需一个本机操作码即可将寄存器内容复制到 RAM。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T18:07:12.270

将数据写入 RAM 是原子的。如果两个 CPU 尝试同时写入同一位置，内存控制器将决定写入的某些顺序。当一个 CPU 正在写入内存时，另一个 CPU 将根据需要停止尽可能多的周期，直到第一次写入完成；然后它将覆盖其值。这就是所谓的[竞态条件](http://en.wikipedia.org/wiki/Race_condition)。

小于本机字大小的写入不是原子的——在这种情况下，CPU 必须将旧内存值读入寄存器，将新字节写入寄存器，然后将新值写回内存。

你永远不应该有依赖于此的代码——如果你有多个 CPU 试图同时写入同一个内存位置，那么你做错了什么。

另一个重要的考虑因素是[缓存一致性](http://en.wikipedia.org/wiki/Cache_coherency)问题。每个 CPU 都有自己的缓存。如果一个 CPU 将数据写入其缓存，其他 CPU 需要知道该数据值的更改才能读取它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T17:33:18.780

没有什么可以阻止您在低级别上执行此操作。然而，RAM 写入是原子的，因此内存控制器将按顺序从内核执行 2 次看似相似的写入。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T17:32:37.457

两个 CPU 可以同时发出命令，但 RAM 控制器不是必须单独处理它接收到的每个命令吗？因此，也许对 CPU 来说它是同时的，但 RAM 控制器将确定首先处理谁的命令。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T17:34:34.050

它们不应该，因为如果写入不同的值，生成的 RAM 内容将是未指定的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T17:39:08.393

与直接写入 RAM 相比，本机操作码不是更有可能写入 CPU 上的缓存吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T17:59:32.410

他们可以尝试，但硬件将是最终决定因素。

# sql - Visual Studio 语法高亮

> ID：516945
> 
> 赞同：3
> 
> 时间：2009-02-05T17:31:32.683
> 
> 标签：sql, visual-studio-2008

是否有可能在 Visual Studio 2008 中获得与 SQL Server Management Studio 相同级别的语法突出显示？这是关于 T-SQL 的。

例如，SSMS 为操作数、系统函数等提供了单独的突出显示选项，而 Visual Studio 2008 似乎只有一个用于 T-SQL 的“关键字”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T18:17:03.560

不确定这是否是您正在寻找的东西，但确实有人提出了一个应用程序，该应用程序将采用您的 VS 颜色设置并将它们转换为可在 SQL Server Management Studio 中使用的设置。[你可以在这里](http://winterdom.com/weblog/2007/10/31/ColorSchemesInSQL2005ManagementStudio.aspx)找到关于它的帖子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T05:15:25.337

看到这个：[相关问题](https://stackoverflow.com/questions/505226/custom-syntax-highlighting-for-vs-2008)

为了获得更好的控制水平，您将不得不编写一个插件和一个解析器，这两者都非常棘手。

VS 2010 将具有 MEF 和 WPF，这意味着编写更改视觉效果的插件将变得更加简单。

如果您正在寻找一个更简单的框架来在 VS 2008 中编写此类内容，请查看[DXCore](http://devexpress.com/Downloads/Visual_Studio_Add-in/DXCore/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T14:56:04.927

我使用 SQL 2008 和 VS 2008 DB 专业版。我经常做的是在 SSMS 中编写 SQL 并复制粘贴到 VS。

# python - 通过COM独立控制2个单独的Excel实例...可以做到吗？

> ID：516946
> 
> 赞同：6
> 
> 时间：2009-02-05T17:32:22.183
> 
> 标签：python, windows, excel, com

我有一个遗留应用程序，它在许多 Excel 工作簿中实现。这不是我有权重新实现的东西，但是我维护的另一个应用程序确实需要能够调用 Excel 工作簿中的函数。

它被赋予了一个使用 Win32Com 库的 python 接口。其他进程可以调用我的 python 包中的函数，然后通过 Win32Com 调用我需要的函数。

不幸的是，COM 不允许我指定特定的 COM 进程，所以目前无论我的服务器多么强大，我一次只能在计算机上控制一个 Excel 实例。如果我要尝试运行多个 excel 实例，则无法确保 python 层绑定到特定的 Excel 实例。

我希望能够在我的 Windows 服务器上同时运行超过 1 个我的 excel 应用程序。有没有办法做到这一点？例如，我是否可以划分我的环境以便我可以运行我的应用程序支持的尽可能多的 Excel _ Python 组合？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-02-15T01:53:25.533

请参阅[Tim Golden 的“Starting a new instance of a COM application”](http://timgolden.me.uk/python/win32_how_do_i/start-a-new-com-instance.html)，也在[这里](http://www.thalesians.com/finance/index.php/Knowledge_Base/Python/General#Starting_a_new_instance_of_a_COM_application)引用，它给出了使用提示

```
xl_app = DispatchEx("Excel.Application") 
```

而不是

```
xl_app = Dispatch("Excel.Application") 
```

开始一个单独的过程。所以你应该能够做到：

```
xl_app_1 = DispatchEx("Excel.Application")
xl_app_2 = DispatchEx("Excel.Application")
xl_app_3 = DispatchEx("Excel.Application") 
```

**请注意**，完成后，要关闭应用程序，我发现有必要执行以下操作：

```
xl_app.Quit()
xl_app = None 
```

我发现进程不会关闭，直到`xl_app = None`，即 Python COM 对象的引用计数变为零。

**注意**我还有一个问题：当我的 Python 程序运行时，如果我在资源管理器中双击一个 Excel 文件（至少在 Win2k 上），它最终会在 Python 启动的现有 Excel 进程中打开该文件（其中正在运行隐藏），这会破坏 Python 程序。我还没有找到解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T21:19:34.567

不幸的是，我对 Python 一无所知，但如果它通过 COM 工作，Excel 就不是单实例应用程序，因此您应该能够在内存允许的情况下创建尽可能多的 Excel 实例。

使用 C#，您可以通过以下方式创建多个 Excel 应用程序实例：

```
Excel.Application xlApp1 = new Excel.Application();
Excel.Application xlApp2 = new Excel.Application();
Excel.Application xlApp3 = new Excel.Application(); 
```

在 C# 中使用后期绑定，您可以使用：

```
object objXL1 = Activator.CreateInstance(Type.GetTypeFromProgID("Excel.Application"));
object objXL2 = Activator.CreateInstance(Type.GetTypeFromProgID("Excel.Application"));
object objXL3 = Activator.CreateInstance(Type.GetTypeFromProgID("Excel.Application")); 
```

如果使用 VB.NET、VB6 或 VBA，您可以使用 CreateObject，如下所示：

```
Dim objXL1 As Object = CreateObject("Excel.Application")
Dim objXL2 As Object = CreateObject("Excel.Application")
Dim objXL3 As Object = CreateObject("Excel.Application") 
```

不幸的是，在 Python 中，我没有任何线索。但除非 Python 有一些限制（我无法想象？），否则我会认为它非常可行。

也就是说，让多个 Excel 实例充当某种服务器以进行其他操作的想法听起来很危险......我会小心测试你在做什么，特别是关于你可以打开多少个实例一次不会耗尽内存，如果 Excel 由于某种原因崩溃，调用程序会发生什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T17:42:57.093

如果您的应用程序使用包含您调用的宏的单个 excel 文件，我担心答案可能是否定的，因为除了 COM Excel 不允许以相同的名称打开相同的文件（即使在不同的目录中）。您可以通过在打开之前将文件动态复制到另一个名称来解决此问题。

我的 python 知识并不丰富，但在大多数语言中，有一种方法可以指定何时创建 COM 对象是希望它是新对象还是默认连接到预先存在的实例。检查 python 文档以了解这些方面的内容。

您能否列出您遇到的具体问题以及您希望做什么？

# java - 如何使用 spring-modules 为 OSCache 中的对象设置缓存时间？

> ID：516948
> 
> 赞同：0
> 
> 时间：2009-02-05T17:32:57.113
> 
> 标签：java, spring, caching, ehcache, oscache

我有一个需要一些缓存的应用程序，对于一些半静态数据，我希望它们在刷新之前在缓存中停留最长时间（例如 10 分钟）。我的系统只是检索数据，从不更新它，所以我不知道何时使用该属性刷新缓存。在 OSCache 文档中，可以使用编程 API 和 taglib 的配置来设置这样的到期时间，但 spring-modules 文档对此事没有提及。

有谁知道是否/如何做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-22T14:32:43.090

看看 [https://springmodules.dev.java.net/docs/reference/0.8/html/cache.html](https://springmodules.dev.java.net/docs/reference/0.8/html/cache.html)

3.5.2\. 缓存模型他们提供了一个例子 org.springmodules.cache.provider.jcs.JcsCachingModel

尝试使用 org.springmodules.cache.provider.oscache.OsCacheCachingModel

[来自http://www.koders.com/java/fidB7163A5070666F5BD98F43D4324011D1A969ABD3.aspx?s=mcall%3Astring](http://www.koders.com/java/fidB7163A5070666F5BD98F43D4324011D1A969ABD3.aspx?s=mcall%3Astring)的源代码 给了我属性

私有字符串 cronExpression；

私有字符串 [] 组；

私有整数刷新周期；

所以你需要设置“refreshPeriod”属性

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-09-14T13:17:51.113

我想到了。答案隐藏在 ehcache 自己的配置文件中。通过将属性“timeToLiveSeconds”设置为例如“600”，缓存中的元素将在十分钟后过期。

# javascript - 如何在javascript中将页面的全部内容作为字符串获取？

> ID：516951
> 
> 赞同：2
> 
> 时间：2009-02-05T17:33:32.463
> 
> 标签：javascript

我正在编写一个书签，即包含 javascript 而不是 URL 的书签，我遇到了一些麻烦。事实上，我不记得如何将页面内容作为字符串获取，因此我可以应用正则表达式来查找我想要的内容。你能帮我解决这个问题吗？

在有人建议之前，我不能使用 getElementBy(Id/Name/Tag)，因为我要查找的数据是 HTML 注释和内部标记，所以我认为这行不通。

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-05T17:37:40.660

您可以通过以下方式访问它：

```
document.body.innerHTML 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T18:18:47.690

> 所以我可以应用正则表达式来找到我想要的

做。不是。采用。正则表达式。到。解析。HTML。

特别是当浏览器已经为您解析它时！来吧！

> 我正在寻找的数据是 HTML 注释的

您可以很好地从 DOM 中获取评论内容。例如。

```
<div id="mything"><!-- la la la I'm a big comment --></div>

alert(document.getElementById('mything').firstChild.data); 
```

如果您需要在 DOM 中搜索评论元素：

```
// Get comment descendents
//
function dom_getComments(parent, recurse) {
    var results= [];
    for (var childi= 0; childi<parent.childNodes.length; childi++) {
        var child= parent.childNodes[childi];
        if (child.nodeType==8) // Node.COMMENT_NODE
            results.push(child);
        else if (recurse && child.nodeType==1) // Node.ELEMENT_NODE
            results= results.concat(dom_getComments(child));
    }
    return results;
} 
```

# c# - 缩放到c#中的一个点

> ID：516958
> 
> 赞同：3
> 
> 时间：2009-02-05T17:35:49.417
> 
> 标签：c#, graphics, gdi+

我正在尝试编写一个自定义可滚动 c# 控件，该控件可以缩放到图像上的特定点。我面临的问题是，当启用双缓冲时，图像似乎向左上角猛拉，然后正确缩放到单击鼠标的位置。这似乎只在我设置 AutoScrollPosition 时发生。我证实它不会发生在我的 OnPaint 方法中。这似乎是我无法追踪的一些内部行为。有没有人解决这个问题？

这是一些示例代码，演示了我要完成的工作。当图像相当大时，该问题似乎只对用户显着呈现。

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Windows.Forms;
using System.Drawing.Imaging;
using System.Drawing.Drawing2D;
using System.Drawing;

namespace Zoom
{
    public class PointZoom : ScrollableControl
    {
        #region Private Data
        private float _zoom = 1.0f;
        private PointF _origin = PointF.Empty;
        private Image _image;
        private Matrix _transform = new Matrix();
        #endregion

        public PointZoom() {
            SetStyle(ControlStyles.UserPaint, true);
            SetStyle(ControlStyles.AllPaintingInWmPaint, true);
            SetStyle(ControlStyles.OptimizedDoubleBuffer, true);
            this.AutoScroll = true;
            UpdateScroll();
        }

        public Image Image {
            get {
                return _image;
            }
            set {
                _image = value;
                _origin = PointF.Empty;
                _zoom = 1.0F;
                UpdateScroll();
                Invalidate();
            }
        }

        protected override void OnPaintBackground(PaintEventArgs e) {
            // don't allow the background to be painted            
        }

        protected override void OnPaint(PaintEventArgs e) {

            Graphics g = e.Graphics;

            ClearBackground(g);            

            float dx = -_origin.X;
            float dy = -_origin.Y;

            _transform = new Matrix(_zoom, 0, 0, _zoom, dx, dy);
            g.Transform = _transform;

            DrawImage(g);
        }

        private void ClearBackground(Graphics g) {
            g.Clear(SystemColors.Window);
        }

        protected override void OnScroll(ScrollEventArgs se) {
            if (se.ScrollOrientation == ScrollOrientation.HorizontalScroll) {
                _origin.X += se.NewValue - se.OldValue;
            }
            else {
                _origin.Y += se.NewValue - se.OldValue;
            }
            Invalidate();
            base.OnScroll(se);
        }

        protected override void OnMouseClick(MouseEventArgs e) {
            ZoomToPoint(e.Location);
            Invalidate();
        }

        private void UpdateScroll() {

            if (_image != null) {

                Size scrollSize = new Size(
                    (int)Math.Round(_image.Width * _zoom),
                    (int)Math.Round(_image.Height * _zoom));
                Point position = new Point(
                    (int)Math.Round(_origin.X),
                    (int)Math.Round(_origin.Y));

                this.AutoScrollPosition = position;
                this.AutoScrollMinSize = scrollSize;
            }
            else {
                this.AutoScrollMargin = this.Size;
            }

        }

        private void ZoomToPoint(Point viewPoint) {

            PointF modelPoint = ToModelPoint(viewPoint);

            // Increase the zoom 
            _zoom *= 1.25F;

            // calculate the new origin
            _origin.X = (modelPoint.X * _zoom) - viewPoint.X;
            _origin.Y = (modelPoint.Y * _zoom) - viewPoint.Y;

            UpdateScroll();
        }

        private PointF ToModelPoint(Point viewPoint) {
            PointF modelPoint = new PointF();

            modelPoint.X = (_origin.X + viewPoint.X) / _zoom;
            modelPoint.Y = (_origin.Y + viewPoint.Y) / _zoom;

            return modelPoint;
        }

        private void DrawImage(Graphics g) {
            if (null != _image) {
                // set the transparency color for the image
                ImageAttributes attr = new ImageAttributes();
                attr.SetColorKey(Color.White, Color.White);
                Rectangle destRect = new Rectangle(0, 0, _image.Width, _image.Height);
                g.DrawImage(_image, destRect, 0, 0, _image.Width, _image.Height, GraphicsUnit.Pixel, attr);
            }
        }

        protected override void Dispose(bool disposing) {
            if (disposing) {
                if (null != _image) {
                    _image.Dispose();
                    _image = null;
                }
            }
            base.Dispose(disposing);
        }
    }

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T14:14:50.320

试试下面的。这是我为工作中的一个项目而写的。我去掉了一些额外的功能，但这里还有更多需要回答您的问题。需要特别注意的是 CenterOn 和 Zoom 方法。另请注意，我没有清除背景，而是先绘制背景。Clear对我也有奇怪的副作用。我也继承了对我最有效的 Panel。随意将其转换为 C#。

```
Imports System.Drawing.Drawing2D
Imports System
Imports System.Collections
Imports System.ComponentModel
Imports System.Data
Imports System.Drawing
Imports System.Drawing.Imaging
Imports System.IO
Imports System.Runtime.InteropServices
Imports System.Windows.Forms

Public Class ctlViewer
   Inherits Panel

   Protected Const C_SmallChangePercent As Integer = 2
   Protected Const C_LargeChangePercent As Integer = 10

   Protected mimgImage As Image
   Protected mintActiveFrame As Integer
   Protected mdecZoom As Decimal
   Protected mpntUpperLeft As New Point
   Protected mpntCenter As New Point
   Protected mblnDragging As Boolean = False
   Private mButtons As MouseButtons

#Region " Constructor"
   Public Sub New()
      MyBase.New()
      Me.SetStyle(ControlStyles.ContainerControl, False)
      Me.SetStyle(ControlStyles.AllPaintingInWmPaint, True)
      Me.SetStyle(ControlStyles.UserPaint, True)
      Me.SetStyle(ControlStyles.ResizeRedraw, True)
      Me.SetStyle(ControlStyles.UserPaint, True)
      Me.SetStyle(ControlStyles.DoubleBuffer, True)
      ZoomFactor = 1.0
      Me.AutoScroll = True
      Me.BackColor = Color.FromKnownColor(KnownColor.ControlDark)
   End Sub
#End Region

#Region " Properties"

   ''' <summary>
   ''' Image object representing the TIFF image.
   ''' </summary>
   ''' <value></value>
   ''' <returns></returns>
   ''' <remarks></remarks>
   Public Property Image() As Image
      Get
         Return mimgImage
      End Get
      Set(ByVal Value As Image)
         AutoScrollPosition = New Point(0, 0)
         mimgImage = Value
         RaiseEvent ImageLoaded(New ImageLoadedEventArgs(Value))
         UpdateScaleFactor()
         Invalidate()
      End Set
   End Property

   ''' <summary>
   ''' Viewing area of image
   ''' </summary>
   ''' <value></value>
   ''' <returns></returns>
   ''' <remarks></remarks>
   Public ReadOnly Property ViewPort() As Rectangle
      Get
         Dim r As New Rectangle
         Dim pul As Point = Me.CoordViewerToSrc(New Point(0, 0))
         Dim pbr As Point = Me.CoordViewerToSrc(New Point(Me.Width, Me.Height))
         r.Location = pul
         r.Width = pbr.X - pul.X
         r.Height = pbr.Y - pul.Y
         Return r
      End Get
   End Property

   ''' <summary>
   ''' Gets or sets the zoom / scale factor for the image being displayed.
   ''' </summary>
   ''' <value></value>
   ''' <returns></returns>
   ''' <remarks></remarks>
   Public Property ZoomFactor() As Decimal
      Get
         Return mdecZoom
      End Get
      Set(ByVal Value As Decimal)
         If Value < 0 OrElse Value < 0.00001 Then
            Value = 0.00001F
         End If
         mdecZoom = Value
         UpdateScaleFactor()
         Invalidate()
         RaiseEvent ZoomChanged(New ImageViewerEventArgs(Me.Image))
      End Set
   End Property

#End Region

#Region " Event Signatures"
   Public Event ImageMouseDown(ByVal e As ImageMouseEventArgs)
   Public Event ImageMouseMove(ByVal e As ImageMouseEventArgs)
   Public Event ImageMouseUp(ByVal e As ImageMouseEventArgs)
   Public Event ImageLoaded(ByVal e As ImageLoadedEventArgs)
   Public Event ZoomChanged(ByVal e As ImageViewerEventArgs)
   Public Event ImageViewPortChanged(ByVal e As ImageViewerEventArgs)

   Public Event ViewerPaint(ByVal sender As Object, ByVal e As PaintEventArgs)
#End Region

#Region " Public Subs/Functions"

   ''' <summary>
   ''' Pans the viewer by X,Y up to the bounds of the image.
   ''' </summary>
   ''' <param name="x"></param>
   ''' <param name="y"></param>
   ''' <remarks></remarks>
   Public Sub Pan(ByVal x As Integer, ByVal y As Integer)
      Me.AutoScrollPosition = New Point(Math.Abs(Me.AutoScrollPosition.X) + x, Math.Abs(Me.AutoScrollPosition.Y) + y)
      Me.Invalidate()
   End Sub

   ''' <summary>
   ''' Zoom image
   ''' </summary>
   ''' <param name="decZoom"></param>
   ''' <remarks></remarks>
   Public Sub Zoom(ByVal decZoom As Decimal)
      ZoomFactor = decZoom
   End Sub

   ''' <summary>
   ''' Zoom image and scroll to rectangle coordinates.
   ''' </summary>
   ''' <param name="decZoomFactor"></param>
   ''' <param name="objRectangleToCenter"></param>
   ''' <remarks></remarks>
   Public Sub Zoom(ByVal decZoomFactor As Decimal, ByVal objRectangleToCenter As Rectangle)
      Dim intCenterX As Int32 = objRectangleToCenter.X + objRectangleToCenter.Width / 2
      Dim intCenterY As Int32 = objRectangleToCenter.Y + objRectangleToCenter.Height / 2
      Me.CenterOn(New Point(intCenterX, intCenterY))
      Me.ZoomFactor = decZoomFactor
   End Sub

   ''' <summary>
   ''' Zoom to fit image on screen.
   ''' </summary>
   ''' <param name="minZoom"></param>
   ''' <param name="maxZoom"></param>
   ''' <remarks></remarks>
   Public Sub ZoomToFit(ByVal minZoom As Decimal, ByVal maxZoom As Decimal)
      If Not Me.Image Is Nothing Then
         Dim ItoVh As Single = Me.Image.Height / (Me.Height - 2)
         Dim ItoVw As Single = Me.Image.Width / (Me.Width - 2)
         Dim zf As Single = 1 / Math.Max(ItoVh, ItoVw)
         If (((zf > minZoom) And minZoom <> 0) Or minZoom = 0) _
               And ((zf < maxZoom) And maxZoom <> 0) Or maxZoom = 0 Then
            Me.Zoom(zf)
         End If
      End If
   End Sub

   ''' <summary>
   ''' Zoom to fit width of image
   ''' </summary>
   ''' <param name="minZoom"></param>
   ''' <param name="maxZoom"></param>
   ''' <remarks></remarks>
   Public Sub ZoomToWidth(ByVal minZoom As Decimal, ByVal maxZoom As Decimal)
      If Image Is Nothing Then
         Me.AutoScrollMargin = Me.Size
         Me.AutoScrollMinSize = Me.Size

         mpntCenter = New Point(0, 0)
         mpntUpperLeft = New Point(0, 0)
         Exit Sub
      End If
      Dim intOff As Integer = 0
      If ScrollStateVScrollVisible Then
         intOff = ScrollStateVScrollVisible
      End If
      Dim ItoVw As Single = Me.Image.Width / (Me.Width - 2)
      Dim zf As Single = 1 / ItoVw
      If (Me.Image.Height * zf) >= Me.Height Then
         ItoVw = Me.Image.Width / (Me.Width - 22)
         zf = 1 / ItoVw
      End If
      If (((zf > minZoom) And minZoom <> 0) Or minZoom = 0) _
            And ((zf < maxZoom) And maxZoom <> 0) Or maxZoom = 0 Then
         Me.Zoom(zf)
      End If
   End Sub

   ''' <summary>
   ''' Adjust scrollbars to zoomed size of image
   ''' </summary>
   ''' <remarks></remarks>
   Protected Sub UpdateScaleFactor()
      If Image Is Nothing Then
         Me.AutoScrollMargin = Me.Size
         Me.AutoScrollMinSize = Me.Size

         mpntCenter = New Point(0, 0)
         mpntUpperLeft = New Point(0, 0)
      Else
         Me.AutoScrollMinSize = New Size(CInt(Me.Image.Width * ZoomFactor + 0.5F), CInt(Me.Image.Height * ZoomFactor + 0.5F))
      End If
      Me.HorizontalScroll.LargeChange = Me.Size.Width * (C_LargeChangePercent / 100)
      Me.VerticalScroll.LargeChange = Me.Size.Height * (C_LargeChangePercent / 100)
      Me.HorizontalScroll.SmallChange = Me.Size.Width * (C_SmallChangePercent / 100)
      Me.VerticalScroll.SmallChange = Me.Size.Height * (C_SmallChangePercent / 100)
   End Sub

   ''' <summary>
   ''' Convert a point of the original image to screen coordinates adjusted for zoom and pan.
   ''' </summary>
   ''' <param name="pntPoint"></param>
   ''' <returns></returns>
   ''' <remarks></remarks>
   Public Function CoordSrcToViewer(ByVal pntPoint As Point) As Point
      Dim pntResult As New Point
      pntResult.X = pntPoint.X * Me.ZoomFactor + Me.AutoScrollPosition.X
      pntResult.Y = pntPoint.Y * Me.ZoomFactor + Me.AutoScrollPosition.Y
      Return pntResult
   End Function

   ''' <summary>
   ''' Convert a screen point to the corrseponding coordinate of the original image.
   ''' </summary>
   ''' <param name="pntPoint"></param>
   ''' <returns></returns>
   ''' <remarks></remarks>
   Public Function CoordViewerToSrc(ByVal pntPoint As Point) As Point
      Dim pntResult As New Point
      pntResult.X = (pntPoint.X - Me.AutoScrollPosition.X) / Me.ZoomFactor
      pntResult.Y = (pntPoint.Y - Me.AutoScrollPosition.Y) / Me.ZoomFactor
      Return pntResult
   End Function

   ''' <summary>
   ''' Returns an offset needed to move the center point to make visible.
   ''' </summary>
   ''' <param name="imagePoint"></param>
   ''' <returns></returns>
   ''' <remarks></remarks>
   Friend Function PointIsVisible(ByVal imagePoint As Point) As Point
      Dim pntViewer As Point = Me.CoordSrcToViewer(imagePoint)
      Dim pntSize As New Point((pntViewer.X - Me.Width) / Me.ZoomFactor, (pntViewer.Y - Me.Height) / Me.ZoomFactor)
      If pntViewer.X > 0 And pntViewer.X < Me.Width Then
         pntSize.X = 0
      End If
      If pntViewer.Y > 0 And pntViewer.Y < Me.Height Then
         pntSize.Y = 0
      End If
      If pntViewer.X < 0 Then
         pntSize.X = pntViewer.X
      End If
      If pntViewer.Y < 0 Then
         pntSize.Y = pntViewer.Y
      End If
      Return pntSize
   End Function

   ''' <summary>
   ''' Centers view on coordinates of the original image.
   ''' </summary>
   ''' <param name="X"></param>
   ''' <param name="Y"></param>
   ''' <remarks></remarks>
   Public Sub CenterOn(ByVal X As Integer, ByVal Y As Integer)
      CenterOn(New Point(X, Y))
   End Sub

   ''' <summary>
   ''' Centers view on a point of the original image.
   ''' </summary>
   ''' <param name="pntCenter"></param>
   ''' <remarks></remarks>
   Public Sub CenterOn(ByVal pntCenter As Point)
      Dim midX As Integer = Me.Width / 2
      Dim midY As Integer = Me.Height / 2
      Dim intX As Integer = (pntCenter.X * ZoomFactor - midX)
      Dim intY As Integer = (pntCenter.Y * ZoomFactor - midY)
      Me.AutoScrollPosition = New Point(intX, intY)
      Me.Invalidate()
   End Sub

   ''' <summary>
   ''' Returns image coordinate which is centered in viewer.
   ''' </summary>
   ''' <returns></returns>
   ''' <remarks></remarks>
   Public Function GetCenterPoint() As Point
      Dim pntResult As Point
      pntResult = CoordViewerToSrc(New Point(Me.Width / 2, Me.Height / 2))
      If pntResult.X > Me.Image.Width Or pntResult.Y > Image.Height Then
         pntResult = Nothing
      End If
      Return pntResult
   End Function

   ''' <summary>
   ''' Fire viewport changed event.
   ''' </summary>
   ''' <remarks></remarks>
   Private Sub FireViewPortChangedEvent()
      Dim e As New ImageViewerEventArgs(Me.Image)
      RaiseEvent ImageViewPortChanged(e)
   End Sub
   Private Sub FireViewerPaintEvent(ByVal e As PaintEventArgs)
      RaiseEvent ViewerPaint(Me, e)
   End Sub
#End Region

#Region " Overrides"

   ''' <summary>
   ''' Paint image in proper position and zoom.  All work is done with a Matrix object.
   ''' The coordinates of the graphics instance of the ctlViewer_OnPaint event 
   ''' are transformed.  This allows drawing on the "paper image" rather than "over the viewport"
   ''' </summary>
   ''' <param name="e"></param>
   ''' <remarks></remarks>
   Protected Overrides Sub OnPaint(ByVal e As System.Windows.Forms.PaintEventArgs)
      If mimgImage Is Nothing Then
         MyBase.OnPaintBackground(e)
         Return
      Else
         Debug.WriteLine("ctl painting")
         Dim mx As New Matrix
         e.Graphics.FillRectangle(New SolidBrush(Me.BackColor), 0, 0, Me.Width, Me.Height)
         mx.Translate(Me.AutoScrollPosition.X, Me.AutoScrollPosition.Y)
         mx.Scale(ZoomFactor, ZoomFactor)
         e.Graphics.SetClip(New Rectangle(0, 0, Me.Width, Me.Height))
         e.Graphics.InterpolationMode = InterpolationMode.Low
         e.Graphics.SmoothingMode = SmoothingMode.HighSpeed
         e.Graphics.Transform = mx
         Dim ia As New ImageAttributes
         e.Graphics.DrawImage(Image, _
             New Rectangle(-Me.AutoScrollPosition.X / ZoomFactor, _
             -Me.AutoScrollPosition.Y / ZoomFactor, _
              Me.Width / ZoomFactor, _
              Me.Height / ZoomFactor), _
              Me.ViewPort.Left, Me.ViewPort.Top, Me.ViewPort.Width, Me.ViewPort.Height, _
             GraphicsUnit.Pixel, ia)
         ia.Dispose()
      End If
      Me.mpntCenter = Me.GetCenterPoint
      FireViewPortChangedEvent()
      MyBase.OnPaint(e)
      e.Graphics.ResetClip()
      e.Graphics.ResetTransform()
      Me.FireViewerPaintEvent(e)

   End Sub

   ''' <summary>
   ''' Pan image and raise event.
   ''' </summary>
   ''' <param name="e"></param>
   ''' <remarks></remarks>
   Protected Overrides Sub OnMouseDown(ByVal e As System.Windows.Forms.MouseEventArgs)
      Me.mButtons = e.Button
      RaiseEvent ImageMouseDown(New ImageMouseEventArgs(e.Button, e.Clicks, e.X, e.Y, e.Delta, Me.ZoomFactor, Me.AutoScrollPosition))
      MyBase.OnMouseDown(e)
   End Sub

   ''' <summary>
   ''' Stop panning image and raise event.
   ''' </summary>
   ''' <param name="e"></param>
   ''' <remarks></remarks>
   Protected Overrides Sub OnMouseUp(ByVal e As System.Windows.Forms.MouseEventArgs)
      Me.Cursor = Cursors.Arrow
      MyBase.OnMouseUp(e)

      RaiseEvent ImageMouseUp(New ImageMouseEventArgs(e.Button, e.Clicks, e.X, e.Y, e.Delta, Me.ZoomFactor, Me.AutoScrollPosition))
      Me.mButtons = Windows.Forms.MouseButtons.None
   End Sub

   ''' <summary>
   ''' Pan image if PanOnMouseMove is True.  Fire the ImageMouseMove event.
   ''' </summary>
   ''' <param name="e"></param>
   ''' <remarks></remarks>
   Protected Overrides Sub OnMouseMove(ByVal e As System.Windows.Forms.MouseEventArgs)
      Static oldX As Integer
      Static oldy As Integer
      Try
         oldX = e.X
         oldy = e.Y
      Catch ex As Exception
         Throw ex
      Finally
         MyBase.OnMouseMove(e)
         RaiseEvent ImageMouseMove(New ImageMouseEventArgs(Me.mButtons, e.Clicks, e.X, e.Y, e.Delta, Me.ZoomFactor, Me.AutoScrollPosition))
      End Try
   End Sub

   ''' <summary>
   ''' Catch a panel scroll event.
   ''' </summary>
   ''' <param name="m"></param>
   ''' <remarks></remarks>
   Protected Overrides Sub WndProc(ByRef m As System.Windows.Forms.Message)
      Const WM_VSCROLL As Integer = 277 '115 hex
      Const WM_HSCROLL As Integer = 276 '0x114;
      MyBase.WndProc(m)
      If Not m.HWnd.Equals(Me.Handle) Then
         Return
      End If
      If m.Msg = WM_VSCROLL Or m.Msg = WM_HSCROLL Then
         Me.Invalidate()
      End If
   End Sub
#End Region
End Class 
```

# c# - 为什么我必须指定所有泛型类型参数？

> ID：516964
> 
> 赞同：3
> 
> 时间：2009-02-05T17:36:49.443
> 
> 标签：c#, generics

C# 是否有任何（技术）原因要求所有泛型类型参数都用它们的封闭类名称声明？

例如，我想声明：

```
public class FruitCollection<TFruit> : FoodCollection<TFoodGroup>
    where TFruit : IFood<TFoodGroup>
    where TFoodGroup : IFoodGroup { }

public class AppleCollection : FruitCollection<Apple> { }
public class TomatoCollection : FruitCollection<Tomato> { } 
```

`TFruit`是一个`IFood<TFoodGroup>`，所以`TFoodGroup` *必须*定义如果`TFruit`提供，即使我没有明确声明它。

相反，我必须这样做：

```
public class FruitCollection<TFoodGroup, TFruit> : FoodCollection<TFoodGroup>
    where TFruit : IFood<TFoodGroup>
    where TFoodGroup : IFoodGroup { }

// Anything other than FruitGroup is an error when combined with Apple
public class AppleCollection : FruitCollection<FruitGroup, Apple> { }

// Anything other than VegetableGroup is an error when combined with Tomato
public class TomatoCollection : FruitCollection<VegetableGroup, Tomato> { } 
```

第二种方法工作得很好，可以防止编译任何无效的组合，但是随着越来越多的不必要的泛型类型声明被添加到参数列表中，它开始变得混乱。

* * *

集合中的其他定义是：

```
public interface IFoodGroup { }
public class FruitGroup : IFoodGroup { }
public class VegetableGroup : IFoodGroup { }

public interface IFood<TFoodGroup> where TFoodGroup : IFoodGroup { }
public class Apple : IFood<FruitGroup> { }
public class Tomato : IFood<VegetableGroup> { }

public abstract class FoodCollection<TFoodGroup> where TFoodGroup : IFoodGroup { } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T17:45:51.440

假设我定义：

```
public class Wompom : IFood<VegetableGroup>, IFood<FruitGroup>
{
} 
```

什么`FruitCollection<Wompom>`意思？

当所有内容都明确指定时：

*   编译器不必执行那么复杂的推理
*   该语言不必执行那么多复杂的规则
*   你不能进入那么多奇怪的、不可能的情况

# c# - 使用 .net(C#) 在 Visual Studio 中更新系统时间

> ID：516977
> 
> 赞同：0
> 
> 时间：2009-02-05T17:39:13.963
> 
> 标签：c#, .net, visual-studio

如何使用带有 C#(.Net) 的 Visual Studio 更新系统时间？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T17:45:22.437

这应该有效。

```
Process.Start("time", "12:00:00"); 
```

# c# - SOAP 到流到字符串

> ID：516978
> 
> 赞同：1
> 
> 时间：2009-02-05T17:40:46.817
> 
> 标签：c#, serialization, soap

我有一个想要作为字符串捕获的 SOAP 对象。这就是我现在所拥有的：

```
RateRequest request = new RateRequest();
//Do some stuff to request here

SoapFormatter soapFormat = new SoapFormatter();
using (MemoryStream myStream = new MemoryStream())
{
  soapFormat.Serialize(myStream, request);
  myStream.Position = 0;
  using (StreamReader sr = new StreamReader(myStream))
  {
    string reqString = sr.ReadToEnd();
  }
} 
```

有没有更优雅的方法来做到这一点？我不太关心生成的字符串格式 - 只是为了它是人类可读的。XML 很好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T18:42:14.367

不，这几乎就是这样做的方法。您总是可以将其分解为可以为您完成这项工作的方法，然后您可以将其减少为您需要的单个调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-31T20:22:26.453

我想你也可以这样做：

soapFormat.Serialize(myStream, request); 字符串 xml=System.Text.ASCIIEncoding.ASCII.GetString(myStream.GetBuffer());

# visual-studio - Iron Python 已安装但 VS08 中缺少项目类型

> ID：516987
> 
> 赞同：1
> 
> 时间：2009-02-05T17:43:35.110
> 
> 标签：visual-studio, visual-studio-2008, ironpython

我从 Codeplex ( [http://www.codeplex.com/IronPython/Release/ProjectReleases.aspx?ReleaseId=8365](http://www.codeplex.com/IronPython/Release/ProjectReleases.aspx?ReleaseId=8365) ) 安装 IronPython.msi 并希望在我去创建一个新的 VS08 (专业) 中看到 IronPython 的条目项目，但未列出。

这个安装在哪里以及在我的系统中添加了什么？

我错过了什么吗？

C

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T17:51:45.203

尝试安装[IronPython Studio](http://www.codeplex.com/IronPythonStudio)。小心 - 它似乎使用的是旧版本的 IronPython。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T01:11:57.247

IronPython 没有任何 VS 集成。您问题中的链接只是安装命令行工具。默认文件夹是 ProgramFiles 下的 IronPython 2.0。这是唯一安装在您的机器上的东西。

我不确定@gimel 指出的 IronPython Studio 是否支持 IPy 2.0 - 可能不支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-17T17:42:23.473

IronPython 的最新版本（撰写本文时为[2.7 Beta 1](http://ironpython.codeplex.com/releases/view/48818)）包括对 Visual Studio 2010 的支持，但不包括早期版本。

# design-patterns - 如何灵活存储一个产品的多个价格？

> ID：516989
> 
> 赞同：3
> 
> 时间：2009-02-05T17:43:59.540
> 
> 标签：design-patterns, architecture, e-commerce, wizard, shop

我想建立一个商店，其中的产品有一个小向导，然后通过它来确定价格。在这种情况下，我说的是印刷产品。

因此，对于（一个小）示例，当您来到商店并想要打印名片时，您可以决定是否要打印黑白或彩色，如果您想选择厚纸还是薄纸，如果您愿意打印 100、200、500 或 1000 件等。

毕竟会有一个价格让我们说：黑白，厚纸，200张=> 40，-$

实际上，您有更多选择可供选择。因此，您可以认为有很多价格，**没有公式**。

所以我的问题是：我该如何处理价格？

我的第一个想法：装饰器模式。

但是当我想到它时，这不是一个好主意。正如我所说，没有真正的公式，我还必须生成向导（如果您想打印贺卡，可能会有所不同）。此外，我希望能够通过管理界面更改价格或添加产品或添加新的“决定”，例如“你想要光面纸吗？” 到产品或删除一个（并且仍然保持价格不变）。

所以现在我正在考虑为每个产品使用一棵树，我可以在其中添加一个级别（一个新的决定）、度假村级别等等。

另一个想法是通过决策构建某种关键对象并在价格表中查找价格。有点像字典，我在其中添加决策，毕竟我从中生成一个键来查找价格表中的价格。

所以在原型设计之前，我想知道我是否只是盲人，我没有看到明显的解决方案，或者也许还有另一种我不知道的更优雅的方法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-05T18:28:29.403

嗯，我的想法很复杂，但你的愿望也很复杂。

您所描述的向导的问题是，在他们做出所有选择之后，他们可能想回到＃2并更改一件事以查看它如何改变价格 - 但是您构建向导的方式可能会影响以后是否可以做出选择，并导致您必须为每个产品自定义一组相当复杂的代码 - 而不是将所有内容都很好地存储在数据库中，以便代码可以完成所需的一切，并且任何产品更改都会进行进入数据库，而不是代码更改。

首先，您需要了解您有定价逻辑，理想情况下这将与演示分开。换句话说，您应该能够向一个客户展示一步一步的向导，向另一个客户展示带有复选框选项和字段的单个页面，并让他们以相同的限制构建相同的东西。

尽量避免设计数据库，这样你就不能做其中之一。换句话说，如果您执行“选择您自己的冒险”风格的向导，您将限制未来的选择（和客户的灵活性）。原因是如果我经过 10 个步骤，然后更改第 2 步，我必须再经过 8 个步骤 - 如果您保证我没有重复我已经做出的选择，这可能会很好，但如果我是只改变纸张颜色我不想再做同样的 8 个选择。如果您确实走这条路，请确保您保留很多状态，以便他们之前所做的选择在下次显示为默认值。

我会考虑在数据库中再增加一层抽象。我不想指定用户可以选择的树中的路径，而是希望看到一个矩阵，其中每个选项、产品和流程都显示出兼容性。

例如，我有 3 种纸张类型、3 种颜色和 3 种工艺：

*   纸

    *   光
    *   常规的
    *   卡片
*   颜色

    *   红色的
    *   蓝色的
    *   绿
*   过程

    *   打印
    *   折叠
    *   绑定

然后我会为每场比赛定价：

```
 Light   Regular Card    Red     Blue    Green   Print   Fold    Bind
Light                           0.05    0.05            0.001           0.50
Regular                         0.06    0.05    0.07    0.001   0.02    0.80
Card                                    0.06            0.002           0.90
Print                                                   0.002   
Fold                                                            
Bind 
```

空格表示不能混合的项目。
值得注意的条目：

*   打印和打印相结合 - 双面打印更频繁地磨损/堵塞机器。
*   您不能将物品多次通过折叠机（折叠操作为空白） - 但您可以列出不同类型的折叠以及它们适用的纸张
*   您不能绑定折叠的项目
*   我没有复制矩阵中的项目（即浅色纸打印与打印浅色纸相同 - 取决于您如何制作您想要表示的查询，或者以无关紧要的方式形成表格)

这只是一个简单化身的示例 - 每个价格实际上都是指向另一个表的链接，如果数量在一定范围内（即 100 可能比 10 便宜），则该表给出每个价格。它还适用于每张纸、每次操作或每个订单的费用 - 这可能会叠加（因此您可能需要为每张纸收取 0.001 的装订费以考虑刀具的磨损，以及 0.50每本装订书的单件价格，然后总共 5 美元的装订操作安装费）

考虑到你拥有的东西数量之多，你可以做其他事情，这将很快变得相当复杂。

但是一旦输入数据，它将为您提供无限的灵活性来指定成本并将其呈现给用户。例如，您可能会发现，值得将每种不同型号的打印机放在自己的列中（而不是将它们都称为打印机），并根据纸张类型、颜色和打印​​操作为客户找到最低的打印价格.

您还可以用劳动力（时间）填写矩阵，以便您可以在与价格估算相同的地方给出时间估算。

无论您是制作向导，还是一次显示页面上的所有内容，这个后端都将支持它。看看戴尔为笔记本电脑配置做了什么——你不能用其他东西来获得某些东西。因此，如果您在页面上显示所有选项，那么当它们从普通纸变为卡片纸时，您可以提醒他们：“您还选择了折叠，这与卡片纸不兼容。您确定要这样做吗？改变？”

但首先也是最重要的 - 编写用例并首先将系统设计为一个整体。如果您现在开始编写如此复杂的东西，您现在将做出决定，以后将很难撤消，但您稍后会发现您必须进行重大更改，或者在功能上妥协。

当然，选择你自己的冒险风格设计和开发要容易得多，唯一的问题是如果你添加一个新的流程或论文，你可能需要更新 200 棵树，并添加 50 棵新树。商店的每一次变化都需要推出新的数据库（可能还有软件），这会延迟资本支出的回报。如果您预先使其非常灵活，那么现在会更难，以后会更容易/更快。

此外，您不会将客户限制在树形选项中 - 如果他们真的想通过 4 色印刷机在一侧打印，而在另一侧使用廉价复印机进行打印，如果工艺和材料兼容，他们可以探索该选项。过去 20 个产品/流程，您无法真正完全填写树。

最后，它可以让您非常非常精细地控制成本。如果您的业务流程在细粒度级别跟踪机器使用和成本（维护等），您可以降低竞争对手的出价，因为您知道您的机器成本*准确*每页 0.00234，而他们坚持一般的猜测。如果您开始使用该系统进行跟踪并让员工跟踪问题、维护等，您可能会发现非常奇怪的相关性，例如红卡库存在折叠机上的成本更高，因为它比蓝卡更频繁地卡纸（无论出于何种原因）。您可以调整您的定价（在此系统中为第 n 级），与纸张制造商交谈，停止提供该选项，或采取其他一些策略来挤压系统。如果您的某些机器需要熟练的操作员，您可以将员工及其工资率添加到矩阵中，并开始安排工作，以便他们更高效地工作。

# 更新

> 因此，假设我选择 Light Paper、Red Color、Print。如何获得合适的价格？在二维表中，我有三对可能的红色/打印、红色/浅色、打印/浅色。遗憾的是，我无法在一个不断发展的公式中计算价格，在做出所有选择之后，我只有一个最终价格。

好吧，我已经简化了上面的内容，但让我们先假设一个简单的情况。

我没有在上表中提到每个价格代表什么。一切的成本都是每页，除了装订。绑定成本是每个绑定项目。

因此，在您的示例中，您选择浅色纸，红色，打印。每张红纸是 0.05 美元（昂贵的纸！），每张印刷是 0.001 美元（便宜的印刷），所以每张印刷纸的成本是 0.051 美元。如果您制作 300 份，则总费用为 15.30 美元。

由于装订是按装订的项目列出的，因此您可以将装订添加到上述订单中，并且您可能将 50 页装订在一起，总共 6 个装订项目，300 页。我们已经知道前面所有的成本，因此 6 件装订物品的额外成本（每件 0.50 美元）是 3.00 美元，新的总计 18.30 美元。

除了我上面指定的简化之外，您还需要做一些事情：

在矩阵中，我将许多单元格留空。在某些情况下，这是因为进程/对象不兼容（例如，无法绑定折叠项），但在其他情况下，没有冲突，但它不需要任何成本。因此，您的红色/常规与常规/红色示例-由于我们将价格加在一起，因此备用组合无需任何费用。

让我们看看我是否可以更清楚地说明这一点......

选择浅色纸、红色、印刷、装订（300 页，6 个装订项目）遍历表格并找到落在该集合内的所有价格：

![定价矩阵显示选项发生冲突以提供定价信息的单元格](https://i.imgur.com/bJbgs4t.png)

您搜索表中的所有元素（红色/浅色和浅色/红色），然后获取价格并分别乘以数量，然后将它们相加。所有这些选择的交集以绿色显示。（弄乱了浅色纸/浅色纸的颜色——也应该是绿色的）

我删除了打印/打印组合，因为它不适用于这种方法（我希望简化事情，但它实际上使事情变得更难）如果你想指定双面打印，你需要表格中的另一个项目（打印例如，反向），您将同时选择打印和反向打印。交替有两个项目，“打印单面”和“打印双面”。

请记住，虽然我在每个单元格中列出了每个价格，但实际上每个单元格实际上描述了几种情况：

1.  参考定价表
2.  免费
3.  约束（不能组合）

#1 中的参考引用了另一个包含价格和第三个维度的表。例如，组合“light/bound”的单元格将引用具有以下三个属性的表：

*   每页价格
*   每个绑定项目的价格
*   每个作业（设置）价格

这些将根据页数和装订项目数相加，然后将每个作业成本添加到顶部。

## 更复杂！哇！

这可能满足您的需求，但如果您的流程仅在某些更复杂的情况下不兼容怎么办？

现在我们可以涵盖一个进程或对象与另一个冲突的一般情况。然而，我们无法处理更复杂的事情。

假设轻纸可以打印，也可以折叠，但不能同时打印和折叠。我们不能对打印/折叠施加限制，因为其他纸张既可以打印也可以折叠。

您可以做几件事：

*   添加第三个维度 - 但是如果将 4 件事混合在一起，您可能会有一个无法完成的序列，这意味着另一个维度等
*   使用向量（map/reduce）
*   添加抽象层

向量很好，但对于这个应用程序来说可能有点矫枉过正。它基本上是第一项，但没有定义您可以拥有多少维度 - 您拥有与对象一样多的维度，因此可以表示任何可能的组合。

额外的抽象层是两者之间的折衷。理想情况下，您不会有很多比两个项目更复杂的冲突，但是当您这样做时，您定义了一个表示组合的新对象。所以在这种情况下，您可能有一个新的对象/过程，它是打印和折叠的组合，并且它在使用轻纸的列处有一个约束。

您只能针对约束执行此操作，在这种情况下，它不会修改您的定价算法（即，定价仍然来自添加单独的流程和对象。）

或者，您可以使用选择最大组合的算法 - 因此，您无需在数据库中搜索 Light、Red、Print、Fold，而是首先在数据库中搜索组合，这将返回 Light、Red、PrintFold 的最大组合，然后正常定价。

最后，您可以在数据库中搜索单个商品和组合商品，如果存在冲突（组合商品和单个商品的双重定价），您可以选择：

*   最大的代价
*   最伟大的组合
*   优先成本（即，每个成本都有一个优先级，您在冲突期间比较它们并选择优先的成本）

-亚当

# version-control - 显示自上次“获取最新版本”以来的变更集？

> ID：516990
> 
> 赞同：3
> 
> 时间：2009-02-05T17:44:11.067
> 
> 标签：version-control, tfs, history

使用 Team Foundation Server 和 Visual Studio 2008，有没有办法突出显示自我上次“获取最新版本”以来提交的内容？这将使我能够快速识别自上次“拉”以来提交的内容，而无需记住我上次同步的变更集。

谢谢。

埃里克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T19:25:32.253

如果您右键单击该文件`Solution Explorer`并选择该`Compare`选项，则在弹出窗口中将其设置`Target Version`为`Type`: `Latest Version`。

单击`OK`，您的比较器工具将打开，显示您的本地文件和服务器中的最新版本之间的差异。

# asp.net - 关于 IIS7 的空 *.aspx 页面的任何已知问题？

> ID：516992
> 
> 赞同：1
> 
> 时间：2009-02-05T17:44:23.143
> 
> 标签：asp.net, iis-7

我有一个 IIS7 Web 应用程序，它主要服务于 Web 服务请求。作为我们解决方案的一部分，我们有两个 Web 服务器和一个负载均衡器，负载均衡器会定期从其每个负载均衡框请求一个页面。负载均衡器加载的页面名为“Health.aspx”，后面*没有*代码，Health.aspx文件的全部内容为：

```
OK 
```

但是，我们在全天请求此页面时观察到负载均衡器偶尔会出现 400 错误，这会导致负载均衡器在一段时间内将机器从其旋转中弹出。

虽然这里有许多可能导致问题的事情，但我想从 web 框本身开始，确定一个几乎空且没有代码的 *.aspx 页面是否会导致周期性问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T17:12:56.497

您应该创建 Health.html 并使用它来代替。这也将使您了解是 ASP.NET 给您 400 问题还是 IIS。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T20:55:14.167

“400 错误”涵盖了广泛的潜在问题，从简单的未找到 404 到错误请求 401，再到禁止 403。

其中一些可能是由不良的网络电缆、网卡、糟糕的负载平衡器、过载的服务器等引起的。

顺便说一句，不，没有代码后面的网页不会抛出那个。另外，我可能会在 health.aspx 中做更多的事情来验证服务器是否确实在运行。就像运行计算或发出简单的数据库请求一样。毕竟，IIS 可能只是在缓存文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:47:24.167

事实证明，问题只是请求的数量庞大，以及处理请求的响应时间不合时宜（或真正的*请求*时间 - 我们的客户端连接非常慢）。Health.aspx 的请求被缓慢的客户端连接所困扰，默认值`MaxConcurrentRequestsPerCPU`12 人为地限制了我们每秒的实际请求数。将此数字增加到 100 - 基于针对我们特定应用程序的负载仔细测试我们的硬件 - 解决了这个问题。

# javascript - 覆盖 JavaScript 会导致 IE 中的无限循环，但不会在 Firefox 中

> ID：516993
> 
> 赞同：1
> 
> 时间：2009-02-05T17:44:24.390
> 
> 标签：javascript, internet-explorer, firefox, cross-browser

我正在使用以下代码来覆盖名为dismissRelatedLookupPopup() 的JavaScript 函数。在 Firefox 中，这没有问题（显示一次警报并运行我的代码），但在 Internet Explorer 7 中，它会导致无限循环，永远显示警报（）。我这样做是因为我不控制调用dismissRelatedLookupPopup() 的代码，并且我想在调用它时添加我自己的钩子。有没有跨浏览器的方法来做到这一点？

```
old_dismissRelatedLookupPopup = dismissRelatedLookupPopup;
dismissRelatedLookupPopup = function dismissRelatedLookupPopup(win, chosenId) {
    alert("i hate ie");
    old_dismissRelatedLookupPopup(win,chosenId);
    var name = windowname_to_id(win.name);
    var elem = document.getElementById(name);
    elem.onchange();
} 
```

*注意*：据我了解，当 JavaScript 直接更新元素的值（即 elem.value = 1）时，该元素的 onchange() 事件不会触发。这就是为什么我包含此代码以在更新值时强制 onchange() 。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T17:49:35.330

我很确定改变这一行：

```
dismissRelatedLookupPopup = function dismissRelatedLookupPopup(win, chosenId) 
```

到

```
dismissRelatedLookupPopup = function (win, chosenId) 
```

会治好你的病。

# vb.net - 在 appdomain 中执行功能

> ID：516995
> 
> 赞同：0
> 
> 时间：2009-02-05T17:45:23.343
> 
> 标签：vb.net, dll, appdomain

给定一个 .NET DLL，它由一个类“Place”和一个返回整数的函数“Where”组成；我需要将 dll 加载到应用程序域中，执行函数并卸载应用程序域。

```
 Dim domain As AppDomain = AppDomain.CreateDomain("Executor")            
Dim buffer() As Byte = IO.File.ReadAllBytes("c:\path\Locator.dll")
Dim asy As Assembly = domain.Load(buffer)
Dim obj As [Object] = asy.CreateInstance("Locator.Place")
Dim method As MethodInfo = obj.GetType.GetMethod("Where")
Dim result as Integer = method.Invoke(obj, New [Object]() { 1 })
AppDomain.Unload(domain) 
```

此行失败：

```
 Dim asy As Assembly = domain.Load(buffer) 
```

使用此错误消息：

```
 'Could not load file or assembly 'Place, Version=1.0.0.0, Culture=neutral, PublicKeyToken-null' or one of it's dependencies.  The System Cannot find the specified file.' 
```

该文件在缓冲区中，所以我猜它是一个依赖.dll。但是，它应该在基本程序目录中找到那些。

关于错误原因的任何想法？

任何用于将程序集加载到 AppDomain、执行函数、然后卸载 AppDomain 的测试示例代码将不胜感激。

（顺便说一句，我用谷歌搜索并没有找到任何*有用*的样本。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-14T21:54:38.663

您说错误是由于缺少参考是正确的。由于您加载程序集的方式，很可能无法解析引用。由于您是从字节数组加载，因此 Assembly.Location 不会指向 dll 的位置。由于您引用的 dll 不在 GAC 中，因此它将无法找到引用的程序集。尝试直接从文件加载程序集，而不是先加载到字节数组中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T19:46:43.863

如果您想知道无法加载哪些依赖项，请尝试使用 fuslogvw。检查[http://msdn.microsoft.com/en-us/library/e74a18c4(VS.71).aspx](http://msdn.microsoft.com/en-us/library/e74a18c4(VS.71).aspx)

我发现[链接文本](http://www.devsource.com/c/a/Using-VS/Dynamic-Plugins-Using-the-codeAppDomaincode-Class-to-Load-and-Unload-Code/ "Dynamic-Plugins-Using-the-codeAppDomaincode-Class-to-Load-and-Unload-Code")的解释非常好。它说明了一些缺陷并提供了应该很容易转换为 VB.NET 的示例代码。

我希望这有帮助。**`**``**