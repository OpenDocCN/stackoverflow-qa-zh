# StackOverflow 问答 000139000-000139999

# html - 带溢出的 DIV：自动和 100% 宽的表

> ID：139000
> 
> 赞同：30
> 
> 时间：2008-09-26T12:03:54.077
> 
> 标签：html, internet-explorer, xhtml, html-table

我希望有人可以在这里帮助我。我尽量简化我的例子。

我有一个绝对定位的 DIV，在这个例子中我已经填充了浏览器窗口。此 div 具有 overflow:auto 属性，可在内容太大而无法显示 DIV 时提供滚动条。

在 DIV 中，我有一个表格来展示一些数据，它的宽度是 100%。

当内容垂直变得太大时，我希望出现垂直滚动条并且表格会稍微水平缩小以适应滚动条。然而，在 IE7 中，水平滚动条也会出现，尽管 div 中的所有内容仍有足够的水平空间。

这是 IE 特有的 - firefox 可以完美运行。

完整来源如下。非常感谢任何帮助。

托尼

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Table sizing bug?</title>
    <style>
        #maxsize
        {
            position: absolute;
            left: 5px;
            right: 5px;
            top: 5px;
            bottom: 5px;
            border: 5px solid silver;
            overflow: auto;
        }
    </style>
</head>
<body>
    <form id="form1" runat="server">
    <div id="maxsize">
        <p>This will be fine until such time as the vertical size forces a
           vertical scroll bar. At this point I'd expect the table to re-size
           to now take into account of the new vertical scroll bar. Instead,
           IE7 keeps the table the full size and introduces a horizontal
           scroll bar.
        </p>
        <table width="100%" cellspacing="0" cellpadding="0" border="1">
        <tbody>
            <tr>
                <td>A</td>
                <td>B</td>
                <td>C</td>
                <td>D</td>
                <td>E</td>
                <td>F</td>
                <td>G</td>
                <td>H</td>
                <td>I</td>
                <td>J</td>
                <td>K</td>
                <td>L</td>
                <td>M</td>
                <td>N</td>
                <td>O</td>
                <td>P</td>
                <td>Q</td>
                <td>R</td>
            </tr>
        </tbody>
        </table>

        <p>Resize the browser window vertically so this content doesn't
           fit any more</p>
        <p>Hello</p><p>Hello</p><p>Hello</p><p>Hello</p><p>Hello</p>
        <p>Hello</p><p>Hello</p><p>Hello</p><p>Hello</p><p>Hello</p>
    </div>
    </form>
</body>
</html> 
```

* * *

**2010 年 3 月 16 日添加...**认为在评论中指出 GWT 的源代码指向这个问题可能会很有趣... [http://www.google.com/codesearch/p?hl=en#MTQ26449crI /com/google/gwt/user/client/ui/ScrollPanel.java&q=%22hack%20to%20account%20for%20the%22%20scrollpanel&sa=N&cd=1&ct=rc&l=48](http://www.google.com/codesearch/p?hl=en#MTQ26449crI/com/google/gwt/user/client/ui/ScrollPanel.java&q=%22hack%20to%20account%20for%20the%22%20scrollpanel&sa=N&cd=1&ct=rc&l=48)

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-18T20:02:29.180

我在 IE7 中遇到了过多水平条的问题。我使用 D Carter 的解决方案略有改变

```
<div style="zoom: 1; overflow: auto;">
   <div id="myDiv" style="zoom: 1;">
      <table style="width: 100%"...
      ...
      </table>
   </div>
</div> 
```

要在小于 7 的 IE 浏览器中工作，您需要添加：

```
<!--[if lt IE 7]><style> #myDiv { overflow: auto; } </style><![endif]--> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-10-08T19:39:18.377

Eran Galperin 的解决方案未能解释这样一个事实，即简单地关闭水平滚动仍将允许表格与垂直滚动条重叠。我认为这是因为 IE 在决定它需要垂直滚动条之前计算“100%”的含义，然后无法重新调整剩余的可用水平空间。

不过，上面的 cetnar 解决方案可以解决这个问题：

```
<div style="zoom: 1; overflow: auto;">
   <div id="myDiv" style="zoom: 1;">
      <table style="width: 100%">
      ...
      </table>
   </div>
</div> 
```

在我的测试中，这适用于 IE6 和 7。据我所知，在 IE6 上似乎不需要“” hack。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-23T21:26:46.617

好吧，这个困扰我很久了。我做了太多右侧有额外填充的设计，允许 IE 完全无视自己的滚动条。

答案是：嵌套两个div，给他们两个hasLayout，设置里面的一个溢出。

```
<!-- zoom: 1 is a proprietary IE property.  It doesn't really do anything here, except give hasLayout -->

<div style="zoom: 1;">
   <div style="zoom: 1; overflow: auto">
      <table style="width: 100%"...
      ...
      </table>
   </div>
</div> 
```

[http://www.satzansatz.de/cssd/onhavelayout.html](http://www.satzansatz.de/cssd/onhavinglayout.html)
去那里阅读更多关于布局的信息

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T12:25:07.897

改变：

```
overflow: auto; 
```

至：

```
overflow-y:hidden;
overflow-x:auto; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-13T13:46:25.883

这[在 GWT trunk 中报告已修复](http://code.google.com/p/google-web-toolkit/source/detail?r=6354)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-03T11:22:04.670

如果是 body 标签坚持水平滚动（我猜是因为我将子元素设置为 100%），您可以将其添加到您的 CSS 以解决 IE7（或 8 兼容模式）中的问题：

```
html{overflow-x:hidden;} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T12:10:46.150

只要您不反对条件语句，这看起来应该可以解决您的问题。 [修复 IE 溢出](http://blog.josh420.com/archives/2007/11/fixing-the-ie-overflow-vertical-scrollbar-bug.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-04T20:25:46.817

不幸的是，这是 IE 的一个怪癖。没有办法使用纯 XHTML 和 CSS 让它与 Firefox 一样工作。

您可以使用 JavaScript 来检测窗口的大小并动态设置表格的宽度。如果你真的想走那条路，我可以添加更多细节。

# python - PyQt - QScrollBar

> ID：139005
> 
> 赞同：0
> 
> 时间：2008-09-26T12:05:29.377
> 
> 标签：python, pyqt

亲爱的 Stacktoverflow，你能告诉我一个如何使用 QScrollBar 的例子吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T12:28:38.120

```
>>> import sys
>>> from PyQt4 import QtCore, QtGui
>>> app = QtGui.QApplication(sys.argv)
>>> sb = QtGui.QScrollBar()
>>> sb.setMinimum(0)
>>> sb.setMaximum(100)
>>> def on_slider_moved(value): print "new slider position: %i" % (value, )
>>> sb.connect(sb, QtCore.SIGNAL("sliderMoved(int)"), on_slider_moved)
>>> sb.show()
>>> app.exec_() 
```

现在，当您移动滑块时（您可能需要调整窗口大小），您将看到滑块位置在您处理时打印到终端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T12:18:12.950

它将使用 QScrollArea 归结为您，它是一个实现显示大于可用空间的东西的小部件。您不需要直接使用 QScrollBar。我没有 PyQt 示例，但在 QT 发行版中有一个 C++ 示例，它被称为“图像查看器”。对象层次结构仍然相同

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T12:23:54.717

在 PyQT 源代码分发中，查看文件：

> 示例/小部件/sliders.pyw

[或者这里](http://www.zetcode.com/tutorials/pyqt4/widgets/)有一个最小的例子（我想我不应该复制粘贴，因为潜在的版权问题）

# c# - 如何在 C# 中解析 .lnk

> ID：139010
> 
> 赞同：25
> 
> 时间：2008-09-26T12:06:48.157
> 
> 标签：c#, .net

我需要找出 .lnk 使用 c# 指向的文件/目录名称。

最简单的方法是什么？

谢谢。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-10-21T05:38:48.030

我为视频浏览器写了这个，效果很好

```
#region Signitures imported from http://pinvoke.net

[DllImport("shfolder.dll", CharSet = CharSet.Auto)]
internal static extern int SHGetFolderPath(IntPtr hwndOwner, int nFolder, IntPtr hToken, int dwFlags, StringBuilder lpszPath);

[Flags()]
enum SLGP_FLAGS
{
    /// <summary>Retrieves the standard short (8.3 format) file name</summary>
    SLGP_SHORTPATH = 0x1,
    /// <summary>Retrieves the Universal Naming Convention (UNC) path name of the file</summary>
    SLGP_UNCPRIORITY = 0x2,
    /// <summary>Retrieves the raw path name. A raw path is something that might not exist and may include environment variables that need to be expanded</summary>
    SLGP_RAWPATH = 0x4
}

[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
struct WIN32_FIND_DATAW
{
    public uint dwFileAttributes;
    public long ftCreationTime;
    public long ftLastAccessTime;
    public long ftLastWriteTime;
    public uint nFileSizeHigh;
    public uint nFileSizeLow;
    public uint dwReserved0;
    public uint dwReserved1;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
    public string cFileName;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 14)]
    public string cAlternateFileName;
}

[Flags()]
enum SLR_FLAGS
{
    /// <summary>
    /// Do not display a dialog box if the link cannot be resolved. When SLR_NO_UI is set,
    /// the high-order word of fFlags can be set to a time-out value that specifies the
    /// maximum amount of time to be spent resolving the link. The function returns if the
    /// link cannot be resolved within the time-out duration. If the high-order word is set
    /// to zero, the time-out duration will be set to the default value of 3,000 milliseconds
    /// (3 seconds). To specify a value, set the high word of fFlags to the desired time-out
    /// duration, in milliseconds.
    /// </summary>
    SLR_NO_UI = 0x1,
    /// <summary>Obsolete and no longer used</summary>
    SLR_ANY_MATCH = 0x2,
    /// <summary>If the link object has changed, update its path and list of identifiers.
    /// If SLR_UPDATE is set, you do not need to call IPersistFile::IsDirty to determine
    /// whether or not the link object has changed.</summary>
    SLR_UPDATE = 0x4,
    /// <summary>Do not update the link information</summary>
    SLR_NOUPDATE = 0x8,
    /// <summary>Do not execute the search heuristics</summary>
    SLR_NOSEARCH = 0x10,
    /// <summary>Do not use distributed link tracking</summary>
    SLR_NOTRACK = 0x20,
    /// <summary>Disable distributed link tracking. By default, distributed link tracking tracks
    /// removable media across multiple devices based on the volume name. It also uses the
    /// Universal Naming Convention (UNC) path to track remote file systems whose drive letter
    /// has changed. Setting SLR_NOLINKINFO disables both types of tracking.</summary>
    SLR_NOLINKINFO = 0x40,
    /// <summary>Call the Microsoft Windows Installer</summary>
    SLR_INVOKE_MSI = 0x80
}

/// <summary>The IShellLink interface allows Shell links to be created, modified, and resolved</summary>
[ComImport(), InterfaceType(ComInterfaceType.InterfaceIsIUnknown), Guid("000214F9-0000-0000-C000-000000000046")]
interface IShellLinkW
{
    /// <summary>Retrieves the path and file name of a Shell link object</summary>
    void GetPath([Out(), MarshalAs(UnmanagedType.LPWStr)] StringBuilder pszFile, int cchMaxPath, out WIN32_FIND_DATAW pfd, SLGP_FLAGS fFlags);
    /// <summary>Retrieves the list of item identifiers for a Shell link object</summary>
    void GetIDList(out IntPtr ppidl);
    /// <summary>Sets the pointer to an item identifier list (PIDL) for a Shell link object.</summary>
    void SetIDList(IntPtr pidl);
    /// <summary>Retrieves the description string for a Shell link object</summary>
    void GetDescription([Out(), MarshalAs(UnmanagedType.LPWStr)] StringBuilder pszName, int cchMaxName);
    /// <summary>Sets the description for a Shell link object. The description can be any application-defined string</summary>
    void SetDescription([MarshalAs(UnmanagedType.LPWStr)] string pszName);
    /// <summary>Retrieves the name of the working directory for a Shell link object</summary>
    void GetWorkingDirectory([Out(), MarshalAs(UnmanagedType.LPWStr)] StringBuilder pszDir, int cchMaxPath);
    /// <summary>Sets the name of the working directory for a Shell link object</summary>
    void SetWorkingDirectory([MarshalAs(UnmanagedType.LPWStr)] string pszDir);
    /// <summary>Retrieves the command-line arguments associated with a Shell link object</summary>
    void GetArguments([Out(), MarshalAs(UnmanagedType.LPWStr)] StringBuilder pszArgs, int cchMaxPath);
    /// <summary>Sets the command-line arguments for a Shell link object</summary>
    void SetArguments([MarshalAs(UnmanagedType.LPWStr)] string pszArgs);
    /// <summary>Retrieves the hot key for a Shell link object</summary>
    void GetHotkey(out short pwHotkey);
    /// <summary>Sets a hot key for a Shell link object</summary>
    void SetHotkey(short wHotkey);
    /// <summary>Retrieves the show command for a Shell link object</summary>
    void GetShowCmd(out int piShowCmd);
    /// <summary>Sets the show command for a Shell link object. The show command sets the initial show state of the window.</summary>
    void SetShowCmd(int iShowCmd);
    /// <summary>Retrieves the location (path and index) of the icon for a Shell link object</summary>
    void GetIconLocation([Out(), MarshalAs(UnmanagedType.LPWStr)] StringBuilder pszIconPath,
        int cchIconPath, out int piIcon);
    /// <summary>Sets the location (path and index) of the icon for a Shell link object</summary>
    void SetIconLocation([MarshalAs(UnmanagedType.LPWStr)] string pszIconPath, int iIcon);
    /// <summary>Sets the relative path to the Shell link object</summary>
    void SetRelativePath([MarshalAs(UnmanagedType.LPWStr)] string pszPathRel, int dwReserved);
    /// <summary>Attempts to find the target of a Shell link, even if it has been moved or renamed</summary>
    void Resolve(IntPtr hwnd, SLR_FLAGS fFlags);
    /// <summary>Sets the path and file name of a Shell link object</summary>
    void SetPath([MarshalAs(UnmanagedType.LPWStr)] string pszFile);

}

[ComImport, Guid("0000010c-0000-0000-c000-000000000046"),
InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
public interface IPersist
{
    [PreserveSig]
    void GetClassID(out Guid pClassID);
}

[ComImport, Guid("0000010b-0000-0000-C000-000000000046"),
InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
public interface IPersistFile : IPersist
{
    new void GetClassID(out Guid pClassID);
    [PreserveSig]
    int IsDirty();

    [PreserveSig]
    void Load([In, MarshalAs(UnmanagedType.LPWStr)]
    string pszFileName, uint dwMode);

    [PreserveSig]
    void Save([In, MarshalAs(UnmanagedType.LPWStr)] string pszFileName,
        [In, MarshalAs(UnmanagedType.Bool)] bool fRemember);

    [PreserveSig]
    void SaveCompleted([In, MarshalAs(UnmanagedType.LPWStr)] string pszFileName);

    [PreserveSig]
    void GetCurFile([In, MarshalAs(UnmanagedType.LPWStr)] string ppszFileName);
}

const uint STGM_READ = 0;
const int MAX_PATH = 260;

// CLSID_ShellLink from ShlGuid.h 
[
    ComImport(),
    Guid("00021401-0000-0000-C000-000000000046")
]
public class ShellLink
{
}

#endregion 

public static string ResolveShortcut(string filename)
{
    ShellLink link = new ShellLink();
    ((IPersistFile)link).Load(filename, STGM_READ);
    // TODO: if I can get hold of the hwnd call resolve first. This handles moved and renamed files.  
    // ((IShellLinkW)link).Resolve(hwnd, 0) 
    StringBuilder sb = new StringBuilder(MAX_PATH);
    WIN32_FIND_DATAW data = new WIN32_FIND_DATAW();
    ((IShellLinkW)link).GetPath(sb, sb.Capacity, out data, 0);
    return sb.ToString(); 
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T12:13:07.067

这可能会有所帮助：

[http://www.neowin.net/forum/index.php?s=3ad7f1ffb995ba84999376f574e9250f&showtopic=658928&st=0&p=589667108&#entry589667108](http://www.neowin.net/forum/index.php?s=3ad7f1ffb995ba84999376f574e9250f&showtopic=658928&st=0&p=589667108&#entry589667108)

在本质上...

在添加引用对话框的 COM 选项卡中添加对 Windows 脚本宿主对象模型的引用。

```
IWshRuntimeLibrary.IWshShell shell = new IWshRuntimeLibrary.WshShell();

IWshRuntimeLibrary.IWshShortcut shortcut = (IWshRuntimeLibrary.IWshShortcut)shell.CreateShortcut(link);

Console.WriteLine(shortcut.TargetPath); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T12:45:43.680

加上凯夫所说的……

如果您使用*csc.exe*而不是 Visual Studio，要添加对 Windows 脚本宿主对象模型的引用，您必须：

*   使用*tlbimp.exe*工具创建托管程序集：

    tlbimp.exe c:\windows\system32\wshom.ocx /out:IWshRuntimeLibrary.dll

*   *使用csc.exe*中的 /r 开关引用 .dll ：

    csc.exe Lnk.cs /r:IWshRuntimeLibrary.dll

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-10-16T14:42:51.413

或者简单地测试`mydir`，如果它不存在，`mydir.lnk`使用`File.Exixts()`.

适用于文件。

# opengl - 在 OpenGL 中调整整个场景的亮度/伽玛

> ID：139012
> 
> 赞同：3
> 
> 时间：2008-09-26T12:07:01.403
> 
> 标签：opengl, 3d, gamma

有谁知道我如何在OpenGL中实现以下效果：

*   更改渲染场景的亮度
*   或者在 OpenGL 中实现 Gamma 设置

我尝试通过更改灯光的环境参数和灯光类型（定向和全向），但结果并不统一。TIA。

感谢您的帮助，一些附加信息： * 我不能使用任何 Windows 特定 API。* 伽玛设置不应影响整个窗口，因为我必须为不同的视图设置不同的伽玛。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T12:18:08.537

在 win32 上，您可以使用 SetDeviceGammaRamp 调整整体亮度/伽玛。但是，这会影响整个显示，因此除非您的应用程序是全屏的，否则这不是一个好主意。

便携式替代方案是将整个场景绘制得更亮或更暗（这很麻烦），或者在整个场景上添加全屏 alpha 混合四边形以根据需要使其变亮或变暗。这些方法都不会影响伽马曲线，只会影响整体亮度；要调整伽玛，您需要将整个场景抓取到纹理中，然后通过像素着色器将其渲染回屏幕，该像素着色器通过伽玛函数运行每个纹素。

好的，阅读更新后的问题后，您需要的是一个带有混合设置的四边形，以使其下方的所有内容变暗或变亮。例如。

```
if( brightness > 1 )
{
    glBlendFunc( GL_DEST_COLOR, GL_ONE );
    glColor3f( brightness-1, brightness-1, brightness-1 );
}
else
{
    glBlendFunc( GL_ZERO, GL_SRC_COLOR );
    glColor3f( brightness, brightness, brightness );
}
glEnable( GL_BLEND );

draw_quad(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T12:14:11.137

[http://www.gamedev.net/community/forums/topic.asp?topic_id=435400](http://www.gamedev.net/community/forums/topic.asp?topic_id=435400)可能是您问题的答案，否则您可以将伽马校正作为像素着色器实现

# perl - 如何从 Perl 对 PDF 文件进行全文搜索？

> ID：139015
> 
> 赞同：8
> 
> 时间：2008-09-26T12:07:59.513
> 
> 标签：perl, pdf, full-text-search

我有一堆 PDF 文件，我的 Perl 程序需要对它们进行全文搜索以返回哪些包含特定字符串。迄今为止，我一直在使用这个：

```
my @search_results = `grep -i -l \"$string\" *.pdf`; 
```

其中 $string 是要查找的文本。然而，这对于大多数 pdf 文件来说都失败了，因为文件格式显然不是 ASCII。

我能做什么最简单？

澄清：大约有 300 个 pdf 的名称我事先不知道。PDF::Core 可能是矫枉过正。我试图让 pdftotext 和 grep 相互配合，因为我不知道 pdf 的名称，我还找不到正确的语法。

使用 Adam Bellaire 的以下建议的最终解决方案：

```
@search_results = `for i in \$( ls ); do pdftotext \$i - | grep --label="\$i" -i -l "$search_string"; done`; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T12:21:51.023

PerlMonks 线程[在这里](http://www.perlmonks.org/?node_id=582868)讨论了这个问题。

似乎对于您的情况，获取**pdftotext**（命令行工具）可能是最简单的，然后您可以执行以下操作：

```
my @search_results = `pdftotext myfile.pdf - | grep -i -l \"$string\"`; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T05:52:26.463

我的库[CAM::PDF](http://search.cpan.org/dist/CAM-PDF/)支持提取文本，但考虑到 PDF 语法的图形方向，这是一个固有的难题。所以，输出有时是乱码。CAM::PDF 捆绑了一个[getpdftext.pl](http://search.cpan.org/dist/CAM-PDF/bin/getpdftext.pl)程序，或者您可以像这样调用该功能：

```
my $doc = CAM::PDF->new($filename) || die "$CAM::PDF::errstr\n";
for my $pagenum (1 .. $doc->numPages()) {
   my $text = $doc->getPageText($pagenum);
   print $text;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T12:31:56.303

我第二个亚当贝莱尔解决方案。我使用 pdftotext 实用程序来创建我的电子书库的全文索引。它有点慢，但可以完成它的工作。至于全文，可以试试 PLucene 或者 KinoSearch 来存储全文索引。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T12:50:25.883

您可能想查看[PDF::Core](http://search.cpan.org/perldoc?PDF::Core)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T13:14:01.850

我用过的最简单的全文索引/搜索是 mysql。您只需插入带有适当索引的表即可。您需要花一些时间来计算字段的相对权重（标题中的匹配可能比正文中的匹配得分更高），但这一切都是可能的，尽管有一些毛茸茸的 sql。

Plucene 已被弃用（过去两年没有任何积极的工作）支持 KinoSearch。KinoSearch 的成长，部分是因为理解 Plucene 的架构限制。

如果您有大约 300 个 pdf，那么一旦您从 PDF 中提取了文本（假设 PDF 有文本而不仅仅是文本图像；）并且根据您的查询量，您可能会发现 grep 就足够了。

但是，我强烈建议使用 mysql/kinosearch 路线，因为它们涵盖了很多领域（词干、停用词、术语权重、令牌解析），您不会从陷入困境中受益。

KinoSearch 可能比 mysql 路由更快，但是 mysql 路由为您提供了更广泛使用的标准软件/工具/开发人员体验。您还可以使用 sql 的强大功能来增强您的自由文本搜索查询。

所以除非你在谈论巨大的数据集和疯狂的查询量，否则我的钱会花在 mysql 上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T15:24:46.353

您可以尝试 Lucene（Perl 端口称为 Plucene）。搜索速度非常快，而且我知道 PDFBox 已经知道如何使用 Lucene 索引 PDF 文件。PDFBox 是 Java，但很可能在 CPAN 中的某个地方有一些非常相似的东西。即使您找不到已经将 PDF 文件添加到 Lucene 索引的内容，您自己也应该只需要几行代码即可。Lucene 将为您提供更多的搜索选项，而不是简单地在文件中查找字符串。

还有一种非常快速和肮脏的方式。PDF 文件中的文本实际上存储为纯文本。如果您在文本编辑器中打开 PDF 或使用“字符串”，您可以在其中看到文本。二进制垃圾通常是嵌入的字体、图像等。

# java - 如何在 Java 中编写全屏模式？

> ID：139025
> 
> 赞同：12
> 
> 时间：2008-09-26T12:10:47.010
> 
> 标签：java, graphics, fullscreen

我希望我的应用程序具有全屏模式。执行此操作的最简单方法是什么，我需要为此使用第三方库还是 JDK 中已经提供了此功能？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-26T12:13:39.110

尝试[全屏独占模式 API](http://java.sun.com/docs/books/tutorial/extra/fullscreen/index.html)。它是在 JDK 1.4 版本中引入的。其中一些功能包括：

> *   **全屏独占模式**- 允许您暂停窗口系统，以便可以直接在屏幕上进行绘图。
> *   **显示模式**- 由大小（显示器的宽度和高度，以像素为单位）、位深度（每个像素的位数）和刷新率（显示器自身更新的频率）组成。
> *   **被动与主动渲染**- 在主事件循环上使用paint方法进行绘制是被动的，而在您自己的线程中渲染是主动的。
> *   **双缓冲和翻页**- 更流畅的绘图意味着更好的感知性能和更好的用户体验。
> *   **BufferStrategy 和 BufferCapabilities** - 允许您绘制到表面和组件的类，而无需知道使用的缓冲区数量或用于显示它们的技术，并帮助您确定图形设备的功能。

链接教程中有几个全屏独占模式示例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T12:19:55.083

JFrame`setUndecorated(true)`方法

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T12:13:44.600

在为游戏提供全屏 OpenGL 用户界面时，我使用 JOGL 完成了此操作。这很容易。我相信该功能也已在版本 5 中添加到 Java 中，但是很久以前我已经忘记了如何做到这一点（编辑：参见上面的答案以了解如何做）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-08T17:08:58.067

使用此代码：

```
JFrame frame = new JFrame();
// set properties
frame.setSize(Toolkit.getDefaultToolkit().getScreenSize());
frame.setUndecorated(true);
frame.setVisible(true); 
```

确保`setUndecorated()`之前来，`setVisible()`否则将无法正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T12:15:05.690

这实际上取决于您使用什么来显示您的界面，即 AWT/Spring 或 OpenGL 等。

Java 有一个全屏独占模式 API -[请参阅 Sun 的本教程](http://java.sun.com/docs/books/tutorial/extra/fullscreen/exclusivemode.html)。

# mime - 如何配置 mongrel 返回 mime 类型

> ID：139027
> 
> 赞同：1
> 
> 时间：2008-09-26T12:11:20.330
> 
> 标签：mime, mongrel

如何配置从 mongrel 返回的内容类型。特别地，我希望它以 application/x-javascript 的形式返回一些 javascripts 文件，以尝试重现我在远程服务器上看到的错误

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T13:25:20.387

我不知道这是否正是您正在寻找的答案，但我通过快速谷歌搜索找到了这个。[http://mongrel.rubyforge.org/wiki/HOWTO](http://mongrel.rubyforge.org/wiki/HOWTO)

它指出您可以提供带有 mime 类型的 yaml 文件。

# architecture - 经理班

> ID：139034
> 
> 赞同：3
> 
> 时间：2008-09-26T12:13:38.907
> 
> 标签：architecture

在我几乎完成的一个最近的项目中，我们使用了一种架构，它与 Web/服务层的交互使用 XXXManager 类作为其顶层。

例如，有一个按计划运行的 Windows 服务，它将来自多个不同数据源的数据导入我们的系统。在该服务中，调用了几个“管理器”类，即 CPImportScheduleManager、CPImportProcessManager 等。

现在，这些 Manager 类所做的不仅仅是将方法传递到链上以在 Web/服务层中使用。例如，我的 UserManager.Register() 方法不仅通过较低级别的程序集持久化用户，而且还向用户发送 WAP 推送并确定使用的手机等。

有人向我建议，这种类型的架构是试图让 OOP 适应过程模型的常用方法。我可以在这里看到他们的观点，但我想知道的是，使用这个顶级类集，任何 Web/服务层都可以简单地调用相同的通用方法，而无需重写代码。因此，如果我想编写一个在某个时候注册用户的 Web 服务，我可以再次调用 UserManager.Register() 方法，而无需再次重写所有逻辑。

我从来都不是解释自己的最佳人选，但如果我的胡言乱语有道理，请随时就您的替代方案提出建议。

干杯，克里斯。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T12:20:45.020

对于处理给定实体集的工作流或复杂任务的服务，管理器是一种经常被过度使用的命名策略。但是，如果它完成了工作，那么它不一定是一件坏事。

我会问的一个重要问题是经理们下面发生了什么？如果它们只是简单地协调流程的工作流程，例如注册用户，那么它们就是具有不同名称的控制器 (MVC)。但是，如果它们包含大量业务逻辑（我的意思是条件逻辑取决于实体或实体集的状态），那么我会仔细查看您是否可以通过使其明确来明确此逻辑拥有自己的班级或将其移至具有适当职责的班级。

更新：从它的声音来看，你的想法是正确的。您有一组类来处理您的业务流程的协调，这些类不关心它们是否被 WebService、Webform 或其他任何东西使用。然后你说你想在上面添加你的 WebService 层并利用这些类。这是一件好事（tm）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T12:30:24.483

听起来你的设计动机很好——代码的重用。在某些方面，它的动机类似于[Martin Fowler 的服务层](http://martinfowler.com/eaaCatalog/serviceLayer.html)。但是，您可能在这些 Manager 类中堆积了太多的职责。也许将基础设施问题（WAP 推送、用户持久性）与域问题（用户注册）分开。这种[关注点分离](http://en.wikipedia.org/wiki/Separation_of_concerns)将进一步提高可重用性并提高可维护性。

# security - 从 VBA (MS Access) 解密 PGP 加密文件的最简单方法

> ID：139046
> 
> 赞同：3
> 
> 时间：2008-09-26T12:15:14.317
> 
> 标签：security, ms-access, encryption, pgp

我需要编写从 FTP 位置获取 PGP 加密文件并处理它们的代码。这些文件将使用我的公钥加密（我还没有）。显然，我需要一个可以在 Microsoft Access 中使用的 PGP 库。能推荐一款好用的吗？

我正在寻找不需要大量 PKI 知识的东西。理想情况下，可以轻松生成一次性私钥/公钥对，然后有一个简单的解密例程。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T13:27:45.843

命令行解决方案很好。如果您的数据库是一个内部应用程序，而不是重新分发，我可以推荐[Gnu Privacy Guard](http://www.gnupg.org)。这个基于命令行的工具将允许您针对 OpenPGP 标准做任何您需要做的事情。

在 Access 中，您可以在宏中使用 Shell() 命令，如下所示：

```
Public Sub DecryptFile(ByVal FileName As String)
  Dim strCommand As String
  strCommand = "C:\Program Files\GNU\GnuPG\gpg.exe " _
  & "--batch --passphrase ""My PassPhrase that I used""" & FileName
  Shell strCommand, vbNormalFocus
End Sub 
```

这将运行命令行工具来解密文件。此语法使用您的秘密密码的明文版本。这不是最安全的解决方案，但如果您的数据库是内部数据库并且仅由受信任的人员使用，则可以接受。GnuPG 支持其他技术来保护密码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T12:33:39.373

PGP 有一个用于解密文件的命令行选项。

我们有一个执行解密的批处理文件，传入要解密的文件名：

批处理文件：

```
"C:\Program Files\Network Associates\PGPNT\pgp" +FORCE %1 -z *password* 
```

我们从 VBS 调用它：

```
 Command = "decrypt.bat """ & FolderName & FileName & """"

  'Executes the command script.
  Set objShell = WScript.CreateObject ("WSCript.shell")
  Command = "cmd /c " & Command
  objShell.run Command, 1, True 
```

希望能为您指明一个有用的方向。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-19T23:14:01.070

Stu...我曾经不得不用 Java 编写一个“安全 SMTP”服务器...最简单、最快捷的方法是下载和/或购买 PGP。他们有一个 SDK，你可以用它来访问任何你想要的东西。

我必须回去看看我是否必须编写一个 COM 包装器，或者他们是否已经有了一个。（大约 10 年前我写了这个 SMTP 服务器）。无论如何，不​​要气馁。大约 5 年前，我用 C++ 编写了一个完整的基于 PGP 的应用程序（基于 openPGP RFC），但问题是，我*不允许*使用任何现有的库。所以我不得不自己写所有这些东西。而且，我使用 GPG、OpenPGP 和 PGP 进行测试等......

因此，我什至可以为您提供有关如何在 VBA 中解码这些内容的帮助。这不是不可能的，（它可能慢得要命，但并非不可能），而且我不是一个“为你掏出并运行 cmdline 的东西来为你做这样的工作，因为它会让你面临一些严重的安全风险，因为 hurcane 的建议（例如）会导致您的密码短语显示给 ProcExp 等工具。第一步是了解 PKE 的工作原理等。然后，您需要执行哪些步骤才能获得所需的内容。

这是我有兴趣提供帮助的事情，因为我总是编写每个人都说无法完成的代码。:) 另外，由于合并、关闭等原因，我拥有我编写的应用程序的源代码......

它最初是为石油和天然气行业编写的，所以我知道它是安全的。这并不是说我的代码没有*任何*安全漏洞，但我认为它是稳定的。我知道我的中文 Remainder Threory 代码有问题。由于某种原因，当我使用该快捷方式时，我无法正确解码数据，但如果我使用 RSA “long way”它就可以了……

现在，这个应用程序从未完全完成，所以我不支持 DSA 密钥对之类的东西，但我确实支持 RSA 密钥对，使用 SHA1、MD5、使用 IDEA、AES，（我*认为*我的 3DES 代码无法正常工作，但我可能已经解决了这个问题）。我还没有实现压缩，等等......但是，我很想有理由回去再次处理这段代码。

我 /COULD/ 为您创建一个 COM 对象，您可以从 VBA 调用该对象，将原始 Base64 数据以及 Base64 密钥数据（或指向磁盘上的密钥文件的指针）以及用于解码文件的密码... .

想一想……告诉我……

多年来，我收集了用于执行 MD5、SHA1、IDEA 和其他加密例程之类的 vbScript 代码，但我没有编写它们。天哪，您可能只需要与 Microsoft 的 CryptoAPI 交互，然后将每个操作分解为其核心部分，然后仍然可以正常工作。（你不会找到像“DecryptPGP()”这样的 Micosoft CryptoAPI 调用......这一切都必须分块完成）。

让我知道我是否可以提供帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-20T08:33:45.633

您可以为此使用OpenPGPBlackbox [（ActiveX 版本）](http://www.eldos.com/sbbdev/activex-pgp.php)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T12:27:55.050

我会寻找一个命令行加密器/解密器，然后使用正确的参数从您的 Access 应用程序中调用 exe。

据我所知，VBA 中没有 PGP 加密器/解密器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T12:33:05.083

我不熟悉 VBA for Access，但我认为最好的解决方案（也许是最简单的）是运行外部命令行 PGP 实用程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T12:43:17.633

您可以直接从 VBA 应用程序调用一个 DLL，而无需跨越外部程序： [CryptoCX](http://www.easybyte.com/products/cryptocx.html)。PGP 还有一个可以调用的 DLL。

# .net - 保护组件，使其不能被第三方使用

> ID：139053
> 
> 赞同：5
> 
> 时间：2008-09-26T12:17:59.067
> 
> 标签：.net, security

我编写了一个我不希望其他人能够使用的程序集。我的程序集使用强名称密钥文件签名，但是如何保护代码，以便只有使用相同密钥签名的其他程序集才能调用此程序集中的成员？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T15:04:27.047

有几个选项，没有一个非常有效，因为它们只会让事情变得有点困难，但不会阻止忠诚的用户解决任何限制：

在每个入口点上，您都可以调用 Assembly.GetCallingAssembly() 并将结果与​​允许调用库的程序集列表进行比较，否则抛出异常。

您可以使用像 ilmerge 这样的工具将您的程序集合并到您的主应用程序中，并将所有内部标记为私有。与混淆器结合使用，可以更好地保护结果。

但是保护程序集就像保护攻击者可以物理访问它的计算机一样可靠：一旦授予物理访问权限，您几乎无法保护内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T12:24:52.297

需要添加 StrongNameIdentityPermissionAttributeattributes 来要求安全

例如

```
[assembly:StrongNameIdentityPermissionAttribute(SecurityAction.RequestMinimum, 
 PublicKey="00240000048000009400000006020000002400005253413100040000010001005" +
 "38a4a19382e9429cf516dcf1399facdccca092a06442efaf9ecaca33457be26ee0073c6bde5" +
 "1fe0873666a62459581669b510ae1e84bef6bcb1aff7957237279d8b7e0e25b71ad39df3684" +
 "5b7db60382c8eb73f289823578d33c09e48d0d2f90ed4541e1438008142ef714bfe604c41a4" +
 "957a4f6e6ab36b9715ec57625904c6")] 
```

有关详细信息，请参阅此[msdn 页面](http://msdn.microsoft.com/en-us/library/system.security.permissions.strongnameidentitypermissionattribute.aspx)

或在代码中执行[此示例](http://www.csharphelp.com/archives/archive203.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T12:26:31.480

我建议您使用 LicenseProvider 属性来保护您的程序集的使用。有关确切用法的更多信息，请参阅[MSDN 此处](http://msdn.microsoft.com/en-us/library/system.componentmodel.licenseproviderattribute.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T12:27:56.890

不确定这是否是最佳选择，但您可以将程序集中的所有“公共”类设为内部，然后使用 [InternalsVisibleTo] 程序集级别属性显式指定您的其他签名程序集。

```
[assembly: InternalsVisibleTo('MyAssembly,Version=1.0.0.1, Culture=neutral,PublicKeyToken=..."); 
```

[这](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)是有关该属性的 MSDN 文档。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T12:32:21.293

起初，我认为您可以将已签名程序集中的成员/类设为私有，并将程序集级[InternalsVisibleTo 属性](http://msdn.microsoft.com/en-us/library/bb385840.aspx)应用于您的其他程序集。我猜想反射会让你破解它。

也许[StrongNameIdentityPermission](http://msdn.microsoft.com/en-us/library/system.security.permissions.strongnameidentitypermission.aspx)是您正在寻找的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T12:24:00.533

在我看来，这是一个不可能的问题。你不能相信你的环境。这是一个基本的计算原理，也是公钥/私钥加密的原因。

# eclipse - 颠覆性连接器不适用于最新的 Ganymede 更新

> ID：139055
> 
> 赞同：5
> 
> 时间：2008-09-26T12:18:09.440
> 
> 标签：eclipse, svn, eclipse-3.4, subversive, ganymede

我在 Ganymede 中使用 Subversive 插件，但是在今天的更新之后它停止工作 - 它只是看不到任何有效的 svn 连接器（我已经使用 1.2.0 开发版的 SVNKit，而不是稳定版，因为 Subversive / Ganymede 无法处理它；现在它甚至无法处理开发者）。任何想法如何使它工作？颠覆性的家伙很快就会发布他们的插件/连接器的新版本吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-27T10:33:50.603

更新后我遇到了类似的问题。事实证明，我从 Polarion 站点获取了 URL 中包含“ganymede”的连接器（基本连接器以及 SVNKit 和 JavaHL 连接器）。相反，我应该一直使用通用 URL。

检查我当前的配置，您应该使用此更新 URL：

```
http://www.polarion.org/projects/subversive/download/eclipse/2.0/update-site/ 
```

我一直在使用的，如果你正在使用它应该被弃用，是：

```
http://www.polarion.org/projects/subversive/download/eclipse/2.0/ganymede-site/ 
```

注意区别。一旦我改变了它，我就可以下载连接器的 2.0.3 版本，Subversion 再次为我工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T12:35:32.347

我在 Ganymede 中成功使用了[Subclipse](http://subclipse.tigris.org/)，也许你能切换一下？我确实记得 SvnKit 也有问题，我正在使用 JavaHL 客户端。

# java - 如何从 Java 漂亮地打印 XML？

> ID：139076
> 
> 赞同：481
> 
> 时间：2008-09-26T12:21:11.400
> 
> 标签：java, xml, pretty-print

我有一个包含 XML 的 Java 字符串，没有换行符或缩进。我想把它变成一个格式很好的 XML 的字符串。我该怎么做呢？

```
String unformattedXml = "<tag><nested>hello</nested></tag>";
String formattedXml = new [UnknownClass]().format(unformattedXml); 
```

注意：我的输入是**String**。我的输出是一个**String**。

（基本）模拟结果：

```
<?xml version="1.0" encoding="UTF-8"?>
<root>
  <tag>
    <nested>hello</nested>
  </tag>
</root> 
```

* * *

## 回答 #1

> 赞同：288
> 
> 时间：2008-09-26T12:26:41.027

```
Transformer transformer = TransformerFactory.newInstance().newTransformer();
transformer.setOutputProperty(OutputKeys.INDENT, "yes");
transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");
// initialize StreamResult with File object to save to file
StreamResult result = new StreamResult(new StringWriter());
DOMSource source = new DOMSource(doc);
transformer.transform(source, result);
String xmlString = result.getWriter().toString();
System.out.println(xmlString); 
```

注意：结果可能因 Java 版本而异。搜索特定于您的平台的解决方法。

* * *

## 回答 #2

> 赞同：138
> 
> 时间：2008-09-26T13:13:15.330

这是我自己的问题的答案。我结合了各种结果的答案，编写了一个漂亮地打印 XML 的类。

不保证它如何响应无效的 XML 或大型文档。

```
package ecb.sdw.pretty;

import org.apache.xml.serialize.OutputFormat;
import org.apache.xml.serialize.XMLSerializer;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import java.io.IOException;
import java.io.StringReader;
import java.io.StringWriter;
import java.io.Writer;

/**
 * Pretty-prints xml, supplied as a string.
 * <p/>
 * eg.
 * <code>
 * String formattedXml = new XmlFormatter().format("<tag><nested>hello</nested></tag>");
 * </code>
 */
public class XmlFormatter {

    public XmlFormatter() {
    }

    public String format(String unformattedXml) {
        try {
            final Document document = parseXmlFile(unformattedXml);

            OutputFormat format = new OutputFormat(document);
            format.setLineWidth(65);
            format.setIndenting(true);
            format.setIndent(2);
            Writer out = new StringWriter();
            XMLSerializer serializer = new XMLSerializer(out, format);
            serializer.serialize(document);

            return out.toString();
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

    private Document parseXmlFile(String in) {
        try {
            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
            DocumentBuilder db = dbf.newDocumentBuilder();
            InputSource is = new InputSource(new StringReader(in));
            return db.parse(is);
        } catch (ParserConfigurationException e) {
            throw new RuntimeException(e);
        } catch (SAXException e) {
            throw new RuntimeException(e);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

    public static void main(String[] args) {
        String unformattedXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><QueryMessage\n" +
                        "        xmlns=\"http://www.SDMX.org/resources/SDMXML/schemas/v2_0/message\"\n" +
                        "        xmlns:query=\"http://www.SDMX.org/resources/SDMXML/schemas/v2_0/query\">\n" +
                        "    <Query>\n" +
                        "        <query:CategorySchemeWhere>\n" +
                        "   \t\t\t\t\t         <query:AgencyID>ECB\n\n\n\n</query:AgencyID>\n" +
                        "        </query:CategorySchemeWhere>\n" +
                        "    </Query>\n\n\n\n\n" +
                        "</QueryMessage>";

        System.out.println(new XmlFormatter().format(unformattedXml));
    }

} 
```

* * *

## 回答 #3

> 赞同：138
> 
> 时间：2009-08-12T08:22:57.870

[基于此答案的更简单的解决方案](https://stackoverflow.com/questions/1264849/pretty-printing-output-from-javax-xml-transform-transformer-with-only-standard-ja/1264872#1264872)：

```
public static String prettyFormat(String input, int indent) {
    try {
        Source xmlInput = new StreamSource(new StringReader(input));
        StringWriter stringWriter = new StringWriter();
        StreamResult xmlOutput = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        transformerFactory.setAttribute("indent-number", indent);
        transformerFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
        transformerFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
        Transformer transformer = transformerFactory.newTransformer(); 
        transformer.setOutputProperty(OutputKeys.INDENT, "yes");
        transformer.transform(xmlInput, xmlOutput);
        return xmlOutput.getWriter().toString();
    } catch (Exception e) {
        throw new RuntimeException(e); // simple exception handling, please review it
    }
}

public static String prettyFormat(String input) {
    return prettyFormat(input, 2);
} 
```

测试用例：

```
prettyFormat("<root><child>aaa</child><child/></root>"); 
```

返回：

```
<?xml version="1.0" encoding="UTF-8"?>
<root>
  <child>aaa</child>
  <child/>
</root> 
```

//忽略：原始编辑只需要在代码中的类名中缺少s。添加了多余的六个字符以在 SO 上获得超过 6 个字符的验证

* * *

## 回答 #4

> 赞同：105
> 
> 时间：2012-07-17T09:29:18.570

现在是 2012 年，Java 可以比以前使用 XML 做更多的事情，我想为我接受的答案添加一个替代方案。这在 Java 6 之外没有依赖关系。

```
import org.w3c.dom.Node;
import org.w3c.dom.bootstrap.DOMImplementationRegistry;
import org.w3c.dom.ls.DOMImplementationLS;
import org.w3c.dom.ls.LSSerializer;
import org.xml.sax.InputSource;

import javax.xml.parsers.DocumentBuilderFactory;
import java.io.StringReader;

/**
 * Pretty-prints xml, supplied as a string.
 * <p/>
 * eg.
 * <code>
 * String formattedXml = new XmlFormatter().format("<tag><nested>hello</nested></tag>");
 * </code>
 */
public class XmlFormatter {

    public String format(String xml) {

        try {
            final InputSource src = new InputSource(new StringReader(xml));
            final Node document = DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(src).getDocumentElement();
            final Boolean keepDeclaration = Boolean.valueOf(xml.startsWith("<?xml"));

        //May need this: System.setProperty(DOMImplementationRegistry.PROPERTY,"com.sun.org.apache.xerces.internal.dom.DOMImplementationSourceImpl");

            final DOMImplementationRegistry registry = DOMImplementationRegistry.newInstance();
            final DOMImplementationLS impl = (DOMImplementationLS) registry.getDOMImplementation("LS");
            final LSSerializer writer = impl.createLSSerializer();

            writer.getDomConfig().setParameter("format-pretty-print", Boolean.TRUE); // Set this to true if the output needs to be beautified.
            writer.getDomConfig().setParameter("xml-declaration", keepDeclaration); // Set this to true if the declaration is needed to be outputted.

            return writer.writeToString(document);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public static void main(String[] args) {
        String unformattedXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><QueryMessage\n" +
                        "        xmlns=\"http://www.SDMX.org/resources/SDMXML/schemas/v2_0/message\"\n" +
                        "        xmlns:query=\"http://www.SDMX.org/resources/SDMXML/schemas/v2_0/query\">\n" +
                        "    <Query>\n" +
                        "        <query:CategorySchemeWhere>\n" +
                        "   \t\t\t\t\t         <query:AgencyID>ECB\n\n\n\n</query:AgencyID>\n" +
                        "        </query:CategorySchemeWhere>\n" +
                        "    </Query>\n\n\n\n\n" +
                        "</QueryMessage>";

        System.out.println(new XmlFormatter().format(unformattedXml));
    }
} 
```

* * *

## 回答 #5

> 赞同：54
> 
> 时间：2010-12-17T16:27:31.120

请注意，评分最高的答案需要使用 xerces。

如果您不想添加此外部依赖项，则可以简单地使用标准 jdk 库（实际上是在内部使用 xerces 构建的）。

注意 jdk 1.5 版有一个错误，请参阅[http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6296446](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6296446)但现在已解决。

（注意如果发生错误，这将返回原始文本）

```
package com.test;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;

import javax.xml.transform.OutputKeys;
import javax.xml.transform.Source;
import javax.xml.transform.Transformer;
import javax.xml.transform.sax.SAXSource;
import javax.xml.transform.sax.SAXTransformerFactory;
import javax.xml.transform.stream.StreamResult;

import org.xml.sax.InputSource;

public class XmlTest {
    public static void main(String[] args) {
        XmlTest t = new XmlTest();
        System.out.println(t.formatXml("<a><b><c/><d>text D</d><e value='0'/></b></a>"));
    }

    public String formatXml(String xml){
        try{
            Transformer serializer= SAXTransformerFactory.newInstance().newTransformer();
            serializer.setOutputProperty(OutputKeys.INDENT, "yes");
            //serializer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");
            serializer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");
            //serializer.setOutputProperty("{http://xml.customer.org/xslt}indent-amount", "2");
            Source xmlSource=new SAXSource(new InputSource(new ByteArrayInputStream(xml.getBytes())));
            StreamResult res =  new StreamResult(new ByteArrayOutputStream());            
            serializer.transform(xmlSource, res);
            return new String(((ByteArrayOutputStream)res.getOutputStream()).toByteArray());
        }catch(Exception e){
            //TODO log error
            return xml;
        }
    }

} 
```

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2008-11-03T23:22:37.973

我过去使用**org.dom4j.io.OutputFormat.createPrettyPrint()**方法打印得很漂亮

```
public String prettyPrint(final String xml){  

    if (StringUtils.isBlank(xml)) {
        throw new RuntimeException("xml was null or blank in prettyPrint()");
    }

    final StringWriter sw;

    try {
        final OutputFormat format = OutputFormat.createPrettyPrint();
        final org.dom4j.Document document = DocumentHelper.parseText(xml);
        sw = new StringWriter();
        final XMLWriter writer = new XMLWriter(sw, format);
        writer.write(document);
    }
    catch (Exception e) {
        throw new RuntimeException("Error pretty printing xml:\n" + xml, e);
    }
    return sw.toString();
} 
```

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2010-04-08T10:29:00.610

这是使用[dom4j](http://www.dom4j.org/dom4j-1.6.1/)的一种方法：

进口：

```
import org.dom4j.Document;  
import org.dom4j.DocumentHelper;  
import org.dom4j.io.OutputFormat;  
import org.dom4j.io.XMLWriter; 
```

代码：

```
String xml = "<your xml='here'/>";  
Document doc = DocumentHelper.parseText(xml);  
StringWriter sw = new StringWriter();  
OutputFormat format = OutputFormat.createPrettyPrint();  
XMLWriter xw = new XMLWriter(sw, format);  
xw.write(doc);  
String result = sw.toString(); 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2008-09-26T12:58:23.230

由于`String`您是`DOM`从. 但是，如果您知道您的 XML 字符串是有效的，并且您不想产生将字符串解析为 DOM 的内存开销，那么在 DOM 上运行转换以获取字符串 - 您可以做一些老式的逐个字符解析。在每个字符后插入一个换行符和空格，保留并缩进计数器（以确定空格数），为每个字符递增，为每个看到的字符递减。`Node``Transformer``</...>``<...>``</...>`

免责声明 - 我对以下函数进行了剪切/粘贴/文本编辑，因此它们可能无法按原样编译。

```
public static final Element createDOM(String strXML) 
    throws ParserConfigurationException, SAXException, IOException {

    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
    dbf.setValidating(true);
    DocumentBuilder db = dbf.newDocumentBuilder();
    InputSource sourceXML = new InputSource(new StringReader(strXML));
    Document xmlDoc = db.parse(sourceXML);
    Element e = xmlDoc.getDocumentElement();
    e.normalize();
    return e;
}

public static final void prettyPrint(Node xml, OutputStream out)
    throws TransformerConfigurationException, TransformerFactoryConfigurationError, TransformerException {
    Transformer tf = TransformerFactory.newInstance().newTransformer();
    tf.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");
    tf.setOutputProperty(OutputKeys.ENCODING, "UTF-8");
    tf.setOutputProperty(OutputKeys.INDENT, "yes");
    tf.transform(new DOMSource(xml), new StreamResult(out));
} 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2010-05-27T10:50:22.450

Kevin Hakanson 说：“但是，如果您知道您的 XML 字符串是有效的，并且您不想招致将字符串解析为 DOM 的内存开销，然后在 DOM 上运行转换以获取字符串 - 您可以只需逐个字符解析一些老式字符。在每个字符后插入换行符和空格，保留并缩进计数器（以确定空格数），为每个 <...> 增加并为每个看到的减少。

同意。这种方法要快得多，并且依赖性要少得多。

示例解决方案：

```
/**
 * XML utils, including formatting.
 */
public class XmlUtils
{
  private static XmlFormatter formatter = new XmlFormatter(2, 80);

  public static String formatXml(String s)
  {
    return formatter.format(s, 0);
  }

  public static String formatXml(String s, int initialIndent)
  {
    return formatter.format(s, initialIndent);
  }

  private static class XmlFormatter
  {
    private int indentNumChars;
    private int lineLength;
    private boolean singleLine;

    public XmlFormatter(int indentNumChars, int lineLength)
    {
      this.indentNumChars = indentNumChars;
      this.lineLength = lineLength;
    }

    public synchronized String format(String s, int initialIndent)
    {
      int indent = initialIndent;
      StringBuilder sb = new StringBuilder();
      for (int i = 0; i < s.length(); i++)
      {
        char currentChar = s.charAt(i);
        if (currentChar == '<')
        {
          char nextChar = s.charAt(i + 1);
          if (nextChar == '/')
            indent -= indentNumChars;
          if (!singleLine)   // Don't indent before closing element if we're creating opening and closing elements on a single line.
            sb.append(buildWhitespace(indent));
          if (nextChar != '?' && nextChar != '!' && nextChar != '/')
            indent += indentNumChars;
          singleLine = false;  // Reset flag.
        }
        sb.append(currentChar);
        if (currentChar == '>')
        {
          if (s.charAt(i - 1) == '/')
          {
            indent -= indentNumChars;
            sb.append("\n");
          }
          else
          {
            int nextStartElementPos = s.indexOf('<', i);
            if (nextStartElementPos > i + 1)
            {
              String textBetweenElements = s.substring(i + 1, nextStartElementPos);

              // If the space between elements is solely newlines, let them through to preserve additional newlines in source document.
              if (textBetweenElements.replaceAll("\n", "").length() == 0)
              {
                sb.append(textBetweenElements + "\n");
              }
              // Put tags and text on a single line if the text is short.
              else if (textBetweenElements.length() <= lineLength * 0.5)
              {
                sb.append(textBetweenElements);
                singleLine = true;
              }
              // For larger amounts of text, wrap lines to a maximum line length.
              else
              {
                sb.append("\n" + lineWrap(textBetweenElements, lineLength, indent, null) + "\n");
              }
              i = nextStartElementPos - 1;
            }
            else
            {
              sb.append("\n");
            }
          }
        }
      }
      return sb.toString();
    }
  }

  private static String buildWhitespace(int numChars)
  {
    StringBuilder sb = new StringBuilder();
    for (int i = 0; i < numChars; i++)
      sb.append(" ");
    return sb.toString();
  }

  /**
   * Wraps the supplied text to the specified line length.
   * @lineLength the maximum length of each line in the returned string (not including indent if specified).
   * @indent optional number of whitespace characters to prepend to each line before the text.
   * @linePrefix optional string to append to the indent (before the text).
   * @returns the supplied text wrapped so that no line exceeds the specified line length + indent, optionally with
   * indent and prefix applied to each line.
   */
  private static String lineWrap(String s, int lineLength, Integer indent, String linePrefix)
  {
    if (s == null)
      return null;

    StringBuilder sb = new StringBuilder();
    int lineStartPos = 0;
    int lineEndPos;
    boolean firstLine = true;
    while(lineStartPos < s.length())
    {
      if (!firstLine)
        sb.append("\n");
      else
        firstLine = false;

      if (lineStartPos + lineLength > s.length())
        lineEndPos = s.length() - 1;
      else
      {
        lineEndPos = lineStartPos + lineLength - 1;
        while (lineEndPos > lineStartPos && (s.charAt(lineEndPos) != ' ' && s.charAt(lineEndPos) != '\t'))
          lineEndPos--;
      }
      sb.append(buildWhitespace(indent));
      if (linePrefix != null)
        sb.append(linePrefix);

      sb.append(s.substring(lineStartPos, lineEndPos + 1));
      lineStartPos = lineEndPos + 1;
    }
    return sb.toString();
  }

  // other utils removed for brevity
} 
```

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2009-06-07T16:26:27.947

[如果可以使用 3rd 方 XML 库，那么您可以使用比当前投票率最高的](https://stackoverflow.com/questions/139076/how-to-pretty-print-xml-from-java/139096#139096) [答案](https://stackoverflow.com/questions/139076/how-to-pretty-print-xml-from-java/139333#139333)建议 的要简单得多的东西。

据说输入和输出都应该是字符串，所以这是一个使用**[XOM](http://xom.nu)**库实现的实用方法：

```
import nu.xom.*;
import java.io.*;

[...]

public static String format(String xml) throws ParsingException, IOException {
    ByteArrayOutputStream out = new ByteArrayOutputStream();
    Serializer serializer = new Serializer(out);
    serializer.setIndent(4);  // or whatever you like
    serializer.write(new Builder().build(xml, ""));
    return out.toString("UTF-8");
} 
```

我测试了它是否有效，结果*不*取决于您的 JRE 版本或类似的东西。要了解如何根据自己的喜好自定义输出格式，请查看[`Serializer`](http://xom.nu/apidocs/nu/xom/Serializer.html)API。

这实际上比我想象的要长 - 需要一些额外的行，因为`Serializer`想要`OutputStream`写入。但请注意，这里几乎没有用于实际操作 XML 的代码。

（这个答案是我对 XOM 的评估的一部分，在我[关于替换 dom4j 的最佳 Java XML 库的问题中，它被](https://stackoverflow.com/questions/831865/what-java-xml-library-do-you-recommend-to-replace-dom4j)[建议](https://stackoverflow.com/questions/831865/what-java-xml-library-do-you-recommend-to-replace-dom4j/833241#833241)作为一个选项。作为记录，使用 dom4j，您可以使用和类似轻松地实现这一点。**编辑**：.. .如mlo55[的回答所示](https://stackoverflow.com/questions/139076/how-to-pretty-print-xml-from-java/260314#260314)。）[`XMLWriter`](http://dom4j.org/dom4j-1.6.1/apidocs/org/dom4j/io/XMLWriter.html)[`OutputFormat`](http://dom4j.org/dom4j-1.6.1/apidocs/org/dom4j/io/OutputFormat.html)

 *** * *

## 回答 #11

> 赞同：11
> 
> 时间：2009-12-22T19:26:31.643

嗯......遇到了这样的事情，这是一个已知的错误......只需添加这个 OutputProperty ..

```
transformer.setOutputProperty(OutputPropertiesFactory.S_KEY_INDENT_AMOUNT, "8"); 
```

希望这可以帮助 ...

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2009-02-26T19:54:53.660

关于“您必须首先构建 DOM 树”的评论：不，您不需要也不应该这样做。

相反，创建一个 StreamSource (new StreamSource(new StringReader(str))，并将其提供给提到的身份转换器。这将使用 SAX 解析器，结果会更快。在这种情况下，构建中间树纯粹是开销。否则排名靠前的答案是好的。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2011-03-08T01:58:41.720

使用斯卡拉：

```
import xml._
val xml = XML.loadString("<tag><nested>hello</nested></tag>")
val formatted = new PrettyPrinter(150, 2).format(xml)
println(formatted) 
```

如果您依赖 scala-library.jar，您也可以在 Java 中执行此操作。它看起来像这样：

```
import scala.xml.*;

public class FormatXML {
    public static void main(String[] args) {
        String unformattedXml = "<tag><nested>hello</nested></tag>";
        PrettyPrinter pp = new PrettyPrinter(150, 3);
        String formatted = pp.format(XML.loadString(unformattedXml), TopScope$.MODULE$);
        System.out.println(formatted);
    }
} 
```

该`PrettyPrinter`对象由两个整数构成，第一个是最大行长，第二个是缩进步骤。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2014-07-09T10:17:46.987

[来自milosmns](https://stackoverflow.com/a/21736245/619587)的略微改进的版本......

```
public static String getPrettyXml(String xml) {
    if (xml == null || xml.trim().length() == 0) return "";

    int stack = 0;
    StringBuilder pretty = new StringBuilder();
    String[] rows = xml.trim().replaceAll(">", ">\n").replaceAll("<", "\n<").split("\n");

    for (int i = 0; i < rows.length; i++) {
        if (rows[i] == null || rows[i].trim().length() == 0) continue;

        String row = rows[i].trim();
        if (row.startsWith("<?")) {
            pretty.append(row + "\n");
        } else if (row.startsWith("</")) {
            String indent = repeatString(--stack);
            pretty.append(indent + row + "\n");
        } else if (row.startsWith("<") && row.endsWith("/>") == false) {
            String indent = repeatString(stack++);
            pretty.append(indent + row + "\n");
            if (row.endsWith("]]>")) stack--;
        } else {
            String indent = repeatString(stack);
            pretty.append(indent + row + "\n");
        }
    }

    return pretty.toString().trim();
}

private static String repeatString(int stack) {
     StringBuilder indent = new StringBuilder();
     for (int i = 0; i < stack; i++) {
        indent.append(" ");
     }
     return indent.toString();
} 
```

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2011-10-10T14:43:05.040

仅供将来参考，这是一个对我有用的解决方案（感谢@George Hawkins 在其中一个答案中发布的评论）：

```
DOMImplementationRegistry registry = DOMImplementationRegistry.newInstance();
DOMImplementationLS impl = (DOMImplementationLS) registry.getDOMImplementation("LS");
LSSerializer writer = impl.createLSSerializer();
writer.getDomConfig().setParameter("format-pretty-print", Boolean.TRUE);
LSOutput output = impl.createLSOutput();
ByteArrayOutputStream out = new ByteArrayOutputStream();
output.setByteStream(out);
writer.write(document, output);
String xmlStr = new String(out.toByteArray()); 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2015-05-13T11:27:01.927

以上所有解决方案都对我不起作用，然后我发现了这个[http://myshittycode.com/2014/02/10/java-properly-indenting-xml-string/](http://myshittycode.com/2014/02/10/java-properly-indenting-xml-string/)

线索是使用 XPath 删除空格

```
 String xml = "<root>" +
             "\n   " +
             "\n<name>Coco Puff</name>" +
             "\n        <total>10</total>    </root>";

try {
    Document document = DocumentBuilderFactory.newInstance()
            .newDocumentBuilder()
            .parse(new InputSource(new ByteArrayInputStream(xml.getBytes("utf-8"))));

    XPath xPath = XPathFactory.newInstance().newXPath();
    NodeList nodeList = (NodeList) xPath.evaluate("//text()[normalize-space()='']",
                                                  document,
                                                  XPathConstants.NODESET);

    for (int i = 0; i < nodeList.getLength(); ++i) {
        Node node = nodeList.item(i);
        node.getParentNode().removeChild(node);
    }

    Transformer transformer = TransformerFactory.newInstance().newTransformer();
    transformer.setOutputProperty(OutputKeys.ENCODING, "UTF-8");
    transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");
    transformer.setOutputProperty(OutputKeys.INDENT, "yes");
    transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "4");

    StringWriter stringWriter = new StringWriter();
    StreamResult streamResult = new StreamResult(stringWriter);

    transformer.transform(new DOMSource(document), streamResult);

    System.out.println(stringWriter.toString());
}
catch (Exception e) {
    e.printStackTrace();
} 
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2016-06-02T18:31:39.430

下面的代码完美运行

```
import javax.xml.transform.OutputKeys;
import javax.xml.transform.Source;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.stream.StreamResult;
import javax.xml.transform.stream.StreamSource;

String formattedXml1 = prettyFormat("<root><child>aaa</child><child/></root>");

public static String prettyFormat(String input) {
    return prettyFormat(input, "2");
}

public static String prettyFormat(String input, String indent) {
    Source xmlInput = new StreamSource(new StringReader(input));
    StringWriter stringWriter = new StringWriter();
    try {
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.setOutputProperty(OutputKeys.INDENT, "yes");
        transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", indent);
        transformer.transform(xmlInput, new StreamResult(stringWriter));

        String pretty = stringWriter.toString();
        pretty = pretty.replace("\r\n", "\n");
        return pretty;              
    } catch (Exception e) {
        throw new RuntimeException(e);
    }
} 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2018-07-10T19:47:32.813

我混合所有这些并编写一个小程序。它正在从 xml 文件中读取并打印出来。只是代替 xzy 给你的文件路径。

```
 public static void main(String[] args) throws Exception {
    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
    dbf.setValidating(false);
    DocumentBuilder db = dbf.newDocumentBuilder();
    Document doc = db.parse(new FileInputStream(new File("C:/Users/xyz.xml")));
    prettyPrint(doc);

}

private static String prettyPrint(Document document)
        throws TransformerException {
    TransformerFactory transformerFactory = TransformerFactory
            .newInstance();
    Transformer transformer = transformerFactory.newTransformer();
    transformer.setOutputProperty(OutputKeys.INDENT, "yes");
    transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");
    transformer.setOutputProperty(OutputKeys.ENCODING, "UTF-8");
    transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "no");
    DOMSource source = new DOMSource(document);
    StringWriter strWriter = new StringWriter();
    StreamResult result = new StreamResult(strWriter);transformer.transform(source, result);
    System.out.println(strWriter.getBuffer().toString());

    return strWriter.getBuffer().toString();

} 
```

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2014-02-12T18:16:24.437

如果您确定您有一个有效的 XML，那么这个很简单，并且避免了 XML DOM 树。也许有一些错误，如果您看到任何内容，请发表评论

```
public String prettyPrint(String xml) {
            if (xml == null || xml.trim().length() == 0) return "";

            int stack = 0;
            StringBuilder pretty = new StringBuilder();
            String[] rows = xml.trim().replaceAll(">", ">\n").replaceAll("<", "\n<").split("\n");

            for (int i = 0; i < rows.length; i++) {
                    if (rows[i] == null || rows[i].trim().length() == 0) continue;

                    String row = rows[i].trim();
                    if (row.startsWith("<?")) {
                            // xml version tag
                            pretty.append(row + "\n");
                    } else if (row.startsWith("</")) {
                            // closing tag
                            String indent = repeatString("    ", --stack);
                            pretty.append(indent + row + "\n");
                    } else if (row.startsWith("<")) {
                            // starting tag
                            String indent = repeatString("    ", stack++);
                            pretty.append(indent + row + "\n");
                    } else {
                            // tag data
                            String indent = repeatString("    ", stack);
                            pretty.append(indent + row + "\n");
                    }
            }

            return pretty.toString().trim();
    } 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2015-07-22T18:45:00.773

对我们有用的另一种解决方案

```
import java.io.StringWriter;
import org.dom4j.DocumentHelper;
import org.dom4j.io.OutputFormat;
import org.dom4j.io.XMLWriter;

**
 * Pretty Print XML String
 * 
 * @param inputXmlString
 * @return
 */
public static String prettyPrintXml(String xml) {

    final StringWriter sw;

    try {
        final OutputFormat format = OutputFormat.createPrettyPrint();
        final org.dom4j.Document document = DocumentHelper.parseText(xml);
        sw = new StringWriter();
        final XMLWriter writer = new XMLWriter(sw, format);
        writer.write(document);
    }
    catch (Exception e) {
        throw new RuntimeException("Error pretty printing xml:\n" + xml, e);
    }
    return sw.toString();
} 
```

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2015-05-11T15:00:47.757

使用 jdom2： http: [//www.jdom.org/](http://www.jdom.org/)

```
import java.io.StringReader;
import org.jdom2.input.SAXBuilder;
import org.jdom2.output.Format;
import org.jdom2.output.XMLOutputter;

String prettyXml = new XMLOutputter(Format.getPrettyFormat()).
                         outputString(new SAXBuilder().build(new StringReader(uglyXml))); 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2014-12-28T22:25:09.383

作为[max](https://stackoverflow.com/users/767434/max)、[codeskraps](https://stackoverflow.com/users/619587/codeskraps)、[David Easley](https://stackoverflow.com/users/65555/david-easley)和[milosmns](https://stackoverflow.com/users/2102748/milosmns)答案的替代方案，请查看我的轻量级、高性能漂亮打印机库：[xml-formatter](https://github.com/greenbird/xml-formatter-core)

```
// construct lightweight, threadsafe, instance
PrettyPrinter prettyPrinter = PrettyPrinterBuilder.newPrettyPrinter().build();

StringBuilder buffer = new StringBuilder();
String xml = ..; // also works with char[] or Reader

if(prettyPrinter.process(xml, buffer)) {
     // valid XML, print buffer
} else {
     // invalid XML, print xml
} 
```

有时，就像直接从文件运行模拟的 SOAP 服务时，最好有一个漂亮的打印机，它也可以处理已经漂亮打印的 XML：

```
PrettyPrinter prettyPrinter = PrettyPrinterBuilder.newPrettyPrinter().ignoreWhitespace().build(); 
```

正如一些人评论的那样，漂亮的打印只是以更易于阅读的形式呈现 XML 的一种方式 - 空格严格不属于您的 XML 数据。

该库旨在用于日志记录的漂亮打印，还包括用于过滤（子树删除/匿名化）和在 CDATA 和文本节点中漂亮打印 XML 的功能。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2010-06-11T20:30:15.983

我有同样的问题，我在 JTidy 上取得了巨大的成功（[http://jtidy.sourceforge.net/index.html](http://jtidy.sourceforge.net/index.html)）

例子：

```
Tidy t = new Tidy();
t.setIndentContent(true);
Document d = t.parseDOM(
    new ByteArrayInputStream("HTML goes here", null);

OutputStream out = new ByteArrayOutputStream();
t.pprint(d, out);
String html = out.toString(); 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2013-10-07T23:32:49.133

对于那些寻找快速而肮脏的解决方案的人 - 不需要 XML 100% 有效。例如，在 REST / SOAP 日志记录的情况下（你永远不知道其他人发送了什么;-)）

我发现并改进了我在网上找到的代码片段，我认为这里仍然缺少它作为一种有效的可能方法：

```
public static String prettyPrintXMLAsString(String xmlString) {
    /* Remove new lines */
    final String LINE_BREAK = "\n";
    xmlString = xmlString.replaceAll(LINE_BREAK, "");
    StringBuffer prettyPrintXml = new StringBuffer();
    /* Group the xml tags */
    Pattern pattern = Pattern.compile("(<[^/][^>]+>)?([^<]*)(</[^>]+>)?(<[^/][^>]+/>)?");
    Matcher matcher = pattern.matcher(xmlString);
    int tabCount = 0;
    while (matcher.find()) {
        String str1 = (null == matcher.group(1) || "null".equals(matcher.group())) ? "" : matcher.group(1);
        String str2 = (null == matcher.group(2) || "null".equals(matcher.group())) ? "" : matcher.group(2);
        String str3 = (null == matcher.group(3) || "null".equals(matcher.group())) ? "" : matcher.group(3);
        String str4 = (null == matcher.group(4) || "null".equals(matcher.group())) ? "" : matcher.group(4);

        if (matcher.group() != null && !matcher.group().trim().equals("")) {
            printTabs(tabCount, prettyPrintXml);
            if (!str1.equals("") && str3.equals("")) {
                ++tabCount;
            }
            if (str1.equals("") && !str3.equals("")) {
                --tabCount;
                prettyPrintXml.deleteCharAt(prettyPrintXml.length() - 1);
            }

            prettyPrintXml.append(str1);
            prettyPrintXml.append(str2);
            prettyPrintXml.append(str3);
            if (!str4.equals("")) {
                prettyPrintXml.append(LINE_BREAK);
                printTabs(tabCount, prettyPrintXml);
                prettyPrintXml.append(str4);
            }
            prettyPrintXml.append(LINE_BREAK);
        }
    }
    return prettyPrintXml.toString();
}

private static void printTabs(int count, StringBuffer stringBuffer) {
    for (int i = 0; i < count; i++) {
        stringBuffer.append("\t");
    }
}

public static void main(String[] args) {
    String x = new String(
            "<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"><soap:Body><soap:Fault><faultcode>soap:Client</faultcode><faultstring>INVALID_MESSAGE</faultstring><detail><ns3:XcbSoapFault xmlns=\"\" xmlns:ns3=\"http://www.someapp.eu/xcb/types/xcb/v1\"><CauseCode>20007</CauseCode><CauseText>INVALID_MESSAGE</CauseText><DebugInfo>Problems creating SAAJ object model</DebugInfo></ns3:XcbSoapFault></detail></soap:Fault></soap:Body></soap:Envelope>");
    System.out.println(prettyPrintXMLAsString(x));
} 
```

这是输出：

```
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
    <soap:Fault>
        <faultcode>soap:Client</faultcode>
        <faultstring>INVALID_MESSAGE</faultstring>
        <detail>
            <ns3:XcbSoapFault xmlns="" xmlns:ns3="http://www.someapp.eu/xcb/types/xcb/v1">
                <CauseCode>20007</CauseCode>
                <CauseText>INVALID_MESSAGE</CauseText>
                <DebugInfo>Problems creating SAAJ object model</DebugInfo>
            </ns3:XcbSoapFault>
        </detail>
    </soap:Fault>
  </soap:Body>
</soap:Envelope> 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2019-05-06T13:27:58.873

**我总是使用以下功能：**

```
public static String prettyPrintXml(String xmlStringToBeFormatted) {
    String formattedXmlString = null;
    try {
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        documentBuilderFactory.setValidating(true);
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        InputSource inputSource = new InputSource(new StringReader(xmlStringToBeFormatted));
        Document document = documentBuilder.parse(inputSource);

        Transformer transformer = TransformerFactory.newInstance().newTransformer();
        transformer.setOutputProperty(OutputKeys.INDENT, "yes");
        transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");

        StreamResult streamResult = new StreamResult(new StringWriter());
        DOMSource dOMSource = new DOMSource(document);
        transformer.transform(dOMSource, streamResult);
        formattedXmlString = streamResult.getWriter().toString().trim();
    } catch (Exception ex) {
        StringWriter sw = new StringWriter();
        ex.printStackTrace(new PrintWriter(sw));
        System.err.println(sw.toString());
    }
    return formattedXmlString;
} 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-09-26T14:38:17.920

有一个非常好的命令行 XML 实用程序，称为 xmlstarlet( [http://xmlstar.sourceforge.net/](http://xmlstar.sourceforge.net/) )，它可以做很多人使用的很多事情。

您可以使用 Runtime.exec 以编程方式执行该程序，然后读入格式化的输出文件。它具有比几行 Java 代码所能提供的更多选项和更好的错误报告。

下载 xmlstarlet： http: [//sourceforge.net/project/showfiles.php ?group_id=66612&package_id=64589](http://sourceforge.net/project/showfiles.php?group_id=66612&package_id=64589)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2012-07-05T19:36:29.060

我发现在 Java 1.6.0_32 中，漂亮打印 XML***字符串***的常规方法（使用带有 null 或标识 xslt 的 Transformer）的行为不像我想要的那样，如果标签仅由空格分隔，而不是没有分隔文本。我尝试`<xsl:strip-space elements="*"/>`在我的模板中使用无济于事。我发现的最简单的解决方案是使用 SAXSource 和 XML 过滤器以我想要的方式剥离空间。由于我的解决方案是用于日志记录，因此我还将其扩展为处理不完整的 XML 片段。请注意，如果您使用 DOMSource，正常方法似乎可以正常工作，但由于不完整和内存开销，我不想使用它。

```
public static class WhitespaceIgnoreFilter extends XMLFilterImpl
{

    @Override
    public void ignorableWhitespace(char[] arg0,
                                    int arg1,
                                    int arg2) throws SAXException
    {
        //Ignore it then...
    }

    @Override
    public void characters( char[] ch,
                            int start,
                            int length) throws SAXException
    {
        if (!new String(ch, start, length).trim().equals("")) 
               super.characters(ch, start, length); 
    }
}

public static String prettyXML(String logMsg, boolean allowBadlyFormedFragments) throws SAXException, IOException, TransformerException
    {
        TransformerFactory transFactory = TransformerFactory.newInstance();
        transFactory.setAttribute("indent-number", new Integer(2));
        Transformer transformer = transFactory.newTransformer();
        transformer.setOutputProperty(OutputKeys.INDENT, "yes");
        transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "4");
        StringWriter out = new StringWriter();
        XMLReader masterParser = SAXHelper.getSAXParser(true);
        XMLFilter parser = new WhitespaceIgnoreFilter();
        parser.setParent(masterParser);

        if(allowBadlyFormedFragments)
        {
            transformer.setErrorListener(new ErrorListener()
            {
                @Override
                public void warning(TransformerException exception) throws TransformerException
                {
                }

                @Override
                public void fatalError(TransformerException exception) throws TransformerException
                {
                }

                @Override
                public void error(TransformerException exception) throws TransformerException
                {
                }
            });
        }

        try
        {
            transformer.transform(new SAXSource(parser, new InputSource(new StringReader(logMsg))), new StreamResult(out));
        }
        catch (TransformerException e)
        {
            if(e.getCause() != null && e.getCause() instanceof SAXParseException)
            {
                if(!allowBadlyFormedFragments || !"XML document structures must start and end within the same entity.".equals(e.getCause().getMessage()))
                {
                    throw e;
                }
            }
            else
            {
                throw e;
            }
        }
        out.flush();
        return out.toString();
    } 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2014-10-14T12:47:25.197

如果代码已经格式化，我在这里找到的 Java 1.6+ 解决方案不会重新格式化代码。对我有用的一个（并重新格式化了已经格式化的代码）如下。

```
import org.apache.xml.security.c14n.CanonicalizationException;
import org.apache.xml.security.c14n.Canonicalizer;
import org.apache.xml.security.c14n.InvalidCanonicalizerException;
import org.w3c.dom.Element;
import org.w3c.dom.bootstrap.DOMImplementationRegistry;
import org.w3c.dom.ls.DOMImplementationLS;
import org.w3c.dom.ls.LSSerializer;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;

import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.TransformerException;
import java.io.IOException;
import java.io.StringReader;

public class XmlUtils {
    public static String toCanonicalXml(String xml) throws InvalidCanonicalizerException, ParserConfigurationException, SAXException, CanonicalizationException, IOException {
        Canonicalizer canon = Canonicalizer.getInstance(Canonicalizer.ALGO_ID_C14N_OMIT_COMMENTS);
        byte canonXmlBytes[] = canon.canonicalize(xml.getBytes());
        return new String(canonXmlBytes);
    }

    public static String prettyFormat(String input) throws TransformerException, ParserConfigurationException, IOException, SAXException, InstantiationException, IllegalAccessException, ClassNotFoundException {
        InputSource src = new InputSource(new StringReader(input));
        Element document = DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(src).getDocumentElement();
        Boolean keepDeclaration = input.startsWith("<?xml");
        DOMImplementationRegistry registry = DOMImplementationRegistry.newInstance();
        DOMImplementationLS impl = (DOMImplementationLS) registry.getDOMImplementation("LS");
        LSSerializer writer = impl.createLSSerializer();
        writer.getDomConfig().setParameter("format-pretty-print", Boolean.TRUE);
        writer.getDomConfig().setParameter("xml-declaration", keepDeclaration);
        return writer.writeToString(document);
    }
} 
```

它是在单元测试中用于全字符串 xml 比较的好工具。

```
private void assertXMLEqual(String expected, String actual) throws ParserConfigurationException, IOException, SAXException, CanonicalizationException, InvalidCanonicalizerException, TransformerException, IllegalAccessException, ClassNotFoundException, InstantiationException {
    String canonicalExpected = prettyFormat(toCanonicalXml(expected));
    String canonicalActual = prettyFormat(toCanonicalXml(actual));
    assertEquals(canonicalExpected, canonicalActual);
} 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2015-05-01T20:42:24.943

我看到[一个答案](https://stackoverflow.com/a/5227490/2063026)`Scala`是 ，所以这里是另一个答案，`Groovy`以防万一有人觉得它有趣。默认缩进为 2 步，`XmlNodePrinter`构造函数也可以传递另一个值。

```
def xml = "<tag><nested>hello</nested></tag>"
def stringWriter = new StringWriter()
def node = new XmlParser().parseText(xml);
new XmlNodePrinter(new PrintWriter(stringWriter)).print(node)
println stringWriter.toString() 
```

如果 groovy jar 在类路径中，则使用 Java

```
 String xml = "<tag><nested>hello</nested></tag>";
  StringWriter stringWriter = new StringWriter();
  Node node = new XmlParser().parseText(xml);
  new XmlNodePrinter(new PrintWriter(stringWriter)).print(node);
  System.out.println(stringWriter.toString()); 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2015-08-20T13:20:46.197

如果您不需要缩进那么多，但需要几个换行符，那么简单的正则表达式就足够了......

```
String leastPrettifiedXml = uglyXml.replaceAll("><", ">\n<"); 
```

代码很好，不是因为缺少缩进而导致的结果。

* * *

（有关缩进的解决方案，请参阅其他答案。）

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2019-02-14T04:15:00.643

[Underscore-java](https://github.com/javadev/underscore-java)有静态方法`U.formatXml(string)`。[活生生的例子](https://www.jdoodle.com/embed/v0/QaB)

```
import com.github.underscore.U;

public class MyClass {
    public static void main(String args[]) {
        String xml = "<tag><nested>hello</nested></tag>";

        System.out.println(U.formatXml("<?xml version=\"1.0\" encoding=\"UTF-8\"?><root>" + xml + "</root>"));
    }
} 
```

输出：

```
<?xml version="1.0" encoding="UTF-8"?>
<root>
   <tag>
      <nested>hello</nested>
   </tag>
</root> 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2016-05-14T00:16:38.127

试试这个：

```
 try
                    {
                        TransformerFactory transFactory = TransformerFactory.newInstance();
                        Transformer transformer = null;
                        transformer = transFactory.newTransformer();
                        StringWriter buffer = new StringWriter();
                        transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");
                        transformer.transform(new DOMSource(element),
                                  new StreamResult(buffer)); 
                        String str = buffer.toString();
                        System.out.println("XML INSIDE IS #########################################"+str);
                        return element;
                    }
                    catch (TransformerConfigurationException e)
                    {
                        e.printStackTrace();
                    }
                    catch (TransformerException e)
                    {
                        e.printStackTrace();
                    } 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2017-11-04T04:18:40.080

在提出自己的解决方案之前，我应该先查找此页面！无论如何，我的使用 Java 递归来解析 xml 页面。此代码完全独立，不依赖第三方库。另外..它使用递归！

```
// you call this method passing in the xml text
public static void prettyPrint(String text){
    prettyPrint(text, 0);
}

// "index" corresponds to the number of levels of nesting and/or the number of tabs to print before printing the tag
public static void prettyPrint(String xmlText, int index){
    boolean foundTagStart = false;
    StringBuilder tagChars = new StringBuilder();
    String startTag = "";
    String endTag = "";
    String[] chars = xmlText.split("");
    // find the next start tag
    for(String ch : chars){
        if(ch.equalsIgnoreCase("<")){
            tagChars.append(ch);
            foundTagStart = true;
        } else if(ch.equalsIgnoreCase(">") && foundTagStart){
            startTag = tagChars.append(ch).toString();
            String tempTag = startTag;
            endTag = (tempTag.contains("\"") ? (tempTag.split(" ")[0] + ">") : tempTag).replace("<", "</"); // <startTag attr1=1 attr2=2> => </startTag>
            break;
        } else if(foundTagStart){
            tagChars.append(ch);
        }
    }
    // once start and end tag are calculated, print start tag, then content, then end tag
    if(foundTagStart){
        int startIndex = xmlText.indexOf(startTag);
        int endIndex = xmlText.indexOf(endTag);
        // handle if matching tags NOT found
        if((startIndex < 0) || (endIndex < 0)){
            if(startIndex < 0) {
                // no start tag found
                return;
            } else {
                // start tag found, no end tag found (handles single tags aka "<mytag/>" or "<?xml ...>")
                printTabs(index);
                System.out.println(startTag);
                // move on to the next tag
                // NOTE: "index" (not index+1) because next tag is on same level as this one
                prettyPrint(xmlText.substring(startIndex+startTag.length(), xmlText.length()), index);
                return;
            }
        // handle when matching tags found
        } else {
            String content = xmlText.substring(startIndex+startTag.length(), endIndex);
            boolean isTagContainsTags = content.contains("<"); // content contains tags
            printTabs(index);
            if(isTagContainsTags){ // ie: <tag1><tag2>stuff</tag2></tag1>
                System.out.println(startTag);
                prettyPrint(content, index+1); // "index+1" because "content" is nested
                printTabs(index);
            } else {
                System.out.print(startTag); // ie: <tag1>stuff</tag1> or <tag1></tag1>
                System.out.print(content);
            }
            System.out.println(endTag);
            int nextIndex = endIndex + endTag.length();
            if(xmlText.length() > nextIndex){ // if there are more tags on this level, continue
                prettyPrint(xmlText.substring(nextIndex, xmlText.length()), index);
            }
        }
    } else {
        System.out.print(xmlText);
    }
}

private static void printTabs(int counter){
    while(counter-- > 0){ 
        System.out.print("\t");
    }
} 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2019-06-10T18:16:13.187

我试图实现类似的东西，但没有任何外部依赖。该应用程序已经在使用 DOM 来格式化只是为了记录 XML！

这是我的示例片段

```
public void formatXML(final String unformattedXML) {
    final int length = unformattedXML.length();
    final int indentSpace = 3;
    final StringBuilder newString = new StringBuilder(length + length / 10);
    final char space = ' ';
    int i = 0;
    int indentCount = 0;
    char currentChar = unformattedXML.charAt(i++);
    char previousChar = currentChar;
    boolean nodeStarted = true;
    newString.append(currentChar);
    for (; i < length - 1;) {
        currentChar = unformattedXML.charAt(i++);
        if(((int) currentChar < 33) && !nodeStarted) {
            continue;
        }
        switch (currentChar) {
        case '<':
            if ('>' == previousChar && '/' != unformattedXML.charAt(i - 1) && '/' != unformattedXML.charAt(i) && '!' != unformattedXML.charAt(i)) {
                indentCount++;
            }
            newString.append(System.lineSeparator());
            for (int j = indentCount * indentSpace; j > 0; j--) {
                newString.append(space);
            }
            newString.append(currentChar);
            nodeStarted = true;
            break;
        case '>':
            newString.append(currentChar);
            nodeStarted = false;
            break;
        case '/':
            if ('<' == previousChar || '>' == unformattedXML.charAt(i)) {
                indentCount--;
            }
            newString.append(currentChar);
            break;
        default:
            newString.append(currentChar);
        }
        previousChar = currentChar;
    }
    newString.append(unformattedXML.charAt(length - 1));
    System.out.println(newString.toString());
} 
```

# java - JFrame.setDefaultLookAndFeelDecorated(true);

> ID：139088
> 
> 赞同：5
> 
> 时间：2008-09-26T12:24:53.933
> 
> 标签：java, user-interface, swing

当我在 Java 中使用 setDefaultLookAndFeelDecorated(true) 方法时，为什么当我最大化 Frame 时 Frame 会出现 FullScreen ？以及如何在这种方法中取消全屏模式？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-27T17:56:05.267

设置`setDefaultLookAndFeelDecorated`为 true 会导致装饰由外观处理；这意味着 Windows 和 Mac 上的系统外观（我现在手头没有 Linux）保留了您期望它们的本机窗口的边框，例如在 Windows 中保持任务栏的清晰。

当使用 Windows 上的默认跨平台外观（又名 Metal）时，Windows 版本将占据整个屏幕，使其看起来像一个全屏窗口。在 Mac 上，操作系统拒绝提供自己的标题栏，并在 Mac 原生窗口中绘制完整的金属框架（包括标题栏）。

因此，简而言之，如果您想确保任务栏得到尊重，请在 Windows 上使用 Windows 系统外观。您可以使用类似的东西来设置它

```
UIManager.setLookAndFeel((LookAndFeel) Class.forName(UIManager.getCrossPlatformLookAndFeelClassName()).newInstance()); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T12:31:31.810

如果你不希望你的 JFrame 可以最大化然后调用 .setResizable(false); 在上面。

# winapi - GetExitCodeProcess() 返回 128

> ID：139090
> 
> 赞同：1
> 
> 时间：2008-09-26T12:25:07.583
> 
> 标签：winapi, dll, process

我有一个 DLL 作为扩展加载到第 3 方父进程中。在这个 DLL 中，我使用 CreateProcess API 实例化外部进程（我自己的）。这在 99.999% 的情况下都很好用，但有时这会突然失败并永久停止工作（也许重新启动父进程可以解决这个问题，但这是不可取的，在我解决问题之前我不建议这样做。）即使 CreteProcess() 没有报告错误并且 GetExitCodeProcess() 返回 128，外部进程也不再被调用，失败的症状是。这是我正在做的简化版本：

```
STARTUPINFO si;
ZeroMemory(&si, sizeof(si));
si.cb = sizeof(si);
si.dwFlags = STARTF_USESHOWWINDOW;
si.wShowWindow = SW_HIDE;

PROCESS_INFORMATION pi;
ZeroMemory(&pi, sizeof(pi));

if(!CreateProcess(
    NULL,   // No module name (use command line). 
    "<my command line>",
    NULL,   // Process handle not inheritable. 
    NULL,   // Thread handle not inheritable. 
    FALSE,  // Set handle inheritance to FALSE. 
    CREATE_SUSPENDED,  // Create suspended.
    NULL,   // Use parent's environment block. 
    NULL,   // Use parent's starting directory. 
    &si,    // Pointer to STARTUPINFO structure.
    &pi))   // Pointer to PROCESS_INFORMATION structure.
{
    // Handle error.
}
else
{
    // Do something.

    // Resume the external process thread.
    DWORD resumeThreadResult = ResumeThread(pi.hThread);
    // ResumeThread() returns 1 which is OK
    // (it means that the thread was suspended but then restarted)

    // Wait for the external process to finish.
    DWORD waitForSingelObjectResult =  WaitForSingleObject(pi.hProcess, INFINITE);
    // WaitForSingleObject() returns 0 which is OK.

    // Get the exit code of the external process.
    DWORD exitCode;
    if(!GetExitCodeProcess(pi.hProcess, &exitCode))
    {
        // Handle error.
    }
    else
    {
        // There is no error but exitCode is 128, a value that
        // doesn't exist in the external process (and even if it
        // existed it doesn't matter as it isn't being invoked any more)
        // Error code 128 is ERROR_WAIT_NO_CHILDREN which would make some
        // sense *if* GetExitCodeProcess() returned FALSE and then I were to
        // get ERROR_WAIT_NO_CHILDREN with GetLastError()
    }

    // PROCESS_INFORMATION handles for process and thread are closed.
} 
```

可以从 Windows 资源管理器或命令行手动调用外部进程，它可以自行启动。像这样调用它，在做任何实际工作之前，创建一个日志文件并记录一些关于它的信息。但是像上面描述的那样调用这个日志信息根本不会出现，所以我假设外部进程的主线程永远不会进入 main() （我现在正在测试这个假设。）

我至少可以做一件事来尝试规避问题（而不是启动暂停的线程），但我首先想先了解失败的根源。有谁知道什么可能导致这个以及如何解决它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T12:47:39.247

引用[GetExitCodeProcess](http://msdn.microsoft.com/en-us/library/aa915088.aspx)上的 MSDN 文章：

如果进程已终止，则可以返回以下终止状态：

*   ExitProcess 或 TerminateProcess 函数中指定的退出值
*   来自进程的 main 或 WinMain 函数的返回值
*   导致进程终止的未处理异常的异常值

鉴于您描述的场景，我认为最可能的原因是第三个：未处理的异常。查看您创建的流程的来源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T17:44:04.553

看看桌面堆内存。

本质上，桌面堆问题归结为资源耗尽（例如启动太多进程）。当您的应用程序用完这些资源时，其中一个症状是您将无法启动新进程，并且对 CreateProcess 的调用将失败并显示代码 128。

请注意，您运行的上下文也有一些影响。例如，作为服务运行，与在控制台应用程序中测试代码相比，您会更快地耗尽桌面堆。

这篇[文章](http://blogs.msdn.com/ntdebugging/archive/2007/01/04/desktop-heap-overview.aspx)有很多关于桌面堆的好信息

[Microsoft 支持](http://support.microsoft.com/kb/126962)也有一些有用的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T17:53:34.843

我可以从您的代码示例中想到 2 个问题

1.让你使用前 2 个参数到 creatprocess 命令首先工作。硬编码路径并调用 notepad.exe 并查看是否出现。继续调整它，直到你有记事本运行。

2.与您的评论相反，如果您将新进程的 currentdirectory 参数传递为 NULL，它将使用进程的当前工作目录而不是父进程的起始目录来启动新进程。

我假设您的外部进程 exe 由于无法在新路径中解析的 dll 依赖关系而无法正常启动。

ps：在调试器中查看@err,hr，它会告诉你最后一个错误代码的解释，

# winforms - 更新后如何使用 NHibernate 从数据库中检索最新信息？

> ID：139115
> 
> 赞同：4
> 
> 时间：2008-09-26T12:29:56.200
> 
> 标签：winforms, nhibernate

这是场景：

我有一个使用 NHibernate 的 winforms 应用程序。启动时，我使用 NHibernate 查询的结果填充 DataGridView。这部分工作正常。如果我更新该列表中的记录并刷新会话，则更新将进入数据库。在更新后关闭表单后，我调用一个方法来检索对象列表以再次填充 DataGridView 以获取更改并获取其他人可能发生的任何其他更改。问题是更新的记录，NHibernate 没有反映它给我的列表中的变化。当我插入或删除记录时，一切正常。只有当我更新时，我才会得到这种行为。我用他们的缓存机制把它缩小到NHibernate。我想不出一种方法来让 NHibernate 从数据库中检索而不是在更新发生后使用缓存。我在 NHibernate 论坛上发帖，但他们给我的建议没有用。我说了这个，没有人回复。我不会说明我尝试过的事情，以防我做得不对。如果您用我完全尝试过的东西来回答，我会在您回答的评论中说明。

这是我用来检索列表的代码：

```
public IList<WorkOrder> FindBy(string fromDate, string toDate)
{
    IQuery query = _currentSession.CreateQuery("from WorkOrder wo where wo.Date >= ? and wo.Date <= ?");
    query.SetParameter(0, fromDate);
    query.SetParameter(1, toDate);
    return query.List<WorkOrder>();
} 
```

会话在构造时传递给类。我也可以发布我的映射文件，但我不确定它是否有任何问题，因为其他一切正常。有人见过这个吗？这是我使用 NHibernate 的第一个项目，感谢您的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T15:14:04.473

更新后，从一级缓存中逐出对象。

```
Session.Update(obj);
Session.Evict(obj); 
```

您可能想先提交和/或刷新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T12:32:20.750

刷新呢？- 见[9.2。加载](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/manipulatingdata.html#manipulatingdata-update-lock)文档的对象：

"sess.Save(cat); sess.Flush(); //强制 SQL INSERT sess.Refresh(cat); //重新读取状态（触发器执行后） "

# javascript - Javascript Iframe 内部HTML

> ID：139118
> 
> 赞同：21
> 
> 时间：2008-09-26T12:30:04.280
> 
> 标签：javascript, iframe, innerhtml

有谁知道如何从 IFRAME 中获取 HTML 我尝试了几种不同的方法：

```
document.getElementById('iframe01').contentDocument.body.innerHTML
document.frames['iframe01'].document.body.innerHTML
document.getElementById('iframe01').contentWindow.document.body.innerHTML 
```

ETC

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-26T12:35:00.430

我认为这就是你想要的：

```
window.frames['iframe01'].document.body.innerHTML 
```

**编辑：**

我有充分的权威表明这在 Chrome 和 Firefox 中不起作用，尽管它在 IE 中完美运行，这是我测试它的地方。回想起来，这是一个很大的错误

这将起作用：

```
window.frames[0].document.body.innerHTML 
```

我知道这不是所要求的，但我不想删除答案，因为我认为它有一个位置。

我喜欢下面@ravz 的 jquery 答案。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-08-18T08:32:17.967

Having something like the following would work.

```
<iframe id = "testframe" onload = populateIframe(this.id);></iframe>

// The following function should be inside a script tag

function populateIframe(id) { 

    var text = "This is a Test"
var iframe = document.getElementById(id); 

var doc; 

if(iframe.contentDocument) { 
    doc = iframe.contentDocument; 
} else {
    doc = iframe.contentWindow.document; 
}

doc.body.innerHTML = text; 

  } 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-26T12:32:18.533

如果您查看[JQuery](http://www.jquery.com)，您可以执行以下操作：

```
<iframe id="my_iframe" ...></iframe>

$('#my_iframe').contents().find('html').html(); 
```

由于Javascript 中的同源[策略](http://en.wikipedia.org/wiki/Same_origin_policy)，这是假设您的 iframe 父级和子级位于同一服务器上。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-12-12T15:58:05.520

康罗伊的回答是对的。如果您只需要 body 标签中的内容，只需使用：

```
$('#my_iframe').contents().find('body').html(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T12:38:20.330

不要忘记，由于安全性，您不能跨域。

因此，如果是这种情况，您应该使用[JSON](http://www.json.org/)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-09-02T21:11:39.940

您可以为此目的使用 contentDocument 或 contentWindow 属性。这是示例代码。

```
function gethtml() {
  const x = document.getElementById("myframe")
  const y = x.contentWindow || x.contentDocument
  const z = y.document ? y.document : y
  alert(z.body.innerHTML)
} 
```

这里，`myframe`是你的 iframe 的 id。注意：您不能从域外的 src 中提取 iframe 中的内容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-02-16T02:32:44.830

如果您在 Firefox 上安装 ForceCORS 过滤器，则可以从其他域获取源。当您打开此过滤器时，它会绕过浏览器中的安全功能，即使您尝试阅读其他网页，您的脚本也能正常工作。例如，您可以在 iframe 中打开 FoxNews.com，然后阅读其源代码。现代网络浏览器默认拒绝此功能的原因是，如果另一个域包含一段 JavaScript，而您正在阅读它并将其显示在您的页面上，则它可能包含恶意代码并构成安全威胁。因此，每当您在页面上显示来自另一个域的数据时，您必须提防这种真正的威胁，并实施一种方法来过滤掉您的文本中的所有 JavaScript 代码，然后再显示它。记住，当一段假定的原始文本包含一些包含在脚本标签中的代码时，当您在页面上显示它时它们不会显示出来，但它们会运行！所以，意识到这是一个威胁。

[http://www-jo.se/f.pfleger/forcecors](http://www-jo.se/f.pfleger/forcecors)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-19T11:30:51.357

```
document.getElementById('iframe01').outerHTML 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-01-15T10:59:55.133

此解决方案与 iFrame 相同。我创建了一个 PHP 脚本，可以从其他网站获取所有内容，最重要的是您可以轻松地将自定义 jQuery 应用于该外部内容。请参考以下脚本，该脚本可以从其他网站获取所有内容，然后您也可以应用您的自定义 jQuery/JS。此内容可以在任何地方、任何元素或任何页面内使用。

```
<div id='myframe'>

  <?php 
   /* 
    Use below function to display final HTML inside this div
   */

   //Display Frame
   echo displayFrame(); 
  ?>

</div>

<?php

/* 
  Function to display frame from another domain 
*/

function displayFrame()
{
  $webUrl = 'http://[external-web-domain.com]/';

  //Get HTML from the URL
  $content = file_get_contents($webUrl);

  //Add custom JS to returned HTML content
  $customJS = "
  <script>

      /* Here I am writing a sample jQuery to hide the navigation menu
         You can write your own jQuery for this content
      */
    //Hide Navigation bar
    jQuery(\".navbar\").hide();

  </script>";

  //Append Custom JS with HTML
  $html = $content . $customJS;

  //Return customized HTML
  return $html;
} 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2018-05-29T04:50:02.143

您可以使用以下代码从 iframe 中获取 html iframe = document.getElementById('frame'); innerHtml = iframe.contentDocument.documentElement.innerHTML

# jsp - web-inf 和 jsp 页面指令

> ID：139131
> 
> 赞同：2
> 
> 时间：2008-09-26T12:31:57.613
> 
> 标签：jsp, web-inf, page-directives

我在 web-inf 文件夹下有许多 jsp 文件。在我的 web.xml 中，我为 404 amd 403 和 java.lang.exception 指定了一个错误页面。我是否需要为我的每个 jsp 包含一个页面指令，或者它们是否会因为它们位于 web-inf 下而自动转发到异常处理页面？

如果这是真的，这是否意味着没有放在 web-inf 下的 jsps 确实需要添加 page 指令才能将它们转发到异常处理页面？

谢谢，我只是想了解 web-inf 的后果

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T12:37:57.693

你只需要在你的应用程序中使用任何你想使用的错误页面，所有其他 jsps 都可以使用。因此，在下面的示例中，您只需要在上下文路径的根目录（所有其他 jsps 所在的位置）中包含错误页面。每当 web 应用程序收到 404 或 403 错误时，它都会尝试显示这些页面之一。.

```
<error-page> 
   <error-code>404</error-code> 
   <location>/404Error.jsp</location> 
</error-page>
<error-page> 
   <error-code>403</error-code> 
   <location>/403Error.jsp</location> 
</error-page> 
```

只需确保 404Error.jsp 和 403Error.jsp 包含：

```
<%@ page isErrorPage="true" %> 
```

如果您实际上将 jsps 用于错误页面（而不仅仅是静态 html）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T12:53:52.913

好的，只是为了澄清；我的 jsps 不需要在 web-inf 文件夹中，以便我的 web 描述符获取异常并转发到错误页面

# javascript - 组织外部 JavaScript 文件的好方法是什么？

> ID：139142
> 
> 赞同：5
> 
> 时间：2008-09-26T12:33:10.233
> 
> 标签：javascript

在具有大量 HTML 页面的 ASP.NET Web 应用程序中，大量内联 JavaScript 函数正在积累。将它们组织成外部文件的好计划是什么？大多数功能都特定于为其编写的页面，但少数与整个应用程序相关。

单个文件可能会变得非常大。对于 C# 等，我通常将文件至少分成一个包含通用函数和类的文件，以便我可以将同一个文件用于其他应用程序，一个用于该应用程序特定的函数和类。但是，我不认为大文件对 Web 应用程序的性能有好处。

对此有何思考？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T12:35:59.850

您可能希望每个页面都将其特定于页面的 JavaScript 放在一个位置，然后将所有共享的 JavaScript 放在一个大文件中。如果您对大文件进行 SRC，那么您的用户的浏览器将在第一次加载时缓存 JavaScript 代码，并且文件大小不会成为问题。如果您特别担心，可以将 JavaScript 源代码打包/缩小为“可分发”形式并节省几千字节。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T12:36:49.350

单个文件很大，但已缓存。太多的小文件意味着对服务器的更多请求。这是一个平衡的行为。使用 Firebug 和 YSlow 等工具来衡量您的性能并找出最适合您的应用程序的方法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T12:40:47.297

每个请求都有一些开销，因此总的来说，您可以通过将它们全部组合到一个文件中来提高性能。但是，它可能会减慢用户访问的第一页的加载时间，并且如果某些用户从不需要您的 js 的某些部分，它可能会导致无用的流量。

不过，这些问题中的第一个问题并不那么成问题。如果您有类似注册页面之类的东西，每个人都首先访问并花费一些时间（填写表格等），一旦加载了 html，页面将显示，并且 js 可以在用户时在后台加载无论如何忙于表格。

我会在开发过程中将 js 组织成不同的文件，即一个用于通用文件，一个用于每个模型，然后在构建过程中将它们组合成一个文件。此时您还应该进行[压缩](http://developer.yahoo.com/yui/compressor/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T16:53:12.867

[**更新：我在博客文章**](http://blog.jasonbunting.com/PermaLink,guid,5a2506a1-64c6-416d-af16-f33390de54fd.aspx)中对此进行了更深入的解释。

假设您在指示“HTML 页面”时指的是 .aspx 页面，这就是我所做的：

假设我有一个名为 foo.aspx 的页面，并且我有特定于它的 JavaScript。我将 .js 文件命名为 foo.aspx.js。然后我在一个**基**页面类中使用这样的东西（即我所有的页面都继承自这个类）：

```
protected override void OnLoad(EventArgs e)
{
   base.OnLoad(e);
   string possiblePageSpecificJavaScriptFile = string.Format("{0}.js", this.TemplateControl.AppRelativeVirtualPath);
   if (File.Exists(Server.MapPath(possiblePageSpecificJavaScriptFile)) == true)
   {
      string absolutePath = possiblePageSpecificJavaScriptFile.Replace("~", Request.ApplicationPath);
      absolutePath = string.Format("/{0}", absolutePath.TrimStart('/'));
      Page.ClientScript.RegisterClientScriptInclude(absolutePath, absolutePath);
   }
} 
```

因此，对于我的应用程序中的每个页面，这将查找与页面名称匹配的 *.aspx.js 文件（在我们的示例中为 foo.aspx.js），并在呈现的页面中放置一个引用的脚本标记它。（`base.OnLoad(e);`最好将后面的代码提取出来，我只是尽量保持简短！）

为了完成这个，我有一个注册表黑客，它会导致任何 *.aspx.js 文件在 Visual Studio 的解决方案资源管理器中折叠到 *.aspx 页面下方（即它会隐藏在页面下方，就像 *.aspx 一样。 cs 文件确实如此）。根据您使用的 Visual Studio 版本，注册表黑客是不同的。这是我在**Windows XP**中使用的一对（我不知道它们是否与 Vista 不同，因为我不使用 Vista） - 将每一个复制到一个文本文件中并用 .reg 扩展名重命名，然后执行该文件：

### 视觉工作室 2005

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\8.0\Projects\{E24C65DC-7377-472b-9ABA-BC803B73C61A}\RelatedFiles\.aspx\.js]
@="" 
```

### 视觉工作室 2008

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\9.0\Projects\{E24C65DC-7377-472b-9ABA-BC803B73C61A}\RelatedFiles\.aspx\.js]
@="" 
```

在这些生效之前，您可能需要重新启动计算机。此外，嵌套只会发生在新添加的 .js 文件中，您拥有的任何已命名为 *.aspx.js 的文件都可以通过将它们重新添加到项目中或手动修改 .csproj 文件的 XML 来进行嵌套。

无论如何，这就是我做事的方式，这确实有助于保持事情的井井有条。对于包含常用 JavaScript 的 JavaScript 文件，我将它们保存在名为 JavaScript 的根级文件夹中，并且在我的基本页面类中还有一些代码可以添加这些引用。这应该很简单，可以弄清楚。希望这可以帮助某人。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-27T11:43:29.140

将“命名空间”与文件夹结构一起使用：

[替代文字 http://www.roosteronacid.com/js.jpg](http://www.roosteronacid.com/js.jpg)

您所要做的就是包含*Base.js*，因为该文件设置了所有命名空间。以及要在给定页面上使用的*.js*文件（类）。

就特定于页面的脚本而言，我通常根据 ASPX/HTML 页面命名脚本：

```
Default.aspx
Default.aspx.js 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T12:43:31.393

它还取决于用户会话的生命周期。如果用户可能会访问多个页面并在站点上花费很长时间，则单个大文件可能值得初始加载，因为它已被缓存。如果用户更有可能来自谷歌并且只点击一个页面，那么每页只有单独的文件会更好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-27T12:30:07.923

我建议如果您将 JS 拆分为单独的文件，不要使用大量标签来包含它们，这会降低页面加载性能。相反，使用服务器端包含在它们离开服务器之前内联它们。

# openlaszlo - 使用 OpenLaszlo 的经验？

> ID：139150
> 
> 赞同：8
> 
> 时间：2008-09-26T12:34:05.957
> 
> 标签：openlaszlo

在一个[相关问题](https://stackoverflow.com/questions/112351/recommendations-for-starting-web-programming)中，我询问了 Web 开发。昨天我遇到了一个叫做[OpenLaszlo](http://www.openlaszlo.org/)的东西，我觉得做一些网站开发看起来很有趣。该网站有很多关于它的好信息，他们有一些很好的教程等，但作为一个完全的新手（就网络开发而言），我想知道这里是否有人会推荐这个。正如我在另一个问题中所说，这对我来说是一个新世界，我可以去很多方向。您可以比较/对比您所做的其他 Web 开发吗？显然，这有点主观，但我在 SO 上没有听到太多关于它的消息，我希望对此有一些意见。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-03T16:51:02.493

我在一个网站上工作了大约一年，整个 UI 都是在 Laszlo 开发的。我还使用 JS 框架（如 JQuery、Prototype 和 Scriptaculous）开发了 AJAX 应用程序。

根据我的经验，使用 Laszlo 所需的总工作量要少得多，并且基于类的对象模型有助于使您的代码比使用 JS 框架时更好地组织。我对拉斯洛的唯一抱怨是：

*   它在支持后退/前进/刷新按钮方面“破坏了浏览器”。AJAX 也存在这个问题，但大多数 JS 库似乎都找到了解决方法。
*   不支持国际化，但根据我的经验，没有一个 JS 库更好
*   与 GWT、JQuery 等竞争对手相比，用户群/社区相对较小。

总而言之，我认为 OpenLaszlo 是创建丰富的基于 Web 的用户界面的一个非常好的解决方案，并且具有许多非常新颖的特性，例如能够在多个运行时（Flash、DHTML 等）上进行部署而无需任何代码更改.

另外，我应该提一下，我已经快一年没有使用它了，所以最近在我上面提到的问题上可能已经取得了一些进展。

## 更新

自我发布此答案 5 年以来，情况发生了很大变化。万一有人有任何疑问，请不要使用 Laszlo，该项目已经完全奄奄一息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T12:37:37.537

我使用 openLaszlo 为我的一些朋友（大约一年前）开发了一些博客小部件，它很容易让一些基本工作正常，而且看起来还不错。但如果我必须再做一次，我可能会使用[FLEX](http://www.adobe.com/products/flex/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-02T04:16:28.063

您绝对可以使用 OpenLaszlo 快速编写 Flash 应用程序。开发 Silverlight 有很多相似之处。

OpenLaszlo 的一个跛脚之处在于它使用了类似于 ActionScript 的 JavaScript 跛脚变体。如果您习惯了最新的功能，则需要一点时间来适应。

此外，与您可以使用其他工具执行的操作相比，您最终得到的 Flash 文件非常大（文件大小）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-18T17:00:14.953

OpenLaszlo 的一个好处是可以进行 DHTML 输出。但对我来说，在同一个源文件中混合使用 XML 和 JavaScript 有点令人困惑。

# javascript - 在javascript中单击其包含的div时防止突出显示文本的最佳方法是什么？

> ID：139157
> 
> 赞同：15
> 
> 时间：2008-09-26T12:35:12.800
> 
> 标签：javascript, html, css

我正在用 HTML/CSS/JS 构建一个菜单，我需要一种方法来防止菜单中的文本在双击时被突出显示。我需要一种方法将几个 div 的 id 传递到一个函数中，并在其中关闭突出显示。

因此，当用户意外（或故意）双击菜单时，菜单会显示其子元素，但其文本不会突出显示。

网上有很多脚本，但很多看起来已经过时了。最好的方法是什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-27T02:42:35.713

在（Mozilla、Firefox、Camino、Safari、Google Chrome）中，您可以使用：

```
div.noSelect {
  -moz-user-select: none; /* mozilla browsers */
  -khtml-user-select: none; /* webkit browsers */
} 
```

IE没有CSS选项，但是可以捕获ondragstart事件，返回false；

**更新**

自 2008 年以来，浏览器对此属性的支持得到了扩展。

```
div.noSelect {
  -webkit-user-select: none;  /* Chrome all / Safari all */
  -moz-user-select: none;     /* Firefox all */
  -ms-user-select: none;      /* IE 10+ */
} 
```

[https://css-tricks.com/almanac/properties/u/user-select/](https://css-tricks.com/almanac/properties/u/user-select/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T20:56:39.477

您可以使用此 CSS 来简单地隐藏选择颜色（IE 不支持）：

```
#id::-moz-selection {
  background: transparent;
}

#id::selection {
  background: transparent;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T12:39:33.400

你可以：

*   给它（“它”是你的文本）一个 onclick 事件
*   第一次单击将变量设置为当前时间
*   第二次单击检查该变量是否是当前时间的 x 时间（因此双击，例如 500 毫秒，不会注册为双击）
*   如果*是*双击，对页面执行一些操作，例如添加隐藏的 HTML，执行 document.focus()。您必须对这些进行试验，因为有些可能会导致不必要的滚动。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T12:40:48.170

希望这是您正在寻找的。

```
<script type="text/javascript">
  function clearSelection() {
    var sel;
    if (document.selection && document.selection.empty) {
      document.selection.empty();
    } else if (window.getSelection) {
      sel = window.getSelection();
      if (sel && sel.removeAllRanges)
        sel.removeAllRanges();
    }
  } 
</script>

<div ondblclick="clearSelection()">Some text goes here.</div> 
```

# python - 如何列出 Python 模块中的所有函数？

> ID：139180
> 
> 赞同：511
> 
> 时间：2008-09-26T12:38:52.417
> 
> 标签：python, reflection, module, inspect

我的系统上安装了一个 Python 模块，我希望能够查看其中可用的函数/类/方法。

我想`help`在每一个上调用该函数。在 Ruby 中，我可以做一些事情，比如`ClassName.methods`获取该类上所有可用方法的列表。Python中有类似的东西吗？

例如。就像是：

```
from somemodule import foo
print(foo.methods)  # or whatever is the correct method to call 
```

* * *

## 回答 #1

> 赞同：569
> 
> 时间：2008-09-26T12:40:20.183

您可以使用`dir(module)`查看所有可用的方法/属性。另请查看 PyDocs。

* * *

## 回答 #2

> 赞同：238
> 
> 时间：2008-09-26T12:41:04.690

使用[`inspect`](https://docs.python.org/3/library/inspect.html)模块：

```
from inspect import getmembers, isfunction

from somemodule import foo
print(getmembers(foo, isfunction)) 
```

另请参阅交互式解释器中的[`pydoc`](https://docs.python.org/3/library/pydoc.html)模块、函数和生成您所追求的文档的命令行工具。您可以只给他们您希望查看其文档的课程。例如，它们还可以生成 HTML 输出并将其写入磁盘。`help()``pydoc`

* * *

## 回答 #3

> 赞同：210
> 
> 时间：2008-09-26T15:08:54.350

编辑完模块后，您`import`可以执行以下操作：

```
help(modulename) 
```

... 以交互方式一次获取所有功能的文档。或者您可以使用：

```
dir(modulename) 
```

... 简单地列出模块中定义的所有函数和变量的名称。

* * *

## 回答 #4

> 赞同：121
> 
> 时间：2012-03-20T20:59:57.110

用于[`inspect.getmembers`](https://docs.python.org/3/library/inspect.html#inspect.getmembers)获取模块中的所有变量/类/函数等，并[`inspect.isfunction`](https://docs.python.org/3/library/inspect.html#inspect.isfunction)作为谓词传入以获取函数：

```
from inspect import getmembers, isfunction
from my_project import my_module

functions_list = getmembers(my_module, isfunction) 
```

`getmembers`返回`(object_name, object)`按名称字母顺序排序的元组列表。

您可以替换为[模块](https://docs.python.org/3/library/inspect.html)`isfunction`中的任何其他`isXXX`功能。[`inspect`](https://docs.python.org/3/library/inspect.html)

* * *

## 回答 #5

> 赞同：74
> 
> 时间：2008-09-26T12:50:39.190

```
import types
import yourmodule

print([getattr(yourmodule, a) for a in dir(yourmodule)
  if isinstance(getattr(yourmodule, a), types.FunctionType)]) 
```

* * *

## 回答 #6

> 赞同：61
> 
> 时间：2015-06-23T14:39:55.100

为了完整起见，我想指出，有时您可能想要*解析*代码而不是导入它。An`import`将*执行*顶级表达式，这可能是一个问题。

例如，我让用户为使用[zipapp](https://docs.python.org/dev/library/zipapp.html)制作的包选择入口点函数。使用`import`并`inspect`有运行错误代码的风险，导致崩溃、打印出帮助信息、弹出 GUI 对话框等等。

相反，我使用[ast](https://docs.python.org/3.2/library/ast.html#module-ast)模块列出所有顶级函数：

```
import ast
import sys

def top_level_functions(body):
    return (f for f in body if isinstance(f, ast.FunctionDef))

def parse_ast(filename):
    with open(filename, "rt") as file:
        return ast.parse(file.read(), filename=filename)

if __name__ == "__main__":
    for filename in sys.argv[1:]:
        print(filename)
        tree = parse_ast(filename)
        for func in top_level_functions(tree.body):
            print("  %s" % func.name) 
```

将此代码放入`list.py`并将其自身用作输入，我得到：

```
$ python list.py list.py
list.py
  top_level_functions
  parse_ast 
```

当然，导航 AST 有时会很棘手，即使对于像 Python 这样相对简单的语言也是如此，因为 AST 非常低级。但是，如果您有一个简单明了的用例，那么它既可行又安全。

不过，缺点是您无法检测在运行时生成的函数，例如`foo = lambda x,y: x*y`.

* * *

## 回答 #7

> 赞同：42
> 
> 时间：2017-09-07T21:42:46.770

对于您**不想评估**的代码，我建议使用基于 AST 的方法（如[csl](https://stackoverflow.com/users/21028/csl)的答案），例如：

```
import ast

source = open(<filepath_to_parse>).read()
functions = [f.name for f in ast.parse(source).body
             if isinstance(f, ast.FunctionDef)] 
```

对于**其他一切**，检查模块是正确的：

```
import inspect

import <module_to_inspect> as module

functions = inspect.getmembers(module, inspect.isfunction) 
```

这给出了 2-tuples 形式的列表`[(<name:str>, <value:function>), ...]`。

上面的简单答案在各种回复和评论中都有暗示，但没有明确指出。

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2008-09-26T23:41:16.630

这可以解决问题：

```
dir(module) 
```

但是，如果您发现读取返回的列表很烦人，只需使用以下循环获取每行一个名称。

```
for i in dir(module): print i 
```

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2012-04-09T20:51:58.233

`dir(module)`如大多数答案所述，是使用脚本或标准解释器时的标准方式。

[然而，使用像IPython](http://ipython.org)这样的交互式 python shell，您可以使用 tab-completion 来获得模块中定义的所有对象的概览。这比使用脚本和`print`查看模块中定义的内容要方便得多。

*   `module.<tab>`将显示模块中定义的所有对象（函数、类等）
*   `module.ClassX.<tab>`将向您展示类的方法和属性
*   `module.function_xy?`或`module.ClassX.method_xy?`将向您显示该函数/方法的文档字符串
*   `module.function_x??`或`module.SomeClass.method_xy??`将向您展示函数/方法的源代码。

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2018-03-26T11:16:51.823

对于全局函数`dir()`是要使用的命令（如大多数答案中所述），但是这将公共函数和非公共函数一起列出。

例如运行：

```
>>> import re
>>> dir(re) 
```

返回函数/类，如：

```
'__all__', '_MAXCACHE', '_alphanum_bytes', '_alphanum_str', '_pattern_type', '_pickle', '_subx' 
```

其中一些通常不用于一般编程用途（而是由模块本身，除了 DunderAliases 等情况`__doc__`）`__file__`。出于这个原因，将它们与公共的一起列出可能没有用（这就是 Python 知道在使用时会得到什么的方式`from module import *`）。

`__all__`可以用来解决这个问题，它返回一个模块中所有公共函数和类的列表（那些*不*以下划线开头的 - `_`）。请参阅 [有人可以用 Python 解释 __all__ 吗？](https://stackoverflow.com/questions/44834/can-someone-explain-all-in-python)为使用`__all__`。

这是一个例子：

```
>>> import re
>>> re.__all__
['match', 'fullmatch', 'search', 'sub', 'subn', 'split', 'findall', 'finditer', 'compile', 'purge', 'template', 'escape', 'error', 'A', 'I', 'L', 'M', 'S', 'X', 'U', 'ASCII', 'IGNORECASE', 'LOCALE', 'MULTILINE', 'DOTALL', 'VERBOSE', 'UNICODE']
>>> 
```

所有带下划线的函数和类都被删除了，只留下那些被定义为公共的，因此可以通过`import *`.

请注意，`__all__`并不总是定义。如果不包括在内，`AttributeError`则引发 an。

ast 模块就是一个例子：

```
>>> import ast
>>> ast.__all__
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: module 'ast' has no attribute '__all__'
>>> 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2015-06-01T22:05:25.780

如果您无法在没有导入错误的情况下导入所述 Python 文件，则这些答案都不起作用。当我检查来自具有大量依赖项的大型代码库的文件时，我就是这种情况。以下将文件作为文本处理，并搜索所有以“def”开头的方法名称并打印它们及其行号。

```
import re
pattern = re.compile("def (.*)\(")
for i, line in enumerate(open('Example.py')):
  for match in re.finditer(pattern, line):
    print '%s: %s' % (i+1, match.groups()[0]) 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2021-04-09T02:38:21.507

# 在当前脚本中查找名称（和可调用对象）`__main__`

我试图创建一个独立的 python 脚本，它仅使用标准库在当前文件中查找具有前缀的函数，`task_`以创建提供的最小自制版本`npm run`。

## TL;博士

如果您正在运行一个独立的脚本，您`inspect.getmembers`希望`module`在`sys.modules['__main__']`. 例如，

```
inspect.getmembers(sys.modules['__main__'], inspect.isfunction) 
```

但我想按前缀过滤方法列表并去除前缀以创建查找字典。

```
def _inspect_tasks():
    import inspect
    return { f[0].replace('task_', ''): f[1] 
        for f in inspect.getmembers(sys.modules['__main__'], inspect.isfunction)
        if f[0].startswith('task_')
    } 
```

示例输出：

```
{
 'install': <function task_install at 0x105695940>,
 'dev': <function task_dev at 0x105695b80>,
 'test': <function task_test at 0x105695af0>
} 
```

## 更长的版本

我想要方法的名称来定义 CLI 任务名称，而不必重复自己。

### `./tasks.py`

```
#!/usr/bin/env python3
import sys
from subprocess import run

def _inspect_tasks():
    import inspect
    return { f[0].replace('task_', ''): f[1] 
        for f in inspect.getmembers(sys.modules['__main__'], inspect.isfunction)
        if f[0].startswith('task_')
    }

def _cmd(command, args):
    return run(command.split(" ") + args)

def task_install(args):
    return _cmd("python3 -m pip install -r requirements.txt -r requirements-dev.txt --upgrade", args)

def task_test(args):
    return _cmd("python3 -m pytest", args)

def task_dev(args):
    return _cmd("uvicorn api.v1:app", args)

if __name__ == "__main__":
    tasks = _inspect_tasks()

    if len(sys.argv) >= 2 and sys.argv[1] in tasks.keys():
        tasks[sys.argv[1]](sys.argv[2:])
    else:
        print(f"Must provide a task from the following: {list(tasks.keys())}") 
```

无参数示例：

```
λ ./tasks.py
Must provide a task from the following: ['install', 'dev', 'test'] 
```

带有额外参数的运行测试示例：

```
λ ./tasks.py test -qq
s.ssss.sF..Fs.sssFsss..ssssFssFs....s.s 
```

你明白了。随着我的项目越来越多地参与进来，让脚本保持最新会比让 README 保持最新更容易，我可以将其抽象为：

```
./tasks.py install
./tasks.py dev
./tasks.py test
./tasks.py publish
./tasks.py logs 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-10-18T21:26:53.523

您可以使用以下方法从 shell 获取模块中的所有函数的列表：

`import module`

```
module.*? 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2017-01-09T13:54:59.610

除了前面答案中提到的 dir(module) 或 help(module) 之外，您还可以尝试：
- 打开 ipython
- import module_name
- 输入 module_name，按 Tab。它将打开一个小窗口，其中列出了 python 模块中的所有函数。
它看起来非常整洁。

这是列出 hashlib 模块的所有功能的片段

```
(C:\Program Files\Anaconda2) C:\Users\lenovo>ipython
Python 2.7.12 |Anaconda 4.2.0 (64-bit)| (default, Jun 29 2016, 11:07:13) [MSC v.1500 64 bit (AMD64)]
Type "copyright", "credits" or "license" for more information.

IPython 5.1.0 -- An enhanced Interactive Python.
?         -> Introduction and overview of IPython's features.
%quickref -> Quick reference.
help      -> Python's own help system.
object?   -> Details about 'object', use 'object??' for extra details.

In [1]: import hashlib

In [2]: hashlib.
             hashlib.algorithms            hashlib.new                   hashlib.sha256
             hashlib.algorithms_available  hashlib.pbkdf2_hmac           hashlib.sha384
             hashlib.algorithms_guaranteed hashlib.sha1                  hashlib.sha512
             hashlib.md5                   hashlib.sha224 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2020-03-18T18:22:24.843

```
import sys
from inspect import getmembers, isfunction
fcn_list = [o[0] for o in getmembers(sys.modules[__name__], isfunction)] 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2020-12-15T15:07:00.953

然后使用`vars(module)`过滤掉任何不是函数的东西[`inspect.isfunction`](https://docs.python.org/3/library/inspect.html#inspect.isfunction)：

```
import inspect
import my_module

my_module_functions = [f for _, f in vars(my_module).values() if inspect.isfunction(f)] 
```

[`vars`](https://docs.python.org/3/library/functions.html#vars)over [`dir`](https://docs.python.org/3/library/functions.html#dir)or的优点[`inspect.getmembers`](https://docs.python.org/3/library/inspect.html#inspect.getmembers)是它按定义的顺序返回函数，而不是按字母顺序排序。

此外，这将包括由 导入的函数`my_module`，如果您想过滤掉那些以仅获取在 中定义的函数`my_module`，请参阅我的问题[Get all defined functions in Python module](https://stackoverflow.com/questions/65251833/get-all-defined-functions-in-python-module)。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2020-04-01T10:21:21.477

```
r = globals()
sep = '\n'+100*'*'+'\n' # To make it clean to read.
for k in list(r.keys()):
    try:
        if str(type(r[k])).count('function'):
            print(sep+k + ' : \n' + str(r[k].__doc__))
    except Exception as e:
        print(e) 
```

* * *

输出 ：

```
******************************************************************************************
GetNumberOfWordsInTextFile : 

    Calcule et retourne le nombre de mots d'un fichier texte
    :param path_: le chemin du fichier à analyser
    :return: le nombre de mots du fichier

******************************************************************************************

    write_in : 

        Ecrit les donnees (2nd arg) dans un fichier txt (path en 1st arg) en mode a,
        :param path_: le path du fichier texte
        :param data_: la liste des données à écrire ou un bloc texte directement
        :return: None

 ******************************************************************************************
    write_in_as_w : 

            Ecrit les donnees (2nd arg) dans un fichier txt (path en 1st arg) en mode w,
            :param path_: le path du fichier texte
            :param data_: la liste des données à écrire ou un bloc texte directement
            :return: None 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-08-05T15:28:27.623

[Python 文档](https://docs.python.org/3/tutorial/modules.html#the-dir-function)为此提供了完美的解决方案，它使用内置函数`dir`。

您可以只使用*dir(module_name)*，然后它将返回该模块中的函数列表。

例如，*dir(time)*将返回

`['_STRUCT_TM_ITEMS', '__doc__', '__loader__', '__name__', '__package__', '__spec__', 'altzone', 'asctime', 'ctime', 'daylight', 'get_clock_info', 'gmtime', 'localtime', 'mktime', 'monotonic', 'monotonic_ns', 'perf_counter', 'perf_counter_ns', 'process_time', 'process_time_ns', 'sleep', 'strftime', 'strptime', 'struct_time', 'time', 'time_ns', 'timezone', 'tzname', 'tzset']`

这是“时间”模块包含的功能列表。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-09-16T06:34:56.223

这会将 your_module 中定义的所有函数附加到列表中。

```
result=[]
for i in dir(your_module):
    if type(getattr(your_module, i)).__name__ == "function":
        result.append(getattr(your_module, i)) 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-01-16T01:11:58.090

如果要获取**当前文件**中定义的所有函数的列表，可以这样做：

```
# Get this script's name.
import os
script_name = os.path.basename(__file__).rstrip(".py")

# Import it from its path so that you can use it as a Python object.
import importlib.util
spec = importlib.util.spec_from_file_location(script_name, __file__)
x = importlib.util.module_from_spec(spec)
spec.loader.exec_module(x)

# List the functions defined in it.
from inspect import getmembers, isfunction
list_of_functions = getmembers(x, isfunction) 
```

作为一个应用程序示例，我使用它来调用我的单元测试脚本中定义的所有函数。

这是根据[Thomas Wouters](https://stackoverflow.com/a/139198/9282844)和[adrian](https://stackoverflow.com/a/9794849/9282844)的答案改编的代码组合，以及来自[Sebastian Rittau](https://stackoverflow.com/a/67692/9282844)在另一个问题上的答案。

# sql - 我可以通过转义单引号并用单引号包围用户输入来防止 SQL 注入吗？

> ID：139199
> 
> 赞同：148
> 
> 时间：2008-09-26T12:41:25.720
> 
> 标签：sql, security, sql-server-2000, sql-injection, sanitization

我意识到参数化 SQL 查询是在构建包含用户输入的查询时清理用户输入的最佳方式，但我想知道接受用户输入并转义任何单引号并用单引号包围整个字符串有什么问题。这是代码：

```
sSanitizedInput = "'" & Replace(sInput, "'", "''") & "'" 
```

用户输入的任何单引号都将替换为双单引号，这消除了用户结束字符串的能力，因此他们可能键入的任何其他内容，例如分号、百分号等，都将成为字符串的一部分，并且实际上并未作为命令的一部分执行。

我们使用的是 Microsoft SQL Server 2000，我相信单引号是唯一的字符串定界符，也是转义字符串定界符的唯一方法，因此无法执行用户输入的任何内容。

我看不出有任何方法可以对此发起 SQL 注入攻击，但我意识到，如果这在我看来是防弹的，那么其他人早就想到了，这将是常见的做法。

这段代码有什么问题？有没有办法通过这种清理技术进行 SQL 注入攻击？利用此技术的示例用户输入将非常有帮助。

* * *

更新：

我仍然不知道有什么方法可以有效地对这段代码发起 SQL 注入攻击。一些人建议反斜杠将转义一个单引号并留下另一个以结束字符串，以便将字符串的其余部分作为 SQL 命令的一部分执行，我意识到这种方法可以将 SQL 注入MySQL 数据库，但在 SQL Server 2000 中，唯一的方法（我已经能够找到）转义单引号是使用另一个单引号；反斜杠不会这样做。

除非有办法阻止单引号的转义，否则用户输入的其余部分都不会被执行，因为它们都将被视为一个连续的字符串。

我知道有更好的方法来清理输入，但我真的更有兴趣了解为什么我上面提供的方法不起作用。如果有人知道针对这种清理方法发起 SQL 注入攻击的任何特定方法，我很乐意看到它。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-09-26T14:18:45.813

首先，这只是不好的做法。输入验证总是必要的，但也总是不确定的。
更糟糕的是，黑名单验证总是有问题，最好明确和严格地定义您接受的值/格式。诚然，这并不总是可能的 - 但在某种程度上必须始终这样做。
关于该主题的一些研究论文：

*   [http://www.imperva.com/docs/WP_SQL_Injection_Protection_LK.pdf](http://www.imperva.com/docs/WP_SQL_Injection_Protection_LK.pdf)
*   [http://www.it-docs.net/ddata/4954.pdf](http://www.it-docs.net/ddata/4954.pdf)（披露，最后一个是我的；））
*   [https://www.owasp.org/images/d/d4/OWASP_IL_2007_SQL_Smuggling.pdf](https://www.owasp.org/images/d/d4/OWASP_IL_2007_SQL_Smuggling.pdf)（基于之前的论文，已不再提供）

关键是，您所做的任何黑名单（以及过于宽松的白名单）都可以被绕过。我论文的最后一个链接显示了甚至可以绕过引号转义的情况。

即使这些情况不适用于您，这仍然是一个坏主意。此外，除非您的应用程序非常小，否则您将不得不处理维护，也许还有一定程度的治理：您如何确保它在任何时候都正确完成？

正确的做法：

*   白名单验证：类型、长度、格式或接受的值
*   如果您想加入黑名单，请继续。引用转义很好，但在其他缓解措施的范围内。
*   使用命令和参数对象，预解析和验证
*   仅调用参数化查询。
*   更好的是，只使用存储过程。
*   避免使用动态 SQL，并且不要使用字符串连接来构建查询。
*   如果使用 SP，您还可以将数据库中的权限限制为仅执行所需的 SP，而不是直接访问表。
*   您还可以轻松验证整个代码库是否仅通过 SP 访问数据库...

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-12-18T02:03:54.007

好的，这个回复将与问题的更新有关：

> “如果有人知道针对这种清理方法发起 SQL 注入攻击的任何具体方法，我很乐意看到它。”

现在，除了 MySQL 反斜杠转义 - 考虑到我们实际上是在谈论 MSSQL，实际上还有 3 种可能的方式让 SQL 注入您的代码

> sSanitizedInput = "'" & Replace(sInput, "'", "''") & "'"

考虑到这些并非在任何时候都有效，并且非常依赖于您的实际代码：

1.  二阶 SQL 注入 - 如果 SQL 查询是基于在**转义后**从数据库中检索到的数据重建的，则数据会以非转义的方式连接起来，并且可能会间接地被 SQL 注入。看
2.  字符串截断——（稍微复杂一点）——场景是你有两个字段，比如用户名和密码，SQL 将它们连接起来。并且两个字段（或只是第一个）对长度都有硬性限制。例如，用户名限制为 20 个字符。假设您有以下代码：

> ```
> username = left(Replace(sInput, "'", "''"), 20) 
> ```

然后你得到 - 是用户名，转义，然后修剪为 20 个字符。这里的问题 - 我将把我的引号放在第 20 个字符中（例如，在 19 a 之后），并且您的转义引号将被修剪（在第 21 个字符中）。然后是 SQL

```
sSQL = "select * from USERS where username = '" + username + "'  and password = '" + password + "'" 
```

结合上述格式错误的用户名将导致密码已经在引号*之外*，并且将直接包含有效负载。*3\. Unicode 走私——在某些情况下，可以传递一个看起来*像引号但*实际上不是*
的高级 unicode 字符——直到它到达数据库时，它突然出现*了*。由于验证时它不是引用，因此它会很容易...有关更多详细信息，请参阅我以前的回复，并链接到原始研究。

 **** * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-09-26T12:51:17.427

简而言之：永远不要让自己逃避查询。你一定会出错。相反，请使用参数化查询，或者如果由于某种原因您不能这样做，请使用为您执行此操作的现有库。没有理由自己做。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-02-19T10:57:55.770

我意识到这是在提出问题后很长时间，但是..

对“引用参数”过程发起攻击的一种方法是使用字符串截断。根据 MSDN，在 SQL Server 2000 SP4（和 SQL Server 2005 SP1）中，过长的字符串会被悄悄截断。

当你引用一个字符串时，字符串的大小会增加。每个撇号都重复。然后可以使用这将部分 SQL 推送到缓冲区之外。因此，您可以有效地删除 where 子句的部分内容。

这可能在“用户管理”页面场景中最有用，您可以滥用“更新”语句来不执行它应该执行的所有检查。

因此，如果您决定引用所有参数，请确保您知道字符串大小的情况，并确保您不会遇到截断。

我建议使用参数。总是。只是希望我可以在数据库中强制执行。作为副作用，您更有可能获得更好的缓存命中，因为更多语句看起来相同。（这在 Oracle 8 上肯定是正确的）

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-09-26T12:51:34.853

我在处理“高级搜索”功能时使用了这种技术，从头开始构建查询是唯一可行的答案。（示例：允许用户根据对产品属性的无限约束来搜索产品，将列及其允许值显示为 GUI 控件，以降低用户的学习门槛。）

它本身是安全的 AFAIK。然而，正如另一位回答者指出的那样，您可能还需要处理退格转义（尽管至少在使用 ADO 或 ADO.NET 将查询传递给 SQL Server 时不需要 - 不能保证所有数据库或技术）。

问题是你真的必须确定哪些字符串包含用户输入（总是潜在的恶意），哪些字符串是有效的 SQL 查询。陷阱之一是如果您使用数据库中的值——这些值最初是用户提供的吗？如果是这样，他们也必须逃脱。我的回答是在构建 SQL 查询时尽可能晚地进行清理（但不能更晚！​​）。

然而，在大多数情况下，参数绑定是可行的方法——它更简单。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-26T12:51:02.310

输入卫生不是你想半途而废的东西。用你的整个屁股。在文本字段上使用正则表达式。TryCast 将您的数字转换为正确的数字类型，如果它不起作用，则报告验证错误。在您的输入中搜索攻击模式非常容易，例如'-. 假设来自用户的所有输入都是敌对的。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-26T12:45:33.307

正如你所知道的那样，无论如何这都是个坏主意。

像这样在字符串中转义引号怎么样：\'

您的替换将导致：\''

如果反斜杠转义了第一个引号，则第二个引号结束了字符串。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-26T19:32:42.750

简单的答案：它有时会起作用，但并非一直有效。你想对你所做的**每件事都**使用白名单验证，但我意识到这并不总是可能的，所以你不得不选择最好的猜测黑名单。同样，您希望在**Everything**中使用参数化的存储过程，但同样，这并不总是可行的，因此您不得不使用带参数的 sp_execute。

您可以通过多种方法解决任何可用的黑名单（以及一些白名单）。

一篇不错的文章在这里：[http ://www.owasp.org/index.php/Top_10_2007-A2](http://www.owasp.org/index.php/Top_10_2007-A2)

如果您需要将此作为快速解决方案，以便让您有时间获得一个真正的到位，那就去做吧。但不要认为你是安全的。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-29T18:50:27.977

有两种方法可以做到这一点，没有例外，可以避免 SQL 注入；准备好的语句或参数化的存储过程。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-26T12:49:21.770

如果您有可用的参数化查询，则应始终使用它们。只需一个查询通过网络，您的数据库就处于危险之中。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-11-14T20:01:32.143

帕特里克，您是否在所有输入周围添加单引号，甚至是数字输入？如果您有数字输入，但没有在其周围加上单引号，那么您就有了曝光。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-20T21:22:33.273

是的，这应该一直有效，直到有人运行[SET QUOTED_IDENTIFIER OFF](http://msdn.microsoft.com/en-us/library/ms174393.aspx)并在你身上使用双引号。

编辑：这并不像不允许恶意用户关闭引用标识符那么简单：

> SQL Server Native Client ODBC 驱动程序和用于 SQL Server 的 SQL Server Native Client OLE DB Provider 在连接时自动将 QUOTED_IDENTIFIER 设置为 ON。这可以在 ODBC 数据源、ODBC 连接属性或 OLE DB 连接属性中进行配置。**对于来自 DB-Library 应用程序的连接，SET QUOTED_IDENTIFIER 的默认值为 OFF。**
> 
> 创建存储过程时，**会捕获 SET QUOTED_IDENTIFIER 和 SET ANSI_NULLS 设置并将其用于该存储过程的后续调用**。
> 
> SET QUOTED_IDENTIFIER 也**对应于 ALTER DATABASE 的 QUOTED_IDENTIFER 设置。**
> 
> SET QUOTED_IDENTIFIER**在解析时设置**。在解析时设置意味着如果批处理或存储过程中存在SET语句，则无论代码执行是否实际到达该点，它都会生效；并且 SET 语句在执行任何语句之前生效。

QUOTED_IDENTIFIER 有很多方法可以在您不知道的情况下关闭。诚然 - 这不是您正在寻找的确凿证据，但它是一个相当大的攻击面。当然，如果您还转义了双引号 - 那么我们又回到了开始的地方。;)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-10-22T13:53:16.970

如果出现以下情况，您的辩护将失败：

*   查询需要一个数字而不是字符串
*   还有其他任何方式来表示单引号，包括：
    *   转义序列，例如 \039
    *   一个 unicode 字符

（在后一种情况下，它必须是仅在您完成替换后才扩展的东西）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-26T12:45:48.517

对用户输入进行清理的所有代码将是多么丑陋！然后是用于 SQL 语句的笨重的 StringBuilder。准备好的语句方法导致代码更简洁，SQL 注入的好处是一个非常好的补充。

还有为什么要重新发明轮子？

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T12:48:17.793

与其将单引号更改为（看起来像）两个单引号，为什么不将其更改为撇号、引号或完全删除它呢？

无论哪种方式，这都有点杂乱无章...尤其是当您合法拥有可能使用单引号的事物（例如名称）时...

注意：您的方法还假设在您的应用程序上工作的每个人都始终记得在输入到达数据库之前对其进行清理，这在大多数情况下可能是不现实的。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-09-26T12:45:29.813

虽然您可能会找到适用于字符串的解决方案，但对于数字谓词，您还需要确保它们仅传递数字（简单检查是否可以将其解析为 int/double/decimal？）。

这是很多额外的工作。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2008-09-26T12:45:14.960

它可能有效，但对我来说似乎有点做作。我建议通过对正则表达式进行测试来验证每个字符串是否有效。

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2016-02-20T22:05:06.030

# 是的，你可以，如果...

在研究了该主题之后，我认为按照您的建议对输入进行了清理是安全的，但仅在以下规则下：

1.  您绝不允许来自用户的字符串值变成字符串文字以外的任何内容（即避免提供配置选项：“在此处输入其他 SQL 列名称/表达式：”）。字符串以外的值类型（数字、日期等）：将它们转换为其本机数据类型，并为每种数据类型的 SQL 文字提供例程。

    *   SQL 语句难以验证
2.  您要么使用`nvarchar`/`nchar`列（并使用前缀字符串文字`N`）或将进入`varchar`/`char`列的值限制为仅 ASCII 字符（例如，在创建 SQL 语句时抛出异常）

    *   这样，您将避免从 CHAR(700) 到 CHAR(39) 的自动撇号转换（可能还有其他类似的 Unicode hack）
3.  您总是验证值长度以适合实际列长度（如果更长则抛出异常）

    *   SQL Server 中存在一个已知缺陷，允许绕过截断时引发的 SQL 错误（导致静默截断）
4.  你确保那`SET QUOTED_IDENTIFIER`总是`ON`

    *   请注意，它在解析时生效，即即使在不可访问的代码部分

遵守这4点，你应该是安全的。如果您违反其中任何一个，就会打开 SQL 注入的方法。

# asp.net - Repeater、ListView、DataList、DataGrid、GridView……选哪个？

> ID：139207
> 
> 赞同：112
> 
> 时间：2008-09-26T12:43:51.267
> 
> 标签：asp.net, user-interface

这么多不同的控件可供选择！确定使用哪个控件在 ASP.NET 中显示数据的最佳做法是什么？

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2008-09-26T12:55:21.410

这真的是关于你想要达到的目标

*   Gridview - 设计有限，像 html 表格一样工作。更多内置功能，如编辑/更新、页面、排序。很多开销。

*   DataGrid - 旧版本的 Gridview。gridview 是一个超级数据网格。

*   Datalist - 更可定制的 Gridview 版本。也有一些开销。更多的手工工作，因为您必须自己设计。

*   ListView - 新的 Datalist :)。几乎是 datalist 和 gridview 的混合体，您可以在其中使用分页和构建类似 Gridview 的功能，但可以自由设计。该系列中的新控件之一

*   中继器 - 重量很轻。没有像页眉、页脚这样的内置功能。开销最小。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-26T13:53:14.407

其他人都击中了它：这取决于。

现在获得一些具体的指导（扩展WebDude上面的优秀答案）......

您的设计是否适合数据的自然电子表格或网格视图？**网格视图**。

您是否需要显示数据的列表或其他格式的视图，可能带有页眉和页脚，并且可能带有特定控件和/或每个数据记录的格式？（例如，自定义链接，可能是链接按钮，或特定的编辑控件？）这种显示是否特别*不*适合电子表格或网格视图？**列表显示**

如果您满足 ListView 的所有条件，但您自然会适合网格，您可以考虑**DataList**。

当我只需要一些用一些自定义设计位迭代的基本数据时，我会选择**Repeater ，没有页眉，没有页脚，又漂亮又干净。**

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2013-10-18T08:54:26.623

## 标记视图

可以为所有 3（ListView、DataList、Repeater）声明以下示例代码

```
<asp:ListView runat="server" OnItemCommand="Unnamed1_ItemCommand">
<ItemTemplate> <%# Eval("Name")%>    </ItemTemplate>
<asp:ListView> 
```

在以下列表中，您可以查看每个可用模板和选项，并亲自查看差异

**ListView**（注意编辑、组、插入、布局）

*   交替项目模板
*   编辑项目模板
*   空数据模板
*   空项目模板
*   GroupSeparator模板
*   组模板
*   插入项目模板
*   项目分隔符模板
*   项目模板
*   布局模板
*   选定项模板

**DataList**（注意样式对）

*   交替项样式
*   交替项目模板
*   编辑项样式
*   编辑项目模板
*   页脚样式
*   页脚模板
*   页眉样式
*   标头模板
*   物品样式
*   项目模板
*   选定项样式
*   选定项模板
*   分隔符样式
*   分隔符模板

**中继器**

*   交替项目模板
*   页脚模板
*   标头模板
*   项目模板
*   分隔符模板

## 代码视图（高级视图）

**复合数据绑定控件**：

查看以下类层次结构（和相关控件）。

这些控件在其模板中托管其他 asp.net 控件，以向用户显示绑定数据

## ![CompositeDataBoundControl 类（和相关控件）](https://i.stack.imgur.com/IyT6d.png)

## 一些描述以获得更好的说明

**列表视图控件**

ListView 控件还使用模板来显示数据。但是，它支持许多其他模板，这些模板在处理数据时允许更多场景。这些模板包括**LayoutTemplate、GroupTemplate、ItemSeparatorTemplate**。

ListView 控件（**与 DataList 和 Repeater 不同**）还隐式支持使用数据源控件编辑、插入和删除数据的能力。您可以为每个场景定义单独的模板。

**数据列表控件**

DataList 控件的工作**方式与Repeater**控件类似。它为数据集中的每一行重复数据，并根据您定义的模板显示此数据。**但是**，它将模板中定义的数据放在各种 HTML 结构中。这包括水平或垂直布局的选项，**它还允许您**设置数据的重复方式，如流或表格布局。

DataList 控件不会自动使用数据源控件来编辑数据。相反，它**提供了命令事件**，您可以在其中为这些场景编写自己的代码。要启用这些事件，请将 Button 控件添加到模板之一并将按钮的 CommandName 属性设置为 edit、delete、update 或 cancel 关键字。然后由 DataList 控件引发相应的事件。

**中继器控制**

Repeater 控件还使用模板来定义自定义绑定。但是，它不会将数据显示为单独的记录。相反，它会重复您在模板中指定的数据行。这使您可以创建单行数据并在整个页面中重复。

Repeater 控件是一个**只读**模板。也就是说，它只支持 ItemTemplate。它不隐式支持编辑、插入和删除。如果您需要此功能，您应该考虑使用其他控件之一，否则**您将不得不自己**为 Repeater 控件编写代码。

* * *

以上描述来自**[MCTS Exam 70-515 Web Applications Development with Microsoft.NET Framework 4](http://shop.oreilly.com/product/9780735627406.do)**书。

本书中甚至没有提到 DataGrid，它被流行的 GridViews 取代，其他用户回答得很好

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-11-11T08:48:29.143

确实！我在博客上写过[ASP.NET 4.0 数据工具](http://www.wiseowl.co.uk/blog/s169/asp-net-data-controls.htm)之间的差异。基本上，gridviews 是呈现表格信息的最强大方式，而 ListView 控件用于更复杂的重复数据显示。如果我向 ASP.NET 新手提供建议，我会告诉他们从里到外学习 gridviews，并从一开始就忽略其他控件。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-26T12:51:44.557

这一切都取决于您希望如何布局数据。

如果您需要控制布局（例如表格与 CSS 与其他），请使用 Repeater 或 ListView。在两者之间，ListView 为您提供了更多的事件和用于编辑、选择、插入的内置命令。另外分页和分组功能。Repeater 非常简单，它使用数据重复布局。由于您是手动构建布局，因此 Listview 和 Repeater 需要更多代码。

GridView 是一个更新的 DataGrid，因此几乎没有任何理由使用 DataGrid。GridView 在连接到标准 ASP.NET 数据源时工作得非常好，但将您限制为具有大量布局规则的表格布局。GridView 需要更少的代码，因为您使用的是内置布局。

# winforms - 您是否将对象字段数据绑定到表单控件？

> ID：139209
> 
> 赞同：2
> 
> 时间：2008-09-26T12:44:27.957
> 
> 标签：winforms, oop, data-binding

或者您是否通过一种方法手动填充表单控件？

是否被认为是最佳实践？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T12:46:38.437

这要看情况。我倾向于尽可能使用数据绑定——这非常方便，但有时我会手动填充它们。特别是，我发现它与 DataGridView 之类的控件一起使用数据绑定很有用。它使过滤变得非常简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T12:49:22.407

这真的取决于你想要达到的目标。

数据绑定简单而强大，但如果您需要更多控制或某种副作用，您可以从方法手动填充控制。

就个人而言，我先从数据绑定开始，然后在必要时更改它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T13:57:18.237

一般来说，如果数据绑定业务或 DAL 对象是可能的，我会使用它。古老的公理是正确的：最无错误和最可靠的代码行通常是您不必编写的代码行。（但是请记住，您需要确切地知道数据绑定是如何发生的，它的开销是多少，并且您必须能够相信框架和源对象是没有错误的！）

正如其他人所提到的，如果您需要不通过绑定直接提供的特定功能，或者如果数据绑定业务/DAL 对象存在问题（某些第 3 方控件偶尔会发生），您将手动填充。

# python - 将 Cookie 添加到 ZSI 帖子

> ID：139212
> 
> 赞同：2
> 
> 时间：2008-09-26T12:45:01.203
> 
> 标签：python, web-services, cookies, soappy, zsi

我通过覆盖 HTTPTransport 为 SOAPpy 添加了 cookie 支持。我需要 SOAPpy 之外的功能，所以我计划迁移到 ZSI，但我不知道如何将 Cookie 放在 ZSI 发布到服务的帖子上。如果没有这些 cookie，服务器会认为这是一个未经授权的请求并且会失败。

如何将 Python CookieJar 中的 cookie 添加到 ZSI 请求中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T10:15:27.800

如果您阅读[ZSI 的 client.py 中的 _Binding 类，](https://pywebsvcs.svn.sourceforge.net/svnroot/pywebsvcs/trunk/zsi/ZSI/client.py)您可以看到它有一个变量 cookies，它是[Cookie.SimpleCookie](http://docs.python.org/lib/module-Cookie.html)的一个实例。按照[ZSI 示例](http://pywebsvcs.sourceforge.net/zsi.html#SECTION003210000000000000000)和[Cookie 示例](http://docs.python.org/lib/cookie-example.html)，它应该如何工作：

```
b = Binding(url='/cgi-bin/simple-test', tracefile=fp)
b.cookies['foo'] = 'bar' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T11:55:11.467

此外，Binding 类还允许添加任何标头。所以我发现我可以为我需要添加的每个 cookie 添加一个“cookie”标题。这对于 wsdl2py 生成的代码很有效，只需在 SOAP 客户端类中形成绑定后立即添加 cookie。向生成的类添加参数以将 cookie 作为字典接收很容易，然后可以轻松地迭代和添加它们。

# coding-style - 冗余代码结构

> ID：139214
> 
> 赞同：7
> 
> 时间：2008-09-26T12:45:13.963
> 
> 标签：coding-style

我经常看到的最严重的冗余代码结构涉及使用代码序列

```
if (condition)
    return true;
else
    return false; 
```

而不是简单地写

```
return (condition); 
```

我在各种语言中都看到过这个初学者错误：从 Pascal 和 C 到 PHP 和 Java。您会在代码审查中标记哪些其他此类结构？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T12:51:01.453

```
if (foo == true)
{
   do stuff
} 
```

我一直告诉开发人员这样做应该是

```
if ((foo == true) == true)
{
   do stuff
} 
```

但他还没有得到提示。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-26T12:49:27.383

```
if (condition == true)
{
  ...
} 
```

代替

```
if (condition)
{
  ...
} 
```

**编辑：**

甚至更糟糕的是，转过条件测试：

```
if (condition == false)
{
  ...
} 
```

很容易理解为

```
if (condition) then ... 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-26T13:04:19.207

使用注释而不是源代码管理：
- 注释掉或重命名函数而不是删除它们，并相信源代码管理可以在需要时为您取回它们。
- 添加诸如“RWF 更改”之类的评论，而不是仅仅进行更改并让源代码管理部门承担责任。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T13:08:41.130

我在某个地方发现了这个东西，我发现它是布尔冗余的顶峰：

```
return (test == 1)? ((test == 0) ? 0 : 1) : ((test == 0) ? 0 : 1); 
```

:-)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T13:00:53.177

在 C 以外的语言中与赋值分开声明：

```
int foo;  
foo = GetFoo(); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T13:13:06.377

冗余代码本身并不是错误。但如果你真的想拯救每一个角色

```
return (condition); 
```

也是多余的。你可以写：

```
return condition; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T12:47:43.737

最后无用返回：

```
 // stuff
   return;
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-26T12:52:36.910

```
void myfunction() {
  if(condition) {
    // Do some stuff
    if(othercond) {
      // Do more stuff
    }
  }
} 
```

代替

```
void myfunction() {
  if(!condition)
    return;

  // Do some stuff

  if(!othercond)
    return;

  // Do more stuff
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-26T12:56:36.307

我曾经有一个人反复这样做：

```
bool a;
bool b;
...
if (a == true)
    b = true;
else
    b = false; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-10T15:00:21.347

我看到的最常见的冗余代码构造是从不从程序中的任何地方调用的代码。

另一种是在没有意义的情况下使用的设计模式。例如，到处都写“new BobFactory().createBob()”，而不是只写“new Bob()”。

删除未使用和不必要的代码可以大大提高系统质量和团队维护它的能力。对于从未考虑过从系统中删除不必要代码的团队来说，这些好处常常令人吃惊。我曾经与一个团队坐在一起进行代码审查，删除了他们项目中一半以上的代码，而不改变他们系统的功能。我以为他们会被冒犯，但在那之后他们经常向我询问设计建议和反馈。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-26T12:48:24.407

在字符串上使用 .tostring

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-26T12:58:56.380

将`exit`语句作为第一个语句放在函数中以禁用该函数的执行，而不是以下选项之一：

*   彻底删除功能
*   注释函数体
*   保留功能但删除所有代码

使用`exit`as first 语句很难发现，您可以轻松地阅读它。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-26T13:15:02.423

对 null 的恐惧（这也可能导致严重的问题）：

```
if (name != null)
  person.Name = name; 
```

冗余 if （不使用 else）：

```
if (!IsPostback)
{
   // do something
}
if (IsPostback)
{
   // do something else
} 
```

冗余检查（Split 从不返回 null）：

```
string[] words = sentence.Split(' ');
if (words != null) 
```

更多关于检查（如果你要循环，第二次检查是多余的）

```
if (myArray != null && myArray.Length > 0)
  foreach (string s in myArray) 
```

而我最喜欢的 ASP.NET：`DataBind`在整个代码中散布 s 以使页面呈现。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-26T13:37:25.040

复制粘贴冗余：

```
if (x > 0)
{
   // a lot of code to calculate z
   y = x + z;
}
else
{
   // a lot of code to calculate z
   y = x - z;
} 
```

代替

```
if (x > 0)
  y = x + CalcZ(x);
else
  y = x - CalcZ(x); 
```

甚至更好（或更模糊）

```
y = x + (x > 0 ? 1 : -1) * CalcZ(x) 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-29T07:49:22.073

在堆而不是堆栈上分配元素。

```
{
    char buff = malloc(1024);
    /* ... */
    free(buff);
} 
```

代替

```
{
    char buff[1024];
    /* ... */
} 
```

或者

```
{    
    struct foo *x = (struct foo *)malloc(sizeof(struct foo));
    x->a = ...;
    bar(x);
    free(x);
} 
```

代替

```
{
    struct foo x;
    x.a = ...;
    bar(&x);
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-26T13:09:02.987

我经常遇到以下情况：

```
function foo() {
    if ( something ) {
        return;
    } else {
        do_something();
    }
} 
```

但这无助于告诉他们 else 在这里没用。它必须是

```
function foo() {
    if ( something ) {
        return;
    }
    do_something();
} 
```

或 - 取决于在 do_something() 之前完成的检查的长度：

```
function foo() {
    if ( !something ) {
        do_something();
    }
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-30T20:37:25.150

从噩梦般的代码审查......

```
char s[100]; 
```

其次是

```
memset(s,0,100); 
```

其次是

```
s[strlen(s)] = 0; 
```

有很多讨厌的

```
if (strcmp(s, "1") == 0) 
```

乱扔代码。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-26T13:12:52.180

当您想要设置行为时使用数组。您需要在插入之前检查所有内容以确保其不在数组中，这会使您的代码更长更慢。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-02T13:16:14.400

冗余 .ToString() 调用：

```
const int foo = 5;
Console.WriteLine("Number of Items: " + foo.ToString()); 
```

不必要的字符串格式：

```
const int foo = 5;
Console.WriteLine("Number of Items: {0}", foo); 
```

# testing - 对于不测试代码的开发人员，你会怎么做？

> ID：139228
> 
> 赞同：26
> 
> 时间：2008-09-26T12:46:49.653
> 
> 标签：testing, project-management, software-quality

我们的一位开发人员不断地编写代码并将其放入版本控制中，而无需对其进行测试。我们的代码质量因此受到影响。

除了摆脱开发人员，我该如何解决这个问题？

编辑

我和他谈过很多次，甚至给了他书面警告

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-26T12:49:21.177

如果您可以进行代码审查 - 这是一个完美的地方。

我们需要在合并到迭代主干之前进行审查，因此通常会在那时捕获所有内容。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-09-26T13:03:31.330

如果您在允许开发人员提交代码之前系统地执行**代码审查**，那么您的问题基本上就解决了。但这似乎不是你的情况，所以这是我推荐的：

*   **与开发商交谈。**讨论对团队中其他人的后果。大多数开发人员都希望得到同行的认可，所以这可能就足够了。还要指出，修复你脑海中新鲜的代码中的错误比修复几周前的代码要容易得多。*如果你有某种形式的代码所有权*，这部分是有意义的。
*   如果这在一段时间后不起作用，请尝试制定一项政策，让提交有缺陷的代码对作者来说是不愉快的。一种流行的方法是让破坏构建的人负责创建下一个构建的琐事。如果您的构建过程是完全自动化的，请寻找其他琐碎的任务来代替。这种方法还有一个额外的好处，就是不会特别指出任何人，使其更容易被每个人接受。
*   **使用纪律措施**。根据您的团队和公司的规模，这些可以采取多种形式。
*   **解雇开发商。**保留坏苹果是有成本的。当你走到这一步时，开发人员并不关心他的开发人员，而且你已经遇到了人员问题。如果工作环境变得毒化，你可能会比这个糟糕的开发人员损失更多——生产力方面和人员方面的损失。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-26T13:32:13.320

作为一个很少测试自己代码的开发人员，我可以告诉你一件让我慢慢改变行为的事情......

**能见度**

如果环境允许将代码推出，等待用户发现问题，然后本质上是问“现在怎么样？” 在对代码进行更改后，没有真正的动力去测试你自己的东西。

代码审查和协作鼓励您努力制作优质产品，而不是仅仅交付“Widget X”而您的同事在“Widget Y”和“Widget Z”上工作

你的工作越显眼，你就越有可能关心它的工作情况。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-26T12:49:42.640

使其成为他的年度审查目标的一部分。如果达不到，就不会加薪。

有时，尽管您确实必须接受某人不适合您的团队/环境，但这应该是最后的手段，并且可能很难处理，但是如果您用尽了所有其他选择，从长远来看，这可能是最好的选择.

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-26T13:00:09.013

代码审查。每周一早上把你所有的开发人员都放在一个房间里，并要求他们将上周最自豪的基于代码的成就与他们一起带到会议上。

让他们成为焦点，对解释他们所做的事情感到兴奋。让他们带来代码副本，以便其他开发人员可以看到他们在说什么。

几个月前我们开始了这个过程，令人惊讶的是，我们在潜意识中进行了大量的质量检查。毕竟，如果只是要求开发人员谈论他们最兴奋的事情，他们会完全兴奋地向人们展示他们的代码。然后，其他开发人员将看到质量错误并公开讨论错误的原因以及应该如何真正编写代码。

如果这不能让您的开发人员编写高质量的代码，那么他可能不适合您的团队。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-26T12:49:13.827

告诉开发人员您希望在 2 周内看到他们的做法发生变化，否则您将开始贵公司的纪律处分程序。提供尽可能多的帮助和帮助，但如果你不能改变这个人，他就不适合你的公司。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-26T12:57:47.443

使用 Cruise Control 或类似工具，您可以使签入自动触发构建和单元测试。你仍然需要确保他添加的任何新功能都有单元测试，你可以通过查看他的签入来做到这一点。然而，这是一个人的问题，所以技术解决方案只能走这么远。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-26T12:47:48.043

为什么不直接跟他说话？他可能不会真的咬你。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-09-26T14:49:17.487

*   让他“照看”构建，并成为构建经理。这将给他更少的时间来开发代码（从而提高每个人的表现）并教他为什么一个好的构建是如此必要。

*   强制执行测试用例——没有单元测试用例就不能提交代码。修改构建系统，以便如果测试用例没有正确编译和运行，或者不存在，那么整个任务签入都会被拒绝。

-亚当

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-26T12:49:30.987

发布每个开发人员测试代码覆盖率的统计数据，这将在与他交谈之后。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-26T13:11:02.373

这里有一些来自海上棚户区的想法。

```
Intro
   What shall we do with a drunken sailor, (3×)
   Early in the morning?
Chorus
   Wey–hey and up she rises, (3×)
   Early in the morning!
Verses
   Stick him in a bag and beat him senseless, (3×)
   Early in the morning!
   Put him in the longboat till he’s sober, (3×)
   Early in the morning! 
```

等等。用“草率的开发者”代替“醉酒的水手”。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-09-26T12:50:44.793

根据您使用的版本控制系统的类型，您可以设置签入策略，强制代码在被允许签入之前通过某些要求。如果您使用像 Team Foundation Server 这样的系统，它使您能够为签入指定代码覆盖率和单元测试要求。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-26T12:52:03.400

您知道，这是避免将他单独挑出来（尽管我同意您需要与他交谈）并在内部实施测试优先流程的绝佳机会。如果规则不明确并且所有人都知道期望，那么我发现您所描述的并不少见。我发现执行测试优先的开发方案对我来说效果很好，并且可以提高代码质量。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-09-26T13:02:27.760

他们可能过度关注速度而不是质量。

这可能会诱使一些人匆忙解决问题以清除他们的列表并查看稍后在错误报告中返回的内容。

要纠正这种平衡：

1.  在您的问题跟踪系统中一次只分配几个项目，
2.  代码审查并尽快测试他们“完成”的任何内容，以便在有任何问题时立即回复他们
3.  与他们谈谈您对一件物品需要多长时间才能正确完成的期望

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-11-04T06:27:06.870

对等编程是另一种可能性。如果他与团队中另一位符合质量标准并了解程序的熟练开发人员在一起，那么这有一些好处：

1.  有经验丰富的开发人员支持他，他将了解对他的期望，并了解他的代码与符合期望的代码之间的区别
2.  其他开发人员可以强制执行测试优先策略：在为其编写测试之前不允许编写代码
3.  同样，其他开发人员可以在签入之前验证代码是否符合标准，从而减少错误签入的次数

当然，所有这些都要求公司和开发人员接受这个他们可能不接受的过程。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-11-04T06:30:58.733

对于这个问题，人们似乎想出了很多富有想象力和曲折的答案。但事实是，这不是游戏。设计复杂的同伴压力系统来“命名和羞辱”他不会找到问题的根源，即。他为什么不写测试？

我觉得你应该直接。我知道你说你和他谈过了，但你有没有试图找出他*为什么*不写测试？显然在这一点上他知道他*应该*这样做，所以肯定有一些原因他没有做他被告知要做的事情。是懒惰吗？拖延？程序员以自负和强烈的观点而闻名——也许他出于某种原因相信测试是浪费时间，或者他的代码总是完美的，不需要测试。如果他是一个不成熟的程序员，他可能无法完全理解他的行为的含义。如果他“太成熟”，他可能会太固执己见。不管是什么原因，解决它。

如果它确实归结为意见问题，您需要让他明白他需要将自己的个人意见放在一边，并遵守规则。明确表示，如果不能*信任*他遵守规则，那么他将被替换。如果他仍然不这样做，就这样做。

最后一件事 - 记录您的所有讨论以及由于他的更改而出现的任何问题。如果遇到最坏的情况，您可能会被迫证明自己的决定是正确的，在这种情况下，拥有书面证据肯定是无价的。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-26T12:49:14.203

把他放在他自己的开发分支上，只有在你知道它已经过彻底测试时才把他的东西放进后备箱。这可能是 GIT 或 Mercurial 等分布式源代码控制管理工具擅长的地方。尽管 SVN 中增加了对分支/合并的支持，但管理它可能不会有太多麻烦。

编辑

只有当你无法摆脱他或让他改变自己的方式时。如果您根本无法停止这种行为（通过更改或解雇），那么您能做的最好的事情就是缓冲团队其他成员免受他编码的不良影响。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-09-26T12:49:45.323

如果您所在的地方可以影响政策，请进行一些更改。在签入之前进行代码审查，并将测试作为开发周期的一部分。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-09-26T14:43:08.967

看起来很简单。把它作为一个要求，如果他做不到，就换掉他。你为什么要留着他？

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-09-29T17:23:59.307

我通常不提倡这一点，除非一切都失败了......

有时，公开显示的按开发人员统计的错误数图表可以施加足够的同行压力以获得有利的结果。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2010-01-14T14:00:15.630

试试胡萝卜，让它成为一个有趣的游戏。
例如 Hudson 的持续集成游戏插件
[http://wiki.hudson-ci.org/display/HUDSON/The+Continuous+Integration+Game+plugin](http://wiki.hudson-ci.org/display/HUDSON/The+Continuous+Integration+Game+plugin)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-26T12:52:09.280

根据某些逻辑，例如每个功能、每个错误修复、每个开发团队等，将您的开发人员放在代码的分支上。然后将错误的签到与这些分支隔离开来。当需要进行构建时，合并到测试分支，发现问题，解决，然后将您的版本合并回主分支。

或者删除该开发人员的提交权限，让他们在提交代码之前将其代码发送给年轻的开发人员进行审查和测试。这可能会促使程序发生变化。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-26T12:56:12.580

您可以将代码中发现的错误与负责该软件的程序员的姓名放在一起。

如果他是一个理性的人，请与他讨论报告。

如果他关心自己的“声誉”，请定期发布报告并提供给所有同行。

如果他只听“权威”的话，请报告并将问题上报给他的经理。

无论如何，我经常看到，当人们意识到他们从外面看起来有多糟糕时，他们会改变自己的行为。

嘿，这让我想起[了我在 xkcd 上读到](http://xkcd.com/481/)的东西:)

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-09-26T12:59:35.037

您是指在签入之前编写自动化单元测试还是手动单元测试？

如果您的商店不编写自动化测试，那么他签入不起作用的代码就是鲁莽的。对团队有影响吗？你们有正规的 QA 部门吗？

如果您都在创建自动化单元测试，那么我建议您的代码审查过程的一部分也包括单元测试。很明显，根据您的标准，在您的审查期间代码是不可接受的。

你的问题相当广泛，但我希望我提供了一些方向。

我同意菲尔的观点，第一步是单独与他交谈并解释质量的重要性。质量差往往与团队、部门和公司的文化有关。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-09-26T14:16:15.273

在某些事情被认为“完成”之前，将已执行的测试用例作为可交付成果之一。

如果你没有执行测试用例，那么工作就没有完成，如果截止日期在你有记录的测试用例执行之前就过去了，那么他没有按时交付，后果和他一样未完成开发。

如果您公司的文化不允许这样做，并且它重视速度而不是准确性，那么这可能就是问题的根源，而开发人员只是对现有的激励措施做出回应——他因为做了很多事情而得到了回报事情半途而废，而不是正确的事情更少。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-09-26T16:18:16.680

使人清洁厕所。在军队工作。如果你和吃很多印度菜的人一起工作，他们很快就会排队。

但这只是我...

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-09-26T16:36:48.243

每次开发人员检查无法编译的内容时，将一些钱放入罐子中。在那之前你会三思而后行。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2008-09-29T13:49:12.457

不幸的是，如果您已经与他多次交谈并给了他书面警告，我会说是时候将他从团队中淘汰了。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2010-01-14T16:42:46.253

您可能会在这里找到一些有用的答案：[如何让初级程序员编写测试？](https://stackoverflow.com/questions/7252/how-to-make-junior-programmers-write-tests)

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2010-01-14T16:54:23.547

如果你**真的**和他谈过，你给了他**所有的支持和培训，他需要**理解为什么这很重要，那么我会考虑摆脱他（如何运作取决于你在世界的哪个地方是）。我知道你说过除了解雇他之外你还想要一些东西，但有时问题没有“好的”解决方案。

没有苛刻的程序员总是谈论离开不认真对待软件开发的公司。

如果这是合理的，那么公司为什么要容忍一个已经获得了所有合理机会但显然仍然没有认真对待软件开发的开发人员呢？

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2010-01-14T18:22:39.047

我很想建议详细说明您尝试过的内容以及获得的结果，因为这可能会有所改变，但这是我的初步建议：

1.  是测试还是综合测试？有些人可能会盲目编码并进行零测试，但这很少见，IME。通常会进行一些测试，但不足以涵盖大多数需要综合测试的情况。

2.  团体动力可能会有所帮助。我假设他是团队的一员，并且团队的观点在这里可能会有所帮助。在某种程度上，这是试图获得同伴压力，这通常是一件坏事，但有时它可以以好的方式使用。

3.  警告的详细程度如何？在某种程度上，这可能看起来很幼稚，但您认为的测试可能与他的不同。您想要 nUnit 测试、excel 电子表格、他计算机中的日志或其他东西作为测试存在和使用的证据吗？根据您的描述，没有任何证据可以证实他确实理解您的意思，将使用测试并提供这样做的证据。

4.  入住政策问题。有些地方，比如我现在的工作场所，鼓励经常提交，这可能意味着一个人在没有测试的情况下提交代码。您所在的地区是否有已知、接受和严格遵守的政策？这是这里的另一个方面。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2010-01-15T08:26:07.017

如果您设置了自动构建，请确保失败通知尽可能明显和烦人。开发公共区域中的墙板或音频通知是一个好的开始。然后，确保一个构建被破坏，确保在犯罪者解决问题之前没有人签入代码。

Granted, this will only catch it when his code breaks the build, but the peer pressure for him to continually be spotlighted for this will be an incentive for most. In the event that this does not help, take the next discinplinary actions available through your human resources department. You have already talked to him, you already have given a written notice - find out what the next steps are. A developer who goes his own way is either a visionary or not a team player - and I have never personally had the pleasure of working with a visionary in that regard.

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-09-26T12:48:23.877

你试过和他们谈谈吗？可能不是一个糟糕的第一步。如果问题仍然存在，它还可能为您提供一些关于第 2 步应该是什么的线索。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-09-26T12:50:28.037

测试你的拼写！我认为您的意思是“他们的代码”。

*   跟他说话。让他知道这是个问题。
*   召开小组会议讨论代码质量。
*   如果它仍然很糟糕，请强迫他在签入之前检查他的代码。
*   如果到那时他还没有得到提示，你将不得不让他离开。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2008-09-26T13:37:57.707

NCover + Cruise Control，发送自动报告，然后可以证明当他检查代码覆盖率下降时。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2008-09-26T14:02:28.520

代码审查和单元测试。

作为（像许多人一样）检查一个微不足道的更改并破坏事情的人，我可以告诉你，单元测试消除了不测试的任何借口，如果它们被设置，那么你可以快速运行整个整体，它们有助于识别谁破坏了代码（假设一个不错的 VCS）。当然，通过非正式的代码审查，我已经检查了由资深（和称职的）同事审查过的琐碎代码，但仍然破坏了代码库。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2008-09-26T15:20:56.583

如果和他谈不上，你又不能解雇他，那他要么是懒惰，要么是不讲道理。如果你不能走上正经的路和那个人讲道理，那就打他最痛的地方，开始扣他的工资。或者如果你真的想惩罚他，让他维护代码。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2008-09-26T16:28:54.440

引入代码覆盖工具并从构建服务器生成单元测试未覆盖的所有代码的自动报告。他的名字将在董事会的底部。

该板应该每周打印并粘贴在每个人都可以看到的地方。

在他的覆盖率达到 85% 之前停止给他任何新的事情

给董事会顶端的人最有趣的工作。

将你的下一个书面警告与某个代码覆盖率要求联系起来——那么如果他失败了，你就有明确的解雇理由。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2008-09-29T13:37:16.027

告诉他他将被重新分配到质量团队，在那里他将只做文档。对于我领导的团队来说，这不止一次对我有用……如果这不起作用，请找其他人来测试他的代码！..等等，那是蹩脚的......哦，是的......解雇他！

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2008-09-29T13:52:07.130

这取决于。

他的代码有效吗？他是你团队中效率最高还是效率最低的成员？代码比其他代码错误吗？他/她的贡献有多大价值？

如果他是一个出色的表演者，可以产生高质量的代码，那么谁在乎。另一方面，如果他/她正在编写漏洞百出的代码，那么请让那个人坐下来，与他们交谈，列出后果，然后他们要么加入，要么不加入

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2008-09-29T13:56:18.587

您提到与开发人员交谈，但我很想知道您是否向他们询问了他们的测试程序。如果他们来自另一家公司，那么他们可能习惯于编写所有代码、签入、测试，然后签入代码的最终版本。如果他们将签到视为另一种保存工作的方式。

但是，如果他们已经在您的公司工作了很长一段时间（比如至少六个月），那么他们应该习惯于您做事的方式，这在更长时间内都不是一个非常有效的借口。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2008-10-26T06:14:47.370

简单的。让开发人员负责验证报告的错误并修复重现的错误。不要让这个人开发新功能。

如果这个人有半个大脑，他们很快就会被非单元测试代码导致的愚蠢的错误发展到一定程度。此外，该人的整体技能可能会显着提高。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2008-11-04T06:01:35.033

如果连他的代码的代码审查都不起作用，也许给他一个任务来审查他可能与自己的问题相关的其他“精彩”（;））代码，并要求他将他的代码与那个糟糕的部分进行比较的代码。

通常，这种人的问题是自我实现，所以无论你如何试图让他理解他自己的代码的问题；除非他自己没有意识到，否则它是行不通的。这当然是，如果你没有选择解雇他，事实上想培养他。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2008-11-04T06:16:16.423

听起来你已经向他明确表示这对你、公司和团队都很重要。

我认为你需要找出他行为背后的原因——他只是没有听到你在说什么吗？也许你需要找到另一种表达方式。

也许他不相信——可能有很多原因——找到根本原因并处理*它*。

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2008-11-13T05:05:42.677

如果谈话不起作用，请制定一项政策，将没有附带测试的签入代码简单地从存储库中撤出。在他们必须重写他们的代码几次之后，他们可能会收到消息。

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2008-12-11T09:31:06.167

我会建议（和其他人一样）：

*   代码审查，
*   结对编程，
*   SCM 提交策略。

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2008-12-11T09:39:08.677

你可以告诉你的版本控制系统，这个用户没有上传任何东西的权限，所以他必须让别人为他做。那应该教他。

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2008-12-26T07:49:42.913

在团队内部就将要测试的内容、测试方式以及测试时间（签入之前、推送之前、合并到主干之前）达成一致。

然后，当签入不符合团队同意的代码应满足的标准集时，只需将其回滚，并要求开发人员修复它。回滚签入是一种非常有效的方法，既可以在面对低质量签入时保持代码库的质量，又可以作为一种轻量级的方式向人们表明他们的代码不符合团队设定的标准.

回滚的好处在于，重新签入代码非常容易——只需回滚回滚，修复任何问题，然后再次检查更改。

我会小心地以一种非常客观的方式来做这件事，不会向任何人发出信号。这意味着将其应用于整个团队，而不仅仅是您的问题成员，并专注于使其更多地关注代码的质量，并使签入的代码符合团队彼此设定的标准，而不是作为一种惩罚.

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2010-01-14T16:41:44.523

你说他不测试他的代码。这是否意味着他不创建单元测试？或者他根本不测试他的代码？

如果他根本不测试他的代码，那么这是他开发的根本问题。测试您编写的代码是工作的一部分。不测试其代码的开发人员是不可接受的，并且会减慢您的项目速度。测试是开发人员（甚至是所谓的明星）工作描述的一部分。

但是，如果他正在测试他的代码，但没有创建“正确”数量的自动化单元测试，那么这是一个不同的问题，需要不同的解决方案。正如其他人所说，您需要找出原因并修复它。代码审查是发现这些问题的好方法。但听起来你已经知道问题所在了。

# language-agnostic - 学习一门新语言时有什么好的技巧或练习？

> ID：139239
> 
> 赞同：5
> 
> 时间：2008-09-26T12:48:34.750
> 
> 标签：language-agnostic

当你学习一门新语言时，有什么特别好的/有效的练习可以帮助你掌握它的窍门？为什么？

编辑：最好寻找比“Hello World”更复杂的东西。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T14:26:26.277

I usually do the following (in the order presented):

1.  Print a pyramid with height provided by the user (checks basic I/O, conditionals and loops)
2.  Write a class hierarchy with polymorphism etc... (checks OO concepts)
3.  Convert decimals to roman numerals (checks enums and basic data structures)
4.  Write a linkedlist implementation (checks memory allocation/deallocation)
5.  Write clones of JUnit and JMock (checks refelction/metaprogramming)
6.  Write a console based chat system (checks basic networking)
7.  Modify (6) to support group chat via multicasting (checks advanced networking)
8.  Write a GUI for (7) (checks GUI library)

After that its on to a real project...

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-26T12:51:40.280

除了 hello world，我尝试将现有程序之一移植到新语言。这将挑战我在新语言中学习一些好的旧技术，并帮助我建立一个新的类或助手库..

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-26T14:12:35.750

拉里·奥布莱恩（Larry O'Brien）有一系列很棒的博客，标题为“了解编程语言的 15 个练习”[第 1](http://www.knowing.net/PermaLink,guid,f3b9ba36-848e-43f8-9caa-232ec216192d.aspx) [部分第 2](http://www.knowing.net/PermaLink,guid,72124425-59db-4554-88f1-a67d405df7fa.aspx) [部分第 3 部分](http://www.knowing.net/PermaLink,guid,3161b24e-8682-4170-8864-abd29ae97dde.aspx)

有关详细信息，请参阅拉里的博客。

**第 1 部分。计算**

1.  编写一个程序，将单词“sum”、“product”、“mean”或“sqrt”中的一个作为其第一个参数，并将一系列数字作为进一步的参数。该程序将适当的功能应用于系列。

2.  编写一个程序，在一个数字数组上计算一个 Haar 小波。.

3.  编写一个程序，将位图图像的名称作为其参数。将 Haar 小波应用于像素值。将结果保存到文件中。

4.  使用上一个练习文件的输出，编写一个 GUI 程序来重构原始位图（注意：Haar 小波是无损的）。

5.  编写一个处理位图图像的 GUI 程序

**第 2 部分。数据结构**

6.  编写一个类（或模块或你有什么：请将 OOP 术语映射到任何适当的范式），它只存储与放置在其中的第一个对象相同类型的对象，如果添加了不兼容的类型，则会引发异常。

7.  使用该语言的习语，实现基于树的数据结构（splay、AVL 或红黑）。

8.  创建一个使用自定义比较器的新类型（即覆盖“Equals”）。将超出内存容量的这些对象放入上面创建的数据结构以及标准库中，将比内存容量更多的对象放入其中。将标准库的性能与您自己的实现进行比较。

9.  为您的数据结构实现一个迭代器。考虑多线程问题。

10.  编写一个多线程应用程序，使用您的数据结构、可比较类型和迭代器来实现练习 6 中描述的特定于类型的存储功能。您如何处理并发插入和遍历？

**第 3 部分。库**

11.  编写一个程序，将当前日期和时间作为反向 ISO 8601 格式的值输出到网页（即：“2006-06-16T13:15:30Z”变为“Z03:51:31T61-60-6002”）。为它创建一个 XML 接口（POX 或 WS-*）。

12.  编写一个客户端程序，它既可以抓取上述网页，又可以返回 XML，并以不同的格式重新显示日期。

13.  编写一个监视电子邮件帐户的守护程序。当一封强编码电子邮件到达并解密为有效的 ISO 8601 时间时，程序会将系统时间设置为该值。

14.  编写一个连接到您的邮件客户端的程序，对其内容进行统计分析（请参阅垃圾邮件计划）并将结果存储在数据库中。

15.  使用之前的练习，编写垃圾邮件过滤器，包括在邮件客户端中移动邮件

如果你能用 2 种语言做所有这些事情，我相信谷歌有适合你的工作

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T12:48:57.323

'你好世界！'

我真的认为这是一个很好的起点。它是基本的，只需要几秒钟，但你要确保你的编译器正在运行并且你已经准备好了一切。一旦你完成了，你就可以继续前进。添加变量，打印到数据库，打印到文件。确保您知道如何发表评论。这可能需要 5 分钟。但它的重要的东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T12:51:10.797

以某种方式连接到数据，无论是数据库、文件还是其他...

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T12:51:12.467

红黑树。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T12:56:17.120

除非我有一个“真正的”项目可以应用它，否则我通常不会很好地使用它。即使是编造的也会很快变得无聊。事实上，我发现将自己投入到一个更大的项目中并对已经有效的东西进行小幅改动是很有帮助的。

YMMV

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T13:16:39.597

我相当于一个 hello world 是执行以下操作：

1.  检索多个输入（即，来自命令行的参数、gui 上的文本框）
2.  操纵该输入（即，对数字进行数学运算并操纵文本）
3.  在 gui 上使用列表框。
4.  读取和写入文件。

我觉得在完成上述操作后，我对该语言有了很好的感觉，并对 IDE 有了很好的介绍，以及使用该语言及其运行的环境是多么容易（或实际上是多么困难）。

之后，如果我想更进一步，我将在我需要做的实际项目中使用该语言（可能是某种实用程序）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T12:49:04.657

就我个人而言，我喜欢制作一个简单的回显服务器和客户端来掌握使用该语言进行网络编程的窍门。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T12:51:23.480

射线追踪器。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T12:52:41.027

我喜欢通过做一个“真正的”任务来学习一门新语言（供“个人”使用）

我的第一个 java 程序是一个在线多人游戏的客户端（然后我将其发布到公共领域）

我的第一个 vb.net 程序是我的数字录像机的前端

我的第一个 VHDL“程序”是一个 64x32 LED 阵列控制器

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T15:36:40.040

基于控制台的俄罗斯方块

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T12:58:39.517

通常我会实现[k-means 聚类算法。](http://en.wikipedia.org/wiki/K-means_algorithm)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T13:25:03.040

拖放图片库。

当我开始研究 Win32 和 MFC 时，这是我的第一个项目之一。很快，我将所有代码移植到 ActiveX 控件中。然后我用Java重写了这个东西。为了好玩，我用纯 Javascript 再次重写了它。当我闯入 .Net 时，我再次用 C# 重写了这个东西。最后但同样重要的是，我用它作为学习 Objective-C 和 UIKit 的练习。

为什么？一方面，它是一种视觉上吸引人的玩具。我认为，从您的代码中获得即时满足感很好，使用图像是我能想到的最令人满意的事情之一。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-26T16:02:08.013

我喜欢学习编程的游戏，因为它的业务规则是经过仔细描述的。我用新语言编写的前三个程序是 Ro-Sham-Bo、Blackjack 和 Video Poker。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-26T16:02:09.590

选择一个你已经理解的任务。这样你就可以限制你需要吸收的“新东西”的数量。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-08-07T17:18:13.173

我认为，对我来说，通过移植现有代码（例如，从另一个平台）来学习总是一个挑战和乐趣。只是简单的演示、棋盘游戏等。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-03-26T12:06:59.557

曼德布罗套装。       

# sql-server - t sql中的相对路径？

> ID：139245
> 
> 赞同：8
> 
> 时间：2008-09-26T12:49:18.320
> 
> 标签：sql-server, tsql

如何获取t sql中的相对路径？以`.sql`文件夹中的文件为例`D:\temp`，我想获取文件夹中文件 hello.txt 的路径 `D:\temp\App_Data`。如何使用相对路径引用？

假设我正在 SQL Server 管理工作室中执行 sql 文件。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2014-11-12T22:33:54.190

我有一个类似的问题，并结合使用 sqlcmd 变量和 %CD% 伪变量来解决它。花了一些试验和错误来组合所有的部分。但最终一切正常。此示例期望`script.sql`文件与`runscript.bat`.

**运行脚本.bat**

```
sqlcmd -S .\SQLINSTANCE -v FullScriptDir="%CD%" -i script.sql -b 
```

**脚本.sql**

```
BULK INSERT [dbo].[ValuesFromCSV]
FROM '$(FullScriptDir)\values.csv'
with
(
    fieldterminator = ',',
    rowterminator = '\n'
)
go 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T13:14:01.820

.sql 文件只是....一个文件。它对自己的位置没有任何感觉。执行它的东西（你没有指定）会感知它的位置，文件的位置。

我注意到您提到了一个 App_Data 文件夹，所以我猜想涉及到 ASP.NET。如果您想在 Web 应用程序中使用相对路径，请参阅 MapPath

[http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.mappath.aspx](http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.mappath.aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-04T04:23:35.830

服务器正在执行 t-sql。它不知道客户端从哪里加载文件。您必须将路径嵌入脚本中。

```
DECLARE @RelDir varchar(1000)
SET @RelDir = 'D:\temp\'
... 
```

也许您可以以编程方式将路径放入 .sql 脚本文件中的 SET 命令中，或者您可以使用 sqlcmd 并将相对目录作为变量传递。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T14:16:50.577

当 T-SQL 执行时，它在服务器上批量运行，而不是在运行 Management Studio 的客户端计算机（或任何其他 SQL 客户端）上运行。客户端只是将 .sql 文件的文本内容发送到服务器以执行。因此，除非该文件位于数据库服务器上，否则我非常怀疑您是否能够通过 SQL 脚本与其进行交互。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-30T10:33:15.767

t-sql 脚本首先由客户端的 QueryAnalyzer、SSMS 或 sqlcmd 进行预处理。这些程序知道文件本地化并且可以轻松地处理类似于 To Oeacle sqlplus 的相对路径。

显然，这只是微软的一个设计决定，我敢说这是一个相当愚蠢的决定。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-06-12T06:09:34.953

我尝试了 mateuscb 评论中的方法。我发现它不能工作，我不知道为什么，然后我经过几次测试就成功了。它可以与以下脚本一起使用：

**运行脚本.bat**

```
@set FullScriptDir=%CD%
sqlcmd -S .\SQLINSTANCE  -i script.sql 
```

**脚本.sql**

```
BULK INSERT [dbo].[ValuesFromCSV]
FROM '$(FullScriptDir)\values.csv'
with
(
    fieldterminator = ',',
    rowterminator = '\n'
)
go 
```

仅供您参考，以供进一步讨论。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-21T16:33:24.503

好吧，这首先不是微软的事情……这是行业标准的事情。其次，您使用相对路径运行 T-SQL 的解决方案是使用批处理脚本或其他东西来注入您的路径语句 IE：

```
@echo OFF
SETLOCAL DisableDelayedExpansion
FOR /F "usebackq delims=" %%a in (`"findstr /n ^^ t-SQL.SQL"`) do (
    set "var=%%a"
    SETLOCAL EnableDelayedExpansion
    set "var=!var:*:=!"
    set RunLocation=%~dp0
    echo(%~dp0!var! > newsql.sql
   ENDLOCAL
)
 sqlcmd newsql.sql 
```

或者类似的东西

# c# - 使用 ISO-8859-1 编码的 XmlTextWriter 编写 XML 文件

> ID：139260
> 
> 赞同：18
> 
> 时间：2008-09-26T12:50:46.587
> 
> 标签：c#, .net, xml, encoding, iso-8859-1

我在使用 C# 将挪威语字符写入 XML 文件时遇到问题。我有一个字符串变量，其中包含一些挪威语文本（带有像æøå 这样的字母）。

我正在使用 XmlTextWriter 编写 XML，将内容写入 MemoryStream，如下所示：

```
MemoryStream stream = new MemoryStream();
XmlTextWriter xmlTextWriter = new XmlTextWriter(stream, Encoding.GetEncoding("ISO-8859-1"));
xmlTextWriter.Formatting = Formatting.Indented;
xmlTextWriter.WriteStartDocument(); //Start doc 
```

然后我像这样添加我的挪威文本：

```
xmlTextWriter.WriteCData(myNorwegianText); 
```

然后我像这样将文件写入磁盘：

```
FileStream myFile = new FileStream(myPath, FileMode.Create);
StreamWriter sw = new StreamWriter(myFile);

stream.Position = 0;
StreamReader sr = new StreamReader(stream);
string content = sr.ReadToEnd();

sw.Write(content);
sw.Flush();

myFile.Flush();
myFile.Close(); 
```

现在的问题是，在这个文件中，所有的挪威字符看起来都很有趣。

我可能以某种愚蠢的方式做上述事情。关于如何修复它的任何建议？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T13:05:52.307

为什么要先将 XML 写入 MemoryStream，然后再将其写入实际的文件流？这是相当低效的。如果您直接写入 FileStream 它应该可以工作。

如果您仍然想进行双重写入，无论出于何种原因，请执行以下两件事之一。任何一个

1.  确保您使用的 StreamReader 和 StreamWriter 对象*都*使用与 XmlWriter 使用的编码*相同*的编码（不仅仅是 StreamWriter，就像其他人建议的那样），或者

2.  不要使用 StreamReader/StreamWriter。相反，只需使用简单的 byte[] 和 Stream.Read/Write 在字节级别复制流。顺便说一句，无论如何，这将变得更有效率。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-26T13:16:16.417

您的 StreamWriter 和 StreamReader 都使用 UTF-8，因为您没有指定编码。这就是为什么事情越来越腐败。

正如 tomasr 所说，使用 FileStream 开始会更简单 - 而且 MemoryStream 有方便的“WriteTo”方法，可以让您非常轻松地将其复制到 FileStream。

顺便说一句，我希望你的真实代码中有一个 using 语句 - 如果在写入文件时出现问题，你不想让文件句柄保持打开状态。

乔恩

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-26T13:51:02.027

每次写入字符串或将二进制数据读取为字符串时，都需要设置编码。

```
 Encoding encoding = Encoding.GetEncoding("ISO-8859-1");

    FileStream myFile = new FileStream(myPath, FileMode.Create);
    StreamWriter sw = new StreamWriter(myFile, encoding);

    stream.Position = 0;
    StreamReader sr = new StreamReader(stream, encoding);
    string content = sr.ReadToEnd();

    sw.Write(content);
    sw.Flush();

    myFile.Flush();
    myFile.Close(); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-11-23T22:04:35.843

如上面的答案所述，这里最大的问题是`Encoding`，由于未指定而被默认。

如果您没有`Encoding`为这种转换指定 an，`UTF-8`则使用默认值 - 这可能与您的场景匹配，也可能不匹配。您还通过将数据推入 a 然后再推入 a 来不必要地转换`MemoryStream`数据`FileStream`。

如果您的原始数据不是`UTF-8`，那么这里会发生的情况是，第一次转换到`MemoryStream`将尝试使用默认值进行解码`Encoding`-`UTF-8`并因此损坏您的数据。然后，当您写出默认情况下`FileStream`也`UTF-8`用作编码的 . 时，您只需将损坏保存到文件中即可。

为了解决这个问题，您可能需要在`Encoding`您的`Stream`对象中指定。

您实际上也可以`MemoryStream`完全跳过该过程 - 这将更快，更有效。您更新的代码可能看起来更像：

```
FileStream fs = new FileStream(myPath, FileMode.Create);

XmlTextWriter xmlTextWriter = 
    new XmlTextWriter(fs, Encoding.GetEncoding("ISO-8859-1"));

xmlTextWriter.Formatting = Formatting.Indented;
xmlTextWriter.WriteStartDocument(); //Start doc

xmlTextWriter.WriteCData(myNorwegianText);

StreamWriter sw = new StreamWriter(fs);

fs.Position = 0;
StreamReader sr = new StreamReader(fs);
string content = sr.ReadToEnd();

sw.Write(content);
sw.Flush();

fs.Flush();
fs.Close(); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T12:55:04.237

您使用哪种编码来显示结果文件？如果它不在 ISO-8859-1 中，它将无法正确显示。

是否有理由使用这种特定的编码，而不是例如 UTF8？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-18T19:41:40.437

经过调查，这对我来说最有效：

```
var doc = new XDocument(new XDeclaration("1.0", "ISO-8859-1", ""));
        using (XmlWriter writer = doc.CreateWriter()){
            writer.WriteStartDocument();
            writer.WriteStartElement("Root");
            writer.WriteElementString("Foo", "value");
            writer.WriteEndElement();
            writer.WriteEndDocument();
        }
        doc.Save("dte.xml"); 
```

# linux - 如何在 Linux 中创建给定大小的文件？

> ID：139261
> 
> 赞同：190
> 
> 时间：2008-09-26T12:50:48.660
> 
> 标签：linux, command-line

出于测试目的，我必须生成一个特定大小的文件（以测试上传限制）。

在 Linux 上创建一定大小的文件的命令是什么？

* * *

## 回答 #1

> 赞同：217
> 
> 时间：2008-09-26T12:53:11.010

对于小文件：

```
dd if=/dev/zero of=upload_test bs=file_size count=1 
```

`file_size`测试文件的大小（以字节为单位）在哪里。

对于大文件：

```
dd if=/dev/zero of=upload_test bs=1M count=size_in_megabytes 
```

* * *

## 回答 #2

> 赞同：196
> 
> 时间：2012-01-03T00:25:59.383

拜托，现代更容易，更快。在 Linux 上，（选择一个）

```
truncate -s 10G foo
fallocate -l 5G bar 
```

*需要*说明的是，在支持稀疏文件的文件系统上，`truncate`会创建稀疏文件而`fallocate`不会。稀疏文件是组成文件的分配单元在使用之前没有*实际*分配的文件。然而，文件的元数据*将*占用一些相当大的空间，但可能不会接近文件的实际大小。您应该查阅有关稀疏文件的资源以获取更多信息，因为这种类型的文件有利有弊。非稀疏文件的块（分配单元）是提前分配的，这意味着只要文件系统看到它，就会保留空间。也不会将文件的内容设置为指定的值`fallocate`，*例如*`truncate` *`dd``fallocate`，而不是分配有或可能是在创建期间分配单元中存在的任何垃圾值的文件的内容，`truncate`并且可能需要也可能不需要这种行为。是最慢的`dd`，因为它实际上将值或数据块写入整个文件流，如其命令行选项所指定。*

 **这种行为可能会有所不同——取决于使用的文件系统以及该文件系统是否符合任何标准或规范。因此，建议进行适当的研究以确保使用适当的方法。*

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-09-26T13:11:29.577

只是为了跟进[Tom 的](https://stackoverflow.com/questions/139261/how-to-create-a-file-with-a-given-size-in-linux#139338)帖子，您也可以使用 dd 创建稀疏文件：

```
dd if=/dev/zero of=the_file bs=1 count=0 seek=12345 
```

这将在大多数 unix 上创建一个带有“洞”的文件 - 数据实际上不会被写入磁盘，或占用任何空间，直到写入非零的内容。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2008-09-26T12:52:02.090

使用这个命令：

```
dd if=$INPUT-FILE of=$OUTPUT-FILE bs=$BLOCK-SIZE count=$NUM-BLOCKS

```

要创建一个大（空）文件，请设置`$INPUT-FILE=/dev/zero`.
文件的总大小将是`$BLOCK-SIZE * $NUM-BLOCKS`.
创建的新文件将是`$OUTPUT-FILE`.

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2012-01-02T23:32:05.370

在 OSX（和 Solaris，显然）上，该`mkfile`命令也可用：

```
mkfile 10g big_file 
```

这会生成一个名为“big_file”的 10 GB 文件。在这里找到了这种方法[。](http://linuxcommando.blogspot.com/2008/02/create-file-of-given-size.html)

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2008-10-28T23:17:08.850

您可以以编程方式执行此操作：

```
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdlib.h>

int main() {
    int fd = creat("/tmp/foo.txt", 0644);
    ftruncate(fd, SIZE_IN_BYTES);
    close(fd);
    return 0;
} 
```

这种方法对于随后将文件映射到内存[中特别有用。](https://stackoverflow.com/search?q=mmap)

使用以下命令检查文件的大小是否正确：

```
# du -B1 --apparent-size /tmp/foo.txt 
```

**当心：**

```
# du /tmp/foo.txt 
```

可能会打印**0**，因为如果您的文件系统支持，它会被分配为[稀疏文件。](http://en.wikipedia.org/wiki/Sparse_file)

另请参阅：[man 2 open](http://linux.die.net/man/2/open)和[man 2 truncate](http://linux.die.net/man/2/truncate)

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2013-09-16T16:50:11.017

您可以将其中一些答案`/dev/zero`用作数据源。如果您的测试网络上传速度，如果您的应用程序正在执行任何压缩，这可能不是最好的主意，一个充满零的文件压缩*得非常*好。使用此命令生成文件

```
 dd if=/dev/zero of=upload_test bs=10000 count=1 
```

我可以压缩`upload_test`到大约 200 个字节。因此，您可以将自己置于您认为上传 10KB 文件但实际上要少得多的情况。

我建议使用`/dev/urandom`而不是`/dev/zero`. 我根本无法压缩`/dev/urandom`太多的输出。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-09-26T12:52:46.910

你可以这样做：

```
[dsm@localhost:~]$ perl -e 'print "\0" x 100' > filename.ext 
```

将 100 替换为要写入的字节数。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-09-26T12:52:19.687

```
dd if=/dev/zero of=my_file.txt count=12345 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2016-07-21T12:55:50.963

这将在当前目录中生成 4 MB 带有随机字符的文本文件，其名称为“4mb.txt”。您可以更改参数以生成不同的大小和名称。

```
base64 /dev/urandom | head -c 4000000 > 4mb.txt 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2020-01-01T16:05:42.673

`fallocate`如果您不想等待磁盘，请使用。

例子：

```
fallocate -l 100G BigFile 
```

用法：

```
Usage:
 fallocate [options] <filename>

Preallocate space to, or deallocate space from a file.

Options:
 -c, --collapse-range remove a range from the file
 -d, --dig-holes      detect zeroes and replace with holes
 -i, --insert-range   insert a hole at range, shifting existing data
 -l, --length <num>   length for range operations, in bytes
 -n, --keep-size      maintain the apparent size of the file
 -o, --offset <num>   offset for range operations, in bytes
 -p, --punch-hole     replace a range with a hole (implies -n)
 -z, --zero-range     zero and ensure allocation of a range
 -x, --posix          use posix_fallocate(3) instead of fallocate(2)
 -v, --verbose        verbose mode

 -h, --help           display this help
 -V, --version        display version 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2013-09-27T12:54:10.790

有很多答案，但没有一个很好地解释了还能做什么。查看[dd 的手册页](http://linux.die.net/man/1/dd)，可以更好地指定文件的大小。

这将创建 /tmp/zero_big_data_file.bin 用零填充，大小为 20 兆字节：

```
 dd if=/dev/zero of=/tmp/zero_big_data_file.bin  bs=1M count=20 
```

这将创建 /tmp/zero_1000bytes_data_file.bin 填充零，大小为 1000 字节：

```
 dd if=/dev/zero of=/tmp/zero_1000bytes_data_file.bin  bs=1kB count=1 
```

或者

```
 dd if=/dev/zero of=/tmp/zero_1000bytes_data_file.bin  bs=1000 count=1 
```

* * *

*   在所有示例中，bs 是块大小，count 是块数
*   BLOCKS 和 BYTES 后面可以跟以下乘法后缀：c =1, w =2, b =512, kB =1000, K =1024, MB =1000*1000, M =1024*1024, xM =M GB =1000 *1000*1000, G =1024*1024*1024，以此类推 T、P、E、Z、Y。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-10-24T18:25:31.770

作为 shell 命令：

```
< /dev/zero head -c 1048576 >  output 
```

# winforms - WinForms 应用程序的自动更新

> ID：139266
> 
> 赞同：20
> 
> 时间：2008-09-26T12:51:05.243
> 
> 标签：winforms, auto-update

在为 .NET WinForms 应用程序创建自动更新功能时，它如何更新 DLL 而不影响当前运行的应用程序？

由于应用程序在更新过程中运行，因此不会对 DLL 进行锁定（因为这些 DLL 在更新期间必须被覆盖）。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-26T12:52:36.083

通常，您会将新文件下载到单独的区域。然后关闭并重新启动，并在启动时查找并使用新文件（如果找到）。始终保留最后一个已知的工作版本，以便用户可以在下载导致问题时恢复到绝对有效的内容。

ClickOnce 是 Microsoft 提供的一项很好的技术，可以为您完成此操作，您可以直接从 Visual Studio 2008 中使用它。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-08-24T22:49:24.737

正如其他人已经评论的那样，您必须关闭您的应用程序并重新启动它。

我编写了一个开源代码以透明模式执行此操作 - 包括执行实际冷更新的外部更新应用程序。见 [http://www.code972.com/blog/2010/08/nappupdate-application-auto-update-framework-for-dotnet/](http://www.code972.com/blog/2010/08/nappupdate-application-auto-update-framework-for-dotnet/)

代码位于[http://github.com/synhershko/NAppUpdate](http://github.com/synhershko/NAppUpdate)（在 Apache 2.0 许可下获得许可）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T12:57:51.123

我有一个单独的“启动器”应用程序，它通过 Web 服务检查更新。如果有更新，它会下载它们，然后执行我的应用程序，该应用程序位于单独的程序集中。

正如其他人所提到的，其他替代方法是使用 ClickOnce 之类的东西，或者将文件下载到单独的区域并重新启动应用程序。

不过，请注意 ClickOnce - 它不像听起来那么灵活。如果您部署到需要将程序提升到更高安全级别才能运行的系统，如果您没有安装应用程序的证书，您可能会遇到问题。当谈到 ClickOnce 时，我发现很难在 Internet 上获得证书管理等问题的直接答案。如果您有一个复杂的应用程序，您可能只想推出自己的更新程序，这就是我最终不得不做的事情。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T12:55:00.523

如果您通过 ClickOnce 发布，所有这些往往都会为您处理。它有自己的优点和缺点，但通常比尝试自己编写代码更容易。

[Wikipedia](http://en.wikipedia.org/wiki/ClickOnce)和15seconds都提供了有关使用 ClickOnce、其工作原理等方面的不错信息[。](http://www.15seconds.com/issue/041229.htm)

正如其他人所说，ClickOnce 不像滚动您自己的解决方案那样灵活，但它没有那么复杂。一开始它有一个小的学习曲线，但是几乎所有东西都捆绑到 Visual Studio 和向导的使用中，通常很快就会发现一个有效的解决方案。

随着部署变得越来越复杂（即不仅仅是有需要更新的先决条件或应用程序代码）并且您需要执行大量安装后或安装前任务，WiX 之类的东西可以为您提供某种混合解决方案Windows Installer 和 ClickOnce，灵活性的成本是一个更陡峭的学习曲线。

我试图避免使用自定义安装程序的唯一原因是，您最终会花费太多时间试图让它*恰到好处*地处理一堆不同的“假设”场景......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-05-21T14:34:31.590

现在，如果您的应用程序打包在 MSIX 包中，Windows 可以使用 AppInstaller 自动为您执行此类更新。

它将应用程序的新版本下载到另一个文件夹中`ProgramFiles\WindowsApps`，然后当用户通过开始菜单运行应用程序时，系统知道它应该使用哪个文件夹。以前的版本在不使用时会被删除。

如果您想知道如何以这种方式打包您的应用程序，我在[此答案](https://stackoverflow.com/a/67636323/3087417)中收集了我的发现。

# java - 获取明天 xx:xx 的时间

> ID：139288
> 
> 赞同：5
> 
> 时间：2008-09-26T12:53:08.937
> 
> 标签：java, date

在Java中获得第二天特定时间的有效方法是什么？假设我想要明天 03:30:00 的长。设置日历字段和日期格式是显而易见的。更好或更聪明的想法，感谢分享！

大神

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T13:01:20.773

我采取蛮力方法

```
// make it now
Calendar dateCal = Calendar.getInstance();
// make it tomorrow
dateCal.add(Calendar.DAY_OF_YEAR, 1);
// Now set it to the time you want
dateCal.set(Calendar.HOUR_OF_DAY, hours);
dateCal.set(Calendar.MINUTE, minutes);
dateCal.set(Calendar.SECOND, seconds);
dateCal.set(Calendar.MILLISECOND, 0);
return dateCal.getTime(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T12:56:29.630

我很想听听其他人对此有什么看法。我自己的经验是，用 s 走捷径（即“更好或更聪明的想法”）`Date`几乎总是会让你陷入困境。哎呀，只是使用`java.util.Date`是自找麻烦。

补充：许多人在其他与日期相关的线程中推荐了[Joda Time 。](http://joda-time.sourceforge.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T12:57:07.960

我会考虑使用预定义的 api 来做这件事的聪明方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T13:00:22.880

不知道为什么不只使用 Calendar 对象？它简单且可维护。我同意不使用 Date，几乎所有有用的东西现在都已弃用。:(

# svn - 我可以在提交颠覆时运行脚本吗？

> ID：139315
> 
> 赞同：16
> 
> 时间：2008-09-26T12:56:09.367
> 
> 标签：svn, hook, phpdoc

我想运行一个为我的 php 项目构建文档的脚本。它基本上只是使用 wget 来运行 phpdoc。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T12:57:15.963

[这是关于SVN 钩子](http://wordaligned.org/articles/a-subversion-pre-commit-hook)的相当广泛的教程

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T12:58:04.867

（回答我自己的问题，我只是认为其他人也想知道）。是的，而且 TortoiseSVN 也支持它。您正在寻找的词是“钩子”。

对于 TortoiseSVN，打开设置和“Hook Scripts”。单击“添加...”并选择 post_commit_hook（用于在提交完成后运行）。然后添加您正在运行的任何脚本和脚本的工作路径。

我使用了一个批处理文件并称为 wget（有一个 Windows 版本移植，谷歌它）。要让 wget 将来自 phpdoc 的日志存储在一个特定路径中，您必须指定完整路径，否则日志将存储在您提交的当前文件夹中，因此我的批处理文件如下所示：

```
SET BUILDLOG=%~dp0%build_log.html
rem %~dp0 returns the full working path *of this script*
SET PHPDOCURL=http://localhost/PHPDocumentor/docbuilder
SET PHPDOCCONFIG=yourconfigfile

wget -O %BUILDLOG% "%PHPDOCURL%/builder.php?setting_useconfig=%PHPDOCCONFIG%&setting_output=HTML%3ASmarty%3Adefault&ConverterSetting=HTML%3ASmarty%3Adefault&setting_title=Generated+Documentation&setting_defaultpackagename=default&setting_defaultcategoryname=default&interface=web&dataform=true" 
```

现在，无论何时提交，都会调用批处理脚本。当然，您也可以将 php 用作命令行工具，但我没有使用 phpdoc 对此进行研究——我只是选择了阻力最小的路径。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T13:06:54.363

使用 SVN 挂钩的替代方法是使用持续集成引擎。就个人而言，我是[哈德逊](http://hudson-ci.org/)的粉丝。[CruiseControl](http://cruisecontrol.sourceforge.net/)是经典的，但还有很多[其他](http://en.wikipedia.org/wiki/Continuous_Integration#Software)的。

为什么要使用持续集成引擎？一般来说，它们比简单地使用 SVN 钩子更强大、功能丰富和可移植（如果你想切换到使用 Mercurial、Git 等怎么办？）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T12:58:27.473

您可能想查看[Phing](http://phing.info/trac/)以获得完整的构建脚本工具。您可以在一处管理提交、文档和其他与构建相关的活动。

# c++ - 在 std::map 中设置所有值

> ID：139325
> 
> 赞同：8
> 
> 时间：2008-09-26T12:57:40.033
> 
> 标签：c++, stl

如何在`std::map`不使用循环遍历每个值的情况下将 a 中的所有值设置为相同的值？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-26T13:06:21.853

使用循环*是*迄今为止最简单的方法。事实上，它是单行的：^([C++17])

```
for (auto& [_, v] : mymap) v = value; 
```

不幸的是，对关联容器的 C++ 算法支持在 C++20 之前并不是很好。因此，我们不能直接使用`std::fill`.

无论如何要使用它们（C++20 之前），我们需要编写适配器——在 的情况下`std::fill`，是一个迭代器适配器。这是一个最小可行（但不是真正符合）的实现来说明这是多少努力。我*不*建议按原样使用它。使用库（例如[Boost.Iterator](https://www.boost.org/doc/libs/1_74_0/libs/iterator/doc/function_output_iterator.html)）进行更通用的生产强度实现。

```
template <typename M>
struct value_iter : std::iterator<std::bidirectional_iterator_tag, typename M::mapped_type> {
    using base_type = std::iterator<std::bidirectional_iterator_tag, typename M::mapped_type>;
    using underlying = typename M::iterator;
    using typename base_type::value_type;
    using typename base_type::reference;

    value_iter(underlying i) : i(i) {}

    value_iter& operator++() {
        ++i;
        return *this;
    }

    value_iter operator++(int) {
        auto copy = *this;
        i++;
        return copy;
    }

    reference operator*() { return i->second; }

    bool operator ==(value_iter other) const { return i == other.i; }
    bool operator !=(value_iter other) const { return i != other.i; }

private:
    underlying i;
};

template <typename M>
auto value_begin(M& map) { return value_iter<M>(map.begin()); }

template <typename M>
auto value_end(M& map) { return value_iter<M>(map.end()); } 
```

有了这个，我们可以使用`std::fill`：

```
std::fill(value_begin(mymap), value_end(mymap), value); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-06-22T05:54:02.747

我遇到了同样的问题，但发现 boost::adaptors::values 返回的范围是可变的，因此它可以与 std::fill 等普通算法一起使用。

```
#include <boost/range/adaptor/map.hpp>
auto my_values = boost::adaptors::values(my_map);
std::fill(my_values.begin(), my_values.end(), 123); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T13:42:04.590

boost::assign 库有各种简洁的东西来帮助初始化容器的内容。我认为这可以用来避免显式地遍历地图。不幸的是，地图是难以初始化的奇怪野兽，因为键必须是唯一的。底线是简单的 for 循环可能是初始化地图的最佳方式。它可能不是超级优雅，但它完成了工作，并且任何熟悉 STL 的人都可以立即理解。

```
map <int,string> myMap;
for( int k=0;k<1000;k++)
  myMap.insert(pair<int,string>(k,string(""))); 
```

这篇文章的其余部分描述了我为达到上述结论所经历的旅程。

boost::assign 使将少量值分配给映射变得简单。

```
map<string,int> m; 
insert( m )( "Bar", 1 )( "Foo", 2 ); 
```

或者

```
 map<int,int> next = map_list_of(1,2)(2,3)(3,4)(4,5)(5,6); 
```

在您的情况下，您想用相同的值初始化整个地图，有实用程序repeat 和repeat_fun。
像这样的东西应该适用于多图（未经测试的代码片段）

```
pair<int,string> init( 0,string(""));
multimap <int,string> myMap = repeat(1000,init); 
```

正如 Konrad Rudolph 所指出的，您不能使用相同的确切值初始化地图，因为键必须是唯一的。

这使生活变得更加复杂（有趣吗？）。像这样的东西，也许：

```
map <int,string> myMap;

struct nextkey
{
   int start;
   nextkey( s ) : start( s ) {}
   pair<int,string> operator () ()
{
   return pair<int,string>(start++,string(""));
}
};

myMap = repeat_fun(1000,nextkey(0)); 
```

现在，这变得如此复杂，我现在认为一个简单的迭代是要走的路

```
map <int,string> myMap;
for( int k=0;k<1000;k++)
  myMap.insert(pair<int,string>(k,string(""))); 
```

# sql-server - 我可以在 VS2008 中使用 SQL 2005 创建 BIDS 项目吗？

> ID：139342
> 
> 赞同：0
> 
> 时间：2008-09-26T12:59:50.167
> 
> 标签：sql-server, visual-studio, bids

从我可以在网上找到的关于使用 VS2008 创建集成/报告服务项目的信息来看，我似乎需要 SQL 2008。有谁知道允许我将 VS2008 与 SQL 2005 一起使用的解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T13:05:36.333

安装 SQL Server 2005 客户端/工作站工具应安装 BIDS 2005。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T13:22:50.237

您的 SQL2008 许可证应该允许您降级和使用 BIDS2005。我在同一台机器上同时安装了 VS2005 和 VS2008。

# inno-setup - Inno Setup：在向导页面中捕获控制事件

> ID：139358
> 
> 赞同：2
> 
> 时间：2008-09-26T13:02:58.927
> 
> 标签：inno-setup

在用户定义的向导页面中，有没有办法捕获控件的更改或焦点事件？我想在某些下拉菜单（例如消息框）中提供有关用户输入的即时反馈

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T13:44:34.387

我花了一些时间来解决它，但在Otherside指出正确的方向之后，我终于明白了（适用于5.2版）：

```
[Code]

var 
    MyCustomPage : TWizardPage;

procedure MyEditField_OnChange(Sender: TObject);
begin
    MsgBox('TEST',  mbError, MB_OK);
end;

function MyCustomPage_Create(PreviousPageId: Integer): Integer;
var 
    MyEditField: TEdit;
begin
    MyCustomPage := CreateCustomPage(PreviousPageId, 'Caption', 'Description');
    MyEditField  := TEdit.Create(MyCustomPage);
    MyEditField.OnChange := @MyEditField_OnChange;
end; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T13:10:25.900

由于 innosetup 中的脚本大致基于 Delphi，因此控件应该具有一些事件，例如`OnEnter`(= control got focus) 和`OnExit`(= control lost focus)。您可以将过程分配给这些事件，如下所示： ComboBox.OnExit := ComboBoxExit;

```
procedure ComboBoxExit(Sender: TObject);
begin

end; 
```

我现在无法访问 Innosetup，因此您需要查找程序的可用事件和参数。

# unit-testing - 处理 TDD 接口更改

> ID：139365
> 
> 赞同：6
> 
> 时间：2008-09-26T13:03:37.147
> 
> 标签：unit-testing, tdd

我已经开始使用 TDD。如[前一个问题](https://stackoverflow.com/questions/64333/what-is-the-downside-to-test-driven-development#64402)所述，最大的困难是处理界面更改。随着需求的变化，您如何减少对测试用例的影响？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T14:30:15.583

更改接口需要更新使用该接口的代码。在这方面，测试代码与非测试代码没有任何不同。不可避免的是，该接口的测试需要更改。

通常，当接口更改时，您会发现“太多”测试中断，即对大部分不相关功能的测试结果依赖于该接口。这可能表明您的测试过于广泛，需要重构。发生这种情况的方式有很多种，但这里有一个示例，希望能展示总体思路和特定案例。

例如，如果构造 Account 对象的方式发生了变化，这需要更新您的 Order 类的全部或大部分测试，那么就会出现问题。大多数 Order 单元测试可能并不关心帐户是如何创建的，因此重构测试如下：

```
def test_add_item_to_order(self):
    acct = Account('Joe', 'Bloggs')
    shipping_addr = Address('123 Elm St', 'etc' 'etc')
    order = Order(acct, shipping_addr)
    item = OrderItem('Purple Widget')
    order.addItem(item)
    self.assertEquals([item], order.items) 
```

对此：

```
def make_order(self):
    acct = Account('Joe', 'Bloggs')
    shipping_addr = Address('123 Elm St', 'etc' 'etc')
    return Order(acct, shipping_addr)

def make_order_item(self):
    return OrderItem('Purple Widget')

def test_add_item_to_order(self):
    order = self.make_order()
    item = self.make_order_item()
    order.addItem(item)
    self.assertEquals([item], order.items) 
```

这个特定的模式是一个[Creation Method](http://xunitpatterns.com/Creation%20Method.html)。

这里的一个优点是您的 Order 测试方法与 Accounts 和 Addresses 的创建方式是隔离的；如果这些接口发生更改，您只有一个地方可以更改，而不是碰巧使用帐户和地址的每个测试。

简而言之：测试也是代码，并且像所有代码一样，有时它们需要重构。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T13:06:24.427

我*认为*这是接口使用过多的流行论点的原因之一。

然而，我不同意。

当需求改变时——你的测试也应该改变。对？我的意思是，如果您编写测试的标准不再有效，那么您应该重写或取消该测试。

我希望这会有所帮助，但我想我可能误解了你的问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T13:12:51.430

会有**影响**。您只需要接受更改接口将需要时间首先更改关联的测试用例。没有办法解决这个问题。

但是，您考虑到以后不再尝试在此界面中找到难以捉摸的错误并且在发布周不修复该错误来节省时间，这是完全值得的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-28T07:13:35.100

在 TDD 中，您的测试不是测试。它们是可执行的规范。IOW：它们是您要求的可执行编码。*永远*记住这一点。

现在，突然变得很明显：如果你的需求改变了，测试也*必须*改变！这就是 TDD 的全部意义所在！

如果你在做瀑布，你将不得不改变你的规范文档。在 TDD 中，您必须这样做，只是您的规范不是用 Word 编写的，而是用 xUnit 编写的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-02T11:45:10.180

“我们应该做些什么来防止我们的代码和测试依赖于需求？似乎没什么。每次当需求改变时，我们都必须改变我们的代码和测试。但也许我们可以简化我们的工作？是的，我们可以。关键原则是: 封装可能更改的代码。”

[http://dmitry-nikolaev.blogspot.com/2009/05/atch-your-changes.html](http://dmitry-nikolaev.blogspot.com/2009/05/atch-your-changes.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T13:06:23.053

在为新接口编写代码之前编写测试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T13:08:07.370

如果您遵循“测试优先”方法，理论上接口更改对您的测试代码应该没有影响。毕竟，当您需要更改接口时，您首先要更改测试用例以匹配需求，然后继续更改接口/实现，直到测试通过。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-28T08:52:15.690

当接口发生变化时，您应该期望测试会中断。如果太多的测试中断，这意味着你的系统耦合太紧，太多的东西依赖于那个接口。您应该期望一些测试会中断，但不会很多。

让测试中断是一件好事，代码中的任何更改都应该中断测试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-18T16:56:27.593

如果需求发生变化，那么您的测试应该是首先发生变化的事情，而不是接口。

我会首先在第一个适当的测试中修改界面设计，更新界面以通过新的测试。更新接口以通过测试后，您应该会看到其他测试中断（因为它们将使用过时的接口）。

这应该是用新的界面设计更新剩余的失败测试以使它们再次通过的问题。

以测试驱动的方式更新接口将确保更改实际上是必要的，并且是可测试的。

# java - Java中如何抛出MalformedURLException

> ID：139368
> 
> 赞同：2
> 
> 时间：2008-09-26T13:04:53.697
> 
> 标签：java, protocols, malformedurlexception

我的意思是，Java 如何决定哪些协议可用？我从 Eclipse 内部运行了一些代码，它工作得很好。然后我从 Eclipse 外部运行相同的代码，我得到“未知协议”MalformedURLException。可能它与代码库有关，还是什么？任何提示都会有所帮助。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T13:08:25.780

解析协议的工作由 完成，按协议以小写[`URLStreamHandler`](http://java.sun.com/javase/6/docs/api/java/net/URLStreamHandler.html)形式存储。`URL.handlers`反过来，处理程序由[`URLStreamHandlerFactory`](http://java.sun.com/javase/6/docs/api/java/net/URLStreamHandlerFactory.html)at创建`URL.factory`。也许日食在开玩笑？

一些[URL 构造函数](http://java.sun.com/javase/6/docs/api/java/net/URL.html#URL(java.lang.String,%20java.lang.String,%20int,%20java.lang.String,%20java.net.URLStreamHandler))采用流处理程序，您可以使用[URL.setURLStreamHandlerFactory](http://java.sun.com/javase/6/docs/api/java/net/URL.html#setURLStreamHandlerFactory(java.net.URLStreamHandlerFactory))设置工厂。

这是一篇关于[开发协议处理程序](http://www.webbasedprogramming.com/JAVA-Developers-Guide/ch29.htm)的网络帖子。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T21:18:32.747

这里描述了定义协议处理程序的 java 标准方法：http: [//java.sun.com/developer/onlineTraining/protocolhandlers/](http://java.sun.com/developer/onlineTraining/protocolhandlers/)

这依赖于启动（？）类加载器上可用的协议处理程序类。这不适用于 OSGi（以及 Eclipse）。OSGi 围绕此机制提供了一个包装器，以允许捆绑包/插件提供协议处理程序。见：[http ://www.osgi.org/javadoc/r4v41/org/osgi/service/url/URLStreamHandlerService.html](http://www.osgi.org/javadoc/r4v41/org/osgi/service/url/URLStreamHandlerService.html)

Eclipse 还提供了它自己的协议：bundle-resource (iirc)，它绝对不能在 Eclipse 之外工作。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-26T13:11:39.093

可能是类路径问题。如果您使用的协议依赖于您包含的某个库 (jar)，然后从 eclipse 中导出了一个 JAR，则您在项目中包含的 JAR 文件可能不会被 eclipse 之外的运行代码找到。您需要一个清单文件在您的 jar 中，该文件将指向所需的库。

# linux - #defines 在链接器脚本中

> ID：139373
> 
> 赞同：1
> 
> 时间：2008-09-26T13:06:12.367
> 
> 标签：linux, linker

对于嵌入式系统，我需要在固定地址放置一些数据结构，以便单独的控制 CPU 可以在已知位置访问它们。我正在使用嵌入式目标的链接器脚本来完成此操作，以及控制 CPU 的相同地址的#defines。

令我困扰的是，这些地址常量是在两个地方定义的，链接描述文件和头文件。我想只有一个。到目前为止，我想出的最佳解决方案是让 Makefile 在链接器脚本上运行 cpp，允许它#include 相同的标头。

有没有更好的方法来实现这一点？ld 是否有一些鲜为人知的选项或链接器脚本的命名约定，它将自动通过 cpp 运行它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T14:17:17.643

这不是您正在寻找的解决方案，但一种选择是利用构建系统来配置这些值。创建一个 config.h.in 和一个 target.ld.in 作为模板，并让构建系统为您正在构建的目标生成一个具有正确定义的 config.h 和一个具有正确地址的 target.ld。

我们将 CMake 用于我们的嵌入式系统，它支持这种事情。GNU autoconf 也可以，但我个人从来没有真正喜欢过它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-07T09:58:44.503

您可以使用 emdedded-C 特定构造 @ 将对象放置在地址空间中的任何位置。

```
static struct SOMESTRUCT somestruct @ 0x40000000;
extern int someextint @ 0x3ffffffc;
char somebuffer[77] @ 0x80000000; 
```

假设是 32 位 MCU。

# .net - 推荐一个开源 .NET 统计库

> ID：139384
> 
> 赞同：25
> 
> 时间：2008-09-26T13:06:54.020
> 
> 标签：.net, math, open-source, statistics

我需要计算一堆数值数据的平均值、标准差、中位数等。我可以使用一个好的开源 .NET 库吗？我找到了 NMath，但它不是免费的，可能对我的需求来说有点过分了。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-18T19:42:32.847

你必须要小心。如果浮点运算是完美的，有几种计算标准偏差的方法会给出相同的答案。对于某些数据集，它们都是准确的，但在某些情况下，有些比其他数据集要好得多。

我在这里看到的方法是最有可能给出错误答案的方法。我自己使用它，直到它撞到我身上。

请参阅[比较计算标准差的三种方法](http://www.johndcook.com/blog/2008/09/26/comparing-three-methods-of-computing-standard-deviation/)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-26T14:08:02.000

[http://ilnumerics.net/](http://ilnumerics.net/)或[http://numerics.mathdotnet.com/](http://numerics.mathdotnet.com/)怎么样（从[http://www.codeplex.com/dnAnalytics](http://www.codeplex.com/dnAnalytics)合并）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-26T13:41:30.350

我在 CodeProject 网站上找到了这个。它看起来像是一个很好的 C# 类，用于处理大多数基本统计函数。

*   [http://www.codeproject.com/KB/cs/csstatistics.aspx](http://www.codeproject.com/KB/cs/csstatistics.aspx)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-26T13:43:01.453

看看[MathNet](http://mathnet.opensourcedotnet.info/About.aspx) 它不是专门用于统计的，但可能有你想要的有用功能

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-05-20T01:15:17.243

[Apache Maths.Common](http://commons.apache.org/math/download_math.cgi) 并通过[IKVM](http://www.ikvm.net/userguide/ikvmc.html)运行它。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-02T09:19:05.607

我决定自己写会更快，这正是我需要的。这是代码...

```
/// <summary>
/// Very basic statistical analysis routines
/// </summary>
public class Statistics
{
    List<double> numbers;
    public double Sum { get; private set; }
    public double Min { get; private set; }
    public double Max { get; private set; }
    double sumOfSquares;

    public Statistics()
    {
        numbers = new List<double>();
    }

    public int Count
    {
        get { return numbers.Count; }
    }

    public void Add(double number)
    {
        if(Count == 0)
        {
            Min = Max = number;
        }
        numbers.Add(number);
        Sum += number;
        sumOfSquares += number * number;
        Min = Math.Min(Min,number);
        Max = Math.Max(Max,number);            
    }

    public double Average
    {
        get { return Sum / Count; }
    }

    public double StandardDeviation
    {
        get { return Math.Sqrt(sumOfSquares / Count - (Average * Average)); }
    }

    /// <summary>
    /// A simplistic implementation of Median
    /// Returns the middle number if there is an odd number of elements (correct)
    /// Returns the number after the midpoint if there is an even number of elements
    /// Sorts the list on every call, so should be optimised for performance if planning
    /// to call lots of times
    /// </summary>
    public double Median
    {
        get
        {
            if (numbers.Count == 0)
                throw new InvalidOperationException("Can't calculate the median with no data");
            numbers.Sort();
            int middleIndex = (Count) / 2;
            return numbers[middleIndex];
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-01T19:07:21.803

[AForge.NET](http://www.aforgenet.com)有 AForge.Math 命名空间，提供一些基本的统计函数：Histogram、mean、median、stddev、entropy。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-02-23T02:36:08.347

如果您只需要一次性处理数字，那么电子表格无疑是您最好的工具。从 C# 中吐出一个简单的 CSV 文件很简单，然后您可以将其加载到 Excel（或其他）中：

```
class Program
{
    static void Main(string[] args)
    {
        using (StreamWriter sw = new StreamWriter("output.csv", false, Encoding.ASCII))
        {
            WriteCsvLine(sw, new List<string>() { "Name", "Length", "LastWrite" });

            DirectoryInfo di = new DirectoryInfo(".");
            foreach (FileInfo fi in di.GetFiles("*.mp3", SearchOption.AllDirectories))
            {
                List<string> columns = new List<string>();
                columns.Add(fi.Name.Replace(",", "<comma>"));
                columns.Add(fi.Length.ToString());
                columns.Add(fi.LastWriteTime.Ticks.ToString());

                WriteCsvLine(sw, columns);
            }
        }
    }

    static void WriteCsvLine(StreamWriter sw, List<string> columns)
    {
        sw.WriteLine(string.Join(",", columns.ToArray()));
    }
} 
```

然后，您可以“启动 excel output.csv”并使用“=MEDIAN(B:B)”、“=AVERAGE(B:B)”、“=STDEV(B:B)”等函数。你会得到图表、直方图（如果你安装了分析包）等。

以上并不能解决所有问题；通用 CSV 文件比您想象的要复杂。但对于我所做的大部分分析来说，它已经“足够好”了。

# design-patterns - 最不喜欢的设计模式

> ID：139387
> 
> 赞同：6
> 
> 时间：2008-09-26T13:07:44.360
> 
> 标签：design-patterns

好的，我不是在寻找反模式——我在寻找不是真正模式的东西，或者可能是被滥用的模式。

我个人最不喜欢的是“Helper”模式。

例如，我需要创建一个 SQL 查询，所以调用 SQLQueryHelper。这需要处理一些字符串，所以它又调用了StringHelper。等等等等。

看 - 这根本不是一种设计模式......

[编辑] 投反对票的人不认为您应该添加建设性的评论吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-26T13:13:48.513

辛格尔顿。

它是一个伪装的全局变量，难以模拟/存根以进行单元测试。

服务定位器更好，依赖注入/控制反转更好。

[维基百科文章](http://en.wikipedia.org/wiki/Singleton_pattern)中的大部分参考资料都是关于为什么它是邪恶的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T13:25:02.807

“经理”课程。例如

```
DataManager
BusinessLogicManager
WidgetManager 
```

“经理”是什么意思？更加详细一些！如果您的 WidgetManager 有太多的 Widget 职责，以至于没有更具体的名称，那么将其分解。

这是我在查看旧代码时与自己进行过太多次的对话。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T13:26:01.633

我认为设计模式不应该被盲目使用，仅仅因为它很酷而实现它们：它们有一个明确指定的上下文，并且在适当的时候使用它们可能会有所帮助，但在任何其他情况下，它们只是浪费时间，而不是妨碍系统正常运行。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-07T00:04:57.630

我最不喜欢的是“将'Helper'或'Manager'放在类名的末尾”模式。

编辑：正如克里斯指出的那样，我已经证明我是一个蹩脚的程序员，忘记了“Util”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-23T09:59:59.450

**战略**

原因是我怀疑大多数人都被教导使用类和方法来实现它。

考虑以下 Haskell 代码：

```
ascending = sortBy compare somelist
descending = sortBy (flip compare) somelist
pairsBySecondComponent = sortBy (comparing snd) somelist 
```

这就是实际的策略模式：`compare`，`(flip compare)`并且`(comparing snd)`是这种情况下的具体策略（它们是普通的旧函数），函数签名`a -> a -> Ordering`是策略“接口”。

这段简短说明了设计模式不必如此沉重或庞大。你想用Java（接口、类）实现策略的方式*不是*一个好方法。这是一种围绕 Java 工作的方法，它为您需要做的工作提供了错误的抽象。这不应*被*视为正常或可接受的。

出于这个原因，假设我对它的教学方式的假设是正确的，我不太喜欢策略模式。

还有一些其他模式也是一般“函数指针”模式的特定实例。我也不太喜欢他们，原因也差不多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T13:45:10.887

MVP. It's MVC but broken.

Oh no but wait, developing an application IS completely different than following good practise such as "It's just a view".

**Update**

I reference "It's just a view" which is from the book Pragmatic Programmer. My main issue is that almost every single MVP implementation has the view holding onto the presenter and telling the presenter to do things. This is conceptually backwards. The UI should not have a dependancy on the logic. It is "just a view". The logic is the primary reason for the application, how that logic is displayed is a secondary concern. I could use one winform, or I could use many. Hell, I could pipe the whole thing out into ASCII text, or create the "view" by sending charges down a wire attached to an artist who renders the view via the medium of interperative dance.

Practically speaking this premise does have some viable uses. Some of the controllers I've written in the past have MANY views that are exernally exposed and can be pushed into the UI as the application sees fit. Consider a live feed of data. I could present this as stats, as lines graphs, as pie charts. Perhaps all at the same time! Then the view holding onto the controller looks kinda silly, the parent is the controller and the children are the views.

A traditional (Form holds presenter) MVP implementation has other consequences. One being that your UI now has a dependancy on code that performs the logic, this means it will also require references to everything that logic needs (services etc).

The way to fix this is to pass in an interface (again, most MVP implementation I see have the form creating the presenter, but hey). Then it becomes a workable model, although i've never been a fan of passing in args to a form constructor.

At the end of day it feels like people are twisting things around attempting to justify a model that is broken. I am of the personal belief that the MVP pattern purely exists as an attempt to rationalise how Visual Studio Windows Forms Applications work. They start with a "Form First" mentality.

"Oh hai, here is your form, now go and draggy drop your controls and stuff logic into the UI"

Anyone with experience with any apps that are beyond a util appreciate that this way of working does not scale. I see MVP as a way of making this scale but this just feels like an architectural band aid around the broken "form first" development model the IDE promotes.

I argue that MVC is just MVC, MVP is a bastardisation of the pattern. Infact the whole definition of MVC is kinda backwards. The important part of it is separation of concerns. The UI, the logic, the data and/or services you're consuming. Keep these seperate. You don't implement MVC to do this, *you do this and by doing so you end up with a form of MVC*. MVP doesn't fit into this because you don't end up with MVP if you start by thinking of Separation of Concerns you end up with MVP if you're stuck in "Form First" land and you feel you should be doing things a bit more MVCish.

That's my take on it anyway....

# java - 我应该在 Java 中使用 Qt Jambi 吗？

> ID：139389
> 
> 赞同：13
> 
> 时间：2008-09-26T13:08:01.083
> 
> 标签：java, user-interface, qt, qt-jambi

在 Java 中使用 Qt Jambi 作为工具包对我来说是个好主意吗？

我看到 Qt Jambi 很难学，Swing 比 Qt Jambi 容易，但我认为 Qt Jambi 更强大。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-18T07:57:09.017

两年前，我启动了一个 Java 桌面应用程序，并使用 Swing 作为 GUI 框架。到目前为止，我已经使用过 C++/MFC ( *shudder* ) 和 C++/Qt ( *very nice* )。

在尝试与 Swing 相处一段时间后（包括阅读大量教程甚至一本书），我得出以下结论：

**Swing 比 Qt 更加困难和笨拙，原因有以下三个：**

1.  许多简单的东西需要比它应该的更多的代码。
2.  Qt 免费带来的一些东西几乎不可能在合理的时间内实现。
3.  Swing 没有提供所见即所得的 GUI 编辑器，而且我找不到与 Qt 设计器接近的免费编辑器。

然后我扔掉了 Swing GUI，改用 Qt Jambi，对它印象深刻。一个周末后，我有了一个不错的 Qt GUI，从此过上了幸福的生活。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T13:23:19.673

如果您认为熟悉 Qt 对将来有用，当您可能想用 C++ 进行开发（或更改一些基于 Qt 的软件）时，我认为它会很好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-07T02:22:36.097

Qt Jambi 比 Swing 和 SWT 更简单易用。

我认为 Qt Jambi 的唯一默认设置是没有太多关于此的文档，并且回答有关 Qt Jambi 问题的论坛很少见（这是我发现的唯一一个：D）

希望这可以帮助。

# search-engine - 维基排名搜索

> ID：139394
> 
> 赞同：0
> 
> 时间：2008-09-26T13:08:29.897
> 
> 标签：search-engine

我在搜索中提出了一个新概念，我将 lt 称为 WikiRank，在此，将在 firefox 浏览器上安装一个扩展。此扩展程序将查看用户活动，他将发送访问 url 及其访问时间，用户也可以对材料进行排名。所以简而言之，。用户界面不会有任何变化，用户将使用他的搜索任何引擎，但我们将收集所有搜索过的网站。所以，很快我就会得到数据，比如世界在一个特定的想法和综合用户排名上花费了多少小时。该数据库将有助于获得更好的搜索结果。我怎样才能制作这个网站？这个想法是好的还是独特的？如何防止机器人或 AI 代理给出虚假排名？可能是所有链接提交结束时的一个验证码？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T13:22:18.867

看来您正在重新发明轮子……再次。您是否检查过任何[现有技术](http://en.wikipedia.org/wiki/Alexa_Internet)（有更明显的）您打算做什么？从您的描述来看，这对我来说根本不是一个“新”概念。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T13:28:24.500

主要是我想收集每个用户 url 的页面访问时间。用户还可以发送关于页面内容的可选排名（1-10）。

# .net - 什么是最好的解决方案？使用 WF StateMachine 跟踪 Web 应用程序上的用户状态

> ID：139406
> 
> 赞同：1
> 
> 时间：2008-09-26T13:10:33.713
> 
> 标签：.net, asp.net, workflow-foundation, state-machine

我正在查看 WF 并想知道是否最好使用 StateMachine 工作流程来跟踪用户状态。即用户是匿名的，用户是已知的但未经过身份验证的，用户是已知的并经过身份验证的。

这是解决这个常规问题的好方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T13:45:39.823

不，我认为这完全不合适。请参阅这些问题以获取更多信息：

*   [您对 Windows Workflow Foundation 有何体验？](https://stackoverflow.com/questions/115124/what-are-your-experiences-with-windows-workflow-foundation)
*   [何时使用 Windows Workflow Foundation？](https://stackoverflow.com/questions/104099/when-to-use-windows-workflow-foundation)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T13:21:04.843

以我的经验，WF 对于任何此类用途来说都太重了——用它做简单的事情太难了。在这种情况下它是没有用的。

不过，我当然会对相反的体验感兴趣 - 有没有人在一个简单的项目中成功地小规模地使用过 WF？工作流和状态机是任何逻辑业务域的组成部分，但我从未见过 WF 或任何其他框架的直接实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-27T00:02:50.810

您可能对我关于无状态的[SO](https://stackoverflow.com/questions/1301856/are-windows-workflow-foundation-statemachines-suitable-for-high-performance-scena/2143566#2143566)回答感兴趣，这是一种轻量级的 .Net 状态机。我已经使用它而不是 WF，并在 Web 环境中实现了它。

# http - 发送到网站的日志发布参数

> ID：139409
> 
> 赞同：1
> 
> 时间：2008-09-26T13:10:49.283
> 
> 标签：http, utilities

出于好奇，我一直对某些东西感兴趣，是否有工具或实用程序可以让我记录发送到网站的帖子参数？不是个人网站，网络上的任何网站。

这样做的原因是，我希望能够开发 .NET 应用程序，而不必增加创建 WebBrowser 对象然后使用 DOM 自动执行网站上的任务的开销。

我还想用它来测试我的本地主机开发服务器的安全性，因为我没有 VS Team System。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T13:19:31.213

查看 Fiddler ( [http://www.fiddler2.com/fiddler2/](http://www.fiddler2.com/fiddler2/) ) - 这是一个非常好的调试代理，它允许深入检查和修改浏览器和网站之间的流量。

# project-management - 比单页大的甘特图有用吗？

> ID：139411
> 
> 赞同：1
> 
> 时间：2008-09-26T13:10:56.710
> 
> 标签：project-management, gantt-chart

我参与过一些使用甘特图管理的项目。其中一些有大量的任务，项目经理把所有的时间都花在与 MS Project 搏斗上，而不是做出好的选择。

如果有多个独立的团队致力于某件事（例如法律、IT、营销）来管理一个项目，我可以理解这一点。

有没有人参与过成功使用甘特图的软件开发项目？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T13:17:56.897

使用 MS Project 对软件开发项目进行微观管理是人们可以做的最愚蠢的事情之一，尤其是在敏捷环境中。太多的事情花费了你预测的 1/10 或 10 倍的时间，太多的事情超出了预期，太多的项目计划会议占用了有用的工作时间。

此外，甘特图的奴隶是很常见的事情，尤其是对于来自不同学科的项目经理。

但是，它们对于确保在特定期限内完成操作（设置 XYZ 帐户、获得合规性以检查网站上的措辞等）很有用。编程任务的粗粒度截止日期也很好。

在我看来，我确信有些人从微观管理编程团队中取得了成功。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T13:18:59.000

我们在项目规划中总是使用甘特图。它们总是有用的——在一切都说完之后，甘特图是可视化项目的最佳工具之一。

然而，它是一种工具。如果工具使用得当，它是有效的。如果不是，它可能会适得其反。

您需要知道如何正确规划您的项目。您需要了解任务列表中应包含哪些内容以及如何包含在内。例如，对于一个 IT 项目，它几乎总是无用的，深入到单个分配的级别*（使用数据创建一个存储表*）。将其保留在故事级别（*允许用户登录*），将整个团队分配给它，计划将变得更加容易。

稍后，您可以随时进入单个任务级别，并且可以创建单独的项目计划来处理单独任务的分配。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T13:16:39.487

是的，我已经看到它成功了。在成功的情况下，他们使用了分层方法。

与其拥有一个包含数百个任务的大型甘特图，不如为整个项目提供一个带有顶级目标的主图。然后有单独的图表来完成子目标。尽管这以一种方式限制了灵活性（您不能自动平衡子目标团队之间的资源），但它似乎更适合人类运作良好的方式：在中小型团队中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-09-12T06:06:56.490

我不是专业的项目经理，但我为复杂的程序分析工具运行开发项目。

我在 70 年代后期绘制了页面大小的甘特图。他们从来没有足够的细节，所以我放弃了。有 5 个任务的甘特图是没用的。

从 90 年代开始，我在大约 10 个实际项目中使用了 MS 项目，这些项目的长度为 6 到 12 个月，任务大约为 1 周，并且将 50 到 250 个任务组织成与软件架构元素相关的层次结构，团队为 5 -10 人。此类计划打印为 3 x 5 整页的网格，我们倾向于将其粘贴在可以看到的墙上。

这些对于计划目的非常有用，因为它们迫使您详细说明项目的主要活动，写下描述，排序和优先级。团队可以查看任务，查看哪些是他们的，您可以与团队成员一起查看，以便每个人都可以提供有关持续时间和任务顺序的有用反馈。

他们没有用的是认真跟踪项目进度。孙子告诉我们，没有任何计划能在战场上完好无损，甘特图也不例外。确实，只要小心，人们可以每隔几周仔细修改计划并标记所取得的进展。“真正的项目经理”可能已经这样做了。我们非常小心，以至于最初的计划任务在大约一半的项目中得到了很好的支持，到那时人们已经很好地理解了这个问题，并且进行了额外的重新计划，但非正式地而不是 MS 项目。

我还使用 MS Project 计划了许多类似的任务，以用于严重的时间和估计目的。这具有产生现实估计的不幸副作用，其中大部分成本是可见的。令人惊讶的是，现实的估计如何扼杀了项目提案。行业似乎希望严重低估启动项目；难怪这么多超支时间和预算。

我对 MS 项目本身又爱又恨。它需要任务描述、任务优先级和资源分配。但我不能说，“我*更喜欢*这个任务比那个任务先完成”，这会作为一个可选的任务优先级来询问，我不能将资源部分分配给一个任务，部分分配给另一个任务，并获得任何合理的时间表。

But for complex project estimation, I don't see how you can live without this. The agile people will tell you you can't plan; I don't know who they have as customers. I've never found a customer that was willing to let me work without a plan or a dollar/time budget he would hold me to.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T13:16:15.247

比单页还小的甘特图有用吗？这些小信息可以很容易地放在白板或便利贴或任何你一直在看的东西上。当您可以在一分钟内用铅笔在您拥有的任何纸张上指定必要的信息时，您没有任何理由开始使用任何 GANNT 工具。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-28T04:43:39.970

我参与过一个项目，其中使用甘特图/MS 项目文件成功管理该项目。项目信息由非开发人员经理维护，他单独与团队会面以获取状态更新。该系统似乎运行良好，甘特图为整个团队提供了快速查看状态。在与我的一位在使用这种方法的公司工作的朋友交谈时，这似乎对他们的团队非常有效。

在我参与过的其他项目中，开发负责人预计会维护图表，但没有成功。领导通常会花费额外的时间与 MS Project 搏斗。如果文化专注于惩罚进度延误而不是解决问题，那么甘特图可以很容易地被操纵以显示项目在交付日期之前按计划进行。在这些情况下，甘特图变成了一项额外的工作，对项目没有任何价值。

我认为关键是要让开发团队之外的人来更新 MS Project 文件。甘特图应该被视为一种工具，用于就项目状态、可能的进度延误问题和资源需求计划进行沟通。有了这些项目，甘特图会很有帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T13:20:42.567

我发现甘特图对于规划项目的时间线并允许 X 天的假期、延误等非常有用。它们也非常适合确保在整个项目中 100% 分配所有资源。

在实际工作时，作为开发人员和团队负责人，我发现最好在短迭代中工作，并为整个团队定义明确的任务。当事情滑落、变化或从项目中添加/删除人员时，能够调整甘特图并查看项目更改的结果非常好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T13:26:13.223

我参与了几个使用甘特图的项目。是的，它们很有用，是的，它们比一页还大。我们所做的是将图表剪切并粘贴（字面意思是用剪刀和胶水）成一张大图表，然后贴在墙上。

McConnell 在他出色的*软件项目生存指南*中建议让团队的每个成员都可以查看一些东西，以粗略了解他们是否走上正轨，这就是为我们准备的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T13:46:38.403

我完全同意关于甘特图不适合敏捷开发的评论——我们一开始对实施的细节没有清晰的了解。

另一方面，我不禁深情地记得一个痛苦的周末，我为我正在管理的一个项目整理了一张甘特图，该项目的技术和要求都非常了解，而且时间表很关键。

我们的隔间部分的入口墙部分覆盖了这张甘特图（5 A4 页宽），并且它对于确保我们正在朝着关键路径工作非常有用 - 完成需要立即完成的事情- 并且还使我能够向项目委员会报告项目如何按计划进展的详细报告。

甘特图的用处绝对取决于上下文，但我想说，如果您知道自己的要求，特别是如果您非常重视您的日程安排，它们可能会非常有用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-06T12:19:38.887

我不是甘特图的忠实粉丝，尤其是在 MS Project 中创建的甘特图 - 如此少的信息占用了如此多的页面空间，并且最多（像大多数图表一样）信息被扭曲或隐藏。如果甘特图帮助团队审查需要什么，谁被分配到什么任务，哪些任务正在下滑，风险在哪里 - 那么它很有用 - 然而 - 大多数甘特图是在项目开始时开发的，然后从未见过或再次使用。那么，回到最初的问题——尺寸重要吗？？？？引用最近的一本书 -*如果它很愚蠢并且有效，那么它并不愚蠢*

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T13:15:16.853

甘特图只有在项目经理有足够的详细信息来查看项目的状态以及正确考虑依赖关系和资源时才有用。

你总是可以用胶带把几张纸粘在一起。

分析项目的纪律——将项目分解为阶段、步骤、可交付成果、确定资源需求可能比打印出漂亮的图表更重要。

我的许多重要的开发项目都受益于项目规划工具的合理使用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T13:46:38.417

> 是的，我已经看到它成功了。在成功的情况下，他们使用了分层方法。
> 
> ...

绝对地。我还建议当层次结构也映射到团队层次结构时效果最好，例如项目经理创建高级图表，团队负责人管理中级图表，开发人员可能管理他们自己的甘特图，但更有可能使用 JIRA 之类的东西，因为从开发人员的角度来看，这提供了一个单一的焦点，并且通常更容易接受（即它看起来不像一个计划，所以不会吓到他们；））

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T14:30:09.017

MSProject 中甘特图的最佳用途是在项目的初期阶段进行容量规划。您可以进行广泛的刷机计划和假设，移动东西，移动人员，添加各种里程碑等。这可以让您确信自己正在制定合理的计划。

但是，如前所述，在日常跟踪人们实际必须做的无数小任务时使用它是自找麻烦。我曾经在这个微观层面管理时间尺度方面发挥了巨大作用的是[Fogbugz 的](http://www.fogcreek.com/FogBugz/)EBS 东西。你必须努力工作，但它确实有助于处理事情。

重复总结 - 甘特图非常适合开发软件计划，但不适用于日常详细更新。

至于页面问题，我做过的大多数效果最好的计划（即以可以理解的详细程度将计划传达给人们）可以制作成适合 A3 打印输出。偶尔几张A3纸。但根据我的经验，A4 在大多数情况下都太小了。

# php - PHP 遵循哪种编码约定？

> ID：139427
> 
> 赞同：29
> 
> 时间：2008-09-26T13:13:23.007
> 
> 标签：php, coding-style

我应该坚持 Sun 的 PHP 代码 Java 代码约定吗？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2012-09-09T04:58:49.737

您应该遵循[Framework Interop Group批准的 PHP 的 PSR 标准之一](http://www.php-fig.org/)

*   [PSR-0](https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md) - 旨在提供标准文件、类和命名空间约定。
*   [PSR-1](https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-1-basic-coding-standard.md) - 旨在确保共享 PHP 代码之间的高水平技术互操作性。
*   [PSR-2](https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md) - 为希望标准化其代码的项目提供编码风格指南。
*   [PSR-3](https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-3-logger-interface.md) - 描述日志库的通用接口；公开了`LoggerInterface`八种将日志写入八个 RFC 5424 级别的方法。
*   [PSR-4](https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader.md) - Describes a specification for autoloading classes from file paths. It is fully interoperable, and can be used in addition to any other autoloading specification, including PSR-0.

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-09-26T13:18:31.777

对于 PHP，我建议遵循[Zends 的建议](http://framework.zend.com/manual/1.12/en/manual.html)

您可能知道，[Zend 是使用最广泛的框架！](https://stackoverflow.com/questions/2648/what-php-framework-would-you-choose-for-a-new-application-and-why)

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2010-07-28T06:59:03.737

**更新：**现在人们也经常使用[PSR](https://github.com/php-fig/fig-standards)

* * *

Zend Framework 和 PEAR 标准几乎是最常见的编码约定。如果您的公司采用了另一种，请遵守您公司的惯例。总比没有约定好。只有每个人都遵守它们，它们才会起作用。

另见：

*   [PHP 遵循哪种编码约定？](https://stackoverflow.com/questions/139427/which-coding-convention-to-follow-for-php)
*   [命名约定的 PHP 最佳实践](https://stackoverflow.com/questions/332831/php-best-practices-for-naming-conventions)
*   [PHP编码约定？](https://stackoverflow.com/questions/1863790/php-coding-conventions)

基本上，所有主要框架的文档中都有一个编码约定。官方（但大多数不为人知的 IMO）PHP 编码指南可在以下位置找到

*   [http://news.php.net/php.standards/2](http://news.php.net/php.standards/2)

如果您需要根据编码约定验证代码，请考虑使用[CodeSniffer](http://pear.php.net/package/PHP_CodeSniffer/redirected)。一些 IDE 还通过模板提供自动源代码格式化。例如，Zend Studio 内置了 ZF 编码指南，因此只需单击一下即可将代码格式化为该约定。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-26T14:07:26.667

您有多种选择：

Zend： http: [//framework.zend.com/manual/en/coding-standard.html](http://framework.zend.com/manual/en/coding-standard.html)

梨： http: [//pear.php.net/manual/en/standards.php](http://pear.php.net/manual/en/standards.php)

WordPress：[http ://codex.wordpress.org/WordPress_Coding_Standards](http://codex.wordpress.org/WordPress_Coding_Standards)

但就像 prakash 建议的那样，Zend 是一个不错的选择。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T13:24:15.880

如果您从事业务，请遵循业务代码约定。

如果是针对个人项目，您可以获得特定的语言规范（如果您使用 Java 而不是 Java，如果您使用 Php 而不是 PHP）。如果这是你的个人项目，如果你愿意，你可以改变一些事情......

如果你做开源项目，你应该去看看已经存在的东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-07-28T07:07:39.203

正如 Gordon 所说，[Zend](http://framework.zend.com/manual/en/coding-standard.html)和 PEAR 标准是有效的行业标准。

但是，公司的代码很可能早于这些代码，因此根据代码库的大小，投入时间来迁移到其中一个可能没有什么价值。（也就是说，如果他们想使用静态代码分析工具，您可能会以此为动力认真考虑迁移到 Zend 等。）

然而，现实一点，只要他们有一个他们坚持的合理标准，这里就没有真正的问题 - 你会发现自己相应地调整你“查看”代码的方式。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-07-28T07:11:03.683

任何编码风格都有优点和缺点。我花了很多时间处理来自许多来源的代码进行集成，所以有时最终会在一天内看到许多不同的样式（不同的命名约定、大括号放置、制表符与空格等）

就我而言 - 如果您使用现有代码，最重要的是遵循您正在编辑的代码的样式。如果你不这样做，你会让追随你的人变得更难。

如果您正在编写新代码，那么您应该可以自由地以最高效的方式进行编写。

我发现公司的编码指南通常很详细，并且在几年后最终被遗忘并且软件团队中的一些流失;-)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T13:29:50.283

那里有许多不同的编码约定。看看其他人使用什么（阅读一些示例代码，看看理解正在做什么是多么容易），然后选择。

重要的是选择一个并坚持下去。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-07-28T07:08:05.580

编码风格因组而异，并不是一种适合所有类型的东西。最重要的是有一个始终如一的标准，而且不会过火。太多的规则可能和不够一样糟糕。

我以前更喜欢 K&R 风格（第二种）。在不得不适应 Allman 风格（您的偏好）之后，我现在觉得它使代码更具可读性并改变了我的偏好。

这篇[维基百科文章](http://en.wikipedia.org/wiki/Programming_style)是一个不错的起点。它还包括指向 PEAR 编码标准等的链接。

# php - PHP是国际化的吗？

> ID：139466
> 
> 赞同：1
> 
> 时间：2008-09-26T13:21:25.827
> 
> 标签：php, localization

你能用PHP创建带有汉字的网站吗？

更新：也许我应该说 - 它是直截了当的。因为像 Java 这样的一些语言使它变得非常容易。也许 PHP 的本地化不如 Java 容易？？？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T13:22:40.003

是的。阅读[这篇](http://www.herongyang.com/PHP-Chinese/)关于用 PHP 构建中文网站的指南。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T13:26:57.730

是的，但你需要知道你在做什么......

阅读这篇[文章](http://www.phpwact.org/php/i18n/charsets)（搜索*PHP 的字符编码问题*）作为初学者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T13:23:23.123

当然。

[http://www.onlamp.com/pub/a/php/2002/11/28/php_i18n.html](http://www.onlamp.com/pub/a/php/2002/11/28/php_i18n.html)

# php - 如何将 var_dump 的结果捕获到字符串？

> ID：139474
> 
> 赞同：642
> 
> 时间：2008-09-26T13:23:02.140
> 
> 标签：php, string, var-dump

我想将输出捕获[`var_dump`](http://us3.php.net/manual/en/function.var-dump.php)到一个字符串。

PHP文档说；

> 与将结果直接输出到浏览器的任何东西一样，输出[控制函数](http://us3.php.net/manual/en/ref.outcontrol.php)可用于捕获此函数的输出，并将其保存在字符串中（例如）。

什么是如何工作的例子？

`print_r()`不是一个有效的可能性，因为它不会给我我需要的信息。

* * *

## 回答 #1

> 赞同：922
> 
> 时间：2008-09-26T13:38:11.650

# 尝试[`var_export`](http://php.net/var_export)

您可能想检查一下[`var_export`](http://php.net/var_export)——虽然它没有提供与`var_dump`提供第二个`$return`参数相同的输出，这将导致它返回其输出而不是打印它：

```
$debug = var_export($my_var, true); 
```

## 为什么？

我更喜欢这种单行方式而不是使用`ob_start`and `ob_get_clean()`。我还发现输出更容易阅读，因为它只是 PHP 代码。

`var_dump`和之间的区别在于`var_export`它`var_export`返回*“变量的可解析字符串表示”*，而`var_dump`只是转储有关变量的信息。这在实践中意味着`var_export`为您提供有效的 PHP 代码（但可能不会为您提供关于变量的那么多信息，尤其是在您使用[资源](http://php.net/manual/en/language.types.resource.php)时）。

### 演示：

```
$demo = array(
    "bool" => false,
    "int" => 1,
    "float" => 3.14,
    "string" => "hello world",
    "array" => array(),
    "object" => new stdClass(),
    "resource" => tmpfile(),
    "null" => null,
);

// var_export -- nice, one-liner
$debug_export = var_export($demo, true);

// var_dump
ob_start();
var_dump($demo);
$debug_dump = ob_get_clean();

// print_r -- included for completeness, though not recommended
$debug_printr = print_r($demo, true); 
```

## 输出差异：

### var_export（`$debug_export`在上面的例子中）：

```
 array (
  'bool' => false,
  'int' => 1,
  'float' => 3.1400000000000001,
  'string' => 'hello world',
  'array' => 
  array (
  ),
  'object' => 
  stdClass::__set_state(array(
  )),
  'resource' => NULL, // Note that this resource pointer is now NULL
  'null' => NULL,
) 
```

### var_dump（`$debug_dump`在上面的例子中）：

```
 array(8) {
  ["bool"]=>
  bool(false)
  ["int"]=>
  int(1)
  ["float"]=>
  float(3.14)
  ["string"]=>
  string(11) "hello world"
  ["array"]=>
  array(0) {
  }
  ["object"]=>
  object(stdClass)#1 (0) {
  }
  ["resource"]=>
  resource(4) of type (stream)
  ["null"]=>
  NULL
} 
```

### print_r（`$debug_printr`在上面的例子中）：

```
Array
(
    [bool] => 
    [int] => 1
    [float] => 3.14
    [string] => hello world
    [array] => Array
        (
        )

    [object] => stdClass Object
        (
        )

    [resource] => Resource id #4
    [null] => 
) 
```

## 警告：`var_export`不处理循环引用

如果您尝试使用循环引用转储变量，调用`var_export`将导致 PHP 警告：

```
 $circular = array();
 $circular['self'] =& $circular;
 var_export($circular); 
```

结果是：

```
 Warning: var_export does not handle circular references in example.php on line 3
 array (
   'self' => 
   array (
     'self' => NULL,
   ),
 ) 
```

另一方面，当遇到循环引用时`var_dump`，两者都会输出字符串。`print_r``*RECURSION*`

* * *

## 回答 #2

> 赞同：642
> 
> 时间：2008-09-26T13:25:22.900

使用输出缓冲：

```
<?php
ob_start();
var_dump($someVar);
$result = ob_get_clean();
?> 
```

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2008-09-26T13:27:06.560

你也可以这样做：

```
$dump = print_r($variable, true); 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2013-11-10T13:44:57.580

如果您使用的是 PHP>=7.0.0

```
function return_var_dump(...$args): string
{
    ob_start();
    try {
        var_dump(...$args);
        return ob_get_clean();
    } catch (\Throwable $ex) {
        // PHP8 ArgumentCountError for 0 arguments, probably..
        // in php<8 this was just a warning
        ob_end_clean();
        throw $ex;
    }
} 
```

或者如果您使用的是 PHP >=5.3.0：

```
function return_var_dump(){
    ob_start();
    call_user_func_array('var_dump', func_get_args());
    return ob_get_clean();
} 
```

或者如果您使用的是 PHP<5.3.0（此功能实际上一直兼容 PHP4）

```
function return_var_dump(){
    $args = func_get_args(); // For <5.3.0 support ...
    ob_start();
    call_user_func_array('var_dump', $args);
    return ob_get_clean();
} 
```

（在 5.3.0 之前，如果 func_get_args 直接用作另一个函数调用的参数，则存在一个错误，因此您必须将其放入变量中并使用该变量，而不是直接将其用作参数..）

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-29T02:41:46.103

您也可以尝试使用该[`serialize()`](http://php.net/manual/en/function.serialize.php)功能。有时它对于调试目的非常有用。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2013-08-06T15:59:46.573

也`echo json_encode($dataobject);`可能有帮助

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2014-09-14T16:47:25.577

[从 PHP 手册](http://php.net/var_dump)：

> 此函数显示有关一个或多个表达式的结构化信息，包括其类型和值。

所以，这里是PHP 的*真正*`var_dump()`返回版本，它实际上接受一个可变长度的参数列表：

```
function var_dump_str()
{
    $argc = func_num_args();
    $argv = func_get_args();

    if ($argc > 0) {
        ob_start();
        call_user_func_array('var_dump', $argv);
        $result = ob_get_contents();
        ob_end_clean();
        return $result;
    }

    return '';
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-12-27T16:47:29.890

如果您想在运行时查看变量的内容，请考虑使用真正的调试器，例如 XDebug。这样你就不需要弄乱你的源代码，即使普通用户访问你的应用程序，你也可以使用调试器。他们不会注意到的。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-10-13T11:30:28.847

这是作为函数的完整解决方案：

```
function varDumpToString ($var)
{
    ob_start();
    var_dump($var);
    return ob_get_clean();
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-05-02T08:49:55.857

这可能有点跑题了。

我正在寻找一种将此类信息写入我的 PHP-FPM 容器的 Docker 日志的方法，并想出了下面的代码片段。我确信这可以被 Docker PHP-FPM 用户使用。

```
fwrite(fopen('php://stdout', 'w'), var_export($object, true)); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-04-27T19:25:38.157

我真的很喜欢' 的详细输出，但对' 或' 的输出`var_dump()`不满意，因为它没有提供太多信息（例如缺少数据类型、缺少长度）。`var_export()``print_r()`

为了编写安全且可预测的代码，有时区分空字符串和空字符串很有用。或介于 1 和真之间。或者介于 null 和 false 之间。所以我想要我的数据类型在输出中。

虽然有帮助，但我没有在现有响应中找到一个干净简单的解决方案，将 的彩色输出转换为`var_dump()`人类可读的输出，然后将其转换为没有 html 标记的字符串，并包含来自`var_dump()`.

请注意，如果您有 color `var_dump()`，则表示您安装了 Xdebug，它会覆盖 php 的默认设置`var_dump()`以添加 html 颜色。

出于这个原因，我创建了这个微小的变化，给出了我所需要的：

```
function dbg_var_dump($var)
    {
        ob_start();
        var_dump($var);
        $result = ob_get_clean();
        return strip_tags(strtr($result, ['=&gt;' => '=>']));
    } 
```

返回以下漂亮的字符串：

```
array (size=6)
  'functioncall' => string 'add-time-property' (length=17)
  'listingid' => string '57' (length=2)
  'weekday' => string '0' (length=1)
  'starttime' => string '00:00' (length=5)
  'endtime' => string '00:00' (length=5)
  'price' => string '' (length=0) 
```

希望它可以帮助某人。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2015-01-20T06:41:42.783

来自[http://htmlexplorer.com/2015/01/assign-output-var_dump-print_r-php-variable.html](http://htmlexplorer.com/2015/01/assign-output-var_dump-print_r-php-variable.html)：

> var_dump 和 print_r 函数只能直接输出到浏览器。所以这些函数的输出只能通过php的输出控制函数来获取。以下方法可能有助于保存输出。
> 
> ```
> function assignVarDumpValueToString($object) {
>     ob_start();
>     var_dump($object);
>     $result = ob_get_clean();
>     return $result;
> } 
> ```

ob_get_clean() 只能清除最后输入到内部缓冲区的数据。因此，如果您有多个条目，则 ob_get_contents 方法将很有用。

来自与上述相同的来源：

> ```
> function varDumpToErrorLog( $var=null ){
>     ob_start();                    // start reading the internal buffer
>     var_dump( $var);          
>     $grabbed_information = ob_get_contents(); // assigning the internal buffer contents to variable
>     ob_end_clean();                // clearing the internal buffer.
>     error_log( $grabbed_information);        // saving the information to error_log
> } 
> ```

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2019-08-12T02:50:17.150

**长字符串**：只需使用`echo($var);`而不是`dump($var);`.

**对象**或**数组**：`var_dump('<pre>'.json_encode($var).'</pre>);'`

# c - C99 的支持范围有多广？

> ID：139479
> 
> 赞同：46
> 
> 时间：2008-09-26T13:23:19.410
> 
> 标签：c, c99, standards-compliance

当今的编译器支持 C99 标准的普遍程度如何？我知道即使 GCC 也不完全支持它。这是正确的吗？

C99 的哪些功能比其他功能更受支持，即我可以使用哪些功能来确定大多数编译器会理解我？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-26T13:28:20.457

如果您想编写可移植的 C 代码，那么我建议您使用 C89（旧的 ANSI C 标准）编写。大多数编译器都支持此标准。

英特尔 C 编译器具有[非常好的 C99 支持](http://software.intel.com/en-us/articles/c99-support-in-intelr-c-compiler/)，并且可以生成快速的二进制文件。（感谢*0x69*！）

MSVC 支持[一些新功能](http://blogs.msdn.com/b/vcblog/archive/2013/07/19/c99-library-support-in-visual-studio-2013.aspx)，Microsoft 计划在未来版本中扩大支持。

GCC 支持 C99 的一些新东西。他们创建了一张关于[C99 功能状态的](http://gcc.gnu.org/c99status.html)表格。可能 C99 最有用的特性是可变长度数组，而 GCC 现在支持它。[Clang](http://clang.llvm.org/docs/UsersManual.html#c)（LLVM 的 C 前端）支持除浮点编译指示以外的大多数功能。

维基百科似乎对编译器[的 C99 支持有一个很好的总结。](https://en.wikipedia.org/wiki/C99#Implementations)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-26T19:43:16.580

有人提到英特尔编译器支持 C99。还有完全支持 C99的[Comeau C/C++ 编译器。](http://www.comeaucomputing.com/)我知道的只有这些。

由于没有得到很好的支持，我不使用的 C99 功能包括：

*   变长数组
*   具有可变数量参数的宏。

我经常使用的 C99 功能似乎得到了很好的支持（微软除外）：

*   `stdint.h`
*   `snprintf()`- MS 有一个非标准`_snprintf()`，它具有严重的限制，即不总是空终止缓冲区并且不指示缓冲区应该有多大

为了解决 Microsoft 的不支持问题，我使用了[MinGW的](http://www.mingw.org/download.shtml)[公共域`stdint.h`](http://www.mingw.org/download.shtml)（我对其进行了修改以也适用于 VC6）和[Holger Weiss的](http://www.jhweiss.de/software/snprintf.html)[几乎公共域`snprintf()`](http://www.jhweiss.de/software/snprintf.html)

Microsoft 不支持但仍将根据项目在其他编译器上使用的项目包括：

*   混合声明和代码
*   内联函数
*   `_Pragma()`- 这使得编译指示更有用

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-26T13:26:49.447

对于 gcc，有一个[包含所有受支持功能的表](http://gcc.gnu.org/c99status.html)。似乎最大的缺失是可变长度数组。大多数其他缺失的功能是库问题而不是语言功能。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-08-11T16:08:27.543

IBM c 编译器在以 c99 调用时支持 c99，但在以 cc 或 xlc 调用时不支持。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T13:27:33.657

查看[GNU 的 C99 支持状态，](http://gcc.gnu.org/c99status.html)了解当前支持哪些功能的详细信息。

[Sun Studio](http://developers.sun.com/sunstudio/documentation/ss12/mr/READMEs/c.html#about)声称支持整个 C99 规范。我从未使用过它们，所以我无法确认。

我不相信微软编译器完全支持 C99 规范。他们现在更专注于 C++

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-26T16:16:53.563

Microsoft 似乎在跟踪 C++ 标准，但不支持 C99。（他们可能会挑选一些特性，但可以说是挑选有重叠的 C++0x。）

从 Visual Studio .NET 2003 开始​​，新项目默认启用“将 C 代码编译为 C++ (/TP)”选项。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-01-17T06:52:40.663

Clang（基于 LLVM 的 C 和 C++ 编译器）具有很好的 C99 支持。我认为它唯一不支持的是浮点编译指示。

# screen-scraping - 有哪些好的方法可以阻止屏幕抓取工具从我的网站上抓取特定内容？

> ID：139482
> 
> 赞同：3
> 
> 时间：2008-09-26T13:23:27.567
> 
> 标签：screen-scraping

很确定这个问题对大多数 web 2.0 支持者来说都是亵渎神明，但我确实认为有时你可能*不*希望你的网站的某些部分被轻易地盗取到其他人的任意网络聚合器中。至少足够了，如果他们真的想要的话，他们需要被逼着用手去做。

我的想法是制作一个脚本，通过绝对坐标按照它们在各自段落中正常出现的顺序定位文本节点，然后将这些文本节点以随机、混乱的顺序存储在 DOM 中。当然，让这样的系统正常工作（正确的文本换行、对齐、样式等）似乎几乎类似于从头开始编写我自己的文档渲染器。

我还考虑将它与类似 CAPTCHA 的东西结合起来，以微妙的方式弄乱文本，以阻碍屏幕抓取工具，这些屏幕抓取工具可以简单地查看快照并识别字母或诸如此类的东西。但这可能是多虑了。

唔。有没有人设计出任何好的方法来做这样的事情？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T13:28:07.370

考虑到刮板无法读取的所有内容，搜索引擎也无法读取。话虽如此，您可以在页面加载后通过 Javascript 将内容注入到您的文档中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T13:32:58.717

请不要使用绝对定位来重组乱码。这不适用于移动设备、视障人士的屏幕阅读器和搜索引擎。

请不要添加验证码。它只会在人们看到您的网站之前把他们赶走。

您提出的任何解决方案都将是反网络的。互联网是关于分享的，你必须接受坏的和好的。

如果您必须做某事，您可能只想使用 Flash。我还没有看到链接农民抓取 Flash 内容。但是出于第一段中所述的所有原因，Flash 是反网络的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T13:27:55.123

您的想法也可能会破坏任何屏幕阅读器，因此您应该在搞砸订购之前检查可访问性要求/立法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T13:37:41.183

我见过在客户端使用 javascript 解密[电视指南。](http://www.ebroadcast.com.au/tv/static/PerthNight.html)它不会阻止确定的抓取工具，但会阻止大多数随意的脚本编写。

所有文本电视条目都是相似的`ps10825('4VUknMERbnt0OAP3klgpmjs....abd26')`，其中 ps10825 只是一个使用 ps10825 密钥调用其解密函数的函数。显然，每次都会生成密钥。

在这种情况下，我认为阻止 99% 的人使用 Greasemonkey 甚至 wget 脚本下载他们的电视指南而没有看到他们所有的广告就足够了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-16T20:51:07.020

要理解这一点，最好尝试抓取一些站点。我已经抓取了一些非常具有挑战性的网站，例如银行网站。我见过许多使抓取变得困难的尝试（例如加密、cookie 等）。归根结底，最好的防御是不可预测的加价。Scraper 最依赖于能够在标记中找到“模式”。一旦模式发生变化，抓取逻辑就会失败。刮板是出了名的易碎，而且经常容易损坏。

我的建议是，将不可见的标记随机注入您的代码中。特别是围绕可能有趣的内容。做任何你能想到的事情，让你的标记在每次调用时看起来都与刮板不同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T13:35:04.000

[使用ImageMagick 之](http://www.imagemagick.org/script/index.php)类的东西在[SVG](http://en.wikipedia.org/wiki/Svg)中渲染所有文本

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-19T17:17:51.597

Alexa.com 做了一些古怪的事情来防止抓取。去这里看看流量排名号 [http://www.alexa.com/data/details/traffic_details/teenormous.com](http://www.alexa.com/data/details/traffic_details/teenormous.com)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-26T18:39:15.600

这些技术中很少有会阻止确定的。Alexa 风格的垃圾 HT​​ML/CSS 掩码很容易解决（只需解析 CSS）；AJAX/Javascript-DOM-insertion 也很容易解决，尽管表单真实性令牌使这变得更加困难。

我发现提供官方 API 是最好的威慑 :)

除此之外，将文本渲染为图像是阻止随意刮板的好方法（但仍然可行）

YouTube 还使用 javascript 混淆，这使得 AJAX 逆向工程更加困难

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-26T13:27:53.673

只需通过 AJAX 调用加载所有 HTML，HTML 就不会“出现”在大多数屏幕抓取工具的 DOM 中。

# security - Websphere 6.1 - 配置安全性

> ID：139483
> 
> 赞同：0
> 
> 时间：2008-09-26T13:23:42.170
> 
> 标签：security, websphere, websphere-6.1

当我尝试通过 Websphere 的管理控制台配置安全性时，它只是挂起。它位于以下 4 个步骤的最后一步

1.  指定保护范围
2.  选择用户存储库
3.  配置用户存储库
4.  概括

这是我的控制台的摘录

```
[26/09/08 13:50:56:539 IST] 0000001f ServletWrappe I   
    SRVE0242I: [isclite] [/ibm/console] [/com.ibm.ws.console.security/EnableSecurity.jsp]: Initialization successful.
[26/09/08 13:50:58:616 IST] 0000001f ServletWrappe I   
    SRVE0242I: [isclite] [/ibm/console] [/com.ibm.ws.console.security/SelectRegistry.jsp]: Initialization successful.
[26/09/08 13:51:00:126 IST] 0000001f ServletWrappe I   
    SRVE0242I: [isclite] [/ibm/console] [/com.ibm.ws.console.security/ConfigureRegistry.jsp]: Initialization successful.
[26/09/08 13:51:00:126 IST] 0000001f ServletWrappe I   
    SRVE0242I: [isclite] [/ibm/console] [/com.ibm.ws.console.security/LocalRegistry.jsp]: Initialization successful.
[26/09/08 13:51:36:202 IST] 0000001f ServletWrappe I   
    SRVE0242I: [isclite] [/ibm/console] [/com.ibm.ws.console.security/ConfirmEnableSecurity.jsp]: Initialization successful.
[26/09/08 13:52:20:255 IST] 0000001f UserRegistryI A   
    SECJ0136I: Custom Registry:com.ibm.ws.security.registry.nt.NTLocalDomainRegistryImpl has been initialized
[26/09/08 13:52:21:025 IST] 0000001f UserRegistryI A   
    SECJ0136I: Custom Registry:com.ibm.ws.security.registry.nt.NTLocalDomainRegistryImpl has been initialized
[26/09/08 14:04:03:127 IST] 00000019 ThreadMonitor W   
    WSVR0605W: Thread "WebContainer : 2" (0000001f) has been active for 746076 milliseconds and may be hung.  There is/are 1 thread(s) in total in the server that may be hung. 
```

知道这里可能有什么吗？

谢谢达米安

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T13:44:09.047

在我看来，您的 LDAP 服务器没有及时响应。您有一个挂起的线程而不是网络错误这一事实向我表明您正在成功地与 LDAP 通信。如果您将它附加到支持 Active Directory 的 LDAP，它可能会负担过重。我们过去曾使用[ADAM 服务器](http://www.microsoft.com/windowsserver2003/adam/default.mspx)来解决缓慢的 LDAP 响应时间。然而，我们的响应时间大约是 3-5 秒，而不是 12 分钟以上。这也可能是一个僵局。我已经看到由于实施 XD 扩展而导致线程挂起，其中节点使它们的通信死锁（但这些不是 WebContainer 线程）。为了解决这个问题，我们放弃了 XD 扩展，转而使用[NetScaler](http://www.citrix.com/english/ps2/products/product.asp?contentID=21679)设置。

# unix - 在 shell/bash 中连接两个命令之间的输入 _and_output

> ID：139484
> 
> 赞同：11
> 
> 时间：2008-09-26T13:24:07.020
> 
> 标签：unix, shell, pipe

我有两个（UNIX）程序 A 和 B，它们从 stdin/stdout 读取和写入。

我的第一个问题是如何将 A 的标准输出连接到 B 的标准输入，将 B 的标准输出连接*到*Aie 的标准输入，例如 A | B 而是双向管道。我怀疑我可以通过[使用 exec 重定向](http://tldp.org/LDP/abs/html/x16834.html)来解决这个问题，但我无法让它工作。这些程序是交互式的，因此临时文件不起作用。

第二个问题是我想复制每个方向并通过日志程序将副本传输到标准输出，以便我可以看到程序之间传递的（基于文本行的）流量。在这里，如果我能解决第一个问题，我可能会逃脱 tee >(...) 。

这两个问题似乎都应该有众所周知的解决方案，但我找不到任何东西。

我更喜欢 POSIX shell 解决方案，或者至少在 cygwin 上的 bash 中工作的东西。

感谢您的回答，我想出了以下解决方案。A/B 命令使用 nc 监听两个端口。日志记录程序使用 sed（使用 -u 进行无缓冲处理）。

```
bash-3.2$ fifodir=$(mktemp -d)
bash-3.2$ mkfifo "$fifodir/echoAtoB"
bash-3.2$ mkfifo "$fifodir/echoBtoA"
bash-3.2$ sed -u 's/^/A->B: /' "$fifodir/echoAtoB" &
bash-3.2$ sed -u 's/^/B->A: /' "$fifodir/echoBtoA" &
bash-3.2$ mkfifo "$fifodir/loopback"
bash-3.2$ nc -l -p 47002 < "$fifodir/loopback" \
          | tee "$fifodir/echoAtoB" \
          | nc -l -p 47001 \
          | tee "$fifodir/echoBtoA" > "$fifodir/loopback" 
```

这会监听到端口 47001 和 47002 的连接，并将所有流量回显到标准输出。

在外壳 2 中：

```
bash-3.2$ nc localhost 47001 
```

在外壳 3 中：

```
bash-3.2$ nc localhost 47002 
```

现在在 shell 2 中输入的行将被写入 shell 3，反之亦然，流量记录到 shell 1，如下所示：

```
B->A: input to port 47001
A->B: input to port 47002 
```

以上已在 Cygwin 上测试过

更新：上面的脚本在几天后停止工作（！）。显然它可以死锁。答案中的一些建议可能更可靠。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T13:33:35.250

命名管道怎么样？

```
# mkfifo foo
# A < foo | B > foo
# rm foo 
```

对于您的第二部分，我相信 tee 是正确的答案。所以它变成：

```
# A < foo | tee logfile | B > foo 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T13:26:25.457

[http://bisqwit.iki.fi/source/twinpipe.html](http://bisqwit.iki.fi/source/twinpipe.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T13:30:45.383

您可能可以摆脱命名管道：

```
mkfifo pipe
gawk '$1' < pipe | gawk '$1' > pipe 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T13:49:26.243

您可以使用[期望](http://expect.nist.gov/)。

> Expect 是一个用于自动化交互式应用程序的工具，例如 telnet、ftp、passwd、fsck、rlogin、tip 等。

您可以使用以下代码（取自*Exploring Expect*书）作为起点 - 按照您的要求，它将 proc1 的输出连接到 proc2 的输入，反之亦然：

```
#!/usr/bin/expect -f
spawn proc1
set proc1 $spawn_id
spawn proc2
interact -u $proc1 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-09T09:12:26.347

我花了很多时间，放弃了，最后决定使用 ksh（Korn shell），它允许这样做。

```
cmd1 |& cmd2 >&p <&p 
```

其中`|&`是启动协同进程的（管道）运算符，并且`&p`是该协同进程的文件描述符。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-10-27T03:41:49.063

我曾经遇到过这个问题，我把这个简单的 C 程序放在一起。

```
#include <stdio.h>
#include <unistd.h>

#define PERROR_AND_DIE(_x_) {perror(_x_); _exit(1);}

int main(int argc, char **argv) {
    int fd0[2];
    int fd1[2];

    if ( argc != 3 ) {
        fprintf(stdout, "Usage %s: \"[command 1]\" \"[command 2]\"\n", argv[0]);
        _exit(1);
    }

    if ( pipe(fd0) || pipe(fd1) ) PERROR_AND_DIE("pipe")

    pid_t id = fork();
    if ( id == -1 ) PERROR_AND_DIE("fork");

    if ( id ) {
        if ( -1 == close(0) )  PERROR_AND_DIE("P1: close 0");
        if ( -1 == dup2(fd0[0], 0) ) PERROR_AND_DIE("P1: dup 0"); //Read my STDIN from this pipe

        if ( -1 == close(1) )  PERROR_AND_DIE("P1: close 1");
        if ( -1 == dup2(fd1[1], 1) ) PERROR_AND_DIE("P1: dup 1"); //Write my STDOUT here
        execl("/bin/sh", "/bin/sh", "-c", argv[1], NULL);
        PERROR_AND_DIE("P1: exec")
    }

    if ( -1 == close(0) )  PERROR_AND_DIE("P2: close 0");
    if ( -1 == dup2(fd1[0], 0) ) PERROR_AND_DIE("P2: dup 0");

    if ( -1 == close(1) )  PERROR_AND_DIE("P2: close 1");
    if ( -1 == dup2(fd0[1], 1) ) PERROR_AND_DIE("P2: dup 1");

    execl("/bin/sh", "/bin/sh", "-c", argv[2], NULL);
    PERROR_AND_DIE("P2: exec")
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T13:53:29.493

[这个问题和](https://stackoverflow.com/questions/40244/how-to-make-a-pipe-loop-in-bash)我之前问的类似。其他人提出的解决方案是使用命名管道，但我怀疑你在 cygwin 中没有它们。目前我坚持[我自己的（尝试一个）解决方案](https://stackoverflow.com/questions/40244/how-to-make-a-pipe-loop-in-bash#43332)，但它需要`/dev/fd/0`你可能也没有。

虽然我不太喜欢`twinpipe`（由 JeeBee ( [139495](https://stackoverflow.com/questions/139484/connecting-input-andoutput-between-of-two-commands-in-shellbash#139495) ) 提到）的传递命令行作为字符串方面，但它可能是您在 cygwin 中的唯一选择。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-29T13:09:50.913

我建议“coproc”：

```
#! /bin/bash
# initiator needs argument

if [ $# -gt 0 ]; then
  a=$1
  echo "Question $a"
else
  read a
fi

if [ $# -gt 0 ]; then
  read a
  echo "$a" >&2
else
  echo "Answer to $a is ..."
fi

exit 0 
```

然后看这个会话：

```
$ coproc ./dialog
$ ./dialog  test  < /dev/fd/${COPROC[0]}  > /dev/fd/${COPROC[1]}
Answer to Question test is ... 
```

# asp.net - ASP.NET Themes samples/starter kits

> ID：139487
> 
> 赞同：2
> 
> 时间：2008-09-26T13:24:40.327
> 
> 标签：asp.net, themes, sample, starter-kits

I was wondering if there was somewhere I could get some starter kit / theme sample for ASP.NET.

I am not a designer, but I need to build a prototype for a project, and if I do it myself it'll certainly be awful

Do you know where I could find that (ASP.NET specific)?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T13:26:13.240

Check [http://asp.net](http://asp.net). There are quite a few starter kits and sample projects there. ([http://www.asp.net/community/projects/](http://www.asp.net/community/projects/))

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:12:56.353

Do you mean templates for a website? If so, that is nothing to do with ASP.NET, There are loads of places to get decent free website templates including:

*   [http://www.templateworld.com/free_templates.html](http://www.templateworld.com/free_templates.html)

*   [http://www.styleshout.com/](http://www.styleshout.com/)

*   [http://www.freecsstemplates.org/](http://www.freecsstemplates.org/)

If you are after ASP.NET code snippets & samples, try:

*   [http://www.freevbcode.com/listcode.asp?Category=16](http://www.freevbcode.com/listcode.asp?Category=16)
*   [http://www.asp101.com/](http://www.asp101.com/)

What specifically is your project concerned with?

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T14:21:59.173

What you're looking for is [here](http://msdn.microsoft.com/en-us/asp.net/aa336613.aspx). Asp.net specific design templates from msdn.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-12T18:55:40.203

you can check latest [Employee Info Starter Kit](http://eisk.codeplex.com/releases/view/61932) ASP.NET project template, which utilized some great css and jQuery frameworks and integrated with ASP.NET server controls.

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-06-10T13:44:56.590

I advice to check ASP.NET Iteration Zero: [http://aspnetzero.com/](http://aspnetzero.com/)

It's a professional starter kit based on a strong framework and UI. It includes role and membership management and much more. You can create a demo to see it in action easily.

# xml - SOAP / XML 中的命名空间范围

> ID：139509
> 
> 赞同：0
> 
> 时间：2008-09-26T13:28:37.820
> 
> 标签：xml, soap

这是有效的 SOAP/XML 吗？

```
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <soap:Body>
        <CreateRoute xmlns="urn:Routs">
            <aRoute>
                <name>ToTheTop</name>
                <grade xsi:type="FrencGrade">
                    <gradeNumber>7</gradeNumber>
                    <gradeModifier>a</gradeModifier>
                </grade>
            </aRoute>
        </CreateRoute>
    </soap:Body>
</soap:Envelope> 
```

如果是：FrenchGrade 属于哪个命名空间？它在 urn:Routs 命名空间中吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T13:33:02.867

对，那是正确的。通过做：

```
<CreateRoute xmlns="urn:Routs"> 
```

...您正在将默认命名空间更改为`urn:Routs`. 这意味着所有无前缀的子元素都将存在于这个新的命名空间中。

当然，除非：

*   您使用不同的前缀显式添加新元素
*   您创建一个新的子元素并*更改其默认命名空间*，在这种情况下，它的子元素将位于该新命名空间中

# linq - 如何编写 Linq to SQL 自动生成的部分扩展？

> ID：139513
> 
> 赞同：4
> 
> 时间：2008-09-26T13:29:44.620
> 
> 标签：linq, linq-to-sql, partial-methods

我使用 VS 2008 SP1 Framework 3.5 SP1 制作了一个从 Linq 到 SQL Clasees 的类，在这种情况下，我扩展了部分

```
partial void UpdateMyTable(MyTable instance){
   // Business logic
   // Validation rules, etc.
} 
```

我的问题是当我执行 db.SubmitChanges() 时，它执行 UpdateMyTable 并进行验证，但它没有更新，我收到此错误：

```
[Exception: Deliver]
   System.Data.Linq.ChangeProcessor.SendOnValidate(MetaType type, TrackedObject item, ChangeAction changeAction) +197
   System.Data.Linq.ChangeProcessor.ValidateAll(IEnumerable`1 list) +255
   System.Data.Linq.ChangeProcessor.SubmitChanges(ConflictMode failureMode) +76
   System.Data.Linq.DataContext.SubmitChanges(ConflictMode failureMode) +331
   System.Data.Linq.DataContext.SubmitChanges() +19 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T13:53:01.040

*   如果提供此方法，则必须在方法中执行更新。

* * *

[http://msdn.microsoft.com/en-us/library/bb882671.aspx](http://msdn.microsoft.com/en-us/library/bb882671.aspx)

*   如果您在分部类中实现 Insert、Update 和 Delete 方法，则 LINQ to SQL 运行时将在调用 SubmitChanges 时调用它们**而不是**其自己的默认方法。

试试**MiTabla.OnValidate**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T18:28:47.660

如果您想实现此方法但不自己进行更新，您可以调用方法 ExecuteDynamicUpdate(item);

同样，分别对 DeleteMyTable 和 InsertMyTable 执行 ExecuteDynamicDelete 和 ExecuteDynamicInsert。

# user-management - 用户或帐户或个人或什么？

> ID：139521
> 
> 赞同：0
> 
> 时间：2008-09-26T13:31:36.097
> 
> 标签：user-management

在 Stack Overflow 上，您是“用户”。在[43things.com 上](http://43things.com/)，您是一个“人”。在其他网站上，您是一个“帐户”。然后一些网络应用程序跳过了这种符号的使用，它只是[http://webapp.com/yourusername](http://webapp.com/yourusername)

你认为这些能指意味着什么吗？你更喜欢其中一个吗？

在构建应用程序时，我经常会在过程中遇到这一步并偶然发现是否将应用程序的用户称为“用户”或“人”或“帐户”。我敢肯定还有其他例子，但这些是我最常遇到的例子。我很好奇其他人在构建他们的应用程序的用户管理功能时会怎么想。我认为大多数默认使用“用户”，但你有想过为什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T13:34:17.323

**Person**意味着与一个真实的人存在 1:1 的对应关系。 **Account**不一定意味着这一点（例如服务帐户），严格来说， **User也没有。**例如，这里有一个“社区”用户，他显然不是一个真实的人。称其为“社区人”是没有意义的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T13:35:46.337

这种语义是上下文的。在社区站点中，您通常是“成员”，在付费服务中，您拥有“帐户”。“用户”是通用默认值。您应该选择一个最能描述“用户”在您的应用程序中的角色的名字。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T13:39:11.523

**我更喜欢做用户。**帐户也是该事物的标准名称。人对我来说似乎很麻烦。无论如何，我是一个人，在给定的服务上注册不会改变它。

我不会讨论名称之间的细微差别。使用**最常见**、最标准的。这将更加**用户友好，**因为更少的惊喜更友好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T13:40:17.200

我不确定用户和帐户是否可以互换。例如，我可以是 StackOverflow 上的“用户”而没有“帐户”。虽然如果我有一个帐户，作为用户，我将拥有更多的设施。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T13:40:04.643

取决于您的目标受众和您正在构建的应用程序类型：

*   对于社区网站，*人*将是我的第一选择。
*   对于开发者社区网站（比如这个），绝对是*用户*;-)
*   对于银行应用，*账户*似乎是最合乎逻辑的选择

ETC...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T13:35:01.020

“帐户”意味着它可能有多个用户。如果用户是您的应用程序的核心部分，即像 facebook 这样的社交网络，则只使用 / 是合适的。我将“用户”用于真实用户，可以实际登录的人等，如果您只是管理人员，则使用“人员”，例如人员搜索引擎。

**编辑：**在宇宙的宏大尺度上，这真的无关紧要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T13:37:55.897

虽然它们对我们技术人员的含义大致相同，但普通“用户”更喜欢被视为“成员”而不是帐户/用户。这是一张更友好的脸。如果您是面向公众的，请称他们为成员，以给他们一种非技术人员似乎渴望的温暖模糊的感觉。:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-26T01:55:29.993

在为运动队成员设计一个小型网站时，我遇到了类似的问题。我有两种类型的帐户需要跟踪 - 有人可以申请成为团队成员（即成为球员），或者他们可以申请登录网站，以便他们可以跟踪玩家（即自己不是玩家）。最后我决定称他们为“登录”和“玩家”。所以有人可以为自己创建一个“登录”，然后在他们登录后他们可以创建“玩家”。每个“登录”然后可以链接到多个“玩家”。

正如多次说过的，你所说的应该对你的特定受众有意义——这通常是互联网领域最常见的用法。

# java - 如何以编程方式在第二个工作台中的模型上运行 Xpand 工作流程？

> ID：139525
> 
> 赞同：1
> 
> 时间：2008-09-26T13:32:10.073
> 
> 标签：java, eclipse, xtext, xpand, oaw

我有一个 Xtext/Xpand（oAW 4.3、Eclipse 3.4）生成器插件，我在第二个工作台中与编辑器插件一起运行。在那里，我想在我创建的模型文件上以编程方式运行 Xpand 工作流程。如果我使用我拥有的 IFile 的绝对路径设置模型文件，例如：

```
String dslFile = file.getLocation().makeAbsolute().toOSString(); 
```

或者，如果我使用通过以下方式检索的文件 URI：

```
String dslFile = file.getLocationURI().toString(); 
```

找不到文件：

```
org.eclipse.emf.ecore.resource.Resource$IOWrappedException: Resource '/absolute/path/to/my/existing/dsl.file' does not exist. 
at org.openarchitectureware.xtext.parser.impl.AbstractParserComponent.invokeInternal(AbstractParserComponent.java:55) 
```

在我交给 WorkflowRunner 的地图中，我应该将模型文件属性 (dslFile) 设置为什么值：

```
Map properties = new HashMap();
properties.put("modelFile", dslFile); 
```

我还尝试将属性留空并引用相对于工作流文件（在工作流文件内）的模型文件，但这会产生 FileNotFoundException。在普通应用程序（而不是在第二个工作台）中运行所有这些工作正常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-28T08:42:03.293

对于在这里看的人来说有两件重要的事情...... TE 使用 IFLE 来表示“file.get....”，并且路径的正确语法是“file:/c:/myOSbla”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T16:00:24.160

我在[openArchitectureWare 论坛上](http://openarchitectureware.org/forum/viewtopic.php?showtopic=10197)找到了帮助。基本上使用

```
properties.put("modelFile", file.getLocation().makeAbsolute().toOSString()); 
```

有效，但您需要在您调用的工作流程中指定通过 URI 进行查找：

```
<component class="org.eclipse.mwe.emf.Reader">
    <uri value='${modelFile}'/>
    <modelSlot value='theModel'/>
</component> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-30T02:27:12.903

这是一个示例应用**Launcher.java**（位于默认包中）：

```
import gnu.getopt.Getopt;
import gnu.getopt.LongOpt;

import java.io.File;
import java.io.IOException;

import org.eclipse.emf.mwe2.launch.runtime.Mwe2Launcher;

public class Launcher implements Runnable {

    //
    // main program
    //

    public static void main(final String[] args) {
        new Launcher(args).run();
    }

    //
    // private final fields
    //

    private static final String defaultModelDir     = "src/main/resources/model";
    private static final String defaultTargetDir    = "target/generated/pageflow-maven-plugin/java";
    private static final String defaultFileEncoding = "UTF-8";

    private static final LongOpt[] longopts = new LongOpt[] {
        new LongOpt("baseDir",   LongOpt.REQUIRED_ARGUMENT, new StringBuffer(), 'b'),
        new LongOpt("modelDir",  LongOpt.REQUIRED_ARGUMENT, new StringBuffer(), 'm'),
        new LongOpt("targetDir", LongOpt.REQUIRED_ARGUMENT, new StringBuffer(), 't'),
        new LongOpt("encoding",  LongOpt.REQUIRED_ARGUMENT, new StringBuffer(), 'e'),
        new LongOpt("help",      LongOpt.NO_ARGUMENT,       null,               'h'),
        new LongOpt("verbose",   LongOpt.NO_ARGUMENT,       null,               'v'),
    };

    private final String[] args;

    //
    // public constructors
    //

    public Launcher(final String[] args) {
        this.args = args;
    }

    public void run() {
        final String cwd = System.getProperty("user.dir");
        String baseDir   = cwd;
        String modelDir  = defaultModelDir;
        String targetDir = defaultTargetDir;
        String encoding  = defaultFileEncoding;
        boolean verbose = false;

        final StringBuffer sb = new StringBuffer();
        final Getopt g = new Getopt("pageflow-dsl-generator", this.args, "b:m:t:e:hv;", longopts);
        g.setOpterr(false); // We'll do our own error handling
        int c;
        while ((c = g.getopt()) != -1)
            switch (c) {
                case 'b':
                    baseDir = g.getOptarg();
                    break;
                case 'm':
                    modelDir = g.getOptarg();
                    break;
                case 't':
                    targetDir = g.getOptarg();
                    break;
                case 'e':
                    encoding = g.getOptarg();
                    break;
                case 'h':
                    printUsage();
                    System.exit(0);
                    break;
                case 'v':
                    verbose = true;
                    break;
                case '?':
                default:
                    System.out.println("The option '" + (char) g.getOptopt() + "' is not valid");
                    printUsage();
                    System.exit(1);
                    break;
            }

        String absoluteModelDir;
        String absoluteTargetDir;

        try {
            absoluteModelDir  = checkDir(baseDir, modelDir, false, true);
            absoluteTargetDir = checkDir(baseDir, targetDir, true, true);
        } catch (final IOException e) {
            throw new RuntimeException(e.getMessage(), e.getCause());
        }

        if (verbose) {
            System.err.println(String.format("modeldir  = %s", absoluteModelDir));
            System.err.println(String.format("targetdir = %s", absoluteTargetDir));
            System.err.println(String.format("encoding  = %s", encoding));
        }

        Mwe2Launcher.main(
                new String[] {
                        "workflow.PageflowGenerator",
                        "-p", "modelDir=".concat(absoluteModelDir),
                        "-p", "targetDir=".concat(absoluteTargetDir),
                        "-p", "fileEncoding=".concat(encoding)
                });

    }

    private void printUsage() {
        System.err.println("Syntax: [-b <baseDir>] [-m <modelDir>] [-t <targetDir>] [-e <encoding>] [-h] [-v]");
        System.err.println("Options:");
        System.err.println("  -b, --baseDir     project home directory, e.g: /home/workspace/myapp");
        System.err.println("  -m, --modelDir    default is: ".concat(defaultModelDir));
        System.err.println("  -t, --targetDir   default is: ".concat(defaultTargetDir));
        System.err.println("  -e, --encoding    default is: ".concat(defaultFileEncoding));
        System.err.println("  -h, --help        this help text");
        System.err.println("  -v, --verbose     verbose mode");
    }

    private String checkDir(final String basedir, final String dir, final boolean create, final boolean fail) throws IOException {
        final StringBuilder sb = new StringBuilder();
        sb.append(basedir).append('/').append(dir);
        final File f = new File(sb.toString()).getCanonicalFile();
        final String absolutePath = f.getAbsolutePath();
        if (create) {
            if (f.isDirectory()) return absolutePath;
            if (f.mkdirs()) return absolutePath;
        } else {
            if (f.isDirectory()) return absolutePath;
        }
        if (!fail) return null;
        throw new IOException(String.format("Failed to locate or create directory %s", absolutePath));
    }

    private String checkFile(final String basedir, final String file, final boolean fail) throws IOException {
        final StringBuilder sb = new StringBuilder();
        sb.append(basedir).append('/').append(file);
        final File f = new File(sb.toString()).getCanonicalFile();
        final String absolutePath = f.getAbsolutePath();
        if (f.isFile()) return absolutePath;
        if (!fail) return null;
        throw new IOException(String.format("Failed to find or locate directory %s", absolutePath));
    }

} 
```

...这是它的**pom.xml**：

```
<project
    xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

    <modelVersion>4.0.0</modelVersion>

    <groupId>com.vaadin</groupId>
    <artifactId>pageflow-dsl-generator</artifactId>
    <version>0.1.0-SNAPSHOT</version>

    <build>
        <sourceDirectory>src</sourceDirectory>

        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-jar-plugin</artifactId>
                <configuration>
                    <archive>
                        <index>true</index>
                        <manifest>
                            <mainClass>Launcher</mainClass>
                        </manifest>
                    </archive>
                </configuration>
            </plugin>
        </plugins>

    </build>

    <dependencies>
        <dependency>
            <groupId>urbanophile</groupId>
            <artifactId>java-getopt</artifactId>
            <version>1.0.9</version>
        </dependency>
    </dependencies>

</project> 
```

不幸的是，这个 pom.xml 并不打算打包它（至少现在还没有）。有关包装的说明，请查看 [链接文本](http://zarnekow.blogspot.com/2010/06/how-to-deploy-xtext-standalone.html)

玩得开心 ：）

理查德·戈麦斯

# java - 类加载器问题 - 如何确定加载了哪些库版本（jar 文件）

> ID：139534
> 
> 赞同：27
> 
> 时间：2008-09-26T13:34:02.910
> 
> 标签：java, jar, classloader

我刚刚解决了另一个 *I-though-I-was-using-this-version-of-a-library-but-appparently-my-app-server-has-already-loaded-an-older-version-of -this-library-*issue（叹气）。

有人知道验证（或监控）您的应用程序是否可以访问所有适当的 jar 文件或加载的类版本的好方法吗？

提前致谢！

[[PS 在我看来开始使用OSGi 模块架构](http://en.wikipedia.org/wiki/OSGi#Architecture)的一个很好的理由！]

**更新**：[这篇](http://www.jboss.org/community/docs/DOC-9697)文章也有帮助！它通过将 JBoss 的类加载器写入日志文件来让我了解加载了哪些类。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-26T21:05:08.677

如果您碰巧在使用 JBoss，那么有一个 MBean（类加载器存储库 iirc），您可以在其中请求所有已加载某个类的类加载器。

如果所有其他方法都失败了，总是`java -verbose:class`会为每个正在加载的类文件打印 jar 的位置。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-02T21:01:11.053

如果您在 jar 清单中有适当的版本信息，则有一些方法可以检索和测试版本。无需手动读取清单。

[java.lang.Package](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Package.html) .getImplementationVersion() 和 getSpecificationVersion() 和 isCompatibleWith() 听起来他们会做你正在寻找的东西。

您可以通过 this.getClass().getPackage() 等方式获取包。

java.lang.Package 的 javadoc 没有为这些属性提供特定的清单属性名称。一个快速的谷歌搜索在[http://java.sun.com/docs/books/tutorial/deployment/jar/packageman.html](http://java.sun.com/docs/books/tutorial/deployment/jar/packageman.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T14:16:57.300

在当前版本的 Java 中，库版本控制是一个相当模糊的术语，它依赖于使用有用的清单正确打包 JAR。即便如此，正在运行的应用程序要以一种有用的方式将这些信息收集在一起也需要做很多工作。JVM 运行时对您没有任何帮助。

我认为您最好的选择是在构建时强制执行此操作，使用 Ivy 或 Maven 等依赖管理工具来获取所有内容的正确版本。

有趣的是，Java 7 很可能会包含一个适当的模块版本控制框架来处理这类事情。并不是说这对你有帮助，

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T13:56:30.187

我不认为有一个很好的方法来检查。我不确定你是否想这样做。你需要做的是熟悉你的应用服务器的类加载架构，并理解它是如何工作的。

对其工作原理的简化解释是：EJB 或 Web 应用程序将首先在其自己的模块（ejb-jar 或 war）中声明的库中查找类或资源。如果在那里找不到该类，则类加载器将请求转发到其父类加载器，该类加载器是声明的依赖项（通常是 ejb）或负责加载在 ear 包中声明的库和资源的应用程序类加载器. 如果仍然找不到类或资源，则请求将转发到应用服务器，该服务器将在其自己的类路径中查找。

话虽如此，您应该记住，Java EE 模块（web-app、ejb）将始终从最近范围内的 jar 加载类。例如，如果您将 log4j v1 打包到 war 文件中，将 log4j v2 打包到耳朵级别，并将 log4j v3 放在应用服务器的类路径中，则该模块将在其自己的模块中使用该 jar。把它拿走，它会在耳朵水平使用那个。把它拿出来，它将使用应用服务器类路径中的那个。当模块之间存在复杂的依赖关系时，事情会变得更加棘手。

最好的是将应用程序全局库放在耳边。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T13:57:36.923

肯定有比我做的更好的方法，但我倾向于以非常手动的方式来做。

1.  每个 Jar 的文件名中必须有它的版本号（如果它不改变它的名称）。
2.  每个应用程序都有自己的类路径。
3.  必须有理由开始使用更新的 Jar（新版本）。不要仅仅因为它可用而改变，改变是因为它为您提供了您需要的功能。
4.  每个版本都必须包含所有需要的罐子。
5.  我保留了一个 Version 类，它知道它需要的 Jars 列表（这已编码到源文件中），并且可以在运行时根据类路径中的 Jars 列表进行检查。

正如我所说，它是手动的，但它可以工作。

# drupal - 如何从 Drupal 5 升级到 6？

> ID：139537
> 
> 赞同：1
> 
> 时间：2008-09-26T13:34:24.360
> 
> 标签：drupal, drupal-6

我在我的网站上运行 Drupal 5 并想升级到 V6。我没有运行任何晦涩或不受支持的模块。

不过我该怎么办？我似乎找不到任何逐步升级的方法。

我是否只需要覆盖所有文件，然后再次重新运行安装程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T13:38:13.913

[Drupal：从 5.x 升级到 6.x](http://drupal.org/videocasts/upgrading-to-6)

虽然是视频。我不知道所有这些视频教程是怎么回事。有人喜欢他们吗？我不能在四分之一的时间内以文本形式获得相同的信息吗？现在网络只针对文盲吗？

**编辑：**[这里](http://drupal.org/upgrade/tutorial-introduction)有一些文字

# user-interface - 创建交互式应用程序原型的最佳方式是什么？

> ID：139555
> 
> 赞同：7
> 
> 时间：2008-09-26T13:38:29.187
> 
> 标签：user-interface, evaluation, prototyping

这个问题应该从一般的角度来解释，而不是仅仅针对网络应用程序或桌面应用程序。

我一直在寻找一种简单易行的方法来为 Web 应用程序创建交互式原型。我想使用一种技术，允许简单的 UI 创建，尤其是在进一步迭代中重新创建和修改 UI。用模型数据填充 UI 应该非常简单。该技术可能需要一种简单的编程形式，例如指定从 UI 元素 A 到 UI 元素 B 的拖放行为。

我目前使用的一种工具是 Adob​​e Flex Builder。包含的 GUI 设计器非常好，到目前为止我已经完成了一些 AS3 技能。问题是将数据添加到 UI。它总是导致我编写用于检查和解析 XML 树结构的代码，主要是调试原型的这一部分。太麻烦了！

许多人使用的另一个工具是 PowerPoint，它涉及通过在单独的幻灯片中绘制交互的每个部分来创建 GUI 的一种非常麻烦的方式。没门！使用纸质原型我会快得多。其他（更好！）自由形式的绘图工具也是这个类别的一部分（我是一个快乐的重量级 inkscape 用户），但原型和模型显然不是他们的主要目的。Viso 的 UI 模板调色板使它比绘图比赛好一点。

据我所知，快速原型设计的主要竞争对手是：

*   爱丽丝
*   轴心
*   瑟琳娜和其他？
*   维索
*   Powerpoint、Illustrator、Inkscape 或任何其他自由形式的绘图工具
*   纸质原型
*   具有良好 GUI 构建器的 IDE（例如 Flex Builder Designer 和 Netbeans Matisse）

我的观点是，真正的 GUI 构建器是一个很好的起点。你目前的方法是什么？请在此处概述您的流程以及利弊作为答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-06-15T06:08:29.427

真正的 GUI 构建器是：

*   慢得多
*   只有程序员可以使用它们（尝试向分析师解释如何在 VB 中填充表格）
*   他们不允许您即时注释您的模型
*   没有皮肤（例如黑白）来创建不会被误认为“几乎完成”应用程序的屏幕

虽然专门的模型工具通常是：

*   以沟通为导向
*   可以将您的模型（连同您的笔记）打印或导出为 PDF/HTML/Word 等
*   更好的有一些“主屏幕”的变体，因此您可以从少数几个主应用程序屏幕中获得数百个模型（当您尝试与客户讨论真实场景时，您很快就会获得相当多的模型）
*   速度足够快，因此您可以在会议中实时制作原型

大约十年前，我对以上所有内容感到沮丧，并创建了自己的工具：[MockupScreens](http://MockupScreens.com)。它很快变得非常流行:-)

这是我所知道的此类专业工具的最完整列表。其中许多是免费的：[http ://c2.com/cgi/wiki?GuiPrototypingTools](http://c2.com/cgi/wiki?GuiPrototypingTools)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T14:01:06.650

**快速而肮脏的纸质原型制作：PowerPoint（请参阅：[Powepoint Prototyping Toolkit](http://www.istartedsomething.com/20071018/powerpoint-prototype-toolkit-01/)）**

- 非常适合轻松组合可以展示的原型。幻灯片性质也可以作为模拟交互的替代品。缺点是缺乏标准化。不适用于有纪律的项目。

**严谨的纸质原型设计：Visio**

- 标准化和全功能，但更繁琐

**交互式原型设计：Visual Studio**

- 使用拖放和事件非常快速的交互构建。可以数据驱动。您甚至可以构建原型“基础”作为入门工具包。唯一的缺点是实际上将其作为生产应用程序的诱惑。;)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T13:43:13.823

还有[Balsamiq](http://balsamiq.com/)。我有点喜欢它，但通常很快就会厌倦这些东西。我最终使用了笔和纸或 OS X 的界面构建器，它并不比所有这些原型工具更难使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T13:54:11.503

如果您在谈论模型/线框（即静态图片），Visio 是一种首选工具。

您提到的大多数软件要么高于普通业务用户的水平（即您需要专家来制作模型，而不是业务用户帮助您）或者不是为了模型而创建的。

如果您需要一个动态原型，那么有很多选择，一切都取决于您在团队中可用的技能类型。例如，我有一个非常擅长 HTML 的人。对他来说，在记事本中从头开始创建 HTML 页面并尝试在所见即所得工具中使用 Flash 做同样的事情会容易得多。其他一些人具有良好的 Flash 技能，可以使用它们等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T13:52:59.823

Expression Blend ( [http://www.microsoft.com/expression/products/overview.aspx?key=blend](http://www.microsoft.com/expression/products/overview.aspx?key=blend) ) 可用于在 XAML 中创建快速模型。您可以将模型的数据作为内联 XML 存储在 XAML 中，或者您可以快速将其转换为 WPF/Silverlight 应用程序并使用 Visual C# Express ( [http://www.microsoft.com/express/ ) 在您的模型后面构建基本业务逻辑vcsharp/](http://www.microsoft.com/express/vcsharp/) ) 或 Visual Studio 2008。

# database - 使用 Drupal 创建在线目录，最好的模块/技术是什么？

> ID：139568
> 
> 赞同：2
> 
> 时间：2008-09-26T13:41:47.120
> 
> 标签：database, drupal, module

我有大量复古游戏机和计算机，我想创建某种目录来使用 Drupal 跟踪它们。我可以将其作为 Drupal 中的一系列页面来完成，但我宁愿采用某种更结构化的方法。

如果我能以某种方式定义由某些字段（制造商、型号、序列号等）组成的记录并填写表格，然后自动处理显示部分，那就太好了。

通过查看各种 Drupal 模块，我觉得我可以做到这一点，但我无法确定要使用哪些模块。看着 CCK 模块，我有点迷失了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T14:22:34.570

仔细看看 CCK 模块，它正是你想要的。

您可以定义记录，然后分配分类法和视图以使其全部工作，只需要您自己的创造力。

CCK 是做这种事情的模块。

此外，此链接可能对预制模块有所帮助。

[http://drupal.org/search/node/type%3Aproject_project+catalog](http://drupal.org/search/node/type%3Aproject_project+catalog)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T20:03:35.757

是的，您需要 CCK，但您也最有可能需要 Views 模块，以便更轻松地控制来自基于 CCK 的节点的数据在特定时间显示的方式和内容。面板可能也不错……这三个是 Drupal 必备的三重奏。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T04:20:26.373

CCK 和 Views 是做到这一点的简单方法，但实际上并不是最好的。我建议构建自己的模块。将会有一个更大的学习曲线，但是您的代码将很容易从一个服务器移动到另一个服务器，运行速度更快，更可定制，并且您最终会更好地理解 Drupal 的工作原理。您不必等待 Views 和 CCK 被移植到新的 Drupal 版本，您将能够贡献您的模块等，等等。

# asp.net-ajax - 如何使用 javascript 以编程方式更改 ASP.NET ajax AccordionPane？

> ID：139578
> 
> 赞同：0
> 
> 时间：2008-09-26T13:44:23.743
> 
> 标签：asp.net-ajax, accordionpane

我有一个 asp.net ajax 风格的 AccordionPane 控件，我试图根据一些用户交互来获取/设置。但是似乎不允许我使用 javascript 执行此操作：

```
function navPanelMove() {  
  var aPane = $get('ctl00_Accordion1_AccordionExtender_ClientState');  
  openPaneID = aPane.get_SelectedIndex();  // doesn't work
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T13:53:21.677

您需要使用**$find('behaviorId')**

您需要**AjaxControlToolkit.AccordionBehavior**对象，而不是 DOM 元素

# algorithm - 平衡分配算法

> ID：139580
> 
> 赞同：6
> 
> 时间：2008-09-26T13:44:38.437
> 
> 标签：algorithm, big-o, load-balancing, cluster-computing

我正在为松散耦合的集群编写一些代码。为了在作业期间实现最佳性能，我让集群在每次孩子进入或退出时重新映射其数据。这最终将成为可选的，但目前它默认执行其数据平衡。我的平衡基本上只是确保每个孩子的文件数量永远不会超过每台机器的平均文件数，再加上一个。如果除法不干净，则加一用于余数。而且由于余数*总是*小于孩子的数量[除了 0 的情况，但我们可以排除这种情况]，平衡后的孩子最多 avg + 1。

一切似乎都很好，直到我意识到我的算法是 O(n!)。顺着孩子的名单往下看，找出平均数，余数，谁有太多，谁有太少。对于太多列表中的每个孩子，遍历列表，发送给每个太少的孩子。

有没有更好的解决方案？我觉得应该有。

编辑：这里有一些伪代码来展示我是如何导出 O(n!) 的：

```
foreach ( child in children ) {
    if ( child.dataLoad > avg + 1 ) {
        foreach ( child2 in children ) {
            if ( child != child2 && child2.dataLoad < avg ) {
                sendLoad(child, child2)
            }
        }
    }
} 
```

编辑：O(n^2)。Foreach n, n => n*n => n^2。我想我今天早上没有喝足够的咖啡！;)

将来我想转向更灵活和有弹性的分布方法[权重和启发式]，但现在，数据的统一分布是可行的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T14:21:28.367

@zvrba：您甚至不必对列表进行排序。第二次遍历列表时，只需将所有平均工作量较少的项目移动到列表的末尾（您可以在第一次遍历时保留指向最后一项的指针）。顺序不必是完美的，它只是在最后一步中必须增加或减少迭代器时发生变化。

[见上一个答案](https://stackoverflow.com/questions/139580/balanced-distribution-algorithm#139656)

最后一步看起来像：

在第二步中，在 child2 中保留一个指向第一个项目的指针，该项目的工作量低于平均工作量（以防止需要有一个双链表）。

```
for each child in list {
  if child2 == nil then assert("Error in logic");
  while child.workload > avg + 1 {
    sendwork(child, child2, min(avg + 1 - child2.workload, child.workload - (avg + 1)))
    if child2.workload == avg + 1 then child2 = child2.next;
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T13:57:34.210

我认为你的分析是不正确的：

*   遍历列表以找出平均值为 O(n)
*   制作具有太多或太少数据块的孩子列表也是 O(n)
*   移动数据与数据量成正比

你是如何到达 O(n!) 的？

您可以对列表 [O(n lg n) in the number of children] 进行排序，这样在前面有工作太多的孩子，最后有工作太少的孩子。然后同时从两端遍历列表：一个迭代器指向一个有多余数据的孩子，另一个指向一个缺乏数据的孩子。传输数据，并向前移动一个迭代器，或向后移动另一个。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T14:42:55.880

您可能想尝试一种完全不同的方法，例如一致哈希。

有关该主题的相对简单介绍，请参见此处： [http ://www8.org/w8-papers/2a-webserver/caching/paper2.html](http://www8.org/w8-papers/2a-webserver/caching/paper2.html)

（也有更深入的论文，从 Karger 等人开始）

我在 Erlang 中创建了一致哈希的工作实现，如果您愿意，可以检查它：

[http://distributerl.googlecode.com/svn/trunk/chash.erl](http://distributerl.googlecode.com/svn/trunk/chash.erl)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T14:34:56.163

您发布的代码复杂度为 O(n^2)。尽管如此，正如 malach 观察到的那样，可以在线性时间内完成，其中 n 是子列表中的项目数。

考虑：内部循环有 n 次迭代，*最多*执行n 次。n*n = n^2。

# asp.net - 在我的开发机器上运行 MS Velocity 是否明智？

> ID：139583
> 
> 赞同：1
> 
> 时间：2008-09-26T13:45:18.017
> 
> 标签：asp.net, session, memory-management, distributed

我从未开发过使用分布式内存的 Web 应用程序。

在我开发时在我的本地计算机上运行诸如 Microsoft [Velocity](http://blogs.msdn.com/velocity/)之类的工具是常见的做法吗？我应该在开发时在另一台服务器上运行 Velocity，还是应该像往常一样开发（默认会话和缓存）并仅在我之后使用 Velocity已部署到我们的开发服务器？

我们在生产 Web 应用程序中遇到了很多内存问题，因此我们正在研究将我们的服务器拆分为一个场。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T14:38:11.303

我也在考虑在一个项目中使用 Velocity。到目前为止，我所做的是编写一个通用的缓存接口和一个利用标准 ASP.NET 缓存系统的简单实现。通过这种方式，我可以针对该接口进行编程，然后通过接口的具体实现插入 Velocity 缓存。您可以使用 Unity 或 Structure Map 等依赖注入框架更轻松地完成此操作。

至于在哪里使用 Velocity，我一定会在上线之前在开发环境中尝试一下。如果您的物理机数量有限，请使用 Virtual PC 设置一些虚拟服务器并在其上安装缓存框架。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T15:37:03.473

啊，这是一些很好的反馈。我正在考虑编写一个通用缓存接口的同样事情，这样我就可以使用 Velocity 切换默认缓存，而无需更改任何代码。

根据[Stephen Walther](http://weblogs.asp.net/stephenwalther/archive/2008/08/27/asp-net-mvc-tip-39-use-the-velocity-distributed-cache.aspx)的一篇文章，他似乎正在本地开发机器上安装 Velocity。所以，这听起来是一个不错的起点。

在他的文章中，我很高兴看到在 Web 服务器中切换 Session 不需要更改代码……它是无缝的；）

今天早上我在[Velocity 的博客](http://blogs.msdn.com/velocity/archive/2008/06/10/creating-multiple-velocity-instances-on-a-single-machine.aspx)上看到了一篇关于在同一台服务器上安装多个速度实例的有趣文章。这样您就不必使用虚拟 PC。

我希望你的项目进展顺利。

# c# - 克隆/深度复制 .NET 通用字典的最佳方法是什么 ?

> ID：139592
> 
> 赞同：243
> 
> 时间：2008-09-26T13:46:51.240
> 
> 标签：c#, generics, collections, clone

我有一本通用字典`Dictionary<string, T>`，我想从本质上制作一个 Clone() of ..any 建议。

* * *

## 回答 #1

> 赞同：246
> 
> 时间：2008-09-26T13:53:05.577

（注意：虽然克隆版本可能有用，但对于简单的浅拷贝，我在另一篇文章中提到的构造函数是更好的选择。）

您希望副本有多深，以及您使用的是什么版本的 .NET？如果您使用.NET 3.5，我怀疑对 ToDictionary 的 LINQ 调用（同时指定键和元素选择器）将是最简单的方法。

例如，如果您不介意该值是浅克隆：

```
var newDictionary = oldDictionary.ToDictionary(entry => entry.Key,
                                               entry => entry.Value); 
```

如果您已经约束 T 来实现 ICloneable：

```
var newDictionary = oldDictionary.ToDictionary(entry => entry.Key, 
                                               entry => (T) entry.Value.Clone()); 
```

（这些未经测试，但应该可以工作。）

* * *

## 回答 #2

> 赞同：199
> 
> 时间：2008-09-26T14:22:46.147

好的，.NET 2.0 的答案：

如果您不需要克隆值，则可以使用构造函数重载到 Dictionary，它采用现有的 IDictionary。（您也可以将比较器指定为现有字典的比较器。）

如果您*确实*需要克隆这些值，您可以使用如下内容：

```
public static Dictionary<TKey, TValue> CloneDictionaryCloningValues<TKey, TValue>
   (Dictionary<TKey, TValue> original) where TValue : ICloneable
{
    Dictionary<TKey, TValue> ret = new Dictionary<TKey, TValue>(original.Count,
                                                            original.Comparer);
    foreach (KeyValuePair<TKey, TValue> entry in original)
    {
        ret.Add(entry.Key, (TValue) entry.Value.Clone());
    }
    return ret;
} 
```

当然，这也依赖于`TValue.Clone()`适当的深度克隆。

* * *

## 回答 #3

> 赞同：103
> 
> 时间：2010-11-24T10:51:19.750

```
Dictionary<string, int> dictionary = new Dictionary<string, int>();

Dictionary<string, int> copy = new Dictionary<string, int>(dictionary); 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2020-05-10T05:58:40.050

当我尝试深度复制 Dictionary < string, string > 时，这对我有帮助

```
Dictionary<string, string> dict2 = new Dictionary<string, string>(dict); 
```

祝你好运

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-09-26T15:09:44.100

对于 .NET 2.0，您可以实现一个继承自`Dictionary`并实现`ICloneable`.

```
public class CloneableDictionary<TKey, TValue> : Dictionary<TKey, TValue> where TValue : ICloneable
{
    public IDictionary<TKey, TValue> Clone()
    {
        CloneableDictionary<TKey, TValue> clone = new CloneableDictionary<TKey, TValue>();

        foreach (KeyValuePair<TKey, TValue> pair in this)
        {
            clone.Add(pair.Key, (TValue)pair.Value.Clone());
        }

        return clone;
    }
} 
```

然后，您可以简单地通过调用该`Clone`方法来克隆字典。当然，这个实现需要字典的值类型 implements `ICloneable`，否则泛型实现根本不实用。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2018-03-22T13:33:58.170

这对我来说很好

```
 // assuming this fills the List
 List<Dictionary<string, string>> obj = this.getData(); 

 List<Dictionary<string, string>> objCopy = new List<Dictionary<string, string>>(obj); 
```

正如 Tomer Wolberg 在评论中所描述的，如果值类型是可变类，这将不起作用。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-26T15:35:44.100

你总是可以使用序列化。您可以序列化对象然后反序列化它。这将为您提供字典的深层副本以及其中的所有项目。现在，您可以创建任何标记为 [Serializable] 的对象的深层副本，而无需编写任何特殊代码。

这里有两种将使用二进制序列化的方法。如果您使用这些方法，您只需调用

```
object deepcopy = FromBinary(ToBinary(yourDictionary));

public Byte[] ToBinary()
{
  MemoryStream ms = null;
  Byte[] byteArray = null;
  try
  {
    BinaryFormatter serializer = new BinaryFormatter();
    ms = new MemoryStream();
    serializer.Serialize(ms, this);
    byteArray = ms.ToArray();
  }
  catch (Exception unexpected)
  {
    Trace.Fail(unexpected.Message);
    throw;
  }
  finally
  {
    if (ms != null)
      ms.Close();
  }
  return byteArray;
}

public object FromBinary(Byte[] buffer)
{
  MemoryStream ms = null;
  object deserializedObject = null;

  try
  {
    BinaryFormatter serializer = new BinaryFormatter();
    ms = new MemoryStream();
    ms.Write(buffer, 0, buffer.Length);
    ms.Position = 0;
    deserializedObject = serializer.Deserialize(ms);
  }
  finally
  {
    if (ms != null)
      ms.Close();
  }
  return deserializedObject;
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2015-09-08T07:15:47.257

对我来说最好的方法是：

```
Dictionary<int, int> copy= new Dictionary<int, int>(yourListOrDictionary); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-09-30T16:07:58.447

二进制序列化方法工作正常，但在我的测试中，它显示比克隆的非序列化实现慢 10 倍。测试过`Dictionary<string , List<double>>`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-08-23T19:13:00.637

如果键/值是 ICloneable，请尝试此操作：

```
 public static Dictionary<K,V> CloneDictionary<K,V>(Dictionary<K,V> dict) where K : ICloneable where V : ICloneable
    {
        Dictionary<K, V> newDict = null;

        if (dict != null)
        {
            // If the key and value are value types, just use copy constructor.
            if (((typeof(K).IsValueType || typeof(K) == typeof(string)) &&
                 (typeof(V).IsValueType) || typeof(V) == typeof(string)))
            {
                newDict = new Dictionary<K, V>(dict);
            }
            else // prepare to clone key or value or both
            {
                newDict = new Dictionary<K, V>();

                foreach (KeyValuePair<K, V> kvp in dict)
                {
                    K key;
                    if (typeof(K).IsValueType || typeof(K) == typeof(string))
                    {
                        key = kvp.Key;
                    }
                    else
                    {
                        key = (K)kvp.Key.Clone();
                    }
                    V value;
                    if (typeof(V).IsValueType || typeof(V) == typeof(string))
                    {
                        value = kvp.Value;
                    }
                    else
                    {
                        value = (V)kvp.Value.Clone();
                    }

                    newDict[key] = value;
                }
            }
        }

        return newDict;
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-10-14T14:00:05.900

如果您有一个“对象”字典，并且对象可以是任何类似（double、int、...或 ComplexClass）：

```
Dictionary<string, object> dictSrc { get; set; }

public class ComplexClass : ICloneable
{

    private Point3D ...;
    private Vector3D ....;
    [...]

    public object Clone()
    {
        ComplexClass clone = new ComplexClass();
        clone = (ComplexClass)this.MemberwiseClone();
        return clone;
    }

}

dictSrc["toto"] = new ComplexClass()
dictSrc["tata"] = 12.3
...

dictDest = dictSrc.ToDictionary(entry => entry.Key,
                                entry => ((entry.Value is ICloneable) ? (entry.Value as ICloneable).Clone() : entry.Value) ); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-10-13T15:23:36.753

这是一些真正的“真正的深度复制”，不知道类型和一些递归遍历，对初学者有好处。它适用于嵌套类型和我认为几乎所有棘手的类型。我还没有添加嵌套数组处理，但您可以根据自己的选择进行修改。

```
Dictionary<string, Dictionary<string, dynamic>> buildInfoDict =
    new Dictionary<string, Dictionary<string, dynamic>>()
    {
        {"tag",new Dictionary<string,dynamic>(){
                 { "attrName", "tag"  },
                 { "isCss", "False"  },
               { "turnedOn","True" },
                 { "tag",null }
            } },
        {"id",new Dictionary<string,dynamic>(){
                 { "attrName", "id"  },
                 { "isCss", "False"  },
               { "turnedOn","True" },
                 { "id",null }
            } },
                {"width",new Dictionary<string,dynamic>(){
                 { "attrName", "width"  },
                 { "isCss", "True"  },
               { "turnedOn","True" },
                 { "width","20%" }
            } },
                {"height",new Dictionary<string,dynamic>(){
                 { "attrName", "height"  },
                 { "isCss", "True"  },
               { "turnedOn","True" },
                 { "height","20%" }
            } },
                {"text",new Dictionary<string,dynamic>(){
                 { "attrName", null  },
                 { "isCss", "False"  },
               { "turnedOn","True" },
                 { "text","" }
            } },
                {"href",new Dictionary<string,dynamic>(){
                 { "attrName", null  },
                 { "isCss", "False"  },
                 { "flags", "removeAttrIfTurnedOff"  },
               { "turnedOn","True" },
                 { "href","about:blank" }
            } }
    };

var cln=clone(buildInfoDict);

public static dynamic clone(dynamic obj)
{
    dynamic cloneObj = null;
    if (IsAssignableFrom(obj, typeof(IDictionary)))
    {
        cloneObj = Activator.CreateInstance(obj.GetType());
        foreach (var key in obj.Keys)
        {
            cloneObj[key] = clone(obj[key]);
        }

    }
    else if (IsNumber(obj) || obj.GetType() == typeof(string))
    {
        cloneObj = obj;
    }
    else
    {
        Debugger.Break();
    }
    return cloneObj;
}

public static bool IsAssignableFrom(this object obj, Type ObjType = null, Type ListType = null, bool HandleBaseTypes = false)
{
    if (ObjType == null)
    {
        ObjType = obj.GetType();
    }

    bool Res;

    do
    {
        Res = (ObjType.IsGenericType && ObjType.GetGenericTypeDefinition().IsAssignableFrom(ListType)) ||
            (ListType == null && ObjType.IsAssignableFrom(obj.GetType()));
        ObjType = ObjType.BaseType;
    } while ((!Res && ObjType != null) && HandleBaseTypes && ObjType != typeof(object));

    return Res;
}

public static bool IsNumber(this object value)
{
    return value is sbyte
            || value is byte
            || value is short
            || value is ushort
            || value is int
            || value is uint
            || value is long
            || value is ulong
            || value is float
            || value is double
            || value is decimal;
} 
```

# c# - ProcessStartInfo 挂在“WaitForExit”上？为什么？

> ID：139593
> 
> 赞同：210
> 
> 时间：2008-09-26T13:46:56.390
> 
> 标签：c#, processstartinfo

我有以下代码：

```
info = new System.Diagnostics.ProcessStartInfo("TheProgram.exe", String.Join(" ", args));
info.CreateNoWindow = true;
info.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
info.RedirectStandardOutput = true;
info.UseShellExecute = false;
System.Diagnostics.Process p = System.Diagnostics.Process.Start(info);
p.WaitForExit();
Console.WriteLine(p.StandardOutput.ReadToEnd()); //need the StandardOutput contents 
```

我知道我开始的过程的输出大约是 7MB 长。在 Windows 控制台中运行它可以正常工作。不幸的是，以编程方式，这无限期地挂在`WaitForExit`. 另请注意，此代码不会因较小的输出（如 3KB）而挂起。

`StandardOutput`是否有可能内部`ProcessStartInfo`无法缓冲 7MB？如果是这样，我应该怎么做？如果没有，我做错了什么？

* * *

## 回答 #1

> 赞同：442
> 
> 时间：2011-09-30T10:05:02.207

问题是，如果您重定向`StandardOutput`和/或`StandardError`内部缓冲区可能已满。无论您使用什么顺序，都可能存在问题：

*   如果您在读取进程之前等待进程退出，`StandardOutput`则可能会阻止尝试对其进行写入，因此该进程永远不会结束。
*   如果您从`StandardOutput`使用 ReadToEnd 读取，那么如果进程永远不会关闭（例如，如果它永远不会终止，或者如果它被阻止写入），*您的*进程可能会阻塞。`StandardOutput``StandardError`

解决方案是使用异步读取来确保缓冲区不会变满。为了避免任何死锁并收集两者的所有输出`StandardOutput`，`StandardError`您可以这样做：

编辑：如果发生超时，请参阅下面的答案以了解如何避免**ObjectDisposedException 。**

```
using (Process process = new Process())
{
    process.StartInfo.FileName = filename;
    process.StartInfo.Arguments = arguments;
    process.StartInfo.UseShellExecute = false;
    process.StartInfo.RedirectStandardOutput = true;
    process.StartInfo.RedirectStandardError = true;

    StringBuilder output = new StringBuilder();
    StringBuilder error = new StringBuilder();

    using (AutoResetEvent outputWaitHandle = new AutoResetEvent(false))
    using (AutoResetEvent errorWaitHandle = new AutoResetEvent(false))
    {
        process.OutputDataReceived += (sender, e) => {
            if (e.Data == null)
            {
                outputWaitHandle.Set();
            }
            else
            {
                output.AppendLine(e.Data);
            }
        };
        process.ErrorDataReceived += (sender, e) =>
        {
            if (e.Data == null)
            {
                errorWaitHandle.Set();
            }
            else
            {
                error.AppendLine(e.Data);
            }
        };

        process.Start();

        process.BeginOutputReadLine();
        process.BeginErrorReadLine();

        if (process.WaitForExit(timeout) &&
            outputWaitHandle.WaitOne(timeout) &&
            errorWaitHandle.WaitOne(timeout))
        {
            // Process completed. Check process.ExitCode here.
        }
        else
        {
            // Timed out.
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：108
> 
> 时间：2008-09-26T13:49:43.590

[文档](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.standardoutput.aspx)说在你等待之前阅读，`Process.StandardOutput`否则你可能会死锁，片段复制如下：

```
 // Start the child process.
 Process p = new Process();
 // Redirect the output stream of the child process.
 p.StartInfo.UseShellExecute = false;
 p.StartInfo.RedirectStandardOutput = true;
 p.StartInfo.FileName = "Write500Lines.exe";
 p.Start();
 // Do not wait for the child process to exit before
 // reading to the end of its redirected stream.
 // p.WaitForExit();
 // Read the output stream first and then wait.
 string output = p.StandardOutput.ReadToEnd();
 p.WaitForExit(); 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2016-10-05T10:54:13.897

这是一个更现代的等待，基于任务并行库 (TPL) 的解决方案，适用于 .NET 4.5 及更高版本。

# 使用示例

```
try
{
    var exitCode = await StartProcess(
        "dotnet", 
        "--version", 
        @"C:\",
        10000, 
        Console.Out, 
        Console.Out);
    Console.WriteLine($"Process Exited with Exit Code {exitCode}!");
}
catch (TaskCanceledException)
{
    Console.WriteLine("Process Timed Out!");
} 
```

# 执行

```
public static async Task<int> StartProcess(
    string filename,
    string arguments,
    string workingDirectory= null,
    int? timeout = null,
    TextWriter outputTextWriter = null,
    TextWriter errorTextWriter = null)
{
    using (var process = new Process()
    {
        StartInfo = new ProcessStartInfo()
        {
            CreateNoWindow = true,
            Arguments = arguments,
            FileName = filename,
            RedirectStandardOutput = outputTextWriter != null,
            RedirectStandardError = errorTextWriter != null,
            UseShellExecute = false,
            WorkingDirectory = workingDirectory
        }
    })
    {
        var cancellationTokenSource = timeout.HasValue ?
            new CancellationTokenSource(timeout.Value) :
            new CancellationTokenSource();

        process.Start();

        var tasks = new List<Task>(3) { process.WaitForExitAsync(cancellationTokenSource.Token) };
        if (outputTextWriter != null)
        {
            tasks.Add(ReadAsync(
                x =>
                {
                    process.OutputDataReceived += x;
                    process.BeginOutputReadLine();
                },
                x => process.OutputDataReceived -= x,
                outputTextWriter,
                cancellationTokenSource.Token));
        }

        if (errorTextWriter != null)
        {
            tasks.Add(ReadAsync(
                x =>
                {
                    process.ErrorDataReceived += x;
                    process.BeginErrorReadLine();
                },
                x => process.ErrorDataReceived -= x,
                errorTextWriter,
                cancellationTokenSource.Token));
        }

        await Task.WhenAll(tasks);
        return process.ExitCode;
    }
}

/// <summary>
/// Waits asynchronously for the process to exit.
/// </summary>
/// <param name="process">The process to wait for cancellation.</param>
/// <param name="cancellationToken">A cancellation token. If invoked, the task will return
/// immediately as cancelled.</param>
/// <returns>A Task representing waiting for the process to end.</returns>
public static Task WaitForExitAsync(
    this Process process,
    CancellationToken cancellationToken = default(CancellationToken))
{
    process.EnableRaisingEvents = true;

    var taskCompletionSource = new TaskCompletionSource<object>();

    EventHandler handler = null;
    handler = (sender, args) =>
    {
        process.Exited -= handler;
        taskCompletionSource.TrySetResult(null);
    };
    process.Exited += handler;

    if (cancellationToken != default(CancellationToken))
    {
        cancellationToken.Register(
            () =>
            {
                process.Exited -= handler;
                taskCompletionSource.TrySetCanceled();
            });
    }

    return taskCompletionSource.Task;
}

/// <summary>
/// Reads the data from the specified data recieved event and writes it to the
/// <paramref name="textWriter"/>.
/// </summary>
/// <param name="addHandler">Adds the event handler.</param>
/// <param name="removeHandler">Removes the event handler.</param>
/// <param name="textWriter">The text writer.</param>
/// <param name="cancellationToken">The cancellation token.</param>
/// <returns>A task representing the asynchronous operation.</returns>
public static Task ReadAsync(
    this Action<DataReceivedEventHandler> addHandler,
    Action<DataReceivedEventHandler> removeHandler,
    TextWriter textWriter,
    CancellationToken cancellationToken = default(CancellationToken))
{
    var taskCompletionSource = new TaskCompletionSource<object>();

    DataReceivedEventHandler handler = null;
    handler = new DataReceivedEventHandler(
        (sender, e) =>
        {
            if (e.Data == null)
            {
                removeHandler(handler);
                taskCompletionSource.TrySetResult(null);
            }
            else
            {
                textWriter.WriteLine(e.Data);
            }
        });

    addHandler(handler);

    if (cancellationToken != default(CancellationToken))
    {
        cancellationToken.Register(
            () =>
            {
                removeHandler(handler);
                taskCompletionSource.TrySetCanceled();
            });
    }

    return taskCompletionSource.Task;
} 
```

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2012-04-10T10:23:24.353

Mark Byers 的回答非常好，但我只想添加以下内容：

`OutputDataReceived`和代表需要在和处理`ErrorDataReceived`之前被删除。如果进程在超时后继续输出数据然后终止，则和变量将在被释放后被访问。`outputWaitHandle``errorWaitHandle``outputWaitHandle``errorWaitHandle`

（仅供参考，我不得不添加这个警告作为答案，因为我无法评论他的帖子。）

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2014-04-09T08:30:55.953

进程超时时会发生未处理的 ObjectDisposedException 的问题。在这种情况下，条件的其他部分：

```
if (process.WaitForExit(timeout) 
    && outputWaitHandle.WaitOne(timeout) 
    && errorWaitHandle.WaitOne(timeout)) 
```

不被执行。我通过以下方式解决了这个问题：

```
using (AutoResetEvent outputWaitHandle = new AutoResetEvent(false))
using (AutoResetEvent errorWaitHandle = new AutoResetEvent(false))
{
    using (Process process = new Process())
    {
        // preparing ProcessStartInfo

        try
        {
            process.OutputDataReceived += (sender, e) =>
                {
                    if (e.Data == null)
                    {
                        outputWaitHandle.Set();
                    }
                    else
                    {
                        outputBuilder.AppendLine(e.Data);
                    }
                };
            process.ErrorDataReceived += (sender, e) =>
                {
                    if (e.Data == null)
                    {
                        errorWaitHandle.Set();
                    }
                    else
                    {
                        errorBuilder.AppendLine(e.Data);
                    }
                };

            process.Start();

            process.BeginOutputReadLine();
            process.BeginErrorReadLine();

            if (process.WaitForExit(timeout))
            {
                exitCode = process.ExitCode;
            }
            else
            {
                // timed out
            }

            output = outputBuilder.ToString();
        }
        finally
        {
            outputWaitHandle.WaitOne(timeout);
            errorWaitHandle.WaitOne(timeout);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2016-01-08T22:39:33.890

Rob 回答了它，并为我节省了几个小时的试验时间。在等待之前读取输出/错误缓冲区：

```
// Read the output stream first and then wait.
string output = p.StandardOutput.ReadToEnd();
p.WaitForExit(); 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-26T13:57:19.563

我们也有这个问题（或变体）。

尝试以下操作：

1) 为 p.WaitForExit(nnnn) 添加超时时间；其中 nnnn 以毫秒为单位。

2) 将 ReadToEnd 调用放在 WaitForExit 调用之前。这*是*我们看到的 MS 推荐的。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-11-10T00:33:20.827

[归功于](https://stackoverflow.com/users/1536933/em0 "EM0")[https://stackoverflow.com/a/17600012/4151626](https://stackoverflow.com/a/17600012/4151626)的EM0

由于内部超时以及衍生的应用程序同时使用 StandardOutput 和 StandardError，其他解决方案（包括 EM0 的）对于我的应用程序仍然死锁。这对我有用：

```
Process p = new Process()
{
  StartInfo = new ProcessStartInfo()
  {
    FileName = exe,
    Arguments = args,
    UseShellExecute = false,
    RedirectStandardOutput = true,
    RedirectStandardError = true
  }
};
p.Start();

string cv_error = null;
Thread et = new Thread(() => { cv_error = p.StandardError.ReadToEnd(); });
et.Start();

string cv_out = null;
Thread ot = new Thread(() => { cv_out = p.StandardOutput.ReadToEnd(); });
ot.Start();

p.WaitForExit();
ot.Join();
et.Join(); 
```

编辑：将 StartInfo 的初始化添加到代码示例

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-09-08T11:53:23.667

我是这样解决的：

```
 Process proc = new Process();
            proc.StartInfo.FileName = batchFile;
            proc.StartInfo.UseShellExecute = false;
            proc.StartInfo.CreateNoWindow = true;
            proc.StartInfo.RedirectStandardError = true;
            proc.StartInfo.RedirectStandardInput = true;
            proc.StartInfo.RedirectStandardOutput = true;
            proc.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;      
            proc.Start();
            StreamWriter streamWriter = proc.StandardInput;
            StreamReader outputReader = proc.StandardOutput;
            StreamReader errorReader = proc.StandardError;
            while (!outputReader.EndOfStream)
            {
                string text = outputReader.ReadLine();                    
                streamWriter.WriteLine(text);
            }

            while (!errorReader.EndOfStream)
            {                   
                string text = errorReader.ReadLine();
                streamWriter.WriteLine(text);
            }

            streamWriter.Close();
            proc.WaitForExit(); 
```

我重定向了输入、输出和错误，并处理了输出和错误流的读取。此解决方案适用于 SDK 7-8.1，适用于 Windows 7 和 Windows 8

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-01-18T15:09:01.303

通过考虑 Mark Byers、Rob、stevejay 的答案，我尝试创建一个使用异步流读取来解决您的问题的课程。这样做我意识到有一个与异步进程输出流读取相关的错误。

我在微软报告了这个错误：[https ://connect.microsoft.com/VisualStudio/feedback/details/3119134](https://connect.microsoft.com/VisualStudio/feedback/details/3119134)

概括：

> 你不能这样做：
> 
> process.BeginOutputReadLine(); 进程.开始（）；
> 
> 您将收到 System.InvalidOperationException : StandardOut 尚未重定向或进程尚未开始。
> 
> ==================================================== ==================================================== =========================
> 
> 然后你必须在进程启动后启动异步输出读取：
> 
> 进程.开始（）；process.BeginOutputReadLine();
> 
> 这样做，因为输出流可以在将其设置为异步之前接收数据，所以设置竞争条件：

```
process.Start(); 
// Here the operating system could give the cpu to another thread.  
// For example, the newly created thread (Process) and it could start writing to the output
// immediately before next line would execute. 
// That create a race condition.
process.BeginOutputReadLine(); 
```

> ==================================================== ==================================================== =========================
> 
> 然后有些人可能会说你只需要在将流设置为异步之前读取它。但同样的问题也会发生。在同步读取和将流设置为异步模式之间会有竞争条件。
> 
> ==================================================== ==================================================== =========================
> 
> 没有办法以“Process”和“ProcessStartInfo”的实际设计方式实现对进程输出流的安全异步读取。

您可能最好使用其他用户针对您的案例建议的异步读取。但是您应该知道，由于比赛条件，您可能会错过一些信息。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-06-14T14:29:43.550

我认为这是简单且更好的方法（我们不需要`AutoResetEvent`）：

```
public static string GGSCIShell(string Path, string Command)
{
    using (Process process = new Process())
    {
        process.StartInfo.WorkingDirectory = Path;
        process.StartInfo.FileName = Path + @"\ggsci.exe";
        process.StartInfo.CreateNoWindow = true;
        process.StartInfo.RedirectStandardOutput = true;
        process.StartInfo.RedirectStandardInput = true;
        process.StartInfo.UseShellExecute = false;

        StringBuilder output = new StringBuilder();
        process.OutputDataReceived += (sender, e) =>
        {
            if (e.Data != null)
            {
                output.AppendLine(e.Data);
            }
        };

        process.Start();
        process.StandardInput.WriteLine(Command);
        process.BeginOutputReadLine();

        int timeoutParts = 10;
        int timeoutPart = (int)TIMEOUT / timeoutParts;
        do
        {
            Thread.Sleep(500);//sometimes halv scond is enough to empty output buff (therefore "exit" will be accepted without "timeoutPart" waiting)
            process.StandardInput.WriteLine("exit");
            timeoutParts--;
        }
        while (!process.WaitForExit(timeoutPart) && timeoutParts > 0);

        if (timeoutParts <= 0)
        {
            output.AppendLine("------ GGSCIShell TIMEOUT: " + TIMEOUT + "ms ------");
        }

        string result = output.ToString();
        return result;
    }
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-02-09T15:32:50.767

上面的答案都没有完成这项工作。

Rob 解决方案挂起，“Mark Byers”解决方案得到处理的异常。（我尝试了其他答案的“解决方案”）。

所以我决定提出另一种解决方案：

```
public void GetProcessOutputWithTimeout(Process process, int timeoutSec, CancellationToken token, out string output, out int exitCode)
{
    string outputLocal = "";  int localExitCode = -1;
    var task = System.Threading.Tasks.Task.Factory.StartNew(() =>
    {
        outputLocal = process.StandardOutput.ReadToEnd();
        process.WaitForExit();
        localExitCode = process.ExitCode;
    }, token);

    if (task.Wait(timeoutSec, token))
    {
        output = outputLocal;
        exitCode = localExitCode;
    }
    else
    {
        exitCode = -1;
        output = "";
    }
}

using (var process = new Process())
{
    process.StartInfo = ...;
    process.Start();
    string outputUnicode; int exitCode;
    GetProcessOutputWithTimeout(process, PROCESS_TIMEOUT, out outputUnicode, out exitCode);
} 
```

这段代码经过调试并且运行良好。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-04-04T15:31:01.047

## 介绍

当前接受的答案不起作用（抛出异常）并且有太多变通方法但没有完整的代码。这显然是在浪费很多人的时间，因为这是一个流行的问题。

结合 Mark Byers 的回答和 Karol Tyl 的回答，我根据我想如何使用 Process.Start 方法编写了完整的代码。

## 用法

我用它来创建围绕 git 命令的进度对话框。这就是我使用它的方式：

```
 private bool Run(string fullCommand)
    {
        Error = "";
        int timeout = 5000;

        var result = ProcessNoBS.Start(
            filename: @"C:\Program Files\Git\cmd\git.exe",
            arguments: fullCommand,
            timeoutInMs: timeout,
            workingDir: @"C:\test");

        if (result.hasTimedOut)
        {
            Error = String.Format("Timeout ({0} sec)", timeout/1000);
            return false;
        }

        if (result.ExitCode != 0)
        {
            Error = (String.IsNullOrWhiteSpace(result.stderr)) 
                ? result.stdout : result.stderr;
            return false;
        }

        return true;
    } 
```

理论上你也可以结合标准输出和标准错误，但我还没有测试过。

## 代码

```
public struct ProcessResult
{
    public string stdout;
    public string stderr;
    public bool hasTimedOut;
    private int? exitCode;

    public ProcessResult(bool hasTimedOut = true)
    {
        this.hasTimedOut = hasTimedOut;
        stdout = null;
        stderr = null;
        exitCode = null;
    }

    public int ExitCode
    {
        get 
        {
            if (hasTimedOut)
                throw new InvalidOperationException(
                    "There was no exit code - process has timed out.");

            return (int)exitCode;
        }
        set
        {
            exitCode = value;
        }
    }
}

public class ProcessNoBS
{
    public static ProcessResult Start(string filename, string arguments,
        string workingDir = null, int timeoutInMs = 5000,
        bool combineStdoutAndStderr = false)
    {
        using (AutoResetEvent outputWaitHandle = new AutoResetEvent(false))
        using (AutoResetEvent errorWaitHandle = new AutoResetEvent(false))
        {
            using (var process = new Process())
            {
                var info = new ProcessStartInfo();

                info.CreateNoWindow = true;
                info.FileName = filename;
                info.Arguments = arguments;
                info.UseShellExecute = false;
                info.RedirectStandardOutput = true;
                info.RedirectStandardError = true;

                if (workingDir != null)
                    info.WorkingDirectory = workingDir;

                process.StartInfo = info;

                StringBuilder stdout = new StringBuilder();
                StringBuilder stderr = combineStdoutAndStderr
                    ? stdout : new StringBuilder();

                var result = new ProcessResult();

                try
                {
                    process.OutputDataReceived += (sender, e) =>
                    {
                        if (e.Data == null)
                            outputWaitHandle.Set();
                        else
                            stdout.AppendLine(e.Data);
                    };
                    process.ErrorDataReceived += (sender, e) =>
                    {
                        if (e.Data == null)
                            errorWaitHandle.Set();
                        else
                            stderr.AppendLine(e.Data);
                    };

                    process.Start();

                    process.BeginOutputReadLine();
                    process.BeginErrorReadLine();

                    if (process.WaitForExit(timeoutInMs))
                        result.ExitCode = process.ExitCode;
                    // else process has timed out 
                    // but that's already default ProcessResult

                    result.stdout = stdout.ToString();
                    if (combineStdoutAndStderr)
                        result.stderr = null;
                    else
                        result.stderr = stderr.ToString();

                    return result;
                }
                finally
                {
                    outputWaitHandle.WaitOne(timeoutInMs);
                    errorWaitHandle.WaitOne(timeoutInMs);
                }
            }
        }
    }
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-06-08T07:02:16.283

我知道这已经过时了，但是在阅读了整个页面之后，没有一个解决方案对我有用，尽管我没有尝试 Muhammad Rehan，因为代码有点难以理解，尽管我猜他是在正确的轨道上. 当我说它不起作用时，这并不完全正确，有时它会正常工作，我想这与 EOF 标记之前的输出长度有关。

无论如何，对我有用的解决方案是使用不同的线程来读取 StandardOutput 和 StandardError 并写入消息。

```
 StreamWriter sw = null;
        var queue = new ConcurrentQueue<string>();

        var flushTask = new System.Timers.Timer(50);
        flushTask.Elapsed += (s, e) =>
        {
            while (!queue.IsEmpty)
            {
                string line = null;
                if (queue.TryDequeue(out line))
                    sw.WriteLine(line);
            }
            sw.FlushAsync();
        };
        flushTask.Start();

        using (var process = new Process())
        {
            try
            {
                process.StartInfo.FileName = @"...";
                process.StartInfo.Arguments = $"...";
                process.StartInfo.UseShellExecute = false;
                process.StartInfo.RedirectStandardOutput = true;
                process.StartInfo.RedirectStandardError = true;

                process.Start();

                var outputRead = Task.Run(() =>
                {
                    while (!process.StandardOutput.EndOfStream)
                    {
                        queue.Enqueue(process.StandardOutput.ReadLine());
                    }
                });

                var errorRead = Task.Run(() =>
                {
                    while (!process.StandardError.EndOfStream)
                    {
                        queue.Enqueue(process.StandardError.ReadLine());
                    }
                });

                var timeout = new TimeSpan(hours: 0, minutes: 10, seconds: 0);

                if (Task.WaitAll(new[] { outputRead, errorRead }, timeout) &&
                    process.WaitForExit((int)timeout.TotalMilliseconds))
                {
                    if (process.ExitCode != 0)
                    {
                        throw new Exception($"Failed run... blah blah");
                    }
                }
                else
                {
                    throw new Exception($"process timed out after waiting {timeout}");
                }
            }
            catch (Exception e)
            {
                throw new Exception($"Failed to succesfully run the process.....", e);
            }
        }
    } 
```

希望这对那些认为这可能很难的人有所帮助！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-02-01T14:19:04.517

在阅读了这里的所有帖子后，我选择了 Marko Avlijaš 的综合解决方案。 **但是**，它并没有解决我所有的问题。

在我们的环境中，我们有一个 Windows 服务，它计划运行数百个不同的 .bat .cmd .exe 等文件，这些文件是多年来积累的，由许多不同的人以不同的风格编写的。我们无法控制程序和脚本的编写，我们只负责安排、运行和报告成功/失败。

所以我在这里尝试了几乎所有的建议，并取得了不同程度的成功。Marko 的回答几乎是完美的，但是当作为服务运行时，它并不总是捕获标准输出。我从来没有深究为什么不。

我们发现在所有情况下都有效的唯一解决方案是：[http ://csharptest.net/319/using-the-processrunner-class/index.html](http://csharptest.net/319/using-the-processrunner-class/index.html)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-06-07T08:32:21.893

我最终使用的解决方法来避免所有复杂性：

```
var outputFile = Path.GetTempFileName();
info = new System.Diagnostics.ProcessStartInfo("TheProgram.exe", String.Join(" ", args) + " > " + outputFile + " 2>&1");
info.CreateNoWindow = true;
info.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
info.UseShellExecute = false;
System.Diagnostics.Process p = System.Diagnostics.Process.Start(info);
p.WaitForExit();
Console.WriteLine(File.ReadAllText(outputFile)); //need the StandardOutput contents 
```

所以我创建了一个临时文件，通过使用将输出和错误重定向到它 `> outputfile > 2>&1`，然后在过程完成后读取文件。

其他解决方案适用于您想要对输出执行其他操作的场景，但对于简单的事情，这避免了很多复杂性。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-09-15T01:11:30.023

我已经阅读了很多答案，并做出了自己的答案。不确定这个是否会在任何情况下修复，但它可以在我的环境中修复。我只是不使用 WaitForExit 并在输出和错误结束信号上使用 WaitHandle.WaitAll 。如果有人会看到可能存在的问题，我会很高兴。或者如果它会帮助某人。对我来说更好，因为不使用超时。

```
private static int DoProcess(string workingDir, string fileName, string arguments)
{
    int exitCode;
    using (var process = new Process
    {
        StartInfo =
        {
            WorkingDirectory = workingDir,
            WindowStyle = ProcessWindowStyle.Hidden,
            CreateNoWindow = true,
            UseShellExecute = false,
            FileName = fileName,
            Arguments = arguments,
            RedirectStandardError = true,
            RedirectStandardOutput = true
        },
        EnableRaisingEvents = true
    })
    {
        using (var outputWaitHandle = new AutoResetEvent(false))
        using (var errorWaitHandle = new AutoResetEvent(false))
        {
            process.OutputDataReceived += (sender, args) =>
            {
                // ReSharper disable once AccessToDisposedClosure
                if (args.Data != null) Debug.Log(args.Data);
                else outputWaitHandle.Set();
            };
            process.ErrorDataReceived += (sender, args) =>
            {
                // ReSharper disable once AccessToDisposedClosure
                if (args.Data != null) Debug.LogError(args.Data);
                else errorWaitHandle.Set();
            };

            process.Start();
            process.BeginOutputReadLine();
            process.BeginErrorReadLine();

            WaitHandle.WaitAll(new WaitHandle[] { outputWaitHandle, errorWaitHandle });

            exitCode = process.ExitCode;
        }
    }
    return exitCode;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-11-27T17:06:09.590

我认为使用异步，即使同时使用标准输出和标准错误，也可以有一个更优雅的解决方案并且不会出现死锁：

```
using (Process process = new Process())
{
    process.StartInfo.FileName = filename;
    process.StartInfo.Arguments = arguments;
    process.StartInfo.UseShellExecute = false;
    process.StartInfo.RedirectStandardOutput = true;
    process.StartInfo.RedirectStandardError = true;

    process.Start();

    var tStandardOutput = process.StandardOutput.ReadToEndAsync();
    var tStandardError = process.StandardError.ReadToEndAsync();

    if (process.WaitForExit(timeout))
    {
        string output = await tStandardOutput;
        string errors = await tStandardError;

        // Process completed. Check process.ExitCode here.
    }
    else
    {
        // Timed out.
    }
} 
```

它基于 Mark Byers 的回答。如果您不在异步方法中，则可以使用`string output = tStandardOutput.result;`代替`await`

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2011-03-26T08:28:29.087

这篇文章可能已经过时，但我发现它通常挂起的主要原因是由于 redirectStandardoutput 的堆栈溢出或者您有 redirectStandarderror。

由于输出数据或错误数据较大，将导致挂起时间，因为它仍在无限期处理。

所以要解决这个问题：

```
p.StartInfo.RedirectStandardoutput = False
p.StartInfo.RedirectStandarderror = False 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2019-01-15T00:13:25.627

让我们将此处发布的示例代码称为重定向器，并将其他程序称为重定向。如果是我，那么我可能会编写一个可用于复制问题的测试重定向程序。

所以我做了。对于测试数据，我使用了 ECMA-334 C# Language Specificationv PDF；它大约是 5MB。以下是其中的重要部分。

```
StreamReader stream = null;
try { stream = new StreamReader(Path); }
catch (Exception ex)
{
    Console.Error.WriteLine("Input open error: " + ex.Message);
    return;
}
Console.SetIn(stream);
int datasize = 0;
try
{
    string record = Console.ReadLine();
    while (record != null)
    {
        datasize += record.Length + 2;
        record = Console.ReadLine();
        Console.WriteLine(record);
    }
}
catch (Exception ex)
{
    Console.Error.WriteLine($"Error: {ex.Message}");
    return;
} 
```

datasize 值与实际文件大小不匹配，但这并不重要。目前尚不清楚 PDF 文件是否总是在行尾同时使用 CR 和 LF，但这并不重要。您可以使用任何其他大型文本文件进行测试。

使用该示例重定向器代码会在我写入大量数据时挂起，但在我写入少量数据时不会挂起。

我非常努力地以某种方式跟踪该代码的执行，但我做不到。我注释掉了重定向程序中禁用为重定向程序创建控制台的行，以尝试获取单独的控制台窗口，但我做不到。

然后我找到[了如何在新窗口、父窗口或无窗口中启动控制台应用程序](https://blogs.msdn.microsoft.com/jmstall/2006/09/28/how-to-start-a-console-app-in-a-new-window-the-parents-window-or-no-window)。因此，当一个控制台程序在没有 ShellExecute 的情况下启动另一个控制台程序时，显然我们不能（轻松）拥有一个单独的控制台，并且由于 ShellExecute 不支持重定向，我们必须共享一个控制台，即使我们没有为另一个进程指定窗口。

我假设如果重定向的程序在某个地方填满了缓冲区，那么它必须等待数据被读取，如果此时重定向器没有读取数据，那么它就是死锁。

解决方案是不使用 ReadToEnd 并在写入数据时读取数据，但不必使用异步读取。解决方案可能非常简单。以下内容适用于 5 MB PDF。

```
ProcessStartInfo info = new ProcessStartInfo(TheProgram);
info.CreateNoWindow = true;
info.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
info.RedirectStandardOutput = true;
info.UseShellExecute = false;
Process p = Process.Start(info);
string record = p.StandardOutput.ReadLine();
while (record != null)
{
    Console.WriteLine(record);
    record = p.StandardOutput.ReadLine();
}
p.WaitForExit(); 
```

另一种可能性是使用 GUI 程序进行重定向。前面的代码在 WPF 应用程序中工作，除非有明显的修改。

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2015-01-13T10:35:39.997

我遇到了同样的问题，但原因不同。但是，它会在 Windows 8 下发生，但不会在 Windows 7 下发生。以下行似乎导致了问题。

```
pProcess.StartInfo.UseShellExecute = False 
```

解决方案是不禁用 UseShellExecute。我现在收到了一个 Shell 弹出窗口，它是不需要的，但比等待什么都没有发生的程序要好得多。所以我为此添加了以下解决方法：

```
pProcess.StartInfo.WindowStyle = ProcessWindowStyle.Hidden 
```

现在唯一困扰我的是为什么这首先会在 Windows 8 下发生。

# linux - Where to find packages names and versions for RedHat?

> ID：139605
> 
> 赞同：19
> 
> 时间：2008-09-26T13:49:49.423
> 
> 标签：linux, packages, redhat, rpm

How can I find out whether a specific RedHat release (RHEL4, RHEL5...) contains a certain package (or a certain version of a package)? For Debian and Ubuntu, there's packages.debian.org and packages.ubuntu.com; is there a similar web site for RedHat?

Note: I don't want to have to install all the releases just to check some package version :-)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T13:56:27.287

The best you can do, as it seems, is to check the FTP directories of the source packages:

*   [RHEL4](http://web.archive.org/web/20190807022012/http://ftp.redhat.com/pub/redhat/linux/enterprise/4/en/os/i386/SRPMS/)
*   [RHEL5](ftp://ftp.redhat.com/pub/redhat/linux/enterprise/5Server/en/os/SRPMS/)
*   [RHEL6](ftp://ftp.redhat.com/pub/redhat/linux/enterprise/6Server/en/os/SRPMS/)
*   [RHEL7](ftp://ftp.redhat.com/pub/redhat/linux/enterprise/7Server/en/os/SRPMS/)

Keep in mind that RedHat has the habit of patching software to hell and back, so the version number might not have to much in common with the actual release, especially for the kernel.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T13:51:55.253

For starters: [http://distrowatch.com/table.php?distribution=redhat](http://distrowatch.com/table.php?distribution=redhat) has a list of the important versions, but certainly does not list all package versions.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-03-08T14:24:52.183

显然，Red Hat 的 RHEL 发行版确实有这样一个在线软件包列表，但只有付费的 Red Hat 客户才能访问它:-(

顺便提一句。类似的问题（针对 CentOS）：[https ://serverfault.com/questions/239205/official-online-rpm-package-browser-search-for-centos](https://serverfault.com/questions/239205/official-online-rpm-package-browser-search-for-centos)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-06-24T18:06:49.017

由于 RedHat 和 CENTOS 非常相似，您可以通过查看 CENTOS 存储库中相应版本的软件包来获得一个不错的列表。转至以下站点之一并转至您的 RedHat / CENTOS 版本并找到软件包。CENTOS 版本与 RedHat 版本一致。

[http://vault.centos.org/](http://vault.centos.org/)

[http://mirrors.centos.org/](http://mirrors.centos.org/)

例如，对于带有 RedHat 6.3（或 CENTOS 6.3）的 i386 系统，请查看以下站点：http: [//vault.centos.org/6.3/os/i386/Packages/](http://vault.centos.org/6.3/os/i386/Packages/)

我不保证它会是一对一的映射，但它应该非常接近。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T09:26:27.423

看起来 Fedora 现在正在处理一个在线软件包列表（PackageDB - 请参阅[http://fedoraproject.org/wiki/Infrastructure/PackageDatabase](http://fedoraproject.org/wiki/Infrastructure/PackageDatabase)）。当前版本可在[https://admin.fedoraproject.org/pkgdb/](https://admin.fedoraproject.org/pkgdb/)获得。不过，它似乎并不了解所有 RHEL4/RHEL5 软件包。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T14:00:22.863

If you have your yum repositories set, you can use "yum search " to see if it exists, or "yum list" to see all available packages.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-10T01:25:19.723

注意：通过“浏览”`rsync://`镜像而不是`ftp://`镜像，您可以方便地使用通配符过滤文件，而不必等待几分钟来下载所有包的海量而全面的列表。

# c# - C# 中的 myCustomer.GetType() 和 typeof(Customer) 有什么区别？

> ID：139607
> 
> 赞同：75
> 
> 时间：2008-09-26T13:50:01.310
> 
> 标签：c#, .net

我已经在我正在维护的一些代码中看到两者都完成了，但不知道有什么区别。有吗？

让我补充一点，myCustomer 是 Customer 的一个实例

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2008-09-26T13:50:35.537

在您的情况下，两者的结果完全相同。它将是您的自定义类型，它派生自`System.Type`. 这里唯一真正的区别是，当你想从你的类的实例中获取类型时，你使用`GetType`. 如果您没有实例，但您知道类型名称（并且只需要实际`System.Type`检查或比较），您将使用`typeof`.

### 重要区别

编辑：让我补充一点，调用`GetType`在运行时得到解决，而`typeof`在编译时得到解决。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-26T14:05:31.367

GetType() 用于在运行时查找对象引用的*实际*类型。由于继承，这可能与引用对象的变量的类型不同。typeof() 创建一个类型字面量，该字面量具有指定的确切类型，并在编译时确定。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-26T13:51:26.377

是的，如果您从 Customer 继承类型，则会有所不同。

```
class VipCustomer : Customer
{
  .....
}

static void Main()
{
   Customer c = new VipCustomer();
   c.GetType(); // returns typeof(VipCustomer)
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T13:51:11.183

首先，您需要一个实际实例（即 myCustomer），其次您不需要

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-26T14:14:45.917

typeof(foo) 在编译期间被转换为常量。foo.GetType() 发生在运行时。

typeof(foo) 也直接转换为其类型的常量（即 foo），因此这样做会失败：

```
public class foo
{
}

public class bar : foo
{
}

bar myBar = new bar();

// Would fail, even though bar is a child of foo.
if (myBar.getType == typeof(foo))

// However this Would work
if (myBar is foo) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T20:47:09.500

typeof 在编译时执行，而 GetType 在运行时执行。这就是这两种方法的不同之处。这就是为什么在处理类型层次结构时，只需运行 GetType 就可以找到类型的确切类型名称。

```
public Type WhoAreYou(Base base)
{
   base.GetType();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-24T13:20:29.573

typeof 运算符将类型作为参数。它在编译时解决。GetType 方法在对象上调用并在运行时解析。第一种是在需要使用已知类型时使用，第二种是在不知道对象是什么时获取对象的类型。

```
class BaseClass
{ }

class DerivedClass : BaseClass
{ }

class FinalClass
{
    static void RevealType(BaseClass baseCla)
    {
        Console.WriteLine(typeof(BaseClass));  // compile time
        Console.WriteLine(baseCla.GetType());  // run time
    }

    static void Main(string[] str)
    {
        RevealType(new BaseClass());

        Console.ReadLine();
    }
}
// *********  By Praveen Kumar Srivastava 
```

# c++ - CAutoPtr 类是否实现引用计数？

> ID：139622
> 
> 赞同：1
> 
> 时间：2008-09-26T13:52:53.830
> 
> 标签：c++, memory-management, cautoptr

现代 ATL/MFC 应用程序现在可以访问一个名为 CAutoPtr 的新共享指针类，以及相关的容器（CAutoPtrArray、CAutoPtrList 等）。

CAutoPtr 类是否实现引用计数？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T13:53:38.900

检查 CAutoPtr 源后，不，不支持引用计数。如果需要此能力，请改用 boost::shared_ptr。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T16:26:30.077

[http://msdn.microsoft.com/en-us/library/txda4x5t(VS.80).aspx](http://msdn.microsoft.com/en-us/library/txda4x5t(VS.80).aspx)的文档

从阅读本文看来，它试图提供与 std::auto_ptr 相同的功能，**即**它使用所有权语义。只有一个 CAutoPtr 对象持有指针，并且赋值将所有权从一个 CAutoPtr 对象转移到另一个。

# javascript - 延迟跳转到新网页

> ID：139623
> 
> 赞同：2
> 
> 时间：2008-09-26T13:52:57.700
> 
> 标签：javascript, html

如何使页面在 X 秒后使用户跳转到新网页。如果可能的话，我想使用 HTML，但有一种感觉告诉我它必须是 Javascript。

到目前为止，我有以下内容，但没有时间延迟

```
<body onload="document.location='newPage.html'"> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T13:58:20.167

元刷新很难看，但会起作用。以下内容将在 5 秒后转到新网址：

```
<meta http-equiv="refresh" content="5;url=http://example.com/"/> 
```

[http://en.wikipedia.org/wiki/Meta_refresh](http://en.wikipedia.org/wiki/Meta_refresh)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T14:01:02.300

如果您要走 JS 路线，请使用

```
setTimeout("window.location.href = 'newPage.html';", 5000); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T13:58:24.940

把它放在头上：

```
<meta http-equiv="refresh" content="5;url=newPage.html"> 
```

这将在 5 秒后重定向。使 0 重定向 onload。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T13:58:28.640

您可以使用良好的 ole' [META REFRESH](http://webmaster.indiana.edu/tool_guide_info/refresh_metatag.shtml)，不需要 JS，尽管这些（我认为）已被弃用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T14:09:33.090

Meta Refresh 是可行的方法，但这里是 JavaScript 解决方案：

```
<body onload="setTimeout('window.location = \'newpage.html\'', 5000)"> 
```

更多细节可以在[这里](http://www.elated.com/articles/javascript-timers-with-settimeout-and-setinterval/)找到。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T19:34:39.313

`eval`JavaScript 方法，不调用`setTimeout`:

```
<body onload="setTimeout(function(){window.location.href='newpage.html'}, 5000)"> 
```

# sql - SQL中的TRUNCATE和DELETE有什么区别

> ID：139630
> 
> 赞同：360
> 
> 时间：2008-09-26T13:53:31.070
> 
> 标签：sql, database, truncate

`TRUNCATE`SQL和SQL有什么区别`DELETE`？

如果您的答案是特定于平台的，请指出。

* * *

## 回答 #1

> 赞同：298
> 
> 时间：2008-09-26T13:53:40.490

这是差异列表。我已经强调了 Oracle 特定的特性，希望社区也可以添加其他供应商的特定差异。大多数供应商共有的差异可以直接放在标题下方，下面突出显示差异。

* * *

# 总体概述

如果您想快速删除表中的所有行，并且您确实确定要这样做，并且您没有针对表的外键，那么 TRUNCATE 可能会比 DELETE 快.

必须考虑各种特定于系统的问题，如下所述。

* * *

# 报表类型

删除是 DML，截断是 DDL（[什么是 DDL 和 DML？](https://stackoverflow.com/q/2578194/276052)）

* * *

# 提交和回滚

因供应商而异

**SQL*服务器**

截断可以回滚。

**PostgreSQL**

截断可以回滚。

**甲骨文**

因为 TRUNCATE 是 DDL，所以它涉及两次提交，一次在语句执行之前，一次在语句执行之后。截断因此不能回滚，并且截断过程中的失败无论如何都会发出提交。

但是，请参阅下面的闪回。

* * *

# 空间回收

删除不恢复空间，截断恢复空间

**甲骨文**

如果您使用 REUSE STORAGE 子句，则不会取消分配数据段，如果要重新加载表中的数据，这可能会稍微更有效。高水位线被重置。

* * *

# 行范围

删除可用于删除所有行或仅删除部分行。截断删除所有行。

**甲骨文**

对表进行分区时，可以单独截断各个分区，因此可以部分删除表的所有数据。

* * *

# 对象类型

删除可以应用于表和集群内的表。截断仅适用于表或整个集群。（可能是 Oracle 特定的）

* * *

# 数据对象身份

**甲骨文**

删除不会影响数据对象 id，但 truncate 会分配一个新的数据对象 id *，除非*自创建以来从未对表进行过插入即使是回滚的单个插入也会导致在截断时分配新的数据对象 id .

* * *

# 闪回（甲骨文）

闪回适用于删除，但截断可防止闪回到操作之前的状态。

但是，从 11gR2 开始，FLASHBACK ARCHIVE 功能允许这样做，但在 Express Edition 中除外

[在 Oracle 中使用 FLASHBACK](https://stackoverflow.com/questions/25950145/use-of-flashback-in-oracle) [http://docs.oracle.com/cd/E11882_01/appdev.112/e41502/adfns_flashback.htm#ADFNS638](http://docs.oracle.com/cd/E11882_01/appdev.112/e41502/adfns_flashback.htm#ADFNS638)

* * *

# 特权

多变的

**甲骨文**

可以将表上的删除权限授予另一个用户或角色，但如果不使用 DROP ANY TABLE 权限，则不能截断。

* * *

# 重做/撤消

删除会产生少量的重做和大量的撤消。Truncate 生成的每一个都可以忽略不计。

* * *

# 索引

**甲骨文**

截断操作使不可用的索引再次可用。删除没有。

* * *

# 外键

当启用的外键引用表时，不能应用截断。删除处理取决于外键的配置。

* * *

# 表锁定

**甲骨文**

截断需要独占表锁，删除需要共享表锁。因此，禁用表锁是一种防止对表进行截断操作的方法。

* * *

# 触发器

DML 触发器不会在截断时触发。

**甲骨文**

DDL 触发器可用。

* * *

# 远程执行

**甲骨文**

不能通过数据库链接发出截断。

* * *

# 身份列

**SQL*服务器**

截断重置 IDENTITY 列类型的序列，删除不会。

* * *

# 结果集

在大多数实现中，`DELETE`语句可以将已删除的行返回给客户端。

例如，在 Oracle PL/SQL 子程序中，您可以：

```
DELETE FROM employees_temp
WHERE       employee_id = 299 
RETURNING   first_name,
            last_name
INTO        emp_first_name,
            emp_last_name; 
```

* * *

## 回答 #2

> 赞同：217
> 
> 时间：2012-10-15T17:07:03.680

截断和删除的区别如下：

```
+----------------------------------------+----------------------------------------------+
|                Truncate                |                    Delete                    |
+----------------------------------------+----------------------------------------------+
| We can't Rollback after performing     | We can Rollback after delete.                |
| Truncate.                              |                                              |
|                                        |                                              |
| Example:                               | Example:                                     |
| BEGIN TRAN                             | BEGIN TRAN                                   |
| TRUNCATE TABLE tranTest                | DELETE FROM tranTest                         |
| SELECT * FROM tranTest                 | SELECT * FROM tranTest                       |
| ROLLBACK                               | ROLLBACK                                     |
| SELECT * FROM tranTest                 | SELECT * FROM tranTest                       |
+----------------------------------------+----------------------------------------------+
| Truncate reset identity of table.      | Delete does not reset identity of table.     |
+----------------------------------------+----------------------------------------------+
| It locks the entire table.             | It locks the table row.                      |
+----------------------------------------+----------------------------------------------+
| Its DDL(Data Definition Language)      | Its DML(Data Manipulation Language)          |
| command.                               | command.                                     |
+----------------------------------------+----------------------------------------------+
| We can't use WHERE clause with it.     | We can use WHERE to filter data to delete.   |
+----------------------------------------+----------------------------------------------+
| Trigger is not fired while truncate.   | Trigger is fired.                            |
+----------------------------------------+----------------------------------------------+
| Syntax :                               | Syntax :                                     |
| 1) TRUNCATE TABLE table_name           | 1) DELETE FROM table_name                    |
|                                        | 2) DELETE FROM table_name WHERE              |
|                                        |    example_column_id IN (1,2,3)              |
+----------------------------------------+----------------------------------------------+ 
```

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2015-04-15T08:02:59.647

> ### 降低
> 
> DROP 命令从数据库中删除一个表。所有表的行、索引和权限也将被删除。不会触发任何 DML 触发器。该操作无法回滚。
> 
> ### 截短
> 
> TRUNCATE 从表中删除所有行。该操作无法回滚，也不会触发任何触发器。因此，TRUNCATE 速度更快，并且不像 DELETE 那样使​​用太多的撤消空间。截断时将添加表级锁。
> 
> ### 删除
> 
> DELETE 命令用于从表中删除行。WHERE 子句可用于仅删除某些行。如果未指定 WHERE 条件，则将删除所有行。执行 DELETE 操作后，您需要 COMMIT 或 ROLLBACK 事务以使更改永久化或撤消它。请注意，此操作将触发表上的所有 DELETE 触发器。删除时会添加行级锁。

来自：[http ://www.orafaq.com/faq/difference_between_truncate_delete_and_drop_commands](http://www.orafaq.com/faq/difference_between_truncate_delete_and_drop_commands)

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-09-26T14:28:10.347

所有好的答案，我必须添加：

由于`TRUNCATE TABLE`是 DDL（[数据定义语言](https://en.wikipedia.org/wiki/Data_definition_language)），而不是 DML（[数据操作语言](https://en.wikipedia.org/wiki/Data_manipulation_language)）命令，因此`Delete Triggers`不要运行。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2016-05-14T16:07:08.340

SQL Server 中删除与截断的摘要
有关完整文章，请点击此链接：[http ://codaffection.com/sql-server-article/delete-vs-truncate-in-sql-server/](http://codaffection.com/sql-server-article/delete-vs-truncate-in-sql-server/)

[![在此处输入图像描述](https://i.stack.imgur.com/Bil4e.jpg)](https://i.stack.imgur.com/Bil4e.jpg)

摘自 dotnet mob 文章：[SQL Server 中的删除与截断](http://codaffection.com/sql-server-article/delete-vs-truncate-in-sql-server/)

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-09-26T13:56:36.070

对于 SQL Server 或 MySQL，如果有一个自动递增的 PK，truncate 将重置计数器。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2019-12-31T04:54:05.427

**截短**

***TRUNCATE SQL 查询从表中删除所有行，而不记录单个行删除。***

*   TRUNCATE 是一个 DDL 命令。
*   TRUNCATE 使用表锁执行，整个表被锁定以删除所有记录。
*   我们不能将 WHERE 子句与 TRUNCATE 一起使用。
*   TRUNCATE 从表中删除所有行。
*   事务日志中的日志记录最少，因此性能更快。
*   TRUNCATE TABLE 通过解除分配用于存储表数据的数据页来移除数据，并且仅在事务日志中记录页解除分配。
*   要在表上使用 Truncate，您至少需要对表具有 ALTER 权限。
*   Truncate 使用的事务空间比 Delete 语句少。
*   截断不能与索引视图一起使用。
*   TRUNCATE 比 DELETE 快。

**删除**

***要执行 DELETE 队列，需要对目标表具有删除权限。如果您需要在 DELETE 中使用 WHERE 子句，则还需要选择权限。***

*   DELETE 是一个 DML 命令。
*   DELETE 使用行锁执行，表中的每一行都被锁定以进行删除。
*   我们可以使用带 DELETE 的 where 子句来过滤和删除特定记录。
*   DELETE 命令用于根据 WHERE 条件从表中删除行。
*   它维护日志，因此它比 TRUNCATE 慢。
*   DELETE 语句一次删除一个行，并在事务日志中为每个删除的行记录一个条目。
*   列的标识 keep DELETE 保留标识。
*   要使用 Delete，您需要对表具有 DELETE 权限。
*   Delete 使用比 Truncate 语句更多的事务空间。
*   删除可以与索引视图一起使用。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-09-26T14:12:14.393

“截断不记录任何内容”是正确的。我会更进一步：

截断不在事务的上下文中执行。

truncate 相对于 delete 的速度优势应该是显而易见的。根据您的情况，这种优势从微不足道到巨大。

但是，我看到 truncate 无意中破坏了参照完整性，并违反了其他约束。您通过在事务之外修改数据获得的权力必须与您在没有网络的情况下走钢丝时继承的责任相平衡。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2009-12-09T11:31:44.727

`TRUNCATE`是 DDL 语句，而`DELETE`是 DML 语句。以下是两者之间的区别：

1.  与`TRUNCATE`DDL（[数据定义语言](https://en.wikipedia.org/wiki/Data_definition_language)）语句一样，它不需要提交即可使更改永久化。这就是为什么 truncate 删除的行无法回滚的原因。另一方面`DELETE`是 DML（[数据操作语言](https://en.wikipedia.org/wiki/Data_manipulation_language)）语句，因此需要显式提交才能使其效果永久化。

2.  `TRUNCATE`总是从表中删除所有行，使表为空且表结构完整，而`DELETE`如果使用 where 子句，则可以有条件地删除。

3.  语句删除的行`TRUNCATE TABLE`不能恢复，不能在`TRUNCATE`语句中指定where子句。

4.  `TRUNCATE`statements 不会触发触发器，而不是 on delete trigger on `DELETE`statement

[这](http://forums.oracle.com/forums/thread.jspa?threadID=636943)是与该主题相关的非常好的链接。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-09-27T13:46:01.937

是的，DELETE 比较慢，TRUNCATE 比较快。为什么？

DELETE 必须读取记录、检查约束、更新块、更新索引以及生成重做/撤消。所有这些都需要时间。

TRUNCATE 只是为表（高水位线）调整数据库中的指针，然后噗！数据不见了。

这是 Oracle 特定的，AFAIK。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2014-08-20T17:32:29.673

如果您不小心使用删除/截断从表中删除了所有数据。您可以回滚已提交的事务。恢复上次备份并运行事务日志，直到删除/截断即将发生。

以下相关信息来自[博客文章](http://programmerzone4u.blogspot.in/2014/08/difference-between-delete-truncate-in.html)：

> 在处理数据库时，我们在不知道它们之间的差异的情况下使用 Delete 和 Truncate。在本文中，我们将讨论 Sql 中 Delete 和 Truncate 的区别。
> 
> 删除：
> 
> *   删除是一个 DML 命令。
> *   删除语句使用行锁执行，表中的每一行都被锁定以进行删除。
> *   我们可以在 where 子句中指定过滤器。
> *   如果 where 条件存在，它将删除指定的数据。
> *   删除活动是一个触发器，因为该操作是单独记录的。
> *   比截断慢，因为它保留日志
> 
> 截短
> 
> *   截断是一个 DDL 命令。
> *   截断表总是锁定表和页面，但不是每一行。因为它删除了所有数据。
> *   不能使用 Where 条件。
> *   它删除所有数据。
> *   截断表无法激活触发器，因为该操作不记录单个行删除。
> *   在性能方面更快，因为它不保留任何日志。
> 
> 注意：与 Transaction 一起使用时，Delete 和 Truncate 都可以回滚。如果 Transaction 已完成，意味着已提交，那么我们无法回滚 Truncate 命令，但我们仍然可以从 Log 文件中回滚 Delete 命令，因为 delete write 将它们记录在 Log 文件中，以防将来需要从 log 文件中回滚。
> 
> 如果您有一个外键约束引用您要截断的表，即使引用表中没有数据，这也不起作用。这是因为外键检查是使用 DDL 而不是 DML 完成的。这可以通过暂时禁用表的外键约束来解决。
> 
> 删除表是一个记录操作。因此，每行的删除都会记录在事务日志中，这使得它变慢了。截断表也会删除表中的所有行，但它不会记录每一行的删除，而是记录表数据页的释放，这使得它更快。
> 
> ~ 如果您不小心使用删除/截断从表中删除了所有数据。您可以回滚已提交的事务。恢复上次备份并运行事务日志，直到删除/截断即将发生。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2015-11-05T09:49:39.757

[这是我对SQL Server 中 DELETE 和 TRUNCATE 区别](http://mangalpardeshi.blogspot.in/2009/07/delete-vs-truncate.html)的详细回答

• **删除数据** ：首先，两者都可用于从表中删除行。
但 DELETE 不仅可用于从表中删除行，还可以从 VIEW 或 OPENROWSET 或 OPENQUERY 的结果中删除行，这取决于提供者的能力。

• **FROM 子句**：使用 DELETE，您还可以使用另一个 FROM 子句根据另一个表中的行从一个表/视图/rowset_function_limited 中删除行。在该 FROM 子句中，您还可以编写正常的 JOIN 条件。实际上，您可以通过将 SELECT 替换为 DELETE 并删除列名，从不包含任何聚合函数的 SELECT 语句创建 DELETE 语句。
使用 TRUNCATE 你不能这样做。

• **WHERE**：TRUNCATE 不能有WHERE 条件，但DELETE 可以。这意味着使用 TRUNCATE 您不能删除特定行或特定行组。TRUNCATE TABLE 类似于没有 WHERE 子句的 DELETE 语句。

• **性能**：TRUNCATE TABLE 速度更快，使用的系统和事务日志资源更少。原因之一是任一语句使用的锁。DELETE 语句使用行锁执行，表中的每一行都被锁定以进行删除。TRUNCATE TABLE 总是锁定表和页，但不是每一行。

• **事务日志**：DELETE 语句一次删除一行，并在事务日志中为每一行创建单独的条目。
TRUNCATE TABLE 通过解除分配用于存储表数据的数据页来移除数据，并且仅在事务日志中记录页解除分配。

• **Pages**：执行DELETE 语句后，表中仍可包含空页。TRUNCATE 通过释放用于存储表数据的数据页来删除数据。

• **触发器**：TRUNCATE 不会激活表上的删除触发器。所以在使用 TRUNCATE 时必须非常小心。如果在表上定义了删除触发器以在删除行时执行一些自动清理或记录操作，则永远不应使用 TRUNCATE。

• **标识列**：如果表包含标识列，则使用 TRUNCATE，该列的计数器将重置为为该列定义的种子值。如果没有定义种子，则使用默认值 1。DELETE 不会重置身份计数器。因此，如果您想保留身份计数器，请改用 DELETE。

• **复制**：DELETE 可用于事务复制或合并复制中使用的表。
而 TRUNCATE 不能用于事务复制或合并复制中涉及的表。

• **回滚**：可以回滚DELETE 语句。
TRUNCATE 也可以回滚，前提是它包含在 TRANSACTION 块中并且会话未关闭。会话关闭后，您将无法回滚 TRUNCATE。

• **限制**：如果DELETE 语句违反触发器或尝试删除具有FOREIGN KEY 约束的另一个表中的数据引用的行，则它可能会失败。如果 DELETE 删除了多行，并且任何删除的行违反了触发器或约束，则取消该语句，返回一个错误，并且不删除任何行。
如果对 View 使用 DELETE，则该 View 必须是可更新的视图。TRUNCATE 不能用于索引视图中使用的表。
TRUNCATE 不能用于 FOREIGN KEY 约束引用的表，除非表具有引用自身的外键。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-03-27T12:26:39.457

在 SQL Server 2005 中，我相信您**可以**回滚截断

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2015-04-07T09:33:59.243

> ### 删除
> 
> DELETE 命令用于从表中删除行。WHERE 子句可用于仅删除某些行。如果未指定 WHERE 条件，则将删除所有行。执行 DELETE 操作后，您需要 COMMIT 或 ROLLBACK 事务以使更改永久化或撤消它。请注意，此操作将触发表上的所有 DELETE 触发器。
> 
> ### 截短
> 
> TRUNCATE 从表中删除所有行。该操作无法回滚，也不会触发任何触发器。因此，TRUCATE 速度更快，并且不像 DELETE 那样使​​用太多的撤消空间。
> 
> ### 降低
> 
> DROP 命令从数据库中删除一个表。所有表的行、索引和权限也将被删除。不会触发任何 DML 触发器。该操作无法回滚。
> 
> * * *
> 
> DROP 和 TRUNCATE 是 DDL 命令，而 DELETE 是 DML 命令。因此 DELETE 操作可以回滚（撤消），而 DROP 和 TRUNCATE 操作不能回滚。

来自：[http ://www.orafaq.com/faq/difference_between_truncate_delete_and_drop_commands](http://www.orafaq.com/faq/difference_between_truncate_delete_and_drop_commands)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2014-08-21T14:55:50.123

如果包装在事务中，则 TRUNCATE 可以回滚。

请参阅下面的两个参考并测试自己：-

[http://blog.sqlauthority.com/2007/12/26/sql-server-truncate-cant-be-rolled-back-using-log-files-after-transaction-session-is-closed/](http://blog.sqlauthority.com/2007/12/26/sql-server-truncate-cant-be-rolled-back-using-log-files-after-transaction-session-is-closed/)

[http://sqlblog.com/blogs/kalen_delaney/archive/2010/10/12/tsql-tuesday-11-rolling-back-truncate-table.aspx](http://sqlblog.com/blogs/kalen_delaney/archive/2010/10/12/tsql-tuesday-11-rolling-back-truncate-table.aspx)

TRUNCATE vs. DELETE 是 SQL 面试中臭名昭著的问题之一。只要确保你向面试官正确解释它，否则它可能会让你失去工作。问题是没有多少人知道，所以如果你告诉他们 YES Truncate 可以回滚，他们很可能会认为答案是错误的。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-10-06T09:44:39.160

这两个操作的另一个区别是，如果表包含一个标识列，则该列的计数器在 TRUNCATE 下重置为 1（或为该列定义的种子值）。DELETE 没有这种影响。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-27T15:26:59.603

对原始答案的小修正 - 删除也会产生大量的重做（因为撤消本身受重做保护）。这可以从自动跟踪输出中看出：

```
SQL> delete from t1;

10918 rows deleted.

Elapsed: 00:00:00.58

Execution Plan
----------------------------------------------------------
   0      DELETE STATEMENT Optimizer=FIRST_ROWS (Cost=43 Card=1)
   1    0   DELETE OF 'T1'
   2    1     TABLE ACCESS (FULL) OF 'T1' (TABLE) (Cost=43 Card=1)

Statistics
----------------------------------------------------------
         30  recursive calls
      12118  db block gets
        213  consistent gets
        142  physical reads
    3975328  redo size
        441  bytes sent via SQL*Net to client
        537  bytes received via SQL*Net from client
          4  SQL*Net roundtrips to/from client
          2  sorts (memory)
          0  sorts (disk)
      10918  rows processed 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2013-09-07T12:18:54.550

**删除**

> ```
> DELETE is a DML command
> DELETE you can rollback
> Delete = Only Delete- so it can be rolled back
> In DELETE you can write conditions using WHERE clause
> Syntax – Delete from [Table] where [Condition] 
> ```

**截短**

> ```
> TRUNCATE is a DDL command
> You can't rollback in TRUNCATE, TRUNCATE removes the record permanently
> Truncate = Delete+Commit -so we can't roll back
> You can't use conditions(WHERE clause) in TRUNCATE
> Syntax – Truncate table [Table] 
> ```

欲了解更多详情，请访问

[http://www.zilckh.com/what-is-the-difference-between-truncate-and-delete/](http://www.zilckh.com/what-is-the-difference-between-truncate-and-delete/)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-26T13:56:46.303

最大的区别是 truncate 是非记录操作，而 delete 是。

简单来说就是在数据库崩溃的情况下，truncate 操作的数据是无法恢复的，而 delete 则可以。

更多细节[在这里](http://doc.ddart.net/mssql/sql70/8_des_02_8.htm)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-06-26T22:15:24.410

DELETE 语句：此命令根据 where 子句中给出的条件仅删除表中的行，如果未指定条件，则删除表中的所有行。但它不会释放包含表的空间。

SQL DELETE 语句的语法是：

DELETE FROM table_name [WHERE 条件]；

TRUNCATE 语句：该命令用于从表中删除所有行并释放包含该表的空间。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-26T13:56:46.303

简而言之，truncate 不会记录任何内容（因此速度更快但无法撤消），而 delete 会被记录（并且可以是更大事务的一部分，将回滚等）。如果您在 dev 的表中有您不想要的数据，通常最好截断，因为您不会冒填满事务日志的风险

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-26T14:17:41.713

它很方便的一个重要原因是，当您需要刷新数百万行表中的数据，但又不想重建它时。“删除 *” 将永远持续，而 Truncate 的性能影响可以忽略不计。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-26T23:44:22.880

无法通过 dblink 执行 DDL。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-27T01:08:01.867

我会评论 matthieu 的帖子，但我还没有代表...

在 MySQL 中，自动增量计数器使用 truncate 重置，但不会使用 delete 重置。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-01-25T07:19:54.507

truncate 并不是在 SQL Server 中不记录任何内容。truncate 不会记录任何信息，但它会记录您触发 TRUNCATE 的表的数据页释放。

如果我们在开始时定义事务，则可以回滚被截断的记录，并且可以在回滚后恢复被截断的记录。但在提交截断事务后，无法从事务日志备份中恢复截断记录。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-07-30T08:32:02.930

截断也可以在这里回滚示例

```
begin Tran
delete from  Employee

select * from Employee
Rollback
select * from Employee 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2014-08-22T18:20:15.580

SQL中的截断和删除是两个用于从表中删除或删除数据的命令。尽管在本质上非常基本，但在使用之前熟悉细节之前，这两个 Sql 命令都会产生很多麻烦。如果需要删除太多数据而日志段不够用，则命令选择不正确可能会导致进程非常缓慢，甚至会炸毁日志段。这就是为什么知道何时在 SQL 中使用 truncate 和 delete 命令至关重要，但在使用这些命令之前，您应该了解 Truncate 和 Delete 之间的差异，并基于它们，我们应该能够找出 DELETE 何时是删除的更好选择data 或 TRUNCATE 应该用于清除表。

参考检查[点击这里](http://programmerzone4u.blogspot.in/2014/08/when-to-use-truncate-and-delete-command.html)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2014-10-06T00:25:47.353

通过发出 TRUNCATE TABLE 语句，您将指示 SQL Server 删除表中的每条记录，而不进行任何日志记录或事务处理。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-06-13T04:18:21.470

DELETE 语句可以有一个 WHERE 子句来删除特定记录，而 TRUNCATE 语句不需要任何并擦除整个表。重要的是，DELETE 语句记录删除日期，而 TRUNCATE 语句不记录。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-04-19T06:58:33.400

另一个特定于 microsoft sql server 的区别是`delete`您可以使用`output`语句来跟踪已删除的记录，例如：

```
delete from [SomeTable]
output deleted.Id, deleted.Name 
```

你不能用`truncate`.

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-04-26T07:51:53.943

**Truncate**命令用于重新初始化表，它是一个 DDL 命令，删除表的所有行。而**DELETE**是一个 DML 命令，用于根据某些条件删除行或行集，如果没有指定条件然后此命令将从表中删除所有行。

* * *

## 回答 #32

> 赞同：-5
> 
> 时间：2008-09-27T01:17:57.367

TRUNCATE 很快，DELETE 很慢。

虽然，TRUNCATE 没有责任。

# c# - .NET 架构问题：2 Web 服务，我如何更改在运行时使用哪一个？

> ID：139639
> 
> 赞同：1
> 
> 时间：2008-09-26T13:55:18.367
> 
> 标签：c#, .net, sharepoint, architecture, reporting-services

我正在使用 Reporting Services 和 Sharepoint，我有一个利用报告服务的应用程序，但是客户希望我们的应用程序集成到 sharepoint 中。目前我们与 ReportService.asmx webservice 紧密耦合，它公开了各种执行操作的方法。Reporting Services 有一种称为“Sharepoint 集成模式”的功能，启用后，报表服务器的工作方式会有所不同，Sharepoint 用于管理报表。Sharepoint 添加了一个名为 ReportService2006.asmx 的新 Web 服务，它几乎完全相同。

现在我们的应用程序使用对 ReportService 的 Web 引用，并使用服务公开的各种对象。ReportService2006 具有完全相同的对象，但它们显然位于不同的命名空间中，例如我有 2 个 Web 引用 - 每个服务 1 个，因此有一个对象 MyApplication.ReportService.CatalogItem 和另一个 MyApplication.ReportService2006.CatalogItem。

我尝试使用依赖注入将服务从我们的应用程序中抽象出来，并结合工厂模式来确定要实例化我的接口的哪个实现。这是我的界面。我已将其简化为仅包含此应用程序所需的调用。

```
using System;
using NetworkUserEncrypt.ReportService;

namespace MyApplication.Service
{
    public interface IReportingService
    {
        CatalogItem CreateDataSource(string DataSource, string Parent, bool Overwrite, DataSourceDefinition Definition, Property[] Properties);

        void DeleteItem(string Item);

        DataSourceDefinition GetDataSourceContents(string DataSource);

        byte[] GetReportDefinition(string Report);

        CatalogItem[] ListChildren(string Item);
    }
} 
```

所以我有 2 个实现，每个都实例化一个不同的 Web 服务，例如：

```
namespace MyApp.Service.Implementation
{
    class ReportingServiceImpl : IReportingService
    {
        ReportingService _service = null;

        public ReportingServiceImpl()
        {
            ReportingService _service = new ReportingService();
        }

        /* SNIP */
    }
  } 
```

和

```
namespace MyApp.Service.Implementation
{
    class ReportingService2006Impl : IReportingService
    {
        ReportingService2006 _service = null;

        public ReportingService2006Impl()
        {
            ReportingService2006 _service = new ReportingService2006();
        }

        /* SNIP */
    }
  } 
```

所以计划是我可以在运行时将这些注入到我的 ServiceWrapper 中。但是 - 如果您注意到该接口与 ReportService 相关联，并且某些方法返回来自 Web 引用的对象，例如 CatalogItem。因此，我的项目不会构建，因为我的 ReportService2006 实现是从不同的命名空间引用 CatalogItem。

有任何想法吗？我的方向完全错误吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T14:08:32.170

对于这种情况，我认为您正朝着正确的方向前进，只是需要做更多的工作才能将其带回家。我会创建一些代理类，它们可以使用反射或动态方法包装两个版本的类。我还看到人们使用远程命名空间中的代理类在运行时拦截方法调用并将它们定向到正确的位置，这样您就可以按需创建动态方法而不是手动编码它们，这一切都是您真正需要的是一个与对象的接口相匹配的接口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T14:10:07.817

要么添加它需要的引用，要么为 CatalogItem 和其余特定类构建包装器。我会构建包装器，接口应该能够独立存在而不引用任何特定的实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T14:18:23.363

如果 Web 服务驻留在不同的名称空间中，那么就没有简单的解决方案（例如，像更改 URL 这样简单的事情）。不过，您似乎在抽象的正确轨道上。

如果您喜欢冒险，您可以自己修改生成的 Web 服务类（“reference.cs”文件），然后手动将它们添加到您的项目中。首先创建一个通用接口，然后修改文件中的第一行，如下所示：

```
public partial class MyWebService : SoapHttpClientProtocol, IMyWebService 
```

然后你用它来调用代码：

```
IMyWebService webService = new MyWebService();  // Or you can use a Factory 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T14:19:23.160

在 VS2008 中，如果我尝试将 ServiceReference 添加到 Web 服务，我会看到一个高级按钮。单击它时，有一个“重用类型”的选项。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T16:03:49.837

最强大的解决方案是创建一个 CatalogItem 接口并为每个 Web 服务创建包装器，并将整个事物隐藏在工厂后面。工厂将包含调用“正确”Web 服务的逻辑，并且必须更改客户端代码才能使用该接口，但这是一个更好的更改。

WCF 确实通过服务合同解决了大多数这些问题，如果我之前的建议被证明太难以管理，您可以考虑迁移到 WCF 解决方案。

# php - 写XML的时候，是手写好还是用PHP中的simpleXML之类的生成器好呢？

> ID：139650
> 
> 赞同：5
> 
> 时间：2008-09-26T13:57:03.540
> 
> 标签：php, xml, language-agnostic

我通常像这样手写xml：

```
<tag><?= $value ?></tag> 
```

找到了诸如 simpleXML 之类的工具后，我应该改用这些工具吗？使用这样的工具这样做有什么好处？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T13:59:15.593

好的 XML 工具将确保生成的 XML 文件正确地验证您正在使用的 DTD。

好的 XML 工具还可以节省大量重复键入的标签。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T14:00:37.027

如果您正在处理一小部分 XML，那么手工操作并没有什么坏处（只要您可以避免拼写错误）。但是，对于较大的文档，您通常最好使用编辑器，它可以根据架构验证您的文档并防止拼写错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T15:25:38.663

您可以使用[DOM 扩展](http://de3.php.net/manual/en/book.dom.php)，这对于编写代码可能非常麻烦。我个人的看法是，从头开始编写 XML 文档的最有效方法是PHP 附带的[XMLWriter 扩展，并且在最近的版本中默认启用。](http://de3.php.net/manual/en/intro.xmlwriter.php)

```
$w=new XMLWriter();
$w->openMemory();
$w->startDocument('1.0','UTF-8');
$w->startElement("root");
    $w->writeAttribute("ah", "OK");
    $w->text('Wow, it works!');
$w->endElement();
echo htmlentities($w->outputMemory(true)); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T14:25:13.083

使用良好的 XML 生成器将大大减少由于粗心大意、注意力不集中或其他任何人类弱点而导致的潜在错误。但是，有几种不同级别的机器辅助可供选择：

1.  至少，使用程序员的文本编辑器来进行语法高亮和自动缩进。只是注意到您的文本与您期望的颜色不同，或者没有按照您期望的方式排列，可能会提示您可能错过的错字。

2.  更好的是，退后一步，将 XML 编写为您喜欢的任何语言的数据结构，而不是将该数据结构转换为 XML。Perl 为您提供诸如用于小型工作的轻量级[XML::Simple或更重的](http://search.cpan.org/author/GRANTM/XML-Simple-2.18/lib/XML/Simple.pm)[XML::Generator](http://search.cpan.org/~bholzman/XML-Generator-1.01/Generator.pm)等模块；使用`XML::Simple`只是将您的内容安排成标准的 Perl 哈希值并通过适当的方法运行它。

-史蒂夫

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-27T02:19:55.440

通过任何类型的字符串操作生成 XML 都会为错误进入您的代码打开大门。例如，如果 $value 包含与符号，则您发布的极其简单的示例将不会生成格式良好的 XML。

XML 中的边缘情况并不多，但有足够的时间编写自己的代码来处理它们是浪费时间。（如果你不处理它们，你的代码总有一天会出乎意料地失败。没人想要那样。）任何好的 XML 工具都会自动处理这些情况。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T14:00:15.500

使用生成器。

使用生成器的优点是您有一致的标记，并且不会冒着用括号或引号粗手指或忘记编码的风险。这是至关重要的，因为这些错误要到运行时才会被发现，除非您有重要的测试来确保否则。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T14:01:04.450

手写并不总是最好的做法，因为在大型 XML 中，您可能会编写错误的标签，并且很难找到错误的原因。所以我建议使用 XMl 解析器来创建 XML 文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-26T20:07:43.810

速度可能是个问题……手写会快很多。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T06:13:50.180

eclipse 中的 XML 工具也非常有用。只需创建一个新的 xml 架构和文档，您就可以轻松使用大多数图形工具。我想指出的是，事先了解模式的工作原理是有用的。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-26T14:06:48.447

始终使用某种工具。XML 可能非常复杂，我知道 PHP 人员习惯于使用 hackey 的小东西，但如果有人不使用 System.XML 创建 XML，那么它在 .NET 世界中的代码气味很大。

# c# - 将像素转换为点

> ID：139655
> 
> 赞同：131
> 
> 时间：2008-09-26T13:57:28.360
> 
> 标签：c#, .net, pixel, point

我需要在 C# 中将像素转换为点。我看过一些关于这个话题的复杂解释，但似乎找不到一个简单的公式。让我们假设一个标准的 96dpi，我如何计算这个转换？

* * *

## 回答 #1

> 赞同：216
> 
> 时间：2008-09-26T14:04:53.193

每英寸有[72个点](http://en.wikipedia.org/wiki/Point_%28typography%29)；如果假设每英寸 96 个像素就足够了，那么公式就相当简单：

点 = 像素 * 72 / 96

有一种方法可以在 Windows 中使用[`GetDeviceCaps`](https://msdn.microsoft.com/en-us/library/dd144877(v=vs.85).aspx). Microsoft 有一个名为[“Developing DPI-Aware Applications”](http://msdn.microsoft.com/en-us/library/ms838191.aspx)的指南，请查看“Creating DPI-Aware Fonts”部分。

无论显示器的实际分辨率如何， W3C 都将像素测量定义`px`为[1 英寸的 1/96](https://www.w3.org/TR/css3-values/#absolute-lengths)，因此上述公式应该适用于所有网络工作。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-07-03T12:06:29.113

如果您的代码位于以下表格中，请尝试此操作：

```
Graphics g = this.CreateGraphics();
points = pixels * 72 / g.DpiX;
g.Dispose(); 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-08-10T17:55:26.240

从给定的开始：

*   一英寸有 72 个点（即点是什么，1/72 英寸）
*   在设置为 150dpi 的系统上，每英寸有 150 个像素。
*   1 in = 72pt = 150px（对于 150dpi 设置）

如果要根据像素 (px) 查找点 (pt)：

```
 72 pt    x pt
------ = -----                  (1) for 150dpi system
150 px    y px 
```

重新排列：

```
x = (y/150) * 72                (2) for 150dpi system 
```

所以：

```
points = (pixels / 150) * 72    (3) for 150dpi system 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-26T14:06:25.093

假设 96dpi 是一个*巨大*的错误。即使假设是正确的，也可以选择缩放字体。因此，为 10pts 设置的字体实际上可能显示为 12.5pt (125%)。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-09-02T18:44:34.600

WPF 使用 System.Windows.FontSizeConverter 将点转换为像素。FontSizeConverter 使用 System.Windows.LengthConverter。LengthConverter 使用因子 1.333333333333333333 将点 (p) 转换为像素 (x)：x = p * 1.3333333333333333

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-26T14:45:19.430

System.Drawing.Graphics 具有 DpiX 和 DpiY 属性。DpiX 是水平方向每英寸的像素数。DpiY 是垂直每英寸的像素数。使用这些将点（每英寸 72 点）转换为像素。

例如：14 个水平点 = (14 * DpiX) / 72 像素

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-26T13:59:51.617

当然，整个问题应该是：

“如何获取显示器的水平和垂直 PPI（每英寸像素）？”

一英寸有 72 个点（根据定义，“点”定义为 1/72 英寸，“皮卡”定义为 1/72 英尺）。有了这两位信息，您可以非常轻松地从 px 转换为 pt 并返回。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-07-12T12:02:07.387

其实应该是

```
points = pixels * 96 / 72 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-08-25T20:55:40.227

在标准 XP/Vista/7 机器上点 = (像素 / 96) * 72（出厂默认值）

在运行 OSX 的标准 Mac 上，点 = (像素 / 72) * 72（出厂默认设置）

Windows 默认以 96 dpi（显示）运行 Macs 默认以 72 dpi（显示）运行

72 POSTSCRIPT 点 = 1 英寸 12 POSTSCRIPT 点 = 1 POSTSCRIPT Pica 6 POSTSCRIPT Pica = 72 点 = 1 英寸

1 点 = 1⁄72 英寸 = 25.4⁄72 毫米 = 0.3527 毫米

DPI = 每英寸点数 PPI = 每英寸像素数 LPI = 每英寸线数

更多信息，如果使用 em 作为测量

16px = 1em（普通文本的默认值）8em = 16px * 8 像素/16 = em

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-08-07T05:12:38.243

这有效：

```
int pixels = (int)((dp) * Resources.System.DisplayMetrics.Density + 0.5f); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-07-08T19:26:20.173

在 Mac 上使用 wxPython 获取正确的 DPI 如下：

```
 from wx import ScreenDC
    from wx import Size

    size: Size = ScreenDC().GetPPI()
    print(f'x-DPI: {size.GetWidth()} y-DPI: {size.GetHeight()}') 
```

这产生：

x-DPI：72 y-DPI：72

因此，公式为：

点数：int = (pixelNumber * 72) // 72

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2010-08-16T22:57:10.617

高度线转换为点和像素（我自己的公式）。这是一个在行高字段中手动输入 213.67 点的示例：

```
213.67  Manual Entry    
  0.45  Add 0.45    
214.12  Subtotal    
213.75  Round to a multiple of 0.75 
213.00  Subtract 0.75 provides manual entry converted by Excel  
284.00  Divide by 0.75 gives the number of pixels of height 
```

这里手动输入 213.67 点得到 284 像素。
这里手动输入 213.68 点给出 285 像素。

（为什么是 0.45？我不知道，但它有效。）

# .net - 如何处理所有以一个 Form 类结束的 .NET TabPage 控件？

> ID：139665
> 
> 赞同：3
> 
> 时间：2008-09-26T13:58:44.567
> 
> 标签：.net, visual-studio, winforms

我想用 TabControl 构造一个表单，但我想避免每个 TabPage 上的每个控件最终都成为我要添加 TabControl 的表单的成员。到目前为止，我已经确定了这些选项，请评论或建议替代方案：

1）为每个TabPage写一个UserControl

2）只保留主窗体上的控件，但将控件变量公开并将所有实际代码剪切并粘贴到单独的类中

3）放弃表单设计器并在运行时做所有事情

4）从标签页派生（不确定这是否有效以及设计时的含义是什么）

谢谢大家，

安德鲁

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T14:14:40.067

在任何复杂的 WinForms 应用程序中，您都可能会遇到表单上的控件过多的问题。并不是说您会遇到硬限制，而是您会遇到痛点-例如您所描述的。

在大多数情况下，对我来说，您的选项#1——每个标签页的用户控件——是最不痛苦的方法。它允许您以自己的方式封装控件的逻辑故障，并适当地确定它们的范围。

这样做的缺点是您最终可能会在用户控件上公开**大量**属性。不过，解决这个问题的方法相当简单：使用自定义类来表示“绑定”到所述控件的数据，然后为类的绑定实例公开一个属性。

总体而言，您将拥有更好的架构，更易于维护，并且作为额外的好处，您不会为了让表单工作而发疯。:)

编辑：

我应该注意，您最终可能还需要从代表您的标签页的用户控件中公开一些自定义事件。本质上，如果选项卡上有一个控件，其事件是父窗体需要的，则您必须创建一个事件并引发它，以便父窗体知道它。这并不是非常困难，但可以为用户控件添加重要的 LOC。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T14:17:21.447

选项 1 是最好的，因为它允许您使用设计器来布置 UserControl 的内容，并且还使不同的开发人员可以轻松地同时处理不同的 UserControl 实例。

选项 2 是一个坏主意，因为如果您想更改布局，设计师将生成一些新代码，并且您的剪切粘贴必须手动更正。

选项 3 的工作量将是使用设计器组织布局的 10 倍。

选项 4 对 UserControl 没有任何好处，但您需要对 TabPage 类进行一些更改，以使其能够用作设计图面。

所以我会坚持选项1。

# c++ - 为什么Win32 OleGetClipboard() 函数会返回CLIPBRD_E_CANT_OPEN？

> ID：139668
> 
> 赞同：3
> 
> 时间：2008-09-26T13:58:57.577
> 
> 标签：c++, windows, winapi, ole

Win32 API 函数 OleGetClipboard() 在什么情况下会失败并返回`CLIPBRD_E_CANT_OPEN`？

更多背景信息：我正在协助修复 Firefox 错误。详情在这里：

[错误 444800 - 无法以无损格式从剪贴板检索图像数据](https://bugzilla.mozilla.org/show_bug.cgi?id=444800#c19 "无法以无损格式从剪贴板检索图像数据")

在我帮助编写的自动化测试中，我们看到 OleGetClipboard() 有时会失败并返回`CLIPBRD_E_CANT_OPEN`。这是出乎意料的，从 Windows 剪贴板中提取图像数据的 Firefox 代码取决于该调用是否成功。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T15:56:38.510

文档说`OleGetClipboard`如果失败，可能会失败并显示此错误代码`OpenClipboard`。反过来，如果您阅读该文档，它会说：

"如果另一个窗口打开了剪贴板，则**OpenClipboard 将失败。"**

这是一种专有资源：一次只能在一个窗口中打开剪贴板。基本上，如果你做不到，请稍等片刻，然后再试一次。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T14:07:55.620

您的测试是否在终端服务上运行？从 .NET 设置剪贴板时，请参阅[CLIPBRD_E_CANT_OPEN 错误](https://stackoverflow.com/questions/68666/clipbrdecantopen-error-when-setting-the-clipboard-from-net)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T14:25:46.717

从我在 MSDN 中看到的内容似乎暗示问题出在试图将数据实际放入*剪贴板*的人身上，即 数据的来源。如果他们对 OleSetClipboard() 的调用失败，无论出于何种原因，您将无法提取内容。我会看看数据是如何被放入剪贴板的，看看是否有一个测试用例执行这个（将数据复制到剪贴板），然后导致你正在谈论的问题。

# sql - Data in a table with carriage return?

> ID：139670
> 
> 赞同：9
> 
> 时间：2008-09-26T13:59:15.097
> 
> 标签：sql, sql-server

In SQL SERVER Is it possible to store data with carriage return in a table and then retrieve it back again with carriage return.

Eg:

```
insert into table values ('test1 

test2

test3

test4'); 
```

When I retrieve it, I get the message in a line

test1 test2 test3 test4

The carriage return is treated as a single character.

Is there way to get the carriage returns or its just the way its going to be stored?

Thanks for the help guys!!!

Edit: I should have explained this before. I get the data from the web development (asp .net) and I just insert it into the table. I might not be doing any data manipulation.. just insert.

I return the data to the app development (C++) and may be some data or report viewer.

I don't want to manipulate on the data.

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-26T14:02:51.513

You can store Carriage return in the database. The problem here is that you are using SQL Server Management Studio to display the results of your query. You probably have it configured to show the results in a grid. Change the configuration of SSMS to show results to text and you will see the carriage returns.

Right click in the query window -> Results To -> Results To Text

Run your query again.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T14:11:42.367

```
INSERT INTO table values('test1' + CHAR(10) + 'test2' + CHAR(10) + 'test3' + CHAR(10) + 'test4') 
```

这应该这样做。要查看效果，请将查询结果窗口切换为纯文本输出。

问候

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T14:03:41.573

IIRC, using chr(13) + chr(10) should works.

```
insert into table values ('test1' + chr(13) + chr(10) + 'test2' ); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T14:02:23.560

Can you please clarify how you retrieve the data back from the database? What tool do you use? The data probably contains the carriage returns but it's not displayed if you get the results in grid (try the results in text option)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T14:02:37.910

You might need to put in a "\n" instead of a literal carriage return.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T14:03:25.257

The carriage return is stored as is. The problem here is that your sql client is not understanding it. If you did a raw dump of this data you'll see that the carriage returns are there in the data.

I use DBArtisan at work and it seems to work fine. However isql seems to have the same problem that you reported.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T14:04:02.667

Is this result in your HTML or in Query analyser? If it's in HTML, have a look at the source code and it might appear correct there, in which case you'd have to replace the crlf characters with `<br />` tags.

I'm also thinking that there used to be attributes you could add to an HTML textarea to force it to send carriage returns in certain ways -- soft or hard? I haven't looked that up, perhaps someone could do that.

But SQL Server does save the two characters in my experience. In fact I did exactly as you described here a few days ago using SQL 2005 and each line break has two unprintable characters.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-09-18T09:52:45.240

我正在使用 SQLite 存储多行 texbox，并在检索存储的数据并将其显示在任何对象（txtbox、标签等）上时得到类似的结果。每当我将数据复制到记事本/写字板或类似设备中时，我都可以看到回车已存储，它们根本没有显示在 ASP 页面中。

在这里找到了答案：

[http://www.mikesdotnetting.com/Article/20/How-to-retain-carriage-returns-or-line-breaks-in-an-ASP.NET-web-page](http://www.mikesdotnetting.com/Article/20/How-to-retain-carriage-returns-or-line-breaks-in-an-ASP.NET-web-page)

希望有帮助。

我的代码示例：

C＃：

```
 protected void Page_Load(object sender, EventArgs e)
    {
        String str = Request.QueryString["idNoticia"];
        this.dsNewsDetails.FilterExpression = "idNoticia=" + str;
    } 
```

ASPX：

```
 <asp:Label ID="BodyLabel" 
         runat="server" style="font-size: medium" 
         Text='<%# Eval("body").ToString().Replace(Environment.NewLine,"<br/>") %>' Width="100%" /> 
```

注意：如提供的链接中所述，Environment.NewLine 适用于 C# 和 VB

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-11-09T07:21:10.967

如果将输出切换为纯文本，您可以在不同的行中看到数据。要切换输出，请转到`Tools>Options>Query Results`并将默认目标设置为：文本。您也可以`Ctrl+p`在执行查询之前尝试点击。希望能帮助到你。

# logging - 阅读 glassfish 日志的工具？

> ID：139683
> 
> 赞同：6
> 
> 时间：2008-09-26T14:01:19.303
> 
> 标签：logging, glassfish

我正在处理巨大的 glassfish 日志文件（在 windows 中，eek ！），而且……写字板没有削减它。

是否有任何工具可以以更智能的方式处理这些日志文件？受欢迎的功能：

*   查看某个日志级别的所有行（信息、警告、严重）
*   显示两个时间戳之间的日志
*   发生计数器（此异常在时间 x 和时间 y 之间被抛出 99 次）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T19:29:16.800

在 Windows 上，我仍然会使用 perl 或 awk。下载并安装[cygwin](http://cygwin.com)，然后使用 awk 或任何你熟悉的东西。awk 具有过滤所需的时间功能，以及`getline`日志文件导航等功能。

例如：异常发生计数 - 所有时间

```
$ awk '/^java.*:\W/ {print $1}' server.log* |sort|uniq -c|sort -nr
 60 javax.ejb.EJBException:
 45 java.rmi.ServerException:
  2 javax.persistence.PersistenceException:
  2 javax.ejb.ObjectNotFoundException:
  1 java.lang.Error: 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T14:02:56.087

尝试 UltraEdit（付费）或 Notepad++（免费）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-06T11:47:17.837

试试 MS LogParser 工具： [http ://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)

基本上将您的平面日志文件变成一个“数据库”，您可以在其上运行类似 SQL 的查询。您甚至可以以表格、图表和图形的形式输出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-25T11:02:49.703

[http://sourceforge.net/project/screenshots.php?group_id=212019](http://sourceforge.net/project/screenshots.php?group_id=212019)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T14:19:05.140

我使用 Excel 来解析日志文件。如果您使用制表符分隔的日志文件，这可以很好地工作。Excel 的过滤和排序功能非常适合日志文件分析。

# c++ - Should Local Variable Initialisation Be Mandatory?

> ID：139686
> 
> 赞同：11
> 
> 时间：2008-09-26T14:02:19.567
> 
> 标签：c++, c, performance, optimization

The maintenance problems that uninitialised locals cause (particularly pointers) will be obvious to anyone who has done a bit of c/c++ maintenance or enhancement, but I still see them and occasionally hear performance implications given as their justification.

It's easy to demonstrate in c that redundant initialisation is optimised out:

```
$ less test.c
#include <stdio.h>
main()
{
#ifdef INIT_LOC
    int a = 33;
    int b;
    memset(&b,66,sizeof(b));
#else
    int a;
    int b;
#endif
    a = 0;
    b = 0;
    printf ("a = %i, b = %i\n", a, b);
}

$ gcc --version
gcc (GCC) 3.4.4 (cygming special, gdc 0.12, using dmd 0.125) 
```

[Not Optimised:]

```
$ gcc test.c -S -o no_init.s; gcc test.c -S -D INIT_LOC=1 -o init.s; diff no_in
it.s init.s
22a23,28
>       movl    $33, -4(%ebp)
>       movl    $4, 8(%esp)
>       movl    $66, 4(%esp)
>       leal    -8(%ebp), %eax
>       movl    %eax, (%esp)
>       call    _memset
33a40
>       .def    _memset;        .scl    3;      .type   32;     .endef 
```

[Optimised:]

```
$ gcc test.c -O -S -o no_init.s; gcc test.c -O -S -D INIT_LOC=1 -o init.s; diff
 no_init.s init.s
$ 
```

So WRT performance under what circumstances is mandatory variable initialisation NOT a good idea?

IF applicable, no need to restrict answers to c/c++ but please be clear about the language/environment (and reproducible evidence much preferred over speculation!)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T14:10:01.997

简短的回答：声明变量尽可能接近第一次使用，如果仍然需要，初始化为“零”。

长答案：如果您在函数的开头声明一个变量，并且直到稍后才使用它，您应该重新考虑将变量放置在尽可能本地的范围内。然后，您通常可以立即为其分配所需的值。

如果您必须声明它未初始化，因为它是在条件中分配的，或者通过引用传递并分配给，将其初始化为等效于 null 的值是一个好主意。如果您在 -Wall 下编译，编译器有时可以节省您的时间，因为如果您在初始化变量之前读取变量，它会发出警告。但是，如果您将其传递给函数，它不会警告您。

如果您安全行事并将其设置为 null 等效项，那么如果您传递给它的函数覆盖它，您不会造成任何伤害。但是，如果您传递给它的函数使用该值，则几乎可以保证您的断言失败（如果您有断言），或者至少在您使用空对象的第二次发生段错误。随机初始化可以做各种各样的坏事，包括“工作”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T14:40:34.560

如果您认为初始化是多余的，那就是。我的目标是编写尽可能易读的代码。不必要的初始化会使未来的读者感到困惑。

C 编译器在捕捉单元化变量的使用方面做得非常好，所以现在这种危险已经很小了。

不要忘记，通过进行“假”初始化，您可以在一个危险中进行交易——在使用垃圾时崩溃（这会导致一个非常容易找到和修复的错误）在另一个上——程序基于假值采取错误的操作（这会导致到一个很难找到的错误）。选择取决于应用程序。对于一些人来说，永远不要崩溃是至关重要的。对于大多数人来说，最好尽快发现错误。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T14:19:39.557

This is a great example of **Premature optimization is the root of all evil**

The full quote is:

> There is no doubt that the grail of efficiency leads to abuse. Programmers waste enormous amounts of time thinking about, or worrying about, the speed of noncritical parts of their programs, and these attempts at efficiency actually have a *strong negative impact when debugging and maintenance are considered*. **We should forget about small efficiencies, say about 97% of the time: premature optimization is the root of all evil.** Yet we should not pass up our opportunities in that critical 3%. A good programmer will not be lulled into complacency by such reasoning, he will be wise to look carefully at the critical code; but only after that code has been identified.

This came from [Donald Knuth](http://shreevatsa.wordpress.com/2008/05/16/premature-optimization-is-the-root-of-all-evil/). who are you going to believe...your colleagues or Knuth?
I know where my money is...

To get back to the original question: "Should we MANDATE initialization?"
I would phrase it as so:

> Variables **should** be initialize, except in situation where it can be demonstrated there is a *significant* performance gain to be realized by not initializing. Come armed with hard numbers...

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T14:09:22.233

我不确定是否有必要“强制它们”，但我个人认为初始化变量总是更好。如果应用程序的目的是尽可能紧凑，那么 C/C++ 就是为此目的而开放的。但是，我认为我们中的许多人已经被烧毁了一两次，因为没有初始化变量并假设它包含一个有效值（例如指针），而实际上它没有。与地址为零的指针相比，它是否具有来自该特定位置的最后内存内容的随机垃圾更容易检查。我认为在大多数情况下，这不再是性能问题，而是清晰度和安全性问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T14:39:23.360

它应该*是强制性*的。*其原因与性能*无关，而是使用统一变量的危险。但是，在某些情况下，它看起来很荒谬。例如，我见过：

```
struct stat s;
s.st_dev = -1;
s.st_ino = -1;
s.st_mode = S_IRWXU;
s.st_nlink = 0;
s.st_size = 0;
// etc...
s.st_st_ctime = -1;
if(stat(path, &s) != 0) {
   // handle error
   return;
} 
```

怎么回事？？？

请注意，我们正在立即处理错误，因此毫无疑问如果统计失败会发生什么。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-30T14:54:33.230

让我告诉你一个关于我在 1992 年工作的产品的故事，后来，为了这个故事的目的，我们将其称为 Stackrobat。我被分配了一个错误，导致应用程序在 Mac 上崩溃，但在 Windows 上却没有，哦，而且该错误无法可靠地重现。QA 花了一周的大部分时间才想出一个可能 10 次有效的食谱。

由于实际崩溃发生在执行此操作之后很久，因此追查根本原因是地狱。

最终，我通过为编译器编写自定义代码分析器来追踪它。编译器很乐意注入对全局 prof_begin() 和 prof_end() 函数的调用，您可以自由地自己实现它们。我编写了一个分析器，它从堆栈中获取返回地址，找到了堆栈帧创建指令，找到了堆栈上代表函数局部变量的块，并在它们上涂上了一层可口的废话，如果有的话会导致总线错误元素被取消引用。

这捕获了初始化之前使用的指针的六个错误，包括我正在寻找的错误。

所发生的情况是，大多数时候堆栈碰巧具有如果取消引用它们显然是良性的值。其他时候，这些值会导致应用程序对自己的堆进行shotgun，在很久以后的某个时间取出应用程序。

我花了两个多星期试图找到这个错误。

教训：初始化你的本地人。如果有人对您咆哮，请向他们展示此评论并告诉他们您宁愿花两周时间运行分析代码并修复瓶颈，而不必追踪此类错误。自从我不得不这样做以来，调试工具和堆检查器已经变得更好了，但坦率地说，它们变得更好，以弥补像这样的不良做法造成的错误。

除非您在小型系统（嵌入式等）上运行，否则本地人的初始化应该几乎是免费的。MOVE/LOAD 指令非常非常快。首先编写可靠且可维护的代码。将其重构为性能第二。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T14:58:23.440

这仅适用于 C++，但两种方法之间存在明显区别。假设您有一个 class `MyStuff`，并且您想由另一个类初始化它。您可以执行以下操作：

```
// Initialize MyStuff instance y
// ...
MyStuff x = y;
// ... 
```

这实际上是调用 x 的复制构造函数。它与以下内容相同：

```
MyStuff x(y); 
```

这与此代码不同：

```
MyStuff x; // This calls the MyStuff default constructor.
x = y; // This calls the MyStuff assignment operator. 
```

当然，复制构造与默认构造+分配时调用的代码完全不同。此外，对复制构造函数的一次调用可能比构造后赋值更有效。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T14:07:59.787

有时你需要一个变量作为占位符（例如使用`ftime`函数），所以在调用初始化函数之前初始化它们是没有意义的。

但是，在我看来，注释您意识到陷阱的事实并不坏，这会妨碍

```
uninitialized time_t t;
time( &t ); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T14:18:22.023

In C/C++ I totally agree with you.

In Perl when I create a variable it is automatically put to a default value.

```
my ($val1, $val2, $val3, $val4);
print $val1, "\n";
print $val1 + 1, "\n";
print $val2 + 2, "\n";
print $val3 = $val3 . 'Hello, SO!', "\n";
print ++$val4 +4, "\n"; 
```

They are all set to undef initially. Undef is a false value, and a place holder. Due to the dynamic typing if I add a number to it, it assumes that my variable is a number and replaces undef with the eqivilent false value 0\. If i do string operations a false version of a string is an empty string, and that gets automatically substituted.

```
[jeremy@localhost Code]$ ./undef.pl

1
2
Hello, SO!
5 
```

So for Perl at least declare early and don't worry. Especially as most programs have many variables. You use less lines and it looks cleaner without explicit initializing.

```
 my($x, $y, $z); 
```

:-)

```
 my $x = 0;
 my $y = 0;
 my $z = 0; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T14:26:36.980

Always initialize local variables to zero at least. As you saw, there's no real performance it.

```
int i = 0;
struct myStruct m = {0}; 
```

You're basically adding 1 or 2 assembly instructions, if that. In fact, many C runtimes will do this for you on a "Release" build and you won't be changing a thing.

But you should initalize it because you will now have that guarantee.

One reason not to initialize has to do with debugging. Some runtimes, eg. MS CRT, will initialize memory with predetermined and documented patterns that you can identify. So when you're pouring through memory, you can see that the memory is indeed uninitialized and that hasn't been used and reset. That can be helpful in debugging. But that's during debugging.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T14:12:00.463

表现？如今？也许当 CPU 以 10mhz 运行时它确实是有道理的，但今天它几乎不是问题。始终初始化它们。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-12T05:37:06.220

是的：除非您有充分的理由不这样做，否则请始终初始化您*的*变量*。*如果我的代码不需要特定的初始值，我通常会将变量初始化为一个值，如果后面的代码被破坏，该值将*保证出现明显的错误。*

 *** * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T15:32:02.860

举个简单的例子，你能确定这将被初始化成什么（C/C++）吗？

```
bool myVar; 
```

我们在产品中遇到了一个问题，有时会在屏幕上绘制图像，有时不会，通常取决于构建它的机器。事实证明，在我的机器上它被初始化为假，而在同事的机器上它被初始化为真。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T17:45:21.183

我认为在大多数情况下使用默认值初始化变量是一个坏主意，因为它只是隐藏了错误，而这些错误很容易在未初始化的变量中找到。如果您忘记获取和设置实际值，或者不小心删除了获取代码，您可能永远不会注意到它，因为在许多情况下 0 是一个合理的值。大多数情况下，使用值 >> 0 触发这些错误要容易得多。

例如：

```
 void func(int n)
{
    int i = 0;

    ... // Many lines of code

    for (;i < n; i++)
        do_something(i); 
```

一段时间后，您将添加一些其他内容。

```
 void func(int n)
{
    int i = 0;

    for (i = 0; i < 3; i++)
        do_something_else(i);

    ... // Many lines of code

    for (;i < n; i++)
        do_something(i); 
```

现在你的第二个循环不会从 0 开始，而是从 3 开始，这取决于函数的作用，它可能很难找到，甚至存在错误。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-26T14:25:36.390

Sometimes a variable is used to "collect" the result of a longer block of nested ifs/elses... In those cases I sometimes keep the variable uninitialized, because it *should* be initialized later by one of the conditional branches.

The trick is: if I leave it uninitialized at first and then there's a bug in the long if/else block so the variable is never assigned, I can see that bug in Valgrind :-) which of course requires to frequently run the code (ideally the regular tests) through Valgrind.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-26T14:12:33.690

正如您在performacne 方面所展示的那样，它并没有什么不同。编译器将（在优化的构建中）检测是否写入了局部变量而没有读取并删除代码，除非它有其他副作用。

就是说：如果您使用简单的语句初始化东西只是为了确保它已初始化，那么这样做是可以的。我个人不这样做，原因有一个：

它欺骗那些可能在以后维护您的代码的人认为需要初始化。那个小 foo = 0; 会增加代码复杂度。除此之外，这只是一个品味问题。

如果您通过复杂的语句不必要地初始化变量，它可能会产生副作用。

例如：

```
 float x = sqrt(0); 
```

如果您幸运并使用聪明的编译器，可能会被您的编译器优化。使用不太聪明的编译器也可能导致代价高昂且不必要的函数调用，因为 sqrt 可以 - 作为副作用 - 设置 errno 变量。

如果你调用你自己定义的函数，我最好的选择是，编译器总是假设它们可能有副作用并且不会优化它们。如果函数恰好在同一个翻译单元中，或者您打开了整个程序优化，那可能会有所不同。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-30T14:26:54.760

只是次要观察。初始化仅在原始类型上或由 const 函数分配时才容易优化。

a= foo();

a= foo2();

无法轻松优化，因为 foo 可能有副作用。

此外，在时间之前进行堆分配可能会导致巨大的性能损失。取一个类似的代码

```
void foo(int x) 
```

{

ClassA *instance= new ClassA();

//... 做一些与“实例”无关的事情... if(x>5) {

```
delete instance;

return; 
```

}

//.. 做一些使用实例的事情

}

在这种情况下，只需在您将使用它时声明实例，并仅在那里初始化它。并且没有编译器无法为您优化，因为构造函数可能具有代码重新排序会改变的副作用。

编辑：我无法使用代码列表功能：P

# enterprise-library - .NET 企业库 2008 年 5 月的最新版本是否具有更新程序应用程序块？

> ID：139700
> 
> 赞同：0
> 
> 时间：2008-09-26T14:03:37.567
> 
> 标签：enterprise-library

最新版本的企业库 ( [http://msdn.microsoft.com/en-us/library/cc512464.aspx](http://msdn.microsoft.com/en-us/library/cc512464.aspx) ) 是否附带更新程序应用程序块？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T14:22:37.067

看起来没有：

[http://msdn.microsoft.com/en-us/library/cc511823.aspx](http://msdn.microsoft.com/en-us/library/cc511823.aspx)

它现在位于 MSDN 文档的“归档应用程序块”部分。

[http://msdn.microsoft.com/en-us/library/cc485231.aspx](http://msdn.microsoft.com/en-us/library/cc485231.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T15:51:19.787

不会。Microsoft 认为更新程序应用程序块将被 .NET 2.0 中的 ClickOnce 替换。.NET 1.1 的企业库不再更新。

# c++ - 不能从调试 dll 很好地导入间接 Typelib

> ID：139705
> 
> 赞同：2
> 
> 时间：2008-09-26T14:03:54.553
> 
> 标签：c++, visual-c++, import, typelib

使用 VC2005，我有 3 个项目要构建：

*   libA（包含一个类型库，生成 libA.dll）：IDL 有一行`library libA { ...`
*   libB（包含一个导入libA的typelib，结果是libB.dll）：IDL有一行 `importlib( "libA " );`
*   libC（导入 libB）：源文件之一包含`#import <libB.dll>`

由编译器按以下`#import <libB.dll>`方式处理（根据文档）：

1.  搜索 %PATH% 的目录
2.  搜索 %LIB% 的目录
3.  搜索“其他包含路径”（/I 编译器选项）

编译 libC 时，我可以看到 cl.exe 清楚地能够在可执行路径上找到 libA.dll（使用 Filemon.exe）

VC 错误 C4772: #import of typelib 与另一个依赖项

但是，仍然找不到 libA 命名空间，*并且*所有对 libA 类型的引用都替换为`__missing_type__`

（编辑）同时，我发现问题仅在使用调试 dll 时出现。

以前有人见过这个问题吗？并解决了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T14:19:16.187

您是否明确设置项目的依赖项？换句话说，您是否在 IDE 中设置了解决方案，以便项目 C 依赖于项目 B，而项目 B 依赖于项目 A？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T21:41:36.297

您是否使用 libC 中的 libA 中定义的类型？如果是这样，我认为您需要直接从 libC 导入 libA，以便它知道 libA 的类型。COM 不会自动引用其他类型库引用的类型库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T20:31:54.520

我没有给你答案，但我有过几次这样的经历，我想分享我所做的。

在几个不相关的项目中，我遇到了同样的情况。在一个案例中，我尝试了将近一周的时间来解决依赖关系，但最终我不得不减少损失以保持进度。我最终在 .tlh 文件上使用了 #include（在 DLL 上执行导入将生成这些），然后使用“经典 com”api 调用来获取指向 .tlh 文件中结构的指针。代码不像可以使用包装文件那样干净，但它可以工作。

```
IUnknown *lpUnk;
hr = CoCreateInstance(clsID, NULL, CLSCTX_LOCAL_SERVER, IID_IUnknown, (void **)&lpUnk);
if (FAILED(hr)) throw SomeException;  

                                          //
_Application *app;                        //Address _Application  
hr = lpUnk->QueryInterface(__uuidof(_Application), (void **) &app);
lpUnk->Release();
if (FAILED(hr)) throw SomeException;  

                                          // Do stuff with the app object  
app->Release();                           // Then release 
```

您可以通过使用 CComPtr 包装器模板在其超出范围时使用其析构函数可靠地进行释放，从而对其进行某种程度的“去丑化”：

```
CComPtr<IUnknown> lpUnk;
hr = CoCreateInstance(clsID, NULL, CLSCTX_LOCAL_SERVER, IID_IUnknown, (void **)lpUnk);
if (FAILED(hr)) throw SomeException;  
                                          //
CComPtr<_Application> app;                //Address _Application  
hr = lpUnk->QueryInterface(__uuidof(_Application), (void **) &app);
if (FAILED(hr)) throw SomeException;
                                         //
                                         // Do stuff with the app object 
```

请注意，_Application 指针是使用 .tlh 文件中的结构之一的示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-23T14:44:40.637

终于找到了！

在 Visual Studio 项目中，LibA 中的 A.idl 文件的**MkTypeLib Compatible**设置为 ON。这推翻了从 A 项目继承的行为。更糟糕的是，它仅在 Debug 配置中为 ON。

结果是，对于每个

```
typedef [public] tagE enum { cE1, cE2 } eE; 
```

这导致`tagE`未在生成的类型库中定义。当 LibB 这样做时`import( "A.dll" )`，所有对 的引用`tagE`都被替换为`__missing_type__`...

# php - PHP parse_ini_file() - 它在哪里看？

> ID：139721
> 
> 赞同：3
> 
> 时间：2008-09-26T14:06:35.187
> 
> 标签：php, file, parsing, path, ini

如果我调用 php `parse_ini_file("foo.ini")`，它会在哪些路径中查找 foo.ini ？包含路径？该函数的文档没有提到它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T14:40:19.803

[parse_ini_file 的 filename 参数是标准的 php 文件名，因此与使用fopen](http://us3.php.net/manual/en/function.fopen.php)打开文件的规则相同。

您必须指定绝对文件路径（“/path/to/my.ini”）或相对于当前工作目录的路径（“my.ini”）。查看当前工作目录的[getcwd 。](http://us3.php.net/manual/en/function.getcwd.php)

与默认的 fopen 命令不同，如果指定了相对路径（“my.ini”），则 parse_ini_file**将**在搜索当前工作目录后搜索包含路径。我在 php 5.2.6 中验证了这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T14:10:25.303

我想它只在当前工作目录中查找 -如果您想知道那是什么，请参阅[http://uk3.php.net/manual/en/function.getcwd.php 。](http://uk3.php.net/manual/en/function.getcwd.php)

您始终可以通过基于 $_SERVER['DOCUMENT_ROOT'] 找到相对于您的应用程序的路径

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T14:11:11.727

它可能取决于您的配置，但主要是当前目录，然后是 include_path

# javascript - 哪个 Javascript 框架最简单、最强大？

> ID：139723
> 
> 赞同：2
> 
> 时间：2008-09-26T14:06:57.120
> 
> 标签：javascript, frameworks

我一直在使用各种 javascript 框架，包括 mootools、jquery、prototype 和 scriptaculous，并且发现它们都很好，但很难扩展到更复杂的想法。

如果我要认真学习一个，哪个是最简单的扩展和使用，同时保持足够强大以在各种方向上使用？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-26T14:23:36.910

我建议使用 jQuery。

我将向您介绍我的团队昨天为高级管理层所做的演示文稿中的一些主要论点，以说服他们相信这一点。

原因：

1.  社区接受。看看[这张图](http://google.com/trends?q=jquery%2C+prototype%2C+yui%2C+scriptaculous+&ctab=0&geo=all&date=all&sort=0)。它显示了从 2004 年到 2008 年对“prototype”、“yui”和“scriptaculous”的搜索量增长。然后在 2006 年对“jquery”的搜索量突然增加了一倍。社区实际上正在集中在一个领先的产品上，那就是 jQuery。

2.  jQuery 非常简洁易读。我进行了一个实验，其中我使用 YUI 编写的现有代码（随机选择），并尝试用 jQuery 重写它。它是 jQuery 的 1/4。这使它易于编写 4 倍，易于维护 4 倍。

3.  jQuery 与 Web 世界的其他部分很好地集成在一起。使用 CSS 语法作为选择项目的关键是一个绝妙的技巧，它有助于将高度不同的 HTML、CSS 和 JavaScript 世界融合在一起。

4.  文档：jQuery 有优秀的文档，每个方法都有清晰的规范和工作示例。它有优秀的书籍（我推荐“jQuery in Action”。）唯一匹配它的竞争对手是 YUI。

5.  活跃用户社区：Prototype 的主要社区讨论论坛 Google 群组拥有近 1000 名成员。jQuery 的 Google 组的成员数量是其 10 倍。我个人的经验是，社区往往会有所帮助。

6.  轻松的学习曲线。jQuery 很容易学习，即使对于有设计经验但没有编码经验的人来说也是如此。

7.  表现。看看[这个](http://mootools.net/slickspeed/)，它是由 mootools 发布的。它比较了不同框架的速度。jQuery 并不总是最快的，但它在每个测试中都非常好。

8.  与其他人一起玩得很好：jQuery 的 noConflict 模式和核心库的小尺寸有助于它在已经使用其他库的环境中很好地工作。

9.  旨在使 JavaScript 可用。循环是 JavaScript 的一大痛点。jQuery 使用你几乎不需要编写循环的集合对象。JavaScript 最大的优势在于函数是一流的对象。jQuery 广泛使用了这个特性。

10.  插件。jQuery 旨在使编写插件变得*容易。*那里有一个庞大的社区编写插件。您想要的任何东西都可能在那里。查看类似[this](http://ui.jquery.com/repository/real-world/effects/)或[this](http://interface.eyecon.ro/demos/)的内容以获取视觉示例。

我希望你觉得这很有说服力！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T14:10:51.323

在我看来，jQuery 非常强大和简单。它使用 CSS 选择器语法来拉回元素，并且只向全局命名空间添加了两个函数：jQuery() 和 $()，它是 jQuery() 的别名。

有大量可用于 jQuery 的插件，让您可以创建幻灯片、手风琴控件、丰富的日历等。“jQuery In Action”一书是在线参考资料的绝佳伴侣。

我们在我的上一个项目中使用它来创建一个相当丰富的调度工具，我们非常喜欢它，我们鼓励我们的咨询公司采用它作为所有 JavaScript 使用的事实上的标准。[您可以在http://www.stanleysteemer.com](http://www.stanleysteemer.com)查看结果

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T14:17:08.237

另见（其他相关问题）：

*   [Javascript库的比较](https://stackoverflow.com/questions/35050/comparison-of-javascript-libraries)
*   [你会为一个新项目选择什么 JavaScript 库，为什么？](https://stackoverflow.com/questions/913/what-javascript-library-would-you-choose-for-a-new-project-and-why)
*   [对于富互联网应用程序来说，最有用的通用 JavaScript 库是什么？](https://stackoverflow.com/questions/68114/general-purpose-javascript-library-for-building-rich-internet-applications)
*   [哪个 JavaScript 框架最适合 Web 开发？](https://stackoverflow.com/questions/70946/which-javascript-framework-is-best-for-web-development)
*   [推荐哪个 JavaScript 库用于整洁的 UI 效果？](https://stackoverflow.com/questions/78570/which-javascript-library-is-recommended-for-neat-ui-effects)
*   [什么是最好的轻量级 JavaScript 框架？](https://stackoverflow.com/questions/74048/what-is-the-best-lightweight-javascript-framework)
*   [Google App Engine 应用程序有什么好的 AJAX 框架吗？](https://stackoverflow.com/questions/53997/any-good-ajax-framework-for-google-app-engine-apps)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T14:08:25.730

jQuery是我的最爱

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T14:15:14.277

[原型](http://prototypejs.org/)。简单、不显眼，并使您的 javascript 代码看起来比以往更干净。

它有一个[很棒的用户群](http://groups-beta.google.com/group/prototype-scriptaculous?pli=1)，在那里你几乎可以立即得到你的问题的解答。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T14:10:06.893

又一票给 jQuery。它体积小，专注，但非常强大。根据 JS 库的（通常很糟糕的）标准，它也有合理的文档记录。

一旦你了解了语法，它也很容易扩展。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-12-03T11:47:34.973

**注意：**这个答案是 Angular/Ember/etc 之前的。所以解决了一个过时的问题。

我教这些东西，实际上别无选择，只能专注于 JQuery，因为行业中的大多数人已经“选择”了它（我知道，这并不总是一个好的理由），但也因为 - 对于已经了解一些知识的学生CSS - 入口点较低。

我也使用过 Mootools（我的第二选择），但一位同事说服我使用“可编程性”参数切换到 JQuery——我发现它更易于编码和理解。JQuery 社区、在线文档、[免费在线书籍](http://book.learningjquery.com/)和[第三方网站](http://jqueryfordesigners.com/)也有帮助。

# coding-style - 哪种语法更适合返回值？

> ID：139739
> 
> 赞同：4
> 
> 时间：2008-09-26T14:09:28.347
> 
> 标签：coding-style, return-value

我一直在进行大规模的代码审查，我注意到的一个模式是：

```
public bool MethodName()
{
    bool returnValue = false;
    if (expression)
    {
        // do something
        returnValue = MethodCall();
    }
    else
    {
        // do something else
        returnValue = Expression;
    }

    return returnValue;
} 
```

这不是我会这样做的方式，当我知道它是什么时，我会返回该值。这两种模式哪个更正确？

我强调逻辑似乎总是这样结构化，使得返回值仅在一个地方分配，并且在分配后不执行任何代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T14:15:14.527

很多人建议您的方法中只有一个退出点。您上面描述的模式遵循该建议。

该建议的主要要点是，如果您必须在从方法返回之前清理一些内存或状态，最好只将这些代码放在一个地方。拥有多个退出点会导致清理代码重复或由于一个或多个退出点缺少清理代码而导致潜在问题。

当然，如果你的方法有几行长，或者不需要任何清理，你可以有多个返回。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T14:11:24.597

我会使用三元来减少控制结构......

```
 return expression ? MethodCall() : Expression; 

```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T14:13:16.327

我怀疑我会是少数，但我喜欢示例中呈现的风格。添加日志语句并设置断点很容易，IMO。另外，当以一致的方式使用时，“模式匹配”似乎比多次返回更容易。

但是，我不确定对此是否有“正确”的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T14:16:01.060

That looks like a part of a bad OOP design. Perhaps it should be refactored on the higher level than inside of a single method.

Otherwise, I prefer using a ternary operator, like this:

```
return expression ? MethodCall() : Expression; 
```

It is shorter and more readable.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T14:12:48.043

一些学习机构和书籍提倡单一返回的做法。

好不好是主观的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T05:35:44.620

在以下任何一种情况下立即从方法返回：

1.  您找到了一个边界条件，需要返回一个唯一值或标记值：`if (node.next = null) return NO_VALUE_FOUND;`
2.  所需的值/状态为 false，因此该方法的其余部分不适用（也称为保护子句）。例如：`if (listeners == null) return null;`
3.  该方法的目的是查找并返回一个特定的值，例如：`if (nodes[i].value == searchValue) return i;`
4.  您在一个子句中，该子句从方法中其他地方未使用的方法返回唯一值：`if (userNameFromDb.equals(SUPER_USER)) return getSuperUserAccount();`

否则，只有一个 return 语句很有用，以便更容易添加调试日志记录、资源清理和遵循逻辑。我尝试首先处理上述所有 4 种情况，如果它们适用，然后`result(s)`尽可能晚地声明一个变量，并根据需要为其赋值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T14:39:32.143

使用的模式很冗长 - 但如果您想知道返回值而不打开 Registers 窗口并检查 EAX，它也更容易调试。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T14:17:01.060

Delphi forces this pattern by automatically creating a variable called "Result" which will be of the function's return type. Whatever "Result" is when the function exits, is your return value. So there's no "return" keyword at all.

```
function MethodName : boolean;
begin
  Result := False;
  if Expression then begin
    //do something
    Result := MethodCall;
  end
  else begin
    //do something else
    Result := Expression;
  end;

  //possibly more code
end; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T14:12:39.603

他们都完成了相同的任务。有人说一个方法应该只有一个入口和一个出口点。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T14:12:52.223

我也用这个。这个想法是可以在程序的正常流程中释放资源。如果您在 20 个不同的地方跳出一个方法，并且之前需要调用 cleanUp()，那么您将不得不添加另一个清理方法 20 次（或重构所有内容）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T14:13:53.483

我猜编码器已经采取了在方法顶部定义一个对象 toReturn 的设计（例如，List<Foo> toReturn = new ArrayList<Foo>();）然后在方法调用期间填充它，并以某种方式决定将其应用于布尔返回类型，这很奇怪。

也可能是编码标准的副作用，该标准规定您不能在方法主体的中间返回，只能在最后。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T14:14:42.080

即使现在分配返回值后没有执行任何代码，但这并不意味着以后不必添加某些代码。

它不是可以使用的最小的代码片段，但它对重构非常友好。

# mocking - 何时使用部分模拟？

> ID：139752
> 
> 赞同：7
> 
> 时间：2008-09-26T14:10:59.577
> 
> 标签：mocking

我开始对假货、存根、模拟和动态模拟的想法感到满意。但是我对何时使用部分模拟的理解仍然有些不确定。

如果您打算模拟一项服务并且需要使用部分模拟，那么这似乎是设计不佳的标志。是否部分模拟主要用于在测试覆盖范围内获取遗留代码？

另一方面，假设我正在测试一个具有 Reset() 方法的类。如果我已经在单独的测试中确认 Reset() 方法有效，并且类的某些功能应该以调用此方法结束，那么对对象进行部分模拟并运行是否是糟糕的测试设计针对部分模拟进行测试，在 Reset() 方法上定义一个期望。

我目前有几个以这种方式设置的测试，这种事情以后会给我带来麻烦吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T14:22:12.327

Its good design, imho. What happens when somebody comes after you and changes your method, removing the call to Reset? (btw, why so much state in your objects?) You might never know they screwed up until you hit production. By mocking it and asserting on that method call, you can assure nobody is going to mess up while maintaining your code.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-18T18:17:04.463

在您的示例中，听起来该`Reset`方法是一个实现细节，并且通过使用部分模拟，您有将测试耦合到类的实现的危险。这将使您的测试比它需要的更脆弱。

我还认为让一个对象具有一些具有实际实现的方法和一些具有存根实现的对象会使测试更加混乱。当您稍后返回测试时，这只是要记住的另一件事。

您是否可以（a）使用基于状态的测试来断言在`Reset`内部调用真实方法后对象的状态与您期望的一样；或者 (b) 使用基于交互的测试来验证对协作对象的相关调用是否已作为真实`Reset`方法的结果进行？

您可能会发现来自 mockobjects.com 的[Test Smell: Mocking 具体类很有用。](http://www.mockobjects.com/2007/04/test-smell-mocking-concrete-classes.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T14:36:48.843

One could argue that all mocks are 'partial' in that they do not fully implement an interface. As you are trying to test a very focused piece of functionality, you should only mock those aspects of supporting classes that are necessary to exercise the piece of functionality you are testing.

This will allow your test to be decoupled from other tests, which is nice.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T14:14:01.817

我对部分mock的理解是，它是用来mock抽象类的，只mock抽象方法，而保留现有的具体方法？

# cvs - CVS：列出标签（或日期）之间更改的所有文件

> ID：139759
> 
> 赞同：57
> 
> 时间：2008-09-26T14:11:44.003
> 
> 标签：cvs

有没有办法列出 CVS 中两个标签之间更改的所有文件？

每次我们发布一个版本时，我们都会为该版本中的所有文件应用一个标签。我想查找在版本之间更改的所有文件。

如果我能找到在两个日期之间发生变化的所有文件，它也会起作用。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-26T14:27:06.853

我想这个命令会有所帮助：

```
cvs diff -N -c -r RELEASE_1_0 -r RELEASE_1_1 > diffs 
```

where`RELEASE_1_0`和`RELEASE_1_1`是标签的名称。

[您可以在此处](http://www.network-theory.co.uk/docs/cvsmanual/diffexamples.html)找到有关 cvs diff 命令的更多信息

另外，创建一个脚本以使报告更适合您的需求应该相当简单，例如：更改的文件数量，创建的删除等。据我所知，最常见的 cvs GUI 工具（wincvs 和 tortoise）不提供任何东西像这样开箱即用。

希望能帮助到你`;)`

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-17T17:00:05.207

我更喜欢使用`rdiff`和`-s`选项

```
cvs rdiff -s  -r RELEASE_1_0 -r RELEASE_1_1 module > diffs 
```

`rdiff`不需要沙箱；`-s`为您提供更改的摘要。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2010-02-26T16:24:30.783

使用 CVS 获取两个日期之间的文件列表：

```
cvs diff -N -c -D YYYY-MM-DD -D YYYY-MM-DD | grep "Index:" > diff.out 
```

有关 -D 标志的接受日期的更多信息：http: [//docs.freebsd.org/info/cvs/cvs.info.Common_options.html](http://docs.freebsd.org/info/cvs/cvs.info.Common_options.html)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-10-26T00:44:27.277

要使用标准 cvs 命令获取在一个版本和另一个版本之间发生更改的文件列表：

```
cvs -q log -NSR -rV-1-0-69::V-1-0-70 2>/dev/null >log.txt 
```

或者，要获取提交评论列表，只需删除`-R`：

```
cvs -q log -NS -rV-1-0-69::V-1-0-70 2>/dev/null >log.txt 
```

您替换的位置`V-1-0-69`以及`V-1-0-70`您正在比较的修订版。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-07-11T10:08:02.067

```
cvs log -d ">=DATE" -N -S -R > cvs.log 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T14:36:59.637

DLira 的方法给出了很多细节，包括所有的变化。

要获取文件列表，可以这样做：

```
cvs diff -N -c -r RELEASE_1_0 -r RELEASE_1_1 | grep "Index:" > diffs 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T15:18:35.873

我为此找到的最好的工具是一个名为[cvs2cl.pl](http://www.red-bean.com/cvs2cl/)的 perl 脚本。这可以生成几种不同格式的更改列表。它有许多不同的选项，但我使用了这样的标签到标签选项：

```
cvs2cl.pl --delta dev_release_1_2_3:dev_release_1_6_8 
```

或者

```
cvs2cl.pl --delta dev_release_1_2_3:HEAD 
```

我还使用相同的工具使用日期进行了比较。

# cgi - 是否有 CGI 的替代品（我真的需要一个）吗？

> ID：139760
> 
> 赞同：3
> 
> 时间：2008-09-26T14:11:46.110
> 
> 标签：cgi, ipc

我正在设计一个应用程序，它将由 3-4 个服务组成，这些服务作为单独的进程运行并由合适的 IPC 链接。该系统将有一个网络界面，我想使用那里的任何网络服务器。

应该在某个 URL 下访问 Web 界面，该 URL 允许同一 Web 服务器上的其他 URL 执行完全不同的操作。我打算使用该 URL 下面的路径来指定 Web 界面应该做什么。它具有供其他应用程序通过网络使用以及供人类在浏览器中进行交互的设施。

袖手旁观，我的工作如下：

*   让网络服务器为它收到的每个请求启动一个 CGI 进程（如 Apache 中的 SetHandler）
*   让 CGI 连接到 IPC
*   让它从后端服务中得到它需要的任何东西
*   让 CGI 根据服务的答案返回 HTML / XML 和任何 HTTP 状态

现在，我真正想要的是避免前两个步骤，或者如果我不能，避免第二个步骤，因为我担心我会在不必要的开销上浪费性能（来自其他应用程序的请求可能很频繁）。

例如，PHP 可以打开与 MySQL 数据库的持久连接，这些连接在脚本运行时仍然存在，并且下次不需要重新创建，尽管我不知道它们实际上是如何做到的。另外，据我了解，Apache 模块会在服务器启动时加载一次，因此这可能会删除第一步，但会将我与 Apache 联系起来。

那么，有什么好方法可以将特定 URL 的处理程序挂接到不同的网络服务器？我不想处理 HTTP，否则我可能只是使用代理设置到第二台服务器，但它似乎是在重新发明轮子。如果您认为 CGI 很好，并且有处理大量类似结构请求的示例，请告诉我。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T14:16:50.357

好的，我之前忽略了这一点。在这里解释我的问题让我明白了：

> FastCGI 无需为每个请求创建一个新进程，而是可以使用单个持久进程在其生命周期内处理许多请求。--[维基百科：FastCGI](http://en.wikipedia.org/wiki/FastCGI)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T15:40:32.933

即使在中等负载下，CGI 也是一个相当难以扩展的野兽。FastCGI 是一个选项，但您可能还会找到一个 mod_XXXX 包，其中 XXXX 是您的语言名称。例如，有一个用于 ruby​​、perl 和 python 的 mod，可能还有一些其他的。

# php - 我可以获得最初在包含文件中调用的 PHP 文件的路径吗？

> ID：139794
> 
> 赞同：2
> 
> 时间：2008-09-26T14:16:52.527
> 
> 标签：php, path

假设我们有`index.php`并且它存储在文件中`/home/user/public/www`并从文件中`index.php`调用该类。`Foo->bar()``inc/app/Foo.class.php`

我希望类中的 bar 函数在这个实例`Foo`中获取路径`/home/user/public/www`——我不想使用全局变量、传递变量等。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T14:21:31.673

您可以使用[debug_backtrace](http://us3.php.net/debug_backtrace)查看调用路径并获取调用此函数的文件。

一个简短的例子：

```
class Foo {
  function bar() {    
   $trace = debug_backtrace();
   echo "calling file was ".$trace[0]['file']."\n";
  }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T14:27:36.510

这不是更容易让您获得正在运行的脚本的目录吗？

```
$dir=dirname($_SERVER["SCRIPT_FILENAME"]) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T14:23:31.013

`getcwd()`获取当前工作目录

它可以通过 3rd 方模块、包含甚至您自己的代码通过发布`chdir()`.

`debug_backtrace()`正如 Devon 建议的那样，这是您正在寻找的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T14:20:55.480

找到了。获取cwd（）。

# c# - 向 WCF 主机进程发送消息

> ID：139809
> 
> 赞同：17
> 
> 时间：2008-09-26T14:18:36.873
> 
> 标签：c#, wcf

我有一个托管 WCF 服务的控制台应用程序。我希望能够从 WCF 服务中的方法触发事件并在 WCF 服务的托管过程中处理该事件。这可能吗？我该怎么做？我可以从 ServiceHost 派生一个自定义类吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T14:30:05.380

您不需要继承自`ServiceHost`. 还有其他方法可以解决您的问题。

您可以将服务类的实例而不是类型传递给`ServiceHost`. 因此，您可以在启动之前创建实例`ServiceHost`，并将您自己的事件处理程序添加到它公开的任何事件中。

这是一些示例代码：

```
MyService svc = new MyService();
svc.SomeEvent += new MyEventDelegate(this.OnSomeEvent);
ServiceHost host = new ServiceHost(svc);
host.Open(); 
```

使用这种方法时有一些注意事项，如[http://msdn.microsoft.com/en-us/library/ms585487.aspx中所述](http://msdn.microsoft.com/en-us/library/ms585487.aspx)

或者你可以有一个众所周知的单例类，你的服务实例知道并在事件发生时显式调用它的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-28T06:14:30.720

```
using ...
using ...

namespace MyWCFNamespace
{
    class Program {

        static void Main(string[] args){
            //instantiate the event receiver
            Consumer c = new Consumer();

            // instantiate the event source
            WCFService svc = new WCFService();
            svc.WCFEvent += new SomeEventHandler(c.ProcessTheRaisedEvent);

            using(ServiceHost host = new ServiceHost(svc))
            {
                host.Open();
                Console.Readline();
            }
        }
    }

    public class Consumer()
    {
        public void ProcessTheRaisedEvent(object sender, MyEventArgs e)
        {
            Console.WriteLine(e.From.toString() + "\t" + e.To.ToString());
        }
    }
}

namespace MyWCFNamespace
{
    public delegate void SomeEventHandler(object sender,MyEventArgs e)

    [ServiceBehavior(InstanceContextMode=InstanceContextMode.Single)]
    public class WCFService : IWCFService 
    {
        public event SomeEventHandler WCFEvent;

        public void someMethod(Message message)
        {
            MyEventArgs e = new MyEventArgs(message);
            OnWCFEvent(e);
        }

        public void OnWCFEvent(MyEventArgs e)
        {
            SomeEventHandler handler = WCFEvent;
            if(handler!=null)
            {
                handler(this,e);
            }
        }

    // to do 
    // Implement WCFInterface methods here
    }

    public class MyEventArgs:EventArgs
    {
        private Message _message;
        public MyEventArgs(Message message) 
        {
            this._message=message;
        }
    }
    public class Message
    {
        string _from;
        string _to;
        public string From {get{return _from;} set {_from=value;}}
        public string To {get{return _to;} set {_to=value;}}
        public Message(){}
        public Message(string from,string to)
        this._from=from;
        this._to=to;
    }
} 
```

您可以使用`InstanceContextMode = InstanceContextMode.Single`.

```
TestService svc = new TestService();
svc.SomeEvent += new MyEventHandler(receivingObject.OnSomeEvent);
ServiceHost host = new ServiceHost(svc);
host.Open();

[ServiceBehavior(InstanceContextMode=InstanceContextMode.Single)] // so that a single service instance is created
    public class TestService : ITestService
    {
        public event MyEventHandler SomeEvent;
        ...
        ...
    } 
```

# algorithm - 对数字集的相似性进行评分的算法

> ID：139811
> 
> 赞同：4
> 
> 时间：2008-09-26T14:18:50.243
> 
> 标签：algorithm, statistics

将多组数字与目标集进行比较以确定哪些数字最“相似”的算法是什么？

该算法的一种用途是将今天的每小时天气预报与历史天气记录进行比较，以找到具有相似天气的一天。

两组的相似度有点主观，所以算法真的只需要区分好匹配和坏匹配。我们有很多历史数据，所以我想通过自动丢弃不接近的集合并尝试将“最佳”匹配项放在顶部来尝试缩小用户需要查看的天数名单。

**编辑**：理想情况下，算法的结果与使用不同数据集的结果相当。例如，使用[Niles](https://stackoverflow.com/questions/139811/algorithm-to-score-similarness-of-sets-of-numbers#139842)建议的均方误差会产生很好的结果，但比较温度时生成的数字无法与其他数据（如风速或降水）生成的数字进行比较，因为数据的规模不同。一些非天气数据非常大，因此均方误差算法生成的数字为数十万，而使用温度生成的数字为数十或数百。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T14:22:51.543

我认为均方误差度量可能适用于天气比较等应用程序。它很容易计算并给出有意义的数字。

由于您想随着时间的推移比较测量值，您可以在计算中忽略缺失值。

对于没有时间限制甚至未排序的值，多维分散数据有点困难。选择一个好的距离度量成为分析此类数据的艺术的一部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-27T14:28:45.110

使用皮尔逊相关系数。我想出了如何在 SQL 查询中计算它，可以在这里找到：http: [//vanheusden.com/misc/pearson.php](http://vanheusden.com/misc/pearson.php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T14:46:20.910

在金融领域，他们使用 Beta 来衡量 2 系列数字的相关性。例如，Beta 可以回答“在过去一年中，在标准普尔 500 指数上涨 5% 的一天，IBM 的价格会上涨多少？” 它处理移动的百分比，因此 2 系列可以有不同的比例。

在我的示例中，Beta 是 Covariance(IBM, S&P 500) / Variance(S&P 500)。

维基百科有解释[Covariance](http://en.wikipedia.org/wiki/Covariance)、[Variance](http://en.wikipedia.org/wiki/Variance)和 Beta 的页面：[http://en.wikipedia.org/wiki/Beta_(finance)](http://en.wikipedia.org/wiki/Beta_(finance))

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T14:53:58.770

看统计网站。我认为您正在寻找相关性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T21:18:41.997

例如，我假设您正在测量温度、风和降水。我们将这些项目称为“功能”。所以有效值可能是：

*   温度：-50 到 100F（我在美国明尼苏达州）
*   风速：0 到 120 英里/小时（不确定这是否现实，但请耐心等待）
*   沉淀：0 到 100

首先标准化您的数据。Temp 的范围为 150 个单位，Wind 为 120 个单位，Precip 为 100 个单位。将你的风单位乘以 1.25 和 Precip 乘以 1.5，使它们与你的温度大致相同的“比例”。您可以在这里花哨并制定规则，使一项功能比其他功能更有价值。在此示例中，风的范围可能很大，但通常保持在较小的范围内，因此您希望减少它的权重以防止它扭曲您的结果。

现在，将每个测量值想象成多维空间中的一个点。此示例测量 3d 空间（温度、风、降水）。好消息是，如果我们添加更多特征，我们只是增加了空间的维度，但数学保持不变。无论如何，我们想找到最接近我们当前点的历史点。最简单的方法是[欧几里得距离](http://en.wikipedia.org/wiki/Euclidean_distance)。所以测量从我们当前点到每个历史点的距离并保持最接近的匹配：

```
for each historicalpoint

    distance = sqrt(
        pow(currentpoint.temp - historicalpoint.temp, 2) + 
        pow(currentpoint.wind - historicalpoint.wind, 2) +
        pow(currentpoint.precip - historicalpoint.precip, 2))

    if distance is smaller than the largest distance in our match collection
        add historicalpoint to our match collection
        remove the match with the largest distance from our match collection

next 
```

这是一种蛮力的方法。如果你有时间，你可以变得更漂亮。多维数据可以表示为像[kd-trees](http://en.wikipedia.org/wiki/Kd-tree)或[r-trees](http://en.wikipedia.org/wiki/R-tree)这样的树。如果您有大量数据，将您当前的观察结果与每个历史观察结果进行比较将太慢。树木可以加快您的搜索速度。您可能想看看[Data Clustering](http://en.wikipedia.org/wiki/Data_clustering) and [Nearest Neighbor Search](http://en.wikipedia.org/wiki/Nearest_neighbor_search)。

干杯。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-27T14:19:04.977

与统计学家交谈。

严重地。

他们以做这种事情为生。

您写道*“两组的相似性有点主观”*，但它根本不是主观的——这是为您的问题域确定相似性的适当标准的问题。

在这种情况下，您最好与专业人士交谈，而不是询问一堆程序员。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T14:21:28.660

首先，问问自己这些是集合还是有序集合。

我假设这些是带有重复的有序集合。最明显的算法是选择一个数字被认为相同的容差，并计算在该度量下数字相同的槽数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T15:31:23.843

我确实在我的应用程序中为此实施了一个解决方案，但我正在寻找是否有更好或更“正确”的东西。对于每个历史日，我都会执行以下操作：

```
function calculate_score(historical_set, forecast_set)
{
    double c = correlation(historical_set, forecast_set);
    double avg_history = average(historical_set);
    double avg_forecast = average(forecast_set);
    double penalty = abs(avg_history - avg_forecast) / avg_forecast
    return c - penalty;
} 
```

然后我将所有结果从高到低排序。

由于相关性是一个从 -1 到 1 的值，表示数字是一起下降还是一起上升，所以我用百分比差异来“惩罚”两组数字的平均值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-27T13:47:49.420

有几次，你提到你不知道数据的分布，这当然是真的。我的意思是，明天可能会有华氏 150 度的一天，风速 2000 公里/小时，但这似乎不太可能。

我认为你对分布有很好的了解，因为你有很长的历史记录。鉴于此，您可以根据历史分布的分位数来放置所有内容，并使用所有度量上的分位数的绝对差或平方差来做一些事情。这是另一种归一化方法，但它解释了数据中的非线性。

任何风格的标准化都应该使所有变量具有可比性。

例如，假设某天刮风、炎热：温度分位数可能为 0.75，风分位数为 0.75。热量的 0.76 分位数可能在 1 度之外，而风的分位数可能在 3 公里/小时之外。

这种对经验分布的关注也很容易理解，并且可能比正态估计（如均方误差）更稳健。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T14:31:53.703

这两个数据集是否有序？

如果订购，索引是否相同？等距？

如果指数是共同的（例如在同一天（但在不同位置测量的温度）），您可以将第一个数据集与第二个数据集进行回归，然后测试斜率等于 1，截距为 0。
[http://stattrek.com/AP-Statistics-4/Test-Slope.aspx?Tutorial=AP](http://stattrek.com/AP-Statistics-4/Test-Slope.aspx?Tutorial=AP)

否则，您可以针对它们的索引对 y=values 进行两次回归。 [http://en.wikipedia.org/wiki/Correlation](http://en.wikipedia.org/wiki/Correlation)。您仍然需要比较斜率和截距。

====

如果无序，我想你想看看累积分布函数 [http://en.wikipedia.org/wiki/Cumulative_distribution_function](http://en.wikipedia.org/wiki/Cumulative_distribution_function)

一项相关的测试是 Kolmogorov-Smirnov： [http ://en.wikipedia.org/wiki/Kolmogorov-Smirnov_test](http://en.wikipedia.org/wiki/Kolmogorov-Smirnov_test)

你也可以看看

学生的 t 检验， [http ://en.wikipedia.org/wiki/Student%27s_t-test](http://en.wikipedia.org/wiki/Student%27s_t-test)

或 Wilcoxon 符号秩检验[http://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test](http://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test)

测试两个样本之间的均值相等性。

您可以使用 Levene 测试来测试方差的相等性[http://www.itl.nist.gov/div898/handbook/eda/section3/eda35a.htm](http://www.itl.nist.gov/div898/handbook/eda/section3/eda35a.htm)

注意：不同的数据集可能具有相同的均值和方差 - 根据您想要的严格程度（以及您拥有的数据量），您*也可以*考虑测试更高时刻的相等性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-08-16T21:39:59.510

也许您可以将您的一组数字视为一个向量（该组的每个数字都是该向量的一个分量）。

然后，您可以简单地使用点积来计算 2 个给定向量（即一组数字）的相似度。

您可能需要标准化您的向量。

更多：[余弦相似度](http://en.wikipedia.org/wiki/Cosine_similarity)

# python - 为什么 map() 和列表理解的结果不同？

> ID：139819
> 
> 赞同：12
> 
> 时间：2008-09-26T14:19:48.963
> 
> 标签：python, closures, list-comprehension, late-binding, generator-expression

以下测试失败：

```
#!/usr/bin/env python
def f(*args):
    """
    >>> t = 1, -1
    >>> f(*map(lambda i: lambda: i, t))
    [1, -1]
    >>> f(*(lambda: i for i in t)) # -> [-1, -1]
    [1, -1]
    >>> f(*[lambda: i for i in t]) # -> [-1, -1]
    [1, -1]
    """
    alist = [a() for a in args]
    print(alist)

if __name__ == '__main__':
    import doctest; doctest.testmod() 
```

换句话说：

```
>>> t = 1, -1
>>> args = []
>>> for i in t:
...   args.append(lambda: i)
...
>>> map(lambda a: a(), args)
[-1, -1]
>>> args = []
>>> for i in t:
...   args.append((lambda i: lambda: i)(i))
...
>>> map(lambda a: a(), args)
[1, -1]
>>> args = []
>>> for i in t:
...   args.append(lambda i=i: i)
...
>>> map(lambda a: a(), args)
[1, -1] 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T14:31:47.577

它们是不同的，因为`i`生成器表达式和列表 comp 中的值都是惰性计算的，即当在 中调用匿名函数时`f`。
到那时，`i`绑定到最后一个值 if `t`，即 -1。

所以基本上，这就是列表理解所做的（对于 genexp 也是如此）：

```
x = []
i = 1 # 1\. from t
x.append(lambda: i)
i = -1 # 2\. from t
x.append(lambda: i) 
```

现在 lambda 带有一个引用 的闭包`i`，但`i`在这两种情况下都绑定到 -1，因为这是它被分配的最后一个值。

如果要确保 lambda 接收 的当前值`i`，请执行

```
f(*[lambda u=i: u for i in t]) 
```

这样，您可以`i`在创建闭包时强制进行评估。

**编辑**：生成器表达式和列表推导之间有一个区别：后者将循环变量泄漏到周围的范围内。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T14:28:40.580

lambda 捕获变量，而不是值，因此代码

```
lambda : i 
```

将始终返回 i**当前**绑定到闭包中的值。到它被调用时，该值已设置为 -1。

为了得到你想要的，你需要在创建 lambda 时捕获实际的绑定，方法是：

```
>>> f(*(lambda i=i: i for i in t)) # -> [-1, -1]
[1, -1]
>>> f(*[lambda i=i: i for i in t]) # -> [-1, -1]
[1, -1] 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T18:24:31.977

表达式`f = lambda: i`等价于：

```
def f():
    return i 
```

表达式`g = lambda i=i: i`等价于：

```
def g(i=i):
    return i 
```

`i`在第一种情况下是[自由变量](http://docs.python.org/ref/naming.html)，在第二种情况下它绑定到函数参数，即在这种情况下它是局部变量。默认参数的值在函数定义时进行评估。

生成器表达式是表达式中name的最近封闭范围（在哪里`i`定义），因此在该块中解析：`i``lambda``i`

```
f(*(lambda: i for i in (1, -1)) # -> [-1, -1] 
```

`i`是`lambda i: ...`块的局部变量，因此它引用的对象在该块中定义：

```
f(*map(lambda i: lambda: i, (1,-1))) # -> [1, -1] 
```

# .net - RESTful WCF 的最低配置

> ID：139821
> 
> 赞同：6
> 
> 时间：2008-09-26T14:20:04.857
> 
> 标签：.net, asp.net, wcf, rest, web-config

为了让 WCF 与 REST 一起工作，我需要在 web.config 中添加的最低限度是多少？我已经用 [WebGet] 注释了我的方法，但他们没有收到消息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T14:54:16.273

我发现您可以在 *.svc 文件中的 ServiceHost 指令中添加以下内容，它会自动为您设置 WebHttpBinding 和 WebHttpBehavior：

```
Factory="System.ServiceModel.Activation.WebServiceHostFactory" 
```

请注意，命名空间与网络上其他地方（例如在[此 MSDN 文章中](http://msdn.microsoft.com/en-us/magazine/cc135976.aspx)）提到的名称略有不同。

完成此操作后，我能够从 web.config 中删除整个部分，一切仍然有效！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T14:44:54.113

确保在端点上使用 webHttpBinding（而不是 httpBinding 或 wsHttpBinding）。这是我的端点配置...

```
 <endpoint address="" binding="webHttpBinding" bindingConfiguration=""
      contract="WcfCore.ICustomer">
      <identity>
        <dns value="localhost" />
      </identity>
    </endpoint> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T15:00:11.907

您需要确保您有服务主机的地址，例如

```
<services>
      <service name="SomeLib.SomeService">
        <host>
          <baseAddresses>
            <add baseAddress="http://localhost:8080/somebase"/>
          </baseAddresses>
        </host>
<!-- And one EndPoint **basicHttpBinding** WILL WORK !!! -->

        <endpoint 
                   address="basic"
                   binding="basicHttpBinding"
                   contract="SomeLib.SomeContract"/>
</service>
</services> 
```

所以现在，如果您通过控制台应用程序进行自我托管，例如......您可以通过以下方式调用您的主机：

```
WebChannelFactory<IServiceContract> factory =
        new WebChannelFactory<IServiceContract>(
            new Uri("http://localhost:8080/somebase")); 
```

当控制台应用程序启动时，该地址将是可浏览的，即使它是自托管的，并且您应该能够根据您的 webget uri 模板调用您的操作。

此最低配置将允许您通过自托管调用 WCF RestFULLY。如果您在 IIS 中托管，则它基本上以相同的方式工作，除了 svc 文件替换了我们的自定义主机。

# c++ - 跟踪数据执行保护 (DEP)

> ID：139826
> 
> 赞同：2
> 
> 时间：2008-09-26T14:21:12.827
> 
> 标签：c++, dep

在运行我们的一款软件时，测试人员遇到了 Windows 的数据执行保护对话框。

我们尝试在开发人员计算机上重现这种情况以进行调试：没有成功。

有谁知道如何找到可能导致 DEP 保护终止应用程序的原因？是否有任何现有的工具可用于此？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T15:48:16.800

DEP 对话框通常只会在您尝试从未标记为可执行的区域执行代码时显示。这可能是由您正在使用的库中的“thunk”引起的，例如 ATL 窗口。此问题已在 ATL 8.0 中修复。

堆栈垃圾错误（例如，缓冲区溢出）也可能导致此问题，方法是将返回地址设置为不可执行的位置。如果 DEP 为进程关闭或在硬件上不可用，这可能不会导致访问冲突，而是会导致奇怪的行为。

如果您抛出 C++ 异常或引发 SEH 异常，并且您的结构化异常处理程序已被缓冲区溢出丢弃，也可能会发生这种情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T14:40:41.737

我可能会认为，任何时候您尝试写入未分配的内存都是可能的结果。可以是删除一个对象然后使用它，或者将一个字符串写入一个太小而无法容纳它的缓冲区。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-26T12:35:29.863

DEP 受硬件能力的影响。我们最近遇到了一种情况，我们的应用程序在旧机器上运行良好，但在新机器上会失败。事实证明，尽管在旧服务器和新服务器上都启用了 DEP，但我们在新服务器上崩溃了，因为硬件检测更好、更激进或类似的东西。因此，如果您的 QA 可以重现但 DEV 不能，那么请尝试使用相同的硬件……尽管 QA 拥有比开发人员更新/更好的 PC 似乎是不合理的……我完全相信！
以下是我对我们最近的经验的注释： [Indy 9 和 Windows Server 2003 之间的不兼容性？](https://stackoverflow.com/questions/2485578/incompatibilities-between-indy-9-and-windows-server-2003/2518243#2518243)

# delphi - StringReplace 替代品以提高性能

> ID：139833
> 
> 赞同：10
> 
> 时间：2008-09-26T14:22:21.797
> 
> 标签：delphi

我正在使用 StringReplace 在生成的 XML 中用字符本身替换 > 和 <，如下所示：

```
StringReplace(xml.Text,'&gt;','>',[rfReplaceAll]) ;
StringReplace(xml.Text,'&lt;','<',[rfReplaceAll]) ; 
```

问题是替换每次出现的 > 都需要很长时间。

你有没有更好的想法让它更快？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T23:44:30.883

如果您使用的是 Delphi 2009，则使用 TStringBuilder 进行此操作的速度比使用 ReplaceString 快 3 倍。它也是 Unicode 安全的。

[我使用来自http://www.CodeGear.com](http://www.CodeGear.com)的文本，所有出现的“<”和“>”都更改为`"&lt;"`和`"&gt;"`作为我的起点。

包括字符串分配和创建/释放对象，这些在我的系统上分别花费了大约 25 毫秒和 75 毫秒：

```
function TForm1.TestStringBuilder(const aString: string): string;
var
  sb: TStringBuilder;
begin
  StartTimer;
  sb := TStringBuilder.Create;
  sb.Append(aString);
  sb.Replace('&gt;', '>');
  sb.Replace('&lt;', '<');
  Result := sb.ToString();
  FreeAndNil(sb);
  StopTimer;
end;

function TForm1.TestStringReplace(const aString: string): string;
begin
  StartTimer;
  Result := StringReplace(aString,'&gt;','>',[rfReplaceAll]) ;
  Result := StringReplace(Result,'&lt;','<',[rfReplaceAll]) ;
  StopTimer;
end; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T15:11:47.637

试试Peter Morris 的[FastStrings.pas](http://www.koders.com/delphi/fidFB386C5C240FD5E72013C882ADD7600FDF60E6C7.aspx?s=socket)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-28T10:01:43.933

您绝对应该查看 Fastcode 项目页面：[http ://fastcode.sourceforge.net/](http://fastcode.sourceforge.net/)

他们进行了更快的 StringReplace 挑战（Ansi StringReplace 挑战），“获胜者”比 Delphi RTL 快 14 倍。

在最近的版本中（我认为是 D2007），Delphi 本身已经包含了几个 fastcode 功能，因此性能改进可能会因您使用的 Delphi 版本而有很大差异。

如前所述，如果您认真对待处理 XML，那么您真的应该考虑基于 Unicode 的解决方案。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T14:28:00.690

问题是您将整个字符串大小迭代两次（一次用于替换 > 为 >，另一次用于替换 < 为 <）。

您应该使用 for 进行迭代，并在找到 & for a gt; 时简单地检查一下。或 lt; 并立即替换，然后跳过 3 个字符 ((g|l)t;)。这样，它可以按与字符串**xml.Text**的大小成比例的时间来做到这一点。

* * *

一个简单的 C# 示例，因为我不了解 Delphi，但应该可以帮助您了解大致情况。

```
String s = "&lt;xml&gt;test&lt;/xml&gt;";
char[] input = s.ToCharArray();
char[] res = new char[s.Length];
int j = 0;
for (int i = 0, count = input.Length; i < count; ++i)
{
    if (input[i] == '&')
    {
        if (i < count - 3)
        {
            if (input[i + 1] == 'l' || input[i + 1] == 'g')
            {
                if (input[i + 2] == 't' && input[i + 3] == ';')
                {
                    res[j++] = input[i + 1] == 'l' ? '<' : '>';
                    i += 3;
                    continue;
                }
            }
        }
    }

    res[j++] = input[i];
}
Console.WriteLine(new string(res, 0, j)); 
```

这输出：

```
<xml>test</xml> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-02-01T13:37:43.853

当您处理多行文本文件时，您可以通过逐行处理来获得一些性能。这种方法减少了大约 90% 的时间来替换 >1MB 的 xml 文件。

```
procedure ReplaceMultilineString(xml: TStrings);
var
  i: Integer;
  line: String;
begin
  for i:=0 to xml.Count-1 do
  begin
    line := xml[i];
    line := StringReplace(line, '&gt;', '>', [rfReplaceAll]);
    line := StringReplace(line, '&lt;', '<', [rfReplaceAll]);
    xml[i] := line;
  end;
end; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T14:55:11.747

Jorge Ferreira 编写的 C# 代码的未经测试的转换。

```
function ReplaceLtGt(const s: string): string;
var
  inPtr, outPtr: integer;
begin
  SetLength(Result, Length(s));
  inPtr := 1;
  outPtr := 1;
  while inPtr <= Length(s) do begin
    if (s[inPtr] = '&') and ((inPtr + 3) <= Length(s)) and
       (s[inPtr+1] in ['l', 'g']) and (s[inPtr+2] = 't') and
       (s[inPtr+3] = ';') then
    begin
      if s[inPtr+1] = 'l' then
        Result[outPtr] :=  '<'
      else
        Result[outPtr] := '>';
      Inc(inPtr, 3);
    end
    else begin
      Result[outPtr] := Result[inPtr];
      Inc(inPtr);
    end;
    Inc(outPtr);
  end;
  SetLength(Result, outPtr - 1);
end; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T15:20:36.443

Systools（Turbopower，[现在开源](https://sourceforge.net/projects/tpsystools/)）有一个 ReplaceStringAllL 函数，它在一个字符串中完成所有这些。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-10-07T06:54:55.270

它的工作就像魅力一样快相信它

```
 Function NewStringReplace(const S, OldPattern, NewPattern: string;  Flags: TReplaceFlags): string;
var
  OldPat,Srch: string; // Srch and Oldp can contain uppercase versions of S,OldPattern
  PatLength,NewPatLength,P,i,PatCount,PrevP: Integer;
  c,d: pchar;
begin
  PatLength:=Length(OldPattern);
  if PatLength=0 then begin
    Result:=S;
    exit;
  end;

  if rfIgnoreCase in Flags then begin
    Srch:=AnsiUpperCase(S);
    OldPat:=AnsiUpperCase(OldPattern);
  end else begin
    Srch:=S;
    OldPat:=OldPattern;
  end;

  PatLength:=Length(OldPat);
  if Length(NewPattern)=PatLength then begin
    //Result length will not change
    Result:=S;
    P:=1;
    repeat
      P:=PosEx(OldPat,Srch,P);
      if P>0 then begin
        for i:=1 to PatLength do
          Result[P+i-1]:=NewPattern[i];
        if not (rfReplaceAll in Flags) then exit;
        inc(P,PatLength);
      end;
    until p=0;
  end else begin
    //Different pattern length -> Result length will change
    //To avoid creating a lot of temporary strings, we count how many
    //replacements we're going to make.
    P:=1; PatCount:=0;
    repeat
      P:=PosEx(OldPat,Srch,P);
      if P>0 then begin
        inc(P,PatLength);
        inc(PatCount);
        if not (rfReplaceAll in Flags) then break;
      end;
    until p=0;
    if PatCount=0 then begin
      Result:=S;
      exit;
    end;
    NewPatLength:=Length(NewPattern);
    SetLength(Result,Length(S)+PatCount*(NewPatLength-PatLength));
    P:=1; PrevP:=0;
    c:=pchar(Result); d:=pchar(S);
    repeat
      P:=PosEx(OldPat,Srch,P);
      if P>0 then begin
        for i:=PrevP+1 to P-1 do begin
          c^:=d^;
          inc(c); inc(d);
        end;
        for i:=1 to NewPatLength do begin
          c^:=NewPattern[i];
          inc(c);
        end;
        if not (rfReplaceAll in Flags) then exit;
        inc(P,PatLength);
        inc(d,PatLength);
        PrevP:=P-1;
      end else begin
        for i:=PrevP+1 to Length(S) do begin
          c^:=d^;
          inc(c); inc(d);
        end;
      end;
    until p=0;
  end;
end; 
```

# winforms - 如何通过代码打开窗口的系统菜单？

> ID：139835
> 
> 赞同：4
> 
> 时间：2008-09-26T14:22:26.240
> 
> 标签：winforms, winapi

我有一个 C# WinForms 无边框窗口，为此我覆盖 WndProc 并处理 WM_NCHITTEST 消息。对于该表单的区域，我的命中测试函数返回 HTSYSMENU。双击该区域成功关闭表单，但右键单击它不会显示窗口的系统菜单，也不会在右键单击任务栏中的窗口名称时显示。

此表单使用以下样式：

```
this.SetStyle( ControlStyles.AllPaintingInWmPaint, true );
this.SetStyle( ControlStyles.UserPaint, true );
this.SetStyle( ControlStyles.OptimizedDoubleBuffer, true );
this.SetStyle( ControlStyles.ResizeRedraw, true ); 
```

并具有以下非默认属性值：

```
this.FormBorderStyle = System.Windows.Forms.FormBorderStyle.None;
this.KeyPreview = true;
this.MaximizeBox = false;
this.MinimizeBox = false; 
```

我尝试过处理 WM_NCRBUTTONDOWN 和 WM_NCRBUTTONUP，并发送 WM_GETSYSMENU 消息，但没有成功。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T21:46:36.647

如果我没记错的话，无边框窗口会被标记为不提供系统菜单，并且不会出现在任务栏中。

任何给定窗口都没有边框并且没有出现在任务栏中的事实是窗口上设置的样式标志的结果。可以使用`GetWindowLong`和`SetWindowLong`API 调用来设置这些特定的样式标志。但是，您必须小心，因为某些样式不能一起使用。

多年来，我编写了许多自定义控件，并且我不断地哄着窗口成为它们原本不打算成为的东西。
例如，我编写了自己的下拉控件，我需要一个窗口来充当弹出窗口而不是激活。
下面的代码将做到这一点。请注意，代码出现在`OnHandleCreated`事件处理程序中。这是因为在设置句柄后需要更改标志，这表明 Windows 已经设置了它认为应该设置的标志。

```
using System.Runtime.InteropServices;

protected override void OnHandleCreated(EventArgs e) {
    uint dwWindowProperty;

    User32.SetParent(this.Handle, IntPtr.Zero);

    dwWindowProperty = User32.GetWindowLong( this.Handle, User32.GWL.EXSTYLE );
    dwWindowProperty = dwWindowProperty | (uint)User32.WSEX.TOOLWINDOW | (uint)User32.WSEX.NOACTIVATE;
    User32.SetWindowLong( this.Handle, User32.GWL.EXSTYLE, dwWindowProperty );

    dwWindowProperty = User32.GetWindowLong( this.Handle, User32.GWL.STYLE );
    dwWindowProperty = ( dwWindowProperty & ~(uint)User32.WS.CHILD ) | (uint)User32.WS.POPUP; 
    User32.SetWindowLong( this.Handle, User32.GWL.STYLE, dwWindowProperty );
    base.OnHandleCreated (e);
}

//this is a fragment of my User32 library wrapper needed for the previous code segment.
class User32 
{
    [DllImport("user32.dll", SetLastError = true)]
   static extern IntPtr SetParent(IntPtr hWndChild, IntPtr hWndNewParent);

    [DllImport("user32.dll", CharSet=CharSet.Auto, CallingConvention=CallingConvention.StdCall )]
    public  static extern int SetWindowLong( IntPtr hWnd, User32.GWL gwlIndex, uint dwNewLong); 

    [DllImport("user32.dll", CharSet=CharSet.Auto, CallingConvention=CallingConvention.StdCall )]
    public static extern uint GetWindowLong( IntPtr hWnd, User32.GWL gwlIndex );

    [FlagsAttribute] 
    public enum WS: uint { 
        POPUP = 0x80000000,
        CHILD = 0x40000000,
    }

    public enum GWL {
        STYLE   = -16,
        EXSTYLE = -20
    }

    [FlagsAttribute]
    public enum WSEX: uint {
        TOP        = 0x0,
        TOPMOST    = 0x8,
        TOOLWINDOW = 0x80,
        NOACTIVATE = 0x08000000,
    }
} 
```

不幸的是，`SysMenu`如果不使用样式就无法设置`Caption`样式，所以我不能说这是否是您的实现中的问题。

您可以在以下两个链接中查看原始样式列表和扩展样式列表：
[Window Styles](https://docs.microsoft.com/en-us/windows/desktop/winmsg/window-styles)
[CreateWindowEx](https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-createwindowexw)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T14:45:36.327

我的应用程序中具有相同的属性，并且右键单击也不起作用，所以这不是*你的问题*，它似乎是 Windows 窗体在没有边框时响应的方式。

如果您将边框设置为正常值，您将能够右键单击任务栏等。

要右键单击其他控件，您需要设置 ContextMenuStrip 并提供您的“菜单”。但我不确定当你没有边界时这是否有效。我一直无法使它工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T11:34:23.163

```
 protected override void WndProc( ref System.Windows.Forms.Message m )
    { // RightClickMenu
        if ( m.Msg == 0x313 )
        {
            this.contextMenuStrip1.Show(this, this.PointToClient(new Point(m.LParam.ToInt32())));
        }} 
```

这会检测到右键单击应用程序任务栏“区域”..

也许会有所帮助？

# c# - 是否有一个实际示例说明他们如何在 .NET 中对方法参数使用属性？

> ID：139837
> 
> 赞同：8
> 
> 时间：2008-09-26T14:22:28.440
> 
> 标签：c#, .net

我知道这是可能的，并且我在文档中看到了简单的示例，但是它们是否被广泛使用？

我一直在类和方法级别使用属性，但从未在方法参数上使用它们。有哪些现实世界的例子，以及使用的原因？

请注意，我对看教科书示例不感兴趣。那里有很多。我想看看它为您解决特定问题的实际原因。

编辑：让我们先搁置关于是否使用属性的讨论。我知道有些人不喜欢他们，因为他们“弄脏”了他们的代码。那就另当别论了！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T14:26:38.120

例如，您可以为每个参数创建一个 ValidatorAttribute，然后在调用该方法之前，您可以反映参数属性并进行参数验证。如果一切正常，则调用该方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T14:34:20.550

（我在这里留下了这个答案，以防其他人发现它是对 PostSharp 的有用介绍，但它实际上并没有正确回答这个问题！我把这个问题误读为询问方法属性而不是类属性。Doh。据我记得，生成的 SOAP 类使用参数属性。LINQ to SQL 使用返回属性，并且在存储过程中也可能使用参数属性。）

我将它们与 PostSharp 一起使用，尽管目前只能在快速演示中使用（我没有在生产中使用 PostSharp）。

有关更多详细信息，请参阅[我的博客文章](http://msmvps.com/blogs/jon_skeet/archive/2008/03/27/postsharp-and-iterator-blocks-a-beautiful-combination.aspx)。

哦，当然 NUnit 测试到处都指定 [Test] :)

乔恩

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T14:28:11.907

我自己没有使用过它们，但 Scott Gu 关于 ASP.NET MVC Preview 5 的帖子显示了参数属性用于声明动作方法的模型绑定器。

链接位于：[http ://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx](http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx)

他指出，该属性在 Preview 5 中尚不可用，但应该在未来的版本中可用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T16:27:07.253

Castle Monorail 多年来一直使用数据绑定请求参数。见[http://www.castleproject.org/MonoRail/documentation/trunk/integration/ar.html](http://www.castleproject.org/MonoRail/documentation/trunk/integration/ar.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T17:43:30.860

依赖注入是一个非常好的示例场景。

ObjectBuilder（一个依赖注入容器，P&P Enterprise Libary 的一部分，很快将被 Unity 取代），到处使用它们来确定容器在运行时应该注入的内容。这是一个控制器类的构造函数的快速示例，该控制器类具有状态值（从任何处于活动状态的状态提供程序注入，通常是 HttpSession）以及两个服务依赖项（定位器和授权服务）：

```
 public class ShellController : ControllerBase, IShellController
    {
        public ShellController([StateDependency("State")] StateValue<ShuttleState> state,
                               [ServiceDependency] IHttpContextLocatorService contextLocator,
                               [ServiceDependency] IAuthorizationService authService)
            : base(state, contextLocator, authService)
        {
            // code goes here
        }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T05:26:49.940

单元测试框架广泛使用它们：

要在 nUnit 或 MSTest 中执行任何操作，您必须使用 [TestFixture] 或 [TestClass] 属性来装饰方法。

我的最爱？MbUnit 的 [DataFixture] 属性：让您可以直接在属性内或外部资源中使用特定测试数据为测试用例播种。

# sql-server - 游标与 while 循环 - 游标的优点/缺点是什么？

> ID：139843
> 
> 赞同：20
> 
> 时间：2008-09-26T14:23:07.487
> 
> 标签：sql-server, database-cursor

使用 while 循环而不是游标是个好主意吗？

游标的优点/缺点是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-01-13T20:07:52.567

我正在遵循以下建议：

> [...] 哪个更好：游标还是 WHILE 循环？同样，这真的取决于你的情况。我几乎总是在必要时使用游标来循环记录。游标格式对我来说更直观一些，因为我只使用这些结构来循环遍历结果集一次，所以使用 FAST_FORWARD 游标是有意义的。请记住，您使用的游标类型将对循环结构的性能产生巨大影响。

— Tim Chapman 在[比较 SQL Server 2008 中的游标与 WHILE 循环性能](http://www.techrepublic.com/blog/the-enterprise-cloud/comparing-cursor-vs-while-loop-performance-in-sql-server-2008/1741/)

链接的文章包含如何实现每种方法的简单示例。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-26T14:32:47.480

其中一些取决于 DBMS，但通常：

优点：

*   在逐行处理方面优于循环

*   适用于大型数据集

缺点：

*   也不要缩放

*   使用更多服务器资源

*   增加 tempdb 的负载

*   如果使用不当可能会导致泄漏（例如，打开而没有相应的关闭）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T14:36:51.590

我会问你在用那个游标/while 循环做什么。

如果您要更新或返回数据，为什么不使用适当的 WHERE 子句。我知道有人会说你永远不应该使用游标。

# delphi - Delphi 2009 可以与 Delphi 2006 或 Delphi 2007 安装在同一台机器上吗？

> ID：139844
> 
> 赞同：11
> 
> 时间：2008-09-26T14:23:30.403
> 
> 标签：delphi, installation

有没有冲突？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-29T04:52:26.057

所有新版本的 Delphi 始终可以安全地 /next/ 安装到旧版本。

每个新版本都应安装在其自己的目录中。

如果要安装多个版本，请始终先安装最旧的版本，然后再安装最新版本。

我们非常努力地确保所有版本的 Delphi 共存。但同样，永远不要将一个版本直接安装在另一个版本之上。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-27T01:42:41.067

我在同一台机器（这台机器）上运行 2007 和 2009 就好了。您可能遇到的唯一问题是，如果您将组件编译到同一个目录 - 您只需每次都重新构建所有 DCU 和包，或制作特定于版本的包和目录。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T00:00:20.733

将它们安装在它们自己的目录中，并确保将包二进制文件分开，你应该没问题。我在这台机器上安装了 2009、2007、2006、7 和 5，没有任何问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T16:44:14.467

我在一台机器上至少有 4 个 Delphi 版本。他们不互相咬。

我总是先安装旧版本，因为如果我反过来这样做，我就会遇到问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T09:12:47.193

是的 - 正如 Rob 所说（Robsoft）我都在这里工作。Delphi 一直很擅长与其他版本共存。

显然，您只能将一个版本作为打开 Delphi 文件的默认版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T14:25:43.503

不应该冲突。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T14:26:11.927

我在与 D2006 相同的机器上做了 D2007，完全没有问题（实际上我很震惊）。

我还没有尝试过D2009，但应该没问题。

[不过这家伙有问题。](http://sourceitsoftware.blogspot.com/2008/09/delphi-2009-good-test-of-my-backup.html) 希望他的问题是由于他在那篇文章中描述的自定义设置造成的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T14:28:33.043

我的一位同事（认为他现在在这里有一个帐户为 dcraggs）让他们都在同一台机器上运行得很好，我相信。

如果安装 D2009 会破坏已经安装的 D2007，Embarcadero 肯定会是一个巨大的自己的目标，因为组件和 DCU 不兼容 - 我怀疑相当多的人需要同时拥有一段时间（有些我们当中仍然需要 D5 和 D7！）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T14:46:32.797

CodeGear 声明（手边没有链接，抱歉）不应该有冲突。我还没有在我的主力电脑上安装 D2009，所以我不知道这是否正确。

注册表中的设置有不同的路径，包有不同的名称，所以应该没有问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T15:02:11.857

我有 Delphi 2007，我昨天安装了 2009，到目前为止没有明显的问题。两者似乎都工作正常。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T22:55:04.463

似乎没有问题。在同一台 Vista 机器上安装了带有 TurboDelphi 的 D2009 和 2007 以及 2、5 和 7

2007 年和 2009 年都安装了 Jedi JVC 和 JVCL。一切似乎都工作正常。希望有帮助。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-27T21:36:01.010

.. 如果您编译现有的包，请确保给它们一个新名称（例如，后缀为 D12），因为每个版本的 BPL 目录都在路径中。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-10T13:33:55.393

在运行 Vista Business 的 VMWare 实例上安装了 D2009 Enterprise，并安装了现有的 D2007 Enterprise。也许我做错了什么，但我开始在 D2007 IDE 中遇到错误，以及在用 D2007 编译的 exe 文件中出现一个非常奇怪的错误，未知字段类型。我卸载了 D2009，错误消失了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-27T18:18:03.173

您应该始终先安装旧版本。我尝试先安装 2009，然后再安装 2007，但安装 2007 失败。

卸载 2009 并从 2007 开始首先修复了安装问题。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-13T21:36:39.027

从理论上讲，这是可能的，但是如果您使用许多第三方（或您自己的）库，它会很快变得很麻烦。出于这个和其他原因，我倾向于在虚拟机上进行开发。但是，YMMV。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-30T04:37:03.443

应该没事。我有 Delphi 7, 2006, 2007, 2009 和第 3 方库[Dev Express](http://www.devexpress.com)和[Rem Objects](http://www.remobjects.com)（除了 2009 年的 Dev Express - 它已经发布了吗？）并且一切都完美无缺。正如其他人指出的那样，这些版本是从最旧到最新安装的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-04-30T21:04:16.820

尽管 Delphi 2009 和 Delphi 2007 项目不兼容且无法共享，但安装不会相互干扰。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-06-03T11:55:00.090

与发布顺序一起移动是必须的。先安装旧的。卸载可能会变得棘手。 [如何修复 Delphi 2009 数据资源管理器？](https://stackoverflow.com/questions/944279/how-to-fix-delphi-2009-data-explorer)

# c# - 用于上下文的 WCF 自定义标头或消息正文？

> ID：139852
> 
> 赞同：0
> 
> 时间：2008-09-26T14:25:03.397
> 
> 标签：c#, wcf

我想为客户提供 WCF 服务将零件信息发送到我们的应用程序。我们有多个客户，他们将拥有一个或多个位置，并且零件信息的范围仅限于客户的每个位置。当客户致电我们的服务时，他们需要指定位置。

我们考虑过的选项是：

1) 在自定义标头中放置位置 ID。所有零件信息将适用于列出的所有位置。

2) 在消息正文中添加“上下文”节点。所有零件信息将适用于列出的所有位置。

3）在消息正文中添加一个位置节点，该节点将包含部分信息。每个位置都有自己的零件清单。

我正在寻找最佳实践/标准帮助来确定应该如何处理。我们将不得不创建具有客户/位置范围的其他服务，并希望以一致的方式处理此问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T00:03:32.687

我想说，如果只有一两个操作需要它，就让它成为数据契约的一部分——有点像让它成为方法调用的参数。如果每个操作都需要它，请将其放在标头中，因为它与用户名、角色、租户或其他身份验证信息一样多的上下文 - 有点像您放在请求上下文中的内容（例如，HttpContext）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T14:38:18.950

你需要使用消息合约吗？我使用数据契约，除非我需要流回一些东西，所以一切都只是在正文中结束。但是，即使对于消息合同，我也会将该信息放在正文中，我倾向于保留标头用于身份验证信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T20:00:01.703

我们计划发送一份回复，其中包含处理摘要信息和有关任何无法处理的部分的详细信息。

消息契约有一个部分的集合，这些部分是在数据契约中定义的。消息合约中还有一个标志来控制部件集合的处理。这可能是也可能不是这个标志的正确位置。

# mef - Is MEF about UI? If not, why are all examples about GUI composition?

> ID：139853
> 
> 赞同：7
> 
> 时间：2008-09-26T14:25:07.030
> 
> 标签：mef

The MEF team keep saying it is about plug-in model. So, are we talking about UI plugins? How can we use this stuff in non-UI code? I downloaded the code and the examples are all about GUI. Am I guessing it wrong?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-01T08:20:59.133

伊利亚

MEF 绝对不仅仅适用于 UI。MEF 与 UI 无关，这就是它位于 System.ComponentModel 命名空间中的原因。您可以在桌面应用程序、Web 应用程序或服务中使用 MEF。

在样品方面，感谢您的反馈。我们确实需要更好的示例来说明它是一种非基于 UI 的技术。我认为很多示例都被 UI 所吸引的原因是我们的主要合作伙伴，如 Visual Studio，正在桌面应用程序中使用 MEF。我将与团队讨论一些非基于 UI 的示例。

谢谢格伦

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T14:30:29.107

Ayende sums up MEF rather nicely here:

[http://ayende.com/Blog/archive/2008/09/25/the-managed-extensibility-framework.aspx](http://ayende.com/Blog/archive/2008/09/25/the-managed-extensibility-framework.aspx)

Also the herding code lads had a great interview with Glenn Block, one of the MS MEF guys:

[http://herdingcode.com/?p=28](http://herdingcode.com/?p=28)
[http://herdingcode.com/?p=31](http://herdingcode.com/?p=31)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-06T08:21:30.317

MEF 似乎更倾向于扩展应用程序的功能。在我们的应用程序中，我们一直在研究 MEF 是否允许用户使用不同版本的评级引擎。这些模块没有 UI。它可以添加 UI 功能，但这不是必需的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T14:31:52.070

If you're talking about Microsoft [Managed Extensibility Framework](http://code.msdn.microsoft.com/mef) then no, it's definitely not just about UI.

By doing something visual in the samples you just make it easier for people to understand the concept. You could not make it clearer that an Tetris game with plug-in blocks.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-11T16:32:23.753

棱镜可能值得注意。MEF 可用于定义导入/导出任意合约的组件，而 Prism 可用于在分离的 UI 应用程序中定义 UI 区域。

# linux - 设置线程/proc/PID/cmdline？

> ID：139859
> 
> 赞同：4
> 
> 时间：2008-09-26T14:25:37.700
> 
> 标签：linux, multithreading, debugging, cmd, nptl

在**Linux/NPTL**上，线程被创建为某种进程。

我可以看到我的一些进程有一个奇怪的命令行：

```
cat /proc/5590/cmdline 
hald-addon-storage: polling /dev/scd0 (every 2 sec) 
```

您知道如何为流程的每个线程执行此操作吗？这对调试非常有帮助。

*/me 现在正在研究 HAL 源*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T14:51:36.983

如果您想以可移植的方式执行此操作，并且可以跨多个 Unix 变体工作，那么可用的选项很少。

你要做的是你的调用者进程必须调用 exec ，`argv [0]`参数指向你想在进程输出中看到的名称，文件名指向实际的可执行文件。

您可以使用以下命令从 shell 尝试此行为：

```
exec -a "This is my cute name" bash 
```

这将用一个名为`"This is my cute name"`.

为了在 C 中执行此操作，您可以查看`sendmail`已广泛移植的源代码或任何其他软件，并找到跨操作系统所需的所有变体来支持这一点。

一些操作系统有一个`setproctitle(3)`API，而另一些则允许您覆盖内容`argv [0]`并显示该结果。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T14:39:13.173

`argv`指向可写字符串。给他们写东西：

```
#include <string.h>
#include <unistd.h>

int
main(int argc, char** argv)
{
    strcpy(argv[0], "Hello, world!");
    sleep(10);
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T14:43:51.963

呸..代码不是很好，诀窍是重用环境（这里是argv_buffer）指针：

```
memset (argv_buffer[0] + len, 0, argv_size - len);
argv_buffer[1] = NULL; 
```

有更好的主意吗？

这适用于不同的线程吗？

# java - Is there an open source java enum of ISO 3166-1 country codes

> ID：139867
> 
> 赞同：91
> 
> 时间：2008-09-26T14:26:34.780
> 
> 标签：java, internationalization, country-codes, iso-3166

Does anyone know of a freely available java 1.5 package that provides a list of ISO 3166-1 country codes as a enum or EnumMap? Specifically I need the "ISO 3166-1-alpha-2 code elements", i.e. the 2 character country code like "us", "uk", "de", etc. Creating one is simple enough (although tedious), but if there's a standard one already out there in apache land or the like it would save a little time.

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2012-06-18T14:00:16.617

现在，在 Apache 许可证版本 2.0 下，GitHub 上提供了作为 Java 枚举的国家代码（[ISO 3166-1](http://en.wikipedia.org/wiki/ISO_3166-1) [alpha-2](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2) / [alpha-3](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-3) / [numeric ）列表的实现。](http://en.wikipedia.org/wiki/ISO_3166-1_numeric)

**例子：**

```
CountryCode cc = CountryCode.getByCode("JP");

System.out.println("Country name = " + cc.getName());                // "Japan"
System.out.println("ISO 3166-1 alpha-2 code = " + cc.getAlpha2());   // "JP"
System.out.println("ISO 3166-1 alpha-3 code = " + cc.getAlpha3());   // "JPN"
System.out.println("ISO 3166-1 numeric code = " + cc.getNumeric());  // 392 
```

* * *

**最后编辑**2016 年 6 月 9 日

CountryCode 枚举与其他 Java 枚举、LanguageCode ( [ISO 639-1](http://en.wikipedia.org/wiki/ISO_639-1) )、LanguageAlpha3Code ( [ISO 639-2](http://en.wikipedia.org/wiki/ISO_639-2) )、LocaleCode、ScriptCode ( [ISO 15924](http://en.wikipedia.org/wiki/ISO_15924) ) 和 CurrencyCode ( [ISO 4217](http://en.wikipedia.org/wiki/ISO_4217) ) 一起打包到 com.neovisionaries.i18n 中并注册到 Maven Central存储库。

**马文**

```
<dependency>
  <groupId>com.neovisionaries</groupId>
  <artifactId>nv-i18n</artifactId>
  <version>1.29</version>
</dependency> 
```

**摇篮**

```
dependencies {
  compile 'com.neovisionaries:nv-i18n:1.29'
} 
```

**GitHub**

[https://github.com/TakahikoKawasaki/nv-i18n](https://github.com/TakahikoKawasaki/nv-i18n)

**Javadoc**

[https://takahikokawasaki.github.io/nv-i18n/](https://takahikokawasaki.github.io/nv-i18n/)

**操作系统**

```
Bundle-SymbolicName: com.neovisionaries.i18n
Export-Package: com.neovisionaries.i18n;version="1.28.0" 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-09-26T15:30:41.537

此代码在 Sun Java 6 中获得 242 个国家/地区：

```
String[] countryCodes = Locale.getISOCountries(); 
```

尽管[ISO 网站](http://www.iso.org/iso/country_codes/iso_3166_code_lists/country_names_and_code_elements.htm)声称有 249 个*ISO 3166-1-alpha-2 代码元素*，但[javadoc](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Locale.html)链接到相同的信息。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-09-23T20:11:47.633

以下是我如何使用国家代码 + 国家名称生成枚举：

```
package countryenum;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Locale;

public class CountryEnumGenerator {
    public static void main(String[] args) {
        String[] countryCodes = Locale.getISOCountries();
        List<Country> list = new ArrayList<Country>(countryCodes.length);

        for (String cc : countryCodes) {
            list.add(new Country(cc.toUpperCase(), new Locale("", cc).getDisplayCountry()));
        }

        Collections.sort(list);

        for (Country c : list) {
            System.out.println("/**" + c.getName() + "*/");
            System.out.println(c.getCode() + "(\"" + c.getName() + "\"),");
        }

    }
}

class Country implements Comparable<Country> {
    private String code;
    private String name;

    public Country(String code, String name) {
        super();
        this.code = code;
        this.name = name;
    }

    public String getCode() {
        return code;
    }

    public void setCode(String code) {
        this.code = code;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override
    public int compareTo(Country o) {
        return this.name.compareTo(o.name);
    }
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-10-17T13:36:34.750

如果您已经打算依赖 Java 语言环境，那么我建议使用简单的 HashMap 而不是为国家等创建新类。

如果我只依赖 Java 本地化，以下是我将如何使用它：

```
private HashMap<String, String> countries = new HashMap<String, String>();
String[] countryCodes = Locale.getISOCountries();

for (String cc : countryCodes) {
    // country name , country code map
    countries.put(new Locale("", cc).getDisplayCountry(), cc.toUpperCase());
} 
```

填写地图后，您可以在需要时从国家名称中获取 ISO 代码。或者您也可以将其设为国家名称映射的 ISO 代码，只需相应地修改“put”方法。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-02-19T18:01:11.583

有一种简单的方法可以使用语言名称生成此枚举。执行此代码以生成要粘贴的枚举字段列表：

```
 /**
  * This is the code used to generate the enum content
  */
 public static void main(String[] args) {
  String[] codes = java.util.Locale.getISOLanguages();
  for (String isoCode: codes) {
   Locale locale = new Locale(isoCode);
   System.out.println(isoCode.toUpperCase() + "(\"" + locale.getDisplayLanguage(locale) + "\"),");
  }
 } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-10-28T14:57:26.357

如果有人已经在使用 Amazon AWS 开发工具包，它包括`com.amazonaws.services.route53domains.model.CountryCode`. 我知道这并不理想，但如果您已经使用 AWS 开发工具包，它是一种替代方案。在大多数情况下，我会使用 Takahiko 的`nv-i18n`，因为正如他所提到的，它实现了 ISO 3166-1。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-09-05T02:01:38.150

不是 java 枚举，而是它的 JSON 版本可在[http://country.io/names.json 获得](http://country.io/names.json)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-03-03T18:25:13.237

AWS Java SDK 有[CountryCode](https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/route53domains/model/CountryCode.html)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-25T03:41:53.647

这仍然没有回答这个问题。我也在为此寻找一种枚举器，但没有找到任何东西。这里有一些使用 hashtable 的例子，但表示与内置 get 相同

我会采用不同的方法。所以我在python中创建了一个脚本来自动生成Java中的列表：

```
#!/usr/bin/python
f = open("data.txt", 'r')
data = []
cc = {}

for l in f:
    t = l.split('\t')
    cc = { 'code': str(t[0]).strip(), 
           'name': str(t[1]).strip()
    }
    data.append(cc)
f.close()

for c in data:
    print """
/**
 * Defines the <a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO_3166-1_alpha-2</a> 
 * for <b><i>%(name)s</i></b>.
 * <p>
 * This constant holds the value of <b>{@value}</b>.
 *
 * @since 1.0
 *
 */
 public static final String %(code)s = \"%(code)s\";""" % c 
```

其中 data.txt 文件是 Wikipedia 表中的简单复制和粘贴（只需删除所有多余的行，确保每行都有国家代码和国家名称）。

然后把它放到你的静态类中：

```
/**
 * Holds <a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO_3166-1_alpha-2</a>
 * constant values for all countries. 
 * 
 * @since 1.0
 * 
 * </p>
 */
public class CountryCode {

    /**
     * Constructor defined as <code>private</code> purposefully to ensure this 
     * class is only used to access its static properties and/or methods.  
     */
    private CountryCode() { }

    /**
     * Defines the <a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO_3166-1_alpha-2</a> 
     * for <b><i>Andorra</i></b>.
     * <p>
     * This constant holds the value of <b>{@value}</b>.
     *
     * @since 1.0
     *
     */
     public static final String AD = "AD";

         //
         // and the list goes on! ...
         //
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-10-08T07:56:24.220

直到我最近才为此目的开源了我的 Java 枚举，我才知道这个问题！惊人的巧合！

我使用 BSD caluse 3 许可证将整个源代码放在我的博客上，所以我认为没有人会对此有任何不满。

可以在这里找到。 [https://subversivebytes.wordpress.com/2013/10/07/java-iso-3166-java-enum/](https://subversivebytes.wordpress.com/2013/10/07/java-iso-3166-java-enum/)

希望它有用并减轻开发痛苦。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-09-20T10:31:02.270

我创建了一个枚举，你用英文国家名称来寻址。请参阅[国家实用程序](https://github.com/Hervian/country-util)。
在每个枚举上，您都可以调用`getLocale()`以获取 Java 语言环境。

您可以从 Locale 获取您习惯使用的所有信息，即 ISO-3166-1 两个字母的国家/地区代码。

```
public enum Country{

    ANDORRA(new Locale("AD")),
    AFGHANISTAN(new Locale("AF")),
    ANTIGUA_AND_BARBUDA(new Locale("AG")),
    ANGUILLA(new Locale("AI")),
    //etc
    ZAMBIA(new Locale("ZM")),
    ZIMBABWE(new Locale("ZW"));

    private Locale locale;

    private Country(Locale locale){
        this.locale = locale;
    }

    public Locale getLocale(){
        return locale;
    } 
```

临：

*   轻的
*   映射到 Java 语言环境
*   可按国家全名寻址
*   枚举值不是硬编码的，而是通过调用 Locale.getISOCountries() 生成的。也就是说：只需针对最新的 java 版本重新编译项目，即可对枚举中反映的国家/地区列表进行任何更改。

缺点：

*   不在 Maven 存储库中
*   很可能比我不知道的其他解决方案更简单/更具表现力。
*   为我自己的需要而创建 / 不是这样维护的。- 您可能应该克隆 repo。

# postgresql - 如何在 Postgres 8.2 中禁用参照完整性？

> ID：139884
> 
> 赞同：36
> 
> 时间：2008-09-26T14:29:06.397
> 
> 标签：postgresql, referential-integrity

谷歌关于这个的结果有点薄，但表明这并不容易。

我的具体问题是我需要重新编号两个相互关联的表中的 ID，以便表 B 中有一个“table_a_id”列。我不能先重新编号表 A，因为 B 中的子代指向旧 ID。我不能先重新编号表 B，因为它们会在创建之前指向新的 ID。现在重复三到四张桌子。

当我可以“开始事务；禁用 ref 完整性；整理 ID；重新启用 ref 完整性；提交事务”时，我真的不想摆弄个人关系。Mysql 和 MSSQL 都提供此功能 IIRC，所以如果 Postgres 没有，我会感到惊讶。

谢谢！

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-09-26T14:46:47.947

您可以做两件事（这些是互补的，而不是替代品）：

*   将您的外键约束创建为 DEFERRABLE。然后，调用“SET CONSTRAINTS DEFERRED;”，这将导致直到事务结束才检查外键约束。请注意，如果您未指定任何内容，则默认值为 NOT DEFERRABLE（令人讨厌）。
*   调用“ALTER TABLE mytable DISABLE TRIGGER ALL;”，以防止在加载数据时执行任何触发器，然后调用“ALTER TABLE mytable ENABLE TRIGGER ALL;” 当您完成重新启用它们时。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2012-05-29T07:41:22.340

我发现这 2 个优秀的脚本可以生成用于删除约束然后重新创建它们的 sql。他们来了：

用于删除约束

```
SELECT 'ALTER TABLE "'||nspname||'"."'||relname||'" DROP CONSTRAINT "'||conname||'";'
FROM pg_constraint 
INNER JOIN pg_class ON conrelid=pg_class.oid 
INNER JOIN pg_namespace ON pg_namespace.oid=pg_class.relnamespace 
ORDER BY CASE WHEN contype='f' THEN 0 ELSE 1 END,contype,nspname,relname,conname 
```

为了重建它们

```
SELECT 'ALTER TABLE "'||nspname||'"."'||relname||'" ADD CONSTRAINT "'||conname||'" '|| pg_get_constraintdef(pg_constraint.oid)||';'
FROM pg_constraint
INNER JOIN pg_class ON conrelid=pg_class.oid
INNER JOIN pg_namespace ON pg_namespace.oid=pg_class.relnamespace
ORDER BY CASE WHEN contype='f' THEN 0 ELSE 1 END DESC,contype DESC,nspname DESC,relname DESC,conname DESC; 
```

运行这些查询，输出将是删除和创建约束所需的 sql 脚本。

一旦你放弃了约束，你就可以对表格做任何你喜欢的事情。完成后重新介绍它们。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-26T14:41:22.950

这似乎不可能。其他建议几乎总是提到删除约束并在工作完成后重新创建它们。

但是，您似乎可以设置约束`DEFERRABLE`，以便在事务结束之前不检查它们。请参阅[PostgreSQL 文档`CREATE TABLE`](http://www.postgresql.org/docs/8.1/interactive/sql-createtable.html)（搜索“可延迟”，它位于页面中间）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T14:43:07.407

我认为您需要列出外键约束，删除它们，进行更改，然后再次添加约束。检查 和 的`alter table drop constraint`文档`alter table add constraint`。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-04-29T19:02:30.890

这是一个 Python 脚本，它将删除事务中的所有约束，运行一些查询，然后重新创建所有这些约束。 `pg_get_constraintdef`让这变得超级简单：

```
class no_constraints(object):
    def __init__(self, connection):
        self.connection = connection

    def __enter__(self):
        self.transaction = self.connection.begin()
        try:
            self._drop_constraints()
        except:
            self.transaction.rollback()
            raise

    def __exit__(self, exc_type, exc_value, traceback):
        if exc_type is not None:
            self.transaction.rollback()
        else:
            try:
                self._create_constraints()
                self.transaction.commit()
            except:
                self.transaction.rollback()
                raise

    def _drop_constraints(self):
        self._constraints = self._all_constraints()

        for schemaname, tablename, name, def_ in self._constraints:
            self.connection.execute('ALTER TABLE "%s.%s" DROP CONSTRAINT %s' % (schemaname, tablename, name))

    def _create_constraints(self):
        for schemaname, tablename, name, def_ in self._constraints:
            self.connection.execute('ALTER TABLE "%s.%s" ADD CONSTRAINT %s %s' % (schamename, tablename, name, def_))

    def _all_constraints(self):
        return self.connection.execute("""
            SELECT n.nspname AS schemaname, c.relname, conname, pg_get_constraintdef(r.oid, false) as condef
                     FROM  pg_constraint r, pg_class c
                     LEFT JOIN pg_namespace n ON n.oid = c.relnamespace
                     WHERE r.contype = 'f'
                    and r.conrelid=c.oid
            """).fetchall()

if __name__ == '__main__':
    # example usage

    from sqlalchemy import create_engine

    engine = create_engine('postgresql://user:pass@host/dbname', echo=True)

    conn = engine.connect()
    with no_contraints(conn):
        r = conn.execute("delete from table1")
        print "%d rows affected" % r.rowcount
        r = conn.execute("delete from table2")
        print "%d rows affected" % r.rowcount 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-05-05T13:59:54.443

如果约束是`DEFERRABLE`，这真的很容易。只需使用事务块并将 FK 约束设置为在事务开始时延迟。

来自[http://www.postgresql.org/docs/9.4/static/sql-set-constraints.html](http://www.postgresql.org/docs/9.4/static/sql-set-constraints.html)：

> SET CONSTRAINTS 设置当前事务中约束检查的行为。在每个语句的末尾检查 IMMEDIATE 约束。在事务提交之前不会检查 DEFERRED 约束。

所以你可以这样做：

```
BEGIN;

SET CONSTRAINTS
    table_1_parent_id_foreign, 
    table_2_parent_id_foreign,
    -- etc
DEFERRED;

-- do all your renumbering

COMMIT; 
```

不幸的是，似乎 Postgres 将所有约束默认为`NOT DEFERRABLE`，除非`DEFERRABLE`明确设置。（我猜这是出于性能原因，但我不确定。）从 Postgres 9.4 开始，更改约束以使其在需要时可延迟并不难：

```
ALTER TABLE table_1 ALTER CONSTRAINT table_1_parent_id_foreign DEFERRABLE; 
```

（见[http://www.postgresql.org/docs/9.4/static/sql-altertable.html](http://www.postgresql.org/docs/9.4/static/sql-altertable.html)。）

我认为这种方法比某些人所描述的删除和重新创建您的约束更可取，或者禁用所有（或所有用户）触发器直到事务结束，这需要超级用户权限，如[@clapas 之前的评论中所述](https://stackoverflow.com/questions/139884/how-do-i-disable-referential-integrity-in-postgres-8-2#comment-26685408)。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2011-01-24T09:40:34.790

我认为一个简单的解决方案是创建“临时”列，将它们关联到您希望它们所在的位置。

使用新列的外键更新值

删除初始列

将新的“临时”列重命名为与初始列相同的名称。

# apache - 一个站点的多个域：别名或重定向？

> ID：139889
> 
> 赞同：20
> 
> 时间：2008-09-26T14:30:23.197
> 
> 标签：apache, seo, multiple-domains

我现在正在建立一些站点，其中许多站点具有多个域。问题是：我是给域设置别名（使用[ServerAlias](http://httpd.apache.org/docs/2.0/mod/core.html#serveralias)）还是[重定向](http://httpd.apache.org/docs/2.0/mod/mod_alias.html#redirect)请求？

显然，从可读性或脚本角度来看，ServerAlias 更好/更容易。但是，我听说如果所有内容都重定向到一个域，Google 会更喜欢它。这是真的？如果是这样，应该使用什么重定向代码？

常见的虚拟主机示例将具有：

```
ServerName example.net
ServerAlias www.example.net 
```

这是错误的吗？除了 example2.net 和 www.example2.net 之外，www 也应该是重定向吗？或者谷歌是否足够聪明，所有这些网站（或至少 www）都是同一个网站？

更新：想要别名的部分原因是它们要快得多。仅仅因为拨号用户使用（或没有）使用 www 的重定向会显着增加初始页面加载。

更新和回答：感谢 Paul 找到[Google 链接](http://googlewebmastercentral.blogspot.com/2008/09/demystifying-duplicate-content-penalty.html)，该链接指示我们“通过**不**延续重复内容处罚的神话来帮助您的网站管理员同行”。但是请注意，这仅适用于同一站点上的内容，例如“www.example.com/skates.asp?color=black&brand=riedell 或 www.example.com/skates.asp?brand=riedell&color=黑色的”。事实上，该文章明确指出“不要创建多个页面、子域或具有大量重复内容的域”。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-26T14:34:41.407

重定向更好，那么您的内容总是有一个规范的域。~~我听说 Google 会惩罚托管相同内容的多个域，但目前我找不到来源（编辑，[这是一篇文章](http://www.searchenginejournal.com/duplicate-content-penalty-how-to-lose-google-ranking-fast/1886/)，但从 2005 年开始，这是互联网时代的古老历史！）~~ *（不正确，请参阅编辑以下）*

以下是一些重定向到规范域的 mod-rewrite 规则：

```
RewriteCond %{HTTP_HOST}   !^www\.foobar\.com [NC]
RewriteCond %{HTTP_HOST}   !^$
RewriteRule ^/(.*)         http://www.foobar.com/$1 [L,R=permanent] 
```

在决定将请求重定向到规范域之前，检查主机是否不是规范域 (www.foobar.com) 并检查域是否已实际指定。

**进一步编辑**：[这是一篇直接来自马口的文章](http://googlewebmastercentral.blogspot.com/2008/09/demystifying-duplicate-content-penalty.html)- 似乎它不像你想象的那么大。请仔细阅读这篇文章，因为它区分了同一站点上的重复内容（如“www.example.com/skates.asp?color=black&brand=riedell 和 www.example.com/skates.asp?brand=riedell&color=black ”）并明确表示“不要创建多个页面、子域或具有大量重复内容的域。”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T15:24:56.107

SSL 证书也可能是一个问题（通配符证书可以缓解这种情况，但价格更高）。

因此，如果证书仅绑定到 www.example.com，则不会验证 example.com。如果这种情况适用于您的情况，那么在您的 html 和 javascript 中仔细处理、重定向和超链接引用非常重要。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T14:53:53.233

如果它们是完全不同的域名，您将需要重定向，因为否则 cookie 无法在两者之间共享。如果用户在 example1.com 上登录您的网站，他们在访问 example2.com 时需要再次登录。

如果它们只是不同的子域（example.com 与 www.example.com），这无关紧要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T14:52:48.883

服务器别名可能会导致 CGI 会话连续性出现问题：由于 cookie 附加到为其提供服务的域，因此必须仔细编写 CGI 脚本，以便它们知道别名，或者站点内和进入站点的所有链接都必须是相对的，或两者兼而有之 - 由于浏览器根据用户上次是通过 name.tld 还是 www.name.tld 进入您的网站，为您提供不同的 cookie，因此很难避免难以调试的小问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T14:42:47.847

现在我怀疑它是否重要。如果您在 google 中看到这两个条目，那么您就知道您做错了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T14:52:47.120

如果指向您网站的一半链接指向一个 URL，而一半指向另一个 URL，则每个 URL 只会获得一半的 pagerank。即使谷歌没有因为重复内容而惩罚你的排名，你也会受到影响。

# .net - 判断生产 Windows Server 上安装了哪些版本的 .NET 的万无一失的方法是什么？

> ID：139891
> 
> 赞同：99
> 
> 时间：2008-09-26T14:30:40.840
> 
> 标签：.net, windows, deployment

这个问题与其说是编程相关，不如说是与部署相关。

我发现自己与我公司的团队进行了很多交谈，他们的工作是维护我们的生产 Windows 服务器并在它们上部署我们的代码。出于法律和合规性原因，我对服务器没有直接的可见性或任何控制权，因此我可以判断其中安装了哪些 .NET 版本的唯一方法是通过我给该组的指示。

到目前为止，我能想到的所有方法来判断安装了哪些版本（检查与 1.1 或 2.0 匹配的管理工具，检查“添加/删除程序”列表中的条目，检查是否存在c:\Windows\Microsoft.NET 下的目录）有缺陷（我在管理工具下看到至少一台机器有 2.0 但没有 2.0 条目 - 而且该方法没有告诉您任何关于 3.0+ 的信息，即“添加/删除程序”列表可能与现实不同步，目录的存在并不一定意味着什么）。

鉴于我通常需要提前知道这些东西已经到位（发现“哎呀，这个没有你需要的所有版本和服务包”在维护窗口短的情况下并不能很好地工作），我必须由于我无法直接访问服务器，因此“通过代理”进行检查，判断生产 Windows Server 上安装了哪些版本的 .NET 的万无一失的方法是什么？最好是使用框架安装的一些内在方法来这样做，因为它会更快并且不需要加载某种实用程序，而且如果框架没有正确安装但仍然有文件（即，有一个目录和 gacutil.exe 是 inded 那里，但该版本的框架并没有真正“安装”）

**编辑：**在没有一个好的万无一失的内在方法来做到这一点内置到框架中的情况下，有没有人知道一个好的、轻量级的、不需要安装的程序可以找到这个？我可以想象有人可以很容易地写一个，但如果已经存在一个，那就更好了。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-26T14:41:16.897

您应该在要查找此信息的服务器上打开 IE，然后访问此站点：[http ://www.hanselman.com/smallestdotnet/](http://www.hanselman.com/smallestdotnet/)

这就是它所需要的。

该站点有一个脚本，可以查看您浏览器的“UserAgent”，并确定您安装（或未安装）的 .NET Framework 版本（如果有），并自动显示它（然后计算总大小，如果您选择下载 .NET 框架）。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-26T14:35:16.850

您可以按照此[博客条目](http://blogs.msdn.com/astebner/archive/2007/11/29/6608419.aspx)以编程方式检查注册表和其他一些内容。

要查看的注册表项是

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP\...] 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2013-09-13T17:18:33.480

[从这里](http://www.codeproject.com/Tips/487799/Check-which-NET-Framework-version-is-installed-fro)找到答案：

> 检查安装了哪个 .NET Framework 版本

打开命令提示符并复制粘贴以下命令行之一

```
dir %WINDIR%\Microsoft.Net\Framework\v* 
```

或者

```
dir %WINDIR%\Microsoft.Net\Framework\v* /O:-N /B 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-26T14:58:24.487

微软的方式是这样的：

[MSDN：如何确定安装了哪些 .NET Framework 版本](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)（将您定向到以下注册表项`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP\...`：）

如果你想要万无一失，那是另一回事。我不会担心框架文件夹的 xcopy。如果有人这样做，我会认为电脑坏了。

最简单的方法是编写一个小程序，使用每个版本的 .NET 和您关心的库并运行它们。

对于免安装方法，[PowerBasic](http://powerbasic.com)是一款出色的工具。它创建了小的不需要运行时的 exe。它可以自动执行上面 MS 知识库文章中描述的检查。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-06-01T16:07:54.267

根据[CodeTrawler 的回答](https://stackoverflow.com/questions/139891/whats-the-foolproof-way-to-tell-which-versions-of-net-are-installed-on-a-prod/140037#140037)，解决方案是在资源管理器窗口中输入以下内容：

> %systemroot%\Microsoft.NET\Framework

然后搜索：

> mscorlib.dll

...并右键单击/转到每个结果的版本选项卡。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-06-19T23:19:37.867

[http://www.asoft.be/prod_netver.html](http://www.asoft.be/prod_netver.html)

使用这个“好、轻量级、无需安装的程序”

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T14:58:14.237

有关如何执行此操作的 Microsoft 官方答案在[KB 文章 318785](http://support.microsoft.com/kb/318785)中。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-26T17:29:42.920

如果您要检查的机器安装了 .NET SDK，您可以使用 SDK 命令提示符并运行该程序`CLRVer.exe`。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T14:34:14.700

OneTouch 部署将完成所有先决条件的检测和安装。最好使用预制的解决方案，而不是尝试自己动手。尝试自行推出可能会导致问题，因为您键入的任何内容都可能因修补程序或服务包而改变。微软可能有一些启发式方法来确定正在运行的版本。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T17:22:51.097

检测 .NET 3.0 的官方方法在此处描述

[http://msdn.microsoft.com/en-us/library/aa480198.aspx](http://msdn.microsoft.com/en-us/library/aa480198.aspx)

有缺陷，因为它要求调用者具有注册表访问权限。

MSDN 还提到了一种通过检查用户代理字符串来检测 .NET 3.5 的技术：

[http://msdn.microsoft.com/en-us/library/bb909885.aspx](http://msdn.microsoft.com/en-us/library/bb909885.aspx)

我认为微软应该做得比这更好。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-06-21T20:34:59.450

另外，请参阅 Stack Overflow 问题*[如何检测安装了哪些 .NET Framework 版本和服务包？](https://stackoverflow.com/questions/199080/how-to-detect-what-net-framework-versions-and-service-packs-are-installed/3087128#3087128)*其中还提到：

> 在知识库文章*[如何确定安装了 Microsoft .NET Framework 的版本和服务包级别][2] 中有Microsoft 官方对此问题的回答*

文章 ID：318785 - 上次评论：2008 年 11 月 7 日 - 修订：20.1 如何确定已安装的 .NET Framework 版本以及是否已应用服务包。

不幸的是，它似乎不起作用，因为`mscorlib.dll`2.0 目录中的版本有 2.0 版本，`mscorlib.dll`即使安装了 3.5 SP1，3.0 或 3.5 目录中也没有版本......为什么微软官方的回答是如此误导？

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-05-29T16:04:48.430

要确定您的服务器对**.NET Framework 4.5 及更高**版本的支持（通过 4.5.2 测试）：**如果您在服务器上没有注册表访问权限**，但对该服务器具有应用程序发布权限，请创建一个具有简单的 MVC 5 应用程序控制器，像这样：

```
using System.Web.Mvc;

namespace DotnetVersionTest.Controllers
{
    public class DefaultController : Controller
    {
        public string Index()
        {
            return "simple .NET version test...";
        }
    }
} 
```

然后在您的 Web.config 中，浏览下一部分中所需的 .NET Framework 版本，`targetFramework`根据需要更改值：

```
<system.web>
    <customErrors mode="Off"/>
    <compilation debug="true" targetFramework="4.5.2"/>
    <httpRuntime targetFramework="4.5.2"/>
</system.web> 
```

将每个目标发布到您的服务器，然后浏览到`<app deploy URL>/Default`. 如果您的服务器支持目标框架，那么简单的字符串将从您的普通控制器中显示。如果没有，您将收到如下错误：

![服务器上不受支持的 .NET 4.5.2 示例](https://i.stack.imgur.com/DWLRA.png)

所以在这种情况下，我的目标服务器还不支持 .NET Framework 4.5.2。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-10-07T08:43:05.840

要获取已安装的 dotnet 版本，请
创建控制台应用程序。添加此类运行

```
using Microsoft.Win32;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ConsoleApplication2
{
    public class GetDotNetVersion
    {
        public static void Get45PlusFromRegistry()
        {
            const string subkey = @"SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Full\";
            using (RegistryKey ndpKey = RegistryKey.OpenBaseKey(RegistryHive.LocalMachine, RegistryView.Registry32).OpenSubKey(subkey))
            {
                if (ndpKey != null && ndpKey.GetValue("Release") != null)
                {
                    Console.WriteLine(".NET Framework Version: " + CheckFor45PlusVersion((int)ndpKey.GetValue("Release")));
                }
                else
                {
                    Console.WriteLine(".NET Framework Version 4.5 or later is not detected.");
                }
            }
        }

        // Checking the version using >= will enable forward compatibility.
        private static string CheckFor45PlusVersion(int releaseKey)
        {
            if (releaseKey >= 394802)
                return "4.6.2 or later";
            if (releaseKey >= 394254)
            {
                return "4.6.1";
            }
            if (releaseKey >= 393295)
            {
                return "4.6";
            }
            if ((releaseKey >= 379893))
            {
                return "4.5.2";
            }
            if ((releaseKey >= 378675))
            {
                return "4.5.1";
            }
            if ((releaseKey >= 378389))
            {
                return "4.5";
            }
            // This code should never execute. A non-null release key shoul
            // that 4.5 or later is installed.
            return "No 4.5 or later version detected";
        }
    }
    // Calling the GetDotNetVersion.Get45PlusFromRegistry method produces 
    // output like the following:
    //       .NET Framework Version: 4.6.1
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T14:34:45.447

找出版本可能是一种讨厌的方式，但我一直认为所有版本都安装到`<root>:\WINDOWS\Microsoft.NET\Framework`.

这提供了带有名称的文件夹，例如`v2.0.50727`我认为可以提供详细版本信息的文件夹。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-31T20:26:06.363

好吧，就像 Dean 说的，您可以查看注册表并执行他所做的操作。要检查他是否真的安装了 CLR .NET Framework，您应该`MSCorEE.dll`在目录中查找该文件`%SystemRoot%\System32`。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-04-22T18:56:16.780

奇怪的是，当 1.1 发布时，我写了一些代码来执行此操作（那是什么，七年前？）并在 2.0 发布时对其进行了一些调整。因为我们不再管理我们的服务器，所以我已经好几年没有看过它了。

这不是万无一失的，但无论如何我都会发布它，因为我觉得它很幽默；因为在 .NET 中更容易做到，在 power shell 中更容易。

```
bool GetFileVersion(LPCTSTR filename,WORD *majorPart,WORD *minorPart,WORD *buildPart,WORD *privatePart)
{
    DWORD dwHandle;
    DWORD dwLen = GetFileVersionInfoSize(filename,&dwHandle);
    if (dwLen) {
        LPBYTE lpData = new BYTE[dwLen];
        if (lpData) {
            if (GetFileVersionInfo(filename,0,dwLen,lpData)) {
                UINT uLen;  
                VS_FIXEDFILEINFO *lpBuffer;  
                VerQueryValue(lpData,_T("\\"),(LPVOID*)&lpBuffer,&uLen);  
                *majorPart = HIWORD(lpBuffer->dwFileVersionMS);
                *minorPart = LOWORD(lpBuffer->dwFileVersionMS);
                *buildPart = HIWORD(lpBuffer->dwFileVersionLS);
                *privatePart = LOWORD(lpBuffer->dwFileVersionLS);
                delete[] lpData;
                return true;
            }
        }
    }
    return false;
}

int _tmain(int argc,_TCHAR* argv[])
{
    _TCHAR filename[MAX_PATH];
    _TCHAR frameworkroot[MAX_PATH];
    if (!GetEnvironmentVariable(_T("systemroot"),frameworkroot,MAX_PATH))
        return 1;
    _tcscat_s(frameworkroot,_T("\\Microsoft.NET\\Framework\\*"));
    WIN32_FIND_DATA FindFileData;
    HANDLE hFind = FindFirstFile(frameworkroot,&FindFileData);
    if (hFind == INVALID_HANDLE_VALUE)
        return 2;
    do {
        if ((FindFileData.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) &&
            _tcslen(FindFileData.cAlternateFileName) != 0) {
            _tcsncpy_s(filename,frameworkroot,_tcslen(frameworkroot)-1);
            filename[_tcslen(frameworkroot)] = 0;
            _tcscat_s(filename,FindFileData.cFileName);
            _tcscat_s(filename,_T("\\mscorlib.dll"));
            WORD majorPart,minorPart,buildPart,privatePart;
            if (GetFileVersion(filename,&majorPart,&minorPart,&buildPart,&privatePart )) {
                _tprintf(_T("%d.%d.%d.%d\r\n"),majorPart,minorPart,buildPart,privatePart);
            }
        }
    } while (FindNextFile(hFind,&FindFileData) != 0);
    FindClose(hFind);
    return 0;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-11-29T17:55:16.320

如果要查找 .NET 4.5 之前的版本，请使用控制台应用程序的代码。像这样：

```
using System;
using System.Security.Permissions;
using Microsoft.Win32;

namespace findNetVersion
{
    class Program
    {
        static void Main(string[] args)
        {
            using (RegistryKey ndpKey = RegistryKey.OpenBaseKey(RegistryHive.LocalMachine,
                     RegistryView.Registry32).OpenSubKey(@"SOFTWARE\Microsoft\NET Framework Setup\NDP\"))
            {
                foreach (string versionKeyName in ndpKey.GetSubKeyNames())
                {
                    if (versionKeyName.StartsWith("v"))
                    {

                        RegistryKey versionKey = ndpKey.OpenSubKey(versionKeyName);
                        string name = (string)versionKey.GetValue("Version", "");
                        string sp = versionKey.GetValue("SP", "").ToString();
                        string install = versionKey.GetValue("Install", "").ToString();
                        if (install == "") //no install info, must be later version
                            Console.WriteLine(versionKeyName + "  " + name);
                        else
                        {
                            if (sp != "" && install == "1")
                            {
                                Console.WriteLine(versionKeyName + "  " + name + "  SP" + sp);
                            }
                        }
                        if (name != "")
                        {
                            continue;
                        }
                        foreach (string subKeyName in versionKey.GetSubKeyNames())
                        {
                            RegistryKey subKey = versionKey.OpenSubKey(subKeyName);
                            name = (string)subKey.GetValue("Version", "");
                            if (name != "")
                                sp = subKey.GetValue("SP", "").ToString();
                                install = subKey.GetValue("Install", "").ToString();
                            if (install == "") //no install info, ust be later
                                Console.WriteLine(versionKeyName + "  " + name);
                            else
                            {
                                if (sp != "" && install == "1")
                                {
                                    Console.WriteLine("  " + subKeyName + "  " + name + "  SP" + sp);
                                }
                                else if (install == "1")
                                {
                                    Console.WriteLine("  " + subKeyName + "  " + name);
                                }
                            }
                        }
                    }
                }
            }
        }
    }
} 
```

否则，您可以通过如下查询找到 .NET 4.5 或更高版本：

```
private static void Get45or451FromRegistry()
{
    using (RegistryKey ndpKey = RegistryKey.OpenBaseKey(RegistryHive.LocalMachine,
       RegistryView.Registry32).OpenSubKey(@"SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Full\"))
    {
        int releaseKey = (int)ndpKey.GetValue("Release");
        {
            if (releaseKey == 378389)

                Console.WriteLine("The .NET Framework version 4.5 is installed");

            if (releaseKey == 378758)

                Console.WriteLine("The .NET Framework version 4.5.1  is installed");

        }
    }
} 
```

然后控制台结果将告诉您哪些版本已安装并可用于您的部署。这段代码也很方便，因为您可以将它们作为保存的解决方案，以便将来随时查看。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-07-28T18:20:32.357

我进入 Windows Update 并查看了更新历史记录，知道服务器补丁是最新的。我扫描了 .NET 更新，它准确地向我显示了哪些版本有更新，这使我能够得出安装了哪些版本的结论。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-06-28T09:37:38.323

我发现这个非常有用。这是[来源](https://github.com/peterM/Net_Framework_Installed_Versions_Getter/tree/master/Source)

[![在此处输入图像描述](https://i.stack.imgur.com/ZU2n9.png)](https://i.stack.imgur.com/ZU2n9.png)

# java - Java Multicast Time To Live 始终为 0

> ID：139909
> 
> 赞同：8
> 
> 时间：2008-09-26T14:34:20.190
> 
> 标签：java, oracle, sockets, multicast, ttl

我在数据报数据包上设置 TTL 时遇到问题。在将数据包发送到多播套接字之前，我在数据包上调用 setTTL(...) 方法，但是如果我用 ethereal 捕获数据包，则 TTL 字段始终设置为 0

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T14:35:33.010

基本上，您必须设置一个特殊的系统属性，告诉 JVM 使用 IPv4 堆栈：

```
-Djava.net.preferIPv4Stack=true 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-02T19:36:50.457

要在没有命令行的 Oracle 中实施 pfranza 的修复：

`java.net.preferIPv4Stack=true`在使用以下 PL/SQL 片段调用包含多播调用的 java 代码之前，如下设置每个 Oracle 会话中的属性：

```
ret := dbms_java.set_property('java.net.preferIPv4Stack','true'); 
```

如果调用成功，它将返回 NULL。

# javascript - 如何在注销某人之前提交带有数据的表单？

> ID：139921
> 
> 赞同：0
> 
> 时间：2008-09-26T14:36:49.747
> 
> 标签：javascript, forms, submit

我正在将 document.form.submit() 函数用于相当大的输入表单（数百个字段，它是一个库存应用程序）。我在用户空闲一段时间后调用它，我想保存他们输入的任何数据。当我尝试这样做时，页面会重新加载（操作是#），但是在字段中键入的任何新文本都不会在请求中传递，所以我不能把它放在数据库中。发生这种情况是否有一些根本原因，或者我的代码只是不能很好地协同工作（我正在使用 EXTJS 网格视图来显示表单和用于跟踪空闲时间的库）？谢谢，罗伯特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T15:01:43.387

我想我把答案放在这里了。我发现这样做： setTimeout('frm.submit();', 2000); 导致页面重新加载但未提交表单。当我这样做时：frm.submit(); 表单已提交，数据已通过。我不知道为什么第一种方法不起作用，但我不需要知道:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T14:58:06.140

服务器可能会取消输入值。假设您在服务器上的页面如下所示：

```
<form action="/page.cgi">
  ...
  <input name="Fieldx" value=""/>
</form> 
```

我认为它会在场外无效。或者这可能是服务器操作间接设置它。在 JSF 中，类似这样的东西。

```
<input name="Fieldx" value="#{bean.nullProperty}"/> 
```

你在服务器上有什么，你的浏览器是什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:01:16.180

我会尝试捕获 HTML 发布请求以查看是否包含输入字段。如果是，那么您的服务器有问题。

但是关于您所说的，我认为这是因为您的浏览器处理 JavaScript DOM 的方式存在冲突。如果您在表单上省略了提交按钮并且它可以工作，则可能会出现这种情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T15:02:56.127

对象的`submit`方法`HTMLFormElement`应该只是提交表单，就好像用户点击了提交按钮一样。因此，如果`action`表单的属性设置为`#`，它似乎只是刷新页面，因为它将表单数据发送到同一页面。

奇怪的是，当您将 action 属性设置为另一个页面时，它仍然会这样做。

表单的`method`属性是否设置为`get`or `post`？

# sql - 正则表达式匹配常见的 SQL 语法？

> ID：139926
> 
> 赞同：17
> 
> 时间：2008-09-26T14:38:08.450
> 
> 标签：sql, regex, unit-testing

上周我正在为一段生成一些 SQL 语句的代码编写一些单元测试。

我试图找出一个匹配的正则表达式`SELECT`和`INSERT`语法`UPDATE`，以便我可以验证我的方法是否生成了有效的 SQL，经过 3-4 小时的搜索和各种正则表达式编辑器的处理，我放弃了。

我设法获得了部分匹配，但是因为引号中的部分可以包含任何字符，所以它会快速扩展以匹配整个语句。

任何帮助将不胜感激，我对正则表达式不是很好，但我想了解更多关于它们的信息。

顺便说一句，我追求的是 C# RegEx。

**澄清**

我不想访问数据库，因为这是单元测试的一部分，我不想维护数据库来测试我的代码。这可能比项目寿命更长。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-26T15:04:30.507

正则表达式只能匹配有限状态自动机可以解析的语言，这是非常有限的，而 SQL 是一种语法。**可以证明您无法使用正则表达式验证 SQL。**所以，你可以停止尝试。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-26T20:42:04.893

SQL 是一种[type-2 语法](http://en.wikipedia.org/wiki/Chomsky_hierarchy)，它太强大了，无法用正则表达式来描述。这就像您决定生成 C# 代码然后在不调用编译器的情况下对其进行验证一样。数据库引擎一般来说太复杂了，不容易被存根。

也就是说，你可以试试[ANTLR 的 SQL 语法](https://github.com/antlr/grammars-v4/wiki)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T15:07:47.333

据我所知，这超出了正则表达式和您接近 BnF 和编译器的黑暗艺术的范围。

[http://savage.net.au/SQL/](http://savage.net.au/SQL/)

同样的事情也发生在想要进行正确的语法高亮的人身上。你开始把东西塞进正则表达式，然后你最终写了一个编译器......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-13T20:13:11.870

我遇到了同样的问题 - 一种适用于所有更标准 sql 语句的方法是启动一个内存中的 Sqlite 数据库并针对它发出查询，如果你得到一个“表不存在”错误，那么您的查询已正确解析。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T14:43:25.893

在我的脑海中：你不能将生成的 SQL 传递给数据库并在它们上使用 EXPLAIN 并捕获任何表明 SQL 格式不正确的异常吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T14:42:23.290

您是否尝试过惰性选择器。它们不是尽可能匹配，而是尽可能少地匹配，这可能是引号所需要的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T14:45:18.557

要验证查询，只需使用[SET NOEXEC ON](http://msdn.microsoft.com/en-us/library/ms188394.aspx)运行它们，当您解析查询而不执行查询时，企业管理器就是这样做的。

此外，如果您使用正则表达式来验证 sql 查询，您几乎可以肯定会错过一些极端情况，或者由于其他原因查询无效，即使它在语法上是正确的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T14:59:39.973

我建议创建一个具有相同架构的数据库，可能使用嵌入式 sql 引擎，并将 sql 传递给它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T15:07:31.343

我认为您甚至不需要创建架构来验证语句，因为系统在成功解析语句之前不会尝试解析 object_name 等。

以 Oracle 为例，如果你这样做，你肯定会得到一个错误：

```
select * from non_existant_table; 
```

在这种情况下，“ORA-00942：表或视图不存在”。

但是，如果您执行：

```
select * frm non_existant_table; 
```

然后你会得到一个语法错误，“ORA-00923: FROM keyword not found where expected”。

应该可以将错误分类为指示不正确语法的语法解析错误以及与表名和权限等相关的错误。

再加上不同 RDBMS 甚至不同版本允许不同语法的问题，我认为你真的必须使用数据库引擎来完成这项任务。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-27T00:24:32.470

有[ANTLR 语法](http://www.antlr.org/grammar/list)来解析 SQL。使用[内存数据库](http://www.oracle.com/technology/products/timesten/index.html)或非常轻量级的数据库（例如[sqlite](http://www.sqlite.org/) ）确实是一个更好的主意。从解析的角度测试 SQL 是否有效对我来说似乎很浪费，而检查表和列名以及查询的细节更有用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-01-26T22:16:01.793

最好的方法是验证用于创建查询的参数，而不是查询本身。接收变量的函数可以检查字符串的长度、有效数字、有效电子邮件等。您可以使用正则表达式来执行此验证。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-26T14:42:57.940

我假设你做了类似`.\*`尝试的事情，而不是`[^"]*`让你吃掉整条线。`\`它仍然会在你有字符串的情况下给出误报。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2016-01-28T17:13:55.837

```
public bool IsValid(string sql)
{
string pattern = @"SELECT\s.*FROM\s.*WHERE\s.*";
Regex rgx = new Regex(pattern, RegexOptions.IgnoreCase);
return rgx.IsMatch(sql);
} 
```

# string - 是否有 CComBSTR 的缓冲版本可以使字符串连接更有效？

> ID：139927
> 
> 赞同：0
> 
> 时间：2008-09-26T14:38:10.323
> 
> 标签：string, winapi, concatenation

我有几个项目需要将字符串附加到 BSTR/CComBSTR/_bstr_t 对象（例如构建动态 SQL 语句）。WinAPI 中是否有开箱即用的类型来缓冲连接（如 .NET 中的 StringBuilder），还是我必须自己编写？根据我对附加方法的了解，它们执行重新分配。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T14:46:53.203

你必须自己写。您可以使用 SysAllocStringLen 或 SysReallocString API 来获取不同大小的缓冲区。它们适用于输入字符串，但您可以传递 NULL 来分配固定大小的未初始化缓冲区。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:04:27.747

将 BSTR 复制到 CString 中，在那里进行所有修改，然后将其复制回 BSTR/CComBSTR。CString 的分配速度比 SysAllocStringLen 快。

# .net - ASP.NET 验证控件和 Javascript 确认框

> ID：139948
> 
> 赞同：3
> 
> 时间：2008-09-26T14:42:03.167
> 
> 标签：.net, asp.net, javascript, vb.net, winforms

我有一个使用 .NETs 服务器端输入验证控件的页面。该页面还有一个 javascript 确认框，在提交表单时触发。Currently when the Submit button is selected, the javascript confirm box appears, and once confirmed the ASP.NET server-side validation controls are fired. 我想在显示 javascript 确认框之前触发服务器端验证控件。

如何实现？我在下面包含了我当前代码的示例。

示例.aspx

```
<asp:textbox id=foo runat=server />
<asp:requiredfieldvalidator id=val runat=server controltovalidate=foo />
<asp:button id=submit runat=server onClientClick=return confirm('Confirm this submission?') /> 
```

示例.aspx.vb

```
Sub Page_Load()
    If Page.IsPostback() Then
        Page.Validate()

        If Page.IsValid Then
            'process page here'
        End If
    End If
End Sub 
```

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-29T05:33:34.657

这似乎是一个非常普遍的问题。

解决方法：

首先验证页面，然后调用`confirm`，如此[处](http://www.stevekinsey.com/2007/06/04/onclientclick-and-form-validation-controls/)和[此处](http://www.codedigest.com/CodeDigest/73-Fire-Validator-Controls-Before-JavaScript-Confirm-Box-Fires-in-ASP-Net-Page.aspx)所示。这确实有调用验证两次的缺点 - 一次在您的代码中，一次在生成的代码中提交。`onclick`

如何使其正常工作，即首先验证页面（并且只验证一次），然后显示`confirm`框，我还不知道。

编辑：[这](http://www.dotnetjohn.com/articles.aspx?articleid=39)是一个有用的建议：

> 当验证控件存在时，ASP.NET 在幕后所做的是为每个按钮添加一个自动生成的 onClick 事件。此 OnClick 事件将取代自定义 OnClick 事件。所以为了克服这个问题，我做了以下事情：
> 
> 1.  添加 CausesValidation = False
> 2.  在页面后面的 onClick 事件中添加了 Validate() 和 IsValid 代码，以模拟按钮后面现在缺少的自动生成的验证代码。

编辑2：一个完整​​的例子

```
<asp:Button ID="btnSubmit" runat="server" Text="Submit" OnClientClick="if (Page_ClientValidate()){ return confirm('Do you want to submit this page?')}" CausesValidation="false" /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-06-27T10:54:19.723

## 验证检查后代码中的确认框

```
 <asp:Button ID="btnSave" runat="server" OnClientClick="javascript:return ConfirmSubmit()" OnClick="btnSave_Click" Text="Save" /> 

//---javascript -----
function ConfirmSubmit()
{
   Page_ClientValidate();
   if(Page_IsValid) {
       return confirm('Are you sure?');
    }
 return Page_IsValid;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T14:46:34.233

您能否不使用验证器控件的 EnableClientScript 属性，允许您在提交时在客户端执行验证，然后验证将触发？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T15:03:53.240

问题是 Return Confirm 在验证器的 javascript 之前触发。这一切都与生命周期和东西有关。

如果您确实想拥有这种行为，您需要做的是将所有验证器更改为自定义验证器，为自定义验证器推出您自己的 JS 验证例程，然后在结束时调用确认验证例程作为最终调用。

如果***可以***更改触发顺序，如果您将用于返回确认编码的 JS 添加到 HIJAX 方法中的按钮，在页面完全加载到浏览器后它被分配给 onClick 事件 - 但我从未使用过那种能力的方法，所以不要在那里引用我。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T15:08:19.970

验证器由表单上的 onsubmit 处理程序触发。

如果您的覆盖 form.onsubmit 您将失去验证器触发，尽管您可以手动提供所需的 JS。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T15:25:51.923

使用 ASP.NET 控件工具包的 ValidatorCallout 控件怎么样？来自：[http ://www.asp.net/AJAX/AjaxControlToolkit/Samples/ValidatorCallout/ValidatorCallout.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ValidatorCallout/ValidatorCallout.aspx)

ValidatorCallout 是一个 ASP.NET AJAX 扩展器，它增强了现有 ASP.NET 验证器的功能。要使用此控件，请像往常一样添加一个输入字段和一个验证器控件。然后添加 ValidatorCallout 并将其 TargetControlID 属性设置为引用验证器控件。

我没有使用过这个，但在我看来，它可以让你获得你想要的客户端验证。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-25T10:41:49.693

您应该验证客户端本身的页面。

```
function validate()
{
    Page_ClientValidate();
    if (Page_IsValid)
        // do your processing here

    return Page_IsValid;
} 
```

可以在按钮的“onClientClick”事件上调用该方法，在代码隐藏中，如果页面有效，则可以在客户端验证成功时进行处理。

所以，在按钮的点击事件上，你可以做 -

```
protected void SubmitButton_Click(object sender, EventArgs e)    
{    
    if (!this.isValid)
        return;

    // do the processing here
} 
```

# asp.net-mvc - 需要一些 ASP.NET MVC 路由帮助

> ID：139954
> 
> 赞同：2
> 
> 时间：2008-09-26T14:42:24.057
> 
> 标签：asp.net-mvc

我最近开始使用 ASP.NET MVC，阅读博客、教程、尝试一些路线等。现在，我偶然发现了一个需要帮助的问题。

基本上，我有一个类似 /products.aspx?categoryid=foo&productid=bar 的 URL

大多数教程/示例建议将其映射到以下内容：/products/category/foo/bar 其中“products”是控制器，“category”是操作等。

但我需要将它映射到 /products/foo/bar。（没有“类别”）

是否可以？我错过了什么吗？帮助将不胜感激。谢谢你提前:)

PS对不起我的英语不好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T14:47:45.010

*（你的英文很好，不用道歉！）*

你可以像这样定义一个路由：

```
routes.MapRoute("productsByCategory", "products/{category}/{productid}",
  new { controller="products", action="findByCategory" }) 
```

这将匹配

`products/foo/bar` 并调用如下所示的操作：

```
public class ProductsController : Controller
{
   ...

   public ActionResult FindByCategory(string category, string productid)
   {
          ....
   }
} 
```

这有帮助吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T17:24:43.993

您还可以考虑制作一个控制器来测试您的自定义路由......

查看[Stephen Walther 的博客文章](http://weblogs.asp.net/stephenwalther/archive/2008/08/03/asp-net-mvc-tip-29-build-a-controller-to-debug-your-custom-routes.aspx)。

# visual-studio - MSBuild 目录结构限制变通办法

> ID：139964
> 
> 赞同：18
> 
> 时间：2008-09-26T14:44:51.443
> 
> 标签：visual-studio, command-line, msbuild

有没有人有办法克服 MSBuild 工具的 260 个字符限制，以便从命令行构建 Visual Studio 项目和解决方案？我正在尝试使用 CruiseControl 使构建自动化（CruiseControl.NET 不是一个选项，所以我试图将其绑定到普通的 ant 脚本中）并且我一直遇到路径长度问题。澄清一下，问题在于解决方案文件中引用的项目路径的长度，因为该工具没有正确折叠路径:(

我也尝试过使用 DevEnv，它有时可以工作，有时会引发异常，这对于在单独的机器上自动构建并不好。所以请不要建议使用它作为替代品。

最重要的是，当通过普通 IDE 使用 Visual Studio 时，项目构建良好。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-30T08:51:45.083

似乎这是 MSBuild 的限制。我们遇到了同样的问题，最后，我们不得不缩短路径，因为没有找到任何其他正常工作的解决方案。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-30T10:24:36.747

[SUBST 命令](http://technet.microsoft.com/en-us/library/bb491006.aspx)仍然存在，因此如果 Judah Himango 的解决方案不好，将构建文件夹的根重新映射到驱动器号可能会节省一些字符。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-03-09T14:30:49.937

我通过调整 CSPROJ 文件解决了类似的问题：

```
<BaseIntermediateOutputPath>$([System.IO.Path]::GetFullPath('$(MSBuildProjectDirectory)\..\..\..\Intermediate\$(AssemblyName)_$(ProjectGuid)\'))</BaseIntermediateOutputPath> 
```

结果在编译期间 CSC.EXE 收到完整路径而不是相对路径。

感谢 harrydev 提供有关 CSC.EXE 如何使用路径的线索。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-14T05:47:44.840

有两种与构建相关的长路径问题。一种是路径不太长，但其中有很多“..\”。通常，这些是引用的 HintPath 值。MSBuild 应该将这些路径标准化到低于最大限制，以便它们工作。

另一种路径太长了。对不起，但这些只是行不通。在仔细研究之后，问题是对于长路径没有足够的 API 支持。BCL 团队（见他们的博客）也有类似的问题。只有部分 Win32 API 支持 \?\ 格式。任意构建工具，可能有 98% 的应用程序，不这样做；更糟糕的是可能会表现得很糟糕（想想所有为 MAX_PATH 调整大小的缓冲区）。

我们得出的结论是，除非有大量的生态系统努力让长路径工作，或者 Windows 想出一些巧妙的方法让它们无论如何都工作（比如短路径损坏？）MSBuild 不可能支持长路径. 如您所见，解决方法包括 subst；但是如果你的树太深了，你唯一的选择就是将它构建在片段中，或者缩短文件夹名称。对不起。

丹/MSBuild

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-10-07T12:08:59.117

我发现问题在于，当调用 C# 编译器（csc.exe）时，它使用项目目录路径 PROJECTDIRECTORY 以及输出路径 OUTPUTPATH，只需将它们附加为：

> 项目目录+输出路径

但是，如果 OUTPUTPATH 是相对的，即“..\..\Build\ProjectName\AnyCPU_Debug_Bin\”并且项目目录很长，那么总长度会超过 259 个字符，因为路径将是：

> PROJECTPATH+"..\..\Build\ProjectName\AnyCPU_Debug_Bin\"

而不是绝对路径。

如果 csc.exe 在调用 Win32 函数之前创建一个绝对路径，这将起作用。因为在我们的例子中，绝对路径长度小于 160 个字符。

由于某种原因，从 Visual Studio 对 csc.exe 的调用与 MSBuild 不同，而不是从 Visual Studio 调用。不知道为什么。

在任何情况下，都可以通过更改 PROJECTDIRECTORY 和/或 OUTPUTPATH 路径中的一个或两个来解决问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T15:40:10.720

你试过DOS路径吗？还是 \\?\ 前缀？[.NET BCL 团队博客](http://blogs.msdn.com/bclteam/)有更多信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-08-09T09:35:12.423

如果路径长度为 260，则有警告解析参考，对于 259 或 261 不会发生此错误。我认为有 msbuild 错误。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-09-11T13:23:30.330

我知道已经有一个公认的答案，但是我在使用它时遇到了一个不同的问题，`msbuild`它给了我相同的错误输出，并导致我进行了一次循环的野鹅追逐。所以，对于未来的谷歌人来说，这里是：

我们有一个调用的批处理文件`msbuild`，但是由于构建机器可以为多个版本的 Visual Studio 构建，每个批处理文件`vcvarsall.bat`在运行之前都会调用`msbuild`. 这有一个令人讨厌的副作用，就是一遍又一遍地将路径完全填满相同的东西。当它填满时，你会得到上面问题中显示的错误：`The input line is too long.`一个简单的谷歌搜索可能会让你觉得你的路径突然太长了`msbuild`。

就我而言，它就像终止会话`cmd.exe`并重新启动一样简单，因为这会将环境变量恢复到它们的本机状态。

# c# - SqlParameter Size - 设置为最大大小的负面影响？

> ID：139971
> 
> 赞同：2
> 
> 时间：2008-09-26T14:45:39.930
> 
> 标签：c#, sql-server, ado.net

我有一个`SqlCommand`我想调用`Prepare()`的对象`CommandType = Text`（它**不能**是存储过程）。

为此，我需要将`Size`参数上的属性设置为非零，否则会引发异常。`Size`即使实际值的大小永远不会接近该值，将所有参数设置为最大可能大小是否有任何负面影响？有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T15:14:26.723

我认为这样做的唯一潜在负面影响是为参数分配内存的成本。

由于您正在调用“Prepare()”，我猜您计划对同一个 SqlConnection 多次使用 SqlCommand，这表明可能会使用它的离散代码部分（如果连接关闭以准备好命令，命令文本必须在下次使用时重新传输到服务器）。

如果您知道参数的性质，似乎您可能对它们的潜在大小有所了解。如果没有，那么我真的看不出你有什么选择，而不是为每个人声明一个非常大的大小 - 大到足以容纳大多数/任何潜在价值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T15:04:53.283

如果您使用只接受参数名称和值的 SqlParameter 构造函数，框架就是这样做的。客户端可能效率低下，但我从未注意到查询性能的差异。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:07:44.400

鉴于您使用的是 CommandType = Text，您应该能够以编程方式将大小设置为您发送的参数的实际大小。

当您的数据大小接近您发送的数据类型的最大大小时，您应该只会看到较差的性能。如果您的参数相对于命令文本的大小总是很大，那么从网络流量的角度来看，通过切换到存储过程，您只会看到性能上的最小提升。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T15:17:26.687

**请发布您的代码示例**。您无需在参数上设置 Size 属性即可调用 .Prepare()。

顺便说一句，您可能并不真的需要调用 .Prepare()，尤其是在之后立即调用 .Execute() 时。

# svn - 将目录提交到 Subversion

> ID：139972
> 
> 赞同：11
> 
> 时间：2008-09-26T14:45:44.577
> 
> 标签：svn, svnkit

一种新手问题，但我在使用 SNVKit 时遇到问题。

我在应用程序中使用 SVNKit 来提交对文件的更改。我已经成功地将文件和文件夹添加到工作副本中，但是在将其提交到存储库时遇到问题。

我试图运行的命令是 'commit -m "Test Add" /svnroot/project1/' 但我不断收到 "svn: '/home/user' is not a working copy"

我有一个类似于这样的结构：

*   /svnroot/
*   /svnroot/project1/
*   /svnroot/project1/grouping1/
*   /svnroot/project1/grouping1/myfilesarehere

如果我尝试提交文件，我会收到以下消息：“'/svnroot/project1/grouping1' 不受版本控制，不是提交的一部分，但其子项是提交的一部分。”

我可能做错了什么？

编辑：修复了目录。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-05-18T22:40:28.973

如果您同时添加了一个目录及其子目录，但都没有提交，我相信如果您尝试只提交子目录，您会收到此消息。您需要先提交父目录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-08-07T03:14:58.367

我收到了这条消息，我注意到我在子目录中时正在执行提交。当我切换到树的根时，它提交了 w/o 问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T14:50:03.927

将您的 -m “评论”移到最后。我只是将目录更改为您的项目目录。然后你只需输入 svn commit -m "comment" 剩下的就交给 svn。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T15:10:24.830

我认为问题在于您正在对实际的 SVN 存储库本身进行更改，而不是进行导入、为自己签出副本、进行更改，然后在添加任何子目录后从签出的工作副本中进行提交。所以: `import`, `checkout`,*进行更改*，然后最后`add`为每个新文件或目录做一个并`commit -m "message"`形成顶层。

更多信息请参阅[免费的在线 SVN“乌龟”一书](http://svnbook.red-bean.com/en/1.5/svn-book.html#svn.basic.in-action.wc)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T14:50:56.267

这并不完全清楚，因为您不一致地替换了它们，但看起来您将存储库路径/URL 与工作副本路径混淆了。如果您要添加或提交文件，请始终使用工作副本路径。在尝试使用 SVNKit 之前尝试使用命令行 svn。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T14:54:47.193

如果您想提交一个全新的目录，请考虑使用[svn import](http://svnbook.red-bean.com/en/1.2/svn.ref.svn.c.import.html)代替。就目前而言，您可能必须恢复或采取其他行动来清理当前的混乱局面。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T15:49:25.953

我已将其追踪到某处可能存在的错误。如果我不添加消息，它会起作用。是时候进行更多挖掘了。感谢您的指点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-10-29T15:24:56.223

有时，使用 eclipse 或 Versions.app 等软件会产生此错误。在这种情况下，请退出 SVN 客户端并在命令行上执行此操作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-04-29T08:36:48.243

您可能已经进行了一些重构，并且正在尝试提交“some.package.YourClass.java”，在这种情况下，请尝试提交目录（包）“some”。

如果您想在将来避免这种头痛，请考虑切换到 GIT 而不是 svn。请记住 svn 将您的更改保存在 .svn 文件中并尝试将其推送到存储库。当您提交时，它将根据此 .svn 文件推送“您的更改”。但是，如果您的更改非常复杂怎么办？svn 处理不了。

另一方面，GIT：您检索所有更新，因此您的项目是最新的。并且在提交时它只是覆盖了 repo，因为它知道你的 repo 是最新的并且没有喧嚣。

# c# - C# 中的泛型接口会防止装箱吗？（.NET 与 Mono 性能）

> ID：139979
> 
> 赞同：5
> 
> 时间：2008-09-26T14:46:40.113
> 
> 标签：c#, performance, generics, mono, boxing

我有一个 C# 接口，其中某些方法参数声明为`object`类型。但是，传递的实际类型可能因实现接口的类而异：

```
public interface IMyInterface
{
    void MyMethod(object arg);
}

public class MyClass1 : IMyInterface
{
    public void MyMethod(object arg)
    {
        MyObject obj = (MyObject) arg;
        // do something with obj...
    }
}

public class MyClass2 : IMyInterface
{
    public void MyMethod(object arg)
    {
        byte[] obj = (byte[]) arg;
        // do something with obj...
    }
} 
```

MyClass2 的问题在于`byte[]`to 和 from的转换`object`是[装箱和拆箱](http://msdn.microsoft.com/en-us/library/yz2be5wk.aspx)，这是影响性能的计算量大的操作。

用[通用接口](http://msdn.microsoft.com/en-us/library/kwtft8ak.aspx)解决这个问题会避免装箱/拆箱吗？

```
public interface IMyInterface<T>
{
    void MyMethod(T arg);
}

public class MyClass1 : IMyInterface<MyObject>
{
    public void MyMethod(MyObject arg)
    {
        // typecast no longer necessary
        //MyObject obj = (MyObject) arg;
        // do something with arg...
    }
}

public class MyClass2 : IMyInterface<byte[]>
{
    public void MyMethod(byte[] arg)
    {
        // typecast no longer necessary
        //byte[] obj = (byte[]) arg;
        // do something with arg...
    }
} 
```

这是如何在 .NET 与 Mono 中实现的？在这两个平台上都会有任何性能影响吗？

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T14:54:18.457

您将在 Mono 中获得与在 .NET 中相同的好处。

我们强烈建议您总体上使用 Mono 1.9 或 Mono 2.0 RCx，因为泛型支持仅在 1.9 中成熟。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T14:50:07.110

> MyClass2 的问题是 byte[] 与 object 的转换是装箱和拆箱，这是影响性能的计算量大的操作。

数组类型不涉及装箱，即使是值类型元素也是如此。数组是一种引用类型。

(byte[]) arg 的开销充其量是最小的。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-26T14:51:19.557

我不确定它是如何在单声道中实现的，但通用接口会有所帮助，因为编译器会为使用的每种不同类型创建一个特定类型的新函数（在内部，它可以利用相同的生成函数） . 如果生成了特定类型的函数，则无需对该类型进行装箱/拆箱。

这就是为什么 Collections.Generic 库在 .NET 2.0 中大受欢迎的原因，因为集合不再需要装箱并且变得更加高效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T15:33:57.940

是的，在 .Net 中（MS 不确定单声道）泛型是在编译时实现的，因此根本没有装箱或拆箱。与 Java 泛型形成对比，后者是仅在后台为您执行强制转换的语法糖（至少曾经是这种方式）。泛型的主要问题是您不能多态地处理泛型容器，但这有点偏离您的主题:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T14:50:20.153

我无法与 Mono 交谈，但使用通用接口*应该可以*解决 MS 运行时中的装箱/拆箱问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-06T22:20:35.623

鉴于您使用的是最新版本的单声道，如果可以，请使用 2.0。

Mono 上的通用接口性能非常好，与常规接口调度配对。

通用虚拟方法的调度[1] 在所有已发布的 mono 版本上都很糟糕，它在 1.9 中得到了改进。

这个问题并没有那么糟糕，因为泛型虚拟方法的性能问题已经在预定于今年年底发布的下一个 mono (2.2) 版本中得到修复。

[1] 通用虚拟方法类似于：

公共接口 Foo {

```
 void Bla<T> (T a, T b); 
```

}

# java - 替换 QuickTest Professional (QTP) -- 我需要一个工具来测试 Java 应用程序

> ID：139984
> 
> 赞同：4
> 
> 时间：2008-09-26T14:47:20.660
> 
> 标签：java, testing, qa

现在，我正在使用 QTP（非常昂贵的软件）测试 Java 应用程序。

我决定将我的 Web 应用程序测试转移到 Selenium（使用 Java），我想知道是否有任何其他好的工具来测试我的 Java 应用程序，或者是否有一些库可以让我像 Selenium 这样单击/输入 Java 应用程序用于网络应用程序。

我正在寻找类似 Selenium 的东西，但适用于 Java 应用程序（即，如果你想测试 Eclipse IDE，你会使用它）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T21:19:59.687

我对 Jemmy 有很好的体验，Jemmy 是为 Netbeans 制作的 UI 测试库。我将它与 Groovy 结合起来编写测试脚本。

它是一个纯粹的库，而不是一个记录/播放工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T20:07:59.407

马拉松看起来很有趣，虽然我自己没有用过。

[http://www.marathontesting.com/Marathon.html](http://www.marathontesting.com/Marathon.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:37:55.557

试试 Compuware 工具，比 QTP 便宜但同样强大

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T23:56:54.140

Silktest 声称完全支持 Eclipse 3.4，但是，它不支持 SWTTreeView。因此，它不能测试废话。

此外，新的 Silktest Open Agent 正在取代 Classic Agent。开放代理具有经典代理的大约 25% 的能力。

Silktest 在使用其 Classic Agent 测试基于 Java JFC 的应用程序方面表现出色。

如果没有电话支持，我会避免使用开源工具。没有这些，与商业测试工具相比，开源工具就是一个笑话。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-03T14:17:11.983

我会推荐 Silktest。

我过去曾将它与 Lisp 一起用于测试 Autocad。

非常好 ;）

# business-intelligence - 对想要开始商业智能的人的建议？

> ID：139988
> 
> 赞同：17
> 
> 时间：2008-09-26T14:48:48.113
> 
> 标签：business-intelligence

对于想要从 BI（商业智能）领域开始的人，您有什么建议？

我应该从哪里开始，从什么开始：书籍、博客、网络广播……我应该注意什么，应该远离什么。

微软的技术值得吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T15:21:45.227

MS 技术堆栈非常好，并且是迄今为止最容易获得的（尝试获取 Cognos Reportnet 的副本以进行自学）。遇到麻烦的地方（这是获得 BI 技能的主要障碍）是实际获得处理真实数据的经验。很难为这类事情想出一个逼真的玩具场景。

这意味着您必须克服由此带来的先有鸡还是先有蛋的问题。一种选择是尝试在政府部门或其他由于工资限制而难以招聘的地方担任 BI 开发人员的工作。技术技能的明确证据和对业务表现出的兴趣可能会让您踏上大门。

在经济衰退中，这将更加困难。然而，优秀的 BI 人员仍然缺乏技能。原因是（IMO）不是缺乏技术技能（技术不是火箭科学）。相反，我认为这是前面提到的先有鸡还是先有蛋的问题，以及 BI 领域涉及客户亲密关系才能做好这一事实。它适用于直接与客户联系的分析师/程序员模式下工作（我做这类工作的原因之一）。如果您喜欢在这种模式下工作，这可能是您进入的好方法。

编辑：刚刚在这个领域得到工作机会的人[问他是否应该接受这份工作。](https://stackoverflow.com/questions/323801/prospects-of-a-business-intellegence-career#323854)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T20:03:53.260

我发现微软的[“真实项目”](http://www.microsoft.com/technet/prodtechnol/sql/2005/projreal.mspx)在进入双世界时真的很有帮助。它是一个由微软支持的真实世界 bi 项目，旨在开发和展示有关 bi 的所有领域的最佳实践，例如 etl、数据仓库设计、立方体设计等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T20:13:59.653

Business Objects [http://www.businessobjects.com/](http://www.businessobjects.com/)在这个领域是一个相当大的参与者，熟悉他们的产品也将帮助您进入 BI 角色。

对于练习数据，我会推荐几年前出现的来自 aol 的匿名搜索记录 - [http://www.techcrunch.com/2006/08/06/aol-proudly-releases-massive-amounts- of-user-search-data/](http://www.techcrunch.com/2006/08/06/aol-proudly-releases-massive-amounts-of-user-search-data/)这是真实世界的大小，是一个有趣的数据库，其中包含一些已发布的搜索集。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-07T06:00:09.640

我会强调你读这本书；可能看起来有点过时，但同样的理论今天仍然适用。它可能是一般 BI 的最佳入门。

[数据仓库工具包 - Ralph Kimball](https://rads.stackoverflow.com/amzn/click/com/0471200247)

关于 Microsoft 的 BI，它是一个中型工具，可以在您的第一步中完成工作（尽管我在 Cognos 方面有更多经验）。自 2005 年以来就没有使用过 MS 工具，所以我不能说太多。

如果您碰巧对 Cognos 感兴趣，我有一些视频可以提供帮助：[Cognos 教程](http://www.youtube.com/maulazyhola)

祝你的项目好运。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-15T10:02:04.427

获取 Kimball 书籍（特别是这一本[http://www.amazon.com/The-Data-Warehouse-Toolkit-Dimensional/dp/0471200247](https://rads.stackoverflow.com/amzn/click/com/0471200247)），对于初学者，您可能希望从 MS BI 框架[Microsoft 数据仓库工具包](https://rads.stackoverflow.com/amzn/click/com/0470640383)开始和 SQL Server Enterprise（MS BI Bundle 与数据库、ETL 和报告），很容易获得，特别是如果您是使用 MSDNAA 的学生，您可以免费获得企业版！！！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-11-12T10:53:01.277

对于一般商业智能，我发现[Kimball Group](http://www.kimballgroup.com/category/design-tips/)是最佳实践的重要来源。

If you would like to start building your own project, check out [GoodData Platform](http://www.gooddata.com). We have full BI stack Platform as a Service and you can start for free (evaluation period) with access to all resources and learn from [Tutorials on our Developer Portal](https://developer.gooddata.com).

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T14:54:05.337

我会说尝试找到一些课程。微软技术值得花时间。有许多大公司在 .Net 框架上运行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-04-22T13:00:20.850

我们用它来感受一下微观策略：[http ://www.teradatauniversitynetwork.com/apply-and-do](http://www.teradatauniversitynetwork.com/apply-and-do)

# svn - 如何让我的同事不鄙视SVN？

> ID：139989
> 
> 赞同：12
> 
> 时间：2008-09-26T14:49:14.883
> 
> 标签：svn, version-control

我的许多同事在 1-5 人的小组中使用 SVN，部分工作在特定项目上。其中一半是缺乏经验的学生。事实上，我们当中没有人是真正的软件开发人员，拥有一年之久的经验。他们中的大多数使用 Eclipse 和 subclipse 来读写他们对 SVN 存储库的贡献。

其中一些存在以下差异的问题：

*   签出（与更新和合并混淆）
*   提交（与更新混淆）
*   更新（与提交和签出混淆）
*   合并（是最难的。什么是合并？我必须将我的代码“合并到 SVN”中吗？）

他们担心如果按错按钮，SVN 可能会杀死他们的工作（他们不称其为工作分支）。

在将一些任意库依赖项添加到他们的 java 项目之后，他们将他们的 eclipse .project 文件提交到存储库。其他同事从这些提交中得到编译错误，并且发现很难解决这些问题。

一般来说，他们会说：*我想在没有 SVN 的情况下工作，我不喜欢它。这太复杂了。*

有没有像“SVN for kids”这样的电子学习项目？我怎样才能让它们像版本控制？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-26T16:31:21.610

以我的经验，这么多人“害怕”或不喜欢版本控制的主要原因之一是因为**他们不了解底层概念以及系统的工作原理**。不幸的是，许多经验丰富的开发人员也是如此。我认识一些使用 CVS 和 Subversion 多年的人，但他们从不创建分支或标签，因为他们不了解它们的工作原理，因此将它们视为“复杂”或“不必要”。

我认为**您的同事必须基本了解版本控制的目的、使用它的原因以及这样做所涉及的工作流程**。[就个人而言，我认为Subversion 书](http://svnbook.red-bean.com/)的前两章对所涉及的概念和版本控制系统背后的理论提供了最好的解释，因此我建议您的同事阅读这些内容。

**我*不*建议使用 IDE 集成来学习使用版本控制**。集成和插件通常会向用户隐藏系统的“细节”，这可能会非常令人困惑，尤其是当您不知道“幕后”的情况时。

我更喜欢[TortoiseSVN](http://tortoisesvn.net/)之类的工具，您可以在其中直接手动执行大多数操作，而在幕后没有任何“魔法”。例如，一个非常常见的误解是不了解您的工作副本和服务器上的存储库之间的区别。我经常看到切换到直接在文件系统上操作的工具将有助于解决这种情况，因为用户被迫主动思考他在做什么，以及为什么。

与生活中的几乎所有其他事情一样，使用版本控制也是最好的个人经验——尝试和失败，然后再试一次。这就是为什么[我建议为每个人创建沙盒主文件夹](http://blog.looplabel.net/2008/07/28/best-practices-for-version-control/)。允许他们试验系统中的各种功能，而不必担心破坏项目中的任何内容或丢失数据。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-26T15:14:46.850

首先，您需要采用“独立于软件”的方法来看待这个问题。不要强迫他们阅读红豆书，或者尝试告诉他们所有漂亮的 SVN 命令。相反，您应该首先尝试通过版本控制教授正确的工作流程。简而言之，这意味着：

1.  更新你的观点
2.  做一些改变
3.  测试你的代码
4.  再次更新
5.  如有必要，解决合并冲突
6.  犯罪

请注意，我不包括初始签出过程，因为您应该在那里帮助他们检查他们的初始视图。以上步骤只是支持 SCM 的开发人员*每天*应该做的事情（顺便说一句，您还应该真正强调这一点，否则担心合并冲突的人只会随着时间的推移变得更糟）。

成功采用 SCM 的关键是双重的；首先，您需要让人们习惯于使用该软件做正常的、无痛的事情（即更新/提交）。如果您不这样做，那么开发人员将倾向于避免使用 SCM，直到您打扰他们并询问他们为什么在两周内没有提交任何代码。其次，您需要教人们如何克服可能导致他们失去工作的常见痛苦情景。

SCM 系统确实有可能破坏工作，并且通常发生*在*任何内容被提交到具有合并冲突的存储库之前。您应该模拟合并冲突，引导它们解决它们，然后让它们自己做同样的事情。你应该解释：

*   .r1, .r2, .mine 和原文件冲突后的含义是什么
*   展示如何以图形方式解决冲突
*   现在重新编译并再次测试软件以确保
*   再次备份 .mine 文件，以确保
*   然后提交

SCM 中有许多更复杂的东西，只有在理解了基础知识之后才能**解释**。在他们有几个星期的日常经验之前，甚至不要费心提及合并或标记或类似的事情。否则，复杂性和额外风险将使这个新工具对他们来说显得更加“无用”。

同样，这里的关键是以软件中立的方式强调日常 SCM 工作流程，并在出现特定 SCM 系统的怪癖时慢慢解释它们。合并是唯一需要首先解释的复杂事情，因为它可能是每天遇到的唯一痛苦的事情。其他一切都应该在出现时进行解释。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-26T14:52:43.923

一步一步给出所需程序的简单“备忘单”是最好的方法。SVN 确实有一些不明显的缺陷。我接触过使用它的新人，有时他们确实会从当前版本中删除整块代码，等等。当然，您总是可以返回并从以前的版本中获取，但是 SVN*是*可怕和危险的新人。请记住这一点，并为所需的操作编写非常简单但明确的说明！

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-26T15:01:26.833

*“我怎样才能让它们像版本控制一样？”*

**删除他们的工作副本，他们会很快掌握版本控制软件的用处！**

说真的，使用 VCS 与成为一名成熟的开发人员密切相关。如果您不知道为什么需要 Subversion，我不会相信他们是开发人员。他们可能具有编程技能，但编程只是开发人员工作的一部分。

我确实相信，除非您丢失了代码，否则您将永远不会真正欣赏 VCS。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T15:01:41.623

*   无限撤消 - 无需担心丢失的更改
*   备份，不再是你的责任
*   “时间机器”功能 - 上周五晚上的代码是什么样的？
*   合作
*   中央，“官方”版本的源代码使构建发布变得容易
*   比较：有人敢碰你的代码，他到底改了什么？
*   tagging: 为已准备好演示的稳定版本打上标签，之后可以在代码库中继续开发

仅当两个开发人员修改同一源文件中的同一行时才需要“合并”。它在小型团队中并不经常发生，并且需要几分钟才能解决。所有其他更改由版本控制系统自动合并。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T14:54:49.813

如果他们主要是学生，一个卖点是在“现实世界”中，许多人非常重视版本控制。

如果他们害怕删除某些东西，请演示删除某些关键文件并演示[恢复已删除文件](http://m0j0.wordpress.com/2007/10/25/recovering-deleted-files-from-an-svn-repository/)的能力。

或者他们可能喜欢不同类型的版本控制，例如 git 或 mercurial。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T14:52:40.957

给他们一个关于svn的简短谈话。告诉他们有什么好处以及如何使用它。

尽管我在文件系统级别使用 Tortoise SVN，但我在大学毕业的第一份工作中设法获得了 SVN，没有遇到任何麻烦。我没那么聪明，所以如果我能拿起它，任何人都可以。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T14:56:29.530

与他们一起运行一些场景，了解为什么版本控制是好的。更好的是，让他们完成一些玩具项目，时间压力使他们经常提交。有些只允许他们通过 svn 共享代码，而有些只允许他们通过共享目录共享代码。

之后他们就会知道它是关于什么的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T15:29:33.147

你真的不能让任何人喜欢它。但是，如果您自己开始使用它并树立一个好榜样，那么好处将变得显而易见。您需要不断更新服务器并确保服务器已备份。这样，当系统中出现疯狂的错误时，您将拥有日志来显示导致错误的更改。你知道你需要做什么。不要让别人的无知阻止你。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-27T07:03:56.457

版本控制最大的问题是冲突解决。如果您真的想安全起见，请尝试以下工作流程：

1.  每个开发人员在开始编码之前都会从主干创建一个分支；
2.  开发人员在自己的分支中实现了一项功能并提交（无需更新，因为他是其分支中的唯一开发人员）；
3.  几个更有经验的开发人员审查代码、测试并将分支修订合并到主干；
4.  冲洗并重复

Subversion 1.5 的新特性非常适合这种工作流程。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T14:51:57.807

试试[这个](http://polishlinux.org/apps/subversion-howto/)。我在“傻瓜SVN”搜索中找到了它，它被描述为“傻瓜SVN，你奶奶可以理解的指南”：D

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T14:56:19.420

这是一个体面的 SVN“备忘单”，描述了基本用法：[http ://abbeyworkshop.com/howto/misc/svn01/](http://abbeyworkshop.com/howto/misc/svn01/)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T14:57:01.790

K 让你的朋友[阅读这篇文章。](http://svnbook.red-bean.com/)接下来在一些宠物项目上先学习cli，就大大阐明了这一点。我第一次看到 subclipse 让我讨厌日食。部分原因是我以前从未使用过颠覆。

*   签出 = 获取存储库中代码的本地副本。
*   更新 = 确保您的本地副本与主副本是最新的。又名服务器。
*   commit = 将您的更改添加到主副本
*   合并 = 自您签出后，您加上其他人已提交。合并允许您通过一点监督编辑来保留两组更改。

合并是一个简洁的功能，但一开始有点复杂。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T14:57:28.450

我建议他们至少阅读[http://svnbook.red-bean.com/en/1.5/index.html](http://svnbook.red-bean.com/en/1.5/index.html)写的不错，还带点幽默使用（即 TortoiseSVN 或 Subclipse）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-26T15:00:45.573

SVN 会跟踪项目启动以来的所有更改，因此几乎没有办法仅仅通过点击“错误”按钮就丢弃你的工作。我真的认为**所有重要的工作都应该在版本控制之下**，即使没有团队（我独自编写代码并使用它）。

直到我读[了这本小书](https://rads.stackoverflow.com/amzn/click/com/0977616657)，我才真正明白这一点，试着让他们至少阅读前 20 页。**颠覆和任何编辑器的“撤消”按钮**之间都有一个很好的类比，这可能会说服他们使用它（它对我有用:)）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-26T15:07:28.817

将它们发送至：

*   [http://svnbook.red-bean.com/](http://svnbook.red-bean.com/)
*   [http://www.ericsink.com/scm/source_control.html](http://www.ericsink.com/scm/source_control.html)

让他们印象深刻的是，任何使用半体面的源代码控制系统（即不是 VSS）的人都会将他们贬低为完全和彻头彻尾的傻瓜。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-26T15:25:21.020

您需要首先真正向他们推销版本控制的概念，以便他们了解 svn 的工作原理。

可以尝试的几件事是

*   创建用于训练和实验的沙盒存储库
*   尝试组织一些培训课程/研讨会。如果您对自己运行它没有信心，请尝试与您当地的 Linux 用户组聊天，看看他们是否认识可以提供帮助的人。
*   记录您的开发过程，包括常见的颠覆使用场景。

还值得向那些有源代码管理经验的学生指出，他们的简历将是一个加分项。

在提交 .project 文件的特定问题上，您可以在属性上设置 svn:ignore 属性，也可以在每个用户 subversion 配置文件中设置 global-ignores 值。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-26T15:35:43.163

您可能希望为最危险的命令（我主要考虑恢复）创建别名，这些命令在调用 svn 命令之前需要明确确认。

此外，如果他们使用 Eclipse，他们可以设置他们的编辑器，以便保留当前代码的 N 个工作副本。我已经通过该功能避免了几个愚蠢的版本控制错误。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-26T17:36:15.543

他们总是可以尝试“穷人的 CVS”：让他们在签入/签出任何东西之前对他们的代码进行压缩，然后将它们编号存储在硬盘驱动器的某个位置。

最后，他们将拥有一堆文件，例如：

*   我的项目01.zip
*   MyProject02.zip
*   （ETC）

这会让他们知道，如果他们做了一些愚蠢的事情，他们的“工作”不会被“破坏”，而且会很麻烦，迫使他们学习如何正确使用 SVN（来吧，没那么难！ ）。

我个人发现这个穷人的方法远远优于 Visual SourceSafe：在前雇主的我被迫使用那个怪物......在第二次存储库完全崩溃后，他们感谢我：D

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-27T06:53:56.217

如果你在 windows 机器上开发，尝试使用[TortoiseSVN](http://tortoisesvn.tigris.org/)作为你的 subversion 客户端。界面真的很棒。我会帮助他们摆脱对版本控制的恐惧。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-01-30T13:08:26.153

这一切都与使用新事物的信心有关，并了解他们正在使用的是什么。一旦你使用了它，很高兴它可以工作，“分歧”就会消失。

首先尝试培训概述 -[这是一个](http://www.polarion.org/index.php?page=overview&project=subtrain)提供一些 powerpoint 幻灯片的项目以提供帮助。

给他们 svn 书和 TortoiseSVN 的链接，以便在他们获得概述后阅读。

然后尝试使用沙盒存储库进行实践研讨会。

然后可以在他们真正使用它时提供一周左右的帮助。

这种方法适用于一切，而不仅仅是 SVN。

# functional-programming - SML 中的原型设计功能

> ID：139991
> 
> 赞同：2
> 
> 时间：2008-09-26T14:49:47.470
> 
> 标签：functional-programming, sml, smlnj

我有两个函数，`f`和`g`，它们以递归方式相互调用。不幸的是，当`f`调用它时`g`，它还没有被声明，所以我得到一个“未绑定变量”错误。我如何在 SML/NJ 中对这个函数进行原型设计（或任何等效词汇）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T16:03:06.233

使用`and`：

```
fun f x = ... 
and g x = ... 
```

更多信息[在这里](http://www.dcs.napier.ac.uk/~cs66/course-notes/sml/lesson8.htm)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:56:32.677

相互递归。在两个函数之间使用**`and`**而不是。**`fun`**

# java - 如何最好地序列化 java.awt.Image？

> ID：139996
> 
> 赞同：12
> 
> 时间：2008-09-26T14:50:45.610
> 
> 标签：java, image, serialization

我有一个 Serializable 对象，它应该将 java.awt.Image 作为其成员。我应该如何序列化它？ *（从一个不太清楚的第一个版本编辑，对不起。）*

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T14:58:19.540

ImageIcon 实现了 Serializable ，它可以用来包装一个 Image 类

[http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/ImageIcon.html](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/ImageIcon.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:14:09.207

javax.swing.ImageIcon 作为 Swing 的一部分，不保证版本之间具有兼容的序列化形式。但是，您可以作弊并查看它的 readObject 和 writeObject 代码 - 找到宽度和高度，使用 PixelGrabber 抓取像素。我不完全确定正确地涵盖了颜色模型。显而易见的替代方法是使用 javax.imageio 编写一个真实的图像格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T14:55:47.940

据我所知没有。我相信你需要为它编写自己的序列化程序，以基本上保存宽度、高度和像素值......或者将它作为 PNG 或其他东西写到流中********