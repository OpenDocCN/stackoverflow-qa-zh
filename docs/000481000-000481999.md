# StackOverflow 问答 000481000-000481999

# c# - 修改打印预览

> ID：481003
> 
> 赞同：2
> 
> 时间：2009-01-26T19:23:34.047
> 
> 标签：c#, system.printing, microsoft.ink

我正在构建 ac# 应用程序，它显示（文档的）打印预览，然后要求用户通过 InkPicture 控件“签名”文档。我从 inkpicture 控件中提取位图并将其应用到 PrintDocument 没有问题（我在打印预览之前的过程中较早地执行此操作并将这些图像绘制到打印文档）但打印预览的目的是允许用户查看文档，因为它将被打印并在其上签字。

我尝试将文档重置为修改后的文档

```
// MyDocumentType derives from PrintDocument and ipSignature is a 
// user control derived from InkPicture that converts the ink to 
// a gif    
MyDocumentType doc = (MyDocumentType)ppcPreview.Document;
doc.AddSignature(ipSignature.Gif);
ppcPreview.Document = doc; 
```

我试过重建打印预览控件

```
MyDocumentType doc = (MyDocumentType)ppcPreview.Document;
doc.AddSignature(ipSignature.Gif);
ppcPreview = new PrintPreviewControl();
ppcPreview.Document = doc; 
```

没有效果。

修改后使控件无效也无济于事。

我有点难过。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T19:48:53.247

您是否尝试使用 InvalidatePreview 方法而不是 Invalidate？

# .net - LinqToSQL Select 和 SelectMany 与 Join

> ID：481023
> 
> 赞同：15
> 
> 时间：2009-01-26T19:30:19.183
> 
> 标签：.net, sql, linq, linq-to-sql, .net-3.5

Select 和 SelectMany 是否比 Joins 更可取？

我想知道的原因是因为我使用 LinqPad 并且在一个部分中有评论说：

```
// Note: before delving into this section, make sure you've read the preceding two
// sections: Select and SelectMany. The Join operators are actually unnecessary
// in LINQ to SQL, and the equivalent of SQL inner and outer joins is most easily
// achieved in LINQ to SQL using Select/SelectMany and subqueries! 
```

然而，在其他部分，它清楚地表明连接更快（至少对于 LinqPad 中给出的示例）并且对我来说它们更容易在我的脑海中可视化。

也许我误解了，因为我只看代码示例而不是书，但我看到其他人也推荐 Select 和 SelectMany over Joins。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-04T15:11:31.957

任性的博客对此事发表了[这样的看法](http://blogs.msdn.com/mattwar/archive/2007/09/04/linq-building-an-iqueryable-provider-part-vii.aspx)。Join 使用一组明确的参数来连接特定的键，并允许左外连接和右外连接。SelectMany 执行[单子绑定](http://blogs.msdn.com/wesdyer/archive/2008/01/11/the-marvels-of-monads.aspx)，通常会导致内部连接或交叉连接。由于 LINQ 本质上是 .NET 中函数式编程的实现，因此 SelectMany 是更自然的表达方式；但是，Join 的显式设置可能会导致更快的操作。

至于首选，我认为对你来说读得最清楚的就是最好的。[101 LINQ Samples](http://msdn.microsoft.com/en-us/vcsharp/aa336746.aspx)的C# 版本不包含 Join，但[VB 列表](http://msdn.microsoft.com/en-us/vbasic/bb737929.aspx)显示了不同场景中使用的 Join 和 SelectMany。

# c# - 其中property.setting值存储在c#windows应用程序中

> ID：481025
> 
> 赞同：10
> 
> 时间：2009-01-26T19:30:33.143
> 
> 标签：c#, windows

我认为它应该是一个配置文件，但找不到它。谢谢

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-01-26T19:44:29.123

整个配置文件的位置可能有点滑。根据它是“用户”设置还是“应用程序”设置，它将进入不同的文件。某些设置甚至可以来自您的“机器”配置（例如 ASP.NET）。**与其猜测一切都在哪里，我发现询问 .NET 在哪里寻找这些文件**更有用。大致：

```
//Machine Configuration Path
string path1 = ConfigurationManager.OpenMachineConfiguration().FilePath;
//Application Configuration Path
string path2 = ConfigurationManager.OpenExeConfiguration( 
      ConfigurationUserLevel.None).FilePath;
//User Configuration Path 
string path3 = ConfigurationManager.OpenExeConfiguration(
      ConfigurationUserLevel.PerUserRoamingAndLocal).FilePath; 
```

## 应用程序配置

这就是添加到您的项目中的内容。构建过程将其命名为**[myproject].exe.config**。这包含（大部分）只读应用程序设置和用户特定设置的应用程序级默认值。应用程序级别设置很难以编程方式更改其值。应用程序级别设置属性将仅定义“get”。**目的是：** *如果您的设置适用于应用程序的所有用户，那么手动编辑（或安装程序）应该设置它们。如果它按用户更改，则将其设为按用户设置。*

## 二进制默认设置

您的应用程序将在没有其 [myproject].exe.config 文件的情况下运行。为此，二进制文件有自己的“存储”文件版本。这在某些方面很有用，但可能会令人困惑。如果您的 .config 文件位于错误的位置或名称错误，.NET 将恢复为“二进制默认值”。通过更改配置文件可能会导致无法影响设置的外观。使用上面的方法来了解 .config 真正的去向，或者面对二进制默认设置的愤怒。

## 用户配置

这是在您第一次使用“每个用户”设置“保存” Default.Settings 对象时生成的。该文件保存在用户的配置文件路径中，位置基于您的项目名称、版本、操作系统和*其他一些黑暗的 .NET 魔法*。这些设置的属性是可读/可写的。它们旨在轻松设置，然后通过一次调用保存。

## 把它拉在一起

那么我的设置去哪儿了？答案是可能将许多文件连接在一起以获得“活动集”设置。App.config 和 user.config 设置是基本块，但是有 machine.config 设置，然后是依赖程序集设置，这会使事情变得更加复杂......但这完全是另一个话题。

配置文件的真实情况*散布在许多丑陋的案例和细节*中。但是，只要稍微了解它们是如何连接在一起的，它就会是一个相当有用的系统。特别是如果您意识到您可以将数据绑定到这些设置；）

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-26T19:38:00.697

如果您谈论的是 .Net 设置，那么它们通常位于与应用程序相同的目录中的 .config (xml) 文件中。但是，当您保存它们时，本地副本会保存到用户可写文件夹中（通常是 Vista 下的 C:\Users\username\AppData\Local）。在 XP 下，查看 Documents and Settings 文件夹。

.Net 应用程序优先使用此文件，而不是应用程序目录中的“默认”文件。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T19:40:37.913

在 Windows XP 上，它存储在名为 user.config 的文件中，位于以下子文件夹中：

```
C:\Documents and Settings\username\Local Settings\Application Data 
```

[http://dotnetproject.blogspot.com/2006/08/where-is-userconfig-file-located-in.html](http://dotnetproject.blogspot.com/2006/08/where-is-userconfig-file-located-in.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T19:35:07.503

您是指应用程序中的 .settings 文件吗？当您向该文件添加值时，会为您创建一个 app.config 文件。您应该在解决方案资源管理器中看到它。

# jquery - 重新绑定 jquery 事件以返回 html

> ID：481033
> 
> 赞同：0
> 
> 时间：2009-01-26T19:33:41.797
> 
> 标签：jquery

我正在使用 jquery 并且在绑定以从 Web 服务器返回数据时遇到问题。数据以 HTML 形式返回。

这就是发生的事情......

1.  用户单击链接并打开一个对话框。addToCurrent 按钮绑定到单击事件。
2.  用户将数据提交到 Web 服务器，并在返回数据上调用 returnFromAdd()。
3.  尝试在新数据中重新绑定 addToCurrent 按钮，但没有发生。

下面的代码是我正在尝试做的基础知识。如果您有任何建议，请告诉我。

```
 function bindAddGroupButtons() {
        $("#addToCurrent").click(function() { alert("here") });
    }

    $(".linkButton").click(function() {
        $.get("someURL", function(data) {
            $('#addGroupModal').html(data);
            $('#addGroupModal').dialog("open");
            bindAddGroupButtons();
        });
    });

    /*** callback function dialog post **/
    function returnFromAdd(data) {
        $('#addGroupModal').html(data);
        bindAddGroupButtons();
    } 
```

这就是我想要做的......

1.  创建一个向用户显示表单的模式对话框。
2.  提交表单后验证数据。
3.  如果数据良好，则将用户返回到对话框的父页面并更新字段（如表格）。
4.  如果数据错误，在打开的模式对话框中向用户报告错误。允许他们更正数据并重新提交。

我从其他论坛上的用户那里得到的只是这很容易。然后他们显示一行代码，但我无法让它工作。我想看一个有效的例子。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T21:18:58.853

I am afraid I can't fully understand what you are trying to do. It seems however that you want to add an event to an item added dynamically to the DOM. You can generally do this using the [live](http://plugins.jquery.com/project/livequery) plug-in. The newest version of jQuery 1.3 supports [live events](http://docs.jquery.com/Events/live).

# eclipse - 是否有一种简单、一致的方法来更改 Eclipse 编辑器的配色方案？

> ID：481035
> 
> 赞同：8
> 
> 时间：2009-01-26T19:34:07.130
> 
> 标签：eclipse, colors

我要疯了，想让所有的编辑看起来都一样。看起来每种文件类型/代码类型都有不同的颜色编辑器选项，这意味着需要 FOREVER 来自定义视图。

除此之外：每个代码/文件类型颜色选项似乎只在感觉像时才尊重通用选项中的默认设置（似乎有问题）。

我目前正在使用 Eclipse 3.4.1 (Ganymede)。

是否有错误较少的版本或是否有更一致的方式来更改文本颜色？

除此之外，是否有人在 Eclipse 中获得了[类似 Zenburn](https://en.wikipedia.org/wiki/Wikipedia:ZENBURN)的配色方案并愿意分享？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-01-12T02:08:56.437

我正在为此开发一个 Eclipse 插件：

[http://marketplace.eclipse.org/content/eclipse-color-theme](http://marketplace.eclipse.org/content/eclipse-color-theme)

它绝不是完整的，但它已经很好地工作了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T21:01:26.167

由于 Eclipse 的设计方式，这听起来目前没有一个好的方法：没有一个*好的*、灵活的、可继承的语法高亮框架来为所有内容带来一致性。

虽然您可以按照 Wijnand Warren 的回答状态导出和导入首选项，但这确实有效......有点......实际上进入并编辑首选项文件以确保您只共享颜色信息可能是一个巨大的痛苦屁股，那么不简单。此外，这仍然会留下一个问题，即首先要找到付出努力和时间来创建语法着色的人*。*

此外，每次添加新类型的结构化文本编辑器（每年都有新语言吗？）时，您还必须返回设置并编辑该语言的突出显示。

我没有为 Eclipse 平台开发的经验，但如果有更多经验的人愿意为我指明正确的方向（文档、对事物如何组合在一起的解释等），请告诉我。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T19:41:29.190

我一直在寻找同一个问题的答案，但几乎放弃了。更改配色方案并不容易，因为正如您所说，每种语言都有自己的选项深埋在配置树中。

我已经阅读了一些关于为什么“主题”不可用的内容，这与 Eclipse 的 XML 存储技术的复杂性有关。很抱歉我不能提供一个真正可靠的答案，但我只是想让你知道，你并不孤单。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T09:56:46.687

我也一直在寻找这个，经过一番研究，找到了一个可行的解决方案。这是基于 Eclipse 的 FDT 编辑器，但我相信您可以将相同的逻辑应用于其他编辑器。

我的博文：[如何为 FDT 创建配色方案](http://blog.ansuz.nl/index.php/2009/01/26/howto-create-a-color-scheme-for-fdt/)

希望这可以帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-17T15:17:44.310

[从http://eclipse-color-theme.github.com/update](http://eclipse-color-theme.github.com/update)安装颜色主题插件。它已经包含一些您可以使用的好主题。

然后只需转到菜单*窗口*→*首选项*→*常规*→*外观*→颜色主题即可应用主题。

[您可以从http://www.eclipsecolorthemes.org](http://www.eclipsecolorthemes.org)下载更多主题。

# delphi - 如何防止表格在 Delphi 中调整大小？

> ID：481036
> 
> 赞同：3
> 
> 时间：2009-01-26T19:34:53.353
> 
> 标签：delphi

如何防止我的表单被调整大小？我不希望它被最大化（可以通过属性编辑器切换），但我不希望任何人能够拖动调整它的大小。我错过了一些简单的东西，还是需要一点编码？

我正在使用德尔福 2007。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-26T19:39:07.557

TForm 有你需要的属性。放

BorderStyle 到 bsSingle

这样表单看起来就不会太大，而且它还有一个额外的好处，那就是实际上***不会太大***。:-)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T19:36:56.080

您可以将 BorderStyle 设置为 bsDialog。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T21:35:45.793

不要忘记TForm 的Constraint 属性，即MaxHeight、MinHeight、MaxWidth、MinWidth。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T19:40:24.810

您也可以将 BorderStyle 设置为*bsSingle*。这将为您提供一个适当的顶级框架，带有图标和所有内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T01:33:32.723

如果你想变得非常怪异（即上面的答案更好），你可以拦截 RESIZE Windows 消息。

我自己会使用 Constraints 属性。

干杯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-03-27T08:12:30.660

将边框样式设置为 bstoolwindow。窗口将只有一个关闭按钮和标题栏。

# css - 使用元素内的图像名称 - XML/CSS

> ID：481041
> 
> 赞同：2
> 
> 时间：2009-01-26T19:37:38.450
> 
> 标签：css, xml, image

我正在为 XML 文档制作 CSS 文件。我需要插入一个图像 - 其文件名包含在一个元素中。

这是我所指的 xml 代码的一部分：

```
<description>
   <text> Club Praia is divided and linked by a foot bridge over the main street which runs 
   through the heart of Praia Da Rocha.</text>
   <image>pria.jpg</image>
</description> 
```

通常，我会使用 text:after{ content: url(filename.jpg) }，如果每次使用的是同一张图像，这将起作用。相反，我需要将保存在图像元素标签中的特定图像名称（在此示例中为 pria.jpg）插入到生成的内容代码中。

有没有办法我可以做到这一点？（希望我的解释有道理！！）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T22:59:22.847

这可能使用[CSS3 命名的 strings](http://www.w3.org/TR/2003/WD-css3-content-20030514/#strings)是可能的。然而，这个规范甚至还没有完成一半，所以我建议您使用 XSLT。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T19:47:36.277

您绝对可以使用 XSLT 做到这一点，但如果有纯 CSS 解决方案，我也很乐意看到它。

# c# - 如何正确加载条件 Linq-to-SQL 存储过程的 DataContext

> ID：481050
> 
> 赞同：0
> 
> 时间：2009-01-26T19:39:20.380
> 
> 标签：c#, .net, sql, linq-to-sql

我有一个对参数进行验证的存储过程

前任。

```
IF @SearchType = 'BNa'
BEGIN
    ... DO something
END
ELSE IF @SearchType = 'SNa'
BEGIN
    ... DO something
END 
```

因此，默认情况下，存储过程返回一个标量值，如果 SearchType = 有效，它将返回一个 IMultipleValues。

问题是，当我将存储过程放在 DataContext 设计器中时，它会为仅返回标量 int 的函数创建 LINQ-to-SQL。它不理解Strored Proc 可以返回带有标量值和DataSet 的IMultipleResults。

任何人都知道如何制作 LINQ-to-SQL 来推断可能的返回值？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-29T01:01:08.310

我无法直接回答您的问题，但您是否尝试过使用 SQL Profiler 来确定设计器如何为您的存储过程检索元数据？

我认为在您的情况下，设计师可能无法为您解决问题。无论哪种方式，SQL Profiler 都会让您确定这一点...

我在使用 SqlMetal（而不是设计器）方面获得了非常积极的体验。为了节省您在 Google 上搜索文档的时间，请访问[http://msdn.microsoft.com/en-us/library/bb386987.aspx](http://msdn.microsoft.com/en-us/library/bb386987.aspx)。

您可以使用 SqlMetal 的方法之一是：

1.  运行 SqlMetal 将数据库元数据提取到 DBML 文件。
2.  对 DBML 文件运行一些自定义处理（这很容易做到，因为它只是 XML）。
3.  再次运行 SqlMetal 以将更新的 DBML 转换为代码。

使用这种方法，您可以更正用于存储过程的元数据（假设无法正确确定）。

对我来说，这种方法的成功之处在于，您可以在需要时修改数据库，并轻松地重新生成匹配的强类型代码，同时仍保留对生成内容的高度控制。

# sql - 更新声明

> ID：481058
> 
> 赞同：1
> 
> 时间：2009-01-26T19:41:11.843
> 
> 标签：sql, sql-server-2000, query-help

我是一名初级 SQL 用户（未受过正式培训；仅限 OJT），需要一些简单的更新语句帮助。我想写一个更新语句，允许我列出 ID。下面显示的语句是我目前的编写方式。理想情况下，该声明将允许我将其写为“植物单元在 (49-57) 中的位置。有没有办法做到这一点？感谢您提供的任何帮助。

更新plantfunctiontable set decommissioned=1 where plantunitid in (49,50,51,52,53,54,55,56,57)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T19:43:58.640

这能行吗？

```
update plantfunctiontable set decommissioned=1 where plantunitid  between 49 and 57 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T19:45:21.100

您可以使用

```
Where plantunitid >= 49 AND plantunitid <= 57 
```

或者

```
Where plantunitid BETWEEN 49 and 57 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T19:45:17.780

那应该按原样工作。

或者你可以这样做。

```
Update planfunctiontable set decommissioned = 1 where plantunitid between 49 and 57 
```

假设您的范围将始终是连续的 (1,2,3....7,8,9)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T19:46:46.183

只有当它是顺序的，你才能使用它。

```
UPDATE plantfunctiontable
   SET decommissioned = 1
 WHERE plantunitid BETWEEN 49 AND 57 
```

如果不是顺序的，您的原始查询可以正常工作

```
UPDATE plantfunctiontable
   SET decommissioned = 1
 WHERE plantunitid IN (49, 50, 51, 52, 53, 54, 55, 56, 57) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T19:46:15.233

尝试

```
Update plantfunctiontable
SET decommissioned = 1
WHERE plantunitid >= @startID
AND plantunitid <= @endID 
```

其中@startID 和@endID 是您的语句参数。希望有帮助

# c# - 在 WPF 中哪里可以找到免费的蒙版文本框？

> ID：481059
> 
> 赞同：18
> 
> 时间：2009-01-26T19:41:20.877
> 
> 标签：c#, .net, wpf, wpf-controls

你知道在文本框中使用掩码（正则表达式）的任何免费可用的 WPF 组件吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-26T19:51:23.837

我想你会在这个控件库中找到你需要的东西：http: [//www.codeplex.com/WPFDeveloperTools](http://www.codeplex.com/WPFDeveloperTools)

在所有其他有用的控件中寻找“FilteredTextBox”。我不认为它确实是正则表达式，但它应该能够过滤您需要的所有内容，并且由于您将拥有源代码，因此您应该会发现它很容易增强。

作为奖励，它在 CodePlex 上是免费和开源的。

您还可以在此处找到一篇关于如何自己实现此功能的不错的博客文章：http: [//marlongrech.wordpress.com/2007/10/28/masked-textbox/](http://marlongrech.wordpress.com/2007/10/28/masked-textbox/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-06-16T17:26:39.973

[Extended WPF Toolkit](https://github.com/xceedsoftware/wpftoolkit)有一个[MaskedTextBox](https://github.com/xceedsoftware/wpftoolkit/wiki/MaskedTextBox)，类似于 WinForms 中的那个。与旧版本一样，它实际上并不支持 RegExes，但有一部分有用的掩码。

哦，它在[NuGet](https://www.nuget.org/packages/Extended.Wpf.Toolkit)上，这很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-22T12:34:27.813

[Coding Monk](http://www.codingmonk.com/archive/2009/08/14/the-textboxeditmask-behavior.aspx)有一个很好的 TextboxEditMask Behavior。您可以下载源代码或仅使用 dll。

# c# - 从 C# 中的代码访问 $(SolutionDir) 和 $(DevEnvDir) 等预构建宏的简单方法是什么？

> ID：481063
> 
> 赞同：4
> 
> 时间：2009-01-26T19:44:10.027
> 
> 标签：c#, visual-studio, prebuild

现在我正在考虑在预构建事件中写入文件的路径，然后在代码中从该文件中读取，但我想知道是否有更简单更优雅的方式。

[编辑：这是帮助一步构建所有项目+安装程序（.NET + WiX）](https://stackoverflow.com/questions/480748/help-with-one-step-build-all-projects-installer-net-wix)的后续行动，因为我并没有真正得到答案，看看我是否能得到一个更简单问题的答案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T08:56:12.130

这是一个肮脏的技巧：将它们转储到文件中。

1.  将操作添加到预构建事件以将解决方案的路径输出到文件：

    `echo $(SolutionDir) > SolutionDirFile.txt`

2.  阅读`SolutionDirFile.txt`C# 代码中的文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T09:19:02.363

这只是一个猜测，但我认为您可以在编译时将此信息放入文件中的一种方法是使用 PostSharp 之类的东西。基本上，获取某种预处理器来为您获取数据，然后简单地将其嵌入到您的程序集中。

# java - 何时在 Java 中使用 Enum 或 Collection

> ID：481068
> 
> 赞同：24
> 
> 时间：2009-01-26T19:45:30.743
> 
> 标签：java, enums, set

在什么情况下，枚举比保证唯一元素的 Collection 更合适（我猜是 java.util.Set 的实现者......）？

[（这是我之前问题](https://stackoverflow.com/questions/478403/can-i-add-and-remove-elements-of-enumeration-at-runtime-in-java)的一种跟进）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-26T19:47:45.933

基本上，当它是一组在编译时已知的定义明确的固定值时。

您可以非常轻松地将枚举用作集合（使用[EnumSet](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/EnumSet.html)），它允许您定义行为、按名称引用元素、打开它们等。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T19:48:33.530

当元素预先知道并且不会改变时，枚举是合适的。

如果元素可以在运行时更改，请使用 Set。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T19:48:28.117

我不是java专家，但我的猜测是当你想保证某个值池时使用枚举，当你想保证唯一性时使用集合。示例是枚举一周中的几天（不能有“funday”）并收集 SSN（我知道的通用示例！）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T20:03:08.350

很好的回应——我会试着总结一下，如果只是为了我自己的参考——看起来你应该在两种情况下使用枚举：

您需要的所有值在编译时都是已知的，以及以下一项或两项：

*   您想要比通常的集合实现更好的性能
*   您希望将潜在值限制为编译时指定的值

通过 Jon 提供的 Collection over enumeration 链接，您可以将枚举性能和安全性作为实现细节获得好处，而无需将其合并到您的整体设计中。

社区维基，如果您愿意，请进行编辑和改进！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T22:06:50.083

注意：您可以同时使用 EnumSet。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T21:23:46.877

在某些情况下，您的业务需要创建新项目，但同时需要基于一些固定项目的业务逻辑。对于你想要一个枚举的固定的，新的显然需要某种集合/数据库。

我已经看到项目使用此类项目的集合，从而导致业务逻辑取决于用户可以删除的数据。永远不要这样做，而是根据需要为固定的枚举创建一个单独的枚举，并为其他枚举创建一个集合。

另一种解决方案是使用具有不可变对象的集合来获取固定值。这些项目也可以驻留在数据库中，但有一个额外的标志，因此用户无法更新/删除它。

# eclipse - eclipse键绑定设置

> ID：481073
> 
> 赞同：40
> 
> 时间：2009-01-26T19:46:39.570
> 
> 标签：eclipse, settings

eclipse 在哪里保留它的键绑定设置？我想将它们从一个系统转移到另一个系统。如果有一个很好的工具，但如果没有，我愿意复制文件（实际上，两个系统上的所有设置都应该相同。）

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-01-26T20:04:33.090

将所有 Eclipse 首选项导出到文件。

```
File->Export->General->Preferences 
```

Import 可以选择仅从该文件中导入关键设置。

```
File->Import->General->Preferences 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2010-05-11T09:48:54.737

键首选项下的“导出 CSV”按钮可能会让您认为存在导入。当然没有。嘎嘎。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-26T20:04:12.500

导出：文件 -> 导出 -> 常规 -> 首选项 -> 键首选项

导入：文件 -> 导入 -> 常规 -> 首选项 -> 选择文件

# jquery - 如何在jQuery中选择两个标签之间的所有内容

> ID：481076
> 
> 赞同：60
> 
> 时间：2009-01-26T19:47:16.043
> 
> 标签：jquery, css-selectors, traversal

我有一个带有标题和无序列表的文档。

如何使用 JQuery 选择给定的标题（通过其唯一的类名）以及该标题和下一个标题之间的所有内容？

### 更新：

你的建议很棒，但不是我想要的。例如，在下面的代码中，我只想访问 id 为“heading2”的“h1”以及所有内容，但不包括 id 为“heading3”的“h1”。

上面提供的 jQuery 示例将访问第一个不是“h”标签的“h”标签之后的所有内容。

...或者，如果我错了，请纠正我:)

```
 <h1 id="heading1">...</h1>
        <ul>...</ul>
        <p>...</p>
        <ul>...</ul>
        <p>...</p>
    <h1 id="heading2" >...</h1>
        <ul>...</ul>
        <p>...</p>
        <ul>...</ul>
        <p>...</p>
    <h1 id="heading3" >...</h1>
        <ul>...</ul>
        <p>...</p>
        <ul>...</ul>
        <p>...</p> 
```

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-26T21:50:26.607

解决这个问题有两种特别有用的方法：[`.nextUntil`](http://api.jquery.com/nextUntil/)和[`.andSelf`](http://api.jquery.com/andSelf/)。第一个将抓取您的选择器之后的所有兄弟姐妹，而后者也将包含与您的选择器匹配的任何内容，为您提供一个包含所有兄弟的 jQuery 对象：

```
$("#heading2")
    .nextUntil("#heading3").andSelf()
        .css("background", "red"); 
```

这导致以下结果：

![在此处输入图像描述](https://i.stack.imgur.com/VIXFo.png)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-11-18T07:41:40.533

这是我用于我的项目的解决方案：

**jQuery 选择器**

```
(function ($) {
    $.fn.between = function (elm0, elm1) {
        var index0 = $(this).index(elm0);
        var index1 = $(this).index(elm1);

        if (index0 <= index1)
            return this.slice(index0, index1 + 1);
        else
            return this.slice(index1, index0 + 1);
    }
})(jQuery); 
```

**用法**

```
$('body').between($('#someid'), $('#someid2')).each(function () {
    // Do what you want.
}); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-05T17:30:19.200

```
$('#secondSelector').prevAll('#firstSelector ~ *') 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T00:03:42.577

是啊，你说得对。这只会避免所需的选择器。也许它需要更详细：

```
$(firstSelector).nextAll().not(secondSelector).not($(secondSelector).nextAll()).text() 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-10-27T14:14:31.870

我觉得自从 jQuery 1.8 及更高版本发布以来，接受的答案似乎需要一些更新。`.andSelf()`已被弃用。取而代之的是`.addBack()`. 该[文档](http://api.jquery.com/addBack/)解释了您需要了解的所有内容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T20:22:08.423

也许，与

```
$(selectorForFirstHeading).nextAll().not(selectorForLastHeading).text() 
```

我为什么要使用`text()`？因为`html()`只会返回第一个结果元素的内部[HTML](http://en.wikipedia.org/wiki/HTML)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T20:30:15.567

如果您的元素处于同一级别，则如下所示：

```
<h1 id="heading1">...</h1>
<ul>...</ul>
<p>...</p>
<ul>...</ul>
<p>...</p>
<h1 id="heading2" >...</h1> 
```

也就是说，您的下一个标题元素不是与第一个标题元素处于同一级别的元素的子元素。你可以试试这段代码：

```
// This will get all the following siblings of <h1 id="heading1"> except those that are headings themselves
var elements = $('#heading1').nextAll().not("h1"); 
```

# stored-procedures - 存储过程名称标记

> ID：481080
> 
> 赞同：0
> 
> 时间：2009-01-26T19:48:23.077
> 
> 标签：stored-procedures, naming-conventions

有没有想过维基百科的数据库模式是什么样的？我最近从[reddit](http://www.reddit.com/r/programming/comments/7r3mg/ever_wonder_what_the_wikipedia_database_schema/)阅读了这个帖子。

我喜欢他们的表是如何用前缀标记的，这样您就可以立即了解它的功能、用途以及与其他表的关系。

我没有注意到的一件事是他们如何命名他们的存储过程。他们甚至使用SP吗？

我使用 MS SQL Server。使用 USP_ 或 SP_ 为所有存储过程添加前缀似乎是多余且不利的，因为对象资源管理器已经为我解决了所有问题。您如何命名您的 SP？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T19:56:44.900

> 我喜欢他们的表是如何用前缀标记的，这样你就可以立即了解它的功能、用途以及与其他表的关系

这就是为什么您在 SQL Server 中有架构，您创建一个架构来将多个对象组合在一起，然后您可以让 HR 人员访问 HR 架构

> 使用 USP_ 或 SP_ 为所有存储过程添加前缀似乎是多余且不利的，因为对象资源管理器已经为我解决了所有问题。您如何命名您的 SP？

永远不应该使用 SP_，因为你会受到性能影响，每当 SQL 服务器“看到”一个以 sp_ 开头的 proc 时，它会首先检查主数据库，最糟糕的是，如果 MS 决定以你的名字发送一个 proc 并启动它使用 sp_ 你的永远不会被执行

顺便说一句，不是每个人都在使用项目资源管理器，有些人喜欢在 T-SQL 中这样做

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T19:55:23.063

我个人会在我的存储过程前面加上一个唯一的名称来描述它的作用。例如。

SelectUserAccountById

或者

插入用户帐户

通常在名称中引用表名，在上面的示例中，该表将是 UserAccount。

我不会在我的存储过程前面加上 SP 或任何类似的东西，除非我正在构建一个进入 DotNetNuke 等框架的扩展，然后我为我的公司名称使用前缀。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-02T19:15:23.430

我发现将存储的过程命名为 TableName_Action 很有用

例如 RefClient_Insert、RefClient_Search、RefEmployee_Delete

这样，由于表格被分组（在这种情况下，Ref = Reference），SP 也被分组。

请注意，我使用 _ 只是为了清楚起见，如果您愿意，可以跳过它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-03T03:47:13.550

我开始使用***小部件类型***前缀命名所有 SQL 对象。例如...

```
**Photo Gallery Database Objects** (abbreviated list)
Old Name          | New Name
-------------------------------------------------
tblCategories     | tblPGCategories
tblItems          | tblPGItems
spGetCategories   | spPGGetCategories
spUpdateCategory  | spPGUpdateCategory
spGetItems        | spPGGetItems
spUpdateItem      | spPGUpdateItems
```

```
**Event Calendar Database Objects** (abbreviated list)
Old Name          | New Name
-------------------------------------------------
tblCategories     | tblECCategories
tblItems          | tblECItems
spGetCategories   | spECGetCategories
spUpdateCategory  | spECUpdateCategory
spGetItems        | spECGetItems
spUpdateItem      | spECUpdateItems
```

我们开发了很多网站，当客户想要某个功能时，我们认为可以将其出售给其他人，我们会将其创建为***小部件***。然后，我们会将这些小部件推销给其他客户。

在我们开始添加我们从其他网站开发的小部件之前，这非常有效。我们的一些代码最终使用了***重复的名称***。因此，出于必要，我们实现了一个***小部件类型***命名约定。这使得集成我们创建的所有小部件变得非常容易。

# vb.net - 将继承的泛型作为基本泛型返回

> ID：481086
> 
> 赞同：0
> 
> 时间：2009-01-26T19:48:54.340
> 
> 标签：vb.net, generics, inheritance

我有`BaseAbstractClass(of T as WebControl)`（VB 泛型），它继承了`WebControl`.

`BaseAbstractClass`由`ConcreteWrapper1`,继承`ConcreteWrapper2`，最后，稍微改变一下，`ConcreteWrapper4`。这些中的每一个都将`BaseAbstractClass`使用从`WebControl`.

我想做的是让工厂返回 a`ConcreteWrapper`作为`BaseAbstractClass(of WebControl)`. 但是，每当我尝试返回 a 的新实例时，`ConcreteWrapper`都会出现编译时转换错误。

[编辑：添加代码]

基本抽象类

```
Public MustInherit Class BaseAbstractClass(Of T As WebControl)
    Inherits WebControl

    Protected _item As T

    Protected Overrides Sub Render(ByVal writer As System.Web.UI.HtmlTextWriter)
        _item.RenderControl(writer)
    End Sub
End Class 
```

其他的 ConcreteWrapper 看起来像这样，除了不同的 CustomControl

```
Public Class ConcreteWrapper1
    Inherits BaseAbstractClass(Of CustomControlInheritedFromWebControl1)

    Public Sub New(ByVal control As CustomControlInheritedFromWebControl1)
        MyBase._item = control
    End Sub
End Class

Public Class CustomControlInheritedFromWebControl1
    Inherits WebControl

    //not the correct comment markers but the coloring works better
    //do stuff here... Implm not important.

End Class 
```

我的工厂

```
Public Class WebControlFactory

    Public Shared Function GetWebControl() As BaseAbstractClass(Of WebControl)

        Return New ConcreteWrapper1(New CustomControlInheritedFromWebControl1())

    End Function

End Class 
```

[/编辑]

我能否解释发生了什么以及为什么不起作用（可能还有解决方案）？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T19:56:59.470

`ConcreteWrapper1`不继承自`BaseAbstractClass(of WebControl)`，而是继承自`BaseAbstractClass(of T)`

BAC(of WebControl) 不能与 BAC(of T) 互换。

如果必须使用继承，则需要两个抽象级别。

```
WebControl
  BAC inherits WebControl
    BAC(of T) inherits BAC
      Wrapper1 inherits BAC(of int)
      Wrapper2 inherits BAC(of string)
      Wrapper3 inherits BAC(of Foo)
      Wrapper4 inherits BAC(of Bar) 
```

然后，您可以将 Wrappers 的所有实例作为 BAC 返回。

Zooba 说的[很好](https://stackoverflow.com/questions/6557/in-c-why-cant-a-liststring-object-be-stored-in-a-listobject-variable#7168)：

> 您不能在具有不同类型参数的泛型类型之间进行强制转换。专门的泛型类型不构成同一继承树的一部分，不相关的类型也是如此。

# asp.net - 使用 ASP.NET 成员资格提供程序限制对 WCF REST (webHttpBinding) 服务的访问？

> ID：481090
> 
> 赞同：8
> 
> 时间：2009-01-26T19:49:17.023
> 
> 标签：asp.net, wcf, web-services, rest, webhttpbinding

我在网上找到了很多关于将 ASP.NET Membership Provider 与 wsHttpBindings 一起使用的资料，但我没有看到任何关于将其与 webHttpBindings 一起使用的参考资料。

我正在寻找一个可以在两种情况下工作的系统：

1.  用户登录到一个 asp.net 网站，该网站正在调用该服务。
2.  用户通过 REST 直接访问服务。

这是否可以使用内置框架（即仅通过配置）？如果是这样，我该如何配置服务？用户如何将凭据传递给 REST 服务？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T22:48:48.127

我找到的最好的来源是：http: [//www.leastprivilege.com/FinallyUsernamesOverTransportAuthenticationInWCF.aspx](http://www.leastprivilege.com/FinallyUsernamesOverTransportAuthenticationInWCF.aspx)

该站点还有大量关于设置 HTTP 模块以处理基本身份验证的其他信息（我猜你会使用它，因为它是一种标准）。

HTTP 模块身份验证方法位于 Codeplex 上，其中包含示例代码和此处的所有内容：http: [//www.codeplex.com/CustomBasicAuth](http://www.codeplex.com/CustomBasicAuth)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T20:06:58.797

你的意思是ADO.NET 数据服务？

您可以为实体构建 QueryInterceptor 并限制对它的访问。例如：

```
 [QueryInterceptor("foo_entity")]
    public Expression<Func<foo_entity, bool>> FilterMembership()
    {
        MembershipUser user = Membership.GetUser();
        Guid userGuid = (Guid)user.ProviderUserKey;
        return c => c.UserId == userGuid;
    } 
```

# c# - 关于 RadioButton CheckedChanged 事件

> ID：481095
> 
> 赞同：0
> 
> 时间：2009-01-26T19:50:37.473
> 
> 标签：c#, asp.net, radio-button

嗨，我使用单个文本框来查询不同类型的选择，例如，当我选择第一个 RadioButton（姓氏）时，我按客户姓氏搜索，当我选择第二个 RadioButton（文档代码）时，我按代码搜索，依此类推，请我如何管理或处理异常，例如，如果用户选择“按日期搜索”并发送字符串类型？

我使用 C# 3.5 - Asp.net

我想用正则表达式制作它并将其添加到 RadioButton 事件中，因此当用户更改收音机时，他可以在 optionA 中仅键入一些字符，在 Option B 中键入更多字符，在 OptionC 中键入日期 ...（正则表达式）

提前感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T21:30:20.233

如果您使用的是 asp web 控件单选按钮列表，那么您可以在它们是回发时进行大量更改。您可以将属性设置为 SelectIndexChanged，因此无论何时更改它们都会导致回发，然后您可以从它们（验证）中执行任何操作。前任：

```
 <asp:radioButtonList
     id="radio1" runat="server" 
     autoPostBack="true"
     cellSpacing="20"
     repeatColumns="3"
     repeatDirection="horizontal"
     RepeatLayout="table"
     textAlign="right"
     OnSelectedIndexChanged="radio_SelectedIndexChanged">
     <asp:ListItem text="10pt" value="itsMe"/>  
     <asp:ListItem text="14pt" value="itsYou"/>  
     <asp:ListItem text="16pt" value="Neither"/>  
  </asp:radioButtonList> 
```

在您应该拥有的服务器上

```
protected void radio_SelectedIndexChanged(object sender, EventArgs e)
{
 //do whatever you want by calling the name of the radio id
 //example

  if(radio1.SelectedItem.Value=="(whatever you want to test)"

} 
```

# c# - C# 和 SQL Server：密码。去哪里做什么？

> ID：481098
> 
> 赞同：3
> 
> 时间：2009-01-26T19:51:39.827
> 
> 标签：c#, sql-server, encryption, passwords, hash

好的，我有一个用 C# 编写的应用程序。我们在 SQL Server 中有数据。在这些数据中，我们有用户帐户，可以访问应用程序。

我已经阅读过，我知道你应该加盐和散列，并可能散列很多次，等等。但是，我在哪里做什么呢？我向 SQL Server 发送什么以及从 SQL Server 发送什么？我到底在数据库中存储了什么？我是否在 SQL 中对其进行哈希处理？（可能有一个散列函数，就像在 mysql 中一样？）我是否在我的代码中散列并做一些花哨的事情？我是将哈希发送到服务器并进行比较，还是从服务器获取哈希并在我的应用程序中进行比较？盐呢？我在哪里做？我在哪里存储它？我如何得到它？

换句话说，有人可以给我一个很好而清晰的登录场景演练（可能还有用户添加/重置密码场景）。什么去哪里，什么应该在哪里使用，等等。

希望有人可以为我清理这些东西=）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T19:54:50.490

对于 C# + SQL Server，您可以只使用 MembershipProvider 模型，它会为您处理所有这些。

和 IMO，让所有这些事情正确的最重要的部分*不是自己做*。相反，请依赖您的平台提供的机制。*以一种看似*有效的微妙方式很容易出错。然后你进行部署，直到你被黑客入侵*之后，*你甚至都不知道有什么问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T20:00:52.380

我完全同意 Joel Coehoorn 的观点，最好的选择是相信别人经过验证的真实实施。但是，如果您决定推出自己的安全实施，那么我的建议如下：

1.  将哈希和盐存储在数据库中。
2.  在您自己的代码中生成哈希和盐。这样您就不会将自己绑定到特定的数据库。
3.  切勿以明文形式通过网络发送密码。我建议从数据库中获取哈希值和盐值，并将其与您根据希望通过身份验证的一方提供的用户名和密码计算出的值进行比较。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T19:57:47.363

如果您使用的是 ASP.NET，那么使用内置的会员功能是轻而易举的实现方式，我建议您采用这种方式。

但是，作为一个一般性问题，我会在您的本地代码中实现散列，然后只将散列值发送到数据库。对于盐，有很多方法可以做到这一点，您可以创建一个随机盐，或者您可以使用记录 id 或其他方式对值进行加盐。同样，我会在 C# 代码中执行此操作。框架中有一个有用的方法可以做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T20:35:15.540

几年前，在 Membership Provider 模型可用之前，我自己就这样做了。

我们使用 ASP.NET 内置的函数来处理密码的散列；它是 FormsAuthentication 命名空间中的静态方法 HashPasswordForStoringInConfigFile。你给它一个密码和一个加密选项，它会返回散列密码。

我们的流程是： - 从数据库中获取输入用户名的哈希密码。- 散列输入的密码。- 他们匹配吗？如果是，请继续，否则登录失败。

更改密码时，我们将哈希发送到数据库进行存储；我们没有发送未加密的密码。

而且，我相信，这就是 MembershipProvider 今天在幕后所做的。

再次重申，无论您如何进行表单身份验证，最重要的部分是通过安全 (HTTPS) 连接工作。

# django - 如何使用 Flex 访问 Django 中的外键字段？

> ID：481110
> 
> 赞同：4
> 
> 时间：2009-01-26T19:56:07.133
> 
> 标签：django, apache-flex, pyamf

我有以下 Django 和 Flex 代码：

**姜戈**

```
class Author(models.Model):
  name = models.CharField(max_length=30)

class Book(models.Model):
  title = models.CharField(max_length=30)
  author = models.ForeignKeyField(Author) 
```

**柔性**

```
package com.myproject.models.vo
{
    [Bindable]
    [RemoteClass(alias="myproject.models.Book")]

    public class BookVO
    {
        public var id:int;
        public var title:String;
        public var author: AuthorVO;
    }
} 
```

正如您在此示例中所见，Author 是我的 Book 模型中的外键。现在，当我在 Flex 中调用 BookVO 时，我想访问作者的姓名。因此，我希望像下面这样的代码可以工作，但是“author_name”会导致 null：

```
var book = new BookVO();
var author_name = book.author.name; 
```

我意识到我可以直接调用 AuthorVO，但这个问题的关键是，当您的 VO 绑定到远程对象时，如何使用 Flex 检索外键值？我目前正在使用 PyAMF 来弥补 Flex 和 Django 之间的差距，但我不确定这是否相关。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T12:31:10.947

好的，这是一个例子......

模型：

```
class Logger(models.Model):
    lname = models.CharField(max_length=80)

    def __unicode__(self):
        return self.lname
    #
#

class DataSource(models.Model):
    dsname = models.CharField(max_length=80)
    def __unicode__(self):
        return self.dsname
    #
#

class LoggedEvent(models.Model):
    # who's data is this?
    who = models.ForeignKey(Logger)
    # what source?
    source = models.ForeignKey(DataSource)
    # the day (and, for some events also the time)
    when = models.DateTimeField()
    # the textual description of the event, often the raw data
    what = models.CharField(max_length=200)
    # from -1.0 to 1.0 this is the relative
    # importance of the event
    weight = models.FloatField()

    def __unicode__(self):
        return u"%2.2f %s:%s - %s" % (self.weight, self.source, self.who, self.what)
    #
# 
```

这是我的 amfgateway.py

```
def fetch_events(request, source):
    events = LoggedEvent.objects.select_related().all()
    return events
#

services = {
    'recall.fetch_events': fetch_events,
}

gateway = DjangoGateway(services) 
```

这是我的 AMF 调用接收方的 Actionscript：

```
protected function onRetrievedEvents(result: Object): void {

    for each(var evt: Object in result) {
        var who: Object = evt._who_cache.lname;

... 
```

evt._who_cache.lname 使用 select_related() 填充，并且在缺少选择相关时丢失。如果我摆脱了 select_related() 调用，那么我会看到错误：

```
TypeError: Error #1010: A term is undefined and has no properties. 
```

您必须尝试使用​​ RemoteClass 使用不同的技术...所以 select_related 可能根本不是问题...（否则我的第一个答案不会被否定。）其余的取决于您。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T20:25:12.300

当您从数据库中获取您的书时，请尝试使用 select_related()

这是此页面上的方式：http:
[//docs.djangoproject.com/en/dev/ref/models/querysets/](http://docs.djangoproject.com/en/dev/ref/models/querysets/)

它，“将自动“遵循”外键关系，在执行查询时选择额外的相关对象数据。这是一种性能提升器，会导致（有时很多）更大的查询，但意味着以后使用外键关系会获胜不需要数据库查询。”

我一直喜欢通过 Flex 的 PyAMF 无缝访问数据库。真是太棒了。

# c++ - 为什么 STL 在 find 上映射核心转储？

> ID：481119
> 
> 赞同：4
> 
> 时间：2009-01-26T19:58:32.260
> 
> 标签：c++, gcc, map

所以，我有这种情况，我需要查看一个对象是否在我的 stl 映射中。如果不是，我将添加它。

```
char symbolName[] = { 'H', 'e', 'l', 'l', 'o', '\0' };
map<string,TheObject> theMap;
if (theMap.find(symbolName)==theMap.end()) {
            TheObject theObject(symbolName);
            theMap.insert(pair<string, TheObject>(symbolName,
                    theObject));
} 
```

当对象不在地图中时，我在以下位置获得核心转储：theMap.find。假设，如果项目不在地图中，它应该返回一个等效于 map::end 的迭代器

这里发生了什么？

海合会：3.4.6

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T20:14:50.620

为什么不这样做呢？

```
char symbolName[] = "hello";
theMap.insert(pair<string, TheObject>(symbolName, TheObject(symbolName))); 
```

如果您的地图是 a `map<string, TheObject>`，那么如果您尝试搜索 NULL，您将获得核心转储：

```
// This will core dump:
char *symbolName = NULL; // Oops!
theMap.find(symbolName); // Kabang! 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T20:52:44.490

它可能由于多种原因而崩溃。在不知道至少`TheObject`的构造函数的定义的情况下，我认为我们在很大程度上只能猜测这个问题。到目前为止，您的代码看起来不错，但可以简化：

```
char symbolName[] = "Hello";
map<string,TheObject> theMap;
theMap.insert(make_pair(symbolName, TheObject(symbolName))); 
```

如果符号已经被映射，它不会做任何事情，丢弃新的 TheObject 对象。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T20:09:56.030

在执行 find() 之前检查您的 STL 映射是否为 empty()。在空的 STL 映射上执行 find() 时，一些 STL 实现存在错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T20:16:09.853

顺便说一句，有两种可能的简化。

首先，使用`make_pair`而不是使用`pair`构造函数。这意味着您不必明确指定类型参数：

```
theMap.insert(make_pair(symbolName, theObject)); 
```

其次，您可以简单地编写代码，而不是您的代码：

```
theMap[symbolName] = theObject; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T20:37:45.940

发布您的真实代码，或者至少是展示您所描述行为的完整示例。有时，当您尝试调试只是为了在这样的论坛上发布而编写的虚构代码时，问题会在翻译中丢失。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T20:09:01.350

这段代码应该可以正常工作。

唯一可能的问题是在 TheObject 实现内部，但它不应该影响 find 调用。

此外，可能是一些不相关的问题，例如由于之前执行的某些代码导致的[缓冲区溢出。](http://en.wikipedia.org/wiki/Buffer_overflow)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-26T22:10:45.690

作为代码简化的补充：

使用 std::string 而不是 char[] 并在 TheObject 的类定义中使用它。

不确定您的 TheObject 类正在使用 char 数组做什么，但如果您在此函数范围之外使用地图，例如。通过将其用作返回值，我敢打赌在某处有一个对象指向 symbolName 的地址，该地址不再被定义。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T20:56:23.157

我不知道你为什么会得到核心转储；该代码对我有用。

有机会使您的代码更简单、更具可读性：

*   正如其他人指出的那样，您可以将插入简化为`theMap[symbolName] = TheObject(symbolName)`

*   我可能错了，但据我所知 { 'a', 'b', '\0' } 与 "abc" 相同，因此您可以简化为`char symbolName[] = "Hello";`我认为非惯用定义令人困惑这里有些人。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-06T21:06:19.980

检查您是否在构造函数中使用它。在构造函数中使用 map 时我遇到了类似的问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-06T21:20:00.180

我通过使用指向我的地图对象的指针来解决我的问题。由于在构造函数中使用，它们需要是指针，然后在构造函数中我对它们进行了新的操作。

# .net - 多个 LinqToSQL 查询和性能

> ID：481122
> 
> 赞同：1
> 
> 时间：2009-01-26T19:59:30.900
> 
> 标签：.net, sql, linq, linq-to-sql

这样的事情会严重影响性能吗？

```
var myQuery = from c in Customers select c;

var filter1 = from c in myQuery where c.ID > 2 select c;

myQuery = filter1;

var filter2 = from c in myQuery where c.Name.Contains("r") select c;

myQuery = filter2; 
```

当我这样做时，它似乎只在最后进行实际查询，而不是在每个“var ...”上。到那时为止的一切似乎都只是构造一个查询，所以看起来这没问题，并且与将所有过滤器放在 1 个查询中没有太大的性能差异。我错了吗，它实际上对数据库运行多个查询？

我正在尝试找到一种基于用户输入创建查询的好方法，以便他们可以根据不同的条件进行过滤。只要这样做不会花费大量时间，我就不太担心性能。

我还发现了有关 Dynamic Linq 库的帖子，但使用它似乎很笨拙，我认为这样做与这样做没有太大区别。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T20:02:41.380

不，在您开始实际询问结果之前，它不会执行任何查询。以这种方式构建查询很好，也是 LINQ 的优点之一。

顺便说一下，它在 LINQ to Objects 中的工作方式相同（就延迟执行而言 - 实际管道非常不同），只要您使用惰性查询运算符（基本上所有返回`IEnumerable<T>`or的运算符`IOrderedEnumerable<T>`）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T20:04:19.410

我会考虑使用扩展方法来动态构造查询。我认为它会做你需要做的事情。而且，是的，在执行需要结果的操作之前不会实际评估查询，因此将它们组合起来不一定会导致额外的数据库访问。

```
var query = db.Customers;
if (selectID.HasValue)
{
   query = query.Where( c => c.ID > selectID.Value );
}
if (!string.IsNullOrEmpty( nameFilter ))
{
   query = query.Where( c => c.Name.Contains( nameFilter ) );
}

foreach (var customer in query) // now the query is performed
{
 ...
} 
```

# css - IE 不自动调整绝对定位元素的宽度

> ID：481125
> 
> 赞同：0
> 
> 时间：2009-01-26T19:59:35.393
> 
> 标签：css, internet-explorer, positioning, absolute, autosize

当我在其中的任何元素的样式中指定 a`height`时，IE 使整个事物的宽度为 100%，而不是使其宽度保持“自动调整大小”。

其他浏览器显示它很好，但不是 IE。我该如何解决？

```
<div style="position:absolute;top:50px;left:50px;background:green;">
 <div>
  <div>test</div>
  <div style="height: 20px;">this makes it 100% width in IE.  why?</div>
 </div>
</div> 
```

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T20:05:21.187

这里有一些可能对你有用的东西。这有点 hacky，但是如果您想为某些文本找到合适的宽度，这是我所知道的除了 javascript 之外的唯一方法。我们基本上是通过不允许线条中断来强制宽度。如果需要换行，可以输入`<br/>`s。

```
<div style="position:absolute;top:50px;left:50px;background:green;width:0px">
 <div>
  <div>test</div>
  <div style="height:50px; white-space:nowrap">This is normally sized in IE6</div>
 </div>
</div> 
```

再三考虑，不要查看链接。它很旧，不像宣传的那样工作。

老答案：

[http://snippets.dzone.com/posts/show/216](http://snippets.dzone.com/posts/show/216)

我相信非绝对定位的 DIV 会自动扩展以水平填充其容器。由于您没有为此 div 指定任何容器大小，因此它会展开以填满整个页面。

我觉得 Firefox 不扩展 div 很奇怪……我不确定他们中的哪一个实际上“正确”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T15:27:13.213

猜测一下，我会说这与 IE6 中的 hasLayout 错误有关。我的建议： 1\. 给包含的 div（具有绝对定位的那个）设置宽度。2\. 发布一个你想要达到的目标的例子。我们也许可以建议一种对所有浏览器都更友好的方式来做你想做的事。

# asp.net-mvc - 维护文档管理系统应该朝着什么方向发展？

> ID：481134
> 
> 赞同：1
> 
> 时间：2009-01-26T20:04:16.040
> 
> 标签：asp.net-mvc, svn, version-control

我们在 ASP.NET MVC 之上构建了一个应用程序。我们现在需要允许我们的用户在线管理他们的文档。作为该系统的一部分，用户希望上传文档并与其组织的其他成员共享。

我们有一个现有的 Web 应用程序需要此功能作为增值。我们正在努力找出满足这种需求的选择。我们最终正在寻找一种后端解决方案，该解决方案将帮助我们完成与版本控制相关的大量繁重工作。仍然需要通过我们的域模型和 Web 用户界面来维护对文档的访问。

我们需要能够...

*   上传文件
*   查看每个文档的版本历史
*   执行全文搜索
*   计算文件大小

我们正在考虑：

*   构建我们自己的领域模型，并将文档存储在数据库中
*   与 subversion 集成以将其用作我们的后端。

哪种方法对您有用？每种方法的优点和缺点是什么？还有其他选择吗？

我们选择的解决方案需要遵守以下标准：

*   需要很好地适应我们的自动化部署。
*   我们需要能够在本地开发人员机器上运行应用程序，而不需要连接到单独的服务器
*   我们想要一些重量轻、易于升级和部署的东西

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T20:26:34.403

Subversion 听起来确实是最好的选择，只需培训必须管理文档的用户如何使用[TortoiseSVN](http://tortoisesvn.net/)，然后将文档存储作为项目的子目录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T01:16:15.737

我们选择构建自己的域模型，并将文档存储在 SQL Server 2008 数据库中。到目前为止，这对我们来说效果很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T20:13:08.923

您是否看过基本上是您所描述的 Sharepoint？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T20:14:30.887

为什么不直接对可能满足您需求的众多客户端之一使用 subversion 呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T22:09:21.530

如果您自己构建它并使用 C# 和 SVN，那么[sharpSVN](http://sharpsvn.open.collab.net/)看起来是一个很好的解决方案。通过完全访问 SVN 客户端 API，您应该能够愉快地将 Web 应用程序集成到 SVN 后端。通过 SVN 属性或其他一些元数据存储来加强安全性。

我可以看到的一些问题是：

*   您认为，如果您有多个站点，则可能很难让不同的 SVN 存储库在必须同步时发挥出色（如果必须）。
*   SVN 不只是存储二进制 blob，因此它只会对对象进行版本控制，而不能为您提供它们的差异。这可能会导致一个非常大的 SVN 数据库。
*   目前也无法从存储库中清除文件，这也会导致大型 SVN 存储库。
*   如果不同的人可以修改文档，并期望它们成为文档的不同“分支”，那么使用分布式源代码控制模型可能会更好，这样事情会更容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T17:38:32.010

尽管在服务器上重用 Subversion 之类的东西会很好，但它确实使应用程序的推出更加复杂。如果您对此感到满意，那么 sharpSVN（由 Andrew Cox 建议）似乎很合适。

如果您不太担心 Subversion 的某些版本控制方面（差异和分支），那么我很想将一个快速文档管理模块组合到您现有的应用程序中。

我会使用[Lucene](http://lucene.apache.org/)来处理棘手的事情——索引和全文搜索。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T17:42:19.803

如果我是你，我会调查 Sharepoint，或者至少是 Sharepoint Portal 服务。这正是解决方案解决的场景

# .net - GridView 中的 Linq to SQL 对象子属性

> ID：481136
> 
> 赞同：1
> 
> 时间：2009-01-26T20:04:19.970
> 
> 标签：.net, sql, linq, wcf, linq-to-sql

例如，在我的 WCF 中，如果我有一个 Customer 表和一个 Order 表，它们在 Customer ID 上相互关联。

我想获取每个客户的订单数。

在常规的 VB 代码中，我可以这样做：

```
Dim CustID As Integer = 1234
Dim cust As New MyService.Customer()
cust = cust.GetCustomer(CustID)
Response.Write(cust.Orders.Count) 
```

上面的代码工作正常，但是如果我想从 GridView 中访问相同的代码，它似乎不会以相同的方式做出反应（虽然，来自不同的方法，但我对每种方法应用了相同的 pricipals）

```
<asp:ObjectDataSource ID="odsCustomers" runat="server" SelectMethod="GetCustomers" TypeName="MyService.Customer" />

<asp:GridView ...>
...
<Columns>
    <asp:BoundField DataField="Orders.Count" HeaderText="Order Count" />
</Columns>
...
</asp:GridView> 
```

那么我怎么能做这样的事情呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T20:31:54.253

您可以尝试向 Customer 类添加一个名为 OrderCount 的部分方法，并在您的 BoundField 中引用它。右键单击您的 dbml 文件并转到查看代码然后添加。

VB

```
Partial Public Class Customer

    Public ReadOnly Property OrderCount As Integer
        Get
            Return Me.Orders.Count
        End Get
    End Property

End Class 
```

C＃

```
public partial class Customer
{

    public int OrderCount {
        get { return this.Orders.Count; }
    }
} 
```

# c# - Access DB - 操作必须使用可更新查询

> ID：481138
> 
> 赞同：2
> 
> 时间：2009-01-26T20:04:36.040
> 
> 标签：c#, ms-access, permissions

我有一个使用 VS2005、C#、.NET 2.0 构建的网站。该网站针对 Access 数据库进行交易。它在开发中运行良好。mdb 文件位于 App_Data

我已经在这台机器上设置了 IIS 来测试网站的部署。我将该站点发布到我的 IIS 虚拟目录。一切顺利。

每当我尝试更新、插入或删除时，都会收到上述错误“操作必须使用可更新查询”。

我已将以下权限应用于 App_data 文件夹：

```
machinename/IUSR - modify
machinename/ASPNET - modify
NETWORK SERVICE - modify
domainname/myaccount - full 
```

我什至发疯了，并给了组 EVERYONE 完全权限，但这也不起作用。

在我的网络配置中，我有以下行：

```
<identity impersonate="true"/> 
```

此行用于模拟我的登录帐户以提供对应用程序的访问。

我仍然无法执行插入、更新或删除查询。有任何想法吗？

**更新：**

感谢您的回复。我读过那篇文章。我还阅读了谷歌搜索结果的前 4 页，它们都谈到了对 DB 文件夹的权限。我遵循了所有建议，但没有结果。

1.  我的权限设置为 MS 文章所述。
2.  数据库正在以正确的模式打开，否则在测试时它将无法工作。
3.  我没有使用 ODBC，所以就这样了。
4.  我没有使用 SQL 服务器，所以也没有。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T20:10:36.793

用户（模拟用户或 asp 用户）必须具有在目录中创建文件的权限，因为 Access 会创建一个 .ldb 文件。

[MS 知识库](http://support.microsoft.com/?scid=kb%3Ben-us%3B175168&x=10&y=8)中描述了其他可能的原因

**更新：** 您是否检查了有效权限？由于明确的否认，也许继承在这里发挥了作用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T20:19:23.153

感谢您的回复。我读过那篇文章。我还阅读了谷歌搜索结果的前 4 页，它们都谈到了对 DB 文件夹的权限。我遵循了所有建议，但没有结果。

1.  我的权限设置为 MS 文章所述。
2.  数据库正在以正确的模式打开，否则在测试时它将无法工作。
3.  我没有使用 ODBC，所以就这样了。
4.  我没有使用 SQL 服务器，所以也没有。

# asp.net - 如何将多个参数传递给 Eval()？

> ID：481142
> 
> 赞同：13
> 
> 时间：2009-01-26T20:07:05.737
> 
> 标签：asp.net

我有一些使用 Eval 生成对 javascript 函数的调用的 aspx 代码：

**ASP.NET（为便于阅读而包装）：**

```
<asp:LinkButton runat="server"
   OnClientClick='<%# Eval(
         "NodeGUID", 
         "return DoStuff(this, \"{0}\");") %>'
   Text="Do stuff" /> 
```

这会生成类似于以下内容的 javascript：

**Javascript（为便于阅读而包装）：**

```
return DoStuff(this,
      "3F2504E0-4F89-11D3-9A0C-0305E82C3301"
   ); 
```

**注意：** *我已经转换了生成的**“”** 实体引用到引号中以提高可读性。*

我现在需要向 javascript 函数调用添加第三个参数，即标题：

**Javascript（为便于阅读而包装）**

```
return DoStuff(this,
      "3F2504E0-4F89-11D3-9A0C-0305E82C3301",
      "AllisonAngel.jpg"
   ); 
```

**注意：** *我已经转换了生成的**“”** 实体引用到引号中以提高可读性。*

* * *

代码隐藏文件中已经存在一个函数，用于返回项目的标题：

**C#（为了便于阅读，省略了代码）：**

```
protected string GetItemText(MySomething item)
{
   ...
} 
```

我知道可以使用类似于以下的语法从 aspx 文件中调用上述函数：

**ASP.NET（为便于阅读，已包装，省略代码）：**

```
<asp:LinkButton ... runat="server"
   Text="<%# GetItemText((MySomething)Container.DataItem) %>" 
   ... /> 
```

所以现在我想使用这个函数将第三个参数包含到 javascript 函数中。

从...开始：

```
<asp:LinkButton runat="server"
   OnClientClick='<%# Eval(
         "NodeGUID",
         "return DoStuff(this, \"{0}\", \"Todo - Insert caption here\");") %>'
   Text="Do stuff" /> 
```

我需要改变：“ `Todo - Insert caption here`”

调用：`<%# GetItemText((MySomething)Container.DataItem) %>`

盲目地尝试显而易见的事情：

**ASP.NET（为便于阅读而包装）：**

```
<asp:LinkButton runat="server"
   OnClientClick='<%# Eval(
         "NodeGUID", 
         GetItemText((MySomething)Container.DataItem),
         "return DoStuff(this, \"{0}\", \"{1}\");") %>'
   Text="Do stuff" /> 
```

但这抱怨，因为 Eval() 只接受两个参数。

* * *

我尝试了稍微不那么明显的：

**ASP.NET（为便于阅读而包装）**

```
<asp:LinkButton runat="server"
   OnClientClick='<%# Eval(
         "NodeGUID", 
         "return DoStuff(this, 
               \"{0}\", 
               \""+GetItemText((MySomething)Container.DataItem)+"\");") %>'
   Text="Do stuff" /> 
```

但这也行不通。

* * *

**相关问题**

[ASP.NET：如何从 javascript 访问转发器生成的元素？](https://stackoverflow.com/questions/474584/asp-net-how-to-access-repeater-generated-elements-from-javascript)

[asp.NET：如何访问中继器生成的元素？](https://stackoverflow.com/questions/480195/asp-net-how-to-access-repeater-generated-elements)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-19T19:29:38.223

诀窍不是将多个项目传递给一个 eval，而是将多个 eval 传递给任何你想用来格式化数据的东西。你也可以这样做——这会使演示文稿像你想要的那样保存在 aspx 文件中......

```
<asp:LinkButton 
   runat="server" 
   OnClientClick='<%# string.Format(
          "return DoStuff(this, \"{0}\", \"{1}\");", 
          Eval("NodeGUID"), 
          GetItemText((MySomething)Container.DataItem)) %>' 
   Text="Do stuff" /> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-23T10:19:42.820

我的把戏

> eval("FLName", Eval("FLFDID","{0}")+"/{0}")

评估内评估

它对我有用！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T21:01:32.757

[Robert C. Barth](https://stackoverflow.com/questions/481142/asp-net-how-to-pass-multiple-parameters-to-eval#481199)给了我解决问题的想法：

```
<asp:LinkButton runat="server"
      OnClientClick="<%# GetItemClientClick((MySomething)Container.DataItem) %>" 
      Text="Do stuff" /> 
```

然后代码隐藏文件包含：

```
protected string GetItemClientClick(MySomething item)
{
   ...

   String szOnClientClick =
      "return DeleteItem(this, "+
            Toolkit.QuotedStr(item.NodeGUID.ToString()) + ", "+
            Toolkit.QuotedStr(GetItemText(item))+");";

   return szOnClientClick;
} 
```

我真的更愿意将演示文稿保留在 aspx 中，并将业务逻辑保留在代码隐藏中 - 但现实世界通常不符合该模型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T20:25:57.400

如果 LinkBut​​ton 不在其他东西（如网格）内，只需像往常一样使用 string.Format 在代码隐藏中设置 OnClientClick 属性。

如果它位于网格中（或中继器，或类似性质的东西），请使用 FindControl 或 e.Row.Cells[] 和 string.Format 在 RowDataBound 事件中设置它。如果您使用 e.Row.Cells[]，您可能会转储 LinkBut​​ton 服务器控件并只输出一个正常的锚标记。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-09T10:51:47.210

你可以试试这个

```
'<'asp:HyperLink ID="hp" runat="server" CommandArgument='<%# Eval("SysID", "{0}")%>' 
            NavigateUrl='<%#  String.Format("~/ReportViewer.aspx?RevID= {0} 
          & User={1}", Eval("ID"),  Eval("USER")) %>' Target="_blank"  %>'>
</asp:HyperLink> 
```

[http://afzal-gujrat.blogspot.com/2012/10/pass-more-evals-in-querystring-with.html](http://afzal-gujrat.blogspot.com/2012/10/pass-more-evals-in-querystring-with.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-26T14:33:39.237

继续 Scott Ivey 的解决方案，您还可以使用它在 Eval 语句中包含 if 语句：

例如，如果属性*Url*存在，则以下将输出锚标记，否则将输出跨度。

```
<%# string.Format(Eval("Url") != null ? "<a href=\"{0}\">{1}</a>" : "<span>{1}</span>", Eval("Url"), Eval("Text")) %>"> 
```

# algorithm - 测试点是否在圆内的方程

> ID：481144
> 
> 赞同：359
> 
> 时间：2009-01-26T20:07:26.487
> 
> 标签：algorithm, language-agnostic, geometry

如果你有一个 center`(center_x, center_y)`和 radius的圆`radius`，你如何测试一个给定的坐标点`(x, y)`是否在圆内？

* * *

## 回答 #1

> 赞同：562
> 
> 时间：2009-01-26T20:09:56.793

一般来说，`x`且`y`必须满足`(x - center_x)² + (y - center_y)² < radius²`。

请注意，满足上述等式的点`<`被`==`认为是圆*上*的点，满足上述等式的点`<`被`>`认为是圆*外*的点。

* * *

## 回答 #2

> 赞同：153
> 
> 时间：2011-08-29T07:00:05.033

在数学上，毕达哥拉斯可能是许多人已经提到的简单方法。

```
(x-center_x)^2 + (y - center_y)^2 < radius^2 
```

在计算上，有更快的方法。定义：

```
dx = abs(x-center_x)
dy = abs(y-center_y)
R = radius 
```

**如果一个点更有可能*在*这个圆**之外，那么想象一个围绕它绘制的正方形，它的边与这个圆相切：

```
if dx>R then 
    return false.
if dy>R then 
    return false. 
```

现在想象在这个圆圈内绘制一个方形菱形，使其顶点接触这个圆圈：

```
if dx + dy <= R then 
    return true. 
```

现在我们已经覆盖了大部分空间，只有这个圆圈的一小部分留在我们的正方形和菱形之间进行测试。在这里，我们回到上面的毕达哥拉斯。

```
if dx^2 + dy^2 <= R^2 then 
    return true
else 
    return false. 
```

**如果一个点更有可能*在*这个圆圈**内，则将前 3 个步骤的顺序颠倒：

```
if dx + dy <= R then 
    return true.
if dx > R then 
    return false.
if dy > R 
    then return false.
if dx^2 + dy^2 <= R^2 then 
    return true
else
    return false. 
```

* * *

替代方法想象这个圆圈内有一个正方形而不是菱形，但这需要稍微更多的测试和计算，而没有计算优势（内部正方形和菱形具有相同的面积）：

```
k = R/sqrt(2)
if dx <= k and dy <= k then 
    return true. 
```

更新：

对于那些对性能感兴趣的人，我在 c 中实现了这个方法，并用 -O3 编译。

我通过以下方式获得了执行时间`time ./a.out`

我实现了这个方法，一个普通的方法和一个虚拟的方法来确定时间开销。

`Normal: 21.3s This: 19.1s Overhead: 16.5s`

因此，似乎这种方法在此实现中更有效。

```
// compile gcc -O3 <filename>.c
// run: time ./a.out

#include <stdio.h>
#include <stdlib.h>

#define TRUE  (0==0)
#define FALSE (0==1)

#define ABS(x) (((x)<0)?(0-(x)):(x))

int xo, yo, R;

int inline inCircle( int x, int y ){  // 19.1, 19.1, 19.1
  int dx = ABS(x-xo);
  if (    dx >  R ) return FALSE;
  int dy = ABS(y-yo);
  if (    dy >  R ) return FALSE;
  if ( dx+dy <= R ) return TRUE;
  return ( dx*dx + dy*dy <= R*R );
}

int inline inCircleN( int x, int y ){  // 21.3, 21.1, 21.5
  int dx = ABS(x-xo);
  int dy = ABS(y-yo);
  return ( dx*dx + dy*dy <= R*R );
}

int inline dummy( int x, int y ){  // 16.6, 16.5, 16.4
  int dx = ABS(x-xo);
  int dy = ABS(y-yo);
  return FALSE;
}

#define N 1000000000

int main(){
  int x, y;
  xo = rand()%1000; yo = rand()%1000; R = 1;
  int n = 0;
  int c;
  for (c=0; c<N; c++){
    x = rand()%1000; y = rand()%1000;
//    if ( inCircle(x,y)  ){
    if ( inCircleN(x,y) ){
//    if ( dummy(x,y) ){
      n++;
    }
  }
  printf( "%d of %d inside circle\n", n, N);
} 
```

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2009-01-26T20:10:33.860

您可以使用毕达哥拉斯来测量您的点与中心之间的距离，看看它是否低于半径：

```
def in_circle(center_x, center_y, radius, x, y):
    dist = math.sqrt((center_x - x) ** 2 + (center_y - y) ** 2)
    return dist <= radius 
```

**编辑**（给保罗的帽子小费）

在实践中，平方通常比取平方根便宜得多，而且由于我们只对排序感兴趣，我们当然可以放弃取平方根：

```
def in_circle(center_x, center_y, radius, x, y):
    square_dist = (center_x - x) ** 2 + (center_y - y) ** 2
    return square_dist <= radius ** 2 
```

此外，Jason 指出`<=`应该替换为`<`并根据使用情况，这实际上可能是有意义的~~尽管我相信这在严格的数学意义上是不正确的~~. *我站得更正了。*

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2011-06-10T20:01:06.513

```
boolean isInRectangle(double centerX, double centerY, double radius, 
    double x, double y)
{
        return x >= centerX - radius && x <= centerX + radius && 
            y >= centerY - radius && y <= centerY + radius;
}    

//test if coordinate (x, y) is within a radius from coordinate (center_x, center_y)
public boolean isPointInCircle(double centerX, double centerY, 
    double radius, double x, double y)
{
    if(isInRectangle(centerX, centerY, radius, x, y))
    {
        double dx = centerX - x;
        double dy = centerY - y;
        dx *= dx;
        dy *= dy;
        double distanceSquared = dx + dy;
        double radiusSquared = radius * radius;
        return distanceSquared <= radiusSquared;
    }
    return false;
} 
```

这更有效，更易读。它避免了昂贵的平方根运算。我还添加了一个检查以确定该点是否在圆的边界矩形内。

矩形检查是不必要的，除非有很多点或很多圆。如果大多数点都在圆圈内，那么边界矩形检查实际上会使事情变慢！

与往常一样，请务必考虑您的用例。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-01-26T20:10:54.450

您应该检查从圆心到点的距离是否小于半径

使用 Python

```
if (x-center_x)**2 + (y-center_y)**2 <= radius**2:
    # inside circle 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2016-07-06T07:31:04.250

求圆心与给定点之间的距离。如果它们之间的距离小于半径，则该点在圆内。如果它们之间的距离等于圆的半径，则该点位于圆的圆周上。如果距离大于半径，则该点在圆外。

```
int d = r^2 - ((center_x-x)^2 + (center_y-y)^2);

if(d>0)
  print("inside");
else if(d==0)
  print("on the circumference");
else
  print("outside"); 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-01-26T20:10:10.473

计算距离

```
D = Math.Sqrt(Math.Pow(center_x - x, 2) + Math.Pow(center_y - y, 2))
return D <= radius 
```

那是在 C# 中...转换为在 python 中使用...

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-01-28T14:45:08.320

如上所述 - 使用欧几里得距离。

```
from math import hypot

def in_radius(c_x, c_y, r, x, y):
    return math.hypot(c_x-x, c_y-y) <= r 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2019-06-28T18:08:12.070

下面的等式是一个表达式，用于测试一个点是否在给定的圆内，其中*xP*和*yP*是该点的坐标，*xC*和*yC*是圆心的坐标，*R*是该给定圆的半径。

[![在此处输入图像描述](https://i.stack.imgur.com/piA4I.png)](https://i.stack.imgur.com/piA4I.png)

如果上述表达式为真，则该点在圆内。

以下是 C# 中的示例实现：

```
 public static bool IsWithinCircle(PointF pC, Point pP, Single fRadius){
        return Distance(pC, pP) <= fRadius;
    }

    public static Single Distance(PointF p1, PointF p2){
        Single dX = p1.X - p2.X;
        Single dY = p1.Y - p2.Y;
        Single multi = dX * dX + dY * dY;
        Single dist = (Single)Math.Round((Single)Math.Sqrt(multi), 3);

        return (Single)dist;
    } 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-06-09T14:35:55.720

*这与[Jason Punyon 提到的](https://stackoverflow.com/a/481151/4170242)解决方案相同，但它包含一个伪代码示例和更多细节。我在写完这篇文章后看到了他的回答，但我不想删除我的。*

我认为最容易理解的方法是首先计算圆心到点之间的距离。我会使用这个公式：

```
d = sqrt((circle_x - x)^2 + (circle_y - y)^2) 
```

然后，只需将该公式的结果，即距离 ( `d`) 与 进行比较`radius`。如果距离 ( `d`) 小于或等于半径 ( `r`)，则该点在圆内（如果`d`和`r`相等，则在圆的边缘上）。

这是一个可以轻松转换为任何编程语言的伪代码示例：

```
function is_in_circle(circle_x, circle_y, r, x, y)
{
    d = sqrt((circle_x - x)^2 + (circle_y - y)^2);
    return d <= r;
} 
```

其中`circle_x`和`circle_y`是圆的中心坐标， 是圆`r`的半径，`x`和`y`是点的坐标。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-01-21T21:21:54.573

我在 C# 中的回答是完整的剪切和粘贴（未优化）解决方案：

```
public static bool PointIsWithinCircle(double circleRadius, double circleCenterPointX, double circleCenterPointY, double pointToCheckX, double pointToCheckY)
{
    return (Math.Pow(pointToCheckX - circleCenterPointX, 2) + Math.Pow(pointToCheckY - circleCenterPointY, 2)) < (Math.Pow(circleRadius, 2));
} 
```

用法：

```
if (!PointIsWithinCircle(3, 3, 3, .5, .5)) { } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-09-15T12:52:01.793

如前所述，要显示该点是否在圆圈中，我们可以使用以下命令

```
if ((x-center_x)^2 + (y - center_y)^2 < radius^2) {
    in.circle <- "True"
} else {
    in.circle <- "False"
} 
```

为了以图形方式表示它，我们可以使用：

```
plot(x, y, asp = 1, xlim = c(-1, 1), ylim = c(-1, 1), col = ifelse((x-center_x)^2 + (y - center_y)^2 < radius^2,'green','red'))
draw.circle(0, 0, 1, nv = 1000, border = NULL, col = NA, lty = 1, lwd = 1) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-11-14T23:37:36.860

我为像我这样的初学者使用了下面的代码:)。

公共课 incirkel {

```
public static void main(String[] args) {
    int x; 
    int y; 
    int middelx; 
    int middely; 
    int straal; {

// Adjust the coordinates of x and y 
x = -1;
y = -2;

// Adjust the coordinates of the circle
middelx = 9; 
middely = 9;
straal =  10;

{
    //When x,y is within the circle the message below will be printed
    if ((((middelx - x) * (middelx - x)) 
                    + ((middely - y) * (middely - y))) 
                    < (straal * straal)) {
                        System.out.println("coordinaten x,y vallen binnen cirkel");
    //When x,y is NOT within the circle the error message below will be printed
    } else {
        System.err.println("x,y coordinaten vallen helaas buiten de cirkel");
    } 
}

    }
}} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-11-16T03:11:06.600

如果您想检查 3D 点是否在 Unit Sphere 中，则进入 3D 世界，您最终会做类似的事情。在 2D 中工作所需要的只是使用 2D 矢量运算。

```
 public static bool Intersects(Vector3 point, Vector3 center, float radius)
    {
        Vector3 displacementToCenter = point - center;

        float radiusSqr = radius * radius;

        bool intersects = displacementToCenter.magnitude < radiusSqr;

        return intersects;
    } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-11-17T16:26:23.610

这是解决这个问题的简单java代码：

及其背后的数学：[https ://math.stackexchange.com/questions/198764/how-to-know-if-a-point-is-inside-a-circle](https://math.stackexchange.com/questions/198764/how-to-know-if-a-point-is-inside-a-circle)

```
boolean insideCircle(int[] point, int[] center, int radius) {
    return (float)Math.sqrt((int)Math.pow(point[0]-center[0],2)+(int)Math.pow(point[1]-center[1],2)) <= radius;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-12-16T14:47:36.713

**PHP**

```
if ((($x - $center_x) ** 2 + ($y - $center_y) ** 2) <=  $radius **2) {
    return true; // Inside
} else {
    return false; // Outside
} 
```

# security - 只有当某人拥有加密狗时，如何才能使网站可以访问？

> ID：481148
> 
> 赞同：13
> 
> 时间：2009-01-26T20:09:37.653
> 
> 标签：security, authentication, dongle, challenge-response

假设您想在 SSL 加密的登录名/密码之上添加额外的凭据层，但您不想增加用户的复杂性。有没有办法将拥有加密狗的要求添加到具有现有跨平台浏览器功能的 Web 服务器身份验证方案中？

换句话说，要访问该网站，您需要一个用户名、密码和一个已插入客户端计算机的 USB 加密狗。加密狗可能会进行某种挑战/响应。

如果这个加密狗解决方案可以自动与 Firefox 一起使用，或者只需添加一个插件，那就太理想了。

想法和建议表示赞赏。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-26T20:17:00.943

您可能对[Yubikey](http://www.yubico.com/products/yubikey/)感兴趣。

它是一个小型 USB 加密狗，用作 USB 键盘（即不需要特殊的驱动程序或客户端软件），专为这种身份验证而设计。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-26T20:13:35.537

您可以使用[RSA SecurID](http://www.rsa.com/node.aspx?id=1156)令牌，这是小的钥匙串显示，每分钟更改一次显示的数字。除了要求用户名和密码外，您还可以要求他们输入他们在令牌上看到的数字，以验证他们是否拥有硬件设备。有各种硬件加密狗，有些甚至需要输入 PIN 码才能看到变化的数字。在服务器端是额外的复杂性，但客户端没有太多麻烦。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T07:14:39.900

我也使用过 Yubikey，效果很好。另一个类似的解决方案是[Swekey](http://www.swekey.com/) - 您可能也想检查一下。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-06-15T12:09:02.860

我在使用 Dinkey Dongles 和[DinkeyWeb](http://www.microcosm.co.uk/websiteprotection.php)系统实现网站身份验证和登录方面取得了不错的成绩。

用户将 USB 安全加密狗插入他们的机器，访问您的“受保护”网页，并在加载页面之前验证加密狗。无需特殊权限或特权即可工作。

希望能帮助到你。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T20:17:41.473

这将需要有权访问加密狗的东西。还有破解它的问题——通信无法隐藏，所以你必须确保它无关紧要。这意味着加密狗将不得不实现它自己的 crpyto。您还需要支持您要支持的任何系统。

我看到这变得非常复杂非常快。

# c# - 当数据未与报表一起保存并导出为 PDF 时出现 ParameterFieldCurrentValueException

> ID：481157
> 
> 赞同：2
> 
> 时间：2009-01-26T20:10:57.557
> 
> 标签：c#, crystal-reports, parameters

我有一个使用 Crystal Reports 2008 创建的报表。该报表使用超过 40 个参数来控制报表的布局。所有参数都是布尔值，在保存的报告中默认为 False。**报告与未选中**报告选项的保存数据一起保存，因为我想从数据库而不是报告中读取结果。

但是，当我将报告导出为 PDF 时，我会收到 ParameterFieldCurrentValueException。当数据与报告一起保存时，我没有收到此错误。

我已经验证了报告中的所有五个表都使用以下代码连接到它们的数据源。

```
foreach (Table table in reportDoc.Database.Tables)
{
   bool isConnected = table.TestConnectivity();
   Console.WriteLine(table.Name + " connected? " + isConnected.ToString());
} 
```

当数据未与报表一起保存并将其导出到磁盘时，可能导致 ParameterFieldCurrentValueException 的原因是什么？

这是可以重现此问题的最简单的代码。

```
string report =  "list_report.rpt";
string pdf = "list_report.pdf";

ReportDocument reportDoc = new ReportDocument();
reportDoc.Load(report);

// Setting parameters (or not) does not have an effect on the error
// All parameters have defaults
// reportDoc.SetParameterValue("hideRegion", false);

reportDoc.ExportToDisk(CrystalDecisions.Shared.ExportFormatType.PortableDocFormat, pdf); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T13:16:00.310

当您选择了 Save Data with Report 时，报告不会尝试访问数据库。这是一个保存数据的静态报告。这就是为什么与您尝试在未保存数据的情况下传递参数时相比，此报告不会出错的原因。

该错误表明您在运行时传递的一个或多个参数值与报告的预期不匹配。在您的代码中，您直接导出为 PDF。由于您没有查看报告，因此引擎没有机会提示缺失值。

您可以构建一个简单的 Windows 应用程序来加载您的报表并将其传递给 Crystal Report Viewer 控件。首先不要在没有保存数据的情况下将任何参数传递给报告。应提示您输入所有参数。在参数提示表单中手动添加。这行得通吗？它应该。现在开始一次添加一个参数代码。参数提示表单应该只提示缺少的参数。在某些时候，您会再次遇到错误，这应该有助于缩小问题的范围。

真挚地，

丹·凯莱赫

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T01:37:08.363

这个答案不是我的，它是水晶报表论坛上的一位绅士。该帖子可以在[SAP 论坛](https://www.sdn.sap.com/irj/scn/thread?forumID=313&threadID=1211544)上找到 答案是：

> 当您选择了 Save Data with Report 时，报告不会尝试访问数据库。这是一个保存数据的静态报告。这就是为什么与您尝试传递参数时相比，此报告不会出错的原因。
> 
> 该错误表明您传递的一个或多个参数值与报告的预期值不匹配。由于您没有查看报告，因此引擎没有机会提示缺失值。
> 
> 您可以构建一个简单的 Windows 应用程序来加载您的报告。首先不要在没有保存数据的情况下将任何参数传递给报告。应提示您输入所有参数。在参数提示表单中手动添加。这行得通吗？它应该。现在开始一次添加一个参数代码。参数提示表单应该只提示缺少的参数。在某些时候，您会再次遇到错误，这应该有助于缩小问题的范围。

然后我所做的就是将报表加载到 Crystal Report Viewer 控件中。当它加载时，它提示我输入我缺少的任何参数。我错过了导致错误的 40 多个参数列表中的一个参数。代码如下：

```
ReportDocument reportDoc = new ReportDocument();
reportDoc.Load(")list_report.rpt";
Form1.SetParameterValues(reportDoc);

this.crystalReportViewer1.ReportSource = reportDoc; 
```

如果该人用这个答案回复 Stack Overflow，我将选择他的帖子作为答案，以便适当地注明来源。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T04:40:11.567

这件事情不容易解决！

在保存之前为所有参数提供默认值怎么样？你得到同样的错误吗？如果不是，那么您将不得不尝试每一个来找到导致问题的那个。我猜你会以公式中使用的参数值结束...

PS：即使这与您的问题无关，我对在您的代码中使用 CR 关键字“公式”感到困惑。

# php - htaccess mod_deflate 在共享服务器上不起作用

> ID：481158
> 
> 赞同：1
> 
> 时间：2009-01-26T20:10:59.007
> 
> 标签：php, apache, .htaccess, gzip, mod-deflate

我正在用 PHP 开发一个网站，并且我有想要压缩的大型 JS 文件。所以，我在我的 .htaccess 文件中添加了这个：

```
 <FilesMatch "\.(js|css|html|htm|php|xml)$">
SetOutputFilter DEFLATE
</FilesMatch> 
```

它在我的本地 wamp 服务器安装上运行良好，但是一旦我在共享服务器上移动文件，DEFLATE 命令就不起作用。我不知道为什么...在网络服务器上启用了 mod_deflate，以及 bz2、gzip。我被允许使用 htaccess，我已经检查过......另外，我还有其他在 htaccess 中运行的规则和命令。所以 DEFLATE 是唯一不工作的...有谁知道为什么它在我的本地主机上工作而不是在我的网络服务器上？是否需要在我的网络服务器上启用我不知道的任何模块/扩展？

有任何想法吗 ？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T20:28:07.070

您确定 mod_deflate 已加载且可用吗？如果您将其设置为过滤器，Apache 不会抛出错误，尽管它没有被加载。

您可以使用该[`apache_get_modules`函数](http://docs.php.net/apache_get_modules)查看加载了哪些模块。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T21:07:19.143

嗯，我想你是对的..我已经用 apache_get_modules() 检查了我加载的模块并且 mod_deflate 不存在。我还检查了我的本地主机和 mod_deflate 在那里。我已经发送了一张支持的票。我希望我能完成这件事。

感谢您的帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-10T05:17:22.190

似乎很多共享托管计划都禁用了 mod_deflate，因为它占用了太多的 CPU……至少，在他们把你塞进的服务器上。

# c# - BCrypt 是在 C# 中使用的一个很好的散列算法吗？我在哪里可以找到它？

> ID：481160
> 
> 赞同：134
> 
> 时间：2009-01-26T20:11:31.300
> 
> 标签：c#, hash, bcrypt, bcrypt.net

我读过在散列密码时，许多程序员建议使用 BCrypt 算法。

我正在用 C# 编程，想知道是否有人知道 BCrypt 的良好实现？我找到[了这个页面](http://derekslager.com/blog/posts/2007/10/bcrypt-dotnet-strong-password-hashing-for-dotnet-and-mono.ashx)，但我真的不知道它是否是假的。

选择密码哈希方案时应该注意什么？BCrypt 是一个“好的”实现吗？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2010-12-14T04:32:17.450

首先，一些重要的术语：

**[散列](http://en.wikipedia.org/wiki/Cryptographic_hash_function)**- 获取字符串并生成无法恢复为原始字符串的字符序列的行为。

**[对称加密](http://en.wikipedia.org/wiki/Symmetric-key_algorithm)**- （通常简称为“加密”） - 获取字符串并生成**可以** 通过使用加密它的相同加密密钥解密为原始字符串的字符序列的行为。

**[Rainbow Table](http://en.wikipedia.org/wiki/Rainbow_table)** - 一个查找表，其中包含在特定散列算法中散列的所有字符变体。

**[Salt](http://en.wikipedia.org/wiki/Salt_%28cryptography%29)** - 在散列之前附加到原始字符串的已知随机字符串。

对于 .NET Framework，Bcrypt 还没有*经过验证*的参考实现。这很重要，因为无法知道现有实现中是否存在严重缺陷。您可以[在此处获得 BCrypt for .NET](http://bcrypt.codeplex.com/)的实现。我对密码学知之甚少，无法说出它是一个好还是坏的实现。密码学是一个非常深奥的领域。 **不要试图建立自己的加密算法**。严重地。

如果您要实现自己的密码安全性（叹气），那么您需要做几件事：

1.  使用[相对安全的散列算法](http://en.wikipedia.org/wiki/Crypt_%28C%29#Blowfish-based_scheme)。
2.  在散列之前对每个密码加盐。
3.  为每个密码使用[唯一的长盐](http://en.wikipedia.org/wiki/Rainbow_table#Defense_against_rainbow_tables)，并将盐与密码一起存储。
4.  **需要强密码**。

不幸的是，即使你做了所有这些，一个坚定的黑客仍然有可能找出密码，这只会花费他很长时间。那是你的主要敌人：**时间**。

bcrypt 算法之所以[有效，是因为散列密码比 MD5 长*五个*](http://codahale.com/how-to-safely-store-a-password/)数量级；（并且仍然比 AES 或 SHA-512 长得多）。它迫使黑客花费更多时间来创建彩虹表来查找您的密码，从而大大降低您的密码被黑客入侵的可能性。

If you're salting and hashing your passwords, and each salt is different, [then a potential hacker would have to create a rainbow table for each variation of salt](http://www.codinghorror.com/blog/2007/09/rainbow-hash-cracking.html), just to have a rainbow table for one salted+hashed password. That means if you have 1 million users, a hacker has to generate 1 million rainbow tables. If you're using the same salt for every user, then the hacker only has to generate 1 rainbow table to successfully hack your system.

If you're not salting your passwords, then all an attacker has to do is to pull up an existing Rainbow table for every implementation out there (AES, SHA-512, MD5) and just see if one matches the hash. This [has already been done](https://crackstation.net/hashing-security.htm), an attacker *does not need to calculate these Rainbow tables themselves*.

Even with all this, [you've got to be using good security practices](https://softwareengineering.stackexchange.com/questions/46716/what-technical-details-should-a-programmer-of-a-web-application-consider-before). If they can successfully use another attack vector (XSS, SQL Injection, CSRF, [et. al.](https://www.owasp.org/index.php/Category:Attack)) on your site, good password security doesn't matter. That sounds like a controversial statement, but think about it: If I can get all your user information through a SQL injection attack, or I can get your users to give me their cookies through XSS, [then it doesn't matter how good your password security is](https://www.schneier.com/essay-028.html).

Other resources:

1.  Jeff Atwood: [.NET Encryption Simplified](http://www.codeproject.com/KB/security/SimpleEncryption.aspx?fid=172899&df=90&mpp=10&noise=2&sort=Position&view=Expanded&fr=91) (great for an overview of hashing)
2.  Jeff Atwood: [I just logged in as you](http://www.codinghorror.com/blog/2009/05/i-just-logged-in-as-you-how-it-happened.html)
3.  Jeff Atwood: [You're probably storing passwords incorrectly](http://www.codinghorror.com/blog/2007/09/youre-probably-storing-passwords-incorrectly.html)
4.  Jeff Atwood: [Speed Hashing](http://www.codinghorror.com/blog/2012/04/speed-hashing.html)

**Note:** Please recommend other good resources. I've must have read a dozen articles by dozens of authors, but few write as plainly on the subject as Jeff does. Please edit in articles as you find them.

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2011-06-03T13:59:55.943

You **must not use** BCrypt in .NET. You **must use** PBKDF2 as is with the built in .NET framework implementation. It is the only freely available cryptographically verified implementation in .NET along with being the [algorithm recommended by NIST](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-132.pdf).

StackId previously used BCrypt and moved to PBKDF2 for this very reason:

> For those curious, we’re hashing passwords with PBKDF2\. Relavent code is here ( [http://code.google.com/p/stackid/source/browse/OpenIdProvider/Current.cs#1135](http://code.google.com/p/stackid/source/browse/OpenIdProvider/Current.cs#1135) ), through a few layers of indirection. In an earlier iteration, we were using BCrypt; but moved to PBKDF2 as it is built into the .NET framework, whereas BCrypt would require us to verify an implementation (no small undertaking).

[Kevin Montrose, May 27 2011](https://blog.stackoverflow.com/2011/05/stack-exchange-is-an-openid-provider/#comment-59112)

[(Updated link on GitHub)](https://github.com/StackExchange/StackID/blob/master/OpenIdProvider/Current.cs)

**Edit:** The meaning of *verified* in cryptographic terms seems to not be readily understood, a verified implementation means it's been cryptographically proven to be implemented without error. The cost of this can easily reach $20,000 or higher. I recall this when I was doing research on OpenSSL and read where they stated they haven't completed the entire verification process but if you need fully verified that they can point you down the right path for it and mentioned costs associated. Certain government requirements include mandates for verified encryption algorithms.

The bcrypt implementations in .NET have not been verified. Using an unverified encryption implementation you can't be absolutely certain that there is not either intentional malicious faults in it such as allowing a backdoor into what is encrypted or unintentional implementation faults that result in cryptographically insecure data.

**2014 edit:** For anyone that questioned the imperativeness of using verified cryptopgraphical algorithims look at the devastation that was wrought by the [heartbleed hack](http://en.wikipedia.org/wiki/Heartbleed) exploited in OpenSSL. That is the cost of using an unverified implementation. It's secure.... until you find out that any person can just read the entire memory contents of your server.

> The author of the change which introduced Heartbleed, Robin Seggelmann, stated that he "missed validating a variable containing a length" and denied any intention to submit a flawed implementation. Following Heartbleed's disclosure, Seggelmann suggested focusing on the second aspect, stating that OpenSSL is not reviewed by enough people.

This is the definition of an unverified implementation. Even the smallest defect can result in crippling the entire security.

**2015 edit:** Removed recommendation based language and replaced with absolutes. Embedded original Kevin Montrose comment for posterity.

# unit-testing - ssis 包中的单元测试数据流

> ID：481168
> 
> 赞同：6
> 
> 时间：2009-01-26T20:13:50.700
> 
> 标签：unit-testing, ssis

有没有办法在 ssis 包中对数据流进行单元测试。

例如：测试排序 - 验证排序是否正确完成。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T13:24:19.337

SSIS 有一个单元测试框架 - 请参阅[SSISUnit](http://www.codeplex.com/ssisUnit)。

这值得一看，但它可能无法解决您的问题。可以使用此框架在控制流级别对单个组件进行单元测试，但无法隔离和单独的数据流转换 - 您只能测试整个数据流组件。

您可以采取的一种方法是重新设计您的包并将您的 DataFlow 组件分解为多个可以单独测试的 DataFlow 组件。然而，这会影响你的包的性能，因为你必须在每个数据流任务之间的某个地方保存数据。

您也可以通过使用 NUnit 或类似框架采用此方法，使用 SSIS api 加载包并执行单个任务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-02-28T19:55:32.027

SSISTester 可以挖掘两个组件之间的数据流并将数据保存到文件中。可以在单元测试中访问输出。有关更多信息，请查看 ssistester.bytesoftwo.com。下面给出了如何使用 SSISTester 来实现此目的的示例：

```
[UnitTest("DEMO", "CopyCustomers.dtsx", DisableLogging=true)]
[DataTap(@"\[CopyCustomers]\[DFT Convert customer names]\[RCNT Count  customers]", @"\[CopyCustomers]\[DFT Convert customer names]\[DER Convert names to upper string]")]
[DataTap(@"\[CopyCustomers]\[DFT Convert customer names]\[DER Convert names to upper string]", @"\[CopyCustomers]\[DFT Convert customer names]\[FFD Customers converted]")]
public class CopyCustomersFileAll : BaseUnitTest
{
    ...
    protected override void Verify(VerificationContext context)
    {
        ReadOnlyCollection<DataTap> dataTaps = context.DataTaps;

        DataTap dataTap = dataTaps[0];
        foreach (DataTapSnapshot snapshot in dataTap.Snapshots)
        {
            string data = snapshot.LoadData();
        }

        DataTap dataTap1 = dataTaps[1];
        foreach (DataTapSnapshot snapshot in dataTap1.Snapshots)
        {
            string data = snapshot.LoadData();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T21:29:41.717

Short answer - not easily. Longer answer: yes, but you'll need lots of external tools to do it. One potential test would be to take a small sample of the data set, run it through your sort, and dump to an excel file. Take the same data set, copy it to an excel spreadsheet, and manually sort it. Run a binary diff tool on the result of the dump from SSIS and your hand-sorted example. If everything checks out, it's right.

OTOH, unit testing the Sort in SSIS shouldn't be necessary, unless what you're really testing is the sort criteria selection. The sort *should* have been tested by MS before it was shipped.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T23:41:58.573

当我需要查看从组件到组件移动的数据时，我喜欢使用数据查看器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T22:46:41.000

我将通过为适当的输入提供一个已知的好文件来自动化测试，该文件与外部程序进行二进制比较。

# c# - 方法链接通用列表扩展

> ID：481175
> 
> 赞同：1
> 
> 时间：2009-01-26T20:16:29.900
> 
> 标签：c#, generics, .net-2.0, findall, convertall

我有一个“复杂”类型的列表 - 一个具有一些字符串属性的对象。List 本身是另一个对象的属性，包含多种类型的对象，如下所示的简化类结构：

```
Customer {
   public List<Characteristic> Characteristics;
   .
   .
   .
}

Characteristic {
   public string CharacteristicType;
   public string CharacteristicValue;
} 
```

我希望能够为当前客户收集给定类型特征的值列表，我可以分两步完成，如下所示：

```
List<Characteristic> interestCharacteristics = customer.Characteristics.FindAll(
   delegate (Characteristic interest) {
      return interest.CharacteristicType == "Interest";
   }
);

List<string> interests = interestCharacteristics.ConvertAll<string>(
   delegate (Characteristic interest) {
      return interest.CharacteristicValue;
   }
); 
```

这很好用，但似乎还有很长的路要走。我确定我一定错过了一种更简单的方法来获取这个列表，要么将 FindAll() 和 Convert() 方法链接在一起，要么我完全忽略了其他方法。

作为背景，我在 .Net 2.0 中工作，所以我仅限于 .Net 2 泛型，并且 Characteristic 类是一个外部依赖项 - 我无法更改它的结构来简化它，还有其他方面重要的类，只是与这个问题无关。

欢迎任何指示或补充阅读。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T21:03:07.903

我会手动做一些工作。通过先执行 FindAll，然后执行 Convert，您将在集合中循环两次。似乎没有必要。如果您最终想要的只是一个 CharacteristicValue 列表，那么只需遍历您的原始集合，并将 CharacteristicValue 添加到每个符合您的条件的列表中。像这样的东西：

```
 Predicate<Characteristic> criteria = delegate (Characteristic interest) 
     {
          return interest.CharacteristicType == "Interest";
     };
     List<string> myList = new List<string>();
     foreach(Characteristic c in customer.Characteristics)
     {
        if(criteria(c))
        {
            myList.Add(c.CharacteristicValue);
        }
     } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T22:58:33.210

这是一个生成器实现

```
public static IEnumerable<string> GetInterests(Customer customer)
{
    foreach (Characteristic c in customer.Characteristics)
    {
        if (c.CharacteristicType == "Interest")
            yield return c.CharacteristicValue;
    }
} 
```

遗憾的是 3.5 扩展方法和 lambda 已根据您的要求推出，但参考这里是如何做到的：

```
customer.Characteristics
    .Where(c => c.CharacteristicType == "Interest")
    .Select(c => c. CharacteristicValue); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T20:28:13.310

为什么不创建一个`Dictionary<string, List<string>>`，这样您就可以添加“兴趣”作为键，并添加一个值列表作为值。例如：

```
Customer {
   public Dictionary<string, List<string>> Characteristics;
   .
   .
   .
}

...

Characteristics.Add("Interest", new List<string>());
Characteristics["Interest"].Add("Post questions on StackOverflow");
Characteristics["Interest"].Add("Answer questions on StackOverflow");
..

List<Characteristic> interestCharacteristics = Characteristics["Interest"]; 
```

此外，如果您愿意，您可以通过将其设置为枚举来将您的特征限制为可能值的列表，然后将其用作字典键的数据类型：

```
public enum CharacteristicType
{
   Interest,
   Job,
   ThingsYouHate
//...etc
} 
```

然后将您的字典声明为：

```
public Dictionary<CharacteristicType, List<string>> Characteristics;
..
Characteristics.Add(CharacteristicType.Interest, new List<string>());
Characteristics[CharacteristicType.Interest].Add("Post questions on StackOverflow");
Characteristics[CharacteristicType.Interest].Add("Answer questions on StackOverflow"); 
```

# windows - 在 Windows 上检索图形/声卡信息

> ID：481179
> 
> 赞同：1
> 
> 时间：2009-01-26T20:17:01.130
> 
> 标签：windows, winapi, hardware

我正在为我的应用程序开发一个错误报告工具，我想将硬件信息附加到错误报告中，以便更容易地查明某些问题。有谁知道任何 Win32 API 函数来查询操作系统以获取有关图形和声卡的信息？

谢谢，罗伯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T20:47:41.787

如果您愿意深入研究 WMI，那么以下内容应该可以帮助您入门。

```
using System;
using System.Management;

namespace WMIData
{
    class Program
    {
        static void Main(string[] args)
        {
            SelectQuery querySound = new SelectQuery("Win32_SoundDevice");
            ManagementObjectSearcher searcherSound = new ManagementObjectSearcher(querySound);
            foreach (ManagementObject sound in searcherSound.Get())
            {
                Console.WriteLine("Sound device: {0}", sound["Name"]);
            }

            SelectQuery queryVideo = new SelectQuery("Win32_VideoController");
            ManagementObjectSearcher searchVideo = new ManagementObjectSearcher(queryVideo);
            foreach (ManagementObject video in searchVideo.Get())
            {
                Console.WriteLine("Video device: {0}", video["Name"]);
            }

            Console.ReadLine();
        }
    }
} 
```

[WMI .NET 概述](http://msdn.microsoft.com/en-us/library/bb404655.aspx)

发布后注意到它没有标记为 .NET，但这也可能很有趣。[使用 C++ 创建 WMI 应用程序](http://msdn.microsoft.com/en-us/library/aa389762(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T20:43:14.200

我认为你最好的选择是 DirectSound API，记录在这里：http: [//msdn.microsoft.com/en-us/library/bb219833%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/bb219833%28VS.85%29.aspx)

具体来说，是[DirectSoundEnumerate](http://msdn.microsoft.com/en-us/library/bb219694(VS.85).aspx)调用。

# web - 网络可用性 - 背景音乐

> ID：481181
> 
> 赞同：22
> 
> 时间：2009-01-26T20:17:56.840
> 
> 标签：web, usability, background-music

我个人讨厌网站上的背景音乐。我的客户对这个问题有相反的感受。我添加了音乐，因为客户总是对的，尽管我想和他们一起重新讨论这个主题。

几乎每个人都会同意这很烦人并且浪费宝贵的带宽，但是是否有任何可用性研究或对业内受人尊敬的人的推荐可以提供反对背景音乐的有效论据？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-01-26T20:21:48.860

可用性不是唯一的问题。考虑以下场景：

1 - 有人在共享办公室工作时浏览网站，现在他们所有的同事都认为“哎呀，他在浪费时间”。

2 - 有人在有婴儿熟睡的房间里浏览网站，现在他们必须花一个小时让他/她重新入睡。

3 - 有人在听自己的音乐时浏览该网站，现在他们听到一阵刺耳的尖叫声，直到一个来源被静音。

此外，请考虑从您网站上的音乐中获得的**任何**好处将完全失去任何将扬声器静音的人。因此，您的听众可以分为：

A - 听不见音乐的人

B - 能听到但不喜欢的人

C - 能听到并**喜欢**它的人

我不想估计与这些组中的每一个相关的百分比，但请记住，您的网站积极冒犯了“B”类。从希波克拉底誓言中取一句，网页设计的一条规则应该是“不伤害”。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-01-26T20:25:47.400

**指标**。你**永远无法用****情绪化**的答案说服**商务**人士。

 **如果您**凭经验**调查情况，您将能够给他们一些无可辩驳的东西。

我会尝试一个实验：（获取谷歌分析）

*   拥有一个音乐站点，测量跳出率等
*   有一个没有音乐的相同网站，测量跳出率等

让服务器在几周内随机提供不同的页面（直到您获得重要数据），然后看看会发生什么。

也许我们错了（我也讨厌音乐）。我希望你的客户是错的，但谁知道呢。

您还可以添加一个调查链接并尝试让人们也回答这个问题（但没有可能不起作用的激励）

统计数据可以成为你的朋友:)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-26T20:30:48.623

我也会：

```
(calculate the size of the audio file(s)*the number of hits*months)/cost of GB per month 
```

然后告诉他们他们浪费了多少钱。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-26T20:26:55.137

基本上，它归结为：

*   网站上的音频是个坏主意。没有人喜欢它。
*   尝试教育您的客户这是一个坏主意。（这很烦人，不同级别的声音会导致问题，yadda yadda）提到大多数用户在使用声音时不会认真对待网站。这是一件非常 99 年的事情。
*   如果您的客户不让步，（礼貌地）提醒他/她，他们正在为您作为互联网专业人士的专业知识付费。您是网络专家，他们聘请您提供专业知识。
*   如果他们仍然不让步，请保持声音并确保他们开心。底线是让客户满意。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-27T00:00:02.727

音乐也会干扰屏幕阅读器用户。我是一个盲人电脑用户，没有什么比让音乐开始播放并淹没我试图阅读网站的语音程序更让我烦恼的了。没有什么能让我比不需要的音频更快地关闭网站。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-26T20:51:15.023

花了一点时间，但我找到了一个讨论网站可用性的网站。

他们在此页面的右侧有一个视频：

[http://www.ciaromano.com/evaluate/testing.php](http://www.ciaromano.com/evaluating/testing.php)

它说明了为什么音频广告在网站上不是一个好主意。

希望这可以帮助。

G人

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-26T20:27:20.143

这是一个艰难的过程——令人惊讶的是，目前，我有一个客户要求完全相同的事情。

就我个人而言，我不知道有任何专门针对这个主题的可用性研究，但是有很多轶事证据来自用户抱怨未经请求的背景音乐的侵入性或彻底的陈词滥调。* 也就是说，客户仍然要求它。你能做的最好的就是尝试向他们解释情况，尝试从整个网络上收集一些抱怨它的人的好例子，建立一个案例，并希望客户接受它。

就我而言，她完全同意这可能很烦人，理解它违背了用户的期望和礼貌，但无论如何都想要它。所以我正在建造它。Whaddyagonnado。

* 确实，您可能会使用此线程作为证据！祝你好运。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-26T20:32:11.443

只要确保有办法将其关闭即可。这实际上取决于网站的类型，因为多媒体网站（即电影或游戏网站）可以从中受益，但如果我正在听一些自己的音乐，我肯定想要一种方法来关闭它。

哦，拜托，没有人们在 1993 年新颖时就已经讨厌的蹩脚的 MIDI 文件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-26T23:31:02.037

考虑与客户采取不同的方式。问他们音乐的目的是什么...

如果要让网站的访问者产生一种特殊的感觉或情绪，请考虑让他们了解此处答案中提到的所有要点，并讨论这可能如何违反音乐的预期。然后，您将能够与客户讨论在不诉诸音乐的情况下向网站灌输相同“氛围”的不同方法。这实际上是一个设计问题，而不是可用性。

如果背景音乐/声音是为了传达一些信息，那么这是一个可用性问题，因为由于技术或生物学原因无法听到正确音量的声音的人会错过这一点。因此，该站点没有应有的可用性。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-26T20:54:12.053

不幸的是，作为某种服务提供商，我们所能做的就是畏缩并为客户提供他们想要的东西——当然，在记录了您在代码中和书面给客户 **的反对意见之后。**

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2012-02-13T10:12:10.013

请原谅我，但我对在网站中加载音乐有不同的看法。恕我直言，我对这个线程的答案海报表示敬意。

我看到对电子商务网站的访问就像去购物中心一样。您有购物车、各种产品、结账柜台和**背景音乐**，让您的住宿尽可能舒适和有趣。

某些慢节奏的音乐对大脑的某些部位有什么作用，有一个完整的心理原因。一些研究甚至表明，某些音乐在激励顾客购买更多商品方面发挥了作用。[检查这个网站](http://www.muzak.com/)

这绝对可以成为网站的一个加分点。当然，这取决于它是什么类型的网站。然而，缓慢而无声的音乐并不一定会扰乱人们的注意力；相反，它可能会产生相反的效果。

我的理由是，当潜在客户访问网站时，他在浏览页面时只使用了一种感官。他的眼睛！我是说为什么不让他（如果他愿意的话）使用他的听觉来鼓励他（不仅通过展示精美的文字、设计和动画看起来不错），还要吸引他的注意力通过音乐（让他与网站有更多的联系）。

显然不可能触发他的嗅觉和味觉。但为什么只限于眼睛。为什么不用耳朵呢！

无论您是否选择将音乐放入您的网站，MichaelStum 关于可以选择关闭音乐的帖子都非常重要。

当然，归根结底，这一切都与您网站的流量有关。对于这个问题，@Cbrulak 使用 Google Analytics 的想法对于不同的个人来说是一种现实的方法。

# .net - RedirectedThreadFrame in Callstack

> ID：481188
> 
> 赞同：2
> 
> 时间：2009-01-26T20:21:36.333
> 
> 标签：.net, clr, windbg

Has anyone seen a RedirectedThreadFrame in a callstack in windbg? That is from the managed callstack. I am seeing alot of exceptions being thrown inside the framework that I am never seeing bubbled to me and I am trying to figure out why. The native callstack just has:

> 0526f6b0 79f63d27 KERNEL32!RaiseException+0x53 0526f718 79f64102 mscorwks!Thread::RedirectedHandledJITCase+0x198 0526f720 00000000 mscorwks!Thread::RedirectedHandledJITCaseForGCThreadControl+0x7

The managed callstack has:

> 0526f6dc 7c812aeb [RedirectedThreadFrame: 0526f6dc] 0526f724 00c741b9 Library.Class.b__3(MyObject) 0526f7cc 00c73c85 ParallelProcessingLibrary.ActionController`1[[System.__Canon, mscorlib]].ExecutePartition(System.Object) 0526f840 79a00eee System.Threading.ThreadHelper.ThreadStart_Context(System.Object) 0526f84c 792e019f System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object) 0526f864 797db48a System.Threading.ThreadHelper.ThreadStart(System.Object) 0526fa8c 79e71b4c [GCFrame: 0526fa8c]

I have been unable to turn up any information as to what this means. Any explanations would be appreciated.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T19:20:15.097

I found the answer to this. This is occuring as the CLR suspends threads for the GC. [Junfeng Zhang's Blog Post](http://blogs.msdn.com/junfeng/archive/2007/07/16/unknown-exception-0xe0434f4e.aspx)

# javascript - 关于 JavaScript 函数非正统

> ID：481191
> 
> 赞同：5
> 
> 时间：2009-01-26T20:22:14.723
> 
> 标签：javascript, dynamic, function

我已经为 Web 编程了很长一段时间，但直到最近才发现一些关于函数使用的新复杂性以及你可以用它们做的奇怪的事情（或者我认为它们是）。然而，在这一点上，它们似乎只是语法上漂亮的东西。我希望有人能告诉我这些新发现的一些方面是如何被证明是有用的。

例如，我第一次运行它时，我认为它肯定行不通：

```
<script>
function x(q)
 {
q(x);
 }

x(function(a)
 {
alert(a);
 }
 );
</script> 
```

但它做到了！不知何故，创建一个命名函数，它接收一个不同的匿名函数作为它的唯一参数，然后运行传递给它的函数，并将它自己作为参数传递给它工作得很好。这让我大吃一惊，我几乎可以肯定它有很多实用性，但我还不能完全确定它。

啊，还有一件事我很高兴地发现：使用全局范围的变量来存储函数，稍后可以在执行中使用 JavaScript 的 eval() 函数来修改该变量，从而动态地改变函数的内部工作。一个例子：

```
<script>
var f = function()
 {
alert('old text');
 }

eval('f = ' + f.toString().replace('old text', 'new text'));

f();
</script> 
```

果然，该代码提醒了“新文本”字符串；当我看到这一点时，我的思绪再次被震撼，但也立即对创造令人难以置信的东西的潜力产生了兴趣。

所以......我对 Stack Overflow 的迫切问题：如何以任何积极的方式使用这些看似抽象的编码原则？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T20:30:32.367

您基本上要问的是*如何将函数用作一等对象？*

最大和最常见的用法是用于事件处理的闭包（或匿名函数）。然而，仅仅因为你可以聪明，并不意味着你应该。编写清晰易读的代码，就像使用任何其他语言一样。

哦，鞭打自己输入 eval 并且**永远不要再**考虑这样做

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T20:31:05.580

第一个，闭包，在 javascript 中很常见。如果您想要一些更高级的示例，这里有一个不错的交互式游乐场，您可以随意使用：[http](http://ejohn.org/apps/learn/) ://ejohn.org/apps/learn/ 。

`window.onload`当我正在处理的任何事情都不需要完整的库时，这是我使用的函数。

```
//add events to occur on page load
window.addOnload = function(fn) {
    if (window.onload) {
        var old = window.onload;
        window.onload = function() {
            old();
            fn();
        }
    } else {
        window.onload = fn;
    }
} 
```

然后，每当我需要在加载时发生某些事情时，我都可以使用匿名函数。这是我最近的一个维护项目的一个例子。

```
//make all menu items have a hover property
window.addOnload(function(){
    var cells = document.getElementsByTagName('td');

    for (var i=0; i < cells.length; i++) {
        if (cells[i].className != 'NavMenuItem')        continue;

        (function(cell){
            cell.onmouseover = function() {
                cell.className = 'NavMenuItemHighlight';
            }
            cell.onmouseout = function() {
                cell.className = 'NavMenuItem';
            }
        })(cells[i])
    }
}); 
```

至于你的第二个“发现”，就假装你从来没有发现过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T20:35:39.673

嗯，第一个通常是你如何证明停止问题是不可判定的......

你是否认为“有用”完全取决于你，我猜 B-)

# c++ - 如何检测以 10 为底的小数是否可以以 2 为底精确表示

> ID：481196
> 
> 赞同：2
> 
> 时间：2009-01-26T20:25:13.173
> 
> 标签：c++

作为数值库测试的一部分，我需要选择以 10 为基数的十进制数，它们可以以 2 为基数精确表示。如果一个以 10 为基数的十进制数可以以 2 为基数精确表示，您如何在 C++ 中检测？

我的第一个猜测如下：

```
bool canBeRepresentedInBase2(const double &pNumberInBase10)
{
    //check if a number in base 10 can be represented exactly in base 2
    //reference: http://en.wikipedia.org/wiki/Binary_numeral_system
    bool funcResult = false;

    int nbOfDoublings = 16*3;
    double doubledNumber = pNumberInBase10;
    for (int i = 0; i < nbOfDoublings ; i++)
    {
        doubledNumber = 2*doubledNumber;
        double intPart;
        double fracPart = modf(doubledNumber/2, &intPart);
        if (fracPart == 0) //number can be represented exactly in base 2
        {
            funcResult = true;
            break;
        }
    }
    return funcResult;
} 
```

我用以下值测试了这个函数：-1.0/4.0、0.0、0.1、0.2、0.205、1.0/3.0、7.0/8.0、1.0、256.0/255.0、1.02、99.005。它为 -1.0/4.0、0.0、7.0/8.0、1.0、99.005 返回 true，这是正确的。

有更好的想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T21:17:33.567

I think what you are looking for is a number which has a fractional portion which is the sum of a sequence of negative powers of 2 (aka: 1 over a power of 2). I believe this should always be able to be represented exactly in IEEE floats/doubles.

For example:

0.375 = (1/4 + 1/8) which should have an exact representation.

If you want to generate these. You could try do something like this:

```
#include <iostream>
#include <cstdlib>

int main() {
    srand(time(0));
    double value = 0.0;
    for(int i = 1; i < 256; i *= 2) {
        // doesn't matter, some random probability of including this
        // fraction in our sequence..
        if((rand() % 3) == 0) {
            value += (1.0 / static_cast<double>(i));        
        }
    }
    std::cout << value << std::endl;
} 
```

EDIT: I believe your function has a broken interface. It would be better if you had this:

```
bool canBeRepresentedExactly(int numerator, int denominator); 
```

because not all fractions have exact representations, but the moment you shove it into a double, you've chosen a representation in binary... defeating the purpose of the test.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T20:33:08.680

If you're checking to see if it's binary, it will always return true. If your method takes a `double` as the parameter, the number is already represented in binary (`double` is a binary type, usually 64 bits). Looking at your code, I think you're actually trying to see if it can be represented exactly as an integer, in which case why can't you just cast to `int`, then back to `double` and compare to the original. Any integer stored in a double that's within the range representable by an `int` should be exact, IIRC, because a 64 bit `double` has 53 bits of mantissa (and I'm assuming a 32 bit int). That means if they're equal, it's an integer.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T21:44:22.907

If you're passing in a double, then by definition, it has already been represented in binary and if not, then you've already lost accuracy.

Maybe try passing in numerator and denominator of the fraction to the function. Then you have not lost accuracy and can check to see if you can come up with a binary representation of the answer that is the same as the fraction you've passed in.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T21:08:36.457

As rmeador have pointed out, it might not be a good idea to accept the double, because the number has been converted to a double, an possible approximation to the number that you're trying to check.

So, in a very abstract way, you should split your check into integers, and decimals. Integers should not be too large such that the mantissa cannot express all the integers, (e.g. 9007199254740993 should not be represented properly by a 64-bit fp) Decimal points may be a bit easier, mentally, because if anything after the decimal point (e.g. yyy in xxx.yyy) contains a factor of anything other than 2, the floating point repeats in order to try to represent it. It's the reason why 1/3 cannot be represented with finite digits in base 10 = base (2*5)... See [Recurring Decimal](http://en.wikipedia.org/wiki/Recurring_decimal)

EDIT: As the comments pointed out, if the decimal number has a factor of anything other than 1/2, that would be the mathematically correct way to say it...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T21:38:58.923

As others have mentioned, your method doesn't do what you mean, since you pass a number represented as a (binary) double. The method actually detects, if the number you passed is in the form `integer/2^48`. This should fail for numbers like `(1+2^-50)`, which is binary, and `259/255`, which isn't.

If you really want to test a number for being exactly representable by finite binary string, you have to pass a number in an exact form.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T22:00:43.903

You asked for C++ but maybe this algorithm will help. I use "EE" to mean "exactly expressible as a float."

Start with a decimal representation of the number you want to test. Remove any trailing zeroes (that is, 0.123450000 becomes 0.12345).

1) If the number is not an integer, check to see if the rightmost digit is 5\. If it's not, then stop -- the number is not EE. 2) Multiply the number by 2\. If the result is an integer, then stop -- the number is EE. Otherwise, go back to step 1.

I don't have rigorous proof for this but a "warm fuzzy." Fire up Calculator and enter your favorite fractional power of 2, like 0.0000152587890625\. Add it to itself a few dozen times (I just hit "+" once then "=" a bunch of times). If there are any non-zero digits to the right of the decimal point, the last digit is always 5.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-26T23:40:32.017

You can't pass IN a Double because it's already lost precision. You should be able to use the toString() method of Double to check for this. (example in Java)

```
public static Boolean canBeRepresentedInBase2(String thenumber)
{
    // Reuturns true of the parsed Double did not loose precision.
    // Only works for numbers that are not converted into scientific notation by toString.
    return thenumber.equals(Double.parseDouble(thenumber).toString())
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-28T19:15:29.940

Here is the code in C# and it works. Because it works with the Decimal data - there are no inherent rounding errors that show up in the original code which uses double. (decimal in C# stores using base 10 instead of base 2 - which is what double does)

```
static bool canBeRepresentedInBase2(decimal pNumberInBase10)
{
    //check if a number in base 10 can be represented exactly in base 2
    //reference: http://en.wikipedia.org/wiki/Binary_numeral_system
    bool funcResult = false;

    int nbOfDoublings = 16*3;
    decimal doubledNumber = pNumberInBase10;
    for (int i = 0; i < nbOfDoublings ; i++)
    {
        doubledNumber = 2*doubledNumber;
        decimal intPart;
        decimal fracPart = ModF(doubledNumber/2, out intPart);
        if (fracPart == 0) //number can be represented exactly in base 2
        {
                funcResult = true;
                break;
        }
    }
    return funcResult;
}

static decimal ModF(decimal number, out decimal intPart)
{
    intPart = Math.Floor(number);
    decimal fractional = number - (intPart);
    return fractional;
} 
```

Tested with the following code (where WL does a Console.WritelLine - SnippetCompiler) WL(canBeRepresentedInBase2(-1.0M/4.0M)); //true WL(canBeRepresentedInBase2(0.0M)); //true WL(canBeRepresentedInBase2(0.1M)); //false WL(canBeRepresentedInBase2(0.2M)); //false WL(canBeRepresentedInBase2(0.205M)); //false WL(canBeRepresentedInBase2(1.0M/3.0M)); //false WL(canBeRepresentedInBase2(7.0M/8.0M)); //true WL(canBeRepresentedInBase2(1.0M)); //true WL(canBeRepresentedInBase2(256.0M/255.0M)); //false WL(canBeRepresentedInBase2(1.02M)); //false WL(canBeRepresentedInBase2(99.005M)); //false WL(canBeRepresentedInBase2(2.53M)); //false

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-26T20:38:33.083

Or even easier:

```
return pNumber == floor(pNumber); 
```

On the other hand, if you have some weird fractional representation (numerator denominator pair, or string with a decimal in it, or something), and you really do want to know if the value can be exactly represented as a double, it's a bit harder.

But you would need a different parameter(s) for that...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-26T21:10:02.693

I don't think this is what he's asking... I think he's looking for a solution that will tell him if a number can be represented EXACTLY in binary form. For example, 33.3.. That's a number cannot be represented in binary, because it will go on forever, so depending on your FPU settings, it will be represented as something like "33.333333333333336". So, it looks like his method will do the job. I don't know of a better way off the top of my head. \

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-27T00:40:48.853

Given a number r it can be represented exactly with finite precision in base 2 iff r can be written as r = m/2^n, where m, n are integers, and n >= 0.

For example 1/7 doesn't have a finite binary expression, also 1/6 and 1/10 can't be written with a finite expression in base 2.

But 1/4+1/32+1/1024, have a finite expression in base.

PS: In general you can express a number r with finite digits in a base b iff r=m/b^n where m, n are integers an n >= 0.

PPS: As almost everybody has stated previously using a double as input is a bad idea, because you are loosing precision, and you will end up with a different number.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-28T23:22:30.070

Ignoring the general criticism of using a double... For a general finite decimal, you can determine if it has a finite representation in binary with the following algorithm:

1.  Extract the fraction part of the decimal *f*.
2.  Determine *f* x 10^(*b*) = *c*, where *b* and *c* are integers.
3.  Determine 2^(*d*) >= 10^(*b*), where *d* is an integer.
4.  If *c* x 2^(*b*) / 10^(*b*) is an integer, then the decimal has a finite representation in binary. Otherwise, it doesn't.

You can generalize this to any two bases.

# tomcat - 对 index.jsp 的 DirectoryIndex 设置未按预期工作

> ID：481198
> 
> 赞同：0
> 
> 时间：2009-01-26T20:25:57.307
> 
> 标签：tomcat, apache

我在 /geo 上安装了一个 Tomcat 应用程序，该应用程序有一个“index.jsp”，可以直接访问并且可以正常工作，但是当我尝试让 apache 将其用作目录索引条目时，它永远不会出现。比这更奇怪的是，如果我从我的 httpd 配置中的 DIrectoryIndex 行中删除 index.html，“/”的访问会将一些操作重定向到主 tomcat 管理页面。

有任何想法吗？

```
JkMount /geo/* worker1
DirectoryIndex /geo/index.jsp index.html 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-28T21:02:16.133

我想你想要你`DirectoryIndex`没有`/geo/`

```
DirectoryIndex index.jsp index.html 
```

# .net - 带有 linq/lamba 表达式的空 while 循环

> ID：481211
> 
> 赞同：1
> 
> 时间：2009-01-26T20:29:50.560
> 
> 标签：.net, linq, lambda

在我工作的地方，我们仍然使用 .Net 2.0，但我对 3.0/3.5 的东西有点熟悉。我想在 C# 中使用 linq/lambda 表达式进行一些练习，所以我编写了一个简单的数独求解器，它使用了许多泛型`List<T>`和 lambda 表达式以及它提供的聚合方法。

在我的求解器中，我在求解器算法的顶部有这个：

```
private Puzzle RecursiveSolve(Puzzle p, int idx)
{
    // start with simple filter to narrow down recursive paths
    // puzzle is still solved without this line, but it takes at least 20x longer
    while( p.board.Any(cell => cell.FilterPossibles()) );  // while(); <- empty while loop is intentional 
```

正如您可能知道的那样，这是一个简单的递归算法，但我确实对其进行了一些优化以将运行时间降低到合理的水平（我在 google 上找到的最棘手的难题是 3.6 秒）。

要理解该片段，`Puzzle.board`是 a `List<Cell>`，并`Cell.FilterPossibles()`检查每个单元格的可能值与同一行、列和 3x3 框中的其他单元格的值，看它是否可以消除任何值。如果它下降到一种可能，它会设置单元格的值并返回 true。否则返回false。因此，只要板上的至少一个单元在上一次迭代中发生变化（已解决），while 循环就会运行。

我担心的是while循环是空的。它相当于一种代码气味，并告诉我我可能遗漏了一些东西。有没有办法我可以把它写成一个语句，而不是一个循环？

作为这个项目的结果，我实际上有一大堆问题：（我是否在不知不觉中实现了一些我可以告诉编译器的接口？我的函数选择通常是否合适？我有很多布尔方法来简化表达式：怎么可能那更好吗？我怎样才能更好地构建它以使用不可变的 Puzzle/Cell 对象？）但这是现在最困扰我的一个。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T20:35:44.057

一个空的while循环暗示了一个错误或副作用——在这种情况下，它听起来像是副作用，改变了电路板。

“类似 LINQ”（但不一定有效 - 它真的取决于）是使拼图产生板的迭代器 - 执行另一次迭代将返回一个*新*板（无副作用）。

我对你正在做的事情并不真正“满意”，所以它可能不合适——但这将是我的第一行询问。

除此之外，我可能会考虑以某种方式重写它，以使您*确实*有副作用更加明显-但同样，在不了解您的代码的情况下，很难确切地说出它是如何工作的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T20:41:39.180

我并不是真的反对空循环，我在 C++ 中相对经常使用它们——尽管将主体限定`{ }`为更清晰的恕我直言。

但是，我没有得到您的代码，这似乎表明确实存在代码气味，或者至少可以以更清晰的方式制定它。

我特别没有得到的是`Any`返回单个布尔值**once**的事实。这如何与循环联系在一起？这里的副作用真的不明显（你修改了`p.board`? 的内容）……似乎*太*聪明了，不知何故。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:05:50.767

我认为具有适当名称的提取方法在这里可能很有用。它不会消除气味，但您可以将其从 RecursiveSolver 的第一行移开。（我可以想象阅读它并立即撞到一堵砖墙）。

像这样有一个简洁的衬里是可以的，但是用一个命名良好的方法看起来会更好......

重命名 FilterPossibles() 可以创造奇迹……这种方法的作用远不止它所说的……

# open-source - 移植 LGPL 代码 - 我可以使用什么许可证？

> ID：481216
> 
> 赞同：10
> 
> 时间：2009-01-26T20:30:43.037
> 
> 标签：open-source, licensing

我已将一些 LGPL 代码从 Java 移植到 C#，我计划将其作为开源组件发布。我是否也必须在 LGPL 下发布我的新库，还是可以使用限制较少的东西，例如 MS-PL？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T20:40:57.527

由于您的作品基于原始 LGPL 作品，在我看来，**您的作品是原始作品的衍生作品**，因此许可证的第 2 节适用：您的代码需要是 LGPL，或者您可以选择使用 GPL。（第2版和第3版的措辞不同，但都是同一节。）但是我只是一个程序员，我知道什么？你问的是一个关于法律的问题，所以你最好的做法是**请律师**。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-26T20:34:08.257

我相信你必须使用 LGPL：

[http://en.wikipedia.org/wiki/GNU_Lesser_General_Public_License#Differences_from_the_GPL](http://en.wikipedia.org/wiki/GNU_Lesser_General_Public_License#Differences_from_the_GPL)

这取决于您的端口是否是衍生作品（通常是端口 == 衍生作品）。

# asp.net - 为什么 ASP.NET 回发的请求 cookie 属性为空或不正确？

> ID：481230
> 
> 赞同：6
> 
> 时间：2009-01-26T20:33:41.143
> 
> 标签：asp.net, cookies

我正在调试 ASP.NET Web 应用程序中的 HttpContext.Current.Request.Cookie 值，发现正确填充的唯一属性是 Value。Domain 和 Path 为 null，Expires 值设置为 DateTime.Min。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T21:02:55.687

这些值在 Request.Cookies 集合中不可用。它们仅在您“设置”值时使用。您可以使用网络跟踪来验证这一点。在请求标头中，客户端浏览器仅发送“Cookie”标头中的名称/值对。

# .net - 寻找有关创建自定义传输通道的 WCF 文档

> ID：481238
> 
> 赞同：0
> 
> 时间：2009-01-26T20:36:21.827
> 
> 标签：.net, wcf, documentation

好吧，现在看来，WCF 已经出现了一段时间，这篇很棒的文章 ( [http://winterdom.com/weblog/2007/02/14/WritingAWCFTransportChannelPart1.aspx](http://winterdom.com/weblog/2007/02/14/WritingAWCFTransportChannelPart1.aspx) ) 中引用的 WCF Channels Mini Book 由提供由于 Microsoft 停用了 netfx3.com 域，因此用户 tomasr ( [https://stackoverflow.com/users/10292/tomasr](https://stackoverflow.com/users/10292/tomasr) ) 不再可用。

有没有人有这本电子书的副本，假设它是作为 PDF 或 Word 文档发布的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T17:16:53.263

我想我在 .NET 3.5 的 MSDN 文档中找到了等价物。它位于 Windows Communication Foundation 部分的扩展 WCF 部分的扩展通道层部分：http: [//msdn.microsoft.com/en-us/library/ms731088.aspx](http://msdn.microsoft.com/en-us/library/ms731088.aspx)

# c# - 有谁知道用于 Subversion 的好的 C# API？

> ID：481247
> 
> 赞同：38
> 
> 时间：2009-01-26T20:39:26.030
> 
> 标签：c#, .net, svn, sharpsvn

我希望调用一个颠覆存储库，但我想用 C# 编写它。有谁知道任何好的图书馆？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-01-26T20:57:34.543

看看[SharpSVN](http://sharpsvn.open.collab.net/)。这是用于 .Net 2.0 应用程序的 Subversion 客户端 API 的开源绑定。

例如，此库由[AnkhSVN](http://ankhsvn.open.collab.net/) Visual Studio 插件使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T20:41:46.883

我建议您查看[Tortoise SVN 源代码](http://code.google.com/p/tortoisesvn/source/browse/)。

它主要是用 C++ 编写的，但由于都是在 VS 中完成的，所以应该很容易总结并再次使用大部分代码。

如果你想减少繁重的工作，你也可以试试[SubversionSharp （但它还不是一个稳定的版本，所以要小心）。](http://www.softec.st/en/OpenSource/ClrProjects/SubversionSharp/SubversionSharp.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T20:46:18.280

[SubversionSharp](http://www.softec.st/en/OpenSource/ClrProjects/SubversionSharp/SubversionSharp.html)怎么样。

# javascript - 从Javascript静音音频？

> ID：481252
> 
> 赞同：2
> 
> 时间：2009-01-26T20:40:45.950
> 
> 标签：javascript, audio, mute

我坐在这里想知道是否有可能编写一个greasemonkey 脚本来检测像payperclick 这样的网站并将音频静音，这样广告就不会被听到。

我意识到我可以通过简单地通过greasemonkey脚本删除广告文本以更好的方式完成同样的事情，但出于好奇的目的，我想知道您是否可以通过javascript禁用音频。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T21:59:05.823

**我**认为这是可能的唯一方法是：

1）广告有自己的“静音按钮”，它调用了一个javascript函数......在这种情况下，您可以自己调用该函数。

2) 广告用于音频的插件具有 javascript API（与 1 相同）

3) 仅限 IE：一些奇怪的 IE ActiveX 东西可能会这样做......通过访问它可能不应该的东西。

所有这些我都非常怀疑

任何其他可能性对于javascript来说都太低了（或者至少我真的希望是这样）。浏览器本身没有音量控制......所有多媒体都是由插件完成的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T22:00:49.223

除了完全剥离 <embed> 元素之外，这是不行的；JavaScript 根本没有能力访问 Flash 媒体的音量控制……但是。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T22:06:06.747

您可以尝试删除元素上的 autostart 属性`embed`或将其设置为 false。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-19T03:51:57.010

也许是答案，通过控制浏览器....可能会在某些浏览器中产生一些不兼容但不会被破解，并且只能通过用户选择来控制浏览器或键盘

# visual-c++ - 如何在组合框中获取当前选择的值（字符串）？

> ID：481255
> 
> 赞同：20
> 
> 时间：2009-01-26T20:41:15.670
> 
> 标签：visual-c++, mfc, visual-c++-6

如何在组合框中获取当前选择的值（字符串）？

（不是整数索引）

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-26T20:49:59.490

可能有更好的方法（我的 MFC 有点生疏），但似乎您应该能够调用`CComboBox::GetLBText()`，并使用`CComboBox::GetCurSel()`.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-26T21:51:56.853

一个普通的旧`GetWindowText`作品，也是。

**编辑：**正如 ajryan 指出的那样，`GetWindowText`实际上在处理程序中不起作用*，*`CBN_SELCHANGE`因为新选择已生效，但窗口文本在发送时尚未使用新选择的文本进行更新`WM_COMMAND`。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-26T20:54:28.840

使用 GetLBText，传入索引和一个 CString 对象。

编辑：太慢了！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T20:59:56.350

`CB_GETCURSEL`返回整数索引 `CB_GETLBTEXT`返回字符串在`CB_GETCURSEL`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-11-17T08:05:05.573

```
char buffer[MAX_COMBO_STRING_LENGTH];

int index= static_cast<int>(SendDlgItemMessage(hDlg, ID_COMBO_BOX, CB_GETCURSEL, 0, 0));
SendDlgItemMessage(hDlg, ID_COMBO_BOX, CB_GETLBTEXT, index, (LPARAM)(LPCTSTR)buffer);

//buffer contains the selected text unless CB_GETCURSEL returned CB_ERR (-1) to the index 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-11-17T08:09:38.140

有几种方法可以解决这个问题。

* * *

### 映射到变量

当您使用组合时，您可以将其映射到变量。

*   如果您的组合是**下拉列表**，则它映射到`int`.
*   如果您的组合是**下拉列表**，则将其映射到`CString`.

* * *

### 直接访问

正如其他人所说，当您的组合是**下拉菜单时，**您可以将其视为具有两个控件（列表和编辑）。用于`GetWindowText`访问编辑控件文本。

* * *

### 使用宏

您可以使用许多[帮助宏。](https://docs.microsoft.com/en-us/windows/win32/controls/bumper-combobox-control-reference-macros)还有一个用于获取文本（[`ComboBox_GetText`](https://docs.microsoft.com/en-us/windows/win32/api/windowsx/nf-windowsx-combobox_gettext)宏）。节省您需要将控制映射到变量。

这实际上取决于您对组合控件的需求和使用情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-02-04T15:55:15.233

```
CComboBox   m_CComboBox;
CString currentValue;

m_CComboBox.GetWindowTextA(currentValue);
cout<<"My current Value is: <<currentValue<<endl; 
```

2022年必须与MFC合作......

# debugging - 经典 ASP：附加调试器

> ID：481259
> 
> 赞同：4
> 
> 时间：2009-01-26T20:42:24.717
> 
> 标签：debugging, asp-classic

是否可以在没有 Visual interdev 或其他此类 IDE 的情况下单步执行 Classic ASP VB 代码？我目前正在使用 Notepad++ 来维护一个旧的 ASP 项目，并且能够单步执行某些类型的代码会很有帮助。

谢谢你，弗兰克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T20:56:11.567

进入经典 ASP 代码的唯一其他方法是使用内置于 IE 5.5（或 6）中的脚本调试器。您可以将它作为独立的解决方案下载，但您总是从 IE 的“工具”菜单运行它。您还必须允许在 IIS 中远程调试服务器端代码才能做到这一点。这是给你的[链接](http://www.herongyang.com/asp/script_debugger.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T21:01:16.563

调试 ASP 也适用于 Visual Studio 2005，不确定 Express 版本或其他最新版本。不要忘记在 IIS 管理控制台中为您的应用程序激活调试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T17:57:31.763

请记住，使用 VS2005 您不能使用 f5 来运行和调试。您必须附加到该过程。我附加到inetinfo.exe。由于某种原因，这不起作用，必须附加到旁边显示脚本的 dllhost.exe。

# c# - 我是否需要创建自己的 InvalidArgumentException.. 我在 c# 中找不到任何内置类型

> ID：481261
> 
> 赞同：36
> 
> 时间：2009-01-26T20:42:51.267
> 
> 标签：c#, exception

我是否需要创建自己的 InvalidArgumentException.. 我在 c# 中找不到任何内置类型...是否有任何库定义了常用的异常类.. 谢谢

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-01-26T20:45:14.943

它被称为[ArgumentException](http://msdn.microsoft.com/en-us/library/system.argumentexception.aspx)，它位于内置的 System 命名空间中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-12-12T20:15:21.917

除此之外`ArgumentException`还有`ArgumentNullException`和`ArgumentOutOfRangeException`。

简短的摘要;

*   `System.ArgumentException`- 一般例外，
*   `System.ArgumentNullException`- 意外的空值，
*   `System.ArgumentOutOfRangeException`- 意想不到的价值。

标准用法：

```
void GetEntity(string currentName)
{
  if (String.IsNullOrEmpty(currentName))
  {
    throw new ArgumentNullException(nameof(currentName));
  }

  //...
} 
```

PS。 `NotSupportedException`也派上用场（例如，当参数集将强制方法执行不受支持的场景时）。

# python - python中有没有办法将存储在列表中的正则表达式模式列表应用于单个字符串？

> ID：481266
> 
> 赞同：5
> 
> 时间：2009-01-26T20:43:24.293
> 
> 标签：python, regex, list

我有一个我想应用于字符串的正则表达式模式列表（存储在列表类型中）。

有谁知道一个好方法：

1.  将列表中的每个正则表达式模式应用于字符串和
2.  如果匹配，则调用与列表中该模式关联的不同函数。

如果可能的话，我想在 python 中执行此操作

提前致谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-26T20:49:24.513

```
import re

def func1(s):
    print s, "is a nice string"

def func2(s):
    print s, "is a bad string"

funcs = {
    r".*pat1.*": func1,
    r".*pat2.*": func2
}
s = "Some string with both pat1 and pat2"

for pat, func in funcs.items():
    if re.search(pat, s):
        func(s) 
```

上面的代码将调用字符串的两个函数，`s`因为两个模式都匹配。

# regex - 如何将双引号字符串与转义的双引号字符匹配？

> ID：481282
> 
> 赞同：35
> 
> 时间：2009-01-26T20:49:59.333
> 
> 标签：regex, perl, escaping

我需要一个 Perl 正则表达式来匹配一个字符串。我假设只有双引号字符串， \" 是文字引号字符而不是字符串的结尾，并且 \ 是文字反斜杠字符，不应转义引号字符。如果不清楚，一些例子：

```
"\""    # string is 1 character long, contains dobule quote
"\\"    # string is 1 character long, contains backslash
"\\\""  # string is 2 characters long, contains backslash and double quote
"\\\\"  # string is 2 characters long, contains two backslashes 
```

我需要一个正则表达式，它可以识别所有这 4 种可能性，以及这些可能性的所有其他简单变体，作为有效字符串。我现在拥有的是：

```
/".*[^\\]"/ 
```

但这是不对的——它不会匹配除第一个之外的任何一个。谁能给我一个正确的方向推动如何处理这个问题？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-26T22:09:36.457

`/"(?:[^\\"]|\\.)*"/`

这与 Cal 的答案几乎相同，但具有匹配包含转义码的字符串的优势，例如`\n`.

这些`?:`字符用于防止包含的表达式被保存为反向引用，但它们可以被删除。

**注意：**正如 Louis Semprini 所指出的，由于 Perl 的正则表达式引擎中内置的递归限制，这仅限于 32kb 文本（不幸的是，当被击中时会默默地返回失败，而不是大声崩溃）。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-26T20:53:24.257

这个怎么样？

```
/"([^\\"]|\\\\|\\")*"/ 
```

匹配零个或多个不是斜杠或引号或两个斜杠或一个斜杠然后是引号的字符

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-26T22:44:01.537

通用解决方案（匹配所有反斜杠字符）：

```
/ \A "               # Start of string and opening quote
  (?:                #  Start group
    [^\\"]           #   Anything but a backslash or a quote
    |                #  or
    \\.              #   Backslash and anything
  )*                 # End of group
  " \z               # Closing quote and end of string
  /xms 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-27T12:25:11.957

见[文本::平衡](http://search.cpan.org/dist/Text-Balanced/)。这比重新发明轮子要好。用于`gen_delimited_pat`查看结果模式并从中学习。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-15T05:51:27.100

[RegExp::Common](http://search.cpan.org/perldoc?Regexp::Common)是另一个需要注意的有用工具。它包含许多常见情况的正则表达式，包括带引号的字符串：

```
use Regexp::Common;

my $str = '" this is a \" quoted string"';
if ($str =~ $RE{quoted}) {
  # do something
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-01-11T13:25:02.497

这是一个非常简单的方法：

```
/"(?:\\?.)*?"/ 
```

请记住，如果您将这样的正则表达式嵌入到字符串中以使反斜杠加倍。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-18T01:02:16.217

试试这段代码： `(\".+")`

# javascript - jQuery .animate() 问题

> ID：481288
> 
> 赞同：7
> 
> 时间：2009-01-26T20:51:17.647
> 
> 标签：javascript, jquery, animation, effects

我正在尝试为无序列表的图像制作类似自动滚动/轮播的功能。

当您将鼠标悬停在包含的 div 上时，它会调用一个函数，该函数的工作是为`<ul>`

```
$(".thumbs").animate({"margin-top": (currentMargin - 10) + "px"}, function(){
     console.log("margin-top" + (currentMargin - 10) + "px");
     running=false;
     }); 
```

我在日志中看到了我想要的正确值，即动画认为它已经完成......但我的 div 没有任何变化。

有没有人知道什么可能使动画功能无法按预期工作？

谢谢

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-26T21:00:28.907

尝试使用“marginTop”而不是“margin-top”。通常，当您将 CSS 道具用作“border-something”或“margin-something”时，最好使用它的“规范化”版本，就像您在 DHTML (styles.marginTop) 中所做的那样。

# php - AJAX浏览器对发送数据长度的限制？（萨贾克斯）

> ID：481289
> 
> 赞同：0
> 
> 时间：2009-01-26T20:51:28.753
> 
> 标签：php, ajax, xmlhttprequest, cross-browser, sajax

编辑：现在问题变成了，我如何告诉 Sajax 使用 POST 而不是 GET？我尝试了一些来自谷歌的例子，但它们很粗略，正如我所说，它们没有用。我知道，我们都是 jQuery 疯子。

我使用以下代码尝试找到可以通过 ajax 调用发送到服务器的数据量的限制。显然，我们使用 Sajax。在 IE 中，大约 1900 个字符后，数据无法通过，我们得到一个错误。在 Firefox 中，限制在 6100 左右，但似乎每次调用都会有所不同。这取决于浏览器吗？

还尝试使用 POST 而不是默认的 get 并告诉 Sajax 使用 POST 根本不起作用。

在任何地方定义的 AJAX 中发送的数据流大小是否有限制？从经验来看呢？

```
<?
    require('sites/includes/Sajax.inc.php');

    function str_length_test($str){
        return strlen($str);
    } 

    sajax_init();
    sajax_export('str_length_test');
    sajax_handle_client_request();

?>
<html>
<head>
    <title>Multiplier</title>
    <script>
    <? sajax_show_javascript(); ?>

    function do_str_length_test_cb(pwd) {
        document.getElementById('str_length').value = pwd;
    }

    function do_str_length_test() {
        sample_field = document.getElementById('sample').value;
        x_str_length_test(sample_field, do_str_length_test_cb);
    }  
    </script>

</head>
<body>

    <textarea id="sample" name="sample" rows=20 cols=60 onblur="do_str_length_test(); return false;"></textarea>
    Size: <input type="text" id="str_length" name="str_length" value="" size=10>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T21:21:22.500

GET 在 IE 中被限制为 2083 个字符，请参见[http://support.microsoft.com/kb/208427](http://support.microsoft.com/kb/208427)

请参阅[此处](https://stackoverflow.com/questions/179264/what-is-the-optimum-limit-for-url-length-100-200)了解 url 长度以供讨论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T23:46:02.333

我在 sajax 示例中看到了这一点：

```
$sajax_request_type = "GET";
sajax_init();
sajax_export("add_line", "refresh");
sajax_handle_client_request(); 
```

我猜你只是将GET更改为POST。

```
$sajax_request_type = "POST"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T20:54:56.810

如果您使用 GET，则没有定义的限制。这取决于发出请求的浏览器和接收请求的服务器。

POST 通常受服务器限制 - 我认为 PHP 的默认值约为 5MB。

# c# - 设计者必须创建一个...不能的实例，因为该类型被声明为抽象

> ID：481305
> 
> 赞同：39
> 
> 时间：2009-01-26T20:56:53.377
> 
> 标签：c#, .net, winforms, abstract

Visual Studio 抱怨：**警告 1 设计者必须创建一个类型为“RentalEase.CustomBindingNavForm”的实例，但它不能，因为该类型被声明为抽象。**

Visual Studio 不允许我访问表单的设计器。该类已经实现了 CustomBindingNavForm 中的所有抽象方法。CustomBindingNavForm 提供了一些具体和抽象的功能。

有没有解决的办法？

这是课程：

```
 public abstract class CustomBindingNavForm : SingleInstanceForm {     

        //Flags for managing BindingSource
        protected bool isNew = false;
        protected bool isUpdating = false;

        /// <summary>
        /// This is so that when a new item is added, it sets isNew and firstPass to true. The Position Changed Event will look for
        /// firstPass and if it is true set it to false. Then on the next pass, it will see it's false and set isNew to false.
        /// This is needed because the Position Changed Event will fire when a new item is added.
        /// </summary>
        protected bool firstPass = false;

        protected abstract bool validateInput();
        protected abstract void saveToDatabase();

        //manipulating binding
        protected abstract void bindingSourceCancelResetCurrent();
        protected abstract void bindingSourceRemoveCurrent();
        protected abstract void bindingSourceMoveFirst();
        protected abstract void bindingSourceMoveNext();
        protected abstract void bindingSourceMoveLast();
        protected abstract void bindingSourceMovePrevious();
        protected abstract void bindingSourceAddNew();

        public void bindingNavigatorMovePreviousItem_Click(object sender, EventArgs e) {
            if (validateInput()) {
                bindingSourceMovePrevious();
            } else {
                DialogResult cont = MessageBox.Show(null, "There are errors in your data. Click Cancel to go back and fix them, or ok to continue. If you continue, changes will not be saved.", "Continue?", MessageBoxButtons.OKCancel, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2);
                if (cont == DialogResult.OK) {
                    if (isNew) {
                        bindingSourceRemoveCurrent();
                        isNew = false;
                    } else {
                        bindingSourceCancelResetCurrent();
                        bindingSourceMovePrevious();
                    }
                }
            }
        }

        public void bindingNavigatorAddNewItem_Click(object sender, EventArgs e) {
            if (validateInput()) {
                saveToDatabase();
                bool temp = isUpdating;
                isUpdating = true;
                bindingSourceAddNew();
                isUpdating = temp;

                isNew = true;
                firstPass = true;
            } else {
                DialogResult cont = MessageBox.Show(null, "There are errors in your data. Click Cancel to go back and fix them, or ok to continue. If you continue, changes will not be saved.", "Continue?", MessageBoxButtons.OKCancel, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2);
                if (cont == DialogResult.OK) {

                    if (isNew) {
                        bindingSourceRemoveCurrent();
                        isNew = false;
                    } else {
                        bindingSourceCancelResetCurrent();
                    }

                    bool temp = isUpdating;
                    isUpdating = true;
                    bindingSourceAddNew();
                    isUpdating = temp;

                    isNew = true;
                    firstPass = true;
                }
            }
        }

        public void bindingNavigatorMoveFirstItem_Click(object sender, EventArgs e) {
            if (validateInput()) {
                bindingSourceMoveFirst();
            } else {
                DialogResult cont = MessageBox.Show(null, "There are errors in your data. Click Cancel to go back and fix them, or ok to continue. If you continue, changes will not be saved.", "Continue?", MessageBoxButtons.OKCancel, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2);
                if (cont == DialogResult.OK) {
                    if (isNew) {
                        bindingSourceRemoveCurrent();
                        isNew = false;
                    } else {
                        bindingSourceCancelResetCurrent();
                    }
                    bindingSourceMoveFirst();
                }
            }
        }

        public void bindingNavigatorMoveNextItem_Click(object sender, EventArgs e) {
            if (validateInput()) {
                bindingSourceMoveNext();
            } else {
                DialogResult cont = MessageBox.Show(null, "There are errors in your data. Click Cancel to go back and fix them, or ok to continue. If you continue, changes will not be saved.", "Continue?", MessageBoxButtons.OKCancel, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2);
                if (cont == DialogResult.OK) {
                    if (isNew) {
                        bindingSourceRemoveCurrent();
                        isNew = false;
                    } else {
                        bindingSourceCancelResetCurrent();
                    }
                    bindingSourceMoveNext();
                }
            }
        }
    } 
```

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2010-03-09T04:52:51.860

我还没有看到城市土豆的内容（它已经下架），但我和[Smelch](https://stackoverflow.com/users/245808/smelch)想出了一个解决方案。 **`Form`本身继承自一个抽象类，所以**他们没有告诉你的是**它只有第一级不能抽象，第二级可以。**

从那里开始，只需在中间有一个空类并围绕表单声明包装一个问题`#if debug`，你就可以开始了。只要确保在发布模式下发布并在调试模式下设计（这是非常典型的）。

您将在设计（调试）和构建（发布）时获得完整的设计器支持和真正的抽象基类，因为每次它最终都使用您的抽象基类。

[完整的解释和答案在这里](https://stackoverflow.com/questions/1620847/how-can-i-get-vs2008-winforms-designer-to-render-a-form-that-implements-an-abstra/2406058#2406058)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2019-11-19T08:05:14.733

您可以使用抽象类上的属性来解决此问题，如下所示

```
[TypeDescriptionProvider(typeof(AbstractControlDescriptionProvider<MyBaseFormEf, Form>))] 
```

这适用于您需要的每种情况。AbstractControlDescriptionProvider 如下

```
public class AbstractControlDescriptionProvider<TAbstract, TBase> : TypeDescriptionProvider
{
    public AbstractControlDescriptionProvider()
        : base(TypeDescriptor.GetProvider(typeof(TAbstract)))
    {
    }

    public override Type GetReflectionType(Type objectType, object instance)
    {
        if (objectType == typeof(TAbstract))
            return typeof(TBase);

        return base.GetReflectionType(objectType, instance);
    }

    public override object CreateInstance(IServiceProvider provider, Type objectType, Type[] argTypes, object[] args)
    {
        if (objectType == typeof(TAbstract))
            objectType = typeof(TBase);

        return base.CreateInstance(provider, objectType, argTypes, args);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-03-04T19:58:54.883

这对我来说适用于继承 UserControl 的抽象类

```
public class AbstractCommunicatorProvider : TypeDescriptionProvider
{
    public AbstractCommunicatorProvider(): base(TypeDescriptor.GetProvider(typeof(UserControl)))
    {
    }
    public override Type GetReflectionType(Type objectType, object instance)
    {
        return typeof(UserControl);
    }
    public override object CreateInstance(IServiceProvider provider, Type objectType, Type[] argTypes, object[] args)
    {
        objectType = typeof(UserControl);
        return base.CreateInstance(provider, objectType, argTypes, args);
    }
}

[TypeDescriptionProvider(typeof(AbstractCommunicatorProvider))]
public abstract partial class SelectorBase : UserControl
{

///class contents 
} 
```

我不需要将它添加到所有派生类，但在您的情况下您可能需要。

# javascript - 更多使用 Javascript 滚动溢出的 Div

> ID：481307
> 
> 赞同：1
> 
> 时间：2009-01-26T20:57:01.253
> 
> 标签：javascript, html, scroll

我的问题基本上可以追溯到这个：[Scrolling Overflowed DIVS with JavaScript](https://stackoverflow.com/questions/13362/scrolling-overflowed-divs-with-javascript)

我想知道如何在不使用 jQuery 的情况下做到这一点。任何帮助，将不胜感激。提前致谢！

另外：在链接的问题中，每次执行代码时是否将 div 向下滚动一个完整的滚动高度？如果是这样，我怎样才能让它随着鼠标位置向下滚动？换句话说，一旦我将鼠标移动到 div 的底部，我怎样才能让 div 继续向下滚动，并且可能让鼠标光标保持在同一位置（这种情况不需要但值得赞赏）？再次提前感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T22:15:59.627

我相信我确切地知道如何实现您正在寻找的效果。我只是使用 onmouseover 和 onmouseout 事件来启动和停止 JavaScript 间隔机制，该机制使用相关 div 的 scrollTop 属性来模拟滚动。试一试：

```
<script>
var interval, cur_scroll = 0;

function scroll()
{
  interval = setInterval(function()
  {
    cur_scroll += 2;
    document.getElementById('testDiv').scrollTop = cur_scroll;
  }, 40);
}

function stop()
{
  clearInterval(interval);
}

document.getElementById('testDiv').setAttribute('onmouseover', 'scroll()');
document.getElementById('testDiv').setAttribute('onmouseout', 'stop()');
</script>
```

```
<style>
#testDiv
{
  width: 100px;
  height: 100px;
  overflow: hidden;
  border: 1px solid #000000;
}
</style> 
```

```
<div id="testDiv">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec interdum libero sit amet diam. In hac habitasse platea dictumst. Cras eleifend tortor scelerisque mi viverra malesuada.</div>
```

# asp.net - IE 7 中回发的 ASP.NET CSS 不起作用

> ID：481308
> 
> 赞同：0
> 
> 时间：2009-01-26T20:57:22.487
> 
> 标签：asp.net, css, postback

当我的 ASP.NET 页面在 IE7 中进行回发时，所有的 CSS 都会丢失。我没有使用主题，而是将母版页中的 CSS 包含在后面的代码中。

```
 protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e);
    AddStylesheetInclude("/static/css/global.css");
    AddStylesheetInclude("/static/css/sifr.css");
} 
```

我的代码实际上是添加：

```
public virtual void AddStylesheetInclude(String url)
{
    HtmlLink link = new HtmlLink();
    link.Attributes["type"] = "text/css";
    link.Attributes["href"] = url;
    link.Attributes["rel"] = "stylesheet";
    Page.Header.Controls.Add(link);
} 
```

它在 Firefox 中运行良好，只是在 IE 中。为了添加更多上下文，在包含的 CSS 文件中，它用于`@import`包含其余部分。

## 编辑

如果我采用所有`@import`规则并将其包含在实际的 HTML 中，它就会起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T21:15:40.327

在对您的问题进行更多研究后，我发现链接不起作用的原因是（[http://www.broken-links.com/2007/02/15/ie7-and-import-media-types /](http://www.broken-links.com/2007/02/15/ie7-and-import-media-types/) )IE7 与@import 不兼容。这是一件好事，因为 IE7 修复了 '!important' 和 '* html' 调试技巧，所以如果没有 @import 错误，在 IE7 中进行调试就没有简单的方法。但我相信他们下次会修复它（5 年左右？），届时在 IE* 中的调试将是 h*ll。

所以我想这是目前尝试在客户端添加 css 脚本的唯一方法，因此它将始终保持在页面上呈现。在您使用包含在 css 文件中的链接进行构建后，当您尝试将类添加到源文件中的控件时，您的 IntelliSense 应该选择您的类。如果没有发生这种情况，您的文件链接可能有问题，所以改为将您的 CSS 代码合并到您的源代码中，如下所示：

```
<style type="text/css"> 

.highlight{               
background-color: #C0DDE0;     
}
</style> 
```

你应该能够做到这样

```
 <table id="table1" class="highlight"/> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T21:48:40.043

如果即使在您将链接标签直接放在头部之后css仍然无法工作，我会说您包含css的方式没有任何问题，而是css文件本身。

尝试将它们全部包含在内，而不直接在头部添加@import。这样您就可以排除导入的任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T22:06:01.753

您是否验证过回发后该标签仍在页面上？我似乎记得一些关于可靠操作 HEAD 标签的困难。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T22:38:35.823

嗯，你有什么理由像这样引用你的 CSS 文件吗？

# unit-testing - 为什么与测试驱动开发相比，按合同设计不那么受欢迎？

> ID：481312
> 
> 赞同：43
> 
> 时间：2009-01-26T20:57:44.090
> 
> 标签：unit-testing, tdd, design-by-contract

你可能会认为这个问题就像之前在 StackOverflow 上提出的[这个问题。](https://stackoverflow.com/questions/394591/design-by-contract-and-test-driven-development)但我试图以不同的方式看待事物。

在 TDD 中，我们编写包含不同条件、标准、验证码的测试。如果一个班级通过了所有这些测试，我们就可以开始了。这是一种确保班级实际上做它应该做的事情而不是其他任何事情的方法。

如果您逐字遵循*Bertrand Meyers的《**面向对象的软件构建*》一书，则该类本身具有内部和外部契约，因此它只做它应该做的事情，而不做其他事情。不需要外部测试，因为确保遵循合同的代码是类的一部分。

让事情变得清晰的快速示例

> **TDD**
> 
> 1.  创建测试以确保在所有情况下，值的范围都是 (0-100)
>     
>     
> 2.  创建一个包含通过测试的方法的类。
>     
>     
> 
> **DBC**
> 
> 1.  创建一个类，为该成员创建一个`var`范围为（0-100）的合同，设置合同违约合同，定义一个方法。

我个人喜欢 DBC 方法。

* * *

纯DBC不那么受欢迎是有原因的吗？是语言、工具还是敏捷，还是只有我喜欢让代码自己负责？

如果您认为我的想法不对，我会非常愿意学习。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-01-26T21:18:51.380

DBC 的主要问题是，在绝大多数情况下，要么无法正式指定合约（至少不方便），要么无法使用当前的静态分析工具进行检查。在我们超越主流语言（不是埃菲尔）的这一点之前，DBC 不会提供人们需要的那种保证。

在 TDD 中，测试是由人根据方法的当前自然文本规范编写的，这些规范（希望）是有据可查的。因此，人类通过编写测试来解释正确性，并根据该解释获得一些保证。

如果您阅读 Sun 编写 JavaDocs 的指南，它说该文档应该基本上列出一份足以编写测试计划的合同。因此，按合同设计不一定与 TDD 相互排斥。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-27T07:29:23.787

TDD 和 DbC 是两种不同的策略。DbC 允许**在运行时快速失败，**而 TDD 在“**编译时**”采取行动（确切地说，它在编译后立即添加一个新步骤以运行单元测试）。

这是 TDD 相对于 DbC 的一大优势：它允许获得更早的反馈。当您以 TDD 方式编写代码时，您会同时获得代码及其单元测试，您可以根据您在测试中编码的您认为它应该的内容来验证它是否“有效”。使用 DbC，您可以获得带有嵌入式测试的代码，但您仍然需要练习它。IMO，这当然是 Dbc 不那么受欢迎的原因之一。

其他优点：TDD 创建了一个**自动测试套件**，允许检测（防止读取）回归并使[重构](http://www.refactoring.com/)安全，因此您可以**逐步扩展您的设计**。DbC 不提供这种可能性。

现在，使用 DbC 快速故障非常有用，尤其是当您的代码与其他组件接口或必须依赖外部源时，在这种情况下测试合约可以节省您的时间。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2015-02-23T18:27:54.133

*首先，我是 Eiffel 的软件工程师，所以我可以从经验中谈谈这件事*。

* * *

### *TDD vs DbC*的前提是不正确的

这两种技术并不矛盾，而是相辅相成。补语与断言和目的的放置有关。

TDD 的目的既有组件又有范围。TDD 的基本组件是布尔断言和对象特征（例如方法）执行。步骤很简单：

1.  创建一个对象。
2.  在功能中执行一些代码。
3.  对对象上的数据状态进行断言。

断言失败，测试失败。通过所有断言是目标。

与 TDD 一样，Design-by-Contract 的合同具有目的、范围和组件。虽然 TDD 仅限于单元测试时间，但合同可以贯穿整个 SDLC（软件开发生命周期）！在 TDD 范围内，对象方法（特性）的执行将执行合同。在 Eiffel Studio 自动测试 (TDD) 设置中，创建一个对象，进行调用（就像其他语言中的 TDD 一样），但这里是相似的地方。

在具有自动测试功能的 Eiffel Studio 和具有合同的 Eiffel 代码中，目的有所改变。我们要测试客户-供应商关系。我们的 TDD 代码在其对象上伪装成我们的 Supplier 方法的客户。我们创建对象并基于此目的调用方法，而不仅仅是简单的“TDD-ish 方法测试”。因为对我们的方法（功能）的调用有契约，这些契约将作为我们在自动测试中的 TDD 式代码的一部分执行。因为这是真的，所以我们在代码中放置的合约断言（测试）不必出现在我们的 TDD 测试代码中。我们（作为程序员）的工作是简单地确保：A）代码+合约沿所有 N 路径执行，以及 B）代码+合约使用所有合理的数据类型和范围执行。

关于 TDD-DbC 互补关系可能还有更多要写的，但我不会在这件事上对你粗鲁。可以说 TDD 和 DbC 与其他没有矛盾——绝对不是！

### DbC 合约的力量超出了 TDD 所能达到的范围

现在，我们可以将注意力转向按合同设计的合同的力量，超越 TDD 的能力！

合约存在于代码中。它们不是外部的，而是内部的。关于合约最强大的一点（超出他们的客户-供应商合约关系基础）是编译器旨在了解它们！它们不是埃菲尔铁塔的附加物！因此，它们参与了继承的各个方面（传统的垂直 is-a 继承和横向或水平泛型）。此外，它们到达了 TDD 无法到达的地方——方法（特征）内部。

虽然 TDD 可以轻松地模拟前置条件和后置条件，但 TDD 无法进入代码内部并执行循环不变合约，也无法在代码块执行时定期抽查“检查”合约。这是一个强大的逻辑和定性范式，也是按合同设计如何运作的现实。

此外，TDD 不能做类不变量，只能以最微弱的方式。我已经尽我最大的努力让我的自动测试代码（实际上只是应用 TDD 的 Eiffel Studios 版本）来进行类不变模仿。这不可能。要了解为什么您必须了解 Eiffel 类不变量如何工作的来龙去脉。因此，目前，您只需要相信（或不相信）TDD 无法完成这项任务，而 DbC 可以如此轻松、良好、优雅地处理！

### DbC 的影响并不止于上述概念

我们在上面提到，TDD 存在于单元测试时。契约，因为它们在编译器的监督和控制下应用在代码中，所以适用于代码可以执行的任何地方：

1.  工作台：作为程序员，您正在使用代码来查看它的工作情况（例如，在 TDD 时间之前或与 TDD 时间结合使用）。

2.  单元测试：您的持续集成测试、单元测试、TDD 等。

3.  Alpha 测试：您的初始测试用户在运行可执行文件时会被合约绊倒

4.  Beta 测试：更广泛的用户受众也将被合同绊倒。

5.  生产：最终的可执行文件（或生产系统）可以通过合同进行持续测试（TDD 不能）。

在上述每种情况下，您都会发现自己可以控制运行哪些合约以及从哪些来源！您可以选择性地、细粒度地打开和关闭各种形式的合约，并以极高的精度控制编译器在何时何地应用它们！

如果这一切还不够，合约（通过设计）可以做一些 TDD 断言永远无法做到的事情：*告诉您调用堆栈中的哪个位置以及哪个客户端-供应商关系被破坏，以及为什么*（这也立即表明如何要解决这个问题）。为什么这是真的？

TDD 断言旨在告诉您事后代码运行（执行）的结果。TDD 断言只能看到被检查方法的当前状态。TDD 断言不能从它们在代码库外部的位置做的是准确地告诉您哪个调用失败以及为什么！您会看到——您对某个方法的初始 TDD 调用将触发该方法。很多时候，那个方法会调用另一个，另一个，另一个——有时，随着调用堆栈的来回摆动，会出现中断：数据写入错误，根本不写入，或者写入它不应该的时候。

*TDD就像谋杀已经发生后出现在犯罪现场的警察。他们只剩下法医线索，他们希望这些线索能将他们引向嫌疑人并定罪。但是，如果我们可以在犯罪发生时在那里呢？这就是放置 TDD 断言和合同断言之间的区别。合同是用来捕捉正在进行的犯罪的，它们直接指向犯罪者，因为它正在犯罪！*

### 回顾

让我们回顾一下。

*   TDD 与 DbC 并不矛盾。

*   它是一组技术的补充和协作，但具有不同的功能和目的，以及使用它们的工具。

*   合同更进一步，并在代码中断时揭示更多有关您的代码的信息。

*   TDD 是执行合同的一种催化剂。

在一天结束时：我想要两个！在阅读完所有这些之后（如果你幸存下来），我希望你也能这样做。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-01-26T21:20:04.560

**按合同设计和测试驱动开发并不相互排斥**。

Bertrand Meyer 的书*Object Oriented Software Construction, 2nd Edition*并没有说你永远不会犯错误。事实上，如果你看一下“当合约被破坏”一章，它会讨论当一个函数无法完成它的合约状态时会发生什么。

您使用 DbC 技术这一简单事实并不能使您的代码正确。合同设计以合同的形式为您的代码及其用户建立明确定义的规则。这很有帮助，但无论如何你总是会把事情搞砸，只是你可能会更早注意到。

测试驱动开发将从外部世界以黑盒方式检查您的类的公共接口是否正确运行。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-26T21:22:35.743

我认为最好将这两种方法结合使用，而不是仅使用其中一种。

在我看来，在类及其方法本身中完全执行契约是不切实际的。

例如，如果一个函数说它将通过某种方法散列一个字符串并将散列后的字符串作为输出返回，那么该函数如何强制该字符串被正确散列？再次哈希它，看看它们是否匹配？看起来很傻。反转散列，看看你是否得到原件？不可能。相反，您需要一组测试用例来确保函数正确运行。

另一方面，如果您的特定实现要求您的输入数据具有一定的大小，那么建立一个合同并在您的代码中执行它似乎是最好的方法。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-26T21:14:34.213

在我看来，TDD 更“归纳”。您从示例（测试用例）开始，您的代码体现了这些示例的通用解决方案。

DBC 似乎更“演绎”，在收集需求后确定对象行为和合同。然后，您对这些合约的具体实现进行编码。

编写合约有些困难，比作为具体行为示例的测试更困难，这可能是 TDD 比 DBC 更受欢迎的部分原因。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-26T21:00:46.347

我看不出两者不能共存的理由。看一个方法，一眼就知道合约到底是什么，真是太好了。很高兴知道我可以运行我的单元测试并且知道我的最后一次更改没有破坏任何东西。这两种技术并不相互排斥。为什么按合同设计不受欢迎是一个谜。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-09-18T21:00:40.847

我过去都使用过，发现**DBC 风格不太“侵入性”**。DBC 的驱动程序可能是常规应用程序运行。对于单元测试，您必须注意设置，因为您期望（验证）一些响应。对于 DBC，您不必这样做。规则以**独立于数据的方式**编写，因此无需设置和模拟。

更多关于我使用 DBC/Python 的经验：http: [//blog.aplikacja.info/2012/04/classic-testing-vs-design-by-contract/](http://blog.aplikacja.info/2012/04/classic-testing-vs-design-by-contract/)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-07-17T19:26:48.953

我将按合同设计视为所有案例中成功/失败的规范，而测试驱动开发针对一个特定案例。如果 TDD 案例成功，则假定一个函数正在完成它的工作，但它没有考虑其他可能导致它失败的案例。

另一方面，按合同设计并不一定要保证所需的答案，只需保证答案是“正确的”。例如，如果一个函数返回应该返回一个非空字符串，那么您在 ENSURE 中唯一可以假设的是它不会为空。

但也许它不会返回预期的字符串。合约无法确定这一点，只有测试可以表明它正在按照规范执行。

所以两者是互补的。

格雷格

# c# - 在 .Net 中，出于性能原因，我何时应该通过引用传递结构？

> ID：481314
> 
> 赞同：18
> 
> 时间：2009-01-26T20:58:48.643
> 
> 标签：c#, .net, optimization

在我的 C# 应用程序中，我有一个大型结构（176 字节），每秒可能向函数传递十万次。然后，此函数只需获取指向结构的指针并将指针传递给非托管代码。函数和非托管代码都不会对结构进行任何修改。

我的问题是，我应该通过值还是通过引用将结构传递给函数？在这种特殊情况下，我的猜测是通过引用传递比将 176 个字节推入调用堆栈要快得多，除非 JIT 碰巧认识到该结构从未被修改过（我的猜测是它无法识别这一点，因为结构的地址传递给非托管代码）并优化代码。

既然我们在这里，让我们也回答更一般的情况，即函数不*将*结构的指针传递给非托管代码，而是对结构的内容执行一些只读操作。通过引用传递结构会更快吗？在这种情况下，JIT 是否会认识到该结构从未被修改并因此进行优化？据推测，通过引用传递一个 1 字节的结构*并不是*更有效，但是在多大的结构大小下，通过引用传递一个结构会变得更好，如果有的话？

谢谢。

编辑：

正如下面所指出的，也可以创建一个“等效”类以供常规使用，然后在传递给非托管代码时使用结构。我在这里看到两个选项：

1) 创建一个仅包含该结构的“包装器”类，然后在必要时将指向该结构的指针固定并传递给非托管代码。我看到的一个潜在问题是固定有其自身的性能影响。

2) 创建一个等效类，当需要该结构时，其字段被复制到该结构中。但是复制会花费很多时间，而且在我看来，首先要打破通过引用传递的观点。

编辑：

正如下面多次提到的，我当然可以衡量每种方法的性能。我*会这样做*并发布结果。但是，我仍然有兴趣从知识的角度看待人们的答案和推理。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T01:09:54.503

我做了一些非常非正式的分析，结果表明，对于我的特定应用程序，通过引用传递有适度的性能提升。对于按值，我每秒收到大约 10,050,000 个调用，而对于按引用，我每秒收到大约 11,200,000 个调用。

你的旅费可能会改变。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-26T21:10:31.100

在你问是否应该通过引用传递结构之前，你应该先问问自己为什么你有这么大的结构。它*真的*需要是一个结构吗？如果您需要在某个时候为 P/Invoke 使用一个结构，是否值得为此使用一个结构*，*然后在其他地方使用等效的类？

这么大的结构非常非常不寻常......

有关这方面的更多指导，请参阅关于[在类和结构之间进行选择的](http://msdn.microsoft.com/en-us/library/ms229017.aspx)[“开发类库的设计指南”](http://msdn.microsoft.com/en-us/library/ms229042.aspx)部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T22:14:44.717

你可以得到这个问题的答案的唯一方法是对两者进行编码并测量性能。

您提到非托管/托管互操作。我的经验是，互操作需要很长时间。您可以尝试从以下位置更改您的代码：

```
void ManagedMethod(MyStruct[] items) {
  foreach (var item in items) {
    unmanagedHandle.ProcessOne(item);
  }
} 
```

到：

```
void ManagedMethod(MyStruct[] items) {
  unmanagedHandle.ProcessMany(items, items.Count);
} 
```

这种技术在类似的情况下帮助了我，但只有测量值才能告诉你它是否适用于你的情况。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-07-09T19:04:25.810

为什么不直接使用一个类，然后将你的类传递给你的 P/Invoke 函数呢？

使用类将在您的托管代码中很好地传递，并且与通过引用 P/Invoke 函数传递结构相同。

例如

```
// What you have
public struct X
{
   public int data;
}
[DllImport("mylib.dll")]
static extern void Foo( ref X arg);

// What you could do
[StructLayout(LayoutKind.Sequential)]
public class Y
{
    public int data;
}
[DllImport("mylib.dll")]
static extern void Bar( Y arg ); 
```

# oop - 有没有学习面向对象编程的好课程？

> ID：481316
> 
> 赞同：5
> 
> 时间：2009-01-26T20:59:11.700
> 
> 标签：oop

我正在寻找一些关于面向对象编程的好课程。到目前为止，我已经编程了大约 4 年，但我不觉得我对 OO 有扎实的掌握。

你是怎么学的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T21:06:46.740

Its all learning by doing. Courses and books are good, but the bottom line: Coding is all about writing programs; start from there. Another thing I personally think is very important: read other peoples code!

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T21:04:39.787

Try these: [http://webcast.berkeley.edu/course_details_new.php?seriesid=2008-D-26263&semesterid=2008-D](http://webcast.berkeley.edu/course_details_new.php?seriesid=2008-D-26263&semesterid=2008-D)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:10:33.800

Maybe you'll like the ["Head First"](https://rads.stackoverflow.com/amzn/click/com/0596008678) approach.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T21:11:15.047

Since you ask :) I learned with *[Object Oriented Software Construction, 2nd Edition](http://archive.eiffel.com/doc/oosc/)* by Bertrand Meyer, Prentice Hall, 1997.

Meyer is due to publish in a very short while a book which is focused on learning to program from the start: *[Touch of Class](http://se.ethz.ch/~meyer/down/touch/)*. This should be a good option for students.

I notice that people's tastes about learning materials vary quite a lot. Some like summaries, tutorials, how-to's... I learn complex subjects by taking my time to follow the complete dissertations.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T21:20:46.853

The mechanics of OO (i.e. the syntax and semantics, terminology, what it is, what it does) are very easy. They "why" and "where" of it is the hard part. I'd suggest you just learn the mechanics quick and dirty on Wikipedia if you haven't already, and then pick up a book on design patterns. Head First is a good choice here. I don't believe that you can truly understand OOP (or really anything for that matter) unless you know where it's useful and what problems it's meant to solve.

After this, the next step would be to look at APIs you use every day in your favorite language from your new perspective. You should start seeing why using OO techniques in certain situations makes the API much more usable than if everything were just free/static functions and plain old data objects. You might also see areas where OOP is awkward and overused and free/static functions and plain old data objects might be better solutions.

Lastly, it's useful to know how some aspects of OO are implemented at a lower level. Understanding things like virtual function tables and how to do OOP in pure C really adds a level of depth to your understanding of what can and cannot be accomplished with it, and what the tradeoffs are inherent in it.

And obviously, try to integrate what you learn into the code you write.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T21:03:23.597

A pure-object language is the best course in OO.

I can suggest Java, Ruby, or Smalltalk

Learn any of those (from scratch, not just as rewriting C or Perl) and you know OO.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T21:07:29.923

I would go with ruby, it's more mainstream than smalltalk, and has a richer syntax than java. Perfect for the beginner

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T21:17:16.533

It is REALLY difficult to learn this by yourself. The best chance is to learn it alongside someone else at your workspace, who's going to get you through tasks and shows you things on the way.

I can recommend this book. [http://squeakbyexample.org/](http://squeakbyexample.org/) it's far from perfect, but it's free and comes with a special squeak version that is optimized so you find the code fast. The examples are kind of nice for starters, I think. At least I enjoyed reading it.

# java - 格式化数字的最佳设计模式是什么？

> ID：481319
> 
> 赞同：2
> 
> 时间：2009-01-26T20:59:53.777
> 
> 标签：java, design-patterns, formatting

我需要编写根据指定选项格式化值的代码。

现在有几个格式选项可供选择：以指定的精度舍入/截断数字、添加前缀（例如 $）或后缀（例如 %）、分组千位（应用逗号）、添加数字缩写 (KMB)。

因此，例如数字 1857 可以显示为 $2K 或 $1.86K 或 $1,867

起初我考虑过为此使用**装饰器**模式，但我不确定因为格式化程序应该按特定顺序应用，例如首先我需要应用 KMB 转换：1857 -> 1.857 K，然后将其舍入 1.86 K。

你有什么建议吗？

谢谢，马塔利

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-26T21:02:03.957

不，请使用您已经可用的 java.text.NumberFormat 选项。他们已经完全国际化了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T15:26:59.657

假设没有适合您需求的现有实现，除了装饰器之外还有不同的选择：

如果您可以分解规则中的格式（小数分隔符、千位分隔符、货币），那么每个块处理为规则的责任链（[http://www.dofactory.com/Patterns/PatternChain.aspx](http://www.dofactory.com/Patterns/PatternChain.aspx)）可以是一个选项，您可以按特定顺序运行它。

# c# - 随机顺序人口的最佳 C# 数据结构？

> ID：481334
> 
> 赞同：1
> 
> 时间：2009-01-26T21:04:24.467
> 
> 标签：c#, data-structures, collections

在 C# 中，我有一个从`int`s 到集合的映射的用例。

*   s 是从 1 到 n的`int`密集（但未压缩）集合，其中 n 未知。
*   单元格将按随机顺序加载。
*   每个单元格的边际成本应该是理想的（与 a`List<T>`或一样好`T[]`）
*   我想让单元格默认按需填充

什么是最好的结构？

A`List<T>`可以很好地工作（在空间上比 a 更好`Dictionary<>`）并且通过从中派生我可以获得很多我想要的东西，但是有更好的东西吗？最好的代码是你不写的代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T21:07:53.867

A`Dictionary<int, Cell>`对我来说听起来很合适。或者您可以`List<Cell>`很容易地使用 a ，并确保在必要时对其进行扩展：

```
public static void EnsureCount<T>(List<T> list, int count)
{
    if (list.Count > count)
    {
        return;
    }
    if (list.Capacity < count)
    {
        // Always at least double the capacity, to reduce
        // the number of expansions required
        list.Capacity = Math.Max(list.Capacity*2, count);
    }
    list.AddRange(Enumerable.Repeat(default(T), list.Capacity-list.Count));
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T21:17:37.327

如果你想成为一个真正的坚持者，一个选择是编写一个外观类，它提供围绕许多不同映射器的策略。使它在 N 小于某个值并且负载（打包）超过某个阈值时使用静态定义的数组。当通过某些阈值时，让它交换为树或字典表示。

您没有说明您计划在构建此数据结构后如何与它进行实际交互，因此根据您的访问/使用模式，混合策略可能比坚持使用单一数据表示提供更好的运行时行为。当要排序的集合具有少于 N 个数据元素时，以类似于快速排序算法实现有时会切换到更简单的排序算法的方式来考虑它。

干杯!

# sql - 根据电话号码计算人的时区（GMT 偏移量）？

> ID：481335
> 
> 赞同：4
> 
> 时间：2009-01-26T21:04:25.530
> 
> 标签：sql, oracle, timezone-offset

我收到了一个根据电话号码显示某人当地时间的请求。我知道我们当地的 GMT 偏移量，所以我可以通过一个数据库表来处理美国电话，我们有一个将美国邮政编码链接到 GMT 偏移量（例如 -5）的数据库表。但我不知道如何转换非美国电话号码或国家名称（这些人显然没有邮政编码）。

如果您关心，我的雇主学院希望在合理的时间内向我们的校友募集捐款。

很抱歉，我没有*明确*说明我正在考虑**家庭**电话号码。所以漫游不是问题。我正在寻找一些可以从中获取此信息的参考表或 Oracle 应用程序。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T21:20:59.303

佛罗里达州有两个时区，但许多国家只有一个。您需要此表：[http](http://en.wikipedia.org/wiki/List_of_country_calling_codes) ://en.wikipedia.org/wiki/List_of_country_calling_codes 。通过查找 NANPA 国家（使用与美国相同的 1+区号分配的国家）的 1 和区号，从电话号码中解析国家代码，对于俄罗斯或哈萨克斯坦，则为 7。如果不匹配，请检查号码是否以 2 位呼叫前缀之一开头，然后是 3 位呼叫前缀。

请记住，号码的前几位数字可能是国际拨号前缀，而不是电话号码的正确部分。

对于跨越多个时区的国家/地区，请查看您是否可以从其国家电信监管机构获得分配信息。对于美国和其他 NANPA 国家/地区，请查看[http://www.nanpa.com/](http://www.nanpa.com/)。

当然，您的结果远非完美，但希望您能从睡眠中唤醒更少的客户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T12:26:51.813

当地时间是一回事，但如果您有全球客户，还需要考虑当地习惯。

人们通常在挪威比在西班牙早睡（而且他们在同一时区）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T21:12:03.877

您也许可以让电话公司向您提供位置数据（此信息应该存在于固定电话中，并且必须存在于手机中），但需要付费。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T21:18:37.107

有些国家很容易，因为它们在一个时区。看看欧洲，只需使用国际拨号代码就可以增加数百万人。+47 挪威等。

电话号码分配通常由国家电信当局完成，因此您可能可以免费获得信息。

正如您已经知道的那样，这只会考虑默认时区，因为它们当时可能在地球上的任何地方。此外，时区之间的数字分配可能根本没有区别，因此该方法有缺陷，但可能对提供默认设置有用。

问候

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T21:28:37.663

看电话簿。我们有很多页面将区号映射到国家/省/州。然后您必须将地理位置映射到时区，但这非常简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T21:30:54.103

不可能的。如果我向东行驶约 400 英里（美国西海岸），那么我将通过在 YYY 时区使用 XXX 号码来破坏您的算法。

现在，如果这是一个手机应用程序，它似乎可以使用[名为 NITZ 的东西](http://msdn.microsoft.com/en-us/library/aa917950.aspx)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T23:09:09.800

我认为 Danie、Bortzmeyer 和其他人都在考虑这个问题。不是最大化调用窗口，而是找到一个可以接受的时间。

让我们以美国为例，只考虑 4 个主要时区。假设我们将可接受的时间定义为上午 10 点到晚上 7 点。我怀疑即使是挪威单身汉农民也会在晚上 7 点之前到达。

因此，如果您知道电话在美国，请不要在下午 1 点之前拨打任何电话。这样，如果他们在纽约或洛杉矶，仍然是上午 10 点之后。晚上 7 点以后没有电话。谁在乎它是佛罗里达州的主要还是它一小时后的狭长地带？达拉斯或埃尔帕索，也是同一个州，但时区不同。对于美国，过滤 AK 和 HI。唯一严重困难的国家是俄罗斯——很多时区。

# sql - SQL 多维数据集处理窗口

> ID：481337
> 
> 赞同：0
> 
> 时间：2009-01-26T21:04:50.893
> 
> 标签：sql, ssis, data-warehouse, etl, cubes

我有 Dim Tables、Fact Tables、ETL 和一个立方体。我现在希望确保我的多维数据集只保存前 2 个月的数据。这应该通过强制我的事实表只保存 2 个月的数据并执行“完整过程”来完成，还是有办法从我的多维数据集中修剪过时的数据？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-26T21:18:29.260

您的数据已经通过 ETL 进行了维度化，并且您在其上构建了一个多维数据集？

并且您想保留 Fact 表中的数据，但不一定需要它在多维数据集中超过过去 2 个月？

如果您甚至不想保留数据，我只需按日期清除事实表。因为无论如何您可能都希望回收该空间。

但是在多维数据集构建中也有一些设置 - 或者根据仅公开最近两个月的动态视图构建多维数据集 - 然后可以在您甚至清除基础事实表之前完成多维数据集（重新）构建。

您还可以按日期查看分区：

[http://www.mssqltips.com/tip.asp?tip=1549](http://www.mssqltips.com/tip.asp?tip=1549)

[http://www.sqlmag.com/Articles/ArticleID/100645/100645.html?Ad=1](http://www.sqlmag.com/Articles/ArticleID/100645/100645.html?Ad=1)

# assembly - 以美元结尾的字符串

> ID：481344
> 
> 赞同：4
> 
> 时间：2009-01-26T21:06:36.553
> 
> 标签：assembly, console, dos, nasm

在我的汇编语言课上，我们的第一个任务是编写一个程序，在 DOS 中打印出一个简单的以美元结尾的字符串。它看起来像这样：

```
BITS 32
    global _main

section .data
    msg db "Hello, world!", 13, 10, ’$’

section .text
_main:
mov ah, 9
mov edx, msg
int 21h
ret 
```

据我了解，$ 符号用于终止字符串，就像 C 中的 null 一样。但是如果我想在字符串中添加一个美元符号（比如我想打印出“它花费 30 美元”），我该怎么办？这似乎是一个简单的问题，但我的教授不知道答案，我似乎也没有使用谷歌搜索找到它。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-26T21:16:57.267

您不能使用 DOS 的`0x09`服务来显示`$`标志，您需要使用`0x02`. 见[这里](http://spike.scu.edu.au/~barry/interrupts.html#ah02)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T21:35:33.453

或者使用未记录的 INT 29h（AL 中的打印字符）制作自己的 print_string 以打印以 NULL 结尾的字符串。

```
; ds:si = address of string to print
print_string:
    lodsb                   ; load next character from ds:si
    or al, al               ; test for NULL-character
    jz .end_of_string       ; end of string encountered, return.
    int 29h                 ; print character in AL on screen
    jmp print_string        ; print next character
.end_of_string:
    ret                     ; return to callers cs:ip 
```

（假设您使用的是 NASM）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-10-01T16:30:04.667

我更喜欢使用`write`服务（`AH=0x40`）：

*   `AH=0x40`
*   `BX`是文件句柄；使用值 1 写入与服务相同的设备（例如屏幕）`AH=9`
*   `CX`是要写入的字节数；数据不是“终止”的（既不是由 NUL 也不是由`$`），因此可以写入所有值（从 0 到 255）
*   `DS:DX`指向要写入的数据（在您的情况下：字符串）
    （就像服务一样`AH=9`；如果您使用 32 位 DOS 扩展：`EDX`当然）

该服务实际上是用于将数据写入文件；`BX`但是，它也可用于通过设置为 1将“字符串”写入“输出” 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T07:35:41.917

一种方法是找到打印单个字符的调用。你可以用它打印任何字符。分解字符串并打印“it cost”，然后是“$”，最后是“30”。更多的工作，但它完成了工作。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-05-25T04:16:25.700

您可以使用INT 21H 的**02 服务**代替**09 服务**。

这是示例。

```
mov dl, '$'

mov ah,02

int 21h 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-01-26T21:14:12.483

嗯。您可以编写考虑转义的程序集`$`，例如`\$`？但是你`\`也变成了一个特殊的符号，你需要用它`\\`来打印一个`\`

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2009-01-26T21:18:47.763

尝试“$$”、“\044”（八进制）或“\x24”（十六进制）

# javascript - 使用 Javascript 以编程方式剪辑/剪切图像

> ID：481351
> 
> 赞同：16
> 
> 时间：2009-01-26T21:08:24.617
> 
> 标签：javascript, image

是否有关于如何剪辑或剪切大图像以使用户只看到该图像的一小部分的任何文档/教程？假设源图像是 10 帧动画，端到端堆叠，因此它真的很宽。我可以用 Javascript 做些什么来一次只显示 1 个任意的动画帧？

我已经研究过这种“CSS Spriting”技术，但我认为我不能在这里使用它。源图像是从服务器动态生成的；在从服务器返回之前，我不会知道总长度或每个帧的大小。我希望我可以做类似的事情：

```
var image = getElementByID('some-id');

image.src = pathToReallyLongImage;

// Any way to do this?!
image.width = cellWidth;
image.offset = cellWidth * imageNumber; 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-26T21:19:58.493

这可以通过将您的图像包含在“视口”div 中来完成。在 div 上设置一个宽度和高度（根据您的需要），然后设置`position: relative`并`overflow: hidden`在其上。绝对将您的图像放置在其中并更改位置以更改显示的部分。

要显示从 (10,20) 开始的图像的 30x40 部分：

```
<style type="text/css">
    div.viewport {
        overflow: hidden;
        position: relative;
    }

    img.clipped {
        display: block;
        position: absolute;
    }
</style>

<script type="text/javascript">
    function setViewport(img, x, y, width, height) {
        img.style.left = "-" + x + "px";
        img.style.top  = "-" + y + "px";

        if (width !== undefined) {
            img.parentNode.style.width  = width  + "px";
            img.parentNode.style.height = height + "px";
        }
    }

    setViewport(document.getElementsByTagName("img")[0], 10, 20, 30, 40);
</script>

<div class="viewport">
    <img class="clipped" src="/images/clipped.png" alt="Clipped image"/>
</div> 
```

常见的 CSS 属性与类相关联，因此您可以在页面上拥有多个视口/剪辑图像。`setViewport(…)`可以随时调用该函数来更改图像的显示部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-16T08:33:32.353

回答：

唉，JavaScript 根本无法提取执行此类操作所需的图像属性。但是，HTML 元素与一些服务器端脚本相结合的形式可能会有所帮助。...

```
< ? (open php) 
$large_image = 'path/to/large_image';
$full_w = imagesx($large_image);
$full_h = imagesy($large_image);
(close php) ? > 
```

**这可以在 Javascript 中完成，只需 google 一下：**

```
var newimage = new Image();
newimage.src = document.getElementById('background').src;
var height = newimage.height;
var width  = newimage.width; 
```

这会从现有图像生成一个新图像，并以这种方式在 java 脚本中捕获原始图像的原始高度和宽度属性（而不是被标识为背景的图像）。

回答：

文档图像对象的宽度/高度属性是只读的。然而，如果你可以改变它们，你只会挤压框架，而不是像你想要的那样切割框架。您想要的那种图像处理无法使用客户端 javascript 完成。我建议在服务器上剪切图像，或者在图像上覆盖一个 div 以隐藏您不希望显示的部分。

...

```
var newimage = new Image();
newimage.src = document.getElementById('background').src;
var height = newimage.height;
var width  = newimage.width;
newimage.style.height = '200px';
newimage.style.width = '200px';
newimage.height = '200px';
newimage.width = '200px'; 
```

如果需要：

```
newimage.setAttribute('height','200px'); 
```

在某些情况下需要加倍的 newimage.style.height 和 newimage.height 以确保 IE 及时了解图像已调整大小（您将在之后立即渲染该内容，并且内部 IE 处理是太慢了。）

[感谢我在http://morethanvoice.net/m1/reader13.php](http://morethanvoice.net/m1/reader13.php)（右键菜单... mouseover zoom lent）上更改和实现的上述脚本，即使在 IE 中也是正确的，但是您会注意到鼠标移动图像处理是对于旧式 IE 来说太快了，渲染位置但只渲染一次图像。无论如何，欢迎任何好主意。

感谢大家的关注，希望以上代码可以帮助到大家...

克劳迪奥·克伦普 [http://morethanvoice.net/m1/reader13.php](http://morethanvoice.net/m1/reader13.php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:25:03.770

CSS 还定义了一种剪裁样式。请参阅 CSS 规范中的 clip 属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T21:18:02.770

文档图像对象的宽度/高度属性是只读的。然而，如果你可以改变它们，你只会挤压框架，而不是像你想要的那样切割框架。您想要的那种图像处理无法使用客户端 javascript 完成。我建议在服务器上剪切图像，或者在图像上覆盖一个 div 以隐藏您不希望显示的部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T21:23:00.530

spriting 所做的本质上是将一个绝对定位的 DIV 定位在另一个具有溢出：隐藏的 DIV 中。您也可以这样做，您需要做的就是根据较大图像的每一帧的大小调整外部 DIV 的大小。您可以轻松地在代码中做到这一点。

您可以设置内部 DIV 的样式：

```
left: (your x-position = 0 or a negative integer * frame width)px 
```

大多数 JavaScript 框架使这变得非常容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T21:25:37.483

唉，JavaScript 根本无法提取执行此类操作所需的图像属性。但是，HTML <canvas> 元素结合一些服务器端脚本可能会有所帮助。

用于提取真正大图像的宽度和高度的 PHP 代码：

```
<?php
$large_image = 'path/to/large_image';
$full_w = imagesx($large_image);
$full_h = imagesy($large_image);
?> 
```

然后，您可以从这里将图像加载到 <canvas> 元素中，[此处](http://www.phpied.com/photo-canvas-tag-flip/)记录了一个示例。现在，我的理论是你可以从 <canvas> 元素中提取像素数据；假设可以，您只需确保在大图像的帧之间有某种形式的明确分隔线，然后在画布中搜索它。假设您在距离图像左侧 110 像素处找到了分隔线；然后，您会知道每个“帧”的宽度为 110 像素，并且您已经将完整宽度存储在 PHP 变量中，因此破译您正在使用的图像数量将是一件轻而易举的事。

该方法唯一的推测是 JavaScript 是否能够从加载到 <canvas> 元素中的图像中的指定位置提取颜色数据；如果这是可能的，那么您要完成的工作是完全可行的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T21:25:49.947

我想您想为您的图像拍摄缩略图。您可以通过以下方式使用从原型库创建的 ImageThumbnail.js：

```
<script type="text/javascript" src="prototype.js"></script>
<script type="text/javascript" src="ImageThumbnail.js"></script>
<input type="file" id="photo">
<img src="empty.gif" id="thumbnail" width="80" height="0">
<script type="text/javascript">
<!--
    new Image.Thumbnail('thumbnail', 'photo');
//-->
</script> 
```

了解更多[信息](http://www.codetoad.com/javascript_ImageThumbnail.asp)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-27T08:20:09.990

尝试通过简单的函数使用 haxcv 库 haxcv js

去[https://docs.haxcv.org/Methods/cutImage](https://docs.haxcv.org/Methods/cutImage)阅读更多关于他的图书馆的信息

```
var Pixels = _("img").cutImage (x , y , width , height  ); 
```

_("img").src (Pixels.src);

// 返回剪切图像，但首先尝试包含库

# django - Using Git For Community-Oriented Website Content Revision System

> ID：481353
> 
> 赞同：4
> 
> 时间：2009-01-26T21:09:17.423
> 
> 标签：django, git, revision

I'm working on a Django-based web app in which the community fuels the content on the site, much like a wiki. Content is in the form of HTML, and users have total freedom to fork articles/chapters or make their own modifications to existing ones and add them to the current 'working version'. The maintainer of each article/chapter (the original authors[s]), will have the option of accepting these changes.

We're also planning on maintaining two versions - or at least views - of any given article: the author-approved edits version and the free-for-all community based edits version.

The revision system that would manage all this forking, merging and branching on top of detailed histories is starting to sound a lot like what a source revision system does. So I'm considering using Git to manage these revisions.

My question to those more experienced in this type of thing than I:

*   Is it worth the effort and after that, will it be better than rolling something out in a RDBMS?

*   And if so, roughly, how should I go about implementing this with Django/Python?

*asked again in hopes of catching more replies, this is very important to me*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T22:42:33.600

我不知道有任何**Django 模块**可以提供您想要的东西（至少是 wiki，即带有一些轻量级标记语言的可编辑文本，加上版本控制系统），但您可以查看Git Wiki上的[InterfacesFrontendsAndTools](http://git.or.cz/gitwiki/InterfacesFrontendsAndTools)页面，“Wikis”部分、博客等”。除其他外，您可以在那里找到：

*   [wikiri](http://blitiri.com.ar/git/?p=wikiri "gitweb")：用 Python 编写的简单的单文件 wiki，可选 git 支持历史跟踪
*   **[Chuyen](https://www.ohloh.net/p/chuyen "哦哦")** : 一个用 Python 编写的博客软件，使用 Django Web 框架和 Git 作为其通过 PyGit 的数据存储后端
*   [Pystl](http://blog.codezen.org/entries/tag/pystl)：非常简单的 Python 小型博客引擎，使用 Git 进行版本控制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T21:29:47.583

您可以考虑查看[ikiwiki](http://ikiwiki.info)的工作原理。这是一个简单的 wiki 系统，可以由真正的版本控制系统支持（我将它与 Git 存储库一起使用）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T00:31:38.823

[GitPython](http://gitorious.org/projects/git-python/)是一个与 Git 存储库交互的 Python 库。我玩过它，但没有在生产中使用它。它看起来很稳固且相对易于使用，并且正在积极开发中。

如果您在将 Git 与 Django 项目集成时遇到困难，您可以查看 Mercurial。我非常喜欢 Git，它优雅而强大的数据模型，但 Mercurial 提供了与 Git 类似的功能，而且它是用 python 编写的，所以对你来说可能更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-17T10:26:07.343

django-rcsfield 可能会有所帮助。它是 Django Web 框架的一个字段（如 models.TextField），它在后台对其内容进行版本化。名称中的“rcs”是修订控制系统的缩写。

[http://code.google.com/p/django-rcsfield/](http://code.google.com/p/django-rcsfield/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T04:31:12.490

我刚刚在reddit上看到了这个：

[https://launchpad.net/django-wikiapp/](https://launchpad.net/django-wikiapp/)

> Django WikiApp 是 Django 的一个可插拔应用程序，旨在提供一个完整的 Wiki（对于非常小的“完整”值）。

嗨，

# linux - 如何发现机器类型？

> ID：481355
> 
> 赞同：8
> 
> 时间：2009-01-26T21:09:25.283
> 
> 标签：linux, macos, shell, scripting, solaris

我想发现大量机器的机器架构类型。我有每台机器的主机名。这些机器有 Debian 4 linux、SunOS 9、SunOS 10 或 Apple Darwin。所有都是类unix，但有细微的差别。

我想知道： - 架构（x86、x86_64、ia64、sparc、powerpc...） - 处理器类型（intel pentium、pentium pro、pentium II、sparc、powerpc、itanium、athlon、core 2 duo、cytrix 等...) - 处理器数量

当心，我想要机器的“类​​型”。使用 'uname' 的愚蠢方法在 Sun 上不起作用，当机器实际上是 'x86_64' 但操作系统是 32 位时，它还会返回诸如 'i686' 之类的东西。/proc/cpuinfo 也不起作用，而且事情变得更加复杂，因为有些机器没有安装 C 编译器（我敢肯定它们都有 sh，也许是 python 或 perl，不知道）。

提前致谢！！:)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-29T04:46:41.977

`arch ; uname -a`

arch 是获取 CPU 指令集名称的标准方法。uname -a 得到一堆关于操作系统的东西。uname 没有 a 获取操作系统名称。

但是从编程上讲，相当于`arch`is `uname -m`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T21:25:55.563

您可以尝试以下 Perl 单行：

```
perl -MConfig -e 'print "$Config{myarchname}\n";' 
```

我知道在带有 Perl 5.10.0 的 Mac OS X Leopard 上它会打印“i386-darwin”。我不知道在 Perl 中获取实际处理器名称的方法 - 你最好的选择可能是 C，因为它的可能性相当有限。您可以从 Perl 获得 C 编译器的预定义宏：

```
perl -MConfig -e 'print join("\n", split(/ /, $Config{cppsymbols})), "\n";' 
```

这将列出Mach-O 格式和(至少在 Leopard 上) 之类的 C 宏，以及像and`__LITTLE_ENDIAN__`之类的无用宏。当然，所有这些帮助都假设您在所有机器上都安装了 Perl。如果没有，我相信其他语言也有类似的工具可以帮助你。`__MACH__``__i386__``__GNUC__``__STDC__`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T21:13:02.237

我建议您查看 Puppet 系统的 facter 组件。从 URL [http://reducinglabs.com/projects/facter/](http://reductivelabs.com/projects/facter/)。

> 一个跨平台的 Ruby 库，用于从操作系统中检索事实。支持多种解析机制，其中任何一种都可以限制为仅在某些操作系统或环境中工作。Facter 对于检索操作系统名称、IP 地址、MAC 地址和 SSH 密钥等内容特别有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T21:45:45.617

为什么 /proc/cpuinfo 不起作用？

我不知道你提到的所有操作系统，但我认为它在 Linux 下提供了相当详细的信息。至少，对于CPU的型号，可以从数据表中查到其他信息。

软件只能看到操作系统让它看到的东西，所以如果操作系统不提供/proc/cpuinfo之**类**的信息，那么你就无法知道它。

**回复评论：**

我并不是说为所有操作系统寻找 /proc/cpuinfo。这是一个两步的方法：首先你找出它正在使用哪个操作系统 uname，然后查找操作系统特定位置的 cpu 信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-06T19:01:19.400

这不是一个完整的答案，但它可以帮助您实现目标。

arch 不适用于 HP-UX Itanium，并且它没有 /proc 文件系统，正如您所提到的。

[这](https://serverfault.com/questions/163487/linux-how-to-tell-if-system-is-big-endian-or-little-endian/163493#163493)解释了如何简单地通过 shell 命令确定 O/S 使用的字节顺序（字节顺序）。它至少适用于 4 个主要的 Unix（Linux x86_64、Solaris Sparc、AIX/Power、HP-UX Itanium）。如果您知道字节顺序，则可以根据[此](http://labs.hoffmanlabs.com/node/544)来源推断出很多关于您正在处理的 CPU 的信息。

例如，如果 Solaris 不会告诉您正确的体系结构，但您看到它是大端序，那么您至少知道您不在 x86_64 上，而且可能不在 Sparc 上。

最后，对于 Sparc，您可以这样做来确定操作系统是在 32 位还是 64 位模式下运行：

```
# isalist -v
sparcv9+vis2 sparcv9+vis sparcv9 sparcv8plus+vis2 sparcv8plus+vis sparcv8plus sparcv8 sparcv8-fsmuld sparcv7 sparc 
```

如果它说 'sparcv9' 它是 64 位，sparcv8 是 32

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-14T16:20:49.463

使用`uname -a`会带给你很多信息，所以你必须搜索你想拥有的信息。

只需使用：

```
uname -i 
```

对于硬件平台

或者

```
uname -m 
```

机器硬件名称

# function - 您如何编写测试来测试具有可变返回值的函数？

> ID：481356
> 
> 赞同：3
> 
> 时间：2009-01-26T21:09:42.540
> 
> 标签：function, variables, testing

我有一个像这样的简单功能：

```
 function CreateFileLink()
    {
            global $Username;

            return date("d-m-y-g-i");
    } 
```

您如何编写代码来测试返回数据可变的函数？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T21:23:54.833

如果您能以某种方式控制该 date() 函数，则可以对其进行测试。例如，在这种情况下，您只关心使用“dmygi”调用日期函数；你并不真正关心它的输出。也许是这样的：

```
function CreateFileLink(DateProvider dateProvider)
{
        global $Username;

        return dateProvider.date("d-m-y-g-i");
} 
```

对不起，我什至不知道这是什么语言，但希望你能明白我的意思。在生产代码中，您可以通过以下方式调用它：

```
DateProvider standardDateProvider = new DateProvider() { Date date(String str) { return date(str); } };
CreateFileLink(standardDateProvider); 
```

但是在您的测试中，您可以提供一个替代实现，如果输入不是您所期望的，它将引发错误：

```
DateProvider mockProvider = new DateProvider() 
{
    Date date(String str) 
    {
        if(str != "d-m-y-g-i") throw Exception();
        return "success";
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T21:20:58.787

你的单元测试需要做的是设置这个函数正常工作的环境，换句话说，你通过设置其他变量来模拟系统正在运行，然后你应该能够知道它会根据如何返回您的单元测试设置了这些变量（当然，除非返回值是一个随机数，在这种情况下，正如 Randolpho 建议的那样，您所能做的就是确保它不会抛出）。

如果在这种设置和调用一大堆其他方法只是为了测试这个函数的情况下发现你的单元测试，这可能是一个很好的迹象，表明你的函数是紧密耦合的，你可以将它分解成更小的部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T21:24:21.183

有一个关于[依赖注入的](http://en.wikipedia.org/wiki/Dependency_injection)[谷歌技术讲座](http://www.youtube.com/watch?v=-FRm3VPhseI)。

基本上，创建可测试代码的理想方法是明确所有依赖项，这样您就不会遇到两次调用相同函数可能导致两个不同答案的情况。

在日期等情况下，如果您创建一个显式传递给您的函数的“系统对象”，那么您可以创建一个“测试系统对象”，它可以用于测试并且返回固定值而不是返回当前值日期。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T21:13:49.830

好吧，如果你使用单元测试，你就会知道你在哪一天、哪一个月和哪一年测试这个函数。

所以，调用函数。您有当前时间（运行测试时）。从函数时间中减去当前时间。差异应该非常小（例如 2 秒）。

如果差异大于此，我将无法通过测试。（当然取决于您系统的速度）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T21:14:30.440

看起来您可以在此函数上运行的唯一测试是它不会引发异常。无需测试返回数据，因为它是由外部实体（date() 函数）生成的。

# jquery - 使用 Google 托管的 jquery-ui.js 使主题在 jQueryUI 中工作时出现问题

> ID：481372
> 
> 赞同：7
> 
> 时间：2009-01-26T21:15:31.887
> 
> 标签：jquery, jquery-ui, themeroller

我是 jQueryUI 的新手，我认为我忽略了一些非常基本的东西......

### 快速描述我的问题

我使用[ThemeRoller](http://ui.jquery.com/themeroller)下载了一个 jQueryUI 主题，它还会生成一个 jQueryUI javascript 文件。我宁愿使用托管在 Google ( `http://ajax.googleapis.com/ajax/libs/jqueryui/1.5.3/jquery-ui.min.js`) 上的文件，但是当我这样做时，主题不会被拾取。我很难相信我必须使用 ThemeRoller 生成的脚本，因为如果是这种情况，那么 Google 托管的 jQueryUI 将完全没用！我在这里做错了什么？

* * *

### 更多细节

所以我从 Themeroller 下载了“Smoothness”主题如下：

1.  前往[ThemeRoller](http://ui.jquery.com/themeroller)网站。
2.  单击“图库”按钮。
3.  单击“平滑度”主题下方的“下载”按钮。
4.  将 .zip 文件（使用文件夹名称）解压缩到本地目录（例如`C:\jqueryui_test`）。

现在，我在同一个目录中创建了一个非常简单的`test.html`文件，其中包含以下内容：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link type="text/css" href="ui.all.css" rel="stylesheet" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.5.3/jquery-ui.min.js"></script>
<script type="text/javascript">
$(function() {
  $("#datepicker").datepicker({inline: true});
});
</script>
</head>
<body>
<div id="datepicker"></div>
</body>
</html> 
```

当我`test.html`在浏览器中打开时，日期选择器组件没有设置样式（没有背景图像或任何东西）。但是，如果我将 Google 托管的`jquery-ui.min.js`行更改为 ThemeRoller 生成的行 ( `<script type="text/javascript" src="jquery.ui.all.js"></script>`)，则页面的样式将符合预期。

* * *

**更新** 我接受的答案并不是真正的最终解决方案，但它引导我走上了正确的道路。事实证明，如果你只下载 JQueryUI，你会得到很多东西。Google 托管的文件可以只替换“jquery.ui.all.js”文件，但您仍然需要“themes”目录。另外，Themeroller 主题在 1.5.3 中不能很好地工作（甚至是“1.5.3 用户”链接）。因为这只是一个管理页面，我只使用了内置的“flora”主题。看起来 jQuery UI 1.6 更好，但它还不是“稳定”版本（在撰写本文时......）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T21:34:50.600

在这里复制了您的设置.. Themeroller 为您提供了`jQuery UI 1.6rc5`，而您所指的 Google 版本似乎是不同的版本（`1.5.3`？）.. 这可能是您问题的根源吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T21:26:57.293

前几天我的无线信号丢失了一会儿，我也遇到了类似的问题。您确定您可以访问 Google 吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T23:50:52.440

我已经确认这是一个错误或什么的。您必须使用主题滚动文件夹中的 jquery ui 版本，而不是 google AJAX api 版本。希望当 google 托管新的 jquery ui 文件时，这将得到解决。

# java - Java：在 Windows 和 Linux 上处理注销或关机

> ID：481379
> 
> 赞同：5
> 
> 时间：2009-01-26T21:16:59.730
> 
> 标签：java, windows, linux, swing

除了使用 JNI，Java GUI 应用程序是否有其他方法可以响应系统关闭或注销事件？（在 Windows 上，JNI 会在 Linux 上使用 WM_QUERYENDSESSION？）

该方法应该允许程序提示用户保存等，然后继续注销过程。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T21:25:46.813

据我所知，Java 无法捕捉系统关闭或注销事件。

[但是，您可以通过添加关闭挂钩](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#addShutdownHook(java.lang.Thread))来捕获 JVM 何时终止。

AWT 的[WindowAdapter](http://java.sun.com/javase/6/docs/api/java/awt/event/WindowAdapter.html)也有一个 windowClosing 事件，您可以覆盖并挂钩到您想要监视的窗口。Swing 继承了这一点；我相信 SWT 也是如此。请注意，如果您覆盖此事件，您必须手动处理窗口！

我相信 MS Windows 会在关闭时触发这些事件。我相信 Linux/UNIX 上的 SIGTERM 也是如此，尽管如果这是在关机期间，Linux 会在不久之后对应用程序发出 SIGKILL 信号。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T21:25:31.523

我认为 Runtime.getRuntime().addShutdownHook 应该提供您需要的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:28:23.827

您可以安排一个线程在 JVM 关闭时运行 - 请参阅[addShutdownHook()](https://docs.oracle.com/javase/1.5.0/docs/api/java/lang/Runtime.html#addShutdownHook(java.lang.Thread))。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T21:23:08.940

这并没有回答问题，而是解决了部分问题。

在 Unix GUI 会话中，我认为处理注销事件的正确方法是将文档保存到临时文件并将信息保存在会话状态中。在会话恢复期间，程序可以重新加载临时文件并从中断的地方开始。无需询问用户是否保存。

我只是希望更多的软件可以进行透明的会话保存和恢复。太多的程序以空文档窗口重新打开，因为使用的 GUI 框架做了那么多，但没有完成其余的工作来实际处理任何有意义的程序状态。

# delphi - 在 DELPHI 中将字段添加到克隆的 TClientDataset

> ID：481381
> 
> 赞同：3
> 
> 时间：2009-01-26T21:17:29.153
> 
> 标签：delphi

嗨，我有一个主控和克隆的 TClientData 集

```
CdsCloned.CloneCursor(CdsMaster,true); 
```

CdsMaster 有两个字段 'SessionId' 和 'UserID' CdsCloned 将有相同的字段

**问题：** 是否可以在不更改 CdsMaster 的情况下向 CdsCloned 添加额外字段？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-26T21:31:56.503

这里真的有两个问题：我可以添加一个额外的 TField，我可以添加一个额外的数据字段。

克隆客户端数据集游标时，最终会得到两个 TDataSet 实例，每个实例都有自己的 TField 集合，它们共享一个数据存储。您当然可以在不影响克隆的情况下为计算字段之类的内容添加额外的 TFields。这样做没有问题。

但请记住，原始数据集及其克隆共享一个数据存储。您无法在不影响其他数据集的情况下更改该数据存储。如果您将新字段添加到数据存储区，那么新数据将出现在原始数据集引用的存储区中，无论您是否创建了任何 TField 对象来读取/写入它。如果这开始听起来像个坏主意，那么我也是这么想的。

最后，如果您希望原始数据集及其“克隆”具有不同的数据存储，则可以分配 Data 属性而不是使用 CloneCursor。执行此操作时，原始数据将复制到“克隆”的数据存储中，但原始数据和“克隆”不再共享单个数据存储。

# sql - 从多对多设计中选择记录

> ID：481383
> 
> 赞同：0
> 
> 时间：2009-01-26T21:17:35.953
> 
> 标签：sql, tsql

一共有三个表，Students, Classes, Student_Class

是否可以不使用 NOT IN 选择未注册任何课程的学生？

例如，从 StudentID NOT IN 的学生中选择 studentname（从 Student_Class 中选择不同的 studentid）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T21:22:01.080

我真的不知道你为什么不想使用 NOT IN，但这是另一种选择......

```
SELECT Studentname
FROM Students
LEFT JOIN Student_Class ON Student_Class.StudentID = Student.ID
WHERE Student_Class.StudentID IS NULL 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T21:26:59.087

有以下三种方法：

1.  `SELECT StudentName FROM Students WHERE StudentID NOT IN (SELECT StudentID FROM StudentClass)`;
2.  `SELECT StudentName FROM Students s WHERE NOT EXISTS (SELECT StudentID FROM StudentClass WHERE StudentID = s.StudentID)`; 和
3.  `SELECT StudentName FROM Students s LEFT OUTER JOIN StudentClass sc ON s.StudentID = sc.StudentID WHERE sc.StudentID IS NULL)`.

而且我真的不会使用（3）。所以选一个。

`WHERE EXISTS`/`WHERE NOT EXISTS`通常比`IN`/更受欢迎`NOT IN`。现代优化器可能会在很多时候优化 (1) 和 (2) 以保持相同。值得比较性能（重要时）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T21:25:47.170

```
Select studentname from Students s Where s.studentid NOT EXISTS (Select 1 From Student_Class sc where sc.studentid = s.studentid) 
```

# javascript - 加载 Javascript 的最佳实践

> ID：481385
> 
> 赞同：3
> 
> 时间：2009-01-26T21:17:56.220
> 
> 标签：javascript, onload

处理分布在许多页面上的几种不同 onload 脚本的最佳方法是什么？

例如，我有 50 个不同的页面，当 dom 准备好时，我想在每个页面上设置不同的按钮单击处理程序。

最好在每个单独的页面上设置这样的点击次数，

```
<a id="link1" href="#" onclick="myFunc()" />

```

或者外部js文件中很长的文档准备功能，

```
Element.observe(window, 'load', function() {
  如果（$（'link1'））{
    // 设置点击处理程序
  }
  如果（$（'link2'））{
   // 设置点击处理程序
  }
  ...
}

```

或者将每个`if ($('link')) {}`部分拆分为脚本标签并将它们放在适当的页面上，

或者最后，将每个`if ($('link')) {}`部分拆分为自己单独的 js 文件并在每个页面上适当加载？

解决方案 1 看起来最不优雅并且相对突兀，解决方案 2 将导致非常冗长的加载功能，解决方案 3 没有 1 那么突兀，但仍然不是很好，解决方案 4 将加载要求用户下载单独的 js 文件他访问的页面。

这些中的任何一个是最好的（或最差的）还是有我没有想到的解决方案 5？

*编辑：我问的是设计模式，而不是哪个 onload 函数是合适的。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T21:40:16.283

您是否考虑过为要附加到元素的每种行为类型创建一个类？这样你就可以在页面之间重用功能，以防有重叠。

例如，假设在某些页面上，您想要一个按钮，该按钮会在页面上弹出一些额外的信息。您的 html 可能如下所示：

```
<a href="#" class="more-info">More info</a> 
```

您的 JavaScript 可能如下所示：

```
jQuery(".more-info").click(function() { ... }); 
```

如果您坚持某种约定，您还可以将多个类添加到链接中，并在需要时让它做一些不同的事情（因为 jQuery 将允许您在元素上堆叠事件处理程序）。

基本上，您关注的是要附加 JavaScript 的每种元素的行为，而不是挑选要附加功能的元素的特定 ID。

我还建议将所有 JavaScript 放入一个公共文件或有限数量的公共文件中。主要原因是，在第一个页面加载后，JavaScript 将被缓存，不需要在每个页面上加载。另一个原因是它会鼓励您为整个站点中可用的按钮开发通用行为。

无论如何，我不鼓励直接在 html 中附加 onlick（选项 #1）。它很突兀，并限制了您使用 JavaScript 的灵活性。

编辑：我没有意识到 Diodeus 发布了一个非常相似的答案（我同意）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T21:21:23.467

如果可能的话，我会使用[JQuery 的](http://docs.jquery.com/How_jQuery_Works) *文档*

```
 $(document).ready(function() {

      // jQuery goodness here.
 }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:32:00.480

首先我不明白为什么你认为设置事件监听器是突兀的？

但 ...

解决方案一是个坏主意

```
<a id="link1" href="#" onclick="myFunc()" /> 
```

因为你应该把你的化妆和你的剧本分开。

解决方案二是个坏主意

```
Element.observe(window, 'load', function() {
  if ($('link1')) {
    // set click handler
  }
  if ($('link2')) {
   // set click hanlder
  }
  ...
} 
```

因为您为每个页面使用了大量不需要的 javascript。

解决方案三是一个坏主意，原因与我说解决方案一是一个坏主意的原因相同。

解决方案 4 是最好的主意，是的，它每页有一个额外的负载，但是如果对于每个页面，您只需拆分每个 if ($('link')) {} 部分，文件大小就不会那么大吗？另外，如果你把这段代码从全局 javascript 中取出，那么它的加载时间将会减少。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T21:39:29.500

您可以破解类名并以创造性的方式使用它：

```
<a class="loadevent functionA" id="link1" href="#" onclick="myFunc()" /> 
```

...在另一页上...

```
<a class="loadevent functionB" id="link1" href="#" onclick="myFunc()" /> 
```

您可以按类名“ **loadevent** ”选择并获取该标记的其他类名，其他类名是您要挂钩的实际函数名。这样一个处理程序就可以处理每一页，而您所要做的就是提供相应的类名。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T21:34:05.017

虽然 Chris 在某种程度上是正确的，但您可以这样做：

```
$(document.ready(function() {
  // A
});
$(document.ready(function() {
  // B
});
$(document.ready(function() {
  // C
}); 
```

并且所有函数都将被调用（按照它们遇到的顺序），值得一提的是，ready() 事件与 onload() 并不完全相同。来自[jQuery API 文档](http://docs.jquery.com/Events/ready)：

> 绑定要在 DOM 准备好被遍历和操作时执行的函数。

您可能需要[load()](http://docs.jquery.com/Events/load#fn)事件：

```
$(document).load(function() {
  // do stuff
}); 
```

这将等待加载图像等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T21:39:48.763

如果不使用膝跳 jQuery，如果页面变化的 JS 相对较轻，我会将其包含在类似于 #4 的内联标题脚本（绑定到 onload 事件触发器，是的）中，但我不会将其作为单独的 JS脚本和下载，我希望通过服务器端包含来处理这个问题 - 但是你想处理它（我？我会选择 XSLT 包含）。

这既为您提供了高度的模块化分离，又使下载尽可能轻。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T22:34:44.927

有很多不同的页面，我会允许对这些页面进行不同的事件处理......

但是，如果差异很小，我会尝试找到一个我可以坚持的模式，并且可能会制作一个真正简单的算法来区分页面......

如果我不打算以任何其他方式使用它，我会求助的最后一件事是使用（大）库（jquery、mootools 或其他任何东西！-）......

现在您正在谈论最佳实践，最佳实践始终是您的用户将体验到的最轻量级的解决方案，因此，应该以尽可能广泛的方式理解用户，包括维护该站点的开发人员等！ o]

# sql - @@IDENTITY, SCOPE_IDENTITY(), OUTPUT and other methods of retrieving last identity

> ID：481395
> 
> 赞同：64
> 
> 时间：2009-01-26T21:19:38.447
> 
> 标签：sql, sql-server, tsql, identity, output-clause

I have seen various methods used when retrieving the value of a primary key identity field after insert.

```
declare @t table (
    id int identity primary key,
    somecol datetime default getdate()
)
insert into @t
default values

select SCOPE_IDENTITY() --returns 1
select @@IDENTITY --returns 1 
```

Returning a table of identities following insert:

```
Create Table #Testing (  
    id int identity,  
    somedate datetime default getdate()  
)  
insert into #Testing  
output inserted.*  
default values 
```

What method is proper or better? Is the OUTPUT method scope-safe?

The second code snippet was borrowed from [SQL in the Wild](http://sqlinthewild.co.za/index.php/2008/12/31/on-the-output-of-a-data-modification/#more-124)

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-01-26T21:28:17.307

It depends on what you are trying to do...

@@IDENTITY

Returns the last IDENTITY value produced on a connection, regardless of the table that produced the value, and regardless of the scope of the statement that produced the value. @@IDENTITY will return the last identity value entered into a table in your current session. @@IDENTITY is limited to the current session and is not limited to the current scope. For example, if you have a trigger on a table that causes an identity to be created in another table, you will get the identity that was created last, even if it was the trigger that created it.

SCOPE_IDENTITY()

Returns the last IDENTITY value produced on a connection and by a statement in the same scope, regardless of the table that produced the value. SCOPE_IDENTITY() is similar to @@IDENTITY, but it will also limit the value to your current scope. In other words, it will return the last identity value that you explicitly created, rather than any identity that was created by a trigger or a user defined function.

IDENT_CURRENT()

Returns the last IDENTITY value produced in a table, regardless of the connection and scope of the statement that produced the value. IDENT_CURRENT is limited to a specified table, but not by connection or scope.

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-09-15T14:47:28.070

请注意，有一个错误`scope_identity()`-`@@identity`请参阅 MS Connect：[https ://web.archive.org/web/20130412223343/https://connect.microsoft.com/SQLServer/feedback/details/328811/scope-identity-sometimes -返回不正确的值](https://web.archive.org/web/20130412223343/https://connect.microsoft.com/SQLServer/feedback/details/328811/scope-identity-sometimes-returns-incorrect-value)

引用（来自微软）：

> 我强烈建议在所有情况下都使用`OUTPUT`而不是。`@@IDENTITY`这只是读取身份和时间戳的最佳方式。

编辑添加：现在可能已修复。Connect 给我一个错误，但请参阅：

[Scope_Identity() 返回不正确的值已修复？](https://stackoverflow.com/questions/7562917/scope-identity-returning-incorrect-value-fixed)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2014-12-08T18:53:48.413

`OUTPUT`在尝试获取刚插入的行的标识时，几乎没有理由使用除子句之外的任何内容。OUTPUT 子句是范围和表安全的。

这是插入单行后获取 id 的简单示例...

```
DECLARE @Inserted AS TABLE (MyTableId INT);

INSERT [MyTable] (MyTableColOne, MyTableColTwo)
OUTPUT Inserted.MyTableId INTO @Inserted
VALUES ('Val1','Val2')

SELECT MyTableId FROM @Inserted 
```

OUTPUT 子句的详细文档：[http ://technet.microsoft.com/en-us/library/ms177564.aspx](http://technet.microsoft.com/en-us/library/ms177564.aspx)

* * *

```
-- table structure for example:     
CREATE TABLE MyTable (
    MyTableId int NOT NULL IDENTITY (1, 1),
    MyTableColOne varchar(50) NOT NULL,
    MyTableColTwo varchar(50) NOT NULL
) 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-26T21:22:19.767

@@Identity is the old school way. Use SCOPE_IDENTITY() in all instances going forward. See [MSDN](http://msdn.microsoft.com/en-us/library/ms190315.aspx) for the repercussions of using @@IDENTITY (they're bad!).

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-26T22:25:58.220

SCOPE_IDENTITY 对于单行就足够了，建议您使用，除非您出于某种原因需要查看中间 TRIGGER 的结果（为什么？）。

对于多行，OUTPUT/OUTPUT INTO 是您最好的新朋友，也是重新查找行并插入另一个表的替代方法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-26T21:22:18.270

There is another method available in SQL Server 2005 that is outlined [in SQL in the Wild](http://sqlinthewild.co.za/index.php/2008/12/31/on-the-output-of-a-data-modification/#more-124).

This will allow you to retrieve multiple identities after insert. Here's the code from the blog post:

```
Create Table #Testing (  
    id int identity,  
    somedate datetime default getdate()  
)  
insert into #Testing  
output inserted.*  
default values 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-26T21:33:09.370

对戈德克的回答的一个小修正：

您需要担心的不仅仅是触发因素。导致创建标识符的任何类型的嵌套操作（例如存储过程）都可能更改@@IDENTITY 的值。

对 scope_identity 的另一票...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-11-02T15:07:41.700

使用@@IDENTITY 时要小心...

[http://dotnetgalactics.wordpress.com/2009/10/28/scope-identity-vs-identity/](http://dotnetgalactics.wordpress.com/2009/10/28/scope-identity-vs-identity/)

# .net - 遗留数据库上的 NHibernate

> ID：481397
> 
> 赞同：7
> 
> 时间：2009-01-26T21:19:59.600
> 
> 标签：.net, database, nhibernate, orm, legacy-code

我很惭愧，但我不得不说。我没有使用过ORM。我真的在考虑 NHibernate，因为它似乎是最成熟的 .Net 产品（如果我错了，请纠正我）。现在，问题是我们有一个以 SqlServer 作为主要集成点的大型电子商务/预订系统，在存储过程中包含相当多的业务逻辑。现在 - 显然 - 这种架构是我们想要摆脱的东西，我们已经这样做了一段时间，一点一点。所以，我真正的问题是，开始使用 NHibernate 来开发新功能而不是返回并映射所有遗留的东西有多可行？这种渐进式的引入和ORM是否支持，如果支持，你会推荐吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T22:15:19.007

如果您使用的是遗留数据库，您会发现 ORM 工具相当难以使​​用、配置、维护和优化。当我们使用 NHibernate 将我们的域模型映射到现有数据库时，我们遇到了许多问题。其中一些是：

1.  模型对象很难映射到现有的表（我们有超过 100 个表），NHibernate 的一些要求非常突出，例如每个表都必须有一个 ID 字段才能映射到域对象。此外，映射多对多关系非常难以掌握和使用。

2.  维护映射到遗留数据库所需的大量映射 XML 成为开发人员的全职工作，并且非常具有挑战性，特别是在 10 多名开发人员的团队中。

3.  随着复杂性的增加，我们的查询性能下降，因为数据模型和对象模型并不总是与业务匹配并且需要不断调整。必须编写大量数据聚合代码。例如，如果我们需要显示一个连接多个表的网格，我们过去必须加载多个域对象，将它们放在一起并显示在一个网格中。该代码很难维护和调试。

4.  此外，有时我们必须运行匿名查询，即我们只需要一些对象的一些属性而不是整个对象。这真的很难编写、维护甚至实现，并且违背了 ORM 范式，但我们别无选择，只能这样做。

5.  我们遇到的另一个问题是数据库不断变化，因为 DBA 会重构表，这总是会破坏我们的域对象。保持模型和表格同步并确保应用程序仍然有效是一项练习。

长话短说……我们了解到，如果有一种方法可以将业务所需的 SQL 直接映射到我们的 UI 模型或域对象而无需担心配置，那将是一个更好的解决方案。

在经历了这些经验之后，我们开发了 Orasis Mapping Studio。它是一种专门设计用于处理遗留数据库以及现有 .NET 模型/域对象的映射工具。它采用您的 SQL 查询，并允许您通过以图形方式显示查询和对象的元数据并使用拖放创建对象属性和查询列之间的映射，将它们映射到现有的 .NET 对象。该工具会自动生成执行映射以读取对象所需的所有 ADO.NET 代码。然后，您可以在 DAL 层中使用生成的代码或使用生成的程序集来检索和保存您的数据。

您可以在这里尝试：[Orasis Mapping Studio](http://www.orasissoftware.com/Products.aspx)。它是我们认为开发人员真正需要的工具，特别适用于处理遗留数据库以及性能是关键要求的地方。它是由开发人员为开发人员编写的，因此它处理了一些复杂的细节，如对象继承、嵌套对象、数据类型转换等。祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T21:30:54.167

这将取决于您当前数据库的“NHibernate 友好”程度。NHibernate 喜欢单列主键（如果它们都被命名为“id”就更好了）。据我所知，大多数 ORM 对存储过程都不是很友好。您是否考虑过如何定义传输对象以从数据库来回获取数据？

顺便说一句，没有什么可耻的。ORM 是个好东西，但你试图找到最好的方法是对的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:31:47.843

我没有亲自这样做过，但是您可以将命名查询中的存储过程复制粘贴到映射文件中，然后再将它们一一删除。

如果您对 ORM 没有任何经验，可能很难在大型遗留项目中开始学习它，因为您必须发现 ORM 的所有非标准特性，这些特性不会在新建项目中使用，或者使用一年只有一次。NHibernate 有很多选项来支持遗留数据库。

当你准备好跨越学习曲线并勇敢地开始使用新技术时，你可以从 NHibernate 开始，但是如果你想逐步学习新技术，我会等到 NHibernate 开始一个新的未开发项目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T21:31:56.863

任何体面的 ORM 工具都应该支持渐进式集成。这里的技巧是在 DAO 级别（数据访问对象层）进行明确的分离。如果您可以通过定义明确的 API 隐藏您的数据访问怪癖，那么您是否使用 ORM 并不重要。

话虽如此，ORM 引入的复杂性与表模型的复杂性直接相关。对于同一个表，您可以有许多不同的映射，只需确保您事先进行了一些试验，以了解 ORM 解决方案的怪癖，例如对象缓存、后写查询、代理访问等。**ORM 解决方案的真正好处是使用对象而不是虚拟 POJO 类。这使得对业务进行更改比使用存储过程或平面对象容易得多。**

作为旁注，我参与了一个项目，我们将 sprocs 中的整个应用程序迁移到 java。虽然我们没有使用 sproc，但真正的痛苦是 sprocs 架构没有很好地定义，许多 sprocs 调用其他 sprocs 使得一次只迁移一些 sprocs 变得非常困难。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T21:32:18.280

NHibernate 中没有任何东西会限制你这样做。在某些时候，您可能希望将旧代码转换为也使用 NHibernate，因为在您可以导航所有对象之间的关系之前，您不会看到 ORM 的全部好处。

最大的挑战可能是让您的旧表结构适合 NHibernate 的每类单表方法。有一些方法可以解决这个问题，但这可能很棘手。不过，我认为这是值得的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T15:19:53.197

您曾提到您正在远离您当前的架构，但是您是否需要坚持您的遗留数据库设计（例如，DBA 严格负责设计和维护它）或者您当前的数据库设计是否正在重构（考虑到 O /R 映射器）以及？

如果很难摆脱当前的遗留设计，您可能会考虑使用普通的旧 T-SQL 查询，而不是不太灵活的 Hibernate 样式，使用[iBATIS](http://ibatis.apache.org) SqlMap 来将实体 O/R 映射到遗留数据库。映射数据的 XML/属性。

根据您希望如何进行设计，您可以通过使用您自己的抽象[DAO](http://en.wikipedia.org/wiki/Data_Access_Object)工厂或[iBATIS](http://ibatis.apache.org/docs/dotnet/datamapper/index.html) [DataAccess API](http://ibatis.apache.org/docs/dotnet/dataaccess/index.html)（本质上就是这样做的，并且仍然与N休眠。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-28T16:48:54.107

我同意艾哈迈德所说的话，我过去也遇到过类似的问题。我遇到的大部分麻烦不是来自技术本身，而是来自开发人员的采用，改用 NHibernate 意味着工作习惯的改变，至少可以说，这并不总是那么容易。

如果您是 ORM 新手，那么使用它开始一个全新的项目可能比尝试转换旧项目更好。

我将遗留项目转换为 ORM 的建议是尝试使用某种生成工具，如 LLBGen 或 .netTiers 甚至 Linq2SQL。通过这种方式，您可以更轻松地使用 ORM，而无需 NHibernate 可能强加的创伤性重写。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T21:26:37.620

为什么存储的过程“明显”不好？存储过程中的业务逻辑是否会引起痛苦？

Microsoft 似乎有许多可用的持久性技术（例如，LINQ）。我不知道如何评估它们与 NHibernate，但我不会推荐 ORM，除非你有非常好的对象可以映射到。

# c# - 为什么不能使用 Removed 方法删除通用列表中的项目？

> ID：481402
> 
> 赞同：0
> 
> 时间：2009-01-26T21:20:57.430
> 
> 标签：c#, .net, generics, list

我有这堂课。

```
public class Foo
{
    public Guid Id { get; set; }

    public override bool Equals(object obj)
    {
        Foo otherObj = obj as Foo;

        return otherObj == null && otherObj.Id == this.Id;
    }

    public override int GetHashCode()
    {
        return this.Id.GetHashCode();
    }
} 
```

你可以看到我覆盖了这个对象的 Equals 和 GetHashCode。

现在我运行以下代码片段

```
// Create Foo List
List<Foo> fooList = new List<Foo>();

fooList.Add(new Foo { Id = Guid.NewGuid()});
fooList.Add(new Foo { Id = Guid.NewGuid()});
fooList.Add(new Foo { Id = Guid.NewGuid()});
fooList.Add(new Foo { Id = Guid.NewGuid()});
fooList.Add(new Foo { Id = Guid.NewGuid()});

// Keep Id of last Create
Guid id = Guid.NewGuid();

fooList.Add(new Foo { Id = id });

Console.WriteLine("List Count {0}", fooList.Count);

// Find Foo in List
Foo findFoo = fooList
    .Where<Foo>(item => item.Id == id)
    .FirstOrDefault<Foo>();

if (findFoo != null)
{
    Console.WriteLine("Found Foo");

    // Found Foo now I want to delete it from list
    fooList.Remove(findFoo);
}

Console.WriteLine("List Count {0}", fooList.Count); 
```

运行时找到 foo ，但列表不会删除找到的项目。

为什么是这样？我认为覆盖 Equals 和 GetHashCode 应该解决这个问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T21:23:27.783

```
return otherObj == null && otherObj.Id == this.Id; 
```

那是对的吗？难道不应该

```
return otherObj != null && otherObj.Id == this.Id; 
```

# c# - 注册时的 ASP.NET 成员资格问题

> ID：481416
> 
> 赞同：-1
> 
> 时间：2009-01-26T21:22:47.207
> 
> 标签：c#, asp.net, asp.net-3.5, membership-provider

我在这个会员资格的东西上度过了一段艰难的时光。

好的，所以，这真的很奇怪。我可以注册一个用户。我可以注册，我可以登录。但是，当我去注册另一个用户时，该用户没有保存在数据库中，并且当用户尝试登录时，我收到了会员凭据验证失败事件（我假设是因为用户从未被保存）。

这是我用来保存新用户的代码。

在页面上：

```
protected void btnRegister_Click(object sender, EventArgs e)
    {
        if (false == ValidatePage()) return;
        FormsAuthentication.SignOut();
        MembershipCreateStatus status;
        Data.User user = UserManager.CreateUser(txtEmail.Text.Trim(), txtPassword.Text.Trim(), out status);

        switch (status)
        {
            case MembershipCreateStatus.Success:
                UserManager.Save(user);
                break;
            default:
                lblMessage.Text = status.ToString();
                break;
        }

        Response.Redirect("~/login.aspx");
    } 
```

CreateUser 方法：

```
public static User CreateUser(string username, string password, out MembershipCreateStatus status)
    {
        using (TransactionScope transaction = new TransactionScope())
        {
            MembershipUser aspnetUser = Membership.CreateUser(username, password, username, null, null, true, out status);

            User hqUser = null;

            if (status == MembershipCreateStatus.Success)
            {
                hqUser = new User();

                //these properties are only for issues
                //that won't blow up.  They can be safely removed from the system.
                //the aspnet membership tables take care of this stuff for us.
                hqUser.LastLoginDate = DateTime.Now;
                hqUser.DateCreated = DateTime.Now;
                //end properites.

                hqUser.Email = username;
                hqUser.MembershipID = (Guid)aspnetUser.ProviderUserKey;
                Save(hqUser);
            }

            transaction.Complete();
            return hqUser; 
```

}}

额外的保存方法用于将用户保存在应用程序的数据库中。用户没有进入会员数据库，所以我知道它在那之前就死了。

有没有人看到任何明显让我着迷的东西？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T21:34:12.287

您是否检查过这不是密码复杂性的问题？我知道我过去遇到过这个问题......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T22:34:43.960

如果状态不等于成功，则在您能够看到输出之前重定向页面。

顺便提一句。继承 sqlmembership 提供程序并使用您自己的额外数据库插入扩展它可能会更好，至少在您不插入额外数据的情况下。还是您在首次创建帐户时要求的不仅仅是默认内容？

试试这个代码，看看lblMessage中枚举的值是什么

受保护的无效btnRegister_Click（对象发送者，EventArgs e）{

```
 if (!ValidatePage()) return;

        FormsAuthentication.SignOut();
            MembershipCreateStatus status;
            Data.User user = UserManager.CreateUser(txtEmail.Text.Trim(), txtPassword.Text.Trim(), out status);
            switch (status) { 
        case MembershipCreateStatus.Success:
                            UserManager.Save(user);
            Response.Redirect("~/login.aspx");
                            break;
                    default:
                            lblMessage.Text = status.ToString();
                            break;
            }       

    } 
```

grrgr，愚蠢的标记

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T21:26:47.217

我的第一个猜测是`ValidatePage()`返回 false。

# actionscript-3 - 将 AS2 SWF 加载到 AS3 SWF 中并在 URL 中传递变量

> ID：481433
> 
> 赞同：3
> 
> 时间：2009-01-26T21:25:47.123
> 
> 标签：actionscript-3, url, actionscript-2, params

我有一个 AS3 SWF，我将把其他 SWF 加载到其中。这些子 SWF 都采用 URL 上的单个参数。加载 AS2 孩子时，我似乎无法让它工作，它需要能够同时处理这两者。

所以我有

```
var request:URLRequest = new URLRequest();
var loader:URLLoader = new URLLoader();

request.url = "http://domain/as2.swf?param=foo";
loader.load(request);
// etc on to the eventListeners, addChild, etc 
```

当 as2 SWF 被加载时，它看不到我传递给它的参数。它正在寻找 _root.param。我做错了还是在尝试不可能的事情？

编辑：我应该补充一点，我可以从 AS2 加载器加载带有这些 URL 参数的 SWF，它工作得很好。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T22:10:44.723

AS2 和 AS3 之间的通信并非易事，因为它们在不同的虚拟机中运行。检查此[http://www.gskinner.com/blog/archives/2007/07/swfbridge_easie.html](http://www.gskinner.com/blog/archives/2007/07/swfbridge_easie.html)以获取一些提示。

编辑：如果您无法更改加载的 as2 内容，您唯一的选择是创建一个“包装器”as2 加载器，该加载器使用上面的链接示例与 as3 通信，并使用 _root.varname 与加载的 as2 内容进行接口这并不漂亮，但它可能只是工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T07:02:17.523

在 SWF 加载之后但在将其添加到舞台之前，尝试动态分配变量可能是值得的。IE。

```
loader.contentLoaderInfo.addEventListener(Event.COMPLETE, movieLoaded);

function movieLoadedHandler(event : Event) : void
{
    var loaderInfo : LoaderInfo = event.target as LoaderInfo;
    var clip : DisplayObject = loaderInfo.content;

    for each(var prop in varsToTransfer)
    {
        clip[prop] = varsToTransfer[prop];
    }

    // add to parent
} 
```

让我知道情况如何。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-22T13:30:39.093

AS3 -> AS3

电影 1(www.domain1.com)：单击“购买”按钮时加载外部电影...

```
buy.addEventListener(MouseEvent.CLICK,function(){                   
    var ldr:Loader = new Loader();
    var url:String = "http://www.domain2.com/movie.swf?a=b&c=d";
    var urlReq:URLRequest = new URLRequest(url);
    ldr.load(urlReq);
    addChild(ldr);
    }); 
```

电影 2（[http://www.domain2.com/movie.swf](http://www.domain2.com/movie.swf)）：

```
var mc:MovieClip = this as MovieClip;
var ldi:LoaderInfo = mc.loaderInfo;
var lobj:Object = ldi.parameters as Object;

for (var l in lobj) {
    dumper.htmlText += l+" => "+lobj[l]+"<br />";
} 
```

“dumper”是位于 Movie2 中的动态文本框字段的名称。输出应如下所示：

```
a => b
c => d 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-27T01:12:11.610

而不是寻找 _root.param，使用 _root._url 然后手动解析出你的参数。

```
var url: String = _root._url;
var param: String = 'param=';
var paramStart: Number = url.lastIndexOf(param);
var paramValue: String = url.substring(paramStart + param.length, url.length);
trace(paramValue); 
```

对于这样的事情，SWFBridge 非常棒而且矫枉过正。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-26T21:47:05.223

你这样做是不对的。

" [http://domain/as2.swf?param=foo](http://domain/as2.swf?param=foo) "

是对名为**domain**的服务器上名为**as2.swf**的文件的请求。当请求完成时，作为该 http 请求一部分的任何**?param=foo**参数都会丢失。如果服务器需要根据这些变量做某事，它会，但是你要求一个**.swf**文件来检测这些变量，这很愚蠢。

 ******在 Flash 播放器的全局对象（全局命名空间）中放置一个变量，然后当 as2 .swf 加载到该 Flash 播放器中时，它将可以访问您在全局对象中设置的变量。

我不精通 as2，但是在 as3 中，可以在包级别使用**this**关键字访问 Global 对象（可能与 as2 相同，只是不用担心在包级别设置它）。

# iphone - 您在 iPhone/iPod Web 开发中使用了哪些调试技术？

> ID：481436
> 
> 赞同：6
> 
> 时间：2009-01-26T21:25:53.520
> 
> 标签：iphone, debugging, ipod-touch

我正在开发一个 Web 应用程序，我们的目标是 iPhone 和 iPod Touch。我熟悉 FireFox 和 IE 的调试工具（例如 Firebug 和 IE Developer Toolbar），但我找不到任何 iPod 的调试工具。我不期待将其`alert`用作我的主要调试工具，尤其是当我认为鼠标事件是主要问题之一时。

这真的是最先进的吗[？](http://www.joehewitt.com/blog/firebug_for_iph.php)你推荐什么工具？

另外，iPhone 上的 html 布局与在 Windows 上运行的 Safari 的相似度如何？在 Mac 上？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T23:26:12.123

iPhone 版本的 Safari 包含一个非常方便的调试控制台。设置 > Safari > 开发人员。

您还可以使用 iPhone SDK 中的模拟器。没有额外的调试，但比一直使用物理设备更容易。

您还可以将 Safari 的桌面版本用于许多事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-16T06:09:18.870

针对 iPod Touch 和 iPhone 领域的网络工具包括

[iPhone 远程调试控制台]( <a href="http://code.google.com/p/iphonedebug/" rel="nofollow noreferrer">http://code.google.com/p/iphonedebug/)

[用于 Windows 的 BlackBaud 模拟器](http://labs.blackbaud.com/NetCommunity/article?artid=662)

[MobileSafari 模拟器]( <a href="http://www.testiphone.com/" rel="nofollow noreferrer">http://www.testiphone.com/)

[iPhoney]( <a href="http://marketcircle.com/iphoney/" rel="nofollow noreferrer">http://marketcircle.com/iphoney/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-12T19:10:00.583

虽然[WebKit 有一个远程检查器](http://www.webkit.org/blog/1620/webkit-remote-debugging/)，但很难在实际的 iOS 设备上启用（至少没有越狱），因此它的大多数工具都是仅限模拟器的。[iWebInspector](http://www.iwebinspector.com/)看起来很有希望，但请记住模拟器的 WebKit 库与设备的不同。

这就是**[weinre](http://phonegap.github.com/weinre/)**的用武之地。使用 weinre，您可以“从笔记本电脑调试手机上显示的网页”。它的工作原理是运行它的自定义 HTTP 服务器，该服务器托管两件事：

*   包含在要调试的页面上的 JavaScript 文件
*   您在要从中调试的机器上加载的 Inspector 页面

例如，您启动服务器`java -jar Downloads/weinre.jar --boundHost -all- --httpPort 4242`，然后`<script src="http://weinre-server-name.local:4242/target/target-script-min.js">`在您的网页的源代码中放置一个脚本标签，并通过导航到例如[http://weinre-server-name.local:4242/client](http://weinre-server-name.local:4242/client)来加载检查器。当您通过本地 WiFi 连接在 iPhone 上加载目标页面时，该连接将显示在大型机的客户端页面中，您可以使用 Inspector 选项卡在 iPhone 上查看/编辑页面。

它有一些限制（没有 Javascript 断点等）并且可能有点滞后，但总的来说它非常神奇。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-12T09:06:42.447

还有一个很好的工具叫做 iWebInspector [http://www.iwebinspector.com/](http://www.iwebinspector.com/)

> ID：481444
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# java - 在 finally 块中抛出异常

> ID：481446
> 
> 赞同：101
> 
> 时间：2009-01-26T21:28:22.080
> 
> 标签：java, exception, try-catch, finally

有没有一种优雅的方法来处理`finally`块中抛出的异常？

例如：

```
try {
  // Use the resource.
}
catch( Exception ex ) {
  // Problem with the resource.
}
finally {
   try{
     resource.close();
   }
   catch( Exception ex ) {
     // Could not close the resource?
   }
} 
```

你如何避免块中的`try`/ ？`catch``finally`

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-26T21:55:35.347

我通常这样做：

```
try {
  // Use the resource.
} catch( Exception ex ) {
  // Problem with the resource.
} finally {
  // Put away the resource.
  closeQuietly( resource );
} 
```

别处：

```
protected void closeQuietly( Resource resource ) {
  try {
    if (resource != null) {
      resource.close();
    }
  } catch( Exception ex ) {
    log( "Exception during Resource.close()", ex );
  }
} 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-26T23:16:37.680

我通常使用以下`closeQuietly`方法之一`org.apache.commons.io.IOUtils`：

```
public static void closeQuietly(OutputStream output) {
    try {
        if (output != null) {
            output.close();
        }
    } catch (IOException ioe) {
        // ignore
    }
} 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2012-02-09T06:55:52.443

如果您使用的是 Java 7，并且`resource`implements `AutoClosable`，您可以这样做（以 InputStream 为例）：

```
try (InputStream resource = getInputStream()) {
  // Use the resource.
}
catch( Exception ex ) {
  // Problem with the resource.
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-06-14T08:57:23.683

可以说有点过头了，但如果你让异常冒泡并且你不能从你的方法中记录任何东西（例如，因为它是一个库，你宁愿让调用代码处理异常和日志记录），这可能很有用：

```
Resource resource = null;
boolean isSuccess = false;
try {
    resource = Resource.create();
    resource.use();
    // Following line will only run if nothing above threw an exception.
    isSuccess = true;
} finally {
    if (resource != null) {
        if (isSuccess) {
            // let close throw the exception so it isn't swallowed.
            resource.close();
        } else {
            try {
                resource.close();
            } catch (ResourceException ignore) {
                // Just swallow this one because you don't want it 
                // to replace the one that came first (thrown above).
            }
        }
    }
} 
```

更新：我对此进行了更多研究，并从比我清楚地考虑过这一点的人那里找到了一篇很棒的博客文章：http: [//illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make -mess-of-stream.html](http://illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make-mess-of-stream.html) 他更进一步，将两个异常合二为一，我认为这在某些情况下很有用。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-04-09T16:06:02.077

从 Java 7 开始，您不再需要在**finally**块中显式关闭资源，而是可以使用**try** -with-resources 语法。try-with-resources 语句是声明一个或多个资源的 try 语句。资源是程序完成后必须关闭的对象。try-with-resources 语句确保每个资源在语句结束时关闭。任何实现 java.lang.AutoCloseable 的对象，包括所有实现 java.io.Closeable 的对象，都可以用作资源。

假设以下代码：

```
try( Connection con = null;
     Statement stmt = con.createStatement();
     Result rs= stmt.executeQuery(QUERY);)
{  
     count = rs.getInt(1);
} 
```

如果发生任何异常，将以与创建它们相反的顺序对这三个资源中的每一个调用**close方法。**这意味着将首先为 ResultSetm 调用 close 方法，然后是 Statement，最后是 Connection 对象。

同样重要的是要知道自动调用 close 方法时发生的任何异常都会被抑制。这些被抑制的异常可以通过**Throwable**类中定义的**getsuppressed()方法检索。**

 **来源：[https ://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html](https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-02-09T20:45:01.193

忽略在“finally”块中发生的异常通常是一个*坏主意*，除非人们知道这些异常将是什么以及它们将代表什么条件。在正常`try/finally`使用模式中，`try`块将事物置于外部代码不期望的状态，并且`finally`块将这些事物的状态恢复为外部代码期望的状态。捕获异常的外部代码通常会期望，尽管有异常，但一切都已恢复到`normal`状态。例如，假设某些代码启动了一个事务，然后尝试添加两条记录；“finally”块执行“如果未提交则回滚”操作。调用者可能已准备好在执行第二个“添加”操作期间发生异常，并且可能期望如果它捕获此类异常，则数据库将处于尝试任一操作之前的状态。但是，如果在回滚期间发生第二个异常，则如果调用者对数据库状态做出任何假设，则可能会发生不好的事情。回滚失败代表了一个*重大*危机——不应被期望仅仅“添加记录失败”异常的代码捕获。

我个人的倾向是让 finally 方法捕获发生的异常并将它们包装在“CleanupFailedException”中，认识到此类失败代表一个主要问题，不应轻易捕获此类异常。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-26T21:35:11.753

一种解决方案，如果两个异常是两个不同的类

```
try {
    ...
    }
catch(package1.Exception err)
   {
    ...
   }
catch(package2.Exception err)
   {
   ...
   }
finally
  {
  } 
```

但有时你无法避免第二次尝试捕捉。例如用于关闭流

```
InputStream in=null;
try
 {
 in= new FileInputStream("File.txt");
 (..)// do something that might throw an exception during the analysis of the file, e.g. a SQL error
 }
catch(SQLException err)
 {
 //handle exception
 }
finally
 {
 //at the end, we close the file
 if(in!=null) try { in.close();} catch(IOException err) { /* ignore */ }
 } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-26T21:42:03.377

为什么要避免附加块？由于 finally 块包含可能引发异常的“正常”操作，并且您希望 finally 块完全运行，因此您必须捕获异常。

如果你不希望 finally 块抛出异常并且你不知道如何处理异常（你只会转储堆栈跟踪）让异常在调用堆栈中冒泡（从 finally 中删除 try-catch堵塞）。

如果你想减少打字，你可以实现一个“全局”外部 try-catch 块，它将捕获 finally 块中抛出的所有异常：

```
try {
    try {
        ...
    } catch (Exception ex) {
        ...
    } finally {
        ...
    }

    try {
        ...
    } catch (Exception ex) {
        ...
    } finally {
        ...
    }

    try {
        ...
    } catch (Exception ex) {
        ...
    } finally {
        ...
    }
} catch (Exception ex) {
    ...
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-01-17T13:36:50.850

经过大量考虑，我发现以下代码最好：

```
MyResource resource = null;
try {
    resource = new MyResource();
    resource.doSomethingFancy();
    resource.close(); 
    resource = null;  
} finally {
    closeQuietly(resource)
}

void closeQuietly(MyResource a) {
    if (a!=null)
        try {
             a.close();
        } catch (Exception e) {
             //ignore
        }
} 
```

该代码保证以下内容：

1.  代码完成后资源被释放
2.  关闭资源时抛出的异常不会在不处理它们的情况下被消耗。
3.  代码不会尝试关闭资源两次，不会产生不必要的异常。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-26T21:39:29.360

如果可以的话，您应该测试以避免错误情况开始。

```
try{...}
catch(NullArgumentException nae){...}
finally
{
  //or if resource had some useful function that tells you its open use that
  if (resource != null) 
  {
      resource.Close();
      resource = null;//just to be explicit about it was closed
  }
} 
```

此外，您可能应该只捕获可以从中恢复的异常，如果您无法恢复，则让它传播到程序的顶层。如果您无法测试错误情况，您将不得不像您已经完成的那样用 try catch 块包围您的代码（尽管我建议仍然捕获特定的预期错误）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-26T21:50:30.210

您可以将其重构为另一种方法...

```
public void RealDoSuff()
{
   try
   { DoStuff(); }
   catch
   { // resource.close failed or something really weird is going on 
     // like an OutOfMemoryException 
   }
}

private void DoStuff() 
{
  try 
  {}
  catch
  {
  }
  finally 
  {
    if (resource != null) 
    {
      resource.close(); 
    }
  }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-26T22:40:58.267

我通常这样做：

```
MyResource r = null;
try { 
   // use resource
} finally {   
    if( r != null ) try { 
        r.close(); 
    } catch( ThatSpecificExceptionOnClose teoc ){}
} 
```

理由：如果我完成了资源并且我唯一的问题是关闭它，那么我对此无能为力。如果我已经完成了资源，那么杀死整个线程也没有任何意义。

这是一种情况，至少对我来说，忽略该检查异常是安全的。

直到今天，我在使用这个成语时还没有遇到任何问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-27T13:50:57.633

```
try {
    final Resource resource = acquire();
    try {
        use(resource);
    } finally {
        resource.release();
    }
} catch (ResourceException exx) {
    ... sensible code ...
} 
```

任务完成。没有空测试。单次捕获，包括获取和释放异常。当然，您可以使用 Execute Around 习惯用法，并且只需为每种资源类型编写一次。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-12-15T09:11:32.880

`Resource`从[最佳答案](https://stackoverflow.com/q/481446/2243135)更改为[`Closeable`](https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html)

Streams implements`Closeable`因此，您可以为所有流重用该方法

```
protected void closeQuietly(Closeable resource) {
    if (resource == null) 
        return;
    try {
        resource.close();
    } catch (IOException e) {
        //log the exception
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-02-14T15:07:10.457

我遇到了类似的情况，我无法对资源使用 try 但我也想处理来自关闭的异常，而不仅仅是像 closeQuietly 机制那样记录并忽略它。就我而言，我实际上并没有处理输出流，因此关闭失败比简单的流更有趣。

```
IOException ioException = null;
try {
  outputStream.write("Something");
  outputStream.flush();
} catch (IOException e) {
  throw new ExportException("Unable to write to response stream", e);
}
finally {
  try {
    outputStream.close();
  } catch (IOException e) {
    ioException = e;
  }
}
if (ioException != null) {
  throw new ExportException("Unable to close outputstream", ioException);
} 
```

# sql - 是否可以忽略存储过程的输出参数？

> ID：481455
> 
> 赞同：9
> 
> 时间：2009-01-26T21:30:52.370
> 
> 标签：sql, sql-server-2005, tsql, stored-procedures

如何忽略存储过程的输出参数？我正在从另一个过程调用该过程，例如：

```
DECLARE @param1 integer

EXEC mystoredprocedure 
    @in_param_1, 
    @in_param2_, 
    @param1 OUTPUT, 
    -- what do I type here to ignore the second output param?? 
```

我正在使用 T-SQL (MS SQL 2005)。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-29T20:37:28.337

您可以只使用 NULL 作为最后一个参数，它应该可以正常工作 - 只要该参数也不需要用于 proc 中的输入逻辑。

在您的情况下，您将 proc 称为

```
exec mystoredproc @in_param_1, @in_param2_, @param1 OUTPUT, null 
```

这是针对相同场景的另一个示例...

```
create proc MyTempProc
    (@one int,
    @two int out,
    @three int out)
AS
begin

    set @two = 2
    set @three = 3

    select @one as One

end
go

declare @p1 int,
        @p2 int

set     @p1 = 1

exec MyTempProc @p1, @p2 out, null 

print @p1
print @p2 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T21:39:17.783

输出参数必须有一个默认值才能让您不传递它。见下文

```
create proc x (@in int = null, @out int = null OUTPUT)
as 
Begin
    Select @in
End

exec x 1 
```

**编辑**

为了澄清一点，错误被返回，因为被调用的存储过程定义了一个参数（在本例中为@param1），没有定义默认值。（即@param1 int 而不是@param int = -1） 如果在调用存储过程时没有为存储过程的定义参数指定参数或默认值，则会发生错误。如果您厌倦了省略没有指定默认值的输入参数，也会发生同样的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T21:38:04.900

您可能不得不自己忽略 OUTPUT 参数，而不是对该值做任何事情。这不像那个变量的开销是一个问题或任何东西。这里唯一的问题是你的代码会有点难看。因此，在此处发表评论，说明未使用 OUTPUT 参数，一切都应该没问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T20:43:12.867

如果您正在调用的 SP 需要传递一个参数，那么您必须在那里有一个。即使你忽略它的输出，它也是 SP 结构的一部分。

将参数视为“数据契约”。如果它们不是默认值，则它们是必需的。即使这些值被忽略。

强迫您声明一个您永远不会读取的虚拟值是调用该存储过程的成本，该过程可能被某些需要使用输出参数的值的东西使用。

# user-interface - 触摸屏系统指南

> ID：481459
> 
> 赞同：2
> 
> 时间：2009-01-26T21:31:42.527
> 
> 标签：user-interface, touchscreen

您是否听说过有关如何设计此类系统的公认范式？我不是在谈论 iPhone，而是在谈论照相亭或制造系统

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T21:44:27.570

规则，

我曾开发过许多触摸屏应用程序。我从来没有像你提到的那样找到一套已发布的标准，但这里有一些我学到的东西：

使用以下规则创建有限的“视觉词汇”：

*   按钮的高度应为 30 或更多像素（至少一样宽） - 仅增加按钮的宽度不会使其更易于点击

*   尝试将控件放置在屏幕上相似的点上——如果可行的话完全一样，这样用户就不必在屏幕的不同部分寻找相同的操作。

*   避免滚动 - 尝试标签、分页、向导等。在触摸屏上使用滚动条非常困难

*   考虑如何使用屏幕。用户会把手放在哪里？他们会把手放在屏幕的角落吗？电源键会碍事吗？

*   作为此规则集的一部分，创建您自己的控件库，可以在应用程序的其他部分轻松重用

*   尝试在“软”键盘上省略或减少打字。使尽可能多的字段可选。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T21:35:26.293

为“胖手指”用户设置大按钮。

可用性真的很重要。

保持触摸屏校准良好。这在 1999 年曾经是一场噩梦。不知道现在好多了。

# 3d - 创建 3D 模型然后确定尺寸

> ID：481461
> 
> 赞同：2
> 
> 时间：2009-01-26T21:31:50.543
> 
> 标签：3d, disparity-mapping

是否有任何图书馆可以拍摄一些物体的数码照片并创建它的 3d 模型。

例如，理想情况下，我希望让用户上传 n 张对象的图片并将图片输入到诸如光合作用之类的东西中以构建模型，然后确定所述对象的尺寸。

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T00:56:19.303

您所说的是深度映射或“视差映射”，它是立体计算机视觉的基础。OpenCV 项目具有执行此操作的库。我不知道它们是否直接转换为可旋转的 3D 对象，这可能是您正在寻找的，但它们可能很接近。

[http://opencv.willowgarage.com/wiki/](http://opencv.willowgarage.com/wiki/)
[http://en.wikipedia.org/wiki/OpenCV](http://en.wikipedia.org/wiki/OpenCV)

维度部分有点难。库可以识别对象，但这只会为您提供“通用”维度。如果您使用两个摄像头使用立体成像，则可以从多个样本中确定真实深度，从而确定尺寸。

这个问题很难，真的很难，否则（即不可能。）

# php - PHP字符串浮动

> ID：481466
> 
> 赞同：137
> 
> 时间：2009-01-26T21:32:22.290
> 
> 标签：php, string, casting, floating-point

我根本不熟悉 PHP，并且有一个快速的问题。

我有 2 个变量`pricePerUnit`和`InvoicedUnits`. 这是将这些设置为值的代码：

```
$InvoicedUnits = ((string) $InvoiceLineItem->InvoicedUnits);
$pricePerUnit = ((string) $InvoiceLineItem->PricePerUnit); 
```

如果我输出这个，我会得到正确的值。让我们说`5000`发票单位和`1.00`价格。

现在，我需要显示花费的总金额。当我将这两个相乘时它不起作用（正如预期的那样，这些是字符串）。

但我不知道如何在 PHP 中解析/转换/转换变量。

我该怎么办？

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2009-01-26T21:35:52.563

```
$rootbeer = (float) $InvoicedUnits; 
```

应该为你做。查看[类型杂耍](http://us2.php.net/language.types.type-juggling)。您还应该阅读[String conversion to Numbers](http://us2.php.net/manual/en/language.types.string.php#language.types.string.conversion)。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2009-01-26T21:38:22.323

您想要[非语言环境感知`floatval`功能](http://php.net/function.floatval)：

> float floatval (mixed $var) - 获取字符串的浮点值。

例子：

```
$string = '122.34343The';
$float  = floatval($string);
echo $float; // 122.34343 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2010-07-18T12:15:17.870

好吧，如果用户写 1,00,000 那么 floatvar 将显示错误。所以 -

```
floatval(preg_replace("/[^-0-9\.]/","",$input)); 
```

这要可靠得多。

用法 ：

```
$input = '1,03,24,23,434,500.6798633 this';
echo floatval(preg_replace("/[^-0-9\.]/","",$input)); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-07-18T12:35:14.270

处理浮点数中的标记是一项非常重要的任务。在英/美符号中，您格式化一千加`46*10-2`：

```
1,000.46 
```

但在德国，你会改变逗号和点：

```
1.000,46 
```

这使得在多语言应用程序中猜测正确的数字变得非常困难。
我强烈建议使用`Zend_Measure`Zend 框架来完成这项任务。该组件将通过用户语言将字符串解析为浮点数。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-06-09T11:44:13.480

您可以点击此[链接](https://www.geeksforgeeks.org/how-to-convert-a-string-into-number-in-php/)了解更多关于如何在 PHP 中将字符串/数字转换为数字/浮点数/十进制。这就是这个链接所说的......

方法一：使用 number_format() 函数。number_format() 函数用于将字符串转换为数字。它在成功时返回格式化的数字，否则在失败时给出 E_WARNING。

```
$num = "1000.314"; 

//Convert string in number using  
//number_format(), function 
echo number_format($num), "\n"; 

//Convert string in number using  
//number_format(), function 
echo number_format($num, 2); 
```

方法2：使用类型转换：类型转换可以直接将字符串转换为浮点、双精度或整数基本类型。这是在没有任何函数的情况下将字符串转换为数字的最佳方法。

```
// Number in string format 
$num = "1000.314"; 

// Type cast using int 
echo (int)$num, "\n"; 

// Type cast using float 
echo (float)$num, "\n"; 

// Type cast using double 
echo (double)$num; 
```

方法 3：使用 intval() 和 floatval() 函数。intval() 和 floatval() 函数也可用于将字符串分别转换为其对应的整数和浮点值。

```
// Number in string format 
$num = "1000.314"; 

// intval() function to convert  
// string into integer 
echo intval($num), "\n"; 

// floatval() function to convert 
// string to float 
echo floatval($num); 
```

方法4：通过加0或进行数学运算。字符串数字也可以通过在字符串中添加 0 转换为整数或浮点数。在 PHP 中，执行数学运算时，字符串被隐式转换为整数或浮点数。

```
// Number into string format 
$num = "1000.314"; 

// Performing mathematical operation  
// to implicitly type conversion 
echo $num + 0, "\n"; 

// Performing mathematical operation  
// to implicitly type conversion 
echo $num + 0.0, "\n"; 

// Performing mathematical operation  
// to implicitly type conversion 
echo $num + 0.1; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-11-12T17:13:48.273

使用此函数从任何类型的文本样式转换浮点值：

```
function parseFloat($value) {
    return floatval(preg_replace('#^([-]*[0-9\.,\' ]+?)((\.|,){1}([0-9-]{1,3}))*$#e', "str_replace(array('.', ',', \"'\", ' '), '', '\\1') . '.\\4'", $value));
} 
```

此解决方案不依赖于任何区域设置。因此，对于用户输入，用户可以以他们喜欢的任何方式键入浮点值。这真的很有帮助，例如，当您有一个只有英文的项目但世界各地的人们都在使用它并且可能没有想到该项目需要一个点而不是逗号来表示浮点值时。您可以混合使用 javascript 并获取浏览器的默认设置，但仍然有很多人将这些值设置为英语，但仍然输入 1,25 而不是 1.25（尤其是但不限于翻译行业、研究和 IT）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-03-05T17:00:57.710

我遇到了执行此操作的标准方法的问题：

```
$string = "one";

$float = (float)$string;

echo $float; : ( Prints 0 ) 
```

如果没有有效的数字，解析器不应该返回一个数字，它应该抛出一个错误。（这是我试图在我的代码中捕获的条件，YMMV）

为了解决这个问题，我做了以下事情：

```
$string = "one";

$float = is_numeric($string) ? (float)$string : null;

echo $float; : ( Prints nothing ) 
```

然后在进一步处理转换之前，如果没有有效的字符串解析，我可以检查并返回错误。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-10-07T07:59:21.510

如果需要处理不能单独转换的值，可以使用这个方法：

```
try {
    $valueToUse = trim($stringThatMightBeNumeric) + 0;
} catch (\Throwable $th) {
    // bail here if you need to
} 
```

# javascript - 使用jQuery进行渐变填充？

> ID：481468
> 
> 赞同：3
> 
> 时间：2009-01-26T21:33:52.363
> 
> 标签：javascript, jquery, html, css

我有一个`<div>`需要渐变背景的。然而，div 的大小是可变的，这让我回到了“不能在 CSS 中做渐变”的境地。

但是，我很确定这在 jQuery 中是可能的，我似乎找不到一个像样的例子。有没有人可以指出我的方向？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-10-21T08:34:16.197

如果有人需要这个，如果你认为 jQuery 插件太重，你可以使用这个

```
filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00A622', endColorstr='#00B726'); /* for IE */

background: -webkit-gradient(linear, left top, left bottom, from(#00A622), to(#00B726)); /* for webkit browsers */

background: -moz-linear-gradient(top,  #00A622, #00B726); /* for firefox 3.6+ */ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T21:40:44.770

虽然[这](http://davidwees.com/myblog/2007/08/gradient_jquery_plugin.html)很可能会准确地为您提供您想要的东西，但似乎有很多潜在的冲突。不过，试一试；如果失败，我建议在服务器端生成梯度。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T21:45:29.050

不是 Jquery，而是一个建议：您可以使用 SVG 生成渐变：http: [//www.w3schools.com/svg/svg_grad_linear.asp](http://www.w3schools.com/svg/svg_grad_linear.asp)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-24T15:42:48.600

[Background Canvas](http://www.maierhofer.de/en/open-source/jquery-background-canvas-plugin.aspx)插件可以让你做这样的事情，甚至更多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T21:44:53.450

绝对有必要生成渐变而不是简单地在您喜欢的图形程序中创建渐变吗？通过简单地平铺图形可能更有效地节省资源。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-11T17:28:46.427

为什么不计算梯度大于 div 并隐藏溢出中的多余部分，以便调整其余部分的大小？

# solaris - Opensolaris 源代码和 Solaris 发行版之间的关系

> ID：481478
> 
> 赞同：5
> 
> 时间：2009-01-26T21:35:45.870
> 
> 标签：solaris, opensolaris

可用于 OpenSolaris 的源代码对于了解 Solaris 的内部结构（连同 dtrace 和 mdb）非常有用。但是，据我所知，没有办法确切了解 OpenSolaris 源代码与作为 Solaris 正式更新版本发布的二进制文件之间的关系。即哪些版本的源文件被编译形成例如 Solaris 10 Update 6 (10/08)？

您可以通过查看更改日期、历史评论和错误单来得出一些结论。而且我知道 OpenSolaris 和 Solaris 之间没有 1:1 的关系。但是有没有更好的方法我还没有想到？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-16T15:50:00.463

我想不出任何更好的方法来将 OpenSolaris 源代码与 Solaris 10 二进制文件关联起来。Solaris 10 的源代码树是一个单独的分支，包含功能和错误修复，有时还会从 OpenSolaris 分支向后移植到 Solaris 10 分支。

考虑 Solaris 中的不同整合对您很有帮助。例如，如果 OpenSolaris 有 Gnome XY，而 Solaris 10 有 Gnome XY，那么 Gnome 组件的源代码和二进制文件将是相同的。如果您只关心 Solaris 和 OpenSolaris 的 OS/Net 部分，那么代码通常只是松散相关。

# ruby-on-rails - 为什么不推荐使用 Rails Inflector 模块？

> ID：481482
> 
> 赞同：6
> 
> 时间：2009-01-26T21:37:18.457
> 
> 标签：ruby-on-rails, ruby

我查看了变形器下的 Rails 文档，发现了这条消息......

> 模块已弃用
> 
> 这个模块在最新的稳定版本的 Rails 中被弃用了。此处显示了最新的现有版本 (v2.1.0)。

没有解释或提及任何进一步的细节。

我记得看过一个 Rails Trac 网站。我追查了它，发现它也已被弃用。它让我想到了[灯塔](http://rails.lighthouseapp.com/dashboard)。

我在那里找到了一些信息——Rails 核心团队不接受`inflections.rb`. 但它并没有真正解释弃用消息。这背后的故事是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T21:45:13.467

你可以看看[这篇文章](http://railstic.com/2008/12/rails-22-inflector/)以获得解释。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T21:54:35.647

我现在正在查看 Edge Rails 源代码，`inflector.rb`但我看不出它已被弃用——你从哪里得到这些信息？

补丁不被接受，因为它们可能会破坏依赖不正确变形的遗留代码。您可以通过访问由 产生的单例实例来添加自己的规则`Inflector.inflections`，如下所示：

```
ActiveSupport::Inflector.inflections do |inflect|  
  inflect.irregular 'person', 'people'
  inflect.uncountable 'rails'
end 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T02:17:13.790

两个不同的问题在起作用。拐点不会被修补以纠正错误以保护不正确拐点的遗留使用，但更重要的是拐点已从 2.2.1 移至 ActiveSupport

请参阅此处的 2.2.1[与](http://apidock.com/rails/ActiveSupport/Inflector)此处的 2.2.1 之前[的版本](http://apidock.com/rails/Inflector)

# asp.net - 为什么我的 ASP.NET CustomValidator 无法验证？

> ID：481494
> 
> 赞同：4
> 
> 时间：2009-01-26T21:40:26.720
> 
> 标签：asp.net, vb.net, customvalidator

我一定做错了什么。我似乎无法执行我的 CustomValidator 的 ServerValidate 方法。

我有一个带有 CustomValidator 的 Visual Basic ASP.NET 页面......

```
<asp:TextBox ID="TextBox1" runat="server" />
<asp:CustomValidator ID="CustomValidator1" runat="server"
    ControlToValidate="TextBox1"
    ErrorMessage="Friendly message goes here."
    Display="Dynamic" />
<asp:Button ID="Button1" runat="server"
    Text="Submit"
    CausesValidation="True" /> 
```

对于此测试，我将验证集设置为始终失败...

```
Sub CustomValidator1_ServerValidate(ByVal source As Object, ByVal args As System.Web.UI.WebControls.ServerValidateEventArgs) 处理 CustomValidator1.ServerValidate
    args.IsValid = False
结束子

```

但是，当单击按钮时，CustomValidator1_ServerValidate() 方法永远不会执行！

```
Protected Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) 处理 Button1.Click
    Page.Validate()
    If Page.IsValid Then
        '它在这里执行代码！
    万一
结束子

```

即使我明确地验证该控制...

```
CustomValidator1.Validate() '什么都不做？

```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-26T21:45:54.993

添加属性：

```
 ValidateEmptyText="True" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T21:46:18.923

您是否将验证器控件提交按钮放在同一个验证组中？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:43:56.120

我知道这是一个愚蠢的问题（或者听起来像！）。但是您是否实际输入或更改了文本框中的值？我*认为*如果不更改文本框的内容，验证器就不会触发。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T21:51:54.543

首先，您似乎在上面的标记中缺少 OnServerValidate 属性。

其次，我会检查以确保 CustomValidator1_ServerValidate 已设置为 Textbox1 的 ServerValidate 事件的事件处理程序。我曾经在标记和代码隐藏中更改了验证方法的名称，但 IDE 没有自动更新传递给事件处理程序委托的订阅方法名称

# c - 将 VB 回调函数传递给 C dll - noob 被卡住

> ID：481504
> 
> 赞同：2
> 
> 时间：2009-01-26T21:45:01.407
> 
> 标签：c, vb.net, dll, callback

VB 中的回调（来自 C dll）。

我需要将 vb 函数作为回调传递给 dll 中的 ac 函数。我知道我需要为该功能使用 addressof ，但我对如何做到这一点越来越感到困惑。

细节：

我将回调地址传递给的 dll 中的函数在 C 中定义为：

```
PaError Pa_OpenStream( PaStream** stream,
                       const PaStreamParameters *inputParameters,
                       const PaStreamParameters *outputParameters,
                       double sampleRate,
                       unsigned long framesPerBuffer,
                       PaStreamFlags streamFlags,
                       PaStreamCallback *streamCallback,
                       void *userData ); 
```

其中函数是参数 7，*streamCallback。PaStreamCallback 类型是这样定义的：

```
typedef int PaStreamCallback(
    const void *input, void *output,
    unsigned long frameCount,
    const PaStreamCallbackTimeInfo* timeInfo,
    PaStreamCallbackFlags statusFlags,
    void *userData ); 
```

在我的 vb 项目中，我有：

```
Private Declare Function Pa_OpenStream Lib "portaudio_x86.dll" _
        (     ByVal stream As IntPtr _
            , ByVal inputParameters As IntPtr _
            , ByVal outputParameters As PaStreamParameters _
            , ByVal samprate As Double _
            , ByVal fpb As Double _
            , ByVal paClipoff As Long _
            , ByVal patestCallBack As IntPtr _
            , ByVal data As IntPtr) As Integer 
```

（如果我输错了其他一些参数，请不要担心，我稍后会找到它们！现在让我们专注于回调。）

在 module1.vb 我定义了回调函数：

Function MyCallback( ByVal inp As Byte, _ ByVal outp As Byte, _ ByVal framecount As Long, _ ByVal pastreamcallbacktimeinfo As Byte, _ ByVal pastreamcallbackflags As Byte, _ ByVal userdata As Byte) As Integer ' 在这里做聪明的事情 End Function

dll中的外部函数被调用

```
err = Pa_OpenStream(    ptr, _
            nulthing, _
            outputParameters, _
            SAMPLE_RATE, _
            FRAMES_PER_BUFFER, _
            clipoff, _
            AddressOf MyCallback, _
            dataptr) 
```

这在外部函数的声明中被破坏了——它不喜欢 IntPtr 类型作为 AddressOf 的函数指针。

谁能告诉我如何实现传递这个回调函数？

非常感谢大卫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T21:53:41.997

这篇 MSDN 文章将有所帮助：[如何从 C DLL 回调 Visual Basic 函数](http://support.microsoft.com/?scid=kb%3Ben-us%3B181578&x=11&y=11)

# .net - 最佳实践：LINQ 中的 3 层架构

> ID：481512
> 
> 赞同：5
> 
> 时间：2009-01-26T21:46:59.250
> 
> 标签：.net, linq-to-sql, architecture, n-tier-architecture

我正在开发一个将使用 LINQ to SQL 的个人项目（C#/ASP.NET）。该解决方案将（到目前为止）有一个 Webform 项目、一个 Namespace 项目（业务逻辑）和一个 Tests 项目。到目前为止，我处于非常早期的阶段（显然处于设计阶段）。

这里有 3 层架构的范例吗？在这种情况下，DAL 似乎完全没用；感觉我应该直接从业务逻辑执行 LINQ 查询。

我还想到，如果我只保留一个常驻 DataContext 并传递它，我只需要一个打开的连接。这将有一个额外的好处，即一次而不是细粒度地提交更改。对此有什么想法吗？

我找到[了这个线程](https://stackoverflow.com/questions/47374/best-practices-re-linq-to-sql-for-data-access)，但它似乎描绘了一幅不完整的画面。有没有关于这个主题的深入文章？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T21:52:45.040

你可以阅读一下领域驱动设计。

通过领域驱动设计 (DDD) 的实践，您拥有了一个丰富的“领域模型”，您可以在其中表达您想要解决的问题领域。此域模型由您用来建模业务实体的类（和结构）组成。域模型还包含存储库。
存储库是您在域模型（和应用程序）中使用的某种抽象；存储库是数据存储的抽象。通过存储库，您可以检索实体，并且您可以使用存储库来持久化实体。

在您的情况下，您的存储库可以在内部使用 Linq To SQL 与数据库通信。但是请注意，您的存储库不应该负责管理（打开/关闭）连接和事务（启动/提交/回滚）。为什么 ？-> 因为存储库不知道或不知道使用它的上下文。应该是您的应用程序或服务层（使用您的域模型并因此使用您的存储库的层）负责打开新连接并启动/提交事务。（或者在您的情况下，打开一个新的 DataContext）。然后，您可以将 DataContext 传递到存储库。

（Eric Evans 有一本关于 DDD 的好书，尽管有时很难破解）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T21:59:23.950

您可以将 LINQ-to-SQL 视为您的 DAL，因此“直接从业务逻辑”使用它不一定是坏事。

[http://dotnetlog.com/archive/2008/03/18/best-practice-and-effective-way-of-using-datacontext-in-linq.aspx](http://dotnetlog.com/archive/2008/03/18/best-practice-and-effective-way-of-using-datacontext-in-linq.aspx)列出了一些流行的 L2S 方法。

在我们的项目中，我们不想传递数据上下文，因此我们使用了类似于上面链接中的#3 的模式（Ambient DataContext，见下文）。它有一些问题，但效果还不错；至少对于我们的网络项目。

> 环境数据上下文（当前使用这个）
> 
> 环境数据上下文背后的想法是，一旦第一次调用 DataContext，就会为特定线程或 httpcontext（在 asp.net 中）创建上下文。然后相同的上下文用于该线程或请求，除非它是手动处理的。这是通过将上下文存储在请求/线程数据存储中来完成的。此模式的方法类似于静态 DataContext，但是为每个线程和请求提供了分离。这在 Asp.Net 中运行得非常好，然而，它再次受到静态上下文的一些问题的困扰。
> 
> 这种模式的问题：
> 
> ```
> * The context is available for manipulation at any level. And quickly becomes very hard to maintain unit of work
> * Portability across thread is very hard
> * Unit of work pattern is not transparent enough 
> ```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:55:47.390

你应该小心你的术语。当您说 LINQ 时，您的意思是 Linq-to-sql，而当您说 3 层时，这通常意味着您正在谈论具有 3 台独立机器的部署方案。我不确定这是否是你的意思。

在使用像 linq-to-sql 这样的 ORM 工具时，三层架构仍然是一个好主意。DAL 只是一个存储查询逻辑的地方。将查询从业务层中取出是个好主意，因为查询是持久性问题，而不是业务逻辑问题。

管理数据上下文的常用技术是每个请求都有一个数据上下文。

关于该主题的其他文章，您可以查看任何 ORM 工具的任何架构指南 - linq-to-sql 也不例外。查找有关 NHibernate 架构的文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T21:52:57.710

在这种情况下，LINQ to SQL 库是您的 DAL，而不是从您的业务层（例如 DAL.GetObjectById(id)）进行传统的 API 调用，您可以灵活地向 DAL 中提出更具表现力的请求。

如果您有其他需求，例如您自己的连接到非 MSSQL 数据支持的 LINQ 提供程序，那么您将实现自己的 DAL。

此外，关于 DataContext，不建议使用带有“一个驻留 DataContext”的单例模式。DataContext 对象应该代表单个逻辑事务，无论这对您的应用程序意味着什么。（转述自[http://weblogs.asp.net/despos/archive/2008/03/19/more-on-datacontext-in-hopefully-a-realistic-world.aspx](http://weblogs.asp.net/despos/archive/2008/03/19/more-on-datacontext-in-hopefully-a-realistic-world.aspx)）

# hyperlink - 公司标志上的链接应该放在哪里？

> ID：481516
> 
> 赞同：1
> 
> 时间：2009-01-26T21:47:43.773
> 
> 标签：hyperlink, seo, graphical-logo

我想知道公司徽标上的链接（通常是主页）是否应该是：

*   [http://www.example.com](http://www.example.com)
*   [http://www.example.com/index.html](http://www.example.com/index.html)（或其他索引文件）
*   /index.html（或其他索引文件）
*   /（只是根）

谷歌关心还是有其他规则？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T21:50:59.290

A 或 D。

对完整路径进行硬编码会消除灵活性 - 让 Web 服务器或应用程序配置处理默认值。

（iirc google 并不关心任何其他链接）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T21:51:14.467

好吧，我想为了简单起见，它应该只是去[http://www.example.com](http://www.example.com)。包括 index.html 会使其依赖于 index.html 中主页的实现，但情况可能并非总是如此。另外，如果您转到某个子域，您可能不希望在单击公司徽标时被重定向到子域的主页，据我所知，应该始终将您带回主要公司主页页。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T21:53:00.157

以我最谦虚的观点并归功于我对 TBL 的理解，URL 应该是识别资源，而不是生成它的技术手段：所以我反对在链接中包含“index.html”。毕竟，您试图指向该地址处的站点，并且它当前是 HTML（或者 DirectoryIndex 在 apache 服务器上设置为“索引”）这一事实是一个实现细节。

That leaves [http://example.com](http://example.com) and / to consider. I'm somewhat indifferent between the two. Is it possible the domain name where the current content is being served from will change? If it does, do I want to link to example.com or to the current domain? That's what I would be thinking about in deciding between the two.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T21:55:51.680

If you're really trying to achieve proper SEO, I would think that you would rather have a logo or banner (something that's on every page to identify the website, not the page) be set as the background of a div instead of using `<img>`. I usually reserve `<img>` for images particular to the content on a specific page. This allows you to set the alt attribute as well which helps with SEO. As for the link, it really shouldn't matter to Google. I'm sure they've handled this on their end.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T11:31:08.113

ok simply put a never link to [http://www.example.com/index.html](http://www.example.com/index.html) as later you might use [http://www.example.com/index.php](http://www.example.com/index.php) if you change hosting or site design

equally never link to [http://www.example.com](http://www.example.com) as this is not a url and your browser must repair it

when linking from other company sites via logo link to [http://www.example.com/](http://www.example.com/) note the / as this is the actual url for {default page in first folder}

or internally on same site just link to "/" as this also means {default page in first folder on this site} which will keep your links working if company name changes

also ensure that [http://example.com/](http://example.com/) 301 redirects to [http://www.example.com/](http://www.example.com/) {and dosn't server identical content} and if many links are already to [http://www.example.com/index.html](http://www.example.com/index.html) first fix all you can second move index.html to index.htm then 301 redirect /index.html to [http://www.example.com/](http://www.example.com/) thus ensuring everyone eventually notices the [http://www.example.com/index.html](http://www.example.com/index.html) is gone

without loosing hits or PR

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T02:15:12.070

I would and do go to /

My PHP/xHTML looks like this

```
<a href="<?php echo CONFIG_DIR_BASE ?>" title="Site Home">Home</a> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T12:30:34.240

Relative URLs (C and D) would be resolved by clients (Google included) to absolute URLs (to B and A respectively) and therefore treated the same as their absolute counterparts. If your A permanently redirects to B, or B to A, then Google will also treat this as one resource. Google will score A+B+C+D as one page.

Whichever one URL the others eventually resolve or redirect to will be considered the 'canonical' URL.

The words contained in your canonical URL are important. As in the URLs of questions here on stackoverflow, the words should relate to the content. Therefore what you need to decide is whether or not you want the words 'index' and 'html' in the URL. I believe best practice for home pages is to have `http://www.example.com/index.html` permanently redirect to `http://www.example.com/` .

Of course, content is still king, and all of this is just minor tweaking compared to adding quality content.

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-26T21:52:34.107

我认为您应该将其设置为**~/**

IIS / ASP.NET 会自动将其转换为您的根目录。即[http://www.example.com](http://www.example.com)

这也非常适合在本地进行测试。在您的本地机器上，它将指向[http://127.0.0.1/whateverYourPathIs](http://127.0.0.1/whateverYourPathIs)，并且当它实时部署时，它将正确指向[http://www.example.com](http://www.example.com)

# javascript - 这个javascript代码在做什么？

> ID：481518
> 
> 赞同：2
> 
> 时间：2009-01-26T21:49:26.607
> 
> 标签：javascript

```
this.String = {
    Get : function (val) {
        return function() {
            return val;
        }
    }
}; 
```

':' 是做什么的？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-26T21:53:29.313

`this.String = {}`指定一个对象。 `Get`是该对象的属性。在 javascript 中，对象属性及其值由冒号“:”分隔。

因此，根据示例，您可以像这样调用函数

```
this.String.Get('some string'); 
```

更多示例：

```
var foo = {
  bar : 'foobar',
  other : {
     a : 'wowza'
  }
}
alert(foo.bar); //alerts 'foobar'
alert(foo.other.a) //alerts 'wowza' 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-26T22:15:31.797

其他人已经解释了这段代码的作用。它创建一个`this.String`包含单个函数（称为 ）的对象（称为`Get`）。我想解释一下你什么时候可以使用这个功能。

在您需要更高阶函数（即期望另一个函数作为其参数的函数）的情况下，此函数可能很有用。

假设您有一个对 的每个元素执行某些操作的函数`Array`，让我们调用它`map`。你可以像这样使用这个函数：

```
function inc (x)
{
    return x + 1;
}
var arr = [1, 2, 3];
var newArr = arr.map(inc); 
```

该`map`函数将执行的操作是创建一个包含 values 的新数组`[2, 3, 4]`。它将通过`inc`使用数组的每个元素调用函数来完成此操作。

现在，如果您经常使用此方法，您可能会不断地`map`使用各种参数进行调用：

```
arr.map(inc); // to increase each element
arr.map(even); // to create a list of booleans (even or odd)
arr.map(toString); // to create a list of strings 
```

如果由于某种原因您想用相同的字符串替换整个数组（但保持数组大小相同），您可以这样调用它：

```
arr.map(this.String.Get("my String")); 
```

这将创建一个与 相同大小的新数组`arr`，但只是`"my String"`一遍又一遍地包含字符串。

请注意，在某些语言中，此函数是预定义的并调用`const`or `constant`（因为它总是返回相同的值，每次调用它时，不管它的参数是什么）。

* * *

现在，如果你认为这个例子不是很有用，我会同意你的看法。但是在某些情况下，当使用高阶函数进行编程时，会使用这种技术。

例如，如果你有一棵树，你想“清除”它的值但保留树的结构，它会很有用。您可以`tree.map(this.String.Get("default value"))`创建一棵全新的树，其形状与原始树完全相同，但没有任何值。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T21:53:51.390

它将具有“Get”属性的对象分配给`this.String`。“Get”被分配了一个匿名函数，它将返回一个函数，该函数只返回给第一个返回函数的参数。听起来很奇怪，但这是它的使用方法：

```
var ten = this.String["Get"](10)(); 
```

`ten`然后将包含一个 10。相反，您可以编写等价的

```
var ten = this.String.Get(10)();

// saving the returned function can have more use:
var generatingFunction = this.String.Get("something");
alert(generatingFunction()); // displays "something" 
```

也就是说，`:`只需为属性分配一些值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T09:41:10.697

这个答案可能有点多余，因为 Tom's 是一个很好的答案，但只是将其归结为完整：-

```
this.String = {}; 
```

将一个对象添加到当前对象，其属性名称为`String`。

```
var fn = function(val) {
    return function() { return(val); }
} 
```

从闭包返回一个函数，该函数又返回用于创建闭包的参数。因此：-

```
var fnInner = fn("Hello World!");
alert(fnInner()); // Displays Hello World! 
```

然后结合起来： -

```
this.String = { Get: function(val) {
    return function() { return(val); }
} 
```

将一个对象添加到具有属性名称的当前对象，该对象`String`具有一个调用的方法，该方法`Get`从闭包返回一个函数，该函数又返回用于创建闭包的参数。

```
var fnInner = this.String.Get("Yasso!");
alert(fnInner()); //displays Yasso! 
```

# regex - .htaccess 没有正确处理文件夹的根目录

> ID：481521
> 
> 赞同：0
> 
> 时间：2009-01-26T21:50:22.067
> 
> 标签：regex, .htaccess

所以我在我的网络服务器上的 /blog/ 文件夹中有这个 .htaccess 文件，并与我们用于这个特定客户端（表达引擎）的博客 CMS 一起工作，我写了这个 .htaccess 以使 URL SEO 友好。这一切都很好，除非我去 www.example.com/blog/ 然后它会通过我不希望它的底部规则。

我尝试添加您可以在最后一行第二行看到的 Google 行，以查看它到底检测到了什么，它通过了 google“index.html”（无引号）——可能有一种简单的正则表达式方法来排除以 index.html 开头的字符串。 html 但不幸的是我不是正则表达式忍者...

这是 .htaccess 的内容：

```
rewriteengine on

##############################
# BLOG CATEGORIES HOME

rewriterule ^beach-baby/?$ index.php/site/C4/
rewriterule ^adventure-baby/?$ index.php/site/C5/
rewriterule ^snow-baby/?$ index.php/site/C6/
rewriterule ^wild-child/?$ index.php/site/C7/

##############################
# BLOG CATEGORIES WITH PAGE NUMBER

rewriterule ^beach-baby/page([0-9]+)/?$ index.php/site/C4/P$1/
rewriterule ^adventure-baby/page([0-9]+)/?$ index.php/site/C5/P$1/
rewriterule ^snow-baby/page([0-9]+)/?$ index.php/site/C6/P$1/
rewriterule ^wild-child/page([0-9]+)/?$ index.php/site/C7/P$1/

##############################
# BLOG INDEX WITH PAGE NUMBER

rewriterule ^page([0-9]+)/?$ index.php/P$1/

##############################
# BLOG POST

#rewriterule ^([^/]+)/?$ http://www.google.ca/search?q=$1
rewriterule ^([^/]+)/?$ index.php/site/comments/$1/ 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T22:03:48.077

您可以在其他规则之上设置以下规则以`/index.html`从其他规则中排除：

```
RewriteRule ^index\.html$ - [L] 
```

# web-services - 使用 Axis2 生成的异常类

> ID：481539
> 
> 赞同：0
> 
> 时间：2009-01-26T21:54:04.120
> 
> 标签：web-services, exception, code-generation, axis2

我在同一个包中有几个引发自定义异常的 Web 服务。问题是生成的异常类包含对生成它的 Web 服务的引用，因此我不能在多个 Web 服务中使用相同的异常名称。有没有办法让 Axis2 在 Web 服务类中生成异常类，就像对其他对象一样？我正在使用亚行。我怀疑可能有一个`-E`参数，但由于这些都没有记录，所以很难说。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-14T13:22:11.143

这是关于 Axis 2 代码生成参数[的非常好的指南。](http://wso2.org/library/tutorials/reference-guide-axis2-code-generation-parameters-part-1)我已经将它用于许多任务，例如自定义输出包名称（默认情况下对应于 WSDL 名称空间）。

我希望这可以帮助你。

# mysql - UTF-8 仅在 Grails 数据库表中

> ID：481541
> 
> 赞同：6
> 
> 时间：2009-01-26T21:55:03.477
> 
> 标签：mysql, grails, utf-8

将 Grails 1.0.4 与 MySQL 一起使用时，自动生成的数据库表的字符集似乎默认为 ISO-8859-1。我宁愿将所有内容都存储为纯 UTF-8。那可能吗？

从自动生成的数据库定义中：

```
ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=latin1; 
```

注意“latin1”部分。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-09T14:29:37.270

大多数 MySQL 安装默认为 latin1，因此如果没有另外说明，驱动程序将使用默认值。在连接 URL 中添加字符集指令就足够了，例如：

> `jdbc:mysql://localhost/databaseName?useUnicode=yes&characterEncoding=UTF-8`

为此，MySQL 连接器 JAR 必须是版本 5（3.x 不起作用）。

资料来源：[MySQL 参考手册：使用字符集和 Unicode](http://dev.mysql.com/doc/refman/4.1/en/connector-j-reference-charsets.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-11-03T17:18:40.363

还必须在创建过程中为数据库设置默认字符编码

```
CREATE DATABASE databaseName DEFAULT CHARACTER SET utf8; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T22:16:07.677

显然，您必须通过为 Hibernate[定义自己的自定义 SQL 方言](http://hartsock.blogspot.com/2008/05/terrible-hibernate-hack-for-grails.html)（Grails 用于持久性）来解决问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-08T04:55:14.763

您必须使用 collat​​ion 创建数据库`utf8_genenal_ci`。然后将此字符串添加到连接字符串：

```
useUnicode=true&characterEncoding=utf-8" 
```

# asp.net - 如何防止重复回发混淆我的业务层

> ID：481564
> 
> 赞同：6
> 
> 时间：2009-01-26T22:01:51.777
> 
> 标签：asp.net, form-submit, duplicate-data

我有一个采用传统 3 层设计的 Web 应用程序（ASP.Net 3.5）。如果用户单击一个按钮，则会发生回发，一些中间层和数据层代码会运行，并且屏幕会刷新。如果用户在第一次回发完成之前多次单击该按钮，我的逻辑会变得混乱，并且应用程序可能最终处于无效状态。防止这种情况的最佳方法是什么？

我可以使用 javascript 来禁用按钮，但这只是隐藏了问题。我如何构建我的业务和数据层来处理这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T22:03:56.580

三种最流行的方法（经常串联使用）是：

1.  [单击/按下后禁用提交按钮](http://www.developertutorials.com/tutorials/javascript/how-disable-submit-button-050416/page1.html)；
2.  使用[POST+REDIRECT+GET](http://www.theserverside.com/patterns/thread.tss?thread_id=20936)避免返回按钮问题；和
3.  [替换浏览器中的历史记录，](http://www.webdeveloper.com/forum/showthread.php?t=130329l)这样您就无法返回（但这应该谨慎使用，并且有充分的理由）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T22:12:30.383

如果说实话，我会说这听起来像是您对网络回发感到困惑，而不是您的应用程序（如果您是编写它的人）。;-)

也就是说，除了其他建议之外，在这种情况下，我要做的是在表单的隐藏字段中放置一个“令牌” - 就像一个 GUID - 被发回。使用它来跟踪正在完成的工作，并且只允许它被使用一次。例如，在回发时，将其放在会话存储中。每次执行回发时，首先检查会话是否有此令牌，如果存在则什么也不做。如果它不存在，请将其存储在会话中并完成工作。会话结束时，令牌会自动丢弃。简单的。比一些复杂的数据库令牌要好得多。

*   奥辛

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-23T14:32:47.663

我已经解决了编写禁用单击功能按钮的javascript的问题：

```
MyButton.Attributes.Add("onclick",
    "javascript:this.onclick=function(){return false;};"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T22:14:46.340

1.  单击后请**禁用提交按钮**。这将防止意外双击或更多
2.  我通常**在回发后****重定向**到不同的 URL ，以避免意外/有意的页面刷新。
***   最后在您的数据库插入方法中，在插入之前**检查在特定时间范围内**（可能以秒为单位）插入的相同数据。如果在几秒钟（或几分钟。在您的情况下最有意义的任何时间）内发现插入重复数据，则显示警告消息并让用户再次点击提交，如果用户认为它没有错误。（当您有用户帐户并且用户在登录时提交数据时，此方法最有意义，因此会为用户完成重复数据检查。）**

 *** * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T16:46:35.020

查看来自 SO'r [Dave Ward的这个名为](https://stackoverflow.com/users/60/dave-ward)[PostBack Ritalin](http://encosia.com/downloads/postback-ritalin/)的 ASP.NET AJAX 控件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-09T05:17:47.243

我们都见过在您单击它们时禁用“提交”按钮的网站。通常这样做是为了防止用户多次单击该按钮。通常这是使用'onclick' JavaScript 事件来禁用按钮来完成的。在 ASP.NET 中，每个服务器端项都已经有一个 onclick 事件处理程序，该处理程序回调服务器进行事件处理。要在 ASP.NET 中完成同样的事情，您可以轻松地执行以下操作：

```
btnSubmit.Attributes.Add("onclick", "this.disabled=true;" + GetPostBackEventReference(btnSubmit).ToString()); 
```

其中“btnSubmit”是相关按钮的名称。这里发生的是我们创建了一个 onclick 事件，它做两件事。首先，它禁用用户浏览器中的按钮。它所做的第二件事是将正常的回发事件提交给服务器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-05-27T14:34:14.280

即使我遇到了同样的问题，我也已经解决了，如下所示。

上传文件后如果您重定向到`same page`或`some other page in your project`此问题将被避免。

例如：

**在我的 ASPX 中**

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="WebForm.aspx.cs" Inherits="WebApplication.WebForm" %>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
</head>

<body>
    <form id="form1" runat="server">
        <div>
            <asp:FileUpload ID="FileUpload1" runat="server" />
            <asp:Button ID="Button1" runat="server" OnClick="Button1_Click" Text="Button" />
        </div>
    </form>
</body>
</html> 
```

即使我遇到了同样的问题，我也已经解决了，如下所示。

上传文件后，如果您重定向到项目中的同一页面或其他页面。重定向后响应将不存在。

在我的 ASPX 中

**在我的代码后面**

```
public partial class WebForm : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {

        }

        protected void Button1_Click(object sender, EventArgs e)
        {
            string path = Server.MapPath("~");
            path = path + FileUpload1.FileName;
            FileUpload1.SaveAs(path);
            Response.Redirect("WebForm.aspx"); // Responce will be cleared. This Redirection will do the Trick 
            //Put the debugger and check it will work
        }
    } 
```

> 在这里，为了显示成功和错误消息，请尝试使用会话。

# iis - 在高流量网站上记录请求

> ID：481565
> 
> 赞同：0
> 
> 时间：2009-01-26T22:02:06.707
> 
> 标签：iis, scalability

我想知道高流量网站如何处理流量记录，例如像 myspace.com 这样的网站收到很多点击，我可以想象记录所有这些请求需要很多空间，所以，他们记录每个请求还是如何记录他们处理这个吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T12:13:00.077

如果您在 MySpace 页面上查看源代码，您会得到答案：

```
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-6293770-1");
pageTracker._setDomainName(".myspace.com");
pageTracker._setSampleRate("1"); //sets sampling rate to 1 percent
pageTracker._trackPageview(); 
</script> 
```

该脚本意味着他们正在使用 Google Analytics。

他们不能只使用 IIS 日志来衡量流量，因为他们可能会向第三方出售广告，而第三方不会相信您获得的流量。他们想要来自一家独立公司的独立数据，而这正是谷歌分析的用武之地。

仅供将来参考 - 每当您对网站如何做某事有疑问时，请尝试查看源代码。你会惊讶于你能在平淡的视野中找到什么。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T12:19:26.273

我们在没有数百人使用的 Intranet 时遇到了类似的问题。磁盘活动很大，性能受到损害。

简短的回答是异步非阻塞日志记录。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T22:05:56.730

可能像谷歌分析。

使用 Javascript 在不同的服务器上加载页面等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T12:16:50.600

[ZXTM](http://www.zeus.com/products/zxtm/)流量整形和日志记录，这里从经验谈起

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T18:36:45.530

如果他们没有记录每个请求，我会感到非常惊讶，是的，并且流量特别高的操作通常会以某种形式针对原始服务器日志滚动他们自己的日志管理解决方案 - 有时是简单的批处理-型进程，有时作为完整的子系统。

我工作的一家公司，在互联网的全盛时期，每天的网页浏览量超过 2000 万次；对于那个站点（实际上是一组，我记得总共在几十台机器上运行），我们的运维团队用 C 语言编写了一个非常复杂的集群解决方案，它可以解析、翻译（到关系存储）、压缩和分发每天记录。日志文件，尤其是冗长的文件，堆积得很快，而当时可用的商业解决方案根本无法解决。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T00:09:44.033

不要他们如何跟踪它，因为我不在那里工作。我很确定他们有足够的存储空间来记录他们用户的每一件小事，如果他们愿意的话。

如果我是他们，如果我只是想了解有关我的用户的基本信息，我会使用 AwStats。他们更有可能开发了自己的脚本来跟踪用户。他们会记录的东西 -ip_address
-referrer
-time
-browser
-OS

等等。然后是一个脚本，用于查看有关用户的不同数据，这些数据按天、周或月变化。正如 brulak 所说，类似于分析的东西，但由于他们可以访问实际的数据库，他们可以了解更多关于他们的用户的信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-09T17:33:52.437

如果通过日志记录您的意思是收集与服务器相关的信息（请求和响应时间、每个请求的 db 和 cpu 使用率等），我认为他们只对 10% 或 1% 的流量进行采样。这会产生相同的结果（为开发人员提供审计信息），而无需填充磁盘或减慢站点速度。

# c# - XCopy - 只抓取完全上传的文件

> ID：481566
> 
> 赞同：0
> 
> 时间：2009-01-26T22:03:07.767
> 
> 标签：c#, xcopy

我有一个自动化的工作，它使用 xcopy 通过面向客户端的站点提取上传到我们服务器的文件。

有没有办法只提取完全上传的文件？

我曾考虑创建第二个“inProcess”文件夹，用于上传，然后在完全上传后移动这些文件，但这仍然会在文件过渡到“完成”文件夹时创建一个时间窗口......

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T22:04:55.173

对临时文件使用 .filepart 扩展名。

这可能是最简单明了的方法。

WinSCP 就是这样做的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T22:05:44.127

您可以上传文件的 MD5 哈希，然后上传文件，如果上传的文件与 MD5 不匹配，则它没有完成（或者如果需要很长时间，可能是没有正确上传）

MD5 通常用于通过创建代表文件的哈希来检查文件的完整性。如果文件完全不同，它几乎总是（如，基本上从不用于我们的目的）生成不同的 MD5 哈希。文件与之前上传的 MD5 散列不匹配的唯一原因是文件未完成或 MD5/文件在上传时损坏。

还有[这个。](http://www.experts-exchange.com/Programming/Languages/Q_23536796.html?sfQueryTermInfo=1+perl)但它是 perl 和专家交流 (ick)

# web-services - 为什么有些 API 提供者需要 API 密钥？

> ID：481571
> 
> 赞同：11
> 
> 时间：2009-01-26T22:04:43.037
> 
> 标签：web-services, api

几个 Web 服务 API 让您注册一个 API 密钥。例如，UPS Web 服务需要一个密钥，该密钥包含在对其服务的调用中——*除了用户名和密码*。

提供者使用此密钥的目的是什么？也许 UPS 是唯一需要 API 密钥和用户名/密码的？

一个想法是他们使用它来限制或衡量 API 的使用，但在我看来，用户配置文件中的设置可以轻松地做同样的事情 - 特别是因为你通常必须获得一个带有用户名和密码的帐户才能获得首先是 API。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T22:26:41.260

有两个主要的用例。首先是衡量、跟踪和限制 API 的使用。如果有人正在构建允许第三方访问它的服务，服务提供商可能想要控制（或至少知道）谁有权访问，以便他们可以尝试并防止诸如拒绝服务攻击之类的事情。在测量和跟踪方面，可以获得有趣的信息，例如了解哪些应用程序在访问服务时很受欢迎，或者人们最常使用哪些功能。

另一个用例与安全性和身份验证有关。服务提供商让第三方应用程序和服务要求用户放弃其主要服务的用户名和密码是不明智的。这是一个巨大的曝光。这就是为什么许多服务正在标准化诸如[OAuth](http://oauth.net "身份验证")之类的协议，该协议通过对用户数据的授权提供委托访问。虽然并非万无一失，但绝对最好将用户凭据分发给未知且不受信任的各方。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T22:24:13.170

大多数情况下，它是监控开发人员如何使用 web-api。如果他们以某种方式不同意您对 api 的使用，它为他们提供了一种在不伤害其他用户的情况下关闭它/您的方法。每个用户/应用程序的统计数据总是很有价值。

我使用了 flickr api——在这种情况下，密钥是你的，但登录数据可能是使用你的应用程序的人的数据，所以 api 密钥是区分应用程序的唯一方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T22:19:07.703

通常它用于获取有关应用程序对 API 执行查询的数量的统计信息。我认为在某些情况下使用 API 密钥询问用户名/密码是模棱两可的，但这是一种实现方式 - 所以我们不能用它做点什么。

他们要求提供 API 密钥，因为您可以在同一个帐户下拥有多个 API - 如果您有多个使用相同 API 的站点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T22:22:20.643

他们可以使用它来表示您尝试使用的 API 版本。也许在 1.0 版中，有一种方法在 www.UPS.com/search 上接受 POST，而 2.0 版中的另一个方法在同一地址，但采用不同的参数集，甚至以不同的格式返回数据/风格。您的程序是基于 V1.0 构建的，并且需要特定的 API 协定。他们希望能够在不干扰客户产品的情况下创建 V2.0。

这只是一个猜测，但对我来说听起来不错。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T22:22:54.590

我认为 Gracenote 为 cddb 做了类似的事情。我忘记了细节，但我记得一些关于一些象征的东西。

（他们对使用他们的服务也有/有非常严格的规则。）

西蒙提醒我什么是优雅音符。Gracenote 和 Fedex 以及其他网络服务有很多开发人员为该软件编写应用程序。因此开发人员获得了一个令牌以放入他们的应用程序中，但最终用户有自己的用户名和密码。它可以让服务密切关注滥用程序等。这可能是主要原因。（就像浏览器或网络机器人通知网络服务器它是谁/是什么）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-23T21:37:01.953

最初，Blogger 要求您申请 API 密钥（类似于 Google 地图）并使用它来限制对 API 的访问。随着 Blogger 演变为 Metaweblog，对 API 的要求变得不那么重要，Blogger 不再需要您申请密钥。正如其他人所指出的，它仍然可以用于跟踪目的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-18T04:40:02.247

在我们的情况下，我们的客户希望它用于：

*   跟踪/分析 - 找出谁在做什么并构建什么产品。由于许多用户是桌面应用程序，因此仅查看推荐人并不总是足够的。
*   权限 - 用户应该有权访问哪些资源？用户如何构建可以访问指定资源的应用程序？
*   许可/法律 - 强制用户已阅读并接受 ToU/许可信息。
*   安全性 - 传递用户名/密码是一个非常糟糕的主意。

# c# - Asp.Net OutputCache 和过期

> ID：481575
> 
> 赞同：4
> 
> 时间：2009-01-26T22:05:57.073
> 
> 标签：c#, asp.net, vb.net, caching, outputcache

我在包含用户控件的页面上使用 Asp.net OutputCache，在某些情况下，当编辑用户控件时，我希望能够使页面缓存过期并使用新数据重新加载页面。

有什么办法可以从用户控件中做到这一点？

如果没有，还有哪些其他缓存页面的方法可以让我以这种方式进行编辑。

- - - - - - 编辑 - - - - - -

经过更多研究，我发现了一种似乎效果很好的方法。

```
Dim cachekey As String = String.Format("Calendar-{0}", calendarID)
HttpContext.Current.Cache.Insert(cachekey, DateTime.Now, Nothing, System.DateTime.MaxValue, System.TimeSpan.Zero, System.Web.Caching.CacheItemPriority.NotRemovable, Nothing)
Response.AddCacheItemDependency(cachekey) 
```

这将为页面缓存对象添加一个依赖项，然后过期我这样做：

```
Dim cachekey as string = String.Format("Calendar-{0}", CalendarID)
HttpContext.Current.Cache.Insert(cachekey, DateTime.Now, Nothing, System.DateTime.MaxValue, System.TimeSpan.Zero, System.Web.Caching.CacheItemPriority.NotRemovable, Nothing) 
```

现在只要知道依赖缓存键，页面就可以过期。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T23:09:02.533

你可以试试这个：

```
private void RemoveButton_Click(object sender, System.EventArgs e)
{
    HttpResponse.RemoveOutputCacheItem("/caching/CacheForever.aspx");
} 
```

来自：[http ://aspalliance.com/668](http://aspalliance.com/668)

谢谢。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-25T12:55:29.673

你的解决方案对我不起作用。但是......经过一些测试，我得到了这个工作正常。此代码将位于需要缓存的 UserControl Page_Load 中。

```
string key_refresh = "refresh_id_" + YourID;
Cache[key_refresh] = DateTime.Now.ToString();

CacheDependency dep = new CacheDependency(null, new string[] { key_refresh });
this.CachePolicy.Dependency = dep; 
```

出于某种原因，`Response.AddCacheItemDependency`当我从`Cache[key_refresh]`.

在我的例子中，我通过用户 ID 缓存我的控件，因此每个用户将拥有具有不同数据的该控件的不同版本，我使用 VaryByCustom 单独缓存它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-09T04:07:26.170

经过更多研究，我发现了一种似乎效果很好的方法。

```
Dim cachekey As String = String.Format("Calendar-{0}", calendarID)
HttpContext.Current.Cache.Insert(cachekey, DateTime.Now, Nothing, System.DateTime.MaxValue, System.TimeSpan.Zero, System.Web.Caching.CacheItemPriority.NotRemovable, Nothing)
Response.AddCacheItemDependency(cachekey) 
```

这将为页面缓存对象添加一个依赖项，然后过期我这样做：

```
Dim cachekey as string = String.Format("Calendar-{0}", CalendarID)
HttpContext.Current.Cache.Insert(cachekey, DateTime.Now, Nothing, System.DateTime.MaxValue, System.TimeSpan.Zero, System.Web.Caching.CacheItemPriority.NotRemovable, Nothing) 
```

现在只要知道依赖缓存键，页面就可以过期。

# sql - 面向对象的程序员如何才能理解数据库驱动的编程？

> ID：481582
> 
> 赞同：44
> 
> 时间：2009-01-26T22:08:04.247
> 
> 标签：sql, linq, database-design, oop

我已经使用 C# 和 Java 编程一年多了，并且对面向对象编程有相当的了解，但是我的新项目需要一个数据库驱动的模型。我正在使用 C# 和 Linq，这似乎是一个非常强大的工具，但我在围绕面向对象的方法设计数据库时遇到了麻烦。

我的两个主要问题是：

**如何处理数据库中的继承？** 假设我正在构建一个员工排班应用程序，并且我有一个抽象类 Event。从 Event 我派生出抽象类 ShiftEvent 和 StaffEvent。然后我有具体的类 Shift（派生自 ShiftEvent）和 StaffTimeOff（派生自 StaffEvent）。还有其他派生类，但为了论证，这些就足够了。

我应该为 ShiftEvents 和 StaffEvents 设置一个单独的表吗？也许我应该为每个具体类设置单独的表格？这两种方法似乎都会在与数据库交互时给我带来问题。另一种方法可能是拥有一个事件表，并且该表对于我的任何具体类中的每种类型的数据都有可为空的列。所有这些方法都感觉可能会阻碍未来的可扩展性。很可能还有第三种我没有考虑过的方法。

我的第二个问题：

**如何以面向对象的方式处理集合和一对多关系？**

假设我有一个 Products 类和一个 Categories 类。每个类别的实例都将包含一个或多个产品，但产品本身不应该知道类别。如果我想在数据库中实现这一点，那么每个产品都需要一个映射到类别表的类别 ID。但是从 OO 的角度来看，这引入了比我更喜欢的耦合。产品甚至不应该知道类别存在，更不用说包含类别 ID 的数据字段了！有没有更好的办法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-26T22:17:16.083

Linq to SQL 使用每个类的表解决方案：

[http://blogs.microsoft.co.il/blogs/bursteg/archive/2007/10/01/linq-to-sql-inheritance.aspx](http://blogs.microsoft.co.il/blogs/bursteg/archive/2007/10/01/linq-to-sql-inheritance.aspx)

其他解决方案（例如我最喜欢的 LLBLGen）允许使用其他模型。就个人而言，我喜欢带有鉴别器列的单表解决方案，但这可能是因为我们经常查询继承层次结构，因此将其视为普通查询，而查询特定类型只需要“where”更改。

总而言之，我个人觉得将 OO 映射到表中是本末倒置。不断有人声称 OO 和关系之间的阻抗不匹配已经解决......并且已经有大量的 OO 特定数据库。他们都没有取消这种关系的强大简单性。

相反，我倾向于在设计数据库时考虑到应用程序，将这些表映射到实体并从那里构建。有些人认为这是在设计过程中失去了面向对象，但在我看来，数据层不应该对您的应用程序进行足够高的讨论以影响高阶系统的设计，仅仅因为您使用了关系模型*进行存储*.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-26T23:10:52.090

我遇到了相反的问题：经过多年的数据库设计，我如何理解 OO。谈到这一点，十年前，经过多年的“结构化”平面文件编程，我遇到了对 SQL 的理解问题。类和数据实体分解之间有足够多的相似之处，从而误导您认为它们是等价的。他们不是。

我倾向于同意这样的观点，即一旦您致力于使用关系数据库进行存储，那么您应该设计一个规范化模型并在不可避免的情况下破坏您的对象模型。这是因为与使用自己的代码相比，您受 DBMS 的限制更多 - 构建受损数据模型更可能让您感到痛苦。

也就是说，在给出的示例中，您可以选择：如果 ShiftEvent 和 StaffEvent 在属性方面大多相似并且通常作为事件一起处理，那么我倾向于实现一个带有类型列的单个事件表。单表视图可以是分离子类的有效方法，并且在大多数数据库平台上都是可更新的。如果这些类在属性方面更加不同，那么每个类的表可能更合适。我认为我不喜欢三表的想法：在关系设计中很少需要“有一个或没有”关系。无论如何，您始终可以创建一个事件视图作为两个表的联合。

至于产品和类别，如果一个类别可以有很多产品，但反之不行，那么表示这一点的正常关系方式是产品包含一个类别 id。是的，是耦合，但也只是数据耦合，不是死罪。该列可能应该被索引，以便检索一个类别的所有产品是有效的。如果你真的被这个概念吓坏了，那就假装它是一个多对多的关系并使用一个单独的 ProductCategorisation 表。这没什么大不了的，尽管它暗示了一种实际上并不存在的潜在关系，并且可能会误导将来使用该应用程序的人。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-26T23:12:54.583

在我看来，这些范式（关系模型和 OOP）适用于不同的领域，使得尝试在它们之间创建映射变得困难（而且毫无意义）。

关系模型是关于表示*事实*（例如“A 是一个人”），即具有“独特性”属性的无形事物。谈论同一事实的几个“实例”是没有意义的——*事实*就是如此。

面向对象编程是一种编程范式，详细说明了一种构建计算机程序以满足特定标准（重用、多态性、信息隐藏......）的方法。一个*对象*通常是一些有形事物的隐喻——汽车、引擎、经理或人等。有形事物不是事实——可能有两个不同的对象具有相同的状态，但它们不是同一个对象（因此例如，Java 中的*equals和 ==）。*

Spring 和类似工具以编程方式提供对关系数据的访问，因此事实可以由程序中的对象表示。这并不意味着 OOP 和关系模型是相同的，或者应该相互混淆。使用 Realational Model 来设计数据库（事实的集合）和 OOP 来设计计算机程序。

**TL；DR 版本（对象-关系阻抗失配蒸馏）：**

事实=冰箱上的食谱。物品 = 你冰箱里的东西。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-26T22:16:28.737

框架如

1.  休眠[http://www.hibernate.org/](http://www.hibernate.org/)
2.  JPA [http://java.sun.com/developer/technicalArticles/J2EE/jpa/](http://java.sun.com/developer/technicalArticles/J2EE/jpa/)

可以帮你顺利解决这个继承问题。例如[http://www.java-tips.org/java-ee-tips/enterprise-java-beans/inheritance-and-the-java-persistenc.html](http://www.java-tips.org/java-ee-tips/enterprise-java-beans/inheritance-and-the-java-persistenc.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T04:54:46.623

在处理面向对象的方法之前，我还必须了解数据库设计、SQL，尤其是以数据为中心的世界观。对象关系阻抗不匹配仍然让我感到困惑。

我发现最接近它的处理方法是：不是从面向对象编程的角度，甚至从面向对象的设计角度，而是从面向对象的分析角度来看待对象。我得到的关于 OOA 的最好的书是 Peter Coad 在 90 年代初写的。

在数据库方面，与OOA比较的最佳模型不是数据的关系模型，而是实体-关系（ER）模型。ER 模型不是真正的关系模型，也没有指定逻辑设计。许多关系辩护者认为这是 ER 的弱点，但实际上是它的优势。ER 最好不要用于数据库设计，而是用于数据库的需求分析，也称为数据分析。

ER 数据分析和 OOA 惊人地相互兼容。ER 反过来与关系数据建模相当兼容，因此也与 SQL 数据库设计兼容。当然，OOA 与 OOD 兼容，因此也与 OOP 兼容。

这似乎是一个漫长的过程。但是如果你把事情保持得足够抽象，你就不会在分析模型上浪费太多时间，而且你会发现克服阻抗不匹配非常容易。

在学习数据库设计方面要克服的最大问题是：您在问题中反对的外键到主键链接之类的数据链接根本不可怕。它们是将相关数据捆绑在一起的本质。

预数据库和预面向对象系统中存在一种现象，称为涟漪效应。连锁反应是对大型系统的看似微不足道的更改最终导致整个系统所需的更改。

OOP 主要通过封装和信息隐藏来包含涟漪效应。

关系数据建模主要通过物理数据独立性和逻辑数据独立性来克服连锁反应。

从表面上看，这两种思维方式似乎是根本矛盾的。最终，您将学习如何充分利用它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T22:19:06.500

我的猜测是：

关于继承的话题，我建议有 3 个表：Event、ShiftEvent 和 StaffEvent。事件具有类似于最初定义的通用数据元素。

最后一个可以走另一条路，我想。您可以有一个包含类别 ID 和产品 ID 的表，其中没有其他列，对于给定的类别 ID，这将返回产品，但产品可能不需要获取类别作为其描述自身的一部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T22:23:20.097

一个大问题：你怎么能理解它？只需要练习。您尝试实现数据库设计，遇到设计问题，重构并记住下一次哪些有效，哪些无效。

要回答您的具体问题......这是一些意见，如“我将如何做”，没有考虑到性能需求等。我总是从完全标准化开始，然后根据实际测试从那里开始：

```
Table Event
EventID
Title
StartDateTime
EndDateTime

Table ShiftEvent
ShiftEventID
EventID
ShiftSpecificProperty1

...

Table Product
ProductID
Name

Table Category
CategoryID
Name

Table CategoryProduct
CategoryID
ProductID 
```

还要重申 Pierre 所说的 - 像 Hibernate 这样的 ORM 工具可以更好地处理关系结构和 OO 结构之间的摩擦。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T22:23:22.110

为了将继承树映射到关系模型，有几种可能性。例如，NHibernate 支持“每个类层次结构的表”、每个子类的表和每个具体类的表策略： [http ://www.hibernate.org/hib_docs/nhibernate/html/inheritance.html](http://www.hibernate.org/hib_docs/nhibernate/html/inheritance.html)

对于您的第二个问题：您可以在数据库中创建一个 1:n 关系，其中 Products 表具有到 Categories 表的外键。但是，这并不意味着您的 Product Class 需要引用它所属的 Category 实例。您可以创建一个 Category 类，其中包含一组产品或产品列表，并且您可以创建一个产品类，它没有所属 Category 的概念。同样，您可以使用 (N)Hibernate 轻松完成此操作； [http://www.hibernate.org/hib_docs/reference/en/html/collections.html](http://www.hibernate.org/hib_docs/reference/en/html/collections.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-26T22:31:44.277

听起来您正在发现[Object-Relational Impedance Mismatch](http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-26T22:32:41.747

> 产品甚至不应该知道类别存在，更不用说包含类别 ID 的数据字段了！

我不同意这里，我认为不是提供类别 ID，而是让你的 orm 为你做。然后在代码中你会有类似的东西（借用 NHib 和 Castle 的 ActiveRecord）：

```
class Category
  [HasMany]
  IList<Product> Products {get;set;} 
```

...

```
class Product
  [BelongsTo]
  Category ParentCategory {get;set;} 
```

然后，如果您想查看您所在的产品类别，您只需执行以下简单操作：

```
Product.ParentCategory 
```

我认为您可以以不同的方式设置 orm，但是对于继承问题，无论哪种方式，我都会问...您为什么在乎？要么处理对象而忘记数据库，要么以不同的方式进行。可能看起来很傻，但除非你真的不能拥有一堆表，或者出于某种原因不想使用单个表，否则你为什么要关心数据库？例如，我有几个继承对象的相同设置，我只是去做我的事。我还没有查看实际的数据库，因为它与我无关。底层 SQL 是我所关心的，以及返回的正确数据。

如果您必须关心数据库，那么您将需要修改您的对象或提出自定义的做事方式。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-26T22:51:43.783

我想在这里有点实用主义会很好。对象和表之间的映射总是在这里和那里有点奇怪。这就是我所做的：

我使用 Ibatis 与我的数据库通信（Java 到 Oracle）。每当我有一个希望将子类存储在数据库中的继承结构时，我都会使用“鉴别器”。这是一个技巧，您可以为所有类（类型）提供一个表，并拥有您可能想要存储的所有字段。表中有一个额外的列，包含一个字符串，Ibatis 使用它来查看它需要返回哪种类型的对象。

它在数据库中看起来很有趣，有时会让你陷入与并非所有类中的字段的关系的麻烦，但在 80% 的情况下，这是一个很好的解决方案。

关于类别和产品之间的关系，我会在产品中添加一个 categoryId 列，因为这会让生活变得非常简单，无论是 SQL 还是 Mapping。如果你真的坚持做“理论上正确的事情”，你可以考虑一个额外的表，它只有 2 个列，连接类别及其产品。它会起作用，但通常这种结构仅在您需要多对多关系时使用。

尽量保持简单。有一个“学术解决方案”很好，但通常意味着有点矫枉过正，而且因为太抽象而难以重构（比如隐藏 Category 和 Product 之间的关系）。

我希望这有帮助。

# java - 在服务器集群上部署 Java 应用程序的最佳方式是什么？

> ID：481584
> 
> 赞同：5
> 
> 时间：2009-01-26T22:08:16.087
> 
> 标签：java, deployment, cluster-computing

我有一个由 32 台服务器组成的集群，我需要一个工具来将 Java 服务（打包为 Jar 文件）分发到每台机器并远程启动该服务。该集群由 Linux (Suse 10) 服务器组成，每个刀片有 8 个内核。该应用程序是一个使用 Oracle Coherence 的数据网格。执行此操作的最佳工具是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T22:14:54.293

[我曾经问过类似](https://stackoverflow.com/questions/333626/how-to-create-a-linux-cluster-for-running-physics-simulations-in-java)的问题，似乎 Java 并行处理框架可能是您需要的：

[http://www.jppf.org/](http://www.jppf.org/)

从网站：

> JPPF 是一个用 Java 编写的开源网格计算平台，可以轻松并行运行应用程序，并将其执行速度提高几个数量级。一次编写，一次部署，到处执行！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-02T07:51:36.717

看看 OpenMOLE：[http ://www.openmole.org/](http://www.openmole.org/)

该工具使您能够将计算工作流分配到多个资源：从多核机器到集群和计算网格。

它有很好的文档记录，可以通过 groovy 代码或 GUI 进行控制。

使用 OpenMOLE 在集群上分发 jar 应该很容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-23T19:16:58.837

使用比特洪流。在集群上使用点对点共享方式可以真正提高您的部署速度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T22:18:22.103

您的服务是否打包为 EJB？JBoss 在集群方面做得相当好。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-26T22:18:51.870

这取决于您拥有的操作系​​统以及如何在网络上设置安全性。

如果您可以使用 NFS 或 Windows Share，我建议您将软件放在对所有机器可见的 NFS 驱动器上。这样你就可以从一个副本中运行它们。

如果您有远程外壳或安全远程外壳，您可以编写一个脚本，在每台机器上运行相同的命令，例如在所有机器上启动，或在所有机器上停止。

如果你有 Windows，你可能想在每台机器上设置一个服务。如果你有 linux，你可能想为每台机器添加一个启动/关闭脚本。

当您拥有多台机器时，拥有一个工具来监控您的所有服务是否正在运行、在一个地方收集日志和错误和/或允许您从 GUI 启动/停止它们可能会很有用。有很多工具可以做到这一点，不确定现在哪个是最好的。

# .net - System.Web.Caching.Cache 在 ASP.Net MVC 应用程序中有意义吗？

> ID：481585
> 
> 赞同：3
> 
> 时间：2009-01-26T22:08:49.643
> 
> 标签：.net, asp.net, asp.net-mvc, session, caching

由于 ASP.Net MVC 中没有会话的概念，并且每个请求彼此独立，我是否会使用 Cache 对象在内部缓存数据以最小化数据库访问？输出缓存功能非常适合缓存视图数据，但是如果我想缓存应该在来自同一用户的请求之间共享的用户配置文件之类的内容，我会怎么做？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T22:27:05.907

MVC 中肯定有会话的概念……会话数据是跨请求持久化的。我认为您可能会混淆 ViewState，它在回发到同一页面时持续存在，并且不适用于 MVC。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T22:22:24.590

使用会话？

会话是每个用户的会话缓存对每个人都是站点范围的

我想你可以在控制器上使用缓存。

# sql - 通过要求所有多个满足条件来过滤一对多查询

> ID：481588
> 
> 赞同：5
> 
> 时间：2009-01-26T22:09:39.017
> 
> 标签：sql, mysql, join, one-to-many

想象以下表格：

创建表格框（id int，名称文本，...）；

创建表 thingsinboxes(id int, box_id int, thing enum('apple,'banana','orange');

表格看起来像：

```
盒子：
编号 | 姓名
1 | 只有橘子
2 | 只有橘子2
3 | 橙子香蕉
4 | 杂项

收件箱：
编号 | box_id | 事物
1 | 1 | 橙
2 | 1 | 橙
3 | 2 | 橙
4 | 3 | 橙
5 | 3 | 香蕉
6 | 4 | 橙
7 | 4 | 苹果
8 | 4 | 香蕉

```

如何选择至少包含一个橙色且没有不是橙色的框？

假设我有几十万个盒子，而且盒子里可能有一百万个东西，这个规模如何？

如果可能的话，我想把这一切都保存在 SQL 中，而不是用脚本对结果集进行后处理。

我同时使用 postgres 和 mysql，所以子查询可能很糟糕，因为 mysql 不优化子查询（无论如何都是 6 之前的版本）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T22:19:54.660

```
SELECT b.*
FROM boxes b JOIN thingsinboxes t ON (b.id = t.box_id)
GROUP BY b.id
HAVING COUNT(DISTINCT t.thing) = 1 AND SUM(t.thing = 'orange') > 0; 
```

* * *

这是另一个不使用 GROUP BY 的解决方案：

```
SELECT DISTINCT b.*
FROM boxes b
  JOIN thingsinboxes t1 
    ON (b.id = t1.box_id AND t1.thing = 'orange')
  LEFT OUTER JOIN thingsinboxes t2 
    ON (b.id = t2.box_id AND t2.thing != 'orange')
WHERE t2.box_id IS NULL; 
```

与往常一样，在对查询的可扩展性或性能做出结论之前，**您必须**使用真实的数据集进行尝试，并衡量性能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T22:45:05.560

`thing`我认为 Bill Karwin 的查询很好，但是如果相对较小比例的盒子包含橘子，您应该能够通过在字段上使用索引来加快速度：

```
SELECT b.*
FROM boxes b JOIN thingsinboxes t1 ON (b.id = t1.box_id)
WHERE t1.thing = 'orange'
AND NOT EXISTS (
    SELECT 1
    FROM thingsinboxes t2
    WHERE t2.box_id = b.id
    AND t2.thing <> 'orange'
)
GROUP BY t1.box_id 
```

子查询每个橙色的`WHERE NOT EXISTS`东西只会运行一次，所以如果没有很多橘子，它不会太贵。

# c# - 为什么这个 NUnit+Moq 测试失败了？

> ID：481592
> 
> 赞同：2
> 
> 时间：2009-01-26T22:11:17.703
> 
> 标签：c#, nunit, moq

我希望你知道，因为我没有看到。无论谁弄清楚如何实现此测试试图实现的目标，都会获得奖励积分。

```
using NUnit.Framework;
using Moq;

[TestFixture]
public class MoqHuh
{
    public class A {}
    public class B : A {}

    public interface IHelper
    {
        void DoIt(A a);
    }

    [Test]
    public void Huh()
    {
        var mock = new Mock<IHelper>();
        mock.Expect(helper => helper.DoIt(It.IsAny<B>())).Verifiable();

        mock.Object.DoIt(new B());

        mock.VerifyAll();
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T09:30:59.333

原来这是一种飞行员错误。我错误地认为 Moq 在 Mono 上运行良好。（看起来效果很好）。此问题仅在使用 mono 的 gmcs 编译时发生，而不是在使用 Microsofts csc 编译时发生。

我已向 mono 团队报告了相应的错误，并将继续确保在使用 mono 的 gmcs.exe 编译时完整的 Moq 测试套件通过

对不起，噪音。

卢卡斯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T23:15:01.427

这个测试工作正常。

由于没有被测系统，您正在测试最小起订量是否按预期工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T00:34:09.803

对不起，不够清楚。我正在测试的确实是 Mock 的行为符合我的预期。对我来说，上面的测试失败了。我很惊讶听到它通过了你。我在 VisualStudio 2008 中运行测试。我刚刚升级到 Moq 2.6，但测试仍然失败。您使用哪个版本的 Moq 并通过此测试？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T19:30:56.850

这不适用于主干中的最新版本（3.0 beta）

# ruby-on-rails - 带有模型模式信息的注释块何时由 rails 更新？

> ID：481599
> 
> 赞同：21
> 
> 时间：2009-01-26T22:13:34.500
> 
> 标签：ruby-on-rails

在一些 Rails 模型定义中，顶部有一个包含模式信息的注释块。

```
# == Schema Information                                   
# Schema version: 20090122060318                          
#                                                         
# Table name: table_name
#                                                         
#  id            :integer(4)      not null, primary key   
... 
```

这个什么时候更新？当您使用生成器脚本创建模型时，它是否只生成一次？执行迁移时有没有办法更新这个块？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-26T22:25:48.407

似乎是[annotate_models](https://github.com/ctran/annotate_models)插件的输出。只需安装它并`annotate`在您的 Rails 根目录中运行，架构信息就会自动更新。理想情况下，在每次迁移后运行它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T09:43:33.383

您也可以使用**annotate-models** gem。由于不需要插件，因此侵入性较小。

用法：

```
% gem install annotate
% annotate
Annotated Product, User, Role 
```

# javascript - 如何在 jQuery.each() util 中跳到下一次迭代？

> ID：481601
> 
> 赞同：455
> 
> 时间：2009-01-26T22:14:14.937
> 
> 标签：javascript, jquery, iteration

我正在尝试遍历一组元素。jQuery 的文档说：

[jquery.Each() 文档](http://docs.jquery.com/Utilities/jQuery.each#objectcallback)

> 返回非 false 与 for 循环中的 continue 语句相同，它将立即跳到下一次迭代。

我试过调用'return non-false;' 和“非假”；（无返回）两者都不会跳到下一次迭代。相反，他们打破了循环。我错过了什么？

* * *

## 回答 #1

> 赞同：814
> 
> 时间：2009-01-26T22:16:07.100

他们所说的非假的意思是：

```
return true; 
```

所以这段代码：

```
var arr = ["one", "two", "three", "four", "five"];
$.each(arr, function(i) {
  if (arr[i] == 'three') {
    return true;
  }
  console.log(arr[i]);
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
```

将记录`one`, `two`, `four`, `five`.

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-01-26T22:18:50.060

通过'return non-false'，他们的意思是返回任何不适合布尔假的值。所以你可以返回`true`, `1`, `'non-false'`, 或者任何你能想到的东西。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-26T23:27:09.983

Javascript 有点“真实”和“虚假”的概念。如果一个变量有一个值，那么通常是 9，如您所见）它具有“真实性” - 空值，或者没有值倾向于“虚假性”。下面的片段可能会有所帮助：

```
var temp1; 
if ( temp1 )...  // false

var temp2 = true;
if ( temp2 )...  // true

var temp3 = "";
if ( temp3 ).... // false

var temp4 = "hello world";
if ( temp4 )...  // true 
```

希望这有帮助吗？

此外，值得一试 Douglas Crockford 的这些视频

更新：感谢@cphpython 发现损坏的链接 - 我现在已经更新指向工作版本

[Javascript 语言](https://www.youtube.com/watch?v=v2ifWcnQs6M)

[Javascript - 好的部分](https://www.youtube.com/watch?v=_DKkVvOt6dk)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-07-30T16:26:13.630

不要忘记，有时您可能会从块的末尾掉下来进行下一次迭代：

```
$(".row").each( function() {
    if ( ! leaveTheLoop ) {
        ... do stuff here ...
    }
}); 
```

而不是像这样实际返回：

```
$(".row").each( function() {
    if ( leaveTheLoop ) 
        return; //go to next iteration in .each()
    ... do stuff here ...
}); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-09-23T21:44:45.200

仅当您按字面返回时，循环*才会*`false`中断。前任：

```
// this is how jquery calls your function
// notice hard comparison (===) against false
if ( callback.call( obj[ i ], i, obj[ i ] ) === false ) {
   break;
} 
```

这意味着您可以返回任何其他内容，包括`undefined`，如果您不返回任何内容，则返回该内容，因此您可以简单地使用一个空的 return 语句：

```
$.each(collection, function (index, item) {
   if (!someTestCondition)
      return; // go to next iteration

   // otherwise do something
}); 
```

这可能因版本而异；这适用于 jquery 1.12.4。但实际上，当您退出函数的底部时，您也没有返回任何内容，这就是循环继续进行的原因，所以我希望没有任何返回内容*无法*继续循环的可能性。除非他们想强迫每个人都开始返回一些东西来保持循环，否则什么都不返回必须是保持循环*的*一种方式。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2016-08-22T10:13:08.627

[jQuery.noop()](http://api.jquery.com/jQuery.noop/)可以提供帮助

```
$(".row").each( function() {
    if (skipIteration) {
        $.noop()
    }
    else{doSomething}
}); 
```

# php - 如何通过 AJAX 请求验证用户？

> ID：481602
> 
> 赞同：3
> 
> 时间：2009-01-26T22:14:21.473
> 
> 标签：php, ajax, authentication

我们有一个网页，我们通过 iFrame 向合作公司提供。iFrame 包含几个 javascript 文件，它们向我们的服务器发出 ajax 请求以获取数据。iFrame 本身需要一个与合作伙伴的域绑定的 API 密钥。如果 iFrame 安装在未注册的域上，这将防止显示 iFrame。但是，很容易从注册站点复制 iFrame 的内容和 javascript 文件并将它们托管在未注册站点上。

理想情况下，我们希望使用 API 密钥来限制 Ajax 请求并阻止我们的服务器为非注册站点提供请求的数据。但是，似乎没有为 Ajax 请求设置 HTTP_REFERER 服务器变量。我们如何知道请求来自哪个站点？可能吗？如果没有，我们如何防止未经授权的访问？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T01:57:50.820

依靠 HTTP_REFERER 不是要走的路。您希望客户的网站使用 API 通过安全链接与您的网站联系，并获取临时会话字符串，然后将其用作 IFRAME 的源 url 的一部分，这就是 google 的做法（而不是使用 referer. )

使 IFRAME 的 url 在有限的时间内有效，之后您会显示一条关于返回客户端页面重新开始的好消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T22:22:34.827

当请求 iframe 时，您可以在服务器上生成唯一 ID，然后将其设置为客户端上的 cookie。每个 AJAX 请求都应该包含该 cookie。仅在最后一个小时左右保留 ID。

您永远不能依赖 HTTP_REFERER，因为某些代理服务器和防火墙会将其剥离以保护用户的隐私。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T22:35:02.787

挑战在于 iframe 被授权给特定域，因此我的 API 密钥与此相关联。我按照以下教程生成我的 API 密钥。

[https://ajax.dev.java.net/ajax/api-keys](https://ajax.dev.java.net/ajax/api-keys)

你认为依赖 HTTP_REFERER 变量会阻止用户访问 iframe 吗？Sun 声称 Google 使用这种方法进行 Google Maps API 身份验证。

一旦 API 密钥通过身份验证，我认为 cookie 方法应该可以解决问题。谢谢！

# c# - 设置/扩展列表 c#中的长度

> ID：481603
> 
> 赞同：10
> 
> 时间：2009-01-26T22:14:36.043
> 
> 标签：c#, list

给定`List<T>`c# 中的 a 有没有办法扩展它（在其能力范围内）并将新元素设置为`null`？我想要一些像`memset`. 我不是在这里寻找糖，我想要快速的代码。我知道在 C 中，该操作可以通过每个条目 1-3 个 asm 操作来完成。

我找到的最好的解决方案[是](https://stackoverflow.com/questions/481334/best-c-data-structure-for-random-order-population#481350)：

```
list.AddRange(Enumerable.Repeat(null, count-list.Count)); 
```

但是，这是 c# 3.0（首选<3.0）并且可能正在生成和评估枚举数。

我当前的代码使用：

```
while(list.Count < lim) list.Add(null); 
```

所以这是时间成本的起点。

这样做的[动机](https://stackoverflow.com/questions/481334/best-c-data-structure-for-random-order-population)是我需要设置第 n 个元素，即使它在旧 Count 之后。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-26T22:32:26.473

最简单的方法可能是创建一个临时数组：

```
list.AddRange(new T[size - count]); 
```

`size`所需的新大小在哪里，并且`count`是列表中的项目数。~~但是，对于相对较大的 值`size - count`，这可能会导致性能下降，因为它会导致列表多次重新分配。~~( `*`) 它还具有分配额外临时数组的缺点，根据您的要求，这可能是不可接受的。您可以通过使用以下方法以牺牲更明确的代码为代价来缓解这两个问题：

```
public static class CollectionsUtil
{
    public static List<T> EnsureSize<T>(this List<T> list, int size)
    {
        return EnsureSize(list, size, default(T));
    }

    public static List<T> EnsureSize<T>(this List<T> list, int size, T value)
    {
        if (list == null) throw new ArgumentNullException("list");
        if (size < 0) throw new ArgumentOutOfRangeException("size");

        int count = list.Count;
        if (count < size)
        {
            int capacity = list.Capacity;
            if (capacity < size)
                list.Capacity = Math.Max(size, capacity * 2);

            while (count < size)
            {
                list.Add(value);
                ++count;
            }
        }

        return list;
    }
} 
```

这里唯一的 C# 3.0 是使用 " `this`" 修饰符来使它们成为扩展方法。删除修饰符，它将在 C# 2.0 中工作。

不幸的是，我从来没有比较过两个版本的性能，所以我不知道哪个更好。

哦，你知道你可以通过调用来调整数组的大小[`Array.Resize<T>`](http://msdn.microsoft.com/en-us/library/bb348051.aspx)吗？我不知道。:)

**更新：（**
）`*`使用`list.AddRange(array)`不会导致使用枚举器*。*通过 Reflector 进一步查看显示该数组将被强制转换为`ICollection<T>`，并且该`Count`属性将被使用以便分配只进行一次。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T22:20:33.003

```
static IEnumerable<T> GetValues<T>(T value, int count) {
   for (int i = 0; i < count; ++i)
      yield return value;
}

list.AddRange(GetValues<object>(null, number_of_nulls_to_add)); 
```

这将适用于 2.0+

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-01-26T22:18:52.993

你为什么要那样做？List 的主要优点是它可以根据需要增长，那么为什么要向它添加许多 null 或默认元素呢？

在这种情况下使用数组不是更好吗？

# .htaccess - .htaccess - 重写然后隐藏部分网址？

> ID：481615
> 
> 赞同：1
> 
> 时间：2009-01-26T22:17:45.943
> 
> 标签：.htaccess

我的 .htaccess 中有以下 RewriteRule：

```
RewriteRule ^products/([A-Za-z0-9-\s\@]+)/([A-Za-z0-9-\s\@]+)/?$ /store/products/product.php?prod=$1&src=$2 [L,QSA] 
```

它需要一个网址，例如：

```
http://example.com/store/products/lawnmower/blogThatLovesUs 
```

并在此处显示页面：

```
http://example.com/store/products/product.php?prod=lawnmower&src=blogThatLovesUs 
```

有没有办法可以编辑这个 RewriteRule 以便用户看到

```
http://example.com/store/products/lawnmower/(sans blogThatLovesUs) 
```

在他们的地址栏中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T22:22:37.197

当然，您可以这样做，但在此过程中您会丢失您的会员 ID (blogThatLovesUs)。您可以使用原始 URL 进行重定向，然后让生成的页面 (product.php) 在会话中缓存附属值，然后在 PHP 中执行标准重定向（使用 header()）到更新的 URL，而不使用附属价值。那有意义吗？

我想说明得更清楚：

**网址**： http: [//photojojo.com/store/products/lawnmower/blogThatLovesUs](http://photojojo.com/store/products/lawnmower/blogThatLovesUs)

通过 RewriteRule 你最终得到：

**网址**：[http ://photojojo.com/store/products/product.php?prod=lawnmower&src=blogThatLovesUs](http://photojojo.com/store/products/product.php?prod=lawnmower&src=blogThatLovesUs)

此时，在 product.php 中，您将 blogThatLovesUs 存储在 session 中的某处，然后：

```
<?php
    header("Location: http://photojojo.com/store/products/lawnmower/");
?> 
```

让浏览器访问您希望它们访问的 URL。

# ruby-on-rails - 生成 Rails 应用程序中使用的数据库模式的图像

> ID：481618
> 
> 赞同：32
> 
> 时间：2009-01-26T22:18:23.743
> 
> 标签：ruby-on-rails, database, ruby-on-rails-4, schema

如何生成 Rails 应用程序中使用的数据库模式的图像？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T22:20:48.073

你试过`rake db:schema:dump`吗？

本质上，确保您的`database.yml`文件引用了您希望转储的数据库，然后运行该命令。它将获取所述数据库中的所有表和索引，然后将其写入`schema.rb`.

请注意，`schema.rb`一旦它包含转储，您应该重命名；否则，它可能会被覆盖。

# java - Java/GWT 开发人员的 Flex 2D 图形学习路径？

> ID：481619
> 
> 赞同：0
> 
> 时间：2009-01-26T22:18:43.257
> 
> 标签：java, apache-flex, graphics, image-manipulation, 2d

我已经使用 Java 开发了几年，过去六个月我一直在构建基于 GWT 的应用程序。但我几乎没有 Flash 或 Action Script 经验，我想尝试使用 Flex 进行一些爱好编程。尤其是 2D 图形和图像处理将是有趣的话题。

Adobe 的 Java 开发人员教程自然是起点，但我需要一些图形指针。比如根据来自服务器的数据绘制 2D 图形或修改用户上传的图像。在 Flex 上可以做多少，在服务器端必须做些什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T22:49:56.487

对于绘图，您不需要“完整”的 flex 库，flex 主要会为您提供一组不错的 GUI 组件和一些与后端服务器轻松集成的方法。

如果您只想绘制一些东西，请查看 Graphics 对象[http://livedocs.adobe.com/flex/3/langref/flash/display/Graphics.html](http://livedocs.adobe.com/flex/3/langref/flash/display/Graphics.html) - 它的工作方式类似于 java Graphics 对象。

如果您想修改用户上传的图像，您当然已经在服务器上（因为图像已上传） - 但是新的 Flash 播放器（版本 10）也允许对本地数据进行一些操作，所以它甚至可能是可以显示甚至没有上传的修改图像，请参阅[http://www.mikechambers.com/blog/2008/08/20/reading-and-writing-local-files-in-flash-player-10/](http://www.mikechambers.com/blog/2008/08/20/reading-and-writing-local-files-in-flash-player-10/)例子。

对于 java 程序员来说，Flex/AS3 会觉得有点奇怪——它的一部分非常容易，而其他部分会令人沮丧，工具支持更差，编译器速度慢，不支持运行单元测试而不跳过很多圈（不要得到我开始...）。但作为一个部署平台我必须说我非常喜欢它。

# web-applications - IIS 5.1/6.0 与 DataGrid 和 SqlDataSource 刷新的区别

> ID：481625
> 
> 赞同：0
> 
> 时间：2009-01-26T22:19:39.793
> 
> 标签：web-applications, caching, iis-6, sqldatasource, iis-5

我在这里遇到了一个奇怪的问题......

我有一个 ASP.NET 3.5 应用程序，它在 Default.aspx 上有一个 GridView 和一个 SqlDataSource。GridView 数据绑定到 SqlDataSource。GridView 的每一行都有一个名为“View”的按钮，它将用户发送到可以编辑该行的单独页面。

我有这个应用程序的两个安装 - 一个在我的开发笔记本电脑上，它是运行 IIS 5.1 的 XP，另一个在运行 IIS 6.0 的 Windows 2003 服务器上。web.config 文件相同，IIS 配置属性相同，并且访问的是同一个数据库。

在我的笔记本电脑上，我看到的行为是“正确的”，如下所示： 1\. 打开页面，通过分页链接选择数据网格的第 15 页。2\. 单击记录的查看按钮，查看编辑页面。3\. 单击“返回”按钮，您将返回到 Default.aspx 页面，并重新加载/刷新 GridView 并使用新数据。再次单击查看会将您带到正确的项目。

在服务器上，我看到： 1\. 打开页面，通过分页链接选择数据网格的第 15 页。2\. 单击记录的查看按钮，查看编辑页面。3\. 单击“返回”按钮，您将返回到 Default.aspx 页面，并且 GridView**不会**重新加载新数据（它会立即弹出）。再次单击查看会将您带到**错误**的项目。

显然存在某种缓存问题，但我无法弄清楚......有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-28T14:18:48.153

我不确定它的确切原因或原因，但正如我所料，这是一个缓存问题。当我添加语句时：

```
Response.CacheControl = "no-cache"; 
```

对于 Default.aspx.cs，问题就消失了。后退按钮搞砸了请求模式并不奇怪，但我确实发现我笔记本电脑上运行的 IIS 5.1 比 IIS 6.0 更好地处理后退按钮......

# legacy-code - 哪些继承的代码给您留下了深刻的印象或启发？

> ID：481628
> 
> 赞同：8
> 
> 时间：2009-01-26T22:20:04.910
> 
> 标签：legacy-code

多年来，我听到了大量关于我们开发人员必须使用的继承项目的抱怨。WTF 网站有大量的代码示例，让我忍不住喃喃自语“WTF？”

但是你们中的任何人是否真的被呈现给你的代码，“天哪，这是经过深思熟虑的！” 或“哇，我从来没想过！”

您必须使用哪些继承代码让您微笑，为什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T22:45:11.347

很久以前，我负责 Turbo C/C++ 运行时库。Tanj Bennett 用 16 位汇编器编写了最初的 80x87 浮点仿真器。我没有仔细查看 Tanj 的代码，因为它运行良好并且不需要关注。但是我们正在转向 32 位，而扩展模拟器的任务落到了我的肩上。

如果可以说编程与艺术有共同之处，那就是它了。

Tanj 的核心数学函数设法将 80 位浮点临时结果保存在五个 16 位寄存器中，而无需从内存中保存和恢复它们。X86 汇编程序员会明白这是何等的成就。寄存器空间稀缺，在进行复杂数学运算的同时保留五个寄存器作为您的临时工是一个值得一看的美丽网站。

如果这只是一个聪明的编码问题就足以将其定性为艺术，但它不仅如此。Tanj 仔细挑选了最适合将温度保存在寄存器中的底层数学算法。结果是一个超快的浮点仿真器，这对我们的许多客户来说是一个重要的卖点。

到 386 出现时，大多数关心浮点性能的人都没有使用仿真器，但我们必须支持 Intel 的 386SX，因此仿真器需要大修。我重写了指令解码逻辑和异常处理，但核心数学函数完全保持不变。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T22:51:10.273

最让我印象深刻并且我试图模仿的代码是看起来太简单易懂的代码。

写这样的代码真是太难了。:-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T23:24:00.257

在我的第一份工作中，我惊讶地发现代码库 (c++) 中有一个“安全 ID”类，该类将数字 ID 包装在一个以空标记类为模板的类中，以确保编译器在你尝试时会抱怨例如将 UserId 比较或分配给 OrderId。

我不仅确保在我将使用的所有后续代码库中都有一个等效的 Id 类，而且它实际上让我看到了编译器可以做些什么来保证正确性并帮助编写更强大的代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T23:23:17.853

我在这里有一个有趣的故事要讲。

我正在开发这个 Javaish 应用程序，里面装满了 getter 和 setter，它们除了 get 或 set 和接口之外什么都不做，而且发明了一切使代码不可读的东西。有一天，我偶然发现了一些看起来制作精良的代码——它基本上是一个看起来非常优雅的算法实现 = 几行可读代码，尽管它尊重项目必须遵守的每一个可能的规则（它是自动检查样式的） .

我无法弄清楚团队中的哪些人可以编写这样的代码。我很想和他讨论并分享想法。值得庆幸的是，几个月前我们已经切换到颠覆（从 cvs），我很快就运行了 am 'svn blame'。我到处闲逛，在实现旁边看到我的名字。

我听说过人们不记得他们 6 个月前编写的代码的故事，维护代码是一场噩梦。我不敢相信会发生这样的事情：你怎么会忘记你写的代码？好吧，现在我确信它会发生。谢天谢地，代码很好并且易于扩展，所以我只经历了一半的故事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T22:36:57.637

我遇到了我公司另一位程序员的一些 VB6 代码，它们很好地处理了错误情况（无论是直接处理它们还是记录它们）。

以及一些相当复杂的代码，这些代码得到了很好的注释。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T22:37:00.070

我知道这会带来很多答案，例如，

“在我介入之前，我从来没有找到好的代码”和变体。

我认为真正的问题不在于没有优秀的编码人员或优秀的项目，而是存在过多的[NIH](http://en.wikipedia.org/wiki/Not_Invented_Here)综合症以及没有人喜欢其他人的代码这一事实。后者只是因为你必须付出智力来理解它，这比你需要理解自己的代码要付出更大的努力，所以你不喜欢它（它让你思考和工作）。

就我个人而言，我记得（我猜每个人都记得）一些非常糟糕的代码案例，但我也记得一些记录良好、优雅的代码。

目前，给我印象最深的项目是一个非常强大的动态工作流引擎，不仅因为它的简单性，还因为它的编码方式。我可以在这里和那里记住一些非常聪明的片段，以及一个漂亮的元编程库，它基于我的一些朋友开发的完整 IDL ( [Aspl.es](http://aspl.es/fact/index.php) )

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-26T23:29:58.293

我继承了一大堆写得很好的代码，我实际上花了 40 美元在网上找到了那个人，我去他家感谢了他。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T22:31:58.160

我认为 Rocky Lhotka 应该得到赞扬，但我最近不得不接触一个 CSLA.NET 应用程序{在我的私人实践中}，我对代码的有序性印象深刻。该应用程序运行得非常好，但客户需要一些扩展。原作者惨死，新人不老实。他不了解 CSLA.NET 的基于业务对象的方法，他想在没有任何花哨的框架的情况下，用干巴巴的 VB.NET 重新做一遍。

于是我接到了电话。看一个 WinForm 绑定和 CSLA.NET 的工作示例对很多事情很有启发性。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-26T22:37:49.520

Symbian OS - 无论如何，它的旧核心部分，可以追溯到 Psion 时代的部分，或者即使在今天仍然保持这种精神的人。

坐在它旁边，到处都是大电话公司雇用的最低价者创造的所有新垃圾。令人吃惊的是，您实际上可以从骨子里感觉到代码库是旧的还是新的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-26T23:06:12.163

我记得当我写关于类型推断的学士论文时，我的 Pascal-to-Pascal “编译器”是我的主管（用 Java）编写的 Parser 的扩展。据我所知，它的结构非常好，对于从未做过任何严肃的面向对象编程的我来说，这是一个相当大的启示。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-26T23:32:10.927

我一直在进行大量的 Eclipse 插件开发，并且经常不得不调试到实际的 Eclipse 源代码中。虽然我没有“继承”它，因为我不会继续研究它，但我一直对早期核心的设计和质量印象深刻。

# c# - 将域实体映射到多个表

> ID：481631
> 
> 赞同：1
> 
> 时间：2009-01-26T22:20:58.307
> 
> 标签：c#, nhibernate

我有一个对象（过滤器），它定义了这样的东西

```
public class Filter
{
    public int FilterId { get; set; }

        public string Name { get; set; }

        public IList<User> Users { get; set; }
} 
```

如果可能的话，我想将对象存储在多个表中（有时跨越多行）

给定这样的过滤器初始化：

```
Filter myFilter = new Filter();
myFilter.FilterId = 1;
myFilter.Name = "Name of my filter";
myFilter.Users.Add(new User("Joe", 10));
myFilter.Users.Add(new User("Jim", 20)); 
```

..我希望它保留在“Filter”和“Filter_User”表中

过滤器最终会得到：

1 我的过滤器名称

Filter_User 将包含

1 10（参考乔的身份证） 1 20（参考吉姆的身份证）

我一直在查看文档，我能找到的只是使用映射文件中的元素。但据我所知，它只会让我通过组件关系来做到这一点（即 Employee 和 EmployeeDetails - 1:1）

有人指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T22:31:32.827

我认为您只是在寻找多对多关联？您不受使用组件关系的限制。

你可以看看多对多映射类型？

```
<set name="Users" table="Filter_User">
  <key column="filterid" />
  <many-to-many column="userid" class="User" />
</set> 
```

# vb.net - 从 VB 6“风格”过渡到面向对象编程的建议

> ID：481638
> 
> 赞同：4
> 
> 时间：2009-01-26T22:22:56.370
> 
> 标签：vb.net, unit-testing, oop

我是小型 IT 部门的一名 vb.net 开发人员，但我在完全使用对象进行编程时遇到了麻烦。

我了解 OOP、设计模式、单元测试等的原理，但是在开发我的应用程序时，要么我的对象设计很差，要么我完全跳过了使用对象构建。我知道如何创建单元测试，但对我创建的单元测试没有信心。

我几乎只构建数据驱动的数据输入/报告类型的应用程序。在大多数情况下，大部分业务逻辑都在存储过程和 UDF 中的数据库中。我为内部和外部客户开发 ASP.NET 和 Winforms 应用程序。

我已经询问了 Stack 上的[小](https://stackoverflow.com/questions/282830/looking-for-small-open-source-vb-net-project-with-extensive-unit-testing) [项目](https://stackoverflow.com/questions/287646/looking-for-small-open-source-c-project-with-extensive-unit-testing)，我可以查看这些小项目以了解良好的设计和测试，但大多都很短。我读过很多关于设计的书。

摆脱旧的“VB 6”方式有哪些好的第一步？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T22:27:41.197

一位同事让我迷上了 Eric Evans 的《领域驱动设计》一书。它真的开始让我在必要时远离数据驱动的开发。

参与您所在地区的 .NET 用户组也将有助于您找到非常愿意帮助您的人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T06:29:39.163

我听到了，伙计。我也是，活在你的世界里。商务人士需要报告的世界。复杂的报告。使用复杂的存储过程轻松构建的报告。在这个世界上，很容易认为数据库为王，它驱动着应用程序。这种思路导致了复杂的数据库 TSQL 代码、视图、函数和存储过程。

当然，如果它确实是您需要的报告，那么复杂的 sql 语句可能就是答案。但是，您想知道如何跳出数据驱动的世界，进入面向对象的世界。

我认为典型的 OO 设计教程不会让你公正。谁在乎狗是动物的一种，而德国牧羊犬是狗的一种。这并不能解释您如何在工作中开展业务。此外，这只是 OO 继承的一个示例。大多数时候，其他 OO 模式（例如组合和依赖注入）更有用。

我认为您应该处理下一个项目或任务的方式是暂时忘记数据库。假设您生活在一个神奇的世界中，不必从数据库中获取数据，也不必将数据写回数据库。您生活在一个您的对象始终填充正确数据的世界中。首先在那个抽象世界中为您的对象建模。这样做之后，然后（并且只有那时）关注获取和写入数据库的混乱实现细节。数据库仅用于保存您的数据。您的数据是活跃的，因为您已经对其进行了建模以适应您的域规则。

理解 UML 将极大地帮助这种类型的建模。首先使用 UML 设计为您的域建模。然后对这些设计进行编码。然后使它们适应数据库的约束。

Eric Evans 的“领域驱动设计”是一本很棒的书，它将这一点和许多其他相关点牢牢记在心里。他指出，域建模是成功建模应用程序的关键要素。他接着指出，面向对象设计比任何其他类型的编程范式更适合领域建模。

祝你好运。一旦你接受了完全建模、完全类型化的对象世界，你就再也不想解析另一个数据集了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T23:12:23.367

1.  尝试从在 OOP 方法下开发的项目中读取代码。

2.  想象一下，如果您以正在阅读的示例进行编码，您的代码会是什么样子。

3.  对自己的代码要强硬，直到你满意为止，然后当你在 3 个月后阅读它时，你会发现许多其他新的东西可以改进它。

4.  记住 KISS 规则，所有部分都将适合您，因为您仍然遵循 OOP 原则进行编码。

5.  遵守纪律。屈服于旧方式很容易，但不要放弃。

记住 Dijkstra 的话：......当你做一些快速而肮脏的事情时，你突然想象我正在看着你的肩膀并对自己说“Dijkstra 不会喜欢这个”，嗯，这对我来说已经足够不朽了。

他住在我们每个人的内心=）。而你已经完成了最重要的事情，你真的很想学习如何去做。这是 VB6 开发人员转向 VB.NET 时遇到的主要障碍。

*   在VB6中它更容易。
*   在 VB6 中总是运行得更快。
*   是一样的……只是看起来更好。
*   VB6 有更多的功能。

看起来很熟悉？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T16:07:35.347

我推荐两件事：

1.  查看 UML 类图并使用 Visual Studio 中的类图工具。OOP 的目的是通过从对象的角度思考，使事物更加“概念化”，至少对我而言，类图有助于做到这一点。
2.  通读一些好的设计模式，比如装饰器或工厂方法模式。由于大多数设计模式都充分利用了面向对象的设计，并且通常也得到了很好的描述，因此它们确实可以帮助理解概念。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T16:22:29.670

几年前我在你的鞋子里。我记得读过一篇文章，估计你会花 6 个月到一年的时间来阅读有关面向对象开发的内容，然后才能开始“了解它”。

我一开始只是尝试在我的日常程序编程中引入对象。然后我尝试从 UI 中获得尽可能多的处理。然后我尝试为我的业务逻辑和数据访问创建“层”。我了解您的很多业务逻辑可能已经在数据库中，但如果发生变化，设置 BL 层也不会受到影响。现在它几乎可以作为一个通道。

我还有 Eric Evan 的领域驱动设计要读，但对我有帮助的几本书是“[面向对象的思维过程](https://rads.stackoverflow.com/amzn/click/com/0672326116)”和我目前正在阅读的一本书，“ [Microsoft .NET：为企业构建应用程序](http://www.amazon.com/Microsoft%C2%AE-NET-Architecting-Applications-PRO-Developer)” . 这本书虽然可能比你现在真正需要的要多，但它是第一本帮助我真正理解这些层以及如何实现它们的书。

不管怎样，祝你旅途愉快。请记住，这将是一个过程，而不是目的地！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-27T16:24:22.380

除了其他答案中给出的建议之外，您应该放弃 VB.NET 并学习 C#。

它不会为你做任何事情，但它会帮助你摆脱旧的思维方式。

# sql - 使用子选择优化查询

> ID：481645
> 
> 赞同：3
> 
> 时间：2009-01-26T22:26:35.067
> 
> 标签：sql, sql-server, optimization

我正在尝试生成一个销售报告，其中列出了每个产品 + 给定月份的总销售额。这有点棘手，因为产品的价格可能会在整个月内发生变化。例如：

*   从 1 月 1 日到 1 月 15 日，我的公司以每个 10 美元的价格销售 50 个小部件
*   在 1 月 15 日至 1 月 31 日期间，我的公司以每个 15 美元的价格销售了 50 多个小部件
*   一月份小部件的总销售额 = (50 * 10) + (50 * 15) = $1250

此设置在数据库中表示如下：

```
销售表
  Sale_ID 产品ID Sale_Date
  1 1 2009-01-01
  2 1 2009-01-01
  3 1 2009-01-02
             ...
  50 1 2009-01-15
  51 1 2009-01-16
  52 1 2009-01-17
             ...
  100 1 2009-01-31

价格表
  产品_ID销售_日期价格
  1 2009-01-01 10.00
  1 2009-01-16 15.00

```

在价格表中定义价格后，它将应用于从给定的 SaleDate 开始以给定的 ProductID 销售的所有产品。

基本上，我正在寻找一个返回数据的查询，如下所示：

```
期望的输出
  Sale_ID ProductID Sale_Date 价格
  1 1 2009-01-01 10.00
  2 1 2009-01-01 10.00
  3 1 2009-01-02 10.00
             ...
  50 1 2009-01-15 10.00
  51 1 2009-01-16 15.00
  52 1 2009-01-17 15.00
             ...
  100 1 2009-01-31 15.00

```

我有以下查询：

```
SELECT
    Sale_ID,
    Product_ID,
    Sale_Date,
    (
        SELECT TOP 1 Price
        FROM Prices
        WHERE
            Prices.Product_ID = Sales.Product_ID
            AND Prices.Sale_Date < Sales.Sale_Date 
        ORDER BY Prices.Sale_Date DESC
    ) as Price
FROM Sales 
```

**这行得通，但是有比嵌套子选择更有效的查询吗？**

在您指出在销售表中包含“价格”会更容易之前，我应该提一下该架构由另一个供应商维护，我无法更改它。万一这很重要，我使用的是 SQL Server 2000。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T22:47:08.053

最好避免这些类型的相关子查询。这是针对此类情况的经典技术。

```
选择  
    Sale_ID,  
    产品_ID,  
    发售日期，  
    p1.价格  
从销售作为 s
LEFT JOIN 价格 AS p1 ON s.ProductID = p1.ProductID  
    AND s.Sale_Date >= p1.Sale_Date  
左连接价格为 p2 ON s.ProductID = p2.ProductID  
    AND s.Sale_Date >= p2.Sale_Date  
    AND p2.Sale_Date > p1.Sale_Date  
WHERE p2.Price IS NULL -- 不希望找到这个

```

将定价表上的左外连接用作 p2，并查找 NULL 记录，证明在 p1 中找到的匹配产品价格记录是销售日期或之前的最新记录。

（我会在第一个价格匹配中加入，但如果没有，最好让产品出现，这样你就知道有问题了。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T22:49:34.083

如果您开始存储开始日期和结束日期，或者创建一个包含开始日期和结束日期的视图（您甚至可以创建索引视图），那么您可以大大简化您的查询。（前提是您确定没有范围重叠）

```
SELECT
    Sale_ID,
    Product_ID,
    Sale_Date,
    Price
FROM Sales
JOIN Prices on Sale_date > StartDate and Sale_Date <= EndDate  
-- careful not to use between it includes both ends 
```

笔记：

沿着这些思路的技术将允许您使用视图来执行此操作。请注意，如果您需要为视图编制索引，则必须对其进行相当多的处理..

```
create table t (d datetime)

insert t values(getdate())
insert t values(getdate()+1)
insert t values(getdate()+2)

go
create view myview 
as
select start = isnull(max(t2.d), '1975-1-1'), finish = t1.d  from t t1
left join t t2 on t1.d > t2.d
group by t1.d

select * from myview 

start                   finish
----------------------- -----------------------
1975-01-01 00:00:00.000 2009-01-27 11:12:57.383
2009-01-27 11:12:57.383 2009-01-28 11:12:57.383
2009-01-28 11:12:57.383 2009-01-29 11:12:57.383 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T22:39:36.710

您是否真的遇到了性能问题，或者您只是在预料到它们？如果从模式修改的角度来看，我的手和你的一样，我会完全按照你的方式实现这个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T23:50:48.690

我同意肖恩的观点。您编写的代码非常干净易懂。如果您遇到性能问题，请加倍努力使代码更快。否则，你会无缘无故地让代码变得更复杂。明智地使用嵌套子选择非常有用。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-26T22:36:49.400

Product_ID 和 Sale_Date 的组合是您的外键。尝试对 Product_ID、Sale_Date 进行选择加入。

# .net - SetClientCredential 在 vs.net 2005 中可见，但在 2008 中不可见

> ID：481653
> 
> 赞同：2
> 
> 时间：2009-01-26T22:30:56.837
> 
> 标签：.net, visual-studio, web-services, authentication, wse

我在 Visual Studio 2005 中添加了对我的 wse 3.0 服务的 Web 引用，并且我的智能感知显示了我的服务的名称，例如`MyServiceWse`（它在名称中添加了 WSE 扩展名）。

我也可以访问`SetClientCredentials()`我通过的地方`UsernameToken`，一切正常。

在 Visual Studio 2008 中，我没有代理类`MyServiceWse`，我`MyService`只有，所以我无权访问`SetClientCredentials()`etc。

到底是怎么回事？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T22:42:22.757

最后我读到，VS 2008 中不直接提供 WSE 支持。下面的链接中有一些手动技术，您可以尝试一下。我也在等待更好的解决方案。

[WSE 3.0 和 Visual Studio 2008？](http://social.msdn.microsoft.com/Forums/en-US/asmxandxml/thread/84299cff-5af6-4cef-8b6e-a8251df3d496/)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-27T10:16:48.057

WCF 将是比 WSE 更好的解决方案。WSE 已过时，已被 WCF 取代。

# windows - 从远程机器收集日志文件的最佳方法？

> ID：481664
> 
> 赞同：3
> 
> 时间：2009-01-26T22:35:30.760
> 
> 标签：windows, logfiles

我有超过 500 台机器分布在覆盖三大洲的 WAN 上。我需要定期收集每个刀片本地硬盘上的文本文件。每台服务器都运行 Windows server 2003，并且文件安装在一个共享上，该共享可以作为 \server\Logs 远程访问。每台机器都有许多文件，每个文件可以是几 Mb，并且可以通过压缩来减小大小。

到目前为止，我已经尝试使用 Powershell 脚本和一个简单的 Java 应用程序来进行复制。这两种方法都需要几天时间来收集 500Gb 左右的文件。有没有更快、更高效的更好解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T22:40:45.693

我想这取决于你用它们做什么......如果你要将它们解析为度量数据到数据库中，那么在每台机器上安装该解析实用程序以解析并加载到你的中央数据库中会更快同时。

即使您所做的只是压缩并复制到一个中央位置，在 .cmd 文件中设置这些命令并安排它在每个服务器上自动运行。然后，您将在所有这些服务器之间分配工作，而不是强迫您的一个本地系统完成所有工作。:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T22:40:15.977

想到的第一个改进是*不*发送整个日志文件，而只发送上次发送后的记录。这当然是假设文件是​​随着时间的推移而积累的，并且每次都不是全新的。

您可以通过多种方式实现这一点：如果文件具有您可以依赖的日期/时间戳，则通过过滤器运行它们，从考虑中删除较旧的记录并转储剩余部分就足够了。如果没有这样的鉴别器可用，我会跟踪发送的最后一个字节/行，并在发货前提前到那个位置。

无论哪种方式，目标都是只发布*新*内容。在我们自己的系统中，日志是通过一个服务传送的，该服务会在日志写入时复制它们。这需要一个小型服务来处理要写入的日志文件，但减少了捕获日志的延迟并极大地减少了带宽使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T05:41:34.267

每个服务器可能应该：

*   管理自己的日志文件（上传前开始新的日志，上传后删除已发送的日志）
*   命名文件（或添加元数据），以便服务器知道哪个客户端发送它们以及它们覆盖的时间段
*   发送前压缩日志文件（压缩 + FTP + 解压缩通常比单独的 FTP 更快）
*   将日志文件推送到中央位置（FTP 比 SMB 快，Windows FTP 命令可以使用“-s:scriptfile”自动执行）
*   当它因任何原因无法推送其日志时通知您
*   以交错的时间表执行上述所有操作（以避免中央服务器超载）
    *   也许使用服务器的最后一个 IP 八位字节乘以一个常数，以从午夜开始以分钟为单位偏移？

中央服务器可能应该：

*   接受发送的日志文件并将它们排队等待处理
*   优雅地处理两次接收相同的日志文件（应该忽略还是重新处理？）
*   根据需要解压缩和处理日志文件
*   根据您的保留策略删除/归档已处理的日志文件
*   当服务器最近没有推送其日志时通知您

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T23:07:42.923

我会执行以下操作：
编写一个在每台服务器上运行的程序，该程序将执行以下操作：
监控服务器上的日志
按照特定定义的计划压缩它们 将
信息传递给分析服务器。

编写另一个位于核心服务器上的程序，它执行以下操作：
当网络/cpu 不太忙时提取压缩文件。
（这可以是多线程的。）
这使用从终端计算机传递给它的信息来确定接下来要获取哪个日志。
不断解压缩并上传到您的数据库。

这应该为您提供一个解决方案，该解决方案可提供最新信息，并且停机时间最短。
缺点是相对一致的网络/计算机使用，但这通常是一件好事。

它还将允许轻松管理系统，以检测任何需要解决的问题或问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T04:38:57.110

NetBIOS 副本不如 FTP 快。问题是您不希望每台服务器上都有一个 FTP 服务器。如果您无法在每台服务器上本地处理日志文件，另一种解决方案是让所有服务器通过 FTP 将日志文件上传到您可以处理的中央位置。例如：

将 FTP 服务器设置为中央收集点。在每台服务器上安排任务以压缩日志文件并将存档通过 FTP 传输到中央 FTP 服务器。您可以编写一个程序，使用 schtasks.exe 之类的工具远程自动安排任务：

[KB 814596：如何使用 schtasks.exe 在 Windows Server 2003 中安排任务](http://support.microsoft.com/kb/814596)

您可能希望错开上传回 FTP 服务器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T22:41:34.867

我们这里有一个规模较小的类似产品。我们的解决方案是让生成日志文件的机器每天以随机交错的模式将它们推送到 NAT。这解决了更多基于拉的方法的许多问题，包括使服务器忙碌数天的堆积读写时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T22:54:42.357

听起来存储服务器的带宽不会饱和，因此您可以同时从不同位置的多个客户端拉取。主要问题是，减缓整个过程的瓶颈是什么？

# c - 复制一个 char*

> ID：481673
> 
> 赞同：15
> 
> 时间：2009-01-26T22:39:23.323
> 
> 标签：c, string

我有一个接受 char* 作为其参数之一的函数。我需要对其进行操作，但保持原始 char* 不变。本质上，我想创建这个 char* 的工作副本。看起来这应该很容易，但我真的很挣扎。

我的第一个（天真的）尝试是创建另一个 char* 并将其设置为等于原始值：

```
char* linkCopy = link; 
```

当然，这是行不通的，因为我所做的只是让它们指向同一个地方。

我应该使用 strncpy 来完成这个吗？

我尝试了以下方法，但它会导致崩溃：

```
char linkCopy[sizeof(link)] = strncpy(linkCopy, link, sizeof(link)); 
```

我错过了一些明显的东西......？

编辑：抱歉，我试图简化示例，但我在第二个示例中留下了一些较长的变量名。固定的。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-01-26T22:42:37.890

将为您提供指针的`sizeof`大小。这通常是 4 或 8，具体取决于您的处理器/编译器，但不是指向的字符串的大小。您可以使用 strlen 和 strcpy：

```
// +1 because of '\0' at the end
char * copy = malloc(strlen(original) + 1); 
strcpy(copy, original);
...
free(copy); // at the end, free it again. 
```

我已经看到一些答案建议使用`strdup`，但这是一个 posix 函数，而不是 C 的一部分。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-26T22:41:30.497

您可能想看看 strdup ( `man strdup`) 函数：

```
char *linkCopy = strdup(link);

/* Do some work here */

free(linkCopy); 
```

**编辑**：因为你需要它是标准的 C，所以正如其他人指出的那样：

```
char *linkCopy = malloc(strlen(link) + 1);
/* Note that strncpy is unnecessary here since you know both the size
 * of the source and destination buffers
 */
strcpy(linkCopy, link);

/* Do some work */

free(linkCopy); 
```

* * *

由于 strdup() 不在 ANSI/ISO 标准 C 中，如果它在编译器的运行时不可用，请继续使用：

```
/*
**  Portable, public domain strdup() originally by Bob Stout
*/

#include <stdlib.h>
#include <string.h>

char* strdup(const char* str)
{
      char* newstr = (char*) malloc( strlen( str) + 1);

      if (newstr) {
          strcpy( newstr, str);
      }

      return newstr;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T22:42:36.250

如果您知道大小，请使用 strdup 或 strndup（更安全）。

像：

```
char* new_char = strdup(original);
... manipulate it ...
free(new_char) 
```

ps.：不是C标准

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T22:28:53.283

一些答案，包括接受的答案有点偏离。您不会*strcpy刚刚**strlen* 'd的字符串。*strcpy*根本不应该在现代程序中使用。

正确的做法是*memcpy*。

EDIT: memcpy is *very* likely to be faster in any architecture, strcpy can only possibly perform better for very short strings and should be avoided for security reasons even if they are not relevant in this case.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T22:43:07.140

你在正确的轨道上，你需要使用 strcpy/strncpy 来制作字符串的副本。简单地分配它们只是为其创建一个“别名”，一个指向同一事物的不同名称。

您第二次尝试的主要问题是您不能以这种方式分配给数组。第二个问题是您似乎在函数调用中提出了一些新名称，我不知道它们来自哪里。

你想要的是：

```
char linkCopy[sizeof(link)];
strncpy(linkCopy, chLastLink, sizeof(link)); 
```

但要小心，sizeof 并不总是按您希望的方式在字符串上工作。使用 strlen，或使用 strdup。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T22:56:18.627

就像 sean.bright 所说的 strdup() 是处理副本的最简单方法。但是 strdup() 虽然广泛可用，但不是标准 C。此方法还将复制的字符串保留在堆中。

```
char *linkCopy = strdup(link);

/* Do some work here */

free(linkCopy); 
```

如果您致力于使用堆栈分配的字符串和 strncpy()，则需要进行一些更改。你写了：

```
char linkCopy[sizeof(link)] 
```

这会在堆栈上创建一个指针大小的字符数组（又名字符串）（可能是 4 个字节）。strncpy() 的第三个参数有同样的问题。你可能想写：

```
char linkCopy[strlen(link)+1];
strncpy(linkCopy,link,strlen(link)+1); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T02:21:54.123

您没有说是否可以使用 C++ 代替 C，但如果您可以使用 C++ 和 STL，那就更容易了：

```
std::string newString( original ); 
```

像使用`newString`上面的 C 样式副本一样使用，它的语义是相同的。你不需要`free()`它，它是一个堆栈对象，会被自动处理掉。

# javascript - Javascript中的strptime

> ID：481678
> 
> 赞同：5
> 
> 时间：2009-01-26T22:40:17.910
> 
> 标签：javascript, strptime, phpjs

我有一个允许用户输入日期的日期输入字段，我需要验证这个输入（我已经有服务器端验证），但诀窍是格式取决于语言环境。我已经有一个系统可以将 strptime 格式字符串转换为用户的偏好，我想使用相同的格式在 Javascript 端进行验证。

任何想法或链接到`strptime()`Javascript 中的实现？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T15:30:27.007

经过几天的谷歌搜索，我发现[这个实现](http://www.logilab.org/blogentry/6731) 虽然不完整，但似乎可以处理我现在拥有的所有案例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-12T04:20:06.147

我刚刚添加了[strptime()](http://github.com/kvz/phpjs/blob/master/functions/datetime/strptime.js)的 php.js 实现；我已经对其进行了一些测试，但它需要进一步的单元测试。无论如何，请随意试一试；它应该涵盖 PHP 所做的所有事情（除了尚不支持未记录的 %E...（替代语言环境格式）说明符）。

请注意，它还取决于我们对 setlocale() 和 array_map() 的实现...

*   [https://github.com/kvz/phpjs/blob/master/functions/strings/setlocale.js](https://github.com/kvz/phpjs/blob/master/functions/strings/setlocale.js)
*   [https://github.com/kvz/phpjs/blob/master/functions/array/array_map.js](https://github.com/kvz/phpjs/blob/master/functions/array/array_map.js)

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-01-26T23:12:14.757

这是一个示例函数，它复制了 strptime 的大部分功能。JavaScript 日期对象通常会解析你扔给它的任何日期字符串，所以你不必担心太多。所以一旦你有了一个基于你的字符串的日期对象，你只需将每个元素推入一个 JS 对象并返回它。该站点对 JavaScript 日期对象的属性有很好的参考：[http ://www.javascriptkit.com/jsref/date.shtml](http://www.javascriptkit.com/jsref/date.shtml)

```
 function strptime(dateString){
            var myDate = new Date(dateString);
            return {tm_sec:myDate.getSeconds(), 
                            tm_min: myDate.getMinutes(), 
                            tm_hour: myDate.getHours(), 
                            tm_mday: myDate.getDate(),
                            tm_mon: myDate.getMonth(), 
                            tm_year: myDate.getFullYear().toString().substring(2), 
                            tm_wday: myDate.getDay()};

        }

        var dateString = "October 12, 1988 13:14:00";       
        dateObj = strptime(dateString);
        document.write("d:" + dateObj.tm_min + "/" + dateObj.tm_hour + "/" + dateObj.tm_mday + "/" + dateObj.tm_mon + "/" + dateObj.tm_year); 
```

# .net - LINQ + 轻量级数据库：我应该选择哪个数据库？

> ID：481684
> 
> 赞同：4
> 
> 时间：2009-01-26T22:41:28.093
> 
> 标签：.net, database, linq, sqlite, firebird

我正在启动一个新的 Web 应用程序。它将托管在对 SQL Server 收取额外费用的服务上，坦率地说，我认为该站点不需要那么多数据库。现在数据模型是 5 个表。如果有史以来最大的表有 10k 条记录，我会感到惊讶。

所以我想保持数据库轻量级。**SQLite**最初引起了我的兴趣，因为我需要为 Android 学习它。但是**缺少外键**让我畏缩。当然可以实现一些看起来像外键约束但感觉不相关的东西。**Firebird**似乎是唯一支持 FK 的轻量级（免费）数据库。

另外，我真的很想通过这个项目在 LINQ 中涉足。到目前为止，我只发现[dbLINQ](http://code.google.com/p/dblinq2007/)可以让我将 SQLite 或 Firebird 与 LINQ 一起使用。它目前是 v0.18，所以离黄金时间还很远。我已经使用 dbLinq 对 SQLite 进行了测试，它们通过了我需要的测试。

SQLite 还有另一种 LINQ 实现，但我为它找到的所有链接都以 404 结尾。

那么对于与 LINQ 兼容的轻量级数据库，我有哪些选择？SQL Server 的任何紧凑版本都已发布，除非有一个可以 XCOPY 部署**且无需安装代理/服务的**版本？我不能要求主机安装新软件，因为我怀疑他们会这样做，并且我希望该应用程序具有高度便携性（就托管而言）。

到目前为止的清单：

*   SQLite
*   火鸟
*   SQL Server 紧凑型
*   维斯塔数据库

更新：**我尝试了所有版本并[在这里写下我的印象](http://codingmostly.blogspot.com/2009/02/lightweight-databases-sql-server.html)**。简短版本：SQLite 胜出。它是唯一一款具有良好 GUI、无需安装空间且免费的软件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T13:38:49.093

您可以在现有数据库上按原样使用 LINQ to SQL，只要您可以创建标准`IDbConnection`对象。

这是在 Firebird DB 上使用 LINQ 的一些代码。

```
DbProviderFactory dbProvider = DbProviderFactories
    .GetFactory("FirebirdSql.Data.FirebirdClient");

DbConnection connection = dbProvider.CreateConnection();
connection.ConnectionString = "some connection string";

DataContext linqContext = new DataContext(connection);

var query = from something in linqContext.GetTable<SomeType>() 
            select something.someproperty; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T06:18:59.590

SQL Server Compact Edition ( [http://en.wikipedia.org/wiki/SQLCE](http://en.wikipedia.org/wiki/SQLCE) ) 支持 LINQ 和所有其他 VS 工具，内置于 VS 2008 中，支持 FK，并且可以使用数据库的平面文件进行 XCOPY 部署。但是请注意，它也不是没有注意事项，很多东西，如视图或嵌套查询都会失败，如果你开始让数据库大小变得非常大（即 50MB+），它可能会变得非常臃肿。

如果您在此处使用 SQLite .NET 提供程序 ( [http://sqlite.phxsoftware.com/)，SQLite](http://sqlite.phxsoftware.com/)也会*更好*，它也可以与 LINQ 一起使用，并且具有基本的 VS 支持。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T06:59:50.303

我建议你看看[VistaDB](http://www.vistadb.net/)。与 SQLCE 和 SQLite 相比，它支持视图、存储过程和触发器的额外优势将[完全满足您的需求。](http://www.vistadb.net/vistadb3/)事实上，它支持在 TSQL 和 .NET 中编写过程和触发器，因此您可以利用您的 SQL Server 和您的 .NET 知识。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-01T20:54:26.010

SQLite。具有良好的 GUI（具有自动怪异完成功能），没有安装足迹，是免费的，并且无论我在哪里托管网站都可以使用。我知道我在回答我自己的问题，但没有人在他们的回复中只使用 SQLite。

**重要提示**：如果您想在共享主机上运行 SQLite，则需要使用完全信任模式的网络主机。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T22:56:39.313

SQL Server 速成

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-25T18:37:36.007

如果您要在共享主机上运行您的网站（几乎所有这些都不允许您在完全信任模式下运行您的网站），并且如果您需要简单的启用 x-copy 部署的网站，VistaDB 是唯一的选择。

# python - lambda 函数可以在 Python 中递归调用自身吗？

> ID：481692
> 
> 赞同：75
> 
> 时间：2009-01-26T22:42:42.320
> 
> 标签：python, recursion, lambda, y-combinator

常规函数可以在其定义中包含对自身的调用，这没问题。我不知道如何使用 lambda 函数来做这件事，但原因很简单，lambda 函数没有名称可以引用。有没有办法做到这一点？如何？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-01-26T23:04:03.290

我能想到的唯一方法就是给函数命名：

```
fact = lambda x: 1 if x == 0 else x * fact(x-1) 
```

或者，对于早期版本的 python：

```
fact = lambda x: x == 0 and 1 or x * fact(x-1) 
```

**更新**：使用其他答案的想法，我能够将阶乘函数楔入一个未命名的 lambda：

```
>>> map(lambda n: (lambda f, *a: f(f, *a))(lambda rec, n: 1 if n == 0 else n*rec(rec, n-1), n), range(10))
[1, 1, 2, 6, 24, 120, 720, 5040, 40320, 362880] 
```

所以这是可能的，但不是很推荐！

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2012-01-02T16:34:15.837

没有 reduce、map、命名 lambda 或 python 内部：

```
(lambda a:lambda v:a(a,v))(lambda s,x:1 if x==0 else x*s(s,x-1))(10) 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2012-04-13T16:50:05.533

与sth所说的相反，您可以直接这样做。

```
(lambda f: (lambda x: f(lambda v: x(x)(v)))(lambda x: f(lambda v: x(x)(v))))(lambda f: (lambda i: 1 if (i == 0) else i * f(i - 1)))(n) 
```

第一部分是[定点组合器](http://en.wikipedia.org/wiki/Fixed-point_combinator#Example_in_Python) *Y*，它有助于 lambda 演算中的递归

```
Y = (lambda f: (lambda x: f(lambda v: x(x)(v)))(lambda x: f(lambda v: x(x)(v)))) 
```

第二部分是递归定义的阶乘函数*fact*

```
fact = (lambda f: (lambda i: 1 if (i == 0) else i * f(i - 1))) 
```

*Y*应用于*事实*以形成另一个 lambda 表达式

```
F = Y(fact) 
```

它应用于第三部分*n*，它评估到第 n 个阶乘

```
>>> n = 5
>>> F(n)
120 
```

或等效地

```
>>> (lambda f: (lambda x: f(lambda v: x(x)(v)))(lambda x: f(lambda v: x(x)(v))))(lambda f: (lambda i: 1 if (i == 0) else i * f(i - 1)))(5)
120 
```

但是，如果您更喜欢*事实*而不是*事实*，您也可以使用相同的组合器来做到这一点

```
>>> (lambda f: (lambda x: f(lambda v: x(x)(v)))(lambda x: f(lambda v: x(x)(v))))(lambda f: (lambda i: f(i - 1) + f(i - 2) if i > 1 else 1))(5)
8 
```

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-01-26T23:16:29.710

你不能直接做，因为它没有名字。但是使用像 Lemmy 指出的 Y 组合器这样的辅助函数，您可以通过将函数作为参数传递给自身来创建递归（听起来很奇怪）：

```
# helper function
def recursive(f, *p, **kw):
   return f(f, *p, **kw)

def fib(n):
   # The rec parameter will be the lambda function itself
   return recursive((lambda rec, n: rec(rec, n-1) + rec(rec, n-2) if n>1 else 1), n)

# using map since we already started to do black functional programming magic
print map(fib, range(10)) 
```

这将打印前十个斐波那契数`[1, 1, 2, 3, 5, 8, 13, 21, 34, 55]`：

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-01-27T02:52:33.393

是的。我有两种方法可以做到这一点，其中一种已经涵盖了。这是我的首选方式。

```
(lambda v: (lambda n: n * __import__('types').FunctionType(
        __import__('inspect').stack()[0][0].f_code, 
        dict(__import__=__import__, dict=dict)
    )(n - 1) if n > 1 else 1)(v))(5) 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2016-03-27T20:53:14.590

这个答案很基本。它比 Hugo Walter 的回答简单一点：

```
>>> (lambda f: f(f))(lambda f, i=0: (i < 10)and f(f, i + 1)or i)
10
>>> 
```

雨果沃尔特的回答：

```
(lambda a:lambda v:a(a,v))(lambda s,x:1 if x==0 else x*s(s,x-1))(10) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-03-24T20:43:10.970

```
def recursive(def_fun):
    def wrapper(*p, **kw):
        fi = lambda *p, **kw: def_fun(fi, *p, **kw)
        return def_fun(fi, *p, **kw)

    return wrapper

factorial = recursive(lambda f, n: 1 if n < 2 else n * f(n - 1))
print(factorial(10))

fibonaci = recursive(lambda f, n: f(n - 1) + f(n - 2) if n > 1 else 1)
print(fibonaci(10)) 
```

希望对某人有所帮助。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-09-08T13:08:38.813

顺便说一句，斐波那契的计算不是很慢：

```
f = lambda x: 1 if x in (1,2) else f(x-1)+f(x-2) 
```

我建议快速计算斐波那契：

```
fib = lambda n, pp=1, pn=1, c=1: pp if c > n else fib(n, pn, pn+pp, c+1) 
```

它的工作速度非常快。

这里还有阶乘计算：

```
fact = lambda n, p=1, c=1: p if c > n else fact(n, p*c, c+1) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-08-19T09:11:22.567

好吧，不完全是纯粹的 lambda 递归，但它适用于只能使用 lambda 的地方，例如 reduce、map 和列表推导或其他 lambda。诀窍是从列表理解和 Python 的名称范围中受益。以下示例通过给定的键链遍历字典。

```
>>> data = {'John': {'age': 33}, 'Kate': {'age': 32}}
>>> [fn(data, ['John', 'age']) for fn in [lambda d, keys: None if d is None or type(d) is not dict or len(keys) < 1 or keys[0] not in d else (d[keys[0]] if len(keys) == 1 else fn(d[keys[0]], keys[1:]))]][0]
33 
```

lambda 重用其在列表理解表达式 (fn) 中定义的名称。这个例子相当复杂，但它显示了这个概念。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-03-08T18:14:13.280

为此，我们可以使用[定点组合器](https://en.wikipedia.org/wiki/Fixed-point_combinator)，特别是`Z`组合器，因为它可以在严格的语言中工作，也称为渴望语言：

```
const Z = f => (x => f(v => x(x)(v)))(x => f(v => x(x)(v))) 
```

定义`fact`函数并修改它：

```
1\. const fact n = n === 0 ? 1 : n * fact(n - 1)
2\. const fact = n => n === 0 ? 1 : n * fact(n - 1)
3\. const _fact = (fact => n => n === 0 ? 1 : n * fact(n - 1)) 
```

请注意：

> 事实 === Z(_fact)

并使用它：

```
const Z = f => (x => f(v => x(x)(v)))(x => f(v => x(x)(v)));

const _fact = f => n => n === 0 ? 1 : n * f(n - 1);
const fact = Z(_fact);

console.log(fact(5)); //120
```

另请参阅： [JavaScript 中的定点组合器：记忆递归函数](http://matt.might.net/articles/implementation-of-recursive-fixed-point-y-combinator-in-javascript-for-memoization/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-01-16T15:51:50.057

我们现在可以使用新的 python 语法来使它更短更容易阅读：

斐波那契：

```
>>> (f:=lambda x: 1 if x <= 1 else f(x - 1) + f(x - 2))(5)
8 
```

阶乘：

```
>>> (f:=lambda x: 1 if x == 0 else x*f(x - 1))(5)
120 
```

我们`:=`用来命名 lambda：直接在 lambda 本身中使用名称，并立即将其作为匿名函数调用。

（见[https://www.python.org/dev/peps/pep-0572](https://www.python.org/dev/peps/pep-0572)）

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2021-03-22T13:00:55.757

我知道这是一个旧线程，但它在一些谷歌搜索结果中排名很高:)。随着 python 3.8 的到来，您可以使用 walrus 运算符来实现语法更少的 Y 组合器！

```
fib = (lambda f: (rec := lambda args: f(rec, args)))\
      (lambda f, n: n if n <= 1 else f(n-2) + f(n-1)) 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2021-12-19T19:26:40.533

很简单：

```
fac = lambda n: 1 if n <= 1 else n*fac(n-1) 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2019-06-13T12:05:17.093

Lambda 可以轻松替换 Python 中的递归函数：

例如，这个基本的 Compound_interest：

```
def interest(amount, rate, period):
    if period == 0: 
        return amount
    else:
        return interest(amount * rate, rate, period - 1) 
```

可以替换为：

```
lambda_interest = lambda a,r,p: a if p == 0 else lambda_interest(a * r, r, p - 1) 
```

或更多可见性：

```
lambda_interest = lambda amount, rate, period: \
amount if period == 0 else \
lambda_interest(amount * rate, rate, period - 1) 
```

用法：

```
print(interest(10000, 1.1, 3))
print(lambda_interest(10000, 1.1, 3)) 
```

输出：

```
13310.0
13310.0 
```

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2009-01-26T23:17:39.583

如果您是真正的自虐狂，您也许可以使用 C 扩展来做到这一点，但这超出了 lambda（未命名、匿名）函数的能力。

No.（对于大多数 no 值）。

# .net - NET：在文件之间划分命名空间的最佳实践/指南？

> ID：481697
> 
> 赞同：12
> 
> 时间：2009-01-26T22:44:22.550
> 
> 标签：.net, asp.net, visual-studio, app-code

将应用程序代码 (App_Code) 划分为单独文件的一般准则/问题应该是什么？

我发现随着时间的推移，原始文件与命名空间层次结构的演变方式并不匹配。如何随着时间的推移直观地组织应用程序代码容器？

文件划分的目的应该是什么？代码可移植性？关注点分离？一般功能上下文？变化频率？他们应该争取与班级的1-1关系吗？

将代码拆分为许多较小的文件与合并为几个文件有什么影响？

我经常考虑这一点，但从未真正得出适用于所有情况的一般结论。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-26T23:14:08.293

这个问题的答案不是绝对的，因为它通常取决于您手头的任务。如果您正在创建某种 SDK 以供其他人重用，那么命名空间非常重要；但是，如果您正在创建一个只有几个类的内部工具，那么名称空间就几乎不重要了。

### 课程

一般来说，类应该有自己的文件，因为这简化了人们在代码解决方案中导航的方式，有助于开发和维护（例如，当每个人都更改相同的文件时，合并更改要困难得多）。在某些情况下，将一个类拆分为多个文件是可以接受的，例如：

*   当有嵌套类时，每个嵌套类都可以有自己的文件。

*   当类有自动生成的部分时，例如设计器代码。

*   当类有固定部分时，例如一组通用的隐藏属性或接口的通用实现。

在我们的一个项目中，我们有一个许多类公开的接口的通用实现。由于我们没有多重继承，我们采用混合方法，为每个类自动生成一个附加文件。这可以手动完成，而不是自动完成（并且最初是）。

还有其他情况，但这有点主观，取决于您自己的项目要求。

### 命名空间

命名空间通常应该专注于您的类型的合理分组。命名空间应该允许开发人员直观地找到他们正在寻找的东西。对于许多小型项目，单个命名空间例如`MyAwesomeTool`就足够了，但对于具有许多类的大型项目，则需要更合乎逻辑的分组。像 SDK 或 .NET BCL 这样的大型项目依赖命名空间来分解原本庞大的类型集合。每个命名空间级别都提供了可能在那里找到的附加信息，例如`System.Windows.Forms`or`System.Drawing`或`Microsoft.VisualBasic`。

在创建命名空间时，必须考虑该命名空间和相关项目的用途。如果项目是内部的并且很小，请随意调用命名空间，因为它只是对类型进行分组的必要条件；如果项目在外部可见或包含大量类型，请仔细考虑逻辑和有意义的分组，这将使其他人能够直观地找到他们正在寻找的类型。

### 结论

没有适用于任何情况的硬性规则。您如何将代码安排到文件中与您自己的开发过程有关，这会影响您和您的团队；您在一个文件中的所有类都将难以开发，但编译后的产品不会有任何不同（前提是单文件方法不会导致错误），而您的命名空间的安排与未来的开发和消费者有关那些命名空间，所以弄错的后果可能会更严重。

*   旨在以简化当前开发和未来维护的方式组织您的课程。
*   旨在以简化所有开发的方式组织命名空间，并在适当的情况下简化最终用户的体验。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-26T22:56:14.010

类和源文件之间应该存在一对一的映射。

命名空间应该被认为是一个包含一个或多个类的包。在可能的情况下，将它们表示为 Visual Studio 项目窗口中的文件夹/过滤器会很有用。

如果您发现一个相当大的类，您认为将其拆分为单独的文件会受益，那么请考虑重构和拆分类本身。

（可接受的）例外是生成 UI 的代码，Visual Studio 将其放置在单独的文件中。我建议将其保留在自己的文件中，并尽可能将其视为透明的编辑器拥有的文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T22:55:34.913

我看到的大多数建议都说每个公共类型都应该在自己的文件中，并且命名空间应该代表应用程序的文件夹结构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T23:32:42.220

我做 99% 的 1 对 1 课程来归档。唯一的例外是，如果您有大量或非常简单的小类，它们都实现了相同的接口并且不应该改变太多。您可能只想继续将它们放在一个文件中。自定义异常就是一个很好的例子。大多数时候（根据我的经验），除了创建自定义消息或类似性质的东西之外，没有其他代码。

命名空间应该首先通过关注点分离来组织。例如，数据对象应该与域对象位于不同的命名空间中。然后，您可能在“聚合根”级别为每组对象拥有一个较小的子域。通常，这些最小的命名空间中的每一个都对应于它自己的项目和 DLL。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-02T17:35:18.780

就类而言，我倾向于遵循 Java 规则：“每个文件一个公共类”如果该公共类是唯一用户，我可以在公共中包含一个私有类。（虽然，枚举使这个因素变得不那么重要了）；但是，如果它被同一个命名空间中的许多公共类使用，那么我会将它放在它自己的文件中。

我将倾向于按照以下方式使用命名空间：

MyAwesomeApp.UI
MyAwesomeApp.Business
MyAwesomeApp.Data

以反映层的分离。

# java - 哪个 Java Web 框架最适合 Google Guice？

> ID：481705
> 
> 赞同：20
> 
> 时间：2009-01-26T22:49:32.243
> 
> 标签：java, dependency-injection, guice

我计划开始一个新项目，并正在研究当前最先进的 Java Web 框架。我决定围绕 Guice 构建我的应用程序，并且可能会使用非常轻量级的 ORM，例如 Squill/JEQUEL/JaQu 或类似的，但我无法决定使用 Web 框架。哪一个最适合这样一个轻量级的环境？哪一个与 Guice 结合得最好？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-08T02:24:20.877

当我在 11 月开始编写一个新项目时，我已经收集了一些关于这个主题的经验。该项目现在处于后期阶段。

对我来说，以下设计指南很重要：

*   使用既有趣又会在未来普遍使用的现代技术堆栈。
*   减少项目工件的数量——在有意义的地方使用注释/Java 代码，省略 XML。
*   使用开源框架
*   拥有一个活跃的社区
*   不是alpha阶段
*   重量轻
*   避免概念重复
*   我可以向我的两位开发人员解释其中的概念，尽管他们是优秀的程序员，但他们从未使用过[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)(DI) 或 Web 框架。
*   可以作为未来项目的技术基础

[Google Guice](http://en.wikipedia.org/wiki/Google_Guice)作为 DI 容器是一个显而易见的选择 - 显然是最深思熟虑的 DI 容器，拥有出色的开发人员和良好的社区。它满足了上面提到的所有要点。

所以我建立了我的基本技术堆栈。从 Guice 开始，添加了[Hibernate](http://en.wikipedia.org/wiki/Hibernate_%28Java%29)以实现持久性（以及[warp-persist](http://www.wideplay.com/guicewebextensions)和[warp-servlet](http://www.wideplay.com/warp%3A%3Aservlet)）。然后我写了一些基本的[DAO](http://en.wikipedia.org/wiki/Data_access_object)来选择一些东西。

然后我尝试执行以下操作：在此之上添加了一个不同的 Web 框架。

*   使用常规 HTTP servlet和[xStream的](http://xstream.codehaus.org)[XSLT](http://www.w3schools.com/xsl/)
*   [JSF-MyFaces](http://myfaces.apache.org)
*   [阿帕奇检票口](http://wicket.apache.org/)
*   [经线小部件](http://code.google.com/p/warp-core/)

我创建了一个简单的页面，其中包含一个表格，由 DAO、标题和一个包含所有四个框架的文本字段填充。

这些是我比较四个框架时的发现。

XSLT 和 XStream 是一种硬核方法。它不是一个真正的框架，而是一种适用于高性能应用程序的可行的完全无状态的技术。这是迄今为止提供测试页面的最快方式。在调试模式下，本地主机上 3 毫秒，而其他框架大约 30-50 毫秒。

使用 warp-servlet 的 Guice 集成相对顺利和良好，这使我能够注入 servlet 并在其他对象中注入 httprequest、httpresponse、session，而无需传递它们。缺点：根本没有社区，因为我是唯一会考虑这个堆栈的人。- 没有现成的组件。

然后我看了一下 JSF 和 Guice：当然可以将注入器放在 servlet 上下文中，并使用 guice 作为服务定位器。使用简单的方法，不可能在其他地方注入支持 bean。使用自定义变量解析器可以部分解决这个问题，但是您会丢失 JSF 文件中的所有[IDE](http://en.wikipedia.org/wiki/Integrated_development_environment)集成，而且您将不得不为支持 bean 使用丑陋的[FQN](http://en.wikipedia.org/wiki/Fully_qualified_name)，或者在某处构建字符串->Guice 键映射。两者都很丑：

*   优点：良好的社区，就业市场上有很多开发人员（对我来说没有标准）。如果出现问题，您不会因为选择 JSF 而被解雇。
*   缺点：带来了自己[的控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)(IoC) 机制，在概念上与 guice 冲突。

warp-widgets：为了好玩，我创建了我的简单示例；这是早期的阿尔法阶段。它很好用，它的组件很容易实现和我自己重用。它旨在提供具有完美 Guice 集成的类型安全 HTML。由于当时看起来它只有一个活跃的开发人员，现在可能正在开发 Guice 2.0，我想说这个社区几乎不存在。它就像一个魅力，相当快，但我会成为 alpha 测试员。这对我来说风险太大，无法考虑将其用于商业项目。

Apache Wicket：这个项目首先让我吃惊的是 wicket-ioc 和 wicket-guice 在核心下载中结合在一起。网页中的构造函数注入是不可能的，只有setter+field。在 Wicket 网页中注入很容易，只需添加`@Inject`到您要填写的字段中 - 但您不应该了解[它在后台](http://cwiki.apache.org/WICKET/guice-integration-pitfall.html)是如何工作的。棘手的事情正在发生。理论上可以注入网页 - 但我没有使用过一次，因为这使得无法使用挂载的 URL，而且它会混淆持久化/序列化状态。类的注入成员被透明地处理为网页序列化，这是启用浏览器支持所必需的。Wicket 使用零外部工件 - 只需对[URL进行一些配置](http://en.wiktionary.org/wiki/configuration)在应用程序类中。所以所有的配置都是用 Java 完成的——这很适合 Guice 模型。HTML 和 Java 的清晰分离。它是开源的，就像大多数数量众多且质量良好的组件一样。它自 2005 年（？）以来就已经存在，并且是一个顶级 Apache 项目。尽管它是一个功能丰富的框架，但它的[API](http://en.wikipedia.org/wiki/Application_programming_interface)相当紧凑（所有核心类都适合我屏幕上的单个[JPEG](http://en.wikipedia.org/wiki/JPEG)）。与其他人不同的是，它并没有带来自己的 IoC 机制，而是将 IoC 视为可以由[Spring Framework](http://en.wikipedia.org/wiki/Spring_Framework)、 Guice 等提供的服务，并且这种理念使其优于 Guice 集成。我是否提到过非常智能和简单的 Ajax 支持？

未深入评估的框架：tapestry5 - 带来了自己的 IoC。 [Seam](http://en.wikipedia.org/wiki/JBoss_Seam)：它本身不是一个框架，而是一个元框架，通常来自 Spring、JSF。休眠。（尽管理论上 Spring 可能会被 Guice 取代。）

总结：在评估的框架中，**Apache Wicket 是明显的赢家**——就 Guice 集成 + 所有其他提到的标准而言。

除了我们两个，其他人[之前也遇到过这个问题](http://static.raibledesigns.com/repository/presentations/ComparingJavaWebFrameworks-ApacheConUS2007.pdf)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-27T15:07:11.973

[Wicket 有一个内置的 Guice 模块](http://herebebeasties.com/2007-06-20/wicket-gets-guicy/)，我没有使用过（但我已经使用了很多[Wicket](http://en.wikipedia.org/wiki/Apache_Wicket)，并且很喜欢它）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T19:43:01.037

这是一篇关于[将 Guice 与 Stripes 集成的文章](http://www.gridshore.nl/2008/10/19/one-liter-of-guice-during-spring-break/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-03-25T19:50:06.087

[Play 框架](http://en.wikipedia.org/wiki/Play_Framework)是一个不错的框架。[它有 Guice 支持](http://www.playframework.org/modules/guice-1.0/home)（我还没有尝试过）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T22:59:11.630

一个好的轻量级 Web 容器是[Simple](http://www.simpleframework.org/)。它的性能非常好，可以与[Restlet](http://en.wikipedia.org/wiki/Restlet)和[Jersey](http://en.wikipedia.org/wiki/Java_API_for_RESTful_Web_Services#Jersey)等框架一起使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-22T18:29:58.107

[Mojave MVC Web 框架](http://mojavemvc.org)是一个包含 Guice 的非常简单、轻量级的框架。

# apache-flex - 基于 Flex Flash 的幻灯片（无 GUI 工具）

> ID：481709
> 
> 赞同：0
> 
> 时间：2009-01-26T22:50:04.303
> 
> 标签：apache-flex, slideshow

任何人都知道如何使用 flex 创建幻灯片，其中包含以下内容。

1.  基于 java flex (xml, java code 不管)
2.  文本动画（文本在屏幕上移动等）
3.  能够播放mp3或ogg（主要是mp3）
4.  能够在每张幻灯片上添加图像。

本质上，我想轻松创建更好的“powerpoint”演示文稿。

理想情况下没有 gui 工具，我想做 xml/java。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T01:08:29.600

我们遇到了一个（稍微）类似的问题，*可能会对*您有所帮助。

我们的问题在于 BIRT，即 Eclipse 报告生成工具。这是一个很好的产品，但需要使用 BIRT Eclipse Designer (GUI) 来生成报告定义（充其量是乏味的，在早期版本中存在错误，特别是复制和修改报告设计，这是快速制作大量报告的唯一方法）类似的报告设计）。

由于我们想要一种能够一次生成数百个报告设计的批处理方法（并且能够更改小的风格事物并重新生成整个批次），我们选择创建我们自己的基于 Java 的工具，该工具将将我们的简单报告规范（50 多行）直接转换为 BIRT XML 报告设计文件（数千行）。

我们已经有了简单的报告规范文件，因为我们的报告子系统已经存在——我们只是添加了网络报告作为它的一个选项。

它之所以有效，是因为我们所有的报告都遵循相同的基本格式——我们不需要在其中包含非常复杂的内容。

它需要使用 GUI 创建几个报告，然后对它们进行逆向工程，以找出如何从我们的规范文件生成 BIRT XML。这是最难的一点。

您似乎可以对幻灯片采用类似的方法。使用 GUI 工具生成所需的 XML 文件，然后对它们进行逆向工程。

所以，我会创建一个没有内容的完全空的幻灯片，然后创建一个带有文本的幻灯片，另一个带有动画，另一个带有嵌入的 OGG 等等，然后比较这些步骤以查看每个添加的元素的 XML 是如何变化的。

然后，您可以创建一个工具，该工具接受您的简单命令（例如`add-slide`，、、、、）并生成相关的 XML 。我们没有使用 XML 作为源（因为我无法忍受冗长的内容），但是，如果您确实使用它，则可能只是通过 XML 转换来获得您需要的东西。`add-ogg``add-text``add-bullet`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-05T17:10:12.747

有一些[基于 xml 的幻灯片](http://www.flexdownloads.com)可以在没有飞行文本部分的情况下做你想做的事情。您可以在 swf/图像上添加 SWF 和图像以及标题和描述，并能够使用 xml 隐藏/显示导航/标题/描述并将标题和描述定位为 wlel。

It comes with source code and I don't think putting the additional stuff you mention is more than a couple of hours of work for a java developer who has some basic knowledge of flex and a good knowledge of eclipse which the the flex builder ide is based on. You always have the option of leaving a not for the author that you want to customize the slideshow to do xyz...and he/she may quote a fee for that.

# vb.net - CCR、产量和 VB.net

> ID：481714
> 
> 赞同：2
> 
> 时间：2009-01-26T22:53:22.393
> 
> 标签：vb.net, yield, ccr

我一直在尝试了解 CCR（并发和协调运行时），看看它是否值得学习。

我主要在 Vb.net 中编程，并且在大多数使用 CCR 的示例中使用 Yield 关键字。

Yield 对使用 CCR 有多重要？有解决方法吗？VB.net 会得到 Yield 命令吗？（如果不是为什么不呢？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T22:56:32.073

是的，据我了解，迭代器块（由 yield 语句表示）对 CCR 非常重要。它们使可读的异步工作流成为可能。

你已经看过并行扩展了吗？如果没有，我会在 CCR 之前尝试一下——除此之外，它更有可能是 VB.NET 友好的*，并且*当它出现时它将在“主要”.NET 4.0 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T23:00:34.390

yield 关键字不是必需的，但在使用 CCR 时它使事情变得非常容易。需要在处理程序方法中生成任务，这可以通过简单地使用原语来完成，但几乎没有那么优雅。我从未见过任何用 VB.NET 编写的 CCR 代码，但我想有一些解决方法可以返回一个 IEnumerable 对象（尽管我无法确认这一点，因为我已经很久没有编写任何 VB.NET 了） . 上次我听说，VB.NET 10 很有可能会获得等效的 yield 关键字。

# java-me - J2ME 有标准的图标大小和颜色深度吗？

> ID：481715
> 
> 赞同：3
> 
> 时间：2009-01-26T22:53:53.297
> 
> 标签：java-me, icons

有很多手机，每个都有自己的图标大小（例如，诺基亚有 19 种不同的大小，[http://www.j2meforums.com/wiki/index.php/Application_Icon_sizes](http://www.j2meforums.com/wiki/index.php/Application_Icon_sizes)）。

我只想使用一个图标（即使显示效果不佳）。

是否有一个图标大小和颜色深度显示在所有手机中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T01:11:54.907

根据您需要支持的手机数量，这样做可能不太现实。为了解决这个问题，您可以为每部手机创建独特的版本。不是最佳解决方案，但如果您尝试将应用程序移植到 20 多部手机上，那么图标将是您最少的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T14:46:14.997

没有标准尺寸，如果不是为设备指定的确切宽度和高度，某些手机甚至不会显示图标。有些手机可能会尝试放大或缩小您的图标，具体取决于它的要求。但是，你不能依赖这个。只是高度分散的移动空间的另一个有趣部分:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T12:07:01.043

我建议尝试这 19 种尺寸中最小的一种。如果您真的不在乎图标显示得有多差，那么“最小公分母”方法可能会产生有趣的结果。

SVG 图标支持始于诺基亚 5800 等 Series60 第 5 版手机。从长远来看，这方面可能存在希望。

当然，我完全同意 omermuhammed 的观点：任何需要支持 20 多种手机的中等复杂应用程序都需要多个版本的 jad 和 jar 文件，即使您无法对所有手机使用相同的图标。

# asp.net - asp.net mvc：Ajax actionlink 还是 Jquery 解决方案？

> ID：481716
> 
> 赞同：3
> 
> 时间：2009-01-26T22:53:59.503
> 
> 标签：asp.net, jquery, asp.net-mvc, asp.net-ajax

我试图在点击时更改图像，类似于 SO 对投票箭头和复选标记所做的操作。

我想要么：

1- 让每个图像都是 Ajax.ActionLink 并在单击时返回不同的图像。

2- 将图像作为超链接的背景并使用 Ajax.ActionLink 替换 css 类以获取新图像。

3-改用JQuery。

哪个是最好的方法，你能提供例子吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T23:10:45.040

jquery 是最好的，因为如果您在 asp.net-mvc 中使用 actionlink，那么您必须为每个点击的图像处理一个链接（操作方法），这可能会变得复杂。

在jquery中你有这样的东西可以最小化难度

```
 $(document).ready(function() {
       //image is the name of the class of your images
     $(".image").click(function() {

     $(".image").hide(); //just an example..
        });
 }) ; 
```

这将隐藏被单击的图像..参考 jquery 教程以使图像完全按照您想要在单击时执行的操作..向图像添加 css 或更改放大图像或其他任何内容..请记住，因为您正在使用 asp.net，如果您使用 asp web 控件并想在 jquery 中调用 id 而不是类，那么它有点不同。如果没有 asp web 控件，它会以这种方式调用 id：

```
 ("#image1").click(function() { 
```

但是使用像 asp:imagebutton 这样的 asp web 控件会是这样的：

```
 ("#ct100_******image1").click(function() { 
```

星号可以是任何东西..您必须先查看源代码才能查看呈现的实际 id 名称，因为 asp.net 更改了您将属性设置为 runat=Server 的控件的 id 名称，默认情况下您必须设置 runat=server 才能编译 asp web 控件

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T23:11:09.720

使用 jQuery。单击时，执行 ajax 调用并切换类。

# c# - 将 Access 数据导入 SQL Server CE（.mdb 到 .sdf）

> ID：481719
> 
> 赞同：3
> 
> 时间：2009-01-26T22:55:49.267
> 
> 标签：c#, .net, sql-server-ce

我发现了一些关于如何将数据从 Access 导入 SQL Server 或 SQL Server Express，而不是 SQL Server CE 的文章和讨论。我可以通过单独的连接访问 VS 数据库资源管理器中的 Access 数据和 CE 数据，但不知道如何将数据从一个移动到另一个。（我正在使用 c#。）有什么建议吗？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T23:00:36.980

您可以使用[SSIS](http://en.wikipedia.org/wiki/SQL_Server_Integration_Services)来完成，如果您不想以编程方式完成，甚至可以在 SQL Server Explorer 中完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T23:05:39.043

您可以查看[PrimeWorks 的 DataPort Wizard](http://www.primeworks-mobile.com/Products/DataPortWizard.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T18:32:31.640

您还可以使用“sql server 迁移向导”将其转换为 sql server 数据库，并使用此[工具](http://www.johnnycantcode.com/post/UPDATE-SQL-Compact-Copy-Utility.aspx)将其转换回 .sdf 数据库

# asp.net - 用户导入数据库的最佳方式？

> ID：481720
> 
> 赞同：1
> 
> 时间：2009-01-26T22:55:49.297
> 
> 标签：asp.net, database

我知道这不是一个独特的问题，但我没有太多运气找到其他人如何解决这个问题的例子。我有一个继承并正在构建的 Intranet asp.net 应用程序。一个特定页面用于数据输入以提交索赔以供批准，我们有一个表格，一次可以输入一条记录，并根据数据库实时验证有效产品信息。

我被要求添加一项功能，用户可以一次导入大量记录，以节省他们一次浏览每个文本框和下拉列表的时间，有时会超过 100 条记录。

作为我的第一个选择，我研究的解决方案是创建一个 Excel 电子表格，他们可以从我已格式化为模板的页面上的链接打开，他们可以将数据复制/粘贴到、保存然后上传到服务器并作为链接服务器对象导入 sql server。

由于这个解决方案的性质和一些正在导入的数据，我必须在 VB 中为电子表格编写一些错误处理程序，如果我发现要修复的错误，没有好的方法可以保证用户将使用页面上的版本，而不是他们保存的一些本地副本，这些副本在尝试导入时可能会损坏。

我已经排除了我尝试解析的一个大文本框，因为我无法控制用户如何输入数据。

我是否缺少一些更好且可能更明显的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T23:32:00.927

不受控制的电子表格导入过程是一件坏事。用户可以做很多事情来破坏这个过程。如果您要从电子表格批量加载，该过程应包含以下组件：

*   由用户下载并从应用程序生成的受控模板文件（如果不需要更改模板，它可以放在某个文件夹中）。

*   检查以确保模板已被使用。

*   实际加载过程。

*   用户可以在其中验证他们已导入、编辑和提交上传内容的屏幕。

检查和验证部分是在上传上放置一个可以验证数据的控件的好方法。用户必须检查导入的数据并手动批准。这将正确性的责任重新归还给用户，并使他们能够查看和修复上传。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T22:59:43.923

将文件上传到您的站点在您的应用程序中解析文件，并使用与您的网络使用相同的逻辑（假设您使用域模型）创建您的声明。您可以上传 CSV 文件或您可以在服务器上解析的任何格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T23:03:30.843

也许这就是您的意思，但我会使用 csv（逗号分隔值）文件而不是电子表格。它仍然可以在 Excel 中打开和编辑，但对于那些没有 Excel 的用户，也可以在其他编辑器中轻松编辑。这也将使您在解析方面更容易。

如果您担心版本控制，也许您可​​以将其中一个列标题设为仅包含当前版本的空列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T00:36:50.997

您的回答假定 Excel 是一个比您在网站上生成的更好的数据输入和管理系统。但是，.NET 中有很多可编辑的 Datagrid 选项可以模拟 Excel 的强大功能。

另一方面，如果您希望人们能够在不连接到网络的情况下使用数据的本地副本，您可能需要考虑在共享驱动器或用户文件夹中自动生成电子表格（每个用户一个电子表格) 使用其中一种数据访问系统绑定回数据库。

祝你好运！

# java-me - 下载后是否有更改 MIDLet 图标的方法？

> ID：481723
> 
> 赞同：2
> 
> 时间：2009-01-26T22:56:25.630
> 
> 标签：java-me, icons, midp

鉴于不同手机（即使对于同一制造商）有多种尺寸和颜色深度，我希望为所有手机提供一个应用程序，然后为下载的手机下载一个适当的图标。

下载应用程序后，是否可以更改 MIDLet 图标？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T23:07:24.377

据我所知，没有办法做到这一点。但是，您可以强制用户升级应用程序并更改图标。这可以以更加用户友好的方式完成，而不会丢失应用程序下载的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T12:13:37.840

尽管在标准 j2me 中没有办法做到这一点（除了升级，正如 omermuhammed 所写），如果您的目标是允许本地开发的手机（想到 Symbian 手机），您可以注册一个不同的文件作为 MIDlet 图标或在安装 MIDlet 后覆盖现有文件（通过运行本机代码，而不是 java）。

一些较新的索尼爱立信手机（JP8.3 平台以上）具有专有的 java 应用程序管理 API，只有在您的 MIDlet 由索尼爱立信签名时才能访问，以及允许您隐藏 MIDlet 图标的 jad 属性。用户。虽然我不认为这真的可以让你改变图标，但它可以促进自动升级。

# c# - 在 C# 中与块等效？

> ID：481725
> 
> 赞同：79
> 
> 时间：2009-01-26T22:56:38.563
> 
> 标签：c#, .net, vb.net

我知道 VB.Net 并且正在尝试复习我的 C#。C# 中是否有`With`等效的块？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-01-26T23:48:03.013

尽管 C# 对于一般情况没有任何直接等效项，但 C# 3 为构造函数调用提供了对象初始化器语法：

```
var foo = new Foo { Property1 = value1, Property2 = value2, etc }; 
```

有关详细信息，请参阅 C# 的第 8 章 - 您可以从[Manning 的网站](http://manning.com/skeet)免费下载。

（免责声明 - 是的，将这本书交到更多人手中符合我的兴趣。但是，嘿，这是一个免费章节，为您提供有关相关主题的更多信息......）

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-03-02T03:24:40.107

这就是 Visual C# 程序经理不得不说的： [为什么 C# 没有'with'语句？](https://docs.microsoft.com/en-us/archive/blogs/csharpfaq/why-doesnt-c-have-vb-nets-with-operator)

> 包括 C# 语言设计者在内的许多人认为，'with' 通常会损害可读性，与其说是祝福，不如说是诅咒。使用有意义的名称声明一个局部变量，并使用该变量对单个对象执行多个操作，比使用具有某种隐式上下文的块更清楚。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-05-28T10:37:48.893

正如上面链接的 Visual C# 程序管理器所说，在有限的情况下，With 语句更有效，他给出的示例是当它被用作重复访问复杂表达式的速记时。

使用扩展方法和泛型，您可以通过添加如下内容来创建与 With 语句大致等效的内容：

```
 public static T With<T>(this T item, Action<T> action)
    {
        action(item);
        return item;
    } 
```

举一个如何使用它的简单示例，使用 lambda 语法，您可以使用它来更改如下内容：

```
 updateRoleFamily.RoleFamilyDescription = roleFamilyDescription;
    updateRoleFamily.RoleFamilyCode = roleFamilyCode; 
```

对此：

```
 updateRoleFamily.With(rf =>
          {
              rf.RoleFamilyDescription = roleFamilyDescription;
              rf.RoleFamilyCode = roleFamilyCode;
          }); 
```

在这样的示例中，唯一的优势可能是更好的布局，但使用更复杂的引用和更多属性，它可以为您提供更易读的代码。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-01-26T23:39:40.350

[在“使用对象](http://www.harding.edu/fmccown/vbnet_csharp_comparison.html#objects)”部分的页面下方大约 3/4 ：

VB：

```
With hero 
  .Name = "SpamMan" 
  .PowerLevel = 3 
End With 
```

C＃：

```
//No "With" construct
hero.Name = "SpamMan"; 
hero.PowerLevel = 3; 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-01-26T22:57:57.267

不，那里没有。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2020-10-13T15:44:50.937

`with`关键是在 C# 版本 9 中引入！您可以使用它来创建对象的副本，如下所示

```
Person brother = person with { FirstName = "Paul" }; 
```

“上面的行创建了一个新的 Person 记录，其中 LastName 属性是 person 的副本，FirstName 是“Paul”。您可以在 with 表达式中设置任意数量的属性。除了“clone”之外的任何合成成员方法可能由您编写。如果记录类型具有与任何合成方法的签名匹配的方法，则编译器不会合成该方法。

**更新：**

在编写此答案时，C#9 尚未正式发布，仅处于预览状态。但是，它[计划](https://github.com/dotnet/core/blob/master/roadmap.md)在 2020 年 11 月与 .NET 5.0 一起发布

有关更多信息，请检查[记录类型](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#record-types)。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2015-05-17T08:27:28.967

最简单的语法是：

```
{
    var where = new MyObject();
    where.property = "xxx";
    where.SomeFunction("yyy");
}

{
    var where = new MyObject();
    where.property = "zzz";
    where.SomeFunction("uuu");
} 
```

实际上，如果您想重用变量名，那么像这样的额外代码块非常方便。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2018-02-05T14:57:35.637

我所做的是使用 csharp ref 关键字。例如：

```
ref MySubClassType e = ref MyMainClass.MySubClass; 
```

然后，您可以使用以下快捷方式： `e.property`而不是`MyMainClass.MySubClass.property`

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-26T23:12:33.243

您可以使用参数累加器模式。

关于这个的大讨论在这里：

[http://blogs.msdn.com/csharpfaq/archive/2004/03/11/87817.aspx](http://blogs.msdn.com/csharpfaq/archive/2004/03/11/87817.aspx)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-03-30T20:30:10.200

有时，您可以通过以下方式侥幸逃脱：

```
var fill = cell.Style.Fill;
fill.PatternType = ExcelFillStyle.Solid;
fill.BackgroundColor.SetColor(Color.Gray);
fill.PatternColor = Color.Black;
fill.Gradient = ... 
```

（EPPLus @ [http://zeeshanumardotnet.blogspot.com](http://zeeshanumardotnet.blogspot.com)的代码示例）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-09-25T03:52:40.373

我是这样使用的：

```
 worksheet.get_Range(11, 1, 11, 41)
            .SetHeadFontStyle()
            .SetHeadFillStyle(45)
            .SetBorders(
                XlBorderWeight.xlMedium
                , XlBorderWeight.xlThick
                , XlBorderWeight.xlMedium
                , XlBorderWeight.xlThick)
            ; 
```

SetHeadFontStyle / SetHeadFillStyle 是**Range**的 ExtMethod，如下所示：

```
 public static Range SetHeadFillStyle(this Range rng, int colorIndex)
 {
     //do some operation
     return rng;
 } 
```

做一些操作并返回**范围**以进行下一次操作

它看起来像 Linq :)

但现在仍然不能完全像它 - 属性设置值

```
with cell.Border(xlEdgeTop)
   .LineStyle = xlContinuous
   .Weight = xlMedium
   .ColorIndex = xlAutomatic 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-08-03T06:17:58.957

这里的忠实粉丝`With`！

这实际上是我当前的 C# 代码：

```
if (SKYLib.AccountsPayable.Client.ApiAuthorization.Authorization.AccessTokenExpiry == null || SKYLib.AccountsPayable.Client.ApiAuthorization.Authorization.AccessTokenExpiry < DateTime.Now)
{
    SKYLib.AccountsPayable.Client.ApiAuthorization.Authorization.Refresh();
    _api = new SKYLib.AccountsPayable.Api.DefaultApi(new SKYLib.AccountsPayable.Client.Configuration { DefaultHeader = SKYLib.AccountsPayable.Client.ApiAuthorization.Authorization.ApiHeader });
} 
```

在 VB 中可能是：

```
With SKYLib.AccountsPayable.Client.ApiAuthorization.Authorization
    If .AccessTokenExpiry Is Nothing OrElse .AccessTokenExpiry < Now Then .Refresh()
    _api = New SKYLib.AccountsPayable.Api.DefaultApi(New SKYLib.AccountsPayable.Client.Configuration With {DefaultHeader = .ApiHeaders}
End With 
```

我想清楚多了。您甚至可以通过调整`With`变量将其调整为更简洁。而且，在风格方面，我还有*选择*！也许 C# 程序经理忽略了一些东西。

顺便说一句，这种情况并不常见，但我有时会使用它：

代替

```
Using oClient As HttpClient = New HttpClient
    With oClient
        .BaseAddress = New Uri("http://mysite")
        .Timeout = New TimeSpan(123)
        .PostAsync( ... )
    End With
End Using 
```

您可以使用

```
With New HttpClient
    .BaseAddress = New Uri("http://mysite")
    .Timeout = New TimeSpan(123)
    .PostAsync( ... )
End With 
```

你冒着被打手腕的风险——就像我发帖一样！- 但似乎您`Using`在处置等方面获得了声明的所有好处，而无需额外的繁琐。

注意：这偶尔会出错，所以只将它用于非关键代码。或者根本没有。记住：你有一个选择......

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-06-05T16:53:49.090

为了让生活更轻松，您可以使用垂直选择来快速编辑内容

[http://joelabrahamsson.com/select-columns-of-text-in-visual-studio/](http://joelabrahamsson.com/select-columns-of-text-in-visual-studio/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-01-30T23:05:46.273

还有另一个有趣的 with-pattern 实现

```
public static T With<T>(this T o, params object[] pattern) => o;
public static T To<T>(this T o, out T x) => x = o; 
```

[您可以通过链接](https://github.com/dotnet/csharplang/issues/803#issuecomment-361726730)浏览更多详细信息并研究[在线代码示例](https://dotnetfiddle.net/1sbITc)。

用法的变化

```
static Point Sample0() => new Point().To(out var p).With(
    p.X = 123,
    p.Y = 321,
    p.Name = "abc"
);

public static Point GetPoint() => new Point { Name = "Point Name" };
static string NameProperty { get; set; }
static string NameField;

static void Sample1()
{
    string nameLocal;
    GetPoint().To(out var p).With(
        p.X = 123,
        p.Y = 321,
        p.Name.To(out var name), /* right side assignment to the new variable */
        p.Name.To(out nameLocal), /* right side assignment to the declared var */
        NameField = p.Name, /* left side assignment to the declared variable */
        NameProperty = p.Name /* left side assignment to the property */
    );

    Console.WriteLine(name);
    Console.WriteLine(nameLocal);
    Console.WriteLine(NameField);
    Console.WriteLine(NameProperty);
}

static void Sample2() /* non-null propogation sample */
{
    ((Point)null).To(out var p)?.With(
        p.X = 123,
        p.Y = 321,
        p.Name.To(out var name)
    );

    Console.WriteLine("No exception");
}

static void Sample3() /* recursion */
{
    GetPerson().To(out var p).With(
        p.Name.To(out var name),
        p.Subperson.To(out var p0).With(
            p0.Name.To(out var subpersonName0)
        ),
        p.GetSubperson().To(out var p1).With( /* method return */
            p1.Name.To(out var subpersonName1)
        )
    );

    Console.WriteLine(subpersonName0);
    Console.WriteLine(subpersonName1);
} 
```

如果您使用 structs [值类型]，类似的扩展方法也会很有用

```
public static TR Let<T, TR>(this T o, TR y) => y; 
```

可以在 With 方法之后应用，因为默认情况下将返回 struct 的未修改副本

```
struct Point
{
    public double X;
    public double Y;
    public string Name;
}

static Point Sample0() => new Point().To(out var p).With(
    p.X = 123,
    p.Y = 321,
    p.Name = "abc"
).Let(p); 
```

喜欢就尽情享受吧！

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-03-14T22:44:43.010

我认为“with”的壁橱是`static using`，但仅适用于静态的方法或属性。例如

```
using static System.Math;
...
public double Area
{
   get { return PI * Pow(Radius, 2); } // PI == System.Math.PI
} 
```

更多信息： [https ://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using-static](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using-static)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-07-18T20:39:29.153

对我来说，我试图自动生成代码，并且需要为多个不同的类重用像“x”这样的简单变量，这样我就不必不断生成新的变量名。我发现如果我只是将代码放在花括号部分 {} 中，我可以限制变量的范围并多次重用它。

请参阅示例：

```
public class Main
{
    public void Execute()
    {
        // Execute new Foos and new Bars many times with same variable.
        double a = 0;
        double b = 0;
        double c = 0;
        double d = 0;
        double e = 0;
        double f = 0;

        double length = 0;
        double area = 0;
        double size = 0;

        {
            Foo x = new Foo(5, 6).Execute();
            a = x.A;
            b = x.B;
            c = x.C;
            d = x.D;
            e = x.E;
            f = x.F;
        }
        {
            Bar x = new Bar("red", "circle").Execute();
            length = x.Length;
            area = x.Area;
            size = x.Size;
        }
        {
            Foo x = new Foo(3, 10).Execute();
            a = x.A;
            b = x.B;
            c = x.C;
            d = x.D;
            e = x.E;
            f = x.F;
        }
        {
            Bar x = new Bar("blue", "square").Execute();
            length = x.Length;
            area = x.Area;
            size = x.Size;
        }
    }
}

public class Foo
{
    public int X { get; set; }
    public int Y { get; set; }
    public double A { get; private set; }
    public double B { get; private set; }
    public double C { get; private set; }
    public double D { get; private set; }
    public double E { get; private set; }
    public double F { get; private set; }

    public Foo(int x, int y)
    {
        X = x;
        Y = y;
    }

    public Foo Execute()
    {
        A = X * Y;
        B = X + Y;
        C = X / (X + Y + 1);
        D = Y / (X + Y + 1);
        E = (X + Y) / (X + Y + 1);
        F = (Y - X) / (X + Y + 1);
        return this;
    }
}

public class Bar
{
    public string Color { get; set; }
    public string Shape { get; set; }
    public double Size { get; private set; }
    public double Area { get; private set; }
    public double Length { get; private set; }

    public Bar(string color, string shape)
    {
        Color = color;
        Shape = shape;
    }

    public Bar Execute()
    {
        Length = Color.Length + Shape.Length;
        Area = Color.Length * Shape.Length;
        Size = Area * Length;
        return this;
    }
} 
```

在 VB 中，我会使用 With 而根本不需要变量“x”。排除Foo和Bar的vb类定义，vb代码为：

```
Public Class Main
    Public Sub Execute()
        Dim a As Double = 0
        Dim b As Double = 0
        Dim c As Double = 0
        Dim d As Double = 0
        Dim e As Double = 0
        Dim f As Double = 0
        Dim length As Double = 0
        Dim area As Double = 0
        Dim size As Double = 0

        With New Foo(5, 6).Execute()
            a = .A
            b = .B
            c = .C
            d = .D
            e = .E
            f = .F
        End With

        With New Bar("red", "circle").Execute()
            length = .Length
            area = .Area
            size = .Size
        End With

        With New Foo(3, 10).Execute()
            a = .A
            b = .B
            c = .C
            d = .D
            e = .E
            f = .F
        End With

        With New Bar("blue", "square").Execute()
            length = .Length
            area = .Area
            size = .Size
        End With
    End Sub
End Class 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-01-10T20:00:51.290

# **C# 9 及更高版本：**

`with`关键字终于加了！

它只支持`record`类型。

## 用法

复制关键字左侧的实例，`with`并根据其相应值修改其右侧提到的所有字段以返回新实例。

## 例子

假设我们有以下`record`类型：

```
public record Model(string Prefix, string Location, bool CoolLocation, bool HasCitizens); 
```

我们初始化了以下原始模型：

```
var model = new Model("Hello", "World", true, true); 
```

我们想创建一个新模型，除了`Location`和之外，所有字段都相同`HasCitizens`。我们可以通过以下方式做到这一点：

```
var model2 = model with { Location = "Mars", HasCitizens = false };
   // Prefix = "Hello"
   // Location = "Mars"
   // CoolLocation = true
   // HasCitizens = false 
```

# C# 10 及更高版本：

关键字现在`with`还可以用于`struct`和`anonymous`类型。

有关关键字的更多信息`with`可以在[官方文档中找到](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/with-expression)

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2009-01-26T23:33:32.560

唔。我从来没有深入使用过 VB.net，所以我在这里做一个假设，但我认为“使用”块可能接近你想要的。

using 定义变量的块范围，请参见下面的示例

```
using ( int temp = someFunction(param1) ) {
   temp++;  // this works fine
}

temp++; // this blows up as temp is out of scope here and has been disposed 
```

[这是 Microsoft 的一篇文章，它解释了更多](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx)

* * *

编辑：是的，这个答案是错误的——最初的假设是不正确的。VB 的“WITH”更像是新的 C# 对象初始化器：

```
var yourVariable = new yourObject { param1 = 20, param2 = "some string" }; 
```

* * *

## 回答 #19

> 赞同：-3
> 
> 时间：2015-10-08T17:46:00.587

如果有多个级别的对象，您可以使用“使用”指令获得类似的功能：

```
using System;
using GenderType = Hero.GenderType; //This is the shorthand using directive
public partial class Test : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        var myHero = new Hero();
        myHero.Name = "SpamMan";
        myHero.PowerLevel = 3;
        myHero.Gender = GenderType.Male; //instead of myHero.Gender = Hero.GenderType.Male;
    }
}
public class Hero
{
    public enum GenderType
    {
        Male,
        Female,
        Other
    }
    public string Name;
    public int PowerLevel;
    public GenderType Gender;
} 
```

# c# - 如何将序列化的 LINQ to SQL 实体添加到 Word 2007 文档

> ID：481728
> 
> 赞同：2
> 
> 时间：2009-01-26T22:57:09.263
> 
> 标签：c#, linq-to-sql, linq-to-xml, word-2007, openxml-sdk

[我使用Open XML SDK (1.0)](http://msdn.microsoft.com/en-us/library/bb448854.aspx)、[Word 2007 内容控制工具包](http://www.codeplex.com/dbe)和 LINQ to SQL（使用 CodeSmith PLINQO 模板）构建了一个基于模板的文档生成器。为此，我通过使用源代码中指定的 DataLoadOptions 检索实体，将 LINQ to SQL 实体序列化为 XML。

这很好用，除了最初在我的模板中填充 XML，我目前必须从 VS2008 的即时窗口中复制并粘贴 XML 到内容控制工具包中，它仍然具有来自当前实体的所有数据。

我正在寻找两种解决方案： 1) 这是用 Word 2007 构建文档生成器的好方法吗？1) 如何在没有数据的情况下只生成我需要的 XML？我曾想过创建一个 XSD，然后创建一个空的 XML 文档，但不确定如何以编程方式执行此操作，以便业务用户可以获取模板的 XML。（这不是必需的，只是一个不错的选择。）

感谢您的反馈意见，

瑞安

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T18:48:38.447

多亏了[Eric White](http://blogs.msdn.com/ericwhite/default.aspx)先生的天才，我终于搞定了。我什至设法取消了对上述工具之一的使用（Word 2007 Content Control Toolkit）。以下是我现在正在采取的步骤：

1.  使模板[数据可绑定](http://blogs.msdn.com/ericwhite/archive/2008/10/19/creating-data-bound-content-controls-using-the-open-xml-sdk-and-linq-to-xml.aspx)。
2.  制作要保存更改的模板的副本。
3.  使用 LINQ to XML 和 Open XML SDK 从模板中[检索自定义 XML 。](http://blogs.msdn.com/ericwhite/archive/2008/07/09/open-xml-sdk-and-linq-to-xml.aspx)
4.  使用 DataContractSerializer 序列化 LINQ to SQL 实体。
5.  使用 LINQ to XML 根据 a) 实体名称和 b) 属性名称查找适当的后代。
6.  [克隆自定义 XML](http://blogs.msdn.com/ericwhite/archive/2009/01/28/manually-cloning-linq-to-xml-trees.aspx)并用序列化 LINQ to SQL 实体中的值填充它（这使用 Eric 的 Clone() 方法的修改版本）。
7.  用克隆和填充[的自定义 XML 替换文档中的自定义 XML（由 Brian Jones 提供）。](http://blogs.msdn.com/brian_jones/archive/2009/01/05/taking-advantage-of-bound-content-controls.aspx)
8.  完毕！

我附上了我在以下上述步骤中使用的扩展方法：

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Xml;
using System.Xml.Linq;
using DocumentFormat.OpenXml.Packaging;

namespace OpenXmlDocGenerator
{
    /// <summary>
    /// Adds extensions for making the Open XML SDK and LINQ to XML easier to use.
    /// </summary>
    public static class OpenXmlExtensions
    {
        #region fields

        private static readonly XNamespace w = "http://schemas.openxmlformats.org/wordprocessingml/2006/main";
        private static readonly XName r = w + "r";
        private static readonly XName ins = w + "ins";
        private static readonly XNamespace ds = "http://schemas.openxmlformats.org/officeDocument/2006/customXml";

        #endregion

        #region methods

        /// <summary>
        /// Adds the custom XML part to the main document part.
        /// </summary>
        /// <param name="document">The main document part.</param>
        /// <param name="customXml">The custom XML.</param>
        /// <returns>The <see cref="CustomXmlPart" />.</returns>
        public static void AddCustomXmlPart(this MainDocumentPart document, XDocument customXml)
        {
            CustomXmlPart customXmlPart = document.AddNewPart<CustomXmlPart>();
            customXmlPart.PutXDocument(customXml);
        }

        /// <summary>
        /// Adds the custom XML part with a custom XML properties to the main document part.
        /// </summary>
        /// <param name="mainPart">The main document part.</param>
        /// <param name="customXml">The custom XML.</param>
        /// <param name="customXmlProperties">The custom XML properties.</param>
        public static void AddCustomXmlPart(
            this MainDocumentPart mainPart, XDocument customXml, XDocument customXmlProperties)
        {
            CustomXmlPart customXmlPart = mainPart.AddNewPart<CustomXmlPart>();
            CustomXmlPropertiesPart customXmlPropertiesPart = customXmlPart.AddNewPart<CustomXmlPropertiesPart>();
            customXmlPropertiesPart.PutXDocument(customXmlProperties);
            customXmlPart.PutXDocument(customXml);
        }

        /// <summary>
        /// Clones the specified element.
        /// </summary>
        /// <param name="element">The element.</param>
        /// <returns>The cloned <see cref="XElement" />.</returns>
        public static XElement Clone(this XElement element)
        {
            return new XElement(element.Name,
                       element.Attributes(),
                       element.Nodes().Select(n =>
                          {
                              XElement e = n as XElement;
                              if (e != null)
                              {
                                  return e.Clone();
                              }

                              return n;
                          }
                       ),
                       (!element.IsEmpty && !element.Nodes().OfType<XText>().Any()) ? string.Empty : null
                   );
        }

        /// <summary>
        /// Fills the specified element with the provided <paramref name="entityMap"/>.
        /// </summary>
        /// <param name="element">The element.</param>
        /// <param name="entityMap">The entity map between the custom XML elements and the entity values.</param>
        /// <returns>The filled <see cref="XElement"/>.</returns>
        public static XElement Fill(this XElement element, IDictionary<string, object> entityMap)
        {
            return new XElement(element.Name,
                       element.Attributes(),
                       element.Nodes().Select(node =>
                          {
                              XElement childElement = node as XElement;
                              if (childElement != null)
                              {
                                  // If the child element does not have elements,
                                  // attempt to insert the value from the entity map;
                                  // otherwise, recursively call the Fill() to find
                                  // child elements to fill.
                                  return !childElement.HasElements
                                             ? InsertValue(childElement, entityMap)
                                             : childElement.Fill(entityMap);
                              }

                              return node;
                          }
                       ),
                       (!element.IsEmpty && !element.Nodes().OfType<XText>().Any()) ? string.Empty : null
                   );
        }

        /// <summary>
        /// Gets a descendant element of the specified element the by the descendant's name.
        /// </summary>
        /// <param name="element">The element from which to find the descendant element.</param>
        /// <param name="descendantElementName">Name of the descendant element.</param>
        /// <returns>The descendant <see cref="XElement" />.</returns>
        /// <exception cref="ArgumentNullException">Thrown when the <paramref name="element"/> is null.</exception>
        public static XElement GetDescendantByName(this XElement element, string descendantElementName)
        {
            if (element == null)
            {
                throw new ArgumentNullException("element");
            }

            return element.Elements().DescendantsAndSelf().FirstOrDefault(e => e.Name.LocalName == descendantElementName);
        }

        /// <summary>
        /// Gets the custom XML from the main document part.
        /// </summary>
        /// <param name="mainPart">The main document part.</param>
        /// <returns>The custom XML as a <see cref="XElement" />.</returns>
        public static XElement GetCustomXml(this MainDocumentPart mainPart)
        {
            CustomXmlPart customXmlPart = mainPart.GetPartsOfType<CustomXmlPart>().FirstOrDefault();
            return customXmlPart == null ? null : customXmlPart.GetXDocument().Root;
        }

        /// <summary>
        /// Gets the XDocument from the document part.
        /// </summary>
        /// <param name="part">The document part.</param>
        /// <returns>The XDocument.</returns>
        public static XDocument GetXDocument(this OpenXmlPart part)
        {
            XDocument xdoc = part.Annotation<XDocument>();
            if (xdoc != null)
            {
                return xdoc;
            }

            using (StreamReader streamReader = new StreamReader(part.GetStream()))
            using (XmlReader xmlReader = XmlReader.Create(streamReader))
            {
                xdoc = XDocument.Load(xmlReader);
            }

            part.AddAnnotation(xdoc);
            return xdoc;
        }

        /// <summary>
        /// Determines whether the specified document is bindable.
        /// </summary>
        /// <param name="document">The document.</param>
        /// <returns>
        ///     <c>true</c> if the specified document has a <see cref="CustomXmlPart" />; otherwise, <c>false</c>.
        /// </returns>
        public static bool IsBindable(this WordprocessingDocument document)
        {
            return document.MainDocumentPart.GetPartsCountOfType<CustomXmlPart>() > 0;
        }

        /// <summary>
        /// Serializes the XDocument back into the package.
        /// </summary>
        /// <param name="part">The document part.</param>
        /// <param name="xdoc">The <see cref="XDocument" />.</param>
        public static void PutXDocument(this OpenXmlPart part, XDocument xdoc)
        {
            if (xdoc != null)
            {
                using (Stream stream = part.GetStream(FileMode.Create, FileAccess.ReadWrite))
                using (XmlWriter partWriter = XmlWriter.Create(stream))
                {
                    xdoc.Save(partWriter);
                }
            }
        }

        /// <summary>
        /// Removes the custom XML parts.
        /// </summary>
        /// <param name="mainPart">The main document part.</param>
        public static void RemoveCustomXmlParts(this MainDocumentPart mainPart)
        {
            if (mainPart.CustomXmlParts.Count() > 0)
            {
                mainPart.DeleteParts(mainPart.CustomXmlParts);
            }
        }

        /// <summary>
        /// Replaces the custom XML in the main document mainPart.
        /// </summary>
        /// <param name="mainPart">The main document part.</param>
        /// <param name="customXml">The custom XML.</param>
        public static void ReplaceCustomXml(this MainDocumentPart mainPart, XElement customXml)
        {
            if (customXml != null)
            {
                mainPart.RemoveCustomXmlParts();

                CustomXmlPart customXmlPart = mainPart.AddNewPart<CustomXmlPart>();
                using (Stream stream = customXmlPart.GetStream(FileMode.Create, FileAccess.ReadWrite))
                using (XmlWriter writer = XmlWriter.Create(stream))
                {
                    customXml.Save(writer);
                }   
            }
        }

        /// <summary>
        /// Translates the <paramref name="source"/> collection using the <paramref name="translate"/>,
        /// then concatenates and returns the result.
        /// </summary>
        /// <typeparam name="T">The type of the items in the source.</typeparam>
        /// <param name="source">The source.</param>
        /// <param name="translate">The translation function to perform on each item in the source.</param>
        /// <returns>The concatenated contents of the source collection.</returns>
        public static string StringConcatenate<T>(this IEnumerable<T> source, Func<T, string> translate)
        {
            return source.Aggregate(new StringBuilder(), (s, i) => s.Append(translate(i)), s => s.ToString());
        }

        /// <summary>
        /// Concatenates the items in the <paramref name="source"/> and returns the result.
        /// </summary>
        /// <param name="source">The source.</param>
        /// <returns>The concatenated contents of the source collection.</returns>
        public static string StringConcatenate(this IEnumerable<string> source)
        {
            return source.Aggregate(new StringBuilder(), (s, i) => s.Append(i), s => s.ToString());
        }

        /// <summary>
        /// Creates a bindable version of the <see cref="WordprocessingDocument" />.
        /// </summary>
        /// <param name="document">The document.</param>
        /// <returns>The <see cref="WordprocessingDocument" />.</returns>
        /// <seealso cref="http://blogs.msdn.com/ericwhite/archive/2008/10/19/creating-data-bound-content-controls-using-the-open-xml-sdk-and-linq-to-xml.aspx"/>
        public static WordprocessingDocument ToBindable(this WordprocessingDocument document)
        {
            foreach (MainDocumentPart mainPart in document.GetPartsOfType<MainDocumentPart>())
            {
                mainPart.RemoveCustomXmlParts();

                Guid id = Guid.NewGuid();
                XDocument customXml = mainPart.CreateCustomXml();
                XDocument customXmlProperties = CreateCustomXmlProperties(id);
                mainPart.AddCustomXmlPart(customXml, customXmlProperties);

                XDocument partXDoc = mainPart.GetXDocument();
                AddDataBinding(partXDoc, id);
                mainPart.PutXDocument(partXDoc);
            }

            return document;
        }

        #region --private

        /// <summary>
        /// Adds data binding to the content controls.
        /// </summary>
        /// <param name="mainDocumentXDoc">The main document <see cref="XDocument" />.</param>
        /// <param name="id">The id.</param>
        private static void AddDataBinding(XDocument mainDocumentXDoc, Guid id)
        {
            foreach (XElement sdt in mainDocumentXDoc.Descendants(w + "sdt"))
            {
                sdt.Element(w + "sdtPr")
                    .Element(w + "placeholder")
                    .AddAfterSelf(
                    new XElement(w + "dataBinding",
                        new XAttribute(w + "xpath",
                            "/root/" + sdt.Element(w + "sdtPr")
                                .Element(w + "tag")
                                .Attribute(w + "val").Value),
                        new XAttribute(w + "storeItemID",
                            "{" + id.ToString().ToUpper() + "}")
                    )
                );
            }
        }

        /// <summary>
        /// Creates the custom XML from the existing content controls.
        /// </summary>
        /// <param name="mainPart">The main document part.</param>
        /// <returns>The custom XML as a <see cref="XDocument" />.</returns>
        private static XDocument CreateCustomXml(this MainDocumentPart mainPart)
        {
            XElement customXml =
                new XElement("root",
                    mainPart
                    .GetXDocument()
                    .Descendants(w + "sdt")
                    .Select(sdt =>
                        new XElement(
                            sdt.Element(w + "sdtPr")
                                .Element(w + "tag")
                                .Attribute(w + "val").Value,
                             GetTextFromContentControl(sdt).Trim())
                    )
                );

            return new XDocument(customXml);
        }

        /// <summary>
        /// Creates the custom XML property part contents.
        /// </summary>
        /// <param name="id">The id.</param>
        /// <returns>The contents of the custom XML properties part.</returns>
        private static XDocument CreateCustomXmlProperties(Guid id)
        {
            return new XDocument(
                       new XElement(ds + "datastoreItem",
                           new XAttribute(ds + "itemID",
                               "{" + id.ToString().ToUpper() + "}"),
                           new XAttribute(XNamespace.Xmlns + "ds",
                               ds.NamespaceName),
                           new XElement(ds + "schemaRefs")
                       )
                   );
        }

        /// <summary>
        /// Gets the text from content control.
        /// </summary>
        /// <param name="contentControlNode">The content control node.</param>
        /// <returns>The string representation of the value in the content control.</returns>
        static string GetTextFromContentControl(XElement contentControlNode)
        {
            return contentControlNode.Descendants(w + "p")
                .Select(p => p.Elements()
                                 .Where(z => z.Name == r || z.Name == ins)
                                 .Descendants(w + "t")
                                 .StringConcatenate(element => (string)element) + Environment.NewLine)
                .StringConcatenate();
        }

        /// <summary>
        /// Inserts the value from the <paramref name="entityMap"/> into the <paramref name="childElement"/>.
        /// </summary>
        /// <param name="childElement">The child element.</param>
        /// <param name="entityMap">The entity map.</param>
        private static XElement InsertValue(XElement childElement, IDictionary<string, object> entityMap)
        {
            string name = childElement.Name.LocalName;

            if (entityMap.Keys.Contains(name))
            {
                childElement.SetValue(entityMap[name] ?? string.Empty);
            }
            else
            {
                childElement.SetValue(string.Empty);
            }

            return childElement;
        }

        #endregion

        #endregion
    }
} 
```

# string - Reporting Services/Dundas 图表的单元格格式字符串

> ID：481730
> 
> 赞同：3
> 
> 时间：2009-01-26T22:57:31.387
> 
> 标签：string, reporting-services, formatting, cell, dundas

报告服务使用格式字符串来自动格式化单元格数据。例如，“c2”格式化单元格以显示为小数精度为 2 的货币。

有谁知道我在哪里可以找到所有可用格式的完整列表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T00:41:44.543

Reporting Services 使用 .Net 格式字符串。所以你可以在 MSDN 上查找它们。这是[标准代码](http://msdn.microsoft.com/en-us/library/dwhawy9k(VS.95).aspx)的链接，这里是创建[自定义代码](http://msdn.microsoft.com/en-us/library/0c899ak8(VS.95).aspx)的参考。

标准代码就像您作为示例提供的“C2”，其优点是它“知道”您是区域设置。所以美国的 C2 格式与日本的 C2 不同。

自定义代码允许您自己滚动。例如，"#,##0.0" 会将数字格式化为带有千位分隔符的小数点后一位，如果值介于 1 和 -1 之间，则前导 0。使用自定义字符串，如果它是正数、负数或 0，您还可以使用单独的格式。

# php - 如何以编程方式确定文件的真实扩展名/类型？

> ID：481743
> 
> 赞同：11
> 
> 时间：2009-01-26T22:59:43.953
> 
> 标签：php, security, file-upload, file-type

我正在编写一个脚本，该脚本将处理用户上传到服务器的内容，作为附加的安全层，我想知道：

有没有办法检测文件的真实扩展名/文件类型，并确保它不是用不同扩展名屏蔽的另一种文件类型？

每种类型/扩展是否有字节标记或某些唯一标识符？

我希望能够检测到有人没有对他们上传的文件应用不同的扩展名。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-26T23:05:59.713

不是真的，不。

您将需要读取每个文件的前几个字节，并将其解释为有限已知文件类型集的标头。大多数文件都有不同的文件头，在 MP3 的前几个字节或前几千字节中有某种元数据。

您的程序将不得不简单地尝试为您接受的每个文件类型解析文件。

对于我的程序，我在 try-catch 块中将上传的图像发送到 imagemagick，如果它爆炸了，那么我猜这是一个坏图像。这应该被认为是不安全的，因为我将任意（用户提供的）二进制数据加载到外部程序中，这通常是一个攻击向量。在这里，我相信 imageMagick 不会对我的系统做任何事情。

我建议为您打算使用的重要文件类型编写自己的处理程序，以避免任何攻击媒介。

编辑：我在 PHP 中看到有一些工具可以为您执行此操作。

此外，MIME 类型是用户浏览器声明文件的类型。阅读这些内容并在您的代码中对其进行操作非常方便且有用，但这不是一种安全的方法，因为任何向您发送错误文件的人都会很容易伪造 MIME 标头。这是一种前线防御，以防止期望 JPEG 的代码与 PNG 相冲突，但如果有人在 .exe 中嵌入病毒并将其命名为 JPEG，则没有理由不欺骗 MIME 类型。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-26T23:04:44.350

PHP 有几种读取文件内容的方法来确定其 MIME 类型，具体取决于您使用的 PHP 版本：

如果您正在运行 PHP 5.3+，请查看[Fileinfo 函数](http://php.net/manual/en/ref.fileinfo.php)

```
$finfo = finfo_open(FILEINFO_MIME); 
$type = finfo_file($finfo, $filepath);
finfo_close($finfo); 
```

或者，查看 旧版本的[mime_content_type](http://php.net/mime_content_type)。

```
$type = mime_content_type($filepath); 
```

请注意，如果您想要真正安全，仅验证文件类型是不够的。例如，有人可以上传一个有效的 JPEG 文件，该文件利用了普通渲染器中的漏洞。为了防止这种情况，您需要一个维护良好的病毒扫描程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T23:10:52.357

PHP 有一个[超全局的](http://us2.php.net/manual/en/language.variables.superglobals.php) [$_FILES](http://us2.php.net/manual/en/reserved.variables.files.php)来保存大小和文件类型等信息。看起来该类型是从某种标题中获取的，而不是扩展名，但我可能错了。

[w3schools 网站](http://www.w3schools.com/PHP/php_file_upload.asp)上有一个例子。

当我有机会时，我将测试它是否可以被欺骗。

更新：

其他人可能都知道这一点，但 $_FILES 可以被欺骗。我能够以这种方式确定它：

```
$arg = escapeshellarg( $_FILES["file"]["tmp_name"] );
system( "file $arg", $type );
echo "Real type:  " . $type; 
```

它基本上使用Unix的[文件](http://unixhelp.ed.ac.uk/CGI/man-cgi?file)命令。可能有更好的方法，但我有一段时间没有使用 PHP。如果可能，我通常会避免使用系统命令。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T23:04:01.933

那仍然可以伪造。我会确保您不能（或不）运行自动上传到服务器的文件。

我也会有一个[病毒/间谍软件扫描器](http://www.clamwin.com/)，让它为你工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-02-24T07:18:00.243

如果您更改了扩展名，您可以使用下面的代码为您提供 MIME 类型

```
$finfo = finfo_open(FILEINFO_MIME_TYPE);
echo $mime = finfo_file($finfo, $_FILES['userfile']['tmp_name']);
finfo_close($finfo); 
```

Windows 用户：只需编辑 php.ini 并取消注释此行：

```
extension=php_fileinfo.dll 
```

记得重启 Apache 以使新的 php.ini 生效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T23:02:42.497

在 *nix 中，文件的前两个字节告诉你（参见“幻数”）。在 Windows 中，……有时这是真的（“标题信息”）。它最终取决于操作系统。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T23:03:07.677

可执行文件通常在第一个字节上有一个“签名”；我发现很难真正确定文件类型到底是什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T23:05:32.960

您期望什么文件类型？也许您可以检查它是否符合您的期望并拒绝其他所有内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-26T23:11:31.263

其他人已经提到了 FileInfo，我认为这是正确的解决方案，但我会添加它以防万一您由于某种原因无法使用该解决方案。大多数（全部？）*nix 发行版都包含一个命令`file`，当在文件上运行时将输出其类型。它具有以人类可读格式（默认）或 MIME 类型输出的开关。您可以让您的脚本在上传的文件上调用该程序并读取结果。同样，这不是首选方法。如果您使用的是 Windows，则可以通过 Cygwin 使用此实用程序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-26T23:13:48.810

检查 MIME 类型是否足够简单？我假设更改文件的扩展名不会改变它的 MIME 类型？

MIME 类型是一个足够强大的指标吗？

感谢您迄今为止的所有回复。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-26T23:21:39.963

> 检查 MIME 类型是否足够简单？我假设更改文件的扩展名不会改变它的 MIME 类型？MIME 类型是一个足够强大的指标吗？

这实际上取决于它的使用方式。

*   如果您提供上传和下载，那么一切都不重要，因为它不会执行。
*   如果它由 Web 服务器处理，那么它将取决于 Web 服务器的配置方式，尽管受制于这些评论中的大部分内容。
*   如果是图像，它要么显示，要么不显示，或者成为图像库攻击的目标。但只有那些。
*   像 pdf 文件之类的东西可能不会影响您的服务器，但会影响访问该文件的人的计算机。
*   如果它要被传递给像“system()”这样的函数，那么我们就回到操作系统的行为——就好像它被“双击”一样，甚至可能会考虑文件扩展名。

# named-pipes - 在 Windows 中枚举命名管道

> ID：481759
> 
> 赞同：5
> 
> 时间：2009-01-26T23:05:40.230
> 
> 标签：named-pipes

我无法连接到命名管道（在本例中为快速 cgi 命名管道）根据 MSDN，我应该使用 CreateFile() 或 CallNamedPipe() （平面 C API，同步 - 无重叠 I/O） [http：/ /msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx)

然而我得到 INVALID_HANDLE_VALUE 并且当我 GetLastError() 它为零！？

我也想知道我是否可以用*.* 某种调用，然后解析出我正在寻找的那个：“\.\pipe\FastCGI\”

有没有人有这些评论的经验：http: [//blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/225878](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/225878)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T06:45:51.523

问题出在这里：

```
 TmpInfo = DirInfo;   
    while(1)   
    {   
       if(TmpInfo->NextEntryOffset==0)   
         break;   

       TmpInfo->FileDirectoryInformationClass.FileName[TmpInfo->FileNameLength/sizeof(WCHAR)] = NULL;   

       wprintf(L"%s (%d, %d)\n",TmpInfo->FileDirectoryInformationClass.FileName,   
                                TmpInfo->EndOfFile.LowPart,   
                                TmpInfo->AllocationSize.LowPart );   

       TmpInfo = (PFILE_QUERY_DIRECTORY)((DWORD)TmpInfo+TmpInfo->NextEntryOffset);   
    } 
```

就在“while(1)”之后，您检查**Next** EntryOffset == 0 这是否意味着最后一个条目永远不会被报告，移动“if(...) break;” 在“wprintf（...）”调用之后，您应该能够枚举所有管道。

***编辑*** 对于那些想要完整源代码（不需要 DDK）的人来说，这里是。请注意，这不是我的代码，而是在[这里](http://read.pudn.com/downloads32/sourcecode/hack/103625/pipelist.cpp__.htm)找到的。此代码与原始代码之间的唯一变化是上面详述的错误修复。

***编辑 v2.0***
在下面的代码中发现了另一个错误。当它打印有关它正在迭代的当前项目的信息时，它会在名称的末尾放置一个空字符。这个空字符实际上覆盖了下一个条目的前 2 个字节，这恰好覆盖了该条目中“NextEntryOffset”变量的 2 个最低有效字节（通常导致它等于 0），因此只有前 2 个项目是每个从每个“NtQueryDirectoryFile”调用中枚举。

我在下面的代码中添加了一个修复程序，应该可以解决这个问题（存储 WCHAR 被清除，然后在打印后恢复它。有点黑客，但这只是一些示例代码，为了正确实现，要么避免使用 wprintf打印名称，或将其复制到另一个缓冲区，您可以安全地 NULL 结束）。

* * *

```
 // pipelist.cpp (Windows NT/2000)   
//   
// This example will show how you can enumerate all named pipes   
// active on a system.   
//   
// (c)2000 Ashot Oganesyan K, SmartLine, Inc   
// mailto:ashot@aha.ru, http://www.protect-me.com, http://www.codepile.com   

#include <windows.h>   
#include <stdio.h>  

#define FileDirectoryInformation 1   
#define STATUS_NO_MORE_FILES 0x80000006L   

typedef struct   
{   
    USHORT Length;   
    USHORT MaximumLength;   
    PWSTR  Buffer;   
} UNICODE_STRING, *PUNICODE_STRING;   

typedef struct   
{   
    LONG Status;   
    ULONG Information;   
} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;   

typedef struct {   
    ULONG NextEntryOffset;   
    ULONG FileIndex;   
    LARGE_INTEGER CreationTime;   
    LARGE_INTEGER LastAccessTime;   
    LARGE_INTEGER LastWriteTime;   
    LARGE_INTEGER ChangeTime;   
    LARGE_INTEGER EndOfFile;   
    LARGE_INTEGER AllocationSize;   
    ULONG FileAttributes;   
    ULONG FileNameLength;   
    union {   
        struct {   
            WCHAR FileName[1];   
        } FileDirectoryInformationClass;   

        struct {   
            DWORD dwUknown1;   
            WCHAR FileName[1];   
        } FileFullDirectoryInformationClass;   

        struct {   
            DWORD dwUknown2;   
            USHORT AltFileNameLen;   
            WCHAR AltFileName[12];   
            WCHAR FileName[1];   
    } FileBothDirectoryInformationClass;   
    };   
} FILE_QUERY_DIRECTORY, *PFILE_QUERY_DIRECTORY;   

// ntdll!NtQueryDirectoryFile (NT specific!)   
//   
// The function searches a directory for a file whose name and attributes   
// match those specified in the function call.   
//   
// NTSYSAPI   
// NTSTATUS   
// NTAPI   
// NtQueryDirectoryFile(   
//    IN HANDLE FileHandle,                      // handle to the file   
//    IN HANDLE EventHandle OPTIONAL,   
//    IN PIO_APC_ROUTINE ApcRoutine OPTIONAL,   
//    IN PVOID ApcContext OPTIONAL,   
//    OUT PIO_STATUS_BLOCK IoStatusBlock,   
//    OUT PVOID Buffer,                          // pointer to the buffer to receive the result   
//    IN ULONG BufferLength,                     // length of Buffer   
//    IN FILE_INFORMATION_CLASS InformationClass,// information type   
//    IN BOOLEAN ReturnByOne,                    // each call returns info for only one file   
//    IN PUNICODE_STRING FileTemplate OPTIONAL,  // template for search   
//    IN BOOLEAN Reset                           // restart search   
// );   
typedef LONG (WINAPI *PROCNTQDF)( HANDLE,HANDLE,PVOID,PVOID,PIO_STATUS_BLOCK,PVOID,ULONG,   
                                  UINT,BOOL,PUNICODE_STRING,BOOL );   

PROCNTQDF NtQueryDirectoryFile;   

void main(void)   
{   
    LONG ntStatus;   
    IO_STATUS_BLOCK IoStatus;   
    HANDLE hPipe;   
    BOOL bReset = TRUE;   
    PFILE_QUERY_DIRECTORY DirInfo,   
                          TmpInfo;   

    NtQueryDirectoryFile = (PROCNTQDF)GetProcAddress(   
                                      GetModuleHandle("ntdll"),   
                                      "NtQueryDirectoryFile"   
                                      );   

    if (!NtQueryDirectoryFile)   
       return;   

    hPipe = CreateFile("\\\\.\\Pipe\\",GENERIC_READ,   
                       FILE_SHARE_READ|FILE_SHARE_WRITE|FILE_SHARE_DELETE,   
                       NULL,OPEN_EXISTING,0,NULL);   

   if(hPipe == INVALID_HANDLE_VALUE)   
     return;   

   DirInfo = (PFILE_QUERY_DIRECTORY) new BYTE[1024];   

   printf("Pipe name (Number of instances, Maximum instances)\n\n");   
   while(1)   
   {   
       ntStatus = NtQueryDirectoryFile(hPipe,NULL,NULL,NULL,&IoStatus,DirInfo,1024,   
                                       FileDirectoryInformation,FALSE,NULL,bReset);   

       if (ntStatus!=NO_ERROR)   
       {   
          if (ntStatus == STATUS_NO_MORE_FILES)   
             break;   

          return;   
       }   

       TmpInfo = DirInfo;   
       while(1)   
       {
          // Store old values before we mangle the buffer
          const int endStringAt = TmpInfo->FileNameLength/sizeof(WCHAR);
          const WCHAR oldValue = TmpInfo->FileDirectoryInformationClass.FileName[endStringAt];

          // Place a null character at the end of the string so wprintf doesn't read past the end
          TmpInfo->FileDirectoryInformationClass.FileName[endStringAt] = NULL;   

          wprintf(L"%s (%d, %d)\n",TmpInfo->FileDirectoryInformationClass.FileName,   
                                   TmpInfo->EndOfFile.LowPart,   
                                   TmpInfo->AllocationSize.LowPart );   

          // Restore the buffer to its correct state
          TmpInfo->FileDirectoryInformationClass.FileName[endStringAt] = oldValue;

          if(TmpInfo->NextEntryOffset==0)   
            break;   

          TmpInfo = (PFILE_QUERY_DIRECTORY)((DWORD)TmpInfo+TmpInfo->NextEntryOffset);   
       }   

       bReset = FALSE;   
   }   

   delete DirInfo;   
   CloseHandle(hPipe);   
} 

```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-24T20:00:11.527

如果您想要一个可以为您执行此操作的编译工具，请查看 SysInternals（由 Microsoft 拥有）的“PipeList”。

[在这里下载](http://live.sysinternals.com/pipelist.exe)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T00:15:38.030

您是否正确转义了管道名称？它应该看起来像：`\\\\.\\pipe\\FastCGI`

有关详细信息，请参阅[命名管道客户端演示](http://msdn.microsoft.com/en-us/library/aa365592(VS.85).aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T08:41:01.440

使用未记录的功能：

// NtQueryDirectoryFile(
// IN HANDLE FileHandle, // 文件句柄
// IN HANDLE EventHandle OPTIONAL,
// IN PIO_APC_ROUTINE ApcRoutine OPTIONAL,
// IN PVOID ApcContext OPTIONAL,
// OUT PIO_STATUS_BLOCK IoStatusBlock,
// OUT PVOID Buffer, / / 指向接收结果的缓冲区的指针
// IN ULONG BufferLength, // 缓冲区的长度
// IN FILE_INFORMATION_CLASS InformationClass,// 信息类型
// IN BOOLEAN ReturnByOne, // 每次调用只返回一个文件的信息
// IN PUNICODE_STRING FileTemplate OPTIONAL, // 搜索模板
// IN BOOLEAN Reset // 重新开始搜索
// );

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T20:55:26.427

谢谢你抓住那个。我将此代码转换为另一种类似 C 的语言并使用： FILE_NAMES_INFORMATION 因为我只是在寻找名称

然后我用另一个应用程序创建了一个命名管道：

```
 \\.\pipe\test 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-24T05:07:29.627

管道名称的第一个反斜杠被论坛软件截断。管道名称为：

```
\\.\pipe\test 
```

（它不需要以我用于测试的语言进行转义）

我写了两个应用程序，一个是管道服务器，一个是管道客户端来测试阻塞等它们工作得很好。

我创建管道：

```
Pipe_Name      = "\\.\pipe\test"
MaxInstances   = 1
OutBufferSize  = 1024
InBufferSize   = 1024

hPipe = CreateNamedPipe(_
Pipe_Name, _                                     ' Name of the Pipe
PIPE_ACCESS_DUPLEX, _                            ' Specifies the pipe access/overlapped/write-through/security access modes 
PIPE_TYPE_MESSAGE OR PIPE_READMODE_MESSAGE, _    ' Specifies the type, read, and wait modes of the pipe handle
MaxInstances, _                                  ' Specifies the maximum number of instances that can be created for this pipe
OutBufferSize, _                                 ' Specifies the number of bytes to reserve for the output buffer
InBufferSize, _                                  ' Specifies the number of bytes to reserve for the input buffer
0, _                                             ' Specifies the default time-out value, in milliseconds
Security_Declaration)                            ' Pointer to a SECURITY_ATTRIBUTES structure 
```

它不返回 INVALID_HANDLE_VALUE，而是一个有效的句柄，我随后使用它并完美地工作它们按预期阻塞并正常通信。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T13:00:31.067

好的，我在用于生成管道列表的代码中发现了另一个错误（关于第一个错误的帖子中的详细信息）。

至于“以及是否有人对这些评论有经验”后面的链接中的信息，我了解他们在说什么，您能否更具体地说明您不了解或好奇的内容（关于顺便说一句，不能进行非阻塞操作有点谎言，尽管它不是以 unix 系统的“传统”方式完成的）。

# windows-services - 用于维护任务的 Windows 服务或任务计划程序？

> ID：481760
> 
> 赞同：6
> 
> 时间：2009-01-26T23:05:54.567
> 
> 标签：windows-services, windows-server-2003

我有一个执行一些维护任务的 C# 应用程序。它需要大约每小时运行一次，尽管如果它有点偏离也不是很重要。它必须在没有人登录的 Win2003 服务器上运行。

基本上我想知道我是否应该编写一个 Windows 服务，如果是，如果 Thread.Sleep() 是暂停线程一小时的正确方法，或者是否有更好的方法来确保线程保持空闲并且不放任何服务器负载？（又名。与自旋​​锁最相反的是什么）

另一种选择是 Windows 任务计划程序，但我不确定这是否适合服务器使用，因为 a) 我必须将计划存储在其中而不是在我的 app.config 中，b) 我无法通过以下方式轻松控制服务启动/停止/重新启动和 c) 我不知道 Windows 用户的凭据是否与我在服务 MMC 管理单元中输入它时一样安全。

你有什么意见？拥有空闲服务是否可能并且很好，或者您会推荐任务调度程序吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T23:34:37.223

你可能会觉得这个[视频](http://channel9.msdn.com/shows/Going+Deep/Chittur-Subbaraman-Inside-Windows-7-Service-Controller-and-Background-Processing/ "服务控制器")很有趣。对负责 Windows 服务的工程师进行了很好的采访，还谈到了何时选择服务或任务。简而言之，如果您的功能属于定期维护类别，请执行一项任务。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T23:10:32.733

我自己更喜欢任务计划程序，因为如果需要，它更容易维护和更改计划。

此外，如果开发人员“忘记”执行诸如关闭连接、文件等可能会随着时间的推移而累积的事情，那么连续运行和“休眠”的实用程序就有可能导致问题。让程序“运行并退出”是一个额外的安全毯。:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T23:07:13.567

Windows 服务更安全：没有人可以放弃它并且永远有效。我发现 Windows 任务有很多问题（不执行，...）。

Windows 任务计划程序用于最终用户任务而不是应用程序任务。无论如何，Windows 备份使用它;-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T23:14:39.230

如果您选择服务路线，那么我建议您使用 System.Threading.Timer。有了它，您可以将其设置为每小时触发一次事件。如果您认为需要更改间隔，可以将间隔放在 app.config 中。

服务也在本地系统帐户下运行（默认情况下），而在使用计划任务时您必须提供用户名/密码。如果您使用您的用户名，如果您更改密码并忘记更新任务，则会成为维护问题。

我有一种情况，我实际上将两者结合使用。该服务在白天持续运行，但他们每晚都会进行网络和数据库维护。所以，我使用了两个计划任务。一个在午夜关闭服务，一个在凌晨 4 点重新打开。这是通过使用 NET STOP/NET START 命令调用 .BAT 文件来完成的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-09T04:54:03.140

我认为 Windows 服务可能更可靠且更易于监控，但它不会提供与开箱即用的计划任务相同的调度灵活性。无论如何，我可能会使用该服务，因为大多数企业应用程序倾向于作为服务运行，而不是计划任务。

对于最近的项目，我使用[Quartz.NET](http://quartznet.sourceforge.net/)在 Windows 服务中设置计划处理。实际上设置起来并不难（很好的教程），而且 CronTrigger 只需一点点配置就可以为您提供很大的灵活性。我比原始的 .NET 计时器更喜欢它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-25T22:48:44.710

我想投入我的 5 美分，当您的任务未运行时，使用任务调度程序将节省一些内存。

# performance - 有人对 DataTable.Load(DataReader) 方法有任何意见吗？

> ID：481769
> 
> 赞同：1
> 
> 时间：2009-01-26T23:08:21.050
> 
> 标签：performance, ado.net

有人对这种方法有任何想法吗？我已经对其进行了一些性能测试，它的性能似乎比简单地调用 dataadapter.fill 或只是循环通过 datareader 并为表创建新行更差。人们是否在生产中使用它，或者这只是微软给我们的另一个我们不使用的东西？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T23:28:34.397

我在生产代码中使用它，因为它从来没有真正看到过糟糕的性能。

在反射器中，它们看起来都使用了 adapter.FillFromReader 方法，所以我想知道为什么会有性能差异。我看不出有什么区别，猜猜一个是多线程的。

# c# - Linq to SQl，从多个表中选择同一列

> ID：481772
> 
> 赞同：2
> 
> 时间：2009-01-26T23:09:29.177
> 
> 标签：c#, .net, linq, linq-to-sql

我一直在尝试开发一个 linq 查询，它返回数据库中所有表的 ItemNumber 列，但到目前为止我还没有成功。

基本上我对计算机中的每种硬件组件都有一个表，每个表都有一个 ItemNumber 列。我需要一次查询所有表，并在平面列表/数组中返回 ItemNumber 值。（基本上我希望能够做到以下）

```
foreach (var c in items) {
                Console.WriteLine(c.ItemNumber);
            } 
```

在网上搜索无济于事，有人可以告诉我如何做到这一点的例子吗？我对此的最佳尝试如下，但我对 Sql 的了解不足以完成此操作。

```
var items = from hc in dc.DataBoxPCHardwareCases
                         from hhd in dc.DataBoxPCHardwareHardDrives
                         from hkb in dc.DataBoxPCHardwareKeyboards
                         from hmm in dc.DataBoxPCHardwareMemories
                         from hmo in dc.DataBoxPCHardwareMonitors
                         from hmb in dc.DataBoxPCHardwareMotherboards
                         from hms in dc.DataBoxPCHardwareMouses
                         from hod in dc.DataBoxPCHardwareOpticalDrives
                         from hps in dc.DataBoxPCHardwarePowerSupplies
                         from hpc in dc.DataBoxPCHardwareProcessors
                         from hsp in dc.DataBoxPCHardwareSpeakers
                         from hvc in dc.DataBoxPCHardwareVideoCards
                         from sos in dc.DataBoxPCSoftwareOperatingSystems
                         select new { hc, hhd, hkb, hmm, hmo, hmb, hms, hod, hps, hpc, hsp, hvc, sos }; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T23:17:52.983

你所描述的是一个工会：

从 tbl1 中选择项目编号并从 tbl2 中选择项目编号

在 LINQ 中：

```
var itemCounts = (from hhd in dc.HHD select hhd.ItemNumber)
                 .Union((from hkb in dc.HKB select hkb.ItemNumber)
                         .Union(from hmm in dc.HMM select hmm.ItemNumber)) 
                 and so on 
```

请注意，像这样使用 UNION 并不是非常有效。您在数据库的一次往返中获取整个数据集，但数据库服务器必须为每个 UNION 执行单独的查询，因此如果您计划对大量数据执行复杂操作，您最好重新考虑你的数据库设计。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-27T14:47:52.387

不要使用 Union - 而是使用[Concat](http://msdn.microsoft.com/en-us/library/bb351755.aspx)！

*   LinqToSql 的*Union*映射到 T-Sql 的*Union*。
*   LinqToSql 的**Concat**映射到 T-Sql 的**Union All**。

不同之处在于*Union*要求列表相互检查并删除重复项。这种检查会花费时间，而且我希望您的零件编号是全球唯一的（仅出现在单个列表中）。 **Union All**跳过了这个额外的检查和重复删除。

```
List<string> itemNumbers =
  dc.DataBoxPCHardwareCases.Select(hc => hc.ItemNumber)
  .Concat(dc.DataBoxPCHardwareHardDrives.Select( hkd => hkd.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareKeyboards.Select( hkb => hkb.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareMemories.Select( hhh => hhh.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareMonitors.Select( hmo => hmo.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareMotherboards.Select( hmb => hmb.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareMouses.Select( hms => hms.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareOpticalDrives.Select( hod => hod.ItemNumber ))
  .Concat(dc.DataBoxPCHardwarePowerSupplies.Select( hps => hps.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareProcessors.Select( hpc => hpc.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareSpeakers.Select( hsp => hsp.ItemNumber ))
  .Concat(dc.DataBoxPCHardwareVideoCards.Select( hvc => hvc.ItemNumber ))
  .Concat(dc.DataBoxPCSoftwareOperatingSystems.Select( sos => sos.ItemNumber ))
  .ToList(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T23:20:33.850

联盟见[这里](http://msdn.microsoft.com/en-us/library/bb386993.aspx)

```
var items = (from hc in dc.DataBoxPCHardwareCases select hc.ItemNumber).Union
            (from hhd in dc.DataBoxPCHardwareHardDrives select hkd.ItemNumber).Union
            (from hkb in dc.DataBoxPCHardwareKeyboards select hkb.ItemNumber).Union
            (from hmm in dc.DataBoxPCHardwareMemories select hhh.ItemNumber).Union
            (from hmo in dc.DataBoxPCHardwareMonitors select hmo.ItemNumber).Union
            (from hmb in dc.DataBoxPCHardwareMotherboards select hmb.ItemNumber).Union
            (from hms in dc.DataBoxPCHardwareMouses select hms.ItemNumber).Union
            (from hod in dc.DataBoxPCHardwareOpticalDrives select hod.ItemNumber).Union
            (from hps in dc.DataBoxPCHardwarePowerSupplies select hps.ItemNumber).Union
            (from hpc in dc.DataBoxPCHardwareProcessors select hpc.ItemNumber).Union
            (from hsp in dc.DataBoxPCHardwareSpeakers select hsp.ItemNumber).Union
            (from hvc in dc.DataBoxPCHardwareVideoCards select hvc.ItemNumber).Union
            (from sos in dc.DataBoxPCSoftwareOperatingSystems select sos.ItemNumber) 
```

# cocoa - 如何使用 Interface Builder 在可可中添加文件选择器/打开器？

> ID：481780
> 
> 赞同：12
> 
> 时间：2009-01-26T23:11:50.530
> 
> 标签：cocoa, macos, interface-builder

我想知道如何使 Interface Builder 中的按钮或输入字段以这样的方式做出反应，即单击它会打开一个文件对话框并让您选择一个或多个文件并将它们放入指定的数组/表中......

一旦按下按钮并选择文件（这似乎是一件非常微不足道的事情），我想它已经包含某种数组（比如带有所选文件路径的数组）所以我已经涵盖了......我只需要知道如何将按钮链接到文件选择器以及文件选择器以何种方式将文件传递给我（或文件的路径），以便我可以将它们重定向到数组

有没有一种简单的方法可以做到这一点，更重要的是；是否有文件选择器或者我必须使用 XCode 而不是 Interface builder 来执行此操作？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-26T23:33:54.137

这必须在 Xcode 中完成。[这里](http://ekle.us/index.php/2006/12/displaying_a_file_open_dialog_in_cocoa_w)的代码应该可以正常工作。

只需将按钮与使用 IB 的方法挂钩，并使用该示例作为在方法中放入内容的指南。

[Cocoadev 的 WRT NSOpenPanel](http://www.cocoadev.com/index.pl?NSOpenPanel)也有各种很好的帮助，包括将面板作为工作表而不是模式窗口打开的提示。

当然，您也应该始终阅读[Apple 文档](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSOpenPanel_Class/Reference/Reference.html)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-02-21T09:41:55.947

我在查找时发现了这个页面，如何在 Cocoa 中打开文件打开框。随着 OS X 10.7 的发布，许多链接到的示例现已弃用。因此，[这里有一些示例代码](https://web.archive.org/web/20130729123837/http://cyborgdino.com:80/2012/02/nsopenpanel-displaying-a-file-open-dialog-in-os-x-10-7/)可以为您节省一些编译器警告：

```
// -----------------
// NSOpenPanel: Displaying a File Open Dialog in OS X 10.7
// -----------------

// Any ole method
- (void)someMethod {
  // Create a File Open Dialog class.
  NSOpenPanel *openDlg = [NSOpenPanel openPanel];

  // Set array of file types 
  NSArray<NSString*> *fileTypesArray = @[@"jpg", @"gif", @"png"];

  // Enable options in the dialog.
  [openDlg setCanChooseFiles:YES];    
  [openDlg setAllowedFileTypes:fileTypesArray];
  [openDlg setAllowsMultipleSelection:YES];

  // Display the dialog box.  If OK is pressed, process the files.
  if ([openDlg runModal] == NSModalResponseOK) {
    // Get list of all files selected
    NSArray<NSURL*> *files = [openDlg URLs];

    // Loop through the files and process them.
    for (NSURL *file in files) {
      // Do something with the filename.
      NSLog(@"File path: %@", [file path]);
    }
  }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-26T23:17:36.367

Interface Builder 用于设计和链接界面。你想打开文件并将它们放在一个数组中，这在 Xcode 方面是安全的。让按钮的操作显示 NSOpenPanel 并将结果提供给表的数据源。

# mysql - 在mysql中维护/更新记录顺序

> ID：481789
> 
> 赞同：2
> 
> 时间：2009-01-26T23:16:10.817
> 
> 标签：mysql, sorting, sql-update

我在 mySql 中有一个记录表。我需要维护用户指定的订单。所以我添加了一个“位置”列。

当我移动特定记录时，更新所有记录的 SQL 语句是什么？我有类似的东西：

```
UPDATE items SET position = '2' WHERE id ='4';
UPDATE items SET position = position+1 WHERE position >= '2' AND id != '4'; 
```

但是，如果记录下降，大于将是小于。有什么诀窍？谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T23:35:36.800

这样的事情会做吗？

```
UPDATE items 
SET position = CASE position 
  WHEN $oldpos THEN $newpos 
  ELSE position + SIGN($oldpos-$newpos)
 END
WHERE position BETWEEN LEAST( $newpos, $oldpos ) 
                AND GREATEST( $newpos, $oldpos ); 
```

我测试了几次，它似乎工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T23:22:26.407

对例如由用户维护行号的销售​​订单执行此类操作，我发现最好在 BL 或 UI 中的数组中处理它。通常他们会想调整几条记录，有时想说“算了”。因此，最简单的方法可能是等到他们点击“确定”按钮（或您的等效按钮），然后按照当前顺序将它们全部写回。

您最终也可能会处理删除问题，这是您可以以相同方式处理的另一个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-28T10:29:57.733

这是我对此的看法：我的 row_index 列的编号为 10（例如：0、10、20、ecc）。当用户更新某一行时，您需要知道它是上升还是下降。如果您必须将第 2 行移动到第 4 行（向下，所需的 row_index = 30），则将 row_index 设置为 35；否则（如果上升）将其设置为 25。设置此值：

```
UPDATE your_table SET row_index = 35 WHERE your_id = 1234 
```

现在你有了正确的顺序，但是 row_indexes 搞砸了。要解决此问题，请执行以下两个查询：

```
SET @pos:=-10;
UPDATE your_table SET row_index = @pos:=@pos+10 WHERE ... 
```

这将更新您的所有行（或您使用 where 语句选择的行）并设置 row_index 列没有间隙（0、10、20、30，ecc.）。当然，这种方式会增加写入操作的负载，但我认为这是在读取操作期间获取订单的最快方式。如果您删除一行，您可以重新运行修复订单查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T23:27:04.850

我建议至少在项目之间使用较大的增量（例如 10000）。然后只是做一个订单。如果您需要将 11000 移动到 9000 和 10000 之间，那么只需将其设置为 9500 即可。

这并没有消除重新排序的问题，但它大大减少了它。在某些时候，您最好删除所有行，然后以正确的顺序读取它们。像您一样进行更新太容易出错恕我直言。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T23:29:56.937

您可能会考虑使用链表类型的方法，用一个键指向下一个，也可能是列表中的上一个项目，然后您只需更新几条记录，而不是全部更新。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T23:32:26.383

有趣的！好的，所以没有简单的答案。我以为我只是错过了一些东西。我考虑过维护一个外部数组。这听起来像是最好的主意。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-25T13:45:35.220

也许是这样的？

```
$item_id = $_GET['item_id']; 
$position = $_GET['new_position']; 
$old_position = $_GET['old_position'];

if($new_position < $old_position) {
    SQL: UPDATE items SET position = position+1 WHERE position >= $new_position AND position < $old_position  
} else {  
SQL: UPDATE items SET position = position-1 WHERE position <= $new_position AND position > $old_position
}  

SQL: UPDATE items SET position = $new_position WHERE item_id = $item_id 
```

# java - 帮助注释

> ID：481802
> 
> 赞同：4
> 
> 时间：2009-01-26T23:20:56.830
> 
> 标签：java, user-interface, swing, reflection, annotations

编辑——@Uri 正确指出这是对注解的滥用；试图在注释中实际创建菜单数据本身是愚蠢的。

但是它们很适合绑定，我想我会坚持使用它们将文本数据链接到方法（@Menu ("File") 部分），因为它比反映到方法名称更明确和灵活。我也学到了很多东西。几天后我会在这里发布代码作为答案。

——原帖——

我没有使用这些新奇的注释，但它们看起来非常有趣。我在弄清楚语法时遇到了麻烦（或者更恰当地说，是使用它的最佳方式）。

在编写一些代码来回答这个[问题](https://stackoverflow.com/questions/473540/correct-way-to-use-actions-to-create-menus-toolbars-and-other-components-in-jav#473879)时我突然想到我的方法已经过时了。

我曾经解析一个字符串来定义我的方法结构，然后使用反射将其传递给类，但我认为注释可以使菜单结构更好。

我想用以下内容替换文件中的测试类：

```
@TopMenu("File,Edit")
@Menu(name="File","Save,Load,Print,Preview,Quit")
@Menu(name="Print","Preview,Print")
@Menu(name="Edit","Copy,Paste")

public class TestMenu {
    @MenuItem ("Save")
    public void save() {
        System.out.println("saved");
    }
    @MenuItem ("Load")
    public void load() {
    System.out.println("loaded");
    }
... 
```

并将整个类传递给一个方法，该方法制造并返回一个绑定到类实例的 JMenuBar，而无需进一步输入。

第一个问题是我不知道如何传递字符串的“默认”，他们都想要（attribute =“value”）而不是（“value”），这可以做到吗？我可以没有它，但它有点冗长。如果我能去掉括号和/或引号会更好，但我不会屏住呼吸（我认为这样做我必须为每个菜单项定义一个单独的界面，这是不可接受的）。

其次，它不喜欢单个类上的多个 @Menu 标签。我可以通过解析一个字符串来解决这个问题，但我想知道是否还有其他方法。

最重要的是，是否有一个图书馆已经这样做了？（如果没有人想出一个，我会在它工作时将代码发布到这个线程，以防其他人感兴趣。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T23:52:40.103

我知道我会因此而被否决，但我真的认为人们开始过度滥用 Java 中的注释机制。

它的设计目的只是作为一种机制，为编译器或编程支持工具（例如，测试基础设施、模型检查器、代码生成器等）提供有关类和方法的元信息。

它不适用于实际的面向生产的代码、宏元编程等等。这与在 C 中使用预处理器宏而不是实际函数一样不雅。

如果菜单是您程序中的一流实体，我真的不认为您应该为它们使用注释机制。

至于您的具体问题，您可以轻松定义默认值。但是，您不能开始执行嵌套注释之类的操作来克服菜单问题。它真的不是为此而设计的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T00:17:30.193

我看到附加的多个注释的方式是使用容器注释，然后将项目指定为数组。

```
@Retention(RetentionPolicy.RUNTIME)
public @interface Menu {
    String name();
    String[] children();
}

@Retention(RetentionPolicy.RUNTIME)
public @interface MenuBar {
    Menu[] value();
}

@Retention(RetentionPolicy.RUNTIME)
public @interface MenuItem {
    String value();
}

@MenuBar(
    {
        @Menu(name="File", children= {"Save","Load","Print","Preview","Quit"}),
        @Menu(name="Print", children= {"Preview","Print"}),
        @Menu(name="Edit", children= {"Copy","Paste"})
    }
)
public class TestMenu {
    @MenuItem ("Save")
    public void save() {
        System.out.println("saved");
    }

    @MenuItem ("Load")
    public void load() {
        System.out.println("loaded");
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T23:29:48.747

*   您可以为注释定义默认值 - 这是示例`String str() default "text";`
*   你不能轻易克服这一点。您可以定义`Menus`接受字符串数组的注释

# c# - 将一些 LISP 转换为 C#

> ID：481803
> 
> 赞同：4
> 
> 时间：2009-01-26T23:21:38.357
> 
> 标签：c#, lisp

我正在阅读[Paul Graham 的垃圾邮件计划](http://www.paulgraham.com/spam.html)并想更好地理解它，但我的 LISP 真的很生疏。他有一段代码可以计算概率：

```
(let ((g (* 2 (or (gethash word good) 0)))
      (b (or (gethash word bad) 0)))
   (unless (< (+ g b) 5)
     (max .01
          (min .99 (float (/ (min 1 (/ b nbad))
                             (+ (min 1 (/ g ngood))   
                                (min 1 (/ b nbad))))))))) 
```

我的问题是双重的：（1）是否有将 LISP 转换为不同语言的网络资源？（我的偏好是基于 C 的语言）或失败（2）有人可以为我重写 C# 中的代码片段吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-26T23:44:49.683

我认为它是这样的（警告，前面可能出现错误。此代码段旨在作为指导，而不是解决方案）：

```
var g = 2 * (gethash(word, good) | 0);
var b = gethash(word, bad) | 0;

if( (g + b) >= 5)
{
    return Math.Max( 
        0.01, 
        Math.Min(0.99, 
            Math.Min(1, b / nbad) / 
            (Math.Min(1, g / ngood) + Math.Min(1, b / nbad))));
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-28T18:22:54.840

加上[Gonzola 的回答](https://stackoverflow.com/questions/481803/converting-some-lisp-to-c#481858)，不要忘记 Lisp 提供了无限精度整数和有理数，而 C# 喜欢截断。您需要先将 'nbad' 和 'ngood' 转换为浮动，以获得可比较（尽管不相同）的结果。

您可能还希望将整个转换后的程序放在选中区域中。C# 甚至不会警告 fixnum 溢出——第一个近似值是将溢出视为内存受限（在 Lisp 中，如果溢出产生的数字太大而无法容纳剩余的内存，类似的行为结果）。

```
checked {
    var fbad = (double)nbad;
    var fgood = (double)ngood;
    var g = 2 * (gethash(word, good) | 0);
    var b = gethash(word, bad) | 0;

    if( (g + b) >= 5)
    {
        return Math.Max( 
            0.01, 
            Math.Min(0.99, 
                    Math.Min(1, b / fbad) / 
                    (Math.Min(1, g / fgood) + Math.Min(1, b / fbad))));
    }
} 
```

# java - 如何为不同的 ant 任务提供自定义 log4j.xml？

> ID：481808
> 
> 赞同：6
> 
> 时间：2009-01-26T23:23:19.010
> 
> 标签：java, ant, log4j, taskdef

我有一个构建文件，作为构建过程的一部分，它依赖于几个 taskdef。这些 taskdef 项（例如，webdoclet 和 jasper2）使用 log4j 作为记录器。理想情况下，我希望能够为每个提供不同的 log4j 配置文件，但至少，我希望能够指定使用哪个 log4j 配置文件。

我过去所做的是将包含我希望 taskdef 使用的 log4j.xml 的目录放在类路径的前面。例如：

```
<目标名称="define.jasper2">
  <path id="jspc.classpath">
      <!-- 把这个放在第一位，这样 Jasper 就会在 Build 目录中找到 log4j.xml -->
      <pathelement location="构建"/>
      <fileset dir="${tomcat.libs}">
             ……
      </文件集>
      <pathelement location="${log4j.jar}"/>
      ……
  </路径>

  <taskdef name="jasper2" classname="org.apache.jasper.JspC" classpathref="jspc.classpath"/>
</目标>

```

我已经验证，事实上，“Build”目录位于类路径的前面，并且该目录中存在 log4j.xml。但是，当我在调试中使用 log4j 以详细模式运行 ant 时，我看到 log4j 正在选择*当前工作目录*中的 log4j.xml ，这不是我想要的。Log4j 似乎没有使用类路径来解析默认的 log4j.xml。

我正在使用 log4j 1.2.8（嵌入在更大的框架中，所以我无法升级它）并且其中一些任务定义似乎依赖于 commons-logging 1.0.3。构建过程使用 Sun Java 5。

如果我`set ANT_OPTS=-Dlog4j.configuration=Build/log4j.xml`在运行 ant 之前，taskdefs 会正确加载所需的 log4j.xml。

将“Bu​​ild”目录放在用于工作的 taskdef 的类路径的前面。我不知道发生了什么变化。如何恢复我可以控制的行为——在 build.xml 中——哪个 log4j 配置文件用于给定任务？除了设置 ANT_OPTS 和重新排列文件以将应用程序的 log4j.xml 移出当前工作目录以使 log4j 找到正确的 log4j.xml 文件之外，还有其他方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-10T20:32:50.963

我可以使用相对文件 URL 指定配置文件，`sysproperty`如下所示：

```
<java classname="com.lunatech.MainClass">
   <sysproperty key="log4j.configuration" value="file:src/log4j-debug.properties"/>
   <classpath refid="runtime.classpath"/>
</java> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T23:42:13.463

Log4j 通过查找系统属性 log4j.configuration 来加载其配置。否则，它会在类路径中查找 log4j.properties 或 log4j.xml。

在一些 fork 新 JVM 的 ant 任务上，您可以使用 <jvmarg/> 标记指定 log4j.configuration 系统属性。然而，对于那些你最好的选择是创建一个类路径条目，其第一个条目是你想要使用的 log4j 配置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T21:21:53.270

> 如果我在运行 ant 之前设置 ANT_OPTS=-Dlog4j.configuration=Build/log4j.xml，taskdefs 会正确加载所需的 log4j.xml。

您是否尝试过使用 sysproperty 设置此属性？

应该看起来像这样：

```
<target name="define.jasper2">
   <sysproperty key="log4j.configuration" value="Build/log4j.xml"/>
   ...
</target> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T23:37:48.217

您可以移动当前工作目录中的 log4j.xml 文件吗？

# java - 如何简化 null 安全的 compareTo() 实现？

> ID：481813
> 
> 赞同：183
> 
> 时间：2009-01-26T23:25:14.573
> 
> 标签：java, refactoring, comparison, null, compareto

我正在`compareTo()`为这样的简单类实现方法（以便能够使用`Collections.sort()`Java 平台提供的其他好东西）：

```
public class Metadata implements Comparable<Metadata> {
    private String name;
    private String value;

// Imagine basic constructor and accessors here
// Irrelevant parts omitted
} 
```

我希望这些对象的*自然排序*是：1）按名称排序，2）如果名称相同，则按值排序；两种比较都应该不区分大小写。对于这两个字段，空值是完全可以接受的，因此`compareTo`在这些情况下不能中断。

想到的解决方案如下（我在这里使用“保护条款”，而其他人可能更喜欢单个返回点，但这不是重点）：

```
// primarily by name, secondarily by value; null-safe; case-insensitive
public int compareTo(Metadata other) {
    if (this.name == null && other.name != null){
        return -1;
    }
    else if (this.name != null && other.name == null){
        return 1;
    }
    else if (this.name != null && other.name != null) {
        int result = this.name.compareToIgnoreCase(other.name);
        if (result != 0){
            return result;
        }
    }

    if (this.value == null) {
        return other.value == null ? 0 : -1;
    }
    if (other.value == null){
        return 1;
    }

    return this.value.compareToIgnoreCase(other.value);
} 
```

这可以完成工作，但我对这段代码并不完全满意。诚然，它不是*很*复杂，但相当冗长乏味。

问题是，**您将如何减少冗长**（同时保留功能）？如果有帮助，请随意参考 Java 标准库或 Apache Commons。使这（一点）更简单的唯一选择是实现我自己的“NullSafeStringComparator”，并将其应用于比较两个字段吗？

**编辑 1-3**： Eddie 是对的；修复了上面的“两个名字都为空”的情况

## 关于接受的答案

我在 2009 年问过这个问题，当然是在 Java 1.6 上，当时**[Eddie 的纯 JDK 解决方案](https://stackoverflow.com/a/481836/56285)**是我首选的公认答案。直到现在（2017 年），我才开始改变它。

还有[第 3 方库解决方案](https://stackoverflow.com/a/500643/56285)——一个 2009 Apache Commons Collections 一个和一个 2013 Guava 一个，都是我发布的——我在某个时间点确实更喜欢它们。

**[我现在将Lukasz Wiktor](https://stackoverflow.com/a/23908426/56285)**的干净Java 8 解决方案作为公认的答案。如果在 Java 8 上，这绝对应该是首选，而如今几乎所有项目都应该使用 Java 8。

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2012-04-05T09:29:22.743

您可以简单地使用[Apache Commons Lang](http://commons.apache.org/proper/commons-lang/javadocs/api-release/org/apache/commons/lang3/ObjectUtils.html#compare(T,%20T))：

```
result = ObjectUtils.compare(firstComparable, secondComparable) 
```

* * *

## 回答 #2

> 赞同：209
> 
> 时间：2014-05-28T09:57:35.027

使用**Java 8**：

```
private static Comparator<String> nullSafeStringComparator = Comparator
        .nullsFirst(String::compareToIgnoreCase); 

private static Comparator<Metadata> metadataComparator = Comparator
        .comparing(Metadata::getName, nullSafeStringComparator)
        .thenComparing(Metadata::getValue, nullSafeStringComparator);

public int compareTo(Metadata that) {
    return metadataComparator.compare(this, that);
} 
```

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2009-01-26T23:35:34.430

我会实现一个空安全比较器。那里可能有一个实现，但这实现起来非常简单，我总是自己动手。

注意：上面的比较器，如果*两个*名称都为空，则甚至不会比较值字段。我不认为这是你想要的。

我将通过以下方式实现这一点：

```
// primarily by name, secondarily by value; null-safe; case-insensitive
public int compareTo(final Metadata other) {

    if (other == null) {
        throw new NullPointerException();
    }

    int result = nullSafeStringComparator(this.name, other.name);
    if (result != 0) {
        return result;
    }

    return nullSafeStringComparator(this.value, other.value);
}

public static int nullSafeStringComparator(final String one, final String two) {
    if (one == null ^ two == null) {
        return (one == null) ? -1 : 1;
    }

    if (one == null && two == null) {
        return 0;
    }

    return one.compareToIgnoreCase(two);
} 
```

编辑：修复了代码示例中的拼写错误。这就是我没有先测试它的结果！

编辑：将 nullSafeStringComparator 提升为静态。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-02-01T11:35:40.940

有关使用 Guava 的更新（2013）解决方案，请参阅此答案的底部。

* * *

这就是我最终选择的。事实证明，我们已经有了一个用于 null 安全字符串比较的实用方法，所以最简单的解决方案就是利用它。（这是一个很大的代码库；很容易错过这种事情 :)

```
public int compareTo(Metadata other) {
    int result = StringUtils.compare(this.getName(), other.getName(), true);
    if (result != 0) {
        return result;
    }
    return StringUtils.compare(this.getValue(), other.getValue(), true);
} 
```

这是帮助器的定义方式（它被重载，因此您还可以定义空值是第一个还是最后一个，如果需要）：

```
public static int compare(String s1, String s2, boolean ignoreCase) { ... } 
```

[因此，这与Eddie 的答案](https://stackoverflow.com/questions/481813/how-to-simplify-a-null-safe-compareto-implementation/481836#481836)基本相同（尽管我不会将静态辅助方法称为*比较器*）以及[uzhin 的答案](https://stackoverflow.com/questions/481813/how-to-simplify-a-null-safe-compareto-implementation/481844#481844)。

无论如何，总的来说，我会强烈支持[Patrick 的解决方案](https://stackoverflow.com/questions/481813/how-to-simplify-a-null-safe-compareto-implementation/481893#481893)，因为我认为尽可能使用已建立的库是一个好习惯。（正如 Josh Bloch 所说*，了解并使用这些库*。）但在这种情况下，这不会产生最干净、最简单的代码。

## 编辑（2009）：Apache Commons Collections 版本

实际上，这是一种使基于 Apache Commons 的解决方案[`NullComparator`](http://commons.apache.org/proper/commons-collections/apidocs/org/apache/commons/collections4/comparators/NullComparator.html)更简单的方法。将它与类中提供[的不区分大小写`Comparator`](http://java.sun.com/javase/6/docs/api/java/lang/String.html#CASE_INSENSITIVE_ORDER)结合起来`String`：

```
public static final Comparator<String> NULL_SAFE_COMPARATOR 
    = new NullComparator(String.CASE_INSENSITIVE_ORDER);

@Override
public int compareTo(Metadata other) {
    int result = NULL_SAFE_COMPARATOR.compare(this.name, other.name);
    if (result != 0) {
        return result;
    }
    return NULL_SAFE_COMPARATOR.compare(this.value, other.value);
} 
```

现在这很优雅，我想。（只剩下一个小问题：Commons`NullComparator`不支持泛型，因此存在未经检查的分配。）

## 更新（2013）：番石榴版

将近 5 年后，这就是我如何解决我最初的问题。如果用 Java 编码，我（当然）会使用[**Guava**](https://code.google.com/p/guava-libraries/)。（而且肯定*不是*Apache Commons。）

将此常量放在某处，例如在“StringUtils”类中：

```
public static final Ordering<String> CASE_INSENSITIVE_NULL_SAFE_ORDER =
    Ordering.from(String.CASE_INSENSITIVE_ORDER).nullsLast(); // or nullsFirst() 
```

然后，在`public class Metadata implements Comparable<Metadata>`：

```
@Override
public int compareTo(Metadata other) {
    int result = CASE_INSENSITIVE_NULL_SAFE_ORDER.compare(this.name, other.name);
    if (result != 0) {
        return result;
    }
    return CASE_INSENSITIVE_NULL_SAFE_ORDER.compare(this.value, other.value);
} 
```

当然，这与 Apache Commons 版本几乎相同（两者都使用 JDK 的[CASE_INSENSITIVE_ORDER](http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#CASE_INSENSITIVE_ORDER)），使用的`nullsLast()`是唯一特定于 Guava 的东西。这个版本更可取，因为作为依赖项，Guava 比 Commons Collections 更可取。（[每个人都同意](https://stackoverflow.com/questions/1444437/apache-commons-vs-guava-formerly-google-collections)。）

如果您想知道[`Ordering`](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/Ordering.html)，请注意它实现了`Comparator`. 它非常方便，特别是对于更复杂的排序需求，例如允许您使用`compound()`. 阅读[*订购说明*](https://code.google.com/p/guava-libraries/wiki/OrderingExplained)了解更多信息！

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-01-27T00:04:44.137

我总是推荐使用 Apache commons，因为它很可能比你自己编写的要好。另外，你可以做“真正的”工作，而不是重新发明。

您感兴趣的类是[Null Comparator](http://commons.apache.org/collections/api-release/org/apache/commons/collections/comparators/NullComparator.html "空比较器")。它允许您将空值设置为高或低。当两个值不为空时，您还可以给它自己的比较器以供使用。

在您的情况下，您可以有一个静态成员变量来进行比较，然后您的`compareTo`方法只是引用它。

类似的东西

```
class Metadata implements Comparable<Metadata> {
private String name;
private String value;

static NullComparator nullAndCaseInsensitveComparator = new NullComparator(
        new Comparator<String>() {

            @Override
            public int compare(String o1, String o2) {
                // inputs can't be null
                return o1.compareToIgnoreCase(o2);
            }

        });

@Override
public int compareTo(Metadata other) {
    if (other == null) {
        return 1;
    }
    int res = nullAndCaseInsensitveComparator.compare(name, other.name);
    if (res != 0)
        return res;

    return nullAndCaseInsensitveComparator.compare(value, other.value);
} 
```

}

即使你决定自己动手，也要记住这个类，因为它在对包含空元素的列表进行排序时非常有用。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-07-24T06:19:49.437

我知道它可能不能直接回答您的问题，因为您说必须支持空值。

但我只想指出，在 compareTo 中支持 null 不符合 Comparable 官方[javadocs 中](http://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html#compareTo-T-)描述的 compareTo 合同：

> 请注意，null 不是任何类的实例，即使 e.equals(null) 返回 false，e.compareTo(null) 也应该抛出 NullPointerException。

因此，我要么明确抛出 NullPointerException，要么在取消引用 null 参数时第一次抛出它。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-26T23:38:38.773

您可以提取方法：

```
public int cmp(String txt, String otherTxt)
{
    if ( txt == null )
        return otherTxt == null ? 0 : 1;

    if ( otherTxt == null )
          return 1;

    return txt.compareToIgnoreCase(otherTxt);
}

public int compareTo(Metadata other) {
   int result = cmp( name, other.name); 
   if ( result != 0 )  return result;
   return cmp( value, other.value); 
```

}

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-26T23:30:51.630

您可以将您的类设计为不可变的（Effective Java 2nd Ed. 对此有一个很好的部分，第 15 条：最小化可变性）并确保在构造时不可能有空值（并在需要时使用[空对象模式](http://en.wikipedia.org/wiki/Null_Object_pattern)）。然后您可以跳过所有这些检查并安全地假设这些值不为空。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-02-13T16:48:06.353

```
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.Comparator;

public class TestClass {

    public static void main(String[] args) {

        Student s1 = new Student("1","Nikhil");
        Student s2 = new Student("1","*");
        Student s3 = new Student("1",null);
        Student s11 = new Student("2","Nikhil");
        Student s12 = new Student("2","*");
        Student s13 = new Student("2",null);
        List<Student> list = new ArrayList<Student>();
        list.add(s1);
        list.add(s2);
        list.add(s3);
        list.add(s11);
        list.add(s12);
        list.add(s13);

        list.sort(Comparator.comparing(Student::getName,Comparator.nullsLast(Comparator.naturalOrder())));

        for (Iterator iterator = list.iterator(); iterator.hasNext();) {
            Student student = (Student) iterator.next();
            System.out.println(student);
        }

    }

} 
```

输出是

```
Student [name=*, id=1]
Student [name=*, id=2]
Student [name=Nikhil, id=1]
Student [name=Nikhil, id=2]
Student [name=null, id=1]
Student [name=null, id=2] 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-10-07T16:38:53.273

我正在寻找类似的东西，这似乎有点复杂，所以我这样做了。我认为这更容易理解。您可以将其用作比较器或单衬里。对于这个问题，您将更改为 compareToIgnoreCase()。原样，空值浮动。如果你想让它们下沉，你可以翻转 1、-1。

```
StringUtil.NULL_SAFE_COMPARATOR.compare(getName(), o.getName()); 
```

.

```
public class StringUtil {
    public static final Comparator<String> NULL_SAFE_COMPARATOR = new Comparator<String>() {

        @Override
        public int compare(final String s1, final String s2) {
            if (s1 == s2) {
                //Nulls or exact equality
                return 0;
            } else if (s1 == null) {
                //s1 null and s2 not null, so s1 less
                return -1;
            } else if (s2 == null) {
                //s2 null and s1 not null, so s1 greater
                return 1;
            } else {
                return s1.compareTo(s2);
            }
        }
    }; 

    public static void main(String args[]) {
        final ArrayList<String> list = new ArrayList<String>(Arrays.asList(new String[]{"qad", "bad", "sad", null, "had"}));
        Collections.sort(list, NULL_SAFE_COMPARATOR);

        System.out.println(list);
    }
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-01-19T12:33:46.090

如果有人使用 Spring，还有一个类 org.springframework.util.comparator.NullSafeComparator 也可以为您执行此操作。像这样装饰你自己的与之媲美

`new NullSafeComparator<YourObject>(new YourComparable(), true)`

[https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/comparator/NullSafeComparator.html](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/comparator/NullSafeComparator.html)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-03-18T18:24:19.710

我们可以使用 java 8 在对象之间进行 null 友好的比较。假设我有一个带有 2 个字段的 Boy 类：字符串名称和整数年龄，我想先比较名称，然后如果两者相等，则比较年龄。

```
static void test2() {
    List<Boy> list = new ArrayList<>();
    list.add(new Boy("Peter", null));
    list.add(new Boy("Tom", 24));
    list.add(new Boy("Peter", 20));
    list.add(new Boy("Peter", 23));
    list.add(new Boy("Peter", 18));
    list.add(new Boy(null, 19));
    list.add(new Boy(null, 12));
    list.add(new Boy(null, 24));
    list.add(new Boy("Peter", null));
    list.add(new Boy(null, 21));
    list.add(new Boy("John", 30));

    List<Boy> list2 = list.stream()
            .sorted(comparing(Boy::getName, 
                        nullsLast(naturalOrder()))
                   .thenComparing(Boy::getAge, 
                        nullsLast(naturalOrder())))
            .collect(toList());
    list2.stream().forEach(System.out::println);

}

private static class Boy {
    private String name;
    private Integer age;
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public Integer getAge() {
        return age;
    }
    public void setAge(Integer age) {
        this.age = age;
    }
    public Boy(String name, Integer age) {
        this.name = name;
        this.age = age;
    }

    public String toString() {
        return "name: " + name + " age: " + age;
    }
} 
```

结果：

```
 name: John age: 30
    name: Peter age: 18
    name: Peter age: 20
    name: Peter age: 23
    name: Peter age: null
    name: Peter age: null
    name: Tom age: 24
    name: null age: 12
    name: null age: 19
    name: null age: 21
    name: null age: 24 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-07-12T02:40:55.637

对于您知道数据不会有空值（对于字符串总是一个好主意）并且数据非常大的特定情况，*如果您确定这是您的情况*，您仍然需要在实际比较值之前进行三个比较，你可以优化一点。YMMV 作为可读代码胜过次要优化：

```
 if(o1.name != null && o2.name != null){
            return o1.name.compareToIgnoreCase(o2.name);
        }
        // at least one is null
        return (o1.name == o2.name) ? 0 : (o1.name != null ? 1 : -1); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-03-08T19:00:48.247

[使用 NullSafe Comparator](https://zgrepcode.com/examples/spring-framework/org/springframework/util/comparator/nullsafecomparator-implementations)的一种简单方法是使用它的 Spring 实现，下面是一个简单的示例供参考：

```
public int compare(Object o1, Object o2) {
        ValidationMessage m1 = (ValidationMessage) o1;
        ValidationMessage m2 = (ValidationMessage) o2;
        int c;
        if (m1.getTimestamp() == m2.getTimestamp()) {
            c = NullSafeComparator.NULLS_HIGH.compare(m1.getProperty(), m2.getProperty());
            if (c == 0) {
                c = m1.getSeverity().compareTo(m2.getSeverity());
                if (c == 0) {
                    c = m1.getMessage().compareTo(m2.getMessage());
                }
            }
        }
        else {
            c = (m1.getTimestamp() > m2.getTimestamp()) ? -1 : 1;
        }
        return c;
    } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-08-11T15:39:24.760

另一个 Apache ObjectUtils 示例。能够对其他类型的对象进行排序。

```
@Override
public int compare(Object o1, Object o2) {
    String s1 = ObjectUtils.toString(o1);
    String s2 = ObjectUtils.toString(o2);
    return s1.toLowerCase().compareTo(s2.toLowerCase());
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-03-15T18:43:38.833

这是我用来对 ArrayList 进行排序的实现。空类被排序到最后。

就我而言，EntityPhone 扩展了 EntityAbstract，而我的容器是 List < EntityAbstract>。

“compareIfNull()”方法用于空安全排序。其他方法是为了完整性，展示如何使用 compareIfNull。

```
@Nullable
private static Integer compareIfNull(EntityPhone ep1, EntityPhone ep2) {

    if (ep1 == null || ep2 == null) {
        if (ep1 == ep2) {
            return 0;
        }
        return ep1 == null ? -1 : 1;
    }
    return null;
}

private static final Comparator<EntityAbstract> AbsComparatorByName = = new Comparator<EntityAbstract>() {
    @Override
    public int compare(EntityAbstract ea1, EntityAbstract ea2) {

    //sort type Phone first.
    EntityPhone ep1 = getEntityPhone(ea1);
    EntityPhone ep2 = getEntityPhone(ea2);

    //null compare
    Integer x = compareIfNull(ep1, ep2);
    if (x != null) return x;

    String name1 = ep1.getName().toUpperCase();
    String name2 = ep2.getName().toUpperCase();

    return name1.compareTo(name2);
}
}

private static EntityPhone getEntityPhone(EntityAbstract ea) { 
    return (ea != null && ea.getClass() == EntityPhone.class) ?
            (EntityPhone) ea : null;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-03-21T13:31:43.390

如果你想要一个简单的 Hack：

```
arrlist.sort((o1, o2) -> {
    if (o1.getName() == null) o1.setName("");
    if (o2.getName() == null) o2.setName("");

    return o1.getName().compareTo(o2.getName());
}) 
```

如果你想把空值放在列表的末尾，只需在上面的方法中更改它

```
return o2.getName().compareTo(o1.getName()); 
```

# silverlight - Silverlight 中最大的问题是什么？

> ID：481817
> 
> 赞同：19
> 
> 时间：2009-01-26T23:28:04.927
> 
> 标签：silverlight

我最近一直在 Silverlight 工作，我慢慢地发现，尽管开发很简单，但隐藏在阴影中的却是一两个恼人的陷阱。

考虑到其中一些对我来说是多么困难，我认为在 SO 上列出它们可能是有用的，以便其他人从中受益。我敢肯定，与其他人的经历相比，我遇到的那些都是微不足道的，我想尽量避免任何其他令人讨厌或耗时的惊喜。

那么，你有什么？

**更新**
我已经更新了这个以涵盖 Silverlight。因此，请在回复时提供与问题相关的版本或列表版本。对于所有没有版本的人，请假设 Silverlight 2.0，因为这是原始问题中的情况。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-26T23:33:38.940

我经历过的两个是：

### 跨域策略文件

为了让 Silverlight 与托管在不同域上的 Web 服务一起工作，服务器需要[一个跨域策略文件](http://timheuer.com/blog/archive/2008/04/06/silverlight-cross-domain-policy-file-snippet-intellisense.aspx)。这可以采用两种格式：

*   客户端访问策略.xml
*   跨域.xml

我无法让前者正常工作，但后者工作（Flash 使用第二个，而我相信第一个特定于 ASP，尽管我无法让它在 ASP.NET 2.0 服务器下工作，所以它可能是 3.5 -具体的）。

### 组合框下拉调整大小

Silverlight 2.0 组合框控件仅在首次显示时调整其下拉区域的大小。因此，它的大小基于其列表中的初始项目。这意味着 2 个项目将为您提供 2 个项目的高下拉列表，即使列表增加到 200。解决此问题的唯一方法似乎是每次项目更改时都用全新的控件替换组合。

请注意，将 Height 属性或 MaxHeight 属性设置为导致项目在下拉列表的初始显示中出现在列表之外的值将导致缺少垂直滚动条，因此无法访问列表中的项目。我发现的唯一解决方案是使用 MinHeight 属性至少具有适合所有用途的高度，如果项目超过该最小高度，则让它更大。

此外，当您调整浏览器窗口的大小时，无论您是否使用 MinHeight，然后下拉组合列表或在可见时调整大小，这都会不可逆转地减小下拉列表的大小。

*更新*

多亏了[markti ，](https://stackoverflow.com/users/79749/markti)[这是一个非常好的解决组合问题](https://stackoverflow.com/questions/799403/silverlight-combobox-number-of-items-shown-refresh)的方法。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-26T23:42:45.240

## 组合框怪异

[Jeff Yates 在他的回复中提到的](https://stackoverflow.com/questions/481817/what-are-the-biggest-gotchas-in-silverlight-2-0#481831)一件事是ComboBoxes 的奇怪之处——我亲眼目睹了这一点，而且我还看到了另一个非常非常恼人的问题。如果您尝试从按钮的 Click 事件的事件处理程序更改 ComboBox 中的项目，您将收到一条我目前无法想到的神秘错误消息。我的解决方案是做与 Jeff 的解决方案相同的事情 - 删除组合框，构建一个新组合框，用更改的项目集填充该组合框，然后将其添加回包含面板。

## 没有 ElementName 绑定

Silverlight 与 WPF 的 ElementName 绑定能力没有任何相似之处。[这篇文章](http://www.thejoyofcode.com/Workaround_for_missing_ElementName_in_Silverlight_2_0_Binding.aspx)有一个很好的解决方法，对我来说效果很好。

## 不支持鼠标滚轮事件

没有对捕获鼠标滚轮事件的本机支持。[这篇文章](http://www.silverlightshow.net/tips/Tip-How-to-capture-mouse-scroll-wheel-event-in-Silverlight.aspx)提供了一个使用浏览器事件的解决方案。

## UserControls 上没有 Unloaded 事件

有一个 Loaded 事件，但没有 Unloaded - 如果你想从屏幕上删除一个控件并运行一些卸载逻辑，你需要滚动你自己的方式来做到这一点。我有一个 IUnloadable 接口，我从中派生出我的控件，需要运行卸载逻辑并在适当的时候手动调用它的方法。

* * *

最后，[这篇文章](http://devlicio.us/blogs/rob_eisenberg/archive/2008/07/26/silverlight-problems-that-affect-me.aspx)提供了一些关于 Silverlight 与 WPF 相比缺少什么的好信息。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-26T23:36:55.847

错过双击事件对我来说是一个。我很惊讶它不在那里，并一直在智能感知列表中查找:-) 通过在其上创建一个 hack 解决了它，但这不是解决方案。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-04T22:46:28.153

我发现调试支持非常不稳定。它曾经对我有用，但从那以后就再也没有了，无论我尝试什么。我认为它可能只有在使用 Silverlight ASP 支持通过 ASP.NET 3.5 站点进行调试时才能正常工作。

### 解决了

问题在于使用谷歌浏览器。由于 Google Chrome 在自己的进程中托管 Silverlight，因此调试器找不到它。如果您使用 IE7 进行调试，它可以正常连接，但如果您使用 Chrome 进行调试，则必须手动附加到 Chrome 下的相应 Silverlight 任务才能正常工作。

感谢[mattmanser 提供有关](https://stackoverflow.com/questions/481817/what-are-the-biggest-gotchas-in-silverlight-2-0/515287#515287)问题可能是什么的线索。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-27T02:33:14.397

最近让我印象深刻的是没有 LayoutTransform 属性（尽管有 RenderTransform 属性）。因此，您不能应用转换并让相邻元素遵守控件的“新空间要求”，这将导致它与其他元素重叠或有空白空间。

这对我来说是个问题，因为我希望滚动查看器内的可滚动区域随着变换而改变。我能够绕过它，但是如果您尝试旋转或进行其他变换，则该过程会困难得多。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-29T11:38:39.643

使用 IE6 并且托管 Silverlight 应用程序的网站启用了压缩（HTTP 1.1 标头）

每当您进行 Web 服务调用时，即使 Fiddler 显示正在发送的请求并且响应成功到达，它也会失败。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-05T01:55:54.013

**Web 请求中没有可用的凭据**

该物业在或`Credentials`上不可用。您需要通过[将执行凭据的代理服务](http://blogs.msdn.com/brada/archive/2008/05/03/accessing-the-asp-net-authentication-profile-and-role-service-in-silverlight.aspx)运行请求。`WebClient``HttpWebRequest`

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-06-20T13:50:50.607

HttpWebRespone 只能有两个状态码之一

*   200 好
*   404 未找到

这意味着所有其他错误都映射到 404，这很烦人。我不知道重定向是如何工作的（我希望它们会被自动跟踪......）

[http://msdn.microsoft.com/en-us/library/system.net.httpstatuscode(VS.95).aspx](http://msdn.microsoft.com/en-us/library/system.net.httpstatuscode(VS.95).aspx)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-12-15T22:25:36.550

事实上，在短时间内有这么多不同的版本。

**好**- 令人沮丧的事情很快得到解决。例如鼠标滚轮、右键单击 - 在 Silverlight 4 中已修复。

**不好**-如果您是新手，您不知道是否仍然需要记录在案的“黑客”。我刚开始使用 Silverlight 4 并找到大量教程和帮助 - 但我永远不知道它们是最新的还是最好的方法。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-27T00:28:44.447

不久前，我在 Silverlight 2.0 中做了一个项目，该项目是使用 TDD 和 MVP 驱动的。我的服务引用位于单独的程序集中，因此视图不需要知道模型。我对需要位于视图程序集中的**ServiceReferences.ClientConfig文件的位置有疑问！**

如果您添加服务引用，则会生成此文件。我们添加了一个 WCF Web 服务，但我是 Silverlight 的新手，所以不知道 Silverlight 应用程序是作为 XAP 编译和打包的。

如果您的**ServiceReferences.ClientConfig**文件不在此 XAP 中，您就有问题。

所以我的两美分值得。不久前我在 Silverlight 论坛上发布了这个，看来我不是这个问题唯一适用的人。

[我的原帖](http://silverlight.net/forums/p/18528/165341.aspx#165341)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-11T19:07:28.190

哦，有负载。让我们从 3 个浏览器陷阱开始：

**除了 IE 之外**的任何东西：Silverlight 对象不会缩放以适应浏览器窗口。解决方法：将其放在标签之间：

```
<style type="text/css">
  html, body, form { height: 100% }
</style> 
```

另请注意，IE 将允许您在 localhost 中拥有您的开发网站，并且您的应用程序可以访问其他域，而其他浏览器则不会。

**Safari**：如果您使用自定义响应标头（这对于在数据服务中进行高效分页很有用），Safari 可能会更改标头名称破坏您的应用程序的大小写。

**能见度问题**

更改折叠的可见性组件的属性存在各种问题，通常发生的情况是它们在不可见时不会注册更改，并且当您使它们可见时您必须再次执行它们。SL 团队似乎没有非常彻底地测试当您使组件不可见和可见时会发生什么。

如果您收到意外的间歇性 ArgumentException，这很可能是因为您在按钮的单击事件中有代码，这使得按钮本身（或其父级）不可见。显然，一些内部代码在期望按钮可见的单击事件之后运行。通过在 click 事件中创建一个短的（例如 100 毫秒）DespatcherTimer 并在 Tick 事件中设置按钮不可见来解决此问题。

**DependencyObject / DependencyProperty 问题**

如果您习惯了这些在 WPF 中的工作方式，它们在 Silverlight 中被彻底破坏了。如果您的数据对象是 DependencyObjects，您将遇到 2 个问题。一是在 SL DependencyProperties 中没有内置更改通知 - 如果您希望它们更新绑定，您需要使您的对象实现 INotifyPropertyChanged。另一个是如果你绑定到 DependencyObjects 的集合，你会得到非常奇怪的效果。您需要在控制层次结构的下方使用一个类 - 我是从 FrameworkTemplate 继承的。因此，我建议您的数据对象如下所示：

```
public class CustomDataObject : FrameworkTemplate, INotifyPropertyChanged
{ ... } 
```

**转换器**

没有多值转换器，也没有 Binding.DoNothing。我所知道的这些没有解决方法。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-06-21T00:05:03.367

**OpenFileDialog/隔离存储**

为了让您的应用最初使用或增加本地存储，您必须指定需要多少空间，然后 Silverlight 会提示用户是否允许更改。这都很好。但是有一个问题：如果你打开一个文件对话框，在那之后就没有办法获得更多的存储空间了。在我的场景中，用户选择了文件，我对其进行了处理，然后计算了保存处理后的文件需要多少空间。但是由于这个问题，我不得不猜测该文件的最大大小是多少，并据此请求存储。如果文件较大，用户将不得不重新执行整个过程。

**布局系统**

这真是糟透了。在您明确设置元素的大小之前，您将获得所有大小属性​​的 NaN。您可以挂钩每个调整大小事件并在那里获取值，但在大多数情况下，您不能只要求高度或宽度并获得您想要的。

**没有布局转换**

[上面](https://stackoverflow.com/questions/481817/what-are-the-biggest-gotchas-in-silverlight-2-0/482166#482166 "多于")提到的特拉维斯

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-05T10:18:25.790

调试可能很棘手，如果它不起作用，可能是因为您在进程中附加了错误的代码类型。尝试手动附加到进程并确保您选择了“silverlight 代码”而不是“托管代码”。从那时起，它可能会一直工作。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-05-04T13:21:10.427

### 消息框

我[`System.Windows.MessageBox`](http://msdn.microsoft.com/en-us/library/system.windows.messagebox(VS.95).aspx)最近正在使用静态类（目前，这是获得接近应用程序模式的唯一方法 - 而不仅仅是 UI 模式 - 用户反馈），我发现了令人讨厌的焦点处理，消息框将焦点返回给浏览器而不是在显示消息框之前具有焦点的 Silverlight 控件。这无疑是因为 Silverlight 插件使用浏览器来显示消息框，但它仍然很烦人，再加上可用于自定义消息框的有限选项，很快就发现我需要其他东西来提供我的用户反馈。

### 显示弹出窗口时阻止用户界面访问...

在网上搜索后，很明显我需要使用某种基于[`Popup`](http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.popup(VS.95).aspx)原语的用户界面模态显示。因此，我推出了自己的模态对话框类，并在此过程中发现了另一个问题。

弹出窗口下方的用户界面仍然处于活动状态，这意味着您可以通过选项卡访问您想要隐藏的控件。为了缓解这种情况，我首先尝试通过获取[`RootVisual`](http://msdn.microsoft.com/en-us/library/system.windows.application.rootvisual(VS.95).aspx)（即页面）并设置[`IsEnabled`](http://msdn.microsoft.com/en-us/library/system.windows.controls.control.isenabled(VS.95).aspx)为来禁用页面`false`。[`DataGrid`](http://msdn.microsoft.com/en-us/library/system.windows.controls.datagrid(VS.95).aspx)这很好用，直到我在编辑操作期间使用了我的对话框。对话代码工作了两次，再也没有工作过。似乎在编辑期间禁用和启用网格会导致 Silverlight 中出现某种不可恢复的问题（可能是内存泄漏，因为它最终崩溃了）。

事实证明，要实现我想要的，最简单的方法是将焦点设置在我的弹出对话框中并将[`TabNavigation`](http://msdn.microsoft.com/en-us/library/system.windows.controls.control.tabnavigation(VS.95).aspx)属性设置为[`KeyboardNavigationMode.Cycle`](http://msdn.microsoft.com/en-us/library/system.windows.input.keyboardnavigationmode(VS.95).aspx). 这样，焦点永远不会离开对话框，因此底层 UI 仍然超出范围，但不会产生上述问题。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-04T16:37:32.887

不支持模态弹出窗口的解决方案 - 创建一个扩展整个画布并将不透明度设置为 0.05 的用户控件，如 ScottGu 的示例 Silverlight 应用程序 [http://weblogs.asp.net/scottgu/pages/silverlight-2-end -to-end-tutorial-building-a-digg-search-client.aspx](http://weblogs.asp.net/scottgu/pages/silverlight-2-end-to-end-tutorial-building-a-digg-search-client.aspx)

不支持数据集 解决方案 - 使用 LINQ to XML 可以将 XML 读入通用列表以进行数据绑定

不支持母版页解决方案 - 创建父 XAML 页面，并使用用户控件创建应用程序的其余部分，以便您可以在它们之间切换

将 AJAX 工具包与 ASP.NET Silverlight 标记一起使用时会出现命名空间问题。
解决方案 - 使用 OBJECT 标记而不是 ASP.NET Silverlight 标记。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-20T00:42:32.513

令人沮丧的是，Silverlight 在调试时会吞下如此多的异常。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-05-04T13:31:33.570

### 控件的父级是资源...

在资源中声明一个控件，然后尝试将其作为父级，[`Popup`](http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.popup%28VS.95%29.aspx)将导致异常，指出该控件已经有一个父级。在这种情况下，无法检测父母是什么并将其删除（我尝试了许多不同的方法）。解决方法是将我的控件包装在资源中的弹出窗口中，然后让我的代码重新使用该弹出窗口，或者通过重新设置控件来丢弃它以支持我自己的弹出窗口。由于控件可以将弹出窗口识别为其父级，因此这很容易做到。

# sql - SQL 中 ENUM 列的大小？

> ID：481829
> 
> 赞同：10
> 
> 时间：2009-01-26T23:32:55.697
> 
> 标签：sql, mysql, enums

数据库（如果特定示例很重要，则为 mySQL）如何确定存储 ENUM 所需的列的大小？

对于少于 256 个枚举选项的单个字节等，它是不是很简单？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-26T23:42:23.760

MySQL 手册说“1 或 2 个字节，取决于枚举值的数量”。如果 ENUM 的可能值少于 256 个，则使用 1 个字节，否则使用 2 个字节。

见：[10.5。数据类型存储要求](http://dev.mysql.com/doc/refman/5.0/en/storage-requirements.html)

# version-control - 设置多个开发环境

> ID：481840
> 
> 赞同：0
> 
> 时间：2009-01-26T23:37:21.303
> 
> 标签：version-control, development-environment, virtualization, environment

我是一个使用 Eclipse 作为我的 IDE 和 Subversion 进行源代码控制的典型 Web 项目（Django + PostgresSQL）的独立开发人员。到目前为止，我一直在自己设置的单一开发机器上工作。最近，我被要求在客户站点上做一些工作，并且在一些情况下，在家中访问该站点会很有用。我正在考虑设置它的最佳方法是什么。不幸的是，由于各种原因，笔记本电脑不是一个可行的解决方案，所以我正在考虑的解决方案是：

1.  在每台机器上安装所有必要的开发工具（PostgresSQL、Eclipse、Django、Python + 库等）并使用 SVN 保持代码同步。
2.  在我的开发机器上设置某种 VNC 访问权限并远程访问它以完成工作。
3.  创建虚拟机并使用笔式驱动器在所有机器之间复制映像。

#1 的优势是快速的本地开发，但是我必须在每台机器上设置所有工具并处理它们的配置并保持一切同步。此外，为了在机器之间共享代码，即使它还没有“准备好”，我也必须将其签入 SVN。解决方案#2 解决了这个问题，但代价是 UI 体验变慢。最后，#3 似乎是一个不错的解决方案，但我不确定我是否真的可以在笔式驱动器上安装虚拟映像，并且我不确定性能。

我想没有一个真正“正确”的答案，但我把它扔掉是为了从比我做这件事的人那里得到想法和建议。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T23:46:07.310

我会说选项 1 仍然是最好的。我假设你家里只有一台电脑，你可以用那台电脑工作，所以设置应该是一次性的。

你是对的，虽然设置时间很繁琐，但它确实弥补了使用 VNC 之类的东西远程工作的缓慢 UI。您提交的代码可能不起作用的问题是一个有效的问题，但是如果您对此感到担心，只需注释掉损坏的代码并确保您的最新版本可以编译。

通过存储库工作是最有效的方法，特别是如果您正在处理一个相当大的项目。你没有笔记本电脑太糟糕了，在笔记本电脑上设置所有工具可以让你在任何地方编码/工作（只要你有互联网连接）特别方便。

无论如何，选项1是我的偏好，我希望它有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T23:48:28.957

如果机器有 e-sata 端口[，这](http://www.ocztechnology.com/products/flash_drives/ocz_throttle_esata_flash_drive)可能就是您要找的。为什么不将一和三结合起来，创建一个基础 vm 一次将其部署到所有机器上，并使用 svn 或其他同步工具保持代码同步？如果您不想经常签入和签出源代码控制，只要您不介意让第三方能够查看您的代码，像[drop box](http://www.getdropbox.com/)之类的东西就可以让您保持工作目录同步，尽管他们可能会赢不打扰。另一种选择是创建一个“工作”分支，您始终可以签入和签出，并且仅在它足够稳定且已完成时才将代码移动到主干。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T00:40:44.390

使用版本控制。如果您担心签入“不完整”代码，请使用分支（用于开发的分支）或标签（标记“已完成”代码）。提交“进行中”的工作有其优势（良好的撤消，帮助您编写良好的变更日志等）。此外，记录您的“设置”过程以便更容易复制也很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-23T12:36:53.587

> 此外，为了在机器之间共享代码，即使它还没有“准备好”，我也必须将其签入 SVN。

[Git](http://git-scm.com/)非常明确地解决了这个问题。就离线开发而言，您应该尝试一下 Git。它使管理离线存储库变得非常简单。并且由于其分布式架构在环境之间移动时提供了一些便利。它旨在使工作流程签入经常提前签入。我想你会发现它提供了 SVN 没有的东西。

例如，您可以为不同的环境保留不同的存储库，并轻松合并它们之间的更改。这样，您就可以将存储库与您的 VM 映像捆绑在一起。它们可以显着分歧，但仍然很容易重新合并在一起。

合并是使 Git 成为使用梦想的原因。

观看这两个演示文稿以获得很好的概述。

Linus Torvalds on Git（更多关于 Git 的设计理念）

[http://www.youtube.com/watch?v=4XpnKHJAok8](http://www.youtube.com/watch?v=4XpnKHJAok8)

Randall Schwartz 演讲（更实用的概述）

[http://www.youtube.com/watch?v=8dhZ9BXQgc4](http://www.youtube.com/watch?v=8dhZ9BXQgc4)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-26T23:50:05.070

从笔式驱动器运行虚拟机（即使是快速的，但大多数都不是！）将耗费大量时间。

您可以在本地复制它或使用 USB 硬盘，甚至可以使用 Live Mesh 之类的解决方案来同步它。

# .net - WCF 身份验证

> ID：481845
> 
> 赞同：13
> 
> 时间：2009-01-26T23:39:11.973
> 
> 标签：.net, wcf, security, authentication

WCF 中是否有某种“内置”身份验证？我需要向我们的客户公开一个 Web 服务，这样他们就可以检查他们的交易状态。

我最初的想法是他们只会使用作为方法属性传入的正常用户名和密码。当然，它会通过 SSL，但是这种身份验证方法不安全吗？

除了传递方法参数之外，WCF 是否有更好的方法来允许对请求进行身份验证？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T23:44:39.107

检查这些页面：

[佩德拉姆·拉泽伊的漫谈](http://blogs.msdn.com/pedram/archive/2007/10/05/wcf-authentication-custom-username-and-password-validator.aspx)

[微软指南](http://msdn.microsoft.com/en-us/library/bb398990.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T23:52:22.197

WCF 包含用于各种安全性的非常广泛的基础结构。我在这里解释的太多了，但是如果您对该主题感兴趣，我真的可以推荐 Juval Lowy 的[Programming WCF Services 2nd edition](https://rads.stackoverflow.com/amzn/click/com/0596521308)。否则，您也可以在[http://msdn.microsoft.com/en-us/library/ms735093.aspx](http://msdn.microsoft.com/en-us/library/ms735093.aspx)找到相关信息，但您需要做更多的工作才能弄清楚整体情况。

您正在研究的场景很常见，仅在大多数情况下，用户名和密码是在soap消息的标头中传递的，而不是作为方法的参数。在[theserverside.net上有一篇文章即将实现这一点](http://www.theserverside.net/tt/articles/showarticle.tss?id=SecuringWCFService)

# reverse-engineering - 我在哪里可以获得所有 MSIL 代码及其十六进制值的列表？

> ID：481846
> 
> 赞同：2
> 
> 时间：2009-01-26T23:39:14.547
> 
> 标签：reverse-engineering, hex, cil

有人有所有 MSIL 代码及其相应十六进制值的列表或图表吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T23:43:11.463

看看[ECMA-335](http://www.ecma-international.org/publications/standards/Ecma-335.htm) - 特别是，我相信分区 III 是你所追求的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T23:45:09.260

[规范](http://www.ecma-international.org/publications/standards/Ecma-335.htm)的来源

[有关Reflection.Emit 中使用的常量](http://msdn.microsoft.com/en-us/library/system.reflection.emit.opcodes.aspx)的 MSDN 帮助页面也很有用

不过，我发现[.Net Reflector](http://www.red-gate.com/products/reflector/)对于自己实际检查内容非常宝贵，尤其是使用简单但快速响应的[snippy 插件](http://www.codeplex.com/reflectoraddins/Wiki/View.aspx?title=Snippy&referringTitle=Home)。

# python - 从大型结构化文本文件中提取信息

> ID：481862
> 
> 赞同：1
> 
> 时间：2009-01-26T23:47:04.000
> 
> 标签：python, text-processing

我需要阅读一些大文件（从 50k 到 100k 行），这些文件以空行分隔的组为结构。每组以相同的模式“No.999999999 dd/mm/yyyy ZZZ”开始。这是一些示例数据。

> No.813829461 16/09/1987 270
> Tit.SUZANO PAPEL E CELULOSE SA (BR/BA)
> CNPJ/CIC/N INPI : 16404287000155
> Procurador: MARCELLO DO NASCIMENTO
> 
> No.815326777 28/12/1989 351
> Tit.SIGLA SISTEMA GLOBO DE GRAVACOES AUDIO VISUAIS LTDA (BR/RJ)
> CNPJ/CIC/NºINPI : 34162651000108
> Apres.: Nominativa ; Nat.: De Produto
> Marca: TRIO TROPICAL
> Clas.Prod/Serv: 09.40
> *DEFERIDO CONFORME RESOLUÇÃO 123 DE 06/01/2006, PUBLICADA NA RPI 1829, DE 24/01/2006。
> 检察官：WALDEMAR RODRIGUES PEDRA
> 
> No.900148764 11/01/2007 LD3
> Tit.TIARA BOLSAS E CALÇADOS LTDA
> Procurador: Marcia Ferreira Gomes
> *Escritório: Marcas Marcantes e Patentes Ltda
> *Exigência Formal não respondida Satisfatoriamente, Pedido de Registro de Marca thinkado inexistente, de acordo com Art。157 da LPI
> *Protocolo da Petição de cumprimento de Exigência 正式：810080140197

我写了一些代码来相应地解析它。有什么我可以改进的，以提高可读性或性能？这是我到目前为止的内容：

```
import re, pprint

class Despacho(object):
    """
    Class to parse each line, applying the regexp and storing the results
    for future use
    """
    regexp = {
        re.compile(r'No.([\d]{9})  ([\d]{2}/[\d]{2}/[\d]{4})  (.*)'): lambda self: self._processo,
        re.compile(r'Tit.(.*)'): lambda self: self._titular,
        re.compile(r'Procurador: (.*)'): lambda self: self._procurador,
        re.compile(r'C.N.P.J./C.I.C./N INPI :(.*)'): lambda self: self._documento,
        re.compile(r'Apres.: (.*) ; Nat.: (.*)'): lambda self: self._apresentacao,
        re.compile(r'Marca: (.*)'): lambda self: self._marca,
        re.compile(r'Clas.Prod/Serv: (.*)'): lambda self: self._classe,
        re.compile(r'\*(.*)'): lambda self: self._complemento,
    }

    def __init__(self):
        """
        'complemento' is the only field that can be multiple in a single registry
        """
        self.complemento = []

    def _processo(self, matches):
        self.processo, self.data, self.despacho = matches.groups()

    def _titular(self, matches):
        self.titular = matches.group(1)

    def _procurador(self, matches):
        self.procurador = matches.group(1)

    def _documento(self, matches):
        self.documento = matches.group(1)

    def _apresentacao(self, matches):
        self.apresentacao, self.natureza = matches.groups()

    def _marca(self, matches):
        self.marca = matches.group(1)

    def _classe(self, matches):
        self.classe = matches.group(1)

    def _complemento(self, matches):
        self.complemento.append(matches.group(1))

    def read(self, line):
        for pattern in Despacho.regexp:
            m = pattern.match(line)
            if m:
                Despacho.regexp[pattern](self)(m)

def process(rpi):
    """
    read data and process each group
    """
    rpi = (line for line in rpi)
    group = False

    for line in rpi:
        if line.startswith('No.'):
            group = True
            d = Despacho()        

        if not line.strip() and group: # empty line - end of block
            yield d
            group = False

        d.read(line)

arquivo = open('rm1972.txt') # file to process
for desp in process(arquivo):
    pprint.pprint(desp.__dict__)
    print('--------------') 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T00:55:51.413

这是相当不错的。下面的一些建议，如果你喜欢，请告诉我：

```
import re
import pprint
import sys

class Despacho(object):
    """
    Class to parse each line, applying the regexp and storing the results
    for future use
    """
    #used a dict with the keys instead of functions.
    regexp = {
        ('processo', 
         'data', 
         'despacho'): re.compile(r'No.([\d]{9})  ([\d]{2}/[\d]{2}/[\d]{4})  (.*)'),
        ('titular',): re.compile(r'Tit.(.*)'),
        ('procurador',): re.compile(r'Procurador: (.*)'),
        ('documento',): re.compile(r'C.N.P.J./C.I.C./N INPI :(.*)'),
        ('apresentacao',
         'natureza'): re.compile(r'Apres.: (.*) ; Nat.: (.*)'),
        ('marca',): re.compile(r'Marca: (.*)'),
        ('classe',): re.compile(r'Clas.Prod/Serv: (.*)'),
        ('complemento',): re.compile(r'\*(.*)'),
    }

    def __init__(self):
        """
        'complemento' is the only field that can be multiple in a single registry
        """
        self.complemento = []

    def read(self, line):
        for attrs, pattern in Despacho.regexp.iteritems():
            m = pattern.match(line)
            if m:
                for groupn, attr in enumerate(attrs):
                    # special case complemento:
                    if attr == 'complemento':
                        self.complemento.append(m.group(groupn + 1))
                    else:
                        # set the attribute on the object
                        setattr(self, attr, m.group(groupn + 1))

    def __repr__(self):
        # defines object printed representation
        d = {}
        for attrs in self.regexp:
            for attr in attrs:
                d[attr] = getattr(self, attr, None)
        return pprint.pformat(d)

def process(rpi):
    """
    read data and process each group
    """
    #Useless line, since you're doing a for anyway
    #rpi = (line for line in rpi)
    group = False

    for line in rpi:
        if line.startswith('No.'):
            group = True
            d = Despacho()        

        if not line.strip() and group: # empty line - end of block
            yield d
            group = False

        d.read(line)

def main():
    arquivo = open('rm1972.txt') # file to process
    for desp in process(arquivo):
        print desp # can print directly here.
        print('-' * 20)
    return 0

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T00:04:04.310

如果您有具体问题，提供帮助会更容易。性能很大程度上取决于您使用的特定正则表达式引擎的效率。单个文件中的 100K 行听起来并不大，但这又完全取决于您的环境。

我在 .NET 开发中使用[Expresso](http://www.ultrapico.com/Expresso.htm)来测试表达式的准确性和性能。谷歌搜索出现了[Kodos](http://kodos.sourceforge.net/about.html)，这是一个 GUI Python 正则表达式创作工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T00:40:43.207

整体看起来不错，但为什么你有这条线：

```
rpi = (line for line in rpi) 
```

您已经可以在没有此中间步骤的情况下迭代文件对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T19:29:55.190

我不会在这里使用正则表达式。如果您知道您的行将以固定字符串开头，为什么不检查这些字符串并围绕它编写逻辑呢？

```
for line in open(file):
    if line[0:3]=='No.':
        currIndex='No'
        map['No']=line[4:]
   ....
   ...
   else if line.strip()=='':
       //store the record in the map and clear the map
   else:
      //append line to the last index in map.. this is when the record overflows to the next line.
      Map[currIndex]=Map[currIndex]+"\n"+line 
```

将上述代码视为伪代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T21:42:46.060

另一个只有一个组合正则表达式的版本：

```
#!/usr/bin/python

import re
import pprint
import sys

class Despacho(object):
    """
    Class to parse each line, applying the regexp and storing the results
    for future use
    """
    #used a dict with the keys instead of functions.
    regexp = re.compile(
        r'No.(?P<processo>[\d]{9})  (?P<data>[\d]{2}/[\d]{2}/[\d]{4})  (?P<despacho>.*)'
        r'|Tit.(?P<titular>.*)'
        r'|Procurador: (?P<procurador>.*)'
        r'|C.N.P.J./C.I.C./N INPI :(?P<documento>.*)'
        r'|Apres.: (?P<apresentacao>.*) ; Nat.: (?P<natureza>.*)'
        r'|Marca: (?P<marca>.*)'
        r'|Clas.Prod/Serv: (?P<classe>.*)'
        r'|\*(?P<complemento>.*)')

    simplefields = ('processo', 'data', 'despacho', 'titular', 'procurador',
                    'documento', 'apresentacao', 'natureza', 'marca', 'classe')

    def __init__(self):
        """
        'complemento' is the only field that can be multiple in a single
        registry
        """
        self.__dict__ = dict.fromkeys(self.simplefields)
        self.complemento = []

    def parse(self, line):
        m = self.regexp.match(line)
        if m:
            gd = dict((k, v) for k, v in m.groupdict().items() if v)
            if 'complemento' in gd:
                self.complemento.append(gd['complemento'])
            else:
                self.__dict__.update(gd)

    def __repr__(self):
        # defines object printed representation
        return pprint.pformat(self.__dict__)

def process(rpi):
    """
    read data and process each group
    """
    d = None

    for line in rpi:
        if line.startswith('No.'):
            if d:
                yield d
            d = Despacho()
        d.parse(line)
    yield d

def main():
    arquivo = file('rm1972.txt') # file to process
    for desp in process(arquivo):
        print desp # can print directly here.
        print '-' * 20

if __name__ == '__main__':
    main() 
```

# zend-framework - Zend 框架：如何删除 Zend 表单隐藏元素上的装饰器？

> ID：481871
> 
> 赞同：50
> 
> 时间：2009-01-26T23:51:45.630
> 
> 标签：zend-framework, zend-form, zend-decorators

我正在尝试删除隐藏表单元素上的默认装饰器。默认情况下，隐藏元素显示如下：

```
<dt>Hidden Element Label (if I had set one)</dt>
<dd><input type="hidden" name="foobar" value="1" id="foobar"></dd> 
```

我不希望我的隐藏元素占用我页面上的空间。我想删除所有默认装饰器，所以我只剩下输入标签。

```
<input type="hidden" name="foobar" value="1" id="foobar"> 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2010-12-07T14:08:06.657

对于隐藏字段，您只需要一个装饰器 - ViewHelper：

```
$field = new Zend_Form_Element_Hidden('id');
$field->setDecorators(array('ViewHelper')); 
```

这将只呈现输入字段，没有 Dt-Dd 包装器和标签。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-01-27T00:15:39.293

来自[Zend Element Decorators](http://framework.zend.com/manual/en/zend.form.elements.html#zend.form.elements.decorators)文档：

> 不需要加载默认装饰器
> 
> 默认情况下，默认装饰器在对象初始化期间加载。您可以通过将 'disableLoadDefaultDecorators' 选项传递给构造函数来禁用此功能：
> 
> ```
> $element = new Zend_Form_Element('foo', 
>     array('disableLoadDefaultDecorators' => true)
> ); 
> ```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-02-10T22:15:23.063

我用这个

```
$element->removeDecorator('DtDdWrapper'); 
```

摆脱特定元素周围的 dt dd 标签

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-07T15:13:29.907

// 基于上面 - 一个简单的函数来添加一个隐藏元素到 $this 表单

```
/**
 * Add Hidden Element
 * @param $field
 * @param value
 * @return nothing - adds hidden element
 * */
public function addHid($field, $value){     
    $hiddenIdField = new Zend_Form_Element_Hidden($field);
    $hiddenIdField->setValue($value)
          ->removeDecorator('label')
          ->removeDecorator('HtmlTag');     
    $this->addElement($hiddenIdField);
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-09-24T12:04:37.077

当您有很多隐藏输入时，最佳答案如下：

```
$elements = $this->getElements();
foreach ($elements as $elem)
    if ($elem instanceof Zend_Form_Element_Hidden)
        $elem->removeDecorator('label')->removeDecorator('HtmlTag'); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-07-13T13:46:06.127

正如其他帖子中提到的那样，`setDisableLoadDefaultDecorators(true)`如果它们已经加载`clearDecorators()`则不起作用......但是可以！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-06T18:11:26.520

我无法让 disableLoadDefaultDecorators 正常工作。这是我想出的解决方案。

```
$hiddenIdField = new Zend_Form_Element_Hidden('id');
$hiddenIdField->setValue($portalId)
              ->removeDecorator('label')
              ->removeDecorator('HtmlTag'); 
```

在 HTML 中，隐藏的字段周围没有任何额外的标签。

```
...
<dt><label for="password" class="required">Password</label></dt>
<dd><input type="password" name="password" id="password" value="" /></dd>
<input type="hidden" name="id" value="1" id="id" />
... 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-07-24T23:56:47.400

[这是来自http://www.phpfreaks.com/forums/index.php?topic=225848.0](http://www.phpfreaks.com/forums/index.php?topic=225848.0)的 takeme2web 建议

$yourhiddenzendformelement->setDecorators(array('ViewHelper'));

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-12-14T22:21:09.153

如果您仍在使用`<dl>`包装器，则仅使用单个“ViewHelper”装饰器将生成无效标记。[ZF-2718](http://framework.zend.com/issues/browse/ZF-2718?focusedCommentId=40837&page=com.atlassian.jira.plugin.system.issuetabpanels%3acomment-tabpanel#action_40837)中概述了另一种方法。这会将隐藏字段添加到包含在`<dd>`.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-07-31T17:32:24.733

好吧，2012年仍然是同样的问题。如果您删除装饰器，则 html 将无法验证。如果你离开它们，隐藏的元素会占用空间。在我所有的项目中，我都有一个 CSS 助手 .hidden，所以我只是将它应用到`<dd>`并取消设置标签：

```
$element = new Zend_Form_Element_Hidden('foo', array('value' => 'bar'));
$element->removeDecorator('Label');
$element->getDecorator('HtmlTag')->setOption('class', 'hidden'); 
```

有效的 html(5)，漂亮的表单。这也可以进入隐藏字段的自定义装饰器。

**编辑**

这就是我将它放入我自己的表单元素的方式：

```
class Exanto_Form_Element_Hidden extends Zend_Form_Element_Hidden
{
    public function render(Zend_View_Interface $view = null)
    {
        $this->removeDecorator('Label');
        $this->getDecorator('HtmlTag')->setOption('class', 'hidden');
        return parent::render($view);
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-02-09T11:47:02.410

用这个：

```
 foreach ($this->getElements() as $element) {

        $decorator = $element->getDecorator('label');
        if (!$decorator) {
            continue;
        }
        $decorator->removeOption('tag');
    } 
```

# database - 数据库之间的主要区别是什么？

> ID：481879
> 
> 赞同：14
> 
> 时间：2009-01-26T23:59:28.263
> 
> 标签：database, comparison

我对任何数据库都不狂热，但我希望看到供应商之间的差异。

例如，我主要使用 Oracle，而我发现其他人（MySQL、SQL Server、PostgreSQL、...）无法做到：

*   [通过](http://www.adp-gmbh.ch/ora/sql/connect_by.html)查询连接。
*   [模型](http://www.oreillynet.com/pub/a/network/2004/08/10/MODELclause.html)查询。
*   [闪回](http://www.orafaq.com/node/50)（查询、表和数据库）。

SQL Server 也是如此，其他人无法做到：

*   [顶级结果](http://www.databasejournal.com/features/mssql/article.php/3532226/TOP-Clause-in-SQL-Server-2005.htm)。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-27T00:30:15.083

Oracle 的 CONNECT BY 是标准 SQL 的递归 SQL 的受限版本。DB2s 和 MSSQLs 递归“公共表表达式”编码有点困难，但比 Oracle 的 CONNECT BY 提供了更多的功能。（不过，Oracle 数据库的下一个版本应该得到真正的递归 SQL。）

闪回是一个真正独特的 Oracle 特性，它反映了[MVCC](http://en.wikipedia.org/wiki/Multiversion_concurrency_control)在 Oracle 中的内置程度。MVCC 是 Oracle 处理并发的方式，而不是传统的悲观锁；并发处理是数据库之间存在很大差异的地方之一（尽管大多数 DBMS 正在远离仅基于悲观锁定的并发）。在我看来，Oracle 坚定地建立在 MVCC 之上的事实是一个显着的优势。

关于 TOP 结果：所有 DBMS 都有办法做到这一点。

除此之外：

SQL 方面：Oracle 具有最先进和符合标准的日期时间处理。Oracle 在与 OLAP 相关的功能方面很强大（但 DB2 和 MSSQL 也是如此；OLAP 功能是开源 DBMS 难以跟上的一个领域）。最近，Oracle 似乎基本上忽略了 SQL 标准，因为它的标准合规性停滞不前（例如，与 MSSQL 相比，它在这里有了很大的改进）；由于甲骨文的巨大市场份额，我将此归咎于傲慢。

从概念上讲：Oracle 和 MySQL 是两种非常不同的数据库处理方式的示例。在 Oracle 中，创建数据库需要很长时间，而数据库是一个非常重的对象，因此在 Oracle 世界中，数据库往往包含很多表，可能在不同的“模式”中。在 MySQL 中，数据库是一个非常轻量级的对象，因此 MySQL 用户倾向于拥有许多数据库，每个数据库中的表相对较少（这可能是他们似乎不抱怨 MySQL 缺乏模式的原因）。

Oracle（如 DB2）是几乎包含整个操作系统的 DBMS 的一个示例：它执行许多特性，如 MSSQL/MySQL/PostgreSQL 之类的 DBMS 将让操作系统的文件系统和虚拟内存系统处理。就个人而言，我更喜欢后一种方法，但是 Oracle 的方法使 Oracle 的性能无论使用哪种操作系统都非常相似。

与 MSSQL 相比，Oracle 可在更多平台上运行（与大多数其他 DBMS 一样；MSSQL 可能是唯一*仅*在 Windows 上运行的重要 DBMS）。

与大多数其他 DBMS 相比，Oracle 提供了另一种集群方式：RAC。我听说过很多关于 RAC 的恐怖故事，但如果你能让它工作，可以说你有一个非常强大（且昂贵）的集群解决方案。

关于管理，与大多数其他 DBMS 相比，我发现 Oracle 的管理出奇地复杂。

然后，当然还有严重的定价差异：甲骨文的定价*非常*高，而且还在不断上涨。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T00:11:03.640

一些相关链接：

*   [不同 SQL 实现的比较](http://troels.arvin.dk/db/rdbms/)
*   [用于 Oracle、SQL Server 和 MySQL 的 Bristle 软件 SQL 技巧](http://www.bristle.com/Tips/SQL.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T00:03:23.110

SQL Server 有一个内置的自动递增功能，当您需要一个表的简单递增整数时，您可以将其添加到列中。

在 Oracle 中，您需要创建一个序列并应用适当的触发器以使其自增。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T14:44:40.070

[以下是有关Sybase SQL Anywhere](http://www.sybase.com/products/databasemanagement/sqlanywhere)的一些特性，这些特性(AFAIK) 在其他数据库产品中不存在：

*   表级加密
*   列压缩（作为 Oracle 企业版的一个选项提供，内置于所有版本的 SA）
*   存储过程可以用 SQL、java、perl、php、C/C++、C# 或 VB.NET 编写

全面披露：我为 Sybase 工作——我是 SQL Anywhere 服务器团队的开发人员。这并不意味着广告或代表嫖娼。如果需要，我会将此答案标记为社区 wiki。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-27T19:03:02.043

MySQL 和几乎所有其他数据库之间的一个主要区别，除了 SQLite，MySQL 只知道一种连接——嵌套循环。

这对于 OLTP 来说是可以的，MySQL 表面上是为其设计的准系统工作负载（相同的设计原则导致有一段时间没有实现触发器、视图和子查询等功能），但它对于主要的 OLAP 工作来说是致命的。不要相信我的话，请阅读 Peter Zaitsev： http: [//peter-zaitsev.livejournal.com/758.html](http://peter-zaitsev.livejournal.com/758.html)。它在子查询上也非常慢，它最近才学会这样做。小步骤，我想..

Oracle 非常先进，有很多特性，而且很多都需要额外的钱。建立和支持是一只熊；但如果你能负担得起 DBA 和维护，它的表现会非常好。我有提到成本和维护吗？只是想我会重复一遍。不过，除了对 Oracle 工程师的尊重之外，他们已经构建了一些很棒的东西。

Oracle 失败的一个地方（与大多数其他地方一样）是数 TB 的工作负载。为此，您想求助于 Teradata（同类最佳，极其昂贵）、Greenplum、AsterData、Netezza 等专家。

我只听说过关于 SQL Server 的好消息——除了它只在 Windows 上运行的事实。

MySQL 易于设置，OLTP 速度快，并且通常采取少做多做的方法。

PostgreSQL 正好相反——它是数据库研究人员最喜欢的游乐场，这意味着它有十几种不同的连接策略、存储引擎、高级可选包和各种东西。在做 MySQL 做得好的事情时，它比 MySQL 慢，而在做 MySQL 不知道该怎么做的事情时，它比 MySQL 更慢（见上文，使用哈希连接）。

DB2 应该是好的；没有亲身经历。最好是和 Almaden 的所有人一起做的好。 Sybase 也是如此。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-27T19:58:42.197

差异取决于您的意图——除非您真的想要一份详尽的洗衣清单。换句话说，您似乎真的想询问*显着*差异，而重要性因意图而异。

我建议大多数人通常会发现几个具体的事情很重要：

*   表现
*   兼容性
*   可移植性
*   高级功能
*   使用方便
*   成本

这些数据库特征的相对重要性似乎主要取决于一个人的意图是驻留在**大型****编程** 还是**小型**编程中。由于我主要在大型编程领域工作，因此我将从那里发言。当我在小型编程世界中工作（通常是在我自己的项目上）时，我通常仍然倾向于为大型世界做出决定，因为我发现它很容易，而且我更愿意将自己从当我的项目长大后改变主意的头痛。我注意到，当许多开源项目的追随者迫使他们跨越从小到大的门槛时，他们会遭受巨大的，有时甚至是致命的成长痛苦。

 ****我首先担心的是，我必须始终能够改变我对数据库供应商和产品的选择的想法，因此兼容性是王道，可移植性是王后。考虑到这一点，我强烈倾向于仅将数据库视为存储介质，因此我避免将任何代码放入数据库中，并且避免使用与存储无关或特定于供应商或产品的任何功能。对于 RDBMS，兼容性主要意味着符合 ANSI SQL 标准，因此我立即拒绝任何不合理兼容的产品。由于我在 Linux、Unix 和 Windows 领域工作，因此可移植性意味着在所有这些平台上的可用性。

我的代码属于一起并处于最佳环境中——而不是分离到数据库引擎的残缺环境中；将数据库仅视为存储介质意味着什么的另一方面。因此，编码功能与我的相关性有限。在极少数情况下，我会在数据库中为触发器或一些方便的功能创建代码，因此我希望基本功能符合 ANSI SQL 标准，仅此而已。

我通常有很多数据，所以性能很重要，我愿意牺牲一些易用性来获得它。如果我有一些基本工具来促进和自动化该过程，我不介意繁重的数据库安装或复杂的数据库结构。这意味着我应该能够编写数据库引擎（二进制文件）的安装以及我的数据库结构和数据的脚本。对于重要的数据库任务，强制使用 GUI 作为唯一选项是不可接受的。

有时，通常以性能的名义，我发现有必要使用一个特定的特性来驱动我去特定的供应商甚至特定的产品。我尽我最大的努力隔离这种依赖关系并保留我切换到另一个供应商或产品的选择权，而不会牺牲从该特殊功能中获得的好处。我什至可以围绕从这种特定于供应商或特定于产品的特性中获得的特殊价值构建一个完整的系统，但前提是明确接受这样做的成本。限制一个人的选择的成本似乎超过了所有其他形式的成本。

显然，购买数据库引擎的价格是一种成本，但如何使用它的自由也是如此。因此，我非常看重开源产品。

最后，我经常受制于他人的决定，例如我的客户。因此，我进一步尝试灵活地适应我自己不会做出的选择。

鉴于这一切，我对数据库引擎的主要偏好是 SQLite，因为它的兼容性、可移植性和使用自由度超过了其他所有引擎。

其次，我喜欢 Oracle，我更喜欢它来进行大型编程。它并不便宜，但它可以满足我的任何需求，同时兼具兼容性、可移植性、性能和功能的最佳组合。

第三，当我的客户需要时，我使用 Microsoft SQL Server。我保持技能和与它的兼容性，因为它在市场上太占主导地位而无法忽视。它甚至可能具有我有一天需要的特殊功能，尽管我还没有遇到这种情况。

我避免使用 MySQL，因为它缺乏兼容性，但我经常支持它作为其他人的选择。我认为它是我的主要偏好，但我对其特性的深入审查清楚地表明，人们不能轻易地在它和任何符合 ANSI-SQL 的 RDBMS 之间转换代码库。对我来说，这是完全不能接受的。

顺便说一句，我这样转换到不同数据库引擎的目标是几分钟到大约一周（四十小时）。由于我用兼容层包装了我的数据库访问，我发现我通常最多可以在几个小时内切换数据库引擎。通常，我的应用程序能够同时支持多个数据库引擎（通过在启动时进行简单的配置更改）。

最好的祝愿。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T00:02:12.237

MySQL：[替换](http://dev.mysql.com/doc/refman/5.0/en/replace.html)。这是一个“删除，然后插入”，它将替换现有行。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-27T00:08:19.933

SQL Server 和 MySQL 都不支持字符串连接的标准“双管道”，而其他所有数据库似乎都支持。（更新：显然 MySQL 确实......见下文）

但这可以修复......在 MySQL 的代码中，并通过[http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=259291](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=259291)用于 SQL Server。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-27T00:49:58.990

我是[Sybase SQL Anywhere](http://www.sybase.com/products/databasemanagement/sqlanywhere)服务器团队的开发人员。如果您愿意，我可以在此处发布有关 SQL Anywhere (SA) 功能等的各种信息，但我不想因为发布广告而被遗忘。如果您想了解更多信息，请随时直接与我联系。

以下是对现有答案的回应：

*   SA 还支持自动增量
*   SA 支持`||`字符串连接
*   SA 支持`insert ... on existing update`执行一个既可以插入新行又可以更新现有行的语句

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-14T20:15:34.620

我不知道其他数据库服务器，但使用 PostgreSQL，你可以

```
INSERT INTO mytable
   ( field_1, field_2,... ) 
VALUES
   ( value_1, value_2 )
RETURNING anyfield 
```

*任意字段* d 当然必须是*mytable*的一个字段。

很有趣的时候*anyfield*是自动增量时，这非常有趣。

[见 PostgreSQL - 插入](http://www.postgresql.org/docs/8.3/interactive/sql-insert.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-23T23:47:45.660

除了在我看来，Sybase ASE 是 RDBMS 的红发继子之外，我没有太多贡献。它缺少许多您认为 SQL Server 或 Oracle（甚至 Sybase 的其他风格）理所当然的便利功能，如果没有第三方工具，您无法链接服务器并进行分布式查询，Sybase 管理工具和 IDE 是有限且非常可怜的（再次，我的观点），和它一起工作很痛苦。我想 Sybase 的市场份额只有 3% 是有原因的。

旁注：如果像我一样，您必须使用多个 RDBMS，并且需要一个好的工具，请查看[AquaFold](http://aquafold.com)的 Aqua Data Studio 。我刚开始使用它，它真的很好。它还有一些很棒的实用程序，例如内置的 ER 建模和比较工具。

# web-applications - 是否有稳定且安全的 CMS 可以轻松（通过文档和社区）编写插件/模块？

> ID：481882
> 
> 赞同：0
> 
> 时间：2009-01-27T00:01:03.957
> 
> 标签：web-applications, content-management-system

我正在考虑建立一个网站以提供某种面向公众的内容，但同时，我希望能够构建模块和插件而没有太多麻烦。我正在研究诸如 Wordpress、Joomla 和 Drupal 之类的东西，但我想知道是否有人在使用和（更具体地说）为这些应用程序开发方面有个人经验。

**就个人而言，我正在寻找 PHP 中的东西，但如果你知道另一种语言的东西，请随时发布它以帮助其他正在寻找类似语言 X/Y/Z 的东西的人。**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T01:02:03.537

我强烈推荐[Drupal](http://www.drupal.org) ( [http://www.drupal.org](http://www.drupal.org) )。它是非常稳定和高度安全的CMS系统。除了作为 CMS 之外，它还是 PHP 框架的一部分。

Drupal 扩展/插件称为模块。这些模块允许您使用 Drupal API 来执行 CodeIgniter 或 CakePHP 等框架所做的几乎任何事情。

Drupal 框架部分已经包含了一些常见的东西，比如用户注册、基于角色和权限的访问控制、错误记录系统、分页、数据库抽象和模板等。

此外，Drupal 是一个成熟的 CMS，带有 UI，可以做很多极端的事情。许多大公司已经开始使用 Drupal 作为他们的 CMS，即[The Onion](http://www.theonion.com)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T00:23:41.413

[WordPress](http://wordpress.org/)。它有一个很棒的社区，非常好的文档，非常容易学习，你可以立即开始工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T00:53:09.560

我推荐 pmwiki ( [http://www.pmwiki.org/](http://www.pmwiki.org/) )

它是高度可定制的，用 PHP 编写，很容易编写自己的模块，并且具有完整的安全系统。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-11T17:54:15.017

我会推荐 SPIP。这是一个高度可定制的 CMS，具有相当多的插件。它的代码是用法语编写的，黑客没有机会访问任何代码。
只需访问[http://www.spip.net](http://www.spip.net)

哈瓦斯

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T00:21:37.753

[即时性](http://www.immediacy.co.uk/)是一个需要考虑的问题。这个系统虽然是针对.Net的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T00:32:26.623

这实际上取决于您要编写什么样的模块。例如，WordPress 有一个插件功能，非常适合扩展模型的某些部分，但它实际上被锁定在“循环”中以显示内容。Wordpress 与文章+页面系统非常相关，（文章是博客，页面是层次结构）

您也可以考虑使用 wiki。

那么，您想编写哪些在现有 CMS 工具中没有见过的模块呢？

# c# - 如何检查一个类是否在 C# 中是只读的？

> ID：481883
> 
> 赞同：0
> 
> 时间：2009-01-27T00:01:37.543
> 
> 标签：c#, .net, unit-testing

我可以编写一个单元测试来确保我编写的只读类（没有设置器的类）在未来保持只读状态吗？我不希望任何人在我的课程中添加 setter 属性。

基本上，我如何检查一个类是否在 C# 中没有设置器？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T00:04:24.497

*注意：提问者最初提出的问题是“我如何确定一个类是否是值类型？” 后来改了。*

```
bool isValueType = object.GetType().IsValueType 
```

或者

```
bool isValueType = typeof(YourClass).IsValueType 
```

MSDN：http: [//msdn.microsoft.com/en-us/library/system.type.isvaluetype.aspx](http://msdn.microsoft.com/en-us/library/system.type.isvaluetype.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T00:18:46.400

这应该为零：

```
var setterCount =  
    (from s in typeof(IDataCollector).GetProperties(
        BindingFlags.Public | BindingFlags.Instance)
    where s.CanWrite == true
    select s)
    .Count(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T00:42:51.533

我认为这里的关键词是“*我不希望任何人在我的类中添加 setter 属性。* ”

一般来说，如果你想写一个不可变的类，你应该将你的类标记为[密封](http://msdn.microsoft.com/en-us/library/88c54tsw.aspx)，并将所有字段标记为[只读](http://msdn.microsoft.com/en-us/library/acdd6hb7.aspx)。

* * *

当然，如果您希望人们从您的类继承，您必须考虑以下几点：

*   没有什么可以阻止一个人继承向您的类添加他们想要的任何属性。除非按照惯例，否则您不能对继承者强制执行该约束。

*   您*可以*使用反射进行运行时检查，以查看继承者是否添加了任何字段，但是我不建议这样做，因为它违反了一些封装的基本原则。

*   您不仅要检查班级中的二传手。一个人完全有可能编写像`setSomething`（Java 风格的 setter）这样的方法，或者编写具有改变内部值的副作用的方法。没有有效的方法来检查您的继承者是否没有使用类似的技巧在您的类中偷偷改变。

如果您允许人们继承您的课程，那么您实际上无法将您的课程保持为只读状态。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T00:19:53.950

```
 Type type = typeof(YourClass);
    PropertyInfo[] properties = type.GetProperties(BindingFlags.Instance);
    bool passesTest = true;
    foreach (PropertyInfo property in properties)
    {
        passesTest = passesTest && property.CanWrite;
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T00:32:44.517

将所有字段标记为*只读*怎么样？

# asp.net-mvc - 操作可能会破坏运行时：LinqToSQL

> ID：481886
> 
> 赞同：8
> 
> 时间：2009-01-27T00:03:18.570
> 
> 标签：asp.net-mvc, linq, linq-to-sql

尽管这是我见过的最好的错误消息之一（仅次于“此操作可能会破坏时空连续体中的租金”），但它也是最令人沮丧的错误消息之一。

我开发了一个 ASP.NET MVC 站点，它可以通过 VS2008 完美运行。它可以完美地托管在本地 IIS7 服务器（Win2008Server 和 Win7beta）上，也可以在另一台 Win2008Server 主机上运行。几天前，我将站点上传到新主机（Win2008Server），每当评估我的一个（且只有一个）LinqToSQL 语句时，就会遇到“操作可能破坏运行时稳定”错误。

有问题的 Linq 语句已被简化到晦涩难懂的程度，而且每当我评估结果时，都会发生错误：

```
var result = from e in db.calendarEvents select e;
foreach (var event in result)  // error occurs on this line
{
    ...
} 
```

有问题的远程主机在完全信任的情况下运行，并且看不到 switch 语句（这两个问题在谷歌上出现，与错误有关）。

Operation中报告了一个类似的问题，[可能会破坏运行时的稳定性？](https://stackoverflow.com/questions/378895/operation-could-destabilize-the-runtime)，但没有使用接口（我知道）。

有任何想法吗？

--- 暂停一下：有问题的表使用 TIME 数据类型，并映射到 TimeSpan 属性。显然，这仅在 .NET 3.5 SP1 中可用。我正在等待了解我的新主机是否安装了 SP1...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T03:49:05.743

好的，最终结果是我的主机在安装了 .NET 3.5（不是 SP1）的服务器上运行我的站点，并且使用 TIME SQL 数据类型的一个表因上述错误而中断。 [http://msdn.microsoft.com/en-us/library/bb386947.aspx](http://msdn.microsoft.com/en-us/library/bb386947.aspx)声明 LINQ to SQL 支持从 .NET 3.5 SP1 开始映射这些新类型。

我的主机好心地将我的站点迁移到 .NET 3.5 SP1 服务器，一切都很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T05:54:06.910

[事件](http://msdn.microsoft.com/en-us/library/8627sbea(VS.71).aspx)是一个关键字。请改用 @event 作为变量名。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T00:30:43.523

如果你这样做会发生什么

```
var result = (from e in db.calendarEvents select e).ToList();
foreach (var event in result)  // error occurs on this line
{
    ...
} 
```

以便在进入循环之前评估 SQL？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T03:59:35.207

可能值得更改此代码以获取数据，然后检查确保数组具有值。

```
dim result = (from e in db.calendarEvents).toArray
If not results is nothing andalso results.length > 0 then
   'Do Loop
End If 
```

如果 linq 查询没有返回任何内容，则可以避免尝试完成 for 循环的错误

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-03T20:18:59.800

在我看到发生此错误的过去实例中，这是由于尝试设置只读属性或字段的反射。由于 Linq2Sql 使用反射，我的猜测是这就是问题所在。您应该调查“e”是一个实例的类的类型定义。

确保属性位于正确的成员上。并注意 Linq2SQL 类中的只读。

# windows - Windows Server 2003 中的最大线程数是多少？

> ID：481900
> 
> 赞同：32
> 
> 时间：2009-01-27T00:12:56.380
> 
> 标签：windows, multithreading

有人知道吗？更大的问题是当你遇到这个最大值时会发生什么？这与其他 Windows 操作系统（如 Vista、XP 等）是否相同？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-27T00:21:26.380

首先，我建议阅读以下内容：http: [//blogs.msdn.com/oldnewthing/archive/2007/03/01/1775759.aspx](http://blogs.msdn.com/oldnewthing/archive/2007/03/01/1775759.aspx)

然后[http://blogs.msdn.com/oldnewthing/archive/2005/07/29/444912.aspx](http://blogs.msdn.com/oldnewthing/archive/2005/07/29/444912.aspx)

总而言之，限制通常是堆栈空间（必须在连续的块中），并且由于每个线程都会消耗这个分散在您周围的空间，因此您很快就会用完连续的块。在 64 位机器和操作系统上，这不是问题。

缓解策略存在，但只会走这么远（并且依赖于您每个线程不使用太多堆栈）

作为粗略的指南：

*   创造 10 几乎肯定会奏效
*   在当前的服务器和桌面硬件上可能有数百个，但有风险
*   成千上万的人几乎肯定会失败。

无论如何，您可能不需要创建超过十个（如果您确实**需要**，您应该已经知道此信息）

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-27T00:23:46.920

在提出此类问题时，我听到的最佳答案是：

> 没关系，如果你发现它确实很重要，你需要重新考虑你在做什么，这样它就无关紧要了。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-27T00:24:26.687

**请注意，如果您担心达到此限制，则应仔细检查您的设计！！！！！！！！！**

关于发生的事情的“更重要的问题”的答案是 OutOfMemoryException。

不完全是直接的答案，但这里有一些代码可以找出限制。不过，它可能取决于可用的内存。有兴趣查看其他 OS/cpu/mem 结果。

随意编辑和添加您的机器：

*   Windows 7、VS2008、双核、2gb 内存：1,465 然后因 OutOfMemoryException 而崩溃

    ```
     int i = 0;
        try
        {
            while (true)
            {
                new Thread(new ThreadStart(() => Thread.Sleep(int.MaxValue))).Start();
                i++;
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine(i);
            Console.WriteLine(ex.ToString());
        } 
    ```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T00:29:19.670

[请阅读ShuggyCoUk 的回答](https://stackoverflow.com/questions/481900/whats-the-maximum-number-of-threads-in-windows-server-2003#481919)所指向的 Raymond Chen 博客文章。

但要特别注意这一点：

> 但是，当有人问到“一个进程可以创建的最大线程数是多少？”时，真正的问题就会出现。是“你为什么要创建这么多线程，这甚至成为一个问题？”
> 
> “每个客户端一个线程”模型是众所周知的，它不会扩展到超过十几个客户端左右。如果您要同时处理多个客户端，您应该转移到一个模型，在该模型中，不是将线程专用于客户端，而是分配一个对象。（总有一天我会思考线程和对象之间的二元性。）Windows 提供 I/O 完成端口和线程池来帮助您从基于线程的模型转换为基于工作项的模型。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-03-10T04:24:10.123

默认堆栈大小为 1MB，在 32 位 Windows 操作系统下分配给 windows 进程的用户模式地址空间约为 2 GB。每个进程允许大约 2000 个线程（2000 * 1MB = 2GB）。对于 64 位，实际上不存在这样的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T00:22:22.760

据我了解整个线程模型自 Win2K 以来它应该没有太大变化。

线程本身没有真正的限制，但更多的是进程堆栈空间的限制。有关更多详细信息，请参阅Raymond Chen 对[线程限制的深入解释。](http://blogs.msdn.com/oldnewthing/archive/2005/07/29/444912.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-08-24T07:41:30.280

如果您坚持使用大量线程并需要扩展的现有设计，您还可以考虑使用光纤：

[http://msdn.microsoft.com/en-us/library/ms682661%28v=vs.85%29.aspx](http://msdn.microsoft.com/en-us/library/ms682661%28v=vs.85%29.aspx)

它可以为您节省全面的重新设计。

Indy 考虑将它用于 Indy 10，但它从未发生，因为 .NET 冒险似乎消耗了大部分时间。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-08-18T19:40:05.047

问题似乎很老，但喜欢添加也可以对其他人有所帮助：

这篇文章是关于：推动 Windows 的极限：进程和线程

[http://blogs.technet.com/b/markrussinovich/archive/2009/07/08/3261309.aspx](http://blogs.technet.com/b/markrussinovich/archive/2009/07/08/3261309.aspx)

# c# - 如何确定一个类在 C# 中是否不可变？

> ID：481909
> 
> 赞同：16
> 
> 时间：2009-01-27T00:18:07.773
> 
> 标签：c#, immutability

如何确定一个类在 C# 中是否不可变？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-01-27T00:43:58.330

有`ImmutableObjectAttribute`，但是很少使用并且支持很差-当然也没有强制执行（您可以用`[ImmutableObject(true)]`.AFAIK 标记可变对象，这影响的唯一事情是 IDE 处理属性的方式（即显示/不显示命名属性选项）。

实际上，您必须检查`FieldInfo.IsInitOnly`，但这仅适用于真正的 100% 不可变类型（假设没有反射滥用等）；它无助于冰棒的不变性，也无助于在实践中不可变的事物，但在其实现中却无济于事；即它们不能公开可变，但理论上对象支持它。

这里的一个经典例子是字符串......每个人都“知道”它`string`是不可变的......当然，`StringBuilder` **确实会**在引擎盖下改变一个字符串。不，说真的……

鉴于此，很难定义不变性，更不用说稳健地检测它了......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T00:43:12.937

部分问题在于“不可变”可以有多种含义。以 ReadOnlyCollection<T> 为例。

我们倾向于认为它是不可变的。但如果它是 ReadOnlyCollection<SomethingChangeable> 怎么办？此外，由于它实际上只是我传递给构造函数的 IList 的包装器，如果我更改原始 IList 怎么办？

一个好的方法可能是创建一个名称类似于 ReadOnlyAttribute 的属性，并用它标记您认为是只读的类。对于您无法控制的类，您还可以维护您认为不可变的已知类型的列表。

编辑：有关不同类型不变性的一些很好的例子，请阅读 Eric Lippert 的这一系列帖子：http: [//blogs.msdn.com/ericlippert/archive/2007/11/13/immutability-in-c-part-one -kinds-of-immutability.aspx](http://blogs.msdn.com/ericlippert/archive/2007/11/13/immutability-in-c-part-one-kinds-of-immutability.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T00:34:43.327

你不能，你只能猜测。如果所有字段都是只读的，那么一旦构造函数完成，实例将是不可变的。这很重要，如果您有以下内容，它将在实例栏中显示为可变的。

```
class Foo
{
    public readonly int X
    public readonly int Y
    public Foo(int x, int y, Bar bar)
    {
        this.X = x; 
        bar.ShowYourself(this);
        this.Y = y;
        bar.ShowYourself(this);
    }
} 
```

但是，如果假定不可变类上的字段是一个集合（并且不是只读的），那么调用不可变类可能是不正确的（因为它的状态可以改变）

请注意，即使所有字段都是只读的，反射也允许修改字段。

检查属性上没有设置器确实是一种非常糟糕的启发式方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T00:19:12.703

据我所知，除非明确记录，否则无法确定 C# 中的类是否不可变。

但是，您可以使用反射来检查属性上是否存在 Setter；但是，缺少 setter 并不能保证不变性，因为内部状态可能会更改这些属性的值，无论您是否可以显式设置它们。

此外，再次使用反射检查所有类字段的“IsInitOnly”标志可能表明不变性，但不能保证这一点。

编辑：[这里有一个类似的问题](https://stackoverflow.com/questions/203475/how-do-i-identify-immutable-objects-in-java)，询问关于 Java 语言的问题，其答案也适用于此处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T00:20:36.630

您从运行时获得的唯一帮助是类中的所有字段是否都用“只读”注释。[编辑，见@ShuggyCoUk] 即使这样，CLR 也会让你重写它。我刚刚验证过了。啊。

您可以通过反射从类中获取 FieldInfo 对象并检查 IsInitOnly。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T00:42:58.863

通过代码，我不确定，但是如果您查看另一种不可变类型的 IL，例如字符串，您将**看**不到`newobj`IL 指令（您将看到 ldstr 用于字符串），可能会检查创建的 IL可能是一种说法，只是猜测......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-02-22T19:48:53.553

**需要您自担风险使用它。** 这在类的循环依赖的情况下不起作用（尽管对其进行修改可能会起作用），并且它可能会给出**错误的否定**结果（即，如果它返回 true 则意味着该类肯定是不可变的，但如果它返回 false 它可能或者可能不是一成不变的）。但它应该适用于大多数情况，除了非常复杂的类。

```
using System.Reflection;
public static class StructUtils
{

    public static bool IsImmutable(Type type, int depth = 5)
    {
        if (type == typeof(string) || type.IsValueType)
        {
            return true;
        }
        else if (depth == 0)
        {
            return false;
        }
        else
        {
            return type.GetFields()
                .Where(fInfo => !fInfo.IsStatic) // Filter out statics
                .Where(fInfo => fInfo.FieldType != type) // Filter out 1st level recursion
                .All(fInfo => fInfo.IsInitOnly && IsImmutable(fInfo.FieldType, depth - 1)) &&
                type.GetProperties()
                   .Where(pInfo => !pInfo.GetMethod.IsStatic) // Filter out statics
                   .Where(pInfo => pInfo.PropertyType != type) // Filter out 1st level recursion
                   .All(pInfo => !SetIsAllowed(pInfo, checkNonPublicSetter: true) && IsImmutable(pInfo.PropertyType, depth - 1));
        }
    }

    private static bool SetIsAllowed(PropertyInfo pInfo, bool checkNonPublicSetter = false)
    {
        var setMethod = pInfo.GetSetMethod(nonPublic: checkNonPublicSetter);
        return pInfo.CanWrite &&
               ((!checkNonPublicSetter && setMethod.IsPublic) ||
                (checkNonPublicSetter && (setMethod.IsPrivate || setMethod.IsFamily || setMethod.IsPublic || setMethod.IsAbstract)));
    }
} 
```

我用于测试的一些示例类：

```
public class Z
{
    private readonly List<string> _s;
    public int F { get; }
    public readonly string K;
    public const int Pi = 3;
    public Z NextPtr { get; }
}

public class X
{
    public Z Z { get; }
    public readonly int C;
    public string Cmp { get; }
}

public class W
{
    public X Z { get; }
    public readonly List<int> C1;
    public readonly string Cmp1;
} 
```

得到以下结果：

```
> StructUtils.IsImmutable(typeof(Z))
true
> StructUtils.IsImmutable(typeof(X))
true
> StructUtils.IsImmutable(typeof(W))
false 
```

# javascript - Javascript帮助翻车是翻车

> ID：481922
> 
> 赞同：0
> 
> 时间：2009-01-27T00:22:06.393
> 
> 标签：javascript, rollovers

我已经在 javascript 中开始了这个，所以我不想使用 jquery，但是一些javascript专家可以查看我的代码并告诉我我在做什么错或对吗？让我告诉你我想在这里完成什么。我有一个由四个按钮组成的菜单，当您将鼠标悬停在它们上时，它们会改变颜色，然后当您将鼠标悬停在标题上时，会在标题图像下方显示，按钮应返回其原始颜色，然后在标题下方出现另一个包含一些文本的图像。在大多数情况下，代码工作正常，除了在 Firefox 中，有时标题会四处移动，我假设这是因为当可见时文本图像不存在，所以标题落在文本所在的位置，我没有IE中的这个问题。最大的问题是onmouseout。我不

这是代码：

```
window.onload = rollover;
function rollover()
var images = document.getElementsByTagName("img"); // Get all the images in the document
var roll = new RegExp("roll");
var preload = [];
var fileLoc = "images/rollovers/";
for ( var i=0; i<images.length; i++) 
{
    if (images[i].id.match(roll)) // Loop through all the images in document and look for match on 'roll'
    {
        preload[i] = new Image();
        preload[i].src = fileLoc + images[i].id + "_over.gif"; // Preload the _overs into an array.
        images[i].onmouseover = function()  // Add a mouseover event to image
        {
            this.src = fileLoc + this.id + "_over.gif"; // When rolled over, this file now equals the _over image
            var currentButton = this.id; // Grab the id of the current image
            var imageHeader = document.getElementById("current_title"); //Grab all images that are titled 'current_title'
            var newHeaderImage = new Image();
            newHeaderImage.src = fileLoc + currentButton + "_header.gif"; // Create new image and store _Header image inside
            newHeaderImage.id = currentButton + "_header"; //New id for new image is file + headerId
            imageHeader.src = newHeaderImage.src;
            imageHeader.height = newHeaderImage.height; // Assign header image id to currect location
            imageHeader.width = newHeaderImage.width;
            imageHeader.style.visibility = "visible";
            imageHeader.onmouseover = function() // Attach mouse event for header image
            {
                var imageText = document.getElementById("button_text");
                var newTextImage = new Image();
                newTextImage.src = fileLoc + currentButton + "_text.gif";
                imageText.src = newTextImage.src;
                imageText.height = newTextImage.height;
                imageText.width = newTextImage.width;
                imageText.style.visibility = "visible";

            }

        }
        //images[i].onmouseout = setTimeout(mouseOut(fileLoc, this.id),3000);
    }
    } 
```

}

```
/*function mouseOut(fileLoc, curButton) 
```

{

```
var titleImg = document.getElementById("current_title");
var imgButton = curButton;
this.src = fileLoc + imgButton + "_org.gif";

titleImg.style.visibility = "hidden"; 
```

}*/

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T00:41:10.990

好吧，咬紧牙关，让我们看看这如何影响我的代表:-)。

这不是您想要的答案，而是停止。

备份。下载一个 JS 库（比如 jQuery），然后重启。

您的生活会更轻松，您将有更多时间与家人和朋友共度时光，并且每当您必须在这里提出更多问题时，您的脾气就会变得不那么暴躁（相信我，这种情况会减少:-)。

您必须咨询 JS 专家的建议这一事实应该向您表明您的做法是错误的。相信我，所有的 JS 专家都已经在使用 JS 库了，因为他们已经面临过诸如跨浏览器兼容性和其他此类痛苦问题之类的所有问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T12:50:35.807

好的，这是一个不使用库的有效脚本（至少在 ie 和 firefox 中）。
使用库显然会使这段代码更加简洁。

```
window.onload = createRollover;

function createRollover() {
    var button;
    var imgPath = 'img/';
    var container = document.getElementById( 'ro_container' );
    var buttonContainer = document.getElementById( 'ro_buttons' );
    var headerContainer = document.getElementById( 'ro_header' );
    var textContainer = document.getElementById( 'ro_text' );
    var buttons = buttonContainer.getElementsByTagName( 'img' );

    container.onmouseout = rollOut;

    // set up the element hierarchy
    for( var i = 0; i < buttons.length; i++ ) {
        button = buttons[i];
        button.onmouseover = buttonRollover;
        button.up =  document.createElement( 'img' );
        button.up.src = imgPath+button.id+'.gif';
        button.over =  document.createElement( 'img' );
        button.over.src = imgPath+button.id+'_over.gif';
        button.header = document.createElement( 'img' );
        button.header.src = imgPath+button.id+'_header.gif';
        button.header.onmouseover = headerRollover;
        button.header.text =  document.createElement( 'img' );
        button.header.text.src = imgPath+button.id+'_text.gif';
    }

    function buttonRollover() {

        //do nothing if this button is already active
        if( this.src == this.over.src ) return;

        //reset all the buttons and set this one to over
        for( var i = 0; i < buttons.length; i++ ) {
            buttons[i].src = buttons[i].up.src;
        }
        this.src = this.over.src;

        //see what's in the header div and do the header thing
        var h = headerContainer.getElementsByTagName( 'img' );
        if( h.length > 0 ) {
            headerContainer.replaceChild( this.header, h[0] );
        } else {
            headerContainer.appendChild( this.header );
        }
        //clear the text div
        textContainer.innerHTML = '';
    }

    function headerRollover() {
        //see what's in the text div and do the thing
        var t = textContainer.getElementsByTagName( 'img' );
        if( t.length > 0 ) {
            textContainer.replaceChild( this.text, t[0] );
        } else {
            textContainer.appendChild( this.text );
        }
    }

    function rollOut( e ) {
        //mouseouts take a bit of work
        //that's one of the reasons why we like libraries
        e = e || window.event;
        var onto = e.relatedTarget || e.toElement;
        // we'll cancel this event if we've rolled on to an element
        // that is a child of this one.
        // traverse up the tree looking for 'this' or the document
        while( onto != this && onto != document ) {
            onto = onto.parentNode;
        }
        if( onto == this ) {
            //false alarm, it was a child of 'this'
            return; 
        }
        // reset
        for( var i = 0; i < buttons.length; i++ ) {
            buttons[i].src = buttons[i].up.src;
        }
        headerContainer.innerHTML = '';
        textContainer.innerHTML = '';
    }
} 
```

和标记

```
<div id="ro_container">
    <div id="ro_buttons">
        <img src="img/but1.gif" id="but1"/>
        <img src="img/but2.gif" id="but2"/>
        <img src="img/but3.gif" id="but3"/>
    </div>
    <div id="ro_header"></div>
    <div id="ro_text"></div>
</div> 
```

我使用了与您相同的图像命名系统（我认为）：

```
but1.gif, but1_over.gif, but1_header.gif, but1_text.gif  
but2.gif.... 
```

希望这可以帮助

# sharepoint - 从 SharePoint 返回的用户配置文件对于 UserID 没有任何内容

> ID：481929
> 
> 赞同：0
> 
> 时间：2009-01-27T00:28:25.943
> 
> 标签：sharepoint, events, logging

我在共享点的应用程序事件日志中收到以下异常：

```
Exception Type: System.Exception
Message: User profile returned from SharePoint as Nothing for UserID 'S-1-5-21-59715478-2608859843-3034944815-2139'.
Data: System.Collections.ListDictionaryInternal
TargetSite: NULL
HelpLink: NULL
Source: NULL 
```

解决办法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-15T02:02:23.263

这对应于 Active Directory 中已从组中删除或已禁用的用户。这真的没有“修复”。只需确保在执行此操作时不要将网站集或所有者保留为空。

文档和体系结构对 SharePoint 非常重要的另一个原因！

# c++ - 如何检查容器是否支持多个连接？

> ID：481931
> 
> 赞同：1
> 
> 时间：2009-01-27T00:28:55.303
> 
> 标签：c++, visual-studio-2008, com, connection-points

*   实现了**接收**器类 - 接收来自 COM 服务器的事件通知
*   事件接口派生自**IDispatch**

我有一个问题，即**IConnectionPoint::Advise**调用返回**E_NOTIMPL**。这可能是因为**连接点**只允许一个连接 - [MSDN](http://msdn.microsoft.com/en-us/library/ms694318(VS.85).aspx)。

笔记：

*   COM 服务器在进程外
*   纯 C++ 实现

## 编辑：

**S8.tlh**：Win32 类型库 S8.tlb 的 C++ 源代码等效项：

```
struct __declspec(uuid("090910c3-28c3-45fe-861d-edcf11aa9788"))
IS8SimulationEvents : IDispatch
{

    // Methods:
    HRESULT S8SimulationReset ( );
    HRESULT S8SimulationEndRun ( );
    HRESULT S8SimulationCustomEvent (
        BSTR * TextInfo );
    HRESULT S8SimulationOpened ( );
    HRESULT S8SimulationEndTrial ( );
    HRESULT S8SimulationOEMEvent (
        BSTR * TextInfo );
    HRESULT S8SimulationReadyToClose ( );
    HRESULT S8SimulationUserMessage (
        long * Answer,
        BSTR * TextMsg,
        long ValidAnswers );
}; 
```

**Class** Sink的实现——处理事件通知：

```
class Sink : public IS8SimulationEvents
{
public:
Sink(){
    m_dwRefCount = 0;
};
~Sink(){};
/*
* IS8SimulationEvent interface functions
*/
HRESULT S8SimulationEndTrial()
{
    cout << "Simulation complete." << endl;
    return S_OK;;
};

HRESULT S8SimulationOpened()
{
    cout << "Simulation open." << endl;
    return S_OK;
};

HRESULT S8SimulationReadyToClose()
{
    cout << "Simulation ready to close" << endl;
    return S_OK;
};

ULONG STDMETHODCALLTYPE AddRef()
{
    m_dwRefCount++;
    return m_dwRefCount;
};

ULONG STDMETHODCALLTYPE Release()
{
    ULONG l;
    l = m_dwRefCount--;

    if (0 == m_dwRefCount)
    {
        delete this;
    }

    return m_dwRefCount;
};

HRESULT STDMETHODCALLTYPE QueryInterface(
                                        REFIID iid ,
                                        void **ppvObject)
{
    m_dwRefCount++;
    *ppvObject = (void *)this;
    return S_OK;
};

HRESULT STDMETHODCALLTYPE GetTypeInfoCount(UINT *pctinfo)
{
    return E_NOTIMPL;
};

HRESULT STDMETHODCALLTYPE GetIDsOfNames( 
                                        REFIID riid,
                                        LPOLESTR *rgszNames,
                                        UINT cNames,
                                        LCID lcid,
                                        DISPID *rgDispId)
{
    return E_NOTIMPL;
};

HRESULT STDMETHODCALLTYPE GetTypeInfo(
                                    unsigned int iTInfo,
                                    LCID lcid,
                                    ITypeInfo FAR* FAR* ppTInfo)
{
    return E_NOTIMPL;
};

HRESULT STDMETHODCALLTYPE Invoke(
                                DISPID dispIdMember,
                                REFIID riid,
                                LCID lcid,
                                WORD wFlags,
                                DISPPARAMS FAR* pDispParams,
                                VARIANT FAR* pVarResult,
                                EXCEPINFO FAR* pExcepInfo,
                                unsigned int FAR* puArgErr)
{
    HRESULT hresult = S_OK;
    if (pDispParams)
    {
        switch (dispIdMember) {
        case 1:
            return S8SimulationEndTrial();
        case 2:
            return S8SimulationOpened();
        case 3:
            return S8SimulationReadyToClose();
        default:
            return E_NOTIMPL;
        }

    }
    return E_NOTIMPL;
}
private:
    DWORD m_dwRefCount;
public:
void SetupConnectionPoint (IS8Simulation *pis8)
{

    HRESULT hresult;
    IConnectionPointContainer *pContainer = NULL;
    IConnectionPoint *pConnection = NULL;
    IUnknown *pSinkUnk = NULL;
    Sink *pSink = NULL;
    DWORD dwAdvise;

    dwAdvise = 0;

    hresult = pis8->QueryInterface(
                        __uuidof(IConnectionPointContainer),
                        (void **) &pContainer);

    if (SUCCEEDED(hresult))
    {
        cout << "IConnectionPointContainer inteface supported." << endl;
    } else {
        cerr << "Error: No such interface supported." << endl;
        exit (hresult);
    }

                                    __uuidof(IS8SimulationEvents),
                                    &pConnection); 

    switch (HRESULT_CODE(hresult)) {
        case NOERROR:
            cout << "Obtained valid interface pointer." << endl;
            break;
        case E_POINTER:
            cerr << "Invalid pointer: the address is not valid." << endl;
            exit (hresult);
            break;
        case CONNECT_E_NOCONNECTION:
            cerr << "This connectable object not support the "
                    "outgoing interface specified." << endl;
            exit (hresult);
            break;
        case E_UNEXPECTED:
        default:
            cerr << "Catastrophic failure." << endl;
            exit (hresult);
            break;
    }

    pContainer->Release();

    hresult = pSink->QueryInterface(
                            __uuidof(IUnknown),
                            (void **)&pSinkUnk);

    if (FAILED(hresult))
    {
        exit (EXIT_FAILURE);
    }

    hresult = pConnection->Advise(
                            pSinkUnk,
                            &dwAdvise);

    switch (HRESULT_CODE(hresult)) {
        case NOERROR:
            cout << "The connection has been established and "
                    "*dwAdvise has the connection token." << endl;
            break;
        case E_POINTER:
            cerr << "Invalid pointer: "
                    "the value pSinkUnk or dwAdvise is not valid." << endl;
            exit (hresult);
            break;
        case CONNECT_E_ADVISELIMIT:
            cerr << "The connection point has already reached "
                    "its limit of connections and cannot accept "
                    "any more." << endl;
            exit (hresult);
            break;
        case CONNECT_E_CANNOTCONNECT:
            cerr << "The sink does not support the interface "
                    "required by this connection point." << endl;
            exit (hresult);
            break;
        case E_NOTIMPL:
            break;
            case E_UNEXPECTED:
            default:
        cerr << "Catastrophic failure." << endl;
        exit (hresult);
        break;
    }
    return;
}
}; 
```

## 编辑：

**Sink**类中**IUnknown**接口的实现

 **```
ULONG STDMETHODCALLTYPE AddRef()
{
    m_dwRefCount++;
    return m_dwRefCount;
};

ULONG STDMETHODCALLTYPE Release()
{
    ULONG l;
    l = m_dwRefCount--;

    if (0 == m_dwRefCount)
    {
        delete this;
    }

    return m_dwRefCount;
};

HRESULT STDMETHODCALLTYPE QueryInterface(REFIID iid, void **ppvObject)
{
    m_dwRefCount++;
    *ppvObject = (void *)this;
    return S_OK;
}; 
```

**问题：**

*   如何检查容器是否支持多个连接？
*   如果需要更多信息，请相应评论。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T01:39:49.170

请再次阅读 MSDN 文章。

```
仅允许一个接口的连接点可以从IConnectionPoint::EnumConnections 方法
 返回 E_NOTIMPL
枚举连接：E_NOTIMPL
连接点不支持枚举。

```

IConnectionPoint::Advise 需要回复

CONNECT_E_ADVISELIMIT

当他的连接点已经达到其连接限制并且不能再接受时。

--

迈克尔

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T20:40:34.743

AtlAdvise 应该使连接点在事件接收器上调用 QI。您无法确定它会调用 QI 或调用 QI 的次数。

建议：在eventsink中参考类似这样的东西来判断是否查询到了正确的事件接口。

```
void GuidToString(PTCHAR s, LPGUID piid )
{
_stprintf(s, _T("{%08x-%04x-%04x-%02x%02x-%02x%02x%02x%02x%02x%02x}"),
    piid->Data1, piid->Data2,
    piid->Data3,
    piid->Data4[0], piid->Data4[1],
    piid->Data4[2], piid->Data4[3],
    piid->Data4[4], piid->Data4[5],
    piid->Data4[6], piid->Data4[7]);
    // Outputdebugstr (s)
} 
```

事件接收器`QueryInterface`也应该做类似的事情

```
if (iid == IID_IUnknown || iid == IID_AppEvents)
     *ppObj = (AppEvents*)this; 
```

所以它只返回**正确**的接口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T01:33:45.667

当 Advise 调用被调用时，COM 库为 IUnknown、IMarshall 等许多接口调用 QI。

正如 Michael 在 MSDN 文章中指出的那样，它说它只为 EnumConnections API 而不是 Advise 返回 E_NOTIMPL。我怀疑 QI 返回 E_NOTIMPL。因此，请尝试跟踪 Advise API。你会知道 QI 的失败。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T13:57:58.797

## 解决了：

*   使用**纯 C++**
*   无 ATL

使用以下**QI****实现**：

 **```
HRESULT STDMETHODCALLTYPE QueryInterface(REFIID iid, void **ppvObject)
{
    if (iid == __uuidof(IUnknown) || iid == __uuidof(IS8SimulationEvents))
    {
        *ppvObject = (IS8SimulationEvents*)this;
    } else {
        *ppvObject = NULL;
        return E_NOINTERFACE;
    }
    m_dwRefCount++;
    return S_OK;
}; 
```

# resources - 计算机硬件和组织简介：资源？

> ID：481934
> 
> 赞同：7
> 
> 时间：2009-01-27T00:29:38.297
> 
> 标签：resources, hardware

我正在寻找外行对计算机硬件和组织的介绍。以下是我想讨论的一些主题。

> 1.  电子产品简介。
>     
>     
> 2.  门和状态机，介绍寄存器传输和计时。
>     
>     
> 3.  基本的 CPU 设计。控制。
>     
>     
> 4.  微程序 CPU 设计。
>     
>     
> 5.  缓存系统。
>     
>     
> 6.  内存层次结构：寄存器、缓存、RAM
>     
>     
> 7.  虚拟内存组织。
>     
>     
> 8.  磁盘存储系统。
>     
>     
> 9.  内部总线 - 前端、内存、PCI
>     
>     
> 10.  用于存储-IDE、SATA、SCSI 的内部总线
>     
>     
> 11.  外部总线-USB 和火线
>     
>     
> 12.  显示系统和 GPU

我更喜欢在线免费资源，但如果没有可用的书籍，也可以。我没有硬件背景，所以介绍性文字会很棒。如果这不是直接编程，我也很抱歉，但我不知道还能问哪里。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T00:57:47.150

如前所述，《代码：计算机硬件和软件的隐藏语言》是一本涵盖基础知识的好书。

以下是其他几本书：

[计算机体系结构：一种定量方法](https://rads.stackoverflow.com/amzn/click/com/1558605967)

[计算机组织和架构的精髓](https://rads.stackoverflow.com/amzn/click/com/076370444X)

[升级和维修电脑](https://rads.stackoverflow.com/amzn/click/com/0789736977)

这是一个很好的网站：

[个人电脑架构](http://www.karbosguide.com/books/pcarchitecture/start.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T00:40:15.483

我会推荐Charles Petzold的[《代码》一书。](https://rads.stackoverflow.com/amzn/click/com/0735611319)从外行的角度来看，它涵盖了很多计算机的低级工作方式。并非您列表中的所有内容都包括在内，但它会给您一个良好的开端。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T15:48:29.487

[霍洛维茨和希尔的电子艺术对于电子](http://www.amazon.com/exec/obidos/tg/detail/-/0521370957/ref=ase_penguintelecomin/102-8353601-4848123?v=glance&s=books%22The%20Art%20of%20Electronics%22)爱好者来说是一本很棒的书。

对于计算机体系结构[计算机组织和设计：硬件/软件接口](http://www.amazon.com/exec/obidos/tg/detail/-/1558604286/ref=ase_penguintelecomin/102-8353601-4848123?v=glance&s=books/)

[用于可编程逻辑](http://www.amazon.com/exec/obidos/tg/detail/-/0201895730/ref=ase_penguintelecomin/102-8353601-4848123?v=glance&s=books)的 RTL 设计VHDL

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T01:00:22.073

Tanenbaum 的[结构化计算机组织](https://rads.stackoverflow.com/amzn/click/com/0131485210)是我对计算机“层次”的介绍。这是非常合乎逻辑的，接近建立在前一个层次上的每个层次。

我经常想做一个类似的，从量子物理学延伸到经典物理学、电子学、集成电路、微码、机器代码、编译器、解释器、VM 等等，但我担心这会尽可能像 Knuth 的 12 -卷系列。我希望他有一个孩子可以继续工作:-)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-06T01:33:21.790

对于计算机体系结构，这本书真的很好

[并行计算机组织与设计](http://www.cambridge.org/ca/academic/subjects/engineering/computer-engineering/parallel-computer-organization-and-design)

# wpf - Silverlight 代码对 WPF 的可移植性如何？

> ID：481935
> 
> 赞同：7
> 
> 时间：2009-01-27T00:30:10.903
> 
> 标签：wpf, silverlight

在 Silverlight 中，我注意到代码隐藏的 Page 类继承自 UserControl：

```
public partial class Page : UserControl 
```

在 WPF 中，代码隐藏的 Page Class 继承自 Page：

```
public partial class Page1 : Page 
```

我在想 Silverlight 作为 WPF 的一个子集，您以后可以将大块 Silverlight 代码复制到 WPF 中，反之亦然。但在这样一个基本层面上的差异表明情况并非如此。

这只是一种异常情况，还是复杂的 Silverlight 应用程序在没有重大更改的情况下几乎无法移植到 WPF？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T00:43:27.333

看看[这篇文章](http://blog.kkrankk.com/2008/04/porting-silverlight-20-to-wpf.html)，它谈到了从 SL 移植到 WPF 需要做的许多事情。那篇文章中还有一个链接到 Scott Gu 关于这个主题的博客；然而，这篇文章谈到了 The Gu 的博客上没有提到的一些差异。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T00:47:30.790

我理解它的方式是，除了使用 XAML 之外，Silverlight 和 WPF 本质上是不同的。不过，它们之间似乎确实存在交叉授粉，因此当 Silverlight 发布时没有像 WrapPanel 这样的东西，有人在 Silverlight 中编写了自己的实现（最终被添加到 Silverlight 工具包中）。

不要期望从 WPF 复制和粘贴，除非它是微不足道的代码。Silverlight 中的数据绑定等内容略有不同（例如：不绑定到其他元素）。不过，大多数时候都有解决方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T00:49:30.803

Silverlight 被设计为 WPF 的兼容子集（至少在它“有意义”的地方）。这意味着将应用程序从 Silverlight 移植到 WPF 应该相对简单。朝另一个方向发展（WPF -> Silverlight）可能更具挑战性。

您在问题中给出的示例说明了这一点；Silverlight 中不存在默认 WPF 项目模板中使用的 Page 类。但是两者都存在 UserControl 类。因此，您可以将派生自 UserControl 的 Silverlight 应用程序中的 xaml 和代码复制并粘贴到您的 WPF 应用程序中，而不会出现任何问题。

Silverlight 的某些部分与 WPF 并不真正兼容，例如所有 HTML DOM Bridge 内容在 WPF 应用程序中没有任何意义，所以它不存在。MediaElement 类也有很大不同。

# python - Python 与 Wiimote 使用 pywiiuse 模块

> ID：481943
> 
> 赞同：3
> 
> 时间：2009-01-27T00:33:04.593
> 
> 标签：python, wiimote, wii

在看到 wiimotes 的能力和可破解性之后，我真的很想在我的“编程入门”决赛中使用它。每个人都必须制作一个 Python 程序并提交给全班同学。

我想用 pygame 制作一个包含 wiimote 的游戏。我发现[pywiiuse](http://sourceforge.net/project/showfiles.php?group_id=82407&package_id=259597)是使用 c 类型的[wiiuse](http://www.wiiuse.net/)库的一个非常基本的包装器。

除了 LED 和振动工作之外，我什么也得不到。按钮，红外线，运动感应，什么都没有。我尝试过不同版本的wiiuse、pywiiuse，甚至python。我什至无法运行它附带的示例。这是我作为简单测试制作的代码。我复制了一些示例 C++ 代码。

```
from pywiiuse import *
from time     import sleep

#Init
wiimotes = wiiuse_init()

#Find and start the wiimote
found    = wiiuse_find(wiimotes,1,5)

#Make the variable wiimote to the first wiimote init() found
wiimote  = wiimotes.contents

#Set Leds
wiiuse_set_leds(wiimote,WIIMOTE_LED_1)

#Rumble for 1 second
wiiuse_rumble(wiimote,1)
sleep(1)
wiiuse_rumble(wiimote,0)

#Turn motion sensing on(supposedly)
wiiuse_motion_sensing(wiimote,1)

while 1:
    #Poll the wiimotes to get the status like pitch or roll
    if(wiiuse_poll(wiimote,1)):
        print 'EVENT' 
```

这是我运行它时的输出。

```
wiiuse version 0.9
wiiuse api version 8
[INFO] Found wiimote [assigned wiimote id 1].
EVENT
EVENT
Traceback (most recent call last):
  File "C:\Documents and Settings\Nick\Desktop\wiimotetext.py", line 26, in <mod
ule>
    if(wiiuse_poll(wiimote,1)):
WindowsError: exception: access violation reading 0x00000004 
```

似乎每次我运行它时，它都会打印出 EVENT 2-5 次，直到回溯。我现在不知道该怎么做，过去两天我一直在努力让它工作。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-10-23T03:23:01.770

我更新了 pywiiuse 包装器。它似乎不是为最新版本的wiiuse（在这个答案时为0.12）制作的，因为其中大部分在当前迭代中都不起作用。

我在这里发布了包和一些示例脚本： [http ://code.google.com/p/pywiiuse/downloads/list](http://code.google.com/p/pywiiuse/downloads/list)

你也应该能够做到

```
easy_install wiiuse 
```

因为我也在 pypi 上托管了它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-04T03:25:10.633

我知道你的课现在已经结束了，但是对于其他人来说，cwiid 真的很好。像这样安装在Ubuntu中：

```
apt-get install libcwiimote-dev python-cwiid 
```

或者从[github](http://github.com/abstrakraft/cwiid)获取最新信息。

读取 wiimote 传感器（如加速度计的音高）非常容易：

```
import cwiid
print 'place wiimote in discoverable mode (press 1 and 2)...'
wiimote = cwiid.Wiimote()
wiimote.rpt_mode = cwiid.RPT_ACC
#wiimote.state dict now has an acc key with a three-element tuple
print 'pitch: %d' % (wiimote.state['acc'][cwiid.Y]) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-27T06:44:36.727

I've been working with [wiimotelib](http://wiimotelib.codeplex.com/) for .NET and it is pretty stable. And contains also wii remote extensions like nunchcuk and other.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T19:49:05.873

近两天来一直在寻找 Wiimote 的一组 Python 包装器，这是我对最新技术的总结：

pywiimote（来自谷歌）：大约完成了一半，当我下载最新版本（r52）时没有编译，有一些不错的想法，但需要大量投资才能开始工作。

pywiiuse（上图）：理论上不错，

cwiid：未积极开发，仅适用于 Linux（无法在 Cygwin 下编译）。

总之——现在没有现成的东西（2009 年 3 月 24 日）。会继续调查...

——布莱恩

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-29T17:47:14.587

对于那些仍在寻找的人，我发现并记录了一种使用 lightblue 库将 Wii Remote 与 python 配对的简单方法。我在 OS X 上对其进行了测试，但它应该可以跨平台工作（即在 Linux 上）

这是我的文章：http: [//smus.com/prototyping-wii-remote-python/](http://smus.com/prototyping-wii-remote-python/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T18:12:56.200

我建议您看一下 Uwe Schmidt 的 WiimoteWhiteboard Java 版本，这可能会漏掉重点

[http://www.uweschmidt.org/wiimote-whiteboard](http://www.uweschmidt.org/wiimote-whiteboard)

它使用用于 Java 的 WiiRemoteJ 库。

我过去曾尝试使用 Python 实现但未成功，因为它们要么不完整，要么不起作用。也许通过检查 Schmidt 在 Java 中的工作版本，您可以确定 Python 中缺少什么。

祝你的课好运。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-23T18:45:22.600

Change your python version to 2.5.2 I believe it will work now

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T00:48:39.943

[pywiimote](http://code.google.com/p/pywiimote/) on Google Code 可能会有所帮助，如果您找到的库对您失败...如果您有时间，请尝试一下。

不过，这似乎是一个相当新的产品，而且可能不会更好。

祝你好运！

# sql-server - SQL server DB 已恢复。登录失败错误

> ID：481954
> 
> 赞同：6
> 
> 时间：2009-01-27T00:38:34.020
> 
> 标签：sql-server

我已将一个数据库恢复到我的 SQL 服务器。我有一个正在访问数据库的 ASP 程序。当我运行它时，我收到一个错误，该用户登录失败。我到底该怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T00:56:51.083

很可能登录名，即使它存在于新服务器上，也不相同。登录信息使用每个服务器唯一（通常）的 SID 存储。如有必要，有一些方法可以传输登录 SIDS，但您也可以简单地向新服务器上的新登录名/用户授予对数据库中对象的权限。

这是转移登录名的链接。[http://support.microsoft.com/kb/246133](http://support.microsoft.com/kb/246133)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T01:09:48.967

数据库*用户*不同于 SQL Server*登录。**登录名* 可以访问服务器，并且在几乎所有情况下，还链接到对一个或多个数据库具有特定权限的用户帐户。在您的情况下发生的事情是用户仍然存在于数据库中（因为当您恢复数据库时它就在那里）但不存在 - 作为登录 - 在服务器上。也就是说，没有与它们关联的登录，因为登录*不会*通过数据库恢复来恢复。

当我将数据库移动到新服务器时，我通常只是从恢复的数据库中删除用户，然后创建一个登录名。为此，您将首先*在数据库级别*的“安全”选项卡下创建您的登录名。接下来，只需使用“登录设置”对话框中的“用户映射”页面，即可在适合的任何数据库中自动创建关联的用户帐户。这也是您分配特定权限的地方。

**但是**，有一个问题：您可能无法从数据库中删除用户。当用户“拥有”数据库中的模式或其他对象时，就会发生这种情况。在这种情况下，您要么必须使用 Palehorse 的链接获取更多说明（我忘记了我脑海中的命令），要么您必须重置架构/对象以使用 dbo。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T03:12:24.007

If it is a SQL Server-based login and you restored the database to a DIFFERENT SQL Server than where it was originally on, then palehorse's answer is the way to transfer logins. If the original SQL Server is not available, then you can create a SQL Server login on the new SQL Server and use sp_change_users_login to sync up the login and the user. Books Online covers how to do this.

If the login was a Windows domain account and you changed SQL Servers, then you should be able to just add the login to the new SQL Server and the login and user will sync up. The SID within SQL Srver for a Windows-based login comes from the SID of the account at the server or domain level.

If you restored back to the same SQL Server, then check to see if the default database for the login is valid. The login is stored in the master database, so restoring the database for the application shouldn't have affected that. That is unless you changed the login used to connect recently.

Otherwise, if you could post more about how you're logging into SQL Server and the exact error message, that may help diagnose the issue.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-07T20:10:11.853

这对我有用：

```
ALTER USER *userName* WITH LOGIN = *loginName*
ALTER USER *userName* WITH DEFALT_SCHEMA = *schemaName* 
```

（用适合您设置的值替换“用户名”和“登录名”）

我认为这与 sp_change_users_login 相同，但 dox 提到 sp_change_users_login 将从 SQL Server 的未来版本中删除，并改为使用 ALTER USER

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-10-27T21:07:30.520

来自[http://justgeeks.blogspot.com/2010/02/get-login-failed-for-user-after.html](http://justgeeks.blogspot.com/2010/02/get-login-failed-for-user-after.html)

当您收到“用户“oldUser”登录失败时。因为无法打开明确指定的数据库。

只需执行此 sp_change_users_login 'Update_One'、'oldUser'、'oldUser' 和瞧！:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T00:52:34.057

检查您的[连接字符串](http://connectionstrings.com/sql-server)。（如果它的 ASP.NET web.config 应该有这个）。验证登录名（用户名/用户 ID）是否存在于 SQL 服务器上，并且对所述数据库[具有适当的权限。](http://msdn.microsoft.com/en-us/library/aa337562.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T00:56:05.140

看到您对上述评论的回复，表明您已从另一台服务器恢复此内容。话虽如此，正如 bnkdev 所说，检查您的连接字符串。您可能有错误的用户名/密码组合和/或错误的实例名称......假设它们为每个服务器命名不同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T20:20:34.307

First check to see if you have orphaned users with the following stored procedure:

```
exec sp_change_users_login @Action='Report' 
```

Then you can remap the users to the login with:

```
exec sp_change_users_login @Action='update_one', @UserNamePattern='UserName', @LoginName='LoginName' 
```

(substitute 'UserName' and 'LoginName' with the appropriate values for your setup).

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-05T21:26:13.060

我刚刚在我的环境中处理完这个问题，在我的情况下，问题是目标服务器配置为仅用于 Windows 身份验证，我通过 sql server 错误日志发现了这一点。

检查您的错误日志！您从界面获得的错误通常包含不足的安全信息。

# java - 使用 Jama.Matrix 测试可逆性

> ID：481969
> 
> 赞同：2
> 
> 时间：2009-01-27T00:45:55.050
> 
> 标签：java, linear-algebra, jama, matrix-inverse

我有一个使用[JAMA](http://math.nist.gov/javanumerics/jama/)的程序，需要测试一个矩阵是否可以反转。我知道我可以尝试并捕获异常，但这似乎是个坏主意（将 catch 块作为“正常”代码路径的一部分似乎是不好的形式）。

最好也返回逆运算（或以比逆运算更好的 O() 运行）的测试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T00:48:02.490

一般来说，如果你不能解决矩阵，它是单一的（不可逆的）。我相信 JAMA 这样做的方式是尝试使用 LU 分解来求解矩阵，如果失败，它会为 isSingular() 返回“true”。

实际上并没有一种通用的方法来查看矩阵的元素并确定它是否是奇异的 - 您需要检查每一列以查看它是否与其他列正交（即矩阵的零空间为 0）。LU 分解非常快，通常......但是，有时它需要大量操作。

你有一个你想要克服的实际速度问题吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T02:09:56.880

如果抛出异常，你的恢复位置是什么？

如果您进行 LU 分解并发现它是奇异的，您是否捕获异常并尝试 SVD（奇异值分解）代替？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T13:56:58.013

听起来你想估计条件数的倒数。

[这个网站](http://www.alglib.net/matrixops/general/rcond.php)看起来有点前途...

另见[Golub 和 Van Loan，p。128-130](http://books.google.com/books?id=mlOa7wPX6OYC&pg=PA128)。（如果您没有它的副本，请获取一份。）

...或[Higham](http://books.google.com/books?id=epilvM5MMxwC&pg=PA287)，他是数值方法的权威。除了解析数学有点困难......就像穿过一片覆盆子灌木丛一样。：/

或者也许检查 Octave 源代码以获取他们的[MATLAB`rcond()`](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/rcond.html)版本。我找到[了这篇文章](http://www.nabble.com/rcond,-condest,-and-a-block-1-norm-estimator-td13886035.html)。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-27T01:56:47.390

对于方阵，您可以只检查其[行列式](http://en.wikipedia.org/wiki/Determinant)--- [Matrix.det()](http://math.nist.gov/javanumerics/jama/doc/Jama/Matrix.html#det())当且仅当矩阵是奇异矩阵时才返回零。当然，您还需要注意[病态](http://en.wikipedia.org/wiki/Condition_number)矩阵。

# multithreading - 多少个线程太多了？

> ID：481970
> 
> 赞同：366
> 
> 时间：2009-01-27T00:46:06.237
> 
> 标签：multithreading, performance, threadpool

我正在编写一个服务器，并在收到请求时将每个操作发送到一个单独的线程中。我这样做是因为几乎每个请求都会进行数据库查询。我正在使用线程池库来减少线程的构造/销毁。

我的问题是：像这样的 I/O 线程的好的截止点是什么？我知道这只是一个粗略的估计，但我们是在谈论数百个吗？数千？

我将如何弄清楚这个截止点是什么？

* * *

### 编辑：

谢谢大家的回复，看来我只需要对其进行测试以找出我的线程数上限。但问题是：我怎么知道我已经达到了那个天花板？我到底应该测量什么？

* * *

## 回答 #1

> 赞同：252
> 
> 时间：2009-01-27T00:51:10.783

有人会说*两个*线程太多了-我不太喜欢那个阵营:-)

这是我的建议：*衡量，不要猜测。*一个建议是使其可配置并最初将其设置为 100，然后将您的软件发布到野外并监控会发生什么。

如果您的线程使用量在 3 处达到峰值，那么 100 太多了。如果它在一天中的大部分时间都保持在 100，请将其提高到 200，看看会发生什么。

实际上，您*可以*让您的代码本身监控使用情况并在下次启动时调整配置，但这可能有点矫枉过正。

* * *

*为了澄清和阐述：*

我不提倡滚动你自己的线程池子系统，一定要使用你拥有的那个。但是，由于您询问线程的良好截止点，我假设您的线程池实现能够限制创建的最大线程数（这是一件好事）。

我编写了线程和数据库连接池代码，它们具有以下功能（我认为这对性能至关重要）：

*   最小活动线程数。
*   最大线程数。
*   关闭一段时间未使用的线程。

第一个为线程池客户端的最低性能设置了基线（此线程数始终可供使用）。第二个对活动线程的资源使用设置了限制。第三个让您在安静时间返回基线，以最大限度地减少资源使用。

您需要平衡未使用线程的资源使用 (A) 与没有足够线程来完成工作的资源使用 (B)。

(A) 通常是内存使用情况（堆栈等），因为不做任何工作的线程不会使用太多 CPU。(B) 通常会在请求到达时延迟处理请求，因为您需要等待线程可用。

这就是你测量的原因。正如您所说，您的绝大多数线程将等待来自数据库的响应，因此它们将不会运行。有两个因素会影响您应该允许的线程数。

第一个是可用的数据库连接数。这可能是一个硬限制，除非您可以在 DBMS 上增加它 - 我将假设您的 DBMS 在这种情况下可以接受无限数量的连接（尽管理想情况下您也应该测量它）。

然后，您应该拥有的线程数取决于您的历史使用情况。您应该运行的最小值是您曾经运行过的最小值 + A%，绝对最小值为（例如，使其像 A 一样可配置）5。

最大线程数应该是你的历史最大值 + B%。

您还应该监控行为变化。如果由于某种原因，您的使用量在很长一段时间内达到 100% 可用（这样会影响客户端的性能），您应该提高允许的最大值，直到它再次高出 B%。

* * *

*回应“我到底应该测量什么？” 问题：*

您应该具体测量的是负载下并发使用的最大线程数（例如，等待从 DB 调用返回）。*然后添加例如*10% 的安全系数（强调，因为其他海报似乎将我的示例作为固定建议）。

此外，这应该在生产环境中进行调整。事先得到一个估计是可以的，但你永远不知道生产会怎样（这就是为什么所有这些东西都应该在运行时可配置的原因）。这是为了捕捉诸如意外加倍的客户端调用的情况。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2010-11-18T20:06:04.790

这个问题已经讨论得很透彻了，我没有机会阅读所有的回复。但是，在查看可以在给定系统中和平共存的同时线程数的上限时，需要考虑以下几点。

1.  线程堆栈大小：在 Linux 中，默认线程堆栈大小为 8MB（您可以使用 ulimit -a 来查找）。
2.  给定操作系统变体支持的最大虚拟内存。Linux Kernel 2.4 支持 2 GB 的内存地址空间。使用 Kernel 2.6 ，我有点大（3GB）
3.  [1] 显示了每个给定的 Max VM Supported 的最大线程数的计算。对于 2.4，它原来是大约 255 个线程。对于 2.6，这个数字要大一些。
4.  你有什么样的内核调度程序。将 Linux 2.4 内核调度程序与 2.6 进行比较，后者为您提供了 O(1) 调度，不依赖于系统中存在的任务数量，而第一个更多的是 O(n)。因此，内核调度的 SMP 能力在系统中最大可持续线程数方面也发挥着很好的作用。

现在您可以调整堆栈大小以包含更多线程，但是您必须考虑线程管理的开销（创建/销毁和调度）。您可以对给定进程和给定线程强制执行 CPU Affinity，以将它们绑定到特定 CPU，以避免 CPU 之间的线程迁移开销并避免冷现金问题。

请注意，可以根据自己的意愿创建数千个线程，但是当 Linux 用完 VM 时，它只是随机开始杀死进程（因此是线程）。这是为了防止实用程序配置文件被最大化。（效用函数讲述了给定资源数量的系统范围效用。在这种情况下，CPU 周期和内存资源不变，效用曲线随着任务数量的增加而变平）。

我确信 Windows 内核调度程序也会做这种事情来处理资源的过度利用

[1] [http://adywicaksono.wordpress.com/2007/07/10/i-can-not-create-more-than-255-threads-on-linux-what-is-the-solutions/](http://adywicaksono.wordpress.com/2007/07/10/i-can-not-create-more-than-255-threads-on-linux-what-is-the-solutions/)

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-01-27T01:03:53.097

如果您的线程正在执行任何类型的资源密集型工作（CPU/磁盘），那么您很少会看到超过一两个的好处，而且太多会很快降低性能。

“最好的情况”是，您后面的线程将在第一个线程完成时停止，或者某些线程在资源争用较低的情况下具有低开销块。最坏的情况是您开始破坏缓存/磁盘/网络，并且您的整体吞吐量下降到最低点。

一个好的解决方案是将请求放在一个池中，然后从线程池将请求分派给工作线程（是的，避免连续创建/销毁线程是一个很好的第一步）。

然后可以根据分析结果、正在运行的硬件以及机器上可能发生的其他事情来调整和缩放此池中的活动线程数。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-09-18T06:01:59.917

您应该记住的一件事是，python（至少基于 C 的版本）使用所谓的[全局解释器锁](http://en.wikipedia.org/wiki/Global_Interpreter_Lock)，它会对多核机器的性能产生巨大影响。

如果您真的需要最大限度地利用多线程 python，您可能需要考虑使用 Jython 或其他东西。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-27T08:42:24.997

正如 Pax 正确所说，**衡量，不要猜测**。我为[DNSwitness](http://www.dnswitness.net/)所做的事情和结果令人惊讶：理想的线程数比我想象的要高得多，大约 15,000 个线程才能获得最快的结果。

当然，这取决于很多事情，这就是为什么你必须衡量自己。

[Combien de fils d'execution](http://www.bortzmeyer.org/combien-de-fils.html)中的完整措施（仅限法语） ？.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-06-08T18:12:39.880

我编写了许多大量多线程的应用程序。我通常允许由配置文件指定潜在线程的数量。当我针对特定客户进行调优时，我将这个数字设置得足够高，以至于我对所有 CPU 内核的利用率都很高，但又没有高到我遇到内存问题（这些是 32 位操作系统）时间）。

换句话说，一旦你遇到瓶颈，比如 CPU、数据库吞吐量、磁盘吞吐量等，添加更多线程不会提高整体性能。但在您达到这一点之前，请添加更多线程！

请注意，这是假设相关系统专用于您的应用程序，并且您不必很好地玩（避免挨饿）其他应用程序。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-01-15T15:13:15.893

“大铁”的答案通常是每个有限资源一个线程——处理器（CPU 绑定）、arm（I/O 绑定）等——但只有当你可以将工作路由到正确的线程以获取资源时，它才有效被访问。

在不可能的情况下，请考虑您拥有可替代资源 (CPU) 和不可替代资源 (arm)。对于 CPU，将每个线程分配给特定的 CPU 并不重要（尽管它有助于缓存管理），但对于 arm，如果您不能为 arm 分配线程，您就会进入排队理论以及保持 arm 的最佳数量是多少忙碌的。一般来说，我认为如果你不能根据使用的手臂路由请求，那么每个手臂有 2-3 个线程将是正确的。

当传递给线程的工作单元没有执行合理的原子工作单元时，就会出现复杂情况。例如，您可能让线程在某一时刻访问磁盘，而在另一时刻在网络上等待。这增加了额外线程可以进入并做有用工作的“裂缝”数量，但它也增加了额外线程污染彼此缓存等的机会，并使系统陷入困境。

当然，您必须权衡所有这些与线程的“重量”。不幸的是，大多数系统都有非常重量级的线程（他们所谓的“轻量级线程”通常根本不是线程），所以最好在低端犯错。

我在实践中看到的是，非常细微的差异可以在多少线程是最佳的方面产生巨大的差异。特别是缓存问题和锁冲突会极大地限制实际并发量。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-27T00:51:42.730

要考虑的一件事是将执行代码的机器上有多少个内核。这代表了在任何给定时间可以进行多少线程的硬性限制。但是，如果在您的情况下，预计线程会经常等待数据库执行查询，您可能希望根据数据库可以处理的并发查询数量来调整线程。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-27T00:55:16.547

我认为这对您的问题有点回避，但是为什么不将它们分叉到进程中呢？我对网络的理解（从以前的朦胧日子开始，我根本不编写网络代码）是每个传入的连接都可以作为一个单独的进程处理，因为如果有人在你的进程中做了一些讨厌的事情，它不会核对整个程序。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-27T12:36:16.600

ryeguy，我目前正在开发一个类似的应用程序，我的线程数设置为 15。不幸的是，如果我将其增加到 20，它会崩溃。所以，是的，我认为处理这个问题的最好方法是衡量您当前的配置是否允许多于或少于数量 X 的线程。

* * *

## 回答 #11

> 赞同：-6
> 
> 时间：2009-01-27T00:53:37.797

在大多数情况下，您应该允许线程池来处理这个问题。如果您发布一些代码或提供更多详细信息，则可能更容易看出是否有某种原因线程池的默认行为不是最好的。

您可以在此处找到有关其工作原理的更多信息：[http ://en.wikipedia.org/wiki/Thread_pool_pattern](http://en.wikipedia.org/wiki/Thread_pool_pattern)

* * *

## 回答 #12

> 赞同：-12
> 
> 时间：2009-01-27T00:48:45.437

我经常听到与 CPU 内核一样多的线程。

# objective-c - 如何在 iPhone 上使用 Interface builder 实现滚动功能？

> ID：481980
> 
> 赞同：0
> 
> 时间：2009-01-27T00:51:14.243
> 
> 标签：objective-c, iphone, interface

我想知道如何使视图滚动，就像在表格视图中一样。

我有一个表格，上面有几个字段。我不想将其构建为向下钻取的传统表格。

不是很大，但因为主窗口是一个标签栏，我缺乏一点垂直空间。此外，当我尝试填充文本字段时，键盘会覆盖，我希望焦点移动到字段和视图滚动，就像在 safari 方式中一样。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-01T14:55:13.393

在 Interface Builder 中选择主窗体视图，然后从菜单中选择 Layout > Embed Objects in > Scroll View。您可能需要调整一些连接以使一切正常。

# design-patterns - 立面与调解员

> ID：481984
> 
> 赞同：88
> 
> 时间：2009-01-27T00:52:50.030
> 
> 标签：design-patterns, facade, mediator

我一直在研究这两种模式之间的区别。

我知道外观封装了对子系统的访问，而中介封装了组件之间的交互。

我知道子系统组件不知道外观，而组件显然知道中介。

我目前正在使用外观来封装检索配置信息的方法，例如 App.Config、存储在 SQL 中的用户设置、程序集信息等，以及用于在不同窗体之间导航的中介。

然而，大多数网站都指出中介“增加了功能”。他们这是什么意思？中介如何添加功能？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-01-27T04:53:07.703

> *...大多数网站指出中介“增加了功能”...*

**外观**仅从不同的角度公开现有功能。

**中介**“添加”功能，因为它结合了不同的现有功能来创建新功能。

举个例子：

你有一个日志系统。从该日志系统，您可以将日志记录到文件、套接字或数据库。

使用外观设计模式，您可以将现有功能的所有关系“隐藏”在外观暴露的单个“界面”后面。

*客户端代码：*

```
 Logger logger = new Logger();
 logger.initLogger("someLogger");
 logger.debug("message"); 
```

该实现可能涉及许多对象的交互。但最终，该功能已经存在。大概“调试”方法实现如下：

*执行：*

```
 class Logger { 

      private LoggerImpl internalLogger;
      private LoggerManager manager;

      public void initLogger( String loggerName ) {
          this.internalLogger = manager.getLogger( loggerName ); 
      }

      public void debug( String message ) { 
          this.internalLogger.debug( message );
      }     
 } 
```

该功能已经存在。立面只是隐藏它。在这个假设的情况下，LoggerManager 处理正确记录器的创建，而 LoggerImpl 是具有“调试”方法的包私有对象。这样，Facade 并没有添加功能，它只是委托给一些现有的对象。

另一方面，中介通过组合不同的对象来添加新的功能。

*相同的客户端代码：*

```
 Logger logger = new Logger();
 logger.initLogger("someLogger");
 logger.debug("message"); 
```

*执行：*

```
 class Logger { 

      private java.io.PrintStream out;
      private java.net.Socket client;
      private java.sql.Connection dbConnection;
      private String loggerName;

      public void initLogger( String loggerName ) {
               this.loggerName = loggerName;
               if ( loggerName == "someLogger" ) { 
                    out = new PrintStream( new File("app.log"));
               } else if ( loggerName == "serverLog" ) { 
                    client = new Socket("127.0.0.1", 1234 );
               } else if( loggerName == "dblog") { 
                    dbConnection = Class.forName()... .
               }

      }

      public void debug( String message ) { 

               if ( loggerName == "someLogger" ) { 
                    out.println( message );
               } else if ( loggerName == "serverLog" ) { 
                    ObjectOutputStrewam oos = 
                           new ObjectOutputStrewam( client.getOutputStream());
                    oos.writeObject( message );
               } else if( loggerName == "dblog") { 
                    Pstmt pstmt = dbConnection.prepareStatment( LOG_SQL );
                    pstmt.setParameter(1, message );
                    pstmt.executeUpdate();
                    dbConnection.commit();
               }
      }
 } 
```

在此代码中，中介是包含创建适当“通道”以记录日志并将日志放入该通道的业务逻辑的那个。中介正在“创建”功能。

当然，使用多态性有更好的方法来实现这一点，但这里的重点是展示中介如何通过组合现有功能“添加”新功能（在我的示例中没有表现出非常抱歉）但想象一下中介，阅读从数据库中记录远程主机的位置，然后创建一个客户端，最后将日志消息写入该客户端打印流。这样，调解员将在不同对象之间“调解”。

最后，**外观**是一种结构模式，即描述对象的组成，而**中介**是一种行为模式，即描述对象交互的方式。

我希望这有帮助。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-27T01:03:33.440

我正在使用调解器来添加日志文件功能。

它是这样工作的：

*   Obj A 告诉中介它需要做一些事情。
*   中介将消息发送到各种客户端对象。
*   Obj B 做 Obj A 需要的事情，并通过中介发回适当的消息。
*   同时，Obj C 也由中介发送这两条消息，并记录结果。这样，我们可以从日志文件中获取用户统计信息。
*   Obj D 也可以是错误检查器，因此如果 Obj B 响应 Obj A 的请求是不可能的，则 Obj D 可能是向用户报告的东西。错误现在可以记录在与常规活动不同的文件中，并且可以使用其他一些方式来表现 Obj A 不应该真正关心的行为（哔哔声等）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2015-06-13T07:25:21.870

在相关模式下，[gof](https://en.wikipedia.org/wiki/Design_Patterns)说： Facade (185) 与 Mediator 的不同之处在于它抽象了对象子系统以提供更方便的接口。它的协议是单向的；也就是说，Facade 对象向子系统类发出请求，反之则不然。相比之下，Mediator 实现了同事对象不提供或不能提供的协作行为，并且协议是多向的。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-05-31T00:38:59.220

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-27T02:07:38.537

我认为区别是有方向的：Facade 是客户端和 Facade 之间的一种单向通信；mediator 可以是双向对话，消息在客户端和 mediator 之间来回流动。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-01-12T04:09:19.077

在“设计模式”一书中，中介者模式的关键描述如下：“它（中介者）充当小部件（即，'一组'相互依赖的对象）的通信中心。”

换句话说，中介对象是唯一的超对象，它知道一组协作对象中的所有其他对象以及它们应该如何相互交互。所有其他对象都应该与中介对象交互，而不是彼此交互。

相反，外观是子系统中一组接口的“统一接口”——供子系统的消费者使用——而不是子系统的组件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-08-08T16:09:30.070

您可以在这个 SE 问题中找到有关外观模式的详细信息：

[什么是外观设计模式？](https://stackoverflow.com/questions/5242429/what-is-facade-design-pattern/)

`Facade`为复杂系统提供简单统一的接口。

这篇文章中提供了真实世界的示例（**cleartrip 航班+酒店预订**）：

[什么是外观设计模式？](https://stackoverflow.com/questions/5242429/what-is-facade-design-pattern/35858478#35858478)

[中介者](https://sourcemaking.com/design_patterns/mediator)模式：定义一个对象，封装一组对象如何交互。Mediator 通过阻止对象显式地相互引用来促进松散耦合，并且它允许您独立地改变它们的交互。

下面的 SE 问题中提供了 Mesh 网络拓扑的真实示例：

[中介者与观察者的面向对象设计模式](https://stackoverflow.com/questions/9226479/mediator-vs-observer/38833360#38833360)

关于您对 Mediator 的查询增加了责任：

1.  **Facade 仅提供与现有子系统的接口**。现有的子系统不知道 Facade 类本身。

2.  **中介者知道同事对象**。它使不同同事之间的沟通成为可能。在我在链接问题中引用的示例中，*ConcreteMediator* ( *NetworkMediator* ) 将一位同事的注册和注销事件的通知发送给所有其他同事。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-05-16T12:07:13.040

两者都对另一组对象施加某种策略。**Facade**从上执行策略，**Mediator**从下执行策略。**Facade**的使用是可见的和约束的，而**Mediator**的使用是不可见的和启用的。

当您想为一组具有复杂和通用接口的对象提供简单和特定的接口时，使用**外观模式。**

The **Mediator** pattern also imposes policy. However, whereas Facade imposed its policy in a visible and constraining way, **Mediator** imposes its policies in a hidden and unconstrained way.

**Agile Software Development, Principles, Patterns, and Practices Robert C. Martin.**

# clickonce - ClickOnce 将“.application”文件显示为 XML

> ID：481986
> 
> 赞同：9
> 
> 时间：2009-01-27T00:53:32.977
> 
> 标签：clickonce, deployment

我创建了我的测试应用程序的[ClickOnce](http://en.wikipedia.org/wiki/ClickOnce)部署，并尝试在我的 Windows XP SP2 测试盒上运行它。当我单击 Visual Studio 2008 创建的安装按钮时，我得到的只是浏览器中显示的清单文件，它不会产生安装。

[如果我在Internet Explorer 7](http://en.wikipedia.org/wiki/Internet_Explorer_7)测试盒上运行安装，一切正常。

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T14:54:26.353

MSDN 文章*[对 ClickOnce 部署中的特定错误进行故障排除](http://msdn.microsoft.com/en-us/library/ms229001.aspx)*中的第一个问题解决了您的问题。

Guy Starbuck 是对的，一个问题可能是 2.0 框架未安装或损坏。但是，我经常遇到的问题是没有在[IIS](http://en.wikipedia.org/wiki/Internet_Information_Services)中为**.application**文件正确设置 MIME 类型。确保 IIS 设置为将**.application**文件与**application/x-ms-application**内容类型相关联。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:34:25.623

还有一个浏览器设置可能会导致这种情况。在*安全*下是一个设置，“根据内容打开文件，而不是文件扩展名”。在 Internet Explorer 7 中，这不会影响 ClickOnce 应用程序，但在[Internet Explorer 6](http://en.wikipedia.org/wiki/Internet_Explorer_6)中，我看到此设置会导致您提到的行为。关闭该设置可以解决问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T01:08:45.037

要检查的一件事是您是否在 XP 机器上安装了 .NET 2.0 Framework。只是一个尝试的想法，这是我过去在 Win2k 机器上遇到的。

如果未安装 .NET 2，您所描述的行为可能会发生，因为“.application”文件扩展名不会与任何内容相关联。

# python - LDAP 响应元组 (97, []) 是什么意思？

> ID：481995
> 
> 赞同：8
> 
> 时间：2009-01-27T00:57:34.403
> 
> 标签：python, active-directory, ldap

我正在使用 python-ldap 尝试对现有的 Active Directory 进行身份验证，并且当我使用以下代码时：

```
import ldap
l = ldap.initialize('LDAP://example.com')
m = l.simple_bind_s(username@example.com,password) 
```

我得到以下信息：

```
print m
(97, []) 
```

来自 Microsoft Active Directory 服务器的 97 和空列表表示什么？

我认为这是一个成功的身份验证，因为它不会出错（如果您使用错误的密码或不存在的用户名，它会出错），但我想知道元组是否意味着有用的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T01:04:38.680

第一项是状态码（97=成功），后跟来自服务器的消息列表。请参见**Binding**部分的[此处](http://www.packtpub.com/article/installing-and-configuring-the-python-ldap-library-and-binding-to-an-ldap-directory)。

 *** * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-27T01:07:38.190

根据[文档](http://support.microsoft.com/kb/218185)，这是：

```
LDAP_REFERRAL_LIMIT_EXCEEDED      0x61   The referral limit was exceeded. 
```

大概

```
ldap.set_option(ldap.OPT_REFERRALS, 0) 
```

有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T01:03:38.150

这是一个论坛主题，解释了错误并提供了解决方法。 [http://www.velocityreviews.com/forums/t612838-pythonldap-operations-error.html](http://www.velocityreviews.com/forums/t612838-pythonldap-operations-error.html)**********************