# StackOverflow 问答 000799000-000799999

# project-planning - 新项目规划时要考虑的步骤

> ID：799007
> 
> 赞同：0
> 
> 时间：2009-04-28T17:21:27.107
> 
> 标签：project-planning

在项目的规划阶段，我必须记住哪些要点才能真正打下坚实的基础？

谢谢

编辑：我的意思是更具体地与编码有关。（我不是指预算等）。

例如：我们在哪里可以使用 C# 中的泛型、反射或概念

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T17:28:36.560

沟通..沟通..沟通..

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T17:34:55.017

在规划阶段，您需要：

1.  定义你要解决的问题
2.  验证问题确实存在
3.  与您的客户一起定义解决方案（这更像是一个起点，我建议在您的生命周期中不断地进行用户反馈，但您需要从某个地方开始）
4.  定义项目范围，包括功能、成本/预算和时间

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T17:24:59.050

1) 了解你的最后期限 2) 了解你的预算

如果您让其中任何一个对您不利，那么您就是在为一场灾难做好准备。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T17:27:26.297

查看 Steve McConnell 关于软件估计的书。它将帮助您在开始之前考虑所有领域。因为如果你必须估计它，那么你应该知道必须做什么。

您还应该考虑阅读 Code Complete。

[软件估计](https://rads.stackoverflow.com/amzn/click/com/0735605351),[代码完成](https://rads.stackoverflow.com/amzn/click/com/0735619670)

# asp.net - 需要一种无需编程即可配置的表单向导技术

> ID：799008
> 
> 赞同：1
> 
> 时间：2009-04-28T17:21:42.723
> 
> 标签：asp.net, infopath, wizard

我需要一种类似于 MS InfoPath 或 Adob​​e LiveCycle Forms ES 的表单技术，因为它具有 XML 数据结构，与 ASP.NET 兼容，在浏览器中呈现，并且可以由非技术型办公室工作人员轻松配置。TurboTax Online 是我心目中功能类型的一个很好的例子。

我还没有解决的缺失部分是它能够像向导一样操作，以便使用 AJAX 或 Flash/Silverlight 或某种 RIA 动态响应某些步骤，或者提示、隐藏或更改表单的后续部分. 它需要能够将所有结果或部分结果保存为持久形式。

这将很容易对功能进行编程，但需要一种可以创建/生成这些表单并能够以某种易于配置的方式设置规则的技术 - 就像办公室工作人员可以使用 InfoPath 创建表单一样，至少可能一种工作流样式工具，用于设置表单的规则和流程。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-01-25T00:28:27.697

您没有进一步研究 Adob​​e LiveCycle ES2 有什么原因吗？

它似乎很适合您的要求，并且*确实*有一个类似于向导的功能，称为[Form Guides](http://help.adobe.com/en_US/livecycle/9.0/workbenchHelp/help.htm?content=partGuides_1.html)。您可以根据用户输入隐藏/显示部分，并让表单事件触发对 Web 服务的调用。

鉴于您发布此内容时，指南可能尚未在 LiveCycle 中实现 - 如果这仍然与您相关，可能值得再次查看。

# c# - .NET 反射创建类属性

> ID：799022
> 
> 赞同：1
> 
> 时间：2009-04-28T17:25:45.070
> 
> 标签：c#, .net, vb.net, reflection

我对反射相当陌生，如果可能的话，我想知道如何创建一个类的实例，然后向该类添加属性，设置这些属性，然后再阅读它们。我没有任何代码，因为我什至不知道如何开始。C# 或 VB 都可以。

谢谢你

编辑：（详细说明）

我的系统有一个动态表单创建器。我的一位同事要求可以通过 Web 服务访问表单数据。我的想法是创建一个类（基于动态表单）向类添加属性（基于表单字段）设置这些属性（基于为这些字段输入的值）然后在 Web 服务中返回该类。

此外，Web 服务将能够设置类中的属性并最终将这些更改提交到数据库。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-28T17:27:42.973

如果您的意思是动态创建一个类，那么这两个选项是：

*   [Reflection.Emit](http://msdn.microsoft.com/en-us/library/3y322t50.aspx) - 很难，快速地创建类
*   [CodeDom](http://msdn.microsoft.com/en-us/library/y2k85ax6.aspx) - 创建类更简单，更慢

如果您的意思是创建现有类的实例，则从[Activator.CreateInstance](http://msdn.microsoft.com/en-us/library/system.activator.createinstance.aspx)开始创建对象的实例，然后查看[Type](http://msdn.microsoft.com/en-us/library/system.type.aspx)上的方法，例如[GetProperty](http://msdn.microsoft.com/en-us/library/system.type.getproperty.aspx)，它将返回一个[PropertyInfo](http://msdn.microsoft.com/en-us/library/system.type.getproperty.aspx)，您可以在该方法上调用[GetValue](http://msdn.microsoft.com/en-us/library/system.reflection.propertyinfo.getvalue.aspx)和[SetValue](http://msdn.microsoft.com/en-us/library/system.reflection.propertyinfo.setvalue.aspx)。

* * *

更新：对于您描述的场景，从 Web 服务返回动态数据，那么我建议您不要使用这种方法，因为您很难编写代码，并且很难使用静态类型的语言。相反，正如评论和其他答案之一所建议的那样，某种字典可能是更好的选择。

（请注意，当我说返回某种字典时，我是在比喻而不是字面意思，即返回在概念上与字典相同的东西，例如键值对列表。我不建议直接返回一个（即使您使用的是支持此功能的 WCF），因为通常最好完全控制您返回的 XML。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T17:34:12.740

The [Execution-Time Code Generation](http://docs.msdnaa.net/ark_new/Webfiles/Books/623c30f.pdf) chapter of Eric Gunnerson's book (A Programmer's Introduction to C#) has some great information on this topic. See page 14 and onwards in particular. He outlines the two main methods of accomplishing dynamic class/code generation (CodeDOM and the Reflection.Emit namespace). It also discusses the difficulty and performance of the two approaches. Have a read through that, and you ought to find everything you might need.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T07:55:53.543

I know this is being overly simplified by why not just KISS and generate the required Xml to return through the Web Service and then parse the returned Xml to populate the database.

My reasoning is that for the expanded reason you suggest doing this I can see the value or reason for wanting a dynamic class?

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T17:44:45.447

The real question is, what do you need to use those properties for?

What are gonna be the use cases? Do you need to bind those properties to the UI somehow? Using what kind of technology? (WPF, Windows Forms?)

Is it just that you need to gather a set of key/value pairs at runtime? Then maybe a simple dictionary would do the trick.

Please elaborate if you can on what it is you need, and I'm sure people here can come up with plenty of ways to help you, but it's difficult to give a good answer without more context.

# java - Java中有什么方法可以记录*每个*线程中断？

> ID：799023
> 
> 赞同：7
> 
> 时间：2009-04-28T17:25:45.193
> 
> 标签：java, multithreading, debugging, interrupt

我想以某种方式记录每次`Thread.interrupt()`调用，记录哪个线程发出调用（及其当前堆栈）以及识别有关哪个线程被中断的信息。

有没有办法做到这一点？搜索信息，我看到有人提到实施安全管理器的可能性。这是否可以在运行时完成（例如，在 Applet 或 Web Start 客户端中），还是您需要使用已安装的 JVM 工具来执行此操作？

还是有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-28T20:19:19.503

作为一个快速破解，这比我想象的*要*容易得多。由于这是一个快速的 hack，我没有做一些事情，比如在取消引用数组之前确保堆栈跟踪足够深等。我在我签名的 Applet 的构造函数中插入了以下内容：

```
log.info("Old security manager = " + System.getSecurityManager());
System.setSecurityManager(new SecurityManager() {
      @Override
      public void checkAccess(final Thread t) {
        StackTraceElement[] list = Thread.currentThread().getStackTrace();
        StackTraceElement element = list[3];
        if (element.getMethodName().equals("interrupt")) {
          log.info("CheckAccess to interrupt(Thread = " + t.getName() + ") - "
                   + element.getMethodName());
          dumpThreadStack(Thread.currentThread());
        }
        super.checkAccess(t);
      }
    }); 
```

`dumpThreadStack`方法如下：

```
public static void dumpThreadStack(final Thread thread) {
  StringBuilder builder = new StringBuilder('\n');
  try {
    for (StackTraceElement element : thread.getStackTrace()) {
      builder.append(element.toString()).append('\n');
    }
  } catch (SecurityException e) { /* ignore */ }
  log.info(builder.toString());
} 
```

当然，我永远不能把它留在生产代码中，但它足以告诉我究竟是哪个线程导致了`interrupt()`我没想到的。也就是说，有了这段代码，每次调用`Thread.interrupt()`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T17:29:44.000

在尝试任何过于疯狂的事情之前，您是否考虑过使用[Java 调试](http://docs.rinet.ru/JaTricks/ch26.htm) [API](http://download.java.net/jdk7/docs/jdk/api/jpda/jdi/index.html)？我认为在 Thread.interrupt() 上捕获 MethodEntryEvents 就可以了。

Eeek，那是旧界面，您还应该查看新的[JVM Tool](http://java.sun.com/j2se/1.5.0/docs/guide/jvmti/jvmti.html) [Interface](http://java.sun.com/j2se/1.5.0/docs/guide/jpda/enhancements.html)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T17:31:09.707

我会看看[AspectJ](http://www.eclipse.org/aspectj/)及其包装方法调用的能力。围绕该方法的[执行切入点](http://www.eclipse.org/aspectj/doc/released/progguide/language-joinPoints.html#some-example-pointcuts)`interrupt()`在这里应该有所帮助。

请注意，由于您希望拦截 Java 系统方法调用（而不是您的应用程序代码），因此上述方法*可能*不适合。[该线程](http://dev.eclipse.org/mhonarc/lists/aspectj-users/msg07750.html)似乎表明这是可能的，但请注意他创建了一个*编织*的rt.jar。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T17:53:20.527

正如其他人所说......如果这是一次性的事情，JVMTI 可能是最核心的方式。然而，同样有趣的是使用 asm 库和检测 API 来创建一个代理，该代理插入对您在 Thread.interrupt() 调用之前创建的静态方法的调用（或者可能更改 Thread.interrupt( ) 方法做同样的事情，我认为你可以做到）。

两者都需要一些时间来学习，但是使用起来很有趣，一旦掌握了它，您就可以在未来将它们用于各种有趣的事情:-) 我真的没有任何好的片段可以粘贴在这里现在，但如果你在谷歌上搜索 ASM，也许看看 JIP 以了解 ASM 的一些创造性使用，我想你会找到灵感的。

JIP：[Java 交互式探查器](http://jiprof.sourceforge.net/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T17:39:53.833

您也可以尝试使用 JMX：

```
ManagementFactory.getThreadMXBean().getThreadInfo(aThreadID) 
```

使用[ThreadInfo](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/management/ThreadInfo.html)对象，您可以记录：

*   线程的堆栈跟踪
*   一般有用的信息，如姓名、状态等
*   ETC

**编辑**

使用 getAllThreadIds() 来获取活动线程 ID 列表：

```
long[] ids = ManagementFactory.getThreadMXBean().getAllThreadIds(); 
```

# hibernate - 需要设计结构方面的帮助并在助手的助手中查找 EntityManager 和 UserTransaction

> ID：799043
> 
> 赞同：1
> 
> 时间：2009-04-28T17:30:45.540
> 
> 标签：hibernate, jpa, jakarta-ee, persistence, jndi

我基本上是一个新手，他开始开发一个新的 webapp。webapp 主要是您的基本 CRUD 操作。为此，我决定使用 JPA 和 Hibernate 作为持久性提供程序，并将在 Apache Derby 上进行开发以用于开发和测试目的。我使用 GlassFish v2 作为 App Server 来部署我的 EJB3 bean。对于前端，我使用的是 JSF（带有 Woodstock 主题的 Visual JSF，与 NeatBeans v6.5 捆绑在一起）

所以这就是我到目前为止的工作方式。我大部分时间都在使用 NetBeans 6.5 向导来生成我的实体类和 ejb 会话 bean。我所做的是，我在 Apache Derby 中创建一个新表，例如 XXX。然后我使用“来自数据库的实体类”来生成 XXX 实体类，其中包含所有必要的注释以及 getter 和 setter 方法。

接下来，我运行“来自实体类的 JPA 控制器类”向导来生成控制器类代码 XXXJpaController，它基本上包含以下内容：

```
@Resource private UserTransaction utx = null;
@PersistenceUnit(unitName = "TestEnterpriseApplication-ejbPU") private EntityManagerFactory emf = null;
1\. EntityManager getEntityManager() { return emf.createEntityManager() }
2\. void create(XXX xxx) throws PreexistingEntityException, RollbackFailureException, Exception{}
3\. void edit(XXX xxx) throws NonexistentEntityException, RollbackFailureException, Exception{}
4\. void destroy(Long id) throws NonexistentEntityException, RollbackFailureException, Exception {}
5\. List<XXX> findXXXEntities(){}
6\. List<XXX> findXXXEntities(int maxResults, int firstResult)  {}
7\. List<XXX> findXXXEntities(boolean all, int maxResults, int firstResult){}
8\. XXX findXXX(Long id){}
9\. int getXXXCount(){} 
```

然后，我运行“实体类的会话 Bean”向导来生成 EntityFacade 本地/远程会话 bean，这些 bean 可以在需要时由前端调用，如下所示：

```
@PersistenceContext private EntityManager em;
1\. void create(XXX xxx) { em.persist(xxx); }
2\. void edit(XXX xxx) { em.merge(xxx); }
3\. void remove(XXX xxx) { em.remove(em.merge(xxx)); }
4\. List<XXX> findAll() { return em.createQuery("select object(o) from XXX as o").getResultList();  } 
```

由于我已经有了实现这些方法的生成控制器类，更好地支持 try、catch 和事务，我决定在 XXXFacade.java 中调用它，如下所示：

```
XXXJpaController XXXController = new XXXJpaController();
1\. public void create(XXX xxx) throws PreexistingEntityException, RollbackFailureException, Exception {
        XXXController.create(xxx); }
2\. public void edit(XXX xxx) throws NonexistentEntityException, RollbackFailureException, Exception{
        XXXController.edit(xxx); }
3\. public void remove(XXX xxx) throws NonexistentEntityException, RollbackFailureException, Exception{
        XXXController.destroy(xxx.getId()); }
4\. public XXX find(Object id) {
        return XXXController.findXXX((Long)id); }
5\. public List<XXX> findAll() {
        return XXXController.findXXXEntities(); } 
```

所以这是我的第一个问题。这是在 JEE 世界中做事的正确方法还是有更好的方法？我在这里引入某种冗余吗？这是我对所有实体类几乎都遵循的模式：创建实体类 -> 创建控制器类 -> 创建实体外观类 -> 更改实体外观类以调用控制器类方法

ps：我用的是JTA

这反过来又把我引向了另一个问题。所有生成的控制器类都有自己的 getEntityManager() 方法。因此，为了摆脱这种冗余，我决定使用 Hibernate 教程中常见的 HibernateUtil.java 的辅助类（它充当 sessionfactory 的单例）。所以我创建了一个 PersistenceUtil.java，它有 getEntityManager() 和 getUserTransaction() 方法，它们应该返回控制器类使用的 EntityManager 和 UserTransaction 的实例。

这就是问题所在。我在 XXXFacade 类上使用 @PersistenceContext ((name="jpa/EntityManager") 和 @Resource (name="jta/UserTransaction")。所以我可以从 XXXFacade 类（如果我必须这样做，但在我的情况下我没有）和 XXXJpaController 帮助器类（通过 jndi 查找）。在线阅读后，这就是我发现的。帮助类需要在 bean 的组件环境上使用 JNDI 查找（ java:comp/env)，因为注入只针对容器管理的 bean 而不是非托管的辅助类。这对于在 XXXFacade 类中实例化的 Controller 类来说很好，如上面的代码所示。但是，我无法使用 PersistenceUtil 类来查找 EntityManager 或 UserTransaction，因为我猜测它是一个助手的助手类。我可以做些什么来解决这个问题并访问 PersistenceUtil 帮助程序类中的容器管理 entitymanager 和 usertransaction？我想到的一个选择是也在每个 XXXFacade 类中实例化 Persistence 类（我不喜欢那样的声音）。

我能想到的唯一其他选择是摆脱 Controller 类并将所有代码移动到 XXXFacade 类中。这样我什至不再需要 PersistenceUtil 辅助类，因为我可以直接将它注入会话 bean，对吗？

就像我一开始提到的，我是新手。我希望听到所有经验丰富且经验丰富的 java/jee 退伍军人在此问题上的指导。我可以在这里使用任何特定的模式吗？

如果这对你没有任何意义，我很抱歉。请随时向我询问任何澄清，我将非常乐意这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T15:14:35.173

您可能想要研究的一件事是 Spring 用于管理您的事务，而不是使用工厂方法。

你在这里有很多，就像一条建议一样，我发现问题越容易消化，你得到的答案就越好，不仅仅是在 Stack Overflow 上，而是在整个互联网上。我知道在面对很多新技术时很难形成清晰的问题，我自己的问题历史有一些巨大的问题，但重要的是在请别人帮助你之前澄清你的想法和问题。您可能希望将其分解为几个问题，重点是明确提出一个问题。一般来说，如果你花时间提前提出一个明确的问题，人们会更容易帮助你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-21T14:14:20.637

是的..你是绝对正确的。对于问题格式，我深表歉意。这实际上是我第一次在 stackoverflow 上发帖，因此这个问题很丑陋。无论如何，感谢您的反馈，我试图发布更好的问题。

无论如何，我已经找到了我的问题的答案。我决定不使用控制器类，而只使用实体的会话外观 bean。我使用了容器管理的持久性。因此不再需要 getEntityManager() 方法或辅助类。而是使用“@PersistenceContext”形式的 DI。此外，由于我使用的是容器管理的持久性，因此我不再需要 UserTransactions。

# echo - nmake - 如何强制 echo 命令输出制表符？

> ID：799047
> 
> 赞同：2
> 
> 时间：2009-04-28T17:31:38.940
> 
> 标签：echo, nmake, control-characters

如何强制 echo 命令在 MS nmake makefile 中输出制表符？在 echo 命令之后插入字符串的逐字制表符被 nmake 删除，并且不会显示在输出文件中。

```
all :
    @echo I WANT TO OUTPUT THE <TAB> CHARACTER HERE! > output.txt 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-02-16T01:49:57.720

您可以使用带有**TAB**字符的变量。将此行放入您的 .bat 文件中：

set tab= **[stroke TAB char from your keyboard]**
echo a%tab%b>yourfile.txt

这样做，yourfile.txt 将包含文本 a **[TAB]** b

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T18:01:58.947

作为一种解决方法，您可以创建一个包含制表符的文件，命名为 input.txt（不使用 nmake），然后说：

```
all :
    @copy /b input.txt output.txt 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T18:50:20.110

我假设您已经尝试将标签放在引号内？

```
all:
    @echo "<TAB>" > output.txt 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-24T13:24:49.680

```
output.txt:
    <<output.txt
I WANT TO OUTPUT THE <TAB> CHARACTER HERE!
<<KEEP 
```

`<TAB>`当然，这里代表文字制表符。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-30T05:34:04.340

DOS 和 Windows 在本机批处理文件中支持丑陋的文本 :)。

这是完成任务的好方法：

1.  安装 Python 解释器
2.  编写简单的脚本，将带有指定代码的字符附加到文件中
3.  在任何你想要的地方调用脚本:)

简单的脚本：

```
'''
append_char.py - appends character with specified code to end of file

Usage:  append_char.py  filename charcode

'''
import os
import sys

filename = sys.argv[1]
assert os.path.exists(filename)

charcode = int(sys.argv[2])
assert 0 <= charcode <= 255

fh = open(filename, 'ab')
fh.seek(0, os.SEEK_END)
fh.write(chr(charcode))

fh.close() 
```

使用批处理文件中的此脚本，您可以在 Universe 中创建任何可能的文件 :)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-05-28T21:43:23.973

我也有同样的需要。我使用字符周围的引号使用了答案，并且更进一步。

{tab} 表示在文本编辑器中按键盘 Tab 键。

设置标签 =“{标签}”

SET tab=%tab:~1,1%

第二行从引用的字符串中提取中间字符。

现在您可以将 %tab% 变量与 ECHO 一起使用，而且我怀疑它可以在其他任何需要的地方使用。

ECHO %tab%此文本是缩进的，前面有一个制表符。

我怀疑这种技术也可以与其他问题角色一起使用。

# .net - 用于提取元标记的c#正则表达式问题

> ID：799049
> 
> 赞同：2
> 
> 时间：2009-04-28T17:31:48.877
> 
> 标签：.net, regex

我有这个从 HTML 文档中提取元标记的正则表达式，但是当我将它合并到我的 Web 应用程序中时它给了我错误。

表达式是

```
@"<meta[\\s]+[^>]*?name[\\s]?=[\\s\"\']+(.*?)[\\s\"\']+content[\\s]?=[\\s\"\']+(.*?)[\"\']+.*?>" ; 
```

有什么问题吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T17:37:19.613

您在发布的示例中同时使用了 @（逐字字符串）语法并转义了斜杠。您需要删除@，或删除多余的斜杠并通过将它们加倍来转义双引号，然后它应该可以工作。

（对于它的价值，如果您要持续使用正则表达式，我建议[您购买 RegExBuddy](http://www.regexbuddy.com/)的副本。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-28T17:42:30.130

使用字符串文字 (@"") 时，您不需要将反斜杠加倍——字符串中的所有内容都按原样接受——除了需要加倍的双引号：

`@"<meta[\s]+[^>]*?name[\s]?=[\s""']+(.*?)[\s""']+content[\s]?=[\s""']+(.*?)[""']+.*?>"`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T17:45:45.943

杰罗米是对的。您正在使用转义字符串和字符串文字。正则表达式本身很好......所以我想这就是问题所在。

# c# - 如何设置 SSL 环境来测试 C# 远程处理？

> ID：799057
> 
> 赞同：2
> 
> 时间：2009-04-28T17:35:37.260
> 
> 标签：c#, ssl, https, remoting

我们的客户要求我们的应用程序能够通过 HTTPS 进行通信。应用程序本身是一个 C#.NET 应用程序，一种客户端/服务器/数据库类型的应用程序。我的程序员的理解是，这是一个额外的不必要的加密层，但是因为我们的客户已经要求它，我们无论如何都会尝试提供它。

我正在寻找的是一种设置不需要我安装网络服务器的 SSL 环境的方法。尽管我们可以将我们的服务器重新编译成一个 DLL，从而允许我们通过 IIS 进行托管，但这个想法并没有让我兴奋（我们不希望我们的客户在我们的解决方案之外还必须实现 IIS）。

无论如何，我们的想法是在端口 443 上提供一个 SSL 隧道，我们的 C#.NET 远程处理数据包（它们目前是 http 数据包）可以通过。

有没有人有任何建议在这方面可能会有所帮助？我们是否需要在通信过程中添加任何额外的处理来实现这一点？（我的直觉说不，但我不是程序员。）

麦克风

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T17:40:40.977

查看 MSDN 上的这篇文章：

[.NET Remoting：编写非对称加密通道接收器](http://msdn.microsoft.com/en-us/magazine/cc300447.aspx)

第一个标头是“支持 HTTPS”

# c# - 如何确定字符串是 C# 中的有效 IPv4 还是 IPv6 地址？

> ID：799060
> 
> 赞同：82
> 
> 时间：2009-04-28T17:36:44.327
> 
> 标签：c#, .net, ip-address

我知道正则表达式对于验证 IP 地址很[危险](http://www.perlmonks.org/index.pl?node_id=221512)，因为 IP 地址可以采用不同的形式。

[我已经看到 C 和 C++ 的类似问题，这些问题已通过 C# inet_ntop()](http://beej.us/guide/bgnet/output/html/multipage/inet_ntopman.html)中不存在的函数解决

我发现的 .NET 解决方案只能处理标准的“ddd.ddd.ddd.ddd”表单。有什么建议么？

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2009-04-28T17:40:22.600

您可以使用它来尝试解析它：

```
 IPAddress.TryParse 
```

然后检查`AddressFamily`哪个

> 返回 System.Net.Sockets.AddressFamily.InterNetwork 用于 IPv4 或 System.Net.Sockets.AddressFamily.InterNetworkV6 用于 IPv6。

编辑：一些示例代码。根据需要更改：

```
 string input = "your IP address goes here";

    IPAddress address;
    if (IPAddress.TryParse(input, out address))
    {
        switch (address.AddressFamily)
        {
            case System.Net.Sockets.AddressFamily.InterNetwork:
                // we have IPv4
                break;
            case System.Net.Sockets.AddressFamily.InterNetworkV6:
                // we have IPv6
                break;
            default:
                // umm... yeah... I'm going to need to take your red packet and...
                break;
        }
    } 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2011-04-01T14:53:03.603

只是关于使用的警告`System.Net.IpAddress.TryParse()`：

如果您向它传递一个包含整数（例如“3”）的字符串，TryParse 函数会将其转换为“0.0.0.3”，因此是一个有效的 InterNetworkV4 地址。因此，至少应该将重新格式化的“0.0.0.3”返回给用户应用程序，以便用户知道他们的输入是如何被解释的。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-04-28T17:45:34.850

```
string myIpString = "192.168.2.1";
System.Net.IPAddress ipAddress = null;

bool isValidIp = System.Net.IPAddress.TryParse(myIpString, out ipAddress); 
```

如果**`isValidIp`**为真，您可以检查**`ipAddress.AddressFamily`**以确定它是 IPv4 还是 IPv6。它`AddressFamily.InterNetwork`适用于 IPv4 和`AddressFamily.InterNetworkV6`IPv6。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-02-13T22:59:19.310

您可以查看返回[,](http://msdn.microsoft.com/en-us/library/system.urihostnametype.aspx) [,](http://msdn.microsoft.com/en-us/library/system.urihostnametype.aspx) [,的](http://msdn.microsoft.com/en-us/library/system.urihostnametype.aspx)[System.Uri.CheckHostName(value)](http://msdn.microsoft.com/en-us/library/system.uri.checkhostname.aspx)。 [`Unknown``Dns``IPv4``IPv6`](http://msdn.microsoft.com/en-us/library/system.urihostnametype.aspx)

```
if( Uri.CheckHostName( value ) != UriHostNameType.Unknown)
    //then 'value' is a valid IP address or hostname 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-12-12T10:09:43.283

如果您不想解析每个整数，而只解析 IP，只需检查 `.`IPv4 和`:`IPv6。

```
 if (input.Contains(".") || input.Contains(":"))
        {
            IPAddress address;
            if (IPAddress.TryParse(input, out address))
            {
                switch (address.AddressFamily)
                {
                    case AddressFamily.InterNetwork:
                        return Ip4Address;
                    case AddressFamily.InterNetworkV6:
                        return Ip6Address;
                }
            }
        } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-08T13:59:07.570

您可以使用 IPAddress.GetAddressBytes().Length 属性

```
 IPAddress someIP;

        if (someIP.GetAddressBytes().Length == 4)
        {
            // IPV4
        }
        else (someIP.GetAddressBytes().Length == 16)
        {
            // IPV6
        }
        else
        {
            // Unknown
        } 
```

我想应该工作

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-09-21T18:26:16.970

应用于字符串或 IPAddress 的测试组合对我有用..

```
 /// <summary>
    /// Test string for valid ip address format
    /// </summary>
    /// 
    /// <param name="Address">The ip address string</param>
    /// 
    /// <returns>Returns true if address is a valid format</returns>
    public static bool IsValidIP(IPAddress Ip)
    {
        byte[] addBytes = Ip.GetAddressBytes();

        switch (Ip.AddressFamily)
        {
            case AddressFamily.InterNetwork:
                if (addBytes.Length == 4)
                    return true;
                break;
            case AddressFamily.InterNetworkV6:
                if (addBytes.Length == 16)
                    return true;
                break;
            default:
                break;
        }

        return false;
    }

    /// <summary>
    /// Test string for valid ip address format
    /// </summary>
    /// 
    /// <param name="Address">The ip address string</param>
    /// 
    /// <returns>Returns true if address is a valid format</returns>
    public static bool IsValidIP(string Address)
    {
        IPAddress ip;
        if (IPAddress.TryParse(Address, out ip))
        {
            switch (ip.AddressFamily)
            {
                case System.Net.Sockets.AddressFamily.InterNetwork:
                    if (Address.Length > 6 && Address.Contains("."))
                    {
                        string[] s = Address.Split('.');
                        if (s.Length == 4 && s[0].Length > 0 &&  s[1].Length > 0 &&  s[2].Length > 0 &&  s[3].Length > 0)
                            return true;
                    }
                    break;
                case System.Net.Sockets.AddressFamily.InterNetworkV6:
                    if (Address.Contains(":") && Address.Length > 15)
                        return true;
                    break;
                default:
                    break;
            }
        }

        return false;
    } 
```

# php - 如何让模块在 Zend 框架中工作

> ID：799065
> 
> 赞同：0
> 
> 时间：2009-04-28T17:38:41.293
> 
> 标签：php, zend-framework, access-control

尝试在 Zend Framework 应用程序中使用模块化布局时出现以下错误：

未定义索引：第 385 行 C:\PHP\includes\Zend\Controller\Dispatcher\Standard.php 中的身份验证

以下代码在此错误之前运行：

```
if (!$this->_acl->isAllowed($role, $resource, $privilege)) {
    $request->setModuleName('authentication');
    $request->setControllerName('auth');
    $request->setActionName('login');
    $request->setDispatched(false);
} 
```

在我的引导程序中，我有：

```
$frontController
    ->setParam('environment', $this->environment)
    ->setControllerDirectory(ROOT_DIR . '/controllers')
    ->addModuleDirectory(ROOT_DIR . '/modules'); 
```

我的目录结构是：

```
/ application
    / controllers
    / models
    / views
    / library
    / modules
        / Authentication
            / controllers
                AuthController.php 
```

任何想法为什么这不起作用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T17:51:56.457

区分大小写？我在文档中没有找到任何特别提到区分大小写的内容，但是所有带有模块的示例也显示模块目录名称都是小写的。

我自己最近的 ZF 应用程序使用模块，并且目录名称都是小写的。

另外，您的路由定义中是否设置了默认模块？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T01:05:13.937

出于好奇，为什么要为身份验证设置整个模块（而不是仅在默认模块中执行此操作）？

# c++ - 关于 UDP 编程我应该知道什么？

> ID：799068
> 
> 赞同：17
> 
> 时间：2009-04-28T17:40:13.287
> 
> 标签：c++, sockets, udp

我不是说如何连接到套接字。关于 UDP 编程我应该知道什么？

*   我需要担心套接字中的错误数据吗？
*   我应该假设如果我发送 200 字节，我可能会分别得到 120 和 60 字节？
*   我应该担心另一个连接在同一端口上向我发送错误数据吗？
*   如果数据通常没有到达，我可以（通常）在多长时间内看不到数据（250 毫秒？1 秒？1.75 秒？）

我真正需要知道什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-28T17:42:31.533

> “我应该假设如果我发送 200 字节，我可能会分别得到 120 和 60 字节？”

当您发送 UDP 数据报时，您的读取大小将等于您的写入大小。这是因为 UDP 是一种**数据报**协议，而不是 TCP 的**流**协议。但是，在数据包可能被路由器分段或丢弃之前，您只能写入最大 MTU 大小的数据。对于一般互联网使用，安全 MTU 为 576 字节，包括标头。

> “我应该担心另一个连接在同一个端口上向我发送坏数据吗？”

你没有连接，你有一个端口。无论数据来自何处，您都会收到发送到该端口的任何数据。由您决定它是否来自正确的地址。

> 如果数据通常没有到达，我可能（通常）在多长时间内（250 毫秒？1 秒？1.75 秒？）看不到数据

数据可能永远丢失，数据可能会延迟，数据可能会乱序到达。 **如果这些事情中的任何一个困扰您，请使用 TCP。** 在 UDP 之上编写可靠的协议是一项非常重要的任务，几乎所有应用程序都没有理由这样做。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-28T18:58:02.117

> 我应该担心另一个连接在同一端口上向我发送错误数据吗？

是的，你应该担心它。任何应用程序都可以随时向您开放的 UDP 端口发送数据。UDP 的一大用途是多对一风格的通信，在这种通信中，您可以使用在单个端口上与多个对等方进行多路通信，使用在传输期间传回的地址`recvfrom`来区分对等方。

但是，如果您想避免这种情况并且只接受来自单个对等方的数据包，您实际上可以`connect`在您的 UDP 套接字上调用。这会导致 IP 堆栈拒绝来自任何主机：端口组合（套接字）的数据包，而不是您要与之交谈的数据包。

调用 UDP 套接字的第二个优点`connect`是，在许多操作系统中，它显着提高了速度/延迟。当您调用`sendto`未连接的 UDP 套接字时，操作系统实际上会临时连接套接字，发送您的数据，然后断开套接字，这会增加大量开销。

使用连接的 UDP 套接字的第三个优点是它允许您将 ICMP 错误消息接收回您的应用程序，例如由于崩溃而导致的路由或主机未知。如果未连接 UDP 套接字，操作系统将不知道将 ICMP 错误消息从网络传递到何处，并将静默丢弃它们，这可能会导致您的应用程序在等待崩溃主机的响应时挂起（或等待您的选择超时）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-28T17:49:31.767

您的数据包可能无法到达那里。

您的数据包可能会到达那里两次甚至更多次。

您的数据包可能不按顺序排列。

您对底层网络层施加的数据包有大小限制。数据包大小可能非常小（可能为[576](http://www.tcpipguide.com/free/t_IPDatagramSizetheMaximumTransmissionUnitMTUandFrag-4.htm)字节）。

这些都不是说“不要使用UDP”。但是，您应该了解以上所有内容，并考虑您可能想要采取的恢复选项。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-28T17:58:46.690

碎片和重组发生在 IP 级别，因此您不必担心[（维基百科）](http://en.wikipedia.org/wiki/IPv4#Fragmentation_and_reassembly)。（这意味着您不会收到拆分或截断的数据包）。

UDP 数据包具有数据和标头的校验和，因此不太可能接收到虚假数据，但有可能。丢失或重复的数据包也是可能的。无论如何，您都应该检查您的数据。

没有拥塞控制，因此如果您打算用大量 UDP 数据包堵塞管道，您可能希望考虑这一点。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-28T17:58:06.380

UDP 是一种无连接协议。通过 UDP 发送数据可以到达接收方，但也可能在传输过程中丢失。UDP 非常适合广播和流式传输音频或视频（即在这些情况下丢弃的数据包永远不会成为问题。）因此，如果您需要确保数据到达另一端，请坚持使用 TCP。

UDP 的开销比 TCP 少，因此速度更快。（TCP 需要先建立连接，还要检查数据包是否有数据损坏，这需要时间。）

分段的 UDP 数据包（即大于约半 Kb 的数据包）可能会被路由器丢弃，因此在发送之前将您的数据分成小块。（在某些情况下，操作系统可以解决这个问题。）请注意，它总是一个可能会成功的数据包，也可能不会。一半数据包未处理。

长距离的延迟可能非常大。如果你想重新传输数据，我会选择当前连接上老化延迟时间的 5 到 10 倍。（您可以通过发送和接收几个数据包来测量延迟。）

希望这可以帮助。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-12-18T14:06:01.720

我不会和其他回答这个问题的人一起效仿，他们似乎都将你推向 TCP，这根本不是为了游戏，除了登录/聊天信息。让我们按顺序进行：

> 我需要担心套接字中的错误数据吗？

是的。即使 UDP 包含一个非常简单的路由器校验和等，它也不是 100% 有效的。您可以添加自己的校验和设备，但大多数时候在可靠性已经不是问题的情况下使用 UDP，因此应该丢弃不符合要求的数据。

> 我应该假设如果我发送 200 字节，我可能会分别得到 120 和 60 字节？

不，UDP 是直接数据写入和读取。但是，如果数据太大，某些路由器会截断，您会永久丢失部分数据。有些人说大约 576 字节带有标题，我个人不会使用超过 256 字节（漂亮的圆形 log2 数）。

> 我应该担心另一个连接在同一端口上向我发送错误数据吗？

UDP 在端口上侦听来自任何计算机的任何数据，所以从这个意义上说是的。另请注意，UDP 是一种原始格式，原始格式可用于伪造发送者，因此您应该使用某种“密钥”，以便侦听器根据其 IP 验证发送者。

> 如果数据通常没有到达，我可以（通常）在多长时间内看不到数据（250 毫秒？1 秒？1.75 秒？）

在 UDP 上发送的数据通常是一次性的，所以如果你没有收到数据，那么它很容易被忽略......但是，有时你想要“半可靠”但你不想要像 TCP 使用的“有序可靠”， 1 秒是一个很好的下降估计。您可以在轮换中对数据包进行编号并编写自己的 ACK 通信。当接收到一个数据包时，它会记录数字并发送回一个位域，让发送者知道它收到了哪些数据包。您可以阅读此未完成的文档以获取更多信息（尽管未完成，但它仍然会产生有用的信息）：

[http://gafferongames.com/networking-for-game-programmers/](http://gafferongames.com/networking-for-game-programmers/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-28T17:44:25.617

尝试使用 UDP 时要知道的一件大事是：

您的数据包可能不会全部通过线路，这意味着可能存在数据损坏。

如果您正在开发的应用程序需要 100% 的数据可靠地到达以提供功能，请使用 TCP。如果您正在开发允许一些丢失的应用程序（流媒体等），那么请使用 UDP，但不要指望一切都可以从一个管道完好无损地传输到另一个管道。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-28T18:09:23.047

除了 don.neufeld 建议使用 TCP。

对于大多数应用程序，TCP 更容易实现。如果您需要在 TCP 流中维护数据包边界，一个好方法是在数据之前传输两个字节的标头来分隔消息。标头应包含消息长度。在接收端只需读取两个字节并评估值。然后等到你收到那么多字节。然后，您将获得一条完整的消息，并准备好接收下一个 2 字节标头。

这为您提供了 UDP 的一些好处，而没有丢失数据、无序数据包到达等的麻烦。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-28T18:21:28.900

查看适用于 UDP 与 TCP 的应用程序之间差异的一种方法是，当数据传递“迟到总比不迟”时，TCP 是好的，而当数据传递“比迟到好”时，UDP 是好的。

另一方面是大多数基于 UDP 的应用程序的无状态、尽力而为的特性可以使可伸缩性更容易实现。另请注意，UDP 可以多播，而 TCP 不能。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-28T17:43:16.620

并且不要假设如果您发送一个数据包，它就会到达那里。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-28T17:52:05.053

如果沿途某些路由器施加了数据包大小限制，则您的 UDP 数据包可能会被静默截断为该大小。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-28T18:07:10.447

两件事情：

1）您可能会或可能不会收到发送的内容

2) 无论您收到什么，都可能与发送时的顺序不同。

# sql - 使用附加条件计算分组查询中的记录

> ID：799070
> 
> 赞同：2
> 
> 时间：2009-04-28T17:40:26.673
> 
> 标签：sql, mysql

我有一个包含这些相关字段的报告表：

```
user_id (int 11)
submitted_date (datetime)
approved_flag (shortint 1) 
```

每个 有多个行`user_id`，有些为`approved_flag`= 0，有些为`approved_flag`= 1，每行都有一个唯一的`submitted_date`。

我需要统计已批准和未批准的报告。但我只想计算每个用户最近提交的报告（最近`submitted_date`的），不管`approved_flag`.

因此，如果有 4 条这样的记录：

```
    user_id、submitted_date、approved_flag
    1, 2009-04-01 01:00, 1
    1, 2009-04-01 02:00, 0
    1, 2009-04-01 03:00, 1（使用此记录）
    2, 2009-04-02 01:00, 1（使用此记录）

```

计数将是 2 批准，没有未批准，如果我们有

```
    user_id、submitted_date、approved_flag
    1, 2009-04-01 01:00, 1
    1, 2009-04-01 02:00, 0
    1, 2009-04-01 03:00, 0 (使用这条记录)
    2, 2009-04-02 01:00, 0
    2, 2009-04-02 02:00, 1（使用此记录）

```

计数将是 1 个已批准（用户 ID 2）和 1 个未批准（用户 ID 1）。

再总结一次，因为它不容易描述：我想要表中唯一用户的总数（不管每个用户有 # 行），并且我希望它根据“已批准”和“未批准”分解为每个用户的`approved_flag`最新报告。

任何帮助将不胜感激，谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T18:02:10.007

```
SELECT approved_flag, COUNT(*)
FROM 
  Table t
  INNER JOIN (
    SELECT user_id, submitted_date = MAX(submitted_date)
    FROM Table
    GROUP BY user_id
  ) latest ON latest.user_id = t.user_id
              AND latest.submitted_date = t.submitted_date
GROUP BY approved_flag 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T18:12:53.037

可以想出两种方法来做到这一点。第一个可能是最易读的，搜索每个用户最后提交的日期，然后显示带有该时间戳的批准：

```
select a.user_id, a.submitted_date, a.approved_flag
from approvals a
inner join (
    select user_id, maxdt = max(submitted_date)
    from approvals
    group by user_id
) latest on latest.user_id = a.user_id 
    and latest.maxdt = a.submitted_date 
```

第二个是将表加入同一用户的未来行，并在 where 子句中指定这些行不存在。这为您提供了每个用户的最新条目：

```
select cur.user_id, cur.submitted_date, cur.approved_flag
from approvals cur
left join approvals next
    on next.user_id = cur.user_id
    and next.submitted_date > cur.submitted_date
where next.user_id is null 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T17:55:39.430

```
SELECT user_id, approved_flag, COUNT(*)
FROM reports 
WHERE NOW() - submitted_date < 'whatever'
GROUP BY user_id, approved_flag 
```

希望它有效..

# c# - 将 std::string 从 C++ DLL 返回到 ac# 程序 -> 指定给 RtlFreeHeap 的地址无效

> ID：799076
> 
> 赞同：10
> 
> 时间：2009-04-28T17:42:21.083
> 
> 标签：c#, c++, string, marshalling

在我的 C++ DLL 中的一个函数中，我将一个 std::string 返回到我的 c# 应用程序。它看起来像这样：

```
std::string g_DllName = "MyDLL";

extern "C" THUNDER_API const char* __stdcall GetDLLName()
{
    return g_DllName.c_str();
} 
```

但是当我的 C# 代码调用此函数时，我在输出窗口中收到此消息：

```
Invalid Address specified to RtlFreeHeap( 00150000, 0012D8D8 ) 
```

c# 中的函数声明如下所示：

```
[DllImport("MyDll", EntryPoint = "GetDLLName")]
    [return: MarshalAs(UnmanagedType.LPStr)]
    public static extern string GetDLLName(); 
```

根据我在网上找到的信息，有时当与删除一起使用的新版本（调试或发布等）之间存在不一致时，会出现此消息。但我不确定这是否是我的情况。所以我不确定是什么原因造成的。也许 MashallAs 可能与此有关？

有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-28T18:16:33.607

我设法找到了问题。这是 C# 定义的完成方式。据我了解，将 MarshallAs(UnmanagedType.LPStr) 与字符串返回类型结合使用可以使它在完成后尝试释放字符串。但是因为字符串来自 C++ DLL，而且很可能是完全不同的内存管理器，所以它失败了。即使它没有失败，我也不希望它被释放。

我找到的解决方案是将 C# 声明更改为此（C++ 代码未更改）：

```
[DllImport("MyDll", EntryPoint = "GetDLLName")]
public static extern IntPtr GetDLLName(); 
```

所以这使得它只返回一个指向字符串数据的指针。然后将其更改为字符串，将其传递给 Marshal.PtrToStringAnsi()

```
return Marshal.PtrToStringAnsi(GetDLLName()); 
```

这被包装到另一个清洁功能中。

我从这个页面找到了解决方案： [http ://discuss.fogcreek.com/dotnetquestions/default.asp?cmd=show&ixPost=1108](http://discuss.fogcreek.com/dotnetquestions/default.asp?cmd=show&ixPost=1108)

# ruby-on-rails - Thinking Sphinx - RuntimeError: Missing Attribute for Foreign Key

> ID：799085
> 
> 赞同：0
> 
> 时间：2009-04-28T17:43:48.800
> 
> 标签：ruby-on-rails, ruby, sphinx, thinking-sphinx

第一次尝试与 Sphinx/Thinking Sphinx 相处。

我的模型定义如下（简化）：

```
class Branch < ActiveRecord::Base
  has_many  :salesmen, :class_name => "User"
  has_many :leads, :through => :salesmen
end

class User < ActiveRecord::Base
  belongs_to :branch
  has_many :leads, :foreign_key => "owner_id"
end

class Lead < ActiveRecord::Base
  belongs_to :owner, :class_name => "User"

  define_index do
    indexes company_name    
    indexes :name, :sortable => true
    has owner.branch_id, :as => :branch_id
    indexes [owner.last_name, owner.first_name], :as => :owner_full_name, :sortable => true 
  end

end 
```

任何时候我打电话

```
Branch.first.leads.search 
```

我明白了

```
RuntimeError: Missing Attribute for Foreign Key branch_id 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T20:25:22.937

问题是 Thinking Sphinx 需要`branch_id`作为索引中的一个属性，因此它可以将结果限制为相关分支（因为您正在关联中搜索）。

从您的协会（或者可能只是我对睡眠的迫切需要）中尚不清楚潜在客户是通过所有者还是直接属于分支机构。如果是前者，Ben 的建议可能是正确的。否则，请尝试将以下内容添加到您的`define_index`块中：

```
has branch_id, :as => :direct_branch_id 
```

阅读评论后，另一种方法是将您自己的搜索方法添加到 Branch 中的潜在客户关联中。一个模糊的尝试（你需要调试，我敢肯定）：

```
has_many :leads, :through => :salesmen do
  def search(*args)
    options = args.extract_options!
    options[:with] ||= {}
    options[:with][:branch_id] = proxy_owner.id
    args << options
    Lead.search(*args)
  end
end 
```

这应该可以解决您没有直接引用 Lead 分支的事实。唯一可能的问题是我不确定自定义扩展是在 Thinking Sphinx 注入之前还是之后加载的。试一试，看看有没有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T23:58:59.680

如果您说 Lead `belongs_to`a Branch，那么您必须`branch_id`在潜在客户表中有一个。既然你没有，那就不是`belongs_to`关系。我认为你需要这样的东西：

```
class Branch < ActiveRecord::Base
  has_many :leads, :through => :salesmen
  has_many :salesmen, :class_name => "User" 
end

class User < ActiveRecord::Base
  belongs_to :branch # users table has branch_id
  has_many :leads, :foreign_key => "owner_id"
end

class Lead < ActiveRecord::Base
  belongs_to :owner, :class_name => "User" # leads table has owner_id

  define_index do
    indexes :company_name    
    indexes :name, :sortable => true
    has owner.branch_id, :as => :branch_id
    indexes [owner.last_name, owner.first_name], :as => :owner_full_name, :sortable => true 
  end

end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T18:48:07.557

我相信您在分支关系中缺少 :through 选项。尝试更新为：

```
class Lead < ActiveRecord::Base
  has_one :branch, :through => :owner 
```

# c++ - 跟踪 MFC 消息处理

> ID：799090
> 
> 赞同：0
> 
> 时间：2009-04-28T17:44:14.213
> 
> 标签：c++, debugging, mfc, mfc-feature-pack

尝试升级 MFC 应用程序以使用新的 MFC 功能包时，我们会丢失上下文菜单中的消息。出现菜单并可以单击，但该消息似乎无法在任何地方处理。我们在很多地方覆盖了 OnCmdMsg() 但无济于事，上下文菜单的命令消息未被捕获。

是否有跟踪消息的方法、工具或方法？
任何其他想法如何解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T18:11:55.660

试试间谍++

[> ...可以在 Windows 的“程序”或“所有程序”菜单中找到。单击 Microsoft Visual Studio 9.0，然后单击 Visual Studio 工具。](http://msdn.microsoft.com/en-us/library/76712d27.aspx)

提供系统进程、线程、窗口和窗口消息的图形视图。有关详细信息，请单击工具中的帮助。

我在[这个答案](https://stackoverflow.com/questions/663489/software-to-monitor-events-fired-from-code/664845#664845)中解释了更多关于 2005 年 Spy++ 的信息。

# web-applications - 您最喜欢的影响分析工具是什么

> ID：799091
> 
> 赞同：3
> 
> 时间：2009-04-28T17:44:17.037
> 
> 标签：web-applications, code-analysis

您最喜欢的影响分析工具是什么？

尤其是在 Web 应用程序的上下文中，考虑到您的代码引用可能至少有 4 种语言（java、jsp、velocity 模板、javascript、html 和不祥的 xml），IDE 不能总是帮助您。

到目前为止，我已经做到了`find`，`grep`还有更好的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-27T04:42:13.300

请参阅我们的[源代码搜索引擎](http://www.semdesigns.com/Products/SearchEngine/index.html)。它可以跨多种语言“grep”，但它知道每种语言的语法（注释、关键字、字符串、变量名、数字……），因此可以更仔细地集中搜索。对于网页分析，它懂PHP、JavaScript、HTML、C#、Java、JSP，以及C、C++、COBOL、Fortran等语言。通过根据语言标记索引所有文件，它可以处理 25-50 百万行代码的搜索，几乎是即时响应时间。它显示匹配项，并在每个匹配项上提供单击查看源。

# java - 在 2 个表之间拆分 Hibernate 实体

> ID：799093
> 
> 赞同：2
> 
> 时间：2009-04-28T17:44:36.070
> 
> 标签：java, hibernate, jpa, jakarta-ee, orm

我有一个简单的类层次结构，我正在尝试使用 Hibernate/JPA。

基本上我想要的是运动数据在它自己的表中，并带有一个 FK 到数据库中主车辆表的整数 id。

难道我做错了什么？我还能如何完成类似的事情？我很确定我正在遵循 JPA 规范。（EJB3 In Action 说这应该可以工作：[EJB3 In Action: @SecondaryTable](http://books.google.com/books?id=j4Qf2iLL488C&pg=PA266&vq=%40secondarytable&dq=ejb3+in+action&source=gbs_search_s&cad=0)

这是我得到的异常的一部分：

```
SEVERE: an assertion failure occured (this may indicate a bug in Hibernate, but is more likely due to unsafe use of the session)
org.hibernate.AssertionFailure: Table MOVEMENT_DATA not found
    at org.hibernate.persister.entity.JoinedSubclassEntityPersister.getTableId(JoinedSubclassEntityPersister.java:480)
    at org.hibernate.persister.entity.JoinedSubclassEntityPersister.<init>(JoinedSubclassEntityPersister.java:259)
    at org.hibernate.persister.PersisterFactory.createClassPersister(PersisterFactory.java:87)
    at org.hibernate.impl.SessionFactoryImpl.<init>(SessionFactoryImpl.java:261)
    at org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:1327) 
```

这是来自 Hibernate 的一些与车辆有关的日志记录信息......看起来它可以识别一切正常......然后它出于某种原因抛出异常。

```
INFO: Binding entity from annotated class: com.dataobject.Vehicle
FINE: Import with entity name Vehicle
INFO: Bind entity com.dataobject.Vehicle on table VEHICLE
INFO: Adding secondary table to entity com.dataobject.Vehicle -> MOVEMENT_DATA
FINE: Processing com.dataobject.Vehicle property annotation
FINE: Processing annotations of com.dataobject.Vehicle.id
FINE: Binding column id. Unique false. Nullable false.
FINE: id is an id
FINE: building SimpleValue for id
FINE: Building property id
FINEST: Cascading id with null
FINE: Bind @Id on id
FINE: Processing annotations of com.dataobject.Vehicle.color
FINE: Binding column COLOR. Unique false. Nullable true.
FINE: binding property color with lazy=false
FINE: building SimpleValue for color
FINE: Building property color
FINEST: Cascading color with null
FINE: Processing annotations of com.dataobject.Vehicle.movementData
FINE: Binding column movementData. Unique false. Nullable true.
FINE: Binding component with path: com.dataobject.Vehicle.movementData
FINE: Processing com.dataobject.MovementData property annotation
FINE: Processing annotations of com.dataobject.MovementData.latitude
FINE: Column(s) overridden for property latitude
FINE: Binding column LATITUDE. Unique false. Nullable true.
FINE: binding property latitude with lazy=false
FINE: building SimpleValue for latitude
FINE: Building property latitude
FINEST: Cascading latitude with null
FINE: Processing annotations of com.dataobject.MovementData.longitude
FINE: Column(s) overridden for property longitude
FINE: Binding column LONGITUDE. Unique false. Nullable true.
FINE: binding property longitude with lazy=false
FINE: building SimpleValue for longitude
FINE: Building property longitude
FINEST: Cascading longitude with null
FINE: Processing annotations of com.dataobject.MovementData.speed
FINE: Column(s) overridden for property speed
FINE: Binding column SPEED. Unique false. Nullable true.
FINE: binding property speed with lazy=false
FINE: building SimpleValue for speed
FINE: Building property speed
FINEST: Cascading speed with null
FINE: Processing annotations of com.dataobject.MovementData.timeOfPosition
FINE: Column(s) overridden for property timeOfPosition
FINE: Binding column TIME_OF_POSITION. Unique false. Nullable true.
FINE: binding property timeOfPosition with lazy=false
FINE: building SimpleValue for timeOfPosition
FINE: Building property timeOfPosition
FINEST: Cascading timeOfPosition with null
FINE: Building property movementData
FINEST: Cascading movementData with null
FINE: Processing annotations of com.dataobject.Vehicle.numWheels
FINE: Binding column NUM_WHEELS. Unique false. Nullable true.
FINE: binding property numWheels with lazy=false
FINE: building SimpleValue for numWheels
FINE: Building property numWheels
FINEST: Cascading numWheels with null
INFO: Binding entity from annotated class: com.dataobject.Car
FINE: Binding column id. Unique false. Nullable false.
FINE: Subclass joined column(s) created
FINE: Import with entity name Car
INFO: Bind entity com.dataobject.Car on table CAR
FINE: Processing com.dataobject.Car property annotation
FINE: Processing annotations of com.dataobject.Car.make
FINE: Binding column MAKE. Unique false. Nullable true.
FINE: binding property make with lazy=false
FINE: building SimpleValue for make
FINE: Building property make 
```

**Vehicle 是父类**

```
/**
 * Entity implementation class for Entity: Vehicle
 *
 */
@Entity
@Table(name="VEHICLE")
@Inheritance(strategy=InheritanceType.JOINED)
@SecondaryTable(name="MOVEMENT_DATA",
            pkJoinColumns = {
                @PrimaryKeyJoinColumn(name = "ID") 
            } 
)
public class Vehicle implements Serializable {

    private int numWheels;
    private String color;
    private int id;
    private MovementData movementData;
    private static final long serialVersionUID = 1L;

    public Vehicle() {
        super();
    }   

    @Embedded
    @AttributeOverrides( {
    @AttributeOverride(
        name = "speed",
        column = @Column(name = "SPEED",
                         table = "MOVEMENT_DATA")
    ),
    @AttributeOverride(
        name = "timeOfPosition",
        column = @Column(name = "TIME_OF_POSITION",
                         table = "MOVEMENT_DATA")
    ),
    @AttributeOverride(
            name = "longitude",
            column = @Column(name = "LONGITUDE",
                             table = "MOVEMENT_DATA")
        ),
   @AttributeOverride(
            name = "latitude",
            column = @Column(name = "LATITUDE",
                             table = "MOVEMENT_DATA")
        )
})
    public MovementData getMovementData() {
        return movementData;
    }
    public void setMovementData(MovementData movementData) {
        this.movementData = movementData;
    }

    @Column(name="NUM_WHEELS")
    public int getNumWheels() {
        return this.numWheels;
    }

    public void setNumWheels(int numWheels) {
        this.numWheels = numWheels;
    }   
    @Column(name="COLOR")
    public String getColor() {
        return this.color;
    }

    public void setColor(String color) {
        this.color = color;
    }   
    @Id    
    public int getId() {
        return this.id;
    }

    public void setId(int id) {
        this.id = id;
    }

} 
```

**汽车延伸车辆**

```
/**
 * Entity implementation class for Entity: Car
 */
@Entity
@Table(name="CAR")
public class Car extends Vehicle implements Serializable {

    private String make;
    private static final long serialVersionUID = 1L;

    public Car() {
        super();
    }   
    /**
     * @return
     */
    @Column(name="MAKE")
    public String getMake() {
        return this.make;
    }

    /**
     * @param make
     */
    public void setMake(String make) {
        this.make = make;
    }

} 
```

**运动数据嵌入车辆**

```
@Embeddable
public class MovementData implements Serializable {

    private double speed;
    private Date timeOfPosition;
    private double latitude;
    private double longitude;
    private static final long serialVersionUID = 1L;

    public MovementData() {
        super();
    }   

    /**
     * @return
     */
    @Column(name="SPEED")
    public double getSpeed() {
        return this.speed;
    }

    /**
     * @param speed
     */
    public void setSpeed(double speed) {
        this.speed = speed;
    }   
    /**
     * @return
     */
    @Column(name="TIME_OF_POSITION")
    public Date getTimeOfPosition() {
        return this.timeOfPosition;
    }

    /**
     * @param timeOfPosition
     */
    public void setTimeOfPosition(Date timeOfPosition) {
        this.timeOfPosition = timeOfPosition;
    }   

    /**
     * @return
     */
    @Column(name="LONGITUDE")
    public double getLongitude() {
        return this.longitude;
    }

    /**
     * @param longitude
     */
    public void setLongitude(double longitude) {
        this.longitude = longitude;
    }
    /**
     * @return
     */
    @Column(name="LATITUDE")
    public double getLatitude() {
        return this.latitude;
    }

    /**
     * @param latitude
     */
    public void setLatitude(double latitude) {
        this.latitude = latitude;
    }   

} 
```

**持久化单元：**

```
 <properties>
        <!-- The database dialect to use -->
        <property name="hibernate.dialect" value="org.hibernate.dialect.PostgreSQLDialect" />
        <!-- drop and create tables at deployment -->
        <property name="hibernate.hbm2ddl.auto" value="create-drop" />
        <!-- Hibernate Query Language (HQL) parser. -->
        <!-- property name="hibernate.cache.provider_class" value="net.sf.ehcache.hibernate.EhCacheProvider" /-->
        <!-- property name="hibernate.cache.provider_class" value="org.hibernate.cache.JbossCacheProvider" /-->
        <property name ="hibernate.show_sql" value="false" />
        <property name ="hibernate.format_sql" value="false" />
        <property name="hibernate.cache.provider_class" value="net.sf.ehcache.hibernate.SingletonEhCacheProvider" />
    </properties> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-11-09T19:06:28.110

我想它为时已晚，但我在寻找其他东西时偶然发现了这个问题。

问题是 Embeddable 类没有映射到表 - Embeddable 对象在数据库中没有标识。

这就是为什么没有生成 MovementData 表的原因。

我认为您混淆了嵌入式的含义。正如之前的评论者所提到的，Vehicle 和 MovementData 应该是 OneToOne 关系，并且应该删除 Embedded annotations。您可能需要 Cascade Remove 规则来确保如果车辆被移除，MovementData 也会被移除。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-04T14:01:57.723

我会尝试分解它以找到问题。尝试将运动数据制作成实体而不是可嵌入类。确保它可以独立存在，然后将其改回可嵌入的。

虽然它不是您真正想要的关系，但您可以尝试将 MovementData 设为根父级，并让 Vehicle 继承 MovementData。这样你就只能和

```
@Inheritance(strategy=InheritanceType.JOINED) 
```

而不是继承加secondaryTable。它将简化关系，但仍包括所有表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T13:57:51.973

在开发过程中，启用此属性通常很方便：

```
cfg.setProperty(Environment.HBM2DDL_AUTO, "update"); 
```

其中 cfg 是我的 AnnotationConfiguration。

启用此属性很可能会解决您的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T18:28:18.133

从您发布的异常来看，该表似乎尚未在您的数据库中创建（“找不到表 MOVEMENT_DATA”）。如果您没有指示 Hibernate/JPA 更改您的模式，则必须在运行代码之前手动添加表（我相信它是 CREATE-UPDATE 来指示 hibernate 执行更改）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-02T04:30:41.933

可嵌入类的定义*不应*引用数据库表：

```
@Embeddable
public class MovementData implements Serializable {

    private double speed;
    private Date timeOfPosition;
    private double latitude;
    private double longitude;
    private static final long serialVersionUID = 1L;

    public MovementData() {
        super();
    }   

    @Column(name="SPEED")
    public double getSpeed() {
        return this.speed;
    }

    ...

    @Column(name="TIME_OF_POSITION")
    public Date getTimeOfPosition() {
        return this.timeOfPosition;
    }

    ...

    @Column(name="LONGITUDE")
    public double getLongitude() {
        return this.longitude;
    }

    ...

    @Column(name="LATITUDE")
    public double getLatitude() {
        return this.latitude;
    }

    ...
} 
```

然后 Vehicle 实体应该为*包含连接列*的嵌入式结构定义辅助表：

```
@Entity
@Table(name="VEHICLE")
@Inheritance(strategy=InheritanceType.JOINED)
@SecondaryTable(name="MOVEMENT_DATA",
                pkJoinColumns = {
                    @PrimaryKeyJoinColumn(name = "ID") 
                } 
)
public class Vehicle implements Serializable {

    private int numWheels;
    private String color;
    private int id;
    private MovementData movementData;
    private static final long serialVersionUID = 1L;

    public Vehicle() {
        super();
    }   

    @Embedded
    @AttributeOverrides( {
        @AttributeOverride(
            name = "speed",
            column = @Column(name = "SPEED",
                             table = "MOVEMENT_DATA")
        ),
        @AttributeOverride(
            name = "timeOfPosition",
            column = @Column(name = "TIME_OF_POSITION",
                             table = "MOVEMENT_DATA")
        ),

        ... // override the rest of the attributes

    } )
    public MovementData getMovementData() {
        return movementData;
    }

    ...

    @Id    
    public int getId() {
        return this.id;
    }

    ...
} 
```

我希望这对你有用。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-06T14:22:15.957

使用适当的数据库客户端（查询浏览器、MS SQL 管理工作室等）连接到数据库，以验证表是否确实存在。

您可能还想在代码中插入断点，以便您可以准确地看到数据库在引发此错误之前的样子。

尝试将 hibernate.hbm2ddl.auto 值设置为“create”，如下所示，并更改设置以便它打印出 SQL，以便您可以看到它正在尝试什么：

```
<props>
  <!-- some possible values: create, create-drop, update -->
  <prop key="hibernate.hbm2ddl.auto">update</prop>
  <prop key="hibernate.show_sql">true</prop>
  ....
<props> 
```

让我知道您在数据库中看到的内容。

# c# - 如何以编程方式列出已安装的视频编解码器？

> ID：799097
> 
> 赞同：2
> 
> 时间：2009-04-28T17:45:39.203
> 
> 标签：c#, list, video, codec

您知道如何以编程方式从 Windows 窗体中获取计算机上安装的视频编解码器列表吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T19:07:11.363

Windows 窗体是 UI 元素，因此它们不会帮助您。

就检索视频编解码器列表而言，概括地说：

1.  使用[DirectShow](https://stackoverflow.com/questions/30539/best-way-to-enumerate-all-available-video-codecs-on-windows)
2.  您可以从包含编解码器信息的各种注册表项中读取
3.  您可以检查您正在寻找的编解码器的文件位置
4.  您可以尝试在内部打开视频文件并捕获不存在编解码器的异常。这可能需要一些自定义代码或 API

此外，为了将来参考，一般说“我需要代码”不会给你带来有利的回应。

# asp.net - 可以读取/写入两个不同的 ASP.NET Web 应用程序使用的 cookie？

> ID：799099
> 
> 赞同：1
> 
> 时间：2009-04-28T17:46:35.190
> 
> 标签：asp.net, cookies

想知道我的声明感知应用程序 (ASP.NET) 是否可以保存一个可由 ADFS 服务 (ASP.NET 也) 读取的 cookie。这样我就可以在基于子域的 SSO 时为其提供特定客户端的 URN。但是我不确定一个网站是否可以读取来自不同网站的 cookie。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T17:54:23.957

我认为这是可能的，但前提是两个 web 应用程序都在同一个域上。以下问题，尤其是标记的答案，处理类似的问题：

[同步不同子域中的 cookie 和会话 (asp.net)](https://stackoverflow.com/questions/444018/sync-cookies-and-sessions-in-different-subdomains-asp-net)

如果可以用不同的域来做，那将是一个巨大的安全风险。然后，您访问的任何其他网站都可以读取您的 cookie。所以我认为这是不可能的。但如果我错了，请有人纠正我。

更多信息@MSDN：http: [//msdn.microsoft.com/en-us/library/ms178194.aspx](http://msdn.microsoft.com/en-us/library/ms178194.aspx)。请参阅“*限制 Cookie 域范围*”部分。

# sql - 更改具有外键的表（sql server）中的记录？

> ID：799100
> 
> 赞同：1
> 
> 时间：2009-04-28T17:47:25.627
> 
> 标签：sql, sql-server, database, foreign-keys

有谁知道是否有更快的方法来编辑表中具有外键的记录（在 sql server 中）.. 我会解释.. 我有大约 5 个表，它们有自己的 ID，但使用外键链接在一起...

因此我需要更改外键（在我的情况下是合同号），但我必须将每条记录复制到新记录并以这种方式进行编辑......

好像我尝试编辑合同号一样，它给了我关联的标准错误并违反了外键等

肯定有更好的方法吗？

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-28T17:52:26.393

您是在谈论更改PK然后更新所有Fks吗？在这种情况下，启用级联更新，这将自动与删除相同，您启用级联删除

删除级联

指定如果尝试删除具有由其他表中现有行中的外键引用的键的行，则包含这些外键的所有行也将被删除。如果还对目标表定义了级联引用操作，则还会对从这些表中删除的行执行指定的级联操作。

更新级联

指定如果尝试更新行中的键值，其中键值由其他表中现有行中的外键引用，则所有外键值也将更新为为键指定的新值。如果级联引用操作

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T17:50:55.120

我不是 SQL 专家，但你不能设置类似 ON UPDATE CASCADE 的东西来在主键更改时自动更新外键吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T17:53:12.960

或者尝试禁用完整性约束，进行更改并尝试重新启用约束。基本上，如果你没有做对，那么你会得到一个错误（不能启用会被违反的约束）。

# php - Symfony - 如何在我的学说迁移中插入行为？

> ID：799103
> 
> 赞同：1
> 
> 时间：2009-04-28T17:48:51.490
> 
> 标签：php, symfony1, doctrine, migration, behavior

是否可以在学说迁移中添加行为（例如 actAs Timestampable）以避免定义 created_at 和 updated_at 列？

提前致谢 ！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:19:49.197

我认为没有办法在迁移代码中添加行为。

但！如果您使用的是教义 1.1（很容易从 1.0 迁移），您可以改为修改架构，添加行为，并让教义生成迁移代码，如下所述：

[http://www.doctrine-project.org/blog/new-to-migrations-in-1-1](http://www.doctrine-project.org/blog/new-to-migrations-in-1-1)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:33:00.857

供参考

[http://groups.google.com/group/doctrine-user/browse_thread/thread/5957eb2ad2dcb407#](http://groups.google.com/group/doctrine-user/browse_thread/thread/5957eb2ad2dcb407#)

# c# - 私有局部变量的下划线？

> ID：799105
> 
> 赞同：3
> 
> 时间：2009-04-28T17:49:12.050
> 
> 标签：c#, .net

BCL 似乎就是对私有局部变量使用下划线。我从不使用它们，但像这样离开：

```
int count = 0;

this.Count++;

public int Count
...

public ClassName ( int count )
{
    this.Count = count;
} 
```

您对此有何看法？他们是我的方法的问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T17:52:34.663

这基本上是您必须自己决定的事情，只需找到或制作风格指南并遵循它。

就个人而言，我使用 _ 作为类的私有字段的前缀。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T18:06:32.350

我们在这里使用的简单规则是：一个类的私有实现细节，包括变量名，完全取决于制作它的开发人员。公共/受保护的方法名称、属性、类名称等均受最佳实践指南的约束。内部类型甚至可以被认为是其中的一部分，因为它们不是公开可见的。

当其他人需要使用您的库时，它永远不必使用内部或私有类型，也不会查看您是否使用下划线等。换句话说，这真的取决于您....

请记住，如果其他人必须稍后维护您的代码，那么它不应该太混淆......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T17:53:42.617

不需要使用下划线来表示私有变量。这都是个人喜好。我只使用它们，所以我知道我使用的是局部变量，而不是让 Intellisense 不小心使用了我的公共属性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T17:53:46.797

IMO，就此而言，您永远不应将私有成员变量命名为与属性、方法或其他任何名称相同的名称。应该清楚您正在使用哪个命名项目。这将使您的代码更易于理解和维护，并将减少您自己或其他需要维护您的代码的开发人员的编程错误。

此外，如果您想将代码移植到 VB，则该特定命名将不起作用。不知道为什么要切换到 VB，但它确实发生了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-28T17:53:59.293

我使用下划线。它帮助我控制变量范围并减少命名冲突的可能性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-28T17:56:07.057

下划线对于不区分大小写的语言（如 VB.Net）更有意义。在像 C# 这样的语言中，它完全取决于个人喜好。

如果你不喜欢把`this.`一些模棱两可的作业放在前面，那么下划线就适合你。没有它们，你偶尔会不小心做这样的事情：

```
private int that;

public void AssignThat(int that)
{
    that = that;  // assigns to method scope variable, not instance scope
} 
```

FXCop 或 R# 应该为您捕捉到这一点，我*相信*您会收到编译器警告，但这是可能的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T18:04:30.063

使用前缀 IntelliSense 是有实际原因的。ATM 的脑损伤在于它无法真正区分当前实例变量和继承的属性/变量。因此，对私有变量使用“_”可以更轻松地在 VS 代码编辑器中的智能感知列表和函数/变量列表中定位变量。所以在某种程度上它是更广泛的匈牙利符号。

# java - Sybase IQ 上结果集中的最佳更新

> ID：799107
> 
> 赞同：0
> 
> 时间：2009-04-28T17:49:44.730
> 
> 标签：java, sybase, data-processing

我希望重写代码以更新 Sybase IQ 数据库 v14 上的表，该数据库执行以下操作：

1.  选择表中的所有记录并将一些数据提取到文件中
2.  更新表中每条记录的提取到文件标志

目前，一旦将记录写入文件，其提取标志就会更新。目前表中有 40 000 条记录，该进程使用 40GB 的数据库临时空间。相关表中的每条记录包含 60 个字段，最多列包含 120 个字符。

数据库服务器是否为表中的每条记录创建了新版本的数据，并且随着时间的推移，我们在数据库服务器上创建了一个临时数据雪球，其中使用了 40GB 的帐户？处理数据的最佳方法是首先提取数据，将其写入文件，然后执行批量更新。由于我的理解是 Sybase IQ 通常用于竞技场，我认为数据库会针对插入、删除和选择进行优化，但在更新时表现不佳？sybase 数据库 IQ 服务器是否会在 HP-UX 和 Windows server 2003 上执行相同的操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T18:08:48.087

实际上 Sybase IQ 针对读取进行了优化（想想 OLAP），而不是针对 OLTP 活动优化 在我自己的测试期间，我发现将数据输入 Sybase IQ 花费的时间最长

加载数据的最快方法是使用**LOAD TABLE**批量加载命令

# iphone - iPhone OS 上的多线程是如何工作的？我该如何使用它？

> ID：799111
> 
> 赞同：4
> 
> 时间：2009-04-28T17:50:33.683
> 
> 标签：iphone, objective-c, multithreading, cocoa-touch, nsthread

我对 iPhone 上的线程很好奇。它们是否易于建立和维护？它如何在 iPhone 上运行？是真正的多线程吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T19:40:20.283

在`NSThread`课堂上，是的，嗯，是的。:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-03T19:47:06.597

我强烈建议您查看 Apple 提供的以下文档：

*   并发编程文档：[并发编程指南](https://developer.apple.com/library/ios/#documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html)
*   关于线程的文档：[线程编程指南](https://developer.apple.com/library/ios/#documentation/Cocoa/Conceptual/Multithreading/Introduction/Introduction.html%23//apple_ref/doc/uid/10000057i)

对于大多数常见的并发编程操作，Grand Central Dispatch 的使用`NSOperation`和`NSOperationQueue`这两个部分都非常容易实现，并且将涵盖您需要异步执行的大部分操作，包括定义此类操作之间的依赖关系。

使用 GCD 比使用线程更简单，并且在您不需要从并行线程进行实时处理的情况下将完全替换它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-02T12:40:31.577

如果您想开发高效、平稳运行的应用程序，控制并发性和内存至关重要。Automatic Reference Counting 是 Apple 改变游戏规则的内存管理系统，是 Xcode 4.2 的新功能。适用于 iOS 和 OS X 的 Pro 多线程和内存管理向您展示了 ARC 的工作原理以及如何最好地将其整合到您的应用程序中。Grand Central Dispatch (GCD) 和块是开发出色应用程序的关键，允许您控制线程以获得最佳性能。
有很多书籍和课程可供使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-03T21:48:57.897

使用 Grand Central Dispatch 是在 iPhone 上实现多线程的最佳方式，如果您遵守规则，实现起来并不难。检查文档和编程指南。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-12T12:40:11.363

[这篇文章可能会更有帮助...](https://stackoverflow.com/questions/1357108/common-multithreading-mistakes-beginners-make-on-iphone)

# vb.net - 在 nHibernate 中构建 SessionFactory 时出错

> ID：799112
> 
> 赞同：0
> 
> 时间：2009-04-28T17:50:51.827
> 
> 标签：vb.net, nhibernate

每当我尝试在 nHibernate 中实例化会话工厂时，我都会在参数索引上收到“ArgumentOutOfRangeException”。该错误来自 nHibernate 内部的一个程序。如果有帮助，我可以发布错误的堆栈跟踪。

这是一个具有非常简单的三层架构的新项目。数据层将 nHibernate 类映射到由业务层实现的简单接口。目前只有一个接口集和映射文件被 nHibernate 使用。希望我的问题很容易发现。

这是我构建 sessionFactory 的函数。

```
 Private Shared Function SessionFactory() As ISessionFactory
        If _sessionFactory Is Nothing Then
            Dim config As New NHibernate.Cfg.Configuration
            config.Configure()
            config.AddClass(GetType(ICompanyProperty))
            _sessionFactory = config.BuildSessionFactory            
        End If
        Return _sessionFactory
    End Function 
```

这是我的 hibernate.cfg.xml

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">
  <session-factory>
    <property name="connection.provider">
      NHibernate.Connection.DriverConnectionProvider     
    </property>
    <property name="dialect">
      NHibernate.Dialect.MsSql2005Dialect
    </property>
    <property name="connection.driver_class">
      NHibernate.Driver.SqlClientDriver
    </property>
    <property name="connection.connection_string">
      Data Source=dataserver.domain.ad;Initial Catalog=LABs;Integrated Security=SSPI
    </property>
  </session-factory>
</hibernate-configuration> 
```

还有我正在映射的接口的映射文件。

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="Sample.Data" namespace="Sample.Data">
  <class name="ICompanyProperty" table="CompanyProperty">
    <id name="CompanyPropertyID" column="CompanyPropertyID">
      <generator class="native" />
    </id>    
    <discriminator column="PropertyType" type="String" />
    <property name="CompanyID" />
    <property name="PropertyName" />    
    <subclass discriminator-value="SQL" name="ISQLLookupCompanyProperty">
      <property name="TableName" />      
      <property name="KeyField" />
      <property name="ValueField" />
      <property name="ConnectionString" />
    </subclass>
    <subclass discriminator-value="LIST" name="ILookupCompanyProperty" />    
  </class>
</hibernate-mapping> 
```

和接口

```
Public Interface ICompanyProperty
    Property CompanyPropertyID() As Integer
    Property PropertyName() As String
    Property CompanyID() As Integer
    Property PropertyType() As String
End Interface

Public Interface ILookupCompanyProperty
    Inherits ICompanyProperty
End Interface

Public Interface ISQLLookupCompanyProperty
    Inherits ILookupCompanyProperty

    Property TableName() As String
    Property KeyField() As String
    Property ValueField() As String
    Property ConnectionString() As String
End Interface 
```

谢谢！

编辑：请求堆栈跟踪。这是从我对构建会话工厂的调用到错误。

```
at System.Collections.ArrayList.get_Item(Int32 index)
at NHibernate.SqlCommand.InFragment.ToFragmentString()
at NHibernate.Persister.Entity.SingleTableEntityPersister.DiscriminatorFilterFragment(String alias)
at NHibernate.Persister.Entity.SingleTableEntityPersister.FilterFragment(String alias)
at NHibernate.Persister.Entity.AbstractEntityPersister.FilterFragment(String alias, IDictionary`2 enabledFilters)
at NHibernate.Loader.Entity.EntityJoinWalker..ctor(IOuterJoinLoadable persister, String[] uniqueKey, Int32 batchSize, LockMode lockMode, ISessionFactoryImplementor factory, IDictionary`2 enabledFilters)
at NHibernate.Loader.Entity.EntityLoader..ctor(IOuterJoinLoadable persister, String[] uniqueKey, IType uniqueKeyType, Int32 batchSize, LockMode lockMode, ISessionFactoryImplementor factory, IDictionary`2 enabledFilters)
at NHibernate.Loader.Entity.EntityLoader..ctor(IOuterJoinLoadable persister, Int32 batchSize, LockMode lockMode, ISessionFactoryImplementor factory, IDictionary`2 enabledFilters)
at NHibernate.Loader.Entity.EntityLoader..ctor(IOuterJoinLoadable persister, LockMode lockMode, ISessionFactoryImplementor factory, IDictionary`2 enabledFilters)
at NHibernate.Loader.Entity.BatchingEntityLoader.CreateBatchingEntityLoader(IOuterJoinLoadable persister, Int32 maxBatchSize, LockMode lockMode, ISessionFactoryImplementor factory, IDictionary`2 enabledFilters)
at NHibernate.Persister.Entity.AbstractEntityPersister.CreateEntityLoader(LockMode lockMode, IDictionary`2 enabledFilters)
at NHibernate.Persister.Entity.AbstractEntityPersister.CreateEntityLoader(LockMode lockMode)
at NHibernate.Persister.Entity.AbstractEntityPersister.CreateLoaders()
at NHibernate.Persister.Entity.AbstractEntityPersister.PostInstantiate()
at NHibernate.Persister.Entity.SingleTableEntityPersister.PostInstantiate()
at NHibernate.Impl.SessionFactoryImpl..ctor(Configuration cfg, IMapping mapping, Settings settings, EventListeners listeners)
at NHibernate.Cfg.Configuration.BuildSessionFactory() 
```

Edit2：当我删除鉴别器时，我不再收到此错误。我这样做不对吗？

编辑 3：当我下载 nHibernate 的源代码时，我自己构建它，链接到它的调试输出并运行它，我得到一个关于 ProxyFactoryFactory 未配置的完全不同的错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T19:44:46.093

我认为您需要告诉 NHibernate 使用哪些具体类。要使用接口做到这一点，您需要嵌套子类映射：

```
<subclass discriminator-value="SQL" name="ISQLLookupCompanyProperty">
  <subclass discriminator-value="SQL" name="SQLLookupCompanyProperty>
      <property name="TableName" />      
      <property name="KeyField" />
      <property name="ValueField" />
      <property name="ConnectionString" />
  </subclass>
</subclass>
<subclass discriminator-value="LIST" name="ILookupCompanyProperty">
    <subclass discriminator-value="LIST" name="LookupCompanyProperty" />
</subclass> 
```

[我在博客条目](http://blogs.chayachronicles.com/sonofnun/archive/2007/06/26/251.aspx)中找到了这个解决方案。

# c# - LINQ：获取父对象属性和单个子属性作为平面结构

> ID：799118
> 
> 赞同：4
> 
> 时间：2009-04-28T17:52:11.560
> 
> 标签：c#, linq

我有一个名为 Branch 的父对象中包含的地址列表。分支可能有也可能没有定义这些地址，我需要得到一个平面层次结构或这些分支和地址。

```
var x = from p in CurrentBranchList 
        where p.ScheduledForDeletion == false
        from c in p.Addresses 
        where c.ScheduledForDeletion == false && c.AddressTypeId == 3
        select new
        {
          BranchId = p.BranchId,
          Name = p.Name,
          Address = (c == null) ? "" : c.Address1 + " " + c.Address2,
          City = (c == null) ? "" : c.City,
          State = (c == null) ? 0 : c.StateId
        }; 
```

以上是我尝试过的，但是如果缺少地址，我将无法获得有关分支的信息……我仍在尝试弄清楚如何使用 Linq 进行此操作。在 SQL 中，我将刚刚加入这两个表以获取该信息。

任何人都可以帮助我...我敢肯定这是一件很容易的事情。谢谢。PS。我知道这与（[Linq 查询返回一个平展的父子列表](https://stackoverflow.com/questions/277634/linq-query-to-return-a-flatened-list-of-parent-child)），但在那个列表中，孩子总是存在的。

* * *

**编辑-工作解决方案** 以下是似乎对我有用的代码。我不能针对源数据库使用数据库，因为 CurrentBranchList 中包含的对象是在内存中编辑的，并且持久性是在单个操作中执行的。

```
var x = from p in CurrentBranchList
        join c in CurrentBranchList.SelectMany(b => b.Addresses) 
          on p.EntityId equals c.EntityId into ur 
        where p.ScheduledForDeletion == false      
        from u in ur.DefaultIfEmpty() 
        select new
        {
          BranchId = p.BranchId,
          Name = p.Name,
          Address = (u == null) ? "" : u.Address1 + " " + u.Address2,
          City = (u == null) ? "" : u.City,
          State = (u == null) ? 0 : u.StateId
        }; 
```

**感谢您的帮助。**这些链接确实帮助我理解了需要发生的事情。

我还尝试了 Daniel Brückner 的解决方案，它看起来更优雅并且需要更少的输入。:-) 似乎在我尝试过的几种情况下都有效。

这就是它的样子。

```
var xx = CurrentBranchList.SelectMany(b => b.Addresses.DefaultIfEmpty().Select(a => new 
        {
          BranchId = b.BranchId,
          Name = b.Name,
          Address = (a == null) ? "" : a.Address1 + " " + a.Address2,
          City = (a == null) ? "" : a.City,
          State = (a == null) ? 0 : a.StateId
        })); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T18:19:47.390

```
IQueryable<Branch> branches = GetBranches();

var result = braches.
   SelectMany(b => b.Addresses.
      DefaultIfEmpty().
      Select(a => new { Branch = b, Address = a })); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T17:55:23.983

您需要左外连接而不是内连接。 [方法如下](http://bhaidar.net/cs/archive/2007/08/01/left-outer-join-in-linq-to-sql.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T17:57:53.010

看看[这篇文章](http://geekswithblogs.net/AzamSharp/archive/2008/04/07/121103.aspx)，它展示了如何使用 DefaultIfEmtpy 构造来执行 LEFT JOIN。

恐怕不是 Linq 最容易发现的功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-01-01T13:39:36.167

抱歉，也许我来晚了——但我遇到了类似的问题，即使在这篇文章发布 5.5 年后也找不到具体的答案。我的解决方案（未优化 - 但有效）：

```
public class YearDayBill
{
    public string Name;
    public int YearDay;
}

public class EatOutDaysOfYear
{
    public string Name;
    public List<int> YearDays;
}

public static class Program
{
    static void Main()
    {
        var eatouts = new List<EatOutDaysOfYear>
        {
            new EatOutDaysOfYear {Name = "amit", YearDays = new List<int>() {59, 37, 31, 17, 29}},
            new EatOutDaysOfYear {Name = "prakash", YearDays = new List<int>() {6, 18, 13}},
            new EatOutDaysOfYear {Name = "sarvo", YearDays = new List<int>() {9, 7, 47, 56, 82, 96}},
            new EatOutDaysOfYear {Name = "akshay", YearDays = new List<int>() {8, 5, 2, 4}}
        };

        // query to get properties of parent ('Name') and single child element 
        var bills = eatouts
            .SelectMany(a => a.YearDays
                .Select(b => new YearDayBill {Name = a.Name, YearDay = b})) 
            .OrderBy(d => d.Name)     // optional 
            .ThenBy(e => e.YearDay)   // optional 
            .ToList();

        bills.ForEach(a => Console.WriteLine(string.Concat(a.Name, " | ", a.YearDay)));
    }
} 
```

# sql-server - 使用SSIS从VS2005/2008数据库项目构建数据库

> ID：799119
> 
> 赞同：1
> 
> 时间：2009-04-28T17:52:12.853
> 
> 标签：sql-server, visual-studio-2008, visual-studio-2005, ssis

如何允许 SSIS 包使用 Visual Studio 2005 或 2008 数据库项目，其中包含表和其他对象的创建脚本（注意：这不是 Visual Studio 数据库版 - 只是带有商业智能的 Pro）？

我们的想法是通过从源安全构建模式和来自 prod 的数据来使用它来重新创建我的测试实例。

我可以访问 VS2005 和 2008 Pro，这对 Prod 和 Test 都适用 Sql Server 2005。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T20:22:36.057

简短的回答是，您不能“允许 ssis 包使用 VS 2005 或 2008 db 项目”。我不确定您为什么要使用 SSIS 来运行创建脚本。您可以从 sqlcmd 实用程序运行脚本。

如果您仍想使用 SSIS，我会这样做：

*   创建一个部署脚本（VS for DB Pro 可以做到）
*   创建一个包
*   在您的控制流中，使用 Execute Process Task 并将其配置为以脚本文件作为输入运行 sqlcmd

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-10T00:54:35.957

您可以通过 SSIS 包中的执行 SQL 任务调用 DB 项目中的脚本。但是，没有直接的方式来消费它们。

# c# - 如何在 C# 中编写 isilo .pdb 文件？

> ID：799125
> 
> 赞同：1
> 
> 时间：2009-04-28T17:53:26.080
> 
> 标签：c#

我想编写自己的 .pdb isilo 文件，以便使用 isilo 应用程序在我的 iphone 中读取，但我没有编辑器或类似的东西。所以我卡住了，因为我没有编写那种文件的 API。C# 或 Visual basic .net 都可以。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T17:54:54.000

只需编写普通的 .HTML 文件并使用[iSiloX](http://www.isilox.com/)将这些文件的集合转换为 .PDB 文件。

如果您想批量执行 iSiloX 项目，甚至可以使用命令行转换器 iSiloXC。

# database - 如何在 Visual Studio 2008 中连接到 Access 2007 (accdb) 文件

> ID：799129
> 
> 赞同：1
> 
> 时间：2009-04-28T17:54:17.823
> 
> 标签：database, vb.net, visual-studio-2008, ms-access

我在大学课堂上使用 Microsoft Visual Studio 2008 for Visual Basic，我有一个项目，我应该连接数据库，但它无法将数据库文件识别为数据库。我完全按照这本书，所以我不知道问题是什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T18:24:05.990

您可能需要安装[Office 2007 数据连接组件](http://www.microsoft.com/downloads/details.aspx?familyid=7554F536-8C28-4598-9B72-EF94E038C891&displaylang=en)。

（另请参阅：[此 MSDN 论坛帖子](http://social.msdn.microsoft.com/forums/en-US/Vsexpressvb/thread/2a658b68-49c9-448e-8aca-778c1573ffaa/)）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T18:49:45.930

查看[http://connectionstrings.com/access-2007](http://connectionstrings.com/access-2007)

该站点将告诉您连接到 Access 2007 所需的连接字符串。确保您的连接字符串正常。还可以尝试使用 Visual Studio 中的服务器资源管理器连接到文件；只需添加一个指向 Access 文件的新连接，然后单击“测试连接”按钮，就可以了。希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:22:17.623

也许您是一个视觉人：[MSDN How Do I Video Series](http://msdn.microsoft.com/en-us/vbasic/bb643826.aspx)这在将 Access 数据库构建到项目时帮助了我。TableAdapters 是我不知道如何实现的，在本教程之后，我做得很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-18T12:54:30.563

在您将格式更改为 mdb 之前，它不会连接。转到访问项目并进入另存为选项并另存为访问 2000 兼容格式。现在将它连接到 vb 它将被连接。我认为 vb 2010 或 2010 也支持 accdb 文件格式。问候

# ubuntu - 新应用程序在 Ubuntu 的错误 x 屏幕中打开

> ID：799148
> 
> 赞同：0
> 
> 时间：2009-04-28T17:59:11.480
> 
> 标签：ubuntu, x11, ubuntu-9.04, multiple-monitors

我有一个双显示器设置，每个显示器在 Ubuntu 9.04 中都有自己的 x 屏幕。一切都在屏幕 0 中正常工作。当我在屏幕 1 中打开应用程序（使用任何菜单，例如应用程序、位置等）时，它会在屏幕 0 而不是屏幕 1 中打开。

因此，为了让应用程序在屏幕 1 中打开，我点击 - 并输入程序名称。这总是有效的，但非常烦人且效率低下。如何使新应用程序自动加载到我正在使用的屏幕中？谢谢！

（9.04 的发行说明说有更好的双显示器支持，所以我希望升级可以解决这个问题，但它没有。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T18:04:39.283

尝试在[论坛](http://ubuntuforums.org)上提问- 这与编程无关，也不属于这里。

# json - 是否有任何预先构建的方法可以从 VB6 解析 JSON？

> ID：799150
> 
> 赞同：3
> 
> 时间：2009-04-28T18:00:37.233
> 
> 标签：json, vb6, parsing

是否有任何现有的可以从 VB6 使用的 JSON 解析器？

我显然可以编写自己的解析器，但如果我不需要的话，我不想重新发明轮子。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-28T18:01:31.380

我会看看[VB-JSON](http://www.ediy.co.nz/vbjson-json-parser-library-in-vb6-xidc55680.html)：

> VB-JSON 是一个用于解析和发出 JSON（Javascript 对象表示法）的 Visual Basic 6 类库，可以处理数据中的嵌套数组和对象。它不依赖于 JScript 引擎进行解析。

# sql - 总是在 SQL 中显示小数位？

> ID：799151
> 
> 赞同：13
> 
> 时间：2009-04-28T18:00:41.880
> 
> 标签：sql, oracle, formatting

我正在处理一个返回数值（货币）的查询。一些值是整数，显示为 3、5、2 等，而其他数字出现，如 2.52、4.50 等。

如何强制 oracle 始终显示小数位？

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-28T18:10:50.610

```
TO_CHAR(pAmount, '9,999,999.99'); 
```

[http://www.techonthenet.com/oracle/functions/to_char.php](http://www.techonthenet.com/oracle/functions/to_char.php)

[http://www.ss64.com/orasyntax/to_char.html](http://www.ss64.com/orasyntax/to_char.html)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2016-05-05T13:34:04.023

为了增强已经给出的答案，您可以使用：

*   `TO_CHAR(your_value,'fm999.99')`防止前导空格

    `____3.45`变成`3.45`（`_`表示空格）

*   `TO_CHAR(your_value,'fm990.99')`强制值小于`1`以显示前导零

    `.52`变成`0.52`

*   `TO_CHAR(your_value,'fm990.00')`强制保留 2 位小数，即使`0`

    `6.3`变成`6.30`

*   `(TO_CHAR(your_value,'fm990.00')||'%')`添加百分号

    `18.6`变成`18.60%`

来源：[https ://community.oracle.com/thread/968373?start=0&tstart=0](https://community.oracle.com/thread/968373?start=0&tstart=0)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-28T18:03:05.637

数据的显示和格式化应该在表示层处理 - 而不是数据层。

使用前端提供的工具来格式化您认为合适的值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T08:25:45.843

在 SQL*Plus 中，您可以使用 COLUMN 指令在每列的基础上指定格式，与查询本身分开。这样，您就可以保持查询“干净”以供可能的其他用途使用，并且仍然可以获得您的格式。（至少在 SQL*Plus 中......）

例如

```
COLUMN SAL FORMAT 99,990.99 
```

谷歌“SQL*Plus 用户指南和参考”，您应该获得指向您的 Oracle 版本的 Oracle 位置的链接。如果可以的话， 10.1 就[在这里](http://docs.oracle.com/cd/B19306_01/server.102/b14357/toc.htm)。请注意，它们可能都差不多：自 1988 年在 Oracle 5.1.17 上学习 SQL*Plus 以来，我认为 SQL*Plus 并没有太大变化……

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-26T20:07:42.083

修复了小数问题，`to_char`但您必须确定长度。如果它比提供的格式长，它会将数字显示为`####`。如果数字更短，那么它会在数字之前留下空格。例如

`to_char(123.45),'99.00')`将会呈现`####`

和

`to_char(123.45),'999999.00')`将显示`' 123.45'`。

因此，如果您必须将结果导出到 CSV 或 Excel，这些数字将被视为字符串。

所以，我还没有找到任何解决方案。

# mysql - 存储过程中的mysql事务（锁定/回滚）

> ID：799158
> 
> 赞同：0
> 
> 时间：2009-04-28T18:02:00.990
> 
> 标签：mysql

存储过程中的事务是否会进行任何锁定以防止其他人更新表？

我是否还需要显式地放入回滚逻辑，或者如果发生错误，事务是否会自动回滚，因为它永远不会到达提交命令。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-28T18:08:39.490

> 存储过程中的事务是否进行任何锁定以防止其他人更新表？

当您`DML`在`InnoDB`表上执行某些操作时，受影响的行会被锁定直到事务结束（不管它是否在存储过程中）。

您可以在锁定它的同一事务中修改锁定的行。

要显式锁定某些行，请发出：

```
SELECT  *
FROM    table
WHERE   condition
FOR UPDATE 
```

除了提交或回滚事务，没有其他方法可以解锁行

> 我是否需要显式地放入回滚逻辑，或者如果发生错误，事务是否会自动回滚，因为它永远不会到达提交命令。

您需要明确执行回滚。

# .net - ASP.NET webservice 方法有没有办法使用异步方法？

> ID：799163
> 
> 赞同：0
> 
> 时间：2009-04-28T18:03:17.973
> 
> 标签：.net, asp.net, web-services, asynchronous

我有一个 ASP.NET Web 服务 (.asmx)，它有一个简单的方法，它通过同步调用 (ExecuteReader) 从数据库中读取一些内容并返回结果。有什么方法可以优化线程池的使用（即通过调用异步调用（BeginExecuteReader））而不更改方法的签名？

目的是在数据库操作正在进行时不阻塞线程池线程；并行执行多个操作并不是为了加快速度。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T19:34:30.393

实际上，答案是**肯定**的。请参阅[异步 XML Web 服务方法](http://msdn.microsoft.com/en-us/library/83bkx91t(VS.85).aspx)。

尽管您使用 Begin* 和 End* 方法创建了一个异步 Web 方法，但 .NET 只会在 WSDL 中创建一个操作。如果您考虑一下，这很明显 - Java 客户端会用`IAsyncResult`?

The client can call the operation synchronously or asynchronously.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T19:16:21.373

使用您提供的特定用例，使用单个异步调用，这是不值得的，但是，是的，您可以从 Web 服务调用异步调用：

```
[WebMethod]
public SomeResult SynchronousMethod() {
    IAsyncResult someWork = BeginSomeAsyncWork();
    IAsyncResult otherWork = BeginOtherAsyncWork();
    WaitHandle[] all = new WaitHandle[] { someWork.AsyncWaitHandle, otherWork.AsyncWaitHandle };
    // TODO: Do some synchronous work here, if you need to 
    WaitHandle.WaitAll(all); /* this is the important part, it waits for all of the async work to be complete */
   var someWorkResult = EndSomeAsyncWork(someWork);
   var otherWorkResult = EndSomeAsyncWork(otherWork);
   // TODO: Process the results from the async work
   // TODO: Return data to the client
} 
```

这里重要的是[WaitHandle.WaitAll](http://msdn.microsoft.com/en-us/library/system.threading.waithandle.waitall.aspx)，它将阻塞直到所有异步工作完成。如果您可以单独处理结果，则可以改用[WaitHandle.WaitAny](http://msdn.microsoft.com/en-us/library/system.threading.waithandle.waitany.aspx)，但代码会变得更加复杂，并且有点超出问题的范围。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T18:21:55.310

是的，在响应服务请求时，您基本上可以自由地做您想做的事情。但是，如果您只有 1 个查询，它不会有太大用处。如果您需要 2 个或更多查询，它会变得很有趣。

* * *

当然，正如 Alex Lyman 指出的那样，您必须收集所有结果。ASP.NET WebPage 对此有特殊的支持，这就是为什么我确信它是可能的。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-28T18:34:12.910

我不知道这是如何工作的，当您的 Web 服务收到请求时，将分配池中的一个线程来处理该请求，如果您从该线程进行异步调用，那么您的请求线程将结束并且客户不会得到任何结果。

~~简短的回答是~~否定的。人们似乎只是在阅读这一行并投反对票:) 用户询问我们是否可以从同步 Web 服务调用内部进行异步调用，这当然可以通过使用 WaitHandles 但在用户的具体情况。

# c# - 有什么方法可以缩短或简化中继器控件的项目模板标记？

> ID：799170
> 
> 赞同：1
> 
> 时间：2009-04-28T18:05:17.847
> 
> 标签：c#, .net, webforms, datatable, repeater

有没有办法缩短这个中继器的标记？我正在将一个 DataTable 绑定到这个中继器。这让我很困扰，因为 ((System.Data.DataRowView)Container.DataItem) 是重复的，并且使标记的可读性降低，尤其是当您有更多字段时。我正在使用 .Net 3.5 C# WebForms。MVC 不是一个选项。谢谢。

```
<asp:Repeater ID="rDefinitions" runat="server">
    <ItemTemplate> 
       <h3><%#((System.Data.DataRowView)Container.DataItem)["Name"]%></h3>           
       <p>Definition:
            <%#((System.Data.DataRowView)Container.DataItem)["Definition"]%>
       </p>
    </ItemTemplate>
</asp:Repeater> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-28T18:38:39.373

为什么不使用 ASP.NET 2.0 引入的简化数据绑定语句？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T18:11:28.393

您可以导入 System.Data 命名空间以省略 System.Data 部分。

但至于其余的，我认为这是必要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-06-14T16:48:27.743

虽然本主题涉及 .NET 3.5，但 .NET 4.5 现在为 Web 窗体提供了强大的绑定。不需要 MVC。在转发器上设置 ItemType 字段，然后使用表单 Item.Data 来引用字段。

# html - 制作这种布局（css或表格）的最佳方法是什么？

> ID：799172
> 
> 赞同：1
> 
> 时间：2009-04-28T18:05:55.130
> 
> 标签：html, css, layout

我正在开发一个有可用订阅的应用程序。我想知道像以下模式（使用表或 css）那样构造数据的最佳方法是什么。（对不起，我在工作，很冷，没有在免费图片托管服务上发布我想要的图片。）

```
|¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ˉ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯|
| 地点：xxxxxxxxx-xxxx-xxx 最大订阅日期：2009 年 12 月 11 日 |
| 开始日期：2009 年 12 月 15 日费用：150 美元 |
| 持续时间：2 天 |
| 状态：已确认剩余名额 [订阅] |
| |
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
|¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ˉ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯|
| 地点：xxxxxxxxx-xxxx-xxx 最大订阅日期：12-12-2009 |
| 开始日期：2009 年 12 月 15 日费用：150 美元 |
| 持续时间：2 天 |
| 状态：已确认剩余名额 [订阅] |
| |
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯

```

我在考虑表格，但我不确定这是最合适的方式。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-28T18:10:00.890

您可以使用 CSS 来做到这一点，但请考虑您要呈现的数据类型：本质上，它实际上是一个数据*表*。所以我建议为此使用一张桌子。

确实，表格会受到很多抨击，但您应该避免使用表格的唯一情况是当您*专门*将它们用于布局目的时（即，不一定是为了呈现表格的目的）。在这种情况下使用表格将是表格的正确用法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-28T18:08:01.847

无论我多么讨厌表格布局，我都不得不说表格。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T18:10:15.510

内容的表格，因为它本质上是表格数据，但请确保充分利用 TH 作为标题，例如状态、持续时间等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-28T18:26:11.307

我认为人们需要克服对在 (x)html 中使用表格标签的下意识的负面反应。这是一组有效的标签，它可以很好地呈现和组织“方形”数据。如果您要强烈反对它们，请聪明一点，并指明这一点，其余的不适合*语义上不适当的用途*。不要使用表格来布置您的徽标和标题。这不是表格数据。您是否以显示信息行和列之间关系的方形方式显示数据？然后继续使用表格！

鉴于我对语义标记的理解（感谢 Dan C.！），对于您的特定用途，我建议使用表格或定义列表。这准确地描述了您要编写的内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-28T18:18:28.080

我正在以我现在正在开发的形式做几乎相同的事情，并且我正在使用定义列表。例如：

```
<dl>
    <dt>Location:</dt>
    <dd>xxxxxxx-xxxxx</dd>
    ....
</dl> 
```

这样做有点困难，但代码看起来更干净恕我直言。（对我来说，用桌子也可以）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T18:15:52.547

**取决于你想要什么**

您问题中的示例现在看起来像一个带有一些文本行的框，然后是另一个框，等等。

如果这就是你想要的，我建议使用 CSS 样式的 div。如果它更清楚地是“列和行”布局，请使用表格。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T18:18:49.950

在表格中显示表格数据

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-28T18:53:56.263

我个人避免使用表格，除非数据非常受表格驱动（类似 Excel 的结果）。在这种情况下，一个 div 集合，甚至基于 li 的集合可能是最好的。（下面的伪标记）

```
UL
  LI
    DIV.left
      DL
        DT LABEL {label} /LABEL /DT
        DD {detail}
      /DL
      ...
    /DIV.left

    DIV.right
      ...
    /DIV.right

    DIV.subscribe ... /DIV.subscribe
  /LI
  ...
/UL
```

注意：标签的使用是因为我对输入表单使用了类似的技术。保持一致有助于减少不需要的 CSS。

.left 和 .right 只是用于浮动，我会让 LI 的定位是相对的，并消除 CSS 和项目符号的特定样式（IE 使这部分有点像 PITA，这就是为什么 DIV.list > DIV。 list-item 在实际使用方面可能会更好。

# excel - 如何让 Excel 将每第 n 个单元格从一张纸复制到另一张纸上？

> ID：799173
> 
> 赞同：3
> 
> 时间：2009-04-28T18:05:57.407
> 
> 标签：excel

我的数据从 C9 开始，我想每隔 18 行引用一次。例如（引用的工作表名为 Summer）：

=+夏天！C9

=+夏天！C27

=+夏天！C45

我怎样才能让 excel 识别这种模式，这样我就不必一遍又一遍地输入它？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T18:23:21.593

不漂亮，但你可以这样做：

```
=indirect("Summer!C" & (Row()*18-9)) 
```

基本上使用当前行作为乘数，并构造公式。

编辑：间接是一个允许您使用从字符串构造的单元格引用的函数。所以我们实际上是在尝试构建：

```
=indirect("Summer!C9") 
```

它的评估与您的原始评估相同

```
=Summer!C9 
```

所以我们需要做的就是从我们手头的任何东西中计算出数字 9。为了找到正确的数学来计算你想要的数字，让我们测试这个更简单的版本：

```
=(Row()-n+1)*18)-9) 
```

这应该给你一个数字。将*n替换为**第一个*公式出现的行号。因此，如果您的第一个公式实际上在第 25 行，您将改为使用：

```
=(Row()-25+1)*18)-9) 
```

确定*数字*正确后，只需添加

```
=indirect("Summer!C" & 
```

部分，你应该很高兴。注意我还假设每个公式都在前一个公式下方的行中。如果不是这种情况，那么您将不得不进行其他调整。但这一切都只是数学。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-16T14:58:36.933

如果您只需要将数字与上方和下方的单词混合在一起，您可以进行过滤，然后仅选择可见单元格并粘贴到新工作表中

# asp.net - ASP.NET 大师：使用 Session 变量有哪些优点/缺点？

> ID：799175
> 
> 赞同：21
> 
> 时间：2009-04-28T18:06:17.000
> 
> 标签：asp.net, session, iis, session-state

我已经对这个主题进行了搜索，并且一遍又一遍地找到相同的数据——回顾了三种不同类型的会话。（InProc，Sql，StateServer）但是，我的问题具有不同的性质。

具体来说，首先使用内置 .NET 会话的优点/缺点是什么？

这就是我要问的原因：一位 .NET 开发人员告诉我永远不要使用内置的 Microsoft Session。一点也不。甚至没有创建自定义会话状态提供程序。他对此的推理如下——如果您在 IIS 中打开了 Session，它会使您的所有请求同步发生。他说启用会话会降低 Web 服务器的性能。

他对此的解决方案是自己创建一个会话——一个存储您需要的所有值并在数据库内外序列化的类。他建议您存储唯一 ID 以在 cookie 或查询字符串变量中引用它。在我们的环境中，需要使用数据库来存储会话，因为我们制作的所有页面都在网络农场上，并且我们使用 Oracle——所以我同意这部分。

使用内置 Session 是否会比自制 Session 降低性能？这有什么安全问题吗？

所以总结一下，有什么优点/缺点？

感谢所有回答的人！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-28T18:16:01.063

我的经验是，当您适当地使用会话时，会话是管理状态的好方法。然而，它经常被滥用，导致许多开发人员共享“从不使用会话”的情绪。

当我们错误地使用会话从数据库中存储大量数据以“节省行程”时，我和许多其他开发人员都遇到了重大的性能问题。这是不好的。当超过几个用户使用该应用程序时，每个会话存储 2000 条用户记录将使 Web 服务器瘫痪。会话不应用作数据库缓存。

但是，每个会话存储一个整数是完全可以接受的。表示当前用户如何使用您的应用程序（想想购物车）的少量数据是会话状态的一个很好的用途。

对我来说，这真的是关于管理状态。如果做得正确，那么会话可以成为管理状态的许多好方法之一。不过，应该*在一开始*就决定如何管理状态。大多数时候，当有人决定“在会话中扔东西”时，我们会遇到麻烦。

我发现[这篇](http://msdn.microsoft.com/en-us/magazine/cc163730.aspx)文章在使用进程外模式时非常有用，并且它包含一些我自己从未想过的技巧。例如，与其将类标记为可序列化，不如将其原始数据类型成员存储在单独的会话变量中，然后重新创建对象可以提高性能。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-28T18:20:10.290

首先，您的同事正在实现他自己的数据库支持的会话管理系统，我看不出这比使用存储在数据库上的内置会话状态有什么优势（MS SQL 是默认设置，没有理由不使用 Oracle）。

他的解决方案是否比内置解决方案更好？不太可能。一开始对你来说工作量更大。这是一个简单的说明。假设您使用 cookie 来存储您的 ID，您如何应对关闭 cookie 的用户？如果您使用的是 ASP.Net 的会话状态，则没有问题，因为它将回退到使用查询字符串。有了你同事的想法，你必须自己动手。

关于您是否拥有会话状态，这*是一个非常有效的问题。*如果您可以将应用程序设计为根本不需要任何会话状态，那么您将更容易进行时间扩展和测试。显然，您可能具有无论如何都需要在会话之外存在的*应用程序状态（简单的情况是用户名和密码），但是无论您是否具有会话状态，您都必须存储这些数据。*

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-28T18:21:41.330

会话状态的 MS 实现本身并不邪恶……这就是一些开发人员使用它的方式。如上所述，使用内置会话状态提供程序意味着您不必重新发明安全性、老化和并发问题。只是不要开始在会话中塞入大量垃圾，因为您懒得想出更好的方法来管理状态和页面转换。会话不能很好地扩展......如果您网站上的每个用户都在会话中填充一堆对象，并且这些对象占用了您应用程序可用的有限内存的一小部分，那么您将很快遇到问题稍后随着您的应用程序越来越受欢迎。以设计的方式使用会话：表示用户仍在“使用”您的站点的标记。当你开始冒险超越它时，

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-28T20:06:26.853

您应该谨慎使用 Session，因为对同一 Session 对象的多个请求通常会排队：请参阅“并发请求和会话状态”[http://msdn.microsoft.com/en-us/library/ms178581.aspx](http://msdn.microsoft.com/en-us/library/ms178581.aspx)。

请注意，您可以设置`EnableSessionState`为`ReadOnly`允许对会话状态进行并发读取访问。

这种排队是一件好事，因为这意味着开发人员可以使用 Session 而不必担心同步。

我不同意你同事关于“从不”使用 Session 的建议，我当然不会考虑自己动手。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-28T18:19:10.743

首先，浏览器在给定时间只会向给定主机名发出两个请求。在大多数情况下，这些请求是针对静态内容（JS 文件、CSS 等）的。因此，对动态内容的请求序列化几乎不是人们可能想到的问题。另外，我认为这可能与 Classic ASP 混淆，其中使用 Session 的页面肯定是序列化的，我不相信 ASP.Net 就是这种情况。

使用 ASP.Net 会话状态（SQL 模式、状态服务器或自定义），您拥有一个标准的实现，并且在整个应用程序中都是一致的。如果您不需要共享会话信息，这是您最好的选择。如果您需要与其他应用程序环境（php、swing/java、经典 asp 等）共享信息，则可能值得考虑。

另一个优点/缺点是，有很多开发人员专注于会话的内置方法，以提高性能，以及设计而不是滚动自己的方法，即使使用不同的提供者也是如此。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-28T18:10:44.667

> 这有什么安全问题吗？

如果你自己动手，你将不得不处理 Session Fixation 和 Hijacking 攻击，而使用内置的 Session 我*认为*它们是为你处理的（但我可能是错的）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-28T18:14:00.757

正如您所描述的，自制会话没有做任何不同的.Net会话的“SQL”状态，根据我的经验，我认为会话无论如何都不会降低您的性能。构建您自己的会话管理器将需要同时执行其他几个管道任务 - 安全性、将其清除等。

内置会话的优点是它易于使用，所有这些管道都已经处理好了。使用“SQL”模式，您可以将会话数据保存在数据库中，从而允许您在网络农场上运行您的应用程序而不会出现任何问题。

我们为财富 57 强公司设计了一个 b2b 电子商务应用程序，该应用程序每天处理超过 10 万笔交易，并且非常广泛地使用会话 [SQL 模式]，完全没有任何问题。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-28T19:51:31.240

如果我错了，请纠正我：

将会话状态存储在数据库（例如 SQL Server）中的主要优点是您不会消耗内存资源，而是将其存储到数据库中的磁盘中。

缺点是您每次需要时都会进行 IO 命中以从数据库中检索此信息（或者 SQL Sever 甚至可能根据最近执行的查询为您做一些神奇的数据缓存？）

无论如何，对于遇到大量流量的站点来说，每次访问 Web 服务器从数据库中检索会话信息的 IO 价格似乎是一种更安全的策略。

# windows - 带有 Windows 中央存储库的 DVCS

> ID：799187
> 
> 赞同：24
> 
> 时间：2009-04-28T18:09:15.700
> 
> 标签：windows, git, version-control, mercurial

我们目前正在使用 VSS 进行版本控制。我们的开发人员中很少有人对分布式模型感兴趣（并且希望摆脱 VSS）。我们的网络充满了 Windows 机器，虽然我们的 IT 部门有维护 Linux 机器的经验，但他们不愿意这样做。

哪些 DVCS 系统可以在 Windows 上托管其中央存储库，同时提供..

1.  推送对存储库的访问。
2.  基本身份验证。主要是一种允许或拒绝访问整个存储库的方法。无需细粒度的访问。
3.  服务器进程，因此用户不需要对存储库的写入权限，从而降低了意外弄乱它的风险。

在客户端，或多或少需要像 Tortoise 这样的 GUI（对不起，Windows shell 很烂。:|）。易于安装将是一个巨大的优势，因为我们的 IT 部门已经非常缺乏资源。只要客户端能够存储凭据，使用 Windows 凭据进行身份验证将是一个优势，但不是必需的。

我（真的）快速浏览了 Git、Mercurial 和 Bazaar。

*   **Git**似乎使用 ssh 或简单的 WebDAV 来访问存储库，需要用户的写入权限。
*   **Mercurial**有一个内置的 http 服务器，但这似乎只是为了拉取目的。**更新：** Mercurial 也支持推送。
*   **Bazaar**似乎使用 sftp 进行存储库访问，再次要求用户具有写入权限。

是否有适用于任何 DVCS 系统的 Windows 服务器进程，是否有人设法在 Windows 领域设置了一个？

*如果这是一个重复的问题，我们深表歉意。我找不到一个。*

**更新**

让 Mercurial 为推送目的工作！可以在下面找到所需的详细列表作为答案。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-28T19:10:52.167

Mercurial 几乎可以肯定是您在 Windows 上最简单的选择。

如果您不关心身份验证，您实际上可以轻松地允许`hg serve`推送。为此，您只需将以下内容添加到`.hg/hgrc`您希望服务的存储库中的文件中：

```
[web]
allow_push = *
push_ssl = false 
```

第一行说任何人都可以推送到这个存储库。第二个告诉 Mercurial 允许在没有 SSL 的情况下进行推送，因为`hg serve`目前不支持 HTTPS。此时，用户无需在任何地方拥有帐户即可推送到您的存储库。如果您只是一家小商店，那可能很好——尤其是因为您可以使用 Mercurial 对变更集进行签名的能力来保证比 HTTP Basic 提供的更高级别的可验证性，无论如何。

但是，对于更大的商店，您至少需要一个简单的承诺障碍是完全正确的。为此，您需要进行两项更改。首先，您需要将 Mercurial 放在支持反向代理或 CGI 的 Web 服务器后面。值得庆幸的是，最新版本的 IIS 都支持这两者。您可以查阅[Mercurial Redbook 中的 CGI 指导以](http://hgbook.red-bean.com/read/collaborating-with-other-people.html#sec:collab:cgi)了解 Mercurial 特定的步骤，以及[Microsoft 的在 IIS 6 中设置 CGI 应用程序的指南以](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/bc0c4729-e892-4871-b8f3-fcbf489f2f09.mspx?mfr=true)获取 IIS 方面的帮助。

接下来，您需要设置一些基本身份验证。IIS 提供开箱即用的 HTTP Basic，作为奖励，它可以直接针对您的域进行身份验证，从而将管理开销降至最低。

最后，您需要`allow_push`通过指定以逗号分隔的用户名列表来更改该行以仅支持特定用户。例如：

```
allow_push = benjamin, ted, the_cow 
```

就是这样。Mercurial 现在将允许来自可以通过 HTTP 基本身份验证进行身份验证的用户的推送，并允许从其他所有人那里拉取。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-28T22:12:41.183

在 Benjamin 指出 HTTP 服务 CGI 脚本之后，我决定尝试这些并设法获得一个通过 HTTP 托管的存储库。[本杰明链接的红皮书](http://hgbook.red-bean.com/read/collaborating-with-other-people.html#sec:collab:cgi)和两篇 Mercurial wiki 文章一样有很大帮助。一个描述一般的[Mercurial 发布](http://www.selenic.com/mercurial/wiki/index.cgi/PublishingRepositories)，另一个包含设置 HgWebDir CGI 脚本的[分步说明。](http://www.selenic.com/mercurial/wiki/index.cgi/HgWebDirStepByStep#head-fd8a89bd63032883f40db34ad4a8182b37fa6bd3)

这些说明并非完全万无一失，所以我不得不四处寻找。很可能是因为我正在运行 64 位 Vista。下面的说明记录了我所做的。既然我已经完成了一次，我可能会以另一个顺序做事，所以不要考虑这些分步说明。

**水银**

首先，我从[http://mercurial.berkwood.com/](http://mercurial.berkwood.com/)获取了 Mercurial 二进制文件，该二进制文件安装到`d:\dev\Mercurial`. 我`d:\dev\testRepo`使用`hg init`. `d:\dev\Mercurial\library.zip`包含 CGI 脚本所需的 Mercurial 库文件，因此它们被提取到`d:\dev\Mercurial\library`. 起初让我感到困惑的是，当我打开 zip 文件时，我收到一条错误消息并且看不到任何内容。只是将文件解压缩到一个目录就可以了。

对于 web 脚本，我下载了 Mercurial[源](http://www.selenic.com/mercurial/release/?M=D)，其中包含 hgwebdir.cgi，它被移动并重命名为`d:\dev\Mercurial\webroot\hgwebdir.py`. 分步文章包含有关修改 Windows 的 hgwebdir 脚本的良好说明。它们还包含 hgweb.config 的说明，在我的情况下最终看起来像这样：

```
[paths]
/hg/hgwebdir.py/test = D:\dev\Mercurial\testRepo 
```

存储库也需要以下配置，因此我可以在没有 SSL 的情况下推送。注意我目前正在使用基本身份验证对用户进行身份验证。我必须在其中创建配置`D:\dev\Mercurial\testRepo\.hg\hgrc`并向其中添加以下行：

```
[web]
allow_push = *
push_ssl = false 
```

**Python**

CGI 脚本是 Python 脚本，因此它需要 Python。执行它的 Python 版本似乎相当挑剔。其中一篇文章提到运行它需要与构建 Mercurial 相同的版本。最后，在尝试了 Python 2.6 x64、Python 2.4、Python 2.5 x64 之后，我让它在 Python 2.5 x86 上运行。

**IIS**

我错过并不得不安装的两件事是 CGI 支持和基本身份验证。这两个都是通过控制面板、程序和功能安装的。安装完成后，我在 IIS 中创建了一个指向`D:\dev\Mercurial\webroot`. 虚拟目录需要一个用于 *.py 文件的 CGI 处理程序，该处理程序可以从处理程序映射中添加。可执行文件是`D:\dev\SDKs\Python25_x86\Python.exe %s`. 一旦 IIS 获得了 webroot 目录的权限，我就可以导航到[http://localhost/hg/hgwebdir.py/test](http://localhost/hg/hgwebdir.py/test)并查看存储库。

所以现在读取访问正在工作。当我尝试推送到存储库时，我收到了奇怪的错误消息，告诉我它不是真正的存储库。

经过一个小时的调试，我最终将整个`D:\dev\Mercurial\library\mercurial`树复制到了 webroot 下，以便 Python 可以找到`D:\dev\Mercurial\webroot\mercurial\hgweb\hgwebdir_mod.pyc`. 在此之后 Wireshark 在堆栈跟踪中报告访问被拒绝错误。不知道真正的原因是什么，但是将虚拟目录更改为 IIS 中的应用程序并将其移动到使用本地系统帐户运行的应用程序池之上，访问被拒绝错误消失了。

同样在某些时候，我给了`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\WinSock2\Parameters`注册表项更多权限，以便 IIS 可以访问它。怀疑它在使用本地系统帐户后需要这些。

完成这些操作后，将内容推送到存储库就可以使用了`hg push http://localhost/hg/hgwebdir.cgi/test`！

**问题与解决方案**

*   **在哪里可以找到库文件。**
    *   它们位于 Mercurial 安装文件夹下的 library.dll 中。即使我的解压缩程序拒绝查看它的内容，我也只需要提取它们。
*   **如何让 Python 脚本运行**
    *   下载适用于 x86 架构的正确 Python 版本，因为该脚本使用了一些 x86 库。正确的 Python 版本取决于 Mercurial 版本。对于 1.2.1，它是 Python 2.5 x86。
    *   或者，您可以尝试使用您想要的任何 Python 版本从源代码构建 Mercurial，但在我的情况下，这在构建扩展时失败了。
*   **如何在 IIS 中设置 CGI**
    *   首先确保 CGI 安装在 IIS 中。本杰明发布的 IIS 说明中并未假定这是真的。
    *   在 IIS 处理程序映射中为 *.py 创建一个新的模块映射。正确的模块是`CgiModule`并且可执行文件是您的 Python 可执行文件 + %s
*   **如何允许 CGI 脚本写入存储库**
    *   确保脚本具有所需的一切。我不得不把它搬到`library\mercurial\hgweb\hgwebdir_mod.pyc`另一个地方。
    *   确保脚本有权访问它想要的任何地方。我通过为使用本地系统帐户的 CGI 脚本创建一个新的应用程序池、将虚拟目录转换为 IIS 中的应用程序并选择新的应用程序池来解决这个问题。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-27T18:13:56.677

在阅读了几乎对我有用的 Mikko 的答案后，我想出了自己的安装笔记。我的设置被设计成一个“不受保护和开放”的存储库，我的团队成员可以使用它安装在 Windows 2008 Server 上。

**1\. 安装 Python。**

我使用的 Python 版本是[Python 2.6.2](http://www.python.org/ftp/python/2.6.2/python-2.6.2.msi)，我使用的是 Windows x86 MSI Installer。

*   为所有用户安装。
*   安装到 C:\Mercurial\Python
*   使用默认功能选项。

**2.安装MinGW。**
我使用的适用于 Windows 的 Minimalist GNU 版本是[MinGW 5.1.4](http://sourceforge.net/project/showfiles.php?group_id=2435&package_id=240780)

*   安装 MinGW-5.1.4.exe。
*   选择下载和安装选项。
*   选择要安装的当前包选项。
*   对于要安装的组件选择“最小”选项。
*   安装到 C:\Mercurial\MinGW

**3\. 修改你的路径。**

此时您需要在环境路径中添加位置。

*   将“ *C:\Mercurial\Python26;C:\Mercurial\MinGW\bin* ”添加到路径（顺序事项。）

**4\. 安装 Mercurial。**

我使用的 mercurial 版本是 stable 分支中的最新版本，我没有使用二进制文件，而是使用了源代码。我想自己编译 mercurial，这样它就可以与我安装的任何版本的 Python 一起工作，所以我不必担心任何兼容性问题，我发现这是其他安装方法的最大挑战。获取源代码的最简单方法是下载“zip”文件。 [Mercurial 稳定版](http://selenic.com/repo/hg-stable)

*   将 Zip 文件解压缩到 C:\Mercurial\Source。
*   在命令提示符下构建源。

```
python setup.py build --force -c mingw32
python setup.py install --force --skip-build
```

**5\. 修改你的路径。**

您需要在环境路径中插入“hg”命令的另一个位置。

*   将“ *C:\Mercurial\Python26\Scripts;C:\Mercurial\Python26;C:\Mercurial\MinGW\bin* ”添加到路径（顺序事项。）

**6\. 创建您的配置文件。**

如果要在此服务器上本地执行任何提交，则需要设置默认用户名。

*   创建文件' *"C:\Documents and Settings{username}.hgrc"* '

```
[用户界面]  
编辑器 = 记事本  
用户名 = 你的名字
```

**6\. 测试您的安装。**

打开一个新的命令窗口并使用“ *hg debuginstall* ”进行测试以进行验证。您应该会看到类似以下内容。

```
正在检查编码 (cp1252)...  
正在检查扩展...  
正在检查模板...  
正在检查补丁...  
检查提交编辑器...  
正在检查用户名...  
未检测到问题  

```

**7\. 设置网页目录。**

*   创建目录' *C:\Mercurial\Web* '
*   将 hgwebdir.cgi 文件从“ *C:\Mercurial\Source* ”复制到“ *C:\Mercurial\Web* ”

**8\. 为集中存储库配置 IIS7。**

我使用了使用 .Net 2.0 的 DefaultAppPool，Pipeline=Integrated，Identity = ApplicationPoolIdentity。

*   确保 CGI 功能在 IIS7 中可用。
*   控制面板/程序/Windows 功能/IIS/应用程序开发功能/CGI
*   在您希望的网站上将应用程序添加到 IIS 中。
*   别名=Mercurial -- 物理路径=C:\Mercurial\Web
*   在 App 上选择 HTTP Modules 并添加一个新的 Module Mapping。
    *   请求路径=*.cgi，模块=CgiModule，可执行文件=C:\Mercurial\Python26\python.exe %s，名称=Mercurial。
    *   当提示添加条目到 ISAPI 和 CGI​​ 限制列表时说是。

**9\. 测试您的 Web 设置。**

您现在应该能够浏览[http://localhost/Mercurial/hgwebdir.cgi](http://localhost/Mercurial/hgwebdir.cgi)并查看并清空存储库列表。

**10\. 为友好 URL 配置 IIS7**

我不喜欢不友好的 URL，这一步允许我们将 URL 重新映射到更友好的东西。为 IIS安装[URL 重写模块 1.1](http://www.iis.net/extensions/URLRewrite)扩展。

*   在 IIS 管理器功能视图中的 Mercurial IIS 应用程序上，选择 URL 重写组件并安装新规则。
*   选择添加规则，然后选择模板“带有重写映射的规则”。规则操作=重写，指定重写映射=Mercurial
*   添加映射条目。OriginalValue='/Mercurial/Repo'，新值='/Mercurial/hgwebdir.cgi'

**11\. 创建 Mercurial 存储库**

您现在可以创建一个测试存储库。

*   创建目录 C:\Mercurial\Repository 并确保 IUSR 帐户具有写入目录的权限。（如果域帐户更像 IUSR_{ComputerName}。
*   创建文件 C:\Mercurial\Web\hgweb.config 以列出存储库。

```
[路径]
/ = C:\Mercurial\Repository\**
```

*   添加目录 C:\Mercurial\Repository\Test 并使用 'hg init' 初始化存储库

** 如果您现在希望能够在没有 ssl 的情况下推送，请在存储库的 .hg 目录中创建一个 hgrc 文件，如下行。

```
[网络]
允许推送 = *
push_ssl = 假
```

**参考：**

[Mercurial Wiki Windows Install](http://www.selenic.com/mercurial/wiki/WindowsInstall)
[HG Book](http://hgbook.red-bean.com/read/collaborating-with-other-people.html#sec:collab:cgi)
[一步一步](http://www.selenic.com/mercurial/wiki/HgWebDirStepByStep)
[发布 Mercurial 存储库](http://www.selenic.com/mercurial/wiki/PublishingRepositories)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-28T18:27:38.697

对于从 VSS 迈出第一步的团队，我会建议使用[SubVersion](http://subversion.tigris.org/)进行源代码控制，使用[TortoiseSVN](http://tortoisesvn.tigris.org/)或[VisualSVN](http://www.visualsvn.com/)进行客户端。

但是，如果团队决定切换到 DVCS，那么我建议使用 Mercurial，因为它[通过 TortoiseHg 更好地支持客户端上的 HTTP 和 windows](http://code.google.com/p/support/wiki/DVCSAnalysis)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T07:19:36.580

如果您正在寻找：

1.  分布式开发支持
2.  无缝运行 Windows 服务器
3.  和一个很棒的图形用户界面

您正在准确描述[塑料单片机](http://www.plasticscm.com/xpproducts.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-06T11:37:06.497

请原谅我的 necroposting 和无耻的自我推销，但我刚刚发布了[HgLab](http://hglabhq.com/)的 alpha 版本，它是一个适用于 Windows 的 Mercurial Server，具有完全的推拉支持和 Active Directory 集成。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-12-06T13:58:28.030

与 SCM 无关的（在某种程度上）具有 Repository-frontent 和管理的 Windows 解决方案今天可能是[SCM-Manager](http://www.scm-manager.org/)（Git、Mercurial、SVN 开箱即用，只需要 JVM）

# sql - 使用交易来避免竞争

> ID：799190
> 
> 赞同：1
> 
> 时间：2009-04-28T18:10:02.653
> 
> 标签：sql, ado.net, transactions

我正在编写一个守护程序来监视新对象的创建，它在检测到新事物时将行添加到数据库表中。我们将调用对象小部件。代码流程大致是这样的：

```
1: every so often:
2:   find newest N widgets (from external source)
3:   foreach widget
4:     if( widget not yet in database )
5:       add rows for widget 
```

最后两行表示一个竞争条件，因为如果此守护进程的两个实例同时运行，如果时间对齐，它们都可能为小部件 X 创建一行。

最明显的解决方案是`unique`在小部件标识符列上使用约束，但由于数据库布局，这是不可能的（实际上允许小部件有不止一行，但守护程序不应该这样做自动地）。

我的下一个想法是使用事务，因为这是它们的目的。在 ADO.NET 世界中，我相信我想要一个隔离级别[`Serializable`](http://msdn.microsoft.com/en-us/library/system.enterpriseservices.transactionisolationlevel.aspx)，但我并不肯定。有人可以指出我正确的方向吗？

**更新**：我做了一些实验，序列化事务似乎没有解决问题，或者至少不是很好。下面描述了一个有趣的情况，并假设只涉及一个表。请注意，我对锁定细节并不积极，但我认为我是对的：

```
Thread A: Executes line 4, acquiring a read lock on the table
Thread B: Executes line 4, acquiring a read lock on the table
Thread A: Tries to execute line 5, which requires upgrading to a write lock
   (this requires waiting until Thread B unlocks the table)
Thread B: Tries to execute line 5, again requiring a lock upgrade
   (this requires waiting until Thread A unlocks) 
```

这使我们处于典型的僵局状态。其他代码路径也是可能的，但如果线程 A 和 B 不交错，则无论如何都不存在同步问题。最终结果是在 SQL 检测到死锁并终止其中一个语句后，在其中一个线程上引发 SqlException。我可以捕捉到这个异常并检测到特定的错误代码，但感觉不是很干净。

我可能采取的另一条路线是创建第二个表来跟踪守护程序看到的小部件，我可以在其中使用`unique`约束。这仍然需要捕获和检测某些错误代码（在这种情况下，违反完整性约束），所以我仍然对更好的解决方案感兴趣，如果有人能想到一个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T18:21:15.873

通常，如果您有多个进程或线程同时使用数据库，则应始终使用事务。

隔离级别“可序列化”实际上应该有效。它不允许从一个事务读取的数据被另一个事务更改。但是它锁很多，一般不应该使用，因为它会减慢应用程序的速度，并且有更高的死锁风险。

备择方案：

*   您只能**锁定整个表**，以确保在您检查是否有东西时没有人写入它。问题是，只有一个人可以同时写入表，这意味着这会大大减慢一切。（您可以搜索数据，如果*不存在*，锁定表并在插入之前*再次搜索。这是一种常见的模式。）*
*   老实说，您应该考虑两个事务尝试同时插入同一行的事实。这可能是您应该开始解决它的地方。只有一个守护进程应该负责相同的数据。
    *   让每个守护进程处理自己的数据
    *   让每个守护进程调用服务而不是数据库。在那里你可以在插入之前把东西放在一起。

顺便说一句，无论如何，您都需要数据的唯一标识符才能清楚地识别它。如果没有唯一标识符，如何在数据库中搜索它？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T18:18:43.930

你如何检查'如果（数据库中还没有小部件）'。如果这是在 sql 中以“Select”的形式编写的，您可以使用“Select for update”来允许一次只允许一个守护程序实例执行此操作。通过对最后两行使用事务，并使用“选择更新”来锁定，您将避免竞争。

我确信 ado.net 中有一个等价物。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T18:21:54.310

如果您有 SQL Server 2008（或其他支持它的 DBMS），请考虑使用 MERGE 语句。仅当行不存在时，才可以将其编写为插入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T02:26:04.053

> （实际上允许一个小部件有不止一行，但守护进程不应该自动执行此操作）

那么问题就不是数据库了。事实上，你有多个不知道已经检测到同一个对象的守护进程。在我看来，这就是你需要集中注意力的地方。从数据库的角度来看，它们都提交了完全合法的行。

如果你改变会发生什么：

```
1: every so often:
2:   find newest N widgets (from external source)
3:   foreach widget
4:     if( widget not yet in database )
5:       add rows for widget 
```

到

```
1: every so often:
2:   while there are unhandled widgets
2:       find first unhandled widget
4:       if( widget not yet in database )
5:           add one row for widget 
```

# asp.net-mvc - ASP.NET MVC 结构设计问题

> ID：799197
> 
> 赞同：1
> 
> 时间：2009-04-28T18:12:50.930
> 
> 标签：asp.net-mvc, asp.net-mvc-routing

我是 ASP.NET MVC 的新手，我面临一些结构设计问题。

我不知道如何设置路由。

我想要以下内容：

```
http://website/ > HomeController Action=Index

上市：
http://website/{controller} > SectionController Action=Index
http://website/products/id > ProductsController Action=Details
http://website/products/category/id > ProductsController Action=ListByCatId
http://website/products/categories/ > ProductsController Action=ListCategories
http://website/products/categories/id > ProductsController Action=DetailsCategories

行政：
http://website/admin/ > AdminController Action=Index
http://website/admin/{controller} > SectionController Action=Index

```

对于大多数部分，默认的 mapRoute 都很好：

```
routes.MapRoute("Default", "{controller}/{action}/{id}", _
                New With {.controller = "Home", .action = "Index", .id = ""}) 
```

当我开始放置“类别”而不是产品的 id 时，问题就开始了……
**我应该对 routeUrls 进行“硬编码”，例如“products/category/{id}”吗？**

对于管理部分：
**我想将属于网站管理部分的所有控制器放在：/Controllers/Admin/XxxController.vb 中。是否可以对它们进行命名空间并让它们具有与公共部分相同的名称？eq
- 用于公共部分的 Website.ProductsController 类和
- 用于管理部分的 Website.Admin.ProductsController？我应该如何设置这个？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T18:42:35.947

我会这样做：

```
routes.MapRoute("ProductDetail", "Products/{id}", _
    New With {.controller = "Products", .action = "Details", .id = ""},
    New With {.id = @"\d+"})
    //constraint, so this route will not catch a category name
    //or the URL below

routes.MapRoute("ProductList", "Products/category/{id}", _
    New With {.controller = "Products", .action = "ListByCatId", .id = ""})

routes.MapRoute("Category", "Products/categories/{id}", _
    New With {.controller = "Products", .action= "ListCategories", .id = ""})
    //for the route above, let it fall to the ListCategories action
    //and in that action take a nullable of int as a parameter.
    //if the id parameter has a value, 
    //    return DetailsCategories(id)
    //else list the categories.

routes.MapRoute("Default", "{controller}/{action}/{id}", _
    New With {.controller = "Home", .action = "Index", .id = ""}) 
```

至于拥有两个具有相同名称的控制器，是的，您可以使用不同的命名空间并在 mapRoute 方法中指定它们来做到这一点。有一个过载需要`string[] namespaces`。只需确保在路由时为具有相同名称的控制器指定名称空间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T18:43:47.427

是的，如果您需要添加与默认路由不对应的其他路由，请继续执行此操作。您将希望在默认路由之上添加额外的自定义路由，并在添加路由时使用从窄到宽的顺序（以便首先匹配窄）。我建议让您的控制器操作与您希望首先显示的默认命名尽可能匹配。

代替：

```
http://website/products/id               > ProductsController Action=Details
http://website/products/category/id      > ProductsController Action=ListByCatId
http://website/products/categories/      > ProductsController Action=ListCategories
http://website/products/categories/id    > ProductsController Action=DetailsCategories 
```

使用：

```
http://website/product/id               > ProductsController Action=Index
http://website/product/category/id      > ProductsController Action=category
http://website/product/      > ProductsController Action=Index
http://website/product/categories/id    > ProductsController Action=categories 
```

您的 Index 方法可以采用一个可为空的 int (int?Id)，其中 Id 对应于定义的产品。如果 Id.HasValue 为 false，则返回 ListCategories 结果。

```
 public ActionResult Index(int? Id)
{
  if (Id.HasValue) return Details(Id.Value);
  return ListCategories();
} 
```

这可以使您的附加路由保持清洁。

# objective-c - Mac OSX/iPhone 上的 C 预处理器，“#”键的使用？

> ID：799205
> 
> 赞同：2
> 
> 时间：2009-04-28T18:15:08.553
> 
> 标签：objective-c, cocoa, cocoa-touch, c-preprocessor, stringification

我正在查看一些开源项目，并且看到以下内容：

```
NSLog(@"%s w=%f, h=%f", #size, size.width, size.height) 
```

尺寸符号前的“#”到底是什么意思？**这是C**字符串的某种前缀吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T18:46:41.803

为了详细说明 dirkgently 的答案，这看起来像是一个宏的实现，它接受一个 NSSize （或类似的）参数，并打印变量的名称（这是 # 正在做的事情；将变量的名称转换为包含变量的名称），然后是它的值。所以在：

```
NSSize fooSize = NSMakeSize(2, 3);
MACRO_NAME_HERE(fooSize); 
```

宏将扩展为：

```
NSLog(@"%s w=%f h=%f", "fooSize", fooSize.width, fooSize.height); 
```

并打印：

```
fooSize w=2.0 h=3.0 
```

（类似于 NSStringFromSize，但带有变量名）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T18:20:04.503

这是宏定义的主体吗？然后`#`可以用来对以下标识符进行字符串化，即打印“字符串”（不带代码）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-29T04:44:38.230

的正式名称`#`是*字符串化操作符*。它接受其参数并将其括在引号中以使 C 字符串成为常量，并根据需要转义任何嵌入的引号或反斜杠。它只允许在宏的定义中使用——在常规代码中是不允许的。例如：

```
// This is not legal C
const char *str = #test

// This is ok
#define STRINGIZE(x) #x
const char *str1 = STRINGIZE(test);      // equivalent to str1 = "test";
const char *str2 = STRINGIZE(test2"a\"");  // equivalent to str2 = "test2\"a\\\""; 
```

一个相关的预处理器操作符是*标记粘贴操作符* `##`。它需要两个令牌并将它们粘贴在一起以获得一个令牌。与字符串化运算符一样，它只允许在宏定义中使用，而不是在常规代码中。

```
// This is not legal C
int foobar = 3;
int x = foo ## bar;

// This is ok
#define TOKENPASTE(x, y) x ## y
int foobar = 3;
int x = TOKENPASTE(foo, bar);  // equivalent to x = foobar; 
```

# silverlight - 您在 Silverlight 中使用 IsolatedStorage 的目的是什么？

> ID：799206
> 
> 赞同：2
> 
> 时间：2009-04-28T18:15:08.837
> 
> 标签：silverlight, isolatedstorage

除了可能在本地临时缓存一些图像或代码之外，我没有看到隔离存储的很多价值。由于您只能获得 1MB，因此即使这样做，我也看不到它有多大价值。在独立存储中保存设置没有多大意义，因为用户可以从不同机器上的另一个浏览器访问您的 silverlight 应用程序。

Plus 设置存储在服务器上更有意义。

你使用了我可能错过的隔离存储？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-28T18:29:25.620

Robert --*默认*为 1MB，您（作为开发人员）可以请求将配额增加到用户可能拥有的任何可用空间量。例如，我们有一些客户将 Silverlight 用于离线媒体应用程序，并使用 750MB 的空间来存储电影。

-th

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T18:33:38.510

我不确定是否还有其他好处，但我想用几个例子来看看它。

1）将所有页面加载数据缓存在隔离存储中，以便在必须刷新页面时应用程序不必访问服务器（例如由于弹出窗口阻止程序）。

更多信息： [使用 Silverlight 隔离存储进行本地状态备份](http://community.irritatedvowel.com/blogs/pete_browns_blog/archive/2008/02/26/Using-Silverlight-Isolated-Storage-for-Local-State-Backup.aspx)

2)[隔离存储](http://silverlight.net/themes/blogs/paperclip/post.aspx?App=msnow&y=2008&m=07&d=16&PostName=tip-of-the-day-19-using-isolated-storage)是使用 cookie 的一个很好的替代方案，尤其是在处理大量数据时。*使用示例包括应用程序的撤消功能、购物车项目、窗口设置以及应用程序下次加载时可以调用的任何其他设置。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T18:57:53.443

AOL Mail 使用它来存储邮件标题，以便快速浏览邮件消息的树状控件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T13:03:06.503

See this web app ToolToMeet.com of how isolated storage can be used instead of using a central database

# .net - IronPython - JSON 选择

> ID：799215
> 
> 赞同：4
> 
> 时间：2009-04-28T18:18:25.303
> 
> 标签：.net, json, ironpython, dynamic-language-runtime

在 IronPython 2.0.1 中处理 JSON 的最佳方法是什么。本机 Python“标准库”json 似乎尚未实现。

如果我想使用 Newtonsoft Json.NET 库，我该怎么做？我可以将程序集添加到 GAC，但我的其他选择是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-03T20:54:26.320

此链接概述了使用 IronPython 向 .Net dll 添加引用的方法：[Haibo Luo 的博客：IronPython: clr.AddReference](http://blogs.msdn.com/haibo_luo/archive/2007/09/25/5130072.aspx)

因此，例如，如果您想避免将 Json.NET 库放在 GAC 中，您可以使用

`import clr
clr.AddReferenceToFile("jsonnet.dll")`

或者

`clr.AddReferenceToFileAndPath("C:\\libraries\\jsonnet.dll")`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-07-09T17:55:54.430

```
#list with data
data=[]
item={}
item["name"]="joe's pizza"
item["tel"] = "343-4333"
data.append(item)

#returns: [{'tel': '343-4333', 'name': "joe's pizza"}] 
#but not valid JSON 
print str(data) 

#returns [{"tel":"343-4333","name":"joe\u0027s pizza"}]
import clr
clr.AddReference('System.Web.Extensions')
from System.Web.Script.Serialization import JavaScriptSerializer #since .net 3.5?
json=JavaScriptSerializer().Serialize(data)
print str(json) 
```

# .net - 以编程方式插入标签 (VB.NET)

> ID：799226
> 
> 赞同：6
> 
> 时间：2009-04-28T18:19:58.247
> 
> 标签：.net, vb.net, literals

我正在尝试将结果动态添加到此显示中，我只是想在标签之后放置一个中断标记，以开始将信息放在下一行。出于某种原因，使用文字对我不起作用。有没有更好的方法来做到这一点，还是我应该只使用表格？

```
Dim break As LiteralControl
break = New LiteralControl("<br />")
divListenerInfo.Controls.Add(break) 
```

这是我尝试使用的代码的一部分。

* * *

让我澄清一下我所说的：

它不起作用，因为换行符没有显示在网页上。它编译得很好，代码没有任何问题。由于某些奇怪的原因，它只是没有出现在 html 中。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-28T18:40:15.890

正确使用的控件是[`HtmlGenericControl`](http://msdn.microsoft.com/en-us/library/7512d0d0(VS.71).aspx).

```
Dim br As New HtmlGenericControl("br") 
```

您可以使用`HtmlGenericControl`来呈现您希望的任何 HTML 元素，只需将元素的标签名称作为单个参数传递给构造函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T18:25:39.637

为什么不直接使用另一个标签，或者将 附加`<br>`到之前的 label.txt 中？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T18:42:16.010

如果添加
的是容器 div 中的最后一个元素，则看不到任何区别。

你可以试试 ：

```
Dim breakTag As LiteralControl
breakTag= New LiteralControl("<br />&nbsp;")
divListenerInfo.Controls.Add(breakTag) 
```

看到休息。

但我认为您应该首先在此 Literal 中添加一个虚拟文本，如果添加了它，请在您的页面中搜索它。因为你的代码看起来不错。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-07T07:37:44.233

我知道这是在恢复一个旧帖子，但我没有看到任何明确的答案，我终于为我自己的申请找到了答案。希望它可以帮助别人！
在我的应用程序中，我尝试创建一次控件并在需要的地方再次添加它。每个父级只能创建一次控件。
**每次需要时都需要创建一个新控件！**
所以这：

```
divListenerInfo.Controls.Add(New LiteralControl("&lt;br />"))
divListenerInfo.Controls.Add(New LiteralControl("&lt;br />")) 
```

而不是这个

```
Dim breakTag As LiteralControl
breakTag= New LiteralControl("&lt;br />")
divListenerInfo.Controls.Add(breakTag)
divListenerInfo.Controls.Add(breakTag) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-28T18:30:38.300

我不确定 break 是否也是 vb.net 中的保留词，所以试试

```
Dim newline = New LiteralControl("<br>") 
```

或者

```
newline.Text="<br>"; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T18:47:17.837

我会尝试使用调试器单步执行代码以确保该行被命中，同时三重检查是否`divListenerInfo`是正确的控件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-24T09:47:01.673

我认为您正在使用面板或占位符。

vb.net 或 C# .net 语法：

```
divListenerInfo.Controls.Add(New LiteralControl("< br >")) 
```

# asp.net - ASP.NET 网站上的实时网络摄像头

> ID：799232
> 
> 赞同：2
> 
> 时间：2009-04-28T18:21:16.107
> 
> 标签：asp.net, webcam

我需要一种在我的 ASP.NET 应用程序上放置实时网络摄像头视频的方法。

我基本上想从以前做过这件事的人那里得到答案。完成简单的网络摄像头馈送的最简单且最具成本效益的方法是什么？从技术上讲，它不一定是流式视频（尽管这是首选）。

我可以接受每隔几秒钟刷新一次的图像。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-01T14:33:50.683

*   您可以使用具有嵌入式网络服务器的[Axis网络摄像头。](http://www.axis.com/products/video/camera/index.htm)这可能比便宜的 PC 网络摄像头贵一点，但直接支持网络流媒体。不幸的是，这不能很好地扩展，因为嵌入式网络服务器只能处理几个并发连接。

# webserver - 网络爬虫在对网络服务器的重复请求之间等待的最佳持续时间是多少

> ID：799239
> 
> 赞同：7
> 
> 时间：2009-04-28T18:21:44.077
> 
> 标签：webserver, web-crawler

爬虫是否必须在重复命中同一服务器之间等待一些标准持续时间，以免服务器负担过重。

如果没有，任何关于什么可以是爬虫的良好等待期的建议被认为是礼貌的。

这个值是否也因服务器而异......如果是这样，如何确定它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T18:26:40.837

IBM 上的这篇文章详细[介绍了 Web 爬虫如何使用机器人排除协议](http://publib.boulder.ibm.com/infocenter/discover/v8r5m0/index.jsp?topic=/com.ibm.discovery.es.ad.doc/administering/iiysacwebrobots.htm)和[Web 爬虫中的重新爬取间隔设置](http://publib.boulder.ibm.com/infocenter/discover/v8r5m0/index.jsp?topic=/com.ibm.discovery.es.ad.doc/administering/iiysacwebrec.htm)

引用文章。

> 第一次爬取页面时，爬虫使用页面被爬取的日期和时间以及指定的最小和最大重新抓取间隔的平均值来设置重新抓取日期。在该日期之前不会重新抓取该页面。在该日期之后重新抓取页面的时间取决于抓取工具的负载以及抓取空间中新旧 URL 的平衡。
> 
> 每次重新抓取页面时，爬虫程序都会检查内容是否已更改。如果内容发生了变化，下一次重新抓取间隔会比上一次短，但绝不会短于指定的最小重新抓取间隔。如果内容没有改变，下一次重新抓取间隔将比上一次长，但永远不会超过指定的最大重新抓取间隔。

这是关于他们的网络爬虫的，但在构建自己的工具时非常有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-15T05:00:36.887

我知道这可能有点晚了，但答案并没有帮助我解决这个问题。我也担心爬虫多久会访问服务器。尤其是阅读 wikipedia.org robots.txt，其中禁止“每秒点击多次，不可接受”的机器人。

我发现了这篇有趣的 MS Research 文章，标题为 Web Crawler Architecture - [http://research.microsoft.com/pubs/102936/EDS-WebCrawlerArchitecture.pdf](http://research.microsoft.com/pubs/102936/EDS-WebCrawlerArchitecture.pdf)。以下是关于礼貌的论文。

> 有许多可能的礼貌政策；一个特别容易实现的方法是禁止对同一 Web 服务器的并发请求；稍微复杂一点的策略是等待与上次下载时间成正比的时间，然后再次联系给定的 Web 服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T19:05:19.760

我认为访问网站的频率没有最小间隔，因为它高度依赖于当前的服务器负载和服务器能力。

您可以尝试测试响应时间和超时率，如果某个站点响应缓慢或出现超时错误，您应该增加重新点击间隔，即使它可能不是您的爬虫导致缓慢或时间-出局。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T18:23:26.397

这将取决于内容更改的频率。例如，与具有静态文章的网站相比，更频繁地抓取新闻网站是有意义的。

至于究竟如何确定最佳值 - 这将取决于您如何根据拥有最新数据的价值来判断获取、索引等的成本。这完全取决于您 - 但您可能必须使用一些启发式方法来根据观察结果计算出网站随时间变化的程度。如果一个站点连续 3 次提取都没有改变，那么您可能希望在下一次提取之前等待更长时间。相反，如果一个站点在您每次获取它时总是发生变化，那么您可能希望更积极一点以避免错过更新。

# c# - IP 地址的字段验证

> ID：799244
> 
> 赞同：1
> 
> 时间：2009-04-28T18:22:40.580
> 
> 标签：c#, winforms, validation, controls, keyboard

除了 C# 中的数字或句点之外，我试图阻止用户在特定文本框中输入任何内容。文本框应该包含一个 IP 地址。我让它工作，以防止非数字条目，但我似乎无法让它允许输入句点。我怎么能做到这一点？

```
 private void TargetIP_KeyDown(object sender, KeyEventArgs e)
    {
        // Initialize the flag to false.
        nonNumberEntered = false;

        // Determine whether the keystroke is a number from the top of the keyboard.
        if (e.KeyCode < Keys.D0 || e.KeyCode > Keys.D9)
        {
            // Determine whether the keystroke is a number from the keypad.
            if (e.KeyCode < Keys.NumPad0 || e.KeyCode > Keys.NumPad9)
            {
                // Determine whether the keystroke is a backspace.
                if (e.KeyCode != Keys.Back)
                {
                    nonNumberEntered = true;
                    errorProvider1.SetError(TargetIP, FieldValidationNumbersOnly);
                    // A non-numerical keystroke was pressed.
                    // Set the flag to true and evaluate in KeyPress event.
                }
            }
        }

        //If shift key was pressed, it's not a number.
        if (Control.ModifierKeys == Keys.Shift)
        {
            nonNumberEntered = true;
        }
    }

    private void TargetIP_KeyPress(object sender, KeyPressEventArgs e)
    {
        // Check for the flag being set in the KeyDown event.
        if (nonNumberEntered == true)
        {
            // Stop the character from being entered into the control since it is non-numerical.
            e.Handled = true;
        } 

        else
        {
            errorProvider1.Clear();
        }
    } 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-28T18:25:18.547

您应该使用[`MaskedTextBox`](http://msdn.microsoft.com/en-us/library/system.windows.forms.maskedtextbox(loband).aspx)控件而不是普通`TextBox`控件。然后只需将[`Mask`](http://msdn.microsoft.com/en-us/library/system.windows.forms.maskedtextbox.mask.aspx)属性设置为即可`990\.990\.990\.990`。

*   9 个可选数字或空格
*   0 必填数字
*   \。转义点

**更新**

虽然我建议使用`MaskedTextBox`，但我从未（至少我不记得）自己使用过它。现在我只是尝试了一下……好吧，忘记我说的话。我认为这可能是一个简单的解决方案，但它也是一个无法使用的解决方案。

新的、更复杂但更好的建议以及我通常这样做的方式。

*   创建一个包含四个文本框的自定义控件，三个标签之间各有一个点。

*   分析输入。

    *   只需将控制键传递给控件。
    *   如果用户输入点、制表符（将由控件处理）、空格、可能是第四位数字，则移动焦点。
    *   丢弃所有不是数字的东西。
    *   如果数字不在 0 到 255 的范围内，则丢弃该数字。
    *   如果用户删除最后一个数字，则将文本更改为 0。
    *   如果用户输入非零数字，则删除前导零。
*   向返回输入地址的用户控件添加一个属性。

*   可以使属性可写并添加事件处理。

# java - Eclipse 中的 I/O 重定向？

> ID：799250
> 
> 赞同：8
> 
> 时间：2009-04-28T18:24:41.950
> 
> 标签：java, eclipse, io-redirection

是否可以在 Eclipse 中使用 I/O 重定向？

我想在命令行上重定向标准输入/输出`java MyProgram <input.txt >output.txt`，但我似乎无法让它在 Eclipse 中工作。我尝试将 <'s 作为程序参数的一部分，它被忽略了，也包括在 VM 参数中，它只是抛出了一个找不到类的错误。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-28T18:30:36.317

您可以使用“运行”对话框、“通用”选项卡、“标准输入和输出”部分重定向*输出。*

但是，据我所知，您似乎无法重定向*输入*（并且[据此 Stack Overflow 问题](https://stackoverflow.com/questions/188547/eclipse-reading-stdin-system-in-from-a-file/188654)也可以告诉）。

您对您的应用程序有多少控制权？如果您不介意一些 hack，您可以有几个属性或命令行参数来确定适当的文件，并相应地使用`System.setOut`和使用`System.setIn`。不过，这*有点*骇人听闻...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T18:35:53.513

要真正重定向两者，最简单的方法仍然是将您的程序定义为外部脚本

```
 "java %1 %2 %3 %4 < %5 > %6" 
```

（根据您的特定程序调整参数数量）

在“运行”菜单中，单击“外部工具.../打开外部工具对话框”并定义一个外部启动配置，您将在其中指定参数以及输入和输出文件。

* * *

虽然它不是一个理想的解决方案，因为您不能*直接*调试您的代码（使用“调试”启动器配置）。
相反，您必须对其进行远程调试（`-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8000`在您的通用 Java 启动器脚本中添加“”）

启动外部工具后，通过“调试启动器‘远程 Java 应用程序’”部分启动远程调试会话：

![远程调试，在 blog.jmwyttenbach.net/wp-content/uploads/2007/10/eclipseremotedebug.jpg 之后](https://i.stack.imgur.com/4pViB.jpg)

# ssl-certificate - 为什么一个 SSL 证书不能用于多台机器？

> ID：799272
> 
> 赞同：32
> 
> 时间：2009-04-28T18:29:08.613
> 
> 标签：ssl-certificate

这是情况。我正在对应用程序进行更改，但我没有测试环境。有一个 QA 服务器供测试团队使用，但我宁愿在我的本地机器上测试应用程序（将更改部署到该服务器可能会中断测试人员）。我已经在本地机器上设置了环境，但是出现了问题。

应用程序从第三方应用程序读取数据。它需要 SSL 证书才能连接到第三方。

我的问题是，为什么我不能在本地机器上使用来自 QA 服务器的 SSL 证书？

我对 Stack Overflow 进行了粗略的搜索，在我看来，一旦 CA 颁发了证书，任何计算机都可以使用它。我的猜测是我误解了 SSL 过程的某些部分。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-28T18:33:52.253

SSL 证书绑定到实际的主机名。如果您有“qa.example.com”的 SSL 证书，它将无法在名为“dev.example.com”的计算机上运行。

也许这就是你遇到的问题。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-28T19:06:12.987

我假设您描述的是对远程第三方执行 SSL 客户端身份验证。您的产品作为客户端启动与第三方的连接，第三方决定您的证书是否足以用于连接。

证书本质上是三样东西：

*   私钥 - 只能由证书所代表的实体拥有
*   公钥 - 与世界共享的密钥
*   证书信息，包括公钥以及识别密钥持有者的可读数据——这是由证书的颁发者以加密方式签名的。

所以......它不仅仅是一个密码，但它最终都是数据。

是否可以在多个位置安装 SSL 客户端证书的答案是“是”和“否”。大多数情况下，这取决于第三方系统的安全要求以及您存储该私钥的方式。

可以将私钥/公钥对和证书存储在文件中 - 一个标准是[PKCS #12](http://en.wikipedia.org/wiki/PKCS_12)。然后通常使用密码保护 PKCS12。许多软件工具将让您创建密钥对，将其存储在 PKCS12 中，并执行请求和完成第三方证书颁发所需的各种证书协议（我怀疑您的第三方要求您的证书由一个签名受信任的发行人列表）。我见过的每个应用程序服务器都允许您将证书文件配置为客户端证书。

如果这就是 QA SSL 证书的存储方式，那么在您的机器上安装它应该没有问题。

这是一个问题——有时安全策略要求将证书存储在硬件令牌上。这通常是一种确保只有一个实体可以使用证书的安全措施。复制软件证书文件在测试环境中运行良好，但对于正常工作的产品安装来说，这是一种非常糟糕的安全实践。如果 QA 服务器正在使用硬件令牌，则硬件可能会保护私钥对复制到另一个位置。如果无法访问私钥对，您将无法向第三方执行 SSL 请求 - 演示访问私钥是协议的一部分。

在这种情况下，您需要申请自己的证书和密钥对才能访问第三方 - 除非您的公司提供共享硬件令牌的机制。这并不完全是疯狂的——一些服务器场会这样做——所有服务器都有配置来接入一个通用的联网 HSM（硬件安全模块）并使用密钥对。这通常适用于 SSL 站点证书，因此集合中的所有服务器都可以看起来是同一台服务器。诀窍是——那种硬件相当高端。如果您正在运行一些快速而肮脏的测试，我认为它不太可能访问那种系统。

我会询问有关软件证书的问题，以及您是否可以拥有一份副本。可能有禁止它的政策原因......但安装它们并不难，如果你只是做一些测试，你真的没有冒任何风险。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-06-26T20:22:23.623

我知道这是一篇较旧的帖子，我可能遗漏了一些东西，但似乎每个人都错过了这里的真正答案。如果您想要一个证书在使用多个主机名/域的多个服务器上工作，那么您只需要购买一个 SAN 证书。我们在工作中总是这样做...

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-28T18:37:17.300

这绝对是可以做到的，否则服务器如何在网络场中工作？Web 场中的所有服务器都安装了相同的证书。

我没有 Apache 的经验，但对于 IIS，该过程记录在这里[http://support.microsoft.com/kb/313299](http://support.microsoft.com/kb/313299)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-11T11:47:55.187

SSL 证书绑定到主机名。因此，为了能够在您的开发机器上使用它，您应该将主机名解析为您的开发机器（即使用主机文件）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-08-17T01:44:41.847

通常在 SSL 握手期间，作为证书一部分的主机名与 SSL 连接另一端的主机名匹配。这就是证书与主机名相关联的原因。

有几种方法可以解决这个问题。

1.  使用通配符证书。
2.  禁用主机名验证并接受增加的风险。
3.  自定义主机名验证。

请参阅[http://support.godaddy.com/help/article/567/what-is-a-wildcard-ssl-certificate](http://support.godaddy.com/help/article/567/what-is-a-wildcard-ssl-certificate) 和[http://docs.oracle.com/javase/7/docs/api/javax/net /ssl/HostnameVerifier.html](http://docs.oracle.com/javase/7/docs/api/javax/net/ssl/HostnameVerifier.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-10-10T19:38:32.963

> @Kyle Jones——我的问题是，为什么我不能在本地机器上使用来自 QA 服务器的 SSL 证书？
> 
> @autonomatt - 子问题：VeriSign 和其他公司询问您在多少台服务器上安装 SSL 证书......让奇怪的客户打电话说他们的浏览器报告了证书问题......

**合法吗？** 您可以在多台计算机上安装 SSL 证书，但可能无法合法地这样做。签署 CA 公司，如 Network Solutions，对您的购买有法律限制。当您购买 SSL 证书时，您购买它只是为了安装在一台计算机上。您应该阅读从中购买证书的签名 CA 的条款。

**技术上？** 从技术上讲，除了一些硬件加速的 SSL 服务器，是的，您可以将 KEY 和 CRT 复制到任何 Web 服务器以提供有效的 SSL 连接。请注意，某些 SSL 证书是从 CA 运送/提供的，证书链也必须安装在服务器端。如果未安装证书链，客户端 Web 浏览器将无法正确验证 SSL 证书。您应该检查 CA 链是否与签名 CA 提供的 SSL 证书一起提供。

**IP 解析要求。**SSL 证书绑定到主机名。当客户端 Web 浏览器向服务器发出请求时，它会连接到从域名解析的 IP 地址，然后开始 SSL/TLS 握手过程。响应该 IP 地址的 Web 服务器必须提供带有客户端 Web 浏览器通过 IP 地址请求的通用名称的 SSL 证书。这意味着每个 IP 地址只能配置一个 SSL 证书。客户端只发送加密的 HTTP 1.1 请求，因此服务器直到 SSL/TLS 握手之后才知道客户端的实际域请求是什么。

**非生产 IP 解析。**要在别处安装，Web 浏览器必须将主机名正确解析为 IP 地址。因此，如果您在非生产环境中，客户端必须以不同于生产环境的方式解析 IP 地址。这可以通过备用 DNS 服务器执行，或者所有机器的本地主机文件都需要备用 DNS 解析。

**技术安装过程。**要在另一台机器上安装 SSL 证书，请将 KEY、SSL CRT 和 CA 链复制到为 Web 服务器配置的相应文件中。如果是 Apache，它可以全部放入 SSL 证书的一个 PEM 文件中。

然后确保 Web 服务器在解析 SSL 证书中的公用名的 IP 地址上提供此 PEM 文件。

**通配符 SSL 证书。**一些 CA 还提供 Willdcard SSL 证书，例如 *.domain.com 。请注意，Web 浏览器必须识别这种类型的证书，并且它只保护一个子域级别。所以 www.domain.com 可以被保护，但是 www.sub1.domain.com 会导致客户端网页浏览器给客户端用户一个验证错误。

**客户端 Web 浏览器收到 SSL 证书验证错误的一些原因：**

1.  如果需要 CA 链但 Web 服务器未提供。
2.  如果根签名 CA 不是客户端 Web 浏览器 SSL 授权中的受信任 CA - 自签名 SSL 证书始终如此。
3.  如果客户端 Web 浏览器通过 SSL 请求与 SSL 证书的通用名称不匹配的域。
4.  如果客户端浏览器无法从签名 CA 访问 x509 CRL 分发点 - 因此受限或封闭网络上的客户端将无法验证 SSL 证书。CRL 的 URL 在 SSL/TLS 握手期间提供。另见：[http](http://en.wikipedia.org/wiki/Revocation_list#Problems_with_CRLs) ://en.wikipedia.org/wiki/Revocation_list#Problems_with_CRLs 。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-03-18T22:14:53.787

证书包含以下信息： 1) 有关持有证书的公司/个人的名称、域、地址、密钥到期日期等详细信息。2）它有公钥。3）一些加密数据。这是症结所在。

此加密数据是证书中存在的所有用户信息以及公钥，该证书已由颁发证书的 CA 的私钥签名。

当浏览器收到证书时，它会尝试使用已经嵌入浏览器的 CA 的公钥对加密数据进行设计。因此，如果证书中存在的所有信息在设计后都匹配，则可以确保证书中提到的域的所有者拥有与证书中提到的公钥对应的私钥。

所以关键是，如果有人发布（像网站一样）我是证书的所有者，这意味着个人/公司拥有相应的私钥对。

所以回到问题：真正的问题是“应用程序从第三方应用程序读取数据。它需要 SSL 证书才能连接到第三方。”

这就是证书的用途。基本上，您的应用程序希望与第三方应用程序建立 SSL 连接，如果您拥有证书，则一切就绪。因此，起初我假设您将证书放在错误的目录中，因此您的应用程序无法读取它并且无法与第三方建立 ssl 连接。或者有一些配置文件问题。

我知道这个答案没有用，但我想最好把我的感受写出来。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-28T18:37:15.087

我认为您需要详细说明您的环境，但也许您还没有将证书的私钥部分复制到本地计算机。使用证书需要私钥和公钥。我假设因为您写了“从第三方读取”，所以您正在使用客户端证书。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-28T18:39:08.030

在这些情况下，第三方通常会做两件事之一。让您可以访问不需要证书的 QA 沙箱。或允许您制作他们将接受的临时证书，该证书未经证书颁发机构验证。如果第三方 Web 服务提供商不提供不同的 QA 和 prod 的需求，那就太奇怪了。环境。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-04-21T21:46:16.640

从技术上讲，证书（从这些 PKI 工具导出）将不包含私钥。所以即使在负载均衡的环境中，证书的普通复制也无济于事？？

此外，当我们使用 PKI 工具生成证书时，您可以为 DN 提供任意字符串（例如“CN=xyz, OU=ttr, O=x”）。我想知道如果不同的机器使用相同的 DN 来创建证书会有什么行为？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-12-10T05:56:19.287

我知道我对这个问题的回答在线程中为时已晚..但是我今天在负载均衡器配置中将相同的证书安装到 2 台服务器时遇到了同样的问题，操作系统 =Windows 2008/IIS 7.5 并且能够弄清楚解决方案。

我可以通过单击“完成证书请求”并导航到证书“abc.cer”所在的位置将它安装在第一台服务器上（假设您已经拥有证书）。然后我在第二台服务器上复制了相同的“abc.cer”并尝试了“完成证书请求”，但它不起作用。证书将显示为已安装，但一旦我刷新 IIS 管理器就会消失。然后我尝试了从第一台服务器“导出”证书的选项（它生成一个 .pfx 扩展文件），然后在第二台服务器上导入相同的证书。这种方法奏效了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-12-29T18:33:05.487

这取决于你的意思

一个通配符证书可用于具有不同 A 记录的多个主机。

例如，您有域的通配符证书`*.stackoverflow.com.`只要您运行的新服务器使用域的子域，您就可以使用 CA 批准的 TLS`stackoverflow.com`

IE `mail-server.stackoverflow.com`

# asp.net-mvc - 带有下拉菜单的 MVC 和 XVal - 值“请选择”无效

> ID：799275
> 
> 赞同：1
> 
> 时间：2009-04-28T18:29:51.577
> 
> 标签：asp.net-mvc, validation, xval

我按照[此处](http://blog.codeville.net/2009/01/10/xval-a-validation-framework-for-aspnet-mvc/)概述的方法来执行此操作。

我在使用 xval 验证下拉选择时遇到问题，MVC 绑定似乎推断出允许操作通过验证的错误，但是模型状态存储了绑定异常并使页面无效 - 所以我得到了操作的情况允许使用无效数据执行，但页面无效，因此导致用户相信验证失败。

这可能会更清楚

这是我的下拉菜单，假设用户什么都没做，所以选择了“请选择”。

```
 Do you like cheese:
     <select name="Favourites.Cheese">
         <option>Please Select</option>
        <option value="1">Yes</option>
        <option value="0">No</option>
     </select>
     <%=Html.ValidationMessage("Favourites.Cheese")%> 
```

这也是来自帖子的控制器操作，MVC 将值 false 映射到 fav.cheese，

```
public ActionResult Create(Favourites fav)
{
            try
            {
                _favTask.Create(fav);
            }
            catch (RulesException ex)
            {
                ex.AddModelStateErrors(ModelState, "Favourites");
            }

            if(!ModelState.IsValid)
            {
                //redirect back
            }
            //other stuff
 } 
```

该物业已归属

```
 pulic class Favourites
    {
         [Required]
          public bool Cheese{get;set;}
    } 
```

不会抛出异常，因为 fav.cheese 有一个值

```
public int Create(Favourites fav)
{

   var errors = DataAnnotationsValidationRunner.GetErrors(fav);
   if (errors.Any())
       throw new RulesException(errors);

       //create fav   
 } 
```

但是当焦点返回到控制器时 ModelState.Isvalid 出来为假，所以从重新加载消息**The value 'Please Select' is invalid。**如何阻止这种情况的发生，以及如何使用 xVal 驱动“请选择一个值”的验证方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T18:59:08.747

如果您希望用户不能选择一个值并推断为 false，那么我会给您的默认选择值 0。这样即使他们没有选择一个值，也会发送一个值，并且 Required 属性将满意。

```
<option value="0">Please Select</option> 
```

**编辑**：根据您的评论，我建议使用客户端验证插件进行一些客户端验证——例如 jQuery[验证](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)。在大多数情况下，这将允许您提供合适的错误消息，而无需实际发布请求。在服务器端，如果 ModelState 无效并且该特定字段无效，则将错误消息替换为更合适的错误消息。我不建议仅仅为了适应绑定框架而更改模型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T22:24:38.133

Boolean 是一种值类型，所以它总是有一个值。[必需]因此没有实际效果。如果你改用 Nullable<bool> 会发生什么？如果选择了第一个选项，这应该允许 MVC 分配一个空值，然后 Required 属性可以断言用户确实选择了一个值。

# java - 布尔 getter 方法的有效 JavaBeans 名称

> ID：799280
> 
> 赞同：66
> 
> 时间：2009-04-28T18:30:48.393
> 
> 标签：java, boolean, naming-conventions, javabeans

我知道大多数变量名都可以与“is”一起使用，例如`isBlue()`，但是“has”也是一个有效的前缀，例如`hasProperty()`？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-04-28T18:37:59.077

根据[JavaBeans 规范](http://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/)第 8.3.2 节：

> **布尔属性**
> 另外，对于布尔属性，我们允许一个 getter 方法来匹配模式：
> 
> `public boolean is<PropertyName>();`
> 
> `isPropertyName`可以提供 该“ ”方法来代替“ `get<PropertyName>`”方法，或者可以在“ ”方法之外提供该“ `get<PropertyName>`”方法。在任何一种情况下，如果该`is<PropertyName>`方法存在于布尔属性，那么我们将使用 " `is<PropertyName>`" 方法来读取属性值。一个示例布尔属性可能是：
> 
> 公共布尔 isMarsupial(); 公共无效 setMarsupial(boolean m);

换句话说，除非从那以后发生了一些变化，否则`has`恐怕不是有效的前缀:(

无论如何，*一些*工具和库可能会识别这些属性，但依赖它并不是一个好主意。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-12-25T18:40:05.017

Jon Skeet 指出，根据规范，它是无效的。此外，`canX`、`shouldX`和类似的东西是无效的。这是相当不幸的。这是一种检查给定属性是否具有有效 getter 的方法：

```
BeanInfo info = Introspector.getBeanInfo(Item.class);
Item itm = new Item();
for (PropertyDescriptor pd : info.getPropertyDescriptors()) {
    System.out.println(pd.getName() + " : " + pd.getReadMethod());
} 
```

该类`Item`应该是具有 foo 属性和 getter 的 javabean。如果 read 方法是`null`，则表示没有根据 javabeans 规范定义的有效 getter。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-28T18:32:57.513

这有点主观，但是是的，我会说“有”是布尔属性的完全有效的前缀。

**按要求编辑**问题，没有提到javabeans规范，所以我的回答没有解决问题的那个方面。因此上面的答案。

# ant - 通过 ant 任务使用 WTK 对 jar 进行签名

> ID：799281
> 
> 赞同：1
> 
> 时间：2009-04-28T18:31:54.833
> 
> 标签：ant, java-me, sun, signing

有没有办法通过 ant 任务使用 Sun WTK 为 JavaMe / j2me 应用程序签署 Jar？

示例或教程链接将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T12:36:10.163

你有几个选择：

1.  使用 ant libary 天线，它具有构建、打包、签署 midlets 的附加任务（[http://antenna.sourceforge.net/](http://antenna.sourceforge.net/)）
2.  使用 exec 直接调用 wtk 命令
3.  使用 shell 脚本

我强烈推荐第一个选项。为了让您开始使用天线，请查看下载包中提供的示例文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T19:10:28.547

我有一个用于签名的批处理文件。不确定 ANT 是如何工作的，但我相信你可以弄清楚如何工作：

> java -jar "c:\SPRINT_WTK_31\bin\JadTool.jar" -addcert -alias sprintadp -keystore "c:\SPRINT_WTK_31\appdb\keystore.sks" -inputjad 部署\xxx.jad -outputjad 部署\xxx.jad
> 
> java -jar "c:\SPRINT_WTK_31\bin\JadTool.jar" -addjarsig -jarfile 部署\Phone.fm.jar -keystore "c:\SPRINT_WTK_31\appdb\keystore.sks" -keypass adp2006 -alias sprintadp -inputjad 部署\ xxx.jad -outputjad 已部署\xxx.jad

当然，用真正的证书替换 Sprint ADP 的东西（我希望我有...），并用 Sun 的 WTK 路径替换 Sprint 的 WTK 路径。

# javascript - Ruby - 记忆游戏

> ID：799287
> 
> 赞同：0
> 
> 时间：2009-04-28T18:33:45.123
> 
> 标签：javascript, ruby

我正在尝试使用 Ruby 构建一个非常简单的游戏，它将出现在网络上。我正在尝试：

用户转到页面并出现一个字符串 X 秒数，然后在 X 量后隐藏它并要求用户输入，然后检查该人走了多远（他们猜对了多少）

我会有以下字符串：

以秒为单位的超时文本字符串用户输入字符串

然后我不确定如何比较两个字符串。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T18:38:17.593

关于您可以使用的算法的一些建议：

*   [Levenshtein 距离](http://en.wikipedia.org/wiki/Levenshtein_distance)，用于衡量用户输入对原件的正确程度。
*   如果你真的很勇敢，也可以看看[模糊字符串匹配。](http://en.wikipedia.org/wiki/Fuzzy_string_searching)
*   根据字符串的语言，破解基于[Soundex](http://en.wikipedia.org/wiki/Soundex)的匹配器可能会很有趣。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T20:16:22.303

这假设您从字符串开始，但处理数组中的数据。（包括字符串到数组的方法。）您可以将它用于任何可以放入数组的内容。只需用两个字符串调用并取回分数。当任一字符串较短时，这同样有效。

```
#string to char array
def s_to_a(s)
  a = [] 
  s.each_char{|c| a << c}
  a
end

def memory_rating(s1, s2)
  score = 0

  #convert both strings to arrays
  a1 = s_to_a(s1)
  a2 = s_to_a(s2)

  a1.each do |e|
    # shift allows easy access to all elements of a2 
    # inside the iterator for a1
    score += (e == a2.shift) ? 1 : 0
  end
  score
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T19:24:58.637

对于我脑海中最简单的方法，您可以将其视为 char 数组比较而不是字符串比较。

假设显示了字符串“abcdefg”并且用户输入了“abdcefg”，他被认为记住了给定字符串的 7 个中的 5 个。

# maven-2 - 哪个 Maven(2) 插件与 GWT 1.6 一起使用？

> ID：799292
> 
> 赞同：4
> 
> 时间：2009-04-28T18:34:59.163
> 
> 标签：maven-2, gwt, plugins, maven-plugin

**将Maven**与**GWT 1.6**集成似乎有很多[困惑](http://groups.google.com/group/Google-Web-Toolkit/browse_thread/thread/791832a0e177e87e/6ece1fcd60b4824f?hl=en&ie=UTF-8&q=maven+plugin+gwt+1.6)，因为 Google 已将布局更改为“爆炸战争”格式。*你*用的是哪个插件？它是否有托管/编译的目标？它是“就地”工作，将输出写入，还是使用外部目录？（我[不](https://stackoverflow.com/questions/794839/gwt-1-6-project-war-layout-mixing-source-code-compiler-generated-artifacts)喜欢让 GWT 生成的输出出现在我的源代码树中）。*****`src/main/webapp/WEB-INF`*****

 *****如果你有一些工作，POM 片段也将受到高度赞赏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-04T14:37:32.850

[这里](http://blog.salvadordiaz.fr/2009/04/29/keep-your-source-tree-clean-gwt/)有一篇关于如何一起使用 GWT 1.6、Google Eclipse 插件、maven 2 和 gwt-maven-plugin 的文章。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T19:17:52.547

我通过在[此处](http://code.google.com/p/gwt-maven2-starter-app/)下载 GWT Maven2 Starter App然后将 pom 更改为使用 GWT 1.6.4 来实现此功能，它似乎可以正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-07T09:52:20.393

我已更新[gwt-maven2-starter-app](http://code.google.com/p/gwt-maven2-starter-app/)以使用 GWT 1.6.x 和 codehaus maven-gwt-plugin。他们的解决方法是偏离 maven 约定并使用 1.6 标准 /war 目录就地（而不是 src/main/webapp）用于 webapp 工件和 GWT 生成的输出（您应该将其添加到 .svnignore）。

# python - Python异常：为任何异常调用相同的函数

> ID：799293
> 
> 赞同：6
> 
> 时间：2009-04-28T18:35:33.280
> 
> 标签：python, exception

`foobar()`请注意，如果抛出任何异常，则在下面的代码中调用它。有没有办法在每个异常中不使用同一行？

```
try:
  foo()
except(ErrorTypeA):
  bar()
  foobar()
except(ErrorTypeB):
  baz()
  foobar()
except(SwineFlu):
  print 'You have caught Swine Flu!'
  foobar()
except:
  foobar() 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-28T18:42:01.470

```
success = False
try:
    foo()
    success = True
except(A):
    bar()
except(B):
    baz()
except(C):
    bay()
finally:
    if not success:
        foobar() 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-28T18:43:22.950

您可以使用字典将异常映射到要调用的函数：

```
exception_map = { ErrorTypeA : bar, ErrorTypeB : baz }
try:
    try:
        somthing()
    except tuple(exception_map), e: # this catches only the exceptions in the map
        exception_map[type(e)]() # calls the related function
        raise # raise the Excetion again and the next line catches it
except Exception, e: # every Exception ends here
    foobar() 
```

# mysql - MYSQL：如何在不插入数据的情况下创建新行并获取新 id？

> ID：799302
> 
> 赞同：10
> 
> 时间：2009-04-28T18:38:11.213
> 
> 标签：mysql

通常我通过插入一些数据来获得一个新的 ID，它会创建一个新行并返回新的 ID。但是，如果我不想插入任何数据，我只想创建一个具有新 ID 的新行并获取新 ID……我该怎么做？

谢谢。

**更新：**

好的，这是我的问题。我想这样做的表只有 1 ID 列。为什么？我会解释（我们会尽力）。我有另一个表，其中每一行都有自己的唯一 ID 变体 ID（auto-inc），但每一行都需要绑定到同一个表中的一组其他行。我有另一列名为 group_id 我不能让它自动增加，因为它需要出现多次，它说明了哪些变体应该组合在一起。所以我想拥有第二个以 group_id 作为主键和 auto-inc 的表，这样我可以在需要新组时使用它来生成新的 group_id。我想我会以错误的方式解决这个问题....那我该怎么办？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-05-26T20:49:34.647

这是一个例子：

```
CREATE TABLE X (id int PRIMARY KEY AUTO_INCREMENT); 
```

然后你可以“喂”你的桌子：

```
INSERT INTO X (id) VALUES (NULL);
SELECT LAST_INSERT_ID(); 
```

检查这个小提琴：[http ://sqlfiddle.com/#!2/6b19c/1](http://sqlfiddle.com/#!2/6b19c/1)

希望能帮助到你！

Тарас Лукавий 做了另一个问题，这是答案：

```
CREATE TABLE X (id int PRIMARY KEY AUTO_INCREMENT, time timestamp); 
```

然后你“喂”数据：

```
INSERT INTO X (id, time) VALUES (NULL, now());
SELECT LAST_INSERT_ID(); 
```

现在，让我们检查一下：

```
SELECT * FROM X 
```

你会看到每一行都有自动的 id 和时间戳。

检查这个小提琴：[http ://sqlfiddle.com/#!2/9a344/2](http://sqlfiddle.com/#!2/9a344/2)

希望能帮助到你！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T18:40:20.053

您的所有列都必须可以为空，并且您必须为除 ID 之外的所有其他列插入 null。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T18:45:52.070

你不能只传递空值，还是我误解了这个问题？然后查询将变为：

```
INSERT INTO tableName values (null) 
```

如果您的表不接受空值，则可以使用默认值设置它们，这使您能够执行以下查询：

```
INSERT INTO tableName VALUES (default) 
```

Default 是明确指定列的默认值的关键字。如果所有列都定义了默认值，MySQL 允许您指定一个空值列表： insert into D values()

编辑：因为其他答案已经到来并且没有提到默认关键字我想展示如何使用默认值创建表。它是这样的：

```
CREATE TABLE tableName (id integer default 0, foo varchar(10)) 
```

现在，如果您愿意，只需执行以下操作即可插入 ID 的默认值：

```
INSERT INTO tableName (foo) values ('bar') 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-28T18:55:23.233

`SHOW CREATE TABLE`将显示将分配给下一个插入行的内部 auto_increment 值。请注意，您不应*在*以下语句中使用该值，因为该值可能会在您收到它的微秒内通过不同的插入操作而改变。`LAST_INSERT_ID()`如果适合您的需要，您可以宁愿在其他查询中使用-`LAST_INSERT_ID()`将为您提供在此会话中插入的最后一个 id (=connection)，因此依赖该值是安全的。

```
mysql> CREATE TEMPORARY TABLE test (id INT PRIMARY KEY AUTO_INCREMENT);
Query OK, 0 rows affected (0.00 sec)

mysql> show create table test;
+-------+--------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                         |
+-------+--------------------------------------------------------------------------------------------------------------------------------------+
| test  | CREATE TEMPORARY TABLE `test` (
  `id` int(11) NOT NULL auto_increment,
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 | 
+-------+--------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> INSERT INTO test(id) VALUES(10);
Query OK, 1 row affected (0.00 sec)

mysql> show create table test;
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                                           |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| test  | CREATE TEMPORARY TABLE `test` (
  `id` int(11) NOT NULL auto_increment,
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=11 DEFAULT CHARSET=latin1 | 
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> 
```

**澄清问题后**编辑：****

 **您应该创建反映该逻辑的表并为其命名。创建一个名为组的表（或根据您的应用程序更合适的表）并在每次要生成组时插入一个新条目。您可以使用它的 为该组分配值`LAST_INSERT_ID()`。预先计算 auto_increment 值是非常危险的，最终会导致重复的组 id - 这可能是从非常烦人到致命的任何事情 - 取决于您的应用程序正在做什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T18:40:40.910

需要更多详细信息才能回答，但如果表中的所有列都可以为空，那么您只需插入一个空行并取回自动生成的 ID。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T18:42:33.917

然后需要有一个表格布局，每列都接受 null 并插入 null 值。

如果只需要 id，则锁定表，从该表中选择 max(id) 并添加 1。使用信息并使用新行并释放锁定。

# wcf - WCF：只允许单个客户端并拒绝其他客户端的服务

> ID：799307
> 
> 赞同：4
> 
> 时间：2009-04-28T18:39:21.850
> 
> 标签：wcf, web-services, singleton

我需要创建一个一次只允许一个客户端的 WCF 服务。所有其他请求都应该被拒绝，客户端必须稍后重试。该服务将需要大约一分钟来完成请求。

我试过了：

```
 [ServiceBehavior(IncludeExceptionDetailInFaults=true,
                  InstanceContextMode=InstanceContextMode.Single,
                  ConcurrencyMode=ConcurrencyMode.Single)] 
```

但是如果我在客户端中多次请求服务（使用多个线程），我会在第 3 次请求时收到超时异常，但该服务确实执行了第 3 次请求处理！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T18:49:50.233

您还可以查看“ServiceThrottling”行为，它允许您在服务器端指定要支持多少并发实例、并发调用和并发会话 - 将它们全部设置为 1，您应该有自己的行为。

```
<behaviors>
  <serviceBehaviors>
     <behavior name="Throttled">
         <serviceThrottling maxConcurrentCalls="1"
            maxConcurrentSessions="1"
            maxConcurrentInstances="1" />
     </behavior>
  </serviceBehaviors>
</behaviors> 
```

马克

# jar - 获取 urlclassloader 加载的 jar 文件的大小

> ID：799308
> 
> 赞同：0
> 
> 时间：2009-04-28T18:39:29.183
> 
> 标签：jar, classloader, urlclassloader

有人知道找到由 urlclassloader 动态加载的文件大小的好方法吗？

我以以下方式使用 urlclassloader，但需要跟踪使用了多少带宽。

```
URLClassLoader sysloader = (URLClassLoader) ClassLoader
            .getSystemClassLoader();
Class<URLClassLoader> sysclass = URLClassLoader.class;
Method method = sysclass.getDeclaredMethod("addURL", parameters);
method.setAccessible(true);
method.invoke(sysloader, (Object[]) urls); 
```

提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-23T17:06:57.157

如果您知道正在加载的 url 是 http url，并且您可以确保它们所在的服务器返回 Content-Length 标头，您可以通过以下方式获取它们的大小：

```
public static int getContentLength (URL url)
    throws IOException
{
    String contentLength = url.openConnection().getHeaderField("Content-Length");
    if (contentLength == null) {
        throw new IllegalArgumentException(url + " didn't have a "
            + "Content-Length header");
    } else {
        return Integer.parseInt(contentLength);
    }
} 
```

# c++ - 擦除和删除的区别

> ID：799314
> 
> 赞同：58
> 
> 时间：2009-04-28T18:41:56.930
> 
> 标签：c++, stl

我对 std::remove 算法的用法之间的区别有点困惑。具体来说，当我使用此算法时，我无法理解要删除的内容。我写了一个这样的小测试代码：

```
std::vector<int> a;
a.push_back(1);
a.push_back(2);

std::remove(a.begin(), a.end(), 1);

int s = a.size();

std::vector<int>::iterator iter = a.begin();
std::vector<int>::iterator endIter = a.end();

std::cout<<"Using iter...\n";
for(; iter != endIter; ++iter)
{
    std::cout<<*iter<<"\n";
}

std::cout<<"Using size...\n";
for(int i = 0; i < a.size(); ++i)
{
    std::cout<<a[i]<<"\n";
} 
```

两种情况下的输出均为 2,2。

但是，如果我将擦除与删除一起使用，则如下所示：

```
a.erase(std::remove(a.begin(), a.end(), 1), a.end()); 
```

我得到的输出为 2。

所以我的问题是：

(1)。除了将它与擦除功能一起使用之外，是否还有任何使用 std::remove 的方法。

(2)。即使在执行 std::remove 之后，为什么 a.size() 返回 2 而不是 1？

我在 Scott Meyer 的 Effective STL 书中阅读了有关擦除删除习语的项目。但是我仍然有这种困惑。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-04-28T18:49:42.433

`remove()`实际上并没有从容器中删除元素——它只是将未删除的元素向前分流到已删除元素的顶部。关键是要意识到它`remove()`不仅可以在容器上工作，而且可以在*任何任意前向迭代器对*上工作：这意味着它实际上*不能*删除元素，因为任意迭代器对不一定具有删除元素的能力。

例如，指向常规 C 数组开头和结尾的指针是前向迭代器，因此可以用于`remove()`：

```
int foo[100];

...

remove(foo, foo + 100, 42);    // Remove all elements equal to 42 
```

这里很明显`remove()`不能调整数组的大小！

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2016-12-15T02:47:21.107

**std::remove 是做什么的？**

这里是伪代码`std::remove`。花几秒钟看看它在做什么，然后阅读解释。

```
Iter remove(Iter start, Iter end, T val) {
    Iter destination = start;

    //loop through entire list
    while(start != end) { 
        //skip element(s) to be removed
        if (*start == val) { 
            start++; 
         }
         else //retain rest of the elements
             *destination++ = *start++;
     }

     //return the new end of the list
     return destination;
} 
```

请注意，remove 只是将序列中的元素向上移动，覆盖了您想要删除的值。所以你想要删除的值确实已经消失了，但是问题是什么？假设您有值为 {1, 2, 3, 4, 5} 的向量。在为 val = 3 调用 remove 之后，向量现在具有 {1, 2, 4, 5, 5}。也就是说，4 和 5 向上移动，因此 3 从向量中消失了，但向量*的大小*没有改变。此外，向量的末尾现在包含 5 的额外剩余副本。

**vector::erase 有什么作用？**

`std::erase`需要您想要摆脱的范围的开始和结束。它不采用您要删除*的值，只采用范围的开始和结束。*这是它如何工作的伪代码：

```
erase(Iter first, Iter last)
{
    //copy remaining elements from last
    while (last != end())
        *first++ = *last++;

   //truncate vector
   resize(first - begin());
} 
```

所以擦除操作实际上改变了容器的大小并释放了内存。

**remove-erase 成语**

`std::remove`和的组合`std::erase`允许您从容器中删除匹配的元素，这样如果元素被删除，容器实际上会被截断。这是如何做到的：

```
//first do the remove
auto removed = std::remove(vec.begin(), vec.end(), val);

//now truncate the vector
vec.erase(removed, vec.end()); 
```

这被称为remove-erase idiom。为什么会这样设计？洞察力是查找元素的操作更通用，并且独立于底层容器（仅依赖于迭代器）。但是擦除操作取决于容器如何存储内存（例如，您可能使用链表而不是动态数组）。因此 STL 期望容器在提供通用“删除”操作的同时进行自己的擦除，因此所有容器都不必实现该代码。在我看来，这个名字非常具有误导性，`std::remove`应该叫`std::find_move`.

注意：以上代码是严格的伪代码。实际的 STL 实现更智能，例如，使用`std::move`而不是复制。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-28T18:48:45.870

`std::remove`不会删除实际的对象，而是将它们推到容器的末端。内存的实际删除和释放是通过擦除完成的。所以：

> (1)。除了将它与擦除功能一起使用之外，是否还有任何使用 std::remove 的方法。

是的，它有助于让一对迭代器进入一个新序列，而不必担心适当的取消分配等。

> (2)。即使在执行 std::remove 之后，为什么 a.size() 返回 2 而不是 1？

容器仍然持有这些对象，您只有一组新的迭代器可以使用。因此，大小仍然是以前的大小。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-06-04T20:34:46.453

我遇到了同样的问题，试图了解其中的区别。到目前为止给出的解释是正确的，但我只是在看到一个例子后才理解它们；

```
#include <algorithm>
#include <string>
#include <iostream>
#include <cctype>

int main()
{
    std::string str1 = "Text with some   spaces";
    std::string::iterator it = remove(str1.begin(), str1.end(), 't');
    std::cout << str1 << std::endl;// prints "Tex wih some   spaceses"
    for (str1.begin();it != str1.end(); ++it) 
    {
         std::cout << *it; //prints "es"
    }

} 
```

如您所见，删除仅将小写“t”移动到字符串的末尾，同时将新的迭代器返回到新字符串的末尾（新字符串是旧字符串，直到插入已删除元素的位置) 这就是为什么当您打印从“删除”获得的迭代器时

```
 "Text with some   spaces"
       ^   ^removes both 't', then shift all elements forward -1 //what we want to remove
   "Text with some   spaces"
                          ^ end of string                    -2 //original state of string
   "Tex with some   spacess"
                          ^end of string                     -3 //first 't' removed
   "Tex wih some   spaceses"
                          ^end of string                     -4 //second 't' removed
   "Tex wih some   spaceses"
                        ^new iterator that remove() returned -5 // the state of string after "remove" and without "erase" 
```

如果您将从第 5 步获得的迭代器传递给“erase()”，它将知道从那里擦除到字符串的末尾重新调整正在处理的字符串的大小

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-09-10T02:12:14.577

要在像vector这样的容器中删除具有某些条件（等于某个值或其他条件，例如小于）的元素，它总是结合函数成员函数`erase`和`std::remove`或`std::remove_if`。

在向量中，该函数`erase`可以按位置删除元素，例如：

迭代器擦除（迭代器位置）；

迭代器擦除（首先迭代器，最后迭代器）；

**但是如果你想删除某些条件的元素，你可以将它与`std::remove`or结合起来`std::remove_if`。**

例如，您想擦除`6`以下向量中的所有元素：

```
std::vector<int> vec{6, 8, 10, 3, 4, 5, 6, 6, 6, 7, 8};
// std::remove move elements and return iterator for vector erase funtion
auto last = std::remove(vec.begin(), vec.end(), 6);
for(int a:vec)
    cout<<a<<" ";
cout<<endl;
// 8 10 3 4 5 7 8 6 6 7 8 

vec.erase(last, vec.end());
for(int a:vec)
    cout<<a<<" ";
cout<<endl;
// 8 10 3 4 5 7 8 
```

`std::remove`如下所示，它不会擦除任何元素，它只是移动元素并返回迭代器。

[![在此处输入图像描述](https://i.stack.imgur.com/VSJIi.png)](https://i.stack.imgur.com/VSJIi.png)

可能的实现：

```
template< class ForwardIt, class T >
ForwardIt remove(ForwardIt first, ForwardIt last, const T& value)
{
    first = std::find(first, last, value);
    if (first != last)
        for(ForwardIt i = first; ++i != last; )
            if (!(*i == value))
                *first++ = std::move(*i);
    return first;
} 
```

**结论：**

如果要删除具有某些条件的元素，则`vector::iterator erase (iterator first, iterator last);` 本质上是使用。

**首先获取范围开始：**

自动最后 = std::remove(vec.begin(), vec.end(), equal_condition_value);

**按范围擦除（始终使用 end()）**

vec.erase(最后，vec.end());

引用：

[https://en.cppreference.com/w/cpp/algorithm/remove](https://en.cppreference.com/w/cpp/algorithm/remove)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-28T18:54:51.843

我能想到的最简单的方法：

`erase()`是您可以对容器中的元素执行的操作。给定容器中的迭代器/索引，从容器中`erase( it )`删除迭代器引用的内容。

`remove()`是您可以对范围执行的操作，它会重新排列该范围，但不会从该范围中删除任何内容。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-29T03:22:52.637

> remove 不会“真正”删除任何东西，因为它不能。

为了“实际”从容器中移除元素，您需要访问容器 API。删除仅适用于迭代器，而与这些迭代器指向的容器无关。因此，即使 remove 想要“实际删除”，它也不能。

用以下未删除的元素删除覆盖“已删除”的元素，然后由调用者决定使用返回的新逻辑`end`而不是原始`end`.

`1`在您的情况下，从逻辑上删除`vector`a 但大小仍为 2 本身。擦除实际上从向量中删除了元素。[从矢量`new end`到`old end`]

主要思想`remove`是它不能改变元素的数量，它只是根据标准从一个范围内删除元素。

# file - 是否存在允许流式传输写入锁定的 UTF8 文件的 DCOM 公开对象？

> ID：799316
> 
> 赞同：0
> 
> 时间：2009-04-28T18:42:05.387
> 
> 标签：file, com, stream, dcom

[Scripting.FileSystemObject](http://msdn.microsoft.com/en-us/library/z9ty6h50.aspx "Scripting.FileSystemObject") TextStream 对象支持 Windows 样式的Unicode 和由系统代码页修改的“纯文本”，但似乎不支持 UTF8——但是，它实际上可以流式传输锁定以进行更新的文件，例如 IIS 日志文件。

[ADODB.Stream](http://msdn.microsoft.com/en-us/library/ms675032(VS.85).aspx "ADODB流")支持 UTF-8（或原始二进制文件），但不会“ [LoadFromFile](http://msdn.microsoft.com/en-us/library/ms677570(VS.85).aspx "加载自文件") ”已锁定更新的文件，尽管该文件可在记事本中打开。（导致错误：无法打开 ADODB.Stream 文件。错误代码为 0x800a0bba ）——尽管尝试以“读取”模式或“共享”模式打开流。似乎服务器端 COM 对象需要的锁定比我实际请求的要多。

还有其他选择吗？我通过 DCOM 远程调用这些，但是即使在主机系统本身上进行测试也会导致相同的行为。

理想情况下，将有一个组件充当流（即支持查找机制），可以流式传输原始字节（二进制）或可以处理纯文本、Unicode 和 UTF-8，并且可以读取打开写入的文件. 有人知道这样的野兽吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T06:52:33.400

我不确定这是您要找的东西，但是您可以构建自己的服务器端流媒体，看看[IPipeByte](http://msdn.microsoft.com/en-us/library/ms693750(VS.85).aspx)。它是一个自 win2k 以来就存在的接口，可让您轻松地在客户端和服务器之间传输字节。由于您将从文件中进行实际读取，因此权限问题将只是操作系统强加给您的问题。当然，文本格式根本不是问题。

有一篇关于使用管道的好文章，可以在[这里](http://msdn.microsoft.com/en-us/magazine/cc301563.aspx)找到。示例代码丢失，但可能在离线 MSDN 中找到。

# asp.net-mvc - OnValidate VB.Net 部分方法不会触发 NerdDinner 示例代码

> ID：799322
> 
> 赞同：0
> 
> 时间：2009-04-28T18:42:54.730
> 
> 标签：asp.net-mvc, vb.net

我遇到了[gfrizzle](https://stackoverflow.com/users/23935/gfrizzle)说他遇到过的问题，但后来[在这里](https://stackoverflow.com/questions/666678/implementing-partial-void-in-vb)说他解决了这个问题。我查看了帖子并实现了它所说的操作，但它仍然对我不起作用（如果 gfrizzle 看到这个，我想看看他的代码）

为了重申这个问题，我想创建与我的 L2S 模型生成的 DAL 代码分开的业务规则。根据 NerdDinner 示例（用 C# 编写），此代码需要位于下面的部分类中。

如果有人可以帮助让我知道我的控制器类代码中的部分类写在下面

```
<HandleError()> _
Public Class PreOrderController
  Inherits System.Web.Mvc.Controller

  Private db As New FOTAZDataContext  'with EF this would be FOTAZDBEntities, see the web.config

  ' GET: /PreOrder/Create
  Function Create() As ActionResult
    Dim registrationToCreate As New Registration()
    PopulateDropDownListBoxesForCreate()
    Return View()
  End Function

  ' POST: /PreOrder/Create  include:="MerchandiseID,Quantity"
  <AcceptVerbs(HttpVerbs.Post)> _
  Function Create(<Bind(Exclude:="ID")> ByVal preOrderToCreate As PreOrder) As ActionResult

    If ModelState.IsValid Then
      Try
        preOrderToCreate.RegistrationID = GetRegistrationID()
        db.PreOrders.InsertOnSubmit(preOrderToCreate)
        db.SubmitChanges()
        Return RedirectToAction("Index")
      Catch
        For Each issue In preOrderToCreate.GetRuleViolations()
          ModelState.AddModelError(issue.PropertyName, issue.ErrorMessage)
        Next
      End Try
    End If
    PopulateDropDownListBoxesForCreate()
    Return View("Create")

  End Function

  Sub PopulateDropDownListBoxesForCreate()
    Dim merchandise = db.Merchandises.ToList()
    ViewData("MerchandiseID") = New SelectList(merchandise, "ID", "Descr")
  End Sub

Imports System.Data.Linq
Partial Public Class PreOrder

  Public ReadOnly Property IsValid() As Boolean
    Get
      Return (GetRuleViolations().Count() = 0)
    End Get
  End Property

  Public Function GetRuleViolations() As IEnumerable(Of RuleViolation)
    Dim ret = New List(Of RuleViolation)()

    If Not IsNumeric(Quantity) Then
      ret.Add(New RuleViolation("Quantity", "Quantity is not numeric"))
    End If
    Return ret

  End Function

  'This isn't getting called.
  Private Sub OnValidate(ByVal action As ChangeAction)
    If Not IsValid Then
      Throw New ApplicationException("Rule violations prevent saving")
    End If
  End Sub
End Class 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:50:45.747

我想通了（或多或少）。我把两个参数的顺序倒过来了……

```
ret.Add(New RuleViolation("Quantity", "Quantity is not numeric")) 
```

应该

```
ret.Add(New RuleViolation("Quantity is not numeric", "Quantity")) 
```

我仍然没有填写我完全理解这一点。那好吧。

# linux - 我应该调用什么 API 在 linux 上设置用户密码？

> ID：799325
> 
> 赞同：3
> 
> 时间：2009-04-28T18:44:13.353
> 
> 标签：linux, passwords, passwd

我知道`passwd(1)`和`crypt(3)`。我正在寻找的是要调用的 C API，它将在 passwd/shadow 文件中设置用户的密码，而无需以编程方式遍历文件并覆盖相关用户的条目。应用程序以 root 身份运行。

这样的 API 存在吗？

编辑：我想我应该指定，密码正在不同系统之间同步，所以我们不能简单地调用 system("passwd") 并允许用户在 passwd 提示时输入他们想要的任何密码。我们需要知道密码，以便我们可以使用相同的密码以编程方式更新其他系统。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-28T19:53:46.710

这很可能会根据相关系统使用的机制而有所不同......

...这给我带来了另一个建议，使用现有工具让不同的系统针对公共存储对用户进行身份验证 - 例如 LDAP 或您站点上可用的任何目录或主系统。或者设置一个。最好不要NIS+ ^^

不要像他们所说的那样重新发明轮子。

您将从哪里获得明文密码？如果它在那里，为什么还要麻烦密码？（是的，我知道在这些事情上我是个混蛋，对不起 - 让反对票开始吧；）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T22:25:04.243

正如 8jean 上面评论的那样，看起来 /usr/sbin/chpasswd 可能是最简单的方法。否则，我会接受 noha 的评论，即使用 fgetpwent() 或 fgetspent() 之类的函数来处理影子文件——遍历用户列表并修改我需要更改的记录。谢谢大家！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T19:14:25.790

使用 /etc/passwd 和 /etc/shadow 存储密码？系统之间的 UID 是否同步？您可以简单地为特定用户复制/覆盖 /etc/shadow 文件中的行。

而“不要这样做”的答案是使用 NIS 服务器并且只更改一次密码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-28T19:44:26.547

也许 putpwent 调用是您正在寻找的。试试 man putpwent。在快速搜索中，我找到了一个包含一些示例的页面。它可能会有所帮助。

[http://linux.omnipotent.net/article.php?article_id=10935](http://linux.omnipotent.net/article.php?article_id=10935)

检查 getpwnam 查找而不是更改条目并使用 putpwent。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T18:58:54.410

也许你想要[PAM](http://www.kernel.org/pub/linux/libs/pam/)？不确定，但大多数发行版都使用它...

**补充：**它看起来像 Mac OS X`openssl`用来管理它的密码散列。在 linux 下可能会做类似的事情，但根据您的需要，您必须与操作系统使用的身份验证层兼容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T19:10:32.523

您可以查看 passwd 源代码，但我会先尝试一种更简单、更懒惰的方法：我只需 strace passwd 看看会发生什么。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-28T18:52:39.353

最好的办法是使用适当的参数执行 passwd 命令，让它担心文件处理、加密和文件锁定问题。在某种程度上，无论如何都必须“以编程方式遍历文件”。除非你真的对此有很大的性能问题，否则你最好依赖现有的代码和经验，而不是试图复制现有的代码。

# php - 为什么 Xdebug 会为包含的文件引发错误，而不是必需的

> ID：799326
> 
> 赞同：-1
> 
> 时间：2009-04-28T18:45:17.140
> 
> 标签：php, ubuntu, include, xdebug, ubuntu-9.04

我在 Ubuntu 9.04（桌面版）上运行 LAMP 服务器。我对 Ubuntu 很陌生，所以我通过 Synaptic 数据包管理器完成了大部分工作。然后我删除了 php5-common 并通过以下方式安装了 php5：`apt-get install php5`
我的错误报告设置为：`error_reporting = E_ALL & ~E_NOTICE`

我安装了 Xdebug 并在我的 php.ini 文件中插入了以下内容。

```
zend_extension=/usr/lib/php5/20060613/xdebug.so

[debug]
; Remote settings
xdebug.remote_autostart=off
xdebug.remote_enable=on
xdebug.remote_handler=dbgp
xdebug.remote_mode=req
xdebug.remote_host=localhost
xdebug.remote_port=9000

; General
xdebug.auto_trace=off
xdebug.collect_includes=on
xdebug.collect_params=off
xdebug.collect_return=on
xdebug.default_enable=on
xdebug.extended_info=1
xdebug.manual_url=http://www.php.net
xdebug.show_local_vars=0
xdebug.show_mem_delta=0
xdebug.max_nesting_level=100
;xdebug.idekey=

; Trace options
xdebug.trace_format=0
xdebug.trace_output_dir=/tmp
xdebug.trace_options=0
xdebug.trace_output_name=crc32

; Profiling
xdebug.profiler_append=0
xdebug.profiler_enable=0
xdebug.profiler_enable_trigger=0
xdebug.profiler_output_dir=/tmp
xdebug.profiler_output_name=crc32 
```

现在对于某个项目，我的页面中有以下代码行：

```
include_once(something.php); 
```

现在，something.php 不存在。因为它已包含在内且不是必需的，所以我希望不会看到任何错误，但 XDebug 会为我提供错误报告。有人知道如何提供帮助吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T08:59:09.273

呃，这不是 Xdebug 改变的东西。您也会收到使用纯 PHP 的警告。

德里克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T19:41:29.300

它应该抛出一个警告，而 require_once 抛出一个致命的。

您可以通过以下方式解决此问题：

```
@include_once('something.php'); 
```

但是，这是一种不好的做法。

另一种方法是显式检查文件是否存在，但除非您提取所有包含路径并检查文件是否存在于每个路径中，否则这将不起作用。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-01T22:37:38.820

我认为开箱即用的 xdebug 会比 php 向您显示更多错误，但这只是我迷信。

有时它也只会在满月时抛出错误。

# c# - 为什么 Visual Studio 会从 ThreadPool 工作项中跳过我的异常？

> ID：799327
> 
> 赞同：1
> 
> 时间：2009-04-28T18:45:26.780
> 
> 标签：c#, visual-studio-2008, debugging, exception, threadpool

我知道this other [post](https://stackoverflow.com/questions/753841/how-to-catch-exceptions-from-a-threadpool-queueuserworkitem)，但它似乎不适用于我的情况。

首先，这是我的环境：
Windows XP 64-bit SP3；带有 SP 的 Visual Studio 2008；.NET 3.5 SP1；WPF 应用程序。

我的问题是我似乎无法走到异常发生的地方。它只是继续运行而不是继续调试会话。

这是一些代码——我没有写所有的代码，所以请不要对命名发表评论:)

```
// start up the WPF application
// set the handler for the Checked event
ToggleButton channelButton1 = new ToggleButton();
channelButton1.Checked += (s, e) => 
     ThreadPool.QueueUserWorkItem(SetTcpChannel, 1); 
```

然后在那个`SetTcpChannel`方法中：

```
 try
    {
        int channel = (int)state;
        EnsureTcpSocket();
        // more logic to do stuff with channel 
        // that we don't care about for SO
        ...
    }
    catch (Exception e)
    {
        // just for illustration
        // this is where I expected the code to return
        ...
    } 
```

最后，在异常实际发生的地方（内部`EnsureTcpSocket`）：

```
 if (_tcp == null)
    {
        // this is not a valid ip/port since the 
        // target machine is not running (test condition)
        // but that's ok, I should get some exception 
        // and continue debugging...right?
        _tcp = new TcpClient(ip, port);
    } 
```

这是我一直在做的事情：

1.  `EnsureTcpSocket`我在里面的行 设置了一个断点 `SetTcpChannel`，
2.  F11（步入）`EnsureTcpSocket` 所以我可以看到`_tcp`这段代码
3.  尝试 F10 (step-over) `TcpClient`构造函数

在最后一步，应用程序从调试器中恢复并继续运行，我从未看到任何异常。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T18:50:06.647

你等了多久？根据参数的具体内容，`TcpClient`构造函数可能会等到超时后再抛出异常。（如果连接被拒绝，那就另当别论了。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T18:51:48.827

你在 catch 块中是否有断点，如果没有，我不明白为什么调试器会中断执行并停在那里？

或者，在 Visual Studio 中，您可以设置调试选项以中断 First Chance 异常，这是[一篇旧文章，描述了如何](http://blogs.msdn.com/davidklinems/archive/2005/07/18/440150.aspx).

# php - PHP忽略类中的__set方法

> ID：799332
> 
> 赞同：7
> 
> 时间：2009-04-28T18:46:56.420
> 
> 标签：php, oop

我正在构建一个具有许多输入验证的类，并且我决定将它们放在 __set 方法中（我不确定这是否是正确的形式，因为我的 OOP 经验有限）。这似乎工作正常，当从类外部传递无效值时会引发正确的错误。但是，如果在类中修改了变量，则 __set 方法似乎会被完全忽略。

任何见解将不胜感激

```
//RESULT:::::::::::::::::::::::::::::::
// PASS: Testing : hello
// PASS: Testing exception handling
// __SET: Setting b to 123
// PASS: Testing with valid value: 123
// FAIL: Testing exception handling World2

 <?php
class Test {
        public $a;
        private $b;

        function __set( $key, $val ) {

                switch( $key ) {
                        case 'b':
                                if( !is_numeric( $val ) ) throw new Exception("Variable $b must be numeric");
                                break;
                }

                echo ( "__SET: Setting {$key} to {$val}<br/>" );
                $this->$key = $val;
        }
        function __get( $key ) { return $this->$key; }
        function bMethod() {
                $this->b = "World2";
        }

}

$t = new Test();

//testing a
try {
        $t->a = "hello";
        echo "PASS: Testing $a: {$t->a}<br/>";
} catch( Exception $e)  {
        echo "FAIL: Testing $a";
}

//testing b
try {
        $t->b = "world";       
        echo "FAIL: Testing $b exception handling<br/>";
} catch( Exception $e ){
        echo "PASS: Testing $b exception handling<br/>";
}

//testing b with valid value
try  {
        $t->b = 123;
        echo "PASS: Testing $b with valid value: {$t->b}<br/>";
} catch( Exception $e) {
        echo "FAIL: Testing $b";
}

//bypassing exception handling with method
try {
        $t->bMethod("world");
        echo "FAIL: Testing $b exception handling {$t->b}<br/>";
} catch( Exception $e ) {
        echo "PASS: Testing $b exception handling<br/>";
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-28T18:49:45.210

阅读 __set 的定义：“将数据写入不可访问的成员时运行 __set()。” 无法访问是这里的关键。在类中，所有成员都可以访问并且 __set 被绕过。[重载](http://php.net/manual/language.oop5.overloading.php)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-28T18:57:38.483

[php文档](http://www.php.net/manual/en/language.oop5.overloading.php#language.oop5.overloading.members)中的文档说：

> __get() 用于从不可访问的成员中读取数据。

因此，您可以执行以下操作：

```
<?php
class Test {
    private $_params = array();

    function __set( $key, $val ) {
        ...
        $this->_params[$key] = $val;
    }

    function __get( $key ) {
        if (isset($this->_params[$key])) return $this->$key;
        throw Exception("Variable not set");
    }

    ...
} 
```

# python - 像 CGI PHP 一样配置 Apache 以使用 Python

> ID：799354
> 
> 赞同：0
> 
> 时间：2009-04-28T18:51:59.683
> 
> 标签：python, apache, cgi

我认为将 PHP 添加到 Apache 网络服务器的一种常见方法是像这样配置它：

```
ScriptAlias /php5.3 /usr/local/php5.3/bin
Action application/php5.3 /php5.3/php-cgi
AddType application/php5.3 .php 
```

现在我尝试为 Python 编写类似的配置：

```
ScriptAlias /python /usr/bin
Action application/python /python/python
AddType application/python .py 
```

我有一个看起来像这样的小测试脚本：

```
print "Content-Type: text/html\n\n"
print "Test" 
```

但似乎有些问题，因为 apache 错误日志显示以下内容：

```
Premature end of script headers: python 
```

所以我的第一个想法是我的 python 响应不正确。但是有 Content-Type 和两个换行符。此外，调用 with 的类似 PHP 脚本的输出也`php-cgi`给出了完全相同的输出。

此外，我还没有找到说明如何让 python 以这种方式工作的教程。所以也许这是不可能的，但我很好奇为什么会这样？还是我错过了什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-28T20:13:58.177

您可以使用*任何*类型的可执行文件作为 cgi。您的问题出在您的 apache 配置中，看起来您只是编造的。查看 apache 文档以获取更多详细信息，但您不需要 Action 和 AddType。

```
ScriptAlias /cgi-bin/ "/var/www/cgi-bin/" 
```

然后将以下内容放入您的 cgi-bin：

```
#!/usr/bin/python
# test.py
print "Content-Type: text/html\n\n"
print "Test" 
```

确保它是可执行的，并在 /cgi-bin/test.py 查看结果

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-28T19:11:46.423

“所以也许这是不可能的，但我很好奇为什么会这样？”

正确的。这是不可能的。这也不是故意的。

原因 1 - Python 不是 PHP。PHP——作为一个整体——期望成为一个CGI。Python 没有。

原因 2 - Python 本质上不是 CGI。这是一个（几乎）没有环境期望的口译员。

原因 3 - Python 从未被设计为 CGI。这就是为什么 Python 通常嵌入到小型包装器（mod_python、mod_wsgi、mod_fastcgi）中，这些包装器可以将 CGI 环境封装成一种对正在运行的 Python 程序更有意义的形式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-31T19:45:54.613

如果 .py 文件是在使用 CRLF 字符而不是 Unix LF 换行的 Windows 程序中编辑的，则可能会出现错误“脚本标题过早结束：”。

某些程序（例如 Dreamweaver）在首选项中有换行类型。记事本也使用 CRLF。

如果您的主机有一个文件编辑器，您可以通过退格当前换行符并通过该编辑器重新输入它们来进行测试，这会将任何 CRLF 更改为 LF。Notepad++ 只能使用 LF。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-16T14:09:37.453

例如，当您打开时，`http://localhost/test.py`您期望 Apache 会以某种方式启动进程`/usr/bin/python /var/www/test.py`（即具有单个命令行参数的解释器）。但这不是发生的情况，因为 Apache 调用 cgi 脚本时*没有*参数。相反，它通过 CGI 标准化的环境变量提供所有信息。

正如其他人指出的那样，使用 python 作为普通 cgi 效率低下，但如果出于教育原因你仍然想这样做，你可以试试这个。

假设默认的 Apache cgi-bin 设置处于活动状态，您可以使用以下内容创建一个名为`python`（或您选择的任何内容）的简单包装器：`/usr/lib/cgi-bin`

```
#!/usr/bin/python
import os
execfile(os.environ['PATH_TRANSLATED']) 
```

不要忘记使其可执行：`chmod a+x /usr/lib/cgi-bin/python`

把这些放在你的 Apache 配置中：

```
AddType application/python .py
Action application/python /cgi-bin/python 
```

现在，当您打开`http://localhost/test.py`Apache 时，将执行 /cgi-bin/python 不带参数但填充 CGI 环境变量。在这种情况下，我们使用`PATH_TRANSLATED`，因为它直接指向 webroot 中的文件。
调用`execfile`会在已打开的 python 进程中解释该脚本。

# wcf - WCF：Svcutil 生成无效的客户端代理、Apache AXIS Web 服务、重载操作

> ID：799365
> 
> 赞同：5
> 
> 时间：2009-04-28T18:55:25.977
> 
> 标签：wcf, wsdl, svcutil.exe

我正在使用用 Java 编写的第 3 方 Web 服务并使用 Apache Axis 1.3。该服务有许多重载操作。当 WCF Svcutil 生成代理时，它会通过在操作名称后附加一个数字来重命名重载操作。例如：

```
getDataResponse getData(getDataRequest request);

getDataResponse1 getData1(getDataRequest1 request); 
```

这本身不是问题，但是当 Svcutil 生成请求/响应消息时，它会忽略更改 MessageContracts 的 WrapperName 属性。

```
 [MessageContractAttribute(
        WrapperName = "getData", 
        WrapperNamespace = "http://namespace.com", 
        IsWrapped = true)]
    public partial class getDataRequest1 {  ..  } 
```

当客户端应用程序尝试打开代理时，会抛出以下异常：

> InvalidOperationException：操作 getData1 中的 RPC 消息 getDataRequest1 具有无效的正文名称 getData。它必须是 getData1

如果我更改 WrapperName = "getData1" 代理将打开，但是......

1.  我无法调用该操作，因为该服务无法识别“getData1”
2.  该服务有近 1100 次操作，其中近一半是重载

有没有办法生成和/或修改代理，以便所有操作都与 WCF 一起工作？

标记

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-02-16T00:54:15.630

对于它的价值（4年后），似乎通过`WSDL.exe`手动调用并传递`/protocol:SOAP`参数，可以避免这个问题。对于 Apache Axis 生成的服务，从 VS2012 开始，通过 UI 生成服务客户端似乎仍然会导致此问题。

示例用法：

```
c:\Program Files\Microsoft SDKs\Windows\v7.1\Bin\NETFX 4.0 Tools>wsdl /l:cs /protocol:SOAP http://rxnav.nlm.nih.gov/RxNormDBService.xml /out:c:\drop\rxnavapi.cs 
```

* * *

**编辑：** [sphinxxx](https://stackoverflow.com/users/1869660/sphinxxx)正确指出 SOAP 协议选项在 UI 中公开为“[添加 Web 引用](http://msdn.microsoft.com/en-us/library/bb628649.aspx)”，因此`wsdl.exe`不需要直接执行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-31T13:21:40.310

我能够找到的唯一解决方法是手动编辑生成的代码并删除所有我不需要的重载。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-31T15:29:18.070

我之前没有看到这个问题，因为你上面有一个“java”标签，我忽略了 Java 问题。您的问题*与*Java 无关，因此不应该有“java”标签。

svcutil 不会重命名重载操作。那是因为没有重载操作之类的东西。WSDL 没有两个具有相同名称但使用不同消息的操作的概念。

如果您查看 Axis 的 WSDL，我相信您会发现这些操作都附加了数字。

* * *

**更正：**在评论中，[Mark Good](https://stackoverflow.com/users/97276/mark-good)正确地指出 WSDL 1.1 确实允许重载。我碰巧认为它仅在基于 RPC 的服务的上下文中才有意义，其中消息名称可用于区分一个重载和另一个重载。

但是，他可能不知道[WS-I Basic Profile 1.1](http://www.ws-i.org/Profiles/BasicProfile-1.1.html)禁止运算符重载：

*4.5.3 特殊操作*

`wsdl:portType`配置文件不允许在 a 中重载操作名称。

***描述**`wsdl:portType`中的***R2304*** A的名称属性必须具有具有不同值的操作。*

 ***请注意，此要求仅适用`wsdl:operations`于给定的`wsdl:portType`. A的名称`wsdl:portType`可能`wsdl:operations`与 other 中的名称相同`wsdl:portTypes`。

* * *

如果阅读更多 WS-I BP1.1，就会明白为什么 WSDL 1.1 中的所有内容都不是一个好主意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T19:09:42.510

编写一个脚本来修复此文本并将其设置为代理库的构建后脚本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-05T16:31:34.547

我发现当使用“老式”时`AddServiceReference`，它会正确生成具有重载的类，即使在 VS2012 中也是如此。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-05-06T11:32:38.790

这里没有一个解决方案对我有用。

在针对 .NET2 的 vs2010 项目中生成引用，然后在针对 .NET4 的 vs2012 或 vs2013 中打开解决方案，确实可以。

# c# - c# 类型来处理相对和绝对 URI 和本地文件路径

> ID：799367
> 
> 赞同：19
> 
> 时间：2009-04-28T18:55:55.510
> 
> 标签：c#, path, types, uri

我有一个用例，我将同时处理本地文件路径（例如`c:\foo\bar.txt`）和 URI（例如`http://somehost.com/fiz/baz`）。我还将处理相对路径和绝对路径，因此我需要类似[`Path.Combine`](http://msdn.microsoft.com/en-us/library/system.io.path.combine(VS.71).aspx)和朋友的功能。

*我应该使用现有的 C# 类型吗？*[Uri 类型](http://msdn.microsoft.com/en-us/library/system.uri(VS.71).aspx)可能有效，但乍一看，它似乎只是 URI。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-28T19:11:36.063

使用 Uri 类，它似乎正在工作。它将任何文件路径转换为 ​​Uri 中的 `file:///..." 语法。它按预期处理任何 URI，并且它具有处理相对 URI 的能力。这取决于您尝试使用的其他内容那条路。

（更新以显示相对 Uri 的使用）：

```
string fileName = @"c:\temp\myfile.bmp";
string relativeFile = @".\woohoo\temp.bmp";
string addressName = @"http://www.google.com/blahblah.html";

Uri uriFile = new Uri(fileName);
Uri uriRelative = new Uri(uriFile, relativeFile);
Uri uriAddress = new Uri(addressName);

Console.WriteLine(uriFile.ToString());
Console.WriteLine(uriRelative.ToString());
Console.WriteLine(uriAddress.ToString()); 
```

给我这个输出：

```
file:///c:/temp/myfile.bmp  
file:///c:/temp/woohoo/temp.bmp  
http://www.google.com/blahblah.html 
```

# c# - 什么时候使用泛型与继承比较合适？

> ID：799369
> 
> 赞同：15
> 
> 时间：2009-04-28T18:56:02.903
> 
> 标签：c#, .net, vb.net, generics, inheritance

使用泛型而不是继承的情况及其相关的好处是什么，反之亦然，它们应该如何最好地结合？

谢谢你们的回答。

我将尽力说明这个问题的动机：我有一个如下所示的课程：

```
class InformationReturn<T> where T : Info
{
    InformationReturn(Employee employee, List<T>) { ... }
} 
```

现在假设我有一个带有 InformationReturn 参数的存储库，它必须根据 Info 对象 T 的类型在数据库中存储不同的字段。为 T 类型创建不同的存储库是否更好？一个使用反射来确定类型的存储库；还是有更好的方法使用继承功能而不是泛型？

**注意**：其他客户端代码也必须根据 T 的类型进行不同的操作。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-28T19:01:30.533

当您只希望将相同的功能应用于各种类型（添加、删除、计数）并且将以**相同的方式实现**时，您应该使用泛型。继承是当您需要相同的功能（GetResponse）但希望它以**不同的方式实现**时。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-28T18:58:24.083

泛型和继承是两个不同的东西。继承是 OOP 概念，泛型是 CLR 功能，允许您在编译时为公开它们的类型指定类型参数。

继承和泛型实际上可以很好地协同工作。

**遗产：**

继承允许我创建一种类型：

```
class Pen { } 
```

然后创建另一种扩展类型`Pen`：

```
class FountainPen : Pen { } 
```

这很有帮助，因为我可以重用基类的所有状态和行为，并在`FountainPen`. 继承使我能够快速创建现有类型的更具体版本。

**泛型：**

泛型是一个 CLR 特性，它让我可以创建这样的类型：

```
class Foo<T> 
{
    public T Bar { get; set; }
} 
```

现在，当我使用时，我可以通过提供泛型类型参数`Foo<T>`来指定类型：`T`

```
Foo<int> foo = new Foo<int>(); 
```

现在，由于我已经为我刚刚创建的对象指定了 that ，所以类型也将是`T`，因为它被声明为 type 。`int``Foo.Bar``int``T`

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-28T19:01:56.837

使用泛型来指定一种算法或类型的行为，这些行为可以用某种“未知类型”来表达，同时保持一个用该未知类型强类型化的 API。未知类型称为*类型参数*，在代码中表示如下：

```
public class List<T>
{
    public void Add(T item)
} 
```

（等） - 这`T`是类型参数。通用方法类似：

```
public void Foo<T>(T item) 
```

*调用*代码指定它想要使用的*类型参数，例如*

```
List<string> list = new List<string>();
list.Add("hi"); 
```

使用继承来专门化一个类型的行为。

我真的想不出很多地方可以相互替代...

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-28T19:00:21.130

他们是完全不同的想法。泛型允许您以一般方式声明常见的“特定”功能（冒着听起来矛盾的风险）。除了内部保存的数据类型之外，A 的`List<int>`功能与 a 没有任何不同。`List<string>`

虽然继承可以用来做同样的事情，但我可以创建一个`List`类，然后创建一个继承自它`IntList`的类。`StringList`我可以轻松地使这两个类的功能完全不同，或者让一个提供的功能在另一个中不可用。

**编辑**

在查看对问题的编辑后，答案是“视情况而定”。您可以为双方提出论据——事实上，LINQ to SQL 和实体框架都是使用泛型的反射检查、强类型实体类和其他存储库类的组合。您当然可以采用您正在研究的方法，只要知道，一般来说，可以通过反射或其他方式解决的问题在通过“其他方式”解决时可能会更快。它归结为您希望在性能、可维护性、可读性和可靠性之间做出多大的权衡。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-02T01:29:43.837

当您想创建一个可以应用于许多未知类样式的“模板”时，请使用泛型。例如。收藏夹？？？是仿制药的良好候选者。继承适用于当您有一个基本概念时，孩子“是”该概念的延伸。

我的一般规则

*   如果您开始在代码中将属性定义为 Object 并进行大量类型转换，那么可能是泛型的时候了。
*   如果您想针对“更高概念”以及派生类进行编程，那么它的继承。
*   如果您的课程要包装或处理一个一致的课程，那么它的泛型。
*   如果您依赖于未知的“尚未定义”类的细节，那么使用泛型可能会更好。
*   如果您的派生类是“是”，那么它通常是继承
*   如果您的超类“使用一些 x”，那么它的泛型。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-28T18:59:34.813

继承更多的是关于“is-a”（青蛙是一种动物），其中泛型是关于创建作用于类型数据（T 的列表、T 的处理器等）的容器。它们**并不相互排斥**。

如果你愿意，你可以拥有这个：

```
public class Base<T>
{

}

public class Derived : Base<Foo>
{

} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-09-10T14:04:07.400

继承和参数化类型都不能在运行时改变

继承允许您为操作提供默认实现并让子类覆盖它们。

参数化类型允许您更改类可以使用的类型。

但是哪种方法最好取决于您的设计和实现限制

> 可重用的面向对象软件的设计模式元素

# iphone - 我应该 -drain 还是 -release iPhone OS 中的自动释放池？

> ID：799370
> 
> 赞同：2
> 
> 时间：2009-04-28T18:56:31.200
> 
> 标签：iphone, memory-management, uikit, autorelease

医生说：

> 在垃圾收集环境中，如有必要，向池发送一条耗尽消息会触发垃圾收集；但是，发布是无操作的。在引用计数环境中，drain 与 release 具有相同的效果。因此，通常应该使用排水而不是释放。

如果我做对了，他们说我应该总是使用-drain，不管周围有垃圾收集还是引用计数。在 iPhone 上没有 GC，所以无论如何我发送 -drain？

不幸的是，该文档只谈到了 Cocoa，而不是 Cocoa Touch 或 iPhone。所以我不确定这是否同样适用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-28T19:51:57.650

没关系，两者的效果是一样的。Apple 建议使用 drain 以防您移动到垃圾收集环境（如果 iPhone SDK 的未来版本支持它，或者如果您将其复制到 Mac OS X 项目），这就是我要使用的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T19:57:33.457

只需发送 -drain; 如果在以后的某个日期 iPhone 有 GC，您将能够在不修改的情况下编译它。养成一个好习惯。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-04-29T15:07:40.057

在正常开发中，不需要在自动释放池上调用 drain - 当您的方法返回时，它无论如何都会这样做。

例外情况是，如果您在循环中创建许多自动释放的对象，并且您有机会提前释放其中一些。

如果您调用 drain 作为 release 的替代品，它不会释放尚未自动释放的对象。

# c - 指向多维数组的指针数组

> ID：799373
> 
> 赞同：4
> 
> 时间：2009-04-28T18:56:48.643
> 
> 标签：c, arrays, pointers

我有一些二维数组，例如：

```
int shape1[3][5] =  {1,0,0,
             1,0,0,
             1,0,0,
             1,0,0,
             1,0,0};
int shape2[3][5] =  {0,0,0,
             0,0,0,
             0,1,1,
             1,1,0,
             0,1,0}; 
```

等等。

我怎样才能制作一个指向这些指针的数组？

我尝试了以下方法，但它们不起作用（*警告：从不兼容的指针类型初始化*）：

```
int *shapes[]=  {&shape1,&shape2};

int *shapes[]=  {shape1,shape2};

int **shapes[]= {&shape1,shape2}; 
```

有什么帮助吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-28T19:17:07.533

我相信我刚刚验证了我写的内容是正确的。以下按预期工作：

```
#include <stdio.h>

int main(int argc, char **argv) {

int shape1[5][3] =  {1,0,0,
                 1,0,0,
                 1,0,0,
                 1,0,0,
                 1,0,0};

int shape2[5][3] =  {0,0,0,
                 0,0,0,
                 0,1,1,
                 1,1,0,
                 0,1,0};

typedef int (*shapes_p)[3];
shapes_p shapes[2] = { shape1, shape2 };

shapes[0][1][0] = 5;
shapes[1][1][0] = 5;

printf("shape1[1][0] == %d\n", shape1[1][0]);
printf("shape2[1][0] == %d\n", shape2[1][0]);

} 
```

要记住的是`shape1`and的类型`shape2`实际上是：

`int *shape1[5];`

您在内存中拥有的是 3 个相邻的数组，每个数组有 5 个整数。但实际类型是指向 5 个整数数组的指针。当你写：

`shape1[1][2] = 1;`

你告诉编译器索引到 int[5] 的第二个数组，然后访问该数组的第三个元素。编译器实际上所做的是对指向的基础类型的指针运算，在本例中为 int[5]。您可以使用以下代码执行相同的操作：

```
int *p = shapes1[0];
p+7 = 1;  // same as shape1[1][2] = 1; 
```

因此，如果您想要一个指向 int *[5] 的指针数组，那么您可以：

```
typedef int (*shapes_p)[5];
shapes_p shapes[2]; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T19:05:34.660

**更新**了固定类型。感谢`j_radom_hacker`您引起我的注意！

**[编辑：实际上这里的类型不正确——请参阅[Robert S. Barnes 的回答](https://stackoverflow.com/questions/799373/array-of-pointers-to-multidimensional-arrays/799453#799453)以了解要使用的正确类型。]**

弄清楚类型`shape1`和`shape2`首先：

```
typedef int (*shape_array_t)[5]; 
```

现在使用这个：

```
shape_array_t sat[] = { shape1, shape2 }; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-28T19:16:08.267

首先，第一个数组绑定是指最外层的数组维度，因此您可能应该声明`shape1`为：

```
int shape1[5][3] =  {1,0,0,
                     1,0,0,
                     1,0,0,
                     1,0,0,
                     1,0,0}; 
```

同样对于`shape2`.

**[编辑：我已经改变了`shapes`下面的类型以对应[罗伯特巴恩斯的回答](https://stackoverflow.com/questions/799373/array-of-pointers-to-multidimensional-arrays/799453#799453)——我们不希望最外层的下标包含在这种类型中！]**

您需要的看起来有点奇怪的类型名是：

```
int (*shapes[])[3] = { shape1, shape2 }; 
```

这允许使用第 4 行第 1 列的元素`shape2`来寻址

```
shapes[1][3][0] 
```

子表达式及其 C 类型的细分：

```
shapes            // has type "int (*x[2])[3]" (decays to "(**x)[3]")
shapes[1]         // has type "int (*x)[3]"
shapes[1][3]      // has type "int x[3]" (decays to "int *x")
shapes[1][3][0]   // has type "int x" 
```

（请注意，`x`上面的类型中包含了一个 dummy 以使它们更清晰——实际上这个标识符不是类型的一部分。）

解码 C/C++ 类型的经验法则是“从变量名开始，尽可能阅读正确，遇到右括号时向左阅读”。所以解码后的类型名`shapes`是：

> 指向 3 个整数数组的指针数组。

一般来说，将`typedef`s 用于这些复杂的类型要好得多，正如[dirkgently 建议](https://stackoverflow.com/questions/799373/array-of-pointers-to-multidimensional-arrays/799410#799410)的那样。

# c# - VS 2008 中的 Web 部署项目工具

> ID：799374
> 
> 赞同：2
> 
> 时间：2009-04-28T18:57:08.877
> 
> 标签：c#, .net, asp.net, assemblies

当我们安装 Web 部署项目工具时，我们还可以选择在 VS 2008 中使用它。通过选择属性页，我们会看到几个用于配置编译选项的选项。弹出的属性页对话框之一被命名为输出程序集。它为我们提供了以下选项：

*** 将所有输出合并到单个程序集**

我假设这个选项不编译标签文件？！

*** 将所有页面和控制输出合并到一个程序集中**

现在这个选项与将*所有输出合并到单个程序集*有什么不同？起初我认为这个选项也预编译标记文件，但是为什么输出还包含 aspx 文件，如果它们已经预编译？！

*** 为每个页面创建一个单独的程序集并控制输出**

我认为这个选项也编译了 aspx 页面，但是如果它们已经预编译，为什么输出还包含 aspx 文件？！

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T19:01:14.950

这是Scott Gu 的博客中关于**[Web 部署项目](http://weblogs.asp.net/scottgu/archive/2005/11/06/429723.aspx)**的非常好的教程。它对您描述的选项以及更多内容进行了很好的解释。例如：（ [来源：][[scottgu.com](http://www.scottgu.com/BlogPosts/deployment/step5.png)][）] 默认选项是将整个网站合并到一个程序集中，您可以随意命名。这会将所有页面/控件编译、app_code 和 Web 服务的输出合并到一个程序集中（留下一个文件进行部署）。[![替代文字](https://i.stack.imgur.com/jdTvw.png)](https://i.stack.imgur.com/jdTvw.png)

您还可以选择其他选项来更精细地控制装配生成。例如，上面的第二个选项允许您将网站中的每个文件夹编译为单独的命名程序集（例如：MyCompany.MyWebApp.Folder1、MyCompany.MyWebApp.Folder2）。这对于修补大型应用程序很有用，您希望对站点的一部分进行战术更新。

如果您的 app_code 目录中有一个 AssemblyInfo.cs/.vb 类，则部署项目将使用它包含的元数据来对生成的程序集进行版本控制。或者，您也可以在 IDE 中专门设置版本信息。这反过来将其保存为项目文件中的 MSBuild 变量。您可以选择使用自定义 MSbuild 任务在构建时动态设置此变量（例如：使用我们在 Microsoft 所做的策略，其中内部版本号基于当前日期）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T19:07:03.080

这只是带有不同开关的 aspnet_merge 工具的前端，[MSDN 文档解释了这些选项及其作用](http://msdn.microsoft.com/en-us/library/bb397866.aspx)。

# .net - SQLite 等效于 ISNULL()、NVL()、IFNULL() 或 COALESCE()

> ID：799375
> 
> 赞同：99
> 
> 时间：2009-04-28T18:57:20.763
> 
> 标签：.net, sqlite, dbnull

我想避免在我的代码中进行许多类似以下的检查：

```
myObj.someStringField = rdr.IsDBNull(someOrdinal) 
                            ? string.Empty 
                            : rdr.GetString(someOrdinal); 
```

我想我可以通过执行以下操作让我的查询处理空值：

```
SELECT myField1, [isnull](myField1, '') 
FROM myTable1
WHERE myField1 = someCondition 
```

虽然我正在使用 SQLite，但它似乎无法识别该`isnull`功能。我还尝试了一些在其他数据库（和）中识别的等效数据库`NVL()`，但 SQLite 似乎无法识别它们中的任何一个。`IFNULL()``COALESCE()`

有没有人有任何建议或知道更好的方法来做到这一点。不幸的是，数据库没有所有字段的默认值。另外，在某些情况下我需要使用一些`LEFT JOIN`子句，其中一些返回的字段将为空，因为`LEFT JOIN`表中的匹配记录将不存在。

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2009-04-28T19:03:55.630

**`IFNULL`**，见这里：[http ://www.sqlite.org/lang_corefunc.html#ifnull](http://www.sqlite.org/lang_corefunc.html#ifnull)

函数周围没有括号

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2013-06-24T11:50:57.127

尝试这个

```
ifnull(X,Y) 
```

例如

```
select ifnull(InfoDetail,'') InfoDetail; -- this will replace null with ''
select ifnull(NULL,'THIS IS NULL');-- More clearly.... 
```

该`ifnull()`函数返回其第一个非 NULL 参数的副本，如果两个参数均为 NULL，则返回 NULL。`Ifnull()`必须恰好有 2 个参数。该`ifnull()`函数等效于`coalesce()`带有两个参数。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2010-12-19T12:45:28.140

如果没有`ISNULL()`方法，你可以使用这个表达式来代替：

```
CASE WHEN fieldname IS NULL THEN 0 ELSE fieldname END 
```

这与`ISNULL(fieldname, 0)`.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2018-10-11T20:56:37.947

**对于 NVL() 和 ISNULL() 的等效项，请使用：**

`IFNULL(column, altValue)`

`column`：您正在评估的列。

`altValue`: 如果 'column' 为空，您要返回的值。

**例子：**

`SELECT IFNULL(middle_name, 'N/A') FROM person;`

*注意：COALESCE() 函数的工作方式与其他数据库相同。

**资料来源：**

*   [COALESCE() 函数](https://www.w3schools.com/sql/func_sqlserver_coalesce.asp)(w3schools)
*   [SQLite 对 SQL 的理解](https://www.sqlite.org/lang_corefunc.html)（SQLite 网站）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-07-06T07:24:14.200

在 WHERE 子句中使用`IS NULL`or`IS NOT NULL`代替 ISNULL() 方法：

```
SELECT myField1
FROM myTable1
WHERE myField1 IS NOT NULL 
```

* * *

## 回答 #6

> 赞同：-5
> 
> 时间：2015-04-18T04:38:40.467

您可以轻松定义此类函数并使用它：

```
ifnull <- function(x,y) {
  if(is.na(x)==TRUE) 
    return (y)
  else 
    return (x);
} 
```

或相同的缩小版本：

```
ifnull <- function(x,y) {if(is.na(x)==TRUE) return (y) else return (x);} 
```

# ruby-on-rails - Ruby 守护进程挂在 Rails 负载上

> ID：799387
> 
> 赞同：0
> 
> 时间：2009-04-28T19:00:14.780
> 
> 标签：ruby-on-rails, ruby, daemon, workling

我在让工作守护程序正常工作时遇到问题。当我运行时：

```
ruby script/workling_client run 
```

守护进程开始加载rails，但无限期地挂起。当我终止进程时，堆栈跟踪总是相同的：

```
/Library/Ruby/Gems/1.8/gems/activesupport-2.1.2/lib/active_support/core_ext/load_error.rb:32:in `new': Interrupt
from /Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
from /Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
from /Library/Ruby/Gems/1.8/gems/activesupport-2.1.2/lib/active_support/dependencies.rb:510:in `require'
from /Library/Ruby/Gems/1.8/gems/activesupport-2.1.2/lib/active_support/dependencies.rb:355:in `new_constants_in'
from /Library/Ruby/Gems/1.8/gems/activesupport-2.1.2/lib/active_support/dependencies.rb:510:in `require'
from /Library/Ruby/Gems/1.8/gems/httpclient-2.1.2/lib/httpclient.rb:68
from /Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
from /Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
 ... 81 levels...
from /Library/Ruby/Gems/1.8/gems/daemons-1.0.10/lib/daemons/cmdline.rb:105:in `call'
from /Library/Ruby/Gems/1.8/gems/daemons-1.0.10/lib/daemons/cmdline.rb:105:in `catch_exceptions'
from /Library/Ruby/Gems/1.8/gems/daemons-1.0.10/lib/daemons.rb:138:in `run'
from script/workling_client:18 
```

如果我在没有守护程序库的情况下运行脚本，它会按预期工作。事实上，我在使用守护进程 gem 加载任何需要我的 rails 环境的东西时遇到了麻烦。有任何想法吗？

更新： workling_client 将 worklings listen.rb 作为守护进程加载。我没有在listen.rb中加载rails，而是对其进行了更改，以便将其加载到workling_client中，并且该过程可以顺利进行。因此，我无法在守护脚本中加载 rails 是有原因的 :-(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-02-09T17:31:41.523

您可以发布启动守护程序脚本的代码吗？我知道可以在守护程序脚本中加载 rails，因为我们是为 delay_jobs 脚本执行的。

脚本的初始部分执行以下操作：

```
require File.expand_path(File.join(File.dirname(__FILE__), '..', 'config',
      'environment')) 
```

调整您的 rails 项目中的 environment.rb 文件。然后，该过程继续进行自己的守护进程：

```
Worker::Command.new(ARGV, :workers => worker_config).daemonize 
```

我们的脚本在执行 daemonize 步骤之前加载 rails。如果这不起作用，请包括您的脚本如何加载导轨。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-30T02:41:38.820

尝试在没有监视器的情况下开始工作：

```
options = {
  :app_name   => "workling",
  :ARGV       => ARGV,
  :dir_mode   => :normal,
  :dir        => File.join(File.dirname(__FILE__), '..', 'log'),
  :log_output => true,
  :multiple   => false,
  :backtrace  => true,
  :monitor    => false
} 
```

# msbuild - MSBuild：Items + Batching + CreateItem + Transforms 问题

> ID：799389
> 
> 赞同：2
> 
> 时间：2009-04-28T19:00:28.493
> 
> 标签：msbuild, transform, batching

我有一个 msbuild 项目，这让我想知道为什么结果会是这样。并不是说它会引起问题或任何类似的事情，但我想尝试更好地理解它。

```
<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" DefaultTargets="TestTarget1;TestTarget2" ToolsVersion="3.5">

  <ItemGroup>
    <PathDir Include="C:\RootDir\UniqueDir1"/>
    <PathDir Include="C:\RootDir\UniqueDir2" />
  </ItemGroup>

  <Target Name="TestTarget1" Outputs="%(PathDir.Identity)">
    <PropertyGroup>
      <RootPath>%(PathDir.Identity)</RootPath>
    </PropertyGroup>

    <ItemGroup>
      <SubDirectory Include="Common1"/>
      <SubDirectory Include="Common2"/>
    </ItemGroup>

    <CreateItem Include="@(SubDirectory->'$(RootPath)\%(Identity)')">
      <Output TaskParameter="Include" ItemName="FullPath"/>
    </CreateItem>

    <Message Text="@(FullPath)"/>
  </Target>

  <Target Name="TestTarget2">
    <Message Text="@(FullPath)"/>
  </Target>

</Project> 
```

所以我有两个唯一的主要路径，并且在每个路径中我都有两个在每个唯一路径中具有相同名称的目录。在 target1 中，我对 PathDir 中项目的标识进行批处理，然后对包含在唯一目录中找到的公共文件夹名称的项目 SubDirectory 执行转换，以创建一个包含完整路径的新项目。所以无论如何，在那之后，目标的输出如下：

目标1：

```
 C:\RootDir\UniqueDir1\Common1;C:\RootDir\UniqueDir1\Common2
  C:\RootDir\UniqueDir2\Common1;C:\RootDir\UniqueDir2\Common2 
```

目标 2：

```
 C:\RootDir\UniqueDir1\Common1;C:\RootDir\UniqueDir1\Common2;C:\RootDir\UniqueDir2\Common1;C:\RootDir\UniqueDir2\Common2 
```

所以我猜我的问题是......为什么 target1 只显示包含它正在批处理的目录的目录？我知道这可能与批处理有关，但这就是我所知道的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-10T04:28:47.777

当一个目标被批处理时，它的执行独立于同一批处理目标的其他执行。因此，在第一次执行中，您将 FullPath 项填充到内容中

```
C:\RootDir\UniqueDir1\Common1;C:\RootDir\UniqueDir1\Common2 
```

然后在第二次执行目标时，您将 FullPath 的值填充为

```
C:\RootDir\UniqueDir2\Common1;C:\RootDir\UniqueDir2\Common2 
```

由于项目对同一个批处理目标不可见，因此第二遍不会“看到”该 FullPath 项目。但是当 TestTarget1 完成时，FullPath 的值被组合成一个值，即。

```
C:\RootDir\UniqueDir1\Common1;C:\RootDir\UniqueDir1\Common2;C:\RootDir\UniqueDir2\Common1;C:\RootDir\UniqueDir2\Common2 
```

这样就清楚了吗？批处理有时会让人感到困惑。

以下是一些关于批处理的链接：

*   [MSBuild 批处理第 1 部分](http://www.sedodream.com/PermaLink,guid,5f1e0445-ce3d-4052-ba80-42fd19512d42.aspx)
*   [MSBuild 批处理第 2 部分](http://www.sedodream.com/PermaLink,guid,b721bc22-c375-4e1e-bcc9-512dd64096bb.aspx)
*   [MSBuild 批处理第 3 部分](http://www.sedodream.com/PermaLink,guid,cab57d7f-9d6e-4358-8491-dc033fb3bacc.aspx)
*   [MSBuild RE：在团队构建中强制构建代理](http://www.sedodream.com/PermaLink,guid,096a2e3f-fcff-4715-8d00-73d8f2491a13.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T08:51:36.670

难道不是

```
<PropertyGroup>
  <RootPath>%(PathDir.Identity)</RootPath>
</PropertyGroup> 
```

再加上

```
<CreateItem Include="@(SubDirectory->'$(RootPath)\%(Identity)')"> 
```

这导致 2 x 2 而不是 1x4

# silverlight - Silverlight 组合框显示的项目数刷新

> ID：799403
> 
> 赞同：1
> 
> 时间：2009-04-28T19:03:20.937
> 
> 标签：silverlight, combobox, silverlight-2.0

我在 SL 页面上有两个组合框。当 Combo 1 更​​新时，会调用服务并填充 Combo 2。

第一次调用时，返回 3 个结果。当组合框展开时，您可以看到所有 3 个选项。

在第二次调用时，返回 4 个结果。当组合框展开时，您可以看到 3 个选项，带有一个垂直滚动条。

如果我重新加载并反向执行这些步骤，我会在第一次调用时得到 4 行，在第二次调用时得到 3 行 + 一个空白行。（不，空白不是记录。不能选择。）

似乎下拉列表大小保持了第一个生成的高度。

如何刷新每次服务调用后显示的组合框最大项目？

谢谢！

**编辑#1**

代码遵循 MV-VM 模式。当页面加载时，`Group1`填充第一个组合框，并且没有选择任何内容。当用户进行选择时，该选择被绑定到 Group1Selection。

```
<ComboBox ItemsSource="{Binding Path=Group1}" SelectedItem="{Binding Path=Group1Selection}" />
<ComboBox ItemsSource="{Binding Path=Group2}" SelectedItem="{Binding Path=Group2Selection}" /> 
```

在视图模型中，在`Group1Selection`属性的 set 访问器中，我有类似的东西

```
set
{
    if (group1Selection != value)
    {
        group1Selection = value;
        PopulateGroup2();
        OnPropertyChanged("Group1Selection");
    }
} 
```

PopulateGroup2 在哪里执行我的服务调用异步，获取数据，并将该数据放入`Group2`.

在“正常”条件下，这不是问题，因为大多数选项都有数十种可能的选择。但是，有几个`Group1`选项只有 3 或 4 个子选项。如果首先选择其中一个，则组合框的高度，对于该应用程序实例的其余部分，分别设置为 3 或 4，而不是最多显示 8 个项目。

遵循 MV-VM 模式，代码隐藏中没有代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-01T17:04:26.093

这是 Silverlight 2 中 ComboBox 中的一个已知错误。我认为它已在 SL 3 中修复。

您可以通过执行以下操作来解决此问题：

1.  从组合框继承

    公共类 MyComboBox : 组合框

2.  在 OnApplyTemplate() 方法中获取对 ComboBox 的“Popup”部分的引用

    ```
     Popup thePopup = GetTemplateChild("Popup") as Popup;
        FrameworkElement thePopupContent = thePopup.Child as FrameworkElement; 
    ```

3.  覆盖 OnItemsChanged 方法

4.  在重写的 OnItemsChagned 方法中，使用 ClearValue(DP) 方法重置 Popup 上的 Height 和 Width 依赖项属性。

    ```
     thePopupContent.ClearValue(FrameworkElement.WidthProperty);
            thePopupContent.ClearValue(FrameworkElement.HeightProperty); 
    ```

如果您也担心这些，您可以清除 Max 和 Min Height & Width 属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T15:18:50.167

那是一个完美的解决方案。谢谢你。

对于那些感兴趣的人来说，这个类看起来像这样：

```
using System.Windows.Controls.Primitives; 

public class WorkAroundComboBox: ComboBox
{
    FrameworkElement thePopupContent;

    public override void OnApplyTemplate()
    {
        Popup thePopup = GetTemplateChild("Popup") as Popup;
        thePopupContent = thePopup.Child as FrameworkElement;
        base.OnApplyTemplate();
    }

    protected override void OnItemsChanged(System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
    {
        thePopupContent.ClearValue(FrameworkElement.WidthProperty);
        thePopupContent.ClearValue(FrameworkElement.HeightProperty);
        base.OnItemsChanged(e);
    }
} 
```

}

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T11:09:20.060

我认为问题在于 Silverlight 没有完全意识到 ComboBox 2 背后的数据已经改变。也许尝试添加`OnPropertyChanged("Group2")`到集合中`Group1`- 这应该有助于 Silverlight 意识到它需要更新 ComboBox 2 的绑定。

调用 也可能会有所帮助`OnPropertyChanged`，`Group2Selection`因为之前的值不再有效。

# jquery - AJAX 和 MVC (C#)

> ID：799404
> 
> 赞同：0
> 
> 时间：2009-04-28T19:03:26.643
> 
> 标签：jquery, asp.net-mvc, ajax

我从未使用过 AJAX，坦率地说，我也不太精通 JS。

我有一个页面（[产品浏览器](http://staging1.roomsalive.com/Catalog/Flooring/Hardwood "产品浏览器")），其中包含以下细分：

1.  Navigation (First, Prev, 1, 2, 3 Next, Last) - full post back
2.  每页项目下拉列表 - 我想 AJAX 这个
3.  左栏 - 过滤器 - 我想 AJAX 这个
4.  产品展示区——根据上述1、2、3展示产品

我从第 2 项开始，并试图弄清楚如何根据下拉菜单的 OnChange 事件更改第 4 项。我不知道在哪里。或如何开始。应该是AJAX吗？查询？两者的结合？请记住 - 它位于基于 MVC 的应用程序中。

TIA

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T21:10:09.367

您的问题的答案肯定是“是”。

我现在有一个在我面前，所以我会试着把它抽象出来。

首先，创建一个返回 JsonResult（而不是 ActionResult）的控制器操作。除了它的返回类型之外，它就像任何其他操作一样，因此您可以发送参数等。唯一真正不同的是您将返回一个 JsonResult() 对象，设置它的 Data 属性和您设置的任何其他属性可能需要。我的看起来像这样（非常伪代码......）：

```
public JsonResult GetList(int parentId)
{
  var results = dataRepository.GetById(parentId);

  return new JsonResult()
  {
    Data = results.ToArray();
  };
} 
```

现在，在您看来，创建一个看起来像这样的脚本。请注意，这是 jQuery 语法，因此如果您不熟悉它，它可能看起来有点不寻常。

```
<script language="javascript" type="text/javascript">
// When the document is ready, start firing our AJAX
$(document).ready(function() {
  // Bind a function to the "change" event of our drop-down list
  $("#dropDownId").bind("change", function(e) {
    updateList();
  });
}

var retrieveData = function(path, parentId, fnHandleCallback) {
  // Use the getJSON method to call our JsonResult action
  $.getJSON(path, { parentId: parentId }, function(data) {
    fnHandleCallback(data);
  });
};

// The path parameter is our JSON controller action
function updateList() {
  retrieveData("/Controller/GetList", $("#dropDownId").val(), handleResponse);
}

function handleResponse(data) {
  // Ok, now we have the JSON data, we need to do something with it.  I'm adding it to another dropdown.
  $("#otherDropDownId > option").remove();

  for (d in data)
  {
    var item = data[d];

    $("#otherDropDownId").append("<option value=\"" + item.Value + "\">" + item.Text + "</option>");
  }
}
</script>

<%= Html.DropDownList("dropDownId", new SelectList(new List<SelectListItem>())) %>
<%= Html.DropDownList("otherDropDownId", new SelectList(new List<SelectListItem>())) %> 
```

这一切都在我的脑海中，所以让我知道是否需要澄清或更正。

**编辑**

正如我在评论中指出的那样，为了“AJAXify”你的页面，你真的不想在你的模型中推送所有内容。相反，听起来你想要这样的东西：

控制器动作：

```
public JsonResult GetPagedData(int page, int itemsPerPage, string[] filters)
{
  var results = dataRepository.GetPagedItems(pageId, itemsPerPage, filters);

  return new JsonResult()
  {
    Data = results.ToArray();
  };
} 
```

JS 变化：

```
var retrieveData = function(path, pageNumber, pageSize, filters, fnHandleCallback) {
  // Use the getJSON method to call our JsonResult action
  $.getJSON(path, { page: pageNumber, itemsPerPage: pageSize, filters: filters }, function(data) {
    fnHandleCallback(data);
  });
};

// The path parameter is our JSON controller action
function updateList() {
  retrieveData("/Controller/GetPagedData", $("#pageNumber").val(), $("#dropDownId").val(), null, handleResponse);
} 
```

我故意忽略了计算页码和过滤器——它们基本上遵循相同的原则。

最后，当您呈现数据时，您会将其放入您的产品网格中，而不是另一个下拉列表中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T19:05:50.180

AJAX 只是从页面中提取信息而不刷新浏览器的请求。您可以使用[ASP.NET AJAX](http://www.asp.net/ajax/)或[JQuery 的 AJAX](http://docs.jquery.com/Ajax/jQuery.ajax#options)，您应该得到相同的结果。

而 JQuery 只是一个用于选择和操作 DOM 的库。JQuery 有一些您也可以使用的 AJAX 函数，但 JQuery 可以用于更多用途。

我不知道 ASP 的版本是如何工作的，但 AJAX 只是一个页面请求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T20:15:41.010

我肯定会检查 jQuery 而不会打扰 MS 的 ajax 实现。对于您想要的东西，您可以查看 jQuery 的文档，例如[$post或](http://docs.jquery.com/Ajax/jQuery.post)[ajax/load](http://docs.jquery.com/Ajax/load)函数。

您可以将事件添加到页面上的控件，例如地毯/地毯单选按钮，或者将该事件添加到提交按钮，然后调用产品控制器以检索加载到产品 div 中的部分视图。

# ruby-on-rails - 冻结 Rails 版本/宝石有什么意义？

> ID：799416
> 
> 赞同：10
> 
> 时间：2009-04-28T19:07:42.953
> 
> 标签：ruby-on-rails, ruby, rubygems, freeze

这意味着什么？

在一个项目的说明中，它说“冻结 Rails gems”。这与冻结 Rails 版本有什么不同？

结冰是怎么回事？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-28T19:10:13.930

如果您使用的 gem 的作者之一介绍了 gem 的新版本，则新版本可能会引入向后不兼容的更改，这会破坏您的代码。

冻结 gem 会将其放入应用程序的 vendor 文件夹中，并且它不会自行自动更新。Rails 将改用这个版本的 gem。

这允许您为其他应用程序更新系统上的 gem，同时让您的唯一应用程序使用您一直使用的 gem 版本，因此是稳定的。

这也适用于 rails gem 本身，因为新版本的 rails 最终可能会导致您的应用程序中的某些内容中断，冻结它会阻止系统范围的更新（并且再次允许您更新机器上的其他应用程序，同时将您冻结的应用程序留在该版本号。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T19:40:37.243

我认为菲尔克的评论一针见血。

每当您有一个应用程序在人们依赖的生产环境中运行时，您就必须有一种“冻结”环境的机制。更新 rails 可能会导致您的应用程序停止正常工作。

这可能是一些次要的事情，也可能是阻止您的用户完成工作的事情。

只需 google 'rails gem update 会破坏我的应用程序'，就可以看到一些麻烦。

[Igor Minar](http://blog.igorminar.com/2009/01/freezing-activerecord-jdbc-gems-into.html)有一篇很好的博客文章，介绍了为什么应该冻结 gem 和 Rails，并讨论了现在如何在 Rails 中设置特定的 gem 版本依赖项。

您可以冻结 Rails，您可以冻结 gem，您可以在 environment.rb 文件中设置对特定 gem 版本的依赖。

这样做的原因是为了确保您的应用程序在 gem 或 Rails 的更新版本发布时不会中断。冻结让您可以在单独的机器上测试更新，确保它通过了您所有的自动化测试套件，让您的用户通过它的步伐来放置更新的应用程序，然后（在良好的备份之后）您将更新应用到 gem 或导轨。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T22:00:47.297

冻结很棒——正如其他人所说，它减少了你对外部环境的依赖。如果您使用的是共享主机，或者无法完全控制您的部署位置，这一点尤其重要。

然而，对于像 rake 和 capistrano 这样不在 Rails 环境中运行的程序来说，它可能会出现问题。他们有自己的 gem 加载路径，你可以影响它，但你需要注意它。此外，不能冻结具有本机扩展（libxml、hpricot...）的 gem，因为特定于操作系统的位仍然需要存在于外部操作系统中。

此外，现在可能不是问题，但需要注意的是——Rails 3 将转向管理插件、gem 和供应商目录的新方法。此刻一切都是一团糟。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T19:11:13.693

这是一个冻结 Rails 应用程序[的教程。](http://www.softiesonrails.com/posts/2008-1-3-freezing-your-rails-application.html)

# vim - 即使文件模式显式为 DOS，gVim 也会显示回车符 (^M)

> ID：799417
> 
> 赞同：81
> 
> 时间：2009-04-28T19:08:11.377
> 
> 标签：vim, carriage-return, line-endings

我在 Windows 上使用 gVim。我的代码`^M`在行尾显示字符。我曾经`:set ff=dos`无济于事。这些`^M`字符保留在现有行中，但不会出现在我输入的换行符中。我已将模式切换到 mac（显示`^J`字符）和 unix（也显示`^M`字符）并返回到 dos。有没有其他人看过这个？

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2009-04-28T19:12:06.437

当您混合使用 Windows 行尾和 Unix 行尾时，就会发生这种情况。如果您有 100 行，其中 99 行是 \r\n，1 行是 \n，您将看到 99 个 ^M 字符。解决方法是找到那一行并替换它。或者在文件上运行 dos2unix。您可以将 Windows 行尾替换为：

`:%s/\r\(\n\)/\1/g`

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2011-07-26T14:37:57.343

您还可以运行：

```
:e ++ff=dos 
```

要删除`^M`: 请参阅[文件格式 – Vim Tips Wiki](http://vim.wikia.com/wiki/File_format)。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-04-29T00:00:28.070

我通常使用以下内容来清理我的行尾：

```
:g/^M$/s/// 
```

要获得 ctrl-M，我通常输入 ctrl-Q，然后输入 ctrl-M 并将其放入。（在某些环境中，它可能是 ctrl-V，然后是 ctrl-M。）我不知道为什么，但我发现一个比[rq](https://stackoverflow.com/questions/799417/gvim-showing-carriage-return-m-even-when-file-mode-is-explicitly-dos/799433#799433)更容易记住。

不要忘记也这样做`:set ff=dos`，否则您最终仍会以 UNIX 行结尾保存。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-05-28T19:22:27.057

我知道这已经得到了回答，但我使用的一个技巧是

```
:%s/\r/\r/g 
```

这用 windows CRLF 替换了 unix 回车。只是添加以防其他人有问题。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-03-24T11:10:09.433

你可以忽略这些字符！

把它放到你的 vimrc 中

> 匹配忽略/\r$/

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-12-02T15:58:29.870

实际上对我有用的（在 64 位 Windows 上， gVIM: 7.2 ）是：

```
:set ffs=dos 
```

**不只是：ff**

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-05-31T16:56:12.543

在 Windows 7 上运行 Vim 7.3。我使用了以下命令：

```
:%s/^M/\r/g 
```

要创建 ^MI，输入 CTRL+Q，然后 CTRL+M。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-01-18T14:20:11.203

这对你们中的许多人来说可能有点简单，但它很有用。

根据richq 的回答，我发现这些在我的vimrc 中很有用。注意，第二个通常被注释掉，因为它使 dd 有点混乱，因为如果它是映射的 ex 命令，Vim 将等待另一个击键来解决。

```
功能！D2u()
    执行 '%s/\r\(\n\)/\1/g'
结束功能
"映射 d2u :%s/\r\(\n\)/\1/g

```

第一个是通过键入 ex 来运行的，第二个是通过在编辑模式下`call D2u()`按下来运行的。`D2u`

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-06-19T11:31:25.463

这些是额外的 CR 行结尾，通常是因为在混合 UNIX/DOS 系统上使用文件。

从每行末尾删除单个 ^M 的最短答案可能是：

```
:%s/\r 
```

这相当于：

```
:%s/\r// 
```

但不需要结尾斜杠（假设它们）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-09-01T13:32:37.040

尝试了很多东西，但以下工作

```
:%s/\r/\r/g 
```

注意：如果要对整个文件产生影响，请使用*g*

# regex - 如何使用正则表达式从 html 文件中提取问答数据组？

> ID：799420
> 
> 赞同：0
> 
> 时间：2009-04-28T19:08:35.430
> 
> 标签：regex

如何使用正则表达式提取格式如下的 html 组：

.

```
.
    .irrelevant html...
    <b>Question 6</b><br>

lots of text
<p>

lots of text
<p>
<br>

<b>Answer 6</b><br>
lots of text 
<p>

lots of text 
<p>

lots of text 
<p>

more text
<p>
<HR>

<IMG SRC="/images/image.jpg" alt="alt text" width=480 height=360 hspace=2 vspace=2> 
<p>

<i>caption text</i> 
```

可以有可变数量的问答对。并且图像代码可以在任何地方（在问题和答案之间，或在答案之后）......

我想提取的唯一信息是问题#、文本无段落 html 代码、Img src 和 alt 以及标题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T22:31:30.200

您可能想尝试使用 Watir 之类的东西。然后，您可以通过编程方式搜索 dom 并找到您需要的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T19:14:54.557

我认为你应该看看这个问题中的一些选项“ [Is there an Application to Create Regular Expression Out of Text by Selecting Wanted Area？](https://stackoverflow.com/questions/122402/is-there-an-application-to-create-regular-expression-out-of-text-by-selecting-w) ”

[ReguLazy](http://weblogs.asp.net/rosherove/pages/tools-and-frameworks-by-roy-osherove.aspx)看起来很合适。

# c# - 我读过手动放置在 Bin 内的程序集也被自动引用

> ID：799423
> 
> 赞同：0
> 
> 时间：2009-04-28T19:09:43.633
> 
> 标签：c#, .net, asp.net, assemblies

第一季度

我们可以通过*Website --> Add Reference*将程序集引用添加到 web 项目中，该 web 项目中的所有页面都会自动引用程序集。

但是我在某处读到，即使我们只是将程序集复制（因此我们不通过*网站-> 添加引用添加*）到 Web 项目的 Bin 目录，它仍然会被所有页面自动引用那个项目。但据我所知，事实并非如此？！

第二季度

A) 已部署的网站项目还会生成 PrecompiledApp.config 和 website1_deploy.wdproy。

这两个文件也应该复制到服务器吗？

B) 部署的 Web 应用项目还生成 WebApplication1.csproj 和 WebApplication1.csproj.user。

*   这两个文件也应该复制到服务器吗？如果是这样，为什么？

*   我认为不应将 obj 目录复制到 Web 服务器？！

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T20:36:21.133

Q1: "add reference" in a web site project means more than just copying the dll to the bin directly. It also means to place a dependency in app.config and to place a hint file which helps Visual Studio to find the dll from the source. This path is used by visual studio to copy the dll back to the bin directly (if somehow it gets removed) and to provide the "update reference" functionality. Having the dll registered in the app.config is essential for the runtime to compile your code using the right version of the dll.

Q2A: website1_deploy.wdproy is not required. PrecompiledApp.config is. This file tells the runtime that the website was already precompiled and that the aspx files are just placeholders for IIS.

Q2B: you don't have to copy all those files. The .csproj file is just for visual studio to keep track of all files in your project. The runtime doesn't do anything with it. The .csproj.user file has your settings, again the runtime doesn't do anything with it. It doesn't even understand it. The obj folder is the temporary directory for the compiler. Also not needed after compilation.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T20:11:00.210

Q1 - 复制到 bin 是运行时的事情。Web 项目是开发时的东西。它们是相关的，但并不相同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T20:14:57.720

当你给出引用时，它一般会在配置文件中加载引用，所以如果你在配置文件中添加所需的条目并将dll复制到bin文件夹中，它将被直接引用而不实际“添加引用”

您根本不需要复制 wdproj 文件。它只是一个有助于构建您的版本的部署项目。

不过，您需要将 precompiled.config 文件复制到部署目录。

# regex - 正则表达式

> ID：799424
> 
> 赞同：0
> 
> 时间：2009-04-28T19:09:45.007
> 
> 标签：regex, string, parsing

我需要一些帮助来使用 RegEx 检测以下表达式

字符串 "(x/x)" 其中 x 是 0-999 之间的任意数字。字符串“x of x”，其中 x 是 0-999 之间的任意数字。

通常，字符串是集合的标记，即 10 个事物中的 4 个，或 (3/5)，其中第一个数字是项目，第二个数字是总数。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T19:18:18.683

怎么样

"\d{1,3}/\d{1,3}"

和

“\d{1,3} 的 \d{1,3}”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T19:20:04.763

```
\([0-9]+\/[0-9]+\) 
```

和

```
[0-9]+ of [0-9]+ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T19:31:49.260

请参阅[如何使用正则表达式匹配 X 和 Y 之间的数字？](https://stackoverflow.com/questions/676467).

```
#!/usr/bin/perl

use strict;
use warnings;

my $num_re = qr/[0-9]|[1-9][0-9]|[1-9][0-9]{2}/;
for my $s qw( 1/10 100/500 a/456) {
    if (my ($x, $y) = $s =~ m{^($num_re)/($num_re)$}) {
        print "x is $x and y is $y\n";
    } else {
        print "$s does not match\n";
    }
} 
```

要不就

```
^([0-9]|[1-9][0-9]|[1-9][0-9]{2})\/([0-9]|[1-9][0-9]|[1-9][0-9]{2})$ 
```

如果您不介意违反[DRY](http://c2.com/cgi/wiki?DontRepeatYourself)。

# python - 在python中打印长整数

> ID：799434
> 
> 赞同：3
> 
> 时间：2009-04-28T19:12:27.170
> 
> 标签：python, django, datetime

如果我在 vote.created_on 是 python 日期时间的地方运行它：

```
import calendar
created_on_timestamp = calendar.timegm(vote.created_on.timetuple())*1000
created_on_timestamp = str(created_on_timestamp) 
```

created_on_timestamp 将使用封装的刻度线 (') 打印。如果我执行 int() 或类似的操作，我会得到类似 1240832864000L 的内容，就 JavaScript 而言，这不是一个数字（这是我需要使用这些日期时间的地方）。

有人知道处理这种情况的最佳方法吗？我应该将 long 作为字符串投射并去除刻度线吗？这似乎很疯狂。

=== 编辑附录 ===

更大的问题是 Django 将 " 转换为它的 HTML 编码等效 &39; （或类似的）。处理这个问题的最好方法是将 long 转换为字符串，当模板解析字符串时，使用 {{ created_on_timestamp|safe }} 将引号呈现为引号。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-28T19:16:07.567

```
>>> i = 1240832864000L
>>> i
1240832864000L
>>> print i
1240832864000
>>> 
>>> '<script type="text/javascript"> var num = %s; </script>' % i
'<script type="text/javascript"> var num = 1240832864000; </script>' 
```

L 仅在您触发对象的[`__repr__`](http://docs.python.org/library/functions.html#repr)

您何时以及如何将这些数据发送到 JavaScript？如果您将其作为 JSON 发送，则不必担心长文字或 Python 如何在 Python 中显示其对象。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T19:30:36.860

随着线：

```
created_on_timestamp = str(created_on_timestamp) 
```

您正在将某些内容转换为字符串。python控制台用单引号表示字符串（这就是你所说的刻度线吗？）字符串数据当然不包括引号。

当您使用`int()`它重新将其转换为数字时，`int()`由于它太大而知道它很长，并返回一个长整数。

python 控制台用尾随表示这个长数字`L`。但是数字内容当然不包括`L`.

```
>>> l = 42000000000
>>> str(l)
'42000000000'
>>> l
42000000000L
>>> int(str(l))
42000000000L
>>> type( int(str(l)) )
<type 'long'> 
```

尽管 python 控制台以这种方式表示数字和字符串（在 python 语法中），但您应该能够正常使用它们。您是在预料到问题，还是在这一点上实际遇到了问题？

# java - 负载测试 CMS Web 应用程序的实际测量是什么？

> ID：799436
> 
> 赞同：4
> 
> 时间：2009-04-28T19:12:56.543
> 
> 标签：java, .net, web-applications, content-management-system

我们公司的 CMS 网络应用程序面临一些困难。这个应用程序是由承包商部分构建的，当我们认为应用程序应该能够处理它时，我们一直面临一些稳定性问题（崩溃，必须将它们放在负载平衡器或缓存机制之前）。我们制定了一个最低标准的衡量标准，但我们不知道这些衡量标准是否现实。

我们希望在这个论坛上获得反馈，说明 CMS 系统应该独立于所构建的技术来处理的现实期望是什么。因此，如果要在 .NET 而不是 Java（当前）中构建相同的应用程序，您将期望执行相同的操作。

我们提出的指标是：

*   并发请求数/队列长度：100 最大值
*   处理请求的时间：最少 2 秒
*   每小时请求数：150,000
*   每小时最少页面浏览量：5,000

最低高清要求： - 2 GB 内存 - 2 双核 2.0 Ghz

一般功能：

*   动态交叉引用（人到新闻、事件到人和新闻、技术案例等）
*   高级搜索功能
*   高度可配置，无需编程

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T20:11:58.180

在没有任何关于硬件、技术、负载、使用等信息的情况下做出具体的性能和可扩展性期望是不合理的。“CMS”非常广泛：

*   您的服务器场是什么样的？
*   您的 SLA 条款是什么？
*   你的典型用户是什么样的？例如，有很多简短的用户还是更少的用户有很长的会话和很多请求？

其他需要回答的重要问题：

*   你想测量“第一个字节的时间”（我讨厌这个，但它很常见），还是在你的总“服务时间”中包含网络延迟？
*   有多少编辑在反对这个系统？
*   您的编辑是否使用相同的数据支持，或者他们是否在隔离环境中准备内容并推送批量内容更新？
*   你能支持什么样的缓存机制？内容会过时几分钟/几小时吗？

在我们的几个负载平衡的 64 位服务器场中，每个服务器具有约 32gb RAM (IIRC) 和 4 个 CPU，我们平均每小时有不到 10 万个请求，峰值负载为每秒数百个请求（不常见）。最终用户总加载时间（包括图像和资产）必须低于 5 秒。我们的 CMS 内容数据库总页数不到 750,000 页。我们有大量交叉加载的内容、查询、复杂的编辑器可配置小部件等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T20:15:02.760

您应该开始做的是跟踪人们如何使用它。如果您保留网络日志，您将收到随时间推移的请求和活动会话数等。

然后，您应该使用这些指标来确定您的负载/压力测试应该是什么样子。一次有多少用户，在峰值事务级别对其进行负载测试 - 将读取与写入归零。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T20:23:11.367

很难回答你的问题。您提到了服务器的硬件，但我不清楚该硬件是用于数据库服务器还是应用程序服务器（或者您是否对它们使用相同的硬件）。而且您还没有向我们提供有关您的数据库的信息...

在不了解您的应用程序架构的情况下更难提供帮助。一些架构决策，如数据库缓存、高级前端优化技术、数据库调优、全文索引、异步处理（通过消息队列）可以对应用程序性能和可伸缩性产生巨大影响。

无论如何，我建议你使用一些负载测试工具，如 JMeter、Silk Peformer、Load Runner 等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T15:12:48.750

我们公司使用带有 3 组不同脚本的负载运行程序。第一个脚本是模仿网站、主页、登录、导航到主题区域等的基本用例……第二个脚本是根据 100 个可能的搜索词进行随机站点搜索。第三个测试是针对向我们的订户回复大量电子邮件的用例。

每个脚本我们重复该动作 20 次。

我们以 100 个并发用户运行第一个脚本，从 1 个用户开始，每 30 秒增加 5 个，然后我们让它运行并提取统计信息。

我们以 20 个并发用户运行第二个脚本，从 1 个用户开始，每 30 秒增加 2 个

我们在 500 个并发用户上运行第三个脚本，从 1 开始，每 5 秒增加 10。

重要的部分是我们运行相同的负载测试并跟踪/分析每次更改基础架构的结果。

负载运行器跟踪响应时间、故障率和其他一些统计数据……使用远程代理，它还可以跟踪数据库和服务器的重要信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-05T22:23:15.653

性能问题很少是直截了当的。坦率地说，您应该真正了解您正在使用的 CMS 和性能优化的熟练集成商的服务。找出网络/CMS 本身/其实现之间的瓶颈总是很棘手。

您的规范在我看来很“标准”，在这里没有任何期望，所以我怀疑更多的是实施或网络问题而不是直接的 CMS（我不能说它不是 CMS，我想说，那会令人惊讶.. . 并且令人失望。如果它是一个著名的闭源供应商，一个著名的开源供应商，那么您认为 CMS 不是原因的机会正在迅速上升）。

# db2 - 在 DB2 中增加一个序列两次

> ID：799442
> 
> 赞同：2
> 
> 时间：2009-04-28T19:14:49.957
> 
> 标签：db2, sequence

我需要在 DB2（9.1 版）中两次获取序列的下一个值。而不是执行以下两次：

```
SELECT nextval FOR schema.sequence AS id
FROM dual 
```

我想做类似的事情：

```
SELECT nextval FOR schema.sequence AS id1,
       nextval FOR schema.sequence AS id2
FROM dual 
```

除了上面只增加一次：

```
ID1         ID2        
----------- -----------
        643         643

  1 record(s) selected. 
```

我是被迫只查询两次，还是有办法在一次查询中将其增加两次？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-02-02T19:30:25.600

这有点复杂，但它可以工作（我通过在 DB2 v.9 中运行它进行了验证）。

```
WITH GENERATED (KEYVAL) AS
(select 1
   from sysibm.sysdummy1
  UNION ALL
 SELECT KEYVAL + 1
   FROM GENERATED
  WHERE KEYVAL < 2)        -- how many you want

SELECT KEYVAL AS INCREMENT_NUMBER, NEXTVAL FOR schema.sequence
  FROM GENERATED; 
```

这是我最喜欢的一些代码，它是递归 SQL。您可以在没有序列对象的情况下执行此操作，它只会生成几行数字。我有时使用它来插入生成的测试数据行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T20:56:57.887

好的，这是一个 hack，但以下工作......虽然我希望看到一个更清晰的答案，所以如果你知道一个答案，请发布一个答案！

```
SELECT nextval FOR schema.sequence AS id
FROM (SELECT 1 FROM dual UNION ALL SELECT 1 FROM dual) temp 
```

结果：

```
ID         
-----------
        669
        670

  2 record(s) selected. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-03T22:05:20.167

DB2中没有序列也没有对偶表

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-05T00:11:29.803

仅仅因为我选择了你 Mike :-P，这是另一个解决方案：

```
VALUES NEXT VALUE FOR schema.sequence, NEXT VALUE FOR schema.sequence; 
```

如果您将其分为两行，它将起作用，就像这里一样。但是，如果您将其作为一行进行：

```
VALUES (NEXT VALUE FOR schema.sequence, NEXT VALUE FOR schema.sequence); 
```

它将返回相同的序列值。:-(

# c# - 从 IList 创建一个逗号分隔的列表 或 IEnumerable

> ID：799446
> 
> 赞同：974
> 
> 时间：2009-04-28T19:15:58.033
> 
> 标签：c#, string

`IList<string>`从or创建逗号分隔的字符串值列表的最简洁方法是什么`IEnumerable<string>`？

`String.Join(...)``string[]`当诸如`IList<string>`或`IEnumerable<string>`不能轻易转换为字符串数组之类的类型时，对 a 进行操作可能会很麻烦。

* * *

## 回答 #1

> 赞同：1663
> 
> 时间：2009-04-28T19:17:41.977

**.NET 4+**

```
IList<string> strings = new List<string>{"1","2","testing"};
string joined = string.Join(",", strings); 
```

**.Net 4.0 解决方案的详细信息**

`IEnumerable<string>`可以使用 LINQ (.NET 3.5)*很*容易地转换为字符串数组：

```
IEnumerable<string> strings = ...;
string[] array = strings.ToArray(); 
```

如果您需要，编写等效的辅助方法很容易：

```
public static T[] ToArray(IEnumerable<T> source)
{
    return new List<T>(source).ToArray();
} 
```

然后像这样调用它：

```
IEnumerable<string> strings = ...;
string[] array = Helpers.ToArray(strings); 
```

然后您可以调用`string.Join`. 当然，您不必*使用*辅助方法：

```
// C# 3 and .NET 3.5 way:
string joined = string.Join(",", strings.ToArray());
// C# 2 and .NET 2.0 way:
string joined = string.Join(",", new List<string>(strings).ToArray()); 
```

后者虽然有点拗口：）

这可能是最简单的方法，而且性能也很好——还有其他关于性能究竟如何的问题，包括（但不限于）[这个](https://stackoverflow.com/questions/219519/whats-the-c-method-syntax-for-converting-an-array-to-a-simple-string)。

从 .NET 4.0 开始，有更多可用的重载[`string.Join`](http://msdn.microsoft.com/en-us/library/system.string.join)，因此您实际上可以只写：

```
string joined = string.Join(",", strings); 
```

简单得多:)

* * *

## 回答 #2

> 赞同：185
> 
> 时间：2010-06-18T02:37:07.600

仅供参考，.NET 4.0 版本`string.Join()`有一些[额外的重载](http://msdn.microsoft.com/en-us/library/system.string.join.aspx)，它们`IEnumerable`不仅可以处理数组，还可以处理任何类型的数组`T`：

```
public static string Join(string separator, IEnumerable<string> values)
public static string Join<T>(string separator, IEnumerable<T> values) 
```

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2009-04-28T19:18:23.707

我能看到的最简单的方法是使用 LINQ`Aggregate`方法：

```
string commaSeparatedList = input.Aggregate((a, x) => a + ", " + x) 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2010-08-05T19:52:18.037

我认为创建以逗号分隔的字符串值列表的最简洁方法很简单：

```
string.Join<string>(",", stringEnumerable); 
```

这是一个完整的例子：

```
IEnumerable<string> stringEnumerable= new List<string>();
stringList.Add("Comma");
stringList.Add("Separated");

string.Join<string>(",", stringEnumerable); 
```

不需要制作辅助函数，这是内置在 .NET 4.0 及更高版本中的。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2017-05-04T13:05:01.903

按性能比较获胜者是“循环它，sb.Append 它，然后退一步”。实际上“下一个可枚举和手动移动”同样好（考虑stddev）。

```
BenchmarkDotNet=v0.10.5, OS=Windows 10.0.14393
Processor=Intel Core i5-2500K CPU 3.30GHz (Sandy Bridge), ProcessorCount=4
Frequency=3233539 Hz, Resolution=309.2587 ns, Timer=TSC
  [Host] : Clr 4.0.30319.42000, 64bit RyuJIT-v4.6.1637.0
  Clr    : Clr 4.0.30319.42000, 64bit RyuJIT-v4.6.1637.0
  Core   : .NET Core 4.6.25009.03, 64bit RyuJIT

                Method |  Job | Runtime |     Mean |     Error |    StdDev |      Min |      Max |   Median | Rank |  Gen 0 | Allocated |
---------------------- |----- |-------- |---------:|----------:|----------:|---------:|---------:|---------:|-----:|-------:|----------:|
            StringJoin |  Clr |     Clr | 28.24 us | 0.4381 us | 0.3659 us | 27.68 us | 29.10 us | 28.21 us |    8 | 4.9969 |   16.3 kB |
 SeparatorSubstitution |  Clr |     Clr | 17.90 us | 0.2900 us | 0.2712 us | 17.55 us | 18.37 us | 17.80 us |    6 | 4.9296 |  16.27 kB |
     SeparatorStepBack |  Clr |     Clr | 16.81 us | 0.1289 us | 0.1206 us | 16.64 us | 17.05 us | 16.81 us |    2 | 4.9459 |  16.27 kB |
            Enumerable |  Clr |     Clr | 17.27 us | 0.0736 us | 0.0615 us | 17.17 us | 17.36 us | 17.29 us |    4 | 4.9377 |  16.27 kB |
            StringJoin | Core |    Core | 27.51 us | 0.5340 us | 0.4995 us | 26.80 us | 28.25 us | 27.51 us |    7 | 5.0296 |  16.26 kB |
 SeparatorSubstitution | Core |    Core | 17.37 us | 0.1664 us | 0.1557 us | 17.15 us | 17.68 us | 17.39 us |    5 | 4.9622 |  16.22 kB |
     SeparatorStepBack | Core |    Core | 15.65 us | 0.1545 us | 0.1290 us | 15.45 us | 15.82 us | 15.66 us |    1 | 4.9622 |  16.22 kB |
            Enumerable | Core |    Core | 17.00 us | 0.0905 us | 0.0654 us | 16.93 us | 17.12 us | 16.98 us |    3 | 4.9622 |  16.22 kB | 
```

代码：

```
public class BenchmarkStringUnion
{
    List<string> testData = new List<string>();
    public BenchmarkStringUnion()
    {
        for(int i=0;i<1000;i++)
        {
            testData.Add(i.ToString());
        }
    }
    [Benchmark]
    public string StringJoin()
    {
        var text = string.Join<string>(",", testData);
        return text;
    }
    [Benchmark]
    public string SeparatorSubstitution()
    {
        var sb = new StringBuilder();
        var separator = String.Empty;
        foreach (var value in testData)
        {
            sb.Append(separator).Append(value);
            separator = ",";
        }
        return sb.ToString();
    }

    [Benchmark]
    public string SeparatorStepBack()
    {
        var sb = new StringBuilder();
        foreach (var item in testData)
            sb.Append(item).Append(',');
        if (sb.Length>=1) 
            sb.Length--;
        return sb.ToString();
    }

    [Benchmark]
    public string Enumerable()
    {
        var sb = new StringBuilder();
        var e = testData.GetEnumerator();
        bool  moveNext = e.MoveNext();
        while (moveNext)
        {
            sb.Append(e.Current);
            moveNext = e.MoveNext();
            if (moveNext) 
                sb.Append(",");
        }
        return sb.ToString();
    }
} 
```

使用了[https://github.com/dotnet/BenchmarkDotNet](https://github.com/dotnet/BenchmarkDotNet)

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2016-08-20T06:34:05.213

因为我在搜索加入对象列表的特定属性（而不是它的 ToString() ）时到达这里，所以这里是对已接受答案的补充：

```
var commaDelimited = string.Join(",", students.Where(i => i.Category == studentCategory)
                                 .Select(i => i.FirstName)); 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2010-06-18T13:38:31.197

这是另一种扩展方法：

```
 public static string Join(this IEnumerable<string> source, string separator)
    {
        return string.Join(separator, source);
    } 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-06-18T02:31:04.580

到这个讨论有点晚了，但这是我的贡献。我必须`IList<Guid> OrderIds`将其转换为 CSV 字符串，但以下是通用的，并且未经修改即可与其他类型一起使用：

```
string csv = OrderIds.Aggregate(new StringBuilder(),
             (sb, v) => sb.Append(v).Append(","),
             sb => {if (0 < sb.Length) sb.Length--; return sb.ToString();}); 
```

简短而甜蜜，使用 StringBuilder 构造新字符串，将 StringBuilder 长度缩小一以删除最后一个逗号并返回 CSV 字符串。

我已将其更新为使用多个`Append()`'s 添加字符串 + 逗号。根据 James 的反馈，我使用 Reflector 来查看`StringBuilder.AppendFormat()`. 结果是`AppendFormat()`使用 StringBuilder 来构造格式字符串，这使得它在这种情况下的效率低于仅使用多个`Appends()`'s。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2010-07-05T15:04:56.010

有点丑陋，但它有效：

```
string divisionsCSV = String.Join(",", ((List<IDivisionView>)divisions).ConvertAll<string>(d => d.DivisionID.ToString("b")).ToArray()); 
```

在你给它转换器后，给你一个列表中的 CSV（在本例中为 d => d.DivisionID.ToString("b")）。

哈克但有效 - 也许可以制成扩展方法？

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2010-08-04T02:25:34.200

这是我的做法，使用我在其他语言中的做法：

```
private string ToStringList<T>(IEnumerable<T> list, string delimiter)
{
  var sb = new StringBuilder();
  string separator = String.Empty;
  foreach (T value in list)
  {
    sb.Append(separator).Append(value);
    separator = delimiter;
  }
  return sb.ToString();
} 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2013-12-19T16:53:19.307

当我们应该用 ', by ex 包围时的具体需要：

```
 string[] arr = { "jj", "laa", "123" };
        List<string> myList = arr.ToList();

        // 'jj', 'laa', '123'
        Console.WriteLine(string.Join(", ",
            myList.ConvertAll(m =>
                string.Format("'{0}'", m)).ToArray())); 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2020-02-23T22:21:30.060

如果您要加入的字符串在对象列表中，那么您也可以执行以下操作：

```
var studentNames = string.Join(", ", students.Select(x => x.name)); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-04-28T19:33:24.467

我们有一个效用函数，如下所示：

```
public static string Join<T>( string delimiter, 
    IEnumerable<T> collection, Func<T, string> convert )
{
    return string.Join( delimiter, 
        collection.Select( convert ).ToArray() );
} 
```

可用于轻松加入大量收藏：

```
int[] ids = {1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233};

string csv = StringUtility.Join(",", ids, i => i.ToString() ); 
```

请注意，我们在 lambda 之前有集合参数，因为智能感知然后会选择集合类型。

如果您已经有一个字符串枚举，那么您需要做的就是 ToArray：

```
string csv = string.Join( ",", myStrings.ToArray() ); 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-04-28T19:18:11.743

您可以使用 ToArray 将 IList 转换为数组，然后在数组上运行 string.join 命令。

```
Dim strs As New List(Of String)
Dim arr As Array
arr = strs.ToArray 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-04-28T19:19:12.690

可以使用 .NET 3.5 中的 Linq 扩展轻松将它们转换为数组。

```
 var stringArray = stringList.ToArray(); 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-07-23T19:36:54.867

在使用其他人列出的方法之一将其转换为数组后，您还可以使用类似以下的内容：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;
using System.Net;
using System.Configuration;

namespace ConsoleApplication
{
    class Program
    {
        static void Main(string[] args)
        {
            CommaDelimitedStringCollection commaStr = new CommaDelimitedStringCollection();
            string[] itemList = { "Test1", "Test2", "Test3" };
            commaStr.AddRange(itemList);
            Console.WriteLine(commaStr.ToString()); //Outputs Test1,Test2,Test3
            Console.ReadLine();
        }
    }
} 
```

**编辑：** [这](http://blog.crowe.co.nz/archive/2007/08/25/c---How-to-create-a-comma-seperated-string-from.aspx)是另一个例子

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2010-06-22T16:40:37.833

我的回答类似于上面的聚合解决方案，但由于没有明确的委托调用，因此调用堆栈应该更少：

```
public static string ToCommaDelimitedString<T>(this IEnumerable<T> items)
{
    StringBuilder sb = new StringBuilder();
    foreach (var item in items)
    {
        sb.Append(item.ToString());
        sb.Append(',');
    }
    if (sb.Length >= 1) sb.Length--;
    return sb.ToString();
} 
```

当然，可以将签名扩展为与分隔符无关。我真的不喜欢 sb.Remove() 调用，我想将它重构为 IEnumerable 上的直接 while 循环，并使用 MoveNext() 来确定是否写逗号。如果我遇到它，我会摆弄并发布该解决方案。

* * *

这是我最初想要的：

```
public static string ToDelimitedString<T>(this IEnumerable<T> source, string delimiter, Func<T, string> converter)
{
    StringBuilder sb = new StringBuilder();
    var en = source.GetEnumerator();
    bool notdone = en.MoveNext();
    while (notdone)
    {
        sb.Append(converter(en.Current));
        notdone = en.MoveNext();
        if (notdone) sb.Append(delimiter);
    }
    return sb.ToString();
} 
```

不需要临时数组或列表存储，也不`StringBuilder` `Remove()`需要`Length--`hack。

在我的框架库中，我对这个方法签名做了一些变体，包括`delimiter`和`converter`参数的每个组合，分别使用`","`和`x.ToString()`作为默认值。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2013-04-12T10:11:29.443

希望这是最简单的方法

```
 string Commaseplist;
 string[] itemList = { "Test1", "Test2", "Test3" };
 Commaseplist = string.join(",",itemList);
 Console.WriteLine(Commaseplist); //Outputs Test1,Test2,Test3 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2013-11-12T02:16:35.953

在这篇文章发生之前，我刚刚解决了这个问题。我的解决方案如下所示：

```
 private static string GetSeparator<T>(IList<T> list, T item)
   {
       return (list.IndexOf(item) == list.Count - 1) ? "" : ", ";
   } 
```

像这样调用：

```
List<thing> myThings;
string tidyString;

foreach (var thing in myThings)
{
     tidyString += string.format("Thing {0} is a {1}", thing.id, thing.name) + GetSeparator(myThings, thing);
} 
```

我也可以像这样简单地表达，而且效率也会更高：

```
string.Join(“,”, myThings.Select(t => string.format(“Thing {0} is a {1}”, t.id, t.name)); 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2015-11-25T16:21:58.197

我在寻找一个好的 C# 方法来连接字符串时遇到了这个讨论，就像用 MySql 方法完成的那样`CONCAT_WS()`。此方法与该方法`string.Join()`的不同之处在于，如果字符串为 NULL 或空，则不添加分隔符。

> CONCAT_WS(', ',tbl.Lastname,tbl.Firstname)

`Lastname`仅当 firstname 为空时才会返回，而

> string.Join(", ", strLastname, strFirstname)

将`strLastname + ", "`在相同的情况下返回。

想要第一个行为，我写了以下方法：

```
 public static string JoinStringsIfNotNullOrEmpty(string strSeparator, string strA, string strB, string strC = "")
    {
        return JoinStringsIfNotNullOrEmpty(strSeparator, new[] {strA, strB, strC});
    }

    public static string JoinStringsIfNotNullOrEmpty(string strSeparator, string[] arrayStrings)
    {
        if (strSeparator == null)
            strSeparator = "";
        if (arrayStrings == null)
            return "";
        string strRetVal = arrayStrings.Where(str => !string.IsNullOrEmpty(str)).Aggregate("", (current, str) => current + (str + strSeparator));
        int trimEndStartIndex = strRetVal.Length - strSeparator.Length;
        if (trimEndStartIndex>0)
            strRetVal = strRetVal.Remove(trimEndStartIndex);
        return strRetVal;
    } 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2009-04-28T19:18:05.503

您可以使用`.ToArray()`on`Lists`和`IEnumerables`，然后`String.Join()`根据需要使用。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-11-25T18:44:03.680

我写了一些扩展方法来以一种有效的方式做到这一点：

```
 public static string JoinWithDelimiter(this IEnumerable<String> that, string delim) {
        var sb = new StringBuilder();
        foreach (var s in that) {
            sb.AppendToList(s,delim);
        }

        return sb.ToString();
    } 
```

这取决于

```
 public static string AppendToList(this String s, string item, string delim) {
        if (s.Length == 0) {
            return item;
        }

        return s+delim+item;
    } 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2020-06-27T15:00:34.430

要从`IList<string>`or中创建逗号分隔列表`IEnumerable<string>`，除了使用之外，`string.Join()`您还可以使用以下`StringBuilder.AppendJoin`方法：

```
new StringBuilder().AppendJoin(", ", itemList).ToString(); 
```

或者

```
$"{new StringBuilder().AppendJoin(", ", itemList)}"; 
```

# asp.net - 根据第一个选择加载底部水平菜单

> ID：799452
> 
> 赞同：0
> 
> 时间：2009-04-28T19:17:02.620
> 
> 标签：asp.net, menu, submenu

我在 DIV 中有一个水平菜单，我想根据用户在顶部菜单中选择的内容在其下方加载一个菜单（也是水平的）。

现在，我正在根据当前加载的内容页面在母版页中呈现菜单。但是，我不知道如何确定当用户单击其中一个子菜单选项时选择了哪个子菜单选项。

在 ASP.NET 中管理堆叠的水平菜单的最佳方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-28T19:38:35.327

下面将显示带有“A”和“B”的主菜单，带有“A-1”/“A-2”或“B-1”/“B-2”的子菜单以及显示哪个子菜单的标签项目已被选中。你是这个意思吗？

```
<div>
    Main menu:
    <asp:Menu ID="menu1" runat="server" Orientation="Horizontal">
        <Items>
            <asp:MenuItem Text="A">
            <asp:MenuItem Text="B">
        </Items>
    </asp:Menu>
</div>
<div>
    Sub menu:
    <asp:Menu ID="menu2" runat="server" Orientation="Horizontal">
    </asp:Menu>
</div>
<div>
    Selected sub menu item:
    <asp:Label ID="lbl1" runat="server">
</div>

protected void Page_Init(object sender, EventArgs e)
{
    menu1.MenuItemClick +=
        new MenuEventHandler(menu1_MenuItemClick);
    menu2.MenuItemClick += new MenuEventHandler(menu2_MenuItemClick);
}

void menu1_MenuItemClick(object sender, MenuEventArgs e)
{
    menu2.Items.Clear();
    menu2.Items.Add(new MenuItem(e.Item.Text + "-1"));
    menu2.Items.Add(new MenuItem(e.Item.Text + "-2"));
}

void menu2_MenuItemClick(object sender, MenuEventArgs e)
{
    lbl1.Text = e.Item.Text;
} 
```

# nhibernate - NHibernate：HQL 和 UserTypes 作为查询参数

> ID：799457
> 
> 赞同：4
> 
> 时间：2009-04-28T19:18:10.243
> 
> 标签：nhibernate, hql

我正在使用具有奇怪日期格式的数据库。我编写了一个 UserType 来将标准 .NET DateTime 传输到/从奇怪的格式传输，它工作正常。

我通常使用 ICriteria 查询，但决定在这个项目上尝试使用 HQL 的 IQuery。我遇到了一个问题，即查询没有将参数转换为适当的 UserType。

例如：

```
IQuery query = session.CreateQuery("from OfflineShipmentLineItem as line join fetch line.Shipment as shipment join fetch line.Extension where shipment.ShipmentDate = :date");
query.SetParameter("date", date);

return query.List<OfflineShipmentLineItem>(); 
```

上面的问题是因为对 shipping.ShipmentDate 的查询最终是 '4/28/2009 12:00:00' 而不是 UserType 格式。

如果我改为使用 ICriteria 它工作正常：

```
ICriteria criteria = session.CreateCriteria(typeof(OfflineShipmentLineItem));

criteria.SetFetchMode("Shipment", FetchMode.Eager);
criteria.SetFetchMode("Extension", FetchMode.Eager);

criteria.CreateAlias("Shipment", "shipment");

criteria.Add(Expression.Eq("shipment.ShipmentDate", date));

return criteria.List<OfflineShipmentLineItem>(); 
```

一切正常，因为日期是使用用于 shipping.ShipmentDate 的 UserType 翻译的。

我错过了一些暗示 HQL 该怎么做的东西吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T09:43:21.437

我没有时间尝试自己，但尝试添加 SetParameter 的第三个参数（IType）。作为参数使用 NHUtils.Custom(typeof(YourIUserType))

# sql-server - 如何将 SQL Server 2005 查询导出为 CSV

> ID：799465
> 
> 赞同：65
> 
> 时间：2009-04-28T19:21:58.877
> 
> 标签：sql-server, sql-server-2005, bcp, sqlcmd

我想将一些 SQL Server 2005 数据导出为 CSV 格式（用引号分隔的逗号）。我可以想到很多复杂的方法来做到这一点，但我想以*正确*的方式去做。我看过 bcp，但我不知道如何在字段周围加上引号（除了将它们连接到字段值，这很难看）。我想我可以用 sqlcmd 和 -o 来做到这一点，但出于同样的原因，这看起来很难看。

有没有 bcp 方法可以做到这一点？

有没有合理的 sqlcmd 方法来做到这一点？

Management Studio 中是否有一些很棒的、简单的实用程序，而我只是忽略了这些实用程序？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-04-28T19:28:55.197

在 Management Studio 中，选择数据库，右键单击并选择`Tasks->Export Data`. 在那里，您将看到导出为不同类型格式的选项，包括 CSV、Excel 等。

您还可以从“查询”窗口运行查询并将结果保存到 CSV。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-04-28T19:29:39.763

在管理工作室中，将查询选项设置为输出到文件，并在选项->查询结果中将输出到文件设置为使用逗号作为分隔符的输出。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-12-15T15:27:42.370

如果您不能使用 Management Studio，我使用 sqlcmd。

```
sqlcmd -q "select col1,col2,col3 from table" -oc:\myfile.csv -h-1 -s"," 
```

这是从命令行执行此操作的快速方法。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2010-09-29T22:36:35.587

我必须比思进说的多做一件事才能让它在 SQL Server Management Studio 2005 中正确添加引号。转到

`Tools->Options->Query Results->Sql Server->Results To Grid`

在此选项旁边打勾：

`Quote strings containing list separators when saving .csv results`

**注意：**上述方法不适用于 SSMS 2005 Express！据我所知，使用 SSMS 2005 Express 将结果导出到 .csv 时无法引用字段。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-28T19:30:31.603

是的，如果您只是想将查询结果保存到 CSV，Management Studio 中有一个非常简单的实用程序。

右键单击结果集，选择“将结果另存为”。默认文件类型为 CSV。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-28T19:33:17.680

如果它符合您的要求，如果您经常这样做或希望将其构建到生产过程中，则可以在命令行上使用**bcp 。**

[这是](http://www.simple-talk.com/sql/database-administration/creating-csv-files-using-bcp-and-stored-procedures/)描述配置的链接。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-28T19:29:12.450

对于即席查询：

以网格模式 (CTRL+D) 显示结果，运行查询，单击结果网格中的左上角框，粘贴到 Excel，另存为 CSV。您也许可以直接粘贴到文本文件中（现在不能尝试）

或者“结果文件”也有 CSV 的选项

或带有逗号分隔符的“结果到文本”

Tool..Options 和 Query.. options 下的所有设置（我认为，无法检查）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-03-17T22:46:58.480

在 SQL 2005 中，这很简单： 1\. 打开 SQL Server management studio 并将您需要的 sql 语句复制到 TSQL 中，例如 exec sp_whatever 2\. Query->Results to Grid 3\. 突出显示 sql 语句并运行它 4\. 突出显示数据结果（左键单击结果网格的左上方区域） 5\. 现在右键单击并选择 Save Results As 6\. 在 Save as type 中选择 CSV，输入文件名，选择位置并单击 Save。

简单的！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-01-06T16:23:13.643

设置不计数

引号在那里，使用 -w2000 将每一行保持在一行。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-08-26T19:08:05.040

在 Sql Server 2012 - Management Studio 中：

**解决方案1：**

执行查询

右键单击结果窗口

从菜单中选择结果另存为

选择 CSV

**解决方案2：**

右键单击数据库

选择任务，导出数据

选择源数据库

选择目标：平面文件目标

选择一个文件名

选择格式 - 分隔

选择表或编写查询

选择列分隔符

**注意：** 您可以选择一个文本限定符来分隔您的文本字段，例如引号。

如果您有一个带逗号的字段，请不要使用逗号作为分隔符，因为它不会转义逗号。您可以选择列分隔符，例如垂直条：| 而不是逗号或制表符。否则，编写一个转义逗号或分隔 varchar 字段的查询。

您需要使用的转义字符或文本限定符取决于您的要求。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-06-19T19:07:45.970

我认为最简单的方法是使用 Excel。

1.  打开一个新的 Excel 文件。
2.  单击数据选项卡
3.  选择其他数据源
4.  选择 SQL 服务器
5.  输入您的服务器名称、数据库、表名等。

如果您有更新版本的 Excel，您可以从 PowerPivot 中导入数据，然后将此数据插入到表中。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-05-13T20:12:00.030

SSIS 是一个非常好的方法来做到这一点。然后可以使用 SQL Server 代理作业安排此操作。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-02-04T08:44:56.600

您可以使用以下 Node.js 模块轻而易举地做到这一点：

[https://www.npmjs.com/package/mssql-to-csv](https://www.npmjs.com/package/mssql-to-csv)

# linux - 确定哪个名称服务器执行了解析

> ID：799468
> 
> 赞同：2
> 
> 时间：2009-04-28T19:22:25.210
> 
> 标签：linux, dns, nameservers

我正在设置两个名称服务器，`constr`然后使用`res_search`它来查找 URI 的 IP 地址。

有没有一种简单的方法可以找出两个名称服务器中的哪一个进行了解析？我知道我可以在`res_search`标准输出中设置跟踪并捕获，但在我的情况下这是不可能的。名称服务器的地址是否在结果中的某处？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T19:49:53.290

我不知道仅通过查看对`res_search()`. 该信息仅在更高级别的 UDP 数据包标头中，并且在数据包被解包时不再可用`libresolv`。

但是，根据版本的不同，`libresolv`它似乎可以通过使用解析器注册“响应钩子”来实现：

```
res_send_setrhook() 
```

或者

```
_res.rhook = &funcptr; 
```

提供给钩子回调的第一个参数将是`struct sockaddr *`发送响应的服务器。以下代码适用于 MacOS X 10.5.6：

```
#include <stdlib.h>
#include <stdio.h>
#include <resolv.h>
#include <netinet/in.h>

res_sendhookact hook(const struct sockaddr *ns,
        const u_char *query,
        int querylen,
        u_char *ans,
        int anssiz,
        int *resplen)
{
    fprintf(stderr, "answer returned from %s\n",
            inet_ntoa(((struct sockaddr_in *)ns)->sin_addr));

    return res_goahead;
}

main() {
    res_init();
    _res.rhook = hook;
    res_search(...);
} 
```

顺便说一句，（大多数情况下）可以询问服务器它认为它的名称：

```
dig @server hostname.bind ch txt 
```

这将返回`TXT`包含服务器主机名的记录（只要该功能存在于 DNS 服务器软件中并且未被禁用）。

这对于识别任何特定“DNS Anycast Cloud”中的哪台服务器目前正在为您服务很有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T01:06:51.497

最可靠的方法是进行数据包跟踪。在从事各种产品的工作时，我还没有看到程序员找到记录此类信息的挂钩。

# wpf - WPF - 半透明应用程序

> ID：799477
> 
> 赞同：1
> 
> 时间：2009-04-28T19:26:14.420
> 
> 标签：wpf, transparency

我的目标：与 Visual Studio 2008 中的 Intellisense 下拉列表类似，当用户按下 CTRL 时，我希望整个应用程序变得 40% 不透明。我怎样才能做到这一点？

我想使用常规窗口镶边，所以我的 WindowStyle 不能是“无”。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T21:17:58.520

对于 WPF，一种可能的解决方案是[FluidKit](http://fluidkit.codeplex.com/)库 (CodePlex) 中的自定义 GlassWindow。在此解决方案中，Window 是子类化和重新模板化的。完成了额外的工作以确保最小化、最大化和窗口移动按预期工作。我认为还有其他自定义解决方案可以做类似的事情。

由于多种原因，这不是一个完美的解决方案，所以我很想看看其他人尝试或提出了什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T19:33:43.593

在 WPF 中，Window.Opacity = 0.4。在 WinForms 中，Form.Opacity = 40。

您是否使用特殊工具或设置使您的 VS 在按下 Ctrl 时变得透明？它对我不起作用..

# javascript - Python HTML 输出（第一次尝试），几个问题（包含代码）

> ID：799479
> 
> 赞同：2
> 
> 时间：2009-04-28T19:27:29.707
> 
> 标签：javascript, python

虽然我已经玩 Python 几个月了（只是一个业余爱好者），但我对 Web 编程知之甚少（一点 HTML、零 JavaScript 等）。也就是说，我目前有一个项目让我第一次看到网络编程。这让我问：

[在网络上获取 Python 脚本输出的最简单方法是什么？](https://stackoverflow.com/questions/731470/whats-easiest-way-to-get-python-script-output-on-the-web)

感谢答案，我取得了一些进展。目前，我只使用 Python 和 HTML。我无法发布我的项目代码，所以我使用 twitter 搜索编写了一个小示例（请参见下文）。

我的问题是：

1.  我做了什么非常愚蠢的事情吗？我觉得`WebOutput()`很清楚但效率低下。如果我使用 JavaScript，我假设我可以编写一个 HTML 模板文件，然后只更新数据。是的？更好的方法来做到这一点？

2.  什么时候框架适合这样的应用程序？矫枉过正？

对于基本问题，我很抱歉——但我不想花太多时间走错路。

```
import simplejson, urllib, time

#query, results per page 
query = "swineflu"
rpp = 25
jsonURL = "http://search.twitter.com/search.json?q=" + query + "&rpp=" + str(rpp)

#currently storing all search results, really only need most recent but want the data avail for other stuff
data = []

#iterate over search results
def SearchResults():
    jsonResults = simplejson.load(urllib.urlopen(jsonURL))
    for tweet in jsonResults["results"]:
        try:
            #terminal output
            feed = tweet["from_user"] + " | " + tweet["text"]
            print feed
            data.append(feed)
        except:
            print "exception??"

# writes latest tweets to file/web
def WebOutput():
    f = open("outw.html", "w")
    f.write("<html>\n")
    f.write("<title>python newb's twitter search</title>\n")
    f.write("<head><meta http-equiv='refresh' content='60'></head>\n")
    f.write("<body>\n")
    f.write("<h1 style='font-size:150%'>Python Newb's Twitter Search</h1>")
    f.write("<h2 style='font-size:125%'>Searching Twitter for: " + query + "</h2>\n")
    f.write("<h2 style='font-size:125%'>" + time.ctime() + " (updates every 60 seconds)</h2>\n")

    for i in range(1,rpp):
        try:
            f.write("<p style='font-size:90%'>" + data[-i] + "</p>\n")
        except:
            continue

    f.write("</body>\n")
    f.write("</html>\n")
    f.close()

while True:
    print ""
    print "\nSearching Twitter for: " + query + " | current date/time is: " + time.ctime()
    print ""
    SearchResults()
    WebOutput()
    time.sleep(60) 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T20:00:40.283

为这样的事情使用框架并不过分；Python 框架往往非常轻巧且易于使用，并且可以让您更轻松地向您的小型站点添加功能。但这也不是必需的；我假设您这样做是出于学习目的，并讨论我将如何更改代码。

您在`WebOutput`函数中没有模板引擎的情况下进行模板化；Python 有各种简洁的模板语言，我最喜欢的是[mako](http://www.makotemplates.org/)。如果该函数中的代码比现在更复杂，我会将其分解为模板；一会儿我会告诉你那会是什么样子。但首先，我会使用多行字符串来替换所有这些`f.write`'，并使用字符串替换而不是添加字符串：

```
f.write("""<html>
<title>python newb's twitter search</title>
<head><meta http-equiv='refresh' content='60'></head>
<body>
<h1 style='font-size:150%'>Python Newb's Twitter Search</h1>
<h2 style='font-size:125%'>Searching Twitter for: %s</h2>
<h2 style='font-size:125%'>%s (updates every 60 seconds)</h2>""" % (query, time.ctime()))

for datum in reversed(data):
    f.write("<p style='font-size:90%'>%s</p>" % (datum))

f.write("</body></html>") 
```

另外，请注意，我稍微简化了您的 for 循环；如果我放的东西没有意义，我会进一步解释。

如果要将`WebOutput`函数转换为 Mako，则首先在文件顶部导入 mako：

```
import mako 
```

然后，您将 WebOutput() 的整个主体替换为：

```
f = file("outw.html", "w")
data = reversed(data)
t = Template(filename='/path/to/mytmpl.txt').render({"query":query, "time":time.ctime(), "data":data})
f.write(t) 
```

最后，您将创建一个`/path/to/mytmpl.txt`如下所示的文件：

```
<html>
<title>python newb's twitter search</title>
<head><meta http-equiv='refresh' content='60'></head>
<body>
<h1 style='font-size:150%'>Python Newb's Twitter Search</h1>
<h2 style='font-size:125%'>Searching Twitter for: ${query}</h2>
<h2 style='font-size:125%'>${time} (updates every 60 seconds)</h2>

% for datum in data:
    <p style'font-size:90%'>${datum}</p>
% endfor

</body>
</html> 
```

您可以看到，您完成的一件好事是将输出（或 Web 术语中的“视图层”）与抓取和格式化数据的代码（“模型层”和“控制器层”）分开。这将使您将来更容易更改脚本的输出。

（注意：我没有测试我在这里提供的代码；如果它不太正确，请道歉。它应该基本上可以工作）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-28T20:44:15.263

[字符串格式化](http://www.python.org/doc/2.5.2/lib/typesseq-strings.html)可以使事情更整洁，更不容易出错。

简单示例，`%s`替换为`a title`：

```
my_html = "<html><body><h1>%s</h1></body></html>" % ("a title") 
```

或多次（标题相同，现在“我的内容”显示在第二个`%s`位置：

```
my_html = "<html><body><h1>%s</h1>%s</body></html>" % ("a title", "my content") 
```

您还可以在执行时使用命名键`%s`，例如`%(thekey)s`，这意味着您不必跟踪它们所在的顺序。您使用[字典](http://docs.python.org/tutorial/datastructures.html#dictionaries)`%s`而不是[列表](http://docs.python.org/tutorial/datastructures.html#more-on-lists)，它将键映射到值：

```
my_html = "<html><body><h1>%(title)s</h1>%(content)s</body></html>" % {
    "title": "a title",
    "content":"my content"
} 
```

您的脚本最大的问题是，您使用的是全局变量 ( `data`)。*更好*的方法是：

*   调用 search_results，参数为“swineflu”
*   search_results 返回结果列表，将结果存储在变量中
*   调用 WebOutput，将搜索结果变量作为参数
*   WebOutput 返回一个字符串，其中包含您的 HTML
*   将返回的 HTML 写入您的文件

WebOutput 将返回 HTML（作为字符串），并将其写入文件。就像是：

```
results = SearchResults("swineflu", 25)
html = WebOutput(results)
f = open("outw.html", "w")
f.write(html)
f.close() 
```

最后，只有在访问需要登录的数据时才需要 twitterd 模块。公共时间线是公开的，无需任何身份验证即可访问，因此您可以删除 twitterd 导入和`api =`行。如果您确实想使用 twitterd，则必须对`api`变量执行一些操作，例如：

```
api = twitterd.Api(username='username', password='password')
statuses = api.GetPublicTimeline() 
```

因此，我可能编写脚本的方式是：

```
import time
import urllib
import simplejson

def search_results(query, rpp = 25): # 25 is default value for rpp
    url = "http://search.twitter.com/search.json?q=%s&%s" % (query, rpp)

    jsonResults = simplejson.load(urllib.urlopen(url))

    data = [] # setup empty list, within function scope
    for tweet in jsonResults["results"]:
        # Unicode!
        # And tweet is a dict, so we can use the string-formmating key thing
        data.append(u"%(from_user)s | %(text)s" % tweet)

    return data # instead of modifying the global data!

def web_output(data, query):
    results_html = ""

    # loop over each index of data, storing the item in "result"
    for result in data:
        # append to string
        results_html += "    <p style='font-size:90%%'>%s</p>\n" % (result)

    html = """<html>
    <head>
    <meta http-equiv='refresh' content='60'>
    <title>python newb's twitter search</title>
    </head>
    <body>
        <h1 style='font-size:150%%'>Python Newb's Twitter Search</h1>
        <h2 style='font-size:125%%'>Searching Twitter for: %(query)s</h2>
        <h2 style='font-size:125%%'> %(ctime)s (updates every 60 seconds)</h2>
    %(results_html)s
    </body>
    </html>
    """ % {
        'query': query,
        'ctime': time.ctime(),
        'results_html': results_html
    }

    return html

def main():
    query_string = "swineflu"
    results = search_results(query_string) # second value defaults to 25

    html = web_output(results, query_string)

    # Moved the file writing stuff to main, so WebOutput is reusable
    f = open("outw.html", "w")
    f.write(html)
    f.close()

    # Once the file is written, display the output to the terminal:
    for formatted_tweet in results:
        # the .encode() turns the unicode string into an ASCII one, ignoring
        # characters it cannot display correctly
        print formatted_tweet.encode('ascii', 'ignore')

if __name__ == '__main__':
    main()
# Common Python idiom, only runs main if directly run (not imported).
# Then means you can do..

# import myscript
# myscript.search_results("#python")

# without your "main" function being run 
```

* * *

> (2) 什么时候框架适合这样的应用程序？矫枉过正？

我想说总是使用网络框架（有一些例外）

现在，这可能看起来很奇怪，因为我一直在解释对您的脚本的修复。但是，通过对您的脚本进行上述修改，这非常容易做到，因为一切都很好地实现了功能化！

使用[CherryPy](http://www.cherrypy.org/)，这是一个非常简单的 Python HTTP 框架，您可以轻松地将数据发送到浏览器，而不是不断地写入文件。

这假设上述脚本保存为`twitter_searcher.py`.

注意我以前从未使用过 CherryPy，这只是 CherryPy 主页上的 HelloWorld 示例，从上面脚本的 main() 函数中复制了几行！

```
import cherrypy

# import the twitter_searcher.py script
import twitter_searcher
# you can now call the the functions in that script, for example:
# twitter_searcher.search_results("something")

class TwitterSearcher(object):
    def index(self):
        query_string = "swineflu"
        results = twitter_searcher.search_results(query_string) # second value defaults to 25
        html = twitter_searcher.web_output(results, query_string)

        return html
    index.exposed = True

cherrypy.quickstart(TwitterSearcher()) 
```

保存并运行该脚本，然后浏览到`http://0.0.0.0:8080/`它会显示您的页面！

问题在于，在每次页面加载时，它都会查询 Twitter API。如果只是您使用它，这将不是问题，但是当数百（甚至数十）人查看该页面时，它会开始变慢（最终您可能会被 twitter API 限速/阻止） )

The solution is basically back to the start.. You would write (cache) the search result to disc, re-searching twitter if the data is more than ~60 seconds old. You could also look into [CherryPy's caching options](http://www.cherrypy.org/wiki/Caching).. but this answer is getting rather absurdly long..

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-28T19:40:57.257

我建议使用模板来生成输出，您可以从 buildin [string.Template](http://docs.python.org/library/string.html#template-strings)开始或尝试一些更高级的东西，例如[Mako](http://www.makotemplates.org/)（或 Cheetah、Genshi、Jinja、Kid 等）。

Python 有许多不错的 Web 框架，其中最小的是[web.py](http://webpy.org/)或[werkzeug](http://werkzeug.pocoo.org/)

如果您想要一个成熟的框架，请查看[Pylons](http://pylonshq.com/)或[Django](http://www.djangoproject.com/)，但对于这样的项目来说，这些确实是矫枉过正。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T19:35:34.290

您将遇到的问题是，无论何时要更改 HTML，都需要更改 Python。对于这种情况，这可能很好，但可能会导致麻烦。我认为使用带有模板系统的东西很有意义。我建议看看 Django。[教程](http://docs.djangoproject.com/en/dev/intro/tutorial01/#intro-tutorial01)非常好。

# .net - LLBL：删除不在的地方

> ID：799480
> 
> 赞同：2
> 
> 时间：2009-04-28T19:27:33.060
> 
> 标签：.net, llblgenpro

我正在尝试在 LLBL 中执行以下查询，但运气不佳。

```
DELETE FROM dbo.MyTable WHERE MyTableId NOT IN ('39', '43', '44') 
```

从本质上讲，我到了这一点：

```
private static void Delete(MyTableCollection newRecs)
{
    PredicateExpression filter = new PredicateExpression();
    MyTableCollection allRecords = new MyTableCollection();

    filter.Add(new FieldCompareSetPredicate(
                   MyTableFields.MyTableId,
                   MyTableFields.MyTableId,
                   SetOperator.In, null, null, string.Empty, 0, null, true));

    allRecords.DeleteMulti(filter);
} 
```

我不确定上面的代码是否正确，但我不明白如何提供 newRecs 作为我的 IN 子句中使用的记录集合。我什至接近吗？

任何帮助将不胜感激。

**注意：**我意识到我在我的 SQL 示例中使用了静态 ID，但我真的在尝试使用存储在 newRecs 参数中的 ID。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T14:54:44.513

为了让“不在”工作，你必须传递某种数组。尝试这样的事情：

```
List<int> idsNotToDelete = new List<int>();
foreach (MyTableEntity ent in newRecs)
{
     idsNotToDelete.Add(ent.MyTableId);
}
PredicateExpression filter = new PredicateExpression(MyTableFields.MyTableId != idsNotToDelete)
MyTableCollection allRecords = new MyTableCollection();
allRecords.DeleteMulti(filter); 
```

# flash - 为什么 .jpg 在我的 flash as3 应用程序中显示为黄色？

> ID：799488
> 
> 赞同：1
> 
> 时间：2009-04-28T19:29:54.087
> 
> 标签：flash, actionscript-3, jpeg

我从我的服务器检索 .jpgs 并将它们加载到我的 as3 应用程序中。我使用 Flash CS3，而不是使用 flex。有时，某些图像会在应用程序中显示为黄色且无法读取。图像的实际原件很好，并且没有这样的泛黄，但是当我在 Flash 中加载图像时，它显示为黄色。这似乎与大小无关，因为我的大小图像显示为黄色，而有些图像则没有。

在 flashplayer 9 中查看图像时，会出现这种泛黄现象。它总是发生在同一个上，其余的都按预期出现。在 flashplayer 10 中查看图像时，它永远不会变黄，所有图像都按预期显示。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T22:25:08.953

我将支持色彩管理的投票，并询问所讨论的 JPEG 是否使用 Adob​​e 色彩空间而不是 SRGB？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-22T08:35:22.533

超过 72 dpi 的 CMYK 图片具有这种黄色外观

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T22:09:40.800

我怀疑，就像其他人所说的那样，这与 jpg 的颜色配置文件有关。可能是因为 FP10 有色彩管理，而 FP9 没有：

[http://www.adobe.com/devnet/flash/quickstart/color_correction_as3/](http://www.adobe.com/devnet/flash/quickstart/color_correction_as3/)

# javascript - 在两个不相关的 Web 应用程序之间拖放

> ID：799494
> 
> 赞同：2
> 
> 时间：2009-04-28T19:30:45.317
> 
> 标签：javascript, flash, web-applications, drag-and-drop

假设您有两个 Web 应用程序在浏览器的两个不同选项卡/窗口中运行。IE、Firefox 或 Google Chrome 中是否有预定义的接口在两个窗口之间传递数据？如果是这样，应该可以实现拖放，对吗？因为我不认为这是可能的，所以我想知道 Flash 是否可以实现相同的目标。

这总结了以下问题：是否可以使用 Javascript/DOM 或 Flash 实现跨应用程序拖放行为？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-28T19:33:14.890

我想您会在 Chrome 实验的[浏览器球中找到答案。](http://www.chromeexperiments.com/detail/browser-ball/)

简而言之，没有好的方法可以做到这一点——但你会发现这绝对是可能的。

编辑：我想我应该说清楚：您实际上可以在哪些内容和受支持的浏览器之间传递内容非常有限。看起来你实际上想要完成的事情可能是不可能的，但在多个窗口之间传递的一般概念是**“可能的”。**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T19:32:46.527

没有 Javascript 不能与另一个窗口交互。这是对浏览器的限制，也是 Javascript 在其域之外进行交互的限制。

据我所知，Flash 也无法做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T19:33:54.497

不，如果它们不相关（不同的域）则不是，这就是您的标题所暗示的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T19:43:38.857

如果您可以将拖放信息中继到服务器（不是一项简单的任务），则可以完成。

# xml - 对于初学者来说，JSON 的最佳资源是什么

> ID：799498
> 
> 赞同：2
> 
> 时间：2009-04-28T19:31:53.330
> 
> 标签：xml, json

我从来没有使用过 JSON 并且想要找到更多关于它的信息，因为人们一直将它称为更好的 XML 版本，用于从客户端向服务器发送数据。

有人可以推荐一个好的资源吗

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T19:35:18.283

[面向大众](http://www.dustindiaz.com/json-for-the-masses/)的 JSON 非常简单。

如果您了解 XML，您可以了解：

[http://json.org/](http://json.org/)

最后，但并非最不重要的，[资源清单](http://www.deitel.com/ResourceCenters/Programming/JSON/JSONArticles/tabid/2296/Default.aspx)和[维基百科](http://en.wikipedia.org/wiki/JSON)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T19:36:05.833

我能想到的最好的是：

www.json.org

请记住，JSON 和 XML 是不同的东西，正如该站点中链接的某些文章或文章中所解释的那样。

但如果只是为了发送数据，通常 JSON 比 XML 更紧凑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T19:36:36.470

JSON 很简单，[http://www.json.org/](http://www.json.org/)似乎是一个很好的指令。就是这样：

```
{
    "key1" : "value",
    "key2" : 123,
    "key3" : [
        1,
        2,
        3
    ],
    "key4" : {
        "key5" : "value",
        "key6" : "other value"
    }
} 
```

{ } 定义一个对象， [ ] 一个数组。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T19:37:17.687

[JSON](http://www.json.org/)

这真的是一个非常简单的概念。您有对象和数组，以及一些原始数据类型（字符串、数字、布尔值和 null）。

添加逗号、大括号和方括号。

我真的很喜欢它的简单性，如果需要的话，我可以很容易地为它编写自己的解析器，而无需太多麻烦（通常情况并非如此，因为那里有很多库）。

# c - 管理客户端进程分配的资源

> ID：799502
> 
> 赞同：1
> 
> 时间：2009-04-28T19:33:09.180
> 
> 标签：c, linux, resources, process

作为实验的一部分，我想为应用程序编写一个基于 OpenGL 的 UI 服务器，类似于架构中的 X11 或 Quartz：核心进程将对象呈现到单个视口中，但所有图形对象都由远程进程控制。

这个想法是视图稳定性仅取决于核心过程。如果客户端进程出现段错误，则其分配的资源将被安全地释放 - 该功能的要求是能够安全地找出客户端进程是否已崩溃。

这里的最佳做法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T11:11:53.180

我认为这应该被检测为与客户端连接的事件，就像任何其他客户端/服务器架构一样。

如果您使用套接字，套接字最终将注册一侧已关闭套接字（当进程崩溃时，套接字的末端将被关闭），您可以检测到这一点，在服务器的记录中查找拥有的客户端，然后清理所有资源。

服务器直接（通过进程 ID 或其他）查​​找客户端会非常奇怪，而且这也会不必要地限制您的架构仅在本地运行，而不是通过网络运行。

# git - 在 git 存储库中高效存储二进制文件

> ID：799507
> 
> 赞同：11
> 
> 时间：2009-04-28T19:33:43.640
> 
> 标签：git, file, binary, versioning

我想要一个主要由二进制文件组成的 git 存储库。

我需要跟踪存储库中更改、添加和删除的文件，但我不希望 git 对文件内容本身进行版本控制。

换句话说，我只需要 git 来跟踪更改（更改日志），而不是内容。

这甚至可以用git吗？

我应该为此使用其他东西吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-04-21T22:21:12.033

从@Tobu对这个[相关问题](https://stackoverflow.com/questions/104453/version-control-for-binaries)[的回答](https://stackoverflow.com/questions/104453/version-control-for-binaries#answer-4251015)中挖掘：

> 要版本和传播二进制文件而不实际将它们存储在 git 中，请尝试[git-annex](http://git-annex.branchable.com/)。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-28T19:37:42.133

git 是一个内容跟踪器，所以如果你不想跟踪内容，听起来它是适合这项工作的错误工具。不过，我不确定如何在不跟踪文件内容的情况下跟踪文件更改。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T20:04:26.547

如果您不想存储这些垃圾箱，那么您可以在文件上使用二进制差异工具，然后将输出提交到版本控制中。然后可以将任何文本更改日志条目输入到提交消息中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T08:46:22.440

也许我不明白您的问题，但是如果您将所有文件的时间戳存储在文本文件中怎么办？然后，您可以仅将该文件存储在版本控制中，并让您的 VCS 区分它的不同版本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-09T05:59:27.830

> 但我不希望 git 对文件本身的内容进行版本控制。

这正是[**Git 大文件存储 (LFS)**](https://github.com/blog/1986-announcing-git-large-file-storage-lfs)所做的事情（GitHub，2015 年 4 月）。

该项目是[**git-lfs**](https://github.com/github/git-lfs)（请参阅**[git-lfs.github.com](https://git-lfs.github.com/)**）并且经过测试并使用支持它的服务器：[**lfs-test-server**](https://github.com/github/lfs-test-server)：
您只能将元数据存储在 git repo 中，而将大文件存储在其他地方。

![https://cloud.githubusercontent.com/assets/1319791/7051226/c4570828-ddf4-11e4-87eb-8fc165e5ece4.gif](https://i.stack.imgur.com/BqONr.gif)

> *   大文件通过 HTTPS 单独同步到可配置的 Git LFS 服务器，因此您在推送 Git 存储库的位置不受限制。
>     
>     
> *   大文件仅在签出时从服务器同步，因此您的本地存储库在不需要时不会承载每个文件的每个版本的权重。
>     
>     
> *   存储在 Git 中的元数据可扩展以备将来使用。它目前包括文件内容的哈希值和文件大小，因此客户端可以在下载时显示进度条或选择退出大型下载。

# asp.net-mvc - 如何在 ASP.NET MVC 中模拟 Server.Transfer？

> ID：799511
> 
> 赞同：124
> 
> 时间：2009-04-28T19:34:48.520
> 
> 标签：asp.net-mvc, server.transfer

在 ASP.NET MVC 中，您可以很容易地返回重定向 ActionResult：

```
 return RedirectToAction("Index");

 or

 return RedirectToRoute(new { controller = "home", version = Math.Random() * 10 }); 
```

这实际上会给出一个 HTTP 重定向，这通常很好。然而，当使用谷歌分析时，这会导致很大的问题，因为原始推荐人丢失了，所以谷歌不知道你来自哪里。这会丢失有用的信息，例如任何搜索引擎术语。

附带说明一下，这种方法的优点是可以删除可能来自活动的任何参数，但仍然允许我在服务器端捕获它们。将它们留在查询字符串中会导致人们在书签、推特或博客中添加他们不应该的链接。我已经多次看到这种情况，人们在 Twitter 上发布了指向我们网站的包含活动 ID 的链接。

无论如何，我正在为网站的所有传入访问编写一个“网关”控制器，我可能会将其重定向到不同的地方或替代版本。

现在我现在更关心谷歌（而不是偶然的书签），我希望能够发送访问`/`页面的人，如果他们去的话，他们会得到的页面`/home/7`，这是主页的第 7 版。

就像我之前说的那样，如果我这样做，我将失去谷歌分析推荐人的能力：

```
 return RedirectToAction(new { controller = "home", version = 7 }); 
```

我真正想要的是一个

```
 return ServerTransferAction(new { controller = "home", version = 7 }); 
```

这将使我在没有客户端重定向的情况下获得该视图。不过，我不认为这样的事情存在。

目前我能想到的最好的办法是`HomeController.Index(..)`在我的`GatewayController.Index`Action 中复制整个控制器逻辑。这意味着我必须搬进`'Views/Home'`去`'Shared'`，这样它就可以使用了。一定会有更好的办法。

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2009-07-25T00:03:38.447

TransferResult 类怎么样？（基于[斯坦斯的回答](https://stackoverflow.com/questions/799511/how-to-simulate-server-transfer-in-asp-net-mvc/892545#892545)）

```
/// <summary>
/// Transfers execution to the supplied url.
/// </summary>
public class TransferResult : ActionResult
{
    public string Url { get; private set; }

    public TransferResult(string url)
    {
        this.Url = url;
    }

    public override void ExecuteResult(ControllerContext context)
    {
        if (context == null)
            throw new ArgumentNullException("context");

        var httpContext = HttpContext.Current;

        // MVC 3 running on IIS 7+
        if (HttpRuntime.UsingIntegratedPipeline)
        {
            httpContext.Server.TransferRequest(this.Url, true);
        }
        else
        {
            // Pre MVC 3
            httpContext.RewritePath(this.Url, false);

            IHttpHandler httpHandler = new MvcHttpHandler();
            httpHandler.ProcessRequest(httpContext);
        }
    }
} 
```

**更新：**现在可与 MVC3 一起使用（使用[Simon 帖子中的](https://stackoverflow.com/questions/799511/how-to-simulate-server-transfer-in-asp-net-mvc/1242525#1242525)代码）。通过查看它是否在 IIS7+ 的集成管道中运行，它*应该*（尚未能够对其进行测试）也可以在 MVC2 中工作。

完全透明；在我们的生产环境中，我们从未直接使用 TransferResult。我们使用一个 TransferToRouteResult，它反过来调用执行 TransferResult。这是我的生产服务器上实际运行的内容。

```
public class TransferToRouteResult : ActionResult
{
    public string RouteName { get;set; }
    public RouteValueDictionary RouteValues { get; set; }

    public TransferToRouteResult(RouteValueDictionary routeValues)
        : this(null, routeValues)
    {
    }

    public TransferToRouteResult(string routeName, RouteValueDictionary routeValues)
    {
        this.RouteName = routeName ?? string.Empty;
        this.RouteValues = routeValues ?? new RouteValueDictionary();
    }

    public override void ExecuteResult(ControllerContext context)
    {
        if (context == null)
            throw new ArgumentNullException("context");

        var urlHelper = new UrlHelper(context.RequestContext);
        var url = urlHelper.RouteUrl(this.RouteName, this.RouteValues);

        var actualResult = new TransferResult(url);
        actualResult.ExecuteResult(context);
    }
} 
```

如果您使用的是[T4MVC](http://mvccontrib.codeplex.com/wikipage?title=T4MVC)（如果不是...做！）这个扩展可能会派上用场。

```
public static class ControllerExtensions
{
    public static TransferToRouteResult TransferToAction(this Controller controller, ActionResult result)
    {
        return new TransferToRouteResult(result.GetRouteValueDictionary());
    }
} 
```

使用这个小宝石你可以做到

```
// in an action method
TransferToAction(MVC.Error.Index()); 
```

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-08-07T01:57:33.317

**编辑：更新为与 ASP.NET MVC 3 兼容**

如果您使用的是 IIS7，则以下修改似乎适用于 ASP.NET MVC 3。感谢 @nitin 和 @andy 指出原始代码不起作用。

**编辑 4/11/2011：TempData 从 MVC 3 RTM 开始与 Server.TransferRequest 中断**

修改了下面的代码以引发异常 - 但目前没有其他解决方案。

* * *

这是我根据 Markus 对 Stan 原帖的修改版本所做的修改。我添加了一个额外的构造函数来获取一个路由值字典 - 并将其重命名为 MVCTransferResult 以避免混淆它可能只是一个重定向。

我现在可以为重定向执行以下操作：

```
return new MVCTransferResult(new {controller = "home", action = "something" }); 
```

我修改后的课程：

```
public class MVCTransferResult : RedirectResult
{
    public MVCTransferResult(string url)
        : base(url)
    {
    }

    public MVCTransferResult(object routeValues):base(GetRouteURL(routeValues))
    {
    }

    private static string GetRouteURL(object routeValues)
    {
        UrlHelper url = new UrlHelper(new RequestContext(new HttpContextWrapper(HttpContext.Current), new RouteData()), RouteTable.Routes);
        return url.RouteUrl(routeValues);
    }

    public override void ExecuteResult(ControllerContext context)
    {
        var httpContext = HttpContext.Current;

        // ASP.NET MVC 3.0
        if (context.Controller.TempData != null && 
            context.Controller.TempData.Count() > 0)
        {
            throw new ApplicationException("TempData won't work with Server.TransferRequest!");
        }

        httpContext.Server.TransferRequest(Url, true); // change to false to pass query string parameters if you have already processed them

        // ASP.NET MVC 2.0
        //httpContext.RewritePath(Url, false);
        //IHttpHandler httpHandler = new MvcHttpHandler();
        //httpHandler.ProcessRequest(HttpContext.Current);
    }
} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-09-17T21:09:29.597

You can use **Server.TransferRequest** on IIS7+ instead.

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-05-21T11:50:20.143

我最近发现 ASP.NET MVC 不支持 Server.Transfer() 所以我创建了一个存根方法（受 Default.aspx.cs 启发）。

```
 private void Transfer(string url)
    {
        // Create URI builder
        var uriBuilder = new UriBuilder(Request.Url.Scheme, Request.Url.Host, Request.Url.Port, Request.ApplicationPath);
        // Add destination URI
        uriBuilder.Path += url;
        // Because UriBuilder escapes URI decode before passing as an argument
        string path = Server.UrlDecode(uriBuilder.Uri.PathAndQuery);
        // Rewrite path
        HttpContext.Current.RewritePath(path, false);
        IHttpHandler httpHandler = new MvcHttpHandler();
        // Process request
        httpHandler.ProcessRequest(HttpContext.Current);
    } 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-28T19:42:17.317

难道你不能只创建一个你想重定向到的控制器实例，调用你想要的操作方法，然后返回结果吗？就像是：

```
 HomeController controller = new HomeController();
 return controller.Index(); 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2014-01-03T21:49:04.100

MVC 仍然能够实际执行[Server.TransferRequest](https://msdn.microsoft.com/en-us/library/aa344901(v=vs.110).aspx) ，而不是模拟服务器传输：

```
public ActionResult Whatever()
{
    string url = //...
    Request.RequestContext.HttpContext.Server.TransferRequest(url);
    return Content("success");//Doesn't actually get returned
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-10-18T10:43:02.207

我想将当前请求重新路由到另一个控制器/动作，同时保持执行路径与请求第二个控制器/动作完全相同。就我而言， Server.Request 不起作用，因为我想添加更多数据。这实际上等效于当前处理程序执行另一个 HTTP GET/POST，然后将结果流式传输到客户端。我相信会有更好的方法来实现这一点，但这对我有用：

```
RouteData routeData = new RouteData();
routeData.Values.Add("controller", "Public");
routeData.Values.Add("action", "ErrorInternal");
routeData.Values.Add("Exception", filterContext.Exception);

var context = new HttpContextWrapper(System.Web.HttpContext.Current);
var request = new RequestContext(context, routeData);

IController controller = ControllerBuilder.Current.GetControllerFactory().CreateController(filterContext.RequestContext, "Public");
controller.Execute(request); 
```

你的猜测是对的：我把这段代码放在

```
public class RedirectOnErrorAttribute : ActionFilterAttribute, IExceptionFilter 
```

我正在使用它向开发人员显示错误，同时它将在生产中使用常规重定向。请注意，我不想使用 ASP.NET 会话、数据库或其他方式在请求之间传递异常数据。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-04-28T19:42:23.523

只需实例化另一个控制器并执行它的操作方法。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-28T19:47:48.287

您可以新建另一个控制器并调用返回结果的操作方法。但是，这将要求您将视图放入共享文件夹中。

我不确定这是否是您所说的重复，但是：

```
return new HomeController().Index(); 
```

**编辑**

另一种选择可能是创建自己的 ControllerFactory，这样您就可以确定要创建的控制器。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-01-20T14:59:28.613

`Server.TransferRequest`在 MVC中**完全没有必要**。这是一个过时的功能，仅在 ASP.NET 中才需要，因为请求直接到达一个页面，并且需要有一种方法将请求传输到另一个页面。现代版本的 ASP.NET（包括 MVC）有一个路由基础结构，可以自定义以*直接*路由到所需的资源。当您可以简单地将请求直接发送到您想要的控制器和操作时，让请求到达控制器只是将其传输到另一个控制器是没有意义的。

更重要的是，由于您正在响应*原始*请求，因此无需`TempData`为了将请求路由到正确的位置而将任何东西放入或其他存储中。相反，您会在原始请求完好无损的情况下到达控制器操作。您也可以放心，Google 会批准这种方法，因为它完全发生在服务器端。

虽然您可以从`IRouteConstraint`和做很多事情`IRouteHandler`，但最强大的路由扩展点是`RouteBase`子类。可以扩展此类以提供传入路由和传出 URL 生成，这使其成为与 URL 和 URL 执行的操作有关的所有事情的一站式商店。

因此，按照您的第二个示例，要从`/`to获取`/home/7`，您只需要一个添加适当路由值的路由。

```
public class RouteConfig
{
    public static void RegisterRoutes(RouteCollection routes)
    {
        routes.IgnoreRoute("{resource}.axd/{*pathInfo}");

        // Routes directy to `/home/7`
        routes.MapRoute(
            name: "Home7",
            url: "",
            defaults: new { controller = "Home", action = "Index", version = 7 }
        );

        routes.MapRoute(
            name: "Default",
            url: "{controller}/{action}/{id}",
            defaults: new { controller = "Home", action = "Index", id = UrlParameter.Optional }
        );
    }
} 
```

但是回到你有一个随机页面的原始示例，它更复杂，因为路由参数在运行时不能改变。所以，它可以用一个`RouteBase`子类来完成，如下所示。

```
public class RandomHomePageRoute : RouteBase
{
    private Random random = new Random();

    public override RouteData GetRouteData(HttpContextBase httpContext)
    {
        RouteData result = null;

        // Only handle the home page route
        if (httpContext.Request.Path == "/")
        {
            result = new RouteData(this, new MvcRouteHandler());

            result.Values["controller"] = "Home";
            result.Values["action"] = "Index";
            result.Values["version"] = random.Next(10) + 1; // Picks a random number from 1 to 10
        }

        // If this isn't the home page route, this should return null
        // which instructs routing to try the next route in the route table.
        return result;
    }

    public override VirtualPathData GetVirtualPath(RequestContext requestContext, RouteValueDictionary values)
    {
        var controller = Convert.ToString(values["controller"]);
        var action = Convert.ToString(values["action"]);

        if (controller.Equals("Home", StringComparison.OrdinalIgnoreCase) &&
            action.Equals("Index", StringComparison.OrdinalIgnoreCase))
        {
            // Route to the Home page URL
            return new VirtualPathData(this, "");
        }

        return null;
    }
} 
```

可以在路由中注册，例如：

```
public class RouteConfig
{
    public static void RegisterRoutes(RouteCollection routes)
    {
        routes.IgnoreRoute("{resource}.axd/{*pathInfo}");

        // Routes to /home/{version} where version is randomly from 1-10
        routes.Add(new RandomHomePageRoute());

        routes.MapRoute(
            name: "Default",
            url: "{controller}/{action}/{id}",
            defaults: new { controller = "Home", action = "Index", id = UrlParameter.Optional }
        );
    }
} 
```

请注意，在上面的示例中，还可以存储一个 cookie 记录用户进入的主页版本，这样当他们返回时，他们会收到相同的主页版本。

另请注意，使用这种方法，您可以自定义路由以考虑查询字符串参数（默认情况下完全忽略它们）并相应地路由到适当的控制器操作。

### 其他示例

*   [https://stackoverflow.com/a/31958586](https://stackoverflow.com/a/31958586)
*   [https://stackoverflow.com/a/36774498](https://stackoverflow.com/a/36774498)
*   [https://stackoverflow.com/a/36168395](https://stackoverflow.com/a/36168395)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-28T19:40:20.473

路由不只是为您处理这种情况吗？即对于上述场景，您可以只创建一个实现此逻辑的路由处理程序。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-10-18T17:43:02.637

对于使用基于表达式的路由的任何人，只使用上面的 TransferResult 类，这里有一个控制器扩展方法可以解决问题并保留 TempData。不需要 TransferToRouteResult。

```
public static ActionResult TransferRequest<T>(this Controller controller, Expression<Action<T>> action)
    where T : Controller
{
     controller.TempData.Keep();
     controller.TempData.Save(controller.ControllerContext, controller.TempDataProvider);
     var url = LinkBuilder.BuildUrlFromExpression(controller.Request.RequestContext, RouteTable.Routes, action);
     return new TransferResult(url);
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-12-29T17:15:58.143

本身不是一个答案，但很明显，不仅要求实际导航“执行”Webforms Server.Transfer() 的等效功能，而且还要求在单元测试中完全支持所有这些。

因此，ServerTransferResult 应该“看起来”像 RedirectToRouteResult，并且在类层次结构方面尽可能相似。

我正在考虑通过查看 Reflector 来做到这一点，并做任何 RedirectToRouteResult 类以及各种 Controller 基类方法所做的事情，然后通过扩展方法将后者“添加”到 Controller 中。也许这些可能是同一类中的静态方法，以便于下载/懒惰？

如果我能做到这一点，我会把它贴出来，否则也许其他人可能会打败我！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-03-06T17:56:43.177

我通过在视图中利用`Html.RenderAction`助手实现了这一点：

```
@{
    string action = ViewBag.ActionName;
    string controller = ViewBag.ControllerName;
    object routeValues = ViewBag.RouteValues;
    Html.RenderAction(action, controller, routeValues);
} 
```

在我的控制器中：

```
public ActionResult MyAction(....)
{
    var routeValues = HttpContext.Request.RequestContext.RouteData.Values;    
    ViewBag.ActionName = "myaction";
    ViewBag.ControllerName = "mycontroller";
    ViewBag.RouteValues = routeValues;    
    return PartialView("_AjaxRedirect");
} 
```

# svn - 将所有项目放在同一个主干中是个好主意吗？

> ID：799520
> 
> 赞同：5
> 
> 时间：2009-04-28T19:38:12.223
> 
> 标签：svn, project-organization

我们理解默认和通常推荐的 svn 存储库组织，如果有多个项目，是这样的：

```
root/projectA/(trunk, branches, tags)
root/projectB/(trunk, branches, tags)
... 
```

我们的项目有很多相互依赖，这需要在它们之间广泛使用**svn:externals**，考虑到我们不做 dll 引用内部项目，我们更愿意查看它们的源代码而不是使用二进制文件。

过多地使用外部，在分支存储库、同步更改时，可能会变得复杂且容易出错，因此团队根本不信任这个解决方案。

因此，一位团队成员提出了一些我们都认为这可能是更好的解决方案：**将所有项目放在同一个主干中。**

起初，我们认识到这种方法存在一些问题，但总的来说，我们同意这些问题是基于我们很可能从未经历过的假设情况。

**您是否看到我们在使用此解决方案时可能遇到的一些严重问题？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-28T19:39:49.943

我们在公司这样做，并取得了很大的成功。

我们有 3 个顶级目录：

*   标签
*   分支机构
*   树干

然后我们将每个项目作为这些项目的子目录。

尽管如此，我们仍然在项目级别进行分支，并且仍然使用 svn:externals。但是如果我们有一个较小的源树，我们会在主干级别分支而不使用 svn:extenrals。

能够将所有项目的主干放在同一个地方真是太好了。你可以备份它，你可以检查它，你可以把所有最新的东西放在一起。您不会丢失所有分支的单个位置，也不会丢失所有标签的单个位置，因为它们都位于 /branches/projectX 和 /tags/projectX 的子目录中

**svn:externals 的问题：**

如果您的项目不是非常庞大，那么您可以每次只分支整个主干，并避免 svn:externals 的所有问题。

svn:externals 的问题在于，当你创建一个分支时，它不会自动为你的每个 svn:externals 创建一个分支。这是一个问题，因为随着时间的推移，随着主干的更新，所有旧分支都将无法编译。另一个问题是，如果您在任何分支中对 svn:external 进行修复，所有其他分支都会中断。

svn externals 的另一个问题是，当您在根级别执行 svn:log 时，您看不到 svn externals 的任何更改。

希望有一天 svn externals 能够解决上述问题，但在那一天之前，分支和 svn:externals 绝对是一场噩梦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T20:45:41.610

to "putting all projects into same trunk":

From my experience this is no good idea - because each project has it's own history and changes and often projects are/will be maintained by different developers. This can lead to conflicts - even if you state out, that currently the projects interfere heavily.

So why don't you use common tags (with milestones as names to) for all of your projects to ensure a same code base and a build script, which can check out the projects (trunks) automagically? It's more work, but like usual in OOP (capsulation) I would prefer to split the projects into separate SVN directories, too.

But: Collecting a bunch of small libs and apps into a common directory under the same trunk is no problem (see "apps" and "tools" in my example below) - so maybe "small projects" can stay in the shared/big trunk.

Here as example my directory structure of SVN:

```
/projects/
/projects/CustomerA/
/projects/CustomerA/ProjectX/
/projects/CustomerA/ProjectX/trunk/
/projects/CustomerA/ProjectX/tags/
/projects/CustomerA/ProjectX/branches/
/thirdparty/
/thirdparty/ExtLibY/
/thirdparty/ExtLibZ/
/tools/
/tools/trunk/
/tools/tags/
/tools/branches/
/apps/
/apps/trunk/
/apps/tags/
/apps/branches/ 
```

So all of the external stuff is stored in /thirdparty/ and all internals (projects, tools, apps) have the subdirs:

```
/trunk/
/tags/    
/branches/ 
```

...like advised in the Subversion book and the previous post.

Even if that looks a little bit much efforts at first sight - it is really worth it, especially when your code base grows.

ciao, Chris

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T23:52:46.730

> 您是否看到我们在使用此解决方案时可能遇到的一些严重问题？

*   **只要您可以将所有内容放在一个存储库中，您的解决方案就可以工作。**

    这意味着在可预见的未来，整个存储库必须适合单个磁盘（或存储池）。类似的考虑适用于其他服务器资源，例如网络和磁盘 I/O 带宽。

    稍后拆分存储库将需要对整个设置进行大修，并且当您需要重建或分支旧版本时可能会令人头疼。

*   **仅当您不需要限制每个用户的读/写权限时，您的解决方案才有效**

    如果您需要授予 projectA 的读/写权限，您实际上必须授予 /trunk/projectA、/branch1/projectA 和 /branch2/projectA 等的权限。

    然后分支成为一个需要大量权限调整的重量级过程。告别[特色分支](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.commonpatterns.html#svn.branchmerge.commonpatterns.feature)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T19:53:28.897

你所做的就是我在我公司设置的，在 svnbook 主题[Strategies for Repository Deployment](http://svnbook.red-bean.com/en/1.5/svn.reposadmin.planning.html#svn.reposadmin.projects.chooselayout)中也被称为“非常常见的布局” 。

它没有错。

# html - 使用 vim 进行 html 装饰

> ID：799530
> 
> 赞同：0
> 
> 时间：2009-04-28T19:41:40.780
> 
> 标签：html, vim, tags

你有什么首选的方法来管理 vim 中的 html 格式化标签吗？

我想出的最好的方法是创建一些宏来在当前光标位置插入标签 - ctrl-i 用于 <i>，ctrl-j 用于 </i> 等。

例如，能够说 2w{something} 将 2 个单词变为斜体会很方便，而无需将光标导航到终点。我能想到的最好的选择是让我使用相同的击键来灵活地删除可能是字数、正则表达式匹配等但会插入开始和结束标签的文本字符串。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T20:05:19.710

看一下[surround.vim](http://www.vim.org/scripts/script.php?script_id=1697)插件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T23:22:17.193

当我必须传输原始 HTML 时，我使用 Christian Robinson 的[HTML 宏。](https://christianrobinson.name/vim/HTML/)

一般来说，我更喜欢使用[reStructuredText](http://docutils.sourceforge.net/rst.html)并生成 HTML。

# visual-studio-2008 - vs2008的线程窗口在哪里

> ID：799544
> 
> 赞同：3
> 
> 时间：2009-04-28T19:44:44.237
> 
> 标签：visual-studio-2008, ide

我试图在[此处](http://www.wintellect.com/cs/blogs/jrobbins/archive/2007/08/01/neat-new-multithreaded-debugging-features-in-vs-2008.aspx)和[此处](http://www.hanselman.com/blog/MultithreadedDebuggingInVisualStudio2008.aspx)描述的 VS 2008 中找到线程窗口，但我无法在任何地方找到它。我查看了 View 并没有看到任何类似的东西。这似乎非常有用。谢谢你的帮助

编辑：是的，我正在调试编辑：谢谢，我找到了！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T19:47:39.347

你*在*调试，对吧？否则不会显示。此外，它可能与其他一些窗口一起停靠，因此请检查它是否未嵌入某个选项卡中。菜单是Debug->Windows->Threads。它为我列出了 Ctrl - Alt - H 的快捷方式，但我不确定这是否取决于您选择的键绑定集。

# c - 部分乘法或包装乘法 - 任何人都可以识别此功能吗？

> ID：799549
> 
> 赞同：3
> 
> 时间：2009-04-28T19:45:57.777
> 
> 标签：c, algorithm, math, puzzle

我希望深入了解看起来像部分乘法的东西。

```
#define LOW(x)  ((x)&0xffffffff)
#define HIGH(x) ((x)>>32)
unsigned long long NotMultiply(unsigned long long x, unsigned long long y)
{
    return  HIGH(x)*HIGH(y) + LOW(x)*LOW(y);
} 
```

该函数迭代多次，如下：

```
unsigned long long DoBusyWork( unsigned long long x, unsigned long long y, int n)
{
     while (n--) 
          x = NotMultiply(x,y); 
     return x;
} 
```

有没有计算这个结果的捷径？
对于 x == y 的情况呢？

任何指向更多信息的链接都会有所帮助..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T01:01:29.997

DoBusyWork（正如@RBerteig 所建议的那样，名称是一个危险信号）可能是一种强制编译器不优化繁忙循环的方法。

这些该死的编译器变得如此聪明，以至于有时他们会决定，“哦！你不需要循环！我知道你要计算什么了！” 尽管您作为程序员真正感兴趣。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T19:59:03.873

看起来像一个奇怪的哈希计算。它取两个数字的低 32 位，将它们相乘，取高 32 位（将它们移到低位）并将它们相乘，然后返回它的总和。

我不认为你可以让它更简单，但可能更快。如果它再次返回相同的值，您可以中断 while 循环。

```
unsigned long long DoBusyWork( unsigned long long x, unsigned long long y, int n)
{
     long long previousX = x;
     while (n--) 
     {
          x = NotMultiply(x,y); 
          if (x == previousX) break;
          previousX = x;
     }
     return x;
} 
```

我不知道是否有很大的机会提前完成循环。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T20:58:07.610

这是随机数生成器的早期形式，通常用于小型计算机和小型大型机。调用可能如下所示：

```
unsigned long long seedold = 0xA5A5A5A5A5A5A5A5;
unsigned long long seednew = 0X5A5A5A5A5A5A5A5A;
unsigned long long lltmp;
int finetune; 
```

通过定时键盘或一些类似的真正随机`finetune`但缓慢的方法来随机化，然后像这样调用一次：

```
lltmp = DoBusyWork( seedold, seednew, finetune );
seedold = seednew;
seednew = lltmp; 
```

随后通过这样调用它作为 PRNG 使用它：

```
lltmp = DoBusyWork( seedold, seednew, 1 );
seedold = seednew;
seednew = lltmp; 
```

使用 seednew 作为 PRN。

Von Neumann 曾经提倡将这种计算用于“Monte-Carlo”测试应用程序，但后来当他了解更多关于分析 PRNG 的输出时改变了主意。

-阿尔。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T19:52:59.177

LOW 试图只取低 32 位。High 将接下来的 32 位向下移动 32 位。整个 NotMultiply 例程试图将 x 和 y 的底部 32 位相乘，并将它们添加到顶部 32 位。DoBusyWork 做了*n*次。

如果 x==y，则得到 HIGH(x)²+LOW(x)²。

不过，我不知道他们为什么要这样做。这有点像将 x 和 y 的上半部分和下半部分混合在一起。

# css - HTML/ASP.NET 中的 CSS 多列表单

> ID：799552
> 
> 赞同：12
> 
> 时间：2009-04-28T19:47:42.450
> 
> 标签：css, forms

我已经研究了几个小时，但仍然没有找到一个健壮的、非绝对定位的解决方案，可以在不使用 TABLE 标签的情况下显示多列表单和值。

有人可以向我指出一个专门用于将 CSS 中基于表格的多列表单（如名称和地址表单）复制到标准的资源吗？

我看到的大多数表单只有一个包含字段/值的列。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-28T19:52:05.687

这些是我最常使用的：

*   [更漂亮的可访问表格](http://www.alistapart.com/articles/prettyaccessibleforms)
*   [40 多种 CSS/JS 表单样式技术](http://www.noupe.com/css/form-elements-40-cssjs-styling-and-functionality-techniques.html)
*   [47+ 种优秀的 AJAX CSS 表单](http://www.noupe.com/css/47-excellent-ajax-css-forms.html)
*   [基于 CSS 的表单：现代解决方案](http://www.smashingmagazine.com/2006/11/11/css-based-forms-modern-solutions/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T20:02:40.917

我没有找到一种**干净**的方法来使用在大多数主要浏览器中都可以正常工作的 CSS 进行此操作，我怀疑它是否存在。大多数“解决方案”使用黑客和“修复”来解决当前缺乏对这种布局的支持。虽然基于表格的布局有其缺点，但它是您可能想要实现的最简洁的解决方案。

如果您需要“表格布局”，只需使用表格即可。

# java - 在 Java 中压缩目录会影响使用相同文件的其他进程吗？

> ID：799554
> 
> 赞同：1
> 
> 时间：2009-04-28T19:49:08.203
> 
> 标签：java, multithreading, zip

我正在使用 java.util.zip 库和 ZipOutputStream 来创建目录的 zip 文件及其下的所有文件和目录。在我的应用程序中，另一个线程可能会在压缩期间访问这些相同的文件。我不是文件压缩（或线程安全，就此而言）的专家，所以我的问题是，**在其他东西访问这些文件时压缩目录会影响任一进程吗？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T19:51:22.940

仅当进程以阻止其他进程读取访问的方式打开文件时。（这通常需要特定于操作系统的标志来指定权限。）所以这当然是可能的，但这不是常见的情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T19:54:37.240

假设您在 Windows 上运行，并且您的并发访问是只读的，那么我希望压缩过程不会影响任何事情。

有关 Java 文件锁定的详细方法，请参阅[JDC 技术提示](http://java.sun.com/developer/JDCTechTips/2002/tt0924.html)。

# c# - 尝试在 C# 中使用 INATExternalIPAddressCallback 获取 NAT 的外部 IPAddress

> ID：799557
> 
> 赞同：3
> 
> 时间：2009-04-28T19:49:53.820
> 
> 标签：c#, nat, upnp

如何使用 windows 库获取 NAT 的外部 IP 地址？我正在尝试查找有关 INATExternalIPAddressCallback 的任何信息，但仅在 C++ 中找到了一个使用不可用 C# 接口的示例。任何指导将不胜感激。

-卡尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-04T13:14:12.580

抱歉，我没有使用 Windows 中使用 UPNP 服务的现有 API 来回答，但它可能会对您有所帮助

你也可以在互联网上使用 STUN 服务器，有很多开放的，每个 VOIP 提供商都有一个。 [http://en.wikipedia.org/wiki/STUN](http://en.wikipedia.org/wiki/STUN) [https://www.rfc-editor.org/rfc/rfc3489](https://www.rfc-editor.org/rfc/rfc3489)

例如，打开一个 UDP 套接字，在 3478 端口上连接到 stun.gmx.net 并发送一个这样的包：

```
using System;
using System.Net;
using System.Collections.Generic;
using System.Text;
using System.Security.Cryptography;

namespace xxx
{
class STUNPacket
{
    static RNGCryptoServiceProvider m_rand=new RNGCryptoServiceProvider();

    private byte[] m_requestid=new byte[16];

    public STUNPacket()
    {
        m_rand.GetBytes(m_requestid);
    }

    public byte[] CreateRequest()
    {
        byte[] packet=new byte[0x1c] {
            //Header:
            0x00,0x01,      //Art des STUN-Pakets: 0x0001=Binding Request
            0x00,0x08,      //Länge des Pakets ohne Header
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,    //Transkations-ID
            //Message-Attribute:
            0x00,0x03,      //Typ: Change-Request
            0x00,0x04,      //Länge: 4 Bytes
            0x00,0x00,0x00,0x00 //Weder IP, noch Port ändern
        };

        for(int i=0;i<16;i++)
            packet[i+4]=m_requestid[i];

        return packet;
    }

    public IPEndPoint ParseResponse(byte[] paket)
    {
        if (paket.Length<20)
            throw new Exception("STUN-Response zu kurz, um einen Header zu haben");
        if (paket[0]!=1||paket[1]!=1)
            throw new Exception("STUN-Reposne hat falschen Typ, muss Binding-Response sein");
        for (int i=0;i<16;i++)
            if (paket[i+4]!=m_requestid[i])
                throw new Exception("STUN-Antwort hat falsche Transkations-ID");
        int size=paket[2]*256+paket[3];
        int pos=20;
        for(;;)
        {
            if (size<4)
                throw new Exception("Verbleibende Nachricht zu kurz für weiteren Attributheader, "+
                    "Mapped-Adress-Attribut nicht gefunden");
            int attrsize=paket[pos+2]*256+paket[pos+3];
            if (pos+4+attrsize>paket.Length)
                throw new Exception("Attributheader hat Länge, die nicht mehr ins Paket passt");
            //Wenn kein Mapped-Adress-Attribut, dann überspringen
            if (paket[pos]!=0||paket[pos+1]!=1)
            {
                pos+=attrsize;
                continue;
            }
            if (attrsize<8)
                throw new Exception("Mapped-Adress-Attribut ist zu kurz");
            if (paket[pos+5]!=1)
                throw new Exception("Adreßfamilie von Mapped-Adress ist nicht IPV4");
            int port=paket[pos+6]*256+paket[pos+7];
            IPAddress adress=new IPAddress(new byte[4] { paket[pos+8],paket[pos+9],paket[pos+10],paket[pos+11] });
            return new IPEndPoint(adress,port);
        }
    }

} 
```

}

ParseResponse 返回的 IP 地址应该是你的 ip 地址，就像外界看到的一样。

**请注意，如果没有 Internet 服务器的帮助或直接通过服务器上的 upnp，将无法获取您的外部 IP**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T22:47:15.467

在 CodeProject 上，harold aptroot 的以下文章描述了您想要做什么：

在 C# 中使用 UPnP 进行 NAT 遍历，无需任何库。 [http://www.codeproject.com/KB/IP/upnpnattraversal.aspx](http://www.codeproject.com/KB/IP/upnpnattraversal.aspx)

当然，这仅在您的路由器支持 UPnP 时才有效。

来自 MSDN—— http: [//msdn.microsoft.com/en-us/library/aa365074](http://msdn.microsoft.com/en-us/library/aa365074(VS.85).aspx) (VS.85).aspx ：

INATExternalIPAddressCallback 接口由具有 UPnP 技术的 NAT 应用程序实现。**它提供了一个方法，如果 NAT 计算机的外部 IP 地址发生变化**，系统调用该方法。

您是尝试获取一次外部 IP 地址，还是希望在它发生更改时收到通知。如果您只想获取当前的外部 IP 地址，则不需要为 INATExternalIPAddressCallback 实现回调

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-18T19:15:24.907

NAT 背后的系统不知道它是“真实”IP。事实上，就操作系统而言，它与任何其他操作系统一样拥有 IP。它只是路由到定义的网关，而不必担心细节。配置的 IP 不是广播地址（10.whatever、192.168.whatever）这一事实对操作系统来说并不重要。

获取外部 IP 的唯一方法是查询一些外部系统。它可能是您的 UPnP 路由器（理论上，它可能会返回另一个非广播地址），也可能是互联网上的某个外部服务器（例如，这个“STUN”的东西）。

如果是我，我只会在我的网站上托管我自己的服务。您可以在大多数支持 PHP 的网站上抛出一个简单的 php 脚本：

`<?php echo $REMOTE_ADDR; >`

这将回退客户端的 IP 地址。接下来，您必须编写客户端代码来获取该脚本的结果（在 C# 中相当容易）。

# c++ - 通过解析纯文本文件生成数据结构

> ID：799558
> 
> 赞同：7
> 
> 时间：2009-04-28T19:51:09.760
> 
> 标签：c++, parsing, fileparsing

我为正在编写的游戏编写了一个文件解析器，以便我自己轻松更改游戏的各个方面（例如角色/阶段/碰撞数据）。例如，我可能有一个这样的字符类：

```
class Character
{
public:
    int x, y; // Character's location
    Character* teammate;
} 
```

我设置我的解析器从文件中读取具有类似于 C++ 语法的数据结构

```
Character Sidekick
{
    X = 12
    Y = 0
}

Character AwesomeDude
{
    X = 10
    Y = 50
    Teammate = Sidekick
} 
```

这将创建两个数据结构并将它们放在一个 map`<std::string, Character*>`中，其中键字符串是我给它的任何名称（在本例中为 Sidekick 和 AwesomeDude）。当我的解析器看到一个指向类的指针时，比如队友指针，它足够聪明，可以在地图中查找以获取指向该数据结构的指针。问题是我不能将 Sidekick 的队友声明为 AwesomeDude，因为它还没有被放置到 Character map 中。

我正在尝试找到解决此问题的最佳方法，以便我可以让我的数据结构引用尚未添加到地图中的对象。我能想到的两个最简单的解决方案是（a）添加转发声明数据结构的能力或（b）让解析器读取文件两次，一次是用指向空数据结构的指针填充映射，第二次是通过并填写它们。

(a) 的问题是我还可以决定在类上调用哪个构造函数，如果我转发声明某些内容，我必须让构造函数与其余数据分开，这可能会造成混淆。(b) 的问题是我可能想在他们自己的文件中声明 Sidekick 和 AwesomeDude。我必须让我的解析器能够读取一个文件列表，而不是一次读取一个文件（我猜这还不错，尽管有时我可能想从一个文件中读取一个文件列表文件）。(b) 还有一个缺点，就是不能使用稍后在构造函数本身中声明的数据结构，但我认为这没什么大不了的。

哪种方式听起来更好？有没有我没有想到的第三种选择？似乎应该通过指针引用或绑定或其他东西来解决这个问题...... :-/ 我想这有点主观，基于我想给自己的功能，但欢迎任何输入。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-28T19:58:42.020

当您第一次遇到引用时，只需将其存储为引用即可。然后，您可以将字符、引用或其他任何内容放在“需要稍后解决的引用”列表中。

文件完成后，遍历那些有引用并解决它们的文件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-28T20:22:13.757

好吧，你要求第三种选择。您不必使用 XML，但如果遵循以下结构，则使用 SAX 解析器构建数据结构将非常简单。

无论如何，每个角色都不是引用队友，而是引用一个团队（在这种情况下为蓝队）。这将解耦循环引用问题。只要确保在角色之前列出团队即可。

```
<team>Blue</team>

<character>
    <name>Sidekick</name>
    <X>12</X>
    <Y>0</Y>
    <teamref>Blue</teamref>
</character>

<character>
    <name>Sidekick</name>
    <X>10</X>
    <Y>50</Y>
    <teamref>Blue</teamref>
</character> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T20:03:27.843

就个人而言，我会选择b）。将您的代码拆分为 Parser 和 Validator 类，它们都在相同的数据结构上运行。Parser 将读取并解析一个文件，填充数据结构并将任何对象引用存储为它们的文本名称，暂时将真实指针保留在您的结构中。

加载完文件后，使用 Validator 类来验证和解析任何引用，填充“真实”指针。您将需要考虑如何构建数据以使这些查找变得又快又好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T20:02:14.617

威尔准确地说出了我要写的东西。只需保留未解决的引用列表或其他内容。

并且一旦你读完文件，如果有未解决的引用，不要忘记抛出一个错误 =P

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T20:44:03.517

不要在地图中存储 Character 对象，而是存储 Character 的代理。然后，代理将在加载对象时包含指向实际 Character 对象的指针。Character::teammate 的类型将更改为此代理类型。当您阅读地图中尚未包含的参考资料时，您将创建一个代理并使用该代理。当您加载地图中已有空代理的角色时，使用新加载的角色填充它。您可能还想添加一个计数器来跟踪您在地图中有多少个空代理，以便您知道何时加载了所有引用的字符。

另一层间接......它总是使编程更容易和更慢。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T22:47:13.237

一种选择是撤销该义务。Map负责填写参考

```
template<T> class SymbolMap // I never could rememeber C++ template syntax
{
   ...

   /// fill in target with thing name
   /// if no name yet, add it to the list of thing that will be name
   void Set(T& target, std::string name);

   /// define name as target
   /// go back and fill in anything that needs to be name
   void Define(T target, std::string name);

   /// make sure everything is resolved
   ~SymbolMap()
} 
```

这不会与价值/移动语义很好地交互，但我怀疑不会有太多。

# winapi - WTSRegisterSessionNotification 有时在 XP 主页启动时不起作用

> ID：799563
> 
> 赞同：2
> 
> 时间：2009-04-28T19:51:47.887
> 
> 标签：winapi, windows-xp, startup

我正在使用该功能/消息来检查工作站是否被锁定。现在我的应用程序位于启动文件夹中。它在 XP pro 上运行没有任何问题，但由于我在 XP 主页上使用该程序 WTSRegisterSessionNotification 在启动时大约 50% 的时间失败，但在系统已经启动时它永远不会失败。知道为什么会发生这种情况吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T19:59:25.810

在 XP 上，服务在后台启动，不会阻止引导或登录。在您调用 WTSRegisterSessionNotification 时，termsrv 服务很可能没有运行。

您可以通过以下方式检查服务是否正在运行：

```
// Error handling omitted for brevity
SC_HANDLE scm = OpenSCManager(NULL, NULL, GENERIC_READ);
SC_HANDLE svc = OpenService(scm, L"TermSrv", SERVICE_QUERY_STATUS);
SERVICE_STATUS status;
QueryServiceStatus(svc, &status);
if (status.dwCurrentSTate != SERVICE_RUNNING) {
    // Try to start, wait and try again, etc.
}

CloseServiceHandle(svc);
CloseServiceHandle(scm); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T21:27:56.267

[从WTSRegisterSessionNotification](http://msdn.microsoft.com/en-us/library/aa383841(VS.85).aspx "WTSRegisterSessionNotification")的 MSDN 备注部分阅读它说

> 如果在终端服务的依赖服务启动之前调用该函数，`RPC_S_INVALID_BINDING`可能会返回错误码。Global\TermSrvReadyEvent 全局事件设置后，所有依赖的服务都已启动，可以成功调用该函数。

因此，一个巧妙的解决方案可能是使用[OpenEvent](http://msdn.microsoft.com/en-us/library/ms684305(VS.85).aspx "开放事件")获取`Global\TermSrvReadyEvent`事件的句柄，然后使用[WaitForSingleObject](http://msdn.microsoft.com/en-us/library/ms687032.aspx "等待单个对象")（使用从获取的句柄`OpenEvent`和合理的超时）等待终端服务启动（导致句柄被发出信号），然后再调用`WTSRegisterSessionNotification`.

当然，您也可以调用`WTSRegisterSessionNotification`以 then 开头，如果失败，则使用`GetLastError`查看它是否返回`RPC_S_INVALID_BINDING`，如果是，则执行上述操作。

# authentication - Weblog from Live Writer with Live ID authentication

> ID：799573
> 
> 赞同：3
> 
> 时间：2009-04-28T19:54:18.847
> 
> 标签：authentication, windows-live-id, windows-live-writer

I'm currently developing a weblog engine. I use Live Id for authentication when logging in online. I'm building support for Live Writer thru the MetaWeblogAPI.

Is it possible to check Live ID authentication from within Live Writer? Does anyone know if this it is possible to do this myself? or do I have to create an alternative authentication mechanism for live writer and forget about Live ID.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T08:43:46.750

I've got a reaction from Microsoft:

"Unfortunately at the moment you will need to have an alternate authentication system to run parrallel with LiveID as LiveID can only be used for Live Spaces from within the Live Writer blog setup."

I guess that answers the question.

# aix - tput：未知终端

> ID：799576
> 
> 赞同：12
> 
> 时间：2009-04-28T19:55:50.387
> 
> 标签：aix

我在 AIX-6.1 上，我试图在我的 $PS1 中使用 tput。我已经确认我什至无法从命令行运行 tput 。以下是我的会议：

```
# tput
unknown terminal "xterm"
# echo $TERM
xterm
# tput -T ansi
unknown terminal "ansi" 
```

实际上， ...

```
# ls /usr/lib/terminfo/x
x1700  xl83        xterm+pcc3  xterm+pcfkeys   xterm-88color  xterm-hp     xterm-old  xterm-vi
x1720  xtalk       xterm+pcf0  xterm+pcfn      xterm-8bit     xterm-ic     xterm-r5   xterm-vt220
x1750  xterm       xterm+pcf1  xterm-16color   xterm-basic    xterm-mono   xterm-r6   xterm-vt52
x820   xterm+pcc0  xterm+pcf2  xterm-24        xterm-bold     xterm-new    xterm-rep  xterm-xfree86
xdku   xterm+pcc1  xterm+pcf3  xterm-256color  xterm-boldso   xterm-noapp  xterm-sco  xterm-xmc
xitex  xterm+pcc2  xterm+pcfN  xterm-65        xterm-color    xterm-nrc    xterm-sun  xterms
# ls /usr/lib/terminfo/x | wc -l
       48
# for term in $(ls /usr/lib/terminfo/x) ; do tput -T $term ; done 2>&1 | grep 'unknown terminal' | wc -l
      48
# for term in $(ls /usr/lib/terminfo/x) ; do TERM=$term tput ; done 2>&1 | grep 'unknown terminal' | wc -l
  48 
```

有任何想法吗？提前致谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-10-31T09:50:57.627

你的`TERMINFO`变量设置了吗？没有它，我相信系统不会找到您的 terminfo 文件。或者可能设置不正确？

如果您正在运行 sh、ksh、bash 或类似程序，请尝试：

```
export TERMINFO=/usr/lib/terminfo 
```

如果您不确定您使用的是什么外壳（我很确定您会这样做，但其他人也可能会阅读此内容），请输入：

```
echo $SHELL 
```

如果你使用 csh、tcsh 或类似的，那么你应该输入：

```
setenv TERMINFO /usr/lib/terminfo 
```

之后，尝试再次运行 tput。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-10-31T15:19:41.513

我在 Mac OS Catalina 中修复了这个问题，

```
export TERMINFO=/usr/share/terminfo 
```

# windows - 如何将服务器加入 Active Directory（域）？

> ID：799579
> 
> 赞同：2
> 
> 时间：2009-04-28T19:58:17.667
> 
> 标签：windows, active-directory

需要在此服务器上启动一个新的 ASP.NET 站点，但需要加入我们的 Active Directory 域，有人知道这是怎么做的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-28T20:25:08.133

您域的管理员通常会这样做，如果他不知道怎么做，他会查阅[Microsoft 知识库文章](http://support.microsoft.com/kb/295017)（如果他是她，她就会知道）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T21:33:28.577

这取决于您的操作系统。在 Windows Server 2003 之前，您需要：

*   右键单击“我的电脑”（在服务器上）并选择属性
*   选择“计算机名称”选项卡
*   点击“更改...”
*   在“成员”中选择“域”单选按钮
*   输入您的域名
*   然后会出现一个弹出窗口，要求您提供有权将计算机加入域的人的凭据（请向您的管理员询问这个 - 许多组织允许员工将计算机加入域）
*   提示您重新启动计算机。

如果是 Windows Server 2008，在“我的电脑”上选择“属性”后，您必须从左侧菜单中选择“高级系统设置”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T20:00:42.857

你是说你的应用服务器还是你的数据库服务器？如果您的应用程序不在活动目录中，它很可能不在域中。如果您有系统管理员或网络管理员，请与他们交谈。

# iphone - 是否可以将对象添加到特定的自动释放池？

> ID：799582
> 
> 赞同：0
> 
> 时间：2009-04-28T19:59:00.147
> 
> 标签：iphone, cocoa-touch, uikit, autorelease

在文档中有一个 addObject: NSAutoreleasePool 方法。

我想过这个：

NSString *myString = [[NSString alloc] initWithCString:"这行得通吗？"]; [thePool addObject:myString]; [另一个池 addObject:myString];

那可能吗？我总是读到我只能将对象添加到自动释放池堆栈的最顶层。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T20:13:08.473

是的你可以。但你永远不应该。绝对没有理由这样做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T20:07:05.260

您正在做的事情是可能的，但可能会在运行时导致异常，因为 myString 将`-release`在释放后发送一条消息（假设最后剩余的引用来自第一个池）。通常，正如`-[NSAutoreleasePool addObject:]` [文档](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSAutoreleasePool_Class/Reference/Reference.html)所述，您不应手动将对象添加到自动释放池中，而应调用`-autorelease`该对象。这会将对象放入当前线程的活动自动释放池中（每个线程都有自己的自动释放池）。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-29T08:05:12.477

由于Apple的这一点，我现在有点困惑：

> 当一个对象被自动释放时——也就是说，当一个对象被发送一个自动释放消息或者当它作为参数传递给 addObject: 类方法时——它总是被放入堆栈顶部的自动释放池中。

另一方面，他们没有在 NSAutoreleasePool 类参考中提到它。所以我猜即使我在一个特定的对象上调用 addObject:，它也会进入自动释放池堆栈顶部的对象。其实我得试试看；）

# sql-server - 是什么让 SQL 语句可搜索？

> ID：799584
> 
> 赞同：273
> 
> 时间：2009-04-28T19:59:04.810
> 
> 标签：sql-server, performance

根据定义（至少从我所见），sargable 意味着查询能够让查询引擎优化查询使用的执行计划。我已经尝试查找答案，但主题似乎并不多。所以问题是，什么使 SQL 查询可搜索或不可用？任何文档将不胜感激。

供参考：[Sargable](http://en.wikipedia.org/wiki/Sargable)

* * *

## 回答 #1

> 赞同：278
> 
> 时间：2009-04-28T20:09:00.433

使查询*不可分割*的最常见的事情是在 where 子句中的**函数**内包含一个字段：

```
SELECT ... FROM ...
WHERE Year(myDate) = 2008 
```

SQL 优化器不能在 myDate 上使用索引，即使存在一个索引。从字面上看，它必须为表格的每一行评估这个函数。更好用：

```
WHERE myDate >= '01-01-2008' AND myDate < '01-01-2009' 
```

其他一些例子：

```
Bad: Select ... WHERE isNull(FullName,'Ed Jones') = 'Ed Jones'
Fixed: Select ... WHERE ((FullName = 'Ed Jones') OR (FullName IS NULL))

Bad: Select ... WHERE SUBSTRING(DealerName,4) = 'Ford'
Fixed: Select ... WHERE DealerName Like 'Ford%'

Bad: Select ... WHERE DateDiff(mm,OrderDate,GetDate()) >= 30
Fixed: Select ... WHERE OrderDate < DateAdd(mm,-30,GetDate()) 
```

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2009-04-28T20:05:19.460

**不要这样做：**

```
WHERE Field LIKE '%blah%' 
```

这会导致表/索引扫描，因为 LIKE 值以通配符开头。

**不要这样做：**

```
WHERE FUNCTION(Field) = 'BLAH' 
```

这会导致表/索引扫描。

数据库服务器必须针对表中的每一行评估 FUNCTION()，然后将其与“BLAH”进行比较。

**如果可能，请反向执行：**

```
WHERE Field = INVERSE_FUNCTION('BLAH') 
```

这将对参数运行一次 INVERSE_FUNCTION() 并且仍然允许使用索引。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-28T21:14:37.407

在这个答案中，我假设数据库有足够的覆盖索引。[关于这个话题](https://stackoverflow.com/search?q=database+indexing "数据库索引")有足够多的问题。

很多时候，查询的可搜索性取决于相关索引的临界点。临界点定义了在将一个表或结果集连接到另一个表或结果集时查找和扫描索引之间的区别。一次查找当然比扫描整个表要快得多，但是当您必须查找很多行时，扫描可能更有意义。

因此，除其他事项外，当优化器期望一个表的结果行数小于下一个表上可能索引的临界点时，SQL 语句更可预测。

[您可以在此处](http://www.sqlskills.com/BLOGS/KIMBERLY/post/Why-arent-those-nonclustered-indexes-being-used.aspx)找到详细的帖子和示例。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-06-09T21:08:21.323

对于一个被认为是 sargable 的操作，仅仅能够使用现有的索引是不够的。在上面的示例中，在 where 子句中添加针对索引列的函数调用仍然很可能会利用定义的索引。它将“扫描”也就是从该列（索引）中检索所有值，然后消除与提供的过滤器值不匹配的值。对于具有大量行数的表，它仍然不够有效。真正定义 sargability 的是使用二分搜索方法遍历 b 树索引的查询能力，该方法依赖于已排序项目数组的半集消除。在 SQL 中，它将在执行计划中显示为“索引搜索”。

# actionscript-3 - 如何让数字具有 0.05 的精度？

> ID：799598
> 
> 赞同：3
> 
> 时间：2009-04-28T20:03:31.960
> 
> 标签：actionscript-3, math, actionscript, floating-point, rounding

以下将确保任何大数字仅精确到百分之一（[与此答案相关](https://stackoverflow.com/questions/632802/how-to-deal-with-number-precision-in-actionscript)）：

```
public function round( sc:Number ):Number
{
    sc = sc * 100;
    sc = Math.floor( sc );
    sc = sc / 100;

    return sc;
} 
```

将我的数字四舍五入到 0.05 精度的最佳方法是什么？有什么聪明的方法可以通过位移来获得这个结果吗？例如，我想：

3.4566 = 3.45

3.04232 = 3.05

3.09 = 3.1

3.32 = 3.3

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T20:07:39.970

你可以乘以 20，四舍五入，然后除以 20。

编辑：您将要使用 Math.round() 而不是 Math.floor()，否则您的测试用例 3.09 将变成 3.05。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T20:06:21.953

您可以将 *100 更改为 *20 和 /100 /20。但是，当您可以自然地概括时，为什么要停在那里呢？

```
double floor(double in, double precision) {
    return Math.floor(in/precision)*precision
}
//floor(1.07, 0.05) = 1.05 
```

# c++ - C++ 自定义流操纵器，可更改流中的下一项

> ID：799599
> 
> 赞同：60
> 
> 时间：2009-04-28T20:03:59.293
> 
> 标签：c++, stream

在 C++ 中，要以十六进制打印数字，请执行以下操作：

```
int num = 10;
std::cout << std::hex << num; // => 'a' 
```

我知道我可以创建一个只向流中添加内容的操纵器，如下所示：

```
std::ostream& windows_feed(std::ostream& out)
{
    out << "\r\n";
    return out;
}

std::cout << "Hello" << windows_feed; // => "Hello\r\n" 
```

但是，如何创建一个像“hex”一样修改项目以进入流的操纵器？作为一个简单的例子，我将如何在这里创建 plusone 操纵器？：

```
int num2 = 1;
std::cout << "1 + 1 = " << plusone << num2; // => "1 + 1 = 2"

// note that the value stored in num2 does not change, just its display above.
std::cout << num2; // => "1" 
```

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-04-28T21:23:29.257

首先，您必须将一些状态存储到每个流中。您可以使用函数[`iword`](http://en.cppreference.com/w/cpp/io/ios_base/iword)和传递给它的索引来做到这一点，由以下给出[`xalloc`](http://en.cppreference.com/w/cpp/io/ios_base/xalloc)：

```
inline int geti() { 
    static int i = ios_base::xalloc();
    return i;
}

ostream& add_one(ostream& os) { os.iword(geti()) = 1; return os; } 
ostream& add_none(ostream& os) { os.iword(geti()) = 0; return os; } 
```

有了它，您已经可以在所有流中检索一些状态。现在，您只需要挂钩相应的输出操作。数字输出由一个方面完成，因为它可能与语言环境有关。所以你可以做

```
struct my_num_put : num_put<char> {
    iter_type 
    do_put(iter_type s, ios_base& f, char_type fill, long v) const { 
        return num_put<char>::do_put(s, f, fill, v + f.iword(geti())); 
    } 

    iter_type 
    do_put(iter_type s, ios_base& f, char_type fill, unsigned long v) const { 
        return num_put<char>::do_put(s, f, fill, v + f.iword(geti())); 
    } 
}; 
```

现在，你可以测试这些东西了。

```
int main() {
    // outputs: 11121011
    cout.imbue(locale(locale(),new my_num_put));
    cout << add_one << 10 << 11 
         << add_none << 10 << 11;
} 
```

如果您希望只增加下一个数字，只需`0`在每次调用后再次将单词设置为`do_put`。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-28T20:37:03.143

我完全同意 Neil Butterworth 的观点，但是在你使用的特定情况下，你可以做这个完全可怕的 hack。不要在任何生产代码中这样做。它有很多错误。一方面，它只适用于你上面的单行，它不会改变底层流的状态。

```
class plusone_stream : public std::ostream
{
  public:
    std::ostream operator<<(int i)
    {
      _out << i+1;
      return *this;
    }
};

std::ostream& plusone(std::ostream& out)
{
    return plusone_stream(out);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-01T03:21:57.817

这不是您问题的直接答案，但是您不认为使用普通的旧函数比编写完整的操纵器更易于实现和使用更清晰吗？

```
#include <sstream>

template<typename T>
std::string plusone(T const& t) {
    std::ostringstream oss;
    oss << (t + 1);
    return oss.str();
} 
```

用法：

```
cout << plusone(42); 
```

“明确使用”是指用户不需要问自己，“它是只影响下一个项目，还是影响所有后续项目？” 通过检查很明显，只有函数的参数受到影响。

（`plusone()`例如，您可以通过只返回 a 而进一步简化`T`，但返回 a`std::string`服务于一般情况。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-28T20:39:01.453

我为您的测试用例创建了一个简单的解决方案，而没有使用`<iomanip>`. 我不能保证同样的方法会在现实生活中奏效。

基本方法是`cout << plusone`返回一个临时辅助对象 ( `PlusOnePlus`)，该对象又具有`operator <<`执行加法的重载。

我已经在 Windows 上对其进行了测试：

```
PlusOne plusone;
cout << plusone << 41 
```

正如预期的那样，产生“42”。这是代码：

```
class PlusOnePlus {
public:
    PlusOnePlus(ostream& os) : m_os(os) {}
    // NOTE: This implementation relies on the default copy ctor,
    // assignment, etc.
private:
    friend ostream& operator << (PlusOnePlus& p, int n);
    ostream& m_os;
};

class PlusOne {
public:
    static void test(ostream& os);
};

PlusOnePlus operator << (ostream& os, const PlusOne p)
{
    return PlusOnePlus(os);
}

ostream& operator << (PlusOnePlus& p, int n)
{
    return p.m_os << n + 1;
}

void PlusOne::test(ostream& os)
{
    PlusOne plusone;
    os << plusone << 0 << endl;
    os << plusone << 41 << endl;
} 
```

编辑：注释代码以指出我依赖于`PlusOnePlus`. 一个健壮的实现可能会定义这些

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-28T21:31:37.367

您将不得不使用流状态。我已为该主题的以下链接添加了书签：

*   [关于 boost ML 的讨论](http://lists.boost.org/Archives/boost/2002/10/38275.php)
*   [Maciej Sobczak 关于 CUJ/DDJ 的文章](http://www.ddj.com/cpp/184402062?pgno=1)

由于 Maciej Sobczak 库不再在线提供，并且许可证允许我这样做，（如果我错了，请纠正我），这是我设法从遗忘中挽救的主文件的副本：

```
// streamstate.h
//
// Copyright (C) Maciej Sobczak, 2002, 2003
//
// Permission to copy, use, modify, sell and distribute this software is
// granted provided this copyright notice appears in all copies.  This software
// is provided "as is" without express or implied warranty, and with no claim
// as to its suitability for any purpose.
//
// <http://lists.boost.org/Archives/boost/2002/10/38275.php>
// <http://www.ddj.com/dept/cpp/184402062?pgno=1>
// <http://www.msobczak.com/prog/publications.html>

#ifndef STREAMSTATE_H_INCLUDED
#define STREAMSTATE_H_INCLUDED

#include <ios>
#include <istream>
#include <ostream>

// helper exception class, thrown when the source of error
// was in one of the functions managing the additional state storage
class StreamStateException : public std::ios_base::failure
{
public:
    explicit StreamStateException()
        : std::ios_base::failure(
            "Error while managing additional IOStream state.")
    {
    }
};

// State should be:
// default-constructible
// copy-constructible
// assignable

// note: the "void *" slot is used for storing the actual value
//       the "long" slot is used to propagate the error flag
template
<
    class State,
    class charT = char,
    class traits = std::char_traits<charT>
>
class streamstate
{
public:
    // construct with the default state value
    streamstate() {}

    // construct with the given stream value
    streamstate(const State &s) : state_(s) {}

    // modifies the stream
    std::basic_ios<charT, traits> &
    modify(std::basic_ios<charT, traits> &ios) const
    {
        long *errslot;
        void *&p = state_slot(ios, errslot);

        // propagate the error flag to the real stream state
        if (*errslot == std::ios_base::badbit)
        {
            ios.setstate(std::ios_base::badbit);
            *errslot = 0;
        }

        // here, do-nothing-in-case-of-error semantics
        if (ios.bad())
            return ios;

        if (p == NULL)
        {
            // copy existing state object if this is new slot
            p = new State(state_);
            ios.register_callback(state_callback, 0);
        }
        else
            *static_cast<State*>(p) = state_;

        return ios;
    }

    // gets the current (possibly default) state from the slot
    static State & get(std::basic_ios<charT, traits> &ios)
    {
        long *errslot;
        void *&p = state_slot(ios, errslot);

        // propagate the error flag to the real stream state
        if (*errslot == std::ios_base::badbit)
        {
            ios.setstate(std::ios_base::badbit);
            *errslot = 0;
        }

        // this function returns a reference and therefore
        // the only sensible error reporting is via exception
        if (ios.bad())
            throw StreamStateException();

        if (p == NULL)
        {
            // create default state if this is new slot
            p = new State;
            ios.register_callback(state_callback, 0);
        }

        return *static_cast<State*>(p);
    }

private:
    // manages the destruction and format copying
    // (in the latter case performs deep copy of the state)
    static void state_callback(std::ios_base::event e,
        std::ios_base &ios, int)
    {
        long *errslot;
        if (e == std::ios_base::erase_event)
        {
            // safe delete if state_slot fails
            delete static_cast<State*>(state_slot(ios, errslot));
        }
        else if (e == std::ios_base::copyfmt_event)
        {
            void *& p = state_slot(ios, errslot);
            State *old = static_cast<State*>(p);

            // Standard forbids any exceptions from callbacks
            try
            {
                // in-place deep copy
                p = new State(*old);
    }
            catch (...)
            {
                // clean the value slot and
                // set the error flag in the error slot
                p = NULL;
                *errslot = std::ios_base::badbit;
            }
        }
    }

    // returns the references to associated slot
    static void *& state_slot(std::ios_base &ios, long *&errslot)
    {
        static int index = std::ios_base::xalloc();
        void *&p = ios.pword(index);
        errslot = &(ios.iword(index));

        // note: if pword failed,
        // then p is a valid void *& initialized to 0
        // (27.4.2.5/5)

        return p;
    }

    State state_;
};

// partial specialization for iword functionality
template
<
    class charT,
    class traits
>
class streamstate<long, charT, traits>
{
public:
    // construct with the default state value
    streamstate() {}

    // construct with the given stream value
    streamstate(long s) : state_(s) {}

    // modifies the stream
    // the return value is not really useful,
    // it has to be downcasted to the expected stream type
    std::basic_ios<charT, traits> &
    modify(std::basic_ios<charT, traits> &ios) const
    {
        long &s = state_slot(ios);
        s = state_;

        return ios;
    }

    static long & get(std::basic_ios<charT, traits> &ios)
    {
        return state_slot(ios);
    }

private:
    static long & state_slot(std::basic_ios<charT, traits> &ios)
    {
        static int index = std::ios_base::xalloc();
        long &s = ios.iword(index);

        // this function returns a reference and we decide
        // to report errors via exceptions
        if (ios.bad())
            throw StreamStateException();

        return s;
    }

    long state_;
};

// convenience inserter for ostream classes
template
<
    class State,
    class charT,
    class traits
>
std::basic_ostream<charT, traits> &
operator<<(std::basic_ostream<charT, traits> &os,
    const streamstate<State> &s)
{
    s.modify(os);
    return os;
}

// convenience extractor for istream classes
template
<
    class State,
    class charT,
    class traits
>
std::basic_istream<charT, traits> &
operator>>(std::basic_istream<charT, traits> &is,
    const streamstate<State> &s)
{
    s.modify(is);
    return is;
}

// the alternative if there is a need to have
// many different state values of the same type
// here, the instance of streamstate_value encapsulates
// the access information (the slot index)

template
<
    class State,
    class charT = char,
    class traits = std::char_traits<char>
>
class streamstate_value
{
public:

    streamstate_value()
        : index_(-1)
    {
    }

    // returns a reference to current (possibly default) state
    State & get(std::basic_ios<charT, traits> &ios)
    {
        long *errslot;
        void *&p = state_slot(ios, errslot, index_);

        // propagate the error flag to the real stream state
        if (*errslot == std::ios_base::badbit)
        {
            ios.setstate(std::ios_base::badbit);
            *errslot = 0;
        }

        // this function returns a reference and the only
        // sensible way of error reporting is via exception
        if (ios.bad())
            throw StreamStateException();

        if (p == NULL)
        {
            // create default state if this is new slot
            p = new State;
            ios.register_callback(state_callback, index_);
        }

        return *static_cast<State*>(p);
    }

private:

    // manages the destruction and format copying
    // (in the latter case performs deep copy of the state)
    static void state_callback(std::ios_base::event e,
        std::ios_base &ios, int index)
    {
        long *errslot;
        if (e == std::ios_base::erase_event)
        {
            // safe delete if state_slot fails
            delete static_cast<State*>(state_slot(ios, errslot, index));
        }
        else if (e == std::ios_base::copyfmt_event)
        {
            void *& p = state_slot(ios, errslot, index);
            State *old = static_cast<State*>(p);

            // Standard forbids any exceptions from callbacks
            try
            {
                // in-place deep copy
                p = new State(*old);
    }
            catch (...)
            {
                // clean the value slot and set the error flag
                // in the error slot
                p = NULL;
                *errslot = std::ios_base::badbit;
            }
        }
    }

    // returns the references to associated slot
    static void *& state_slot(std::ios_base &ios,
        long *& errslot, int & index)
    {
        if (index < 0)
        {
            // first index usage
            index = std::ios_base::xalloc();
        }

        void *&p = ios.pword(index);
        errslot = &(ios.iword(index));

        // note: if pword failed,
        // then p is a valid void *& initialized to 0
        // (27.4.2.5/5)

        return p;
    }

    int index_;
};

// partial specialization for iword functionality
template
<
    class charT,
    class traits
>
class streamstate_value<long, charT, traits>
{
public:
    // construct with the default state value
    streamstate_value()
        : index_(-1)
    {
    }

    long & get(std::basic_ios<charT, traits> &ios)
    {
        if (index_ < 0)
        {
            // first index usage
            index_ = std::ios_base::xalloc();
        }

        long &s = ios.iword(index_);
        if (ios.bad())
            throw StreamStateException();

        return s;
    }

private:
    long index_;
};

#endif // STREAMSTATE_H_INCLUDED 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T21:32:47.650

litb 的方法是“正确的方法”，对于复杂的东西是必要的，但这样的方法就足够了。添加隐私和友谊的味道。

```
struct PlusOne
{
   PlusOne(int i) : i_(i) { }
   int i_;
};

std::ostream &
operator<<(std::ostream &o, const PlusOne &po)
{
   return o << (po.i_ + 1);
}

std::cout << "1 + 1 = " << PlusOne(num2); // => "1 + 1 = 2" 
```

在这个简单的示例中，创建和流式传输一个临时对象似乎并不比像有人已经建议的那样定义一个函数 plusOne() 更有帮助。但是假设您希望它像这样工作：

```
std::ostream &
operator<<(std::ostream &o, const PlusOne &po)
{
   return o << po.i_ << " + 1 = " << (po.i_ + 1);
}

std::cout << PlusOne(num2); // => "1 + 1 = 2" 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-28T20:33:00.127

`hex`和操纵`dec`器`oct`只是更改现有的`basefield`属性`stream`。

有关这些操纵器的更多详细信息，请参阅[C++ 参考。](http://www.cplusplus.com/reference/iostream/manipulators/)

正如[Neil Butterworth 的回答](https://stackoverflow.com/questions/799599/c-custom-stream-manipulator-that-changes-next-item-on-stream/799634#799634)中所发布的那样，您需要扩展现有的流类，或者创建自己的流类，以便将影响未来值的操纵器插入到流中。

在您的`plusone`操纵器示例中，流对象必须有一个内部标志来指示应该将一个标志添加到所有插入的值中。`plusone`操纵器只需设置该标志，处理流插入的代码将在插入数字之前检查该标志。

# android - ImageView 问题

> ID：799607
> 
> 赞同：4
> 
> 时间：2009-04-28T20:06:05.963
> 
> 标签：android, layout, uiimageview

```
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent">
    <ImageView              
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_centerHorizontal="true"
        android:src="@drawable/wallpaper" />
</RelativeLayout> 
```

的大小`@drawable/peetscoffee_wallpaper`是 640x480 ，但它不是水平居中的。我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-29T19:45:22.527

尝试`android:gravity="center"`，或`android:layout_gravity="center"`，而不是`centerHorizontal="true"`。

但是，我怀疑这对于尺寸设置为的图像是否合理`wrap_content`- 您可能希望使用`android:scaleType`（例如`fitCenter`）定义一些图像缩放方法并将其设置为`fill_parent`而不是`wrap_content`。`640x480`比`320x480`当前现实世界的 Android 设备支持的更大。或者只是缩小您正在使用的图像，这样设备就不必完成这项工作。

# ruby-on-rails - 如何在应用程序布局中显示不同控制器和方法的内容？

> ID：799619
> 
> 赞同：0
> 
> 时间：2009-04-28T20:10:48.963
> 
> 标签：ruby-on-rails, layout, methods, controller

我正在尝试在 Rails 应用程序的默认 application.rhtml 中显示 javascript 反馈小部件。它只会出现在页面子集上，分布在不同的控制器上。

试图找出最好的方法来做到这一点。

一个想法是做这样的事情：

```
<%= render :partial => "layouts/feedback_tab"  if @show_feedback_tab == true %> 
```

然后在每个控制器的每个方法中设置@show_feedback_tab。这似乎过于复杂。我的第二个想法是，我可以默认 @show_feedback_tab 为 true 并将其设置为 false 用于我不想显示的相关单个方法。但是全局变量似乎不正确，并且 application_controller 中的方法不起作用（我认为），因为显示取决于被调用的方法。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T20:19:11.893

您可以在 application_controller.rb 中编写方法：

```
def show_feedback_tab?
  if params[:controller] == :user && params[:action] == :index
    return true
  end
  ...
  or put here any other logic
  ...
  false
end 
```

并将其添加为辅助方法（在 application_controller.rb 中）：

```
helper_method :show_feedback_tab? 
```

然后你可以在这样的视图中使用它：

```
<%= render :partial => "layouts/feedback_tab"  if show_feedback_tab? %> 
```

# jquery - 如何选择 html-select jquery

> ID：799623
> 
> 赞同：0
> 
> 时间：2009-04-28T20:12:18.680
> 
> 标签：jquery

我的html是这样的：

```
<select id="slctDiv2" class="slct"><option value="0">Any</option>
<option   value="1">Administration</option><option value="2">Collections</option>     
<option value="3">Distribution</option><option value="4">Engineering</option>
<option value="5">Treatment</option></select> 
```

如果我通过 jquery 找到所选选项，如何获取所选项目的 ID（在本例中为“slctDiv2”）。

```
$('#slctDiv1,#slctDiv2').change(function(){

  if($(this).parent().attr('id')=='slctDiv2'){
    //do this
   }else{
    //do that
  }
}); 
```

使用父函数不起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T20:18:18.273

我相信你已经有了select（根据HTML中的ID和JS中的ID），而不是选项，所以你只需要这样做：

```
$('#slctDiv1,#slctDiv2').change(function(){
    if($(this).attr('id')=='slctDiv2'){ //do this
    }else{ //do that 
    }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T20:22:59.310

$("#slctDiv2").val();

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T20:57:29.147

哇！因为我没有发布我的整个代码，你们不知道在更改事件之后我正在执行 $.getJSON 所以我的 $(this) 我猜是引用 xhr。呃。感谢（并抱歉浪费）您的时间！

# c# - ListView ItemChecked 事件

> ID：799629
> 
> 赞同：1
> 
> 时间：2009-04-28T20:13:45.273
> 
> 标签：c#, .net, winforms, events, listview

我有一个 ListView，其中每个项目都有一个复选框。最初没有附加事件，我以编程方式设置复选框的状态。在此之后，我附加了一个 ItemCheckedEventHandler，并且事件处理程序为附加处理程序之前发生的每个事件触发。有没有办法在附加处理程序之前清除事件队列？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T20:49:09.963

在表单构造函数/InitializeComponent 方法中添加事件时，我能够重新创建。

而且我能够通过在表单的加载事件中添加事件而不是构造函数/InitializeComponent 方法来解决这个问题。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-04-28T20:35:00.917

它很hacky，我不喜欢它，但`Application.DoEvents()`可能对你有用。

# java - Java 等待 JFrame 完成

> ID：799631
> 
> 赞同：3
> 
> 时间：2009-04-28T20:14:00.047
> 
> 标签：java, jframe

我有一个登录框架，我必须等待另一个线程。登录成功后，框架会自行处理。我想弹出应用程序的主框架。现在我正在观察一个布尔值来确定何时启动主框架。这样做的正确方法是什么？看一个布尔值并不优雅。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-28T20:31:33.000

如果您有 Java 5 或更高版本可用，则可以使用[CountDownLatch](http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html)。例如，假设主框架最初处于控制状态，让主框架创建`CountDownLatch`倒计时 1 并将此锁存器传递给登录框架。然后让主框架等待锁存器变为 0：

```
CountDownLatch loginSignal = new CountDownLatch(1);
     ...    // Initialize login frame, giving it loginSignal 
     ...    // execute login frame in another Thread
// This await() will block until we are logged in:
loginSignal.await(); 
```

让登录框架完成后，减少锁存器：

```
loginSignal.countDown(); 
```

确保您的登录框架无法退出它忘记减少闩锁的地方！一旦`CountDownLatch`达到 0，主框架就变为可运行的。

您也可以使用 a[`Semaphore`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/Semaphore.html)或[`Condition`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/locks/Condition.html)（或 中的任何其他选项`java.util.concurrent`），但出于此目的， a`CountDownLatch`似乎更易于使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T23:41:33.060

在处理 Swing（实际上是 AWT）时，您真正必须了解的是，您需要保持与 AWT 事件调度线程 (EDT) 组件的所有交互。

因此，请从 EDT 登录。使用 a`new Thread`或更好的 a `java.util.concurrent.ExecutorService`。当您发现您已登录时，请使用`java.awt.EventQueue.invokeLater`回到 EDT。匿名内部类非常适合捕获上下文，尽管它们的语法非常冗长，但可以使代码更短。

# model-view-controller - 手动编码 MVC 视图与 asp:ServerControls

> ID：799632
> 
> 赞同：0
> 
> 时间：2009-04-28T20:14:06.647
> 
> 标签：model-view-controller, controls, views

当 MVC 出现时，我几乎没有接触过 ASP.Net 网络表单，现在我准备尝试一下。但是，我想澄清一些事情，以确保我理解 ASP.Net MVC 中的视图编码......

我听说您必须手动编码视图布局中的所有 HTML，并且您不能为此使用服务器控件。现在，我喜欢您可以使用 asp:ListView 在 web 表单中呈现数据列表的方式，并且我大量使用了 SelectedItemTemplate 和 SelectedItem 的整体概念。所以，我担心不得不自己处理所有输出，而不是让服务器控件来做这件事，这让我很头疼。DataGridView 以及该服务器控件附带的 Select、Edit、Delete commadds 也是如此。

在我正在集思广益的特定情况下，我将客户名称显示在 asp:ListView 中，然后当您单击客户名称时，它使用在 ListView 中展开的 SelectedItemTemplate 突出显示该行并显示有关该特定行的更多详细信息客户（在 ListView 中）。

我很想看到一些示例 asp.Net MVC 视图代码来展示如何处理这种常见的 UI 表示技术。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-28T20:30:18.980

ASP.NET MVC 有一些不错的 GridView

[http://www.codeproject.com/KB/aspnet/MVCFlexigrid.aspx](http://www.codeproject.com/KB/aspnet/MVCFlexigrid.aspx)

[http://www.reconstrukt.com/ingrid/example1.html](http://www.reconstrukt.com/ingrid/example1.html)

# powershell - 使用 Powershell 检索注册表值时出错

> ID：799633
> 
> 赞同：4
> 
> 时间：2009-04-28T20:14:26.333
> 
> 标签：powershell, registry

我正在尝试使用 Powershell 从注册表项中读取值。这相当简单，但是，一个特定的注册表项给我带来了麻烦。

如果我运行以下命令，我无法获得“$setting”的（默认）值。

```
C:\Program Files\PowerGUI> $setting = Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\Autorun.inf" 

C:\Program Files\PowerGUI> $setting

PSPath       : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\
               CurrentVersion\IniFileMapping\Autorun.inf
PSParentPath : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\
               CurrentVersion\IniFileMapping
PSChildName  : Autorun.inf
PSDrive      : HKLM
PSProvider   : Microsoft.PowerShell.Core\Registry
(default)    : @SYS:DoesNotExist 
```

通常，我会做 $setting.Attribute 或 $setting.(default)。但是，这会导致以下错误：

```
C:\Program Files\PowerGUI> $setting.(default)
The term 'default' is not recognized as a cmdlet, function, operable program, or script file. Verify the term and try again.
At :line:1 char:17
+ $setting.(default <<<< ) 
```

如何获取“（默认）”属性的值？

提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T20:20:15.180

**编辑**必须查看旧脚本才能弄清楚这一点。

诀窍是您需要查看底层 PSObject 以获取值。特别看属性包

```
$a = get-itemproperty -path "HKLM:\Some\Path"
$default = $a.psobject.Properties | ?{ $_.Name -eq "(default)" } 
```

您也可以只使用索引器而不是执行过滤技巧

```
$default = $a.psobject.Properties["(default)"].Value; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-03T13:53:58.220

另一个版本：

（Get-ItemProperty 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\Autorun.inf'）。'（默认）'

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-05-03T23:32:34.057

用于`Get-Item`获取表示注册表项的对象：

```
PS > $regKey = Get-Item HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\Autorun.inf 
```

这为您提供了一个[`RegistryKey`](http://msdn.microsoft.com/en-us/library/microsoft.win32.registrykey.aspx). `RegistryKey`有一个名为`GetValue`; 如果 to 的参数`GetValue`是空字符串 ( `''`)，那么它将返回`(default)`值：

```
PS > $regKey.GetValue('') 
```

为什么这比`Get-ItemProperty`? 它更自然地延伸到`Get-ChildItem`. `Get-ChildItem`会给你一个`RegistryKey`对象列表。在我的特殊情况下，我想列出我机器上安装的 Python 版本的安装路径：

```
PS C:\> get-childitem HKLM:\SOFTWARE\Wow6432Node\Python\PythonCore\*\InstallPath `
>> | foreach-object { $_.GetValue('') }
C:\Python26\ArcGIS10.0\
C:\Python\27\ 
```

# perl - 如何让 Perl 的 Jabber::SimpleSend 与 Gmail 聊天一起使用？

> ID：799648
> 
> 赞同：2
> 
> 时间：2009-04-28T20:19:29.317
> 
> 标签：perl, xmpp, instant-messaging

我正在尝试编写一个简单的 Perl 脚本来发送即时消息。Jabber 似乎是最有利的协议。但以下脚本失败：

```
#!/usr/bin/env perl
use Jabber::SimpleSend qw(send_jabber_message);
send_jabber_message('me@gmail.com',
                    'CENSORED',
                    'you@gmail.com',
                    'subject test',
                    "body test"); 
```

它说：

```
Can't call method "can_read" on an undefined value at 
/opt/local/lib/perl5/site_perl/5.8.9/XML/Stream.pm line 1421. 
```

正如卡特曼的回答所指出的，代码实际上应该是

```
#!/usr/bin/env perl
use Jabber::SimpleSend qw(send_jabber_message);
send_jabber_message('me%40gmail.com@talk.google.com',
                    'CENSORED',
                    'you%40gmail.com@talk.google.com',
                    'subject test',
                    "body test"); 
```

但这失败并出现以下错误：

```
No SASL mechanism found
 at /usr/local/lib/perl5/site_perl/5.10.0/Authen/SASL.pm line 74 
```

我确实安装了 Authen::SASL cpan 模块。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T14:27:41.707

Jabber::SimpleSend 是与标准 Jabber 服务器交互的更简单方法，但不要让模块名称误导您：gtalk 确实有点不同，需要 TLS 加密（Jabber::SimpleSend 不会这样做）和主机名改变。使用 Net::XMPP 并直接处理其 API，您将获得更好的结果。

请参阅[http://www.gridpp.ac.uk/wiki/Nagios_jabber_notification](http://www.gridpp.ac.uk/wiki/Nagios_jabber_notification)以获得使用 Net::XMPP 在 75 行 perl 中得到充分注释的完整工作实现。它旨在发送 nagios 通知，但它完全符合您的需要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T00:35:44.897

我不熟悉代码，但 XML::Stream 中的那一行是模块开始 select() 循环的地方。第 523-524 行是将 IO::Select 一个套接字传递给目标服务器的地方，而 IO::Select 本身传递了一个祝福引用，这绝不应该像 XML::Stream 那样使用它。

某些东西可能正在修改 Jabber 模块中 XML::Stream 对象的“SELECT”元素，这可能是在错误地尝试纠正服务器连接错误。对不起，我不能更具体。

* * *

*响应更新：*

这些是奇怪的错误，无论如何我一直想查看 Jabber 模块的内部，所以我查看了源代码。以下内容基于查看可从 CPAN 获得的模块的最新版本。除非您想开始对这些模块进行子类化并添加代码以查看意外发生的位置，否则这可能不是很有用。（如果您对 Jabber 模块的内部结构不感兴趣，可以跳过下一段。）

从更新的信息中，我追踪到了 Authen::SASL::Perl 在第 41 行发出的声音。它需要 $parent->mechanism 的结果，并且有两个可能的原因，假设 Authen::SASL 不是没坏 要么是在没有来自 Net::XMPP::Protocol 的参数（第 2968 行）的情况下错误地调用它，这似乎不太可能，要么它在构造函数中为 Authen::SASL 设置的“机制”不存在。Net::XMPP::Protocol 定义了“机制”（GetStreamFeature 被调用，第 2958 行；该方法在第 3340 行周围定义）`return $self->{STREAM}->GetStreamFeature($self->GetStreamID(),$feature);`，其中 $feature 只是从被调用者传递的字符串和 XML::Stream 对象的 id 部分会议。

根据原始 XML 错误和会话 ID 变坏的可能性，服务器似乎在某个时间点向 XML::Stream 发送了错误的数据，并且使用它的模块无法解释。我不相信 foo%40gmail.com@talk.google.com 是正确的用户名格式，但我不知道如果 Jabber 服务器没有做错什么，这会导致这些错误。

我会在不同的服务器上使用不同的用户名重新开始，看看 Jabber::SimpleSend 是否有效，然后尝试以某种方式捕获服务器的输出以查看 XML::Stream 阻塞的内容。

* * *

*更新：*对于它的价值，我安装了模块并且我得到了完全相同的错误。Authen::SASL::Perl::PLAIN 和所有其他先决条件确实存在。当我将用户名设置为 gmailaccountname@talk.google.com 并启用全局警告（例如，#!/usr/bin/perl -w 或 perl -w filename.pl）时，XML::Stream 会显示一堆未定义的值问题，SimpleSend 实际上吐出警告“无法连接到 Jabber 服务器”！（不，我不知道这真正意味着什么:()。

* * *

*更新：*我试图安装 Net::Jabber::Bot （在一些 ssl 模块错误后我放弃了）看看它是否能解决任何问题，我注意到它的构造函数有这个选项并注意：

```
gtalk => 0 # Default to off, 1 for on. needed now due to gtalk differences from std jabber server. 
```

这强化了服务器正在做一些不寻常的事情的想法，XML::Stream 不会费心为其抛出异常。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-02T22:17:40.653

您的用户名应该是 me@gmail.com，但服务器名称是 talk.google.com。所以第一个参数应该是 me@gmail.com@talk.google.com，但我不确定 Perl 是否可以理解双 @ 符号。您可以尝试使用 %40 转义第一个 @ ，以便第一个参数是 me%40gmail.com@talk.google.com 。

更新 I：关于第二个错误，您似乎缺少 SASL 身份验证模块。GMail 使用 SASL 普通身份验证。那么你有 /usr/local/lib/perl5/site_perl/5.10.0/Authen/SASL/Perl/PLAIN.pm 文件吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-04T09:57:00.480

看起来您需要安装 Authen::SASL::Cyrus （C 实现）或 Authen::SASL::Perl （Perl 实现）以及 Authen::SASL （它只是试图找到安装在你的机器，对你来说，两者都找不到）。

检查您是否安装了其中之一。

那是我对源代码和手册的阅读-我还没有测试过，ymmv。

# php - Apache重写规则强制下载

> ID：799649
> 
> 赞同：2
> 
> 时间：2009-04-28T20:19:55.697
> 
> 标签：php, apache, .htaccess

我正在尝试移植由另一个编码器（不再存在）开发的 PHP 站点，并且我遇到了 Apache 重写规则的问题，该规则提示在目标服务器上下载文件。我确信这是一个简单的问题，但我在谷歌搜索答案时遇到了一些困难。我在（专用）Ubuntu 服务器上运行，标准安装了 Apache 和 PHP5，并从共享服务器移植，一切运行良好。在移植期间没有更改任何站点文件。

.htaccess 文件包含此代码（仅）

```
# 默认使用 PHP5
AddHandler 应用程序/x-httpd-php5 .php
选项 - 索引 FollowSymlinks

重写引擎开启
RewriteRule ^html/(.*) /index.php?init=site\/$1\/$2\/$3\/$4\/$5\/$6\/$7\/$8\/$9

重写规则 ^mykart$ /index.php?admin=true
RewriteRule ^mykart/$ /index.php?admin=true
RewriteRule ^mykart/(.*)$ /index.php?init=admin\/$1\/$2\/$3\/$4\/$5\/$6\/$7\/$8\/$9&admin=true

```

当我尝试打开文件[http://www.mysite.com/html/#home](http://www.mysite.com/html/#home)时，浏览器会尝试下载（index.php）文件而不是显示它，并显示消息

“您已选择打开 [对话框在此处显示空白]

这是一个：application/x-httpd-php 来自...."

我想我一定错过了 PHP 或 Apache 配置中的某些内容，但是什么？

编辑：澄清一下，服务器正在运行 Apache2，并且上面有几个正常运行的 PHP 站点。此外，如果我删除 .htaccess 文件并运行一个简单的 phpinfo 显示页面，一切都运行良好，所以这不是 PHP 的执行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T21:02:18.933

我想 MIME 类型`application/x-httpd-php5`无效。我已经在我的本地机器上尝试过了，它导致了同样的行为。

你试过`application/x-httpd-php`吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T20:40:45.240

看起来像一个 Apache 配置问题，当然我可能是错的。您是否检查了 httpd.conf 中的以下几行：

```
# Add index.php to your DirectoryIndex line:
DirectoryIndex index.html index.php

AddType text/html       php 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-11-09T20:18:16.840

我有一个类似的问题。浏览器试图从 php 网站下载链接，而不是加载它们。

对我来说，这不是 PHP 解释器问题，结果是 .htaccess 文件放错了位置。但是，由于浏览器缓存，我没有意识到禁用 htaccess 文件可以解决几个小时的问题。

所以，**不要忘记清除浏览器缓存**！并重新启动 Apache。

# flash - 如何在 AS3 中将笔画添加到文本中？

> ID：799653
> 
> 赞同：3
> 
> 时间：2009-04-28T20:21:05.647
> 
> 标签：flash, actionscript-3, fonts, filter

我正在使用 AS3 进行编码，并且想在我正在显示到屏幕上的文本中添加一个笔划。我目前的代码是：

```
format = new TextFormat("BN Elements", 14, 0xEEEEEE, false, false, false, null, null, "left");
format.font = "BN Elements"
scoreText = initText(starsleftText, format, "", 160,5, 545, 61);
scoreText = "Stroke This Text"; 
```

由于文本是动态生成的，因此我无法在 Flash IDE 中将其创建为文本对象 - 我知道要添加笔触，我可以使用设置为 1000% 和低质量的“发光”功能。

我想我的问题是，如何直接在 AS3 中应用具有类似属性的“发光”滤镜效果？还是有我不知道的替代“中风”功能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-28T21:08:55.657

这很容易：

[http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/filters/GlowFilter.html](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/filters/GlowFilter.html)（页面底部有一个示例）

我不确定他们是否添加了任何新的添加真正的笔画，但发光滤镜“笔画”与代码一样有效。

您还可以创建一个像素弯曲过滤器，它可以让您更好地控制效果，但我似乎找不到任何已经写好的：（

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-02T20:09:59.860

Flash 从形状的边缘生成笔触。由于您正在动态使用文本（而不是在创作中），Flash 可以使用 1) 由操作系统绘制的设备文本或 2) SWF 文件中的嵌入文本来呈现。在第一种情况下，Flash（当前）无法访问边缘来描边它们。第二，Flash 使用专门的子渲染器来处理（同样目前）不支持描边的文本，或者就此而言，除了纯色填充之外的任何东西。

简短的回答：运行时当前不支持对文本进行描边，尽管建议的发光或像素弯曲方法是一个好主意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-18T16:05:57.597

不过，还有另一种方法。不知何故，通过 BlurFilter 显示笔画是可行的，但它不干净而且非常慢，因为完成了太多的像素处理，这绝对没有必要。

另一种选择（一种快速方便的方法）是使用 Pixel Benders PBJ 过滤器。我自己写了一个中风过滤器，它就像一个魅力。如果您愿意，您甚至可以隔离原始图像，因此过滤器只为您提供轮廓，而没有原始图像。

参数是：

像素4颜色

浮力

浮动阈值

布尔隔离

[http://www.file-upload.net/download-7344877/Stroke.pbj.html](http://www.file-upload.net/download-7344877/Stroke.pbj.html)

如果您愿意，请在此处下载并根据需要使用它。

如果你不知道如何在 Flash 中使用 Pixel Bender Filters，谷歌是你的朋友。有很多关于它的教程。

# c# - ASP.Net FindControl 不起作用 - 怎么会？

> ID：799655
> 
> 赞同：29
> 
> 时间：2009-04-28T20:21:20.687
> 
> 标签：c#, .net, asp.net, findcontrol

我过去使用`FindControl`过，在 .NET 2.0/3.0 之前。现在看来，出于某种原因，我的控件的 ID 被分配了一个时髦的名称。例如，我为复选框分配了一个 ID“cbSelect”，但 FindControl 没有找到它。当我查看它被分配的 HTML 时`ctl00_bodyPlaceHolder_ctl02_cbSelect`。

我还没有找到一个提到这一点的 FindControl 示例。事实上，每个人似乎都只是像平常一样使用查找控件。

那么，我做错了吗？.Net 改变了吗？谁能帮我解释一下，这真的很令人沮丧！

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-28T20:30:20.087

您可能正在使用 MasterPage 或用户控件 (ascx)，这就是客户端 ID 更改的原因。假设您在母版页中有一个控件，其 id 与页面中的控件相同。这将导致冲突。id 更改确保所有 ClientID 属性在页面上都是唯一的。

FindControl 在使用 MasterPages 时需要特别注意。看看[ASP.NET 2.0 MasterPages 和 FindControl()](http://west-wind.com/weblog/posts/5127.aspx)。FindControl 在[命名容器](http://www.asp.net/LEARN/master-pages/tutorial-05-vb.aspx)内工作。MasterPage 和页面是不同的命名容器。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-01-27T13:51:48.123

您可以编写扩展程序以使用递归查找页面上的任何控件。这可能在某些 Util/Helper 类中。

```
 public static Control FindAnyControl(this Page page, string controlId)
    {
        return FindControlRecursive(controlId, page.Form);
    }

    public static Control FindAnyControl(this UserControl control, string controlId)
    {
        return FindControlRecursive(controlId, control);
    }

    public static Control FindControlRecursive(string controlId, Control parent)
    {
        foreach (Control control in parent.Controls)
        {
            Control result = FindControlRecursive(controlId, control);
            if (result != null)
            {
                return result;
            }
        }
        return parent.FindControl(controlId);
    } 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-28T20:56:22.707

在“大多数”情况下，我用简单的扩展方法解决了这个问题，我很幸运

您可以在您认为最好的任何更高级别的容器控件上调用它，如果您想扫描整个控件层次结构，包括 Page 本身。

```
private static Control FindControlIterative(this Control control, string id)
{
    Control ctl = control;

    LinkedList<Control> controls = new LinkedList<Control>();

    while(ctl != null)
    {
        if(ctl.ID == id)
        {
            return ctl;
        }

        foreach(Control child in ctl.Controls)
        {
            if(child.ID == id)
            {
                return child;
            }

            if(child.HasControls())
            {
                controls.AddLast(child);
            }
        }

        ctl = controls.First.Value;
        controls.Remove(ctl);
    }

    return null;
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-03-02T20:57:02.197

在控件集合中搜索控件时，始终使用您分配给控件的 id，而不是您在源帖子渲染中看到的那个。如果 FindControl() 没有找到您知道存在的控件，则很有可能您没有在控件层次结构的右分支中进行搜索。递归函数对我来说是成功的。

这是我用于 VB.NET 3.5 的示例：

```
Function FindControlRecursive(ByVal ctrl As Control, ByVal id As String) As Control
    Dim c As Control = Nothing

    If ctrl.ID = id Then
        c = ctrl
    Else
        For Each childCtrl In ctrl.Controls
            Dim resCtrl As Control = FindControlRecursive(childCtrl, id)
            If resCtrl IsNot Nothing Then c = resCtrl
        Next
    End If

    Return c
End Function 
```

这是我将如何在我的基页类中局部实现此功能的示例：

```
Dim form HtmlForm = CType(FindControlRecursive(Me, "Form"), HtmlForm) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-03-01T19:30:36.923

这是对我有用的 VB.NET 代码：

```
<Extension()> _
Function FindChildControlById(ByVal controlToStartWith As Control, ByVal controlIdToFind As String) As Control
    If controlToStartWith Is Nothing Then Return Nothing
    If controlToStartWith.ID = controlIdToFind Then Return controlToStartWith
    For Each childControl As Control In controlToStartWith.Controls
        Dim resCtrl As Control = FindChildControlById(childControl, controlIdToFind)
        If resCtrl IsNot Nothing Then Return resCtrl
    Next childControl
    Return Nothing
End Function ' Function FindChildControlById(ByVal controlToStartWith As Control, ByVal controlIdToFind As String) As Control 
```

最初的 VB.NET 代码要归功于 George。我只修改了一点点，有 2 个功能更改：如果/当 null/Nothing 作为输入控件传递时，我的不会出错，而我的作为扩展实现。我的其他 3 个小更改不会影响功能，但对我来说，它们是代码简化。但我知道这是非常主观的。

所以这个方法可以用于：

```
Dim c1 As Control = Page.FindChildControlById("aspControlID") 
```

如果您想将其转换为 Control 的特定子类，如下所示：

```
Dim c1 As Control = Page.FindChildControlById("aspControlID")
Dim c As HyperLink = TryCast(c1, HyperLink) 
```

更新：我的函数现在被命名为“FindChildControlById”（以前是“FindMiControl”）。我更喜欢 SpeedNet 的建议。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-28T20:31:37.713

当它呈现 html 时，ASP.NET 将在所有控件 ID 前面加上命名容器（用户控件等）的 ID，在一个层次结构中一直追溯到文档根目录。这确保了所有 ID 对于回发等都是唯一的。

这不会影响使用 FindControl，您应该在原始标记中使用 ID。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T20:32:37.930

这是有关如何命名 Web 表单控件的参考...

[Web 表单控件标识](http://msdn.microsoft.com/en-us/library/1d04y8ss.aspx)

# windows - 在 Windows 上重命名正在运行的进程的文件映像

> ID：799656
> 
> 赞同：2
> 
> 时间：2009-04-28T20:21:29.360
> 
> 标签：windows, service, process, filenames

我在 Vista SP1 上有一个 Windows 服务应用程序，我发现用户正在重命名其可执行文件（在它运行时）然后重新启动，从而导致它在下次启动时无法启动，因为服务管理器无法再找到 exe文件，因为它已被重命名。

我似乎记得在旧版本的 Windows 中你不能这样做，因为操作系统在文件上设置了锁。即使使用 Vista SP1，我仍然无法在现有文件运行时复制它 - Windows 报告该文件正在使用中 - 是有道理的。那么为什么我应该被允许重命名呢？如果 Windows 需要从 exe 中调入新的代码页，但文件自启动后已被重命名，会发生什么情况？我在重命名 exe 文件等时运行了 Process Monitor，但 Process Mon 没有报告任何奇怪的事情，只是像任何其他文件一样记录了更改文件名。

有谁知道幕后发生了什么？Windows 允许更改正在运行的进程的文件名（或其依赖的 DLL）似乎违反直觉。我在这里想念什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T20:28:44.333

你的概念是错误的......文件名不是文件io宇宙的中心......打开文件的句柄是。重命名文件时，文件不会移动到磁盘的不同部分，它仍然在同一个位置，并且打开文件的内部数据结构的磁盘部分仍然指向同一个位置。底线是你的观察是正确的。您可以重命名正在运行的程序而不会引起问题。重命名后，您可以创建一个与正在运行的程序同名的新文件。如果您想在软件运行时更新软件，这实际上是有用的行为。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T20:24:10.960

只要文件仍然存在，Windows 仍然可以从中读取 - 重要的是底层文件，而不是它的名称。

我可以愉快地重命名我的 XP 机器上正在运行的可执行文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T20:36:09.543

The OS keeps an open handle to the `.exe` file,. Renaming the file simply changes some filesystem metadata about the file, without invalidating open handles. So when the OS goes to page in more code, it just uses the file handle it already has open.

Replacing the file (writing over its contents) is another matter entirely, and I'm guessing the OS opens with the `FILE_SHARE_WRITE` flag unset, so no other processes can write to the `.exe` file.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T20:46:54.960

Might be a stupid question but, why do users have access to rename the file if they are not suppose to rename the file? But yeah, it's allowed because, as the good answers point out, the open handle to the file isn't lost until the application exits. And there are some uses for it as well, even though I'm not convinced updating an application by renaming its file is a good practice.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T20:56:57.310

您可能会考虑让您的服务侦听对安装服务的目录的更改。如果它检测到重命名，那么它可以将自身重命名回它应该是的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-16T14:02:26.817

*这里文件*的概念有两个方面：

1.  磁盘上的**数据**- 那是实际的文件。

2.  您可以提供该数据的**文件名（可以是多个或没有） - 称为目录条目。**

您正在重命名的是**目录条目**，它仍然引用相同的**数据**。Windows 并不关心您这样做，因为它仍然可以在需要时访问数据。正在运行的进程映射到**数据**，而不是名称。

# html - 如何获得三列，兄弟 div，每个扩展以填充其父级？

> ID：799672
> 
> 赞同：0
> 
> 时间：2009-04-28T20:28:47.703
> 
> 标签：html, stylesheet

我一直在寻找。对不起，我现在很绝望，所以我想我会在这里问。下面是一个 HTML 示例。当 B 列长于单个页面时（视口，抱歉，我不确定此处的术语是否正确），则 A 和 C 不会在高度上扩展以填充容器 div。它们填满整个页面，但即使 B 列比单页长，它们也会以单页长度停止。任何想法，我一直在拔头发。我一直在玩高度和最小高度，但似乎没有任何效果。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Untitled Page</title>
        <style type="text/css">
            html, body 
            {
                height: 100%;
                background-color: gray;
                padding: 0;
                margin: 0;
            }

            #container
            {
                height: 100%;
                margin: auto;
                padding: 0px;
                width: 610px;
            }

            #a
            {
                width: 5px;
                min-height: 100%;
                float: left;
                background-color: yellow;
            }

            #b
            {
                width: 600px;
                background-color: Blue;
                float:left;
                min-height: 100%;
            }

            #c
            {
                width: 5px;
                float:left;
                min-height: 100%;
                background-color: green;
            }
        </style>
</head>
<body>
        <div id="container">
            <div id="a"></div>
            <div id="b">
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
                <p>more</p>
            </div>
            <div id="c"></div>
    </div>
</body>
</html> 
```

编辑：在我浪费时间向我解释水平抓取一个像素然后平铺之前，设计师给了我一个垂直渐变。顶部开始变暗，结束变浅。那以及阴影效果。阴影水平运行。因此，据我所知，没有办法对其进行切片，然后巧妙地使用平铺。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T20:35:47.327

到目前为止，最简单的方法是使用单行表而不是 div。表格可能不是超级酷的做事方式，但归根结底，与尝试使用 css 实现相同目标相比，它们的代码量要少得多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T20:57:06.607

你见过[假柱子](http://www.alistapart.com/articles/fauxcolumns/)的把戏吗？

# javascript - 仅 Javascript 正则表达式文本框

> ID：799674
> 
> 赞同：4
> 
> 时间：2009-04-28T20:29:24.973
> 
> 标签：javascript, regex, textbox

我能够在 c# / .net 中找到解决方案，但对于常规的 web html 却没有。如果已经有答案，请告诉我，我会结束问题。

如何根据给定的正则表达式（例如 [a-zA-Z0-9]）创建一个仅允许某些字符（例如字母数字）的文本框？因此，如果用户尝试输入任何其他内容（包括粘贴），则会将其删除或不允许。

```
<input type="text" class="alphanumericOnly"> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-28T20:41:22.633

基本功能是这样的：

```
string = string.replace(/[^a-zA-Z0-9]/g, '') 
```

这将替换任何未描述的字符`[a-zA-Z0-9]`。

现在您可以将其直接放入元素声明中：

```
<input type="text" class="alphanumericOnly" onkeyup="this.value=this.value.replace(/[^a-zA-Z0-9]/g, '')"> 
```

或者（当您使用类提示时）您将此行为分配给`input`具有类的每个元素`alphanumericOnly`：

```
var inputElems = document.getElemenstByTagName("input");
for (var i=0; i<inputElems.length; i++) {
    var elem = inputElems[i];
    if (elem.nodeName == "INPUT" && /(?:^|\s+)alphanumericOnly(?:\s+|$)/.test(elem.className) {
        elem.onkeyup = function() {
            this.value = this.value.replace(/[^a-zA-Z0-9]/g, '');
        }
    }
} 
```

但使用[jQuery](http://jquery.com/)或其他 JavaScript 框架可能更容易做到这一点：

```
$("input.alphanumericOnly").bind("keyup", function(e) {
    this.value = this.value.replace(/[^a-zA-Z0-9]/g, '');
}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2019-04-01T19:53:12.597

1.  关于如何允许使用字母数字字符和空格的示例（az、AZ、0-9 和空格，其他字符在键入时被排除）：

```
$('#some_input_field_id').unbind('change keyup paste mouseup').bind('change keyup paste mouseup', function(){if(this.value.match(/[^a-zA-Z0-9 ]/g)){this.value = this.value.replace(/[^a-zA-Z0-9 ]/g, '');}}); 
```

2.  关于如何只允许小写字母字符的示例（az，其他字符在键入时被消除）：

```
$('#some_input_field_id').unbind('change keyup paste mouseup').bind('change keyup paste mouseup', function(){if(this.value.match(/[^a-z]/g)){this.value = this.value.replace(/[^a-z]/g, '');}}); 
```

ETC...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T20:42:59.963

假设您将输入存储为变量`input`...

```
input.onkeyup(function(e) {
  this.value = this.value.replace(/\W/g, '');
} 
```

每次按键后，输入的值将被删除任何非字母数字字符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-16T19:14:30.720

如果您在 keyup 事件上使用 .replace 方法，输入将在输入时闪烁非字母数字字符，这看起来很草率并且不符合像我这样的强迫症患者。

一种更简洁的方法是绑定到 keypress 事件并在字符到达输入之前拒绝字符，如下所示：

```
$('.alphanumericOnly').keypress(function(e){
    var key = e.which;
    return ((key >= 48 && key <= 57) || (key >= 65 && key <= 90) || (key >= 95 && key <= 122));
}); 
```

如果此特定设置不适合您的特定需求，可以在[此处找到基本键码列表。](http://www.cambiaresearch.com/articles/15/javascript-char-codes-key-codes)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-04-01T10:04:28.727

我注意到至少在我的情况下，使用`paste`and`drop`事件，替换文本不起作用，因为此时`value`输入的属性仍然是前一个。所以我这样做了：

使用纯 JavaScript：

```
function filterInputs() {
  var that = this;
  setTimeout(function() {
    that.value = that.value.replace(/[^a-zA-Z0-9]/g, '');
  }, 0);
}

var input = document.getElementById('theInput');

input.addEventListener('keyup', filterInputs);
input.addEventListener('paste', filterInputs);
input.addEventListener('drop', filterInputs);
input.addEventListener('change', filterInputs);
```

```
Try writing non-alphanumeric characters: <input type="text" id="theInput">
<br>You can use this input to write anything and copy-paste/drag & drop it into the other one: <input type="text">
```

使用 jQuery：

```
function filterInputs() {
  var that = this;
  setTimeout(function() {
    that.value = that.value.replace(/[^a-zA-Z0-9]/g, '');
  }, 0);
}

$('#theInput').on('keyup paste drop change', filterInputs);
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
Try writing non-alphanumeric characters: <input type="text" id="theInput">
<br>You can use this input to write anything and copy-paste/drag & drop it into the other one: <input type="text">
```

# java - Java半透明选择框

> ID：799675
> 
> 赞同：2
> 
> 时间：2009-04-28T20:29:45.173
> 
> 标签：java

对于自定义渲染，我创建了一个扩展 JPanel 并覆盖 paintComponent 方法的类。在自定义paintComponent 中，我渲染了多个保存在数组中的形状对象。我想添加的是拖动和选择一个或多个形状的能力。在拖动时，我想显示一个半透明的矩形，它定义了类似于在 Windows 资源管理器中看到的选择区域。任何人都可以提供实现这一目标的起点吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T04:58:42.143

我在 JFreeChart 的源代码中看到了一种有趣的方法。您可以在图表的一部分上绘制选取框，当您释放鼠标时，图表会放大所选区域。重新绘制图表很昂贵，不幸的是 JFreeChart 不支持图表的部分绘制。因此，为了绘制选框，他们以可逆的方式对组件的颜色进行某种按位操作。每次鼠标在选择选取框时移动，您都会在旧坐标上反转之前的按位操作，然后在新坐标上重做。

看看 JFreeChart 中的 ChartPanel.java

```
private void drawZoomRectangle(Graphics2D g2) {
    // Set XOR mode to draw the zoom rectangle
    g2.setXORMode(Color.gray);
    if (this.zoomRectangle != null) {
        if (this.fillZoomRectangle) {
            g2.fill(this.zoomRectangle);
        }
        else {
            g2.draw(this.zoomRectangle);
        }
    }
    // Reset to the default 'overwrite' mode
    g2.setPaintMode();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T20:31:50.317

您可以使用[JXLayer](https://jxlayer.dev.java.net/)。将它跨越整个表格并按照惯例进行绘画`LayerUI`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T18:09:38.077

全部，

感谢您的建议。最后通过修改这个相当聪明的演示中使用的一些代码来解决这个问题。[http://forums.sun.com/thread.jspa?threadID=5299064&start=19](http://forums.sun.com/thread.jspa?threadID=5299064&start=19)

```
public class ExamplePanel extends JPanel
{
    Rectangle2D.Double selectionRect;
    Point mouseDown, mouseHere;

   ...

    protected void paintComponent(Graphics g)
    {
        AlphaComposite ta = AlphaComposite.getInstance(AlphaComposite.SRC_OVER, 0.1f);
        g2d.setComposite(ta);
        g2d.setColor(Color.BLUE);
        g2d.fill(selectionRect);
        g2d.setComposite(AlphaComposite.SrcOver);
        g2d.setColor(Color.BLACK);
        g2d.draw(selectionRect);
    }
}

public class ExammpleMouseListener extends MouseAdapter    
{    
    @Override
    public void mousePressed(MouseEvent e)
    {      
        super.mousePressed(e);

        // store the mouse down location
        pnl.mouseDown = e.getPoint();
    }

    /**
     * @see  java.awt.event.MouseAdapter#mouseDragged(java.awt.event.MouseEvent)
     */
    @Override
    public void mouseDragged(MouseEvent e)
    {
        super.mouseDragged(e);

        // check for left mouse button
        if ((e.getModifiersEx() & InputEvent.BUTTON1_DOWN_MASK) == 0)
        {
            return;
        }

        // store the current location
        pnl.mouseHere = e.getPoint();

        // calculate the size of the selection rectangle
        double downX = pnl.mouseDown.getX();
        double downY = pnl.mouseDown.getY();
        double hereX = pnl.mouseHere.getX();
        double hereY = pnl.mouseHere.getY();

        double l = Math.min(downX, hereX);
        double t = Math.min(downY, hereY);
        double w = Math.abs(downX - hereX);
        double h = Math.abs(downY - hereY);

        pnl.selectionRect = new Rectangle2D.Double(l, t, w, h);

        // queue a repaint of the panel
        pnl.repaint();
    }

    @Override
    public void mouseReleased(MouseEvent e)
    {
        super.mouseReleased(e);

        // clear the selection rectangle
        pnl.selectionRect = null;

        // queue a repaint of the panel
            pnl.repaint();
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T22:40:51.163

当然，这是一个简单的示例，其中包含创建和移动形状的方法。

```
class MyShape implements Shape {

   private Shape shape;

   public void createShape(Point p1, Point p2, ShapeType t) {
      switch(t) {
        case RECTANGLE: {
           shape = new Rectangle2D.Double(p1.x, p1.y, p2.x - p1.x, p2.y - p1.y);
           break;
        }
        ... (other shapes)
     }
  }

  public void moveShape(Point lastPoint, Point newPoint, ShapeType t) {
      int xOffset = newPoint.x - lastPoint.x;
      int yOffset = newPoint.y - lastPoint.y;
      switch(t) {
        case RECTANGLE: {
           double x1 = shape.getBounds().getX() + xOffset;
           double y1 = shape.getBounds().getY() + yOffset;
           double w = shape.getBounds().getWidth();
           double h = shape.getBounds().getHeight();
           shape = new Rectangle2D.Double(x1, y1, w, h);
           break;
        }
        ... (other shapes)
     }
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T22:51:07.127

对于某些组件（我不知道这是否适用于您在拖动时的组件）您可以设置背景并使用“透明颜色”

Color 类确实实现了透明度。

要使用它，您可以在 Color 构造函数中指定 alpha 值。

例如这是一个半透明的黑色背景：

```
 // 0: totally transparent 
         // 255: totally opaque, 
         // 192 semy transparent.
         this.setBackground(new Color( 0, 0, 0, 192 )); 
```

请参阅 [构造函数][1]

同样，我不确定这是否适用于您。试试看

[1]： http: [//java.sun.com/javase/6/docs/api/java/awt/Color.html#Color](http://java.sun.com/javase/6/docs/api/java/awt/Color.html#Color(int) (int, int, int, int)

# c - 以编程方式检索 OS X 命令行应用程序的绝对路径

> ID：799679
> 
> 赞同：25
> 
> 时间：2009-04-28T20:31:18.243
> 
> 标签：c, macos, unix

在 Linux 上，应用程序可以通过查询`/proc/self/exe`. 在 FreeBSD 上，它更复杂，因为您必须建立一个 sysctl 调用：

```
int mib[4];
mib[0] = CTL_KERN;
mib[1] = KERN_PROC;
mib[2] = KERN_PROC_PATHNAME;
mib[3] = -1;
char buf[1024];
size_t cb = sizeof(buf);
sysctl(mib, 4, buf, &cb, NULL, 0); 
```

但它仍然是完全可行的。然而，我找不到在 OS X 上为命令行应用程序确定这一点的方法。如果您在应用程序包中运行，则可以通过运行来确定它`[[NSBundle mainBundle] bundlePath]`，但由于命令行应用程序不在包中，这无济于事。

（注意：咨询`argv[0]`不是一个合理的答案，因为如果从符号链接启动，`argv[0]`将是该符号链接 - 不是调用可执行文件的最终路径。 如果愚蠢的应用程序使用调用并忘记正确初始化 argv，`argv[0]`也可能撒谎，`exec()`我在野外见过。）

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-06-21T22:53:33.207

该函数[`_NSGetExecutablePath`](https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/dyld.3.html "dyld 手册页")将返回可执行文件的完整路径（GUI 与否）。该路径可能包含符号链接、“ `..`”等，但[`realpath`](https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/realpath.3.html "真实路径手册页")如果需要，该函数可用于清理这些链接。有关[`man` `3` `dyld`](https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/dyld.3.html "dyld 手册页")更多信息，请参阅。

```
char path[1024];
uint32_t size = sizeof(path);
if (_NSGetExecutablePath(path, &size) == 0)
    printf("executable path is %s\n", path);
else
    printf("buffer too small; need size %u\n", size); 
```

这个函数的秘密在于，达尔文内核在`envp`创建进程时将可执行路径放在进程堆栈的紧跟数组之后。动态链接编辑器`dyld`在初始化时抓取它并保持指向它的指针。该函数使用该指针。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2011-11-16T09:29:56.683

我相信有更优雅的解决方案，它实际上适用于任何 PID，并且还直接返回绝对路径：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <errno.h>
#include <libproc.h>

int main (int argc, char* argv[])
{
    int ret;
    pid_t pid; 
    char pathbuf[PROC_PIDPATHINFO_MAXSIZE];

    pid = getpid();
    ret = proc_pidpath (pid, pathbuf, sizeof(pathbuf));
    if ( ret <= 0 ) {
        fprintf(stderr, "PID %d: proc_pidpath ();\n", pid);
        fprintf(stderr, "    %s\n", strerror(errno));
    } else {
        printf("proc %d: %s\n", pid, pathbuf);
    }

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-28T21:40:47.093

看起来答案是你不能这样做：

> > 我正在尝试实现类似 lsof 的功能，并收集大量有关正在运行的进程的统计数据和信息。如果 lsof 不是那么慢，我会很乐意坚持下去。
> 
> 如果你重新实现lsof，你会发现它很慢，因为它做了很多工作。
> 
> > 我想这并不是因为 lsof 是用户模式，更多的是它必须扫描任务的地址空间以寻找由外部寻呼机支持的东西。当我在内核中时，有没有更快的方法来做到这一点？
> 
> 不。 lsof 并不愚蠢；它正在做它必须做的事情。如果您只想要其功能的子集，您可能需要考虑从 lsof 源（可用）开始并对其进行修剪以满足您的要求。
> 
> > 出于好奇，是`p_textvp`用的吗？看起来它已设置为父母的`p_textvp`in `kern_fork`（然后被释放？？），但它没有在任何`kern_exec`例程中被触及。
> 
> `p_textvp`未使用。在 Darwin 中，proc 不是地址空间的根；任务是。任务的地址空间没有“vnode”的概念，因为它最初不一定是通过映射来填充的。
> 
> 如果 exec 要填充 p_textvp，它将迎合所有进程都由 vnode 支持的假设。然后程序员会假设有可能获得到 vnode 的路径，并且从那里可以短暂跳转到假设 vnode 的当前路径是启动它的路径，并且对字符串进行文本处理可能会导致应用程序包名称......如果没有实质性的惩罚，所有这些都无法保证。
> 
> —<a href="https://web.archive.org/web/20140109204230/http://lists.apple.com/archives/darwin-drivers/2005/Dec/msg00026.html" rel="nofollow noreferrer" >迈克·史密斯，达尔文司机邮件列表

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-09-08T20:41:12.147

这已经很晚了，但`[[NSBundle mainBundle] executablePath]`对于非捆绑的命令行程序来说效果很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-28T20:52:23.107

我认为没有保证的方式。如果 argv[0] 是符号链接，那么您可以使用 readlink()。如果命令是通过 $PATH 执行的，那么可以尝试一些：search(getenv("PATH")), getenv("_"), dladdr()

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T07:45:54.690

为什么不简单`realpath(argv[0], actualpath);`呢？确实，realpath 有一些限制（在手册页中记录），但它可以很好地处理符号链接。在 FreeBSD 和 Linux 上测试

```
    % ls -l foobar
    lrwxr-xr-x 1 bortzmeyer bortzmeyer 22 Apr 29 07:39 foobar -> /tmp/get-real-name-exe

    % ./foobar
    我的真实路径：/tmp/get-real-name-exe

```

```
#include <limits.h>
#include <stdlib.h>
#include <stdio.h>
#include <libgen.h>
#include <string.h>
#include <sys/stat.h>

int
main(argc, argv)
    int             argc;
    char          **argv;
{
    char            actualpath[PATH_MAX + 1];

    if (argc > 1) {
        fprintf(stderr, "Usage: %s\n", argv[0]);
        exit(1);
    }
    realpath(argv[0], actualpath);
    fprintf(stdout, "My real path: %s\n", actualpath);
    exit(0);
} 
```

如果程序是通过 PATH 启动的，请参阅 pixelbeat 的解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T10:13:51.723

[http://developer.apple.com/documentation/Carbon/Reference/Process_Manager/Reference/reference.html#//apple_ref/c/func/GetProcessBundleLocation](http://developer.apple.com/documentation/Carbon/Reference/Process_Manager/Reference/reference.html#//apple_ref/c/func/GetProcessBundleLocation)

GetProcessBundleLocation 似乎工作。

# jquery - jQuery Table Filter on Multiple Criteria

> ID：799694
> 
> 赞同：3
> 
> 时间：2009-04-28T20:35:38.390
> 
> 标签：jquery, filtering

I currently have a table with three drop down lists above it. As the user selects a value from each drop down to filter the results I'd like the table to hide the rows that do not fit ALL of the criteria selected so far. The closest I have gotten is this:

```
 $("#ReportControls #InventoryReports select").change(function(){

    $("#Report table tbody tr").hide();  

    var filterArray = new Array();
    filterArray[0] = $("#ddlStyle :selected").text()
    filterArray[1] = $("#ddlSize :selected").text()
    filterArray[2] = $("#ddlColor :selected").text()

    $.each(filterArray, function(i){
        if (filterArray[i].toString() != "Style" && filterArray[i].toString() != "Size" && filterArray[i].toString() != "Color")
        {
           $("#Report table tbody tr").find("td:contains('" + filterArray[i].toString() + "')").parents("tr").show();
        }
    });
}); 
```

The only issue with it is that it pulls back all rows that contain a certain size or a certain color or a certain style instead of just rows that are a certain size AND a certain color AND a certain style.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T21:35:34.580

在这种情况下：

```
$.each(filterArray, function(i){
if (filterArray[i].toString() == "Style" || filterArray[i].toString() == "Size" || filterArray[i].toString() == "Color") 
  {
  filterArray[i] == ""
  }
});
$("#Report table tbody tr").find("td:contains('" + filterArray[0].toString() + "')").find("td:contains('" + filterArray[1].toString() + "')").find("td:contains('" + filterArray[2].toString() + "')").parents("tr").show(); 
```

它总是会找到一个空白。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T21:23:14.203

代替

```
 $.each(filterArray, function(i){
    if (filterArray[i].toString() != "Style" && filterArray[i].toString() != "Size" && filterArray[i].toString() != "Color")
    {
       $("#Report table tbody tr").find("td:contains('" + filterArray[i].toString() + "')").parents("tr").show();
    }
}); 
```

你有没有尝试过：

```
var bolPass = true;
$.each(filterArray, function(i){
if (filterArray[i].toString() == "Style" || filterArray[i].toString() == "Size" || filterArray[i].toString() == "Color") 
  {
  bolPass = false
  }
});
if (bolPass) 
  {
  $("#Report table tbody tr").find("td:contains('" + filterArray[0].toString() + "')").find("td:contains('" + filterArray[1].toString() + "')").find("td:contains('" + filterArray[2].toString() + "')").parents("tr").show();
  } 
```

我认为这可能会给你你正在寻找的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T12:54:07.383

杰夫，感谢您的所有帮助。由于某种原因，我无法正确过滤。它总是回来时没有行。让它工作的最终代码是：

```
$("#ReportControls #InventoryReports select").change(function(){

    $("#Report table tbody tr").hide();          
    var filterArray = new Array();
    filterArray[0] = $("#ddlStyle :selected").text()
    filterArray[1] = $("#ddlSize :selected").text()
    filterArray[2] = $("#ddlColor :selected").text()

    $.each(filterArray, function(i){
        if (filterArray[i].toString() == "Style" || filterArray[i].toString() == "Size" || filterArray[i].toString() == "Color")
        {
            filterArray[i] = "";
        }
    });   
    $("#Report table tbody tr").each(function(){
        if ($(this).find("td:eq(0):contains('" + filterArray[0].toString() + "')").html() != null
            && $(this).find("td:eq(1):contains('" + filterArray[1].toString() + "')").html() != null
            && $(this).find("td:eq(2):contains('" + filterArray[2].toString() + "')").html() != null)
        {
            $(this).show();
        }
    });  
}); 
```

任何想法为什么这有效？我尝试以另一种方式指定列号，但无法正常工作。

# asp.net - 一个 asp.net 应用程序中的多个登录页面

> ID：799704
> 
> 赞同：1
> 
> 时间：2009-04-28T20:37:01.583
> 
> 标签：asp.net

*   我有一个 asp.net Web 应用程序。
*   它使用两个会员提供者。
*   两个登录页面，每个提供商一个。
*   现在我在根文件夹 1 和文件夹 2 中有两个文件夹
*   Folder1 使用第一个会员提供者
*   Folder2 使用第二个会员提供者

我几乎可以在两个提供商中完成所有工作，包括登录、创建用户等。唯一的问题是表单身份验证我只能定义一个登录路径。因此，当会话到期或需要登录才能访问安全页面时。它只能重定向到一个登录页面。

该部分也不能按位置定义。仅通过应用程序。

**如何让 folder2 使用第二个登录页面？**

*   如果有什么我可以按位置定义的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T20:44:16.217

您需要`<location>`在 web.config 中使用该元素。您可以使用`<location>`标签将授权设置应用于单个文件或目录。

```
<location path="/root">
  <system.web>
      <authentication mode="Forms" >
        <forms name="LoginForm" defaultUrl="default.aspx" 
        loginUrl="/root/login.aspx" protection="Encryption" 
        timeout="30" path="/"/>
      </authentication>
    <authorization>
      <allow users="?" />
    </authorization>
  </system.web>
</location>
<location path="/root/admin">
  <system.web>
    <authentication mode="Forms" >
      <forms name="formName" defaultUrl="login.aspx" 
      loginUrl="/root/admin/login.aspx" protection="Encryption"
      timeout="30" path="/"/>
    </authentication>
    <authorization>
      <allow users="?" />
    </authorization>
  </system.web>
</location> 
```

[MSDN](http://msdn.microsoft.com/en-us/library/aa302435.aspx#c19618429_012)

> 对于集中管理，可以在 Machine.config 文件中应用设置。Machine.config 文件中的设置定义机器范围的策略，也可用于使用`<location>` 元素应用特定于应用程序的配置。开发人员可以提供应用程序配置文件来覆盖机器策略的各个方面。对于 ASP.NET Web 应用程序，Web.config 文件位于应用程序的虚拟根目录中，也可以在虚拟根目录下的子目录中。

如果您想要 1 个登录位置和不同的访问级别，您可能需要使用[角色](http://msdn.microsoft.com/en-us/library/system.web.security.roles.aspx)。

```
<location path="/root">
  <system.web>
    <authorization>
       <allow roles="admin,root" />/*admin, root is allowed */
       <deny users="*" /> 
   </authorization>
  <system.web>
</location>  

<location path="/root/admin">
  <system.web>
    <authorization>
       <allow roles="admin" />/*admin is allowed */
       <deny users="*" /> 
   </authorization>
  <system.web>
</location> 
```

> 用户可以属于多个角色。例如，如果您的站点是一个讨论论坛，则某些用户可能同时担任成员和版主的角色。您可以将每个角色定义为在站点上具有不同的权限，并且同时担任这两个角色的用户将拥有两组权限。
> 
> 如果您想以编程方式操作角色/身份验证，您可以在代码级别访问所有这些元素

```
Page.User.Identity.Name
Page.User.Identity.IsAuthenticated
Page.User.Identity.AuthenticationType
Page.User.IsInRole("string"); 
```

**附加链接**

**[在 asp.net 中使用 2 个成员资格提供程序](http://www.stevideter.com/2008/03/20/using-two-membership-providers-for-aspnet-logins/)**

[来自 Rolla 教程的 4 个人](http://www.4guysfromrolla.com/webtech/121901-1.2.shtml)

[揭秘 ASP.NET web.config 文件](http://www.sitepoint.com/article/web-config-file-demystified/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T21:05:02.640

请参阅[如何在某些情况下覆盖/更改 FormsAuthentication LoginUrl](https://stackoverflow.com/questions/748287/how-to-override-change-formsauthentication-loginurl-in-certain-cases)

从各种研究人员看来，您不能告诉 FormsAuthentication 有两个不同的登录页面。但是没有什么可以阻止您在两个文件夹中创建一些基本页面类或其他代码，这些代码可以确定要定向到哪个登录页面。或者，我认为 Application_BeginRequest 事件在 FormsAuthentication 模块触发之前触发，因此您可以在请求被 FormsAuthentication 重定向之前检查它们。但是，无论哪种方式，您都将被迫允许匿名用户访问 Folder1 和 Folder2，这并不理想。

# javascript - how can Javascript access location/selected text across frames when domain differs?

> ID：799708
> 
> 赞同：0
> 
> 时间：2009-04-28T20:37:51.880
> 
> 标签：javascript, frames

I have a page with a frameset, where I would like Javascript in one frame to access the selected text and location of the document in the other frame. I can do this using the getSelection() function and document.location parameter, but ONLY if the other frame is served by my local server. The javascript code returns null strings if the other frame comes from some other server e.g. amazon.com. What is the cause for this, and how can I get around it?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T20:39:45.073

It's part of the security model built into browsers. There's no way around it as far as I know.

# javascript - 获取图像宽度和高度

> ID：799710
> 
> 赞同：4
> 
> 时间：2009-04-28T20:38:02.610
> 
> 标签：javascript, jquery

当没有为图像指定样式时（jQuery 的 css() 返回 0），我需要在 javascript (jQuery) 中获取图像的尺寸。

也许是因为我在询问其尺寸之前使用 jQuery 加载图像。如果是这种情况，是否有任何事件可以告知图像何时加载？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T20:43:52.393

也许图像尚未完全加载，因此无法给出尺寸。但是如果没有您的代码，我无法判断您做错了什么，但这是一个可行的**示例**：

```
function LoadImage(isrc) {
    var oImg = new Image();
    oImg.src = isrc;
    if (oImg.complete) {
        window.alert(oImg.src + ' ' + oImg.width + ' x ' + oImg.height);
    }
    else {
        window.setTimeout('iLoad(imgsrc)', 1000);
    }
}

<body onLoad='LoadImage(imgsrc)'> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T20:43:34.593

这是一个有帮助的链接，请查看演示：[http ://docs.jquery.com/Events/load](http://docs.jquery.com/Events/load)

使用 jquery，当图像完成加载时会触发一个 load() 事件，即：

```
<script type="text/javascript">
    $(document).ready(function()
    {
        $('#theImage').load(function()
        {
            // do the stuff here.
        });
    });
</script>

<img src="blah.jpg" id="theImage" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T20:41:18.033

根据你在 image.width 或 image.naturalWidth （和高度等价物）之后的内容，width/height 给出了图像标签上的宽度/高度属性， naturalWidth/Height 给出了实际底层图像的尺寸。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T20:41:20.670

加载图像后，您可以使用[img 的 onload](https://developer.mozilla.org/en/XUL/Attribute/onload)获取尺寸：

```
<img src="..." onload="getDimensions(this)" /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T02:47:57.387

您可以尝试结合**karim79**和**John Boker**的答案。尝试将图像预加载到隐藏的 DOM 中，当它加载时，您可以尝试获取它的宽度和高度。

# xml - Example of a good Webservice

> ID：799713
> 
> 赞同：1
> 
> 时间：2009-04-28T20:38:54.997
> 
> 标签：xml, web-services, json, oauth, rpc

I'm tasked to design a new API for our infrastructure. Some of the things I'd like to do is:

*   implement oauth for authentication
*   good xml-based structure, adapting ATOM, GEO-RSS and other xml schema standards where applicable.
*   JSON output

Some of the things I've been thinking about is applying REST. In practice I find it's not as easy to grasp as a more 'method, argument, result'-RPC model.

Especially since there's no simple CRUD-model, but about 250 distinct operations it doesn't make a lot of sense for me.

Some of the things I'm wondering, is how I should create a good mapping between JSON-format and namespaced XML format. If this doesn't work intuitively, I'll manually map all the data-types.

So basically, I'm wondering what you think, and if you have any examples of API's that were complex, but easy to use.

In case you were wondering, SOAP is out of the question.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T20:49:56.280

英国报纸[卫报](http://www.guardian.co.uk/)有一个优秀的（新的）[API](http://www.guardian.co.uk/open-platform)。它很大，有许多客户端库，并且有一个非常好的[API 浏览](http://api.guardianapis.com/docs/)器——它在你的浏览器中用作一个拆分窗格，并带有一个实时控制台来玩 API。

# php - 如何取消已运行的 ajax 请求（在服务器端）

> ID：799717
> 
> 赞同：13
> 
> 时间：2009-04-28T20:39:08.567
> 
> 标签：php, ajax, request-cancelling

我想知道是否有一种简单的方法可以取消 AJAX 请求？

除了在客户端调用 XMLHTTPRequest 的“中止”之外，有没有办法轻松停止服务器进程？服务器正在使用 Apache。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-28T20:44:38.883

不，绝对没有简单的方法。

我可以想到一些复杂的方法，但它们是不可靠的。

您可能会更幸运地开发一个流程来*扭转*您刚刚运行的请求的更改（我假设这就是您想要停止它的原因。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-11T01:34:22.530

启动另一个 Ajax 请求。我通过试图弄清楚如何防止先前的请求在另一个请求被调用时被中断而找到了这个线程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-28T02:46:00.110

没有好的方法可以通过网络停止请求本身（正如许多人所说），但是停止请求的影响相对容易。IE

在服务器端：您可以`exit`（或您需要终止脚本的任何术语）通过不断检查全局变量（充当标志），如 cookie 或会话（再次假设这些在脚本执行期间会发生变化）。此外，您可以将文件或数据库条目保留为标志（您可以轮询是否存在）。

在客户端：您可以调用`abort`（这在所有浏览器中都不起作用，就像其他人所说的那样），或者您可以在回调顶部保留一个全局信号量/标志（检查全局值以查看它是否是否仍应执行）。例子：

```
 window.ajaxIsStillGood = true;

 xhr.onreadystatechange = function( )
 {
     if( 4 === xhr.readyState && 200 === xhr.status )
     {
         if( true === window.ajaxIsStillGood ){ /* still good */ }
     }
 }

 /* bad stuff happens */

 window.ajaxIsStillGood = false; // now the code won't execute 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-12-07T12:20:10.653

对于 PHP，我找到了一种使用`session_write_close();`. 把它`session_start()`放在你的脚本上。如果您使用的是框架或 OOP，请将其保留为方法的第一行。发生这种情况是因为会话数据在 ajax 完成之前被锁定。

测试并看到另一个页面现在正在加载`xhr.abort()`

此处找到的解决方案提示 [Abort Ajax requests using jQuery](https://stackoverflow.com/questions/446594/abort-ajax-requests-using-jquery)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T20:48:21.930

最简单的方法是发送一个 503（或类似的）HTTP 响应头并中止服务器端应用程序（或只是中止应用程序）。假设没有发送数据和/或您检查了 HTTP 响应标头客户端，您可以将其视为失败的请求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T20:50:35.467

最简洁的答案是不”。除非您在服务器端谈论一个运行时间很长的后台进程，在这种情况下，您可以让第二个 Ajax 请求在其上启动停止。但是，如果您正在谈论对 Apache/PHP 服务器的常规请求，那么不...确定您的请求在哪个 Apache 线程中运行就很麻烦了。

在开始流程之前以某种方式验证您的 Ajax 请求会容易得多；确保它是你想要运行的。如果您需要用户知道他们正在做的事情不能被打断，您也可以有一个 Javascript 确认过程。

正如史蒂文所说，有一个逆转过程听起来也可能符合你的最大利益。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-29T05:58:53.737

如何发送另一个 Ajax 请求来更改`$_SESSION`由该长进程监控的特定 var？

# software-quality - Feature bloat - how much is too much?

> ID：799728
> 
> 赞同：2
> 
> 时间：2009-04-28T20:41:34.507
> 
> 标签：software-quality

I'm a computer science student designing a project and I've started wondering what are good examples or software, or even hardware that are toeing the line between being feature rich with good usable features for regular users and being too intimidating for new users. Also could anyone recommend any good tips/books for designing good quality applications that are feature rich but not "bloated"?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T20:44:01.503

> "Make everything as simple as possible, but not simpler." - Albert Einstein
> 
> "Perfection is reached not when there is nothing left to add, but when there is nothing left to take away." - Antoine de Saint-Exupéry

* * *

I am not trying to be flippant but these quotes really are the best advice. Simplicity of design should be your goal. Not that achieving simplicity is easy! On the contrary, it is quite difficult but it is possible.

Try thinking about things a bit differently. Rather than

> How many things can I add before this becomes bloated?

try

> What are the fewest number of features and elements I can include while still providing a superior experience for my users?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T20:46:42.013

Here's a good set of slides from a presentation on the topic: [Rescue Princess 2.0](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Flostgarden.com%2F2008%2F10%2Fprincess-rescuing-application-slides.html&ei=a2r3SZCLBZmstge-6d2uDw&usg=AFQjCNFYbf35IgNt0kjnHA4---Ux2EPpKA&sig2=nHvmVVGEw3CzKEi5ZwgqqA).

The first order of business should just be keeping the application easy to use. Beyond that, all I can say is, beware of writing features for an imaginary user: make sure someone actually needs it before you start coding.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T21:12:44.697

作为对您问题的直接回答：几乎所有 Microsoft 产品。我在这里表达了我的偏见，但微软有一种强烈的趋势，即保留他们的代码库，并在功能之上添加功能，直到应用程序的原始功能几乎在堆积如山的垃圾堆下消失。

例如，查看 MS Word；虽然您仍然可以打开它并开始输入，但如果您想重新编号文档的一部分而留下其余部分，那么上帝禁止。如果您想生成一个包含对附录的引用的目录，那么天堂禁止。这类东西是文字处理器的必备工具，Word 支持它，它只是支持它，如果没有手册、几杯咖啡和绷带来止血，你就无法完成它。头放在桌子上。

微软并不是唯一这样做的。这种事情总是会发生，各种产品；但我发现他们是最严重的罪犯之一。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T20:47:34.943

1: What do your users need, and want, and

2: Which features will you have time to implement?

Your question is pretty general. Which features constitute bloat? That kind of depends on whether you're writing an antivirus scanner, an OS or a word processor.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T20:47:59.250

There is no clear barrier between "good" and "too much". However, it depends on what you want to do.

If you're developing a SDK, I recommend splitting your implementation in several small libraries(rather than just one big SDL library, there is the SDL core, `SDL_Mixer`, `SDL_Image`, etc.)

If you're developing an application, keep a module-based system and a plug-in mechanism. That way, new features can be added more easily and bloat can be more easily detected.

You may get to a point where you'll add new features some will consider "great" and others "bloat". Otherwise, your application may reach a point that some will call it "feature-poor" and others will call it "just enough".

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T20:56:02.990

这不是一个确切的报价，但这个想法是这样的：

> 一个软件不是完美的，不是没有什么可添加的，而是没有什么可删除的。

从本质上讲，软件越简单、越切题越好。

要获得优秀软件设计的示例，请查看当今流行的程序。谷歌应用程序将是一个不错的地方。也许是 Skype。嘿，甚至是 StackOverflow。:)

如果您想吓人，请前往 CAD 世界。查看例如[Blender](http://www.blender.org/)。这是一个免费的 3D 设计器软件。有人告诉我是个好工具，但 UI 有很多按钮/面板/菜单/等。它让小兔子哭泣。不幸的是，我不能说这是否是“糟糕”用户界面的一个很好的例子。3D 设计是一个*非常*复杂的过程，所有这些工具可能都在正确的位置。但这绝对是令人生畏的。:)

使用专有硬件附带的专有软件通常会发现糟糕的 UI 设计。不幸的是，我无法从我的脑海中给你任何例子。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-02T18:07:13.050

I always tend to design my projects in a way that they're just skeletons which are as extensible as possible. Limiting factors are performance, complexity or Thirdparty-limitations.
This way you could add additional features after finishing the basic structure. A user could also add his needed features.

This probably does not work very good for GUI-applications which should have a good usability without much configuration, but I'm sticking good with this approach for those libs I develop. (They're used by other coders who like to have a highly modifable piece of software)

It's not very hard to develop an application/lib which is bloated with features. But it is to develop an app which could be easily extended by other developers/users to match their own needs.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-09-30T12:41:12.630

开发一个范围广泛的插件系统，以便您随时添加和取出内容。问题解决了。如果这就像编写意大利面条代码一样简单。;)

# asp.net - Can I access virtual directory name in global.asax.cs?

> ID：799729
> 
> 赞同：7
> 
> 时间：2009-04-28T20:42:13.007
> 
> 标签：asp.net, requestcontext

The property `HttpContext.Current.Request.ApplicationPath` represents the virtual directory in IIS or WebDev.WebServer.

```
 HttpContext.Current.Request.ApplicationPath evaluates to "/virtualdirectory" 
```

This can be used in conjunction with `VirtualPathUtility` to make a path root relative :

```
 VirtualPathUtility.ToAbsolute("~/images/cat.jpg",
                               HttpContext.Current.Request.ApplicationPath)

 // (this evaluates to "/virtualdirectory/images/cat.jpg") 
```

In IIS6 and WebDev.WebServer the Request object **is** available in `global.asax.cs`, but IIS7 complains that it is 'not available in current context'. Therefore the second line of code above works but not in IIS7.

The problem is I need to access the virtual directroy name within `global.asax.cs`. I need it to construct some paths that are used in dynamically created CSS. Is there an alternative way to access this value?

**Edit:** This is the error you get in IIS 7 for calling `HttpContext.Current.Request` in global.asax.cs under Application_Start:

```
 HttpException (0x80004005): Request is not available in this context]
    System.Web.HttpContext.get_Request() +8789264 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-01-03T05:02:08.140

终于找到了简单的答案！

```
 HttpRuntime.AppDomainAppVirtualPath 
```

Application_Start 期间立即可用

这是`/myapplication`包含`/`前缀的形式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T20:48:11.417

Can you use ResolveUrl("~/images/cat.jpg") to build your path?

**Edit:** ResolveUrl is a method of Control, not just the Page class, so you can do it this way instead (bit ugly maybe):

```
System.Web.UI.Control c = new Control();
String s = c.ResolveUrl(@"~/images/cat.jpg"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T09:02:15.833

这是我想出的最好的：Application_BeginRequest（通过标记）

我很少使用 asax，以至于我暂时忘记了你会得到不同的事件。到目前为止，我一直在创建 CSS 精灵`Application_Start`。将它移到 BeginRequest 是我能想到的最好的方法。

对每个请求进行一次布尔检查可以忽略不计，但如果有不同的方法会很好。

```
 protected void Application_Start()
    {
        RegisterRoutes(RouteTable.Routes);
    }

    protected void Application_BeginRequest()
    {
        if (!_initialized)
        {
            lock (thisLock)
            {
                _initialized = true;
                GenerateCSSSprites();  
            }
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T09:02:46.237

切换到 IIS7 时我也遇到了这个问题，但我能够重构出对 Request 的需求。如果你不能，这也是这个人的建议并提供一种解决方法。

[http://mvolo.com/blogs/serverside/archive/2007/11/10/Integrated-mode-Request-is-not-available-in-this-context-in-Application_5F00_Start.aspx](http://mvolo.com/blogs/serverside/archive/2007/11/10/Integrated-mode-Request-is-not-available-in-this-context-in-Application_5F00_Start.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T08:29:36.440

嗯...我不知道 IIS7 的变化。*我想知道在你有*一个页面之前推迟这个操作是否会更简单。例如，您可以尝试在`Application_BeginRequest`or中放入“仅一次”的内容`Session_Start`。

或者（完全未经测试）用于自退订挂钩：

```
 public override void Init() {
        base.Init();
        EventHandler handler = null;
        handler = delegate {
            // do stuff, once only
            this.BeginRequest -= handler;
        };
        this.BeginRequest += handler;
    } 
```

诀窍是只做一次（如果多个请求同时到达）；也许是静态演员？例如，我认为这只会触发一次，并且仅在上下文中有可用页面时触发：

```
 static class DelayedLoader {
        static DelayedLoader() {
            string s = VirtualPathUtility.ToAbsolute("~/images/cat.jpg",
                           HttpContext.Current.Request.ApplicationPath);
        }
        [MethodImpl(MethodImplOptions.NoInlining)]
        public static void Init() { }
    }
    public override void Init() {
        base.Init();
        EventHandler handler = null;
        handler = delegate {
            DelayedLoader.Init();
            this.BeginRequest -= handler;
        };
        this.BeginRequest += handler;
    } 
```

# c# - How to pass control to a method

> ID：799731
> 
> 赞同：5
> 
> 时间：2009-04-28T20:43:02.007
> 
> 标签：c#, methods

I want to create a method that changes enabled property. How do I pass the contorl name and property to a method.

If the following were my original method:

```
public void ChangeProperties()
{ 
     btnAcesScore.Enabled = true;
} 
```

I want to be able to change the "btnAcesScore" each time I call this method. How do I pass this to the method. I tried passing it as a string but that doesn't work.

Here is what I tried:

```
public void ChangeProperties(string category)
{ 
     category = true;
}

ChangeProperties("btnAcesScore.Enabled"); 
```

Susan

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-28T20:46:16.117

Try this :

```
public void ChangeProperties(Control ctrl)
{ 
     ctrl.Enabled = true;
} 
```

and call it like that :

```
ChangeProperties(btnAcesScore); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T20:50:00.383

这样做的具体目的是什么？是重用方法来任意改变`Enabled`任何给定控件的属性吗？如果是这样，有一种更简单的方法来完成它，如[Canavar](https://stackoverflow.com/questions/799731/how-to-pass-control-to-a-method/799750#799750)所述。

或者这种方法的目的是**切换**设置？在这种情况下，您的方法将如下所示：

```
public void ChangeProperties()
{ 
     btnAcesScore.Enabled = !btnAcesScore.Enabled;
} 
```

或者

```
public void ChangeProperties(Control ctrl)
{ 
     ctrl.Enabled = !ctrl.Enabled;
} 
```

取决于您是只想点击一个控件，还是提供对多个控件的访问。无论如何，我个人认为在方法中封装单个属性访问没有多大意义，如果您坚持（并且此方法没有调整其他属性），我至少会将其重命名为`ToggleEnabled`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T21:06:38.830

由于最初的问题有一个反思标签，我认为她想要一个反思答案（无论这是否是好的设计）所以这里是一个反思答案。

该表单有一个控件集合，您可以通过它搜索它并使用反射来设置属性：

```
public void ChangeProperties(Form form, string category)
{
   string[] parts = category.Split(".");
   int index = form.Controls.IndexOfKey(parts[0]);

   Control control = null;
   if (index >= 0)
   {
     control = form.Controls[index].;
   }

   if (control != null)
   {
     PropertyInfo propertyInfo = control.GetType().GetProperty(parts[1]);
     if (propertyInfo != null)
     {
       propertyInfo.SetValue(control, true);
     }
   }
} 
```

如果您从控件存在的表单中调用它

```
ChangeProperties(this, "btnAcesScore.Enabled"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T20:47:12.823

How about also

```
void ChangeProperty(ref bool output)
{
    output = true;
}
ChangeProperty(ref btnAcesScore.Enabled); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T20:48:50.293

Not sure I totally understand your intent, but you could pass a delegate to some code that changed your property...

```
public void ChangeProperties(Action<bool> setprop)
{
    ...
    setprop(true);
} 
```

then call it:

```
ChangeProperties(b => btnAcesScore.Enabled = b); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T20:55:06.610

我会使用反射 - 在您发送给您的方法的对象上使用 GetType() 方法，然后使用 GetProperties 来匹配您发送的属性。然后，您可以在该点设置值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T21:26:17.160

尝试这个：

```
 public void ChangeProperties(string category, object value)
    {      
        var categoryConcat = category.Split('.');
        var control = this.Controls.Cast<Control>()
            .Where(x => x.Name == categoryConcat[0]).First();
        control.GetType().GetProperty(categoryConcat[1])
            .SetValue(control, value);        
    } 
```

该示例可能需要对控件和属性的存在进行一些检查。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-27T01:00:55.213

```
 Main()
   {
    ChangeProperties(ref category,True);    //Where Category is the ID  of the Textbox control  i.e <asp:textbox ID="Category "></textbox>
    }

   public void ChangeProperties(ref TextBox category,bool val)
    { 
      category.Enabled = val;
     } 
```

# javascript - 如何仅使用 javascript 将页面高度增加 X 像素

> ID：799743
> 
> 赞同：2
> 
> 时间：2009-04-28T20:44:46.307
> 
> 标签：javascript, html, css, dom

假设一个 HTML 页面：

```
<html>
  <body>
     .. html content (outside of our control) ..
     .. javascript block ..
     .. some more html content (outside of our control) ..
  </body>
</html> 
```

进一步假设我们能够控制的 HTML 页面的唯一部分是页面中间的一个 javascript 块。

使用该 javascript 块，如何通过“填充”页面底部将总页面高度增加 150 像素？

如果我可以更改 HTML，一个简单的解决方案是：

```
<html>
  <body>
     .. html content (outside of our control) ..
     .. javascript block ..
     .. some more html content (outside of our control) ..
     <div style="height: 150px; clear: both;"></div>
  </body>
</html> 
```

但是我如何仅通过使用 javascript 块来实现这一点？

理想的解决方案应该是跨浏览器兼容和 100% 内联（即不使用 javascript 库）。

**更新 #1：** javascript 块可以访问页面的整个 DOM。

**更新 #2：**页面的总长度（在更改 DOM 之前）会有所不同。

**更新 #3：**假设不能使用任何 javascript 库（例如出色的 jQuery）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T20:49:15.253

更新代码：

```
var space = document.createElement('div');
space.style.height = "150px";
space.style.clear = "both";
document.getElementsByTagName("body")[0].appendChild(space); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T20:48:02.883

你能通过 javascript 生成 DOM 元素，然后简单地将该 div 添加到底部吗？

如果我有任何代表，我会投票给 cobbal ......呵呵。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T20:52:16.150

$('body').append($('<div style="height: 150px; clear: both;"></div>'));

也许

# vb.net - Using the Office Interop for Word and Outlook 2007 in VB.NET

> ID：799747
> 
> 赞同：1
> 
> 时间：2009-04-28T20:45:39.100
> 
> 标签：vb.net, visual-studio-2008, outlook-2007, office-interop, word-2007

I need interop in my programs to automate several functions in Word and Outlook. Does anyone know a good place to start. My goal is to kick off a mail merge, create several different files and save them accordingly, then e-mail the different files to different people based upon who needs what. Any help learning how to use the interop properly would be greatly appreciated.

I am currently using Visual Studio 2008 and Office 2007 and use vb.net to write my programs.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T21:05:03.530

开始的一个好方法是使用宏编辑器记录您尝试执行的步骤。您可以获取生成的宏代码并对其进行修改以适应您的目的。单击您不知道用途的函数和变量的名称，然后按“F1”以获取特定于上下文的帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-29T18:35:11.487

添加对 Outlook 12.0 对象库和 Word 12.0 对象库的 COM 引用。

这个网页真的帮助我开始了：http: [//support.microsoft.com/kb/316383](http://support.microsoft.com/kb/316383)

然后，通过录制宏，您将公开很多您可能想要使用的东西。然而，警告是，并非所有在 VBA（宏）中公开的内容都可以在 VB .NET 中访问。我不知道为什么会这样，但实际上我必须在 Excel 中从 VB.NET 构建和执行一个宏，用 VBA 编写，以完成一些看起来非常容易的事情，如果不是因为它们之间的奇怪断开连接二。

有关邮件合并的一些好信息：http: [//support.microsoft.com/kb/258512](http://support.microsoft.com/kb/258512)

这是一篇文章，其中包含一些基本步骤，可帮助您启动并连接 Outlook 的互操作：http: [//support.microsoft.com/kb/313787](http://support.microsoft.com/kb/313787)

希望这可以帮助。我会留意你的问题——我想说我在互操作方面知道很多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-20T02:51:46.827

您可能想从这里开始：http: [//msdn.microsoft.com/en-us/office/bb266408.aspx](http://msdn.microsoft.com/en-us/office/bb266408.aspx)。

有很多教程。

# html - (rails) taking from DB and rendering into HTML

> ID：799753
> 
> 赞同：0
> 
> 时间：2009-04-28T20:46:44.620
> 
> 标签：html, ruby-on-rails, ruby

I'm building a website for my Web Dev class, and I'm stuck on rendering HTML. I want to be able to use a simple form (Pretty much all I have right now is a scaffold for this controller, and I attempted sticking a content_type into my controller, but no progress.) to submit text and have it rendered as HTML. The idea is that, since this class requires a bunch of crap copied out of the book as examples and reference for HTML, maybe I could serve them up in the same way as the blog posts. (All on the same page, using the same layout. The only thing that changes is a content div below the Blog list and the Data (Controller in question) list.

So, in short, my question is: How do I get text fetched from DB to render the html tags rather than displaying as plaintext?

Thank you, and please let me know if supplementary information is necessary. Cameron

Edit: (Adding code. It's really almost nothing past scaffolding, but, whatevs.) Also, not sure how the code snippet tool is supposed to work. I hope it folds.

```
 class DatapostsController < ApplicationController

```
before_filter :header 
```

def header
response.headers['Content-type'] = 'text/html; charset=utf-8'
end

# GET /dataposts
  # GET /dataposts.xml
  def index
    @dataposts = Datapost.all
    @posts = Post.all

```
respond_to do |format|
  format.html # index.html.erb
  format.xml  { render :xml => @dataposts }
end 
```

end

# GET /dataposts/1
  # GET /dataposts/1.xml
  def show
    @dataposts = Datapost.all
    @datapost = Datapost.find(params[:id])
    @posts = Post.all

```
respond_to do |format|
  format.html # show.html.erb
  format.xml  { render :xml => @datapost }
end 
``` `end
end`
```

* * *

This is the view where it's to be rendered. It's a partial that's called from a content_for that's called by the homepage.

```
<p>
  <small>Post title</small>
  <%=h @datapost.title %>
</p>
<hr />
<p>
  <%=h @datapost.body %>
</p>
<hr />
<hr />

<%= link_to 'Back', dataposts_path %> 
```

I'll go ahead and push what I have onto prod. server for an idea of what I want the functionality to be like.

[http://www.sanarothe.com](http://www.sanarothe.com) (~5 minutes after edit)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T23:18:28.780

`h`你在这里调用的方法：

```
<%=h @datapost.body %> 
```

也称为`html_escape`- 这是[文档中的相关链接](http://api.rubyonrails.org/classes/ERB/Util.html#method-c-html_escape)。删除它，您的 HTML 标记应该会正确呈现。

`h`您应该始终使用防止跨站点脚本攻击的方法显示您从用户那里获得的代码。但是，如果它是您从一本书（或其他任何东西）中抓取的代码，那应该没问题。

# python - 获取运行python脚本的Windows计算机的名称？

> ID：799767
> 
> 赞同：114
> 
> 时间：2009-04-28T20:49:11.600
> 
> 标签：python, windows, networking

我的网络上有几台 Windows 计算机，它们将运行 python 脚本。根据运行此脚本的计算机，应在脚本中使用一组不同的配置选项。

如何在 python 脚本中获取该计算机名称？

假设脚本在名为 DARK-TOWER 的计算机上运行，​​我想写这样的东西：

```
>>> python.library.get_computer_name()
'DARK-TOWER' 
```

我可以使用标准库或第三方库吗？

* * *

## 回答 #1

> 赞同：188
> 
> 时间：2009-04-28T20:57:22.783

事实证明有三个选项（包括前面已经回答的两个）：

```
>>> import platform
>>> import socket
>>> import os
>>> platform.node()
'DARK-TOWER'
>>> socket.gethostname()
'DARK-TOWER'
>>> os.environ['COMPUTERNAME']
'DARK-TOWER' 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-04-28T20:53:25.773

```
import socket
socket.gethostname() 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-04-28T20:53:12.077

来自[https://mail.python.org/pipermail/python-list/2006-April/397494.html](https://mail.python.org/pipermail/python-list/2006-April/397494.html)

```
import os
os.getenv('COMPUTERNAME') 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2016-01-13T17:29:57.170

正如 Eric Palakovich Carr 所说，您可以使用这三种变体。

我更喜欢一起使用它们：

```
def getpcname():
    n1 = platform.node()
    n2 = socket.gethostname()
    n3 = os.environ["COMPUTERNAME"]
    if n1 == n2 == n3:
        return n1
    elif n1 == n2:
        return n1
    elif n1 == n3:
        return n1
    elif n2 == n3:
        return n2
    else:
        raise Exception("Computernames are not equal to each other") 
```

在开发跨平台应用程序时，我更喜欢它；）

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-28T20:52:31.187

由于 python 脚本肯定会在 Windows 系统上运行，因此您应该使用 Win32 API [GetComputerName](http://msdn.microsoft.com/en-us/library/ms724295(VS.85).aspx)或[GetComputerNameEx](http://msdn.microsoft.com/en-us/library/ms724301(VS.85).aspx)

您可以获得完全限定的 DNS 名称、NETBIOS 名称或各种不同的东西。

```
import win32api
win32api.GetComputerName()

>>'MYNAME' 
```

或者：

```
import win32api
WIN32_ComputerNameDnsHostname = 1 
win32api.GetComputerNameEx(WIN32_ComputerNameDnsHostname)

>> u'MYNAME' 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-10-04T11:52:33.723

```
import socket
pc = socket.gethostname()
print pc 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-28T20:51:15.590

我敢打赌[gethostname](http://pydoc.org/1.6/socket.html#-gethostname)会很好地工作。

# silverlight - Silverlight 浏览器关闭事件

> ID：799771
> 
> 赞同：2
> 
> 时间：2009-04-28T20:50:28.183
> 
> 标签：silverlight, silverlight-2.0

当用户关闭承载我的 Silverlight 2 应用程序的浏览器时，我需要调用一个 Web 服务来注销用户。我知道 Application_Exit 事件，但是当我在该事件中调用我的服务时，什么也没有发生。我认为到那时与我的服务的连接已经关闭。

我应该使用另一个事件吗？

请帮忙。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T16:19:38.247

不要这样做。Silverlight 不支持在应用程序退出时调用服务。您需要服务自行清理，可能应用程序每隔几分钟/小时通知服务一次以延迟清理。 [链接到 Silverlight 论坛和相同的问题](http://silverlight.net/themes/silverlight/forums/thread.aspx?ThreadID=21704)

# c++ - 信号槽架构最佳实践

> ID：799780
> 
> 赞同：1
> 
> 时间：2009-04-28T20:53:00.237
> 
> 标签：c++, user-interface, architecture, signals-slots

我正在使用 libsigc++ 连接应用程序，并且不确定更简单的方法。

有一个预先存在的对象层次结构来管理数据层，并且顶层对象公开了所有功能。到目前为止一切都很好。

为此，我添加了一个 GUI 对象层次结构，并在应用程序对象中将它们与信号连接挂钩。要建立连接，我需要指向发送者和接收者的指针。

现在，我是否直接在树中很远的地方挂接子小部件，从而需要在树上上下传递指针？

或者，我是否在链中的每一步都经历了挂接信号和插槽的艰苦过程？

一方面，传递指针打破了 sig-slot 模型给你带来的分离。另一方面，在每一步创建连接似乎与 sig-slot 应该提供的所谓的“事件心灵感应”不符。

有此模型经验的人会考虑使用默认方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T21:15:32.567

就个人而言，我认为使用信号/插槽机制“跳过”层没有任何问题。我更喜欢这样看：一个组件正在向野外发送信号，任何对这些信号感兴趣的人都可以收听它们。

一些提示：避免发送过于通用的信号，并且不要依赖槽的执行顺序（如果为给定信号调用了许多槽）。

# actionscript-3 - 如何使用 ActionScript3/PHP 从 swf 导出图像？

> ID：799784
> 
> 赞同：1
> 
> 时间：2009-04-28T20:54:12.917
> 
> 标签：actionscript-3, image, flash, export

我为比我更高级的人准备了另一件作品；）

我正在开发一个简单的 Flash 应用程序来创建您自己的徽章。完成创建后，最好将其作为图像保存到客户的计算机或数据库中，我还不确定。问题是从 swf 内容制作图像 - 我的意思不是全部内容，只是其中的一部分，即 COA 所在的位置。我在网上找到了一些使用图像编码器和 PHP 的示例，但我不明白它是如何工作的。有人能这么好心地向我解释一下这个的基本原理吗？我想让它尽可能简单。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T03:05:31.527

首先，将图像（Sprite 或 MovieClip 等）绘制到 BitmapData 中：

```
var b: BitmapData = new BitmapData(640, 480, false, 0xffffffff); 
b.draw(mcToBeSaved); 
```

然后，使用例如[as3corelib](http://code.google.com/p/as3corelib/)将 BitmapData 编码为 PNG 或 JPG 文件。

```
var ba: ByteArray = PNGEncoder.encode(b); 
```

然后，对于 Flash 10，您可以使用 FileReference 的 save 方法立即让用户将图像保存到文件中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T00:48:14.647

这似乎是最近的一个热门问题。所以我没有完全重申所有这些信息，保存图像数据的说明，一旦你获得了 BitmapData，就在这里：

[如何将 ByteArray（来自 Flash）和一些表单数据发送到 php？](https://stackoverflow.com/questions/597947/how-can-i-send-a-bytearray-from-flash-and-some-form-data-to-php/800053#800053)

但是，首先，要获取图像数据，您需要将其从任何 MovieClip/Sprite 中拉出，无论您拥有什么。为此，您只需执行以下操作：

var myBitmapData:BitmapData = new BitmapData(desiredWidth, desiredHeight, isTransparent, backgroundColor); myBitmapData.draw(mcToBeSavedToImage);

其中 mcToBeSavedToImage 是您要转换为图像的影片剪辑。BitmapData 参考在这里，如果您需要它 - 它还有其他示例： http: [//livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/BitmapData.html](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/BitmapData.html)

希望有帮助！

# windows - windows用户域帐号问题

> ID：799785
> 
> 赞同：1
> 
> 时间：2009-04-28T20:54:44.240
> 
> 标签：windows, active-directory

我有一个关于域帐户的问题。我有一个存储所有用户信息的域控制器。我已经在笔记本电脑上加入了域，但我观察到即使域控制器已关闭，我也能够使用域凭据登录。这怎么可能？

亲切的问候 PK

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-28T20:58:09.583

如果您在域控制器关闭之前登录笔记本电脑，您的凭据将缓存在计算机本地。

发生这种情况是为了即使您与网络断开连接（在家工作等），您也可以使用您的域凭据登录机器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T20:56:53.690

您正在使用缓存的凭据。如果需要，您可以在注册表中禁用此功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T21:01:34.350

Windows 将在本地缓存以前的用户登录凭据，以便在 DC 关闭时您仍然可以登录。您应该无法访问可能需要您登录的网络资源。

# python - 如何在 Google App Engine 中获取最后插入的项目密钥

> ID：799803
> 
> 赞同：1
> 
> 时间：2009-04-28T20:58:22.453
> 
> 标签：python, google-app-engine

我正在使用 Google App Engine 和 Python。
我有一个项目模型。
在我使用 item.put() 插入项目后，
我想立即获取它的键并使用此键重定向到页面。

就像是：

```
redirectUrl = "/view/key/%s/" % item.key
self.redirect(redirectUrl) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T21:18:38.013

此外， item.put() 将密钥作为结果返回，因此几乎不需要立即再次获取该密钥 - 只需更改您的序列，例如

```
 item.put()
  redirectUrl = "/view/key/%s/" % item.key() 
```

进入

```
 k = item.put()
  redirectUrl = "/view/key/%s/" % k 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T21:47:53.113

感谢 Scott Kirkwood 的倡议。我实际上错过了（）

```
redirectUrl = "/view/key/%s/" % item.key()
self.redirect(redirectUrl) 
```

很高兴知道在谷歌数据存储中您不需要使用 Scope_identity 之类的任何东西，但您可以在 item.put() 之后获取 item.key()..

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T21:36:37.977

完成后，`put()`您可以运行

```
item.key().id() 
```

获取`id()`比直接使用稍微安全一些`key()`，因为你会间接调用`__str__()`，这在非字符串上下文中可能不会发生。

其他选项是调用`id_or_name()`，但在这种情况下您可能已经知道名称是什么。

# regex - .htaccess 替换单词后重定向？

> ID：799809
> 
> 赞同：2
> 
> 时间：2009-04-28T21:00:23.493
> 
> 标签：regex, .htaccess, mod-rewrite, redirect

我需要使用 .htaccess 文件来替换 URL 中的单词；像这样的东西：

示例网址：

```
 http://example.com/oldword/test-page.html 
```

重定向到：

```
 http://example.com/newword/test-page.html 
```

替换该单词后，如何使用 mod_rewrite 将包含 **/oldword/的每个 URL 重定向到相同的 URL？**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T21:03:19.243

这应该为你做：

```
RewriteRule ^oldword/(.*)   /newword/$1   [L] 
```

编辑：它可能无法完全取决于您的 RewriteBase 设置，但它会很接近。

第二次编辑：如果您需要与旧 URL 关联的 301 Moved Permanently 标头，您也可以执行以下操作：

```
RewriteRule ^oldword/(.*)   /newword/$1   [R=301,L] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T21:03:44.127

看这里：

```
<IfModule mod_rewrite.c>
RewriteEngine on
RewriteBase /
RewriteRule ^oldword(.*)$ http://%{HTTP_HOST}/newword$1 [L]
</IfModule> 
```

再见，

克里斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-05-03T08:47:05.530

这样，您可以独立于要替换的“旧词”周围的内容进行重定向：

```
<IfModule mod_rewrite.c>
   RewriteEngine on
   RewriteBase /

   # Replace 'oldword' with 'newword' and 301 redirect 
   RewriteCond %{REQUEST_FILENAME} !-d
   RewriteRule ^(.*)oldword(.*)$ /$1newword$2 [L,R=301]
</IfModule> 
```

# c - C的智能指针/安全内存管理？

> ID：799825
> 
> 赞同：52
> 
> 时间：2009-04-28T21:06:17.677
> 
> 标签：c, memory, pointers, c99, smart-pointers

我和我认为许多其他人在使用智能指针来包装 C++ 中的不安全内存操作（使用 RAII 等）方面取得了巨大成功。但是，当您有析构函数、类、运算符重载等时，包装内存管理更容易实现。

对于使用原始 C99 编写的人，您可以在哪里指出（不是双关语）来帮助安全内存管理？

谢谢。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2015-01-10T10:22:52.170

这个问题有点老了，但我想我会花时间链接到我的 GNU 编译器（GCC、Clang、ICC、MinGW 等）的[智能指针库](https://github.com/Snaipe/c-smart-pointers/)。

这个实现依赖于清理变量属性，一个 GNU 扩展，在超出范围时自动释放内存，因此，它**不是**ISO C99，而是带有 GNU 扩展的 C99。

例子：

简单1.c：

```
#include <stdio.h>
#include <csptr/smart_ptr.h>

int main(void) {
    smart int *some_int = unique_ptr(int, 1);

    printf("%p = %d\n", some_int, *some_int);

    // some_int is destroyed here
    return 0;
} 
```

编译和 Valgrind 会议：

```
$ gcc -std=gnu99 -o simple1 simple1.c -lcsptr
$ valgrind ./simple1
==3407== Memcheck, a memory error detector
==3407== Copyright (C) 2002-2013, and GNU GPL\'d, by Julian Seward et al.
==3407== Using Valgrind-3.10.0 and LibVEX; rerun with -h for copyright info
==3407== Command: ./simple1 
==3407==
0x53db068 = 1
==3407==
==3407== HEAP SUMMARY:
==3407==     in use at exit: 0 bytes in 0 blocks
==3407==   total heap usage: 1 allocs, 1 frees, 48 bytes allocated
==3407==
==3407== All heap blocks were freed -- no leaks are possible
==3407==
==3407== For counts of detected and suppressed errors, rerun with: -v
==3407== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0) 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-28T21:11:15.667

在原始 C 中处理智能指针很困难，因为您没有语言语法来支持使用。我见过的大多数尝试都没有真正奏效，因为当对象离开作用域时，你没有析构函数运行的优势，而这正是智能指针起作用的真正原因。

如果您真的担心这一点，您可能想考虑直接使用[垃圾收集器](https://web.archive.org/web/20120201075546/http://www.hpl.hp.com/personal/Hans_Boehm/gc/)，并完全绕过智能指针要求。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-28T21:27:10.310

您可能要考虑的另一种方法是[Apache 使用](http://apr.apache.org/docs/apr/1.3/group__apr__pools.html)的池化内存方法。如果您有与请求或其他短期对象相关联的动态内存使用情况，这将非常有效。您可以在请求结构中创建一个池，并确保始终从池中分配内存，然后在处理完请求后释放池。一旦你使用了一点，它听起来就不像它那么强大了。它几乎和 RAII 一样好。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-08-11T10:00:03.340

您不能在 C 中使用智能指针，因为它没有提供必要的语法，但您可以通过练习避免泄漏。分配资源后立即编写资源释放代码。因此，无论何时编写 a ，都应立即在清理部分中`malloc`编写相应的内容。`free`

在 CI 中经常看到“GOTO cleanup”模式：

```
int foo()
{
    int *resource = malloc(1000);
    int retVal = 0;
    //...
    if (time_to_exit())
    {
        retVal = 123;
        goto cleanup;
    }
cleanup:
    free(resource);
    return retVal;
} 
```

在 C 语言中，我们还使用了很多分配内容的上下文，同样的规则也适用于：

```
int initializeStuff(Stuff *stuff)
{
    stuff->resource = malloc(sizeof(Resource));
    if (!stuff->resource) 
    {
        return -1; ///< Fail.
    }
    return 0; ///< Success.
}

void cleanupStuff(Stuff *stuff)
{
    free(stuff->resource);
} 
```

这类似于对象的构造函数和析构函数。只要您不将分配的资源分配给其他对象，它就不会泄漏，指针也不会悬空。

编写一个跟踪分配和写入泄漏块的自定义分配器并不难`atexit`。

如果您需要提供指向已分配资源的指针，您可以为其创建包装上下文，并且每个对象都拥有一个包装上下文而不是资源。这些包装器共享资源和一个计数器对象，该对象跟踪使用情况并在没有人使用时释放对象。这就是 C++11 的`shared_ptr`工作`weak_ptr`原理。它在这里写得更详细：[weak_ptr 如何工作？](https://stackoverflow.com/questions/5671241/how-does-weak-ptr-work)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-28T21:16:59.320

[像splint](http://www.splint.org/)或[Gimpel](http://www.gimpel.com/) PC-Lint 这样的静态代码分析工具在这里可能会有所帮助——您甚至可以通过将它们连接到您的自动“持续集成”风格的构建服务器中来使它们具有适度的“预防性”。（你确实有其中之一，对吧？ :grin :)

这个主题还有其他（一些更昂贵的）变体......

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-04-08T19:24:02.877

您可以定义宏（例如 BEGIN 和 END）来代替大括号并触发自动销毁正在退出其范围的资源。这要求所有此类资源都由智能指针指向，该指针还包含指向对象析构函数的指针。在我的实现中，我在堆内存中保留了一个智能指针堆栈，在进入范围时记住堆栈指针，并在范围退出时调用记忆堆栈指针上方的所有资源的析构函数（END 或宏替换返回）。即使使用了 setjmp/longjmp 异常机制，这也能很好地工作，并且也清除了 catch 块和引发异常的范围之间的所有中间范围。有关实现，请参见[https://github.com/psevon/exceptions-and-raii-in-c.git](https://github.com/psevon/exceptions-and-raii-in-c.git)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-28T21:22:11.477

如果您在 Win32 中编码，您可能能够使用[结构化异常处理](http://msdn.microsoft.com/en-us/library/ms680657(VS.85).aspx)来完成类似的事情。你可以这样做：

```
foo() {
    myType pFoo = 0;
    __try
    {
        pFoo = malloc(sizeof myType);
        // do some stuff
    }
    __finally
    {
        free pFoo;
    }
} 
```

虽然不像 RAII 那样简单，但您可以将所有清理代码收集在一个地方并保证其被执行。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-08-07T09:37:07.627

好的，这是您的选择。理想情况下，您将它们结合起来以获得更好的结果。在 C 的情况下，偏执狂是可以的。

编译时间：

1.  使用 GCC 中的清理变量属性。之后你必须坚持使用 GCC。这限制了代码的可移植性，因为您只能针对存在 GCC 的平台。
2.  在 Windows 上使用 SEH（结构化异常处理）。这进一步限制了您的可移植性，因为您必须使用 Microsoft 编译器。如果您的目标完全是 Windows，那么它将为您工作。
3.  使用静态代码分析工具揭示潜在的内存泄漏。不能完美地工作，但可以帮助发现微不足道的泄漏。不影响你的便携性。

运行：

4.  使用调试内存分配库，它用自己的实现替换 malloc/free 并跟踪内存使用情况。这样您就可以看到已分配但从未释放的块。我在 Solaris 上取得了成功（将尝试记住它的名称）。
5.  使用垃圾收集器。在修复我没有源代码的漏洞非常多的 C 应用程序时，我对[Hans-Boehm GC](https://www.hboehm.info/gc)有过积极的体验。我可以看到内存消耗是如何攀升的，然后在 GC 完成工作时急剧下降。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2015-08-26T18:03:14.967

```
Sometimes i use this approach and it seems good :)

Object *construct(type arg, ...){

    Object *__local = malloc(sizeof(Object));
    if(!__local)
        return NULL;
    __local->prop_a = arg;
    /* blah blah */

} // constructor

void destruct(Object *__this){

   if(__this->prop_a)free(this->prop_a);
   if(__this->prop_b)free(this->prop_b);

} // destructor

Object *o = __construct(200);
if(o != NULL)
   ;;

// use

destruct(o);

/*
  done !
*/ 
```

# macros - 如何在 nmake 调用之间转发宏？

> ID：799836
> 
> 赞同：1
> 
> 时间：2009-04-28T21:10:23.673
> 
> 标签：macros, persistence, environment-variables, forwarding, nmake

如何在 nmake 调用之间转发宏？

假设我们有

```
--- a.mak ---

some_variable = value

all:
   nmake -f b.mak

--- END ---

--- b.mak ---

all:
   @echo some_variable = WHAT TO PUT HERE TO GET VALUE OF some_variable?

--- END --- 
```

我正在尝试不同的事情，例如使用 set 和 setx 命令，但是在父 makefile 中设置的变量值在从其中调用的 makefile 中不可见。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T21:24:13.233

这是 MSDN 关于[递归](http://msdn.microsoft.com/en-us/library/7cafx990.aspx)[调用`nmake`](http://msdn.microsoft.com/en-us/library/7cafx990.aspx)的信息：

> 使用递归宏递归调用 NMAKE。递归会话继承命令行和环境变量宏以及 Tools.ini 信息。它们不继承 makefile 定义的推理规则或 .SUFFIXES 和 .PRECIOUS 规范。要将宏传递给递归 NMAKE 会话，请在递归调用之前使用 SET 设置环境变量，在递归调用的命令中定义宏，或在 Tools.ini 中定义宏。

所以，你可以`a.mak`看起来像：

```
# ---- a.mak ----
some_variable = value

all:   
    nmake -f b.mak some_variable=$(some_variable)
#--- END --- 
```

另外，请注意，使用`set`sommand 将变量放入环境中也可以，但会`nmake`自动将环境变量名称大写（即使对于奇怪的变量名称，例如“ `windir`”，由于某种原因在系统中是小写的），并且区分大小写，所以要使用环境变量，你必须使用大写的变量。

[来自 MSDN](http://msdn.microsoft.com/en-us/library/99at5bh3.aspx)：

> 继承的名称被转换为大写。继承发生在预处理之前

因此，`b.mak`如果您要使用环境而不是在命令行上显式传递变量，那么您应该如下所示：

```
#--- b.mak ---
all:
   @echo some_variable is: $(SOME_VARIABLE)
#--- end --- 
```

因此，将 nmake 宏名称的全大写命名约定标准化可能不是一个坏主意。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T00:14:13.403

也许您应该考虑不递归调用 make，请参阅论文[Recursive Make Considered Harmful](http://miller.emu.id.au/pmiller/books/rmch/)。您仍然可以拥有类似于您已经拥有的 makefile（由 make 包含）的模块化文件，只是规则仅在一个顶级 makefile 中定义。

# scheme - 将 LilyPond 源文件自动转置为多个键的最佳方法是什么？

> ID：799837
> 
> 赞同：16
> 
> 时间：2009-04-28T21:10:32.160
> 
> 标签：scheme, m4, lilypond, typesetting, music-notation

**问题**

我正在使用[LilyPond](http://lilypond.org/web/)为教堂合唱团排版乐谱。根据在任何给定星期有空的人，歌曲将以不同的键播放。我们有一位了不起的钢琴家，可以弹奏我们扔给她的任何东西，吉他手通常会在交替和弦上用铅笔画，但我想通过在我们想要的任何键上提供精美的排版乐谱来让事情变得更容易。

所以说我们要唱我们的ABC。首先，我将获取任何可用的源转录并将其输入到 LilyPond 脚本中：

```
melody = \relative c' {
    c c g g
    a a g2
    f f e e
    d d c2 } 
```

我想要自动转置它的能力，所以如果我想把整个东西放在'G'中，我把这首歌包装在一个 \transpose 调用中，如下所示：

```
melody = \transpose c g \relative c' {
    c c g g
    a a g2
    f f e e
    d d c2 } 
```

我真正想要的是用一些东西代替“g”并多次生成旋律的输出。简单的 LilyPond 变量似乎在这里不起作用，到目前为止，我还没有成功定义一个方案函数来执行此操作。

我目前采取的方法是将上述文件命名为 twinkle.ly 并将其转换为名为 twinkle.ly.m4 的 M4 脚本，其内容如下所示：

```
melody = \transpose c _key \relative c' {
c c g g
a a g2
f f e e
d d c2 } 
```

然后我通过执行以下行来编译 while 事物：

```
> m4 -D _key=g twinkle.ly.m4 > twinkle_g.ly && lilypond twinkle_g.ly 
```

我写了一个 Makefile 来为我做这件事，为我拥有的每首歌和我感兴趣的每一个键定义规则。

**问题** 必须有更好的方法来解决这个问题。鉴于 Lilypond 支持嵌入式方案，我宁愿不使用对其进行预处理的宏。有没有其他人想出解决同样问题的方法？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-08T08:27:09.350

您可以参考旋律变量并将其移调到所需的键中：

```
旋律 = \relative c' { c8 ece g4 g }
\分数 {
  \转置CD \旋律
}
\分数 {
  \转置ce \旋律
}
％ ETC。

```

如果要将转置输出为单独的文件，请将它们嵌入到 \book 块中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-11-15T09:27:12.313

如果要创建同一片段的两个副本，一个转置一个不转置，您可以使用[`\displayLilyMusic`](http://www.lilypond.org/doc/v2.19/Documentation/notation/displaying-lilypond-notation). 例如，

```
{
  \displayLilyMusic \transpose c a, { c4 e g a bes }
} 
```

将显示

```
{ a,4 cis e fis g } 
```

复制此输出并将其粘贴到您想要的任何位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-03-11T02:29:39.917

[为 lilypond](http://www.frescobaldi.org/)使用免费的Frescobaldi 编辑器。它提供了一个强大的转置工具。

# asp.net-mvc - ASP.NET MVC 如何指定查看页面所在的文件夹？

> ID：799838
> 
> 赞同：40
> 
> 时间：2009-04-28T21:11:08.663
> 
> 标签：asp.net-mvc, namespaces

默认情况下，ASP.NET MVC 引擎在以下文件夹中搜索视图页面：

*   /Views/ **{Controller_Name}** /{Action}.aspx
*   /Views/**共享**/{Action}.aspx

*但是我想把我的一些视图页面像这样：*

*   /Views/ **{Namespace}/{Controller_Name}** /{Action}.aspx

***我怎样才能让引擎寻找这个？***

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2012-10-22T13:26:48.340

您可以通过控制器操作返回放置在自定义子文件夹中的视图，在返回语句中给出完整的视图路径，

前任。

```
public ActionResult Create()
{
    return View("~/Views/ProEnhance/Employee/Create.cshtml");
} 
```

这里，

ProEnhance - 用户定义的文件夹

员工 - 控制人姓名

创建 - 动作名称

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-28T21:23:58.757

您必须创建一个派生自 IViewEngine 接口的类，并在 Global.asax.cs 的 Aplication_Start 事件中注册该类检查此[链接文本](https://blogs.msmvps.com/luisabreu/blog/2008/09/17/the-mvc-platform-view-engines/)，但与 1.0 有一些差异

# sql - 创建 sqlite 索引时，COLLATE 关键字有什么作用？

> ID：799840
> 
> 赞同：13
> 
> 时间：2009-04-28T21:11:31.203
> 
> 标签：sql, sqlite, indexing, collate

根据[sqlite3 文档](http://www.sqlite.org/lang_createindex.html)，

> 每个列名后面的 COLLATE 子句定义了用于该列中文本条目的整理顺序。默认整理顺序是在 CREATE TABLE 语句中为该列定义的整理顺序。或者，如果没有以其他方式定义整理顺序，则使用内置的 BINARY 整理顺序。

整理序列有什么作用，什么是 BINARY 整理序列？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T21:20:52.010

这是sql引擎在内部对数据进行排序的方式。Binary Collat​​ion 按照它的建议进行，它进行二进制比较。通常它是最快的排序规则，尽管我从未量化它，因为它检查位模式，这意味着它区分大小写和重音。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-08-06T15:26:39.197

二进制排序规则逐字节比较您的字符串，就像在 unicode 表中一样。例如：A、B、a、b。不区分大小写 (NOCASE) 的顺序是：a,A,b,B。

二进制排序的优点是它的速度，因为字符串比较非常简单/快速。在一般情况下，二进制索引可能不会产生预期的排序结果；但是，对于完全匹配，它们可能很有用。

COLLATE NOCASE 也会影响区分大小写的查询。

如果您有一列包含这些值：'aa'、'aA'

```
select * from table where col = 'aa' 
```

如果您使用 COLLATE NOCASE 创建了列，它将返回“aa”和“aA”。否则，如果你没有指定它，它只会返回'aa'。

您也可以在查询中指定它（如果您使用 COLLATE NOCASE 创建列，这会更慢）

```
select * from table where col = 'aa' COLLATE NOCASE 
```

# jquery - 为什么这个 jQuery 代码不能改变 Firefox 中的背景颜色？

> ID：799845
> 
> 赞同：3
> 
> 时间：2009-04-28T21:13:53.663
> 
> 标签：jquery, css, firefox

我试图掌握 jQuery 的窍门，但我有一段简单的代码拒绝工作。任何人都知道为什么这可能不起作用？

```
<html>
  <head>

  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript">
    $(document).ready(function(){
      $("div").live("click", divclicked);
    });

    function divclicked()
    {
      if($(this).css("background-color") == "lightblue")
        $(this).css("background-color", "red");
    }
  </script>

  <style type="text/css">

      div
      {
         background-color: lightblue;
      }

  </style>

  </head>
  <body>
    <div id="testdiv">
      this is a test
    </div>
  </body>
</html> 
```

提前感谢您的任何意见。

更新：当样式是内联时，下面使用“backgroundColor”而不是“background-color”的解决方案有效，如果您使用样式表则无效。

```
I have updated the example to use a stylesheet. 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T21:17:36.837

尝试在您的脚本中更改`background-color`为：`backgroundColor`

```
if($(this).css("backgroundColor") == "lightblue")
  $(this).css("backgroundColor", "red"); 
```

DOM 倾向于避免使用虚线名称，因为它们不是有效的 JavaScript 标识符。

* * *

啊！保罗在我输入评论时删除了他的答案......我没有意识到传递“背景颜色”`.css()`会做*任何*有用的事情，更不用说返回实际的 RGB 值了！在您的情况下，效果是相同的（因为您的逻辑需要完全保留原始值），但仍然值得注意以供将来参考。

另外：如果您使用 CSS 类而不是依赖于能够直接读取和编写样式，您将有一个更轻松的时间 - jQuery 与 CSS 类配合得非常好，提供了简单的方法来[检查](http://docs.jquery.com/Traversing/hasClass)、[切换](http://docs.jquery.com/Attributes/toggleClass)和[修改](http://docs.jquery.com/Attributes/addClass)它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T21:52:10.623

上面的答案可能是正确的

为了避免混淆 js 与 css 相比的语法差异，我倾向于使用 JSON 语法更改 jquery 中的 CSS

```
$(this).css({'background-color':'red', height:'200px'}); 
```

然后，您需要记住的只是 2 条始终有效的基本规则：逗号而不是冒号，并在任何带连字符的属性名称周围加上引号。

# .net - 页面在更新面板中的控件回发时移至顶部

> ID：799852
> 
> 赞同：2
> 
> 时间：2009-04-28T21:15:41.630
> 
> 标签：.net, ajax

我的页面上有一个更新面板，只要我有一个控制回发，页面就会向上滚动到页面顶部。

为什么会发生这种情况？我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T15:52:37.233

我在服务器端使用 control.focus() 来解决这个问题。例如：

```
Protected Sub ddlGroups_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles ddlGroups.SelectedIndexChanged

        LoadGroups()

        ddlGroups.Focus()

 End Sub 
```

我不知道这是否是最好的方法，但它现在对我有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-03T21:42:06.747

我知道这个问题已经得到解答，但我认为我有一个更简单的解决方案。我需要一个客户端解决方案，这工作得很好。

发生在我身上的是我加载了一个页面，然后在主页完全加载后延迟加载了一个面板。如果我完全向下滚动我的主页，那么当面板完成加载时，我的整个页面就会滚动到顶部。因此，此代码会跟踪我在 Panel 加载时可能正在进行的任何滚动。然后，一旦面板完成加载，页面不会滚动到顶部，而是滚动到我刚才所在的位置。到目前为止，这在 IE、Chrome、FF、Opera 和 Safari 中运行良好

```
<script type="text/javascript">
    var yPos;
    var prm = Sys.WebForms.PageRequestManager.getInstance();    
    prm.add_endRequest(EndRequestHandler);
    $(window).scroll(function () { yPos = $(window).scrollTop(); });
    function EndRequestHandler(sender, args) {        
        $(window).scrollTop(yPos);
    }
</script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T21:20:45.817

在页面上设置[MaintainScrollPositionOnPostBack 属性](http://msdn.microsoft.com/en-us/library/system.web.ui.page.maintainscrollpositiononpostback.aspx)。

编辑：嗯，好吧......[这与您看到的问题相似吗？](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=103014&wa=wsignin1.0)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-03-03T08:17:28.700

请尝试 PageRequestManager 处理程序

```
<script>
              Sys.WebForms.PageRequestManager.getInstance().add_endRequest(EndRequestHandler);

        function EndRequestHandler(sender, args) {
            try {

                sender._controlIDToFocus = null;

            }
            catch (e) {
            }
        }

</script> 
```

# php - 如何在 php 中使用 RESTful Web 服务服务器端进行获取和发布

> ID：799853
> 
> 赞同：1
> 
> 时间：2009-04-28T21:16:01.427
> 
> 标签：php, web-services, rest, get

嗨，任何人都可以通过一些代码来做一个安静的 Web 服务获取和发布方法。这将是服务器端，因此我将能够从客户端调用这两个服务。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T22:40:22.567

假设您有一个脚本 index.php。您可能在其中有两个函数，`showForm()`并且`handleForm()`.

假设一个请求进入 index.php。

```
if (! empty($_SERVER['REQUEST_METHOD'])) {
    if (strtoupper($_SERVER['REQUEST_METHOD']) == 'POST')
    {
        doSomething();
    }
    else
    {
        showSomething();
    }
} 
```

你有它。休息。如果您向 index.php 发送 GET 请求，您将显示一些输出，如果您向 index.php 发送 POST 请求，您将执行一些数据操作。您可以从那里获取其他 RESTful HTTP 请求类型，例如 DELETE 等。

显然这是一个非常简单的示例，我不想以这种方式创建整个站点。最好以架构合理的方式创建 RESTful 站点。许多框架可以帮助解决这个问题。

REST 现在是一个热门话题，似乎每个人都希望他们的应用程序是 RESTful 的。Google 上有很多文章和指南，您最好花一些时间研究各种方法。

关于 URL 的注意事项：URI 不一定要漂亮才能成为 RESTful。然而，REST 的一个关键点是所有 URI 都应该代表一个资源。由于查询参数不是 URI 的一部分，因此“ `/index.php?show=2`”不被视为 RESTful。您会发现很多应用程序使用 URL 重写来将查询参数转换为类似“ `/index/2`”的内容。

话虽如此，将“/index.php”作为 URI 并没有错，只要它只代表一个状态即可。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-28T21:57:41.717

```
POST:
<?
// Helloworld_post.php
echo "Hello world <pre>"
print_r($_POST['data'];
?>

GET
<?
//helloworld_get.php
echo "Hello world <pre>"
print_r($_GET['data'];
?> 
```

你到底想做什么？您需要使用 mod_rewrite 或其等效工具来制作漂亮的 /helloworld/ url。REST 的美妙之处在于它只是一个标准的 http 请求。它没有指定 json 编码或 xml 编码或“wtf I am the 1337”编码。

# svn - 在本地使用 Mercurial，仅与 Subversion 服务器一起使用

> ID：799860
> 
> 赞同：21
> 
> 时间：2009-04-28T21:19:51.030
> 
> 标签：svn, version-control, mercurial, dvcs

我们在我的工作中使用 Subversion 服务器进行源代码控制。我在想，与其跟上我自己的分支，不如在我的工作站上运行 Mercurial，在本地提交，然后每当我完成我正在处理的任何功能时提交到 Subversion 主干。

根据我对 DVCS 的理解，这在理论上是可能的。任何人都可以提供有关这种特定类型集成的任何教程的参考，或者指出任何可以使这种过程尽可能无缝的工具吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T21:22:37.857

您[在 Mercurial wiki 中查看过此页面](https://www.mercurial-scm.org/wiki/WorkingWithSubversion)吗？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-22T21:13:10.783

尽管有警告，但您确实应该尝试[hgsubversion](http://bitbucket.org/durin42/hgsubversion/)。它是 Subversion 和 Mercurial 之间唯一的双向桥梁。

当我几个月前尝试它时，它运行得非常好，并且已经进行了很多开发。这就是为什么扩展跟踪 Mercurial 的开发版本的原因（因此`encoding`上面的评论中出现了错误）。

幸运的是，Mercurial 安装起来非常简单且**非侵入式**。下载[最新的 Mercurial](https://www.mercurial-scm.org/repo/hg/archive/tip.tar.gz)，解压并运行

```
% make local 
```

这将编译 C 模块。然后符号链接`hg`到您的路径并将当前工作目录添加到您的`PYTHONPATH`：

```
% export PYTHONPATH=$PWD:$PYTHONPATH 
```

现在安装并激活 hgsubversion。当 Mercurial 1.3 于 7 月 1 日发布时，您可以使用该版本。我相信 hgsubversion 将创建一个稳定的存储库并跟踪稳定的 Mercurial 版本。

# udp - 在 LAN 之外测试 UDP 代码时出现问题？

> ID：799863
> 
> 赞同：0
> 
> 时间：2009-04-28T21:20:45.393
> 
> 标签：udp

我在接下来的几天里学习 udp。这个周末我将参加那些 72 小时的比赛之一，我希望我的 UDP 代码在比赛结束前在线工作。在比赛期间，我不会有任何互联网（所以没有打电话给某人并让他们测试）。

我知道一些关于 UDP 的问题，比如数据包进来两次，没有进来几个帧（但我不知道我应该期望多长时间），推荐的字节大小（576）等等。[我应该知道什么关于 UDP 编程？](https://stackoverflow.com/questions/799068/what-should-i-know-about-udp-programming)

但是从局域网迁移到互联网后，你会发生哪些事情呢？

注意：我将尽快运行一些代码并在线测试。希望我的最终代码会是什么样子，但我也可能会错过一些东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T06:32:50.793

简短的回答是：在 LAN 上，您可能很少注意到 UDP 的权衡（好的和坏的），因为在 LAN 上很少会出错。

你可能会丢失数据包。LAN 拥塞或本地系统限制是最可能的原因。

当您离开 LAN 并依赖路由器时，会出现大多数 UDP 问题（碎片、重复数据包、延迟数据包、丢弃超过一定大小的数据包、缺少返回的错误消息）。

换句话说，使 UDP 变得复杂的大部分原因是“离开 LAN”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T21:56:44.717

这可能有点极端（！）但如果这很重要，您可以编写一个 UDP 代理来侦听传入的数据报并转发它们。然后，您可以修改它以提供：

1.  潜伏
2.  丢包
3.  数据包复制

并指示您的客户端将数据发送到代理，并将代理（通过适当的数据包修改）定向到服务器。

就像我说的，也许是极端的。*但是*，即使在您的 LAN/互联网存在的情况下，您也可以使用它来测试您的应用程序在 UDP 不友好的环境中的行为。

编辑：肯定有人写过这样的东西吗？如果没有，我感觉到一个开源项目即将到来......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T21:23:42.237

您的延迟可能会增加，并且您可能会丢失更多数据包。这取决于发射器和接收器的位置。如果您在美国并且您正在尝试与澳大利亚的 UDP 通信，您将获得相当高的延迟，您将遭受更多的数据包丢失/重新排序的数据包/重复，因为有更多的传输距离和更多的数据包路径被路由。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T21:30:21.533

如果您使用 UDP 作为传输协议，则必须在应用程序协议中保护您的传输。做这件事有很多种方法：

*   包序号
*   数据包大小
*   校验和

您应该将这些作为应用程序数据包的标头发送并在接收端检查它们。

PS：如果你真的在你的协议的所有方面（不仅仅是它的一部分）依赖正确的数据包顺序和完整性，你应该切换到 TCP。

# .net - 从 .Net 写入 CD

> ID：799867
> 
> 赞同：1
> 
> 时间：2009-04-28T21:22:02.757
> 
> 标签：.net, autorun, cd-burning

有没有一种简单的方法可以从 .Net 写入 CD？如何创建一个自动运行写入自身的可执行文件的多区段 CD？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T21:25:36.380

您可以通过[ICDBurn 界面](http://msdn.microsoft.com/en-us/library/bb776155(VS.85).aspx)执行此操作。

有关详细信息，请参阅[本文](http://www.codeguru.com/csharp/.net/net_general/tipstricks/article.php/c15201)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T21:26:55.083

[IMAPI 是您想要的。](http://msdn.microsoft.com/en-us/library/aa364806(VS.85).aspx) 有[.net 包装器](http://www.ohloh.net/p/imapi-net)，但我从未使用[过它们](http://www.vbaccelerator.com/home/net/code/libraries/writing_cds/imapi/article.asp)中的任何一个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T21:32:28.457

IMAPI2。简而言之，不，没有简单的方法可以从 .NET 中写入 CD。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-19T19:49:55.787

[使用 C# 和 IMAPI2 @ codeproject.com 刻录和擦除 CD/DVD/蓝光媒体](http://www.codeproject.com/Articles/24544/Burning-and-Erasing-CD-DVD-Blu-ray-Media-with-C-an "使用 C# 和 IMAPI2 @ CodeProject 刻录和擦除 CD/DVD/蓝光媒体")

# c# - 单元测试 XNA：我需要模拟我的 GraphicsDevice

> ID：799869
> 
> 赞同：3
> 
> 时间：2009-04-28T21:22:08.917
> 
> 标签：c#, .net, unit-testing, xna

我在玩弄 XNA 框架。
为了帮助我，我制作了一个看起来像这样的辅助类：

```
ActorHolder
+ SpriteBatch (SpriteBatch)
+ ContentManager (ContentManager)
- drawables (IList<IDrawable>)
- updatables (IList<IUpdatable>)

+ ActorHolder(GraphicsDevice, ContentManager)
+ Draw(GameTime)
+ Update(GameTime)
+ AddActor(IActor)
+ RemoveActor(IActor)
+ GetCollidingActors(IActor) 
```

现在我想对这个类进行单元测试。但正如您所见，我的构造函数需要一个图形设备和一个内容管理器。虽然我认为这在我的应用程序中有意义，但在我的测试中却没有。
我应该模拟这两个只是为了进行单元测试还是我的设计有缺陷？

--UPDATE--
我找到了一个可能有帮助的项目的链接：[http](http://scurvytest.codeplex.com/) ://scurvytest.codeplex.com/ 还没有任何 xp，因为编码必须为社交生活腾出一点空间。

--注意--
对不起，我的UML法语，我的公司不使用它，所以我除了在学校外从未使用过它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-10-15T08:03:49.310

我通过在不可见的窗口上实际创建一个真实的图形设备来“模拟”图形设备。性能出奇的好——大约 1500 次测试需要 12 秒。

它允许我测试需要图形设备的代码并进行一些基本验证（例如，纹理集是否正确，是否选择了顶点缓冲区等）。这可以通过使用带有 DirectX 调试运行时的参考光栅化器来进行更密集的检查来改进。

如果我需要验证发送到图形设备的内容，我会创建一个接口，被测代码可以通过该接口发送顶点 - 然后可以使用标准模拟对象框架轻松模拟。

检查此问题以获取有关模拟 XNA 图形设备相关类的另一个讨论：[Mocking Texture2D](https://stackoverflow.com/questions/1308560/xna-mocking-texture2d)

以下是我使用真实图形设备“模拟”的类： [MockedGraphicsDeviceService.cs](https://devel.nuclex.org/framework/browser/graphics/Nuclex.Graphics/trunk/Source/MockedGraphicsDeviceService.cs?rev=1046)、[MockedGraphicsDeviceService.Test.cs](https://devel.nuclex.org/framework/browser/graphics/Nuclex.Graphics/trunk/Source/MockedGraphicsDeviceService.Test.cs?rev=1046)

（编辑：修复断开的链接）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T21:33:16.630

这似乎是一个非常有效的模拟使用场景。我不认为这个设计有缺陷——

存在模拟的一个原因是帮助填充在测试时不可用的接口的资源需求，例如远程对象，或者在您的情况下是图形资源。对我来说，在这里模拟图形设备和内容管理器似乎很合适。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T20:15:40.733

正如我从**[另一个](https://stackoverflow.com/questions/804904/xna-mock-the-game-object)**问题中发现的那样，GraphicsDevice 不能掉以轻心。 [XNA 社区论坛上的这个讨论](http://forums.xna.com/forums/t/30645.aspx)特别指出了为什么模拟它不是一个好主意。

我仍在寻找一个好的解决方案。但是我倾向于认为：

*   这是我的架构中的一个设计缺陷（我应该更多地解耦我的组件）
*   这是 XNA 的设计缺陷

# javascript - 这是一个好的 JavaScript 对象模型吗？（电话簿项目）

> ID：799874
> 
> 赞同：1
> 
> 时间：2009-04-28T21:23:24.313
> 
> 标签：javascript, object

我需要创建一个电话簿。多亏了一个表格，我可以检索一个人的数据。我需要为此目的使用对象。我借助能够在电话簿中添加人员的方法创建了一个 phoneBook() 对象。
我决定（虽然没有被要求）将“人”概念分为 2，从而产生“人”对象和“地址人”对象（同一个人可以有两个房子：“我的裁缝很有钱！ " :-))

这是声明 Person 对象的好方法吗？
我们可以创建一个没有地址的 Person 对象，然后像我对“Person2”对象所做的那样添加它吗？

如果有人可以帮助我，我将非常感激。提前非常感谢您！”

```
function phoneBook(){
  this.Liste = new Array(); 
}

phoneBook.prototype.Add = function(){
   Liste.push(new Person(aLastName,aFirstName,aAddress));
}

function Person(aLastName,aFirstName,aAdd){
  this.LastName   = aLastName;
  this.FirstName  = aFirstName;
  this.Address = 
    new AddressPerson(aAdd.Street,aAdd.CP,aAdd.Town,aAdd.NumTel,aAdd.Email);
}

function Person2(aLastName,aFirstName){
  this.LastName   = aLastName;
  this.FirstName  = aFirstName;
  this.Address = 'unknow';
}

function AddressPerson(aStreet,aCP,aTown,aNumTel,aEmail){
  this.Street = aStreet;
  this.CP    = aCP;
  this.Town = aTown;
  this.NumTel = aNumTel;
  this.Email= aEmail;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-28T22:28:02.067

一些建议：

*   将您的类 ( `PhoneBook`) 更改为大写，并将您的方法/属性 ( `lastName`, `add()`) 更改为小写
*   不需要方法参数上的“a”前缀，因为在 Javascript`this`中从不隐式使用。
*   方法应该将对象作为参数。例如，`add()`应该是`add(person)`where`person`是一个预先构造的`Person`对象。
*   为什么需要`Person2`？似乎是多余的。
*   在构造函数中`Person`，复制`Address`. 一般来说，只要做`this.address = address`就可以了。但是如果你想确保每个`Person`都有它自己的实例`Address`，提供一个`clone()`方法 on `Address`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T00:16:59.683

看看[JSLint](http://www.jslint.com/)。这项工作有点像 W3C 的[Markup Validator](http://validator.w3.org/)。

JSLint 由道格拉斯·克罗克福德（Douglas Crockford）创建——雅虎！[JavaScript 布道者和发明JSON](http://json.org/)的家伙。

JSLint 是关于什么的：

> “JSLint 是一个 JavaScript 程序，用于查找 JavaScript 程序中的问题。
> 
> 当 C 还是一门年轻的编程语言时，有几个常见的编程错误未被原始编译器捕获，因此开发了一个名为 lint 的辅助程序，它可以扫描源文件，寻找问题。
> 
> 随着语言的成熟，语言的定义得到加强以消除一些不安全感，编译器在发出警告方面也变得更好。不再需要 lint。
> 
> JavaScript 是一种年轻的语言。它最初的目的是做网页中的小任务，Java 太繁重和笨拙的任务。但是 JavaScript 是一种非常强大的语言，现在它被用于更大的项目中。许多旨在使语言易于使用的功能对于大型项目来说很麻烦。需要 JavaScript 的 lint：JSLint，一个 JavaScript 语法检查器和验证器。
> 
> JSLint 获取一个 JavaScript 源并对其进行扫描。如果它发现问题，它会返回一条描述问题的消息以及源中的大致位置。问题不一定是语法错误，尽管它经常是。**JSLint 着眼于一些样式约定以及结构问题。**它并不能证明你的程序是正确的。它只是提供了另一组眼睛来帮助发现问题。
> 
> JSLint 定义了 JavaScript 的专业子集，这是一种比 ECMAScript 语言规范第 3 版定义的语言更严格的语言。该子集与 JavaScript 编程语言的代码约定中的建议相关。
> 
> JavaScript 是一种草率的语言，但在其中有一种优雅、更好的语言。JSLint 可以帮助您使用更好的语言进行编程，并避免大部分问题。”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T00:24:10.133

对于更简洁的代码，以及遵循当今公认的最佳实践，您可以做一些事情。

你可以改变这一行

```
 this.Liste = new Array(); 
```

至

```
 this.Liste = []; // shorthand for creating an array. You can do the same with an object with {} 
```

我通常将 JSON 对象用于此类事情。[Douglas Crockford 的 JavaScript 是一个非常有用的资源。](http://javascript.crockford.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T08:09:45.047

在我注册之前评论我自己的帖子评论：

> @harto - 我不认为将 Person 和 Address 构造函数更改为接受对象是一种改进。这只会使这些对象的构造变得不必要地复杂 IMO。另外，我认为您的 add 函数会错过 arguments 数组的第 0 个元素？

我确实认为更改构造函数很好，它允许自动克隆一个，如果您使用它，则允许直接从 JSON 创建对象。无论如何，大量的应用程序。如果需要，您始终可以进行参数长度验证并根据正确的行为进行分支。

至于 add 函数，它不会遗漏第`0`th 个元素，因为它是后递减的，这意味着表达式返回递减之前的值。这是您可以在 JavaScript 中设计的最快的循环。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T01:08:16.410

**非常感谢**
我改变了我的代码：

```
function PhoneBook(){<br>
    this.liste = [];<br>
}

PhoneBook.prototype.add = function(person){<br>
   this.liste.push(person);<br>
}

function Person(lastName,firstName,address){<br>
    this.lastName   = lastName;<br>
    this.firstName  = firstName;<br>
    this.address = address;<br>
}

function AddressPerson(street,cp,town,numTel,email){<br>
    this.street = street;<br<
    this.cp     = cp;<br>
    this.town   = town;<br>
    this.numTel = numTel;<br>
    this.email  = email;<br>
}

// tests for the others :-))

var phone = new PhoneBook();
alert(phone.liste.length);
var person = new Person(
    "aaaaaa",
    "bbbbbbb",
    new AddressPerson("zzzzz","87","rrrrr","22222","eeeee@uk.co")
);
alert(person.address.street);
phone.add(person);
alert(phone.liste.length);
alert(phone.liste[0].address.numTel); 
```

但我不知道该怎么做，Levik 在他的回答中说：

> 但是如果你想确保每个人都有自己的地址实例，请在地址上提供一个**clone() 方法**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T01:14:04.867

这是我的建议：

```
function PhoneBook( person /*, ... */ ){
    this._liste = [];
}

PhoneBook.prototype.add = function(){
    var l = arguments.length;
    while(l--){
        this._liste.unshift( arguments[l] );
    }
}

function Person( p ){
    this.lastName   = p.lastName;
    this.firstName  = p.firstName;
    this.address    = p.address === 'unknown' ? new Address( p.address ) : 'unknown';
}

function Address( a ){
    this.street = a.street;
    this.CP     = a.CP;
    this.town   = a.town;
    this.numTel = a.numTel;
    this.email  = a.email;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-29T01:56:04.063

数据模型建议：

*   重命名`AddressPerson`为`Address`. 您可以假设传递`Address`与 a 不对应的对象`Person`。

*   考虑将该`email`字段移入`Person`- 正如您所提到的，您可能在一个地址有多个人（他们可能不一定共享电子邮件地址）。

*   将完全初始化的值传递给`Address`构造`Person`函数。

*   删除`Person2`函数，并`address`设置 的可选属性`Person`。例如赋值变成`this.address = (address === undefined) ? "unknown" : address;`

从风格/惯例的角度来看，列维克的反应很好——我赞同这些建议。

# php - PHP - 使用 array_filter 从哈希表（数组）中删除项目

> ID：799875
> 
> 赞同：3
> 
> 时间：2009-04-28T21:23:24.593
> 
> 标签：php, arrays, array-filter

在 PHP 中，我知道一旦将项目放入数组中，就没有正式的方法可以删除它们。但是我的问题必须有一个“最佳方法”的解决方案。我相信这可能在于`array_filter`功能。

本质上，我有一个购物车对象，将商品存储在哈希表中。想象一下，您一次只能购买任何物品中的一件。

我愿意

```
add_item(1);
add_item(2);
remove_item(1); 
```

`get_count()`仍然返回 2。

```
var $items;

function add_item($id) {
    $this->items[$id] = new myitem($id);
}

function remove_item($id) {
    if ($this->items[$id]) {
        $this->items[$id] = false;
        return true;
    } else {    
        return false;
    }
}

function get_count() {
    return count($this->items);
} 
```

人们认为在 get_count 中使用的最佳方法是什么？我想不出使用根本不返回错误值的 array_filter 的最佳方法（无需编写单独的回调）。

谢谢 ：）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-28T21:32:47.863

没有官方途径？当然有！ [未设置](http://us3.php.net/unset)！

```
<?php

class foo
{
    var $items = array();

    function add_item($id) {
            $this->items[$id] = new myitem($id);
    }

    function remove_item($id)
    {
        unset( $this->items[$id] );

    }

    function get_count() {
            return count($this->items);
    }
}

class myitem
{
    function myitem( $id )
    {
        // nothing
    }
}

$f = new foo();

$f->add_item( 1 );
$f->add_item( 2 );

$f->remove_item( 1 );

echo $f->get_count(); 
```

另外，这是PHP4吗？因为如果没有，您应该研究一些 SPL 的东西，例如[ArrayObject](http://us3.php.net/manual/en/class.arrayobject.php)或至少[Countable](http://us3.php.net/manual/en/class.countable.php)和[ArrayAccess](http://us3.php.net/manual/en/class.arrayaccess.php)接口。

## 编辑

这是直接使用接口的版本

```
<?php

class foo implements ArrayAccess, Countable
{
    protected $items = array();

    public function offsetExists( $offset )
    {
        return isset( $this->items );
    }

    public function offsetGet( $offset )
    {
        return $this->items[$offset];
    }

    public function offsetSet( $offset, $value )
    {
        $this->items[$offset] = $value;
    }

    public function offsetUnset( $offset )
    {
        unset( $this->items[$offset] );
    }

    public function count()
    {
        return count( $this->items );
    }

    public function addItem( $id )
    {
        $this[$id] = new myitem( $id );
    }
}

class myitem
{
    public function __construct( $id )
    {
        // nothing
    }
}

$f = new foo();

$f->addItem( 1 );
$f->addItem( 2 );
unset( $f[1] );

echo count( $f ); 
```

这是一个作为 ArrayObject 实现的版本

```
<?php

class foo extends ArrayObject
{
    public function addItem( $id )
    {
        $this[$id] = new myitem( $id );
    }
}

class myitem
{
    public function __construct( $id )
    {
        // nothing
    }
}

$f = new foo();

$f->addItem( 1 );
$f->addItem( 2 );
unset( $f[1] );

echo count( $f ); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-28T21:27:20.357

```
if ($this->items[$id]) { 
```

可能会返回警告，应使用 array_key_exists 或 isset。

unset() 似乎比在删除项目时分配 false 更干净（也将摆脱您的计数问题）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T02:30:07.477

彼得和马里奥的答案+1：使用`unset()`是从数组中删除项目的正确方法。

我只是想留下一个便条来解释为什么你的方法不起作用。使用`count()`将计算数组中值的数量。`false`，尽管您可以将其想象为“无”，但实际上仍然是一个值。通常，如果您想实际指定“无值”，则使用`null`.

您也可以通过将其设置为 来取消设置数组元素`null`，但请查看下面的代码以了解不同之处。

```
$x = array("a", "b", "c");

var_dump(isset($x[0]));   // bool(true)
var_dump(isset($x[1]));   // bool(true)
var_dump(isset($x[2]));   // bool(true)
echo count($x);           // 3

$x[2] = null;
var_dump(isset($x[2]));   // bool(false) -- the value is not set any longer
echo count($x);           // 3  -- but it doesn't remove it from the array

unset($x[1]);
var_dump(isset($x[1]));   // bool(false)
echo count($x);           // 2 
```

# c# - 在文件中查找文本 (C#)

> ID：799881
> 
> 赞同：0
> 
> 时间：2009-04-28T21:24:10.677
> 
> 标签：c#, search

我们的应用程序允许您将任何文件类型作为 blob/图像保存到 MS SQL DB 中。我现在必须提供在文件中搜索文本的功能。类似于标准的 Windows“在文件中查找”搜索。

实现这一目标的最佳方法是什么？我使用 StreamReader 从文件中读取所有文本，然后使用 Regex 进行匹配。只是不确定这是否是在文件中搜索的最有效方式。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T21:25:42.637

您应该查看 SQL Server 的全文搜索功能。

这里有一些不错的文章：

> [全文搜索](http://msdn.microsoft.com/en-us/library/ms142571.aspx)
> [SQL Server 全文搜索](http://en.wikipedia.org/wiki/SQL_Server_Full_Text_Search)
> [SQL Server 全文索引](http://www.developer.com/db/article.php/3446891)

我想你会发现尝试从数据库中拉回许多大记录然后在内存中搜索它们是非常低效的。这是您的 RDBMS 擅长的领域，如果配置正确，可以让您的生活变得更简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T22:12:05.660

在我看来，搜索应该由为做这样的事情而优化的 sql server 完成

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T21:29:36.107

如果您在 sql server 中使用全文搜索，您可能会节省很多时间？这将让您查询文件以及处理一些非常复杂的查询。它能够使用 iFilters 搜索内部 blob（如 microsoft frontpage）

这是基础[http://aspalliance.com/1512_understanding_full_text_search_in_sql_server_2005](http://aspalliance.com/1512_understanding_full_text_search_in_sql_server_2005)的一个很好的入门。

这样做可以利用 MS 在全文搜索中所做的工作；如果您的文件类型不受支持，则从他们的界面中获益（直接支持大多数评论文档格式，或者但它们的生产者 doc、docx、xls、pdf 等）

# c - 如何在 OS X 上强制 64 位整数运算？

> ID：799884
> 
> 赞同：1
> 
> 时间：2009-04-28T21:25:01.377
> 
> 标签：c, gcc, math, macos

我试图在 OS X 10.5.6 上强制使用 64 位长整数。在 Apple MacBook Intel Core 2 Duo 上运行。这是我的c代码：

```
#include<stdio.h>

int main()
{
    long a = 2147483647; /*== 2^32 - 1*/
    long aplus1;

    printf("a== %d. sizeof(a) == %d  \n", a, sizeof(a));

    aplus1 = a+1;

    printf("aplus1 = %d \n", aplus1);
} 
```

在没有任何开关的情况下编译会产生以下结果：

```
$ gcc testlong.c -o testlong ;./testlong

a== 2147483647\. sizeof(a) == 4  
aplus1 = -2147483648 
```

使用 -m64 开关编译会产生：

```
$ gcc testlong.c -o testlong -m64; ./testlong

a== 2147483647\. sizeof(a) == 8  
aplus1 = -2147483648 
```

所以第二个版本显然是使用 64 位存储，但仍然会产生溢出错误，虽然 2^32 应该很好地在 64 位整数的范围内。有任何想法吗？

我更喜欢可以从 gcc 选项强制执行的解决方案，而不是要求我更改多行源代码（我的实际问题不是具体的上述示例，而是我需要在更一般的情况下强制执行长整数运算）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-28T21:34:59.637

您不仅必须使用 long long，而且还必须相应地更改 printf() 语句。

```
#include<stdio.h>

int main()
{
    long long a = 2147483647; /*== 2^32 - 1*/
    long long aplus1;

    printf("a== %lld. sizeof(a) == %d  \n", a, sizeof(a));

    aplus1 = a+1;

    printf("aplus1 = %lld \n", aplus1);
} 
```

%lld 是 long long 的代码。

显然，真正的 64 位程序可以将 %d 用于 64 位整数 - 我不知道是否可以将其配置为在此模式下编译。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T21:30:18.087

如果您使用的是 C99，请包含`stdint.h`并使用`uint64_t`and `int64_t`。除此之外，`unsigned long long a = 0x100000000ull;`也应该工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T02:27:55.330

使用 C99 标准：

```
#include <stdint.h>

uint64_t a = 2147483647ULL; 
```

[Dinkumware](http://www.dinkumware.com)上有一个出色的[C99 库概述](http://www.dinkumware.com/manuals/?manual=compleat&page=lib_over.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T15:04:51.030

C 代码中的文字`2147483647`是`int`. 如果您希望它是 a ，那么在左侧`long`有 a 并没有帮助，它仍然是右侧的 a 。`long``int`

通过附加一个“L”使其成为一个长文字：（`2147483647L`建议使用大写字母，小写字母“l”也可以，但根据字体可能会非常混乱）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T21:27:09.887

你有没有尝试过：

```
long long a = 2147483647; 
```

# database - Hibernate 不保存也不抛出异常？

> ID：799889
> 
> 赞同：3
> 
> 时间：2009-04-28T21:26:19.623
> 
> 标签：database, hibernate, jakarta-ee

我已经坚持了几个星期了，我一点也不知道出了什么问题。我很绝望，因为我已经浪费了很多时间

我使用下面描述的数据模型（MySQL）。我通过逆向工程（Eclipse/JBoss 工具）创建了 hbm.xml 和 java 类（参见下面的示例）。

当我尝试保存推文、单词或事件时，我可以在日志消息中看到 pk 值已生成并且参数已正确绑定，但没有任何内容写入数据库。（请参阅帖子末尾的日志消息）

但最奇怪的是，我保存到 event_has_words 表中的对象被完美地存储了（带有从 word 和 event 表中生成的 id）！？！？！最重要的是没有异常被抛出！？！

有任何想法吗？我要疯了！

最好的祝福，

约翰

这是一个不起作用的映射：

```
<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <class name="de.brotkasting.buki.cep.data.hibernate.entities.Event" table="event" catalog="cep1">
        <id name="pkEventsId" type="java.lang.Integer">
            <column name="PK_Events_Id" />
            <generator class="identity" />
        </id>
        <many-to-one name="sourceSystems" class="de.brotkasting.buki.cep.data.hibernate.entities.SourceSystems" fetch="select">
            <column name="SourceSystems_PK_SourceSystems_Id" not-null="true" />
        </many-to-one>
        <many-to-one name="tweets" class="de.brotkasting.buki.cep.data.hibernate.entities.Tweets" fetch="select">
            <column name="Tweets_pk_tweet_id" not-null="true" />
        </many-to-one>
        <property name="systemTimeStamp" type="timestamp">
            <column name="System_Time_Stamp" length="19" not-null="true" />
        </property>
    </class>
</hibernate-mapping> 
```

和相应的类：

```
 package de.brotkasting.buki.cep.data.hibernate.entities;

 // Generated 28.04.2009 21:24:54 by Hibernate Tools 3.2.4.GA

 @Entity
 @Table(name = "event", catalog = "cep1")
 public class Event implements java.io.Serializable {

/**
 * 
 */
private static final long serialVersionUID = 3530010885697280401L;
private Integer pkEventsId;
private SourceSystems sourceSystems;
private Tweets tweets;
private Date systemTimeStamp;

public Event() {
}

public Event(SourceSystems sourceSystems, Tweets tweets,
        Date systemTimeStamp) {
    this.sourceSystems = sourceSystems;
    this.tweets = tweets;
    this.systemTimeStamp = systemTimeStamp;
}

@Id
@Column(name = "PK_Events_Id", unique = true, nullable = false)
public Integer getPkEventsId() {
    return this.pkEventsId;
}

public void setPkEventsId(Integer pkEventsId) {
    this.pkEventsId = pkEventsId;
}

@JoinColumn(name = "SourceSystems_PK_SourceSystems_Id", nullable = false)
public SourceSystems getSourceSystems() {
    return this.sourceSystems;
}

public void setSourceSystems(SourceSystems sourceSystems) {
    this.sourceSystems = sourceSystems;
}

@JoinColumn(name = "Tweets_pk_tweet_id", nullable = false)
public Tweets getTweets() {
    return this.tweets;
}

public void setTweets(Tweets tweets) {
    this.tweets = tweets;
}

//@Temporal(TemporalType.TIMESTAMP)
@Column(name = "System_Time_Stamp", nullable = false, length = 19)
public Date getSystemTimeStamp() {
    return this.systemTimeStamp;
}

public void setSystemTimeStamp(Date systemTimeStamp) {
    this.systemTimeStamp = systemTimeStamp;
}

   } 
```

并且要坚持的课程

```
public class TweetPersistence extends HibernateBase {

private static int batchCounter = 0;    

private static void store(Object object) throws HibernateException
{
    try {
        if(session == null)
        {
            session = sessionFactory.openSession();             
        }
        if(!session.isOpen())
        {
            session = sessionFactory.openSession();
        }
        session.save(object);
        LoggingConfigurator.getInstance().info("Objekt:" +object);
        //flush cache every 20 saved entities
        //if(batchCounter%20 == 0)
        //{
            session.flush();
            session.clear();
        //} 
        //increment batchCounter
        batchCounter++;
    } catch (HibernateException e) {
        e.printStackTrace(System.out);
    } 
}

public static void storeTweet(Tweets tweet) {

    try {

        if (tweet != null) {
            store(tweet);
        }
    } catch (HibernateException e) {
        e.printStackTrace(System.out);
    }       
  }
} 
```

在日志中我可以看到 id 生成正确

`- generated identifier: component[eventsPkEventsId,wordsPkWordListId,position]{position=128, wordsPkWordListId=128, eventsPkEventsId=56}`

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-04T21:04:46.350

从[休眠参考手册](http://docs.jboss.org/hibernate/stable/core/reference/en/html/)：

> “数据库事务永远不是可选的，与数据库的所有通信都必须发生在事务内部，无论您是读取还是写入数据”

我建议您将所有持久性操作包含在事务中。例如。

```
Session session = factory.openSession();
Transaction tx;
try {
    tx = session.beginTransaction();
    session.save(object);
    tx.commit();
}
catch (Exception e) {
    if (tx != null) tx.rollback();
    throw e;
}
finally {
    session.close();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-04T21:14:03.037

Check your logging. Most likely your `log4j.xml` (or equivalent) is sending log messages somewhere you are not expecting, or the level is not set appropriately to see messages from Hibernate. Set the level to **DEBUG** or **INFO**; this will at least let you be able to debug whatever is going wrong.

```
<logger name="org.hibernate">
    <level value="DEBUG"/>
</logger>
<logger name="org.hibernate.SQL">
    <level value="TRACE"/>
</logger> 
```

PS: providing source is great, but you need to boil it down to something concise. No one is going to read through all those details.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-10T06:41:55.393

John, I think you should change your integer to long as well as change precision and scale in your database (which is NUMBER) eq. 10 and 0 make changes in your models bigdecimal or integer to long(all getter and setter) then make changes in your `hbm.xml = bigdecimal` or integer to long as well as precision and scale. e.g. hbm.xml

```
<id name="empid" type="long">
            <column name="EMPID" precision="10" scale="0" />
            <generator class="increment" />
        </id> 
```

I was also facing that problem (oracle 10g) but now resolved I hope it helps you! just try once

# wpf - 派生自 Freezable 的 WPF 对象如何在 XAML 中冻结？

> ID：799890
> 
> 赞同：32
> 
> 时间：2009-04-28T21:26:41.463
> 
> 标签：wpf, performance, xaml, freezable

WPF 中的许多类型都派生自`Freezable`. 它为可变 POCO 对象提供不变性，并允许在某些情况下提高性能。

所以我的问题是，如何冻结 XAML 标记中的对象？

（请注意，我也发布了一个[类似但不同的问题](https://stackoverflow.com/questions/799911/)）。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-29T12:16:04.213

要冻结`Freezable`标记中声明的对象，请使用`Freeze`XML 命名空间中定义的属性`http://schemas.microsoft.com/winfx/2006/xaml/presentation/options`。

在以下示例中，a`SolidColorBrush`被声明为页面资源并被冻结。然后它用于设置按钮的背景。

```
<Page 
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:po="http://schemas.microsoft.com/winfx/2006/xaml/presentation/options" 
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  mc:Ignorable="po">

  <Page.Resources>
    <!-- This brush is frozen -->
    <SolidColorBrush x:Key="MyBrush" po:Freeze="True" Color="Red" />
  </Page.Resources>

  <!-- Use the frozen brush -->
  <Button Background="{StaticResource MyBrush}">Click Me</Button>

</Page> 
```

来源：[可冻结对象概述](http://msdn.microsoft.com/en-us/library/ms750509.aspx)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-29T11:17:58.003

将此添加到您的 xaml 命名空间声明中：

```
xmlns:po="http://schemas.microsoft.com/winfx/2006/xaml/presentation/options"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
mc:Ignorable="po" 
```

然后，在您的可冻结对象中，包含此属性

```
po:Freeze="True" 
```

# file - 如何将可视模式下的文本块保存到 Vim 中的文件中？

> ID：799899
> 
> 赞同：76
> 
> 时间：2009-04-28T21:28:13.223
> 
> 标签：file, vim, save, selection

标题非常具有描述性。以防万一，我举个例子：

```
START BLOCK1
something
END BLOCK1

START BLOCK2
something
somenthing...
END BLOCK2 
```

1.  我选择`BLOCK1`可视模式
2.  我按一下`y`
3.  如何将被拉到的文件保存`BLOCK1`到其他文件？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2009-04-28T21:37:30.067

在线条视觉或块视觉模式下选择要保存的文本，然后

```
:w new.txt 
```

这就是您键入的内容，但您实际上不会确切地*看到上面的内容。*当您按下 时`:`，您将转到命令行，该命令行将自动填写选择信息。它看起来像这样：

```
:'<,'> 
```

只需继续输入其余的 ( `w new.txt`) 即可获得

```
:'<,'>w new.txt 
```

...然后按 Enter。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-28T21:36:51.940

选择块后，您可以`:'<,'>w other-file`，这将只将选定的块写入`other-file`。在可视`:`模式下点击应该`'<,'>`已经为您放入命令行，因此您实际上只需键入`:w other-file`.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-28T21:32:44.710

可能有一种更简单的方法可以做到这一点，但我要做的是创建一个新缓冲区（或选项卡），然后将其粘贴到`p`. 您可以使用 . 创建新缓冲区`:new`或使用`:tabnew`. 您可以使用`:w filename`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-01-09T21:25:21.883

就像评论中提到的@dronus 一样，`:w !pbcopy`建议没有正确复制，因为它复制了整行。如果我只想复制一行中的 url，我将无法做到。这是您可以添加到`.vimrc`文件中的一行，以便每次按 CTRL-C 时，vim 中选定的行将被复制到剪贴板：

```
map <C-c> y:e ~/clipsongzboard<CR>P:w !pbcopy<CR><CR>:bdelete!<CR> 
```

如果您想阅读有关此功能的详细信息，可以在[我的博客上阅读](http://vimtips.quora.com/How-to-Copy-to-clipboard-on-vim)

它与@rmeador 建议的实现相同。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-08-16T15:06:18.707

与@songz 的解决方案类似，我更喜欢使用 ":new"

```
vmap <C-c> y:new ~/.vimbuf<CR>VGp:x<CR>:!pbcopy < ~/.vimbuf<CR><CR> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-12-14T20:00:05.100

## Vim 获取视觉选择并保存到文件中：

```
 function! Get_visual_selection()
        "get the position of left start visual selection
        let [line_start, column_start] = getpos("'<")[1:2]
        "get the position of right end visual selection
        let [line_end, column_end] = getpos("'>")[1:2]
        "gotta catch them all.
        let lines = getline(line_start, line_end)
        if len(lines) == 0
            return ''
        endif
        "edge cases and cleanup.
        let lines[-1] = lines[-1][: column_end - 2]
        let lines[0] = lines[0][column_start - 1:]
        return join(lines, "\n")
    endfunction

    function Save_visually_selected_text_to_file()
        let selected_text = Get_visual_selection()
        call writefile(split(selected_text, "\n"), "/tmp/something.txt")
    endfunction

    "the c-u does a union of all lines in visual selection.
    "this goes in the vimrc
    vnoremap <F10> :<c-u>call Save_visually_selected_text_to_file()<cr> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-05-12T02:17:21.983

基于@chenkaie 的变体，对我来说效果很好：

`let mapleader = "," let g:mapleader = "," vmap <leader>y y:new ~/.vbuf<CR>VGp:x<CR> nmap <leader>p :r ~/.vbuf<CR>`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-08-29T05:52:11.937

除了上面[选择](https://stackoverflow.com/questions/799899/how-can-i-save-a-text-block-in-visual-mode-to-a-file-in-vim/57703752#answer-799933)的答案，

*   使用鼠标选择 (1) 时，

*   当只想部分复制行（2）时，只复制@dronus的评论提到的整行的问题：

(1) 在我的基于 Debian 的 DietPi (Raspberry PI) 系统中，当在我的 Ubuntu 16.04 工作站上使用鼠标进入并选择“视觉模式”时，vim 的行为与上述首选解决方案略有不同。然后

*   你拉它

但如果我输入 ':' 作为命令，它不会与

```
'<,'> 
```

我可以简单地添加我的

```
w new.txt 
```

在它之后。所以我只是自己输入了它，它确实有效：

```
'<,'>w new.txt 
```

并将整行复制内容复制到我的文件“new.txt”中，而“<，”似乎意味着“复制选定的行并“>”将其重定向到写入命令的引用文件。

（2）对于不粘贴部分行的问题，就像在@dronus[评论](https://stackoverflow.com/questions/799899/how-can-i-save-a-text-block-in-visual-mode-to-a-file-in-vim/57703752#comments-799933)中提到的那样，[这个](https://stackoverflow.com/questions/4620672/copy-and-paste-content-from-one-file-to-another-file-in-vi#answer-4620693)解决方案（选择的一个，第一个替代方案）对我有用：

编辑第一个文件，拉出你想要的文本。然后在 vi (:e /path/to/other/file) 中打开第二个文件并粘贴它（通过键入 p）。保存它（如上面的'：w new.txt'。

然后它将只复制用鼠标或“y”标记的部分行。

[编辑] 在我的 Ubuntu 系统上：有时通过鼠标选择不会在 vim 中进入“视觉模式”。然后可以使用上下文菜单选择正常的复制/粘贴...我还没有找到 Ubuntu 将其行为从“客户端代理行为”更改为“主机”行为的原因（Ubuntu 将 ssh bash 窗口托管到我的“客户'）...

# zsh - 无法在 Zsh 中缩短特定提示的 PATH

> ID：799905
> 
> 赞同：1
> 
> 时间：2009-04-28T21:30:15.620
> 
> 标签：zsh

我在 /usr/local/bin运行以下[代码失败](http://www.ibm.com/developerworks/linux/library/l-z.html)

```
LBIN=/usr/local/bin 
```

**如何在 Zsh 中更改特定提示的 PATH？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T05:32:05.033

设置后

```
LBIN=/usr/local/bin 
```

尝试对其进行 cd-ing：

```
$> cd ~LBIN 
```

并查看提示向您显示的内容。

如果你想要这个默认行为，在你的 zshrc 中设置 LBIN。

# wcf - 使用 http（端口 80）的 Pub Sub（无 WCF 客户端）

> ID：799909
> 
> 赞同：-1
> 
> 时间：2009-04-28T21:30:55.463
> 
> 标签：wcf, networking

我想开发一个可扩展的 pub-sub 系统，它必须在端口 80 防火墙 \ NAT 应该正常工作，我无法部署 WCF 客户端（如果需要，服务器可以是 WCF）任何关于如何开始的想法 \ 建议

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T13:35:55.940

查看 IDesign 的 Juval Lowy 开发的发布-订阅框架和发布-订阅[示例](http://www.idesign.net)。框架和示例可以免费下载和使用。您只需提供您的电子邮件地址。下载链接在[这里](http://www.idesign.net/idesign/DesktopDefault.aspx?tabindex=5&tabid=11#Operations)。您可能需要向上滚动一点才能看到它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T21:37:04.357

您可以通过 HTTP 使用 MSMQ。看看[这个帖子](http://blogs.msdn.com/mismail/archive/2008/12/31/msmq-over-http.aspx "基于 HTTP 的 MSMQ")

# wpf - 在哪些场景下冻结 WPF 对象对性能有很大的好处？

> ID：799911
> 
> 赞同：48
> 
> 时间：2009-04-28T21:31:18.100
> 
> 标签：wpf, performance, freeze, freezable

WPF 中的许多类型都派生自`Freezable`. 它为可变 POCO 对象提供了不变性，并且显然可以在某些情况下提高性能。

有没有人发现在他们的 WPF 应用程序中冻结对象大大提高了性能？如果是这样，那么在冻结时哪些项目的性能差异最大？

（请注意，我也发布了一个[类似但不同的问题](https://stackoverflow.com/questions/799890/)）

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2010-03-06T21:24:53.763

您可能对我使用 Freezable 的经历感兴趣：

我曾经使用 muPdf 编写了一个 PDF 查看器，它呈现位图，我用 WPF 呈现。对性能有很大帮助的是，我可以在后台线程上渲染页面位图，冻结它们，然后将它们传递给 UI 线程。WPF 不会复制图像来冻结它，这很好，但是在后台线程上完成所有这些准备工作的能力对我来说是关键的好处。

据我了解，所有视觉效果都需要冻结，以便 WPF 渲染线程可以安全地渲染它们。如果您渲染大型未冻结的视觉对象，它们将在 WPF 渲染它们时被克隆为冻结的视觉对象。如果您事先冻结静态位图，WPF 可以只与渲染线程共享指针而无需克隆。如果 WPF 不知道对象自上次呈现时是否发生更改，则解冻的对象甚至可能会被重复复制。冻结对象消除了所有这些复制的需要。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-29T13:35:27.737

如果您使用 Image 控件（而不使用 Freeze 方法），可能会发生这些潜在的内存泄漏：

a) 您使用 BitmapImage 作为 Image 源并且不释放 BitmapImage：

```
static BitmapImage bi1 = new BitmapImage(new Uri("Bitmap1.bmp",UriKind.RelativeOrAbsolute));
m_Image1 = new Image();
m_Image1.Source = bi1; 
//bi1.Freeze() 
//if you do not Freeze, your app will leak memory.
MyStackPanel.Children.Add(m_Image1); 
```

b) 您指定多个 BitmapImage 作为 Image 源，并且不释放您使用的所有 BitmapImage（类似于 (a)）。这个在 .Net 3.5 中引入：

```
static BitmapImage bi1 = new BitmapImage(new Uri("Bitmap1.bmp",
UriKind.RelativeOrAbsolute));
static BitmapImage bi2 = new BitmapImage(new Uri("Bitmap2.bmp",
UriKind.RelativeOrAbsolute));
bi2.Freeze();
m_Image1 = new Image();
//bi1.Freeze() 
//even though you are really using bi2 for Image Source, 
//you also need to Freeze bi1 it to avoid leak 
m_Image1.Source = bi1;  // use un-frozen bitmap, which causes the leak
m_Image1.Source = bi2;  // use frozen bitmap
MyStackPanel.Children.Add(m_Image1); 
```

来源：[WPF 性能](http://blogs.msdn.com/jgoldb/default.aspx)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-03-14T09:49:25.407

尽管您已经接受了答案，但只是想记录对我有更好帮助的答案的不同版本。

来自[MSDN](https://msdn.microsoft.com/en-us/library/ms750509(v=vs.100).aspx)（小编辑）：

> 如果您要修改对非托管低级资源（例如：画笔）的控制持有引用，则每次修改都必须重新生成那些低级对象！
> 
> 可冻结类使画笔能够找到其相应生成的低级对象并在更改时更新它们。启用此功能后，笔刷被称为“解冻”。
> 
> freezable 的 Freeze 方法使您能够禁用这种自我更新能力。您可以使用此方法使画笔“冻结”或无法修改。从而提高性能。

并且，解释用法的代码：

```
 Button myButton = new Button();
            SolidColorBrush myBrush = new SolidColorBrush(Colors.Yellow);

            if (myBrush.CanFreeze)
            {
                // Makes the brush unmodifiable.
                myBrush.Freeze();
            }                
            myButton.Background = myBrush;        
            if (myBrush.IsFrozen) // Evaluates to true.
            {
                // If the brush is frozen, create a clone and modify the clone.
                SolidColorBrush myBrushClone = myBrush.Clone();
                myBrushClone.Color = Colors.Red;
                myButton.Background = myBrushClone;
            }
            else
            {
                // If the brush is not frozen, it can be modified directly.
                myBrush.Color = Colors.Red;
            } 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-01-20T22:59:27.957

我开发了一个高性能的图像查看器应用程序。我们在后端有代码，每帧创建一个新的位图，并将该位图写入屏幕，如下所示：

```
Writeablebitmap wb = new WriteableBitmap();
//  < code to set the wb pixel values here >

// Push the bitmap to the screen
image.Source = wb; 
```

在测试期间，我们注意到在中等大小的图像 (1080p) 中以 30+ FPS 运行时出现了可怕的闪烁。修复？只需在将其设置为 image.Source 之前冻结位图。没有更多的产品性能错误。现在我试着冷冻我能做的一切。

# user-interface - 平滑（动画）GUI 转换

> ID：799913
> 
> 赞同：0
> 
> 时间：2009-04-28T21:31:34.340
> 
> 标签：user-interface, language-agnostic, graphics, animation

有时您会看到平滑的动画过渡，用于调整大小、展开和显示图形控件。不仅仅是一些摇尾巴的文件搜索狗，还有小部件配置的动画在结构和/或几何上改变它的状态。

我没怎么用过 Windows Vista，但肯定知道在 XP 上你可以为下拉菜单设置这种效果。其他系统/图形外壳呢？它是在系统级别自动实现的，以至于应用程序代码（甚至是图形框架）根本不处理它吗？

我知道 Qt 有一组动画类。其他 gui 框架（wxwidgets、swing、gtk、.. 你的名字）怎么样？由于某些框架依赖于本机 API，因此不会与系统动画（-> 上一段）发生冲突吗？

就微结构而言，控件的动画过渡设计的最佳实践是什么？可以使用什么视觉设计？它们如何与 layouts/sizer 和自动调整大小一起使用？性能呢？

这是一个广泛的问题，我几乎不指望它可以通过一个答案来解决。但是，任何有助于理解总体情况的线索都将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T21:41:41.913

一种“最佳实践”：确保动画不会妨碍接受输入。

例如，如果您正在淡入菜单，请在淡入*之前*激活键盘快捷键上下文，这样 J. Random Poweruser 就不必在此之前坐 200 毫秒（如果磁盘访问或类似情况出现问题，则更长时间）按快捷键。与接受点击等相同。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T21:34:25.643

有几个 Java 动画框架：

*   [https://animation.dev.java.net/](https://animation.dev.java.net/)
*   [https://timingframework.dev.java.net/](https://timingframework.dev.java.net/)

据我所知（使用了第二个），他们处理时间方面并让客户端处理实际的动画部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-19T20:18:20.043

我为这些类型的 UI 动画创建了一个 C# 库，称为转换： [http ://code.google.com/p/dot-net-transitions/](http://code.google.com/p/dot-net-transitions/)

它可以为表单或控件的大多数 UI 属性设置动画。它适用于 .NET 2 或更高版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T22:33:41.040

Windows 7 引入了一个基于 C++/COM 的动画框架，称为 Windows Animation。 [http://channel9.msdn.com/posts/yochay/Windows-Scenic-Animation-Overview/](http://channel9.msdn.com/posts/yochay/Windows-Scenic-Animation-Overview/)

尚未宣布是否会为 Vista 重新分发它。

它处理时间、状态管理，有一个小的过渡曲线库，并有一些很酷的特性，比如压缩和速度匹配来处理碰撞动画。

它实际上并没有在屏幕上绘制东西。这取决于应用程序，它可以使用 GDI 或 Direct 2d。

在 Windows 中，没有用作主题一部分的系统范围的动画集，也没有最佳实践。我建议为您自己的应用程序开发一套原则，并查看现有应用程序以获取想法。iPhone 和 Zune 桌面软件都是广泛且一致地使用动画的软件的好例子。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-10T02:41:50.350

我会推荐阅读Romain Guy 和 Chet Hasse 的[Filthy Rich Clients](http://filthyrichclients.org/)。事实上，其他答案之一中提到的时间框架最初是由 Chet Hasse 编写的，是本书的重要组成部分。它专注于 Java，但同样的原则也适用于所有语言。至于其他语言的动画，JavaFX 在语言中内置了这些类型的动画。 [Flare](http://flare.prefuse.org/)是一个 Flex 库，内置了一些很酷的动画过渡，用于图形和信息可视化。JQuery 和 YUI 也有很好的动画功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T21:46:45.880

我们使用[Infragistics](http://infragistics.com/)为所有 UI 铃声提供口哨和其他东西。有一些缺点 - 需要一段时间才能加快控制速度。但是它们提供了出色的示例应用程序，最终您可以将一些复杂的用户界面放在一起，而无需过多的自定义控制工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T22:54:01.317

WPF (.NET 3.0?) 和 Silverlight(v1.0+) 能够渲染动画。您设置触发器，然后开始播放帧。

# flash - 皮肤Flash播放器的最佳方法

> ID：799925
> 
> 赞同：1
> 
> 时间：2009-04-28T21:36:22.440
> 
> 标签：flash, actionscript-3, components, design-patterns

是否有一个很好的模式来创建一个易于换肤、提供不同尺寸、按钮、背景颜色等的 Flash 播放器？我考虑了两种方法：

1 玩家皮肤平坦。徽标和按钮位于一张大背景图片上。实际触发区域是由外部xml或json定义的透明精灵、位置和尺寸。

我看到的问题是设计背景的人限制了皮肤，并且在 UI 中可以做的事情更少（例如，按钮上的悬停状态）。然而，这使得通过定义新的背景图像和透明精灵触发器的位置来创建新皮肤非常容易。

2 我考虑的另一种方法是将所有图形资源转换为影片剪辑和/或位图。这需要将资产放入由播放器从外部加载的 swf 的阶段。这种方法在定位资产（如果浏览器中播放器大小发生变化时相对）以及按钮上的悬停状态提供了更大的灵活性。当然，缺点是在 Flash 中为播放器设置资源需要花费更多时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T21:44:19.533

为什么不使用 Flex？哪个内置了换肤功能？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-04T09:45:49.680

实际上有一个模板可供下载，您可以在其中重新设置 Flash、Photoshop 或 Illustrator 中的所有标准组件。您所做的就是将模板交给设计人员并阅读应用程序中的样式表。

[http://www.adobe.com/cfusion/entitlement/index.cfm?e=flex_skins](http://www.adobe.com/cfusion/entitlement/index.cfm?e=flex_skins)

# c++ - 快速跨平台 C/C++ 散列库

> ID：799932
> 
> 赞同：12
> 
> 时间：2009-04-28T21:37:25.743
> 
> 标签：c++, c, cross-platform, hash

什么是 C/C++ 跨平台的高性能哈希库。适用于 MD5、SHA1、CRC32 和 Adler32 等算法。

我最初的印象是 Boost 有这些，但显然（还没有）。

到目前为止我发现的最有前途的是 Crypto++，还有其他建议吗？[http://www.cryptopp.com/](http://www.cryptopp.com/)这个好像挺全面的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-28T22:00:17.640

对于通常的加密哈希（MD？、SHA？等），[openssl](https://www.openssl.org/)是最便携的，可能也是最快的。您提到的哈希都不适用于哈希表等高性能数据结构。如今，这些数据结构的推荐散列函数是：FNV、Jenkins 和 MurmurHash。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-28T21:44:45.663

QT[似乎实现了](http://doc.trolltech.com/4.3/qcryptographichash.html)MD4、MD5 和 SHA1

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T21:51:56.973

我肯定会选择 CryptoPP，它也有一个很好的许可证。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T21:44:53.793

[zlib](http://www.zlib.net/)有一个 crc32 变体的内置实现，并且被广泛移植。=)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-28T22:12:59.637

设备跨平台？如果它对你意味着对我意味着什么，那意味着它不是 linux 或者可能是独立于操作系统的。我会并且确实避免了诸如openssl之类的事情。我选择了 libtomcrypt。现在就速度而言？好快，便携，C，随便选了两个。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-10T06:22:12.400

也许你可以使用[libbeecrypt](http://beecrypt.sourceforge.net/)？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-06-24T09:24:16.857

看看[plibsys](https://github.com/saprykin/plibsys) C 库：它支持 MD5、SHA1、SHA-2（224、256、384、512）、SHA-3（224、256、384、512）和 GOST 34.11-94 加密哈希算法。该库本身是可移植的且重量轻。

# visual-studio-2008 - 设计模式 VS2008 中 RDLC 的工具箱问题

> ID：799934
> 
> 赞同：0
> 
> 时间：2009-04-28T21:37:58.410
> 
> 标签：visual-studio-2008, rdlc, toolbox

我正在尝试设计一个 RDLC 报告，但是我的工具箱中充满了大约 10 个“文本框”控件和一个奇怪的空 #13119 控件组。我找不到其他控件。我尝试了几个命令行开关来重建 VS 缓存，但没有任何效果。我是否需要指向特定的 DLL 才能拉入工具箱控件？告诉我我不需要重新安装VS2008。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-02T20:21:57.797

我的直觉告诉我，您的安装中有些东西已经损坏。

这是我在尝试修复之前会尝试的方法（最近发生了这种情况）：

我通过进入我的个人资料来解决这个问题，如下所示：

C:\Documents and Settings\MYUSERNAME\Local Settings\Application Data\Microsoft\VisualStudio\8.0\ProjectAssemblies

那里有四个隐藏文件，它们显然构成了工具箱缓存。如果您删除它们，它们将被重新生成并且#13119 将返回到 General。正如我所说，这些文件似乎是隐藏的，因此请相应地配置文件资源管理器。

第二个问题：我的用户控件从工具箱中消失了。
我可以通过进入 VS 菜单来修复它：

Visual Studio“工具”菜单

“选项”子菜单

“Windows 窗体设计器”选项卡“常规”选项卡将“AutoToolboxPopulate”设置为“True”

# ruby-on-rails - 在没有 SQL 复制的情况下保持跨 Rails 应用程序的表同步？

> ID：799935
> 
> 赞同：3
> 
> 时间：2009-04-28T21:38:13.480
> 
> 标签：ruby-on-rails, rest, replication

我有一个 rails 应用程序，它使用两个与我拥有的另一个 rails 应用程序相同的模型。在两个模型之间保持数据同步的最佳方法是什么？

由于托管限制，MySQL 复制可能无法实现，并且由于引用复制数据的内容是依赖的 => :destroy 意味着 mysql 复制将导致指向已删除的复制数据的内容保留。

简而言之，在应用程序级别上，在每个模型的基础上，在两个 Rails 应用程序之间进行复制的最佳方式是什么？我将不得不使用 REST 破解我自己的复制，还是有更好的方法？

我应该补充一点，数据不经常更改，一天最多几次，而且数据集总是少于 50k 行。

编辑：针对下面托比的评论，数据都是单向的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T18:58:14.917

这不是一个具体的答案，但考虑某种排队机制。应用程序 A 进行更改并写入队列和数据库。“队列”可以是数据库中的一个表，上面写着“App A changed Model M with id I”。然后，两个应用程序都可以有一个轮询该表并应用更改的进程。

当双方修改同一个对象时，您会遇到麻烦。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T19:25:25.850

所以，事实证明有两个插件可以做到这一点：

[充当副本](http://code.google.com/p/actsasreplica/) 和 [可同步](http://code.google.com/p/acts-as-syncable/)

作为副本的行为似乎有更好的文档。

然而，看看它的复杂性，我认为为了我自己的需要，我会推出自己的，虽然对于我自己的用例来说并不完美会简单得多。

我复制的表中的所有数据都是从 XML 文件中挑选出来的。出于隐私原因，无法将 XML 完整发送到服务器以进行复制（我只在两个应用程序中使用了一个子集，但额外的数据是敏感的），所以我将只公开一个 REST 接口，其中包含我的数据需要并复制它。

# iis - 在 Powershell 中设置属性语法

> ID：799937
> 
> 赞同：1
> 
> 时间：2009-04-28T21:38:27.240
> 
> 标签：iis, powershell

我是 PowerShell 的新手，我正在尝试使用以下语法更改 IIS 网站的属性（这不起作用）

```
(get-item 'IIS:\Sites\Default Website').logFile.directory = 'd:\' 
```

它不会显示任何错误，但也不会更改属性。

有人帮忙吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T05:25:43.950

您可能需要：

使用正确的目录设置`logFile`为新值

或者

`Set-ItemProperty 'IIS:\Sites\Default Website' -name ...`

# c# - 根据属性值将对象放入单独列表的最巧妙方法

> ID：799939
> 
> 赞同：0
> 
> 时间：2009-04-28T21:39:52.370
> 
> 标签：c#, .net, linq

我有一组对象，我很好奇您将它们分成两个列表的方式 - 一个列表将包含特定类型的所有内容，另一个将包含其余部分。我想到的一种方法是：

```
var typeXs = (from o in collectionOfThings where o.Type == "typeX" select o);
var notTypeXs = (from o in collectionOfThings where o.Type != "typeX" select o); 
```

另一种方法是循环 collectionOfThings 并根据 if/else 进行分配。

两种方式都简单易读，但我只是想知道是否有更流畅的方式？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-28T22:09:21.003

这个例子应该展示你所追求的：

```
class MyObject
{
    public int n;
    public string t;
} 
```

加载我的原始列表：

```
List<MyObject> allObjects = new List<MyObject>() {
    new MyObject() { n = 0, t = "x" },
    new MyObject() { n = 1, t = "y" },
    new MyObject() { n = 2, t = "x" },
    new MyObject() { n = 3, t = "y" },
    new MyObject() { n = 4, t = "x" }
}; 
```

使用以下方法拆分类型：

```
var typeXs = allObjects.FindAll(i => i.t == "x");
var notTypeXs = allObjects.FindAll(i => i.t != "x"); 
```

*或者*

```
var typeXs = allObjects.Where(i => i.t == "x").ToList<MyObject>();
var notTypeXs = allObjects.Except(typeXs).ToList<MyObject>(); 
```

*或者*，您可以使用仅迭代一次的 List.ForEach 方法，因此理论上*应该*优于其他两个选项。此外，它不需要引用 LINQ 库，这意味着它是 .NET 2.0 安全的。

```
var typeXs = new List<MyObject>();
var notTypeXs = new List<MyObject>();
allObjects.ForEach(i => (i.t == "x" ? typeXs : notTypeXs).Add(i)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T21:47:49.900

您可以将第二部分重写为

```
var notTypeXs = collectionOfThings.Except(typeXs); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T21:45:17.927

```
coll.GroupBy(o => o.Type == "TypeX"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T21:49:57.947

我不想对你进行优化，但我认为你应该考虑只迭代一次。

```
 // You can optimize this by specifying reasonable initial capacities.
List<TypedO> typeXs = new List<TypedO>();
List<TypedO> notTypeXs = new List<TypedO>();

foreach(TypedO o in list)
{
    (o.Type == "typeX" ? typeXs : notTypeXs).Add(o); // Yeah, I know.
} 
```

（更正）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T22:57:16.160

如果您不想通过列表两次，那么：

```
 var collectionOfThings = new[] 
        {
            new Thing { Id = 1, Type = "typeX" },
            new Thing { Id = 2, Type = "typeY" },
            new Thing { Id = 3, Type = "typeZ" },
            new Thing { Id = 4, Type = "typeX" }
        };

    var query = (from thing in collectionOfThings
                 group thing by thing.Type == "typeX" into grouped
                 //orderby grouped.Key descending
                 select new
                 {
                     IsTypeX = grouped.Key,
                     Items = grouped.ToList()
                 }).ToList();

    var typeXs = query.Find(x => x.IsTypeX).Items;
    var notTypeXs = query.Find(x => !x.IsTypeX).Items; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T23:24:06.223

我会使用“OfType”链接表达式，如下所示：

```
var typeXs = collectionOfThigs.OfType<typeX>();
var notTypeXs = collectionOfThings.Except(typeXs); 
```

（包括 . 除了另一个答案）。这确实假设您具有类型，而不仅仅是类型字符串。

此外，不只做一次决定可能会导致性能损失（如果重要的话，使用拆分添加的 if 可能是要走的路），但除非性能有问题，否则我更喜欢清晰。

# c# - 开始学习 LINQ 的最佳地点在哪里？

> ID：799941
> 
> 赞同：2
> 
> 时间：2009-04-28T21:41:13.410
> 
> 标签：c#, linq

我已经阅读了我的第一本关于 c# 的书，并且对 LINQ 完全一无所知。请建议读者友好的 linq 材料。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T21:53:42.303

有几个人向我推荐了[LINQ in Action 。](http://linqinaction.net/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T22:12:01.700

下载[LINQPad](http://www.linqpad.net/)并使用它。它带有许多免费样品。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T22:33:49.167

微软创建了 LINQ。那么为什么不从[有关它的 Microsoft 文档开始呢](http://msdn.microsoft.com/en-us/library/bb397897.aspx)？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T23:29:17.927

作为参考指南， [Pro Linq](https://rads.stackoverflow.com/amzn/click/com/1590597893)是 IMO 最好的指南。

一旦您更有经验并想了解更多内部知识，[Linq 编程](http://www.microsoft.com/learning/en/us/Books/10827.aspx)就是您想要的书。

还有一些很棒的博客，[Matt Warrens](http://blogs.msdn.com/mattwar/)和[Bart De Smets](http://community.bartdesmet.net/blogs/bart/)是高级 Linq 主题的精彩资源。

但是，作为初学者的绝对最佳起点是[101 linq 示例站点](http://msdn.microsoft.com/en-us/vcsharp/aa336746.aspx)，并实际尝试一下。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-28T23:39:38.383

[来自 Microsoft 的 Charlie Calvert 在这里](http://blogs.msdn.com/charlie/archive/2006/10/29/technical-links-to-linq.aspx)写了一篇很棒的博客文章，让您深入了解使用 LINQ 进行编码。

我希望这会有所帮助。

伊恩。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T22:31:01.217

我强烈推荐 Jon Skeet 的“C# In Depth”。他将引导您完成更新 .net 2 和 3，您需要了解这些更新才能充分了解 Linq 正在发生的事情。你可能也在这里看到过他的名字:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-29T10:45:14.650

而且我并没有真正使用这种类似 SQL(tm) 的语法，而是使用了很好的旧方法和 lambda 组合，例如

```
list.Where(n => n.Something == searchingFor)
    .Select(n => new { Whatever.... })
    .OrderBy(xxx) 
```

工作方式相同，使用相同的功能，但对我来说看起来不那么认可。对于指南，我使用 Intellisense。

# f# - 您在 F# 中创建了哪些简单、重要、可用的代码

> ID：799943
> 
> 赞同：7
> 
> 时间：2009-04-28T21:41:53.393
> 
> 标签：f#

我正在尝试学习 F#，但由于我从未做过任何函数式编程或学习过其中的课程，我发现很难将琐碎的斐波那契或阶乘示例推广到我将如何做一些有用的事情。

那么，网上有哪些简单但不平凡、不平凡且可用的 F# 代码呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-28T21:43:38.537

[这是来自 PDC 的精彩会议](http://channel9.msdn.com/pdc2008/TL11/)——他做了一个相当重要的示例应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T23:30:30.263

有很多有趣的代码示例的博客；从[http://fsharp.net](http://fsharp.net)开始并关注各种社区博客和示例以挖掘一些内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T07:55:27.833

每当我需要解析器支持（现在您可能称之为 DSL）以及实现符号处理算法时，我都喜欢使用它。

我用 F# 编写的最新生产性代码涉及过滤器（用于过滤传入日志服务的消息）。我有几个基本过滤器（处理主题等）和高阶逻辑过滤器，它们将其他过滤器与 AND/OR/NOT 运算符组合在一起。该实现通过将它们转换为 CNF、按类型收集并使用特殊规则（如 a < 5 && a < 10 => a < 5 等）来简化此类“表达式”。在此之上，我使用 fsyacc 创建了一个简单的解析器来为该服务的用户提供一种更简单的方式来创建过滤器。

我想 F# 中的漏洞与我在 C# 中只需要编写简化代码所需的代码行一样多；）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T09:09:19.223

我知道这不是一个直接的答案，而是我的建议：从 Haskell 移植一些库。你会得到一些很棒的、有保证的功能代码来读写。它会迫使你进入不同的心态。

示例： [FParsec](http://www.quanttec.com/fparsec/)和[FsCheck](http://fscheck.codeplex.com)。[Hacakge](http://hackage.haskell.org/packages/archive/pkg-list.html)有很多候选人。

或者，阅读[Real World Haskell](http://www.realworldhaskell.org/)书籍并尝试用 F# 编写一些示例。

最后，查看[codeplex](http://www.codeplex.com)和朋友以获取带有 F# 标记的内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-14T16:23:52.527

使用[FParsec](http://www.quanttec.com/fparsec/)[验证电子邮件地址](http://bugsquash.blogspot.com/2009/04/email-validation-with-fparsec.html)

# html - 为什么这个 html 表格中没有显示表格边框

> ID：799944
> 
> 赞同：8
> 
> 时间：2009-04-28T21:42:03.830
> 
> 标签：html

我有一个像这样的简单 html 表：http: [//jsbin.com/oxiyi](http://jsbin.com/oxiyi)

我想在整个表格之外有一个颜色为 #990000 的边框。所以我在桌子外面做了一个桌子，并给它边框颜色#990000。但我仍然没有看到边框颜色。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-28T21:47:03.820

使用带有 CSS 样式的边框属性并为其指定颜色。我也摆脱了您示例中的嵌套表。

```
<style>
td {
    border: solid 2px lightgrey;
}
</style>
<table style="border: 5px solid #990000; border-collapse: collapse"> 
```

[http://jsbin.com/odici](http://jsbin.com/odici)

这样可以保留您细胞的边界...

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-28T21:48:51.020

表内表！哦不！我头疼。

你应该庆幸这不起作用，因为它是可怕的标记，应该不惜一切代价避免。查看您的 HTML 代码，我注意到设置了很多内联属性并且没有使用 CSS。您真的应该阅读 CSS，因为您现在拥有的代码看起来更像是 2000 年生成的代码，而不是我们现在正在做的。但是，简而言之，您可以摆脱外部表格并在表格中添加样式声明`border: 1px solid #990000;`以获得您想要的效果。然而，这只是冰山一角，你真的应该在你的网站自我崩溃之前阅读 CSS 和有效标记。:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T21:47:58.620

可能是因为外表的边框设置为 0

将边框 =0 更改为边框=1

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-28T21:49:24.327

更好的方法是删除外部表格并通过 CSS 添加边框：

```
<table ... style='border: 1px solid #900'> 
```

更好的是，使用外部样式表来设置表格的样式。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-28T21:49:52.593

几个问题：

1.  A`<div>`将是这项工作的更好工具
2.  您的外部表已`bgcolor` 指定，而不是`bordercolor`
3.  您的外表已`border`设置为 0
4.  您还需要在内表周围包含一个`<tr>` and`<td>`以使您的 HTML 正确

像这样：

```
<table name='outerTable'>
    <tr>
        <td>
            <table name='innerTable'>
                <tr>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </td>
    </tr>
</table> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-10-21T20:25:46.553

您需要在代码中添加两种样式：

1.  为表格标签添加了“border-collapse:collapse”样式
2.  为所有 td 标签添加了“边框：1px 纯灰色”样式

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-04-20T08:35:29.900

尝试使用以下代码

```
tr .bordered{
      border-bottom:1px solid #000;
    } 
```

在调用它的同时使用

```
<tr class="bordered"></tr> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-28T21:47:48.340

如果没有看到您的标记，我无法确切告诉您为什么您的表格无法正确交互，但我确实看到您的基本方法存在问题。

而不是另一个表，将您的表包装在一个 DIV 标记中，如下所示：

```
<div style="border:solid 1px #990000;"> 
   <your table> 
</div> 
```

这更好地符合 HTML/XHTML 的现代标准。

如果没有看到您的代码，我无法告诉您您的内部表格是否符合最佳实践。

希望这可以帮助

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-09-10T10:31:39.140

*   在“/css”目录中创建一个自定义 css 文件，例如“local.css”

    *   在marinelli.info 文件中添加以下代码。样式表[全部][] = css/local.css

    *   尝试在您的自定义 css（即 local.css）文件中添加以下 css 代码：

    tbody { 边框顶部：1px 实心#CCC；}

    tr, tr.even { 背景：#dedede; }

    表 tr th { 背景：#757575; }

    tr td, tr th { 边框：1px 纯白色；}

    table tr th，table tr th a，table tr th a：悬停{颜色：白色；}

    *   请在此处清除缓存数据 - /admin/config/development/performance

    Rgrds,

# c - 有人可以帮助解释 gdb 中的打印命令吗

> ID：799945
> 
> 赞同：1
> 
> 时间：2009-04-28T21:42:04.983
> 
> 标签：c

“以 $ 开头的名称指的是寄存器（如果程序要返回现在选择的堆栈帧，它们将具有的值，恢复由更远的帧保存的所有寄存器）或调试器“方便”变量（任何此类名称不一个已知的寄存器）。使用赋值表达式为便利变量赋值。”

上面的行来自 gdb 中的帮助打印。有人可以解释一下上面的内容。特别是这里提到的是哪个寄存器？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T21:48:07.217

因此，根据手册页， print 是“显示表达式的值”。因此，这些将讨论当前断点处 CPU 中的寄存器值。以下是有关调试寄存器值的一些[详细信息。](http://web.mit.edu/gnu/doc/html/gdb_10.html#SEC63)

> GDB 有四个“标准”寄存器名称，在大多数机器上都可用（在表达式中）——只要它们不与体系结构的寄存器规范助记符冲突。寄存器名称 $pc 和 $sp 用于程序计数器寄存器和堆栈指针。$fp 用于包含指向当前堆栈帧的指针的寄存器，$ps 用于包含处理器状态的寄存器。例如，您可以使用十六进制打印程序计数器

您可以通过以下方式获得更多关于您可以使用哪些寄存器的信息

```
info registers 
```

和

```
info all-registers 
```

然后是特定寄存器的附加信息

```
info registers register_name 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T21:45:56.630

它指的是CPU寄存器。例如，EAX、ECX、ESP、EIP……

# asp.net - 如何为 ASP.NET 按钮创建键绑定/快捷方式以通过该按钮回发？

> ID：799946
> 
> 赞同：1
> 
> 时间：2009-04-28T21:42:21.257
> 
> 标签：asp.net, postback, key-bindings

我正在开发旨在成为 ASP.NET 中非常高效的 UI 的东西。

我希望我的用户能够点击 ALT-A 通过特定按钮回发表单。换句话说，当他们点击“ALT A”时，表单将回发，与特定 ASP.NET 按钮控件关联的事件处理程序/函数将运行。

我怎样才能做到这一点？我有 ASP.NET 2.0/3.5。我还可以使用 Telerik 控制装置。

-KF

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T22:19:44.300

在 HTML 中使用“accesskey”属性。

```
<input type="submit" accesskey="a" value="Submit">
<asp:Button AccessKey="a" runat="server" .... 
```

# .net - 在 .NET 中延迟加载 TreeView

> ID：799949
> 
> 赞同：8
> 
> 时间：2009-04-28T21:43:16.993
> 
> 标签：.net, treeview

这是 System.Windows.Forms.TreeView，而不是 WPF 或 Web TreeView。

我一定是错过了什么，因为我不敢相信这有那么难。

我的表单上有一个 TreeView。加载所有数据以填充 TreeView 非常慢，因此我只想加载顶级节点，然后在用户展开节点时填充子节点。问题是，如果一个节点没有任何子节点，它不会在节点旁边显示 + 号，这意味着它无法展开，这意味着我无法捕获 Expanding 事件来加载子节点。

几年前，当我使用 PowerBuilder 时，您会将 HasChildren（或类似的）属性设置为 true 以本质上对控件“撒谎”并强制它显示 +，然后您可以捕获 Expanding 事件。当没有子节点时，我无法弄清楚如何强制 + 出现在节点上。

我尝试了一种方法，在每个节点上添加一个虚拟节点，然后扩展检查虚拟节点是否存在并将其删除，然后加载子节点，但由于各种原因，不值得在这里讨论该解决方案在我的情况下可行。

我在谷歌上搜索了 c#、treeview、delayed、deferred、load、force、expansion 和其他一些现在没有运气的术语的各种组合。

PS 我在 SourceForge 上找到了 TreeViewAdv 项目，但如果可以避免的话，我宁愿不要在我们的环境中引入新组件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T09:49:56.653

在启动时加载前 2 个级别，并在扩展节点时加载 2 个级别。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T01:51:03.280

我同意克里斯的观点，我不得不做这件不同的事情。加载顶部节点，然后捕获单击事件，确保单击是在选定节点上，然后填充该节点，最后展开它。

如果需要加号，则加载顶部节点并在其中放置一个虚拟节点。确保捕获单击或展开事件，清除节点然后重新填充它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T22:29:39.363

一种可能的解决方案是领先于树视图一步：

```
private void Form1_Load(object sender, EventArgs e)
{
    // initialise the tree here
    var nodeSomething = treeView1.Nodes.Add("Something");
    nodeSomething.Nodes.Add("Something below something");

    treeView1.AfterExpand += AfterExpand;
}

private void AfterExpand(object sender, TreeViewEventArgs e)
{
    foreach (TreeNode node in e.Node.Nodes)
    {
        // skip if we have already loaded data for this node
        if (node.Tag != null) 
            continue;
        node.Tag = new object();
        node.Nodes.AddRange(GetDataForThisNode(node));
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-29T09:08:30.623

使用 TreeViewAdv（在 sourceforge 上）可能会更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T01:42:20.743

我也想知道如何让 + 出现在无子节点旁边，但我从来没有找到一个好方法。我的解决方案是像这样处理 MouseDoubleClick 事件：

```
Private Sub tvwMain_MouseDoubleClick(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles tvwMain.MouseDoubleClick
    Dim oNode As TreeNode

    oNode = tvwMain.GetNodeAt(e.X, e.Y)

    If oNode IsNot Nothing Then
        If oNode.Nodes.Count = 0 Then
            'add children here
        End If
    End If
End Sub 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T01:57:58.067

您是否尝试过将添加的节点包含在`BeginUpdate()`和`EndUpdate()`调用中？这将禁用任何绘画，因此允许您将大量节点添加到 TreeView，而不会产生明显的延迟。

[MSDN：TreeView.BeginUpdate 方法](http://msdn.microsoft.com/en-us/library/system.windows.forms.treeview.beginupdate(VS.85).aspx)

# regex - 更正 VIM 中错误的标记折叠

> ID：799951
> 
> 赞同：0
> 
> 时间：2009-04-28T21:43:39.850
> 
> 标签：regex, vim, folding

我错误地将标记折叠到我的.vimrc：

```
{{{8 #CS
something..
}}}8  
{{{9 #Math
...
}}}9  
... many more! 
```

我需要将格式切换为“#SOMETHING {{{NUMBER”，例如：

```
#CS {{{8 
something..
}}}8  
#Math {{{9 
...
}}}9  
... many more! 
```

以下代码有什么问题：

```
:%s$/({{{\d/) /(#[:alpha:]/)$\2 \1$g 
```

**[解决方案]**

```
%s$\({{{\d\) \(#[[:alnum:]]*\)$\2 \1$g 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T21:51:11.593

`:%s/{{{\(\d\) \(.*\)/\2 {{{\1/g`

它有效，但是在您的正则表达式中，我不明白为什么您在 s 之后得到 $ 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T22:49:38.583

您忘记转义括号，并且 POSIX 字符类仅在字符类中有效`[[:alpha:]]`：

```
:%s$/\({{{\d/\) /\(#[[:alpha:]]/\)$\2 \1$g 
```

但是请注意，您的示例文本不包含任何斜线 - 这是您的示例文本的实际样子吗？

上面的正则表达式改变了这个

```
/{{{8/ /#A/ 
```

对此

```
#A/ {{{8/ 
```

# asp.net - ASP.NET 搜索多个参数

> ID：799953
> 
> 赞同：0
> 
> 时间：2009-04-28T21:44:20.673
> 
> 标签：asp.net, subsonic

我正在尝试在 gridview 上显示搜索结果。我希望搜索显示姓氏和名字的结果。我正在使用带有 Subsonic 的 ASP.NET，但不知道如何修改下面的语句。我猜它在某个地方需要一个通配符？

```
Name: <asp:TextBox ID="txtSearchName" runat="server"></asp:TextBox> 

    GridView1.DataSource = new Select(PastAwardName.Schema.TableName + ".*", PastAwardType.Schema.TableName + ".*")
          .From(PastAwardName.Schema)
          .InnerJoin(PastAwardType.Schema.TableName, PastAwardType.Columns.VolID, PastAwardName.Schema.TableName, PastAwardName.Columns.VolID)
          .Where(PastAwardName.Columns.LName).IsEqualTo(this.txtSearchName.Text)
          .Or(PastAwardName.Columns.FName).IsEqualTo(this.txtSearchName.Text)
          .OrderAsc(PastAwardType.Columns.AwardYear)
          .ExecuteDataSet(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T00:46:11.407

我认为这应该有效。

您熟悉从该查询中获取生成的 SQL 吗？

```
SubSonic.SqlQuery q = new Select(PastAwardName.Schema.TableName + ".*", PastAwardType.Schema.TableName + ".*")
          .From(PastAwardName.Schema)
          .InnerJoin(PastAwardType.Schema.TableName, PastAwardType.Columns.VolID, PastAwardName.Schema.TableName, PastAwardName.Columns.VolID)
          .Where(PastAwardName.Columns.LName).IsEqualTo(this.txtSearchName.Text)
          .Or(PastAwardName.Columns.FName).IsEqualTo(this.txtSearchName.Text)
          .OrderAsc(PastAwardType.Columns.AwardYear);
string sql = q.BuildSqlStatement(); 
```

检查 sql 的值（在该行上有一个断点）以提供有关问题的进一步线索。

对于通配符 - 使用 ContainsString() 方法而不是像这样硬编码通配符：

```
.Where(PastAwardName.Columns.LName).ContainsString(this.txtSearchName.Text) 
```

这将自动将提供程序特定的通配符添加到参数的开头和结尾。您也可以执行 StartsWith() 和 EndsWith()。

# debugging - 查看 Haskell 中的缩减步骤

> ID：799956
> 
> 赞同：15
> 
> 时间：2009-04-28T21:45:13.683
> 
> 标签：debugging, haskell, functional-programming, reduction

有没有办法查看haskell 中的减少步骤，即跟踪所做的递归函数调用？例如，chez 方案为我们提供了 trace-lambda。Haskell 中是否有等价的形式？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T03:51:22.227

您可以尝试[`Debug.Trace.trace`](http://www.haskell.org/ghc/docs/latest/html/libraries/base/Debug-Trace.html#v%3Atrace)在要跟踪的位置插入，但这有（a）产生严重无序输出的趋势，因为您的跟踪语句可能属于直到远离原始位置才被评估的 thunk调用，以及 (b) 更改程序的运行时行为，如果跟踪需要评估本来不会被评估的事物（还）。

这是为了调试吗？如果是这样...

* * *

[Hat](http://www.haskell.org/hat/)修改你的源代码以输出跟踪，运行后可以查看。输出应该非常接近您想要的：他们主页上的示例是

> 例如，错误程序的计算
> 
> ```
> main = let xs :: [Int]
>            xs = [4*2,5 `div` 0,5+6]
>        in  print (head xs,last' xs)
> 
> last' (x:xs) = last' xs
> last' [x] = x 
> ```
> 
> 给出结果
> 
> ```
> (8, No match in pattern. 
> ```
> 
> Hat 查看工具可用于探索其行为，如下所示：
> 
> *   **帽子堆栈**
> 
> 对于中止的计算，即以错误消息终止或被中断的计算，帽子堆栈显示计算在哪个函数调用中被中止。它通过显示函数调用（redexes）的虚拟堆栈来实现。因此，堆栈上显示的每个函数调用都会导致其上方的函数调用。顶部堆栈元素的评估导致错误（或在其评估期间计算被中断）。显示的堆栈是虚拟的，因为它不对应于实际的运行时堆栈。实际的运行时堆栈启用惰性评估，而虚拟堆栈对应于将用于急切（严格）评估的堆栈。
> 
> 使用与上面相同的示例程序，帽子堆栈显示
> 
> ```
> $ hat-stack Example
> Program terminated with error:
>         No match in pattern.
> Virtual stack trace:
> (Last.hs:6)     last' []
> (Last.hs:6)     last' [_]
> (Last.hs:6)     last' [_,_]
> (Last.hs:4)     last' [8,_,_]
> (unknown)       main
> $ 
> ```

* * *

如今，GHCi (≥6.8.1) 还附带了一个调试器：

```
$ ghci -fbreak-on-exception
GHCi, version 6.10.1: http://www.haskell.org/ghc/  :? for help
Loading package ghc-prim ... linking ... done.
Loading package integer ... linking ... done.
Loading package base ... linking ... done.
Prelude> :l Example.hs
[1 of 1] Compiling Main             ( Example.hs, interpreted )

Example.hs:5:0:
    Warning: Pattern match(es) are overlapped
             In the definition of `last'': last' [x] = ...
Ok, modules loaded: Main.
*Main> :trace main
(8,Stopped at <exception thrown>
_exception :: e = _
[<exception thrown>] *Main> :back
Logged breakpoint at Example.hs:(5,0)-(6,12)
_result :: t
[-1: Example.hs:(5,0)-(6,12)] *Main> :hist
-1  : last' (Example.hs:(5,0)-(6,12))
-2  : last' (Example.hs:5:15-22)
-3  : last' (Example.hs:(5,0)-(6,12))
-4  : last' (Example.hs:5:15-22)
-5  : last' (Example.hs:(5,0)-(6,12))
-6  : last' (Example.hs:5:15-22)
-7  : last' (Example.hs:(5,0)-(6,12))
-8  : main (Example.hs:3:25-32)
-9  : main (Example.hs:2:17-19)
-10 : main (Example.hs:2:16-34)
-11 : main (Example.hs:3:17-23)
-12 : main (Example.hs:3:10-33)
<end of history>
[-1: Example.hs:(5,0)-(6,12)] *Main> :force _result
*** Exception: Example.hs:(5,0)-(6,12): Non-exhaustive patterns in function last'

[-1: Example.hs:(5,0)-(6,12)] *Main> :back
Logged breakpoint at Example.hs:5:15-22
_result :: t
xs :: [t]
[-2: Example.hs:5:15-22] *Main> :force xs
xs = [] 
```

虽然没有那么好，但它的好处是易于使用，并且无需重新编译代码即可使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T22:03:44.323

拥抱的次数会减少，如果这有帮助吗？或者，您是否可以使用像 hugs hood 之类的东西来包装您的代码，以获取更多关于它在每个步骤中所做的事情的详细信息？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T14:16:17.567

部分解决方案是使用[真空](http://www.youtube.com/watch?v=X4-212uMgy8)来可视化数据结构。

我看过一些折叠、扫描和其他的 gif 动画，但我现在找不到它们。我认为是 Cale Gibbard 制作了动画。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T02:20:21.523

Haskell 标准中没有内置任何此类内容。

我希望[Helium](http://www.cs.uu.nl/wiki/bin/view/Helium/Features)图形解释器能提供类似的东西，但网页没有提及这个话题。

# perl - Perl 的反引号、system 和 exec 有什么区别？

> ID：799968
> 
> 赞同：252
> 
> 时间：2009-04-28T21:47:53.957
> 
> 标签：perl

有人可以帮帮我吗？在 Perl 中，有什么区别：

```
exec "command"; 
```

和

```
system("command"); 
```

和

```
print `command`; 
```

还有其他方法可以运行 shell 命令吗？

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2009-04-28T22:07:40.867

## **执行**

执行命令并且*永不返回*。这就像`return`函数中的语句。

如果找不到该命令，则`exec`返回 false。它永远不会返回 true，因为如果找到该命令，它就永远不会返回。`STDOUT`命令的返回或`STDERR`退出状态也没有意义。您可以在 中找到有关它的文档 [**`perlfunc`**](http://perldoc.perl.org/functions/exec.html)，因为它是一个函数。

## **系统**

执行命令，并且在命令完成后继续执行您的 Perl 脚本。

返回值是命令的退出状态。您可以在 中找到有关它的文档 [**`perlfunc`**](http://perldoc.perl.org/functions/system.html)。

## **反引号**

like`system`执行命令，并且在命令完成后继续执行您的 perl 脚本。

**`system`**与返回值相反的是`STDOUT`命令。 `qx//`相当于反引号。您可以在 中找到有关它的文档[**`perlop`**](http://perldoc.perl.org/perlop.html#Quote-Like-Operators)，因为与它不同的是`system`，`exec`它是一个运算符。

* * *

## **其他方法**

上面缺少的是一种异步执行命令的方法。这意味着您的 perl 脚本和您的命令同时运行。这可以通过[**`open`**](http://perldoc.perl.org/functions/open.html). 它允许您读取`STDOUT`/`STDERR`写入`STDIN`您的命令。虽然它依赖于平台。

还有几个模块可以简化此任务。有`IPC::Open2`和`IPC::Open3`，`IPC::Run`就像 `Win32::Process::Create`你在窗户上一样。

* * *

## 回答 #2

> 赞同：173
> 
> 时间：2009-04-28T22:32:44.410

一般来说，我使用`system`, `open`,`IPC::Open2`或`IPC::Open3`取决于我想要做什么。操作员虽然简单，但`qx//`其功能过于受限，无法在快速破解之外非常有用。我发现`open`要方便得多。

## [`system`](http://perldoc.perl.org/functions/system.html): 运行命令并等待它返回

`system`当您想要运行命令、不关心其输出并且不希望 Perl 脚本在命令完成之前执行任何操作时使用。

```
#doesn't spawn a shell, arguments are passed as they are
system("command", "arg1", "arg2", "arg3"); 
```

或者

```
#spawns a shell, arguments are interpreted by the shell, use only if you
#want the shell to do globbing (e.g. *.txt) for you or you want to redirect
#output
system("command arg1 arg2 arg3"); 
```

## [`qx//`或 ``](http://perldoc.perl.org/perlop.html#qx/STRING/)：运行命令并捕获其 STDOUT

`qx//`当您要运行命令、捕获它写入 STDOUT 的内容，并且不希望 Perl 脚本在命令完成之前执行任何操作时使用。

```
#arguments are always processed by the shell

#in list context it returns the output as a list of lines
my @lines = qx/command arg1 arg2 arg3/;

#in scalar context it returns the output as one string
my $output = qx/command arg1 arg2 arg3/; 
```

## [`exec`](http://perldoc.perl.org/functions/exec.html)：用另一个进程替换当前进程。

当你想运行一个命令，不关心它的输出，也不想等待它返回时 使用`exec`with 。真的只是[`fork`](http://perldoc.perl.org/functions/fork.html)`system`

```
sub my_system {
    die "could not fork\n" unless defined(my $pid = fork);
    return waitpid $pid, 0 if $pid; #parent waits for child
    exec @_; #replace child with new process
} 
```

您可能还想阅读[`waitpid`](http://perldoc.perl.org/functions/waitpid.html)和[`perlipc`](http://perldoc.perl.org/perlipc.html)手册。

## [`open`](http://perldoc.perl.org/functions/open.html): 运行一个进程并创建一个到它的 STDIN 或 STDERR 的管道

当您想要将`open`数据写入进程的 STDIN 或从进程的 STDOUT 读取数据（但不能同时）时使用。

```
#read from a gzip file as if it were a normal file
open my $read_fh, "-|", "gzip", "-d", $filename
    or die "could not open $filename: $!";

#write to a gzip compressed file as if were a normal file
open my $write_fh, "|-", "gzip", $filename
    or die "could not open $filename: $!"; 
```

## [IPC::Open2](http://perldoc.perl.org/IPC/Open2.html)：运行一个进程并创建一个到 STDIN 和 STDOUT 的管道

`IPC::Open2`当您需要读取和写入进程的 STDIN 和 STDOUT 时使用。

```
use IPC::Open2;

open2 my $out, my $in, "/usr/bin/bc"
    or die "could not run bc";

print $in "5+6\n";

my $answer = <$out>; 
```

## [IPC::Open3](http://perldoc.perl.org/IPC/Open3.html)：运行一个进程并创建一个到 STDIN、STDOUT 和 STDERR 的管道

`IPC::Open3`当您需要捕获进程的所有三个标准文件句柄时使用。我会写一个例子，但它的工作方式与 IPC::Open2 的工作方式基本相同，但参数和第三个文件句柄的顺序略有不同。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-28T22:01:34.190

### 让我先引用手册：

[perldoc exec()](http://perldoc.perl.org/functions/exec.html)：

> exec 函数执行一个系统命令并且**从不返回**——如果你希望它返回，使用*system*而不是*exec*

[perldoc 系统（）](http://perldoc.perl.org/functions/system.html)：

> 执行与 exec LIST 完全相同的操作，只是先**完成一个 fork**，然后父进程等待子进程完成。

与*exec*和*system*相比，反引号不给你返回值，而是给你收集的 STDOUT。

[perldoc`字符串`](http://perldoc.perl.org/perlop.html#%60STRING%60)：

> 一个字符串，它（可能）被插值，然后作为系统命令使用*/bin/sh*或其等效命令执行。将接受 Shell 通配符、管道和重定向。返回收集到**的命令标准输出**；标准误差不受影响。

* * *

## 备择方案：

在更复杂的场景中，您想要获取 STDOUT、STDERR 或返回码，您可以使用众所周知的标准模块，如[IPC::Open2](http://perldoc.perl.org/IPC/Open2.html)和[IPC::Open3](http://perldoc.perl.org/IPC/Open3.html)。

例子：

```
use IPC::Open2;
my $pid = open2(\*CHLD_OUT, \*CHLD_IN, 'some', 'cmd', 'and', 'args');
waitpid( $pid, 0 );
my $child_exit_status = $? >> 8; 
```

最后，[IPC::Run](http://search.cpan.org/dist/IPC::Run/) from the CPAN 也值得一看……</p>

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2016-06-04T11:12:48.863

```Perl 的反引号 ( ) `system`、 和有什么区别`exec`？

```
exec -> exec "command"; ,
system -> system("command"); and 
backticks -> print `command`; 
```

## `exec`

`exec`执行命令并且从不恢复 Perl 脚本。它之于脚本就像`return`语句之于函数一样。

如果未找到该命令，则`exec`返回 false。它永远不会返回 true，因为如果找到该命令，它就永远不会返回。`STDOUT`命令的返回或`STDERR`退出状态也没有意义。**您可以在perlfunc**中找到有关它的文档，因为它是一个函数。

例如：

```
#!/usr/bin/perl
print "Need to start exec command";
my $data2 = exec('ls');
print "Now END exec command";
print "Hello $data2\n\n"; 
```

在上面的代码中，有三个`print`语句，但是由于`exec`离开了脚本，只执行了第一个打印语句。此外，`exec`命令输出未分配给任何变量。

在这里，只有您只获得第一条`print`语句的输出并在标准输出上执行`ls`命令。

### `system`

`system`执行命令并在命令完成后恢复您的 Perl 脚本。返回值是命令的退出状态。**您可以在perlfunc**中找到有关它的文档。

例如：

```
#!/usr/bin/perl
print "Need to start system command";
my $data2 = system('ls');
print "Now END system command";
print "Hello $data2\n\n"; 
```

在上面的代码中，有三个`print`语句。由于脚本在`system`命令后恢复，所有三个打印语句都被执行。

此外，运行的结果`system` *被*分配给`data2`，但分配的值是`0`（来自 的退出代码`ls`）。

在这里，您将获得第一个`print`语句的输出，然后是`ls`命令的输出，然后是标准输出的最后两个`print`语句的输出。

### 反引号 ( ```)

就像`system`，将命令括在反引号中会执行该命令，并且在命令完成后恢复您的 Perl 脚本。与 相比`system`，返回值是`STDOUT`命令的。`qx//`相当于反引号。**您可以在perlop**中找到有关它的文档，因为与 system and 不同`exec`，它是一个运算符。

例如：

```
#!/usr/bin/perl
print "Need to start backticks command";
my $data2 = `ls`;
print "Now END system command";
print "Hello $data2\n\n"; 
```

In above code, there are three `print` statements and all three are being executed. The output of `ls` is not going to standard out directly, but assigned to the variable `data2` and then printed by the final print statement.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-28T22:01:48.340

'exec' 和 'system' 之间的区别在于 exec 用 'command' 替换您当前的程序，并且永远不会返回您的程序。另一方面，系统派生并运行“命令”，并在完成运行时返回“命令”的退出状态。反勾号运行“命令”，然后返回一个表示其标准输出的字符串（无论它会打印到屏幕上的什么）

您还可以使用 popen 运行 shell 命令，我认为有一个 shell 模块 - 'use shell' 可以让您透明地访问典型的 shell 命令。

希望能为您澄清。

# editor - 样机编辑器 - 轻松添加箭头、标注等的免费工具

> ID：799971
> 
> 赞同：5
> 
> 时间：2009-04-28T21:48:25.813
> 
> 标签：editor, screenshot, mockups

我一直在使用[Balsamiq](http://balsamiq.com/demos/mockups/Mockups.html)创建模型。我正在使用试用版，所以我将所有屏幕都放在一个模型中，而不是多个文件。我想将这些模型的导出发送给我的团队，以便他们对它们进行评论。他们需要能够轻松地添加箭头、标注、文本等。我​​知道您可以在 Balsamiq 中完成其中的一些操作，但它并不是为这些类型的注释而设计的。我使用了 Paint.net 并将它们添加到单独的层中，但对于某些非技术人员来说，它并不是最容易使用的应用程序。我喜欢[Snagit](http://www.techsmith.com/screen-capture.asp)中的编辑器，因为它可以轻松标记图像，但这是一个付费应用程序，我正在寻找一个免费工具（在 Windows 上运行）。

此工具不一定需要屏幕截图捕获工具，因为有[很多可用选项](https://stackoverflow.com/questions/26183/screenshot-taking-tools)，但这并不排除工具。

我希望能够轻松做到的事情是：

*   添加箭头以显示单击哪个按钮以从一个屏幕移动到另一个屏幕
*   添加标注文本以提供改写部分或移动项目的建议
*   使用不同颜色/尺寸的标记项目

我找到了[Pencil](http://www.evolus.vn/Pencil/)，但这似乎有点矫枉过正——我不需要完整的图像编辑，只需要某人快速轻松地提供反馈的能力。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T08:21:54.517

也许你可以试试[ForeUI](http://www.foreui.com)，如果你喜欢，请给我发邮件到 vivi[at]foreui.com，我可以免费给你发许可证 :-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T21:54:54.423

不是免费的，但如果您已经安装了带有 OneNote 的 MS Office，那么它非常适合像这种恕我直言的东西。我认为像往常一样有一个免费的阅读器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T22:08:51.847

如果您真的想要快速简单的反馈，请使用笔和纸。

打印屏幕并将它们分发给团队中需要在 UI 中发表意见的人。让他们随心所欲地标记并将它们交还给您。我知道这让我听起来像个勒德分子，但这确实是最有效的方法。

# javascript - $(document).ready 没有 jQuery 的等价物

> ID：799981
> 
> 赞同：2267
> 
> 时间：2009-04-28T21:51:11.640
> 
> 标签：javascript, jquery, pageload

我有一个使用 的脚本`$(document).ready`，但它不使用 jQuery 中的任何其他内容。我想通过删除 jQuery 依赖项来减轻它。

如何在`$(document).ready`不使用 jQuery 的情况下实现自己的功能？我知道使用`window.onload`会不一样，因为`window.onload`在加载所有图像、帧等之后会触发。

* * *

## 回答 #1

> 赞同：1702
> 
> 时间：2009-04-28T21:59:53.337

有一个基于标准的替换，`DOMContentLoaded`超过[99% 的浏览器](http://caniuse.com/#search=DOMContentLoaded)都支持，但 IE8 不支持：

```
document.addEventListener("DOMContentLoaded", function(event) { 
  //do work
}); 
```

jQuery 的原生函数比 window.onload 复杂得多，如下图所示。

```
function bindReady(){
    if ( readyBound ) return;
    readyBound = true;

    // Mozilla, Opera and webkit nightlies currently support this event
    if ( document.addEventListener ) {
        // Use the handy event callback
        document.addEventListener( "DOMContentLoaded", function(){
            document.removeEventListener( "DOMContentLoaded", arguments.callee, false );
            jQuery.ready();
        }, false );

    // If IE event model is used
    } else if ( document.attachEvent ) {
        // ensure firing before onload,
        // maybe late but safe also for iframes
        document.attachEvent("onreadystatechange", function(){
            if ( document.readyState === "complete" ) {
                document.detachEvent( "onreadystatechange", arguments.callee );
                jQuery.ready();
            }
        });

        // If IE and not an iframe
        // continually check to see if the document is ready
        if ( document.documentElement.doScroll && window == window.top ) (function(){
            if ( jQuery.isReady ) return;

            try {
                // If IE is used, use the trick by Diego Perini
                // http://javascript.nwbox.com/IEContentLoaded/
                document.documentElement.doScroll("left");
            } catch( error ) {
                setTimeout( arguments.callee, 0 );
                return;
            }

            // and execute any waiting functions
            jQuery.ready();
        })();
    }

    // A fallback to window.onload, that will always work
    jQuery.event.add( window, "load", jQuery.ready );
} 
```

* * *

## 回答 #2

> 赞同：368
> 
> 时间：2011-08-13T20:52:06.120

编辑：

## 这是 jQuery 就绪的可行替代品

```
function ready(callback){
    // in case the document is already rendered
    if (document.readyState!='loading') callback();
    // modern browsers
    else if (document.addEventListener) document.addEventListener('DOMContentLoaded', callback);
    // IE <= 8
    else document.attachEvent('onreadystatechange', function(){
        if (document.readyState=='complete') callback();
    });
}

ready(function(){
    // do something
}); 
```

取自 [https://plainjs.com/javascript/events/running-code-when-the-document-is-ready-15/](https://plainjs.com/javascript/events/running-code-when-the-document-is-ready-15/)

[另一个很好的 domReady 函数](https://github.com/jfriend00/docReady)取自[https://stackoverflow.com/a/9899701/175071](https://stackoverflow.com/a/9899701/175071)

* * *

由于接受的答案远未完成，我将`jQuery.ready()`基于 jQuery 1.6.2 源代码的“就绪”函数拼接在一起：

```
var ready = (function(){

    var readyList,
        DOMContentLoaded,
        class2type = {};
        class2type["[object Boolean]"] = "boolean";
        class2type["[object Number]"] = "number";
        class2type["[object String]"] = "string";
        class2type["[object Function]"] = "function";
        class2type["[object Array]"] = "array";
        class2type["[object Date]"] = "date";
        class2type["[object RegExp]"] = "regexp";
        class2type["[object Object]"] = "object";

    var ReadyObj = {
        // Is the DOM ready to be used? Set to true once it occurs.
        isReady: false,
        // A counter to track how many items to wait for before
        // the ready event fires. See #6781
        readyWait: 1,
        // Hold (or release) the ready event
        holdReady: function( hold ) {
            if ( hold ) {
                ReadyObj.readyWait++;
            } else {
                ReadyObj.ready( true );
            }
        },
        // Handle when the DOM is ready
        ready: function( wait ) {
            // Either a released hold or an DOMready/load event and not yet ready
            if ( (wait === true && !--ReadyObj.readyWait) || (wait !== true && !ReadyObj.isReady) ) {
                // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
                if ( !document.body ) {
                    return setTimeout( ReadyObj.ready, 1 );
                }

                // Remember that the DOM is ready
                ReadyObj.isReady = true;
                // If a normal DOM Ready event fired, decrement, and wait if need be
                if ( wait !== true && --ReadyObj.readyWait > 0 ) {
                    return;
                }
                // If there are functions bound, to execute
                readyList.resolveWith( document, [ ReadyObj ] );

                // Trigger any bound ready events
                //if ( ReadyObj.fn.trigger ) {
                //    ReadyObj( document ).trigger( "ready" ).unbind( "ready" );
                //}
            }
        },
        bindReady: function() {
            if ( readyList ) {
                return;
            }
            readyList = ReadyObj._Deferred();

            // Catch cases where $(document).ready() is called after the
            // browser event has already occurred.
            if ( document.readyState === "complete" ) {
                // Handle it asynchronously to allow scripts the opportunity to delay ready
                return setTimeout( ReadyObj.ready, 1 );
            }

            // Mozilla, Opera and webkit nightlies currently support this event
            if ( document.addEventListener ) {
                // Use the handy event callback
                document.addEventListener( "DOMContentLoaded", DOMContentLoaded, false );
                // A fallback to window.onload, that will always work
                window.addEventListener( "load", ReadyObj.ready, false );

            // If IE event model is used
            } else if ( document.attachEvent ) {
                // ensure firing before onload,
                // maybe late but safe also for iframes
                document.attachEvent( "onreadystatechange", DOMContentLoaded );

                // A fallback to window.onload, that will always work
                window.attachEvent( "onload", ReadyObj.ready );

                // If IE and not a frame
                // continually check to see if the document is ready
                var toplevel = false;

                try {
                    toplevel = window.frameElement == null;
                } catch(e) {}

                if ( document.documentElement.doScroll && toplevel ) {
                    doScrollCheck();
                }
            }
        },
        _Deferred: function() {
            var // callbacks list
                callbacks = [],
                // stored [ context , args ]
                fired,
                // to avoid firing when already doing so
                firing,
                // flag to know if the deferred has been cancelled
                cancelled,
                // the deferred itself
                deferred  = {

                    // done( f1, f2, ...)
                    done: function() {
                        if ( !cancelled ) {
                            var args = arguments,
                                i,
                                length,
                                elem,
                                type,
                                _fired;
                            if ( fired ) {
                                _fired = fired;
                                fired = 0;
                            }
                            for ( i = 0, length = args.length; i < length; i++ ) {
                                elem = args[ i ];
                                type = ReadyObj.type( elem );
                                if ( type === "array" ) {
                                    deferred.done.apply( deferred, elem );
                                } else if ( type === "function" ) {
                                    callbacks.push( elem );
                                }
                            }
                            if ( _fired ) {
                                deferred.resolveWith( _fired[ 0 ], _fired[ 1 ] );
                            }
                        }
                        return this;
                    },

                    // resolve with given context and args
                    resolveWith: function( context, args ) {
                        if ( !cancelled && !fired && !firing ) {
                            // make sure args are available (#8421)
                            args = args || [];
                            firing = 1;
                            try {
                                while( callbacks[ 0 ] ) {
                                    callbacks.shift().apply( context, args );//shifts a callback, and applies it to document
                                }
                            }
                            finally {
                                fired = [ context, args ];
                                firing = 0;
                            }
                        }
                        return this;
                    },

                    // resolve with this as context and given arguments
                    resolve: function() {
                        deferred.resolveWith( this, arguments );
                        return this;
                    },

                    // Has this deferred been resolved?
                    isResolved: function() {
                        return !!( firing || fired );
                    },

                    // Cancel
                    cancel: function() {
                        cancelled = 1;
                        callbacks = [];
                        return this;
                    }
                };

            return deferred;
        },
        type: function( obj ) {
            return obj == null ?
                String( obj ) :
                class2type[ Object.prototype.toString.call(obj) ] || "object";
        }
    }
    // The DOM ready check for Internet Explorer
    function doScrollCheck() {
        if ( ReadyObj.isReady ) {
            return;
        }

        try {
            // If IE is used, use the trick by Diego Perini
            // http://javascript.nwbox.com/IEContentLoaded/
            document.documentElement.doScroll("left");
        } catch(e) {
            setTimeout( doScrollCheck, 1 );
            return;
        }

        // and execute any waiting functions
        ReadyObj.ready();
    }
    // Cleanup functions for the document ready method
    if ( document.addEventListener ) {
        DOMContentLoaded = function() {
            document.removeEventListener( "DOMContentLoaded", DOMContentLoaded, false );
            ReadyObj.ready();
        };

    } else if ( document.attachEvent ) {
        DOMContentLoaded = function() {
            // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
            if ( document.readyState === "complete" ) {
                document.detachEvent( "onreadystatechange", DOMContentLoaded );
                ReadyObj.ready();
            }
        };
    }
    function ready( fn ) {
        // Attach the listeners
        ReadyObj.bindReady();

        var type = ReadyObj.type( fn );

        // Add the callback
        readyList.done( fn );//readyList is result of _Deferred()
    }
    return ready;
})(); 
```

如何使用：

```
<script>
    ready(function(){
        alert('It works!');
    });
    ready(function(){
        alert('Also works!');
    });
</script> 
```

我不确定这段代码的功能如何，但它在我的表面测试中运行良好。这花了相当长的时间，所以我希望你和其他人可以从中受益。

PS.：我建议[编译](http://closure-compiler.appspot.com/home)它。

或者您可以使用[http://dustindiaz.com/smallest-domready-ever](http://dustindiaz.com/smallest-domready-ever)：

```
function r(f){/in/.test(document.readyState)?setTimeout(r,9,f):f()}
r(function(){/*code to run*/}); 
```

或者原生函数，如果你只需要支持新的浏览器（与 jQuery 不同，如果你在页面加载后添加它，这将不会运行）

```
document.addEventListener('DOMContentLoaded',function(){/*fun code to run*/}) 
```

* * *

## 回答 #3

> 赞同：216
> 
> 时间：2013-09-12T22:33:04.597

三个选项：

1.  如果`script`是正文的最后一个标签，则 DOM 将在脚本标签执行之前准备好
2.  当 DOM 准备就绪时，“readyState”将变为“完成”
3.  将所有内容放在“DOMContentLoaded”事件侦听器下

***onreadystatechange***

```
 document.onreadystatechange = function () {
     if (document.readyState == "complete") {
     // document is ready. Do your stuff here
   }
 } 
```

来源：[MDN](https://developer.mozilla.org/en-US/docs/Web/API/document.readyState)

***DOMContentLoaded***

```
document.addEventListener('DOMContentLoaded', function() {
   console.log('document is ready. I can sleep now');
}); 
```

***关注石器时代浏览器：*** 前往jQuery源码并使用该`ready`功能。在这种情况下，您不会解析+执行整个库，而您正在做的只是其中的一小部分。

* * *

## 回答 #4

> 赞同：93
> 
> 时间：2009-12-07T16:46:49.640

把你的`<script>/*JavaScript code*/</script>`权利**放在结束** `</body>`标签之前。

诚然，这可能不适合每个人的目的，因为它需要更改 HTML 文件，而不仅仅是在 JavaScript 文件中做一些事情`document.ready`，但仍然......

* * *

## 回答 #5

> 赞同：69
> 
> 时间：2012-08-04T18:13:42.553

穷人的解决方法：

```
var checkLoad = function() {   
    document.readyState !== "complete" ? setTimeout(checkLoad, 11) : alert("loaded!");   
};  

checkLoad(); 
```

[查看小提琴](http://jsfiddle.net/squadjot/s4EzY/)

添加了这个，我猜更好一点，自己的范围，并且非递归

```
(function(){
    var tId = setInterval(function() {
        if (document.readyState == "complete") onComplete()
    }, 11);
    function onComplete(){
        clearInterval(tId);    
        alert("loaded!");    
    };
})() 
```

[查看小提琴](http://jsfiddle.net/squadjot/XD7ZF/)

* * *

## 回答 #6

> 赞同：39
> 
> 时间：2013-12-23T19:14:32.707

我用这个：

```
document.addEventListener("DOMContentLoaded", function(event) { 
    //Do work
}); 
```

注意：这可能只适用于较新的浏览器，尤其是这些：[http ://caniuse.com/#feat=domcontentloaded](http://caniuse.com/#feat=domcontentloaded)

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2014-11-07T07:45:18.243

真的，如果您只关心**[Internet Explorer 9+](http://en.wikipedia.org/wiki/Internet_Explorer_9)**，则此代码足以替换`jQuery.ready`：

```
 document.addEventListener("DOMContentLoaded", callback); 
```

* * *

如果您担心[Internet Explorer 6](http://en.wikipedia.org/wiki/Internet_Explorer_6)和一些非常奇怪和罕见的浏览器，这将起作用：

```
domReady: function (callback) {
    // Mozilla, Opera and WebKit
    if (document.addEventListener) {
        document.addEventListener("DOMContentLoaded", callback, false);
        // If Internet Explorer, the event model is used
    } else if (document.attachEvent) {
        document.attachEvent("onreadystatechange", function() {
            if (document.readyState === "complete" ) {
                callback();
            }
        });
        // A fallback to window.onload, that will always work
    } else {
        var oldOnload = window.onload;
        window.onload = function () {
            oldOnload && oldOnload();
            callback();
        }
    }
}, 
```

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2020-01-23T22:30:11.413

现在是 2020 年，`<script>`标签具有`defer`属性。

例如：

```
<script src="demo_defer.js" defer></script> 
```

它指定当页面完成解析时执行脚本。

[https://www.w3schools.com/tags/att_script_defer.asp](https://www.w3schools.com/tags/att_script_defer.asp)

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2015-02-16T14:15:41.920

这个问题很久以前就被问过了。对于刚刚看到这个问题的任何人，现在有一个名为[“您可能不需要 jquery”](http://youmightnotneedjquery.com/)的站点 ，它分解了 - 按所需的 IE 支持级别 - jquery 的所有功能，并提供了一些替代的、更小的库。

根据[您的 IE8 文档准备脚本可能不需要 jquery](http://youmightnotneedjquery.com/)

```
function ready(fn) {
    if (document.readyState != 'loading')
        fn();
    else if (document.addEventListener)
        document.addEventListener('DOMContentLoaded', fn);
    else
        document.attachEvent('onreadystatechange', function() {
            if (document.readyState != 'loading')
                fn();
        });
} 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2010-09-22T01:29:38.827

我最近将其用于移动网站。这是 John Resig 的“Pro JavaScript Techniques”的简化版本。这取决于 addEvent。

```
var ready = ( function () {
  function ready( f ) {
    if( ready.done ) return f();

    if( ready.timer ) {
      ready.ready.push(f);
    } else {
      addEvent( window, "load", isDOMReady );
      ready.ready = [ f ];
      ready.timer = setInterval(isDOMReady, 13);
    }
  };

  function isDOMReady() {
    if( ready.done ) return false;

    if( document && document.getElementsByTagName && document.getElementById && document.body ) {
      clearInterval( ready.timer );
      ready.timer = null;
      for( var i = 0; i < ready.ready.length; i++ ) {
        ready.ready[i]();
      }
      ready.ready = null;
      ready.done = true;
    }
  }

  return ready;
})(); 
```

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2013-11-18T21:58:51.913

跨浏览器（旧浏览器也是）和一个简单的解决方案：

```
var docLoaded = setInterval(function () {
    if(document.readyState !== "complete") return;
    clearInterval(docLoaded);

    /*
        Your code goes here i.e. init()
    */
}, 30); 
```

[在 jsfiddle 中显示警报](https://jsfiddle.net/z6Lq6oxg/)

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2012-09-05T16:56:58.027

jQuery 答案对我非常有用。通过一点重构，它很好地满足了我的需求。我希望它可以帮助其他人。

```
function onReady ( callback ){
    var addListener = document.addEventListener || document.attachEvent,
        removeListener =  document.removeEventListener || document.detachEvent
        eventName = document.addEventListener ? "DOMContentLoaded" : "onreadystatechange"

    addListener.call(document, eventName, function(){
        removeListener( eventName, arguments.callee, false )
        callback()
    }, false )
} 
```

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2015-05-22T06:20:16.767

这是**测试 DOM 就绪的最小代码片段，**它适用于所有浏览器（甚至 IE 8）：

```
r(function(){
    alert('DOM Ready!');
});
function r(f){/in/.test(document.readyState)?setTimeout('r('+f+')',9):f()} 
```

看到这个[答案](https://stackoverflow.com/questions/9899372/pure-javascript-equivalent-to-jquerys-ready-how-to-call-a-function-when-the/30319853#30319853)。

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2013-02-23T11:51:26.570

只需将其添加到 HTML 页面的底部...

```
<script>
    Your_Function();
</script> 
```

因为，HTML 文档是由 top-bottom 解析的。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2011-09-28T11:13:41.863

*[Rock Solid addEvent()](http://www.dustindiaz.com/rock-solid-addevent/)*和[http://www.braksator.com/how-to-make-your-own-jquery](http://www.braksator.com/how-to-make-your-own-jquery)值得一看。

这是网站出现故障时的代码

```
function addEvent(obj, type, fn) {
    if (obj.addEventListener) {
        obj.addEventListener(type, fn, false);
        EventCache.add(obj, type, fn);
    }
    else if (obj.attachEvent) {
        obj["e"+type+fn] = fn;
        obj[type+fn] = function() { obj["e"+type+fn]( window.event ); }
        obj.attachEvent( "on"+type, obj[type+fn] );
        EventCache.add(obj, type, fn);
    }
    else {
        obj["on"+type] = obj["e"+type+fn];
    }
}

var EventCache = function(){
    var listEvents = [];
    return {
        listEvents : listEvents,
        add : function(node, sEventName, fHandler){
            listEvents.push(arguments);
        },
        flush : function(){
            var i, item;
            for(i = listEvents.length - 1; i >= 0; i = i - 1){
                item = listEvents[i];
                if(item[0].removeEventListener){
                    item[0].removeEventListener(item[1], item[2], item[3]);
                };
                if(item[1].substring(0, 2) != "on"){
                    item[1] = "on" + item[1];
                };
                if(item[0].detachEvent){
                    item[0].detachEvent(item[1], item[2]);
                };
                item[0][item[1]] = null;
            };
        }
    };
}();

// Usage
addEvent(window, 'unload', EventCache.flush);
addEvent(window, 'load', function(){alert("I'm ready");}); 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2019-09-30T06:41:57.457

# 最小和 100% 工作

我从[PlainJS](https://plainjs.com/javascript/events/running-code-when-the-document-is-ready-15/)中选择了答案，它对我来说很好用。它进行了扩展`DOMContentLoaded`，以便可以在所有浏览器中接受。

* * *

这个函数相当于 jQuery 的`$(document).ready()`方法：

```
document.addEventListener('DOMContentLoaded', function(){
    // do something
}); 
```

然而，与 jQuery 相比，此代码只能在现代浏览器（IE > 8）中正常运行，并且在插入此脚本时文档已经呈现（例如通过 Ajax）的情况下将无法正常运行。因此，我们需要稍微扩展一下：

```
function run() {
    // do something
}

// in case the document is already rendered
if (document.readyState!='loading') run();
// modern browsers
else if (document.addEventListener) 
document.addEventListener('DOMContentLoaded', run);
// IE <= 8
else document.attachEvent('onreadystatechange', function(){
    if (document.readyState=='complete') run();
}); 
```

这基本上涵盖了所有可能性，并且是 jQuery 助手的可行替代品。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2014-12-27T16:52:42.120

一旦 DOM 准备好，此跨浏览器代码将调用一个函数：

```
var domReady=function(func){
    var scriptText='('+func+')();';
    var scriptElement=document.createElement('script');
    scriptElement.innerText=scriptText;
    document.body.appendChild(scriptElement);
}; 
```

以下是它的工作原理：

1.  第一行`domReady`调用函数的[`toString`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/toString)方法以获取您传入的函数的字符串表示形式，并将其包装在立即调用该函数的表达式中。
2.  其余部分`domReady`使用表达式创建一个脚本元素并将其附加到`body`文档中。
3.  `body`浏览器在 DOM 准备好后运行附加的脚本标签。

例如，如果您这样做: `domReady(function(){alert();});`，则以下内容将附加到`body`元素：

```
 <script>(function (){alert();})();</script> 
```

请注意，这仅适用于用户定义的函数。以下将不起作用：`domReady(alert);`

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2016-02-26T18:38:27.187

与 jQuery 相比，使用 JavaScript 等价物总是好的。一个原因是依赖的库少了一个，而且它们比 jQuery 等价物快得多。

jQuery 等价物的一个很好的参考是[http://youmightnotneedjquery.com/](http://youmightnotneedjquery.com/)。

就您的问题而言，我从上面的链接中获取了以下代码 :) 唯一需要注意的是它仅适用于[Internet Explorer 9](http://en.wikipedia.org/wiki/Internet_Explorer_9)及更高版本。

```
function ready(fn) {
    if (document.readyState != 'loading') {
        fn();
    }
    else {
        document.addEventListener('DOMContentLoaded', fn);
    }
} 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2012-08-17T07:33:55.160

这个解决方案怎么样？

```
// other onload attached earlier
window.onload=function() {
   alert('test');
};

tmpPreviousFunction=window.onload ? window.onload : null;

// our onload function
window.onload=function() {
   alert('another message');

   // execute previous one
   if (tmpPreviousFunction) tmpPreviousFunction();
}; 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2014-07-29T13:08:04.533

我们发现了我们的一个快速而简单的跨浏览器实现，它可以用最少的实现来解决大多数简单的情况：

```
window.onReady = function onReady(fn){
    document.body ? fn() : setTimeout(function(){ onReady(fn);},50);
}; 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2020-08-20T20:38:17.610

# 比较

这里（在下面的片段中）是选择的可用浏览器“内置”方法及其执行顺序的比较。评论

*   任何现代`document.onload`浏览器都不支持 (X) （从不[触发](https://stackoverflow.com/q/5135638/860099)事件）
*   如果您`<body onload="bodyOnLoad()">`同时使用 (F) 和`window.onload`(E)，那么只会执行第一个（因为它会覆盖第二个）
*   (F) 中给出的事件处理程序`<body onload="...">`由附加`onload`函数包装
*   `document.onreadystatechange`(D) 不覆盖`document .addEventListener('readystatechange'...)`(C) 可能 cecasue`onXYZevent-like`方法独立于`addEventListener`队列（允许添加多个侦听器）。执行这两个处理程序之间可能没有任何反应。
*   所有脚本都在控制台中写入其时间戳 - 但也`div`可以在正文中写入其时间戳的脚本（在脚本执行后单击“整页”链接以查看它）。
*   解决方案`readystatechange`（C，D）由浏览器多次执行，但针对不同的文档状态：
*   *loading* - 文档正在加载（没有在代码段中触发）
*   *交互式*- 文档被解析，之前触发`DOMContentLoaded`
*   *完成*- 文档和资源已加载，之前触发`body/window onload`

```
<html>

<head>
  <script>
    // solution A
    console.log(`[timestamp: ${Date.now()}] A: Head script`) ;

    // solution B
    document.addEventListener("DOMContentLoaded", () => {
      print(`[timestamp: ${Date.now()}] B: DOMContentLoaded`);
    });

    // solution C
    document.addEventListener('readystatechange', () => {
      print(`[timestamp: ${Date.now()}] C: ReadyState: ${document.readyState}`);
    });

    // solution D
    document.onreadystatechange = s=> {print(`[timestamp: ${Date.now()}] D: document.onreadystatechange ReadyState: ${document.readyState}`)};

    // solution E (never executed)
    window.onload = () => {
      print(`E: <body onload="..."> override this handler`);
    };

    // solution F
    function bodyOnLoad() {
      print(`[timestamp: ${Date.now()}] F: <body onload='...'>`);      
      infoAboutOnLoad(); // additional info
    }

    // solution X
    document.onload = () => {print(`document.onload is never fired`)};

    // HELPERS

    function print(txt) { 
      console.log(txt);
      if(mydiv) mydiv.innerHTML += txt.replace('<','&lt;').replace('>','&gt;') + '<br>';
    }

    function infoAboutOnLoad() {
      console.log("window.onload (after  override):", (''+document.body.onload).replace(/\s+/g,' '));
      console.log(`body.onload==window.onload --> ${document.body.onload==window.onload}`);
    }

    console.log("window.onload (before override):", (''+document.body.onload).replace(/\s+/g,' '));

  </script>
</head>

<body onload="bodyOnLoad()">
  <div id="mydiv"></div>

  <!-- this script must te at the bottom of <body> -->
  <script>
    // solution G
    print(`[timestamp: ${Date.now()}] G: <body> bottom script`);
  </script>
</body>

</html>
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2021-12-16T20:39:29.940

# 2022版

在 2022 年，你需要做的就是把 defer 属性放在你的脚本上，然后加载到 head 中！

参考：[https ://developer.mozilla.org/en-US/docs/Web/HTML/Element/script#attr-defer](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script#attr-defer)

```
<!doctype html>
<html>
<head>
  <script src="/script.js" defer></script>
</head>
<body>

 </p>In 2022, all you need to do is put the defer attribute on your script, and load it in the head!</p>

</body>
</html> 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2017-10-22T05:59:46.387

如果您不必支持非常旧的浏览器，即使您的外部脚本加载了*异步*属性，也可以使用以下方法：

```
HTMLDocument.prototype.ready = new Promise(function(resolve) {
   if(document.readyState != "loading")
      resolve();
   else
      document.addEventListener("DOMContentLoaded", function() {
         resolve();
      });
});

document.ready.then(function() {
   console.log("document.ready");
}); 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2017-10-25T01:42:59.730

我只是使用：

```
setTimeout(function(){
    //reference/manipulate DOM here
}); 
```

与`document.addEventListener("DOMContentLoaded" //etc`最上面的答案不同，它可以追溯到 IE9 - [http://caniuse.com/#search=DOMContentLoaded](http://caniuse.com/#search=DOMContentLoaded)仅表示最近到 IE11。

`setTimeout`有趣的是，我在 2009 年偶然发现了这个解决方案：[检查 DOM 的准备情况是否矫枉过正？](https://stackoverflow.com/questions/1381481/is-checking-for-the-readiness-of-the-dom-overkill)，这可能措辞稍微好一点，因为我的意思是“使用各种框架的更复杂的方法来检查 DOM 的准备情况是否有点过头了”。

对于这种技术为什么有效，我最好的解释是，当到达具有这种 setTimeout 的脚本时，DOM 正在被解析，因此 setTimeout 内的代码的执行被推迟到该操作完成。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2014-08-05T11:04:29.297

此处介绍的 setTimeout/setInterval 解决方案仅适用于特定情况。

该问题尤其出现在不超过 8 的旧 Internet Explorer 版本中。

影响这些 setTimeout/setInterval 解决方案成功的变量是：

```
1) dynamic or static HTML
2) cached or non cached requests
3) size of the complete HTML document
4) chunked or non chunked transfer encoding 
```

解决此特定问题的原始（本机 Javascript）代码在这里：

```
https://github.com/dperini/ContentLoaded
http://javascript.nwbox.com/ContentLoaded (test) 
```

这是 jQuery 团队构建实现的代码。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2016-02-03T15:20:32.487

对于 IE9+：

```
function ready(fn) {
  if (document.readyState != 'loading'){
    fn();
  } else {
    document.addEventListener('DOMContentLoaded', fn);
  }
} 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2016-07-07T13:46:43.443

这是我使用的，它速度快，涵盖了我认为的所有基础；适用于除 IE<9 之外的所有内容。

```
(() => { function fn() {
    // "On document ready" commands:
    console.log(document.readyState);
};  
  if (document.readyState != 'loading') {fn()}
  else {document.addEventListener('DOMContentLoaded', fn)}
})(); 
```

这似乎涵盖了所有情况：

*   如果 DOM 已经准备好，则立即触发（如果 DOM 不是“正在加载”，而是“交互式”或“完成”）
*   如果 DOM 仍在加载，它会为 DOM 可用（交互式）设置一个事件侦听器。

DOMContentLoaded 事件在 IE9 和其他所有东西中都可用，所以我个人认为使用它是可以的。如果您没有将代码从 ES2015 转换为 ES5，请将箭头函数声明重写为常规匿名函数。

如果您想等到所有资产都加载完毕，显示所有图像等，然后使用 window.onload 代替。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2020-11-21T17:57:13.417

现在你应该使用模块。将您的代码放入模块的默认函数中，然后将该函数导入脚本元素中。

`client.js`：

```
export default function ()
{
  alert ("test");
} 
```

`index.html`：

```
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>test</title>
  </head>
  <body>
    <script type="module">
      import main from './client.js';
      main ();
    </script>
  </body>
</html> 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-02-21T17:16:59.003

如果您在 BODY 底部附近加载 jQuery，但在写出 jQuery(<func>) 或 jQuery(document).ready(<func>) 的代码时遇到问题，请查看Github 上的[jqShim](https://github.com/withjam/jqshim-head)。

它不是重新创建自己的文档就绪函数，而是简单地保留这些函数，直到 jQuery 可用，然后按预期继续使用 jQuery。将 jQuery 移到 body 底部的目的是加快页面加载速度，您仍然可以通过在模板头部内联 jqShim.min.js 来完成它。

我最终编写了这段代码来将[WordPress](http://en.wikipedia.org/wiki/WordPress)中的所有脚本移动到页脚，而现在只有这个 shim 代码直接位于页眉中。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2018-11-27T21:40:42.223

```
(function(f){
  if(document.readyState != "loading") f();
  else document.addEventListener("DOMContentLoaded", f);
})(function(){
  console.log("The Document is ready");
}); 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2019-04-12T10:32:41.637

大多数 vanilla JS Ready 函数不考虑在 文档已经加载*后*`DOMContentLoaded`设置处理程序的场景 - 这意味着该函数将*永远不会运行*。如果您在外部脚本 ( ) 中查找，就会发生这种情况。**`DOMContentLoaded``async``<script async src="file.js"></script>`**

 **下面的代码`DOMContentLoaded`仅在文档`readyState`不是`interactive`或时检查`complete`。

```
var DOMReady = function(callback) {
  document.readyState === "interactive" || document.readyState === "complete" ? callback() : document.addEventListener("DOMContentLoaded", callback());
};
DOMReady(function() {
  //DOM ready!
}); 
```

如果你也想支持 IE：

```
var DOMReady = function(callback) {
    if (document.readyState === "interactive" || document.readyState === "complete") {
        callback();
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', callback());
    } else if (document.attachEvent) {
        document.attachEvent('onreadystatechange', function() {
            if (document.readyState != 'loading') {
                callback();
            }
        });
    }
};

DOMReady(function() {
  // DOM ready!
}); 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2020-09-03T15:14:18.243

适用于所有已知的浏览器（通过 BrowserStack 测试）。IE6+、Safari 1+、Chrome 1+、Opera 等。使用`DOMContentLoaded`, 回退到`document.documentElement.doScroll()`和`window.onload`.

```
/*! https://github.com/Kithraya/DOMContentLoaded v1.2.6 | MIT License */

DOMContentLoaded.version = "1.2.6";

function DOMContentLoaded() { "use strict";

    var ael = 'addEventListener', rel = 'removeEventListener', aev = 'attachEvent', dev = 'detachEvent';
    var alreadyRun = false, // for use in the idempotent function ready()
        funcs = arguments;

    // old versions of JS return '[object Object]' for null.
    function type(obj) { return (obj === null) ? 'null' : Object.prototype.toString.call(obj).slice(8,-1).toLowerCase() }
    function microtime() { return + new Date() } 

     /* document.readyState === 'complete' reports correctly in every browser I have tested, including IE.
        But IE6 to 10 don't return the correct readyState values as per the spec:
        readyState is sometimes 'interactive', even when the DOM isn't accessible in IE6/7 so checking for the onreadystatechange event like jQuery does is not optimal
        readyState is complete at basically the same time as 'window.onload' (they're functionally equivalent, within a few tenths of a second)
        Accessing undefined properties of a defined object (document) will not throw an error (in case readyState is undefined).
     */

    // Check for IE < 11 via conditional compilation
    /// values: 5?: IE5, 5.5?: IE5.5, 5.6/5.7: IE6/7, 5.8: IE8, 9: IE9, 10: IE10, 11*: (IE11 older doc mode), undefined: IE11 / NOT IE
    var jscript_version = Number( new Function("/*@cc_on return @_jscript_version; @*\/")() ) || NaN;

    // check if the DOM has already loaded
    if (document.readyState === 'complete') { ready(null); return; }  // here we send null as the readyTime, since we don't know when the DOM became ready.

    if (jscript_version < 9) { doIEScrollCheck(); return; } // For IE<9 poll document.documentElement.doScroll(), no further actions are needed.

     /* 
        Chrome, Edge, Firefox, IE9+, Opera 9+, Safari 3.1+, Android Webview, Chrome for Android, Edge Mobile, 
        Firefox for Android 4+, Opera for Android, iOS Safari, Samsung Internet, etc, support addEventListener
        And IE9+ supports 'DOMContentLoaded' 
     */

    if (document[ael]) {
        document[ael]("DOMContentLoaded", ready, false); 
        window[ael]("load", ready, false); // fallback to the load event in case addEventListener is supported, but not DOMContentLoaded
    } else 
    if (aev in window) { window[aev]('onload', ready);
        /* Old Opera has a default of window.attachEvent being falsy, so we use the in operator instead
           https://dev.opera.com/blog/window-event-attachevent-detachevent-script-onreadystatechange/

           Honestly if somebody is using a browser so outdated AND obscure (like Opera 7 where neither addEventListener 
           nor "DOMContLoaded" is supported, they deserve to wait for the full page).
           I CBA testing whether readyState === 'interactive' is truly interactive in browsers designed in 2003\. I just assume it isn't (like in IE6-8). 
        */
    } else { // fallback to queue window.onload that will always work
       addOnload(ready);
    }

    // This function allows us to preserve any original window.onload handlers (in super old browsers where this is even necessary), 
    // while keeping the option to chain onloads, and dequeue them.

    function addOnload(fn) { var prev = window.onload; // old window.onload, which could be set by this function, or elsewhere

        // we add a function queue list to allow for dequeueing 
        // addOnload.queue is the queue of functions that we will run when when the DOM is ready
        if ( type( addOnload.queue ) !== 'array') { addOnload.queue = [];
            if ( type(prev) === 'function') { addOnload.queue.push( prev ); } // add the previously defined event handler
        }

        if (typeof fn === 'function') { addOnload.queue.push(fn) }

        window.onload = function() { // iterate through the queued functions
            for (var i = 0; i < addOnload.queue.length; i++) { addOnload.queue[i]() } 
        };
    }   

    // remove a queued window.onload function from the chain (simplified); 

    function dequeueOnload(fn) { var q = addOnload.queue, i = 0;

        // sort through the queued functions in addOnload.queue until we find `fn`
        if (type( q ) === 'array') {        // if found, remove from the queue
            for (; i < q.length; i++) { ;;(fn === q[i]) ? q.splice(i, 1) : 0; } // void( (fn === q[i]) ? q.splice(i, 1) : 0 ) 
        }
    }

    function ready(ev) { // idempotent event handler function
        if (alreadyRun) {return} alreadyRun = true; 

        // this time is when the DOM has loaded (or if all else fails, when it was actually possible to inference the DOM has loaded via a 'load' event)
        // perhaps this should be `null` if we have to inference readyTime via a 'load' event, but this functionality is better.
        var readyTime = microtime(); 

        detach(); // detach any event handlers

        // run the functions
        for (var i=0; i < funcs.length; i++) {  var func = funcs[i];

            if (type(func) === 'function') {
                func.call(document, { 'readyTime': (ev === null ? null : readyTime), 'funcExecuteTime': microtime() }, func); 
                // jquery calls 'ready' with `this` being set to document, so we'll do the same. 
            }       
        }
    }

    function detach() {
        if (document[rel]) { 
            document[rel]("DOMContentLoaded", ready); window[rel]("load", ready);
        } else
        if (dev in window) { window[dev]("onload", ready); } 
        else {
            dequeueOnload(ready);
        }                                                               
    }

    function doIEScrollCheck() { // for use in IE < 9 only.
        if ( window.frameElement ) { 
            // we're in an <iframe> or similar
            // the document.documentElemeent.doScroll technique does not work if we're not at the top-level (parent document)

            try { window.attachEvent("onload", ready); } catch (e) { } // attach to onload if were in an <iframe> in IE as there's no way to tell otherwise

            return;
        } 
        try {
            document.documentElement.doScroll('left');  // when this statement no longer throws, the DOM is accessible in old IE
        } catch(error) {
            setTimeout(function() {
                (document.readyState === 'complete') ? ready() : doIEScrollCheck();
            }, 50);
            return;
        }
        ready();
    }
} 
```

用法：

```
<script>
DOMContentLoaded(function(e) { console.log(e) });
</script> 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2022-01-01T04:18:52.713

***使用纯 JavaScript 的最简单方法。没有 jQuery：***

```
document.addEventListener("DOMContentLoaded", function(event) {
   // Your code to run since DOM is loaded and ready
}); 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2013-10-03T09:12:53.440

这是一个很好的[https://stackoverflow.com/a/11810957/185565](https://stackoverflow.com/a/11810957/185565)穷人的解决方案。有一条评论认为是在紧急情况下采取救助措施。这是我的修改。

```
function doTheMagic(counter) {
  alert("It worked on " + counter);
}

// wait for document ready then call handler function
var checkLoad = function(counter) {
  counter++;
  if (document.readyState != "complete" && counter<1000) {
    var fn = function() { checkLoad(counter); };
    setTimeout(fn,10);
  } else doTheMagic(counter);
};
checkLoad(0); 
```

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2014-05-27T16:22:56.600

@duskwuff 的编辑也支持[Internet Explorer 8](http://en.wikipedia.org/wiki/Internet_Explorer_8)。不同之处在于对正则表达式的函数测试和带有匿名函数的 setTimeout 的新调用。

另外，我将超时设置为 99。

```
function ready(f){/in/.test(document.readyState)?setTimeout(function(){ready(f);},99):f();} 
```

* * *

## 回答 #36

> 赞同：-2
> 
> 时间：2018-05-27T16:11:24.180

试试这个：

```
function ready(callback){
    if(typeof callback === "function"){
        document.addEventListener("DOMContentLoaded", callback);
        window.addEventListener("load", callback);
    }else{
        throw new Error("Sorry, I can not run this!");
    }
}
ready(function(){
    console.log("It worked!");
}); 
```

* * *

## 回答 #37

> 赞同：-3
> 
> 时间：2009-04-28T22:02:04.343

中的 ready 函数`jQuery`做了很多事情。坦率地说，除非您的网站输出非常少，否则我看不到替换它的意义。`jQuery`是一个非常小的库，它处理你以后需要的各种跨浏览器的东西。

反正贴在这里也没啥意义，打开`jQuery`看看`bindReady`方法。

它首先根据事件模型调用`document.addEventListener("DOMContentLoaded")`或调用`document.attachEvent('onreadystatechange')`，然后从那里继续。

* * *

## 回答 #38

> 赞同：-4
> 
> 时间：2016-01-12T16:35:38.060

简而言之，我们可以使用 JavaScript 方法来代替 jQuery 中使用的 $(document).ready()：

```
<script>
    document.addEventListener("DOMContentLoaded", function_name, false);
    function function_name(){
        statements;
    }
</script> 
```

因此，当页面准备好时，即只有 DOMContentLoaded 时，函数 function_name() 将被调用。

* * *

## 回答 #39

> 赞同：-7
> 
> 时间：2013-10-27T20:55:47.123

如果你想支持**[Internet Explorer 7+](http://en.wikipedia.org/wiki/Internet_Explorer_7)（没有怪癖、兼容性和其他痛苦）、最后一个[Chrome](http://en.wikipedia.org/wiki/Google_Chrome)、最后一个[Safari](http://en.wikipedia.org/wiki/Safari_%28web_browser%29)、最后一个 Firefox 并且没有 iframe** - 这已经足够了：

```
is_loaded = false
callbacks = []

loaded = ->
  is_loaded = true
  for i in [0...callbacks.length]
    callbacks[i].call document
  callbacks = []

content_loaded = ->
  document.removeEventListener "DOMContentLoaded", content_loaded, true
  loaded()

state_changed = ->
  if document.readyState is "complete"
    document.detachEvent "onreadystatechange", state_changed
    loaded()

if !!document.addEventListener
  document.addEventListener "DOMContentLoaded", content_loaded, true
else
  document.attachEvent "onreadystatechange", state_changed

dom_ready = (callback) ->
  if is_loaded
    callback.call document
  else
    callbacks.push callback 
```

# c# - 如何将 lambda 表达式从 IronPython 脚本传递给 C# 构造函数？

> ID：799987
> 
> 赞同：5
> 
> 时间：2009-04-28T21:53:30.433
> 
> 标签：c#, scripting, lambda, ironpython

我正在将 IronPython 脚本引擎集成到我的 C# 光线跟踪器中，尽管我对 Python 完全陌生，但到目前为止，这很容易。不过，有一件事我需要帮助。我有一个 C# 类，它定义了这样的构造函数：

```
public CameraAnimation(Action<Camera, float> animation) 
```

在 C# 中，我会像这样实例化它：

```
var camAnimation = new CameraAnimation((camera, time) => camera.Position += new Vector(1, 0, 0)); 
```

我不太清楚如何在 IronPython 中为 Action 对象进行类似的分配，那么 Python 语法看起来如何？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T23:03:51.090

假设我对此的解释是正确的，并且 Action 是一个通用委托，则以下工作（包括我使用的存根）。

Python：

```
import clr
clr.AddReference("IronPythonDelegates")

import IronPythonDelegates

def camActionPy(camera, time):
  print "Camera: " + str(camera) + ", time: " + str(time)

IronPythonDelegates.CameraAnimation(camActionPy); 
```

夏普：

```
namespace IronPythonDelegates
{
    public class Camera{}

    public class CameraAnimation
    {
    private System.Action<Camera, float> animation;

    public CameraAnimation(System.Action<Camera, float> animation)
    {
        this.animation = animation;
        this.animation(new Camera(), 1.5f);
    }
    }
 } 
```

我更正了上述内容以使用 System.Action，它不再需要显式反射。不过这有点奇怪。出于某种原因，我可以构造一个用户创建的委托，例如：

```
explicitTestAction = IronPythonDelegates.TestAction[IronPythonDelegates.Camera, System.Single](camActionPy);
IronPythonDelegates.CameraAnimation(explicitTestAction); 
```

但不能使用 System.Action 这样做。例如与

```
explicitSystemAction = System.Action[IronPythonDelegates.Camera, System.Single](camActionPy)
IronPythonDelegates.CameraAnimation(explicitSystemAction); 
```

显式系统操作为空。TestAction 刚刚定义为：

```
public delegate void TestAction<T1, T2>(T1 one, T2 two); 
```

但幸运的是，无论哪种方式都可以：

```
CameraAnimation(System.Action) 
```

或者

```
CameraAnimation(TestAction) 
```

虽然由于某种原因，我不记得我第一次尝试时的工作......

# java - 实现游戏播放的最佳方式？

> ID：799996
> 
> 赞同：11
> 
> 时间：2009-04-28T21:54:48.700
> 
> 标签：java, playback, recording

我正在用 Java 创建一个基于网格的游戏，我想实现游戏录制和播放。尽管我考虑了两个想法，但我不确定如何执行此操作：

1.  每秒几次，我会记录整个游戏状态。为了回放它，我编写了一个渲染器来读取状态并尝试创建一个视觉表示。然而，有了这个，我可能会有一个很大的保存文件，并且任何播放尝试都可能会有明显的延迟。

2.  我还可以将每次按键和鼠标点击写入保存文件。这会给我一个更小的文件，并且可以以更少的延迟播放。然而，游戏开始时最轻微的错误（例如，1 毫秒后的射击）会导致游戏开始几分钟后的游戏状态大不相同。

那么，实现游戏回放的最佳方式是什么？

编辑-我不确定我的游戏到底有多确定，所以我不确定整个游戏是否可以通过只记录击键和鼠标点击来准确地拼凑在一起。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-28T22:17:35.447

A good playback mechanism is not something that can be simply added to a game without major difiiculties. The best would be do design the game infrastructure with it in mind. The [command pattern](http://en.wikipedia.org/wiki/Command_pattern) can be used to achieve such a game infrastructure.

For example:

```
public interface Command{
    void execute();
}
public class MoveRightCommand implements Command {
   private Grid theGrid;
   private Player thePlayer;

   public MoveRightCommand(Player player, Grid grid){
        this.theGrid = grid;
        this.thePlayer = player;
       }

   public void execute(){
     player.modifyPosition(0, 1, 0, 0);
   } 
} 
```

And then the command can be pushed in an execution queue **both** when the user presses a keyboard button, moves the mouse or without a trigger with the playback mechanism. The command object can have a time-stamp value (relative to the beginning of the playback) for precise playback...

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-28T22:45:22.010

Shawn Hargreaves had a recent post on his blog about how they implemented replay in MotoGP. Goes over several different approaches and their pros and cons.

[http://blogs.msdn.com/shawnhar/archive/2009/03/20/motogp-replays.aspx](http://blogs.msdn.com/shawnhar/archive/2009/03/20/motogp-replays.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-28T22:06:31.243

假设您的游戏是确定性的，那么如果您记录用户的输入（选项 2）可能就足够了。但是，您需要确保识别这些事件的正确且一致的时间，例如服务器识别的时间。我不确定您如何处理网格中的事件。

My worry is that if you don't have a mechanism that can uniformly reference timed events, there might be a problem with the way your code handles distributed users.

Consider a game like Halo 3 on the XBOX 360 for example - each client records his view of the game, including server-based corrections.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-28T22:03:08.570

为什么不每秒记录几次然后压缩你的输出，或者这样做：

```
recordInitialState();
...
runs 30 times a second:
recordChangeInState(previousState, currentState);
... 
```

如果你只用时间戳记录状态的变化（并且每次变化很小，如果没有变化，那么什么都不记录），你应该得到合理的文件大小。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-28T22:36:22.420

There is no need to save everything in the scene for every frame. Save changes incrementally and use some good interpolation techniques. I would not really use a command pattern based approach, but rather make checks at a fixed rate for every game object and see if it has changed any attribute. If there is a change that change is recorded in some good encoding and the replay won't even become that big.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-28T22:44:41.777

How you approach this will depend greatly on the language you are using for your game, but in general terms there are many approaches, depending on if you want to use a lot of storage or want some delay. It would be helpful if you could give some thoughts as to what sacrifices you are willing to make.

But, it would seem the best approach may be to just save the input from the user, as was mentioned, and either store the positions of all the actors/sprites in the game at the same time, which is as simple as just saving direction, velocity and tile x,y, or, if everything can be deterministic then ignore the actors/sprites as you can get their information.

How non-deterministic your game is would also be useful to give a better suggestion.

If there is a great deal of dynamic motion, such as a crash derby, then you may want to save information each frame, as you should be updating the players/actors at a certain framerate.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-28T23:00:06.497

I would simply say that the best way to record a replay of a game depends entirely on the nature of the game. Being grid based isn't the issue; the issue is how predictable behaviour is following a state change, how often there are new inputs to the system, whether there is random data being injected at any point, etc, You can store an entire chess game just by recording each move in turn, but that wouldn't work for a first person shooter where there are no clear turns. You could store a first person shooter by noting the exact time of each input, but that won't work for an RPG where the result of an input might be modified by the result of a random dice roll. Even the seemingly foolproof idea of taking a snapshot as often as possible isn't good enough if important information appears instantaneously and doesn't persist in any capturable form.

Interestingly this is very similar to the problem you get with networking. How does one computer ensure that another computer is made aware of the game state, without having to send that entire game state at an impractically high frequency? The typical approach ends up being a bespoke mixture of event notifications and state updates, which is probably what you'll need here.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-11T23:34:44.057

I did this once by borrowing an idea from video compression: keyframes and intermediate frames. Basically, every few seconds you save the complete state of the world. Then, once per game update, you save all the changes to the world state that have happened since the last game update. The details (how often do you save keyframes? What exactly counts as a 'change to the world state'?) will depend on what sort of game information you need to preserve.

In our case, the world consisted of many, many game objects, most of which were holding still at any given time, so this approach saved us a lot of time and memory in recording the positions of objects that weren't moving. In yours the tradeoffs might be different.************