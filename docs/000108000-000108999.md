# StackOverflow 问答 000108000-000108999

# algorithm - 最佳多人迷宫生成算法

> ID：108000
> 
> 赞同：5
> 
> 时间：2008-09-20T12:09:01.287
> 
> 标签：algorithm, language-agnostic, maze

我正在开发一个简单的多人游戏，其中 2-4 名玩家被放置在迷宫中的不同入口点，需要到达一个目标点。生成迷宫一般来说很容易，但在这种情况下，游戏的目标是在其他人之前达到目标，我不希望生成算法过于偏爱一个玩家。

因此，我正在寻找一种迷宫生成算法，其中每个玩家从起点到目标的最佳路径不超过平均路径的 10%。通过这种方式，玩家或多或少处于平等的竞争环境中。谁能想出这样的算法？

（我有一个想法，但它没有经过深思熟虑，而且似乎远不是最佳的——我会把它作为答案发布。）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-20T19:13:40.033

自由空间答案的替代方法是生成一个随机迷宫，然后为每个单元分配一个值，该值表示到达迷宫末端的移动次数（如果您决定从“结束”开始，则可以同时执行这两项操作） '）。然后选择一个距离（可能是那个距离内有 n 个点的最高距离？）并将玩家放在具有该值的方格上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T12:18:18.753

那么首先选择球员的位置和目标以及等长的路径，然后根据定义的路径构建一个迷宫呢？如果路径不相交，这应该很容易工作，我想

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T12:19:01.403

我会通过设置目标和每个玩家的入口点来解决这个问题，然后为每个玩家生成到目标的相似长度的路径。然后我会开始沿着这些路径添加假分支，小心避免链接到其他玩家的路径，或者让分支连接回路径。所以基本上每个分支都是死胡同。

这样，您可以保证路径的长度相似。但是，它不允许玩家彼此互动。但是，您可以通过在分支之间创建链接，使任一路径上的分支入口点与目标之间的距离相似，从而将其放入。在这个分支上，您可以分支更多的死胡同以获得乐趣和利润:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T12:13:00.387

我能想到的最简单的解决方案是像正常一样随机生成整个迷宫，然后随机选择目标点和玩家起点。完成后，计算从每个起点到目标的最短路径。找到平均值并开始“平滑”（移除/移动障碍——不知道这将如何工作）显着高于它的路径，直到所有路径都在适当的范围内。此外，可以采用明显低于平均水平的那些并插入额外的障碍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-21T17:06:05.837

在中间的某个地方选择你的出口点

从那里开始你的 N 条路径，在每个循环的每个路径中添加 1，直到它们达到你想要的长度。

有你的 N 个起点，它们的长度都是一样的。

添加额外的分支线，直到迷宫已满。

# c# - 如何获取 Windows 资源管理器显示的文件类型图标？

> ID：108005
> 
> 赞同：18
> 
> 时间：2008-09-20T12:11:31.093
> 
> 标签：c#, winforms

这里的第一个问题。我正在用 C# (.NET 3.5) 开发一个在列表视图中显示文件的程序。我想让“大图标”视图显示 Windows 资源管理器用于该文件类型的图标，否则我将不得不使用一些现有的代码，如下所示：

```
 private int getFileTypeIconIndex(string fileName)
    {
        string fileLocation = Application.StartupPath + "\\Quarantine\\" + fileName;
        FileInfo fi = new FileInfo(fileLocation);
        switch (fi.Extension)
        {
            case ".pdf":
                return 1;
            case ".doc": case ".docx": case ".docm": case ".dotx":case ".dotm": case ".dot":case ".wpd": case ".wps":
                return 2;
            default:
                return 0;
        }

    } 
```

上面的代码返回一个整数，用于从我填充了一些常见图标的图像列表中选择一个图标。它工作正常，但我需要在阳光下添加每个扩展！有没有更好的办法？谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-29T18:37:28.610

您可能会发现使用[Icon.ExtractAssociatedIcon](http://msdn.microsoft.com/en-us/library/system.drawing.icon.extractassociatedicon.aspx)是一种比使用 SHGetFileInfo 更简单（托管）的方法。但请注意：具有相同扩展名的两个文件可能具有不同的图标。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-20T12:17:03.700

文件图标保存在注册表中。这有点令人费解，但它的工作原理类似于

*   获取文件扩展名并为其查找注册表项，例如 .DOC 获取该注册表设置的默认值“Word.Document.8”
*   现在在注册表中查找该值。
*   查看“默认图标”注册表项的默认值，在本例中为 C:\Windows\Installer{91120000-002E-0000-0000-0000000FF1CE}\wordicon.exe,1
*   打开文件并获取图标，使用逗号后的任意数字作为索引器。

[CodeProject](http://www.codeproject.com/KB/cs/GetFileTypeAndIcon.aspx?display=Print)上有一些示例代码

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-20T12:48:28.913

我在最近的一个项目中使用了来自 codeproject 的以下解决方案

[在 C# 中使用 SHGetFileInfo 获取（和管理）文件和文件夹图标](http://www.codeproject.com/KB/files/fileicon.aspx)

## 

演示项目很容易解释，但基本上你只需要这样做：

```
private System.Windows.Forms.ListView FileView;

private ImageList _SmallImageList = new ImageList();
private ImageList _LargeImageList = new ImageList();
private IconListManager _IconListManager; 
```

在构造函数中：

```
_SmallImageList.ColorDepth = ColorDepth.Depth32Bit;
_LargeImageList.ColorDepth = ColorDepth.Depth32Bit;

_SmallImageList.ImageSize = new System.Drawing.Size(16, 16);
_LargeImageList.ImageSize = new System.Drawing.Size(32, 32);

_IconListManager = new IconListManager(_SmallImageList, _LargeImageList);

FileView.SmallImageList = _SmallImageList;
FileView.LargeImageList = _LargeImageList; 
```

最后当你创建 ListViewItem 时：

```
ListViewItem item = new ListViewItem(file.Name, _IconListManager.AddFileIcon(file.FullName)); 
```

对我来说效果很好。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-20T12:53:46.967

编辑：[这](https://stackoverflow.com/questions/462270/get-file-icon-used-by-shell)是一个没有 PInvoke 的版本。

```
[StructLayout(LayoutKind.Sequential)]
public struct SHFILEINFO
{
    public IntPtr hIcon;
    public IntPtr iIcon;
    public uint dwAttributes;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
    public string szDisplayName;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 80)]
    public string szTypeName;
};

public const uint SHGFI_ICON = 0x100;
public const uint SHGFI_LARGEICON = 0x0; // 'Large icon
public const uint SHGFI_SMALLICON = 0x1; // 'Small icon

[DllImport("shell32.dll")]
public static extern IntPtr SHGetFileInfo(string pszPath, uint dwFileAttributes, ref SHFILEINFO psfi, uint cbSizeFileInfo, uint uFlags);

[DllImport("User32.dll")]
public static extern int DestroyIcon(IntPtr hIcon);

public static System.Drawing.Icon GetSystemIcon(string sFilename)
{
    //Use this to get the small Icon
    IntPtr hImgSmall; //the handle to the system image list
    //IntPtr hImgLarge; //the handle to the system image list
    APIFuncs.SHFILEINFO shinfo = new APIFuncs.SHFILEINFO();
    hImgSmall = APIFuncs.SHGetFileInfo(sFilename, 0, ref shinfo,
        (uint)Marshal.SizeOf(shinfo), APIFuncs.SHGFI_ICON | APIFuncs.SHGFI_SMALLICON);

    //Use this to get the large Icon
    //hImgLarge = SHGetFileInfo(fName, 0, 
    //  ref shinfo, (uint)Marshal.SizeOf(shinfo), 
    //  Win32.SHGFI_ICON | Win32.SHGFI_LARGEICON);

    //The icon is returned in the hIcon member of the shinfo struct
    System.Drawing.Icon myIcon = (System.Drawing.Icon)System.Drawing.Icon.FromHandle(shinfo.hIcon).Clone();
    DestroyIcon(shinfo.hIcon); // Cleanup
    return myIcon;
} 
```

# python - PLY：C 解析器中的令牌转移问题

> ID：108009
> 
> 赞同：3
> 
> 时间：2008-09-20T12:14:41.240
> 
> 标签：python, parsing, yacc, ply

我正在使用 PLY 编写一个 C 解析器，最近遇到了一个问题。这段代码：

```
typedef int my_type;
my_type x; 
```

是正确的 C 代码，因为 my_type 被定义为之前使用的类型。我通过在解析器中填充类型符号表来处理它，词法分析器使用该表来区分类型和简单标识符。

但是，虽然类型声明规则以 SEMI（';' 标记）结尾，但 PLY`my_type`在决定使用第一行完成之前将标记从第二行转移。因此，我没有机会将类型符号表中的更新传递给词法分析器，它会将 my_type 视为标识符而不是类型。

任何修复的想法？

完整代码位于：[http](http://code.google.com/p/pycparser/source/browse/trunk/src/c_parser.py) ://code.google.com/p/pycparser/source/browse/trunk/src/c_parser.py 不知道如何从中创建一个更小的示例。

**编辑：**

问题解决了。请参阅下面的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T12:47:23.487

不确定为什么要在词法分析器中进行这种级别的分析。

可能应该使用词法分析将输入流分离为词法标记（数字、换行、关键字等）。解析阶段应该进行该级别的分析，包括 typedef 的表查找等。

这就是我一直在 lexx 和 yacc 之间划分职责的方式，这是我选择的工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T15:28:02.633

在Dave Beazley（PLY 的创建者）的[帮助下，我的问题得到了解决。](http://groups.google.com/group/ply-hack/tree/browse_frm/thread/cf31e8334801eabd/b9cdf4a6682635c1?rnum=1&_done=%2Fgroup%2Fply-hack%2Fbrowse_frm%2Fthread%2Fcf31e8334801eabd%3F#doc_5c415da045e77a6e)

这个想法是使用特殊的子规则并在其中执行操作。就我而言，我将`declaration`规则拆分为：

```
def p_decl_body(self, p):
    """ decl_body : declaration_specifiers init_declarator_list_opt
    """
    # <<Handle the declaration here>>        

def p_declaration(self, p):
    """ declaration : decl_body SEMI 
    """
    p[0] = p[1] 
```

`decl_body`在 SEMI 移入后，总是在令牌之前减少，因此我的操作会在正确的时间执行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T12:31:30.733

我认为您需要将检查 ID 是否为 TYPEID 从 c_lexer.py 移动到 c_parser.py。

正如您所说，由于解析器正在查看 1 个标记，因此您无法在词法分析器中做出该决定。

相反，更改您的解析器以检查 ID 以查看它们是否是声明中的 TYPEID，如果不是，则生成错误。

正如 Pax Diablo 在他出色的回答中所说，词法分析器/标记器的工作不是做出关于标记的那些决定。这就是解析器的工作。

# c# - 使用 ASP.NET (C#) 解析多个 XML 文件并返回具有特定元素的文件

> ID：108010
> 
> 赞同：2
> 
> 时间：2008-09-20T12:15:01.863
> 
> 标签：c#, asp.net, xml

问候。

我正在寻找一种方法来使用 ASP.NET (C#) 解析特定目录中的许多 XML 文件。我希望能够从特定元素返回内容，但在此之前，需要找到那些在元素之间具有特定值的内容。

示例 XML 文件 1：

```
<file>
    <title>Title 1</title>
    <someContent>Content</someContent>
    <filter>filter</filter>
</file> 
```

示例 XML 文件 2：

```
<file>
    <title>Title 2</title>
    <someContent>Content</someContent>
    <filter>filter, different filter</filter>
</file> 
```

案例一：

给我所有具有“过滤器”过滤器的 XML。

案例2：

给我所有标题为“Title 1”的 XML。

看起来，使用 LINQ 似乎应该可以做到这一点，但我只看到了当有一个 XML 文件时如何执行此操作的示例，而不是在有多个 XML 文件时，例如在这种情况下。

我希望这在服务器端完成，这样我就可以在那端进行缓存。

可以使用任何版本的 .NET Framework 的功能。

谢谢！

~詹姆斯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-20T12:41:03.160

如果您使用的是 .Net 3.5，则使用 LINQ 非常容易：

```
//get the files
XElement xe1 = XElement.Load(string_file_path_1);
XElement xe2 = XElement.Load(string_file_path_2);

//Give me all XML that has a filter of 'filter'.
var filter_elements1 = from p in xe1.Descendants("filter") select p;
var filter_elements2 = from p in xe2.Descendants("filter") select p;
var filter_elements = filter_elements1.Union(filter_elements2);

//Give me all XML that has a title of 'Title 1'.
var title1 = from p in xe1.Descendants("title") where p.Value.Equals("Title 1") select p;
var title2 = from p in xe2.Descendants("title") where p.Value.Equals("Title 1") select p;
var titles = title1.Union(title2); 
```

这一切都可以简写，总共只需 4 行即可获得结果：

```
XElement xe1 = XElement.Load(string_file_path_1);
XElement xe2 = XElement.Load(string_file_path_2);
var _filter_elements = (from p1 in xe1.Descendants("filter") select p1).Union(from p2 in xe2.Descendants("filter") select p2);
var _titles = (from p1 in xe1.Descendants("title") where p1.Value.Equals("Title 1") select p1).Union(from p2 in xe2.Descendants("title") where p2.Value.Equals("Title 1") select p2); 
```

这些都将是 IEnumerable 列表，因此它们非常易于使用：

```
foreach (var v in filter_elements)
    Response.Write("value of filter element" + v.Value + "<br />"); 
```

LINQ规则！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T12:39:01.590

您可能希望创建自己的迭代器类来迭代这些文件。

比如说，制作一个 XMLContentEnumerator : IEnumerable。这将遍历特定目录中的文件并解析其内容，然后您将能够进行正常的 LINQ 过滤查询，例如：

```
var xc = new XMLContentEnumerator(@"C:\dir");

var filesWithHello = xc.Where(x => x.title.Contains("hello")); 
```

我没有提供完整示例的环境，但这应该提供一些想法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T15:07:55.367

这是使用 Framework 2.0 的一种方法。您可以通过使用正则表达式而不是简单的字符串测试来使这个更清晰。如果您需要更多性能以提高性能，您也可以尝试编译您的 XPath 表达式。

```
static void Main(string[] args)
{
    string[] myFiles = { @"C:\temp\XMLFile1.xml", 
                         @"C:\temp\XMLFile2.xml", 
                         @"C:\temp\XMLFile3.xml" };
    foreach (string file in myFiles)
    {
        System.Xml.XPath.XPathDocument myDoc = 
            new System.Xml.XPath.XPathDocument(file);
        System.Xml.XPath.XPathNavigator myNav = 
            myDoc.CreateNavigator();

        if(myNav.SelectSingleNode("/file/filter[1]") != null &&
            myNav.SelectSingleNode("/file/filter[1]").InnerXml.Contains("filter"))
            Console.WriteLine(file + " Contains 'filter'");

        if (myNav.SelectSingleNode("/file/title[1]") != null &&
            myNav.SelectSingleNode("/file/title[1]").InnerXml.Contains("Title 1"))
            Console.WriteLine(file + " Contains 'Title 1'");
    }

    Console.ReadLine();
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T12:16:22.547

使用 XPath？
[http://www.w3schools.com/XPath/default.asp](http://www.w3schools.com/XPath/default.asp)

# web-services - 欧洲的天气网络服务？

> ID：108025
> 
> 赞同：11
> 
> 时间：2008-09-20T12:24:11.220
> 
> 标签：web-services, rest, xml-rpc, provider, weather

我们正在寻找具有城市分辨率的欧洲可靠的“当前天气”网络服务。我们只需要当前的天气。

由于它是针对商业网站的，我们不介意为该服务支付合理的费用。

我们有哪些选择？根据以往的经验，您会推荐或避免哪些服务？

注意：SOAP Web 服务、XML RPC、REST 都可以。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T09:52:27.213

美国 NOAA 已对全球城市可用的[METAR 信息进行编码。](http://weather.noaa.gov/pub/data/observations/metar/stations/)给定相关城市的 ICAO 机场代码（例如伦敦的[EGLL](http://weather.noaa.gov/pub/data/observations/metar/stations/EGLL.TXT)），您可以快速获得 METAR 报告。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T18:25:21.893

[Weather Underground](http://www.wunderground.com/)是一个成功的气象站点，覆盖了世界大部分地区。我们有时会在工作中使用他们的数据。他们提供天气[XML 提要和 API](http://wiki.wunderground.com/index.php/API_-_XML)，其中包括对当前观测的访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T13:11:38.157

[http://www.weather2u.com](http://www.weather2u.com)提供覆盖全球的商业服务。然而，与大多数全球气象站点一样，它们使用来自 NOAA 国家气象局的模型派生数据，其准确性与当地国家气象局相比是不利的，尤其是沿海地区。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T14:19:30.833

直接从英国气象局获取。他们以多种格式为世界提供[数据馈送。](http://www.metoffice.gov.uk/newmedia/datafeed/catalogue.html)如果您更喜欢欧洲专用的提要（英国无论如何都提供数据），您想查看[ecomet](http://www.ecomet.eu/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T15:06:32.220

我会使用谷歌天气提要；）我还没有找到如何读出它，但它显然是很好的来源[How to parse XML in JavaScript from Google](https://stackoverflow.com/questions/323982/how-to-parse-xml-in-javascript-from-google)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-20T12:56:34.933

您应该能够像[天气 plasmoid](http://www.kde-look.org/content/show.php/Weather+Plasmoid?content=84251)团队那样与[Yahoo Weather Europe](http://weather.yahoo.com/Europe/EUROPEX/regional.html)进行交互。或者，如果您只需要将其添加到网页，您可以直接使用[此小工具](http://www.gmodules.com/ig/creator?synd=open&url=http%3A//www.labpixies.com/campaigns/weather/weather.xml&pt=%26context%3Dd%26synd%3Dopen%26lang%3Den%26.lang%3Den%26country%3Dus%26.country%3Dus%26cat%3Dall%26num%3D1%26start%3D-1%26cols%3D1%26objs%3DOVJ&sn=OVJ&lang=en)

# cloud - 什么是云计算？

> ID：108037
> 
> 赞同：48
> 
> 时间：2008-09-20T12:35:08.383
> 
> 标签：cloud, terminology

任何人都可以用简单的语言解释云计算的工作原理吗？我已阅读[Wikipedia 文章](http://en.wikipedia.org/wiki/Cloud_computing)，但仍不确定我是否了解云的实际工作原理。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-12-02T01:43:48.890

首先，解决这个问题：*云计算是一个营销流行语，而且定义不明确（至少目前如此）*。

我建议剖析这个总体流行语和细分市场，即：

*   **IaaS**：基础设施即服务（例如 Amazon EC2）
*   **Paas**：平台即服务（例如 Google AppEngine）
*   **DaaS**：数据库即服务（例如 Amazon RDS）
*   **SaaS**：软件即服务（例如 Salesforce）

回到你的观点：

1.  如果您通过 Web 界面公开服务，则可以将其分类到 Cloud Computing bin
2.  传统网站本身不属于 CC 类别（见上述部分）
3.  我不知道什么是“云应用程序”：您是否要定义一个新术语？;-)

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-20T12:38:16.880

除了最新的营销术语？

基本上，您的程序所需的所有资源都保存在 Internet 上的“某处”。您通过定义的服务合同与他们互动；SOAP、REST、POX 或其他任何东西，以及之后发生的事情取决于服务提供商。您不关心您的信息是如何存储的或服务是如何提供的，就是这样。

例如，如果您想存储文件，您可以选择使用 Amazon 的 S3 云系统。您连接到服务并上传您的文件；您不知道也不关心文件的存储位置，只知道该服务的入口点的位置。

如果您有一个应用程序，那么它也可以在云中运行，假设它是合适的。例如，Live Mesh 是一个虚拟机，您可以在本地和云中对其进行编码和运行您的软件，因此您的用户只需转到一个 URI 并找到您的程序，您不在乎它在哪里可用云上。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-06-11T08:11:05.190

*云计算*是关于基于硬件的服务（涉及计算、网络和存储容量），其中：

*   **按需提供**服务；客户可以随用随付，无需投资数据中心。
*   硬件管理是从客户那里抽象出来的。
*   基础设施容量具有弹性，可以轻松扩展和缩减。

这种简单的模式背后有强大的经济力量：与自托管和数据中心类型的托管相比，*提供和使用云计算服务通常可以*更*有效地利用资源。*

*摘自[这篇关于云计算](http://abdullin.com/wiki/cloud-computing.html)的文章。*

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-12-02T01:42:48.093

基本上是小时的营销术语。问 5 个人，你会得到 6 个答案。我听说有些人将云计算描述为 Google Docs，因为您将数据存储在“云中”。其他人更多地认为它是动态分配和托管，例如亚马逊的 EC2 或 Google App Engine。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-20T12:47:13.580

该术语是如此新，以至于没有公认的定义，特别是因为戴尔 (!) 未能为该术语注册商标。

本质上，这个想法类似于公用事业的想法——你需要电力，但你不关心哪个发电站提供电力，因为有一个网络为每个人提供电力，你可以利用它。这适用于电力，但互联网还没有那么复杂。但这就是愿景。

亚马逊的 S3 服务只是提供磁盘空间，它并不关心谁在使用它，也不关心他们在世界上的什么地方。当然，Google 的办公工具（以及 Microsoft 的网络产品）提供了一项服务，而不是特定的机器，它将满足您的应用程序需求。同样，您可以创建和使用电子表格，但您不知道该电子表格的存储位置，或者它在哪台机器上运行 - 只是知道它在您需要时可用。

Web 2.0 是另一个难以找到定义的术语，但您可以想象您的电子表格使用嵌入在另一台机器某处的计算，并将其计算结果存储在 Amazon S3 上。边界在这一点上逐渐消失。

因为无论您从何处登录都可以使用它，因此可以从世界任何地方访问它。它是“在云端”，因为它可以从任何地方看到（不是一个很好的类比，但是......）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-20T13:10:03.650

即使是一些简单的东西，比如网络邮件，也可以被认为是在“云端”保存我们的信息。也就是说，数据不是本地保存的，而是存储在称为互联网的神奇云上。

它基本上只是一个用于远程存储东西的流行语。此列表总结了使用它的原因。

FTP 备份 => 将文件存储在云端
SSH 到远程 PC 执行代码 => 云计算
Webmail => 云邮件
SSH 到远程 PC 执行预测天气的代码 => 通过云计算进行云计算

（我尝试了一个 html 表，但它没有呈现......）

听起来更酷是不是！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-12-02T02:07:32.887

我将通过几个例子来解释我是如何理解云计算的：

假设您正在创建一个个人财务 Web 应用程序。您联系了几家银行并提出了您的建议，他们喜欢这个想法，但他们拒绝让您访问他们的服务器以获取 Web 服务。在云计算中，银行可以在像微软 Azure 这样的云服务中创建一个网络服务，从他们的服务器中提取数据。然后，您将从云而不是他们的服务器调用他们的 Web 服务。基本上是由微软、IBM、谷歌等知名公司运行的中间服务器中的“云”。

另一方面，对于银行而言，它减轻了管理所需网络服务和硬件/软件的责任和成本。如果小型信用合作社只有数据存储服务器而没有 Web 服务器，那么云会为他们提供与大型银行一样参与您的应用程序的机会。

所以基本上你可以把云想象成网络服务和/或数据存储的中介。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-01-19T17:49:04.580

云计算是一种使用大规模计算基础设施的共享计算。换句话说，强大的硬件是相通的，往往才能充分实现虚拟化的好处。该硬件可以以公共云的形式在许多用户之间共享，也可以专用于一个实体，因为它用于私有云计算。

公共云被定义为多租户环境，您可以在其中购买与许多其他客户端或租户共享的云计算环境中的“服务器切片”。

另一方面，[私有云计算根据定义是一个单租户环境，其中硬件、存储和网络专用于单个客户或公司。](http://www.onlinetech.com/private_cloud_computing)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-20T13:19:44.533

它是一种发生在互联网上的分布式计算。这个想法是，您无需创建自己的资源，而是将数据、应用程序放在云中。假定此云具有 100% 的可用性和无限的可扩展性。更多详情： http://vineetgupta.spaces.live.com/blog/cns!8DE4BDC896BEE1AD! [1326.entry](http://vineetgupta.spaces.live.com/blog/cns!8DE4BDC896BEE1AD!1326.entry)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-12-02T01:41:16.930

这些都不能使您的应用程序成为云应用程序。如果它在云中运行，它就是一个云应用程序。什么是云？

[云计算和分布式计算的区别？](https://stackoverflow.com/questions/1349894/difference-between-cloud-computing-and-distributed-computing)

网站开发模型确实倾向于在云中运行，因为系统的许多部分本质上是并行的。但是，您可以做出各种设计决策（呃，错误？），但这会限制可以实现的并行度。您仍然可以在云中运行这样的程序，但它不会获得高度并行应用程序所能获得的那种好处。

您所谈论的技术可用于创建高度并行的应用程序，但这不是自动的，您仍然必须了解自己在做什么。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-12-02T01:45:45.347

云计算只是订购、使用和丢弃计算机的一种特定方式。这类似于在 ATM 的帮助下使用银行服务或从自动售货机购买东西。

云计算的目标是完全排除供应商一方的任何活人。

云计算的任何其他好的和坏的属性都只是这个想法的副产品。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-12-02T02:41:01.070

我喜欢这个视频的解释：

[http://www.youtube.com/watch?v=XdBd14rjcs0&feature=related](http://www.youtube.com/watch?v=XdBd14rjcs0&feature=related)

简短版本：Google 和 Salesforce.com 等出售计算机空间和“虚拟化”应用程序环境，让您可以在他们的机器上运行程序。就像虚拟虚拟主机一样，但对于程序和应用程序，不仅仅是网站。现在这是一个大流行词，因为大玩家真的在推动它作为从他们的基础设施和未使用的时钟周期中赚取更多钱的一种方式。尤其是 Salesforce，你可以把这个最新版本的“云计算”归咎于他们和“Force.com”，因为他们一直在大力推广他们的服务，使用云计算这个词，并通过代理，云的概念计算本身。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-02-03T05:13:25.670

我建议你阅读这篇论文

**云之上：云计算的伯克利观点**

毫无疑问，在研究领域本文被称为云计算简介

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-10-05T07:33:59.387

我认为它就像一台从云而不是服务器系统提供服务的计算机。云可能会蔓延到世界各地。因此，与其他任何服务相比，云只能更快地分发服务。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-11-24T18:46:24.387

[这是关于什么是云计算](http://www.whitestratus.com/other/removed/whatis-cloud-computing)的一个很好的定义。

# c - 关闭/清理“混合”文件描述符/套接字

> ID：108043
> 
> 赞同：6
> 
> 时间：2008-09-20T12:38:21.637
> 
> 标签：c, sockets, io, file-descriptor

当我使用 accept() 创建一个套接字并使用 fdopen() 从中创建一个 FILE 时，我需要做什么来清理所有内容？我需要在 FILE 上执行 fclose()，在套接字上执行 shutdown() 和 close()，还是只需要 shutdown() 和/或 close() 或 fclose()？如果我不执行 fclose()，我是否必须手动释放（） FILE 指针？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T12:48:51.597

来自 man fdopen：

> 文件描述符没有被复制，并且会在 fdopen() 创建的流关闭时关闭

所以我只会使用 fclose()，它也会关闭底层文件描述符。我也不知道是否需要 shutdown()。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T12:53:58.200

来自[http://opengroup.org/onlinepubs/007908775/xsh/fclose.html](http://opengroup.org/onlinepubs/007908775/xsh/fclose.html)

> fclose() 函数将对与 stream 指向的流相关联的文件描述符执行 close()。

如果您已将套接字包装在流中，则 shutdown() 可能不再有意义，至少在不先刷新流的情况下不会。但我不会发誓，因为我不知道你想要关闭（）而不是关闭（）没有任何用途。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-20T12:44:59.577

这里有两件事需要清理：由套接字表示的流`FILE`和由套接字表示的文件描述符。您需要先关闭流，然后关闭文件描述符。所以，一般来说，你需要`fclose()`任何`FILE`对象，然后是`close()`任何文件描述符。

就我个人而言，当我想自己清理时，我从来没有使用过`shutdown()`，所以我不能说。

## 编辑

其他人已经正确指出这`fdclose()`也会关闭底层文件描述符，并且由于调用`close()`关闭文件描述符会导致错误，在这种情况下你只需要`fdclose()`.

# c++ - 什么是最好的 Ribbon UI 控件，可以重新适应使用 VC2005 构建的传统 MFC 应用程序？

> ID：108047
> 
> 赞同：2
> 
> 时间：2008-09-20T12:42:54.090
> 
> 标签：c++, user-interface, mfc, ribbon, stingray

您在将 Ribbon 样式控件引入传统 MFC 应用程序方面有什么经验？

我知道它存在于新的 VC2008 功能包中，但是从 VC2005 更改编译器对于我们的源代码库和集成到我们的环境、英特尔 FORTRAN、ClearCase 和许多第三库来说是一件大事。

有一些不同的商业实现，大多数专注于 C#/VB .NET，只有少数用于原生 C++ MFC。

我已经阅读了谷歌发现的所有常见评论，现在大多数评论都已经过时了，所以我对那些实际做过的人感兴趣，经历过痛苦的障碍，发布了一个带有 VC2005 和功能区 UI 的遗留应用程序。

我们目前使用非常旧版本的 Stingray Objective Toolkit 来提供我们的 MFC 扩展，例如可自定义的工具栏和停靠窗口等。

* * *

任何使用[Prof-UIS](http://www.prof-uis.com/)的人，与其他商业软件相比，它相对便宜、无限制的开发者许可成本是其他人的十分之一。

是否有任何免费的、开源的或 L-GPL 可用的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T12:52:45.767

在我的项目中，我使用 Visual Studio 2008 中的 MFC 功能包，它基于[BCGSoft](http://www.bcgsoft.com)的代码。他们的 BCGControlBar 库专业版包括一个功能区控件，并且与 Visual Studio 2005 兼容。

不过，我不知道有任何用于 C++ 的开源功能区控件库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T12:45:43.710

我们使用[Codejock](http://www.codejock.com/)。它并不便宜，但我想我发现好的控件通常是:-)。他们在技术支持部门反应迅速（尽管我们最近不需要使用它）。我们正在使用这些控件构建一整套工具，并且一直拥有我们需要的东西，包括构建 Office 2007 风格功能区​​的能力。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-21T06:20:49.867

请注意，您需要 Microsoft 的许可才能在您的应用程序中使用功能区控件。只要您不编写与 Word 或其他 Office 软件竞争的软件，他们就会免费提供。

看看这个链接：[Office UI Licensing](http://msdn.microsoft.com/en-us/office/aa973809.aspx)。

人们通常对此不满意微软：[Office UI 功能区许可证的邪恶](http://weblogs.asp.net/fbouma/archive/2008/07/20/the-evil-of-the-office-ui-ribbon-license.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T12:00:23.117

我们在我们的应用程序中实现了一个功能区，因为我们需要拥有最新/最华丽的 UI。它看起来不错，但与使用普通工具栏相比，可用性并不好！

要遵守 Microsoft 使用功能区的许可，您必须遵守他们关于如何使用功能区的指导方针。例如..只有用户可以更改功能区选项卡，除非切换到上下文选项卡，否则您不能以编程方式进行操作。所有这些限制意味着功能区仅适用于绝对以文档为中心的应用程序。如果您的应用程序不是以文档为中心的，请不要认为您可以简单地放入功能区来替换菜单/工具栏驱动的系统，而无需考虑如何将所有内容组合在一起。

# sharepoint - MOSS 2007：BDC 权限问题 - Web 部件的配置菜单中未列出 BDC 应用程序

> ID：108051
> 
> 赞同：2
> 
> 时间：2008-09-20T12:45:39.827
> 
> 标签：sharepoint, moss, bdc

我实际上在 MOSS 2007 项目中工作，我必须通过业务数据目录中的应用程序从外部数据源 (WebService) 导入数据。应用程序定义是使用 BDC Meta Man 创建的，并且成功导入到业务数据目录中，没有任何错误。

我首先通过“编辑配置文件页面模板”选项测试了外部数据源，其中 BDC-Webpart 已经位于站点上。在 Web 部件的首选项菜单中，我可以使用“Typ”-Picker 选择新的 BDC 应用程序，一切正常。

不幸的是，它不适用于使用相同 SSP 的其他 MOSS 应用程序上的 BDC Web 部件。每次我在网站上放置 BDC Web 部件并尝试对其进行配置时。Web 部件菜单中的“类型”选择器保持为空，并且未列出来自 BDC 的应用程序。

然后，我检查了 SSP 的 BDC 菜单中的权限设置，我在其中实验性地授予每个用户帐户的所有权限，以便查看是否是权限问题。不幸的是，它没有改变任何东西，BDC 应用程序在“Typ”-Picker 中仍然不可见。

所以也许有人有类似的问题并且知道问题是什么！

再见，弗洛

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T17:04:38.360

确保设置应用程序和实体的权限。

# java - 如何诊断由 Java 程序引起的 C 内存泄漏？

> ID：108057
> 
> 赞同：6
> 
> 时间：2008-09-20T12:48:47.447
> 
> 标签：java, memory-leaks

我正在开发一个导致 Sun 1.6 JVM (1.6_05) 内存泄漏的大型应用程序 (300K LOC)。分析 Java 显示没有泄漏。JVM 是否有任何可用的诊断程序可以检测到泄漏的原因？
我无法创建一个简单的、独立的 Java 测试用例。是通过在 JVM 上使用 C 堆分析器来解决这个问题的唯一方法吗？
该应用程序创建一个套接字池并执行大量网络 I/O。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T13:06:56.997

像 profiler4j 这样的分析器可以显示托管和非托管内存（实时曲线）。然后您可以查看是否有泄漏以及何时发生泄漏。但是您没有找到更多信息。

在此之后有两种可能的解决方案：

1.  您可以使用实时曲线隔离问题并创建更简单的测试，直到找到问题的原因。
2.  您在代码中搜索典型问题，例如：
    1.  从未启动的 Thread 类的实例。
    2.  永远不会被丢弃的图像或图形
    3.  永远不会关闭的 ODBC 桥对象

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T13:08:12.470

我喜欢 valgrind ( [http://valgrind.org/](http://valgrind.org/) )，如果你在它支持的系统上执行它。它真的很摇滚！

# jakarta-ee - struts 动作控制器 - 多线程？

> ID：108059
> 
> 赞同：1
> 
> 时间：2008-09-20T12:52:18.577
> 
> 标签：jakarta-ee, struts

当他们说struts框架中的动作控制器是多线程的时，这是否意味着有多个servlet实例接受请求并将其转发给模型。或者这是否意味着只有一个实例接受所有请求？任何视觉效果将不胜感激

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T13:00:19.337

与大多数其他 servlet 一样，会创建一个单独的线程来处理每个请求。您必须实现该`SingleThreadedModel`接口才能为每个请求获取一个新的 servlet 实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T14:55:50.337

见[http://struts.apache.org/1.x/userGuide/building_controller.html](http://struts.apache.org/1.x/userGuide/building_controller.html)

Struts 控制器 servlet 只创建 Action 类的一个实例，并使用这个实例来服务所有请求。因此，您需要编写线程安全的 Action 类。遵循与编写线程安全 Servlet 相同的准则。以下是两个通用指南，可帮助您编写可扩展的、线程安全的 Action 类：

*   **仅使用局部变量**- 有助于线程安全编码的最重要原则是在 Action 类中仅使用局部变量，**而不是实例变量。**局部变量是在（由您的 JVM）分配给每个请求线程的堆栈上创建的，因此无需担心共享它们。只要需要的所有变量都作为方法参数传递，Action 可以分解为多个本地方法。这确保了线程安全，因为 JVM 使用与单个线程关联的调用堆栈在内部处理这些变量。

*   **节省资源**- 作为一般规则，分配稀缺资源并将它们保留在来自同一用户的请求（在用户的会话中）可能会导致可伸缩性问题。例如，如果您的应用程序使用 JDBC，并且您为每个用户分配一个单独的 JDBC 连接，那么当您的站点突然出现在 Slashdot 上时，您可能会遇到一些可伸缩性问题。在将控制权转发给适当的 View 组件之前，您应该努力使用池并释放资源（例如数据库连接）——即使您调用的 bean 方法引发了异常。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-12T11:09:08.137

struts 1 不是线程安全的；但对于 strus 2，它是每个请求一个实例。

# user-interface - 是否有任何用于 Common Lisp 的高级、易于安装的 GUI 库？

> ID：108081
> 
> 赞同：36
> 
> 时间：2008-09-20T12:59:13.350
> 
> 标签：user-interface, lisp, common-lisp

有没有什么好的、跨平台的（至少是 SBCL 和 CLISP）易于安装的 GUI 库？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-20T13:25:53.940

[Ltk](http://www.peter-herth.de/ltk/)非常流行，非常便携，并且通过 Tk 文档进行了合理的记录。在 SBCL 上安装就像说一样简单：

```
(require :asdf-install)
(asdf-install:install :ltk) 
```

还有[Cells-Gtk](http://common-lisp.net/project/cells-gtk/)，据报道它非常有用，但由于它依赖于 Cells，它的学习曲线可能会稍微陡峭一些。

编辑：请注意，ASDF-INSTALL*仅*与 SBCL 很好地集成在一起。从其他 Lisp 实现中安装库可能会更难。（就个人而言，我总是从 SBCL 中安装我的库，然后在所有实现中使用它们。）对于这可能造成的任何混乱，我深表歉意。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-23T03:37:21.927

[clg](http://sourceforge.net/projects/clg)是​​用于 Common Lisp 的 GTK 的绑定。既完整又口齿不清。

如果您想在 CL 中设计图形界面，您可能还想看看 CLIM，它是用于 GUI 的某种标准 API。Allegro 和 Lispworks 有自己的实现，还有一个免费软件[McCLIM](http://common-lisp.net/project/mcclim/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-20T14:02:20.607

另外，刚刚找到了一个 Smoke 库 QT 绑定，名为[CommonQt](http://common-lisp.net/project/commonqt/) for CL

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-13T20:18:22.747

还有[wxCL ，为](http://www.wxcl-project.org/)[wxWidgets](http://www.wxwidgets.org/)提供 CFFI 绑定。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-11T14:55:35.687

LispWorks 带有 CAPI，它可以跨 Mac、Windows 和 Linux 移植，甚至还有一些 GUI-Builder。它是免费供个人使用的。

# security - 检测 DOS（拒绝服务）攻击的最佳实践？

> ID：108088
> 
> 赞同：18
> 
> 时间：2008-09-20T13:02:13.453
> 
> 标签：security, denial-of-service

我正在寻找在服务实现（不是外部网络监控）中检测和防止 DOS 的最佳实践。该服务处理对用户、组和属性信息的查询。

你最喜欢处理 DOS 的信息来源是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-20T13:14:03.393

无论您对 DoS 攻击采取什么措施，请考虑您所做的是否实际上会增加处理恶意或不需要的请求所需的负载！

如果您使用的是 Linux，那么您应该阅读这篇文章：
[基于规则的 DoS 攻击防护 shell 脚本](http://linuxgazette.net/137/takefuji.html)（来自 Linux Gazette）它包含以下主题：

*   如何从 /var/log/secure 文件中检测 DoS 攻击
*   如何从临时文件中减少检测到的多余 IP
*   如何激活 /sbin/iptables
*   如何安装建议的 shell 脚本

在不适当限制 iptables 中被阻止 IP 数量的情况下应用此功能可能会通过增加处理未经请求的请求所需的资源来引入 DoS 漏洞。为了降低这种风险，请使用[ipset](http://ipset.netfilter.org/ipset.man.html)来匹配 iptables 中的 IP 地址。

此外，请阅读有关[使用 iptables 预防 ssh 字典攻击的](http://hostingfu.com/article/ssh-dictionary-attack-prevention-with-iptables)信息。（按照这里的建议启用带有状态防火墙的 iptables 并不能防止大多数 DoS 攻击，但实际上可能会*缓解*DoS 攻击，这些 DoS 攻击会用无用的状态信息污染您的 RAM。）

Linux 新手？阅读[Windows 到 Linux 路线图：第 5 部分](http://www.ibm.com/developerworks/linux/library/l-roadmap5/)。IBM 的 Linux 日志记录。

祝你好运！

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-20T13:04:57.110

这是我发现非常有用的技术..

[防止 Web 应用程序中的拒绝服务 (DOS) 攻击](http://weblogs.asp.net/omarzabir/archive/2007/10/16/prevent-denial-of-service-dos-attacks-in-your-web-application.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-02T20:46:15.840

我第一次尝试解决 DoS 漏洞的尝试使用了 Gulzar 建议的方法，基本上是限制来自同一 IP 地址的调用次数。我认为这是一个很好的方法，但不幸的是，它导致我的代码未能通过性能测试。

由于我无法让性能测试组更改他们的测试（这是一个政治问题，而不是技术问题），我改为限制在可配置的时间间隔内允许的调用次数。我将最大通话次数和时间间隔都设置为可配置的。我还允许设置值 0 或禁用限制的负数。

需要保护的代码被多个产品内部使用。因此，我让每个产品组运行他们的 QA 和性能测试套件，并提出尽可能小的默认值以限制真正的 DoS 攻击，但仍然通过了所有测试。

FWIW，时间间隔为 30 秒，最大调用次数为 100。这不是一个完全令人满意的方法，但它简单实用，得到了公司安全团队的批准（另一个政治考虑）。

# apache-flex - Flex - 保持客户端数据与后端数据库同步的最佳策略？

> ID：108089
> 
> 赞同：7
> 
> 时间：2008-09-20T13:02:49.083
> 
> 标签：apache-flex, remoting, blazeds

在使用 BlazeDS AMF 远程处理的 Adob​​e flex 应用程序中，保持本地数据新鲜并与后端数据库同步的最佳策略是什么？

在典型的 Web 应用程序中，网页每次加载时都会刷新视图，因此视图中的数据永远不会太旧。

在 Flex 应用程序中，倾向于预先加载更多数据以在选项卡、面板等之间共享。这些数据通常不经常从后端刷新，因此它过时的可能性更大 - 导致保存时的问题等

那么，克服这个问题的最佳方法是什么？

一个。像构建 Web 应用程序一样构建 Flex 应用程序 - 在每次可能的视图更改时重新加载后端数据

湾。忽略问题并在发生陈旧数据问题时处理它们（冒着惹恼更有可能使用陈旧数据的用户的风险）

C。别的东西

就我而言，通过 LiveCycle RTMP 保持数据通道打开不是一种选择。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T18:54:33.853

一个。考虑通过自己的通知或轮询的代理来优化后端更改：它知道是否有任何数据是脏的，如果不是，它将快速返回（a la a 304）。

湾。通常，用户看起来比他们触摸的要多。考虑一个级别的刷新查找和另一个当他们开始并继续编辑时。

看看 BuzzWord：它会锁定编辑，但也会经常自动保存和解锁。

干杯

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T12:52:40.797

如果您不能在 BlazeDS 中使用消息传递协议，那么我必须同意您应该通过 HTTP 进行 RTMP 轮询。在 AMF 中使用 RTMP 时会压缩数据，这有助于加快速度，因此客户端在更新之间等待很长时间。如果产品的客户决定为额外的硬件和许可证付费，这也将允许您以后扩展至推送方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T13:38:23.557

您不需要 Livecycle 和 RTMP 来获得通知机制，您可以使用 BlazeDS 的通道并使用流式/长轮询策略

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T13:15:04.747

在过去，我选择了“a”。如果您使用的是远程对象，您可以设置一些缓存样式的逻辑，以使它们在远程端保持同步。

山姆

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T12:39:54.617

您不能使用 RTMP over HTTP（HTTP 轮询）吗？这样你仍然可以使用 RTMP，虽然它比真正的 RTMP 慢得多，但你仍然可以通过这种方式广播更新。

我们有一个应用程序，它使用 RTMP 通过简单地广播包含 Table/PrimaryKey 对的 RTMP 消息来表示插入、更新和删除，让应用程序自动更新它的数据。我们使用 RTMP 在 Http 上执行此操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-02T02:14:47.043

我发现这篇关于同步的文章：

[http://www.databasejournal.com/features/sybase/article.php/3769756/The-Missing-Sync.htm](http://www.databasejournal.com/features/sybase/article.php/3769756/The-Missing-Sync.htm)

它没有涉及技术细节，但您可以猜测哪种编码将实施此策略。

我的服务器也没有花哨的通知，所以我需要同步策略。

例如，我的 modelLocator 中有一个公司列表。它并没有经常改变，它还不足以考虑分页，我不想在每个用户操作上重新加载它（removeAll（）），但我不希望我的应用程序崩溃或更新损坏的数据如果它已从应用程序的另一个实例更新或删除。

我现在所做的是将 SELECT 日期时间保存在 SESSION 中。当我回来刷新数据时，我 SELECT WHERE last_modified>$SESSION['lastLoad']

这样我在加载数据后只修改了行（大部分时间为 0 行）。

显然，您需要在每个 INSERT 和 UPDATE 上更新 last_modified。

对于 DELETE，它更棘手。正如那家伙在他的文章中指出的那样：“我们怎样才能发送一个不再存在的记录”

你需要告诉 flex 它应该删除哪个项目（比如通过 ID），这样你就不能真正在 DELETE 上删除 :)

当用户删除公司时，您改为执行更新：deleted=1 然后在刷新公司时，对于已删除=1 的行，您只需将 ID 发送回 flex 以确保该公司不再在模型中。

最后但并非最不重要的一点是，您需要编写一个函数来清除已删除=1 和 last_modified 早于 ... 3days 或您认为适合您需要的任何行。

好消息是，如果用户错误地删除了一行，它仍在数据库中，您可以在 3 天内将其从真正的删除中保存。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-31T07:25:04.250

与其在 flex 客户端缓存，为什么不在服务器端缓存呢？一些原因，

1）当您在服务器端缓存数据时，它是集中的，您可以确保所有客户端具有相同的数据状态

2）在服务器端有更好的缓存选项，而不是在 flex 上。您也可以有一个 cron 作业，它根据某种频率（比如每 24 小时）刷新一次数据。

3）由于数据缓存在服务器上，不需要每次都从db中获取，与flex的通信会快得多

问候， 光辉

# visual-studio - 在 Visual Studio 中禁用单行复制

> ID：108094
> 
> 赞同：36
> 
> 时间：2008-09-20T13:05:08.173
> 
> 标签：visual-studio, visual-studio-2008, keyboard-shortcuts

无论如何禁用Visual Studio（在我的情况下为2008）具有复制行（上面有文本）的相当烦人的功能，当`CTRL`-`C`被按下并且没有进行选择时光标处于打开状态？

我知道禁用复制空白行的选项。但这也让我发疯。

ETA：我不想自定义键盘快捷键。

ETA-II：我不是在寻找“工具->选项->文本编辑器->所有语言->应用剪切或复制到空白行...”。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-02T01:48:07.447

您可能遇到的真正问题是您使用`CTRL`+进行粘贴`V`。你不小心输入了 `CTRL`+ `C`，最终覆盖了剪贴板上的内容。据我所知，您无法禁用此功能，但是，解决此问题的方法是，您可以多次按++`CTRL`以备份您在 Visual Studio 中复制的内容堆栈。这不仅可以让您恢复最初复制的内容，而且您还会发现++在许多其他情况下非常有用。`SHIFT``V``CTRL``SHIFT``V`

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-03-24T16:48:46.373

如果您不愿意自定义键盘设置，那么`Ctrl`+`C`将始终是 Edit.Copy，如果未选择任何内容，它将复制当前行。如果你不愿意使用 VS 提供的工具来自定义界面，那你就做不到。

但是，以下工作：将此宏分配给`Ctrl`+ `C`：

```
Sub CopyOnlyIfSelection()
    Dim s As String = DTE.ActiveDocument.Selection.Text
    Dim n As Integer = Len(s)
    If n > 0 Then
        DTE.ActiveDocument.Selection.Copy()
    End If
End Sub 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T13:24:25.207

我很确定 2008 年的方式与 2005 年的方式相同......查看关于“自定义键盘快捷键”的本教程（大约下降了 1/3）

[http://msdn.microsoft.com/en-us/library/bb245788(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bb245788(VS.80).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T13:57:30.963

我不相信如果没有某种类型的 3rd 方剪贴板管理器可以做到这一点，它会阻止您用空字符串覆盖剪贴板内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T09:51:29.337

我安装了免费的 SlickEdit 插件，它的 CommandSpy 功能显示`Ctrl`+`C`执行 Edit.Copy，无论您是否突出显示文本。因此，我想您的问题的答案是否定的。

但是，我确实记得当我第一次遇到这个功能时，它让我非常恼火。现在，当我在其他程序中尝试相同的技巧并且没有任何反应时，我依赖它并感到恼火。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-06-01T12:59:36.060

Visual Studio 2019 和 2017 有一个名为 CopyOnlySelection 的扩展：

[https://marketplace.visualstudio.com/items?itemName=KiwiProductions.CopyOnlySelection](https://marketplace.visualstudio.com/items?itemName=KiwiProductions.CopyOnlySelection)

这不会立即解决它，但会添加另一个名为 Edit.CopyOnlySelection 的命令，您可以将其绑定到 Ctrl+C（并从正常的 Edit.Copy 中删除 Ctrl+C）。

# semaphore - VxWorks 如何处理优先级继承？

> ID：108098
> 
> 赞同：1
> 
> 时间：2008-09-20T13:05:56.907
> 
> 标签：semaphore, vxworks

我们有 3 个任务以不同的优先级运行：A (120)、B (110)、C (100)。A 采用带有 Inversion Safe 标志的互斥信号量。任务 B 执行 semTake，这导致任务 A 的优先级提升到 110。稍后，任务 C 执行 semTake。任务 A 的优先级现在是 100。

此时，A 释放信号量，C 抓住它。我们注意到 A 的优先级并没有回到原来的 120 优先级。A 的优先级不应该马上恢复吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T13:17:19.360

理想情况下，当继承的优先级降低时，它将以逐步的方式完成。随着导致优先级提高的每个依赖项被删除，继承的优先级应该下降到剩余的最高依赖项的优先级。
例如：

任务 A（100 增加到 80）有两个互斥锁（X 和 Y），任务 B（pri 90）和任务 C（pri 80）分别待处理。当任务 A 将互斥锁 Y 放弃给任务 C 时，我们可能会期望它的优先级会下降到 90。当它最终将互斥锁 X 放弃给任务 B 时，我们会期望它的优先级会回落到 100。

**优先级继承在 VxWorks 中不是这样工作的。**
它的工作方式取决于您使用的 VxWorks 版本。

**VxWorks 6.0 之前的版本**

优先级保持“提高”，直到锁定互斥信号量的任务放弃其**最后一个**反转安全互斥信号量。

使用上面的示例，当任务 A 将互斥体 Y 放弃给任务 C 时，其优先级保持在 80。在它放弃互斥体 X 给任务 B 后，其优先级将回落到 100（跳过 90）。

让我们将 1 号曲线球加入其中。如果任务 A 在所有这一切进行时锁定了互斥锁 Z，但没有人在 Z 上挂起怎么办？在这种情况下，优先级将保持在 80，直到 Z 被放弃——然后它会回落到 100。

为什么要这样做？
这很简单，在大多数情况下，它已经足够好了。然而，这确实意味着当“曲线球#1”开始发挥作用时，优先级将在更长的时间内保持较高而不是必要的。

**VxWorks 6.0+**

优先级现在保持升高，直到锁定互斥信号量的任务放弃其最后一个*有助于提高优先级的*反转安全互斥。

这种改进避免了“曲线球#1”的问题。它确实有其自身的局限性。例如，如果任务 B 和/或任务 C 在等待任务 A 放弃信号量时超时，则任务 A 的优先级不会重新计算，直到它放弃信号量。

# c# - 如何将 System.Type 转换为其可为空的版本？

> ID：108104
> 
> 赞同：82
> 
> 时间：2008-09-20T13:08:11.613
> 
> 标签：c#, .net

再次其中之一：“有没有一种更简单的内置方法来代替我的辅助方法？”

所以很容易从可空类型中获取底层类型，但是如何获取 .NET 类型的可空版本呢？

所以我有

```
typeof(int)
typeof(DateTime)
System.Type t = something; 
```

而且我要

```
int? 
DateTime? 
```

或者

```
Nullable<int> (which is the same)
if (t is primitive) then Nullable<T> else just T 
```

有内置方法吗？

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2008-09-20T13:15:32.857

这是我使用的代码：

```
Type GetNullableType(Type type) {
    // Use Nullable.GetUnderlyingType() to remove the Nullable<T> wrapper if type is already nullable.
    type = Nullable.GetUnderlyingType(type) ?? type; // avoid type becoming null
    if (type.IsValueType)
        return typeof(Nullable<>).MakeGenericType(type);
    else
        return type;
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2011-10-13T19:34:10.183

我在我的实用程序库中编写了一些我非常依赖的方法。第一个是将任何类型转换为其对应的 Nullable<Type> 形式的方法：

```
 /// <summary>
    /// [ <c>public static Type GetNullableType(Type TypeToConvert)</c> ]
    /// <para></para>
    /// Convert any Type to its Nullable&lt;T&gt; form, if possible
    /// </summary>
    /// <param name="TypeToConvert">The Type to convert</param>
    /// <returns>
    /// The Nullable&lt;T&gt; converted from the original type, the original type if it was already nullable, or null 
    /// if either <paramref name="TypeToConvert"/> could not be converted or if it was null.
    /// </returns>
    /// <remarks>
    /// To qualify to be converted to a nullable form, <paramref name="TypeToConvert"/> must contain a non-nullable value 
    /// type other than System.Void.  Otherwise, this method will return a null.
    /// </remarks>
    /// <seealso cref="Nullable&lt;T&gt;"/>
    public static Type GetNullableType(Type TypeToConvert)
    {
        // Abort if no type supplied
        if (TypeToConvert == null)
            return null;

        // If the given type is already nullable, just return it
        if (IsTypeNullable(TypeToConvert))
            return TypeToConvert;

        // If the type is a ValueType and is not System.Void, convert it to a Nullable<Type>
        if (TypeToConvert.IsValueType && TypeToConvert != typeof(void))
            return typeof(Nullable<>).MakeGenericType(TypeToConvert);

        // Done - no conversion
        return null;
    } 
```

第二种方法只是报告给定类型是否可以为空。此方法由第一个调用，单独使用：

```
 /// <summary>
    /// [ <c>public static bool IsTypeNullable(Type TypeToTest)</c> ]
    /// <para></para>
    /// Reports whether a given Type is nullable (Nullable&lt; Type &gt;)
    /// </summary>
    /// <param name="TypeToTest">The Type to test</param>
    /// <returns>
    /// true = The given Type is a Nullable&lt; Type &gt;; false = The type is not nullable, or <paramref name="TypeToTest"/> 
    /// is null.
    /// </returns>
    /// <remarks>
    /// This method tests <paramref name="TypeToTest"/> and reports whether it is nullable (i.e. whether it is either a 
    /// reference type or a form of the generic Nullable&lt; T &gt; type).
    /// </remarks>
    /// <seealso cref="GetNullableType"/>
    public static bool IsTypeNullable(Type TypeToTest)
    {
        // Abort if no type supplied
        if (TypeToTest == null)
            return false;

        // If this is not a value type, it is a reference type, so it is automatically nullable
        //  (NOTE: All forms of Nullable<T> are value types)
        if (!TypeToTest.IsValueType)
            return true;

        // Report whether TypeToTest is a form of the Nullable<> type
        return TypeToTest.IsGenericType && TypeToTest.GetGenericTypeDefinition() == typeof(Nullable<>);
    } 
```

上面的 IsTypeNullable 实现每次都像冠军一样工作，但在最后一行代码中它有点冗长和缓慢。下面的代码体与上面的 IsTypeNullable 相同，只是最后一行代码更简单、更快：

```
 // Abort if no type supplied
        if (TypeToTest == null)
            return false;

        // If this is not a value type, it is a reference type, so it is automatically nullable
        //  (NOTE: All forms of Nullable<T> are value types)
        if (!TypeToTest.IsValueType)
            return true;

        // Report whether an underlying Type exists (if it does, TypeToTest is a nullable Type)
        return Nullable.GetUnderlyingType(TypeToTest) != null; 
```

享受！

标记

PS - 关于“可空性”

我应该重复我在另一篇文章中关于可空性的声明，该声明直接适用于正确解决该主题。也就是说，我认为这里讨论的重点不应该是如何检查一个对象是否是一个泛型的 Nullable 类型，而是是否可以将 null 值赋给该类型的对象。换句话说，我认为我们应该确定一个对象类型是否可以为空，而不是它是否可以为空。区别在于语义，即确定可空性的实际原因，这通常是最重要的。

在使用对象的类型在运行时可能未知的系统中（Web 服务、远程调用、数据库、提要等），一个常见的要求是确定是否可以将空值分配给对象，或者对象是否可能包含一个空值。对不可为空的类型执行此类操作可能会产生错误，通常是异常，这在性能和编码要求方面都非常昂贵。为了采取主动避免此类问题的首选方法，有必要确定任意类型的对象是否能够包含空值；即，它是否通常是“可空的”。

在非常实际和典型的意义上，.NET 术语中的可空性并不一定意味着对象的 Type 是 Nullable 的一种形式。事实上，在很多情况下，对象都有引用类型，可以包含空值，因此都是可以为空的；这些都没有 Nullable 类型。因此，在大多数情况下，出于实际目的，应针对可空性的一般概念进行测试，而不是可空性的依赖于实现的概念。因此，我们不应仅仅关注 .NET Nullable 类型，而是将我们对其要求和行为的理解融入到关注可空性的一般实用概念的过程中。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-03-18T22:09:05.533

莱曼的回答很好，对我有所帮助，但是，还有一个错误需要修复。

`Nullable.GetUnderlyingType(type)`仅当类型还不是`Nullable`类型时才应调用。`System.RuntimeType`否则，当类型派生自（例如当我传入时）时，它似乎错误地返回 null `typeof(System.Int32)`。`Nullable.GetUnderlyingType(type)`以下版本通过检查类型是否改为来避免需要调用`Nullable`。

下面你会发现`ExtensionMethod`这个方法的一个版本，它会立即返回类型*，除非*它是一个`ValueType`that's not already `Nullable`。

```
Type NullableVersion(this Type sourceType)
{
    if(sourceType == null)
    {
        // Throw System.ArgumentNullException or return null, your preference
    }
    else if(sourceType == typeof(void))
    { // Special Handling - known cases where Exceptions would be thrown
        return null; // There is no Nullable version of void
    }

    return !sourceType.IsValueType
            || (sourceType.IsGenericType
               && sourceType.GetGenericTypeDefinition() == typeof(Nullable<>) )
        ? sourceType
        : typeof(Nullable<>).MakeGenericType(sourceType);
} 
```

（对不起，我不能简单地对莱曼的回答发表评论，因为我是新手，还没有足够的代表。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T13:18:29.577

我所知道的没有任何内置的东西，因为`int?`等只是 ; 的语法糖`Nullable<T>`。并且除此之外没有给予特殊待遇。鉴于您试图从给定类型的类型信息中获取此信息，这尤其不可能。通常，这总是需要一些“滚动你自己的”代码作为给定的。您必须使用反射来创建具有`Nullable`输入类型的类型参数的新类型。

**编辑：**正如评论所暗示的，实际上`Nullable<>` *是*经过特殊处理的，并在运行时启动，如[本文所述](http://blogs.msdn.com/somasegar/archive/2005/08/11/450640.aspx)。

# dependency-injection - MEF（托管可扩展性框架）与 IoC/DI

> ID：108116
> 
> 赞同：56
> 
> 时间：2008-09-20T13:12:08.310
> 
> 标签：dependency-injection, inversion-of-control, mef

MEF（Managed Extensibility Framework）解决了哪些现有IoC/DI容器无法解决的问题？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-09-26T14:24:14.740

MEF 的主要目的是可扩展性；*当应用程序的作者和插件（扩展）的作者不同并且除了发布的接口（**合同*）库之外彼此没有特定的知识时，用作“插件”框架。

另一个与通常的 IoC 嫌疑人不同的 MEF 解决的问题空间，也是 MEF 的优势之一，是 [扩展] 发现。它有很多很好的可扩展发现机制，可以对可以与扩展关联的元数据进行操作。从 MEF CodePlex 网站：

*“MEF 允许使用附加元数据标记扩展，这有助于丰富的查询和过滤”*

结合延迟加载标记扩展的能力，能够在加载*之前*询问扩展元数据为一系列有趣的场景打开了大门，并大大启用了诸如 [插件] 版本控制之类的功能。

MEF 还具有“合同适配器”，它允许对扩展进行“适应”或“转换”（*从 type > 到 type*），并完全控制这些转换的细节。合同适配器开辟了另一个与“发现”的含义和含义相关的创造性前沿。

同样，MEF 的“意图”非常关注匿名插件的可扩展性，这与其他 IoC 容器有很大不同。因此，虽然 MEF 可用于组合，但与其他 IoC 相比，这只是其功能的一小部分，我怀疑未来我们会看到很多乱伦的相互作用。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-16T08:21:30.497

IoC 容器专注于你知道的那些事情，即我知道我将在单元测试中使用一个记录器，并在我的应用程序中使用不同的记录器。MEF 专注于那些你不关注的事情，我的系统中可能会出现 1 到 n 个记录器。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-01T08:05:09.960

Scott Hanselman 和我在最近的 hanselminutes 中更详细地讨论了这个主题。

[http://www.hanselminutes.com/default.aspx?showID=166](http://www.hanselminutes.com/default.aspx?showID=166)

# python - 如何使用 Python 将粗体样式应用于 Excel 文件中的特定单词？

> ID：108134
> 
> 赞同：4
> 
> 时间：2008-09-20T13:20:50.787
> 
> 标签：python, excel, xlwt, pyexcelerator

我正在使用`pyexcelerator`Python 模块生成 Excel 文件。我想将粗体样式应用于部分单元格文本，而不是整个单元格。怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T23:10:13.863

在此处找到示例：[在 Python 中生成 Excel 格式的文件](http://www.answermysearches.com/generate-an-excel-formatted-file-right-in-python/122/)

请注意，您创建了一个字体对象，然后将其提供给样式对象，然后在写入工作表时提供该样式对象：

```
import pyExcelerator as xl

def save_in_excel(headers,values):
    #Open new workbook
    mydoc=xl.Workbook()
    #Add a worksheet
    mysheet=mydoc.add_sheet("test")
    #write headers
    header_font=xl.Font() #make a font object
    header_font.bold=True
    header_font.underline=True
    #font needs to be style actually
    header_style = xl.XFStyle(); header_style.font = header_font
    for col,value in enumerate(headers):
        mysheet.write(0,col,value,header_style)
    #write values and highlight those that match my criteria
    highlighted_row_font=xl.Font() #no real highlighting available?
    highlighted_row_font.bold=True
    highlighted_row_font.colour_index=2 #2 is red,
    highlighted_row_style = xl.XFStyle(); highlighted_row_style.font = highlighted_row_font
    for row_num,row_values in enumerate(values):
        row_num+=1 #start at row 1
        if row_values[1]=='Manatee':
            for col,value in enumerate(row_values):
                #make Manatee's (sp) red
                mysheet.write(row_num,col,value,highlighted_row_style)
        else:
            for col,value in enumerate(row_values):
                #normal row
                mysheet.write(row_num,col,value)
    #save file
    mydoc.save(r'C:testpyexel.xlt')

headers=['Date','Name','Localatity']
data=[
['June 11, 2006','Greg','San Jose'],
['June 11, 2006','Greg','San Jose'],
['June 11, 2006','Greg','San Jose'],
['June 11, 2006','Greg','San Jose'],
['June 11, 2006','Manatee','San Jose'],
['June 11, 2006','Greg','San Jose'],
['June 11, 2006','Manatee','San Jose'],
]

save_in_excel(headers,data) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T13:54:04.827

这是 Excel 文档中的一个示例：

```
With Worksheets("Sheet1").Range("B1")
    .Value = "New Title"
    .Characters(5, 5).Font.Bold = True
End With 
```

因此，您要操作的单元格的 Characters 属性就是您问题的答案。它用作字符（*开始*，*长度*）。

PS：我从未使用过有问题的模块，但我在 python 脚本中使用了 Excel COM 自动化。Characters 属性可使用 win32com 使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-02-17T16:36:40.270

这是我用于相同问题的一种解决方案。

```
 import xlsxwriter
    workbook = xlsxwriter.Workbook(r'C:\workspace\NMSAutomation_001\FMGGUIAutomation\Libraries\Frontend\new_STICKERS_Final.xlsx')
####### two different formats
    bold   = workbook.add_format({'font_name':'Tahoma', 'bold': True, 'font_size':14})
    normal = workbook.add_format({'font_name':'Tahoma', 'font_size':11})

######## value is my string, bold and normal are my two different formats
    segments = [bold, value[:9], normal, value[9:]]
    worksheet.write_rich_string('A1', *segments) # 'A1' is cell position
    workbook.close() 
```

# installshield - InstallShield：ISComponentExtended 表的FilterProperty 列？

> ID：108135
> 
> 赞同：3
> 
> 时间：2008-09-20T13:21:10.257
> 
> 标签：installshield

任何人都知道此自定义表的用途以及该列的具体含义是什么？文档对此保持沉默，网络上的信息很少。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-02-12T14:18:37.887

我正在尝试对我的 InstallShield 项目做同样的事情。您是否已成功弄清楚如何在 ISComponentExtended 表的 FilterProperty 列中生成值？

非常感谢！

查尔斯

* * *

## 更新：

FilterProperty 只是一个 GUID 字符串，所有“-”都替换为“ `_`”，以“_”开头，以“_FILTER”结尾。我写了一个简单的工具来将我的文件导入到项目中，并且项目编译得很好。

# html - 替换html中文件浏览按钮的最佳方法是什么？

> ID：108149
> 
> 赞同：18
> 
> 时间：2008-09-20T13:30:35.833
> 
> 标签：html, css, file, input

我知道当您使用`input`带有`type="file`.

我不确定什么是最好的方法，所以如果有人有这方面的经验，请贡献。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-20T13:33:37.370

最好的方法是使文件输入控件**几乎**不可见（通过给它一个非常低的不透明度 - 不要做“**可见性：隐藏**”或“**显示：无**”）并绝对定位它下面的东西 - 具有较低的**z-index**。

这样，实际控件将不可见，并且您在其下放置的任何内容都会显示出来。但是由于控件位于该按钮上方，它仍然会捕获单击事件（这就是您要使用不透明度，而不是可见性或显示的原因 - 如果您使用它们来隐藏它，浏览器会使元素不可点击）。

[本文](http://www.shauninman.com/archive/2007/09/10/styling_file_inputs_with_css_and_the_dom)深入探讨了这项技术。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T13:39:23.627

浏览器不喜欢你乱用文件输入，但可以这样做。我见过一些技术，但最简单的方法是将文件输入绝对定位在您想用作按钮的任何内容上，并将其不透明度设置为零或接近零。这意味着当用户单击图像（或您在其中的任何内容）时，他们实际上是在单击不可见的浏览按钮。

例如：

```
<input type="file" id="fileInput">
<img src="..."> 
```

```
#fileInput{
    position: absolute;
    opacity: 0;
    -moz-opacity: 0;
    filter: alpha(opacity=0);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T13:40:40.490

如果您不介意使用 javascript，您可以将文件输入的不透明度设置为 0，通过 z-index 将样式控件放在顶部，然后将按钮的点击事件发送到文件输入。有关技术，请参见此处：[http ://www.quirksmode.org/dom/inputfile.html](http://www.quirksmode.org/dom/inputfile.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T13:38:01.370

出于安全目的，这在技术上是不可能的，因此不会误导用户。

但是，有几种解决方法 - 以[http://www.quirksmode.org/dom/inputfile.html](http://www.quirksmode.org/dom/inputfile.html)为例。

作为记录，这个问题已经在[这里](https://stackoverflow.com/questions/94316/how-to-change-the-text-of-the-browse-button-in-the-fileupload-control-systemweb)被问过（我给出了相同的答案）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T13:43:27.707

您也可以使用诸如[SWFupload 之](http://swfupload.org/)类的 Flash 上传器来执行此操作。

# lisp - 如何在方案中获取列表的一部分（A 子列表）？

> ID：108169
> 
> 赞同：16
> 
> 时间：2008-09-20T13:36:52.200
> 
> 标签：lisp, scheme

给定一个列表，我将如何选择一个新列表，其中包含原始列表的一部分（给定偏移量和元素数量）？

### 编辑：

到目前为止的好建议。SRFI 中没有指定内容吗？这似乎是一个非常基本的事情，所以我很惊讶我需要在用户领域实现它。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T16:02:01.357

奇怪的是， [SRFI-1](http://srfi.schemers.org/srfi-1/srfi-1.html)`slice`没有提供，但您可以通过使用 SRFI-1[和](http://srfi.schemers.org/srfi-1/srfi-1.html#take)来缩短它：[`take``drop`](http://srfi.schemers.org/srfi-1/srfi-1.html#take)

```
(define (slice l offset n)
  (take (drop l offset) n)) 
```

我认为我在 Scheme 中使用的其中一个扩展，如 PLT Scheme 库或 Swindle，会内置此功能，但似乎并非如此。它甚至没有在新的 R6RS 库中定义。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-20T14:08:40.547

以下代码将执行您想要的操作：

```
(define get-n-items
    (lambda (lst num)
        (if (> num 0)
            (cons (car lst) (get-n-items (cdr lst) (- num 1)))
            '()))) ;'

(define slice
    (lambda (lst start count)
        (if (> start 1)
            (slice (cdr lst) (- start 1) count)
            (get-n-items lst count)))) 
```

例子：

```
> (define l '(2 3 4 5 6 7 8 9)) ;'
()
> l
(2 3 4 5 6 7 8 9)
> (slice l 2 4)
(3 4 5 6)
> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-22T18:04:29.510

你可以试试这个功能：

> **subseq** *序列开始和可选结束*

*start*参数是您的偏移量。只需添加 start + number-of-elements 即可轻松将 end 参数转换为要抓取的元素数*。*

一个小的好处是**subseq**适用于所有序列，这不仅包括列表，还包括字符串和向量。

编辑：似乎并非所有 lisp 实现都有 subseq，但如果你有它，它会很好地完成工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T14:17:36.500

```
(define (sublist list start number)
  (cond ((> start 0) (sublist (cdr list) (- start 1) number))
        ((> number 0) (cons (car list)
                      (sublist (cdr list) 0 (- number 1))))
        (else '()))) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-02-21T09:33:28.310

这是我`slice`使用正确尾调用的实现

```
(define (slice a b xs (ys null))
  (cond ((> a 0) (slice (- a 1) b (cdr xs) ys))
        ((> b 0) (slice a (- b 1) (cdr xs) (cons (car xs) ys)))
        (else (reverse ys))))

(slice 0 3 '(A B C D E F G)) ;=> '(A B C)
(slice 2 4 '(A B C D E F G)) ;=> '(C D E F) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T14:17:39.730

尝试这样的事情：

```
 (define (slice l offset length)
      (if (null? l)
        l
        (if (> offset 0)
            (slice (cdr l) (- offset 1) length)
            (if (> length 0)
                (cons (car l) (slice (cdr l) 0 (- length 1)))
                '())))) 
```

# java - Hibernate 3：无法查询 PostgreSQL 数据库

> ID：108171
> 
> 赞同：4
> 
> 时间：2008-09-20T13:38:06.033
> 
> 标签：java, database, hibernate, postgresql, jdbc

我正在使用`Hibernate 3.3.1 GA`and设置一个项目`PostgreSQL 8.3`。我刚刚创建了一个数据库，第一个表，在那里添加了一行，现在正在配置 Hibernate。

但是，即使是最简单的查询：

```
Criteria criteria = session.createCriteria(Place.class);
List result = criteria.list(); 
```

无法执行（尽管数据库中有一条记录，但返回空列表）。我查看了 PostgreSQL 日志以查看：

```
2008-09-17 22:52:59 CEST LOG:  connection received: host=192.168.175.1 port=2670  
2008-09-17 22:52:59 CEST LOG:  connection authorized: user=... database=...  
2008-09-17 22:53:00 CEST LOG:  execute <unnamed>: SHOW TRANSACTION ISOLATION LEVEL  
2008-09-17 22:53:02 CEST LOG:  could not receive data from client: Connection reset by peer  
2008-09-17 22:53:02 CEST LOG:  unexpected EOF on client connection  
2008-09-17 22:53:02 CEST LOG:  disconnection: session time: 0:00:03.011 user=... database=... host=192.168.175.1 port=2670 
```

我使用纯 JDBC 编写了一个简单的程序来获取相同的数据，并且它工作正常。这种情况下的 PostgreSQL 日志如下所示（用于比较）：

```
2008-09-17 22:52:24 CEST LOG:  connection received: host=192.168.175.1 port=2668  
2008-09-17 22:52:24 CEST LOG:  connection authorized: user=... database=...  
2008-09-17 22:52:25 CEST LOG:  execute <unnamed>: SELECT * from PLACE  
2008-09-17 22:52:25 CEST LOG:  disconnection: session time: 0:00:00.456 user=... database=... host=192.168.175.1 port=2668 
```

Hibernate 调试日志不指示任何错误。如果我采用日志中列出的查询：

```
15:17:01,859 DEBUG org.hibernate.loader.entity.EntityLoader：静态选择实体 com.example.data.Place：选择 place0_.ID 作为 ID0_0_，place0_.NAME 作为 NAME0_0_，place0_.LATITUDE 作为 LATITUDE0_0_，place0_.LONGITUDE作为 LONGITUDE0_0_ 从 PLACE place0_ where place0_.ID=?

```

并在 psql 中再次执行数据库，它可以工作（这意味着 Hibernate 已经生成了正确的 SQL）。

下面是休眠配置：

```
<hibernate-configuration>
    <session-factory>
        <property name="hibernate.connection.url">jdbc:postgresql://192.168.175.128:5433/...</property>
        <property name="hibernate.connection.driver_class">org.postgresql.Driver</property>
        <property name="hibernate.connection.username">...</property>
        <property name="hibernate.connection.password">...</property>
        <property name="dialect">org.hibernate.dialect.PostgreSQLDialect</property>
        <property name="hibernate.show_sql">true</property>
        <property name="hibernate.use_outer_join">true</property>

        <mapping resource="com/example/data/Place.hbm.xml"/>
    </session-factory>
</hibernate-configuration> 
```

...和映射文件：

```
<hibernate-mapping package="com.example.data">
    <class name="com.example.data.Place" table="PLACE">
        <id column="ID" name="id" type="java.lang.Integer">
            <generator class="native"/>
        </id>
        <property column="NAME" name="name" not-null="true" type="java.lang.String">
            <meta attribute="use-in-tostring">true</meta>
        </property>
        <property column="LATITUDE" name="latitude" not-null="true" type="java.lang.Float">
            <meta attribute="use-in-tostring">true</meta>
        </property>
        <property column="LONGITUDE" name="longitude" not-null="true" type="java.lang.Float">
            <meta attribute="use-in-tostring">true</meta>
        </property>
    </class>
</hibernate-mapping> 
```

谷歌搜索`unexpected EOF`日志条目并不有趣。任何想法，社区？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T14:13:04.373

将调试器应用于 Hibernate 代码后，它已修复！

它在问题的文本中不可见，但问题是`Place`传递给该`createCriteria()`方法的是来自另一个包，而不是`com/example/data`配置 XML 文件中指定的包。

Hibernate 调用`Class.isAssignableFrom()`，如果返回 false ，它会静默退出，从而中断连接。我会在这件事上为 Hibernate 开发者开一张票。

# c - 如何防止 SIGPIPE（或正确处理）

> ID：108183
> 
> 赞同：281
> 
> 时间：2008-09-20T13:43:21.013
> 
> 标签：c, io, signals, broken-pipe, sigpipe

我有一个小型服务器程序，它接受 TCP 或本地 UNIX 套接字上的连接，读取一个简单的命令并（取决于命令）发送回复。

问题是客户可能对答案不感兴趣，有时会提前退出。因此，写入该套接字将导致 a`SIGPIPE`并使我的服务器崩溃。

在这里防止崩溃的最佳做法是什么？有没有办法检查线路的另一端是否仍在阅读？（`select()`似乎在这里不起作用，因为它总是说套接字是可写的）。还是我应该`SIGPIPE`用处理程序捕获并忽略它？

* * *

## 回答 #1

> 赞同：281
> 
> 时间：2008-09-20T13:46:21.210

您通常希望忽略`SIGPIPE`并直接在代码中处理错误。这是因为 C 中的信号处理程序对它们的功能有很多限制。

最便携的方法是将`SIGPIPE`处理程序设置为`SIG_IGN`. 这将防止任何套接字或管道写入导致`SIGPIPE`信号。

要忽略该`SIGPIPE`信号，请使用以下代码：

```
signal(SIGPIPE, SIG_IGN); 
```

如果您正在使用`send()`呼叫，另一种选择是使用该`MSG_NOSIGNAL`选项，这将`SIGPIPE`在每次呼叫的基础上关闭行为。请注意，并非所有操作系统都支持该`MSG_NOSIGNAL`标志。

最后，您可能还需要考虑`SO_SIGNOPIPE`可以`setsockopt()`在某些操作系统上设置的套接字标志。这将防止`SIGPIPE`仅由对其设置的套接字的写入引起。

* * *

## 回答 #2

> 赞同：159
> 
> 时间：2009-01-16T11:25:00.997

另一种方法是更改​​套接字，使其永远不会在 write() 上生成 SIGPIPE。这在库中更方便，您可能不需要 SIGPIPE 的全局信号处理程序。

在大多数基于 BSD（MacOS、FreeBSD...）的系统上，（假设您使用的是 C/C++），您可以这样做：

```
int set = 1;
setsockopt(sd, SOL_SOCKET, SO_NOSIGPIPE, (void *)&set, sizeof(int)); 
```

这样一来，将返回 EPIPE，而不是生成 SIGPIPE 信号。

* * *

## 回答 #3

> 赞同：119
> 
> 时间：2009-11-10T04:58:36.217

我迟到了，但`SO_NOSIGPIPE`不是便携式的，并且可能无法在您的系统上运行（这似乎是 BSD 的东西）。

如果你在一个没有的 Linux 系统上，一个不错的选择是在你的 send(2) 调用上`SO_NOSIGPIPE`设置`MSG_NOSIGNAL`标志。

`write(...)`替换为的示例`send(...,MSG_NOSIGNAL)`（参见[nobar](https://stackoverflow.com/users/86967/nobar)的评论）

```
char buf[888];
//write( sockfd, buf, sizeof(buf) );
send(    sockfd, buf, sizeof(buf), MSG_NOSIGNAL ); 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2010-02-27T15:30:57.683

在这篇[文章](http://krokisplace.blogspot.com/2010/02/suppressing-sigpipe-in-library.html)中，我描述了当 SO_NOSIGPIPE 和 MSG_NOSIGNAL 都不可用时 Solaris 情况的可能解决方案。

> 相反，我们必须在当前执行库代码的线程中暂时抑制 SIGPIPE。下面是如何做到这一点：为了抑制 SIGPIPE，我们首先检查它是否处于挂起状态。如果是这样，这意味着它被阻塞在这个线程中，我们不必做任何事情。如果库生成额外的 SIGPIPE，它将与待处理的合并，这是一个空操作。如果 SIGPIPE 没有挂起，那么我们在这个线程中阻塞它，并检查它是否已经被阻塞。然后我们可以自由地执行我们的写入。当我们要将 SIGPIPE 恢复到其原始状态时，我们执行以下操作：如果 SIGPIPE 最初处于挂起状态，我们什么也不做。否则，我们检查它现在是否处于挂起状态。如果是这样（这意味着 out 操作已经生成了一个或多个 SIGPIPE），那么我们在这个线程中等待它，从而清除其挂起状态（为此，我们使用零超时的 sigtimedwait()；这是为了避免在恶意用户手动向整个进程发送 SIGPIPE 的情况下阻塞：在这种情况下，我们将看到它挂起，但其他线程可能在我们有更改等待它之前处理它）。在清除挂起状态后，我们在这个线程中解除阻塞 SIGPIPE，但前提是它最初没有被阻塞。

示例代码位于[https://github.com/kroki/XProbes/blob/1447f3d93b6dbf273919af15e59f35cca58fcc23/src/libxprobes.c#L156](https://github.com/kroki/XProbes/blob/1447f3d93b6dbf273919af15e59f35cca58fcc23/src/libxprobes.c#L156)

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2012-01-27T16:04:09.180

## 本地处理 SIGPIPE

通常最好在本地而不是在全局信号事件处理程序中处理错误，因为在本地您将有更多关于正在发生的事情和采取什么追索权的上下文。

我的一个应用程序中有一个通信层，允许我的应用程序与外部附件通信。当发生写入错误时，我在通信层中抛出异常并让它冒泡到 try catch 块以在那里处理它。

## 代码：

忽略 SIGPIPE 信号以便您可以在本地处理它的代码是：

```
// We expect write failures to occur but we want to handle them where 
// the error occurs rather than in a SIGPIPE handler.
signal(SIGPIPE, SIG_IGN); 
```

此代码将阻止 SIGPIPE 信号被引发，但在尝试使用套接字时会出现读/写错误，因此您需要进行检查。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-09-20T14:45:34.733

您无法阻止管道远端的进程退出，如果它在您完成写入之前退出，您将收到一个 SIGPIPE 信号。如果您 SIG_IGN 信号，那么您的写入将返回一个错误 - 您需要注意并对该错误做出反应。仅仅在处理程序中捕获和忽略信号并不是一个好主意——您必须注意管道现在已经失效并修改程序的行为，以便它不会再次写入管道（因为信号将再次生成，并被忽略再次，你会再试一次，整个过程可能会持续*很长时间*，并且会浪费大量的 CPU 资源）。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-20T13:45:23.893

> 还是我应该用处理程序捕获 SIGPIPE 并忽略它？

我相信这是正确的。您想知道另一端何时关闭了他们的描述符，这就是 SIGPIPE 告诉您的。

山姆

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-02-12T02:57:53.377

在现代 POSIX 系统（即 Linux）下，您可以使用该`sigprocmask()`功能。

```
#include <signal.h>

void block_signal(int signal_to_block /* i.e. SIGPIPE */ )
{
    sigset_t set;
    sigset_t old_state;

    // get the current state
    //
    sigprocmask(SIG_BLOCK, NULL, &old_state);

    // add signal_to_block to that existing state
    //
    set = old_state;
    sigaddset(&set, signal_to_block);

    // block that signal also
    //
    sigprocmask(SIG_BLOCK, &set, NULL);

    // ... deal with old_state if required ...
} 
```

如果您想稍后恢复以前的状态，请确保将其保存在`old_state`安全的地方。如果您多次调用该函数，则需要使用堆栈或仅保存第一个或最后一个`old_state`......或者可能有一个删除特定阻塞信号的函数。

有关更多信息，请阅读[手册页](http://linux.die.net/man/2/sigprocmask)。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-09-15T23:57:28.827

> 在这里防止崩溃的最佳做法是什么？

要么按每个人禁用 sigpipe，要么捕获并忽略错误。

> 有没有办法检查线路的另一端是否仍在阅读？

是的，使用 select()。

> select() 似乎在这里不起作用，因为它总是说套接字是可写的。

您需要在*读取*位上进行选择。您可能可以忽略*写入*位。

当远端关闭其文件句柄时，select 将告诉您有数据可供读取。当你去读它时，你会得到 0 个字节，这就是操作系统告诉你文件句柄已关闭的方式。

唯一不能忽略写入位的情况是，如果您要发送大量数据，并且另一端存在积压的风险，这可能会导致您的缓冲区被填满。如果发生这种情况，那么尝试写入文件句柄可能会导致您的程序/线程阻塞或失败。在写入之前测试 select 可以保护您免受这种情况的影响，但它不能保证另一端是健康的或者您的数据将会到达。

请注意，您可以从 close() 以及编写时获取 sigpipe。

关闭刷新所有缓冲数据。如果另一端已经关闭，则关闭将失败，您将收到一个 sigpipe。

如果您使用的是缓冲 TCPIP，则成功写入仅意味着您的数据已排队等待发送，并不意味着已发送。在您成功调用 close 之前，您不知道您的数据已经发送。

Sigpipe 会告诉您出现了问题，但不会告诉您发生了什么，或者您应该怎么做。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-03-26T14:31:27.910

Linux手册说：

> EPIPE 本地端已在面向连接的套接字上关闭。在这种情况下，除非设置了 MSG_NOSIGNAL，否则进程也会收到 SIGPIPE。

但是对于 Ubuntu 12.04 是不对的。我为那个案例写了一个测试，我总是收到没有 SIGPIPE 的 EPIPE。如果我第二次尝试写入同一个损坏的套接字，则会生成 SIGPIPE。因此，如果发生此信号，您​​无需忽略 SIGPIPE，这意味着您的程序中存在逻辑错误。

# python - Django中的联合和相交

> ID：108193
> 
> 赞同：32
> 
> 时间：2008-09-20T13:46:52.487
> 
> 标签：python, django, django-models, django-views, tagging

```
class Tag(models.Model):
  name = models.CharField(maxlength=100)

class Blog(models.Model):
  name = models.CharField(maxlength=100)
  tags =  models.ManyToManyField(Tag) 
```

简单的模型只是为了问我的问题。

我想知道如何以两种不同的方式使用标签查询博客。

*   带有“tag1”或“tag2”标签的博客条目： `Blog.objects.filter(tags_in=[1,2]).distinct()`
*   用“tag1”和“tag2”标记的博客对象：**？**
*   完全用“tag1”和“tag2”标记的博客对象，没有别的：**??**

* * *

标记和博客仅用于示例。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-20T15:01:12.527

您可以将 Q 对象用于#1：

```
# Blogs who have either hockey or django tags.
from django.db.models import Q
Blog.objects.filter(
    Q(tags__name__iexact='hockey') | Q(tags__name__iexact='django')
) 
```

我相信联合和交集有点超出了 Django ORM 的范围，但它可以做到这些。以下示例来自一个名为[django-tagging](http://code.google.com/p/django-tagging/)的 Django 应用程序，该应用程序提供了该功能。[models.py 的第 346 行](http://code.google.com/p/django-tagging/source/browse/trunk/tagging/models.py#346)：

对于第二部分，您正在寻找两个查询的联合，基本上

```
def get_union_by_model(self, queryset_or_model, tags):
    """
    Create a ``QuerySet`` containing instances of the specified
    model associated with *any* of the given list of tags.
    """
    tags = get_tag_list(tags)
    tag_count = len(tags)
    queryset, model = get_queryset_and_model(queryset_or_model)

    if not tag_count:
        return model._default_manager.none()

    model_table = qn(model._meta.db_table)
    # This query selects the ids of all objects which have any of
    # the given tags.
    query = """
    SELECT %(model_pk)s
    FROM %(model)s, %(tagged_item)s
    WHERE %(tagged_item)s.content_type_id = %(content_type_id)s
      AND %(tagged_item)s.tag_id IN (%(tag_id_placeholders)s)
      AND %(model_pk)s = %(tagged_item)s.object_id
    GROUP BY %(model_pk)s""" % {
        'model_pk': '%s.%s' % (model_table, qn(model._meta.pk.column)),
        'model': model_table,
        'tagged_item': qn(self.model._meta.db_table),
        'content_type_id': ContentType.objects.get_for_model(model).pk,
        'tag_id_placeholders': ','.join(['%s'] * tag_count),
    }

    cursor = connection.cursor()
    cursor.execute(query, [tag.pk for tag in tags])
    object_ids = [row[0] for row in cursor.fetchall()]
    if len(object_ids) > 0:
        return queryset.filter(pk__in=object_ids)
    else:
        return model._default_manager.none() 
```

对于第 3 部分，我相信您正在寻找一个十字路口。见[models.py 的第 307 行](http://code.google.com/p/django-tagging/source/browse/trunk/tagging/models.py#307)

```
def get_intersection_by_model(self, queryset_or_model, tags):
    """
    Create a ``QuerySet`` containing instances of the specified
    model associated with *all* of the given list of tags.
    """
    tags = get_tag_list(tags)
    tag_count = len(tags)
    queryset, model = get_queryset_and_model(queryset_or_model)

    if not tag_count:
        return model._default_manager.none()

    model_table = qn(model._meta.db_table)
    # This query selects the ids of all objects which have all the
    # given tags.
    query = """
    SELECT %(model_pk)s
    FROM %(model)s, %(tagged_item)s
    WHERE %(tagged_item)s.content_type_id = %(content_type_id)s
      AND %(tagged_item)s.tag_id IN (%(tag_id_placeholders)s)
      AND %(model_pk)s = %(tagged_item)s.object_id
    GROUP BY %(model_pk)s
    HAVING COUNT(%(model_pk)s) = %(tag_count)s""" % {
        'model_pk': '%s.%s' % (model_table, qn(model._meta.pk.column)),
        'model': model_table,
        'tagged_item': qn(self.model._meta.db_table),
        'content_type_id': ContentType.objects.get_for_model(model).pk,
        'tag_id_placeholders': ','.join(['%s'] * tag_count),
        'tag_count': tag_count,
    }

    cursor = connection.cursor()
    cursor.execute(query, [tag.pk for tag in tags])
    object_ids = [row[0] for row in cursor.fetchall()]
    if len(object_ids) > 0:
        return queryset.filter(pk__in=object_ids)
    else:
        return model._default_manager.none() 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-20T15:33:55.333

我已经用 Django 1.0 测试了这些：

“或”查询：

```
Blog.objects.filter(tags__name__in=['tag1', 'tag2']).distinct() 
```

或者你可以使用 Q 类：

```
Blog.objects.filter(Q(tags__name='tag1') | Q(tags__name='tag2')).distinct() 
```

“和”查询：

```
Blog.objects.filter(tags__name='tag1').filter(tags__name='tag2') 
```

我不确定第三个，你可能需要使用 SQL 来完成它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-21T07:03:07.160

请不要重新发明轮子并使用专门为您的用例制作的[django-tagging 应用程序。](http://code.google.com/p/django-tagging/)它可以执行您描述的所有查询，等等。

如果您需要在 Tag 模型中添加自定义字段，还可以查看[我的 django-tagging 分支](http://www.bitbucket.org/zuber/django-newtagging)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-01-05T12:45:41.700

这将为您解决问题

```
Blog.objects.filter(tags__name__in=['tag1', 'tag2']).annotate(tag_matches=models.Count(tags)).filter(tag_matches=2) 
```

# java - 从Java中的邮件日期标头中提取时区的最佳方法？

> ID：108200
> 
> 赞同：6
> 
> 时间：2008-09-20T13:51:27.937
> 
> 标签：java, timezone, jakarta-mail

我需要存储发送电子邮件的时区。从电子邮件的“日期：”标题（RFC822 日期）中提取它的最佳方法是什么？将它存储在数据库中的推荐格式是什么（我使用的是休眠）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T14:05:11.273

使用 JodaTime 解析可能最容易，因为它支持 ISO8601，请参阅[Date and Time Parsing and Formatting in Java with Joda Time](http://johannburkard.de/blog/programming/java/date-time-parsing-formatting-joda-time.html)。

```
DateTimeFormatter parser2 = ISODateTimeFormat.dateTimeNoMillis();
System.out.println(parser2.parseDateTime(your_date_string)); 
```

时间必须始终存储在带有时区的 UTC (GMT) 中 - 即在解析从时区转换为 GMT 并删除夏令时偏移并保存原始时区之后。

转换为 UTC 后，您必须将日期与时区一起存储。

如果您删除或不处理时区，则在处理来自不同时区的数据时会导致问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-27T13:51:05.023

**我建议您使用[Mime4J](http://james.apache.org/mime4j/)。**

该库旨在解析各种电子邮件垃圾。对于解析日期，您将使用它的[DateTimeParser](http://james.apache.org/mime4j/apidocs/org/apache/james/mime4j/field/datetime/parser/DateTimeParser.html)。

```
int zone = new DateTimeParser(new StringReader("Fri, 27 Jul 2012 09:13:15 -0400")).zone(); 
```

之后，我通常将日期时间转换为**[Joda 的 DateTime](http://joda-time.sourceforge.net/)**。不要使用 SimpleDateFormatter，因为它不会涵盖 RFC822 的所有情况。

下面将为您提供优于 Java 的 TZ的**Joda TimeZone （来自上面的 int 区域）。**

```
// Stupid hack in case the zone is not in [-+]zzzz format
final int hours;
final int minutes;
if (zone > 24 || zone < -24 ) {
    hours = zone / 100;
    minutes = minutes = Math.abs(zone % 100);
}
else {
    hours = zone;
    minutes = 0;
}
DateTimeZone.forOffsetHoursMinutes(hours, minutes); 
```

现在唯一的问题是您将获得的时区始终是一个数字时区，它可能仍然不是用户发送电子邮件的正确时区（假设邮件应用程序向用户发送了 TZ 而不仅仅是 UTC）。

例如 -0400 不是 EDT（即 America/New_York），因为它没有考虑夏令时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T13:59:12.877

使用某种子字符串或正则表达式从标题中提取数据。使用 SimpleDateFormatter 解析日期以创建 Date 对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T14:16:32.633

电子邮件中的时区不会显示它是在哪个时区发送的。有些程序使用 UTC 或 GMT。当然时区是日期时间值的一部分，也必须被解析。

你为什么想知道。- 你想规范化时间戳吗？然后使用 DateFormat 对其进行解析。- 你想检测发送电子邮件的用户的时区吗？这将无法正常工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T15:10:05.890

看起来您已经在您的一条评论中提到了这一点，但我认为这是您最好的答案。JavaMail 库包含 RFC822 日期标头解析代码`javax.mail.internet.MailDateFormat`。不幸的是，它没有直接公开 TimeZone 解析，因此您需要直接从 复制必要的代码`javax.mail.internet.MailDateParser`，但值得利用已经完成的仔细工作。

至于存储它，解析器会将日期作为偏移量提供给您，因此您应该能够将其存储为一个`int`（让 Hibernate 为您将其转换为您的数据库）。

# javascript - 如何让 HTML 文本框在空时显示提示？

> ID：108207
> 
> 赞同：225
> 
> 时间：2008-09-20T13:55:10.127
> 
> 标签：javascript, html

我希望网页上的搜索框以灰色斜体显示“搜索”一词。当框获得焦点时，它应该看起来就像一个空文本框。如果其中已经有文本，它应该正常显示文本（黑色，非斜体）。这将帮助我通过删除标签来避免混乱。

顺便说一句，这是一个页面[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)搜索，所以它没有按钮。

* * *

## 回答 #1

> 赞同：382
> 
> 时间：2010-08-31T20:27:30.743

另一种选择是，如果您很高兴仅为较新的浏览器提供此功能，则使用 HTML 5 的**占位符**属性提供的支持：

```
<input name="email" placeholder="Email Address"> 
```

在没有任何样式的情况下，在 Chrome 中这看起来像：

[![在此处输入图像描述](https://i.stack.imgur.com/tZcmY.png)](https://i.stack.imgur.com/tZcmY.png)

[您可以在此处](http://diveintohtml5.info/examples/input-placeholder.html)和*[HTML5 Placeholder Styling with CSS](http://davidwalsh.name/html5-placeholder-css)*中尝试演示。

请务必检查[此功能的浏览器兼容性](http://caniuse.com/#feat=input-placeholder)。对 Firefox 的支持是在 3.7 中添加的。铬很好。Internet Explorer 仅在 10 中添加了支持。如果您的目标浏览器不支持输入占位符，您可以使用名为[jQuery HTML5 Placeholder](https://github.com/mathiasbynens/jquery-placeholder)的 jQuery 插件，然后只需添加以下 JavaScript 代码即可启用它。

```
$('input[placeholder], textarea[placeholder]').placeholder(); 
```

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2008-09-20T14:02:10.017

这就是所谓的文本框水印，它是通过 JavaScript 完成的。

*   [http://naspinski.net/post/Text-Input-Watermarks-using-Javascript-(IE-Compatible).aspx](http://naspinski.net/post/Text-Input-Watermarks-using-Javascript-(IE-Compatible).aspx)

或者如果你使用 jQuery，一个更好的方法：

*   [http://digitalbush.com/projects/watermark-input-plugin/](http://digitalbush.com/projects/watermark-input-plugin/)
*   或[code.google.com/p/jquery-watermark](http://code.google.com/p/jquery-watermark)

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2010-07-21T19:07:27.443

您可以使用 HTML 中的[属性](http://www.whatwg.org/specs/web-apps/current-work/multipage/common-input-element-attributes.html#the-placeholder-attribute)（[浏览器支持）设置](http://caniuse.com/input-placeholder)**占位符**。和可以[用 CSS 更改](http://css-tricks.com/snippets/css/style-placeholder-text/)（尽管浏览器支持有限）。[`placeholder`](http://www.whatwg.org/specs/web-apps/current-work/multipage/common-input-element-attributes.html#the-placeholder-attribute)`font-style``color`

```
input[type=search]::-webkit-input-placeholder { /* Safari, Chrome(, Opera?) */
 color:gray;
 font-style:italic;
}
input[type=search]:-moz-placeholder { /* Firefox 18- */
 color:gray;
 font-style:italic;
}
input[type=search]::-moz-placeholder { /* Firefox 19+ */
 color:gray;
 font-style:italic;
}
input[type=search]:-ms-input-placeholder { /* IE (10+?) */
 color:gray;
 font-style:italic;
}
```

```
<input placeholder="Search" type="search" name="q">
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-09-20T13:58:41.973

您可以添加和删除一个特殊的 CSS 类并使用 JavaScript修改输入值`onfocus`/ ：`onblur`

```
<input type="text" class="hint" value="Search..."
    onfocus="if (this.className=='hint') { this.className = ''; this.value = ''; }"
    onblur="if (this.value == '') { this.className = 'hint'; this.value = 'Search...'; }"> 
```

然后在 CSS 中指定一个带有您想要的样式的**提示类，例如：**

```
input.hint {
    color: grey;
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-20T14:00:27.680

最好的方法是使用某种 JavaScript 库（如[jQuery](http://en.wikipedia.org/wiki/JQuery)或[YUI](http://en.wikipedia.org/wiki/Yahoo!_UI_Library) ）连接您的 JavaScript 事件，并将您的代码放在外部 .js 文件中。

但是，如果您想要一个快速而简单的解决方案，这是您的内联 HTML 解决方案：

```
<input type="text" id="textbox" value="Search"
    onclick="if(this.value=='Search'){this.value=''; this.style.color='#000'}" 
    onblur="if(this.value==''){this.value='Search'; this.style.color='#555'}" /> 
```

**更新**：添加了要求的着色材料。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-06-08T04:10:31.540

不久前，我在我的网站上发布[了一个解决方案。](http://www.drewnoakes.com/code/javascript/hintTextbox.html)要使用它，请导入一个`.js`文件：

```
<script type="text/javascript" src="/hint-textbox.js"></script> 
```

然后用 CSS 类注释你想要提示的任何输入`hintTextbox`：

```
<input type="text" name="email" value="enter email" class="hintTextbox" /> 
```

更多信息和示例可[在此处](http://www.drewnoakes.com/code/javascript/hintTextbox.html)获得。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-20T15:12:10.473

这是一个带有 Google Ajax 库缓存和一些 jQuery 魔法的功能示例。

这将是 CSS：

```
<style type="text/stylesheet" media="screen">
    .inputblank { color:gray; }  /* Class to use for blank input */
</style> 
```

这将是 JavaScript 代码：

```
<script language="javascript"
        type="text/javascript"
        src="http://www.google.com/jsapi">
</script>
<script>
    // Load jQuery
    google.load("jquery", "1");

    google.setOnLoadCallback(function() {
        $("#search_form")
            .submit(function() {
                alert("Submitted. Value= " + $("input:first").val());
                return false;
        });

        $("#keywords")
            .focus(function() {
                if ($(this).val() == 'Search') {
                    $(this)
                    .removeClass('inputblank')
                    .val('');
                }
            })
            .blur(function() {
                if ($(this).val() == '') {
                    $(this)
                    .addClass('inputblank')
                    .val('Search');
                }
            });
    });
</script> 
```

这将是 HTML：

```
<form id="search_form">
    <fieldset>
        <legend>Search the site</legend>
            <label for="keywords">Keywords:</label>
        <input id="keywords" type="text" class="inputblank" value="Search"/>
    </fieldset>
</form> 
```

我希望这足以让您对 GAJAXLibs 和 jQuery 都感兴趣。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-07-29T17:11:13.767

现在变得非常容易。在 html 中，我们可以为*输入*元素提供**placeholder**属性。

 ***例如**

```
<input type="text" name="fst_name" placeholder="First Name"/> 
```

检查更多细节：[http ://www.w3schools.com/tags/att_input_placeholder.asp](http://www.w3schools.com/tags/att_input_placeholder.asp)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-10T16:56:50.567

对于 jQuery 用户：naspinski 的 jQuery 链接似乎坏了，但试试这个： [http ://remysharp.com/2007/01/25/jquery-tutorial-text-box-hints/](http://remysharp.com/2007/01/25/jquery-tutorial-text-box-hints/)

您将获得免费的 jQuery 插件教程作为奖励。:)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-07-07T10:34:06.300

这称为“水印”。

我发现 jQuery 插件*[jQuery watermark](http://plugins.jquery.com/project/jquery-watermark)*与第一个答案不同，它不需要额外的设置（原始答案还需要在提交表单之前进行特殊调用）。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-04-17T12:27:08.830

我发现 jQuery 插件*[jQuery Watermark](http://code.google.com/p/jquery-watermark/)*比最佳答案中列出的要好。为什么更好？因为它支持密码输入字段。`.watermark`此外，设置水印（或其他属性）的颜色就像在 CSS 文件中创建引用一样简单。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-08-25T18:14:40.187

使用[jQuery Form Notifier](http://code.google.com/p/jquery-formnotifier/) - 它是最流行的 jQuery 插件之一，并且不会受到这里其他一些 jQuery 建议的错误的影响（例如，您可以自由设置水印的样式，而不必担心它是否会保存到数据库）。

jQuery Watermark 直接在表单元素上使用单一 CSS 样式（我注意到应用于水印的 CSS font-size 属性也会影响文本框——这不是我想要的）。jQuery Watermark 的优点是您可以将文本拖放到字段中（jQuery Form Notifier 不允许这样做）。

其他人建议的另一个（digitalbrush.com 上的那个）会不小心将水印值提交到您的表单，因此我强烈建议不要这样做。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-20T13:59:49.477

您可以轻松地让一个框读取“搜索”，然后当焦点更改为它时删除文本。像这样的东西：

`<input onfocus="this.value=''" type="text" value="Search" />`

当然，如果你这样做，用户自己的文本会在他们点击时消失。所以你可能想要使用更强大的东西：

```
<input name="keyword_" type="text" size="25"  style="color:#999;" maxlength="128" id="keyword_"
onblur="this.value = this.value || this.defaultValue; this.style.color = '#999';"
onfocus="this.value=''; this.style.color = '#000';"
value="Search Term"> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-20T14:00:31.470

使用背景图像来呈现文本：

```
 input.foo { }
 input.fooempty { background-image: url("blah.png"); } 
```

然后你所要做的就是检测`value == 0`并应用正确的类：

```
 <input class="foo fooempty" value="" type="text" name="bar" /> 
```

jQuery JavaScript 代码如下所示：

```
jQuery(function($)
{
    var target = $("input.foo");
    target.bind("change", function()
    {
        if( target.val().length > 1 )
        {
            target.addClass("fooempty");
        }
        else
        {
            target.removeClass("fooempty");
        }
    });
}); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-20T14:02:00.720

您想将这样的内容分配给 onfocus：

```
if (this.value == this.defaultValue)
    this.value = ''
this.className = '' 
```

这要模糊：

```
if (this.value == '')
    this.value = this.defaultValue
this.className = 'placeholder' 
```

（如果你愿意，你可以使用一些更聪明的东西，比如框架函数，来进行类名切换。）

像这样的一些CSS：

```
input.placeholder{
    color: gray;
    font-style: italic;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-20T14:15:54.883

当页面第一次加载时，让搜索出现在文本框中，如果你想要它是灰色的。

当输入框获得焦点时，选择搜索框中的所有文本，这样用户就可以开始输入，这将删除过程中选择的文本。如果用户想再次使用搜索框，这也将很好地工作，因为他们不必手动突出显示以前的文本来删除它。

```
<input type="text" value="Search" onfocus="this.select();" /> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-01-11T02:48:25.353

我喜欢“知识Chikuse”的解决方案——简单明了。只需要在页面加载准备好时添加一个模糊调用，这将设置初始状态：

```
$('input[value="text"]').blur(); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-05-03T04:24:03.443

我正在使用一个简单的单行 javascript 解决方案，效果很好。这是文本框和文本区域的示例：

```
 <textarea onfocus="if (this.value == 'Text') { this.value = ''; }" onblur="if (this.value == '') { this.value = 'Text'; }">Text</textarea>

    <input type="text" value="Text" onfocus="if (this.value == 'Text') { this.value = ''; }" onblur="if (this.value == '') { this.value = 'Text'; }"> 
```

唯一的“缺点”是在对字段值进行任何操作之前在 $_POST 或 Javascript 验证中进行验证。意思是，检查该字段的值是否不是“文本”。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-11-04T18:12:58.280

* * *

您可以使用名为`placeholder=""` Here's a demo 的属性：

```
<html>
<body>
// try this out!
<input placeholder="This is my placeholder"/>
</body>
</html> 
```

* * *

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-06-04T08:52:30.430

```
$('input[value="text"]').focus(function(){ 
if ($(this).attr('class')=='hint') 
{ 
   $(this).removeClass('hint'); 
   $(this).val(''); 
}
});

$('input[value="text"]').blur(function(){
  if($(this).val() == '')
  {
    $(this).addClass('hint');
    $(this).val($(this).attr('title'));
  } 
});

<input type="text" value="" title="Default Watermark Text"> 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2016-06-07T04:59:26.033

简单的 Html 'required' 标签很有用。

```
<form>
<input type="text" name="test" id="test" required>
<input type="submit" value="enter">
</form> 
```

它指定在提交表单或按下按钮提交之前必须填写输入字段。 [这是示例](https://www.w3schools.com/tags/tryit.asp?filename=tryhtml5_input_required)

* * *

## 回答 #22

> 赞同：-3
> 
> 时间：2008-10-07T02:17:01.170

[来自http://asp.net](http://asp.net)的用户 AJAXToolkit

# sql - 在现有表中添加一列并在 MS SQL Server 上对其进行唯一编号

> ID：108211
> 
> 赞同：126
> 
> 时间：2008-09-20T13:57:14.367
> 
> 标签：sql, sql-server

我想向现有的遗留*数据库添加一**列*并编写一个*过程*，通过该过程我可以为每条记录分配不同的值。像添加一*列*并为其自动生成数据之类的东西。

 ***就像，如果我添加一个名为“ID”（数字）的新*列*，我想为每个记录初始化一个唯一值。因此，我的 ID*列*将包含来自 say 的记录`1 to 1000`。
我怎么做？

* * *

## 回答 #1

> 赞同：231
> 
> 时间：2008-09-20T14:01:09.583

这将取决于数据库，但对于 SQL Server，这可以通过以下方式实现：

```
alter table Example
add NewColumn int identity(1,1) 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-20T14:09:39.217

如果您发布了您正在使用的 SQL 数据库，将会有所帮助。对于 MySQL，您可能需要 auto_increment：

```
ALTER TABLE tableName ADD id MEDIUMINT NOT NULL AUTO_INCREMENT KEY
```

不确定这是否会追溯应用这些值。如果不是，您应该能够使用存储过程或在简单程序中迭代您的值（只要没有其他人正在写入数据库）并设置使用该`LAST_INSERT_ID()`函数生成 id 值。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-20T14:04:22.693

对于 oracle，您可以执行以下操作

```
alter table mytable add (myfield integer);

update mytable set myfield = rownum; 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-09-07T11:35:43.077

和 Postgres 等效项（仅当您希望“id”成为键时，第二行是强制性的）：

```
ALTER TABLE tableName ADD id SERIAL;
ALTER TABLE tableName ADD PRIMARY KEY (id); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-20T14:04:01.230

只需使用 ALTER TABLE 就可以了。添加具有正确类型和 IDENTITY 标志的列，它应该可以解决问题

查看有关 ALTER TABLE 语法的MSDN 文章[http://msdn.microsoft.com/en-us/library/aa275462(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa275462(SQL.80).aspx)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-12-27T13:28:15.787

对于 sql server 中的 UNIQUEIDENTIFIER 数据类型，试试这个

```
Alter table table_name
add ID UNIQUEIDENTIFIER not null unique default(newid()) 
```

如果要从该列创建主键，请使用此

```
ALTER TABLE table_name
ADD CONSTRAINT PK_name PRIMARY KEY (ID); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T14:04:21.417

取决于数据库，因为每个数据库都有不同的添加序列号的方式。我会更改表以添加列，然后在 groovy/python/etc 中编写一个 db 脚本来读取数据并使用序列更新 id。设置数据后，我会在表中添加一个序列，该序列从顶部数字之后开始。设置好数据后，正确设置主键。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-04-21T14:08:58.687

如果您不希望新列具有类型`IDENTITY`（自动递增），或者您想具体说明行编号的顺序，则可以添加类型列，`INT NULL`然后像这样填充它。在我的示例中，新列称为 MyNewColumn，表的现有主键列称为 MyPrimaryKey。

```
UPDATE MyTable
SET MyTable.MyNewColumn = AutoTable.AutoNum
FROM
(
    SELECT MyPrimaryKey, 
    ROW_NUMBER() OVER (ORDER BY SomeColumn, SomeOtherColumn) AS AutoNum
    FROM MyTable 
) AutoTable
WHERE MyTable.MyPrimaryKey = AutoTable.MyPrimaryKey 
```

这适用于 SQL Sever 2005 及更高版本，即支持的版本`ROW_NUMBER()`

# linux - tty1“权限被拒绝”的原因可能是什么？

> ID：108251
> 
> 赞同：2
> 
> 时间：2008-09-20T14:09:09.470
> 
> 标签：linux, vps

在我的 VPS 服务器（Fedora 9）上，由于 tty[1-6] 上的“权限被拒绝”错误，mingetty 不断重生，即使：

```
root# ls -la /dev/tty1
crw------- 1 root root 4, 1 Sep 19 14:22 /dev/tty1

```

更奇怪的是，这不起作用：

```
root# 猫 </dev/tty1
bash：/dev/tty1：权限被拒绝

```

我猜这与VM主机有关，但我和我的VPS提供商都没有想法，谷歌也是如此......关于为什么root无法访问具有root rw权限的字符设备的任何线索？

更新：我确定 SELinux 已被禁用；然而，问题仍然存在......

更新： strace 转储：

```
32399 rt_sigaction（SIGTSTP，{SIG_DFL}，{SIG_DFL}，8）= 0
32399 rt_sigaction（SIGTTIN，{SIG_DFL}，{SIG_IGN}，8）= 0
32399 rt_sigaction（SIGTTOU，{SIG_DFL}，{SIG_IGN}，8）= 0
32399 rt_sigaction（SIGINT，{SIG_IGN}，{SIG_IGN}，8）= 0
32399 rt_sigaction（SIGQUIT，{SIG_IGN}，{SIG_IGN}，8）= 0
32399 rt_sigaction（SIGCHLD，{SIG_DFL}，{0x807b990，[]，SA_RESTORER，0xb7e7b708}，8）= 0
32399 open("/dev/tty1", O_RDONLY|O_LARGEFILE) = -1 EACCES (权限被拒绝)
32399 open("/dev/tty1", O_RDONLY|O_LARGEFILE) = -1 EACCES (权限被拒绝)
32399 fstat64(2, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 1), ...}) = 0
32399 mmap2（NULL，4096，PROT_READ|PROT_WRITE，MAP_PRIVATE|MAP_ANONYMOUS，-1，0）= 0xb7fe1000
32399 写（2，“bash：/dev/tty1：权限拒绝”...，35）= 35

```

不能说这对我来说很有意义......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T15:14:02.247

我怀疑 SELinux 可能是问题所在。尝试暂时禁用它，看看它是否有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T18:47:26.880

我没有确切的答案，但我有一个建议。

使用 ltrace 和 strace 来了解“幕后”使用的内容，如下所示：

```
strace -f -o LOG bash -c 'cat < /dev/tty1' 
```

（“ltrace”的参数相同）。检查 LOG 以找出哪个系统调用触发了“权限被拒绝”。也许它会给你一个更多的关键字来提供给谷歌或有用的日志片段来添加到你的问题中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-07T16:07:46.800

进入您的 /etc/inittab 并注释掉以下行（或其他类似的行）。您可能需要重新启动以停止重新生成

```
c1:12345:respawn:/sbin/agetty 38400 tty1 linux
c2:2345:respawn:/sbin/agetty 38400 tty2 linux
c3:2345:respawn:/sbin/agetty 38400 tty3 linux
c4:2345:respawn:/sbin/agetty 38400 tty4 linux
c5:2345:respawn:/sbin/agetty 38400 tty5 linux
c6:2345:respawn:/sbin/agetty 38400 tty6 linux 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-19T02:19:36.363

我不确定这是否会对您有所帮助，但必须先检查一下......我发现 - 在许多情况下，系统管理员禁用了对此类内容的访问，因此请尝试查找此文件：/etc/security/access. conf，然后找到“#-:ALL EXCEPT root:tty1”这一行。如果处于活动状态（意味着第一个中没有 #），该行将禁止在 tty1 上进行非 root 登录，但请注意不要更改 - 最好检查您的系统行政。

希望这有帮助

# c# - 子类表单在设计器视图中行为不正确（VS 2008）

> ID：108270
> 
> 赞同：0
> 
> 时间：2008-09-20T14:18:36.343
> 
> 标签：c#, winforms, visual-studio-2008

我已经进行了子类`Form`化以包含一些额外的功能，这归结为`List<Image>`在表单上的一组预定义位置中显示。我有以下内容：

```
public class ButtonForm : Form 
{
    public class TitleButton
    {
        public TitleButton() { /* does stuff here */ }
        // there's other stuff too, just thought I should point out there's
        // a default constructor.
    }

    private List<TitleButton> _buttons = new List<TitleButton>();
    public List<TitleButton> TitleButtons
    {
        get { return _buttons; }
        set { _buttons = value; }
    }
    // Other stuff here
} 
```

然后我想要使用的实际形式是一个子类，`ButtonForm`而不是`Form`. 这一切都很好，设计师甚至选择了新属性并将其显示在属性列表中。我以为这会很棒！它显示了集合，我可以将按钮添加到那里，然后我就走了。所以我打开了集合编辑器，添加了所有的对象，你瞧，设计师里有一张我想要的完美视图。

这就是它开始变得丑陋的地方。出于某种原因，Designer 拒绝实际生成代码来创建对象并将它们附加到集合中，因此虽然它在设计模式下看起来很棒，但一旦我编译并运行它，它就会再次消失，我又回来了平方一个。我完全不知道为什么会发生这种情况。如果设计师可以很好地生成它以通过额外的行为获得我的表单的完美视图，为什么它不能/不会将代码生成到实际的代码文件中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T14:33:13.390

首先，您需要从 Component 继承 TitleButton 类，以便设计人员知道它是可以通过设计人员生成的代码创建的组件。然后您需要指示设计器代码生成器处理集合的内容，而不是集合实例本身。所以尝试以下...

```
public class TitleButton : Component
{
   // ... 
}

[DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]
public List<TitleButton> TitleButtons
{
   // ...
} 
```

# desktop - 这些天，新手程序员是否应该花时间学习编写“桌面”应用程序，或者它所在的网络是什么？

> ID：108272
> 
> 赞同：10
> 
> 时间：2008-09-20T14:18:43.970
> 
> 标签：desktop

作为一个新手，我花时间学习了一点 C 和一些 PHP。我看过为 Windows 编写桌面应用程序，但由于 API 的复杂性，似乎存在相当大的进入障碍。这值得学习吗，还是原生应用程序在未来会变得不那么普遍？

在我看来，我使用过的唯一桌面应用程序是 Web 浏览器和文本编辑器，当然还有操作系统本身。我需要的一切现在都在线。

学习编写非 Web 应用程序是一项有用的技能吗？如果是这样，我应该学习什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-20T14:24:51.880

我不认为选择一方并虔诚地坚持下去不是一个好主意。我认为一个优秀的工程师会尽可能多地暴露自己，这样他就可以就哪个是完成任务的最佳工具做出明智的决定。

换句话说，不要选择平台、操作系统、编程语言等，然后忽略其他。最好是全面掌握你的技能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T14:23:20.433

原生应用程序总会有市场，尽管很多东西正在转移到网络上，并且基于 Web 的应用程序的范围比以往任何时候都大，但原生 GUI 应用程序永远不会完全消失。

**然而，除了坚持你喜欢的东西**之外，真的很难给你任何真正有用的建议。如果您只使用网络东西，那么成为一个Windows GUI程序员会有点愚蠢:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-30T22:05:22.217

这可能会被修改——但我还是要说。

您可以编程，也可以不编程。大约 18 个月前，当我正在寻找一份新工作时，我正在研究市场，我做了很多 .NET，但有些地方希望我做 JAVA。

我在做 Web 服务，他们希望有人做其他的事情......在一天结束时，它归结为 - 如果你知道如何编码，你就会知道如何编码。如果您现在正在编写桌面应用程序并说在 6-8 个月内您想迁移到一些 ASP.NET MVC，那么您会没事的。

你可能需要一些启动时间来学习语法并感受一些东西 - 但最终你会没事的。我说这适用于所有新语言……技能就是技能

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T14:23:25.643

非 Web 应用程序在遥远的未来将非常有用（正如我现在所看到的）。我们将无法使用必须使用网络协议与客户端进行通信的解释性脚本语言来像在线编写良好的桌面应用程序那样高效地做任何事情。但是，如果您对网络感兴趣，也许您可​​以尝试两者兼而有之。制作一个 rss 阅读器、一个简单的 Web 浏览器或一个 IRC 客户端。他们都是伟大的项目。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T14:21:40.780

你应该学任何你*想*学的东西。如果你不这样做，你可能会发现它比你需要的更难。

我个人开始为 Windows 编写桌面应用程序，因为我当时使用它。这些天来，我确实认为您是正确的-您可以制作一个网站/在线应用程序，而无需在该过程中投入太多资金。

但是，如果您是编程新手，即使编写一个像样的 Web 应用程序也将是困难的。独立页面很简单，但是当您将数据库、安全性和管理添加到组合中时，事情就会增长。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T14:24:27.653

在我看来，新手应该专注于所选语言的基础知识和内部结构。图形或 Web 界面应该等到您知道自己在后端做什么。我个人建议您从控制台程序开始，但我想这取决于您使用的平台。也许桌面界面在 Windows 上更容易上手。

最佳实践（在我看来）是编写一个具有您想要提供的功能的可靠后端并以模块化方式编写它，因此您可以稍后决定是否要提供桌面界面或 Web 界面（或两者） . 用户界面的选择在开始时应该无关紧要。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T14:27:12.797

学习非 Web 应用程序总是有用的。总会有一些应用程序不适合作为 Web 应用程序。即使*一切都*变成了 Web 应用程序，仍然需要编写服务器端代码和 Web 浏览器。

目前，如果您对 Windows 平台感兴趣，那么我建议您研究 C# 和 WPF。这些技术用于本机和 Web 环境。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-20T14:27:35.930

Web 开发一切都很好，但是大多数系统即使它们有一个很好的 Web 前端仍然主要位于 Web 级别以下，有点像冰山。

最后，大多数 Web 实现在设计上都是 n 层的，具有较低级别的设计，例如数据访问和与以非 Web 语言发生的对等服务器的集成。

正如我所看到的，似乎有一种普遍的语言可以触及所有这些级别，而不是 .Net Framework。请注意，我没有对 c#、vb 等做出任何说明。我认为这是个人喜好问题。但是我不记得看到一个 n 层银行网站使用 php 来做数据层。也没有使用 ruby​​ 与其 jd edwards 服务器通信的在线订购网站。

这就是重量级语言仍然普遍存在的地方，如果那是您想要工作的地方，那么在您选择的任何语言变体中学习 .Net 框架都是必经之路。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-20T14:31:38.340

我相信“Web”应用程序的未来开发模式将更类似于当前的桌面应用程序开发模式。我的意思是，明天的 Web 应用程序不会是维护、调试和测试困难且昂贵的 HTML/AJAX 工作，而是使用针对浏览器中已经可用的平台的编译语言开发。Flash、Silverlight 和（在较小程度上，似乎）Chrome 是这个想法的当前典范。

所以也许学习那些“复杂”的 API 并不是浪费时间。我的团队构建 WPF 应用程序，我个人认为这些应用程序不会比当前的 HTML/AJAX 项目更复杂。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-20T19:23:58.183

掌握一门学科，然后进入下一门学科。

我还处于学习业务应用程序开发的初级阶段。我采取的步骤就是研究数据库。现实世界中的大多数应用程序都是以数据为中心的。最好从桌面应用程序开始。做一些拖放然后研究背后的代码。我正在用 ASP.NET 做同样的事情。我已经下载了大量的入门工具包。这完全取决于你的学习方式。对我来说，我可以通过“边做边学”来学习，而不是通过大量的集合理论来学习。这就是为什么烹饪书和头脑第一的书对我来说非常有用。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-20T20:46:35.287

从您的语言背景来看，我注意到您只提到了 PHP 和 C。这两种语言都不是严格意义上的面向对象/OO 语言。您确实应该学习传统的 OO 语言，例如 Java 或 C#，因为大多数工作都在寻找这些技能。顺便说一句，请阅读 Yegge 关于专业开发人员应该学习哪些语言的[建议](http://steve.yegge.googlepages.com/tour-de-babel)，并自己思考应该做什么。

假设您对企业应用程序开发感兴趣，我不得不说，该领域正在从传统的 Web 开发（在网页上呈现来自数据库的内容）过渡到富互联网应用程序（仍然呈现来自数据库的数据，但是前端开始近似于桌面应用程序）。构建富 Internet 应用程序需要桌面 UI 开发人员早就知道的概念。因此，我认为您不必在 Web 开发和桌面开发之间做出选择。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-20T14:25:39.007

我同意，你应该学习你想学的。一旦你对 Web 有所了解，然后学习一些桌面编程来扩大你的视野。你永远不知道什么时候需要它。

但是，另外，如果您正在学习 Windows 桌面开发，那么您绝对应该看看 C# 和/或 VB.NET。.NET Framework 是迄今为止为 Windows 开发桌面应用程序的最简单方法；据我了解，这比 C++ 容易得多（实际上我自己并没有花太多时间在 C++ 上）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-20T14:28:32.543

@Rich Bradshaw，

我认为您可以通过查看任何求职网站来回答您的问题。

> 我应该学什么？

无论你喜欢什么，都能给你带来足够的钱。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-20T14:38:09.120

这是一个非常好的问题。我现在知道，我所知道的大多数应用程序开发都是网络应用程序。但是对于诸如 flex 之类的语言，如果桌面应用程序再次出现，我不会感到惊讶。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-20T14:45:29.350

要精通，您应该两者都做。一个领域的技能可能会也可能不会很好地转化为另一个领域。例如，当许多桌面开发人员开始构建 Web 应用程序时，缺少状态会绊倒他们。当然，您的体验可能会有所不同

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-08-24T09:06:23.723

专业的 .NET 程序员应该同时处理 webform 和 winform。即使您从 webform 开始，但最终，您将有机会接触 winform。就像一个话题“VB vs C#”，你不会看到一个.net专家谈论它，因为最后，你应该知道他们两个。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-08-24T15:38:38.547

在某些情况下，可以使用网络以外的东西：

1.  脚本语言/控制台应用程序 - 这里想到构建脚本作为示例，但也编写批处理或命令文件来执行简单的任务，例如处理部署或执行一些其他简单的任务，这些任务可能更好地在黑盒中完成，而不是手动执行一遍又一遍的东西。

2.  Windows 服务 (WCF) - 这些也可能用于监视事物并发送那些“服务器已关闭！” 消息让某人去找出问题所在。

对于中间件和后端开发也有一些话要说，其中一个人将编写 Web 服务或处理查询数据库或将数据插入数据库，这可能与前端 Web UI 工作不同，只是给几个除了嵌入式系统和移动设备之外，还有其他软件开发示例，从某种意义上说，它们也是非 Web 和非桌面开发。

# flash - 如何在 Actionscript 3 中播放与 SWF 不在同一目录中的声音？

> ID：108276
> 
> 赞同：3
> 
> 时间：2008-09-20T14:20:00.723
> 
> 标签：flash, url, actionscript, audio, urlrequest

我有一个带有一堆外部声音到 SWF 的项目。我想播放它们，但是每当我尝试将新 URL 加载到声音对象中时，它都会失败，

> 错误 #2068：无效的声音

或引发 ioError

> 错误 #2032 流错误

// 尝试使用前缀为“http://..”“file://..”“//..”和“..”的路径）

```
var path:String = "http://../assets/the_song.mp3";

var url:URLRequest = new URLRequest( path );

var sound:Sound = new Sound();

sound.addEventListener( IOErrorEvent.IO_ERROR, ioErrorHandler);

sound.addEventListener( SecurityErrorEvent.SECURITY_ERROR, secHandler);

sound.load(url); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T16:44:48.987

除非您要输入完整的 url，否则不要使用 http:// 或 file://

声音可以从完整或相对 url 加载 mp3 文件。您只需要确保您的网址正确且有效。

例如，如果文件的完整路径是[http://www.something.com/assets/the_song.mp3](http://www.something.com/assets/the_song.mp3)，那么“/assets/the_song.mp3”的路径就可以了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-21T16:38:13.330

好吧，我刚刚通过将 mp3 放在一个目录中进行了测试：`soundTest/assets/song.mp3` 然后在另一个目录中创建一个调用 mp3 的 swf：`soundTest/swfs/soundTest.swf`当我使用它时`var path:String = "../assets/song.mp3";`，它编译没有错误。

您的实际目录结构是什么？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T10:07:52.197

你真的应该为 FireFox 下载 httpfox。此 SNIFFER 允许您查看哪些数据正在流经浏览器。你可以看到它加载的文件，包括每个文件的路径，你甚至可以嗅探 POST 和 GET 变量。这将向您显示文件是从哪里提取的，并据此您可以相应地修复您的相对路径。

[https://addons.mozilla.org/en-US/firefox/addon/6647](https://addons.mozilla.org/en-US/firefox/addon/6647)

**重要的：**

从 SWF 调用的所有外部资源都与加载到 Web 时加载它们的 html 文件相关，而不是 SWF。唯一的例外，这是从 AS3 开始的，FLV 与 SWF 相关，而不是像其他所有资源一样加载 SWF 的 HTML 文档。这就是为什么 SNIFFERS 是一个重要工具的原因，我挠了挠头，直到我注意到嗅探器中的 URL 调用了一个奇怪的路径。

以下是如何加载声音。

```
var soundRequest:URLRequest = "path/to/file.mp3";
var s:Sound = new Sound(soundRequest);
var sChannel = s.play(0, int.MAX_VALUE); //Causes it to repeat by the highest possible number to flash.
//Above starts the sound immediatly (Streaming);`//Now to wait for completion instead, pretend we didnt start it before.
`s.addEventLister(Event.SOUND_COMPLETE, onSComplete, false, 0, true);`
function onSComplete(e:Event):void
{
   var sChannel = s.play(0, int.MAX_VALUE); //Causes it to repeat by the highest possible
}`

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-09T07:00:13.540

在 RTMP 和 HTTP 两种协议中，路径都应该是 -- "path/to/mp3:file.mp3" 或 "path/to/mp3:file"。我能记住。请检查两者。

# php - 我可以根据结果的数量将我的 MySQL 查询重构为一个查询吗？

> ID：108281
> 
> 赞同：1
> 
> 时间：2008-09-20T14:21:38.330
> 
> 标签：php, sql, mysql

我有一个`y`有两列`a`的表`b`

条目是：

```
a   b

1   2

1   3

1   4

0   5

0   2

0   4 
```

如果我在 column 中搜索 1，我想获得 2,3,4，如果我在 column中搜索，我想获得`a`5,2,4 `a`。

因此，如果我在 A 中搜索 A 中的内容，（1）我得到那些行，如果给定值没有条目 A，给我“默认值”（`a`=“0”）

这是我如何知道如何做到这一点：

```
$r = mysql_query('SELECT `b` FROM `y` WHERE `a` = \'1\';');
//This gives desired results, 3 rows

$r = mysql_query('SELECT `b` FROM `y` WHERE `a` = \'2\';');
//This does not give desired results yet.
//Get the number of rows, and then get the 'defaults'
if(mysql_num_rows($r) === 0) $r = mysql_query('SELECT `b` FROM `y` WHERE `a` = 0;'); 
```

那么，既然已经充分解释了，我该如何在一个查询中做到这一点，以及性能问题呢？

最常用的部分是第三个查询，因为`a`如果您偏离默认值，则只有数字的值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T16:56:11.847

你可以尝试这样的事情。我不能 100% 确定它会起作用，因为 count() 是一个聚合函数，但值得一试。

```
SELECT b
FROM table1 
WHERE a = (
   SELECT
     CASE count(b)
       WHEN 0 THEN :default_value
       ELSE :passed_value 
     END
   FROM table1
   WHERE a = :passed_value
) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T18:19:20.490

我想我有它：

```
SELECT b FROM y where a=if(@value IN (select a from y group by a),@value,0); 
```

它检查表中是否存在@value，如果不存在，则使用 0 作为默认值。@value 也可以是 php 值。

希望能帮助到你 ：）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T17:34:53.967

关于什么

```
$rows = $db->fetchAll('select a, b FROM y WHERE a IN (2, 0) ORDER BY a DESC');
if(count($rows) > 0) {
  $a = $rows[0]['a'];
  $i = 0;
  while($rows[$i]['a'] === $a) {
    echo $rows[$i++]['b']."\n";
  }
} 
```

一个查询，但如果有很多“零”值，则会产生开销。
取决于你是否关心开销......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T23:00:34.137

我认为 Michal Kralik 在我看来是基于服务器性能的最佳答案。为这种简单的逻辑做子选择或存储过程真的不值得。

我改进 Michal 逻辑的唯一方法是，如果您在一个脚本中多次执行此查询。在这种情况下，我会先查询 0，然后运行每个单独的查询，然后检查是否有任何值。

伪代码

```
// get the value for hte zero's
$zeros = $db->fetchAll('select a, b FROM y WHERE a = 0');

//checking for 1's
$ones = $db->fetchAll('select a, b FROM y WHERE a = 1');
if(empty($ones)) $ones = $zeros;

//checking for 2's
$twos = $db->fetchAll('select a, b FROM y WHERE a = 2');
if(empty($twos)) $twos = $zeros;

//checking for 3's
$threes = $db->fetchAll('select a, b FROM y WHERE a = 3');
if(empty($threes)) $threes = $zeros; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T14:31:20.290

您可以使用单个参数在单个存储过程中完成所有这些操作。

我必须用完，但我会尝试为您写一个，并在我完成差事后立即添加到这里。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T16:18:11.280

我不知道为什么这被标记了 - 请教育我。这是一个有效的、经过测试的存储过程，我回答了这个问题。OP 不要求答案在 php.ini 中。??

这是一个存储过程，可以在 SQL Server 中执行您想要的操作。我不确定MySQL。

```
create proc GetRealElseGetDefault (@key as int)
as
begin

-- Use this default if the correct data is not found
declare @default int
select @default = 0

-- See if the desired data exists, and if so, get it.  
-- Otherwise, get defaults.
if exists (select * from TableY where a = @key)
    select b from TableY where a = @key
else
    select b from TableY where a = @default

end -- GetRealElseGetDefault 
```

你会运行这个（在 sql server 中）

GetRealElseGetDefault 1

基于快速的谷歌搜索，MySQL 中的存在速度很快。如果 A 列被索引，它会特别快。如果您的表大到足以让您担心性能，那么它可能大到可以索引。

# email - 如何从您的应用程序发送干净的电子邮件？

> ID：108292
> 
> 赞同：4
> 
> 时间：2008-09-20T14:24:51.630
> 
> 标签：email, smtp, spf, reverse-dns

在开发发送通知电子邮件的应用程序时，最佳实践是什么？

1.  不会被您的托管公司标记为垃圾邮件发送者。（涵盖任何一个：）
    *   不淹没邮件服务器的最佳技术
    *   最好的邮件服务器产品，如果您要设置自己的
    *   像从特定用户一样发送消息，但仍然清楚地来自您的应用程序（以确保投诉等返回给您），而不会违反良好的电子邮件礼仪
    *   任何其他经验教训
2.  没有被接收者的客户端标记为垃圾邮件？（涵盖任何一个：）
    *   配置和使用发件人 ID、域密钥、SPF、反向 dns 等以确保正确识别您的电子邮件
    *   为用户发送电子邮件时避免被标记为垃圾邮件的最佳 SMTP 标头技术（例如，同时使用 Sender 和 From 标头）
    *   任何其他经验教训

附加要求：此应用程序将根据事件向单个收件人发送单个消息。因此，将相同消息发送给多个收件人的技术将不适用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T00:03:56.567

> 不淹没邮件服务器的最佳技术

除了与您的邮件服务器管理员核对（如果它是共享主机帐户/不在您的控制范围内）之外，您对此无能为力。但是，如果要求是每个事件向单个收件人发送一封电子邮件，那应该不是太大的问题。往往会阻塞邮件系统的是具有数百（或更多）收件人的电子邮件。

如果您的事件一直在触发，也许可以考虑合并它们并发送一封电子邮件，定期总结它们。

> 像从特定用户一样发送消息，但仍然清楚地来自您的应用程序（以确保投诉等返回给您），而不会违反良好的电子邮件礼仪

您可以通过使用“Reply-To”标头来完成此操作，然后在撰写电子邮件时让客户使用该地址而不是“发件人”地址。

您还应该设置任何电子邮件的“Return-Path”标头，因为没有此标头的电子邮件通常会被过滤掉。

前任。

```
From: me@me.com
Return-Path: me@me.com
Reply-To: auto@myapp.com 
```

> 配置和使用发件人 ID、域密钥、SPF、反向 dns 等以确保正确识别您的电子邮件

这完全取决于您对邮件和 DNS 服务器拥有多少所有权。spf/sender-id 等...都是 DNS 问题，因此您需要访问 DNS。

在您的示例中，这可能会带来很大的问题。当您将邮件设置为来自特定用户时，该用户必须在其 DNS 中设置 SPF（例如）以允许您的邮件服务器作为有效的发件人。您可以想象对于许多拥有不同域名的用户来说，这会变得多么混乱（如果不是完全不可能的话）。

至于反向DNS之类的，这真的取决于。大多数客户端 ISP 等...只会检查是否设置了反向 DNS。（即，1.2.3.4 解析为 host.here.domain.com，即使 host.here.domain.com 没有解析回 1.2.3.4）。这是由于那里的共享主机数量众多（邮件服务器通常会将自己报告为客户端的域名，而不是真正的邮件服务器）。

有一些严格的网络需要匹配反向 DNS，但这要求您首先控制邮件服务器，如果它不匹配。

如果您可以更具体一点，我可以提供更多建议，但一般来说，对于需要发送申请邮件并且无法控制环境的人，我建议以下：

*   确保设置“返回路径”
*   很高兴在标题中添加您的应用程序和滥用信息，即：“X-Mailer”和“X-Abuse-To”（这些是自定义标题，仅供参考）
*   确保为您的外发邮件服务器的 IP 地址设置了反向 DNS

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T01:50:58.490

首先快速更正上一个

return-path：是接收系统根据传入消息的信封发送者添加的标题

为了使 spf 工作，返回路径/信封发件人需要是 yourapp@yourdomain.com

并确保 yourdomain.com 的 spf 记录 {或者如果 per-user spf} for yourapp@yourdomain.com 允许邮件源自托管应用程序/发送电子邮件的服务器

这个信封发件人是接收所有退回/错误的地址

现在发件人ID完全不同，它检查返回路径/信封发件人和发件人：地址{存储在邮件中}如果发送自：他的名字 yourapp@yourdomain.com 回复：他的名字 hisaddres@hisdomain.com

如果从以下地址发送，这将不是问题： hisname hisaddres@hisdomain.com

它将是并且您必须添加一个 Resent-From: hisname yourapp@yourdomain.com 因为这指定忽略 from: for sender-id checks 使用此代替，因为它已由您代表他发送

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T02:04:38.933

现在是值得的其他位

提到的 ip 是您的邮件服务器

a 让您的 ip 的 ptr 指向一个名称，该名称也解析为相同的 ip FQDNS

b 让您的服务器 helo/ehlo 与任何.domain.com 一起，其中 domain.com 与步骤 A 中名称的域相同 {下面的 resons 名称不同}

c 让 helo/ehlo 服务器名称也解析为您的服务器的 ip

d 将以下 spf 记录添加到该 helo/ehlo 名称 "v=spf1 a -all" {意思是允许 helo/ehlo 使用此名称从 ip 的此名称指向仅}

e 将以下发件人 ID 行添加到 helo/ehlo 名称{纯粹是为了完整性“spf2.0/mfrom,pra -all”{即没有用户@this-domain}

f 将以下 spf 添加到您的服务器的 FQDNS 名称和任何其他主机名 "v=spf1 -all" {即没有机器将 helo/ehlo 作为这个名称并且没有用户@this-domain}

{因为 fqdns 名称可以由机器人/感染确定，最好不要直接在 helo/ehlo 问候语中使用此名称，它与 helo/ehlo 身份来自同一域就足以证明两者的有效性}

# javascript - GWT 或 DOJO 还是其他？

> ID：108294
> 
> 赞同：6
> 
> 时间：2008-09-20T14:25:08.853
> 
> 标签：javascript, web-applications, gwt, frameworks, dojo

我来自微软世界（而且我很平静）。我想快速制作一个 Web 应用程序的原型，如果它成功了，就让它生效——我不想使用 ASP.Net。

我不确定要使用哪个 Web 应用程序工具包。我应该使用 GWT、DOJO ......其他建议吗？我对任何服务器端语言持开放态度，但我正在研究 RoR、Php 甚至 Java（准确地说是 J2EE）。我不是一个 Javascript/CSS 的人，所以一个可以让我在这些方面相对容易的工具包会更可取。

另外，我是家里的mac用户。您推荐的框架有哪些 IDE？

有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T14:27:49.173

如果您愿意做 Java，GWT 是您的最佳选择。它允许您在客户端-服务器之间拥有一个相对统一的代码库，并且在两者上只使用一种语言。

做非常不受欢迎的 AJAXy 事情有一些限制（GWT 使事情变得困难，但并非不可能），但听起来这不是你的用例。

随着您的应用程序变得越来越复杂，GWT 将允许您通过使用其更多功能来扩大规模——并且您的原型不会是一次性代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-21T03:24:30.790

如果你想用 JAVA 写前端和后端，并且想做复杂的 ajax 类型的事情，那么 GWT 是一个很好的选择。

考虑它的最简单方法是构建一个 GWT 应用程序有点像构建一个挂钩到服务器的 JAVA swing 应用程序。就像使用服务器的摇摆应用程序一样，您可以使其变胖或变瘦。完成后，它全部编译成 HTML 和 javascript，并具有非常好的现代浏览器支持（ie6+ ff、opera、safari）。

它确实抽象了所有的 javascript 和 HTML，但如果你想让它看起来不错，你仍然需要了解 CSS。

我认为任何说它破坏 MVC 或者它是客户端与服务器的混淆的人都不理解 GWT。GWT 是一个客户端框架。它仅在客户端上使用。GWT 确实提供了一种 RPC 机制来将其挂接到 JAVA（和其他）后端，但这只是一种通信协议，并不意味着您的服务器代码会神奇地变成您的客户端代码。当然，如果你真的想的话，你可以在你的 UI 中编写一大堆业务规则，但是你可以使用任何框架来做到这一点，所以说 GWT 在这方面有所不同是很愚蠢的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-21T14:22:39.350

GWT 是一个不错的选择，而如果你选择更强大的基于 GWT 的 JavaScript 框架（例如 SmartGWT），编译出来的东西就太重了。

如果您需要一个紧凑的项目，请选择直接 JavaScript。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T14:36:51.807

我是 GWT 的粉丝，但我对 Java 非常熟悉。我发现它很直观，并且非常容易快速获得良好的结果。如果您要使用 GWT，那么您肯定会想要使用免费且功能非常强大的[Eclipse](http://eclipse.org/) IDE。

GWT 的一个缺点是它*需要*浏览器支持 Javascript，没有“优雅降级”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T14:40:06.040

我们已经评估了大量框架，并决定使用[Echo2](http://echo.nextapp.com/site/echo2)。

*   您只需要用 Java 编写代码。仅当您想编写自己的组件时才需要 Javascript。
*   像 GWT 这样的大型项目不存在启动性能问题。
*   您可以在客户端代码中使用全部 Java，因为它在服务器上运行。在 GWT 中，您只能使用非常少量的 Java 类。

Java 的 IDE 是[Eclipse](http://www.eclipse.org/)。这与使用的框架无关。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-21T03:33:47.023

我是 jQuery 的粉丝，动作、遍历和命令的可链接性非常强大。我的一个好朋友对 Mootools 很着迷，他在一家 Java 商店 FWIW 工作。他提到 Mootools 的一个很酷的特性是你可以指定你希望框架包含的功能，它会在一个文件中的一行中生成整个库，你可以在页面上包含该文件以最小化框架的重量（漂亮很酷的功能）。真的，这取决于你最喜欢什么。jQuery 有很棒的教程，速度非常快，并且可以与其他 javascript 框架一起使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-10T11:47:55.963

与 GWT 无关，但您是否考虑过 GWT 可以很好地使用的其他后端？

Grails 是一个与 GWT 紧密结合的后端。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-20T23:29:51.960

就个人而言，我会避免尝试嵌入或隐藏客户端框架的服务器端框架。我确信 GWT 非常适合快速完成某些事情，并且可能适用于某些类型的应用程序，但是对于更复杂的应用程序，您可能会遇到很多“边缘”问题。将客户端框架与服务器端框架解耦可以避免这些问题。

# php - PHP中真的有必要“不直接加载此页面”吗？

> ID：108301
> 
> 赞同：1
> 
> 时间：2008-09-20T14:27:42.467
> 
> 标签：php, methodology

我本来想问最好的方法是什么，但后来决定我应该问是否有必要。我从未见过它在`JSP`开发中完成，但它似乎是`PHP`. 这背后的原因是什么，如果我不防范这种情况，我还应该考虑什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-21T02:17:47.127

这在 PHP 中比其他类似语言更常见的原因与 PHP 的历史有关。早期版本的 PHP 将“register_globals”设置作为默认设置（事实上，在早期版本中它甚至可能不是一个设置）。Register_globals 告诉 PHP 根据查询字符串定义全局变量。因此，如果您这样查询这样的脚本：

```
http://site.com/script.php?hello=world&foo=bar 
```

...脚本会自动定义一个变量 $hello ，其值为“world”，$foo 的值为“bar”。

对于这样的脚本，如果您知道关键变量的名称，则可以通过在查询字符串中指定这些变量来利用该脚本。解决方案？在核心脚本中定义一些魔术字符串，然后让所有辅助脚本检查魔术字符串，如果不存在则退出。

值得庆幸的是，几乎没有人再使用 register_variables 了，但是许多脚本仍然写得非常糟糕，并且做出愚蠢的假设，如果它们被断章取义地调用它们会造成损害。

就个人而言，我通过使用 Symfony 框架来避免整个事情，它（至少在其默认设置中）将控制器和模板完全排除在 Web 根目录之外。唯一的入口点是前端控制器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-21T04:58:52.700

如果您包含来自外部 Web 根目录的所有内容，那么这不是问题，因为**无法**直接加载任何内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T14:30:21.227

嗯，这是为了防止敏感的包含被直接发送到网络服务器。这当然不是一个包罗万象的安全措施，但它可以帮助您的特定设置。

但是，如果您的用户能够从他们自己的脚本中包含该文件，那将毫无帮助

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T14:38:48.227

我发出一个 404 页面，不是作为一项严肃的安全措施，而只是因为我不喜欢泄露有关网站内部的信息，甚至是内部文件的名称。

但是如果文件只包含函数，那么省略检查并没有真正的危害。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T14:33:47.803

它也不仅仅是 php 中的一个安全功能，而是更多基于 MVC 的 PHP 站点的功能。例如，如果在 SugarCRM 中您要直接调用模块文件，则页面加载将失败，因为控制器、视图和模型之前未加载，并且您也没有数据库配置/连接信息，因此要确保加载所有依赖项用户被迫通过一个已知的入口点 - 即 index.php

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T15:26:50.203

我刚刚在 .Net MVC 系统中找到了一种方法，您可以使用 Apache Rewrites、.htaccess 文件或者如果您使用的是 IIS，则可以为 PHP 复制该方法，如果您使用的是 web.config 文件。

由于 MVC 模式不需要用户直接访问 aspx 文件，因此不提供这些文件，而是发送 404。例如，如果您有包含文件“inc.php”的命名约定，您可以将 *.inc.php 请求重定向到特定文件夹的 404 - 在 Apache Rewrite 中，规则末尾的 R=404 将返回该 HTTP 状态给你的客户。

其中一些示例可能会有所帮助：[Apache Rewrite Examples](http://httpd.apache.org/docs/1.3/misc/rewriteguide.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-21T11:02:31.717

正如其他一些答案中已经提到的那样，您不需要这样做。如果文件不应该由 Web 服务器提供，则不应将其留在 Web 文件夹中。包含应放置在 Web 根目录之外的目录中。

除此之外，告诉用户页面不存在的正确方法是发出状态 404，使用：

```
header("HTTP/1.0 404 Not Found");
exit; 
```

如果您不这样做，非人类（例如搜索引擎）很难区分常规页面和非页面。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T15:16:45.303

这非常重要，因为如果您正在编辑运行 Google 工具栏的网站，它会找到您的内部 php 文件，然后将它们放入搜索结果中。充其量这会给用户带来尴尬的体验，但如果你是一个草率的程序员，可能会泄露数据库连接信息。

# c++ - 如何测试一个数字是否是 2 的幂？

> ID：108318
> 
> 赞同：101
> 
> 时间：2008-09-20T14:33:59.580
> 
> 标签：c++, algorithm, bit-manipulation

我需要这样的功能：

```
// return true if 'n' is a power of 2, e.g.
// is_power_of_2(16) => true  
// is_power_of_2(3) => false
bool is_power_of_2(int n); 
```

谁能建议我怎么写这个？

* * *

## 回答 #1

> 赞同：209
> 
> 时间：2008-09-20T14:45:50.410

`(n & (n - 1)) == 0`是最好的。但是，请注意，对于 n=0，它将错误地返回 true，因此如果可能，您将需要明确检查它。

[http://www.graphics.stanford.edu/~seander/bithacks.html](http://www.graphics.stanford.edu/~seander/bithacks.html)有大量聪明的比特旋转算法，包括这个。

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2008-09-20T14:37:15.063

2 的幂将只设置一个位（对于无符号数）。就像是

```
bool powerOfTwo = !(x == 0) && !(x & (x - 1)); 
```

会正常工作；小于 2 的幂的 1 在低有效位中全为 1，因此必须按位与 0。

当我假设无符号数字时， == 0 测试（我最初忘记了，抱歉）就足够了。如果您使用有符号整数，您可能需要 > 0 测试。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2008-09-20T14:40:00.223

二进制中 2 的幂如下所示：

```
1: 0001
2: 0010
4: 0100
8: 1000 
```

请注意，总是恰好设置了 1 位。唯一的例外是有符号整数。例如，一个值为 -128 的 8 位有符号整数如下所示：

```
10000000 
```

所以在检查了这个数字是否大于零之后，我们可以使用一个聪明的小技巧来测试一个并且只有一个位被设置。

```
bool is_power_of_2(int x) {
    return x > 0 && !(x & (x−1));
} 
```

更多小玩意请看[这里](http://graphics.stanford.edu/~seander/bithacks.html)。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2016-01-20T01:58:28.393

**方法#1：**

将数字除以 2 隐蔽地检查它。

**时间复杂度：** O(log2n)。

**方法#2：**

按位与前一个数字的数字应等于零。

**示例：** Number = 8 Binary of 8: 1 0 0 0 Binary of 7: 0 1 1 1 并且两个数字的按位与为 0 0 0 0 = 0。

**时间复杂度：** O(1)。

**方法#3：**

按位异或该数字与其前一个数字应该是两个数字的总和。

**示例：** Number = 8 Binary of 8: 1 0 0 0 Binary of 7: 0 1 1 1 并且两个数字的按位异或是 1 1 1 1 = 15。

**时间复杂度：** O(1)。

[http://javaexplorer03.blogspot.in/2016/01/how-to-check-number-is-power-of-two.html](http://javaexplorer03.blogspot.in/2016/01/how-to-check-number-is-power-of-two.html)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2019-05-26T09:10:32.553

在 C++20 中[`std::has_single_bit`](https://en.cppreference.com/w/cpp/numeric/has_single_bit)，如果您不需要自己实现它，您可以将其用于此目的：

```
#include <bit>
static_assert(std::has_single_bit(16));
static_assert(!std::has_single_bit(15)); 
```

请注意，这要求参数是无符号整数类型。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-20T14:39:28.350

```
bool is_power_of_2(int i) {
    if ( i <= 0 ) {
        return 0;
    }
    return ! (i & (i-1));
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2019-03-20T11:09:57.327

如果使用 GCC，这可能是最快的。它只使用一个 POPCNT cpu 指令和一个比较。任何 2 数的幂的二进制表示，始终只有一位设置，其他位始终为零。所以我们用 POPCNT 来计算设置的位数，如果它等于 1，则该数字是 2 的幂。我认为没有任何可能的更快的方法。这很简单，如果你理解一次：

```
if(1==__builtin_popcount(n)) 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-05-29T17:36:19.040

对于 2 的任何幂，以下也成立。

## n&(-n)==n

注意：n=0 的条件为真，尽管它不是 2 的幂。
它起作用的原因是：
-n 是 n 的 2s 补码。-n 将与 n 相比，将 n 的最右边设置位左侧的每一位翻转。对于 2 的幂，只有一个设置位。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-10-12T14:43:14.057

由于布尔短路和比较缓慢的事实，跟随会比大多数投票的答案更快。

```
int isPowerOfTwo(unsigned int x)
{
  return x && !(x & (x – 1));
} 
```

如果你知道 x 不能为 0 那么

```
int isPowerOfTwo(unsigned int x)
{
  return !(x & (x – 1));
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-10-16T18:13:00.997

```
return n > 0 && 0 == (1 << 30) % n; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-20T14:40:33.763

这不是最快或最短的方法，但我认为它非常易读。所以我会做这样的事情：

```
bool is_power_of_2(int n)
  int bitCounter=0;
  while(n) {
    if ((n & 1) == 1) {
      ++bitCounter;
    }
    n >>= 1;
  }
  return (bitCounter == 1);
} 
```

这是有效的，因为二进制是基于 2 的幂。任何只有一位设置的数字必须是 2 的幂。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-09-20T19:36:04.653

> 在 C++ 中测试一个数字是否是 2 的幂的最简单方法是什么？

如果您有一个带有[位操作指令](https://en.wikipedia.org/wiki/Bit_Manipulation_Instruction_Sets)的现代 Intel 处理器，那么您可以执行以下操作。它省略了直接的 C/C++ 代码，因为其他人已经回答了它，但如果 BMI 不可用或未启用，则需要它。

```
bool IsPowerOf2_32(uint32_t x)
{
#if __BMI__ || ((_MSC_VER >= 1900) && defined(__AVX2__))
    return !!((x > 0) && _blsr_u32(x));
#endif
    // Fallback to C/C++ code
}

bool IsPowerOf2_64(uint64_t x)
{
#if __BMI__ || ((_MSC_VER >= 1900) && defined(__AVX2__))
    return !!((x > 0) && _blsr_u64(x));
#endif
    // Fallback to C/C++ code
} 
```

GCC、ICC 和 Clang 信号 BMI 支持`__BMI__`. 当[AVX2 可用并启用](https://blogs.msdn.microsoft.com/vcblog/2014/02/28/avx2-support-in-visual-studio-c-compiler/)时，它在 Visual Studio 2015 及更高版本的 Microsoft 编译器中可用。有关您需要的标头，请参阅[SIMD 内在函数的标头文件](https://stackoverflow.com/q/11228855)。

我通常在 i686`_blsr_u64`上`_LP64_`编译以防万一。Clang 需要一些解决方法，因为它使用了稍微不同的内在符号 nam：

```
#if defined(__GNUC__) && defined(__BMI__)
# if defined(__clang__)
#  ifndef _tzcnt_u32
#   define _tzcnt_u32(x) __tzcnt_u32(x)
#  endif
#  ifndef _blsr_u32
#    define  _blsr_u32(x)  __blsr_u32(x)
#  endif
#  ifdef __x86_64__
#   ifndef _tzcnt_u64
#    define _tzcnt_u64(x) __tzcnt_u64(x)
#   endif
#   ifndef _blsr_u64
#     define  _blsr_u64(x)  __blsr_u64(x)
#   endif
#  endif  // x86_64
# endif  // Clang
#endif  // GNUC and BMI 
```

* * *

> 你能告诉我一个可以找到这种算法的好网站吗？

这个网站经常被引用：[Bit Twiddling Hacks](http://graphics.stanford.edu/~seander/bithacks.html)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-04-24T17:05:40.687

这是另一种方法，在这种情况下使用`|`代替`&`：

```
bool is_power_of_2(int x) {
    return x > 0 && (x<<1 == (x|(x-1)) +1));
} 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2015-09-14T12:47:16.370

可以通过c++

```
int IsPowOf2(int z) {
double x=log2(z);
int y=x;
if (x==(double)y)
return 1;
else
return 0;
} 
```

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-09-20T15:03:04.037

另一种方法（可能不是最快的）是确定 ln(x) / ln(2) 是否为整数。

* * *

## 回答 #16

> 赞同：-4
> 
> 时间：2013-02-02T01:34:14.510

这是 T-SQL (SQL Server) 中的位移方法：

```
SELECT CASE WHEN @X>0 AND (@X) & (@X-1)=0 THEN 1 ELSE 0 END AS IsPowerOfTwo 
```

它比做对数四次要快得多（第一次设置得到十进制结果，第二组得到整数设置和比较）

# asp.net-mvc - ASP.NET MVC 中的代码隐藏

> ID：108320
> 
> 赞同：9
> 
> 时间：2008-09-20T14:35:11.467
> 
> 标签：asp.net-mvc

除了设置 ViewPage 的通用参数之外，ASP.NET MVC 中视图文件背后的代码的目的是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-09T05:30:12.667

这是我从[我自己的帖子](https://stackoverflow.com/questions/489415/how-to-get-a-codebehind-file-for-an-asp-net-mvc-view-in-rc1-to-be-created-by-de)中摘录的为什么代码隐藏有用的原因列表。我敢肯定还有很多。

*   数据绑定旧版 ASP.NET 控件 - 如果替代方案不可用或需要临时解决方案。
*   查看需要递归以创建某种嵌套或分层 HTML 的逻辑。
*   查看使用临时变量的逻辑。我拒绝在我的标签汤中定义局部变量！我至少希望它们作为视图类的属性。
*   仅特定于一个视图或模型且不属于 HtmlHelper 的逻辑。作为旁注，我认为 HtmlHelper 不应该知道任何“模型”类。如果它知道模型中定义的类（例如 IEnumerable，但我认为您不应该拥有一个采用 ProductModel 的 HtmlHelper。当您键入 Html+dot 时，HtmlHelper 方法最终会从您的所有视图中可见我真的想尽可能地减少这个列表。
*   如果我想编写代码，使用 HtmlGenericControl 和该命名空间中的其他类以面向对象的方式生成我的 HTML（或者我有现有的代码来执行我想要移植的操作）。
*   如果我打算将来使用不同的视图引擎怎么办。我可能希望将一些逻辑保留在标签汤之外，以便以后更容易重用。
*   如果我希望能够重命名我的模型类并让它自动重构我的视图，而无需转到 view.aspx 并更改类名，该怎么办？
*   如果我正在与一个我不信任的 HTML 设计师协调，他不会弄乱“标签汤”，并且想要在 .aspx.cs 文件中编写除非常基本的循环之外的任何内容。
*   如果要根据视图的默认排序选项对数据进行排序。如果您有多个只能从视图访问的排序选项，我真的认为控制器不应该为您排序数据。
*   您实际上想在实际看起来像 .cs 而不是 HTML 的代码中调试视图逻辑。
*   您想编写可能会在以后分解并在其他地方重用的代码——您只是还不确定。
*   您想对可能成为新 HtmlHelper 的东西进行原型设计，但您尚未决定它是否足够通用以保证创建 HtmlHelper。（与上一点基本相同）
*   您想创建一个辅助方法来呈现局部视图，但需要通过从主页视图中提取数据并为基于当前循环迭代的局部控件创建模型来为其创建模型。
*   您认为在单个函数中编写复杂的逻辑是一种过时且不可维护的做法。
*   您在 RC1 之前完成了它并且没有遇到任何问题！

**是的！有些视图根本不需要代码隐藏。**

**是的！除了 .cs 文件之外，还要创建一个愚蠢的 .designer 文件，这很糟糕。**

**是的！让每个视图旁边的那些小 + 符号有点烦人。**

**但是**- 不将数据访问逻辑放在代码隐藏中并不难。

他们肯定不是[邪恶](http://stevesmithblog.com/blog/codebehind-files-in-asp-net-mvc-are-evil/)的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-22T14:38:48.990

最终，你问自己的问题是：

此代码是否 A) 处理、存储、检索、对数据执行操作或分析，或 B) 帮助显示数据？

如果答案是 A，则它属于您的控制器。如果答案是 B，那么它属于视图。

如果是 B，它最终变成了风格问题。如果您有一些相当长的条件操作来尝试确定是否向用户显示某些内容，那么您可能会将这些条件操作隐藏在属性后面的代码中。否则，似乎大多数人使用 <% %> 和 <%= %> 标记将代码内嵌到前端。

最初，我将*所有*显示逻辑都放在 <% %> 标记中。但最近我开始在我的代码中放置任何混乱的东西（例如冗长的条件）以保持我的 XHML 干净。这里的诀窍是纪律——开始在后面的代码中编写业务逻辑太诱人了，这正是你*不*应该在 MVC 中做的事情。

如果您尝试从传统的 ASP.NET 迁移到 ASP.NET MVC，您可能会避免使用后面的代码，直到您对实践有所了解（尽管它仍然不会阻止您将业务逻辑放入 <% % >。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T14:41:50.497

没有目的。只是不要使用它，除了设置模型

```
ViewPage<Model> 
```

有关更多信息，请参阅[此](http://stevesmithblog.com/blog/codebehind-files-in-asp-net-mvc-are-evil/)博文。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T15:04:13.487

在[这个 Blogpost](http://www.squaredroot.com/post/2008/01/MVC-Strongly-Type-ViewPages-Without-A-Code-Behind.aspx "博文")是一个删除背后代码的工作示例。我唯一遇到的问题是它无法在类上设置命名空间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-21T14:38:25.163

代码隐藏提供了一些强类型以及您在视图中获得的智能感知支持。如果您不关心这两个功能中的任何一个，则可以将其删除。

例如，我通常使用 NVelocity ViewEngine，因为它干净且非常直接。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-20T14:52:19.427

这是一个很好的问题。ASP.NET 环境中不存在 MVC，不使用特定的 MVC 模式。

视图 = aspx

控制器 = aspx.cs（代码隐藏）

模型 = POCO（普通旧 C#/VB/.NET 对象）

我想知道为什么 MVC 框架的附加功能很有帮助。我使用 Java nd MVC 和[Java Struts进行了大量工作](http://struts.apache.org/)几年前（2001 年），发现 MVC 中的概念是解决当时 Internet 应用程序组织和开发问题的方法，但后来发现代码隐藏简化了控制器概念，并且可以更快地开发和与他人交流。我确信其他人不同意我的观点，我对其他想法持开放态度。我看到MVC最大的价值是互联网开发的前端控制器模式，互联网应用的单一入口源。但是，另一方面，这种模式用当前的 ASP.NET 技术实现起来相当简单。我听其他人说单元测试是推理。我也可以理解，我们在 2001 年将 JUnit 与我们的 MVC 框架一起使用；但我不相信它简化了使用 te MVC 框架的测试。

谢谢阅读！

# compiler-construction - 有哪些 Fortran 编译器？

> ID：108327
> 
> 赞同：11
> 
> 时间：2008-09-20T14:36:54.503
> 
> 标签：compiler-construction, fortran

当今时代有哪些 Fortran 编译器，您会推荐哪些？请列出它支持的 Fortran 版本、它工作的平台（例如 *nix / Windows）以及它是否需要花钱。

（标准操作系统每个答案一个等）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-20T14:39:46.760

GFortran - GCC 的一部分是免费的，可以在 GCC 所在的任何地方工作。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-20T14:44:45.187

英特尔 Fortran 编译器 - 适用于 Linux、Windows 和 Mac。它需要花钱，但 Linux 版本可以免费供个人使用。在许多情况下，它可以生成任何 Fortran 编译器中最快的代码，并支持所有版本的 Fortran，包括大部分 2003 标准。

Polyhedron 软件对各种 Fortran 编译器进行了很好的比较：

[http://www.polyhedron.com/compare0html](http://www.polyhedron.com/compare0html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-20T14:48:12.510

OpenWatcom 无需任何费用，可在 Win32、Win16、OS/2 和 DOS 上编译 F77。

（只是为了给你一个非主流的选择）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-20T17:14:49.210

我使用过并发现有用的 Fortran 编译器（按推荐用法排序）：

1.  [英特尔 Visual FORTRAN](http://www.intel.com/cd/software/products/asmo-na/eng/278834.htm) ($) Windows、Linux、MAC
2.  [G95](http://www.g95.org/)（免费）Windows（cygwin），Linux
3.  [NAG Fortran 编译器](http://www.nag.co.uk/nagware/np.asp)($) Windows、Linux、MAC
4.  [Lahey Fortran](http://www.lahey.com/products.htm) ($) Windows, Linux

如果你不想花任何钱......使用G95。在工作中，我们支持 IVF 和 G95。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T22:18:28.293

[Portland Group](http://www.pgroup.com/) Fortran 编译器需要花钱，可用于 Windows、Mac 和 Linux。我个人在 Linux 上使用过它，同时编写了几个使用 MPI 进行并行计算的程序，并且从未遇到任何问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-20T17:09:03.797

还有[Lahey Fortran](http://www.lahey.com/)。它们支持 32 位和 64 位 Windows 和 Linux。这需要钱，但有时购买一个有支持的商业产品比花 3 周时间试图找出开源编译器的深渊中的一些错误更便宜。我们在使用 g77 和 gfortran 时遇到了不止两个问题，尤其是在优化低级内存操作时，这对调试来说是一种折磨。并不是说我不支持开源，而是在某些方面，商业产品是一种更具成本效益的解决方案。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-20T15:07:23.433

我也遇到过一些使用[Silverfrost Fortran 编译器](http://www.silverfrost.com/11/ftn95/overview.asp)的人。它涵盖 Fortran 77,90 和 95，仅适用于 Windows。该网站经常提到 .NET。除了编译 hello world 之外，我自己从未使用过它——免费[的“个人”](http://www.silverfrost.com/32/ftn95/ftn95_personal_edition.asp)版本为您的可执行文件添加了一个烦人的 nag 屏幕。我猜商业版提供了更好的体验，但我无法评论，

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-22T18:27:23.293

英特尔 Fortran 是最好的。它的历史可以追溯到 1960 年代。英特尔从惠普那里购买了它，在此之前，惠普从康柏那里获得了它，康柏是从数字设备公司获得的。它是旧的可靠的 Vax Fortran，在此之前，Vax 最初是在 PDP-11 计算机上开发的。

Gcc Gfortran 还有一个叫做 G95 的 fork，当然两者都是免费的。G95 还有一个名为 Photran 的 Eclipse IDE。这里有对两者的讨论： [http ://www.megasolutions.net/fortran/g95-versus-gfortran-50009.aspx](http://www.megasolutions.net/fortran/g95-versus-gfortran-50009.aspx)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-20T14:41:32.760

[英特尔 Fortran。](http://www.intel.com/cd/software/products/asmo-na/eng/compilers/278834.htm)适用于 Windows 和 Linux。对于商业应用程序不是免费的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-20T17:14:34.860

g95 是另一个跨平台/多 CPU 架构的免费 Fortran 编译器。我过去使用它取得了成功，而且它似乎经常更新。支持 F77、F90 和 F2003 的某些部分

[http://www.g95.org/](http://www.g95.org/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-20T14:51:52.440

还有[NAG Fortran 编译器](http://www.nag.co.uk/nagware/np/NP_trial.asp)- 适用于 Linux、Windows 和 Mac。它是商业的，但可以免费试用。它严格遵守 Fortran 标准，并受到与我一起工作的许多人的强烈推荐。

它涵盖了 Fortran 77、90、95 和 2003 标准的大部分内容。Linux 和 Mac OS 版本是命令行工具，但 Windows 版本带有一个不错的 IDE。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-08-23T07:53:45.287

[Oracle Solaris Studio](http://www.oracle.com/technetwork/server-storage/solarisstudio/overview/index.html)带有自己的Fortran 编译器，免费且可在 Linux 和 Solaris 上运行。它支持 Fortran 95 和部分 Fortran 2003。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-08-23T08:01:58.920

[Open64](http://www.open64.net/)编译器套件为 Linux 提供了另一个免费的 Fortran 编译器。它至少支持 Fortran 95 标准。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-30T13:28:29.350

我刚刚安装了最新版本的 Red Hat；它提供了损坏的 gfortran 和损坏的 gnu OpenMP。与大多数编译器一样，安装更新非常重要：gcc.gnu.org/wiki/GFortran 如果我对视频驱动程序没有那么大的困难，我会使用 SuSE 以更好地支持当前的 gnu 编译器。
在 SuSE 上，英特尔编译器往往会要求您选中“不支持的安装”框。这并不意味着您无法获得支持，只是该组合尚未经过全面测试。

# .net - 检查 vb.net 中的外部依赖项

> ID：108346
> 
> 赞同：1
> 
> 时间：2008-09-20T14:41:23.307
> 
> 标签：.net

我以前从未真正做过的事情，但确保我的应用程序使用的任何外部程序集/dll 可用，并且可能是正确版本的最佳方法是什么。

我编写了一个依赖于 System.Data.SQLite.dll 的应用程序，我在缺少该 dll 的机器上对其进行了测试，而我的应用程序只是抛出了一个运行时异常，因为该 dll 丢失了。我怎样才能捕获这个错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T14:52:28.960

您要做的是使用反射来检查程序集是否可以加载到内存中。将其包装在 try..catch 块中并处理来自它的任何特定异常。

```
Try
    Assembly.Load("System.Data.SQLite, Version=1.0.22.0, Culture=neutral, PublicKeyToken=DB937BC2D44FF139");
Catch ex As FileNotFoundException
    //do something here
End Try 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T15:19:53.557

*（我已经在这个上面设置了社区拥有的标志，因为这主要是我的直觉，我可能在某个地方错过了关键的一步）*

**简短的回答：**使用安装程序将依赖项与应用程序一起部署通常是一个好主意。正如您所注意到的，没有它们，您的应用程序工作的机会就很小。

**长答案：**好的，假设如果目标机器上安装了其他东西，您想提供*额外的功能。*以下是一些通用指南：

1.  对于具有引用可能已卸载程序集中定义的类型的字段、属性、事件、参数或返回值的任何类型：必须用接口包装，并替换所有其他字段、参数、返回值或本地使用接口的变量声明。
2.  任何时候你去构造一个之前包装的类，你必须使用这个`System.Activator.CreateInstance`方法，并把它包装在一个针对 7 种不同异常类型的 try/catch 过滤器中：

    *   `FileNotFoundException`
    *   `FileLoadException`
    *   `BadImageFormatException`
    *   `TypeLoadException`
    *   `MissingMethodException`
    *   `MissingMemberException`
    *   `MissingFieldException`

    如果其中一个被捕获，您必须提供先前创建的接口的替代实现，或者编写代码以便在引用该对象时检查 null 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T14:51:21.723

您应该在主循环之外捕获错误。
或者，如果您想运送/定位自己的程序集，您可以尝试覆盖程序集探测：[链接](https://blogs.msdn.com/junfeng/archive/2006/03/27/561775.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T14:52:37.820

您可以使用安装项目为您的应用程序构建安装程序。这将分析所有静态依赖项并生成一个安装程序，以确保目标机器获得所需的一切。

# asp.net - 在 Mac 上为 ASP.NET 设置 Mono 的最佳方法

> ID：108380
> 
> 赞同：7
> 
> 时间：2008-09-20T14:52:52.157
> 
> 标签：asp.net, macos, mono, developer-machine

我最近获得了对 Mac 的访问权限。我想知道是否有人对在 Mac 上设置[Mono](http://www.mono-project.com/Main_Page)以开发和执行 ASP.NET 有任何提示/建议？大多数资源都指向 Linux 实现，这些实现往往与 Mac 的做事方式有很大不同。任何提示或建议都会有所帮助

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-20T22:46:26.917

要启动开发 ASP.NET 服务器，只需打开终端窗口并从 Mono 安装运行“xsp2”命令。

与 Linux 相比，Mac 上的 Mono 发行版中唯一缺少的是 Apache 模块，如果您想在 OSX 上将应用程序部署到生产环境中，则必须自己编译该模块。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T22:57:48.653

自从我第一次使用[mono osx](http://www.mono-project.com/Mono:OSX)以来，他们已经添加了 Cocoa# 和 ObjC#，但是 ASP.NET 核心非常可靠（大约 3 年前）。实际上，您可以根据 Onion 书编写 Web 应用程序，并将它们移植到 IIS 上几乎没有困难。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T15:06:12.687

老实说，如果你想运行 ASP.NET，你可能不想让它在 MacOS 上通过单声道运行。基于 Intel 的 Macintoshes 可以启动 Windows，Apple 为其各种设备提供 Windows 驱动程序作为[Boot Camp 的一部分。](http://www.apple.com/macosx/features/bootcamp.html)

或者，您可以以不到 100 美元的价格购买[Parallels](http://www.parallels.com/)或[VMWare Fusion 。](http://www.vmware.com/products/fusion/)我使用 VMWare Fusion。还有一个来自 Sun 的 Mac 版本的[VirtualBox](http://www.virtualbox.org/)，它是免费的，虽然我从未使用过。

对于 MacOS 开发（不是 .Net），您真的应该尝试[Apple 的 XCode](http://developer.apple.com/tools/xcode/)。这是免费的。虽然 Python、Ruby 和其他语言可用于开发本地 Mac 应用程序，但它主要关注 Objective C。

**编辑 9/22：**很抱歉，您和[Kev](http://stackoverflow.com/users/419/kev)都认为这是一个有用的答案。让我尝试扩展一下：Macintosh 有很长的软件从 Windows 移植的历史，应用主题使 GUI 元素看起来像 Mac，但满足于最低成本的移植。这样的软件永远不会像真正的 Mac 应用程序那样运行：它不响应 AppleEvents，它不能编写脚本，它只处理跨平台剪贴板格式等。

您可以自由地做任何您想做的事情，包括使用单声道运行 ASP.NET。如果它是供您个人使用的，请自行淘汰。但是，如果您正在考虑将其作为在 Mac 版本中提供支持 Web 的产品的一种方式，我敦促您重新考虑。Mac 市场在很大程度上拒绝了此类产品。你会得到一些销售，但没有什么能比你得到一个表现得像一个本地 Mac 应用程序的应用程序。

现在，让投票继续下去。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-01-04T18:37:41.137

您还可以通过 NGINX 运行 ASP.NET - 使用以下命令易于安装：sudo brew install nginx

请参阅安装教程：[http](http://www.robertmulley.com/tutorial/nginx-install-and-setup-mac-os-x-mavericks/) ://www.robertmulley.com/tutorial/nginx-install-and-setup-mac-os-x-mavericks/ 查看您的应用程序的配置步骤：[http ://www.mono-project.com /docs/web/fastcgi/nginx/](http://www.mono-project.com/docs/web/fastcgi/nginx/) （注意：请参阅我的拉取请求，因为现在应该使用 fastcgi-mono-server4 - [https://github.com/mono/website/pull/82/files](https://github.com/mono/website/pull/82/files)）

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-20T14:55:55.533

为什么在 Mac 上使用 Mono？运行 Parallels、VMWare 或 Boot Camp。

# apache - windows2003上的Apache和IIS并排（都监听80端口）

> ID：108387
> 
> 赞同：46
> 
> 时间：2008-09-20T14:55:06.287
> 
> 标签：apache, iis, networking, windows-server-2003

有什么好的方法可以做到这一点？甚至可以干净地做吗？

理想情况下，我想使用数据包头来决定哪个服务器应该处理请求。但是，如果有更简单/更好的方法，请告诉我。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-20T15:06:38.177

两台服务器不可能在同一个 IP 地址上监听同一个端口：由于单个套接字只能由单个进程打开，因此只有为某个 IP/端口组合配置的第一个服务器会成功绑定，而第二个服务器将失败。

因此，您将需要一种解决方法来实现您想要的。[最简单的可能是在您的主要 IP/端口组合上运行 Apache，并使用mod_rewrite](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)将 IIS 的请求（应配置为不同的 IP 和/或端口）路由到它。

请记住，运行 IIS 的备用 IP 和端口应该可以被连接到服务器的客户端访问：如果您只有一个可用的 IP 地址，则应注意选择通常不会被防火墙阻止的 IIS 端口（8080 可能是一个不错的选择，或者 443，即使您运行的是常规 HTTP 而不是 SSL）

PS 另外，请注意，在允许其他服务器在同一服务器上的任何 IP 地址上的端口 80 上运行之前，您确实需要使用 httpcfg 修改 IIS 默认配置：请参阅 Micky McQuade 的答案以了解执行该操作的过程...

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-09-20T14:59:33.530

我发现[这篇文章](https://web.archive.org/web/20081007112215/http://www.prismix.com/blog/2006/06/running_apache_and_iis_6_toget.cfm)建议有两个独立的 IP 地址，以便两者都可以监听端口 80。

有一点需要注意，由于套接字池，您必须在 IIS 中进行更改。以下是基于上述链接的说明：

1.  `httpcfg.exe`从 Win2003 CD 上的支持工具区域提取该实用程序。
2.  停止所有 IIS 服务：`net stop http /y`
3.  让 IIS 仅侦听我为 IIS 指定的 IP 地址：`httpcfg set iplisten -i 192.168.1.253`
4.  确保：（`httpcfg query iplisten`列出的 IP 是 IIS 将监听的唯一 IP 地址，没有其他 IP 地址。）
5.  重新启动 IIS 服务：`net start w3svc`
6.  启动 Apache 服务

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-01-04T03:15:47.617

对于在一台服务器上只有**一个 IP 地址**和**多个站点**的人，您可以将 IIS 配置为侦听除 之外的端口`80`，例如`8080`通过在其每个站点的属性中设置 TCP 端口（包括默认端口）。

在 Apache 中，启用`mod_proxy`and `mod_proxy_http`，然后添加一个包罗万象的 VirtualHost（在所有其他主机之后），以便 Apache 不明确处理的请求被“转发”到 IIS。

```
<VirtualHost *:80>
    ServerName foo.bar
    ServerAlias *
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:8080/
</VirtualHost> 
```

现在，您可以让 Apache 为某些站点提供服务，而 IIS 为其他站点提供服务，而对用户来说没有明显的区别。

**编辑：**您的 IIS 站点不得在其响应中的任何 URL 中包含其端口号，包括标头。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T14:44:35.443

您至少需要 mod_proxy 和 mod_proxy_http 两者都是发行版的一部分（但不是每次都自动构建）。然后你可以看这里：[http ://httpd.apache.org/docs/2.2/mod/mod_proxy.html](http://httpd.apache.org/docs/2.2/mod/mod_proxy.html)

虚拟主机上下文中最简单的配置是：

```
ProxyPass         /winapp http://127.0.0.1:8080/somedir/

ProxyPassReverse  /winapp http://127.0.0.1:8080/somedir/ 
```

（根据您的 webapp，实际配置可能会变得更加复杂。）这会透明地将路径 winapp/ 上的每个请求重定向到 windows 服务器，并将结果输出传输回客户端。

注意：注意交付页面中的链接：它们不会被重写，因此如果您通常在应用程序中使用相对链接，则可以省去很多麻烦，例如

```
<a href=../pics/mypic.jpg"> 
```

而不是每个链接都是绝对的通常的集成噩梦：

```
<a href="http://myinternalhostname/somedir/crappydesign.jpg"> 
```

后者几乎每次都很糟糕！

对于重写页面中的链接，有 mod_proxy_html（不要与 mod_proxy_http 混淆！）但这是另一个故事，也是一个残酷的故事。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-22T14:42:21.557

两个不同的 IP 地址（如推荐）或一个 Web 服务器正在反向代理另一个（正在侦听端口 <>80）。

例如：Apache 监听 80 端口，IIS 监听 8080 端口。每个 http 请求都首先到达 Apache（当然）。然后，您可以决定将每个请求转发到特定（命名的虚拟）域或将包含特定目录（例如[http://www.example.com/winapp/](http://www.example.com/winapp/)）的每个请求转发到 IIS。

这个概念的优点是您只有一台服务器而不是两台服务器来监听公众，您更灵活，因为使用两台不同的服务器。

缺点：一些 web 应用程序设计糟糕，集成到反向代理基础设施中真的很痛苦。一个工作的 IIS webapp 依赖于一个工作的 Apache，所以我们有一些相互依赖。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-14T08:51:12.953

我看到这是一篇相当老的帖子，但在寻找这个问题的答案时遇到了这个问题。在阅读了一些答案后，他们似乎很啰嗦，所以大约 5 分钟后，我设法非常简单地解决了这个问题，如下所示：

Apache 的 httpd.conf 将监听端口保留为 80，将“服务器名称”保留为 FQDN/IP :80。

现在对于 IIS，转到左侧导航下拉菜单中的管理服务 > IIS 管理器 > '站点' > 在右侧窗口中选择顶行（默认网站），然后在右侧绑定。

现在选择 http > edit 并更改为 81 并输入服务器/pc 的本地 IP，并在域中输入您的 FQDN (www.domain.com) 或关闭外部 IP。

重新启动两台服务器，确保您的端口在路由器和防火墙上都打开，完成。

这听起来很冗长，但实际上花了 5 分钟的时间。完美运行。

系统：Windows 8、IIS 8、Apache 2.2

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-08-07T15:48:23.800

安装 Windows 10 我遇到了这个问题：apache(ipv4) 和 spooler service(ipv6) 监听同一个 80 端口。

我解决了编辑 apache httpd.conf 文件更改行

听 80

到

听 127.0.0.1:80

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-08-12T12:58:36.800

这并不完全正确。例如，对于 HTTP，Windows 支持基于 URL 的端口共享，允许多个进程使用相同的 IP 地址和端口。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-20T15:01:58.920

您将需要使用不同的 IP 地址。服务器，无论是 Apache 还是 IIS，都会根据 IP 和端口来获取流量，这些都是它们必须监听的。一旦它开始侦听，它就会使用标头（例如服务器名称）来过滤和确定正在访问的站点。您不能这样做，只需更改请求中的服务器名称

# c++ - 这是封装集合的好（正确）方法吗？

> ID：108389
> 
> 赞同：3
> 
> 时间：2008-09-20T14:56:35.610
> 
> 标签：c++, collections, encapsulation

```
class MyContainedClass {
};

class MyClass {
public:
  MyContainedClass * getElement() {
    // ...
    std::list<MyContainedClass>::iterator it = ... // retrieve somehow
    return &(*it);
  }
  // other methods
private:
  std::list<MyContainedClass> m_contained;
}; 
```

虽然 msdn 说不`std::list`应该在删除或插入时执行元素重定位，但返回指向列表元素的指针是否是一种好的和常用的方法？

PS：我知道我可以使用指针集合（并且必须使用`delete`析构函数中的元素），共享指针集合（我不喜欢）等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T17:20:51.537

好好想想*你*真正想要什么`MyClass`。我注意到一些程序员为他们的集合编写包装器只是出于一种习惯，不管他们是否有超出标准 STL 集合所满足的任何特定需求。如果这是你的情况，那么`typedef std::list<MyContainedClass> MyClass`就完成它。

如果您*确实*有打算在 中实现的操作`MyClass`，那么封装的成功将更多地取决于您为它们提供的接口，而不是您如何提供对底层列表的访问。

没有冒犯的意思，但是...由于您提供的信息有限，*闻起来*就像您在下注：公开内部数据，因为您无法弄清楚如何实现客户端代码所需的操作`MyClass`...或者可能，因为您甚至还不*知道*您的客户端代码需要哪些操作。这是尝试在需要它的高级代码之前编写低级代码的经典问题；您知道您将使用哪些数据，但还没有真正确定您将使用它做什么，因此您编写了一个将原始数据一直公开到顶部的类结构。你最好在这里重新考虑你的策略。

* * *

[@cos](https://stackoverflow.com/questions/108389/is-it-a-good-correct-way-to-encapsulate-a-collection#113052)：

> 当然，我封装 MyContainedClass 不仅仅是为了封装。让我们举个更具体的例子：

您的示例并没有减轻我对您在知道容器将用于什么之前编写容器的恐惧。您的示例容器包装器`Document`共有三个方法：`NewParagraph()`、`DeleteParagraph()`和`GetParagraph()`，所有这些方法都对包含的集合 ( `std::list`) 进行操作，*并且所有这些方法都*`std::list`与提供“开箱即用”的操作密切相关。`Document`从某种意义上封装 std::list ，客户端不需要知道它在实现中的使用......但实际上，它只不过是一个门面 - 因为您正在向客户端提供指向存储在列表中的对象的原始指针，所以客户端仍然隐式绑定到实现。

> 如果我们将对象（不是指针）放到容器中，它们将被自动销毁（这很好）。

好坏取决于系统的需求。这个实现的意思很简单：文档拥有`Paragraph`s，当`Paragraph`从文档中删除 a 时，指向它的任何指针都会立即变为无效。这意味着您在实现以下内容时必须*非常*小心：

> 除了使用段落集合之外的其他对象，但不拥有它们。

现在你有问题了。您的对象具有指向拥有的对象`ParagraphSelectionDialog`的指针列表。如果您不小心协调这两个对象，则- 或另一个客户端通过- 可能会使!的实例持有的部分或全部指针无效。没有简单的方法来捕捉这一点 - 指向有效的指针看起来与指向 deallocated 的指针相同，甚至可能最终指向一个有效但不同的实例！由于允许甚至期望客户端保留和取消引用这些指针，因此一旦它们从公共方法返回，即使它保留对象的所有权，它们也会失去对它们的控制。`Paragraph``Document``Document``Document``ParagraphSelectionDialog``Paragraph``Paragraph``Paragraph``Document``Paragraph`

这是不好的。你最终会得到一个不完整的、肤浅的、封装、泄漏的抽象，在某些方面它比根本没有抽象还要糟糕。因为你隐藏了实现，你的客户不知道你的接口指向的对象的生命周期。大多数时候您可能会很幸运，因为大多数`std::list`操作不会使对它们未修改的项目的引用无效。一切都会好起来的......直到错误`Paragraph`被删除，您发现自己被困在通过调用堆栈进行跟踪的任务中，以寻找使该指针保持太长的客户端。

修复很简单：返回值或对象，只要需要，就可以存储，并在使用前进行验证。这可能是像必须传递给以`Document`换取可用引用的序数或 ID 值一样简单，或者像引用计数智能指针或弱指针一样复杂......这真的取决于您的特定需求客户。首先指定客户端代码，然后编写您`Document`的服务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T15:16:29.103

我看不到封装它的用途，但这可能只是我。无论如何，返回引用而不是指针对我来说更有意义。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T15:20:02.233

一般来说，如果您的“包含的类”确实包含在您的“MyClass”中，那么 MyClass 不应该允许外人触及其私有内容。

因此，MyClass 应该提供方法来操作包含的类对象，而不是返回指向它们的指针。因此，例如，诸如“增加第无数个包含对象的值”之类的方法，而不是“这里是指向第无数个包含对象的指针，随心所欲地使用它”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T15:23:04.970

## 这取决于...

这取决于您希望您的类封装多少，以及您想要隐藏或显示什么。

我看到的代码对我来说似乎没问题。你是对的，如果另一个数据/迭代器的修改/删除，std::list 的数据和迭代器不会失效。

现在，返回指针将隐藏您使用 std::list 作为内部容器的事实，并且不会让用户浏览其列表。返回迭代器可以让类的用户更自由地浏览这个列表，但他们会“知道”他们正在访问一个 STL 容器。

这是你的选择，我猜。

请注意，如果它 == std::list<>.end()，那么这段代码会有问题，但我想你已经知道了，这不是本次讨论的主题。

不过，我在下面总结了一些替代方案：

## 使用`const`将有助于...

您返回一个非常量指针的事实使您的对象的用户可以静默地修改他/她可以得到的任何 MyContainedClass，而无需告诉您的对象。

取而代之或返回一个指针，您可以返回一个 const 指针（并为您的方法添加 const 后缀）以阻止用户在不使用您批准的访问器的情况下修改列表中的数据（一种`setElement`？）。

```
 const MyContainedClass * getElement() const {
    // ...
    std::list<MyContainedClass>::const_iterator it = ... // retrieve somehow
    return &(*it);
  } 
```

这将在一定程度上增加封装。

## 参考资料呢？

如果您的方法不能失败（即它总是返回一个有效的指针），那么您应该考虑返回引用而不是指针。就像是：

```
 const MyContainedClass & getElement() const {
    // ...
    std::list<MyContainedClass>::const_iterator it = ... // retrieve somehow
    return *it;
  } 
```

不过，这与封装无关.. :-p

## 使用迭代器？

为什么不返回迭代器而不是指针？如果对您来说，上下导航列表是可以的，那么迭代器会比指针更好，并且使用方式大多相同。

如果要避免用户修改数据，请将迭代器设为 const_iterator。

```
 std::list<MyContainedClass>::const_iterator getElement() const {
    // ...
    std::list<MyContainedClass>::const_iterator it = ... // retrieve somehow
    return it;
  } 
```

好的一面是用户将能够浏览列表。不好的一面是用户会知道它是一个 std::list，所以......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T15:24:31.847

Scott Meyers 在他的《[Effective STL: 50 Specific Ways to Improvement Your Use of the Standard Template Library](https://rads.stackoverflow.com/amzn/click/com/0201749629) 》一书中说，尝试封装你的容器是不值得的，因为它们都不能完全替代另一个容器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T06:52:01.087

**简单的方法**

@cos，对于您展示的示例，我想说在 C++ 中创建此系统的最简单方法是不麻烦引用计数。您所要做的就是确保在根 Document 被销毁之前，程序流首先销毁包含对集合中对象（段落）的直接引用的对象（视图）。

**艰难的道路**

但是，如果您仍想通过引用跟踪来控制生命周期，则可能必须将引用保存到层次结构的更深处，以便 Paragraph 对象保存对根 Document 对象的反向引用，这样，只有当最后一个段落对象被销毁时 Document 对象才会被破坏。

此外，在 Views 类中使用段落引用以及传递给其他类时，也必须作为引用计数接口传递。

**韧性**

与我在开头列出的简单方案相比，这开销太大。它避免了各种对象计数开销，更重要的是，继承您的程序的人不会陷入纵横交错的引用依赖线程陷阱中。

**替代平台**

这种工具可能更容易在支持和促进这种编程风格的平台（如 .NET 或 Java）中执行。

**你仍然需要担心内存**

即使使用这样的平台，您仍然必须确保以适当的方式取消引用您的对象。其他出色的参考文献可能会在眨眼间耗尽你的记忆。所以你看，引用计数并不是好的编程实践的灵丹妙药，尽管它有助于避免大量的错误检查和清理，当应用整个系统时，这大大简化了程序员的任务。

**推荐**

也就是说，回到你原来的问题，这个问题引起了所有引用计数的疑虑——可以直接从集合中公开你的对象吗？

程序不能存在于所有类/程序的所有部分真正相互依赖的地方。不，那是不可能的，因为程序是您的类/模块如何交互的运行表现。理想的设计只能最小化依赖关系，而不是完全消除它们。

所以我的意见是，*是的，将集合中对象的引用暴露给需要使用它们的其他对象并不是一个坏习惯，前提是您以理智的方式执行此操作*

1.  确保您的程序中只有少数类/部分可以获得此类引用，以确保最小的相互依赖性。

2.  确保传递的引用/指针是接口而不是具体对象，以避免具体类之间的相互依赖。

3.  确保引用不会进一步深入到程序中。

4.  在清理满足这些引用的实际对象之前，确保程序逻辑负责销毁依赖对象。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T16:37:15.307

未来的程序员会比您的自定义封装更熟悉 STL，因此您应该尽可能避免这样做。在应用程序生命周期的后期会出现您没有想到的边缘情况，而 STL 是失败的，并且经过了很好的审查和记录。

此外，大多数容器都支持一些类似的操作，例如开始结束推送等。因此，如果您更改容器，则在代码中更改容器类型应该是相当简单的。例如向量到双端队列或映射到 hash_map 等。

假设您出于更深层次的原因仍想这样做，我想说正确的方法是实现 list 实现的所有方法和迭代器类。当您不需要更改时，将呼叫转发到成员列表呼叫。修改和转发或在您需要做一些特殊的地方做一些自定义操作（您首先决定这样做的原因）

如果 STl 类设计为继承自它会更容易，但出于效率考虑，决定不这样做。谷歌“从 STL 类继承”以获得更多关于此的想法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T15:02:27.767

我认为更大的问题是您隐藏了集合的类型，因此即使您使用不移动元素的集合，您将来也可能会改变主意。在外部这是不可见的，所以我会说这样做不是一个好主意。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T15:32:09.893

当您从列表中添加或删除事物时，std::list 不会使任何迭代器、指针或引用无效（显然，要删除的项目除外），因此以这种方式使用列表不会中断。

正如其他人指出的那样，您可能不想直接访问此类的私有位。因此将函数更改为：

```
 const MyContainedClass * getElement() const {
    // ...
    std::list<MyContainedClass>::const_iterator it = ... // retrieve somehow
    return &(*it);
  } 
```

可能会更好，或者如果您总是返回一个有效的 MyContainedClass 对象，那么您可以使用

```
 const MyContainedClass& getElement() const {
    // ...
    std::list<MyContainedClass>::const_iterator it = ... // retrieve somehow
    return *it;
  } 
```

以避免调用代码必须处理 NULL 指针。

# c# - Fluent NHibernate 多对多

> ID：108396
> 
> 赞同：22
> 
> 时间：2008-09-20T14:58:51.377
> 
> 标签：c#, nhibernate, fluent-nhibernate, fluent

我正在使用 Fluent NHibernate，并且在与我的一个类建立多对多关系时遇到了一些问题。这可能是一个愚蠢的错误，但我一直在努力让它工作。无论如何，我有几个具有多对多关系的类。

```
public class Person
{
    public Person()
    {
        GroupsOwned = new List<Groups>();
    }

    public virtual IList<Groups> GroupsOwned { get; set; }
}

public class Groups
{
    public Groups()
    {
        Admins= new List<Person>();
    }

    public virtual IList<Person> Admins{ get; set; }
} 
```

映射看起来像这样

人： ...

```
HasManyToMany<Groups>(x => x.GroupsOwned)
    .WithTableName("GroupAdministrators")
    .WithParentKeyColumn("PersonID")
    .WithChildKeyColumn("GroupID")
    .Cascade.SaveUpdate(); 
```

团体：...

```
 HasManyToMany<Person>(x => x.Admins)
    .WithTableName("GroupAdministrators")
    .WithParentKeyColumn("GroupID")
    .WithChildKeyColumn("PersonID")
    .Cascade.SaveUpdate(); 
```

当我运行我的集成测试时，基本上我正在创建一个新的人和组。将组添加到 Person.GroupsOwned。如果我从存储库中取回 Person 对象，则 GroupsOwned 等于初始组，但是，如果我检查 Group.Admins 上的计数，则当我取回组时，计数为 0。Join 表具有 GroupID 和PersonID 保存在其中。

感谢您提供的任何建议。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-20T17:57:59.857

它向表中添加两条记录的事实看起来像您缺少一个[反向属性](http://docs.jboss.org/hibernate/orm/4.1/manual/en-US/html_single/#example-many-to-many-mapping-file)。由于人和组都在更改，NHibernate 将关系保持两次（每个对象一次）。inverse 属性专门用于避免这种情况。

I'm not sure about how to add it in mapping in code, but the link shows how to do it in XML.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T18:08:55.570

@Santiago I think you're right.

The answer might just be that you need to remove one of your ManyToMany declarations, looking more at Fluent it looks like it might be smart enough to just do it for you.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T16:44:01.173

您确定将 Person 添加到 Groups.Admin 吗？您必须创建两个链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T17:48:43.233

你有三张桌子对吧？

人员、组和组管理员

当你添加到双方你得到

人（id 为 p1） 组（id 为 g1）

在 GroupAdministrators 你有两列和一个表

(p1,g1)

(p1,g1)

您的单元测试代码如下所示。

```
Context hibContext //Built here
Transaction hibTrans //build and start the transaction.

Person p1 = new Person()
Groups g1 = new Groups()

p1.getGroupsOwned().add(g1)
g1.getAdmins().add(p1)

hibTrans.commit();
hibContext.close(); 
```

然后在您的测试中，您创建了一个新的上下文，并测试以查看上下文中的内容，然后您得到了正确的结果，但是您的表都被弄乱了？

# database - 您可以推荐哪些具有独立存储支持的嵌入式数据库？

> ID：108399
> 
> 赞同：3
> 
> 时间：2008-09-20T14:59:38.147
> 
> 标签：database, embedded-database, isolatedstorage

我正在寻找支持[隔离存储](http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx)的嵌入式数据库引擎。目前我知道 VistaDB。你还有什么可以推荐的？

要求很简单：

*   xcopy 部署
*   支持隔离存储
*   最好是免费的

请注意，使用 IS 时您不知道文件的确切路径。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T12:12:12.293

继[劳埃德的](https://stackoverflow.com/questions/108399/what-embedded-database-with-isolated-storage-support-can-you-recommend#108441)回答之后，有一个名为[uSqlite](http://users.libero.it/irwin/)的 sqlite 包装库，它应该可以直接或通过最小的改动实现您所追求的目标。

* * *

为了详细说明（对于 Aku 的后续问题），我建议修改`uSQLstPoll()`例程（包含在 uSQLst.c 中）。在这个阶段，您拥有来自连接到您的客户端的端口和地址信息（包含在 sockaddr 中）。根据该信息，您可以修改`uSQLst`结构，以修改您要连接到的本地数据库文件的文件名。

免责声明：请注意，这是基于少量调查的可能解决方案。建议在部署之前进行更彻底的调查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-20T16:55:46.787

[VistaDB](http://www.vistadb.net)似乎[支持](http://www.vistadb.net/vistadb3/technical/zero-config.aspx)隔离存储。我已经使用它将近一年了，并且对它非常满意。

它不是免费的，但第 4 版的起价为[60 美元](https://accounts.vistadb.net/pricelist.aspx)（即将发布）。有一个免费的[Express Edition](http://www.vistadb.net/vistadb3/vistadb-expresslimits.aspx)，但这仅适用于非商业项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T15:13:41.967

Sqlite 非常适合嵌入并且是免费的。

它不直接支持隔离存储，但是看起来自己调用隔离存储 API 并将生成的文件名作为它应该使用的文件名传递给 Sqlite 是相当简单的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-20T04:16:41.723

我知道这个问题已经很老了，但是 VistaDB 确实支持独立存储并且是 XCopy 可部署的。虽然我们没有免费版本，但它是一个商业产品。

[查看关于VistaDB 优势](https://stackoverflow.com/questions/55273/what-are-the-advantages-of-vistadb)的 SO 帖子，了解有关我们支持的其他内容的更多信息。

独立存储支持不仅仅是不知道您的文件名。您必须使用流，您必须不需要文件级锁定，您不能在同一路径中创建临时文件，您必须了解 UAC 和空间限制。

AFAIK VistaDB 是唯一支持独立存储的嵌入式 sql 数据库。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-20T15:15:10.887

[你可以用Firebird Embedded](http://firebirdsql.org)做类似的事情。
虽然它本身不支持独立存储，但为每个用户创建一个新数据库应该很容易。

# sql - SQL Server 上的 INSERT OR UPDATE 解决方案

> ID：108403
> 
> 赞同：680
> 
> 时间：2008-09-20T15:00:47.833
> 
> 标签：sql, sql-server, database, insert, upsert

假设表结构为`MyTable(KEY, datafield1, datafield2...)`。

通常我想更新现有记录，或者如果它不存在则插入一条新记录。

本质上：

```
IF (key exists)
  run update command
ELSE
  run insert command 
```

写这个的最佳执行方式是什么？

* * *

## 回答 #1

> 赞同：420
> 
> 时间：2008-09-20T15:06:11.063

不要忘记交易。性能很好，但简单的（如果存在..）方法非常危险。
当多个线程将尝试执行插入或更新时，您很容易得到主键违规。

@Beau Crawford 和 @Esteban 提供的解决方案显示了一般的想法，但容易出错。

为避免死锁和 PK 违规，您可以使用以下内容：

```
begin tran
if exists (select * from table with (updlock,serializable) where key = @key)
begin
   update table set ...
   where key = @key
end
else
begin
   insert into table (key, ...)
   values (@key, ...)
end
commit tran 
```

或者

```
begin tran
   update table with (serializable) set ...
   where key = @key

   if @@rowcount = 0
   begin
      insert into table (key, ...) values (@key,..)
   end
commit tran 
```

* * *

## 回答 #2

> 赞同：395
> 
> 时间：2008-10-28T15:09:45.307

请参阅我[对之前非常相似的问题的详细回答](https://stackoverflow.com/questions/234)

[@Beau Crawford's](https://stackoverflow.com/a/108416/1165522)在 SQL 2005 及更低版本中是一个好方法，但如果你授予代表它应该交给[第一个人 SO it](https://stackoverflow.com/questions/13540)。唯一的问题是对于插入它仍然是两个 IO 操作。

MS Sql2008`merge`从 SQL:2003 标准引入：

```
merge tablename with(HOLDLOCK) as target
using (values ('new value', 'different value'))
    as source (field1, field2)
    on target.idfield = 7
when matched then
    update
    set field1 = source.field1,
        field2 = source.field2,
        ...
when not matched then
    insert ( idfield, field1, field2, ... )
    values ( 7,  source.field1, source.field2, ... ) 
```

现在它实际上只是一个 IO 操作，但是代码很糟糕:-(

* * *

## 回答 #3

> 赞同：196
> 
> 时间：2008-09-20T15:04:03.923

做一个UPSERT：

```
UPDATE MyTable SET FieldA=@FieldA WHERE Key=@Key

如果@@ROWCOUNT = 0
   插入 MyTable (FieldA) 值 (@FieldA)

```

[http://en.wikipedia.org/wiki/Upsert](http://en.wikipedia.org/wiki/Upsert)

* * *

## 回答 #4

> 赞同：115
> 
> 时间：2014-01-18T20:12:46.380

很多人会建议你使用`MERGE`，但我警告你不要这样做。默认情况下，它不会保护您免受并发和竞争条件的影响，就像多个语句一样，它还引入了其他危险：

*   [小心使用 SQL Server 的 MERGE 语句](http://www.mssqltips.com/sqlservertip/3074/use-caution-with-sql-servers-merge-statement/?utm_source=AaronBertrand)
*   [所以，你想使用 MERGE，是吗？](https://sqlblog.org/merge)

即使有这种“更简单”的语法可用，我仍然更喜欢这种方法（为简洁起见，省略了错误处理）：

```
BEGIN TRANSACTION;

UPDATE dbo.table WITH (UPDLOCK, SERIALIZABLE) 
  SET ... WHERE PK = @PK;

IF @@ROWCOUNT = 0
BEGIN
  INSERT dbo.table(PK, ...) SELECT @PK, ...;
END

COMMIT TRANSACTION; 
```

*   [请停止使用此 UPSERT 反模式](https://sqlperformance.com/2020/09/locking/upsert-anti-pattern)

很多人会这样建议：

```
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

BEGIN TRANSACTION;

IF EXISTS (SELECT 1 FROM dbo.table WHERE PK = @PK)
BEGIN
  UPDATE ...
END
ELSE
BEGIN
  INSERT ...
END
COMMIT TRANSACTION; 
```

但所有这些都确保您可能需要读取表两次以定位要更新的行。在第一个示例中，您只需要定位行一次。（在这两种情况下，如果从初始读取中未找到任何行，则会发生插入。）

其他人会这样建议：

```
BEGIN TRY
  INSERT ...
END TRY
BEGIN CATCH
  IF ERROR_NUMBER() = 2627
    UPDATE ...
END CATCH 
```

但是，如果除了让 SQL Server 捕获原本可以阻止的异常之外没有其他原因会花费更多的成本，除非在几乎每个插入都失败的罕见情况下，这是有问题的。我在这里证明了很多：

*   [在进入 TRY/CATCH 之前检查潜在的约束违规](http://www.mssqltips.com/sqlservertip/2632/checking-for-potential-constraint-violations-before-entering-sql-server-try-and-catch-logic/?utm_source=AaronBertrand)
*   [不同错误处理技术的性能影响](http://www.sqlperformance.com/2012/08/t-sql-queries/error-handling)

* * *

## 回答 #5

> 赞同：68
> 
> 时间：2008-09-20T15:02:30.603

```
IF EXISTS (SELECT * FROM [Table] WHERE ID = rowID)
UPDATE [Table] SET propertyOne = propOne, property2 . . .
ELSE
INSERT INTO [Table] (propOne, propTwo . . .) 
```

**编辑：**

唉，即使对我自己不利，我也必须承认，在没有选择的情况下执行此操作的解决方案似乎更好，因为它们以更少的步骤完成任务。

* * *

## 回答 #6

> 赞同：39
> 
> 时间：2008-09-20T15:49:03.817

如果您想一次 UPSERT 多条记录，您可以使用 ANSI SQL:2003 DML 语句 MERGE。

```
MERGE INTO table_name WITH (HOLDLOCK) USING table_name ON (condition)
WHEN MATCHED THEN UPDATE SET column1 = value1 [, column2 = value2 ...]
WHEN NOT MATCHED THEN INSERT (column1 [, column2 ...]) VALUES (value1 [, value2 ...]) 
```

查看[在 SQL Server 2005 中模拟 MERGE 语句](http://sqlserver-tips.blogspot.com/2006/09/mimicking-merge-statement-in-sql.html)。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2010-01-21T05:47:51.407

尽管对此发表评论已经很晚了，但我想使用 MERGE 添加一个更完整的示例。

此类 Insert+Update 语句通常称为“Upsert”语句，可以在 SQL Server 中使用 MERGE 来实现。

这里给出了一个很好的例子： [http ://weblogs.sqlteam.com/dang/archive/2009/01/31/UPSERT-Race-Condition-With-MERGE.aspx](http://weblogs.sqlteam.com/dang/archive/2009/01/31/UPSERT-Race-Condition-With-MERGE.aspx)

上面也解释了锁定和并发场景。

我将引用相同的内容以供参考：

```
ALTER PROCEDURE dbo.Merge_Foo2
      @ID int
AS

SET NOCOUNT, XACT_ABORT ON;

MERGE dbo.Foo2 WITH (HOLDLOCK) AS f
USING (SELECT @ID AS ID) AS new_foo
      ON f.ID = new_foo.ID
WHEN MATCHED THEN
    UPDATE
            SET f.UpdateSpid = @@SPID,
            UpdateTime = SYSDATETIME()
WHEN NOT MATCHED THEN
    INSERT
      (
            ID,
            InsertSpid,
            InsertTime
      )
    VALUES
      (
            new_foo.ID,
            @@SPID,
            SYSDATETIME()
      );

RETURN @@ERROR; 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2014-10-28T15:28:45.527

```
/*
CREATE TABLE ApplicationsDesSocietes (
   id                   INT IDENTITY(0,1)    NOT NULL,
   applicationId        INT                  NOT NULL,
   societeId            INT                  NOT NULL,
   suppression          BIT                  NULL,
   CONSTRAINT PK_APPLICATIONSDESSOCIETES PRIMARY KEY (id)
)
GO
--*/

DECLARE @applicationId INT = 81, @societeId INT = 43, @suppression BIT = 0

MERGE dbo.ApplicationsDesSocietes WITH (HOLDLOCK) AS target
--set the SOURCE table one row
USING (VALUES (@applicationId, @societeId, @suppression))
    AS source (applicationId, societeId, suppression)
    --here goes the ON join condition
    ON target.applicationId = source.applicationId and target.societeId = source.societeId
WHEN MATCHED THEN
    UPDATE
    --place your list of SET here
    SET target.suppression = source.suppression
WHEN NOT MATCHED THEN
    --insert a new line with the SOURCE table one row
    INSERT (applicationId, societeId, suppression)
    VALUES (source.applicationId, source.societeId, source.suppression);
GO 
```

用您需要的任何内容替换表和字段名称。注意*使用 ON*条件。然后为 DECLARE 行上的变量设置适当的值（和类型）。

干杯。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-11-07T22:35:50.173

这取决于使用模式。人们必须查看使用大图，而不会迷失在细节中。例如，如果使用模式是在创建记录后 99% 更新，那么“UPSERT”是最佳解决方案。

在第一次插入（命中）之后，将是所有单语句更新，没有 if 或 buts。插入的“where”条件是必要的，否则它将插入重复项，并且您不想处理锁定。

```
UPDATE <tableName> SET <field>=@field WHERE key=@key;

IF @@ROWCOUNT = 0
BEGIN
   INSERT INTO <tableName> (field)
   SELECT @field
   WHERE NOT EXISTS (select * from tableName where key = @key);
END 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2016-10-12T18:03:17.917

您可以使用`MERGE`语句，该语句用于如果不存在则插入数据或如果存在则更新。

```
MERGE INTO Employee AS e
using EmployeeUpdate AS eu
ON e.EmployeeID = eu.EmployeeID` 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-08-25T06:43:09.590

如果执行 UPDATE if-no-rows-updated 然后 INSERT 路由，请考虑先执行 INSERT 以防止出现竞争条件（假设没有干预 DELETE）

```
INSERT INTO MyTable (Key, FieldA)
   SELECT @Key, @FieldA
   WHERE NOT EXISTS
   (
       SELECT *
       FROM  MyTable
       WHERE Key = @Key
   )
IF @@ROWCOUNT = 0
BEGIN
   UPDATE MyTable
   SET FieldA=@FieldA
   WHERE Key=@Key
   IF @@ROWCOUNT = 0
   ... record was deleted, consider looping to re-run the INSERT, or RAISERROR ...
END 
```

除了避免竞争条件之外，如果在大多数情况下记录已经存在，那么这将导致 INSERT 失败，从而浪费 CPU。

从 SQL2008 开始，使用 MERGE 可能更可取。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-12T12:25:23.580

MS SQL Server 2008 引入了 MERGE 语句，我相信它是 SQL:2003 标准的一部分。正如许多人所表明的那样，处理单行情况并不是什么大问题，但是在处理大型数据集时，需要一个游标，随之而来的所有性能问题。在处理大型数据集时，MERGE 语句将非常受欢迎。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-07-20T11:07:43.033

如果您首先尝试更新然后插入，那么竞争条件真的很重要吗？假设您有两个线程想要为键**key**设置值：

线程 1：值 = 1
线程 2：值 = 2

示例竞争条件场景

1.  **键**未定义
2.  线程 1 更新失败
3.  线程 2 因更新而失败
4.  线程 1 或线程 2 中的一个恰好插入成功。例如线程 1
5.  另一个线程因插入而失败（带有错误重复键） - 线程 2。

    *   结果：要插入的两个踏板中的“第一个”决定了价值。
    *   想要的结果：写入数据（更新或插入）的 2 个线程中的最后一个应该决定值

但; 在多线程环境中，操作系统调度程序决定线程执行的顺序——在上面的场景中，我们有这种竞争条件，是操作系统决定了执行的顺序。即：从系统的角度说“线程 1”或“线程 2”是“第一”是错误的。

当线程 1 和线程 2 的执行时间如此接近时，竞争条件的结果就无关紧要了。唯一的要求应该是其中一个线程应该定义结果值。

对于实现：如果更新后插入导致错误“重复键”，则应视为成功。

此外，当然永远不要假设数据库中的值与您上次写入的值相同。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-07-21T01:19:07.270

在每个人因为害怕这些直接运行您的存储过程的邪恶用户而跳到 HOLDLOCK-s 之前 :-) 让我指出**您必须通过设计保证新 PK-s 的唯一性**（身份密钥、Oracle 中的序列生成器、用于外部 ID-s，索引覆盖的查询）。这就是问题的阿尔法和欧米茄。如果你没有这个，宇宙中的任何 HOLDLOCK 都不会拯救你，如果你有，那么你在第一次选择时不需要任何东西（或首先使用更新）。

Sprocs 通常在非常受控的条件下运行，并假设一个受信任的调用者（中间层）。这意味着如果一个简单的 upsert 模式（更新+插入或合并）曾经看到重复的 PK，这意味着您的中间层或表设计中存在错误，并且在这种情况下 SQL 会大喊错误并拒绝记录是很好的。在这种情况下放置 HOLDLOCK 等于吃异常和接收潜在的错误数据，除了降低你的性能。

话虽如此，使用 MERGE 或 UPDATE 然后 INSERT 在您的服务器上更容易并且更不容易出错，因为您不必记住添加 (UPDLOCK) 到第一次选择。此外，如果您正在小批量进行插入/更新，则需要了解您的数据才能确定事务是否合适。它只是一组不相关的记录，那么额外的“封装”交易将是有害的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-07-03T12:14:10.490

当并发请求插入语句时，我尝试了以下解决方案，它对我有用。

```
begin tran
if exists (select * from table with (updlock,serializable) where key = @key)
begin
   update table set ...
   where key = @key
end
else
begin
   insert table (key, ...)
   values (@key, ...)
end
commit tran 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-08-13T09:47:02.530

您可以使用此查询。在所有 SQL Server 版本中工作。这很简单，也很清楚。但是您需要使用 2 个查询。如果不能使用 MERGE 可以使用

```
 BEGIN TRAN

    UPDATE table
    SET Id = @ID, Description = @Description
    WHERE Id = @Id

    INSERT INTO table(Id, Description)
    SELECT @Id, @Description
    WHERE NOT EXISTS (SELECT NULL FROM table WHERE Id = @Id)

    COMMIT TRAN 
```

注意：请解释答案否定

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-09-01T13:49:51.170

假设您要插入/更新单行，最优化的方法是使用 SQL Server 的`REPEATABLE READ`事务隔离级别：

```
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
BEGIN TRANSACTION

    IF (EXISTS (SELECT * FROM myTable WHERE key=@key)
        UPDATE myTable SET ...
        WHERE key=@key
    ELSE
        INSERT INTO myTable (key, ...)
        VALUES (@key, ...)

COMMIT TRANSACTION 
```

此隔离级别将**防止/阻止后续可重复读取事务**`WHERE key=@key`在当前运行的事务打开时访问同一行 ( )。另一方面，**另一行的操作不会被阻塞**（`WHERE key=@key2`）。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-11-25T09:47:20.090

MySQL（以及随后的 SQLite）也支持 REPLACE INTO 语法：

```
REPLACE INTO MyTable (KEY, datafield1, datafield2) VALUES (5, '123', 'overwrite'); 
```

这会自动识别主键并找到要更新的匹配行，如果没有找到则插入新行。

文档：[https ://dev.mysql.com/doc/refman/8.0/en/replace.html](https://dev.mysql.com/doc/refman/8.0/en/replace.html)

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-09-20T15:39:39.843

在 SQL Server 2008 中，您可以使用 MERGE 语句

* * *

## 回答 #20

> 赞同：-3
> 
> 时间：2008-09-20T15:07:36.210

执行 if exists ... else ... 至少需要执行两个请求（一个用于检查，一个用于执行操作）。以下方法只需要一个存在记录的地方，如果需要插入则需要两个：

```
DECLARE @RowExists bit
SET @RowExists = 0
UPDATE MyTable SET DataField1 = 'xxx', @RowExists = 1 WHERE Key = 123
IF @RowExists = 0
  INSERT INTO MyTable (Key, DataField1) VALUES (123, 'xxx') 
```

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2008-09-20T15:08:03.540

我通常会按照其他几位发帖人所说的先检查它是否存在，然后再做正确的路径。这样做时您应该记住的一件事是，由 sql 缓存的执行计划对于一个路径或另一个路径可能不是最优的。我相信最好的方法是调用两个不同的存储过程。

```
第一SP：
如果存在
   调用 SecondSP (UpdateProc)
别的
   调用 ThirdSP (InsertProc)

```

现在，我不经常听从自己的建议，所以要持保留态度。

* * *

## 回答 #22

> 赞同：-3
> 
> 时间：2008-09-20T15:08:51.090

如果您使用 ADO.NET，则 DataAdapter 会处理此问题。

如果你想自己处理，这是这样的：

确保您的键列上有一个主键约束。

那么你：

1.  进行更新
2.  如果更新失败，因为键的记录已经存在，请执行插入。如果更新没有失败，您就完成了。

你也可以反过来做，即先插入，如果插入失败则进行更新。通常第一种方法更好，因为更新比插入更频繁。

* * *

## 回答 #23

> 赞同：-10
> 
> 时间：2008-09-20T15:02:26.627

做一个选择，如果你得到结果，更新它，如果没有，创建它。

# asp.net - 在使用网络服务器加载它们之前，如何编译 Asp.Net Aspx 页面？

> ID：108405
> 
> 赞同：35
> 
> 时间：2008-09-20T15:01:49.593
> 
> 标签：asp.net

Visual Studio 在 aspx 页面中隐藏拼写错误（而不是背后的代码）真的很烦人。如果编译器会编译它们，我会得到一个编译错误。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-20T15:10:37.170

在编译时编译页面。在此处查看 Mike Hadlow 的帖子：

[http://mikehadlow.blogspot.com/2008/05/compiling-aspx-templates-using.html](http://mikehadlow.blogspot.com/2008/05/compiling-aspx-templates-using.html)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-01-11T19:02:43.893

转到您的项目属性。转到**构建事件**选项卡。

在**Post-build event 命令行：**文本区域中，编写以下内容（对于 .NET 4.0）：

```
%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet_compiler.exe -v / -p "$(SolutionDir)$(ProjectName)" 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-20T15:04:06.607

Resharper 将捕获 ASPX 页面代码中的错误，所有这些都无需编译。在 imo 上运行良好，并且比以后编译更好。

编辑：Resharper 还有一个解决方案范围的错误检查器。'Resharper->Windows->解决方案中的错误'。它将分析您的整个解决方案并给出它找到的所有内容的综合列表，包括 aspx 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T15:15:08.810

我相信您应该始终编译 ASP.NET 应用程序。在某些情况下，我的客户另有要求。在 Visual Studio 中，当您选择发布您的网站时，可以选择对其进行编译。这是 Microsoft 的 MSDN 文章，其中提供了有关编译站点的信息。

[http://msdn.microsoft.com/en-us/library/ms178466.aspx](http://msdn.microsoft.com/en-us/library/ms178466.aspx)

HTML 问题等将显示为“警告”而不是错误。因此，您必须检查日志。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T15:29:37.513

有可能预编译整个网络：通常只有在使用页面时才会编译页面。

预编译网页，请参考[MSDN](http://msdn.microsoft.com/en-us/library/ms227972.aspx)

# documentation - 有谁知道一个好的 MAML 编辑器

> ID：108429
> 
> 赞同：14
> 
> 时间：2008-09-20T15:09:19.467
> 
> 标签：documentation, sandcastle, helpfile, xml-editor, maml

在工作中，我们使用 Sandcastle 来创建帮助文件。我使用 SandCastleGUI 已经有一段时间了，我正在寻找一种在帮助文件中创建其他页面的方法。这些页面以称为 MAML 的 XML 格式编写。唯一的问题是我找不到适合这些文件格式的任何合适的编辑器。

我正在寻找一个所见即所得的编辑器来创建和编辑其他文档页面。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-13T19:01:58.987

您可以使用具有所见即所得支持的通用 XML 编辑器，例如[Oxygen](http://www.oxygenxml.com/)或[Serna](http://www.syntext.com/products/serna-free/)。您将需要一个用于 MAML 的 Xml Schema 或 DTD，我假设在 SDK 或类似的某个地方有一个。可能更难的部分是您需要一个样式表，将 XML 呈现为编辑器可以使用的显示格式，以提供文档的 WYSIWYG 视图。

它适用于标准 XML 格式，例如 Docbook，但我不知道找到/创建 MAML 所需的样式表有多容易。但通常没有理由不能做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-11-27T13:37:42.587

最后我找到了一个解决方案，[SandCastle Help File Builder](http://shfb.codeplex.com/)的好人已经包含了一个 HTML 到 MAML 转换器。
那里有很多很好的 HTML 编辑器——现在我可以使用其中一个，然后将结果转换为 MAML

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-23T16:58:49.290

不知道您是否仍在寻找解决方案，但我一直在查看帮助编辑器并遇到可能有用的代码项目文章。该文章可在[http://www.codeproject.com/KB/dotnet/DocMounter_2_Sandcastle.aspx](http://www.codeproject.com/KB/dotnet/DocMounter_2_Sandcastle.aspx)找到。它具有一个可能正是您需要的编辑器。

# iis-7 - IIS7可以安装在XP上吗？

> ID：108432
> 
> 赞同：8
> 
> 时间：2008-09-20T15:10:36.153
> 
> 标签：iis-7, windows-xp

我很确定我知道这个问题的答案，但是缺少虚拟 Vista 安装，有没有办法在 XP 上安装 IIS 7？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T15:26:13.963

不，这意味着我这周要迁移到 vista，因为我必须使用 IIS7。

编辑：哈 - 投了赞成票！我认为这是一个同情投票。:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T16:04:17.227

我认为转移到 Win 2008 服务器会更好（设置为工作站，请参阅： http: [//www.win2008workstation.com/wordpress/](http://www.win2008workstation.com/wordpress/)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T15:16:11.197

它在 vista 上的模型与 xp 完全不同...... http.sys 和所有那种类型的东西。我不相信您可以在 XP 上安装 IIS 6。

# .net - .Net 中的持久二叉树/哈希表

> ID：108435
> 
> 赞同：5
> 
> 时间：2008-09-20T15:11:42.190
> 
> 标签：.net, hashtable, binary-tree, berkeley-db, dht

**我需要一个纯 .Net 持久哈希表/二进制树，功能类似于 berkeley-db Java 版本。**

从功能上讲，它应该以与 DHT 类似的方式运行，例如 memcached 和速度等，但它不必分发。本质上，我正在寻找一个持久的哈希表。

有没有人有任何想法或建议？

**这里也有一个类似的问题：[在 C# 中寻找一个简单的独立持久字典实现](https://stackoverflow.com/questions/100235/looking-for-a-simple-standalone-persistant-dictionary-implementation-in-c)**

保罗

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T22:19:55.407

这个怎么样？[SourceForge.net：Berkeley DB for .NET](http://sourceforge.net/projects/libdb-dotnet)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T17:11:19.890

您可能会考虑[缓存应用程序块](http://davidhayden.com/blog/dave/archive/2006/02/25/2814.aspx)或[System.Web.Caching](http://msdn.microsoft.com/en-us/library/ms972429.aspx)。两者都有将它们连接到作为后备存储的 SQL Server 数据库的方法。

另一种方法是使用 XML 或二进制格式化程序简单地序列化对象。（顺便可以用于深度克隆）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-06T02:25:43.633

作为替代方案，您可能会考虑使用诸如 Lucene.net 之类的索引引擎。

它会给你一个列表的东西会更好地索引，我相信容量，尽管这并不是真正的预期用途。预期用途是解析文件，但也可用于解析数据库。在我以前的工作地点，他们使用 Lucene（Java 实现）从数据库数据中按类别索引我们的产品目录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T16:32:56.627

您是否尝试过在 System.Collections.Generic 中使用内置集合？并使用序列化将小狗推送到 XML 文档或类似的东西。

# windows - 如何在 windows 的变量中获取命令的结果？

> ID：108439
> 
> 赞同：162
> 
> 时间：2008-09-20T15:13:28.503
> 
> 标签：windows, scripting, batch-file

我希望将命令的结果作为 Windows 批处理脚本中的变量获取（请参阅[如何在 bash 中获取命令的结果以获取](https://stackoverflow.com/questions/58207/using-the-result-of-a-command-as-an-argument-in-bash#58214)bash 脚本等效项）。首选可在 .bat 文件中运行的解决方案，但也欢迎使用其他常见的 Windows 脚本解决方案。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-09-20T15:37:20.147

多年来，谦逊**的 for command 积累了一些有趣的能力：**

```
D:\> FOR /F "delims=" %i IN ('date /t') DO set today=%i
D:\> echo %today%
Sat 20/09/2008 
```

请注意，它会`"delims="`覆盖默认的空格和制表符分隔符，以便 date 命令的输出一次被全部吞噬。

要捕获多行输出，它本质上仍然可以是单行输出（使用变量 lf 作为结果变量中的分隔符）：

```
REM NB:in a batch file, need to use %%i not %i
setlocal EnableDelayedExpansion
SET lf=-
FOR /F "delims=" %%i IN ('dir \ /b') DO if ("!out!"=="") (set out=%%i) else (set out=!out!%lf%%%i)
ECHO %out% 
```

要捕获管道表达式，请使用`^|`：

```
FOR /F "delims=" %%i IN ('svn info . ^| findstr "Root:"') DO set "URL=%%i" 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-09-20T16:23:21.097

如果您必须捕获所有命令输出，您可以使用这样的批处理：

```
@ECHO OFF
IF NOT "%1"=="" GOTO ADDV
SET VAR=
FOR /F %%I IN ('DIR *.TXT /B /O:D') DO CALL %0 %%I
SET VAR
GOTO END

:ADDV
SET VAR=%VAR%!%1

:END 
```

所有输出行都存储在用“！”分隔的 VAR 中。

但如果只需要单行控制台输出，请尝试：

```
@ECHO off
@SET MY_VAR=
FOR /F %%I IN ('npm prefix') DO @SET "MY_VAR=%%I"

@REM Do something with MY_VAR variable... 
```

@John：这有什么实际用途吗？我认为您应该观看 PowerShell 或任何其他能够轻松执行脚本任务的编程语言（Python、Perl、PHP、Ruby）

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-09-20T15:39:23.387

要获取当前目录，您可以使用以下命令：

```
CD > tmpFile
SET /p myvar= < tmpFile
DEL tmpFile
echo test: %myvar% 
```

虽然它使用的是临时文件，所以它不是最漂亮的，但它确实有效！'CD' 将当前目录放在 'tmpFile' 中，'SET' 加载 tmpFile 的内容。

这是带有“数组”的多行的解决方案：

```
@echo off

rem ---------
rem Obtain line numbers from the file
rem ---------

rem This is the file that is being read: You can replace this with %1 for dynamic behaviour or replace it with some command like the first example i gave with the 'CD' command.
set _readfile=test.txt

for /f "usebackq tokens=2 delims=:" %%a in (`find /c /v "" %_readfile%`) do set _max=%%a
set /a _max+=1
set _i=0
set _filename=temp.dat

rem ---------
rem Make the list
rem ---------

:makeList
find /n /v "" %_readfile% >%_filename%

rem ---------
rem Read the list
rem ---------

:readList
if %_i%==%_max% goto printList

rem ---------
rem Read the lines into the array
rem ---------
for /f "usebackq delims=] tokens=2" %%a in (`findstr /r "\[%_i%]" %_filename%`) do set _data%_i%=%%a
set /a _i+=1
goto readList

:printList
del %_filename%
set _i=1
:printMore
if %_i%==%_max% goto finished
set _data%_i%
set /a _i+=1
goto printMore

:finished 
```

但是您可能需要考虑迁移到另一个更强大的 shell 或为这些东西创建一个应用程序。它极大地扩展了批处理文件的可能性。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-20T15:22:55.937

您需要使用`SET`带有参数的命令`/P`并将输出定向到它。例如参见[http://www.ss64.com/nt/set.html](http://www.ss64.com/nt/set.html)。适用于 CMD，不确定 .BAT 文件

从评论到这篇文章：

> 该链接具有命令“ `Set /P _MyVar=<MyFilename.txt`”，表示它将设置`_MyVar`为从`MyFilename.txt`. 这可以用作“ `myCmd > tmp.txt`”和“ `set /P myVar=<tmp.txt`”。但它只会得到输出的第一行，而不是所有的输出

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-20T15:27:46.050

在“V”环境变量中设置最新文件的示例

```
FOR /F %I IN ('DIR *.* /O:D /B') DO SET V=%I 
```

在批处理文件中，您必须在循环变量中使用双前缀：

```
FOR /F %%I IN ('DIR *.* /O:D /B') DO SET V=%%I 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2018-01-17T16:29:57.377

我想对上述解决方案添加一点评论：

如果在路径中找到您的命令，或者如果命令是没有空格或特殊字符的 cmdpath，则所有这些语法都可以很好地工作。

但是，如果您尝试使用位于路径包含特殊字符的文件夹中的可执行命令，则需要将命令路径括在双引号 (") 中，然后 FOR /F 语法不起作用。

例子：

```
$ for /f "tokens=* USEBACKQ" %f in (
    `""F:\GLW7\Distrib\System\Shells and scripting\f2ko.de\folderbrowse.exe"" Hello '"F:\GLW7\Distrib\System\Shells and scripting"'`
) do echo %f
The filename, directory name, or volume label syntax is incorrect. 
```

或者

```
$ for /f "tokens=* USEBACKQ" %f in (
      `"F:\GLW7\Distrib\System\Shells and scripting\f2ko.de\folderbrowse.exe" "Hello World" "F:\GLW7\Distrib\System\Shells and scripting"`
) do echo %f
'F:\GLW7\Distrib\System\Shells' is not recognized as an internal or external command, operable program or batch file. 
```

或者

```
`$ for /f "tokens=* USEBACKQ" %f in (
     `""F:\GLW7\Distrib\System\Shells and scripting\f2ko.de\folderbrowse.exe"" "Hello World" "F:\GLW7\Distrib\System\Shells and scripting"`
) do echo %f
'"F:\GLW7\Distrib\System\Shells and scripting\f2ko.de\folderbrowse.exe"" "Hello' is not recognized as an internal or external command, operable program or batch file. 
```

在这种情况下，我发现使用命令并将其结果存储在变量中的唯一解决方案是将（临时）默认目录设置为命令本身：

```
pushd "%~d0%~p0"
FOR /F "tokens=* USEBACKQ" %%F IN (
    `FOLDERBROWSE "Hello world!" "F:\GLW7\Distrib\System\Layouts (print,display...)"`
) DO (SET MyFolder=%%F)
popd
echo My selected folder: %MyFolder% 
```

结果是正确的：

```
My selected folder: F:\GLW7\Distrib\System\OS install, recovery, VM\
Press any key to continue . . . 
```

当然，在上面的示例中，我假设我的批处理脚本与我的可执行命令之一位于同一文件夹中，以便我可以使用“%~d0%~p0”语法。如果这不是您的情况，那么您必须找到一种方法来定位您的命令路径并将默认目录更改为其路径。

注意：对于那些想知道的人，这里使用的示例命令（选择文件夹）是 FOLDERBROWSE.EXE。我在网站 f2ko.de ( [http://f2ko.de/en/cmd.php](http://f2ko.de/en/cmd.php) ) 上找到了它。

如果有人对通过复杂路径访问的那种命令有更好的解决方案，我会很高兴听到它。

吉尔斯

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-04-30T10:29:27.650

只需使用`FOR`命令的结果。例如（在批处理文件中）：

```
for /F "delims=" %%I in ('dir /b /a-d /od FILESA*') do (echo %%I) 
```

您可以将`%%I`用作您想要的值。就像这样：`%%I`。

并且预先`%%I`没有任何空格或CR字符，可用于比较！！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-20T16:52:04.490

如果您正在寻找[使用命令结果作为 bash 中的参数中提供的解决方案？](https://stackoverflow.com/questions/58207/using-the-result-of-a-command-as-an-argument-in-bash)

那么这里是代码：

```
@echo off
if not "%1"=="" goto get_basename_pwd
for /f "delims=X" %%i in ('cd') do call %0 %%i
for /f "delims=X" %%i in ('dir /o:d /b') do echo %%i>>%filename%.txt
goto end

:get_basename_pwd
set filename=%~n1

:end 
```

*   这将使用 CD 命令的结果调用自身，与 pwd 相同。
*   参数的字符串提取将返回文件名/文件夹。
*   获取此文件夹的内容并附加到 filename.txt

**[学分]**：感谢所有其他答案和对[Windows XP 命令](http://www.ss64.com/nt/)页面的一些挖掘。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-10-06T00:24:38.840

```
@echo off

ver | find "6.1." > nul
if %ERRORLEVEL% == 0 (
echo Win7
for /f "delims=" %%a in ('DIR "C:\Program Files\Microsoft Office\*Outlook.EXE" /B /P /S') do call set findoutlook=%%a
%findoutlook%
)

ver | find "5.1." > nul
if %ERRORLEVEL% == 0 (
echo WinXP
for /f "delims=" %%a in ('DIR "C:\Program Files\Microsoft Office\*Outlook.EXE" /B /P /S') do call set findoutlook=%%a
%findoutlook%
)
echo Outlook dir:  %findoutlook%
"%findoutlook%" 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-20T16:33:37.127

您可以在一个变量中捕获所有输出，但行将由您选择的字符（下例中的#）而不是实际的 CR-LF 分隔。

```
@echo off
setlocal EnableDelayedExpansion
for /f "delims=" %%i in ('dir /b') do (
    if "!DIR!"=="" (set DIR=%%i) else (set DIR=!DIR!#%%i)
)
echo directory contains:
echo %DIR% 
```

第二个版本，如果您需要逐行打印内容。这得益于“dir /b”不会有重复的输出行，因此在一般情况下它可能不起作用。

```
@echo off
setlocal EnableDelayedExpansion
set count=0
for /f "delims=" %%i in ('dir /b') do (
    if "!DIR!"=="" (set DIR=%%i) else (set DIR=!DIR!#%%i)
    set /a count = !count! + 1
)

echo directory contains:
echo %DIR%

for /l %%c in (1,1,%count%) do (
    for /f "delims=#" %%i in ("!DIR!") do (
        echo %%i
        set DIR=!DIR:%%i=!
    )
) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-02-13T12:59:11.817

```
@echo off
setlocal EnableDelayedExpansion
FOR /F "tokens=1 delims= " %%i IN ('echo hola') DO (
    set TXT=%%i
)
echo 'TXT: %TXT%' 
```

结果是'TXT：你好'

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-03-19T16:40:30.857

您应该使用该`for`命令，这是一个示例：

```
@echo off
rem Commands go here
exit /b
:output
for /f "tokens=* useback" %%a in (`%~1`) do set "output=%%a" 
```

然后你可以使用`call :output "Command goes here"`输出将在`%output%`变量中。

**注意：**如果您有一个多行命令输出，此工具将`set`输出到您的多行命令的最后一行。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-09-20T15:21:08.720

请参阅此[http://technet.microsoft.com/en-us/library/bb490982.aspx](http://technet.microsoft.com/en-us/library/bb490982.aspx)，它解释了您可以使用命令输出做什么。

# apache - 理想的多服务器 LAMP 环境

> ID：108440
> 
> 赞同：7
> 
> 时间：2008-09-20T15:13:39.080
> 
> 标签：apache, webserver, lamp, web-farm

有很多关于在单个盒子上设置 LAMP 堆栈的信息，或者可能将 MySQL 移动到它自己的盒子上，但超出此范围的增长似乎没有很好的文档记录。

我当前的 Web 环境存在容量问题，因此我正在寻找有关**配置调整**、确定**瓶颈**、**安全性**等 的**最佳实践。**

 ******我目前托管了大约 400 个站点，对冗余和安全性有相当的需求，因此我已经超越了单机解决方案——但还没有达到完整的 ISP 或专门的网络托管公司的水平。

任何人都可以指出我在**建立一个伟大的 apache 网络农场**以确保安全和未来扩展方面的一些好的专业知识的方向吗？

我的 Web 环境由 2 个冗余 MySQL 服务器、2 个冗余 Web 内容服务器、2 个负载平衡前端 apache 服务器组成，它们通过 nfs 挂载内容并在它们之间共享 apache 配置和会话目录，以及一个“开发人员”服务器，它也通过 nfs 挂载 web 内容，并包含所有开发人员帐户。

我对这个设置很满意，但它似乎过早地窒息了负载。

谢谢！！

- 更新 -

原来“负载阻塞”与`mod_log_sql`我用来将我的 apache 日志发送到 mysql 数据库有关。通过重新配置网络服务器以将其 sql 语句写入磁盘文件，然后创建一个单独的进程将这些语句提交到数据库，它允许网络服务器更快地释放其线程，并处理更大的负载。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T17:47:58.553

您需要能够识别瓶颈并测试改进。

要识别瓶颈，您需要使用系统的报告工具。一些例子：

*   MySQL 的查询日志很慢。
*   Linux 提供诸如平均负载、iostat、vmstat、netstat 等统计信息。
*   Apache 有访问日志和服务器状态页面。
*   编程语言有分析器，比如[Pear Benchmark](http://pear.php.net/package/Benchmark/)。

使用这些工具来识别最慢/最大的违规者并专注于他们。尝试改进和测量，看看它是否真的提高了性能。

这成为一个永无止境的循环，原因有两个：在复杂系统中总有一些东西可以更快，随着系统的增长，不同的功能将开始减慢。

根据您对系统的描述，我的第一个预感是 NFS 服务器上的磁盘 io 和网络 io，然后我会查看 MySQL 查询时间。我还会检查共享会话的性能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T15:49:58.137

教科书的做法是用真实的经验数据来识别瓶颈。

是[数据库](http://www.theserverside.com/news/thread.tss?thread_id=49368)，apache，网络，cpu，内存，io吗？您是否需要更多内存、[分片](http://www.chasingsparks.com/2008/01/sharding-with-c.html)（[+](http://www.datacenterknowledge.com/archives/2007/04/27/database-sharding-helps-high-traffic-sites)）、DiskIO、NFS 网络负载、用于进行全表扫描的 CPU？

当您发现问题出在哪里时，您可能会遇到这样的问题：由于代码的工作方式，它不足以扩展基础架构，并且您最终需要创建更多当前设置的实例或制作代码不同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-02T19:55:19.287

我还建议作为可扩展性的第一步，将您的内容卸载到像 Edgecast 这样的 CDN。将您当前的两个内容服务器用作附加的 Web 服务器。

# c++ - 汇编代码的数据结构？[研究]

> ID：108443
> 
> 赞同：7
> 
> 时间：2008-09-20T15:14:05.147
> 
> 标签：c++, c, dynamic, compilation

我打算创建一个优化的数据结构来保存汇编代码。这样我就可以完全负责将在这个结构上工作的优化算法。如果我可以在运行时编译。这将是一种动态执行。这可能吗？有没有人见过这样的东西？

我应该使用结构将结构链接到程序流中吗？对象更好吗？

```
struct asm_code {
   int type;
   int value;
   int optimized;
   asm_code *next_to_execute;
 } asm_imp; 
```

更新：我认为它会变成一个链表。

更新：我知道那里还有其他编译器。但这是一个军事绝密项目。所以我们不能相信任何代码。我们必须自己做这一切。

更新：好的，我想我只会生成基本的 i386 机器代码。但是，当它完成后，我如何跳转到我的内存 blob 中呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-20T15:31:55.837

有可能的。在软件渲染和图形等某些领域，动态代码生成甚至是主流。你发现在各种脚本语言中都有很多用处，在机器码中字节码的动态编译（.NET、Java，据我所知 Perl。最近 JavaScript 也加入了俱乐部）。

您还发现它也用于数学非常繁重的应用程序中，例如，如果您打算进行数千次这样的乘法运算，则从矩阵乘法中删除所有为零的乘法会有所不同。

我强烈建议您阅读代码的 SSA 表示。这是一种表示，其中每个原语都转换为所谓的三操作数形式，并且每个变量只分配一次（因此是相同的静态单一赋值形式）。

您可以对此类代码进行高阶优化，并且可以直接将该代码转换为可执行代码。不过，您不会在周末编写代码生成后端...

要了解 SSA 的外观，您可以尝试 LLVM 编译器。在他们的网站上，他们有一个小的“试用”小部件可以玩。您将 C 代码粘贴到一个窗口中，您会得到一些接近 SSA 表单的内容。

小例子它的样子：

让我们在 C 中使用这个整数平方根算法。（任意示例，我只是举了一些简单但不平凡的东西）：

```
unsigned int isqrt32 (unsigned int value) 
{
    unsigned int g = 0;
    unsigned int bshift = 15;
    unsigned int b = 1<<bshift;
    do {
        unsigned int temp = (g+g+b)<<bshift;
        if (value >= temp) {
            g += b;
            value -= temp;
        }
        b>>=1;
    } while (bshift--);
    return g;
} 
```

LLVM 把它变成：

```
define i32 @isqrt32(i32 %value) nounwind  {
entry:
    br label %bb

bb:     ; preds = %bb, %entry
    %indvar = phi i32 [ 0, %entry ], [ %indvar.next, %bb ]      
    %b.0 = phi i32 [ 32768, %entry ], [ %tmp23, %bb ]
    %g.1 = phi i32 [ 0, %entry ], [ %g.0, %bb ]     
    %value_addr.1 = phi i32 [ %value, %entry ], [ %value_addr.0, %bb ]      
    %bshift.0 = sub i32 15, %indvar 
    %tmp5 = shl i32 %g.1, 1 
    %tmp7 = add i32 %tmp5, %b.0 
    %tmp9 = shl i32 %tmp7, %bshift.0    
    %tmp12 = icmp ult i32 %value_addr.1, %tmp9      
    %tmp17 = select i1 %tmp12, i32 0, i32 %b.0      
    %g.0 = add i32 %tmp17, %g.1     
    %tmp20 = select i1 %tmp12, i32 0, i32 %tmp9     
    %value_addr.0 = sub i32 %value_addr.1, %tmp20           
    %tmp23 = lshr i32 %b.0, 1       
    %indvar.next = add i32 %indvar, 1       
    %exitcond = icmp eq i32 %indvar.next, 16    
    br i1 %exitcond, label %bb30, label %bb

bb30:       ; preds = %bb
    ret i32 %g.0
} 
```

我知道一开始看起来很可怕。它甚至不是纯粹的 SSA-Form。您对该表示的阅读越多，它就越有意义。而且您还会发现为什么这种表示法如今被如此广泛地使用。

将您需要的所有信息封装到数据结构中很容易。最后，您必须决定是否要使用枚举或字符串作为操作码名称等。

顺便说一句 - 我知道我没有给你数据结构，而是更正式但实用的语言以及进一步研究的建议。

这是一个非常好的和有趣的研究领域。

编辑：在我忘记之前：不要忽视 .NET 和 Java 的内置功能。这些语言允许您从程序内部的字节码或源代码编译并执行结果。

干杯，尼尔斯

* * *

关于您的编辑：如何使用代码执行二进制 blob：

跳转到二进制 blob 取决于操作系统和平台。简而言之，您使指令缓存无效，*也许*您必须写回数据缓存，并且您可能必须在您已将代码写入的内存区域上启用执行权限。

在 win32 上它相对容易，因为如果将代码放在堆上，指令缓存刷新似乎就足够了。

您可以使用此存根开始：

```
typedef void (* voidfunc) (void);

void * generate_code (void)
{
    // reserve some space
    unsigned char * buffer = (unsigned char *) malloc (1024);

    // write a single RET-instruction
    buffer[0] = 0xc3; 

    return buffer;
}

int main (int argc, char **args)
{
    // generate some code:
    voidfunc func = (voidfunc) generate_code();

    // flush instruction cache:
    FlushInstructionCache(GetCurrentProcess(), func, 1024);

    // execute the code (it does nothing atm)
    func();

    // free memory and exit.
    free (func);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T16:05:51.933

我假设你想要一个数据结构来保存某种指令模板，可能是从现有的机器代码中解析出来的，类似于：

```
add r1, r2, <int> 
```

您将拥有一个这种结构的数组，您将对这个数组进行一些优化，可能会更改其大小或构建一个新数组，并生成相应的机器代码。

如果您的目标机器使用可变宽度指令（例如 x86），则您无法确定数组大小，而无需实际完成对构建数组的指令的解析。此外，在从优化数组实际生成所有指令之前，您无法准确确定需要多少缓冲区。不过，您可以做出一个很好的估计。

查看[GNU 闪电](http://www.gnu.org/software/lightning/manual/lightning.html)。它可能对你有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T15:34:25.987

在 99% 的情况下，性能差异可以忽略不计。类的主要优点是 OOP 生成的代码比过程代码更好、更容易理解。

我不确定您使用哪种语言进行编码 - 请注意，在 C# 中，类和结构之间的主要区别在于结构是值类型，而类是引用类型。在这种情况下，您可能希望从结构开始，但仍向它们添加行为（构造函数、方法）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T15:37:04.343

不讨论优化代码的技术价值，在 C++ 代码中，在 POD 结构或完整对象之间进行选择主要是一个封装点。

内联代码将使编译器优化（或不优化）使用的构造函数/访问器。不会有性能损失。

## 首先，设置一个构造函数

如果您使用的是 C++ 编译器，请至少创建一个构造函数：

```
struct asm_code {
   asm_code()
      : type(0), value(0), optimized(0) {}

   asm_code(int type_, int value_, int optimized_)
      : type(type_), value(value_), optimized(_optimized) {}

   int type;
   int value;
   int optimized;
 }; 
```

至少，您的代码中不会有未定义的结构。

## 每种数据组合都可能吗？

使用像您使用的结构意味着任何类型都是可能的，具有任何值和任何优化。例如，如果我设置 type = 25, value = 1205 并且优化 = -500，那么就可以了。

如果您不希望用户将随机值放入您的结构中，请添加内联访问器：

```
struct asm_code {

   int getType() { return type ; }
   void setType(int type_) { VERIFY_TYPE(type_) ; type = type_ ; }

   // Etc.

   private :
      int type;
      int value;
      int optimized;
 }; 
```

这将使您可以控制结构中设置的内容，并更轻松地调试代码（甚至对代码进行运行时验证）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-16T20:31:22.960

经过一番阅读，我的结论是 common lisp 最适合这项任务。使用 lisp 宏，我拥有巨大的力量。

# sql-server - 拥有多个文件组是否有助于加快我的数据库速度？

> ID：108445
> 
> 赞同：6
> 
> 时间：2008-09-20T15:14:49.140
> 
> 标签：sql-server

目前，我正在开发一个使用 MS SQL Server 2005 进行相当密集计算的产品。在高层次上，我的产品架构基于“运行”的概念，每次我进行一些分析时，它都会存储在一个系列中运行表（每次运行约 100 个表）。

我遇到的问题是，当运行数在几个月后增长到大约 1,000 次左右时，数据库的性能似乎真的下降了，特别是简单的查询，如检查表是否存在或创建视图可以最多需要一到两秒钟。

我听说使用多个文件组（我目前没有这样做）可能会有所帮助。这是真的吗，如果是这样，为什么/如何帮助？此外，如果有其他建议，即使是使用更少表格的建议，我也愿意接受。我只是想加快数据库的速度，并希望使其处于可扩展的状态。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T16:08:03.397

在性能方面，使用单独的文件/文件组的最大好处是它可以让您将数据分布在多个物理磁盘上。这是有益的，因为使用多个磁盘，可以同时处理多个数据请求（并行通常比串行更快）。在所有其他条件相同的情况下，这往往会提高性能，但多少取决于您的特定数据集和您正在运行的查询。

根据您的描述，您担心的缓慢操作是创建表并检查表是否存在。如果您每次运行生成 100 个表，那么在 1000 次运行之后您将拥有 100,000 个表。我没有太多在单个数据库中创建这么多表的经验，但您可能会遇到跟踪数据库模式的系统表的限制。在这种情况下，通过将表分布在多个数据库中（这些数据库仍然可以都存在于同一个 SQL Server 实例中），您可能会看到一些好处。

一般来说，SQL Profiler 工具是查找慢查询的最佳起点。有数据列指示每个 SQL 批处理的 CPU 和 IO 成本，它们应该指出最严重的违规者。一旦你找到了问题查询，我会使用查询分析器为每个查询生成查询计划，看看你是否能分辨出是什么让它们变慢。通过打开查询窗口、输入查询并按 Ctrl+L 来执行此操作。对可能慢的问题的完整讨论会写满整本书，但要寻找的好东西是表扫描（对于大表来说非常慢）和低效的连接。

最后，您可能可以通过重写查询来改进事情，或者您可能必须对表模式进行更广泛的更改。例如，也许有一种方法可以每次运行只创建一个或几个表，而不是 1000 个。有关您的特定设置的更多细节将有助于我们给出更详细的答案。

我还推荐这个网站，以获取有关如何使事情变得更快的许多提示：

[http://www.sql-server-performance.com/](http://www.sql-server-performance.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T15:30:27.153

大约1000个什么？单行写入？多行事务？删除？

一般提示是将数据文件和日志文件放在不同的物理驱动器上。SQL Server 会跟踪对日志的每次写入，因此将它们放在不同的驱动器中应该会给您带来更好的性能。

但 SQL Server 调整取决于应用程序实际执行的操作。有一般的提示，但你必须衡量你自己的东西......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T20:10:40.130

当您谈到每次运行 100 个表时，您实际上是指您正在创建新的 SQL 表吗？如果是这样，我认为您的应用程序的体系结构可能是问题所在。我无法想象您需要那么多新表而不是多次重复使用相同的几个表并简单地添加一两列来区分运行的情况。

如果您已经在重用同一组表并且新的运行只是意味着这些表中的附加行，那么问题可能只是随着时间的推移，新数据会以多种方式损害性能。例如：

1.  一段时间后，表/索引可能会碎片化。确保所有表都有聚集索引。使用 sys.DM_DB_INDEX_PHYSICAL_STATS 检查碎片，如果需要对碎片进行碎片整理，请使用 REBUILD 选项发出 ALTER INDEX。
2.  这些表可能只是太大了，因此小表的低效现在在大表上很明显。查看表上的适当索引以提高性能。
3.  SQL Server 将缓存查询计划（尤其是存储过程），但如果表中的数据随时间发生显着变化，则该查询计划可能不再适用。查看 sp_recompile 以了解您的存储过程是否需要。

#2 是我在现实世界中最常看到的罪魁祸首。开发人员倾向于仅使用一小组测试数据进行开发，而忽略了正确的索引，因为您几乎可以使用 20 行的表来做任何事情，而且它看起来很快。

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T15:19:27.163

如果您将它们放在单独的驱动器上 - 不是逻辑驱动器而是物理驱动器，那么 IO 不会让您放慢速度。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T15:21:02.557

位于不同物理驱动器上的文件组将为您带来最大的性能提升，还可以拆分索引所在的位置，以便表写入和索引访问访问不同的磁盘。分区可以做很多事情，但这个一般概念是最大的速度影响来自哪里。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T15:24:34.903

它可以帮助提高性能。将某些表/元素移动到磁盘的不同文件区域/部分。这可以在一定程度上减少影响数据库的外部碎片量。

我还会查看其他因素，例如 tracesql，以确定查询等速度变慢的原因 - 可能还有其他因素，例如查询统计信息、SP 重新编译等更容易修复，并且可以为您带来更大的性能提升。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T15:03:36.357

在不同的物理驱动器上拆分表。如果你有那么多磁盘 IO，那么你需要一个不错的 IO 解决方案。Raid 10，快速磁盘，将日志和 DB 拆分到单独的驱动器上。

重新检查您的架构 - 您可以使用多个数据库吗？如果您一次创建 1000 个表，您很快就会遇到一些我以前没有处理过的有趣瓶颈。多个数据库应该可以解决这个问题。考虑拥有一个包含所有主要元数据的“控制”数据库，然后是包含实际数据的卫星数据库。

您没有提及有关您的服务器的任何规格 - 但是当我们从 8GB 到 20GB RAM 时，我们看到性能有了不错的提升。

# .net - .Net 开发的多格式文件查看器

> ID：108459
> 
> 赞同：3
> 
> 时间：2008-09-20T15:20:48.330
> 
> 标签：.net, components

有谁知道多格式文件查看器，能够显示常见的图像格式，以及 MS Office 文档格式（至少 Word 和 Excel）和 PDF？我见过几个可用的图像查看器，但除了 Oracle 的 Outside In 之外没有一个。

我正在寻找可以嵌入到 .net 应用程序中的查看器技术——vb 和 c# 的混合体

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T16:10:49.473

为此，我们将 Internet Explorer ActiveX 控件嵌入到我们的应用程序中。IE 会打开您列出的所有文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-18T08:37:35.257

如果您正在寻找 asp.net，那么您可以尝试 Doconut，如果需要，它也可以嵌入到用于 winforms 应用程序的 Web 浏览器控件中。它不需要任何activeX，它是纯HTML/javascript控件，原生.net。

# css - 如何仅使用 CSS 在鼠标悬停时在单独的 div 中弹出图像？

> ID：108461
> 
> 赞同：5
> 
> 时间：2008-09-20T15:21:03.853
> 
> 标签：css, xhtml, popup

我有一个小的缩略图库。当我将鼠标指针放在缩略图上时，我希望在屏幕右上角的 div 中弹出一个完整尺寸的图像。我已经看到只使用 CSS 完成了这项工作，如果可能的话，我想沿着这条路线走，而不是使用 javascript。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T15:32:39.613

[纯 CSS Popups2](http://meyerweb.com/eric/css/edge/popups/demo2.html)，来自为我们带来 Complexspiral 的同一站点。请注意，此示例使用实际导航链接作为翻转元素。如果您不希望这样，它可能会导致一些关于 IE 版本的粘性。

基本技术是将每个图像粘贴在带有实际 href 的链接标签内（否则某些 IE 版本将忽略：悬停）

```
<a href="#">Text <img class="popup" src="pic.gif" /></a> 
```

并使用绝对位置巧妙地定位它。最初隐藏图像

```
a img.popup { display: none } 
```

然后在链接翻转时，将其设置为出现。

```
a:hover img.popup { display: block } 
```

这是基本技术，但由于图像标签位于链接标签内，因此总会存在主要的定位限制。详情见链接；他使用了比显示更棘手的东西：none 来隐藏图像。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T15:33:31.560

[CSS Playground](http://www.cssplay.co.uk)使用纯 CSS 来处理这类事情，其中​​一个演示肯定会对您有所帮助，因为所有 CSS 都只是查看源代码来学习 - 您可能想使用 :hover 伪类，但它有一些限制，具体取决于您的浏览器定位。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T15:27:14.850

Eric Meyer 的[Pure CSS Popups 2](http://meyerweb.com/eric/css/edge/popups/demo2.html)演示听起来与您想要的非常相似。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T15:31:03.890

这里有一些例子：

*   [CSS 图片库](http://www.dynamicdrive.com/style/csslibrary/item/css-image-gallery/)
*   [跨浏览器多页相册](http://www.cssplay.co.uk/menu/lightbox.html)
*   [仅限 CSS 的图片库：已解释](http://designsignature.co.za/blog/?p=29)
*   [仅 CSS 的图片库：示例](http://www.designsignature.co.za/web.php)

最后一个在点击时起作用。只是为了行为上的完整。

# assembly - 如何开始对 z80 机器代码进行逆向工程？

> ID：108485
> 
> 赞同：5
> 
> 时间：2008-09-20T15:29:16.343
> 
> 标签：assembly, reverse-engineering, disassembly, decompiling, z80

我有一个 .z80 内存转储。我如何对其进行逆向工程？我需要知道什么？我怎样才能最大限度地减少体力劳动？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-20T15:32:35.073

最强大的反汇编程序[——IDA](http://www.hex-rays.com/idapro)支持 z80。

还发布在“ [Z80 系列的软件开发工具](http://www.z80.info/z80sdt.htm)”页面上的反汇编器列表

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T15:34:08.843

这取决于您使用的操作系统，这里有很多好工具：

[http://www.z80.info/z80sdt.htm](http://www.z80.info/z80sdt.htm)

我编写的第一个程序是用 Z80 汇编语言编写的。

# asp.net - 我可以检查 SOAP Web 服务是否支持某个 WebMethod？

> ID：108499
> 
> 赞同：1
> 
> 时间：2008-09-20T15:33:33.103
> 
> 标签：asp.net, web-services, soap

由于各种原因（例如减少客户端的延迟），我们的 Web 服务分布在不同的服务器上，而且它们并不总是都是最新的。与其在由于特定的 Web 服务太旧而导致方法*不*存在时抛出异常，不如让客户端在调用它之前检查服务是否响应给定的方法，否则禁用该功能（或解决它）。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T15:35:53.317

获取 WSDL（将 ?wsdl 附加到 URL） - 您可以以任何您喜欢的方式对其进行解析。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T15:45:59.610

对 Web 服务进行单元测试以确保其签名不会中断。当您编写破坏方法签名的代码时，您将知道并可以相应地调整其他应用程序。

或者只是不要破坏 Web 服务并以使您能够对其进行版本控制的方式发布它们。与[http://services.domain.com/MyService/V1.1/Service.asmx](http://services.domain.com/MyService/V1.1/Service.asmx)（对于 .NET）一样，这样当您发布 v1.2 并进行重大更改时，使用 v1.1 的应用程序不会中断.

如果管理 Web 服务真的很麻烦，我也会检查使用内部 UDDI 服务器。使用 UDDI 的绿页将告诉您您想了解的有关该服务的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T15:56:26.233

当您发出 SOAP 请求时，您只是向服务器发送 HTTP 请求。如果服务器理解它，它将返回一个 HTTP 200 和一些 XML，否则它会向您发送一些错误 HTTP 代码（404、500、...）

没有一般的方法可以要求 Web 服务公开的“方法”是否存在。如果它是自动的，请尝试使用公开的 WSDL，或者只是尝试使用“方法”并检查响应中的错误（您不必向用户发送异常......）

另外，我不知道我是否理解你，但你正在考虑查询服务器两次，一次检查方法是否存在，第二次如果存在则进行实际调用？如果没有，我会检查错误，如果是，则正常进行。

# mysql - MySQL：建议的行数

> ID：108503
> 
> 赞同：1
> 
> 时间：2008-09-20T15:34:49.093
> 
> 标签：mysql, performance, database-design, optimization

考虑一个有 7 列的索引 MySQL 表，不断地被查询和写入。在通过将数据拆分到其他表中来提高性能之前，该表应该允许包含的建议行数是多少？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-20T15:42:56.217

您是否会通过对数据进行分区来获得性能提升取决于数据以及您将在其上运行的查询。您可以在一个表中存储数百万行，并且具有良好的索引和精心设计的查询，它仍然会非常快。如果您已经确信您的索引和查询已经尽可能好，则仅考虑分区，因为它可能比它的价值更麻烦。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T17:19:05.567

没有神奇的数字，但有几件事会特别影响性能：

*   索引基数：不要费心索引具有 2 或 3 个值的行（如 ENUM）。在大表上，查询优化器将忽略这些。
*   写入和索引之间存在权衡。您拥有的索引越多，写入所需的时间就越长。不要只索引每一列。分析您的查询并查看需要为您的应用编制索引的列。
*   磁盘 IO 和内存起着重要作用。如果您可以将整个表放入内存中，那么您将磁盘 IO 排除在外（一旦表被缓存，无论如何）。我的猜测是，当您的表太大而无法在内存中缓冲时，您会看到很大的性能变化。
*   考虑根据使用情况对服务器进行分区。如果您的事务系统正在读取/写入单行，您可能可以通过将数据复制到只读服务器以进行汇总报告来为自己争取一些时间。

您可能知道，表性能会根据数据大小而变化。密切关注您的表格/查询。你会知道什么时候需要改变。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T14:07:28.787

MySQL 5内置了[分区](http://dev.mysql.com/doc/refman/5.1/en/partitioning.html)功能，非常好。好的是你可以定义你的表应该如何拆分。例如，如果您主要基于用户 ID 进行查询，则可以根据用户 ID 对表进行分区，或者如果您按日期查询，则按日期进行。这样做的好处是 MySQL 将确切地知道要搜索哪个分区表来查找您的值。不利的一面是，如果您在未定义分区的字段上进行搜索，它将扫描每个表，这可能会降低性能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T16:31:22.590

虽然事后您可以指出性能成为问题的表大小，但我认为您无法预测它，当然也不能从此类网站上提供的信息中预测！

你可能会问自己一些有用的问题：

*   目前的性能是否可以接受？
*   如何衡量绩效 - 是否有衡量标准？
*   我们如何识别不可接受的性能？
*   我们是否以任何可能使我们能够预测问题的方式来衡量绩效？
*   我们所有的查询都使用了有效的索引吗？
*   我们是否模拟了系统上的极端负载和体积？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T16:34:48.213

使用 MyISAM 引擎，除非您更改默认值，否则您将遇到 2GB 表大小的硬限制。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T20:26:54.037

如果您认为不需要，请不要应用优化。理想情况下，这应该通过测试来确定（正如其他人所暗示的那样）。

水平或垂直分区可以提高性能，但也会使您的应用程序复杂化。除非你确定你需要它，否则不要这样做，它肯定会有所帮助。

2G 数据 MyISAM 文件大小只是一个默认值，可以在创建表时更改（或稍后通过 ALTER，但需要重建表）。它不适用于其他引擎（例如 InnoDB）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T20:46:04.070

实际上，这是一个很好的性能问题。你读过[杰伊·派普斯](http://www.jpipes.com/)吗？没有特定的行数，但有特定的读取页面大小，垂直分区可能有充分的理由。

看看他的功夫演示，看看他的帖子。我相信你会发现他写了一些有用的建议。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T20:54:13.147

你在使用 MyISAM 吗？您是否打算存储超过几 GB 的数据？注意 MAX_ROWS 和 AVG_ROW_LENGTH。

Jeremy Zawodny 有一篇关于如何解决这个问题的[优秀文章。](http://jeremy.zawodny.com/blog/archives/000796.html)

# c# - DataGridViewCell 边框颜色

> ID：108505
> 
> 赞同：2
> 
> 时间：2008-09-20T15:35:00.777
> 
> 标签：c#, .net, datagridview, coding-style

有谁知道如何在 C# 中更改 Datagridviewcell 的边框颜色？

这是我的意思的图片：

[Datagridviewstyle http://www.zivillian.de/datagridview.png](http://www.zivillian.de/datagridview.png) [图片](http://www.zivillian.de/datagridview.png)

Backgroundcolor、Textcolor 和[Images](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=233320&SiteID=1)都没有问题，但我不知道如何实现Borders。

编辑：我想用 winforms 实现这一点。

另一个问题是第二排的十字架，但那是以后...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T15:39:44.370

您必须使用 OwnerDraw 自己绘制单元格来实现这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T15:40:10.280

您可以在 datagridview 上连接两个事件。'ItemCreated' 和 'ItemDatabound' 每个都将传递给您一个可以访问您的项目模板的事件参数。在其中，您可以 .FindControl("ControlId") 或逐步浏览 .Controls 集合以查找单元格。一旦你得到那个单元格，你就可以做任何你想做的事情——包括边框颜色和十字。ItemCreated 将为每个绘图（回发）触发，而 ItemDatabound 仅在您进行数据绑定时触发 :)

# c++ - C++ 的 RSA 加密库

> ID：108518
> 
> 赞同：33
> 
> 时间：2008-09-20T15:39:54.120
> 
> 标签：c++, winapi, encryption, rsa

我正在开发一个 Win32 应用程序，我想使用一个 RSA 加密库。**你会推荐哪个图书馆？**

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-20T15:52:50.983

如果您使用的是 Win32，为什么不简单地使用内置的 win32 加密 API？

这是一个小例子，它在实践中是如何工作的：

[http://www.codeproject.com/KB/security/EncryptionCryptoAPI.aspx](http://www.codeproject.com/KB/security/EncryptionCryptoAPI.aspx)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-20T22:36:59.467

[Crypto++](http://www.cryptopp.com/) - 在正常的源代码自建包之上，他们为 MSVC 6、7.1 和 8 提供了 NIST FIPS 验证的 dll。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-20T15:51:40.220

我认为 OpenSSL 是一个不错的选择。它维护得很好，而且价格合适:)

[http://www.openssl.org](http://www.openssl.org)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-20T16:05:43.870

我使用以下库：

[http://www.efgh.com/software/rsa.htm](http://www.efgh.com/software/rsa.htm)

它是公共领域的，紧凑的，自包含的，并且运行良好。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-20T15:59:45.350

作为替代方案，请考虑 LibTomCrypt ( [https://github.com/libtom/libtomcrypt](https://github.com/libtom/libtomcrypt) )

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-17T13:18:04.357

也许[Botan](http://botan.randombit.net/)是另一种选择？它是一个 C++ 库，具有支持 RSA 算法的 BSD 许可证。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-07T23:53:36.560

另一种选择是[libbeecrypt](http://beecrypt.sourceforge.net/)。一个非常成熟的产品，在许多平台上都有汇编器实现。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-16T13:05:05.813

我过去使用过 OpenSSL，发现它是一个很棒的加密 API 库，包括 AES、RSA、3DES。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-25T11:32:02.983

我会推荐 Miracl 库[https://certivox.com/solutions/miracl-crypto-sdk/](https://certivox.com/solutions/miracl-crypto-sdk/)但价格很高。

# sharepoint - Sharepoint 计算字段的公式创建者

> ID：108521
> 
> 赞同：5
> 
> 时间：2008-09-20T15:41:44.770
> 
> 标签：sharepoint, list, formula

我有一个共享点列表

例如 2 个用户（用户 A 和用户 B）

我需要列表项中的计算字段，这样如果用户“A”创建项目，则字段值将为“X”，如果用户“B”创建项目字段值将是“Y”

但我不能在计算字段的 furmiula 中使用 [created by] ！这是为什么 ？！！还有另一种方法可以做我需要做的事情吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T19:36:10.603

如果使用 Sharepoint Designer 是一个选项，您可以为该列表创建工作流。将其设置为在创建或编辑新项目时启动，使用条件“If Created_By equals ...”和“将 yourfield 设置为 yourvalue”的操作，然后添加 Else If 分支并重复。这将始终覆盖用户在“yourfield”中输入的任何内容。完成所有这些操作大约需要 2 分钟。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T16:41:02.520

我相信您可以创建一个将默认值设置为 [Me] 的文本字段，然后它应该可以在计算字段中使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T19:30:32.660

对于更复杂的公式（即任何具有条件逻辑的公式），请尝试为内容类型（或文档库）创建事件处理程序。这将允许您完全控制将字段设置为您想要的。

该字段可以在编辑屏幕内对用户隐藏。

确保使用来自[codeplex](http://www.codeplex.com/Project/ProjectDirectory.aspx?TagName=Sharepoint)的 STSDev来设置部署解决方案。

# python - 我应该如何最好地模拟和/或避免 Python 中的枚举？

> ID：108523
> 
> 赞同：5
> 
> 时间：2008-09-20T15:42:39.540
> 
> 标签：python, enums

我一直在使用一个小类来模拟一些 Python 项目中的枚举。有没有更好的方法或者这在某些情况下最有意义？

类代码在这里：

```
class Enum(object):
'''Simple Enum Class
Example Usage:
>>> codes = Enum('FOO BAR BAZ') # codes.BAZ will be 2 and so on ...'''
def __init__(self, names):
    for number, name in enumerate(names.split()):
        setattr(self, name, number) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T15:51:51.080

枚举之前已被提议包含在语言中，但被拒绝（请参阅[http://www.python.org/dev/peps/pep-0354/](http://www.python.org/dev/peps/pep-0354/ "佩普 354")），尽管您可以使用现有的包而不是编写自己的实现：

*   枚举： http: [//pypi.python.org/pypi/enum](http://pypi.python.org/pypi/enum "枚举")
*   SymbolType（与枚举不太一样，但仍然有用）：[http ://pypi.python.org/pypi/SymbolType](http://pypi.python.org/pypi/SymbolType "符号类型")
*   [或者只是做一个搜索](http://pypi.python.org/pypi?:action=search&term=enum&submit=search)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-20T17:32:17.313

最常见的枚举案例是作为状态或策略设计模式一部分的枚举值。枚举是要使用的特定状态或特定的可选策略。在这种情况下，它们几乎总是某些类定义的一部分

```
class DoTheNeedful( object ):
    ONE_CHOICE = 1
    ANOTHER_CHOICE = 2 
    YET_ANOTHER = 99
    def __init__( self, aSelection ):
        assert aSelection in ( self.ONE_CHOICE, self.ANOTHER_CHOICE, self.YET_ANOTHER )
        self.selection= aSelection 
```

然后，在这个类的一个客户端。

```
dtn = DoTheNeeful( DoTheNeeful.ONE_CHOICE ) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T15:58:02.890

我更经常看到的是，在顶级模块上下文中：

```
FOO_BAR = 'FOO_BAR'
FOO_BAZ = 'FOO_BAZ'
FOO_QUX = 'FOO_QUX' 
```

...然后...

```
if something is FOO_BAR: pass # do something here
elif something is FOO_BAZ: pass # do something else
elif something is FOO_QUX: pass # do something else
else: raise Exception('Invalid value for something') 
```

请注意，使用`is`而不是`==`在这里冒风险——它假设人们正在使用`your_module.FOO_BAR`而不是字符串`'FOO_BAR'`（*通常*会被实习以`is`匹配，但肯定不能指望），所以可能不会根据上下文适当。

这样做的一个好处是，通过查看存储对该字符串的引用的任何地方，它的来源立即显而易见。`FOO_BAZ`远比`2`.

除此之外，您建议的课程冒犯了我的 Pythonic 敏感性的另一件事是使用`split()`. 为什么不直接传入一个元组、列表或其他可枚举的对象呢？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T15:58:10.067

[这里](https://stackoverflow.com/questions/36932/whats-the-best-way-to-implement-an-enum-in-python)有很多很好的讨论。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T15:52:20.063

进行枚举的内置方法是：

```
(FOO, BAR, BAZ) = range(3) 
```

这适用于小型套装，但有一些缺点：

*   您需要手动计算元素的数量
*   你不能跳过值
*   如果添加一个名称，还需要更新范围号

有关 python 中的完整枚举实现，请参阅： [http ://code.activestate.com/recipes/67107/](http://code.activestate.com/recipes/67107/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-23T18:28:48.477

我从看起来很像 S.Lott 的答案的东西开始，但我只重载了“str”和“eq”（而不是整个对象类），所以我可以打印和比较枚举的值。

```
class enumSeason():
    Spring = 0
    Summer = 1
    Fall = 2
    Winter = 3
    def __init__(self, Type):
        self.value = Type
    def __str__(self):
        if self.value == enumSeason.Spring:
            return 'Spring'
        if self.value == enumSeason.Summer:
            return 'Summer'
        if self.value == enumSeason.Fall:
            return 'Fall'
        if self.value == enumSeason.Winter:
            return 'Winter'
    def __eq__(self,y):
        return self.value==y.value 
```

Print(x) 将产生名称而不是值，并且持有 Spring 的两个值将彼此相等。

```
 >>> x = enumSeason(enumSeason.Spring)
   >>> print(x)
   Spring
   >>> y = enumSeason(enumSeason.Spring)
   >>> x == y
   True 
```

# lisp - CLTL2 和 ANSI CL 之间的主要区别是什么？

> ID：108537
> 
> 赞同：1
> 
> 时间：2008-09-20T15:47:51.167
> 
> 标签：lisp, common-lisp

任何在线链接/资源？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T16:23:53.687

比尔克莱门森有[http://bc.tech.coop/cltl2-ansi.htm](http://bc.tech.coop/cltl2-ansi.htm)这是[http://groups.google.com/group/comp.lang.lisp/msg/0e9aced3bf023d86的转贴](http://groups.google.com/group/comp.lang.lisp/msg/0e9aced3bf023d86)

在回答问题时，我还找到了[http://web.archive.org/web/20060111013153/http://www.ntlug.org/~cbbrowne/commonlisp.html#AEN10329 。](http://web.archive.org/web/20060111013153/http://www.ntlug.org/~cbbrowne/commonlisp.html#AEN10329)我没有比较两者。

正如海报所指出的，这些只是主要区别。目的是让您调整您的 cltl2 副本，使其不会以任何主要方式混淆您，但生成的文档不应被视为标准。

就我个人而言，我没有打扰——我使用 cltl2 作为床边阅读（斯蒂尔是一位出色的作家！），以深入了解语言的各个方面，以及这些方面标准化的过程；让我在 CL 中思考得更好。当我编程时，我专门参考 HyperSpec。

# asp.net - Cookie 和子域

> ID：108558
> 
> 赞同：20
> 
> 时间：2008-09-20T15:58:58.677
> 
> 标签：asp.net, cookies

可以在同一顶级域的两个站点之间共享 cookie 吗？说`www.example.com`和`secure.example.com`？我们正在研究为非安全内容实施缓存，并且需要将安全内容隔离到另一个域。cookie需要什么参数？我正在使用 asp.net

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-20T16:02:37.527

是的你可以。采用：

```
Response.Cookies("UID").Domain = ".myserver.com" 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T16:40:06.017

应用可跨子域共享的 cookie 域的最简单方法是将其放在 web.config 中：

```
<forms cookieDomain="example.com"> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-14T03:28:47.573

是的，但请注意不要在不同的子域中设置同名 cookie，因为生成的 cookie 似乎是随机的；相反，仅在 .maindomain.com 中设置一个 cookie（不在任何 .sub.domain.com 中）

# svn - 移动带有历史记录的目录

> ID：108567
> 
> 赞同：68
> 
> 时间：2008-09-20T16:02:15.767
> 
> 标签：svn

我有一个这样的SVN结构：

```
/Projects
    /Project1
    /Project2
/someFolder
    /Project3
    /Project4 
```

我想将所有项目移动到 /Projects 文件夹中，这意味着我想将项目 3 和 4 从 /someFolder 移动到 /projects 文件夹中。

警告：我想保留完整的历史记录。我假设每个客户都必须再次从新位置检查内容，这很好，但我仍然想知道在不完全破坏历史记录的情况下移动目录最简单的方法是什么？

颠覆 1.5 如果这很重要。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-09-20T16:06:53.600

```
svn help rename 
```

在颠覆中移动/重命名保持历史完整。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-09-20T16:06:13.150

```
svn move SRC DST
```

```
$ svn move -m "移动文件" http://svn.red-bean.com/repos/foo.c http://svn.red-bean.com/repos/bar.c
```

svn move 将保留您的历史记录。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2016-07-04T07:00:55.923

Tortoise SVN 支持 Repo-Browser 中的“右键单击”移动。当您使用“鼠标右键单击”将源文件/目录拖到目标位置时，将出现一个上下文菜单。您可以为复制/移动/移动重命名等选择适当的菜单选项。此选项也将保留历史记录。

注意：在 Tortoise SVN 中有一个名为“Repair Move”的不错的功能 - 通过使用此功能，您可以在移动文件/目录时重命名它。（有关详细信息，请参阅[文档](https://tortoisesvn.net/repairmoves.html)）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-03-20T07:30:01.910

如果您使用 svn move 命令将项目 3 移动到项目文件夹中，则会为项目 3 文件夹保留历史记录，但有趣的是，项目文件夹不会显示在项目 3 被移动到项目之前创建的项目 3 的历史记录。

我觉得这很令人困惑，我认为一个文件夹会在层次结构中显示其下方的所有历史记录，但似乎情况并非如此（我自己对此进行了测试）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-20T16:04:54.433

您可以使用 svn 复制命令。它保留了你的历史。您只需在显示日志时取消选择“停止复制/重命名”选项（以 Tortoise 为例）。

仔细看看 Subversion-Book [svn 副本](http://svnbook.red-bean.com/en/1.1/re07.html)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-07-29T15:10:00.673

使用 repo 浏览器拖放它并将本地文件夹重新绑定到 SVN 服务器。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-20T16:04:10.533

在 Subversion 中移动目录不会破坏历史，AFAIK。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-20T16:19:38.547

为此，您必须使用 svn 的特定移动/重命名功能（例如，如果您使用此功能，请查看 TortoiseSVN 帮助）。如果您自己移动文件然后提交更改，我不确定是否会保留历史记录。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-09-20T16:05:50.717

据我所知，只有 Bazaar 允许在目录中保留历史记录，尤其是在谈论移动目录时。SVN 允许您在移动文件时保留历史记录，但不能保留目录。

# python - 拓扑排序，递归，使用生成器

> ID：108586
> 
> 赞同：3
> 
> 时间：2008-09-20T16:07:18.857
> 
> 标签：python, recursion, generator, topology

数据：一个依赖列表，已经验证为非循环的。所以在这里，'a'取决于'b'，'c'（c取决于d）等等......

```
A = { 'a' :  dict(b=1, c=1),
    'c' : dict(d=1),
    'd' : dict(e=1,f=1,g=1),
    'h' : dict(j=1)
    } 
```

我想要一个自上而下的递归解决方案，比如说，找到从“a”开始的链：a、c、d、e、g、f、b

所以，现在（一个非发电机解决方案）：

```
def get_all(D,k):
    L = []
    def get2(D,k):
        L.append(k)
        for ii in D.get(k,[]):
            get2(D, ii)
    get2(D,k)
    return L 
```

显然，这很弱 :) 我一直在思考如何在那里获得收益，我很感激你们能带来的任何 py-foo。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T17:43:51.217

两个答案都给出了相同的结果，但是如果我对问题的阅读是正确的，那么对给定图表的简单更改给出错误的答案 - 如果您从 'b' 添加对 'c' 的依赖（这不会引入循环如图所示）输出为： `a c d e g f b d e g f`

这并不完全有帮助。试试这个小的变体，它会跟踪图中的哪些节点已经被访问过：

```
def get_all(D, k, seen=None):
    if not seen:
        seen = set( )
    if k not in seen:
        seen.add(k)
        yield k
        for ii in D.get(k, []):
            for jj in get_all(D, ii, seen):
                yield jj 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-20T16:18:00.657

试试这个：

```
#!/usr/bin/env python

def get_all(D, k):
    yield k
    for ii in D.get(k, []):
        for jj in get_all(D, ii):
            yield jj

A = { 'a' : dict(b=1, c=1),
    'c' : dict(d=1),
    'd' : dict(e=1,f=1,g=1),
    'h' : dict(j=1)
    }

for ii in get_all(A,'a'):
    print ii 
```

给我

```
史蒂夫@rei:~/code/tmp
$ python recur.py
一种
C
d
e
G
F
b

```

# java - 将 Shrinksafe 与 IBM JRE 一起使用时出现 MalformedInputException

> ID：108593
> 
> 赞同：1
> 
> 时间：2008-09-20T16:09:28.493
> 
> 标签：java, dojo, aix, ibm-jre

在尝试使用 Shrinksafe custom_rhino.jar 构建 Dojo 时，我得到了 MalformedInputException。当构建到达包含以 UTF-8 存储的法语字母的自定义小部件/模板时，就会出现问题。AIX 机器的 LANG=en_US 应该是正确的，根据其他记录在案的有关 IBM JRE 的 MalformedInputException 的问题来判断。

切换到 Sun 的 JRE 是不可接受的解决方案，因为此构建必须在 IBM AIX 上运行。解决方案可能是更改 AIX 中的某些内容或更改 IBM JRE 中的设置或两者兼而有之。到目前为止，我一直没有成功。

[dojo 论坛](http://dojotoolkit.org/forum/dojo-core-dojo-0-9/dojo-core-support/dojo-0-9-build-throwing-java-exceptions)中也描述了问题，但没有适当的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-21T07:14:20.520

在链接的论坛中，我没有看到有关构建机器上默认字符编码的说明。

可能是 Dojo 使用的是 UTF-8 编码，但实际上您的文件是使用 ISO-8859-1 之类的编码（我假设西方拉丁字符用于法语）。

您是否有诸如 Eclipse 之类的编辑器，允许您指定要在特定文件上使用的字符编码？您可以尝试使用 UTF-8 编码打开文件，看看字符是否符合您的预期。

# .net - 实体框架：如何从 L2E 返回基本类型

> ID：108598
> 
> 赞同：0
> 
> 时间：2008-09-20T16:12:16.710
> 
> 标签：.net, entity-framework, ado.net

考虑以下架构：

*   基础对象“实体”
*   派生对象“条目：基础”
*   以及进一步派生的对象“CancelledEntry:Entry”

在 EntitySQL 中，我可以编写以下内容：

```
[...] where it is of (only MyEntities.Entry) [...] 
```

只返回 Entry 类型的对象，而不返回 Entity 或 CancelledEntry。

在 linq to sql 中，以下命令将返回 Entry 和 CancelledEntry 类型的对象。

```
EntityContext.EntitySet.OfType<Entry>() 
```

用于仅返回 Entry 类型的对象的语法/函数是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T06:50:47.920

为什么不在 IQueryable<Entry> 上应用一个名为 ApplyBaseEntryFilter() 的扩展方法，该方法将应用此过滤器并返回一个 IQueryable<Entry>。

这是一个如何重用 linq 查询片段的示例。在 IQueryable<Entity> 上使用扩展方法是重用查询的好方法，因为您永远不需要在应用程序周围复制和粘贴查询片段，希望对您有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T16:31:34.167

好的，我找到了部分解决方案：

```
EntityContext.EntitySet.OfType<Entry>().Where( obj => !(obj is CancelledEntry) ) 
```

然而，这非常糟糕，因为如果我创建一个新的派生对象，我必须进入所有查询并专门添加一个条件来删除它。

必须有更好的解决方案

# project-management - 什么因素决定了软件项目的成本？

> ID：108604
> 
> 赞同：1
> 
> 时间：2008-09-20T16:17:56.307
> 
> 标签：project-management, estimation

如果你现在手头有 100 美元。并且必须押注其中一个选项。你敢打赌吗？问题是：

影响项目成本的最重要因素是什么。

1.  程序员的打字速度。
2.  编程时输入的字符总数。
3.  'wc *.c' 命令。c 文件的最终大小。
4.  解决问题时使用的抽象。

更新：好的，仅作记录。这是我问过的最愚蠢的问题。问题应该是。对上面的列表进行排名。首先是最重要的因素。哪些是最重要的因素。我问，因为我认为字符数很重要。当需求发生变化时，需要改变的角色更少。它完成得越快。或者？

更新：这个问题在 Stackoverflow 播客 #23 中讨论过。谢谢杰夫！:)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-20T16:22:51.863

从麦康奈尔：

[http://www.codinghorror.com/blog/archives/000637.html](http://www.codinghorror.com/blog/archives/000637.html)

> [对于软件项目]，规模很容易成为工作量、成本和进度的最重要决定因素。您正在开发的软件类型排在第二位，人员因素紧随其后。您使用的编程语言和环境不是对项目结果的第一层影响，但它们是对估算的第一层影响。

1.  项目规模
2.  正在开发的软件种类
3.  人事因素

我不认为你在上面的列表中占了#3。程序员之间的技能通常存在一个数量级或更多的差异，更不用说[所有会严重](https://rads.stackoverflow.com/amzn/click/com/0932633439)影响进度的人件问题（坏苹果、管理不善等）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T16:20:32.867

这些都不是项目成本的主要因素。这一切都归结为你的日程安排得有多好——你能按你说的在某个日期交付。如果您的进度估计不正确，那么您猜怎么着，您的项目成本将比您想象的要高得多。最后，它的进度估计一路。

编辑：我意识到这是一次投票，而且我实际上并没有对问题中的任何选项进行投票，所以请随意考虑这是对问题的评论，而不是投票。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T16:24:03.077

我认为大型项目的最大数量是测试和修复错误以及修复对需求的误解。首先，您需要编写测试。比你修复测试运行的代码。比您进行手动测试。然后你必须编写更多的测试。在大型项目中，测试和修复可能会占用 40-50% 的时间。如果您有高质量的要求，那么它可以更多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T16:24:48.147

与正确的问题定义、设计和测试相比，字符、文件大小和打字速度可以被认为是零成本。它们很容易更重要一个数量级。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T16:27:56.077

决定项目成本的最重要的单一因素是愿景的规模和雄心。第二个最重要的是您（您的团队、您的管理层等）如何控制随着您的进步而扩大愿景的不可避免的诱惑。您列出的因素本身只是项目规模的指标，而不是决定规模的因素。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T16:29:44.997

在您提供的四个选项中，我会选择 #2 - 项目的大小。毕竟，清理垃圾邮件的快速项目通常比开发新的文字处理器要快。

之后我会选择“解决问题时使用的抽象”。下一步——如果你想出错误的解决问题的方法，要么是因为逻辑不好，要么是因为系统的限制——那么你肯定会花更多的钱来重新设计和重新编码已有的东西已经完成了。

# internet-explorer - IE 中的 Script.aculo.us 自动完成程序问题

> ID：108650
> 
> 赞同：6
> 
> 时间：2008-09-20T16:32:33.523
> 
> 标签：internet-explorer, prototypejs, scriptaculous, autocomplete

我正在努力解决 IE 中的 Script.aculo.us Autocompleter 控件的问题（我已经在 IE6 和 7 中尝试过）。页面加载后，在文本框中输入第一个字符时，建议不会出现。在最初的失败之后，控件按其应有的方式工作。

我已经验证了建议数据是从服务器正确返回的；该问题似乎与建议元素的定位有关，因为页面上其他相对定位的元素在您希望出现建议的那一刻移出位置。

有没有人听说过这样的问题或对如何解决它有任何建议？

编辑：作为对 Chris 的回应，我将 partialChars 参数设置为 1，并且该控件可在我尝试过的所有其他浏览器中工作，它们是 Firefox、Safari、Opera 和 Chrome 的最新版本。我可能应该首先说清楚。谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T15:17:50.217

我确实有完全相同的问题。该问题仅出现在 IE 中（也在 8.0 beta 中）

我尝试过的 Firefox 和 Chrome 都没有任何问题。

根据其他人的说法，这是由于 HTML 文件中的 DOCTYPE 声明。在这里查看：http: [//prototype.lighthouseapp.com/projects/8887/tickets/32-ajax-autocomplete-in-ie-with-doctype](http://prototype.lighthouseapp.com/projects/8887/tickets/32-ajax-autocomplete-in-ie-with-doctype)

该错误还在 ruby​​ 开发人员委员会获得了一张票：http: [//dev.rubyonrails.org/ticket/11051](http://dev.rubyonrails.org/ticket/11051)

两个链接都有解决问题的解决方案。

希望该错误将在原型/scriptaculous 的下一版本中得到修复 :)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-04T11:09:45.503

非常感谢黑客。我自己使用过它，但对其进行了修改，因此仅在通过执行以下操作使用 Ajax.Autocompleter 时才调用它。

```
function positionAuto(element, entry) {
    setTimeout( function() {
      Element.clonePosition('choices_div', 'text_element', {
      'setWidth': false,
      'setHeight': false,
      'offsetTop': $('text_element').offsetHeight
    } );
  }, 300);
  return entry;
}

new Ajax.Autocompleter('text_element', 'choices_div', [url to web service], {
  paramName: 'fulltext',
  minChars: 2,
  callback: positionAuto, // See above
  [etc...] 
```

由于回调是在发出真正请求之前调用的，因此将 DIV 定位在那个时刻是最有意义的。并且将确保即使调整窗口大小或滚动窗口，DIV 也能正确定位。令人抓狂的是，为了让它始终如一地工作，我不得不将它包装在“setTimeout()”中。没有对不同的计时设置进行太多试验，但如果有一个较低的超时阈值有效，我想知道。

在 IE 8 和 7 上测试并且运行良好。并且也适用于其他真正的浏览器。希望这可以避免一些编码人员在处理这个问题时感到头疼。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-25T17:36:25.987

在 IE8/IE9 中为这个问题苦苦挣扎之后，我最终使用了 CSS hack。这里的方法是在绝对定位的容器内强制相对定位。额外的容器是必要的，以便将选择浮动到其他元素上。

```
div.acwrap {
  position: absolute;
  height: 40px;
}

div.autocomplete {
  position: relative !important;
  top: -5px  !important;
  left: 0px !important;
  width:250px;
  margin:0;
  padding:0;
} 
```

在我的 HTML 代码中，我使用了如下类：

```
<div class="acwrap">
 <div id="autocomplete_choices" class="autocomplete">
 </div>
</div> 
```

这个想法起源于这里：[Scriptaculous / Prototype IE 8 Autocomplete消失问题](http://krues8dr.com/2009/10/30/scriptaculous-prototype-ie-8-autocomplete-disappearing-problem/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T18:17:20.387

您的问题只是在 IE 中，还是在所有浏览器中？忽略第一个字符实际上是自动完成器的默认设置。在 controls.js 中，有一个名为 Autocompleter.Local 的类，它有一个名为 partialChars 的字段，默认为 2。该字段的文档说：

// - partialChars - 在触发之前输入多少
个字符 // 部分匹配（与 minChars 不同，它定义了
// 进行任何匹配需要多少个字符
// 根本）。默认为 2。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T12:09:19.887

我仍然不知道究竟是什么导致了这个问题，但我设法想出了一个技巧来解决它。这个想法是在页面加载时执行通常会导致第一个字符输入失败的处理，以使其不碍事：

```
new Ajax.Autocompleter(textInputId, suggestionsHolderId, suggestionsUrl, params);

//Hack
Event.observe(window, 'load', function()
{
    try
    {
        Position.clone($(textInputId), $(suggestionsHolderId),
            { setHeight: false, offsetTop: $(textInputId).offsetHeight});
    }
    catch(e){}
}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-03T10:52:31.190

这是一个已知的错误，带有一个有效但尚未包含在内的补丁。您可以在这里阅读更多相关信息：[https ://prototype.lighthouseapp.com/projects/8886-prototype/tickets/618-getoffsetparent-returns-body-for-new-hidden-elements-in-ie8-final#ticket- 618-9](https://prototype.lighthouseapp.com/projects/8886-prototype/tickets/618-getoffsetparent-returns-body-for-new-hidden-elements-in-ie8-final#ticket-618-9)

# svn - Subversion 存储库推荐布局背后的原因是什么？

> ID：108682
> 
> 赞同：17
> 
> 时间：2008-09-20T16:40:59.260
> 
> 标签：svn

[*带有 Subversion 的版本控制*](http://svnbook.red-bean.com/nightly/en/svn.tour.importing.html#svn.tour.importing.layout)建议（单项目）存储库采用以下布局（由[*这个问题*](https://stackoverflow.com/questions/49356/what-is-a-good-repository-layout-for-releases-and-projects-in-subversion)补充）：

```
/trunk
/tags
  /rel.1 (approximately)
  ...
/branches
  /rel1fixes 
```

与（可能）更加面向过程的安排相比，这种安排的相对优点是什么？：

```
/development
  /current
  /stable
/qa (maybe)
  ...
/production
  /stable
  /Prod.2
  /Prod.1
/vendor
  /Rel.5.1
  /Rel.5.2 
```

请注意，我正在考虑内部部署，而不是构建产品。

免责声明：虽然我是 Subversion 用户，但我从未在真实的实时环境中使用它进行部署。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-20T16:54:37.043

推荐的布局和你提议的布局之间的主要区别在于，推荐的布局在某种程度上是自我记录的，关于在哪里提交东西，以及它的行为方式。

例如，在推荐的布局中，很明显所有新开发都致力于主干，并且大多数分支都是由主干制成的。此外，很明显，您永远不应该在 /tags 中提交任何内容。最后，可以安全地假设分支是真正的分支，其中可能包含特定于该特定分支目的的更改。

对于建议的布局，其中一些事情不太确定。/development/stable 是从 /current 分支出来的吗？/development/stable 和 /production/stable 之间有什么关系？这些目录中哪些是标签，哪些是我可以实际签入的？

当然，这种行为可以记录在案，但是通过坚持每个人都使用的公认布局，您将更容易让新员工了解它的工作原理。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-21T13:30:04.733

我将尝试总结到目前为止的答案：

* * *

## 简单的

1.  “经典”布局（*主干/* + *分支/* +*标签/*）具有可扩展的简单性的优点
2.  主干（通常）是主要的开发线
3.  分支处理特殊的开发需求，例如复杂的子项目和发布后维护
4.  标签是固定的、不可变的标记帖子
5.  这种经典布局是众所周知的，因此您的开发人员可以更快地上手

## 可扩展

1.  如果需要，可以将产品的供应商开发集成到您的开发中（可能进行调整）作为供应商分支处理（通常一个就足够了）
2.  “流程”轴（例如，开发、测试（如果单独完成）、QA（如果使用）和生产）可以由适当的分支或标签约定处理（取决于“开发”之外是否需要或允许任何更改）。
3.  *这些额外的分支集可以通过命名约定来处理，或者通过tags/*或 *branches/*中的额外目录级别来处理。

## 查看其他问题

1.  [分支、标签和主干的真正含义是什么？](https://stackoverflow.com/questions/16142/what-does-branch-tag-and-trunk-really-mean)
2.  [对于 Subversion 中的版本和项目，什么是好的存储库布局？](https://stackoverflow.com/questions/49356/what-is-a-good-repository-layout-for-releases-and-projects-in-subversion)
3.  [你使用分支标签主干约定吗？](https://stackoverflow.com/questions/123295/do-you-use-the-branchestagstrunk-convention)

* * *

我已将此作为社区答案；请随时纠正或扩展任何不足之处，对此我深表歉意。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-20T17:09:07.070

您已经描述了存储库组织的两个非常标准的模型：dev-test-prod 和trunk-branch。[Eric Sink 在他的Source Control HOWTO](http://www.ericsink.com/scm/scm_branches.html)中很好地描述了它们。需要注意的一点是，大多数人使用 trunk-branch 的方式是在发布给客户时为每个版本创建一个分支，然后成为维护分支。

我倾向于选择主干分支，因为它不需要将每个更改从开发迁移到测试再到生产。只有需要向后移植到维护分支的更改或从维护分支迁移到主干的错误修复才需要迁移。

然而，在 web 开发中，dev-test-prod 可能更可取的一种情况是，向​​客户发布版本的概念并不存在。在这种情况下，Prod 将是当前在服务器上运行的任何东西，而代码正在开发和测试中处理并不断迁移到应用程序中，而不是一大块地发布。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T17:02:32.767

我认为灵活性和避免歧义是您的答案。

通过使用版本号，您不会将自己绑定到该版本的部署位置。

例如，您可能将 1.3 版部署为开发版，1.2 版在测试中，1.1 版在生产中。如果您愿意，您可以轻松地为另一个版本添加另一个暂存环境，而无需更改您的颠覆布局。

没有人可以争论代码的 1.1 版本是什么，但“生产稳定”版本是模棱两可的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T16:45:05.803

每当您处理真实的实时环境时，您都希望您的开发人员能够尽可能容易地理解您的存储库。执行此操作的一个好方法是遵循推荐的 Subversion 标准布局。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T17:08:21.347

虽然我个人使用 SVN 书中推荐的布局，但如果您的布局更适合您，您可能不应该限制自己。我会保留**分支**目录，因为它的用途和用途从名称上很清楚。除此之外，真的，如果它适合你，任何事情都会发生。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-20T16:58:20.937

我觉得你的计划很好，真的。您将如何解释程序员在尝试某些东西时自己徘徊的分支？也许像 /development/jfm3-messing-around ？

# css - 使用 CSS 创建框的问题

> ID：108687
> 
> 赞同：6
> 
> 时间：2008-09-20T16:41:23.410
> 
> 标签：css

我想创建一个盒子形状，但遇到了麻烦。我希望盒子有背景颜色，然后盒子里面有不同的颜色。
然后盒子会有一个使用 ul 和 li 的项目列表，每个列表项都有一个白色的背景，并且列表项的背景颜色太拉伸了内框的整个距离。此外，列表项之间应该有 1 px 的间距，以便内部框颜色的背景颜色可见。

这是我正在尝试做的粗略草图：

[![](https://i.stack.imgur.com/aZ2W7.png)](https://i.stack.imgur.com/aZ2W7.png)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-20T17:15:57.787

你可以用这个 css 非常干净地做到这一点：

```
.box {
        width: 100px;
        border: solid #884400;
        border-width: 8px 3px 8px 3px;
        background-color: #ccaa77;
}

.box ul {
        margin: 0px;
        padding: 0px;
        padding-top: 50px; /* presuming the non-list header space at the top of
                              your box is desirable */
}

.box ul li {
        margin: 0px 2px 2px 2px; /* reduce to 1px if you find the separation
                                    sufficiently visible */
        background-color: #ffffff;
        list-style-type: none;
        padding-left: 2px;
} 
```

这个html：

```
<div class="box">
  <ul>
    <li>Lorem</li>
    <li>Ipsum</li>
   </ul>
</div> 
```

[演示](http://jsfiddle.net/0b7w65qv/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T16:48:48.273

因此，如果您有来源：

```
<div class="panel">
  <div>Some other stuff</div>
  <ul>
    <li>Item 1</li>
    <li>Item 2</li>
  </ul>
</div> 
```

您可以使用 CSS：

```
div.panel { background-color: #A74; border: solid 0.5em #520; width: 10em; 
            border-width: 0.75em 0.25em 0.75em 0.25em; }
div.panel div { padding: 2px; height: 4em; }
div.panel ul li { display: block; background-color: white; 
                      margin: 2px; padding: 1px 4px 1px 4px; }
div.panel ul { margin: 0; padding-left: 0; } 
```

要使 CSS 正常工作（尤其是在 Internet Explorer 上），请确保您的文档中有适当的 DOCTYPE 定义。请参阅[w3c 推荐](http://www.w3.org/QA/2002/04/valid-dtd-list.html)的文档类型以获取列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-23T03:54:55.890

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML>
  <HEAD>
    <TITLE>Examples of margins, padding, and borders</TITLE>
    <STYLE type="text/css">
      UL { 
        background: yellow; 
        margin: 12px 12px 12px 12px;
        padding: 3px 3px 3px 3px;
                                     /* No borders set */
      }
      LI { 
        color: white;                /* text color is white */ 
        background: blue;            /* Content, padding will be blue */
        margin: 12px 12px 12px 12px;
        padding: 12px 0px 12px 12px; /* Note 0px padding right */
        list-style: none             /* no glyphs before a list item */
                                     /* No borders set */
      }
      LI.withborder {
        border-style: dashed;
        border-width: medium;        /* sets border width on all sides */
        border-color: lime;
      }
    </STYLE>
  </HEAD>
  <BODY>
    <UL>
      <LI>First element of list
      <LI class="withborder">Second element of list is
           a bit longer to illustrate wrapping.
    </UL>
  </BODY>
</HTML> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T16:49:17.040

也许这两个会有所帮助：

*   [清单](http://css.maxdesign.com.au/listutorial/)
*   [CssPlay 菜单](http://www.cssplay.co.uk/menus/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-23T21:36:01.727

## html:

```
<div id="content">
        <a><div class="title">Title</div>Text</a>
        <ul>
            <li>Text</li>
            <li>More Text...</li>
        </ul>
    </div> 
```

## CSS：

```
#content{
            text-align:left;
            width:200px;
            background:#e0c784;
            border-top:solid 10px #7f4200;
            border-bottom:solid 10px #7f4200;
            border-right:solid 5px #7f4200;
            border-left:solid 5px #7f4200;
        }
        #content a{
            margin-left:20px;
        }

        #content ul{
            list-style-type:none;
            margin-bottom:0px;
        }
        #content ul li{
            padding-left:20px;
            margin:0px 0px 1px -40px;
            text-align:left;
            width:180px;
            list-style-type:none;
            background-color:white;
        }
        #content .title{
            text-align:center;
            font-weight:bolder;
            text-align:center;
            font-size:20px;
            border-bottom:solid 2px #ffcc99;
            background:#996633;
            color:#ffffff;
            margin-bottom:20px;
        } 
```

希望这有帮助....我还给它添加了一个标题，如果您不喜欢它，请删除它...

# wpf - WPF 中的自定义文本换行

> ID：108689
> 
> 赞同：9
> 
> 时间：2008-09-20T16:41:44.843
> 
> 标签：wpf, text

有没有办法在 WPF 中的非矩形容器中包装文本？

[这是它在Photoshop中的完成方式](http://www.photoshopessentials.com/photoshop-text/text-effects/text-wrap/page-3.php)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T22:39:33.987

不幸的是，如果不完整实现 TextFormatter，就没有直接的方法。[有关 Advanced TextFormatter 基础知识的 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms754036.aspx)：

> WPF 中的文本布局和 UI 控件提供格式属性，允许您在应用程序中轻松包含格式化文本。这些控件公开了许多属性来处理文本的呈现，包括其字体、大小和颜色。一般情况下，这些控件可以处理应用程序中的大部分文本呈现。但是，一些高级场景需要控制文本存储以及文本呈现。WPF 为此目的提供了一个可扩展的文本格式化引擎。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T21:53:48.870

你看过[UIElement.Clip](http://msdn.microsoft.com/en-us/library/system.windows.uielement.clip.aspx)属性吗？

对于非矩形文本换行，您可以尝试将 TextBlock.Clip 属性设置为非矩形 Geometry 对象。我没试过这个；要么它不会在剪辑区域之外绘制文本，要么它会将文本换行以适应剪辑。

Charles Petzold[提到了这种技术](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/ba8d2fd0-3948-4854-b985-762f0d28b78c/)。

# testing - 您使用 TestLink 并且满意吗？

> ID：108690
> 
> 赞同：-1
> 
> 时间：2008-09-20T16:41:58.727
> 
> 标签：testing

在我们的项目中，我们使用这个软件进行测试管理。你对这个软件有什么体验？它是否可以通过数千次测试正确扩展？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T17:17:53.300

我前一段时间使用它并喜欢它，但我没有进行数千次测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-08T16:57:27.970

我一直在寻找这个软件一段时间。我真的觉得简单很好，但我似乎无法掌握事情的流程。我所知道的关于测试和项目的一切都会说结构应该是项目 -> 需求 -> 测试计划 -> 测试用例，但是使用这个软件，它似乎是测试计划/需求 -> 测试用例，并且每个人都没有项目。无论如何，这让我很困惑。杰夫

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-23T15:54:43.617

我正在使用 Testlink，这太棒了。

使用Testlink，我们可以创建一个项目并跟踪项目的开发周期。我们可以在 Testlink 中执行以下操作：

*   创建项目
*   创建需求
*   进口要求
*   出口要求
*   创建测试用例和测试计划
*   将测试用例分配给需求
*   分析需求以计算测试用例覆盖率
*   导入测试用例
*   导出测试用例
*   执行测试用例
*   将错误分配给测试用例（如果您的 Testlink 与 Mantis、Bugzilla、Jira 等错误跟踪工具集成。）
*   创建报告

这对于可追溯性非常有用。

如果您需要有关 Testlink 的任何帮助，请告诉我。

# java - 是否有自动测试 getter 和 setter 的 Java 单元测试框架？

> ID：108692
> 
> 赞同：42
> 
> 时间：2008-09-20T16:43:11.563
> 
> 标签：java, unit-testing, junit

Java（以及其他社区，我敢肯定）有一个众所周知的争论是否应该测试琐碎的 getter/setter 方法。通常，这是关于代码覆盖率的。让我们同意这是一场公开辩论，而不是试图在这里回答。

有几篇关于使用 Java 反射来自动测试这些方法的博客文章。

是否有任何框架（例如 jUnit）提供这样的功能？例如，一个注释说“这个测试 T 应该自动测试 C 类上的所有 getter/setter，因为我断言它们是标准的”。

在我看来，它会增加价值，如果它是可配置的，那么“辩论”将作为一个选项留给用户。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-02-25T19:36:13.157

我创建了[OpenPojo](https://github.com/OpenPojo/openpojo)项目来解决这个*确切的*问题。

该项目允许您验证：

*   强制执行 Pojo 编码标准（即所有字段都是私有的，或者没有本地变量，...等）
*   强制执行 Pojo 行为（即 setter 只进行设置，不进行转换等）
*   验证 Pojo 身份（即使用基于注释的相等性和哈希码生成）

[见教程](https://github.com/OpenPojo/openpojo/wiki)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-20T16:50:30.547

我不知道有任何现成的库或类可以做到这一点。这可能主要是因为我不在乎，因为我强烈反对这样的测试。所以即使你问这个观点*一定*有一些理由：

我怀疑自动测试 getter 和 setter 是否有益于您的代码质量或覆盖率：这些方法要么是从其他代码中使用的（并在那里进行了测试，例如 100% 覆盖），要么根本不使用（并且可以被删除）。最后，您将保留 getter 和 setter，因为它们是在测试中使用的，但在应用程序中没有其他地方使用。

编写这样的测试应该很容易，例如使用 Apache Commons BeanUtils，但我怀疑如果您有良好的测试，您是否真的需要它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-21T00:19:48.457

[Unitils](http://www.unitils.org)使用静态方法执行此操作`assertRefEquals`。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-20T18:47:42.637

在大多数情况下，setter 和 getter 只是设置和获取内部字段。一个对象必须检查它只包含有效值的内部规则。例如

*   空值可能吗？
*   空字符串可能吗？
*   还是负值？
*   还是零值？
*   还是列表中的值有效？
*   还是有最大值？
*   或者 BigDecimal 值是否有最大精度？

如果存在无效值，则单元测试应检查行为是否正确。这不能自动化。

如果你对 setter 和 getter 没有逻辑，那么它必须在你的应用程序的任何地方使用。编写一个测试，其中您的对象是更复杂测试的参数。然后，您可以使用列表中的不同值对其进行测试。

测试您的业务逻辑，而不是 getter 和 setter。结果还应该涵盖 getter 和 setter。如果您只有一个公共库，这些方法也应该是您的业务逻辑中的任何结果。如果 getter 和 setter 没有代码覆盖，则将其删除。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-25T21:02:13.710

我做过类似的事情。一个简单的 java 类，它接受一个对象并测试所有的 getter 和 setter 方法。 [http://sourceforge.net/projects/getterandsetter/](http://sourceforge.net/projects/getterandsetter/)

我确实认为您应该尽可能避免使用 getter 和 setter 方法，但只要它们存在并且需要两行代码来测试它们，这样做是一件好事。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-20T17:07:45.937

我会支持 OO 设计而不是代码覆盖率，看看我是否不能将这些字段移到需要它们的类中。所以我会尝试看看是否可以像之前建议的那样删除这些 getter 和 setter。getter 和 setter 正在[打破封装](http://www.javaworld.com/javaworld/jw-09-2003/jw-0905-toolbox.html)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-02-04T19:13:47.290

[我正在尝试 openpojo](http://code.google.com/p/openpojo)

我踢了轮胎，它似乎完成了这项工作。

1.  它允许您检查项目中的所有 pojo。
2.  它似乎检查了 pojo 的最佳实践

查看本教程以获得快速入门 [教程](http://code.google.com/p/openpojo/wiki/Tutorial)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-03-04T21:02:20.227

[我想这个图书馆是你问题的答案](https://outsidemybox.github.io/testUtils/)

它测试所有 bean 的初始值，the `setters`, the `getters`, `hashCode(), equals() and toString()`。您所要做的就是定义默认和非默认属性/值的映射。

它还可以测试带有其他非默认构造函数的 bean 对象。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T10:23:21.180

由于我的声誉，在这里回答[@me](https://stackoverflow.com/questions/108692/is-there-a-java-unit-test-framework-that-auto-tests-getters-and-setters#108930)之前的评论：

> Vlookward，不写 getter/setter 完全没有意义。设置私有字段的唯一选项是显式设置器，在构造函数中设置它们，或通过其他方法间接设置（功能上将设置器推迟到另一个地方）。为什么不使用二传手？

好吧，有时候，没有必要把这个领域保密（对不起，如果我的英语不是很好）。通常，我们编写软件是因为它是一个库，并且我们用不必要的 getter/setter 封装我们的字段（我们的业务逻辑字段）。

其他时候，这些方法实际上是必要的。那么，有两种可能：
1\. 里面有业务逻辑。然后他们会接受测试，但他们不是真正的获取者/设置者。我总是在其他课程中编写该逻辑。并且测试测试其他类，而不是*POJO*。
2.没有。然后，如果可以的话，不要手写。例如，下一个接口的实现可能是完全自动生成的（并且也在运行时！）：

```
interface NamedAndObservable {
  String getName();
  void setName(String name);
  void addPropertyChangeListener(PropertyChangeListener listener);
  void addPropertyChangeListener(String propertyName,
                                 PropertyChangeListener listener);
} 
```

所以只测试手写的内容。不管它是getter/setter。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-20T14:07:32.087

我不会为每个属性编写测试用例，而是使用反射/内省来测试单个测试用例中的所有设置器/获取器以确定类型。这是一个很好的资源，显示了这一点：

[http://www.nearinfinity.com/blogs/scott_leberknight/do_you_unit_test_getters.html](http://www.nearinfinity.com/blogs/scott_leberknight/do_you_unit_test_getters.html)

# php - 好的 PHP ORM 库？

> ID：108699
> 
> 赞同：267
> 
> 时间：2008-09-20T16:44:52.230
> 
> 标签：php, database, orm

PHP 有没有好的对象关系映射库？

我知道[PDO](http://www.php.net/manual/en/intro.pdo.php) /ADO，但它们似乎只提供数据库供应商之间差异的抽象，而不是域模型和关系模型之间的实际映射。我正在寻找一个 PHP 库，其功能类似于[Hibernate](http://en.wikipedia.org/wiki/Hibernate_%28Java%29)为 Java 所做的方式和 NHibernate 为 .NET 所做的方式。

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2008-09-20T16:47:58.790

看[教义](http://www.doctrine-project.org/)。

[Doctrine 1.2](http://www.doctrine-project.org/projects/orm/1.2/docs/en)实现了 Active Record。[Doctrine 2+](http://www.doctrine-project.org/projects/orm/2.1/docs/en)是一个 DataMapper ORM。

另外，请查看[Xyster](http://xyster.libreworks.com/)。它基于数据映射器模式。

另外，看看[DataMapper 与 Active Record](https://stackoverflow.com/questions/2169832/data-mapper-vs-active-record)的对比。

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2009-05-14T12:36:13.857

试试[RedBean](http://redbeanphp.com)，它需要：

*   无配置
*   没有数据库（它即时创建所有内容）
*   没有型号
*   等等

它甚至为您执行所有锁定和事务，并在后台监控性能。（见鬼！它甚至可以进行垃圾收集......）最重要的是......你不必编写一个......一行代码......耶稣***[这个](http://redbeanphp.com)***，[ORM层](http://en.wikipedia.org/wiki/Object-relational_mapping)，救了我！

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2008-09-20T16:56:40.347

只有两个好：[Doctrine](http://www.doctrine-project.org/)和[Propel](http://propelorm.org/)。我们喜欢 Doctrine，它与[Symfony](http://en.wikipedia.org/wiki/Symfony)配合得很好。但是，如果您正在寻找除主要支持之外的数据库支持，您将不得不编写自己的代码。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2010-08-01T17:05:45.743

Axon ORM 是[Fat-Free Framework](http://fatfree.sourceforge.net)的一部分——它具有动态映射器。没有代码生成器。没有愚蠢的 XML/ [YAML](http://en.wikipedia.org/wiki/YAML)配置文件。它直接从后端读取数据库模式，因此在大多数[CRUD](http://en.wikipedia.org/wiki/Create,_read,_update_and_delete)操作中，您甚至不必扩展基本模型。它适用于所有主要的[PDO](http://en.wikipedia.org/wiki/PHP#History)支持的数据库引擎：[MySQL](http://en.wikipedia.org/wiki/MySQL)、[SQLite](http://en.wikipedia.org/wiki/SQLite)、[SQL Server](http://en.wikipedia.org/wiki/Microsoft_SQL_Server) /Sybase、Oracle、[PostgreSQL](http://en.wikipedia.org/wiki/PostgreSQL)等。

```
/* SQL */
CREATE TABLE products (
    product_id INTEGER,
    description VARCHAR(128),
    PRIMARY KEY (product_id)
);

/* PHP */
// Create
$product=new Axon('products'); // Automatically reads the above schema
$product->product_id=123;
$product->description='Sofa bed';
$product->save(); // ORM knows it's a new record

// Retrieve
$product->load('product_id=123');
echo $product->description;

// Update
$product->description='A better sofa bed';
$product->save(); // ORM knows it's an existing record

// Delete
$product->erase(); 
```

最重要的是，插件和随附的 SQL 数据访问层与框架一样轻量级：14 KB (Axon) + 6 KB (SQLdb)。无脂肪只有 55 KB。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2008-09-21T00:40:41.683

我一直在自己开发 Pork.dbObject。（一个简单的 PHP ORM 和 Active Record 实现）主要原因是我发现大多数 ORM 太重了。

Pork.dbObejct 的主要思想是轻量级和易于设置。没有一堆 XML 文件，只需在构造函数中调用一个函数来绑定它，以及一个 addRelation 或 addCustomRelation 来定义与另一个 dbObject 的关系。

看看：[Pork.dbObject](http://www.schizofreend.nl/pork.dbobject/)

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2010-07-23T22:07:00.500

试试[Doctrine2](http://www.slideshare.net/jwage/doctrine-2-not-the-same-old-php-orm)。它可能是 PHP 最强大的 ORM 工具。我将它与 Doctrine 1 分开提及，因为它是一个完全不同的软件。它已从头开始重写，仍处于测试阶段，但现在可以使用并已开发。

这是一个非常复杂的 ORM，但设计得很好。原始学说 1 中的许多魔法消失了。它提供了一个完整的解决方案，您可以[在 Doctrine2 之上编写自己的 ORM](http://www.doctrine-project.org/blog/your-own-orm-doctrine2)或仅使用其中一个[层](http://www.doctrine-project.org/projects)。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-10-21T23:02:34.957

我刚开始使用[Kohana](http://docs.kohanaphp.com/libraries/orm)，它似乎最接近 Ruby on Rails，而无需像[Propel](http://en.wikipedia.org/wiki/Propel_(PHP))那样调用多个配置文件的所有复杂性。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-09-22T20:22:36.277

查看[出口 ORM](http://www.outlet-orm.org)。它比 Propel 和 Doctrine 更简单，它的工作方式类似于 Hibernate，只是对它有更多的 PHP 感觉。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2008-09-20T18:36:33.820

我真的很喜欢[Propel](http://propel.phpdb.org/)，[在这里](http://codepoets.co.uk/propel_php5_framework_quickstart_howto_guide)你可以得到一个概述，[文档](http://propel.phpdb.org/trac/wiki/Users/Documentation/1.3)非常好，你可以通过 PEAR 或 SVN 获得它。

您只需要安装有效的 PHP5 和[Phing](http://phing.info/)即可开始生成类。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2010-08-03T15:33:04.347

[我在 PHP 库Flourish](http://flourishlib.com/)中找到了 ORM 相关的类。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2011-10-21T01:04:06.077

你应该看看[Idiorm 和 Paris](http://j4mie.github.com/idiormandparis/)。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-04-28T01:28:12.657

试一试dORM [，一个 PHP 5 的对象关系映射器](http://www.getdorm.com)。它支持各种关系（1对1）、（1对多）、（多对多）和数据类型。它完全不显眼：不需要代码生成或类扩展。在我看来，它优于任何 ORM，包括 Doctrine 和 Propel。但是，它仍处于测试阶段，可能会在接下来的几个月内发生重大变化。[http://www.getdorm.com](http://www.getdorm.com)

它也有一个非常小的学习曲线。您将使用的三种主要方法是：

```
<?php 
$object = $dorm->getClassName('id_here');
$dorm->save($object);
$dorm->delete($object); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-08-23T21:09:58.600

尝试了[Flourish library 的 ORM](http://flourishlib.com/docs/ObjectRelationalMapping)。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2009-01-13T19:52:36.217

我目前正在研究[phpDataMapper](http://phpdatamapper.com)，这是一个 ORM，旨在具有像 Ruby 的 Datamapper 项目一样的简单语法。它仍处于早期开发阶段，但效果很好。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-07-10T22:03:18.307

[我在Idiorm 和 Paris](http://j4mie.github.com/idiormandparis/)有过很棒的经历。Idiorm 是一个小型、简单的 ORM 库。Paris 是一个基于 Idiorm 的同样简单的 Active Record 实现。它适用于带有 PDO 的 PHP 5.2+。如果您想要一些简单的东西，您可以直接放入现有的应用程序，那么它是完美的。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-03-01T11:37:59.773

Until PHP 5.3 release don't expect to have a good ORM. It's a OO limitation of PHP.

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2012-01-07T03:40:05.033

看看[Kohana 的 LEAP ORM](http://orm.spadefootcode.com)。它适用于大量数据库，包括[DB2](http://en.wikipedia.org/wiki/IBM_DB2)、[Drizzle](http://en.wikipedia.org/wiki/Drizzle_%28database_server%29)、[Firebird](http://en.wikipedia.org/wiki/Firebird_%28database_server%29)、[MariaDB](http://en.wikipedia.org/wiki/MariaDB)、SQL Server、[MySQL](http://en.wikipedia.org/wiki/MySQL)、Oracle、[PostgreSQL](http://en.wikipedia.org/wiki/PostgreSQL)和[SQLite](http://en.wikipedia.org/wiki/SQLite)。通过一个简单的自动加载功能，它几乎可以与任何 PHP 框架一起使用。源代码位于[https://github.com/spadefoot/kohana-orm-leap的](https://github.com/spadefoot/kohana-orm-leap)[GitHub](http://en.wikipedia.org/wiki/GitHub)上。您可以在线查看[LEAP 的教程](http://orm.spadefootcode.com/tutorials/index/)。

ORM 库使用非整数主键和复合键。连接是通过数据库连接池管理的，它适用于原始 SQL 查询。ORM 甚至有一个查询构建器，可以让构建 SQL 语句变得超级简单。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-05-16T18:15:13.727

我的朋友 Kien 和我对他在 PHP 5.3 之前编写的 ORM 的早期版本进行了改进。我们基本上已经将 Ruby on Rails 的[Active Record](http://guides.rubyonrails.org/active_record_querying.html)移植到 PHP。它仍然缺少一些我们想要的关键特性，例如事务、复合主键支持、更多适配器（目前只有 MySQL 和 SQLite 3 可以工作）。但是，我们非常接近完成这些工作。你可以看看*[PHP ActiveRecord with PHP 5.3](http://www.derivante.com/2009/05/14/php-activerecord-with-php-53/)*。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2011-08-08T12:56:27.470

巴西 ORM：[http](http://www.hufersil.com.br/lumine) ://www.hufersil.com.br/lumine 。它适用于 PHP 5.2+。在我看来，它是葡萄牙人和巴西人的最佳选择，因为它具有易于理解的文档和大量可供下载的示例。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2009-07-17T16:29:46.500

试试 PHP ADOdb。

我不能说它是最好的，因为我没有使用过其他的。但它很快，它支持[Memcached](http://en.wikipedia.org/wiki/Memcached)和缓存。

而且它比[Zend Framework 的](http://en.wikipedia.org/wiki/Zend_Framework)DB/Select 快得多。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2012-07-20T08:31:14.503

[非规范](http://www.notorm.com/)

```
include "NotORM.php";
 $pdo = new PDO("mysql:dbname=software");
 $db = new NotORM($pdo);
 $applications = $db->application()
->select("id, title")
->where("web LIKE ?", "http://%")
->order("title")
->limit(10)
;
foreach ($applications as $id => $application) {
echo "$application[title]\n";
} 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-01-05T03:44:47.397

如果您喜欢冒险，可以查看[Repose 。](http://repose-php.org/)和[Outlet](http://outlet-orm.org/)一样，它是仿照[Hibernate](http://hibernate.org/)的。

它还处于开发的早期阶段，但到目前为止，对领域模型的唯一限制是类没有标记为 final，属性没有标记为私有。一旦我进入 PHP >= 5.3 的领域，我也会尝试实现对私有属性的支持。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2012-02-23T22:32:24.433

MicroMVC 有一个 13 KB 的[ORM](https://github.com/Xeoncross/micromvc/blob/master/Class/Core/ORM.php)，它只依赖于一个 8 KB 的[数据库类](https://github.com/Xeoncross/micromvc/blob/master/Class/Core/Database.php)。它还将所有结果作为 ORM 对象本身返回，并使用后期静态绑定来避免将有关当前对象的表和元数据的信息嵌入到每个对象中。这导致了最便宜的 ORM 开销。

它适用于[MySQL](http://en.wikipedia.org/wiki/MySQL)、[PostgreSQL](http://en.wikipedia.org/wiki/PostgreSQL)和[SQLite](http://en.wikipedia.org/wiki/SQLite)。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2011-07-02T15:21:21.443

如果您正在寻找一个实现 Data Mapper 范例而不是专门的 Active Record 的 ORM，那么我强烈建议您看看[GacelaPHP](http://gacelaphp.com)。

加塞拉特点：

*   数据映射器
*   外键映射
*   关联映射
*   依赖映射
*   具体表继承
*   查询对象
*   元数据映射
*   懒惰和急切的加载
*   完整[的 Memcached](http://en.wikipedia.org/wiki/Memcached)支持

在开发任何远程复杂的东西时，其他 ORM 解决方案过于臃肿或有繁重的限制。Gacela 通过实现数据映射器模式解决了活动记录方法的局限性，同时通过使用[PDO](http://en.wikipedia.org/wiki/PHP#History)与数据库和 Memcached 进行所有交互来将膨胀降至最低。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2011-10-24T08:26:56.300

[Agile Toolkit](http://agiletoolkit.org/)有自己独特的 ORM/ActiveRecord 和[动态 SQL](http://agiletoolkit.org/doc/dsql)实现。

简介：[http ://agiletoolkit.org/intro/1](http://agiletoolkit.org/intro/1)

语法（活动记录）：

```
$emp=$this->add('Model_Employee');
$emp['name']='John';
$emp['salary']=500;
$emp->save(); 
```

语法（动态 SQL）：

```
$result = $emp->count()->where('salary','>',400)->getOne(); 
```

虽然 Dynamic SQL 和 Active Record/ORM 可以直接使用，但 Agile Toolkit 进一步将它们与用户界面和[jQuery UI](http://en.wikipedia.org/wiki/JQuery_UI)集成。这类似于[JSF](http://en.wikipedia.org/wiki/JavaServer_Faces)，但用纯 PHP 编写。

```
$this->add('CRUD')->setModel('Employee'); 
```

这将显示用于 Employee 模型的AJAXified [CRUD 。](http://en.wikipedia.org/wiki/Crud)

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2010-11-19T16:07:15.967

查看[http://code.google.com/p/lworm/](http://code.google.com/p/lworm/)。这是一个非常简单但功能强大的轻量级 PHP ORM 系统。如果需要，您也可以轻松扩展它。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2011-03-15T06:57:47.513

我们使用的另一个很棒的开源 PHP ORM 是[PHPSmartDb](http://www.phpsmartdb.com/)。它是稳定的，使您的代码更加安全和干净。其中的数据库功能无疑是我在 PHP 5.3 中使用过的最简单的功能。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2008-09-20T18:13:58.180

教义可能是你最好的选择。在 Doctrine 之前，[DB_DataObject](http://pear.php.net/package/DB_DataObject/)本质上是唯一开源的其他实用程序。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2010-03-16T05:00:37.457

[QCubed 框架](http://qcu.be)中包含一个很棒的 ORM ；它基于代码生成和脚手架。与基于反射且通常速度较慢的 ActiveRecord 不同，代码生成基于数据库为您创建骨架类，并允许您在之后自定义它们。它就像一个魅力。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2011-02-09T11:17:32.100

看着[Syrius ORM](http://code.google.com/p/syrius/)。它是一个新的 ORM，该项目处于开发阶段，但下一个口它将以 1.0 版本发布。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2012-10-27T17:22:03.217

我在 miniOrm 上工作。只是一个迷你 ORM，用于尽可能简单地使用对象模型和 MySQL 抽象层。希望它可以帮助你：http: [//jelnivo.fr/miniOrm/](http://jelnivo.fr/miniOrm/)

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-05-03T07:05:30.090

如果你正在寻找一个 ORM，比如[Hibernate](http://en.wikipedia.org/wiki/Hibernate_%28Java%29)，你应该看看[PMO](http://pmo.developpez.com)。

它可以很容易地集成到[SOA](http://en.wikipedia.org/wiki/Service-oriented_architecture)架构中（只需开发一个 Web 服务类）。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-11-05T05:31:59.430

用于 PDO 扩展的 PHP ORM Faces。请参阅*[PHP Faces 框架](http://www.webmahsulleri.com/php-faces/)*。

```
$urun = new Product();
$urun->name='CPU'
$urun->prince='124';
$urun->save(); 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2011-06-22T20:47:23.493

[Sado](http://www.shayanderson.com/projects/sado-php-orm.htm "PHP ORM 和 DB 层")是一个简单的 PHP ORM 包，易于使用，并提供视频教程

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2011-03-02T18:48:50.127

尝试[PdoMap](http://www.pdomap.net/)。维基百科声称这是受到 Hibernate 的启发。由于我从未使用过 Hibernate，因此无法判断 :)，但根据我的经验，我会说 ORM 好且快速，易于实现，学习曲线比其他 ORM 不那么陡峭。

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2011-01-20T09:13:15.127

一个非常好的简单 ORM 是[MyActiveRecord](http://www.phpclasses.org/package/2990-PHP-Map-objects-to-MySQL-database-table-rows.html)。[MyActiveRecord 文档](http://www.itobargarcia.com.ar/lib/myactiverecord-2006-11-18/doc/howto.html)。我一直在使用它，可以说它非常简单且经过良好测试。

# vb.net - VS2005 VB.NET XML 注释''' - 停止工作

> ID：108717
> 
> 赞同：16
> 
> 时间：2008-09-20T16:52:16.487
> 
> 标签：vb.net, visual-studio-2005, comments

我在不同项目中混合使用 VB 和 C# 的解决方案中使用 VS2005。

我在几台不同的计算机上使用此解决方案，并且带有 /// (c#) 和 ''' (VB) 的 XML 注释已经好几个月了。

突然之间，在我的主要开发机器上，他们已经停止在 VB 中工作。他们仍然在 C# 中工作。

他们也在其他项目中工作（在 VB 中）。这只是这一解决方案中的所有 VB 项目。

有没有人有任何想法？

我无法确定它何时停止工作，因为我已经数周/数月没有修改很多 VB 代码。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-20T17:32:58.323

啊哈！

在属性下的“编译”选项卡中，未勾选“生成文档”复选框。

看着 SVN，似乎有人出于某种原因在未勾选的情况下签入了 VB 项目。

谢谢您的帮助！这是我第一次使用这个网站。看起来参与的人做得很好。我喜欢你不必注册的事实。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T16:56:56.883

出现这种情况的一个原因是不再创建/更新 XML 文件。确保在项目属性页中设置了 XML 文档文件。您的 XML 文件是否已置于源代码控制之下，如果是，是否已在构建中签出。如果没有，则不会更新。

# command-line - 命令行界面的实现建议

> ID：108728
> 
> 赞同：37
> 
> 时间：2008-09-20T16:56:06.823
> 
> 标签：command-line, user-interface

我正在重新设计一个命令行应用程序，并正在寻找一种使其使用更直观的方法。传递到命令行应用程序的参数格式是否有任何约定？还是人们发现有用的任何其他方法？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-20T17:21:15.047

我看到很多 Windows 命令行细节，但如果你的程序是为 Linux 设计的，我发现[GNU 命令行标准](http://www.gnu.org/prep/standards/html_node/Command_002dLine-Interfaces.html)是最直观的。基本上，它对命令的长形式（例如，）使用双连`--help`字符，对短版本（例如，）使用单个连字符`-h`。您还可以将短版本“堆叠”在一起（例如，`tar -zxvf` *`filename`*），并根据您的内心需求混合长短匹配。

GNU 站点还列出了[标准选项名称](http://www.gnu.org/prep/standards/html_node/Option-Table.html#Option-Table)。

[getopt 库](http://www.gnu.org/software/libc/manual/html_node/Getopt.html)极大地简化了这些命令的解析。如果 C 不是你的包，[Python](http://docs.python.org/lib/module-getopt.html)也有类似的库，[Perl](http://aplawrence.com/Unix/perlgetopts.html)也有。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-20T17:02:09.817

如果您使用 C# 试试[Mono.GetOptions](http://www.go-mono.com/docs/index.aspx?link=N%3AMono.GetOptions)，它是一个非常强大且易于使用的命令行参数解析器。它适用于 Mono 环境和 Microsoft .NET Framework。

编辑：这里有一些功能

*   每个参数有 2 个 CLI 表示（1 个字符和字符串，例如 -a 或 --add）
*   默认值
*   强类型
*   自动生成带有说明的帮助屏幕
*   自动生成版本和版权屏幕

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-20T17:06:43.740

我喜欢某些 CLI 的一件事是**快捷方式**的使用。
即，以下所有行都在做同样的事情

```
myCli.exe describe someThing
myCli.exe descr someThing
myCli.exe desc someThing 
```

这样，用户可能不必每次都键入 all 命令。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-05-22T06:41:32.550

一个好的和有用的参考：

[https://commandline.codeplex.com/](https://commandline.codeplex.com/)

可通过 NuGet 获得的库：

1.  最新稳定：`Install-Package CommandLineParser`.
2.  最新发布：`Install-Package CommandLineParser -pre`.

使用默认单例进行一行解析：`CommandLine.Parser.Default.ParseArguments(...)`.
一行帮助屏幕生成器：`HelpText.AutoBuild(...)`.
将命令行参数映射到`IList<string>`、数组、枚举或标准标量类型。
插件友好的架构，如此处所述。
将动词命令定义为`git commit -a`.
使用 lambda 表达式创建解析器实例。

快速入门：[https ://commandline.codeplex.com/wikipage?title=Quickstart&referringTitle=Documentation](https://commandline.codeplex.com/wikipage?title=Quickstart&referringTitle=Documentation)

```
// Define a class to receive parsed values
class Options {
  [Option('r', "read", Required = true,
    HelpText = "Input file to be processed.")]
  public string InputFile { get; set; }

  [Option('v', "verbose", DefaultValue = true,
    HelpText = "Prints all messages to standard output.")]
  public bool Verbose { get; set; }

  [ParserState]
  public IParserState LastParserState { get; set; }

  [HelpOption]
  public string GetUsage() {
    return HelpText.AutoBuild(this,
      (HelpText current) => HelpText.DefaultParsingErrorsHandler(this, current));
  }
}

// Consume them
static void Main(string[] args) {
  var options = new Options();
  if (CommandLine.Parser.Default.ParseArguments(args, options)) {
    // Values are available here
    if (options.Verbose) Console.WriteLine("Filename: {0}", options.InputFile);
  }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T17:03:54.900

最好的办法是，如果可以的话，不要假设任何事情。当操作员键入要执行的应用程序名称并且没有任何参数时，请使用 USAGE 块或替代方法打开 Windows 窗体并允许他们输入您需要的所有内容。

```
c:\>FOO

FOO

USAGE FOO -{Option}{Value}

-A Do A stuff
-B Do B stuff

c:\> 
```

参数定界我放在宗教主题的标题下：连字符（破折号）、双连字符、斜线、无、位置等。

您没有指明您的平台，但对于下一条评论，我将假设 Windows 和 .net

您可以在 .net 中创建一个基于控制台的应用程序，并允许它使用 Forms 与桌面交互，只需选择基于控制台的项目，然后添加 Windows.Forms、System.Drawing 等 DLL。

我们一直这样做。这确保了没有人会在黑暗的小巷中转弯。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-20T17:08:16.747

这是一篇可能对您有所帮助的 CodeProject 文章...

[C#/.NET 命令行参数解析器](http://www.codeproject.com/KB/recipes/command_line.aspx)

如果 VB 是您的口味，这里有一篇单独的文章（包含更多指导相关内容）来查看...

[使用 VB.NET 解析和验证命令行参数](http://www.devx.com/dotnet/Article/10115)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-20T17:12:43.553

命令行约定因操作系统而异，但可能得到最多使用和最公开审查的约定是 GNU getopt 包支持的约定。看[http://www.gnu.org/software/libc/manual/html_node/Using-Getopt.html](http://www.gnu.org/software/libc/manual/html_node/Using-Getopt.html)了解更多信息。

它允许您将单字母命令（例如 -nr）与更长的自文档选项（例如 --numeric --reverse）混合使用。友好一点，并实现一个 --help (-?) 选项，然后您的用户将能够弄清楚他们需要知道的所有内容。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-20T17:20:36.467

补充@vonc 的答案，不要接受模棱两可的缩写。例如：

```
 myCli.exe describe someThing
  myCli.exe destroy someThing
  myCli.exe des someThing ??? 
```

事实上，在那种情况下，我可能不会接受“破坏”的缩写......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-20T17:04:32.107

我总是加 /? 参数来获得帮助，我总是尝试使用默认（即最常见的场景）实现。

否则，我倾向于将“/x”用于开关，将“/x:value”用于需要传递值的开关。使用正则表达式解析参数变得非常容易。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-05-23T02:24:26.260

**我开发了这个框架，也许它有帮助：**

SysCommand 是一个强大的跨平台框架，用于在 .NET 中开发控制台应用程序。简单，类型安全，受 MVC 模式影响很大。

[https://github.com/juniorgasparotto/SysCommand](https://github.com/juniorgasparotto/SysCommand)

```
namespace Example.Initialization.Simple
{
    using SysCommand.ConsoleApp;

    public class Program
    {
        public static int Main(string[] args)
        {
            return App.RunApplication();
        }
    }

    // Classes inheriting from `Command` will be automatically found by the system
    // and its public properties and methods will be available for use.
    public class MyCommand : Command
    {
        public void Main(string arg1, int? arg2 = null)
        {
            if (arg1 != null)
                this.App.Console.Write(string.Format("Main arg1='{0}'", arg1));
            if (arg2 != null)
                this.App.Console.Write(string.Format("Main arg2='{0}'", arg2));
        }

        public void MyAction(bool a)
        {
            this.App.Console.Write(string.Format("MyAction a='{0}'", a));
        }
    }
} 
```

* * *

**测试：**

```
// auto-generate help
$ my-app.exe help

// method "Main" typed
$ my-app.exe --arg1 value --arg2 1000

// or without "--arg2"
$ my-app.exe --arg1 value

// actions support
$ my-app.exe my-action -a 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-20T17:01:09.743

-operation [参数] -command [你的命令] -anotherthings [otherparams]....

例如，

```
YourApp.exe -file %YourProject.prj% -Secure true 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-20T17:02:29.473

如果您使用生成命令行界面的标准工具之一，例如 getopts，那么您将自动符合要求。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-20T17:04:48.033

您用于应用程序的约定取决于

1）它是什么类型的应用程序。
2）您使用的是什么操作系统。Linux？视窗？他们都有不同的约定。

我的建议是查看系统上其他命令的其他命令行界面，特别注意传递的参数。有不正确的参数应该给用户解决方案指示的错误消息。易于查找的帮助屏幕也有助于提高可用性。

在不知道您的应用程序究竟会做什么的情况下，很难给出具体的例子。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-20T17:10:00.143

> 您用于应用程序的约定取决于
> 
> 1）它是什么类型的应用程序。2）您使用的是什么操作系统。

这绝对是真的。我不确定 dos-prompt 约定，但在类 unix 系统上，一般约定大致是：

1）格式是

> > 应用名称参数

2）单字符参数（如'x'）作为-x传递 3）多字符参数（如'add-keys'）作为--add-keys传递

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-20T17:34:01.457

如果您使用 Perl，我的[CLI::Application](http://search.cpan.org/~jkramer/CLI-Application-0.02/lib/CLI/Application.pm)框架可能正是您所需要的。它使您可以轻松地使用类似 SVN/CVS/GIT 的用户界面构建应用程序（“your-command -o --long-opt some-action-to-execute some parameters”）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-11-21T05:29:04.100

我创建了一个包含命令行解析器的 .Net C# 库。您只需要创建一个继承自 CmdLineObject 类的类，调用 Initialize，它就会自动填充属性。它可以处理不同类型的转换（使用项目中也包含的高级转换库）、数组、命令行别名、单击一次参数等。它甚至可以自动创建命令行帮助 (/?)。

如果您有兴趣，该项目的 URL 是[http://bizark.codeplex.com](http://bizark.codeplex.com)。它目前仅作为源代码提供。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-07-26T08:29:24.900

我刚刚发布了一个更好的命令行解析器。
[https://github.com/gene-l-thomas/coptions](https://github.com/gene-l-thomas/coptions)
它在 nuget **Install-Package coptions**

```
using System;
using System.Collections.Generic;
using coptions;

[ApplicationInfo(Help = "This program does something useful.")]
public class Options
{
    [Flag('s', "silent", Help = "Produce no output.")]
    public bool Silent;

    [Option('n', "name", "NAME", Help = "Name of user.")]
    public string Name
    {
        get { return _name;  }
        set { if (String.IsNullOrWhiteSpace(value))
                throw new InvalidOptionValueException("Name must not be blank");
              _name = value;
        }
    }
    private string _name;

    [Option("size", Help = "Size to output.")]
    public int Size = 3;

    [Option('i', "ignore", "FILENAME", Help = "Files to ignore.")]
    public List<string> Ignore;

    [Flag('v', "verbose", Help = "Increase the amount of output.")]
    public int Verbose = 1;

    [Value("OUT", Help = "Output file.")]
    public string OutputFile;

    [Value("INPUT", Help = "Input files.")]
    public List<string> InputFiles;
}

namespace coptions.ReadmeExample
{
    class Program
    {
        static int Main(string[] args)
        {
            try
            {
                Options opt = CliParser.Parse<Options>(args);

                Console.WriteLine(opt.Silent);
                Console.WriteLine(opt.OutputFile);
                return 0;
            }
            catch (CliParserExit)
            {
                // --help
                return 0;

            } catch (Exception e)
            {
                // unknown options etc...
                Console.Error.WriteLine("Fatal Error: " + e.Message);
                return 1;
            }
        }
    }
} 
```

支持自动 --help 生成，动词，例如 commmand.exe
享受。

# c++ - C中不必要的指针转换

> ID：108768
> 
> 赞同：16
> 
> 时间：2008-09-20T17:11:40.060
> 
> 标签：c++, c, pointers

我在这个帖子上的回答得到了评论：

[函数调用中的 Malloc 似乎在返回时被释放？](https://stackoverflow.com/questions/105477)

简而言之，我有这样的代码：

```
int * somefunc (void)
{
  int * temp = (int*) malloc (sizeof (int));
  temp[0] = 0;
  return temp;
} 
```

我得到了这个评论：

> 我可以说，请不要投射malloc的返回值吗？它不是必需的，可以隐藏错误。

我同意 C 中不需要强制转换。它在 C++ 中是强制性的，所以我通常添加它们以防万一有一天我必须在 C++ 中移植代码。

但是，我想知道这样的演员阵容如何隐藏错误。有任何想法吗？

# 编辑：

似乎双方都有非常好的和有效的论点。感谢您的发布，伙计们。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-20T17:17:51.077

我发表了一个答案似乎很合适，因为我留下了评论：P

基本上，如果您忘记包含`stdlib.h`，编译器将假定`malloc`返回一个`int`. 如果不进行强制转换，您将收到警告。铸造你不会。

因此，通过强制转换，您将一无所获，并冒着压制合法警告的风险。

很多关于这个的文章，一个快速的谷歌搜索会出现更详细的解释。

## 编辑

有人认为

```
TYPE * p;
p = (TYPE *)malloc(n*sizeof(TYPE)); 
```

当你不小心没有分配足够的内存时，这很明显，因为你认为`p`was `TYPe`not `TYPE`，因此我们应该强制转换 malloc 因为这种方法的优势覆盖了意外抑制编译器警告的较小成本。

我想指出两点：

1.  你应该写`p = malloc(sizeof(*p)*n);`总是确保你分配了正确的空间
2.  使用上述方法，如果您更改 的类型，则需要在 3 个地方进行更改`p`：一次在声明中，一次在 中`malloc`，一次在演员表中。

简而言之，我个人仍然认为没有必要强制转换的返回值，`malloc`这当然不是最佳实践。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-20T18:55:22.683

这个问题被标记为 C 和 C++，所以它至少有两个答案，恕我直言：

# C

咳咳……随心所欲。

我相信上面给出的原因“如果你不包含“stdlib”那么你就不会收到警告”不是一个有效的原因，因为人们不应该依赖这种黑客来不要忘记包含一个标题。

可能使您**不**编写强制转换的真正原因是 C 编译器已经默默地将 a 强制`void *`转换为您想要的任何指针类型，因此，自己做是矫枉过正和无用的。

如果您想要类型安全，您可以切换到 C++ 或编写自己的包装函数，例如：

```
int * malloc_Int(size_t p_iSize) /* number of ints wanted */
{
   return malloc(sizeof(int) * p_iSize) ;
} 
```

# C++

有时，即使在 C++ 中，您也必须从 malloc/realloc/free 实用程序中获利。然后你必须投。但你已经知道了。与往常一样，使用 static_cast<>() 会比 C 风格的强制转换更好。

而在 C 语言中，您可以通过模板覆盖 malloc（和 realloc 等）以实现类型安全：

```
template <typename T>
T * myMalloc(const size_t p_iSize)
{
 return static_cast<T *>(malloc(sizeof(T) * p_iSize)) ;
} 
```

这将被用作：

```
int * p = myMalloc<int>(25) ;
free(p) ;

MyStruct * p2 = myMalloc<MyStruct>(12) ;
free(p2) ; 
```

和以下代码：

```
// error: cannot convert ‘int*’ to ‘short int*’ in initialization
short * p = myMalloc<int>(25) ;
free(p) ; 
```

不会编译，所以，*没问题*。

总而言之，在纯 C++ 中，如果有人在您的代码中发现多个 C malloc，您现在没有任何借口... :-)

# C + C++ 交叉

有时，您想要生成可以在 C 和 C++ 中编译的代码（无论出于何种原因……这不是 C++`extern "C" {}`块的重点吗？）。在这种情况下，C++ 需要强制转换，但 C 不会理解 static_cast 关键字，因此解决方案是 C 风格的强制转换（正是由于这种原因，在 C++ 中仍然是合法的）。

请注意，即使编写纯 C 代码，使用 C++ 编译器编译它也会给您带来更多警告和错误（例如，尝试使用函数而不首先声明它不会编译，这与上面提到的错误不同）。

因此，为了安全起见，编写可以在 C++ 中干净编译的代码，研究并纠正警告，然后使用 C 编译器生成最终的二进制文件。这意味着，再次以 C 风格的演员表编写演员表。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-20T18:47:15.073

它可能引入的一个可能错误是，如果您使用 C（不是 C++）在 64 位系统上进行编译。

基本上，如果您忘记包含`stdlib.h`，则将应用默认的 int 规则。因此，编译器会很高兴地假设在许多 64 位系统上`malloc`具有原型，`int malloc();`int 是 32 位，指针是 64 位。

哦，值被截断了，你只能得到指针的低 32 位！现在，如果你转换 的返回值`malloc`，这个错误会被转换隐藏。但如果你不这样做，你会得到一个错误（类似于“无法将 int 转换为 T *”的性质）。

这当然不适用于 C++，原因有两个。首先，它没有默认的 int 规则，其次它需要强制转换。

总而言之，无论如何，你应该只是新的 C++ 代码：-P。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-20T17:19:16.003

好吧，我认为恰恰相反——总是直接将其转换为所需的类型。[继续阅读这里！](https://www.securecoding.cert.org/confluence/display/seccode/MEM02-C.+Immediately+cast+the+result+of+a+memory+allocation+function+call+into+a+pointer+to+the+allocated+type?focusedCommentId=15630941)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T18:58:44.610

“忘记了 stdlib.h”的论点是一个稻草人。现代编译器将检测并警告问题（gcc -Wall）。

您应该始终立即转换 malloc 的结果。不这样做应该被认为是一个错误，而不仅仅是因为它会像 C++ 一样失败。例如，如果您的目标是具有不同类型指针的机器架构，那么如果您不进行强制转换，您可能会遇到一个非常棘手的错误。

**编辑**：评论员[埃文·特兰](https://stackoverflow.com/users/13430/evan-teran)是正确的。我的错误是认为编译器不必在任何上下文中对 void 指针做任何工作。当我想到 FAR 指针错误时，我会发疯，所以我的直觉是强制转换所有内容。谢谢埃文！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T17:25:26.690

实际上，转换可以隐藏错误的唯一方法是，如果您正在从一种数据类型转换为较小的数据类型并丢失数据，或者您正在将梨转换为苹果。举个例子：

```
int int_array[10];
/* initialize array */
int *p = &(int_array[3]);
short *sp = (short *)p;
short my_val = *sp; 
```

在这种情况下，转换为 short 会从 int 中删除一些数据。然后这个案例：

```
struct {
    /* something */
} my_struct[100];

int my_int_array[100];
/* initialize array */
struct my_struct *p = &(my_int_array[99]); 
```

您最终会指向错误类型的数据，甚至指向无效的内存。

但总的来说，如果你知道自己在做什么，就可以进行选角。更重要的是，当您从 malloc 获取内存时，它恰好返回一个 void 指针，除非您强制转换它，否则您根本无法使用它，并且大多数编译器会警告您如果您正在转换为左值（作业的左侧）无论如何都不能接受。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-28T02:40:16.707

```
#if CPLUSPLUS
#define MALLOC_CAST(T) (T)
#else
#define MALLOC_CAST(T)
#endif
...
int * p;
p = MALLOC_CAST(int *) malloc(sizeof(int) * n); 
```

或者，交替

```
#if CPLUSPLUS
#define MYMALLOC(T, N) static_cast<T*>(malloc(sizeof(T) * N))
#else
#define MYMALLOC(T, N) malloc(sizeof(T) * N)
#endif
...
int * p;
p = MYMALLOC(int, n); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-02-10T18:31:23.587

`stdlib.h`人们已经引用了我通常提出的原因：关于不包括和使用的旧（不再适用于大多数编译器）论点`sizeof *p`以确保类型和大小始终匹配，而不管以后是否更新。我确实想指出另一个反对强制转换的论点。这是一个小问题，但我认为它适用。

C 是相当弱类型的。大多数安全类型转换是自动发生的，而大多数不安全类型转换需要强制转换。考虑：

```
int from_f(float f)
{
    return *(int *)&f;
} 
```

那是危险的代码。它在技术上是未定义的行为，但实际上它会在几乎每个运行它的平台上做同样的事情。演员帮助告诉你**“这个代码是一个可怕的黑客。”**

考虑：

```
int *p = (int *)malloc(sizeof(int) * 10); 
```

我看到一个演员，我想知道，“为什么这是必要的？黑客在哪里？” 它使我的脖子毛骨悚然，发生了一些邪恶的事情，而实际上代码是完全无害的。

只要我们使用 C，强制转换（尤其是指针强制转换）就是一种表达“这里发生了一些邪恶且容易破坏的事情”的方式。他们可能会完成您需要完成的事情，但他们会向您和未来的维护者表明孩子们不好。

在 every 上使用强制转换会`malloc`减少指针强制转换的“hack”指示。看到类似`*(int *)&f;`.

注意：C 和 C++ 是不同的语言。C 是弱类型，C++ 是强类型。强制转换在 C++*中是*必要的，即使它们根本不表示 hack，因为（在我看来）不必要的强大 C++ 类型系统。（真的，这个特殊情况是我认为 C++ 类型系统“太强”的唯一地方，但我想不出它“太弱”的任何地方，这使得它总体上对我的口味来说太强了。）

如果您担心 C++ 兼容性，请不要担心。如果您正在编写 C，请使用 C 编译器。每个平台都有很多非常好的可用。如果出于某种荒谬的原因，您*必须*编写可以干净地编译为 C++ 的 C 代码，那么您并不是真的在编写 C。如果您需要将 C 移植到 C++，您应该进行大量更改以使您的 C 代码更符合习惯C++。

如果你不能做到这一点，那么无论你做什么，你的代码都不会很漂亮，所以此时你决定如何转换并不重要。我确实喜欢使用模板创建一个返回正确类型的新分配器的想法，尽管这基本上只是重新发明了`new`关键字。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T17:17:06.770

将返回 (void *) 的函数转换为 (int *) 是无害的：您将一种类型的指针转​​换为另一种类型。

将返回整数的函数转换为指针很可能是不正确的。如果您没有明确地转换它，编译器会标记它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T17:19:08.280

一个可能的错误可能（取决于您是否真正想要）以一种大小的比例进行分配，并分配给不同类型的指针。例如，

```
int *temp = (int *)malloc(sizeof(double)); 
```

在某些情况下您可能想要这样做，但我怀疑它们很少见。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-20T17:41:26.197

我认为你应该把演员表放进去。考虑到类型有三个位置：

```
T1 *p;
p = (T2*) malloc(sizeof(T3)); 
```

这两行代码可能相距甚远。因此，编译器[强制执行](https://www.securecoding.cert.org/confluence/display/seccode/MEM02-C.+Immediately+cast+the+result+of+a+memory+allocation+function+call+into+a+pointer+to+the+allocated+type?focusedCommentId=15630941)T1 == T2 是件好事。更容易直观地验证 T2 == T3。

如果你错过了T2演员，那么你必须希望T1 == T3。

另一方面，您缺少 stdlib.h 参数-但我认为这不太可能成为问题。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-20T17:21:46.137

另一方面，如果您需要将代码移植到 C++，最好使用“new”运算符。

# c# - 带有 comboboxColumn 的 DatagridView 虚拟模型

> ID：108777
> 
> 赞同：2
> 
> 时间：2008-09-20T17:15:21.097
> 
> 标签：c#, .net, winforms, datagridview

是否可以在 datagridview 的组合框列中的不同行中有不同的项目。这将使用虚拟模式。代码示例会很棒。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T20:56:03.627

我想你要找的就[在这里](http://www.timvw.be/exploring-datagridviewcomboboxcolumn-databinding/)。

该技术涉及处理 DataGridView 控件的 EditingControlShowing 事件和更新 DataGridViewComboBoxEditingControl 的数据源（可能基于该行中其他列中的值）。

### 编辑：这是一些显示要点的代码

```
//Some types we'll need
enum Jobs
{
    Programmer,
    Salesman
}

enum DrinkCode
{
    Coffee,
    Coke,
    MountainDew,
    GinAndTonic
}

internal class Drink
{
    public DrinkCode Code { get; set; }
    public string Name { get; set; }
    public bool Caffeinated { get; set; }
    public bool Alcoholic { get; set; }
}

internal class Person
{
    public string Name { get; set; }

    public Jobs Job { get; set; }

    public DrinkCode Drink { get; set; }
}

// the form class
public partial class Form1 : Form
{

    public Form1()
    {
        InitializeComponent();
    }

    private void Form1_Load(object sender, EventArgs e)
    {
        BindingSource bindingSource = new BindingSource();
        bindingSource.DataSource = FindPersons();
        this.dataGridView1.DataSource = bindingSource;

        DataGridViewComboBoxColumn column =
            new DataGridViewComboBoxColumn()
        {
            column.DataPropertyName = "Drink";
            column.HeaderText = "beverage";
            column.DisplayMember = "Name";
            column.ValueMember = "Code";
            column.DataSource = BuildDrinksList();
        }

       dataGridView1.Columns.Add(column);
       //handling this event is the nub of the solution
       dataGridView1.EditingControlShowing += 
           new DataGridViewEditingControlShowingEventHandler(dataGridView1_EditingControlShowing);
    }

    void dataGridView1_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
    {
        //When the focus goes into the combo box cell, we can update the contents of the dropdown
        // 
        DataGridViewComboBoxEditingControl comboBox = e.Control as DataGridViewComboBoxEditingControl;
        //if you have more than one drop down this is not going to be good enough, but hey, it's an example!
        if (comboBox != null)
        {
            BindingSource bindingSource = this.dataGridView1.DataSource as BindingSource;
            Person person = bindingSource.Current as Person;
            BindingList<Drink> bindingList = t his.BuildDrinksList(person);
            comboBox.DataSource = bindingList;

        }
    }

    //the rest of this is just data to make the example work
    private BindingList<Drink> BuildDrinksList()
    {
        var drinks = new BindingList<Drink>();

        drinks.Add(new Drink() { Alcoholic = false, Caffeinated = true, Code = DrinkCode.Coffee, Name = "Coffee" });
        drinks.Add(new Drink() { Alcoholic = false, Caffeinated = true, Code = DrinkCode.Coke, Name = "Coke" });
        drinks.Add(new Drink() { Alcoholic = false, Caffeinated = true, Code = DrinkCode.MountainDew, Name = "Mountain Dew" });
        drinks.Add(new Drink() { Alcoholic = true, Caffeinated = false, Code = DrinkCode.GinAndTonic, Name = "Gin and Tonic" });

        return drinks;
    }

    private BindingList<Drink> BuildDrinksList(Person p)
    {
        var drinks = new BindingList<Drink>();

        if (p.Job == Jobs.Programmer)
        {
            drinks.Add(new Drink() { Alcoholic = false, Caffeinated = true, Code = DrinkCode.Coffee, Name = "Coffee" });
            drinks.Add(new Drink() { Alcoholic = false, Caffeinated = true, Code = DrinkCode.Coke, Name = "Coke" });
            drinks.Add(new Drink() { Alcoholic = false, Caffeinated = true, Code = DrinkCode.MountainDew, Name = "Mountain Dew" });
        }
        if (p.Job == Jobs.Salesman)
        {
            drinks.Add(new Drink() { Alcoholic = true, Caffeinated = false, Code = DrinkCode.GinAndTonic, Name = "Gin and Tonic" });
        }
        return drinks;
    }

    private BindingList<Person> FindPersons()
    {
        BindingList<Person> bindingList = new BindingList<Person>();
        bindingList.Add(new Person() { Job = Jobs.Programmer, Drink = DrinkCode.Coffee, Name = "steve" });
        bindingList.Add(new Person() { Job = Jobs.Salesman, Drink = DrinkCode.GinAndTonic, Name = "john" });
        return bindingList;
    }
} 
```

# java - EJB 还活着吗？

> ID：108782
> 
> 赞同：10
> 
> 时间：2008-09-20T17:18:25.957
> 
> 标签：java, jakarta-ee, ejb

您还在项目中使用会话或实体 EJB 吗？为什么？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-23T19:21:14.967

EJB3 是对以前版本的**巨大**改进。*从技术上讲*，它仍然是 JavaEE 的标准服务器端实现工具集，并且由于它现在没有以前的包袱（感谢注释和 Java Persistence），因此非常有用，并且正如我们所说的那样正在部署。正如一位评论者所指出的，JBoss SEAM 就是以此为基础的。

EJB 3 是 Spring 的可行替代方案，这两种技术可能会变得更加紧密相关。 [这篇](http://java.dzone.com/articles/end-spring-vs-ejb-wars-sight)文章详细说明了 Spring 3.0 将与 EJB Lite 兼容（我不确定它到底是什么）并且可能成为 Java EE 6 的一部分。

EJB 不会去任何地方。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-20T19:28:02.947

我们在这里使用 EJB，它与 JBoss Seam 和 JSF、Faclets 和 MyFaces Trinidad 配合得很好。良好的 UI、模板、AJAX 和在 JBoss 4.2 上运行的 24/7 稳定生产。

它是用于业务流程、工作流、消息传递、Web 服务和 UI 控制的良好堆栈。基于具有 mysql 持久性的 entitybeans 的快速交付功能、简单的编程和稳定的基础。

我不想错过 EJB 3 的功能集来完成我们产品所需的任务。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-12-10T06:11:34.173

[请参阅Java EE 6](http://www.theserverside.com/news/1363662/Java-EE-6-Overview "JEE 6 中的新功能")中的新功能概述。EJB 3.1 和 WebBeans 1.0 有助于使 Java EE 6 容器环境变得更易于使用，类似于 Java EE 5 或 Spring 上的 Seam 等框架。如果您熟悉 Spring 3，那么[本文](http://www.javacodegeeks.com/2011/11/from-spring-to-java-ee-6.html "JEE 6 与春季 3")将说明 Java EE 是如何演变成可比较的框架的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-12-06T14:46:31.673

EJB 仍然存在并且正在成长。有许多新特性（SOAP/RESTful webservice、JPA 实体、JAXB ......）依赖于它，或者至少重用了开发理念。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-20T17:49:11.920

是的，但是对于大多数用例来说，EJB 非常复杂。非常聪明，但在大多数情况下确实矫枉过正。因此，现在采用轻量级方法。

贾斯汀

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2021-01-23T19:19:05.470

我刚刚开始从事 EJB 项目的工作。我不记得使用这项技术有多么沉重和辛苦。Spring、Hibernate 和 Maven 的到来是幸运的。从那时起，一切都不同了，而且容易多了。

我总能看到这项技术从未被正确使用，并被视为一种我从未理解的模式。

假设您需要两个容器，如果可能的话，每个容器都需要一台服务器。一个用于业务（EJB），另一个用于视图（MVC）。我从来没有看到过。

嗯，很高兴知道 EBJ 正在升级。

# testing - 一般定义测试过程

> ID：108798
> 
> 赞同：4
> 
> 时间：2008-09-20T17:22:53.513
> 
> 标签：testing, quotes

你如何定义测试？为了充分披露，我发布这个是因为我已经有了一些我喜欢的答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T17:23:56.303

“测试是将不可见的与模糊的进行比较的过程，以避免不可想象的事情发生在匿名者身上。”——[詹姆斯·巴赫](http://www.satisfice.com/blog)

听起来很有趣，但如果你把每个词都解析出来，那就对了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T17:25:00.637

测试是验证每个功能（用户故事、需求...）是否已按要求开发的任何过程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T17:24:18.610

这实际上取决于您所指的测试环境。

从最严格的意义上讲，测试只是仔细检查程序是否按照预期执行，无论用户输入什么，都不会出错。此外，错误将是意想不到的。并非所有错误都会使程序崩溃。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T17:26:14.130

一些更有趣的“质量报价”[在这里](http://qcboss.wordpress.com/2008/09/08/quotes-on-quality/)。这是一个简短的列表，所以我将它们发布（来自 qcboss.wordpress.com）：

“测试代码的一种有效方法是在其自然边界上运行它”——Brian Kernighan

“测试是有组织的怀疑主义。”——詹姆斯·巴赫

“程序测试可以用来显示错误的存在，但永远不能显示它们的缺失！”——Dijkstra

“当心上述代码中的错误；我只是证明它是正确的，没有尝试过。”- Knuth

软件测试人员：“堕落的思想，有用的人。” — 雷克斯布莱克

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T17:54:15.683

测试授予我：

*   接受我无法改变的bug的宁静，
*   有勇气修复我可以改变的错误，并且
*   知道区别的智慧

（哎呀，我一定把它和另一个承诺混淆了......）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-20T17:58:25.160

测试是实现与意图/期望的比较。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-07T18:50:46.423

最好像尝试这个应用程序一样进行测试 [http://www.testalways.com/2010/07/05/find-bugs-and-patterns/](http://www.testalways.com/2010/07/05/find-bugs-and-patterns/)

然后描述你刚刚做了什么。我会考虑定义测试过程

# algorithm - 将时间戳转换为字母数字

> ID：108807
> 
> 赞同：1
> 
> 时间：2008-09-20T17:29:37.520
> 
> 标签：algorithm, time

我有一个应用程序，用户必须记住并插入一个像 1221931027 这样的 unix 时间戳。为了更容易记住密钥，我喜欢通过允许字符 [az] 来减少要插入的字符数。所以我正在寻找一种算法来将时间戳转换为更短的字母数字版本并向后执行相同的操作。有什么提示吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T17:31:37.610

您可以将时间戳转换为 base-36。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T18:51:48.447

```
#include <time.h>
#include <stdio.h>

// tobase36() returns a pointer to static storage which is overwritten by 
// the next call to this function. 
//
// This implementation presumes ASCII or Latin1.

char * tobase36(time_t n)
{
  static char text[32];
  char *ptr = &text[sizeof(text)];
  *--ptr = 0; // NUL terminator

  // handle special case of n==0
  if (n==0) {
    *--ptr = '0';
    return ptr;
  }

  // some systems don't support negative time values, but some do
  int isNegative = 0;
  if (n < 0)
  {
    isNegative = 1;
    n = -n;
  }

  // this loop is the heart of the conversion
  while (n != 0)
  {
    int digit = n % 36;
    n /= 36;
    *--ptr = digit + (digit < 10 ? '0' : 'A'-10);
  }

  // insert '-' if needed
  if (isNegative)
  {
    *--ptr = '-';
  }

  return ptr;
}

int main(int argc, const char **argv)
{
  int i;
  for (i=1; i<argc; ++i)
  {
    long timestamp = atol(argv[i]);
    printf("%12d => %8s\n", timestamp, tobase36(timestamp));
  }
}

/*
$ gcc -o base36 base36.c
$ ./base36 0 1 -1 10 11 20 30 35 36 71 72 2147483647 -2147483647
           0 =>        0
           1 =>        1
          -1 =>       -1
          10 =>        A
          11 =>        B
          20 =>        K
          30 =>        U
          35 =>        Z
          36 =>       10
          71 =>       1Z
          72 =>       20
  2147483647 =>   ZIK0ZJ
 -2147483647 =>  -ZIK0ZJ
*/ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T17:34:25.623

将时间戳转换为十六进制。这将从时间戳中为您生成一个较短的字母数字数字。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T18:51:21.210

有时用于此类事情的另一种选择是使用音节列表。IE。你有一个音节列表，如 ['a','ab','ba','bi','bo','ca','...] 并将数字转换为 base(len(list_of_syllables))。这在字母方面更长，但通常更容易记住诸如“flobagoka”之类的内容而不是诸如“af3q5jl”之类的内容。（缺点是很容易生成听起来像亵渎的单词）

[编辑] [这](http://shorl.com/koremutake)是这种算法的一个例子。使用这个，1221931027 将是“buruvadrage”

# asp.net-mvc - Asp.Net MVC (RC 5) 中的 404 Http 错误处理程序

> ID：108813
> 
> 赞同：20
> 
> 时间：2008-09-20T17:31:31.480
> 
> 标签：asp.net-mvc, http, http-status-code-404

如何在框架不抛出异常 500 错误代码的情况下处理 404 错误？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-20T17:38:37.593

[http://jason.whitehorn.ws/2008/06/17/Friendly-404-Errors-In-ASPNET-MVC.aspx](http://jason.whitehorn.ws/2008/06/17/Friendly-404-Errors-In-ASPNET-MVC.aspx)给出如下解释：

添加通配符路由规则作为最终规则：

```
routes.MapRoute("Error", 
                "{*url}", 
                new { controller = "Error", action = "Http404" }); 
```

任何与其他规则不匹配的请求都会被路由到错误控制器的 Http404 操作，您还需要对其进行配置：

```
public ActionResult Http404(string url) {
    Response.StatusCode = 404;
    ViewData["url"] = url;
    return View();
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-21T17:48:17.063

在请求匹配控制器但不匹配操作的情况下，您还可以在控制器中覆盖 HandleUnknownAction。默认实现确实会引发 404 错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-05-10T14:33:01.920

throw new HttpException(404, "Resource Not Found");

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-15T19:42:00.903

使用 MVC 3，您可以返回 HttpNotFound() 以正确返回 404。

像这样：

```
public ActionResult Download(string fontName)
{
    FontCache.InitalizeFonts();

    fontName = HttpUtility.UrlDecode(fontName);

    var font = FontCache.GetFontByName(fontName);
    if (font == null)
        return HttpNotFound();

    return View(font);
} 
```

# c# - 使用 .NET 随机化数组的最佳方法

> ID：108819
> 
> 赞同：166
> 
> 时间：2008-09-20T17:33:26.157
> 
> 标签：c#, .net, algorithm, sorting, random

使用 .NET 随机化字符串数组的最佳方法是什么？我的数组包含大约 500 个字符串，我想创建一个`Array`具有相同字符串但顺序随机的新数组。

请在您的答案中包含一个 C# 示例。

* * *

## 回答 #1

> 赞同：242
> 
> 时间：2008-09-21T08:51:46.963

下面的实现使用[Fisher-Yates 算法](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle)AKA Knuth Shuffle。它在 O(n) 时间内运行并在适当的位置随机播放，因此比“随机排序”技术性能更好，尽管它的代码行数更多。有关一些比较性能测量，请参见[此处](http://aspnet.4guysfromrolla.com/articles/070208-1.aspx)。我使用了 System.Random，它适用于非加密目的。*

```
static class RandomExtensions
{
    public static void Shuffle<T> (this Random rng, T[] array)
    {
        int n = array.Length;
        while (n > 1) 
        {
            int k = rng.Next(n--);
            T temp = array[n];
            array[n] = array[k];
            array[k] = temp;
        }
    }
} 
```

用法：

```
var array = new int[] {1, 2, 3, 4};
var rng = new Random();
rng.Shuffle(array);
rng.Shuffle(array); // different order from first call to Shuffle 
```

* 对于更长的数组，为了使（极大）数量的排列具有同样的可能性，有必要通过多次迭代运行伪随机数生成器 (PRNG) 以产生足够的熵。对于一个 500 个元素的数组，只有可能的 500 个元素的一小部分！使用 PRNG 可以获得排列。尽管如此，Fisher-Yates 算法是公正的，因此随机播放将与您使用的 RNG 一样好。

* * *

## 回答 #2

> 赞同：208
> 
> 时间：2008-09-20T17:40:06.357

如果您使用的是 .NET 3.5，则可以使用以下 IEnumerable 酷炫：

```
Random rnd=new Random();
string[] MyRandomArray = MyArray.OrderBy(x => rnd.Next()).ToArray(); 
```

编辑：这是相应的 VB.NET 代码：

```
Dim rnd As New System.Random
Dim MyRandomArray = MyArray.OrderBy(Function() rnd.Next()).ToArray() 
```

第二次编辑，回应 System.Random “不是线程安全的”和“仅适用于玩具应用程序”由于返回基于时间的序列的评论：正如我的示例中使用的那样，Random() 是完全线程安全的，除非您允许重新输入随机化数组的例程，在这种情况下，您将需要类似的东西`lock (MyRandomArray)`，以免损坏您的数据，这也将保护您的数据`rnd`。

此外，应该很好理解 System.Random 作为熵的来源不是很强。如[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.random.aspx)`System.Security.Cryptography.RandomNumberGenerator`中所述，如果您正在做任何与安​​全相关的事情，您应该使用派生的东西。例如：

```
using System.Security.Cryptography; 
```

...

```
RNGCryptoServiceProvider rnd = new RNGCryptoServiceProvider();
string[] MyRandomArray = MyArray.OrderBy(x => GetNextInt32(rnd)).ToArray(); 
```

...

```
static int GetNextInt32(RNGCryptoServiceProvider rnd)
    {
        byte[] randomInt = new byte[4];
        rnd.GetBytes(randomInt);
        return Convert.ToInt32(randomInt[0]);
    } 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-20T17:54:15.263

你正在寻找一个洗牌算法，对吧？

好的，有两种方法可以做到这一点：聪明但人们总是似乎误解了它并且得到了它错了所以也许它不是那么聪明毕竟方式，以及像石头一样愚蠢但谁在乎，因为它有效的方式。

### 笨方法

> *   创建第一个数组的副本，但每个字符串都应使用随机数标记。
> *   根据随机数对重复数组进行排序。

此算法运行良好，但请确保您的随机数生成器不太可能用相同的数字标记两个字符串。由于所谓的[生日悖论](http://en.wikipedia.org/wiki/Birthday_paradox)，这种情况发生的频率比您预期的要多。它的时间复杂度是 O( *n* log *n* )。

### 聪明的方式

我将其描述为递归算法：

> *洗牌一个大小为n*的数组（索引在 [0.. *n* -1] 范围内）：
> 
> 如果*n* = 0
> 
> *   没做什么
> 
> 如果*n* > 0
> 
> *   *（递归步骤）*打乱数组的前*n* -1 个元素
> *   在 [0.. *n* -1]范围内选择一个随机索引*x*
> **   *将索引n* -1 处的元素与索引*x*处的元素交换*

 **等效的迭代是遍历数组，在进行过程中与随机元素交换，但请注意，不能与迭代器指向的元素**之后的元素交换。**这是一个非常常见的错误，并导致有偏见的洗牌。

时间复杂度为 O( *n* )。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-20T17:39:27.467

该算法简单但效率不高，O(N ² )。所有“order by”算法通常都是 O(N log N)。它可能在数十万个元素以下没有什么区别，但对于大型列表来说会。

```
var stringlist = ... // add your values to stringlist

var r = new Random();

var res = new List<string>(stringlist.Count);

while (stringlist.Count >0)
{
   var i = r.Next(stringlist.Count);
   res.Add(stringlist[i]);
   stringlist.RemoveAt(i);
} 
```

它是 O(N ² ) 的原因很微妙：[List.RemoveAt()](https://msdn.microsoft.com/en-us/library/5cw9x18z(v=vs.110).aspx)是一个 O(N) 操作，除非您从最后按顺序删除。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-08-18T15:45:00.240

您还可以使用 Matt Howells 制作扩展方法。例子。

```
 namespace System
    {
        public static class MSSystemExtenstions
        {
            private static Random rng = new Random();
            public static void Shuffle<T>(this T[] array)
            {
                rng = new Random();
                int n = array.Length;
                while (n > 1)
                {
                    int k = rng.Next(n);
                    n--;
                    T temp = array[n];
                    array[n] = array[k];
                    array[k] = temp;
                }
            }
        }
    } 
```

然后你可以像这样使用它：

```
 string[] names = new string[] {
                "Aaron Moline1", 
                "Aaron Moline2", 
                "Aaron Moline3", 
                "Aaron Moline4", 
                "Aaron Moline5", 
                "Aaron Moline6", 
                "Aaron Moline7", 
                "Aaron Moline8", 
                "Aaron Moline9", 
            };
        names.Shuffle<string>(); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-20T17:42:21.390

只是想到我的头顶，你可以这样做：

```
public string[] Randomize(string[] input)
{
  List<string> inputList = input.ToList();
  string[] output = new string[input.Length];
  Random randomizer = new Random();
  int i = 0;

  while (inputList.Count > 0)
  {
    int index = r.Next(inputList.Count);
    output[i++] = inputList[index];
    inputList.RemoveAt(index);
  }

  return (output);
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T17:38:46.610

随机化数组是密集的，因为您必须在一堆字符串周围移动。为什么不从数组中随机读取？在最坏的情况下，您甚至可以使用 getNextString() 创建一个包装类。如果您确实需要创建一个随机数组，那么您可以执行类似的操作

```
for i = 0 -> i= array.length * 5
   swap two strings in random places 
```

*5 是任意的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-10-24T15:37:06.313

好的，这显然是我的一个问题（道歉......），但我经常使用一种非常通用且密码学强大的方法。

```
public static class EnumerableExtensions
{
    static readonly RNGCryptoServiceProvider RngCryptoServiceProvider = new RNGCryptoServiceProvider();
    public static IEnumerable<T> Shuffle<T>(this IEnumerable<T> enumerable)
    {
        var randomIntegerBuffer = new byte[4];
        Func<int> rand = () =>
                             {
                                 RngCryptoServiceProvider.GetBytes(randomIntegerBuffer);
                                 return BitConverter.ToInt32(randomIntegerBuffer, 0);
                             };
        return from item in enumerable
               let rec = new {item, rnd = rand()}
               orderby rec.rnd
               select rec.item;
    }
} 
```

Shuffle() 是任何 IEnumerable 的扩展，因此可以通过以下方式在列表中以随机顺序获取从 0 到 1000 的数字

```
Enumerable.Range(0,1000).Shuffle().ToList() 
```

这种方法在排序时也不会产生任何意外，因为排序值是在序列中的每个元素生成和记忆一次。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T17:37:36.583

生成相同长度的随机浮点数或整数数组。对该数组进行排序，并对目标数组进行相应的交换。

这产生了一个真正独立的排序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T17:43:31.810

```
Random r = new Random();
List<string> list = new List(originalArray);
List<string> randomStrings = new List();

while(list.Count > 0)
{
int i = r.Random(list.Count);
randomStrings.Add(list[i]);
list.RemoveAt(i);
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-21T13:36:08.777

Jacco，您使用自定义 IComparer 的解决方案并不安全。排序例程要求比较器符合几个要求才能正常运行。其中首先是一致性。如果在同一对对象上调用比较器，则它必须始终返回相同的结果。（比较也必须是传递的）。

未能满足这些要求可能会导致排序例程中出现许多问题，包括可能出现无限循环。

关于将随机数值与每个条目相关联然后按该值排序的解决方案，这些会导致输出中存在固有偏差，因为任何时候为两个条目分配相同的数值，输出的随机性都会受到影响。（在“稳定”排序例程中，输入中的第一个将是输出中的第一个。Array.Sort 碰巧不是稳定的，但仍然存在基于 Quicksort 算法完成的分区的偏差）。

您需要考虑一下您需要什么级别的随机性。如果您正在运行一个扑克网站，您需要加密级别的随机性来防止一个坚定的攻击者，您与只想随机化歌曲播放列表的人有非常不同的要求。

对于歌曲列表改组，使用种子 PRNG（如 System.Random）没有问题。对于扑克网站，它甚至不是一个选项，你需要比任何人在 stackoverflow 上为你做的更难思考这个问题。（使用加密 RNG 只是开始，您需要确保您的算法不会引入偏差，您有足够的熵源，并且您不会暴露任何会损害后续随机性的内部状态）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-21T17:37:30.177

这篇文章已经得到了很好的回答 - 使用 Fisher-Yates shuffle 的 Durstenfeld 实现来获得快速且公正的结果。甚至已经发布了一些实现，尽管我注意到有些实际上是不正确的。

不久前我写了几篇关于[使用这种技术实现完全和部分洗牌](http://gregbeech.com/blogs/tech/archive/2008/09/03/shuffle-and-takerandom-extension-methods-for-ienumerable-lt-t-gt.aspx)的帖子，并且（这第二个链接是我希望增加价值的地方）还有[一篇关于如何检查你的实现是否公正的后续帖子](http://gregbeech.com/blogs/tech/archive/2008/09/09/determining-the-bias-of-a-shuffle-algorithm.aspx)，可用于检查任何洗牌算法。您可以在第二篇文章的末尾看到随机数选择中的一个简单错误可能产生的影响。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-04-13T20:43:05.287

你不需要复杂的算法。

**就这么简单的一行：**

```
Random random = new Random();
array.ToList().Sort((x, y) => random.Next(-1, 1)).ToArray(); 
```

请注意，如果您一开始不使用，我们需要将其转换`Array`为第一个。`List``List`

另外，请注意，这对于非常大的阵列效率不高！否则它很干净和简单。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-04-13T16:45:33.717

这是一个完整的工作控制台解决方案，基于[此处提供的示例](https://msdn.microsoft.com/en-us/library/dd537615%28v=vs.110%29.aspx)：

```
class Program
{
    static string[] words1 = new string[] { "brown", "jumped", "the", "fox", "quick" };

    static void Main()
    {
        var result = Shuffle(words1);
        foreach (var i in result)
        {
            Console.Write(i + " ");
        }
        Console.ReadKey();
    }

   static string[] Shuffle(string[] wordArray) {
        Random random = new Random();
        for (int i = wordArray.Length - 1; i > 0; i--)
        {
            int swapIndex = random.Next(i + 1);
            string temp = wordArray[i];
            wordArray[i] = wordArray[swapIndex];
            wordArray[swapIndex] = temp;
        }
        return wordArray;
    }         
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-02-06T18:01:22.503

```
 int[] numbers = {0,1,2,3,4,5,6,7,8,9};
        List<int> numList = new List<int>();
        numList.AddRange(numbers);

        Console.WriteLine("Original Order");
        for (int i = 0; i < numList.Count; i++)
        {
            Console.Write(String.Format("{0} ",numList[i]));
        }

        Random random = new Random();
        Console.WriteLine("\n\nRandom Order");
        for (int i = 0; i < numList.Capacity; i++)
        {
            int randomIndex = random.Next(numList.Count);
            Console.Write(String.Format("{0} ", numList[randomIndex]));
            numList.RemoveAt(randomIndex);
        }
        Console.ReadLine(); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-12-02T16:43:49.893

可能：

```
Random random = new();

string RandomWord()
{
    const string CHARS = "abcdefghijklmnoprstuvwxyz";
    int n = random.Next(CHARS.Length);
    return string.Join("", CHARS.OrderBy(x => random.Next()).ToArray())[0..n];
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-02-03T15:27:32.137

```
 public static void Shuffle(object[] arr)
    {
        Random rand = new Random();
        for (int i = arr.Length - 1; i >= 1; i--)
        {
            int j = rand.Next(i + 1);
            object tmp = arr[j];
            arr[j] = arr[i];
            arr[i] = tmp;
        }
    } 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2008-09-20T19:03:07.517

这是使用 OLINQ 的一种简单方法：

```
// Input array
List<String> lst = new List<string>();
for (int i = 0; i < 500; i += 1) lst.Add(i.ToString());

// Output array
List<String> lstRandom = new List<string>();

// Randomize
Random rnd = new Random();
lstRandom.AddRange(from s in lst orderby rnd.Next(100) select s); 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2012-05-01T12:00:09.090

```
private ArrayList ShuffleArrayList(ArrayList source)
{
    ArrayList sortedList = new ArrayList();
    Random generator = new Random();

    while (source.Count > 0)
    {
        int position = generator.Next(source.Count);
        sortedList.Add(source[position]);
        source.RemoveAt(position);
    }  
    return sortedList;
} 
```

# python - 删除 Google App Engine 中某个种类的所有数据

> ID：108822
> 
> 赞同：45
> 
> 时间：2008-09-20T17:34:24.203
> 
> 标签：python, google-app-engine

我想清除 Google App Engine 中特定类型的所有数据。做这个的最好方式是什么？我写了一个删除脚本（hack），但是由于有这么多数据，几百条记录后超时。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-06-21T11:41:24.207

我目前正在通过它们的键删除实体，它似乎更快。

```
from google.appengine.ext import db

class bulkdelete(webapp.RequestHandler):
    def get(self):
        self.response.headers['Content-Type'] = 'text/plain'
        try:
            while True:
                q = db.GqlQuery("SELECT __key__ FROM MyModel")
                assert q.count()
                db.delete(q.fetch(200))
                time.sleep(0.5)
        except Exception, e:
            self.response.out.write(repr(e)+'\n')
            pass 
```

从终端，我运行 curl -N http://...

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-09-18T21:17:52.863

您现在可以为此使用数据存储区管理员：[https ://developers.google.com/appengine/docs/adminconsole/datastoreadmin#Deleting_Entities_in_Bulk](https://developers.google.com/appengine/docs/adminconsole/datastoreadmin#Deleting_Entities_in_Bulk)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-12-10T17:41:07.043

如果我是一个偏执的人，我会说 Google App Engine (GAE) 并没有让我们轻松地删除数据，如果我们愿意的话。我将跳过关于索引大小以及它们如何将 6 GB 数据转换为 35 GB 存储（收费）的讨论。那是另一个故事，但他们确实有办法解决这个问题 - 限制属性数量以在（自动生成的索引）等上创建索引。

我决定写这篇文章的原因是我需要在沙箱中“核对”我所有的种类。我读了它，最后想出了这个代码：

```
package com.intillium.formshnuker;

import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.google.appengine.api.datastore.Key;
import com.google.appengine.api.datastore.Query;
import com.google.appengine.api.datastore.Entity;
import com.google.appengine.api.datastore.FetchOptions;
import com.google.appengine.api.datastore.DatastoreService;
import com.google.appengine.api.datastore.DatastoreServiceFactory;

import com.google.appengine.api.labs.taskqueue.QueueFactory;
import com.google.appengine.api.labs.taskqueue.TaskOptions.Method;

import static com.google.appengine.api.labs.taskqueue.TaskOptions.Builder.url;

@SuppressWarnings("serial")
public class FormsnukerServlet extends HttpServlet {

 public void doGet(final HttpServletRequest request, final HttpServletResponse response) throws IOException {

  response.setContentType("text/plain");

  final String kind = request.getParameter("kind");
  final String passcode = request.getParameter("passcode");

  if (kind == null) {
   throw new NullPointerException();
  }

  if (passcode == null) {
   throw new NullPointerException();
  }

  if (!passcode.equals("LONGSECRETCODE")) {
   response.getWriter().println("BAD PASSCODE!");
   return;
  }

  System.err.println("*** deleting entities form " + kind);

  final long start = System.currentTimeMillis();

  int deleted_count = 0;
  boolean is_finished = false;

  final DatastoreService dss = DatastoreServiceFactory.getDatastoreService();

  while (System.currentTimeMillis() - start < 16384) {

   final Query query = new Query(kind);

   query.setKeysOnly();

   final ArrayList<Key> keys = new ArrayList<Key>();

   for (final Entity entity: dss.prepare(query).asIterable(FetchOptions.Builder.withLimit(128))) {
    keys.add(entity.getKey());
   }

   keys.trimToSize();

   if (keys.size() == 0) {
    is_finished = true;
    break;
   }

   while (System.currentTimeMillis() - start < 16384) {

    try {

     dss.delete(keys);

     deleted_count += keys.size();

     break;

    } catch (Throwable ignore) {

     continue;

    }

   }

  }

  System.err.println("*** deleted " + deleted_count + " entities form " + kind);

  if (is_finished) {

   System.err.println("*** deletion job for " + kind + " is completed.");

  } else {

   final int taskcount;

   final String tcs = request.getParameter("taskcount");

   if (tcs == null) {
    taskcount = 0;
   } else {
    taskcount = Integer.parseInt(tcs) + 1;
   }

   QueueFactory.getDefaultQueue().add(
    url("/formsnuker?kind=" + kind + "&passcode=LONGSECRETCODE&taskcount=" + taskcount).method(Method.GET));

   System.err.println("*** deletion task # " + taskcount + " for " + kind + " is queued.");

  }

  response.getWriter().println("OK");

 }

} 
```

我有超过 600 万条记录。好多啊。我不知道删除记录的成本是多少（不删除它们可能更经济）。另一种选择是请求删除整个应用程序（沙盒）。但这在大多数情况下是不现实的。

我决定使用较小的记录组（便于查询）。我知道我可以选择 500 个实体，但后来我开始收到非常高的失败率（重新删除功能）。

***我对 GAE 团队的要求：请添加一个功能以在单个事务中删除一种类型的所有实体。***

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-20T18:34:42.200

大概你的黑客是这样的：

```
# Deleting all messages older than "earliest_date"
q = db.GqlQuery("SELECT * FROM Message WHERE create_date < :1", earliest_date)
results = q.fetch(1000)

while results:
    db.delete(results)
    results = q.fetch(1000, len(results)) 
```

正如您所说，如果有足够的数据，您将在它通过所有记录之前达到请求超时。您必须从外部多次重新调用此请求，以确保删除所有数据；很容易做到，但并不理想。

管理控制台似乎没有提供任何帮助，因为（根据我自己的经验），它似乎只允许列出给定类型的实体，然后逐页删除。

在测试时，我不得不在启动时清除我的数据库以摆脱现有数据。

我会由此推断，谷歌的运作原则是磁盘便宜，因此数据通常是孤立的（冗余数据的索引被替换），而不是被删除。鉴于目前每个应用程序可用的数据量是固定的（0.5 GB），这对非 Google App Engine 用户没有多大帮助。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-14T23:58:35.940

尝试使用[App Engine 控制台](http://con.appspot.com/console/help/integration)，然后您甚至不必部署任何特殊代码

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-27T06:00:44.893

我已经尝试过 db.delete(results) 和 App Engine Console，但它们似乎都不适合我。从数据查看器中手动删除条目（将限制增加到 200 个）也不起作用，因为我已经上传了超过 10000 个条目。我写完了这个脚本

```
from google.appengine.ext import db
from google.appengine.ext import webapp
from google.appengine.ext.webapp.util import run_wsgi_app
import wsgiref.handlers
from mainPage import YourData #replace this with your data
class CleanTable(webapp.RequestHandler):
    def get(self, param):
        txt = self.request.get('table')
        q = db.GqlQuery("SELECT * FROM "+txt)
        results = q.fetch(10)
        self.response.headers['Content-Type'] = 'text/plain'
        #replace yourapp and YouData your app info below.
        self.response.out.write("""
          <html>
          <meta HTTP-EQUIV="REFRESH" content="5; url=http://yourapp.appspot.com/cleanTable?table=YourData">
            <body>""")

        try:
            for i in range(10):
                db.delete(results)
                results = q.fetch(10, len(results))
                self.response.out.write("<p>10 removed</p>")
                self.response.out.write("""
                </body>
              </html>""")

        except Exception, ints:
            self.response.out.write(str(inst))

def main():
  application = webapp.WSGIApplication([
    ('/cleanTable(.*)', CleanTable),
  ])

  wsgiref.handlers.CGIHandler().run(application) 
```

诀窍是在 html 中包含重定向，而不是使用 self.redirect。我已经准备好等待一夜以摆脱我表中的所有数据。希望 GAE 团队将来可以更轻松地删除表格。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-23T02:44:10.277

谷歌的[官方回答](http://groups.google.com/group/google-appengine/browse_thread/thread/ec0800a3ca92fe69#)是你必须在多个请求中分块删除。您可以使用 AJAX、[meta refresh](http://en.wikipedia.org/wiki/Meta_refresh)或从脚本请求您的 URL，直到没有实体为止。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-09-08T20:49:35.323

在 Datastore 上处理批量删除的最快、最有效的方法是使用在最新的[Google I/O](http://code.google.com/events/io/2010/)上宣布的新[映射器 API](http://code.google.com/p/appengine-mapreduce/)。

如果您选择的语言是[Python](http://code.google.com/p/appengine-mapreduce/wiki/GettingStartedInPython)，您只需在*mapreduce.yaml*文件中注册您的映射器并定义如下函数：

```
from mapreduce import operation as op
def process(entity):
 yield op.db.Delete(entity) 
```

在[Java](http://code.google.com/p/appengine-mapreduce/wiki/GettingStartedInJava)上，你应该看看[这篇文章](http://ikaisays.com/2010/07/09/using-the-java-mapper-framework-for-app-engine/)，它建议了一个这样的函数：

```
@Override
public void map(Key key, Entity value, Context context) {
    log.info("Adding key to deletion pool: " + key);
    DatastoreMutationPool mutationPool = this.getAppEngineContext(context)
            .getMutationPool();
    mutationPool.delete(value.getKey());
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-09-09T15:47:34.510

一个提示。我建议您了解这些类型的使用（批量删除，修改等）的[remote_api 。](http://code.google.com/appengine/articles/remote_api.html)但是，即使使用远程 API，批量大小也可以限制为一次几百个。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-20T19:03:04.800

不幸的是，没有办法轻松地进行批量删除。最好的办法是编写一个脚本，在每次调用时删除合理数量的条目，然后重复调用它——例如，只要有更多数据要删除，让你的删除脚本返回 302 重定向，然后使用“wget - -max-redirect=10000"（或其他一些较大的数字）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-03-24T21:12:14.317

使用 django，设置网址：

```
url(r'^Model/bdelete/$', v.bulk_delete_models, {'model':'ModelKind'}), 
```

设置视图

```
def bulk_delete_models(request, model):
    import time
    limit = request.GET['limit'] or 200
    start = time.clock()
    set = db.GqlQuery("SELECT __key__ FROM %s" % model).fetch(int(limit))
    count = len(set)
    db.delete(set)
    return HttpResponse("Deleted %s %s in %s" % (count,model,(time.clock() - start))) 
```

然后在powershell中运行：

```
$client = new-object System.Net.WebClient
$client.DownloadString("http://your-app.com/Model/bdelete/?limit=400") 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-01-05T03:12:37.013

如果您使用的是 Java/JPA，则可以执行以下操作：

```
 em = EntityManagerFactoryUtils.getTransactionalEntityManager(entityManagerFactory)
    Query q = em.createQuery("delete from Table t");
    int number = q.executeUpdate(); 
```

Java/JDO 信息可以在这里找到：[http ://code.google.com/appengine/docs/java/datastore/queriesandindexes.html#Delete_By_Query](http://code.google.com/appengine/docs/java/datastore/queriesandindexes.html#Delete_By_Query)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-12-09T11:42:36.640

是的，您可以：转到 Datastore Admin，然后选择要删除的实体类型，然后单击删除。Mapreduce 将负责删除！

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-11-27T20:11:34.680

在[开发服务器上](https://cloud.google.com/appengine/docs/python/tools/devserver?hl=en)，可以 cd 到他的应用程序目录，然后像这样运行它：

```
dev_appserver.py --clear_datastore=yes . 
```

这样做将启动应用程序并清除数据存储区。如果您已经有另一个实例正在运行，则该应用程序将无法绑定到所需的 IP，因此无法启动......并清除您的数据存储。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-02-11T14:48:22.167

您可以使用任务队列来删除 100 个对象的块。在 GAE 中删除对象显示了 GAE 中管理功能的局限性。您必须处理 1000 个或更少实体的批次。您可以使用适用于 csv 的 bulkloader 工具，但文档不包括 java。我正在使用 GAE Java，我的删除策略包括 2 个 servlet，一个用于实际删除，另一个用于加载任务队列。当我想删除时，我运行队列加载 servlet，它加载队列，然后 GAE 开始执行队列中的所有任务。

怎么做：创建一个删除少量对象的servlet。将 servlet 添加到您的任务队列中。回家或从事其他工作；）每隔一段时间检查一次数据存储...

我有一个包含大约 5000 个对象的数据存储，我每周都会清除这些对象，清理大约需要 6 个小时，所以我在星期五晚上运行该任务。我使用相同的技术批量加载我的数据，这些数据恰好是大约 5000 个对象，大约有十几个属性。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-07-31T01:41:22.473

这对我有用：

```
class ClearHandler(webapp.RequestHandler):  
    def get(self):  
        self.response.headers['Content-Type'] = 'text/plain'  
        q = db.GqlQuery("SELECT * FROM SomeModel")  
        self.response.out.write("deleting...")  
        db.delete(q) 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-09-03T07:27:45.373

谢谢大家，我得到了我需要的东西。:D
如果您有很多数据库模型要删除，这可能很有用，您可以在终端中发送它。此外，您可以自己管理 DB_MODEL_LIST 中的删除列表。
删除 DB_1：

```
python bulkdel.py 10 DB_1 
```

删除所有数据库：

```
python bulkdel.py 11 
```

这是 bulkdel.py 文件：

```
import sys, os

URL = 'http://localhost:8080'
DB_MODEL_LIST = ['DB_1', 'DB_2', 'DB_3']

# Delete Model
if sys.argv[1] == '10' :
    command = 'curl %s/clear_db?model=%s' % ( URL, sys.argv[2] )
    os.system( command )

# Delete All DB Models
if sys.argv[1] == '11' :
    for model in DB_MODEL_LIST :
        command = 'curl %s/clear_db?model=%s' % ( URL, model )
        os.system( command ) 
```

这是 alexandre fiori 代码的修改版本。

```
from google.appengine.ext import db
class DBDelete( webapp.RequestHandler ):
    def get( self ):
        self.response.headers['Content-Type'] = 'text/plain'
        db_model = self.request.get('model')
        sql = 'SELECT __key__ FROM %s' % db_model

        try:
            while True:
                q = db.GqlQuery( sql )
                assert q.count()
                db.delete( q.fetch(200) )
                time.sleep(0.5)
        except Exception, e:
            self.response.out.write( repr(e)+'\n' )
            pass 
```

当然，您应该将链接映射到文件中的模型（如 GAE 中的 main.py），;)
如果像我这样的人需要它的详细信息，这里是 main.py 的一部分：

```
from google.appengine.ext import webapp
import utility # DBDelete was defined in utility.py
application = webapp.WSGIApplication([('/clear_db',utility.DBDelete ),('/',views.MainPage )],debug = True) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-02-06T12:15:29.463

要在 Google App Engine 中删除给定种类中的所有实体，您只需执行以下操作：

```
from google.cloud import datastore

query = datastore.Client().query(kind = <KIND>)
results = query.fetch()
for result in results:
    datastore.Client().delete(result.key) 
```

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2012-11-29T13:06:19.137

在 javascript 中，以下内容将删除页面上的所有条目：

```
document.getElementById("allkeys").checked=true;
checkAllEntities();
document.getElementById("delete_button").setAttribute("onclick","");
document.getElementById("delete_button").click(); 
```

假设您在要删除的实体的管理页面 (.../_ah/admin) 上。

# macos - 如何使用 VMware Fusion 克隆 VM？

> ID：108832
> 
> 赞同：21
> 
> 时间：2008-09-20T17:38:49.480
> 
> 标签：macos, vmware

是否可以在 Mac OS X 上使用 VMware Fusion 克隆虚拟机？我正在尝试 30 天评估版，但似乎没有克隆功能。我尝试使用 Finder 复制 VM 的包结构，但副本没有出现在虚拟机库中。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-20T17:45:33.053

只需使用 File->open 打开 VM 的副本。它可能会询问您是否要更改 VM 的唯一 ID。如果您打算同时运行原始版本和克隆版本，并且它不是需要激活的 Windows 操作系统，您应该说是。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-01-02T19:28:04.380

1.  在虚拟机库窗口中选择添加按钮（左上角）
2.  选择“新建”
3.  选择“不使用光盘继续”按钮
4.  选择“使用现有的虚拟磁盘：”
5.  浏览到要克隆的虚拟机所在的位置。在屏幕的下半部分，您有 3 个选项。要创建一个完全独立的 VM，请选择第一个“制作病毒磁盘的单独副本”，然后按照说明进行操作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-20T17:46:06.030

只需复制文件夹 cp -R 文件夹 newfolder （在您的 docs 文件夹中） 在 Vmware 中打开该文件夹并说您已复制它 8 月 15 日在 weblog.jamisburk.org 上查看

因为网络可能存在问题

贾斯汀

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T17:42:43.653

我不详细了解融合，但在 VMWare Server 中，您可以将文件复制到其他地方。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-05T14:01:31.030

以下是 VMware 网站上的说明：

[http://kb.vmware.com/kb/1001524](http://kb.vmware.com/kb/1001524)

> 要复制虚拟机：
> 
> 1.  关闭虚拟机。
>     **注意**：在虚拟机运行或挂起时对其进行复制可能会创建可能无法启动的副本。
>     
>     
> 2.  找到虚拟机捆绑包。有关详细信息，请参见[Locating the virtual machine bundle in VMware Fusion (1007599)](http://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&docType=kc&docTypeID=DT_KB_1_1&externalId=1007599)。
>     
>     
> 3.  将虚拟机捆绑包拖到您希望复制捆绑包所在的位置。如果您将它复制到同一文件夹或硬盘驱动器上的其他位置，请按住**选项**键 - 这会告诉 Mac OS 复制文件而不是移动它。如果您将捆绑包移动到另一个驱动器或网络共享，Mac OS 会自动复制该文件。光标上叠加了一个绿色圆圈和一个加号，表示将进行复制。
>     **注意**：这不会影响您当前的虚拟机。
>     
>     
> 
> If you power on the copied virtual machine, Fusion asks if you have moved the virtual machine or copied it. Select that you **Moved It** (unless you need to run the copied virtual machine at the same time as the original). This indicates that it is the same virtual machine, just starting from a new location, and keeps all of the settings the same.
> 
> **Note**: When you select the **Copied It** option, a new UUID and MAC address are generated, which can cause Windows to require re-activation and may cause network issues.

# java - 从命令行在 java WAR 的上下文中运行代码

> ID：108838
> 
> 赞同：1
> 
> 时间：2008-09-20T17:40:47.963
> 
> 标签：java, security, tomcat, war, servlets

我将如何编写一些代码以允许从命令行访问我的 web 应用程序中的 Java 类。

例如，我有一个带有命令行界面的 java 类，它可以在 webapp 的上下文中运行代码，可以访问数据库等。我想登录在 tomcat 中托管我的 WARred 应用程序的机器并能够与之交互

我应该从哪里开始寻找？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-20T18:25:43.860

您只是想运行恰好捆绑在 WAR 中的类文件，还是不想与实际运行的 WAR 实例交互？如果是前者，那么 WAR 只是一个普通的 Jar 文件，您可以像执行任何其他 Jar 文件一样在其中执行类。

如果您想与正在运行的 WAR 进行交互，那么您可能需要查看 JMX。

所有当前的 JDK（至少 1.5+）都“免费”提供了 JMX。很容易创建小的接口类用作与您的 WAR 交互的命令。

那么您需要创建一个通过 JMX 连接到 WAR 的命令行程序，或者您可以使用 JConsole（JDK 附带，但它是一个 GUI）之类的工具与您的实例进行交互。还有其他 JMX 客户端。

如果这些都不吸引人，那么总会有 Web 服务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T18:17:24.707

一个建议：你的命令行接口类应该接受一个 InputStream 作为它的输入，并提供一个 OutputStream（它不能硬编码输出到 System.out 和输入到 System.in），它的输出将被写入。然后，您必须编写一个服务器类来侦听某个端口上的连接。当建立连接时，服务器将从连接中获取 InputStream 并将其提供给命令行类，该类将提供 OutputStream，写入的数据将传递给建立连接的客户端。

# python - Python音乐库？

> ID：108848
> 
> 赞同：40
> 
> 时间：2008-09-20T17:42:53.870
> 
> 标签：python, audio

我正在寻找用 Python 编写一个小鼓机来获得乐趣。我用谷歌搜索了一些，找到了关于[音乐](http://wiki.python.org/moin/PythonInMusic)和[基本音频](http://wiki.python.org/moin/Audio/)的 python 页面以及关于[生成音频文件](https://stackoverflow.com/questions/45385/good-python-library-for-generating-audio-files)的 StackOverflow 问题，但***我正在寻找的是一个体面的音乐创作库***。有没有人在这里尝试过做这样的事情？如果是这样，您的解决方案是什么？什么，无论是我找到的，还是我没有找到的，将是一个体面的音频处理库？

至少，我希望能够在 python 中做类似于[Audacity](http://audacity.sourceforge.net/)范围的事情，但如果有人知道可以做更多的库......我全都听好了。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-20T19:51:39.457

仔细看看[cSounds](http://www.csounds.com/)。有 Python 绑定允许您进行非常灵活的数字合成。也有一些非常完整的软件包可用。

有关软件包，请参见[http://www.csounds.com/node/188](http://www.csounds.com/node/188)。

有关cSounds 中 Python 脚本的信息，请参阅[http://www.csounds.com/journal/issue6/pythonOpcodes.html 。](http://www.csounds.com/journal/issue6/pythonOpcodes.html)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-20T18:33:16.010

几年前我不得不这样做。我使用了pymedia。我不确定它是否仍然存在，这是我在玩它时编写的一些测试代码。虽然它大约3岁。

**编辑：**示例代码播放 MP3 文件

```
import pymedia
import time

demuxer = pymedia.muxer.Demuxer('mp3') #this thing decodes the multipart file i call it a demucker

f = open(r"path to \song.mp3", 'rb')

spot = f.read()
frames = demuxer.parse(spot)
print 'read it has %i frames' % len(frames)
decoder = pymedia.audio.acodec.Decoder(demuxer.streams[0]) #this thing does the actual decoding
frame = decoder.decode(spot)
print dir(frame)
#sys.exit(1)
sound = pymedia.audio.sound
print frame.bitrate, frame.sample_rate
song = sound.Output( frame.sample_rate, frame.channels, 16 ) #this thing handles playing the song

while len(spot) > 0:
    try:
        if frame: song.play(frame.data)
        spot = f.read(512)
        frame = decoder.decode(spot)
    except:
        pass

while song.isPlaying(): time.sleep(.05)
print 'well done' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-20T18:01:39.707

有多种 Python 音乐软件，你可以在[这里](http://wiki.python.org/moin/PythonInMusic)找到目录。

如果您向下滚动链接页面，您会发现有关**Python 音乐编程**的部分描述了几个音乐创作包，包括[MusicKit](http://musickit.sourceforge.net/)和[PySndObj](http://sndobj.sourceforge.net/#python)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-09-21T15:40:27.687

另请查看[http://code.google.com/p/pyo/](http://code.google.com/p/pyo/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T22:39:12.067

除了前面提到的，我还写了一个简单的 Python 音频编辑器。 [http://code.google.com/p/yaalp/source/browse/#svn/trunk](http://code.google.com/p/yaalp/source/browse/#svn/trunk) 见 main.py。

它还具有音频处理和一些效果。

Code 的 GPL，因此这可能是您的起点。

# javascript - Javascript 文件的相对 URL

> ID：108853
> 
> 赞同：18
> 
> 时间：2008-09-20T17:44:47.767
> 
> 标签：javascript, html, url

我在需要将查询发送回服务器的 javascript 文件中有一些代码。问题是，如何找到我所在脚本的 url，以便为 ajax 构建正确的请求 url。

即，相同的脚本包含在`/`, `/help`,`/whatever`等上，而它总是需要从`/data.json`. 此外，同一站点在不同的服务器上运行，其中`/`-folder 的放置方式可能不同。我有办法解析包含 Javascript（ez-publish 模板）的相对 url，但不在 javascript 文件本身中。

是否有适用于为此而设计的所有浏览器的小脚本？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-20T18:08:20.657

为此，我喜欢将`<link>`元素放在页面中`<head>`，其中包含用于请求的 URL。它们可以由您的服务器端语言生成，因此它们始终指向正确的视图：

```
<link id="link-action-1" href="${reverse_url ('action_1')}"/> 
```

变成

```
<link id="link-action-1" href="/my/web/root/action-1/"/> 
```

并且可以通过 Javascript 检索：

```
document.getElementById ('link-action-1').href; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T17:46:50.617

`document.location.href`将为您提供当前 URL，然后您可以使用 JavaScript 的字符串函数对其进行操作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T18:13:50.067

客户端无法在不被服务器告知的情况下确定 webapp 根目录，因为它不知道服务器的配置。您可以尝试的一种选择是在 head 元素中使用 base 元素，让服务器动态生成它而不是硬编码它（因此它显示每个服务器的相关 URL）：

```
<base href="http://path/to/webapp/root/" /> 
```

然后，所有 URL 都将被视为相对于此。因此，您只需向 /data.json 提出请求。但是，您确实需要确保应用程序中的所有其他链接都牢记这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-29T21:05:07.627

如果脚本知道自己的文件名，则可以使用 document. **getElementsByTagName** ()。遍历列表，直到找到与您匹配的脚本，然后以这种方式提取完整（或相对）url。

这是一个例子：

```
function getScriptUrl ( name ) {
    var scripts = document.getElementsByTagName('script');
    var re = RegExp("(\/|^)" + name + "$");
    var src;
    for( var i = 0; i < scripts.length; i++){
        src = scripts[i].getAttribute('src');
        if( src.match(re) )
            return src;
    }
    return null;
}

console.log( 'found ' + getScriptUrl('demo.js') ); 
```

考虑到这种方法会受到文件名冲突的影响。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T18:39:54.543

我在我的库主入口点 (main.php) 中包含以下代码：

```
/**
 * Build current url, depending on protocal (http/https),
 * port, server name and path suffix
 */
$site_root = 'http';
if (isset($_SERVER["HTTPS"]) && $_SERVER["HTTPS"] == "on") 
    $site_root .= "s";
$site_root .= "://" . $_SERVER["SERVER_NAME"];
if ($_SERVER["SERVER_PORT"] != "80")
    $site_root .= ":" . $_SERVER["SERVER_PORT"];
$site_root .= $g_config["paths"]["site_suffix"];

$g_config["paths"]["site_root"] = $site_root; 
```

$g_config 是一个包含配置选项的全局数组。所以 site_suffix 可能看起来像：“/sites_working/thesite/public_html”在您的开发框上，而“/”在具有虚拟主机（域名）的服务器上。

这种方法也很好，因为如果有人输入你的开发框的 IP 地址，它将使用相同的 IP 地址来构建 javascript 文件夹的路径，而不是像“localhost”这样的东西，如果你使用“localhost”它将使用“localhost”来构建 URL。

而且因为它还检测 SSL，所以如果您向服务器添加 SSL 支持，您将不必担心天气将通过 HTTP 或 HTTPS 发送您的资源。

然后，在您的模板中，使用

```
<link id="site_root" href="<?php echo $g_config["paths"]["site_root"] ?>"/> 
```

或者

```
<script type = "text/javascript">
var SiteRoot = "<?php echo $g_config["paths"]["site_root"]; ?>";
</script> 
```

我想后者会更快。

# c - 是否有接受大于 char 的整数的 memset()？

> ID：108866
> 
> 赞同：32
> 
> 时间：2008-09-20T17:50:20.780
> 
> 标签：c, optimization

是否有一个版本的 memset() 设置一个大于 1 字节 (char) 的值？例如，假设我们有一个 memset32() 函数，那么使用它我们可以执行以下操作：

```
int32_t array[10];
memset32(array, 0xDEADBEEF, sizeof(array)); 
```

这将在数​​组的所有元素中设置值 0xDEADBEEF。目前在我看来，这只能通过循环来完成。

具体来说，我对 memset() 的 64 位版本感兴趣。知道这样的事吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-20T18:00:58.257

```
void memset64( void * dest, uint64_t value, uintptr_t size )
{
  uintptr_t i;
  for( i = 0; i < (size & (~7)); i+=8 )
  {
    memcpy( ((char*)dest) + i, &value, 8 );
  }  
  for( ; i < size; i++ )
  {
    ((char*)dest)[i] = ((char*)&value)[i&7];
  }  
} 
```

（解释，如评论中所要求的：当您分配给指针时，编译器假定指针与类型的自然对齐方式对齐；对于 uint64_t，即 8 个字节。memcpy() 不做这样的假设。在某些硬件上未对齐访问是不可能的，因此分配不是一个合适的解决方案，除非您知道未对齐的访问在硬件上工作时很少或没有惩罚，或者知道它们永远不会发生，或两者兼而有之。编译器将替换小的 memcpy()s 和 memset() s 使用更合适的代码，因此它看起来并不那么可怕；但是如果您确实知道足够的知识以保证分配将始终有效并且您的分析器告诉您它更快，您可以用分配替换 memcpy。第二个 for()如果要填充的内存量不是 64 位的倍数，则存在循环。如果你知道它总是会这样，您可以简单地删除该循环。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-21T00:12:36.617

没有标准库函数 afaik。因此，如果您正在编写可移植代码，那么您正在查看一个循环。

如果您正在编写不可移植的代码，请检查您的编译器/平台文档，但不要屏住呼吸，因为在这里很少能得到太多帮助。也许其他人会提供确实提供某些东西的平台示例。

您自己编写的方式取决于您是否可以在 API 中定义调用者保证 dst 指针将充分对齐以在您的平台（或平台，如果可移植）上进行 64 位写入。在任何完全具有 64 位整数类型的平台上，malloc 至少会返回适当对齐的指针。

如果您必须应对不对齐，那么您需要类似月影的答案。编译器可能会内联/展开大小为 8 的 memcpy（如果存在，则使用 32 位或 64 位未对齐的写入操作），因此代码应该非常简洁，但我猜它可能不会是特殊情况目标的整个功能正在对齐。我很想得到纠正，但害怕我不会。

因此，如果您知道调用者将始终为您提供与您的体系结构充分对齐的 dst，并且长度是 8 字节的倍数，那么执行一个简单的循环，写入 uint64_t（或任何 64 位 int 在您的编译器），你可能会（没有承诺）最终得到更快的代码。你肯定会有更短的代码。

无论如何，如果您确实关心性能，请对其进行分析。如果速度不够快，请再次尝试进行更多优化。如果它仍然不够快，请询问有关其不够快的 CPU 的 asm 版本的问题。memcpy/memset 可以从每个平台的优化中获得巨大的性能提升。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-01-11T13:50:12.457

仅作记录，以下`memcpy(..)`在以下模式中使用。假设我们想用 20 个整数填充一个数组：

```
--------------------

First copy one:
N-------------------

Then copy it to the neighbour:
NN------------------

Then copy them to make four:
NNNN----------------

And so on:
NNNNNNNN------------

NNNNNNNNNNNNNNNN----

Then copy enough to fill the array:
NNNNNNNNNNNNNNNNNNNN 
```

这需要 O(lg(num)) 的应用程序`memcpy(..)`。

```
int *memset_int(int *ptr, int value, size_t num) {
    if (num < 1) return ptr;
    memcpy(ptr, &value, sizeof(int));
    size_t start = 1, step = 1;
    for ( ; start + step <= num; start += step, step *= 2)
        memcpy(ptr + start, ptr, sizeof(int) * step);

    if (start < num)
        memcpy(ptr + start, ptr, sizeof(int) * (num - start));
    return ptr;
} 
```

我认为如果使用一些硬件块内存复制功能进行优化，它可能比循环更快`memcpy(..)`，但事实证明，简单的循环比使用 -O2 和 -O3 的循环要快。（至少在 Windows 上使用 MinGW GCC 和我的特定硬件。）如果没有 -O 开关，在 400 MB 数组上，上面的代码大约是等效循环的两倍，在我的机器上需要 417 毫秒，而优化它们两者都达到约 300 毫秒。这意味着它花费的纳秒数与字节数大致相同，一个时钟周期约为一纳秒。所以要么我的机器上没有硬件块内存复制功能，要么`memcpy(..)`实现没有利用它。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-20T18:03:52.150

检查您的操作系统文档以获取本地版本，然后考虑仅使用循环。

编译器可能比你更了解优化任何特定架构上的内存访问，所以让它来完成这项工作。

将其包装为一个库，并使用编译器允许的所有速度改进优化对其进行编译。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-20T17:54:23.593

`wmemset(3)`是 memset 的宽（16 位）版本。我认为这是你在 C 中最接近的，没有循环。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-03-04T20:18:51.533

如果您只是针对 x86 编译器，您可以尝试类似（VC++ 示例）：

```
inline void memset32(void *buf, uint32_t n, int32_t c)
{
  __asm {
  mov ecx, n
  mov eax, c
  mov edi, buf
  rep stosd
  }
} 
```

否则只需做一个简单的循环并相信优化器知道它在做什么，就像：

```
for(uint32_t i = 0;i < n;i++)
{
  ((int_32 *)buf)[i] = c;
} 
```

如果你让它变得复杂，它最终会比优化代码更简单，更不用说更难维护了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T18:15:49.097

您真的应该让编译器按照其他人的建议为您优化它。在大多数情况下，该循环可以忽略不计。

但是，如果这是一些特殊情况，并且您不介意特定于平台，并且确实需要摆脱循环，则可以在组装块中执行此操作。

```
//pseudo code
asm
{
    rep stosq ...
} 
```

您可能可以通过 google stosq 汇编命令了解具体信息。它不应该超过几行代码。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-20T18:11:28.857

自己写；即使在 asm 中也是微不足道的。

# apache-flex - 客观地说，Cairngorm 相对于 PureMVC 的优缺点是什么？

> ID：108889
> 
> 赞同：1
> 
> 时间：2008-09-20T18:05:26.763
> 
> 标签：apache-flex, cairngorm, puremvc

在 Flex 中使用 MVC 框架的原因有很多，但选择正确的框架似乎很棘手。我对你们从实施这些（或另一个）的经验中的想法很感兴趣。

山姆

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-20T19:08:37.877

[这个问题已经被问过了](https://stackoverflow.com/questions/37043/flex-mvc-frameworks)，但是由于您专门询问 Cairngorm 和 PureMVC 的好处，所以我的想法是：

*   PureMVC 和 Cairngorm 都使编写可测试代码变得困难。这主要是因为他们使用了将您的应用程序代码紧密联系在一起的全局变量，从而难以隔离任何部分进行测试。Cairngorm 比 PureMVC 更是如此，但两者都非常糟糕。

*   PureMVC 比 Cairngorm 更具侵入性（这意味着您的代码严重依赖于框架，例如您必须继承/实现框架类/接口），但这并不意味着 Cairngorm 不是。

*   Cairngorm 充满了反模式，比如大量使用全局变量，PureMVC 隐藏了自身最糟糕的部分。

*   PureMVC 是反 Flex 的，Cairngorm 只是没有使用 Flex 的许多好的部分。我的意思是 PureMVC 重新发明了 Flex 已经拥有的许多东西，因为它希望与平台无关，并且由于它的架构，特别是中介，它使得使用绑定的全部功能变得更加困难。Cairngorm 只是跳过了诸如事件冒泡之类的事情，而是选择了涉及全局变量的解决方案。

简而言之，Cairngorm 是 Fl​​ex 的 VisualBasic，它可以工作但会教你很多坏习惯。PureMVC 还不错，只是不太适合编写 Flex 应用程序。

我认为你应该看的是[Mate](http://mate.asfusion.com)，它充分利用了 Flex 的潜力，而且它不是围绕全局变量构建的。相反，它可以帮助您编写松散耦合、可测试、可重用和可维护的代码，而无需您在其他应用程序框架中看到的对框架的沉重和不必要的依赖。

如果您出于某种原因不喜欢 Mate，请尝试[Swiz](http://code.google.com/p/swizframework/)，这是对 Cairngorm 的一个很大改进，但仍然对使用全局变量进行中央事件调度有一些奇怪的偏好（考虑到框架的要点之一，这完全是奇怪的）是为了避免Cairngorm的邪恶全局变量）。

# python - Python单元测试是否有类似“自动测试”的东西？

> ID：108892
> 
> 赞同：44
> 
> 时间：2008-09-20T18:07:40.597
> 
> 标签：python, testing

基本上，当测试中断或通过时，会发出咆哮通知（或其他回调）。**这样的事情存在吗？**

如果没有，它应该很容易写..最简单的方法是..

1.  跑`python-autotest myfile1.py myfile2.py etc.py`
    *   检查要监视的文件是否已被修改（可能只是它们已被保存）。
    *   在这些文件中运行任何测试。
    *   如果测试失败，但在之前的运行中通过了，则生成咆哮警报。与失败然后通过的测试相同。
    *   等待，然后重复步骤 2-5。

我可以看到的问题是测试是否在不同的文件中。简单的解决方案是在每次保存后运行所有测试。但如果测试速度较慢，这可能需要比保存之间的时间更长的时间，和/或可能会使用大量 CPU 功率等。

最好的方法是实际查看哪些代码已更改，如果函数 abc() 已更改，则仅运行与此交互的测试。虽然这很好，但我认为它会非常复杂实施？

总结一下：

*   有没有类似 Ruby 工具`autotest`（[ZenTest 包](http://www.zenspider.com/ZSS/Products/ZenTest/)的一部分）的东西，但用于 Python 代码？
*   您如何检查脚本的两个版本之间哪些函数发生了变化？
*   是否可以确定命令将调用哪些函数？（有点像反向追溯）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2012-02-27T08:28:14.297

我发现[autonose](https://github.com/gfxmonk/autonose)非常不可靠，但[嗅探器](http://pypi.python.org/pypi/sniffer/0.2.3)似乎工作得很好。

```
$ pip install sniffer
$ cd myproject 
```

然后，您不运行“nosetests”，而是运行：

```
$ sniffer 
```

或者`nosetests --verbose --with-doctest`，您运行：

```
$ sniffer -x--verbose -x--with-doctest 
```

如[自述](http://pypi.python.org/pypi/sniffer/0.2.3)文件中所述，最好安装一个特定于平台的文件系统监视库`pyinotify`，`pywin32`或者`MacFSEvents`（都可以通过`pip`etc 安装）

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-27T08:42:41.627

[由gfxmonk](http://github.com/gfxmonk/autonose/tree/master)创建的[autonose](http://gfxmonk.net/)：

> Autonose 是一个类似自动测试的 Python 工具，使用了优秀的 nosetest 库。
> 
> 自动测试跟踪文件系统更改，并在添加、删除或更新文件时自动重新运行任何更改的测试或依赖项。如果文件本身已被修改，或者它`import`的任何文件已更改，则该文件被视为已更改。
> 
> ...
> 
> Autonose 目前有一个用于 OSX 和 GTK 的原生 GUI。如果这些都不可用，您可以改为运行控制台版本（使用 --console 选项）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-16T19:58:57.167

我刚发现这个：[http ://www.metareal.org/p/modipyd/](http://www.metareal.org/p/modipyd/)

我目前正在使用 thumb.py，但是随着我当前的项目从小型项目过渡到中型项目，我一直在寻找可以进行更彻底的依赖分析的东西，并且通过一些调整，我得到了modipyd 启动并运行得非常快。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-07-25T18:59:37.007

[Guard](https://github.com/guard/guard)是一款出色的工具，可以监控文件更改并自动触发任务。它是用 Ruby 编写的，但它可以用作任何此类任务的独立工具。有一个[guard-nosetests](https://github.com/medihack/guard-nosetests)插件可以通过[nose](https://nose.readthedocs.org/en/latest/)运行 Python 测试。

Guard 支持跨平台通知（Linux、OSX、Windows），包括 Growl，以及许多其他强大的功能。我不能没有开发工具之一。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-12-01T12:12:56.050

一个可以让您的生活更轻松的非常有用的工具是[entr](http://entrproject.org/)。用 C 语言编写，并在底层使用[kqueue](https://en.wikipedia.org/wiki/Kqueue)或[inotify](http://man7.org/linux/man-pages/man7/inotify.7.html)。

如果项目中的任何`*.py`文件发生更改，以下命令将运行您的测试套件。

```
ls */**.py | entr python -m unittest discover -s test 
```

适用于 BSD、Mac OS 和 Linux。您可以从[Homebrew](http://entrproject.org/)获取入口。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-20T18:18:11.257

也许 buildbot 会很有用[http://buildbot.net/trac](http://buildbot.net/trac)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-20T18:32:54.950

对于您的第三个问题，也许该`trace`模块是您需要的：

```
>>> def y(a): return a*a
>>> def x(a): return y(a)
>>> import trace
>>> tracer = trace.Trace(countfuncs = 1)
>>> tracer.runfunc(x, 2)
4
>>> res = tracer.results()
>>> res.calledfuncs
{('<stdin>', '<stdin>', 'y'): 1, ('<stdin>', '<stdin>', 'x'): 1} 
```

`res.calledfuncs`包含被调用的函数。如果`countcallers = 1`在创建跟踪器时指定，则可以获得调用者/被调用者关系。有关更多信息，请参阅[模块的](http://docs.python.org/lib/trace-api.html)[文档。`trace`](http://docs.python.org/lib/trace-api.html)

您也可以尝试通过静态分析来获取调用，但由于 Python 的动态特性，这可能很危险。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-20T19:00:04.700

Django 的开发服务器有一个文件更改监视器，可以监视修改并自动重新加载。您可以重新使用此代码来启动文件修改的单元测试。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-20T19:01:22.497

也许鼻子[http://somethingaboutorange.com/mrl/projects/nose/](http://somethingaboutorange.com/mrl/projects/nose/)有一个插件[http://somethingaboutorange.com/mrl/projects/nose/doc/writing_plugins.html](http://somethingaboutorange.com/mrl/projects/nose/doc/writing_plugins.html)

发现这个：http: [//jeffwinkler.net/2006/04/27/keeping-your-nose-green/](http://jeffwinkler.net/2006/04/27/keeping-your-nose-green/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-11-28T22:00:26.443

查看 pytddmon。这是如何使用它的视频演示： [http ://pytddmon.org/?page_id=33](http://pytddmon.org/?page_id=33)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-08-31T07:32:28.267

您可以通过查看 .py 文件并执行来使用[nodemon](https://nodemon.io/)`manage.py test`来完成任务。命令将是：`nodemon --ext py --exec "python manage.py test"`。

`nodemon`是一个 npm 包但是，我假设你已经安装了节点。

# windows - 以编程方式更新具有 SVN 修订号的 MFC 应用程序中的 FILEVERSION

> ID：108900
> 
> 赞同：7
> 
> 时间：2008-09-20T18:12:48.650
> 
> 标签：windows, svn, mfc, versioninfo

如何以编程方式更新 MFC 应用程序中的 FILEVERSION 字符串？我有一个构建过程，用于生成包含给定版本的 SVN rev 的头文件。我正在使用来自[http://www.compuphase.com/svnrev.htm](http://www.compuphase.com/svnrev.htm)的 SvnRev来更新用于设置 MFC 应用程序标题栏的头文件。现在我想将此#define 用于我的 FILEVERION 信息。

最好的方法是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-20T19:13:10.363

`.rc`文件可以像`#include`文件一样标头文件`.c`。我有一个自动生成的`version.h`文件，它定义了以下内容：

```
#define MY_PRODUCT_VERSION    "0.47"
#define MY_PRODUCT_VERSION_NUM 0,47,0,0 
```

然后我只有我的`.rc`文件`#include "version.h"`并使用这些定义。

```
VS_VERSION_INFO VERSIONINFO
 FILEVERSION MY_PRODUCT_VERSION_NUM
 PRODUCTVERSION MY_PRODUCT_VERSION_NUM
...
 VALUE "FileVersion", MY_PRODUCT_VERSION "\0"
 VALUE "ProductVersion", MY_PRODUCT_VERSION "\0"
... 
```

我还没有在 MFC 项目中尝试过这种技术。可能需要将您的`VS_VERSION_INFO`资源移动到您的`.rc2`文件（Visual Studio 不会对其进行编辑）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T18:38:57.147

还没有足够的评论点，但无论您选择哪种解决方案，请记住 FILEVERSION 字段只能支持短整数。在我们的情况下，我们的 SVN 修订版已经高于此，并导致我们的 FILEVERSION 中的修订版号无效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T18:44:38.527

在您的 application.rc 文件中有一个版本块。该块控制文件系统中显示的版本信息。

> VS_VERSION_INFO VERSIONINFO
> FILEVERSION 1,0,0,1
> PRODUCTVERSION 1,0,0,1

您可以以编程方式更新此文件。确保打开文件并将其保存为二进制文件。我们遇到了以文本形式进行编辑并且文件损坏的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T07:27:29.277

也许这会有所帮助：[版本控制的构建](http://www.codeproject.com/KB/macros/versioningcontrolledbuild.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T19:05:23.720

`VS_VERSION_INFO`当您在资源管理器中右键单击文件并仅查看属性时，更改将反映出来。

如果您想在标题栏中显示当前的 SVN 修订号，我建议：

*   让脚本获取版本号并生成 version.h 文件

> ```
> #define SVN_VERSION_NO  xxx 
> ```

*   您的项目包含此 version.h 并使用该编号显示在标题中。

# xml - 我在哪里可以找到关于 XSL-FO（格式化/编辑对象）的好教程，这些东西是用来 fop 和获取 PDF 的？

> ID：108926
> 
> 赞同：12
> 
> 时间：2008-09-20T18:25:48.010
> 
> 标签：xml, pdf, xsl-fo, apache-fop

在我工作过的一家公司中，我和我的同事在 XSL-FO 之上实现了一个定制的文档分发系统。

我的任务是获取脚本以传递文档并配置 CUPS 打印服务器和传真服务器，因此我从来没有时间接触 XSL-FO。

我正在考虑在该地区实施一些在那里制作的东西，但我需要一些模板在测试时使用。

既然我已经掌握了 fop 流程，我在哪里可以找到一些关于 XSL-FO 的好教程？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T03:05:02.293

我喜欢向人们推荐这篇 2003 年 IBM developerWorks 文章：[HTML 到格式化对象 (FO) 转换指南](http://www.ibm.com/developerworks/library/x-xslfo2app/?ca=dnt-46h)

我不建议使用提供的 .xsl 将 HTML 转换为 FO，而是使用叙述来理解不同的 XSL-FO 构造以及它们与 HTML 的关系（我们都明白）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T05:05:45.797

首先，在您购买商业引擎之前，请查看 Apache FOP，它是一个非常可靠的 XSL-FO 引擎。我已将它广泛用于“政府”表单生成。

如果你刚刚开始。W3schools 在学习 XSL-FO 方面非常宝贵：http: [//www.w3schools.com/xslfo/default.asp](http://www.w3schools.com/xslfo/default.asp)

如果您是 XSL 的新手，我强烈推荐列表 @ [http://www.mulberrytech.com/xsl/xsl-list/index.html](http://www.mulberrytech.com/xsl/xsl-list/index.html)，即使只是为了寻找常见问题的常见解决方案。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-27T22:31:58.513

您还可以尝试使用[视觉 xsl-fo 设计器/编辑器](http://www.ecrion.com/Products/XFDesigner/Overview.aspx)。如果您仍想手动编写 XSL，请查看[XML 1.1 Bible 中的 XSL-FO 教程](http://www.cafeconleche.org/books/bible3/chapters/ch16.html)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-10-26T13:46:05.773

这里也是一个很好的 XSL-FO 新手教程。本文档通过示例快速介绍了 XSL 格式化对象。 [http://www.renderx.com/tutorial.html](http://www.renderx.com/tutorial.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-21T20:55:54.413

我也认为 O'Reilly 的书将是唯一的一本书，那里没有太多关于 XSL-FO 的内容......坦率地说，我认为这是一种死技术，对于普通程序员来说太复杂了，无法学习，这需要数周时间 - 再加上好的格式化程序非常昂贵。

这不是您问题的答案，但如果有人问我，我建议您不要学习 XSL-FO。这是寻找 IMO 问题的解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T22:53:01.400

[http://www.w3.org/TR/xsl/](http://www.w3.org/TR/xsl/)

[http://www.renderx.com/tools/xep.html](http://www.renderx.com/tools/xep.html)有一些很好的例子

[http://my.safaribooksonline.com/0596003552](http://my.safaribooksonline.com/0596003552)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-17T21:34:13.633

我认为要做好 xsl-fo，您需要牢牢掌握几种不同的技术。

首先是 XSLT 和 XPath，因为您将在 XSL-FO 中使用它们。有一些工具可以让您直观地创建 xsl-fo，但我看到的那些非常昂贵，所以我倾向于推出自己的 xslt，因为这些最终比生成的 xsl-fos 简单得多。

然后你需要对 fop 有扎实的把握，这似乎你已经掌握了，但对于其他任何人来说，如果你熟悉 css，你会熟悉最常见的样式，但对于特定的 fop 功能，做一些研究是有意义的。

进入它的最好方法是拿一些基本的例子并玩弄它们。在这里，Apache FOP 是一个很棒的开源处理器，如果您知道如何使用它，您可以将其用于专业目的。

像氧气 xml 这样的编辑器具有内置的 fop 支持，可以轻松快速地测试您的 xsl-fo，并且应该更容易学习 xsl-fo，但您也可以从命令行和其他几个编辑器执行相同的操作。

我推荐 Michael Kays XSLT 书，因为它是 XSLT “XSLT: Programmer's Reference 2nd Edition”[链接的优秀参考书](https://rads.stackoverflow.com/amzn/click/com/0764543814)

此外，Dave Pawson 的 FOP 书是我所知道的最好的 XSL-FO 参考书，尽管不可否认，可用的书不多。它有点过时，但它是核心概念的一个很好的参考，对于刚开始的人来说可能会使其不那么复杂。[关联](https://rads.stackoverflow.com/amzn/click/com/0596003552)

他的网站是关于奇怪问题或提高您对 xsl fo 的一般理解的重要提示来源。[http://www.dpawson.co.uk/xsl/index.html](http://www.dpawson.co.uk/xsl/index.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T18:35:50.327

这可能不是您所需要的，但如果您只是想要一些 XSL-FO 测试模板，您可以在 Word 中使用[此](http://www.microsoft.com/downloads/details.aspx?FamilyId=E0FAA0AF-A185-4296-B74D-A9FE870C92CC&displaylang=en)转换来生成 XSL-FO。

我以前学习的书来自 O'Reilly ( [XSL-FO](http://oreilly.com/catalog/9780596003555/) )，因为坦率地说，关于这个主题的资源非常少。

# ruby-on-rails - Rails 中的应用程序上下文

> ID：108938
> 
> 赞同：3
> 
> 时间：2008-09-20T18:33:44.090
> 
> 标签：ruby-on-rails

Rails 附带了一个方便的会话哈希，我们可以将内容塞进我们的内心深处。但是，我希望像 ASP 的应用程序上下文这样的东西，它不是仅在单个会话中共享数据，而是与同一应用程序中的所有会话共享它。我正在编写一个简单的仪表板应用程序，并且希望每 5 分钟而不是每个会话每 5 分钟提取一次数据。

当然，我可以将缓存更新时间存储在数据库中，但到目前为止还不需要为此应用程序设置数据库，并且希望尽可能避免这种依赖关系。

那么，有没有办法获得（或模拟）这种东西？如果没有数据库就无法做到这一点，那么 Rails 是否有任何一种“假”的数据库引擎，它在内存中运行，但不会在重启之间保留数据？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T20:58:25.320

**正确答案**：memcached。快速、干净、支持多个进程，如今与 Rails集成**得非常干净。**设置起来甚至没有那么糟糕，但继续运行是另一回事。

**90% 的回答**：可能有多个 Rails 进程在运行——例如，每个 Mongrel 对应一个。根据缓存需求的具体情况，每个 Mongrel 拥有一个缓存很可能并不是世界上最糟糕的事情。例如，假设您正在缓存一个长时间运行的查询的结果，该查询

*   每 8 小时获取一次新数据
*   每次页面加载都会使用，每天 20,000 次
*   需要在4个进程中访问（Mongrels）

然后你可以用大约一行代码将 20,000 个请求减少到 12 个

```
@@arbitrary_name ||= Model.find_by_stupidly_long_query(param) 
```

双 at-mark，一个你可能不熟悉的 Ruby 符号，是一个全局变量。||= 是当且仅当变量当前为 nil 或评估为 false 时执行赋值的常用 Ruby 习惯用法。它会一直保持良好状态，直到您明确清空它或直到进程停止，无论出于何种原因——服务器重新启动、明确杀死，你有什么。

在您在大约 15 秒内从每天 20k 次计算减少到 12 次之后（好的，两分钟 - 您需要将其包装在一个简单的 if 块中，该块将缓存更新时间存储在不同的全局中），您可能会发现那里无需花费额外的工程资产将其降至每天 4 个。

我实际上在我的一个生产站点中使用它，用于缓存一些昂贵的查询，这些查询实际上只需要在流程的生命周期中评估一次（即它们仅在部署时更改——我想我可以预先计算结果并编写它们到磁盘或数据库，但是当 SQL 可以为我完成工作时为什么要这样做）。

你不会得到任何神奇的过期语法，可靠性非常低，而且它不能跨进程共享——但它是你在一行代码中需要的 90%。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T18:38:03.363

你应该看看 memcached：[http ://wiki.rubyonrails.org/rails/pages/MemCached](http://wiki.rubyonrails.org/rails/pages/MemCached)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T18:44:49.930

Rails 2.1 缓存上有一个有用的[Railscast](http://railscasts.com/episodes/115-caching-in-rails-2-1)。如果您计划在 Rails 中使用 memcached，这将非常有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T19:38:22.173

使用现有的 Rails 缓存大致相当于此。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T18:46:29.723

@p3t0r- 是的，MemCached 可能是最好的选择，但您也可以使用 Rails 附带的 sqlite 数据库。但是，这不适用于 MemCached 的多台机器。此外，sqlite 将持久保存到磁盘，但我认为您可以根据需要将其设置为不。Rails 本身没有应用程序范围的存储，因为它作为每个请求一个进程的处理程序运行，因此它没有像 ASP.NET 或 Java 服务器那样的共享内存空间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T18:55:44.477

因此，由于 Rails 的设计方式，您要问的问题在 Rails 中是完全不可能的。你问的是一个共享对象，Rails 是严格的单线程的。用于在分布式进程之间共享数据的 Memcached 或类似工具是唯一的出路。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-28T21:52:13.633

Rails.cache 冻结它存储的对象。这种对缓存有意义，但对应用程序上下文没有意义。我想不是为了完成这个简单的任务而往返月球，你所要做的就是在 config/environment.rb 中创建一个常量

`APP_CONTEXT = Hash.new`

很简单吧？

# linux - 如何在 Ubuntu Hardy 下的 clisp 中使用（需要：PACKAGE）？

> ID：108940
> 
> 赞同：4
> 
> 时间：2008-09-20T18:35:30.093
> 
> 标签：linux, ubuntu, lisp, common-lisp, asdf

我正在尝试评估[此处提供](https://stackoverflow.com/questions/108081/are-there-any-high-level-easy-to-install-gui-libraries-for-common-lisp)的答案，但出现错误：`"A file with name ASDF-INSTALL does not exist"`使用 clisp 时：

```
dsm@localhost:~$ clisp -q
[1]> (require :asdf-install)

*** - LOAD: A file with name ASDF-INSTALL does not exist
The following restarts are available:
ABORT          :R1      ABORT
Break 1 [2]> :r1
[3]> (quit)

dsm@localhost:~$ 
```

cmucl 抛出类似的错误：

```
dsm@localhost:~$ cmucl -q
Warning:  #<Command Line Switch "q"> is an illegal switch
CMU Common Lisp CVS release-19a 19a-release-20040728 + minimal debian patches, running on crap-pile
With core: /usr/lib/cmucl/lisp.core
Dumped on: Sat, 2008-09-20 20:11:54+02:00 on localhost
For support see http://www.cons.org/cmucl/support.html Send bug reports to the debian BTS.
or to pvaneynd@debian.org
type (help) for help, (quit) to exit, and (demo) to see the demos

Loaded subsystems:
    Python 1.1, target Intel x86
    CLOS based on Gerd's PCL 2004/04/14 03:32:47
* (require :asdf-install)

Error in function REQUIRE:  Don't know how to load ASDF-INSTALL
   [Condition of type SIMPLE-ERROR]

Restarts:
  0: [ABORT] Return to Top-Level.

Debug  (type H for help)

(REQUIRE :ASDF-INSTALL NIL)
Source: 
; File: target:code/module.lisp
(ERROR "Don't know how to load ~A" MODULE-NAME)
0] (quit)
dsm@localhost:~$ 
```

但是 sbcl 完美地工作：

```
dsm@localhost:~$ sbcl -q
This is SBCL 1.0.11.debian, an implementation of ANSI Common Lisp.
More information about SBCL is available at <http://www.sbcl.org/>.

SBCL is free software, provided as is, with absolutely no warranty.
It is mostly in the public domain; some portions are provided under
BSD-style licenses.  See the CREDITS and COPYING files in the
distribution for more information.
* (require :asdf-install)

; loading system definition from
; /usr/lib/sbcl/sb-bsd-sockets/sb-bsd-sockets.asd into #<PACKAGE "ASDF0">
; registering #<SYSTEM SB-BSD-SOCKETS {AB01A89}> as SB-BSD-SOCKETS
; registering #<SYSTEM SB-BSD-SOCKETS-TESTS {AC67181}> as SB-BSD-SOCKETS-TESTS
("SB-BSD-SOCKETS" "ASDF-INSTALL")
* (quit) 
```

有想法该怎么解决这个吗？我在互联网上找到[了这篇文章](https://bugs.launchpad.net/ubuntu/+source/common-lisp-controller/+bug/37208)，但使用它也不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T19:06:06.777

先试试这个：

```
(require :asdf) 
```

你可以从我们使用的环境中窃取一些想法。可在：[darcsweb](http://dwim.hu/darcsweb/darcsweb.cgi?r=HEAD%20hu.dwim.environment;a=summary)

请参阅为我们加载和设置 asdf 的 environment.lisp。（sbcl 已经加载了 asdf）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T19:16:11.667

你得到的说明明确提到了 SBCL，所以我想它们使用 SBCL 会更好地工作。其他一些 Lisp 不附带 ASDF 或不将其连接到 CL:REQUIRE。在前一种情况下，您将事先自己加载 ASDF。在后一种情况下，您需要调用 (asdf:oos 'asdf:load-op ) 而不是 (require )。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T20:22:14.923

wget [http://cclan.cvs.sourceforge.net/checkout/cclan/asdf/asdf.lisp](http://cclan.cvs.sourceforge.net/) *_* _

值得一试 clbuild。 [http://common-lisp.net/project/clbuild/](http://common-lisp.net/project/clbuild/)

启动并运行 lisp 网络服务器。你只需要：

```
darcs get http://common-lisp.net/project/clbuild/clbuild
cd clbuild
chmod +x ./clbuild
./clbuild check
./clbuild build slime hunchentoot
./clbuild preloaded 
```

现在将启动一个 lisp repl。你在那里写：

```
* (hunchentoot:start-server :port 8080) 
```

测试服务器是否回答：

```
wget -O - http://localhost:8080/

<html><head><title>Hunchentoot</title></head>
 <body><h2>Hunchentoot Default Page</h2>
  <p>This is the Hunchentoot default page.... 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-06T18:27:17.990

在 clisp 中使用 clc:clc-require。请参阅“man common-lisp-controller”。我在 clisp 中遇到了同样的错误，并通过使用 clc:clc-require 解决了它。sbcl 只需要 require 就可以正常工作。

# database - 验证输出应该有多详细？

> ID：108947
> 
> 赞同：0
> 
> 时间：2008-09-20T18:37:19.183
> 
> 标签：database, validation, formatting, user-interface

我有一个应用程序，它读取数据库并向任何未满足的依赖项输出警报。我对这个问题的想法是“提供将用户指向问题的最少信息”。一位同事告诉我，我应该尽可能详细，打印出我提到的每个字段的数据库字段的值，并给出“字段一需要小于字段二”的最小信息。

我知道这个问题必须有一些约定或标准，因为它让我想起编译器错误和警告。有谁知道如何选择编译器消息？

社区对此问题有什么建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T18:41:26.710

我认为关键是要简洁。尽可能详细地说明传达警告的原因，仅此而已。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T18:43:08.593

写作时，了解你的听众。

如果您正在记录警告/错误消息以供自己使用，那么这相当容易：当出现问题时*您*需要知道什么？

如果您正在为其他人记录警告/错误消息，那么事情就会变得棘手。他们知道什么？他们的系统心智模型是什么样的？*他们可以*解决什么样的问题，他们需要什么信息来解决这些问题？

将每一个最后的数据片段都推送到一条消息中是一种下注——充其量，读者将不得不翻阅不相关的信息才能找到他们需要的东西；在最坏的情况下，他们会感到困惑并最终根据*错误*的数据做出决定。

编译器的类比很贴切：想想如果整个符号表与每个警告一起被转储会多么烦人......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T19:08:16.630

对于正常的日常操作，我会提供一条数据验证消息，该消息提供了足够的信息，用户可以解决问题，以便数据验证。例如，如果我有两个字段（fieldA 和 fieldB）并且其中一个必须大于另一个，那么我会在验证输出中说明这一点，并指定哪个字段是有问题的字段。

例如，如果 A 必须大于 B，并且他们提供的答案小于 B，那么消息将是“fieldA 需要高于 fieldB”

也就是说，我还在我的应用程序（尤其是 web 应用程序）中编写了一个调试模式，它有一个详细模式，准确地告诉一切发生了什么。如果打开它，您会看到两条消息，即用户友好的错误，然后是“FieldA=XX 和 FieldB=YY：XX 不大于 YY”。

这是简化的，但这是一般的想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T18:42:24.303

我建议你应该实现这两种模式。在正常操作期间，您需要一条有用但简短的消息。但有时事情可能会出错，在这种情况下，为用户提供所有可能信息的“转储”模式可以挽救生命。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T19:07:56.630

我认为 3 个典型用户组的错误消息详细信息有 3 个级别：

1.  最终用户。这是网站上的冲浪者或桌面应用程序的用户。如果问题无法得到补偿，他应该会收到一条错误消息。它应该包含最少的信息。最终用户不应通过系统接收任何信息，例如当前配置和文件路径。最终用户应联系管理员。连续的错误 ID 有助于管理员找到更多信息。
2.  管理员需要更多有用的信息来自行解决问题。它可以包括表 xy 未找到或登录数据库失败等信息。
3.  开发者：如果管理员不能解决问题，会联系软件供应商。在这种情况下，管理员应该能够发送一个日志文件，如果开发人员无法重现问题，他也可以解决它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T19:10:10.430

可以讨论日志内容的细节，但根据我的经验，在**[压力测试](http://en.wikipedia.org/wiki/Stress_test)**期间会很快确定详细程度。
如果系统无法正常运行，那是因为您只是：

*   要么让您的日志过于冗长，要么
*   确实记录得太频繁了（实际上，我相信[杰夫本人也有类似的问题](https://blog.stackoverflow.com/2008/09/podcast-20/)）

> **Atwood**：我们以这样一种方式记录日志……在日志调用期间触发了另一个日志调用。这通常没问题，但是在我们的负载下，最终它们会发生得如此接近以至于还有一个锁。所以，那里有两把锁。
> 
> **Spolsky** : [...] 你有一种想要记录一切的倾向。但是你得到的只是每个用户一百兆字节的日志，你每分钟得到三十个，而且不可能以任何合理的方式分析或存储。所以接下来你要做的就是开始剔除你的日志，或者只是进行不同级别的调试，就像在高调试模式下，一切都被记录下来，而在低调试模式下，什么都没有记录。而且...很难在日志中找出您真正想要的内容。
> 
> **Atwood**：具有讽刺意味的是，我的意思是，为了解决这个挂起问题，原来是因为日志记录，我们增加了更多的日志记录。
> 
> **斯波尔斯基**：[笑]
> 
> **阿特伍德**：笑话自己写的！笑话只是自己写的，对吧......

So my point is, when you will run your system in a production-like environment, you should quickly be able to determine if the level of verbosity you choose is sustainable.

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-20T18:43:21.417

处理错误 Vs。首先警告：错误应该是针对违反标准的东西。警告应该是允许的，但很可能不是作者的意图。

例如，W3C 标记验证器将警告 HTML 文档中使用语法 <br />。在 XHTML 中，这意味着“换行符”，但在 HTML 文档中，虽然被允许，但实际上意味着“换行符后跟大于号”（即使大多数浏览器不尊重这一点）。

至于冗长，什么是最好的取决于谁在使用这个系统。一些用户会更好地使用他们可以浏览的简短消息，而其他用户（可能是那些不太先进的用户）会发现附加信息很有用。在不知道他们是谁的情况下，我倾向于使用标志（-v 是传统的）让用户选择他们喜欢的版本。

# c# - 使用 Side-by-Side 程序集加载 x64 或 x32 版本的 DLL

> ID：108971
> 
> 赞同：61
> 
> 时间：2008-09-20T18:45:45.920
> 
> 标签：c#, .net, 64-bit

我们有两个版本的托管 C++ 程序集，一个用于 x86，一个用于 x64。该程序集由为 AnyCPU 编译的 .net 应用程序调用。我们正在通过文件复制安装部署我们的代码，并希望继续这样做。

当应用程序动态选择其处理器架构时，是否可以使用并排程序集清单分别加载 x86 或 x64 程序集？或者是否有另一种方法可以在文件复制部署中完成此操作（例如，不使用 GAC）？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-10-01T02:42:21.687

我创建了一个简单的解决方案，它能够从编译为 AnyCPU 的可执行文件中加载特定于平台的程序集。使用的技术可以总结如下：

1.  确保默认的 .NET 程序集加载机制（“Fusion”引擎）找不到特定于平台的程序集的 x86 或 x64 版本
2.  在主应用程序尝试加载特定于平台的程序集之前，在当前 AppDomain 中安装自定义程序集解析器
3.  现在，当主应用程序需要特定于平台的程序集时，Fusion 引擎将放弃（因为第 1 步）并调用我们的自定义解析器（因为第 2 步）；在自定义解析器中，我们确定当前平台并使用基于目录的查找来加载适当的 DLL。

为了演示这种技术，我附上了一个简短的基于命令行的教程。我在 Windows XP x86 和 Vista SP1 x64 上测试了生成的二进制文件（通过复制二进制文件，就像您的部署一样）。

**注 1**：“csc.exe”是一个 C-sharp 编译器。本教程假设它在您的路径中（我的测试使用“C:\WINDOWS\Microsoft.NET\Framework\v3.5\csc.exe”）

**注意 2**：我建议您为测试创建一个临时文件夹并运行其当前工作目录设置为该位置的命令行（或 powershell），例如

```
(cmd.exe)
C:
mkdir \TEMP\CrossPlatformTest
cd \TEMP\CrossPlatformTest 
```

**第 1 步**：特定于平台的程序集由一个简单的 C# 类库表示：

```
// file 'library.cs' in C:\TEMP\CrossPlatformTest
namespace Cross.Platform.Library
{
    public static class Worker
    {
        public static void Run()
        {
            System.Console.WriteLine("Worker is running");
            System.Console.WriteLine("(Enter to continue)");
            System.Console.ReadLine();
        }
    }
} 
```

**第 2 步**：我们使用简单的命令行命令编译特定于平台的程序集：

```
(cmd.exe from Note 2)
mkdir platform\x86
csc /out:platform\x86\library.dll /target:library /platform:x86 library.cs
mkdir platform\amd64
csc /out:platform\amd64\library.dll /target:library /platform:x64 library.cs 
```

**第三步**：主程序分为两部分。“Bootstrapper”包含可执行文件的主入口点，它在当前 appdomain 中注册了一个自定义程序集解析器：

```
// file 'bootstrapper.cs' in C:\TEMP\CrossPlatformTest
namespace Cross.Platform.Program
{
    public static class Bootstrapper
    {
        public static void Main()
        {
            System.AppDomain.CurrentDomain.AssemblyResolve += CustomResolve;
            App.Run();
        }

        private static System.Reflection.Assembly CustomResolve(
            object sender,
            System.ResolveEventArgs args)
        {
            if (args.Name.StartsWith("library"))
            {
                string fileName = System.IO.Path.GetFullPath(
                    "platform\\"
                    + System.Environment.GetEnvironmentVariable("PROCESSOR_ARCHITECTURE")
                    + "\\library.dll");
                System.Console.WriteLine(fileName);
                if (System.IO.File.Exists(fileName))
                {
                    return System.Reflection.Assembly.LoadFile(fileName);
                }
            }
            return null;
        }
    }
} 
```

“程序”是应用程序的“真实”实现（注意 App.Run 在 Bootstrapper.Main 的末尾被调用）：

```
// file 'program.cs' in C:\TEMP\CrossPlatformTest
namespace Cross.Platform.Program
{
    public static class App
    {
        public static void Run()
        {
            Cross.Platform.Library.Worker.Run();
        }
    }
} 
```

**第 4 步**：在命令行上编译主应用程序：

```
(cmd.exe from Note 2)
csc /reference:platform\x86\library.dll /out:program.exe program.cs bootstrapper.cs 
```

**第5步**：我们现在完成了。我们创建的目录结构应该如下：

```
(C:\TEMP\CrossPlatformTest, root dir)
    platform (dir)
        amd64 (dir)
            library.dll
        x86 (dir)
            library.dll
    program.exe
    *.cs (source files) 
```

如果您现在在 32 位平台上运行 program.exe，则会加载 platform\x86\library.dll；如果您在 64 位平台上运行 program.exe，则会加载 platform\amd64\library.dll。请注意，我在 Worker.Run 方法的末尾添加了 Console.ReadLine()，以便您可以使用任务管理器/进程资源管理器来调查加载的 DLL，或者您可以使用 Visual Studio/Windows 调试器附加到进程以查看调用栈等

当 program.exe 运行时，我们的自定义程序集解析器会附加到当前的 appdomain。一旦 .NET 开始加载 Program 类，它就会看到对“库”程序集的依赖，因此它会尝试加载它。但是，没有找到这样的程序集（因为我们已将其隐藏在 platform/* 子目录中）。幸运的是，我们的自定义解析器知道我们的诡计，并根据当前平台尝试从适当的 platform/* 子目录加载程序集。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2012-03-30T23:40:41.823

我的版本，类似于@Milan，但有几个重要的变化：

*   适用于所有未找到的 DLL
*   可以打开和关闭
*   `AppDomain.CurrentDomain.SetupInformation.ApplicationBase`使用而不是`Path.GetFullPath()`因为当前目录可能不同，例如在托管方案中，Excel 可能会加载您的插件，但当前目录不会设置为您的 DLL。

*   `Environment.Is64BitProcess`被用来代替`PROCESSOR_ARCHITECTURE`，因为我们不应该依赖于操作系统是什么，而是这个进程是如何启动的——它可能是 x64 操作系统上的 x86 进程。在 .NET 4 之前，请`IntPtr.Size == 8`改用。

在一些先加载的主类的静态构造函数中调用此代码。

```
public static class MultiplatformDllLoader
{
    private static bool _isEnabled;

    public static bool Enable
    {
        get { return _isEnabled; }
        set
        {
            lock (typeof (MultiplatformDllLoader))
            {
                if (_isEnabled != value)
                {
                    if (value)
                        AppDomain.CurrentDomain.AssemblyResolve += Resolver;
                    else
                        AppDomain.CurrentDomain.AssemblyResolve -= Resolver;
                    _isEnabled = value;
                }
            }
        }
    }

    /// Will attempt to load missing assembly from either x86 or x64 subdir
    private static Assembly Resolver(object sender, ResolveEventArgs args)
    {
        string assemblyName = args.Name.Split(new[] {','}, 2)[0] + ".dll";
        string archSpecificPath = Path.Combine(AppDomain.CurrentDomain.SetupInformation.ApplicationBase,
                                               Environment.Is64BitProcess ? "x64" : "x86",
                                               assemblyName);

        return File.Exists(archSpecificPath)
                   ? Assembly.LoadFile(archSpecificPath)
                   : null;
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-06-04T12:16:44.237

看看 SetDllDirectory。我在动态加载用于 x64 和 x86 的 IBM spss 程序集时使用了它。它还解决了在我的情况下由程序集加载的非程序集支持 dll 的路径是 spss dll 的情况。

[http://msdn.microsoft.com/en-us/library/ms686203%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/ms686203%28VS.85%29.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T18:56:17.797

您可以使用[corflags](http://msdn.microsoft.com/en-us/library/ms164699(VS.80).aspx)实用程序强制 AnyCPU exe 作为 x86 或 x64 可执行文件加载，但这并不完全满足文件复制部署要求，除非您根据目标选择要复制的 exe。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-11-21T19:14:12.850

此解决方案也适用于非托管程序集。我创建了一个类似于 Milan Gardian 的出色示例的简单示例。我创建的示例将托管 C++ dll 动态加载到为 Any CPU 平台编译的 C# dll 中。该解决方案利用 InjectModuleInitializer nuget 包在加载程序集的依赖项之前订阅 AssemblyResolve 事件。

[https://github.com/kevin-marshall/Managed.AnyCPU.git](https://github.com/kevin-marshall/Managed.AnyCPU.git)************