# StackOverflow 问答 000283000-000283999

# timezone - 计算前往国际国家的时间

> ID：283001
> 
> 赞同：0
> 
> 时间：2008-11-12T04:09:39.267
> 
> 标签：timezone

我想计算一个顾问到海外旅行的津贴。我必须考虑到我可以在国际旅行中获得一天或损失一天。不同的国家有不同的配额。

我如何调整我的代码以知道我会赢一天还是输一天并调整我的计算？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T04:34:00.823

使用当地时区信息输入日期/时间。将两个日期/时间从该时区转换为 UTC，并根据 UTC 计算两者之间的差异。

例如：

左：2008 年 11 月 11 日上午 10 点 CST（芝加哥）== 2008 年 11 月 11 日下午 4 点 UTC (-6)

抵达时间：2008 年 11 月 12 日凌晨 5 点 CET（哥本哈根）== 2008 年 11 月 12 日凌晨 4 点 UTC (+1)

差异 = 12 小时

# php - 获取父类中子类的名称（静态上下文）

> ID：283004
> 
> 赞同：107
> 
> 时间：2008-11-12T04:10:09.513
> 
> 标签：php, inheritance, static-methods

我正在构建一个考虑重用和简单性的 ORM 库；一切都很好，除了我被一个愚蠢的继承限制卡住了。请考虑以下代码：

```
class BaseModel {
    /*
     * Return an instance of a Model from the database.
     */
    static public function get (/* varargs */) {
        // 1\. Notice we want an instance of User
        $class = get_class(parent); // value: bool(false)
        $class = get_class(self);   // value: bool(false)
        $class = get_class();       // value: string(9) "BaseModel"
        $class =  __CLASS__;        // value: string(9) "BaseModel"

        // 2\. Query the database with id
        $row = get_row_from_db_as_array(func_get_args());

        // 3\. Return the filled instance
        $obj = new $class();
        $obj->data = $row;
        return $obj;
    }
}

class User extends BaseModel {
    protected $table = 'users';
    protected $fields = array('id', 'name');
    protected $primary_keys = array('id');
}
class Section extends BaseModel {
    // [...]
}

$my_user = User::get(3);
$my_user->name = 'Jean';

$other_user = User::get(24);
$other_user->name = 'Paul';

$my_user->save();
$other_user->save();

$my_section = Section::get('apropos');
$my_section->delete(); 
```

显然，这不是我所期望的行为（尽管实际行为也很有意义）。所以我的问题是你们是否知道在父类中获取子类名称的方法。

* * *

## 回答 #1

> 赞同：202
> 
> 时间：2009-07-22T16:43:09.327

如果您能够想出一种在静态上下文之外执行此操作的方法，则无需等待 PHP 5.3。在 php 5.2.9 中，在父类的非静态方法中，您可以执行以下操作：

```
get_class($this); 
```

它会将子类的名称作为字符串返回。

IE

```
class Parent() {
    function __construct() {
        echo 'Parent class: ' . get_class() . "\n" . 'Child class: ' . get_class($this);
    }
}

class Child() {
    function __construct() {
        parent::construct();
    }
}

$x = new Child(); 
```

这将输出：

```
Parent class: Parent
Child class: Child 
```

甜吗？

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2008-11-12T04:58:55.563

简而言之。这是不可能的。在 php4 中，您可以实现一个可怕的 hack（检查`debug_backtrace()`），但该方法在 PHP5 中不起作用。参考：

*   # [30423](http://bugs.php.net/bug.php?id=30423)

*   # [37684](http://bugs.php.net/bug.php?id=37684)

*   # [34421](http://bugs.php.net/bug.php?id=34421)

**编辑**：PHP 5.3 中后期静态绑定的示例（在评论中提到）。[请注意，它的当前实现（ src](https://web.archive.org/web/20120209224705/http://www.digitalsandwich.com/archives/65-Late-static-binding....sorta.html)）存在潜在问题。

```
class Base {
    public static function whoAmI() {
        return get_called_class();
    }
}

class User extends Base {}

print Base::whoAmI(); // prints "Base"
print User::whoAmI(); // prints "User" 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2018-04-15T21:39:48.497

我知道这个问题真的很老，但是对于那些寻找比在包含类名的每个类中定义属性更实用的解决方案的人：

**您可以`static`为此使用关键字。**

如[php 文档中的此贡献者说明中所述](http://php.net/manual/en/language.oop5.static.php#104823)

> `static`可以在超类中使用关键字来访问调用方法的子类。

**例子：**

```
class Base
{
    public static function init() // Initializes a new instance of the static class
    {
        return new static();
    }

    public static function getClass() // Get static class
    {
        return static::class;
    }

    public function getStaticClass() // Non-static function to get static class
    {
        return static::class;
    }
}

class Child extends Base
{

}

$child = Child::init();         // Initializes a new instance of the Child class

                                // Output:
var_dump($child);               // object(Child)#1 (0) {}
echo $child->getStaticClass();  // Child
echo Child::getClass();         // Child 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2018-12-30T22:27:12.223

我知道它的旧帖子，但想分享我找到的解决方案。

使用 PHP 7+ 测试 使用函数`get_class()`[链接](http://php.net/manual/en/function.get-class.php)

```
<?php
abstract class bar {
    public function __construct()
    {
        var_dump(get_class($this));
        var_dump(get_class());
    }
}

class foo extends bar {
}

new foo;
?> 
```

上面的示例将输出：

```
string(3) "foo"
string(3) "bar" 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-06-13T16:39:16.400

如果您不想使用 get_call_class() ，您可以使用后期静态绑定的其他技巧（PHP 5.3+）。但在这种情况下，您需要在每个模型中都有 getClass() 方法。这不是什么大不了的海事组织。

```
<?php

class Base 
{
    public static function find($id)
    {
        $table = static::$_table;
        $class = static::getClass();
        // $data = find_row_data_somehow($table, $id);
        $data = array('table' => $table, 'id' => $id);
        return new $class($data);
    }

    public function __construct($data)
    {
        echo get_class($this) . ': ' . print_r($data, true) . PHP_EOL;
    }
}

class User extends Base
{
    protected static $_table = 'users';

    public static function getClass()
    {
        return __CLASS__;
    }
}

class Image extends Base
{
    protected static $_table = 'images';

    public static function getClass()
    {
        return __CLASS__;
    }
}

$user = User::find(1); // User: Array ([table] => users [id] => 1)  
$image = Image::find(5); // Image: Array ([table] => images [id] => 5) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-12T06:00:02.070

看来您可能正在尝试将单例模式用作工厂模式。我建议评估您的设计决策。如果单例确实合适，我还建议仅在不需要继承的情况下使用静态*方法*。

```
class BaseModel
{

    public function get () {
        echo get_class($this);

    }

    public static function instance () {
        static $Instance;
        if ($Instance === null) {
            $Instance = new self;

        }
        return $Instance;
    }
}

class User
extends BaseModel
{
    public static function instance () {
        static $Instance;
        if ($Instance === null) {
            $Instance = new self;

        }
        return $Instance;
    }
}

class SpecialUser
extends User
{
    public static function instance () {
        static $Instance;
        if ($Instance === null) {
            $Instance = new self;

        }
        return $Instance;
    }
}

BaseModel::instance()->get();   // value: BaseModel
User::instance()->get();        // value: User
SpecialUser::instance()->get(); // value: SpecialUser 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-12T11:45:44.010

也许这实际上并没有回答问题，但您可以添加一个参数来指定类型的 get()。然后你可以打电话

```
BaseModel::get('User', 1); 
```

而不是调用 User::get()。您可以在 BaseModel::get() 中添加逻辑以检查子类中是否存在 get 方法，然后在您希望允许子类覆盖它时调用该方法。

否则我能想到的唯一方法显然是向每个子类添加东西，这很愚蠢：

```
class BaseModel {
    public static function get() {
        $args = func_get_args();
        $className = array_shift($args);

        //do stuff
        echo $className;
        print_r($args);
    }
}

class User extends BaseModel {
    public static function get() { 
        $params = func_get_args();
        array_unshift($params, __CLASS__);
        return call_user_func_array( array(get_parent_class(__CLASS__), 'get'), $params); 
    }
}

User::get(1); 
```

如果您随后将用户子类化，这可能会中断，但我想您可以在这种情况下替换`get_parent_class(__CLASS__)`为`'BaseModel'`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-15T07:23:44.047

问题不是语言限制，而是您的设计。别介意你有课；静态方法掩盖了过程而不是面向对象的设计。您还以某种形式使用全局状态。（怎么`get_row_from_db_as_array()`知道在哪里可以找到数据库？）最后，单元测试看起来非常困难。

沿着这些思路尝试一些东西。

```
$db = new DatabaseConnection('dsn to database...');
$userTable = new UserTable($db);
$user = $userTable->get(24); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-01-18T20:38:32.730

普雷斯顿回答的两种变体：

1)

```
class Base 
{
    public static function find($id)
    {
        $table = static::$_table;
        $class = static::$_class;
        $data = array('table' => $table, 'id' => $id);
        return new $class($data);
    }
}

class User extends Base
{
    public static $_class = 'User';
} 
```

2)

```
class Base 
{
    public static function _find($class, $id)
    {
        $table = static::$_table;
        $data = array('table' => $table, 'id' => $id);
        return new $class($data);
    }
}

class User extends Base
{
    public static function find($id)
    {
        return self::_find(get_class($this), $id);
    }
} 
```

注意：以 _ 开头的属性名称是一种约定，基本上意味着“我知道我公开了它，但它确实应该受到保护，但我无法做到这一点并实现我的目标”

# open-source - 您如何在特定项目的论坛上回答基本的编程问题？

> ID：283005
> 
> 赞同：0
> 
> 时间：2008-11-12T04:11:30.230
> 
> 标签：open-source, project-management

我目前正在成为一个小型开源项目（Facebook 工具包）的维护者，当然，其中一项职责是在我们的论坛上回答用户问题。虽然我很乐意帮助用户学习如何使用我们的工具包并处理他们可能遇到的问题（这最终可能表明我们的代码中存在错误），但很多问题似乎与我们的工具包无关，更多地与了解如何编程有关。

我想帮助提出这些问题的人，但我真的没有时间成为一名全面的编程老师。我不想忽略它们。他们不是要求用勺子喂所有东西。他们只是不知道从哪里开始解决他们的问题。有什么方法可以在不冒犯他们的情况下为他们指明正确的方向，并且不用花费我所有的时间来教我们的用户一般编程技能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T04:18:04.583

把它们送到这里！不过说真的，你回答的“感知价值”与你的态度有很大关系。准确地告诉他们你在第二段中所说的内容：你没有足够的带宽来提供你想要的帮助，但你可以推荐一些非常有用的网站、书籍或其他参考资料。“STFW”是可以接受的，只要措辞恰当，您甚至可以建议搜索词。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T04:14:56.103

制作一个常见问题页面或一个涵盖一些基础知识的教程，这将消除很多问题。

# .net - Firefox 发送请求两次

> ID：283011
> 
> 赞同：9
> 
> 时间：2008-11-12T04:12:16.110
> 
> 标签：.net, firefox, firebug, double

我正在尝试在 .net 中处理信用卡交易，它在 Safari、Opera 和 IE 中完美运行。当我在 Firefox 中尝试相同的交易时，它会发送两个请求，最终我会收到一张双重收费的卡。从 Google 上的快速搜索来看，这似乎是 Firebug 的一个问题，但我无法找到阻止这个双重帖子的方法。

有谁知道如何防止 Firefox（和 Firebug）这样做？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-12T04:17:14.883

使用一个[**nonce**](http://en.wikipedia.org/wiki/Cryptographic_nonce)，一个只使用一次的唯一键。

将唯一编号连同表单字段发送到浏览器（这通常通过隐藏的输入字段完成），并将副本与交易一起存储在服务器上。在表单中，更改提交时的数字。在处理您的请求时验证密钥是否匹配。

也可能对前端发生的事情有明确的解释，并且可以在客户端消除该问题。最好在服务器上解决双重提交问题，因为可能发生双重提交的方式有很多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-12T04:58:27.607

它可能不是萤火虫。

去年我遇到了类似的问题（尽管在我的情况下，每次查看独立媒体文件时都会出现一系列无休止的 GET 请求：GIF、JPG、WMV 等）。

我禁用了所有扩展，然后尝试一次重新启用它们，检查每个扩展以查看是否导致问题。就我而言，它原来是 Skype 扩展。

所以不要仅仅依靠二手知识，它是萤火虫。如果你真的深入研究这个问题，你可能会发现这完全是另外一回事。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T04:24:20.327

我使用 Firebug 1.2.1，它已经预防了双重发布错误，当您想查看 AJAX 响应时，它会向您显示此警告：

> Firebug 需要 POST 到服务器以获取 url 的此信息： [http://example.url/](http://example.url/)
> 
> 这第二个 POST 可能会干扰某些站点。如果要再次发送 POST，请在 Firefox 中打开一个新选项卡，使用 URL 'about:config'，将布尔值 'extensions.firebug.allowDoublePost' 设置为 true 每次重新启动 Firefox 时都会重置此值 [https://bugzilla.mozilla.org/show_bug.cgi?id=430155](https://bugzilla.mozilla.org/show_bug.cgi?id=430155) 已发货。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T04:49:53.443

我曾经在 Firefox 中也遇到过这种情况——在某些情况下，当您“查看源代码”时可能会发生这种情况。Firebug 双张贴听起来像一个类似的问题。

不过，最后，你现在抓住了这一点是一件好事——如果信用卡双重收费可以像下订单后点击后退按钮一样简单，那就太糟糕了。（作为电子商务公司的开发人员，我可以告诉您，这种情况*一直都在*发生。如果您的结帐流程有四个步骤/页面，想象一下在新的浏览器窗口中打开第 3 步可能造成的破坏，在第一个窗口中返回上一步，然后在第二个浏览器窗口中完成订单......相信我，我已经学会了艰难的方法。你会惊讶于人们为绕过夏威夷运费附加费所做的事情步骤 3 的计算。）

随机数是一种解决方案；另一种是简单地在处理信用卡的页面上进行完整性检查。查看您的数据库并说“等一下……这个订单已经收费了！” 然后吐出优美的错误信息。希望这可以帮助！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-22T07:22:21.077

即使 nonce 不是您解决此问题的方法，您也需要有一个 nonce！对于一个人想要诱骗另一个人做某事的任何类型的网站（例如涉及金钱的任何地方），这都是非常重要的。它被称为跨站点请求伪造，通常被随机数阻止。如果您需要更多信息，请参阅[http://en.wikipedia.org/wiki/CSRF 。](http://en.wikipedia.org/wiki/CSRF)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T04:19:18.997

我有同样的问题——虽然没有意识到它是特定于 FireBug 的。无论如何，您确实应该正确解决此问题，以防用户单击后退按钮并重新提交。

通常的方法是在表单的隐藏字段中为交易设置一个唯一的令牌。当服务器端接收到表单时，它会阻止进行另一个事务。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-28T04:47:41.000

感谢您在这里的出色回应。就我而言，它原来是 FireBug（版本 1.05）和 FireFox 2.0.0.20。一旦我关闭了 FireBug 插件，双帖就停止了。

# optimization - 释放 alloca 分配的内存

> ID：283024
> 
> 赞同：9
> 
> 时间：2008-11-12T04:18:56.813
> 
> 标签：optimization, memory-management

是否可以在当前函数退出之前显式释放 C 的 alloca() 分配的内存？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-12T04:25:51.293

来自[http://www.gnu.org/software/libc/manual/html_mono/libc.html#Variable-Size-Automatic](http://www.gnu.org/software/libc/manual/html_mono/libc.html#Variable-Size-Automatic)：

> 分配一个块`alloca`是一个显式的动作；您可以根据需要分配任意数量的块，并在运行时计算大小。但是，当您退出调用 alloca 的函数时，所有块都会被释放，就像它们是在该函数中声明的自动变量一样。**没有办法明确地释放空间。**

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-12T04:28:18.493

这是可能的，但没有预先编写的功能可以做到这一点。您必须深入研究编译器的 alloca() 实现以弄清楚它在做什么，然后编写自己的 freea()。由于每个编译器执行 alloca() 的方式不同，因此您必须为每个编译器重写 freea()。

但我很难相信这值得麻烦。如果您需要显式释放它，只需使用 malloc/free - 这些功能通常都经过大量优化。利用它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-12T04:23:18.253

您正在使用 alloca() 在堆栈上分配；如果之后发生了其他事情（并且如果不将所有内容都写入汇编中就无法控制它），则不能只是将堆栈缩小。因此，除非您离开函数的堆栈框架，否则这是不可能的。

这也是为什么如果您溢出分配的缓冲区，您会真正搞砸事情的原因。你可以开始覆盖你的函数返回的代码地址，导致它跳转到其他地方，各种可怕的东西。当心！

Malloc 在堆上工作，这就是为什么它可以做的事情更加灵活。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-04-15T18:58:51.890

[使用 C99，您可以使用可变长度数组](https://gcc.gnu.org/onlinedocs/gcc/Variable-Length.html)来实现相同的目的。只需在新范围内声明 VLA；当范围退出时，它将自动释放。

例如：

```
int some_function(int n) {
    // n has the desired length of the array
    ...
    { // new scope
        int arr[n]; // instead of int *arr = alloca(n*sizeof(int));
        // do stuff with array
    }
    // function continues with arr deallocated
    ...
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-04-04T08:04:07.323

这对于延续传递风格（CPS）很有用，而不是 realloca。

您可以调用一个函数来分配和操作堆栈顶部的字符串，然后将堆栈缩小到字符串的长度并调用下一个函数。

没有概念上的原因为什么不能有一个 freea()，除了堆栈上的最顶层条目之外，它对于任何东西都是 nop。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T04:20:28.963

不，因为它与局部变量一起分配在堆栈上。如果您想要可以显式释放的内存，请使用动态内存分配函数之一。

没有混合允许您显式释放**并**在函数退出时自动释放它，至少在标准中没有。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-07-06T04:45:43.910

是的，但这取决于 alloca() 的实现。alloca() 的一个合理简单的实现是通过调整堆栈指针将新分配的块放在*堆栈顶部。*因此要释放这块内存我们只需要做一个**负**分配（但你需要研究alloca()的真正实现），我们以下面的***不可移植***代码为例来验证它：

```
#include <stdio.h>
#include <alloca.h>

int main()
{
  unsigned long p0, p1, p2;
  p0=(unsigned long)alloca(0);
  p1=(unsigned long)alloca((size_t) 0x1000);
  p2=(unsigned long)alloca((size_t)-0x1000);
  printf( "p0=%lX, p1=%lX, p2=%lX\n", p0, p1, p2 );
  return 0;
} 
```

在带有 clang 2.9 的旧 x64 机器上，示例输出为：

```
p0=7FFF2C75B89F, p1=7FFF2C75A89F, p2=7FFF2C75B89F 
```

所以我们知道实现**不会**验证参数 -0x1000，否则无符号值将是一个非常大的整数。堆栈指针原本是 0x...B89F；由于此堆栈向上增长 alloca(0x1000)，因此将堆栈指针更改**为**(0x...B89F **-** 0x1000) = 0x...A89F。在负分配 (0xA89F - (-0x1000)) 之后，堆栈指针回到 0x...B89F。

但是，对于 gcc 4.8.3，示例输出为：

```
p0=7FFFA3E27A90, p1=7FFFA3E26A80, p2=7FFFA3E27A70 
```

在 /usr/include/alloca.h 我们发现：

```
#ifdef  __GNUC__
# define alloca(size)   __builtin_alloca (size)
#endif /* GCC.  */ 
```

所以我们知道 gcc 4.8.3 提供的内置 alloca 函数做了类似的事情，只是它分配了额外的 0x10 字节作为安全边际。在进行负分配时，它仍然假设它向上增长，因此尝试保留 0x10 额外字节（- 0x10），因此 p2= 0x...6A80 - (-0x1000) - 0x10 = 0x...7A70。所以，要格外小心。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-12-13T15:37:14.400

您不需要编写任何自定义`freea(...)`类型的函数，也不需要使用 VLA。在 C 和 C++ 中可以轻松释放堆栈上分配的内存（C++ 不支持 VLA）。在`alloca(...)`堆栈上分配，对吗？这意味着当内存超出范围时将被释放......所以只需使用范围！

```
#include <alloca.h>

int main()
{
    {
        void* ptr = alloca(1024);

        // do your stuff

    } // memory is deallocated here

    return 0;
} 
```

从 godbolt 在线编译器可以看出，程序集（没有优化）做了正确的事： [https ://godbolt.org/z/Gn5YMa](https://godbolt.org/z/Gn5YMa)

# .net - WPF DocumentViewer 不发布 XPS 文件

> ID：283027
> 
> 赞同：10
> 
> 时间：2008-11-12T04:20:28.400
> 
> 标签：.net, wpf, xps, documentviewer

我正在开发一个打开并显示 XPS 文档的 WPF 应用程序。当应用程序关闭时，规范是应用程序应删除打开的 XPS 文档以进行清理。但是，当打开某个 XPS 文档时，应用程序会在尝试删除该文件时抛出该文件仍在使用中的异常。这有点奇怪，因为它仅在打开特定的 XPS 文档时发生，并且仅在您超出第一页时才会发生。

我使用的一些代码如下所示：

打开 XPS 文档：

```
DocumentViewer m_documentViewer = new DocumentViewer();
XpsDocument m_xpsDocument = new XpsDocument(xpsfilename, fileaccess);
m_documentViewer.Document = m_xpsDocument.GetFixedDocumentSequence();
m_xpsDocument.Close(); 
```

导航 XPS 文档：

```
m_documentViewer.FirstPage();
m_documentViewer.LastPage();
m_documentViewer.PreviousPage();
m_documentViewer.NextPage(); 
```

关闭 DocumentViewer 对象并删除文件：

```
m_documentViewer.Document = null;
m_documentViewer = null;
File.Delete(xpsfilename); 
```

这一切都非常基本，并且可以与我们测试的其他文档一起使用。但是对于特定的 XPS 文档，会弹出一个异常，指出要删除的文件仍在使用中。

我的代码有什么问题或遗漏吗？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-09-02T21:24:52.670

您需要关闭打开分配给查看器的 XpsDocument 的 System.IO.Packaging.Package。此外，如果您希望能够在同一个应用程序会话中再次打开同一个文件，则必须从 PackageStore 中删除该包。

尝试

```
var myXpsFile = @"c:\path\to\My XPS File.xps";
var myXpsDocument = new XpsDocument(myXpsFile);
MyDocumentViewer.Document = myXpsDocument;

//open MyDocumentViwer's Window and then close it
//NOTE: at this point your DocumentViewer still has a lock on your XPS file
//even if you Close() it
//but we need to do something else instead

//Get the Uri from which the system opened the XpsPackage and so your XpsDocument
var myXpsUri = myXpsDocument.Uri; //should point to the same file as myXpsFile

//Get the XpsPackage itself
var theXpsPackage = System.IO.Packaging.PackageStore.GetPackage(myXpsUri);

//THIS IS THE KEY!!!! close it and make it let go of it's file locks
theXpsPackage.Close();

File.Delete(myXpsFile); //this should work now

//if you don't remove the package from the PackageStore, you won't be able to
//re-open the same file again later (due to System.IO.Packaging's Package store/caching
//rather than because of any file locks)
System.IO.Packaging.PackageStore.RemovePackage(myXpsUri); 
```

是的，我知道您可能没有打开带有 Package 的 XpsDocument，甚至可能不知道它是什么——或关心它——但是 .NET 在幕后为您“完成”了它并且忘记了自己清理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T07:46:06.217

使 xpsDocument 成为成员，然后不要在其上调用 close() :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T05:07:14.563

[http://blogs.msdn.com/junfeng/archive/2008/04/21/use-htrace-to-debug-handle-leak.aspx](http://blogs.msdn.com/junfeng/archive/2008/04/21/use-htrace-to-debug-handle-leak.aspx)

您可以使用 WinDbg 找出谁拥有句柄和非托管堆栈

编辑：当然，您还可以通过 SOS 扩展 ( [http://msdn.microsoft.com/en-us/library/bb190764.aspx](http://msdn.microsoft.com/en-us/library/bb190764.aspx) )获取托管堆栈跟踪和查看

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T08:19:11.740

谢谢回复！

这有点低级，但当我用完想法时，我会记住它。无论如何，我发现了更多关于这个错误的信息。导致异常的特定文档中插入了图像。当我删除图像时，不会发生异常。这可能是 DocumentViewer 错误，但我仍在尝试......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T03:11:18.660

没有，到现在还一无所获。

举个例子，我尝试了以下失败的方法：

1.  在删除文件之前，在窗口的“关闭”事件中将所有内容设置为空。这包括 DocumentViewer.Document 属性和 DocumentViewer 对象。

2.  使用 ShowDialog() 打开窗口，然后将其设置为 null。将文件的删除移至打开窗口的 System.Windows.Application 对象的“退出”事件。仍然抛出文件正在被使用的异常。

文档查看器错误？？？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T09:54:03.373

[我怀疑您遇到与http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework/topic59281.aspx](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework/topic59281.aspx)相同的问题

听起来像 DocumentViewer 中的一个错误，它应该在关闭时处理嵌套的 BitmapDecoders 或使用不同的位图缓存选项加载图像。

# asp.net - asp.net 中的连接与断开架构

> ID：283029
> 
> 赞同：3
> 
> 时间：2008-11-12T04:21:01.613
> 
> 标签：asp.net

在 asp.net 中相互连接和断开连接的体系结构（数据库）的优点和缺点是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-05-23T10:55:40.747

在断开连接的体系结构中，**DataSet**用于从数据库中检索数据。然后也不需要维护连接。一旦检索到数据，所有操作都可以执行。在处理数据时不会导致交通问题。

在连接架构中，**DataReader**用于从数据库中检索数据。这里始终保持连接。在数据库中访问数据时，可以执行更新、删除、读取和选择操作，因此必须保持连接。这可能会导致交通问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T04:53:11.253

对于 ASP.NET，“断开连接”架构通常是指数据以不频繁的批量请求的形式下载到 ASP.NET 应用程序的内存并存储在缓存中以供以后处理的架构。这避免了频繁访问数据库，从而消除了主要的 I/O 障碍之一。在经常查询数据但不更新数据的站点中，如果您的服务器具有支持数据缓存的内存，这可能会显着提高性能。

当然，您可能会引用 Google Gears 之类的东西，但我还没有听说在 ASP.NET 世界中使用得很多。我想，一切皆有可能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-09-14T00:33:42.263

在了解此实现之前，您必须了解数据库系统是如何在 .NET 框架中实现的。在 .NET 中，ADO.NET 负责数据处理，在 ADO.NET 中有数据集、数据适配器和数据库。

数据集是客户端内存中的临时位置，用于保存从数据库发送的数据。数据适配器是来回发送和接收数据的中间方，我的意思是它从数据集中发送数据，然后数据库服务器将结果从数据库发送到数据集，这个过程是通过数据适配器完成的。

通常数据适配器使用连接来连接数据库以启动事务，并且在断开连接的数据架构中，一旦数据从/到数据库传递，该连接就会关闭。最大的优势是安全性，因为当连接始终打开时，任何人都可以访问数据库，因为它始终处于打开状态。在已连接的情况下，用户必须一次又一次地进行身份验证，并在事务开始时一次又一次地打开连接，因此这会降低性能并增加工作负载，特别是在有大量事务时，但它可以保护数据库免受未经授权的各方的侵害。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-09T05:56:31.190

连接的数据需要创建连接才能访问，因此速度较慢，而断开连接的内存数据访问速度更快。

要访问连接的数据，您使用 ADO.NET，而对于断开连接的数据，您不使用。

可以从数据集中的多个表中访问断开连接的数据。connected- .NET 运行时创建数据表的一个实例来保存数据。

在断开连接的数据中，您可以以数据视图的形式为数据表创建一个窗口，用于对数据进行排序和过滤。这在连接的数据访问中无法完成

已连接您需要使用只读转发数据阅读器，断开连接则不能。

数据集中断开的数据可以被序列化/反序列化。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-11-12T04:26:28.013

asp.net 是一种服务器端技术，专为服务器处理页面请求而设计。ASP.NET 的本质需要一个连接模型。

您能否澄清“断开连接”的含义？

# iphone - UIActivityIndi catorView 的背景颜色

> ID：283032
> 
> 赞同：4
> 
> 时间：2008-11-12T04:23:50.593
> 
> 标签：iphone, cocoa-touch

我正在使用 UIActivityIndi​​catorView 向用户显示正在发生的事情，让他们等待。但是 UIActivityIndi​​catorView 看起来很小，没有背景颜色，对用户来说不是很明显。而在 iPhone SDK 的 UIImagePickerController 中，它使用了类似的机制，但使用黑色背景以及除了指示器之外的一些文本。

我想知道是否有任何现有组件可以执行该任务，或者我必须实现自己的类来执行该任务。

任何建议都非常受欢迎，在此先感谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-12T05:25:48.097

如果您只是想要 UIActivityIndi​​ctatorView 的不同背景颜色，您可以将 setBackgroundColor 消息发送到对象，即：

```
[activityIndicator setBackgroundColor:[UIColor blackColor]]; 
```

顺便说一句，您也可以更改指标的大小。只需使用更大的矩形执行 setFrame 或 initWithFrame 即可。请记住 UIActivityIndi​​catorView 继承自 UIView，因此您可以获得 UIView 的所有自定义。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-01-08T12:18:00.627

试试这个简单的方法，对我来说效果很好......

```
UIActivityIndicatorView *activityIndicator= [[UIActivityIndicatorView alloc]initWithFrame:CGRectMake(0, 0, 50, 50)];
activityIndicator.layer.cornerRadius = 05;
activityIndicator.opaque = NO;
activityIndicator.backgroundColor = [UIColor colorWithWhite:0.0f alpha:0.6f];
activityIndicator.center = self.view.center;
activityIndicator.activityIndicatorViewStyle = UIActivityIndicatorViewStyleGray;
[activityIndicator setColor:[UIColor colorWithRed:0.6 green:0.8 blue:1.0 alpha:1.0]];
[self.view addSubview: activityIndicator]; 
```

在加载视图时添加以下行

```
//-- Add this line while processing to load your view
    [activityIndicator startAnimating];

//-- Add this line when after you view loaded
    [activityIndicator stopAnimating]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T03:25:24.597

似乎我仍然需要创建一个单独的视图，因为如果我放大框架，指示器会自动放大。

谢谢。

# c# - Visual Studio/C# Windows 应用程序中的配置和程序功能

> ID：283035
> 
> 赞同：2
> 
> 时间：2008-11-12T04:24:31.777
> 
> 标签：c#, configuration, visual-studio-2005, versioning

我有一个 Windows 应用程序 (VS2005/C#)，它有两个版本，Enterprise 和 Pro。在 Pro 版本中，某些功能和菜单被禁用。目前，我通过注释掉创建企业版的禁用代码来做到这一点，然后我将每个可执行文件复制到另一个位置。显然这个过程充满了危险...... :)

我想为我的两个可执行文件有两个文件夹，Visual Studio 应该将代码以禁用专业版中的功能，并将每个文件夹放入正确的文件夹中。我有安装程序项目，可以从那里获取文件并为两个版本制作安装程序。该部分已经在工作，但我在构建安装程序之前手动将两个可执行文件复制到正确的文件夹中。所以很烂...

我想做的是这样的：

```
#ifdef PROVERSION
part1.disable();
part2.disable();
#endif 
```

这可以用 Visual Studio 吗？？？

请注意，我的总体目标是自动化创建两个安装程序的过程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T04:43:11.990

是的，那当然是可能的。默认情况下，Visual Studio 解决方案有两种配置。（发布和调试）。您可以创建其他的，如“EnterpriseDebug”和“EnterpriseRelease”只需转到（Build | Configuration Manager）下的配置管理器，然后选择 <New...>

默认情况下，配置管理器会创建一个以配置命名的文件夹，并将编译后的二进制文件放入其中。您必须手动设置条件编译符号并使用 (#if) 语句来添加/删除您的功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T04:50:16.360

从 BUILD 菜单中，选择配置管理器选项

在活动解决方案配置下拉列表中选择“新建”

创建两个新的“配置”，一个用于 PRO，一个用于 ENTERPRISE

关闭配置管理器。

打开项目属性（从项目上下文菜单中）选择构建选项卡

选择 PRO 配置（从 CONFIGURATION 下拉菜单中）

在条件编译符号文本框中输入您的编译常量“PROVERSION”。

现在您所要做的就是从主工具栏上的配置下拉菜单中选择要构建的配置，然后进行构建。

当您使用 PRO 配置构建 PRO 时，散布在您的代码中的编译器编译指示 (#IF PROVERSION) 将包含限制您的功能集的代码。

如果您想在 ENTERPRISE 构建中特别包含 ENTERPRISE 功能（而不是在 PRO 构建中禁用企业功能），您还可以考虑为 ENTERPRISE 配置设置一个 ENTERPRISE 常量

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T04:37:03.297

您可以创建一个新的[条件编译常量](http://msdn.microsoft.com/en-us/library/3dxx7dta(VS.80).aspx)并定义 PROVERSION

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T04:30:54.060

为什么不创建一个单独的程序集来根据需要启用/禁用功能？然后只需包含特定版本的适当程序集...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T04:35:27.560

您使用的是什么类型的许可方案。我已经做了一些应用程序，许可证密钥激活了功能集，所以你真的只有一个可执行文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T05:00:45.653

我会考虑让它完全动态化，这样你就不必在编译时或构建安装程序/部署包时做任何特别的事情。以下是我在商业 winforms 应用程序中的操作方式......没有什么火箭科学，但它有效：

1.  有一个许可方案/机制/标志，告诉您当前用户是获得 Pro 还是 Enterprise 许可。您甚至可以使用“试用”或“评估”选项。

2.  设置一个 CurrentUser 对象（或类似对象），告诉您当前用户的许可级别。这应该可以在整个应用程序中访问。

3.  使用[插件模型](http://www.google.com/search?q=.net+plugin+architecture+attributes)，以便特性/组件/功能是应用程序中的插件。当您的应用程序的主外壳打开时，您将插件加载到应用程序中 - 使它们以您想要的方式出现在 UI 中。

4.  研究创建[自定义属性](http://msdn.microsoft.com/en-us/library/aa288454(VS.71).aspx)来装饰代表插件的类。该属性应指示该插件/功能所需的最低许可。当插件加载器遇到新插件时，检查该插件的属性以查看需要什么级别的许可证。如果当前用户满足（或超过）该许可证，则您加载它。如果没有，你不会。

5.  如果您不能将您的功能/选项/工具分成可以轻松模块化为插件的东西，您仍然可以使用 CurrentUser 许可级别来检查。例如，假设 Pro 版本（但不是企业版）中有 100 个“小部件”的限制：

例如：

```
enum LicenseLevel {
  Eval = 0,
  Pro = 1,
  Enterprise = 2
}

// later...    

for(i=0; i < widgets.Count; i++) {
  if (i == 100 && CurrentUser.LicenseLevel < LicenseLevel.Enterprise)
    break;
  // do stuff
} 
```

希望以上的某些组合符合您的要求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T06:33:12.050

me.yahoo.com 的家伙很准。

您可以使用编译时定义创建多个配置。

您还可以更改构建输出目录。默认情况下，您可能有 bin/debug 和 bin/release。没有什么可以阻止您拥有 bin/pro 和 bin/enterprise 输出文件夹（例如）。

# c++ - 如何在 C++ 和 Lua 之间来回传递大型结构

> ID：283042
> 
> 赞同：5
> 
> 时间：2008-11-12T04:30:22.233
> 
> 标签：c++, lua

我正在考虑将 Lua 嵌入到我正在开发的 C++ 应用程序中。我的意图是使用 Lua 编写脚本，为某些给定的输入执行哪些有序操作，即。在 c++ 程序中接收一个新的工作项，将详细信息传递给 Lua 后端，Lua 回调到 c++ 中执行必要的工作，返回完成的结果。

涉及的主要数据结构是一个大型（大约 80 多个成员）`struct`。我（非常）是 Lua 新手，我不确定如何将它传入和传出我的主机应用程序和嵌入式 Lua 状态。

到目前为止，我认为我的选择是：

a) 在 C++ 和 Lua 之间交叉时，将所有单独的数据成员推入/弹出堆栈（听起来很乱）。

b）构造一个表并填充值，然后将其放入/退出堆栈（更简洁一些）。

c）将它作为`userdata`（轻/重？）传递（我对此很粗略，不确定是否/如何从Lua端访问它以查询哪些操作是必要的）。

任何指导将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T11:00:48.077

如果我没记错的话，轻量级用户数据实际上只是一个指针。它们都共享相同的元表。它们主要用于传递 C 数据的地址。
如果您必须从 Lua 端访问完整的用户数据，它可能更接近您的需要。例如，它们的元表将允许您像访问常规 Lua 表一样访问它。

您可能还对 Roberto 的[库感兴趣，该库用于在 Lua 5.1 与 C 结构之间转换数据](http://www.inf.puc-rio.br/~roberto/struct/ "用于 Lua 5.1 与 C 结构之间的数据转换库")。或不。取决于您的需求... :-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T07:33:09.463

我自己没有这样做（自从我使用 Lua 以来已经有好几年了，而且我从未以嵌入式方式使用过），但我认为您应该研究[元表](http://www.lua.org/manual/5.1/manual.html#2.8)和 userdata 类型。该手册对用户数据值进行了说明：

> 这种类型对应于一块原始内存，在 Lua 中没有预定义的操作，除了赋值和身份测试。但是，通过使用元表，程序员可以为用户数据值定义操作（参见第 2.8 节）。用户数据值不能在 Lua 中创建或修改，只能通过 C API

听起来差不多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T21:02:15.437

将整个表示暴露给 Lua 可能不是您想要的。也许你只暴露了几个操作？然后使用指向结构的指针作为轻用户数据。它不能有元表，因此您必须使用显式函数。

如果您想公开所有内容，最好的办法可能是推送仅包含指向结构的指针的完整用户数据。这意味着额外的间接级别——从性能的角度来看，会迷失在噪音中，但很容易出错，所以在跨越 C++/Lua 边界的地方保持单一的事实。

使用完整的用户数据，您可以使用宏（太可怕了！）为每个字段放置 gettter 和 setter 函数。这需要手工完成很多工作，您可能更喜欢查看 tolua++，即使它带有很多包袱。

转到 Lua 邮件列表！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-22T05:57:49.710

如果我在你那里，我会传递一个对结构的引用，然后让 Lua 调用 C 函数来修改它。这也意味着与 Lua 必须了解底层系统的所有细节相比，您可以更轻松地升级系统。

# great-circle - 如果我在这里并朝着那里前进并且我已经覆盖了这么多领域，那么我在哪里？

> ID：283045
> 
> 赞同：2
> 
> 时间：2008-11-12T04:32:30.687
> 
> 标签：great-circle, dead-reckoning

我需要帮助编写以下方法：

```
def get_new_location(current_location, target_location, distance_travelled):
    ...
    ...
    return new_location 
```

所有位置都在哪里（纬度，经度）

我意识到地球有不同的模型（WGS-84，GRS-80，...），考虑到地球是椭球体这一事实。就我的目的而言，假设一个完美的球体足够好，这种精度水平是不必要的。

**更新**

考虑到一些回应，我正在微调我的问题。

`benjismith`认为我的问题无法回答，因为地球上的点之间有不止一条最短路径。他以选票的形式得到了很多支持，所以我想我有些不明白，因为我不同意。

> 球体上任意两个位置的中点是圆弧。

我承认当两点完全相反时这是真的。我的意思是这两个点虽然都留在球体的表面上，但彼此之间的距离不能再远了。在这种情况下，有无限数量的等距路径连接两个点。然而，这是一个极端情况，而不是规则。在所有其他情况下，绝大多数情况下，只有一条最短路径。

举例说明：如果你握住一根穿过两点的绳子，并把它拉紧，绳子会不会只有一个可能的路径（除了已经讨论过的边缘情况）？

现在，在问这个问题之前，获得两点和航向之间的距离不是问题。

我想我应该问的是以下是否有效：

```
def get_new_location(current_location, target_location, percent_traveled):
    new_location.lon = (1-percent_traveled)*current_location.lon+percent_traveled*target_location.lon
    new_location.lat = (1-percent_traveled)*current_location.lat+percent_traveled*target_location.lat
    return new_location 
```

如果我沿着这条路走，我会沿着大圆、恒向线……还是完全偏离？（我现在知道这些术语是因为 Drew Hall 的回答。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T05:53:19.307

正如 BenjiSmith 所说，连接全球任何 A 和 B 的路径可能有好几条，但最流行的两条（到目前为止！）是“大圆”和“恒向线”路径。

一个大圆给出了最短的距离（通过从两点和地球中心构造一个平面并在该平面上沿着圆弧）。

恒向线保持恒定的航向，为了便于使用而交换一些距离（在高纬度地区可能是极端的）。也就是说，在船或飞机上，您只需指向所需的航向并继续前进，直到到达目的地（而大圆圈则航向不断变化）。在中纬度地区，距离惩罚不是太严重。

请注意，两种路径类型在处理对映点（球体上彼此相对的点）时都存在涉及极点和模糊性的不连续性。

* * *

要构建一个大圆，您需要将这些点转换为 3D 笛卡尔坐标（我将省略这一步，但这对于球形地球来说是微不足道的，并且对于扁地球模型（如 WGS-84）反复发现）。

> 设**a**为从地球中心指向起点的单位向量。
> 
> 设**b**为从地心指向终点的单位向量。
> 
> 设*r*为地球的半径。
> 
> 令*d*为（给定的）行驶距离。

**通过取单位向量a**和**b**的叉积来构造垂直于 GC 平面的单位向量。也就是说，让**n = axb**。

行进的（给定）距离是通过将向量 *r***a** 围绕**n**扫过某个角度*theta*形成的弧的长度。回想整个大圆的周长是 2 * pi * *r*，我们发现*theta* = *d* / *r*。

**因此，通过将 *r***a** 围绕n**旋转*theta*弧度来找到对应于新位置的笛卡尔点。将该笛卡尔点转换为纬度/经度，您就完成了。

我不会在这里推导恒向线数学，但会说墨卡托地图投影具有恒向线是直的特性。您可以使用墨卡托投影公式轻松构建恒向线，但您必须定义一些误差容限，以便将路径分成短而直的段。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T20:42:39.683

关于您更新的问题：

您似乎在做的是纬度/经度坐标的线性插值。这是一条有效的路径，但它既不是大圆也不是恒向线。事实上，由于经线会随着纬度的增加而收敛（至少在北半球），因此在纬度/经度意义上的平滑插值会导致地面上出现奇怪的加速路径。

如果您在笛卡尔坐标中描述插值，那么您至少会在正确的平面上移动，但路径会穿过地球表面（即，它将是大圆上的弦，而不是圆弧）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T16:35:48.283

这是一些应该可以解决问题的示例代码。该算法适用于所有情况，并且始终遵循两个位置之间的最短大圆路径。数学与 Drew Hall 的答案基本相同，但使用 percent_traveled 并忽略了地球的半径。

为简单起见，此代码假定纬度和经度以弧度存储。

```
`def get_new_location(current_location, target_location, percent_traveled):

    # convert locations into cartiesian co-ordinates
    current_vector = location_to_vector(current_location)
    target_vector = location_to_vector(target_location)
    # compute the angle between current_vector and target_vector
    complete_angle = acos(vector_dot_product(current_vector, target_vector))
    # determine the current partial angle, based on percent_traveled
    partial_angle = percent_traveled*complete_angle
    # compute a temporary vector to simplify calculation
    temporary_vector = vector_cross_product(current_vector, target_vector)
    temporary_vector = vector_cross_product(current_vector, temporary_vector)
    # calculate new_vector
    scalar_one = cos(partial_angle)
    scalar_two = -sin(partial_angle)/sin(complete_angle)
    vector_one = vector_multiply_by_scalar(scalar_one, current_vector)
    vector_two = vector_multiply_by_scalar(scalar_two, temporary_vector)
    new_vector = vector_sum(vector_one, vector_two)
    # convert new_vector back into latitude & longitude and return
    new_location = vector_to_location(new_vector)
    return new_location`
```

将纬度和经度转换为笛卡尔坐标的函数：

```
`def location_to_vector(location)
    vector.x = cos(location.lat)*sin(location.lon)
    vector.y = sin(location.lat)
    vector.z = cos(location.lat)*cos(location.lon)
    return vector`
```

将笛卡尔坐标转换为纬度和经度的函数：

```
`def vector_to_location(vector)
    location.lat = asin(vector.y)
    if (vector.z == 0):
        if (vector.x < 0):
            location.lon = -pi/2
        else:
            location.lon = pi/2
    else:
        if (vector.z < 0):
            if (vector.x < 0):
                location.lon = atan(vector.x/vector.z) - pi
            else:
                location.lon = pi - atan(-vector.x/vector.z)
        else:
            if (vector.x < 0):
                location.lon = -atan(-vector.x/vector.z)
            else:
                location.lon = atan(vector.x/vector.z)
    return location`
```

计算两个向量的点积的函数：

```
`def vector_dot_product(A, B):
    dot_product = A.x*B.x + A.y*B.y + A.z*B.z
    return dot_product`
```

计算两个向量的叉积的函数：

```
`def vector_cross_product(A, B):
    cross_product.x = A.y*B.z - A.z*B.y
    cross_product.y = A.z*B.x - A.x*B.z
    cross_product.z = A.x*B.y - A.y*B.x
    return cross_product`
```

将向量乘以标量的函数：

```
`def vector_multiply_by_scalar(scalar, vector)
    scaled_vector.x = scalar*vector.x
    scaled_vector.y = scalar*vector.y
    scaled_vector.z = scalar*vector.z
    return scaled_vector`
```

计算两个向量之和的函数：

```
`def vector_sum(A, B)
    sum.x = A.x + B.x
    sum.y = A.y + B.y
    sum.z = A.z + B.z
    return sum`
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-12T23:17:22.367

您更新的示例代码并不总是遵循正确的路径。

举个简单的例子，考虑太平洋中部赤道上的以下两点：

*   当前位置：纬度 = 0，经度 = -179
*   目标位置：纬度 = 0，经度 = 179

这两个点非常靠近（仅相隔两度经度），但当 percent_traveled 为 0.5 时，new_location 将是：lat = 0, lon = 0，即地球另一侧的一个点。

**编辑：它变得更糟**

考虑北半球的以下两点：

*   当前位置：纬度 = 80，经度 = 0
*   目标位置：纬度 = 80，经度 = 180

这两点之间的大圆路径直接越过北极，但 new_location 将*在*全球范围内移动，保持与赤道平行。

# asp.net - 上传文件头疼 - htmlfile: Access Denied

> ID：283055
> 
> 赞同：3
> 
> 时间：2008-11-12T04:35:09.057
> 
> 标签：asp.net, internet-explorer

我们有一个页面允许用户使用 asp:FileUpload 控件上传文件。当用户尝试提交表单时，会出现客户端 javascript 错误“htmlFile：访问被拒绝”。

这只发生在 IE 7（不确定 6）中，FF 是可以的。

显然这是由于使用 XP SP2 引入 IE 的安全设置。很公平，但是我们怎么能解决这个问题呢？并非我上传到的每个站点都这样做，因此必须有一些技巧可以很好地与 IE 配合使用。

我已经在这个 bug 上浪费了好几天了.. 准备杀死一些东西/某人 :)

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-16T20:29:31.433

Thanks guys. I managed to work back through 20 days of changesets until I found the culprit - an onload event handler on the body tag. Ive blogged about it here: [http://jonesie.net.nz/htmlFileAccessDeniedADefenceForMurder.aspx](http://jonesie.net.nz/htmlFileAccessDeniedADefenceForMurder.aspx)

Cheers

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T12:05:58.600

我发现它的唯一解决方案是编写自定义客户端 JavaScript 来验证用户没有输入/选择相对路径。[这里](http://support.microsoft.com/kb/892442)有一篇关于它的 Microsoft 知识库文章。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-15T12:00:07.327

琼斯，你在文件字段上有任何客户端验证吗？例如，您是否尝试检查该值是否为空，或者是否为某种文件类型？

如果是这样，这很可能是问题所在。如您所述，IE 更改了其安全策略，并且与该字段的某些交互被视为“窥探尝试”，此时 IE 将不允许上传。

尝试删除任何验证（这包括任何 onfocus、onblur、onchange 事件处理程序。

# oracle - PL/SQL 编译失败，没有错误消息

> ID：283061
> 
> 赞同：10
> 
> 时间：2008-11-12T04:36:47.900
> 
> 标签：oracle, plsql

我在 Oracle 9.2.0.5.0 实例上安装的 APEX 是梨形的，所有包都无效。

我尝试使用 DBMS_UTILITY.compile_schema 重新编译所有内容，但所有包仍然无效。所以，尝试重新编译单个包，

```
SQL> ALTER PACKAGE FLOWS_020000.WWV_FLOW_QUERY COMPILE BODY;

Warning: Package Body altered with compilation errors.

SQL> show err
No errors.
SQL> 
SQL> ALTER PACKAGE FLOWS_020000.WWV_FLOW_QUERY COMPILE;

Warning: Package altered with compilation errors.

SQL> show err
No errors.
SQL> 
```

更改日志中没有任何内容..

我怎样才能找到错误是什么？不应该“显示错误”给我吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2013-05-22T13:22:46.140

我知道这个答案有点晚了，但只是想让你知道你也可以使用：

```
ALTER PACKAGE your_package_name_here COMPILE PACKAGE;

ALTER PACKAGE your_package_name_here COMPILE BODY; 
```

然后如果显示警告，您可以使用以下脚本检查错误及其所在的行：

```
-- this shows the errors within the package itself

SHOW ERRORS PACKAGE your_package_name_here;

-- this shows the errors within the package body

SHOW ERRORS PACKAGE BODY your_package_name_here; 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-12T08:09:55.957

Conn 作为 FLOWS_020000 并继续：

```
SELECT *
FROM   ALL_ERRORS
WHERE  OWNER = USER; 
```

或者 conn 作为 SYSTEM 然后去

```
SELECT *
FROM   ALL_ERRORS
WHERE  OWNER = 'FLOWS_020000'; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-10T12:28:46.800

在放弃这个问题几个月后，我又回来解决了这个问题。

我试图编译的包已经被打包了。显然，您在编译打包的包时，必须以包所有者身份登录。

我怀疑这里也存在一个错误，因为一些更深入的调查显示，当编译不是所有者时，服务器进程实际上内存不足并死亡，但以包所有者身份登录允许编译对象没有问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T04:54:26.680

尝试

```
SHOW ERRORS PACKAGE BODY FLOWS_020000.WWV_FLOW_QUERY 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-12T05:25:21.483

```
SHOW ERRORS PACKAGE FLOWS_020000.WWV_FLOW_QUERY 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-20T02:12:46.590

我今天有同样的问题。我发现我在做（作为 XXX）：

```
alter package XXX.my_package compile body; 
```

它会出错，然后 a`show err`实际上不会显示任何错误。

删除“XXX”。让我看到了错误。

# c# - LINQ Distinct 运算符，忽略大小写？

> ID：283063
> 
> 赞同：110
> 
> 时间：2008-11-12T04:38:40.283
> 
> 标签：c#, linq, string, comparison, distinct

给出以下简单示例：

```
 List<string> list = new List<string>() { "One", "Two", "Three", "three", "Four", "Five" };

    CaseInsensitiveComparer ignoreCaseComparer = new CaseInsensitiveComparer();

    var distinctList = list.Distinct(ignoreCaseComparer as IEqualityComparer<string>).ToList(); 
```

看来 CaseInsensitiveComparer 实际上并未用于进行不区分大小写的比较。

换句话说， **distinctList包含与****list** 相同数量的项目。相反，我希望，例如，“三”和“三”被认为是相等的。

我是否遗漏了什么，或者这是 Distinct 运算符的问题？

* * *

## 回答 #1

> 赞同：262
> 
> 时间：2008-11-12T06:41:52.843

`StringComparer`做你需要的：

```
List<string> list = new List<string>() {
    "One", "Two", "Three", "three", "Four", "Five" };

var distinctList = list.Distinct(
    StringComparer.CurrentCultureIgnoreCase).ToList(); 
```

（或不变/有序/等，具体取决于您要比较的数据）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T06:42:22.640

[如果您想要最简洁的方法，请参阅 Marc Gravells 的回答]

经过 Bradley Grainger 的一些调查和良好反馈后，我实施了以下 IEqualityComparer。它支持不区分大小写的 Distinct() 语句（只需将 this 的一个实例传递给 Distinct 运算符）：

> ```
> class IgnoreCaseComparer : IEqualityComparer<string>
> {
>     public CaseInsensitiveComparer myComparer;
> 
>     public IgnoreCaseComparer()
>     {
>         myComparer = CaseInsensitiveComparer.DefaultInvariant;
>     }
> 
>     public IgnoreCaseComparer(CultureInfo myCulture)
>     {
>         myComparer = new CaseInsensitiveComparer(myCulture);
>     }
> 
>     #region IEqualityComparer<string> Members
> 
>     public bool Equals(string x, string y)
>     {
>         if (myComparer.Compare(x, y) == 0)
>         {
>             return true;
>         }
>         else
>         {
>             return false;
>         }
>     }
> 
>     public int GetHashCode(string obj)
>     {
>         return obj.ToLower().GetHashCode();
>     }
> 
>     #endregion
> } 
> ```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-04-28T11:11:00.210

* * *

```
 ## Distinct Operator( Ignoring Case) ##
  string[] countries = {"USA","usa","INDIA","UK","UK" };

  var result = countries.Distinct(StringComparer.OrdinalIgnoreCase);

  foreach (var v in result) 
  { 
  Console.WriteLine(v);
  } 
```

**输出将是**

```
 USA 
   INDIA
   UK 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T18:02:18.247

这是一个更简单的版本。

```
List<string> list = new List<string>() { "One", "Two", "Three", "three", "Four", "Five" };

var z = (from x in list select new { item = x.ToLower()}).Distinct();

z.Dump(); 
```

# asp.net - 为什么即使我将 EnableViewState 设置为 false 也会呈现 __VIEWSTATE 隐藏字段

> ID：283082
> 
> 赞同：7
> 
> 时间：2008-11-12T04:52:58.180
> 
> 标签：asp.net, asp.net-mvc, viewstate

即使我在页面级别设置了 EnableViewState="false"，我也看到 __VIEWSTATE 字段被渲染。如果我删除表单元素的 runat="server" 标记，则不会呈现此字段。有人可以解释一下吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-12T05:51:45.877

__VIEWSTATE 字段也用于存储控制状态，它不是可选的。此外，如果我没记错的话，视图状态中包含的信息用于验证回发（并且启用了验证，这是默认设置）。因此，只要您拥有带有 runat="server" 的表单，您就会拥有一个 viewstate 字段。但是，如果禁用所有视图状态，您应该会注意到字段大小要小得多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-07T01:23:50.177

提示：在 Asp.net 中，如果您需要完全去除 __VIEWSTATE，请覆盖 Page.Render 方法，将页面呈现为字符串，并从中去除 __VIEWSTATE 文本。

# continuous-integration - 在具有依赖关系的 Linux 和 Windows 平台上同步 CruiseControl 项目

> ID：283084
> 
> 赞同：4
> 
> 时间：2008-11-12T04:53:45.650
> 
> 标签：continuous-integration, build-automation, cruisecontrol.net, cruisecontrol

我有一个多平台应用程序集，其中一些应用程序在 Linux 上运行，一些在 Windows 上运行。我想完成以下构建：

服务器 L 运行带有项目 A 的 CruiseControl，这是一个仅限 Linux 的服务器应用程序。这应该首先建立。

如果项目 A 成功构建，它需要以某种方式启动......

项目 B，一个在服务器 W 上运行的纯 Windows 客户端应用程序，带有 CruiseControl.NET 项目 B 包括一些单元测试，这些单元测试具有在服务器数据库中生成一些数据的最终效果。项目 B 大约需要 10 分钟来构建和执行测试。

如果项目 B 构建成功，一直在耐心等待的服务器 L 将启动项目 C，其中包含一些测试用例，用于查找和验证项目 B 生成的数据库条目。

关于如何完成这项工作的任何想法？我找到[了这个链接](http://confluence.public.thoughtworks.org/display/CC/MultiplePlatforms)，但它似乎旨在在没有依赖关系的多个平台上构建相同的代码库。

当然，一定有人在某个时候这样做过？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T06:54:35.080

进行项目 A 构建是直截了当的。在发布阶段将文件写入网络驱动器。

项目 B 可以使用文件系统源代码控制块来监视网络文件系统，并根据项目 A 的更改触发构建。完成后，它将另一个文件写入文件系统（不同的目录）。

项目 C 正在使用文件系统源代码管理来监视项目 B 的更改。

一切都很简单。

如果您没有共享文件系统，您还可以使用 ftp、scp 或 http 来移动触发器文件。

如果您愿意，可以使用从项目 A 和项目 B 发布阶段调用的 Web 界面触发构建。

* * *

在评论中写下问题，您可以获得有关项目 B 失败（至少）两种不同方式的信息。

一种是在 CC 下有一个项目 B，作为远程​​项目 B 的代理。远程项目 B 将在发布阶段写入一个文件，并在文件中指示它是通过还是失败。proxy-B 项目将监视该文件，并在其“构建”阶段读取文件并根据内容通过或失败。项目 C 现在只使用 CC 的 BuildStatus 元素监视代理 B。

解决问题的另一种方法是将 CC.net 下的项目 B 替换为 CC 的 DistributedBuilder，它使用 JavaSpaces 将构建分发到远程代理：[http ://confluence.public.thoughtworks.org/display/CC/Using+distrib+from +the+CruiseControl+contrib](http://confluence.public.thoughtworks.org/display/CC/Using+distrib+from+the+CruiseControl+contrib)

在分布式方法中，项目 B 仍将在 Windows 机器上运行，但 DistributedBuilder 将远程运行脚本，然后将结果带回 CC 服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-11T13:17:22.057

你在混合 CruiseControl 和 CruiseControl.Net 吗？对于 CruiseControl.Net-only 设置，只需使用[Project Trigger](http://confluence.public.thoughtworks.org/display/CCNET/Project+Trigger)。

# php - PHP MySQL SQL 解析器（插入和更新）

> ID：283087
> 
> 赞同：11
> 
> 时间：2008-11-12T04:54:42.933
> 
> 标签：php, mysql, changelog

我正在寻找在 PHP 中解析 INSERT 和 UPDATE MySQL SQL 查询，以确定从哪些原始数据中进行了哪些更改。现在这将很容易创建，但我想看看 PHP 中是否有任何现有的库来执行此操作。

基本上我所拥有的是一个表，其中包含已在数据库上运行的所有上述查询。我已经将表名和查询类型分开了。我希望根据这些数据创建一个完整的更改日志供用户查看，因此我需要获取原始 INSERT 的值，然后在每个 UPDATE 中进行更改。最后，我需要字段名称和新值以及记录 ID。我将完成其余的检查/美化工作，包括让人类可读的列名以及字段值是否实际上没有改变。

目前，我可能不需要执行多个表 UPDATE，但它会很有用。

有哪些图书馆可以做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-12T05:20:14.583

[http://pear.php.net/package/SQL_Parser](http://pear.php.net/package/SQL_Parser)

[http://sourceforge.net/projects/txtsql](http://sourceforge.net/projects/txtsql)

[http://code.google.com/p/php-sql-parser](http://code.google.com/p/php-sql-parser)

Perl 有更多种类

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-05T21:59:33.553

有点离题，但也许值得考虑的建议：

从 MySQL 5.0 开始，对触发器的支持已经相当不错了。如果您想记录对数据库所做的更改，而不是存储 sql 语句，您还可以定义插入/更新触发器并定义另一个可以存储这些值的表。例如，您可以创建一个包含字段的简单表

```
timestamp, user, field, old_value, new_value 
```

并在您的一个监视表上发生 DML 时插入相应的值。为了进一步简化这一点，您可以添加该字段

```
table 
```

到“跟踪表”以将所有监视表的所有更改存储在一个地方。

有关此主题的更多信息，请参阅[MySQL 手册](http://dev.mysql.com/doc/refman/5.0/en/create-trigger.html "MySQL 触发器手册")。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T15:58:54.577

你可以给它一个机会： [SQL Parse and Compile](http://www.phpclasses.org/browse/package/5007.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T13:27:50.957

[Facebook 发布了他们的FQL 解析器](http://developers.facebook.com/opensource.php)的开源 PHP 版本。从我的情况来看，这是非常简洁的代码。您可能会破解它以使用常规 SQL。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-05T17:40:19.987

简而言之，我发现 PEAR:SQL_Parser 包提供了最简洁的短期解决方案，而 PEAR:PHP_Parser_Generator 包（FSQL 使用的生成器）看起来是一个非常强大的长期解决方案。

我发现 txtSQL 不够健壮，并且没有很好地解析 SQL 以保证使用，至少在我看来是这样。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-25T00:09:08.647

你可以试试： [dqml2tree sql(dql and dml) 用php编写的查询解析器](http://www.phpclasses.org/browse/package/4916.html "dqml2tree sql(dql and dml) 用php编写的查询解析器")

# iphone - iphone中是否有弹出编辑器功能？

> ID：283090
> 
> 赞同：2
> 
> 时间：2008-11-12T04:56:57.517
> 
> 标签：iphone, cocoa-touch

我想弹出一个带有编辑框的简单对话框，让用户输入一些值然后返回。我想知道 iPhone SDK 是否有这种支持。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T01:54:41.113

我在以下位置找到了解决方案： [http ://www.iphonedevsdk.com/forum/iphone-sdk-development/1704-uitextfield-inside-uialertview.html](http://www.iphonedevsdk.com/forum/iphone-sdk-development/1704-uitextfield-inside-uialertview.html)

这是对我有用的代码。

```
UIAlertView *myAlertView = [[UIAlertView alloc] initWithTitle:@"Your title here" message:@"this gets covered" delegate:self cancelButtonTitle:@"Cancel" otherButtonTitles:@"OK", nil];
UITextField *myTextField = [[UITextField alloc] initWithFrame:CGRectMake(12.0, 45.0, 260.0, 25.0)];

CGAffineTransform myTransform = CGAffineTransformMakeTranslation(0.0, 130.0);
[myAlertView setTransform:myTransform];

[myTextField setBackgroundColor:[UIColor whiteColor]];
[myAlertView addSubview:myTextField];
[myAlertView show];
[myAlertView release]; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-12T06:47:26.060

您需要创建弹出窗口 (UIAlertView) 并向其添加 UITextField（或您想要使用的任何组件）作为子视图。UIAlertView 不会为您添加的组件自动调整大小，因此您必须通过向其中添加文本来破解它的那一部分。文本将增加弹出窗口的高度，前提是您不要添加太多被组件隐藏的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-08T22:03:46.210

将此函数添加到您的代码中，在显示警报之前调用它。

*   (void)willPresentAlertView:(UIAlertView *)alertView { alertView.frame = CGRectMake( x, y, width, heigth ); }

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T19:01:19.193

调整 UIAlertView 大小的提示...

正如 Milen Milkovski 上面/下面所写，如果你为 UIAlertView 设置了一个委托：

```
UIAlertView* theAlert = [[UIAlertView alloc] initWithTitle:@"Lah"
                                                   message:@"dee dah"
                                                  delegate:self
                                         cancelButtonTitle:nil
                                         otherButtonTitles:nil];
//NSLog(@"Pre Show: alert frame x,y: %f,%f, alert frame width,height: %f,%f",  theAlert.frame.origin.x,theAlert.frame.origin.y, theAlert.frame.size.width, theAlert.frame.size.height);
[retrievingListAlert show]; 
```

然后，您可以通过定义以下 UIAlertView 回调来修改 UIAlertView 的框架（在委托类中——在这种情况下，因为我们使用了 self，与创建 UIAlertView 的类相同）：

```
(void)willPresentAlertView:(UIAlertView *)alertView {
    //NSLog(@"willPresentAlertView: alert frame midx,midy: %f,%f, alert frame width,height: %f,%f",  alertView.frame.origin.x, alertView.frame.origin.y, alertView.frame.size.width, alertView.frame.size.height);
    alertView.frame = CGRectMake( x, y, width, heigth ); 
} 
```

我发现在其他时间设置框架不起作用。看来 show 函数修改了框架，大概是在自动调整其内容的同时。

# jruby - 在升级之间保留 JRuby gem

> ID：283095
> 
> 赞同：2
> 
> 时间：2008-11-12T05:00:07.697
> 
> 标签：jruby, gem

在安装 JRuby 的频繁升级之一时，我需要重新安装我的 gem，因为它们通常位于 jruby 安装目录中。

我知道不必这样。有人可以发布一些说明或指向如何避免这种情况的网页吗？

请记住，我不想与 C-Ruby 安装共享 gem。只需在 JRuby 安装之间共享。

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T04:41:06.543

1.  添加目录树`<your preferred location>/jrubygems/lib/ruby/gems/1.8`
2.  添加目录树`<your preferred location>/lib/ruby`
3.  添加目录树`<your preferred location>/lib/site_ruby/1.8`

添加到您的 .bashrc：

`export GEM_HOME=<your preferred location>/jrubygems/lib/ruby/gems/1.8`

`export RUBYLIB=<your preferred location>/lib/ruby:<your preferred location>/lib/site_ruby/1.8`

# iphone - 以编程方式访问/添加/更改联系人的铃声

> ID：283099
> 
> 赞同：1
> 
> 时间：2008-11-12T05:04:30.123
> 
> 标签：iphone

使用 iPhone SDK 是否有办法以编程方式访问（读/写）分配给通讯簿中联系人的铃声？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T18:17:37.977

不，没有任何官方 API 允许您这样做。如果您认为应该包含此功能，则应向 Apple 提交功能请求。[https://bugreport.apple.com](https://bugreport.apple.com)

# c# - Linq to SQL 外键

> ID：283103
> 
> 赞同：2
> 
> 时间：2008-11-12T05:07:13.220
> 
> 标签：c#, sql, visual-studio-2008, linq-to-sql

数据库表的 DDL：

```
 Users:
    id - int - identity
    name - varchar - unique

    PCs:
    id - int - idnetity
    name - varchar - unique
    userid - FK to Users

    Apps:
    id - int - identity
    name - varchar
    pcid - FK to PCs 
```

我使用 Visual Studio 2008 中的 Linq To SQL 设计器创建了一个 DataContext。

我想执行这个查询：

```
select
  users.name,
  pcs.name,
  apps.name
from
  users u
  join pcs p on p.userid = u.id
  join apps a on a.pcid = p.id 
```

我在另一个帖子中被告知我发布了一个答案，以下内容不正确并且它创建了一个交叉连接。

```
var query = from u in db.Users // gets all users
        from p in u.PCs // gets all pcs for user
        from a in p.Apps // gets all apps for pc
        select new
        {
            username = u.Name,
            pcname = p.Name,
            appname = a.Name
        }; 
```

当我执行这个查询时，我得到了正确的结果。每个表中有两条记录的交叉连接应该返回 8 条记录，但我的查询正确地返回了两条记录。

我是幸运的，还是那个人告诉我我错了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T06:10:05.450

那可行。这是正常的，因为第二个“from”查询的是PC的用户集合，第三个“from”查询的是PC的Apps集合。而且我猜这不会像 T-Sql 那样生成交叉连接，因为条件已经在外键和关联中定义。

但我想这应该是你想要的内部连接的语法；

```
var query = from u in db.Users
            join p in db.PCs on p.UserId == u.Id
            join a in db.Apps on a.PCId == p.Id
            select new
            {
                username = u.Name,
                pcname = p.Name,
                appname = a.Name
            }; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T12:04:21.710

Jason - 我错过了您使用内置 Linq 到 SQL 关系的事实。很抱歉对于这个误会; 在正常情况下，您在这里提出的建议可以正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T05:09:41.983

对我来说看起来不错，我不确定为什么会创建交叉连接

# asp.net - Asp.net 2008 速成书推荐

> ID：283107
> 
> 赞同：0
> 
> 时间：2008-11-12T05:08:42.343
> 
> 标签：asp.net

## 要求

*   实际的
*   Asp.net 上的 Asp.net 2008 Express
*   环境视角

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T13:24:34.440

由于 Visual Web Developer 2008 EE 实际上只是 Visual Studio 的一个子集，我认为没有任何书籍只关注快速版本。即使作者假设您拥有 VS 2005 或 2008，您阅读的大多数初学者/中级书籍都将与快速版本相关。也就是说，如果您真的想要一些具有快速版本的东西，我认为[learnvisualstudio.net](http://www.learnvisualstudio.net/)是入门级指导的方法。祝你好运！

# sql-server - 在 select 语句中为数据列分配默认值

> ID：283120
> 
> 赞同：6
> 
> 时间：2008-11-12T05:27:47.953
> 
> 标签：sql-server, tsql, syntax

我想为我的 select sql 查询中的一列分配默认值，以便如果该列的值为空，我会在我的记录集中获得该默认值。有没有办法做到这一点？

例子：

```
select col1 (some default value) from tblname; 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-12T06:01:49.787

最好的方法是使用 ANSI 兼容函数[COALESCE](http://msdn.microsoft.com/en-us/library/ms190349.aspx)：

```
SELECT COALESCE(column_name, default_value) FROM table_name; 
```

您还可以阅读比较 COALESCE 和[ISNULL](http://msdn.microsoft.com/ru-ru/library/ms184325.aspx)[的文章](http://databases.aspfaq.com/database/coalesce-vs-isnull-sql.html)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-12T05:38:39.290

```
select
  isnull(col1, defaultvalue)
from
  tblname; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T05:44:12.413

如果您使用的是 SqlServer，则可以使用 CASE 语句

例子：

选择 case col1 当 null 然后 defaultval else col1 end from tblname

其中 defaultval 是默认值。defaultval 的数据类型必须与 col1 的数据类型相同。

# c# - 如何将 ctrl+c 发送到 c# 中的进程？

> ID：283128
> 
> 赞同：44
> 
> 时间：2008-11-12T05:38:15.467
> 
> 标签：c#, command-line, .net-2.0, process

我正在为命令行可执行文件编写一个包装类。这个 exe 接受输入，`stdin`直到我进入`Ctrl+C`命令提示符 shell，在这种情况下，它会`stdout`根据输入打印输出。我想`Ctrl+C`在 C# 代码中模拟该按下，将 kill 命令发送到 .NET`Process`对象。我试过打电话`Process.Kill()`，但这似乎没有给我任何过程中的`StandardOutput` `StreamReader`. 可能有什么我做的不对吗？这是我尝试使用的代码：

```
ProcessStartInfo info = new ProcessStartInfo(exe, args);
info.RedirectStandardError = true;
info.RedirectStandardInput = true;
info.RedirectStandardOutput = true;
info.UseShellExecute = false;
Process p = Process.Start(info);

p.StandardInput.AutoFlush = true;
p.StandardInput.WriteLine(scriptcode);

p.Kill();

string error = p.StandardError.ReadToEnd();
if (!String.IsNullOrEmpty(error)) 
{
    throw new Exception(error);
}
string output = p.StandardOutput.ReadToEnd(); 
```

输出始终为空，即使我从`stdout`手动运行 exe 时获取数据。

**编辑**：顺便说一句，这是 C# 2.0。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2015-03-26T08:48:58.603

尽管使用`GenerateConsoleCtrlEvent()`for 发送`Ctrl`+`C`信号是正确的答案，但需要大量澄清才能使其在不同的 .NET 应用程序类型中工作。

如果您的 .NET 应用程序不使用自己的控制台（Windows Forms/WPF/Windows Service/ASP.NET），则基本流程是：

1.  将主 .NET 进程附加到要使用`Ctrl`+发出信号的进程的控制台`C`。
2.  通过禁用对信号的处理，防止主 .NET 进程因`Ctrl`+`C`事件而停止`SetConsoleCtrlHandler()`。
3.  *为当前*控制台生成控制台事件`GenerateConsoleCtrlEvent()`（`processGroupId`应该为零！发送代码的答案`p.SessionId`将不起作用并且不正确）。
4.  等待发出信号的进程响应（例如，等待它退出）
5.  通过主进程恢复`Ctrl`+`C`处理并断开与控制台的连接。

以下代码片段说明了如何做到这一点：

```
Process p;
if (AttachConsole((uint)p.Id)) {
    SetConsoleCtrlHandler(null, true);
    try { 
        if (!GenerateConsoleCtrlEvent(CTRL_C_EVENT,p.SessionId))
            return false;
        p.WaitForExit();
    } finally {
        SetConsoleCtrlHandler(null, false);
        FreeConsole();
    }
    return true;
} 
```

其中`SetConsoleCtrlHandler()`、`FreeConsole()`和是本`AttachConsole()`机`GenerateConsoleCtrlEvent()`WinAPI 方法：

```
internal const int CTRL_C_EVENT = 0;
[DllImport("kernel32.dll")]
internal static extern bool GenerateConsoleCtrlEvent(uint dwCtrlEvent, uint dwProcessGroupId);
[DllImport("kernel32.dll", SetLastError = true)]
internal static extern bool AttachConsole(uint dwProcessId);
[DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]
internal static extern bool FreeConsole();
[DllImport("kernel32.dll")]
static extern bool SetConsoleCtrlHandler(ConsoleCtrlDelegate HandlerRoutine, bool Add);
// Delegate type to be used as the Handler Routine for SCCH
delegate Boolean ConsoleCtrlDelegate(uint CtrlType); 
```

请注意，等待目标进程响应（通常是等待进程退出）是至关重要的。否则，`Ctrl`+`C`信号将保留在当前进程的输入队列中，当第二次调用恢复处理时`SetConsoleCtrlHandler()`，该信号将终止*当前*进程，而不是目标进程。

如果您需要从 .NET 控制台应用程序发送`Ctrl`+ ，事情会变得更加复杂。`C`上述方法将不起作用，因为在这种情况下`AttachConsole()`返回`false`（主控制台应用程序已经有一个控制台）。可以先调用`FreeConsole()`再`AttachConsole()`调用，但这样做会导致原始 .NET 应用程序控制台丢失，这在大多数情况下是不可接受的。

这是我对这种情况的解决方案；它可以工作并且对 .NET 主进程控制台没有副作用：

1.  创建小型支持 .NET 控制台程序，该程序接受来自命令行参数的进程 ID，在调用`FreeConsole()`之前丢失自己的控制台，并使用上述代码将+发送到目标进程。`AttachConsole()``Ctrl``C`
2.  主 .NET 控制台进程只是在需要向另一个控制台进程发送`Ctrl`+时在新进程中调用此实用程序。`C`

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-11-12T19:27:34.873

其实我刚刚想出了答案。谢谢你们的回答，但事实证明我所要做的就是：

```
p.StandardInput.Close() 
```

这导致我生成的程序完成从标准输入的读取并输出我需要的内容。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-11-12T08:51:14.220

@alonl：用户正在尝试包装命令行程序。命令行程序没有消息泵，除非它们是专门创建的，即使是这种情况，`Ctrl`+`C`在 Windows 环境应用程序（默认情况下为副本）中的语义与它在命令中的语义不同-line 环境（中断）。

我把这个扔在一起了。CtrlCClient.exe 只是调用`Console.ReadLine()`并等待：

```
static void Main(string[] args)
{
    ProcessStartInfo psi = new ProcessStartInfo("CtrlCClient.exe");
    psi.RedirectStandardInput = true;
    psi.RedirectStandardOutput = true;
    psi.RedirectStandardError = true;
    psi.UseShellExecute = false;
    Process proc = Process.Start(psi);
    Console.WriteLine("{0} is active: {1}", proc.Id, !proc.HasExited);
    proc.StandardInput.WriteLine("\x3");
    Console.WriteLine(proc.StandardOutput.ReadToEnd());
    Console.WriteLine("{0} is active: {1}", proc.Id, !proc.HasExited);
    Console.ReadLine();
} 
```

我的输出似乎做你想要的：

> ```
> 4080 is active: True
> 4080 is active: False 
> ```

希望有帮助！

（澄清一下：`\x3`是十六进制字符 3 的十六进制转义序列，即`Ctrl`+ `C`。它不仅仅是一个幻数。;））

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-09-06T17:21:04.627

好的，这是一个解决方案。

发送`Ctrl`-`C`信号的方法是使用 GenerateConsoleCtrlEvent。但是，此调用采用 processGroupdID 参数，并将`Ctrl`-`C`信号发送到组中的所有进程。如果不是因为没有办法在 .net 中生成与您（父级）不同的进程组中的子进程，这将很好。因此，当您发送 GenerateConsoleCtrlEvent 时，两个子进程你（家长）明白了。因此，您还需要在父级中捕获`Ctrl`-`C`事件，然后确定是否需要忽略它。

就我而言，我希望父进程也能够处理事件`Ctrl`，`C`因此我需要区分用户在控制台上发送的事件和父进程发送给子进程的事件`Ctrl`。`C`我只是通过在将 - 发送给孩子时粗暴地设置/取消设置布尔标志来做到这一点`Ctrl`，然后在父母的-事件处理程序`C`中检查这个标志（即，如果发送-给孩子，则忽略。）`Ctrl``C``Ctrl``C`

所以，代码看起来像这样：

```
//import in the declaration for GenerateConsoleCtrlEvent
[DllImport("kernel32.dll", SetLastError=true)]  
static extern bool GenerateConsoleCtrlEvent(ConsoleCtrlEvent sigevent, int dwProcessGroupId);
public enum ConsoleCtrlEvent  
{  
    CTRL_C = 0,  
    CTRL_BREAK = 1,  
    CTRL_CLOSE = 2,  
    CTRL_LOGOFF = 5,  
    CTRL_SHUTDOWN = 6  
}

//set up the parents CtrlC event handler, so we can ignore the event while sending to the child
public static volatile bool SENDING_CTRL_C_TO_CHILD = false;
static void Console_CancelKeyPress(object sender, ConsoleCancelEventArgs e)
{
    e.Cancel = SENDING_CTRL_C_TO_CHILD;
}

//the main method..
static int Main(string[] args)
{
    //hook up the event handler in the parent
    Console.CancelKeyPress += new ConsoleCancelEventHandler(Console_CancelKeyPress);

    //spawn some child process
    System.Diagnostics.ProcessStartInfo psi = new System.Diagnostics.ProcessStartInfo();
    psi.Arguments = "childProcess.exe";
    Process p = new Process();
    p.StartInfo = psi;
    p.Start();

    //sned the ctrl-c to the process group (the parent will get it too!)
    SENDING_CTRL_C_TO_CHILD = true;
    GenerateConsoleCtrlEvent(ConsoleCtrlEvent.CTRL_C, p.SessionId);        
    p.WaitForExit();
    SENDING_CTRL_C_TO_CHILD = false;

    //note that the ctrl-c event will get called on the parent on background thread
    //so you need to be sure the parent has handled and checked SENDING_CTRL_C_TO_CHILD
    already before setting it to false. 1000 ways to do this, obviously.

    //get out....
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-11-16T12:06:38.697

FWIW，在我的情况下，我想要的是，从控制台进程创建一个子控制台进程（ffmpeg.exe）并支持清理`CTRL`-`C`在我的进程和子进程中处理（ffmpreg在按下`CTRL`时正常退出`C`这是我想继续工作的一个很好的功能）

我在这里找到的解决方案都没有工作，所以我只是互操作了 Windows 的[CreateProcess 函数](https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessw)，它无需任何努力即可工作，`CTRL`-`C`由子应用程序和父应用程序自动接收，输入和输出流是共享的等。我无法使用标准的 .NET Process 类重现这种代码：

```
 static void RunFFMpeg(string arguments)
    {
        var startup = new STARTUPINFO();
        startup.cb = Marshal.SizeOf<STARTUPINFO>();
        if (!CreateProcess(null, "ffmpeg.exe " + arguments, IntPtr.Zero, IntPtr.Zero, false, 0, IntPtr.Zero, null, ref startup, out var info))
            throw new Win32Exception(Marshal.GetLastWin32Error());

        CloseHandle(info.hProcess);
        CloseHandle(info.hThread);

        var process = Process.GetProcessById(info.dwProcessId);
        Console.CancelKeyPress += (s, e) =>
        {
            process.WaitForExit();
            Console.WriteLine("Abort.");
            // end of program is here
        };

        process.WaitForExit();
        Console.WriteLine("Exit.");
    }

    [StructLayout(LayoutKind.Sequential)]
    private struct PROCESS_INFORMATION
    {
        public IntPtr hProcess;
        public IntPtr hThread;
        public int dwProcessId;
        public int dwThreadId;
    }

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    private struct STARTUPINFO
    {
        public int cb;
        public string lpReserved;
        public string lpDesktop;
        public string lpTitle;
        public int dwX;
        public int dwY;
        public int dwXSize;
        public int dwYSize;
        public int dwXCountChars;
        public int dwYCountChars;
        public int dwFillAttribute;
        public int dwFlags;
        public short wShowWindow;
        public short cbReserved2;
        public IntPtr lpReserved2;
        public IntPtr hStdInput;
        public IntPtr hStdOutput;
        public IntPtr hStdError;
    }

    [DllImport("kernel32")]
    private static extern bool CloseHandle(IntPtr hObject);

    [DllImport("kernel32", SetLastError = true, CharSet = CharSet.Unicode)]
    private static extern bool CreateProcess(
       string lpApplicationName,
       string lpCommandLine,
       IntPtr lpProcessAttributes,
       IntPtr lpThreadAttributes,
       bool bInheritHandles,
       int dwCreationFlags,
       IntPtr lpEnvironment,
       string lpCurrentDirectory,
       ref STARTUPINFO lpStartupInfo,
       out PROCESS_INFORMATION lpProcessInformation); 
```

* * *

## 回答 #6

> 赞同：-6
> 
> 时间：2008-11-12T05:50:26.940

尝试实际发送组合键 Ctrl+C，而不是直接终止进程：

```
 [DllImport("user32.dll")]
        public static extern int SendMessage(
              int hWnd,      // handle to destination window
              uint Msg,       // message
              long wParam,  // first message parameter
              long lParam   // second message parameter
              ); 
```

在 MSDN 上查找，您应该可以找到发送 Ctrl+Key 组合所需的内容...我知道发送 Alt+Key 所需的消息是 WM_SYSTEMKEYDOWN 和 WM_SYSTEMKEYUP，无法告诉您有关 Ctrl 的信息...

# c# - 滚动条打开 ?

> ID：283131
> 
> 赞同：2
> 
> 时间：2008-11-12T05:40:43.153
> 
> 标签：c#, .net

任何人都可以帮我放置一个垂直滚动条`<asp:CheckBoxList>`吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T05:42:23.977

[http://bytes.com/forum/thread298532.html](http://bytes.com/forum/thread298532.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T05:47:08.460

我试过这样

`<div style="height:100px;overflow:auto;"> <asp:CheckBoxList></asp:CheckBoxList> </div>`

结果成功了..!! 非常感谢。！:)

# sql - 多平台 SQL 查询验证器

> ID：283135
> 
> 赞同：3
> 
> 时间：2008-11-12T05:47:26.510
> 
> 标签：sql, validation

有谁知道可以验证给定 SQL 语句在不同数据库（oracle、db2、mssql）中是否有效的工具？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T07:12:05.667

老实说，我认为你最好的选择是编写你自己的简单测试工具来连接到各种测试数据库（我假设你有一个每种风格的数据库以便进行测试），执行您的语句并验证响应。在这方面，它还可以作为对所有数据库代码进行单元测试的一种方式。我认为您可以在大约 20 分钟内将您选择的语言拼凑在一起，这可能就是为什么还没有工具可以做到这一点的原因。

# robustness - 稳健性的最佳实践

> ID：283141
> 
> 赞同：10
> 
> 时间：2008-11-12T05:56:42.450
> 
> 标签：robustness

我刚刚遇到了[这个](https://stackoverflow.com/questions/139686/should-local-variable-initialisation-be-mandatory#283127)关于初始化局部变量的问题。许多答案都在讨论简单性/可读性*与*鲁棒性。作为（远程部署的）嵌入式系统的开发人员，我总是喜欢健壮性并且倾向于遵循几个看似相互矛盾的规则：

*   以允许设备继续运行的方式，尽最大努力处理每个错误。

*   将代码设计为在发生编程或致命错误后*尽快*失败。

我们都接受过验证输入的培训，以防止设备因用户（或其他外部）输入而损坏；始终假设数据可能无效并相应地对其进行测试。

**您还遵循哪些其他*具体*做法来确保稳健性？** 示例很有帮助，但我也对普遍适用的*技术感兴趣。*

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-12T06:07:25.097

我是“[实用程序员](http://www.pragprog.com/the-pragmatic-programmer/extracts/tips)”中描述的技术的粉丝。我也使用[TDD](http://en.wikipedia.org/wiki/Test-driven_development)，而不是 DBC，因为我发现它更灵活、更高效。例如，“pragprog”中描述的一些技术包括：

*   经常测试。尽早测试。自动测试
*   不要重复自己
*   使用破坏者来测试你的测试
*   对异常问题使用异常
*   不要和破窗户一起生活
*   不要使用手动程序

它们似乎都是常识，但令人惊讶的是，团队在面对最后期限时偏离这些基本原则的速度之快。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-12T14:08:57.107

我喜欢*第二种*方法：在我编写并测试了一些关键代码之后，我有时会要求同事专门审查它，以寻找破解它的方法。

以这种方式激发人们的创造力很有趣。:-)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-12T06:39:26.140

听起来您已经掌握了这两个：
快速失败。[http://en.wikipedia.org/wiki/Fail-fast](http://en.wikipedia.org/wiki/Fail-fast)
Fail Safe。[http://en.wikipedia.org/wiki/Fail-safe](http://en.wikipedia.org/wiki/Fail-safe)

这三个可能比任何其他都更适合我：

尽可能避免状态。创建和使用不可变对象——它们更容易测试并且不太可能背叛你。

不要编写不必要的代码。这个很难。查看最近大量关于Strunk 和 White的“ *The Elements of Style ”与编程相关的文章。*

每 10 分钟左右问问自己：“这很愚蠢吗？” 说实话。这个更难。

-杰森

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T06:04:58.050

我尽量使用[契约式设计](http://en.wikipedia.org/wiki/Design_By_Contract)。但我发现这在我的工作领域很少实用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-12T06:12:29.767

我喜欢*不*初始化局部变量。它们应该在需要时设置。否则，阅读您的代码的程序员可能会像在`"hmm why is this 0 at the beginning..."`. 如果你不初始化它，很明显它还没有被使用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-12T06:21:54.427

我实施了多种方法来防止错误并从错误中恢复：

1）处理所有异常。正如您所说，“处理每个错误”。如果用户单击表单上的按钮，则应用程序应该不可能从未处理的异常中消失（“噗”）。出于这个原因，我用一个通用的 try catch 包装了事件处理程序。

2) 使用完整的堆栈跟踪记录错误。当我重新抛出异常时，我总是创建一个新异常并将捕获的异常添加为内部异常。我的日志记录代码递归地解包消息，这提供了比其他方式更多的细节。

3) 决定你的类是否可以重用。如果不记录它。考虑在你的代码中实现一个接口，比如`IRestartable`or `IReusable`。任何没有实现它的对象都必须在使用一次后丢弃。

4) 永远不要假设线程安全。我已经了解到 .NET 是极其多线程的。许多事件在任意线程上处理。用 .NET 编写的给定应用程序可以同时执行许多线程，并且没有一行代码显式创建一个。

5）保持变量范围尽可能窄。在使用对象的位置附近实例化对象，而不是在方法开头的大块中实例化对象。您可能会缩短对象的寿命，并且您不会忘记位于类或方法顶部的巨大块中的不需要或重用的变量。

5）简单，但我仍然看到它发生。避免像瘟疫这样的全局变量。我见过包含数百个未使用/重用变量的代码。弄清楚和重构是一团糟。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-12T06:48:58.320

我喜欢...**[在 (java)doc 中](https://stackoverflow.com/questions/61604)****记录**限制值。（参数可以为空吗？为空？）

这样，当我的代码被使用时（或者当我使用我自己的代码时），我知道我可以期待什么。简单的建议，但很少实施；）

[该文档还包括对静态异常和运行时异常](https://stackoverflow.com/questions/242587#242596)的明确区分。这样，如果程序必须尽快失败以提高健壮性，我知道它是否由于可预见的异常（静态，必须在编码时通过捕获或重新抛出处理）而失败，或者如果这是因为参数不正确（运行时异常，仅在应用程序生命周期内检测到）。

如果两种类型的异常都被清楚地记录下来（尤其是在参数的限制值方面），那么整体的稳健性就更容易实施。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-12T20:42:46.467

如果可能的话，我会询问专门从事其他事情的人的意见。这通常会揭示一种或多种全新的破坏方式。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-12T20:48:40.887

偏执是程序员的生存特征。不断问自己这怎么会失败？然后试着弄清楚如何防止这种失败。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-03-17T10:17:02.420

我编写的系统（用 C 语言）对性能和可靠性有很高的要求。为失败而设计很好。当涉及到安全设计时，事情变得更加复杂。

硬件总是会发生故障，除此之外，您还会遇到从外部进入系统的无效数据的问题。我在这些领域的解决方案通常是精心设计的（为安全而设计），而在几乎所有其他领域的设计中，基本上都是通过极其简单的代码和根本没有数据验证来设计失败的。

所以你可以说我在风险小的时候为失败而设计，在风险高的时候为安全而设计。

对于调试，我有时会编写不应该输入的条件代码，其中包含除以零或一些这样的内容，这样当处理进入那里时，调试器将立即被调用。

我通常不会初始化本地堆栈变量，因为编译器会告诉我哪些需要初始化，哪些可以完全省略。

代码审查很棒，但并非万无一失。我曾经花了几个小时查看一个小的（无限的）循环（很尴尬，不是吗？）并且看不到索引没有增加。我的同事也没有看到。当我最终查看生成的代码清单时，我看到循环测试已被优化为单个无条件跳转，然后我才明白问题出在哪里。

# vb6 - 预期的 Vb 编译错误：列表分隔符或）

> ID：283142
> 
> 赞同：1
> 
> 时间：2008-11-12T05:56:45.990
> 
> 标签：vb6

代码行是：

```
BreakDown(Full As String, FName As String, PName As String, Ext As String) As Integer 
```

这是从教程中获取的，所以不确定我做错了什么：/

如果不明显，那是一个新功能

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T06:00:01.790

根据我正在阅读的内容，代码行是：

```
BreakDown(Full As String, FName As String, PName As String, Ext As String) As Integer 
```

那应该是：

```
Function BreakDown(Full As String, FName As String, PName As String, Ext As String) As Integer 
```

也许在单词前加上修饰语`Function`，例如`Private`or `Public`。功能代码完成后，请确保您也有这一行：

```
End Function 
```

# visual-studio-2010 - 我可以在 C# 4 中实现 method_missing 并让它实际返回一个值吗？

> ID：283143
> 
> 赞同：4
> 
> 时间：2008-11-12T05:57:46.020
> 
> 标签：visual-studio-2010, c#-4.0, dynamic-language-runtime, idynamicobject

我试图根据 IDynamicObject 上浮动的所有 2 篇博客文章来弄清楚如何在 C# 4 中实现 method_missing。

我想要做的是有一个具有存储库的业务逻辑层，如果业务逻辑层缺少该方法，只需调用存储库并传递其结果。所以我有一个看起来像这样的类：

```
public class CustomerServices : IDynamicObject
{
    protected CustomerRepository _Repository = new CustomerRepository();

    MetaObject IDynamicObject.GetMetaObject(Expression parameter)
    {                      
        return new RepositoryMetaObject<CustomerRepository>(_Repository, parameter);                        
    }
} 
```

在 RepositoryMetaObect 中，我实现了 Call 方法，如下所示：

```
 public override MetaObject Call(CallAction action, MetaObject[] args)
    {
        typeof(T).GetMethod(action.Name).Invoke(_Repository, getParameterArray(args));
        return this;            
    } 
```

（RepositoryMetaObject 的其余代码可能并不有趣，但我已将其包含在此处： http: [//pastie.org/312842](http://pastie.org/312842)）

我认为的问题是我从来没有对调用的结果做任何事情，我只是返回 MetaObject 本身。

现在当我这样做时：

```
 dynamic service = new CustomerServices();
        var myCustomer = service.GetByID(1); 
```

调用 GetByID，但如果我尝试访问 myCustomer 上的属性，则只是挂起。

有人可以帮忙吗？

完整代码可以在ehre下载：[https ://dl.getdropbox.com/u/277640/BusinessLogicLayer.zip](https://dl.getdropbox.com/u/277640/BusinessLogicLayer.zip)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T06:58:09.377

我相信您需要返回一个新的 MetaObject，并将返回值作为常量表达式。

[这肯定是在这个 CodeProject 页面](http://www.codeproject.com/KB/cs/moemeka.aspx?display=Print)上发生的事情。值得一试 ：）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T19:04:35.853

代替

```
return this; 
```

尝试做这样的事情

```
return RepositoryMetaObject<CustomerRepository>(
       _Repository
     , System.Linq.Expressions.Expression.Constant(returnValue, returnValueType)
); 
```

（仍然不确定为什么，但它对我有用）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T03:53:26.630

> 但如果我尝试访问 myCustomer 上的属性，就会挂起

能否在 service.GetByID(1) 之后的行上设置断点？看看你从那个电话中真正得到了什么。否则很难说到底发生了什么。

# .net - 如何防止 Visual Studio 在调试时启动 WcfSvcHost.exe？

> ID：283145
> 
> 赞同：32
> 
> 时间：2008-11-12T05:59:19.513
> 
> 标签：.net, wcf, visual-studio, visual-studio-debugging

我在 Visual Studio 2008 中有一个解决方案，它有多个项目。其中一个项目是 WCF 项目。有时我只想调试其他项目，但是当我按 F5 时，Visual Studio 已启动 wcfsvchost.exe 来托管 WCF 项目，即使它不是“启动项目”。

目前，每次调试其他项目时，我都必须卸载 WCF 项目，以防止弹出烦人的 WcfSvcHost.exe 主机。但是，这并不方便。有人知道防止 WCF 项目以调试模式托管的更好主意吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-11-12T12:30:35.870

转到 WCF 项目属性页中的 WCF 选项部分，然后取消选中“在同一解决方案中调试另一个项目时启动 WCF 服务主机”复选框。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-09-16T19:42:49.953

如果你已经创建了 WCF 项目，然后将其更改为控制台项目，并且发现 WCF 服务主机仍在启动中，则编辑该项目并编辑 ProjectTypeGuids 以删除 WCF 项目类型：

老的：

```
<ProjectTypeGuids>{3D9AD99F-2412-4246-B90B-4EAA41C64699};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids> 
```

新的：

```
<ProjectTypeGuids>{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-12T06:29:12.463

您可以尝试在解决方案中卸载 WCF 项目，然后进行调试。

抱歉，我误读了最后一部分来快速，那么我知道的唯一另一种方法是注释掉项目属性组中的 Web 部件。这阻止了我的弹出窗口

卸载项目，注释掉提到的部分，重新​​加载。

```
<!--<PublishUrl>http://localhost/WindowsFormsApplication1/</PublishUrl>
<Install>true</Install>
<InstallFrom>Web</InstallFrom>
<UpdateEnabled>true</UpdateEnabled>
<UpdateMode>Foreground</UpdateMode>
<UpdateInterval>7</UpdateInterval>
<UpdateIntervalUnits>Days</UpdateIntervalUnits>
<UpdatePeriodically>false</UpdatePeriodically>
<UpdateRequired>false</UpdateRequired>
<MapFileExtensions>true</MapFileExtensions>
<ApplicationRevision>0</ApplicationRevision>
<ApplicationVersion>1.0.0.%2a</ApplicationVersion>
<IsWebBootstrapper>true</IsWebBootstrapper>
<UseApplicationTrust>false</UseApplicationTrust>
<BootstrapperEnabled>true</BootstrapperEnabled>--> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T20:58:29.893

不确定这是否能解决您的问题，但如果您在解决方案资源管理器中单击 WCF 项目，请查看它是否具有“调试时始终启动”属性。如果是，请将其设置为 false。不过，该属性仅针对某些项目类型显示，因此它完全取决于您使用的项目模板类型。

# vb.net - 在 vb 2005 中逐行浏览文本文件

> ID：283156
> 
> 赞同：1
> 
> 时间：2008-11-12T06:09:49.507
> 
> 标签：vb.net, flat-file

所以我的程序基本上需要逐行遍历一个纯文本文件：

```
Read line 1:
Do commands
loop
Read line2:
Do Commands
loop 
```

等等，直到完成整个文件，是否有人知道任何好的编码示例，所有教程似乎都显示打开和写入/读取文本文件，但没有关于如何逐行执行。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T06:31:15.470

```
For Each line As String In System.IO.File.ReadAllLines("file.txt")
  ' Do Something'
Next 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T06:19:42.373

你可以这样做：

```
Using f As System.IO.FileStream = System.IO.File.OpenRead("somefile.txt")
    Using s As System.IO.StreamReader = New System.IO.StreamReader(f)
        While Not s.EndOfStream
            Dim line As String = s.ReadLine

            'put you line processing code here

        End While
    End Using
End Using 
```

# algorithm - 散列数字向量的方法？

> ID：283165
> 
> 赞同：14
> 
> 时间：2008-11-12T06:24:06.420
> 
> 标签：algorithm, math, hash, vector

是否有任何已知的哈希算法可以输入一个 int 向量并输出一个与内积类似的单个 int？

换句话说，我正在考虑在 C++ 中可能看起来像这样的哈希算法：

```
// For simplicity, I'm not worrying about overflow, and assuming |v| < 7.
int HashVector(const vector<int>& v) {
  const int N = kSomethingBig;
  const int w[] = {234, 739, 934, 23, 828, 194};  // Carefully chosen constants.
  int result = 0;
  for (int i = 0; i < v.size(); ++i) result = (result + w[i] * v[i]) % N;
  return result;
} 
```

我对此感兴趣，因为我正在写一篇关于算法的论文，该算法将受益于以前关于类似哈希的任何工作。特别是，如果对这样的哈希算法的冲突属性有任何了解，那就太好了。

我感兴趣的算法将散列整数向量，但浮点向量的一些东西也很酷。

**澄清**

哈希旨在用于哈希表中以进行快速键/值查找。这里没有安全问题。

所需的答案类似于一组常数，可证明对于这样的哈希特别有效 - 类似于乘数和模数，它比其他作为伪随机数生成器的效果更好。

例如，已知线性同余伪随机发生器的一些常数选择可提供最佳周期长度并具有易于计算的模数。也许有人做过研究，表明向量散列中的一组乘法常数以及一个模常数可以减少附近整数向量之间发生冲突的机会。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T08:42:23.113

我做了一些（未发表的，实用的）实验来测试各种字符串哈希算法。（事实证明，Java 的默认字符串哈希函数很糟糕。）

一个简单的实验是对英语词典进行哈希处理，然后比较算法 A 与算法 B 的碰撞次数。

您可以构建一个类似的实验：随机生成 $BIG_NUMBER 个长度为 7 或更短的可能向量。在算法 A 上散列它们，在算法 B 上散列它们，然后比较冲突的数量和严重程度。

在你能够做到这一点之后，你可以使用模拟退火或类似的技术来找到对你来说表现良好的“幻数”。在我的工作中，对于给定的感兴趣的词汇和严格限制的哈希大小，我们能够通过改变“幻数”使通用算法适用于几种人类语言。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T07:28:43.730

根据常数的大小，我不得不说输入向量中的混乱程度会对结果产生影响。但是，对您的帖子进行快速定性分析表明您有一个良好的开端：

*   您的输入相乘，因此增加了每次迭代相似输入值之间的分离程度（例如，65 + 66 远小于 65 * 66），这很好。
*   它是确定性的，除非你的向量应该被认为是一个集合而不是一个序列。为清楚起见，v = { 23, 30, 37 } 是否应该不同于 v = { 30, 23, 37 }？
*   分布的均匀性将根据 v 中输入值的范围和混乱度而变化。但是，对于广义整数散列算法也是如此。

出于好奇，为什么不直接使用现有的整数散列算法并对结果进行一些有趣的数学运算呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T08:13:50.053

Python 曾经以这种方式散列元组（[来源](http://effbot.org/zone/python-hash.htm)）：

```
class tuple:
    def __hash__(self):
        value = 0x345678
        for item in self:
            value = c_mul(1000003, value) ^ hash(item)
        value = value ^ len(self)
        if value == -1:
            value = -2
        return value 
```

在你的情况下，`item`总是一个整数，它使用这个算法：

```
class int:
    def __hash__(self):
        value = self
        if value == -1:
            value == -2
        return value 
```

不过，这确实与内部产品无关......所以也许它没有太大帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T07:34:49.320

虽然我可能完全误解了你，但将向量视为字节流并对其进行一些已知的哈希处理可能是个好主意，即[SHA1](http://en.wikipedia.org/wiki/SHA1 "SHA1")或[MD5](http://en.wikipedia.org/wiki/MD5 "MD5")。

澄清一下，众所周知，这些散列具有良好的散列属性，我相信没有理由重新发明自行车并实施新的散列。另一种可能性是使用已知的 CRC 算法。

# c++ - 将 struct tm（以 UTC 表示）转换为 time_t 类型的简单方法

> ID：283166
> 
> 赞同：31
> 
> 时间：2008-11-12T06:25:03.390
> 
> 标签：c++, c

我该怎么做以上？有 mktime 函数，但是它将输入视为以本地时间表示，但是如果我的输入 tm 变量恰好是 UTC，我该如何执行转换。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-12T06:30:14.350

使用 timegm() 而不是 mktime()

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2015-04-01T10:25:07.440

对于 Windows 上的用户，可以使用以下功能：

```
_mkgmtime 
```

更多信息的链接：[https ://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/mkgmtime-mkgmtime32-mkgmtime64](https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/mkgmtime-mkgmtime32-mkgmtime64)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2015-11-06T18:02:09.223

这是我在不是 Windows 平台时使用的解决方案（不记得我在哪里找到的）

```
time_t _mkgmtime(const struct tm *tm) 
{
    // Month-to-day offset for non-leap-years.
    static const int month_day[12] =
    {0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334};

    // Most of the calculation is easy; leap years are the main difficulty.
    int month = tm->tm_mon % 12;
    int year = tm->tm_year + tm->tm_mon / 12;
    if (month < 0) {   // Negative values % 12 are still negative.
        month += 12;
        --year;
    }

    // This is the number of Februaries since 1900.
    const int year_for_leap = (month > 1) ? year + 1 : year;

    time_t rt = tm->tm_sec                             // Seconds
        + 60 * (tm->tm_min                          // Minute = 60 seconds
        + 60 * (tm->tm_hour                         // Hour = 60 minutes
        + 24 * (month_day[month] + tm->tm_mday - 1  // Day = 24 hours
        + 365 * (year - 70)                         // Year = 365 days
        + (year_for_leap - 69) / 4                  // Every 4 years is     leap...
        - (year_for_leap - 1) / 100                 // Except centuries...
        + (year_for_leap + 299) / 400)));           // Except 400s.
    return rt < 0 ? -1 : rt;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-01-31T23:20:50.590

`timegm()`有效，但并非在所有系统上都存在。

这是一个仅使用 ANSI C 的版本。（编辑：不是严格意义上的 ANSI C！我正在对 time_t 进行数学运算，假设单位是自纪元以来的秒数。AFAIK，标准没有定义 time_t 的单位。）注意，它利用黑客，可以说，来确定机器的时区，然后相应地调整来自 mktime 的结果。

```
 /*
  returns the utc timezone offset
  (e.g. -8 hours for PST)
*/
int get_utc_offset() {

  time_t zero = 24*60*60L;
  struct tm * timeptr;
  int gmtime_hours;

  /* get the local time for Jan 2, 1900 00:00 UTC */
  timeptr = localtime( &zero );
  gmtime_hours = timeptr->tm_hour;

  /* if the local time is the "day before" the UTC, subtract 24 hours
    from the hours to get the UTC offset */
  if( timeptr->tm_mday < 2 )
    gmtime_hours -= 24;

  return gmtime_hours;

}

/*
  the utc analogue of mktime,
  (much like timegm on some systems)
*/
time_t tm_to_time_t_utc( struct tm * timeptr ) {

  /* gets the epoch time relative to the local time zone,
  and then adds the appropriate number of seconds to make it UTC */
  return mktime( timeptr ) + get_utc_offset() * 3600;

} 

```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-03-08T19:06:55.650

Loki Astari 的回答是一个好的开始，`timegm`是可能的解决方案之一。但是，手册页`timegm`提供了它的可移植版本，因为`timegm`它不符合 POSIX。这里是：

```
#include <time.h>
#include <stdlib.h>

time_t
my_timegm(struct tm *tm)
{
    time_t ret;
    char *tz;

    tz = getenv("TZ");
    if (tz)
        tz = strdup(tz);
    setenv("TZ", "", 1);
    tzset();
    ret = mktime(tm);
    if (tz) {
        setenv("TZ", tz, 1);
        free(tz);
    } else
        unsetenv("TZ");
    tzset();
    return ret;
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-01-29T19:03:14.573

以下实现`timegm(1)`在 Android 上运行流畅，并且可能也适用于其他 Unix 变体：

```
time_t timegm( struct tm *tm ) {
  time_t t = mktime( tm );
  return t + localtime( &t )->tm_gmtoff;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-03-08T18:32:13.337

[tzset](http://pubs.opengroup.org/onlinepubs/9699919799/functions/timezone.html)的POSIX 页面描述了全局变量`extern long timezone`，其中包含本地时区作为距 UTC 秒数的偏移量。这将出现在所有符合 POSIX 的系统上。

为了使时区包含正确的值，您可能需要`tzset()`在程序初始化期间调用。

然后，您可以`timezone`从输出中减去`mktime`以获取 UTC 输出。

```
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

time_t utc_mktime(struct tm *t)
{

    return (mktime(t) - timezone) - ((t->tm_isdst > 0) * 3600);
} 

int main(int argc, char **argv)
{
    struct tm t = { 0 };

    tzset();
    utc_mktime(&t);
} 
```

注意：从技术上讲`tzset()`，`mktime()` [不保证是线程安全](http://pubs.opengroup.org/onlinepubs/9699919799/functions/tzset.html)的。

> 如果一个线程直接访问 tzname、[XSI] [Option Start] 日光或 timezone [Option End]，而另一个线程正在调用 tzset() 或任何需要或允许设置时区信息的函数，就像通过调用 tzset()，行为未定义。

...但大多数实现都是。GNU C 使用互斥锁`tzset()`来避免对它设置的全局变量的并发修改，并且`mktime()`在没有同步的线程程序中看到了非常广泛的用途。我怀疑如果有人遇到副作用，那将是使用`setenv()`来改变`TZ`@liberforce 的答案中所做的值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-08-12T16:27:14.427

这是我的看法，它完全基于`time_t`/`tm`转换函数，它做出的唯一假设`time_t`是它是线性的：

1.  假装更好地了解`tm`结构保持当地时间（如果有人问，非 DST；没关系，但必须与步骤 3 一致），将其转换为`time_t`.
2.  将日期转换回`tm`结构，但这次以 UTC 表示。
3.  假装更好地了解*该* `tm`结构也保持本地（如果有人问，非 DST，但更重要的是与步骤 1 一致），并将其`time_t`再次转换为。
4.  从这两个`time_t`结果中，我现在可以计算本地时间（如果有人问的话，非 DST）和 UTC 之间的差异`time_t`。
5.  将这种差异添加到第一个`time_t`结果中给了我正确的 UTC 时间。

请注意，差异的计算可以想象一次完成，然后在以后根据需要应用于任意数量的日期；这可能是解决`gmtime`.

*（编辑：再说一次，如果时区在用于计算偏移的日期和要转换的日期之间发生更改，这可能会导致问题。）*

```
tm tt;
// populate tt here
tt.tm_isdst = 0;
time_t tLoc = mktime(&tt);
tt = *gmtime(&tLoc);
tt.tm_isdst = 0;
time_t tRev = mktime(&tt);
time_t tDiff = tLoc - tRev;
time_t tUTC = tLoc + tDiff; 
```

警告：如果系统使用基于 TAI `time_t`（或其他任何尊重闰秒的方法），如果应用于接近闰秒插入的时间点，则结果时间可能会相差 1 秒。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-06-26T20:56:30.153

这实际上是一条注释，其中包含解决 Leo Accend 答案的代码：尝试以下操作：

```
#include <time.h>
#include <stdio.h>
#include <stdlib.h>    

/*
 *  A bit of a hack that lets you pull DST from your Linux box
 */

time_t timegm( struct tm *tm ) {           // From Leo's post, above
  time_t t = mktime( tm );
  return t + localtime( &t )->tm_gmtoff;
}
main()
{
    struct timespec tspec = {0};
    struct tm tm_struct   = {0};

    if (gettimeofday(&tspec, NULL) == 0) // clock_gettime() is better but not always avail
    {
        tzset();    // Not guaranteed to be called during gmtime_r; acquire timezone info
        if (gmtime_r(&(tspec.tv_sec), &tm_struct) == &tm_struct)
        {
            printf("time represented by original utc time_t: %s\n", asctime(&tm_struct));
            // Go backwards from the tm_struct to a time, to pull DST offset. 
            time_t newtime = timegm (&tm_struct);
            if (newtime != tspec.tv_sec)        // DST offset detected
            {
                printf("time represented by new time_t: %s\n", asctime(&tm_struct));

                double diff = difftime(newtime, tspec.tv_sec);  
                printf("DST offset is %g (%f hours)\n", diff, diff / 3600);
                time_t intdiff = (time_t) diff;
                printf("This amounts to %s\n", asctime(gmtime(&intdiff)));
            }
        }
    }
    exit(0);
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-12-29T13:27:44.773

我也被 mktime() 的问题困扰。我的解决方案如下

```
time_t myTimegm(std::tm * utcTime)
{
    static std::tm tmv0 = {0, 0, 0, 1, 0, 80, 0, 0, 0};    //1 Jan 1980
    static time_t utcDiff =  std::mktime(&tmv0) - 315532801;

    return std::mktime(utcTime) - utcDiff;
} 
```

这个想法是通过使用已知时间（在本例中为 1980/01/01）调用 std::mktime() 并减去其时间戳（315532801）来获取时间差。希望能帮助到你。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-09-07T16:39:01.070

对于所有时区和所有时间，如果不是不可能的话，将是极其困难的。您需要准确记录所有各种任意时区和夏令时 (DST) 法令。有时，不清楚地方当局是谁，更不用说颁布了什么法令以及何时颁布的。例如，如果跨越闰秒，大多数系统在正常运行时间（系统已启动的时间）或启动时间（系统启动的时间戳）上关闭一秒。一个好的测试将是一个曾经在 DST 但现在不在的日期（反之亦然）。（不久前在美国发生了变化。）

# f# - 我如何针对列表执行 car 和 cadr？

> ID：283169
> 
> 赞同：4
> 
> 时间：2008-11-12T06:27:40.577
> 
> 标签：f#, functional-programming, list

假设我有一些代码：

```
let listB = [ 1; 2; 3 ] 
```

使用 Lisp 表示法，我如何做一个`car`和`cadr`反对这个列表？我知道缺点是`::`。

或者在Scheme中，`first`和`rest`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T09:07:30.757

List.hd 和 List.tl 会做你想做的事——但在 F# 中你会发现列表通常是使用模式匹配来解构的。例如，在以下函数中，x 匹配头部，xs 匹配传递给函数的列表的尾部：

```
let list = [1;2;3]

let rec f = function
    | [] -> 1
    | (x::xs) -> x * (f xs)

f list; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T06:40:23.690

*List.head*：返回非空列表的第一个元素*（列表的头部）*。

*List.tail*：返回非空列表的所有元素，除了第一个*（列表的尾部或其余部分）*。

示例（*使用 F# 交互式控制台*）：

```
> let sample = [1;2;3;4];;

val sample : int list

> List.head sample;;

val it : int = 1

> List.tail sample;;

val it : int list = [2; 3; 4] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T15:47:00.870

我将不得不同意 simonuk。虽然，就像 CMS 提到的那样，`hd`并且`tl` 是正确的功能，但还有更多的争论。

使用模式匹配时，您可以利用编译器捕获您可能错过的（基本）情况的能力（例如当列表为空时）。您绝对可以捕获或继续抛出该异常，但您不必这样做，如果这种期望不经常发生，您可能会引入错误。因此，养成利用模式匹配的习惯是一种很好的编程实践。`hd`出于所有意图和目的，调用/ `tl`IS 匹配模式时应用的实际功能。实际上，在 ocaml 中，这是一个失败：

```
let hd = function [] -> failwith "hd" | a::l -> a
let tl = function [] -> failwith "tl" | a::l -> l 
```

举个例子，我们可能会发现使用它更令人满意，而不是使用异常/失败`options`：

```
> let car = function | hd::tl -> Some hd | _ -> None
> let cdr = function | hd::[] -> None | hd :: tl -> Some tl | _ -> None 
```

另外，要小心使用`_`来匹配任何东西。当您决定添加另一种类型时，它对变体类型的伤害更大……哎呀！

# asp.net-mvc - 具有复杂数据输入字段的 ASP.NET MVC UpdateModel

> ID：283170
> 
> 赞同：9
> 
> 时间：2008-11-12T06:28:47.223
> 
> 标签：asp.net-mvc, updatemodel

如何使用 ASP.NET MVC UpdateModel 执行以下操作？我正在尝试将空格分隔的文本框数据（就像新 StackOverflow 问题中的 TAGS 文本框，例如这个）读入模型。

例如。

```
<input type="Tags" type="text" id="Tags" name="Tags"/>

...

public class Question
{
    public string Title { get; set; }
    public string Body { get; set; }
    public LazyList<string> Tags { get; set; }
}

....

var question = new Question();
this.UpdateModel(question, new [] { "Title", "Body", "Tags" }); 
```

Tags 属性确实被实例化，但它只包含一项，即输入到 Tags 输入字段中的全部数据。如果我想在列表中有一个项目（基于通过空格拆分字符串）.. 处理这个问题的最佳做法是什么？

干杯！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-12T10:24:56.870

您需要做的是将 DefaultValueProvider 扩展为您自己的。在您的值提供者中扩展 GetValue(name) 以拆分标签并加载到您的 LazyList 中。您还需要更改对 UpdateModel 的调用：

```
UpdateModel(q, new[] { "Title", "Body", "Tags" }, 
   new QuestionValueProvider(this.ControllerContext)); 
```

我写的 QuestionValueProvider 是：

```
 public class QuestionValueProvider : DefaultValueProvider
    {
        public QuestionValueProvider(ControllerContext controllerContext)
            : base(controllerContext)
        {
        }
        public override ValueProviderResult GetValue(string name)
        {
            ValueProviderResult value = base.GetValue(name);
            if (name == "Tags")
            {
                List<string> tags = new List<string>();
                string[] splits = value.AttemptedValue.Split(' ');
                foreach (string t in splits)
                    tags.Add(t);

                value = new ValueProviderResult(tags, null, value.Culture); 
            }
            return value;
        }
    } 
```

希望这可以帮助

# wcf - 使用 WS 寻址的异步 Web 服务

> ID：283178
> 
> 赞同：1
> 
> 时间：2008-11-12T06:35:30.827
> 
> 标签：wcf, ws-addressing

我需要实现一个启用 WCF WS 寻址的 Web 服务，该服务基于方法的参数执行长时间运行的过程。

客户端不需要等待结果，因为它会直接传递到数据库表中。但是，Web 方法确实需要返回一个“跟踪 ID”号（实际上是一个 GUID），以便客户端可以使用它来从数据库中检索结果。

1.  Web 方法只接受接收到的参数，创建一个新的 GUID 并将所有这些信息存储在数据库表（或 MSMQ 队列）或类似的东西中。然后它将跟踪 GUID 返回给客户端。外部服务（可能是 Windows 服务）会不断轮询“收件箱”，为每个请求执行长时间运行的过程，并生成结果并响应回调服务

提前致谢

塞卡

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T08:58:38.463

What is your question? But from your description the webservice itself is not async. In a java webapp, i would implement a simple webapp like this:

*   a webservice storing the data, starting a thread and returning the guid
*   the thread does the long term task and stores the result for its guid
*   a webservice returning the result for an guid or a fould if not finished yet.

Best practice would be to use an own deamon thread group for the long term tasks, each thread named with the guid. Override the uncaughtException() method of the group to store the exception as result for the guid on any error.

# c# - 有没有办法将 aspx 文件放入 Visual Studio 2008 .NET 3.5 中的类库中？

> ID：283180
> 
> 赞同：3
> 
> 时间：2008-11-12T06:37:02.463
> 
> 标签：c#, .net, asp.net, .net-3.5

我的站点中有很多页面，我试图想出一种很好的方法来将它们分成比我的基础 Web 项目下的简单目录更孤立的区域。有没有办法将我的 Web 表单放入单独的类库中？如果是这样，它是如何完成的？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T06:46:26.873

乍一看，我认为这是不可能的，因为 ASPX 是非预编译的..

但是，您可以创建继承自 DLL 的类`Page`并将它们放入 DLL 以重用代码隐藏功能。如果需要，这当然可以包括控件实例化逻辑，但是没有设计器可以使用（如果需要的话）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T21:37:09.603

我的问题是，你为什么要这样做？

如果它纯粹是组织性的，那么您的“简单文件夹”应该就足够了，所以也许您需要重新考虑您的项目结构。

如果是出于编译目的，例如每次更改某些内容时重新编译站点需要很长时间，也许您可​​以将站点拆分为多个站点项目，每个项目都作为主站点的子域运行。

然后这些将被单独重新编译。

如果这是一个组织的事情，但与管理相关，因为你有大量的代码并且很难解决，那么也许你应该评估你构建网站的方式。N-Tier 方法或 ASP.NET MVC 会更好地分离您的代码吗？

你觉得怎么样？...

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-21T20:05:03.240

您还可以实现一个[VirtualPathProvider](http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider.aspx)。我已经看到这样做是为了从单个 zip 中提供文件，它们也可以从 DLL 中提取。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T07:19:12.907

这种方法的另一个困难是，如果不使用[FindControl](http://msdn.microsoft.com/en-us/library/486wc64h.aspx "查找控件") ，您将无法直接访问在 ASP.NET 页面上创建的控件。

然而，一切都没有丢失。您可以选择使用 ASP.NET Web 应用程序项目，而不是使用 ASP.NET 网站。这使用了 ASP.NET 1.1 功能，它允许您从本质上进行预编译。

[Visual Studio 2008 中的 ASP.NET Web 应用程序项目模板 http://www.robpaveza.net/pub/aspnet-web-app.png](http://www.robpaveza.net/pub/aspnet-web-app.png)

需要注意的是，虽然您将控件预编译到类中，但您实际上不会将页面上的内容存储在 DLL 中。

另一种方法是使用网站发布向导，它在部署之前执行自动 ASP.NET 编译。然而，这会呈现一系列相当不可用的 DLL；生成的内容对开发人员来说并没有多大意义（您会得到诸如 ASP.my_homepage_aspx 之类的类），虽然它们可用，但会阻碍您的开发工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-12-19T10:54:48.920

我认为这是可能的，我在我的一个项目中完成了它，其中 aspx 文件将物理放置在类库中。在主项目的属性中，有一个**Build Events**选项，您可以在其中放置类似这样的内容

```
if exist "$(TargetDir)WebForm1.aspx" move /Y "$(TargetDir)WebForm1.aspx" 
"$(ProjectDir)WebForm1.aspx" 
```

# ruby-on-rails - 从 Rails 应用程序检索客户端系统信息

> ID：283185
> 
> 赞同：3
> 
> 时间：2008-11-12T06:40:37.447
> 
> 标签：ruby-on-rails, ruby

是否可以从 Ruby on Rails 应用程序中检索客户端计算机的 CPUID 和 MAC 地址？有没有可用的插件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T16:41:42.197

我很确定不可能通过 Rails 应用程序解析客户端计算机的 /proc 文件系统（感谢上帝）。

你可以做的是在一定程度上利用 Javascript。互联网上有相当多的网站（主要是隐私扫描仪）使用 Javascript 来显示有关客户端系统的大量信息。这甚至可能适用于客户端使用的 CPU 类型（假设这就是您所说的“CPUID”）。

Javascript 和 Rails 都不能为您做的，就是向您显示客户端的 MAC 地址（假设使用“macid”您的意思是 MAC 地址）。如果您更深入地研究 TCP/IP 网络的完成方式，您会注意到这是设计使然。另一个网段（例如互联网）中的计算机永远不会知道您的 MAC 地址，也不需要知道。

如果您真的想知道某人的 MAC，则需要使用 Java 小程序或 ActiveX 控件之类的东西（尽管这会将您限制在某个平台上）。在发送 MAC 地址等隐私敏感信息之前，这些东西应该提示您的用户确认/许可，这是一件好事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T17:01:16.510

Ruby on Rails 用于编写 Web 应用程序。Web 浏览器不只是将计算机的 MAC 地址和 CPUID 交给您。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-11-07T17:56:03.563

仅作记录：如果（且仅当）服务器和客户端在同一网段上，您可以 - 在 Linux/Un*x 系统上 -`arp`在服务器上使用命令，因此在 Rails 应用程序中，找出关于客户端的 MAC 地址，如下所示：

```
$ arp 192.168.1.1
Address          HWtype  HWaddress           Flags Mask            Iface
192.168.1.1      ether   1c:c6:3c:48:bc:c0   C                     wlan0 
```

列中的值为`HWaddress`MAC 地址。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T20:30:00.440

如果是本地主机网络（内联网）上的计算机，您可以使用 ruby​​ 调用一些命令行管理工具。例如，您可以对 IP 地址进行反向查找以获取计算机名称。不确定 Mac 地址...您也许可以调用 vbscript 来执行此操作。

# c - 关于中断？

> ID：283187
> 
> 赞同：1
> 
> 时间：2008-11-12T06:41:41.877
> 
> 标签：c, events

我正在编写一个基本的交通灯控制，它将显示在监视器上。

因为我需要一个外部中断（事件）来发生并改变当前交通灯的状态。我试图在没有任何板或外围设备的情况下做到这一点。

现在我想我有以下选择。告诉我哪个是最好的。

1\. 系统要安装一个中断功能，会定时中断？（但我不知道如何安装......任何机构请帮助我）

2\. 在第二台 PC 或超级终端上运行的 AC 程序会定期将一些不同的值延迟发送到运行交通灯程序的我的 PC 串行端口，它将定期检查该值，对于一组数据，它将变为一个状态和另一组数据的另一个状态。因此，这两个程序将在各自的系统上同时运行。

3.否则我应该去外部中断发生器吗？

在上述方法中这是最好的方法。或者是否有任何其他更简单且不包括外部硬件的替代方案。如果上述任何解决方案不正确，请忽略它们。我的环境是 windows 上的 turbo C。（gcc 上的答案也被邀请 bcos 我有TRITON IDE 与 gcc 安装在 ARM7 的 windows 上）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T22:03:44.987

您可以只创建一个多线程应用程序，并让一些线程在醒着时充当中断。

线程一：Traffic controle 线程二：模拟从东方来的交通，请求改变光照，随机休眠 1 到 60 秒，然后再次唤醒。Thread X 发挥想象力。

在 gcc 中，如果你有 pthread 库作为一个例子，这可以很容易地完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T06:51:34.273

选项 1 是最简单的，您只需创建一个计时器，它会定期中断您的程序。你说你正在用 C 编程，但没有指定平台，计时器是平台相关的。

在 Unixland 中，定时器在完成时发送信号给进程。具体来说，Linux 的计时器实现是[setitimer](http://linux.die.net/man/2/setitimer)。

然后，您必须捕获并处理计时器发送的[信号。](http://linux.die.net/man/2/signal)

在 Win32 API 中，您也可以使用[计时器](http://windows-programming.suite101.com/article.cfm/using_the_win32_timer_api)，但概念有些不同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T23:03:41.793

获取**Microsoft® Win32® 程序员参考**帮助文件的副本：***Win32.hlp***

求**SetTimer**及相关函数。此函数在您希望在特定时间间隔后调用函数的窗口上注册（从您调用 setTimer 的那一刻起）。我的建议是在那个功能上你： - 杀死这个计时器并像它一样设置另一个（即，相同的间隔，相同的功能）；- 增加一个计数器；- 用常数测试计数器；

即计数器=10，变为黄色，=20，变为绿色，=30 变为红色并重置计数器。

如果想法是让交通信号灯对其他事物做出反应，请用“其他事物”替换计数器逻辑。

您的程序的 main() 只是您的计时器初始化和一段时间（1）。其余的由定时器调用函数完成。

# asp.net - 空值的 Asp.net 日期绑定问题

> ID：283190
> 
> 赞同：1
> 
> 时间：2008-11-12T06:43:20.873
> 
> 标签：asp.net, datetime, null, formview

我的数据库中有一个可以为空的日期。我使用 LinqDataSource 连接到它，并与 FormView 绑定。它允许您很好地放置日期，但是如果您删除日期，我需要它将空值插入到数据库中。相反，它会引发异常。

```
<asp:TextBox ID="TxtStartDate" runat="server" 
                    Text='<%# Bind("StartDate", "{0:MM/dd/yyyy}") %>' /> 
```

如果在其中放置日期，则可以正常工作，但是如果从中删除日期并保存，则会得到 System.Data.SqlTypes.SqlTypeException: SqlDateTime 溢出。必须介于 1753 年 1 月 1 日上午 12:00:00 和 9999 年 12 月 31 日晚上 11:59:59 之间。如何让它发送空值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T06:49:03.593

我不知道这是否是最好的方法，但我通过订阅 FormView 更新事件来修复它并放置以下代码：

```
object o = e.NewValues["StartDate"];
   if (o.ToString() == "")
       e.NewValues["StartDate"] = null; 
```

# algorithm - 按域均匀洗牌邮件地址列表

> ID：283193
> 
> 赞同：2
> 
> 时间：2008-11-12T06:46:45.017
> 
> 标签：algorithm, language-agnostic

我有一个电子邮件地址列表，我想按域平均分配。

例如：

让列表成为，

```
a@a.com
b@a.com
c@a.com
a@b.com
b@b.com
c@c.com 
```

输出应该是

```
a@a.com
a@b.com
c@c.com
b@a.com
b@b.com
c@a.com 
```

源列表不像示例中那样按域排序，但可以按域排序，如果有帮助的话。这样做的有效（单/两遍？）算法是什么？

拉吉

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T07:24:47.140

请注意假设每个域的电子邮件地址数量相同（或相似）的答案。

我试图解决基本相同的问题，并在我的博客上引起了很多讨论：[第一篇文章](http://www.somethinkodd.com/oddthinking/2007/01/18/wine-gum-selection-puzzle/)，[第二篇文章](http://www.somethinkodd.com/oddthinking/2007/11/02/wine-gumpodcast-selection-algorithm-solution/)

我们没有找到快速、最佳的解决方案，但[最快、足够接近的解决方案](http://www.somethinkodd.com/oddthinking/2007/11/02/wine-gumpodcast-selection-algorithm-solution/#comment-73241)（包括 Perl 源代码）来自[Aristotle Pagaltzis](https://stackoverflow.com/users/9410/aristotle-pagaltzis)的评论。

向亚里士多德致敬。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T06:54:05.440

我的开始尝试是链表的哈希映射，这样一旦所有域冲突都被分组，您就可以一次遍历一个链表。

如果那有意义的话。

下面的代码完全是**UNTESTED**，我知道在第二个循环中有很多东西不正确，但它比尝试进一步解释要快。

```
$sortedList = array();
$tempList
$emailList = array('a@a.com', 'b@a.com', 'c@b.com', 'd@b.com', 'e@c.com', 'f@a.com');

$emailCount = 0;
foreach ( $emailList as $email ) {
    list($username, $domain) = explode('@', $email);
    $tempList[$domain][] = $user;
    $emailCount++;
}

for ( $i = 0; $i < $emailCount; $i++ ) {
    $listIndex = $i % count($tempList);
    if ( !empty($tempList[$listIndex]) ) {
        $sortedList[] = $tempList[$listIndex][0];
        unset($tempList[$listIndex][0]);
    } else {
        unset$tempList[$listIndex]);
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T06:56:03.423

本质上，对于每个电子邮件地址，将地址放入给定域的链表中。这是一个 O(n) 操作，然后通过循环遍历域列表来创建一个新的平衡列表是另一个大致 O(n) 的操作。

按照命令，这大约是 2 遍复杂性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T14:57:46.010

这是我对这个问题的解决方案。给定一个像这样的输入

```
[["A", 13], ["B", 5], ["C", 3], ["D", 1]] 
```

输出是

```
AABABAACABAACABAACABAD 
```

该程序的Ruby源码是：

```
require "pp"

def shuffle (total, num)
  ret_arr = Array.new
  intervel = total/num.to_f
  0.upto(num-1) do |i|
    val = i * intervel
    ret_arr << val.floor
  end
  return ret_arr
end

freq_table = [["A", 13], ["B", 5], ["C", 3], ["D", 1]]

pp freq_table
total = 0
freq_table.collect {|i| total += i[1] }
final_array = Array.new(total,0)
print  final_array.to_s + "\n\n"
placed = 0

freq_table.each do |i|
  placements =  shuffle(total - placed, i[1])
  placements.each do |j|
    free_index = -1
    0.upto final_array.size do |k|
      free_index += 1 if (final_array[k] == 0 || final_array[k] == i[0])
      if j == free_index
        final_array[k] = i[0]
        break
      end
    end
  end
  print "Placing #{i[1]} #{i[0]}s over #{total - placed} positions\n"
  pp placements
  print  final_array.to_s + "\n\n"
  placed += i[1]
end 
```

这个想法是采用频率最高的字母表并将其首先分布在一个数组中，该数组的大小是所有元素的总数。接下来分配具有第二高频率的字母表并将其分布在空闲空间中，依此类推。

如果您有任何问题，请告诉我，我很乐意回答。

拉吉

# sharepoint - 在 SharePoint 中创建智能部件的最佳方式是什么？

> ID：283199
> 
> 赞同：0
> 
> 时间：2008-11-12T06:54:00.307
> 
> 标签：sharepoint, sharepoint-2007

我有点知道如何创建自定义 Web 部件。但现在我需要创建一个智能部件。知道它是如何工作的，或者创建它的简单方法是什么？也许一些不错的文章链接？

请帮忙

问候艾蒂安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T07:43:00.007

请看一下[Codeplex](http://www.codeplex.com/smartpart)，是不是您正在寻找的东西？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T09:49:52.480

找到一篇好文章，整理一下，谢谢！

[http://weblogs.asp.net/jan/archive/2004/11/23/268644.aspx](http://weblogs.asp.net/jan/archive/2004/11/23/268644.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T13:48:44.567

我的 Web 部件是使用 WebUserControls 创建的。例如，您可以在 SharePoint 的同一服务器上对标准 asp.net 应用程序（ascx、aspx）中的所有功能进行编程，然后在 Web 部件中加载用户控件并访问将它们复制到布局文件夹的 aspx 页面。

# .net - 在 dotnet 应用程序中使用 Visual Basic 6.0 中声明的事件

> ID：283202
> 
> 赞同：3
> 
> 时间：2008-11-12T06:55:28.527
> 
> 标签：.net, vb6

我们正在为用 VB 6.0 编写的 COM 库编写测试。我们面临的问题是，我们无法访问在 VB 中声明的事件（withevents）。我们得到异常，“对象不支持事件集”。我们怎样才能克服这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T17:56:52.177

您的模拟框架是这里的问题。此调用返回的模拟对象：

```
repository.DynamicMock<PersonLib.DatabaseCommand>(); 
```

实现`DatabaseCommand`类的接口，但不模拟它的事件。因此，当您将此模拟对象的一个​​实例传递给您的 VB6 代码时，它期望接收一个可以引发事件的 DatabaseCommand 对象，它不会工作。

当您将模拟对象传递给您的`PersonClass.Init`方法时，这里是正在发生的事情的简化版本：

1.  代码到达这一行`PersonClass.Init`：

    `Set dbCommand = vDBCommand`

2.  VB6 询问语句右侧的对象`Set`是否支持与`DatabaseCommand`类相同的事件（VB6 这样做是因为您`dbCommand`使用`WithEvents`关键字声明，因此它将尝试设置事件接收器以接收来自`dbCommand`对象的事件）。

3.  但是，您传入的对象是模拟对象而不是真实`DatabaseCommand`对象，实际上并没有实现真实`DatabaseCommand`类实现的事件。当 VB6 遇到这种情况时，它会引发您所看到的错误。

我想不出一种方法来使模拟对象支持与`DatabaseCommand`该类相同的事件以使您的测试代码正常工作（好吧，我可以想到一种方法，但这将涉及重新设计您的类），但是我可能如果我找到更合理的解决方案，请稍后再发布。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T10:59:52.750

例如，我们在 VB 6.0 中有一个名为 DatabaseCommand 的类。

```
Option Explicit

Public Event SavedSuccessfully()

Public Sub Execute(ByVal vAge As Integer, ByVal vName As String, ByVal vAddress As String)

    RaiseEvent SavedSuccessfully

End Sub 
```

现在，personclass

```
Private WithEvents dbCommand As DatabaseCommand

Public Sub Init(ByVal vDBCommand As DatabaseCommand)

    Set dbCommand = vDBCommand

End Sub

Private Sub dbCommand_SavedSuccessfully()
    'not implemented
End Sub 
```

现在，当尝试对此进行测试时（编译 vb 项目后）

```
MockRepository repository = new MockRepository();

PersonLib.DatabaseCommand db = repository.DynamicMock<PersonLib.DatabaseCommand>();

PersonLib.PersonClass person = new PersonLib.PersonClass();

person.Init(db);  --- this line throws error - Object or class does not support the set of events 
```

# c - 你在 C 语言中犯过的最危险的编程错误是什么？

> ID：283205
> 
> 赞同：9
> 
> 时间：2008-11-12T06:56:37.523
> 
> 标签：c

我是一名中级 C 程序员。如果您犯了任何编码错误，后来才知道这是对整个应用程序最危险/有害的，请分享该代码或描述。我想知道这一点，因为将来我可能会遇到这种情况，我想听听您的建议以避免此类错误。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-12T07:02:23.877

```
if (c = 1) // insert code here 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-12T08:16:26.037

```
if(a == true);
{
  //Do sth when it is true. But it is allways executed.
} 
```

**编辑**：相同错误的另一个变体。

```
for(i=0; i<max_iterations;i++);
{
  //Do sth but unexpectedly only once
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-12T07:31:29.903

几年前，我接到前同事的电话，告诉我他必须用我的代码解决问题，该代码是信用卡交易的路由器。

卡号前缀由 6 位 BIN（银行识别号）和额外的几位银行自行决定使用，例如银行有 Visa Classic 卡 456789 的 BIN，并预留 2 位额外的数字表示子产品，如 01 用于学生卡卡，02 为与当​​地百货公司的联名卡等。在这种情况下，基本上是产品标识符的卡前缀变为 8 位长。当我对这部分进行编码时，我认为 9 位数字“应该对每个人都足够了”。它运行了 2 年，直到有一天银行制作了具有 10 位长前缀的新卡产品（不知道他们为什么需要它）。不难想象发生了什么 - 路由器段错误，整个系统停止，因为没有事务路由器它无法运行，

我不能在这里发布代码首先是因为我没有它，其次它是公司的版权，但`strcpy()`不检查目标缓冲区的大小不难想象。

就像`man strcpy`说：

> 如果 strcpy() 的目标字符串不够大（也就是说，如果程序员愚蠢或懒惰，并且在复制之前没有检查大小），那么任何事情都可能发生。溢出固定长度的字符串是最喜欢的破解技术。

我很尴尬。但我已经吸取了教训，不要忘记（通常:)）检查目标缓冲区的大小。我不建议您以艰难的方式学习它 - 只需养成在`strcpy()`和之前检查目标缓冲区的习惯`strcat()`。

编辑：来自 Healthcarel 的好建议 - 使用`strncpy()`而不是`strcpy()`. 它不添加尾随 0，但我通常使用以下宏来解决它：

`#define STRNCPY(A,B,C) do {strncpy(A,B,C); A[C] = 0; } while (0)`

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-11-12T07:45:17.583

已经很久了，但有些事情你永远不会忘记;-)。

*   忘记`\0`字符串末尾的 。
*   为具有 n 个字符的字符串分配 n 个字符。
*   忘记 switch 语句中的中断。
*   '创意' 宏使用。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-12T07:04:31.300

```
for(int i = 0; i<10; ++i)
  //code here
  //code added later 
```

请注意，后面添加的代码不在 for 循环中。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-12T13:55:10.613

未初始化的数据。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-12T08:26:52.147

我在 C 语言中做过的最危险的事情是尝试编写管理自己内存的代码。实际上，这意味着**我在 C 语言中做过的最危险的事情就是编写 C 代码**。（我听说这些天你可以绕过它。髋关节保持理智。在适当的时候使用这些方法！）

*   我不编写分页算法——操作系统极客为我做这件事。
*   我不编写数据库缓存方案——数据库极客为我做这件事。
*   我不构建 L2 处理器缓存——硬件极客为我做这件事。

而且我*不*管理内存。

其他人为我管理我的记忆——他可以设计得比我好，测试比我好，编码比我好，并在他们犯下危及安全的严重错误时进行修补，而这些错误只会在 10 年后才被注意到，因为**绝对每个**尝试分配内存的人都会在某些时候失败。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-12T14:01:22.987

system() 在参数中带有一些用户提供的字符串。popen() 也是如此。

请改用 exec*()。

当然，这不是 C 独有的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-12T08:15:22.157

你应该更多地担心小错误。大/壮观的错误通常记录在书中（说明错误的原因、替代方法等）。

你会遇到一些小的设计/编码错误，因为它们往往会加起来。

所以我的建议是尝试阅读 Kernighan 撰写或合着的书籍（“C 编程语言”、“编程实践”等），因为它们充满了常识（对于有经验的 C 程序员来说很常见）建议和列表在避免小错误和大错误方面非常有用的原则。

他们还列出了许多潜在的大错误，因此他们回答了您最初的问题。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-12T09:07:26.653

我将危险的定义定义为“我们可能会在发布该错误并仅在几年后发现为时已晚”：

```
char* c = malloc(...);
.
.
.
free(c);  
.
.
.
c[...] = ...; 
```

或者

```
// char* s is an input string
char* c = malloc(strlen(s));
strcpy(c, s); 
```

但是如果你编写多平台（不限于 x86/x64），这也很棒：

```
char* c = ...;
int i = *((int*)c); // <-- alignment fault 
```

如果您的缓冲区来自不受信任的来源.. 基本上大多数代码都是危险的。

但是，不管怎样，在 C 语言中，射中自己的脚是如此容易，以至于关于射脚的话题可能会翻阅数千页。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-12T15:14:29.983

我在这里同意 Pat Mac（尽管他投了反对票）。在 C 中你能做的最危险的事情就是将它用于重要的事情。

例如，默认情况下，明智的语言会检查数组边界并在您尝试超出程序范围时立即停止程序（引发异常或其他事情）。艾达这样做了。Java 就是这样做的。许多其他语言都这样做。不是 C。围绕语言中的这个缺陷建立了整个黑客行业。

对此的个人经验。我曾与一家运行飞行模拟器网络的公司合作，该网络与反射（共享）内存硬件捆绑在一起。他们遇到了一个令人讨厌的崩溃错误，他们无法追踪，所以我们的两个最好的工程师被派到那里去追踪它。他们花了2个月的时间。

事实证明，其中一台机器上的 C 循环中有一个错误。当然，一种称职的语言会在那里停止事情，但是 C 让它继续并在数组末尾之后的下一个位置写入一段数据。这个内存位置恰好被网络上的另一台机器使用，该机器将它传递给*第三*台机器，第三台机器使用（垃圾）值作为数组索引。由于该系统也是用 C 编码的，因此它也不关心它是否在其数组之外建立索引，并在其程序中丢弃半随机内存位置。

因此，由于缺乏数组边界检查，一个简单的易于制造的错误导致计算机随机崩溃，距离错误的源头两跳！公司的成本：他们最好的工程师花费了 4 个人月的时间，加上其他工程师和支持人员花费了多少，加上问题模拟器无法正常工作导致的所有停机时间。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-12T08:44:48.773

首次分配指针时，它没有指针。

指针“未初始化”

对坏指针的取消引用操作是严重的运行时错误。

如果幸运的话，取消引用操作会立即崩溃或停止（Java 就是这样做的）。

如果你不走运，坏的指针取消引用会破坏内存的随机区域，稍微改变程序的操作，使其在一段时间后无限期地出错。必须为每个指针分配一个指针，然后才能支持解引用操作。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-12T09:17:15.463

```
while(a)
{ 
   // code - where 'a' never reaches 0 :( 
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-13T21:57:09.370

我想到了两件事。这首先是嵌入式 C (MCU) 中的一个函数，我试图在输入函数时对计时器值进行一些限制。所以我写了

```
if(55000 < my_var < 65000) 
```

我的 ida 是这样检查的：

```
if( (55000<my_var) < 65000) 
```

但这是等价物或结果

```
if( (55000<my_var) || (my_var<65000)) 
```

结果是 if 测试总是正确的。

第二个是指针错误。（这里简单介绍）

```
get_data(BYTE **dataptr)
{ 
  ubyte* data = malloc(10);
  ... code ...
  *dataptr = &data[1];
}

 main()
 {
   BYTE *data
   get_data(&data);
   free(data);
 } 
```

因此导致每次`get_data()`调用函数时都会丢失 1 个字节的内存

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-11-12T08:01:49.420

使用不受限制的字符串函数，例如 strcpy() 或 strcmp()，而不是安全版本，例如 strncpy() 和 strncmp()。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-12T08:12:13.987

将虚拟地址传递给 DMA 引擎是最糟糕的，与 C 不完全相关，但我认为 99% 的与 DMA 相关的东西都是用 C 编写的，所以它是一种匹配。这个小错误导致我花了 1.5 个月才找到内存损坏。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-12T11:06:30.640

开关盒没有中断。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-11-26T16:53:05.280

作为一名 Lisp 程序员，我习惯于缩进右大括号，如下所示：

```
(cond
    ((eq a foo)(bar ...
        ....
        ))
    ) 
```

我把它带到了C编程中：

```
if (a == foo){
    bar(...);
    ....
    } 
```

然后我在 C 语言中进行了一个大型项目，另一个程序员不得不在我的代码附近进行更改。他误读了我的右括号，过早地释放了一些记忆。这导致了一个在关键时刻发生的极其微妙的错误。当它被发现时，他受到了严重的指责。但你可以说这是我的错。至少可以这么说，这并不好玩。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-11-26T17:19:11.327

忘记架构约束并愉快地 memcpy() 进入微控制器上的内存映射 I/O 区域。魔法烟雾从试验台中释放出来。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-12-08T00:30:42.887

我正在处理动态分配的二维数组，我决定释放 M 列，而不是 free()'ing N 行。这对于 N == M 的较小输入很好，但在大输入上，我只释放（）我分配的 50%。

*耸耸肩*

活到老，学到老。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-11-11T06:07:18.120

这是一个著名的历史例子（不是我做的），但是

```
double d;      // d gets populated with a large number from somewhere
short s = d ;  // overflow 
```

[导致](http://www.ima.umn.edu/~arnold/disasters/ariane.html) [了阿丽亚娜五号火箭](http://en.wikipedia.org/wiki/Ariane_5_Flight_501)的[爆炸和全部损失](http://www.youtube.com/watch?v=kYUrqdUyEpI)。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-11-12T07:26:17.573

需要注意的一件事是数组边界。如果超出范围，运气不好，最终可能会覆盖用于其他数据的内存。

与此相关的一个讨厌的错误是函数中的静态数组变量越界。这最终作为一个函数改变了调用函数的局部变量的值。调试起来并不那么简单..

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-11-12T11:41:55.653

我记得有两个错误：

1.  从创建它的函数中返回自动变量的地址；
2.  将字符串复制到指向 char 的未初始化且未分配的指针。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-11-12T15:27:18.493

```
#include <string> 
```

我认为 C 原生支持字符串（大约 8 年前使用 Metroworks codewarrior）。

我这样做是为了一个大约 15,000 行代码的最终项目。我使用这个库来完成与字符串相关的所有事情（追加、拆分等），只是让 TA 无法编译我的任何作业（使用 GCC。）

我几乎没有了解到 Metroworks 创建了自己的字符串库。那门课我不及格。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-11-14T07:09:32.763

```
if (importantvar = importantfunction() == VALID_CODE) 
```

这就是我的意思：

```
if ((important var = importantfunction()) == VALID_CODE) 
```

当我认为它像后者一样工作时，这导致了许多小时的调试麻烦。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-02-12T03:47:58.630

最后忘记放`;`了。多余`}`的。错误地输入了一个`,`

这些让我发疯了好几个小时，才发现我的代码出了什么问题。

# message-queue - Websphere MQ 消息历史

> ID：283206
> 
> 赞同：1
> 
> 时间：2008-11-12T06:56:47.947
> 
> 标签：message-queue, ibm-mq

我的应用程序通过 IBM Websphere MQ 与另一个系统通信。有时没有消息进入我的队列，但另一个系统说他们已经发送给我。所以我想知道如何为到达我的队列的所有消息保留历史记录。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-30T13:45:03.883

我能想到的唯一其他方法是使用通道出口。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T07:15:41.213

请记住，它可能仍会通过网络传递，因为 MQ 架构可能有许多中间件队列。同样，消息不需要立即通过通道传输 - 发送者可以将消息批量化并使用触发器发送它们。

确保记录所有到达的最佳方法是使用拦截器队列。

这是通道写入的队列（我们称之为 A），在此更改之前，您的应用程序将从中读取。然后，您有一个从 A 读取的传输过程，记录消息，然后将其写入第二个队列 (B)。这第二个队列是您的应用程序现在读取的内容。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-12T14:24:16.763

您可以在队列末尾放置一条日志记录语句，以便在收到消息后立即将内容转储到日志中。这样，如果另一个系统说他们发送了一条消息，他们所要做的就是告诉你什么时候，你可以查看你的日志，看看是否在那个时间从他们那里收到了一条消息。

# asp.net-mvc - ASP.NET MVC AcceptVerbs 和注册路由

> ID：283209
> 
> 赞同：21
> 
> 时间：2008-11-12T07:00:46.503
> 
> 标签：asp.net-mvc, routes, httpverbs, acceptverbs

如果我已经用 [AcceptVerbs(..)] 属性修饰了我的操作方法，我是否必须在我的路由定义中注册 HttpVerb 约束（当我注册路由时）？

例如。我有这个。

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Create(FormCollection formCollection)
{ .. } 
```

我是否需要将此添加到引用此操作的路由中，作为约束？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-12T23:43:44.060

两者之间的区别如下：假设有`Create`问题的方法在`HomeController`.

使用该`AcceptVerbs`属性不会影响路由。它实际上是动作调用者使用的东西。它允许您做的是在一个控制器上拥有 2 个具有相同名称的操作方法，每个方法响应不同的 HTTP 方法。

```
public ActionResult Create(int id) { .. }

[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Create(FormCollection formCollection) { .. } 
```

因此，当请求`/home/create`进入时，路由将匹配并将请求传递给控制器​​的调用者。然后调用者通过查看`AcceptVerbs`属性调用正确的方法。

使用`HttpMethodConstraint`in 路由将使路由本身与请求不匹配。因此，当 POST 请求进入时`/home/create`，不会调用任何操作方法，因为该路由与请求不匹配。不过，另一条路线可能*会*匹配该请求。

此处重叠的部分原因是路由是 ASP.NET 3.5 SP1 的一项功能，并非特定于 MVC。MVC 使用路由，但动态数据也使用路由，我们计划将路由与 ASP.NET Web 窗体集成。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-12T14:04:17.177

不—— Create 只会响应 POST 请求。

您可以拥有其他具有不同 AcceptVerb 属性的 Create 实现，或者一个没有将捕获所有其他请求的属性的实现。

如果这是您唯一的 Create 方法，那么任何 GET（或其他非 POST）请求都会导致 404。

我假设这一切都是由路由引擎完成的。[编辑：不，见 Haacked 的帖子]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-30T23:04:26.210

首先这样装饰：

```
[ActionName("ItemEdit"), AcceptVerbs(HttpVerbs.Post)]
public virtual object ItemSave(Menu sampleInput) 
```

那么你需要像这样添加路由：

```
 AddRoute(
                "SampleEdit",
                "Admin/{sampleID}/Edit",
                new { controller = "Sample", action = "ItemEdit", validateAntiForgeryToken = true },
                new { areaID = new IsGuid() },
                new { Namespaces = controllerNamespaces }
           ); 
```

# web-applications - 关于为 Web 应用程序选择哪种语言/框架的建议？

> ID：283210
> 
> 赞同：0
> 
> 时间：2008-11-12T07:00:56.690
> 
> 标签：web-applications, frameworks, rad

我是一名 C++ 开发人员，尝试使用符合以下标准的语言或框架创建 Web 应用程序：

1.  非常快的开发时间
2.  文本搜索和其他文本操作
3.  易于配置和维护应用程序
4.  标记系统支持
5.  免费（如 Beer）IDE
6.  3-4周末项目

任何人都可以提出一个有益的语言或框架，给出这个标准吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-12T07:27:00.270

我会继续为[django](http://www.djangoproject.com/)输入这个词。

这有时被称为 python 对 rails 的回答。
我最近有机会做一些 ruby​​ 编程，如果你刚接触任何一种语言，我认为 ruby​​ 或 python 很容易进入。

无论您选择什么，都要确保这些工具有据可查。我对 rails 和 ruby​​ 的研究还不足以熟悉可用的文档，但我对可用的 django 和 python 文档印象深刻。

[http://www.djangoproject.com/](http://www.djangoproject.com/)

[http://docs.python.com](http://www.djangoproject.com/)

这是一个列出 django 网站的网站，因此您可以查看人们使用 django 制作的网站类型。

[http://www.djangosites.org/](http://www.djangosites.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T09:05:09.247

这要看情况。你可以选择：

*   更接近**你已经知道**的东西，这样你就可以快速发展。也许 C# 和 ASP.Net Visual Studio Express 对您来说是一个很好的组合。
*   **薪水更高**的那个，所以你可以赚一些额外的钱。
*   **工资较低**的那个，因此您与员工的费用较少。
*   对你来说最***奇怪***的是，这样你会学到一些非常新的东西。

高温高压

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T07:05:18.147

这取决于受众的类型和您正在处理的数据类型。对于内部业务应用程序，您可能希望选择 ASP.NET 之类的东西来支持组件。对于更简单的东西，你可以选择 php 或 rails。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T07:08:04.210

**GWT - 谷歌网络工具包**

它是一个java框架，将java代码编译成HTML和javascript。小部件（控件）构成了 Web 应用程序，您可以轻松创建自己的小部件。

它涵盖了所有现代网络技术，例如 AJAX 和富客户端行为。Java 语法类似于 C++。

**PHP**

您描述的应用程序类似于**WordPress**开源项目。

查看[wordpress 主页](http://wordpress.org)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T07:31:41.480

由于 Django 和 Rails 在他们的方法上有点相似，我会根据决定：你更喜欢哪种语言？Ruby 比 Python 更吸引你吗？知道 Python/Django 拥有更大的社区是否会产生一些影响？

Python 支持 Visual Studio 平台（请参阅 IronPython），但 Ruby 是为 JVM 大量开发的（请参阅 JRuby）。哪个平台更贴近你的心？

在您选择之后 - 其余的很容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T08:04:06.297

您能否提供有关该应用程序的更多详细信息？它可能看起来不相关，但它经常是。例如，如果您只是构建一个带有一些自定义铃声和口哨的简单 CMS，则 wordpress 可能是您要走的路。它有一个非常好的插件架构、大量的文档和支持，并且可以轻松地为大量网站提供支持。

但是，如果它更自定义一点，我会说对于非常快速的应用程序构建，Ruby on Rails 不会出错。我个人（**非常**）不是粉丝，但是有很多教程和论坛可以在语言和框架方面获得帮助。红宝石宝石也是一个不错的选择。话虽如此，我不会为任何会获得大量流量的东西选择它，至少在磁悬浮列车出来之前不会。

Ruby 的另一个问题是您必须学习一门新语言……如果您只想提高效率，那可不好。您可以在 PHP 中快速完成任务，但它通常很混乱……如果您乐于在 java vm 上运行，您可以尝试 groovy……同样，这一切都取决于您愿意从您的舒适区和项目需要什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T08:53:26.743

您可以使用 Spring WebFlow 快速实现结果——它是一个声明性 MVC 框架，您只需在其中编写模型类（类似于您在 OO 类中编写的东西）和瘦服务层。用户交互逻辑是用简单的 xml 编写的。只需查看参考应用程序源代码即可。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-30T17:38:17.527

Artur brings up good points I personally like Drupal as I am versed in PHP with some C background. I found Drupal to be the best fit for some of my most recent projects. Short article on dilemma of choice: [http://topcweb.com/content/content-management-system-overload](http://topcweb.com/content/content-management-system-overload) I also recently heard Django is great as well as Drupal assumes a decent amount. My favorite part about Drupal is the extensive amount of modules.

# sql-server - 用于存储过程的 SQL 表和列解析器

> ID：283214
> 
> 赞同：5
> 
> 时间：2008-11-12T07:03:41.317
> 
> 标签：sql-server, stored-procedures, sql-server-2000

是否有一个应用程序可以解析一组给定的存储过程（SQL Server 2000）并获取其中正在使用的所有表和相关列。存储过程可以有来自不同数据库的表。

输出应该类似于 TableA columnA columnC columnD

表B列E列F列G

我用Database Edition GDR写了一个小应用，有兴趣的可以参考[http://tsqlparsergdr.codeplex.com](http://tsqlparsergdr.codeplex.com)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T07:29:02.357

*   **更新 - 2009 年 1 月 20 日***
*   Visual Studio DB 专业版附带完整的 T-SQL 脚本 DOM 解析器
*   [http://blogs.msdn.com/gertd/archive/2008/08/21/getting-to-the-crown-jewels.aspx](http://blogs.msdn.com/gertd/archive/2008/08/21/getting-to-the-crown-jewels.aspx)

不是一个具体的解决方案——而是一个思路。

将 sysdepends 视为一种潜在的解决方案 - 但众所周知，它在包含*所有*依赖对象信息方面不可靠。

但是 Lex/Yacc 派生的东西怎么样？有一些商业解析器，例如

> [http://www.sqlparser.com/download.php](http://www.sqlparser.com/download.php)

没有寻找开源实现，但我想我会寻找那条路线。以下是我开始搜索的方式：

> [http://www.google.com/search?hl=en&q=sql+lex+yacc+parse](http://www.google.com/search?hl=en&q=sql+lex+yacc+parse)

ANSI SQL 的 BNF 语法可以在这里找到：

> [http://savage.net.au/SQL/](http://savage.net.au/SQL/)

通过选择 lex 实现，这似乎是一个相对简单的工程问题。（虽然如果你想支持 MS SQL 扩展，会有些繁重的工作）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-19T15:51:20.790

您可以使用[SHOWPLAN_ALL](http://msdn.microsoft.com/en-us/library/aa259203.aspx)设置并解析输出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T16:06:10.603

决定使用 Regex 创建一个小型应用程序来满足我当前的需求。

谢谢大家的回复。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-29T23:44:16.680

sp_depends 非常适合我。它显示了我的更改可能会影响哪些表或 SP

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-19T18:33:13.367

sp_depends 应该有帮助

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-12T07:55:13.803

您可以以编程方式（在开发环境中）**调用存储过程并****获取结果列**。也许您有一个命名约定以避免调用插入和更新过程。您也必须找到设置正确参数的方法。

**注意：**我认为 100% 可靠的解决方案在技术上是不可能的，因为存储过程（可以）的工作方式。

看这个例子：

```
[...]
@MyDate datetime

AS

    IF (day(@MyDate) = 1)
    BEGIN
        SELECT * FROM MyFirstTable
        RETURN
    END

    IF (@MyDate > getdate())
        SELECT MyID, MyText FROM MySecondTable WHERE ADate > @MyDate
    ELSE
        EXEC Other_StoredProcedure @MyType, @MyDate 
```

所以有两个问题：结果列可能不同，您必须递归地遵循其他存储过程。

# algorithm - 在 CSS 精灵中自动定位图像的最佳（或至少足够好）算法是什么？

> ID：283219
> 
> 赞同：0
> 
> 时间：2008-11-12T07:07:42.557
> 
> 标签：algorithm, rectangles

我已经编写了一个 CSS sprite 自动生成器，它从 HTML 页面中取出选定的图像并将它们转换为 CSS sprite，但现在它并没有尝试以最佳方式布置它们，而只是将它们堆叠起来，这会浪费很多空间。确定最佳布局的最佳算法是什么？

为了更笼统地说明这个问题，我需要一种算法，给定任意数量的任意大小的矩形，将它们排列成一个面积尽可能小的矩形。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T07:09:47.200

这已经在这里了：[堆叠矩形以尽可能少地占用空间](https://stackoverflow.com/questions/251488/stacking-rectangles-to-take-as-little-space-as-possible)。

也许这就是你要找的。

# version-control - 源代码控制 - 锁定与合并？

> ID：283221
> 
> 赞同：27
> 
> 时间：2008-11-12T07:08:34.507
> 
> 标签：version-control

许多使用 Visual Studio 的程序员很难适应这样一个事实，即在其他源代码控制系统中，文件不需要在任何给定时间锁定/检出给一个开发人员。

合并的支持者说，允许两个人处理同一个文件可以提高生产力，因为它消除了为同一个源文件排队的问题。它还避免了需要编写代码但将源签出给刚刚休假两周的人的情况。

锁定倡导者说，当多人同时处理同一个文件时，会引入很多风险。据他们说，当使用合并模型时，团队成员之间的沟通和协调变得更加必要。另外，很多人似乎不信任自动合并。

您使用一种方法而不是另一种方法的最令人信服的理由是什么？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-12T07:22:52.823

从锁定模型切换到合并模型后，我将进行以下观察：

*   大多数合并用户倾向于与他们正在开发的分支的“头部”版本保持相当接近。这通常意味着戏剧性的合并问题并不常见。
*   在 10 年左右的合并模型使用中，我只遇到过几个非常糟糕的合并问题。在这两种情况下，这是因为有 2 个人解决了同一个问题。
*   我们通常在不与对方沟通的情况下解决合并问题；）
*   如果系统处于稳定维护阶段且变化很小，“锁定”模型 VC 是可以的。
*   如果您的团队很小（我会说 1-2 人；），锁定模型 VC 是可以的

恕我直言，合并模型非常优越，因为它允许我在使用代码时自由。它可能不是使用代码“变暗” 1 周的最佳模型，但再次使用“锁定”模型，这也是一个同样大的问题。没有人会在一周内对代码感到困惑。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-26T16:10:52.853

我对自己合并的想法感到非常害怕，想起了 80 年代试图合并代码的噩梦。然而，我下载了 Subversion 和 Git 并与它们一起玩了一下，它们的承诺给我留下了深刻的印象。可惜我是这里唯一的人。

我做过的一件事你可以尝试：跟踪自己。由于锁定模型更加悲观，如果您在该模型下工作，这很容易做到。每次与其他开发人员发生锁冲突时，请过去与他们交谈。跟踪以下内容：

1.  有多少次他们不想检查/忘记/不知道它已被检查。
2.  有多少次他们不可用（度假、生病等）。
3.  他们合法地检查了多少次，但正在将文件中完全不相关的部分修改为您想要修改的部分。
4.  他们修改了与您想要进行的更改冲突的文件部分的次数。

4 是唯一可以说锁定对您有帮助的情况，并且涵盖了*所有*此类情况。在过去 3 年中，我发现几乎所有问题都属于 1-3 种问题。我想我找到了一个 4 一次。但如果我加起来一直输给 1-3，那就太棒了。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-12T07:49:24.593

合并是正确的方法，但要添加到前面的答案，它应该尊重一些有效的标准。

*   分支定义明确（它并不代表“过于广泛”的开发工作，其中开发人员必须修改*所有*文件，从而增加对一个具有潜在冲突的通用文件进行多次并发修改的机会）
*   当一个开发人员开始修改另一个同事已经保留的文件时，就会清楚地**发出通知（文件已经被更改）。**
*   公共配置文件（每个开发人员都需要遵循一组预定义的值，除了需要为每个程序员重新定义一个自定义本地路径）不是任何人“保留”的，而是在他们的私人工作区中简单地修改。

另外，请记住，也有可能将两者结合起来：

*   “lock”：第一个修改文件的开发者将第一个提交它。每个其他开发人员也可以修改同一个文件，但必须等待第一个提交才能开始合并他们自己的修改。
*   “合并”：当开发人员提交已被同事更改的文件时，他会合并他的更改。

在这种情况下，您应该确保存在“释放”机制以避免被第一个开发人员阻止。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-12T07:37:53.993

我认为合并模型要优越得多，它更灵活，用户可以并行工作，无需彼此等待，解决冲突所需的时间远少于锁定模型所损失的时间。大多数情况下，对文件所做的更改不会发生冲突，并且可以自动合并。

这可能就是为什么它是大多数现代源代码控制系统中的默认模型。

但归根结底，关键因素始终是*用户沟通*。当用户沟通不畅时，冲突肯定会增加。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-16T13:18:33.087

合并模型有点像游泳。起初没有做过的人害怕它，但每个知道怎么做的人都喜欢它。有些人很早就有过不好的经历，大多数人只需要经历它并克服最初的恐惧。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-16T13:40:08.620

我遇到的最大的合并问题是在一个我们有锁定版本控制的站点上（准确地说是 SCCS——这是不久前的事了）。

会发生的情况是那个人 A 正在做某事，并且会检查文件。人 B 会收到一个紧急请求，要求为客户修复某些东西，并且必须更改该文件。

这在几个方面发挥了作用。有时，A 会签入，B 会进行更改，然后 A 会从 A 的工作副本继续并清除 B 的更改。有时，B 会从复制出的副本开始，因为时间至关重要，更改可能需要一段时间才能正确，并覆盖 A 的更改。有时 B 的更改会与 A 的更改相互作用，而 A 的某些更改会被破坏或丢失。在后一种情况下没有警告。

在合并的 VCS 中，A 和 B 进行更改，系统确保不会丢失任何内容。在最后一种情况下，VCS 会记录冲突，因此不会错过。

对程序文件进行较大更改也存在问题，因为它可能会被必要的修复中断，从而使其更难完成。

我从未见过可以保证两个人不必同时处理同一个文件的生产环境。合并 VCS 可以很好地处理这种情况。锁定 VCS 不会。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-12T07:28:39.050

合并是好的。处理同一个文件的程序员无论如何都应该进行通信。如果他们不进行通信，则该代码中存在更严重的问题。

合并是做事的自然方式，它带来纪律，节省时间（想象两个程序员最终重构相同的代码）。

锁定是被动的……合并是主动的……

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-16T16:57:44.417

锁定的拥护者是错误的，如果有这样的人提倡这样做的话。我遇到的每个使用老式锁定风格系统的团队都抱怨过它，并且渴望地看着使用其他方法的人。我在一个地方工作过一个项目，该项目被迫使用锁定系统并选择完全使用 NO CONTROL（所以我建立了一个*秘密*的SVN 分支，尽管我更喜欢 Bzr 或 Git）。

所以，我怀疑唯一的“*锁定倡导者*”是锁定系统营销部门的员工。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-11-17T22:02:34.850

合并总是有问题且适得其反，应不惜一切代价避免。合并大型代码更改和重构文件是一件痛苦的事情。对所有开发人员强制使用乐观锁定模型是错误的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-12T07:18:07.230

锁定文件可能无法很好地扩展到更大的团队。对于使用大量分支和合并的版本控制系统，让任何人对存储库进行这种控制可能根本不切实际（因此，不能扩展到更大的团队）。

例如，对于 Subversion，分支是一个指针副本，因此如果您正在尝试某些东西但想要提交，您可以轻松地创建一个 TRY 分支以避免损坏主干。

对于像 Git 这样的分布式版本控制系统，每次签出本质上都是一个分支。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-12T07:38:40.903

对锁定 VCS 的常见抱怨是，当有人去度假或开会时，您会遇到一些问题，因为您会锁定一些文件 :)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-05-02T20:52:44.823

我认为这取决于具体情况。如果你知道控制飞机的文件被多人同时更改然后合并，你会坐飞机吗？

在愚蠢的应用程序中可以使用合并方法，但如果我们谈论的是严肃的系统......比如银行系统等......

# php - 使用 PHP 在纯文本中替换变量的最佳方法

> ID：283222
> 
> 赞同：8
> 
> 时间：2008-11-12T07:08:36.410
> 
> 标签：php, variables, substitution

获取一些包含 PHP 样式变量的纯文本（不是 PHP 代码）的最佳方法是什么，然后替换为变量的值。这有点难以描述，所以这里有一个例子。

```
// -- myFile.txt --
Mary had a little $pet.

// -- parser.php --
$pet = "lamb";
// open myFile.txt and transform it such that...
$newContents = "Mary had a little lamb."; 
```

我一直在考虑使用正则表达式或者可能`eval()`，尽管我不确定哪个最简单。这个脚本只会在本地运行，所以任何关于安全问题的担忧`eval()`都不适用*（我认为？）*。

我还要补充一点，我可以使用以下方法将所有必要的变量放入数组中`get_defined_vars()`：

```
$allVars = get_defined_vars();
echo $pet;             // "lamb"
echo $allVars['pet'];  // "lamb" 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-12T07:17:26.360

正则表达式很容易。它不会关心那些`eval()`会考虑语法错误的事情。

这是查找 PHP 样式变量名称的模式。

```
\$\w+ 
```

我可能会采用这种通用模式并使用 PHP 数组来查找我找到的每个匹配项（使用 ( `preg_replace_callback()`)。这样正则表达式只需应用一次，从长远来看会更快。

```
$allVars = get_defined_vars();
$file = file_get_contents('myFile.txt');

// unsure if you have to use single or double backslashes here for PHP to understand
preg_replace_callback ('/\$(\w+)/', "find_replacements", $file);

// replace callback function
function find_replacements($match)
{
  global $allVars;
  if (array_key_exists($match[1], $allVars))
    return $allVars[$match[1]];
  else
    return $match[0];
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T08:39:58.347

如果它来自可信赖的来源，您可以使用（戏剧性的停顿）[eval()](http://www.php.net/eval)（观众惊恐的喘息）。

```
$text = 'this is a $test'; // single quotes to simulate getting it from a file
$test = 'banana';
$text = eval('return "' . addslashes($text) . '";');
echo $text; // this is a banana 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T07:17:23.053

这是我刚刚想出的，但我仍然想知道是否有更好的方法。干杯。

```
$allVars = get_defined_vars();
$file = file_get_contents('myFile.txt');

foreach ($allVars as $var => $val) {
    $file = preg_replace("@\\$" . $var . "([^a-zA-Z_0-9\x7f-\xff]|$)@", $val . "\\1", $file);
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T21:46:39.443

它必须是$pet吗？可以`<?= $pet ?>`代替吗？因为如果是这样，只需使用包含。这就是 php 作为模板引擎的全部想法。

```
//myFile.txt
Mary had a little <?= $pet ?>.

//parser.php

$pet = "lamb";
ob_start();
include("myFile.txt");
$contents = ob_end_clean();

echo $contents; 
```

这将回显：

```
Mary had a little lamb. 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T07:23:18.873

根据情况，[str_replace](http://us2.php.net/manual/en/function.str-replace.php)可能会成功。

例子：

```
// -- myFile.txt --
Mary had a little %pet%.

// -- parser.php --
$pet = "lamb";
$fileName = myFile.txt

$currentContents = file_get_contents($fileName);

$newContents = str_replace('%pet%', $pet, $currentContents);

// $newContents == 'Mary had a little lamb.' 
```

当您查看 str_replace 时，请注意搜索和替换参数可以使用值数组来搜索和替换。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-12T21:53:02.130

你可以使用[strtr](http://www.php.net/strtr)：

```
$text = file_get_contents('/path/to/myFile.txt'); // "Mary had a little $pet."
$allVars = get_defined_vars(); // array('pet' => 'lamb');
$translate = array();

foreach ($allVars as $key => $value) {
    $translate['$' . $key] = $value; // prepend '$' to vars to match text
}

// translate is now array('$pet' => 'lamb');

$text = strtr($text, $translate);

echo $text; // "Mary had a little lamb." 
```

您可能希望在 get_defined_vars() 中进行前置操作，因此您不会将变量循环两次。或者更好的是，只需确保您最初分配的任何键都与您在 myFile.txt 中使用的标识符相匹配。

# c++ - 使用什么 Web 服务/接口？

> ID：283227
> 
> 赞同：0
> 
> 时间：2008-11-12T07:12:31.610
> 
> 标签：c++, web-services, web-applications

我们正在设计一个带有 C/C++ 后端服务器和 C# .NET 前端的系统。我们希望提供一个类似于 C# .NET 前端的 Web 界面。你能建议最好的方法吗？例如，是否将 Web 服务器嵌入后端服务器本身？如何在 .NET 和 Web 界面之间拥有最大的公共代码以最大限度地减少维护等。提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T14:24:43.953

根据您的应用程序的需要，最好放弃 C# 客户端并只创建一个 Web 界面。这样，您的客户就可以通过不购买带有 .NET 框架的 Windows 机器来节省资金——您只需要一个浏览器。您还可以更新您的网站，并让所有客户立即从您的升级中受益。

但是，如果您决定同时构建两者，则有几条路径可供选择。您可以将业务逻辑放置在非常靠近后端服务器的位置。你甚至可以用 C++ 编写它。然后为每个客户端应用程序（Web 和桌面）拥有一个共享的通信层和单独的表示层。
另一种方法是将业务逻辑移近客户端。将其写入 .Net 并使其成为您的桌面应用程序和网站的一部分。该业务应用程序可以使用一些抽象策略（桌面客户端的肥皂和 Web 服务器的直接）与后端服务器通信。当然，这并不能真正使您免于在 C++ 后端服务器中编写验证代码。

# windows-firewall - 禁用程序通过 API 向 Windows 防火墙添加例外的能力

> ID：283229
> 
> 赞同：5
> 
> 时间：2008-11-12T07:16:58.513
> 
> 标签：windows-firewall, windows-firewall-api

这是 Windows 防火墙的一个问题，从它的介绍开始就非常烦人。并通过几个版本的窗口持续存在。

我有两个问题：

是否可以在 XP/2003 Server 中禁用或至少需要确认？

UAC 是否在 Vista/2008 服务器中处理此问题？如果没有 - 有没有办法禁用它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T10:37:10.810

可能会有所帮助-

[http://technet.microsoft.com/en-us/library/cc758407.aspx](http://technet.microsoft.com/en-us/library/cc758407.aspx)

从文件 -

您无法阻止程序使用 Windows 防火墙 API 将端口添加到例外列表。如果您需要防止这种情况，请联系程序供应商或阅读程序文档以查看是否有办法禁用侦听传入流量的功能。这可能会阻止程序使用 Windows 防火墙 API。

# visual-studio-2008 - 我的工具箱显示同一控件的多个副本（VS2008）

> ID：283238
> 
> 赞同：2
> 
> 时间：2008-11-12T07:23:37.127
> 
> 标签：visual-studio-2008, toolbox

我的 Visual Studio 完全搞砸了，我不知道为什么。请参阅下面的屏幕截图。对照重复 3 次。我尝试重置工具箱；仍然没有运气。**该解决方案包含一个 ASP.NET Web 应用程序和几个类库。所有项目都没有对 System.Windows.Form 的引用，仍然在“选择项目”对话框中选择了 System.Windows.Forms 中的组件。**

只有我或其他人曾经遇到过这样奇怪的问题吗？

[搞砸了 vs 工具箱 http://img525.imageshack.us/img525/9171/toolboxissuelu6.jpg](http://img525.imageshack.us/img525/9171/toolboxissuelu6.jpg)

——祖海布

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-15T17:31:40.823

您可能在磁盘缓存或设置中有您的工具箱项目。

1.  关闭 Visual Studio
2.  确保没有 devenv 实例正在运行。
3.  转到 Users\\AppData\Local\Microsoft 并查找 Visual Studio 临时文件。
4.  删除临时文件。
5.  转到 Users\\Documents\VisualStudio 2008\Settings 并备份您的设置文件，然后删除原件。
6.  重新打开 VS.NET，应该会提示您选择您的开发人员设置。

# ruby-on-rails - 我应该避免在 Rails 视图中检查 nil 吗？

> ID：283239
> 
> 赞同：7
> 
> 时间：2008-11-12T07:23:52.400
> 
> 标签：ruby-on-rails, ruby

在我的模型中，有很多属性和方法可以根据模型实例的属性执行一些计算。如果计算所依赖的属性为零，我一直让方法返回零。作为这个设计决定的结果，在我的视图中显示这些值之前，我做了很多 nil 检查。

当这些方法没有足够的信息时，我考虑过让这些方法返回零而不是零，但我选择了零，因为零是一个有效的计算结果，而零意味着没有足够的信息。

我应该返回 0 而不是 nil 吗？是否有任何其他模式可以用来避免在我的视图中进行一堆 nil 检查？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-12T08:33:27.267

I tend to think you are doing things right if your problem is choosing whether to display, or not display, the results of a calculation. If it would make no sense to display any value, then nil is perfectly reasonable.

If, however, your business logic is resulting in you getting into a state where much of the view will be habitually blank, then you probably should refactor such that your program loses its leaky abstractions.

Consider, for example, an application which starts by tracking recipes for `Food`. Then, as requirements morph, we get the notion of pies needing to display different information than burgers. Rather than having a `calculate_deliciousness_of_pie_or_nil_for_burger` method, and then checking for nil in the view, I'd break that into a pie view for pies and a burger view for burgers. This might (probably would) require rethinking my object abstractions.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T19:31:12.073

**“在我的视图中显示这些值之前，我做了很多 nil 检查。”**

我认为返回 nil 是个好主意。我有时使用的另一种方法是返回一个哈希值。例如，如果一个方法成功，我可能会返回：

```
{:result => 1234} 
```

如果方法“失败”，我可能会返回：

```
{:error => 'Insufficient attributes to calculate result.'} 
```

这使得无需猜测即可确定结果变得微不足道。

话虽如此，请确保创建辅助方法来调用这些方法并检查它们的结果。视图应该包含很少的逻辑。因此，不要这样做来控制是否显示结果：

```
<% if result = some_method -%>
  Your result is <%=h result -%>.<br />
<% end -%> 
```

你应该做这个：

```
<% display_some_method %> 
```

并且 #display_ some_ 方法位于 app/helpers/whatever_helper.rb 中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T12:53:39.737

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-26T20:02:13.603

我使用两种方法来解决这个问题。

我尝试将要求更高的检查移到模型中。例如，方法`Apartment#address_visible?(current_user)`使它更干净。

从 Rails 2.3 开始，还有`#try`一种方法只在方法已定义时才调用它。可以使用 chris 的[示例](http://ozmm.org/posts/try.html)轻松将其包含到您的项目中。这适用于最简单的情况。

# com - 为什么从 .NET BackgroundWorker 线程调用非托管代码会影响 UI？

> ID：283241
> 
> 赞同：0
> 
> 时间：2008-11-12T07:25:40.943
> 
> 标签：com, backgroundworker, unmanaged

`BackgroundWorker`我在 .NET 2.0线程中有一系列长时间运行的操作。当我调用位于引用程序集中的非托管代码时，UI 被冻结，直到调用完成。

为什么是这样？我不应该从`BackgroundWorker`线程中进行这些调用吗？

* * *

是的，它是一个 COM 组件，但我不确定如何判断它是否是 STA，以及它的含义/解决方案是什么。我对该组件进行了多次调用，但只有在长时间运行的情况下，我才注意到 UI 变得无响应。

这些调用从服务器检索数据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T07:52:05.727

您在问题中有 COM 标记 - 您是在调用 COM 组件吗？它是 STA 组件吗？如果是这样，它很可能会以某种方式编组回去在 UI 线程上完成其工作。我会欣然承认，我离成为 COM 方面的专家还有很长的路要走，但如果这是问题所在，我不会感到惊讶。

如果您从您明确创建的新线程进行调用，会发生什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T07:33:36.403

是的，而且，所有非托管代码或仅特定组件或 API 都会发生这种情况吗？如果是特定的，那非托管代码在做什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T08:00:43.840

此外，您可以简单地在 BackgroundWorker 中注释掉您当前的代码（您正在运行 RunWorkerAsync 正确...）并在那里休眠。如果您的 GUI 变得无响应，则某些事情是不对的，否则就是您调用的代码，正如 Jon 指出的那样，COM 可能就是这种情况。

# java - 如何从 Java 的 EMV 智能卡中读取 PAN

> ID：283251
> 
> 赞同：11
> 
> 时间：2008-11-12T07:32:14.490
> 
> 标签：java, smartcard, apdu, emv

我需要使用智能卡读卡器从 Maestro/Mastercard 读取帐号。我正在使用 Java 1.6 及其 javax.smartcardio 包。我需要发送 APDU 命令，该命令将询问存储在卡芯片上的 EMV 应用程序的 PAN 号。问题是，我找不到常规字节数组来构造 APDU 命令，该命令将在任何地方返回所需的数据......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T09:50:34.957

您不需要进一步包装 APDU。API 层应该解决这个问题。

看起来 0x6D00 响应只是意味着应用程序不支持 INS。

现在只是进行故障排除，但您确实是从选择 MasterCard 应用程序开始的，对吗？

即是这样的：

```
void selectApplication(CardChannel channel) throws CardException {
  byte[] masterCardRid = new byte[]{0xA0, 0x00, 0x00, 0x00, 0x04};
  CommandAPDU command = new CommandAPDU(0x00, 0xA4, 0x04, 0x00, masterCardRid);
  ResponseAPDU response = channel.transmit(command);
  return response.getData();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-20T07:53:37.650

这是一些工作示例：

```
CardChannel channel = card.getBasicChannel(); 

 byte[] selectMaestro={(byte)0x00, (byte)0xA4,(byte)0x04,(byte)0x00 ,(byte)0x07 ,(byte)0xA0 ,(byte)0x00 ,(byte)0x00 ,(byte)0x00 ,(byte)0x04 ,(byte)0x30 ,(byte)0x60 ,(byte)0x00};
  byte[] getProcessingOptions={(byte)0x80,(byte)0xA8,(byte)0x00,(byte)0x00,(byte)0x02,(byte)0x83,(byte)0x00,(byte)0x00};
  byte[] readRecord={(byte)0x00,(byte)0xB2,(byte)0x02,(byte)0x0C,(byte)0x00};

  ResponseAPDU r=null;

   try {
     ATR atr = card.getATR(); //reset kartice

      CommandAPDU capdu=new CommandAPDU( selectMaestro   );

       r=card.getBasicChannel().transmit( capdu );

      capdu=new CommandAPDU(getProcessingOptions);
      r=card.getBasicChannel().transmit( capdu );

      capdu=new CommandAPDU(readRecord);
      r=card.getBasicChannel().transmit( capdu ); 
```

这适用于 Maestro 卡，我可以读取 PAN 号码，但现在我需要读取 MasterCard 的 PAN 号码。我不知道我应该更改读取记录 APDU 还是选择应用程序 APDU。有人熟悉 APDU 吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T10:37:02.483

```
atr = open();
prints(atr);

prints("[Step 1] Select 1PAY.SYS.DDF01 to get the PSE directory");
cmd = new ISOSelect(ISOSelect.SELECT_AID, EMV4_1.AID_1PAY_SYS_DDF01);
card_response = execute(cmd);
prints(card_response);
SFI = NumUtil.hex2String((byte)((1 < < 3) | 4));

// try SFI 1 record 1
prints("[Step 2] Send READ RECORD with 0 to find out where the record is");
read = new EMVReadRecord(SFI, "01", "00");
card_response = execute(read);
prints(card_response);
byte_size = NumUtil.hex2String(card_response.getStatusWord().getSw2());

prints("[Step 3] Send READ RECORD with 1C to get the PSE data");
read = new EMVReadRecord(SFI, "01", byte_size);
card_response = execute(read);
prints(card_response);
// the AID is A0000000031010
prints("[Step 4] Now that we know the AID, select the application");

cmd = new ISOSelect(ISOSelect.SELECT_AID, "A0000000031010");
card_response = execute(cmd);
prints(card_response);
prints("[Step 5] Send GET PROCESSING OPTIONS command");

cmd = new EMVGetProcessingOptions();
card_response = execute(cmd);
prints(card_response);

// SFI for the first group of AFL is 0C

prints("[Step 6] Send READ RECORD with 0 to find out where the record is");
read = new EMVReadRecord("0C", "01", "00");
card_response = execute(read);
prints(card_response);
byte_size = NumUtil.hex2String(card_response.getStatusWord().getSw2());

prints("[Step 7] Use READ RECORD with the given number of bytes to retrieve the data");
read = new EMVReadRecord("0C", "01", byte_size);
card_response = execute(read);
prints(card_response);

data = new TLV(card_response.getData());

close(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T09:50:50.450

您需要构建一个 CommandAPDU 对象并将其传递给传输（）命令。

您应该能够在智能卡的文档中找到准确的命令，但这里有一个示例：

```
byte[] readFile(CardChannel channel) throws CardException {
  CommandAPDU command = new CommandAPDU(0xB0, 0x60, 0x10, 0x00);
  ResponseAPDU response = channel.transmit(command);
  return response.getData();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T12:14:16.137

您是否尝试在文档中查找 0x6D00 的含义？看起来这可能意味着不支持 ENVELOPE 命令。您是否尝试过使用 T=0 协议而不是 T=1？

我不希望我的示例适用于您的卡片。我不知道 Maestro/MasterCard 支持哪些 APDU，所以我不能给你一个可行的例子。

尝试给命令一个明确的预期长度，如下所示：

```
byte[] readPan(CardChannel channel) throws CardException {
  CommandAPDU command = new CommandAPDU(0x00, 0xB2, 0x5a, 0x14, 250);
  ResponseAPDU response = channel.transmit(command);
  return response.getData();
} 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2014-08-08T11:18:14.577

如何使用扫描仪，获取卡片图片，使用良好的 java ocr 库（例如[http://ocr4j.sourceforge.net/](http://ocr4j.sourceforge.net/)）扫描图片内容并搜索（通常）16 位序列XXXX-XXXX-XXXX-XXXX ，然后您将使用 java 从任何 EMV 卡获取 PAN。

# sql-server - 如何从 ascmd.cs -.csproj 和 -.sln 文件中获取 ascms.exe？

> ID：283259
> 
> 赞同：1
> 
> 时间：2008-11-12T07:39:14.817
> 
> 标签：sql-server, visual-studio, ascmd

我已经下载了 MS SQL Server 2005 的示例，但我不知道如何从 ascmd.sln、ascmd.cs、ascmd.csproj 等文件中获取 .exe 文件。当我尝试在 Visual Studio 中启动 .sln 文件时，出现如下错误：

> 项目 C:\project_path\project_name 的应用程序未安装

我需要 C# 编译器或类似的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T21:28:20.197

是的，您需要编译 .CS 文件。编译器是 Visual Studio Express（[下载](http://www.microsoft.com/express/download/)）的一部分。您将需要 C# 版本。

你已经安装了它，你可以运行命令“csc ascmd.cs”来编译。csc 位于 %windir%\Microsoft.NET\Framework\v3.5\csc.exe

或者，您可以从 IDE 编译。只需双击 .sln 或 .csproj 文件，IDE 就会打开。CRTL+SHIFT+B 编译。F5 运行。

Thev v3.5 将根据您安装的版本而有所不同。

# cron - 为什么只为 apt-get cron 作业下载

> ID：283263
> 
> 赞同：3
> 
> 时间：2008-11-12T07:43:26.620
> 
> 标签：cron, crontab, apt-get

我正在执行一项 crontab 任务，每天使用 apt-get 更新一次（运行 Debian Lenny，几乎每天都有更新）。但是我看到的几乎所有关于这个 cron 作业的例子都调用了 -d 标志。

这引出了4个问题：

*   为什么我应该只下载软件包而不安装它们？
*   这不会破坏自动运行它的目的吗？
*   我以后不需要进去实际安装更新吗？
*   我在没有 -d 标志的情况下运行 cron 作业是否安全？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T08:03:19.560

您的操作是错误的假设——apt-get（或 aptitude）都不是自动运行的，Debian 打包系统也不是真正为它设计的。这就是工具使其变得困难的原因。

当您忘记更新配置文件导致软件升级中断时会发生什么？这在过去发生在我身上（apache2），有些后果严重，导致机器无法启动（mdadm）。当软件引入了您不想要的依赖项（即在服务器上引入整个 X11 窗口系统）时会发生什么？等等等等……

如果您担心自动安装安全升级，您可以查看[unattended-upgrades](http://packages.debian.org/lenny/unattended-upgrades)软件包。它将为您从安全档案中下载和安装软件包。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T08:26:13.770

我运行一个 Ubuntu 服务器，并且每周以 root 身份运行一次。

```
/usr/bin/apt-get update && /usr/bin/apt-get -s -u upgrade 
```

'-s' 选项告诉 apt-get “模拟”更新软件包，但实际上不做任何事情。
最终效果是我收到一封电子邮件（通过 cron），告诉我有哪些新软件包可用。

然后我可以登录并手动运行它，事先采取必要的预防措施（备份等）。

希望这可以帮助。

# sql - Sql Server 2000 中的回滚和更新命令

> ID：283274
> 
> 赞同：1
> 
> 时间：2008-11-12T07:58:02.173
> 
> 标签：sql, sql-server, sql-server-2000, rollback

我错误地使用了更新命令来更新 Sql Server 2000 数据库中的整个表。我实际上的意思是只更新一行。现在所有 2000 行都包含更新。有没有办法回滚这个变化？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T08:37:47.400

除非您通过显式事务开始更新，否则不会。

但是，您也许可以使用[Log Rescue](http://www.red-gate.com/products/SQL_Log_Rescue/index.htm)。我不确定在这种情况下这是否可以帮助您。

更好的选择可能是将备份还原到新数据库并合并新旧表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T08:37:56.120

不，除非您有要恢复的备份。

我曾经犯过这样的错误。现在我用 BEGIN TRAN 开始每个手动操作。那时可能发生的最糟糕的情况是您忘记了 COMMIT TRAN 并在表上保持锁定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T15:59:38.100

如果您有可用的审核日志，请使用这些日志恢复到旧状态。否则，您将需要在该时间点恢复到最新备份。有一些产品可以让您检查日志并从中获取特定数据 Lumigent 的日志资源管理器 ( [http://www.ssw.com.au/SSW/LogExplorer/](http://www.ssw.com.au/SSW/LogExplorer/) ) 就是其中之一，但它们往往价格昂贵如果您还没有它们，也不会立即为您提供帮助。

如果您没有当前备份和/或没有审计表，我会更新我的简历。

# delphi - 实现可变长度数组的最佳方法是什么？

> ID：283275
> 
> 赞同：1
> 
> 时间：2008-11-12T07:58:29.100
> 
> 标签：delphi, arrays, variable-length

我想将数据库中的大型结果集存储在内存中。每条记录都有可变长度，访问时间必须与数组一样快。实现这一点的最佳方法是什么？我正在考虑将偏移量保存在单独的表中并连续存储所有记录？奇怪吗？（编程语言：德尔福）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T10:43:55.227

不确定我是否完全跟随你，但看看 TList。

至少在 Delphi 7 中，它被实现为一个指针数组。如果您知道有多少结果返回，您可以使用容量属性提前预先分配列表。

如果空间不足，列表将自动增长。它增长多少取决于列表有多大。

查看 classes 单元的源代码，看看它在做什么。

编辑：同样在 D2009 中，TList 中添加了泛型支持，这使它更好用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T08:02:32.960

最好的方法可能是包含一个指向记录的指针数组。在这种情况下，您不必处理偏移量，并且查找将是恒定的时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T11:22:40.217

我会使用 TList，并存储指向您的记录的指针。

```
type
  pMyRecord : ^TMyRecord;
...
...
...
var
  p : pMyRecord;
...
...
New(p);
with p^ do
begin
  ...
  ...
end;
...
MyList.Add(P); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T11:25:31.303

为什么不使用数据库的 MEMORY 版本？大多数都有办法将完整的表保存在内存中，通常涉及 SQL 关键字 MEMORY。您将表从磁盘复制到内存表，然后可以以内存速度使用所有正常的数据库操作。我知道这在 DBISAM 中效果很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T17:03:21.980

在[mj2008](https://stackoverflow.com/users/5544/mj2008)之后，您可以使用 TCLientDataset 而不是记录数组。该结果集有多大？

# delphi - EStackOverflow 被弃用了多长时间，它的替代品是什么？

> ID：283281
> 
> 赞同：9
> 
> 时间：2008-11-12T08:03:16.563
> 
> 标签：delphi, exception, deprecated, stack-overflow

我注意到 SysUtils.pas 中定义的 EStackOverflow 在 Delphi 2009 中被标记为已弃用。我检查并在 2007 年也被标记为已弃用。我在这里有一个 Delphi 7 安装磁盘，但我想我会问是否有人知道什么时候它已被弃用。

此外，有谁知道为什么，以及什么取代它？我编写了一个通过递归导致堆栈溢出的测试应用程序，我仍然得到一个 EStackOverflow 异常，但是如果我专门为它添加一个处理程序，那么我得到

> [DCC 警告] Unit57.pas(85): W1000 符号 'EStackOverflow' 已弃用

我知道 EStackOverflow 是 EExternal 的后代，我可以捕获 EExternal 并检查 STATUS_STACK_OVERFLOW 的 ExceptionCode，但这似乎没有必要，因为它仍然会引发 EStackOverflow 异常。

这只是为了阻止我在自己的代码中抛出 EStackOverflow 吗？

*（是的，我意识到在一个名为**StackOverflow**的网站上询问有关**EStackOverflow**的问题具有讽刺意味，是的，**我非常认真**。）*

 ***** * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T16:57:37.843

我这里没有 D5 可说，但我几乎不记得**弃用**指令仅出现在 D6 上。

至于 StackOverflow 异常，我认为它已被弃用，因为它仅适用于 Delphi 运行时环境来引发它。

编辑：根据所有答案的汇总，当引入 Deprecated 关键字时，EStackOverflow 在 Delphi 6 中已被弃用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T20:41:46.073

就像在 .NET 中一样，您无法真正捕获 StackOverflow 异常，您会恢复到什么？如果您需要捕获一个，您的代码很可能是错误的:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T10:25:01.643

我刚刚检查了我的 Delphi 6，并且 EStackOverflow 已经被弃用了。我在这里无法访问旧版本的 Delphi。

我无法帮助您解释原因或可能的替代品。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T13:54:56.603

在 Delphi 5 中，它还没有被弃用。

编辑：实际上，在 Delphi 5 中，'deprecated' 不是保留字。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T12:27:48.713

> 这只是为了阻止我在自己的代码中抛出 EStackOverflow 吗？

更重要的是，我认为这意味着您不应该将代码设计为依赖于在未来版本中抛出的代码。

# excel - 如何让 TFS 中的 Excel 集成以记住格式？

> ID：283284
> 
> 赞同：0
> 
> 时间：2008-11-12T08:04:50.523
> 
> 标签：excel, tfs

当我使用 Excel 集成功能（我们使用 Excel 2003）创建查询的 TFS 报告时，单击 TFS 工具栏中的“刷新”按钮后，Excel 会重置所有单元格的格式。

我们的团队喜欢打印这份报告并将其拖到我们的每周会议中，因为它准确地列出了我们所有未完成的任务。但是，糟糕的格式是一种痛苦：垂直对齐设置为“底部”并且单元格上没有边框使得几乎不可能知道一个任务/错误何时开始而另一个结束......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T07:51:00.307

我最终这样做了：

*   `tfpt.exe`（[团队基础动力工具](http://msdn.microsoft.com/en-us/tfs2008/bb980963.aspx)）
*   查询 xml：（`tfpt query /format:xml`在此处添加您的查询名称等）
*   使用 XSL 将其转换为 html 表
*   编写一个简单的批处理脚本来完成上述步骤
*   （利润！！！）

这是我使用的 XSL 脚本（如果您使用其他字段，则需要 tweeking）：

```
<?xml version="1.0" encoding="UTF-8"?>

<xsl:stylesheet version="1.0" 
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:spss="http://xml.spss.com/spss/oms"
    exclude-result-prefixes="spss">

<xsl:template match="/">
<html>
    <head>
        <title>All active Work Items</title>
    </head>
    <body>
        <table border="1" frame="border" rules="all">
            <tr><th>ID</th><th>Area Path</th><th>Assigned To</th><th>Title</th><th>Description</th></tr>
            <xsl:for-each select=".//WorkItem">
                <tr>
                    <td><xsl:value-of select="./Field[@RefName='System.Id']/@Value"/></td>
                    <td><xsl:value-of select="./Field[@RefName='System.AreaPath']/@Value"/></td>
                    <td><xsl:value-of select="./Field[@RefName='System.AssignedTo']/@Value"/></td>
                    <td><xsl:value-of select="./Field[@RefName='System.Title']/@Value"/></td>
                    <td><xsl:value-of select="./Field[@RefName='System.Description']/@Value"/></td>
                </tr>
            </xsl:for-each>
        </table>    
    </body>           
</html>
</xsl:template>

</xsl:stylesheet> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T22:35:17.530

我的猜测是，由于 Microsoft 在 VS 2010 CTP 中使用此功能，因此目前不支持。

您最好的选择可能是创建具有所有适当格式的工作表，然后从*实时*excel 工作表剪切并粘贴到格式化工作表中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T22:15:18.443

我遇到了同样的问题......

TFS Refresh 还不错，但是当查询停止工作并且您必须重新添加它时，它会插入行来创建数据，从而使指向信息的任何链接都损坏（或查找错误的位置！）

我最终将 TFS 查询放入“TFS 查询”工作表，我从对查询字段进行计算的工作表中引用了该工作表（它使用间接、偏移和匹配函数，因此工作表中没有计算依赖性TFS 查询表。这就像一个魅力，我什至可以删除查询，然后重新添加它。

# python - 使用 Emacs 进行 Django 调试

> ID：283294
> 
> 赞同：23
> 
> 时间：2008-11-12T08:15:26.180
> 
> 标签：python, django, debugging, emacs

我发现了很多关于如何使用 Emacs 调试简单 Python 程序的信息。但是如果我想调试一个 Django 应用程序呢？我运行开发服务器，我想以某种方式从 Emacs 附加到进程，然后设置断点等。类似于 Visual Studio 的“附加到进程”。怎么做？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-12T16:57:37.967

这不是 emacs 特定的，但您可以通过将以下内容添加到 Django 视图函数来使用 Python 调试器：

`import pdb; pdb.set_trace()`

现在，当您运行开发服务器并查看页面时，您的浏览器将出现挂起或加载非常缓慢的情况——切换到您的控制台，您就可以访问完整的调试器了。您可以通过交互式外壳检查和修改应用程序的状态 - 查看调试器的 Python 文档，或查看一些[Python 调试示例的链接](http://www.onlamp.com/pub/a/python/2005/09/01/debugger.html)

* * *

如果您只需要记录，请将以下内容添加到您的`settings.py`：

```
logging.basicConfig(
    level = logging.DEBUG,
    format = '%(asctime)s %(levelname)s %(message)s',
    filename = '/tmp/mylog.log',
    filemode = 'w'
) 
```

现在，您可以`/tmp/mylog.log`通过将以下内容添加到任何视图函数来记录消息：

```
import logging
logging.debug("Something happened") 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-11-03T07:33:57.273

像这样启动 pdb：

`M-x` `pdb`

然后，启动 Django 开发服务器：

```
python manage.py runserver --noreload 
```

出现 (Pdb) 提示后，您需要执行以下操作：

```
import sys
sys.path.append('/path/to/directory/containing/views.py') 
```

完成此操作后，您应该能够正常设置断点。只需导航到您想要的行号，然后

`C-x` `SPC`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T10:01:41.520

这是我昨晚发现的一些东西，当程序崩溃时，它会完全按照你的意愿行事：

[http://code.google.com/p/django-command-extensions/](http://code.google.com/p/django-command-extensions/)

安装后，您可以运行：

> python manage.py runserver_plus

并且您将`AJAX console`在您的`Error`页面上进行交互。（显然，当以该模式运行时，请注意人们对该 Web 服务器的访问量。）

GitHub：[https ://github.com/django-extensions/django-extensions](https://github.com/django-extensions/django-extensions)

您可以使用 pip 或 easy_install 获取 Django 扩展：

> $ pip install django-extensions 或 $ easy_install django-extensions

如果您想从源代码安装它，请从 GitHub 获取 git 存储库并运行 setup.py：

> $ git clone git://github.com/django-extensions/django-extensions.git
> $ cd django-extensions
> $ python setup.py install

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-14T15:27:25.763

因为最新版本的 Emacs python 模式默认支持 'pdbtrack' 功能，所以你只需要通过这种方式在代码中设置断点：

```
import pdb; pdb.set_trace() 
```

此外，您必须从 Emacs shell 中启动 Django 应用程序开发服务器：

`M-x` `shell`

然后，在 shell 中，启动 Django 开发服务器：

```
python ./manage.py runserver 
```

PS 不需要特定的 pdb 会话或 --noreload 标志。Noreload 将要求您手动重新启动应用程序，因此我认为这对 Emacs 没有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T14:16:45.903

我对此一无所知，但是将“使用 emacs 调试 Python”放入 Google 给了我这个关于[使用 emacs 进行调试的](http://twistedmatrix.com/projects/core/documentation/howto/debug-with-emacs.html)页面，所以这似乎是可能的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-13T08:02:12.757

关于一般的非 emacs 专有方式，有一个非常好的截屏视频，您可能会感兴趣：[http ://ericholscher.com/blog/2008/aug/31/using-pdb-python-debugger-django-调试系列-/](http://ericholscher.com/blog/2008/aug/31/using-pdb-python-debugger-django-debugging-series-/)

上面描述的 emacs 集成对我来说还不起作用。它似乎并没有真正连接到正在运行的应用程序。

此外，我认为这篇博文非常有趣：[http ://web.archive.org/web/20101230072606/http://panela.blog-city.com/python_and_emacs_5_pdb_and_emacs.htm](http://web.archive.org/web/20101230072606/http://panela.blog-city.com/python_and_emacs_5_pdb_and_emacs.htm)

古罗马

# c++ - 64 位的 SendMessage API

> ID：283295
> 
> 赞同：0
> 
> 时间：2008-11-12T08:15:32.497
> 
> 标签：c++, c, winapi

根据 MSDN

> 返回值指定消息处理的结果；这取决于发送的消息。

我知道它被定义为

```
typedef LONG_PTR LRESULT; 
```

这意味着它将在 64 位机器上为 8 个字节，但事实并非如此！

有谁知道假设只使用低 4 个字节并将其存储为`INT`（例如）是否安全。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T08:38:51.483

不，这不安全，因为返回值是由正在发送的消息和处理程序定义的。

如果您控制处理程序和消息，那么它是可能的，在一般情况下它是不安全的。

詹姆士

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T08:43:15.453

不，一般来说不安全。不要假设沮丧。此外，有用的是使用 /RTCc 编译您的代码，以确保在运行时断言无意的强制转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T09:49:10.203

绝对不安全。如果消息返回确实是一个指针，那么指针很有可能设置它的第 33 位——尤其是在内存大于 4GB 的机器上。

# c++ - 将动态分配的内存从 C++ 返回到 C

> ID：283297
> 
> 赞同：2
> 
> 时间：2008-11-12T08:18:50.183
> 
> 标签：c++, c, memory-management

我有一个必须可以从 C 等中使用的 dll，所以我不能像往常一样使用字符串对象等，但我不确定如何安全地做到这一点。

```
const char *GetString()
{
    std::stringstream ss;
    ss << "The random number is: " << rand();
    return ss.str().c_str();
} 
```

当 ss 从堆栈中掉下来时，c 字符串会被破坏吗？我假设是这样...

另一种选择可能是在堆上创建一个新字符串，但要如何解除分配呢？

```
const char *GetString()
{
    std::stringstream ss;
    ss << "The random number is: " << rand();
    char *out = new char[ss.str().size()];
    strcpy(ss.str().c_str(), out);
    return out;//is out ever deleted?
} 
```

指向其他事物以及字符串的指针也是如此。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-12T08:32:48.500

第一个变体不起作用，因为您将指针返回到堆栈对象，该对象将被销毁。（更确切地说，您返回一个指向堆内存的指针，该指针将被删除（）。）更糟糕的是，如果没有人覆盖内存，它甚至可能工作一段时间，这使得调试变得非常困难。

接下来，您不能返回 const char*，除非您返回指向静态字符串的指针，如下所示：

```
const char *GetString()
{
    return "a static string in DATA segment - no need to delete";
} 
```

您的第二个变体存在将使用 new() 分配的内存返回到将调用 free() 的 C 程序的问题。这些可能不兼容。

如果将字符串返回给 C，有两种方法可以做到这一点：

```
char *GetString()
{
    std::stringstream ss;
    ss << "The random number is: " << rand();
    return strdup( ss.str().c_str() ); // allocated in C style with malloc()
}

void foo()
{
    char *p = GetString();
    printf("string: %s", p));
    free( p ); // must not forget to free(), must not use delete()
} 
```

或者：

```
char *GetString(char *buffer, size_t len)
{
    std::stringstream ss;
    ss << "The random number is: " << rand();
    return strncpy(buffer, ss.str().c_str(), len); // caller allocates memory
}

void foo()
{
    char buffer[ 100 ];
    printf("string: %s", GetString(buffer, sizeof( buffer ))); // no memory leaks
} 
```

取决于您的内存处理策略。

通常，您永远不能在 C++ 中返回指向自动对象的指针或引用。这是许多 C++ 书籍中分析的常见错误之一。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T12:08:22.340

多年来，C 将其归结为两种标准方法：

*   调用者传入缓冲区。
    这有三个版本。
    版本 1：传递缓冲区和长度。
    版本 2：文档指定了预期的最小缓冲区大小。
    第 3 版：飞行前。函数返回所需的最小缓冲区。调用者第一次使用 NULL 缓冲区调用两次。
    *   示例：读取（）
*   使用在下一次调用之前有效的静态缓冲区。
    *   示例：tmpname()

一些非标准的返回你必须明确释放的内存

*   strdup() 浮现在脑海中。
    通用扩展，但实际上不在标准中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T08:28:14.733

第一个实际上不起作用，因为字符串流在销毁时释放了它的空间。因此，如果您尝试取消引用该指针，那么您的程序很可能会崩溃。

您提到的第二个选项是它通常是如何完成的，并且该函数的用户需要释放空间。如果这是一个使用该函数的 C 程序，请确保使用 malloc() 分配并使用 free() 释放

另一种选择是返回静态字符数组的地址。如果您事先知道长度的良好上限，则这是相关的。更重要的是，只有在不可能同时从两个不同的线程调用函数时才应该使用它，因为使用静态数组本质上会使您的函数不可[重入](http://en.wikipedia.org/wiki/Reentrant_(subroutine))。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T08:29:43.857

很明显，每当您返回指向函数内部分配的内存的指针时，解除分配必须来自外部，除非您使用垃圾收集。如果您不想这样做，请在调用 GetString() 之前分配一个字符缓冲区并将原型更改为

int get_string(const char* buffer);

然后填满缓冲区。但是将一个点返回到 malloced 数据是可以的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T08:30:06.213

如果将 ss 声明为静态，则可以避免该问题。如果您的程序在单线程环境中运行，这可能是一个很好的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T08:30:28.413

如果你想安全地返回它，你必须在堆上分配字符串，在编写 C 函数时也使用 malloc() iso new() 进行分配。

当您返回指针时（并且，与 C++ 不同，在 C 中您很多时候没有真正的选择），释放总是一个问题。真的没有一个确定的解决方案。

我在相当多的 API 中看到的一种处理方法是调用所有函数

```
CreateString() 
```

当调用者需要释放内存时，以及

```
GetString() 
```

当这不是问题时。

这当然不是万无一失的，但如果有足够的纪律，这是我见过的最好的方法，说实话......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T09:16:27.633

如果线程安全不重要，

```
const char *GetString()
{
    static char *out;
    std::stringstream ss;
    ss << "The random number is: " << rand();
    delete[] out;
    char *out = new char[ss.str().size()];
    strcpy(ss.str().c_str(), out);
    return out;//is out ever deleted?
} 
```

然后该函数可以接管解除分配字符串的责任。

如果线程安全很重要，

那么最好的方法就是将它作为参数传入，例如，

```
void GetString(char *out, int maxlen); 
```

我观察到当旧的非线程安全 API 更改为线程安全时会发生这种情况。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T09:28:13.740

调用函数后，您将希望调用者负责字符串的内存（尤其是取消分配它）。除非你想使用静态变量，但有龙！干净地做到这一点的最好方法是让调用者首先分配内存：

```
void foo() {
  char result[64];
  GetString(result, sizeof(result));
  puts(result);
}
```

然后 GetString 应该是这样的：

```
int GetString(char * dst, size_t len) {
  std::stringstream ss;
  ss << "The random number is: " << rand();
  strncpy(ss.str().c_str(), dst, len);
}
```

传递最大缓冲区长度并使用 strncpy() 将避免意外覆盖缓冲区。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-06-03T19:56:01.293

到目前为止的答案并没有解决一个非常重要的问题，即如果结果所需缓冲区的长度未知并且可以在调用之间更改，即使使用相同的参数（例如从数据库中读取值），该怎么办，所以我提供了我认为是处理这种情况的最佳方法。

如果事先不知道大小，请考虑将回调函数传递给您的函数，该函数接收`const char*`作为参数：

```
typedef void (*ResultCallback)( void* context, const char* result );

void Foo( ResultCallback resultCallback, void* context )
{
     std::string s = "....";
     resultCallback( context, s.c_str() );
} 
```

的实现`ResultCallback`可以分配所需的内存并复制指向的缓冲区`result`。我假设 C，所以我没有`void*`明确地投射到/从。

```
void UserCallback( void* context, const char* result )
{
    char** copied = context;
    *copied = malloc( strlen(result)+1 );
    strcpy( *copied, result );
}

void User()
{
    char* result = NULL;

    Foo( UserCallback, &result );

    // Use result...
    if( result != NULL )
        printf("%s", result);

    free( result );
} 
```

这是最便携的解决方案，甚至可以处理无法提前知道返回字符串大小的最棘手的情况。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-06-03T21:29:41.443

# algorithm - Best Compression algorithm for a sequence of integers

> ID：283299
> 
> 赞同：71
> 
> 时间：2008-11-12T08:19:07.483
> 
> 标签：algorithm, compression

I have a large array with a range of integers that are mostly continuous, eg 1-100, 110-160, etc. All integers are positive. What would be the best algorithm to compress this?

I tried the deflate algorithm but that gives me only 50% compression. Note that the algorithm cannot be lossy.

All numbers are unique and progressively increasing.

Also if you can point me to the java implementation of such algorithm that would be great.

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2013-02-12T22:28:39.507

我们最近撰写了研究论文，调查了解决这个问题的最佳方案。请参见：

Daniel Lemire 和 Leonid Boytsov，通过矢量化每秒解码数十亿个整数，软件：实践与经验 45 (1)，2015。http [://arxiv.org/abs/1209.2137](http://arxiv.org/abs/1209.2137)

Daniel Lemire、Nathan Kurz、Leonid Boytsov，SIMD 压缩和排序整数的交集，软件：实践和经验（待发表）[http://arxiv.org/abs/1401.6399](http://arxiv.org/abs/1401.6399)

它们包括广泛的实验评估。

您可以在线找到 C++11 中所有技术的完整实现： [​​https://github.com/lemire/FastPFor](https://github.com/lemire/FastPFor)和[https://github.com/lemire/SIMDCompressionAndIntersection](https://github.com/lemire/SIMDCompressionAndIntersection)

还有 C 库：[https](https://github.com/lemire/simdcomp) ://github.com/lemire/simdcomp和[https://github.com/lemire/MaskedVByte](https://github.com/lemire/MaskedVByte)

如果您更喜欢 Java，请参阅[https://github.com/lemire/JavaFastPFOR](https://github.com/lemire/JavaFastPFOR)

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-11-12T10:57:11.330

首先，通过获取每个值与前一个值之间的差异来预处理您的值列表（对于第一个值，假设前一个值为零）。在您的情况下，这应该主要给出一个序列，大多数压缩算法可以更容易地对其进行压缩。

这就是 PNG 格式改进其压缩的方式（它采用几种不同的方法之一，后跟 gzip 使用的相同压缩算法）。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-11-12T08:35:34.673

Well, i'm voting for smarter way. All you have to store is [int:startnumber][int/byte/whatever:number of iterations] in this case, you'll turn your example array into 4xInt value. After it you can compress as you want :)

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-07-04T07:52:47.647

虽然您可以设计特定于您的数据流的自定义算法，但使用现成的编码算法可能更容易。[我对 Java 中可用的压缩算法](http://www.theeggeadventure.com/wikimedia/index.php/Java_Data_Compression)进行了一些测试，发现一百万个连续整数序列的压缩率如下：

```
None        1.0
Deflate     0.50
Filtered    0.34
BZip2       0.11
Lzma        0.06 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-07-04T08:06:35.593

数字是多少？除了其他答案之外，您还可以考虑 base-128 变体长度编码，它允许您将较小的数字存储在单个字节中，同时仍然允许较大的数字。MSB 的意思是“还有另一个字节”——这在此处进行了[描述](http://code.google.com/apis/protocolbuffers/docs/encoding.html#varints)。

将此与其他技术相结合，以便存储“skip size”、“take size”、“skip size”、“take size”——但请注意，“skip”和“take”都不会为零，所以我们将从每个中减去一个（这可以让您为少数几个值节省一个额外的字节）

所以：

```
1-100, 110-160 
```

是“skip 1”（假设从零开始，因为它使事情变得更容易），“take 100”，“skip 9”，“take 51”；从每个中减去 1，给出（作为小数）

```
0,99,8,50 
```

编码为（十六进制）：

```
00 63 08 32 
```

如果我们想跳过/取一个更大的数字——例如 300；我们减去 1 得到 299 - 但这超过了 7 位；从小端开始，我们对 7 位块和一个 MSB 进行编码以指示继续：

```
299 = 100101100 = (in blocks of 7): 0000010 0101100 
```

所以从小端开始：

```
1 0101100 (leading one since continuation)
0 0000010 (leading zero as no more) 
```

给予：

```
AC 02 
```

所以我们可以很容易地对大数字进行编码，但小数字（这听起来很典型的skip/take）占用的空间更少。

您可以**尝试**通过“放气”运行它，但它可能无济于事......

* * *

如果您不想自己处理所有那些乱七八糟的编码...如果您可以创建值的整数数组 (0,99,8,60) - 您可以使用[带有打包重复 uint32/ 的协议缓冲区uint64](http://code.google.com/apis/protocolbuffers/docs/proto.html) - 它会为你做所有的工作;-p

我不“做”Java，但这是一个完整的 C# 实现（从我的[protobuf-net](http://code.google.com/p/protobuf-net/)项目中借用一些编码位）：

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
static class Program
{
    static void Main()
    {
        var data = new List<int>();
        data.AddRange(Enumerable.Range(1, 100));
        data.AddRange(Enumerable.Range(110, 51));
        int[] arr = data.ToArray(), arr2;

        using (MemoryStream ms = new MemoryStream())
        {
            Encode(ms, arr);
            ShowRaw(ms.GetBuffer(), (int)ms.Length);
            ms.Position = 0; // rewind to read it...
            arr2 = Decode(ms);
        }
    }
    static void ShowRaw(byte[] buffer, int len)
    {
        for (int i = 0; i < len; i++)
        {
            Console.Write(buffer[i].ToString("X2"));
        }
        Console.WriteLine();
    }
    static int[] Decode(Stream stream)
    {
        var list = new List<int>();
        uint skip, take;
        int last = 0;
        while (TryDecodeUInt32(stream, out skip)
            && TryDecodeUInt32(stream, out take))
        {
            last += (int)skip+1;
            for(uint i = 0 ; i <= take ; i++) {
                list.Add(last++);
            }
        }
        return list.ToArray();
    }
    static int Encode(Stream stream, int[] data)
    {
        if (data.Length == 0) return 0;
        byte[] buffer = new byte[10];
        int last = -1, len = 0;
        for (int i = 0; i < data.Length; )
        {
            int gap = data[i] - 2 - last, size = 0;
            while (++i < data.Length && data[i] == data[i - 1] + 1) size++;
            last = data[i - 1];
            len += EncodeUInt32((uint)gap, buffer, stream)
                + EncodeUInt32((uint)size, buffer, stream);
        }
        return len;
    }
    public static int EncodeUInt32(uint value, byte[] buffer, Stream stream)
    {
        int count = 0, index = 0;
        do
        {
            buffer[index++] = (byte)((value & 0x7F) | 0x80);
            value >>= 7;
            count++;
        } while (value != 0);
        buffer[index - 1] &= 0x7F;
        stream.Write(buffer, 0, count);
        return count;
    }
    public static bool TryDecodeUInt32(Stream source, out uint value)
    {
        int b = source.ReadByte();
        if (b < 0)
        {
            value = 0;
            return false;
        }

        if ((b & 0x80) == 0)
        {
            // single-byte
            value = (uint)b;
            return true;
        }

        int shift = 7;

        value = (uint)(b & 0x7F);
        bool keepGoing;
        int i = 0;
        do
        {
            b = source.ReadByte();
            if (b < 0) throw new EndOfStreamException();
            i++;
            keepGoing = (b & 0x80) != 0;
            value |= ((uint)(b & 0x7F)) << shift;
            shift += 7;
        } while (keepGoing && i < 4);
        if (keepGoing && i == 4)
        {
            throw new OverflowException();
        }
        return true;
    }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-07-08T16:07:47.483

[TurboPFor：最快的整数压缩](https://github.com/powturbo/TurboPFor)

*   用于 C/C++，包括 Java Critical Natives/JNI 接口
*   SIMD 加速整数压缩
*   用于已排序/未排序整数列表的标量 + 集成 (SIMD) 差分/之字形编码/解码
*   全范围 8/16/32/64 位整数列表
*   直接访问
*   基准应用

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-12T08:31:31.483

compress the string "1-100, 110-160" or store the string in some binary representation and parse it to restore the array

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-07-04T08:34:29.357

除了其他解决方案：

您可以找到“密集”区域并使用位图来存储它们。

例如：

如果在 1000-3000 之间的 400 个范围中有 1000 个数字，则可以使用一个位来表示数字的存在，并使用两个整数来表示范围。此范围的总存储空间为 2000 位 + 2 个整数，因此您可以将该信息存储在 254 字节中，这非常棒，因为即使是短整数也会占用两个字节，因此对于本示例，您可以节省 7 倍。

区域越密集，这个算法的效果就越好，但在某些时候，只存储开始和结束会更便宜。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-12T11:34:12.520

我会结合 CesarB 和 Fernando Miguélez 给出的答案。

首先，存储每个值与前一个值之间的差异。正如 CesarB 指出的那样，这将为您提供一系列主要为 1 的序列。

然后，对该序列使用运行长度编码压缩算法。由于大量重复值，它将非常好地压缩。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-12T13:08:16.777

我建议看一下[Huffman Coding ，这是](http://en.wikipedia.org/wiki/Huffman_coding)[Arithmetic Coding](http://en.wikipedia.org/wiki/Arithmetic_coding)的一个特例。在这两种情况下，您都会分析您的起始序列以确定不同值的相对频率。与不太频繁出现的值相比，更频繁出现的值使用更少的位进行编码。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-05-04T21:11:04.210

我知道这是一个旧的消息线程，但我包括我在此处找到的 SKIP/TAKE 想法的个人 PHP 测试。我打电话给我的 STEP(+)/SPAN(-)。也许有人会觉得它有帮助。

注意：我实现了允许重复整数和负整数的能力，即使最初的问题涉及正的、非重复的整数。如果您想尝试减少一两个字节，请随意调整它。

代码：

```
 // $integers_array can contain any integers; no floating point, please. Duplicates okay.
  $integers_array = [118, 68, -9, 82, 67, -36, 15, 27, 26, 138, 45, 121, 72, 63, 73, -35,
                    68, 46, 37, -28, -12, 42, 101, 21, 35, 100, 44, 13, 125, 142, 36, 88,
                    113, -40, 40, -25, 116, -21, 123, -10, 43, 130, 7, 39, 69, 102, 24,
                    75, 64, 127, 109, 38, 41, -23, 21, -21, 101, 138, 51, 4, 93, -29, -13];

  // Order from least to greatest... This routine does NOT save original order of integers.
  sort($integers_array, SORT_NUMERIC); 

  // Start with the least value... NOTE: This removes the first value from the array.
  $start = $current = array_shift($integers_array);    

  // This caps the end of the array, so we can easily get the last step or span value.
  array_push($integers_array, $start - 1);

  // Create the compressed array...
  $compressed_array = [$start];
  foreach ($integers_array as $next_value) {
    // Range of $current to $next_value is our "skip" range. I call it a "step" instead.
    $step = $next_value - $current;
    if ($step == 1) {
        // Took a single step, wait to find the end of a series of seqential numbers.
        $current = $next_value;
    } else {
        // Range of $start to $current is our "take" range. I call it a "span" instead.
        $span = $current - $start;
        // If $span is positive, use "negative" to identify these as sequential numbers. 
        if ($span > 0) array_push($compressed_array, -$span);
        // If $step is positive, move forward. If $step is zero, the number is duplicate.
        if ($step >= 0) array_push($compressed_array, $step);
        // In any case, we are resetting our start of potentialy sequential numbers.
        $start = $current = $next_value;
    }
  }

  // OPTIONAL: The following code attempts to compress things further in a variety of ways.

  // A quick check to see what pack size we can use.
  $largest_integer = max(max($compressed_array),-min($compressed_array));
  if ($largest_integer < pow(2,7)) $pack_size = 'c';
  elseif ($largest_integer < pow(2,15)) $pack_size = 's';
  elseif ($largest_integer < pow(2,31)) $pack_size = 'l';
  elseif ($largest_integer < pow(2,63)) $pack_size = 'q';
  else die('Too freaking large, try something else!');

  // NOTE: I did not implement the MSB feature mentioned by Marc Gravell.
  // I'm just pre-pending the $pack_size as the first byte, so I know how to unpack it.
  $packed_string = $pack_size;

  // Save compressed array to compressed string and binary packed string.
  $compressed_string = '';
  foreach ($compressed_array as $value) {
      $compressed_string .= ($value < 0) ? $value : '+'.$value;
      $packed_string .= pack($pack_size, $value);
  }

  // We can possibly compress it more with gzip if there are lots of similar values.      
  $gz_string = gzcompress($packed_string);

  // These were all just size tests I left in for you.
  $base64_string = base64_encode($packed_string);
  $gz64_string = base64_encode($gz_string);
  $compressed_string = trim($compressed_string,'+');  // Don't need leading '+'.
  echo "<hr>\nOriginal Array has "
    .count($integers_array)
    .' elements: {not showing, since I modified the original array directly}';
  echo "<br>\nCompressed Array has "
    .count($compressed_array).' elements: '
    .implode(', ',$compressed_array);
  echo "<br>\nCompressed String has "
    .strlen($compressed_string).' characters: '
    .$compressed_string;
  echo "<br>\nPacked String has "
    .strlen($packed_string).' (some probably not printable) characters: '
    .$packed_string;
  echo "<br>\nBase64 String has "
    .strlen($base64_string).' (all printable) characters: '
    .$base64_string;
  echo "<br>\nGZipped String has "
    .strlen($gz_string).' (some probably not printable) characters: '
    .$gz_string;
  echo "<br>\nBase64 of GZipped String has "
    .strlen($gz64_string).' (all printable) characters: '
    .$gz64_string;

  // NOTICE: The following code reverses the process, starting form the $compressed_array.

  // The first value is always the starting value.
  $current_value = array_shift($compressed_array);
  $uncompressed_array = [$current_value];
  foreach ($compressed_array as $val) {
    if ($val < -1) {
      // For ranges that span more than two values, we have to fill in the values.
      $range = range($current_value + 1, $current_value - $val - 1);
      $uncompressed_array = array_merge($uncompressed_array, $range);
    }
    // Add the step value to the $current_value
    $current_value += abs($val); 
    // Add the newly-determined $current_value to our list. If $val==0, it is a repeat!
    array_push($uncompressed_array, $current_value);      
  }

  // Display the uncompressed array.
  echo "<hr>Reconstituted Array has "
    .count($uncompressed_array).' elements: '
    .implode(', ',$uncompressed_array).
    '<hr>'; 
```

输出：

```
--------------------------------------------------------------------------------
Original Array has 63 elements: {not showing, since I modified the original array directly}
Compressed Array has 53 elements: -40, 4, -1, 6, -1, 3, 2, 2, 0, 8, -1, 2, -1, 13, 3, 6, 2, 6, 0, 3, 2, -1, 8, -11, 5, 12, -1, 3, -1, 0, -1, 3, -1, 2, 7, 6, 5, 7, -1, 0, -1, 7, 4, 3, 2, 3, 2, 2, 2, 3, 8, 0, 4
Compressed String has 110 characters: -40+4-1+6-1+3+2+2+0+8-1+2-1+13+3+6+2+6+0+3+2-1+8-11+5+12-1+3-1+0-1+3-1+2+7+6+5+7-1+0-1+7+4+3+2+3+2+2+2+3+8+0+4
Packed String has 54 (some probably not printable) characters: cØÿÿÿÿ ÿõ ÿÿÿÿÿÿ
Base64 String has 72 (all printable) characters: Y9gE/wb/AwICAAj/Av8NAwYCBgADAv8I9QUM/wP/AP8D/wIHBgUH/wD/BwQDAgMCAgIDCAAE
GZipped String has 53 (some probably not printable) characters: xœ Ê» ÑÈÎ¯€)YšE¨MŠ“^qçºR¬m&Òõ‹%Ê&TFÊ‰ùÀ6ÿÁÁ Æ
Base64 of GZipped String has 72 (all printable) characters: eJwNyrsNACAMA9HIzq+AKVmaRahNipNecee6UgSsBW0m0gj1iyXKJlRGjcqJ+cA2/8HBDcY=
--------------------------------------------------------------------------------
Reconstituted Array has 63 elements: -40, -36, -35, -29, -28, -25, -23, -21, -21, -13, -12, -10, -9, 4, 7, 13, 15, 21, 21, 24, 26, 27, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 51, 63, 64, 67, 68, 68, 69, 72, 73, 75, 82, 88, 93, 100, 101, 101, 102, 109, 113, 116, 118, 121, 123, 125, 127, 130, 138, 138, 142
-------------------------------------------------------------------------------- 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-06-23T16:28:47.260

Your case is very similar to compression of indices in search engines. The popular compression algorithm used is the PForDelta algorithm and Simple16 algorithm. You can use the kamikaze library for your compression needs.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-07-04T08:49:55.893

您可能应该使用的基本思想是，对于每个连续整数范围（我将称之为这些范围），存储起始数字和范围的大小。例如，如果您有一个包含 1000 个整数的列表，但只有 10 个单独的范围，则您可以仅存储 20 个整数（每个范围有 1 个起始编号和 1 个大小）来表示此数据，压缩率为 98 %。幸运的是，您可以进行更多优化，这将有助于处理范围数量较大的情况。

1.  **存储起始编号相对于前一个起始编号**的偏移量，而不是起始编号本身。**这里的好处是您存储的数字通常需要更少的位（这可能会在以后的优化建议中派上用场）。此外，如果您只存储起始数字，这些数字都将是唯一的，而存储偏移量可以使数字接近甚至重复，这可能允许进一步压缩，之后应用另一种方法。**

***   使用**尽可能少的位数**对于这两种类型的整数。您可以遍历数字以获得起始整数的最大偏移量以及最大范围的大小。然后，您可以使用最有效地存储这些整数的数据类型，并在压缩数据的开头简单地指定数据类型或位数。例如，如果起始整数的最大偏移量仅为 12,000，最大范围为 9,000 长，那么您可以对所有这些使用 2 字节无符号整数。然后，您可以在压缩数据的开头填充对 2,2 以显示两个整数都使用了 2 个字节。当然，您可以使用一点位操作将这些信息放入单个字节中。** 

 **通过这两个优化，让我们看几个例子（每个都是 4,000 字节）：

1.  1,000 个整数，最大偏移量为 500，10 个范围
2.  1,000 个整数，最大偏移量为 100，50 个范围
3.  1,000 个整数，最大偏移量为 50，100 个范围

**没有优化**

1.  20 个整数，每个 4 个字节 = 80 个字节。压缩 = **98%**
2.  100 个整数，每个 4 个字节 = 400 个字节。压缩 = **90%**
3.  200 个整数，每个 4 个字节 = 800 个字节。压缩 = **80%**

**通过优化**

1.  1 字节头 + 20 个数字，每个 1 字节 = 21 字节。压缩 = **99.475%**
2.  1 字节头 + 100 个数字，每个 1 字节 = 101 字节。压缩 = **97.475%**
3.  1 字节头 + 200 个数字，每个 1 字节 = 201 字节。压缩 = **94.975%**

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-11-08T21:02:05.760

为此，我无法让我的压缩比大约 0.11 好得多。我通过python解释器生成了我的测试数据，它是一个以换行符分隔的1-100和110-160整数列表。我使用实际程序作为数据的压缩表示。我的压缩文件如下：

```
main=mapM_ print [x|x<-[1..160],x`notElem`[101..109]] 
```

它只是一个 Haskell 脚本，可以生成您可以通过以下方式运行的文件：

```
$ runhaskell generator.hs >> data 
```

g.hs文件大小为54字节，python生成的数据为496字节。这给出了 0.10887096774193548 作为压缩比。我认为有更多的时间可以缩小程序，或者你可以压缩压缩文件（即haskell 文件）。

另一种方法可能是保存 4 个字节的数据。每个序列的最小值和最大值，然后将它们提供给生成函数。尽管如此，文件的加载会给解压缩器添加更多字符，从而为解压缩器增加更多复杂性和更多字节。同样，我通过一个程序表示了这个非常具体的序列，它没有概括，它是一种特定于数据的压缩。此外，增加通用性会使解压缩器更大。

另一个问题是必须有 Haskell 解释器才能运行它。当我编译程序时，它变得更大了。我真的不知道为什么。python也有同样的问题，所以也许最好的方法是给出范围，以便某个程序可以解压缩文件。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-12T08:26:52.087

If you have series of repeated values RLE is the easiest to implement and could give you a good result. Nontheless other more advanced algorithms that take into account the entrophy such as LZW, which is now patent-free, can usually achive a much better compression.

You can take a look at these and other lossless algorithms [here](http://en.wikipedia.org/wiki/Lossless_data_compression).

# django - 如何从其他已处理的模板中组合模板？

> ID：283300
> 
> 赞同：4
> 
> 时间：2008-11-12T08:21:56.260
> 
> 标签：django, django-templates

我有一个 django 项目 pro1 有几个应用程序：app1、app2、app3 等等。我想显示一些包含每个应用程序块的顶级模板：

example_base_template.html：

```
[header /]
[left nav bar]{{ app1 rendered template }}[/left nav bar]
[right nav bar]{{ app2 rendered template }}[/right nav bar]
[center section]{{ app1 main functionality template }}[/center section]
[footer]{{ app3 rendered template }}{{ app4 rendered template }}[/footer] 
```

所有这些应用程序模板都是动态的，使用数据库。如何以最恰当和优雅的方式做到这一点？或者问题是如何将 4 个不同的视图连接到一个 URL？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T18:32:30.287

您可以使用[{% include %}](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#include)标签。但这对你没有多大帮助。更好的解决方案是编写具有所需模板和功能的自定义[包含标签。](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#inclusion-tags)

您不能（以简单的方式）将多个视图混合为一个。尝试标记其漂亮的 django 解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T18:50:55.540

我通过为我想要包含的每个应用程序编写自定义模板标签来做到这一点。起初我的模板标签只是传回硬编码的 html。后来发现标签可以加载自己的模板片段。还有一个片段是一个通用的最新内容标签，效果很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T18:40:11.567

我们遇到了类似的问题，关键是将正确的数据放入上下文中。我们所做的是将每个视图的数据创建/上下文填充分解为单独的构建上下文例程。原始视图只是调用它们各自的例程，然后渲染它们的模板。复合视图调用每个上下文构建器，然后呈现主模板，然后包含子模板。

这就是我们在使用 Django 模板系统时遇到一些问题的地方。我们正在缓存模板片段，其中一些片段获取了生成成本非常高的数据。如果片段不是陈旧的，我们肯定不想做这项工作。但是推迟工作直到我们知道我们需要它意味着我们现在在模板中并且：

*   您不能从模板中将参数传递给方法。
*   django.template.__init__.Variable._resolve_lookup() 方法被破坏了，如果你传递了一个可调用对象，它就不会调用它！如果您在上下文中引用对象的方法，那效果很好。

需要可调用函数工作的原因是它允许您传入一个柯里化函数——即一个已经指定了部分（或全部）参数但*尚未调用的函数。*因此视图（或案例中的上下文构建）应该能够curry一个完整指定的函数（记住，您不能在模板本身中传递参数），以便模板*在需要时*可以调用可调用对象，获取数据，然后我们就走了。

我们对此采取了两种不同的方法：

*   我们使用了[来自 djangosnippets.org 的 expr 模板标签](http://www.djangosnippets.org/snippets/9/)
*   我们破解了 django 模板代码以使 callables 工作（我使用了一个已提交但尚未处理的补丁）。

自从我们做了这个站点后，我了解到我们可以通过使用生成器作为延迟数据生成器来解决它。生成器的行为有点像柯里化函数（因为您可以为设置传递任意参数），但模板引擎将它们视为另一个迭代器。关于这个主题有一个[很棒的教程。](http://www.dabeaz.com/generators-uk/)注意：生成器不是数组，您只能使用它们一次，因此您的某些逻辑可能需要调整。

下次我想我们将只使用[jinja2 模板](http://jinja.pocoo.org/2/)并停止使用 Django 的模板。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T12:59:57.730

许多可重复使用的应用程序（尤其是那些被选中到[Pinax](http://pinaxproject.com/)项目中的应用程序）作为如何使用自定义模板标签插入内容的绝佳示例。James Bennett在 DjangoCon 2008上的[演讲也可能有所帮助。](http://www.youtube.com/watch?v=A-S0tqpPga4)

# nlp - CORPUS resource

> ID：283305
> 
> 赞同：4
> 
> 时间：2008-11-12T08:25:17.113
> 
> 标签：nlp, corpus

I am designing an **Automatic text summarizer**. One of the major modules in this project requires **TRAINING CORPUS**. Can someone please help me out by providing **TRAINING CORPUS** or **referring some link to download** it. Thanks in anticipation

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-12T08:35:38.620

See [How to Write a Spelling Corrector](http://norvig.com/spell-correct.html) by Norvig. He mentions [Project Gutenberg](http://www.gutenberg.org/wiki/Main_Page), [Wiktionary](http://en.wiktionary.org/wiki/Wiktionary:Frequency_lists), [British National Corpus](http://www.kilgarriff.co.uk/bnc-readme.html), [Birkbeck spelling error corpus](http://ota.oucs.ox.ac.uk/headers/0643.xml). There's also [Brown Corpus](http://en.wikipedia.org/wiki/Brown_Corpus).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T08:44:26.027

Here are some [Text summarization resources](http://www.summarization.com/), including corpora. The [Stanford list of NLP/Corpus linguistics resources](http://nlp.stanford.edu/links/statnlp.html) may also help.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-04-16T15:20:31.570

不列颠哥伦比亚省对话语料库 - [http://www.cs.ubc.ca/~rjoty/Webpage/resources.htm](http://www.cs.ubc.ca/~rjoty/Webpage/resources.htm) 您可以从[这里](http://www.cs.ubc.ca/nest/lci/bc3/download.html)下载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T10:27:34.063

另请参阅[Corpora 邮件列表](http://gandalf.aksis.uib.no/corpora/)，它们是一个很好的起点，您还可以查看他们的邮件档案以获取更多资源。

# visual-studio - 使用 Visual Studio 进行源代码控制：从 VisualSVN 切换到 Ankh？

> ID：283311
> 
> 赞同：9
> 
> 时间：2008-11-12T08:29:40.473
> 
> 标签：visual-studio, version-control, migration, visualsvn, ankhsvn

我正在为我和一小群开发人员评估 VisualSVN。我在服务器（VisualSVN 服务器）上设置它没有问题，并安装了 TortoiseSVN 和 VisualSVN，以便将它集成到 Visual Studio 2008 中。到目前为止，它运行良好，我们将它用于开发我们的主要应用程序。

我也听说过关于 AnkhSVN 新版本的好消息，它是开源和免费的。由于我们刚开始使用 Subversion，我想现在就做出正确的决定。

是否可以**从 VisualSVN 切换到 AnkhSVN 而没有太多麻烦**？我可以保留 VisualSVN 服务器安装还是必须切换它？如果我开始使用 AnkhSVN，TortoiseSVN 会过时吗？而且，当前版本在 Visual Studio 2008 中是否可靠？

需要明确的是：这不是每个开发人员 50 美元。这是关于为未来做出正确的决定。你有什么建议吗？

*提前谢谢了！*

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-12T10:44:57.003

我们正是这样做的：从 VisualSVN 切换到 AnkhSVN。此举完全没有任何麻烦。这些插件不存储特定信息，并且 .svn（或 _svn）隐藏文件夹与任何 svn 客户端兼容。

Ankh 插件的 1.x 系列很糟糕：很多崩溃和烦恼（例如，很难移动或重命名未提交的文件）。2.x 系列修正了大部分问题，虽然还没有达到 VisualSVN 的水平，但我发现它非常适合我们的使用（而且非常免费）。

关于迁移本身，再简单不过了：我们只是卸载了 VisualSVN，然后安装了 Ankh。只要您的目录受源代码控制，它就可以工作。

唯一的共同点是您仍然需要 TortoiseSVN 来做很多事情，无论是高级任务还是更基本的任务：在资源管理器中创建工作目录和签出比使用 Visual Studio 简单得多。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-12T08:38:19.067

我认为对于更高级的功能，您仍然需要 TortoiseSVN（如导出、重定位、整个目录操作、锁定等）。AnkhSVN v2 非常好。我使用这两种方法都没有太多麻烦。

至于设置远程存储库（我不知道 VisualSVN，所以我假设我们正在谈论存储库服务器），您需要直接从 Subversion 包中使用 svnserve。您可以将其设置为[Windows 服务](http://www.thecrumb.com/2006/10/24/svnservice-no-longer-needed-with-subversion-14/)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-12T09:19:04.477

AnkhSVN 适用于任何 Subversion 服务器，VisualSVN Server 是最容易为 Windows 配置的服务器之一。

如果您需要在 VisualSVN 和 AnkhSVN 之间共享项目和解决方案，您应该确保您没有将您的项目连接到 AnkhSVN scc 提供程序，否则 VisualSVN 用户将看到警告。（您**可以**连接解决方​​案文件而不会看到 SCC 警告）。

您可以将 AnkhSVN 与任何其他 Subversion 客户端一起使用，但我们将 AnkhSVN 2.0 设计为*不需要*其他客户端即可正常运行。在其他 subversion 客户端旁边使用 AnkhSVN 可能会看到的唯一问题是 AnkhSVN 2.0 仅在真正需要时（在提交之前）将文件添加到 subversion，以提高性能并允许对文件进行大小写重命名。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-12T08:38:03.030

Ankh 应该适用于任何 Subversion 服务器，因此它也应该适用于 VisualSVN。见这里： http: [//www.visualsvn.com/server/](http://www.visualsvn.com/server/)它说服务器与所有客户端兼容。:-)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-12T08:44:03.737

我正在使用 VisualSVN 和 Ankh，没有任何问题 - Ankh 适用于任何 Subversion 服务器。我发现 VisualSVN 和“原始”Subversion 包之间的唯一区别是 VisualSVN 使用 http/https 而不是 svn: 协议。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T10:10:06.353

我认为这包含相关信息：[AnkhSVN 与 VisualSVN](https://stackoverflow.com/questions/24045/ankhsvn-versus-visualsvn)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-20T20:52:29.620

叫我疯了，但这个解决方案对我来说似乎很干净： [http](http://blog.programmerslog.com/?p=4) ://blog.programmerslog.com/?p=4 。

Garry Bodsworth 提出了使用 TortoiseSVN 的 Visual Studio 设置。基本上，不是手动添加外部工具自定义，而是导入这些设置为您完成所有工作：Subversion 工具栏、Subversion 菜单和上下文菜单命令。

我认为这将是一个比安装 AnkhSVN 或 VisualSVN 更简单的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T10:20:21.060

我对 Ankh 的体验很糟糕（运行时崩溃太多），但这是针对旧版本的 Ankh，他们可能已经缓解了这些问题。话虽如此，首先坚持 a) 有效的方法，然后 b) 你能负担得起的方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-21T16:51:31.790

老实说，我不太喜欢 Visual Studio 的任何 SVN 附加组件。我最终只是自定义了我自己的一组宏来做我需要做的任何事情，并添加菜单项和自定义上下文菜单，用于提交、更新、显示日志等。我使用 Tortoise 并与命令行工具集成。这很容易做到，包括与 TortoiseProc.exe 的命令行调用集成。但是，我确信与 svn.exe 或其他基于命令行的 svn 客户端集成同样容易。另外，您还可以通过它设置您的思考和工作方式，而不是打包的东西。我将继续使用自定义宏，直到找到更好的颠覆集成工具。

# jquery - IE6 and IE7 Sometimes Have A jQuery Bug With 'nodeName' is null or not an object

> ID：283316
> 
> 赞同：2
> 
> 时间：2008-11-12T08:32:35.863
> 
> 标签：jquery, nodename

I'm having a problem where a jQuery setting against an .html() property on a selected element is returning the error 'nodeName' is null or not an object. This only occurs on IE6 and IE7, but not FF2, FF3, Opera (latest Nov 12,2008) or Safari (again, latest).

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T08:37:17.167

I resolved the problem. The example looks like this:

$('#section #detail .data').html(data);

...where data is HTML returned from an AJAX call, and this bug only occurs on IE6 and IE7 on the second attempt AJAX call, not the first. It's inexplicable. The error returned is:

```
'nodeName' is null or not an object 
```

The fix is to simply clear the variable first before setting:

$('#section #detail .data').html(''); $('#section #detail .data').html(data);

And then IE6 and IE7 started working again with it.

BTW, I had to install Visual Web Developer 2008 Express Edition to get a debugger working in IE7\. That info is [here](http://www.berniecode.com/blog/2007/03/08/how-to-debug-javascript-with-visual-web-developer-express/).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-30T14:02:34.243

在我看来，它就像 JQuery 中的一个错误。在 1.5.1 的第 605 行抛出异常：

```
nodeName: function( elem, name ) {
    return elem.nodeName && elem.nodeName.toUpperCase() === name.toUpperCase();
}, 
```

如果 object 的 nodeName`elem`与 String 相同，则该函数返回 true `name`。如果不是，或者如果没有 nodeName at `elem`，我们返回 false。但是，`elem`在使用之前没有经过测试。所以如果`elem`为null，调用它的`.nodeName`成员就会抛出一个空指针异常。

一个简单的解决方法是`elem`在短路**AND**子句的开头包含：

```
return elem && elem.nodeName && elem.nodeName.toUpperCase()... 
```

现在如果`elem`为 null，该函数将在子句中的第一次测试时返回 false 并且永远不会尝试调用`elem.nodeName`，从而避免了 NPE。

我没有全部检查（它被大量使用），但在许多使用此函数的情况下，在函数调用之前进行了测试`elem` **。**但显然，并非在所有情况下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-22T10:43:33.400

对我来说，当我试图选择一个不存在的元素时，它发生在 IE 上。我试图在它的兄弟姐妹中获取它的索引，它返回为-1。然后我尝试通过从其父级获取它的索引来显示这个元素。它导致了这个错误。

因此，我检查了索引是否不等于-1。这为我解决了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T08:37:56.370

I don't know if it's connected, but we've had what sounds like a similar issue where the DOM doesn't have the children/text of a element that we know exist (because we see them rendered on the screen!)

Selecting something else, then selecting the elememt again seemed to fix the issue - suddenly, the children appear. So what happens if you select you element, select something else, select your element again?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T08:40:00.187

Do you have any idea what kinds of nodes you might be running up against? Or, are you running in IE quirks mode? There might be some kinds of nodes such as #text that don't show up correctly in the DOM in quirks mode.

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
```

# .net - key press handler

> ID：283329
> 
> 赞同：0
> 
> 时间：2008-11-12T08:37:18.833
> 
> 标签：.net

I have a win form, have some controls. I want to handle all keypress in the form keypress event. Is it possible without writing keypress for all the controls?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T08:39:27.940

Setting the KeyPreview property of the form to True should enable this.

# iphone - NSURLConnection 分块编码上传 - 如何？

> ID：283331
> 
> 赞同：3
> 
> 时间：2008-11-12T08:37:42.920
> 
> 标签：iphone, objective-c, cocoa, chunked-encoding

我需要创建一种使用分块编码上传字节流的方法。

我有一个包含音频文件的字节数组，我想使用分块流将该文件发送到服务器。

我已经能够通过本机套接字进行分块上传，但我真的很想通过其中一个 NSURL（NSURLConnection？）库来做到这一点。那可能吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T10:28:31.933

我对 NSURLConnection 类的体验很糟糕。它们充满了内存泄漏。

经过多次尝试和失败，我现在使用 iPhone 编译的 libcurl 版本；好多了，看这里..

[http://www.iphonedevsdk.com/forum/iphone-sdk-development/4580-curl-anyone-using-their-app.html](http://www.iphonedevsdk.com/forum/iphone-sdk-development/4580-curl-anyone-using-their-app.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-09-01T06:51:38.710

您可以使用 ASIHTTPRequest 执行此操作，可在此处获得：[http ://allseeing-i.com/ASIHTTPRequest/How-to-use](http://allseeing-i.com/ASIHTTPRequest/How-to-use)

向下滚动到“直接从磁盘流式传输请求主体”

# graphics - 如何动态调整svg中的文本大小？

> ID：283346
> 
> 赞同：5
> 
> 时间：2008-11-12T08:42:30.993
> 
> 标签：graphics, svg, diagram

我正在编写一份包含嵌入式 svg 图的报告。该图表是使用相对坐标绘制的，因此当浏览器窗口调整大小时，图表的大小会很好地调整。唯一的例外是文本 - 它保持不变。是否可以在可调整大小的 svg 中绘制文本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T09:49:24.773

我认为您必须对字体大小使用相对大小。请参阅[http://www.w3.org/TR/SVG11/coords.html#UnitIdentifiers](http://www.w3.org/TR/SVG11/coords.html#UnitIdentifiers)。当您使用 pt 或 cm 等绝对尺寸时，系统会自动计算要在显示器上正确显示的尺寸，以获得该尺寸。但是当你使用 px 时，使用的是当前视口。如果您不指定单位，则用户单位也将与链接文档中的示例一样使用：

```
<text style="font-size: 50">Text size is 50 user units</text> 
```

# c# - 我在哪里丢失了参考？

> ID：283348
> 
> 赞同：1
> 
> 时间：2008-11-12T08:43:50.740
> 
> 标签：c#, design-patterns, visitor-pattern

我正在尝试使用访客模式，我有以下内容：

```
public class EnumerableActions<T> : IEnumerableActions<T>
{
private IEnumerable<T> itemsToActOn;

public EnumerableActions ( IEnumerable<T> itemsToActOn )
{
  this.itemsToActOn = itemsToActOn;
}

public void VisitAllItemsUsing ( IVisitor<T> visitor )
{
  foreach (T t in itemsToActOn)
  {
    visitor.Visit ( t );// after this, the item is unaffected.
  }
} 
```

访客 ：

```
internal class TagMatchVisitor : IVisitor<Tag>
{
private readonly IList<Tag> _existingTags;

public TagMatchVisitor ( IList<Tag> existingTags )
{
  _existingTags = existingTags;
}

#region Implementation of IVisitor<Tag>

public void Visit ( Tag newItem )
{
  Tag foundTag = _existingTags.FirstOrDefault(tg => tg.TagName.Equals(newItem.TagName, StringComparison.OrdinalIgnoreCase));

  if (foundTag != null)
    newItem = foundTag; // replace the existing item with this one. 
}

#endregion
} 
```

我打电话给访客的地方：

```
IList<Tag> tags = ..get the list;
tags.VisitAllItemsUsing(new TagMatchVisitor(existingTags)); 
```

那么..我在哪里失去了参考？在 newItem = foundTag 之后 - 我希望在访问者的 foreach 中我会有新的价值 - 显然这不会发生。

**编辑**我想我找到了答案 - 在 foreach 中，变量是只读的。

[http://discuss.joelonsoftware.com/default.asp?dotnet.12.521767.19](http://discuss.joelonsoftware.com/default.asp?dotnet.12.521767.19)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T08:52:10.490

为此，首先“newItem”必须是“ref”。其次，您需要在委托调用后对更新的值做一些事情（枚举器不提供任何更新内容的能力）。但是无论如何，对集合的大多数更新都会破坏枚举器！

否则，您的替换“newItem”将不会对客户可见。但是，标签的*属性*（假设它是一个引用类型并且是可变的）将会发生变化。

为此， itemsToActOn 必须是`IList<T>`- 然后你可以使用：

```
for(int i = 0 ; i < itemsToActOn.Count ; i++)
{
    T value = itemsToActOn[i];
    visitor.Visit(ref t)
    itemsToActOn[i] = value;
} 
```

或者如果你可以使用`T Visit(T)`

```
for(int i = 0 ; i < itemsToActOn.Count ; i++)
{
    itemsToActOn[i] = visitor.Visit(itemsToActOn[i]);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T09:02:52.450

是的，你是对的——但我在那个地方使用了一个 IEnumerable，所以不能真正为它做一个 for 。

但是我想返回一个新列表而不是影响当前列表更正确。所以我正在使用来自 Jean-Paul S. Boodhoo 的 ValueReturningVisitor - 启发（采取？:)）。

# erlang - 是否有处理 IO 的组长协议规范？

> ID：283350
> 
> 赞同：5
> 
> 时间：2008-11-12T08:44:24.187
> 
> 标签：erlang

在 Erlang 中，每个进程都有一个组长，当一个进程想要打印一些东西时（即它调用 io 库或做类似的事情），它会向它的组长发送一条消息。

我的问题是，我在哪里可以找到这些消息的规范？或者一般来说，组长应该做什么的规范？

我通过一些实验设法发现，有时该过程会发送一个`{io_request, Sender, GroupLeader, Request}`术语，答案是一个`{io_reply, GroupLeader, ok}`术语，但可能还有其他情况。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-17T18:59:03.283

[Erlang 基本原理（视频）](https://erlangcentral.org/erlang-rationale-2/)或[（幻灯片）](http://www.erlang-factory.com/upload/presentations/329/EFKR10-ErlangRationale.pdf)；[是一个很好的信息来源， user.erl](http://github.com/mfoemmel/erlang-otp/tree/master/lib/kernel/src/user.erl#L182)的源代码也是如此。

简而言之：

```
 {io_request, From, ReplyAs, Request}
  %From is the process to send the reply to, 
  %ReplyAs is any term the caller desires to 
  %match up the request and the response. (returned verbatim in the reply)
  {io_reply, ReplyAs, Reply} 
```

user.erl 中的一些请求：

```
 {put_chars, IoList} % puts the iolist
 {put_chars, M,F,A} % puts the result of apply(M,F,A)
 {get_geometry, 'rows' | 'columns'} % returns the number of rows or columns of the console
 {get_line, Prompt} % calls io_lib:collect_line(Prompt)
 {get_chars, Prompt, Mod, Func, ExtraArgs} 
 {get_until, Prompt, Mod, Func, Args}
 {setopts, Options} % only option supported by user is 'binary' 
                    % (binary mode if present in Options, list mode otherwise) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-10-20T15:56:57.290

Erlang I/O 协议在这里详细描述：

[http://www.erlang.org/doc/apps/stdlib/io_protocol.html](http://www.erlang.org/doc/apps/stdlib/io_protocol.html)

# ms-access - 说服 Access 2007 使用 .UDL 文件/oledb 连接？

> ID：283355
> 
> 赞同：2
> 
> 时间：2008-11-12T08:48:53.757
> 
> 标签：ms-access, odbc, oledb, ms-access-2007, interbase

有什么方法可以诱使 Access 2007 使用 .UDL 文件？

具体来说，我们的一款旧产品使用 Interbase 6.0 数据库。我的客户想使用 Access 2007（在短期内）链接到他的数据库进行读/写。

虽然这根本不是我喜欢的做事方式，但考虑到它都是单用户的，而且对 Interbase 数据库的其他访问都是通过 Delphi 7 客户端完成的，我真的不能说“不”——至少，直到我有时间“适当地”给他想要的东西。

我没有任何其他类型的 Access 可以使用的驱动程序，尽管我已经制作了一个成功链接（通过 IBoledb）到数据库的 .UDL 文件。愚蠢的是，我只是假设现代版本的 Access 将能够使用 .UDL 文件......

因此，我试图让 Access 2007 理解该 .UDL 文件（甚至尝试将其重命名为 .DSN 并弄乱文件中的某些值）但无济于事。似乎您可以访问链接到 Interbase 的唯一方法是通过（购买的第三方）Interbase ODBC 驱动程序。

有谁知道不一样？我可以通过 .UDL 链接以某种方式使用 Interbase 访问“链接表”吗？

干杯!

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T10:41:18.337

这似乎是不可能的。尽管 Access 很乐意使用 OLEDB 与 SQL Server 对话，但似乎没有办法让它使用 OLEDB 连接到其他数据库。

至少现在我可以“接受我自己的答案”，我可以“结束”这个问题。:-)

# asp.net - “最佳实践”/最喜欢的调用 Web 服务的模式 (ASP.NET)

> ID：283368
> 
> 赞同：6
> 
> 时间：2008-11-12T08:57:30.447
> 
> 标签：asp.net, web-services, asynchronous

## 问题：

*   我们有一个 Web 应用程序，它异步调用一些 Web 服务（从页面）。
*   通常这很好，但**有些在负载测试下失败**（由于超时）。

**在 Web 应用程序中异步调用 Web 服务的建议“最佳实践”是什么（如果有的话）？**

*   是否有任何可能有用的模式？
*   是否应该避免直接调用服务？（也许诉诸其他方法，如 AJAX）？

*说明 - 直接调用：*

```
WSNameSpace.WSName svc = new WSNameSpace.WSName();
svc.EventName += new WSNameSpace.EventNameEventHandler(CallbackDelegate);
svc.ServiceMethodAsync(param1, param2); 
```

*   我应该更多地关注改进异常处理而不是调用服务吗？

非常感谢。

抢

### 更新

我一直在谷歌上搜索并找到[了这篇](http://blogs.msdn.com/dphill/articles/43260.aspx)关于创建“服务代理”的文章，虽然它与 WinForms 相关，但稍后我肯定会坐下来阅读这篇文章，看看它如何影响我对此的想法 :)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T10:45:43.567

使用异步页面对 Web 服务进行异步调用。像这样[http://gofrom.us/6LC](http://gofrom.us/6LC)

# vb6 - Error: MSCOMCT2.OCX or one of its dependencies not

> ID：283373
> 
> 赞同：6
> 
> 时间：2008-11-12T09:01:59.177
> 
> 标签：vb6, mscomct2.ocx

I am trying to run a VB application that was coded long back on Windows 2000\. My current OS is windows XP SP2\.

The error message is: "Component 'MSCOMCT2.OCX' or one of its dependencies not correctly registered: a file is missing or invalid"

I searched my computer for this file (this is different from MSCOMCT***L***.OCX) and didnt find it. Can someone point me how to get past this error?

Thanks, Nag.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-05T16:04:28.217

您还可以查看此基于 Microsoft 的“帮助和支持”页面，其中详细说明了您可以从何处“正式”下载此页面。

[http://support.microsoft.com/kb/297381](http://support.microsoft.com/kb/297381)

Microsoft 倾向于移动其内容，使旧页面不正确，但当我键入此内容时，上面的页面列出了 CAB 文件的以下位置，其中包含您寻找的 MSCOMCT2.OCX 文件；

[http://activex.microsoft.com/controls/vb6/mscomct2.cab](http://activex.microsoft.com/controls/vb6/mscomct2.cab)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T09:55:42.950

我认为，您需要 Visual Basic 的运行时文件（[可在此处获得](http://www.microsoft.com/downloads/details.aspx?familyid=bf9a24f9-b5c5-48f4-8edd-cdf2d29a79d5&displaylang=en)）。

# .net - .NET 是否有与 Java 的 ConcurrentHashMap 等效的 Dictionary 实现？

> ID：283374
> 
> 赞同：5
> 
> 时间：2008-11-12T09:02:34.837
> 
> 标签：.net, concurrency, dictionary, map

回顾那些可能不知道 Java API 的 .NET 专家：

[Java 中的ConcurrentHashMap](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ConcurrentHashMap.html)具有用于常见 Map 修改操作的原子方法（即不需要外部锁定），例如：

```
putIfAbsent(K key, V value)
remove(Object key, Object value)
replace(K key, V value) 
```

它还允许在没有锁定的情况下对键集进行迭代（它在迭代开始时获取一个副本），并且`get()`操作通常可以与调用交错`put()`而不阻塞（它使用细粒度的锁条带[IIRC](http://en.wiktionary.org/wiki/IIRC)）。

无论如何，我的问题是：**.NET 是否有等效的 Dictionary 实现？**

我想更一般地说，我很想知道 .NET 是否有一组更通用的线程安全集合库。或一般的并发实用程序 - 相当于[Doug Lea](http://en.wikipedia.org/wiki/Doug_Lea)的`java.util.concurrent`库。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-01-02T22:14:34.313

传入的 .Net 4.0 有一个[ConcurrentDictionary](http://msdn.microsoft.com/en-us/library/dd287191(VS.100).aspx)类，它有一个方便的[GetOrAdd](http://msdn.microsoft.com/en-us/library/ee378677(VS.100).aspx)方法。

```
public TValue GetOrAdd(
    TKey key,
    Func<TKey, TValue> valueFactory
) 
```

对于全局服务器缓存非常有用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T09:16:43.263

编辑：这是在 .NET 4 发布之前编写的，当时显然有`ConcurrentDictionary`. 我把它留在这里作为那些需要 .NET 3.5 的人的参考。

我不知道有什么等价于`ConcurrentHashMap`.

就通用并发实用程序而言 - .NET 始终提供比 Java 过去提供的基础知识多一点的功能[`Mutex`](http://msdn.microsoft.com/en-us/library/system.threading.mutex.aspx)，包括[`ManualResetEvent`](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx)、[`AutoResetEvent`](http://msdn.microsoft.com/en-us/library/system.threading.autoresetevent.aspx)和[`ReaderWriterLock`](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlock.aspx); 然后是最近的（.NET 2.0）[`Semaphore`](http://msdn.microsoft.com/en-us/library/system.threading.semaphore.aspx)和（.NET 3.5）[`ReaderWriterLockSlim`](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlockslim.aspx)——当然还有进程范围的线程池。

当 Parallel Extensions 到来时，.NET 4.0 将会发生更大的变化——这应该会使并发性*变得更加*简单。同样，[协调和并发运行时](http://channel9.msdn.com/pdc2008/TL55/)终于摆脱了 Microsoft Robotics Studio 的束缚，尽管我不清楚它的确切发展方向（它是 .NET 本身的一部分，还是一个单独的库）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T09:25:25.273

从来没听说过。与您正在寻找的最接近的可能是哈希表的同步方法，它返回哈希表周围的（某种）线程安全包装器。不过，它只对多个作者或多个读者是线程安全的。如果我没记错的话，作者和读者的混合不会是线程安全的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T09:46:44.450

就个人而言，我发现让单个方法同步通常并不像听起来那么有用。

通常，您可能希望连续执行相关的“获取”和“放置”，如果另一个线程正在查看相同的值，则您将立即进行线程竞赛。同样（取决于场景），您不*希望*有人阅读您正在处理的值。

对于广泛的方法，简单地使用外部`Monitor`(`lock(...)`在许多情况下都可以很好地工作。它简单、轻量级，除非您处于**繁重的**线程负载下，否则绰绰有余。

对于更复杂的场景，诸如`ReaderWriterLockSlim`etc 之类的东西更加灵活。但我会从简单开始，只有在分析显示存在真正的争用问题时才进行更改。

正如 Jon 所说，Parallel Extension 带来了一系列全新的高性能同步设备。从我所看到的（例如[here](http://www.betanews.com/article/Everyone_talk_at_once_NET_40_will_include_Parallel_Extensions/1223931673)、[here](http://blogs.msdn.com/pfxteam/archive/2008/10/10/8994927.aspx)和[here](http://msdn.microsoft.com/en-us/magazine/cc817396.aspx)）来看，这是.NET 4.0的一部分

# c++ - 检测 TCP 客户端断开连接

> ID：283375
> 
> 赞同：87
> 
> 时间：2008-11-12T09:02:47.677
> 
> 标签：c++, sockets, tcp

假设我正在运行一个简单的服务器并`accept()`从客户端建立了一个连接。

判断客户端何时断开连接的最佳方法是什么？通常，客户端应该发送关闭命令，但如果它手动断开连接或完全失去网络连接怎么办？服务器如何检测或处理这个？

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2013-07-15T22:31:34.070

在 TCP 中，只有一种方法可以检测到有序断开连接，那就是在读取时获取零作为返回值`read()/recv()/recvXXX()`。

也只有一种可靠的方法来检测断开的连接：通过写入它。在对断开的连接进行足够多的写入之后，TCP 将进行足够的重试和超时以知道它已断开，并最终导致`write()/send()/sendXXX()`返回 -1，其`errno/WSAGetLastError()`值为`ECONNRESET,`或在某些情况下为“连接超时”。请注意，后者与“连接超时”不同，后者可能发生在连接阶段。

您还应该设置合理的读取超时，并丢弃失败的连接。

这里的答案是关于`ioctl()`和`FIONREAD`竞争的废话。所做的只是告诉您套接字接收缓冲区中当前有多少字节可以在没有阻塞的情况下读取。如果客户在五分钟内没有向您发送任何内容，这并不构成断开连接，但确实会导致`FIONREAD`为零。不一样的东西：甚至不接近。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-12T11:41:12.613

要对此进行更多扩展：

如果您正在运行服务器，则需要使用 TCP_KEEPALIVE 来监视客户端连接，或者自己做类似的事情，或者了解您在连接上运行的数据/协议。

基本上，如果连接被终止（即未正确关闭），那么服务器在尝试向客户端写入内容之前不会注意到，这就是 keepalive 为您实现的。或者，如果您更了解协议，则无论如何都可以在不活动超时时断开连接。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T11:49:04.580

如果您使用带有完成例程或完成端口的重叠（即异步）I/O，当客户端关闭连接时，您将立即收到通知（假设您有未完成的读取）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-12-21T19:22:48.637

尝试寻找 EPOLLHUP 或 EPOLLERR。 [如何检查客户端连接是否仍然存在](https://stackoverflow.com/questions/6434305/how-do-i-check-client-connection-is-still-alive)

在某些情况下，读取和查找 0 会起作用，但不是全部。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-07-19T04:47:46.467

TCP 在协议中有“打开”和“关闭”程序。一旦“打开”，连接就会保持到“关闭”。但是有很多事情可以异常阻止数据流。话虽如此，确定是否可以使用链路的技术高度依赖于协议和应用程序之间的软件层。上面提到的那些专注于试图以非侵入方式（读取或写入 0 字节）使用套接字的程序员可能是最常见的。库中的某些层将为程序员提供“轮询”。例如，Win32 异步（延迟）调用可以启动读取，该读取将返回没有错误和 0 字节，以指示无法再读取的套接字（可能是 TCP FIN 过程）。其他环境可能会使用“事件” 如其包装层中所定义。这个问题没有单一的答案。检测何时无法使用套接字并应关闭套接字的机制取决于库中提供的包装器。还值得注意的是，套接字本身可以被应用程序库下面的层重用，因此弄清楚您的环境如何处理 Berkley 套接字接口是明智的。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-10-06T13:43:37.140

这真的很容易做到：可靠而不混乱：

> ```
>  Try
>             Clients.Client.Send(BufferByte)
>         Catch verror As Exception
>             BufferString = verror.ToString
>         End Try
>         If BufferString <> "" Then
>             EventLog.Text &= "User disconnected: " + vbNewLine
>             Clients.Close()
>         End If 
> ```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2013-07-16T00:54:54.260

我玩弄了一些解决方案，但这个似乎最适合检测 Windows 中的主机和/或客户端断开连接。它用于非阻塞套接字，源自[IBM 的示例](http://publib.boulder.ibm.com/infocenter/iseries/v5r3/index.jsp?topic=%2Frzab6%2Frzab6xnonblock.htm)。

```
char buf;
int length=recv(socket, &buf, 0, 0);
int nError=WSAGetLastError();
if(nError!=WSAEWOULDBLOCK&&nError!=0){
    return 0;
}   
if (nError==0){
    if (length==0) return 0;
} 
```

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2017-10-05T09:12:35.623

如果连接丢失，receive 的返回值将是 -1，否则它将是缓冲区的大小。

```
void ReceiveStream(void *threadid)
{
    while(true)
    {
        while(ch==0)
        {
            char buffer[1024];
            int newData;
            newData = recv(thisSocket, buffer, sizeof(buffer), 0);
            if(newData>=0)
            {
                std::cout << buffer << std::endl;
            }
            else
            {
                std::cout << "Client disconnected" << std::endl;
                if (thisSocket)
                {
                    #ifdef WIN32
                        closesocket(thisSocket);
                        WSACleanup();
                    #endif
                    #ifdef LINUX
                        close(thisSocket);
                    #endif
                }
                break;
            }
        }
        ch = 1;
        StartSocket();
    }
} 
```

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2008-11-12T09:07:00.897

select（设置了读取掩码）将返回带有信号的句柄，但是当您使用 ioctl* 检查待读取的字节数时，它将为零。这是套接字已断开连接的标志。

这是关于检查客户端是否已断开连接的各种方法的精彩讨论：[Stephen Cleary，检测半开（丢弃）连接](http://blog.stephencleary.com/2009/05/detection-of-half-open-dropped.html)。

* 对于 Windows 使用 ioctlsocket。

# .net - 在 .NET 中除以两个整数值并获得浮点商的最高效方法是什么？

> ID：283377
> 
> 赞同：1
> 
> 时间：2008-11-12T09:03:22.590
> 
> 标签：.net, performance, floating-point, division, integral

考虑 C# 中的以下签名：

```
double Divide(int numerator, int denominator); 
```

以下实现之间是否存在性能差异？

```
return (double)numerator / denominator;

return numerator / (double)denominator;

return (double)numerator / (double)denominator; 
```

我假设以上两个都返回相同的答案。

我错过了任何其他等效的解决方案吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-12T09:06:56.077

您是否尝试过比较 IL（例如，与[Reflector](http://www.red-gate.com/products/reflector/)）？

```
static double A(int numerator, int denominator)
{ return (double)numerator / denominator; }

static double B(int numerator, int denominator)
{ return numerator / (double)denominator; }

static double C(int numerator, int denominator)
{ return (double)numerator / (double)denominator; } 
```

这三个都变成（给或取名字）：

```
.method private hidebysig static float64 A(int32 numerator, int32 denominator) cil managed
{
    .maxstack 8
    L_0000: ldarg.0 // pushes numerator onto the stack
    L_0001: conv.r8 // converts the value at the top of the stack to double
    L_0002: ldarg.1 // pushes denominator onto the stack
    L_0003: conv.r8 // converts the value at the top of the stack to double
    L_0004: div     // pops two values, divides, and pushes the result
    L_0005: ret     // pops the value from the top of the stack as the return value
} 
```

所以不：完全零差异。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T09:14:48.667

即使您使用 VB.NET，分子和分母在进行实际除法之前都会转换为双精度数，因此您的示例是相同的。

# c# - LinqToXML XElement 到 XmlNode

> ID：283378
> 
> 赞同：13
> 
> 时间：2008-11-12T09:03:23.853
> 
> 标签：c#, sharepoint, linq-to-xml

你好，

是否有任何“正确”的方法可以在 C# 中将 XElement 转换为 XmlNode - LinqToXML 可以很好地以编程方式构建所需的 XML，但 SharePoint Web 服务需要 XmlNode，那么混合和匹配的最佳方法是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-12T09:18:01.233

使用 CreateReader() 和类似的 XmlDocument

```
XmlDocument myXmlNode = new XmlDocument();
using (XmlReader reader = myXElement.CreateReader())
{
    myXmlNode.Load(reader);
} 
```

XmlDocument 派生自 XmlNode。

# jquery - jQuery 可拖放/可拖动

> ID：283392
> 
> 赞同：0
> 
> 时间：2008-11-12T09:14:27.683
> 
> 标签：jquery, jquery-ui-draggable, jquery-ui-droppable

目前我有一组 div，由 php 动态生成，它们的 id 都以“itembox”开头，并附加了一个计数。我在页面上有一个可放置的垃圾箱区域，以便用户可以通过拖放到垃圾箱中来删除单个项目框。

我的问题是，当我拖动原始文件时，droppable 似乎不会激活，而当我有 helper: 'clone' 集时它会（完美地）起作用。不幸的是，当拖动时，克隆函数从 itembox 的第一次迭代中获取它的克隆，无论实际拖动哪个 itembox。

因此，我正在寻找一种解决方案，以使 droppable 接受原始文件或强制克隆功能从实际拖动的 itembox 中获取其克隆。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T13:51:13.600

我想问题一定出在您的可放置初始化程序的接受选项上。只需尝试以下操作：

```
$('#mydroppable').droppable(
{
    accept: function() { return true; },
    drop: function () { alert("Dropped!"); }
}); 
```

现在这将接受所有内容，因此您可能应该在接受函数中实现一些过滤，但无论如何这应该可以工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-17T13:02:55.043

您也可以尝试以下解决方案。

```
<script type="text/javascript">
$(document).ready(function(){
    $('.srcfield').draggable({
        revert: true    
    });

    $('#trash').droppable({
        accept : ".srcfield",
        over: function(){
            $(this).removeClass('out').addClass('over');
        },`enter code here`
        out: function(){
            $(this).removeClass('over').addClass('out');
        },
        drop: function(ev, ui){
            //var answer = confirm('Delete this item?');
            var theTitle = $(ui.draggable).attr("title");
            $(this).html("<u>"+theTitle+"</u><br/> is deleted!");
        }
    });
});
</script>

<body>
    <div id="trash" class="out">
            <span>Trash</span>
    </div>
    <div id="sourcefields">
            <div class="srcfield" title="First Name"><span>First Name</span></div>
            <div class="srcfield" title="Last Name"><span>Last Name</span></div>
            <div class="srcfield" title="Age"><span>Age</span></div>
    </div>
</body> 
```

# sharepoint - SharePoint Services 3.0 搜索如何工作？

> ID：283394
> 
> 赞同：1
> 
> 时间：2008-11-12T09:14:56.887
> 
> 标签：sharepoint, search

我了解以下要素：

*   有某种爬行（在中央管理中配置）
*   爬取完成后，会有一点延迟，之后您可以显示搜索结果。

但是，在启用发布的文档库中，未发布的文档不会出现在搜索结果中。这正常吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T15:41:54.547

所有内容均使用默认内容访问帐户进行爬网。大多数情况下，这是一个专用帐户，SharePoint 为其授予“完全读取”权限。

不幸的是，“阅读用户”看不到未经批准的项目。因此它将索引最新发布的版本。

但是，您不能真正授予该用户更多权限。如果您这样做，它将始终索引未发布的项目，而不索引最新的发布版本。因此，没有批准者权限的用户将无法搜索这些项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T16:00:03.590

我有类似的搜索问题，我为内容访问帐户分配了一个域服务帐户并解决了 serach 找不到的项目，我认为这是由于用户管理页面并剥夺了所有权利。

# asp.net - 如何将会话中的所有数据写入字符串[]以及如何将字符串[]中的数据写入会话

> ID：283396
> 
> 赞同：1
> 
> 时间：2008-11-12T09:15:19.320
> 
> 标签：asp.net, session-variables

我使用一个`ASP.net`. 我需要将所有会话数据（会话变量和会话请求变量）复制到`String []`. 我怎样才能做到这一点？

我也需要相反的条件。

我如何使用序列化概念来做到这一点

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T09:16:04.560

序列化和反序列化应该可以解决问题。

您可以[在此处](http://aspalliance.com/983_Introducing_Serialization_in_NET)查找有关序列化的教程。

# asp.net - 在多个 ASP.NET 页面之间传递相同的 HiddenField 值

> ID：283403
> 
> 赞同：2
> 
> 时间：2008-11-12T09:18:43.510
> 
> 标签：asp.net, hidden-field

请您解释一下，如何在几个 ASP.NET 页面之间传递相同的[HiddenField值？](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.hiddenfield.aspx)

我想我可以在链中的每个页面上使用[RegisterHiddenField](http://msdn.microsoft.com/en-us/library/system.web.ui.clientscriptmanager.registerhiddenfield.aspx)，但希望有一个更简单的解决方案。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T11:51:17.710

如果您在几个页面之间直接传递 HiddenField，则可以使用 Button、LinkBut​​ton 或 ImageButton 之一在页面按钮控件之间建立链接。然后您可以使用 PostBackUrl 导航到下一页。

```
<asp:LinkButton ID="Button1" runat="server"
                PostBackUrl="~/TargetPage.aspx" Text="Next Page" /> 
```

要从目标页面访问值：

```
if (Page.PreviousPage != null)
{
    string MyHiddenValue = (HiddenField)Page.PreviousPage.FindControl("MyHiddenField");
} 
```

您可能应该检查 HiddenField 是否存在等。

# c++ - C ++中的atan和atan2有什么区别？

> ID：283406
> 
> 赞同：197
> 
> 时间：2008-11-12T09:20:28.700
> 
> 标签：c++, math.h

`atan`C++和C++有什么区别`atan2`？

* * *

## 回答 #1

> 赞同：371
> 
> 时间：2012-08-17T19:07:33.573

从学校数学我们知道切线有定义

```
tan(α) = sin(α) / cos(α) 
```

我们根据我们提供给函数的角度来区分四个象限。的符号`sin`和具有以下关系（我们忽略 的确切倍数）：`cos``tan``π/2`

```
 Quadrant    Angle              sin   cos   tan
-------------------------------------------------
  I           0    < α < π/2      +     +     +
  II          π/2  < α < π        +     -     -
  III         π    < α < 3π/2     -     -     +
  IV          3π/2 < α < 2π       -     +     - 
```

鉴于 的值为`tan(α)`正，我们无法区分角度是来自第一象限还是第三象限，如果为负，则可能来自第二象限或第四象限。因此，按照惯例，`atan()`从第一或第四象限（即`-π/2 <= atan() <= π/2`）返回一个角度，而不管切线的原始输入如何。

为了得到完整的信息，我们不能使用除法的结果，`sin(α) / cos(α)`而是必须分别查看正弦和余弦的值。这就是这样`atan2()`做的。当余弦为负时，它需要两者，`sin(α)`并且通过添加到结果来`cos(α)`解决所有四个象限。`π``atan()`

**备注：**该`atan2(y, x)`函数实际上接受一个`y`和一个`x`参数，它是一个有长度`v`和角度的向量`α`在y轴和x轴上的投影，即

```
y = v * sin(α)
x = v * cos(α) 
```

这给出了关系

```
y/x = tan(α) 
```

**结论：** `atan(y/x)`保留了一些信息，只能假设输入来自象限 I 或 IV。相反，`atan2(y,x)`获取所有数据，从而可以解析正确的角度。

* * *

## 回答 #2

> 赞同：160
> 
> 时间：2008-11-12T09:22:19.523

[`std::atan2`](http://en.cppreference.com/w/cpp/numeric/math/atan2)允许计算所有四个象限的反正切。[`std::atan`](http://en.cppreference.com/w/cpp/numeric/math/atan)只允许从象限 1 和 4 计算。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2014-05-14T23:32:07.793

实际值以弧度为单位，但以度数解释它们将是：

*   `atan`= 给出 -90 到 90 之间的角度值
*   `atan2`= 给出 -180 到 180 之间的角度值

对于我的工作，涉及计算各种角度，如导航中的航向和方位，`atan2`在大多数情况下都可以完成这项工作。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-11-12T17:03:16.973

另一件要提的是，当使用和为 0 或接近 0`atan2`之类的表达式计算切线时，它更稳定。`atan(y / x)``x`

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-11-12T09:22:49.243

atan(x) 返回 x 的反正切的主值，以弧度表示。

atan2(y,x) 返回 y/x 的反正切的主值，以弧度表示。

请注意，由于符号不明确，函数无法确定角度仅通过其正切值（仅 atan）确定角度落在哪个象限。如果需要确定象限，可以使用 atan2。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2014-02-09T00:48:09.567

我想主要问题试图弄清楚：“我什么时候应该使用其中一个”，或者“我应该使用哪个”，或者“我使用的是正确的那个”？

我想重要的一点是 atan 仅用于在向右向上的方向曲线中提供正值，例如时间距离向量。零总是在左下角，thigs 只能上下左右，只是更慢或更快。atan 不会返回负数，因此您无法仅通过添加/减去结果来跟踪屏幕上 4 个方向的内容。

atan2 旨在使原点位于中间，并且事情可以向后或向下。这就是您在屏幕表示中使用的内容，因为您希望曲线走向哪个方向确实很重要。所以 atan2 可以给你负数，因为它的零在中心，它的结果是你可以用来追踪 4 个方向的东西。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-03-09T20:49:20.043

考虑一个直角三角形。我们标记斜边 r、水平边 y 和垂直边 x。感兴趣的角度 α 是 x 和 r 之间的角度。

C++`atan2(y, x)`将给我们以弧度表示的角度 α 的值。 `atan`如果我们只知道或只对 y/x 而不是 y 和 x 感兴趣，则使用它。因此，如果 p = y/x 则要获得 α，我们将使用`atan(p)`.

你不能用它`atan2`来确定象限，你`atan2`只能在你*已经知道*你在哪个象限的情况下使用！特别是正 x 和 y 意味着第一象限，正 y 和负 x，第二象限，依此类推。`atan`或者`atan2`他们自己只是返回一个正数或负数，仅此而已。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-12T09:22:30.617

使用 atan2，您可以确定[此处](http://www.cplusplus.com/reference/clibrary/cmath/atan.html)所述的象限。

> 如果需要确定象限，可以使用 atan2。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-07-11T01:46:24.017

下面的 Mehrwolf 是正确的，但这里有一个启发式可能会有所帮助：

如果您在二维坐标系中工作，这通常是编程反正切的情况，您应该使用 atan2。它将提供完整的 2 pi 角度范围，并为您处理 x 坐标中的零点。

另一种说法是 atan(y/x) 实际上总是错误的。仅当参数不能被认为是 y/x 时​​才使用 atan。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-03-05T15:14:21.130

`atan2(y,x)`如果要将笛卡尔坐标转换为极坐标，通常使用。它会给你角度，`sqrt(x*x+y*y)`或者，如果有的话，`hypot(y,x)`会给你尺寸。

`atan(x)`只是 tan 的倒数。在恼人的情况下，您必须使用`atan(y/x)`，因为您的系统不提供`atan2`，您必须对`x`和`y`和的符号进行额外检查`x=0`，以获得正确的角度。

*注意：* 为和`atan2(y,x)`的所有实数值定义，但两个参数都为零的情况除外。`y``x`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-06-21T21:04:03.880

在 atan2 中，输出为：`-pi`< `atan2(y,x)`<`pi`
而在 atan 中，输出为：`-pi/2`< `atan(y/x)`< `pi/2` //它不考虑季度。
如果你想获得和之间的方向`0`（`2*pi`如高中数学），我们需要使用 atan2 并且对于负值添加以获得和`2*pi`之间的最终结果。 这是Java源代码，可以清楚地解释它：`0``2*pi`

```
System.out.println(Math.atan2(1,1)); //pi/4 in the 1st quarter
System.out.println(Math.atan2(1,-1)); //(pi/4)+(pi/2)=3*(pi/4) in the 2nd quarter

System.out.println(Math.atan2(-1,-1 ));//-3*(pi/4) and it is less than 0.
System.out.println(Math.atan2(-1,-1)+2*Math.PI); //5(pi/4) in the 3rd quarter

System.out.println(Math.atan2(-1,1 ));//-pi/4 and it is less than 0.
System.out.println(Math.atan2(-1,1)+2*Math.PI); //7*(pi/4) in the 4th quarter

System.out.println(Math.atan(1 ));//pi/4
System.out.println(Math.atan(-1 ));//-pi/4 
```

# database - 使用“部分索引”的优点和缺点是什么？

> ID：283416
> 
> 赞同：3
> 
> 时间：2008-11-12T09:26:07.660
> 
> 标签：database, postgresql, indexing

PostgreSQL 允许创建“部分索引”，它们基本上是带有条件谓词的索引。[http://www.postgresql.org/docs/8.2/static/indexes-partial.html](http://www.postgresql.org/docs/8.2/static/indexes-partial.html)

在测试时，我发现它们在查询仅访问具有 120k 行的表中的某些 12 行的情况下表现得非常好。

但是在我们部署它之前，是否有任何我们应该注意的缺点或警告？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T04:18:31.343

主要的警告是不要不恰当地使用它们。它们适用于识别与一组标准匹配的行，其中这些行在大表中占少数。

以一个表格`Orders`为例，其中包含一`order_status`列以及您的数据在订单状态下的分布，如下所示：

*   新 5%
*   缺货 2%
*   在途 5%
*   完成 85%
*   退货 3%

如果您经常查询`where order_status = 'New'`以获取新订单列表，然后大部分时间只是通过 ID 直接引用订单，那么部分索引将是有益的。在您的 120k 中有 12 行的示例中，情况更是如此。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T09:32:17.773

临：

> 这会减小索引的大小，从而加快使用索引的查询。它还将加快许多表更新操作，因为在所有情况下都不需要更新索引

缺点：

由于这不再是一个真正的索引，如果您对索引未涵盖的值进行完全连接或过滤，则性能将随着表大小的增长而下降。

# c# - 如何将 ContextMenuStrip 添加到 ToolStripButton？

> ID：283417
> 
> 赞同：2
> 
> 时间：2008-11-12T09:27:30.373
> 
> 标签：c#, winforms, contextmenustrip, toolstripbutton

我有一个工具条，其中包含一个 ToolStripComboBox 和一个 ToolStripButton。我想为它们添加一个 ContextMenuStrip，但我没有直接访问工具条或其其他内容的权限，因此我无法设置工具条的上下文菜单。

为 ToolStripComboBox 设置 ContextMenuStrip 很简单：

```
myToolStripComboBox.ComboBox.ContextMenuStrip = myContextMenu; 
```

但是 ToolStripButton 没有明显的等价物。如何将 ContextMenuStrip 添加到 ToolStripButton？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-21T07:46:37.717

杰夫耶茨的建议应该奏效。

然而，另一种选择是创建您自己的派生类（MyToolSTripButton、MyToolStripTextBox ...等）为这些项目提供一个您可以在设计时设置的 ContextMenuStrip 属性，并让您的派生类检测鼠标右键或其他任何事件触发上下文菜单的显示。

这会将所需的任何知识卸载到那些感兴趣的项目上。

下面是一个使用 ToolStripTextBox 作为项目的示例。

```
public class MyTextBox : ToolStripTextBox
{
    ContextMenuStrip _contextMenuStrip;

    public ContextMenuStrip ContextMenuStrip
    {
        get { return _contextMenuStrip; }
        set { _contextMenuStrip = value; }
    }

    protected override void OnMouseDown(MouseEventArgs e)
    {
        if (e.Button == MouseButtons.Right)
        {
            if (_contextMenuStrip !=null)
                _contextMenuStrip.Show(Parent.PointToScreen(e.Location));
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-24T18:19:35.887

您需要将上下文菜单设置为 ToolStrip，然后处理上下文菜单的 Popup 或相关事件并点击测试鼠标悬停在哪个按钮上以确定您是否应该显示 ToolStrip 的上下文菜单以及它应该包含的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T09:35:16.737

这是因为 ToolStripComboBox 包含“System.Windows.Forms.ComboBox”控件，但“ToolStripButton”不包含“System.Windows.Forms.Control”。它的特殊工具条项，即按钮由工具提示维护。

您应该在工具提示上使用 ContextMenu，或者您可以将下拉菜单添加到工具条按钮项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T22:24:32.017

好问题。您可能能够访问父级`toolstrip`（`myToolStripButton.Parent`或类似的东西）并在那里附加上下文菜单。

# c# - 如何从 GAC 加载最新版本的 dll

> ID：283419
> 
> 赞同：5
> 
> 时间：2008-11-12T09:28:58.527
> 
> 标签：c#, binding, gac

我已经编写了一个批处理执行框架，并且我希望（在某些情况下）从可能有多个版本的 GAC 加载程序集，但我只想加载*最新版本*。
这甚至可能吗？

TIA

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T13:07:37.353

`Assembly.LoadWithPartialName(string)`会做你想做的事。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T09:46:13.750

您应该能够将发布者策略与 BindingRedirect 一起使用。看到这个[答案](https://stackoverflow.com/questions/185187/how-to-make-publisher-policy-file-redirect-assembly-request)。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-12T09:44:47.873

[Linq to Gac](http://blog.domaindotnet.com/2008/09/20/fusion_c_sharp_wrapper_for_linq_to_gac_access/)可以查询 GAC。一旦你知道你想要什么，你就可以在运行时[加载程序集。](http://msdn.microsoft.com/en-us/library/system.appdomain.load.aspx)

# safari - 为 Safari 调试 Intranet ASP.NET 应用程序

> ID：283425
> 
> 赞同：0
> 
> 时间：2008-11-12T09:33:02.467
> 
> 标签：safari, cross-browser

我有一个用于预订工作和电话索引的 asp.net 内部网应用程序。现在我的大多数用户都很好，因为他们使用的是 Firefox 和/或 Internet Explorer。我有一个只能使用 Safari 的用户，由于某种原因，当我们导航到 Intranet 应用程序时，Safari 似乎做了很多加载，然后最后说；“Safari 无法打开页面“<a href="http://mywebserver/" rel="nofollow noreferrer">http://mywebserver/”，因为服务器没有响应。”

虽然简短的回答是让用户使用另一个浏览器，但作为一名程序员，我很感兴趣的是为什么会出现这种情况，以及我现在和将来可以做些什么来检测和在必要时重定向所以我的 asp.net 应用程序也可以在 Safari 中运行。

如果有人对如何让这个 asp.net 应用程序在 Safari 中为这个用户运行有任何建议，我也很感兴趣。我们尝试使用机器名称和 IP 地址导航到该站点，但仍然得到相同的响应。

非常感谢，

巴里

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T09:35:06.627

您是否在 ASP.Net 应用程序中使用 ISA 服务器和用户模拟？如果您尝试通过 ISA 服务器进行身份验证，我已经看到了 safari 崩溃的问题。

确保本地地址绕过代理，这可能会解决问题。

# asp.net - ASP.NET ascx vs. aspx - 你重用用户控件吗？

> ID：283427
> 
> 赞同：11
> 
> 时间：2008-11-12T09:34:20.047
> 
> 标签：asp.net, user-controls

我们的团队正在开发一个相当大的 ASP.NET Web 项目，该项目最初始于 ASP.NET 1.0，并多次移植到所有新版本的 .NET。

我们广泛使用了**用户控件（ascx）**。但回想起来，我怀疑这是一个好的决定。这些控件中的一小部分通过不同的页面被重用（可重用）。只有这一层复杂性添加到应用程序中，使一些事情变得更加复杂。

对于可重用、小型和专用控件，我们使用服务器控件（继承自 WebControl 类），效果很好。

所以我的问题是：开始一个新项目，是否可以**摆脱 ascx 并在页面本身（aspx）中实现所有内容**？也许除非您对用户控件进行大量动态加载（我们不这样做）？你有什么经验，你有什么建议？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-12T09:46:52.173

我们有一些项目广泛使用 ASCX 控件，而其他项目则没有。根据我的经验，您必须根据具体情况做出决定。

我最喜欢使用 ASCX 控件的两个原因是：

1.  您正在实现一个 UI 功能，该功能将出现在许多不同的页面上（或多次出现在同一页面上）。
2.  您希望封装一些复杂的功能以使其与页面的其余部分区分开来，从而使您的代码更易于阅读和维护。

ASCX 控件可能很有用，但您确实需要确保仅在有充分理由时才使用它们 - 否则 - 正如您所说，您可能会在代码库中添加不必要的复杂性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-12T09:49:58.737

如果使用得当，用户控件可以提高维护性和可重用性，而且创建起来通常比服务器控件要快。

您提到在您之前的项目中，很少有用户控件被重用。这似乎与糟糕的计划有关，而不是用户控制本身的固有缺陷。

我想一个好的经验法则是查看您的设计，看看您是否一遍又一遍地使用同一组控件，在这种情况下使用用户控件确实有意义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T09:38:56.307

我仍然会使用用户控件，主要是因为您可以通过这种方式更轻松地将内容与设计分离，这在您更改应用程序的设计时最终会有很大帮助。

它还使得在页面上移动控件比在整个地方剪切/粘贴代码更容易一些。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T09:48:51.453

它确实完全归结为正在设计的 Web 应用程序的类型。在工作中，我们的一个应用程序是非常可配置的，因此可以在一个页面 (default.aspx) 上工作，并根据其为登录用户配置的方式加载控件。

但是，另一方面，如果您正在编写一个需要通过 SEO 访问并且必须易于导航的网站，那么在 aspx 页面中实现每个视图是一个好方法。使在开发过程中访问每个页面变得简单直接，因为您可以通过将其设置为 VS 中的启动页面直接访问它（假设没有安全权限/逻辑妨碍）。

另一种选择是使用 ASP.net MVC；具有可重用用户控件的相互依赖的视图也被混合在一起:-)

# python - 为什么只有在填充窗口时才会出现“命令无法识别”错误？

> ID：283431
> 
> 赞同：1
> 
> 时间：2008-11-12T09:38:53.250
> 
> 标签：python, windows

我的记录表应用程序有一个用于创建新的空白记录表的菜单选项。当我打开一个工作表窗口时，我可以毫无问题地打开新窗口，使用 subprocess.Popen() 来做到这一点。

但是，在 Windows 下（我还没有在其他操作系统上测试过），如果我打开一个新窗口然后使用“打开文件”对话框用文件中的数据填充字段，我将不再能够创建新的视窗。填充后，Windows 会给我

> 'foo.py' 不是内部或外部命令、可运行程序或批处理文件。

我不明白什么会导致 Windows 突然无法识别 Popen() 调用。我没有任何代码会以我知道的任何方式影响它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T10:36:43.400

从错误消息来看，您似乎需要将“foo.py”的完整路径传递给您的 Popen 调用。通常只有“foo.py”会在你当前的工作目录中搜索，但这在 Windows 上可能有点不可预测，我发现。您的似乎在打开文件对话框中跳来跳去。

其次，为了更好地衡量，您似乎需要将 foo.py 作为参数传递给 python.exe 可执行文件，而不是执行 foo.py 本身。同样，我将通过路径指定它。

所以为了安全起见，像：

```
subprocess.Popen([r'C:\Python2.5\python.exe', r'C:\path\to\foo.py']) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T07:27:55.730

建议的答案似乎已经解决了这个问题。我还意识到我需要使用**os.name**来确定正在使用的操作系统，然后我可以使用正确的路径格式来加载外部 Python 文件。

# asp.net-mvc - ASP.NET MVC - .mvc 路由在 II6 中失败

> ID：283435
> 
> 赞同：2
> 
> 时间：2008-11-12T09:43:09.887
> 
> 标签：asp.net-mvc, iis-6, routing

我一直在试图在 IIS6 上部署我的 MVC 应用程序（[链接问题](https://stackoverflow.com/questions/275920/aspnet-mvc-on-iis-6-wildcard-mapping-the-incoming-request-does-not-match-any-ro)）

我暂时放弃了通配符映射，并试图让 .mvc 扩展工作。IIS 中的所有内容都已正确配置，并且 .mvc 扩展名指向所有动词类型​​的 .NET dll（未选中验证是否存在选项）。

每次我提出请求时，我得到的只是 .NET 404 页面。/Home.mvc 和 /Home.mvc/Index 都返回该页面。

我没有对默认的 Web.config 进行任何更改，并且我的所有路由都配置了无扩展和基于扩展的等效项。

我很欣赏这个配置对于​​每个阅读它的人来说是多么容易（声音），但我向你保证我没有做任何不同的事情，我的不会工作。我什至尝试使用 IIS6 将它部署在不同的服务器上，同样的问题也发生在那里。

是否还有其他原因导致路由模块/处理程序完全丢失请求并使其陷入标准的 .NET 404 错误？奇怪的权限？

对于 IIS 404 错误，我更新了自定义错误设置，使其在站点路径中调用 Default.aspx 页面。这是 Visual Studio 中生成的 MVC beta 模板的默认页面，它在后面的代码中执行以下操作：

```
HttpContext.Current.RewritePath(Request.ApplicationPath);
IHttpHandler httpHandler = new MvcHttpHandler();
httpHandler.ProcessRequest(HttpContext.Current); 
```

这只是给了我上一篇文章中的错误：

```
[HttpException (0x80004005): The incoming request does not match any route.]
   System.Web.Routing.UrlRoutingHandler.ProcessRequest(HttpContextBase httpContext) +15589
   System.Web.Routing.UrlRoutingHandler.ProcessRequest(HttpContext httpContext) +40
   System.Web.Routing.UrlRoutingHandler.System.Web.IHttpHandler.ProcessRequest(HttpContext context) +7
   ...... 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T23:47:00.527

[Oli](https://stackoverflow.com/users/36849/oli)解决了我[最初的问题](https://stackoverflow.com/questions/275920/aspnet-mvc-on-iis-6-wildcard-mapping-the-incoming-request-does-not-match-any-ro)，他指出网站需要 Global.asax 文件。我正在使用 NAnt/MSBuild 来部署我的发布包，但没有包含 Global.asax 文件。这个文件在我们所有的 .NET 2 项目中都可以忽略，并且一直在我们所有的 NAnt 部署结构中，所以我没有多想。

一个要注意的未来。我没有发现的东西都归功于[奥利](https://stackoverflow.com/users/36849/oli)。再次感谢！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T23:38:18.080

尝试从最简单的配置开始。将您的 Route 定义更改为使用 .aspx 而不是 .mvc 并查看 /home.aspx/index 是否有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T13:35:25.910

> 我没有对默认的 Web.config 进行任何更改，并且我的所有路由都配置了无扩展和基于扩展的等效项。

扩展和无扩展路由的顺序是什么？

我要么删除无扩展名（因为您正在使用扩展名），要么确保在扩展名路由之后添加它（由于路由的第一个匹配性质）。

此外，请查看[http://www.asp.net/learn/mvc/tutorial-08-cs.aspx](http://www.asp.net/learn/mvc/tutorial-08-cs.aspx)并简单地仔细检查您的 IIS 设置是否正确（听起来像您这样做）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T17:38:49.210

谢谢huey，也看过那篇文章-所有配置都相同。

我的无扩展路由在扩展路由之前输出，纯粹是因为我打算使用 ISAPI 重写模块并希望从我的路由表生成的任何 URL 都是干净的。然后它们将被重写为基于扩展的。

虽然目前我什至不在乎无扩展的 URL，但我只想让一个版本正常工作，这样我就可以向客户展示！到目前为止，我真的很喜欢 MVC 的东西，但这让事情失去了光彩。

再次感谢你的帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-24T06:24:20.130

网址重写可以帮助您解决问题。我已经实现了允许在任何 IIS 版本上部署 MVC 应用程序的解决方案，即使使用虚拟主机也是如此。 [http://www.codeproject.com/KB/aspnet/iis-aspnet-url-rewriting.aspx](http://www.codeproject.com/KB/aspnet/iis-aspnet-url-rewriting.aspx)

# python - 是否可以在 IronPython 中使用 wxPython？

> ID：283447
> 
> 赞同：4
> 
> 时间：2008-11-12T09:49:43.073
> 
> 标签：python, wxpython, ironpython

当我的 IronPython 程序上线时

```
import wx 
```

我收到这条消息：

```
A first chance exception of type
'IronPython.Runtime.Exceptions.PythonImportErrorException' occurred in IronPython.dll

Additional information: No module named _core_ 
```

虽然我确实有文件 wx\_core_.pyd。另外，在尝试导入之前，我有以下几行：

```
sys.path.append('c:\\Python24\\Lib\\site-packages')
sys.path.append('c:\\Python24\\Lib\\site-packages\\wx-2.6-msw-unicode')
sys.path.append('c:\\Python24\\Lib\\site-packages\\wx-2.6-msw-unicode\\wx')
sys.path.append('c:\\Python24\\Lib\\site-packages\\wx-2.6-msw-unicode\\wx\\lib')
sys.path.append('c:\\Python24\\Lib\\site-packages\\wx-2.6-msw-unicode\\wxpython\\lib')
sys.path.append('c:\\Python24\\Lib\\site-packages\\wxaddons') 
```

我希望这能让 IronPython 找到它需要的一切。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-12T10:27:31.530

不，这行不通。Wx 绑定（与大多数其他“python 绑定”一样）实际上是针对 CPython 编译的。

在这方面，它们不仅仅是 sys.path 上的软件包，正如您所尝试的那样。它们实际上依赖于 CPython 本身。[这个相当枯燥的文件解释了这个过程。](http://www.python.org/doc/2.5.2/ext/ext.html)

注意：Resolver Systems 的一些工作人员有一个任务是允许您将 CPython 绑定与 IronPython（称为[IronClad](http://code.google.com/p/ironclad/)）一起使用，但这还处于早期阶段，我认为他们将专注于让 Numpy 之类的东西首先工作，GUI工具包永远是最后的，也是最难的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T18:12:13.120

虽然由于@Ali 列出的原因 wxPython 不可用，但您可能需要查看[wx.NET](http://wxnet.sourceforge.net/)。您可以改用 IronPython 来调用这些程序集，并且它应该是跨平台的（我假设这就是您所追求的，或者您只需使用 WinForms）。如果您正在寻找的只是 API 兼容性，我认为您不走运:(

# c++ - 您如何组织您的 STL 标头？

> ID：283450
> 
> 赞同：10
> 
> 时间：2008-11-12T09:50:03.587
> 
> 标签：c++, stl, include

我正在处理一个使用 STL 的大型项目，并且对您组织 STL 的首选方式有疑问`#includes`。

*   您是否喜欢在使用的源文件中 #include 每个标头。例如，如果两者都`foo.cpp`需要`bar.cpp`，`std::string`那么两者都会`#include <string>`。
*   您是否希望拥有一个包含项目使用的所有 STL 头文件的单个头文件（即将它们添加到 MS 'stdafx.h' 预编译头文件中）。

第一种方法的优点是 .cpp 文件是一个独立的单元，可以在不同的项目中使用，而不必担心会丢失 .cpp 文件`#include`。第二种方法的优点是您可以使用编译器预编译的头文件支持，另外您可以将 STL 包装`#includes`在`pragmas`其中禁用一些警告（例如，某些 Boost 头文件在第 4 级编译时会导致警告）。

你更喜欢使用哪个？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-12T10:07:46.890

我只包含每个源代码中真正需要的头文件，而不是“捕获所有”头文件，以保持依赖关系（以及因此编译时间）尽可能低。

无论如何，预编译的头文件都可以工作（即我依靠预编译的头文件来加速编译过程，而不是获得声明）。因此，即使通过包含的预编译头文件声明了某些内容，我仍然包含“常规”头文件，该头文件将被包含保护机制跳过，并且不会对编译时间增加任何重要内容。

因为预编译的头文件是编译器特定的东西。在我看来，优化/更改预编译头文件应该不会影响代码的正确运行。

尽可能低的依赖关系的主要优点是重构变得更容易（或者更确切地说：可行）

关于这一切的好书是[来自 Lakos 的大型 C++ 设计](https://rads.stackoverflow.com/amzn/click/com/0201633620)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T10:44:15.147

我所做的是将整个项目中需要的所有 STL 头文件包含在我的单个[预编译头文件](http://msdn.microsoft.com/en-us/library/szfdksca.aspx)中，通常是默认的 StdAfx.h。预编译头文件实际上是在项目中设置的第一件事，包括所有 STL-/boost-/平台头文件和第三方库。

STL 和 boost 整齐地排列在命名空间中，因此它们也不会造成任何混淆或重叠。

在标题中，我通常使用全名，但在源文件中，在适当的时候*使用命名空间 x*。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T10:49:20.893

您可以结合使用这两种方法：

将两个 .cpp 文件都包含在内，并将其添加到 stdafx.h。这仍然会为您提供 PCH 优化。

.cpp - 文件仍然需要#include "stdafx.h"，因此它的独立性值得商榷。但是，依赖项是明确的状态，删除 stdafx.h 包含比查找所有丢失的包含更简单。此外，标准标题 - 所有标题都应该 - 确保它们没有被包含两次。

* * *

一般来说，我同意您使每个文件“独立”的方法，即当 .cpp 添加到另一个项目或包含 .h 时，它会处理其依赖关系。

* * *

请记住，PCH 是一种权衡，它们可能会变得巨大。在 PCH 中有很多大部分未使用的代码实际上会减慢您的构建速度。不过，快速磁盘有很大帮助:)

另请注意，至少在某些版本中，在 MSVC 中启用预编译标头实际上确实会改变处理：#include "stdafx.h" 之前的声明被忽略，因此这需要是您的第一个非注释语句。丑陋的陷阱。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T10:20:39.953

完全同意 John Lakos 的《Large Scale C++ Design》一书的建议。

在文件本身中声明文件所需的所有标头，无论是 .h 还是 .cpp。不要依赖其他头文件包含的文件的副作用。

列出所有包含的大型头文件会不必要地增加依赖关系并使设计非常脆弱。

哦，另一件事永远不会在头文件中使用声明。仅在您的实现文件、.cpp 文件中使用它们。

HTH。

干杯，

抢

# java - 坚持使用休眠/JPA

> ID：283454
> 
> 赞同：3
> 
> 时间：2008-11-12T09:51:50.790
> 
> 标签：java, hibernate, jpa

几个月来，我一直在 JBoss 上使用 hibernate/JPA，并且有一个问题我找不到答案或解决方案。

似乎在创建新实体 bean 时，我至少在调用 EntityManager.persist(entityBean) 之前无法进行查询，否则我会收到以下错误：

`TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing`

一个例子：

```
Job job = new Job();
Collection<Task> tasks = job.getTasks();
//entityManager.persist(job);
ActionPlan actionPlan = (ActionPlan) entityManager.createNamedQuery("ActionPlan.findByCommand").
                setParameter("type", RunOperation.Install).getSingleResult();
Task task = Task.getTask(actionPlan);
task.setActionPlan(actionPlan);
tasks.add(task);
task.setJob(job); 
```

我的问题是，如果不先坚持“工作”（被注释掉的行），我就无法调用 createNamedQuery。ActionPlan 与 Job 有关系，但 NamedQuery (findByCommand) 不加入 Job。困扰我的是，我需要持久化 Job 才能查询数据库，而新创建的 Job 在这种情况下甚至不感兴趣。
将对 persist() 的调用移动到代码段的末尾会产生上述错误。

我知道我正在处理的对象没有持久化，但是如果发生错误，持久化使得无法回滚。

我相信有一个解决方案，所以如果有人有答案，我将非常感激。我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T11:09:57.047

您无法查询尚未在数据库中的内容似乎是合乎逻辑的，不是吗？您可以做的是开始使用事务。在一个简单的情况下，您的会话将有一个事务将一直打开，直到您关闭会话。在那一刻，事务将被提交，您的所有更改都将被保留。您只需要在出现错误时回滚您的事务。

PS[在底部](http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/Session.html)您可以找到“典型交易应使用以下成语”。

```
Session sess = factory.openSession();
Transaction tx;
try {
tx = sess.beginTransaction();
    //do some work
    ...
    tx.commit();
}
catch (Exception e) {
    if (tx!=null) tx.rollback();
    throw e;
}
finally {
    sess.close();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T08:17:46.003

好吧，我认为 Java EE 5Tutorial 中的答案和阅读一些内容给了我正确的答案。

与我的看法相反，persist() 不会*刷新*到数据库，它只会将实体 bean 移动到持久状态。欺骗我的是，我注意到在调用persist之后，实体实际上还是被持久化到了数据库中（也许错误消息中的“保存”这个词）。我认为这是因为刷新被称为结束我的事务，但如果我得到了正确的 themalkolm，我仍然可以回滚 - 由我自己或由服务器在异常时回滚。

所以我得出的结论是；每当创建一个新实体时，只要它与另一个已经持久化的实体无关，就应该调用persist。
然后交易被维护，服务器更喜欢你一点;）

留下她的是，我仍然不明白为什么我无法在所有内容都处于持久状态的情况下进行查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T11:54:19.357

我知道我无法查询尚未持久化的内容 - 也不是这种情况。我想找到的是其他实体 bean。不仅是同一类型，而且是我拥有的任何类型的实体 bean。然后我得到 TransientObjectException。

我有没有提到我使用 JBoss？我相信使用 J2EE 和 JPA 服务器可以控制我的事务，而我最后想做的就是干扰它？！所以对我来说，除了使用 requiresNew 等。我不会搞乱事务——服务器会。

也许我应该移动休眠标签，因为实际上我正在使用 JPA - JBoss 使用休眠。因此，请在任何代码示例中与此相关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T06:07:10.463

即使您保留对象，您仍然可以回滚它。只有在 EntityManager 上调用 flush 后，才会同步到底层数据库。

# c# - byte[] 数组模式搜索

> ID：283456
> 
> 赞同：81
> 
> 时间：2008-11-12T09:52:42.753
> 
> 标签：c#, pattern-matching

任何人都知道一种在 byte[] 数组中搜索/匹配字节模式然后返回位置的好方法。

例如

```
byte[] pattern = new byte[] {12,3,5,76,8,0,6,125};

byte[] toBeSearched = new byte[] {23,36,43,76,125,56,34,234,12,3,5,76,8,0,6,125,234,56,211,122,22,4,7,89,76,64,12,3,5,76,8,0,6,125} 
```

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-11-12T11:21:36.897

我可以建议一些不涉及创建字符串、复制数组或不安全代码的东西：

```
using System;
using System.Collections.Generic;

static class ByteArrayRocks
{    
    static readonly int[] Empty = new int[0];

    public static int[] Locate (this byte[] self, byte[] candidate)
    {
        if (IsEmptyLocate(self, candidate))
            return Empty;

        var list = new List<int>();

        for (int i = 0; i < self.Length; i++)
        {
            if (!IsMatch(self, i, candidate))
                continue;

            list.Add(i);
        }

        return list.Count == 0 ? Empty : list.ToArray();
    }

    static bool IsMatch (byte[] array, int position, byte[] candidate)
    {
        if (candidate.Length > (array.Length - position))
            return false;

        for (int i = 0; i < candidate.Length; i++)
            if (array[position + i] != candidate[i])
                return false;

        return true;
    }

    static bool IsEmptyLocate (byte[] array, byte[] candidate)
    {
        return array == null
            || candidate == null
            || array.Length == 0
            || candidate.Length == 0
            || candidate.Length > array.Length;
    }

    static void Main()
    {
        var data = new byte[] { 23, 36, 43, 76, 125, 56, 34, 234, 12, 3, 5, 76, 8, 0, 6, 125, 234, 56, 211, 122, 22, 4, 7, 89, 76, 64, 12, 3, 5, 76, 8, 0, 6, 125 };
        var pattern = new byte[] { 12, 3, 5, 76, 8, 0, 6, 125 };

        foreach (var position in data.Locate(pattern))
            Console.WriteLine(position);
    }
} 
```

**编辑（由 IAbstract 提供）** -*将[帖子](https://stackoverflow.com/a/283815/210709)内容移至此处，因为它不是答案*

出于好奇，我创建了一个具有不同答案的小型基准测试。

以下是一百万次迭代的结果：

```
solution [Locate]:            00:00:00.7714027
solution [FindAll]:           00:00:03.5404399
solution [SearchBytePattern]: 00:00:01.1105190
solution [MatchBytePattern]:  00:00:03.0658212 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2013-02-05T16:28:52.977

使用**LINQ 方法。**

```
public static IEnumerable<int> PatternAt(byte[] source, byte[] pattern)
{
    for (int i = 0; i < source.Length; i++)
    {
        if (source.Skip(i).Take(pattern.Length).SequenceEqual(pattern))
        {
            yield return i;
        }
    }
} 
```

很简单！

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2016-07-28T01:29:45.860

这是我的建议，更简单，更快捷：

```
int Search(byte[] src, byte[] pattern)
{
    int maxFirstCharSlot = src.Length - pattern.Length + 1;
    for (int i = 0; i < maxFirstCharSlot; i++)
    {
        if (src[i] != pattern[0]) // compare only first byte
            continue;

        // found a match on first byte, now try to match rest of the pattern
        for (int j = pattern.Length - 1; j >= 1; j--) 
        {
           if (src[i + j] != pattern[j]) break;
           if (j == 1) return i;
        }
    }
    return -1;
} 
```

这段代码背后的逻辑是这样的：首先它只搜索第一个字节（这是关键的改进），当找到第一个字节时，我尝试匹配模式的其余部分

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-12-02T00:18:54.617

[最初我发布了一些我使用的旧代码，但对 Jb Evain 的基准测试](http://monoport.com/38177)感到好奇。我发现我的解决方案是愚蠢的慢。看来 bruno conde 的[SearchBytePattern](https://stackoverflow.com/questions/283456/byte-array-pattern-search#283596)是最快的。我不知道为什么，尤其是因为他使用了 Array.Copy 和 Extension 方法。但是在 Jb 的测试中有证据，所以对 bruno 表示敬意。

我进一步简化了这些位，所以希望这将是最清晰和最简单的解决方案。（bruno conde 所做的所有辛勤工作）增强功能包括：

*   缓冲区.块复制
*   Array.IndexOf<字节>
*   while 循环而不是 for 循环
*   开始索引参数
*   转换为扩展方法

    ```
    public static List<int> IndexOfSequence(this byte[] buffer, byte[] pattern, int startIndex)    
    {
       List<int> positions = new List<int>();
       int i = Array.IndexOf<byte>(buffer, pattern[0], startIndex);  
       while (i >= 0 && i <= buffer.Length - pattern.Length)  
       {
          byte[] segment = new byte[pattern.Length];
          Buffer.BlockCopy(buffer, i, segment, 0, pattern.Length);    
          if (segment.SequenceEqual<byte>(pattern))
               positions.Add(i);
          i = Array.IndexOf<byte>(buffer, pattern[0], i + 1);
       }
       return positions;    
    } 
    ```

请注意，`while`块中的最后一条语句应该`i = Array.IndexOf<byte>(buffer, pattern[0], i + 1);`代替`i = Array.IndexOf<byte>(buffer, pattern[0], i + pattern.Length);`. 看看约翰的评论。一个简单的测试可以证明：

```
byte[] pattern = new byte[] {1, 2};
byte[] toBeSearched = new byte[] { 1, 1, 2, 1, 12 }; 
```

随着`i = Array.IndexOf<byte>(buffer, pattern[0], i + pattern.Length);`，没有返回。`i = Array.IndexOf<byte>(buffer, pattern[0], i + 1);`返回正确的结果。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-11-12T13:21:25.843

使用高效的[Boyer-Moore 算法](http://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_string_search_algorithm)。

它旨在查找带有字符串的字符串，但您几乎不需要想象力即可将其投影到字节数组。

一般来说，最好的答案是：使用您喜欢的任何字符串搜索算法:)。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-11-12T10:55:03.847

我的解决方案：

```
class Program
{
    public static void Main()
    {
        byte[] pattern = new byte[] {12,3,5,76,8,0,6,125};

        byte[] toBeSearched = new byte[] { 23, 36, 43, 76, 125, 56, 34, 234, 12, 3, 5, 76, 8, 0, 6, 125, 234, 56, 211, 122, 22, 4, 7, 89, 76, 64, 12, 3, 5, 76, 8, 0, 6, 125};

        List<int> positions = SearchBytePattern(pattern, toBeSearched);

        foreach (var item in positions)
        {
            Console.WriteLine("Pattern matched at pos {0}", item);
        }

    }

    static public List<int> SearchBytePattern(byte[] pattern, byte[] bytes)
    {
        List<int> positions = new List<int>();
        int patternLength = pattern.Length;
        int totalLength = bytes.Length;
        byte firstMatchByte = pattern[0];
        for (int i = 0; i < totalLength; i++)
        {
            if (firstMatchByte == bytes[i] && totalLength - i >= patternLength)
            {
                byte[] match = new byte[patternLength];
                Array.Copy(bytes, i, match, 0, patternLength);
                if (match.SequenceEqual<byte>(pattern))
                {
                    positions.Add(i);
                    i += patternLength - 1;
                }
            }
        }
        return positions;
    }
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2019-10-11T19:30:44.017

如果您使用的是 .NET Core 2.1 或更高版本（或 .NET Standard 2.1 或更高版本平台），您可以使用[新](https://github.com/dotnet/corefxlab/blob/master/docs/specs/span.md)[类型](https://github.com/dotnet/corefxlab/blob/master/docs/specs/span.md)[`MemoryExtensions.IndexOf`](https://docs.microsoft.com/en-us/dotnet/api/system.memoryextensions.indexof?view=netcore-3.0)的扩展方法：[`Span`](https://github.com/dotnet/corefxlab/blob/master/docs/specs/span.md)

```
int matchIndex = toBeSearched.AsSpan().IndexOf(pattern); 
```

要查找所有事件，您可以使用以下内容：

```
public static IEnumerable<int> IndexesOf(this byte[] haystack, byte[] needle,
    int startIndex = 0, bool includeOverlapping = false)
{
    int matchIndex = haystack.AsSpan(startIndex).IndexOf(needle);
    while (matchIndex >= 0)
    {
        yield return startIndex + matchIndex;
        startIndex += matchIndex + (includeOverlapping ? 1 : needle.Length);
        matchIndex = haystack.AsSpan(startIndex).IndexOf(needle);
    }
} 
```

不幸的是，[.NET Core 2.1 - 3.0 中的实现](https://github.com/dotnet/corefx/blob/v3.0.0/src/Common/src/CoreLib/System/SpanHelpers.Byte.cs#L23)使用迭代的“在第一个字节上优化单字节搜索然后检查余数”方法，而不是[快速字符串搜索算法](https://stackoverflow.com/q/3183582)，但这可能会在未来的版本中改变。（参见[dotnet/runtime#60866](https://github.com/dotnet/runtime/issues/60866)。）

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-08-08T14:41:19.293

我错过了 LINQ 方法/答案:-)

```
/// <summary>
/// Searches in the haystack array for the given needle using the default equality operator and returns the index at which the needle starts.
/// </summary>
/// <typeparam name="T">Type of the arrays.</typeparam>
/// <param name="haystack">Sequence to operate on.</param>
/// <param name="needle">Sequence to search for.</param>
/// <returns>Index of the needle within the haystack or -1 if the needle isn't contained.</returns>
public static IEnumerable<int> IndexOf<T>(this T[] haystack, T[] needle)
{
    if ((needle != null) && (haystack.Length >= needle.Length))
    {
        for (int l = 0; l < haystack.Length - needle.Length + 1; l++)
        {
            if (!needle.Where((data, index) => !haystack[l + index].Equals(data)).Any())
            {
                yield return l;
            }
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-06-29T04:44:31.237

我上面的 Foubar 答案版本，它避免搜索超出大海捞针，并允许指定起始偏移量。假设针不是空的或比干草堆长。

```
public static unsafe long IndexOf(this byte[] haystack, byte[] needle, long startOffset = 0)
{ 
    fixed (byte* h = haystack) fixed (byte* n = needle)
    {
        for (byte* hNext = h + startOffset, hEnd = h + haystack.LongLength + 1 - needle.LongLength, nEnd = n + needle.LongLength; hNext < hEnd; hNext++)
            for (byte* hInc = hNext, nInc = n; *nInc == *hInc; hInc++)
                if (++nInc == nEnd)
                    return hNext - h;
        return -1;
    }
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-03-08T00:55:05.780

这些是您可以使用的最简单、最快的方法，没有比这些更快的方法了。这是不安全的，但这就是我们使用指针的目的是速度。所以在这里我为您提供我的扩展方法，我使用搜索单个和出现的索引列表。我想说这是这里最干净的代码。

```
 public static unsafe long IndexOf(this byte[] Haystack, byte[] Needle)
    {
        fixed (byte* H = Haystack) fixed (byte* N = Needle)
        {
            long i = 0;
            for (byte* hNext = H, hEnd = H + Haystack.LongLength; hNext < hEnd; i++, hNext++)
            {
                bool Found = true;
                for (byte* hInc = hNext, nInc = N, nEnd = N + Needle.LongLength; Found && nInc < nEnd; Found = *nInc == *hInc, nInc++, hInc++) ;
                if (Found) return i;
            }
            return -1;
        }
    }
    public static unsafe List<long> IndexesOf(this byte[] Haystack, byte[] Needle)
    {
        List<long> Indexes = new List<long>();
        fixed (byte* H = Haystack) fixed (byte* N = Needle)
        {
            long i = 0;
            for (byte* hNext = H, hEnd = H + Haystack.LongLength; hNext < hEnd; i++, hNext++)
            {
                bool Found = true;
                for (byte* hInc = hNext, nInc = N, nEnd = N + Needle.LongLength; Found && nInc < nEnd; Found = *nInc == *hInc, nInc++, hInc++) ;
                if (Found) Indexes.Add(i);
            }
            return Indexes;
        }
    } 
```

以 Locate 为基准，速度提高 1.2-1.4 倍

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-08-06T03:15:37.597

我参加聚会有点晚了如何使用 Boyer Moore 算法但搜索字节而不是字符串。c#代码如下。

眼码公司

```
class Program {
    static void Main(string[] args) {
        byte[] text         =  new byte[] {12,3,5,76,8,0,6,125,23,36,43,76,125,56,34,234,12,4,5,76,8,0,6,125,234,56,211,122,22,4,7,89,76,64,12,3,5,76,8,0,6,123};
        byte[] pattern      = new byte[] {12,3,5,76,8,0,6,125};

        BoyerMoore tmpSearch = new BoyerMoore(pattern,text);

        Console.WriteLine(tmpSearch.Match());
        Console.ReadKey();
    }

    public class BoyerMoore {

        private static int ALPHABET_SIZE = 256;

        private byte[] text;
        private byte[] pattern;

        private int[] last;
        private int[] match;
        private int[] suffix;

        public BoyerMoore(byte[] pattern, byte[] text) {
            this.text = text;
            this.pattern = pattern;
            last = new int[ALPHABET_SIZE];
            match = new int[pattern.Length];
            suffix = new int[pattern.Length];
        }

        /**
        * Searches the pattern in the text.
        * returns the position of the first occurrence, if found and -1 otherwise.
        */
        public int Match() {
            // Preprocessing
            ComputeLast();
            ComputeMatch();

            // Searching
            int i = pattern.Length - 1;
            int j = pattern.Length - 1;    
            while (i < text.Length) {
                if (pattern[j] == text[i]) {
                    if (j == 0) { 
                        return i;
                    }
                    j--;
                    i--;
                } 
                else {
                  i += pattern.Length - j - 1 + Math.Max(j - last[text[i]], match[j]);
                  j = pattern.Length - 1;
              }
            }
            return -1;    
          }  

        /**
        * Computes the function last and stores its values in the array last.
        * last(Char ch) = the index of the right-most occurrence of the character ch
        *                                                           in the pattern; 
        *                 -1 if ch does not occur in the pattern.
        */
        private void ComputeLast() {
            for (int k = 0; k < last.Length; k++) { 
                last[k] = -1;
            }
            for (int j = pattern.Length-1; j >= 0; j--) {
                if (last[pattern[j]] < 0) {
                    last[pattern[j]] = j;
                }
            }
        }

        /**
        * Computes the function match and stores its values in the array match.
        * match(j) = min{ s | 0 < s <= j && p[j-s]!=p[j]
        *                            && p[j-s+1]..p[m-s-1] is suffix of p[j+1]..p[m-1] }, 
        *                                                         if such s exists, else
        *            min{ s | j+1 <= s <= m 
        *                            && p[0]..p[m-s-1] is suffix of p[j+1]..p[m-1] }, 
        *                                                         if such s exists,
        *            m, otherwise,
        * where p is the pattern and m is its length.
        */
        private void ComputeMatch() {
            /* Phase 1 */
            for (int j = 0; j < match.Length; j++) { 
                match[j] = match.Length;
            } //O(m) 

            ComputeSuffix(); //O(m)

            /* Phase 2 */
            //Uses an auxiliary array, backwards version of the KMP failure function.
            //suffix[i] = the smallest j > i s.t. p[j..m-1] is a prefix of p[i..m-1],
            //if there is no such j, suffix[i] = m

            //Compute the smallest shift s, such that 0 < s <= j and
            //p[j-s]!=p[j] and p[j-s+1..m-s-1] is suffix of p[j+1..m-1] or j == m-1}, 
            //                                                         if such s exists,
            for (int i = 0; i < match.Length - 1; i++) {
                int j = suffix[i + 1] - 1; // suffix[i+1] <= suffix[i] + 1
                if (suffix[i] > j) { // therefore pattern[i] != pattern[j]
                    match[j] = j - i;
                } 
                else {// j == suffix[i]
                    match[j] = Math.Min(j - i + match[i], match[j]);
                }
            }

            /* Phase 3 */
            //Uses the suffix array to compute each shift s such that
            //p[0..m-s-1] is a suffix of p[j+1..m-1] with j < s < m
            //and stores the minimum of this shift and the previously computed one.
            if (suffix[0] < pattern.Length) {
                for (int j = suffix[0] - 1; j >= 0; j--) {
                    if (suffix[0] < match[j]) { match[j] = suffix[0]; }
                }
                {
                    int j = suffix[0];
                    for (int k = suffix[j]; k < pattern.Length; k = suffix[k]) {
                        while (j < k) {
                            if (match[j] > k) {
                                match[j] = k;
                            }
                            j++;
                        }
                    }
                }
            }
        }

        /**
        * Computes the values of suffix, which is an auxiliary array, 
        * backwards version of the KMP failure function.
        * 
        * suffix[i] = the smallest j > i s.t. p[j..m-1] is a prefix of p[i..m-1],
        * if there is no such j, suffix[i] = m, i.e. 

        * p[suffix[i]..m-1] is the longest prefix of p[i..m-1], if suffix[i] < m.
        */
        private void ComputeSuffix() {        
            suffix[suffix.Length-1] = suffix.Length;            
            int j = suffix.Length - 1;
            for (int i = suffix.Length - 2; i >= 0; i--) {  
                while (j < suffix.Length - 1 && !pattern[j].Equals(pattern[i])) {
                    j = suffix[j + 1] - 1;
                }
                if (pattern[j] == pattern[i]) { 
                    j--; 
                }
                suffix[i] = j + 1;
            }
        }

    }

} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-12T14:31:30.103

为什么要让简单变得困难？这可以使用 for 循环在任何语言中完成。这是 C# 中的一个：

```
使用系统；
使用 System.Collections.Generic；

命名空间 BinarySearch
{
    课堂节目
    {
        静态无效主要（字符串 [] 参数）
        {
            字节 [] 模式 = 新字节 [] {12,3,5,76,8,0,6,125};
            byte[] toBeSearched = new byte[] {23,36,43,76,125,56,34,234,12,3,5,76,8,0,6,125,234,56,211, 
122,22,4,7,89,76, 64,12,3,5,76,8,0,6,125};

            List<int> 出现次数 = findOccurences(toBeSearched, pattern);

            foreach(int 出现次数) {
                Console.WriteLine("从 0 开始的索引找到匹配：" + 出现);
            }

        }

        静态列表<int> findOccurences(byte[] haystack, byte[] needle)
        {
            List<int> 出现次数 = new List<int>();

            for (int i = 0; i < haystack.Length; i++)
            {
                如果（针[0] == 干草堆[i]）
                {
                    布尔发现=真；
                    整数 j, k;
                    对于 (j = 0, k = i; j < needle.Length; j++, k++)
                    {
                        if (k >= haystack.Length || needle[j] != haystack[k])
                        {
                            找到=假；
                            休息;
                        }
                    }
                    如果（找到）
                    {
                        出现次数.Add(i - 1);
                        我 = k;
                    }
                }
            }
            返回事件；
        }
    }
}

```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-12T14:44:18.767

感谢您抽出宝贵的时间...

这是我在问我的问题之前使用/测试的代码......我问这个问题的原因是我确定我没有使用最佳代码来做到这一点......所以再次感谢花时间！

```
 private static int CountPatternMatches(byte[] pattern, byte[] bytes)
   {
        int counter = 0;

        for (int i = 0; i < bytes.Length; i++)
        {
            if (bytes[i] == pattern[0] && (i + pattern.Length) < bytes.Length)
            {
                for (int x = 1; x < pattern.Length; x++)
                {
                    if (pattern[x] != bytes[x+i])
                    {
                        break;
                    }

                    if (x == pattern.Length -1)
                    {
                        counter++;
                        i = i + pattern.Length;
                    }
                }
            }
        }

        return counter;
    } 
```

有人在我的代码中看到任何错误吗？这被认为是一种骇人听闻的方法吗？我已经尝试了你们发布的几乎所有样本，我似乎在比赛结果中得到了一些变化。我一直在使用 ~10Mb 字节数组作为我的 toBeSearched 数组来运行我的测试。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-11-12T14:05:54.040

我使用我的答案和 Alnitak 的答案中的提示创建了一个新功能。

```
public static List<Int32> LocateSubset(Byte[] superSet, Byte[] subSet)
{
    if ((superSet == null) || (subSet == null))
    {
       throw new ArgumentNullException();
    }
    if ((superSet.Length < subSet.Length) || (superSet.Length == 0) || (subSet.Length == 0))
    {
        return new List<Int32>();
    }
    var result = new List<Int32>();
    Int32 currentIndex = 0;
    Int32 maxIndex =  superSet.Length - subSet.Length;
    while (currentIndex < maxIndex)
    {
         Int32 matchCount = CountMatches(superSet, currentIndex, subSet);
         if (matchCount ==  subSet.Length)
         {
            result.Add(currentIndex);
         }
         currentIndex++;
         if (matchCount > 0)
         {
            currentIndex += matchCount - 1;
         }
    }
    return result;
}

private static Int32 CountMatches(Byte[] superSet, int startIndex, Byte[] subSet)
{
    Int32 currentOffset = 0;
    while (currentOffset < subSet.Length)
    {
        if (superSet[startIndex + currentOffset] != subSet[currentOffset])
        {
            break;
        }
        currentOffset++;
    }
    return currentOffset;
} 
```

唯一让我不高兴的是

```
 currentIndex++;
         if (matchCount > 0)
         {
            currentIndex += matchCount - 1;
         } 
```

部分...我想使用 if else 来避免-1，但这会导致更好的分支预测（尽管我不确定它是否会那么重要）..

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-11-12T11:27:43.717

这是我的（不是最高效的）解决方案。它依赖于 bytes/latin-1 转换是无损的这一事实，而 bytes/ASCII 或 bytes/UTF8 转换*并非*如此。

它的优点是它适用于任何字节值（某些其他解决方案无法正确使用字节 0x80-0xff），并且可以扩展以执行更高级的正则表达式匹配。

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Text.RegularExpressions;

class C {

  public static void Main() {
    byte[] data = {0, 100, 0, 255, 100, 0, 100, 0, 255};
    byte[] pattern = {0, 255};
    foreach (int i in FindAll(data, pattern)) {
      Console.WriteLine(i);
    }
  }

  public static IEnumerable<int> FindAll(
    byte[] haystack,
    byte[] needle
  ) {
    // bytes <-> latin-1 conversion is lossless
    Encoding latin1 = Encoding.GetEncoding("iso-8859-1");
    string sHaystack = latin1.GetString(haystack);
    string sNeedle = latin1.GetString(needle);
    for (Match m = Regex.Match(sHaystack, Regex.Escape(sNeedle));
         m.Success; m = m.NextMatch()) {
      yield return m.Index;
    }
  }
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-12T13:14:49.430

我会使用一个通过转换为字符串来匹配的解决方案......

您应该编写一个实现[Knuth-Morris-Pratt 搜索算法](http://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm)的简单函数。这将是您可以用来查找正确索引的最快的简单算法。（您可以使用[Boyer-Moore](http://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_string_search_algorithm)，但它需要更多设置。

优化算法后，您可以尝试寻找其他类型的优化。但是你应该从基础开始。

例如，当前“最快”的是 Jb Evian 的 Locate 解决方案。

如果你看核心

```
 for (int i = 0; i < self.Length; i++) {
            if (!IsMatch (self, i, candidate))
                    continue;

            list.Add (i);
    } 
```

在子算法匹配后，它将开始在 i + 1 处找到匹配，但您已经知道第一个可能的匹配将是 i + Candidate.Length。所以如果你添加，

```
i += candidate.Length -2; //  -2 instead of -1 because the i++ will add the last index 
```

当您期望在超集中出现很多子集时，它会快很多。（Bruno Conde 已经在他的解决方案中这样做了）

但这只是 KNP 算法的一半，您还应该在 IsMatch 方法中添加一个名为 numberOfValidMatches 的额外参数，这将是一个输出参数。

这将解决以下问题：

```
int validMatches = 0;
if (!IsMatch (self, i, candidate, out validMatches))
{
    i += validMatches - 1; // -1 because the i++ will do the last one
    continue;
} 
```

和

```
static bool IsMatch (byte [] array, int position, byte [] candidate, out int numberOfValidMatches)
{
    numberOfValidMatches = 0;
    if (candidate.Length > (array.Length - position))
            return false;

    for (i = 0; i < candidate.Length; i++)
    {
            if (array [position + i] != candidate [i])
                    return false;
            numberOfValidMatches++; 
    }

    return true;
} 
```

稍微重构一下，您可以使用 numberOfValidMatches 作为循环变量，并使用 while 重写 Locate 循环以避免 -2 和 -1。但我只是想说明如何添加 KMP 算法。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-12T13:34:51.153

Jb Evain 的回答是：

```
 for (int i = 0; i < self.Length; i++) {
      if (!IsMatch (self, i, candidate))
           continue;
      list.Add (i);
 } 
```

然后 IsMatch 函数首先检查是否`candidate`超出了正在搜索的数组的长度。

`for`如果对循环进行编码，这将更有效：

```
 for (int i = 0, n = self.Length - candidate.Length + 1; i < n; ++i) {
          if (!IsMatch (self, i, candidate))
               continue;
          list.Add (i);
     } 
```

在这一点上，也*可以*从一开始就消除测试`IsMatch`，只要您通过前置条件签订合同，永远不要使用“非法”参数调用它。注意：修复了 2019 年的一个错误。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-08-13T09:51:37.530

速度不是一切。你检查过它们的一致性吗？

我没有测试这里列出的所有代码。我测试了自己的代码（我承认这并不完全一致）和 IndexOfSequence。我发现对于许多测试 IndexOfSequence 比我的代码快很多，但是通过重复测试，我发现它不太一致。特别是在数组末尾查找模式似乎最麻烦，但有时它也会在数组中间错过它们。

我的测试代码不是为了提高效率而设计的，我只是想有一堆随机数据，里面有一些已知的字符串。该测试模式大致类似于 http 表单上传流中的边界标记。这就是我遇到这段代码时所寻找的，所以我想我会用我将要搜索的数据来测试它。看起来模式越长，IndexOfSequence 越经常错过一个值。

```
private static void TestMethod()
{
    Random rnd = new Random(DateTime.Now.Millisecond);
    string Pattern = "-------------------------------65498495198498";
    byte[] pattern = Encoding.ASCII.GetBytes(Pattern);

    byte[] testBytes;
    int count = 3;
    for (int i = 0; i < 100; i++)
    {
        StringBuilder TestString = new StringBuilder(2500);
        TestString.Append(Pattern);
        byte[] buf = new byte[1000];
        rnd.NextBytes(buf);
        TestString.Append(Encoding.ASCII.GetString(buf));
        TestString.Append(Pattern);
        rnd.NextBytes(buf);
        TestString.Append(Encoding.ASCII.GetString(buf));
        TestString.Append(Pattern);
        testBytes = Encoding.ASCII.GetBytes(TestString.ToString());

        List<int> idx = IndexOfSequence(ref testBytes, pattern, 0);
        if (idx.Count != count)
        {
            Console.Write("change from {0} to {1} on iteration {2}: ", count, idx.Count, i);
            foreach (int ix in idx)
            {
                Console.Write("{0}, ", ix);
            }
            Console.WriteLine();
            count = idx.Count;
        }
    }

    Console.WriteLine("Press ENTER to exit");
    Console.ReadLine();
} 
```

（显然，我将 IndexOfSequence 从扩展转换回此测试的常规方法）

这是我的输出的示例运行：

```
change from 3 to 2 on iteration 1: 0, 2090,
change from 2 to 3 on iteration 2: 0, 1045, 2090,
change from 3 to 2 on iteration 3: 0, 1045,
change from 2 to 3 on iteration 4: 0, 1045, 2090,
change from 3 to 2 on iteration 6: 0, 2090,
change from 2 to 3 on iteration 7: 0, 1045, 2090,
change from 3 to 2 on iteration 11: 0, 2090,
change from 2 to 3 on iteration 12: 0, 1045, 2090,
change from 3 to 2 on iteration 14: 0, 2090,
change from 2 to 3 on iteration 16: 0, 1045, 2090,
change from 3 to 2 on iteration 17: 0, 1045,
change from 2 to 3 on iteration 18: 0, 1045, 2090,
change from 3 to 1 on iteration 20: 0,
change from 1 to 3 on iteration 21: 0, 1045, 2090,
change from 3 to 2 on iteration 22: 0, 2090,
change from 2 to 3 on iteration 23: 0, 1045, 2090,
change from 3 to 2 on iteration 24: 0, 2090,
change from 2 to 3 on iteration 25: 0, 1045, 2090,
change from 3 to 2 on iteration 26: 0, 2090,
change from 2 to 3 on iteration 27: 0, 1045, 2090,
change from 3 to 2 on iteration 43: 0, 1045,
change from 2 to 3 on iteration 44: 0, 1045, 2090,
change from 3 to 2 on iteration 48: 0, 1045,
change from 2 to 3 on iteration 49: 0, 1045, 2090,
change from 3 to 2 on iteration 50: 0, 2090,
change from 2 to 3 on iteration 52: 0, 1045, 2090,
change from 3 to 2 on iteration 54: 0, 1045,
change from 2 to 3 on iteration 57: 0, 1045, 2090,
change from 3 to 2 on iteration 62: 0, 1045,
change from 2 to 3 on iteration 63: 0, 1045, 2090,
change from 3 to 2 on iteration 72: 0, 2090,
change from 2 to 3 on iteration 73: 0, 1045, 2090,
change from 3 to 2 on iteration 75: 0, 2090,
change from 2 to 3 on iteration 76: 0, 1045, 2090,
change from 3 to 2 on iteration 78: 0, 1045,
change from 2 to 3 on iteration 79: 0, 1045, 2090,
change from 3 to 2 on iteration 81: 0, 2090,
change from 2 to 3 on iteration 82: 0, 1045, 2090,
change from 3 to 2 on iteration 85: 0, 2090,
change from 2 to 3 on iteration 86: 0, 1045, 2090,
change from 3 to 2 on iteration 89: 0, 2090,
change from 2 to 3 on iteration 90: 0, 1045, 2090,
change from 3 to 2 on iteration 91: 0, 2090,
change from 2 to 1 on iteration 92: 0,
change from 1 to 3 on iteration 93: 0, 1045, 2090,
change from 3 to 1 on iteration 99: 0, 
```

我并不是要选择 IndexOfSequence，它恰好是我今天开始使用的那个。我在一天结束时注意到它似乎缺少数据中的模式，所以我今晚编写了自己的模式匹配器。虽然它没有那么快。在发布之前，我将对其进行更多调整，看看是否可以使其 100% 一致。

我只是想提醒大家，在你信任生产代码之前，他们应该测试这样的东西，以确保它们给出好的、可重复的结果。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-11-27T09:46:03.330

我尝试了各种解决方案，最终修改了 SearchBytePattern 之一。我在 30k 序列上进行了测试，速度很快 :)

```
 static public int SearchBytePattern(byte[] pattern, byte[] bytes)
    {
        int matches = 0;
        for (int i = 0; i < bytes.Length; i++)
        {
            if (pattern[0] == bytes[i] && bytes.Length - i >= pattern.Length)
            {
                bool ismatch = true;
                for (int j = 1; j < pattern.Length && ismatch == true; j++)
                {
                    if (bytes[i + j] != pattern[j])
                        ismatch = false;
                }
                if (ismatch)
                {
                    matches++;
                    i += pattern.Length - 1;
                }
            }
        }
        return matches;
    } 
```

让我知道你的想法。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2011-07-04T07:10:33.113

这是我想出的解决方案。我包括了我在实施过程中发现的笔记。它可以匹配前向、后向和不同的（in/dec）修正量，例如方向；从大海捞针中的任何偏移量开始。

任何输入都会很棒！

```
 /// <summary>
    /// Matches a byte array to another byte array
    /// forwards or reverse
    /// </summary>
    /// <param name="a">byte array</param>
    /// <param name="offset">start offset</param>
    /// <param name="len">max length</param>
    /// <param name="b">byte array</param>
    /// <param name="direction">to move each iteration</param>
    /// <returns>true if all bytes match, otherwise false</returns>
    internal static bool Matches(ref byte[] a, int offset, int len, ref byte[] b, int direction = 1)
    {
        #region Only Matched from offset Within a and b, could not differ, e.g. if you wanted to mach in reverse for only part of a in some of b that would not work
        //if (direction == 0) throw new ArgumentException("direction");
        //for (; offset < len; offset += direction) if (a[offset] != b[offset]) return false;
        //return true;
        #endregion
        //Will match if b contains len of a and return a a index of positive value
        return IndexOfBytes(ref a, ref offset, len, ref b, len) != -1;
    }

///Here is the Implementation code

    /// <summary>
    /// Swaps two integers without using a temporary variable
    /// </summary>
    /// <param name="a"></param>
    /// <param name="b"></param>
    internal static void Swap(ref int a, ref int b)
    {
        a ^= b;
        b ^= a;
        a ^= b;
    }

    /// <summary>
    /// Swaps two bytes without using a temporary variable
    /// </summary>
    /// <param name="a"></param>
    /// <param name="b"></param>
    internal static void Swap(ref byte a, ref byte b)
    {
        a ^= b;
        b ^= a;
        a ^= b;
    }

    /// <summary>
    /// Can be used to find if a array starts, ends spot Matches or compltely contains a sub byte array
    /// Set checkLength to the amount of bytes from the needle you want to match, start at 0 for forward searches start at hayStack.Lenght -1 for reverse matches
    /// </summary>
    /// <param name="a">Needle</param>
    /// <param name="offset">Start in Haystack</param>
    /// <param name="len">Length of required match</param>
    /// <param name="b">Haystack</param>
    /// <param name="direction">Which way to move the iterator</param>
    /// <returns>Index if found, otherwise -1</returns>
    internal static int IndexOfBytes(ref byte[] needle, ref int offset, int checkLength, ref byte[] haystack, int direction = 1)
    {
        //If the direction is == 0 we would spin forever making no progress
        if (direction == 0) throw new ArgumentException("direction");
        //Cache the length of the needle and the haystack, setup the endIndex for a reverse search
        int needleLength = needle.Length, haystackLength = haystack.Length, endIndex = 0, workingOffset = offset;
        //Allocate a value for the endIndex and workingOffset
        //If we are going forward then the bound is the haystackLength
        if (direction >= 1) endIndex = haystackLength;
        #region [Optomization - Not Required]
        //{

            //I though this was required for partial matching but it seems it is not needed in this form
            //workingOffset = needleLength - checkLength;
        //}
        #endregion
        else Swap(ref workingOffset, ref endIndex);                
        #region [Optomization - Not Required]
        //{ 
            //Otherwise we are going in reverse and the endIndex is the needleLength - checkLength                   
            //I though the length had to be adjusted but it seems it is not needed in this form
            //endIndex = needleLength - checkLength;
        //}
        #endregion
        #region [Optomized to above]
        //Allocate a value for the endIndex
        //endIndex = direction >= 1 ? haystackLength : needleLength - checkLength,
        //Determine the workingOffset
        //workingOffset = offset > needleLength ? offset : needleLength;            
        //If we are doing in reverse swap the two
        //if (workingOffset > endIndex) Swap(ref workingOffset, ref endIndex);
        //Else we are going in forward direction do the offset is adjusted by the length of the check
        //else workingOffset -= checkLength;
        //Start at the checkIndex (workingOffset) every search attempt
        #endregion
        //Save the checkIndex (used after the for loop is done with it to determine if the match was checkLength long)
        int checkIndex = workingOffset;
        #region [For Loop Version]
        ///Optomized with while (single op)
        ///for (int checkIndex = workingOffset; checkIndex < endIndex; offset += direction, checkIndex = workingOffset)
            ///{
                ///Start at the checkIndex
                /// While the checkIndex < checkLength move forward
                /// If NOT (the needle at the checkIndex matched the haystack at the offset + checkIndex) BREAK ELSE we have a match continue the search                
                /// for (; checkIndex < checkLength; ++checkIndex) if (needle[checkIndex] != haystack[offset + checkIndex]) break; else continue;
                /// If the match was the length of the check
                /// if (checkIndex == checkLength) return offset; //We are done matching
            ///}
        #endregion
        //While the checkIndex < endIndex
        while (checkIndex < endIndex)
        {
            for (; checkIndex < checkLength; ++checkIndex) if (needle[checkIndex] != haystack[offset + checkIndex]) break; else continue;
            //If the match was the length of the check
            if (checkIndex == checkLength) return offset; //We are done matching
            //Move the offset by the direction, reset the checkIndex to the workingOffset
            offset += direction; checkIndex = workingOffset;                
        }
        //We did not have a match with the given options
        return -1;
    } 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-06-27T07:48:09.257

您可以使用 ORegex：

```
var oregex = new ORegex<byte>("{0}{1}{2}", x=> x==12, x=> x==3, x=> x==5);
var toSearch = new byte[]{1,1,12,3,5,1,12,3,5,5,5,5};

var found = oregex.Matches(toSearch); 
```

将找到两个匹配项：

```
i:2;l:3
i:6;l:3 
```

复杂性：在最坏的情况下为 O(n*m)，在现实生活中它是 O(n)，因为内部状态机。在某些情况下，它比 .NET Regex 更快。它结构紧凑、速度快，专为阵列模式匹配而设计。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-12-13T00:29:25.600

只是另一个易于遵循且对于 O(n) 类型的操作非常有效的答案，无需使用不安全的代码或复制部分源数组。

一定要测试。在这个主题上找到的一些建议很容易受到一定情况的影响。

```
 static void Main(string[] args)
    {
        //                                                         1   1  1  1  1  1  1  1  1  1  2   2   2
        //                           0  1  2  3  4  5  6  7  8  9  0   1  2  3  4  5  6  7  8  9  0   1   2  3  4  5  6  7  8  9
        byte[] buffer = new byte[] { 1, 0, 2, 3, 4, 5, 6, 7, 8, 9, 9, 10, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 5, 5, 0, 5, 5, 1, 2 };
        byte[] beginPattern = new byte[] { 1, 0, 2 };
        byte[] middlePattern = new byte[] { 8, 9, 10 };
        byte[] endPattern = new byte[] { 9, 10, 11 };
        byte[] wholePattern = new byte[] { 1, 0, 2, 3, 4, 5, 6, 7, 8, 9, 9, 10, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 };
        byte[] noMatchPattern = new byte[] { 7, 7, 7 };

        int beginIndex = ByteArrayPatternIndex(buffer, beginPattern);
        int middleIndex = ByteArrayPatternIndex(buffer, middlePattern);
        int endIndex = ByteArrayPatternIndex(buffer, endPattern);
        int wholeIndex = ByteArrayPatternIndex(buffer, wholePattern);
        int noMatchIndex = ByteArrayPatternIndex(buffer, noMatchPattern);
    }

    /// <summary>
    /// Returns the index of the first occurrence of a byte array within another byte array
    /// </summary>
    /// <param name="buffer">The byte array to be searched</param>
    /// <param name="pattern">The byte array that contains the pattern to be found</param>
    /// <returns>If buffer contains pattern then the index of the first occurrence of pattern within buffer; otherwise, -1</returns>
    public static int ByteArrayPatternIndex(byte[] buffer, byte[] pattern)
    {
        if (buffer != null && pattern != null && pattern.Length <= buffer.Length)
        {
            int resumeIndex;
            for (int i = 0; i <= buffer.Length - pattern.Length; i++)
            {
                if (buffer[i] == pattern[0]) // Current byte equals first byte of pattern
                {
                    resumeIndex = 0;
                    for (int x = 1; x < pattern.Length; x++)
                    {
                        if (buffer[i + x] == pattern[x])
                        {
                            if (x == pattern.Length - 1)  // Matched the entire pattern
                                return i;
                            else if (resumeIndex == 0 && buffer[i + x] == pattern[0])  // The current byte equals the first byte of the pattern so start here on the next outer loop iteration
                                resumeIndex = i + x;
                        }
                        else
                        {
                            if (resumeIndex > 0)
                                i = resumeIndex - 1;  // The outer loop iterator will increment so subtract one
                            else if (x > 1)
                                i += (x - 1);  // Advance the outer loop variable since we already checked these bytes
                            break;
                        }
                    }
                }
            }
        }
        return -1;
    }

    /// <summary>
    /// Returns the indexes of each occurrence of a byte array within another byte array
    /// </summary>
    /// <param name="buffer">The byte array to be searched</param>
    /// <param name="pattern">The byte array that contains the pattern to be found</param>
    /// <returns>If buffer contains pattern then the indexes of the occurrences of pattern within buffer; otherwise, null</returns>
    /// <remarks>A single byte in the buffer array can only be part of one match.  For example, if searching for 1,2,1 in 1,2,1,2,1 only zero would be returned.</remarks>
    public static int[] ByteArrayPatternIndex(byte[] buffer, byte[] pattern)
    {
        if (buffer != null && pattern != null && pattern.Length <= buffer.Length)
        {
            List<int> indexes = new List<int>();
            int resumeIndex;
            for (int i = 0; i <= buffer.Length - pattern.Length; i++)
            {
                if (buffer[i] == pattern[0]) // Current byte equals first byte of pattern
                {
                    resumeIndex = 0;
                    for (int x = 1; x < pattern.Length; x++)
                    {
                        if (buffer[i + x] == pattern[x])
                        {
                            if (x == pattern.Length - 1)  // Matched the entire pattern
                                indexes.Add(i);
                            else if (resumeIndex == 0 && buffer[i + x] == pattern[0])  // The current byte equals the first byte of the pattern so start here on the next outer loop iteration
                                resumeIndex = i + x;
                        }
                        else
                        {
                            if (resumeIndex > 0)
                                i = resumeIndex - 1;  // The outer loop iterator will increment so subtract one
                            else if (x > 1)
                                i += (x - 1);  // Advance the outer loop variable since we already checked these bytes
                            break;
                        }
                    }
                }
            }
            if (indexes.Count > 0)
                return indexes.ToArray();
        }
        return null;
    } 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2012-04-13T11:47:57.470

这是我仅使用基本数据类型编写的简单代码：（它返回第一次出现的索引）

```
private static int findMatch(byte[] data, byte[] pattern) {
    if(pattern.length > data.length){
        return -1;
    }
    for(int i = 0; i<data.length ;){
        int j;
       for(j=0;j<pattern.length;j++){

           if(pattern[j]!=data[i])
               break;
           i++;
       }
       if(j==pattern.length){
           System.out.println("Pattern found at : "+(i - pattern.length ));
           return i - pattern.length ;
       }
       if(j!=0)continue;
       i++;
    }

    return -1;
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-01-01T08:19:49.430

我试图理解 Sanchez 的建议并进行更快的搜索。以下代码的性能几乎相同。但代码更容易理解。

```
public int Search3(byte[] src, byte[] pattern)
    {
        int index = -1;

        for (int i = 0; i < src.Length; i++)
        {
            if (src[i] != pattern[0])
            {
                continue;
            }
            else
            {
                bool isContinoue = true;
                for (int j = 1; j < pattern.Length; j++)
                {
                    if (src[++i] != pattern[j])
                    {
                        isContinoue = true;
                        break;
                    }
                    if(j == pattern.Length - 1)
                    {
                        isContinoue = false;
                    }
                }
                if ( ! isContinoue)
                {
                    index = i-( pattern.Length-1) ;
                    break;
                }
            }
        }
        return index;
    } 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-08-17T09:37:08.447

这是我自己对这个话题的看法。我使用指针来确保它在更大的数组上更快。此函数将返回序列的第一次出现（这是我自己的情况所需要的）。

我相信您可以稍微修改它以返回所有出现的列表。

我所做的相当简单。我循环遍历源数组（干草堆），直到找到模式的第一个字节（针）。当找到第一个字节时，我会继续单独检查下一个字节是否与模式的下一个字节匹配。如果没有，我会继续正常搜索，从我之前所在的索引（大海捞针）开始，然后再尝试匹配针。

所以这里是代码：

```
 public unsafe int IndexOfPattern(byte[] src, byte[] pattern)
    {
        fixed(byte *srcPtr = &src[0])
        fixed (byte* patternPtr = &pattern[0])
        {
            for (int x = 0; x < src.Length; x++)
            {
                byte currentValue = *(srcPtr + x);

                if (currentValue != *patternPtr) continue;

                bool match = false;

                for (int y = 0; y < pattern.Length; y++)
                {
                    byte tempValue = *(srcPtr + x + y);
                    if (tempValue != *(patternPtr + y))
                    {
                        match = false;
                        break;
                    }

                    match = true;
                }

                if (match)
                    return x;
            }
        }
        return -1;
    } 
```

安全代码如下：

```
 public int IndexOfPatternSafe(byte[] src, byte[] pattern)
    {
        for (int x = 0; x < src.Length; x++)
        {
            byte currentValue = src[x];
            if (currentValue != pattern[0]) continue;

            bool match = false;

            for (int y = 0; y < pattern.Length; y++)
            {
                byte tempValue = src[x + y];
                if (tempValue != pattern[y])
                {
                    match = false;
                    break;
                }

                match = true;
            }

            if (match)
                return x;
        }

        return -1;
    } 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-12-10T19:47:25.617

我使用一个简单的通用方法

```
void Main()
{
    Console.WriteLine(new[]{255,1,3,4,8,99,92,9,0,5,128}.Position(new[]{9,0}));

    Console.WriteLine("Philipp".ToArray().Position("il".ToArray()));

    Console.WriteLine(new[] { "Mo", "Di", "Mi", "Do", "Fr", "Sa", "So","Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"}.Position(new[] { "Fr", "Sa" }, 7));
}

static class Extensions
{
    public static int Position<T>(this T[] source, T[] pattern, int start = 0)
    {
        var matchLenght = 0;
        foreach (var indexSource in Enumerable.Range(start, source.Length - pattern.Length))
            foreach (var indexPattern in Enumerable.Range(0, pattern.Length))
                if (source[indexSource + indexPattern].Equals(pattern[indexPattern]))
                    if (++matchLenght == pattern.Length)
                        return indexSource;
        return -1;
    }
} 
```

输出：

```
7
2
11 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2019-05-14T07:39:05.377

前几天我遇到了这个问题，试试这个：

```
 public static long FindBinaryPattern(byte[] data, byte[] pattern)
        {
            using (MemoryStream stream = new MemoryStream(data))
            {
                return FindBinaryPattern(stream, pattern);
            }
        }
        public static long FindBinaryPattern(string filename, byte[] pattern)
        {
            using (FileStream stream = new FileStream(filename, FileMode.Open))
            {
                return FindBinaryPattern(stream, pattern);
            }
        }
        public static long FindBinaryPattern(Stream stream, byte[] pattern)
        {
            byte[] buffer = new byte[1024 * 1024];
            int patternIndex = 0;
            int read;
            while ((read = stream.Read(buffer, 0, buffer.Length)) > 0)
            {
                for (int bufferIndex = 0; bufferIndex < read; ++bufferIndex)
                {
                    if (buffer[bufferIndex] == pattern[patternIndex])
                    {
                        ++patternIndex;
                        if (patternIndex == pattern.Length)
                            return stream.Position - (read - bufferIndex) - pattern.Length + 1;
                    }
                    else
                    {
                        patternIndex = 0;
                    }
                }
            }
            return -1;
        } 
```

它没有做任何聪明的事，保持简单。

* * *

## 回答 #28

> 赞同：-2
> 
> 时间：2008-11-12T10:00:24.080

您可以将字节数组放入[String](http://msdn.microsoft.com/en-us/library/ezh7k8d5.aspx)并通过 IndexOf 运行匹配。或者您至少可以在字符串匹配上重用[现有算法。](http://en.wikipedia.org/wiki/String_searching_algorithm)

```
 [STAThread]
    static void Main(string[] args)
    {
        byte[] pattern = new byte[] {12,3,5,76,8,0,6,125};
        byte[] toBeSearched = new byte[] {23,36,43,76,125,56,34,234,12,3,5,76,8,0,6,125,234,56,211,122,22,4,7,89,76,64,12,3,5,76,8,0,6,125};
        string needle, haystack;

        unsafe 
        {
            fixed(byte * p = pattern) {
                needle = new string((SByte *) p, 0, pattern.Length);
            } // fixed

            fixed (byte * p2 = toBeSearched) 
            {
                haystack = new string((SByte *) p2, 0, toBeSearched.Length);
            } // fixed

            int i = haystack.IndexOf(needle, 0);
            System.Console.Out.WriteLine(i);
        }
    } 
```

* * *

## 回答 #29

> 赞同：-3
> 
> 时间：2008-11-12T10:22:58.903

toBeSearched.Except(pattern) 将返回差异 toBeSearched.Intersect(pattern) 将产生一组交点 通常，您应该查看 Linq 扩展中的扩展方法

# .net - 错误：[Microsoft][ODBC Driver Manager] 未找到数据源名称且未指定默认驱动程序

> ID：283460
> 
> 赞同：28
> 
> 时间：2008-11-12T09:55:04.140
> 
> 标签：.net, visual-studio-2005, odbc, datasource

在将 .net 连接到 sybase 服务器时，我收到以下错误消息：

> [Microsoft][ODBC Driver Manager] 未找到数据源名称且未指定默认驱动程序

这以前可以正常工作。具有相同细节的系统 DSN 工作和通过 vs.net 的数据连接也可以工作。

我正在使用 vs.net 2005。

有什么建议么？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2011-02-17T20:34:18.673

如果您使用的是 x64 服务器，请记住 x86 和 x64 应用程序有不同的 ODBC 设置。管理工具列表中的“数据源 (ODBC)”工具将您带到 x64 版本。要查看/编辑 x86 ODBC 设置，您需要手动运行该版本的工具：

```
%windir%\SysWOW64\odbcad32.exe (%windir% is usually C:\Windows) 
```

当您的应用程序以 x64 运行时，它将使用 x64 数据源，而当它以 x86 运行时，它将改用这些数据源。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-04-28T17:26:46.767

我遇到了类似的错误，通过从以下位置安装相应的 MySQL 驱动程序解决了该错误：

[http://www.connectionstrings.com/mysql-connector-odbc-5-2/info-and-download/](http://www.connectionstrings.com/mysql-connector-odbc-5-2/info-and-download/)

并通过执行以下步骤：

1.  转到左侧菜单中的 IIS 和应用程序池。
2.  选择分配给项目的*相关应用程序池。*
3.  单击*设置应用程序池默认值*。
4.  在常规选项卡中，将*启用 32 位应用程序*条目设置为“真”。

参考：

[http://www.codeproject.com/Tips/305249/ERROR-IM-Microsoft-ODBC-Driver-Manager-Data-sou](http://www.codeproject.com/Tips/305249/ERROR-IM-Microsoft-ODBC-Driver-Manager-Data-sou)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-11-22T12:40:26.380

对于最近遇到这个问题的任何人，我在 Windows 网络上遇到了这个问题，并提供了一个额外的检查：

Python 脚本连接可以从我的（linux）机器上的命令行工作，但一些用户在连接时遇到问题 - 它从 CLI 工作表明 DSN 和凭据是正确的。对我们来说，问题是组安全策略要求在每台机器上设置 ODBC 凭据。一旦我们添加了（出于某种原因，用户拥有我们各种系统所需的四个 ODBC 凭据中的三个），他们就能够连接。

您当然可以在组级别执行此操作，但由于这是一台机器的简单遗漏，因此我在`Control Panel > ODBC Drivers > New`

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-15T07:16:15.247

执行以下步骤：

1.  `regedit`通过在“运行”窗口中键入来启动注册表编辑器。
2.  在注册表中选择以下项：`HKEY_LOCAL_MACHINE\SOFTWARE\ODBC`.
3.  在“安全”菜单中，单击“权限”。
4.  向用于建立连接的帐户授予完全权限。
5.  退出注册表编辑器。

# printing - Lineprinters 模拟器/虚拟机

> ID：283464
> 
> 赞同：1
> 
> 时间：2008-11-12T09:57:15.383
> 
> 标签：printing, emulation

有没有像虚拟Lineprinter这样的东西。我的意思是打印机的软件仿真，输出到屏幕。

我有一个项目来更改打印作业的输出。我过去使用 lineprinter 的经历是单调乏味的

```
loop:
   print
   walk down two flights
   check the output
   walk back up two flights
   edit code
got loop: 
```

任何认为可以在程序员办公室安装 lineprinter 的人都没有使用过 LinePrinter！

谷歌只是打开了打印机仿真，就像在仿真其他打印机或虚拟打印机端口的打印机中一样！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T16:32:16.000

不完全确定您在寻找什么。如果您只是试图捕获数据并显示它，您可以简单地在 Windows 上安装打印机并使用[Redmon](http://pages.cs.wisc.edu/~ghost/redmon/index.htm)和 Redfile（包含在 Redmon 中）之类的东西将输出定向到可以使用任何应用程序简单显示的文件（假设它只是文本）。如果输出有 PCL 控制代码，您可以使用[PCLWorks 之](http://www.pclworks.com/)类的应用程序查看。

这有帮助吗？如果您喜欢这个想法，但 Redmon 不适合您，我有一个类似的端口监视器，它内置了输出到文件，只需在此响应中添加注释，我会找到一种方法将其发送给您。

处理 lineprinter 或其他主机类型输出的另一个好工具是[RPM](http://www.brooksnet.com/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T13:54:22.173

在 DOS 中，有一个名为“CON:”的设备，它代表控制台。

它像 LPT1 一样输出到（或从！）控制台：输出到第一行打印机。

当您指定您的打印机时，尝试替换 CON: 而不是 LPT1:。

# language-agnostic - 在哪里包装一行代码，尤其是长参数列表？

> ID：283465
> 
> 赞同：27
> 
> 时间：2008-11-12T09:58:15.037
> 
> 标签：language-agnostic, word-wrap

您首选的包装代码行的方式是什么，尤其是在涉及长参数列表时？

有几个与换行有关的问题（例如，[当编写代码时，你是否换行文本？](https://stackoverflow.com/questions/268284/when-writing-code-do-you-wrap-text-or-not)和[行宽格式标准](https://stackoverflow.com/questions/276022/line-width-formatting-standard)），但我无法找到一个涵盖在哪里换行代码的问题。

假设我们有一行代码像这个例子一样继续运行：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(Argument1, Argument2, Argument3, Argument4); 
```

**那应该怎么包？**

以下是我能想到的几种方法，以及它们的一些缺点：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(Argument1, Argument2,
    Argument3, Argument4); 
```

我个人不喜欢这个选项，因为格式似乎在视觉上将参数列表与我试图调用的方法分开，特别是因为在新行的孤立参数上方有一个赋值等号（“=”）。

所以，有一段时间我采用了以下方法：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(Argument1,
                                                       Argument2,
                                                       Argument3,
                                                       Argument4); 
```

在这里，参数都捆绑在一起，都在方法的第一个参数的一侧。但是，一个问题是，由于制表符缩进的空格数量，参数列表不会总是在第二行开始排列。（并且为格式化输入额外的空格会太耗时。）

上一个问题的[答案](https://stackoverflow.com/questions/268284/when-writing-code-do-you-wrap-text-or-not#269025)建议采用以下格式：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(
    Argument1,
    Argument2,
    Argument3,
    Argument4
); 
```

我实际上喜欢这种格式，因为它具有视觉吸引力，但它也确实在视觉上将参数与列表所属的方法分开。另外，我更喜欢单个方法调用不占用太多行。

所以，我的问题是，*如果不涉及防止代码行太长的问题*，**你会如何建议包装代码行？**具体来说，**当涉及到长参数列表时，哪里是中断代码行的好地方？**

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-12T10:47:51.410

```
int SomeReturnValue = SomeMethodWithLotsOfArguments
(   Argument1,
    Argument2,
    Argument3,
    Argument4
); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-12T10:13:02.137

建议的选项 3

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(
    Argument1,
    Argument2,
    Argument3,
    Argument4
); 
```

是一种更好的方式，因为它给人一种很好的感觉。如果参数的长度或多或少相同，那么我们可以将它们放在一起，以便它们排列成一个表格，例如

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(
    Argument1,    Argument2,    Argument3,    Argument4,
    Argument005,  Argument006,  Argument7,    Argument8
); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-12T12:37:54.077

我更喜欢这种方式：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(Argument1, Argument2, 
                        Argument3, Argument4); 
```

线在最接近您当前最大线宽（无论是什么）的位置结束，下一行相对于等号缩进您通常的缩进级别（无论是什么）。

不知道为什么，但我认为在大多数情况下它是最易读的选项。但是，我选择不对这些东西学究气，我总是更喜欢给定代码段最易读的东西，即使这可能会破坏一些缩进或格式化规则（当然，在限制范围内）。

一个例子是，如果函数需要许多参数或它们本身很复杂的参数，那么我可能会选择这样的东西：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(
                        Argument1 + Expression1 + Expression2, 
                        Argument2 - Expression3 * Expression4, 
                        Argument3, 
                        Argument4 * Expression5 + Expression6 - Expression7); 
```

当然，如果参数表达式很长或很复杂，最好在函数调用之前进行计算并使用临时值来存储结果。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-12T13:06:13.363

我尽量保持线条简短。在这种情况下，我会在赋值之前和每个参数之后中断。我还将逗号放在行首，以便于添加新参数：

```
int SomeReturnValue 
   = SomeMethodWithLotsOfArguments(
         Argument1
       , Argument2
       , Argument3
       , Argument4
    ); 
```

在 Visual Studio 中使用这种布局需要大量工作，但 Emacs 对我来说是自动的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-12T10:48:18.087

就个人而言，我不喜欢第二个选项，它与 Ascii 艺术太接近了，它在代码中带来了不便：更改函数的名称，您必须重新缩进所有参数。不知何故，它使文件膨胀。另外，如果您在代码中使用硬制表符，它也不会很好地工作。

大多数时候，我使用第一个选项，但我采用了 Eclipse 规则，即续行的两个缩进，因为它与普通缩进相比更好（特别是如果您拆分条件指令）。

有时我使用第二个选项，例如。如果左括号已经接近我的行长限制...
优点：您可以在每个参数后添加行注释。
或者我确实喜欢 Dheer，将参数分组直到它们填满线宽。

参数与函数名分开的事实从来没有打扰过我，它们仍然很接近并且非常分组。在最坏的情况下，我可以在函数调用周围放置空行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T11:19:47.867

如果右手边没有被破坏，我总是在分配之前休息。这在像 Java 这样的语言中很有用，您必须明确声明所分配值的类型。

```
SomeVeryVerboseTypeName SomeReturnValue
   = SomeMethodWithLotsOfArguments(Argument1, Argument2, ...); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-12T11:32:12.150

对我来说，这取决于参数列表有多长。我不太喜欢行尾布局，它几乎需要编辑器支持（例如 emacs）才能做好。

如果方法调用足够短以将其放在一行上，我将这样做：

```
int SomeReturnValue =
    SomeMethodWithLotsOfArguments(Argument1, Argument2, ...); 
```

如果方法和变量适合一行而参数适合另一行，我已经这样做了：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments
    (Argument1, Argument2, ... ); 
```

这让我的 LISPy 心微笑，但让我的同事发疯，所以我心软了：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(
    Argument1, Argument2, ... ); 
```

我想我只是想说我还没有找到我真正满意的解决方案，尽管这对真正过长的情况有一些吸引力，因为它与我们如何布置卷曲的方式相似：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(
    Argument1, 
    Argument2,
); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-12T12:29:00.333

警告：我使用 IDE。如果您不是 IDE 用户，请跳过此步骤。

与他人合作时：

我倾向于坚持团队目前采用的任何约定。如果团队使用支持代码格式的 IDE，那就更好了。始终坚持使用团队/IDE 格式约定。无法告诉你我被“版本控制差异地狱由于重新格式化”烧了多少次

单独工作时：

我把方法串起来，行长对我来说不是问题。我有一个不错的宽屏显示器，水平滚动条的发明是有原因的。最重要的是，由于许多 IDE 都具有调用树、查找引用和重构工具等实用程序，因此导航源代码不仅仅是视觉滚动。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-12T12:50:51.147

对此我没有明确的答案。我是根据具体情况来做的。如果函数名很长，我绝对不会将其他参数缩进与前面的参数相同的列。如果函数名很短，我通常将以下参数缩进同一列，在一行上收集尽可能多的参数（不是一个参数 = 一行）。但是如果有一些令人愉悦的对称性，比如

```
int a = foo(a + b,
            c + d); 
```

我可能会打破这条规则，并且每行都有相同数量的参数。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-12T13:40:42.297

大多数人都对缩进提出了很好的建议，这对于您无法控制的 API 函数非常有用。如果您确实控制 API，我建议一旦您拥有超过 3 个参数，您应该创建某种形式的结构并将该结构传递给例程。一旦您获得超过 3 个参数，以错误的顺序传递它们的机会就会大大增加。它还提供了参数类型和含义的更多可见性。

```
someStruct.x = somevalue;
somestruct.y = someothervalue;

int someResturnValue - SomeMethod(somestruct); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-07-25T11:25:53.333

### 第一的

如果 args 足够短并且具有（几乎）相似的长度，我认为下面的视觉效果足够好

```
int variable_with_really_long_name = functionWhichDoMore(Argument1, ArgumentA2, 
                                                         ArgumentA3, Argument4, 
                                                         ArgumentA5, Argument6); 
```

### 第二

当情况变得更糟时，一栏论点确实有帮助

```
int variable_with_really_long_name = somefunctionWhichDoMore(Argument_Expand1, 
                                                             Argument2, 
                                                             Argument_Expand3, 
                                                             Argument_Expand4, 
                                                             Argument_Expand5, 
                                                             Argument6); 
```

### 第三

但是，现在，如果它变得更糟怎么办！现在怎么办？试试这个

```
int variable_with_really_long_name = someFunctionWhichDoMore
                                     (
                                       Argument_Expand_More1, 
                                       Argument_Expand_More2, 
                                       Argument_Expand3, Argument4, 
                                       Argument_Expand_More5, Argument6
                                     ); 
```

顺便说一句，如果您想要一致的外观，请使用上述所有条件中的第三个。

Justify ：整齐地穿上，我们知道这是一个有很多（6）个参数的函数调用。而且我喜欢我的代码看起来整洁且`!(so_ugly)`.

*欢迎批评。请发表评论。*

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-12T10:15:31.837

在具有长参数列表的函数中，为了便于阅读，我在每一个或两个参数之后换行（始终在每行上保持相同数量的参数）：

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(Argument1,
                                                       Argument2,
                                                       Argument3,
                                                       Argument4); 
```

或者

```
int SomeReturnValue = SomeMethodWithLotsOfArguments(Argument1, Argument2,
                                                       Argument3, Argument4); 
```

取决于列表/参数长度。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-12T11:24:29.263

我还使用 Edward Kmett 引用的“一致缩进选项”。如果有*很多*论点，我倾向于尽可能按相关性对它们进行分组。

但是对于这个特殊的例子，我可能会把它放在一行上，它不会*那么*长。

我无法忍受“悬空环绕”格式，因为它很容易提供与（更重要的）缩进相冲突的视觉混乱。目前，悬空环绕被认为是许多语言的“默认”样式，但我不知道它是如何做到的。恕我直言，这太可怕了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-08-14T16:40:49.757

我更喜欢以下

```
int variable_with_really_long_name = functionWhichDoMore(
        Argument1, ArgumentA2, ArgumentA3, Argument4, 
        ArgumentA5, Argument6);

int i = foo(Argument1, ArgumentA2, ArgumentA3, Argument4, 
        ArgumentA5, Argument6); 
```

两者都是一致的，当达到 80 个字符时，我转到下一行并放置 2 个缩进，每个缩进 4 个空格。我对此的论证如下：

*   我使用 2 个缩进，每个缩进 4 个空格，以便清楚地看到它涉及换行而不是缩进代码块的事实。

*   这种缩进方式可以很好地缩进代码，因为它始终遵循相同的缩进模式，2 个缩进用于换行，1 个缩进用于代码块。

*   将每个参数放在单独的行上可能会导致方法非常大，因此我更喜欢将参数顺序放在一行或多行上。

*   这种换行方式可以在 Eclipse 等 IDE 中进行配置，提供自动格式化的能力。

但是有一个重要说明，可能会出现以下情况的特殊情况：

```
int variable_with_really_long_name = functionWhichDoMore(arg1,
        arg2) 
```

我会尽量避免这种情况，如果发生这种情况，我将执行以下操作

```
int variable_with_really_long_name = functionWhichDoMore(arg1, arg2) 
```

是的，我将通过我的最大 120 个字符。代码行长度约定，我的约定实际上是灵活的，最多 120 到 140 个字符，通常我在 120 之后换行，但是在这种情况下，我会达到最大值。140 个字符。这样做的缺点当然是它不能在 IDE 中配置为自动格式化，例如 eclipse。

附言。我知道有些人认为 120 个字符对于代码行长度来说意义重大，但这是另一回事。上述约定当然也适用于 80 / 100 个字符。

# ruby - Ruby 依赖注入库

> ID：283466
> 
> 赞同：29
> 
> 时间：2008-11-12T09:58:46.907
> 
> 标签：ruby, dependency-injection, aop

我一直在研究一些 Ruby 依赖注入库。特别是，我检查了 [Needle](http://needle.rubyforge.org/)和[Copland](http://copland.rubyforge.org/)。它们已经存在了很长一段时间，但用途并不多。

使用这两个库有哪些优缺点？似乎很多库/框架都可以很好地利用这两个库，例如[Merb / Datamapper's Hook](http://github.com/sam/extlib/tree/master/lib/extlib/hook.rb)。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-11-12T10:56:35.543

编写 Copland 和 Needle 的 Jamis Buck[在这里发布了](http://weblog.jamisbuck.org/2008/11/9/legos-play-doh-and-programming)有关 Needle、依赖注入及其在 Ruby 世界中的用处的信息。

它很长但值得一读，但如果您想要与您的问题最相关的单个段落，我建议您从结尾开始：

> DI 框架是不必要的。在更严格的环境中，它们具有价值。在像 Ruby 这样的敏捷环境中，没有那么多。模式本身可能仍然适用，但要小心不要陷入认为你需要一个特殊工具来处理所有事情的陷阱。Ruby 是 Play-Doh，记住！让我们保持这种状态。

高温高压

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-10-31T12:04:16.770

[http://fabiokung.com/2010/05/06/ruby-and-dependency-injection-in-a-dynamic-world/](http://fabiokung.com/2010/05/06/ruby-and-dependency-injection-in-a-dynamic-world/)：这是另一篇文章，比 James Buck 的文章少得多。底线是您不需要依赖注入，因为 ruby​​ 提供了许多很好的替代方案，它们同样有效，但在 Java 世界中并不存在。

其中一种选择是 mixins，这是 Java 所没有的，另一种是能够覆盖/重新定义语言中几乎任何东西的能力。其他功能包括动态类型，基本上您可以将任何消息发送到任何对象，并且如果它恰好为该消息提供了实现，那么一切都会正常工作。所有这些东西一起工作，消除了对 DI 框架的大部分需求。这样的设计模式在 Ruby 中仍然有效，有时使用它才有意义。

上面 Alexey Petrushin 还提出的关于 DI 的另一点是，依赖注入主要是一种设计模式，工具是次要的，主要是为了摆脱 Java 中某些事情的乏味。在 ruby​​ 中，您可以轻松地模拟 spring 或 guice 在 Java 中为您所做的大部分工作。所以一个成熟的依赖注入框架在 Ruby 中本质上是多余的。

话虽如此，有时拥有一个 DI 框架还是不错的，因为最终它可以消除一些繁琐的连接工作。我不能保证任何 Ruby 特定的 DI 框架，但我知道很多 Ruby 项目最终被另一种语言（甚至 Java）重写，因为事物的游戏性质导致事情变得难以维护/扩展。我怀疑这与开发人员使用各种强大的语言功能自欺欺人有很大关系。拥有一个 DI 框架强加了一些可能有助于防止这种情况的结构和习语。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-17T18:38:54.447

这是另一个 IoC [http://alexeypetrushin.github.com/micon](http://alexeypetrushin.github.com/micon)

我将它用作我的 Web 框架（不是 Rails）的核心组件，您可以在此处看到它的工作原理 - [http://ruby-lang.info](http://ruby-lang.info)（此站点由它提供支持）。它为我节省了大量时间和代码，所以我个人认为 IoC 非常有用（在某些情况下）。

> DI 框架是不必要的。在更严格的环境中，它们具有价值。在像 Ruby 这样的敏捷环境中，没有那么多。模式本身可能仍然适用，但要小心不要陷入认为你需要一个特殊工具来处理所有事情的陷阱。Ruby 是 Play-Doh，记住！让我们保持这种状态。

我看了 Jamis Buck 的谈话，我同意和不同意他的观点，这就是为什么[http://ruby-lang.info/blog/you-underestimate-the-power-of-ioc-3fh](http://ruby-lang.info/blog/you-underestimate-the-power-of-ioc-3fh)

# javascript - JavaScript 是否支持逐字字符串？

> ID：283468
> 
> 赞同：29
> 
> 时间：2008-11-12T10:00:18.277
> 
> 标签：javascript, string

在 C# 中，您可以像这样使用逐字字符串：

```
@"\\server\share\file.txt" 
```

JavaScript中有类似的东西吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2016-02-23T07:36:10.020

**模板字符串**确实支持换行符。

```
`so you can
do this if you want` 
```

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals)

它当然不会阻止在文本中发生扩展，并通过扩展来阻止代码执行，但也许这是一件好事？

> **注意：**我认为没有办法获取现有字符串并通过表达式插值运行它。这使得以这种方式注入代码成为不可能，因为代码必须源自源代码。我不知道可以按需进行表达式插值的 API。
> 
> **注 2：**模板字符串是 ES2015 / ES6 特性。除了（等待它......）IE之外的所有浏览器都支持！但是，Edge 确实支持模板字符串。
> 
> **注意 3：**模板字符串扩展转义序列，如果字符串中有一个字符串，该字符串将扩展其转义序列。
> 
> ```
> `"A\nB"` 
> ```
> 
> ...将导致：
> 
> ```
> "A
> B" 
> ```
> 
> ...这将不起作用，`JSON.parse`因为字符串文字中现在有一个换行符。可能很高兴知道。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-12T11:14:03.510

不，JavaScript 不支持该功能。而且这种解决方法似乎很成问题，因为您现在失去了使用正斜杠的能力。

当我需要从 ASP.NET 后端构建警报消息或其他内容并将其粘贴在前端的 JavaScript 警报中时，我自己也遇到了这个问题。问题是开发人员可以在 Page.Alert() 方法中输入任何内容。

我为解决此问题所做的工作如下：

```
public void Alert(string message)
{
    message = message.Replace("\\", "\\\\")
        .Replace("\r\n", "\n")
        .Replace("\n", "\\n")
        .Replace("\t", "\\t")
        .Replace("\"", "\\\"");

    // and now register my JavaScript with this safe string.
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2017-05-27T03:10:12.230

只需使用`String.raw()`

```
String.raw`\n` 
```

将输出

```
\\n 
```

* * *

但我不知道如何解决此案：

```
String.raw`hello`hello`  // It will throw an TypeError
String.raw`hello\`hello` // Output is 'hello\\`hello' 
```

我不知道如何处理```:(

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2016-02-28T11:13:08.597

这是一个非常古老的线程，但仍然有一个解决方法：

```
function verbatim(fn){return fn.toString().match(/[^]*\/\*\s*([^]*)\s*\*\/\}$/)[1]} 
```

您将使用它：

```
var myText = verbatim(function(){/*This
 is a multiline \a\n\0 verbatim line*/}) 
```

基本上这里发生的是 js 确实将注释视为逐字字符串。此外，这些与功能一起存储。所以这里发生的是我们创建了一个带有一些逐字注释的函数，我们在逐字函数中提取这些注释。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-12T16:24:04.710

解决方法的大杂烩...

```
<html>
<head>
<script>
function foo() {
    var string = document.getElementById('foo').innerHTML;
    alert(string);
}
window.onload=foo;
</script>
<style>
#foo{
  display: none;
}
</style>
</head>
<body>
Calling foo on page load.
<div id="foo">\\server\path\to\file.txt</div>
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-12T14:04:52.980

我将重申之前所说的内容 - 逐字字符串在 javascript 中是不可能的。实际上很容易转义诸如`\n \\ \t`etc 之类的有效转义字符，但问题来自转义无效字符，因为它们在不同函数中的处理方式变得不兼容。例如

```
"\a".replace("\a","\\a")     // WORKS \a
"aa\a".replace("\a", "\\a")  // FAILS \aaa 
```

此外，如果您查看一组非法特殊字符，例如`["\a"]`该字符将看起来像一个`a`. 这使得做你想做的事情基本上是不可能的。

希望至少可以为您解决问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-07-23T13:54:54.807

是的，我们可以使用 static [String.raw()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/raw)。它是在 ECMAScript 6 (ES6) 中引入的。这类似于 Python 中的 r 前缀，或 C# 中用于字符串文字的 @ 前缀。

这用于获取模板字符串的原始字符串形式（即原始的、未解释的文本）。

句法：

```
String.raw(callSite, ...substitutions)
or 
String.raw`template string` 
```

例子：

```
const filePath_SimpleString = 'C:\\Development\\profile\\aboutme.html';
const filePath_RawString = String.raw`C:\Development\profile\aboutme.html`;

console.log(`The file was uploaded from: ${filePath}`);
console.log(`The file was uploaded from: ${filePath}`);

// expected output will be same: 
//"The file was uploaded from: C:\Development\profile\aboutme.html" 
```

# apache-flex - 运行 Flex 应用程序时未找到 IAutomationObject

> ID：283470
> 
> 赞同：1
> 
> 时间：2008-11-12T10:00:41.257
> 
> 标签：apache-flex

尝试运行 flex 应用程序时出现以下错误（一直运行良好！）。我正在尝试一些不同的设置来优化编译大小。我已将这些设置恢复为默认值，但仍然遇到问题。

我记得以前遇到过这个错误，但似乎不记得我是如何修复它的 - 也没有任何关于如何再次修复它的有用信息！

有人知道吗？

VerifyError：错误 #1014：找不到 IAutomationObject 类。

```
at flash.display::MovieClip/nextFrame()
at mx.managers::SystemManager/deferredNextFrame()[E:\dev\3.1.0\frameworks\projects\framework\src\mx\managers\SystemManager.as:299]
at mx.managers::SystemManager/preloader_initProgressHandler()[E:\dev\3.1.0\frameworks\projects\framework\src\mx\managers\SystemManager.as:2225]
at flash.events::EventDispatcher/dispatchEventFunction()
at flash.events::EventDispatcher/dispatchEvent()
at mx.preloaders::Preloader/timerHandler()[E:\dev\3.1.0\frameworks\projects\framework\src\mx\preloaders\Preloader.as:398]
at flash.utils::Timer/_timerDispatch()
at flash.utils::Timer/tick() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T20:32:31.117

事实证明，我已将外部引用的 .swc 文件的嵌入模式更改为“外部”，而不是将其用作“RSL”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T08:41:11.660

我还没有遇到过这种情况，但这里有一些我会尝试的建议：

*   您是否在编译器设置中排除了任何类？
*   如果您使用的是 Flex Builder，请尝试进行清理（项目 > 清理...）。
*   如果这没有帮助，请从您的项目中删除所有 eclipse 和 flex 构建器文件，并创建一个指向您现有源的新项目。

# c# - 一次删除整个项目或解决方案中未使用的命名空间

> ID：283471
> 
> 赞同：78
> 
> 时间：2008-11-12T10:02:09.477
> 
> 标签：c#, namespaces

我知道你可以逐个文件地做。

有没有办法一步一步对项目中的所有文件执行此操作？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2018-05-31T21:05:17.117

VS 2017 或 2019 中不需要任何插件。单击任何 using 语句附近的灯泡图标，然后单击部件`Solution`旁边`Fix all occurrences in`。

[![解决方案截图](https://i.stack.imgur.com/bqi3C.png)](https://i.stack.imgur.com/bqi3C.png)

* * *

## 回答 #2

> 赞同：87
> 
> 时间：2016-02-25T06:18:53.023

其他引用 Productivity Power Tools 扩展的答案没有详细说明如何实际执行此操作，因此以下是 Visual Studio 2013、2015、2017 和 2019 的一些说明：

首先，在 Visual Studio 中打开**Tools > Extensions and Updates...**对话框，在左侧栏中选择**Online ，然后在 Visual Studio Gallery 中搜索****“Productivity Power Tools”**。安装扩展并重新启动 VS。

或者，您可以手动下载并安装适用于您的 Visual Studio 版本的扩展：

[生产力电动工具 2013](https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.ProductivityPowerTools2013)
[生产力电动工具 2015](https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.ProductivityPowerTools2015)
[生产力电动工具 2017/2019](https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.ProductivityPowerPack2017)

对于 VS2017 和 VS2019，您还可以在 Power Tools 包中与其他扩展分开下载 Power Commands 扩展：

[Visual Studio 的电源命令](https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.PowerCommandsforVisualStudio)

请注意，在撰写本文时，VS2017 版本不适用于 .Net Core 项目/解决方案。

安装扩展后，只需右键单击解决方案资源管理器中的解决方案，然后选择**Power Commands > Remove and Sort Usings**。

这可能需要一段时间，尤其是在大型解决方案上；它也不会使修改后的文件保持打开状态（因此无法撤消），因此**请确保在运行*之前***提交您选择的 VCS 中的所有内容，以便在出现问题时恢复它所做的更改！

## 更新：格式化所有文件

最近我一直在使用[Format All Files](https://marketplace.visualstudio.com/items?itemName=munyabe.FormatAllFiles)扩展名，它允许您执行**Format Document**、**Remove 和 Sort Usings**以及您选择的另一个自定义命令（所有这些都是可选的，在 VS 首选项中设置）。

它似乎工作得很好，但同样不能撤消，因此**请确保在运行*之前***在您选择的 VCS 中提交所有内容。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-11-12T10:06:59.997

你的意思是使用语句吗？首先，请注意，它们通常不会伤害其他占用空间的东西。然而，像[ReSharper](http://www.jetbrains.com/resharper/)这样的工具提供了自动化的技巧来做到这一点：不久前[VS 提要中有一个链接；](http://blogs.msdn.com/djpark/archive/2008/08/16/organize-usings-across-your-entire-solution.aspx)它归结为：

*   转到工具 -> 宏 -> 宏 IDE...
*   在 Project Explorer 中，添加 -> 添加模块...（输入名称 - 我使用了 OrganiseUsings）
*   粘贴下面的代码
*   文件 -> 保存 MyMacros，退出

现在，如果您右键单击工具栏并自定义... - 您应该能够找到 MyMacros.OrganiseUsings.RemoveAndSortAll - 将其拖到方便的地方（可能是工具菜单；您可能还想在放置后更改名称）。

您现在可以使用此选项为整个解决方案运行删除和排序命令。大大节省时间。

==== 代码 ====

```
Imports System
Imports EnvDTE
Imports EnvDTE80
Imports EnvDTE90
Imports System.Diagnostics

Public Module OrganiseUsings

    Public Sub RemoveAndSortAll()
        On Error Resume Next
        Dim sol As Solution = DTE.Solution

        For i As Integer = 1 To sol.Projects.Count    
            Dim proj As Project = sol.Projects.Item(i)    
            For j As Integer = 1 To proj.ProjectItems.Count    
                RemoveAndSortSome(proj.ProjectItems.Item(j))    
            Next    
        Next    
    End Sub    

    Private Sub RemoveAndSortSome(ByVal projectItem As ProjectItem)
        On Error Resume Next
        If projectItem.Kind = Constants.vsProjectItemKindPhysicalFile Then    
            If projectItem.Name.LastIndexOf(".cs") = projectItem.Name.Length - 3 Then
                Dim window As Window = projectItem.Open(Constants.vsViewKindCode)

                window.Activate()

                projectItem.Document.DTE.ExecuteCommand("Edit.RemoveAndSort")

                window.Close(vsSaveChanges.vsSaveChangesYes)
            End If    
        End If    

        For i As Integer = 1 To projectItem.ProjectItems.Count    
            RemoveAndSortSome(projectItem.ProjectItems.Item(i))    
        Next
    End Sub   

End Module 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-04-21T13:58:30.157

对于 Visual Studio 2010，您可以从 Visual Studio 库下载“删除和排序使用”扩展。

[http://visualstudiogallery.msdn.microsoft.com/en-us/cb559aa8-d976-4cc2-9754-5a712f985d16](http://visualstudiogallery.msdn.microsoft.com/en-us/cb559aa8-d976-4cc2-9754-5a712f985d16)

适合我

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-12T10:11:30.877

如果您的意思是“使用”电源命令包含此功能 + 船载更多。

[http://code.msdn.microsoft.com/PowerCommands](http://code.msdn.microsoft.com/PowerCommands)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-08-16T08:09:51.793

生产力 电动工具正是您所需要的。 [https://visualstudiogallery.msdn.microsoft.com/dbcb8670-889e-4a54-a226-a48a15e4cace](https://visualstudiogallery.msdn.microsoft.com/dbcb8670-889e-4a54-a226-a48a15e4cace)

安装完成后，您可以从“工具 -> 选项 -> Productivity Power Tools -> PowerCommands -> Generals”中找到“<strong>Remove and Sort Usings on Save”。检查该选项后，重新启动 VS。现在保存，你会看到魔法。

对于 VS 2015，看看[这个](https://visualstudiogallery.msdn.microsoft.com/34ebc6a2-2777-421d-8914-e29c1dfa7f5d)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-04-27T16:56:43.323

对于更新的版本，包括 2017，请尝试[“格式化所有文件”](https://marketplace.visualstudio.com/items?itemName=munyabe.FormatAllFiles)扩展名。它对我来说效果很好。

[![在此处输入图像描述](https://i.stack.imgur.com/iU3V0.png)](https://i.stack.imgur.com/iU3V0.png)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2021-01-10T22:02:29.247

分析菜单下有一个内置功能，称为代码清理。如果您单击配置文件 1，它将作为删除和排序功能。

[![在此处输入图像描述](https://i.stack.imgur.com/PjTxz.png)](https://i.stack.imgur.com/PjTxz.png)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-05-10T09:25:52.493

这是对上述 VB.NET 脚本的一个小改进。确保您已安装[Productivity Power Tools](http://visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef/)。

```
 Private Sub RemoveAndSortSome(ByVal projectItem As ProjectItem)
    On Error Resume Next
    If projectItem.Kind = Constants.vsProjectItemKindPhysicalFile Then
        If projectItem.Name.LastIndexOf(".cs") = projectItem.Name.Length - 3 Then
            Dim window As Window = projectItem.Open(Constants.vsViewKindCode)

            window.Activate()

            projectItem.Document.DTE.ExecuteCommand("Edit.RemoveAndSort")

            window.Close(vsSaveChanges.vsSaveChangesYes)

        ElseIf projectItem.Name.LastIndexOf(".vb") = projectItem.Name.Length - 3 Then
            Dim window As Window = projectItem.Open(Constants.vsViewKindCode)

            window.Activate()

            projectItem.Document.DTE.ExecuteCommand("EditorContextMenus.CodeWindow.OrganizeImports.RemoveandSortImports")

            window.Close(vsSaveChanges.vsSaveChangesYes)
        End If
    End I 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-02-09T14:37:19.943

我正在使用 Visual Studio 2015 并找到了一个名为 BatchFormat 的工具： [https ://marketplace.visualstudio.com/items?itemName=vs-publisher-147549.BatchFormat](https://marketplace.visualstudio.com/items?itemName=vs-publisher-147549.BatchFormat)

这完美地完成了这项工作。

安装该工具，然后在解决方案资源管理器中右键单击您的解决方案，然后在菜单顶部您会看到批处理格式：

[![在此处输入图像描述](https://i.stack.imgur.com/Rm3aZ.png)](https://i.stack.imgur.com/Rm3aZ.png)

无论您选择什么，都将应用于解决方案中的每个文件，正如您在屏幕截图中看到的那样，还有其他选项，您还可以格式化每个文档。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-04-15T07:02:01.617

Visual Studio 2017 具有内置功能，可从整个项目中删除不必要的名称空间。

[![在此处输入图像描述](https://i.stack.imgur.com/ICfte.png)](https://i.stack.imgur.com/ICfte.png)

# c# - 在 C# 源代码中打破长字符串的最佳方法

> ID：283476
> 
> 赞同：40
> 
> 时间：2008-11-12T10:07:51.633
> 
> 标签：c#, string

我想知道在 C# 源代码中打破长字符串的“最佳实践”是什么。这个字符串是

```
"string1"+
"string2"+
"string3" 
```

在编译期间或运行时连接？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-12T10:15:22.193

它在编译时完成。这完全等同于“string1string2string3”。

假设你有：

```
string x = "string1string2string3"
string y = "string1" + "string2" + "string3" 
```

编译器将执行适当的实习，以使 x 和 y 引用相同的对象。

编辑：答案和评论中有很多讨论`StringBuilder`。许多开发人员似乎认为字符串连接应该*始终*使用`StringBuilder`. 这是一个过度概括 - 值得理解[为什么`StringBuilder`在某些情况下是好的，而在其他情况下则不然](http://pobox.com/~skeet/csharp/stringbuilder.html)。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-11-12T10:20:38.470

如果空格不重要，那么您可以使用 @ 转义字符在代码中编写多行字符串。如果您的代码中有查询，这很有用，例如：

```
string query = @"SELECT whatever
FROM tableName
WHERE column = 1"; 
```

这将为您提供一个带有换行符和制表符的字符串，但对于无关紧要的查询。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-12T10:16:07.340

您的示例将在编译时连接。所有内联字符串和 const 字符串变量在编译时连接。

要记住的是，包含任何只读字符串都会延迟连接到运行时。string.Empty 和 Environment.NewLine 都是只读字符串变量。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-12T10:14:47.703

连接是在编译时完成的，因此没有运行时开销。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-12-29T21:09:41.913

[下面的扩展方法](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods)怎么样（受 common-tags [oneLine](https://www.npmjs.com/package/common-tags#oneline)方法的启发）...

```
using System;
using System.Text.RegularExpressions;
using static System.Text.RegularExpressions.RegexOptions;

namespace My.Name.Space
{
    public static class StringHelper
    {
        public static string AsOneLine(this string text, string separator = " ")
        {
            return new Regex(@"(?:\n(?:\s*))+").Replace(text, separator).Trim();
        }
    }
} 
```

...结合使用的[逐字字符串文字](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/verbatim)：

```
var mySingleLineText = @"
    If we wish to count lines of code, we should not regard them
    as 'lines produced' but as 'lines spent'.
".AsOneLine(); 
```

请注意，字符串“内部”的空格保持不变，例如：

```
// foo      bar hello        world.
var mySingleLineText = @"
    foo      bar
    hello        world.
".AsOneLine(); 
```

如果您不希望用空格替换换行符，请`""`作为参数传递给扩展方法：

```
// foobar
var mySingleLineText = @"
    foo
    bar
".AsOneLine(""); 
```

**请注意：**由于所涉及的辅助方法，这种形式的字符串连接是在运行时进行的（与`+`在编译时通过运算符进行的连接相反，如接受的答案中所述）。因此，如果性能是一个问题，请使用`+`. 如果您正在处理长短语和可读性并且“易用性”是重点，那么上面建议的方法可能值得考虑。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T10:16:55.357

这真的取决于你需要什么。一般来说，如果你需要连接字符串，使用 StringBuilder 可以达到最好的运行时性能。如果您在源代码中引用 var str = "String1"+"String2" 之类的内容，它将在编译时转换为 string str = "String1String2"。在这种情况下，您没有连接开销

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-12T10:20:53.993

如果您有许多（超过大约四个）要连接的字符串，则 StringBuilder 是一个不错的方法。它更快。

在上面的示例中使用 String.Concat 是在编译时完成的。由于它们是文字字符串，因此它们由编译器优化。

但是，如果您使用变量：

```
string a = "string1";
string b = "string2";
string c = a + b; 
```

这是在运行时完成的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T10:15:38.963

你不能用一个`StringBuilder`吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-13T04:17:58.113

有任何方法可以做到。我最喜欢使用 C# 中的字符串方法。样品一：

string s=string.Format("{0} {1} {0}","Hello","By"); 结果是 s="Hello By Hello";

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-11-12T10:30:07.920

如果您使用任意数量的字符串，StringBuilder 将是您最快的方法。

[http://dotnetperls.com/Content/StringBuilder-1.aspx](http://dotnetperls.com/Content/StringBuilder-1.aspx)

如果您只是做几个字符串（5 个或更少是一个很好的规则），那么速度与您使用的连接类型无关。

# java - 如何在不解压所有依赖项的情况下使用 Maven 组装控制台应用程序？

> ID：283477
> 
> 赞同：8
> 
> 时间：2008-11-12T10:08:01.617
> 
> 标签：java, maven-2

假设我在 Maven 项目中有以下目录布局：

```
src/
|-- main
|   |-- bin
|   |   |-- run.cmd
|   |   `-- run.sh
|   |-- etc
|   |   |-- common-spring.xml
|   |   |-- log4j.xml
|   |   `-- xml-spring.xml
|   `-- java
|       `-- com
... 
```

我想构建一个 zip 文件，解压缩后会生成如下内容：

```
assembly
|-- bin
|   |-- run.cmd
|   `-- run.sh
|-- etc
|   |-- common-spring.xml
|   |-- log4j.xml
|   `-- xml-spring.xml
`-- lib
    |-- dependency1.jar
    |-- dependency2.jar
... 
```

其中 `run.xx' 是可执行的 shell 脚本，它将调用我的主应用程序*并将所有依赖项放在 classpath 上*。

这是否可以使用一些“官方”Maven 插件，例如 maven-assembly-plugin？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-12T10:43:10.470

我使用[AppAssembler 插件](http://mojo.codehaus.org/appassembler/appassembler-maven-plugin/)来获得类似的东西。例子：

```
...
<build>
<plugins>
  <plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>appassembler-maven-plugin</artifactId>
    <configuration>
      <programs>
        <program>
          <mainClass>com.acme.MainClass</mainClass>
          <name>app</name>
        </program>
      </programs>
    </configuration>
  </plugin>
</plugins> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-19T07:15:40.020

我已经使用 maven-assembly-plugin 在项目中实现了类似的功能。我希望在打包阶段构建一个 zip 文件，而不是手动调用 assembly:assembly。这是我想出的：

/src/assemble/distribution.xml：

```
<assembly>
  <id>distribution</id>

  <!-- specify the output formats -->
  <formats>
    <format>zip</format>
  </formats>

  <!-- include all runtime libraries in the /lib folder of the output file -->
  <dependencySets>
    <dependencySet>
      <outputDirectory>/lib</outputDirectory>
      <scope>runtime</scope>
    </dependencySet>
  </dependencySets>

  <fileSets>
    <!-- include all *.jar files in the target directory -->
    <fileSet>
      <directory>target</directory>
      <outputDirectory></outputDirectory>
      <includes>
        <include>*.jar</include>
      </includes>
    </fileSet>

    <!-- include all files in the /conf directory -->
    <fileSet>
       <outputDirectory></outputDirectory>
       <includes>
        <include>conf/**</include>
       </includes>
    </fileSet>
  </fileSets>

</assembly> 
```

/pom.xml

...

```
 <plugin>
            <artifactId>maven-assembly-plugin</artifactId>

            <configuration>
                <descriptors>
                    <descriptor>src/assemble/distribution.xml
                    </descriptor>
                </descriptors>
            </configuration>

            <!-- append assembly:assembly to the package phase -->
            <executions>
                <execution>
                    <phase>package</phase>
                    <goals>
                        <goal>assembly</goal>
                    </goals>
                </execution>
            </executions>

        </plugin> 
```

...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T16:53:30.713

maven-assembly-plugin 还可以将依赖项复制到您的程序集中，方法是在您的程序集描述符文件中包含如下内容：

```
<dependencySets>
    <!-- Copy dependency jar files to 'lib' -->
    <dependencySet>
        <outputDirectory>lib</outputDirectory>
        <includes>
            <include>*:jar:*</include>
        </includes>
    </dependencySet>
</dependencySets> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-12T20:48:25.427

appassembler 为您生成“run.xx”文件。

如果您已经自己创建了 shell 脚本，则可以使用 maven-assembly-plugin 创建 zip 文件。要收集依赖项，您可以使用 maven-dependency-plugin。

# macos - 如何构建本机 Mac OS X 安装程序（在非 Mac 平台上）？

> ID：283480
> 
> 赞同：6
> 
> 时间：2008-11-12T10:08:53.457
> 
> 标签：macos, installation, dmg

如何在非 Mac 平台上为我的应用程序构建原生 Mac OS X 安装程序？

例如，我有一台 Windows 电脑和一个 Java 应用程序。我希望 Windows pc 构建与 Apple 安装程序一起使用的安装程序（可能在 .dmg 存档中）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-07-28T22:51:33.667

现在可以在非 Mac 平台上创建本机 Mac OS X 安装程序。作为 Louis Gerbarg，棘手的是 BOM（材料清单）文件。然而，mkbom 的开源版本（基于 Joseph Coffland 的 osxbom 代码）现在可以在以下位置获得：

[http://hogliux.github.io/bomutils](http://hogliux.github.io/bomutils)

该网站还有一个易于遵循的关于在 Linux 上创建 Mac OS X 安装程序的分步教程 ( [http://hogliux.github.io/bomutils/tutorial.html](http://hogliux.github.io/bomutils/tutorial.html) )。

我的公司定期使用这种方法在 linux 上构建 Mac OS X 安装程序，到目前为止我们还没有遇到任何重大问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T14:49:31.003

正如其他人已经指出的那样，您确实在为这个问题采取硬性解决方案，您的用户会因此而诅咒您的名字，除非您有充分的理由这样做*。*确实，某些类型的应用程序需要 Mac OSX 的安装程序。这些通常包括：

*   安装自定义驱动程序（即内核扩展）的应用程序
*   需要安装框架或其他资源的应用程序，由于某种原因无法打包在应用程序包中
*   需要作为系统服务运行的应用程序，因此必须运行一些安装后脚本才能在启动期间启动应用程序
*   写得不好的程序，需要对用户的系统进行某种类型的更改（即，设置文件夹或其他东西的权限），并且开发人员的双手被营销部门的小伙伴束缚，以最痛苦的方式分发应用程序

好的，所以最后一点有点讽刺，但你明白我的意思吗？:) 基本上，如果您正在编写一个普通的最终用户应用程序，您应该以 Mac 用户期望的正常方式分发它，这是一个包含应用程序包的 DMG 文件。或者，如果您想真正花哨，请将别名粘贴到 DMG 内的“应用程序”文件夹中，以帮助用户将程序拖到那里。除非您正在编写必须将自身安装*到*系统中的东西，而不是简单*地由*系统运行，否则没有理由在这里使用安装程序。另外，请记住这是 OSX，它已经包含一个功能齐全的 Java JRE，因此您无需担心将 JRE 打包到安装程序或类似的东西中。

既然您因提出这个问题而受到适当的责骂，我将假设您的软件属于上述类别之一来回答它。确实，您最好的选择是使用诸如 VISE 安装程序之类的商业解决方案（我可以再次自信地说，绝大多数 Mac 用户在安装使用此工具制作的产品时会因恐惧而退缩），它可以让您完全按照您在此处查找的内容 - 基本上，制作一个跨平台安装程序，该安装程序为您希望从单个安装程序文件支持的各种平台构建。

不过，再一次，你最好的选择是做那个平台的用户最舒服的事情（这就是为什么所有对你问题的回答都敦促你不要制作安装程序）。但是，这意味着，如果您确实必须制作安装程序，则应该使用**非**跨平台框架；Windows 用户在使用标准 MSI 安装程序时感觉最自在，而 Mac 用户在使用 Apple Installer pkg 时感觉最自在。然而，PackageMaker 程序是出了名的有限，所以如果你必须的话，你应该使用[iceberg](http://s.sudre.free.fr/Software/Iceberg.html)来代替。这对您来说意味着更多的维护，因为您需要照顾两个（或更多）单独的安装程序，但如果您的软件真的如此复杂以至于需要这样做，您应该愿意为舒适做出牺牲您的用户。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-18T11:20:08.550

在 Windows 上创建 .dmg 很困难，但正如其他评论所提到的，创建一个可以压缩的 .app 文件结构当然是可能的。有时，常规的 .pkg 不会剪切它，而您想要提供对话框、安装前检查等。您可以使用[BitRock installbuilder](http://bitrock.com)来做到这一点，您可以从每个其他平台。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T14:21:58.000

所以，有几个简单的问题。

首先，为什么要安装程序？大多数 Mac 用户更喜欢拖动安装的应用程序。如果您不是在编写特定于 Mac OS X 的代码，那么很难想象您需要将位放置在特殊的位置，例如 Application Support 或 LaunchDaemons。假设你所有的东西都放在一个文件夹里，为什么还要麻烦安装程序呢？

其次，为什么在 Mac 上构建 Mac 安装程序会出现问题？你肯定有一个 Macintosh 来测试应用程序（你不会盲目地为 Mac 发布它而不在 Mac 上测试它，对吧？）。

好吧，话虽如此，假设您仍然有充分的理由在 PC 上实际构建它，但有些部分并不容易。基本上，.pkg 是一堆文本脚本、本地化、存档文件 (Archive.pax.gz) 和材料清单 (Archive.bom)。

假设构建之间没有太大变化，您可以在 Mac 上制作安装程序，然后只需重建 bom 和 pax.gz，将它们替换为现有的 .pkg，并批处理一些元数据。pax 应该很容易处理（pax 是标准存档格式），但 bom 文件可能会有点棘手，因为我不相信它是公开记录的，我怀疑创建它们的工具 (mkbom) 是达尔文的一部分（不是开源的）。因此，您需要弄清楚这一点并编写一个自定义工具来创建 bom 文件。

换句话说，这很可能是大量的工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T14:35:46.193

在 Mac 上安装应用程序的常用方法是将应用程序拖到应用程序文件夹中。大多数程序都以 DMG 形式提供，其中包含应用程序和指向应用程序文件夹的符号链接。你为什么要以其他方式？您需要考虑 Mac 才能构建出色的 Mac 应用程序！外观和感觉非常重要，尤其是对于 Mac 用户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-05T10:52:06.750

查看此代码以读取 BOM 文件：[https ://cauldrondevelopment.com/svn/osxbom/trunk](https://cauldrondevelopment.com/svn/osxbom/trunk)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-13T02:20:19.063

将所有内容放入一个 JAR 文件中，然后将其添加到 ZIP 中。完毕。

但说真的，您想在不先测试的情况下将您的应用程序分发给 Macintosh 用户吗？你在哪个星球！？

# xml - 在 Actionscript 中解析 XML/XHTML

> ID：283484
> 
> 赞同：1
> 
> 时间：2008-11-12T10:13:11.357
> 
> 标签：xml, flash, parsing, xhtml, actionscript-2

actionscript 中有什么类似于 getElementById 的吗？

我正在尝试制作一个从 xhtml 文件中获取数据的 Flash 页面的原型。我想要一个可访问的 html 版本（用于搜索引擎、文本阅读器和没有 flash 的人）和一个 flash 版本（因为客户坚持使用 flash，即使 html-css-ajax 解决方案会做得很好）。

我需要的是一种从具有特定 id 的 html 中获取文本或属性的简单方法，例如`<h1 id="flashdataTitle">This is the title</h1>`等。我猜测有几种方法可能是可行的：

*   以某种方式使用 ExternalInterface.call 并在 JavaScript 中进行 DOM 技巧（这可能是我将要做的，因为我非常熟悉 JS 和一个完整的 flash/actionscript 新手，除非你有更好的解决方案）
*   使用 Actionscript XML 类加载 xhtml，并手动遍历 XML 寻找正确的 id 属性（但这可能很慢）
*   将 XPath 与 actionscript 中的 XML 类一起使用。（如果这是推荐的方式，我想要一些关于如何做到这一点的提示）
*   实际上有一个等效于 getElementById 的 Actionscript 与 XML 一起使用？
*   尽管我的雇主希望我们不必这样做：我可以重写服务器端代码，以对 Flash 友好的格式输出相关的文本和图像 url。

什么是最有效、最容易实现和健壮的跨浏览器的方法？有什么完全不同的想法吗？

即使您认为问题已得到解答，也请发表任何想法，我想探索所有不同的可能性，以及所提出的解决方案有哪些缺点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T10:38:28.433

既然你说你的输入是 XHTML，你可以用 XPath 来做：

```
import mx.xpath.XPathAPI;

var elementId:String = "flashdataTitle";
var elementPath:String = "//h1[@id'" + elementId + "']";
found_elements = XPathAPI.selectNodeList(xhtml.firstChild, elementPath);

if (found_elements.length == 1) {
  trace(found_elements[0]);
} 
```

代码示例的灵感来自[此处](http://www.robgonda.com/blog/index.cfm/2005/7/10/Xpath-for-ActionScript)，您还可以在此处找到有关 XPath 和 ActionScript 的一些模式详细信息。

AS3 有它自己的[XPath Library](http://code.google.com/p/xpath-as3/)，一般方法是一样的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T20:41:43.617

Actionscript 中是否有类似prototype.js 函数[inspect()的东西？](http://www.prototypejs.org/api/object/inspect)我试过测试 xpath 解决方案，但它不起作用。我已经使用 scetchpad 测试了 xpath 是正确的（我认为这就是它的名称），所以我相信 XML 对象存在问题......在调试器中查看它时似乎包含 xhtml 文件，虽然看起来相当混乱，但如果我可以“检查”变量并跟踪它们，它将有助于定位问题。（谢谢 Tomalak，只要我的“声誉”足够高，我就会支持你的回答。）

顺便说一句，我还是想听听其他的想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T11:15:36.663

如果按 id 查询元素就足够了，请使用 XML.idMap（或 ActionScript 3.0 中的 XMLDocument.idMap）属性。这种方法可能是最快的方法。虽然 XPath 为您提供高级查询功能，但它会降低性能。因此，如果您需要一些具有 id 属性的元素，我建议您使用 idMap。

# javascript - 单击页面上的电子邮件链接的软件？

> ID：283486
> 
> 赞同：2
> 
> 时间：2008-11-12T10:13:54.333
> 
> 标签：javascript, html, browser, hyperlink, email

我们在我们的网站上遇到了一个奇怪的错误，我们认为这与安装在用户计算机上的软件有关。我们在很多页面上都有一个电子邮件链接，它是使用 Javascript 创建的（所以垃圾邮件机器人不会得到它）。

似乎该链接在某些用户的机器上被自动“点击”了。然后，一些用户通过在弹出的电子邮件窗口上单击“发送”来丢弃该窗口，从而向我们发送大量电子邮件。

检查 Apache 日志时，在浏览器字符串中看不到任何奇怪的东西。这可能是一个失控的下载加速器/预取器吗？关于这可能是什么的任何其他理论？

HTML 中的链接是这样写的（它是 Smarty 自动生成的）：

```
<script type="text/javascript" language="javascript">
<!--
{document.write(String.fromCharCode(60,97,32,104,114,101,
  102,61,34,109,97,105,108,116,111,58,115,117,112,112,111,114,
  116,64,112,114,111,118,101,46,110,111,63,115,117,98,106,101,99,
  116,61,82,101,102,101,114,97,110,115,101,110,117,109,109,101,114,
  37,50,48,49,53,48,48,34,32,62,83,101,110,100,32,115,112,38,111,115,
  108,97,115,104,59,114,115,109,38,97,114,105,110,103,59,108,46,60,47,97,62))}
//-->
</script> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T14:39:53.143

浏览器中的某些东西可以预取链接吗？例如，Firefox 扩展[Fasterfox](http://fasterfox.mozdev.org/)就是这样做的（这就是我不使用它的原因）。我似乎记得 Google 曾经也推出过使用相同概念的浏览器加速器。AVG 防病毒软件的 Linkscanner 也因这样做而臭名昭著（全都是以扫描不良站点的名义）。

简而言之：不要将链接用于更改状态的内容，例如注销、删除记录（喘气！）或发送电子邮件。请改用按钮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T13:05:41.743

我唯一的建议确实是某些程序（浏览器、扩展程序、机器人、索引器）读取页面，然后打开链接并发送邮件，但我以前从未见过。

从收到的邮件消息中你能看到什么吗？经常性 IP 地址或 X-Mailer？

也许您可以向其中一位用户询问他们的系统设置——您有他们的电子邮件地址。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-01T07:43:37.393

就个人而言，我会尝试通过将`mailto:`链接更改为联系表单来解决此问题——尽管这并不能直接回答您提出的问题。

链接预取器的其他建议似乎是最有可能的。

我想它甚至*可能*与来自 ISP 的缓存有关，如果它试图预蜘蛛页面以便链接到的页面加载得更快？

# terminology - 如果在执行过程中抛出异常，如何描述没有副作用的方法？

> ID：283487
> 
> 赞同：2
> 
> 时间：2008-11-12T10:14:02.867
> 
> 标签：terminology, exception-safe

我只是不记得用于此属性和其他相关属性的术语。

编辑 - 也许这样的概念不存在，但我记得在 Effective C++（或 More Effective C++）中读过一些东西，他主张使用交换在函数中最后提交更改，因为向量交换函数保证不会抛出异常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T10:38:53.957

我认为您的意思是说该功能是“异常安全的”。参见例如[http://en.wikipedia.org/wiki/Exception_safety](http://en.wikipedia.org/wiki/Exception_safety)。

维基百科的文章将安全性进一步划分为各个级别。这是与这里相关的一个：

> 2\. 提交或回滚语义，也称为强异常安全或无更改保证：操作可能会失败，但保证失败的操作没有副作用，因此所有数据都保留原始值。

有一个介绍异常安全和提交或回滚语义的 STL 设计文档的参考：[http ://www.open-std.org/jtc1/sc22/wg21/docs/papers/1997/N1077.asc](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/1997/N1077.asc)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T10:42:52.997

您可能正在考虑[异常保证](http://www.boost.org/community/exception_safety.html)，尤其是“强保证”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T10:55:51.113

阅读您的编辑后，我怀疑您的标题略有错误。您真的是说*无论是否抛出异常*（按照当前措辞）都没有副作用，或者在抛出异常时它没有副作用，但是如果该方法在没有引发异常的情况下完成，那么它将/可以有副作用吗？有很大的不同:)

后者在 Accelerated C# 2008 中被描述为“异常中立”。

# java - 有没有办法在 Eclipse 3 中隐藏 Maven 2“target/”文件夹？

> ID：283489
> 
> 赞同：49
> 
> 时间：2008-11-12T10:15:03.957
> 
> 标签：java, eclipse, maven-2

我将 Maven 2.0.9 与 Eclipse 3.3.2 一起使用。

我习惯于每天由`mvn clean install`. 然后，如果我刷新我的 Eclipse 项目，它将被 Maven*目标*目录中的文件“污染”。

这在执行搜索、通过“开放资源”获取资源等时非常烦人。

有没有办法避免 Eclipse 在这个文件夹中查找？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-11-13T01:20:45.160

右键单击要忽略的文件夹，打开“属性”对话框，选择“资源”选项卡并选中“派生”框

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-04-04T13:35:13.683

在 Maven 中重新配置“clean”以不删除目标目录：

```
<plugin>
    <artifactId>maven-clean-plugin</artifactId>
    <configuration>
        <excludeDefaultDirectories>true</excludeDefaultDirectories>
        <filesets>
            <!-- delete directories that will be generated when you 
                 start the develpment server/client in eclipse  
            -->
            <fileset>
                <directory>target</directory>
                <includes>
                    <include>**/*</include>
                </includes>
            </fileset>
        </filesets>
    </configuration>
</plugin> 
```

（位于：[http](http://maven.40175.n5.nabble.com/how-to-NOT-delete-target-dir-td3389739.html#a3413930) ://maven.40175.n5.nabble.com/how-to-NOT-delete-target-dir-td3389739.html#a3413930 ）

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2013-04-26T16:32:40.393

Indigo 解决方案 [SR2]

`Project Explorer`> `Customize View`> `Filters`>`[*] Maven Build Folder`

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-01-23T13:35:25.970

我对这个问题非常生气，所以我写了一个插件来解决它。您可以从以下位置获取源代码和 jar：

[https://github.com/YA2O/Eclipse_Plugin_Target_Derivator](https://github.com/YA2O/Eclipse_Plugin_Target_Derivator)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-06-15T15:12:44.883

为了解决这个问题，这是我所做的：

*   为 Eclipse 安装 Groovy Monkey*   创建了一个 Bean Shell 脚本“UpdateMavenDerived_Beanshell.gm”以将任何名为 target 的目录标记为派生的。

------------在此处剪切脚本----------------

```
/*
 * Menu: Find System Prints > Beanshell
 * Script-Path: /GroovyMonkeyScripts/monkey/UpdateMavenDerived_Beanshell.gm
 * Kudos: Bjorn Freeman-Benson & Ward Cunningham & James E. Ervin
 * License: EPL 1.0
 * LANG: Beanshell
 * DOM: http://groovy-monkey.sourceforge.net/update/plugins/net.sf.groovyMonkey.dom
 */
out.println("Setting target directories to derived status.");
var projects = workspace.getRoot().getProjects();
for ( var i = 0; i < projects.length; i++) {
    var project = projects[i];
    if (project.isOpen()) {
        out.println("Project: " + project.getName());
        var members = project.members();
        for ( var j = 0; j < members.length; j++) {
            if (members[j].getName().equals("target")) {
                out.println("setting derived status on: "+ members[j].getFullPath());
                members[j].setDerived(true);
            }
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-01T15:42:42.937

首选项 > 团队 > 忽略的资源

添加“目标”，然后重新启动 Eclipse。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-12T12:25:14.117

您是否尝试配置“Java 元素过滤器”选项对话框（通过项目资源管理器的右上角箭头）？

如果需要，您可以定义自己的[ViewerFilter](http://publib.boulder.ibm.com/infocenter/wsphelp/index.jsp?topic=/org.eclipse.jdt.doc.isv/reference/extension-points/org_eclipse_jdt_ui_javaElementFilters.html)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-03-26T03:19:13.873

I had some issues because some solutions here only work for some views, so I made an illustrated summary.

[Tested in Eclipse 4.4 (Luna), should work like this since 3.7 according to other answers here.]

# Package Explorer

*Package Explorer View Menu* → `Filters...` → check `Name filter patterns` and input `target`.

Be careful, this will hide all folders and files named `target`, not just the default maven build directory! The *Project Explorer* view has a better option without this issue.

![Package Explorer Menu](https://i.stack.imgur.com/TFoV4.png) ![Package Explorer Dialog](https://i.stack.imgur.com/XFnGV.png)

# Project Explorer

Project Explorer View Menu → `Custom View...` → search for "maven" and check `Maven build folder`.

Checking this option hides the build directory as defined in the projects pom.xml configuration.

![Project Explorer Menu](https://i.stack.imgur.com/WrVu6.png) ![Project Explorer Dialog](https://i.stack.imgur.com/VzZoS.png)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-12T12:20:26.920

maven 插件不会隐藏目标目录。但是，它确实使用 maven 目标文件夹来配置 eclipse。所以eclipse使用target/classes和target/test-classes，eclipse过滤掉这些文件夹。这是由“mvn eclipse:eclipse”以及 m2eclipse 插件完成的。除了这两个文件夹（例如生成的 jar 文件）之外，剩下的就是目标目录中的所有内容。

您可以为包资源管理器创建一个过滤器，但这不会影响“开放资源”。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-12T11:23:49.857

你在为 Eclipse 使用 Maven 插件吗？

我想它会为你隐藏一些“污染”。

它还允许您在 Eclipse 中执行构建——这意味着它会同时为您刷新项目视图。

[Maven 2 日食](http://maven.apache.org/eclipse-plugin.html "Maven 2 日食")

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-08-26T20:06:52.403

如果您经常使用“mvn clean install”，使用资源过滤器看起来可以解决问题。

基本上，它会将“目标”添加到子文件夹中，以将文件夹直接排除到 .project 文件中。运行此脚本后，如果将项目导入 Eclipse，您可以看到设置“项目”->“属性”->“资源”->“资源过滤器”。在此之前，每当我运行 mvn clean install 时，eclipse 占用了我 50% 的 CPU，但现在它在构建项目时保持在 5% 以下。

* * *

```
function eclipse-setup() {
     mvn eclipse:clean
     mvn eclipse:eclipse
     #maven target folders
     find . -name .project -exec sed -i.MSORG 's/<\/projectDescription>/<filteredResources> <filter> <id>1314376338264<\/id> <name><\/name> <type>26
<\/type> <matcher> <id>org.eclipse.ui.ide.multiFilter<\/id> <arguments>1.0-name-matches-false-false-target<\/arguments> <\/matcher> <\/filter> <filt
er> <id>1314387234341<\/id> <name><\/name> <type>6<\/type> <matcher> <id>org.eclipse.ui.ide.multiFilter<\/id> <arguments>1.0-name-matches-false-fals
e-*.cache.html<\/arguments> <\/matcher> <\/filter> <\/filteredResources><\/projectDescription>/' {} \;

} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-05-11T13:34:33.257

When Eclipse freezes, looking at the process activity, I can see it browsing all my target, .hg and .git directories. Moreover, those directories are also copied into Eclipse's bin directory. A lot of CPU and disk usage for nothing.

Not cleaning the target directory is not an acceptable solution.

There was a solution using a Monkey script (http://maven.40175.n5.nabble.com/Eclipse-amp-target-directory-td72354.html) but the project has been closed.

I still look for a solution to tell Eclipse to ignore Maven target directories, as well as .hg and .git directories.

Eclipse continuously watching those is a pain.

I also use m2eclipse but it doesn't solve that issue.

# c# - 如何修改方法内的装箱值类型

> ID：283492
> 
> 赞同：0
> 
> 时间：2008-11-12T10:15:28.857
> 
> 标签：c#, value-type, late-binding

我正在尝试构建一个库来简化 C# 中的后期绑定调用，但我在使用参考参数时遇到了麻烦。我有以下方法来添加方法调用中使用的参数

```
 public IInvoker AddParameter(ref object value)
    {
        //List<object> _parameters = new List<object>();
        _parameters.Add(value);          

        //List<bool> _isRef = new List<bool>();
        _isRef.Add(true);

        return this;
    } 
```

这不适用于值类型，因为它们被装箱为对象，因此它们不会被修改。例如：

```
int param1 = 2;
object paramObj = param1;
//MulFiveRef method multiplies the integer passed as a reference parameter by 5:
//void MulFiveRef(ref int value) { value *= 5; }
fi.Method("MulFiveRef").AddParameter(ref paramObj); 
```

那是行不通的。后期绑定调用成功，保存参数（_parameters）的内部列表确实被修改，但调用外部的值没有被修改。

有谁知道克服这个限制的简单方法？无法修改 AddParameter 签名，与后期绑定调用一样，您无法提前知道参数的类型（以及在调用之前将调用的所有参数插入对象数组中的任何一种方式）

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T10:19:00.643

无论如何，您的方法都没有改变`value`-您为什么要通过引用传递它？这可能是有道理的，但对我来说并不是很清楚。请注意，您提供的示例代码无论如何都不会编译，因为`ref`参数必须与参数的类型*完全相同*。

（另外，您是否知道 C# 4.0 和 .NET 4.0 将内置对后期绑定的支持？语言集成版本可能比仅库版本更易于使用。您确定值得花钱吗？这个时间点上图书馆的时间？）

编辑：您提供的代码确实无法编译。您不会对`ref`参数进行装箱，正是因为参数和参数类型必须完全相同。下面是一些示例代码来证明这一点：

```
public class Test
{
    static void Main()
    {
        int i;
        Foo(ref i); // Won't compile - error CS1502/1503
    }

    static void Foo(ref object x)
    {
    }
} 
```

如果您当前的代码*正在*编译，那么它不是您在问题中提供的代码。也许您还有另一个需要`AddParameter`接受的重载`ref int`？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T10:19:23.247

如果值*在方法内部*发生变化，则需要声明一个 temp( `object`) 变量以将 ( `ref`) 传递给方法，然后自行拆箱：

```
 int i = 3;
    //...
    object obj = i;
    Foo(ref obj);
    i = (int)obj; 
```

请注意，这将不允许您在事件发生后更新值。事件或回调之类的东西可能是将更改传递回调用者的另一种方式。

另请注意，C# 4.0*仅*在 COM 调用的上下文中提供了一些技巧来帮助解决此问题（其中`ref object`很常见 [当然还有`dynamic`后期绑定，正如 Jon 所指出的那样]）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T12:17:04.337

好的，感谢 Jon Skeet 更正和 Mark Gravell 代码，我想出了这个界面：

```
 //This will be created with a factory
        IOperationInvoker invoker = new OperationInvoker(Activator.CreateInstance<MyLateBindingTestType>());

        int param1 = 2;
        object paramObj = param1;

        invoker.AddParameter(ref paramObj).Invoke("MulFiveRef");

        param1 = (int)invoker.Parameters[0]; 
```

并不完全像我想象的那样，但比我以前的界面更简单易读：

```
 IOperationInvoker invoker = new OperationInvoker(Activator.CreateInstance<MyLateBindingTestType>());
        int refValue = 10;
        object[] args = Args.Build(refValue);

        invoker.Call("MulFiveRef", Args.ByRefIndexs(0), args);

        refValue = (int)args[0]; 
```

非常感谢您的帮助人们:)

# apache-flex - 从 Flex TextInput 控件捕获用户输入：使用哪个事件？

> ID：283497
> 
> 赞同：15
> 
> 时间：2008-11-12T10:17:51.957
> 
> 标签：apache-flex, events, flex3, textinput

我应该使用`change`or`textInput`事件来捕获 TextInput 控件上的用户输入吗？为什么？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-12T12:16:05.383

[`textInput`](http://livedocs.adobe.com/flex/3/langref/mx/controls/TextInput.html#event:textInput)仅当用户在控件中*输入*文本时才调度。[`change`](http://livedocs.adobe.com/flex/3/langref/mx/controls/TextInput.html#event:change)另一方面，在用户提交的每一次更改上都会发送。因此，例如，如果用户删除了部分文本，则仅`change`调度事件。

当通过代码修改文本时，这些都不会调度：

[`flash.events.TextEvent.TEXT_INPUT`](http://livedocs.adobe.com/flex/3/langref/mx/controls/TextInput.html#event:textInput)：

> *“当**用户**在控件中键入、删除或粘贴文本时调度。”*

（忽略那里的“删除”一词——我刚刚尝试过，当用户删除文本时*不会调度此事件）*

[`flash.events.Event.CHANGE`](http://livedocs.adobe.com/flex/3/langref/mx/controls/TextInput.html#event:change)：

> *“当 TextInput 控件中的文本通过用户输入发生更改时调度。**如果您使用数据绑定或 ActionScript 代码更改文本，则不会发生此事件**。”*

您也可以使用该[`valueCommit`](http://livedocs.adobe.com/flex/3/langref/mx/core/UIComponent.html#event:valueCommit)事件，该事件在用户“提交”更改时调度（通常通过将焦点从文本字段移开），但请记住，当以编程方式更改字段值时也会调度此事件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T18:13:23.077

这是一个很好的答案，哈塞格。如果我有足够的代表，我会投票。

根据您捕获用户输入的目的，您可以子类化 TextInput 组件并覆盖更改和 textInput 事件的内部侦听器。

我不知道您是否有很多原因想要这样做，但我最近这样做是为了处理 OS X 中的一个错误，该错误导致粘贴的换行符表示为 '\r'，而不是 '\ n'。

您需要做的就是在子类对象的构造函数中调用 super() 之后添加以下内容：

```
this.addEventListener(Event.CHANGE, textFieldChangeListener);   
this.addEventListener(TextEvent.TEXT_INPUT,textFieldInputListener); 
```

然后添加侦听器方法和要执行的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-19T22:22:38.533

Event.CHANGE 和 TextEvent.TEXT_INPUT 事件都会在每个键入的字符上触发。如果您想要一个仅针对给定 TextInput 字段触发一次的事件，请使用**FocusEvent.FOCUS_OUT**。

与 Event.CHANGE 和 TextEvent.TEXT_INPUT 一样，此事件只会在用户输入时触发，而不是在以编程方式更改值时触发。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-04T17:34:02.563

`CHANGE`虽然没有告诉你*发生了什么*`TEXT_INPUT`变化 -并且`KEY_DOWN`做。

# javascript - 手机展示网站

> ID：283498
> 
> 赞同：0
> 
> 时间：2008-11-12T10:18:06.447
> 
> 标签：javascript, html, mobile-phones

在这里，我需要创建一个应支持所有可访问 Internet 的手机的站点。我可以使用 javascript，在一些论坛上，他们告诉 javascript 在手机中不起作用。

建议我清楚，在手机javascript工作与否？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T10:37:50.590

手机对 JavaScript 的支持程度差别很大。在决定将哪些 HTML 和 JavaScript 返回到设备之前，我使用[WURFL来确定设备的功能。](http://wurfl.sourceforge.net/index.php)WURFL 是一个大型设备功能数据库，格式为 XML。它是开源的，因此您可以将其包含在您自己的应用程序中。查看其他[WURFL 站点](http://www.wurflpro.com/)以查询特定设备并查看 WURL 可以为您提供哪些信息。

# language-agnostic - 如何处理用蹩脚代码编写的优秀产品？

> ID：283511
> 
> 赞同：7
> 
> 时间：2008-11-12T10:23:13.397
> 
> 标签：language-agnostic

我被要求改进和维护一个由重要用户社区使用和批准的内部 Web 应用程序。这包括性能改进和添加功能。

不幸的是，代码很臃肿，有时写得很糟糕，而且难以阅读和更改。这使得更改更难以实施。

尽管如此，该应用程序还是好看、有用的，用户喜欢它并希望做出改变。

这就是为什么我觉得我被愚弄了。编写蹩脚的代码以获得更快的伟大成果和荣耀，然后离开去从事伟大的新项目，留下如此多的问题真的更好吗？

[我已经在Coding Horror](http://codinghorror.com)上阅读了很多关于这个主题的内容，但我想从这里的人们那里读到更多，他们正在经历这个悲伤的现实，以及他们是如何处理它的。我可能也需要一些勇气；）

*由于我的主要语言不是英语，请随时用更好的语法重写这个问题。*

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-12T10:39:51.817

几乎每个开发人员，无论何时何地，当介绍一些他们没有编写的代码时，都想重写它以修复糟糕的位。

抵制重写所有内容的冲动，修复损坏的部分。在必须维护时处理无法维护的位！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-12T10:36:44.193

为产品编写一个测试套件，这样您就可以更有信心没有破坏任何东西。

然后重构代码中最糟糕的部分，或者无论如何都需要更改的部分。

但是：考虑“如果它没有坏，就不要修复它”，如果一个区域正在工作，并且您不需要更改它，请考虑引入问题的风险是否超过使其“好”的好处.

并找到最初的开发人员并引诱他们进入一些黑暗的小巷:) 或者更好，让他们进行更改

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-12T10:42:24.230

我为一些项目编写了糟糕的代码。然而明智的“坏”代码。糟糕的代码可能是由许多原因造成的，而不仅仅是人的技能。（嗯，大部分时间是因为技能）

如果您有足够的时间并且没有来自业务的压力，程序员可以编写非常好的代码。然而，商务人士并不欣赏良好的编码，而是欣赏功能和外观。我认为“蹩脚”的编码员是业内的聪明人。很简单，他开发了解决方案模型，让软件在短时间内运行起来，我猜也让雇主很​​高兴！！如果让编码员再写一遍，他/她可以做得更好。

**首先**，你需要说服自己去体会早期程序员经历了多少事情，这是你是否是一个成熟的开发者需要考虑的要点之一。大多数人抱怨甚至嘲笑现有版本，因为他们知道他们可以做得更好。这就像用您的想象力在一张白纸上绘画，或者复制现有的绘画。哪个更难？？

**其次**，从整体上看代码，找出可以改进的地方，你可能会发现你误解的地方。

**第三**，路线图增强，它可以包含最近和未来的 TODO

**最后**，如果您从头开始设计它，新架构等，开始计划如何改进它，并在准备好和全面时将其提交给管理层。

每个软件都有改进的空间，这就是为什么你被雇用来改进它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-12T12:43:22.113

大多数程序员都会遇到这种情况。第一个冲动是重写它。更好的方法是只做你被要求做的事情。如果您进行重大重写，您很可能会破坏它。

如果所需的更改很简单，您应该以尽可能少的更改以已经编写的样式来实现它们。

如果更改更复杂，请尝试在尽可能少的地方应用您的更改。如果您的计划是随着时间的推移清理代码，那么这就是开始的地方。小心您所做的更改，因为您很容易破坏您不理解的依赖关系。根据我的个人经验，我通常可以通过实际删除代码并重写任何给定例程或方法中留下的内容来添加新功能或实施更改。

抵制你重写一切的诱惑。将其视为分类。在实施要求的更改时，优先考虑您希望看到的更改并实施它们。避免影响未要求您更改的代码。不要仅仅因为美观就强迫您的用户处理您所做的更改所带来的问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-12T10:40:13.580

糟糕的代码是[技术债](http://en.wikipedia.org/wiki/Technical_debt)；它的编写成本可能更低，但维护成本更高（除非您通过重构或重写来偿还债务）。

您可能会获得更快的结果和荣耀，但是当用户以后想要更改时，您将不得不花费更多的精力来进行更改（或修复不可避免的错误）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-12T13:54:53.873

有时，当程序员第一次拿起一个旧项目并看到所有的类、接口、代码模块等时，会立即认为它“臃肿”。事实上，它可能只是有一个非常深入的架构，一开始可能会让人不知所措。如果项目没有文档（例如类图），请花一些时间将其勾画出来。它不仅可以帮助您了解项目的工作原理，还可以帮助您身后的任何人。

这也适用于诸如“难以阅读”之类的陈述。如果您了解编程语言，那么阅读它就不会像任何其他应用程序一样难以阅读。原始程序员的风格可能与您的不同，但如果应用程序正常工作，那么他们不会做任何语言不允许他们做的事情。流程可能难以遵循，但可以通过勾勒出流程（例如流程图）来克服。大多数经理会在进行更改之前留出时间让学习曲线熟悉应用程序。花点时间画出一些图表，你（和跟随你的程序员）会很高兴你这样做了。

就“糟糕的代码”而言，这是非常主观的。真的是“糟糕”的代码（实现）还是设计？是否缺少设计模式？设计模式的过度使用或糟糕的实现？还是他们真的实现了可靠的设计模式，但您对它们还不够熟悉而无法识别它们？

关键是，当交给一个新项目来维护时，它可能会让人不知所措，而且很容易将“臃肿”、“糟糕的代码”、“难以阅读和进行更改”等归咎于原始程序员。有时确实如此，但很多时候，这可能是因为程序员不了解应用程序的设计和架构，或者不了解为什么某些事情会以它们原来的方式实现。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-12T10:36:51.293

是的，一些写得不好的程序很受欢迎。不利的一面是，随着时间的推移，此类应用程序往往难以改进（例如在扩展、添加新功能、错误修复等方面）。

但是不，写垃圾代码不好。确定用户想要什么并为他们提供良好的界面等*并使*代码易于维护是很好的。有时这可能意味着用户需要等待更长的时间才能获得新功能，尤其是在早期 - 但从长远来看，您将能够完成更多工作。

在你的情况下，我建议你尝试一次改进一点。如果可以的话，开辟一个区域并“修复”它，并确保它永远不会回到“糟糕的过去”。然后开辟下一个区域，等等。最终你将拥有一个写得很好的应用程序。这样做可能比从头开始重写需要更长的时间，但是您将能够随时为用户提供改进，并且您将对它在任何时候成为一个工作系统更有信心。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-12T10:56:50.783

确保您的管理层和用户知道从可更改性的角度来看代码质量不足。在估算您需要多长时间来实现新功能时，请始终明确说明您需要多长时间来清理受影响的代码。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-12T11:00:12.260

“尽管如此，该应用程序看起来很漂亮，很有用，用户喜欢它并想要改变”

该应用程序显然正在为客户提供他们想要的东西，但听起来它已经到了不可维护的阶段。

我认为除了无情地重构之外别无他法。如果您抵制同时添加任何重要功能的压力，这可能会更容易且痛苦更少。一定要告诉经理，虽然软件很好，但它有变成一大堆无法维护的垃圾的危险。

对代码进行改进通常会引入一两个它们自己的错误，但从长远来看会为您节省很多脑损伤。尽可能多地获得额外的眼球来帮助测试和调试，并坚持先做真正糟糕的事情。

如果以前的现任者还没有这样做，请考虑引入单元测试，这样您就可以更加确信重构没有破坏任何东西。我不提倡“如果它没有坏掉……”的哲学，因为这会让你在同样不满意的旋转木马上。

不用担心你的英语，这对我来说非常有意义，而且你的困境是普遍存在的。

# c# - 为什么我不能创建私有静态 const void？

> ID：283513
> 
> 赞同：-1
> 
> 时间：2008-11-12T10:23:58.840
> 
> 标签：c#, .net

我们刚刚从 VB 转移到 C#，我遇到了一些麻烦..！

为什么我不能创建私有静态常量无效？

为什么它不工作？

```
 private static const void MyVoid(void void)
 { 
   try
   {
      this.void void = new void(void + void);
      return this.void;
   }
   catch (void)
   {
      Response.Write(void);
   }
 } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T10:29:18.313

C# 不允许您将`const`方法声明为其返回类型，因此您的方法声明不正确。

你也不能捕捉`void`——你只能捕捉异常类型。

同上 void 参数等。

为什么你认为你需要这个？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T10:26:27.523

`void`是**“没有返回类型”的返回类型**。它本身不是一个类型（如`int`等`bool`），而是指定它不返回任何内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T10:27:34.353

这是因为 void 实际上是虚无 :) 如果您不想向方法发送任何内容。做它 MyVoid()

您方法中的其他行也是如此

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T10:29:24.367

void 是“不返回任何内容”的保留关键字

[http://msdn.microsoft.com/en-us/library/yah0tteb.aspx](http://msdn.microsoft.com/en-us/library/yah0tteb.aspx)

这是所有保留关键字的列表 [http://msdn.microsoft.com/en-us/library/x53a06bb.aspx](http://msdn.microsoft.com/en-us/library/x53a06bb.aspx)

把 Void 想象成 C# 的一个 Sub

在 C# 中，我们只有方法——返回一些东西（VB 函数）或什么都不返回，即 void（VB Sub）

# c# - 通过 C#.NET 在 Word 中创建动态表格

> ID：283523
> 
> 赞同：3
> 
> 时间：2008-11-12T10:28:35.460
> 
> 标签：c#, dynamic, ms-word

我有一个 C# 应用程序，我想在其中实现一个程序的逻辑，该程序将打开 word 文档并转到页面中的某个位置并创建一个表并将值放入其中。谁能告诉我如何实现这一点。我正在使用 Visual Studio 2005

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-05-26T20:49:47.683

这是将 datagridview 复制到单词表的代码：

参考是 Microsoft.Office.Interop.Word C:\Program Files (x86)\Microsoft Visual Studio 10.0\Visual Studio Tools for Office\PIA\Office12\Microsoft.Office.Interop.Word.dll

```
using word = Microsoft.Office.Interop.Word;    
public static void ExportToWord(DataGridView dgv)
                {
                    SendMessage("Opening Word");

                    word.ApplicationClass word = null;

      word.Document doc = null;
            object oMissing = System.Reflection.Missing.Value;
            object oEndOfDoc = "\\endofdoc"; /* \endofdoc is a predefined bookmark */ 
            try
            {
                word = new word.ApplicationClass();
                word.Visible = true;
                doc = word.Documents.Add(ref oMissing, ref oMissing,ref oMissing, ref oMissing);
            }
            catch (Exception ex)
            {
                ErrorLog(ex);
            }
            finally
            {
            }
            if (word != null && doc != null)
            {
                word.Table newTable;
                word.Range wrdRng = doc.Bookmarks.get_Item(ref oEndOfDoc).Range;
                newTable = doc.Tables.Add(wrdRng, 1, dgv.Columns.Count-1, ref oMissing, ref oMissing);
                newTable.Borders.InsideLineStyle = Microsoft.Office.Interop.Word.WdLineStyle.wdLineStyleSingle;
                newTable.Borders.OutsideLineStyle = Microsoft.Office.Interop.Word.WdLineStyle.wdLineStyleSingle;
                newTable.AllowAutoFit = true;

                foreach (DataGridViewCell cell in dgv.Rows[0].Cells)
                {
                    newTable.Cell(newTable.Rows.Count, cell.ColumnIndex).Range.Text = dgv.Columns[cell.ColumnIndex].Name;

                }
                newTable.Rows.Add();

                foreach (DataGridViewRow row in dgv.Rows)
                {
                    foreach (DataGridViewCell cell in row.Cells)
                    {
                        newTable.Cell(newTable.Rows.Count, cell.ColumnIndex).Range.Text = cell.Value.ToString();                      
                    }
                    newTable.Rows.Add();
                }                                              
            }

        } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T10:32:58.773

查找“文字自动化”。

例如，[KB316384](http://support.microsoft.com/kb/316384)，其中包括：

本文中的示例代码演示了如何执行以下操作：

*   插入带有文本和格式的段落。
*   浏览和修改文档中的各种范围。
*   插入表格、格式化表格并用数据填充表格。
*   添加图表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T11:49:12.433

Word 将非常乐意打开扩展名为 .Doc 的 HTML 文件。您可以使用内部样式表来获得所需的所有格式。这里出现了一个非常相似的问题：

[在 C# 中导出到 Word 文档](https://stackoverflow.com/questions/282531/export-to-word-document-in-c)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T11:10:23.363

如果你不想使用 Word 自动化，例如你没有在运行你的程序的计算机上安装 Word，你应该看看[Aspose.Words](http://www.aspose.com/categories/file-format-components/aspose.words-for-.net-and-java/default.aspx "Aspose.Words")。

唯一的问题是它不是免费的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-26T10:34:31.733

您可以尝试我的方法将数据导出到 Word (*.docx) ，它易于使用并且可以 100% 与任何 DataGridView 一起使用，只需添加**Microsoft.Office.Interop.Word**参考并复制以下代码：

```
 using Word = Microsoft.Office.Interop.Word;

   public void Export_Data_To_Word(DataGridView DGV, string filename)
   {
    if (DGV.Rows.Count != 0)
    {
        int RowCount = DGV.Rows.Count;
        int ColumnCount = DGV.Columns.Count;
        Object[,] DataArray = new object[RowCount + 1, ColumnCount + 1];

        //add rows
        int r = 0;
        for (int c = 0; c <= ColumnCount - 1; c++)
        {
            for (r = 0; r <= RowCount - 1; r++)
            {
                DataArray[r, c] = DGV.Rows[r].Cells[c].Value;
            } //end row loop
        } //end column loop

        Word.Document oDoc = new Word.Document();
        oDoc.Application.Visible = true;

        //page orintation
        oDoc.PageSetup.Orientation = Word.WdOrientation.wdOrientLandscape;

        dynamic oRange = oDoc.Content.Application.Selection.Range;
        string oTemp = "";
        for (r = 0; r <= RowCount - 1; r++)
        {
            for (int c = 0; c <= ColumnCount - 1; c++)
            {
                oTemp = oTemp + DataArray[r, c] + "\t";

            }
        }

        //table format
        oRange.Text = oTemp;

        object Separator = Word.WdTableFieldSeparator.wdSeparateByTabs;
        object ApplyBorders = true;
        object AutoFit = true;
        object AutoFitBehavior = Word.WdAutoFitBehavior.wdAutoFitContent;

        oRange.ConvertToTable(ref Separator, ref RowCount, ref ColumnCount,
                              Type.Missing, Type.Missing, ref ApplyBorders,
                              Type.Missing, Type.Missing, Type.Missing,
                              Type.Missing, Type.Missing, Type.Missing,
                              Type.Missing, ref AutoFit, ref AutoFitBehavior, Type.Missing);

        oRange.Select();

        oDoc.Application.Selection.Tables[1].Select();
        oDoc.Application.Selection.Tables[1].Rows.AllowBreakAcrossPages = 0;
        oDoc.Application.Selection.Tables[1].Rows.Alignment = 0;
        oDoc.Application.Selection.Tables[1].Rows[1].Select();
        oDoc.Application.Selection.InsertRowsAbove(1);
        oDoc.Application.Selection.Tables[1].Rows[1].Select();

        //header row style
        oDoc.Application.Selection.Tables[1].Rows[1].Range.Bold = 1;
        oDoc.Application.Selection.Tables[1].Rows[1].Range.Font.Name = "Tahoma";
        oDoc.Application.Selection.Tables[1].Rows[1].Range.Font.Size = 14;

        //add header row manually
        for (int c = 0; c <= ColumnCount - 1; c++)
        {
            oDoc.Application.Selection.Tables[1].Cell(1, c + 1).Range.Text = DGV.Columns[c].HeaderText;
        }

        //table style 
        oDoc.Application.Selection.Tables[1].set_Style("Grid Table 4 - Accent 5");
        oDoc.Application.Selection.Tables[1].Rows[1].Select();
        oDoc.Application.Selection.Cells.VerticalAlignment = Word.WdCellVerticalAlignment.wdCellAlignVerticalCenter;

        //header text
        foreach (Word.Section section in oDoc.Application.ActiveDocument.Sections)
        {
            Word.Range headerRange = section.Headers[Word.WdHeaderFooterIndex.wdHeaderFooterPrimary].Range;
            headerRange.Fields.Add(headerRange, Word.WdFieldType.wdFieldPage);
            headerRange.Text = "your header text";
            headerRange.Font.Size = 16;
            headerRange.ParagraphFormat.Alignment = Word.WdParagraphAlignment.wdAlignParagraphCenter;
        }

      //save the file
        oDoc.SaveAs2(filename);

         //NASSIM LOUCHANI
    }  
   }

  private void button_Click(object sender, EventArgs e)
   {
    SaveFileDialog sfd = new SaveFileDialog();

    sfd.Filter = "Word Documents (*.docx)|*.docx";

    sfd.FileName = "export.docx";

    if (sfd.ShowDialog() == DialogResult.OK)
    {

        Export_Data_To_Word(dataGridView1, sfd.FileName); 
    }
   } 
```

谢谢你。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-15T15:59:26.897

我有一个代码用于将表插入到数据库中的特定书签检索模型中，我希望对社区有所帮助，我使用 mvc C#、microsoft office interop word 来创建一个 word 文件并从帮助程序类中添加动态表

```
public void tableFromDatabase(Document doc, Application word, string risk, string bookmarkName, TableTemplate table) {
        Table newTable;//Create a new table
        Range wrdRng = doc.Bookmarks.get_Item(bookmarkName).Range;//Get a bookmark Range
        doc.Bookmarks[bookmarkName].Select();
        newTable = word.Selection.Tables.Add(wrdRng,1,1);//Add new table to selected bookmark by default set 1 row, 1 column (need set interval 1-63)
        newTable.Borders.InsideLineStyle = WdLineStyle.wdLineStyleSingle;
        newTable.Borders.OutsideLineStyle = WdLineStyle.wdLineStyleSingle;
        int a=0, b=0;//Set integer values for iterate in model arrays
        //Iterate model rows
        for (int i = 1; i <= table.Rows.Count; i++)//Set in 1 the value because in word tables the begin is (1,1)
        {
            //Only add rows if is after first row
            if (i > 1)
            {
                newTable.Rows.Add();
            }
            //Iterate model columns from rows
            for (int j = 1; j <= table.Rows[a].Columns.Count; j++)
            {
                //Only Add rows if is after first
                if (j == 1 && i == 1)
                {
                    newTable.Cell(i, j).Range.Font.Name = table.Rows[a].Columns[b].cellFontName;
                    newTable.Cell(i, j).Range.Font.Size = table.Rows[a].Columns[b].cellFontSize;
                    newTable.Cell(i, j).Width = float.Parse(table.Rows[a].Columns[b].cellWidth);
                }
                else
                {
                    //Add Cells to rows only if columns of the model is largen than table, this is for not exceed the interval
                    if (newTable.Rows[i].Cells.Count < table.Rows[a].Columns.Count)
                    {
                        newTable.Rows[i].Cells.Add();
                    }
                    //Set the values to new table
                    //The width must be float type
                    newTable.Cell(i, j).Range.Font.Name = table.Rows[a].Columns[b].cellFontName;
                    newTable.Cell(i, j).Range.Font.Size = table.Rows[a].Columns[b].cellFontSize;
                    newTable.Cell(i, j).Width = float.Parse(table.Rows[a].Columns[b].cellWidth);
                }
                b++;
                //Set 0 to reset cycle
                if (b == table.Rows[a].Columns.Count)
                {
                    b = 0;
                }
            }
            a++;
            //Set 0 to reset cycle
            if (a == table.Rows.Count)
            {
                a = 0;
            }
        }
        newTable.Borders.InsideLineStyle = Microsoft.Office.Interop.Word.WdLineStyle.wdLineStyleSingle;
        newTable.Borders.OutsideLineStyle = Microsoft.Office.Interop.Word.WdLineStyle.wdLineStyleSingle;
        newTable.AllowAutoFit = true;
        //Set gray color to borders
        newTable.Borders.InsideColor = (Microsoft.Office.Interop.Word.WdColor)12964311;
        newTable.Borders.OutsideColor = (Microsoft.Office.Interop.Word.WdColor)12964311;

    } 
```

# c++ - 字符串到 const char*

> ID：283525
> 
> 赞同：0
> 
> 时间：2008-11-12T10:29:07.813
> 
> 标签：c++, string, char

这一行：

```
strcat(query,*it); 
```

（`*it`字符串的迭代器在哪里）

一直给我这个错误：

> 没有匹配函数调用 ``strcat(char[200], const std::basic_string, std::allocator >&)`'

我想这是因为`strcat`take in a `char*`while`*it`是一个字符串。如何将其从字符串转换为 a`char*`以使其使用`strcat()`？

我已经尝试过`strcat(query,(*it).c_str())`，但这只会给我一个运行时错误。

编辑：对不起，它应该转换为`const char*`

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-12T10:31:44.580

`strcat(query,(*it).c_str())`应该管用。什么是运行时错误？您确定`query`在拨打电话之前它是空终止的吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T16:04:56.497

使用调试器，卢克！

(*it).c_str() 确实应该是 strcat 的有效参数，假设您的迭代器是有效的，并且假设查询是一个以 null 结尾的字符串，那么应该这样。找出其中哪些行为不端的最快方法是观察它并检查它的值并在运行时查询。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T11:45:46.473

缓冲区溢出？

```
char   query[200] = {0}; // Make sure this array initialized before
                         // you start concatenating strings onto it.

for (it = vec.begin();it != vec.end();++it)
{
   if ((strlen(query) + it->length() + 1) >= 200)
   {
       logError("Buffer oveflow detected.";
       break;
   }
   strcat(query, it->c_str());
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T14:11:53.217

当您确定要插入的缓冲区的长度`strcat`（例如 200）时，最好使用`strncat`; 这将排除@Martin 提到的缓冲区溢出。否则在连接之前检查总长度（[这是使用它的先决条件](http://www.cplusplus.com/reference/clibrary/cstring/strcat.html)！）

顺便说一句，查询通常会超过 200 个字符。如果您不确定结果查询的长度，请使用动态字符串，例如`std::string`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T10:32:14.687

您需要更具体地了解您得到的运行时错误。调用`c_str()`字符串应该是正确的解决方案。与`strcat()`其他没有边界检查的经典 C 字符串函数一样，您必须小心不要将输入传递的时间过长。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T22:45:29.293

由于您已经排除了`query`不是空终止的，因此似乎共识是问题很可能是以下问题之一：

1.  缓冲区溢出 - 指向的缓冲区`query`不够大，无法 `(*it).c_str()`连接到它
2.  迭代器 ,`it`无效。这可以通过多种方式发生，包括：

    *   未正确初始化；
    *   具有 someContainer.end() 的值；
    *   或者容器已以某种方式进行了修改，导致现有迭代器无效

您应该能够确定调试器发生了什么。另外，我敢肯定，如果您发布更多代码，显示如何定义`query`和`it`使用，您也会在这里得到明确的答案（远程调试如何）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T14:41:28.583

*it 在所有情况下都指向一个有效的字符串吗？它会在最后一次迭代中指向 end() 吗？或者可能是它指向的容器被修改，使 *it 无效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T15:58:03.953

如果应用程序处于释放模式，则通过在特定位置放置消息框或生成中断 3\. (_asm int 3;) 来跟踪应用程序。如果你设置了中断，它的 exe 会弹出一个调试信息。将进程附加到 Visual Studio 以对其进行调试。希望通过这种方式我们可以知道崩溃的地方。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-12T10:34:08.583

试试这个（我假设运行时错误是因为 NULL/无效指针）：

```
for (...; it != str.end(); ++it)
...
   if (!it->empty())
   {
      strcat(query, it->c_str());
   } 
```

编辑：对不起，c_str() 永远不会返回 NULL，我暂时忘记了，所以它总是安全的。除非查询缓冲区不够长，当然不能包含所有连接的字符串（或者还有其他问题，例如 .end() 之外的迭代器、循环期间修改的容器或类似的东西）。

# .net - .NET XML 序列化器，用户名中带有日文字符

> ID：283535
> 
> 赞同：2
> 
> 时间：2008-11-12T10:32:45.497
> 
> 标签：.net, xml, unicode, xml-serialization

每当我们的应用程序使用 XML 序列化器时，当我们以用户名包含日文字符的用户身份登录时，我们就会遇到问题。

我们准备了一个示例应用程序，可以自行测试序列化程序：

```
 TestClass myClass = new TestClass();
              myClass.MyString = "Hello World!"; 

              using (MemoryStream stream = new MemoryStream())
              {
                    XmlSerializer serializer = new XmlSerializer(
                          typeof (TestClass));
                    serializer.Serialize(stream, myClass);
              }

              MessageBox.Show("Serialization Complete!"); 
```

其中 TestClass 定义为：

```
 [Serializable]
  public class TestClass
  {
        public string MyString { get; set; }
  } 
```

调用 Serialize() 时，会报如下异常：

System.InvalidOperationException：无法生成临时类（结果 = 1）。错误 CS0016: 无法写入输出文件 'c:\Users\??????\AppData\Local\Temp\qas_8hjs.dll' -- '目录名称无效。'

注意'??????' 应显示用户名的位置。

我们已经使用具有基于英文字符集名称的用户对此进行了测试，这很好。

是否有我们忽略的设置（例如任何环境或 AppDomain 设置？）或者这是 XML 序列化程序中的错误？

我知道这是非常专业的，但任何见解都将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T10:59:58.720

您可以尝试使用[SGEN](http://msdn.microsoft.com/en-us/library/bk3w6240(VS.80).aspx)来避免它必须在运行时创建 dll 吗？

但是，我很想将其记录为[connect](https://connect.microsoft.com/VisualStudio)上的错误。

请注意，SGEN 方法不会帮助 Web 服务器：

> 这些生成的程序集不能用于 Web 服务的服务器端。此工具仅适用于 Web 服务客户端和手动序列化场景。

# c# - 测试 lambda 表达式相等性的最有效方法

> ID：283537
> 
> 赞同：51
> 
> 时间：2008-11-12T10:34:02.047
> 
> 标签：c#, lambda

给定一个方法签名：

```
public bool AreTheSame<T>(Expression<Func<T, object>> exp1, Expression<Func<T, object>> exp2) 
```

如果两个表达式相同，最有效的说法是什么？这只需要对简单的表达式起作用，我的意思是所有“支持”的都是简单的 MemberExpressions，例如 c => c.ID。

一个示例调用可能是：

```
AreTheSame<User>(u1 => u1.ID, u2 => u2.ID); --> would return true 
```

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2014-07-02T10:06:33.260

**更新：**由于对我的解决方案感兴趣，我更新了代码，使其支持数组、新运算符和其他内容，并以更优雅的方式比较 AST。

这是 Marc 代码的改进版本，现在**可以作为[nuget 包](https://www.nuget.org/packages/Neleus.LambdaCompare/)**使用：

```
public static class LambdaCompare
{
    public static bool Eq<TSource, TValue>(
        Expression<Func<TSource, TValue>> x,
        Expression<Func<TSource, TValue>> y)
    {
        return ExpressionsEqual(x, y, null, null);
    }

    public static bool Eq<TSource1, TSource2, TValue>(
        Expression<Func<TSource1, TSource2, TValue>> x,
        Expression<Func<TSource1, TSource2, TValue>> y)
    {
        return ExpressionsEqual(x, y, null, null);
    }

    public static Expression<Func<Expression<Func<TSource, TValue>>, bool>> Eq<TSource, TValue>(Expression<Func<TSource, TValue>> y)
    {
        return x => ExpressionsEqual(x, y, null, null);
    }

    private static bool ExpressionsEqual(Expression x, Expression y, LambdaExpression rootX, LambdaExpression rootY)
    {
        if (ReferenceEquals(x, y)) return true;
        if (x == null || y == null) return false;

        var valueX = TryCalculateConstant(x);
        var valueY = TryCalculateConstant(y);

        if (valueX.IsDefined && valueY.IsDefined)
            return ValuesEqual(valueX.Value, valueY.Value);

        if (x.NodeType != y.NodeType
            || x.Type != y.Type)
        {
            if (IsAnonymousType(x.Type) && IsAnonymousType(y.Type))
                throw new NotImplementedException("Comparison of Anonymous Types is not supported");
            return false;
        }

        if (x is LambdaExpression)
        {
            var lx = (LambdaExpression)x;
            var ly = (LambdaExpression)y;
            var paramsX = lx.Parameters;
            var paramsY = ly.Parameters;
            return CollectionsEqual(paramsX, paramsY, lx, ly) && ExpressionsEqual(lx.Body, ly.Body, lx, ly);
        }
        if (x is MemberExpression)
        {
            var mex = (MemberExpression)x;
            var mey = (MemberExpression)y;
            return Equals(mex.Member, mey.Member) && ExpressionsEqual(mex.Expression, mey.Expression, rootX, rootY);
        }
        if (x is BinaryExpression)
        {
            var bx = (BinaryExpression)x;
            var by = (BinaryExpression)y;
            return bx.Method == @by.Method && ExpressionsEqual(bx.Left, @by.Left, rootX, rootY) &&
                   ExpressionsEqual(bx.Right, @by.Right, rootX, rootY);
        }
        if (x is UnaryExpression)
        {
            var ux = (UnaryExpression)x;
            var uy = (UnaryExpression)y;
            return ux.Method == uy.Method && ExpressionsEqual(ux.Operand, uy.Operand, rootX, rootY);
        }
        if (x is ParameterExpression)
        {
            var px = (ParameterExpression)x;
            var py = (ParameterExpression)y;
            return rootX.Parameters.IndexOf(px) == rootY.Parameters.IndexOf(py);
        }
        if (x is MethodCallExpression)
        {
            var cx = (MethodCallExpression)x;
            var cy = (MethodCallExpression)y;
            return cx.Method == cy.Method
                   && ExpressionsEqual(cx.Object, cy.Object, rootX, rootY)
                   && CollectionsEqual(cx.Arguments, cy.Arguments, rootX, rootY);
        }
        if (x is MemberInitExpression)
        {
            var mix = (MemberInitExpression)x;
            var miy = (MemberInitExpression)y;
            return ExpressionsEqual(mix.NewExpression, miy.NewExpression, rootX, rootY)
                   && MemberInitsEqual(mix.Bindings, miy.Bindings, rootX, rootY);
        }
        if (x is NewArrayExpression)
        {
            var nx = (NewArrayExpression)x;
            var ny = (NewArrayExpression)y;
            return CollectionsEqual(nx.Expressions, ny.Expressions, rootX, rootY);
        }
        if (x is NewExpression)
        {
            var nx = (NewExpression)x;
            var ny = (NewExpression)y;
            return
                Equals(nx.Constructor, ny.Constructor)
                && CollectionsEqual(nx.Arguments, ny.Arguments, rootX, rootY)
                && (nx.Members == null && ny.Members == null
                    || nx.Members != null && ny.Members != null && CollectionsEqual(nx.Members, ny.Members));
        }
        if (x is ConditionalExpression)
        {
            var cx = (ConditionalExpression)x;
            var cy = (ConditionalExpression)y;
            return
                ExpressionsEqual(cx.Test, cy.Test, rootX, rootY)
                && ExpressionsEqual(cx.IfFalse, cy.IfFalse, rootX, rootY)
                && ExpressionsEqual(cx.IfTrue, cy.IfTrue, rootX, rootY);
        }

        throw new NotImplementedException(x.ToString());
    }

    private static Boolean IsAnonymousType(Type type)
    {
        Boolean hasCompilerGeneratedAttribute = type.GetCustomAttributes(typeof(CompilerGeneratedAttribute), false).Any();
        Boolean nameContainsAnonymousType = type.FullName.Contains("AnonymousType");
        Boolean isAnonymousType = hasCompilerGeneratedAttribute && nameContainsAnonymousType;

        return isAnonymousType;
    }

    private static bool MemberInitsEqual(ICollection<MemberBinding> bx, ICollection<MemberBinding> by, LambdaExpression rootX, LambdaExpression rootY)
    {
        if (bx.Count != by.Count)
        {
            return false;
        }

        if (bx.Concat(by).Any(b => b.BindingType != MemberBindingType.Assignment))
            throw new NotImplementedException("Only MemberBindingType.Assignment is supported");

        return
            bx.Cast<MemberAssignment>().OrderBy(b => b.Member.Name).Select((b, i) => new { Expr = b.Expression, b.Member, Index = i })
            .Join(
                  by.Cast<MemberAssignment>().OrderBy(b => b.Member.Name).Select((b, i) => new { Expr = b.Expression, b.Member, Index = i }),
                  o => o.Index, o => o.Index, (xe, ye) => new { XExpr = xe.Expr, XMember = xe.Member, YExpr = ye.Expr, YMember = ye.Member })
                   .All(o => Equals(o.XMember, o.YMember) && ExpressionsEqual(o.XExpr, o.YExpr, rootX, rootY));
    }

    private static bool ValuesEqual(object x, object y)
    {
        if (ReferenceEquals(x, y))
            return true;
        if (x is ICollection && y is ICollection)
            return CollectionsEqual((ICollection)x, (ICollection)y);

        return Equals(x, y);
    }

    private static ConstantValue TryCalculateConstant(Expression e)
    {
        if (e is ConstantExpression)
            return new ConstantValue(true, ((ConstantExpression)e).Value);
        if (e is MemberExpression)
        {
            var me = (MemberExpression)e;
            var parentValue = TryCalculateConstant(me.Expression);
            if (parentValue.IsDefined)
            {
                var result =
                    me.Member is FieldInfo
                        ? ((FieldInfo)me.Member).GetValue(parentValue.Value)
                        : ((PropertyInfo)me.Member).GetValue(parentValue.Value);
                return new ConstantValue(true, result);
            }
        }
        if (e is NewArrayExpression)
        {
            var ae = ((NewArrayExpression)e);
            var result = ae.Expressions.Select(TryCalculateConstant);
            if (result.All(i => i.IsDefined))
                return new ConstantValue(true, result.Select(i => i.Value).ToArray());
        }
        if (e is ConditionalExpression)
        {
            var ce = (ConditionalExpression)e;
            var evaluatedTest = TryCalculateConstant(ce.Test);
            if (evaluatedTest.IsDefined)
            {
                return TryCalculateConstant(Equals(evaluatedTest.Value, true) ? ce.IfTrue : ce.IfFalse);
            }
        }

        return default(ConstantValue);
    }

    private static bool CollectionsEqual(IEnumerable<Expression> x, IEnumerable<Expression> y, LambdaExpression rootX, LambdaExpression rootY)
    {
        return x.Count() == y.Count()
               && x.Select((e, i) => new { Expr = e, Index = i })
                   .Join(y.Select((e, i) => new { Expr = e, Index = i }),
                         o => o.Index, o => o.Index, (xe, ye) => new { X = xe.Expr, Y = ye.Expr })
                   .All(o => ExpressionsEqual(o.X, o.Y, rootX, rootY));
    }

    private static bool CollectionsEqual(ICollection x, ICollection y)
    {
        return x.Count == y.Count
               && x.Cast<object>().Select((e, i) => new { Expr = e, Index = i })
                   .Join(y.Cast<object>().Select((e, i) => new { Expr = e, Index = i }),
                         o => o.Index, o => o.Index, (xe, ye) => new { X = xe.Expr, Y = ye.Expr })
                   .All(o => Equals(o.X, o.Y));
    }

    private struct ConstantValue
    {
        public ConstantValue(bool isDefined, object value)
            : this()
        {
            IsDefined = isDefined;
            Value = value;
        }

        public bool IsDefined { get; private set; }

        public object Value { get; private set; }
    }
} 
```

请注意，它不比较完整的 AST。相反，它折叠常量表达式并比较它们的值而不是它们的 AST。当 lambda 具有对局部变量的引用时，它对于模拟验证很有用。在他的例子中，变量是通过它的值来比较的。

单元测试：

```
[TestClass]
public class Tests
{
    [TestMethod]
    public void BasicConst()
    {
        var f1 = GetBasicExpr1();
        var f2 = GetBasicExpr2();
        Assert.IsTrue(LambdaCompare.Eq(f1, f2));
    }

    [TestMethod]
    public void PropAndMethodCall()
    {
        var f1 = GetPropAndMethodExpr1();
        var f2 = GetPropAndMethodExpr2();
        Assert.IsTrue(LambdaCompare.Eq(f1, f2));
    }

    [TestMethod]
    public void MemberInitWithConditional()
    {
        var f1 = GetMemberInitExpr1();
        var f2 = GetMemberInitExpr2();
        Assert.IsTrue(LambdaCompare.Eq(f1, f2));
    }

    [TestMethod]
    public void AnonymousType()
    {
        var f1 = GetAnonymousExpr1();
        var f2 = GetAnonymousExpr2();
        Assert.Inconclusive("Anonymous Types are not supported");
    }

    private static Expression<Func<int, string, string>> GetBasicExpr2()
    {
        var const2 = "some const value";
        var const3 = "{0}{1}{2}{3}";
        return (i, s) =>
            string.Format(const3, (i + 25).ToString(CultureInfo.InvariantCulture), i + s, const2.ToUpper(), 25);
    }

    private static Expression<Func<int, string, string>> GetBasicExpr1()
    {
        var const1 = 25;
        return (first, second) =>
            string.Format("{0}{1}{2}{3}", (first + const1).ToString(CultureInfo.InvariantCulture), first + second,
                "some const value".ToUpper(), const1);
    }

    private static Expression<Func<Uri, bool>> GetPropAndMethodExpr2()
    {
        return u => Uri.IsWellFormedUriString(u.ToString(), UriKind.Absolute);
    }

    private static Expression<Func<Uri, bool>> GetPropAndMethodExpr1()
    {
        return arg1 => Uri.IsWellFormedUriString(arg1.ToString(), UriKind.Absolute);
    }

    private static Expression<Func<Uri, UriBuilder>> GetMemberInitExpr2()
    {
        var isSecure = true;
        return u => new UriBuilder(u) { Host = string.IsNullOrEmpty(u.Host) ? "abc" : "def" , Port = isSecure ? 443 : 80 };
    }

    private static Expression<Func<Uri, UriBuilder>> GetMemberInitExpr1()
    {
        var port = 443;
        return x => new UriBuilder(x) { Port = port, Host = string.IsNullOrEmpty(x.Host) ? "abc" : "def" };
    }

    private static Expression<Func<Uri, object>> GetAnonymousExpr2()
    {
        return u => new { u.Host , Port = 443, Addr = u.AbsolutePath };
    }

    private static Expression<Func<Uri, object>> GetAnonymousExpr1()
    {
        return x => new { Port = 443, x.Host, Addr = x.AbsolutePath };
    }
} 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-11-12T10:36:44.133

嗯......我猜你必须解析树，检查每个节点类型和成员。我举个例子...

```
using System;
using System.Linq.Expressions;
class Test {
    public string Foo { get; set; }
    public string Bar { get; set; }
    static void Main()
    {
        bool test1 = FuncTest<Test>.FuncEqual(x => x.Bar, y => y.Bar),
            test2 = FuncTest<Test>.FuncEqual(x => x.Foo, y => y.Bar);
    }

}
// this only exists to make it easier to call, i.e. so that I can use FuncTest<T> with
// generic-type-inference; if you use the doubly-generic method, you need to specify
// both arguments, which is a pain...
static class FuncTest<TSource>
{
    public static bool FuncEqual<TValue>(
        Expression<Func<TSource, TValue>> x,
        Expression<Func<TSource, TValue>> y)
    {
        return FuncTest.FuncEqual<TSource, TValue>(x, y);
    }
}
static class FuncTest {
    public static bool FuncEqual<TSource, TValue>(
        Expression<Func<TSource,TValue>> x,
        Expression<Func<TSource,TValue>> y)
    {
        return ExpressionEqual(x, y);
    }
    private static bool ExpressionEqual(Expression x, Expression y)
    {
        // deal with the simple cases first...
        if (ReferenceEquals(x, y)) return true;
        if (x == null || y == null) return false;
        if (   x.NodeType != y.NodeType
            || x.Type != y.Type ) return false;

        switch (x.NodeType)
        {
            case ExpressionType.Lambda:
                return ExpressionEqual(((LambdaExpression)x).Body, ((LambdaExpression)y).Body);
            case ExpressionType.MemberAccess:
                MemberExpression mex = (MemberExpression)x, mey = (MemberExpression)y;
                return mex.Member == mey.Member; // should really test down-stream expression
            default:
                throw new NotImplementedException(x.NodeType.ToString());
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-06-16T18:15:01.207

一个规范的解决方案会很棒。与此同时，我创建了一个`IEqualityComparer<Expression>`版本。这是一个相当冗长的实现，所以我[为它创建了一个要点](https://gist.github.com/jnm2/83b36ad497b4cb1cbcac)。

它旨在成为一个全面的抽象语法树比较器。为此，它会比较每种表达式类型，包括 C# 尚不支持的表达式，例如`Try`and`Switch`和`Block`。由于我对它们的了解有限，它唯一不比较的类型是`Goto`,和。`Label``Loop``DebugInfo`

您可以指定是否以及如何比较参数和 lambda 的名称，以及如何处理`ConstantExpression`.

它按上下文位置跟踪参数。支持 lambda 内的 Lambda 和 catch 块变量参数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-05-29T02:52:09.120

我知道这是一个老问题，但我推出了自己的表达式树相等比较器 - [https://github.com/yesmarket/yesmarket.Linq.Expressions](https://github.com/yesmarket/yesmarket.Linq.Expressions)

该实现大量使用 ExpressionVisitor 类来确定两个表达式树是否相等。当遍历表达式树中的节点时，会比较各个节点是否相等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-04-20T06:47:17.730

我认为，当您使用*高效 lambda 集合*`Lambdas`时，您将获得最大的效率——我的意思是*基于列的集合*，它只能由一个或多个选定的列枚举，通过分别在每列上实现来实现这一点——让我们称之为 **第一步**;)**`IEnumerable`**

 ****这只是我想在某一天做的想法。目前我没有任何线索，但我想很多人会同意我的观点，即通过单个变量列表检查值与检查对象列表中的某些属性相比，就像证明自己一样。

下一步从函数式编程中获得更多信息：使用 sorted-list 、 hash-table 或任何其他搜索效率高的**集合***作为*表示*列*的*集合*。

```
class LambdaReadyColumn<int> : HashTable<int> 
```

另一个**第三步**用一些指针连接列之间的项目，而不是将列在引擎盖下：

```
class LambdaReadyColumn<int> : IEnumabrable<int> 
```

将数据保存在更接近：

```
class LambdaReadyColumn<LambdaReadyColumnItem<T, int>> : IEnumabrable<int> 
//with example constructor like: 
public LambdaReadyColumn<LambdaReadyColumnItem<T, int>>(Hash, LambdaReadyColumnItem, LambdaReadyColumnItem, T, int); 
```

在哪里：

*   CollectionItem - 对同一 T 项的左右列项的引用
*   哈希 - 使搜索更快
*   int - 表示列的类型
*   T -列集合中的**第四步**`Select(T)`整个 LambdaReadyCollection 很容易理解，只是为了使返回的项目描述符更快，但也避免为具有许多属性的项目向左/向右遍历少量引用。

最后，通过所有步骤，我们收集了双重数据：基于行和基于集合的额外大量参考数据。当然，基于行的 HashTable 可以只保留基于数据和基于列的引用，但是构建每个集合以从语句返回将使用大量引用。

要实现它，您需要根据语言使用反射、动态类型或其他高级技术。

# sql-server - 如何说服 ascmd.exe 将表格作为输出，而不是 XML 文件？

> ID：283543
> 
> 赞同：2
> 
> 时间：2008-11-12T10:35:28.410
> 
> 标签：sql-server, command-line, olap, mdx, ascmd

我正在尝试通过 ascmd 实用程序查看我的 OLAP 多维数据集中的数据。作为输入，我输入了一个 MDX 查询，但只有输出（在命令行中）是一个 XML 文件。我尝试使用 -Tf text 和 -Tf csv 参数，但它们并没有按照我认为应该的方式工作（我一直在输出一个 XML）。我想在我的输出上有这样的东西 www.pinaldave.com/download/sqlcmd4.gif -- 是否可以在 ascmd 中获取文本输出（就像在 sqlcmd 中一样）？

感谢帮助。此致。

PS。我使用的语法： ascmd.exe -S 服务器名 -d 数据库 -i query.mdx -Tf csv -o output.csv

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T02:49:19.800

我相信 -Tf 是捕获跟踪输出的格式，而不是查询结果。

您可以将此作为请求记录在[ascmd 站点](http://www.codeplex.com/MSFTASProdSamples)上的问题跟踪器中。另一种可能的解决方法是在 SQL Server 上配置链接服务器并使用 OPENQUERY() 函数将 MDX 发送到 SSAS。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-11T19:45:34.687

事实上 ascmd 实用程序不提供表格输出。我认为这是因为 MDX 查询可以创建多维输出（例如数据透视表，其中行和列上有许多元素和层次结构）。如果您需要能够以 CSV 格式创建输出，请尝试创建将 XMLA 转换为 CSV 并将其添加到 ascmd 源代码的静态方法。

# java - 通过在 java 项目中删除 XML，您的效率得到了哪些提升？

> ID：283544
> 
> 赞同：3
> 
> 时间：2008-11-12T10:36:26.020
> 
> 标签：java, xml

我刚刚从项目的第 1 阶段转到第 2 阶段。在这个过渡中，我们摆脱了 spring 和 struts2 的所有 XML 配置，切换到完全注释的机制。

所有参与者都对这对开发速度的实际影响感到惊讶。有许多的原因：

*   对需要哪些角色的结构化思考可以清楚地理解我们需要 @StubRepository、@TestService 和 @NotTestService 注释来促进我们项目使用的所有不同运行时模型（运行时、单元测试、集成测试、硒测试）
*   这些注释替换了*大量*重复的 xml 定义。
*   所有依赖项在 ide 中都是完全可跟踪的。
*   使用代码更简单，因为依赖关系清晰

其中一些收益可能也可以通过重新构建 xml 来实现，但这并不是一项简单的任务。

老实说，我相信这为我们的 20,000 工时项目带来了大约 10% 的生产力提升。我几乎觉得难以置信。

还有其他人分享同样的经历吗？你的收获是什么，你如何解释它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T12:17:20.810

基本上，这可以被视为关于配置文件与注释的问题。

如果您在将一些数据作为注释时经历了生产力提升的改善，这意味着它们首先不是“配置”材料。

两者的区别：

*   注释：一切都在一个地方，配置信息直接与 Java 组件相关联。由于这个原因，源代码的许多类型的重构对注释都是透明的——注释将始终应用于它们所附加的组件，即使该组件被移动或重命名。对于需要新的或修改过的注解的其他重构，所有内容都在同一个位置，确保开发人员可以看到注解并增加他们记住进行必要更改的可能性。

*   配置文件可以提供跨越应用程序不同组件的关系网络的组织视图。因为它们与实际的源代码是分开的，所以它们不会干扰 Java 源代码的可读性。

您所经历的是，需要与应用程序的源代码并行维护配置文件的需求不同，两者之间没有明显的联系。

但是：注解有其缺点：源代码可能会被各种与实际程序逻辑无关的注解弄得杂乱无章，影响代码的可读性。并且虽然注释对于与特定组件相关的元数据来说是理想的，但它们不太适合具有跨组件应用程序的元数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T13:02:56.600

（我真的不是想用一堆陈词滥调来回应，但 XML 似乎带出了谚语集合...... ;-)

我找到了 XML 配置（以及一般的配置文件，但这是另一个问题）来介绍您的问题的多个级别，因为“对于一个拿着锤子的小男孩来说，一切看起来都像钉子。” 很容易对一种工具（例如 XML）产生热情并开始使用它比它应得的更广泛，或者继续添加“只是一个更多”功能，直到结果变得过于笨拙。

此外，正如那句老话所说，“编程中的一切都是权衡取舍”。

那么，为了扮演魔鬼的拥护者，您是否已经到了需要对正在运行的系统进行维护或调整的地步？在新的生活计划中，您多久需要通过重新构建全部或部分系统来进行调整，而不是能够调整配置文件？

最后，大致相当于“霍桑效应”（见下文）。有时，当一个团队被允许清理一些小问题时，他们会感到一阵兴奋，并且他们实现了与实际改进不成比例的生产力爆发，这是由摆脱长期烦恼所引发的缓解所引发的。

脚注：

[霍桑效应](http://en.wikipedia.org/wiki/Hawthorne_effect)以一项与照明变化相关的工厂工人生产力研究命名。研究人员发现，随着光照的增加，生产力也会提高。但随后他们发现，***随着***光照的减少，生产力也会随之提高。（这两次增长通常都是短期的。）最后的结论是，工人的工作效率更高，因为有人在关注他们。

因此，有时一个微不足道的变化会引发士气（授权感等）的提振，从而提高绩效。

很少只有一个因素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T10:51:43.917

我没有像您这样的生产力数据，但在从 xml 配置转移到注释时，我看到了显着的改进。我认为是因为配置信息与代码在同一个地方。

在您不得不查看一个单独的文件来查找配置之前，这会减慢速度。

# sql - 使用笛卡尔积进行 SQL 查询的问题

> ID：283551
> 
> 赞同：2
> 
> 时间：2008-11-12T10:38:09.323
> 
> 标签：sql, tsql

我正在努力创建一个查询。它与一个庞大而复杂的数据库有关，但为了这篇文章，我将问题归结为更简单的问题。

我有三个表 X，Y，Z 定义为

```
CREATE TABLE [dbo].[X](
  [ID] [bigint] NOT NULL
)

CREATE TABLE [dbo].[Y](
  [ID] [nchar](10) NOT NULL
)

CREATE TABLE [dbo].[Z](
  [IDX] [bigint] NOT NULL,
  [IDY] [nchar](10) NOT NULL
) 
```

它们包含以下数据

```
Table X    Table Y    Table Z
ID         ID         IDX  IDY
--         --         ---  ---
1          A          1    A         
2          B          1    B         
3          C          1    A 
```

我想创建一个产生以下结果的查询

```
Count  IDX  IDY
=====  ===  ===
    2    1    A
    1    1    B
    0    1    C
    0    2    A
    0    2    B
    0    2    C
    0    3    A
    0    3    B
    0    3    C 
```

我最初的想法是

```
SELECT COUNT(*), X.ID, Y.ID
FROM
  X
  CROSS JOIN Y
  FULL OUTER JOIN Z ON X.ID = Z.IDX AND Y.ID = Z.IDY
GROUP BY X.ID, Y.ID 
```

但事实证明这是在错误的道路上。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T10:51:04.557

这似乎有效：

```
SELECT COUNT(*) AS CNT, IDX, IDY
FROM Z
GROUP BY IDX, IDY
UNION
SELECT 0, X.ID, Y.ID
FROM X, Y
WHERE NOT EXISTS (
    SELECT * FROM Z WHERE Z.IDX = X.ID AND Z.IDY = Y.ID
)
ORDER BY CNT DESC 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T10:58:24.527

```
SELECT
    (SELECT COUNT(*) FROM Z WHERE IDX = X.ID AND IDY = Y.ID),
    X.ID,
    Y.ID
FROM
    X,Y 
```

这就是你的答案......为什么你可能想要那个查询，不知道:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T10:50:57.583

```
SELECT
  COUNT(z.idx) count,
  x.id idx,
  y.id idy
FROM
  (x CROSS JOIN y)
  LEFT JOIN z ON z.idx = x.id AND z.idy = y.id
GROUP BY
  x.id,
  y.id
ORDER BY
  COUNT(z.idx) DESC,
  x.id,
  y.id 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T11:14:00.907

```
SELECT (SELECT(COUNT(*) FROM Z) AS COUNT, X.ID AS IDX, y.ID AS IDY
FROM X CROSS JOIN Y 
ORDER BY 1 DESC, 2, 3 
```

# crc - 棘手的CRC算法

> ID：283556
> 
> 赞同：3
> 
> 时间：2008-11-12T10:39:31.367
> 
> 标签：crc

我正在尝试找到适用于以下结果的 crc。字节串由 2 个字节组成（即 0xCE1E），而 crc 是一个单字节（即 0x03）

```
字节CRC
CE1E 03
CE20 45
CE22 6F
0000 C0
0001 D4
FFFF 95

```

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T11:38:53.710

首先，4 个十六进制数字不是 4 个字节。由于您的所有示例都显示 4 个十六进制数字 - 2 个字节 - 我假设您的意思是 2 个字节。

只有 65,536 个不同的哈希值，这就是你要做的。

对从 0000 到 FFFF 的所有 65,536 个值执行散列函数。将结果制成表格。那个表**就是**函数。它将输入值映射到输出值。

虽然很蹩脚，但它总是正确的，它不是特别大（65K 字节），而且在你完成计算之后它真的很快。

你不能很容易地对哈希函数进行逆向工程。好的状态机是复杂的状态机，它以某种“公平”的方式使用所有输入位，因此对于仅相差几位的输入值，输出值会显着不同。

如果您将 0000 与 0001、0002、0004、0008、0010、0020、0040、0080、0100、0200、0400、0800、1000、2000、4000 和 8000 进行比较，您可能能够找出每个位对哈希。但我对此表示怀疑。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T13:44:33.360

CRC 是简单的除法，就像您在小学学习长手除法一样，只是加减法被替换为 XOR。因此，您需要做的是求解 GF(2) 中的以下方程：

```
CE1E % p = 03
CE20 % p = 45
CE22 % p = 6F
0000 % p = C0
0001 % p = D4
FFFF % p = 95 
```

不存在 0000%p = c0 的多项式 p。（对于 p 的所有值，0 模 p 为 0。）所以也许它是 (x+input) % p = crc。在您的情况下，x 必须是 c0。如果这是真的，那么 (x+0001)%p 必须是 c1。看起来它根本不是CRC。如果您确定并且相信答案是线性的，请制作一个由 0 和 1 组成的可逆矩阵，并求解由矩阵乘以输入 = 输出得出的方程组。不过，您将需要更多输入。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T11:14:21.983

假设它们是两个字节（16 位）的值，我在一些在线 CRC 生成器上尝试了一些，但没有得到你的结果。所以看起来它不是常用的CRC算法。

您对可能的算法有任何线索吗？或者这是一个家庭作业，你应该对 CRC 算法/参数进行逆向工程？

摘要：需要更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T11:58:38.023

[http://www.geocities.com/SiliconValley/Pines/8659/crc.htm#r2](http://www.geocities.com/SiliconValley/Pines/8659/crc.htm#r2)

在我没有经验的眼里，你必须实现一个通用的 crc 算法并用几个 polys 进行尝试（首先尝试该文章中提到的“流行”算法）。

*编辑*：进一步阅读后，您似乎也必须考虑反向多边形。

# algorithm - 从 F# 中的 n-ary 树中提取叶子路径

> ID：283561
> 
> 赞同：6
> 
> 时间：2008-11-12T10:42:23.340
> 
> 标签：algorithm, f#, n-ary-tree

受[这个问题](https://stackoverflow.com/questions/277106/looking-for-some-interesting-c-programming-problems)的启发，我最近想尝试[一下这个挑战](http://domino.research.ibm.com/Comm/wwwr_ponder.nsf/Challenges/November2008.html)，使用 F#

我的方法可能完全偏离了方向，但在解决这个问题的过程中，我试图获取数字 0-9 的所有排列的列表。

我正在考虑使用像这样的 n-ary 树来解决它：

```
type Node = 
    | Branch of (int * Node list)
    | Leaf of int 
```

我对自己很满意，因为我已经设法弄清楚如何生成我想要的树。

我现在的问题是我无法弄清楚如何遍历这棵树并将每个叶子的“路径”提取为一个 int。让我感到困惑的是我需要在单个节点上进行匹配，但我的“外部”函数需要一个节点列表。

我目前的尝试几乎做了正确的事情，除了它返回给我所有路径的总和......

```
let test = Branch(3, [Branch(2, [Leaf(1)]);Branch(1, [Leaf(2)])])

let rec visitor lst acc = 
    let inner n = 
        match n with
        | Leaf(h) -> acc * 10 + h
        | Branch(h, t) -> visitor t (acc * 10 + h)
    List.map inner lst |> List.sum

visitor [test] 0 //-> gives 633 (which is 321 + 312) 
```

而且我什至不确定这是尾递归。

（非常欢迎您提出另一种寻找排列的解决方案，但我仍然对这个特定问题的解决方案感兴趣）

编辑：我在[这里](https://stackoverflow.com/questions/286427/calculating-permutations-in-f)发布了 F# 中的通用排列算法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-12T11:12:48.273

关于您关于列表遍历的问题-您可以从编写一个返回表示路径的列表的函数开始-我认为这更容易，以后将其转换为返回数字的函数会很容易。

这个将一个列表作为第一个参数（到目前为止的路径）和一个树并返回一个 list> 类型 - 这是来自当前分支的所有可能路径。

```
let rec visitor lst tree = 
  match tree with
  | Branch(n, sub) -> List.collect (visitor (n::lst)) sub
  | Leaf(n) -> [List.rev (n::lst)]

// For example...
> let tr = Branch(1, [Leaf(3); Branch(2, [Leaf(4); Leaf(5)] )]);;
> visitor [] tr;;
val it : int list list = [[1; 3]; [1; 2; 4]; [1; 2; 5]] 
```

在“叶子”的情况下，我们只需将当前数字添加到列表中并将结果作为包含单个列表的列表返回（我们必须先将其反转，因为我们在开头添加了数字）。在“分支”的情况下，我们将“n”添加到列表中并递归调用访问者来处理当前分支的所有子节点。这会返回一堆列表，我们使用“map_concat”将它们变成一个列表，其中包含来自当前分支的所有可能路径。

现在，您可以重写它以返回整数列表：

```
let rec visitor2 lst tree = 
  match tree with
  | Branch(n, sub) -> List.collect (visitor2 (lst * 10 + n)) sub
  | Leaf(n) -> [lst * 10 + n]

// For example...  
> visitor2 0 tr;;
val it : int list = [13; 124; 125] 
```

我们现在计算数量，而不是连接列表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T12:04:38.387

关于懒惰 - 你可以通过使用 F#“seq”类型而不是“list”类型来使这个懒惰。这是一个例子：

```
let rec visitor2 lst tree =
  match tree with
  | Branch(n, sub) -> Seq.map_concat (visitor2 (lst * 10 + n)) sub
  | Leaf(n) ->
      seq { do printfn "--yielding: %d" (lst * 10 + n)
            yield lst * 10 + n };; 
```

“seq” 是一个序列表达式，它表示一个惰性值流。我在代码中添加了“printfn”，这样我们就可以跟踪事情的执行情况：

```
> visitor2 0 tr |> Seq.take 2;;
--yielding: 13
--yielding: 124
val it : seq<int> = seq [13; 124] 
```

您可能可以使用 Seq.first 之类的东西来查找代表结果的第一个值。

# installation - MSI 包装指南

> ID：283570
> 
> 赞同：0
> 
> 时间：2008-11-12T10:45:03.007
> 
> 标签：installation, wix, windows-installer, versioning, packaging

我们正在打包我们的产品/模块组合。其中一些是独立的，一些是相互依赖的。所有版本都必须可并行部署。因为它是我们正在考虑两种选择：

1.  每个软件包和版本一个 MSI
2.  每个产品/模块和版本一个 MSI

第一种选择意味着相同合并模块的组合将在多个包中交付。第二种选择代表更简单的路径。

你能就这个问题提供一些建议吗？从长远来看，任何替代方案都会导致悲伤吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T11:50:35.700

如果您安装相同的组件两次，Windows Installer 只会引用计数第一次安装，因此两者之间没有太大区别。如果您已经将组件分离为合并模块，则可以保证组件将共享其 GUID，并且您将获得这种行为，并且组件的共享不会给您带来任何问题。

但是，如果您制作了很多小 MSI，这样“包”安装将需要多个 MSI，您将失去 Windows Installer 事务功能 - 失败的安装不会回滚以前的安装 - 您可能需要查看在“chainer”应用程序中。我通常会尽量少做 MSI。

# asp.net - Reporting Services .. 如何导出禁用超链接的 Excel 电子表格

> ID：283575
> 
> 赞同：1
> 
> 时间：2008-11-12T10:46:32.413
> 
> 标签：asp.net, reporting-services, reporting, export-to-excel

我正在使用 ReportViewer 控件在 WebForm 中显示报表，我还通过调用服务器报表的 Render 方法实现了“导出到 Excel”功能

例如

```
ReportViewerControl.ServerReport.Render("Excel",etc,etc,etc); 
```

我的问题是导出的报告包含链接到其他报告的超链接，我希望这些出现在网络表单中但不出现因此在导出的电子表格中被禁用（由上面的代码生成）。

有没有人有办法实现这一目标？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-14T14:10:33.897

报告不预先知道导出时将采用什么形式。如果您需要不同的布局，具体取决于报告导出到的格式，那么您需要为每个布局制作单独的报告。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T17:32:59.100

只是为了回答我自己的问题，我们最终传递了一个额外的报告参数，并让报告删除链接，然后正常调用渲染。

简单但有效。

# oracle - 每个用户默认方案的 Oracle 设置（不改变会话）

> ID：283589
> 
> 赞同：16
> 
> 时间：2008-11-12T10:51:17.927
> 
> 标签：oracle, login, schema, settings, default

有没有办法改变 oracle 用户的默认模式？

我在常见问题解答中发现我可以在会话中更改它，但这不是我想要的。EG 登录时的用户总是将另一个模式视为默认模式。

提前致谢。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-12T12:35:26.890

我相信登录触发器应该可以工作：

```
CREATE OR REPLACE TRIGGER db_logon
AFTER logon ON DATABASE WHEN (USER = 'A')
BEGIN
    execute immediate 'ALTER SESSION SET CURRENT_SCHEMA = B';
END; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-30T23:17:28.560

出于某种原因，托尼的扳机对我不起作用。但是，我在网上发现了一个使用相同概念的稍微不同的触发器。

```
create or replace trigger set_default_schema
after logon on my_user.schema
begin
  execute immediate 'alter session set current_schema=NEW_SCHEMA';
end; 
```

我只是想把它扔在那里，以防其他人有同样的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-16T12:47:23.057

```
create or replace trigger AFTER_LOGON_TSFREL
AFTER LOGON ON "TSFRELEASEAPP".SCHEMA
BEGIN
   EXECUTE IMMEDIATE 'ALTER SESSION SET current_schema=TSF_RELEASE';
END; 
```

# asp.net - ASP.net Session Destroy 如果他关闭浏览器

> ID：283591
> 
> 赞同：0
> 
> 时间：2008-11-12T10:51:57.160
> 
> 标签：asp.net

我有一个网站。当用户登录时，将加载会话详细信息。当用户注销时，会话详细信息将被放弃。（通过单击注销菜单注销）当用户简单地关闭浏览器然后如何销毁会话。

在下一次它使用相同的会话数据进行日志记录。我需要避免这种情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T11:10:38.587

作为注销处理的一部分，调用 Session.Clear() 来清除键/值对：

[http://msdn.microsoft.com/en-us/library/system.web.sessionstate.httpsessionstate.clear.aspx](http://msdn.microsoft.com/en-us/library/system.web.sessionstate.httpsessionstate.clear.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T11:52:12.170

这是一篇有趣[的帖子](http://codebetter.com/blogs/brendan.tompkins/archive/2005/01/25/End-User-Sessions-When-the-Browser-Closes-With-Remote-Scripting.aspx)，详细说明了这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T13:44:27.567

Page.Unload() isn't called when the user leaves the site, it's called when the engine is finished rendering it, right before HTML is sent to the browser. There is no access to the page through once that's happened.

I know in PHP you can use AJAX to call a PHP function with javascript. I don't know if this is possible with ASP.Net, or will work for sessions.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T11:06:53.307

您可以将会话配置为更快地超时。

在 web.config 中：

```
< sessionState ... timeout="5" /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T11:12:54.433

你基本上有两个选择：

*   将会话 cookie 的超时设置为 1 分钟，并每 30 秒发送一次“保持活动”AJAX 请求。
*   不要使用 cookie，只需在查询中传递会话参数。

每个解决方案都适用于 99%，如果你将它们结合起来，你应该几乎可以解决 99.99% 的情况。取决于这种行为对你有多重要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T11:25:12.350

您可以使用 Page.OnUnload javascript 事件向调用 Session.Abandon() 的页面发出请求。这将导致用户会话在他离开您的站点时被删除。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T11:30:01.000

听起来您正在使用持久 cookie 来存储身份验证票证。尝试将SetAuthCookie方法的第二个参数（createPersistentCookie）设置为false，即FormsAuthentication.SetAuthCookie("myusername", false);

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-01-03T17:00:13.257

```
try
    {
        Session["Admin"] = null;
        Response.Cache.SetExpires(DateTime.UtcNow.AddMinutes(-1));
        Response.Cache.SetCacheability(HttpCacheability.NoCache);
        Response.Cache.SetNoStore();
        Session.Abandon();
        Session.Clear();                   
        Page.Response.Cache.SetCacheability(HttpCacheability.NoCache);
        Response.Redirect("Dep_NewUserCreate.aspx");

    }
    catch(Exception ExLink)
    {
        Response.Redirect("Dep_NewUserCreate.aspx");
    } 
```

# c++ - 使用 Objective C 中的 C++：如何分配/解除分配？

> ID：283593
> 
> 赞同：2
> 
> 时间：2008-11-12T10:52:41.480
> 
> 标签：c++, objective-c, object, scope, auto-ptr

`new`目前，我的 Objective C 类通过在创建所有者时执行 a 并`delete`在销毁时调用来使用 C++ 对象。但是还有其他方法吗？我希望能够声明一个`auto_ptr`其范围持续到 Objective C 类的生命周期的持续时间。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T11:07:46.270

好的，让我假设您在 Mac 上使用 C++ 和 Objective-C，如果我是对的，您可能正在使用 X-code。因此，如果您转到项目的属性（信息）。您可以检查编译选项（GCC）。在那里，有一个选项可以启用 C++ 构造函数/析构函数（在 Cocoa 项目中默认关闭）。

然后你会得到类似默认的 C++ 作用域，但是我没有使用太多，而且我在使用大量模板代码 (Boost) 时遇到了问题。

此外，我认为除了一些在 GCC 上工作的好人之外，没有人正式支持这一点。所以我建议你对这样的任何东西进行单元测试，并注意任何事情都可能出错。

尽管如此，对于作为 C++ 人的我来说，能够在 Objective-C 中使用 C++ 是一种解脱，而且风险是值得的 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T18:01:15.297

如果您对保留我们作为开发人员所剩无几的理智有丝毫希望，您就不会那样做。最好是`delete`你的 C++ 对象。一般来说，虽然逐行混合 Objective-C 和 C++ 是安全的，但不要期望运行时支持做一些花哨的事情，比如混合生命周期。通常，当调用 obj-c 类的 dealloc 时，您可以安全地销毁对象，但除此之外，不要期望混合类范围并且不要哭泣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-21T11:42:35.507

在 Xcode 中，我正在阅读“The Objective-C Programming Language”，标题为“Using C++ With Objective-C”的部分。我没有尝试过，但它说您*可以*使用 C++ 类作为实例变量。它使用零参数构造函数来初始化任何属于 C++ 类的实例变量。在 dealloc 中，以相反的实例变量声明顺序调用析构函数。

我刚刚遇到[OCPtr](http://www.levelofindirection.com/journal/2010/8/13/ocptr-a-smart-pointer-for-objective-c.html)和[Boost::shared_ptr with Cocoa](http://www.cocoadev.com/index.pl?CppSharedPtrInCocoa)的评论。两者都使用智能引用计数指针（为分配等运算符管理所有引用计数的指针）。

# .net - SQLMembershipProvider - 将成员资格添加到现有数据库。设置权限

> ID：283594
> 
> 赞同：2
> 
> 时间：2008-11-12T10:53:08.077
> 
> 标签：.net, sql-server, authentication, web-config, sqlmembershipprovider

[我正在按照这些说明](http://aspnet.4guysfromrolla.com/articles/040506-1.aspx)将与成员资格相关的模式添加到现有数据库（我们称之为 myDatabase）。

因此，在 myDatabase 中创建了许多表、视图和存储过程。

下一步是修改 web.config 以使应用程序使用 CustomizedMembershipProvider

```
<membership defaultProvider="CustomizedMembershipProvider">
      <providers>
         <add name="CustomizedMembershipProvider"
              type="System.Web.Security.SqlMembershipProvider"
              connectionStringName="MyDBConnectionString" />
      </providers>
    </membership> 
```

然后我们还需要指定连接字符串，如：

```
<connectionStrings>
     <add name="MyDB" MyDBConnectionString ="..." />
  </connectionStrings> 
```

**这是我的问题：**

1.  我应该使用与应用程序使用的连接字符串不同的连接字符串吗？是否需要在数据库中创建一个具有与成员对象相关的权限的新用户？
2.  使用用户 ID 等指定连接字符串后，我是否需要为该用户授予那些新创建的对象的权限？那是仅用于存储过程还是表和视图？

**编辑：** 我注意到在数据库中创建了一组角色以及成员资格对象。因此，将用户分配给适当的角色是一个问题。角色是这样的

```
aspnet_Membership_FullAccess
aspnet_Personalization_FullAccess
etc... 
```

所以问题的第一部分仍然存在。那么创建一个新的数据库用户有什么意义（所以单独的数据库连接）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T11:52:04.200

关于会员提供者的一些好文章：

*   [检查 ASP.NET 2.0 的成员资格、角色和配置文件](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
*   [ASP.NET 2.0 部分中的成员资格和角色提供程序](http://odetocode.com/Articles/427.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T12:03:23.163

我稍微看了一下，

1.  可以使用标准连接
2.  就权限而言，似乎是将数据库用户分配给 aspnet_Membership_FullAccess 角色（[如果您需要与它们相关的权限，则为其他角色](http://msdn.microsoft.com/en-us/library/ms164596(VS.80).aspx)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T11:38:23.603

1.  使用与您的应用程序相同的用户/数据库是完全可以的。
2.  我不知道，对不起。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T11:47:01.293

出于性能原因，我建议使用相同的连接字符串。使用与您的应用程序相同的连接字符串将允许更有效的连接池。

# regex - 在 Notepad++ 中使用 RegEX 前缀和追加

> ID：283608
> 
> 赞同：91
> 
> 时间：2008-11-12T10:59:25.193
> 
> 标签：regex, notepad++

我在 txt 文件中有相当多的单词列表，我正在尝试在 Notepad++ 中进行正则表达式查找和替换。我需要在每行之前和之后添加一个字符串。这样：

```
文字
词二
词三

```

变得

```
能够：“wordone”
能够：“wordtwo”
能够：“wordthree”

```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：183
> 
> 时间：2008-11-12T11:03:25.700

假设字母数字单词，您可以使用：

```
Search  = ^([A-Za-z0-9]+)$
Replace = able:"\1" 
```

或者，如果您只想突出显示这些行并使用“全部替换”和“在选择中”（使用相同的替换）：

```
Search = ^(.+)$ 
```

`^`指向行首。
`$`指向行尾。

`\1`将是括号内的源匹配。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2011-04-20T12:27:25.730

为什么不使用 Notepad++ 多行编辑功能？

在选择文本时按住 Alt（使用通常的单击和拖动方法）以跨多行选择文本。这有时也称为列编辑。

您可以将光标放在文件的开头，按住（并按住）Alt、Shift，然后只需按住向下箭头或 PageDown 即可选择要添加一些文本的行 :-) 简单。多行编辑是 Notepad++ 的一个非常有用的功能。也可以在 Visual Studio 中以相同的方式，在 Eclipse 中也可以通过按 Alt+Shift+A 切换到块选择模式，然后使用鼠标跨行选择文本。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2017-07-05T10:09:15.070

可以使用的正则表达式：

```
Find: \w.+
Replace: able:"$&" 
```

因为，`$&`会给你你搜索的字符串。

参考：[正则表达式](http://regexr.com/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-12T11:04:09.817

使用宏。

宏>开始录制

使用键盘以可重复的方式进行更改，例如

主页>键入“能够”>结束>向下箭头>主页

然后返回菜单并单击停止录制，然后多次运行宏。

应该这样做，并且没有基于正则表达式的并发症！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-02-07T17:53:58.933

在 Visual Studio 代码中，我发现简单的正则表达式 ^ 有效。

# xsd - XSD - 如何确保具有给定属性的特定元素的存在？

> ID：283616
> 
> 赞同：2
> 
> 时间：2008-11-12T11:03:54.030
> 
> 标签：xsd, schematron

我正在尝试使用 XSD 向[jdpl](http://docs.jboss.org/jbpm/v3/userguide/jpdl.html)流程定义文件添加额外的验证。

我们有几个要添加的规则；但是给我带来问题的一个是必须存在一个“节点”元素，它的“名称”属性=“问题”。

所以这是有效的：

```
<process-definition name='sample'>
    <node name="Problem">
    </node>
    <node name="Do Work">
    </node>
</process-definition> 
```

这不是

```
<process-definition name='sample'>
    <node name="Do Work">
    </node>
</process-definition> 
```

所以，总而言之，我需要执行的规则是

*   具有值“问题”的节点属性
*   存在 1 个名称为“问题”的节点
*   允许任意数量的具有其他名称的节点

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T11:11:09.570

抱歉，XSD 无法做到这一点。

由于性能原因，XML-Schema 设计为永远不会向前看，也永远不会回头看当前节点。这意味着它必须始终定义在验证器在模式树中的位置。这使得像这样的需求无法用 XSD 定义。

# c# - 启动时将程序放入系统托盘

> ID：283632
> 
> 赞同：16
> 
> 时间：2008-11-12T11:10:24.797
> 
> 标签：c#, .net, vb.net

我遵循了将应用程序减少到系统托盘的常用链接提示：http: [//www.developer.com/net/csharp/article.php/3336751](http://www.developer.com/net/csharp/article.php/3336751)现在它可以工作了，但仍然存在问题：显示了我的应用程序什么时候开始；我希望它直接在系统托盘中启动。我试图在 Load 事件中最小化并隐藏它，但它什么也没做。

编辑：正如海报所建议的那样，我可以修改快捷方式属性，但我宁愿使用代码：我无法完全控制安装了软件的每台计算机。

我不想从除了系统托盘之外的任何地方完全删除它，我只是希望它开始最小化。

有任何想法吗 ？

谢谢

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-12T11:38:46.643

在您的主程序中，您可能有以下形式的一行：

```
Application.Run(new Form1()); 
```

这将强制显示表单。您将需要创建表单但*不*将其传递给`Application.Run`：

```
Form1 form = new Form1();
Application.Run(); 
```

请注意，该程序现在不会终止，直到您调用`Application.ExitThread()`. 最好从`FormClosed`事件的处理程序中执行此操作。

```
private void Form1_FormClosed(object sender, FormClosedEventArgs e)
{
    Application.ExitThread();
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-12T11:21:44.667

这就是你的做法

```
static class Program
{
    [STAThread]
    static void Main()
    {
        NotifyIcon icon = new NotifyIcon();
        icon.Icon = System.Drawing.SystemIcons.Application;
        icon.Click += delegate { MessageBox.Show("Bye!"); icon.Visible = false; Application.Exit(); };
        icon.Visible = true;
        Application.Run();
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-12T11:13:46.787

如果您使用的是`NotifyIcon`，请尝试将 ShowInTaskbar 更改为 false。

要将其从 Alt+Tab 屏幕中删除，请尝试更改窗口边框样式；我相信某些工具窗口样式不会出现...

就像是：

```
using System;
using System.Windows.Forms;
class MyForm : Form
{
    NotifyIcon sysTray;

    MyForm()
    {
        sysTray = new NotifyIcon();
        sysTray.Icon = System.Drawing.SystemIcons.Asterisk;
        sysTray.Visible = true;
        sysTray.Text = "Hi there";
        sysTray.MouseClick += delegate { MessageBox.Show("Boo!"); };

        ShowInTaskbar = false;
        FormBorderStyle = FormBorderStyle.SizableToolWindow;
        Opacity = 0;
        WindowState = FormWindowState.Minimized;
    }

    [STAThread]
    static void Main()
    {
        Application.EnableVisualStyles();
        Application.Run(new MyForm());
    }
} 
```

如果它仍然出现在 Alt+Tab 中，您可以通过 p/invoke 更改窗口样式（有点 hackier）：

```
protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e);
    IntPtr handle = this.Handle;
    int currentStyle = GetWindowLong(handle, GWL_EXSTYLE);
    SetWindowLong(handle, GWL_EXSTYLE, currentStyle | WS_EX_TOOLWINDOW);
}
private const int GWL_EXSTYLE = -20, WS_EX_TOOLWINDOW = 0x00000080;
[System.Runtime.InteropServices.DllImport("user32.dll")]
private static extern int SetWindowLong(IntPtr window, int index, int value);
[System.Runtime.InteropServices.DllImport("user32.dll")]
private static extern int GetWindowLong(IntPtr window, int index); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T11:17:39.777

有点麻烦，您可以将启动应用程序的快捷方式配置为“最小化运行”？这可能会给你你所需要的！

像这样：（图片只是谷歌的一个例子）......

[![运行最小化](https://i.stack.imgur.com/MadYl.gif)](https://i.stack.imgur.com/MadYl.gif)
[（来源：[unixwiz.net](http://www.unixwiz.net/images/ygpm-shortcut-4.gif)）]

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T12:58:02.817

由于这是用 vb.net 标记的，这就是我在刚刚完成的 Windows 服务和控制器应用程序中所做的，将代码模块添加到项目中，在 Sub Main() 中设置 NotifyIcon 及其关联的上下文菜单，然后设置应用程序的启动对象到 Sub Main() 而不是 Form。

```
Public mobNotifyIcon As NotifyIcon
Public WithEvents mobContextMenu As ContextMenu

Public Sub Main()

    mobContextMenu = New ContextMenu
    SetupMenu()
    mobNotifyIcon = New NotifyIcon()
    With mobNotifyIcon
        .Icon = My.Resources.NotifyIcon
        .ContextMenu = mobContextMenu
        .BalloonTipText = String.Concat("Monitor the EDS Transfer Service", vbCrLf, "Right click icon for menu")
        .BalloonTipIcon = ToolTipIcon.Info
        .BalloonTipTitle = "EDS Transfer Monitor"
        .Text = "EDS Transfer Service Monitor"
        AddHandler .MouseClick, AddressOf showBalloon
        .Visible = True
    End With
    Application.Run()
End Sub

Private Sub SetupMenu()
    With mobContextMenu

        .MenuItems.Add(New MenuItem("Configure", New EventHandler(AddressOf Config)))
        .MenuItems.Add("-")
        .MenuItems.Add(New MenuItem("Start", New EventHandler(AddressOf StartService)))
        .MenuItems.Add(New MenuItem("Stop", New EventHandler(AddressOf StopService)))
        .MenuItems.Add("-")
        .MenuItems.Add(New MenuItem("Exit", New EventHandler(AddressOf ExitController)))
    End With
    GetServiceStatus()
End Sub 
```

在 Config() 中，我创建了我的表单的一个实例并显示它。

```
Private Sub Config(ByVal sender As Object, ByVal e As EventArgs)
    Using cs As New ConfigureService
        cs.Show()
    End Using

End Sub 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T16:12:58.913

干得好：

创建 2 个类，1 个继承自 ApplicationContext。另一个只包含一个 Main 例程。我做了一个例子，它有一个表单和一个通知图标，当双击时会弹出表单并再次返回。

请记住在我的项目设置中将“Sub Main”设置为您的启动对象，并指向一个真正的 *.ico 文件而不是 f:\TP.ico .. :)

代码当然应该填充适当的错误处理代码。

第一类：

```
Imports System.threading 
Imports System.Runtime.InteropServices 
Imports System.Windows.Forms

Public Class Class1

    <System.STAThread()> _
        Public Shared Sub Main()

        Try
            System.Windows.Forms.Application.EnableVisualStyles()
            System.Windows.Forms.Application.DoEvents()
            System.Windows.Forms.Application.Run(New Class2)
        Catch invEx As Exception

            Application.Exit()

        End Try

    End Sub 'Main End Class 
```

类2：

```
Imports System.Windows.Forms  
Imports System.drawing

Public Class Class2
    Inherits System.Windows.Forms.ApplicationContext

    Private WithEvents f As New System.Windows.Forms.Form
    Private WithEvents nf As New System.Windows.Forms.NotifyIcon

    Public Sub New()

        f.Size = New Drawing.Size(50, 50)
        f.StartPosition = FormStartPosition.CenterScreen
        f.WindowState = Windows.Forms.FormWindowState.Minimized
        f.ShowInTaskbar = False
        nf.Visible = True
        nf.Icon = New Icon("f:\TP.ico")
    End Sub

    Private Sub nf_DoubleClick(ByVal sender As Object, ByVal e As EventArgs) Handles nf.DoubleClick
        If f.WindowState <> Windows.Forms.FormWindowState.Minimized Then
            f.WindowState = Windows.Forms.FormWindowState.Minimized
            f.Hide()
        Else
            f.WindowState = Windows.Forms.FormWindowState.Normal
            f.Show()
        End If
    End Sub

    Private Sub f_FormClosed(ByVal sender As Object, ByVal e As FormClosedEventArgs) Handles f.FormClosed
        Application.Exit()
    End Sub  End Class 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T16:25:38.030

这向您展示了如何使用 NotifyIcon 将启动控制为最小化或正常以及更多。

更多信息：http: [//code.msdn.microsoft.com/TheNotifyIconExample](http://code.msdn.microsoft.com/TheNotifyIconExample)

# apache - Apache反向代理设置SSL证书

> ID：283636
> 
> 赞同：3
> 
> 时间：2008-11-12T11:11:56.137
> 
> 标签：apache, ssl, ssl-certificate, reverse-proxy

我们需要在 Apache 反向代理上设置安全证书。我们被告知我们需要使用虚拟主机指令。

我在 O'Reilly 的书籍中查找了这些内容，找不到任何专门使用 https 的示例。

有没有人有任何配置片段的例子来做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T11:30:05.960

我不确定您要的是什么，但是您需要很多东西。例如，您需要获得 SSL 证书，然后您需要将 mod_ssl 安装到您的 Apache 中。我建议您使用系统的包管理器等安装它。

这是一个示例虚拟主机：

```
<VirtualHost IP.ADDRESS.HERE:443>
   DocumentRoot /web/domain.com/www/htdocs

   ServerName www.domain.com
   ServerAdmin server@domain.com

   SSLEngine on
   SSLCertificateFile /usr/local/etc/apache/ssl.crt/www.domain.com.crt
   SSLCertificateKeyFile /usr/local/etc/apache/ssl.key/www.domain.com.key

   ErrorLog "/var/logs/domain.com/error_log"
   CustomLog "|/usr/local/sbin/cronolog /var/logs/domain.com/%Y/%m/access_log" combined
</VirtualHost> 
```

内部的代理配置`<VirtualHost />`看起来会有所不同。这假设域指向您服务器上的一个目录，但您在里面做什么`<VirtualHost />`取决于您。

正如我所说，我还必须将 ssl 安装到 Apache 中，以加载我需要以下内容的模块：

```
LoadModule ssl_module libexec/apache/libssl.so
...
AddModule mod_ssl.c 
```

基本上就是这样。如果您需要更多指针，请告诉我。如果您告诉我们您运行的是 Apache 1.3 还是 2.x，也会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T11:28:16.790

不确定这是否是您所追求的，但我过去使用过类似以下内容：

```
<IfModule mod_ssl.c>
    SSLProxyEngine On
    ProxyPreserveHost On
    RewriteRule ^/whatever(.*)$       https://otherhost/whatever$1  [P]
</IfModule> 
```

我需要代理来自另一台主机的安全内容，这就是我们最终使用的。工作正常，现在已经有一段时间了。这是否涵盖了您正在寻找的内容？

# java - JavaFX 和 Java 互操作性

> ID：283637
> 
> 赞同：2
> 
> 时间：2008-11-12T11:12:15.293
> 
> 标签：java, api, interop, javafx

我能否像使用 JavaFX Script 一样直接从 Java 中利用新 JavaFX API 提供的新功能？

所有底层 JavaFX API 是纯 Java 或 JavaFX 脚本还是混合？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-28T11:39:49.030

JavaFX API 是 JavaFX 和 Java 的混合体。SDK 附带一个存档 src.zip，其中包含部分 API（仅包含最基本的类，但缺少 javafx.scene 等内容）。

JavaFX 1.x AFAIK 不正式支持从 Java 调用 JavaFX 代码。[JavaFX 博客](http://blogs.oracle.com/javafx/entry/how_to_use_javafx_in)中有一篇博客文章向您展示了如何使用不受支持的 API 来完成它，但它很复杂，并且在未来的版本中不会以这种方式工作。

从 Java 中使用 JavaFX 有两种受支持的方式。您可以使用 Scripting API 来调用 JavaFX 代码，如[本文](http://java.dzone.com/news/calling-javafx-from-java)所示。或者，恕我直言，这是最优雅的解决方案，使用 JavaFX 编写 API 访问代码，定义 Java 接口以从纯 Java 与您的 JavaFX 代码交互，然后在 JavaFX 中实现这些接口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T20:21:52.317

我们能够成功地使用带有 JavaFX 的多媒体组件。它们完全不受这种方式的支持，并且可能会发生类似于 com.sun 包在 JavaSE 中的变化。

我们将它们集成到 Swing UI 中，并且能够直接通过 Java 完成您可以在 FX 中完成的 MM 工作。

希望他们尽快将其中的一些内容放入核心库中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-04T01:08:53.240

JavaFX 中使用的场景图是开源的。你可以在这里查看（[https://scenegraph.dev.java.net](https://scenegraph.dev.java.net)）。虽然该站点尚未更新以反映 JavaFX 1.x 附带的最终版本，但您仍然可以使用 JavaFX SDK 附带的 jar，并在您的 swing 应用程序中混合场景图和摆动节点。但是，您会遇到一些困难，因为此版本的场景图没有官方 API。

这是一个使用 JavaFX 1.0 附带的场景图的“hello world”。请记住在构建路径中包含“Scenario.jar”。

```
import java.awt.Color;
import java.awt.Paint;
import java.awt.geom.Point2D;

import javax.swing.JFrame;
import javax.swing.SwingUtilities;

import com.sun.scenario.scenegraph.JSGPanel;
import com.sun.scenario.scenegraph.SGGroup;
import com.sun.scenario.scenegraph.fx.FXText;

public class HelloWorldScenario101 implements Runnable {

    /**
     * @param args
     */
    public static void main(String[] args) {
        SwingUtilities.invokeLater(new HelloWorldScenario101());
    }

    public HelloWorldScenario101() {
        //
    }

    @Override
    public void run() {

        this.frame = new JFrame();
        this.panel = new JSGPanel();
        this.text = new FXText();
        this.paint = new Color(255, 0, 0, 255);

        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setTitle("Hello World");
        frame.add(this.panel);
        frame.setContentPane(this.panel);
        scene = new SGGroup();
        this.text.setText("Hello World");
        this.text.setFillPaint(this.paint);
        this.text.setLocation(new Point2D.Float(10, 10));
        this.scene.add(this.text);
        this.panel.setScene(scene);
        frame.pack();
        frame.setLocationByPlatform(true);
        frame.setVisible(true);

    }

    private JFrame frame;

    private JSGPanel panel;

    private SGGroup scene;

    private FXText text;

    private Paint paint;

} 
```

# python - sql查询中的python列表作为参数

> ID：283645
> 
> 赞同：145
> 
> 时间：2008-11-12T11:18:32.270
> 
> 标签：python, sql

我有一个 python 列表，比如 l

```
l = [1,5,8] 
```

我想写一个 sql 查询来获取列表中所有元素的数据，比如说

```
select name from students where id = |IN THE LIST l| 
```

我该如何做到这一点？

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2008-11-12T12:30:10.237

到目前为止，答案是将值模板化为纯 SQL 字符串。这对整数来说绝对没问题，但是如果我们想对字符串这样做，我们就会遇到转义问题。

这是一个使用参数化查询的变体，适用于两者：

```
placeholder= '?' # For SQLite. See DBAPI paramstyle.
placeholders= ', '.join(placeholder for unused in l)
query= 'SELECT name FROM students WHERE id IN (%s)' % placeholders
cursor.execute(query, l) 
```

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2018-04-05T18:51:54.417

最简单的方法是将列表转到`tuple`第一个

```
t = tuple(l)
query = "select name from studens where id IN {}".format(t) 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2016-11-22T09:01:19.750

不要复杂化，解决方案很简单。

```
l = [1,5,8]

l = tuple(l)

params = {'l': l}

cursor.execute('SELECT * FROM table where id in %(l)s',params) 
```

[![在此处输入图像描述](https://i.stack.imgur.com/5Vbsg.png)](https://i.stack.imgur.com/5Vbsg.png)

我希望这有帮助！

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-11-12T11:52:22.827

你想要的 SQL 是

```
select name from studens where id in (1, 5, 8) 
```

如果你想从 python 构造它，你可以使用

```
l = [1, 5, 8]
sql_query = 'select name from studens where id in (' + ','.join(map(str, l)) + ')' 
```

[map](http://docs.python.org/library/functions.html#map)函数会将列表转换为可以使用[str.join](http://docs.python.org/library/stdtypes.html#str.join)方法通过逗号粘合在一起的字符串列表。

或者：

```
l = [1, 5, 8]
sql_query = 'select name from studens where id in (' + ','.join((str(n) for n in l)) + ')' 
```

如果您更喜欢[生成器表达式](http://docs.python.org/glossary.html#term-generator-expression)而不是 map 函数。

更新：[S. Lott](https://stackoverflow.com/users/10661/slott)在评论中提到 Python SQLite 绑定不支持序列。在这种情况下，您可能想要

```
select name from studens where id = 1 or id = 5 or id = 8 
```

生成者

```
sql_query = 'select name from studens where ' + ' or '.join(('id = ' + str(n) for n in l)) 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-12T11:49:37.793

[string.join](http://docs.python.org/library/stdtypes.html#str.join)以逗号分隔的列表值，并使用[格式运算符](http://docs.python.org/library/stdtypes.html#string-formatting)形成查询字符串。

```
myquery = "select name from studens where id in (%s)" % ",".join(map(str,mylist)) 
```

（谢谢，[布莱尔康拉德](https://stackoverflow.com/users/1199/blair-conrad)）

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-11-20T14:35:13.973

我喜欢bobince的回答：

```
placeholder= '?' # For SQLite. See DBAPI paramstyle.
placeholders= ', '.join(placeholder for unused in l)
query= 'SELECT name FROM students WHERE id IN (%s)' % placeholders
cursor.execute(query, l) 
```

但我注意到了这一点：

```
placeholders= ', '.join(placeholder for unused in l) 
```

可以替换为：

```
placeholders= ', '.join(placeholder*len(l)) 
```

如果不那么聪明和不那么笼统，我发现这更直接。这里`l`需要有一个长度（即引用定义`__len__`方法的对象），这应该不是问题。但占位符也必须是单个字符。要支持多字符占位符，请使用：

```
placeholders= ', '.join([placeholder]*len(l)) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2019-12-18T20:56:44.670

如果您将 PostgreSQL 与 Psycopg2 库一起使用，您可以让它的[元组适应](http://initd.org/psycopg/docs/usage.html#tuples-adaptation)为您完成所有转义和字符串插值，例如：

```
ids = [1,2,3]
cur.execute(
  "SELECT * FROM foo WHERE id IN %s",
  [tuple(ids)]) 
```

即只要确保您将`IN`参数作为`tuple`. 如果是，`list`您可以使用[`= ANY`数组语法](https://www.postgresql.org/docs/10/functions-comparisons.html#id-1.5.8.28.16)：

```
cur.execute(
  "SELECT * FROM foo WHERE id = ANY (%s)",
  [list(ids)]) 
```

请注意，这两者都将变成相同的查询计划，因此您应该使用更容易的那个。例如，如果您的列表以元组形式出现，则使用前者，如果它们存储在列表中，则使用后者。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2020-09-23T09:13:33.020

只需使用带有元组函数的内联 if 操作：

```
query = "Select * from hr_employee WHERE id in " % tuple(employee_ids) if len(employee_ids) != 1 else "("+ str(employee_ids[0]) + ")" 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-11-25T04:27:42.647

要从 where 字段在字符串列表（而不是 int）中运行选择，请[根据此问题](https://stackoverflow.com/questions/6741185/add-quotes-to-every-list-element)使用`repr(tuple(map(str, l)))`. 完整示例：

```
l = ['a','b','c']
sql = f'''

select name 
from students 
where id in {repr(tuple(map(str, l)))}
'''
print(sql) 
```

回报： `select name from students where id in ('a', 'b', 'c')`

对于 Oracle 中的日期列表，这有效

```
dates_str = ','.join([f'DATE {repr(s)}' for s in ['2020-11-24', '2020-12-28']])
dates_str = f'({dates_str})'

sql_cmd = f'''
select *
from students 
where 
and date in {dates_str}
''' 
```

回报： `select * from students where and date in (DATE '2020-11-24',DATE '2020-12-28')`

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-11-26T09:16:45.600

@umounted 答案的解决方案，因为它打破了单元素元组，因为 (1,) 不是有效的 SQL。：

```
>>> random_ids = [1234,123,54,56,57,58,78,91]
>>> cursor.execute("create table test (id)")
>>> for item in random_ids:
    cursor.execute("insert into test values (%d)" % item)
>>> sublist = [56,57,58]
>>> cursor.execute("select id from test where id in %s" % str(tuple(sublist)).replace(',)',')'))
>>> a = cursor.fetchall()
>>> a
[(56,), (57,), (58,)] 
```

sql字符串的其他解决方案：

```
cursor.execute("select id from test where id in (%s)" % ('"'+'", "'.join(l)+'"')) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-02-12T09:21:30.550

```
placeholders= ', '.join("'{"+str(i)+"}'" for i in range(len(l)))
query="select name from students where id (%s)"%placeholders
query=query.format(*l)
cursor.execute(query) 
```

这应该可以解决您的问题。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-04-22T22:59:35.127

一个更简单的解决方案：

```
lst = [1,2,3,a,b,c]

query = f"""SELECT * FROM table WHERE IN {str(lst)[1:-1}""" 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-05-26T14:23:25.283

```
l = [1] # or [1,2,3]

query = "SELECT * FROM table WHERE id IN :l"
params = {'l' : tuple(l)}
cursor.execute(query, params) 
```

`:var`符号似乎更简单。(Python 3.7)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-08-18T18:02:23.117

例如，如果您想要 sql 查询：

```
select name from studens where id in (1, 5, 8) 
```

关于什么：

```
my_list = [1, 5, 8]
cur.execute("select name from studens where id in %s" % repr(my_list).replace('[','(').replace(']',')') ) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-06-28T22:08:31.293

这使用参数替换并处理单值列表情况：

```
l = [1,5,8]

get_operator = lambda x: '=' if len(x) == 1 else 'IN'
get_value = lambda x: int(x[0]) if len(x) == 1 else x

query = 'SELECT * FROM table where id ' + get_operator(l) + ' %s'

cursor.execute(query, (get_value(l),)) 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-08-27T16:48:09.603

如果列表中的值数等于 1 或大于 1，这将起作用

```
t = str(tuple(l))
if t[-2] == ',':
   t= t.replace(t[-2],"")
query = "select name from studens where id IN {}".format(t) 
```

# c++ - STL 迁移问题（VS 2003 -> 2005）

> ID：283646
> 
> 赞同：2
> 
> 时间：2008-11-12T11:19:41.207
> 
> 标签：c++, stl, migration, iterator

我刚刚将一个项目从 Visual Studio 2003 转换为 2005，尽管其中大部分都“转换”得很好，但以下行出现了一系列 STL 错误：

```
void SomeFn( std::vector<CSomeObject*>::iterator it,
std::vector<CSomeObject*>::iterator itBegin = NULL,
std::vector<CSomeObject*>::iterator itEnd = NULL ); 
```

Visual Studio 错误如下：

```
c:\<path>\Headerfile.h(20) : error C2440: 'default argument' : cannot convert from 'int' to 'std::_Vector_iterator<_Ty,_Alloc>'
        with
        [
            _Ty=CObject *,
            _Alloc=std::allocator<CObject *>
        ]
        No constructor could take the source type, or constructor overload resolution was ambiguous 
```

我看不出该代码有什么问题，它在 VS 2003 中运行良好。有什么想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-12T11:42:10.677

您的程序不正确，因为 NULL 无法转换为迭代器。我真的不知道您希望将这些迭代器初始化为什么。如果您需要一个保证不在容器中但仍然“有效”的迭代器，您可以使用默认构造函数：

```
typedef std::vector<CSomeObject*> myvector_t;
void SomeFn( myvector_t::iterator it,
             myvector_t::iterator itBegin = myvector_t::iterator(),
             myvector_t::iterator itEnd = myvector_t::iterator() ); 
```

但是请注意，如果您这样做`it`，`itBegin`和`itEnd`将无法以有意义的方式进行比较！只有从给定容器获得的迭代器才有意义。最后，我建议不要对`itBegin`和使用默认值`itEnd`。如果您真的不需要这些，请创建另一个不带参数的函数并做一些有意义的事情。IE：

```
typedef std::vector<CSomeObject*> myvector_t;
void SomeFn( myvector_t::iterator it,
             myvector_t::iterator itBegin,
             myvector_t::iterator itEnd );
void SomeFn( myvector_t::iterator it ); // No begin/end arguments 
```

您的程序的另一个问题是使用向量来存储指针。这真的很不安全。确保在没有先删除元素的情况下从向量中删除元素。您可能还会遇到算法复制对象的问题。最好在向量中使用智能指针。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T11:25:49.290

2003年，`std::vector<T>::iterator`刚刚`T *`。在 2005 年，至少在调试模式下，它是一个类，因此您不能使用`NULL`它的值（`NULL`解析为`0`）。

您可以改用默认构造的迭代器：

```
std::vector<CSomeObject*>::iterator itBegin = std::vector<CSomeObject*>::iterator() 
```

# java - Erlang JInterface - OtpMBox 线程安全吗？

> ID：283652
> 
> 赞同：2
> 
> 时间：2008-11-12T11:23:02.073
> 
> 标签：java, multithreading, erlang, thread-safety, jinterface

在我的 Java 程序中，我创建了一个[OtpNode](http://www.erlang.org/doc/apps/jinterface/java/com/ericsson/otp/erlang/OtpNode.html)和一个“命名的” [OtpMBox](http://www.erlang.org/doc/apps/jinterface/java/com/ericsson/otp/erlang/OtpMbox.html)。每当通过此 mbox 接收到消息时，需要执行一些耗时的操作，然后将回复消息发送回。由于此操作非常耗时，因此不会立即处理发送到 mbox 的后续消息。

所以我想使用 Java 线程——每收到一条消息。我的问题是我是否也应该为收到的每条消息创建一个新的[OtpMBox](http://www.erlang.org/doc/apps/jinterface/java/com/ericsson/otp/erlang/OtpMbox.html)，还是可以在所有线程之间共享原始 OtpMBox？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-21T14:19:58.610

您可以共享 OtpMBox 对象并从多个线程中使用它。这个[关于 jinterface 线程安全的 erlang-questions 线程](http://erlang.org/pipermail/erlang-questions/2008-April/034558.html)讨论了这个问题。

此外，对于纯 Java 特定问题，您可能希望使用[java.util.concurrent 中的 ThreadPoolExecutor](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ThreadPoolExecutor.html)来处理到达的消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-20T07:27:19.783

我不确定我是否理解这个问题。您希望每个线程都有一个 OtpMBox 只是为了能够发送回复，或者这个长时间运行的操作是否必须能够接收更多消息？

如果是前者，您可以重用原来的 mbox。发送操作是同步的。

如果是后者，最好采用 Erlang 方式，为每个线程创建一个 mbox，并让来自 erlang 端的调用者知道它的 pid，以便它可以将数据发送到该 mbox。这是因为 jinterface 没有选择性接收，并且消息将到达首先唤醒的任何线程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T11:18:42.697

我对这些东西不是很熟悉，但我想你可能会做一些计算）你有为每个 java 线程运行 OtpMBox 的开销和控制系统（用 java 编写）的开销，这会要求不同的线程做一些工作和从他们那里得到结果。我相信java不是它的好工具）

你最好做 java-thread 'supervisor'，它将使用 OtpMBox 启动一些（可能是 CPU 数量）数量的 'worker' java-threads 并将 OtpMBox 的 pids 发送到 erlang 系统。

--对不起我的英语

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T02:51:50.823

听起来您正在尝试使用 java 来做 erlang 擅长的事情。安全的轻量级多处理。是否有理由需要使用 java 进行处理，是否可以在 erlang 中完成？或者相反，如果java无论如何都要执行线程，为什么要使用erlang。我认为也许更多信息有助于回答这个问题。

# mysql - Mysql InnoDB 操作系统错误号 32 在 Windows 上的文件操作中

> ID：283661
> 
> 赞同：10
> 
> 时间：2008-11-12T11:26:46.810
> 
> 标签：mysql, innodb

从几天前开始，我的 Windows 机器上的 MySQL 服务器没有成功关闭自己。我在 MySQL 错误日志中发现了这些行的多个实例：

```
InnoDB: Operating system error number 32 in a file operation.
InnoDB: The error means that another program is using InnoDB's files.
InnoDB: This might be a backup or antivirus software or another instance
InnoDB: of MySQL. Please close it to get rid of this error. 
```

我有很多可用空间，服务器安装了几个月，版本是Windows XP SP3上的5.1.22-rc-community-log，并且我只使用一个Windows帐户来创建和执行MySQL服务。

按照 Greg 的回答，我发现`ProcessExplorer`有另一个 MySQL 服务以不同的名称运行。我杀了它，一切都运行良好。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-12T11:31:27.003

如果该文件正在被另一个程序使用，那么[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)可以帮助您追踪哪个程序打开了它。我假设您已经检查过您只运行了一份 MySQL 副本。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-12T11:34:18.447

听起来像是冲突。确保停止 mysqld 服务，然后仔细检查它是否真的不再运行，然后重新启动服务。此外，当它备份时，请务必检查您的桌子，看看是否有任何损坏。

我的假设是基于 MySQL 文档中的[操作系统错误代码](http://dev.mysql.com/doc/refman/5.0/en/operating-system-error-codes.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-06-26T07:48:15.840

您可以按照以下步骤操作：

1.  打开任务管理器
2.  杀死**mysqld.exe**进程。
3.  `cd E:\apps\db\mysql-5.5.25-win32\bin`
4.  跑：`mysqld --install MySQL`
5.  跑：`mysqladmin -u root start`

# c# - 在 C# 2.0 中使用 Console.Write 在同一位置写入字符串

> ID：283669
> 
> 赞同：36
> 
> 时间：2008-11-12T11:31:54.893
> 
> 标签：c#, .net

我在 C# 2.0 中有一个控制台应用程序项目，它需要在 while 循环中向屏幕写入一些内容。我不希望屏幕滚动，因为使用 Console.Write 或 Console.Writeline 方法将继续在控制台屏幕上逐步显示文本，因此它开始滚动。

我想让字符串写在同一个位置。我怎样才能做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-11-12T11:36:12.407

使用[Console.SetCursorPosition](http://msdn.microsoft.com/en-us/library/system.console.setcursorposition.aspx)设置位置。如果您需要先确定它，请使用[Console.CursorLeft](http://msdn.microsoft.com/en-us/library/system.console.cursorleft.aspx)和[Console.CursorTop](http://msdn.microsoft.com/en-us/library/system.console.cursortop.aspx)属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-03-04T19:19:31.090

编写循环进度的函数。您的循环计数器可以用作 x 位置参数。这在第 1 行打印，根据您的需要进行修改。

```
 /// <summary>
    /// Writes a string at the x position, y position = 1;
    /// Tries to catch all exceptions, will not throw any exceptions.  
    /// </summary>
    /// <param name="s">String to print usually "*" or "@"</param>
    /// <param name="x">The x postion,  This is modulo divided by the window.width, 
    /// which allows large numbers, ie feel free to call with large loop counters</param>
    protected static void WriteProgress(string s, int x) {
        int origRow = Console.CursorTop;
        int origCol = Console.CursorLeft;
        // Console.WindowWidth = 10;  // this works. 
        int width = Console.WindowWidth;
        x = x % width;
        try {
            Console.SetCursorPosition(x, 1);
            Console.Write(s);
        } catch (ArgumentOutOfRangeException e) {

        } finally {
            try {
                Console.SetCursorPosition(origRow, origCol);
            } catch (ArgumentOutOfRangeException e) {
            }
        }
    } 
```

# ajax - squid和ajax冲突

> ID：283672
> 
> 赞同：0
> 
> 时间：2008-11-12T11:34:16.717
> 
> 标签：ajax, http, squid

我有一个用户从我们网站上的 ajax 调用中得到错误。

错误粘贴在下面。

他们在 FF3 Windows 中得到错误，但在 IE 中没有。

根据一些搜索，这个问题似乎通常是由客户端协议 squid 引起的（您会在错误末尾注意到，提到了 squid）。

我的 ajax 代码与此处使用的相同：http: [//www.w3schools.com/Ajax/ajax_browsers.asp](http://www.w3schools.com/Ajax/ajax_browsers.asp)

有任何想法吗？

```
ERROR

The requested URL could not be retrieved

While trying to process the request:

POST /library/cart/cart_ajax.php?action=refreshCartWidget&qty=dontuse& HTTP/1.1
Host: mydomain.com
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.3) Gecko/2008092417 Firefox/3.0.3 (.NET CLR 3.5.30729)

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: identity,gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300

Connection: Close
Referer: http://mydomain.com/library

Pragma: no-cache
Cache-Control: no-cache

The following error was encountered:

Invalid Request
Some aspect of the HTTP Request is invalid. Possible problems:

Missing or unknown request method
Missing URL
Missing HTTP Identifier (HTTP/1.0)
Request is too large
Content-Length missing for POST or PUT requests
Illegal character in hostname; underscores are not allowed
Your cache administrator is webmaster. 
Generated Wed, 12 Nov 2008 09:28:58 GMT by ipwal3.osi-tech.com (squid/2.6.STABLE17) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T11:40:01.743

节省一些时间并使用[jQuery](http://jquery.com/)。它对 ajax 有一个抽象，它适用于所有浏览器，而不仅仅是 Internet Explorer，也许还有 FF。;-) 我假设那里的代码很旧并且很长时间没有得到更新。

jQuery中一个简单的ajax调用如下：

```
$.post(
  '/the/url/to/post/to',
  { some: data },
  function(data) { alert(data); }
); 
```

如果您了解 HTTP 的基础知识，它也会有所帮助 - 例如，请求方法 ( `PUT`, `POST`, `GET`, `DELETE`, `HEAD`) 等等。您粘贴的错误意味着`Content-Length`您的请求中缺少标头，并且大多数服务器（如果不是全部）希望在您发出时发送它，`PUT`或者`POST`因为那些被假定为“数据更改”（例如创建、更新）。

也许 IE 会为您添加标题，但 Firefox 显然不会。

jQuery 负责所有这些。;)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T12:15:52.107

如果 FF 不为您执行此操作，您可以在 XHR 对象上使用 .setRequestHeader() 来设置内容长度。

由于您在 .send(content) 方法中发布数据，因此只需在此之前添加一个带有 content.length 的标题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T12:42:59.930

您应该与您的用户坐在一起，并将[Fiddler](http://www.fiddlertool.com/fiddler/) HTTP 跟踪工具放在两者之间。然后您可以轻松比较 IE 和 FF3 发送的请求。

通过这种方式，应该可以看到差异在哪里以及它们导致问题的原因。

# c# - Visual C# 2008 EE SP1 - Linq to SQL - 到远程服务器的数据连接？

> ID：283675
> 
> 赞同：1
> 
> 时间：2008-11-12T11:34:31.550
> 
> 标签：c#, sql-server, visual-studio-2008, linq-to-sql

将我的 Visual C# 2008 Express Edition 升级到 .NET3.5, SP1 后，我无法使用远程连接的数据库创建新的 LINQ to SQL 类。我以前可以做得很好。

我打开一个项目（windows 窗体，类库，相同的行为），然后使用 New -> Linq To SQL classes 方法或直接添加我稍后需要的数据连接，即打开数据库资源管理器并右键单击“添加连接”的数据连接。

然而，这让我只有 3 个选择，MS Access Database File、SQL Server Compact 3.5（在描述中说它也是一个 db 文件）和 Microsoft SQL Server Database File。

当我期望有一种方法可以连接到 f.ex 时，我错过了什么。我的网络上或通过 Internet 上的 SQL Server 2005/2008？

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T11:41:16.123

您无法使用 VS 的 express 版本连接到 SQL 服务器，但您可以使用名为 sqlMetal.exe 的工具从 SQL 服务器生成 dbml，然后您可以将该 dbml 添加到您的项目并传递它生成的数据上下文的连接字符串。

要使用 Open Visual Studio 命令行并键入“Sqlmetal”，它将向您展示如何使用它，更多信息可以在[这里](http://msdn.microsoft.com/en-us/library/bb386987.aspx)找到。

唯一的问题是，一旦生成了 dbml，您就无法将其拖放到 dbml 中，因为您无法在数据库资源管理器中连接到服务器。

# java - 如何从 Java 调用 .NET 代码？

> ID：283679
> 
> 赞同：25
> 
> 时间：2008-11-12T11:36:37.817
> 
> 标签：java, .net, cross-platform

我不是在寻找像 Web 服务这样的常见答案。我正在寻找在同一台机器上运行的轻型解决方案。

编辑：我正在寻找在 Java 中调用 .NET 方法的方法

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-10-31T19:25:51.467

我是[jni4net](http://jni4net.sf.net/)的作者，它是 JVM 和 CLR 之间的开源进程间桥梁。它建立在 JNI 和 PInvoke 之上。无需 C/C++ 代码。我希望它会帮助你。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-12T12:03:50.667

我相信 Java 可以与 COM 对话，而 .NET 可以公开 COM 接口。所以这可能是一个非常轻量级的解决方案，不需要任何第三方。还可以选择使用套接字在不需要在机器上安装大量 IIS 实例的程序之间进行通信。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-12T11:37:16.227

你看过[IKVM](http://www.ikvm.net/)吗？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-12T11:41:34.423

你看过 Java 原生接口吗？

我过去所做的是编写一个 C 库，它可以从 Java 和 .NET（以及 COM、NSIS 脚本语言和其他技术）调用。

如果您只想公开几个方法，JNI 会很好地工作，但如果您想公开整个 .NET 框架，它可能会变得笨拙，因为您需要创建的头文件和包装器方法的数量.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T11:45:36.553

我们在生产环境中尝试了 IKVM，但它一直在崩溃。我们使用 JNBridge，它是一种商业产品，但在我们的 ASP.NET 环境中非常稳定且性能良好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-27T07:14:05.280

如果您愿意在 .NET（或 Mono）下运行 Java 代码，则可以使用[IKVM](http://www.ikvm.net/)来实现。

因为（据我所知）当前的 Java 编译器不读取 .NET 程序集，所以有两个步骤。首先，您需要[生成一个](http://www.ikvm.net/userguide/ikvmstub.html)包含虚拟类和方法的存根 JAR，其中包含您要使用的 .NET 程序集的签名，以便`javac`（或您的 IDE）知道哪些方法可用。例如，如果您想从 Java 使用主 .NET 标准库中的某些内容，请运行

```
ikvmstub mscorlib 
```

生成存根`mscorlib.jar`。（它在 Linux 下自动为我找到了 Mono`mscorlib.dll`程序集，但如果它失败了，您可能必须提供 DLL 的完整路径。）

然后，您可以编写一个使用它的 Java 文件，例如（[基于 IKVM 文档中的示例](http://www.ikvm.net/userguide/ikvmstub.html)）：

```
import cli.System.IO.Directory;
public class IKVMTest {
    public static void main(String[] args) {
        for(String file : Directory.GetFiles(".")) // From .NET standard library
            System.out.println(file);              // From Java standard library
    }
} 
```

请注意，CLI 包以 为前缀`cli.`，因此导入`cli.System`而不是仅`System`.

要编译，请在类路径中包含存根 JAR：

```
javac -classpath mscorlib.jar IKVMTest.java 
```

由于 Java 链接发生在运行时，输出`class`文件使用所需名称和签名的方法，但是当在 IKVM 下运行时，您可以将虚拟存根方法替换为真实的 .NET 方法：

```
ikvm IKVMTest 
```

它将通过调用 .NET 方法打印当前目录中的文件。

# c# - 如何获取 DataGridImageCell 使用的错误图标？

> ID：283692
> 
> 赞同：0
> 
> 时间：2008-11-12T11:41:59.897
> 
> 标签：c#, datagridview, icons

我以两种方式显示一些具有缩略图的对象：一种在 DataGridView 中，另一种在自定义控件中。

在 DataGridView 中，缩略图显示在 DataGridViewImageCell 中。如果缩略图丢失，单元格会显示错误图标。

我也想在我的自定义控件中显示该图标。我如何掌握它？最好没有pinvoke，但乞丐不能选择。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T11:55:55.267

我建议把这个问题放在头上：确保网格**永远不会**显示错误图标。您应该能够通过捕获单元格数据显示事件来做到这一点。如果图像丢失，请显示资源段中的图像（显然，在自定义控件中使用相同的图像）。

尝试匹配网格的内置错误图像的问题在于，如果图像在未来版本中发生更改，您将不得不修改您的应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T11:45:06.333

我想，这个图标在“%visual_studio_directory”\Common7\VS2005ImageLibrary“目录中可用。

# c++ - C 和 C++ 编码标准

> ID：283701
> 
> 赞同：8
> 
> 时间：2008-11-12T11:48:05.237
> 
> 标签：c++, c, standards

关于 C 和 C++ 编码标准的最佳实践是什么？是否应允许开发人员随意将它们混合在一起。链接 C 和 C++ 目标文件时是否有任何复杂情况。

传统上用 C 编写的套接字库之类的东西是否应该保留在 C 中并保存在单独的源文件中？就是将 c 代码保存在 .c 文件中，将 c++ 代码保存在 .cpp 文件中。在用 g++ 解析后混合 c 和 C++ 时会不会有任何性能损失，因为 C 中没有进行类型安全检查？但在 C++ 中。将是链接 C 和 C++ 源代码文件的最佳方式。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-12T11:53:56.863

最大的问题是从 C++ 代码调用 C 函数，反之亦然。在这种情况下，您要确保使用 . 将函数标记为具有“C”链接`extern "C"`。您可以直接使用以下方法在头文件中执行此操作：

```
#if defined( __cplusplus )
extern "C" {
#endif

extern int myfunc( const char *param, int another_one );

#if defined( __cplusplus )
}
#endif 
```

您需要`#if`s 因为包含它的 C 代码将无法理解`extern "C"`。

如果您不想（或不能）更改头文件，可以在 C++ 代码中进行：

```
extern "C" {
#include "myfuncheader.h"
} 
```

您可以以相同的方式将 C++ 函数标记为具有 C 链接，然后您可以从 C 代码中调用它。您不能对重载函数或 C++ 类执行此操作。

除此之外，混合 C 和 C++ 应该没有问题。我们有许多几十年前的 C 函数仍然被我们的 C++ 代码使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T19:33:43.020

人们通常应该假设 c++ 可以抛出异常，因此块中的 c 包装函数应该捕获它们，并将它们转换为 c 调用者可以消化的漂亮错误代码。

```
extern "c"
{
    int nice_c_function_interface
    (
        void
    )
    {
        int returnStatus;

        try
        {
             returnStatus = nice_cpp_function();
        }
        catch (NiceCppException& that)
        {
             returnStatus = that.failure_code();  
        }
        catch (...)
        {
            cerr << "Oh Worse! an unexpected unknown exception" << endl;

            returnStatus = -1;  // Horrible unknown failure
        }

        return returnStatus;
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-12T11:57:16.497

C++ 不会在运行时进行“类型安全检查”，除非您要求（通过使用`dynamic_cast`）。C++ 与 C 高度兼容，因此您可以随意调用 C 库并使用 C++ 编译器编译 C 代码。C++ 并不意味着“面向对象”，您应该不会因为使用它而受到性能损失。

如果您混合使用 gcc 和 g++ 编译的代码，请参阅 Graeme 的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T12:34:42.880

如果您在 C++ 中有一个函数调用 C 中的一个函数，该函数又调用 C++ 中的另一个函数，而后面的函数抛出一个应该被第一个函数捕获的异常，则除非您告诉 C 编译器启用，否则您可能会遇到问题异常处理表的生成。

对于 gcc，这是[`-fexceptions`](http://gcc.gnu.org/onlinedocs/gcc-4.3.2/gcc/Code-Gen-Options.html)参数，默认情况下为 C++ 启用，但默认为 C 禁用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T12:47:45.053

这里没有好的硬性规定。

如果最终产品将始终与 C++ main() 链接，那么这并不重要。因为您总是可以创建可以做正确事情的标题。

如果您正在创建一个需要具有 C 和 C++ 接口但您不能假定 C++ 链接器的库，那么您将需要确保将 C API 与 C++ 完全分离。在这一点上，在 C 中完成所有工作并使用 C++ 类代理到 C 通常更简洁。

例如：

```
/* c header */

struct CData
 { /* stuff */ };

void init( CData* data );
void fini( CData* data );
int getSomething( CData* data );
void doSomething( CData* data, int val );

// c++ header

extern "C" {
#include cdata.h
};

class CppData : private CData
 {
 public:
   CppData() { ::init( (CData*)this ); }
   ~CppData() { ::fini( (CData*)this ); }
   int getSomething() { return ::getSomething( (CData*)this ); }
   void doSomething( int val ) { :: doSomething( (CData*)this, val ); }
 }; 
```

我希望这有帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T12:31:46.490

如果您使用 g++ 编译所有源代码，那么所有源代码都将在 C++ 目标文件中编译（即使用适当的名称 mangling 和 C++ ABI）。

如果您正在构建需要由需要使用 C ABI 的显式 C 应用程序使用的库，则只需要使用 extern "C" 技巧。

如果所有内容都被编译为单个可执行文件，则使用 g++ 并将所有内容视为 C++

# python - 打开文件对象的大小

> ID：283707
> 
> 赞同：71
> 
> 时间：2008-11-12T11:49:46.763
> 
> 标签：python, file, file-io, filesize, tarfile

有没有办法找到当前打开的文件对象的大小？

具体来说，我正在使用 tarfile 模块来创建 tarfile，但我不希望我的 tarfile 超过一定的大小。据我所知，tarfile 对象是类似文件的对象，所以我想一个通用的解决方案会起作用。

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-11-12T11:55:30.307

```
$ ls -la chardet-1.0.1.tgz
-rwxr-xr-x 1 vinko vinko 179218 2008-10-20 17:49 chardet-1.0.1.tgz
$ python
Python 2.5.1 (r251:54863, Jul 31 2008, 22:53:39)
[GCC 4.1.2 (Ubuntu 4.1.2-0ubuntu4)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> f = open('chardet-1.0.1.tgz','rb')
>>> f.seek(0,2)
>>> f.tell()
179218L 
```

将 ChrisJY 的想法添加到示例中

```
>>> import os
>>> os.fstat(f.fileno()).st_size
179218L
>>> 
```

**注意**：根据注释，`f.seek(0, 2)`在调用之前是必须的`f.tell()`，否则它将返回 0 的大小。[原因是`f.seek(0, 2)`将文件对象的位置移动到文件的末尾。](https://stackoverflow.com/questions/283707/size-of-an-open-file-object#comment53321883_283719)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-12T11:59:36.087

好吧，如果文件对象支持tell方法，你可以这样做：

```
current_size = f.tell() 
```

这将告诉您它当前是否正在写入。如果您以顺序方式写入，这将是文件的大小。

否则，您可以使用文件系统功能，即`os.fstat`按照其他人的建议。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-12T11:55:27.407

如果你有文件描述符，你可以用它`fstat`来找出大小，如果有的话。一个更通用的解决方案是寻找文件的末尾，并在那里读取它的位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-08-17T09:07:29.983

另一种解决方案是使用 StringIO “如果您正在执行内存操作”。

```
with open(file_path, 'rb') as x:
    body = StringIO()
    body.write(x.read())
    body.seek(0, 0) 
```

现在`body`的行为类似于具有各种属性的文件对象，例如`body.read()`.

`body.len`给出文件大小。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2022-02-11T10:28:35.910

没有人提到对我来说似乎最简单的方法，即`len()`在阅读后使用该函数：

```
>>> with open("C:\\path\\to\\a\\file.txt", 'rb') as f:
...     f_read = f.read()  
...     print(len(f_read))
... 
36 
```

# mysql - django 模型中的大整数字段

> ID：283724
> 
> 赞同：17
> 
> 时间：2008-11-12T11:59:25.323
> 
> 标签：mysql, django

简而言之：如何在 Django 模型中指定 BIGINT？

在我正在使用 Django（0.97-svn 版本）的当前项目中，我将所有模型中的所有整数字段都定义为 IntegerField。在我使用 SQLite 作为数据库后端的开发周期中，它运行良好。然而，当我开始使用 MySQL 时，我注意到对于其中一个 IntegerFields，MySQL 正在截断数据——显然，由于我仍然不知道的原因，SQLite 没有抱怨。我查看了架构，发现 Django 中的 IntegerField 在 MySQL 中表示为 INT(11) 字段。当然，MySQL 截断数据的原因是数据长度超过 11 位。要解决此问题，我必须手动将列更新为，在本例中为 BIGINT(20)。Django 和 MySQL 与之和平共处。但是每当我重置包含该 BIGINT 的模型的应用程序时，Django 再次将其创建为 INT(11)。我查看了 Django 文档，但没有找到任何东西。我忽略了什么吗？

谢谢。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2010-09-28T11:29:21.327

[BigIntegerField](https://docs.djangoproject.com/en/dev/ref/models/fields/#bigintegerfield)被添加到变更集 11887, 2009-12-17 09:10:38 并且是 Django 1.2 和更新版本的一部分。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-12T12:54:55.897

*SQLite永远*不会抱怨。它使用“清单类型”，即值具有类型，而不是列。它使您可以将 bigtext 存储在 smallint 列上，或者任何您想要的！（除非您定义整数主键，它使用 64 位整数）。

这是一个非常方便的功能，但如果您要使用不同的引擎进行部署，那么它对于开发 SQLite 来说是一个糟糕的选择。

要使用 BIGINT，您必须创建一个自定义字段类。不幸的是，这部分在 Django 1.0 上发生了变化，所以如果/当你更新时，你必须重写它。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-26T16:14:45.343

尝试使用 DecimalField。

# c++ - Windows 下的 GNU C/C++ 内存泄漏检测

> ID：283726
> 
> 赞同：9
> 
> 时间：2008-11-12T11:59:38.693
> 
> 标签：c++, windows, open-source, memory-leaks

哪些内存泄漏检测工具可用于 Windows 上的开源 C/C++？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-12T13:41:38.470

我使用 VLD（[Visual Leak Detector](http://www.codeproject.com/KB/applications/visualleakdetector.aspx)）已经有一段时间了，它适用于好代码，适用于更复杂的代码；这并不完美。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T13:48:23.667

[mem（修订版）](http://teaching.idallen.com/c_programming/mem/)包是检测内存缓冲区溢出、下溢、泄漏、双重删除和悬空引用的有效且直接的工具。

[指向 c.snippets.org 的原始链接，现在无效。](http://c.snippets.org/browser.php?sect=37#37)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T12:00:51.623

对于任何打开或关闭的程序，WinDbg 始终是一个不错的选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T13:21:39.213

泄漏诊断。现在很难找到，但可以[在这里](http://ftp://ftp.microsoft.com/PSS/Tools/Developer%20Support%20Tools/)找到。您可能还想在同一个地方获得 LDGrapher。

# php - 在特定国家/地区添加/删除单词“The”

> ID：283727
> 
> 赞同：0
> 
> 时间：2008-11-12T11:59:55.727
> 
> 标签：php

我花了几个小时试图让我的代码工作，它是 if/else 的老鼠窝。基本上我想根据这两个数组检查一个国家名称：

```
//if its in this array add a 'THE'    
$keywords = array("bahamas","island","kingdom","republic","maldives","netherlands",
                  "isle of man","ivory","philippines","seychelles","usa");
    //if its in this array, take THE off!
    $exceptions = array("eire","hispaniola"); 
```

就是这样。

它让我发疯，老实说，我很尴尬地向你展示我的代码。假设它有 2 个 if 语句、2 个 else 语句和 2 个 foreach 循环。它一团糟，我希望有人可以通过向我展示这样做的好方法来让我傻眼？我希望有一种方法只使用一行代码，或者类似的东西。谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T12:20:16.263

这建立在@sgehrig 的回答之上，但请注意您的例外情况的变化：

```
//if its in this array add a 'THE'    
$keywords = array("bahamas","island","kingdom","republic","maldives","netherlands",
                  "isle of man","ivory","philippines","seychelles","usa");
//if its in this array, take THE off!
$exceptions = array("the eire","the hispaniola");

$countryKey = strtolower($country);
if (in_array($countryKey, $keywords)) {
    $country = 'The ' . $country;
} else if (in_array($countryKey, $exceptions)) {
    $country = substr($country, 4);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T12:08:00.313

```
$countryKey = strtolower($country);
if (in_array($countryKey, $keywords)) {
    $country = 'The' . $country;
} else if (in_array($countryKey, $exceptions) && stripos($country, 'the ') === 0) {
    $country = substr($country, 4);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T12:06:47.197

最简单的方法是将其分为两个步骤，为与第一个列表匹配的国家添加“the”，如果与第二个列表中的单词匹配，则将其删除。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T12:08:05.820

[如果国家/地区名称包含在字符串 ( strpos](http://us.php.net/manual/en/function.strpos.php) )中，为什么要简单测试：

```
",bahamas,island,kingdom,republic,maldives,netherlands,isle of man,ivory,philippines,seychelles,usa," 
```

（注意开头和结尾的'，'）

它比正则表达式更快：如果您的“，国家名称”是该字符串，则添加“THE”，否则将其删除。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T12:09:10.297

我相信你正在寻找这样的东西：

```
if(in_array($country, $keywords)) {
    // add 'the'
} elseif(in_array($country, $exceptions)) {
    // remove 'the'
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T12:19:14.177

in_array() 是你的朋友。无需为它循环。

# networking - 通过 Telnet 运行应用程序

> ID：283728
> 
> 赞同：2
> 
> 时间：2008-11-12T12:00:46.833
> 
> 标签：networking, telnet, dos

我需要创建一个 BAT 文件来通过 telnet 运行应用程序，但据我所知，在 DOS 上没有办法做到这一点。Telnet 不允许在连接的那一刻向远程机器发送任何命令，BAT 文件中的每个后续命令只有在 telnet 停止后才会执行。这段假设的代码说明了我想要做什么：

```
telnet 100.99.98.1 "C:\Application\app.exe -a -b -c" 
```

这将使用三个参数在机器 100.99.98.1 上运行 app.exe。尽管我努力，但没有任何效果。有没有办法做到这一点？

谢邀，

佩德林·巴蒂斯塔

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T12:09:14.210

你有没有尝试过：

```
echo "c:\application\app.exe -a -b -c" | telnet 100.99.98.1 
```

但是，如果远程 telnet 服务器需要用户名和密码，这将不起作用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T12:10:16.283

由于您的路径，我假设您在 Windows 平台上工作。我建议查看 Microsoft/SysInternals 的[PsExec](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)，它允许您在远程机器上执行命令。

[PsExec](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)是Mark Russinovich提供的出色的免费[PsTools软件包的一部分。](http://technet.microsoft.com/en-us/sysinternals/bb896649.aspx)SysInternals 最近被 Microsoft 收购，但这些工具仍然免费。

但是，这不适用于 Internet。它使用 Windows 网络端口 445，并且只能在本地网络上使用。如果您需要，我建议使用 SSH。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T12:07:30.923

以您想要的方式使用 telnet 是不可能的。

您可以保护 shell (ssh)，但 ssh 服务器必须在远程机器上运行（在您的情况下为 100.99.98.1）。

编辑：

有关Windows 的 ssh 客户端和服务器（基于 cygwin），请参见[http://sshwindows.sourceforge.net/ 。](http://sshwindows.sourceforge.net/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T12:10:52.883

您是否尝试过以下操作？

```
telnet 100.99.98.1 <someScript 
```

someScipt 有你的命令，例如，`C:\Application\app.exe -a -b -c`

你看过Windows的[Remote Shell 守护进程吗？](http://sourceforge.net/projects/rshd/)这可能比 telnet 好很多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T12:11:19.013

试一试[_](http://expect.nist.gov/#windows) _

从网页：

> Expect 是一个用于自动化交互式应用程序的工具，例如 **telnet**、ftp、passwd、fsck、rlogin、tip 等。Expect 确实让这些东西变得微不足道。Expect 也可用于测试这些相同的应用程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T12:08:12.763

您的 telnet 应用程序是否需要在命令窗口中运行，或者您只需要从命令行*启动它？*如果您想“启动并忘记”，您可以考虑使用可编写脚本的终端程序，例如免费的 TeraTerm。您可以使用命令从命令行启动它，`start`并让它在后台执行脚本。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T12:34:47.577

您可能会考虑使用[Cygwin](http://www.cygwin.com/)（它提供了在 Windows 上运行的类似 Linux/Unix 的命令行环境）。包括 shell 脚本在内的各种标准工具可作为 Cygwin 的一部分使用。

# asp.net - 在 IE7 中使用 Server.CreateObject("ADODB.Stream")

> ID：283737
> 
> 赞同：0
> 
> 时间：2008-11-12T12:05:37.807
> 
> 标签：asp.net, vb.net, internet-explorer-7, adodb, .net-1.1

我有一个 ASP.NET 1.1 应用程序，它使用以下代码在响应中写出一个文件：

```
Dim objStream As Object
objStream = Server.CreateObject("ADODB.Stream")
objStream.open()
objStream.type = 1
objStream.loadfromfile(localfile)
Response.BinaryWrite(objStream.read) 
```

此代码由显示此文件或在 Internet Explorer 中提供打开/保存对话框的弹出窗口调用。问题是，它在 IE6 中似乎工作正常，但在 IE7 中，弹出窗口打开然后关闭而不显示文件。有谁知道怎么了？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-29T21:05:24.043

我有这样的代码用于从服务器下载文件：

```
strFilename = Server.MapPath("/App_Upload/" & strFilename)   

With Response
   .AddHeader("Content-Type", "binary/octet-stream")
   .AddHeader("Content-Disposition", "attachment; filename=" & strFilename & ";")
    .WriteFile(strFilename)
    .End()
End With 
```

试试你的情况。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-14T00:02:56.887

因此，Asp.Net 提供的图像是 tiff 文件。它[在这里](http://forums.asp.net/p/1113169/2332853.aspx#2332853)说 IE7 由于某种原因不显示具有 4 个字母扩展名的文件。我想我会尝试将其更改为 3 个字母，看看会发生什么。

# php - Zend 框架；让控制器使用不同的查看器

> ID：283740
> 
> 赞同：5
> 
> 时间：2008-11-12T12:07:01.640
> 
> 标签：php, zend-framework

我正在使用 Zend 框架。

我有一个名为“UserController”的控制器，它有一个公共函数 displayAction()。

我想知道如何让该操作方法使用与默认 display.phtml 不同的查看器。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-12T12:23:04.480

您可以使用

```
$this->render('actionName'); 
```

或者，您可以通过调用直接调用视图脚本

```
$this->renderScript('path/to/viewscript.phtml'); 
```

有关更多信息，您可以查看[http://framework.zend.com/manual/en/zend.controller.actionhelpers.html](http://framework.zend.com/manual/en/zend.controller.actionhelpers.html)，特别是关于`render()`和`renderScript()`方法的部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-06T08:25:43.973

最近，我在使用上述方法时遇到了错误（使用 ZF 1.11.11）。我在这方面取得了成功：

```
$this->_helper->viewRenderer('action'); 
```

# vb.net - VB.NET 'With' 声明 - 接受还是避免？

> ID：283749
> 
> 赞同：72
> 
> 时间：2008-11-12T12:09:32.713
> 
> 标签：vb.net, with-statement

在工作中，我经常从事一些项目，在这些项目中，某些对象的许多属性必须在其构建期间或在其生命周期的早期进行设置。为了方便和可读性，我经常使用`With`语句来设置这些属性。我发现

```
With Me.Elements
    .PropertyA = True
    .PropertyB = "Inactive"
    ' And so on for several more lines
End With 
```

看起来比

```
Me.Elements.PropertyA = True
Me.Elements.PropertyB = "Inactive"
' And so on for several more lines 
```

对于仅设置属性的非常长的语句。

我注意到`With`在调试时使用存在一些问题；但是，**我想知道是否有任何令人信服的理由避免`With`在实践中**使用？我一直认为通过编译器为上述两种情况生成的代码基本相同，这就是为什么我总是选择编写我觉得更具可读性的代码。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-11-12T12:38:30.860

如果您的变量名很长并且最终会得到：

```
UserHandler.GetUser.First.User.FirstName="Stefan"
UserHandler.GetUser.First.User.LastName="Karlsson"
UserHandler.GetUser.First.User.Age="39"
UserHandler.GetUser.First.User.Sex="Male"
UserHandler.GetUser.First.User.Occupation="Programmer"
UserHandler.GetUser.First.User.UserID="0"
....and so on 
```

然后我会使用 WITH 使其更具可读性：

```
With UserHandler.GetUser.First.User
    .FirstName="Stefan"
    .LastName="Karlsson"
    .Age="39"
    .Sex="Male"
    .Occupation="Programmer"
    .UserID="0"
end with 
```

在后面的示例中，甚至比第一个示例具有性能优势，因为在第一个示例中，我每次访问用户属性时都会获取用户，而在 WITH 情况下，我只获取用户一次。

我可以在不使用 with 的情况下获得性能提升，如下所示：

```
dim myuser as user =UserHandler.GetUser.First.User
myuser.FirstName="Stefan"
myuser.LastName="Karlsson"
myuser.Age="39"
myuser.Sex="Male"
myuser.Occupation="Programmer"
myuser.UserID="0" 
```

但我会选择 WITH 语句，它看起来更干净。

我只是以此为例，所以不要抱怨一个有很多关键字的类，另一个例子可能是： WITH RefundDialog.RefundDatagridView.SelectedRows(0)

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-12T14:22:04.943

在实践中，没有真正令人信服的观点反对它。我不是粉丝，但这是个人喜好，没有经验数据表明该`With`结构不好。

在 .NET 中，它编译为与完全限定对象名称完全相同的代码，因此这种糖没有性能损失。我通过编译然后反汇编以下 VB .NET 2.0 类来确定这一点：

```
Imports System.Text

Public Class Class1
    Public Sub Foo()
        Dim sb As New StringBuilder
        With sb
            .Append("foo")
            .Append("bar")
            .Append("zap")
        End With

        Dim sb2 As New StringBuilder
        sb2.Append("foo")
        sb2.Append("bar")
        sb2.Append("zap")
    End Sub
End Class 
```

反汇编如下 - 请注意，对`sb2`'`Append`方法的调用看起来与`With`语句调用相同`sb`：

```
.method public instance void  Foo() cil managed
{
  // Code size       91 (0x5b)
  .maxstack  2
  .locals init ([0] class [mscorlib]System.Text.StringBuilder sb,
           [1] class [mscorlib]System.Text.StringBuilder sb2,
           [2] class [mscorlib]System.Text.StringBuilder VB$t_ref$L0)
  IL_0000:  nop
  IL_0001:  newobj     instance void [mscorlib]System.Text.StringBuilder::.ctor()
  IL_0006:  stloc.0
  IL_0007:  ldloc.0
  IL_0008:  stloc.2
  IL_0009:  ldloc.2
  IL_000a:  ldstr      "foo"
  IL_000f:  callvirt   instance class [mscorlib]System.Text.StringBuilder [mscorlib]System.Text.StringBuilder::Append(string)
  IL_0014:  pop
  IL_0015:  ldloc.2
  IL_0016:  ldstr      "bar"
  IL_001b:  callvirt   instance class [mscorlib]System.Text.StringBuilder [mscorlib]System.Text.StringBuilder::Append(string)
  IL_0020:  pop
  IL_0021:  ldloc.2
  IL_0022:  ldstr      "zap"
  IL_0027:  callvirt   instance class [mscorlib]System.Text.StringBuilder [mscorlib]System.Text.StringBuilder::Append(string)
  IL_002c:  pop
  IL_002d:  ldnull
  IL_002e:  stloc.2
  IL_002f:  newobj     instance void [mscorlib]System.Text.StringBuilder::.ctor()
  IL_0034:  stloc.1
  IL_0035:  ldloc.1
  IL_0036:  ldstr      "foo"
  IL_003b:  callvirt   instance class [mscorlib]System.Text.StringBuilder [mscorlib]System.Text.StringBuilder::Append(string)
  IL_0040:  pop
  IL_0041:  ldloc.1
  IL_0042:  ldstr      "bar"
  IL_0047:  callvirt   instance class [mscorlib]System.Text.StringBuilder [mscorlib]System.Text.StringBuilder::Append(string)
  IL_004c:  pop
  IL_004d:  ldloc.1
  IL_004e:  ldstr      "zap"
  IL_0053:  callvirt   instance class [mscorlib]System.Text.StringBuilder [mscorlib]System.Text.StringBuilder::Append(string)
  IL_0058:  pop
  IL_0059:  nop
  IL_005a:  ret
} // end of method Class1::Foo 
```

因此，如果您喜欢它，并且发现它更具可读性，那就去吧；没有令人信服的理由不这样做。

（顺便说一句，[汤姆](https://stackoverflow.com/users/20/tom)，我很想知道调试器发生了什么——我不记得在调试器中看到过任何基于`With`语句的异常行为，所以我很想知道你看到了什么行为.)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-08-17T11:01:18.323

使用 With 和对对象进行重复引用是有区别的，这很微妙，但我认为应该牢记在心。

当使用 WITH 语句时，它会创建一个引用该对象的新局部变量。使用 .xx 的后续引用是对该本地引用的属性的引用。如果在 WITH 语句的执行过程中，原来的变量引用发生了变化，那么 WITH 引用的对象并没有改变。考虑：

```
Dim AA As AAClass = GetNextAAObject()
With AA
    AA = GetNextAAObject()

    '// Setting property of original AA instance, not later instance
    .SomeProperty = SomeValue
End With 
```

因此，WITH 语句不仅仅是语法糖，它真正是一个不同的结构。虽然您不太可能像上面那样编写明确的代码，但在某些情况下，这可能会无意中发生，因此您应该注意这个问题。最可能的情况是，您可能正在遍历诸如对象网络之类的结构，其互连可以通过设置属性隐式更改。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-04-05T13:09:34.267

这都是关于可读性的。像所有语法糖一样，它可以被**过度使用**。

**如果您在几行上设置对象的多个成员，请**拥抱它****

 **```
With myObject
  .Property1 = arg1
  .Property2 = arg2
... 
```

**避免**用“With”做任何其他事情

如果您编写的 With 块跨越 50-100 行并涉及许多其他变量，则可能很难记住在块顶部声明的内容。出于显而易见的原因，我不会提供这种混乱代码的示例

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-12T12:24:01.810

如果它使代码真正更具可读性，那就去做吧。如果它使其可读性*降低*，请避免使用它 - 特别是，我建议您避免嵌套 With 语句。

C# 3.0 具有此功能，仅用于对象初始化：

```
var x = new Whatever { PropertyA=true, PropertyB="Inactive" }; 
```

这不仅是 LINQ 非常需要的，而且在语法不表示代码异味的地方也很有意义。我通常发现，当我对一个对象执行超出其初始构造的许多不同操作时，这些操作应该被封装为对象本身的单个操作。

关于你的例子的一个注释 - 你真的需要“我”吗？为什么不直接写：

```
PropertyA = True
PropertyB = "Inactive" 
```

? 当然，在这种情况下，“我”是隐含的……

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-12T12:55:33.197

我会怀疑使用大量 this 关键字的代码：如果它用于更容易设置大量实例变量或属性，我认为这可能表明您的类太大（大类[气味](http://en.wikipedia.org/wiki/Code_smell)）。如果您使用它来替换像这样的长链调用：

```
UserHandler.GetUser.First.User.FirstName="Stefan"
UserHandler.GetUser.First.User.LastName="Karlsson"
UserHandler.GetUser.First.User.Age="39"
UserHandler.GetUser.First.User.Sex="Male"
UserHandler.GetUser.First.User.Occupation="Programmer"
UserHandler.GetUser.First.User.UserID="0" 
```

那么你可能违反[了德米特法则](http://www.ccs.neu.edu/home/lieber/LoD.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-12T14:09:48.260

我不使用 VB.NET（我曾经使用普通的 VB）但是......

前导点是强制性的吗？如果是这样，那么我认为没有问题。在 Javascript 中，使用的结果`with`是对象的属性看起来与普通变量一样，*这*是非常危险的，因为您看不到您是在访问属性还是变量，因此`with`，要避免的事情。

它不仅使用起来更容易，而且对于重复访问对象的属性，它可能会更快，因为对象仅通过方法链获取一次，而不是每个属性一次。

我确实同意您应该避免嵌套使用的其他回复，原因与在 Javascript 中完全避免使用的`with`原因相同`with`：因为您不再看到您的属性属于哪个对象。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-11-12T15:31:10.273

“with”基本上是 Smalltalk 的“级联”。它是 Kent Beck 的 Smalltalk Best Practice Patterns 书中的一个模式。

模式总结：在对发送给对象的消息进行分组时使用它。如果恰好是一些消息发送到同一个对象，请不要使用它。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-09-24T15:45:37.427

**不惜一切代价避免*使用 WITH 块***（甚至是可读性）。两个原因：

1.  [Microsoft 关于 With...End With](https://msdn.microsoft.com/en-us/library/wc500chb.aspx)的文档说，在某些情况下，它会在堆栈上创建数据的副本，因此您所做的任何更改都将被丢弃。
2.  如果将其用于 LINQ 查询，则 lambda 结果不会链接，因此每个中间子句的结果都会被丢弃。

为了描述这一点，我们有一个教科书中的（破碎的）示例，我的同事不得不向作者询问（这确实不正确，名称已被更改以保护......无论如何）：

> With dbcontext.Blahs
> .OrderBy(Function(currentBlah) currentBlah.LastName)
> .ThenBy(Function(currentBlah) currentBlah.FirstName)
> .Load()
> 以

OrderBy 和 ThenBy 完全**没有效果**。如果您仅通过删除 With 和 End With 来重新格式化代码，并在前三行的末尾添加行继续字符......它可以工作（如同一教科书*后面的 15 页所示）。*

我们不再需要任何理由来*搜索和销毁*WITH 块。它们只在**解释**框架中有意义。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-08-17T14:39:48.467

将它与结构一起使用时有一个问题，也就是您无法设置它们的字段，因为您正在处理“with”表达式的本地副本（在进入块时制作）而不是使用（副本a) 在这种情况下的对象引用：

> objectExpression 的数据类型可以是任何类或结构类型，甚至可以是 Visual Basic 基本类型，例如 Integer。如果 objectExpression 生成的不是对象，则只能读取其成员的值或调用方法，如果尝试将值分配给 With...End With 语句中使用的结构的成员，则会出现错误。如果您调用一个返回结构并立即访问并将值分配给函数结果成员的方法（例如 GetAPoint().x = 1），您将遇到相同的错误。这两种情况下的问题是结构仅存在于调用堆栈上，在这些情况下，修改后的结构成员无法写入某个位置，以便程序中的任何其他代码都可以观察到更改。
> 
> objectExpression 在进入块时被评估一次。您不能从 With 块中重新分配 objectExpression。

[https://docs.microsoft.com/en-us/dotnet/visual-basic/language-reference/statements/with-end-with-statement](https://docs.microsoft.com/en-us/dotnet/visual-basic/language-reference/statements/with-end-with-statement)

猜测如果你将结构名称而不是返回结构的表达式传递给 with 语句，编译器可能会更聪明一点，但似乎不是

# php - PHP用下划线替换空格

> ID：283751
> 
> 赞同：18
> 
> 时间：2008-11-12T12:10:36.003
> 
> 标签：php

我有一个问题，PHP 用下划线替换 POST 和 GET 变量中的所有空格。

例如，如果我有 URL：`http://localhost/proxy.php?user name=Max` 浏览器会将其转换为`http://localhost/proxy.php?user%20name=Max`.

但是如果我给出 $_GET 参数，关键不是`user name`但是`user_name`（注意下划线）！

有没有可能改变这种行为？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-12T12:21:33.343

从[PHP 手册](http://www.php.net/manual/en/language.variables.external.php)：

> 传入变量名中的点
> 
> 通常，PHP 在将变量传递到脚本时不会更改它们的名称。但是，应该注意点（句点、句号）不是 PHP 变量名中的有效字符。究其原因，请看：
> 
> ```
> <?php $varname.ext;  /* invalid variable name */ ?> 
> ```
> 
> 现在，解析器看到的是一个名为 $varname 的变量，后跟字符串连接运算符，然后是裸字符串（即不匹配任何已知键或保留字的未加引号的字符串）'ext'。显然，这并没有达到预期的结果。
> 
> 出于这个原因，重要的是要注意 PHP 会自动将传入变量名中的任何点替换为下划线。

并在页面上发表评论：

> PHP 转换为 _（下划线）的字段名称字符的完整列表如下（不仅仅是点）：
> 
> ```
> chr(32) ( ) (space)
> chr(46) (.) (dot)
> chr(91) ([) (open square bracket)
> chr(128) - chr(159) (various) 
> ```
> 
> PHP 不可逆地修改包含这些字符的字段名称，以保持与已弃用的 register_globals 功能的兼容性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-27T12:25:19.490

我认为获得所需参数的唯一可能性是使用以下方法自行解析它们`$_SERVER['QUERY_STRING']`：

```
$a_pairs = explode('&', $_SERVER['QUERY_STRING']);
foreach($a_pairs AS $s_pair){
  $a_pair = explode('=', $s_pair);
  if(count($a_pair) == 1) $a_pair[1] = '';

  $a_pair[0] = urldecode($a_pair[0]);
  $a_pair[1] = urldecode($a_pair[1]);

  $GLOBALS['_GET'][$a_pair[0]] = $a_pair[1];
  $_GET[$a_pair[0]] = $a_pair[1];
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-12T12:24:22.700

在过去疯狂的 register_globals 查询字符串被 PHP 解包到全局变量中，但是变量标识符的格式受到限制，所以显然空格不能工作。这种限制仍然存在，老实说，我相信保持这种方式是个好主意。

如果您确实无法将 URL 中的空格更改为下划线，只需在处理请求时修改 $_GET 数组并将每个下划线替换为空格即可。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T12:20:21.053

据我记得，我从未在 URL 参数名称中看到空格...

我认为，将参数名称的所有空格转换为“_”会更好。

# http - “刷新”HTTP 标头

> ID：283752
> 
> 赞同：74
> 
> 时间：2008-11-12T12:10:38.547
> 
> 标签：http, http-headers

我正在自动化一个 Web 应用程序（Mantis 错误跟踪器），我从中得到了一个有趣的响应标头，称为 Refresh：

```
HTTP/1.x 200 OK
...
Refresh: 0;url=my_view_page.php 
```

它的行为方式似乎与[元刷新](http://en.wikipedia.org/wiki/Meta_refresh)相同，元刷新技术意味着它相当于 HTTP 中的标头。

[问题是，我在HTTP 标准](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)或任何其他关于如何解析它以及浏览器遇到它时应该做什么的权威文档中找不到任何提及 Refresh 标头的内容。

这里发生了什么？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-11-12T12:27:26.983

据我所知，Refresh（连同 Set-Cookie 和可能的其他一些专有伪标头）是由 Netscape 在 Internet 的早期创建的，并且从那时起基本上（但不完全是）标准。因为几乎所有浏览器都支持它，所以 Refresh 使用起来非常安全——而且通常也是如此。

我猜它从未成为官方标准的一部分，因为他们已经通过状态代码对此做出了规定。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-12T12:20:11.973

来自 W3C HTML 4.01 规范，引用：

> META 和 HTTP 标头
> 
> http-equiv 属性可以用来代替 name 属性，并且在通过超文本传输​​协议 (HTTP) 检索文档时具有特殊意义。HTTP 服务器可以使用 http-equiv 属性指定的属性名称在 HTTP 响应中创建 [RFC822] 样式的标头。有关有效 HTTP 标头的详细信息，请参阅 HTTP 规范 ([RFC2616])。

这意味着当您使用`<meta http-equiv="refresh" url="..."/>`标签时，您实际上是在指示浏览器像`Refresh`发送标头一样行事。

可以在[http://www.securiteam.com/securityreviews/6Z00320HFQ.html找到它的历史的一个很好的概述](http://www.securiteam.com/securityreviews/6Z00320HFQ.html)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-12T12:28:53.440

根据[维基百科： URL 重定向](http://en.wikipedia.org/wiki/URL_redirection#Refresh_Meta_tag_and_HTTP_refresh_header)：

> 这是 Netscape 的专有/非标准扩展。大多数网络浏览器都支持它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-12T12:29:05.060

我相信它最初是一个 Netscape 扩展，并没有标准化，因为它已被 W3C 弃用：

[http://www.w3.org/TR/WCAG10-HTML-TECHS/#meta-element](http://www.w3.org/TR/WCAG10-HTML-TECHS/#meta-element)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-12-04T00:27:19.970

“刷新”HTTP 响应标头已在 HTML 中标准化（无论如何对于 Web 浏览器）：

[https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigating-across-documents%3Ashared-declarative-refresh-steps](https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigating-across-documents%3Ashared-declarative-refresh-steps)

该 URL 看起来不太稳定，因此以下是截至 2019-12-03 的相关步骤：

> 13.  如果*响应*有`Refresh`标头，则：
>     1.  令*value*为 header 的 value 的同构解码。
>     2.  *使用document*和*value*运行共享的声明性刷新步骤。

# delphi - 在 Delphi 2009 中将字符串转换为 PAnsiChar

> ID：283759
> 
> 赞同：27
> 
> 时间：2008-11-12T12:14:09.583
> 
> 标签：delphi, delphi-2009

我正在将我的应用程序转换为 Delphi 2009，并遇到了一些需要将字符串（宽）转换为 AnsiString 的调用的有趣问题。

这是一个示例来演示我遇到的问题：

```
var
  s: PAnsiChar;

...

s := PAnsiChar(Application.ExeName); 
```

对于 Delphi 2007 和以前的版本， s := PChar(Application.ExeName) 将返回应用程序 exe 路径。

使用 Delphi 2009，s := PAnsiChar(Application.ExeName) 仅返回“E”。

我的猜测是因为我正在将 unicode 字符串转换为 ansi 字符串，但我如何转换它以便 PAnsiChar 获得完整的字符串？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-12T12:19:27.030

我这里没有Delphi 2009，所以无法查看。但也许你必须尝试：

```
s := PAnsiChar(AnsiString(Application.ExeName)); 
```

正如 gabr 已经指出的那样，这不是一个很好的做法，只有在 100% 确定时才会使用它。该字符串仅包含直接映射到 ANSI 范围的字符。

这就是您应该收到警告的原因，因为您正在将 Unicode 转换为 ANSI。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-02-25T20:20:16.743

而不是使用 type `String`，使用`RawByteString`：

```
s: RawByteString;

s := LoadSomeRegularString(usually a string type);

PAnsiChar(s) <<< all fine. 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T13:10:00.190

Gamecat 显式转换有效。我在下面更详细地解释了这个问题，以便有人可以指出更好的解决方案。

我正在使用以下函数来检索应用程序编译日期：

```
function LinkerTimeStamp(const FileName: string): TDateTime;
var
  LI: TLoadedImage;
begin
  {$IFDEF UNICODE}
  Win32Check(MapAndLoad(PAnsiChar(AnsiString(FileName)), nil, @LI, False, True));
  {$ELSE}
  Win32Check(MapAndLoad(PChar(FileName), nil, @LI, False, True));
  {$ENDIF}
  Result := LI.FileHeader.FileHeader.TimeDateStamp / SecsPerDay + UnixDateDelta;
  UnMapAndLoad(@LI);
end; 
```

MapAndLoad 需要一个 PAnsiChar 作为 ImageName 参数，所以我需要转换 unicode 字符串。是否有任何其他替代方法可以先显式转换为 AnsiString？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T12:37:12.500

[WideCharToMultiByte](http://msdn.microsoft.com/en-us/library/ms776420%5C(VS.85%5C).aspx)可以帮助你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T13:20:21.053

我有同样的问题。`PAnsiChar`唯一指向第一个字符。我编写了以下函数来处理旧功能。

```
// This function converts a string to a PAnsiChar
// If the output is not the same, an exception is raised
// Author: nogabel@hotmail.com

function StringToPAnsiChar(stringVar : string) : PAnsiChar;
Var
  AnsString : AnsiString;
  InternalError : Boolean;
begin
  InternalError := false;
  Result := '';
  try
    if stringVar <> '' Then
    begin
       AnsString := AnsiString(StringVar);
       Result := PAnsiChar(PAnsiString(AnsString));
    end;
  Except
    InternalError := true;
  end;
  if InternalError or (String(Result) <> stringVar) then
  begin
    Raise Exception.Create('Conversion from string to PAnsiChar failed!');
  end;
end; 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-20T11:34:44.930

我觉得你有点过分了。每个 Win32 API 函数都有一个对应的 unicode，如果它需要一个字符串的话。尝试**MapAndLoadW**而不是**MapAndLoad** ...

# c# - 如何对按字母顺序排列的 File.ReadAllLines 返回的数组进行排序？

> ID：283763
> 
> 赞同：1
> 
> 时间：2008-11-12T12:15:13.590
> 
> 标签：c#

我正在读取一个 .csv 文件并在字符串数组中返回它的行。成员之一是制造商，我有丰田、福特等。

我想按制造商的值和字母顺序对行的数组（可以是另一个集合）进行排序。

所以我有：

```
28437 Ford Fiesta
328   Honda Civic
34949 Toyota Yaris 
```

等等……

使用 C# 而没有数据库的最佳方法是什么？我说没有数据库，因为我可以将 csv 插入到 sql server 数据库中的表中，然后查询它并返回数据。但是这些数据会进入一个动态构建的 html 表，这会使数据库方法有点冗长。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T12:18:45.253

您使用的是哪个版本的 .NET？如果您使用的是 3.5 - 或者可以使用 C# 3.0 和[LINQBridge](http://www.albahari.com/nutshell/linqbridge.aspx) - 那么我肯定会使用 LINQ。首先将每一行转换为一些适当的对象，然后使用 OrderBy：

```
var cars = lines.Select(line => Car.ParseLine(line))
                .OrderBy(car => car.Manufacturer); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T12:48:05.443

如果数组中只有一堆字符串，请使用

```
Array.Sort(myArray) 
```

这将按字母顺序（区分大小写）将字符串放在“myArray”中。

如果您想进行不同的比较（例如不区分大小写），您可以定义自己的 ICcomparer 或使用 Linq-Extensions，最好使用 lambda 表达式，例如

```
 string [] sArray = new string[] { "fsdhj", "FA", "FX", "fxx", "Äbc" };
        sArray = sArray.OrderBy(s => s.ToLowerInvariant()).ToArray(); 
```

还有一大堆其他排序方法，但这些是最基本的。如果我更好地理解您的输入对象的外观，我可以为您的问题提供更详细的答案。只要它只是一个字符串数组，您应该可以接受上述内容。

在回应下面的前两条评论时，我还应该注意到上面给出的不变字符串排序方法并不是该特定工作的最佳方法（见评论）。

然而，它**确实**说明了扩展方法与 lambda 表达式的使用，这在您没有预定义的 IComparer 类的情况下非常方便。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T12:48:31.543

在不尝试第二次猜测 Jon 的情况下，我相信他建议您创建一个具有必要属性的类 Car（“一些适当的对象”），并能够从一行中填充 Car：

```
public class Car
{
    public int Id {get;set;}
    public string Manufacturer {get;set;}
    public string Model {get;set;}

    public static Car ParseLine(string line)
    {
        string[] parts = line.Split(DELIMITER);
        return new Car
        {
            Id = int.Parse(parts[0]),
            Manufacturer = parts[1],
            Model = parts[2]
        };
    }
} 
```

即将线条视为对象。然后使用 LINQ 事情变得非常简单：

```
 var query = from line in lines
                    let car = Car.ParseLine(line)
                    orderby car.Manufacturer
                    select car;

        var arr = query.ToArray(); 
```

请注意，您也可以在没有 LINQ 的情况下执行此操作，例如（使用`Car[]`数组） - 就地数组排序：

```
 Array.Sort(arr, (x, y) => string.Compare(x.Manufacturer, y.Manufacturer)); 
```

或与以下内容相同`List<Car>`：

```
 list.Sort((x, y) => string.Compare(x.Manufacturer, y.Manufacturer)); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T12:52:19.553

在 Jon 的帖子中，他首先将行解析为对象，然后进行排序。您也可以根据字符串的一部分对字符串的 IEnumerable 列表进行排序。这是一个在子字符串上对列表进行排序的示例（从位置 6 开始的前 10 个字符）：

```
List<string> lines = new List<string>
    {
        "34949 Toyota Yaris",
        "328   Honda Civic",
        "28437 Ford Fiesta"
    };

var sortedLines = lines.OrderBy(line => line.Substring(6, 10));
// Or make it case insensitive
// var sortedLines = lines.OrderBy(line => line.Substring(6, 10), StringComparer.InvariantCultureIgnoreCase);

foreach (var line in sortedLines)
{
    Console.WriteLine(line);
} 
```

# sql - 在 SQL 中查找某人的年龄

> ID：283764
> 
> 赞同：9
> 
> 时间：2008-11-12T12:15:37.053
> 
> 标签：sql, sql-server, tsql

在 SQL Server 数据库中，我记录了人们的出生日期。是否有一种直接的方法可以仅使用 SQL 计算出该人在给定日期的年龄？

使用**DATEDIFF(YEAR, DateOfBirth, GETDATE())**不起作用，因为这只查看日期的年份部分。例如**DATEDIFF(YEAR, '31 December 2007', '01 January 2008')**返回 1。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-12T12:21:07.527

查看这篇文章：[如何使用 SQL 代码计算一个人的年龄](http://www.kodyaz.com/articles/calculate-age-sql-code.aspx)

以下是文章中的代码：

```
DECLARE @BirthDate DATETIME
DECLARE @CurrentDate DATETIME

SELECT @CurrentDate = '20070210', @BirthDate = '19790519'

SELECT DATEDIFF(YY, @BirthDate, @CurrentDate) - CASE WHEN( (MONTH(@BirthDate)*100 + DAY(@BirthDate)) > (MONTH(@CurrentDate)*100 + DAY(@CurrentDate)) ) THEN 1 ELSE 0 END 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T02:44:59.310

还有一种更简单的方法：

```
Select CAST(DATEDIFF(hh, [birthdate], GETDATE()) / 8766 AS int) AS Age 
```

因为这里的舍入非常精细，所以这*几乎*是完全准确的。例外是如此令人费解，以至于它们几乎是幽默的：如果我们 A) 要求在早上 6:00 之前的年龄，B) 在这个人的生日和 C) 他们的生日在之后2 月 28 日。在我的环境中，这是一个完全可以接受的折衷方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-31T18:55:46.227

FWIW，Age 可以以直接的方式计算，而无需求助于 hack（并不是说 hack 有什么问题！）：

```
CREATE FUNCTION Age (@BirthDate DATETIME)
RETURNS INT
AS
BEGIN
    DECLARE @AgeOnBirthdayThisYear INT
    DECLARE @BirthdayThisYear DATETIME
    SET @AgeOnBirthdayThisYear = DATEDIFF(year, @BirthDate, GETDATE())
    SET @BirthdayThisYear = DATEADD(year, @AgeOnBirthdayThisYear, @BirthDate)
    RETURN
        @AgeOnBirthdayThisYear
        - CASE WHEN @BirthdayThisYear > GETDATE() THEN 1 ELSE 0 END
END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-08T06:24:17.400

该解决方案展示了如何在一个没有变量的查询中

```
SELECT DATEDIFF(YY, birthdate, GETDATE()) - CASE WHEN( (MONTH(birthdate)*100 + DAY(birthdate)) > (MONTH(GETDATE())*100 + DAY(GETDATE())) ) THEN 1 ELSE 0 END 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-10-23T17:01:39.863

这比提供的答案更简洁，更快，并且完全准确：

```
datediff(year,DateOfBirth,getdate()-datepart(dy,DateOfBirth)+1) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-30T22:29:18.070

我希望这个是完美的，前提是您接受闰婴儿在连续的 2 月 29 日或非闰年的 3 月 1 日变大一岁的算法。@DOB 必须包含距现在几个世纪之内的日期，@AsOf 必须包含相似的日期 >= @DOB：

```
SET @Age = YEAR(@AsOf) - YEAR(@DOB) - 1
IF MONTH(@AsOf) * 100 + DAY(@AsOf) >= MONTH(@DOB) * 100 + DAY(@DOB)
    SET @Age = @Age + 1 
```

我真的非常感谢任何测试和评论，因为我还没有找到打破它的方法......但是。

添加 - 2014 年 1 月 31 日：这个似乎也很完美，尽管乍一看它看起来太粗糙了：

```
SET @Age = FLOOR(DATEDIFF(dd,@DOB,@CompareDate)/365.25) 
```

在函数中弹出这些，这是一个测试脚本：

```
 SELECT dbo.fnGetAge('2/27/2008', '2/27/2012')
    SELECT dbo.fnGetAge('2/27/2008', '2/28/2012')
    SELECT dbo.fnGetAge('2/27/2008', '2/29/2012')
    SELECT dbo.fnGetAge('2/27/2008', '3/1/2012')
    -- 4 4 4 4
    SELECT dbo.fnGetAge('2/28/2008', '2/27/2012')
    SELECT dbo.fnGetAge('2/28/2008', '2/28/2012')
    SELECT dbo.fnGetAge('2/28/2008', '2/29/2012')
    SELECT dbo.fnGetAge('2/28/2008', '3/1/2012')
    -- 3 4 4 4
    SELECT dbo.fnGetAge('2/29/2008', '2/27/2012')
    SELECT dbo.fnGetAge('2/29/2008', '2/28/2012')
    SELECT dbo.fnGetAge('2/29/2008', '2/29/2012')
    SELECT dbo.fnGetAge('2/29/2008', '3/1/2012')
    -- 3 3 4 4
    SELECT dbo.fnGetAge('3/1/2008', '2/27/2012')
    SELECT dbo.fnGetAge('3/1/2008', '2/28/2012')
    SELECT dbo.fnGetAge('3/1/2008', '2/29/2012')
    SELECT dbo.fnGetAge('3/1/2008', '3/1/2012')
    -- 3 3 3 4
    SELECT dbo.fnGetAge('3/1/2007', '2/27/2012')
    SELECT dbo.fnGetAge('3/1/2007', '2/28/2012')
    SELECT dbo.fnGetAge('3/1/2007', '2/29/2012')
    SELECT dbo.fnGetAge('3/1/2007', '3/1/2012')
    -- 4 4 4 5
    SELECT dbo.fnGetAge('3/1/2007', '2/27/2013')
    SELECT dbo.fnGetAge('3/1/2007', '2/28/2013')
    SELECT dbo.fnGetAge('3/1/2007', '3/1/2013')
    SELECT dbo.fnGetAge('2/27/2007', '2/28/2013')
    SELECT dbo.fnGetAge('2/28/2007', '2/28/2014')
    -- 5 5 6 6 7 
```

干杯

PS：如果您的船浮起来，您可能可以将 2 月 29 日的决定调整为提前一天。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-01-13T01:11:33.103

```
SELECT Pname, DOB, DATEDIFF(YEAR, DOB, GETDATE()) AS Age
FROM tablename 
```

# python - 腌制文件不会在 Mac/Linux 上加载

> ID：283766
> 
> 赞同：5
> 
> 时间：2008-11-12T12:15:52.140
> 
> 标签：python, linux, macos, cross-platform

我有一个从腌制文件导入数据的应用程序。它在 Windows 中运行良好，但 Mac 和 Linux 的行为很奇怪。

在 OS X 中，除非我将文件类型设置为 *.*，否则腌制文件（文件扩展名“.char”）不可用作选择。然后，如果我选择一个具有 .char 扩展名的文件，它将不会加载，给出错误

> ```
> unpickle_file = cPickle.load(char_file) 
> ```
> 
> ValueError：无法将字符串转换为浮点数

但是，如果我创建一个没有 .char 扩展名的文件，该文件将正常加载。

在 Linux 中，当我使用“文件打开”对话框时，我的腌制文件不可见，无论它们是否具有文件扩展名。但是，我可以在 Nautilus 或 Dolphin 下看到它们。但是，它们根本不存在于我的应用程序中。

* * *

**编辑**这是保存代码：

```
def createSaveFile(self):
        """Create the data files to be saved and save them.

        Creates a tuple comprised of a dictionary of general character information
        and the character's skills dictionary."""
        if self.file_name:
            self.save_data = ({'Name':self.charAttribs.name,

              <snip> 

                self.charAttribs.char_skills_dict)
            self.file = open(self.file_name, 'w')
            cPickle.dump(self.save_data, self.file)
        self.file.close() 
```

这是开放代码：

```
 def getCharFile(self, event): # wxGlade: CharSheet.<event_handler>
        """Retrieve pickled character file from disk."""
        wildcard = "Character files (*.char) | *.char | All files (*.*) | *.*"        
        openDialog = wx.FileDialog(None, "Choose a character file", os.getcwd(),
        "", wildcard, wx.OPEN | wx.CHANGE_DIR)
        if openDialog.ShowModal() == wx.ID_OK:
            self.path = openDialog.GetPath()
        try:
            char_file =  open(self.path, "r")
            unpickle_file = cPickle.load(char_file)
            char_data, char_skills = unpickle_file
            self.displayCharacter(char_data, char_skills)
        except IOError:
            self.importError = wx.MessageDialog(self, 
            "The character file is not available!",
            "Character Import Error", wx.OK | wx.ICON_ERROR)
            self.importError.ShowModal()
            self.importError.Destroy()
            openDialog.Destroy() 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-12T12:30:35.480

在写入和/或读取腌制数据时，您可能没有以二进制模式打开文件。在这种情况下，会发生换行格式转换，这可能会破坏二进制数据。

要以二进制模式打开文件，您必须提供“b”作为模式字符串的一部分：

```
char_file = open('pickle.char', 'rb') 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-12T12:57:32.367

正如[亚当](https://stackoverflow.com/questions/283766/pickled-file-wont-load-on-maclinux#283802)所提到的，问题很可能是泡菜文件的换行格式。

不幸的是，真正的问题实际上是在*保存*而不是加载时引起的。如果您使用的是文本模式泡菜，而不是二进制文件，这可能是可以恢复的。尝试以通用换行模式打开文件，这将导致 python 猜测正确的行尾是什么，即：

```
char_file=open('filename.char','rU') 
```

但是，如果您使用的是二进制格式 (cPickle.dump(file, 1))，您可能会遇到不可恢复的损坏 pickle（即使在 Windows 中加载时也是如此） - 如果您很幸运并且没有出现 \r\n 字符它可能会起作用，但是一旦发生这种情况，您最终可能会收到损坏的数据，因为无法区分“真实”\r\n 代码和仅看到 \n 时插入的一个窗口。

处理要在多个平台上加载的内容的最佳方法是始终以二进制模式保存。在您的 Windows 机器上，保存泡菜时使用：

```
char_file = open('filename.char','wb')
cPickle.dumps(data, char_file) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-02-20T07:45:18.963

出现此错误的另一种方法是在酸洗后忘记关闭输出文件。这可能会留下一个不完整的文件，在随后的 unpickling 过程中以随机方式失败。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T15:46:22.667

```
self.file = open(self.file_name, 'w')
```

应该：

```
self.file = open(self.file_name, 'wb')
```

在您的`createSaveFile`函数中，以二进制模式（而不是文本模式）保存文件。您还应该确保以二进制模式打开文件 (rb)。

如果您不使用二进制模式，那么 Windows 会将所有换行符转换为 \r\n 并有效地损坏文件（至少就其他操作系统而言）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-07-24T01:12:01.147

使用 dos2unix 工具

```
dos2unix pickle.char 
```

# php - 允许的最大 cookie 数量

> ID：283774
> 
> 赞同：15
> 
> 时间：2008-11-12T12:20:03.083
> 
> 标签：php, javascript, cookies

据谷歌搜索告诉我，允许的最大 cookie 数量很大程度上取决于浏览器，但是我找不到任何关于现代浏览器允许多少 cookie 的最新数据。

我需要在 cookie 中存储大量用户偏好（对于尚未注册的用户），那么最好的方法是什么？（此外，这些 cookie 将通过 javascript 客户端和 php 服务器端访问）

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-12T13:52:42.427

来自[rfc](http://www.ietf.org/rfc/rfc2109.txt)：

*   至少 300 个 cookie

*   每个 cookie 至少 4096 字节（通过在 Set-Cookie 标头的语法描述中组成 cookie 非终结符的字符的大小来衡量）

*   每个唯一主机或域名至少 20 个 cookie

这些是最低要求。IE6 团队没有做到这一点。其他一切都是高度特定于浏览器的。您最好编写一个测试平台来测试每个浏览器。用很少的增量步骤测试最大大小和数量（并检查它们是否仍然可读）。

另外，我似乎记得 apache 有大量 cookie 的问题。不记得我在哪里看到的。

这是一个小 cookie 测试脚本： http: [//krijnhoetmer.nl/stuff/javascript/maximum-cookies/](http://krijnhoetmer.nl/stuff/javascript/maximum-cookies/)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-12T12:25:41.090

最好的方法是根本不将它们存储在 cookie 中。

将它们存储在数据库中，并将 DB 密钥存储在 cookie 中。如果只是一些偏好，那么安全性就不是什么大问题。

不要忘记每个请求都会发送 cookie - 如果您有 2kb 的 cookie 数据并在一个页面上加载 10 个图像，那就是额外的 22kb 数据。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-10-02T14:25:32.380

饼干数量：

*   Chrome 9 允许每个域 180 个 cookie
*   Firefox 3.6.3 允许每个域 50 个 cookie
*   Internet Explorer 8 允许每个域 50 个 cookie
*   Opera 10 和 9 允许每个域 30 个 cookie

Cookie 大小限制（4096 字节）：

*   Firefox 和 Safari 允许 cookie 最多包含 4097 个字符，即 4096 用于名称和值，一个用于等号。
*   Opera 允许包含最多 4096 个字符的 cookie，用于名称、值和等号。
*   Internet Explorer 允许包含最多 4095 个字符的 cookie，用于名称、值和等号。

SRC：[http](http://webdesign.about.com/od/cookies/f/cookies-per-domain-limit.htm) ://webdesign.about.com/od/cookies/f/cookies-per-domain-limit.htm和[http://www.nczonline.net/blog/2008/05/17/browser-cookie-限制/](http://www.nczonline.net/blog/2008/05/17/browser-cookie-restrictions/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-01-05T12:48:13.790

我今天研究了一下，如果你想支持大多数浏览器，那么每个域不要超过 50 个 cookie，每个域不要超过 4095 字节（即所有 cookie 的总大小 <= 4095 字节）

要了解更多信息，[这里是测试页和结果](http://browsercookielimits.iain.guru/)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-12T13:21:18.713

IIRC，对于大多数普通浏览器来说是 20，对于某些浏览器来说更多，对于一个特定的浏览器是 10（同样是 IIRC，IE5.5？）。最多 10 个被认为是一个安全的数字。

无论如何，您实际上并不需要超过一个 - 只需使用一个来存储客户端的 ID，并根据相同的 ID 存储您需要在服务器端存储的所有内容。除此之外，您离开客户端的数据越少，他们删除/损坏/黑客/等的数据就越少。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-08T22:21:57.753

不知道从他们的角度来看这有多大意义，但[我见过](http://webcookies.info/number-of-cookies/)一些网站设置了 450 多个 cookie 并向[140 多个不同的第三方域报告](http://webcookies.info/third-party-domains/)。

# database - 使用 ADO/MDAC 时出现自动化错误

> ID：283793
> 
> 赞同：1
> 
> 时间：2008-11-12T12:26:59.760
> 
> 标签：database, vb6, mdac

好的，正在努力得到这个问题的明确答案......

我有一个用 VB6 编写的应用程序，它需要 MDAC（此安装为 2.8）。MDAC 包含在我的应用程序的安装程序中。当软件被删除并重新安装在同一台机器上时，MDAC 似乎出错了，一​​旦我的应用程序尝试连接到数据库，我就会收到以下错误：

运行时错误“-2147024769 (8007007f)”：

自动化错误 找不到指定的过程。

我尝试重新安装成功完成的 MDAC，但没有解决问题。我在互联网上搜索了很多内容，发现很多人在不同的环境（VS.NET、JAVA 等）中有类似的问题，实际上是任何依赖 MDAC 的东西，但找不到明确的答案。任何有干净解决方案的人都会收到我最高兴的感谢和赞赏。

你的期待被抑制了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T12:31:02.980

您是否尝试过Microsoft的[MDAC 组件检查器？](http://support.microsoft.com/kb/307255)它是用于诊断问题和重新配置 MDAC 安装的工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T13:13:07.937

我发现删除 MDAC 2.8 几乎是不可能的。但是，在运行组件检查器、更改注册表项并放置不同版本的 MSDART 后，问题已得到修复。

我安装的 MSDART 不是组件检查器建议的，但它可以工作。组件检查器的 MSXML 版本也有问题，但该软件似乎无论如何都可以工作，所以我会在以后研究这个问题。不过我的问题解决了。这么快。感谢和赞美你 Mitch 和 Stackoverflow。伟大的！

# charts - 他们如何在 stackoverflow 上绘制图表/图形？

> ID：283805
> 
> 赞同：4
> 
> 时间：2008-11-12T12:31:19.067
> 
> 标签：charts, svg, vector-graphics, vml

我曾经花了很长时间学习 VML 并为网站创建图表，但由于 VML 只能在 Internet Explorer 中运行，所以现在它并不好。

我注意到 stackoverflow 在我的个人资料页面上有图表，在“声誉”下，但我无法看到他们是如何做到的。

任何人都可以建议一种方法来创建适用于所有浏览器的客户端图表或图表吗？我不想使用动态创建图像文件的服务器端方法。我也可能希望使用 JavaScript 与图表进行交互。

[编辑——我想画的不仅仅是图表。也许还有小图表！]

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-12T12:34:34.253

[弗洛特](http://code.google.com/p/flot/)很棒。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T12:45:40.613

为此，谷歌创建了一个很棒的公共[图表 API 。](http://code.google.com/apis/chart/)

例子：

![折线图](https://chart.apis.google.com/chart?cht=lxy&chs=200x125&chd=t:0,30,60,70,90,95,100|20,30,40,50,60,70,80|10,30,40,45,52|100,90,40,20,10|-1|5,33,50,55,7&chco=3072F3,ff0000,00aaaa&chls=2,4,1&chm=s,FF0000,0,-1,5|s,0000ff,1,-1,5|s,00aa00,2,-1,5) ![饼形图](https://chart.apis.google.com/chart?cht=p3&chd=s:Uf9a&chs=250x100&chl=January|February|March|April) ![替代文字](https://chart.apis.google.com/chart?cht=s&chd=s:984sttvuvkQIBLKNCAIi,DEJPgq0uov17zwopQODS,AFLPTXaflptx159gsDrn&chxt=x,y&chxl=0:|0|2|3|4|5|6|7|8|9|10|1:|0|25|50|75|100&chs=200x125)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-12T12:45:45.697

在堆栈溢出播客的[第 24 集中](https://blog.stackoverflow.com/2008/10/podcast-24/)，提到了使用 jQuery。[本文](https://blog.stackoverflow.com/2008/09/i-dont-give-a-damn-about-my-reputation/)的评论者建议使用[flot](http://code.google.com/p/flot/)库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T12:45:42.907

查看[Google Chart API](http://code.google.com/apis/chart/)。您可以用最少的努力完成各种复杂的事情——在设计时由您完成，在运行时由您的服务器完成。好的。

# vb6 - 某处的区域设置问题

> ID：283812
> 
> 赞同：0
> 
> 时间：2008-11-12T12:35:09.823
> 
> 标签：vb6, asp-classic

参考[保存时日期日/月反转的问题](https://stackoverflow.com/questions/280597/problem-with-date-daymonth-reversing-on-save)

我进一步指出，即使在页面本身上设置 Session.LCID 也没有任何区别。

环境如何在测试和实时之间，实时的 asp 站点正在反转通过 SQL 输入的日期，而不是在测试中。

两者都将 IUSR 设置为英国，都将所有用户设置为英国，都将 SQL 帐户设置为美国英语，并且都将 Session.LCID 设置为 3081（澳大利亚英语）

为什么测试正在运行“插入日期列值'01/03/2008'并插入'01/03/2008'并且live正在插入'03/01/2008'”

设置看起来完全一样。这必须尽快弄清楚，我很害怕我们永远不会知道。问题是我们可能不会更改代码或其他任何东西。我所能做的就是调查并告诉他们原因。但是我找不到！

它是 VB6/ASP，它驱使我做 lally。

通过配置为使用正确 SQL 帐户的系统 DSN 访问数据库。

您可能还需要什么其他信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T14:06:18.640

在 SQL Server Management Studio 中，在安全 - 登录中，右键单击要连接的用户，然后单击“属性”。底部组合框标记为“默认语言”，将其更改为“英国英语”（*不仅仅是*“英语”）。

`sp_configure 'default language'`*为新创建的登录*设置默认语言，它就是存储在`sysconfigures`.

我在这里假设查询字符串中没有设置语言？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T16:42:23.833

我鼓励您修改与数据库交互的代码。有 2 种明确的日期格式可用于 SQL Server。

您可以使用 yyyy-mm-ddThh:mi:ss.mmm 或 YYYYMMDD hh:mi:ss.mmm

如果您使用上面列出的 2 种格式之一，SQL Server 将永远不会错误解释日期。

在 vb 中，您可以使用以下格式函数将日期格式化为 SQL Server 永远不会错误解释的明确日期格式。

```
Format(YourDateVariable, "yyyymmdd hh:nn:ss") 
```

# java - 如何访问默认包中的 java 类？

> ID：283816
> 
> 赞同：105
> 
> 时间：2008-11-12T12:36:21.940
> 
> 标签：java, groovy, default-package

我现在正在与其他人一起在一个 grails 项目中工作。我必须编写一些 Java 类。但我需要访问用 groovy 创建的可搜索对象。看来，这个对象必须放在默认包中。

我的问题是：**有没有办法从命名包中的 Java 类访问默认包中的这个对象？**

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2008-11-12T12:44:01.597

[您不能使用](http://mindprod.com/jgloss/import.html)命名包中的默认包中的类。
（*从技术上讲*，您可以，如 Sharique Abdullah通过反射 API的[回答所示，](https://stackoverflow.com/a/561183/6309)*但是*来自未命名命名空间的类**不在****导入声明**的范围内）

在 J2SE 1.4 之前，您可以使用如下语法从默认包中导入类：

```
import Unfinished; 
```

那[已经不允许](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4989710)了。因此，要从打包类中访问默认包类，需要将默认包类移动到它自己的包中。

如果您可以访问 groovy 生成的源代码，则需要进行一些后处理以将文件移动到专用包中并在其开头添加此“包”指令。

* * *

2014 年更新：对于 JDK7 和 JDK8，[错误 6975015描述了更](https://bugs.openjdk.java.net/browse/JDK-6975015)*严格*的禁止从未命名包导入的禁令。

> `TypeName`必须是类类型、接口类型、枚举类型或注释类型的规范名称。
> 该类型必须是**命名包的成员，或者是其最外层词法封闭类型是****命名包**的成员的类型的成员，**否则会发生编译时错误**。

* * *

[Andreas](https://stackoverflow.com/users/5221149/andreas)[在评论中](https://stackoverflow.com/questions/283816/how-to-access-java-classes-in-the-default-package/283828#comment98446842_283828)指出：

> > “为什么[默认包]首先存在？设计错误？”
> 
> 不，这是故意的。
> [JLS 7.4.2。Unnamed Packages](https://docs.oracle.com/javase/specs/jls/se8/html/jls-7.html#jls-7.4.2)说：“Java SE 平台提供了未命名的包，主要是为了方便开发小型或临时应用程序或刚开始开发时”。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-02-18T14:10:45.080

事实上，你可以。

到目前为止，您可以使用反射 API 访问任何类。至少我能够:)

```
Class fooClass = Class.forName("FooBar");
Method fooMethod = fooClass.getMethod("fooMethod", String.class);

String fooReturned = (String)fooMethod.invoke(fooClass.newInstance(), "I did it"); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-03-13T02:37:03.243

使用[jarjar](https://code.google.com/p/jarjar/)重新打包 jar 文件，规则如下：

```
rule * <target package name>.@1 
```

源jar文件默认包中的所有类都会移动到目标包中，从而可以访问。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-12T14:12:20.873

您可以在代码中使用包`Groovy`，一切都会正常工作。

这可能意味着对代码的轻微重组，`grails-app`一开始会有点痛苦，但在大型 grails 项目中，将东西组织在包中才有意义。我们使用 Java 标准包命名约定`com.foo.<app>.<package>`。

正如您所发现的，将所有内容都放在默认包中会成为集成的障碍。

控制器似乎是一个 Grails 工件（或工件），它拒绝放入 Java 包中。可能我只是还没有弄清楚`Convention`。;-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-04-26T08:10:11.200

*只是为了完成这个想法：*

**从**default-package 内部，您可以访问位于命名包中的对象。

# java - WebSphere MQ 的 QueueConnectionFactory

> ID：283821
> 
> 赞同：2
> 
> 时间：2008-11-12T12:39:11.467
> 
> 标签：java, jms, ibm-mq

有谁知道是否有`javax.jms.QueueConnectionFactory`WebSphere MQ 的实现以及从哪里获得它？我用谷歌搜索并搜索了 IBM 网站，但找不到任何东西。我不想通过 JNDI 从 Websphere MQ 检索连接或工厂，我需要自己的连接工厂。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T12:47:31.390

我想你需要三个罐子

```
com.ibm.mq.jar
com.ibm.mqbind.jar
com.ibm.mqjms.jar 
```

你实例化了一个*MQQueueConnectionFactory*，我希望你能从那里得到它。

这里有更多信息： [IBM 的 HOWTO](http://www.ibm.com/developerworks/websphere/techjournal/0502_woolf/0502_woolf.html)

哦，MQ 可以做“真正的”JMS 而不是 MQ——只有 JMS 实现似乎在正确关闭 Channel 时存在问题——至少在我们的环境中是这样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-20T20:46:15.883

尽管在其他回复中引用的 Bobby 的文章很好，但我希望使用比 2005 年更新的 JMS 类版本！大部分开发都在增强 JMS 功能和性能。这些类已被简化并重新打包到更少的 jar 中，因此更易于部署。

我建议您前往 WMQ 信息中心了解您拥有的 JMS 类版本（6.0 或 7.0）并查找使用 Java 手册。里面有一个关于环境变量的部分。确保您的特定版本的 CLASSPATH 中列出了 jars。信息中心从[WMQ 库](http://www-01.ibm.com/software/integration/wmq/library/)页面链接。

如果您可以使用最新版本，请下载[MQC7 SupportPac](http://www-01.ibm.com/support/docview.wss?rs=171&uid=swg24019253&loc=en_US&cs=utf-8&lang=en)。这是 WMQ 客户端代码，包含最新的 jar。

安装客户端后，可以在 C:\Program Files\IBM\WebSphere MQ\tools\jms\samples\simple 中找到示例代码

# c# - “显式接口实现的约束……”

> ID：283824
> 
> 赞同：5
> 
> 时间：2008-11-12T12:40:41.590
> 
> 标签：c#, .net, generics

我不知道为什么以下行不通，有什么想法吗？公共接口 IFieldSimpleItem { }

```
public interface IFieldNormalItem : IFieldSimpleItem
{ }

public class Person
{
    public virtual T Create<T>()
        where T : IFieldSimpleItem
    {
        return default(T);
    }
}

public class Bose : Person
{
    public override T Create<T>()
        where T : IFieldNormalItem //This is where the error is
    {
        return default(T);
    } 
} 
```

我这样做的原因是，如果开发人员从 Bose 继承，Bose 依赖于创建的实例至少是 IFieldNormalItem。而下面只依赖于它是 IFieldSimpleItem，但上面应该强制它至少是 IFieldNormalItem。

```
public class Person
{
    public virtual IFieldSimpleItem Create() 
    {
        return null;
    }
}

public class Bose : Person
{
    public override IFieldSimpleItem Create()  
    {
        return null;
    } 
} 
```

干杯安东尼

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T04:53:02.967

我很确定您在使用编译器和泛型来为您节省一些运行时检查方面并不走运。你不能覆盖不存在的东西，你不能对相同的方法有不同的返回类型。

我不能说我完全理解你的动机，但它具有技术价值。

我的第一次尝试是使用具有非虚拟公共接口的基类，然后使用另一个受保护的虚拟方法`CheckCreatedType`，该方法允许链中的任何内容在调用基类 Create 之前检查类型。

```
public class A
{
    public IFieldSimpleItem Create()
    {
        IFieldSimpleItem created = InternalCreate();
        CheckCreatedType(created);
        return created;
    }

    protected virtual IFieldSimpleItem InternalCreate()
    {
        return new SimpleImpl();
    }
    protected virtual void CheckCreatedType(IFieldSimpleItem item)
    { 
        // base class doesn't care. compiler guarantees IFieldSimpleItem
    }
}
public class B : A
{
    protected override IFieldSimpleItem InternalCreate()
    {
        // does not call base class.
        return new NormalImpl();
    }
    protected override void CheckCreatedType(IFieldSimpleItem item)
    {
        base.CheckCreatedType(item);
        if (!(item is IFieldNormalItem))
            throw new Exception("I need a normal item.");

    }
} 
```

以下内容坚持基类的运行时检查。无法解决的问题是您仍然必须依赖被调用的基类方法。行为不端的子类可以通过不调用`base.CheckCreatedType(item)`.

替代方法是硬编码基类中所有子类的所有检查（错误），或者以其他方式外部化检查。

尝试 2：（子）类注册他们需要的检查。

```
public class A
{
    public IFieldSimpleItem Create()
    {
        IFieldSimpleItem created = InternalCreate();
        CheckCreatedType(created);
        return created;
    }

    protected virtual IFieldSimpleItem InternalCreate()
    {
        return new SimpleImpl();
    }

    private void CheckCreatedType(IFieldSimpleItem item)
    {
        Type inspect = this.GetType();
        bool keepgoing = true;
        while (keepgoing)
        {
            string name = inspect.FullName;
            if (CheckDelegateMethods.ContainsKey(name))
            {
                var checkDelegate = CheckDelegateMethods[name];
                if (!checkDelegate(item))
                    throw new Exception("failed check");
            }
            if (inspect == typeof(A))
            {
                keepgoing = false;
            }
            else
            {
                inspect = inspect.BaseType;
            }
        }
    }

    private static Dictionary<string,Func<IFieldSimpleItem,bool>> CheckDelegateMethods = new Dictionary<string,Func<IFieldSimpleItem,bool>>();
    protected static void RegisterCheckOnType(string name, Func<IFieldSimpleItem,bool> checkMethod )
    {
        CheckDelegateMethods.Add(name, checkMethod);
    }
}
public class B : A
{
    static B()
    {
        RegisterCheckOnType(typeof(B).FullName, o => o is IFieldNormalItem);
    }

    protected override IFieldSimpleItem InternalCreate()
    {
        // does not call base class.
        return new NormalImpl();
    }
} 
```

检查是由子类在基类中注册要调用的委托来完成的，但基类不需要预先知道所有规则。还要注意，它仍然是非虚拟公共接口，它允许基类在返回结果之前检查结果。

我假设这是您要捕获的开发人员错误。如果适用，您可以使用 修饰运行时检查方法`System.Diagnostics.Conditional("DEBUG")]`，允许发布版本跳过检查。

我对泛型的了解并不完美，所以也许这是不必要的。然而，这里的检查不必只针对类型：这可以适用于其他用途。例如，传入的委托`Register..`不必只检查引用是否为特定类型'

* 请注意，在上面写的类型名称上创建字典可能不太好；为了说明所使用的机制，这个工作有点简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T10:47:25.063

这是不允许的，因为它违反了 Liskov 替换原则。

假设您有另一个界面：

```
public interface IFieldSuperItem : IFieldSimpleItem 
```

然后你可以这样做

```
Person p = new Boss();
p.Create<IFieldSuperItem>(); 
```

第二行的调用，虽然与 Create in Person 的定义兼容，但显然与 Boss 中的定义不兼容（仅适用于 IFieldNormalItem 及其子类）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T12:46:45.650

我认为问题在于您覆盖了先前定义的方法。如此有效地尝试更改方法的定义，这是不允许的。您唯一的选择是创建一个新方法，例如

```
public class Bose : Person
{
    public virtual T CreateNormal<T>()
        where T : IFieldNormalItem //This is where the error is
    {
        return default(T);
    } 
} 
```

或要求 Person 类上的普通字段，或动态进行验证。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T13:00:57.897

似乎您不能更改方法的定义，但是您可以使您的类通用而不是创建方法吗？

```
public class Person<T> where T : IFieldSimpleItem
{
    public virtual T Create()
    {
        return default(T);
    }
}

public class Bose<T> : Person<T> where T : IFieldNormalItem
{
    public override T Create()
    {
        return default(T);
    } 
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T05:54:58.287

更改通用约束会更改方法签名，如果您要覆盖虚拟，则不允许这样做。

我认为您可能需要将 Create 方法拆分为一个单独的类：

```
public interface IFieldSimpleItem { }

public interface IFieldNormalItem : IFieldSimpleItem{ }

public interface IFieldCreator<TField, TPerson> where TField : IFieldSimpleItem where TPerson : Person
{
    TField Create(TPerson person);
}

public class Person
{
}

public class Bose : Person
{
}

public class PersonFieldCreator : IFieldCreator<IFieldSimpleItem, Person> 
{
    public IFieldSimpleItem Create(Person person) { return null; }
}

public class BoseFieldCreator : IFieldCreator<IFieldNormalItem, Bose>
{
    public IFieldNormalItem Create(Bose person) { return null; }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T12:52:15.607

那这个呢：

```
public interface IFieldNormalItem : IFieldSimpleItem
{ }

public class Person<T> where T : IFieldSimpleItem
{
    public virtual T Create()
    {
        return default(T);
    }
} 
```

现在您可以拥有`Person<IFieldSimpleItem>`（对应于`Person`）或`Person<IFieldNormalItem>`（对应于`Bose`）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T12:52:27.447

下面的代码足以覆盖。类型 T 已经指示需要由基类 Person 中的 IFieldSimpleItem 实现。

```
public class Bose : Person
{
    public override T Create<T>()
        // where T : IFieldNormalItem // You don't need this line.
    {
        return default(T);
    } 
} 
```

编辑：我完全把问题弄错了，所以上面的代码不能解决这个问题。你唯一需要做的就是；不要通过“覆盖”而是“虚拟”来覆盖 Create 方法。

```
public class Bose : Person
{
    public virtual T Create<T>()
        where T : IFieldNormalItem
    {
        return default(T);
    } 
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T13:10:05.213

最简单的例子是这破坏了多态性。如果您有一个 Person 集合，其中一个或多个项目属于 Bose 类型，那么它会在碰到 Bose 时立即崩溃。

```
Person[] people;
[...initialize this somewhere...]

foreach(Person p in people)
  p.Create<IFieldSimpleItem>(); 
```

# c# - 如何从 C# 调用 C++ 函数？

> ID：283831
> 
> 赞同：3
> 
> 时间：2008-11-12T12:45:28.757
> 
> 标签：c#, c++

如何从 C# .NET 调用 C++ 函数？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T12:47:06.240

1.  将 C++ 函数编译成 dll 并[使用 P/Invoke](http://msdn.microsoft.com/en-us/magazine/cc164123.aspx)

    或者

2.  将 C++ 函数编译为 C++/CLI 程序集，包装在托管 C++ 类中，然后像任何其他程序集一样处理（添加引用，使用 using 语句并调用类）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T18:42:35.227

或者

创建一个 COM 包装器，然后从 .NET 中引用它

# .net - 为什么我的 .NET Remoting 目标机器主动拒绝连接？

> ID：283835
> 
> 赞同：5
> 
> 时间：2008-11-12T12:46:02.157
> 
> 标签：.net, c#-3.0, remoting

我正在尝试在 2x 64 位 Windows 机器之间建立基本的 .NET Remoting 通信。如果 Machine1 充当客户端，Machine2 充当服务器，那么一切正常。出现以下异常的另一种方式：

System.Net.Sockets.SocketException：无法建立连接，因为目标机器主动拒绝它 172.16.7.44:6666

服务器代码：

```
TcpChannel channel = new TcpChannel(6666);
ChannelServices.RegisterChannel(channel);
RemotingConfiguration.RegisterWellKnownServiceType(
  typeof(MyRemotableObject),"HelloWorld",WellKnownObjectMode.Singleton); 
```

客户端代码：

```
TcpChannel chan = new TcpChannel();
ChannelServices.RegisterChannel(chan);
// Create an instance of the remote object
remoteObject = (MyRemotableObject)Activator.GetObject(
  typeof(MyRemotableObject), "tcp://172.16.7.44:6666/HelloWorld"); 
```

知道我的代码有什么问题吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-12T12:48:06.240

Windows 防火墙？（问题作者说不是这样。）

为了追踪连接问题，标准方法适用（以任何顺序应用）：

*   ping 机器
*   仔细检查某些进程是否真的在端口 6666 ( `netstat -an`)中侦听
*   在端口 6666 上 telnet 机器
*   尝试在机器上使用不同的服务。
*   检查某些配置是否扰乱了侦听 6666 的服务器进程并导致它拒绝您。（不知道 .NET 远程处理是否可行）
*   使用数据包嗅探器（例如 Packetyzer）观察与机器的通信，以了解 TCP/IP 级别发生了什么。
*   可能服务器和客户端之间的活动网络基础设施组件（第 3 层交换机、防火墙、NAT 路由器等）正在干扰

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T13:00:57.820

假设相同的二进制文件/配置以一种方式工作，但不是另一种方式，这会告诉我房子的网络方面有什么问题。

*   您正在使用 IP 地址 - 使用 IPCONFIG /ALL 仔细检查目标机器上的绑定地址与配置/代码。
*   “服务器”机器是否有多个网卡？例如，服务是否绑定到一个网卡而不是两者？
*   ping 服务器会告诉您 ICMP 在机器之间是可路由的 - 您可以创建面向会话的请求，例如从客户端打开服务器上的 UNC 路径。

除了防火墙之外，我唯一遇到的其他连接被拒绝的经历是：

*   名称解析 - 预先存在的主机条目错误。不过这里应该不是问题。
*   面向 IPSEC - 机器之间的不同策略阻止了一台机器接受来自另一台的入站连接。如果您在公司安全的环境中工作，则可能。如果您确实在 IPSec 环境中工作，请检查简单的东西，如时钟、有效的机器证书。所有这些都会阻止 IPSec 会话的建立。
*   压力问题 - IP 堆栈因服务器配置错误而耗尽了可用的 TCP 控制块。同样听起来你无法建立任何连接 - 可能不是问题。

我将从 Firewall 1st 开始 - 通过设置策略以免除该套接字上的入站请求，信任来自源 IP 的所有套接字，或者完全禁用它。（个人而言，后者作为测试又快又脏，但我会在生产环境中做前者）

除了事件日志之外，如果您确实启用了防火墙但已通过，请审核跟踪。Netmon 等都成为你的朋友。

# culture - 我们的老板想知道我们应该有哪些公司规则来改善文化？

> ID：283857
> 
> 赞同：4
> 
> 时间：2008-11-12T12:58:59.260
> 
> 标签：culture

他想知道我们对我们是否应该有弹性工作时间、允许与工作无关的互联网访问等问题的看法。

我们公司有大约 200 人，一半是程序员，一半是销售人员。我们都希望工作场所富有成效和乐趣。

*   我应该提出什么问题？
*   支持和反对他们的论据是什么？
*   以及这个想法应该如何实施（或者对于规则，应该如何监管）？

谢谢。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-11-12T13:29:40.990

如果你不把你的员工当作成年人对待，那么只有孩​​子愿意为你工作。这意味着您让人们设置自己的时间，访问他们想要的任何网站等，但这也意味着如果他们在需要时不可用，正在查看不适当的网站或冒犯客户，您会受到惩罚他们像成年人一样。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-12T13:09:26.990

不是它的预期目的，但我认为[乔尔测试](http://www.joelonsoftware.com/articles/fog0000000043.html)可以用作试金石。它的目的是在评估潜在雇主时使用，但我认为你没有理由不使用它来尝试改善你目前的工作场所。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-12T13:06:31.817

*   弹性时间：是的。
*   与工作无关的互联网：是的，如果它不干扰工作
*   如果工作完成了，应该不会有“比别人少”的问题

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-12T15:47:40.213

不要仅仅因为你觉得你必须这样做而实施愚蠢的着装要求。这不是高中

相信人们穿着得体（例如：在与客户会面时穿西装，如果这是预期的），根据具体情况处理问题。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-12T21:50:44.223

我想从公司里得到的是所有员工都受到公平对待的感觉（我曾在一个地方，你与 CEO 越友好，你得到的好处就越多，包括公司汽车，除了你和公司总裁或相关人员约会之外，没有其他原因。给 CEO 或和他睡觉）。我想觉得我的薪水对于我应该做的工作来说是公平的。我想感觉我的薪水与与我一起工作的其他人相比是公平的（没有什么比知道你拥有的最糟糕的员工赚的钱最多更能打击士气了！）

我想要一个我被视为专业人士的地方 - 有一些灵活性，但不是因为我们的工作时间如此不同，所以我永远找不到我需要在一个项目上合作的人。

我不介意加班，尤其是在关键时刻，但我不想让你觉得你真的应该雇佣另一个人。我是一个人，我确实有一个家庭和工作之外的生活。

我想要一家尊重有时候工作不是最重要的事情的公司。当我心爱的人几个月前去世时，我工作的公司真的出力帮助了我；他们给了我比规定更多的丧假，他们告诉客户他们必须等到我回来，我的同事毫无怨言地接过了我的日常工作，直到我能够再次处理它们.

我从未拥有但很想拥有的一件事是能够从第一天而不是 3-6 个月后开始投资 401 K。即使公司直到后来才匹配，至少我从不习惯有钱，然后在 6 个月后找到一种方式来负担得起捐款。

我工作过的一个地方在考虑您成为永久雇员后的服务时间时，考虑了您作为承包商或临时工的时间。我得到了额外的假期，我没想到这很好。

我现在的雇主去年突然给了我们一个假期——这很酷。他们在 7 月 4 日给我们两天，在圣诞节、新年和感恩节给我们两天。因此，我对我们没有其他可能的假期这一事实感到满意。

我不想拼命地乞求完成工作所需的设备和软件。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-12T13:11:00.217

弹性时间和不太担心互联网管道中的内容（只要它是合法的并且如果他们看到它就不会打扰客户）都是好事。弹性时间通常带有一些核心时间，每个人都应该在那里，以便安排会议。偶尔能在家工作也不错。

否则社交活动可能是个好主意。我工作过的最好的文化允许经理们有预算来为他们的团队做任何他们想做的事情。它一定相当大，我们每隔几周出去吃午饭，在我们去的每个主要项目之后我们都有下午的休息时间，并且有一些有趣的休息时间（电影，台球厅等）

尽管如此，如果你有坏人，特别是在高位，那么在他们离开之前没有什么可以做的。一般来说，这似乎是缺乏文化的原因，而不是缺乏鼓励良好文化的政策。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-12T15:39:18.500

我将支持弹性工作时间并像对待成年人一样对待他们，但添加

*   财务透明度和
*   利润分享

这使员工能够真正与公司的业绩息息相关，而不仅仅是无知的受害者

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-12T13:10:11.500

好吧，它仍然是一门生意，如果你喜欢你正在做的事情，工作就会很有趣。你不能真正让工作变得有趣。

我真的认为不需要 Flexi 时间或与工作无关的互联网。

如果你喜欢你的同事，并且你们一起努力完成工作，那么工作已经很有趣了。

让人们阅读当天的笑话并在 11 点闲逛并没有真正的帮助。从长远来看，它是有害的。

我会告诉你我喜欢我公司的什么。免费咖啡而不是雀巢速溶咖啡，而是由公司自费维护的过滤咖啡。他们确保牛奶已备好且无糖。甚至可能是饼干。然后当你坐下来解决一个棘手的问题时，你可以喝杯咖啡。或者去和同事一起吃午饭，喝杯咖啡。

了解您周围发生的事情以及如何联系公司中的任何人也很有用，因此维护良好的员工中央存储库非常好。

我不希望我的老板让生活变得有趣，我需要他让我的工作尽可能轻松。基本上我掌握了技能，但我想要一把舒适的椅子、良好的照明和良好的空调:)。我不想打扮得漂漂亮亮的日子。

不过，我确实喜欢羽绒被日的想法。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-12T13:20:23.117

弹性时间很棒，特别是如果你有孩子的人。添加远程办公，你就会得到一些快乐的父母程序员;-)。

与工作无关的互联网可能是有问题的。但是允许访问这样的网站是一个明智的主意。

我从经验中知道，程序员和销售人员之间经常存在误解。因此，培训程序员和销售人员以有效地相互沟通可能是明智之举。这应该很有趣，也可以省去很多烦恼。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-12T22:17:22.160

专业是我想要的词。每个人都是从 9 点到 5 点，因为那天我们需要交流有关 XYZ 的信息。但如果有人早/晚跑，没关系。

人们在工作场所的着装是可以接受的，如果客户进来看到他们，这不会是一种尴尬。他们的网页浏览也是如此。

音乐不应该打扰其他人。

一般来说，假期/假期不应该是拔牙。如果有人想在 10 月份花 2 周时间去猎鹿并度过一些圣诞节，我认为通常应该没问题。

一般来说，管理层应该意识到他们的员工是创造价值的重要组成部分，并以此对待他们。在员工方面，他们需要尊重他们在业务中创造价值的概念。发布的时候就因为那天想看演唱会就请假，嗯，这不是很体贴……

所以它需要成为一个黄金法则：像对待你希望被对待的那样对待他人。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-30T12:41:47.690

办公室应该适合集中精力投入精力——条件良好、通风良好、照明合理且安静。安静通常很难。你必须让每个人都明白，为远足做准备是可以的，但是大声讨论它让 20 个没有参与的人无条件地听到它是不行的。您将不得不与那些手机铃声作斗争，并向所有人解释在公共开放式办公空间中与他们的朋友/亲戚交谈是不合适的。我想你需要为经常违反规则的人设定并实际应用罚款，并与偶尔违反规则的人交谈。

# xslt - xml 属性中 xsl:value-of 的输出结果

> ID：283858
> 
> 赞同：25
> 
> 时间：2008-11-12T12:59:18.930
> 
> 标签：xslt

我有一个 XML 输入文件，我正在尝试输出如下调用的结果：

```
<xsl:value-of select="Some/Value"/> 
```

成一个属性。

```
<Output Attribute="Value should be put here"/> 
```

我的问题是，由于我正在输出 XML，XSL 处理器不允许我编写：

```
<Output Attribute="<xsl:value-of select="Some/Value"/>"> 
```

你如何做到这一点？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-12T13:06:14.127

最简单的方法是使用[属性值模板](http://www.w3.org/TR/xslt.html#dt-attribute-value-template)，如下所示：

```
<Output Attribute="{Some/Value}"/> 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-12T13:03:14.413

您可以使用 xsl:attribute 元素：

```
<Output>
  <xsl:attribute name="Attribute">
    <xsl:value-of select="Some/Value"/>
  </xsl:attribute>
</Output> 
```

# asp.net - 将简单的 ASP.NET 应用程序部署到托管 IIS 6.0 服务器的最简单方法

> ID：283859
> 
> 赞同：2
> 
> 时间：2008-11-12T12:59:28.837
> 
> 标签：asp.net, deployment

我正在使用 SQL 2005 数据库在 VS 2008 中构建一个简单的 ASP.NET Web 应用程序。我正在使用 Vista，我不想安装 IIS（我宁愿只使用 Cassini 进行本地测试）。这是我尝试过的：

*   FrontPage 服务器扩展。我在我的服务器上安装了这些，但它们破坏了我的默认网站，我仍然无法通过 FPSE 从 VS 2008 发布。

*   FTP。我设置了一个植根于我的 IIS Web 根目录的 FTP 站点，该站点适用于单个默认网站。当我设置第二个站点并将两个站点移动到子文件夹中时，VS 的 FTP 发布方法无法处理发布到子目录的问题。此方法的安全性也是一个问题，因为它以明文形式发送凭据。

我考虑了几种选择：

*   在服务器上安装 CruiseControl.NET 并对其进行配置，以便我可以在服务器上开始构建，如果成功，XCopy 会将站点部署到 IIS。但是，我并不热衷于在面向公众的 Web 服务器上运行我的构建过程。

*   实时网格。我考虑将 XCopy 部署到本地目录并使用 Live Mesh 将其复制到我服务器上的虚拟目录。

有没有人有解决这个问题的行之有效的方法？

谢谢，吉姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T13:02:14.417

只需用 Visual Studio 将其发布到本地目录，然后通过 FTP/SFTP/SCP 将本地目录的内容复制到服务器。

如果您需要适用于 Windows 的 SFTP 服务器，请查看[FileZilla](http://filezilla-project.org/)。它也可以做 FTP 和 SFTP，并且它有一个服务器和一个客户端组件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T13:20:19.467

我使用[Web 部署项目](http://www.microsoft.com/downloads/details.aspx?familyId=0AA30AE8-C73B-4BDD-BB1B-FE697256C459&displaylang=en)发布到本地文件夹 - 这比直接发布给了我更多的控制权，然后复制到像 DrJokepu 这样的服务器

# javascript - jQuery SimpleTree：以编程方式添加节点

> ID：283869
> 
> 赞同：0
> 
> 时间：2008-11-12T13:03:18.923
> 
> 标签：javascript, jquery

我正在尝试向 jQuery [SimpleTree](http://news.kg/wp-content/uploads/tree/)添加一个新节点，但我似乎能够得到的只是“sTC.addNode 不是一个函数”......

```
var simpleTreeCollection = $('.simpleTree').simpleTree({
    animate:true,
    drag:false,
    autoclose: false,
    afterClick:function(node){},
    afterDblClick:function(node){},
    beforeMove:function (destination, source, pos){},
    afterMove:function(destination, source, pos){},
    afterAjax:function() {},
    afterContextMenu:function(node){}
});

simpleTreeCollection.addNode('test', 'test'); 
```

有什么建议我可能做错了吗？甚至有可能添加一个节点吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T13:23:25.590

嗯，这是一个棘手的问题，我不得不说我不喜欢这个插件，因为它使用数字作为 id，并且 w3c 声明“属性的值必须以 AZ 或 az 范围内的字母开头，后面可能跟字母...... 。”

但是，为了让您工作，您需要先选择一个节点才能像这样添加到它

```
 //Select first child node in tree
    $('#2').click();
    //Add new node to selected node
    simpleTreeCollection.get(0).addNode(1,'A New Node') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T10:43:31.740

也许看看[jsTree](http://www.jstree.com/jsTree/examples/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T07:31:37.423

仅供参考，上面的代码在他们的演示页面上的 firebug 控制台中工作。在你的树上确保你使用正确的选择器来突出显示节点

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-09T15:57:27.117

我已经通过编辑 addNode 函数解决了这个问题。我评论了 temp_node.remove(); 并添加了 dragNode_destination.after(dragNode_source);

就像这样：

```
 TREE.addNode = function(id, text, callback)
        {
            var temp_node = $('<li><ul><li id="'+id+'"><span>'+text+'</span></li></ul></li>');
            TREE.setTreeNodes(temp_node);
            dragNode_destination = TREE.getSelected();
            dragNode_source = $('.doc-last',temp_node);
            TREE.moveNodeToFolder(dragNode_destination);
//          temp_node.remove();
            dragNode_destination.after(dragNode_source);
            if(typeof(callback) == 'function')
            {
                callback(dragNode_destination, dragNode_source);
            }
        }; 
```

# spring-security - Acegi Security：如何将另一个 GrantedAuthority 添加到匿名用户的身份验证中

> ID：283870
> 
> 赞同：4
> 
> 时间：2008-11-12T13:04:00.560
> 
> 标签：spring-security, roles, anonymous

我为用户提供带有访问密钥的特殊 URL。与简单的匿名用户相比，通过这个特殊 url 访问公共页面的用户应该能够看到一些额外的数据。

我想根据请求中提供的参数给匿名用户一些额外的角色，这样我就可以在我的模板中做这样的事情：

```
<@sec.authorize ifAnyGranted="ROLE_ADMIN, ROLE_USER, ROLE_INVITED_VISITOR">
...some additional stuff for invited user to see
</@sec.authorize> 
```

目前我正在实施 Spring 的`OncePerRequestfilter`：

```
protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException {
    if (null != request.getParameter("accessKey")) {
        if(isValid(request.getParameter("accessKey"))) {
            Authentication auth = SecurityContextHolder.getContext().getAuthentication();
            //how do i add additional roles to authenticated (potentially anonymous) user?
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-12T14:02:35.527

为什么不直接创建一个委托给原始的包装类，而是添加几个额外的 GrantedAuthorities：

```
public class AuthenticationWrapper implements Authentication
{
   private Authentication original;
   private GrantedAuthority[] extraRoles;

   public AuthenticationWrapper( Authentication original, GrantedAuthority[] extraRoles )
   {
      this.original = original;
      this.extraRoles = extraRoles;
   }

   public GrantedAuthority[] getAuthorities()
   {
      GrantedAuthority[] originalRoles = original.getAuthorities();
      GrantedAuthority[]  roles = new GrantedAuthority[originalRoles.length + extraRoles.length];
      System.arraycopy( originalRoles, 0, roles, 0, originalRoles.length );
      System.arraycopy( extraRoles, 0, roles, originalRoles.length, extraRoles.length );
      return roles;
   }

   public String getName() { return original.getName(); }
   public Object getCredentials() { return original.getCredentials(); }
   public Object getDetails() { return original.getDetails(); }   
   public Object getPrincipal() { return original.getPrincipal(); }
   public boolean isAuthenticated() { return original.isAuthenticated(); }
   public void setAuthenticated( boolean isAuthenticated ) throws IllegalArgumentException
   {
      original.setAuthenticated( isAuthenticated );
   }  
} 
```

然后在您的过滤器中执行此操作：

```
Authentication auth = SecurityContextHolder.getContext().getAuthentication();
GrantedAuthority extraRoles = new GrantedAuthority[2];
extraRoles[0] = new GrantedAuthorityImpl( "Role X" );
extraRoles[1] = new GrantedAuthorityImpl( "Role Y" );
AuthenticationWrapper wrapper = new AuthenticationWrapper( auth, extraRoles );
SecurityContextHolder.getContext().setAuthentication( wrapper ); 
```

身份验证现在被您的具有额外角色的版本替换。NB 您可能必须处理 Authentication 尚未通过身份验证的情况，因此其 getAuthorities() 返回 null。（包装器实现当前假设它总是从其包装的身份验证中获取一个非空数组）

# c# - 窗口之间的交互

> ID：283888
> 
> 赞同：2
> 
> 时间：2008-11-12T13:10:23.137
> 
> 标签：c#, delegates

在 C# 应用程序中的多个窗口之间进行交互的最佳/正确方式是什么？最近，我遇到了一个问题，其中一个程序窗口必须调用修改主窗口的方法。我的解决方案是创建类似工厂的类，它将安排所有底层模型数据并组织各种窗口之间的通信（通过委托）。但是，由于传递一两个代表不是问题，我开始思考如果我的其他窗口需要 10 个代表才能与主窗口正确交互怎么办？代表是好的解决方案吗？如何以良好的方式传递它们 - 通过构造函数、属性？或者也许需要使用这么多代表本身就是一些严重的设计缺陷？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T13:42:42.773

您需要通过控制器将模型从视图中拆分出来。放置一个能够同时具有表单引用并能够管理共享信息的对象。

另一种解决方案是将 formX 的引用发送给 formY，这样他们就可以进行通信了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T14:00:04.720

我们使用使用主题/观察者模式的自定义构建表单管理器。

每个打开的表单都会报告给 FormsManager，FromsManager 使自己成为表单的观察者。

它还使表单成为 FormsManager 的观察者。

因此，您最终会得到每个表单都观察 FormsManager 和 FormsManager 观察每个表单。然后，每个表单都可以通过 FormsManager 与任何其他表单进行通信，而无需每个表单都知道所有其他表单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T13:34:27.283

如果只需要和主窗口交互，为什么不在别人的构造函数中引用主窗口呢？

```
public class MainForm : Form
{
}

public class OtherForm : Form
{
    protected MainForm MainForm { get; set; }

    public OtherForm(MainForm mainForm) : base()
    {
        this.MainForm = mainForm;
    }
} 
```

编辑：

简单有效。

如果您的表单需要与应用程序的所有其他表单交互，那么[服务定位器](http://en.wikipedia.org/wiki/Service_locator_pattern)类型模式可能更适合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T13:34:52.837

以前使用 MFC，有一些东西可以通知所有窗口。您将传递一个带有参数的事件 id。

您可以对一个委托执行类似的操作，该委托将公开一个事件 ID 和一组参数。

这样做最大的好处是windows只需要实现一个网关。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T13:39:26.323

您可以使用单个委托，使用自定义 EventArgs 传递多个信息，例如：通知类型、附加参数等。

# asp.net - 在我的安装项目中包含另一个 MSI 文件

> ID：283890
> 
> 赞同：9
> 
> 时间：2008-11-12T13:11:32.527
> 
> 标签：asp.net, deployment, installation

我正在尝试为 ASP.NET 网站制作安装程序。我需要确保目标机器安装了 sqlxml。

我必须验证目标机器是否安装了软件，如果没有，请在主安装之前或之后启动一个 .msi 文件。

我是一个安装项目的完整新手，所以这可能很明显，但是在浏览网页几个小时后，我还没有找到令人满意的解决方案。我一直在阅读有关[WiX](http://en.wikipedia.org/wiki/WiX)等的信息，但我正在寻找（如果可能的话）一个简单的解决方案。

* * *

谢谢你俩！

我了解安装程序无法运行另一个安装程序。我正在考虑类似于先决条件（在项目属性中）的功能。在那里我可以检查一个组件，如果不是，它将自动安装。我不需要做任何其他事情。但是，对我来说最重要的是，如果不需要，安装将不会运行。

我也尝试了 .msm 解决方案，但我找不到任何解决方案。也许我可以自己做一个？不过我还没试过。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-12T13:20:27.267

不幸的是，您不能从另一个安装程序运行一个安装程序，因为一次只能运行一个安装程序。您需要将它们链接在一起并一个接一个地运行。谷歌“msi 链接”。这通常是 Visual Studio 等产品使用外部 setup.exe 的原因，它会一个接一个地运行安装程序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-12T15:15:50.277

看起来您需要“链接”安装 [http://objectmix.com/xml-soap/84668-installing-sqlxml-net-app.html](http://objectmix.com/xml-soap/84668-installing-sqlxml-net-app.html)

你可以在这里[http://www.microsoft.com/downloads/details.aspx?FamilyID=51D4A154-8E23-47D2-A033-764259CFB53B&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=51D4A154-8E23-47D2-A033-764259CFB53B&displaylang=en)

您可以将此添加为安装的先决条件吗？您使用什么来构建创建安装？

编辑：
我看看如何检查 SQLXML 是否已安装并遇到此问题：
[http ://www.tech-archive.net/Archive/SQL-Server/microsoft.public.sqlserver.xml/2005- 04/msg00110.html](http://www.tech-archive.net/Archive/SQL-Server/microsoft.public.sqlserver.xml/2005-04/msg00110.html)

我刚才使用的系统具有以下键 HKEY_CLASSES_ROOT \ SQLXMLX（注意末尾的 X），因此您可能需要对实际键进行更多调查。

我不熟悉 Visual Studio 安装创作，但如果您可以在 AppSearch 和 RegLocator 表中添加一个条目，您应该能够在安装开始时检查注册表项的存在。请参阅此处
[http://msdn.microsoft.com/en-us/library/aa371564(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa371564(VS.85).aspx)

Reglocator 表使您可以选择使用注册表中的值（如果找到）来设置属性。然后，您可以在自定义操作的条件中使用它。

很多东西要放在一起，但我希望它能让你朝着正确的方向前进。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T13:42:34.617

布伦特的回答是正确的。我只想补充一点，有时，您可以为您所依赖的位找到一个“合并模块”。那是一个 .msm 文件。您当然可以在 .msi 文件中包含 1 个或多个。我不知道合并模块是否可用于 SQLXML。对不起。

# javascript - 通过 Javascript 调用 WCF 服务

> ID：283891
> 
> 赞同：2
> 
> 时间：2008-11-12T13:11:45.397
> 
> 标签：javascript, wcf, web-services

如何通过 JavaScript 访问 WCF 服务？我的问题是，我必须通过 JavaScript 访问操作合同（我的网站没有启用 Ajax）。
以前用于调用 .asmx Web 服务，我使用以下代码片段

```
var xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
xmlHttp.open("POST", URL, false);
xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
xmlHttp.send(payload);
xmlData = xmlHttp.responseXML; 
```

其中 url 是我的网络服务位置。

现在，如果我尝试以相同的方式使用 wcf 服务，我将无法做到。很多技术人员都是通过AJAX的方式来解释的，我需要一种没有AJAX的方式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T13:28:45.953

通过使用 XMLHTTP，您正在使用 ajax。

这里有一个完整的例子：

[jQuery AJAX 调用 WCF REST 服务](http://www.west-wind.com/weblog/posts/324917.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T16:02:10.200

查看我之前发送的链接上的代码。当然你可以自己实现它，但这很可能是一个巨大的重复。

首先，您的 WCF 服务必须具有：

```
[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)] 
```

然后，在 javascript 端，更改

```
"Content-Type", "application/x-www-form-urlencoded" 
```

至

```
"Content-Type", "application/json" 
```

请记住，响应将是 json 格式的，因此使用解析器可能会很有用。

为什么你不想使用外部库？

# cross-platform - Ada 有预处理器吗？

> ID：283893
> 
> 赞同：7
> 
> 时间：2008-11-12T13:13:15.017
> 
> 标签：cross-platform, ada

为了在 C/C++ 中支持多个平台，可以使用预处理器来启用条件编译。例如，

```
#ifdef _WIN32
  #include <windows.h>
#endif 
```

你怎么能在 Ada 中做到这一点？Ada 有预处理器吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-20T13:57:26.480

您的问题的答案是否定的，Ada 没有内置于语言中的预处理器。这意味着每个编译器可能有也可能没有，并且没有用于预处理和条件编译之类的“统一”语法。这是故意的：它被认为对 Ada 精神“有害”。

几乎总有一些方法可以解决缺少预处理器的问题，但通常解决方案可能有点麻烦。例如，您可以将特定于平台的函数声明为“单独的”，然后使用构建工具编译正确的函数（项目系统，使用 pragma 正文替换，或非常简单的目录系统......把所有的 windows 文件在 /windows/ 和 /linux/ 中的所有 linux 文件，并包含平台的相应目录）。

话虽如此，GNAT 意识到有时您需要一个预处理器并创建了 gnatprep。无论编译器如何，它都应该可以工作（但您需要将其插入到构建过程中）。同样，对于简单的事情（如条件编译），您可能只使用 c 预处理器，甚至可以使用您自己的非常简单的预处理器。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-18T21:27:21.657

AdaCore 提供了[gnatprep](https://gcc.gnu.org/onlinedocs/gnat_ugn/Preprocessing-with-gnatprep.html)预处理器，专门用于 Ada。他们声明 gnatprep “不依赖于任何特殊的 GNAT 功能”，因此听起来它应该与非 GNAT Ada 编译器一起使用。他们的用户指南还提供了一些条件编译[建议](https://gcc.gnu.org/onlinedocs/gnat_ugn/Conditional-Compilation.html#Conditional-Compilation)。

我一直在使用 m4 的项目中，Ada 规范和正文文件分别后缀为“.m4s”和“.m4b”。

我的偏好是完全避免预处理，只使用专门的机构，设置 CM 和构建过程来管理它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-12T13:27:31.323

不可以，但是可以在命令行上的任何文件上调用 CPP 预处理器或 m4，或者使用 make 或 ant 等构建工具。我建议将您的 .ada 文件称为其他名称。我在java文件上做了一段时间。我调用 java 文件 .m4 并使用 make 规则创建 .java，然后以正常方式构建它。

我希望这会有所帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-11-25T03:00:08.270

是的，它有。

如果您使用的是 GNAT 编译器，则可以`gnatprep`用于进行预处理，或者如果您使用 GNAT Programming Studio，您可以配置项目文件以定义一些条件编译开关，例如

```
#if SOMESWITCH then
-- Your code here is executed only if the switch SOMESWITCH is active in your build configuration
#end if; 
```

在这种情况下，您可以使用`gnatmake`or`gprbuild`所以您不必`gnatprep`手动运行。

这非常有用，例如，当您需要使用甚至不同的交叉编译器为几个不同的操作系统编译相同的代码时。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-04-10T14:03:12.137

一些旧的 Ada1983 时代的编译器有一个名为 a.app 的包，它利用 Ada 的 # 前缀子集（在构建时解释）作为生成 Ada 的预处理语言（然后在编译时翻译成机器代码）。Rational 的 Verdix Ada 开发系统 (VADS) 似乎是几个 Ada 编译器中 a.app 的祖先。例如，Sun Microsystems 从 VADS 派生了 Ada SPARCompiler，因此也有一个.app。这与 IBM 使用 PL/I 作为 PL/I 的预处理器没有什么不同。

第 2 章是关于 a.app 的一些文档：http: [//dlc.sun.com/pdf/802-3641/802-3641.pdf](http://dlc.sun.com/pdf/802-3641/802-3641.pdf)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T14:23:03.697

不，不是的。

如果你真的想要一个，有办法得到一个（使用 C，使用独立的，等等）但是我反对它。没有一个是一个有目的的设计决定。预处理器的整个想法非常不合时宜。

C 的预处理器的大部分用途都可以在 Ada 中以其他更可靠的方式完成。唯一的主要例外是对源文件进行细微更改以支持跨平台。考虑到这在典型的跨平台 C 程序中被滥用了多少，我仍然很高兴 Ada 不支持它。很少有 C/C++ 开发人员可以控制自己以保持更改“较小”。结果可能有效，但人类通常几乎不可能阅读。

完成此任务的典型 Ada 方法是将不同的代码放在不同的文件中，并使用您的构建系统在编译时以某种方式在它们之间进行选择。Make 足够强大，可以帮助您做到这一点。

# python - 如何在 Windows 中使用 Popen 调用外部 .py 脚本并等待其完成

> ID：283894
> 
> 赞同：1
> 
> 时间：2008-11-12T13:13:31.413
> 
> 标签：python, windows

你有没有试过这个反馈调用一个外部的 zip.py 脚本来工作？我的 CGITB 没有显示任何错误消息。它根本没有调用外部 .py 脚本来工作。它只是跳过涌出。如果您能帮助我在 feedback.py 中使这个 zip.py 可调用，我将不胜感激。

问候。大卫

```
#**********************************************************************
# Description:
#    Zips the contents of a folder.
# Parameters:
#   0 - Input folder.
#   1 - Output zip file. It is assumed that the user added the .zip 
#       extension.  
#**********************************************************************

# Import modules and create the geoprocessor
#
import sys, zipfile, arcgisscripting, os, traceback
gp = arcgisscripting.create()

# Function for zipping files.  If keep is true, the folder, along with 
#  all its contents, will be written to the zip file.  If false, only 
#  the contents of the input folder will be written to the zip file - 
#  the input folder name will not appear in the zip file.
#
def zipws(path, zip, keep):
    path = os.path.normpath(path)
    # os.walk visits every subdirectory, returning a 3-tuple
    #  of directory name, subdirectories in it, and filenames
    #  in it.
    #
    for (dirpath, dirnames, filenames) in os.walk(path):
        # Iterate over every filename
        #
        for file in filenames:
            # Ignore .lock files
            #
            if not file.endswith('.lock'):
                gp.AddMessage("Adding %s..." % os.path.join(path, dirpath, file))
                try:
                    if keep:
                        zip.write(os.path.join(dirpath, file),
                        os.path.join(os.path.basename(path),
                        os.path.join(dirpath, file)[len(path)+len(os.sep):]))
                    else:
                        zip.write(os.path.join(dirpath, file),            
                        os.path.join(dirpath[len(path):], file)) 

                except Exception, e:
                    gp.AddWarning("    Error adding %s: %s" % (file, e))

    return None

if __name__ == '__main__':
    try:
        # Get the tool parameter values
        #
        infolder = gp.GetParameterAsText(0)
        outfile = gp.GetParameterAsText(1)      

        # Create the zip file for writing compressed data. In some rare
        #  instances, the ZIP_DEFLATED constant may be unavailable and
        #  the ZIP_STORED constant is used instead.  When ZIP_STORED is
        #  used, the zip file does not contain compressed data, resulting
        #  in large zip files. 
        #
        try:
                zip = zipfile.ZipFile(outfile, 'w', zipfile.ZIP_DEFLATED)
                zipws(infolder, zip, True)
                zip.close()
        except RuntimeError:
                # Delete zip file if exists
                #
                if os.path.exists(outfile):
                        os.unlink(outfile)
                zip = zipfile.ZipFile(outfile, 'w', zipfile.ZIP_STORED)
                zipws(infolder, zip, True)
                zip.close()
                gp.AddWarning("    Unable to compress zip file contents.")

        gp.AddMessage("Zip file created successfully")

    except:
        # Return any python specific errors as well as any errors from the geoprocessor
        #
        tb = sys.exc_info()[2]
        tbinfo = traceback.format_tb(tb)[0]
        pymsg = "PYTHON ERRORS:\nTraceback Info:\n" + tbinfo + 
                "\nError Info:\n    " +                 str(sys.exc_type) + 
                ": " + str(sys.exc_value) + "\n"
        gp.AddError(pymsg)

        msgs = "GP ERRORS:\n" + gp.GetMessages(2) + "\n"
        gp.AddError(msgs) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T14:58:20.143

*   `zip()`是 Python 中的内置函数。因此，将其`zip`用作变量名是一种不好的做法。`zip_`可以用来代替。

*   `execfile()`函数读取并执行 Python 脚本。

*   可能您实际上只需要`import zip_`在 feedback.py 而不是`execfile()`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T16:15:35.587

耶ArcGIS。

只是为了澄清您如何尝试使用 popen 调用此脚本，您可以发布一些代码吗？

如果您通过 ArcGIS 环境中的另一个脚本调用此脚本，那么问题是，当您使用 Popen 时，该脚本不会在 ArcGIS 环境中调用，而是会在 Windows 中调用。所以你将失去对它的所有真正控制。

也只是另一个 ArcGIS 评论，您从未初始化地理处理器的许可。

我的建议将您的代码重构为一个简单地尝试压缩文件的模块函数，如果它失败将消息打印到 ArcGIS。

如果你想发布你是如何调用它的，以及它是如何运行的。

# sharepoint - 从 SharePoint 工作流安排约会

> ID：283896
> 
> 赞同：3
> 
> 时间：2008-11-12T13:14:57.230
> 
> 标签：sharepoint, workflow, icalendar

我需要根据员工的请求在某人的 Outlook 日历中进行约会。该应用程序在 SharePoint (WSS 3.0) 中运行。我的第一印象是使用 iCal 或发送会议请求，但我之前都没有这样做过，我正在寻找一种非常快速和简单的方法来完成它。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T14:59:13.603

抱歉，我知道或找不到简单的答案。我确信您可以通过代码来完成，但在 SharePoint 的点击式界面中并不容易。

从[这个线程](http://social.msdn.microsoft.com/forums/en-US/sharepointworkflow/thread/155ca2fe-60e7-49d3-81b3-2c8a9f3b9433/)看来，在日历列表上编写事件处理程序将是最有效的方法。

因此，从 10,000 英尺的角度来看，您将在 Sharepoint 中构建一个系统或工作流，从而在 SharePoint 日历中创建日历条目。然后有一个事件侦听器，其工作是在该 SP 日历中创建新项目时创建 iCal 电子邮件。

Brian Wilson（不是海滩男孩）有几篇关于[SP 中事件处理程序入门的博客文章](http://blogs.msdn.com/brianwilson/archive/2007/03/05/part-1-event-handlers-everything-you-need-to-know-about-microsoft-office-sharepoint-portal-server-moss-event-handlers.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T13:35:10.647

实际上，你可以做到。使用 sharepoint 设计器，设置工作流以根据列表中的条目（新的或编辑的）将项目添加到列表（日历）。然后，您需要将 Outlook 与共享点日历​​同步。

# configuration - 一台机器上的多个奴隶与哈德森

> ID：283919
> 
> 赞同：3
> 
> 时间：2008-11-12T13:26:10.267
> 
> 标签：configuration, build-process, hudson

我可以在一台机器上运行多个 hudson 从站，我的意思是只有一个构建过程的真正的从站吗？

我的问题是，我有一个具有 3 个构建进程的从站，使用锁和闩锁 (V0.4) 来运行三种不同类型的构建作业。但有时我会遇到一个问题，即一种以上的构建作业同时运行，或者它阻止了从属的构建过程并且不运行。

提前感谢您的见解。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T22:38:04.107

是的，Hudson 应该能够在一台机器上运行多个从站。我对我的构建做了一个有限的形式，以便每个作业都在单独的硬盘上运行。就我而言，这意味着我有一个主服务器，一个从服务器与主服务器在同一台机器上运行。可以使用 3 个从属设备，每个从属设备有 1 个执行程序，而不是一个从属设备有 3 个执行程序，但是它不应该影响锁定，所以如果你有不同的物理驱动器并且想要更高的吞吐量，我只会看到它的用途。

我相信 Hudson 中的锁（即这个作业正在运行）和锁和闩锁（这个锁正在使用中）跨越给定 hudson 设置的所有从站和主站。因此，如果从站 1 正在运行持有锁 A 的作业，从站 2 也将无法启动持有锁 A 的作业。我不完全清楚这是否是您正在寻求的行为。

但是，有一个重要的注意事项：

据说目前 hudson 核心中存在一个错误，当使用 locks-and-latches 插件时，有时允许多个作业以同一个锁启动。我不是 Hudson 锁定的内部专家，也不是 locks-and-latches 插件，但如果您想要更深入的解释，有一个对话听起来与[hudson 用户邮件列表](https://hudson.dev.java.net/servlets/ProjectMailingListList)相关（users@hudson.dev .java.net)。

[这是存档的对话](http://www.nabble.com/State-of-Locks-and-Latches-plugin.-td20344135.html#a20344135)

locks-and-latches 插件的作者通常对问题非常敏感。

# java - 什么是最好的 Java 社交网络框架？

> ID：283922
> 
> 赞同：19
> 
> 时间：2008-11-12T13:28:58.763
> 
> 标签：java, social-networking, opensocial

我想为我的公司员工和合作伙伴创建一个私人定制的社交网络，以便他们可以协作、交换消息、分享经验（活动、书籍参考等）并分组到社区中。有人知道开始开发这个的好Java框架吗？

我会寻找包含基本组件的东西，例如个人资料、朋友列表、社区、事件、消息等。每个组件都可以扩展以实现特定领域的功能。如果它也支持 OpenSocial，那就太好了。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-12T14:21:45.037

Shindig 在 Apache 孵化：http:
[//incubator.apache.org/projects/shindig.html](http://incubator.apache.org/projects/shindig.html)

关于 Shindig 的 YouTube 链接：
[http ://www.youtube.com/watch?v=ZcWszaReqXI](http://www.youtube.com/watch?v=ZcWszaReqXI)

* * *

开源社交网络列表>应用程序<用 Java 编写：http: [//www.manageability.org/blog/stuff/java-open-source-social-network](http://www.manageability.org/blog/stuff/java-open-source-social-network)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T14:25:07.743

如果您还想利用*社交*网络应用程序中收集的数据，[集体智能在行动中可能会有所帮助。](http://www.manning.com/alag/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-26T20:52:52.770

结帐春季社交

[http://blog.springsource.com/2010/11/03/socializing-spring-applications/](http://blog.springsource.com/2010/11/03/socializing-spring-applications/)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-11-29T00:57:14.853

我已经建立了自己的社交网络功能，例如创建组添加人员到组、朋友列表、消息、事件、评论、博客等。如果有人感兴趣，我只能为您提供 jar 和其余列表您必须使用这些功能才能工作的技术。如果您想在顶部添加自己的业务功能，那么我可以指导您完成大量解决方案...

问候，阿什

# updatepanel - 通过回发保存和加载 CollapsiblePanelExtender 控制状态

> ID：283924
> 
> 赞同：1
> 
> 时间：2008-11-12T13:29:10.837
> 
> 标签：updatepanel, controls, state, collapsiblepanelextender

我正在使用 asp.net/c# 并且有许多在页面加载时动态创建的可折叠面板扩展器。控件位于每 5 秒更新一次的更新面板中。我遇到的问题是每当更新面板更新控件的状态时都会重置。例如，可折叠面板扩展器以折叠状态开始，如果我随后展开面板并发生更新，则面板将设置回折叠状态。

如何保存 Collapsible Panel Extender 的状态，然后在更新发生后重新加载状态？这甚至是正确的方法吗？

谢谢

杰克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T17:09:31.540

找到了答案，您需要做的就是在页面初始化期间添加控件而不是页面加载。然后他们保留那里的状态。

# c# - 继承类的浅拷贝

> ID：283925
> 
> 赞同：2
> 
> 时间：2008-11-12T13:29:19.947
> 
> 标签：c#, inheritance, shallow-copy

好的，所以我有一个名为 Product 的抽象基类，一个继承 Product 的 KitItem 类和一个继承 KitItem 的 PackageKitItem 类。IE。

```
Product
KitItem : Product
PackageKitItem : KitItem 
```

我已经加载了我的 KitItems，我需要加载 PackageKitItems 的集合，它们实际上是 KitItems 的浅表副本。

目前，我们正在 Product 构造函数中做一个对我来说感觉很糟糕的浅拷贝，如下所示：

```
public Product(Product product)
        {
            FieldInfo[] fields = product.GetType().GetFields(BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance);

            // copy each value over to 'this'
            foreach (FieldInfo fi in fields)
                fi.SetValue(this, fi.GetValue(product));
        } 
```

我试过在 KitItem 上设置一个副本，如下所示：

```
public KitItem ShallowCopy()
        {
            return (KitItem)this.MemberwiseClone();
        } 
```

并这样称呼它：

```
PackageKitItem tempPackKitItem = (PackageKitItem)packKitItem.ShallowCopy(); 
```

但我得到一个无效的演员表。我正在寻找实现这一目标的最佳方法的想法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-15T19:48:33.713

您遇到的问题是，由于 ShallowCopy() 是 KitItem 的成员，MemberwiseClone() 只是复制 KitItem 字段并返回 KitItem，即使原始对象是 PackageKitItem。

我认为在这种情况下你必须做的添加到 KitItem：

```
public virtual KitItem ShallowCopy()        
{            
  return (KitItem) this.MemberwiseClone();        
} 
```

在 PackageKitItem 中：

```
public override KitItem ShallowCopy()        
{            
    return (PackageKitItem) this.MemberwiseClone();        
} 
```

因此，根据您尝试 ShallowCopy() 的对象，您将获得正确的 MemberwiseClone() 调用。

如果你想更进一步，你可以在 Product 中定义一个 ShallowCopy() （返回一个 Product），然后在 KitItem 和 PackageKitItem 中覆盖版本，每个版本都返回它们各自的浅拷贝。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T14:08:06.437

奇怪的是，我在 Visual Studio 2008 上执行此操作时没有出错。我发布了代码，以便您可以看到我缺少什么或我假设的错误。我的猜测是问题出在您没有发布的班级成员之一。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.Reflection;

namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            PackageKitItem PKI = new PackageKitItem();
            PKI.ID      = 1;
            PKI.KitName = "2";
            PKI.Name    = "3";
            PKI.Package = 4;

            PackageKitItem tempPackKitItem = (PackageKitItem)PKI.ShallowCopy();

        }
    }

}

public class Product
{
    public int ID;
    public string Name;

    public Product()
    {
    }

    public Product(Product product)
    {
        FieldInfo[] fields = product.GetType().GetFields(BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance);

        // copy each value over to 'this'
        foreach (FieldInfo fi in fields)
            fi.SetValue(this, fi.GetValue(product));
    }

}

public class KitItem:Product
{
    public string KitName;
    public KitItem ShallowCopy()
    {
        return (KitItem)this.MemberwiseClone();
    }

}

public class PackageKitItem : KitItem
{
    public int Package;

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T14:04:36.910

在您的 Product 构造函数中，您已经在做某种形式的浅拷贝，不是吗？如果您没有覆盖您的构造函数，那么您应该能够创建一个新的 PackageKitItem，它接收一个 KitItem 作为其参数。

```
PackageKitItem tempPackKitItem = new tempPackKitItem(kitItem); 
```

也许我只是误解了你的问题。

# silverlight - Silverlight - 数据绑定不监听 PropertyChanged 事件

> ID：283931
> 
> 赞同：1
> 
> 时间：2008-11-12T13:33:41.140
> 
> 标签：silverlight, data-binding

有人可以向我解释这里发生了什么吗？
我正在代码中创建绑定。

目标对象是 UserControl
目标属性是布尔型 DependencyProperty
源对象是 FrameworkElement 并实现 INotifyPropertyChanged
源属性是 ObservableCollection 类型

发生什么了：

*   绑定是在代码中创建的，结果 BindingExpressionBase 看起来很好，模式是 OneWay，目标值设置正确（此时）

    绑定 b = 新绑定（）；
    b.Path = "SourceProperty";
    b.Source = SourceObject；
    BindingExpressionBase e = this.SetBinding(TargetProperty, b);

*   然后，源属性会因另一个数据绑定而更改。UserControl 尝试触发 PropertyChanged 事件。

*   ....但没有人在听。PropertyChanged 为空。

我确信没有其他任何东西被分配给目标属性，所以它仍然应该被绑定。为什么绑定不监听 PropertyChanged 事件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T15:29:01.470

好吧，我自己找到了答案。这是 Silverlight 中的一个错误。

执行以下操作的代码

```
if (PropertyChanged != null)  
{  
    PropertyChanged(this, new PropertyChangedEventArgs(propertyName));  
} 
```

必须直接在您绑定的类上，而不是在其祖先上。我将它放在基类的 FirePropertyChanged() 方法中，并将其移至派生类会有所不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-12T16:16:55.587

对于遇到这种情况的其他人：**确保您在 ViewModel 上实现 INotifyPropertyChanged**！

# delphi - 从 TObjectList 中提取对象

> ID：283942
> 
> 赞同：2
> 
> 时间：2008-11-12T13:38:46.433
> 
> 标签：delphi, tobjectlist, tlist

我有一个 OwnsObjects = true 的 TObjectList。它包含相当多的对象。现在我想从该列表中删除索引 Idx 处的对象，而不释放它。

提取方法是唯一的选择吗？

`ExtractedObject := TheList.Extract(TheList[Idx]);`

所有其他方法似乎都释放了该对象。我正在寻找更高效的东西，它不会每次都进行线性搜索，因为我已经知道对象的索引。有点像超载...

`ExtractedObject := TheList.Extract(Idx);`

...不存在的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-12T13:57:43.273

为什么不直接将 OwnsObjects 设置为 false，进行删除，然后再次将其设置为 true？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T14:45:58.513

如果您查看删除代码，它是导致释放发生的 notify 方法。

这应该工作：

```
 TMyObjectList = Class(TObjectList)
  private
    fNotify: Boolean;
    { Private declarations }
    procedure EnableNotification;
    procedure DisableNotification;
  protected
    procedure Notify(Ptr: Pointer; Action: TListNotification); override;
  public
    constructor Create(AOwnsObjects: Boolean);overload;
    constructor Create; overload;
    function Extract(const idx : Integer) : TObject;
  end;

constructor TMyObjectList.Create(AOwnsObjects: Boolean);
begin
  inherited Create(AOwnsObjects);
  fNotify := True;
end;

constructor TMyObjectList.Create;
begin
  inherited Create;
  fNotify := True;
end;

procedure TMyObjectList.DisableNotification;
begin
  fnotify := False;
end;

procedure TMyObjectList.EnableNotification;
begin
  fNotify := True;
end;

function TMyObjectList.Extract(const idx: Integer) : TObject;
begin
  Result := Items[idx];
  DisableNotification;
  try
    Delete(idx);
  finally
    EnableNotification;
  end;
end;

procedure TMyObjectList.Notify(Ptr: Pointer; Action: TListNotification);
begin
 if fNotify then
   inherited;
end; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T15:12:45.463

这是类助手可以派上用场的地方

```
TObjectListHelper = class helper for TObjectList
  function ExtractByIndex(const AIndex: Integer): TObject;
end;

function TObjectListHelper.ExtractByIndex(const AIndex: Integer): TObject;
begin
  Result := Items[AIndex];
 if Result<>nil then
   Extract(Result);
end; 
```

您现在可以使用：

```
MyObjList.ExtractByIndex(MyIndex); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T21:05:43.787

提议的帮助类（由 Gamecat 提出）将导致 Thomas 想要摆脱的相同查找。

如果您查看源代码，您可以看到 Extract() 的真正作用，然后使用相同的方法。

我会建议类似 tis：

```
obj := list[idx];
list.list^[idx] := nil;  //<- changed from list[idx] := nil;
list.delete(idx); 
```

这将为您提供对象，就像 Extract() 所做的那样，然后将其从列表中删除，无需任何查找。现在你可以把它放在一个方法中，一个助手类或子类或者你喜欢的任何地方。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T13:45:08.963

我前段时间不使用 Delphi/C++Builder，但据我所知，这是唯一的方法。我的建议是改用 TList，并在需要时手动删除对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T20:13:15.663

有什么问题：

ExtractedObject := TExtractedObject.Create;
ExtractedObject.Assign(Thelist[Idx]);
TheList.Delete(idx);

创建和分配需要时间，但搜索列表不需要时间。效率取决于对象的大小 -v- 列表的大小。

# silverlight - 查找与 Silverlight ItemsControl 中的项目对应的 UI 元素

> ID：283943
> 
> 赞同：1
> 
> 时间：2008-11-12T13:39:05.217
> 
> 标签：silverlight, itemscontrol

我有一个 Silverlight ItemsControl 显示的字符串列表。DataTemplate 是一个以 TextBlock 作为其子项的 Border 控件。如何访问与项目对应的边界控制？例如，我可能想这样做来更改背景颜色。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T19:20:25.807

一种更简单的方法是获取文本块的父级并将其转换为边框。这是一个简单的例子：

Xaml

```
<Grid>
    <ItemsControl x:Name="items">
        <ItemsControl.ItemTemplate>
            <DataTemplate>
                <Border>
                    <TextBlock MouseEnter="TextBlock_MouseEnter" MouseLeave="TextBlock_MouseLeave" Text="{Binding}" />
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
</Grid> 
```

背后的代码

```
public Page()
{
    InitializeComponent();

    items.ItemsSource = new string[] { "This", "Is", "A", "Test" };
}

private void TextBlock_MouseEnter(object sender, MouseEventArgs e)
{
    var tx = sender as TextBlock;
    var bd = tx.Parent as Border;
    bd.Background = new SolidColorBrush(Colors.Yellow);
}

private void TextBlock_MouseLeave(object sender, MouseEventArgs e)
{
    var tx = sender as TextBlock;
    var bd = tx.Parent as Border;
    bd.Background = new SolidColorBrush(Colors.White);
} 
```

该示例通过抓取文本框的父级来设置边框的背景。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T13:49:16.223

您可以覆盖 ItemsControl.GetContainerForItemOverride 方法并将对象-容器对保存在字典中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-13T19:17:38.137

看到这个： http: [//msdn.microsoft.com/en-us/library/bb613579.aspx](http://msdn.microsoft.com/en-us/library/bb613579.aspx)这个：http: [//blogs.msdn.com/wpfsdk/archive/2007/04/16/how-do-i -programmatically-interact-with-template-generated-elements-part-ii.aspx](http://blogs.msdn.com/wpfsdk/archive/2007/04/16/how-do-i-programmatically-interact-with-template-generated-elements-part-ii.aspx)。不幸的是，它在 SL 中不起作用，因为 SL DataTemplate 类没有 FindName 方法。

# c# - 使用 foreach (...) 语法同时增加循环内的索引变量

> ID：283950
> 
> 赞同：4
> 
> 时间：2008-11-12T13:41:20.140
> 
> 标签：c#, .net, syntax, loops, for-loop

在查看 C# 代码时，我经常看到这样的模式：

```
DataType[] items = GetSomeItems();
OtherDataType[] itemProps = new OtherDataType[items.Length];

int i = 0;
foreach (DataType item in items)
{
    // Do some stuff with item, then finally
    itemProps[i] = item.Prop;
    i++;
} 
```

for 循环迭代 中的对象`items`，但也保留一个计数器 ( `i`) 用于迭代`itemProps`。我个人不喜欢这种额外的`i`闲逛，而是可能会做类似的事情：

```
DataType[] items = GetSomeItems();
OtherDataType[] itemProps = new OtherDataType[items.Length];

for (int i = 0; i < items.Length; i++)
{
    // Do some stuff with items[i], then finally
    itemProps[i] = items[i].Prop;
} 
```

我不知道的第一种方法可能有一些好处吗？这是每个人都试图使用这种花哨`foreach (...)`语法的结果吗？我对你对此的看法很感兴趣。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-12T13:49:11.013

如果您使用的是 C# 3.0，那就更好了；

```
OtherDataType[] itemProps = items.Select(i=>i.Prop).ToArray(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-12T13:46:55.030

如果 i 在数组之外，那么 if 在循环完成后将可用。如果您想计算项目的数量并且集合没有提供 .Count 或 .UBound 属性，那么这可能很有用。

像你一样，我通常会使用第二种方法，对我来说看起来更干净。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T13:46:29.787

在这种情况下，我不这么认为。但有时，集合并没有实现`this[int index]`，但它确实实现了 GetEnumerator()。在后一种情况下，您没有太多选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T14:38:22.630

foreach (DataType item in items) 这个 foreach 循环清楚地表明您正在迭代所有 DataType 项目，嗯，是的，项目。也许它会使代码更长一点，但它不是一个“坏”的代码。对于另一个 for 循环，您需要检查括号内的内容以了解该循环的用途。

这个例子的问题在于你同时迭代两个不同的数组，我们不经常这样做..所以我们被困在两种策略之间..要么我们“有点”花哨-foreach 如你所说，或者我们回到旧的不那么受欢迎的 for(int i = 0; i ...)。（当然，除了这两种方法之外，还有其他方法）

所以，我认为这是 Vim 与 Emacs 的问题，在 For 与 Foreach 循环的问题中回归 :) 喜欢 for() 的人会说这个 foreach 没用，可能会导致性能问题，而且很大。喜欢 foreach 的人会说，如果我们可以轻松阅读代码和维护它，我们不在乎是否有两行额外的代码。

最后，我首先在第一个示例范围之外，在第二个示例范围内.. 原因是什么？！因为如果您在 foreach 之外使用 i ，我会以不同的方式调用。而且，在我看来，我更喜欢 foreach 方式，因为您可以立即看到正在发生的事情。您也不必考虑它是 < 还是 =。您立即知道您正在遍历所有列表，但是，遗憾的是，人们会忘记最后的 i++ :D 所以，我说 Vim！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T14:05:25.147

从语义上讲，它们可能是等价的，但实际上在枚举器上使用 foreach 可以为编译器提供更多优化空间。

我不记得我脑海中的所有论点，但它们在*有效 C#*中有很好的介绍，推荐阅读。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T15:17:50.413

Lets not forget that some collections do not implement a direct access operator[] and that you have to iterate using the IEnumerable interface which is most easily accessed with foreach().

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-12T13:51:30.683

一些数据结构不太适合随机访问，但可以非常快速地迭代（树、链表等）。因此，如果您需要迭代其中一个但由于某种原因需要计数，那么您注定要走丑陋的道路......

# asp.net - 处理 ASP.NET 和母版页中的相对文件路径

> ID：283951
> 
> 赞同：1
> 
> 时间：2008-11-12T13:41:30.530
> 
> 标签：asp.net, root, master-pages, filepath

这可能是一个令人痛苦的简单问题，对此我将被嘲笑，但我在母版页中使用文件路径时遇到了困难。我相信这是因为如果子目录中的页面要使用母版页，则文件路径不正确。

要解决这个问题，我需要从根目录获取文件路径，但我似乎无法让它工作。

我试过：

```
<script type="text/javascript" src="~/jQueryScripts/jquery.js"></script> 
```

和

```
<script type="text/javascript" src="../jQueryScripts/jquery.js"></script> 
```

也没有运气！

关于如何告诉它从根目录获取文件路径的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T13:49:55.180

我只是通过文件路径假设，您实际上是指 url（或 uri，我忘记了哪个是部分的）。

没有~，第一个例子应该可以工作。 `<script type="text/javascript" src="/jQueryScripts/jquery.js"></script>`会导致浏览器请求[http://www.example.com/jQueryScripts/jquery.js](http://www.example.com/jQueryScripts/jquery.js)（其中 www.example.com 是您的域）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T13:59:27.203

我相信你需要`runat=server`在这个 URL rebase 的`<head>`标签中`MasterPage`工作。

```
<head runat="server"> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T14:08:59.273

首先前面的波浪号是用于服务器控件的 asp.net 东西，在基本的 HTML 中不起作用。

无需详细说明，您可以在前面使用斜杠 (/)，如果它不是根站点，则包括 Web 应用程序名称。

或者您可以将代码放在您的母版页中以动态包含脚本，并让它处理路径。像：

```
 public void AddJavascript(string javascriptUrl)
    {   
        HtmlGenericControl script = new HtmlGenericControl("script");
        script.Attributes.Add("type", "text/javascript");
        javascriptUrl += "?v" + Assembly.GetExecutingAssembly().GetName().Version;
        script.Attributes.Add("src", ResolveUrl(javascriptUrl));
        Page.Header.Controls.Add(script);
    } 
```

上面的代码还附加了程序集版本。我主要将其用于开发，因此每当我构建时，我的 javascript 文件都会得到更新。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T14:21:37.830

您可以使用**Page.ResolveUrl**方法来解决这个问题

例如：

```
<script type="text/javascript" src="<%=Page.ResolveUrl("~/jQueryScripts/jquery.js")%>"></script> 
```

# javascript - 有没有办法在使用 data: URI 时指定建议的文件名？

> ID：283956
> 
> 赞同：248
> 
> 时间：2008-11-12T13:42:57.767
> 
> 标签：javascript, html, url, data-uri, save-as

例如，如果您点击链接：

`data:application/octet-stream;base64,SGVsbG8=`

浏览器将提示您下载一个文件，该文件由超链接本身中以 base64 格式保存的数据组成。有没有办法在标记中建议默认名称？如果没有，是否有 JavaScript 解决方案？

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2011-08-04T14:44:32.040

使用`download`属性：

```
<a download='FileName' href='your_url'> 
```

[该`download`属性适用于](http://caniuse.com/#search=download)Chrome、Firefox、Edge、Opera、桌面版 Safari 10+、iOS Safari 13+，不适用于 IE11。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2013-05-13T13:23:35.103

如今，Chrome 使这变得非常简单：

```
function saveContent(fileContents, fileName)
{
    var link = document.createElement('a');
    link.download = fileName;
    link.href = 'data:,' + fileContents;
    link.click();
} 
```

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2014-09-08T00:22:41.777

**仅限 HTML：**使用`download`属性：

```
<a download="logo.gif" href="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">Download transparent png</a>
```

* * *

**仅限 Javascript：**您可以使用以下代码保存任何数据 URI：

```
function saveAs(uri, filename) {
  var link = document.createElement('a');
  if (typeof link.download === 'string') {
    link.href = uri;
    link.download = filename;

    //Firefox requires the link to be in the body
    document.body.appendChild(link);

    //simulate click
    link.click();

    //remove the link when done
    document.body.removeChild(link);
  } else {
    window.open(uri);
  }
}

var file = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'
saveAs(file, 'logo.gif');
```

**Chrome、Firefox 和 Edge 13+**将使用指定的文件名。

**IE11、Edge 12 和 Safari 9**（[不支持该`download`属性](http://caniuse.com/#feat=download)）将使用其默认名称下载文件，或者如果文件类型受支持，**它们只会在新选项卡中显示它**：图像、视频、音频文件，……</p>

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2008-11-12T13:52:33.723

根据[RFC 2397](https://www.rfc-editor.org/rfc/rfc2397)，不，没有。

~~似乎也没有您可以使用的元素的任何[属性。](http://www.w3schools.com/tags/tag_a.asp)`<a>`~~

然而 HTML5 随后[`download`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#Attributes)在元素上引入了该属性`<a>`，尽管在撰写本文时支持并不普遍（例如，不支持 MSIE）

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2011-06-05T01:49:33.417

我在 netwerk/protocol/data/nsDataHandler.cpp 中查看了一些 firefox 源

数据处理程序仅解析内容/类型和字符集，并查看字符串中是否有“;base64”

rfc 没有指定文件名，至少 firefox 没有为它处理文件名，代码生成一个随机名称加上“.part”

我还检查了 Firefox 日志

```
[b2e140]: DOCSHELL 6e5ae00 InternalLoad data:application/octet-stream;base64,SGVsbG8=
[b2e140]: Found extension '' (filename is '', handling attachment: 0)
[b2e140]: HelperAppService::DoContent: mime 'application/octet-stream', extension ''
[b2e140]: Getting mimeinfo from type 'application/octet-stream' ext ''
[b2e140]: Extension lookup on '' found: 0x0
[b2e140]: Ext. lookup for '' found 0x0
[b2e140]: OS gave back 0x43609a0 - found: 0
[b2e140]: Searched extras (by type), rv 0x80004005
[b2e140]: MIME Info Summary: Type 'application/octet-stream', Primary Ext ''
[b2e140]: Type/Ext lookup found 0x43609a0 
```

如果您想查看 Mozilla 源代码，有趣的文件：

```
data uri handler: netwerk/protocol/data/nsDataHandler.cpp
where mozilla decides the filename: uriloader/exthandler/nsExternalHelperAppService.cpp
InternalLoad string in the log: docshell/base/nsDocShell.cpp 
```

我认为您现在可以停止搜索解决方案，因为我怀疑没有:)

正如在这个线程中注意到的 html5 具有`download`属性，它也适用于 firefox 20 [http://www.whatwg.org/specs/web-apps/current-work/multipage/links.html#attr-hyperlink-download](http://www.whatwg.org/specs/web-apps/current-work/multipage/links.html#attr-hyperlink-download)

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2013-04-05T11:19:07.527

以下 Javascript 代码段通过使用链接的新“下载”属性并模拟点击在 Chrome 中运行。

```
function downloadWithName(uri, name) {
  var link = document.createElement("a");
  link.download = name;
  link.href = uri;
  link.click();
} 
```

以下示例显示了它的用法：

```
downloadWithName("data:,Hello%2C%20World!", "helloWorld.txt") 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2011-05-30T00:03:08.527

不。

整个目的是它是一个数据流，而不是一个文件。数据源不应该知道将其作为文件处理的用户代理......而且它没有。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-09-13T14:57:11.830

您可以将下载属性添加到锚元素。

样本：

```
<a download="abcd.cer"
    href="data:application/stream;base64,MIIDhTC......">down</a> 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2015-01-24T10:56:59.247

使用[service workers](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API/Using_Service_Workers)，这最终是真正意义上的可能。

1.  创建一个虚假的 URL。例如 /saveAs/myPrettyName.jpg
2.  使用 URL in `<a href, <img src`，window.open( url )，绝对可以使用“真实” URL 完成的任何事情。
3.  在 worker 内部，捕获 fetch 事件，并使用正确的数据进行响应。

即使用户在新选项卡中打开文件并尝试将其保存在那里，浏览器现在也会建议 myPrettyName.jpg。就好像文件来自服务器一样。

```
// In the service worker
self.addEventListener( 'fetch', function(e)
{
    if( e.request.url.startsWith( '/blobUri/' ) )
    {
        // Logic to select correct dataUri, and return it as a Response
        e.respondWith( dataURLAsRequest );
    }
}); 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2011-05-30T00:24:18.097

看看这个链接： http: [//lists.w3.org/Archives/Public/uri/2010Feb/0069.html](http://lists.w3.org/Archives/Public/uri/2010Feb/0069.html)

引用：

> 它甚至可以像这样（至少在 Opera 中）在结尾处使用 ;base64 工作（如，不会导致问题）：
> 
> **data:text/plain;charset=utf-8;headers=Content-Disposition%3A%20attachment%3B%20filename%3D%22with%20spaces.txt%22%0D%0AContent-Language%3A%20en;base64,4oiaDQo% 3D**

讨论的其余消息中也有一些信息。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-02-20T17:25:31.977

这是一个基于 Holf 版本的 jQuery 版本，适用于 Chrome 和 Firefox，而他的版本似乎只适用于 Chrome。在身体上添加一些东西来做到这一点有点奇怪，但如果有人有更好的选择，我完全赞成。

```
var exportFileName = "export-" + filename;
$('<a></a>', {
    "download": exportFileName,
    "href": "data:," + JSON.stringify(exportData, null,5),
    "id": "exportDataID"
}).appendTo("body")[0].click().remove(); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-01-11T22:32:43.373

谷歌代码上有一个对我有用的小变通脚本：

[http://code.google.com/p/download-data-uri/](http://code.google.com/p/download-data-uri/)

它添加一个包含数据的表单，提交它，然后再次删除该表单。哈基，但它为我完成了工作。需要 jQuery。

该线程出现在 Google 代码页面之前的 Google 中，我认为将链接也放在此处可能会有所帮助。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-05-30T00:18:06.990

（此答案已被新技术弃用，但出于历史兴趣将保留在这里。）

~~这有点骇人听闻，但我以前也遇到过同样的情况。我在 javascript 中动态生成一个文本文件，并希望通过使用 data-URI 对其进行编码来提供下载。~~

这可以通过~~较小~~的主要用户干预来实现。生成链接`<a href="data:...">right-click me and select "Save Link As..." and save as "example.txt"</a>`。正如我所说，这很不优雅，但如果您不需要专业的解决方案，它就可以工作。

~~这可以通过使用闪存先将名称复制到剪贴板来减轻痛苦。当然，如果您让自己使用 Flash 或 Java（我认为现在浏览器支持越来越少？），您可能会找到另一种方法来做到这一点。~~

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-01-02T18:51:46.967

这个适用于 Firefox 43.0（旧版本未测试）：

**dl.js：**

```
function download() {
  var msg="Hello world!";
  var blob = new File([msg], "hello.bin", {"type": "application/octet-stream"});

  var a = document.createElement("a");
  a.href = URL.createObjectURL(blob);

  window.location.href=a;
} 
```

**dl.html**

```
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8"/>
    <title>Test</title>
    <script type="text/javascript" src="dl.js"></script>
</head>

<body>
<button id="create" type="button" onclick="download();">Download</button>
</body>
</html> 
```

如果单击按钮，它会提供一个名为*hello.bin*的文件供下载。诀窍是使用*File*而不是*Blob*。

参考：[https ://developer.mozilla.org/de/docs/Web/API/File](https://developer.mozilla.org/de/docs/Web/API/File)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-02-11T15:26:56.517

`<a href=.. download=.. >`适用于左键单击和右键单击->将链接另存为..，

但`<img src=.. download=.. >`不适用于右键单击 -> 将图像另存为.. ，建议使用“Download.jped”。

如果将两者结合起来：`<a href=.. download=..><img src=..></a>`

它适用于左键单击，右键单击->将链接另存为..，右键单击->将图像另存为..

您必须编写两次 data-uri（href 和 src），因此对于大图像文件，最好使用 javascript 复制 uri。

*使用 Chrome/Edge 88 测试*

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2015-11-25T13:08:25.777

```
var isIE = /*@cc_on!@*/false || !!document.documentMode; // At least IE6
var sessionId ='\n';
var token = '\n';
var caseId = CaseIDNumber + '\n';
var url = casewebUrl+'\n';
var uri = sessionId + token + caseId + url;//data in file
var fileName = "file.i4cvf";// any file name with any extension
if (isIE)
    {
            var fileData = ['\ufeff' + uri];
            var blobObject = new Blob(fileData);
            window.navigator.msSaveOrOpenBlob(blobObject, fileName);
    }
    else //chrome
    {
        window.requestFileSystem = window.requestFileSystem || window.webkitRequestFileSystem;
         window.requestFileSystem(window.TEMPORARY, 1024 * 1024, function (fs) {
            fs.root.getFile(fileName, { create: true }, function (fileEntry) { 
                fileEntry.createWriter(function (fileWriter) {
                    var fileData = ['\ufeff' + uri];
                    var blob = new Blob(fileData);
                    fileWriter.addEventListener("writeend", function () {
                        var fileUrl = fileEntry.toURL();
                        var link = document.createElement('a');
                        link.href = fileUrl;
                        link.download = fileName;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }, false);
                    fileWriter.write(blob);
                }, function () { });
            }, function () { });
         }, function () { });
    } 
```

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2016-11-26T15:33:10.010

您实际上可以在 Chrome 和 FireFox 中实现这一点。

尝试以下网址，它将下载使用的代码。

```
data:text/html;base64,PGEgaHJlZj0iZGF0YTp0ZXh0L2h0bWw7YmFzZTY0LFBHRWdhSEpsWmowaVVGVlVYMFJCVkVGZlZWSkpYMGhGVWtVaUlHUnZkMjVzYjJGa1BTSjBaWE4wTG1oMGJXd2lQZ284YzJOeWFYQjBQZ3BrYjJOMWJXVnVkQzV4ZFdWeWVWTmxiR1ZqZEc5eUtDZGhKeWt1WTJ4cFkyc29LVHNLUEM5elkzSnBjSFErIiBkb3dubG9hZD0idGVzdC5odG1sIj4KPHNjcmlwdD4KZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYScpLmNsaWNrKCk7Cjwvc2NyaXB0Pg== 
```

# http - REST：为被忽略的 POST 更正 HTTP 响应代码

> ID：283957
> 
> 赞同：21
> 
> 时间：2008-11-12T13:43:03.820
> 
> 标签：http, rest, http-headers

我们有一个 REST API，客户端会定期 POST 和 PUT 数据。当他们这样做时，有时他们会发布数据，这导致我们的系统没有任何变化。POST 和 PUT 格式正确，但它们发送的数据与我们数据库中的数据相同。发生这种情况时，我刚刚发现我们正在返回 400 HTTP 状态。不幸的是，这意味着“错误请求”，如“由于语法错误，服务器无法理解请求”。

显然情况并非如此，但我被告知我们将使用它，因为没有其他适当的状态代码。我们考虑过的选择：

*   304 未修改。遗憾的是，这仅适用于 GET 请求。
*   204 无内容。似乎很接近，但禁止实体。

其他选择似乎同样糟糕。我们可能会`200 OK`在返回的 XML 文档中保留相关信息，但这似乎不是很“RESTish”。REST 世界通常如何处理这个问题？

（固定未修改响应代码。感谢 Mkoeller）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-12T14:02:55.620

我认为在这种情况下返回 200 OK 是完全没问题的，数据得到了正确处理，服务器做了它必须做的事情。因为服务器正确处理了数据，所以它应该返回一个 OK 状态码。它在内部忽略它的事实是或应该是无关紧要的。

服务器对数据做了什么不应该告诉客户端，他们应该被告知请求发生了什么（处理正常，发生错误等）。

而且，如果出于某种奇怪的原因（顺便说一句，我认为这不是一个有效的原因），客户对此感兴趣，您可以回复告诉他们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T02:25:35.463

如果客户端能够在 PUT 之前知道服务器上内容的实体标签，那么对于您描述的情况，使用 If-Match 标头和 412 Precondition Failed 响应存在。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T14:01:30.553

从客户端的角度来看，无论服务器上的请求内容是否相同，服务器状态都是相同的，对吧？既然服务器之后准确地保存了发送的内容，为什么服务器要以任何类型的错误状态响应？另一方面，如果请求内容与服务器已知的相同，客户端为什么要打扰呢？它已成功传输到服务器，因此完成了大部分工作。如果这种情况有不同的响应代码，客户应该如何反应？

结论：您的请求内容等于现有内容的情况并非特例。您应该使用相同的响应状态代码进行响应。那可能是 200、302 或 303。

# html - 居中没有宽度的 div 块

> ID：283961
> 
> 赞同：248
> 
> 时间：2008-11-12T13:43:57.657
> 
> 标签：html, css

当我尝试将 div 块“产品”居中时遇到问题，因为我事先不知道 div 宽度。有人有解决方案吗？

更新：我的问题是我不知道我会展示多少个产品，我可以有 1、2 或 3 个产品，如果它是一个固定数字，我可以将它们居中，因​​为我知道父级的宽度div，我只是不知道当内容是动态的时该怎么做。

```
.product_container {
  text-align: center;
  height: 150px;
}

.products {
  height: 140px;
  text-align: center;
  margin: 0 auto;
  clear: ccc both; 
}
.price {
  margin: 6px 2px;
  width: 137px;
  color: #666;
  font-size: 14pt;
  font-style: normal;
  border: 1px solid #CCC;
  background-color:	#EFEFEF;
}
```

```
<div class="product_container">
  <div class="products" id="products">
    <div id="product_15">
      <img src="/images/ecommerce/card_default.png">
      <div class="price">R$ 0,01</div>
    </div>

    <div id="product_15">
      <img src="/images/ecommerce/card_default.png">
      <div class="price">R$ 0,01</div>
    </div>   

    <div id="product_15">
      <img src="/images/ecommerce/card_default.png">
      <div class="price">R$ 0,01</div>
    </div>
  </div>
</div>
```

* * *

## 回答 #1

> 赞同：260
> 
> 时间：2011-06-15T05:17:07.237

**2015 年 2 月 27 日更新：**我的原始答案不断获得支持，但现在我通常使用 @bobince 的方法。

```
.child { /* This is the item to center... */
  display: inline-block;
}
.parent { /* ...and this is its parent container. */
  text-align: center;
} 
```

**我出于历史目的的原始帖子：**

您可能想尝试这种方法。

```
<div class="product_container">
    <div class="outer-center">
        <div class="product inner-center">
        </div>
    </div>
    <div class="clear"/>
</div> 
```

搭配风格如下：

```
.outer-center {
    float: right;
    right: 50%;
    position: relative;
}
.inner-center {
    float: right;
    right: -50%;
    position: relative;
}
.clear {
    clear: both;
} 
```

[JSFiddle](http://jsfiddle.net/6350btvd/3/)

这里的想法是您将要居中的内容包含在两个 div 中，一个外部 div 和一个内部 div。您浮动两个 div 以便它们的宽度自动缩小以适合您的内容。接下来，您将外部 div 与它的右边缘相对定位在容器的中心。最后，您将内部 div 相对方向定位为其自身宽度的一半（实际上是外部 div 的宽度，但它们是相同的）。最终将内容集中在它所在的任何容器中。

如果您依赖“产品”内容来调整“product_container”的高度，则最后*可能需要那个空 div。*

* * *

## 回答 #2

> 赞同：145
> 
> 时间：2008-11-12T14:18:52.750

An element with ‘display: block’ (as div is by default) has a width determined by the width of its container. You can't make a block's width dependent on the width of its contents (shrink-to-fit).

(Except for blocks that are ‘float: left/right’ in CSS 2.1, but that's no use for centering.)

You could set the ‘display’ property to ‘inline-block’ to turn a block into a shrink-to-fit object that can be controlled by its parent's text-align property, but browser support is spotty. You can mostly get away with it by using hacks (eg. see -moz-inline-stack) if you want to go that way.

The other way to go is tables. This can be necessary when you have columns whose width really can't be known in advance. I can't really tell what you're trying to do from the example code — there's nothing obvious in there that would *need* a shrink-to-fit block — but a list of products could possibly be considered tabular.

[PS. never use ‘pt’ for font sizes on the web. ‘px’ is more reliable if you really need fixed size text, otherwise relative units like ‘%’ are better. And “clear: ccc both” — a typo?]

```
.center{
   text-align:center; 
}

.center > div{ /* N.B. child combinators don't work in IE6 or less */
   display:inline-block;
} 
```

[JSFiddle](http://jsfiddle.net/ajr4Lhhr/1/)

* * *

## 回答 #3

> 赞同：101
> 
> 时间：2014-01-23T22:32:32.023

大多数浏览器都支持`display: table;`CSS 规则。这是一个很好的技巧，可以在容器中将 div 居中而不添加额外的 HTML 也不对容器应用约束样式（就像`text-align: center;`将容器中的所有其他内联内容居中一样），同时保持包含的 div 的动态宽度：

HTML：

```
<div class="container">
  <div class="centered">This content is centered</div>
</div> 
```

CSS：

```
.centered { display: table; margin: 0 auto; } 
```

```
.container {
  background-color: green;
}
.centered {
  display: table;
  margin: 0 auto;
  background-color: red;
}
```

```
<div class="container">
  <div class="centered">This content is centered</div>
</div>
```

* * *

**更新（2015-03-09）：**

今天这样做的正确方法实际上是使用 flexbox 规则。浏览器支持受到更多限制（[CSS 表格支持](http://caniuse.com/#feat=css-table)与[flexbox 支持](http://caniuse.com/#feat=flexbox)），但此方法还允许许多其他事情，并且是针对此类行为的专用 CSS 规则：

HTML：

```
<div class="container">
  <div class="centered">This content is centered</div>
</div> 
```

CSS：

```
.container {
  display: flex;
  flex-direction: column; /* put this if you want to stack elements vertically */
}
.centered { margin: 0 auto; } 
```

```
.container {
  display: flex;
  flex-direction: column; /* put this if you want to stack elements vertically */
  background-color: green;
}
.centered {
  margin: 0 auto;
  background-color: red;
}
```

```
<div class="container">
  <div class="centered">This content is centered</div>
</div>
```

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2017-05-23T13:03:54.123

# 给猫剥皮的六种方法：

[![](https://i.stack.imgur.com/76Vpf.png)](https://i.stack.imgur.com/76Vpf.png)

**按钮一：**任何类型的东西都`display: block`将采用父母的全部宽度。`float`（除非与`display: flex`父母结合）。真的。不好的例子。

**按钮 2：**将`display: inline-block`导致自动（而不是全）宽度。然后，您可以`text-align: center` *在包装块上*使用居中。**可能是最简单，最广泛兼容的，即使是“老式”浏览器......**

```
.wrapTwo
  text-align: center;
.two
  display: inline-block; // instantly shrinks width 
```

**按钮 3：** 无需在包装上放任何东西。所以也许这是最优雅的解决方案。也可以垂直工作。（这些天，浏览器对翻译的支持已经[足够好了（≥IE9）](https://caniuse.com/#search=transform) ......）。

```
position: relative;
display: inline-block; // instantly shrinks width
left: 50%;
transform: translateX(-50%); 
```

顺便说一句：也是垂直居中未知高度的块的好方法（与绝对定位有关）。

**按钮 4：** 绝对定位。只要确保在包装器中保留足够的高度，因为没有其他人会（无论是 clearfix 还是隐式......）

```
.four
  position absolute
  top 0
  left 50%
  transform translateX(-50%)
.wrapFour
  position relative // otherwise, absolute positioning will be relative to page!
  height 50px // ensure height
  background lightgreen // just a marker 
```

**按钮 5：** 浮动（也将块级元素带入动态宽度）和相对移位。虽然我*从未*在野外见过这种情况。也许有缺点...

```
.wrapFive
  &:after // aka 'clearfix'
    content ''
    display table
    clear both

.five  
  float left
  position relative
  left 50%
  transform translateX(-50%) 
```

**更新：** **按钮 6：** 现在，您还可以使用 flex-box。请注意，样式适用于居中对象的包装。

```
.wrapSix
  display: flex
  justify-content: center 
```

## [→ 完整源代码（手写笔语法）](https://codepen.io/fnocke/pen/NjeVgg?editors=1100)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-07-01T06:59:13.550

我找到了一个更优雅的解决方案，结合“inline-block”来避免使用 float 和 hacky clear:both。它仍然需要嵌套的 div，这不是很语义化，但它只是工作......

```
div.outer{
    display:inline-block;
    position:relative;
    left:50%;
}

div.inner{
    position:relative;
    left:-50%;
} 
```

希望能帮助到你！

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-08-19T01:57:45.260

```
<div class="outer">
   <div class="target">
      <div class="filler">
      </div>
   </div>
</div>

.outer{
   width:100%;
   height: 100px;
}

.target{
   position: absolute;
   width: auto;
   height: 100px;
   left: 50%;
   transform: translateX(-50%);
}

.filler{
   position:relative;
   width:150px;
   height:20px;
} 
```

如果目标元素是绝对定位的，您可以通过将其向一个方向移动 50% ( `left: 50%`) 将其居中，然后将其向相反方向 ( `transform:translateX(-50%)`) 变换 50%。这无需定义目标元素的宽度（或使用`width:auto`）即可工作。父元素的位置可以是静态的、绝对的、相对的或固定的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-12T13:52:56.700

默认情况下，`div`元素显示为块元素，因此它们具有 100% 的宽度，使它们居中毫无意义。正如 Arief 所建议的，您必须指定 a `width`，然后您可以`auto`在指定时使用`margin`以使 a 居中`div`。

或者，你也可以 force `display: inline`，但是你会有一些行为几乎像 a`span`而不是 a `div`，所以这没有多大意义。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-11-16T08:53:29.237

这将使一个元素居中，例如有序列表、无序列表或任何元素。只需用类为outerElement 的Div 包装它，并为内部元素提供innerElement 类。

outerelement 类用于 IE、旧 Mozilla 和大多数较新的浏览器。

```
 .outerElement {
        display: -moz-inline-stack;
        display: inline-block;
        vertical-align: middle;
        zoom: 1;
        position: relative;
        left: 50%;
    }

.innerElement {
    position: relative;
    left: -50%;
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-11-21T11:57:53.930

将 css3 flexbox 与 justify-content:center 一起使用；

```
 <div class="row">
         <div class="col" style="background:red;">content1</div>
          <div class="col" style="">content2</div>
    </div>

.row {
    display: flex; /* equal height of the children */
    height:100px;
    border:1px solid red;
    width: 400px;
    justify-content:center;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-08-10T09:53:22.313

```
<div class="product_container">
<div class="outer-center">
<div class="product inner-center">
    </div>
</div>
<div class="clear"></div>
</div>

.outer-center
{
float: right;
right: 50%;
position: relative;
}
.inner-center 
{
float: right;
right: -50%;
position: relative;
}
.clear 
{
clear: both;
}

.product_container
{
overflow:hidden;
} 
```

如果您没有为“.product_container”提供“overflow:hidden”，则“outer-center”div 将与它右侧的其他附近内容重叠。“外部中心”右侧的任何链接或按钮都不起作用。尝试“外部中心”的背景颜色以了解“溢出：隐藏”的需要

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-10-30T10:40:17.907

执行`display:table;`并设置`margin`为`auto`

重要的代码位：

```
.relatedProducts {
    display: table;
    margin-left: auto;
    margin-right: auto;
} 
```

无论您现在有多少元素，它都会自动居中对齐

代码片段中的示例：

```
.relatedProducts {
    display: table;
    margin-left: auto;
    margin-right: auto;
}
a {
  text-decoration:none;
}
```

```
<div class="row relatedProducts">
<div class="homeContentTitle" style="margin: 100px auto 35px; width: 250px">Similar Products</div>

<a href="#">test1 </a>
<a href="#">test2 </a>
<a href="#">test3 </a>
</div>
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-11-30T00:04:20.033

[Mike M. Lin 的回答](https://stackoverflow.com/a/6353345/185722)略有不同

如果将`overflow: auto;`( 或`hidden`) 添加到`div.product_container`，则不需要`div.clear`.

这是源自这篇文章-> [http://www.quirksmode.org/css/clearing.html](http://www.quirksmode.org/css/clearing.html)

这是修改后的 HTML：

```
<div class="product_container">
    <div class="outer-center">
        <div class="product inner-center">
        </div>
    </div>
</div> 
```

这里是修改后的 CSS：

```
.product_container {
  overflow: auto;
  /* width property only required if you want to support IE6 */
  width: 100%;
}

.outer-center {
  float: right;
  right: 50%;
  position: relative;
}

.inner-center {
  float: right;
  right: -50%;
  position: relative;
} 
```

原因，为什么没有更好`div.clear`（除了它感觉有一个空元素是错误的）是 Firefox 过分热心的边距分配。

例如，如果你有这个 html：

```
<div class="product_container">
    <div class="outer-center">
        <div class="product inner-center">
        </div>
    </div>
    <div style="clear: both;"></div>
</div>
<p style="margin-top: 11px;">Some text</p> 
```

然后，在 Firefox（撰写本文时为 8.0）中，您将看到`11px`margin **before** `product_container`。更糟糕的是，即使内容非常适合屏幕尺寸，您也会获得整个页面的垂直滚动条。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-05-18T06:10:20.590

试试这个新的 CSS 和标记

这是修改后的 HTML：

```
<div class="product_container">
<div class="products" id="products">
   <div id="product_15" class="products_box">
       <img src="/images/ecommerce/card_default.png">
       <div class="price">R$ 0,01</div>
   </div>
   <div id="product_15" class="products_box">
       <img src="/images/ecommerce/card_default.png">
       <div class="price">R$ 0,01</div>
   </div>   
   <div id="product_15" class="products_box">
       <img src="/images/ecommerce/card_default.png">
       <div class="price">R$ 0,01</div>
   </div>
</div> 
```

这里是修改后的 CSS：

```
<pre>
.product_container 
 {
 text-align:    center;
 height:        150px;
 }

.products {
    left: 50%;
height:35px;
float:left;
position: relative;
margin: 0 auto;
width:auto;
}
.products .products_box
{
width:auto;
height:auto;
float:left;
  right: 50%;
  position: relative;
}
.price {
    margin:        6px 2px;
    width:         137px;
    color:         #666;
    font-size:     14pt;
    font-style:    normal;
    border:        1px solid #CCC;
    background-color:   #EFEFEF;
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-06-04T22:53:12.280

我找到了有趣的解决方案，我正在制作滑块并且必须将滑动控件居中，我这样做并且工作正常。您还可以将相对位置添加到父级并垂直移动子级位置。看看[http://jsfiddle.net/bergb/6DvJz/](http://jsfiddle.net/bergb/6DvJz/)

CSS：

```
#parent{
        width:600px;
        height:400px;
        background:#ffcc00;
        text-align:center;
    }

#child{
        display:inline-block;
        margin:0 auto;
        background:#fff;
    } 
```

HTML：

```
<div id="parent">
    <div id="child">voila</div>
</div> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-12T13:53:57.213

恐怕没有明确指定宽度的唯一方法是使用（喘气）表。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-08-03T07:35:21.823

适用于旧浏览器的简单修复（但确实使用表格，并且需要设置高度）：

```
<div style="width:100%;height:40px;position:absolute;top:50%;margin-top:-20px;">
  <table style="width:100%"><tr><td align="center">
    In the middle
  </td></tr></table>
</div> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-03-26T10:55:57.523

糟糕的修复，但它确实有效......

CSS：

```
#mainContent {
    position:absolute;
    width:600px;
    background:#FFFF99;
}

#sidebar {
    float:left;
    margin-left:610px;
    max-width:300;
    background:#FFCCCC;
}
#sidebar{

    text-align:center;
} 
```

HTML：

```
<center>
<table border="0" cellspacing="0">
  <tr>
    <td>
<div id="mainContent">
1<br/>
<br/>
123<br/>
123<br/>
123<br/>
</div><div id="sidebar"><br/>
</div></td>
</tr>
</table>
</center> 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-07-30T21:11:50.503

我知道这个问题很老，但我正在研究它。与 bobince 的答案非常相似，但有工作代码示例。

使每个产品成为一个内联块。将容器的内容居中。完毕。

[http://jsfiddle.net/rgbk/6Z2Re/](http://jsfiddle.net/rgbk/6Z2Re/)

```
<style>
.products{
    text-align:center;
}

.product{
    display:inline-block;
    text-align:left;

    background-image: url('http://www.color.co.uk/wp-content/uploads/2013/11/New_Product.jpg');
    background-size:25px;
    padding-left:25px;
    background-position:0 50%;
    background-repeat:no-repeat;
}

.price {
    margin:        6px 2px;
    width:         137px;
    color:         #666;
    font-size:     14pt;
    font-style:    normal;
    border:        1px solid #CCC;
    background-color:   #EFEFEF;
}
</style>

<div class="products">
    <div class="product">
        <div class="price">R$ 0,01</div>
    </div>
    <div class="product">
        <div class="price">R$ 0,01</div>
    </div>
    <div class="product">
        <div class="price">R$ 0,01</div>
    </div>
    <div class="product">
        <div class="price">R$ 0,01</div>
    </div>
    <div class="product">
        <div class="price">R$ 0,01</div>
    </div>
    <div class="product">
        <div class="price">R$ 0,01</div>
    </div>
</div> 
```

另请参阅：[在 CSS 中使用动态宽度居中内联块](https://stackoverflow.com/questions/9245755/center-inline-blocks-with-dynamic-width-in-css)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-04-21T15:20:42.873

```
<style type="text/css">
.container_box{
    text-align:center
}
.content{
    padding:10px;
    background:#ff0000;
    color:#ffffff; 
```

}

使用 span 而不是内部 div

```
<div class="container_box">
   <span class="content">Hello</span>
</div> 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-11-08T20:44:17.047

这是在不知道元素内部宽度的 div 中居中任何内容的一种方法。

```
#product_15{
    position: relative;
    margin: 0 auto;
    display: table;
}
.price, img{
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
} 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2017-07-17T13:13:45.587

我的解决方案是：

```
.parent {
    display: flex;
    flex-wrap: wrap;
}

.product {
    width: 240px;
    margin-left: auto;
    height: 127px;
    margin-right: auto;
} 
```

* * *

## 回答 #22

> 赞同：-7
> 
> 时间：2008-11-12T13:49:49.530

将此 CSS 添加到您的 product_container 类

```
 margin: 0px auto;
    padding: 0px;
    border:0;
    width: 700px; 
```

# java - 如何在java中获取microsoft word文档的页数？

> ID：283965
> 
> 赞同：2
> 
> 时间：2008-11-12T13:46:22.237
> 
> 标签：java, jakarta-ee, ms-word

对于基于服务器的 j2ee 应用程序，我需要从 word 文档中检索页数。有什么想法有效吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T14:02:14.047

如果文档是现代 Word 2007 格式，您可以通过[OOXML](http://msdn.microsoft.com/en-us/library/aa338205.aspx#office2007aboutnewfileformat_developingsolutionsusingtheoffice)直接使用基于 XML 的操作。这是迄今为止更好的长期解决方案，尽管我意识到整个组织在一夜之间改变可能是不现实的。

如果它们是较旧的 Word 格式，您可能会被服务器端的 Word/Excel/Powerpoint/Outlook 可编程对象模型困住，尽管[您不应该在服务器上这样做](http://blogs.technet.com/tristank/archive/2008/11/06/don-t-use-office-applications-or-gdi-or-system-drawing-or-wininet-in-a-server-application-or-asp-net.aspx)..

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T14:05:25.427

关于 Office Open XML 支持，[Java-POI](http://poi.apache.org/index.html)的最新测试版应该支持它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T14:07:24.723

以前没用过，但你可以试试[Apache POI](http://poi.apache.org/)。看起来它有一个[WordCount](http://poi.apache.org/apidocs/org/apache/poi/hpsf/SummaryInformation.html#getWordCount())功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-01-01T07:41:16.867

//打开Word文档

```
Document doc = new Document("C:\\Temp\\file.doc"); 
```

//获取页数

```
int pageCount = doc.getPageCount(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-09-27T14:55:52.903

要阅读 MS Office 文件的页数，您可以使用 aspose 库（aspose-words、aspose-cells、aspose-slides）。

例子：

Excel：工作簿可打印版本的页数：

```
 import com.aspose.cells.*;
   public int getPageCount(String filePath) throws Exception {
        Workbook book = new Workbook(filePath);
        ImageOrPrintOptions imageOrPrintOptions = new ImageOrPrintOptions();
//        Default       0   Prints all pages.
//        IgnoreBlank   1   Don't print the pages which the cells are blank.
//        IgnoreStyle   2   Don't print the pages which cells only contain styles.
        imageOrPrintOptions.setPrintingPage(PrintingPageType.IGNORE_STYLE);

        int pageCount = 0;
        for (int i = 0; i < book.getWorksheets().getCount(); i++) {
            Worksheet sheet = book.getWorksheets().get(i);

            PageSetup pageSetup = sheet.getPageSetup();

            pageSetup.setOrientation(PageOrientationType.PORTRAIT);

            pageSetup.setPaperSize(PaperSizeType.PAPER_LETTER);

            pageSetup.setTopMarginInch(1);
            pageSetup.setBottomMarginInch(1);
            pageSetup.setRightMarginInch(1);
            pageSetup.setLeftMarginInch(1);

            SheetRender sheetRender = new SheetRender(sheet, imageOrPrintOptions);

            int sheetPageCount = sheetRender.getPageCount();
            pageCount += sheetPageCount;
        }
        return pageCount;
    } 
```

字： 页数：

```
import com.aspose.words.Document;
public int getPageCount(String filePath) throws Exception {
     Document document = new Document(filePath);
     return document.getPageCount();
 } 
```

PowerPoint：幻灯片数量：

```
import com.aspose.slides.*;
public int getPageCount(String filePath) throws Exception {
     Presentation presentation = new Presentation(filePath);
     return presentation.getSlides().toArray().length;
 } 
```

# java - 如何控制 JComponent 的 Tooltip 的显示？

> ID：283967
> 
> 赞同：4
> 
> 时间：2008-11-12T13:46:31.910
> 
> 标签：java, swing

我有一个在自身上绘制各种形状的 JComponent。我正在检测鼠标何时进入这些形状之一并相应地更改工具提示。

我遇到的问题是：

*   当用户在形状上跟踪鼠标时，工具提示不会跟随鼠标。它停留在最初设置的位置，然后仅在另一个形状更改工具提示时才跳转。
*   工具提示出现大约需要一秒钟，但我希望它立即出现。

有人可以建议一种无需编写自定义工具提示机制即可获得这些行为的方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-12T14:31:11.570

看看[ToolTipManager](http://java.sun.com/javase/6/docs/api/javax/swing/ToolTipManager.html)。

您可以向该管理器注册您的组件，然后调整一些设置。它使用起来非常简单。

这至少可以解决您的初始延迟问题。

对于您的第一个问题，您可以覆盖组件中的 createTooltip 命令以获取 JTooltip 实例。然后，只要您移动鼠标（也就是跟随鼠标），它就可以轻松地改变位置，因为它是 JComponent 类的子类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-11T15:04:40.003

要解决工具提示不跟随鼠标的第一个问题，如果您覆盖 JComponent 中的 getToolTipLocation(MouseEvent e)，则可以返回要显示工具提示的位置。MouseEvent 将允许您检索 x 和 y。

# abap - ABAP 开发的时间估计

> ID：283973
> 
> 赞同：4
> 
> 时间：2008-11-12T13:49:41.137
> 
> 标签：abap, estimation

我正在寻找 ABAP 开发的标准时间估计表或列表，根据开发团队、项目的复杂性等在某些变量中可定制的东西......

类似于：

```
Simple Module Pool -> 10 hours
Complex Module Pool -> 30 hours
Definition of Dictionary -> (0,4 * number_of_tables * average_fields ) hours
ALV Report -> (2 * number_of_parameters) hours 
```

我已经搜索过，但还没有找到任何东西。我找到了 AboveSoft Adaptive Estimator，它看起来像是一个软件工具，可以满足我的需求，但我更喜欢……手册、官方或标准表。

你知道这样的事吗？

先感谢您。

根据 Rob S. 的评论要求进行了更新，以便为未来的类似问题提供更多信息：

我正在寻找的是一堆公式，任何可以适用于（甚至创建用于）SAP 开发时间估计的度量系统。

我正在寻找一种技术/工具/方法来估计 SAP 工作、持续时间、成本，类似于用于 SAP 开发的 COCOMO II、FP、ESTIMACS 或 SLIM。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-12T14:50:16.163

如果我没看错，您正在寻找一种东西来估计某人编写应用程序需要多长时间。我怀疑是否真的存在官方表格。

开发时间变化很大。程序员的经验、需求的复杂性、需求的清晰度以及许多其他因素都会影响开发所需的时间。因此，即使存在官方表格，也可能不准确。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-12T16:09:06.100

您在问题中为说明目的编写的公式与其他公式一样好 - 换句话说，您要求的东西毫无意义。

原因是没有公式可以解释真正重要的变量：

*   你的团队
*   你的客户
*   你的环境
*   您的标准和最佳实践

所有这些都将具有比任何其他项大得多的阻力系数

如果您想要准确的估计，*请询问您的开发人员并跟踪他们的准确性*

如果你真的认为这种事情可以简化为公式，**请立即辞去项目经理的职务**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T16:20:34.720

我不是项目经理，我只是 SAP 团队的实习生。由于我在其他语言方面的经验，我知道有太多变量，不可能自动估计开发时间。

但是我收到了为 SAP/ABAP 开发寻找“估计时间标准表”的工作，作为 SAP 的新手，我想这将存在任何度量标准标准化。

我想我已经被我的经理开了一个粗鲁的玩笑......

很抱歉给我的问题带来不便。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T14:59:28.830

让我猜猜……你是项目经理？

编程中没有“单一方式”，尤其是在高度专业化的 ABAP 世界中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T15:09:04.207

您可以使用 Excel、数字、甘特图手动完成，但您无法找到**任何**自动化的东西，您必须自己做！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-04T12:55:57.643

嗨，我了解您的需求...我是项目经理和估算专家，您正在寻找的是用于估算工作量的表格，用于开发 ABAP 组件...您需要一个表格，其中基于复杂性变化的组成部分和复杂性，你可以得到一个估计的工作量。（这是基于一种称为对象点的估计方法[http://yunus.hacettepe.edu.tr/~sencer/objectp.html](http://yunus.hacettepe.edu.tr/~sencer/objectp.html)）

此工作仅适用于 Codding & Unit Testing，您作为项目经理（或您的项目经理！）必须将此估算作为输入，但您需要估算另一个项目因素才能获得完整的“项目估算”......

我没有找到这个表，或者 bencharmak 的一些 estandar 表，所以我正在与我的软件工厂合作一个项目来构建我们自己的表......

我希望这对你有帮助..问候，

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-13T15:18:14.540

这根本不存在。通用指标太笼统以至于毫无用处。项目经理应该找到其他方法让他们的生活更轻松，比如辞职，但不要试图量化发展，就像剥土豆一样。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-12T22:06:58.827

试试 AboveSoft 的新工具，名为 AboveSoft Predictor。你可以在这里下载它 www.abovesoft.com

它连接到 SAP 系统，您可以轻松（以图形方式）生成自己的估算模板，这些模板保存在 SAP 中。

戴夫。

# c++ - c++ STL设置差异

> ID：283977
> 
> 赞同：75
> 
> 时间：2008-11-12T13:50:19.547
> 
> 标签：c++, stl, set, stdset, set-difference

C++ STL 集合数据结构有集合差分运算符吗？

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2008-11-12T13:59:14.723

是的，它在`<algorithm>`并且被称为：[`std::set_difference`](http://en.cppreference.com/w/cpp/algorithm/set_difference). 用法是：

```
#include <algorithm>
#include <set>
#include <iterator>
// ...
std::set<int> s1, s2;
// Fill in s1 and s2 with values
std::set<int> result;
std::set_difference(s1.begin(), s1.end(), s2.begin(), s2.end(),
    std::inserter(result, result.end())); 
```

最后，该集合`result`将包含`s1-s2`.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-12T13:52:52.473

是的，算法标题中有一个[set_difference](http://www.sgi.com/tech/stl/set_difference.html)函数。

**编辑：**

仅供参考，如其[文档](http://www.sgi.com/tech/stl/set.html)中所述，集合数据结构能够有效地使用该算法。该算法不仅适用于集合，还适用于排序集合上的任何一对迭代器。

正如其他人所提到的，这是一种外部算法，而不是一种方法。大概这对您的应用程序来说很好。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-12T13:55:38.240

不是语言意义上的“运算符”，但标准库中有 set_difference 算法：

[http://www.cplusplus.com/reference/algorithm/set_difference.html](http://www.cplusplus.com/reference/algorithm/set_difference.html)

当然，其他基本集合操作也存在 - （联合等），正如链接文章末尾的“另见”部分所建议的那样。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-02-26T18:49:39.150

C++ 没有定义集合差分运算符，但您可以定义自己的（使用其他响应中给出的代码）：

```
template<class T>
set<T> operator -(set<T> reference, set<T> items_to_remove)
{
    set<T> result;
    std::set_difference(
        reference.begin(), reference.end(),
        items_to_remove.begin(), items_to_remove.end(),
        std::inserter(result, result.end()));
    return result;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-06T00:29:23.733

选择的答案是正确的，但有一些语法错误。

代替

```
#include <algorithms> 
```

利用

```
#include <algorithm> 
```

代替

```
std::insert_iterator(result, result.end())); 
```

利用

```
std::insert_iterator<set<int> >(result, result.end())); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-10-03T20:35:15.870

再次，助推救援：

```
#include <string>
#include <set>
#include <boost/range/algorithm/set_algorithm.hpp>

std::set<std::string> set0, set1, setDifference;
boost::set_difference(set0, set1, std::inserter(setDifference, setDifference.begin()); 
```

setDifference 将包含 set0-set1。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-12T13:54:18.803

不是作为一种方法，而是有外部算法函数 set_difference

```
template <class InputIterator1, class InputIterator2, class OutputIterator>
OutputIterator set_difference(InputIterator1 first1, InputIterator1 last1,
                              InputIterator2 first2, InputIterator2 last2,
                              OutputIterator result); 
```

[http://www.sgi.com/tech/stl/set_difference.html](http://www.sgi.com/tech/stl/set_difference.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-12T13:54:41.207

显然，确实如此。

[SGI - set_difference](http://www.sgi.com/tech/stl/set_difference.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-03-14T15:06:12.287

我在这里看到的所有答案都是 O(n)。这不是更好吗？：

```
template <class Key, class Compare, class Allocator>   
std::set<Key, Compare, Allocator> 
set_subtract(std::set<Key, Compare, Allocator>&& lhs,
             const std::set<Key, Compare, Allocator>& rhs) {
    if (lhs.empty()) { return lhs; }
    // First narrow down the overlapping range:
    const auto rhsbeg = rhs.lower_bound(*lhs.begin());
    const auto rhsend = rhs.upper_bound(*lhs.rbegin());
    for (auto i = rhsbeg; i != rhsend; ++i) {
        lhs.erase(*i);
    }
    return std::move(lhs);
} 
```

这似乎做对了。我不确定如何处理`Compare`'s 类型未完全指定其行为的情况，如 if `Compare`is a `std::function<bool(int,int)>`，但除此之外，这似乎工作正常，应该像 O((num 重叠) •日志（`lhs.size()`））。

在`lhs`不包含的情况下，`*i`可以通过 O(log( `rhs.size()`)) 搜索`rhs`>= 的下一个元素来进一步优化`lhs`。这将优化这种情况`lhs = {0, 1000}`并`rhs = {1, 2, ..., 999}`在对数时间内进行减法。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2013-01-03T22:34:11.240

我们可以用吗

```
 set_difference(set1.begin(), set1.end(), set2.begin(). set2,end(),std::back_inserter(result)). 
```

# visual-studio-2008 - 是否可以将 WF 图导出到 visio？

> ID：283986
> 
> 赞同：2
> 
> 时间：2008-11-12T13:53:02.317
> 
> 标签：visual-studio-2008, workflow-foundation, diagram, visio

我希望能够将我的 WF 图从 Visual Studio 2008 导出到 Visio，以便更好地向非程序员展示它。有人知道它是否可能吗？我以前没有提到过它，我也没有看到任何从 VS 中跳出来的东西。

[编辑：WF = Windows 工作流基础]

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T16:05:33.540

在设计器中，单击工作流菜单项并选择“另存为图像”或“复制到剪贴板”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T14:35:51.153

我会提前说，我不知道 WWF 图表到底是什么，但不可能只将图表导出为 JPEG 文件。如果您需要做的就是向人们展示它，那么图像可能会很好用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T14:46:42.430

有点，有点。我不知道您/您的公司是否有预算，但我曾使用 K2 Workflow 在 Visio 中本地工作。您可以在 Visio 中构建工作流，并将其绑定到 K2 工作流/Windows 工作流基础中的元素。在[http://www.k2.com 试一试](http://www.k2.com)。开发人员一开始很便宜，但在高端却变得非常昂贵。

（不，这不是无耻的插件，只是我碰巧喜欢的产品:-)）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-05-25T15:17:55.133

在 VS2015 中，工作流菜单不存在，但您可以在设计器中单击鼠标右键以到达“复制为图像”和“另存为图像”选项。

我在 XPS 格式上取得了最大的成功，即使放大也能很好地呈现，并且可以使用 Windows 中的内置 XPS 查看器进行查看。************